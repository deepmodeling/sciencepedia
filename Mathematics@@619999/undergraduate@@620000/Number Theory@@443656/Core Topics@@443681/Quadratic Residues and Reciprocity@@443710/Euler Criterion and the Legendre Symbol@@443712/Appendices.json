{"hands_on_practices": [{"introduction": "This first exercise is foundational, anchoring your understanding of the Legendre symbol in first principles. You will begin by constructing a proof for Euler's criterion, using only the structure of the multiplicative group of integers modulo a prime and Fermat's Little Theorem. This theoretical work will then be put into practice as you manually compute $\\left(\\frac{3}{43}\\right)$ [@problem_id:3084828], reinforcing essential skills in modular exponentiation.", "problem": "Let $p$ be an odd prime and let $(a/p)$ denote the Legendre symbol, defined by $(a/p)=1$ if there exists $x \\in \\mathbb{Z}$ with $x^{2} \\equiv a \\pmod{p}$, $(a/p)=-1$ if $\\gcd(a,p)=1$ and no such $x$ exists, and $(a/p)=0$ if $p \\mid a$. Using only this definition, the structure of the multiplicative group $(\\mathbb{Z}/p\\mathbb{Z})^{\\times}$, and Fermatâ€™s little theorem, argue that for any $a$ with $\\gcd(a,p)=1$ the residue $a^{(p-1)/2}$ must be congruent to either $1$ or $-1$ modulo $p$, and that it is $1$ precisely when $a$ is a quadratic residue modulo $p$. Then, for $a=3$ and $p=43$, compute $3^{(43-1)/2} \\bmod 43$ explicitly to decide the sign and hence determine the value of the Legendre symbol $(3/43)$. Provide your final answer as a single integer. No rounding is required.", "solution": "The problem is valid. It asks for a proof of a specific case of Euler's criterion from first principles, followed by a numerical application to determine the value of a Legendre symbol.\n\nLet $p$ be an odd prime and let $a$ be an integer such that $\\gcd(a,p)=1$. The multiplicative group of integers modulo $p$, denoted $(\\mathbb{Z}/p\\mathbb{Z})^\\times$, has order $p-1$.\n\nFirst, we will argue that $a^{(p-1)/2}$ must be congruent to either $1$ or $-1$ modulo $p$.\nBy Fermat's Little Theorem, for any integer $a$ not divisible by $p$, we have $a^{p-1} \\equiv 1 \\pmod{p}$.\nSince $p$ is an odd prime, $p-1$ is an even integer, so we can write $p-1 = 2 \\cdot \\frac{p-1}{2}$.\nThe congruence can be rewritten as:\n$$ a^{2 \\cdot (p-1)/2} \\equiv 1 \\pmod{p} $$\n$$ \\left(a^{(p-1)/2}\\right)^2 \\equiv 1 \\pmod{p} $$\nLet $y = a^{(p-1)/2}$. Then the congruence is $y^2 \\equiv 1 \\pmod{p}$, which implies $y^2 - 1 \\equiv 0 \\pmod{p}$.\nFactoring the left side, we get $(y-1)(y+1) \\equiv 0 \\pmod{p}$.\nSince $p$ is a prime number, if it divides a product of two integers, it must divide at least one of them. Therefore, either $p \\mid (y-1)$ or $p \\mid (y+1)$.\nThis is equivalent to $y \\equiv 1 \\pmod{p}$ or $y \\equiv -1 \\pmod{p}$.\nSubstituting back $y = a^{(p-1)/2}$, we have proven that $a^{(p-1)/2} \\equiv 1 \\pmod{p}$ or $a^{(p-1)/2} \\equiv -1 \\pmod{p}$.\n\nNext, we will argue that $a^{(p-1)/2} \\equiv 1 \\pmod{p}$ if and only if $a$ is a quadratic residue modulo $p$.\n\n$(\\Rightarrow)$ Assume $a$ is a quadratic residue modulo $p$. By the definition provided, there exists an integer $x$ such that $x^2 \\equiv a \\pmod{p}$. Since $\\gcd(a,p)=1$, it must be that $x$ is not a multiple of $p$, so $\\gcd(x,p)=1$.\nSubstituting $x^2$ for $a$, we have:\n$$ a^{(p-1)/2} \\equiv (x^2)^{(p-1)/2} \\equiv x^{p-1} \\pmod{p} $$\nBy Fermat's Little Theorem, since $\\gcd(x,p)=1$, we have $x^{p-1} \\equiv 1 \\pmod{p}$.\nThus, if $a$ is a quadratic residue modulo $p$, then $a^{(p-1)/2} \\equiv 1 \\pmod{p}$.\n\n$(\\Leftarrow)$ Assume $a^{(p-1)/2} \\equiv 1 \\pmod{p}$. We must show $a$ is a quadratic residue modulo $p$.\nThe group $(\\mathbb{Z}/p\\mathbb{Z})^\\times$ is cyclic. Let $g$ be a generator (a primitive root modulo $p$). Any element $a \\in (\\mathbb{Z}/p\\mathbb{Z})^\\times$ can be written as $a \\equiv g^k \\pmod{p}$ for some unique integer $k$ in the range $1 \\le k \\le p-1$.\nThe condition $a^{(p-1)/2} \\equiv 1 \\pmod{p}$ becomes $(g^k)^{(p-1)/2} \\equiv 1 \\pmod{p}$, which is $g^{k(p-1)/2} \\equiv 1 \\pmod{p}$.\nSince $g$ is a generator, its order is $p-1$. Thus, $g^m \\equiv 1 \\pmod{p}$ if and only if $p-1$ divides $m$.\nSo, $p-1$ must divide $k(p-1)/2$. This means $k/2$ must be an integer, which implies that $k$ must be an even number.\nIf $k$ is even, say $k=2j$ for some integer $j$, then $a \\equiv g^k \\equiv g^{2j} \\equiv (g^j)^2 \\pmod{p}$.\nIf we let $x = g^j$, then we have found an integer $x$ such that $x^2 \\equiv a \\pmod{p}$. By definition, this means $a$ is a quadratic residue modulo $p$.\nCombining these two directions, we have shown that $a^{(p-1)/2} \\equiv 1 \\pmod{p}$ if and only if $a$ is a quadratic residue modulo $p$.\nFrom this and our earlier result, it follows that if $a$ is a quadratic non-residue modulo $p$, we must have $a^{(p-1)/2} \\equiv -1 \\pmod{p}$.\nThis relationship, $a^{(p-1)/2} \\equiv (a/p) \\pmod{p}$, is known as Euler's criterion.\n\nNow, we apply this criterion to the specific case where $a=3$ and $p=43$. We need to compute $3^{(43-1)/2} \\pmod{43}$, which is $3^{21} \\pmod{43}$. We use binary exponentiation (also known as exponentiation by squaring).\nThe exponent is $21$. In binary, $21 = 16+4+1$, so we will compute $3^{21} = 3^{16} \\cdot 3^4 \\cdot 3^1 \\pmod{43}$.\nFirst, we compute the required powers of $3$ by successive squaring:\n$$ 3^1 \\equiv 3 \\pmod{43} $$\n$$ 3^2 \\equiv 9 \\pmod{43} $$\n$$ 3^4 \\equiv 9^2 = 81 \\equiv 81 - 43 = 38 \\equiv -5 \\pmod{43} $$\n$$ 3^8 \\equiv (3^4)^2 \\equiv (-5)^2 = 25 \\pmod{43} $$\n$$ 3^{16} \\equiv (3^8)^2 \\equiv 25^2 = 625 \\pmod{43} $$\nTo reduce $625$ modulo $43$, we perform division with remainder: $625 = 14 \\times 43 + 23$.\nThus, $3^{16} \\equiv 23 \\pmod{43}$.\nNow we assemble the product for $3^{21}$:\n$$ 3^{21} = 3^{16} \\cdot 3^4 \\cdot 3^1 \\equiv 23 \\cdot (-5) \\cdot 3 \\pmod{43} $$\nFirst, we compute the product of the first two terms:\n$$ 23 \\cdot (-5) = -115 \\pmod{43} $$\nTo reduce $-115$ modulo $43$: $-115 = -3 \\times 43 + 14$, since $-3 \\times 43 = -129$. So, $-115 \\equiv 14 \\pmod{43}$.\nNow we multiply by the last term:\n$$ 3^{21} \\equiv 14 \\cdot 3 = 42 \\pmod{43} $$\nSince $42 = 43 - 1$, we have $42 \\equiv -1 \\pmod{43}$.\nSo, we have found that $3^{21} \\equiv -1 \\pmod{43}$.\n\nAccording to Euler's criterion, the value of the Legendre symbol $(3/43)$ is congruent to $3^{(43-1)/2}$ modulo $43$.\nTherefore, $(3/43) \\equiv -1 \\pmod{43}$.\nThe Legendre symbol $(a/p)$ for $\\gcd(a,p)=1$ can only take values $1$ or $-1$. The congruence uniquely determines the value.\nHence, the value of the Legendre symbol $(3/43)$ is $-1$.", "answer": "$$ \\boxed{-1} $$", "id": "3084828"}, {"introduction": "After mastering the Legendre symbol for prime moduli, this practice explores its generalization to composite numbers: the Jacobi symbol. The exercise is designed to illuminate a critical subtlety: while a Jacobi symbol $\\left(\\frac{a}{n}\\right)$ equaling $1$ is necessary for $a$ to be a quadratic residue modulo $n$, it is not sufficient. By finding explicit counterexamples for $n=15$ [@problem_id:3084835], you will gain a deeper appreciation for the structural differences between prime and composite moduli.", "problem": "Let $n=15$. For each integer $a$ with $1 \\leq a \\leq 14$ and $\\gcd(a,15)=1$, compute the Jacobi symbol $\\left(\\frac{a}{15}\\right)$ and determine whether $a$ is a quadratic residue modulo $15$ by solving $x^{2} \\equiv a \\pmod{15}$. Your reasoning should begin from fundamental definitions and well-tested facts: the definition of the Legendre symbol for odd primes, Euler's criterion for odd primes, the multiplicativity of the Jacobi symbol with respect to the bottom argument, and the Chinese Remainder Theorem (CRT). Do not assume any property that has not been established from these bases.\n\nLet $F$ be the number of values of $a$ in this range (with $\\gcd(a,15)=1$) for which $\\left(\\frac{a}{15}\\right)=1$ but $a$ is not a quadratic residue modulo $15$. Provide your final answer as the exact integer $F$.", "solution": "The problem is valid as it is mathematically well-posed, scientifically grounded in number theory, and its premises are consistent and complete.\n\nThe problem asks for the number of integers $a$ in the set $S = \\{a \\in \\mathbb{Z} \\mid 1 \\leq a \\leq 14, \\gcd(a,15)=1\\}$ for which the Jacobi symbol $\\left(\\frac{a}{15}\\right)=1$ but $a$ is not a quadratic residue modulo $15$. Let this number be $F$.\n\nFirst, we identify the set $S$. The integers $a$ between $1$ and $14$ that are relatively prime to $15$ are those not divisible by $3$ or $5$. This set is $S = \\{1, 2, 4, 7, 8, 11, 13, 14\\}$.\n\nThe problem requires a solution built from fundamental principles. We begin with the specified definitions and theorems.\nLet $n=15$. Since $15 = 3 \\times 5$, where $3$ and $5$ are distinct odd primes, we can analyze properties modulo $15$ by considering properties modulo $3$ and modulo $5$.\n\n1.  **The Jacobi Symbol**: For an integer $a$ and an odd positive integer $n = p_1 p_2 \\dots p_k$ where the $p_i$ are prime factors (not necessarily distinct), the Jacobi symbol is defined as the product of the corresponding Legendre symbols:\n    $$ \\left(\\frac{a}{n}\\right) = \\left(\\frac{a}{p_1}\\right) \\left(\\frac{a}{p_2}\\right) \\dots \\left(\\frac{a}{p_k}\\right) $$\n    For $n=15$, the Jacobi symbol is $\\left(\\frac{a}{15}\\right) = \\left(\\frac{a}{3}\\right)\\left(\\frac{a}{5}\\right)$.\n\n2.  **Quadratic Residues and the Chinese Remainder Theorem (CRT)**: An integer $a$ is a quadratic residue modulo $15$ if the congruence $x^2 \\equiv a \\pmod{15}$ has a solution. By the Chinese Remainder Theorem, this congruence is equivalent to the system of congruences:\n    $$\n    \\begin{cases}\n    x^2 \\equiv a \\pmod{3} \\\\\n    x^2 \\equiv a \\pmod{5}\n    \\end{cases}\n    $$\n    This system has a solution for $x$ if and only if each individual congruence has a solution. Since $\\gcd(a,15)=1$, we have $\\gcd(a,3)=1$ and $\\gcd(a,5)=1$. An individual congruence $x^2 \\equiv a \\pmod{p}$ (for prime $p$) has a solution if and only if $a$ is a quadratic residue modulo $p$. This is equivalent to the condition that the Legendre symbol $\\left(\\frac{a}{p}\\right)=1$.\n    Therefore, $a$ is a quadratic residue modulo $15$ if and only if $a$ is a quadratic residue modulo $3$ AND $a$ is a quadratic residue modulo $5$. This means:\n    $$ \\left(\\frac{a}{3}\\right) = 1 \\quad \\text{and} \\quad \\left(\\frac{a}{5}\\right) = 1 $$\n\n3.  **Euler's Criterion**: For an odd prime $p$ and an integer $a$ not divisible by $p$, Euler's criterion states that:\n    $$ \\left(\\frac{a}{p}\\right) \\equiv a^{(p-1)/2} \\pmod{p} $$\n\nWe are tasked with finding the number of integers $a \\in S$ such that:\n(i) $\\left(\\frac{a}{15}\\right) = 1$\n(ii) $a$ is not a quadratic residue modulo $15$.\n\nFrom condition (i) and the definition of the Jacobi symbol, we have $\\left(\\frac{a}{3}\\right)\\left(\\frac{a}{5}\\right) = 1$. This equation holds if both Legendre symbols are $1$ or if both are $-1$.\n$$ \\left(\\left(\\frac{a}{3}\\right)=1 \\text{ and } \\left(\\frac{a}{5}\\right)=1\\right) \\quad \\text{or} \\quad \\left(\\left(\\frac{a}{3}\\right)=-1 \\text{ and } \\left(\\frac{a}{5}\\right)=-1\\right) $$\nFrom condition (ii) and our analysis using the CRT, $a$ not being a quadratic residue modulo $15$ means that it is not the case that both $\\left(\\frac{a}{3}\\right)=1$ and $\\left(\\frac{a}{5}\\right)=1$.\n\nCombining these two requirements, the only possibility for an integer $a$ to satisfy both conditions is:\n$$ \\left(\\frac{a}{3}\\right) = -1 \\quad \\text{and} \\quad \\left(\\frac{a}{5}\\right) = -1 $$\n\nNow we translate these conditions on the Legendre symbols into congruence relations for $a$ using Euler's criterion.\nFor $p=3$:\n$\\left(\\frac{a}{3}\\right) = -1 \\iff a^{(3-1)/2} \\equiv a^1 \\equiv -1 \\pmod{3}$. Since $-1 \\equiv 2 \\pmod 3$, this is equivalent to $a \\equiv 2 \\pmod{3}$.\n\nFor $p=5$:\n$\\left(\\frac{a}{5}\\right) = -1 \\iff a^{(5-1)/2} \\equiv a^2 \\equiv -1 \\pmod{5}$. The quadratic residues modulo $5$ are $1^2 \\equiv 1$ and $2^2 \\equiv 4$. The integers that are not quadratic residues (non-residues) are $2$ and $3$. Thus, this is equivalent to $a \\equiv 2 \\pmod{5}$ or $a \\equiv 3 \\pmod{5}$.\n\nWe must find the integers $a \\in S$ that satisfy these congruence conditions. This leads to two systems of congruences:\n\nSystem 1:\n$$\n\\begin{cases}\na \\equiv 2 \\pmod{3} \\\\\na \\equiv 2 \\pmod{5}\n\\end{cases}\n$$\nBy the CRT, there is a unique solution modulo $3 \\times 5 = 15$. By inspection, the solution is $a \\equiv 2 \\pmod{15}$. The only integer in the set $S$ that satisfies this is $a=2$.\nFor $a=2$, we verify: $\\left(\\frac{2}{3}\\right) = -1$ and $\\left(\\frac{2}{5}\\right)=-1$. Thus $\\left(\\frac{2}{15}\\right)=(-1)(-1)=1$, and since $\\left(\\frac{2}{3}\\right) \\neq 1$, $2$ is not a quadratic residue mod $15$. So $a=2$ is one such value.\n\nSystem 2:\n$$\n\\begin{cases}\na \\equiv 2 \\pmod{3} \\\\\na \\equiv 3 \\pmod{5}\n\\end{cases}\n$$\nFrom the first congruence, $a = 3k+2$ for some integer $k$. Substituting this into the second congruence:\n$$ 3k+2 \\equiv 3 \\pmod{5} $$\n$$ 3k \\equiv 1 \\pmod{5} $$\nTo solve for $k$, we multiply by the modular inverse of $3$ modulo $5$, which is $2$ (since $3 \\times 2 = 6 \\equiv 1 \\pmod{5}$):\n$$ 2 \\times (3k) \\equiv 2 \\times 1 \\pmod{5} $$\n$$ k \\equiv 2 \\pmod{5} $$\nSo $k$ can be written as $k=5j+2$ for some integer $j$. Substituting this back into the expression for $a$:\n$$ a = 3(5j+2)+2 = 15j+6+2 = 15j+8 $$\nThe solution is $a \\equiv 8 \\pmod{15}$. The only integer in the set $S$ that satisfies this is $a=8$.\nFor $a=8$, we verify: $8 \\equiv 2 \\pmod 3 \\implies \\left(\\frac{8}{3}\\right)=-1$. And $8 \\equiv 3 \\pmod 5 \\implies \\left(\\frac{8}{5}\\right)=-1$. Thus $\\left(\\frac{8}{15}\\right)=(-1)(-1)=1$, and since $\\left(\\frac{8}{3}\\right) \\neq 1$, $8$ is not a quadratic residue mod $15$. So $a=8$ is the second such value.\n\nThe integers in the specified range that satisfy the conditions are $2$ and $8$. There are exactly two such integers.\nTherefore, the number $F$ is $2$.", "answer": "$$\\boxed{2}$$", "id": "3084835"}, {"introduction": "This final practice transitions from manual calculation to algorithmic design, a crucial step in applying number theory. You are tasked with developing a formal algorithm to compute the Legendre symbol using the efficient method of binary exponentiation, derived directly from Euler's criterion. By analyzing the algorithm's time complexity and implementing it to solve a batch of test cases [@problem_id:3084857], you will see how theoretical insights are transformed into powerful computational tools.", "problem": "Let $p$ be an odd prime and let $a$ be any integer. The goal is to derive, from first principles, an algorithm to compute $a^{\\frac{p-1}{2}} \\bmod p$ using repeated squaring and, based on the definition of quadratic residues, determine the Legendre symbol $\\left(\\frac{a}{p}\\right)$, where $\\left(\\frac{a}{p}\\right) \\in \\{-1,0,1\\}$. Begin from the following foundational base:\n- The definition of a quadratic residue modulo $p$: an integer $a$ is a quadratic residue modulo $p$ if there exists an integer $x$ such that $x^2 \\equiv a \\pmod{p}$; otherwise $a$ is a quadratic non-residue modulo $p$.\n- The definition of the Legendre symbol: $\\left(\\frac{a}{p}\\right) = 0$ if $p \\mid a$, $\\left(\\frac{a}{p}\\right) = 1$ if $a$ is a quadratic residue modulo $p$ and $\\gcd(a,p)=1$ (Greatest Common Divisor (GCD)), and $\\left(\\frac{a}{p}\\right) = -1$ if $a$ is a quadratic non-residue modulo $p$.\n- Fermat's little theorem: for any integer $a$ with $\\gcd(a,p)=1$, $a^{p-1} \\equiv 1 \\pmod{p}$.\n\nUsing only these facts, derive why computing $a^{\\frac{p-1}{2}} \\bmod p$ suffices to decide whether $a$ is a quadratic residue modulo $p$, and hence to determine $\\left(\\frac{a}{p}\\right)$. Design an algorithm based on repeated squaring (also known as binary exponentiation) to compute $a^{\\frac{p-1}{2}} \\bmod p$, and explain how to map the output to the value of the Legendre symbol $\\left(\\frac{a}{p}\\right)$. Analyze the time complexity of your algorithm in terms of the bit-length of $p$, that is, in terms of $\\log p$, explicitly giving the number of modular multiplications and the cost model for integer multiplication.\n\nYour program must implement the repeated squaring algorithm for modular exponentiation without relying on any built-in modular exponentiation shortcuts. For each test case, it must:\n- Compute $r \\equiv a^{\\frac{p-1}{2}} \\bmod p$.\n- Output the Legendre symbol value $\\left(\\frac{a}{p}\\right)$ according to the definition, using the computed $r$ and the residue classes modulo $p$.\n\nUse the following test suite, which covers a general case, boundary conditions, and significant edge cases:\n- $(p,a) = (\\,3,\\,2\\,)$,\n- $(p,a) = (\\,3,\\,0\\,)$,\n- $(p,a) = (\\,11,\\,5\\,)$,\n- $(p,a) = (\\,29,\\,7\\,)$,\n- $(p,a) = (\\,13,\\,-1\\,)$,\n- $(p,a) = (\\,101,\\,25\\,)$,\n- $(p,a) = (\\,29,\\,29\\,)$,\n- $(p,a) = (\\,1000000007,\\,2\\,)$.\n\nYour program should produce a single line of output containing the Legendre symbol values for the above test cases as a comma-separated list of integers enclosed in square brackets, in the same order as listed (for example, $[1,0,-1]$). No physical units or angle units are involved, and all outputs are integers.", "solution": "The problem is valid as it is scientifically grounded in number theory, well-posed, and objective. It provides a self-contained set of definitions and theorems (quadratic residues, Legendre symbol, Fermat's Little Theorem) and asks for a derivation of Euler's criterion, the design of an algorithm based on this criterion, a complexity analysis, and a specific implementation for a given set of test cases. All components are mathematically sound and formalizable.\n\n### Theoretical Derivation and Algorithmic Design\n\nThe core task is to justify and implement a method for computing the Legendre symbol $\\left(\\frac{a}{p}\\right)$ for an odd prime $p$ and an integer $a$. The problem requires a derivation based on the fact that the value of the Legendre symbol is congruent to $a^{\\frac{p-1}{2}}$ modulo $p$. This relationship is known as Euler's criterion.\n\nWe will derive this criterion by considering the three possible values of $\\left(\\frac{a}{p}\\right)$: $0$, $1$, and $-1$.\n\n**Case 1: $\\left(\\frac{a}{p}\\right) = 0$**\nBy definition, $\\left(\\frac{a}{p}\\right) = 0$ if and only if $p \\mid a$, which is equivalent to $a \\equiv 0 \\pmod{p}$.\nSince $p$ is an odd prime, $p \\geq 3$, which implies that the exponent $\\frac{p-1}{2}$ is a positive integer.\nTherefore, if $a \\equiv 0 \\pmod{p}$, then $a^{\\frac{p-1}{2}} \\equiv 0^{\\frac{p-1}{2}} \\equiv 0 \\pmod{p}$.\nIn this case, $\\left(\\frac{a}{p}\\right) = 0$ and $a^{\\frac{p-1}{2}} \\equiv 0 \\pmod{p}$. The values match.\n\n**Case 2: $\\left(\\frac{a}{p}\\right) = 1$**\nBy definition, $\\left(\\frac{a}{p}\\right) = 1$ if and only if $a$ is a quadratic residue modulo $p$ and $\\gcd(a,p)=1$.\nThis means there exists an integer $x$ such that $x^2 \\equiv a \\pmod{p}$. Since $\\gcd(a,p)=1$, it must be that $\\gcd(x,p)=1$ as well (if $p \\mid x$, then $p \\mid x^2$, which would imply $p \\mid a$).\nBy Fermat's Little Theorem, since $\\gcd(x,p)=1$, we have $x^{p-1} \\equiv 1 \\pmod{p}$.\nNow we raise $a$ to the power of $\\frac{p-1}{2}$ modulo $p$:\n$$\na^{\\frac{p-1}{2}} \\equiv (x^2)^{\\frac{p-1}{2}} \\equiv x^{2 \\cdot \\frac{p-1}{2}} \\equiv x^{p-1} \\pmod{p}\n$$\nSubstituting $x^{p-1} \\equiv 1 \\pmod{p}$, we get:\n$$\na^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}\n$$\nIn this case, $\\left(\\frac{a}{p}\\right) = 1$ and $a^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}$. The values match.\n\n**Case 3: $\\left(\\frac{a}{p}\\right) = -1$**\nBy definition, $\\left(\\frac{a}{p}\\right) = -1$ if and only if $a$ is a quadratic non-residue modulo $p$. This implies $\\gcd(a,p)=1$.\nBy Fermat's Little Theorem, since $\\gcd(a,p)=1$, we have $a^{p-1} \\equiv 1 \\pmod{p}$.\nThis can be rewritten as $a^{p-1} - 1 \\equiv 0 \\pmod{p}$.\nFactoring the left side as a difference of squares gives:\n$$\n(a^{\\frac{p-1}{2}} - 1)(a^{\\frac{p-1}{2}} + 1) \\equiv 0 \\pmod{p}\n$$\nSince $p$ is a prime number, this implies that either $a^{\\frac{p-1}{2}} - 1 \\equiv 0 \\pmod{p}$ or $a^{\\frac{p-1}{2}} + 1 \\equiv 0 \\pmod{p}$.\nThis means $a^{\\frac{p-1}{2}}$ must be congruent to either $1$ or $-1$ modulo $p$.\nFrom Case $2$, we know that if $a$ is a quadratic residue, then $a^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}$. The set of quadratic residues are the roots of the polynomial congruence $X^{\\frac{p-1}{2}} - 1 \\equiv 0 \\pmod{p}$. By Lagrange's theorem on polynomial congruences, this polynomial has at most $\\frac{p-1}{2}$ roots modulo $p$. It is a known result from group theory (the group of units modulo $p$, $\\mathbb{Z}_p^*$, is cyclic) that there are exactly $\\frac{p-1}{2}$ quadratic residues and $\\frac{p-1}{2}$ quadratic non-residues.\nSince $a$ is a quadratic non-residue in this case, it cannot be a root of $X^{\\frac{p-1}{2}} - 1 \\equiv 0 \\pmod{p}$. Therefore, it cannot be that $a^{\\frac{p-1}{2}} \\equiv 1 \\pmod{p}$.\nThe only remaining possibility is:\n$$\na^{\\frac{p-1}{2}} \\equiv -1 \\pmod{p}\n$$\nIn this case, $\\left(\\frac{a}{p}\\right) = -1$ and $a^{\\frac{p-1}{2}} \\equiv -1 \\pmod{p}$. The values match.\n\n**Conclusion (Euler's Criterion)**\nCombining all three cases, we have established the relationship:\n$$\n\\left(\\frac{a}{p}\\right) \\equiv a^{\\frac{p-1}{2}} \\pmod{p}\n$$\nwhere the result of the exponentiation modulo $p$ is interpreted as $p-1$ for $-1$. This provides a direct computational method for finding the Legendre symbol.\n\n### Algorithm for Modular Exponentiation (Repeated Squaring)\n\nTo compute $r \\equiv a^{\\frac{p-1}{2}} \\pmod{p}$ efficiently, we use the method of repeated squaring (also called binary exponentiation). This algorithm avoids computing the very large intermediate value of $a^{\\frac{p-1}{2}}$ before taking the modulus.\n\nLet the base be $b$, the exponent be $e$, and the modulus be $m$. We want to compute $b^e \\pmod{m}$. The algorithm works by considering the binary representation of the exponent $e = \\sum_{i=0}^{k} c_i 2^i$, where $c_i \\in \\{0, 1\\}$.\nThe computation proceeds as follows:\n1. Initialize a result variable to $1$.\n2. Reduce the base $b$ modulo $m$.\n3. Iterate while the exponent $e > 0$:\n   a. If the current exponent $e$ is odd (i.e., the last bit is $1$), multiply the result by the current base (modulo $m$).\n   b. Square the base (modulo $m$). This prepares the base for the next bit of the exponent (e.g., from $b^{2^i}$ to $b^{2^{i+1}}$).\n   c. Right-shift the exponent by one bit (equivalent to integer division by $2$), effectively processing the bits from least significant to most significant.\n\nFor our problem, $b=a$, $e=\\frac{p-1}{2}$, and $m=p$.\n\n### Mapping to the Legendre Symbol\n\nThe final algorithm is as follows:\n1. Given $a$ and an odd prime $p$. First, reduce $a$ modulo $p$. Let this new value also be $a$. That is, $a \\leftarrow a \\pmod{p}$.\n2. If $a=0$, then $\\left(\\frac{a}{p}\\right)=0$.\n3. If $a \\neq 0$, compute $r = a^{\\frac{p-1}{2}} \\pmod{p}$ using the repeated squaring algorithm described above.\n4. Based on the derivation:\n   - If $r=1$, then $\\left(\\frac{a}{p}\\right)=1$.\n   - If $r=p-1$ (which is $\\equiv -1 \\pmod{p}$), then $\\left(\\frac{a}{p}\\right)=-1$.\n   - For a prime modulus $p$, no other result for $r$ is possible.\n\n### Complexity Analysis\n\nLet $n = \\log_2 p$ be the bit-length of the prime $p$. The exponent is $E = \\frac{p-1}{2}$, which also has a bit-length of approximately $n$.\n\n1.  **Number of Modular Multiplications**: The repeated squaring algorithm has a main loop that iterates as many times as there are bits in the exponent $E$. The number of iterations is $\\lfloor \\log_2 E \\rfloor + 1 \\approx n$. Inside the loop, one modular squaring is always performed. A modular multiplication is performed only if the corresponding bit of the exponent is $1$. In the worst case (all bits are $1$), there are approximately $n$ squarings and $n$ multiplications, for a total of $2n$ modular multiplications. In the best case (one bit is $1$), there are $n$ squarings and $1$ multiplication. Thus, the number of modular multiplications is $O(\\log p)$.\n\n2.  **Cost of Integer Operations**: The numbers involved in the multiplications are all less than $p$, so their bit-length is at most $n = \\lceil \\log_2 p \\rceil$. Let $M(n)$ be the time complexity of multiplying two $n$-bit integers.\n    - Using the standard \"schoolbook\" multiplication algorithm, $M(n) = O(n^2)$.\n    - A modular multiplication $(x \\cdot y) \\pmod p$ involves one integer multiplication (cost $M(n)$) and one integer division with remainder, which has a similar cost, typically also $O(n^2)$ with a simple algorithm. Thus, one modular multiplication costs $O((\\log p)^2)$.\n\n3.  **Total Time Complexity**: The total time complexity is the number of modular multiplications multiplied by the cost of each.\n    $$\n    \\text{Complexity} = O(\\log p) \\times (\\text{Cost of one modular multiplication})\n    $$\n    $$\n    \\text{Complexity} = O(\\log p) \\times O((\\log p)^2) = O((\\log p)^3)\n    $$\n    Using faster integer multiplication algorithms like Karatsuba ($M(n) = O(n^{\\log_2 3})$) would reduce the overall complexity.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Legendre symbol for a series of test cases using Euler's criterion\n    and a custom implementation of the repeated squaring algorithm.\n    \"\"\"\n\n    def custom_mod_pow(base, exp, mod):\n        \"\"\"\n        Computes (base^exp) % mod using repeated squaring (binary exponentiation).\n        This implementation is required by the problem statement and does not use\n        the built-in pow(base, exp, mod) function.\n        \"\"\"\n        result = 1\n        base = base % mod\n        while exp > 0:\n            # If exponent is odd, multiply base with result\n            if exp % 2 == 1:\n                result = (result * base) % mod\n            # Exponent must be even now, so we can halve it\n            exp = exp // 2\n            # Square the base\n            base = (base * base) % mod\n        return result\n\n    def legendre_symbol(a, p):\n        \"\"\"\n        Computes the Legendre symbol (a/p) for an odd prime p.\n        (a/p) = 0 if p | a\n        (a/p) = 1 if a is a quadratic residue mod p and p does not divide a.\n        (a/p) = -1 if a is a quadratic non-residue mod p.\n        This is determined by computing a^((p-1)/2) mod p.\n        \"\"\"\n        # The problem statement guarantees p is an odd prime.\n        \n        # Reduce a modulo p. This handles large and negative inputs for a.\n        a = a % p\n        \n        # Case 1: (a/p) = 0 if a is a multiple of p\n        if a == 0:\n            return 0\n        \n        # Case 2  3: (a/p) is 1 or -1, determined by Euler's criterion.\n        exponent = (p - 1) // 2\n        result = custom_mod_pow(a, exponent, p)\n        \n        # According to the derived theory, the result must be 1 or p-1 (which is -1 mod p).\n        if result == 1:\n            return 1\n        else:\n            # The result must be p-1\n            return -1\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (3, 2),\n        (3, 0),\n        (11, 5),\n        (29, 7),\n        (13, -1),\n        (101, 25),\n        (29, 29),\n        (1000000007, 2),\n    ]\n\n    results = []\n    for p, a in test_cases:\n        # Main logic to calculate the result for one case goes here.\n        result = legendre_symbol(a, p)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3084857"}]}