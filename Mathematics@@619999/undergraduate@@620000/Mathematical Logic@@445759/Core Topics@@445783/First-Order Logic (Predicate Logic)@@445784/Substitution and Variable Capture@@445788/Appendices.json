{"hands_on_practices": [{"introduction": "Before we can confidently apply substitutions, we must first learn to identify situations where they might go wrong. This practice introduces the crucial concept of a term being \"free for\" a variable, which is the formal check for whether a substitution is safe. By analyzing a classic case of variable capture from first principles, you will develop a precise understanding of how a variable's meaning can be unintentionally altered by a quantifier [@problem_id:3053916].", "problem": "Let $\\mathcal{L}$ be a standard first-order language with individual variables $x,y,z,\\dots$, a unary function symbol $f(\\cdot)$, a binary predicate symbol $P(\\cdot,\\cdot)$, and a unary predicate symbol $Q(\\cdot)$. Consider the formula $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$ and the term $t \\equiv f(y)$. Use the foundational definitions of free variables, bound variables, substitution, and variable capture in first-order logic to determine whether $t$ is free for $x$ in $\\varphi$. Your reasoning must start from the following base concepts:\n\n- The free variables of a term: the variables that occur in the term.\n- The free and bound occurrences of variables in a formula, and the scope of quantifiers.\n- The notion of substitution $\\varphi[x:=t]$ as the operation that replaces free occurrences of $x$ in $\\varphi$ by $t$.\n- The definition: a term $t$ is free for a variable $x$ in a formula $\\varphi$ if no variable occurring free in $t$ becomes bound as a result of performing the substitution $\\varphi[x:=t]$. Equivalently, no free occurrence of $x$ in $\\varphi$ lies within the scope of a quantifier binding a variable that occurs free in $t$.\n\nDecide whether $t$ is free for $x$ in $\\varphi$ by explicitly analyzing the scopes of quantifiers and the locations of the free occurrences of $x$ in $\\varphi$, and by identifying potential variable capture after substitution.\n\nAnswer specification:\n- Report your decision as a single real number: write $1$ if $t$ is free for $x$ in $\\varphi$, and write $0$ if $t$ is not free for $x$ in $\\varphi$.\n- No rounding is required.", "solution": "The problem requires us to determine whether the term $t \\equiv f(y)$ is free for the variable $x$ in the formula $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$, based on the foundational definitions of substitution in first-order logic.\n\nThe core definition to be used is: a term $t$ is free for a variable $x$ in a formula $\\varphi$ if no variable that occurs free in $t$ becomes bound upon substituting $t$ for all free occurrences of $x$ in $\\varphi$. An equivalent and more direct way to check this condition is to verify that for every free occurrence of $x$ in $\\varphi$, it does not lie within the scope of a quantifier $\\forall z$ or $\\exists z$ where $z$ is a variable that occurs free in the term $t$.\n\nWe will proceed by systematically analyzing the components of the problem.\n\n1.  **Analyze the term $t$:**\n    The term is given as $t \\equiv f(y)$. The set of variables occurring in this term is $\\{y\\}$. Since terms do not contain quantifiers, any variable occurring in a term is, by definition, a free variable. Therefore, the set of free variables in $t$, denoted $\\text{FV}(t)$, is $\\{y\\}$.\n\n2.  **Analyze the formula $\\varphi$:**\n    The formula is given as $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$.\n    We must identify the free occurrences of the variable $x$ and the scope of quantifiers.\n    -   The formula contains a single quantifier, $\\exists y$. The scope of this quantifier is the subformula to its right, which is $\\big(P(x,y)\\land Q(y)\\big)$.\n    -   Inside this scope, the variable $y$ appears in $P(x,y)$ and $Q(y)$. These occurrences of $y$ are bound by the quantifier $\\exists y$.\n    -   The variable $x$ appears once in the formula, within the atomic formula $P(x,y)$. This occurrence of $x$ is not bound by any quantifier in $\\varphi$ (as the only quantifier binds $y$). Therefore, this occurrence of $x$ is free in $\\varphi$.\n\n3.  **Apply the condition for \"free for\":**\n    We will now apply the definition. We need to check if any free occurrence of $x$ in $\\varphi$ falls within the scope of a quantifier that binds a variable present in $\\text{FV}(t)$.\n\n    -   **Free variables in the term $t$**: From step 1, we found that $\\text{FV}(t) = \\{y\\}$. The only variable we need to be concerned about is $y$.\n    -   **Free occurrences of $x$ in $\\varphi$**: From step 2, we found a single free occurrence of $x$ in the subformula $P(x,y)$.\n    -   **Quantifier scopes**: The formula $\\varphi$ has one quantifier, $\\exists y$, whose scope is $\\big(P(x,y)\\land Q(y)\\big)$.\n\n    Now, we check the crucial condition: Does the free occurrence of $x$ lie within the scope of the quantifier $\\exists y$? Yes, the subformula $P(x,y)$ containing the free $x$ is within the scope of $\\exists y$.\n\n    Next, does this quantifier, $\\exists y$, bind a variable that is free in the term $t$? The quantifier binds the variable $y$. And, as we established, the variable $y$ is indeed free in the term $t \\equiv f(y)$.\n\n    Since there is a free occurrence of $x$ in $\\varphi$ (in $P(x,y)$) that lies within the scope of a quantifier ($\\exists y$) which binds a variable ($y$) that is free in the term $t$, the condition for $t$ being free for $x$ in $\\varphi$ is violated.\n\n4.  **Demonstrate the Variable Capture:**\n    To make the reasoning concrete, let's observe what happens if we were to perform the substitution $\\varphi[x:=t]$, which means replacing the free occurrence of $x$ in $\\varphi$ with the term $t \\equiv f(y)$.\n    The original formula is $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$.\n    Substituting $f(y)$ for $x$ yields the new formula:\n    $$ \\exists y\\,\\big(P(f(y),y)\\land Q(y)\\big) $$\n    In this new formula, the variable $y$ that was part of the term $f(y)$ has been placed inside the scope of the quantifier $\\exists y$. This $y$, which was free in the term $t$, has been \"captured\" and is now bound by the existential quantifier. This capture alters the intended meaning of the substitution. The term $t$ was meant to be substituted for $x$, but its own variable $y$ has had its reference hijacked by a quantifier in $\\varphi$.\n\n    Therefore, because this variable capture occurs, the term $t$ is not free for $x$ in $\\varphi$.\n\n5.  **Conclusion:**\n    The term $t \\equiv f(y)$ is not free for the variable $x$ in the formula $\\varphi \\equiv \\exists y\\,\\big(P(x,y)\\land Q(y)\\big)$. According to the problem's specification, this corresponds to the numerical value $0$.", "answer": "$$\\boxed{0}$$", "id": "3053916"}, {"introduction": "Once we can diagnose the problem of variable capture, the next step is to master the cure: capture-avoiding substitution. This hands-on exercise requires you to perform a complex substitution where multiple variables from the term are at risk of being captured by different quantifiers in the formula. By systematically renaming the problematic bound variables before substituting, you will practice the complete and robust method that guarantees the logical meaning of your formulas is preserved [@problem_id:3053962].", "problem": "Work in classical First-Order Logic (FOL) over a signature with a binary function symbol $f$ and binary predicate symbols $A$ and $B$. Consider the term $t \\equiv f(y,z)$ and the formula $\\varphi \\equiv \\forall z\\,\\bigl(A(x,z) \\rightarrow \\exists y\\,B(y,x)\\bigr)$. Using only the standard, formal definitions of free and bound variables, $\\alpha$-conversion (systematic renaming of bound variables), and capture-avoiding substitution, perform the substitution of $t$ for $x$ in $\\varphi$. Provide full renaming details to avoid variable capture, then carry out the substitution. Verify the set of free variables of the resulting formula by direct analysis from first principles. Let $N$ denote the number of distinct free variables in the resulting formula after a correct capture-avoiding substitution. Report $N$ as your final answer.", "solution": "The problem requires us to perform a capture-avoiding substitution in first-order logic and determine the number of free variables in the resulting formula.\n\nFirst, we establish the given components of the problem. We are working in classical First-Order Logic.\nThe term to be substituted is $t \\equiv f(y,z)$.\nThe formula into which the substitution is to be made is $\\varphi \\equiv \\forall z\\,\\bigl(A(x,z) \\rightarrow \\exists y\\,B(y,x)\\bigr)$.\nThe substitution operation is to replace the variable $x$ with the term $t$ in $\\varphi$, denoted as $\\varphi[x:=t]$.\n\nThe standard definition of a capture-avoiding substitution, $\\psi[x:=t]$, requires that for any variable $v$ present in the term $t$, any free occurrence of $x$ in $\\psi$ must not be within the scope of a quantifier that binds $v$ (i.e., $\\forall v$ or $\\exists v$). If such a situation, known as \"variable capture,\" would occur, the bound variable $v$ in $\\psi$ must first be renamed to a fresh variable via $\\alpha$-conversion.\n\nLet's analyze the potential for variable capture in the substitution $\\varphi[x:=t]$.\nThe set of variables in the term $t \\equiv f(y,z)$ is $Var(t) = \\{y, z\\}$.\nThe set of free variables in the formula $\\varphi$ is $FV(\\varphi)$. The variable $x$ is not bound by any quantifier in $\\varphi$, so it is free. The variable $z$ is bound by $\\forall z$, and the variable $y$ is bound by $\\exists y$. Thus, $FV(\\varphi) = \\{x\\}$.\n\nWe must check if the substitution of $t$ for $x$ would cause any variable in $Var(t)$ to be captured by a quantifier in $\\varphi$.\n$1$. The variable $z \\in Var(t)$. The formula $\\varphi$ has the form $\\forall z\\,\\psi_1$, where $\\psi_1 \\equiv A(x,z) \\rightarrow \\exists y\\,B(y,x)$. The variable $x$ occurs free in $\\psi_1$, which is within the scope of the quantifier $\\forall z$. A naive substitution would replace $x$ with $f(y,z)$, resulting in the $z$ from the term $t$ being captured by the quantifier $\\forall z$. This is not permitted.\n$2$. The variable $y \\in Var(t)$. The subformula $\\exists y\\,B(y,x)$ is part of $\\varphi$. The variable $x$ occurs free in this subformula, which is within the scope of the quantifier $\\exists y$. A naive substitution would replace $x$ with $f(y,z)$, resulting in the $y$ from the term $t$ being captured by the quantifier $\\exists y$. This is also not permitted.\n\nTo avoid both instances of variable capture, we must perform $\\alpha$-conversion on $\\varphi$ to rename the bound variables $z$ and $y$. We choose fresh variables $z'$ and $y'$ that do not appear free in $\\varphi$ or $t$. Let's rename $z$ to $z'$ and $y$ to $y'$.\n\nFirst, we rename the bound variable $z$ in $\\varphi$:\n$\\varphi' \\equiv \\forall z'\\,\\bigl((A(x,z) \\rightarrow \\exists y\\,B(y,x))[z'/z]\\bigr)$\n$\\varphi' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y\\,B(y,x)\\bigr)$\nThe formula $\\varphi'$ is $\\alpha$-equivalent to $\\varphi$.\n\nNext, we rename the bound variable $y$ in $\\varphi'$.\n$\\varphi'' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow (\\exists y\\,B(y,x))[y'/y]\\bigr)$\n$\\varphi'' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y'\\,(B(y,x)[y'/y])\\bigr)$\n$\\varphi'' \\equiv \\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y'\\,B(y',x)\\bigr)$\nThe formula $\\varphi''$ is $\\alpha$-equivalent to $\\varphi$ and $\\varphi'$.\n\nNow, the substitution $\\varphi''[x:=t]$ can be performed without variable capture. The set of bound variables in $\\varphi''$ is $\\{y', z'\\}$, which is disjoint from $Var(t) = \\{y, z\\}$. We substitute $t \\equiv f(y,z)$ for every free occurrence of $x$ in $\\varphi''$.\n$\\varphi_{res} \\equiv \\varphi''[x:=f(y,z)] \\equiv \\left(\\forall z'\\,\\bigl(A(x,z') \\rightarrow \\exists y'\\,B(y',x)\\bigr)\\right)[x:=f(y,z)]$\n$\\varphi_{res} \\equiv \\forall z'\\,\\bigl(A(x,z')[x:=f(y,z)] \\rightarrow (\\exists y'\\,B(y',x))[x:=f(y,z)]\\bigr)$\n$\\varphi_{res} \\equiv \\forall z'\\,\\bigl(A(f(y,z),z') \\rightarrow \\exists y'\\,B(y', f(y,z))\\bigr)$\nThis is the resulting formula after a correct, capture-avoiding substitution.\n\nFinally, we must determine the set of free variables of the resulting formula, $\\varphi_{res}$, by direct analysis from first principles.\nThe formula is $\\varphi_{res} \\equiv \\forall z'\\,\\bigl(A(f(y,z),z') \\rightarrow \\exists y'\\,B(y',f(y,z))\\bigr)$.\nThe set of free variables in a universally quantified formula $\\forall v\\,\\psi$ is $FV(\\psi) \\setminus \\{v\\}$. Here, $v=z'$.\nThe body of the quantifier is $\\psi \\equiv A(f(y,z),z') \\rightarrow \\exists y'\\,B(y',f(y,z))$.\nThe set of free variables in an implication $\\psi_1 \\rightarrow \\psi_2$ is $FV(\\psi_1) \\cup FV(\\psi_2)$.\nLet's find the free variables of the antecedent $\\psi_1 \\equiv A(f(y,z),z')$.\nThe free variables of an atomic formula are the variables in its terms. The terms are $f(y,z)$ and $z'$.\n$Var(f(y,z)) = \\{y,z\\}$.\n$Var(z') = \\{z'\\}$.\nSo, $FV(A(f(y,z),z')) = \\{y, z, z'\\}$.\n\nNext, let's find the free variables of the consequent $\\psi_2 \\equiv \\exists y'\\,B(y',f(y,z))$.\nThe free variables of an existentially quantified formula $\\exists v\\,\\chi$ is $FV(\\chi) \\setminus \\{v\\}$. Here, $v=y'$.\nThe body of the quantifier is $\\chi \\equiv B(y',f(y,z))$.\nThe free variables of this atomic formula are the variables in its terms, $y'$ and $f(y,z)$.\n$Var(y') = \\{y'\\}$.\n$Var(f(y,z)) = \\{y,z\\}$.\nSo, $FV(B(y',f(y,z))) = \\{y', y, z\\}$.\nThen, $FV(\\exists y'\\,B(y',f(y,z))) = FV(B(y',f(y,z))) \\setminus \\{y'\\} = \\{y', y, z\\} \\setminus \\{y'\\} = \\{y, z\\}$.\n\nNow we can find the free variables of the implication $\\psi$:\n$FV(\\psi) = FV(A(f(y,z),z')) \\cup FV(\\exists y'\\,B(y',f(y,z)))$\n$FV(\\psi) = \\{y, z, z'\\} \\cup \\{y, z\\} = \\{y, z, z'\\}$.\n\nFinally, we find the free variables of the entire formula $\\varphi_{res}$:\n$FV(\\varphi_{res}) = FV(\\forall z'\\,\\psi) = FV(\\psi) \\setminus \\{z'\\}$\n$FV(\\varphi_{res}) = \\{y, z, z'\\} \\setminus \\{z'\\} = \\{y, z\\}$.\n\nThe set of free variables in the resulting formula is $\\{y, z\\}$. The number of distinct free variables is the cardinality of this set.\nTherefore, $N = |\\{y, z\\}| = 2$.", "answer": "$$ \\boxed{2} $$", "id": "3053962"}, {"introduction": "The rules of substitution are not just about manipulating symbols correctly; they are fundamental to how we apply general statements to specific instances. This final practice moves from syntax to semantics, demonstrating the purpose of capture-avoiding substitution. You will instantiate a formula containing a free variable by substituting a closed term, effectively making a specific claim, and then determine the truth of that claim within the familiar structure of the natural numbers [@problem_id:3053953].", "problem": "Consider the first-order language $\\mathcal{L} = \\{0, s, +, \\times, P\\}$, where $0$ is a constant symbol, $s$ is a unary function symbol (intended as successor), $+$ and $\\times$ are binary function symbols (intended as addition and multiplication), and $P$ is a unary predicate symbol. Let $\\mathcal{N}$ be the structure with domain $\\mathbb{N} = \\{0,1,2,\\dots\\}$ interpreting these symbols as follows: $0^{\\mathcal{N}} = 0$, $s^{\\mathcal{N}}(n) = n+1$, $+^{\\mathcal{N}}$ and $\\times^{\\mathcal{N}}$ are the usual addition and multiplication on $\\mathbb{N}$, and $P^{\\mathcal{N}}(n)$ holds if and only if $n$ is a prime number in the usual sense (that is, $n \\geq 2$ and the only positive divisors of $n$ are $1$ and $n$).\n\nDefine the formula with one free variable $x$:\n$$\n\\varphi(x) \\;:=\\; \\exists y\\;\\Big(\\,\\forall x\\,(x \\times y = y \\times x)\\;\\wedge\\; (x = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\nLet the closed term $t$ be $s(s(s(s(s(s(0))))))$.\n\nUsing only the core definitions of free and bound variables, capture-avoiding substitution, and the Tarskian semantics for first-order logic, form the closed sentence $\\varphi[x:=t]$ by substituting $t$ for all and only the free occurrences of $x$ in $\\varphi(x)$, ensuring no variable capture occurs. Then determine the truth value of $\\varphi[x:=t]$ in the structure $\\mathcal{N}$, encoded as a real number with $1$ denoting truth and $0$ denoting falsity. Your final answer must be this single number.", "solution": "We proceed from the fundamental definitions of syntax and semantics in first-order logic. A variable occurrence in a formula is free if it is not within the scope of a quantifier binding that variable; otherwise it is bound. A substitution of a term $t$ for a variable $x$ in a formula $\\psi$, written $\\psi[x:=t]$, replaces all free occurrences of $x$ in $\\psi$ by $t$, leaving bound occurrences of $x$ unchanged. A substitution is capture-avoiding when no free variable in $t$ becomes bound as a result of the replacement; when $t$ is a closed term, it has no free variables and hence cannot be captured.\n\nStep 1: Identify free and bound occurrences of $x$ in $\\varphi(x)$. The formula is\n$$\n\\varphi(x) \\;:=\\; \\exists y\\;\\Big(\\,\\forall x\\,(x \\times y = y \\times x)\\;\\wedge\\; (x = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\nThere are two kinds of occurrences of $x$:\n- Inside the subformula $\\forall x\\,(x \\times y = y \\times x)$, the variable $x$ is bound by the quantifier $\\forall x$.\n- In the subformula $(x = y + y)$, the $x$ is free because it is not within the scope of any quantifier binding $x$.\n\nThus, $\\varphi$ has one free occurrence of $x$, namely in the conjunct $(x = y + y)$.\n\nStep 2: Prepare to substitute and avoid capture. The closed term is $t = s(s(s(s(s(s(0))))))$. Since $t$ is closed, it has no free variables, so no variable in $t$ can be captured. Nonetheless, to eliminate any notational ambiguity with repeated use of $x$ both as a bound and a free variable symbol, we apply a standard $\\alpha$-conversion (renaming of bound variables) to the inner universal quantifier. By the definition of $\\alpha$-equivalence, renaming bound variables does not change meaning. We thus rewrite $\\varphi(x)$ equivalently as\n$$\n\\varphi(x) \\equiv \\exists y\\;\\Big(\\,\\forall z\\,(z \\times y = y \\times z)\\;\\wedge\\; (x = y + y)\\;\\wedge\\; P(y)\\,\\Big),\n$$\nwhere $z$ is a variable distinct from $x$ and $y$.\n\nStep 3: Perform the substitution. By definition of substitution, we replace the free occurrence of $x$ in $(x = y + y)$ with $t$, leaving the bound occurrences (now of $z$) unchanged. Hence,\n$$\n\\varphi[x:=t] \\;=\\; \\exists y\\;\\Big(\\,\\forall z\\,(z \\times y = y \\times z)\\;\\wedge\\; (t = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\nNo capture occurs because $t$ is closed.\n\nStep 4: Interpret $t$ in $\\mathcal{N}$. In $\\mathcal{N}$, $s$ is successor and $0$ is $0$, so\n$$\nt \\;=\\; s(s(s(s(s(s(0)))))) \\;=\\; 6.\n$$\n\nStep 5: Evaluate the truth of $\\varphi[x:=t]$ in $\\mathcal{N}$ by Tarskian semantics. The sentence is\n$$\n\\exists y\\;\\Big(\\,\\forall z\\,(z \\times y = y \\times z)\\;\\wedge\\; (6 = y + y)\\;\\wedge\\; P(y)\\,\\Big).\n$$\nWe analyze each conjunct inside the scope of $\\exists y$:\n- For any fixed $y \\in \\mathbb{N}$, the statement $\\forall z\\,(z \\times y = y \\times z)$ is true in $\\mathcal{N}$ because multiplication on $\\mathbb{N}$ is commutative; this is a standard arithmetic fact.\n- The equation $(6 = y + y)$ asserts that $y$ is a number satisfying $2y = 6$, hence $y = 3$ in $\\mathbb{N}$.\n- The predicate $P(y)$ asserts that $y$ is prime. The number $3$ is prime in the usual sense (its only positive divisors are $1$ and $3$).\n\nTherefore, taking $y = 3$ satisfies all three conjuncts:\n$$\n\\forall z\\,(z \\times 3 = 3 \\times z) \\text{ is true}, \\quad 6 = 3 + 3 \\text{ is true}, \\quad P(3) \\text{ is true}.\n$$\nHence the existential statement is true in $\\mathcal{N}$.\n\nStep 6: Encode the truth value numerically. By the problemâ€™s requirement, we output $1$ for truth and $0$ for falsity. Since $\\mathcal{N} \\models \\varphi[x:=t]$, the encoded truth value is $1$.\n\nThis also demonstrates the effect on satisfiability: the open formula $\\varphi(x)$ is satisfied in $\\mathcal{N}$ precisely by those $x$ that are equal to $y + y$ for some prime $y$ (that is, the even numbers that are twice a prime). Instantiating $x$ with the closed term $t$ yields the closed sentence $\\varphi[x:=t]$, which in this case is true in $\\mathcal{N}$ because $t$ denotes $6 = 2 \\cdot 3$ with $3$ prime.", "answer": "$$\\boxed{1}$$", "id": "3053953"}]}