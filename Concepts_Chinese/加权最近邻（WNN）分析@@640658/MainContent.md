## 引言
单细胞技术（如 [CITE-seq](@entry_id:150689) 和[多组学](@entry_id:148370) ATAC+RNA 测序）的出现为生物学带来了革命，使我们能够同时测量单个细胞的多个分子层面——例如转录组和[蛋白质组](@entry_id:150306)。这种[多模态数据](@entry_id:635386)为我们提供了前所未有的丰富视角来观察细胞身份和功能。然而，这也带来了重大的计算挑战：我们如何将这些不同的数据类型整合到一幅连贯的统一图像中，同时避免让充满噪声或信息量不足的测量数据掩盖真实的生物信号？简单的平均或[串联](@entry_id:141009)方法通常并非最佳选择，因为每个模态的信息含量在不同细胞之间可能存在巨大差异。

本文将介绍加权最近邻（WNN）分析，这是一种为解决此类[数据融合](@entry_id:141454)问题而设计的精妙而强大的计算方法。它提供了一个框架，通过学习每种数据类型对每个细胞的相对重要性，智能地结合多种数据模态。读者将了解到 WNN 如何创建一个统一且稳健的细胞[状态表示](@entry_id:141201)，从而促成更准确的生物学发现。

首先，“原理与机制”一章将解构 WNN 算法，解释其基于最近邻图的原理及其核心创新：一种用于学习细胞特异性权重的局部、跨模态预测方案。随后，“应用与[交叉](@entry_id:147634)学科联系”一章将展示该方法如何用于解决真实的生物学问题，从鉴定稀有免疫细胞到绘制胚胎发育的复杂路径。

## 原理与机制

设想你正在尝试理解一个复杂的物体，比如一个新发现的奇特水果。你可以给它拍张照片，了解其颜色和形状；也可以用 X 射线扫描，揭示其内部的[种子结构](@entry_id:173267)；甚至可以拍摄[热成像图](@entry_id:157820)，观察哪些部分温度更高或更低。每一种测量方式，即一种**模态**，都为你提供了不同类型的信息。一种简单的组合方法或许只是将这些图像叠加起来。但如果对于某个水果，照片模糊不清而 X 射[线图](@entry_id:264599)像却异常清晰，那该怎么办？简单的叠加会用模糊的照片污染清晰的 X 射线数据。为了获得最佳的理解，你会直觉地更关注清晰的测量结果，而减少对模糊结果的关注。你会想要*权衡*它们的重要性。

这正是现代生物学面临的挑战。借助 [CITE-seq](@entry_id:150689) 等技术，我们可以同时测量单个细胞中数千个基因的表达（[转录组](@entry_id:274025)，或 RNA）和数十种表面蛋白的丰度（[蛋白质组](@entry_id:150306)，或 ADT）[@problem_id:2967175]。或者，我们可以使用像 [scATAC-seq](@entry_id:166214) 这样的方法，同时测量一个细胞的转录组及其[表观基因组](@entry_id:272005)——即其 DNA 的可及性 [@problem_id:2892390]。每种模态都是我们观察细胞身份和功能的不同镜头。根本问题是：我们如何将这些镜头融合成一幅单一、连贯且稳健的图像？**加权最近邻（WNN）**分析提供了一个极为精妙的解决方案。

### 细胞景观与邻近细胞的力量

在为模态加权之前，我们必须首先接受单[细胞生物学](@entry_id:143618)的一个核心概念：细胞存在于一个低维**[流形](@entry_id:153038)**上。你可以把它想象成一个广阔而连续的景观。不同的细胞类型，如[巨噬细胞](@entry_id:172082)或 T 细胞，可能在这片景观中形成密集的盆地或山谷。当一个[细胞分化](@entry_id:273644)时，比如从[干细胞分化](@entry_id:270116)为神经元，它会沿着这片景观上的一条路径移动。根据定义，生物学上相似的细胞在这个抽象空间中彼此靠近。

虽然我们无法直接看到这片景观，但可以通过构建一个图来近似其局部几何结构。对于每个细胞，我们在测量空间中确定其 $k$ 个最接近的伙伴——即其**[k-最近邻](@entry_id:636754)（k-NN）**。通过在细胞与其邻居之间建立连接，我们创建了一个网络，即一个 **k-NN 图**，它充当了细胞状态[流形](@entry_id:153038)的路[线图](@entry_id:264599) [@problem_id:1465861]。

然而，这种简单的 k-NN 图可能对噪声和细胞采样密度的变化很敏感。一种更稳健的方法是构建一个**共享最近邻（SNN）图**。在这里，两个细胞（比如细胞 $i$ 和细胞 $j$）之间连接的强度不是基于它们的直接距离，而是基于它们共享邻居的数量。如果两个细胞共享许多最近的邻居，这强烈表明它们属于同一个局部社群。这种方法效果很好，因为其成功依赖于几个关键假设：我们的测量（经过适当的清理和处理后）能将相似的细胞置于相近的位置；一个生物群体内的细胞之间共享的邻居比与群体外细胞共享的邻居更多；以及我们采样了足够多的细胞来清晰地观察到这些模式 [@problem_id:2429814]。这种基于图的视角，即由局部邻域定义细胞身份，是 WNN 构建的基础。

### WNN 的精妙之处：局部[自适应加权](@entry_id:638030)方案

现在，让我们回到多模态问题上。对于同一组细胞，我们有一个基于 RNA 的景观和一个基于蛋白质的景观。我们可以为每个景观构建一个 SNN 图。但如何将它们结合起来呢？简单地对它们进行平均，又会把我们带回到那个“模糊照片”的问题。

WNN 的关键洞见在于放弃了“一刀切”的加权方案。WNN 不是全局性地决定蛋白质数据占 60% 的重要性、RNA 数据占 40% 的重要性，而是*为每一个细胞单独*确定这些权重。对于某个细胞，蛋白质数据可能非常清晰，权重为 $0.9$；而对于另一个细胞，其转录组可能信息更丰富，权重为 $0.8$。WNN 是一个能学习信息所在之处的自适应系统。

它是如何实现这一非凡成就的呢？它在不同模态之间玩了一个巧妙的交叉验证游戏。让我们想象一个名为“Leo”的细胞。我们想为它的 RNA 和蛋白质数据找到最优权重 $w_{R}(\text{Leo})$ 和 $w_{P}(\text{Leo})$。

1.  **定义邻域：** 首先，我们分别考察每个模态的数据。我们*仅*使用 Leo 的 RNA 图谱找到其 [k-最近邻](@entry_id:636754)，创建其“RNA 邻域”。然后，我们*仅*使用其蛋白质图谱做同样的操作，创建其“蛋白质邻域”。

2.  **进行预测游戏：** 现在开始测试。WNN 通过考察每个模态的邻域在多大程度上能预测 Leo 在*另一个*模态中的图谱，来评估该邻域的“质量”。
    -   它会问：通过平均其*蛋白质邻域*中细胞的 RNA 图谱，我能在多大程度上预测 Leo 的实际 RNA 图谱？这是一种**跨模态预测**。
    -   然后，它将此结果与**模态内预测**进行比较：通过平均其*RNA 邻域*中细胞的 RNA 图谱，我能在多大程度上预测 Leo 的 RNA 图谱？

这个逻辑非常简单：如果蛋白质数据对 Leo 真正具有[信息价值](@entry_id:185629)，那么它所识别出的邻居（蛋白质邻域）就应该是生物学上真正的邻居。如果它们是真正的邻居，那么它们不仅应该在[蛋白质表达](@entry_id:142703)上与 Leo 相似，在 RNA 表达上也应如此。因此，一个“好”的模态，其邻域结构应与另一模态的数据相一致。

该算法通过为每个模态计算一个分数来将此过程形式化。例如，对于 RNA 模态，会计算一个可靠性分数 $S_{R}(\text{Leo})$，如果模态内预测效果好，且跨模态预测（即从蛋白质邻域预测 RNA）效果也好，那么这个分数就会很高。这个分数[实质](@entry_id:149406)上衡量了两种数据类型之间的一致性。然后对这些分数进行归一化（通常使用 softmax 函数）以产生最终权重，确保它们的总和为 1 [@problem_id:2967175]。

$$
w_{R}(\text{Leo}) = \frac{\exp(S_{R}(\text{Leo}))}{\exp(S_{R}(\text{Leo})) + \exp(S_{P}(\text{Leo}))}
$$

### WNN 的实际应用：自动过滤噪声

在实际场景中，这种方法的真正威力就显现出来了。考虑一个分析免疫细胞的实验，我们拥有每个细胞的 RNA（基因表达）和 ATAC（[染色质可及性](@entry_id:163510)）数据。假设我们有一群活化的 T 细胞。在生物学上，这些细胞可能处于“[转录爆发](@entry_id:156205)”状态，此时它们的基因表达会变得暂时混乱且充满噪声。对于这些特定的细胞，RNA 模态是不可靠的——它就是那张模糊的照片。然而，[染色质可及性](@entry_id:163510)可能保持稳定，并且是细胞真实身份的更好指标 [@problem_id:2892390]。

WNN 会做什么呢？对于一个活化的 T 细胞，由于噪声的存在，它的 RNA 邻域将是一堆不相似细胞的混合体。基于这个邻域的任何预测都会很差。相比之下，它的 ATAC 邻域将是紧密且一致的。当 WNN 运行其预测游戏时，它会发现 ATAC 邻域远比 RNA 邻域更具预测性和一致性。结果是，它会自动地、局部地为*该 T 细胞*的 RNA 数据分配一个非常低的权重（$w_R \approx 0$），并为 ATAC 数据分配一个非常高的权重（$w_A \approx 1$）。在同一实验中，对于另一种两种模态都很干净的静息细胞类型，权重可能都接近 0.5。

这就是 WNN 的美妙之处：它充当了一个智能的、局部化的过滤器。它让数据自己说话，逐个细胞地决定信任哪个信息源。结果是一个单一、统一的**加权最近邻（WNN）图**。任意两个细胞 $i$ 和 $j$ 之间的相似性或亲和度（$\theta_{ij}$）是它们在每个模态中相似性的加权和，使用的是为细胞 $i$ 学到的权重：

$$
\theta_{ij} = w_{R}(i) a_{ij}^{(R)} + w_{A}(i) a_{ij}^{(A)}
$$

这个最终的图是对真实生物学景观远比单一模态或简单平均更稳健、更细致的表示。

### 全景图：从原始数据到生物学洞见

当然，这个精妙的算法只是一个更大流程中的一部分。它的成功关键取决于之前的步骤和之后的步骤。

**“垃圾进，垃圾出”：** WNN 只有在数据经过适当准备后才能发挥其魔力。例如，原始的单细胞 [RNA-seq](@entry_id:140811) 计数数据具有一种棘手的统计特性，称为**[异方差性](@entry_id:136378)**：噪声量取决于信号本身的水平。简单地对数据进行归一化和对数转换并不能完全解决这个问题。为了实现稳健的整合，我们需要使用更高级的、基于模型的归一化技术（如 `sctransform`），这些技术明确地考虑了数据的统计特性。这些方法将原始计数转换为表现良好的“残差”，其[方差](@entry_id:200758)稳定，并且像[测序深度](@entry_id:178191)这样的技术性人为因素也得到了适当的移除。这确保了我们为 WNN 提供了“干净的砖块”来建造它的房子，使得跨模态的比较公平且有意义 [@problem_id:3330207]。

**“对速度的需求”：** 从实践角度来看，通过比较每个细胞与所有其他细胞来构建 k-NN 图的计算成本与细胞数量成平方关系（$O(N^2)$）。对于一个包含一百万个细胞的数据集，这意味着超过一万亿次比较——这是一场计算噩梦。在实践中，我们几乎总是使用**近似最近邻（ANN）**算法。这些速度极快的算法找到的邻居不保证是绝对最近的，但以非常高的概率极其接近。这使得大规模图的构建成为可能，从而能够在当今常见的大规模数据集上进行 WNN 分析 [@problem_id:1465861]。

**“最终目标”：** 最后，重要的是要记住，WNN 图并非故事的终点。它是一个强大的中间数据结构。这个代表了细胞状态共识视图的整合图，可以用于更准确的下游任务。我们可以对其应用[社区发现](@entry_id:143791)算法，以更高的置信度发现细胞类型和亚型。或者，就像在探索绘制细胞复杂连接图谱的任务中一样，我们可以利用这个整合空间来推断**基因调控网络（GRN）**。通过在 WNN 图定义的干净的局部邻域内计算[转录因子](@entry_id:137860)与潜在靶基因之间的相关性，我们可以减少困扰此类分析的假阳性，从而更接近于对细胞的真实机理理解 [@problem_id:3314515]。

在 WNN 中，我们看到了统计理论和生物学直觉的美妙结合。它解决复杂的[数据融合](@entry_id:141454)问题，不是通过僵化、暴力的规则，而是通过一个灵活、智能、倾听数据的系统。它证明了这样一个理念：通过仔细定义和尊重数据的局部结构，我们可以揭示出复杂生物世界的一幅统一而深刻的图景。

