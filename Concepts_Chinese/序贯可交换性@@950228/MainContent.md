## 引言
在从观测数据中探寻因果关系的过程中，很少有挑战能比那些随时间展开的挑战更为复杂。当分析[序贯决策](@entry_id:145234)时，例如医生在多次就诊中调整患者的药物，我们会面临一个难题：时变混杂，即一个因素既是过去行为的结果，又是未来行为的原因。标准的统计调整方法可能会失效，非但不能消除偏倚，反而会引入偏倚。当治疗、患者状态和结局都处于不断变化之中时，我们如何得出可靠的因果结论？

本文介绍序贯[可交换性](@entry_id:263314)，这是一个为该问题提供严谨解决方案的基本原则。其核心思想是，在任何给定时刻，一旦我们考虑了全部已观测的历史信息，治疗选择就“等同于随机”。本文将通过两大章节引导您了解这一关键概念。在“原理与机制”中，我们将探讨序贯可交换性的理论基础，定义其含义、解释其必要性，并探讨如何评估其合理性。然后，在“应用与跨学科联系”中，我们将看到这一假设如何解锁一套强大的方法工具箱——如g-公式和逆概率加权——用于在从医学到公共政策等各个领域回答“如果……会怎样”的问题。

## 原理与机制

### 随时间变化的因果关系挑战

想象一下，你想回答一个简单的问题：一款新的健身应用真的能让人们更健康吗？一个简单的方法可能是比较该应用的用户和非用户。但你很快会发现，下载健身应用的人通常一开始就更注重健康。这两个群体不具可比性；它们不是**可交换的**。这个问题被称为**混杂**。为了得到有意义的答案，你需要进行同类比较：比较有积极性的应用使用者和同样有积极性的非使用者。

对于单个决策来说，这已经足够棘手了，但当故事随时间展开时会发生什么？考虑一位医生治疗像糖尿病这样的慢性病患者。在第一次就诊（$t=0$）时，医生看到患者的高血糖（$L_0$）并开出一种药物（$A_0$）。一个月后，患者复诊。他们的血糖（$L_1$）可能已经改变，部分原因是药物的作用。看到这个新的化验值，医生决定是继续用药还是调整剂量（$A_1$）。这个过程在每次就诊时都会重复。[@problem_id:4581119]

在这里，我们遇到了一个精妙的难题。第一个月的血糖测量值 $L_1$ 显然是当时决策 $A_1$ 的一个**混杂因素**。医生的决策依赖于它，并且它能预测患者的长期健康状况。然而，$L_1$ 也是在第零个月给予的治疗 $A_0$ 的一个**结果**。它正位于我们想要理解的因果路径之上！[@problem_id:4581117]

如果我们使用标准的统计方法，如[回归分析](@entry_id:165476)，并对所有随时间变化的血糖测量值进行“调整”，我们会引入一种虽然微妙但严重的偏倚。我们实际上是在告诉我们的模型，忽略初始治疗起作用的主要途径之一——即改变后续的血糖水平。这就像试图评判一位厨师的厨艺，却“校正”了他们食物的美味程度。你调整掉的恰恰是你想要测量的效应。这种混杂级联，即一个变量既是未来的混杂因素又是过去的结果，意味着我们需要一个远为复杂的理念。[@problem_id:4618688]

### “如同随机”的世界：序贯可交换性

那么，我们如何走出这个扑朔迷离的困境？我们必须做出一个大胆的假设。我们必须假设，在做出决策的*每一个时刻*，一旦我们考虑了截至该时间点的所有可用患者信息，该决策实际上就是随机的。这就是**序贯[可交换性](@entry_id:263314)**这一强大原则。

让我们用一个思想实验来说明。想象两个身处平行宇宙的相同患者。他们有相同的基因，相同的基线健康状况，并且到今天为止接受了完全相同的治疗序列，化验结果也完全相同。今天，在一个宇宙中，医生增加了剂量；在另一个宇宙中，医生没有。序贯可交换性就是这样一个假设：这个岔路口的选择并非由某个隐藏因素决定——比如病历页边未记录的笔记，或是关于哪个患者注定会有更好结局的临床直觉。它假设，所有驱动决策的信息都包含在已测量的历史中，表示为 $\bar{L}_t$（协变量如化验结果的历史）和 $\bar{A}_{t-1}$（过去治疗的历史）。

在形式上，我们用一个简洁而优雅的符号来表达这一点：
$$Y^{\bar{a}} \perp\!\!\!\perp A_t \mid \bar{L}_t, \bar{A}_{t-1}$$

这个公式表明，潜在结果 $Y^{\bar{a}}$（在*任何*假设的治疗方案 $\bar{a}$ 下会发生什么）与今天实际施行的治疗（$A_t$）在以观测到的过去（$\mid \bar{L}_t, \bar{A}_{t-1}$）为条件下是统计独立的（$\perp\!\!\!\perp$）。本质上，我们假设在每一步中，自然在分配当下的治疗时并没有偷看未来。只要我们勤勉地追踪了全部可观测的过去，那么在具有相同历史的患者组内，治疗的选择就“等同于随机”。[@problem_id:4971160] 不存在**未测量的混杂因素**。

### 一个无法检验的假设？科学侦探工作的艺术

这个“如同随机”的假设固然美妙，但它在现实中真的可信吗？在一个完美的**序贯随机试验**中，确实如此。在这样的研究中，计算机会根据患者的记录历史，按照预设的规则在每次就诊时做出治疗决策。在这种理想化的情境下，我们知道序贯[可交换性](@entry_id:263314)是依据设计成立的，因为规则是我们自己写的，不存在秘密因素。[@problem_id:4616149]

然而，科学研究很少在如此纯净的环境中展开。在观测数据（如来自电子健康记录的信息）的混乱现实中，序贯[可交换性](@entry_id:263314)并非理所当然，而是一种信念之跃。一位治疗严重肺病患者的医生，可能不仅根据病历中测量的血氧饱和度来升级治疗，还可能基于对患者“[呼吸功](@entry_id:149347)”的视觉“整体印象”——一种患者“看起来就是不对劲”的直觉。[@problem_id:4545111] 这种直觉是结果的有力预测因素，并且直接影响治疗决策。它是一个未测量的混杂因素，其存在本身就可能破坏我们假设的有效性。[@problem_id:4616149]

那么，我们是否注定要被不确定性所束缚？完全不是。这正是科学艺术的真正开端。如果我们不能盲目相信我们的假设，我们可以做两件事：让它变得更合理，或者积极寻找其基础上的裂痕。

首先，我们可以努力将未测量的变为*已测量的*。如果我们怀疑医生利用患者的“[呼吸功](@entry_id:149347)”来做决策，那么一个设计良好的研究就应该引入一个标准化的量表来精确测量它。通过系统地收集这些代表临床直觉的代理变量数据，我们将这些因素从阴影中拉出，纳入我们的记录历史 $\bar{L}_t$。这并不能消除对该假设的需求，但使其变得远为合理。[@problem_id:4971138] [@problem_id:4545111]

其次，我们可以用**阴性对照**来进行侦探工作。假设我们想检查我们对混杂的统计调整是否真正起作用。我们可以选择一个我们确信*不*由该治疗引起，但很可能由相同混杂因素引起的次要结局。例如，患者明年是否需要常规洗牙，可能与他们今天服用的心脏病药物无关，但两者都与他们的整体健康状况和责任心有关。在我们应用统计权重创建一个 supposedly 消除了混杂的“伪人群”后，我们检查：心脏病药物是否仍然“导致”了洗牙次数的变化？如果答案是肯定的，我们的警钟就应该敲响！我们的调整肯定不完整；残余混杂仍然存在。在阴性对照上发现零效应并不能证明我们的假设是正确的，但发现非零效应则提供了强有力的证据表明它是错误的。对于一个无法检验的假设来说，这是一种至关重要的证伪检验。[@problem_id:4971138]

### 可识别性的三大支柱

序贯[可交换性](@entry_id:263314)是主角，但它无法独角戏。要从观测世界稳固地搭建一座通往因果世界的桥梁，它需要另外两大支柱的支撑。[@problem_id:4980933] [@problem_id:5209121]

1.  **一致性 (Consistency)**：这一支柱将[潜在结果](@entry_id:753644)的假设世界与观测数据的现实世界联系起来。它只是简单地假设，如果观察到某人遵循了某个特定的治疗路径，我们看到的结局就是与该路径相对应的那个结局。这是确保我们的测量和定义是连贯的基本假设。

2.  **正值性 (Positivity)**：这是“任何事情都有可能发生”的支柱。它要求对于我们观察到的任何类型的患者历史，他们接受任何一种治疗方案的可能性都必须非零。如果医生*总是*给最病重的患者使用救命药，而*从不*给病情较轻的患者使用，那么我们永远无法从数据中得知一个病重患者如果*没有*得到该药会发生什么。在那个反事实的宇宙角落里，根本没有任何信息。

这三个假设——**序贯可交换性、一致性和正值性**——共同构成了逻辑基础，使我们能够使用仅仅记录“发生了什么”的数据来提问“如果……会怎样”的问题。这证明了通过严谨的推理，在我们这个复杂世界中，从噪声中找到清晰信号的强大力量。

