## 引言
哪些整数可以写成两个平方数之和，是数论中一个典型的、彰显数学之美的问题。它始于一个简单的算术谜题，但很快揭示了素数、模算术和[复平面](@article_id:318633)之间的深刻联系。虽然初步的观察可以排除某些数，例如那些除以4余3的数，但这个检验并不完备，未能捕捉到全貌。完整的答案需要一次深刻的视角转变，从我们熟悉的整数世界转向结构更丰富的[高斯整数](@article_id:309967)世界。

本文将引导您完成这段引人入胜的旅程。在第一章“原理与机制”中，我们将揭示判断一个数是否为两数平方和的完整法则，并利用[高斯整数](@article_id:309967)及其独特的分解性质从头开始建立理论。随后，“应用与跨学科联系”一章将探讨该定理令人惊讶且影响深远的用途，展示它如何为现代计算提供工具，帮助解决其他数论问题，甚至描述量子力学中的物理现象并保障密码学中的数据安全。

## 原理与机制

数学中最美妙的一些思想，是那些能够连接看似无关的领域、揭示其背后隐藏统一性的思想。哪些数可以写成两个整数[平方和](@article_id:321453)的问题就是一个完美的例子。这个最初只是一个简单算术好奇心的问题——我能把5写成 $a^2+b^2$ 吗？可以，$1^2+2^2$。那7呢？不行，无论你怎么尝试——最终展开成一个涉及素数、模算术以及进入复数世界的壮丽叙事。

### 最初的线索：模4测试

让我们像任何优秀的科学家一样，从摆弄数字和寻找规律开始我们的研究。我们想知道哪些整数 $n$ 可以表示为 $n = a^2 + b^2$。

这里的基本构成要素是什么？是平方数。让我们看看它们的行为。任何整数不是偶数就是奇数。
- 如果一个数 $x$ 是偶数，比如说 $x=2k$，它的平方是 $x^2 = (2k)^2 = 4k^2$。这是一个4的倍数。
- 如果一个数 $x$ 是奇数，比如说 $x=2k+1$，它的平方是 $x^2 = (2k+1)^2 = 4k^2+4k+1 = 4(k^2+k)+1$。这个数除以4余1。

用模算术的语言来说，这意味着任何完全平方数模4[同余](@article_id:336894)于0或1。
$$x^2 \equiv 0 \pmod{4} \quad \text{or} \quad x^2 \equiv 1 \pmod{4}$$

那么，两个平方数之和 $a^2+b^2$ 呢？我们可以检查它们除以4可能得到的余数：
- 如果 $a$ 和 $b$ 都是偶数，则 $a^2+b^2 \equiv 0+0 \equiv 0 \pmod{4}$。
- 如果一个是偶数一个是奇数，则 $a^2+b^2 \equiv 0+1 \equiv 1 \pmod{4}$。
- 如果两者都是奇数，则 $a^2+b^2 \equiv 1+1 \equiv 2 \pmod{4}$。

看看少了什么！没有任何平方数的组合相加后模4同余于3。这给了我们一个强大而简单的规则：**一个整数如果除以4余3，那么它永远不能被写成两个平方数之和** [@problem_id:1788976] [@problem_id:1829618]。

这是极好的一步。我们可以立即排除无限多个数：3、7、11、15、19、23，等等。例如，如果你被问到199是否可以写成两个平方数之和，你不需要检查每一种可能性。你只需注意到 $199 = 4 \times 49 + 3$，所以它的余数是3，答案是确定无疑的“否” [@problem_id:1829618]。

但这就是全部了吗？如果一个数模4不同余于3，它就*总是*两个平方数之和吗？让我们来检验一下。数字6除以4余2。它是两个平方数之和吗？$1^2+1^2=2$， $1^2+2^2=5$， $2^2+2^2=8$。不是。数字21除以4余1。它是两个平方数之和吗？不是。我们简单的测试是一个必要条件，但不是充分条件。这背后还有一个更深层次的结构。

### 解谜的关键：通往新世界的旅程

为了找到完整的答案，我们必须进行一次想象力的飞跃，这个飞跃曾困扰了数学家们几个世纪，直到伟大的 Carl Friedrich Gauss 提供了钥匙。表达式 $a^2+b^2$ 对于任何接触过复数的人来说应该都很熟悉。它是复数 $z=a+bi$ 的模长的平方，也就是**范数**。

让我们定义一个新的数集，我们称之为**[高斯整数](@article_id:309967)**，记作 $\mathbb{Z}[i]$。它们就是实部和虚部都是整数的复数： $\{a+bi \mid a,b \in \mathbb{Z}\}$ [@problem_id:2226952]。这个集合表现得非常优美；你可以对[高斯整数](@article_id:309967)进行加、减、乘运算，结果总会是另一个高斯整数。它构成了一个数学家称之为**环**的结构。

对于任何[高斯整数](@article_id:309967) $\alpha = a+bi$，其范数为 $N(\alpha) = a^2+b^2$。我们最初的问题“哪些整数 $n$ 是两个平方数之和？”现在可以在这个新世界中重新表述为：**“哪些整数 $n$ 是某个[高斯整数的范数](@article_id:315830)？”**

这似乎只是语言上的改变，但它是一种深刻的视角转变。它允许我们在这个新领域使用因式分解和素数的强大工具。

### [平方和](@article_id:321453)的乘法性质

范数最优雅的性质之一是它的**可乘性**：对于任意两个[高斯整数](@article_id:309967) $\alpha$ 和 $\beta$，它们乘积的范数等于它们范数的乘积。
$$N(\alpha\beta) = N(\alpha)N(\beta)$$

让我们看看这意味着什么。假设我们有两个数 $m$ 和 $n$，它们各自都是两个平方数之和。用我们的新语言来说，这意味着 $m=N(\alpha)$ 和 $n=N(\beta)$，其中 $\alpha=a+bi$ 和 $\beta=c+di$ 是某个高斯整数。那么乘积 $mn$ 就是：
$$mn = N(\alpha)N(\beta) = N(\alpha\beta)$$
由于 $\alpha\beta$ 只是另一个高斯整数，它的范数也必然是两个平方数之和！让我们来计算乘积 $\alpha\beta$：
$$\alpha\beta = (a+bi)(c+di) = (ac-bd) + i(ad+bc)$$
这个乘积的范数是：
$$N(\alpha\beta) = (ac-bd)^2 + (ad+bc)^2$$
所以我们发现 $mn = (ac-bd)^2 + (ad+bc)^2$。这个被称为**[婆罗摩笈多-斐波那契恒等式](@article_id:638192)**的奇妙公式表明，可以写成两个平方数之和的数集在乘法下是封闭的 [@problem_id:3089701]。例如，由于 $5=1^2+2^2$ 和 $13=2^2+3^2$ 都是两数平方和，它们的乘积 $65$ 也必定是。使用公式，令 $a=1, b=2, c=2, d=3$，我们得到 $65 = (1\cdot2-2\cdot3)^2 + (1\cdot3+2\cdot2)^2 = (-4)^2+7^2 = 16+49=65$。

这个性质非常强大。它告诉我们，要理解哪些合数是两数[平方和](@article_id:321453)，我们首先需要理解其基本构成部分：素数。

### 素数的三种命运

就像我们可以将整数12分解为其素因子 $2^2 \times 3$ 一样，我们也可以将高斯整数分解为**[高斯素数](@article_id:317176)**。[高斯素数](@article_id:317176)是指不能分解为两个非单位高斯整数之积的高斯整数。（单位元仅为 $\{\pm 1, \pm i\}$，即范数为1的数 [@problem_id:3021530]）。

我们整个谜题的关键在于，当我们把一个来自 $\mathbb{Z}$ 的普通素数放到 $\mathbb{Z}[i]$ 的世界里看待时，它会发生什么。事实证明，一个有理素数会面临三种命运之一 [@problem_id:3088492] [@problem_id:3089682]：

1.  **分歧（素数2的情况）：** 素数2是特殊的。在 $\mathbb{Z}[i]$ 中，它分解为 $2 = (1+i)(1-i)$。由于 $1-i = -i(1+i)$，这两个因子本质上是相同的（它们是相伴元）。数字2“分歧”成一个平方素因子（在单位元意义下）。这个分解立即给出了它作为两数[平方和](@article_id:321453)的表示：$N(1+i) = 1^2+1^2=2$。

2.  **分裂（形如 $4k+1$ 的素数）：** 形如 $4k+1$ 的素数 $p$（如5、13、17、29）在[高斯整数](@article_id:309967)中总是不再是素数。它会**分裂**成两个不同的、[共轭](@article_id:312168)的[高斯素数](@article_id:317176)之积：$p = \pi \cdot \overline{\pi}$。例如：
    - $5 = (2+i)(2-i)$
    - $13 = (3+2i)(3-2i)$
    如果我们对这个方程取范数，我们得到 $N(p) = p^2 = N(\pi) N(\overline{\pi})$。由于[高斯素数](@article_id:317176) $\pi = a+bi$ 的范数必须大于1，且 $N(\pi) = N(\overline{\pi}) = a^2+b^2$，这迫使 $N(\pi)=p$。答案就在这里！在 $\mathbb{Z}[i]$ 中分裂这个行为本身就意味着该素数是某个[高斯整数的范数](@article_id:315830)，因此 $p = a^2+b^2$ [@problem_id:2226952]。这种情况当且仅当 $p \equiv 1 \pmod 4$ 时发生。

3.  **惰性（形如 $4k+3$ 的素数）：** 形如 $4k+3$ 的素数 $p$（如3、7、11、19）保持**惰性**。它在 $\mathbb{Z}[i]$ 中不分解；在这个新世界里它仍然是素数。如果这样一个素数是两数[平方和](@article_id:321453)，比如说 $p=a^2+b^2$，那么它必须能分解为 $p=(a+bi)(a-bi)$，这与其惰性相矛盾。这就为我们最初通过模4测试观察到的规律提供了深刻的、结构性的原因。

### 完整的图景：费马定理

我们现在可以将所有部分组合起来，陈述完整而优美的平方和定理 [@problem_id:3081207] [@problem_id:3090028]。

一个正整数 $n$ 可以写成两个平方数之和，当且仅当在其素数分解中，**每个形如 $4k+3$ 的素数因子都以偶数次幂出现**。

让我们看看为什么这必须是真的。假设一个整数 $n$ 可以写成两个平方数之和，即 $n = a^2+b^2$。在[高斯整数环](@article_id:310013)中，这表示为 $n = (a+bi)(a-bi)$。设 $q$ 是 $n$ 的一个形如 $4k+3$ 的素数因子。正如我们所见，这样的素数是*惰性*的——它们在 $\mathbb{Z}[i]$ 中仍然是素数。由于 $q$ 整除乘积 $(a+bi)(a-bi)$ 并且它本身是一个[高斯素数](@article_id:317176)，它必须整除其中一个因子。假设 $q$ 整除 $a+bi$。这意味着存在某个高斯整数 $c+di$，使得 $a+bi = q(c+di)$。因此，$a=qc$ 且 $b=qd$。这表明 $q$ 必须同时整除 $a$ 和 $b$。因此，$q^2$ 必须同时整除 $a^2$ 和 $b^2$，所以 $q^2$ 必须整除它们的和 $n = a^2+b^2$。然后我们可以写出 $n/q^2 = (a/q)^2+(b/q)^2$，这是一个更小的、同样是两数[平方和](@article_id:321453)的数。我们可以重复这个论证，不断除以 $q^2$ 的因子，直到 $q$ 的因子不再存在。这意味着，如果我们从 $n$ 的[素数分解](@article_id:377406)开始，任何形如 $4k+3$ 的素因子 $q$ 都必须成对出现，因此它的总指数必须是偶数 [@problem_id:3089682]。

2和形如 $4k+1$ 的素数的指数可以是任意的。它们本身已经是两数[平方和](@article_id:321453)，并且由于[婆罗摩笈多-斐波那契恒等式](@article_id:638192)，它们的乘积也是。

让我们用我们之前的[反例](@article_id:309079)来检验一下，$n=6=2 \times 3$。素因子3是形如 $4k+3$ 的，它的指数是1（奇数）。所以6不能是两数平方和。那 $n=18=2 \times 3^2$ 呢？这里，素数3以指数2（偶数）出现。该定理预测它*是*一个两数平方和，事实也确实如此：$18 = 3^2+3^2$。

这个定理不仅仅是一条规则；它是通往数字深层结构的一扇窗。两个平方相加这个简单问题，将我们引向一个隐藏的[高斯整数](@article_id:309967)世界，在那里，素数的行为以一种既令人惊讶又具有深刻逻辑性的方式揭示了答案。从一个简单的模式到一个深刻的结构性解释的旅程，正是数学之美的精髓所在。值得注意的是，这些表示的性质并非随机。对于一个素数 $p \equiv 1 \pmod 4$，它作为两数平方和的表示在本质上是唯一的 [@problem_id:3021530]。将任何整数 $n$ 写成两数平方和的方法数，可以通过一个涉及其因数的公式精确计算出来——这证明了整数内部隐藏着惊人的秩序 [@problem_id:3090051]。

