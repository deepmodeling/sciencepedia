## 引言
电子健康记录（EHR）已经从简单的数字[文件系统](@entry_id:749324)转变为庞大的真实世界患者数据宝库，为医学研究带来了巨大的希望。然而，这一希望也伴随着一个重大挑战：EHR数据是为临床护理而非[对照实验](@entry_id:144738)而收集的。这在可用的原始、混乱的信息与推动医学进步所需的严谨、可靠的证据之间造成了根本性的差距。本文旨在引导读者跨越这一差距。文章首先为EHR数据分析的“原则与机制”奠定坚实的基础，探讨这种“现成数据”的性质，以及必须应对的关键偏倚和时间复杂性。随后，“应用与跨学科联系”部分展示了研究人员如何在遵循这些原则的前提下，利用EHR数据揭示疾病的隐藏结构、确保医疗安全，并构建未来的学习型健康系统。要开启这段旅程，我们必须首先理解EHR数据这个独特的领域及其支配规则。

## 原则与机制

涉足电子健康记录（EHR）数据分析领域，就像踏上了一段与传统实验室科学家截然不同的旅程。实验室科学家设计实验，仔细控制每一个变量，从而创造出为单一目的而生的纯净数据集。而我们，则更像是天文学家或[地质学](@entry_id:142210)家。我们无法创造我们所在的宇宙；我们只能观察这个存在的世界，及其所有美丽而令人困惑的复杂性。我们的数据不是“制造”的，而是“现成”的。它是医疗保健这个混乱、复杂且充满人性的过程的数字回声。

理解EHR数据分析的原则与机制，就是要学会倾听这些回声，区分信号与噪声，并领悟到最深刻的见解往往来自于理解数据为何呈现出其特有样貌的原因。

### 从患者护理到可推广的知识

EHR数据的核心是**真实世界数据（RWD）**——即并非为研究目的，而是为了照顾病人这一主要目的而收集的关于患者健康和医疗服务的信息。这包括从医生的录入笔记和实验室结果到计费代码和处方的一切内容[@problem_id:5056805]。我们的目标是将这些原始、混乱的RWD转化为**真实世界证据（RWE）**：即能够为我们的决策提供信息的、关于医疗产品风险和益处的临床证据。可以这样想：RWD是从山中挖出的未经处理的原始矿石；RWE则是从中锻造出的闪亮、纯净的钢材，随时可以用来建造坚固可靠的东西。

这种从“主要用途”（患者护理）到“次要用途”（研究）的转变，不仅是一个技术挑战，也是一个伦理和法律挑战。这些数据关乎人们的生命。美国的《健康保险流通与责任法案》（HIPAA）和欧洲的《通用数据保护条例》（GDPR）等法规为如何使用这些信息提供了严格的框架[@problem_id:4853633]。研究并非可以为所欲为。通常，研究要求数据被去除标识符。根据美国《通用规则》等法规，一项活动只有在涉及与人互动或使用其*可识别*的私人信息时，才被视为**人类受试者研究**。如果数据在研究者接收之前由“诚实代理人”妥善地进行了去标识化处理，那么该活动甚至可能根本不被视为人类受试者研究，从而免除某些监管要求。对于使用可识别数据的研究，一套复杂的规则、豁免和弃权条款规制着其使用，始终在追求知识与保护患者隐私和福祉的首要责任之间寻求平衡[@problem_id:4414048]。

### 解读言外之意

EHR中大量的宝贵信息埋藏在非结构化文本中——即医生记录其想法、观察以及与患者对话的临床笔记。我们如何将这种人类叙事转化为科学数据？这个过程称为**表型分析**，其任务是识别哪些患者患有特定的疾病或状况。

想象一下，我们想找到患[有心力](@entry_id:267832)衰竭的患者。我们不能只搜索“心力衰竭”这个词。一份笔记可能会说：“评估：慢性心力衰竭，既往有加重史”，这是一个阳性病例。但也可能说：“今日患者否认有呼吸困难或端坐呼吸”，这是对症状的*否定性*提及。或者，“如果液体状态恶化，将考虑增加利尿剂”，这是一个*假设性*陈述。我们不仅需要理解词语本身，还需要理解它们的上下文、**否定**和**时间性**[@problem_id:4862795]。

为了解决这个问题，我们采用**自然语言处理（NLP）**技术，而我们的工具也随着时间的推移变得异常复杂：
- **基于规则的系统**就像一个一丝不苟但刻板的语法学家。我们手工制定规则：“如果你看到‘心力衰患’，但其前面有‘否认’或‘无证据表明’，则将其标记为阴性。”这些系统透明而精确，但它们很脆弱；一个新的措辞或一个拼写错误都可能使其失效。
- **[统计模型](@entry_id:755400)**更像一个通过范例学习的学徒。我们向模型展示成千上万由人类专家标记的笔记，它会学习预测特定标签的统计模式——即特征。
- **基于Transformer的模型**，一种革命性的深度学习方法，是现代的能工巧匠。它们学习对语言的深层、情境化理解。它们不只是看单个词语，而是使用一种名为“[自注意力](@entry_id:635960)”的机制来权衡句子中所有其他词语的重要性，无论它们相距多远。这使得它们能够以一种开始类似于人类直觉的方式掌握细微差别、句法和语义[@problem_-id:4862795]。

通过这些机制，我们将临床笔记中丰富、主观的图景转化为科学探究所需的结构化、客观的事实。

### 因果关系的幽灵：现成数据中的偏倚

如果说第一个挑战是读取数据，那么第二个、也是更深层次的挑战就是信任数据。因为EHR数据是医疗护理的副产品，它充满了可能导致粗心分析师得出完全错误结论的偏倚。数据收集的模式会制造假象，而我们的主要工作就是成为打破这些假象的大师。

#### 缺失之谜

在EHR数据中，你首先会注意到的事情之一就是它充满了漏洞。一个病人在周二有血压读数，但周三没有。一项化验为一个病人开了，但另一个病人没有。为什么？缺失的原因很少是随机的，这种“信息性缺失”是一个关键线索。统计学家将缺失分为一个具有优美精确性的分类体系[@problem_id:4557788]：
- **[完全随机缺失](@entry_id:170286)（MCAR）：** 一份血样不小心掉在了地上。缺失与患者或其健康状况无关。这种情况很少见。
- **[随机缺失](@entry_id:168632)（MAR）：** 一个健康的患者没有接受某项癌症标志物检测，因为他们没有风险因素。数据缺失的原因可以由我们*确实*拥有的其他信息（患者的健康状况、年龄等）来解释。这是一个我们通常可以在统计上纠正的问题。
- **[非随机缺失](@entry_id:163489)（MNAR）：** 一个患有严重酒精中毒的患者错过了他们的肝功能测试，因为他们醉得太厉害没能来诊所。数据缺失的原因与测试本身可能的值有关。这是最危险的缺失形式，因为数据的缺失本身就是一条强有力的信息。

这里的微妙之处在于，MAR和MNAR之间的界线常常被**潜变量**——那些我们无法测量的东西，比如患者的整体“健康状况”或“衰弱”程度——所模糊。一个生物标志物可能在诊所就诊次数较少的患者中更常缺失。我们可以测量就诊频率，所以这看起来像一个MAR问题。但他们为什么就诊次数较少？也许是因为他们更健康。同时，他们真实的生物标志物水平也与这种潜在的健康状况有关。因此，一个未被测量的潜在健康状况同时驱动着生物标志物的值及其测量频率。因为我们无法完美测量这个潜在的健康状况，相对于我们拥有的数据，这种缺失就变成了MNAR，构成了巨大的挑战[@problem_id:4584875]。

#### 关联的陷阱

即使数据存在，其解释也是一个雷区。我们在寻找因果关系，但数据只向我们展示相关性，而相关性背后的原因却极其巧妙。
- **混杂：** 想象一项分析发现，服用某种胃灼热药物（质子泵抑制剂，即PPI）的人患肾病的风险更高。是这种药导致肾损伤吗？也许。但医生经常给同时服用NSAIDs（如布洛芬）的患者开PPI，以保护他们的胃。而NSAIDs是众所周知的对肾脏有损害的药物。所以，使用NSAID是PPI处方和肾脏疾病的一个共同原因——一个**混杂因素**。PPI与结果相关联，仅仅因为它与真正的罪魁祸首是同行者[@problem_id:4853665]。这就是“适应症混杂”——开药的原因本身就与结果纠缠在一起。
- **反向因果：** 有时因果关系的箭头指向相反的方向。一项药物处方与一个疾病诊断之间发现了强相关性。简单的结论是药物导致了疾病。但如果正是疾病的早期、微妙的症状（“前驱症状”）促使医生开出这种药物呢？疾病在其潜伏状态下导致了处方，而不是反过来。这种特定的反向因果形式被称为“初始性偏倚”，是EHR分析中的一个经典陷阱[@problem_id:2382988]。
- **选择偏倚和[对撞偏倚](@entry_id:163186)：** 这可能是最精妙和最不直观的偏倚。假设你正在研究某种药物（$X$）是否会导致某种疾病（$Y$）。你的研究队列仅限于接受过特定诊断测试的患者。但开具该测试的决定并非随机。医生可能会因为患者正在服用药物$X$（他们想监测副作用）*并且*因为患者有一些患疾病$Y$的潜在风险因素而开具该测试。测试本身就是一个“对撞因子”，一个由另外两件事引起的事件。通过只选择那些接受了测试的患者，你正在对这个对撞因子进行条件化。这一行为在药物和疾病之间创造了一种在总人口中并不存在的虚假[统计关联](@entry_id:172897)。这就像试图通过只研究电影明星来理解表演天赋和美貌之间的关系；你可能会得出它们负相关的结论，因为要成为明星，你需要其中之一，但不一定两者都需要。将你的视野局限于一个选定的群体，会扭曲你试图理解的现实本身[@problem_id:4853665]。

### 展开的故事：时间中的数据

与简单的调查不同，EHR是一个跨越数年展开的故事。这个时间维度是其最大的优势之一，也是其独特挑战的来源。
- **观察窗口：** 我们对患者故事的看法通常是不完整的。我们可能会有**右删失**，即患者离开医疗系统或研究在我们在看到感兴趣的结果之前结束；我们知道事件*尚未*发生，但我们不知道它何时会发生。我们可能会有**左截断**（或延迟进入），即我们只招募那些在诊断后无事件存活了一段时间的患者，系统性地排除了那些早期发生事件的患者。我们还经常有**[区间删失](@entry_id:636589)**，即我们知道一个事件发生在两次门诊之间，但我们不知道确切的日期[@problem_id:4858822]。
- **日历时间的流沙：** 世界在变，这些变化被印刻在数据中。一项多年的分析可能会被与所关注的生物学无关的时间趋势严重误导。存在缓慢的**长期趋势**（例如，新公共卫生指南的引入）、可预测的**季节性**（冬季流感高峰），以及最引人注目的，行政上的**编码实践漂移**。美国在2015年从ICD-9编码系统过渡到ICD-10编码系统，在数据中造成了巨大的“冲击”。一夜之间，许多疾病的记录率似乎暴跌或飙升，不是因为突然的瘟疫或奇迹般的治愈，而仅仅是因为记账方式改变了。一个将时间视为简单线性趋势的朴[素模型](@entry_id:155161)会被这些复杂的时间模式完全愚弄，导致有偏倚的结果[@problem_id:4858840]。

### 通往可信证据之路

面对这个迷宫般的挑战，我们该如何前进？我们怀着对数据来源的深刻尊重和对严谨、透明方法的承诺来前进。为了产生可信赖的RWE，我们的分析必须具有**完整性**（我们解释了缺失的部分）、**可追溯性**（我们记录每一步）和**可审计性**（一个独立的人可以复制我们的工作）[@problem_id:5056805]。

我们开发复杂的统计工具来对抗偏倚。例如，为了处理依赖于观察到的患者特征的缺失数据，我们可以使用**逆概率加权（IPW）**。这种技术给予那些被观察到但被测量可能性较小的患者更大的权重——一个更响亮的声音——从而有效地重构出完整的、无偏倚的样本本来的样子[@problem_id:4584875]。

分析EHR数据不是一个简单的计算行为。它是一种解释行为，一种科学侦探工作。它要求我们同时像临床医生、流行病学家和计算机科学家一样思考。其美妙之处在于谜题本身。通过理解塑造这些数据的机制，我们可以驾驭其陷阱，解锁数百万患者的集体经验，将日常护理的数字回声转化为能够治愈的知识。

