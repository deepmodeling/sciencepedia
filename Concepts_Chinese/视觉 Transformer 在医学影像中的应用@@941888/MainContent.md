## 引言
在医学计算机视觉领域，一种新的架构已经出现，它挑战了数十年来既定的实践，并有望以一种全新的方式“看见”疾病。视觉 Transformer (ViT) 代表了一种范式转变，超越了传统模型的局部化、逐步分析的方式。这一转变为一个关键的知识空白提供了解决方案：传统网络（如 CNN）无法有效掌握医学图像中的全局上下文和长距离依赖关系，而这些对于准确诊断往往至关重要。本文将引导您了解这项革命性技术，揭示其内部工作原理，并展示其变革性的影响。

首先，我们将深入探讨视觉 Transformer 的核心“原理与机制”，解释它如何将图像解构为图像块，并利用[自注意力](@entry_id:635960)的力量建立整体性理解。随后，在“应用与跨学科联系”部分，我们将踏上数字化诊所之旅，见证 ViT 如何被应用于解决病理学、放射学及其他领域的实际问题，同时直面信任和[可复现性](@entry_id:151299)等关键挑战。

## 原理与机制

要理解视觉 Transformer 带来的革命，我们必须首先提出一个基本问题：计算机是如何*看见*的？几十年来，主流答案来自卷积神经网络 (CNN)，它模仿了生物视觉的一个简化方面。它们就像耐心的侦探，用一个小放大镜扫描图像，识别局部模式——这里一条边，那里一种纹理——然后逐层慢慢拼凑出更大的画面。这种方法很强大，但它有一个内在的假设：最重要的是局部。而视觉 Transformer，即 ViT，提出了一种截然不同的哲学。

### 将世界看作碎片：从像素到图像块

想象一下，一张医学图像不是一块连续的画布，而是一幅马赛克。视觉 Transformer 做的第一件事就是将图像分解成一个由小的、不重叠的图像块组成的网格。例如，一张标准的 $256 \times 256$ 像素图像可能会被分割成一个 $16 \times 16$ 的图像块网格，其中每个图像块都是一个微小的 $16 \times 16$ 像素方块。这样我们就得到了 $16 \times 16 = 256$ 个独立的瓦片 [@problem_id:4834552]。同样的逻辑可以完美地扩展到医学扫描的三维世界；一个体积 CT 或 MRI 可以被切成一组小立方体。

然后，每个图像块都被展平为一个长长的像素值单向量，并通过一个学习到的线性投影，转换为一个特征丰富的向量，称为**令牌 (token)**。这个过程称为**令牌化 (tokenization)**，它将像素的空间网格转换为一个简单的令牌序列——可以说是一份成分列表。对于一个大小为 $D \times H \times W$、拥有 $C$ 个通道的三维体数据，若将其分割为大小为 $p \times p \times p$ 的图像块，我们将得到一个包含 $\frac{DHW}{p^3}$ 个令牌的序列。通常，一个额外的、特殊的**分类令牌 (classification token)** 会被添加到这个序列中，作为整个图像的代表，模型可以用它来进行最终预测 [@problem_id:4529569]。

这个令牌序列才是 Transformer 核心引擎——[注意力机制](@entry_id:636429)——实际“看到”的东西。图像的空间性暂时被抛弃了。我们剩下的只是一个简单的、一维的丰富描述符列表。

### 健忘的天才：为何位置就是一切

在这里，我们遇到了一个深奥的难题。Transformer 的核心——**[自注意力](@entry_id:635960)**机制——是一项天才之作。它可以权衡序列中每个令牌相对于其他所有令牌的重要性，从而捕捉复杂、长距离的关系。但它有一个致命的缺陷：其本身是**置换不变 (permutation-invariant)** 的。这意味着它将令牌序列视为一个“令牌袋”，而不是一个有序的网格。如果你在输入前打乱图像块的顺序，[自注意力机制](@entry_id:638063)在没有任何帮助的情况下将一无所知。它就像一个健忘的艺术史学家，可以分析一个破碎花瓶每一块碎片的风格，却不记得每块碎片属于哪里 [@problem_id:5228680]。

为了重新组装这个花瓶，我们这位健忘的天才需要一张“小抄”。这就是**位置编码 (positional encodings)** 的作用。在令牌进入[注意力机制](@entry_id:636429)之前，我们为每个令牌添加一个独特的[数字签名](@entry_id:269311)，该签名编码了它在图像网格中的原始位置。现在，来自左上角的图像块与来自右下角的相同图像块将拥有不同的最终嵌入。模型不再是置换不变的；它现在对图像块的空间排列变得敏感 [@problem_id:4615190]。

当我们面对医学影像的现实时，这个概念会变得更加深刻。一个简单的网格位置可能还不够。医学扫描通常具有可变的分辨率；单个像素所代表的物理距离在不同扫描之间可能会变化。一个与像素网格绑定的天真位置编码会感到困惑——一个 5 毫米的肿瘤在一张扫描中可能跨越 10 个像素，但在另一张扫描中可能跨越 20 个像素，从而接收到完全不同的位置信号。真正优雅的解决方案是，位置编码不基于像素索引，而是基于毫米为单位的*物理坐标*，这些坐标通常可以在图像的[元数据](@entry_id:275500)（如 DICOM 头文件）中找到。这样，模型就学习到了物理空间的表示。无论[数字采样](@entry_id:140476)网格如何，5 毫米的距离都对应于一个一致的位置差异。这为模型注入了一种几何直觉，防止了“错位伪影”，并使其在不同扫描仪和成像协议下都具有鲁棒性 [@problem_id:4615290]。这可以通过定义在物理空间上的连续函数（如正弦函数）或依赖于图像块之间物理距离的相对位置偏置来实现 [@problem_id:4615290]。

### 两种视觉哲学：局部主义者与全局主义者

CNN 和 ViT 处理空间信息的不同方式代表了两种截然不同的视觉哲学，每种都有其自身的优缺点。

**CNN** 是一个坚定的**局部主义者**。其核心操作——卷积——使用小的内核（例如 $3 \times 3$）在图像上滑动，充当可训练的模式检测器。这种设计硬编码了一种强大的**[归纳偏置](@entry_id:137419)**，即**局部性**（假设相邻像素最重要）和**[平移等变性](@entry_id:636340)**（假设一个模式的含义与其位置无关）。这种内置的知识使得 CNN 的数据效率非常高。对于一个标签数据有限的任务，比如仅用 80 张 MRI 扫描来分割脑肿瘤，这种强大的先验知识是救命稻草。模型不需要从头学习局部性的基本规则，这使得它不易[过拟合](@entry_id:139093)，并且对定义肿瘤边界的局部纹理和边缘更为敏感 [@problem_id:5184434] [@problem_id:4615190]。

相比之下，**ViT** 是一个**全局主义者**。它的[自注意力机制](@entry_id:638063)从第一层就赋予了它**全局[感受野](@entry_id:636171)**。每个图像块令牌都可以直接关注其他任何图像块令牌，使模型能够立即发现图像遥远部分之间的关系。对于长距离上下文至关重要的任务来说，这是一个巨大的优势。例如，诊断胸部 X 光片，可能需要比较左右肺的对称性；或者对一张巨大的全切片病理图像进行分类，其中几个分散的癌细胞就能决定诊断结果 [@problem_id:5228680] [@problem_id:5184434]。CNN 需要堆叠许多层才能建立一个足够大的[感受野](@entry_id:636171)来同时看到两个区域，而 ViT 只需一步即可完成。这种灵活性的代价是较弱的[归纳偏置](@entry_id:137419)。ViT 必须从数据中学习局部性的重要性，这使得它比 CNN 更“耗费数据”。

### 两全其美：混合架构

这种[二分法](@entry_id:140816)引出了一个问题：我们为什么必须选择其一？最有效的解决方案往往在于综合。**混合架构**旨在通过将 CNN“主干”与 Transformer“主体”相结合，来集两家之长。

在这种设计中，输入图像首先由几层 CNN 处理。CNN 非常擅长其原生任务：高效地提取边缘和纹理等低级特征，并逐渐降低图像的空间分辨率。这个 CNN 主干的输出是一组信息密集的丰富特征图，其尺寸小于原始输入。然后，这些[特征图](@entry_id:637719)被令牌化并送入 Transformer 模块 [@problem_id:5184434] [@problem_id:5228680]。

这种协同作用既优美又实用。CNN 提供了[稳定训练](@entry_id:635987)和提高样本效率的强大局部[归纳偏置](@entry_id:137419)。而 Transformer，现在在一个更小的、由更高级别特征令牌组成的序列上操作，可以专注于它最擅长的事情：建模这些特征之间的全局上下文和长距离依赖关系。这种混合方法已被证明非常强大，尤其是在糖尿病视网膜病变分级中，因为既需要考虑微小的局部病变（微动脉瘤），也需要考虑更广泛的全局变化 [@problem_id:5184434]。

此外，这种设计解决了一个关键的工程挑战。将纯 ViT 应用于大型 3D 医学体数据在计算上通常是不可行的。[自注意力](@entry_id:635960)所需的内存和计算量随令牌数量 ($N$) 的增加呈二次方增长。对于高分辨率的体数据，$N$ 可能会变得非常巨大。通过首先使用 CNN 对体数据进行[降采样](@entry_id:265757)，我们大大减少了 $N$，使得后续的[注意力机制](@entry_id:636429)在现代硬件上变得可以管理 [@problem_id:4534250]。这种两种强大思想的务实融合，代表了在构建用于医学视觉的智能系统方面迈出的重要一步。

