## 应用与跨学科联系

我们花了一些时间来理解[无导数优化](@article_id:298124)的内部机制——巧妙的[代理模型](@article_id:305860)、谨慎的置信域步长、轮询的逻辑。可以肯定的是，它是一件优雅的钟表作品。但是一个引擎，无论设计得多么精美，只有当我们看到它能驱动什么时，才能真正领会其价值。当我们将这个引擎带出车间，进入那个狂野、混乱而又迷人的真实世界时，会发生什么呢？

这才是真正冒险的开始。我们将发现 DFO 不仅仅是一个单一的工具，而是一个多功能的工具箱，可以被调整、增强，并与来自整个科学领域的思想融合。我们将看到它如何在充满噪声的数据迷雾中航行，如何尊重世界的规则和边界，甚至学会处理那些非黑即白而非灰色地带的选择。我们会发现它拥抱物理学优雅的对称性和[现代机器学习](@article_id:641462)复杂的层级结构。让我们开始我们的巡览之旅。

### 真实世界是混乱的：噪声与约束

在前一章中，我们理想化的“黑箱”函数是一个纯粹的数学对象。在现实世界中，函数通常是我们测量的东西，而测量很少是完美的。

想象你是一名工程师，正在校准一个复杂的物理模拟器——也许是用于[天气预报](@article_id:333867)，或是用于模拟新飞机机翼上的气流。模拟器有几十个调节旋钮（参数，我们称之为 $x$），你的目标是找到能使模拟输出与真实世界数据最佳匹配的设置。每次你用新的设置 $x$ 运行模拟器，你都会得到一个分数 $f(x)$，告诉你匹配得有多好。但由于模拟器固有的随机性或数据中的测量误差，你得到的分数从来都不是真正的分数。它是 $f(x)$ 加上一些[随机噪声](@article_id:382845)。当你唯一的视野是通过一个充满静电干扰的摄像头时，你如何绘制一幅地貌图？

这正是基于模型的 DFO 大放异彩的地方。如果我们用最少数量的点来建立一个[二次模型](@article_id:346491)，噪声就会被“融入”到我们的模型中。一次评估中的随机向上波动可能会愚弄我们的模型，让它认为在一个根本没有山的地方有一座巨大的山。解决方案是让自己成为一名统计学家。我们不再只取刚好能定义二次函数的点，而是利用我们的评估预算来取*更多*的点。通过在这个更大的集合上使用[最小二乘回归](@article_id:326091)来拟合我们的模型，我们[实质](@article_id:309825)上是在“平均掉”噪声。随机的波动倾向于相互抵消，而地貌真实的潜在曲率开始从静电干扰中浮现出来。这使我们能够建立一个更可靠的局部地图，并即使在有雾的环境中也能自信地迈出步伐 [@problem_id:3153272]。

噪声并非唯一的复杂情况。现实世界也充满了规则和约束。你不能把实验室温度设为一百万度，也不能把工厂的压力设为负值。一个纯粹形式的 DFO [算法](@article_id:331821)是一个无限乐观主义者，乐于在 $\mathbb{R}^n$ 中的任何地方探索。我们必须教会它尊重边界。

一种方法是通过罚函数法。我们创建一个“[评价函数](@article_id:352146)”，它是我们的真实目标 $f(x)$ 和一个惩罚项的组合，该惩罚项随着约束被违反的程度而变大。然后[算法](@article_id:331821)尝试最小化这个组合函数。但是惩罚应该多大呢？一个固定的、严厉的惩罚可能会吓得[算法](@article_id:331821)不敢在边界附近探索，而真正的解可能就在那里。一个弱的惩罚可能会被忽略。

一个更聪明的方法是*自适应*惩罚。想象一个[算法](@article_id:331821)，它会记录自己的“不当行为”。如果它走出的一步违反了某个约束，那么对该特定约束的惩罚就会略微增加。如果它在几次迭代中持续违反该约束，惩罚就会更显著地增长。如果它表现良好并保持在界限内，惩罚就保持稳定。通过这种方式，[算法](@article_id:331821)学会了哪些约束最难满足，并将压力精确地施加在需要的地方。这有点像一个耐心的老师，只有当学生反复犯同一个错误时才会提高嗓门 [@problem_id:3117746]。

当约束本身就是黑箱时，这就变得更加有趣了。假设检查一个提议的设计 $x$ 是否物理上可行需要一个漫长而昂贵的模拟。我们无法为每个潜在的步长都这样做。在这里，DFO 可以与机器学习形成强大的联盟。我们可以使用我们已经评估过的点——一些是可行的，一些不是——来训练一个计算成本低的[概率分类](@article_id:641547)器。这个分类器就像一个俱乐部的保镖。在我们运行昂贵的“可行性检查”之前，我们问保镖：“这个新点 $x$ 可行的概率是多少？”如果分类器确信这个点是好的，我们就继续。如果它认为这个点很可能是不可行的，我们就不浪费时间和预算，并告诉我们的 DFO [算法](@article_id:331821)尝试一个不同的方向。这种优化和机器学习之间的协同作用使我们能够解决那些否则在计算上难以处理的问题 [@problem_id:3117730]。

### 超越平滑山丘：离散世界与隐藏结构

到目前为止，我们一直把变量想象成可以平滑转动的连续旋钮。但许多现实世界的决策并非如此。我们可能需要在三种不同类型的材料、四种不同的网络布局或五家不同的供应商之间做出选择。这些是整数选择。

一个构建平滑[代理模型](@article_id:305860)的 DFO 方法怎么可能处理这个问题？诀窍是一种叫做*连续松弛*的优美数学戏法。我们暂时假装我们可以选择“布局2.5”。我们将离散选择 $\{1, 2, 3, \dots\}$ [嵌入](@article_id:311541)到一条连续的线上。然后，为了引导我们的搜索回到实际的整数选择上，我们在代理模型中加入一个特殊的惩罚函数。一个绝佳的惩罚函数选择是像 $\phi(x) = \sin^2(\pi x)$ 这样的函数。请注意，这个函数在每个整数处都为零，而在其他任何地方都为正。它在整数处创造了“引力井”。当我们的 DFO [算法](@article_id:331821)最小化[代理模型](@article_id:305860)加上这个惩罚时，它自然会被引向有效的整数解，然后我们可以将这些解四舍五入并进行评估 [@problem_id:3153265]。

这个想法可以扩展到更复杂的“混合整数”问题，在这些问题中，我们必须同时调整连续的旋钮和拨动离散的开关。这需要深厚的理论考量，以确保我们的置信域承诺在四舍五入后仍然有效，但它为 DFO 开辟了物流、调度和系统设计等领域的大量问题 [@problem_id:3153352]。

有时候，问题的结构不是一个需要克服的麻烦，而是一份可以利用的礼物。考虑设计一个对称的[翼型](@article_id:374827)。物理定律规定，如果一个设计 $(x_1, x_2)$ 具有一定的[空气动力升力](@article_id:330773)，那么它的镜像 $(-x_1, x_2)$ 必须具有完全相同的[升力](@article_id:338460)。我们正在探索的地形是完全对称的。一个天真的 DFO [算法](@article_id:331821)不会知道这一点，并且会浪费地评估[翼型](@article_id:374827)左右两侧的点，基本上是重复做同样的工作。

然而，一个聪明的工程师可以利用这种对称性。当[算法](@article_id:331821)评估右侧的一个点 $x$ 时，我们免费得到值 $f(x)$。然后我们可以*人工地*为我们的模型创建一个新的数据点：我们告诉它，镜像点 $-x$ 处的值也是 $f(x)$，而无需进行另一次昂贵的模拟。通过向我们的模型提供这些成对的对称点，我们迫使拟合它们的唯一二次函数继承了底层物理学的对称性。通过这个简单的洞见，我们通常可以用一半的昂贵评估次数来建立一个完整、准确的模型！这是一个物理直觉显著加速数学[算法](@article_id:331821)的完美例子 [@problem_id:3153278]。

### 拓展前沿：新几何与复杂层级

DFO 的核心思想是如此基本，以至于它们可以从 $\mathbb{R}^n$ 的平坦[欧几里得空间](@article_id:298501)中抽离出来，并应用于更奇特的领域。如果你需要在球体表面找到传感器的最佳位置，或者为卫星找到最佳方向，该怎么办？搜索空间不再是一个平面，而是一个弯曲的[流形](@article_id:313450)。

如果我们位于球体上的一个点 $x$，并朝着某个方向 $v$ 迈出一步，我们最终会跑到球体内部，脱离了[流形](@article_id:313450)。DFO 框架以优美的几何优雅性进行了调整。首先，我们找到与球体在当前位置 $x$ 相切的“平坦空间”。在这个[切空间](@article_id:377902)中，我们可以使用我们熟悉的 DFO 机制——轮询方向、构建模型——来找到一个有希望的搜索方向 $v$。我们朝着该方向迈出大小为 $\alpha$ 的一步。现在，从我们在平坦空间中的新位置 $x + \alpha v$ 出发，我们必须回到球体上。我们通过一次*收缩 (retraction)* 来做到这一点，这是一种有原则的投影回[流形](@article_id:313450)的方法。一个简单而直观的[收缩方法](@article_id:346753)是，从球心穿过我们的新点画一条线，直到它碰到球面。这种“切空间轮询和收缩”使我们能够探索弯曲的世界，同时保留 DFO 的收敛保证 [@problem_id:3117696]。

DFO 的灵活性也体现在其机会主义的能力上。假设我们的黑箱并非完全不透明。如果在极少数情况下，对 $f(x)$ 的一次评估附带了一个额外的好处：某个变量的偏导数值 $\partial f / \partial x_i$。一个僵化的[算法](@article_id:331821)可能会丢弃这些信息。但是一个灵活的 DFO 方法可以利用它。在基于模型的方法中，这部分梯度信息成为我们回归中的另一个方程，有助于更准确地确定我们[代理模型](@article_id:305860)的斜率。在直接搜索方法中，如果我们得知函数在 $x_i$ 方向上是下降的，那么优先在该方向上进行轮询就变得合情合理。这种对信息的“机会主义”使用不会破坏 DFO 的基本逻辑，但它可以使搜索效率更高，总是利用它能得到的每一丝知识 [@problem_id:3117673]。

最后，我们来到了最具挑战性和最前沿的领域之一：[双层优化](@article_id:641431)。这些是具有嵌套、层级结构的问题——“问题中的问题”。一个经典的例子来自机器学习：[超参数调整](@article_id:304085)。*外层*问题是为模型找到最佳的超参数（比如[学习率](@article_id:300654)）。但是要评估单个学习率的质量，你必须首先解决一个*内层*问题：用该学习率训练整个模型，以找到最佳的权重。

外层目标的评估本身就是一项完整的优化任务！一种天真的方法，即粗略地解决内层问题，将会误导外层的搜索。一个有原则的 DFO 方法必须精心协调两个层次之间的舞蹈。它对两者都使用置信域框架。至关重要的是，它*耦合*了它们的精度：当外层搜索采取大的、探索性的步骤时，内层问题可以近似解决。但是当外层置信域收缩，搜索开始精化一个解时，[算法](@article_id:331821)要求内层问题以逐渐提高的精度来解决。这确保了流向外层搜索的信息对于其操作的尺度总是足够可靠。这种复杂的结构使得 DFO 能够应对现代工程、经济学和数据科学中发现的一些最复杂的设计问题 [@problem_id:3117745]。

从驯服含噪的模拟器到导航弯曲的空间和解决嵌套的层级结构，我们看到[无导数优化](@article_id:298124)的简单核心是一系列丰富且不断发展的技术的种子。其真正的力量不在于其孤立性，而在于其与统计学、机器学习、几何学和物理学的深刻联系——这证明了在面对未知时科学推理的统一性。