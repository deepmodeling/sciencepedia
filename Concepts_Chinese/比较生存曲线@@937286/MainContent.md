## 引言
比较两组之间事件发生所需的时间是科学研究中的一个基本问题，从评估一种新[抗癌药物](@entry_id:164413)的有效性到评价一种产品的耐久性。然而，这种比较因一个普遍的挑战而变得复杂：信息不完整。通常，研究结束时，并非所有受试对象的事件都已发生，这个问题被称为删失。在这种情况下，诸如t检验之类的标准统计工具是无效的，因为它们无法妥善处理[删失数据](@entry_id:173222)，会导致有偏的结论。这造成了一个关键的知识空白，需要专门的方法才能从时间-事件数据中得出准确的见解。

本文为驾驭这一复杂领域提供了全面的指南。它揭开了公正、准确地比较生存曲线所需的统计推理的神秘面纱。首先，在“原理与机制”部分，我们将探讨[删失数据](@entry_id:173222)的核心概念，剖析[对数秩检验](@entry_id:168043)的精妙逻辑，并讨论其关键的基本假设——[比例风险假设](@entry_id:163597)。我们还将介绍当此假设不成立时的现代替代方法。随后，在“应用与跨学科联系”部分，我们将遍览这些方法在现实世界中的多样化应用，看它们如何在临床试验、生物学研究中提供关键答案，甚至构成先进机器学习模型的基石。

## 原理与机制

### 信息不完整的世界：为何普通统计方法会失效

想象一下，你面临一个看似简单的问题：A、B两个品牌的灯泡，哪一个更耐用？你取每个品牌一百个灯泡，将它们旋入灯座，然后启动秒表。随着时间流逝，灯泡开始闪烁、熄灭。你勤奋地记录下每一个灯泡的“死亡”时间。然而，几个月后，你遇到了一个问题。你的实验必须结束，但许多灯泡仍然亮着。对于这些“幸存者”，你不知道它们的真实寿命，只知道它*至少*与你的实验持续时间一样长。这就是**右删失**的根本挑战。

这个问题并非灯泡所独有；它是医学和生物学研究的核心现实。当我们在临床试验中跟踪患者，观察他们的生存时间或无病生存时间时，一些患者在研究结束时仍然健康。另一些患者可能搬家而失访。在所有这些情况下，他们的数据都是删失的。我们拥有的信息是不完整的。

你可能会想简单地忽略删失的观测数据，仅使用已发生事件的患者来计算平均生存时间。这将是一个严重的错误。根据定义，被删失的患者在其随访期间是“幸存者”。系统地剔除他们，会从样本中移除存活时间最长的个体，导致平均生存时间被严重低估。依赖于计算样本均值的简单Student's $t$-检验也因此失效。问题不仅在于均值有偏；时间-事件数据也很少呈现$t$-检验所假设的对称钟形曲线 [@problem_id:4546789]。

为了在这个信息不完整的世界里工作，我们需要一种新的思维方式和一种新的数据打包方式。对于每个受试对象——无论是患者还是灯泡——我们记录一对值：$(X_i, \delta_i)$。这里，$X_i$是观测到的时间（事件发生时间或删失时间），而$\delta_i$是一个事件指示符，一个简单的标志，如果事件发生则为$1$，如果观测被删失则为$0$。这对优雅的数值$(X_i, \delta_i)$包含了我们拥有的所有信息，它是所有生存分析的基本数据单元 [@problem_id:4923228]。但要使用它，我们必须作出一个关键假设：删失必须是**非信息性**的。这意味着，在特定时间被删失这一行为，不会为我们提供关于该受试对象未来风险的任何线索。例如，如果感觉病情更重的患者更有可能退出研究，那么删失就是信息性的，我们的方法将产生过于乐观的结果。随机的管理性删失（研究结束）是非信息性删失的典型例子 [@problem_id:4952891]。

### 公平比较的艺术：[对数秩检验](@entry_id:168043)

那么，我们如何使用这些（时间，状态）数据来比较两组，比如说，服用新药的患者与服用安慰剂的患者？我们不能比较平均时间，但我们可以比较整个随访期间的事件经历。这就是**[对数秩检验](@entry_id:168043)**的精妙之处。

其核心思想是：我们不一次性审视整个时间线，而是按时间步进，仅在事件发生的确切时刻暂停。在每一个这样的事件时间点，我们观察所有仍在随访且尚未发生事件的受试对象构成的集合。这个集合被称为**风险集**。然后，我们问一个简单而有力的问题：“鉴于这个特定的风险集以及刚刚发生了一个事件的事实，这个事件发生在治疗组与安慰剂组的几率分别是多少？”

在零假设下——即治疗无效——事件应该对风险集中的任何人都同样可能发生。因此，治疗组中事件的*期望*数量应与其在风险集中的比例成正比。如果风险集中一半的患者在治疗组，我们期望在那个瞬间发生的事件中，有一半属于他们。

[对数秩检验](@entry_id:168043)将这一直觉形式化。在每个不同的事件时间$t_j$，它将组别与结果（事件或无事件）制成一个简单的$2 \times 2$表格。由此，它计算出治疗组中*观测*到的事件数$d_{1j}$，并将其与零假设下的*期望*事件数$e_{1j}$进行比较。然后计算两者之差：$(d_{1j} - e_{1j})$。对所有事件时间重复此过程，并将这些差异相加 [@problem_id:4387185]。

$$ U = \sum_{j} (d_{1j} - e_{1j}) $$

如果治疗无效，正负差异应大致相互抵消，最终总和$U$将接近于零。但如果治疗有效，其事件数将持续少于[期望值](@entry_id:150961)，导致一个大的负总和。如果治疗有害，其事件数将多于[期望值](@entry_id:150961)，导致一个大的正总和。这个逻辑巧妙地纳入了删失的受试对象；他们在被删失之前一直留在风险集中，为分母做贡献，被删失后才被移除。该检验还通过将在特定时间发生的所有事件视为从风险集中抽取的一批，从而精确地处理了事件时间平局的情况 [@problem_id:4990754]。

最后，这个累积得分$U$通过其方差进行数学上的标准化，以创建一个[检验统计量](@entry_id:167372)。在零假设下，该统计量遵循一个著名的概率分布，即自由度为1的[卡方分布](@entry_id:165213)，从而使我们能够计算出**[p值](@entry_id:136498)**。这个p值告诉我们，如果治疗真的没有效果，我们观察到组间差异等于或大于我们所见差异的概率 [@problem_id:4617749]。

### 不言而喻的假设：比例风险

对数秩检验在其标准形式下，当一个特定条件成立时，其效力最强，结果也最直接：**[比例风险假设](@entry_id:163597)**。风险（hazard）是在某个时间点，假定个体存活至该时间点，事件发生的瞬时风险。[比例风险](@entry_id:166780)（PH）假设指出，两组之间的风险比率随时间保持恒定。

例如，如果新药与安慰剂相比，将瞬时死亡风险降低了$50\%$，PH假设意味着它在第1天将风险降低$50\%$，在第100天降低$50\%$，在第1000天也降低$50\%$。**风险比**是一个常数$0.5$。[对数秩检验](@entry_id:168043)通过在每个事件时间点给予$(d_{1j} - e_{1j})$项相同的权重，实际上是在寻找这种恒定的、乘法效应 [@problem_id:4609119]。

这个假设不仅仅是一个统计上的奇想；它是生存分析中应用最广泛的工具——**Cox比例风险模型**——的基石。在这里，我们发现了一个优美而统一的原则：对数秩检验并非某种临时凑合的程序。它可以被推导为[Cox模型](@entry_id:164053)中治疗效应的**[得分检验](@entry_id:171353)** [@problem_id:4989113]。这意味着生存分析的这两大支柱是紧密相关的，源于同一理论基础。

我们不必盲目接受这个假设。我们可以检验它。一种常见的视觉诊断方法是为每个组绘制所谓的“log-minus-log”生存曲线。如果风险是成比例的，这些转换后的曲线应该大致平行 [@problem_id:4609119]。

### 当[曲线交叉](@entry_id:189391)时：一种更现代的观点

但如果情况更复杂呢？设想一种现代免疫疗法，需要几周时间来激活患者的免疫系统，而标准的化疗则立即起效。在最初的几个月里，接受[免疫疗法](@entry_id:150458)的患者情况可能实际上比接受化疗的患者稍差。但一旦他们的免疫系统被激活，他们的长期生存状况可能会显著改善。如果我们绘制生存曲线，它们将会**交叉**。

在这种情况下，风险比不是恒定的。它在早期大于1（[免疫疗法](@entry_id:150458)风险更高），在[后期](@entry_id:165003)小于1（免疫疗法更好）。如果我们应用标准的对数秩检验，它将在早期阶段积累伤害的证据，在[后期](@entry_id:165003)阶段积累益处的证据。这两种相反的效应可能会相互抵消，可能导致检验得出“总体上无显著差异”的结论，而实际上存在一个极其重要且随时间变化的效应 [@problem_id:5216385]。

这是用单一数字（如风险比）来总结复杂动态比较的一个关键局限。当[曲线交叉](@entry_id:189391)时，我们需要一种不同的度量。一个强大且日益流行的替代方法是**限制性平均生存时间（RMST）**。

RMST背后的思想非常直观。我们不比较瞬时风险，而是比较一个更具体的量：在某个特定的、具有临床意义的时间窗口内的平均无事件生存时间。对于一个有36个月随访的研究，我们可能会问：“平均而言，在这36个月里，治疗组的患者无事件生存了多少个月，相比之下安慰剂组的患者呢？”

RMST就是生存曲线下直到选定时间点$\tau$的面积。两组RMST的差异就是它们生存曲线之间的面积。这个单一的数字有直接、实际的解释——例如，“在头三年里，服用新药的患者平均多活了2.4个月且没有疾病进展。”即使[曲线交叉](@entry_id:189391)，这个总结仍然有效且易于解释，为整体治疗效益提供了一个更稳健的画面 [@problem_id:5216385]。这种从风险比到RMST的转变，代表了当复杂的现实挑战简单模型时，我们向数据提出更直接、更具体问题的趋势。

