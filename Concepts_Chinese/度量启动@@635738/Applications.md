## 应用与跨学科联系

我们花了一些时间来理解度量启动的机制——加密哈希、平台配置寄存器（PCR）以及“扩展”操作的单[向性](@entry_id:144651)。这是一项精巧而简洁的工程设计。但它究竟有何*用途*？它能解决我们真正关心的问题吗？换一种方式问，既然我们已经在计算机内部构建了这个精确无比且无法腐蚀的见证者，它能提供什么样的证词，又会有谁对听取这些证词感兴趣呢？

事实证明，它的证词对现代计算的根基至关重要。从驱动云服务的庞大数据中心到你桌上的笔记本电脑，度量启动提供了一种基本能力：能够向一台机器提问，“用加密证明向我展示，你今天究竟是如何启动的。”这个简单的问题在众多领域都具有深远的影响。

### 云的基石：在服务器的海洋中建立信任

想象一下云。它不是天空中某种飘渺的存在；它是一个装满了别人电脑的物理仓库。当你启动一个虚拟机（VM）时，你本质上是在借用陌生人硬件的一部分。你怎么可能信任它？你如何知道管理你虚拟机的宿主程序——[虚拟机](@entry_id:756518)监控程序（hypervisor）——没有被攻破？你如何知道你想要运行的[虚拟机](@entry_id:756518)镜像就是实际启动的那个？

这就是度量启动在名为**[远程证明](@entry_id:754241)**的过程中扮演核心角色的地方。在一个新的[虚拟机](@entry_id:756518)被允许加入敏感网络或接收加密密钥等机密信息之前，一个编排器——即主控制器——会向它发出挑战。“证明你的完整性，”它要求道。虚拟机利用其虚拟TPM，呈现一个“引用”：一份经过签名的、无可否认的PCR值声明。

编排器就像一个高级俱乐部门口无情的保镖。它有一份宾客名单——一份清单，精确记录了哪些固件、[引导加载程序](@entry_id:746922)、内核和初始RAM磁盘是被允许的。它已经为这唯一一个被批准的配置预先计算出了确切的最终PCR值。如果虚拟机的证明PCR值与名单*完美*匹配，它就被允许进入。如果差了哪怕一个比特——也许是因为使用了另一个（但仍然有效）版本的内核——它就会被拒绝。在这个世界里，没有“差不多就行”。一台使用各种被批准部件混搭启动的机器，一个“弗兰肯斯坦”配置，与一台带有公然恶意代码的机器同样不可信，因为这些不同组件之间的交互是未经测试和验证的 [@problem_id:3685997]。

这整个过程依赖于一个精心设计的安全架构。仅仅让虚拟机发送其PCR值是不够的；整个对话都必须是安全的。验证者发送一个随机的、一次性的数字，一个*随机数（nonce）*（我们称之为$\mathcal{N}$），[TPM](@entry_id:170576)必须将其包含在签名的引用中。这确保了证明是新鲜的，而不是对过去某个良好状态的重放。此外，vTPM的身份必须以加密方式锚定到主机的物理硬件，并绑定到特定的虚拟机实例，以防止攻击者将受损虚拟机的身份与良好虚拟机的身份互换。只有一个结合了硬件[信任根](@entry_id:754420)、度量启动和安全证明协议的完整的、端到端的设计，才能提供向虚拟机释放机密所需的高保证 [@problem_id:3689858]。

这一原则甚至可以扩展到最恶劣的环境中，比如通过本地网络启动一台无盘服务器。传统的网络启动协议，如PXE和TFTP，是出了名的不安全，好比在一个拥挤的房间里大声喊出你的请求，并相信任何回应。网络上的攻击者可以轻易地拦截这些请求，并提供一个恶意的[操作系统](@entry_id:752937)。我们如何在这里建立信任？通过分层防御。首先，我们使用[安全启动](@entry_id:754616)来确保初始的网络引导程序是经过签名且真实的。然后，这个受信任的程序会放弃不安全的TFTP协议，转而通过像TLS这样的安全加密通道来获取真正的[操作系统](@entry_id:752937)。在每一步中，度量启动都在观察，记录网络[引导加载程序](@entry_id:746922)的哈希值、它连接到的服务器的证书，以及它下载的内核的哈希值。这就创造了一个完整、可验证的故事，证明这台机器不仅启动了真实的代码，而且是从正确、受信任的来源获取的，而这一切都是在一个不受信任的网络海洋中完成的 [@problem_id:3679590]。

### 超越启动：一个活体系统的完整性

[信任链](@entry_id:747264)并不会在操作系统内核出现在屏幕上时就结束。如果[操作系统](@entry_id:752937)做的第一件事就是执行一个恶意脚本，那么一个完美的、安全的启动过程也无济于事。这在云计算中是一个非常现实的问题，虚拟机通常在首次启动时使用从元数据服务中获取的脚本（如`cloud-init`）进行配置。如果攻击者能够影响那个元数据服务，他们就可以在机器证明其完整性后不久就将其攻破。

唯一的解决方案是扩展[信任链](@entry_id:747264)。度量启动的理念必须应用于这些“首日”配置。任何将被执行的脚本或动态数据也必须被验证，例如，要求它必须由组织的编排器进行[数字签名](@entry_id:269311)。首次启动框架必须作为[信任链](@entry_id:747264)中的下一个环节，拒绝执行任何缺乏有效签名的配置 [@problemid:3673393]。

这揭示了度量启动更深层次的角色：它不仅仅是关于保护启动过程，而是关于建立一个**可信基础**，其他安全服务可以基于此运作。度量启动确保操作系统内核及其关键安全模块未被篡改。在Linux中，这样的一个模块就是完整性度量架构（IMA）。当度量启动监控[引导加载程序](@entry_id:746922)和内核时，IMA可以被配置为继续这个过程，在每个应用程序和库文件被执行或加载到内存之前对其进行度量。

当然，这本身也带来了挑战。如果你度量每一个文件，你就需要一个庞大的已知良好哈希值的白名单。当你应用一个安全更新时会发生什么？成百上千的文件会改变，它们的哈希值将不再与白名单匹配。系统会陷入停滞，阻止合法的程序运行。这意味着白名单必须与系统补丁[同步更新](@entry_id:271465)。在这里，我们看到了纯粹的加密理论与混乱的运维现实相遇的边界。度量启动无法解决白名单管理的问题，但它保证了执行白名单的机制（操作系统内核和IMA）本身是值得信赖的 [@problem_id:3673342]。

### 一个数字飞行记录仪：取证、攻击和你的个人电脑

让我们把这些想法带回到一个更熟悉的设备上：一台可以双启动Windows和Linux的个人电脑。这种常见的设置极好地说明了[安全启动](@entry_id:754616)和度量启动互补但截然不同的角色。[安全启动](@entry_id:754616)是*执行者*；它检查[引导加载程序](@entry_id:746922)（如GRUB）的签名，如果它不是由受信任的密钥签名的，就拒绝运行它。这是一种预防性控制。

度量启动是*记录者*。它不阻止任何东西运行。它只是用加密的不可磨灭的墨水，记下发生了什么。如果你配置你的GRUB[引导加载程序](@entry_id:746922)以禁用对Linux内核的签名检查，[安全启动](@entry_id:754616)已经完成了它的工作——它验证了GRUB——而*强制执行*的链条现在断了。攻击者可以插入一个恶意的内核，它将会运行。但度量启动仍然在观察。它会尽职地记录下恶意内核的哈希值，最终的PCR值将会不同。度量链没有断裂，但如果没有后续的强制执行步骤（比如解封磁盘加密密钥），这个度量就只是一个没人会读的日志中的一条记录 [@problem_id:3679547]。

当我们考虑到复杂的**回滚攻击**时，这种“度量但不强制执行”的能力变得至关重要。想象一下，一个攻击者获得了你机器的访问权限，并将你新的、已打补丁的[引导加载程序](@entry_id:746922)替换为一个旧版本。这个旧版本仍然由供应商完美签名，所以[安全启动](@entry_id:754616)允许它毫无怨言地运行。然而，这个旧版本包含一个已知的漏洞，攻击者现在可以利用它 [@problem_id:3687920]。[安全启动](@entry_id:754616)对这种攻击是盲目的。度量启动则不然。它会检测到旧版本不同的哈希值，结果PCR值会改变。一个有着严格策略——只允许*最新*版本——的[远程证明](@entry_id:754241)验证者会立即将该系统标记为不合规。这表明，度量比单独的签名检查提供了更细粒度的[系统完整性](@entry_id:755778)视图。

这种创建启动过程完美、不可变记录的能力，使度量启动成为**数字取证**的强大工具。在安全事件发生后，调查人员面对的是一台被攻破的机器。他们无法信任硬盘上的任何文件——包括任何日志文件，因为攻击者可以轻易地修改它们。他们如何重建事件经过？他们求助于TPM。

把TPM想象成飞机的飞行记录仪，而磁盘上的事件日志则是飞行员的纸质笔记本。笔记本可能被伪造。但飞行记录仪是防篡改的。调查员首先挑战TPM，以获得一份签名的PCR值引用——这是来自飞行记录仪的真实数据。然后，他们拿起磁盘上不可信的事件日志——飞行员的笔记本——并以数学方式“重放”它。他们从零开始，执行日志中描述的相同PCR扩展序列。如果他们计算出的最[终值](@entry_id:141018)与TPM引用的值匹配，他们就以加密方式证明了磁盘上的日志是启动过程的真实、忠实的记录。如果不匹配，他们就知道日志是假的。因为哈希函数是单向的，所以不可能从PCR值反向推算出被篡改的日志应该是什么样的。一旦验证通过，这个日志就为调查人员提供了一个精确、可信的时间线，记录了[操作系统](@entry_id:752937)接管前加载的每一个组件，使他们能够精确定位被攻破的时刻 [@problem_id:3679585]。

### 一个统一的原则：科学中的[信任链](@entry_id:747264)

我们已经看到，度量启动是用于在计算机系统中建立可验证[信任链](@entry_id:747264)的工具。但这个想法仅限于计算领域吗？让我们退后一步，看看更大的图景。我们真正谈论的是，基于一个从可信基础开始的证据链，来建立对某个结果的信心的过程。这不是一个新想法；它正是科学探究的本质。

考虑一个化学实验室正在测量水样中污染物浓度 $C$。最终的数值是由一台连接到分析仪器的复杂计算机产生的。这台计算机可以使用度量启动来提供一个加密日志，证明其[操作系统](@entry_id:752937)和[数据采集](@entry_id:273490)软件未被篡改。但这是否就意味着数值 $C$ 是可信的呢？并非如此。

整个实验就是一条[信任链](@entry_id:747264)。计算机对电信号的测量是与来自校准标准的信号进行比较的。校准标准的浓度是通过在[分析天平](@entry_id:185508)上称量微量的纯化学品，并用[容量瓶](@entry_id:200949)将其溶解在精确体积的水中来确定的。整个过程都被计时和记录。

那么，这整个科学实验的**[可信计算基](@entry_id:756201)（TCB）**是什么？它不仅仅是计算机的固件和[TPM](@entry_id:170576)。它还包括**[分析天平](@entry_id:185508)**和**[容量瓶](@entry_id:200949)**，它们是物理测量的“[信任根](@entry_id:754420)”。它也是**系统时钟**，是时间的[信任根](@entry_id:754420)。在实验开始之前，这些基础工具必须经过校准和认证。它们的正确性被假定，就像[TPM](@entry_id:170576)的完整性被假定一样。从这个基础上，一条[信任链](@entry_id:747264)被建立起来。天平和玻璃器皿保证了标准的准确性。标准被用来校准仪器。而计算机，其自身的完整性由度量启动保证，记录了仪器的信号。

通过这个视角来看，度量启动不仅仅是一项小众的安全技术。它是一个普适原则的美妙实现。它相当于科学家的校准仪器和一丝不苟的实验记录本的数字版本。它是一种机制，确保我们复杂世界中至少有一部分——计算机的启动过程——是建立在可验证真理的基础之上，使我们能够充满信心地在其上构建更高、更复杂的系统 [@problem_id:3679604]。