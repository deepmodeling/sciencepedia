## 引言
在追求[精准医疗](@entry_id:152668)的过程中，将患者分入有意义的亚组至关重要。然而，这一挑战涉及处理高维异构患者数据的复杂性。患者相似性网络通过将患者相似性这一抽象概念转化为一个具体、可分析的图，提供了一个强大的解决方案。本文旨在解决如何有效构建和利用这些网络这一根本问题。我们的探索始于“原理与机制”，详细介绍衡量相似性、构建网络以及整合基因组学和临床记录等不同数据类型的技艺。随后，“应用与跨学科联系”部分将展示这些网络如何应用于现实世界的问题，从患者分层、风险预测到实现保护隐私的联邦学习。通过深入探讨构建和应用两个方面，本文全面概述了作为现代计算医学基石的患者相似性网络。

## 原理与机制

为了理解世界，我们常常对事物进行分组。我们将动物分为物种，将书籍分为类型，将星星归入星座。在医学领域，这种寻找有意义群体的愿望具有深远的紧迫性。我们能否将患者分为对治疗反应不同的亚型？我们能否识别出未来患病风险高的个体？患者相似性网络是一个强大而优雅的构想，它将分类这门艺术转变为一门科学。它将“患者相似性”这一抽象概念转化为一个具体、可供我们探索、分析和学习的数学对象——图。

但两名患者“相似”到底意味着什么？这个问题没有唯一的答案。这是我们征程中第一个，或许也是最重要的创造性步骤。

### 衡量相似性的艺术

想象一下，每个患者都是一个广阔、多维空间中的一个点。每个维度代表一个特征：一个基因的表达水平、一个蛋白质的浓度、一项临床检验值，或是否存在某种诊断。一个拥有数千个此类特征的患者就成为一个数千维空间中的一个点。我们的任务，就是定义在这个空间中“接近”意味着什么。

最直观的方式是直线距离，我们称之为**[欧几里得距离](@entry_id:143990)**。这是我们在几何学中学到的“直线”度量。然而，在患者数据的高维世界里，这把简单的尺子可能会骗人。以不同单位测量或具有天然更高方差的特征——比如血压与基因表达比率——可能会不成比例地主导距离的计算。如果一个特征的数值比另一个大一千倍，它几乎将一手决定谁与谁“接近”。同样，如果我们有几个高度相关的特征（例如，一组总是共表达的基因），它们合在一起的声音会淹没其他更独特的信号。[欧几里得距离](@entry_id:143990)，因其简单性，会最响亮地听取那些“喊”得最响的特征[@problem_id:4368768]。

为了克服这一点，我们需要更复杂的观察方式。与其只考虑两点之间的距离，不如考虑从原点指向这些点的向量之间的*夹角*？这就是**余弦相似度**背后的思想。它忽略了特征向量的整体大小——一个各项实验室指标普遍偏高的患者可能与另一个患者具有相同的数值*模式*——而只关注其轮廓的相对形状。一个相关且广泛使用的度量是**[皮尔逊相关系数](@entry_id:270276)**，它本质上是先通过减去每个患者的平均特征值进行“中心化”处理后，再计算轮廓的余弦相似度。这使得该度量对于患者特异性的基线偏移具有鲁棒性，只关注波动的模式[@problem_id:4368768]。

我们可以变得更聪明。想象一下，数据点并不形成一个简单、均匀的云团，而是一个倾斜拉伸的椭圆。马氏距离是一把“智能”的尺子，它能理解这个云团的形状。它会自动考虑特征之间的相关性，并降低数据方差较大方向的权重。它有效地“学习”了特征空间的几何结构，并在该学习到的上下文中测量距离，从而缩短了沿着冗余、共线维度的距离[@problem_id:4368768]。

度量选择不仅仅是技术细节；它是一个建模决策，反映了我们对数据的假设。例如，在处理非常稀疏的数据时，比如庞大的临床诊断代码词汇表（任何给定患者只有少数几个代码），选择至关重要。像**杰卡德相似度**这样的度量，它关注共享代码与总唯一代码的比率，可能会过于严苛。如果两个患者各有10个罕见诊断，且只共享一个，杰卡德指数仅为微不足道的 $\frac{1}{19}$。相比之下，考虑向量几何的余弦相似度在这些稀疏设置中往往会给出更高的分数，有助于防止生成的网络分裂成微小、不连通的碎片[@problem_id:5199585]。没有普遍“最佳”的度量；其艺术在于选择最能捕捉手头问题相似性本质的那个。

### 从相似性到网络

一旦我们有了计算每对患者相似性分数的方法，我们就可以构建网络。概念很简单：患者是**节点**（或顶点），如果他们足够相似，就在他们之间画一条线，即**边**。这就创建了一个图，一个描绘人类疾病图景的优美数学结构。

这张图可以用几种方式绘制[@problem_id:4329698]。我们可以创建一个**加权网络**，其中边的粗细或亮度与相似性分数 $s(i, j)$ 成正比。这保留了关于任意两个患者相似程度的所有细微、连续的信息。或者，我们可以通过应用一个阈值来创建一个**无权网络**：如果相似性高于某个值 $\tau$，则边存在，否则不存在。这简化了图，但迫使我们对阈值做出一个艰难的决定，这可能很棘手。

一种更优雅且广泛使用的方法是构建一个**k-近邻 (k-NN) 图**。在这里，我们只将每个患者连接到与他们最相似的 $k$ 个其他患者。这会产生一个奇妙的效果：它将我们的注意力集中在最有意义的局部关系上，过滤掉无数微弱、无[信息价值](@entry_id:185629)的相似性所带来的噪声。这就像整理地图，只看连接城市的最重要高速公路。这个**稀疏化**过程是构建一个清晰、可解释网络的关键步骤[@problem_id:4387231] [@problem_id:4350122]。

在构建过程中，我们还必须小心处理**[自环](@entry_id:274670)**（从一个患者到其自身的边）等细节。虽然它们可能看起来无害，但它们会巧妙地扭曲某些类型的分析。例如，在使用一种称为归一化谱聚类的流行技术时，[自环](@entry_id:274670)会夸大一个患者的总连接性（其“度”），这可能会降低其与其他患者连接的相对重要性。移除它们通常是一种明智的分析卫生行为[@problem_id:4368721]。

### 患者数据的两面：单体网络与[二分网络](@entry_id:197115)

我们构建的网络结构本身就应该反映我们正在提出的问题。到目前为止，我们一直专注于一个所有节点都是患者的网络。这种**患者-患者相似性网络**建立在**同质性**（homophily）原则之上——即“物以类聚，人以群分”的理念。它擅长利用这一原则的任务，例如发现患者的自然聚类（队列发现），或利用患者之间的连接来传播信息，比如根据已标记邻居来预测未标记患者的疾病标签[@problem_id:5199550]。

但是，还有另一种同样强大的方式来看待数据。与其将患者相互连接，我们可以将他们连接到他们所关联的临床代码（诊断、操作、药物）。这就创建了一个**患者-代码[二分网络](@entry_id:197115)**，一个具有两种不同类型节点的图。这个网络中的边不代表相似性，而是**隶属关系**：这个患者有这个诊断。这种结构非常适合另一类问题。预测一个患者可能获得何种新诊断的任务，变成了一个**[链接预测](@entry_id:262538)**问题——在图中寻找可能缺失的边。这种表示方式不仅让我们能够学习患者的向量嵌入，还能学习代码本身的向量嵌入，捕捉它们的临床背景[@problem_id:5199550]。在患者-患者图和患者-代码图之间的选择，完美地诠释了数据科学的一个核心原则：你选择的表示方式从根本上塑造了你能发现什么。

### 编织统一的织锦：整合多种数据类型

一个现代患者不是由一种数据类型来描述的，而是由多种——一曲由基因组学、[转录组学](@entry_id:139549)、蛋白质组学和临床测量组成的多组学交响乐。我们如何将这些不同来源的信息整合成一个单一、连贯的患者画像？简单地将所有这些特征拼接在一起是充满风险的。它们的尺度、维度和噪声水平千差万别；一种模态很容易淹没其他模态。

一个远为优雅的解决方案是，首先为每种数据类型（或**模态**）构建一个独立的患者相似性网络。这尊重了每个生物层面的独特性。但这又带来了一个新挑战：我们如何使不同网络间的相似性分数具有可比性？蛋白质组学网络中0.8的相似性可能与基因组学网络中0.8的相似性意义截然不同。

这就是**带宽校准**的问题，尤其是在使用高斯[核函数](@entry_id:145324) $k(x,y) = \exp(-\lVert x - y \rVert^2/(2\sigma^2))$ 将距离转换为相似性时。带宽参数 $\sigma$ 就像镜头的焦点，决定了邻域的尺度。一种鲁棒的方法是为每个模态 $v$ 选择一个特定的 $\sigma_v$，并将其基于该模态内部距离的特征尺度（例如，距离的[中位数](@entry_id:264877)）[@problem_id:5214389]。一种更精细的方法是使用**局部缩放**：它根据每个个体患者 $i$ 的局部邻域密度，为其分配一个唯一的带宽 $\sigma_i^{(v)}$。在数据的密集区域，焦点变得更锐利（小 $\sigma$），而在稀疏区域，则变得更柔和（大 $\sigma$）。这种自适应聚焦产生了校准得非常好的网络，并且在不同模态之间具有可比性[@problem_id:5214389]。

一旦我们有了一组校准好的网络，每种数据类型一个，我们就可以执行最后、美妙的一步：将它们融合成一个。**相似性网络融合 (SNF)** 是实现这一目标的一项强大技术[@problem_id:4362437]。其直觉就像一群专家（每个网络）试图达成共识[@problem_id:4387231]。SNF 使用一个迭代的**扩散**过程。想象信息像染料一样在网络中流动。在每一步中，每个网络都会被更新，使其与其他网络更相似一点。在基因组学网络*和*[蛋白质组学](@entry_id:155660)网络中都很强的边，在两者中都会被加强。在一个网络中强但在所有其他网络中都弱的边，将逐渐被抑制。这种非线性的[消息传递](@entry_id:751915)，被形式化为耦合随机游走，持续进行，直到网络收敛成一个单一的、融合的图[@problem_id:4350122]。这个最终的网络不仅仅是其各部分的总和；它是一个稳健、整合的患者相似性视图，放大了跨生物尺度一致的信号，同时过滤掉了特定于单一模态的噪声。

### 网络如水晶球：预测与发现

我们能用这个最终的、融合的网络做什么呢？我们可以用它来发现患者数据中隐藏的结构。在这里，基于图的方法比传统技术提供了深远的优势[@problem_id:4329698]。像 $k$-均值聚类这样的基于度量的方法在原始特征向量上操作，倾向于找到简单的、团状的簇，而[基于图的聚类](@entry_id:174462)则在网络的拓扑结构上操作。

实现这一点的关键是一个神奇的对象，叫做**[图拉普拉斯算子](@entry_id:275190)**。它是一个从网络的邻接和度信息中派生出来的矩阵，其性质揭示了网络最深层的秘密。[拉普拉斯算子](@entry_id:262740)的特征向量，特别是那些对应于其最小特征值的特征向量，就像“断层线”，指出了将图“切割”成社群的最自然方式。这种方法，被称为**谱聚类**，可以识别任意复杂形状的患者亚组，远远超出了那些只能将数据视为点云的方法的能力。

除了聚类，网络本身也成为像**[图神经网络 (GNNs)](@entry_id:750014)** 这样强大的预测模型的支架。这些模型通过在相连的患者之间传递消息来学习，使得每个患者的表示都能够被其邻域的上下文所丰富。

### 穿越迷宫：实践与伦理考量

能力越大，责任越大。患者相似性网络的构建和使用需要穿越一个由实践和伦理挑战构成的迷宫。

最阴险的技术陷阱之一是**标签泄漏**。假设我们正在构建一个网络来预测患者结局，并且为了“帮助”模型，我们使用结局标签来重新加权网络边，加强具有相同结局的患者之间的连接。如果我们不一丝不苟地小心，关于测试集标签（本应被保留）的信息可能会通过图结构本身“泄漏”到训练过程中。这会导致极其乐观的性能，但在新数据上会消失。唯一的保障是严格的实验卫生，使用像[嵌套交叉验证](@entry_id:176273)这样的框架，以确保在训练和[模型选择](@entry_id:155601)的每一个阶段，测试数据都保持完全未被触及和看到[@problem_id:4542656]。

伦理方面的考量甚至更为深远。即使我们移除了所有个人标识符，PSN 也不是自动私密的。一个拥有关于目标患者少量辅助信息——例如，他们罕见的诊断和一些与他们一同接受治疗的人——的对手，有可能重新识别他们。他们可以通过为目标创建一个“假设”的个人资料，使用公开模型计算其预测的[网络嵌入](@entry_id:752430)，并在图中所有“匿名”节点中找到最接近的匹配项来实现这一点[@problem_id:1436671]。

最后，我们必须面对**公平性**的挑战。一个广为人知的谬论是，如果模型没有被输入种族或社会经济地位等敏感属性，它就不会有偏见。在 PSN 中，偏见可以被编织进图的结构本身。如果来自特定人口群体的患者倾向于更多地相互连接——一种称为**同质性**的现象——GNN 可以学会识别这种结构模式。这可能导致模型对该群体采取不同的处理方式，可能违反如**人口统计均等**（在不同群体间以相同比率做出预测）或**[机会均等](@entry_id:637428)**（在不同群体间具有相同的错误率）等公平性标准。网络在寻求模式的过程中，可能会无意中学习并放大编码在其结构中的社会偏见[@problem_id:5199182]。

构建一个患者相似性网络是一段旅程。它始于定义相似性的创造性行为，经过精心构建和整合图的工艺，最终以发现隐藏的临床模式的强大能力告终。但这段旅程不仅需要技术技能，还需要深厚的责任感，以确保这些强大的工具是以有效、私密和公平的方式构建和使用的。

