## 引言
我们周围的世界充满了各种纹理，从木材的纹理到丝绸的质地。在医学影像中，这些视觉图案通常包含关键的诊断信息，但将它们描述为“平滑”或“混乱”是主观的，不足以进行计算分析。挑战在于创建一种数学语言来客观地量化纹理，让机器能够“看到”并测量这些图案。本文通过全面介绍一种强大的技术——游程矩阵，来解决这个问题。在“原理与机制”一章中，文章首先将纹理概念解构为简单、可数的像素“游程”，进而构建正式的灰度游程矩阵（GLRLM）并介绍长程强调等关键特征。在这些基础知识之后，“应用与跨学科联系”一章将展示这些特征如何应用于从病理学到临床影像组学的各个领域，将抽象的数字转化为拯救生命的洞见。

## 原理与机制

### 什么是纹理？我们如何描述它？

环顾四周，世界充满了纹理。玻璃窗光滑冰冷的表面与木桌粗糙温暖的纹理感觉完全不同。一匹丝绸均匀而有光泽；一块粗麻布则 coarse 且多变。我们的眼睛和双手能立即感知这些特性。我们称之为纹理。但从根本上说，它*是*什么？它是材料微小组成部分的空间排列方式——重复的图案、随机性、平滑度或粗糙度。

现在，想象你是一名放射科医生，正在查看一张医学扫描图，比如一张肿瘤的MRI图像。你可能会注意到肿瘤的某些部分看起来“异质”或“混乱”，而其他部分则看起来“同质”或“平滑”。这种视觉纹理不仅仅是一种美学特질；它通常包含了关于底层生物学的重要信息。更混乱的纹理可能暗示着一种更具侵袭性的癌症。但是，我们如何才能超越“混乱”或“平滑”这样主观的描述呢？我们如何教机器“看懂”纹理，更重要的是，如何量化它？

这就是[纹理分析](@entry_id:202600)的核心挑战。我们需要创建一种数学语言来描述这些视觉图案，将我们关于平滑度、颗粒感和条纹感的直觉转化为客观、可重复的数字。让我们从头开始构建这样一种语言。

### 游程：一个简单却影响深远的概念

让我们暂时忘记复杂的数学，从一个非常简单的想法开始。想象一张[数字图像](@entry_id:275277)是一个像素网格，就像一个棋盘。每个方格都有特定的灰度，我们可以用一个数字来表示——比如说，低数值代表深色，高数值代表浅色。这个为灰度指定数字的过程称为**量化**。

现在，想象你是一只小蚂蚁，要穿过这个像素网grid。目前，你只能沿着一条水平直线从左到右行走。当你踏上每个像素时，你会报出它的灰度值。“**游程**”就是你报出的数字保持不变的一段连续像素序列。当数字变化时，这个游程就结束了，新的游程开始。因此，一个游程由两个要素定义：它的灰度级（是什么颜色）和它的长度（跨越多少个像素）。

识别游程这个简单的行为为我们提供了一种看待图像的新方式。我们不再把它看作是单个像素的集合，而是连续片段的集合。图像的“平滑”区域会产生很长的游程。一个“繁忙”或“颗粒状”的区域会产生大量很短的游程。而“条纹状”纹理则表现为与我们行进方向一致的长而均匀的序列占主导 [@problem_id:5221694]。我们已经从基于像素的描述迈向了基于结构描述的第一步。

### 灰度游程矩阵（GLRLM）：纹理的“会计账本”

我们走遍了整张图像，得到了一长串我们找到的所有游程的列表：“一个灰度级为5，长度为10的游程”，“一个灰度级为2，长度为3的游程”，等等。这个列表是杂亂無章的。为了整理这种混乱，我们可以建立一个简单的表格，一个纹理的“会计账本”。这个表格就是我们所说的**灰度游程矩阵**（**GLRLM**）。

其结构很简单：
- 表中的每一行对应一个不同的**灰度级** ($g$)。
- 每一列对应一个不同的**游程长度** ($r$)。
- 表中每个单元格内的数字，我们可以称之为 $P(g,r)$，就是一个计数：在我们的图像中，我们找到了多少次具有特定灰度级和特定长度的游程？

让我们用一个4x4的微小图像块来具体说明，就像分析师在实际研究中可能检查的那样 [@problem_id:4613014]。为简单起见，我们假设它只被量化为两个灰度级，1（白色）和2（黑色）。

$$
I = \begin{pmatrix}
1  & 1 & 1 & 2 \\
2  & 2 & 1 & 1 \\
1  & 2 & 2 & 2 \\
2  & 2 & 1 & 1
\end{pmatrix}
$$

让我们扮演蚂蚁，水平穿过每一行：
- **第1行**: 一个灰度级为1，长度为3的游程。然后一个灰度级为2，长度为1的游程。
- **第2行**: 一个灰度级为2，长度为2的游程。然后一个灰度级为1，长度为2的游程。
- **第3行**: 一个灰度级为1，长度为1的游程。然后一个灰度级为2，长度为3的游程。
- **第4行**: 一个灰度级为2，长度为2的游程。然后一个灰度级为1，长度为2的游程。

现在我们来填写我们的账本，即GLRLM。我们统计计数：
- 灰度级为1的游程：我们找到了一个长度为1的，两个长度为2的，以及一个长度为3的。
- 灰度级为2的游程：我们找到了一个长度为1的，两个长度为2的，以及一个长度为3的。

所以，我们的GLRLM, $P(g,r)$, 看起来会是这样（对于 $g \in \{1,2\}$ 和 $r \in \{1,2,3\}$）：

$$
P(g,r) = \begin{pmatrix}
1  & 2 & 1 \\
1  & 2 & 1
\end{pmatrix}
$$

这个矩阵是图像在水平方向上纹理的一个强大的统计摘要。如果我们垂直或对角扫描，我们会得到一个不同的GLRLM，揭示纹理在那些轴向上的属性。这种方向依赖性不是一个缺陷，而是一个特性！它使我们能够检测**各向异性**——即纹理在不同方向上是否不同，就像木材的纹理一样。

### 强调特征：将账本转化为洞见

GLRLM是一个极佳的摘要，但它仍然是一个数字表格。对于许多应用，比如训练机器学习模型，我们希望将其精髓提炼成几个单一而强大的数字。这些数字被称为**特征**。

让我们试着创造一个特征来衡量“条纹感”。正如我们所说，条纹状的纹理有许多长游程。所以我们希望有一个特征，当GLRLM中长游程对应的列数值较大时，该特征值也较高。我们如何实现这一点呢？加权平均是一个自然的想法。我们可以对所有游程求和，但给长游程更大的权重。一个简单的方法是用每个游程长度的平方 $r^2$ 来加权。这*确实*强调了较长的游程。然后我们除以总游程数 $N_r = \sum_{g,r} P(g,r)$，以得到一个规范的平均值。这就得到了**长程强调 (LRE)** 特征：

$$
\mathrm{LRE} = \frac{1}{N_r} \sum_{g} \sum_{r} r^2 P(g,r)
$$

一个高的LR[E值](@entry_id:177316)告诉我们图像纹理以长的连续游程为主——即它是“粗糙的”或“条纹状的”。

那相反的情况呢？我们如何衡量“颗粒感”或“繁忙程度”？这对应于由短游程主导的纹理。我们可以使用相同的逻辑，但这次我们想给*短*游程更大的权重。一个巧妙的方法是用游程长度平方的倒数 $1/r^2$ 来加权。这对长度为1的游程给予了巨大的权重，且权重随游程变长而迅速减小。这就得到了**短程强调 (SRE)** 特征：

$$
\mathrm{SRE} = \frac{1}{N_r} \sum_{g} \sum_{r} \frac{P(g,r)}{r^2}
$$

一个高的SRE值告诉我们图像是“零碎的”，灰度级频繁变化——即它是“细粒度的”或“颗粒状的”。[@problem_id:3860059] 这些从简单直觉得出的公式，正是该领域使用的标准定义 [@problem_id:4554340]。无论我们分析的是2D图像块还是来自CT或MRI扫描的3D体积，同样的逻辑都适用 [@problem_id:4567111]。

让我们为我们的4x4示例计算这些值。总游程数是 $N_r=8$。
- LRE: $\frac{1}{8} \left[ (1 \cdot 1^2 + 2 \cdot 2^2 + 1 \cdot 3^2)_{\text{level 1}} + (1 \cdot 1^2 + 2 \cdot 2^2 + 1 \cdot 3^2)_{\text{level 2}} \right] = \frac{1}{8}(18+18) = \frac{36}{8} = 4.5$。
- SRE: $\frac{1}{8} \left[ (\frac{1}{1^2} + \frac{2}{2^2} + \frac{1}{3^2})_{\text{level 1}} + (\frac{1}{1^2} + \frac{2}{2^2} + \frac{1}{3^2})_{\text{level 2}} \right] = \frac{1}{8}\left(2 \cdot \left(1 + \frac{1}{2} + \frac{1}{9}\right)\right) = \frac{29}{72} \approx 0.403$。

这些数字现在定量地描述了我们这个小图像中的纹理。

### 物理学家的检验：不变性与边缘案例

一个好的物理理论应该产生不依赖于我们在测量系统中所做任意选择的结果。让我们将这种思想应用于我们的纹理特征。

如果我们仅仅改变灰度级的“名称”，会发生什么？假设我们有一张灰度级为 {1, 2, 4} 的图像。如果我们重新标记，称它们为 {5, 7, 11} 会怎样？游程的空间模式——即图像的结构——完全没有改变。一个原先灰度级为“2”、长度为5的游程，现在变成了灰度级为“7”，但它仍然是在相同位置的一个长度为5的游程。如果我们的特征真正衡量的是空间纹理，它们应该不受这种变化的影响。

让我们看看SRE和LRE的公式。它们对计数 $P(g,r)$ 求和，并按游程长度 $r$ 加权。灰度值 $g$ 本身从未出现在计算中！它只是行的索引。因此，SRE和LRE对这种灰度级重新标记是完全**不变的**。它们纯粹地捕捉了游程长度的[空间分布](@entry_id:188271)。这是一个深刻的洞见：这些特征成功地将纹理的一个特定组成部分（空间结构）与另一个（[强度分布](@entry_id:163068)）分离开来。其他一些确实在其公式中使用灰度值的特征，比如高灰度级强调（按 $g^2$ 加权），当然就不是不变的，它们捕捉的是纹理的不同方面 [@problem_id:4564405]。

另一个经典的测试是看在极端情况下会发生什么。
- **单个体素的ROI：** 如果我们的区域只有一个灰度级为 $g$ 的像素会怎样？我们的机制不应该崩溃。确实，我们发现只有一个长度为1、灰度级为 $g$ 的游程。GLRLM中只有一个“1”。总游程数 $N_r=1$。代入公式，我们得到 $SRE=1$ 和 $LRE=1$，游程长度的方差为0。一切都定义良好且合情合理 [@problem_id:4564392]。
- **颜色均匀的ROI：** 如果我们的区域是一大片单一灰度级（比如 $g=1$）的区域会怎样？此时，灰度级没有变化，所以灰度方差为0。然而，这个区域将由不同长度的游程组成。我们的SRE和LRE特征将捕捉这些游程长度的分布，提供对该区域几何形状的有意义的描述，即使其颜色是均匀的 [@problem_id:4564388]。

这些特征在这些边缘案例中的稳健性让我们相信它们的数学公式是可靠的。

### 工程师的困境：细节决定成败

到目前为止，我们的旅程一直处于一个纯净、理想化的世界。但是当我们将这些思想应用于现实世界的医学图像时，事情就变得复杂了。我们在分析过程中做出的具体、看似微不足道的选择，可能对最终的数值产生重大影响，给科学结果的[可重复性](@entry_id:194541)带来巨大挑战。

考虑第一步：量化。我们如何决定灰度级的[分箱](@entry_id:264748)边界？一种常用方法是**固定[分箱](@entry_id:264748)数（FBN）**，即取区域内强度的完整范围，并将其划分为（例如）32个等宽的箱。另一种是**固定[分箱](@entry_id:264748)宽度（FBW）**，即为所有图像定义一个通用的分箱宽度（例如10个强度单位）。

现在，想象两家医院使用的MRI扫描仪有轻微不同的校准，导致一台扫描仪的输出总是稍微亮一些 ($x' = \alpha x + \beta$)。使用FBN方法时，由于分箱是相对于*图像内*的最小和最大强度，灰度级的分配可以完全不受这种缩放的影响。但使用FBW方法时，箱在[绝对空间](@entry_id:192472)中是固定的，这种缩放会将强度值移动到不同的分箱边界，从而完全改变GLRLM及其衍生的所有特征 [@problem_id:4564435]。仅此一项选择就可能决定一个特征是稳健的生物标志物还是无用的数字。

这只是冰山一角。为了确保在Boston的实验室测量的“长程强调”与在Tokyo测量的相同，必须 meticulous地定义和报告一系列参数 [@problem_id:4564395]：
- **离散化：** FBN还是FBW？多少个箱，或者宽度是多少？[分箱](@entry_id:264748)边界如何处理？
- **方向性：** 分析了哪些方向（2D中的 $0^\circ, 45^\circ, 90^\circ, 135^\circ$ 等，或3D中的13个方向）？
- **体素间距：** 像素是正方形吗？如果不是，分析前是否将图像[重采样](@entry_id:142583)为各向同性？这会极大地改变游程长度。
- **掩模处理：** 肿瘤内的孔洞或未分析区域如何处理？它们会中断游程还是被忽略？
- **聚合：** 是为每个方向计算特征然后取平均值？还是将所有方向的GLRLM合并成一个，然后再计算单个特征？这两种方法会产生不同的结果。

这就是支撑科学的工程学。像**影像生物标志物标准化倡议（IBSI）**这样的组织致力于在这些细节上达成共識。这可能看起来很繁琐，但正是这种必要的严谨性，让我们能够构建一种可靠、通用的纹理描述语言，将“计数游程”这样一个简单而美好的想法转变为强大的发现工具。

