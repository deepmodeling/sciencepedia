## 引言
描述一个表面的纹理——比如砂纸的粗糙与大理石的光滑——对人类来说是直观的，但对计算机来说却是一个深远的挑战。像直方图这样仅计算像素强度的简单统计方法，无法捕捉定义纹理的空间排列。这使我们在计算分析图像（从卫星地貌到医学扫描）中的复杂模式方面存在着一个关键的空白。灰度[共生](@entry_id:142479)矩阵（GLCM）为这个问题提供了一个优雅的解决方案，它将焦点从存在*哪些*灰度级转移到它们在空间上*如何*相互关联。本文将探讨作为[纹理分析](@entry_id:202600)基础工具的 GLCM。首先，“原理与机制”一章将解构 GLCM 是如何构建、解释并概括为有意义的 Haralick 特征的。随后，“应用与跨学科联系”一章将展示其在不同领域的强大能力，并深入探讨要求严苛的医学放射组学领域，在该领域，[纹理分析](@entry_id:202600)有望彻底改变诊断和治疗监测。

## 原理与机制

想象一下，你正试图描述光滑的大理石台面和一块粗糙的砂纸之间的区别。你不会只列出你看到的颜色。你可能会说大理石是“均匀的”，而砂纸是“粗糙的”和“多变的”。你本质上是在描述纹理。但我们如何教计算机看到这种差异呢？一个简单的直方图，仅仅计算每种亮度的像素数量，将会彻底失败。完全有可能创建两幅[直方图](@entry_id:178776)完全相同但一幅看起来像随机噪点而另一幅像有序条纹的图像。[直方图](@entry_id:178776)知道存在*哪些*灰度级，但它完全忽略了它们是*如何*排列的。

为了捕捉纹理，我们需要问一个更聪明的问题：不仅仅是“有哪些灰度级？”，而是“哪些灰度级倾向于成为邻居？”这就是**灰度[共生](@entry_id:142479)矩阵（GLCM）**核心的美妙而简单的思想。

### 构建矩阵：邻居关系的统计

让我们从零开始构建一个 GLCM。这就像对像素关系进行一次普查。在开始计数之前，我们需要准备好我们的图像。

首先，来自相机或医学扫描仪的图像可能包含成千上万甚至数百万个不同的强度值。这太详细了。因此，我们的第一步是**离散化**：我们将连续的强度值分组为可管理的若干个分箱，或称**灰度级**。例如，我们可能决定用仅 64 个灰度级来表示整个强度范围。我们如何做到这一点很重要。我们可以使用**固定分箱数（FBN）**方法，将强度范围强制划分为恰好 64 个分箱；或者使用**固定分箱宽度（FBW）**方法，其中每个[分箱](@entry_id:264748)都有一个定义的宽度（比如，在 CT 扫描中为 25 亨氏单位）。这些选择，由像图像生物标志物标准化倡议（IBSI）这样的组织进行标准化，决定了我们最终矩阵的大小和属性 [@problem_id:5221677]。操作的顺序，例如我们是在离散化之前还是之后对图像强度进行归一化，也可能至关重要，尽管在某些情况下结果是相同的 [@problem_id:4545769]。

一旦我们的图像被离散化，我们就可以开始普查了。我们需要定义我们所说的“邻居”是什么意思。这是通过一个空间**偏移量**来定义的，它只是一个距离和一个方向。让我们选择一个简单的偏移量：向右一个像素（距离 $d=1$，角度 $\theta=0^{\circ}$）。

现在，我们逐个像素地遍历图像。对于每个像素，我们查看它的值（我们称之为 $i$）和由我们偏移量定义的邻居的值（我们称之为 $j$）。然后，我们在一个网格或矩阵中找到单元格 $(i, j)$，并将我们的计数加一。如果我们有一个如下所示的图像块 [@problem_id:4567098]：

$$
\mathbf{X} \;=\;
\begin{pmatrix}
1  2  2  3 \\
2  1  3  4 \\
\vdots  \vdots  \vdots  \vdots
\end{pmatrix}
$$

看左上角的像素，它的值是 $1$，它右边的邻居的值是 $2$。所以，我们在矩阵的 $(1, 2)$ 单元格中增加计数。下一对是 $(2, 2)$，所以我们增加 $(2, 2)$ 单元格的计数。我们对图像中所有有效的像素对重复这个过程。

最后一步是**归一化**。原始计数很难在不同大小的图像之间进行比较。所以，我们将矩阵中的每个计数除以我们统计的总对数。这将我们的计数矩阵转换为一个概率矩阵，其中每个条目 $P(i, j)$ 是从一个灰度级为 $i$ 的像素，按我们选择的偏移量找到一个灰度级为 $j$ 的像素的概率。这个矩阵中所有条目的总和现在正好是 1，使其成为一个合适的联合概率分布 [@problem_id:3860016]。这个归一化后的矩阵就是我们的 GLCM。

### 解读矩阵：揭示模式

GLCM 的魔力在于，图像的视觉纹理现在被编码在这个数字矩阵的结构中。

- **主对角线 ($i=j$)：** 沿主对角线的条目 $P(i, i)$ 代表一个像素和它的邻居具有*完全相同*灰度级的概率。如果这些概率很高，意味着纹理主要由相同颜色的连续区域组成。GLCM 的“质量”将集中在对角线上。这对应于视觉上平滑或均匀的纹理。

- **偏离对角线的元素 ($i \neq j$)：** 远离对角线的条目代表具有非常不同灰度级的像素对。如果 $|i-j|$ 很大的像素对有很高的概率，这意味着纹理是“粗糙的”并且充满急剧的过渡。GLCM 的[质量分布](@entry_id:158451)在远离对角线的地方。

让我们考虑两个假设的肿瘤区域，它们具有相同的整体亮度分布但空间排列不同 [@problem_id:4547782]。一个区域 $X$ 有大块连续的组织，而另一个区域 $Y$ 有相同的组织精细地混合在一起，或称“犬牙交错”。
- 对于区域 $X$，一个像素和它的邻居很可能在同一个组织块中，所以它们的灰度级会相同。它的 GLCM 在对角线上将有很大的值。
- 对于区域 $Y$，一个像素旁边经常是不同组织类型的像素。它的 GLCM 在偏离对角线的单元格中将有显著的值。

这两种纹理看起来完全不同，它们的 GLCM 完美地反映了这种差异，即使一个简单的直方图会宣称它们是相同的。

### 从矩阵到意义：Haralick 特征

一个完整的矩阵仍然有点笨重。我们希望将其结构提炼成几个有意义的数字。这些汇总统计量通常被称为 **Haralick 特征**，它们量化了我们观察矩阵时所看到的东西。

- **能量 (Energy)：** 计算公式为 $\sum_{i,j} P(i,j)^2$。通过对每个概率进行平方，我们给予了较高值不成比例的权重。想象一个所有像素都具有相同灰度级的完美均匀图像。它的 GLCM 将只有一个值为 $1$ 的条目，其余均为 $0$。能量将是 $1^2 = 1$，这是其可能的最大值。现在，想象一下添加一个不同颜色的边界 [@problem_id:5221645]。突然间，新的共现对出现，概率分布开来，能量下降。因此，**能量**，也称为**角二阶矩 (Angular Second Moment)**，是纹理**均匀性**或**有序性**的度量。高能量意味着一个简单、周期性或均匀的模式 [@problem_-id:4917111] [@problem_id:4344313]。

- **对比度 (Contrast)：** 计算公式为 $\sum_{i,j} (i-j)^2 P(i,j)$。这里，权重因子 $(i-j)^2$ 在对角线上为零，并且随着我们远离对角线而迅速增长。这个特征明确地惩罚不同灰度级之间的过渡，对更大的差异给予更多的权重。它直接测量了 GLCM 远离其对角线的“扩散”程度。因此，**对比度**是局部**变化或粗糙度**的度量。高对比度值意味着具有锐利边缘的粗糙纹理 [@problem_id:4567098] [@problem_id:4917111] [@problem_id:4344313]。

- **[同质性](@entry_id:636502) (Homogeneity)：** 计算公式为 $\sum_{i,j} \frac{P(i,j)}{1+(i-j)^2}$。这本质上与对比度相反。权重因子在对角线上为 $1$，并随着我们远离对角线而减小。它奖励 GLCM 将其[质量集中](@entry_id:175432)在对角线附近。因此，**同质性**是局部**均匀性**的另一个度量，对于平滑的纹理，其值会很高 [@problem_id:4344313]。

- **熵 (Entropy)：** 计算公式为 $-\sum_{i,j} P(i,j) \ln(P(i,j))$。这个公式直接来[自信息](@entry_id:262050)论。熵是随机性或复杂性的度量。对应于高度可预测、有序纹理的 GLCM，其概率将集中在少数几个单元格中，导致低熵。一个复杂、不可预测的纹理会将概率更均匀地分布在许多单元格中，从而产生高熵 [@problem_id:4547782] [@problem_id:4344313]。

### 综合应用：现实世界的复杂性

到目前为止，我们这个简单的模型有一些漏洞。现实世界——以及我们拍摄的图像——更为复杂。

首先，纹理通常不依赖于一个特定的方向。一块砂纸无论你从左到右还是从上到下看都是粗糙的。为了捕捉这一点，我们不能依赖于单个偏移量得到的单一 GLCM。相反，我们为许多不同的方向计算 GLCM——对于一个 3D 图像，到直接邻居有 13 个独特的方向。然后我们可以用两种方式之一来组合信息：**合并 (merging)**，即在计算特征之前将所有方向的计数矩阵相加得到一个大的、旋转平均的矩阵；或者**平均 (averaging)**，即先计算每个方向的特征，然后对得到的特征值进行平均 [@problem_id:4567141]。

其次，也许是最美妙的一点，我们必须尊重图像创建的物理过程。在像 CT 这样的医学成像中，“像素”实际上是称为**体素 (voxels)** 的三维体积。通常，这些体素不是完美的立方体。一台扫描仪可能产生一个平面内分辨率为 $0.8 \text{ mm} \times 0.8 \text{ mm}$ 的精细图像，但层间距却厚得多，为 $5 \text{ mm}$ [@problem_id:4561092]。这是一个**各向异性 (anisotropic)** 的网格。如果我们天真地使用“1-体素”偏移量，z 方向上的一步代表的物理跳跃比 x 或 y 方向上的一步长六倍多！将 $0.8 \text{ mm}$ 和 $5 \text{ mm}$ 上的灰度共生情况视为等效，在物理上是毫无意义的。由此产生的纹理特征将被扭曲和带有偏见。这揭示了一个深刻的联系：要正确解释数学模式，我们必须理解测量的物理现实。我们必须要么将图像[重采样](@entry_id:142583)为各向同性的体素，要么使用能够“感知”各向异性间距的[特征提取](@entry_id:164394)算法。

因此，GLCM 不仅仅是一个聪明的算法。它是一种思维方式，是连接图像原始数据和对其结构进行有意义、定量描述的桥梁。它告诉我们，要看到纹理，我们必须关注的不是事物本身，而是它们之间的关系。

