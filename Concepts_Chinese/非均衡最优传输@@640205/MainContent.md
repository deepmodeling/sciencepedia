## 引言
如何高效地将资源从一组源头移动到一组目的地，是一个出现在无数领域中的基本挑战。在数学中，这一问题被最优传输 (Optimal Transport, OT) 理论形式化。OT 是一个强大的框架，通过寻找将一个[分布](@entry_id:182848)转换为另一个[分布](@entry_id:182848)的成本最低的方式来比较它们。几十年来，经典 OT 提供了深刻的见解，但它建立在一个僵化的支柱上：[质量守恒](@entry_id:204015)。它假设源头的“物质”总量与目的地所需的总量完全相等。

然而，在许多现实世界的系统中，尤其是在生物学中，这种平衡是罕见的例外。细胞群会增殖和萎缩，基因会表达和沉默，分子会被创造和降解。将经典 OT 应用于这些动态的[开放系统](@entry_id:147845)，往往会得出误导性的结论，甚至完全失败。这一差距凸显了对一种更灵活工具的需求——一种能够解释质量变化的工具。这正是非均衡最优传输 (Unbalanced Optimal Transport, UOT) 的作用，它是一种拥抱现实世界动态性的推广，允许质量以一定代价被创造和销毁。

本文将探索非均衡最优传输的世界。在第一部分 **原理与机制** 中，我们将剖析均衡 OT 的局限性，并直观地构建 UOT 更宽松规则背后的逻辑，探索使其发挥作用的关键概念。随后的 **应用与跨学科联系** 部分将带领读者遍览其多样化的用例，揭示同一个数学思想如何在[单细胞基因组学](@entry_id:274871)和[数值宇宙学](@entry_id:752779)等截然不同的领域中，为我们描绘出更清晰的过程图景。

## 原理与机制

### 传输的画布：一个完美平衡的世界

想象一下，沙滩上有一系列沙堆，代表你的供应。在沙滩的其他地方，有一些标记好的区域，代表你的需求，你需要在那里建造沙堡。每个沙堆都有特定数量的沙子，每个沙堡也需要特定数量的沙子。沙堆中的沙子总量与建造沙堡所需的总量完全相等。你的任务是移动沙子。为了高效，你希望以最少的总工作量来完成这项任务。将一桶沙子从某个沙堆移动到某个沙堡位置所需的工作量取决于它们之间的距离。那么，移动所有沙子的最高效方案是什么？

这个简单的谜题抓住了**经典最优传输 (OT)** 的精髓。在数学中，我们用一个“源”[分布](@entry_id:182848) $\mu$ 来代替沙堆，用一个“目标”[分布](@entry_id:182848) $\nu$ 来代替沙堡位置。[分布](@entry_id:182848)只是一种描述某个量——我们称之为**质量**——如何在空间中[分布](@entry_id:182848)的方式。在我们的单[细胞生物学](@entry_id:143618)例子中，“空间”是一个高维的“基因表达空间”，其中每个点代表一个细胞的完整状态，而该点的“质量”代表处于该状态的细胞数量 [@problem_id:3335602]。OT 问题就是找到一个**传输方案** $\pi$，使得总传输成本最小化。

方案 $\pi_{ij}$ 告诉我们应该从源位置 $i$ 移动多少质量到目标位置 $j$。如果移动一个单位质量的成本是 $C_{ij}$，那么总成本就是 $\sum_{i,j} C_{ij} \pi_{ij}$。由 Leonid Kantorovich 提出的现代公式的巧妙之处在于，将游戏规则表述为一个线性规划问题 [@problem_id:3335583]。规则简单但严格：

1.  **每个源的所有质量都必须运出。** 对于每个拥有质量 $a_i$ 的源沙堆 $i$，所有*运出*它的沙子总和必须等于 $a_i$。数学上表示为 $\sum_j \pi_{ij} = a_i$。
2.  **每个目标的需求都必须被精确满足。** 对于每个需求为 $b_j$ 的目的地 $j$，所有*运入*它的沙子总和必须等于 $b_j$。数学上表示为 $\sum_i \pi_{ij} = b_j$。

这些被称为**边缘约束**。它们强制形成一个完美平衡的世界。注意到，如果将第一条规则对所有源求和，你将得到总供应量。如果将第二条规则对所有目的地求和，你将得到总需求量。为了使规则保持一致，总供应量必须等于总需求量。这就是经典 OT 的基本假设：**质量是守恒的**。

### 当世界不再平衡：画布上的裂痕

这个完美平衡世界的假设既优美又强大，但现实往往是混乱的。当我们的世界不平衡时会发生什么？在生物学中，这是常态，而非例外。当我们追踪一个细胞群从起始时间 $t_0$ 到结束时间 $t_1$ 的变化时，细胞不仅会改变它们的状态，还会繁殖（**增殖**）或死亡（**凋亡**）。几乎可以肯定，$t_1$ 时刻的细胞总数会与 $t_0$ 时刻不同。

在这种情况下，我们优雅的 OT 框架会发生什么？如果沙子的总供应量不等于总需求量，我们美丽的机器就会崩溃。这两条规则变得相互矛盾。你根本无法设计出一个既能运出总共 12 吨沙子，又能送达总共 9 吨沙子的方案。这个问题在数学上变得**不可行**——没有解 [@problem_id:3198150]。

一个常见的变通方法是假装问题是平衡的。例如，人们可能会将两个大小不同的细胞群进行重新缩放，使它们的总“质量”都为 1，从而将它们变成[概率分布](@entry_id:146404)。但这是一种深刻且常常具有误导性的简化。它含蓄地假设所有细胞类型的生长或死亡都是均匀发生的，这在生物学上是异想天开的 [@problem_id:3335584]。例如，在免疫应答中，特定类型的 T 细胞可能会扩增一千倍，而其他类型的 T 细胞则会减少。对数据进行归一化，就好比观看一部激动人心的赛车电影和一部宁静的花园电影，然后调整两者的亮度，使它们的平均光照水平相同——你已经丢失了故事中最重要的部分！

当我们考虑两个群体没有任何共同细胞类型的情况时，这种危险就更加明显了 [@problem_id:2848934]。想象一下，试图将一个免疫细胞群体与一个脑细胞群体进行匹配。一个经典的 OT 算法，在被迫为每个细胞寻找匹配的情况下，会产生一个完全虚假的映射，将“最接近”的脑细胞和免疫细胞配对，并暗示一种不存在的生物学关系。它在一条无法跨越的鸿沟上画了线。为了真正地模拟现实世界，我们需要一个新的框架，一个能够优雅地处理不平衡的框架。我们需要**非均衡最优传输 (UOT)**。

### 一个更宽容的宇宙：非均衡传输的艺术

我们如何建立一套更宽容的规则呢？关键在于放宽严格的边缘约束。有两种非常直观的方式来思考这个问题。

#### 宇宙垃圾箱

第一种方法是构建一个巧妙的虚构概念：一个“宇宙垃圾箱”[@problem_id:2892337]。想象一下，除了真实的源位置和目标位置外，还存在一个概念上的倾倒场。现在，对于源处的每一个质量单位，我们都有一个选择：要么将其运输到一个真实的目标位置，要么将其运输到垃圾箱。将质量发送到垃圾箱代表细胞死亡或凋亡。

同样，我们可以不仅从真实来源为我们的目标位置获取质量，也可以从垃圾箱获取。从垃圾箱获取质量代表细胞出生或增殖。

当然，使用垃圾箱不能是免费的，否则所有质量都会被简单地倾倒并重新创造。我们必须为每一个被发送到或从垃圾箱获取的质量单位分配一个惩罚，我们称之为 $\tau$。现在，优化过程面临一个有趣的选择。对于源 $i$ 的一个质量单位，只有当[运输成本](@entry_id:274604) $C_{ij}$ 小于倾倒它的成本 $\tau$ 时，它才会被发送到目标 $j$。否则，模型会发现让该质量“死亡”更“便宜”。同样，只有当创造它的成本 $\tau$ 小于从任何可用来源运输它的成本时，一个新的质量单位才会在目标 $j$ 出现。这个漂亮的技巧将我们这个病态的非均衡问题，转化为了一个在包含垃圾箱的扩展空间上更大但完全适定的*均衡*问题。

#### 软约束与散度惩罚

第二个更抽象的视角也能得到相同的结果。我们可以用偏好来软化边缘上的严格[等式约束](@entry_id:175290)，而不是硬性规定。新的目标是找到一个传输方案 $\pi$，它能平衡两个相互竞争的愿望：
1.  保持传输成本 $\sum C_{ij}\pi_{ij}$ 低。
2.  确保我们方案的边缘[分布](@entry_id:182848)，我们称之为 $\mu'$ 和 $\nu'$，不会与我们原始的目标边缘[分布](@entry_id:182848) $\mu$ 和 $\nu$ 偏离太远。

我们需要一种方法来量化这种偏差的“成本”。**Kullback-Leibler (KL) 散度**是完成此任务的完美工具，这是一个源于信息论的概念 [@problem_id:3335593]。KL 散度 $D_{\mathrm{KL}}(\mu' \,\|\, \mu)$ 衡量了当我们使用[分布](@entry_id:182848) $\mu'$ 作为真实[分布](@entry_id:182848) $\mu$ 的近似时所产生的“信息损失”或“意外程度”。它总是非负的，且仅当两个[分布](@entry_id:182848)完全相同时才为零。

我们的新[目标函数](@entry_id:267263)变成了一个三方权衡：

$$ \text{最小化} \quad (\text{传输成本}) + \tau \cdot (\text{源偏差惩罚}) + \tau \cdot (\text{目标偏差惩罚}) $$

其中惩罚项由 KL 散度给出。参数 $\tau$，即我们垃圾箱比喻中的同一个参数，现在作为一个旋钮，控制我们执行边缘约束的严格程度。如果 $\tau$ 巨大，任何偏差都会受到严重惩罚，我们就会回到均衡 OT 的刚性世界。如果 $\tau$ 很小，模型就可以自由地创造或销毁质量，只要这样做能让它找到一个便宜得多的传输方案。这种表述使得最优的[质量生成](@entry_id:161427)和销毁量能够从数据和成本中自然地产生。

### 参数之舞：微调传输

在实践中，解决这个新的 UOT 问题还涉及另一个要素：**[熵正则化](@entry_id:749012)**。再次想象我们的沙子在移动。一个基本的 OT 方案可能非常“尖锐”——它可能认定绝对最佳的方案是把所有沙子从沙堆 A 全部移动到沙堡 B。而一个经过[熵正则化](@entry_id:749012)的方案则更“模糊”或“平滑”；它倾向于将沙子稍[微分](@entry_id:158718)散开来，将一些从 A 送到 B，但也送一点到 C 和 D，这反映了传输中的不确定性或随机性 [@problem_id:3335646]。这由一个参数 $\varepsilon$ 控制。这不仅通常更符合生物学现实，而且还使得问题在计算上变得极其容易解决，这要归功于一种名为 **Sinkhorn 算法** 的优雅迭代方法。

在该算法中，需要计算两组缩放因子 $u$ 和 $v$，它们可以被看作是每个源和目标位置的势或价格。这些因子被来回更新，直到达到一个稳定的平衡。对于 UOT，更新规则巧妙地将我们的两个关键参数 $\tau$ 和 $\varepsilon$ 编织在一起。更新步骤涉及一个指数 $p = \frac{\tau}{\tau+\varepsilon}$。这一个项就捕捉了整个平衡过程。当 $\tau \to \infty$（接近均衡情况）时，$p \to 1$。当 $\tau \to 0$（让质量自由生成/销毁）时，$p \to 0$。

### 从预算削减到侵袭性细胞

有了这个灵活而强大的框架，我们现在可以解决更丰富的问题集。OT 的核心逻辑是始终优先考虑“最便宜”的路径。如果你的总[运输成本](@entry_id:274604)预算有限，你自然会首先移动[分布](@entry_id:182848)中彼此最接近的部分 [@problem_id:1424935]。UOT 的工作原理类似，但其权衡涉及创造或销毁质量的成本 $\tau$。

通过将 UOT 应用于我们的细胞群，我们终于可以得到一幅完整的图景。我们不仅可以推断出最可能的分化路径，还可以估计哪些细胞亚型正在扩张，哪些正在收缩——这是对增殖和死亡等底层生物动力学的直接解读 [@problem_id:3335646]。

该框架甚至更加通用。一个名为**部分 OT** 的变体允许我们提出不同类型的问题。例如，在[癌症转移](@entry_id:154031)中，可能只有一个肿瘤中小的、高度侵袭性的亚群引起了继发性肿瘤。我们可以问模型：“假设只有一部分比例为 $\kappa$ 的原发肿瘤细胞参与了转移，它们是哪些细胞？”模型将找到大小为 $\kappa$ 的亚群，该亚群可以以最低的可能成本被运输到转移灶，从而为哪些细胞最具侵袭性和迁移性提供了有力的假说 [@problem_id:3335594]。

因此，非均衡最优传输不仅仅是针对一个技术问题的数学修正。它代表了一种深刻的视角转变：从一个刚性的、封闭的完美平衡世界，到一个动态的、开放的宇宙，在这里质量可以诞生也可以消失。它提供了一个镜头，通过它我们不仅能看到事物去向何方，还能看到它们如何生长和消逝，从而揭示出一个更深刻、更忠实于生命世界的图景。

