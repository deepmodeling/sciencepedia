## 引言
在探索数据内部真实关系的过程中，研究人员常常面临一个艰巨的挑战：[混杂变量](@entry_id:199777)。这个隐藏的第三方因素会扭曲暴露与结局之间的表面关联，造成统计错觉或掩盖真实效应。由辛普森悖论等现象例证的这一问题，提出了一个关键问题：我们如何才能从混杂因素的噪音中分离出我们真正感兴趣的效应？Mantel-Haenszel检验为这一问题提供了优雅而有力的解决方案。它提供了一个稳健的框架，通过层层剥离复杂性，揭示出对数据更真实、经过调整的理解。

本文将引导您了解这一现代统计学基石的逻辑和功用。首先，在“原理与机制”一节中，我们将解构该方法，探讨分层、比值比的核心思想，以及如何计算合并估计值并进行显著性检验。然后，在“应用与跨学科联系”一节中，我们将超越其在流行病学中的传统领域，去看看分层分析的基本原理如何应用于从荟萃分析和心理计量学到因果推断和生物信息学等不同领域。

## 原理与机制

### 粗略观察的错觉：一个统计魔术

假设我们正在测试一种新的救命药物。我们进行了一项大规模研究，一部分患者服用该药物，另一部分服用安慰剂。一个月后，我们收集数据，沮丧地发现，服药患者的死亡比例*高于*未服药的患者。这药物似乎有害！在我们扔掉多年的研究成果之前，我们必须问自己一个所有优秀科学核心的问题：我们所做的比较是公平的吗？

这并非纯粹的假设性担忧。在数据世界里，事情并非总是表面看上去那样。比方说，我们的研究涉及两家医院：一家是设备先进的城市医院，另一家是规模较小的乡村医院。很可能，病情最严重的患者，也就是死亡风险本来就更高的患者，被送往了城市医院，而这家医院恰好也更容易获得这种新的实验性药物。而乡村医院的患者病情较轻，主要使用标准疗法。

如果我们只是将所有数据汇集在一起，我们就不再是在比较药物与安慰剂了。实际上，我们是在比较一群病情更重的患者（他们恰好服用了药物）和一群更健康的患者（他们恰好服用了安慰剂）。我们看到的差异可能与药物本身毫无关系，而完全取决于患者的初始健康状况。这种效应的纠缠被称为**混杂（confounding）**，它是数据分析中最危险的陷阱之一。它会制造一种错觉，一种统计学上的悖论，即一种对每个患者亚组都有益的治疗方法，在所有组别合并后却显得有害。这就是著名的**[辛普森悖论](@entry_id:136589)（Simpson's Paradox）** [@problem_id:4934186] [@problem_id:4609416]。

那么，我们如何打破这种错觉？如何确保我们是在进行“苹果与苹果”的比较？

### 分层策略：[分而治之](@entry_id:139554)

解决方案既优雅又简单：如果你怀疑某个变量（比如患者的初始风险水平）正在混淆视听，那就不要一次性查看整个数据集。相反，根据那个变量将数据切分成不同的组，即**层（strata）**。我们可以为高风险患者创建一个组，为低风险患者创建另一个组。然后，我们在*每个组内*分别分析药物的效果。在高风险层内，我们比较服药的患者和未服药的患者。在低风险层内，我们做同样的操作。

在每个分层内部，“混杂因素”被保持恒定。我们不再是比较重病患者和健康患者；我们是在比较重病患者与其他重病患者，健康患者与其他健康患者。这种称为**分层（stratification）**的方法，使我们能够控制[混杂变量](@entry_id:199777)，从而对药物的真实效果获得更清晰、无偏的看法 [@problem_id:4934186]。

如果我们有多个混杂因素怎么办？比如，年龄和吸烟状况都影响结局。原理是相同的。我们只需创建更精细的分层。我们会有一个“年轻不吸烟者”层，一个“年轻吸烟者”层，一个“年老不吸烟者”层，和一个“年老吸烟者”层。通过在这四个联合分层中分别考察药物的效果，我们可以同时控制年龄和吸烟的效应 [@problem_id:4809036]。

### 衡量每个切片中的效应：比值比

现在我们已将数据切分成可比较的组，我们需要一种方法来衡量药物在每个切片中的效果。为此，我们常常使用简陋但功能强大的 $2 \times 2$ 表。对于每个分层，我们可以像这样统计我们的结果：

| | 结局 (例如，痊愈) | 无结局 (例如，未痊愈) |
| :--- | :---: | :---: |
| **暴露组** (服药) | $a$ | $b$ |
| **非暴露组** (服用安慰剂) | $c$ | $d$ |

计数 $a$ 代表服药并痊愈的人数，$b$ 是服药但未痊愈的人数，依此类推。

为了量化这种关联，我们使用**比值比（odds ratio, OR）**。首先，什么是“比值”（odds）？如果30名患者痊愈，70名未痊愈，那么痊愈的比值是30比70，即 $\frac{30}{70}$。对于服药组，痊愈的比值是 $\frac{a}{b}$。对于安慰剂组，比值是 $\frac{c}{d}$。

比值比就是这两个比值的比率：
$$ \text{OR} = \frac{\text{Odds for Exposed}}{\text{Odds for Unexposed}} = \frac{a/b}{c/d} = \frac{ad}{bc} $$
OR为1意味着两组的比值相同——药物没有效果。OR大于1表明药物增加了痊愈的比值，而OR小于1则表明药物降低了痊愈的比值。比值比为我们提供了一种标准化的方法，来衡量我们每个分层中关联的强度和方向 [@problem_id:4934196]。

### Mantel-Haenszel 的神来之笔：加权共识

分层后，我们为每个组都得到了一个比值比：一个年轻人的OR，一个老年人的OR，一个吸烟者的OR，等等。我们现在面临一个新问题：如何将它们合并成一个单一的、总体的结论？简单地取平均值是错误的，因为一个只有少数患者的微小分层将与一个有数千人的巨大分层获得相同的投票权。

这正是 Nathan Mantel 和 William Haenszel 的天才之处。他们开发了一种程序，用于计算一个单一的、针对[混杂变量](@entry_id:199777)进行调整的**合并比值比**。**Mantel-Haenszel 估计量**本质上是各层特定比值比的加权平均，但它非常巧妙。能够提供更多信息的分层（通常是更大、更均衡的分层）在最终估计中被赋予了更大的权重。

其公式本身非常简洁。对于每个分层 $i$，我们不直接计算比值比，而是计算两个分量：一个类似分子的项 $\frac{a_i d_i}{n_i}$ 和一个类似分母的项 $\frac{b_i c_i}{n_i}$，其中 $n_i$ 是该分层中的总受试者人数。然后我们将这些分量在所有分层中求和，再取其比率：
$$ \hat{\theta}_{MH} = \frac{\sum_{i} \frac{a_i d_i}{n_i}}{\sum_{i} \frac{b_i c_i}{n_i}} $$
这个单一的数字 $\hat{\theta}_{MH}$，就是我们对暴露共同效应的最佳估计，它摆脱了我们用于分层的混杂因素所带来的偏倚 [@problem_id:4609416] [@problem_id:4905088]。它依赖于一个关键假设：药物的真实效应在每个分层中大致相同。我们稍后会回到这个重点。

### 检验现实：Cochran-Mantel-Haenszel 检验

我们的合并比值比可能是1.5，这表明药物是有益的。但这个结果是否可能仅仅是抽样运气——我们特定患者样本中的随机波动所致？我们需要一个正式的检验来看看我们的结果是否具有统计学意义。

 **Cochran-Mantel-Haenszel (CMH) 检验**为此提供了支持。它检验的**零假设**是，真实的共同比值比恰好为1（即药物无效）。该检验的逻辑非常直观。

对于每个分层的 $2 \times 2$ 表，如果我们假设边际总数（暴露总人数、非暴露总人数、痊愈总人数、未痊愈总人数）是固定的，一个有趣的数学现象就会出现。在无关联的零假设下，暴露后痊愈的人数，即我们的单元格 $a_i$，遵循一种称为**[超几何分布](@entry_id:193745)**的特定概率定律。这与你从一副牌中抽出一把牌，计算抽到特定数量红牌的概率所用的数学是相同的。根据这个分布，我们可以计算出 $a_i$ 的*期望*值——即在药物无效的情况下我们平均期望看到的计数——及其方差 [@problem_id:4924690] [@problem_id:4776968]。

CMH检验接着做了一件非常自然的事情：它将所有分层中的*观测*计数（$a_i$）相加，并将这个总和与*期望*计数的总和进行比较。[检验统计量](@entry_id:167372)，通常表示为 $\chi^2_{CMH}$，本质上是总观测计数与总[期望计数](@entry_id:162854)之间差异平方的标准化度量：
$$ \chi^2_{CMH} = \frac{\left( \sum (\text{Observed}_i - \text{Expected}_i) \right)^2}{\sum \text{Variance}_i} $$
如果这个统计量很大，就意味着我们的观测数据与“无效”假设下的期望情况非常不同，从而促使我们拒绝零假设，并断定存在真实的关联 [@problem_id:4809051]。这个简单而强大的检验让我们能够汇集所有精心构建的分层中的证据，以做出一个最终的、严谨的判断。

### 统一性、优美性与注意事项

Mantel-Haenszel程序不仅仅是一种巧妙的统计技巧；它还是一个窗口，让我们得以窥见统计理论优美而相互关联的世界。

**统一性**：这种依赖于简单计数和概率的经典方法，与现代复杂的技巧有着深刻的联系。事实上，CMH检验在渐近上等同于从一种强大的建模工具——**条件逻辑斯蒂回归**中推导出的**计分检验**。这揭示了统计学中一种深刻的统一性：植根于不同哲学的不同路径，往往会通向相同的基本真理 [@problem_id:4809050]。

**优美性**：整个程序建立在一个简单而强大的思想之上：条件化。通过固定我们表格的边际，我们外科手术般地移除了无关信息，并聚焦于我们关心的唯一参数：比值比。它是一种非参数方法，意味着它对数据的基础分布几乎不做假设，这赋予了它一种粗犷、可靠的品质。

然而，即使是最优美的工具也必须谨慎使用。有两个主要的警告需要注意：

1.  **同质性假设**：一个“共同”比值比的概念本身就取决于暴露的效应在所有分层中都是一致的。如果药物对年轻患者非常有效，但对老年患者有害，这就是**效应修饰**（或异质性）的情况。将这些相反的效应平均成一个单一的合并比值比将是毫无意义且具有危险误导性的。因此，一项有原则的分析总是从检验[同质性](@entry_id:636502)开始。如果发现显著的效应修饰，就不应报告合并估计值，而应报告各分层特定的效应 [@problem_id:4934210] [@problem_id:4934186]。

2.  **稀疏性的危险**：为了控制多个混杂因素，我们可能需要将数据切分得非常薄。想象一下按年龄、吸烟、性别和血型进行分层。我们最终可能会得到几十个分层，其中一些只包含极少数个体。这就是**稀疏性**问题。在零计数或计数极小的表格中，支撑CMH检验的统计近似可能会变得不可靠。这在流行病学中造成了一个根本性的权衡：一方面希望控制所有可能的混杂因素（以减少偏倚），另一方面又需要保持足够大的分层以获得稳定的估计（以减少方差）。驾驭这种权衡是这门科学的真正艺术之一 [@problem_id:4809036]。

归根结底，Mantel-Haenszel检验证明了清晰思维的力量。它教导我们要对显而易见的事物持怀疑态度，要通过将其分解为更简单的部分来拆解复杂性，并从这些部分中重建一个更稳健、更真实的理解。它是现代流行病学的基石，也是统计推理在实践中一个优美的例子。

