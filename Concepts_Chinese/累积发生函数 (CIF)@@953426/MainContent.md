## 引言
在[生存数据分析](@entry_id:190868)中，我们常常面临一个复杂的现实：并非所有研究对象都会达到相同的终点。临床试验中的患者可能死于研究目标之外的其他原因，这种情况被称为**[竞争风险](@entry_id:173277)**。忽略这种竞争关系可能导致错误的结论和对患者结局的误导性预测。例如，传统的 [Kaplan-Meier](@entry_id:169317) 方法在这种情况下会失效，因为它无法正确处理因竞争事件而永久脱离风险集的个体。这就迫切需要一种更真实、统计上更稳健的风险度量方法。

本文将介绍**累积发生函数 (CIF)**，这是一种专为应对此挑战而设计的、简洁而强大的工具。它在存在竞争事件的情况下，提供了对绝对风险的真实度量。我们将探讨支撑该方法的基本概念，并了解它如何应用于各个领域，以提供更清晰、更具操作性的见解。

首先，在**原理与机制**部分，我们将深入探讨竞争风险的核心思想，揭示采用简单统计方法的危险性。然后，我们将定义 CIF，并探讨驱动它的两种不同风险模型：用于病因学研究的特定原因[风险率](@entry_id:266388)和用于预后建模的子分布风险率。随后，**应用与跨学科联系**部分将展示 CIF 在现实世界中的影响。我们将看到它如何为医生提供更现实的预后，帮助流行病学家揭示疾病模式，并助力数据科学家在医学领域构建和验证可靠的预测模型。读完本文，您不仅会理解 CIF 是什么，还会明白为什么对于任何在复杂世界中分析事件发生时间数据的人来说，它都是一个不可或缺的工具。

## 原理与机制

想象一场宏大而混乱的比赛。参赛者是临床研究中的患者，而终点并非喜事——它是某个特定的不良事件，比如死于心脏病。然而，这场比赛有一个奇特的规则：有多个不同的终点线。参赛者可能在到达心脏病终点线之前，就因癌症、意外或纯粹的年老而倒下。这些就是**[竞争风险](@entry_id:173277)**。一旦参赛者冲过*任何*一条终点线，他们就永远退出了比赛。如果你已经死于癌症，你就不可能再死于心脏病发作。

这个简单的场景提出了一个深刻的挑战。如果我们发明了一种神奇的新药，可以减缓接近心脏病终点线的参赛者的速度，我们该如何衡量其成功？仅仅记录他们的速度是不够的。如果这种药物在保护心脏的同时，却让他们更有可能跌入癌症的终点线呢？对我们所选结局的简单“胜率”就变得具有欺骗性。我们需要一种更诚实的计分方式。

### 简单方法的隐患

在这种问题上，统计学家工具箱中最常用的工具是生存分析。我们经常看到著名的 Kaplan-Meier 曲线，它显示了人群中“无事件”存活的比例随时间的变化。一个诱人但存在严重缺陷的想法是直接套用这种方法。为了研究心脏病死亡，为什么不把所有其他死亡——因癌症、事故等——都当作参赛者从我们的视线中消失了呢？用统计学术语来说，我们会称他们为“删失”。

但这是一个微妙而危险的错误。删失背后的假设是，该个体本可以继续比赛，而我们只是碰巧与他们失去了联系。一个移居他国的患者被视为删失；他们仍然活着，原则上仍可能心脏病发作。但是，一个死于癌症的患者并非删失。他们已经被永久地从可能死于心脏病的风险人群中移除了[@problem_id:4975267]。将他们视为“删失”，就像假装他们仍在赛道上，只是我们看不见。这会夸大心脏病的重要性，因为我们未能承认，一部分人群由于被竞争事件夺去生命，长远来看根本不会面临心脏病的风险。

### 一种更真实的核算：累积发生函数

为了得到真实的情况，我们必须正视这种竞争。我们需要一种尊重现实的方法。这种方法被称为**累积发生函数 (CIF)**。不要被这个正式的名称吓到；其思想非常简单。特定原因（比如原因 $k$）在给定时间 $t$ 的 CIF 就是：一个个体从时间零点开始，到时间 $t$ 时已经历原因 $k$ 事件的概率。

这是一种基于可观察世界的**绝对风险**。假设我们对一组患者进行了为期五年的随访[@problem_id:4987809]。我们可能会发现，到第五年时：
-   原始组中 $20\%$ 的人死于心脏病（原因 1）。
-   $10\%$ 的人死于癌症（原因 2）。
-   $70\%$ 的人仍然在世。

这些概率之和必须为 1，因为这是仅有的三种可能性。那么，CIF 就是 $F_1(5) = 0.20$ 和 $F_2(5) = 0.10$。就是这么简单。这里没有诡计，没有假装那些已经退出比赛的人仍在赛道上。到第五年时，因*任何*原因死亡的总概率是 $F_1(5) + F_2(5) = 0.30$，这恰好是 1 减去存活概率，即 $1 - 0.70$。这是一本完全平衡且真实的生死账本。

至关重要的是，CIF 是对自然界中发生情况的直接描述。它的定义不依赖于任何关于各原因之间是相关还是独立的假设。衰竭的心脏是否会以某种方式加速癌症的发展，这是一个有趣的问题，但这并不会改变一个可观察到的事实：有一定比例的人死于每种原因[@problem_id:4975298]。CIF 是起点——它是我们试图解释的对象。

### 变化的机制：风险率

要理解 CIF 如何随时间演变，我们需要深入探究风险的引擎。在生存分析中，这个引擎就是**[风险率](@entry_id:266388) (hazard)**，即事件发生的瞬时速率。可以把它想象成风险的速度计：在此时此刻，人们发生特定结局的速度有多快？在[竞争风险](@entry_id:173277)的世界里，我们有两种关键类型的[风险率](@entry_id:266388)。

首先是**特定原因风险率**，记为 $\lambda_k(t)$。这是在时间 $t$ 仍然存活且无事件的个体中，因原因 $k$ 而失败的[瞬时速率](@entry_id:182981)[@problem_id:4829094] [@problem_id:5036252]。它提出了一个非常集中的病因学问题：“对于当前‘健康’的人群，由这一特定原因导致的直接死亡风险有多大？”

特定原因[风险率](@entry_id:266388)与 CIF 之间的联系是基础且直观的。在极小的时间段 $dt$ 内出现的原因 $k$ 的新病例数量，与两件事成正比：可患病的人数，即总生存概率 $S(t)$，以及他们患病的速度，即特定原因[风险率](@entry_id:266388) $\lambda_k(t)$。这给了我们一个优美的[微分](@entry_id:158422)关系[@problem_id:4785709] [@problem_id:4829094]：
$$
\frac{d}{dt} F_k(t) = S(t) \lambda_k(t)
$$
累积发生率的变化是生存率与特定原因[风险率](@entry_id:266388)的乘积。要计算时间 $t$ 的总累积发生率，我们只需将从开始到现在的这些无穷小的贡献加起来：
$$
F_k(t) = \int_0^t S(u) \lambda_k(u) du
$$
这个公式是问题的核心。它告诉我们，因原因 $k$ 而失败的概率不仅取决于其自身的[风险率](@entry_id:266388) $\lambda_k(u)$，还取决于到该时间点为止，在所有其他竞争原因下存活下来的概率 $S(u)$。

### 另一种视角：子分布风险率

特定原因[风险率](@entry_id:266388)非常适合理解生物学机制。但如果我们的目标不同呢？如果我们想预测一个患者在未来五年内发生特定事件的绝对风险呢？上面的公式表明，原因 $k$ 的 CIF 取决于*所有*竞争原因的风险率（因为它们都包含在总生存函数 $S(u)$ 中）。这可能是一个复杂、纠结的网络[@problem_id:4975267]。

统计学家 Fine 和 Gray 天才地提出了另一种看待问题的方式。他们问：我们能否定义一种特殊的风险率，它与单一原因的 CIF *直接*相关，而无需担心其他原因？答案是肯定的，但这需要一次奇特而美妙的思维跳跃。

这种特殊的[风险率](@entry_id:266388)就是**子分布风险率**，通常记为 $\tilde{\lambda}_k(t)$。[风险率](@entry_id:266388)总是在某个“风险集”条件下的速率。对于原因 $k$ 的子分布[风险率](@entry_id:266388)，时间 $t$ 的风险集包括所有尚未经历原因 $k$ 的个体。这意味着它包括那些仍然存活且无事件的个体，*以及那些已经因其他原因死亡的个体*[@problem_id:4610317] [@problem_id:5036252]。

这似乎很荒谬。为什么要把“幽灵”留在我们的风险集中？其逻辑是微妙的。我们正在建模的是*未发生事件 k* 的概率。从这个特定角度看，一个死于癌症的人在“未死于心脏病”方面，和一个仍然活着的人同样“成功”。通过这样定义风险集，我们创造了一种[风险率](@entry_id:266388)，它通过标准的生存-风险关系，优雅地直接映射到原因 $k$ 的 CIF：
$$
F_k(t) = 1 - \exp\left(-\int_0^t \tilde{\lambda}_k(u) du\right)
$$
突然之间，纠结的网络消失了。原因 $k$ 的 CIF 仅取决于其自身的子分布风险率。这使得子分布风险率成为一个极其强大的**预测**工具。如果我们能够模拟患者的协变量（如年龄或血压）如何影响他们的子分布风险率，我们就能直接预测他们经历该事件的绝对风险，并自动考虑了来自其他原因的竞争[@problem_id:4975267]。

我们最终得到了两种优美而独特的工具，用于两种不同的工作：特定原因[风险率](@entry_id:266388)用于研究单个疾病过程的**病因学**，而子分布[风险率](@entry_id:266388)用于**预后**和预测个人在复杂世界中的命运。

### 从抽象原理到具体预测

这些原理不仅仅是抽象的哲学；它们让我们能够构建具体的现实模型。想象一下，我们假设特定原因[风险率](@entry_id:266388)遵循一个简单的模式，比如[威布尔分布](@entry_id:270143)，其中风险随时间 $t$ 的幂次增长[@problem_id:4783813]。我们可以为每个特定原因[风险率](@entry_id:266388) $\lambda_k(t)$ 指定一个模型，并纳入患者的协变量 $X$。

将这些模型代入我们的基本积分公式 $F_k(t) = \int_0^t S(u) \lambda_k(u) du$，然后进行数学推导，一个优美的[闭式](@entry_id:271343)解便会浮现。最终得到的 CIF 方程通常呈现如下形式：
$$
F_k(t \mid X) = \left( \frac{\text{Hazard strength of cause } k}{\text{Sum of all hazard strengths}} \right) \times \left( \text{Probability of any event by time } t \right)
$$
这揭示了竞争的深层结构。因原因 $k$ 而失败的概率是其在总风险中所占的份额，乘以*任何*类型事件发生的总概率。这些原理直接引导我们得出一个量化生存竞赛的公式。

### 现实世界的介入：偏倚与因果关系

当然，医学研究的真实世界比我们清晰的理论模型要混乱得多。一个常见的问题是**延迟进入**，或称左截断[@problem_id:4579844]。在许多研究中，人们在不同的时间点被纳入。如果研究的是一种致命疾病，那么较晚进入研究的人，根据定义，就是幸存者。最脆弱的个体可能已经死亡，因此永远不会被纳入研究。这种“生存者偏倚”会扭曲我们对风险的估计，使人群看起来比实际更健康。理解这些偏倚至关重要，统计学家们已经开发出了一些方法，这些方法依赖于审慎的假设——例如，一旦我们考虑了已知的预后因素，进入研究的时间本身并不提供关于结局的信息。

这把我们引向了最终目标：不仅仅是描述世界，而是改变世界。我们不仅想预测风险；我们还想知道，如果我们给每个人一种新的治疗方法，*将会*发生什么[@problem_id:4987843]。这是**因果推断**的领域。我们寻求的量是**因果 CIF**，定义为在一个假设的世界中，每个人都接受了特定治疗 'a' 的情况下，到时间 $t$ 时经历事件 $k$ 的概率，我们称之为 $F_k^a(t)$。

这是一个深刻的问题。我们无法在同一个人群上重复进行这个实验。然而，在一组关键的“无未测量混杂因素”的假设下，统计理论提供了一条前进的道路。像**g-公式**这样强大的工具，使我们能够使用观测数据——及其所有现实世界中时变协变量的复杂性——来估计这个因果量。本质上，g-公式告诉我们如何对观测数据进行重新加权和平均，以模拟我们希望能够进行的完美随机实验的结果[@problem_id:4987843]。

从一个关于比赛的简单问题，到因果推断的高峰，这段旅程揭示了统计推理的力量与美。累积发生函数及其相关机制不仅仅是公式；它们是一个框架，用以清晰、真实地思考风险、预测和干预，在这个世界里，多种命运皆有可能。

