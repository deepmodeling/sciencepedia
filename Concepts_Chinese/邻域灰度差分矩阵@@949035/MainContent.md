## 引言
在医学影像中，组织内部的微小模式和变化，统称为纹理，可能蕴含着至关重要的诊断和预后信息。放射科医生可能会在视觉上将肿瘤感知为“异质性”或“平滑”的，但将这种定性观察转化为精确、客观的度量标准是一项重大挑战。这一知识鸿沟限制了我们持续追踪疾病进展或预测治疗反应的能力。邻域灰度差分矩阵（NGTDM）提供了一种优雅而强大的解决方案，通过分析像素与其直接邻域之间的关系，为量化纹理的“繁忙度”或“粗糙度”提供了一种稳健的方法。本文将引导您了解 NGTDM，从其基本概念开始。首先，“原理与机制”部分将解构该算法，探索其数学基础及其实际应用中的关键考量。随后，“应用与跨学科联系”部分将展示这一量化工具如何革新从临床肿瘤学到人工智能等多个领域。

## 原理与机制

想象一下，你正从高空飞越一片地景。在很高的高度，你看到大片的色块：一片绿色的森林，一片棕色的田野，一个蓝色的湖泊。这是宏观的景象。当你下降时，你开始看到更精细的细节。森林不仅仅是统一的绿色，而是由单棵树木、阴影和空地组成的复杂织锦。田野也不仅仅是棕色，而是土壤、残茬和石块的混合体。这种局部变化的特性，即表面的“颗粒感”，就是我们直观上所说的**纹理**。

在医学影像中，纹理不仅仅是外观问题，它承载着深刻的信息。癌性肿瘤可能比其周围的健康组织具有不同且更混乱的纹理。量化这种纹理可以帮助医生做出诊断或预测肿瘤对治疗的反应。但是，我们如何教计算机“看见”纹理呢？**邻域灰度差分矩阵（NGTDM）**是对此问题最优雅、最强大的答案之一。这是一个简单的想法，但仔细审视后，它揭示了离散计算、微积分和医学扫描物理现实之间的深刻联系。

### 纹理的本质：像素及其邻域

让我们深入到单个像素的层面。图像中的一个像素有一个值——一个灰度级——代表了该特定点上组织的密度或属性。但像素并非孤立存在。它的意义，它对整体纹理的贡献，来自于它与其邻域的关系。

NGTDM 建立在一个绝妙的问题之上：*对于一个给定的像素，其灰度级与其直接邻域的平均灰度级有多大差异？*

如果一个像素的值与其邻域的平均值非常相似，那么它位于一个平滑、均匀或“粗糙”的区域。如果它的值差异巨大，那么它代表一个高对比度的点，一个“繁忙”或精细纹理的区域。

考虑一个两种组织之间存在清晰边界的简单假设图像 [@problem_id:5221605]。

$$
I=\begin{pmatrix}
12  & 12  & 12  & \dots \\
12  & 12  & 12  & \dots \\
12  & 12  & 12  & \dots
\end{pmatrix}
\quad \text{versus} \quad
I=\begin{pmatrix}
\dots  & 12  & 80  & \dots \\
\dots  & 12  & 80  & \dots \\
\dots  & 12  & 80  & \dots
\end{pmatrix}
$$

在第一种情况下，一个值为 12 的中心像素被其他值为 12 的像素包围。其邻域平均值为 12，因此差值为 $|12 - 12| = 0$。这个区域是完全不繁忙的。在第二种情况下，一个值为 12 的像素位于一个值为 80 的区域边缘。其邻域平均值将介于 12 和 80 之间。例如，如果其邻域中一半是 12，一半是 80，平均值可能是 $(12+80)/2 = 46$。差值 $|12 - 46| = 34$ 很大。这个像素标志着一个“繁忙”的过渡。

这个简单的差值计算是 NGTDM 的基本引擎。

### 一个测量纹理的简单机制

为了构建一个完整的纹理描述，我们只需对感兴趣区域（ROI）中的每个像素重复此过程，然后总结结果。该过程如下 [@problem_id:4612972]：

1.  对于 ROI 中的每个像素，我们查看其灰度级，我们称之为 $i$。
2.  我们确定其邻域（例如，一个 $3 \times 3$ 方形区域内紧邻它的 8 个像素）。
3.  我们计算这些邻域像素灰度级的算术平均值，我们称之为 $\bar{g}$。
4.  我们计算绝对差：$|i - \bar{g}|$。这是该像素对纹理测量的贡献。
5.  最后，我们创建一个汇总表。对于图像中每个可能的灰度级 $g$，我们做两件事：
    *   我们计算具有该灰度级的像素总数 $n_g$。
    *   我们将为这些像素计算出的所有绝对差求和。这个和称为 $s_g$。

所有灰度级 $g$ 对应的 $n_g$ 和 $s_g$ 值的集合就是 NGTDM。它不是典型意义上由行和列组成的“矩阵”，而是一组汇总统计数据，捕捉了与每个灰度色[调相](@entry_id:262420)关的总“繁忙度”。

### 邻域的物理学：大小和形状为何重要

这种方法的美妙之处在于其简单性，但其强大之处来自于对“邻域”的仔细定义。邻域是我们的探针，我们的放大镜。改变其大小和形状会改变我们所看到的东西。

#### 纹理的尺度

如果我们将邻域定义为更大的方形区域——比如 $5 \times 5$ 或 $7 \times 7$ 的窗口，而不仅仅是紧邻的像素，会发生什么？这由一个参数 $\delta$，即邻域半径控制。

当我们增加 $\delta$ 时，我们是在一个更大的区域上取平均。这会产生一种平滑效果，就像信号处理中的低通滤波器。在一个不完全随机的区域中，这个更大的平均值往往是对局部组织属性更稳定的估计。对于中心像素，这个更大、更平滑的平均值通常更接近其自身的值。因此，计算出的差值 $|i - \bar{g}|$ 通常随着 $\delta$ 的增加而*减小*。

这引出了两个关键 NGTDM 特征的定义：**粗糙度（Coarseness）**和**繁忙度（Busyness）**。
*   **粗糙度**被设计为在局部差异较小时值较大。因此，增加邻域大小 $\delta$ 通常会*增加*测得的粗糙度。
*   **繁忙度**被设计为在局部差异较大时值较大。因此，增加 $\delta$ 会*减小*测得的繁忙度 [@problem_id:4554312]。

因此，选择邻域大小并非一个无足轻重的决定；它是在选择我们想要分析纹理的*物理尺度*。我们是关心毫米级别的微观纹理，还是几厘米范围的宏观纹理？

#### 深入观察：纹理的尺度定律

邻域大小与测得的繁忙度之间的关系不仅仅是定性的；它遵循一个惊人优美的数学定律。让我们想象一下，我们的像素化图像是一个底层平滑连续组织属性场（如同一个由函数 $I(x,y)$ 描述的地景）的离散采样。

一个点的值 $I(x,y)$ 与其周围半径为 $r$ 的小邻域内的平均值之间有什么区别？使用物理学家钟爱的工具——[泰勒级数展开](@entry_id:138468)，我们可以近似任何邻近点的值。当我们在一个对称邻域上取平均时，一阶（梯度）项会抵消，剩下的[主导项](@entry_id:167418)与场的二阶导数——曲率，或者更精确地说是**[拉普拉斯算子](@entry_id:262740)** ($\nabla^2 I$) 相关。分析揭示了一个惊人的结果：一个点与其局部平均值之间的差值与邻域半径的平方成正比 [@problem_id:4612981]。

$$
|I(x,y) - \bar{I}_{\text{neighborhood}}| \propto r^2
$$

这意味着，作为这些差值之和的繁忙度，与 $r^2$ 成比例。如果我们将探针的半径从 $r=1$ 加倍到 $r=2$，测得的繁忙度不只是翻倍，而是*变为四倍*。这个二次尺度定律是一个深刻的见解，将一个简单的计算算法与平滑场的基本属性联系起来。它告诉我们，我们测量的“纹理”不是一个绝对属性，而是某种严重且可预测地依赖于我们观察尺度的东西。

### 直面现实：边缘、各向异性与量化

[医学影像](@entry_id:269649)的现实世界是复杂的。我们优雅的模型必须面对有限区域、不完美的像素以及数字化过程本身的实际挑战。

#### 世界的边缘

当我们分析一个肿瘤时，我们的 ROI 有一个边界。位于这个边缘的像素会发生什么？它的一部分邻域落在 ROI 内部，而另一部分则落在外部，进入了不同的组织或仅仅是背景。我们如何计算它的邻域平均值？

人们可能会倾向于用某个值（如零）来“填充”外部。这看起来很简单，但却是一个科学陷阱。这样做会在 ROI 边界处引入一个人为的高对比度“悬崖”，而这并非组织内在纹理的一部分 [@problem_id:4554312]。这样一来，NGTDM 测量的将是这个人工边缘，而不是我们关心的生物学特性。

有原则的方法，也是**图像生物标志物标准化倡议（IBSI）**等标准所规定的方法，是坦诚面对我们所知的事实：我们只信任 ROI 内部的像素。因此，对于一个边界像素，我们*仅*使用同样位于 ROI 内部的邻域像素来计算平均值 [@problem_id:4612972] [@problem_id:4567125]。如果一个像素在 ROI 内没有邻域（例如在某个微小的角落可能发生），它对计算就没有贡献。这确保了我们测量的是所勾画区域的属性，而不是其他任何东西。

#### 拉伸的像素与各向异性

另一个现实是，像素，或 3D 中的**体素**，通常并非完美的立方体。一次 CT 扫描可能在切片内具有 $0.7 \times 0.7$ mm 的分辨率，但切片本身可能厚达 $3$ mm。这被称为**各向异性**。

如果我们将邻域定义为一个固定的体素网格，比如 $3 \times 3 \times 3$，我们实际上是在分析一个物理上扭曲的形状——一个扁平的盒子而不是一个立方体。沿 $z$ 轴的一个体素步长对应的物理距离远大于沿 $x$ 或 $y$ 轴的步长。这完全混淆了我们的纹理测量，因为“邻域”的概念失去了其物理意义 [@problem_id:4536954]。

正确的解决方案是在*物理单位*中定义邻域。我们应该要求获取物理半径（例如 2 mm）球体内的所有邻域。在各向异性的网格上，这个物理球体在体素坐标系中将对应一个椭球形状。对于我们 $0.7 \times 0.7 \times 3.0$ mm 的体素示例，一个 2 mm 的半径将包括在 $x$ 和 $y$ 方向上最多 2个体素远的邻域，但在 $z$ 方向上是*零*个体素远，因为单步 3 mm 就已经超出了半径范围 [@problem_id:4569114]。这种细致、具有物理意识的方法对于从不同扫描仪获得稳健且可比较的测量结果至关重要。

#### 从连续信号到离散层级

最后，原始 CT 扫描仪数据是物理密度（亨氏单位，HU）的连续范围，但 NGTDM 是在少数离散灰度级（例如 16、32 或 64）上操作的。我们执行这种**量化**的方式会极大地影响结果。如果每次扫描都以不同方式进行量化（例如，根据其自身的最小值和最大值进行缩放），那么“灰度级 5”的含义就会因患者而异，使得比较变得不可能。

最稳健的策略是使用**物理单位下的固定组距宽度**。例如，我们决定每 25 HU 对应一个灰度级。这确保了特定的物理密度差异始终对应于相同的灰度级差异，从而使 NGTDM 特征在不同扫描、噪声水平和患者群体之间保持稳定且可比较 [@problem_id:4613030]。

### 从数字到洞见：定义纹理特征

NGTDM 为我们提供了一个汇总表（$n_g$ 和 $s_g$）。为了使其有用，我们将其进一步提炼为几个关键特征。我们已经介绍了**粗糙度（Coarseness）**和**繁忙度（Busyness）**，它们与总差值和 $\sum s_g$ 成反比。

另一个重要特征是**强度（Strength）**。它被设计为对于具有突出、均匀区域的纹理其值较高。但它的公式是如何推导出来的？是任意的吗？完全不是。在一个公理化设计的美妙例子中，我们可以陈述我们*希望*强度具有的属性：如果像素更集中于少数几个灰度级，它应该增加；如果局部差异（$s_g$）变大，它应该减小。满足这些公理的最简单的数学形式非常优雅 [@problem_id:4612950]：

$$
\text{Strength} = \frac{\sum_g n_g^2}{\sum_g s_g}
$$

这表明，影像组学特征不仅仅是随机的公式；它们可以是为捕捉纹理的特定、理想属性而精心设计的构造，将它们置于坚实的数学基础之上。

因此，NGTDM 从比较一个像素与其邻域的简单想法出发，发展成为一个复杂的工具。它是[纹理分析](@entry_id:202600)方法族中的一种，每种方法都捕捉了空间模式的不同方面 [@problem_id:4531400]。其独特的贡献在于量化图像的“尖锐度”或快速变化。通过理解其原理、尺度定律和敏感性，我们可以将其从一个黑箱算法转变为一个清晰、强大且稳健的工具，用于看见无形之物，并解开隐藏在医学图像中的秘密。

