## 引言
宇宙是如何从大爆炸后近乎均匀的状态，演化成我们今天所见的错综复杂的星系宇宙网的？回答这个问题不仅需要理论，还需要一个检验我们想法的实验室，一个可以重演宇宙历史的地方。[宇宙学模拟](@entry_id:747928)就提供了这样一个实验室，让科学家们能够在超级计算机内部构建完整的宇宙。这些数字宇宙不仅仅是动画，而是建立在基本物理定律之上的复杂模型。本文旨在揭开这些强大工具背后的艺术与科学。它探讨了将物理定律转化为一个跨越数十亿年、能够有效运行的[计算模型](@entry_id:152639)所面临的挑战。我们将探索使这些模拟成为可能的理论和数值基础，并发现它们如何被用来探究最深邃的宇宙奥秘。旅程始于第一部分**“原理与机制”**，在这里我们将揭示宇宙的“源代码”——从简化的[宇宙学原理](@entry_id:158425)，到[结构形成](@entry_id:158241)的[引力](@entry_id:175476)引擎，再到[次网格物理](@entry_id:755602)的巧妙必要性。随后，在**“应用与跨学科联系”**部分，我们将揭示这些模拟如何充当[星系形成](@entry_id:160121)、暗物质乃至[引力](@entry_id:175476)本质等理论的试验台，从而在基础理论与天文观测之间架起桥梁。

## 原理与机制

想象一下，你想在一个盒子里建造一个宇宙。它不只是一个静态模型，而是一个生机勃勃、不断演化的宇宙，从一个简单、近乎均匀的状态开始，绽放出我们今天所见的由星系、星系团和空洞构成的宏伟织锦。这便是[宇宙学模拟](@entry_id:747928)的宏伟目标。但你该从何入手呢？规则是什么？宇宙的“源代码”又是什么？

这段深入[数值宇宙学](@entry_id:752779)核心的旅程，并非依赖于蛮力的计算，而是基于深刻的物理和哲学原理。它讲述了我们如何采纳一些优雅的思想，将它们转化为数学和算法的语言，然后观察一个宇宙的诞生与演化。

### 一个完美平庸的宇宙

我们宇宙模拟的第一条，或许也是最深刻的一条规则，是一种深刻谦卑的陈述：我们并不特殊。这一思想，即**Copernican Principle**（哥白尼原理），假定我们在宇宙中的位置没有任何特权。我们不住在中心，也不在任何其他独特的位置。这固然是一种哲学立场，但它带来了巨大的物理后果。

当我们在最大尺度上眺望宇宙时——无论是通过绘制大爆炸的微弱余晖“宇宙微波背景”（CMB），还是通过统计各个方向的星系数目——我们都会被一个显著的事实所震撼：无论朝哪里看，宇宙都呈现出相同的面貌。这被称为**isotropy**（各向同性）。现在，一个美妙的逻辑飞跃随之而来。如果宇宙在我们周围是各向同性的，而我们的位置又非特殊（哥白尼原理），那么它必定在*每一位*观测者周围都是各向同性的。而一个在每一点周围都呈各向同性的空间，根据数学上的必然性，也必定是**homogeneous**（均匀）的——它在每个位置都具有相同的属性（如平均密度）[@problem_id:3494773]。

这种[均匀性与各向同性](@entry_id:158336)的强大结合被称为**Cosmological Principle**（[宇宙学原理](@entry_id:158425)）。它是现代宇宙学的基石。它告诉我们，宇宙在大尺度上是一种光滑、无特征的流体。当然，我们知道它并非*完美*光滑，毕竟存在星系和人类。[宇宙学原理](@entry_id:158425)的美妙之处在于，它允许我们将这些结构视为微小的涨落，仅仅是浩瀚均匀海洋表面上的涟漪。因此，我们的模拟不必从放置每一颗恒星开始，而是从一个几乎完美光滑的背景（由一套规则支配）和微小的结构种子（由另一套规则支配）开始。

### 膨胀与[引力](@entry_id:175476)的宇宙之舞

那么，光滑背景的规则是什么呢？这种均匀宇宙流体的动力学由一组从 Einstein 的广义相对论推导出的方程描述，即**Friedmann equations**（弗里德曼方程）。这些方程出人意料地简单。它们将宇宙的膨胀速率（由**Hubble parameter**（哈勃参数）$H(t)$ 描述）与其中所有物质和能量的总能量密度联系起来。

这就像把一个球抛向空中。球是会逃脱地球[引力](@entry_id:175476)还是会掉落回来，取决于它的初速度和地球的质量。类似地，我们宇宙的命运——是永远膨胀下去，还是最终在“[大挤压](@entry_id:185507)”（Big Crunch）中崩塌——取决于它的膨胀速度 $H$ 和总能量密度 $\rho_{\text{tot}}$。存在一个特殊的密度值，称为**critical density**（[临界密度](@entry_id:162027)）$\rho_c = \frac{3H^2}{8\pi G}$，它恰好是使宇宙空间“平坦”所需的密度[@problem_id:3495809]。

宇宙学家喜欢使用[密度参数](@entry_id:265044) $\Omega$（Omega）来讨论宇宙预算。对于宇宙的任何组分——无论是普通物质（$\Omega_m$）、光（$\Omega_r$）还是[暗能量](@entry_id:161123)（$\Omega_\Lambda$）——其[密度参数](@entry_id:265044)就是它的密度除以临界密度：$\Omega_i = \rho_i / \rho_c$。这个简单的比率告诉我们每个组分对宇宙总预算的贡献有多大。这种表述的美妙之处在于它导出了一个极为简洁的恒等式，它本身就是[弗里德曼方程](@entry_id:159305)的直接重排：
$$
\sum_i \Omega_i(t) + \Omega_k(t) = 1
$$
在这里，$\Omega_k$ 是一个代表[空间曲率](@entry_id:755140)的项。如果物质和能量的总密度恰好等于[临界密度](@entry_id:162027)（$\sum \Omega_i = 1$），那么 $\Omega_k=0$，空间就是平坦的。如果密度更高，空间就像球面一样呈正曲率；如果更低，则像马鞍一样呈[负曲率](@entry_id:159335)。这个方程并非额外的物理定律，而是[弗里德曼方程](@entry_id:159305)的另一种形式，提醒我们在任何时刻，宇宙的膨胀率、其总含量以及其几何形状都完美地锁定在一个自洽的平衡中。对于模拟而言，这个恒等式也是一个强大的工具：如果在任何时候代码发现其 Omega 之和不等于一，我们就知道出现了数值错误！

### 创生的[引力](@entry_id:175476)引擎

光滑的背景是舞台，但我们宇宙的真正故事是结构的形成。演员是微小的[密度涨落](@entry_id:143540)，导演则是[引力](@entry_id:175476)。[引力](@entry_id:175476)是吸引的，它将物质拉到一起。一个比平均密度稍高的区域会产生稍强的[引力](@entry_id:175476)，吸引更多的物质，变得更加致密，如此循环。这个过程，即[引力不稳定性](@entry_id:160721)，正是将星系从微小的原初种子中培育出来的引擎。

但我们如何模拟这个过程呢？人们可能会想，只需将[牛顿引力定律](@entry_id:167292)应用于所有物质即可。然而，在这里我们遇到了一个困扰了物理学家几个世纪的美妙悖论，这个问题非常棘手，以至于被称为“**Jeans swindle**”（金斯佯谬）。如果你想象一个充满均匀密度物质的无限静态宇宙，[引力](@entry_id:175476)会指向何方？你选择的任何一个[中心点](@entry_id:636820)，在每个方向上都有无限多的质量。力是无法明确定义的，而引力势则发散至无穷大！[@problem_id:3500324]

现代宇宙学框架以惊人的优雅解决了这个悖论。完美均匀*背景*密度的[引力](@entry_id:175476)已经被考虑在内——它驱动着宇宙的整[体膨胀](@entry_id:144241)或减速，正如[弗里德曼方程](@entry_id:159305)所描述的那样。我们需要为结构形成模拟的[引力](@entry_id:175476)，只是来自高于和低于平均密度的*涨落*所产生的*额外*[引力](@entry_id:175476)。我们感兴趣的是**peculiar potential**（奇特[引力势](@entry_id:160378)）$\Phi$，它仅由**density contrast**（[密度对比](@entry_id:157948)）$\delta = (\rho - \bar{\rho})/\bar{\rho}$ 产生。其控制方程是一个修正的泊松方程：
$$
\nabla_{\mathbf{x}}^2 \Phi(\mathbf{x}, t) = 4\pi G a(t)^2 \bar{\rho}(t) \delta(\mathbf{x}, t)
$$
注意这里的 $a(t)^2$ 项——它之所以出现，是因为我们现在是在**comoving coordinates**（[共动坐标](@entry_id:271238)）下工作，这是一个我们稍后会回过头来讨论的巧妙技巧。要为数百万个粒子反复求解这个方程数百万次，是一场计算噩梦。但在这里，数学提供了一条神奇的捷径：**Fourier transform**（[傅里叶变换](@entry_id:142120)）。这项技术让我们能够将任何场（如[密度对比](@entry_id:157948) $\delta(\mathbf{x})$）不看作空间中一系列点的数值，而是看作不同波长和方向的[波的叠加](@entry_id:166456)，每个波都有特定的振幅。当我们对[泊松方程应用](@entry_id:261887)[傅里叶变换](@entry_id:142120)时，复杂的微分算子 $\nabla^2$ 变成了一个简单的乘以 $-k^2$ 的运算，其中 $k$ 是波数（与波长成反比）。方程变成了简单的代数 [@problem_id:3489980]：
$$
\tilde{\Phi}(\mathbf{k}) = - \frac{4\pi G a^2 \bar{\rho}}{k^2} \tilde{\delta}(\mathbf{k})
$$
波浪线（$\sim$）表示经过[傅里叶变换](@entry_id:142120)的量。我们一下子就可以计算出模拟盒子中所有波的势。但有一个小问题：波长无限大的波，即 $k=0$ 模式，该如何处理？这对应于整个盒子的平均密度。方程会让我们除以零！但物理意义是明确的：我们奇特引力势的来源是偏离平均值的*涨落*。因此，根据设计，我们将模拟盒子的平均密度精确地设置为宇宙的平均密度，这意味着 $\tilde{\delta}(\mathbf{k}=\mathbf{0}) = 0$。问题迎刃而解。平均势 $\tilde{\Phi}(\mathbf{0})$ 现在是未定的，但由于力只依赖于势的*差值*，我们可以自由地将其设为零，就像我们可以自由地将海平面定义为地球上的零海拔一样。

### 模拟的心跳：从代码到宇宙

有了基本规则，模拟实际上是如何运行的呢？

它始于**initial conditions**（[初始条件](@entry_id:152863)）。我们不能从一个完美光滑的宇宙开始。结构的种子必须从一开始就存在。理论告诉我们，这些种子是在一个称为暴胀的快速膨胀时期产生的，它们形成了一个**Gaussian random field**（[高斯随机场](@entry_id:749757)）。这意味着原初波的振幅是随机的，但它们遵循一个特定的统计模式，即**primordial power spectrum**（[原初功率谱](@entry_id:159340)），我们可以从宇宙微波背景辐射中测量到它。要开始一个模拟，我们基本上是根据这个模式“掷骰子”，以创造一个早期宇宙密度场的实现[@problem_id:3473746]。然后我们用这个密度场来计算我们所有模拟粒子的初始位移和速度。这不仅仅是一个抽象的配方；它使我们能够检验基础物理学。例如，有质量的中微子以高速行进，倾向于“抹平”小尺度上的结构。为了模拟一个含有大质量中微子的宇宙，我们必须修改我们的[初始条件](@entry_id:152863)生成器，以考虑这种尺度依赖的功率压低。模拟因此变成了一个为中微子“称重”的实验室！

接下来，我们需要一个[坐标系](@entry_id:156346)。在一个静态网格上模拟一个膨胀的宇宙会一团糟——星系很快就会飞出边缘。解决方案是使用**comoving coordinates**（[共动坐标](@entry_id:271238)）。想象在一个气球上画一个网格，然后给它充气。网格点会彼此分开，但它们在气球表面上的坐标保持不变。[共动坐标](@entry_id:271238)对宇宙也起着同样的作用。我们把整体的哈勃膨胀因子分解出去。在我们的模拟盒子里，一个星系不会飞走；它只是相对于膨胀的网格缓慢漂移。这意味着我们的代码处理的密度，即共动密度 $\rho_c$，并不是真实的物理密度 $\rho_{\text{phys}}$。它们之间的关系简单而深刻：$\rho_{\text{phys}} = \rho_c / a(t)^3$ [@problem_id:3491870]。随着宇宙膨胀（$a$ 增加），一个具有恒定共动密度的区域在物理上变得越来越稀薄，正如你所预期的那样。所有物理量，比如一团气体在自身[引力](@entry_id:175476)下坍缩所需的时间（自由落体时间），都必须使用真实的物理密度来计算。

最后，模拟必须在时间上向[前推](@entry_id:158718)进。每个时间步长 $\Delta t$ 可以有多大呢？计算机必须遵守一种宇宙速度限制，即**[Courant-Friedrichs-Lewy](@entry_id:175598) (CFL) condition**（CFL 条件）。直观地说，它指的是在一个时间步内，任何信息（如声波或冲击波前沿）传播的距离都不应超过一个网格单元。如果超过了，模拟将完全错过物理过程并变得不稳定。在[宇宙学模拟](@entry_id:747928)中，这会导致一个有趣的效应。一个具有恒定物理速度 $v_{\text{phys}}$ 的波，在[共动坐标系](@entry_id:266800)中看起来会减速，因为它必须穿越在物理上不断伸展的网格单元。这意味着最大[稳定时间步长](@entry_id:755325)实际上随着宇宙的膨胀而*变大*：$\Delta t \propto a(t)$ [@problem_id:2383704]。随着宇宙[老化](@entry_id:198459)，其动力学变得不再那么剧烈，模拟的心跳也自然而然地减慢了。

### 当网格不再足够：[次网格物理](@entry_id:755602)的艺术

我们已经建立了一个演化暗物质和气体宇宙的精美机器。但恒星、星系、[黑洞](@entry_id:158571)呢？在这里，我们撞上了一堵墙——分辨率之墙。

让我们计算一下一团气体变得不稳定并坍缩形成恒星的特征尺度——**Jeans length**（[金斯长度](@entry_id:157888)）。对于一个高红移星系中典型的恒星形成区，[金斯长度](@entry_id:157888)可能在 9 秒差距左右。而一个最先进的[宇宙学模拟](@entry_id:747928)的分辨率可能是每个网格单元 50 秒差距[@problem_id:3491943]。我们的模拟是“盲”的！恒星形成的物理过程发生在我们宇宙相机单个像素所能分辨的尺度之下。

这并不意味着我们放弃，而是意味着我们必须变得更聪明。我们必须创建一个**subgrid recipe**（次网格方案）。[次网格模型](@entry_id:755601)是一套规则，一个基于我们对更小尺度物理知识的处方，它告诉模拟当网格上满足某些条件时该怎么做。对于恒星形成，这个方案可能是：“如果一个网格单元中的气体超过了某个物理密度阈值并且足够冷却，那么就将该气体质量的一部分转化为一个‘恒星粒子’。”

这个恒星粒子并不代表单个恒星，而是代表一个同时诞生的成千上万甚至数百万颗恒星的整个星族。然后我们使用另一个关于[恒星反馈](@entry_id:755431)的次网格方案：根据这个恒星粒子的年龄和质量，我们将能量、动量和[重元素](@entry_id:272514)（在恒星中合成）注入回网格上周围的气体中。

这需要在描述气体的两种不同方式之间进行微妙的舞蹈。为了正确捕捉[冲击波](@entry_id:199561)并确保质量、动量和能量的完美守恒，模拟代码演化的是**conserved variables**（[守恒变量](@entry_id:747720)），如动量密度（$\rho\mathbf{u}$）和总能量（$E$）。但为了做出物理决策——比如气体是否足够致密以形成恒星——我们需要的是**primitive variables**（[原始变量](@entry_id:753733)），如密度（$\rho$）、速度（$\mathbf{u}$）和压力（$p$）[@problem_id:3464070]。模拟不断地在这两种语言之间转换：用于演化的严谨数学守恒语言，和用于次网格方案的直观物理语言。

[次网格物理](@entry_id:755602)不是“作弊”。它是在[宇宙学模拟](@entry_id:747928)所能解析的巨大尺度与在小得多尺度上发生的恒星形成和反馈等复杂、混乱的物理过程之间架起的一座精密而必要的桥梁。现代[计算宇宙学](@entry_id:747605)的前沿领域大部分都集中于此，它将我们的模拟从贫瘠的暗物质网络转变为充满活力的、生机勃勃的星系生态系统。

