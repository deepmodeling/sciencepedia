## 引言
从医学到公共政策，我们面临的干预措施往往不是一次性事件，而是随时间调整的持续过程。管理慢性病、实施社会项目或提供行为指导都涉及一系列决策，其中每一步都影响着下一步。使用观察性数据分析这些**时变治疗**的有效性带来了一个巨大的挑战。简单的[统计关联](@entry_id:172897)可能具有极大的误导性，在我们拥有的数据和我们需要做出的决策之间造成了关键的知识鸿沟。

这个问题的核心是**时间依赖性混杂**，一个复杂的反馈循环：治疗会影响患者未来的特征，而该特征反过来又会影响未来的治疗决策。本文旨在剖析这一错综复杂的挑战，并介绍为解决此问题而设计的正式因果推断框架。在接下来的章节中，您将学习此类分析的核心原则和机制。我们将首先探讨潜在结局框架、使推断成为可能的基本假设，以及两种强大的方法——边际结构模型和g-公式——它们使我们能够估计真实的因果效应。随后，我们将看到这些概念在实践中的应用，探索它们在制定临床策略、评估社会政策，乃至塑造现代科学研究的设计与解读等方面的多样化应用。

## 原理与机制

### 时间的迷宫：当过去改变未来

想象一位医生正在治疗一位患有艾滋病或高血压等慢性病的患者。每个月，医生都会查看患者最新的实验室结果——比如病毒载量或血压——然后决定是继续、停止还是更换药物。这看似简单。但其中的曲折在于：上个月的治疗已经影响了本月的实验室结果。而本月的实验室结果又会影响下个月的治疗决策。

我们陷入了一个令人眩晕的反馈循环。患者的状态（$L_t$）影响治疗（$A_t$），而治疗（$A_{t-1}$）也影响患者的状态（$L_t$）。治疗与不断变化的健康状况之间的这种错综复杂的交织，正是我们所说的**时间依赖性混杂**的核心 [@problem_id:5177997]。试图确定治疗的真实效果，就像在一个迷宫中穿行，你每走一步，前方迷宫的墙壁就会重新排列。你走过的路决定了你能走的路。

正是这种反馈循环，使得用观察性数据（例如在数百万份电子健康记录（EHR）中找到的数据）回答一个看似简单的问题——“这种药有效吗？”——变得异常困难 [@problem_id:4862779]。我们常用的统计工具可能会彻底失效。例如，标准的[回归分析](@entry_id:165476)可能会试图“控制”随时间变化的实验室结果。但这是一个严重的错误。如果一种治疗通过降低患者的风险评分来起作用，而我们在分析中对该风险评分进行调整，我们实际上就抵消了我们想要测量的效果 [@problem_id:4837383]。这就像问一种新肥料是否有助于[植物生长](@entry_id:148428)，但在分析中我们“调整”了土壤的养分丰富程度。由于肥料的作用就是丰富土壤，我们可能最终会得出结论，它对生长根本没有影响！通过对位于治疗和结局之间因果路径上的变量进行条件化，我们自己遮挡了通往真相的视线。

### 想象别的世界：潜在结局的力量

要走出这个迷宫，我们需要一种更强大的思维方式。我们需要跳出单一的、被观察到的历史，开始追问：“如果……会怎样？”。这就是**潜在结局**框架的魔力。

对于任何个体，我们可以想象一系列平行宇宙 [@problem_id:4581096]。在每个宇宙中，此人都接受了一套从头到尾都不同的、完整的治疗方案。例如：
*   宇宙1：在一项为期24个月的研究中，患者全程接受新药治疗。
*   宇宙2：患者全程接受安慰剂治疗。
*   宇宙3：只有当患者的CD4计数低于某个阈值时，才接受新药治疗。

我们在这些假设性宇宙中看到的结局——例如患者是否存活，或研究结束时的病毒载量——被称为**潜在结局**。如果$\bar a$代表一个随时间变化的完整治疗方案，那么$Y^{\bar a}$就是如果遵循了该方案*本应被观察到*的结局。

我们的因果问题不再是关于我们所观察到的现实中那些纠缠不清的关联。相反，它变成了跨越这些想象世界的比较。我们可能会问：与宇宙2相比，宇宙1中所有人的平均结局是什么？这就是平均因果效应，我们用[期望值](@entry_id:150961)$E[Y^{\bar a}]$来表示。这是一个**边际估计量**，因为它在整个人群中取平均，为我们提供了一个关于治疗策略总体效果的、强有力的单一数值 [@problem_id:4581096]。我们甚至可以探究效果在不同子群体中的差异，例如，通过考察以基线健康状况为条件的效应，$E[Y^{\bar a} \mid L_0]$。

这个概念上的飞跃至关重要。我们已经将问题从一个混乱的相关性问题，重构为一个清晰但未被观察到的反事实比较问题。现在的挑战是，如何利用我们这个混乱的、现实世界的数据，来窥见所有其他的世界。

### 游戏规则：窥见反事实的假设

为了在我们所看到的世界和我们想象的世界之间架起桥梁，我们需要就一些基本的游戏规则达成一致。这些是从观察性数据进行因果推断的核心假设。如果它们成立，我们就能识别因果效应。如果它们不成立，我们只是在猜测。

1.  **一致性 (Consistency)**：这是最直观的规则。它简单地陈述：如果在我们的观测数据中，某人碰巧遵循了确切的治疗方案$\bar a$，那么我们为他们观测到的结局*就是*他们在该方案下的潜在结局$Y^{\bar a}$。这个假设将事实数据与反事实框架联系起来 [@problem_id:4862779] [@problem_id:4961053]。

2.  **序贯[可交换性](@entry_id:263314) (Sequential Exchangeability)（无未测量混杂）**：这是分量最重的假设。它指出，在每个时间点，当我们考虑了患者的全部已观察到的过去——包括他们之前的所有治疗、实验室结果、症状和诊断——他们在*那一刻*接受的具体治疗，就其最终命运而言，基本上是随机的。换句话说，不存在任何隐藏的、未测量的因素（比如一个秘密的[遗传标记](@entry_id:202466)或未记录的症状）既指导着医生的决策，*又*独立地预测着患者的长期结局。如果在每一步我们都测量了治疗和结局的所有共同原因，我们就可以“如同”治疗是在该历史条件下随机分配的那样继续分析 [@problem_id:4549029]。

3.  **正值性 (Positivity)（或重叠 Overlap）**：这是对现实的检验。假设我们想知道给血小板计数极低的患者使用强效抗凝剂的效果。如果在我们的数据中，医生们*从不*这样做，因为这被认为太危险，那么我们的数据集就包含一个“结构性零值”——一个完全的盲点 [@problem_id:4557765]。我们没有任何关于那种情况下会发生什么的数据。为了了解任何患者群体中某种治疗选择的效果，我们必须看到该群体中有一些患者接受了治疗，而另一些没有。我们的数据中必须有“重叠”。有时这种违背并非绝对，而是实践性的：对于风险评分非常高的患者，几乎所有人都接受了治疗，而对于评分低的患者，几乎没有人接受治疗。这种**实践性正值性违背**会给我们带来近乎无限的[统计不确定性](@entry_id:267672)，因为我们试图与一个规模小到几乎消失的群体进行比较 [@problem_id:4581126]。没有正值性，我们无法在伦理上或科学上进行推断；我们只能承认我们的数据无法回答这个问题。

### 通往反事实世界的两条路

如果这三个假设成立，我们至少有两种绝佳的策略来打破时间依赖性混杂的反馈循环，并估计时变治疗的效果。它们从不同的哲学角度解决问题，但目标相同：一窥潜在结局 [@problem_id:4862779]。

#### 道路1：重赋历史权重（边际结构模型）

第一种方法有点像创建一个统计学上的乌托邦。我们知道，在观察数据中，病情较重的患者更有可能接受积极治疗，这会产生偏倚。**[逆概率](@entry_id:196307)加权 (IPW)** 的核心思想就是对此进行数值校正。

我们在每个时间点为每个人计算一个“权重”。如果一个人接受的治疗，根据其历史来看是*不太可能*的（例如，一个相对健康的人接受了积极的药物治疗），那么这个人就会被赋予一个较大的权重。如果一个人接受的治疗是高度可预测的（例如，一个病情非常严重的人接受了积极的药物治疗），那么他会得到一个较小的权重。

通过应用这些权重，我们数学上构建了一个**伪群体**。在这个新的、加权的群体中，患者过去的健康状况与他们当前治疗之间的联系被切断了。就好像在每次就诊时，都是通过抛硬币来决定他们的治疗方案。时间依赖性混杂消失了！在这个伪群体中，我们可以直接比较接受治疗者和未接受治疗者的结局，其结果就是对因果效应的无偏估计 [@problem_id:5177997] [@problem_id:4549029]。这就是**边际结构模型 (MSM)** 背后的引擎，它通过对给定历史的治疗概率 $P(A_t \mid \text{History})$ 进行建模——实质上，是对医生的决策过程进行建模——来发挥作用 [@problem_id:4837383]。

#### 道路2：模拟未来（G-公式）

第二条路与其说是重赋过去权重，不如说是模拟未来。这就像建造一个飞行模拟器，只不过是为人体生物学而建。这种方法被称为**参数g-公式**或**g-计算**。

这个过程主要有两个步骤：
1.  **学习世界规则**：首先，我们使用观察[数据拟合](@entry_id:149007)一系列模型来描述世界是如何运作的。我们对患者健康状况如何根据其先前的健康和治疗随时间演变（$P(L_t \mid \text{History})$）以及最终结局如何依赖于健康状态和治疗的完整序列（$E[Y \mid \text{Full History}]$）进行建模 [@problem_id:4515316]。
2.  **模拟“如果……会怎样”的情景**：一旦我们有了这个“模拟引擎”，我们就可以进行干预。我们可以让成千上万甚至数百万的虚拟患者通过我们的模拟器。但这一次，我们覆盖了医生的决策。我们将模拟器编程为遵循我们感兴趣的特定治疗规则，例如“始终给药”，或者一个动态规则，如“仅当患者风险评分高时才给药” [@problem_id:4961053]。

我们让我们的虚拟群体在这个新规则下在模拟器中度过他们的一生，最后我们看到的平均结局就是我们对该规则因果效应的估计。这种方法非常强大，因为它直接模仿了我们想要理解的反事实世界。它的主要挑战在于，它要求我们正确地模拟人体的复杂生物过程，这可能比模拟医生的行为要困难得多。

### 选择你的道路：预测与因果

那么，我们为什么要有这些不同且复杂的方法呢？因为我们所问问题的性质决定了我们需要的工具。这就引出了最后一个关键的区别：**预测与因果**。

如果我们的目标仅仅是**预测**患者的未来——根据我们所知的一切来预报他们发生某个事件的风险——我们不一定需要这套复杂的因果机制。对于预测而言，关联为王。我们可以而且应该使用我们掌握的所有信息，包括时间依赖性混杂因素，来构建最准确的预测模型。这是**联合模型 (Joint Models)** 等专为关联设计的标准机器学习和[统计模型](@entry_id:755400)真正大放异彩的领域 [@problem_id:4968624]。

但如果我们的目标是做出**决策**——选择一个能带来更美好未来的行动——那么预测是不够的。我们必须提出一个因果性的“如果……会怎样”的问题。我们必须理解我们干预的后果。正是为了这个目的——为了从被动观察转向主动改进——潜在结局的原则以及MSM和g-公式的机制才被发明出来。它们代表了一种形式化的语言，用于在一个动态、复杂而美丽的世界中对因果进行推理。

