## 引言
完成一项[RNA测序](@entry_id:178187)实验后，研究人员面临一个根本性挑战：如何将数百万个原始序列计数转化为有意义的基因活性度量。乍一看，更高的计数值似乎意味着基因更活跃。然而，这些原始数据会受到技术性人为因素的扭曲，使得直接比较变得不可靠，并可能导致错误的结论。主要的“罪魁祸首”是样本间的基因长度差异和总测序深度差异，这些差异会在没有生物学变化的地方制造出变化的假象。

本文旨在揭开[RNA-seq标准化](@entry_id:271941)过程的神秘面纱，重点关注为解决此问题而开发出的两种最基础的度量指标。在接下来的章节中，您将对如何校正这些偏差有一个深入且基于原理的理解。在“原理与机制”一章中，我们将从头开始解构原始计数背后的逻辑，构建FPKM和TPM的公式，并揭示连接它们之间优美的数学关系。紧接着，在“应用与跨学科联系”一章中，我们将探讨使用这些度量指标的实践细节，讨论其中隐藏的偏差、[基因注释](@entry_id:164186)的影响，以及这些核心原则如何应用于[单细胞测序](@entry_id:198847)和[宏基因组学](@entry_id:146980)等先进技术。

## 原理与机制

想象一下你置身于一个现代生物学实验室。一台宏伟的机器——[DNA测序](@entry_id:140308)仪——刚刚完成了它的运行。它交给你一张巨大的数字电子表格，上面密密麻麻地记录着数百万个数字。每个数字代表一个计数——即来自你样本中某个特定基因的一小段序列被机器“看到”的次数。你的目标是弄清楚哪些基因是活跃的，以及它们的活跃程度。这看起来很简单，不是吗？拥有最多计数的基因必定是最活跃的。你心满意足地向后靠去。但一种挥之不去的感觉悄然而至。真的有那么简单吗？

事实证明，大自然是一位精明的记账员。原始数字虽然因其简单而诱人，但它们讲述的故事却被两种强大的假象所扭曲。要成为真正的基因组侦探，我们必须首先学会看穿这些假象。

### 原始计数的“暴政”

比对到某个基因上的序列片段的原始数量，我们称之为**原始计数**（raw counts），看似是其活性的直接度量。但这是一种由两个混淆因素制造的海市蜃楼：基因的长度和测序实验的深度。

首先，让我们考虑**基因长度偏差**。想象你有两条装配线，一条短，一条长，都以完全相同的速率生产相同的小部件——比如说，每分钟10个小部件。如果你在任意时刻对整个工厂车间进行快照拍摄，哪条装配线上可见的小部件会更多？当然是更长的那条。因为它在任何给定瞬间都有更多的物理空间来容纳小部件。

[RNA测序](@entry_id:178187)的工作原理与此完全相同。测序仪从你细胞中所有的信使RNA（mRNA）分子集合中随机抽样片段。一个更长的mRNA转录本，就像更长的装配线一样，提供了一个更大的目标。即使它与一个较短的转录本拷贝数完全相同，并且被细胞机器“读取”的速率也相同，它自然会产生更多的片段 [@problem_id:2967170]。比较一个长基因和一个短基因的原始计数就像是拿苹果和橘子作比较；它更多地告诉你它们的大小，而不是它们的活性。

其次，我们有**测序深度偏差**。让我们回到工厂的比喻。假设周一你拍了100张快照，但周二你拍了1000张。即使工厂的生[产率](@entry_id:141402)根本没有改变，你也会期望在周二的照片中看到大约十倍的小部件。测序仪的总产出——即它从一个样本中测序的片段总数，称为**文库大小**（library size）——就像你拍摄的照片数量。一个样本可能产生2000万条读段（reads），而另一个由于各种技术原因可能产生4000万条。将第二个样本中某个基因的40,000个原始计数与第一个样本中的20,000个计数进行比较，可能会让你相信其活性翻了一番。但如果文库大小也翻了一番，那么它的*相对*活性根本没有改变 [@problem_id:5157628]。

因此，原始计数具有欺骗性。它们是真实生物学信号与这两种技术性人为因素的混合体。为了看清真相，我们需要进行标准化。我们需要发明一种既不受基因长度影响，也不受[测序深度](@entry_id:178191)影响的测量系统。

### 追求公平的首次尝试：FPKM

让我们尝试从第一性原理出发，构建一个更好的度量指标。我们的目标是创建一个能反映基因真实表达水平的值，一个我们可以在不同基因和不同样本间公平比较的值。

首先，让我们解决长度偏差。为了公平地比较长短装配线，我们不应该比较照片中所有小部件的总数。相反，我们应该比较小部件的*密度*——即每米装配线上的小部件数量。对于基因而言，这意味着我们应该将原始计数（对于基因$i$为$c_i$）除以基因的长度（$L_i$）。为了避免数字变得太小，通常使用千碱基（kb）为单位的长度。这给了我们一个长度标准化的速率：$r_i = c_i / (L_i / 1000)$。

现在来处理[测序深度](@entry_id:178191)。为了比较拍摄100张快照的那天和拍摄1000张快照的那天，我们可以进行标准化。我们可以问，“如果我恰好拍摄了一百万张快照，我会看到多少小部件？”我们可以通过将我们的计数除以拍摄的总快照数（文库大小，$N$），然后乘以一百万来实现。

结合这两个想法，我们得到了第一个英雄般的标准化度量：**FPKM**，即**每千碱基转录本每百万映射读取片段数**（Fragments Per Kilobase of transcript per Million mapped reads）。（其用于单端测序的前身被称为**RPKM**，即每千碱基转录本每百万映射读段数（Reads Per Kilobase of transcript per Million mapped reads））。公式如下：

$$
\mathrm{FPKM}_i = \frac{c_i}{\left(\frac{L_i}{1000}\right) \left(\frac{N}{10^6}\right)} = \frac{c_i \cdot 10^9}{L_i \cdot N}
$$

这个公式的每个部分都有其目的。$c_i$是我们的原始测量值。分母中的$L_i$校正了长度偏差。分母中的$N$校正了[测序深度](@entry_id:178191)。看起来我们成功了！我们得到了一个应该可以直接比较的数值。样本A中基因X的FPKM值应该可以与样本A中基因Y的FPKM值相比较，也可以与样本B中基因X的FPKM值相比较。

### 更优雅的比例：[TPM](@entry_id:170576)的组分性质

在一段时间里，FPKM是标准。但科学家们，像所有优秀的侦探一样，是一群持怀疑态度的人。他们注意到FPKM中一个微妙而令人不安的特性。虽然它做得很好，但它有一个奇特的性质，使得跨样本比较不像它本可以的那样直观。

问题在于，一个样本中所有FPKM值的总和不是恒定的。它会因样本而异。为什么呢？因为FPKM公式的分母包含总读段数（$N$），但分子实际上包含的是经过长度标准化的计数。因此，总和取决于该样本中碰巧表达的基因的平均长度 [@problem_id:2417793]。

这就像试图通过仅说明每个水果篮中苹果的重量来比较两个水果篮的成分。A篮有1公斤苹果，B篮有2公斤。苹果在B篮中的*比例*更大吗？你无法判断，因为你不知道每个篮子的总重量。[转录组](@entry_id:274025)的“FPKM总重量”在不同样本间是变化的，这使得讨论相对比例变得困难。

这促成了一个更优雅的度量指标的发明：**TPM**，即**[每百万转录本](@entry_id:170576)数**（Transcripts Per Million）。[TPM](@entry_id:170576)建立在一个简单而强大的思想之上：让我们先计算每个基因的*比例*，然后再将所有数值缩放到一个方便的数字。其步骤如下 [@problem_id:5139957] [@problem_id:2579641]：

1.  **首先对长度进行标准化。** 和之前一样，我们为每个基因计算每千碱基的片段率：$r_i = c_i / (L_i / 1000)$。这个值$r_i$与基因$i$的转录本分子数量成正比。
2.  **对速率求和。** 我们将所有这些速率相加，得到整个样本的总和：$S = \sum_j r_j$。这个数字代表了所有经过长度标准化的转录本的“总池”。
3.  **计算比例。** 基因$i$的组分丰度就是它的速率除以总速率：$r_i / S$。
4.  **缩放到一百万。** 为了得到一个方便的数字，我们将这个分[数乘](@entry_id:155971)以一百万。

这就得到了[TPM](@entry_id:170576)的公式：

$$
\mathrm{TPM}_i = \left( \frac{r_i}{\sum_j r_j} \right) \cdot 10^6 = \left( \frac{c_i / L_i}{\sum_j (c_j / L_j)} \right) \cdot 10^6
$$

注意与FPKM相比，在运算顺序上的关键区别。[TPM](@entry_id:170576)首先创建了一个经过长度标准化的转录本“市场”，然后计算每个基因在这个市场中所占的份额。而FPKM是独立地用总文库大小（$N$）进行标准化。

[TPM](@entry_id:170576)方法的精妙之处在于，根据其构造，一个样本中所有[TPM](@entry_id:170576)值的总和*永远*恰好是一百万。

$$
\sum_i \mathrm{TPM}_i = \sum_i \left( \frac{r_i}{\sum_j r_j} \cdot 10^6 \right) = \frac{10^6}{\sum_j r_j} \sum_i r_i = 10^6
$$

这使得TPM成为一种**组分性**（compositional）度量。一个基因的[TPM](@entry_id:170576)值为50意味着，如果你能从样本中提取一百万个转录本，你预计会找到50个该基因的转录本。因为总和总是不变的，所以你可以直接跨样本比较[TPM](@entry_id:170576)值，以观察基因相对比例的变化。它解决了“水果篮”问题。

### 隐藏的统一性：FPKM与TPM之间的联系

乍一看，FPKM和TPM似乎是两种不同的哲学。但数学常常揭示隐藏的联系。FPKM和[TPM](@entry_id:170576)有关联吗？是的，并且是以一种极其简单的方式。在单个样本内部，它们之间仅仅相差一个恒定的缩放因子。

让我们从定义出发，做一点代数运算 [@problem_id:4614628]。我们知道：
$$ \mathrm{FPKM}_i = \frac{10^9 c_i}{N L_i} \quad \text{和} \quad \mathrm{TPM}_i = \frac{c_i / L_i}{\sum_j (c_j / L_j)} \cdot 10^6 $$

从FPKM公式中，我们可以将长度标准化的计数 $c_i/L_i$ 表示为：
$$ \frac{c_i}{L_i} = \frac{\mathrm{FPKM}_i \cdot N}{10^9} $$

现在，让我们将它代入TPM公式：
$$ \mathrm{TPM}_i = \frac{\frac{\mathrm{FPKM}_i \cdot N}{10^9}}{\sum_j \left( \frac{\mathrm{FPKM}_j \cdot N}{10^9} \right)} \cdot 10^6 $$

项 $N/10^9$ 对于整个样本来说是一个常数，所以它出现在分子上，也出现在分母中求和的每一项里。它完全被抵消了！我们得到了一个非常简单的关系：

$$
\mathrm{TPM}_i = \left( \frac{\mathrm{FPKM}_i}{\sum_j \mathrm{FPKM}_j} \right) \cdot 10^6
$$

这个方程意义深远。它告诉我们，要将一个样本中所有的FPKM值转换为TPM值，你不需要原始计数、基因长度或文库大小。你所需要的只是该样本中所有FPKM值的总和 [@problem_id:2424946]！你只需用这个总和来重新缩放每个FPKM值，使得新值的总和为一百万。因此，虽然FPKM和[TPM](@entry_id:170576)具有不同的跨样本特性，但它们在样本内部携带相同的信息，只是以不同的尺度表达而已 [@problem_id:5157658]。

### 科学家的责任：了解你的假设

我们已经构建了FPKM和TPM这些优美的工具来帮助我们理解转录组。它们功能强大，但像任何工具一样，它们都建立在假设之上。一个好的科学家必须始终了解他们所使用工具的假设。

我们做出的最重要的假设是，片段是沿着转录本的长度**均匀**抽样的。我们整个长度偏差校正（除以$L_i$）都基于这一思想。但如果这不是真的呢？例如，在许多常见的实验室流程中，将mRNA复制成DNA的机器对从一端（3'端）开始有偏好。这可能导致“3'端覆盖偏差”，即大部分测序读段堆积在基因的一端。在这种情况下，简单地除以完整的基因长度就不是一个正确的标准化方法，因为测序仪能“看到”的基因的“有效”长度要小得多 [@problem_id:2424930]。

此外，虽然在比较组分方面[TPM](@entry_id:170576)优于FPKM，但最后仍需提醒一句。对于鉴定**差异表达基因**（寻找在不同条件下活性发生显著变化的基因）这一复杂的统计任务，通常不应使用FPKM或[TPM](@entry_id:170576)值作为输入。像[DESeq2](@entry_id:167268)或edgeR这样的现代统计工具是为处理**原始计数**而设计的。它们有自己的、更高级的标准化方法，并且至关重要的是，它们对计数数据的特定统计噪声特征（遵循一种称为负二项分布的模式）进行建模。将计数转换为像FPKM或[TPM](@entry_id:170576)这样的连续、预标准化的值，会丢弃数据中关于方差和不确定性的重要信息，而这些强大的工具正是需要这些信息来进行准确推断的 [@problem_id:2424945]。

所以，标准化的历程本身就是科学的一个完美缩影。我们从一个简单的观察（原始计数）开始，发现其缺陷（偏差），建立模型来修正它们（FPKM），在我们的模型中发现一个微妙的缺陷，然后构建一个更好的模型（[TPM](@entry_id:170576)）。最后，我们了解了新模型的局限性，并明白它应该和不应该在何处应用。电子表格上的数字并非故事的终点；它们是深入探究细胞内部生命的一场引人入胜的侦探调查的开始。

