## 引言
视觉纹理是我们周围世界的一个基本属性，从风平浪静的天空的平滑到花岗岩台面的粗糙。虽然人类能直观地感知这些差异，但对其进行量化却是一个巨大的挑战。像[直方图](@entry_id:178776)这样仅统计像素强度的简单统计工具，无法捕捉定义纹理的空间排列方式。这一知识鸿沟限制了我们对科学和医学图像中复杂模式进行自动化分析的能力。

本文介绍了一种解决此问题的强大方案：**灰度共生矩阵 (GLCM)**。GLCM 超越了单个像素，转而分析像素对之间的关系，通过二阶统计量提供了对纹理的丰富、量化的描述。在接下来的章节中，您将对这一关键方法获得全面的理解。“原理与机制”一节将解释 GLCM 是如何构建的，如何从中派生出有意义的 Haralick 特征，以及将该理论应用于现实世界数据时出现的实际挑战。随后，“应用与跨学科联系”一节将展示 GLCM 如何在病理学、[遥感](@entry_id:149993)和材料科学等领域充当通用工具，弥合视觉模式与客观科学洞见之间的差距。

## 原理与机制

### 超越直方图：一种新的观察方式

设想您看到两幅图像。一幅是暴风雨来临前平静的灰色天空，另一幅是花岗岩台面的特写。如果您只是简单地统计两幅图像中每种灰度色阶的像素数量，您可能会发现它们的计数惊人地相似。两幅图像可能都含有相同数量的浅灰色、中灰色和深灰色像素。执行这种计数的工具称为**[直方图](@entry_id:178776)**，它为我们提供所谓的图像“一阶统计量”。它告诉我们存在*哪些*强度值，但完全没有告诉我们它们的排列方式。平静的天空是平滑的，相似的色阶聚集在一起。花岗岩则是混沌的，深色和浅色的斑点杂乱地并列在一起。[直方图](@entry_id:178776)对这种至关重要的差异——也就是我们所感知的**纹理**的本质——视而不见。

要捕捉纹理，我们必须超越简单地计数单个像素。我们需要开始研究像素*对*。我们需要问这样的问题：“如果我找到一个深灰色像素，它旁边的像素亮度如何？是同样深，还是浅？”这就是从一阶统计量到**二阶统计量**的飞跃。这是从问“图像中有什么？”到问“图像中的事物是如何排列的？”的飞跃。这个简单而深刻的视角转变，是解锁纹理量化描述的关键，并直接将我们引向一个优美的数学对象：**灰度[共生](@entry_id:142479)矩阵 (GLCM)**。

### 统计像素对的艺术：构建 GLCM

GLCM 的核心就是一个记分卡，一种系统性地记录相邻像素亮度对的方法。想象一下，我们已将图像简化，使其只包含几个离散的灰度级，比如从 0（黑色）到 3（白色）。要构建一个 GLCM，我们首先需要定义“相邻”的含义。这种关系由两个简单的参数定义：一个以像素为单位测量的**距离**（$d$）和一个**角度**（$\theta$）。例如，我们可以决定观察正右方一个步长（$d=1$）的像素（$\theta=0^{\circ}$）。

现在，我们逐个像素地遍历图像。在每个位置 $\mathbf{x}$，我们查看该像素的灰度级，称之为 $i = I(\mathbf{x})$，以及其在指定偏移量处的邻居的灰度级，$j = I(\mathbf{x}+\mathbf{d})$。然后我们来到我们的记分卡——一个矩阵，其行对应每个可能的起始灰度级 $i$，列对应每个可能的相邻灰度级 $j$——并在位置 $(i,j)$ 的方格中做一个标记。

让我们用一个被量化为四个灰度级（0, 1, 2, 3）的 4x4 微小图像块来具体说明这一点，类似于 [@problem_id:4566408] 中的情景：
$$
I = \begin{pmatrix}
0 & 1 & 1 & 2 \\
0 & 0 & 1 & 2 \\
3 & 2 & 2 & 1 \\
3 & 3 & 2 & 1
\end{pmatrix}
$$
让我们选择偏移量为向右 $d=1$ 个像素（$\theta=0^{\circ}$）。我们扫描第一行：第一对是 (0, 1)。我们在矩阵的 $(0,1)$ 位置添加一个计数。下一对是 (1, 1)。在 $(1,1)$ 位置添加一个计数。然后是 (1, 2)，在 $(1,2)$ 位置添加一个计数。我们对图像中所有可能的像素对重复此过程。对于这个特定图像，我们将找到总共 12 个有效对。最终的计数，即未归一化的 GLCM，将如下所示：
$$
G = \begin{pmatrix}
1 & 2 & 0 & 0 \\
0 & 1 & 2 & 0 \\
0 & 2 & 1 & 0 \\
0 & 0 & 2 & 1
\end{pmatrix}
$$
这个矩阵 $G(i,j)$ 是一个共现频率图。位置 $G(0,1)$ 的数字 '2' 告诉我们，当向右看一个像素时，（灰度级 0，灰度级 1）这对组合出现了两次。

这个过程被正式定义为对感兴趣区域 $\mathcal{R}$ 内所有有效对进行计数 [@problem_id:4612975]。对于位移 $\mathbf{d}$，未归一化的 GLCM 条目 $P(i,j; \mathbf{d})$ 是对所有有效起始位置的指示函数求和：
$$
P(i,j;\mathbf{d}) = \sum_{\mathbf{x}\in\mathcal{R}:\, \mathbf{x}+\mathbf{d}\in\mathcal{R}} \mathbf{1}\{I(\mathbf{x})=i\}\,\mathbf{1}\{I(\mathbf{x}+\mathbf{d})=j\}
$$
虽然这个计数矩阵很有用，但为了比较不同大小区域的纹理，我们必须将这些原始计数转换为概率。为此，我们只需将矩阵中的每个条目除以我们计数的总对数。
$$
p_{ij} = \frac{P(i,j;\mathbf{d})}{\sum_{i=0}^{L-1}\sum_{j=0}^{L-1}P(i,j;\mathbf{d})}
$$
现在，每个条目 $p_{ij}$ 代表观察到由我们选择的距离和角度分隔的灰度对 $(i, j)$ 的联合概率。这个新矩阵中所有条目的总和恰好为 1。我们已将一个简单的计数练习转化为一个强大的纹理概率描述。

### 从矩阵到意义：Haralick 特征

我们归一化后的 GLCM 是对纹理的丰富描述，但它仍然是一个数字表格。为了使其真正有用，我们需要将其属性总结为几个有意义的度量。这些通常被称为 **Haralick 特征**，以该领域的先驱 Robert Haralick 的名字命名。可以将 GLCM 想象成一张[地形图](@entry_id:202940)：一些条目是高峰（频繁出现的对），其他则是低谷（罕见的对）。Haralick 特征就像是关于这片景观的提问。

让我们利用实际计算中的见解 [@problem_id:4917111] [@problem_id:4344313]，探讨一些最直观的特征：

-   **对比度 (Contrast)**： $$C = \sum_{i=0}^{L-1} \sum_{j=0}^{L-1} (i-j)^2 p_{ij}$$
    对比度衡量图像中局部变化的量。项 $(i-j)^2$ 充当权重。如果一对像素的灰度级 $i$ 和 $j$ 相差很大，这个权重就很大。如果它们相似，权重就很小。因此，具有明暗急剧并置的纹理——比如我们的花岗岩台面——其 GLCM 中远离主对角线（$i \ne j$）的像素对将具有高概率。这导致高对比度值。而像灰色天空这样的平滑纹理，其大部分像素对将位于对角线上或附近（$i \approx j$），从而导致低对比度。

-   **能量 (Energy / 角二阶矩)**： $$E = \sum_{i=0}^{L-1} \sum_{j=0}^{L-1} p_{ij}^2$$
    能量衡量纹理的均匀性或有序性。通过对每个概率值进行平方，我们给予最频繁出现的像素对更大的权重。如果一个纹理非常有秩序——例如，一个完美的棋盘格或一个平坦、均匀的区域——那么只会存在极少数的共生对，并且它们的概率会很高。将它们平方求和会得到一个高能量值。一个复杂的、无序的纹理，其中许多不同的像素对以低概率出现，其能量值会很低。

-   **[同质性](@entry_id:636502) (Homogeneity / 逆差矩)**： $$H = \sum_{i=0}^{L-1} \sum_{j=0}^{L-1} \frac{p_{ij}}{1 + (i-j)^2}$$
    同质性本质上与对比度相反。权重因子 $\frac{1}{1+(i-j)^2}$ 在 $i$ 和 $j$ 相似时较大，在它们不同时较小。因此，高的同质性值表示大多数共现像素具有相似的灰度级，这是平滑、非对比纹理的特征。

-   **熵 (Entropy)**： $$S = - \sum_{i=0}^{L-1} \sum_{j=0}^{L-1} p_{ij} \ln(p_{ij})$$
    熵借鉴于信息论，衡量纹理的随机性或复杂性。如果所有共生对都等可能出现（最大不可预测性），熵将达到最大值。如果纹理非常简单和可预测，熵将很低。

通过为使用不同偏移量（$\mathbf{d}$）构建的 GLCM 计算这些特征，我们可以为纹理的结构、粗糙度、平滑度和方向性描绘出一幅丰富而定量的图景。

### 现实世界的介入：实际挑战

从这个优雅的理论到实际应用的道路上，铺满了现实世界数据带来的美丽复杂性。一个有抱负的物理学家或数据科学家必须学会欣赏这些微妙之处，因为它们不是可以忽略的烦恼，而是揭示更深层次真理的问题的必要组成部分。

-   **网格问题（各向异性）**：在医学成像中，如计算机断层扫描（CT），我们处理的数据是三维的。其基本构件不是方形像素，而是矩形的“体素”（[体积元](@entry_id:267802)素）。CT 扫描的体素在平面内测量可能为 $0.5 \text{ mm} \times 0.5 \text{ mm}$，但切片厚度为 $3.0 \text{ mm}$，这种情况很常见 [@problem_id:4612939] [@problem_id:4546184]。这被称为**各向异性**数据。现在，我们简单的指令“走一步”变得含糊不清。沿 x 轴的一步是 $0.5 \text{ mm}$ 的物理距离，但沿 z 轴的一步是 $3.0 \text{ mm}$！要进行有物理意义的[纹理分析](@entry_id:202600)，我们必须考虑到这一点。我们可以用物理单位（例如 $1 \text{ mm}$）来定义我们的偏移量，这可能对应于分数个步长的体素；或者我们可以先将整个体积**重采样**到一个各向同性（完全立方的）体素网格中。重采样实现了几何上的一致性，但这是有代价的：创建新体素所需的**插值**过程不可避免地会使图像模糊，轻微地平滑了我们想要测量的纹理 [@problem_id:4612939]。这种在几何一致性和插值模糊之间的权衡是[定量成像](@entry_id:753923)中的一个根本性挑战。

-   **离散化行为**：GLCM 在少量、离散的灰度级（$L$）上运行。然而，来自成像设备的原始数据通常有数千个可能的强度值。在构建 GLCM 之前，我们必须执行**离散化**或**量化**——将连续的强度值分组到有限数量的箱中。我们如何做这件事至关重要。两种常见的方法是**固定[分箱](@entry_id:264748)数 (FBN)**，我们决定有，比如说，$N=64$ 个箱，并将整个数据的强度范围划分为 64 个等宽的段；以及**固定分箱宽度 (FBW)**，我们设定一个标准箱宽，比如 $\Delta = 25$ 个强度单位 [@problem_id:5221677]。这些选择可能导致不同的总灰度级数。对于 $[0, 1600]$ 的强度范围，64 级的 FBN 给出 $L=64$，而 25 个单位的 FBW 给出 $L=65$ 级。这个看似微小的差异对 GLCM 的大小（$64^2$ 对比 $65^2$ 个条目）有二次方的影响，这会显著影响其稀疏性和计算特征的稳定性。这凸显了科学测量的一个关键方面：结果取决于你使用的尺子。为了使放射组学成为一门可重复的科学，这些预处理步骤，如归一化和离散化的顺序，必须标准化 [@problem_id:4545769]。

-   **现实的模糊（部分容积效应）**：没有成像系统具有无限的分辨率。每一次测量都是对现实的轻微模糊。这被称为**部分容积效应**。想象一个完美的黑白条纹图案。理想的相机会看到从 0 到 L 的完美过渡。但一个带有模糊镜头的真实相机将在边界处平均这些值。一个位于黑白条纹边缘的像素不会是黑色或白色；它将是灰色。正如一个优美的理论模型所探讨的 [@problem_id:4554631]，这种模糊可以对 GLCM 产生巨大影响。少量的模糊可能根本不会改变量化值。但中等程度的模糊可以将一个高对比度的`(黑, 白)`纹理模糊成一个完全均匀的`(灰, 灰)`纹理。这将导致 GLCM 对比度特征从一个高值骤降到零！这给我们上了一堂深刻的课：我们计算的纹理特征不仅仅是物体本身的属性，而是*成像系统所见的物体*的属性。

### 一个带有方向的工具

GLCM 是一个强大的工具，但其决定性特征是其固有的**方向性**。我们构建的矩阵和计算的特征完全取决于我们选择的偏移向量 $\mathbf{d}$。这不是一个弱点；这是它最大的优点。对于具有内在方向性的纹理，如木纹、肌肉纤维或某些癌性增生，GLCM 就像一个指南针。通过为不同方向计算特征，我们可以确定纹理的主导方向及其与其他方向的差异 [@problem_id:5221671]。

当然，如果一个纹理是真正的**各向同性**（在所有方向上都相同），比如一片沙地，这种方向敏感性可能是不必要的。对于这种情况，其他工具，如与旋转无关的灰度区域大小矩阵（GLSZM），可能更合适 [@problem_id:5221671]。但当结构和方向性至关重要时，GLCM 是无与伦比的。它为了解图像隐藏的几何结构提供了一个窗口，将“纹理”的主观感知转化为一组客观、量化且强大的描述符。它证明了简单的计数行为，当以谨慎和物理直觉进行时，可以带来深刻的科学洞见。

