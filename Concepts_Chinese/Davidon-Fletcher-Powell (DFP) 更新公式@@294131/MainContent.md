## 引言
在广阔的[数值优化](@article_id:298509)领域，我们面临的挑战通常是在没有完整“地图”的情况下，在一个复杂的多维“地形”中找到最低点。虽然[牛顿法](@article_id:300368)通过使用地形的曲率（Hessian 矩阵）提供了一条直接路径，但在每一步都计算这些信息通常计算成本过高。这一知识鸿沟催生了对更高效技术的需求，从而导致了拟牛顿法这一革命性方法的诞生。这些方法，包括著名的 Davidon-Fletcher-Powell (DFP) [算法](@article_id:331821)，会构建一个近似的地形图，并在每一步中对其进行优化。

本文将全面探讨 DFP 更新公式，它是 DFP [算法](@article_id:331821)的核心引擎。在第一章“原理与机制”中，我们将剖析该公式的构造，深入探讨其设计所依据的基础[割线方程](@article_id:343902)和优雅的最小变化原则。我们还将揭示它与其著名的后继者 BFGS 公式之间出人意料且优美的数学联系。随后，“应用与跨学科联系”一章将把 DFP 置于更广阔的科学背景下，比较其与 BFGS 的实际性能，并审视其在解决[计算化学](@article_id:303474)和工程领域实际问题中的关键作用。

## 原理与机制

想象一下，你正站在一个起伏不平、被浓雾覆盖的地形上，任务是找到山谷的最低点。你看不到完整的地图，但能感觉到脚下地面的陡峭程度和方向——这就是我们希望最小化的函数的**梯度**。你走出一步，然后感受新的坡度。你如何利用这些有限的信息智能地导航至谷底？

这就是[数值优化](@article_id:298509)的根本挑战。[艾萨克·牛顿](@article_id:354887)爵士给了我们一个强大的方法：如果你不仅知道坡度（一阶[导数](@article_id:318324)，即梯度），还知道地形的*曲率*（二阶[导数](@article_id:318324)，即 **Hessian 矩阵**），你就可以创建一个完美的地形局部[二次模型](@article_id:346491)，并直接跳到其最小值点。问题在于，在每一步都计算真实的 Hessian 矩阵，其[计算成本](@article_id:308397)往往高得令人望而却步，就像你每走一步都要委托进行一次详细的地形勘测一样。

像 Davidon-Fletcher-Powell (DFP) [算法](@article_id:331821)这样的拟牛顿法提供了一种非常巧妙的替代方案。它们仿佛在说：“我们不必费心去获取那份真实而昂贵的地图。让我们从一个粗略的猜测开始——也许只是一片平地——然后在我们迈出的每一步中完善我们的地图。” DFP 更新就是执行这种完善操作的规则。

### [割线方程](@article_id:343902)：地图绘制的第一法则

让我们将这次小小的探险形式化。我们从点 $\mathbf{x}_k$ 移动到点 $\mathbf{x}_{k+1}$。这一步是一个向量，我们称之为 $\mathbf{s}_k = \mathbf{x}_{k+1} - \mathbf{x}_k$。我们还测量这两点之间的梯度变化，$\mathbf{y}_k = \nabla f(\mathbf{x}_{k+1}) - \nabla f(\mathbf{x}_k)$。

现在，我们有了一张粗略的曲率图，即我们的近似逆 Hessian 矩阵 $H_k$。我们想将它更新为一张新图 $H_{k+1}$。这张新图必须具备的最基本、不可协商的属性是什么？它必须与我们最近的测量结果保持一致。它必须能正确预测：步长 $\mathbf{s}_k$ 会导致梯度变化 $\mathbf{y}_k$。

对于一个简单的二次函数地形，这些量之间的关系是精确的：$H \mathbf{y}_k = \mathbf{s}_k$。因此，我们将此条件施加于我们新的近似地图上。这个基本要求被称为**[割线方程](@article_id:343902)**：

$$H_{k+1}\mathbf{y}_k = \mathbf{s}_k$$

该方程确保我们更新后的地形模型至少在刚刚行进的方向上是正确的。这就像一个测量员插上一面新旗帜，并确保地图准确反映了最后两面旗帜之间的路径。任何合理的更新公式都*必须*满足这个条件，而正如我们将看到的，DFP 公式的构造正是为了满足这一要求。

### 最小变化原则

在这里我们遇到了一个障碍。在任何多于一维的问题中，[割线方程](@article_id:343902)为对称矩阵 $H_{k+1}$ 的元素提供了 $n$ 个线性约束，但该矩阵有 $\frac{n(n+1)}{2}$ 个独立元素。对于 $n > 1$ 的情况，存在无限多个新地图可以满足我们最新的测量结果！我们应该选择哪一个呢？

这时，一个优美、简单而深刻的思想应运而生：**最小变化原则**。它告诉我们，旧地图 $H_k$ 包含了从*所有*先前步骤中收集到的全部信息。我们不应轻易抛弃这些积累的智慧。因此，在所有满足[割线方程](@article_id:343902)的可能矩阵 $H_{k+1}$ 中，我们应该选择那个与当前矩阵 $H_k$ *最接近*的矩阵。我们只在新证据绝对要求的情况下才更新我们的信念。这种“智力上的保守主义”原则防止我们对地图做出疯狂、无理的更改，并提供了推导特定更新公式所需的唯一条件。

### 构建 DFP 更新：秩二校正

我们如何构建一个能执行这些原则的机器呢？DFP 公式通过在旧地图上增加一个校正项来实现这一点，$H_{k+1} = H_k + C_k$。这个校[正矩阵](@article_id:309909) $C_k$ 必须被精心设计，以满足[割线方程](@article_id:343902)，同时保持变化量尽可能小。

Davidon、Fletcher 和 Powell 的洞见在于，利用我们仅有的新信息——步长向量 $\mathbf{s}_k$ 和梯度变化向量 $\mathbf{y}_k$——来构造这个校正。DFP 更新是一种**秩二更新**，意味着校[正矩阵](@article_id:309909)是两个简单的[秩一矩阵](@article_id:377788)之和。[秩一矩阵](@article_id:377788)就是两个向量的“外积”，例如 $\mathbf{u}\mathbf{v}^T$，它仅用两个向量就生成一个完整的矩阵。

我们假设校正项具有由 $\mathbf{s}_k$ 和向量 $H_k \mathbf{y}_k$（代表我们的*旧*地图对步长的预测）构建的特定形式：
$$H_{k+1} = H_k + a \mathbf{s}_k \mathbf{s}_k^T + b (H_k \mathbf{y}_k)(H_k \mathbf{y}_k)^T$$
其中 $a$ 和 $b$ 是我们需要求解的标量。如果 $H_k$ 是对称的，这个结构保证新矩阵 $H_{k+1}$ 也保持对称。

现在，我们强制执行[割线方程](@article_id:343902) $H_{k+1}\mathbf{y}_k = \mathbf{s}_k$。将我们的公式代入并进行一些代数运算，我们会发现一个非凡的结果：系数 $a$ 和 $b$ 是唯一确定的！
$$a = \frac{1}{\mathbf{s}_k^T \mathbf{y}_k} \quad \text{and} \quad b = -\frac{1}{\mathbf{y}_k^T H_k \mathbf{y}_k}$$

将它们代回，就得到了著名的 **Davidon-Fletcher-Powell (DFP) 更新公式**：

$$H_{k+1} = H_k + \frac{\mathbf{s}_k \mathbf{s}_k^T}{\mathbf{s}_k^T \mathbf{y}_k} - \frac{H_k \mathbf{y}_k (H_k \mathbf{y}_k)^T}{\mathbf{y}_k^T H_k \mathbf{y}_k}$$

这个方程是 DFP [算法](@article_id:331821)的核心。第一项 $H_k$ 是我们的旧地图。第二项增加了沿步长方向 $\mathbf{s}_k$ 的信息。第三项减去了一个基于旧地图所包含的关于梯度方向 $\mathbf{y}_k$ 的曲率信息的校正。根据其构造，如果你用 $\mathbf{y}_k$ 乘以这个 $H_{k+1}$，这些项会奇迹般地消解，最终得到的结果恰好是 $\mathbf{s}_k$，从而满足[割线方程](@article_id:343902)。这台机器完美运行。

让我们看看它的实际效果。如果我们从最简单的地图——单位矩阵 $H_k = I$ 开始，并走出一步 $\mathbf{s}_k = \begin{pmatrix} 1 \\ 2 \end{pmatrix}$，该步长产生的梯度变化为 $\mathbf{y}_k = \begin{pmatrix} -1 \\ 1 \end{pmatrix}$，我们只需将这些值代入公式。经过各种[点积](@article_id:309438)和[外积](@article_id:307445)运算，我们得到一个全新的地图 $H_{k+1} = \begin{pmatrix} 1.5 & 2.5 \\ 2.5 & 4.5 \end{pmatrix}$，它现在包含了我们最新一步所带来的新曲率信息。

### 优美的对偶性：与 BFGS 的秘密联系

多年来，DFP 公式一直是拟[牛顿法](@article_id:300368)中的佼佼者。后来，出现了另一个公式，现在以其发现者 Broyden、Fletcher、Goldfarb 和 Shanno 的名字命名为 BFGS。它看起来与 DFP 不同，并且在实践中效果甚至更好。但它与 DFP 有关系吗？

答案是肯定的，而且其联系揭示了数学中一种惊人的对称性。回想一下，DFP 更新的是*逆* Hessian 矩阵 $H$。而 BFGS 则是作为对 Hessian 矩阵本身 $B = H^{-1}$ 的更新而提出的。对 $B_{k+1}$ 的 BFGS 更新公式为：

$$B_{k+1}^{\text{BFGS}} = B_k + \frac{\mathbf{y}_k \mathbf{y}_k^T}{\mathbf{y}_k^T \mathbf{s}_k} - \frac{B_k \mathbf{s}_k (B_k \mathbf{s}_k)^T}{\mathbf{s}_k^T B_k \mathbf{s}_k}$$

现在，仔细观察 DFP 对 $H_{k+1}$ 的更新公式和 BFGS 对 $B_{k+1}$ 的更新公式。如果你将 DFP 公式中所有的 $H$ 替换为 $B$，并将所有的 $\mathbf{s}_k$ 与 $\mathbf{y}_k$ 互换，你会得到完全一样的 BFGS 公式！

这是一种深刻的**对偶性**。就好像数学家用两种等价但相反的方式来看待同一个问题：一种是从逆 Hessian 矩阵的角度（DFP），另一种是从 Hessian 矩阵的角度（BFGS），通过交换步长（$\mathbf{s}_k$）和梯度变化（$\mathbf{y}_k$）的角色而完美镜像。

### Broyden 族以及 BFGS 为何称王

这种对偶性并非偶然。事实证明，DFP 和 BFGS 都只是一个称为 **Broyden 族** 的有效更新[连续统](@article_id:320471)中的两个成员。我们可以写出一个统一的公式，它是 DFP 和 BFGS 更新的[线性组合](@article_id:315155)，由参数 $\phi$ 控制：
$$H_{k+1}(\phi) = (1-\phi)H_{k+1}^{\text{DFP}} + \phi H_{k+1}^{\text{BFGS}}$$
设置 $\phi=0$ 得到纯粹的 DFP 更新。设置 $\phi=1$ 得到纯粹的 BFGS 更新（对于逆 Hessian 矩阵）。介于两者之间的任何 $\phi$ 值也能得到一个有效的拟牛顿更新，它满足[割线条件](@article_id:344282)并保持对称性和正定性。

这表明 DFP 并非一个孤立的解决方案，而是一系列可能性中的一个点。但哪个点最好呢？理论可以是美丽的指南，但实践是最终的裁判。数十年的计算经验给出了明确的结论：谱系的 BFGS 端（$\phi=1$）在实践中明显更鲁棒、更高效。BFGS 具有更好的“自校正”属性，并且对线搜索过程（决定沿给定方向走多远的过程）中不可避免的不精确性远不那么敏感。虽然 DFP 是一个里程碑式的突破并奠定了基础，但它的对偶方法 BFGS 已被证明是在迷雾中寻找最低点的更可靠的“主力军”。