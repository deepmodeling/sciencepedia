## 引言
是什么让一个数字与众不同？对数学家而言，一个简单的问题，如“哪些数可以写成两个平方数之和？”，就能开启一个充满深邃之美与隐藏联系的世界。虽然像 5 ($2^2 + 1^2$) 和 8 ($2^2 + 2^2$) 这样的数符合此描述，但其他数如 3 和 6 却神秘地不符合。这个简单的观察提出了一个谜题：是否存在一个普遍的规则来支配这一性质，或者这仅仅是算术上的巧合？对这个答案的追寻不仅揭示了一条规则，更展开了一段连接算术、代数与几何的恢弘叙事。

本文将揭开两数平方和背后的奥秘。它为这个百年之久的问题提供了完整的答案，并展示了一个单一思想如何在数学中激起涟漪，揭示其深刻、内在的统一性。在接下来的章节中，我们将首先深入探讨“原理与机制”，通过[模算术](@article_id:304132)的筛选和优雅的[高斯整数](@article_id:309967)世界，揭示其完整的判别准则。然后，我们将在“应用与跨学科联系”中探索该定理惊人的[影响范围](@article_id:345815)，发现其在[晶格](@article_id:300090)几何、[波动力学](@article_id:345574)物理学，乃至现代数字[密码学安全](@article_id:324690)等领域的影响。

## 原理与机制

哪些数可以写成两数平方和，这个问题乍看之下似乎只是一个简单的算术趣闻。你可以检验几个数：$1 = 1^2 + 0^2$，$2 = 1^2 + 1^2$，$4 = 2^2 + 0^2$，$5 = 2^2 + 1^2$。但接着你就会遇到障碍：$3$ 是不可能的，$6$ 和 $7$ 也是。然后 $8 = 2^2 + 2^2$ 又可以了。这里的规律是什么？是否存在一个深刻的原理在支配这个看似随机的游戏？事实证明，答案是肯定的。这是一个美妙的故事，它带领我们从简单的算术走向[复数的几何](@article_id:344472)世界，然后再返回，揭示了数学中惊人的统一性。

### 一个简单的筛选器：模 4检验

让我们从寻找一条规则开始，这条规则能告诉我们哪些数*不能*成为两数[平方和](@article_id:321453)。这通常比找出哪些数可以更容易。想象一下，我们是侦探，在 3, 7, 11, 15 等“不可能”的数字中寻找一个共同特征。

考虑任意整数，称之为 $n$。当你对它进行平方时，会发生什么？
如果 $n$ 是偶数，我们可以写成 $n=2k$。它的平方是 $n^2 = (2k)^2 = 4k^2$。这个数是 4 的倍数。用模算术的语言来说，我们称 $n^2 \equiv 0 \pmod{4}$。
如果 $n$ 是奇数，我们可以写成 $n=2k+1$。它的平方是 $n^2 = (2k+1)^2 = 4k^2 + 4k + 1 = 4(k^2+k) + 1$。这个数除以 4 的余数总是 1。所以，$n^2 \equiv 1 \pmod{4}$。

这是一个强有力的观察！任何整数的平方除以 4，余数只可能是 0 或 1，绝不可能是 2 或 3。

现在，当我们把两个平方数 $a^2 + b^2$ 相加时会发生什么？这个和模 4 的可能余数就是每个平方数可能余数的和：
- $0 + 0 = 0$ (如果 $a$ 和 $b$ 都是偶数)
- $0 + 1 = 1$ (如果一个偶数，一个奇数)
- $1 + 1 = 2$ (如果 $a$ 和 $b$ 都是奇数)

看看这个列表：0, 1, 2。余数 3 根本没有出现！这给了我们第一条强有力的规则：**任何除以 4 余 3 的整数都不能写成两数[平方和](@article_id:321453)** [@problem_id:1393062]。这立即排除了 3, 7, 11, 15, 19, 23 以及无穷多个其他数。这是一个简单但非常有效的筛选器。

### 问题的核心：素数

这个[模算术](@article_id:304132)检验是一个很好的开始，但它并非全部。例如，$6 \equiv 2 \pmod{4}$ 且 $21 \equiv 1 \pmod{4}$，但它们都不能写成两数平方和。为了更深入地理解，我们必须将注意力转向所有整数的基石：素数。

让我们将筛选器应用于奇素数。如果一个奇素数 $p$ 可以写成 $p = a^2 + b^2$，我们知道它不可能是 $4k+3$ 型。因为它是一个奇素数，它也不可能是 $4k$ 或 $4k+2$ 型。唯一剩下的可能性是它必须是 $4k+1$ 型。的确，如果我们看 $p=a^2+b^2$，$a, b$ 中必然一奇一偶（否则它们的[平方和](@article_id:321453)将是偶数）。这意味着 $a^2+b^2 \equiv 0+1 \equiv 1 \pmod{4}$ [@problem_id:1392677]。

这引出了一个重大的猜想，由 Pierre de Fermat 在 17 世纪首次提出：

**一个奇素数 $p$ 可以写成两数平方和的*[充要条件](@article_id:639724)*是它除以 4 的余数为 1。**

“必要性”部分我们刚刚弄清楚了。但“充分性”部分——即*每个* $4k+1$ 型素数都可以写成两数平方和——则要难证明得多。Leonhard Euler 是第一个提供完整证明的人，其中最优雅的方法之一使用了一种称为“[无穷递降法](@article_id:641164)”的技巧。其逻辑非常巧妙：你假设存在一个最小的 $4k+1$ 型素数*不能*写成两数平方和。然后，通过一系列巧妙的步骤，你证明这个假设意味着存在一个更*小*的、具有相同性质的同类型素数。这是一个逻辑矛盾，就像找到了一个并非最小的“最小正数”。摆脱这个悖论的唯一方法就是初始假设为假，即这样的素数不存在 [@problem_id:1841614]。这证明了每个 $4k+1$ 型素数都是两数平方和。不仅如此，这种表示还是唯一的（忽略顺序和符号）[@problem_id:1392433]。例如，$37 = 1^2 + 6^2$，并且没有其他方式可以用两个正整数做到这一点。

### 一个新世界：高斯整数

这个“充要条件”很优美，但仍然感觉有点像魔术。为什么除以 4 的余数会和这个有关系呢？最深刻的解释来自于走出我们熟悉的一维数轴，进入一个二维世界：[复平面](@article_id:318633)。

让我们考虑形如 $a+bi$ 的数，其中 $a$ 和 $b$ 是整数，$i$ 是虚数单位，满足 $i^2 = -1$。这些被称为**[高斯整数](@article_id:309967)**，它们在[复平面](@article_id:318633)上形成一个格点网络 [@problem_id:1789238]。就像我们可以对常规整数进行算术运算（加、减、乘）一样，我们也可以对[高斯整数](@article_id:309967)进行同样的运算。

关键的洞见在于考察高斯整数的“大小”，我们称之为它的**范数**。$z = a+bi$ 的范数定义为 $N(z) = a^2 + b^2$。这看起来熟悉吗？这正是我们一直在寻找的两数[平方和](@article_id:321453)！从几何上看，它是在平面上从原点到点 $(a,b)$ 的距离的平方。

突然之间，我们最初的问题——“一个整数 $n$ 能否写成 $a^2+b^2$？”——被转化了。它变成了：“整数 $n$ 是某个[高斯整数](@article_id:309967) $a+bi$ 的范数吗？” [@problem_id:1789238]。

这个新视角非常强大，因为它将两数平方和与因式分解联系起来。注意 $a^2+b^2 = (a+bi)(a-bi)$。因此，将一个整数素数 $p$ 写成两数[平方和](@article_id:321453) $p=a^2+b^2$，与将 $p$ 分解为两个高斯整数 $p = (a+bi)(a-bi)$ 是完全相同的事情 [@problem_id:2226952]。

在我们常规整数的世界里，像 7 这样的素数无法被分解。事实证明，7 在[高斯整数](@article_id:309967)的世界里也无法被分解——它仍然是一个“[高斯素数](@article_id:317176)”。但像 5 这样的素数，$5=2^2+1^2$，可以分解为 $5 = (2+i)(2-i)$。所以，5 在我们的世界里是素数，但在高斯世界里*不是*。

Fermat 发现的规则现在有了一个优美的解释：
- 一个素数 $p \equiv 3 \pmod{4}$（如 3, 7, 11）在高斯整数中仍然是素数。它无法被分解，因此不能写成两数平方和。
- 一个素数 $p \equiv 1 \pmod{4}$（如 5, 13, 17）在高斯整数中不再是素数。它“分裂”成两个[高斯素数](@article_id:317176) $(a+bi)$ 和 $(a-bi)$ 的乘积。这个因式分解直接给出了我们两数平方和的表示 $p = a^2+b^2$ [@problem_id:2272116]。
- 素数 2 是一个特例。它分解为 $2 = (1+i)(1-i) = (1+i)(-i(1+i)) = -i(1+i)^2$。在不计单位因子的情况下，它是唯一一个“平方”[高斯素数](@article_id:317176)的素数。

### 乘法的魔力与完整配方

既然我们理解了素数，那么像 6、10 或 45 这样的合数呢？答案来自另一个优美的恒等式，它乍一看很神奇，但在高斯整数的世界里却非常自然。

如果你有两个数是两数平方和，比如 $N_1 = a^2+b^2$ 和 $N_2 = c^2+d^2$，它们的乘积 $N_1 N_2$ *也*是两数平方和。这由**婆罗摩笈多－斐波那契恒等式**保证：
$$(a^2+b^2)(c^2+d^2) = (ac-bd)^2 + (ad+bc)^2$$
这从何而来？这只是一个关于高斯整数范数的陈述！设 $z_1 = a+bi$ 和 $z_2 = c+di$。那么 $N(z_1) = a^2+b^2$ 且 $N(z_2) = c^2+d^2$。它们的乘积是 $z_1 z_2 = (ac-bd) + i(ad+bc)$。这个乘积的范数是 $N(z_1 z_2) = (ac-bd)^2 + (ad+bc)^2$。由于乘积的范数等于范数的乘积，即 $N(z_1 z_2) = N(z_1)N(z_2)$，恒等式就得证了 [@problem_id:1782235]。

这个性质——两数平方和的集合在**乘法下是封闭的**——是这个谜题的最后一块拼图。它允许我们为*任何*正整数 $n$ 建立一个完整的规则。我们只需要看它的素数分解。
- 因子 2 没问题。
- $4k+1$ 型素数的因子没问题。
- $4k+3$ 型素数的因子呢？如果我们有一个这样的因子，比如 $n=3$，它就不是两数平方和。如果我们有两个，比如 $n=3 \times 3 = 9$，那么 $9 = 3^2+0^2$，所以可以。如果我们有 $n = 3 \times 7 = 21$，就不行。但 $n=3^2 \times 7 = 63$ 也不行。

最终的、完整的判别准则是：
**一个正整数 $n > 0$ 可以写成两数平方和的充要条件是，在其素数分解中，每个 $4k+3$ 型素数都以偶数次幂出现。** [@problem_id:1789238]
所以 $45 = 3^2 \times 5$ 是可以的，因为素数 3（属于 $4k+3$ 型）的指数是偶数（2）。确实，$45=6^2+3^2$。但 $42 = 2 \times 3 \times 7$ 就不行，因为 3 和 7 的指数都是奇数（1）。

### 登高远眺

有了这个详细的配方，我们可以放眼全局，提出更大的问题。这些数有多普遍？事实证明，随着数字的增大，它们变得越来越稀有。小于等于一个大数 $r$ 的此类整数的数量大约与 $\frac{r}{\sqrt{\ln r}}$ 成正比 [@problem_id:810613]。

但也许最惊人的结果来自于我们问一个不同的问题：平均而言，有多少种方式可以将一个数写成两数平方和？记住，我们把 $(\pm a, \pm b)$ 和 $( \pm b, \pm a)$ 算作不同的方式。所以 $r_2(5) = 8$，因为有 $(\pm 1, \pm 2)$ 和 $(\pm 2, \pm 1)$。对所有整数取平均值，结果不是整数或简单分数，而是 $\pi$。

$$\lim_{x\to\infty} \frac{1}{x} \sum_{n=1}^{\lfloor x \rfloor} r_2(n) = \pi$$

为什么圆周率 $\pi$，即圆的周长与直径之比，会出现在这里？其直觉是深刻的几何学的。和 $\sum_{n \le x} r_2(n)$ 就是半径为 $\sqrt{x}$ 的圆内部或边界上的整数格点 $(a,b)$ 的总数，因为对于每个这样的点，$a^2+b^2 = n \le x$。这些点的数量约等于圆的面积，即 $\pi (\sqrt{x})^2 = \pi x$。所以，直到 $x$ 为止，每个整数 $n$ 的平均点数约为 $\frac{\pi x}{x} = \pi$ [@problem_id:479963]。

一个始于简单的平方相加游戏的问题，带领我们走向了模算术、素数、[高斯整数](@article_id:309967)的美丽几何，并最终与基本常数 $\pi$ 建立了深刻而出人意料的联系。这完美地说明了在数学中，最简单的问题往往能引出最深刻、最相互关联的真理。