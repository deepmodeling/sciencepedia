## 引言
生物组织的复杂结构由多种细胞类型协同工作构成，是理解健康与疾病的关键。然而，深入观察这个细胞社会是一项重大的技术挑战。许多强大的技术，尤其是在[空间转录组学](@entry_id:270096)领域，捕获的基因表达信号并非来自单个细胞，而是来自包含多种细胞类型混合物的小块组织区域。这种“部分体积效应”导致信号被混合、平均化，从而掩盖了潜在的[细胞异质性](@entry_id:262569)。为了克服这个问题，研究人员转而使用一套强大的计算技术，即细胞类型[反卷积](@entry_id:141233)。本文将对这一关键领域进行全面概述。第一章“原理与机制”将阐述使我们能够计算性地解混这些信号的基本统计和数学模型，从简单的线性假设到复杂的概率框架。随后，“应用与跨学科联系”一章将展示[反卷积](@entry_id:141233)如何作为一种[计算显微镜](@entry_id:747627)，在神经科学、免疫学、遗传学等领域促成新的发现。

## 原理与机制

想象一下，你正在一个热闹的派对上，但你身处一个独立的房间，只有一个麦克风在拾取主厅的声音。你能听到喧嚣的人声，那是交谈声、笑声和音乐的混合体。你是否能仅通过分析这个混合声波，就推断出大厅里有多少个不同的人群——比如说，物理学家、诗人和音乐家——以及他们的比例是多少？这本质上就是**细胞类型反卷积**所面临的挑战。我们的“麦克风”是[空间转录组学](@entry_id:270096)检测，我们的“混合声波”是从一小块组织中捕获的[信使RNA](@entry_id:262893)（mRNA）分子的集合，而“人群”则是构成那块组织的不同细胞类型。我们的任务就是解混信号，描绘出隐藏的细胞社会图景。

### 拥挤的细胞邻里

要理解为什么我们需要[反卷积](@entry_id:141233)，我们必须首先认识到我们测量的物理现实。现代**空间转录组学**技术使我们能够测量整个组织切片的基因表达，但在许多情况下，其分辨率无法达到单个细胞的水平。一种常见的方法是使用覆盖有微小、带条形码的“点”阵列的载玻片。当薄组织切片放置在该载玻片上时，这些点会捕获正上方细胞的mRNA。

关键问题是：一个点能“听到”多少个细胞？让我们考虑一种**点尺寸**（[捕获区域](@entry_id:266038)的物理直径）约为$d = 55\,\mu\mathrm{m}$的技术。在像淋巴结或大脑这样细胞密集的组织中，单个细胞的直径可能只有$10-20\,\mu\mathrm{m}$。一个简单的计算表明，一个点可以轻易覆盖5到15个细胞的区域[@problem_id:2890041]。这就是**部分体积效应**：我们对单个点的测量不是一个细胞的声音，而是许多细胞的合唱。

情况比这还要复杂。mRNA分子本身并非静止不动；它们在被捕获前会[扩散](@entry_id:141445)一小段距离。这种[分子尺](@entry_id:166706)度的模糊，加上有限的点尺寸，定义了实验的**有效分辨率**。这个分辨率不可避免地比物理点尺寸更粗糙，意味着每个点捕获的信号是其直接细胞邻里的加权平均值[@problem_id:2890041]。因此，[反卷积](@entry_id:141233)的需求并非仅仅是计算上的便利，而是测量物理过程的直接结果。

[反卷积](@entry_id:141233)的重要性关键取决于点直径$d$与平均细胞直径$d_c$之间的关系。当点远大于细胞时（$d \gg d_c$），混合是不可避免的，[反卷积](@entry_id:141233)至关重要。如果技术发展到点与细胞大小大致相同（$d \approx d_c$），问题就转向了点与单细胞之间的直接一对一对齐。而在未来，如果点远小于细胞（$d \ll d_c$），问题就变成了在识别之前，先将多个点拼接起来以重建一个破碎的细胞[@problem_id:3320386]。目前，在许多常用平台中，我们生活在$d \gg d_c$的世界，一个充满混合信号的世界。

### [线性混合模型](@entry_id:139702)：初步近似

那么，我们如何解开这个混合体呢？最简单、最强大的思想是假设一个**[线性混合模型](@entry_id:139702)**。假设我们有一个参考库，可能来自[单细胞RNA测序](@entry_id:142269)（scRNA-seq），它告诉我们每种纯细胞类型的特征性基因表达“特征”。设细胞类型$k$的特征为向量$S_k$。那么，一个点中观察到的表达向量$Y$可以建模为这些纯特征的加权和：

$Y \approx p_1 S_1 + p_2 S_2 + \dots + p_K S_K$

这里，$p_k$代表点中细胞类型$k$的比例。这个优雅的方程构成了[反卷积](@entry_id:141233)的基石。然而，其中隐藏着一个美妙的微妙之处。$p_k$到底是什么？标准算法的输出通常代表每种细胞类型贡献的*mRNA*比例。但我们的生物学问题是关于*细胞*的比例。这两者相同吗？

完全不同。一个大的、代谢活跃的神经元可能比一个小的、静止的免疫细胞含有多得多的mRNA。如果一个点包含一个神经元和一个免疫细胞，神经元可能贡献了90%的mRNA。一个简单的反卷积会报告90/10的比例，而忽略了真实的50/50细胞计数。幸运的是，如果我们知道每种细胞类型的平均总mRNA含量或像细胞大小$s_k$这样的代理指标，我们就可以纠正这种偏差。如果算法给出mRNA比例$w'_k$，那么真实的细胞比例$w_k$可以通过一个简单而优美的公式恢复[@problem_id:1467325]：

$$ w_{k} = \frac{\frac{w'_{k}}{s_{k}}}{\sum_{i=1}^{K}\frac{w'_{i}}{s_{i}}} $$

这一小步在概念清晰度上是一次巨大的飞跃。它提醒我们，我们必须严格精确地定义我们的模型代表什么以及我们试图推断什么。

有了这个修正后的理解，我们可以将寻找比例$\mathbf{p}$的过程构建为一个正式的[优化问题](@entry_id:266749)。我们希望找到向量$\mathbf{p}$，使得预测的混合物$\mathbf{S}\mathbf{p}$与我们观察到的点数据$\mathbf{y}$尽可能接近。衡量“接近度”最常用的方法是最小化平[方差](@entry_id:200758)之和。这与比例必须为非负且总和为一的物理约束相结合，给了我们一个简洁优美的数学问题：**约束[非负最小二乘法](@entry_id:170401)**[@problem_id:2851169]。

$$ \min_{\mathbf{p}} \ \lVert \mathbf{y} - \mathbf{S}\mathbf{p} \rVert_2^2 \quad \text{subject to} \quad \mathbf{p} \ge \mathbf{0} \ \text{and} \ \mathbf{1}^\top \mathbf{p} = 1 $$

这个公式是许多反卷积方法核心的计算引擎。

### 更深层的视角：离散分子的舞蹈

[最小二乘法](@entry_id:137100)虽然强大，但它将基因表达视为连续量。实际上，mRNA分子是离散的、可数的实体。它们的产生和捕获基本上是随机事件。一个更深刻的理解来自于拥抱这种随机性。

让我们利用[随机过程](@entry_id:159502)的原理从头开始建立一个模型[@problem_id:3311800]。细胞中一个基因的转录可以被建模为一个**泊松过程**——事件（一个mRNA分子的产生）以某个平均速率随机且独立地发生。现在，考虑我们的点，它包含多种细胞的混合物。对于一个给定的基因，mRNA分子的总池是该点中所有细胞分子的总和。泊松过程的一个奇妙特性，即**[叠加原理](@entry_id:144649)**，指出[独立泊松过程](@entry_id:264082)的和本身也是一个泊松过程，其速率是各个速率的和。因此，点中mRNA产生的总速率是纯细胞类型速率的比例加权平均值。

但我们并不能观察到所有这些分子。捕获和测序过程是有泄漏的；就像用有洞的网捕鱼。每个分子都有一定的概率被“捕获”。这个采样过程称为**泊松稀疏化**。神奇的是，如果你从一个泊松过程中随机抽样事件，得到的抽样事件流*也*是一个泊松过程，只是速率较低。

将这两个原理结合起来，我们就得到了一个完整的[生成模型](@entry_id:177561)。我们在一个点$s$中观察到的基因$g$的UMI计数$Y_{gs}$服从[泊松分布](@entry_id:147769)。其速率参数$\lambda_{gs}$是纯细胞类型表达速率按其比例加权求和，再乘以考虑了点特异性捕获率和基因特异性检测偏差的各种效率因子[@problem_id:3311800]：

$$ Y_{gs} \sim \mathrm{Poisson} \left( \lambda_{gs} \right) \quad \text{where} \quad \lambda_{gs} = (\text{效率因子}) \times \sum_{k=1}^{K} p_{ks} \times (\text{基因 } g \text{ 在细胞类型 } k \text{ 中的速率}) $$

在实践中，生物和技术噪声通常会产生比简单泊松模型所能处理的更多的变异——这种现象称为**[过度离散](@entry_id:263748)**。为了解释这一点，我们可以使用一个更灵活的[分布](@entry_id:182848)，即**负二项（NB）[分布](@entry_id:182848)**，它有一个额外的参数来模拟这种额外的[方差](@entry_id:200758)。许多最先进的方法，如`Stereoscope`和`cell2location`，都建立在这个稳健的NB框架之上[@problem_id:2890104]。

### 从模型到答案：推断的艺术

拥有一个好的模型只是成功的一半。我们如何用它来找到比例？这里有两种主要的哲学方法。**频率派**方法，如`RCTD`所使用的，旨在找到一组能最大化我们所收集数据的观测[似然](@entry_id:167119)的比例[@problem_id:2890104]。

另一方面，**贝叶斯**方法提供了对我们知识更全面的描绘。它不给出一个单一的答案，而是为每个比例返回一个完整的**[后验概率](@entry_id:153467)[分布](@entry_id:182848)**。这使我们不仅能说“我们估计[T细胞](@entry_id:181561)的比例是0.3”，还能说“并且我们有95%的把握确定真实比例在0.25到0.35之间”。这种不确定性的量化是贝叶斯推断的一个标志[@problem_id:3320367]。

这个框架非常灵活。像`cell2location`这样的高级贝叶斯模型可以估计一个点中细胞的绝对数量，而不仅仅是它们的相对比例，这有助于解决问题中一些固有的模糊性[@problem-id:2967190]。它们甚至可以融入先验知识，例如组织中相邻点可能具有相似的组成，通过使用连接相邻点模型的**空间先验**，使它们能够相互借鉴信息[@problem_id:3320367]。

### 可识别性之谜：这个问题真的可解吗？

这引出了我们最深层的问题：我们的问题是否能被唯一地解决？给定一个混合信号，是否总有且仅有一组源可以产生它？这就是**可识别性**之谜。

我们首先考虑**基于引用**的情景，即我们有一个高质量的特征矩阵$S$。这个问题约束性更好，但未必容易。如果两种细胞类型的表达谱非常相似怎么办？它们的特征——我们矩阵$S$的列——将高度相关。用线性代数的术语来说，这个矩阵是**病态的**。这就像试图区分两个声音和口音非常相似的说话者。数学解会变得不稳定，少量的噪声可能导致估计比例出现巨大误差，造成模型将一种细胞类型误认为另一种的“[串扰](@entry_id:136295)”[@problem_id:2892420]。对此的优雅解决方案包括重新加权数据以关注最独特的基因（**[加权最小二乘法](@entry_id:177517)**），或使用**正则化**来温和地惩罚极端的、不稳定的解，从而用一点点偏差换取[方差](@entry_id:200758)的大幅降低[@problem_id:2892420]。

在**无引用**的情况下，问题变得真正深刻，此时我们既不知道特征$S$也不知道比例$P$。我们试图通过分解数据矩阵$Y$来同时发现两者：$Y \approx SP$。这被称为**[非负矩阵分解](@entry_id:635553)（NMF）**。在这里，我们面临一个根本性的模糊性。如果我们找到了一个解$(S, P)$，我们通常可以找到一个[可逆矩阵](@entry_id:171829)$D$，使得$S' = SD$和$P' = D^{-1}P$也是有效的非负解，因为它们的乘积是相同的：$S'P' = SP = Y$ [@problem_id:2967190] [@problem_id:2753031]。

这个问题似乎无解！但几何学为我们提供了帮助。每个观测到的点的表达谱（$Y$的一列）是纯细胞类型特征（$S$的列）的[凸组合](@entry_id:635830)。这意味着我们所有的数据点都必须位于以纯特征为顶点的几何形状（一个锥体或单纯形）内部。寻找$S$的问题等同于在只给定形状内部点的情况下寻找其顶点。只有当数据包含“锚点”——即代表每种细胞类型的纯或近纯的例子时，$S$才能被唯一识别。这些锚点勾勒出形状的边缘，使我们能够找到其顶点[@problem_id:2753031]。没有它们，无数个形状都可能包含我们的数据云。

这段旅程——从拥挤组织点的物理现实，到线性代数和统计学的优雅数学，再到可识别性的深刻几何难题——揭示了细胞类型反卷积是多种思想的美妙交融。这是一个物理学、统计学和计算机科学原理联合起来照亮生命隐藏社会结构的领域。

