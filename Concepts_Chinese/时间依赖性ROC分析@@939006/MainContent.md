## 引言
[受试者工作特征](@entry_id:634523)（ROC）曲线是诊断医学的基石，它提供了一种简单而优雅的方法来衡量一项检测在区分两组（通常是“患病者”和“健康者”）方面的表现。然而，当面临时间维度时，这个经典工具就显得力不从心。在许多医疗场景中，问题不仅仅是像心脏病发作这样的事件*是否*会发生，而是*何时*发生。今天健康的患者可能在两年后发生事件，而另一位患者则可能在十年内保持健康。“病例”与“对照”的二元分类变得流动不定，完全取决于时间范围。经典方法中的这一空白，要求我们采用一种更动态的方法来准确评估预后标志物。

本文深入探讨了时间依赖性ROC分析，这是专为[生存数据](@entry_id:165675)设计的传统框架的强大扩展。它提供了在时变背景下评估和比较预后模型的必要工具。我们将通过两个全面的章节来解析这一方法论。首先，在“原理与机制”中，我们将探索其基本概念，剖析病例和对照如何随时间定义，以及如何处理现实世界数据中的复杂问题，如删失和[竞争风险](@entry_id:173277)。随后，“应用与跨学科联系”将展示该方法的多功能性，介绍其在[临床生物标志物](@entry_id:183949)验证、复杂机器学习模型评估以及确保医疗保健中[人工智能安全](@entry_id:634060)方面的应用。让我们从建立这一重要统计方法的基础原理开始。

## 原理与机制

想象一下你是一名医生。一位患者坐在你面前，你刚刚测量了一项新的生物标志物——我们称其值为 $S$。你想用这个分数 $S$ 来预测患者是否会心脏病发作。如果问题是“他们在未来一年内会心脏病发作吗？”，那么问题就很直接。你对一组患者进行为期一年的随访。最后，你得到两堆明确的群体：心脏病发作的（“病例”）和没有发作的（“对照”）。然后，你可以构建一条标准的[受试者工作特征](@entry_id:634523)（ROC）曲线，以了解你的分数 $S$ 在区分这两组人方面的表现如何。

但是，如果你对他们进行十年的随访呢？事情就变得模糊了。在第九年心脏病发作的患者当然是病例。但对于在第一年时健康、但在第二年心脏病发作的患者呢？在第一年那个节点，他们是“对照”吗？他们又如何与在整整十年里都保持健康的人相比呢？“病例”与“对照”的简单二元区分失效了，因为答案完全取决于你*何时*提出问题。时间，这个生命中许多过程里的沉默变量，已经登场，而我们的经典工具已不再足够。

### 一个小技巧：在时间中截取快照

为了应对时间的无情流逝，我们可以借鉴电影界的一个技巧：与其试图用一张静态照片捕捉整个故事，不如拍摄一系列快照。我们可以决定不仅评估一次生物标志物的性能，而是在不同的、具有临床意义的时间点重复评估。我们可以问：我们的分数在预测*一年内*发生心脏病方面的表现如何？*五年内*呢？或者*十年内*呢？

这个简单的想法——为每个选定的时间范围 $t$ 生成一条独立的[ROC曲线](@entry_id:182055)——是时间依赖性ROC分析的核心。但它立即迫使我们面对一个核心问题：对于在时间 $t$ 拍摄的快照，谁是病例，谁是对照？我们回答这个问题的方式定义了整个框架。

### 长远视角：累积风险

在时间 $t$ 定义病例和对照的最直观方法之一是**累积/动态**方法。让我们用一个类比来具体说明。想象你是一所学校的校长，正在测试一个新的阅读项目，以预测哪些学生会在四年后毕业前辍学。你在开始时为每个学生测量一个“风险分数”。

现在，第二学年结束了，你想评估你的测试。谁是你的病例，谁是对照？

-   **病例**是到这个两年期节点*已经*辍学的学生。我们正在累积到此为止发生的所有事件。这就是名称中**累积**（cumulative）部分的含义。
-   **对照**是在这个两年期节点*仍然在读*的学生。到目前为止，他们没有发生事件而存活下来。这组对照不是固定的；随着学生辍学或毕业，它会随着时间的推移而缩小。它是相对于快照时间定义的，因此是**动态**的（dynamic）。

形式上，如果 $T$ 是事件发生的时间（如心脏病发作），那么对于我们在时间 $t$ 的ROC曲线：
-   **病例**是在时间 $t$ 或之前发生事件的所有个体（即 $T \le t$）。
-   **对照**是在时间 $t$ 之前未发生事件的所有个体（即 $T > t$）。

有了这些定义，我们就可以为我们的分数 $S$ 的任何阈值 $c$ 计算**时间依赖性灵敏度**和**时间依赖性特异度**[@problem_id:4577641]：

-   $\text{Sensitivity}_t(c) = \mathbb{P}(S > c \mid T \le t)$ 是在时间 $t$ 前成为病例的情况下，测试结果为阳性的概率。
-   $\text{Specificity}_t(c) = \mathbb{P}(S \le c \mid T > t)$ 是在时间 $t$ 时仍为对照的情况下，测试结果为阴性的概率。

与任何[ROC曲线](@entry_id:182055)一样，我们随后为所有可能的阈值 $c$ 绘制[真阳性率](@entry_id:637442)（$\text{Sensitivity}_t(c)$）对假阳性率（$1 - \text{Specificity}_t(c)$）的曲线图。这为我们提供了该生物标志物在特定时间范围 $t$ 的完整性能图景。

这种累积/动态方法回答了一个关键的临床问题：“我的基线测试在区分*未来 $t$ 年内某个时间点*会发生事件的患者和不会发生事件的患者方面表现如何？”[@problem_-id:4607870]。它非常适合用于关于长期预防性治疗的决策。

### 两个问题的故事：累积风险与瞬时风险

累积方法功能强大，但它并不能回答所有问题。考虑以下两个截然不同的临床场景[@problem_id:4607870]：

1.  一位新患者前来就诊。医生必须决定是否开始一项为期五年、费用高昂的预防性治疗。关键问题在于患者在*整个五年期间*发生事件的总体风险。这是一个关于**累积风险**的问题。

2.  一位癌症幸存者来进行他的第四年复查。他目前无病。医生必须决定是否*今天*安排一系列密集的检查。关键问题在于患者*就在此刻，在不久的将来*发生复发的风险。这是一个关于**瞬时风险**的问题。

我们讨论过的累积/动态ROC曲线非常适合第一种情况。但对于第二种情况，它并不完全适用。它将第一年发生事件的患者与第四年发生事件的患者混为一谈。对于评估即时风险的医生来说，这不是最相关的比较。我们需要一个不同的工具。

这就引出了第二个主要范式：**即时/动态**方法[@problem_id:4999433]。

让我们回到我们那位中学校长。现在是第三学年开始。校长的问题不再是到目前为止谁辍学了，而是“在目前仍在校的学生中，谁在*本学年*辍学的风险最高？”

-   **病例**是在时间 $t$ *发生*事件的学生（或者更正式地说，在围绕 $t$ 的一个极小时间窗口内）。这些是“即时”病例（incident cases）。
-   **对照**和以前一样，是在时间 $t$ 仍然无事件且因此处于“风险中”的动态群体。

这种方法与生存分析中的**风险率**（hazard rate）——在存活到时间 $t$ 的条件下，事件在 $t$ 时刻发生的瞬时可能性——的概念紧密相连。即时/动态[ROC曲线](@entry_id:182055)告诉我们，我们的生物标志物在特定时刻区分高风险与低风险个体的能力如何。它回答了医生的第二个问题，有助于指导关于即时干预或监测的决策。

### 现实世界的干预：缺失的数据与混杂的结局

我们理想化的、病例和对照分明的世界在实践中很少存在。医学研究是混乱的。人们会搬家，决定不再参与研究，或者经历一些我们不感兴趣的结局。这些现实世界的复杂性要求我们使用更复杂的机制。

#### 删失问题：当数据丢失时

在我们的辍学研究中，一个学生可能会搬到新城市。我们失去了联系。我们不知道他们是在新学校辍学了，还是以优异成绩毕业了。这被称为**[右删失](@entry_id:164686)**（right-censoring）。我们知道他们在搬家之前一直在研究中，但他们的最终结局是未知的。

如果我们简单地忽略这些被删失的个体，就会引入偏倚。想象一下，风险分数低的学生更有可能搬家。如果我们将他们从分析中剔除，我们剩下的将是一个风险更高的人群，我们可能会错误地得出结论，认为我们的阅读项目是无效的。

对此，一个优雅的解决方案是一种名为**删失数据逆概率加权（IPCW）**的统计技术[@problem_id:5222305] [@problem_id:4612159]。其逻辑优美且出人意料地简单。如果我们能估计出，每十个像那个搬走的学生一样的学生中，有九个会留在研究里，那么我们可以给剩下的九个学生在计算中赋予一点额外的“权重”——具体来说，是 $10/9$ 的权重。他们现在共同代表了那个丢失的学生。这个权重就是*未被删失*（即留在研究中）的概率的倒数。

当我们从真实世界数据中计算时间依赖性灵敏度和特异度时，我们不只是简单地计数受试者，而是对他们的权[重求和](@entry_id:275405)。对于在时间 $Y_i$ 发生事件的“病例”，其权重是他们在研究中存活到时间 $Y_i$ 的概率的倒数。对于在我们的时间范围 $t$ 仍无事件的“对照”，其权重是他们在研究中存活到时间 $t$ 的概率的倒数。这种重新加权的方案在数学上校正了由删失引入的偏倚，使我们能够像拥有完整数据一样洞察世界。当然，这需要我们准确地对删失过程本身进行建模，通常使用像[Kaplan-Meier](@entry_id:169317)或Cox回归这样的标准生存模型。

#### 竞争风险问题：当结局混淆时

让我们最后一次使我们的辍学研究复杂化。我们试图预测因*学业失败*而导致的辍学。但是，一个学生可能因为一个完全不同的原因辍学，比如家庭紧急情况或一份利润丰厚的工作机会。这是一个**竞争风险**。它阻止了我们感兴趣的事件发生。一个正在评估因癌症死亡的患者，可能首先在车祸中丧生。

我们应该如何对那个为了一份工作而离开的学生进行分类？他不是学业失败的“病例”。但他是一个“对照”吗？这是一个深刻的问题，答案引向两条不同的哲学路径，每条路径都回答一个不同的科学问题[@problem_id:4577755] [@problem_id:5181665]。

**路径1：原因别视角。** 在这里，我们想要评估该标志物在一个不存在其他辍学原因的世界中，预测学业失败的纯粹、类似生物学的能力。我们这样定义我们的群体：
-   **病例：** 在时间 $t$ 前因学业失败而辍学的学生。
-   **对照：** 在时间 $t$ 时仍在校的学生。

那些因其他原因辍学的学生被排除出游戏——我们视他们在离开时被删失。这种方法评估了标志物与**原因别风险**（cause-specific hazard）的关联。然而，这里潜伏着一个危险[@problem_id:4604338]。如果我们的“学业失败”分数也能预测获得好工作机会（例如，它衡量的是原始智力）怎么办？那么，通过将“工作机会”辍学者视为删失，我们正在选择性地从我们的[对照组](@entry_id:188599)中移除高分个体。这是一种**信息性删失**（informative censoring），它会严重偏倚我们的结果。我们评估的不再是真实世界中的性能，而是一个假设世界中的性能。

**路径2：子分布视角。** 在这里，我们采取一种更务实、更临床的立场。医生需要预测他们的患者在所有风险都存在的世界里实际会发生什么。问题是：“这个分数能否区分在时间 $t$ 前会发生我们感兴趣的事件的患者和所有其他患者？”
-   **病例：** 在时间 $t$ 前因癌症死亡的患者。
-   **对照：** *其他所有人*——那些在时间 $t$ 仍然存活的患者**以及**那些在时间 $t$ 前因其他原因（如车祸）死亡的患者。

这个框架评估了标志物预测**累积发生函数（CIF）**——在存在[竞争风险](@entry_id:173277)的情况下事件发生的真实概率——的能力。由此产生的ROC曲线直接衡量了在真实世界预后中的临床效用。将竞争事件包含在[对照组](@entry_id:188599)中是关键区别，它深刻地改变了被回答的问题。

### 融会贯通：统一之美

所以，我们有了一整套[ROC曲线](@entry_id:182055)，每个时间点 $t$ 都有一条。在时间 $t$ 的[曲线下面积](@entry_id:169174)，我们可以称之为 $\text{AUC}(t)$，它具有熟悉而优美的概率意义：它是一个随机选择的病例比一个随机选择的对照有更令人担忧的生物标志物分数的概率（其中“病例”和“对照”根据我们选择的框架定义）[@problem_id:4568432]。

通过绘制 $\text{AUC}(t)$ 对时间 $t$ 的曲线，我们可以为我们的生物标志物创建一个随时间变化的性能剖面。它的预测能力是早期达到顶峰然后消退吗？这将表明它是一个用于急性、早发性疾病的良好标志物。还是 $\text{AUC}(t)$ 曲线随时间稳步上升？这可能是一个缓慢、退行性过程的标志物特征，其影响会逐渐累积。这条曲线的形状讲述了一个关于标志物与疾病过程本身关系的动态故事。

作为最后一点见解，让我们将此与另一个广泛用于生存模型的指标联系起来：**Harrell's c-index（或一致性指数）**。表面上看，c-index似乎完全不同。它是通过查看研究中所有可能的患者对来计算的。对于每一对我们能判断出谁先发生事件的患者，我们检查事件发生较早的人是否也有较高的风险分数。c-index就是这样“一致”的配对比例。它给出了一个单一的数字来总结模型在整个研究中的性能。

事实证明，两者之间存在着深刻而优雅的联系。在常见的假设下，Harrell's c-index完[全等](@entry_id:194418)于**在所有时间点上对即时/动态$\text{AUC}(t)$的加权平均值** [@problem_id:4607933]。权重与每个时间点事件发生的可能性成正比。这是一个非凡的结果。它揭示了单一、静态的c-index实际上是总结了标志物在整个疾病过程中*瞬时*预测能力的平均表现。这是一个美丽的例子，说明了为不同目的发展的不同统计思想，如何可能是同一潜在真理的不同侧面。

