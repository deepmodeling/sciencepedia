## 引言
宇宙是如何从大爆炸后一个炽热、均匀的等离子体，演化成我们今天观测到的错综复杂的星系宇宙网的？回答这个问题构成了一个根本性的挑战：我们无法对宇宙本身进行实验。计算宇宙学通过创建复杂的虚拟宇宙来应对这一挑战，让科学家们能够在数字实验室中检验理论和探索宇宙历史。本文对这一引人入胜的领域进行了全面的概述。第一章“原理与机制”将解析其核心物理学——从爱因斯坦的广义相对论到暗物质和宇宙气体的行为——以及用于模拟这些现象的数值方法，如 N 体模拟和[流体动力学模拟](@entry_id:142279)。随后，“应用与跨学科联系”一章将展示这些模拟如何作为强大工具，被用于检验[引力](@entry_id:175476)和暗物质理论、模拟恒星与星系的诞生，并与观测天文学建立起关键的联系。要开始我们构建“盒子中的宇宙”的旅程，我们必须首先理解它所遵循的脚本以及赋予其生命的机制。

## 原理与机制

要在计算机中构建一个宇宙，我们必须首先理解它所遵循的脚本。究竟是哪些基本定律和核心原理，支配着它从一个近乎均匀的等离子体演化到我们今天所见的丰富多彩的星系织锦？这不仅仅是写下几个方程那么简单；它是一场深入[引力](@entry_id:175476)、[流体动力学](@entry_id:136788)以及[时空结构](@entry_id:158931)本身核心的旅程。就像一位钟表大师，我们必须在组装整体之前，先领会每个部件的功能。

### 宏大的简化：一个均匀且各向同性的舞台

乍一看，模拟宇宙的任务似乎不可能完成。其复杂性之高令人望而生畏。但大自然对我们很仁慈。当我们在最宏大的尺度上审视宇宙时，一种惊人的简单性浮现出来：它在每个方向（**各向同性**）和每个位置（**[均匀性](@entry_id:152612)**）看起来都一样。这一深刻的观测被庄重地载入**[宇宙学原理](@entry_id:158425)**。

当然，我们无法从绝对意义上证明这一点。我们该如何做到呢？我们被困在时空中的一个点上。我们直接观测到，宇宙在我们周围表现出显著的各向同性——宇宙微波背景辐射、遥远星系的[分布](@entry_id:182848)，无论我们将望远镜指向何方，看起来都一样。要从这种“我们周围的各向同性”跃升到完全的均匀性，需要一步被称为**哥白尼原理**的理智上的谦逊：我们在宇宙中并不占据一个特殊的、优越的位置。如果宇宙对我们来说是各向同性的，那么它对任何其他位置的任何其他观测者来说也必须是各向同性的。根据一个简洁的数学定理，一个在*每一点*周围都是各向同性的宇宙，也必然是均匀的 [@problem_id:3494773]。

这一原理是现代宇宙学的基石。它允许我们用一个单一的、依赖于时间的函数来描述整个宇宙的背景几何：**尺度因子** $a(t)$。尺度因子告诉我们空间结构本身是如何伸展的。这种膨胀的动力学由 [Albert Einstein](@entry_id:271868) 的广义相对论所支配，并被精炼为两个优雅的关系式，即 **Friedmann 方程**。第一个 Friedmann 方程是一个宇宙[能量收支](@entry_id:201027)方程：

$$
H^2 = \left(\frac{\dot{a}}{a}\right)^2 = \frac{8\pi G}{3} \rho_{\text{tot}} - \frac{k c^2}{a^2}
$$

这里，$H$ 是哈勃参数，衡量膨胀速率。该方程告诉我们，这个膨胀速率是由宇宙的总能量密度 $\rho_{\text{tot}}$ 驱动的，并受到其空间曲率的制约，曲率由指数 $k$ 代表（对于一个封闭的球形宇宙，$k$ 为 $+1$；对于[平坦宇宙](@entry_id:183782)，为 $0$；对于开放的马鞍形宇宙，为 $-1$）。

这个方程引入了一个关键概念：**临界密度** $\rho_c = \frac{3H^2}{8\pi G}$。这是使宇宙空间平坦（$k=0$）所需要的精确密度。我们用它来定义著名的**[密度参数](@entry_id:265044)** $\Omega_i = \rho_i / \rho_c$，它告诉我们每种成分（物质、辐射、[暗能量](@entry_id:161123)）对宇宙总能量收支的贡献，以临界密度的分[数值表示](@entry_id:138287)。重新整理 Friedmann 方程，我们得到优美而强大的**闭合关系**：

$$
\sum_i \Omega_i(t) + \Omega_k(t) = 1
$$

其中 $\Omega_k(t) = -k c^2 / (a^2 H^2)$ 是一个代表曲率“等效”能量密度的项。这不是一条新定律，而是一个在任何时候都必须成立的恒等式。对于计算宇宙学家来说，这是一条黄金法则：在设置模拟及其初始参数时，它们之和必须为一。在模拟过程中，检查这一关系是否持续成立，是检验数值[误差累积](@entry_id:137710)情况的重要测试 [@problem_id:3495809]。

### 宇宙之舞：膨胀背景上的微扰

平滑、膨胀的宇宙只是舞台。真正的戏剧——星系、恒星和行星的形成——发生在与完美均匀状态的微小偏离之中。我们模拟的目标就是追踪这些密度涨落的演化。

但在这里，一个对[牛顿引力](@entry_id:159796)的天真应用会陷入一个著名的悖论。如果你想象一个无限、静态的空间，均匀地充满了物质，那么[引力](@entry_id:175476)会指向哪里？任何一点的力都是不确定的。这个被称为“Jeans 佯谬”的难题，在历史上曾通过只考虑*涨落*的[引力](@entry_id:175476)而被掩盖。然而，广义相对论提供了一个优美且自洽的解决方案。均匀背景密度的[引力](@entry_id:175476)不会导致向某个任意中心的坍缩；相反，它驱动了空间本身的整[体膨胀](@entry_id:144241)，正如 Friedmann 方程所描述的那样。背景[引力](@entry_id:175476)的“问题”通过被吸收到尺度因子 $a(t)$ 的动力学中而得到解决 [@problem_id:3500324]。

这使我们能够在**[共动坐标系](@entry_id:266800)**中自由地模拟密度涨落 $\delta(\mathbf{x}, t) = (\rho(\mathbf{x}, t) - \bar{\rho}(t))/\bar{\rho}(t)$ 的演化。这是一个随[宇宙膨胀](@entry_id:161474)而伸展的网格。一个没有[本动速度](@entry_id:157964)的物体会停留在固定的[共动坐标](@entry_id:271238) $\mathbf{x}$ 上。这是使[宇宙学模拟](@entry_id:747928)成为可能的点睛之笔：我们模拟的是在动态演化的舞台上上演的[结构形成](@entry_id:158241)大戏。

### N 体方法：为暗物质编舞

宇宙中物质的主要成分是**[冷暗物质](@entry_id:158219)（CDM）**。它之所以“冷”，是因为其粒子运动缓慢；之所以“暗”，是因为它不与光发生相互作用。至关重要的是，它也是**无碰撞的**；它的粒子之间只通过温和、长程的[引力](@entry_id:175476)相互作用。

模拟无碰撞流体可以通过在我们的计算机中将其表示为大量离散的“粒子”来完成——这就是**N 体模拟**。其任务在概念上很简单，但在实践中却极其艰巨：在每个时间步，计算每个粒子受到的总[引力](@entry_id:175476)，然后相应地移动每个粒子。

直接计算所有粒子对之间的力所需时间与 $N^2$ 成正比，对于现代模拟中数十亿的粒子来说，这在计算上是不可行的。取而代之，我们使用一种巧妙的基于网格的方法，称为**粒子-网格（PM）方法**。它分几步工作：
1.  **[质量分配](@entry_id:751704)：** 我们在模拟盒子上方铺设一个网格。每个粒子的质量被“分配”到附近的网格单元上。一个流行且有效的方案是**胞中云（CIC）**，其中一个粒子被视为一小片云，其质量根据距离远近加权分配给 3D 空间中最近的 8 个单元 [@problem_id:3466962]。
2.  **求解[引力](@entry_id:175476)：** 当密度在规则网格上定义好后，我们可以求解**[泊松方程](@entry_id:143763)** $\nabla^2 \phi = \text{const} \times \delta$，该方程将[引力势](@entry_id:160378) $\phi$ 与密度涨落 $\delta$ 联系起来。PM 方法的魔力在于**快速傅里叶变换（FFT）**。在傅里叶空间中，麻烦的拉普拉斯算符 $\nabla^2$ 变成了简单的乘以 $-|\mathbf{k}|^2$，其中 $\mathbf{k}$ 是[波矢](@entry_id:178620)。因此，我们对密度网格进行 FFT，除以 $-|\mathbf{k}|^2$ 以求得引力势，然后再进行逆 FFT。
3.  **计算力：** [引力](@entry_id:175476)就是引力[势的梯度](@entry_id:268447)，$\mathbf{F} = -\nabla\phi$。这在网格上使用[有限差分](@entry_id:167874)很容易计算。
4.  **力插值：** 然后，通过从网格上进行插值，使用与 CIC 方案相反的方式，来找到每个粒子实际位置上的力。

这种基于网格的方法并非没有其精妙之处。对[拉普拉斯算符](@entry_id:146319)的[有限差分近似](@entry_id:749375)并非完全各向同性；力沿网格轴向作用会稍微“容易”一些。这可以通过计算我们[离散拉普拉斯](@entry_id:173800)算符的精确傅里叶空间表示，并用它来“解卷积”结果，从而确保即使在小尺度上力也是准确的 [@problem_id:3490023]。

一旦我们有了力，就必须更新粒子的位置和速度。这里又出现了一个具有深远重要性的精妙之处。我们使用特殊的**辛积分器**。与较简单的方法不同，这些[积分器](@entry_id:261578)被设计用来精确地保持哈密顿力学的一个基本几何性质。这并不意味着它们在短时间尺度上能完美地守恒能量，但它能防止系统误差的长期累积，确保我们模拟的行星在经过数十亿年的模拟时间后不会螺旋式地坠入它们的太阳 [@problem_id:3493127]。

### [流体动力学](@entry_id:136788)的交织：模拟宇宙气体

重子物质——构成我们的物质——是完全不同的东西。它不是无碰撞的。它是一种气体，能感受压力、加热、冷却，并形成激波结构。为了模拟它，我们必须解**[流体动力学](@entry_id:136788)**方程。

现代方法是**有限体积 Godunov 方法**。其核心思想是将模拟体积划分为单元格，并追踪每个单元格内的总质量、动量和能量。这些是**[守恒变量](@entry_id:747720)**，意味着它们的总量仅因跨越单元格边界的通量而改变。通过将方程以这种**[守恒形式](@entry_id:747710)**表述，我们保证了我们的模拟能正确捕捉激波——即性质发生不连续变化的宇宙级音爆——的物理过程，而不会违反基本的[守恒定律](@entry_id:269268) [@problem_id:3464070]。

数值实现是两组变量之间的一场优美的舞蹈。虽然我们更新*[守恒变量](@entry_id:747720)*（$\rho, \rho\mathbf{u}, E$）以保持物理保真度，但在单元格边界处的实际波动物理学用*[原始变量](@entry_id:753733)*如密度、速度和压力（$\rho, \mathbf{u}, p$）来理解要简单得多。因此，一个典型的方案包括：
1. 使用原始变量重建每个单元格内的气体状态。
2. 在每个界面求解一个“黎曼问题”，以确定在单元格之间流动的气体状态。
3. 利用这个解来计算*守恒*量的通量。
4. 根据这些通量更新每个单元格中的[守恒量](@entry_id:150267)。

这种[混合方法](@entry_id:163463)让我们两全其美：既有原始变量的物理直观性，又有[守恒变量](@entry_id:747720)的稳健守恒特性。

### 布置场景：[早期宇宙](@entry_id:160168)的印记

一个模拟的好坏取决于它的起点。我们不能从大爆炸本身开始模拟；我们通常在晚得多的时候开始，例如在[红移](@entry_id:159945) $z \approx 100$ 时。但初始条件是什么呢？我们需要在模拟盒子中播下正确的微小密度和速度涨落模式。

这个模式被编码在**[转移函数](@entry_id:273897)** $T(k)$ 中。对于每个长度尺度（或傅里叶[波数](@entry_id:172452) $k$），它告诉我们在我们的起始时刻应该存在的涨落幅度，这个幅度是相对于[宇宙暴胀](@entry_id:160214)期间产生的原始涨落谱而言的。

这里包含一个关键的物理学部分。重子和[冷暗物质](@entry_id:158219)在早期宇宙中的经历截然不同。在[复合时期](@entry_id:159287)（$z \sim 1100$）之前，重子与[光子](@entry_id:145192)在一个炽热、稠密的等离子体中紧密耦合。这种重子-[光子](@entry_id:145192)流体支持[声学振荡](@entry_id:161154)——在早期宇宙中荡漾的声波。而只通过[引力](@entry_id:175476)相互作用的[冷暗物质](@entry_id:158219)则不受这种压力的影响，开始缓慢地聚集在一起。

结果是，在它们解耦的时刻，重子和[冷暗物质](@entry_id:158219)具有不同的[空间分布](@entry_id:188271)，并且彼此之间存在相对运动。这留下了不可磨灭的印记。它们的[转移函数](@entry_id:273897) $T_b(k)$ 和 $T_c(k)$ 是不同的。特别是，重子的[转移函数](@entry_id:273897)中存在对应于声波的摆动，即著名的**[重子声学振荡](@entry_id:158848)（BAO）**。此外，这两个组分之间存在一个大尺度的、相干的**[相对速度](@entry_id:178060)** $v_{cb}$。一个高保真度的模拟必须使用它们各自不同的[转移函数](@entry_id:273897)来分别初始化这两种流体，以捕捉这种相对运动。忽略它——例如，给两种流体相同的平均物质涨落——会抹去一个影响第一代星系如何形成的关键物理，并在它们今天的成团性中留下一个微妙的、可观测的印记 [@problem_id:3499487]。

### 宇宙时钟与[引力](@entry_id:175476)规则

最后，我们的模拟是如何随时间向[前推](@entry_id:158718)进的呢？我们以离散的时间步长 $\Delta t$ 前进。但是这些步长可以设多大呢？对于任何显式数值方案，都存在一个由**[Courant-Friedrichs-Lewy (CFL) 条件](@entry_id:747986)**给出的硬性限制。它规定信息在单个时间步内传播的距离不能超过一个网格单元。如果一个粒子或声波移动得太远，模拟将变得不稳定并产生无意义的结果。

在一个膨胀的宇宙中，这带来了一个很好的简化。一个具有恒定*物理*速度 $v_{\text{phys}}$ 的波（比如在特定温度气体中的声波）其*共动*速度为 $v_{\text{comov}} = v_{\text{phys}} / a(t)$。随着[宇宙膨胀](@entry_id:161474)，$a(t)$ 增加，这个波在我们的[共动坐标系](@entry_id:266800)中看起来会变慢。这意味着 CFL 条件 $\Delta t \le C \Delta x / v_{\text{comov}}$ 变得不那么严格。随着模拟的进行，我们可以采取越来越大的时间步长，使得宇宙演化的[后期](@entry_id:165003)阶段在计算上更便宜 [@problem_id:2383704]。

为了简化，以上整个讨论都将[引力](@entry_id:175476)视为单一的牛顿势。但在广义相对论中，度规的[标量微扰](@entry_id:160338)由两个势描述：$\Phi$，它支配非[相对论性粒子](@entry_id:161314)的运动（即“牛顿”势）；以及 $\Psi$，它描述[空间曲率](@entry_id:755140)的微扰。对于一个只充满像[冷暗物质](@entry_id:158219)和重子这样的简单“理想流体”的宇宙，爱因斯坦方程要求 $\Phi = \Psi$。然而，如果存在具有**[各向异性应力](@entry_id:161403)**——即在不同方向上压力不同——的组分，它会产生一种“[引力滑移](@entry_id:161048)”，使得 $\Phi \neq \Psi$。在标准模型中，造成这种情况的主要元凶是[自由流](@entry_id:159506)粒子，如中微子和[光子](@entry_id:145192)。通过比较星系的成团性（追踪 $\Phi$）和光的[引力透镜效应](@entry_id:159000)（追踪 $\Phi+\Psi$）来测量这种滑移，是对基础物理学的一个强有力的检验，可以探测[修正引力](@entry_id:158859)或奇异能量组分的存在。我们最先进的模拟代码必须追踪这种区别，以便与我们对[引力](@entry_id:175476)本身最深刻的理解进行对接和检验。

因此，在计算机中构建一个宇宙，迫使我们精确地面对和实现一系列广泛的物理原理——从宇宙的宏大对称性，到在不断膨胀的舞台上粒子与场的精妙舞蹈。

