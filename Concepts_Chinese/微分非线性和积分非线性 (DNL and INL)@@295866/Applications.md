## 应用与跨学科联系

我们花了一些时间来学习[微分](@article_id:319122)和积分非线性的正式定义。我们已经看到它们如何衡量[数据转换](@article_id:349465)器与其理想、完全均匀的阶梯式传递函数的偏差。但这些只是定义，是数学形式。真正有趣的部分始于我们提问：那又怎样？这些误差从何而来，它们在现实世界中会引起什么麻烦？它们重要吗？正如我们即将看到的，DNL 和 INL 的故事是连接完美的抽象数字代码世界与混乱的模拟物理现实之间桥梁的故事。它们不仅仅是数据手册中的条目；它们是制造变异、热梯度和电源噪声的指纹，其后果波及现代电子学的每一个领域。

### 缺陷剖析

DNL 和 INL 的核心在于一个简单、不可避免的事实：在物理世界中，没有两样东西是完全相同的。对于一个依赖于一组假定匹配的元器件——电阻、电容或[电流源](@article_id:339361)——的[数据转换](@article_id:349465)器来说，这个事实就是原罪。

想象一个简单的[闪存](@article_id:355109)式 ADC，它使用一个电阻梯为比较器创建一系列参考电压。在完美的世界里，所有电阻都相等，电压步阶也完全均匀。但在一个真实的设备中，如果其中一个电阻由于微小的制造缺陷而具有略微不同的值呢？该电阻上的压降将会不同，这将使两个相邻的电压阈值偏离其位置。这会产生一个过宽的量化区间（正 DNL），并且为了保持总电压范围，使其他区间略微变窄（负 DNL）[@problem_id:1330334]。问题不仅出在无源元件上。比较器本身，作为主动的决策元件，也可能有其自身的[输入失调电压](@article_id:331483)，这会有效地移动它们的决策点，并导致非线性 [@problem_id:1304600]。

这种脆弱性在某些架构和某些代码转换点上尤其明显。考虑一个 R-2R 梯形 DAC，这是一种仅用两种阻值的电阻就能构建全范围输出的精巧设计。它的致命弱点是“主进位转换”，例如从二进制的 `0111` 转换到 `1000`。在这一点上，连接到低位的一整组开关关闭，而一个用于最高有效位 (MSB) 的新开关打开。如果与该单个 MSB 相关的元件规格哪怕有轻微偏差，所产生的电压步阶就会明显不正确，正好在这个主转换点上产生一个大的 DNL 尖峰 [@problem_id:1327546]。

这种效应在逐次逼近寄存器 (SAR) ADC 中表现得最为剧烈，这种 ADC 通常依赖于一个由二进制加权电容阵列构成的内部[电荷](@article_id:339187)再分配 DAC。假设用于 MSB 的电容——阵列中最大的那个——其值仅有 $+0.5\%$ 的误差。当 ADC 跨越中点（从 `011...1` 到 `100...0`）时，MSB 电容[电荷](@article_id:339187)贡献的这个微小相对误差会导致步阶大小的*巨大*误差。这种单一转换的 DNL 大于 $+1$ LSB 的情况并不少见 [@problem_id:1334889]。DNL 为 $+1$ 意味着该特定码区间的宽度是其理想尺寸的两倍。这个过大的区间如此之大，以至于它实际上完全“吞噬”了下一个码区间的电压范围。其后果就是一个**失码**——一个 ADC 在物理上永远无法产生的数字输出值。这个数字在数字领域存在，但没有任何模拟输入电压能够产生它。

面对这种不可避免的随机性，聪明的设计师们并不[期望](@article_id:311378)完美；他们管理不完美。例如，在高性能的电流舵 DAC 中，他们不是为一位制作一个巨大的[电流源](@article_id:339361)，而是由数百个更小的、相同的“单位”电流源构成。这些小源的统计变化倾向于相互抵消，从而改善匹配度。此外，他们可以使用“分段”技术，对最重要的几位采用简单的逐一增加的[温度计码](@article_id:340343)（避免了主进位转换），而对次要的位则使用二进制码。最终的 DNL 并未消除，但它变成了一个可预测的统计量，使得设计师能够基于位数和单个单元元件的基本相对标准差 $\sigma_{rel}$ 来计算预期的“最差情况”DNL [@problem_id:1298339]。

### 对动态性能的连锁反应

到目前为止，我们已经将 DNL 和 INL 作为静态的直流误差来讨论。但我们使用转换器来处理随时间变化的信号——音乐、[无线电波](@article_id:374403)、医学图像。那时会发生什么？传递曲线的静态非线性开始产生深远的动态后果。

如果你让一个纯[正弦信号](@article_id:324059)通过一个具有非线性传递函数的系统，输出的不仅仅是原始的[正弦波](@article_id:338691)。它被[谐波](@article_id:360901)污染了——在原始频率的整数倍处出现的不需要的能量。这就是**[总谐波失真](@article_id:335720) (THD)**。ADC 的 INL 是其传递函数非线性的直接度量，因此 INL 直接产生 THD。但事情更为微妙。DNL 误差，一个局部的步阶误差，也有贡献。在一个完美展示硬件和信号处理之间联系的例子中，DNL 误差的影响关键取决于它相对于信号行为*发生的位置*。一个靠近[正弦波](@article_id:338691)过零点的误差，即电压变化最快的地方，会产生一个非常短暂但尖锐的误差脉冲。一个完全相同的误差靠近信号峰值，即电压停留较久的地方，则会产生一个更长、幅度更低的误差脉冲。这些不同的误差形状具有完全不同的频率内容，这意味着中量程处的 DNL 误差可能产生与满量程极限附近完全相同的误差所产生的 THD 量不同 [@problem_id:1280562]。

另一个关键的动态参数是**[建立时间](@article_id:346502)**：在数字码改变后，DAC 的输出到达一个新值的速度。对于高速应用，这是至关重要的。我们通常将“稳定”定义为输出进入并保持在一个误差带内，通常是围绕*理想*最终电压的 $\pm \frac{1}{2} V_{LSB}$。在这里，一个大的 DNL 可能会玩一个特别恶劣的把戏。假设一个 DAC 在某个转换点有 $+0.9$ LSB 的 DNL。这意味着它将稳定到的*实际*最终电压是 $V_{ideal} + 0.9 V_{LSB}$。由于这个最终的物理电压本身就在 $\pm 0.5 V_{LSB}$ 误差带之外，根据这个定义，输出永远无法“稳定”。输出电压可能会在其到达其最终错误值的途中穿过目标窗口，但它不会停留在那里。对于任何等待“稳定”信号的系统来说，等待将是永恒的 [@problem_id:1295631]。

### 系统为王：跨学科联系

一个[数据转换](@article_id:349465)器并非生活在真空中。它是更大系统的一部分，其缺陷既可以是其他地方问题的原因，也可以是其后果。

一个绝佳的例子是与电源的相互作用。电流舵 DAC 汲取的输出电流取决于数字码。像 `100` 这样的码可能会激活一个大的电流源，而 `011` 则激活两个较小的电流源。如果电源网络有哪怕少量的电阻（它总是有），局部电源电压会根据汲取的总电流——从而也根据数字码——而下降。现在，如果电流源本身不能完全免疫这些电源变化（即它们具有有限的[电源抑制比](@article_id:332499)，或 PSRR），它们的输出电流就会改变。这就形成了一个恶性循环：数字数据[调制](@article_id:324353)了电源，而电源反过来又破坏了模拟输出，产生了依赖于码的误差，表现为 DNL 和 INL [@problem_id:1326001]。表面上看是 DAC 的线性问题，实际上是一个系统级的电源完整性问题。

DNL 和 INL 的概念是如此基础，以至于它们超越了电压和电流的范畴。谁说一个 LSB 必须是伏特？它也可以是皮秒。在现代计算机和通信系统的核心，[锁相环](@article_id:335414) (PLL) 产生为一切计时的高频时钟。为了保持这些时钟稳定，一些先进的 PLL 使用时间-数字转换器 (TDC) 来测量微小的[相位误差](@article_id:342419)。一种常见的 TDC 架构是一个简单的抽头延迟线：一串逻辑门。一个信号沿着链传播，数字码就是它在测量时间间隔内通过的门数。单个门的延迟就充当了这个 TDC 的 LSB。但是，如果硅芯片上的制造梯度使得一侧的门比另一侧稍慢怎么办？这就在量化区间宽度上造成了一个系统的、与位置相关的误差——一个**时域**中的 DNL 分布。这种时间非线性会给 PLL 引入[抖动](@article_id:326537)和噪声，每秒可能破坏数万亿次的计算或通信 [@problem_id:1325054]。

最后，在一个会让任何物理学家都感到高兴的转折中，一个误差有时可以被转化为一个特性。想象我们有一个 DAC，它有一个非常糟糕的转换点，表现出很大的 DNL。让我们施加一个直流输入，将 DAC 精确地偏置在这个有缺陷的阈值上。现在，我们添加一个微小的[正弦信号](@article_id:324059)，其幅度小到只有理想 LSB 的一小部分。通常，这样小的信号会完全被量化所吞噬，永远消失。但在这里，当微小信号在这个超敏感的阈值上来回推动输入时，它会导致 DAC 的输出在两个模拟电平之间切换。而且由于这些电平之间的步阶特别大（多亏了 DNL），产生的方波输出也异常大。它在[频谱](@article_id:340514)中的幅度实际上与这个错误步阶的大小成正比，即 $(1+\delta)V_{LSB}$ [@problem_id:1295647]。以一种奇特的方式，我们利用了 DAC 的非线性来有效地放大一个亚 LSB 信号，使得一个原本看不见的信号变得可检测。这是一种与[随机共振](@article_id:320958)现象相呼应的现象，即噪声——或者在这种情况下，一个确定性的缺陷——可以增强对微弱信号的检测。这是一个美好的提醒，在物理和工程的世界里，即使是我们的不完美之处，也有其有趣的故事可讲。