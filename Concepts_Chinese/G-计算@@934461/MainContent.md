## 引言
在科学研究中，尤其是在医学和公共政策等领域，确定因果关系是最基本的挑战之一。我们不断面临“如果……会怎样”的问题——如果采用了不同的治疗方法或颁布了另一项政策，结果会是怎样？虽然随机对照试验是金标准，但我们常常必须依赖充满复杂性（如混杂）的观察性数据。当干预措施和混杂因素随时间演变，形成标准统计方法无法处理的反馈循环时，一个尤为棘手的问题便产生了。本文介绍 G-计算，这是一种强大的、基于模拟的方法，旨在应对这些复杂情况。在接下来的章节中，我们将首先深入探讨 G-计算的核心**原理与机制**，解释它如何通过序贯模拟反事实的未来来克服时变混杂的挑战。随后，我们将探索其广泛的**应用与跨学科联系**，展示这个“因果关系飞行模拟器”如何在从公共卫生到[个性化医疗](@entry_id:152668)等领域提供严谨的答案。

## 原理与机制

要真正理解任何科学工具，我们必须首先领会它旨在解决的问题。通常，最深刻的工具源于最简单的问题。在因果推断中，这个问题便是：“如果……会发生什么？”如果病人服用了不同的药物会怎样？如果政府实施了不同的政策会怎样？这些都是关于**反事实**的问题——那些我们永远无法直接观察到的另类现实。我们的挑战是利用我们*确实*看到的世界的数据，对我们未曾见过的世界做出有原则的推测。

### [对照实验](@entry_id:144738)的简单构想

假设我们想知道一种新的他汀类药物（$A=1$）与不服药（$A=0$）对患者胆[固醇](@entry_id:173187)水平（$Y$）的影响。最直接的方法是比较服药组和未服药组。但你立刻会遇到一个问题：这两个组真的具有可比性吗？也许医生更倾向于给胆[固醇](@entry_id:173187)水平本就高得危险的患者开这种新药。如果我们仅仅比较研究结束时两组的平均胆[固醇](@entry_id:173187)，我们可能会错误地得出结论，认为该药物无效甚至有害，而这仅仅是因为它被给予了病情更重的人群。

这就是经典的**混杂**问题。那个混淆我们比较的变量——在本例中是患者的初始健康状况，我们称之为$X$——是一个混杂因素，因为它既与治疗（$A$）相关，也与结局（$Y$）相关。

处理这个问题的传统方法是**标准化**，一个非常简单的想法。我们不在整个群体之间进行比较，而是在更小、更相似的亚组内进行比较。让我们比较那些*具有相同初始健康状况$X$*的已治疗和未治疗患者。在这个特定的人群切片中，比较要公平得多。我们对每一种可能的健康状况都这样做，然后将结果合并起来。

但是我们如何合并它们呢？我们想知道对*整个人群*的影响。所以，我们对组内结果进行平均，并根据每个组在总人口中的比例对其进行加权。我们实际上是在问：“如果人群中的每个人都接受了治疗，但他们各自的特征$X$保持不变，那么平均结局会是怎样？”

这个直观的过程被一个极其简洁的数学公式所概括，即**G-公式**（或 G-计算公式）。为了找到如果每个人都接受治疗（$A=a$）时的平均结局（我们表示为$E[Y(a)]$），我们计算：

$$
E[Y(a)] = \sum_{x} E[Y \mid A=a, X=x] \Pr(X=x)
$$

$E[Y \mid A=a, X=x]$这一项是我们在现实世界中观察到的、具有特征$x$并接受了治疗$a$的人的平均结局。$\Pr(X=x)$这一项仅仅是我们的总体中具有特征$x$的人的比例。该公式告诉我们，为每个分层计算治疗下的结局，然后根据这些分层在我们原始人群中的分布对这些结局进行平均。

在实践中，我们使用一个[统计模型](@entry_id:755400)，比如回归模型，从数据中估计$E[Y \mid A, X]$。然后，对于我们研究中的每一个人，我们使用这个模型来预测他们在期望的干预下（比如，$A=1$）的结局，代入他们实际的协变量值$X$，然后对所有这些预测值求平均。这个过程，被称为**[参数化](@entry_id:265163)G-计算**，为我们提供了一个对反事实世界中每个人都接受治疗时的人群平均结局的估计 [@problem_id:4576114]。这就像为我们的人群建立一个统计克隆体，然后进行一次完美的模拟实验。

### 当时间使故事复杂化：反馈问题

这种标准化方法对于简单的、单时间点的决策非常有效。但生活，尤其是医学，很少如此简单。决策是随时间做出的，而世界会对这些决策做出反应，从而形成一个错综复杂的因果网络。

考虑一位医生在几个月内管理一位慢性病患者的情形 [@problem_id:5191559]。
1. 在第一次就诊时（时间 0），医生观察患者的症状（$L_0$）并开出一种治疗方案（$A_0$）。
2. 在第二次就诊时（时间 1），第一次治疗已经产生效果，改变了患者的症状（$L_1$）。路径是 $A_0 \to L_1$。
3. 医生现在观察新的症状（$L_1$）并决定下一步的治疗方案（$A_1$）。路径是 $L_1 \to A_1$。
4. 不断演变的症状（$L_1$）和新的治疗方案（$A_1$）都将影响最终的健康结局（$Y$）。

在这里，变量$L_1$（时间 1 的症状）扮演了一个棘手的双重角色。对于下一次治疗决策$A_1$来说，它是一个**混杂因素**，因为它既影响治疗也影响最终结局。但它同时也是第一次治疗$A_0$的**中介变量**，因为它位于因果路径$A_0 \to L_1 \to Y$上。

这就是**受既往治疗影响的时变混杂**这一巨大挑战。为什么这会破坏我们简单的调整方法呢？如果我们使用一个标准的[回归模型](@entry_id:163386)并“调整”$L_1$来估计治疗史$(A_0, A_1)$的效果，我们实际上是在保持$L_1$不变。但$A_0$效果的一个关键部分*恰恰是它改变$L_1$的能力！* 通过以$L_1$为条件，我们无意中阻断了这条因果路径，从而无法再估计治疗策略的总效应 [@problem_id:4557707]。这就像试图找出投入池塘的石块能使水位升高多少，却只观察那些涟漪被完全固定的情况。你完全错过了重点。

### G-公式：模拟一个反事实的未来

这正是G-公式的精妙之处大放异彩的地方。它不与时间之箭抗争，而是顺应它。G-计算通过一步步地建立一个反事实世界的模拟来解决时变混杂问题。它不问在保持中间变量固定的情况下效应是什么；它问的是在干预下中间变量将如何演变，以及随之会产生什么后果。

让我们逐步了解这个模拟过程，也就是 G-计算中的“计算”部分 [@problem_id:5054683] [@problem_id:5174993]：

1.  **从现实开始。** 取你的真实研究人群，及其所有的基线特征（$L_0$）。
2.  **第一次干预。** 我们想知道在特定策略下会发生什么，比如，“在时间 0 进行治疗”（$A_0=1$）。所以，对于我们模拟中的每一个人，我们设定$A_0=1$。
3.  **模拟世界的反应。** 我们需要一个世界如何运作的模型。根据我们的观察数据，我们为时变混杂因素拟合一个模型：时间 1 的症状（$L_1$）如何依赖于基线症状（$L_0$）和第一次治疗（$A_0$）？利用这个模型，我们根据每个人的$L_0$以及我们设定$A_0=1$的事实，为我们人群中的每一个人模拟出一个$L_1$的值。
4.  **第二次干预。** 我们继续遵循我们选择的策略，例如，“在时间 1 也进行治疗”（$A_1=1$）。我们为每个人都这样设定。
5.  **模拟最终结局。** 现在我们为每个人都有了一个完整的、模拟的历史：$(L_0, A_0=1, L_1^{\text{simulated}}, A_1=1)$。根据我们的真实数据，我们为给定完整历史的结局$Y$拟合一个最终模型。我们使用这个模型来为我们每个模拟个体预测最终结局。
6.  **对结果求平均。** 所有这些预测结局的平均值就是我们对$E[Y(a_0=1, a_1=1)]$的估计。它是在一个每个人都遵循这个特定的两步治疗计划的世界里的预期结局。

这个序贯过程——干预、模拟混杂因素、干预、模拟结局——是G-计算的核心。它是G-公式的计算体现，而G-公式本身可以通过[迭代期望定律](@entry_id:188849)从第一性原理严格推导出来 [@problem_id:4987061]。通过模拟混杂因素作为我们干预的*结果*而发生的演变，我们正确地解释了标准调整方法所阻断的因果路径。

### 附加条款：模拟游戏的规则

这种强大的模拟技术并非魔法；它在严格的规则下运作。其有效性依赖于三个核心假设。

首先，**序贯[可交换性](@entry_id:263314)**，或称无未测量混杂。在时间的每一步，我们必须已经测量并调整了所有影响下一次治疗决策（$A_t$）和结局（$Y$）的因素（$L_t$）。这是一个强有力的、无法检验的假设，依赖于深厚的领域专业知识。

其次，**模型设定**。我们的模拟的好坏取决于我们用来构建它的模型 [@problem_id:4515389]。我们需要正确的模型来描述协变量如何随时间演变，*以及*最终结局如何依赖于历史。如果这些模型中有任何一个是错误的，我们的模拟将成为幻想，我们的估计也将是有偏的。与一些其他先进方法，如目标最大似然估计（TMLE）不同，标准的G-计算**不是双重稳健的**；如果它的某个模型是错误的，它没有第二次机会 [@problem_id:4848904]。

第三，也许是最直观的，是**正性**。这条规则说，你不能无中生有。要了解一种治疗对某类人的效果，你必须在你的真实数据中看到*一些*这类人确实接受了该治疗。假设临床指南禁止为6个月以下的婴儿接种疫苗。在我们的数据中，这个群体接种疫苗的概率为零。这是一个结构性的**对正性的违反**。我们无法问：“疫苗接种对婴儿的效果是什么？”因为我们没有数据来回答这个问题。

我们的G-计算算法可能仍然会产生一个数字；它会使用基于年龄较大的儿童和成人的模型，并**外推**到婴儿身上。但这纯粹是基于我们模型假定的数学形式的、无法检验的推测 [@problem_id:4576108]。模型不懂生物学；它只知道线条和曲线。当正性失效时，我们的数据与因果问题之间的联系就断了。在这种情况下，一个合理的科学方法是承认这一局限性，并将问题改为我们*能够*回答的问题，例如，“疫苗接种对*那些可以选择接种的人群*的效果是什么？” [@problem_id:4830493]。

总而言之，G-计算为因果推断中最困难的问题之一提供了一个深刻而优雅的解决方案。它让我们得以窥视反事实世界，因为它尊重时间的流逝以及因果之间动态的相互作用。它证明了这样一个理念：通过仔细地为现实世界建模，我们可以开始理解它可能成为的样子。

