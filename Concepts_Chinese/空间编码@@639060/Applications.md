## 应用与跨学科联系

对于一台机器来说，空间是什么？对于一个简单的多层感知机，甚至是一个强大的 Transformer 来说，世界是一堆没有内在顺序或位置感的数字。如果你将一组数据点输入这样的网络，它会将它们视为一个*集合*，而不是一个序列或空间[排列](@entry_id:136432)。在没有引导机制的情况下，打乱输入向量会产生同样混乱的输出。这是一个特性，而非缺陷——它被称为[置换不变性](@entry_id:753356)——但当事物的[排列](@entry_id:136432)*至关重要*时，这就成了一个问题。而在我们的世界里，事物的[排列](@entry_id:136432)几乎总是重要的。句子中单词的顺序、图像中像素的位置、机器人行动的时间、分子中原子的位置——所有这些都是根本性的。

空间编码是我们向机器低语几何与秩序秘密的方式。它是一种为每一份数据打上其位置独特印记的技术。正如我们在前一章所见，最常见的方法是使用一组周期函数，即一组合成不同频率[振动](@entry_id:267781)的正弦和余弦函数。但这个简单的想法绽放成一个丰富而深刻的概念，将现代[深度学习](@entry_id:142022)与[经典物理学](@entry_id:150394)、机器人学，甚至生命密码本身联系起来。让我们踏上这段旅程，穿越这些联系，看看这一个想法如何统一了如此多看似不相干的领域。

### 新视角下的观察：从像素到[辐射场](@entry_id:164265)

几十年来，我们对视觉世界的数字表示一直由像素网格主导。但是，如果我们能够不把场景表示为离散的彩色方块集合，而是表示为一个[连续函数](@entry_id:137361)呢？想象一个函数，对于空间中的任何坐标 $(x, y, z)$，它都能准确地告诉你那个无穷小点上存在什么颜色和密度。这就是[神经辐射场](@entry_id:637264)（NeRFs）背后的革命性思想。

NeRF 学习从一个空间坐标到颜色和密度的映射。但是，一个简单的[神经网](@entry_id:276355)络如何仅从一个三维坐标就能学习到真实世界场景中令人惊叹的复杂细节——水滴上的光泽，木纹的精细纹理？答案是它不能，至少不能直接做到。原始坐标本身过于简单。神奇之处在于，我们首先将坐标通过一个空间编码。这种编码将简单的三维向量提升到一个高维特征空间，在这个空间里，物理空间中相近的点仍然是邻居，但网络拥有了更丰富的特征织锦来开展工作。

这不仅仅是一个聪明的技巧；这是一个根植于信号处理的深刻原理 [@problem_id:3136721]。要表示高频细节（如锐利边缘或精细纹理），你的表示必须包含高频分量。位置编码的长度 $L$ 决定了你[正弦波](@entry_id:274998)库中的最高频率，它设定了网络的*表征能力*。如果你的编码只包含低频波，无论你给它看多少数据，网络从根本上都无法表示精细细节。这与奈奎斯特-香农采样定理形成了美妙的平行。正如你必须以足够高的速率采样物理信号以捕捉其细节一样，你必须用足够高的频率来“编码”空间以表示一个复杂的场景。

### 事物的顺序：语言与行动中的序列

让我们从连续的三维空间世界转向离散的序列世界。这句话中的词语有严格的顺序。一个机器人的计划是一系列行动。作为彻底改变了自然语言处理的 Transformer 架构核心的[注意力机制](@entry_id:636429)，从根本上说是一种集合操作——它没有内在的序列顺序概念。空间编码，在这种情况下通常被称为位置编码，正是赋予 Transformer 时间感和序列感的东西。

但是模型需要哪种时间感呢？考虑训练一个 Transformer 来理解语言。当它遇到一个比训练中见过的任何句子都长的句子时会发生什么？位置编码必须进行外推。如果编码的几何结构不佳，一个远超出训练范围的位置的编码可能会“[混叠](@entry_id:146322)”，看起来与训练范围内的某个位置的编码惊人地相似。这可能导致模型的预测发生灾难性的退化 [@problem_id:3164202]。理解这些编码的几何特性对于构建能够处理现实世界无穷多样性的模型至关重要。

在机器人学和[强化学习](@entry_id:141144)中，编码的选择变得更为关键 [@problem_id:3164189]。想象一下教一个机器人执行一项任务，比如开门。机器人的内在时间感应该是绝对的（“在下午 3:15:02，我转动把手”）还是相对的（“我的手接触到门把手后 0.5 秒，我转动它”）？显然，对于一个可泛化的技能来说，相对时间才是关键。标准的正弦编码提供了一种*绝对*的位置感。如果我们用所有从时间 $t=0$ 开始的轨迹来训练一个机器人，当被要求从 $t=100$ 开始执行同样的任务时，它的策略可能会失败。然而，通过改变架构以使用*相对*位置编码——即根据两个事件之间的时间差向注意力分数添加一个偏置——我们可以在模型中构建对全局[时间平移](@entry_id:261541)的完美不变性。模型学习到的策略是基于“之前发生了什么”和“接下来会发生什么”，而不管时钟上的[绝对时间](@entry_id:265046)。

### 超越线性的结构：网格、图与几何

世界并不总是一条简单的一维线。更复杂的结构呢？一个机器人有多个关节随时间运动，这是一个（时间，关节）的二维网格。一个分子是原子的复杂三维图。一个社交网络根本没有明显的几何布局。空间编码的原理优美地扩展到了这些领域。

对于多关节机器人，我们可以创建一个二维空间编码，或许可以通过连接时间和关节维度的单独编码来实现。就像一维序列一样，我们发现相对编码方案对于学习局部协调模式非常强大。相对偏置允许[注意力机制](@entry_id:636429)轻松学习诸如“肘关节的运动应以肩关节前一刻的动作为条件”之类的规则，这个规则与是哪个特定关节或[绝对时间](@entry_id:265046)无关 [@problem_id:3164190]。

对于像用于物理模拟的网格或社交网络这样真正非结构化的数据，我们可以使用[图神经网络](@entry_id:136853)。在一个任意的图中，一个节点的“位置编码”是什么？答案不在于简单的正弦和余弦函数，而在于图本身更深层的结构：[图拉普拉斯算子](@entry_id:275190)的[特征向量](@entry_id:151813) [@problem_id:3401699]。图拉普拉斯算子是一个捕捉节点如何连接的矩阵，它的[特征向量](@entry_id:151813)代表了图的基本“[振动](@entry_id:267781)模式”或“[谐波](@entry_id:181533)”。具有[最小特征值](@entry_id:177333)的[特征向量](@entry_id:151813)是在图上可以绘制出的“最平滑”的函数，类似于低频波。使用这些[特征向量](@entry_id:151813)作为位置特征，为网络提供了对图的全局和局部几何的丰富、自然的感觉，这个概念被称为谱位置编码。

### 物理与对称性：作为世界观的编码

到目前为止，我们主要使用通用的、全能的正弦函数作为我们的编码。但最深刻的应用来自于我们根据所要解决问题的物理特性和对称性来定制编码。

想象一下，我们想构建一个[神经网](@entry_id:276355)络来预测热量如何随时间在金属棒中传播。我们可以使用一个通用的编码来表示时空坐标。但我们可以做得更好得多。支配这一过程的物理学是热方程，一个[偏微分方程](@entry_id:141332)（PDE）。我们可以不使用通用编码，而是从物理学本身*推导*出一个编码 [@problem_id:2502931]。描述这个系统的自然[基函数](@entry_id:170178)是 PDE 空间算子的特征函数——对于一根简单的棒来说，这恰好就是余弦函数，也就是我们最初使用的那个函数族！任何时刻的解都可以表示为这些[基函数](@entry_id:170178)的和，每个[基函数](@entry_id:170178)都以其对应[特征值](@entry_id:154894)决定的速率呈指数衰减。因此，一个“物理信息”编码将包含初始热[分布](@entry_id:182848)在这些[特征函数](@entry_id:186820)上的投影。通过向网络提供已经遵循底层物理规律的特征，我们使其工作变得异常轻松。这个强大的思想是像[傅里叶神经算子](@entry_id:189138)这样前沿模型的基础，这些模型学会了求解整个 PDE 族。

这种“对称性感知的”编码原则超越了物理学。在生物学中，DNA分子的结构具有一种基本的对称性：它是反向互补的。一个基因可以从两条链中的任何一条读取。标准的位置编码对此是盲目的；它会给一个结合位点及其反向互补拷贝分配不同的位置签名，迫使模型从头开始学习这个基本的生物学事实。通过设计一种明确尊重这种对称性的编码——例如，通过使用像余弦这样的[偶函数](@entry_id:163605)来表示相对于序列中心的位置——我们将这种知识构建到模型的架构中，提高了其效率和准确性 [@problem_id:2479929]。

让我们在一个复杂的、真实的科学挑战中将这些想法汇集起来：[地震成像](@entry_id:273056) [@problem_id:3583433]。[地球科学](@entry_id:749876)家希望通过向地下发送声波并监听回声来创建地球次表层的图像。用于此任务的[深度学习模型](@entry_id:635298)需要知道实验的几何结构——声源和接收器的位置。这个几何结构是一个坐标*集合*，而不是一个有序列表。仅仅输入一个坐标列表的简单方法会失败，因为网络的输出会依赖于[地球物理学](@entry_id:147342)家列出接收器的任意顺序。原则性的解决方案结合了我们所有的见解。我们对连续坐标使用正弦编码。我们使用[置换](@entry_id:136432)不变的操作（如求和或注意力机制）来处理接收器编码的集合，以产生一个描述几何结构的单一上下文向量。最后，这个上下文向量被用来在成像网络的*每个尺度*上调制特征，例如通过 FiLM（特征级线性调制）层。这确保了模型对实际几何结构敏感，但对任意的记法选择完全不敏感。

### 空间的乐章

我们的旅程始于一个为一列数字赋予顺序感的简单技巧。它以一个深刻而统一的原则告终。空间编码不仅仅是添加正弦和余弦；它是关于选择正确的基底来表示世界。最强大的[基函数](@entry_id:170178)通常是系统本身的自然[谐波](@entry_id:181533)或特征函数——图的[振动](@entry_id:267781)模式、物理定律的[特征函数](@entry_id:186820)，或尊重生物[分子对称性](@entry_id:202199)的函数。

通过正确地编码空间，我们不仅仅是给模型更多的信息。我们在其内部嵌入了一种世界观，一种使其“思考”与现实结构对齐的基本偏见。我们正在教它数据所在空间的乐章。通过这样做，我们使其理解我们世界的任务不仅成为可能，而且变得优雅。