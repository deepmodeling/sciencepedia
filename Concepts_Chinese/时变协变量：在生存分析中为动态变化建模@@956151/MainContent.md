## 引言
在许多科学领域，我们试图根据当前的测量数据来预测未来的事件。一种常见的方法是使用静态的信息快照——例如患者的基线体重或一个国家的初始 GDP——来预测结果。然而，世界并非静止不变；它是一个动态过程，关键因素会随时间而变化。患者的血压会波动，治疗方案会被调整。忽略这些信息的流动意味着我们的模型是不完整的，就像试图通过一张静态照片来理解一部电影一样。构建更准确、更现实的模型的关键在于拥抱这种复杂性。

本文旨在解决将随时间展开的信息纳入[统计模型](@entry_id:755400)这一根本性挑战。我们引入了**时变协变量**（time-varying covariates）的概念——即在研究期间其值会发生变化的预测变量——并探讨了能让我们正确使用这些变量的稳健框架。我们将深入探讨其中的统计学原理，这些原理可以防止我们不合逻辑地使用未来信息来预测过去事件，从而确保我们的模型既强大又有效。

首先，在“**原理与机制**”部分，我们将深入探讨问题的数学核心，探索[风险函数](@entry_id:166593)以及处理动态数据的优雅的 Cox [比例风险模型](@entry_id:171806)。我们将剖析该模型的工作原理、不同类型协变量之间的关键区别，以及其假设中的细微之处。随后，“**应用与跨学科联系**”一章将展示这些概念在现实世界中的应用，从改善医学和流行病学领域的临床预测，到为因果推断和机器学习中的先进方法奠定基石。

## 原理与机制

### 瞬息万变的世界与时间流

在我们探索世界的征途中，从行星的轨道到疾病的进展，我们通常从拍摄快照开始。我们在某个时间点测量患者的血压、体重和胆[固醇](@entry_id:173187)，希望这些测量值能告诉我们一些关于他们未来健康的信息。这是一种强大且通常有用的方法，但这就像试图通过观看单个画面来理解一部故事片一样。故事——即动态变化的过程——丢失了。

生命，尤其是在生物学和医学领域，更像一部电影，而不是一张照片。患者的病情会演变，治疗会开始和停止，环境暴露水平也会波动。要建立一个真正具有预测性的健康模型，我们必须拥抱这种变化。我们需要一种方法，将信息随着时间的推移而展开的过程纳入其中。

在统计学语言中，我们用于预测的这些测量值被称为**协变量**。在研究开始时固定不变的协变量——比如一个人的基因编码或其出生国家——被称为**静态**或**时不变**协变量。但那些真正让我们的模型栩栩如生的变量是那些会变化的变量。我们称之为**时变协变量**或**动态预测变量**。

想象一下，医生们试图预测一个患有罕见[免疫缺陷](@entry_id:204322)症的儿童的住院风险[@problem_id:5117453]。一个静态协变量可能是该儿童自出生起就固定的特定[基因突变](@entry_id:166469)。但其他因素却在不断变化：他们对预防性药物的依从性可能每个月都不同，他们接受的[类固醇](@entry_id:146569)剂量可能每周调整一次，血液中的炎症标志物可能在每次就诊时都会测量。这些都是时变协变量。一个忽略了它们动态性质的模型，就是一个部分失明的模型。

### 在模型中捕捉时间：[风险函数](@entry_id:166593)

那么，我们如何建立一个尊重时间之箭的数学框架呢？有一条基本法则：我们不能使用未来的信息来预测过去或现在。这似乎显而易见，但却是一个非常容易掉入的陷阱。例如，使用患者一年内的平均用药剂量来预测发生在第三个月的住院事件，就是一种统计学上的“作弊”[@problem_id:5117453]。它使用了第 4 到第 12 个月的剂量信息，而这些信息在事件发生时是不可获取的。这样的模型在纸面上可能看起来异常准确，但在现实世界中将毫无用处。

我们故事中的主角，那个能让我们以极其优雅的方式驾驭时间流的数学工具，就是**风险函数**，记为 $h(t)$。直观上，你可以将风险理解为，在事件尚未发生的情况下，在精确的 $t$ 时刻发生该事件的*瞬时风险*。它是每个时间点的“危险等级”。

著名的 **Cox [比例风险模型](@entry_id:171806)**，经过调整以适应一个动态的世界，为我们提供了一种优美的方式来将这个危险等级与我们的协变量联系起来：

$$
h(t \mid \mathbf{X}(t)) = h_0(t) \exp\{\boldsymbol{\beta}^\top \mathbf{X}(t)\}
$$

让我们来剖析这个优雅的方程。它主要包含两个部分：

-   $h_0(t)$: 这是**基线风险**。可以把它想象成潜在的风险节律，是对于一个所有协变量都等于零的假设的“平均”个体而言，事件随时间变化的自然脉动。它可能开始时较低，然后上升，再然后下降，捕捉了疾病的自然病程。Cox 模型的精妙之处在于，我们甚至不需要知道这个函数具体是什么样的。

-   $\exp\{\boldsymbol{\beta}^\top \mathbf{X}(t)\}$: 这是**风险乘数**。它告诉我们一个个体的独特特征集 $\mathbf{X}(t)$ 如何使其风险相对于那一刻的基线风险进行放大或缩小。向量 $\boldsymbol{\beta}$ 包含了每个协变量的“效应大小”，而指数函数确保了该乘数始终为正。

其中的奥妙在于 $\mathbf{X}$ 旁边的小 $(t)$。这表示我们承认世界是动态的。协变量向量 $\mathbf{X}$ 不是一组固定的数字，而是时间的函数。在任何时刻 $t$，我们代入患者测量指标的*当前*值，以计算其*当前*的风险乘数。

### 变化世界中的比例性逻辑

此时，你可能正在挠头。如果协变量随时间变化，基线风险也随时间变化，这怎么能被称为“[比例风险](@entry_id:166780)”模型呢？究竟是什么成比例？

这是一个微妙而美妙的要点 [@problem_id:4961530]。“比例性”指的是两个不同个体在*同一瞬间*的风险如何比较。让我们比较两个人，Alice 和 Bob。在任何时间 $t$，他们的风险比率为：

$$
\frac{h_{\text{Alice}}(t)}{h_{\text{Bob}}(t)} = \frac{h_0(t) \exp\{\boldsymbol{\beta}^\top \mathbf{X}_{\text{Alice}}(t)\}}{h_0(t) \exp\{\boldsymbol{\beta}^\top \mathbf{X}_{\text{Bob}}(t)\}} = \exp\{\boldsymbol{\beta}^\top (\mathbf{X}_{\text{Alice}}(t) - \mathbf{X}_{\text{Bob}}(t))\}
$$

请注意，基线风险 $h_0(t)$ 完全抵消了！他们在时间 $t$ 的风险比率*只*取决于他们在*同一时间 t* 的协变量差异。这就是比例性。他们的风险始终与同一个潜在的基线函数成比例。

然而，由于他们的协变量 $\mathbf{X}_{\text{Alice}}(t)$ 和 $\mathbf{X}_{\text{Bob}}(t)$ 会随时间变化，风险比本身不一定是恒定的。如果 Alice 在第 6 个月开始服用一种新药，她与 Bob 的风险比将在那一刻发生变化。比例性在每个瞬间都成立，但整体的比较会随着协变量的演变而演变。

### 作用机制：数学原理究竟如何运作？

那么，模型是如何从不断变化的数据中“学习”到 $\boldsymbol{\beta}$ 的值的呢？这个被称为**[偏似然](@entry_id:165240)**的机制，可谓是神来之笔。

Cox 模型并不试图对整个复杂的时间线进行建模，而是只关注事件实际发生的那些时刻。在每个事件时间点，比如一个患者在时间 $t_j$ 发生心脏病，模型会对当时的整个世界拍一张快照。它会识别出所有在 $t_j$ 前一刻仍然“有风险”发生心脏病的人——这个群体被称为**风险集** [@problem_id:4376886] [@problem_id:4961527]。

然后模型会问一个简单的问题：“假定这个风险集中的某一个人发生了心脏病，那么事件发生在特定这个人身上的概率是多少？”这个概率就是这个人的风险除以风险集中所有人的风险之和。正如我们之前看到的，未知的基线风险 $h_0(t_j)$ 出现在每一项中并被抵消，留下的表达式只依赖于风险集中人们的协变量和未知的参数 $\boldsymbol{\beta}$。通过将研究中所有事件时间的这些概率相乘，我们构建了[偏似然](@entry_id:165240)。然后我们找到使这个总似然尽可能大的 $\boldsymbol{\beta}$ 值——即那些能够最好地解释为什么特定的人在特定的时间发生了事件的值。

为了让这个过程行之有效，我们需要以一种特定的方式组织数据，通常称为**“开始-停止”**或**“[计数过程](@entry_id:260664)”**格式 [@problem_id:4776321]。个体的随访期被分解为一系列区间。每当时变协变量的值发生变化时，一个新的区间就开始。对于每个区间，我们的数据集中都有一行记录：“受试者 1，从开始时间 $t_1$ 到停止时间 $t_2$，具有这些协变量值，并且在 $t_2$ 时发生（或未发生）事件。”这种精心组织的数据使模型能够始终知道在任何事件时间点风险集中每个人的正确协变量值。然后，一个人的总累积风险就是其整个历程中瞬时风险的总和（或积分），这条路径反映了他们独特的协变量历史 [@problem_id:4991495]。

### 两类协变量的故事：内部 vs. 外部

随着我们深入研究，我们发现并非所有时变协变量都是生而平等的。两类协变量之间存在着关键的区别：外部协变量和内部协变量 [@problem_id:4906495] [@problem_id:4843600]。

**外部协变量**是在个体之外产生的过程，其路径不受个人健康状况或事件风险的影响。一个经典的例子是城市每日的空气污染水平 [@problem_id:4906495] 或区域热指数 [@problem_id:4843600]。某个特定的人今天是否会心脏病发作，与明天城市的气温无关。生理年龄是最简单的确定性外部协变量。

另一方面，**内部协变量**产生于个体*内部*，或是对其健康的[直接反应](@entry_id:161030)。这些是像血清钠水平或心脏酶这样的生物标志物，它们本身就是我们正在研究的疾病过程的一部分。关键是，这一类别还包括治疗，例如医生为应对患者症状而调整的[利尿剂](@entry_id:155404)剂量 [@problem_id:4843600]。内部协变量的路径是一个反馈循环的一部分：患者健康状况的恶化可能导致某个生物标志物升高，而同样的恶化也增加了他们发生事件的风险。

这种区别不仅仅是学术上的；它对我们如何解释结果具有深远的影响，特别是当我们试图理解因果关系时 [@problem_id:4968220]。与外部协变量（如空气污染）相关的风险比，或许可以（在某些强假设下）被解释为因果效应。但对内部协变量的解释则要复杂得多。假设我们发现服用高剂量某种药物的患者死亡风险更高。这是否意味着该药物有害？还是仅仅意味着只有病情最严重的患者——那些本身死亡风险就很高的人——才会被开具高剂量药物？这种现象被称为**依时指示混杂**，是在利用观察性数据对治疗进行因果推断时面临的最大挑战之一。内部和外部协变量之间的区别迫使我们在阐述模型真正能告诉我们什么时，必须保持谦逊和精确。

### 超越基础：时变效应

时变协变量的框架功能极其强大，但我们可以更进一步。到目前为止，我们允许协变量的*值*随时间变化，模型形式如 $h(t) = h_0(t)\exp\{\beta X(t)\}$。但如果协变量的*效应*或*效力*随时间变化呢？

这就需要一种不同类型的模型，一种具有**时变系数**的模型，通常写作 $h(t) = h_0(t)\exp\{\beta(t) X\}$ [@problem_id:4961540]。在这里，协变量 $X$ 可能是固定的（例如，[遗传标记](@entry_id:202466)或基线治疗分配），但其相关系数 $\beta(t)$ 现在是时间的函数。这使我们能够对这样一种情况进行建模：例如，一种治疗在早期有很强的保护效应，但其益处会随着时间的推移而减弱。

这两种模型解决了不同的生物学和临床现实。时变协变量模型 $X(t)$ 探讨的是随着患者状态的变化，风险如何变化。时[变系数模型](@entry_id:635059) $\beta(t)$ 探讨的是在疾病过程中，某一特定特征的重要性如何变化。通过理解和区分这些复杂的工具，我们可以创建更忠实地反映世界复杂、动态本质的模型。

