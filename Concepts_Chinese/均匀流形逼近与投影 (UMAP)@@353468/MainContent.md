## 引言
现代生物学产生了极其复杂的数据，例如在数千个单细胞中测量 20,000 个基因的活性。这将科学家置于一个令人困惑的高维空间中，远远超出了人类的直觉，因此迫切需要能够为这一细胞图景创建易于理解的地图的工具。均匀流形逼近与投影 (UMAP) [算法](@article_id:331821)作为一种革命性的解决方案应运而生。本文旨在揭开 UMAP 的神秘面纱，为新手和经验丰富的用户提供一份指南。首先，我们将探讨 UMAP 得以忠实绘制细胞邻域的核心原理和数学思想，包括数据准备和图谱解读的关键步骤。随后，我们将遍览其多样化的应用，揭示 UMAP 如何将抽象的数据点转化为深刻的生物学见解。

## 原理与机制

想象一下，你是一位探险家。但你探索的不是丛林或海洋，而是一个更奇特、更复杂的领域：活细胞的内部世界。借助单细胞 RNA 测序等现代技术，我们可以深入组织——比如一个肿瘤——然后带着海量的数据宝藏归来。对于成千上万个单细胞中的每一个，我们都得到了一份包含约 20,000 个基因活性水平的列表 [@problem_id:2268294]。这不仅仅是一个列表，更是一个坐标。每个细胞都是 20,000 维“基因表达空间”中的一个点。

稍作思考。我们生活和思考的空间是三维的。一个 20,000 维的空间完全超出了我们的直觉。我们如何能指望在这样的空间中发现模式？这边是“[T细胞](@article_id:360929)”的城市吗？那边有“干细胞”的河流流向“[巨噬细胞](@article_id:360568)”的山谷吗？在这个令人困惑的超高维空间里，我们完全迷失了方向。我们需要一张地图。而这，正是一种名为**[均匀流](@article_id:336471)形逼近与投影 (Uniform Manifold Approximation and Projection)**，或称 **UMAP** 的[算法](@article_id:331821)所作出的根本承诺。

### UMAP 的理念：忠实绘制邻域地图

什么样的地图才算好地图？如果你想把球形的地球展平在一张纸上，你很快就会意识到无法保留所有信息。墨卡托投影保留了角度（利于导航），但严重扭曲了靠近两极的国家的面积。其他投影保留了面积，但扭曲了形状。你必须选择对你来说最重要的东西。

UMAP 做出了一个非常明确的选择。它的主要目标不是保留原始 20,000 维空间中的精确距离或方向，而是保留**邻域**。它最核心地回答了一个问题：谁与谁相邻？其根本的科学目标是，将高维空间中那团令人费解的点云，转换成一张简单的二维散点图，其中具有相似整体基因表达谱的细胞被放置在一起，而表达谱不同的细胞则被分离开来。这使我们能够在地图上将不同的细胞群体可视化为“岛屿”或“[聚类](@article_id:330431)”[@problem_id:2268294]。

所以，当你看到一张 UMAP 图谱时，请记住，图上的每一个点都代表一个独立的单细胞及其独特的高维基因表达谱 [@problem_id:2350897]。整张图谱是这些单个细胞精心[排列](@article_id:296886)而成的星图，旨在揭示细胞群落中隐藏的社会结构。

### 工作原理：从点云到模糊网络

UMAP 是如何实现这一壮举的呢？其方法既优雅又深深植根于一个名为**拓扑学**（研究形状和空间的数学分支）的数学领域。UMAP 并非简单地将数据“压扁”，而是首先构建一个细胞间关系的模型。

想象一下，数据集中的每个细胞都是一个巨大而拥挤的舞厅里的人。UMAP 会走到每个人（每个细胞）面前，让他们找出自己最亲密的朋友（在 20,000 维基因空间中的最近邻居）。但它不只是列一个简单的名单，而是创建“模糊”的连接。它假定你最亲密的朋友很可能是你社交圈的一部分，而稍远一点的人可能性就小一些，依此类推。这就创造了一个由加权连接构成的极其复杂的网络——一个**模糊拓扑结构**。本质上，UMAP 首先根据所有细胞在高维空间中的相似性，构建了一个错综复杂的细胞社交网络。

只有在这个网络构建完成之后，UMAP 才会尝试将其绘制在一张二维的纸上。它通过一个优化过程来完成这一步。它在二维空间中[排列](@article_id:296886)这些点，然后像一位耐心的地图绘制师一样，一点一点地调整它们的位置。目标是使二维[排列](@article_id:296886)的“社交网络”与原始高维网络尽可能相似。它将相互连接的细胞拉近，将不相连的细胞推开，直到找到一个稳定、低能量的构型。其结果就是我们所熟悉的 UMAP 图谱。

### 数据准备：清洁镜头的艺术

在 UMAP 发挥其魔力之前，我们必须确保它观察的是正确的东西。直接将 UMAP 应用于原始数据是灾难的根源，就像试图用一个沾满油污、对着太阳的镜头拍照一样。

原始基因表达数据有两个主要问题。首先，它充满了技术性伪影。最突出的是**文库大小**——即在一个细胞中检测到的 RNA 分子总数。由于纯粹的技术原因，一些细胞产生的分子比其他细胞多。如果你不对此进行校正，UMAP 只会根据文库大小对细胞进行分组，从而完全掩盖了真实的生物学信息 [@problem_id:1426096]。这就像按书的重量而不是主题来整理图书馆一样。我们必须首先对数据进行**归一化**以消除这些影响。

其次，数据充满噪声且分布偏斜。少数高表达基因的声音可能非常响亮，以至于淹没了成千上万个其他基因发出的虽然微弱但重要的信号。为了解决这个问题，我们通常会应用**对数转换**来降低高表达基因的影响，然后对数据进行**缩放**，使每个基因在分析中都有同等的机会发挥作用。只有经过这种仔细的[预处理](@article_id:301646)后，数据才能反映生物学身份，而不是技术上的怪异现象。

即使在缩放之后，我们通常还会执行一个关键步骤：运行**[主成分分析 (PCA)](@article_id:352250)**，并只保留前 30-50 个主成分作为 UMAP 的输入。这可能看起来很奇怪——为什么用一种方法降维后，还要用另一种方法再次[降维](@article_id:303417)？原因很深远。PCA 非常擅长识别数据中的主要变异轴。前几个主成分 (PCs) 倾向于捕捉大的、协同的生物学信号（例如 T 细胞和 B 细胞之间的差异），而后面的 PCs 通常由随机、不相关的噪声主导 [@problem_id:1465894]。通过仅将顶部的 PCs 提供给 UMAP，我们实际上是在执行一个强大的**[去噪](@article_id:344957)**步骤。我们交给 UMAP 的是一个更干净、更集中的数据版本，它强调生物学信息而非噪声。这还有一个很好的副作用，即让 UMAP 运行得更快，并有助于克服一个棘手的数学问题——**[维度灾难](@article_id:304350)**，即在极高维空间中距离的意义变得不那么明确 [@problem_id:1465894]。选择使用多少个 PCs 是一个微妙的平衡：太少，你会丢弃真实的生物学信息，导致不同的细胞类型合并；太多，你又会重新引入噪声，可能将内聚的群体[打散](@article_id:638958)成零碎的片段 [@problem_id:2371661]。

### 两张地图的故事：为何 UMAP 常能看到 PCA 忽略之处

这就引出了一个关键点。既然我们无论如何都要用 PCA，为什么不直接停在那里，查看 PC1 vs PC2 的图呢？PCA 是一种古老、强大且数学上简单的方法。它是一种线性技术；你可以把它想象成寻找将高维数据云投射到二维墙壁上的最佳“影子”。

但如果你正在寻找的结构不是线性的呢？如果你的细胞类型不是以简单的线条或团块[排列](@article_id:296886)，而是像一团毛线一样缠绕在一起呢？这就是 UMAP 以邻域为中心的非线性方法的闪光点。因为 PCA 只关心寻找最大*全局*方差的方向，所以它很容易忽略那些局部独特但在全局上不分散的结构。研究人员可能在执行 PCA 后只看到一团无[信息价值](@article_id:364848)的细胞。然而，当他们对完全相同的数据运行 UMAP 时，这团细胞可能会解析成一个由不同岛屿组成的惊人群岛 [@problem_id:1428905]。UMAP 通过首先构建其邻域图，可以解开 PCA 无法识别的非线性关系。

### 解读 UMAP：困惑者指南

你已经做对了一切，现在你有了一张漂亮的 UMAP 图谱。如何正确解读它而避免落入常见陷阱？这也许是最关键的技能。

**要：** 关注**相对位置**。保留局部邻域是 UMAP 最大的优势。如果聚类 A 紧邻[聚类](@article_id:330431) B，但远离聚类 C，这强烈暗示细胞类型 A 和 B 之间的关系比它们与 C 的关系更密切 [@problem_id:1465908]。有时，你可能会看到两个聚类紧挨在一起，但统计检验却显示它们之间有数百个差异表达基因。这并不矛盾！这通常是连续生物过程的标志，比如[细胞分化](@article_id:337339)。UMAP 的邻近性表明这些细胞处于一个相连的路径上，而基因差异则揭示了沿着这条路径正在发生的活跃[转录](@article_id:361745)之旅 [@problem_id:1465887]。

**不要：** 对**全局距离和密度进行定量解读**。这是最重要的警告。
- [聚类](@article_id:330431)之间的空白区域没有意义。UMAP 可以自由地扩大或缩小这个空间来优化布局。聚类 A 和 B 之间的距离**不是**它们差异程度的定量度量。
- [聚类](@article_id:330431)的大小或密度**不是**其内部[转录](@article_id:361745)多样性的可靠衡量标准。你可能会看到一个非常紧凑的聚类和一个非常分散的[聚类](@article_id:330431)。人们很容易得出结论，认为紧凑的[聚类](@article_id:330431)更同质。这是不正确的。表观密度是[嵌入](@article_id:311541)过程的产物，并不反映原始 20,000 维空间中的方差 [@problem_id:1428920]。
- `UMAP-1` 和 `UMAP-2` 这两个坐标轴是**没有意义的**。与 PCA 不同，它们不代表任何特定的生物过程或变异来源。整张图可以旋转、翻转或拉伸，而不会失去任何意义 [@problem_id:1465908]。

把 UMAP 图谱想象成一张地铁线[路图](@article_id:338292)。它告诉你哪些站点是相连的（拓扑结构），但它不告诉你它们之间的真实距离（[度量几何](@article_id:364958)）。

### 调整望远镜：`n_neighbors` 的威力

最后，我们来谈谈运行 UMAP 时可以调整的主要参数：`n_neighbors`。这个[数字控制](@article_id:339281)每个细胞在构建其局部邻域时考虑多少个“朋友”。这就像调整望远镜的焦距，让你可以在观察精细细节和宏大整体结构之间切换。

- **较低的 `n_neighbors`**（例如 5 或 15）告诉 UMAP 专注于非常**局部的结构**。这就像使用高倍放大镜。它非常适合寻找小的、罕见的细胞群体，并解析较大群体内部的精细亚结构。缺点是它可能会丢失“全局视角”，可能导致大的、连续的群体看起来碎裂成许多小块 [@problem_id:1428858]。

- **较高的 `n_neighbors`**（例如 50 或 100）告诉 UMAP 专注于**全局结构**。这就像使用低倍放大镜来观察整个景观。它非常适合理解主要细胞谱系之间的关系，并将产生大的、内聚的聚类。风险在于，通过在如此大的邻域上“平均”，你可能会完全掩盖来自稀有细胞类型的信号。一[小群](@article_id:377544)有趣的细胞可能会被其更大的邻居吞噬，导致你错误地断定它不存在 [@problem_id:1465868]。

`n_neighbors` 没有唯一的“正确”值。这个选择是一个科学决策，由你的假设决定。你是在寻找一种罕见的[癌症干细胞](@article_id:329649)，还是试图绘制免疫系统的主要分支？通过理解这些原理，UMAP 从一个黑箱变成了一个强大而直观的工具，一支为广阔、未知的生物学领域绘制地图的真正画笔。