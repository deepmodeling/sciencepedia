## 引言
分析随时间展开的事件，例如疾病发作或治疗反应，对研究人员来说是一个根本性的挑战。我们如何才能准确地模拟患者状态、暴露和特征处于持续变化中的现实？传统的静态数据集（每个受试者一行数据）常常无法捕捉这种动态性质，从而引入了可能扭曲研究结论的严重错误，例如不朽时间偏倚。

本文深入探讨了一种优雅而强大的解决方案：起止数据格式。它为理解和运用这一关键的[事件时间分析](@entry_id:268670)技术提供了全面的指南。首先，“原理与机制”部分将揭示这种格式的工作原理，解释它如何将受试者的时间线切割成可管理的区间，以精确处理时变数据。随后，“应用与跨学科联系”一章将展示该方法的多功能性，探索其在从流行病学到基因组学等领域中用于回答复杂科学问题的应用。通过掌握这种格式，研究人员可以从纵向数据中解锁更深刻的见解，并拥抱他们所研究过程的真实动态本质。

## 原理与机制

要真正理解我们如何研究随时间展开的事件——比如疾病的发作或新药的效果——我们必须首先认识到时间本身不仅仅是一个背景，而是一个活跃的参与者。一个人的特征不是静止的；它们会演变。患者可能会开始新的治疗，生物标志物的水平可能会上升或下降，人们可能会在不同的时间点进入或退出研究。单个[统计模型](@entry_id:755400)如何可能处理如此流动的、动态的现实？答案在于一种极其巧妙而优雅的数据结构：**起止格式**。

### 时间线的故事：从静态快照到流动叙事

想象一项简单的研究。我们想知道某个从出生起就固定的特定基因是否会增加心脏病发作的风险。为此，我们的数据可以非常简单。对每个人，我们记录其总随访时间、是否发生心脏病发作，以及是否携带该基因。这样我们就得到了一个每人一行的数据集。当我们想使用像 **Cox [比例风险模型](@entry_id:171806)** 这样的强大工具来分析数据时，核心思想是在每次心脏病发作的确切时刻构建一个**风险集**。风险集就是所有仍在研究中且尚未发生心脏病发作的人的集合。然后模型实质上会问：“鉴于这个群体中的*某人*在此时此刻发生了心脏病发作，根据其基因状态与其他人相比，这次发作发生在这个特定人身上的概率是多少？”对于像基因这样固定的、不变的协变量，这种每人一行的结构是完全足够的 [@problem_id:4550959]。

但生活很少如此简单。如果我们的协变量不是基因，而是患者可以在任何时间点开始的药物治疗呢？

让我们来看一个曾让许多研究人员陷入困境的经典场景。患者 A 在出院 90 天后开始服用一种新药，并遗憾地在第 120 天去世。患者 B 从未服用该药，在第 60 天去世。如果我们天真地将患者 A 从第一天起就标记为“已治疗”，我们就会陷入一个逻辑陷阱。当我们分析患者 B 在第 60 天的死亡事件时，我们的模型会看到风险集中的患者 A，并将其计为一个存活的“已治疗”者。但这是错误的！在第 60 天，患者 A *并没*在服药。他们开始治疗前的 90 天是一段他们*必须*存活下来才能成为治疗者的时间。这段时间通常被称为**不朽时间**，因为在这段时间窗口内，治疗期间死亡的事件是不可能发生的。将这段“不朽”的存活时间归因于治疗组会产生一种强烈的错觉，使得药物看起来比实际效果好得多。这就是**不朽时间偏倚**，一种可以通过正确的[数据结构](@entry_id:262134)消除的严重错误 [@problem_id:4829076]。

那么，我们该怎么做呢？我们需要一种方法来告诉我们的模型完整的故事，随着它的展开。我们需要把时间切片。

### 起止解决方案：将时间切成故事

这就是起止格式（也称为**[计数过程](@entry_id:260664)**格式）的精妙之处。我们不再用一行静态的数据来代表一个人的整个历史，而是将其时间线分解为一系列的片段。每当一个关键特征发生变化时，一个新的片段就开始了。

让我们回到我们的患者。患者 A 的历史（第 90 天开始服药，第 120 天发生事件）不再是单个数据点，而是一个分为两部分的故事：

-   **第 1 行:** `(start=0, stop=90, treated=0, event=0)`
-   **第 2 行:** `(start=90, stop=120, treated=1, event=1)`

第一行告诉我们：“从第 0 天到第 90 天，此人处于风险中，*未*接受治疗，且没有事件发生。”第二行继续：“从第 90 天到第 120 天，此人处于风险中，*接受了*治疗，并且事件在此期间结束时发生。”请注意，事件指示符 `1` 仅出现在该人的最后一个区间，即以事件告终的那个区间 [@problem_id:4550959]。

对于患者 B（从未治疗，第 60 天发生事件），故事更简单，只有一个片段：

-   **第 1 行:** `(start=0, stop=60, treated=0, event=1)`

那么患者 C 呢？他在第 10 天开始服药，但在第 40 天被删失（离开研究）。他的故事也分为两部分：

-   **第 1 行:** `(start=0, stop=10, treated=0, event=0)`
-   **第 2 行:** `(start=10, stop=40, treated=1, event=0)`

通过在协变量每次发生变化时分割一个人的随访时间，我们创建了一个数据集，其中在任何给定行内，世界再次变为静态。协变量的值在区间 $(start, stop]$ 内是恒定的 [@problem_id:4776321]。这种简单的重构功能非常强大。它允许 Cox 模型在任何事件时间点查看，并准确了解风险集中每个人的确切状态 [@problem_id:4961476]。

### 处理生活中的延迟入组和变化环境

起止格式的真正美妙之处在于它能够用同样优雅的原则处理更多生活中的复杂情况。

#### 延迟入组

那些较晚加入研究的患者怎么办？这被称为**左截断**或**延迟入组**。假设我们的研究从 1 月 1 日开始，但一位患者直到 4 月 1 日（第 90 天）才入组。对于 2 月份发生的任何事件，此人*在我们的研究中*并不处于“风险”之中。我们不能将他们包含在那些早期事件的风险集中。起止格式可以毫不费力地处理这个问题：这位患者的第一行数据仅以 `start=90` 开始 [@problem_id:4906458]。他们入组前的时间根本不存在于数据中，从而正确且自动地将他们从任何时间 $t \le 90$ 的风险集中排除 [@problem_id:4550959]。

在任何时间 $t$ 定义风险集 $R(t)$ 的惯例是，包括当前观测区间 $(start, stop]$ 满足条件 $start  t \le stop$ 的任何人 [@problem_id:4551005]。这个精确的规则确保了在时间 $t$ 发生事件的人被包含在他自己的风险集中，而在时间 $t$ 整进入研究的人则不被包含，这维持了一个称为可预测性的关键理论属性。

#### 时变分层和偏移量

这种方法非常灵活，甚至可以处理分析的基本规则随时间变化的情况。想象一下，全院范围内的协议发生变化，影响了所有当前患者的护理标准。我们可能希望通过将所有患者从“旧协议”分层移至“新协议”分层来对此进行建模。在 Cox 模型中，**分层**允许存在完全不同的基线[风险函数](@entry_id:166593)。解决方案是什么？和以往一样：在协议变更的日历时间点，我们只需为每个受影响的患者结束当前区间，并开始一个更新了新分层标识符的新区间。同样的逻辑也适用于已知的、随时间变化的风险调整，称为**偏移量**。起止格式通过在每个变化点简单地切分时间线，优雅地融合了这些变化 [@problem_id:4991888]。

### 风险集之美的再探讨

让我们回到风险集的核心思想。Cox 模型的[偏似然](@entry_id:165240)计算就像在每个事件发生的精确时刻拍摄一系列世界快照。在每个快照点，它会问两个问题：
1.  此时此刻，谁有发生事件的风险？
2.  在这一确切时刻，他们的特征（协变量值）是什么？

起止数据格式就是那个“胶片卷”，让我们能够在任何一帧（任何事件时间）完美地暂停，并对这两个问题得到清晰的答案。对于在时间 $t=6$ 发生的事件，模型会扫描数据集中的所有行。任何满足 $start  6 \le stop$ 的行都对应于风险集中的一个人。来自该特定行的协变量值就是进入计算的值。就这么简单，也这么强大 [@problem_id:4961494]。

这就是起止格式的原理和机制。它不仅仅是一种技术性的数据整理技巧，更是一种深刻的概念工具，允许一个单一、优雅的[统计模型](@entry_id:755400)来拥抱时间的动态、流动和常常混乱的本质。它将复杂的叙事转化为一系列可管理的片段，使我们能够在任何给定时刻提出关于风险的精确问题，从而揭示隐藏在生命时间线中的更深层次的真相 [@problem_id:4985834]。

