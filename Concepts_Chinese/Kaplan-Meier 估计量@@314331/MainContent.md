## 引言
从医学到工程等领域，我们经常需要回答这样一个问题：“一个事件发生需要多长时间？”这可能是患者康复、机器零件故障或客户退订所需的时间。分析这种“事件发生时间”数据带来了一个独特的挑战：我们很少能观察到研究中每个受试者的事件。一些受试者可能会中途退出，或者研究可能在事件发生前就结束了。这种不完整的信息，即所谓的删失数据，会使传统的分析方法束手无策。当我们的数据充满了“已知的未知”时，我们如何才能准确地描绘生存率或失败率？

本文深入探讨了 [Kaplan-Meier](@entry_id:169317) 估计量，这是一种专为解决此问题而设计的优雅而强大的统计方法。它提供了一种忠实地结合完整数据和[删失数据](@entry_id:173222)来估计随时间变化的生存函数的方法。我们将首先探讨该估计量的核心**原理与机制**，分解其直观的逐步逻辑、非信息性删失等基本假设及其内在局限性。随后，在**应用与跨学科联系**一章中，我们将看到该方法如何在现实世界中得到应用，从影响临床试验和公共政策，到作为复杂预测模型的基准。

## 原理与机制

想象一下，你是一位医生，正在测试一种新的救命药物。你将它给予一百名患者，并对他们进行五年的观察。不幸的是，有些人可能会去世。但其他人可能会移居到另一个国家，或者有些人在你为期五年的研究经费耗尽时仍然健在。研究结束时，你得到了一堆杂乱的数据：一份患者名单，上面记录着事件发生时间（他们去世的日期）或“最后一次观察”的时间。你如何回答这个简单而深刻的问题：“患者存活超过一年的概率是多少？”

这就是生存分析的核心问题。那些杂乱的数据点——搬家的患者或研究结束时仍然在世的患者——就是我们所说的**右删失**。我们知道他们在某个时间点*之前*一直存活，但我们不知道之后发生了什么。我们掌握的信息不完整 [@problem_id:4806041]。我们该如何处理它？

### 一个有缺陷的初步尝试

我们的第一反应可能是做一些简单的事情。也许我们可以直接忽略删失的患者，仅根据我们观察到事件的那些患者来计算生存率？这似乎不公平；我们会丢弃掉那些我们知道存活了一段时间的患者的宝贵信息。

或者，我们能否只计算总共有多少人（发生事件的或删失的）的观测时间超过一年？假设在一个包含六人的小型研究中，观测结果如下：2年时发生事件，3年时删失，4年时发生事件，5年时发生事件，6年时删失，7年时发生事件。为了计算存活超过5年的概率，这种天真的方法只会计算时间为6年和7年的两个人，得出的生存率为 $2/6 = 1/3$。但这也感觉不对。在3年时被删失的人存活了3年；将他们的数据点与在2年时发生事件的人同等对待，似乎忽略了一些关键信息。事实上，这种简单的方法是有偏的；它系统性地低估了生存率，因为它未能正确地考虑我们*已知*删失个体所经历的存活期 [@problem_id:4576787]。我们需要一种更聪明、更忠实的方法来处理[删失数据](@entry_id:173222)中的“已知的未知”。

### 生存链：Kaplan-Meier 的思想

Edward Kaplan 和 Paul Meier 的卓越见解在于重新定义了这个问题。他们没有试图一次性跳到例如五年生存率的答案，而是将[问题分解](@entry_id:272624)为一系列更小、更易于管理的步骤。这就像试图通过踩着石头过河，而不是尝试一次不可能的飞跃。

其逻辑是：存活五年的概率是存活第一年的概率，*乘以*在存活第一年的*条件下*存活第二年的概率，*乘以*在存活第二年的*条件下*存活第三年的概率，依此类推。他们意识到，你只需要在事件实际发生的确切时刻进行这些计算。

这就形成了一条[条件概率](@entry_id:151013)链。在任何时间 $t$ 的总生存概率，我们称之为**生存函数** $S(t)$，是存活过截至该时间点所发生的每个事件的概率的乘积。这就是为什么该方法也被称为**[乘积限估计量](@entry_id:171437)**。其公式如下：

$$ \hat{S}(t) = \prod_{t_j \le t} \left(1 - \frac{d_j}{n_j}\right) $$

在这里，乘积 $\prod$ 是对截至时间 $t$ 的所有不同事件时间 $t_j$ 进行的。在每个这样的时间点，$d_j$ 是发生事件（例如，死亡）的人数，$n_j$ 是在该时刻之前仍在研究中且处于事件“风险中”的总人数。项 $(1 - d_j/n_j)$ 仅仅是那些处于风险中的人在该事件时间点之后*存活*下来的比例。通过将这些条件生存概率相乘，我们构建了对 $S(t)$ 的估计 [@problem_id:4576787]。这个绝妙而简单的离散乘积，是生存与事件瞬时风险之间深层理论关系的数据驱动对应物，该瞬时风险被称为**风险率** $h(t)$，在连续时间中 $S(t) = \exp\left(-\int_0^t h(u)\,du\right)$ [@problem_id:4921600]。

### 逐步构建曲线

让我们看看这个优雅的机制如何运作。考虑一个来自肿瘤学研究的6名患者的小组 [@problem_id:4806040]。数据记录为（时间（月），状态），其中状态1表示事件，0表示删失：
$(2, 1)$，$(3, 0)$，$(5, 1)$，$(6, 0)$，$(7, 0)$，$(9, 1)$。

我们想要构建生存曲线 $\hat{S}(t)$。

1.  **从 $t=0$ 开始**：根据定义，所有人都存活，所以 $\hat{S}(0) = 1$。处于风险中的人数为 $n=6$。

2.  **第一个事件发生于 $t=2$**：
    - 在 $t=2$ 之前，所有6名患者都处于风险中，因此**风险集**为 $n_1=6$。
    - 在 $t=2$ 时，发生了一个事件，因此 $d_1=1$。
    - 存活过 $t=2$ 的条件概率是 $(1 - d_1/n_1) = (1 - 1/6) = 5/6$。
    - 我们的生存估计值下降：对于从2到下个事件发生前的所有 $t$，$\hat{S}(t) = 1 \times (5/6) = 5/6$。

3.  **在 $t=3$ 时删失**：
    - 在 $t=3$ 时，一名患者被删失。生存曲线会下降吗？不！这是关键部分。事件没有发生。唯一改变的是，这个人现在从所有未来的计算的风险集中被移除。他们贡献了3个月的生存信息，该方法现在已经“储存”了这些信息。

4.  **第二个事件发生于 $t=5$**：
    - 在 $t=5$ 之前，有多少人处于风险中？我们开始时有6人，1人在 $t=2$ 时发生事件，1人在 $t=3$ 时被删失。因此，风险集为 $n_2 = 6 - 1 - 1 = 4$。
    - 在 $t=5$ 时，发生了一个事件，因此 $d_2=1$。
    - *在存活过 $t=2$ 的条件下*，存活过 $t=5$ 的[条件概率](@entry_id:151013)是 $(1 - d_2/n_2) = (1 - 1/4) = 3/4$。
    - 我们通过乘法更新我们的生存估计：$\hat{S}(t) = (\text{之前的生存率}) \times (\text{新因子}) = (5/6) \times (3/4) = 15/24 = 5/8$。这个值将保持到下一个事件发生。

曲线就是这样发展的，它是一个[阶梯函数](@entry_id:159192)，仅在事件发生时下降，并在其间保持稳定。如果多个事件同时发生怎么办？很简单：如果在有50人处于风险中的时间 $t_j$ 发生了3例死亡，$d_j$ 就等于3，生存概率将乘以一个新的因子 $(1 - 3/50)$。这个逻辑完美地处理了时间结（tied events） [@problem_id:4921588]。

### 地图的边缘

当我们用尽数据时会发生什么？假设在我们的研究中，最后一个观测值，在时间 $t_{\max}$，是一个[删失数据](@entry_id:173222)。[Kaplan-Meier](@entry_id:169317) 曲线在其最后计算的值上保持平坦。它不会降到零，因为没有观察到事件。超过这一点，曲线是未定义的。风险集中已经没有人了，所以我们完全没有任何关于接下来可能发生什么的信息 [@problem_id:4562416]。

这导致了一个常见的实际问题。我们通常希望报告**[中位生存时间](@entry_id:634182)**——即预期有一半患者存活的时间点。但是，如果生存曲线从未降到 $0.5$ 以下呢？这在一个非常有效的治疗或随访期很短的研究中很容易发生。Kaplan-Meier 估计量是诚实的：它告诉我们[中位生存时间](@entry_id:634182)未达到。我们可以报告[中位生存时间](@entry_id:634182)大于我们的总随访时间，但我们无法给出一个确切的数字。通过外推法这样做，就等于捏造我们没有的数据 [@problem_id:4562416]。

### 默契的约定：独立性

Kaplan-Meier 方法功能强大，但它依赖于一个至关重要的假设：**非信息性删失**。这意味着个体被删失的原因与他们的预后或发生事件的风险是独立的。例如，患者因新工作而搬家是一个典型的非信息性原因。但是，如果一个癌症试验中的患者因为症状变得更糟需要住院而退出研究呢？这就是**信息性删失**。他们离开研究告诉了我们一些关于他们预后的非常重要的信息——他们发生事件的风险可能更高。

当这个假设被违反时，[Kaplan-Meier](@entry_id:169317) 估计量就会产生偏差。让我们想象一个极端的假设世界来看看这是如何发生的 [@problem_id:4921666]。假设有两种人：“类型1”注定在 $T=1$ 年时发生事件，“类型2”在 $T=2$ 年时发生事件。在人群中，比例为 $p$ 的是类型1，比例为 $1-p$ 的是类型2。存活超过1年的真实概率就是类型2的人的比例，$S(1) = 1-p$。

现在，让我们引入一个恶意的删失机制：任何类型2的人（更健康）都会在 $C=0.5$ 年时被自动删失。Kaplan-Meier 估计量只会看到类型2的人在0.5年时离开研究。当时间到达 $t=1$ 时，风险集中剩下的人都只是类型1的个体。然后他们所有人在 $t=1$ 时发生事件。估计量看到在 $t=1$ 时处于风险中的100%的人都发生了事件，并得出结论生存概率降至零！它估计 $\hat{S}(1)=0$，而真实值是 $1-p$。这个偏差是巨大的。这说明了一个普遍规律：如果病情较重的患者更有可能被删失（例如，失访），那么剩余的样本看起来会人为地更健康，KM曲线将偏高，高估生存率。如果更健康的患者被删失，曲线将偏低 [@problem_id:4605658]。

### 其原理：一种更深层次的美

你可能会想，这个生存链是否只是一个聪明的技巧？事实证明它远比这更深刻。Kaplan-Meier 估计量实际上是生存函数的**[非参数最大似然估计](@entry_id:164132)量 ([NPMLE](@entry_id:164132))** [@problem_id:4640295]。这是一个优美的结果。从本质上讲，这意味着如果你考虑所有可能存在的生存曲线，Kaplan-Meier 曲线是使你实际观察到的数据*最可能*发生的那一条。

这个论证非常优雅。观察到我们包含事件和删失的完整数据集的似然性，可以在数学上分解为一系列的项，每个事件时间对应一项。每一项的形式都像 $h_j^{d_j}(1-h_j)^{n_j-d_j}$，其中 $h_j$ 是在时间 $t_j$ 发生事件的未知[条件概率](@entry_id:151013)。为了最大化总似然，我们只需要独立地最大化这些小部分中的每一个。而能做到这一点的恰恰是 $\hat{h}_j = d_j/n_j$——在风险人群中观察到的失败比例！这个简单、直观的估计也正是被强大的[最大似然](@entry_id:146147)原则严格选出的那一个。

### 知其所限：[竞争风险](@entry_id:173277)的挑战

最后，理解 [Kaplan-Meier](@entry_id:169317) 方法*不*适用于什么情况也同样重要。想象一项关于老年患者的研究，你感兴趣的是因心脏病导致的死亡。然而，一些患者可能先死于癌症。这便是一个**竞争风险**。人们很容易想通过简单地将癌症死亡视为删失观测来估计因心脏病死亡的概率。

这是一个严重的错误 [@problem_id:4921567]。原因微妙但至关重要。当我们在标准的 KM 框架中删失一个患者时，我们假设他们本可以在之后发生我们感兴趣的事件。但是一个死于癌症的患者，在任何情况下都不可能之后再死于心脏病发作。他们被永久地从*所有*未来事件的风险池中移除了。因此，将癌症死亡视为删失是一个错误：它违反了被删失者仍然处于事件风险中的核心假设。这种违背最终导致系统性地高估因心脏病死亡的概率。当以这种方式使用时，KM 方法估计的是在一个癌症不存在的假设世界里因心脏病死亡的概率——一个与我们自己的世界截然不同的世界。对于这类问题，需要更先进的方法来正确地模拟多种事件类型之间的相互作用。

[Kaplan-Meier](@entry_id:169317) 估计量是清晰统计思维力量的证明。它从一个混乱、不完整的现实中，通过一个简单而深刻的原则，提取出一幅关于随时间变化的生存状况的忠实而优雅的图景。它是现代医学和流行病学的基石，是一个理解时间、机遇和生命本身的优美工具。

