## 引言
在研究中，暴露与结局之间的真实关系很容易被掩盖。一种新药可能看似有害，或一项公共卫生干预措施可能看似无效，这仅仅是因为被比较的组别之间不具有真正的可比性。这种由同时与暴露和结局相关的第三个变量引起的失真，被称为混杂，它是得出有效科学结论的最大挑战之一。我们如何才能揭开这层误导性的面纱，看到其下隐藏的真实效应呢？

本文深入探讨 Mantel-Haenszel 估计，这是一种专为此目的而设计的强大而精妙的统计工具。它提供了一种分析分层数据的方法，使研究人员能够控制混杂因素，并获得更准确的关联度量。我们将从“原理与机制”一节开始，通过 Simpson 悖论等现象，探讨混杂的欺骗性本质。您将了解到分层如何分解数据以实现公平比较，以及 Mantel-Haenszel 公式如何巧妙地将这些信息合并成一个单一、稳健的汇总摘要。随后，“应用与跨学科联系”一节将展示该方法在流行病学、基因组学、荟萃分析等不同领域的通用性，并揭示其与逻辑斯蒂回归等现代回归技术的深厚联系。

## 原理与机制

想象一下，一种新的医疗疗法正在接受测试。研究人员收集数据后沮丧地发现，接受新疗法的患者发生不良结局的比率远高于接受标准治疗的患者。最初的结论似乎很悲观：该疗法是有害的。但事实真的如此简单吗？如果这种新的实验性疗法被优先用于那些病情最重、基线风险最高的患者，情况又会如何？

在这种情况下，直接比较两组，就好比比较专业赛车手和通勤父母的完成时间，却没有认识到一组是在一级方程式赛道上驾驶，而另一组则是在学校区域的交通中穿行。这种比较从根本上说是不公平的。我们观察到的差异可能与“赛车”（疗法）无关，而完全与“赛道”（患者的基础健康状况）有关。这就是**混杂**问题，也是统计学家和科学家必须克服的最顽固的难题之一。

### 平均值的欺骗性：混杂与 Simpson 悖论

让我们通过一个思想实验来具体说明我们的医疗故事。假设将所有数据合并在一起分析时，显示接受新疗法的患者发生不良结局的比值，是接受标准治疗患者的四倍多[@problem_id:4819922]。这就是我们的“粗略”或未经调整的**比值比**（OR），一种我们稍后将更深入探讨的关联度量。一个 $4.25$ 的 OR 值是惊人的。

但现在，让我们换个巧妙的思路。我们知道有些患者基线风险高，而另一些患者基线风险低。如果我们将数据切分，即**分层**为高风险患者和低风险患者这两组，并分别进行分析，会发生什么呢？

在高风险组内，我们发现该疗法的比值比约为 $0.44$。在低风险组内，比值比为 $0$。在*两个*分层中，该疗法都表现出保护作用，降低了不良结局的比值。这怎么可能呢？为什么该疗法在每个亚组中都具有保护作用，但在合并组别后却显得有害？

这种惊人的逆转是一种经典的统计错觉，被称为 **Simpson 悖论**。它的出现是因为整个总体的“平均值”具有欺骗性。粗略比值比被基线风险的混杂效应所污染。大多数高风险患者（他们本来就可能出现不良结局）接受了新疗法，而大多数低风险患者则接受了标准治疗。这种不平衡造成了一种虚假的、误导性的关联。通过分层，我们实现了同类比较：将接受新疗法的高风险患者与接受标准治疗的高风险患者进行比较，低风险组也是如此。分层揭示了错觉，展现了潜在的真相。

### 关闭后门：分层作为因果推断的工具

我们可以用一种称为[有向无环图](@entry_id:164045)（DAG）的简易图来可视化这种关系。设 $A$ 为疗法（干预或暴露），$Y$ 为结局，$Z$ 为混杂因素（基线风险）。我们讲述的故事对应于一张图，其中箭头从 $Z$ 指向 $A$（风险状态影响给予何种疗法），并从 $Z$ 指向 $Y$（风险状态独立影响结局）。此外，还有一个从 $A$ 指向 $Y$ 的箭头，代表我们想要测量的真实因果效应[@problem_id:4609399]。

$A \leftarrow Z \rightarrow Y$ 这条路径是一条“后门”路径。它在 $A$ 和 $Y$ 之间建立了一种非因果的统计关联。分层等同于对 $Z$ 进行“条件化”，在我们的图中，这会阻断这条后门路径。它使我们能够分离并测量直接路径 $A \rightarrow Y$。

要使这种方法有效，我们必须假设在 $Z$ 的每个分层内，患者接受该疗法的原因与他们的预后没有其他隐藏的关联。这就是**条件可交换性**的假设：在每个风险组内，疗法的分配*就好像*是随机的[@problem_id:4609399] [@problem_id:4808923]。因此，分层不仅仅是一种[数据清理](@entry_id:748218)技巧；它是一种有原则的方法，用于近似模拟随机实验并提出因果声明。

### Mantel-Haenszel 的神来之笔：一种巧妙的信息合并方法

所以，分层为我们提供了一组比值比，每个亚组一个。在我们的例子中，我们有两个：一个用于高风险组，一个用于低风险组。如果我们相信该疗法的效应在所有组中基本相同——这一假设被称为**比值比的[同质性](@entry_id:636502)**——那么我们面临一个新的问题：如何将这些分层特异性估计合并成一个单一、可靠的总体摘要？

简单的算术平均是一个糟糕的选择。它会给予一个有数千名患者的分层和一个只有少数患者的分层同等的权重，尽管来自较大组的估计要精确得多[@problem_id:4809021]。我们需要一个更智能的加权方案。

这正是 Nathan Mantel 和 William Haenszel 的天才之处。**Mantel-Haenszel (MH) 估计量**是一种精妙而稳健的信息合并方法。让我们看一个分层的单个 $2 \times 2$ 表，单元格计数为 $a, b, c, d$：

| | 有结局 | 无结局 |
| :--- | :-: | :-: |
| **暴露组** | $a$ | $b$ |
| **非暴露组** | $c$ | $d$ |

此表的比值比为 $\frac{ad}{bc}$。MH 方法没有对每个分层 $k$ 的最终比值进行平均，而是更进了一步。它构建了一个*总和*的比率：

$$
\hat{\theta}_{MH} = \frac{\sum_{k} \frac{a_k d_k}{n_k}}{\sum_{k} \frac{b_k c_k}{n_k}}
$$

这里，$n_k$ 是分层 $k$ 中的总受试者数。乍一看，这个公式可能显得晦涩。但其结构却异常精妙。它源于对交叉乘积[期望值](@entry_id:150961)的一个基本洞见[@problem_id:4900660]。如果真实（但未知）的共同比值比为 $\theta$，那么对于任何分层，分子项 ($a_k d_k / n_k$) 的[期望值](@entry_id:150961)约等于 $\theta$ 乘以分母项 ($b_k c_k / n_k$) 的[期望值](@entry_id:150961)。通过在计算比率之前对所有分层的这些项求和，MH 估计量平均的是关联性的“构建模块”，而不是充满噪声的最终估计值。

这种“总和之比”的结构赋予了 MH 估计量其卓越的特性。其一，它自然地给予信息量更大的分层——即那些为关联性提供更多证据的分层——更大的权重[@problem_id:4809021]。它也极其稳健。如果某个分层的某个单元格中出现零，会怎样？例如，如果 $c_k = 0$，则该分层特异性比值比为无穷大！简单的平均计算会失效。然而，MH 估计量能优雅地处理这种情况。该分层对分母总和的贡献为 $0$，但仍对分子总和有贡献。只要至少有一个分层对分子和分母的总和都有非零贡献，最终的估计值就能保持稳定且有明确定义[@problem_id:4808999]。

### 注意事项：何时使用，何时暂停

Mantel-Haenszel 估计量是一个强大的工具，但像任何工具一样，必须明智地使用。它的主要假设是**[同质性](@entry_id:636502)**——即在每个分层中比值比都相同。

如果这不成立呢？这种情况，即暴露的效应在不同亚组中不同，被称为**效应修饰**或**[交互作用](@entry_id:164533)**。想象一下，我们发现我们的疗法对糖尿病患者具有保护作用（OR = $0.25$），但对非糖尿病患者则有害（OR = $2.0$）[@problem_id:4973504]。这是一种*定性[交互作用](@entry_id:164533)*——效应方向发生逆转。在这种情况下，计算单一的合并 MH 估计值将是科学上的不当行为。最重要的发现是效应*并非共同*。目标不是找到“平均”效应，而是报告该疗法的效应关键性地取决于患者的糖尿病状况。分析的美妙之处在于发现这种复杂性，而不是将其隐藏在一个单一的数字背后。统计学家拥有特定的工具，如 **Breslow-Day 检验**，来正式检验[同质性](@entry_id:636502)假设，这与用于关联性检验的主要 **Cochran-Mantel-Haenszel 检验**的目的不同[@problem_id:4900639]。

最后，我们必须理解比值比本身一个深刻而微妙的特性。与风险差不同，比值比是**不可合并的**（non-collapsible）。这意味着即使在没有混杂的完美随机试验中，只要分层变量是结局的一个预后因素，粗略比值比（来自合并表格）通常也不会等于分层特异性比值比[@problem_id:4609433]。这不是一个悖论或错误。这是一个基本的数学特性。它提醒我们，“整个总体的平均效应”（边际估计）和“特定亚组内个体的效应”（条件估计）通常是两个不同的问题，而比值比会给出两个不同的答案。Mantel-Haenszel 估计量为我们提供了条件效应的有效估计，这通常是我们在为具有特定特征的患者做决策时真正关心的。它是一个工具，当我们深入理解它时，它能让我们穿透混杂的迷雾，欣赏世界那美丽而时而复杂的结构。

