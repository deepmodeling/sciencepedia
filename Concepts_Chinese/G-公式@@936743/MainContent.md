## 引言
评估慢性病治疗的长期有效性是一项复杂的挑战。干预措施并非单一事件，而是一系列决策过程，其中每次治疗都会影响患者未来的健康状况，而该健康状况又反过来指导下一次治疗。这就产生了一个被称为时变混杂的反馈循环，标准的统计方法在处理此问题时常常会失效，导致对治疗真实影响的结论产生偏倚和误导。这一知识鸿沟凸显出，我们需要一种更复杂的工具来驾驭这张因果之网。

本文介绍了 G-公式，一种为解决此问题而设计的强大而直观的方法。通过将因果推断概念化为一种模拟，G-公式允许研究人员估计持续治疗策略的效果，就好像他们在进行一项完美的、假设性的实验一样。接下来的章节将引导您了解这种创新方法。首先，“原理与机制”将揭示 G-公式的工作原理、传统方法为何不足，以及支撑其有效性的假设。随后，“应用与跨学科联系”将展示其在公共卫生、个性化医疗领域的实际影响，以及其与人工智能和工程学领域令人惊讶的联系。

## 原理与机制

想象一下，你是一位治疗高血压等慢性病患者的医生。你的任务不是一个单一的、一次性的决定。你开出一种药物，等待一个月，测量病人的血压，然后根据读数，你可能会调整剂量、继续疗程或更换药物。这个过程会重复数月甚至数年。你给予的治疗会影响病人未来的健康状态（他们的血压），而该健康状态又反过来影响你的下一次治疗决策。这就产生了一个复杂的反馈循环，一个干预与演化之间错综复杂的舞蹈。

现在，假设你想回答一个看似简单的问题：与较宽松的治疗策略相比，积极的治疗策略（例如“始终以尽可能低的血压为目标”）的总体长期益处是什么？这个问题极其困难。当病人所走的路径本身就是由他们一路上接受的治疗所塑造时，我们如何理清一个策略的净效应？这就是**时变混杂**的挑战，也是现代医学科学中最微妙和最重要的问题之一。标准的统计方法在这里常常会失灵，可能导致我们得出灾难性的错误结论。为了走出这个迷宫，我们需要一个更强大、在概念上更优美的工具：**G-公式**。

### 为何标准方法会失效：一顶双帽的故事

要理解为什么需要新工具，我们必须首先认识到旧工具为何会失效。让我们继续以高血压为例。在每次复诊时，病人的血压（我们称之为 $L_t$）扮演着双重角色——它同时戴着两顶帽子。

首先，它戴着**混杂因素**的帽子。今天血压高的病人（高 $L_t$）更有可能接受更大剂量的药物（我们称之为治疗 $A_t$）。同时，血压高的病人本身在未来发生心脏病（结局 $Y$）的风险也更高。如果我们简单地比较接受大剂量药物的人和没有接受的人，我们就在进行不公平的比较；因为治疗组一开始的病情就更重。标准的统计实践告诉我们要“调整”或“控制”血压，以创造一个公平的竞争环境。

但问题就在这里。今天复诊时的血压 $L_t$，也戴着第二顶帽子：**中介因素**的帽子。在*上一次*复诊时开出的药物 $A_{t-1}$ 作用是降低今天的血压。也就是说，$A_{t-1}$ 对 $L_t$ 有因果效应。这意味着 $L_t$ 是从过去治疗到最终结局的因果路径上的一个关键步骤。

悖论就在于此。为了消除*当前*治疗的混杂，我们觉得必须对 $L_t$ 进行调整。但这样做，我们实际上是在对*过去*治疗效应的中介因素进行条件化。这就像试图确定浇水是否有助于[植物生长](@entry_id:148428)，却坚持只比较土壤湿度完全相同的植物。你这样做会使浇水起作用的机制——增加土壤湿度——完全失效！在传统的[回归模型](@entry_id:163386)中对 $L_t$ 进行调整，实际上阻断了我们试图测量的部分长期因果效应。

这不仅仅是一个理论上的吹毛求疵。这种分析错误可能导致估计值不仅是略有偏差，甚至可能偏倚到逆转治疗的表观效果。一种有益的药物可能显得无用甚至有害。例如，在一个简化的情景中，一个简单的分析可能显示某治疗策略的风险差为 $-0.20$（风险降低20个百分点），而正确计算的真实因果效应是 $-0.44$（风险降低44个百分点）。这种简单的方法低估了药物一半以上的益处，仅仅因为它无法正确处理时变混杂因素戴着的两顶帽子。

### 一项思想实验：模拟一个完美世界

如果我们不能使用标准的调整方法，我们能做什么呢？让我们借鉴物理学家的做法，进行一项思想实验，即 *Gedankenexperiment*。如果我们拥有终极能力：克隆我们整个研究群体，会怎么样？

为了找到“始终治疗”策略的真实因果效应，我们可以取我们群体的一个副本（称之为队列1），在每一步都进行干预，无论他们的健康状况如何，都给予他们指定的治疗。我们会观察他们随时间的演变——他们的血压随着每次治疗而变化——并在最后测量平均结局，比如说心脏病发作率。这将告诉我们，在一个每个人都“始终被治疗”的世界里，真实的风险是多少。我们可以称之为潜在结局，记作 $\mathbb{E}[Y^{\text{always treat}}]$。

同时，我们可以取我们群体的第二个副本（队列2），即“从不治疗”组，在每一步都给予他们安慰剂。我们会观察他们的演变，并测量他们的平均结局 $\mathbb{E}[Y^{\text{never treat}}]$。

这两个完美的、平行的宇宙中平均结局之间的差异，就是该策略真实的、纯粹的因果效应。这里没有混杂，因为是我们这些实验者分配了治疗。这就是我们追求的理想。

当然，我们不能克隆人。但如果我们能在计算机上（*in silico*）执行这个精确的实验呢？如果我们能利用来自我们那个混乱的、观察性世界的数据来学习“自然法则”，然后构建一个这些完美的、平行宇宙的模拟呢？这正是 G-公式允许我们做的事情。

### G-公式：模拟宇宙的配方

G-公式，或称 G-计算，与其说是一个静态的公式，不如说是一个动态的配方——一个执行我们刚才描述的思想实验的算法。让我们以一个简单的两步治疗策略为例，比如“基线时始终接受咨询（$A_0=1$）和季中始终接种加强针（$A_1=1$）”，来逐步了解这个模拟过程。

**第 0 步：起点线。** 我们从现实世界的队列开始。我们采用他们的基线特征——他们最初的健康风险 $L_0$。这是我们[模拟宇宙](@entry_id:754872)的初始状态。

**第 1 步：第一次干预。** 我们想模拟“始终治疗”的世界。所以，我们忽略人们实际接受的治疗。相反，我们在计算上声明模拟中的每个人都接受第一次治疗，$A_0=1$。

**第 2 步：让自然演化。** 世界如何响应？我们知道第一次治疗会影响人们在下一个时间点的健康状况 $L_1$。从我们的真实世界数据中，我们可以建立一个[统计模型](@entry_id:755400)来学习这个规则：“给定一个人的基线风险 $L_0$ 和他们接受了治疗 $A_0=1$ 的事实，他们出现季中健康状况 $L_1$ 的概率是多少？” 利用这个学到的规则，我们为计算群体中的每个个体模拟一个新的健康状况 $L_1$。这是关键的一步：我们正在模拟混杂因素的分布，*就好像它是在我们的干预下发生的那样*。

**第 3 步：第二次干预。** 现在是下一次治疗的时候了。我们选择的策略是“始终治疗”，所以我们再次进行干预，在计算上为每个人分配第二次治疗 $A_1=1$。

**第 4 步：最终结局。** 我们的每个模拟个体现在都有一个完整的历史：他们真实的基线状态（$L_0$）、我们强制的治疗序列（$A_0=1, A_1=1$）以及作为第一次治疗结果而演变出的健康状态（$L_1$）。他们的最终结局 $Y$ 是什么？我们再次求助于我们的真实世界数据，为自然的最终规则建立一个模型：“给定一个人的完整治疗和健康状态历史，他们出现最终结局的概率是多少？”我们用这个模型来预测我们模拟中每个人的结局。

**压轴大戏。** 在对大量人群进行此模拟后，我们只需计算他们所有预测结局的平均值。这个平均值就是我们对 $\mathbb{E}[Y^{(1,1)}]$ 的估计——即在一个每个人都遵循“(1,1)”策略的世界里，我们期望看到的风险。我们可以为“从不治疗”策略（$a_0=0, a_1=0$）重复整个过程，得到 $\mathbb{E}[Y^{(0,0)}]$，然后计算因果风险差。

这个“干预，让世界按其规则演化，再干预……”的序贯过程是 G-公式的核心。它尊重事件的时间顺序。它通过对混杂因素如何受先前治疗影响进行建模，正确地处理了反馈循环。G-公式的数学表达式初看起来令人生畏，但它不过是这个模拟故事的精确、符号化的表示。

对于一个在 $T$ 个时间点上的一般治疗策略 $\bar{a}$，其公式为：
$$ \mathbb{E}[Y^{\bar{a}}] = \sum_{l_0} \dots \sum_{l_T} \mathbb{E}[Y | \bar{A}=\bar{a}, \bar{L}=\bar{l}] \times P(L_0 = l_0) \times \prod_{t=1}^{T} P(L_t = l_t | \bar{A}_{t-1} = \bar{a}_{t-1}, \bar{L}_{t-1} = \bar{l}_{t-1}) $$
让我们来解释一下：总体平均结局（$\mathbb{E}[Y^{\bar{a}}]$）是所有可能的混杂因素生命路径（$\sum_{l_0} \dots \sum_{l_T}$）的总和。对于每条路径，我们将给定该路径和固定治疗策略下的最终结局风险（$\mathbb{E}[Y | \dots]$）乘以在该策略下该生命路径发生的概率。这个概率是序贯分解的：从 $L_0$ 开始的概率，乘以给定过去情况下演化到 $L_1$ 的概率，依此类推，每一步都尊重我们施加的治疗。

### 附加条款：假设与现实

这个模拟是一个强大的工具，但它并非魔法。其有效性依赖于几个关键假设——这些“附加条款”定义了知识与推测之间的界限。

1.  **无隐藏混杂因素（序列可交换性）：** 我们的模拟要求我们从数据中学习“自然法则”。这只有在我们测量了所有在每一步都同时影响治疗决策和结局的重要因素（$L_t$）时才可能。如果存在某个未测量的因素，比如遗传倾向，它既使医生对病人的治疗方式不同，又影响他们的结局，那么我们的模拟就会有缺陷，因为它的规则不完整。

2.  **正定性：** 为了学习规则，我们需要看到它们在实际中发生。例如，要知道一种治疗对非常健康的人有何影响，我们必须至少有一些健康人在现实世界中实际接受过该治疗的数据。如果在我们的数据中，医生*从不*给健康人使用某种药物，我们就遇到了正定性违背。我们没有模拟将会发生什么的经验基础。我们的模型将被迫进行推断——仅仅基于数学形式而非数据进行猜测。

3.  **一致性：** 我们必须假设，在假设的治疗计划下我们会看到的结局，与一个人实际遵循该计划时所看到的结局是相同的。这将我们思想实验中的潜在结局与现实世界联系起来。

4.  **正确的模型：** G-公式是[参数化](@entry_id:265163)的；它依赖于我们为“自然法则”建立的[统计模型](@entry_id:755400)。如果我们为治疗如何影响血压，或血压如何影响最终结局建立的模型与现实相差甚远（例如，我们假设是直线关系，而实际上是曲线关系），那么我们模拟的宇宙将是真实世界的扭曲反映，我们的结果也会有偏倚。

这些挑战是巨大的。事实上，整个统计学领域都在致力于开发对这些问题更具稳健性的方法。例如，**边际结构模型 (MSM)** 处理这个问题的方法不是模拟一个新的人群，而是通过对我们现有数据中的个体进行重加权，来创建一个平衡的伪群体。更先进的技术，如**目标[最大似然估计](@entry_id:142509) (TMLE)**，巧妙地结合了 G-公式和 MSM 的特点，做到了“双重稳健”，即如果自然法则的模型或治疗分配的模型中有一个是正确的，它就能给出正确答案。

即便如此，G-公式仍然是一个基础概念。它为思考和估计随时间变化的因果效应提供了一个清晰、直观且强大的框架。它将棘手的反馈循环问题转化为一个可管理的、一步一步的模拟过程。它证明了这样一个理念：即使面对现实复杂、动态的本质，我们仍然可以问“如果……会怎样？”，并在适当的条件下，找到一个严谨而有意义的答案。

