## 引言
区分因果是科学和政策制定中最根本的挑战之一。当引入一项干预措施时——无论是新法律、公共卫生运动，还是环境变化——我们如何能确信其真实影响？简单的前后比较常常具有误导性，因为它们会受到潜在趋势的干扰，从而掩盖真实情况。本文介绍了双重差分法（DiD），这是一种强大而直观的准实验设计，用于克服这一挑战，并从观测数据中得出可靠的因果结论。

在两个综合性章节中，我们将踏上掌握这一基本工具的旅程。首先，在“原理与机制”中，我们将解构该方法的精妙逻辑，从其寻求反事实的概念基础，到其关键[支点](@entry_id:166575)：[平行趋势假设](@entry_id:633981)。我们将探讨如何为这一假设建立论证，并理解其被违反的后果。随后，“应用与跨学科联系”将展示 DiD 卓越的通用性，阐明同样的核心推理如何被应用于回答公共卫生、行为科学和生态学等不同领域中的关键问题。读完本文，您将拥有一个坚实的框架，以理解如何从动态世界的噪音中分离出变化的信号。

## 原理与机制

### 对反事实的求索

想象一下，你是一名公共卫生官员。一项新的、影响广泛的政策已经颁布——比如全州范围内禁止在公共场所吸烟——而你的工作是判断它是否奏效。它减少心脏病发作了吗？这个问题似乎很简单。你可以查看该州在禁令实施前的心脏病住院人数，并将其与实施后的人数进行比较。假设你发现，在法律通过后，急性心肌梗死（AMI）的发病率从每 10 万人 210 例降至 180 例 [@problem_id:4566478]。这算成功吗？

没那么快。你怎么能确定这种下降是由于*你的*政策？也许在同一时期，新的医疗方法变得普及，或者一场全国性的健康运动鼓励了更健康的饮食。世界并不会在我们进行实验时静止不动。这种持续变化的潮流，科学家称之为**长期趋势**（secular trend），污染了我们简单的前后比较。你观察到的 30 个单位的下降是政策真实效果和这种背景趋势的混合物。你发现的仅仅是**相关性**（association），而不一定是**因果关系**（causation）[@problem_id:4776656]。

问题的核心在于：要真正了解政策的效果，你需要知道如果在*完全相同的州、完全相同的时间段内*，该政策*没有*被颁布，会发生什么。这种“如果……会怎样”的情景，我们称之为**反事实**（counterfactual）。它让我们得以一窥一个我们永远无法访问的平行宇宙。因果推断的全部要义，就是寻找巧妙、可信的方法来估计那个平行世界里发生的事情，而无需真正去到那里。

### 第二重差分的精妙之处

如果我们无法直接观察到反事实，也许我们可以找一个替代品。邻近的一个州怎么样？它和我们的州非常相似，但*没有*颁布禁烟令。我们可以简单地将我们处理州在政策实施后的心脏病发作率与邻近未处理州的发生率进行比较。但这同样充满风险。如果我们的州由于人口结构或工业历史的差异，心脏病发作率本来就一直更高呢？比较两个州的水平可能仅仅反映了这些先前存在的差异，而不是政策的效果。

在这里，一个绝妙简单而强大的想法应运而生。我们不把对照州当作处理州的直接复制品，而是用它来达到一个更微妙的目的：衡量“时间之河”。我们用它来估计我们之前无法分离出来的长期趋势。这个逻辑是一个优美的两步舞。

首先，我们计算处理州随时间的变化。我们称之为第一个“差分”。我们知道，这个差分是[处理效应](@entry_id:636010)和趋势的混合体。

$$ \text{Change in Treated State} = \text{Treatment Effect} + \text{Secular Trend} $$

其次，我们计算对照州随时间的变化。由于这个州没有接受处理，原则上，它的变化应该*仅仅*是长期趋势。

$$ \text{Change in Control State} = \text{Secular Trend} $$

现在，是最后也是最精彩的一步。如果我们从处理州的变化中减去对照州的变化，“长期趋势”这一项就会被抵消，剩下我们一直想要的：处理效应。这就是**双重差分法**（Difference-in-Differences，DiD）。我们是在取两个*差分*的*差分*。

让我们通过一个旨在降低收缩压的假设性健康项目来实际操作一下。假设在实施该项目的诊所，血压平均下降了 5 毫米汞柱。在没有实施该项目的诊所，血压仍然下降了，但只下降了 2 毫米汞柱，这可能是由于更广泛的公众意识宣传活动。在处理组中进行的简单前后比较得出的答案是 -5 毫米汞柱。但 DiD 方法讲述了一个不同的故事。真正的因果效应是处理组的变化减去[对照组](@entry_id:188599)的变化：(-5 毫米汞柱) - (-2 毫米汞柱) = -3 毫米汞柱 [@problem_id:4776656]。另外 2 毫米汞柱的改善无论如何都会发生！DiD 方法让我们得以将项目的效果从背景趋势中分离出来。

这个逻辑被浓缩在经典的 DiD 公式中。如果我们让 $\bar{Y}$ 表示平均结果，下标表示组别（1 为处理组，0 为[对照组](@entry_id:188599)）和时间（后或前），那么处理效应的 DiD 估计量 $\hat{\tau}_{DiD}$ 为：

$$ \hat{\tau}_{DiD} = (\bar{Y}_{1,post} - \bar{Y}_{1,pre}) - (\bar{Y}_{0,post} - \bar{Y}_{0,pre}) $$

在我们的禁烟令例子中，处理州的变化是 $180 - 210 = -30$。在邻近的对照州，发病率也发生了变化，从 $205$ 降至 $195$，变化了 $-10$。因此，该政策效果的 DiD 估计是 $(-30) - (-10) = -20$ 例住院/每 10 万人 [@problem_id:4566478]。该政策似乎起作用了，导致了 20 例的减少，这与 30 例的粗略估计不同。

### 关键假设：平行世界

这种优雅的相减方法似乎好得令人难以置信。和科学中所有强大的工具一样，其有效性依赖于一个关键假设。在这种情况下，它就是**[平行趋势假设](@entry_id:633981)**（Parallel Trends Assumption）。

该假设是：**在没有处理的情况下，处理组本会经历与[对照组](@entry_id:188599)相同的结果趋势。** 我们假设时间之河对两个组都以相同的速度和方向流动。[对照组](@entry_id:188599)*实际*走过的路径，是处理组*本会*走过的路径的有效替代。在没有政策的世界里，我们的两个州是平行世界。

我们可以使用现代因果推断的基石——**[潜在结果](@entry_id:753644)**（potential outcomes）的语言来更正式地陈述这一点 [@problem_id:4389018]。对于任何时间点的任何组，让我们想象存在两种[潜在结果](@entry_id:753644)：$Y(1)$，即接受处理时的结果；以及 $Y(0)$，即未接受处理时的结果。对处理组的因果效应是 $\mathbb{E}[Y_{1,post}(1) - Y_{1,post}(0)]$。第一项 $\mathbb{E}[Y_{1,post}(1)]$ 正是政策实施后在处理组中观察到的平均结果。第二项 $\mathbb{E}[Y_{1,post}(0)]$ 是不可观察的反事实。

[平行趋势假设](@entry_id:633981)使我们能够识别这个反事实。它指出，处理组在没有处理的情况下本会经历的趋势，等于[对照组](@entry_id:188599)在没有处理的情况下确实经历的趋势 [@problem_id:4956725]：

$$ \mathbb{E}[Y_{1,post}(0) - Y_{1,pre}(0)] = \mathbb{E}[Y_{0,post}(0) - Y_{0,pre}(0)] $$

由于[对照组](@entry_id:188599)从未被处理，其观察到的趋势等于等式的右边。这使我们能够解出反事实，并通过一些代数运算，回到我们简单的 DiD 公式 [@problem_id:4389018]。该假设是连接我们可观察数据与我们希望了解的不可观察因果量的关键。

### 我们能信任这个假设吗？一套侦探工具箱

[平行趋势假设](@entry_id:633981)如此关键，以至于正确应用 DiD 的很大一部分工作就是扮演侦探，为其合理性收集证据。我们永远无法证明这个假设——因为它是一个关于反事实世界的陈述——但我们可以建立一个强有力的间接证据 [@problem_id:4521972]。

最重要的证据来自于观察**处理前趋势**。如果我们有政策颁布前多个时间点的数据，我们就可以问：这两个组是否已经走在平行的轨道上？如果是，这就增加了它们在没有处理的情况下会继续保持平行的可信度。如果它们已经开始分化，那么这个假设就非常可疑。

例如，在一项关于疫苗接种运动的研究中，研究人员不仅查看了[流感](@entry_id:190386)样疾病（ILI）发病率在一年前的情况，还查看了两年前的情况。他们计算了处理区和对照区在-2年和-1年之间 ILI 发病率的变化。趋势并非完全相同，但非常接近，这表明在这种情况下[平行趋势假设](@entry_id:633981)是合理的 [@problem_id:4541670]。

这种视觉检查可以被形式化。研究人员经常使用**事件研究图**（event-study plots），它显示了政策前后几个时期的估计“效应”。一个看起来健康的事件研究图会显示，在政策前时期，所有系数都接近于零，而在政策后时期则出现变化。如果在处理发生之前就看到非零的“效应”，这是一个重大的警示信号！为了进行更严格的检查，可以执行正式的统计检验，如**[瓦尔德检验](@entry_id:164095)**（Wald test），以联合检验所有处理前系数是否在统计上与零无法区分 [@problem_id:4800659]。其他巧妙的检查方法包括使用安慰剂日期（假装政策比实际发生得更早）或安慰剂结果（检查对一个本不应受政策影响的结果是否存在效应）[@problem_id:4521972]。

### 当世界碰撞：偏差的危害

如果[平行趋势假设](@entry_id:633981)被违反会发生什么？例如，如果在对照地区的一项独立药店运动导致那里的疫苗接种率上升得比原本应有的速度更快，会怎么样 [@problem_id:4566487]？我们的[对照组](@entry_id:188599)趋势现在被“污染”了；它不再代表处理组的反事实趋势。

结果就是**偏差**（bias）。我们的估计将是错误的。但奇妙的是，DiD 的数学原理让我们能够准确地描述它将如何出错。如果处理组的真实潜在趋势（无处理情况下）与[对照组](@entry_id:188599)的趋势相差某个量，我们称之为 $\Delta$，那么 DiD [估计量的偏差](@entry_id:168594)就精确地等于 $\Delta$ [@problem_id:4626142]。

$$ \text{Bias}(\hat{\tau}_{DiD}) = \mathbb{E}[\hat{\tau}_{DiD}] - \tau = \Delta $$

这是一个深刻的结果。它告诉我们，我们的估计不仅是“偏离的”，而且如果我们知道趋势的差异，它偏离的量是可预测的。例如，在流感疫苗的情景中，如果对照地区的药店运动使其趋势额外增加了 $\delta = 0.03$，那么 DiD 估计量将有 $-\delta = -0.03$ 的偏差。它会系统性地低估授权令的真实效果，因为它使用的[对照组](@entry_id:188599)趋势被人为地抬高了 [@problem_id:4566487]。这种假设违背与由此产生的偏差之间的直接联系，是一个成熟且被充分理解的科学方法的标志。

### 一些提醒：尺度、谬误与效应的性质

在我们结束这段旅程时，值得注意一些开启了更深远视野的微妙之处。

首先，我们所讨论的 DiD 方法估计的是对*群体*或*地区*的平均效应。当我们发现一项政策使哮喘住院率降低了 7/100,000 时，我们必须小心，不要犯**生态谬误**（ecological fallacy）。这个结果并不意味着每个个体的风险都降低了。它是对人口层面比率的平均效应，要推断个体层面的效应，需要个体层面的数据或更强的假设 [@problem_id:4521972]。

其次，我们推导的简单 DiD 公式衡量的是**加性**效应：政策导致感染风险降低了（比如说）2.5 个百分点 [@problem_id:4956725]。但如果真实效应是**[乘性](@entry_id:187940)**的呢？——例如，政策将感染风险降低了 20%？尺度很重要。当研究人员使用更复杂的模型，如逻辑回归或泊松回归来执行 DiD 时，交互项不再代表均值的简单差分。相反，它捕捉的是一个乘性效应。对于一个使用对数连接的泊松模型，该系数代表*率比的比率*的对数。对于一个逻辑模型，它代表*优势比的比率*的对数 [@problem_id:4626132]。这不是一个缺陷；这是一个特性。它揭示了“效应”这个概念本身取决于我们用来描述它的数学语言。DiD 框架的美妙之处在于其适应性，无论我们相信世界是通过加法还是乘法运作，它都允许我们探索因果关系。

双重差分法以其优雅的简洁性，是人类智慧的证明。它是一个工具，当谨慎使用并深刻理解其核心原理时，能让我们窥探反事实的平行世界，并带回关于塑造我们自身世界的因果关系的可靠知识。

