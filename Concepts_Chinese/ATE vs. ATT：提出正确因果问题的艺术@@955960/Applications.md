## 应用与跨学科联系

在探索了因果效应的原理与机制之后，我们现在到达一个关键的目的地：现实世界。平均处理效应（ATE）和处理组平均处理效应（ATT）之间的区别不仅仅是一个统计上的细微之处；它是一个深刻的选择，关乎我们究竟想向自然提出什么问题。它是寻求普适规律与理解特定现象之间的差异。在本章中，我们将看到这一选择如何在医学、政策和数据科学领域发挥作用，揭示我们使用的工具与我们提出的问题之间如何美妙而密不可分地联系在一起。

### 从理想实验到凌乱现实

想象一个完美的世界，那种我们在实验室里梦寐以求的环境。在这里，我们可以进行一场完美的随机对照试验（RCT）来测试一种新药 [@problem_id:4550491]。我们召集一群人，为每个人抛硬币决定谁用新药、谁用旧药，然后观察结果。因为抛硬币的结果与一个人的年龄、健康状况无关，所以在实验开始前，处理组和未处理组在平均意义上是彼此完美的镜像。

在这种理想化的情况下，他们平均结果的差异就给出了我们试验人群的平均[处理效应](@entry_id:636010)（ATE）。因为每个人被分到任一组的机率均等，所以处理组的效应与未处理组的效应相同，且二者都等于总体的平均效应。ATE和ATT是同一个东西。我们得到了一个干净、简单的答案。

但现实很少如此干净。在现实世界中，在RCT的纯净高墙之外，人们不是通过抛硬币来被分配处理的。一位医生观察到有中风高风险的病人，给他开一种强效新型抗凝剂的可能性远大于给一个更年轻、更健康的病人 [@problem_id:4830894]。人们会“自我选择”进入处理。这是从临床药理学到公共政策等领域中[观察性研究](@entry_id:174507)的根本挑战。处理组和未处理组从一开始就有所不同。

正是在这个凌乱、精彩、真实的世界上，ATE和ATT之间的区别才凸显出其全部重要性。我们不得不问：我们感兴趣的是药物对从整个人群中抽取的“普通”人（其中许多人一开始就绝不会被开这种药）的效应吗？这是ATE。还是我们感兴趣的是药物对实际接受了它的那类特定的高风险患者的效应？这是ATT。一个决定是否广泛批准药物的政府监管机构可能更关心ATE，而一位医生和她的高风险患者几乎肯定更关心ATT。

### 统计学家的工具箱：用方法塑造问题

为了从观察性数据中解开因果关系，统计学家们开发了一个奇妙的工具箱。真正迷人的是，工具的选择往往就是问题的选择。我们调整组间混杂差异的方式决定了我们估计的是ATE还是ATT。

#### 寻找“双胞胎”：匹配法的逻辑

也许最直观的方法是匹配法。如果我们想知道一种新的教学方法对参加了一个特殊项目的学生的影响，我们不能简单地将他们与所有其他学生比较。参加项目的学生可能一开始就更有动力。匹配法的逻辑是：为项目中的每个学生，找到一个“统计双胞胎”——另一个*没有*参加项目但在动机、先前成绩和背景方面几乎完全相同的学生 [@problem_id:4550502]。

通过创建一个作为*处理组*镜像的[对照组](@entry_id:188599)，我们自然而然地为回答ATT问题做好了准备：该项目对选择参加的学生有何影响？我们通过观察他们的“双胞胎”来估计反事实——即*这些特定的学生*如果没参加项目会发生什么。因为我们的出发点是处理组，所以该方法得到的是ATT [@problem_id:4845551]。这需要一个关键假设：我们已经测量了区分两组的所有重要因素（即*条件[可交换性](@entry_id:263314)*假设），但重要的是，我们只需要这个假设来估计处理组未被处理时会发生什么，而反之则不然 [@problem_id:4830894]。

#### 证据的权重：创建一个虚拟群体

第二种更抽象但更强大的方法是加权法。如果处理组的老年人比[对照组](@entry_id:188599)多，我们可以在计算中给[对照组](@entry_id:188599)的每个老年人多一点“权重”，给每个年轻人少一点权重，直到加权后的[对照组](@entry_id:188599)与处理组具有相同的年龄分布。我们已经看到，倾向性得分（即在给定个体特征的情况下接受处理的概率）为我们提供了计算这些权重的完美方案。

通过[逆概率](@entry_id:196307)处理加权法（IPTW），我们可以构建一个“伪群体”，在这个群体中，处理分配不再受混杂因素影响。标准权重——处理组为$1/e(X)$，[对照组](@entry_id:188599)为$1/(1-e(X))$——完成了一项了不起的壮举：它们对*两个*组都进行重新加权，使其协变量分布与*总体源人群*的分布相匹配。通过比较这个虚拟群体中的结果，我们估计的是ATE [@problem_id:4550502]。

但如果我们想要ATT呢？我们只需改变权重。处理组本身就是我们感兴趣的群体，所以我们可以给他们所有人的权重都设为$1$。然后，我们用$e(X)/(1-e(X))$来为[对照组](@entry_id:188599)的个体加权。这个公式有一个简单而优美的逻辑：它给那些看起来最像处理组的[对照组](@entry_id:188599)个体（即那些有很高处理倾向但未接受处理的人）赋予更高的权重，而给那些看起来最不像处理组的个体赋予更低的权重。结果是一个模拟了处理组的加权[对照组](@entry_id:188599)，最终得到的估计值就是ATT [@problem_id:4980919]。再一次，我们方法的选择变成了我们问题的选择。

### 当现实碰壁：可能性的艺术

自然界提供的数据并不总能回答我们最初想问的问题。流行病学中一个常见而棘手的问题是“重叠不佳”（poor overlap）。考虑一项关于[流感疫苗](@entry_id:165908)在预防住院方面的有效性的研究 [@problem_id:4501727]。在体弱多病、有多种合并症的老年人中，公共卫生建议是如此强烈，以至于几乎每个人都接种了疫苗。这些个体的倾向性得分$e(X)$会非常接近1，也许是0.98或更高。

这对估计ATE构成了一个根本性问题。要估计疫苗对这个群体的效果，我们需要将接种疫苗的人与未接种的人进行比较。但如果几乎没有未接种疫苗的体弱老年人，我们的比较对象是谁呢？ATE的计算，特别是使用加权法时，会给那少数一两个我们可能找到的未接种个体赋予巨大的权重，导致得出的答案在统计上不稳定且不可靠。我们违反了“正性”假设：并非每个人在每个组中都有正的概率。

此时，科学家必须成为一个实用主义者。“疫苗对所有人的平均效应是什么？”这个宏大的问题可能无法回答。我们必须问一个更具体但可回答的问题。我们仍然可以估计ATT。我们可以问：“对于那些我们*能*找到合理比较对象的已处理人群，疫苗的效果是什么？”这通常涉及“修剪”数据，将那些倾向性得分极端、无法找到对应个体的个体放在一边，然后在剩下的“重叠”人群上进行分析 [@problem_id:4501727]。其结果不再是所有被处理者的ATT，而是一个更有限但定义明确的子群体的ATT。透明度要求我们准确报告这个群体是谁。

这引出了第三种日益流行的估计量：重叠人群平均处理效应（ATO）。我们不再试图让各组看起来像总人口（ATE）或处理组人口（ATT），而是可以对两组都进行重新加权，将我们的分析集中在中间的个体上——即“重叠”人群，在这里处理组和未处理组的个体混合得很好，处理分配也最不确定 [@problem_id:4830857]。这可以通过使用“重叠权重”来完成，其中个体的权重与$e(X)(1-e(X))$成正比。这个估计量通常在统计上更稳定，当ATE遥不可及时，它是一个有原则的折衷方案。在现代数据科学中，这种选择并非任意的；它可以是正式的、数据驱动的策略的一部分，以确保我们结论的可靠性 [@problem_id:5221154]。

### 一个统一的原则：[双重差分法](@entry_id:636293)

ATE/ATT区别的根本性质并不仅限于倾向性得分。它也出现在其他方法中，例如强大的[双重差分法](@entry_id:636293)（DiD）。想象一个政策变化——比如，一个新的教育项目——在一个州实施，而在邻近的州没有。为了找出该政策的效果，我们可以在政策变化前后测量两个州的结果（例如，考试分数） [@problem_id:4792558]。

DiD的逻辑很简单：我们计算未处理州的分数变化（“背景趋势”），然后从处理州的分数变化中减去它。剩下的差值就是我们对政策效应的估计。但这是什么效应呢？通过使用控制州来估计在没有该政策的情况下处理州*会发生什么*，我们明确地是在估计处理对接受了它的那个群体的影响。标准的DiD估计量识别的是ATT。它回答的问题是：“该政策如何影响了实施它的州？”，而不是“该政策将如何影响一个普通的州？”

### 结论：提出正确的问题就是一切

我们对这些应用的探索揭示了一个深刻而统一的主题。ATE和ATT之间的选择不是事后决定的一个技术细节。它处于科学事业的核心。它是一个关于我们谈论的是谁、我们想知道什么的选择。它决定了我们的假设，指导我们选择工具，并最终由现实的约束所塑造。

在理想世界中，我们可以测量对所有人的普适效应。但在我们这个复杂、凌乱而又迷人的世界里，智慧往往在于提出一个我们的数据能以诚实可靠的方式回答的更具体的问题。为一个定义明确的群体——处理组、重叠人群、政策对象——提供一个诚实的答案，比为所有人提供一个摇摆不定、不可靠的答案要有价值得多。这就是因果推断的艺术：不仅是找到答案，更是优雅而诚实地构建正确的问题。