## 引言
衡量任何行动（从医疗到公共政策）的真实影响，是科学中最根本的挑战之一。我们可以观察到已经发生的事情，但我们永远无法同时观察到在不同情况下*本可能发生*的事情——那条未选择的道路，即反事实，如同一个幽灵。这就是因果推断的核心问题。为了应对这一挑战，研究人员开发了强大的[潜在结果框架](@entry_id:636884)，它提供了一种语言来对这些平行现实进行推理。在此框架内，出现了两个关键问题，从而引出了两种不同的效应度量：平均[处理效应](@entry_id:636010)（ATE）和处理组平均[处理效应](@entry_id:636010)（ATT）。本文旨在揭开这两个核心概念的神秘面纱。在第一部分“原理与机制”中，我们将探讨ATE和ATT的理论基础，理解它们为何不同，以及[选择偏误](@entry_id:172119)和效应异质性等因素如何导致它们产生差异。随后，“应用与跨学科联系”部分将展示这种区别在现实世界中的具体表现，它如何影响我们对统计方法的选择，以及在流行病学、数据科学等领域中我们能够可靠回答的问题本身。

## 原理与机制

要理解任何行动——无论是服用药物、发起公共卫生运动，还是修改法律——的效果，就是要与一个根本性的幽灵搏斗。对于任何一个服药后感觉好转的人，我们永远无法知道如果他们没有服药，*本会发生什么*。另一条路是一个幻影，一个未曾发生的现实的幽灵。这就是因果推断的根本问题，要解决它，我们必须学会对这些幽灵进行推理。

### 因果关系的“点金石”：[潜在结果](@entry_id:753644)

统计学家和流行病学家为我们提供了一种强大的语言来讨论这些幻影世界，它被称为**潜在结果**（potential outcomes）框架。对于任何个体和任何处理，我们想象的并非只有一个结果，而是两个：

-   $Y(1)$: 如果个体接受处理，将会发生的结果。
-   $Y(0)$: 如果同一个体不接受处理，将会发生的结果。

对于任何一个人，我们永远只能看到其中一个——要么是$Y(1)$，要么是$Y(0)$，这取决于实际发生了什么。另一个则是**反事实**（counterfactual），一条未选择的道路。真正的个体因果效应是这两个潜在现实之间的差异：$\tau = Y(1) - Y(0)$。这就是我们的“点金石”——对任何单个个体而言，这是一个看不见、不可知的量，但它正是我们所说的“因果效应”的精髓 [@problem_id:4828368] [@problem_id:4501620]。

既然我们无法测量个[体效应](@entry_id:261475)，我们便将注意力转向大群体中的平均值。故事也正是在这里分岔，因为你提出的问题决定了你得到的平均值。

### 两种问题，两种效应：群体 vs. 处理组

关于一个处理的有效性，我们可能想回答两个主要问题，每个问题都对应着一个特定的因果量。

首先，我们可以问：如果我们将此处理给予群体中的*每一个人*，与不给任何人相比，平均效应会是什么？这个宏大的、覆盖整个群体的问题将我们引向**平均[处理效应](@entry_id:636010)（ATE）**。形式上，它是群体中所有个体因果效应的平均值：

$$ \text{ATE} = \mathbb{E}[Y(1) - Y(0)] $$

ATE是公共政策的“主力军”。它为适用于所有人的决策提供信息，例如是否批准一种新药普适性使用，或是否将某种疫苗纳入国家免疫计划 [@problem_id:5228022]。它关乎一种处理对“普通”人的潜在效果。

但还有第二个更聚焦的问题：对于*实际接受了处理的那群特定人群*，处理的效应是什么？这就是**处理组平均处理效应（ATT）**。它聚焦于实际接受了处理的子群体（我们将其处理状态记为$A=1$）。形式上：

$$ \text{ATT} = \mathbb{E}[Y(1) - Y(0) \mid A=1] $$

ATT对于评估现有项目至关重要。如果一家医院为高风险患者设立了特殊项目，ATT可以告诉他们该项目对这些特定患者的效果如何。它关心的不是所有人，而是对处理组的效应 [@problem_id:5228022]。为求完整，还有一个镜像概念，即**[控制组](@entry_id:188599)平均处理效应（ATC）**，它告诉我们处理对于那些*未*接受处理的人群的效应，如果我们要考虑扩大项目范围，这是一个关键的量 [@problem_id:4845620]。

### 当世界碰撞：为何ATE与ATT会产生差异

乍一看，你可能会想，为什么处理组的平均效应（ATT）会与整个群体的平均效应（ATE）有任何不同呢？毕竟，他们不都是人吗？

答案在于科学中最美妙的思想之一：**随机对照试验（RCT）**。在RCT中，我们用抛硬币（或其数字等价物）的方式来决定谁接受处理。这种随机化行为如同魔法。它能确保在平均意义上，接受处理的组是未接受处理组的完美镜像。他们有着相同的平均年龄、相同的风险因素分布，一切都相同。在这个纯粹的随机化世界里，处理组只是整个群体的一个随机切片。因此，该切片中的平均效应与整体的平均效应相同。在理想的RCT中，一个美妙的简化出现了 [@problem_id:4828368]：

$$ \text{ATE} = \text{ATT} = \text{ATC} $$

但在RCT严格控制的世界之外，在观察性数据的“野外”，生活并非随机。人们或者他们的医生会*选择*处理方法。而这些选择很少是随机的。这就是**[选择偏误](@entry_id:172119)**（selection bias）的根源：选择接受处理的群体往往与未接受处理的群体存在系统性差异。

让我们把这具体化。想象一个城市正在评估一项自愿的无烟工作场所政策 [@problem_id:4566518]。这项政策对每个人的效果并不相同。一个在烟雾弥漫的工厂里的高暴露工人每年可能因此减少3天病假（$\tau_H = -3$），而一个低暴露的办公室职员可能只减少半天病假（$\tau_L = -0.5$）。

现在，假设自愿采纳该政策的公司主要是工业工厂。他们的劳动力中，比如有60%是高暴露工人。在这些采纳政策的公司中，其效应——即ATT——将是：

$$ \text{ATT} = (0.60 \times -3) + (0.40 \times -0.5) = -1.8 - 0.2 = -2.0 \text{ 天病假} $$

但如果该市考虑强制性地在全市范围内推行呢？全市的劳动力构成是不同的，也许只有30%是高暴露工人。对整个城市的效应——即ATE——将是：

$$ \text{ATE} = (0.30 \times -3) + (0.70 \times -0.5) = -0.9 - 0.35 = -1.25 \text{ 天病假} $$

看看这个差异！在采纳者中观察到的效应（ATT = -2.0天）显著大于全民强制推行所能看到的效应（ATE = -1.25天）。为什么？因为最能从该政策中获益的人群最有可能获得它。这不是一个错误，而是现实的反映。ATE和ATT只是在回答两个不同但都有效的问题。将一个自愿项目的成功经验外推到预测一个强制性项目的结果，可能是极其危险且具有误导性的。同样的逻辑也适用于医生优先为高风险患者开具更强效的降压药；在这些接受治疗的患者身上看到的益处（ATT）很可能大于如果将该药给予所有人所能获得的平均益处（ATE） [@problem_id:4575721]。

### 异质性的微妙引擎：为何“恒定”效应并非恒定

故事变得更加微妙和迷人。如果一种药物的生物学机制对每个人都相同呢？例如，一种预防心力衰竭的新药能将个体的基线风险降低一个固定的*比例*，比如降低一半。那么，如果效应是“恒定”的，ATE和ATT必然相同吗？

答案出人意料：并非如此。这揭示了生物学与统计学之间一种美妙的相互作用 [@problem_id:5228019]。

设个体心力衰竭的基线风险为$p_0$。该药物将此风险降低至$p_1 = 0.5 \times p_0$。我们测量的因果效应（ATE和ATT）通常是在*加性*尺度上——即绝对风险差。对于个体而言，这个差异是：

$$ \text{Effect} = p_1 - p_0 = 0.5 p_0 - p_0 = -0.5 p_0 $$

这个方程揭示了一个道理。即使[乘性](@entry_id:187940)效应是恒定的50%降幅，*绝对获益*却与个体的基线风险成正比。一个基线风险为20%的高风险患者，其风险降低了10个百分点。而一个基线风险为2%的低风险患者，其风险仅降低了1个百分点。

现在，将此与临床实践联系起来。医生并非随机治疗患者，他们会将强效药物给予病情更重、风险更高的个体。这意味着接受治疗的群体（$A=1$）的平均基线风险将高于一般人群。由于他们的基线风险更高，他们的平均*绝对获益*也将更大。因此，ATT的量值将大于ATE的量值。这种差异的出现并非源于某种统计技巧，而是恒定的生物学效应与基于风险的、合乎情理的临床决策相互作用的直接结果。

### 探寻因果真相：驯服偏误

理解ATE和ATT之间的差异不仅仅是学术操练，它决定了我们如何分析数据以及可以得出何种结论。在观察性数据的真实世界里，我们必须考虑导致ATE和ATT分道扬镳的[选择偏误](@entry_id:172119)。

其中最强大的工具之一是**[有向无环图](@entry_id:164045)（DAG）**，它如同我们因果假设的视觉地图 [@problem_id:4959972]。通过在变量之间绘制箭头，我们可以识别偏误的来源。例如，一个基线患者特征，如年龄（$L$），既影响治疗决策（$A$）又影响结果（$Y$），这就产生了一条**混杂**的“后门路径”：$A \leftarrow L \rightarrow Y$。为了得到有效的因果估计，我们必须在统计上对$L$进行调整以阻断这条路径。

DAG还能警示我们注意隐藏的陷阱。我们绝不能调整位于因果路径上的变量。例如，如果一种药物（$A$）能降低血压（$M$），而血压降低又可以预防中风（$Y$），那么变量$M$就是一个**中介变量**。调整它会阻断我们想要测量的效应本身。更奇怪的是，DAG显示，有时调整某个变量反而会*产生*偏误。如果处理和一个未测量的遗传因素（$U$）都影响患者是否完成随访（$S$），那么$S$就是一个**对撞因子**。调整$S$（例如，只分析有完美随访记录的患者）会在处理和遗传因素之间打开一条[伪路径](@entry_id:168255)，从而使结果产生偏误。

这种理论上的理解也对我们能更可靠地估计哪种效应产生了实际影响。
- 要估计**ATE**，我们需要知道处理对所有类型人群的效应。这要求对于每一种类型的人（例如，年老的、年轻的、患病的、健康的），都有人接受了处理，也有人未接受处理。这是一个被称为**正性**（positivity）的强假设 [@problem_id:4845608]。如果一种新的、有风险的药物几乎从未给予体弱多病的老年患者，我们就根本没有数据去了解它对这些患者的效应会是怎样。试图估计ATE将迫使我们进行大胆的猜测（外推），使我们的估计变得脆弱且依赖于模型 [@problem_-id:4803331]。

- 然而，要估计**ATT**，我们的任务就简单多了。我们感兴趣的群体是处理组。我们只需要为*每一类接受了处理的人*，找到可比较的*未接受处理的人*。我们不需要知道处理对那些与接受处理者完全不同的人群的效应。这种放宽了的正性要求通常使得ATT在观察性研究中成为一个更稳健、更可信的估计目标 [@problem_id:4803331]。

因此，ATE与ATT之间的区别并非一个简单的技术细节。它深刻地反映了我们提出的问题、人类选择的现实、生物效应的微妙之处，以及我们认知能力的实际局限。它迫使我们不仅要在方法上做到精确，更要在我们对世界的好奇心本身上做到精确。

