## 应用与跨学科联系

我们花了一些时间来熟悉宇宙戏剧上演的舞台——那个优雅而又有些奇特的[共动坐标](@entry_id:271238)世界。通过剔除宇宙的均匀膨胀，我们找到了一个方法，让背景保持静止，而演员——星系和[星系团](@entry_id:160919)——则在移动和成长。但是，没有戏剧的舞台是空洞的。现在，我们将看到我们能在这些虚拟宇宙中编排出何等奇妙的表演。这些模拟远不止是精美的计算机图形；它们是我们宇宙学的实验室，是我们检验对[引力](@entry_id:175476)、物质以及宇宙宏大历史理解的熔炉。

### 作为工程师的宇宙学家：构建虚拟宇宙

在我们能够观察宇宙演化之前，我们必须首先构建它。这是一项宇宙工程学的任务，充满了权衡和巧妙的妥协。假设我们想要研究从最小的矮星系到最大的[星系团](@entry_id:160919)的[结构形成](@entry_id:158241)。两个基本问题立刻出现：我们应该模拟多大体积的空间，以及用多大的细节？

如果我们选择一个小盒子，我们或许能获得极高的分辨率，能够看到单个星系内部精细的子结构。但我们将会错过宇宙网的宏伟、广阔的波澜，即那些在最大尺度上定义宇宙的长丝状结构和巨大的空洞。相反，一个巨大的盒子虽然能完美地捕捉到这幅宇宙织锦，但可能因为分辨率太粗而无法解析那些作为万物基石的、不起眼的低质量晕。这是一个根本性的权衡。为了解析一个质量为 $M$ 的[暗物质晕](@entry_id:147523)，我们需要用足够数量的模拟粒子来代表它，比如说100个。这对我们单个粒子的质量设定了严格的上限。但是，我们能负担得起的粒子总数 $N$ 受到[计算机内存](@entry_id:170089)和处理能力的限制。对于固定的 $N$，一个更大的盒子意味着每个粒子必须代表更多的质量，这使得解析小天体变得更加困难。因此，[宇宙学模拟](@entry_id:747928)的设计是一项精细的平衡工作，是在捕捉宇宙整体与解析其组成部分之间的折中[@problem_id:3507116]。

一旦我们确定了盒子的大小和粒子的数量，我们又面临另一个挑战：计算[引力](@entry_id:175476)。数十亿个粒子相互吸引，对每一对相互作用进行直接、暴力的计算，在计算上是不可能的。在这里，我们周期性共动盒子的魔力发挥了作用。因为“空间”是周期性的，密度场可以被描述为简单波的总和，就像一个音乐和弦是纯音的总和一样。利用一种名为[快速傅里叶变换](@entry_id:143432)（FFT）的惊人高效的算法，我们可以将块状的[粒子分布](@entry_id:158657)分解为其组成波。

在这个“傅里叶空间”中，复杂的[引力](@entry_id:175476)微积分变成了简单的代数。控制[引力势](@entry_id:160378)的[泊松方程](@entry_id:143763)，对于每个波或模式 $\boldsymbol{k}$，都转化为一个代数关系。然而，这里有一个绝妙的微妙之处。如果我们天真地从总密度计算[引力](@entry_id:175476)，宇宙会倾向于自身坍缩。但我们从对[FLRW度规](@entry_id:265365)的研究中得知，均匀的背景密度并不会导致局部坍缩；它的[引力](@entry_id:175476)效应已经由宇宙膨胀本身解释了。驱动[结构形成](@entry_id:158241)的[引力](@entry_id:175476)仅仅来自这个平滑背景之上的*涨落*——即团块和凸起。因此，在求解[引力](@entry_id:175476)之前，我们必须从源项中减去平均密度。这样就只剩下[密度对比](@entry_id:157948) $\delta$。在傅里叶空间中，这带来一个绝妙的结果：对应于无限波长（$\boldsymbol{k}=\boldsymbol{0}$）的模式，即代表平均密度的模式，其值恰好为零。这优雅地规避了一场除以零的灾难，并确保我们的模拟正确地模拟了膨胀宇宙中结构的增长。因此，我们模拟的引擎是物理学（理解只有[密度涨落](@entry_id:143540)才重要）和计算独创性（FFT的力量）的美妙结合[@problem_id:3494522]。

### 作为自然学家的宇宙学家：编目宇宙动物园

在运行了数十亿模拟年的模拟之后，我们得到了一幅虚拟宇宙的快照——一份巨大的粒子位置和速度目录。现在，宇宙自然学家的工作开始了。我们的任务是探索这片数字荒野，并对其中形成的生物进行编目：暗物质晕。

我们能做的最基本的测量是一次普查。在给定体积内，存在多少个给定质量的晕？这个量，即*晕[微分](@entry_id:158718)[质量函数](@entry_id:158970)* $n(M,z)$，是我们[宇宙学模型](@entry_id:203562)的一个基本预测。它告诉我们在任何宇宙时期，不同大小结构的丰度。通过用共动单位——单位共动体积内的单位[质量数](@entry_id:142580)量——来定义这个函数，我们可以有意义地比较不同[红移](@entry_id:159945)处的晕群，排除了宇宙在过去密度更高这一简单事实的影响[@problem_id:3496591]。然后，我们模拟的结果可以直接与望远镜观测到的[星系团](@entry_id:160919)数量进行比较，为我们的理论提供有力的检验。

但简单的计数是不够的。就像生物学家解剖一个有机体一样，我们想要了解这些晕的解剖结构。寻找晕的一个初步工具是“朋友的朋友”（FoF）算法，它将任何距离小于某个小[连接长度](@entry_id:747697)的粒子连接在一起。这种方法能有效地识别孤立晕的整体边界。然而，它有一个关键的盲点。当一个小晕落入一个更大的晕，成为一个“子晕”时，[FoF算法](@entry_id:749600)常常无法将其区分出来。因为主晕的背景密度很高，有一条不间断的“朋友”链将子晕与其宿主连接起来，算法只看到一个单一的、合并了的物体。

为了看到更精细的结构，我们需要更复杂的工具，这些工具常常借鉴自[网络科学](@entry_id:139925)等领域。我们可以将一个大晕内的粒子视为一个复杂的网络。通过识别这个网络中更密集、更紧密结合的“社群”，我们可以成功地发掘出更简单的FoF方法所遗漏的子晕[@problem_id:3474750]。这揭示了一个更丰富、更具层次性的宇宙网，其中大晕并非光滑的整体，而是充满了它们所吞噬的更小结构的残余核心。

这引出了一个深刻的物理问题：一个粒子成为晕的一部分究竟意味着什么？它只是暂时路过，还是在[引力](@entry_id:175476)上被长期束缚？为了回答这个问题，我们必须确定一个粒子是否具有足够的动能来逃脱晕的[引力](@entry_id:175476)束缚。但动能取决于速度，而在一个膨胀的宇宙中，速度是一个很滑的概念。一个粒子的总物理速度 $\mathbf{v}$ 是全局哈勃流（$H\mathbf{r}$）与其相对于该流的“本动”速度 $\mathbf{u}$ 的总和。哈勃流与一个粒子是否被束缚于一个*局部*的超密度区无关。因此，我们必须使用[本动速度](@entry_id:157964)。此外，整个晕可能正以一个整体[本动速度](@entry_id:157964) $\mathbf{u}_{\text{CM}}$ 在共动网格中运动。这种整体运动并不能帮助粒子逃离晕，就像坐在一辆移动的火车上并不能帮助你跳下火车一样。对于逃逸计算唯一重要的是粒子相对于晕质心的[本动速度](@entry_id:157964)。因此，比动能为 $T_i = \frac{1}{2} |\mathbf{u}_i - \mathbf{u}_{\text{CM}}|^2$。通过将此与[引力势能](@entry_id:269038)进行比较，我们可以执行一个“解绑”程序，清理我们的晕目录，只包括那些真正物理上属于该结构的粒子[@problem_id:3480768]。

### 作为创造者的宇宙学家：添加光与生命

到目前为止，我们的宇宙是黑暗而无生命的，只受作用于暗物质的[引力](@entry_id:175476)支配。但我们观察到的宇宙却充满了来自恒星和星系的光芒。为了弥合这一差距，我们必须在模拟中添加更多的物理过程。我们不可能模拟每一颗恒星，所以我们发明了“亚网格配方”，告诉我们恒星应该在何时何地形成。

一个常见的配方可能是，当一个区域的气体密度超过某个阈值时，就触发恒星形成。在这里，[坐标系](@entry_id:156346)的选择再次产生深远的影响。如果我们将这个阈值设定为一个固定的*共动*数密度，比如说 $n_{\text{th,com}} = 0.1\, \mathrm{cm}^{-3}$，这对*物理*密度意味着什么？关系是 $n_{\text{phys}} = (1+z)^3 n_{\text{com}}$。在红移 $z=9$ 时，这意味着形成恒星所需的物理密度比今天高出 $(1+9)^3 = 1000$ 倍。我们在[共动坐标系](@entry_id:266800)中的简单选择意味着，在[早期宇宙](@entry_id:160168)中，恒星只能在极其致密、紧凑的环境中形成。这对恒星形成的物理过程具有戏剧性的影响，可能影响[第一代恒星](@entry_id:158491)的质量和第一批星系的性质[@problem_id:3491874]。

另一个关键因素是辐射。[第一代恒星](@entry_id:158491)和类星体向宇宙倾注了高能[光子](@entry_id:145192)，将充满空间的氢原子中的电子剥离，这个过程称为[再电离](@entry_id:158356)。模拟这个过程要求我们不仅要追踪物质，还要追踪光本身。我们可以扩展我们的模拟框架来求解[辐射转移方程](@entry_id:160254)，在我们的网格上模拟辐射能量和通量。就像处理粒子一样，我们必须正确处理[周期性边界条件](@entry_id:147809)：一个从盒子一边射出的[光子](@entry_id:145192)必须从另一边重新进入。而且，就像处理[引力](@entry_id:175476)一样，我们常常需要模拟一个由太遥远或太众多而无法单独解析的源产生的均匀背景辐射场。这是通过计算盒子中所有源的平均发射率，并将其作为一个均匀的背景源加回来实现的，这项技术使我们能够捕捉[模拟宇宙](@entry_id:754872)中所有发光天体的集体影响[@problem_id:3507612]。

### 作为探索者的宇宙学家：开辟新领域

或许这些模拟最激动人心的应用是它们作为探索工具的角色。它们不仅仅是为了证实我们已经相信的东西，而是为了冒险进入未知。如果[引力](@entry_id:175476)在宇宙尺度上的行为与爱因斯坦的描述不完全一致怎么办？我们可以在模拟中编码一个新的[引力](@entry_id:175476)定律——或许是一个涉及额外[标量场](@entry_id:151443)以[修正引力](@entry_id:158859)的定律[@problem_id:3507178]。然后我们运行模拟，看看这种新物理会创造出什么样的宇宙。它形成的结构是否像我们自己的宇宙？还是会产生截然不同的东西？通过将结果与真实观测进行比较，我们可以对广义相对论的替代理论施加有力的约束。

这就引出了最后，也是最关键的联系：与观测的联系。一位使用望远镜的天文学家看到的不是宇宙在某一时刻的静态三维立方体。他们看到的是一个“过去光锥”——一种越往远处看，时间也越往回溯的景象。然而，我们的模拟产生的是一系列“等时”快照，每一张都代表了整个盒子在某一瞬间的状态。

为了进行直接比较，我们必须教会我们的模拟像望远镜一样“看”世界。我们可以从虚拟观测者位于盒子中心开始，向外追踪光线。当光线在距离上向外传播时，它也在时间上向后追溯。我们可以将我们的快照序列切片，并将每一片分配给相应的距离和时间壳层。通过堆叠这些壳层，我们可以从离散的模拟快照中组装出一个连续的光锥。然后，通过计算这些介入的质量分布如何弯曲光路，我们可以创建引力透镜的合成图像[@problem_id:3483291]。或者，我们可以在光锥中填入来自[中性氢](@entry_id:174271)的预期信号，从而创建一个来自[第一代恒星](@entry_id:158491)黎明时期的[21厘米信号](@entry_id:159055)的模拟数据立方体[@problem_id:3488968]。

这最后一步是我们所有努力的顶点。它将模拟的抽象数据转化为丰富的、可与真实世界望远镜涌入的数据进行一对一比较的综合观测。正是通过这种理论、计算和观测的强大结合，[共动坐标](@entry_id:271238)模拟这个看似简单的概念，成为了我们理解宇宙起源、演化及最终命运的最深刻的工具之一。