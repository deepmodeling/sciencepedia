## 引言
在考虑物理空间时，测量距离似乎很简单，但我们如何量化抽象概念之间的“距离”，例如思想、患者档案或[基因序列](@entry_id:191077)之间的距离？这个基本问题对所有科学学科都构成了重大挑战。解决方案在于数学工具箱中的**距离度量**，这是一套为抽象空间设计的多功能标尺。本文对这一关键概念进行了全面概述。第一章“原理与机制”确立了定义距离度量的形式化规则，并探讨了从我们熟悉的[欧几里得距离](@entry_id:143990)到余弦相似度和[瓦瑟斯坦距离](@entry_id:147338)等更专业度量的多种关键方法。在此基础上，“应用与跨学科联系”一章展示了如何创造性地应用这些度量，在医学、生态学和[粒子物理学](@entry_id:145253)等不同领域中获得深刻的见解，揭示了距离作为现代科学探究基石的地位。

## 原理与机制

从 New York 到 Los Angeles 有多远？这个问题似乎很简单。你可能会引用飞机飞行的距离——在弯曲的地球上的直线。或者你可能指的是驾车距离，一条受限于道路的蜿蜒路径。我们立刻发现，即使对于物理旅行，“距离”也不是一个单一的、神授的数字。它取决于游戏规则——你移动所处的空间以及你被允许采取的路径。

现在，如果我们问一个不同的问题呢？“正义”这个概念与“仁慈”这个概念有多“远”？两份临床病历、两个星系，或者你看到猫和狗时大脑中的神经活动模式有多大不同？要回答这些问题，我们需要推广我们对距离的概念。我们需要一把不仅能测量物理空间，还能测量思想、形状和模式等抽象空间的尺子。这把尺子就是**距离度量**。它是所有科学中最基本、最通用的工具之一。

### 游戏规则

让我们从已知的东西开始。在学校里，我们学习了熟悉的**欧几里得距离**，即“乌鸦飞行”式的直线距离。对于平面上的两个点 $(x_1, y_1)$ 和 $(x_2, y_2)$，它由[勾股定理](@entry_id:264352)给出：$d = \sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}$。这个概念可以轻松扩展到任意维度。

但如果你不是乌鸦，而是曼哈顿的出租车司机呢？你不能飞越建筑物；你被限制在街道网格中。你行驶的距离是东西向的街区数加上南北向的街区数。这是一种完全有效且通常更有用的距离类型，称为**[曼哈顿距离](@entry_id:141126)**或**$\ell_1$距离**。如果我们有两个由向量 $x$ 和 $y$ 表示的点，[欧几里得距离](@entry_id:143990)是它们差的 $\ell_2$ 范数，即 $\|x-y\|_2$，而[曼哈顿距离](@entry_id:141126)是 $\ell_1$ 范数，即 $\|x-y\|_1$。

这种选择并不仅仅是学术上的。想象一个简单的[机器学习算法](@entry_id:751585)，试图通过查看新数据点的“k-近邻”（k-NN）来预测其值。“最近”的定义本身就取决于我们选择的度量。使用欧几里得距离可能会识别出一组邻居，而对单一维度上的巨大差异不那么敏感的[曼哈顿距离](@entry_id:141126)，则可能会识别出完全不同的一组邻居，从而导致不同的预测结果 [@problem_id:3132592]。做出“正确”的选择取决于我们数据的性质。

那么，是什么让任何一个公式成为合法的“距离”呢？数学家们将其归结为四个简单直观的规则。对于任意点 $x$、$y$ 和 $z$，距离函数 $d(x,y)$ 必须满足：

1.  **非负性**：$d(x,y) \ge 0$。距离不能是负数。
2.  **不可辨识者的同一性**：$d(x,y) = 0$ 当且仅当 $x=y$。只有当两个点相同时，距离才为零。
3.  **对称性**：$d(x,y) = d(y,x)$。从 A 到 B 的距离与从 B 到 A 的距离相同。
4.  **[三角不等式](@entry_id:143750)**：$d(x,z) \le d(x,y) + d(y,z)$。直达路径总是最短的。中途停留不会使你的旅程变短。

任何遵守这四条规则的函数都称为**度量**。它就是这个俱乐部的一员。令人惊讶的是，一些非常流行和有用的“不相似性”度量实际上并不是真正的度量，因为它们不满足最后一条规则。例如，在化学和数据科学中，我们经常使用**余弦相似度**来比较向量。相应的“余[弦距离](@entry_id:170189)”可以定义为 $d_{\cos}(x,y) = 1 - s_{\cos}(x,y)$。然而，有可能找到三个向量，使得该度量违[反三角不等式](@entry_id:146102) [@problem_id:3869930]。这是一个关键的发现，因为许多用于搜索大型数据库的高效算法都假设[三角不等式](@entry_id:143750)成立，以便安全地修剪搜索空间。如果不成立，这些算法可能会给出错误的结果。幸运的是，我们通常可以找到一个*是*度量的近亲。对于余弦相似度，真正的度量是**角距离**——向量之间的实际角度，$d_{\theta}(x,y) = \arccos(s_{\cos}(x,y))$。这个函数遵守三角不等式并保持邻居排序，使其成为一个安全可靠的选择 [@problem_id:3869930]。

### 选对尺子，用对地方

当我们看到选择正确的距离度量如何帮助我们分离出有意义的信息并忽略无意义的信息时，距离度量的威力就显现出来了。一个精心挑选的度量就像一个过滤器，使我们的比较对噪声和无关变动具有鲁棒性。

#### 长度不变性：比较文档

想象一下比较两份临床记录。一份是简明的摘要：“患者报告胸痛。”另一份是来自模板系统的冗长记录，内容相同但多处重复。使用像**[TF-IDF](@entry_id:634366)**这样的标准[文本表示](@entry_id:635254)方法，这些记录的向量在“词空间”这个高维空间中会指向大致相同的方向，但较长记录的向量会有大得多的模（或长度）。

如果我们使用欧几里得距离，这两份记录会因为一份更长而显得相距甚远。这显然不是我们想要的；它们的主题是相同的。这里的英雄是**余弦相似度**。通过测量向量之间的夹角余弦，我们完全忽略了它们的模。由于我们两份记录的向量指向相同的方向，它们的余弦相似度为 1（最大相似度），从而正确地识别出它们具有相同的内容 [@problem_id:5227848]。事实上，按余弦相似度对文档进行排序在数学上等同于首先将所有文档[向量归一化](@entry_id:149602)为单位长度（将它们投影到一个超球面上），然后使用[欧几里得距离](@entry_id:143990) [@problem_id:5227848]。这种归一化是处理[高维数据](@entry_id:138874)的关键技巧，因为它有助于缓解“枢纽点现象”（hubness）等问题，即少数点异常地成为许多其他点的最近邻。

#### 尺度与偏移不变性：发现真实信号

不变性原则是一个贯穿始终的主题。考虑分析[单细胞RNA测序](@entry_id:142269)数据。我们通常首先使用[主成分分析](@entry_id:145395)（PCA）来降低数据维度。前几个主成分（PC）捕获了大部分方差，因此它们得分的[数值范围](@entry_id:752817)相比于后面的主成分要大得多。如果我们在PC空间中计算欧几里得距离，该距离将几乎完全由前几个PC主导 [@problem_id:2429795]。这是我们想要的吗？也许不是。我们可能更感兴趣的是一个细胞在多个成分上的整体*模式*，而不仅仅是它在主要变异轴上的位置。

在这里，**[相关距离](@entry_id:634939)**派上了用场。它在比较之前有效地对每个细胞的PC得分向量进行标准化，问的是：“细胞A和细胞B的得分在不同成分上是否倾向于一同上升或下降，而不管它们的绝对值如何？”这关注的是轮廓形状的相似性，而不是其大小。

我们可以更进一步。想象一下试图通过红外（IR）光谱来识别一种化合物。根据[比尔-朗伯定律](@entry_id:192870)，测得的[吸收光谱](@entry_id:144611)与该化合物的浓度成正比。此外，[仪器伪影](@entry_id:185069)可能会给整个光谱增加一个恒定的基线偏移。我们的查询光谱可能是 $\mathbf{x} = a\mathbf{s} + b\mathbf{1}$，其中 $\mathbf{s}$ 是真实的纯信号，$a$ 是一个未知的缩放因子（来自浓度），$b$ 是一个未知的偏移。我们想将其与一个库光谱 $\mathbf{y} \approx \mathbf{s}$ 进行匹配。

-   **欧几里得距离**会被 $a$ 和 $b$ 两者欺骗。
-   **余弦相似度**对缩放（$a$）具有不变性，但会被偏移（$b$）欺骗。
-   **皮尔逊相关系数**是冠军。通过在计算余弦相似度之前先从每个光谱向量中减去均值，它对缩放因子 $a$ 和偏移 $b$ *两者*都具有不变性 [@problem_id:3692817]。它完美地从干扰变化中分离出光谱指纹的“形状”，使其成为此项任务的理想度量。

### 超越平面空间：扭曲的视角与巧妙的旅程

我们目前讨论的度量，如欧几里得和[曼哈顿距离](@entry_id:141126)，都在一个“平坦”的空间中运作，其中所有维度都被平等和独立地对待。但如果空间本身是扭曲的，或者距离根本与坐标无关呢？

#### 数据的视角：马氏距离

想象一下来自生物学实验的一[团数](@entry_id:272714)据点。由于测量特征之间存在潜在的相关性，这[团数](@entry_id:272714)据可能不是一个球体，而是一个倾斜、拉长的椭球体。标准的[欧几里得距离](@entry_id:143990)以各向同性的圆形来测量距离，它不尊重这种结构。一个在[欧几里得距离](@entry_id:143990)上很远的点，从数据云分布的角度来看，实际上可能相当典型。

这就是**马氏距离**（Mahalanobis distance）的用武之地。它是一种绝妙的距离测量方法，考虑了数据的相关性和不同方差 [@problem_id:4136549]。你可以把它想象成首先对坐标系应用一种“白化”变换——一种拉伸和旋转——将椭球形的数据云变成一个完美的球体。然后，在这个新的、变换后的空间中，我们只需测量我们熟悉的欧几里得距离即可 [@problem_id:3749571]。马氏距离是通过数据自身协方差结构的“眼睛”所看到的距离。它告诉你一个点沿着与数据主变异方向对齐的轴，距离数据云中心有多少个标准差。

#### 搬土的成本：[瓦瑟斯坦距离](@entry_id:147338)

如果我们的数据点根本不是点，而是整个分布，比如[直方图](@entry_id:178776)呢？假设我们有两个直方图，显示了一个物种沿海岸线的[空间分布](@entry_id:188271)，并被划分到有序的区间（bin）中。[欧几里得距离](@entry_id:143990)会逐个区间比较这些[直方图](@entry_id:178776)。如果一个分布只是另一个分布的微小位移，许多区间会不匹配，欧几里得距离可能会很大。但这很傻，因为它忽略了区间2就在区间3旁边的事实。

一个更智能的度量是**[推土机距离](@entry_id:147338)（EMD）**，也称为**[瓦瑟斯坦距离](@entry_id:147338)**。它提出了一个优美而物理的问题：“如果第一个[直方图](@entry_id:178776)是一堆土，要把它移动成第二个[直方图](@entry_id:178776)的样子，所需的最小*功*是多少？”功被定义为质量（区间中的概率）乘以移动的距离。这个度量天生就理解了区间之间的“地面距离”（ground distance）。它能正确地判断整个分布的小位移是低成本的小变化，而将质量从海岸线的一端移动到另一端则是高成本的大变化 [@problem_id:4136549]。它是比较一个具有自身内在几何结构的空间上的分布的完美度量。

#### 路径，而非坐标：图距离

最后，如果我们根本没有坐标怎么办？考虑一个由相互作用的蛋白质组成的网络，或者一个由共同遗传原因联系起来的表型图。我们唯一的信息是谁与谁相连。我们如何定义这样一个网络中两个节点之间的距离？

一个优雅的方法是想象一个随机游走者沿着图的边从一个节点跳到另一个节点。两个节点（比如 $P_i$ 和 $P_j$）之间的“距离”可以定义为游走者首次从 $P_i$ 走到 $P_j$ 所需的平均步数。这被称为**首达时间**（hitting time）。一个更对称的度量是**往返时间**（commute time），即从 $P_i$ 到 $P_j$ 再返回到 $P_i$ 的时间 [@problem_id:4350096]。这个距离不是基于一个[环境空间](@entry_id:184743)，而是基于网络本身的连通性和拓扑结构。那些“近”的节点是通过许多短的、高概率的[路径连接](@entry_id:149343)起来的，使它们成为同一社群或功能模块的一部分。

从曼哈顿的街道到蛋白质的扭曲 [@problem_id:2098890]，再到脑部扫描仪记录的人类思想的比较 [@problem_id:4148262]，距离的概念是一条金线。一个度量不仅仅是一个公式；它是一个精心制作的镜头，我们通过它来观察世界，旨在凸显我们认为重要的东西，并看透噪音。科学的艺术往往就是选择或发明正确镜头的艺术。

