## 引言
任何正整数都可以写成四个整数平方之和的论断是数论中的一个里程碑式结果，被称为[拉格朗日](@article_id:373322)[四平方和](@article_id:382092)定理。这个事实虽然陈述简单，却引出了深刻的问题：为什么数字四如此特殊？这仅仅是一个数字上的巧合，还是暗示了更深层次的数学真理？本文旨在填补这一空白，不仅仅是简单地陈述该定理，而是探索其丰富的理论基础。读者将踏上一段旅程，探索使该定理成立的原理和机制，通过代数、分析和几何的视角来审视它。在此之后，我们将通过考察其多样的应用和跨学科联系，来探索该定理深远的影响，揭示这个源于纯粹数学的概念如何为物理学和概率论提供强大的工具。

## 原理与机制

在得知每个整数都可以写成四个平方数之和后，一个好奇的头脑会立刻涌现出许多问题。为什么是四个？为什么不是三个或五个？对于每个数，表示方法是唯一的，还是有很多种？如果有很多种，它们之间有规律吗？最重要的是，这*为什么*是真的？这仅仅是数字的一个奇特巧合，还是某种更深层事物的迹象，一个隐藏在幕后的更深邃结构的影子？

让我们踏上回答这些问题的旅程。我们不只陈述事实，而是试图理解其背后的机制，看看品味各异的数学家们——代数学家、分析学家、几何学家——是如何为这个卓越的定理找到各自优美的解释的。

### 神奇的数字四

首先，为什么四是那个神奇的数字？让我们看看为什么更少的平方数无法完成任务。

用**一个平方数**，很明显我们只能表示完全平方数：$0, 1, 4, 9, \dots$。大多数数字都被漏掉了。

用**两个平方数**，我们做得好多了。我们可以得到 $2=1^2+1^2$, $5=1^2+2^2$, $8=2^2+2^2$ 等等。但我们仍然会错过很多数字，比如 $3, 6, 7, 11$。关于哪些数可以写成两个平方数之和，有一个优美而精确的规则（由 Pierre de Fermat 发现），但底线是，两个是不够的。

那么**三个平方数**呢？我们更接近了！现在我们可以表示 $3=1^2+1^2+1^2$ 和 $6=2^2+1^2+1^2$。看起来我们可能就要成功了。但一个简单而优雅的论证表明，我们总是会差一点。让我们不看数字的全貌，只看它们除以8的余数——我们称这种技术为**模算术**。

任何整数的平方，当你用8去除它时，余数只可能是0、1或4。试试看：$0^2=0$, $1^2=1$, $2^2=4$, $3^2=9 \equiv 1 \pmod{8}$, $4^2=16 \equiv 0 \pmod{8}$，以此类推。这个模式会重复。所以，唯一可能的余数是 $0, 1, 4$。

现在，试着将这三个余数中的任意三个相加。
$1+1+1 = 3$
$1+1+0 = 2$
$4+1+0 = 5$
$4+4+1 = 9 \equiv 1 \pmod{8}$
...等等。
无论你如何组合集合 $\{0, 1, 4\}$ 中的三个数，你都*永远*得不到和为7。这意味着任何除以8余7的整数（如7、15、23、31……）永远不能写成三个平方数之和。[@problem_id:3007984] 这个单一的、不可逾越的“同余障碍”证明了三个平方数不足以表示每个整数。从这个角度看，[二次型](@article_id:314990) $Q(x,y,z)=x^2+y^2+z^2$ 不是**普遍的**。[@problem_id:3016911]

然后，如同奇迹一般，加上**第四个平方数**就完全解决了问题。每一个非负整数，无一例外，都可以写成四个平方数之和。拉格朗日定理告诉我们，没有缺口，没有例外。数字4是特殊的，因为它是使得此类[同余](@article_id:336894)障碍不存在的最小平方数个数。[@problem_id:3007984] 这就是我们在[华林问题](@article_id:365161)的语境下所说的 $g(2)=4$ 的意思。[@problem_id:3007960]

### 存在性的保证，而非唯一性

所以，表示为四个平方数之和总是可能的。但这种表示是唯一的吗？让我们看一个简单的例子，比如 $n=2$。我们可以写成 $1^2+1^2+0^2+0^2$。这对应于整数的四元组 $(1,1,0,0)$。但我们也可以写成 $(-1)^2+1^2+0^2+0^2$，这得到元组 $(-1,1,0,0)$。或者我们可以改变顺序，得到 $(1,0,1,0)$。

显然，对于一个数 $n$，可以有很多不同的元组 $(a,b,c,d)$ 满足 $n = a^2+b^2+c^2+d^2$。这意味着将整数 $n$ 映射到“它的”[四平方和](@article_id:382092)表示的规则不是一个数学**函数**，因为一个函数对每个输入必须给出单一、唯一的输出。[@problem_id:1361867] 该定理保证了存在性，而非唯一性。这就引出了一个迷人的新问题：如果有多种方式，*有多少*种呢？

### 计数表示方法：意想不到的秩序

起初，为一个整数 $n$ 计算表示方法的数量似乎是一件杂乱无章的事情。$n=1$ 的表示数是 8（来自 $(\pm 1, 0, 0, 0)$ 及其[排列](@article_id:296886)）。对于 $n=2$，是 24。对于 $n=3$，是 32。这个序列有什么规律可循吗？

Carl Gustav Jacob Jacobi 发现的答案令人叹为观止。我们称之为 $r_4(n)$ 的表示数，一点也不混乱。它由一个简单、优雅的算术规则所支配。雅可比[四平方和](@article_id:382092)定理指出：
$$
r_4(n) = 8 \sum_{\substack{d|n \\ 4 \nmid d}} d
$$
让我们来解读这个公式。它告诉我们，找到我们数 $n$ 的所有正因子 $d$。然后，我们筛选掉那些是4的倍数的因子。最后，我们把剩下的因子加起来，结果乘以8。就是这样。这就是方法的数量。

让我们来试试一个数，比如 $n=5$。5的因子只有1和5。两者都不是4的倍数。所以和是 $1+5 = 6$。公式给出 $r_4(5) = 8 \times 6 = 48$。[@problem_id:444984] 有48个不同的整数四元组 $(a,b,c,d)$，它们的[平方和](@article_id:321453)为5！这来自于像 $(\pm 2)^2+(\pm 1)^2+0^2+0^2$ 这样的表示及其所有[排列](@article_id:296886)。

对于 $n=30$，因子是 $1, 2, 3, 5, 6, 10, 15, 30$。没有一个是4的倍数。它们的和是 $1+2+3+5+6+10+15+30=72$。所以，$r_4(30) = 8 \times 72 = 576$。[@problem_id:789734] 一个惊人的表示方法数量！

这个公式是一颗宝石。它揭示了一个“加法”问题（对平方求和）和一个“乘法”问题（找因子）之间令人震惊和深刻的联系。这两者究竟为什么会相关？要找出答案，我们必须更深入地挖掘。

### 表象之下的深层结构

[四平方和](@article_id:382092)表示法拥有如此简洁的计数公式，并且[四平方和](@article_id:382092)的集合在乘法下是封闭的（我们接下来会看到这个事实），这表明这并非侥幸。这是一个迹象，表明我们所看到的只是一个更宏伟的数学对象的影子。让我们从三个不同的角度来看这个对象。

#### 代数之钥：哈密顿的[四元数](@article_id:307439)

您可能遇到过复数，$a+bi$。它们与两个平方数之和有一个奇妙的性质。复数的“范数”或模的平方是 $|a+bi|^2 = a^2+b^2$。如果你将两个复数相乘，它们的范数也相乘：$|z_1 z_2| = |z_1| |z_2|$。这直接导出了婆罗摩笈多恒等式：
$$(a^2+b^2)(c^2+d^2) = (ac-bd)^2 + (ad+bc)^2$$
这表明两个“[两平方和](@article_id:315203)数”的乘积本身也是一个[两平方和](@article_id:315203)数。

这就引出了一个问题：在[四平方和](@article_id:382092)的背后是否存在类似的[代数结构](@article_id:297503)？答案是肯定的。在1840年代，[William Rowan Hamilton](@article_id:376162) 发现了**四元数**。这些是形如 $a+bi+cj+dk$ 的数，其中 $i,j,k$ 是新型的虚数单位。就像复数一样，[四元数](@article_id:307439)也有一个范数：$N(a+bi+cj+dk) = a^2+b^2+c^2+d^2$。关键是，这个范数是可乘的：$N(q_1 q_2) = N(q_1) N(q_2)$。

这个可乘的范数给了我们欧拉[四平方和](@article_id:382092)恒等式，它是婆罗摩笈多恒等式的“大表哥”。它表明两个[四平方和](@article_id:382092)之和的乘积总是另一个[四平方和](@article_id:382092)。这意味着[四平方和](@article_id:382092)的集合在乘法下是封闭的，这个性质不仅对整数成立，在任何[交换环](@article_id:308680)中都成立！[@problem_id:3016913] 这个代数事实非常强大。它告诉我们，如果我们能证明所有素数都是四个平方数之和，那么所有其他整数也必须是，因为任何整数都只是素数的乘积。四元数提供了支撑拉格朗日定理的隐藏代数支架。

#### 分析之钥：[θ函数](@article_id:381561)“机器”

让我们尝试一种完全不同的方法，一种分析学家偏爱的方法。想象一下，你想建造一台“机器”，来编目所有形成平方和的可能方式。生成函数就是这样一种机器。考虑这个无穷多项式（一个幂级数）：
$$ \theta_3(q) = \sum_{k=-\infty}^{\infty} q^{k^2} = 1 + 2q^{1^2} + 2q^{2^2} + 2q^{3^2} + \dots = 1 + 2q + 2q^4 + 2q^9 + \dots $$
这是一个 **[θ函数](@article_id:381561)**。可以把它看作一个目录，其中 $q$ 的指数告诉你一个平方数。

如果我们把整个级数提升到四次方，即 $(\theta_3(q))^4$，会发生什么？
$$ (\theta_3(q))^4 = \left( \sum_{k_1=-\infty}^{\infty} q^{k_1^2} \right) \left( \sum_{k_2=-\infty}^{\infty} q^{k_2^2} \right) \left( \sum_{k_3=-\infty}^{\infty} q^{k_3^2} \right) \left( \sum_{k_4=-\infty}^{\infty} q^{k_4^2} \right) $$
当我们展开这个乘积时，我们得到一系列形如 $q^{k_1^2} q^{k_2^2} q^{k_3^2} q^{k_4^2} = q^{k_1^2+k_2^2+k_3^2+k_4^2}$ 的项。项 $q^n$ 的总系数将是每次形成项 $q^n$ 时1的总和——换句话说，它恰好是 $r_4(n)$，即将 $n$ 写成四个平方数之和的方法数！[@problem_id:789734]
$$ (\theta_3(q))^4 = \sum_{n=0}^{\infty} r_4(n) q^n $$
这非同寻常。我们计数问题的所有信息现在都被编码在一个单一函数的系数中。雅可比的伟大成就就是证明了这个[θ函数](@article_id:381561)与[复分析](@article_id:304792)中的另一种函数（一个艾森斯坦级数）是相同的，而后者的系数已知与[因子和函数](@article_id:640419)有关。通过将两者等同，他推导出了他那神奇的 $r_4(n)$ 公式。这种方法将一个关于整数的离散问题转化为复函数世界中的一个连续问题，一路揭示了深刻而出人意料的恒等式。[@problem_id:650903]

#### 几何之钥：四维空间中的格

我们的第三个视角也许是视觉上最直观的，尽管它发生在四维空间中！将所有具有整数坐标的点 $(x,y,z,w)$ 的集合想象成一个巨大的晶体状网格，或称为**格**，在四维空间中，我们可以称之为 $\mathbb{Z}^4$。[拉格朗日定理](@article_id:308025)的陈述是，对于任何非负整数 $n$，这个网格上存在一个点，其到原点的距离的平方恰好是 $n$。

人们怎么可能证明这一点呢？由 Hermann Minkowski 开创的“[数的几何](@article_id:371956)”提供了一种令人惊叹的方法。证明大致如下 [@problem_id:3016909]：

1. 对于你想表示的整数 $n$，你不是看标准的网格 $\mathbb{Z}^4$。相反，你定义一个新的、“扭曲”的格 $\Lambda$，它是 $\mathbb{Z}^4$ 的一个子格。这个格被巧妙地构造出来，使得其上*任何*一点 $(a,b,c,d)$ 的[平方和](@article_id:321453) $a^2+b^2+c^2+d^2$ 都保证是 $n$ 的倍数。

2. 接下来，你援引闵可夫斯基优美的[凸体](@article_id:363199)定理。该定理是几何学的一个基本原理，它指出任何“足够大”的凸对称形状（如球体或立方体）都保证包含给定格中至少一个非原点。

3. 我们将此定理应用于我们的格 $\Lambda$。我们在原点处画一个四维球（一个超球面）。我们可以计算出这个球需要有多大的半径才能“足够大”以保证它能捕获我们格 $\Lambda$ 中的一个非零点。这个临界半径结果是 $R_{\min} = \left(\frac{32 \det(\Lambda)}{\pi^2}\right)^{1/4}$。[@problem_id:3016909]

4. 最后一步是神来之笔。格 $\Lambda$ 的构造和球的大小是完美平衡的。我们在我们的格中找到了一个非零点 $(a,b,c,d)$，它满足两个条件：
    a) $a^2+b^2+c^2+d^2$ 是 $n$ 的倍数（根据性质1）。
    b) $a^2+b^2+c^2+d^2$ 严格小于 $2n$（根据球的大小）。

将这两点结合起来，严格小于 $2n$ 的 $n$ 的正倍数只有 $n$ 本身！我们被迫得出结论：$a^2+b^2+c^2+d^2 = n$。我们用几何方法“捕获”了一个解。这个证明有力地展示了关于体积的连续、几何论证如何能为关于整数的离散问题提供具体的答案。

所以，我们看到了。一个单一的真理——每个数都是四个平方数之和——可以被看作是[四元数代数](@article_id:375212)、[θ函数](@article_id:381561)分析或四维格几何的结果。每个视角都揭示了这颗数学瑰宝的不同侧面，而它们的交汇证明了数学深刻的、潜在的统一性。正是这种统一性使得发现之旅如此富有价值。而且，得益于基于这些思想的[算法](@article_id:331821)视角，我们甚至可以编写一个简单的计算机程序，为我们选择的任何数找到这些表示方法[@problem_id:3016910]，从而将这个美丽的抽象概念变为计算上的现实。