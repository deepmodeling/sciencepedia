## 应用与跨学科联系

现在我们已经理解了[均匀流](@article_id:336471)形近似与投影 (Uniform Manifold Approximation and Projection, UMAP) [算法](@article_id:331821)的数学核心，我们可能会想把它当作一个巧妙的拓扑学工具束之高阁。但这样做将错失真正的冒险。一个伟大的科学工具的真正魅力不仅在于它的工作原理，更在于它让我们能看到什么。不要把 `n_neighbors` 参数看作一个需要调整的枯燥技术旋钮，而应将其视为一种新型显微镜的聚焦透镜。通过调整它，我们可以将视野从极其局部的复杂细节切换到宏大的全局全景。这种在个体与集体之间的单一权衡，是贯穿所有科学领域的主题。在探索 UMAP 的应用时，我们不仅仅是在学习一种[算法](@article_id:331821)，更是在学习一种新的方式来询问我们周围的复杂系统，从我们体内的细胞宇宙到因果关系的根本结构。

### 生物学家的显微镜：可视化细胞宇宙

也许没有哪个领域能像现代生物学，特别是在[单细胞数据分析](@article_id:352279)中那样，让 UMAP 提供如此令人惊叹的景象。想象一下，你试图为一座繁华的、大陆规模的城市绘制地图，但你一次只能勘察一个人。这正是生物学家在使用单细胞 RNA 测序时面临的挑战，他们需要测量数万个单细胞中成千上万个基因的活性。结果是一个维度惊人的数据集，一片似乎所有结构都已迷失的迷雾。

UMAP 穿透了这片迷雾。通过调整 `n_neighbors` 这个“镜头”，生物学家可以选择要创建哪种地图。如果我们将 `n_neighbors` 设置为一个非常小的值，比如 5，我们就是在告诉[算法](@article_id:331821)要严格关注局部细节。我们正在使用高倍物镜。对于每个细胞，我们只考虑其最直接的“熟人”。结果如何？一张图上，即使是像 T 细胞或 B 细胞这样的大而均一的细胞群体，也可能看似分裂成许多更小的子[聚类](@article_id:330431)，揭示出精细的内部状态。这种强烈的局部聚焦也善于发现[异常值](@article_id:351978)——那些因差异巨大而被抛到地图上成为自己孤立小岛的稀有细胞群。这对于发现以前未知的稀有细胞类型非常有用 [@problem_id:1428858]。

但如果我们的目标不同呢？如果我们不关心一个邻域内的微小变化，而是关心城市各区的总体布局呢？我们可以通过选择一个大的 `n_neighbors` 值（比如 100 或更多）来拉远我们的视野。现在，每个细胞的身份由一个更广泛的社交圈来定义。[算法](@article_id:331821)被迫寻找更宏观的连通性模式。结果是一张地图，其中主要的细胞类型凝聚成巨大、连贯的“大陆”。碎片化消失了，数据的宏伟结构浮现出来。然而，这种全局视野是有代价的。那些在高倍率下清晰可见的稀有“桥梁”细胞或微小的祖细胞群现在可能丢失了。它们独特的信号，由于数量稀少，被其数量众多的邻居的合唱声所淹没，它们常常被吸收到一个更大陆块的边缘，其独特的身份变得模糊 [@problem_id:1428858]。

这揭示了一个深刻的分析教训：没有单一的“正确”可视化。`n_neighbors` 的选择是关于所提出的科学问题的选择。而做出极端的选择可能会产生误导。一位寻找稀有[癌症干细胞](@article_id:329649)群体的研究人员可能会倾向于将 `n_neighbors` 设置为一个巨大的值——比如整个数据集大小的一半——认为这样能捕捉到最“真实”的全局结构。最终的图可能显示出一大片连续的细胞云，导致研究人员得出结论，认为不存在稀有群体。但这个结论是方法的产物。通过强迫每个细胞都将数据集中庞大的一部分视为其“邻域”，稀有细胞的独特微弱信号被完全平均掉了。镜头设置得太广，以至于他们正在寻找的东西变得不可见 [@problem_id:1465868]。

生物学家的任务通常比仅仅识别静态群体更复杂；它关乎理解连续的过程，比如[干细胞分化](@article_id:333817)为成熟血细胞。这不是一个关于分离岛屿的故事，而是一条平滑流动的河流。在这里，其他过分强调局部结构的方法，如 [t-SNE](@article_id:340240)，有时会“撕裂”这个[连续体](@article_id:320471)的结构，在没有断裂的地方制造出人为的间隙和[聚类](@article_id:330431)。UMAP，当与足够大的 `n_neighbors` 一起使用时，在这方面表现出色。更宽的邻域有助于将轨迹拼接在一起，确保最终的可视化显示为一条单一、连贯的路径。一旦这个基本的拓扑结构由 `n_neighbors` 确定，我们就可以使用次要参数 `min_dist` 来微调美学效果。为了强调连续的流动，我们可以使用较高的 `min_dist`，让点沿着河流散开并填充空间。为了强调地图中的不同终点或“湖泊”，我们可以使用非常低的 `min_dist`，使细胞紧密地聚集成致密的簇 [@problem_id:1428910] [@problem_id:3117962]。

### 超越图像：UMAP 在分析流程中的应用

UMAP 基于邻域的理念，其威力远不止于创建精美的可视化。它为整个计算分析链提供了坚实的基础，并且常常在其他方法失效的地方取得成功。

许多分析流程中的一个关键步骤是数据的初步“[去噪](@article_id:344957)”，这通常使用[主成分分析 (PCA)](@article_id:352250) 来完成。人们可能会问，在将数据送入 UMAP 之前，我们应该保留多少个主成分？这个问题本身就是另一个局部与全局的平衡行为。如果我们保留的成分太少，我们可能会丢弃掉区分我们细胞类型的关[键维度](@article_id:305230)，导致不同的群体相互重叠，从而使 UMAP 错误地将它们合并。如果我们保留的成分太多，我们就会开始包含由技术噪声主导的成分，这使得“邻居”的定义变得不稳定，并可能导致 UMAP 将凝聚的群体[打散](@article_id:638958)成零散的碎片。最佳选择是保留适量的成分，既能捕捉到真实的生物学信号，又能创建一个干净的空间，让 UMAP 能够可靠地构建其邻域图并发现潜在的[流形](@article_id:313450) [@problem_id:2371661]。

在处理具有挑战性的数据类型时，这一点尤为关键。以单细胞 [ATAC-seq](@article_id:349101) 为例，这是一种测量 DNA 可及性的技术。得到的数据矩阵极其稀疏——对于任何给定的细胞，超过 99% 的测量特征都是零。对于像 PCA 这样依赖于全局方差和欧几里得距离的测量方法来说，这是一场噩梦。大量的共享零值使得所有细胞看起来都人为地相似，最终得到的主成分往往捕捉到的是无意义的技术伪影。然而，UMAP 在很大程度上不受此问题影响。它的局部视角，专注于寻找最近邻，隐含地更关心稀有的、共享的*非零*值模式。它基于*存在*什么来构建图，而不是*缺失*什么，这使得它能够在一片零的海洋中稳健地找到结构，而全局方法则会迷失方向 [@problem-id:1428883]。

当我们面对一个常见的生物学难题：解开两个交织在一起的过程时，这种流程方法的真正威力就显现出来了。想象一下，细胞同时在经历分化途径（我们关心的信号）和细胞周期（一个强烈但具有迷惑性的信号）。像 PCA 这样由方差驱动的方法，其顶部主成分很可能被强大的[细胞周期](@article_id:301107)信号所主导。如果我们基于这种表示来构建轨迹，我们很可能追踪到的是细胞周期，而不是分化路径。然而，UMAP 可以施展一种计算魔法。通过专注于局部邻域，它可以解开这两个[流形](@article_id:313450)。它可以发现，在局部，一个细胞的最近邻是由分化基因的微小变化定义的，即使最大的全局差异是由细胞周期引起的。这使得它能够生成一个正确显示分化分支路径的[嵌入](@article_id:311541)，有效地将其与混杂过程分离开来 [@problem_id:2437494]。在这里，最初选择一个较大的 `n_neighbors` 对于确保全局分支结构得以保留至关重要。

更进一步，我们可以成为 UMAP 运行“空间”的积极设计者。如果我们正在寻找一个极其稀有的细胞群体，我们可以采用一种自适应的两步策略。首先，运行一个标准的 UMAP 来大致了解数据的布局。用它来初步猜测哪些细胞属于稀有群体。然后，识别哪些蛋白质或基因标记物最能将这个稀有群体与背景区分开。最后，重新运行 UMAP，但这次使用一个自定义加权的距离度量，该度量着重强调那些关键的区分性标记物。我们[实质](@article_id:309825)上是为 UMAP 配备了一种“染料”，使稀有群体发光，从而让[算法](@article_id:331821)能够以惊人的清晰度解析其结构 [@problem_id:2866288]。这表明 UMAP 不是一个黑匣子，而是一个鼓励创造性、假设驱动探索的灵活工具。

### 通用工具：从细胞到因果

科学中最深刻的思想是那些超越其原始背景的思想。通过检查局部邻域来寻找结构的概念就是这样一种思想。我们已经看到了它在生物学中的威力，但如果我们将它应用于一个完全不同的领域，比如因果发现，会发生什么呢？

想象我们有一组[随机变量](@article_id:324024)——比如股价、天气测量值或疾病标志物——我们想了解它们之间的因果关系。这是科学中最困难的问题之一。第一步可能是计算每对变量之间的[统计依赖](@article_id:331255)性，使用像[互信息](@article_id:299166) $\hat{I}(X_i; X_j)$ 这样的度量。这给了我们一个相似性矩阵，其中高值表示强关联。

现在，让我们进行一次概念上的飞跃。让我们将每个*变量*视为高维空间中的一个“点”。两个变量之间的“距离”将由它们之间缺乏关联性来定义（例如，互信息越高，距离越小）。如果我们在*这个*变量数据集上运行 UMAP 会发生什么？结果是一张二维地图，其中统计上密切相关的变量被放置在一起。

需要明确的是，这张地图不是一张因果图。众所周知，相关性并不意味着因果关系。两个变量在地图上可能很近，原因可能是一个导致另一个，也可能是它们都受到第三个混杂变量的影响。仅使用成对信息的 UMAP 无法区分这两种情况 [@problem_id:3190530]。但它提供的是一种非凡的启发式方法。在寻找因果链的庞大组合搜索中，UMAP 图为我们提供了一张“可疑对象”的地图。地图上的变量簇很可能形成“因果模块”。然后，我们可以利用这张地图来智能地指导更严谨但计算成本高昂的、基于约束的因果发现[算法](@article_id:331821)。例如，为了测试 $X_i$ 和 $X_j$ 之间的联系是否是直接的，我们需要检查在给定某个其他变量集 $S$ 的条件下的[条件独立性](@article_id:326358)。UMAP 地图可以建议我们优先使用从 $X_i$ 和 $X_j$ 的局部邻域中抽取的条件集 $S$ 进行测试 [@problem_id:3190530]。

此外，我们可以使 UMAP 的输入更加复杂。我们可以使用[条件依赖](@article_id:331452)性的度量，而不是成对的互信息，这将过滤掉一些由中介链产生的虚假联系。最终的 UMAP 将显示一个更接近直接连接的骨架。[嵌入](@article_id:311541)仍然是对称的——它无法告诉我们箭头的方向——但它为确定边的方向这项艰巨任务提供了一个大大简化的起点 [@problem_id:3190530]。

从绘制细胞景观到指导因果探索，其基本原理是相同的。通过从局部关系的网中构建地图，我们可以对复杂系统的结构获得深刻的直觉。选择 `n_neighbors` 的简单行为——即决定如何平衡微观与宏观——不仅仅是一个技术步骤。它体现了科学过程本身：一场在具体与普遍、细节与宏伟设计之间持续进行的创造性对话。