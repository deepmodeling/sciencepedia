## 引言
从医学到工程学等领域，理解事件*何时*发生而不仅仅是*是否*发生，是一项根本性的挑战。为了比较不同群体之间随时间推移发生某一事件（例如患者复发、机器故障）的风险，我们需要一个既简单又强大的框架。著名的[Cox比例风险模型](@entry_id:174252)通过一个单一而优雅的理念提供了这一框架：比例风险（Proportional Hazards, PH）假定。该假定提出，某个给定因素（如一种新药）的影响，是在每个时间点上将基础风险乘以一个恒定的量，从而使我们能够用一个单一的数字——风险比——来总结复杂的动态过程。

然而，强大的简化能力也伴随着巨大的责任。当这一假定不成立时会发生什么？如果一种治疗的效果会发生变化，起初有益但后来有害，那该怎么办？忽略这种动态变化可能导致危险的误导性结论。本文将深入探讨这一关键的统计概念，使您能够明智地运用它。第一部分“**原理与机制**”将揭开[风险率](@entry_id:266388)的神秘面纱，解释PH假定的逻辑，并详细介绍检验其有效性所需的“侦探工作”。第二部分“**应用与跨学科联系**”将展示从肿瘤学到人工智能的真实世界场景，在这些场景中，这一假定被违反，从而揭示了更深层次的科学见解，并探索了用于模拟这种复杂性的高级方法。

## 原理与机制

为了理解事件何时发生——无论是草莓腐烂、机器故障还是疾病发作——我们需要一种语言来讨论风险，不是简单的“是否”，而是“何时”。这个故事的核心角色是**风险率**。

### 问题的核心：什么是风险？

想象你有一个旧灯泡，它已经忠实地亮了一千个小时。问题不仅仅是它*是否*会坏，而是在它已经存活了这么久的情况下，它*此刻*，在下一个瞬间，发生故障的倾向性有多大。这种瞬时风险，这种“易于失败的倾向”，就是我们所说的**风险率**，通常用希腊字母lambda $\lambda(t)$ 表示。

更正式地说，时间 $t$ 的风险是在给定存活至时间 $t$ 的条件下，事件在未来的一个微小区间（比如从 $t$ 到 $t + \Delta t$）内发生的概率，再除以该区间的长度 [@problem_id:4829093]：
$$ \lambda(t) = \lim_{\Delta t \to 0^+} \frac{\mathbb{P}(t \le T  t+\Delta t \mid T \ge t)}{\Delta t} $$
两个关键部分是“给定存活至时间 $t$”的条件 ($T \ge t$) 和除以 $\Delta t$。这个除法使其成为一个*率*——就像英里每小时的速度一样——而不是一个纯粹的概率。正因为它是一个率，风险值（或许令人惊讶地）可以大于1 [@problem_id:4547007]。每年12次的风险仅仅意味着，在那个瞬间，如果该率得以维持并且你有一大群人，你预计一年内会发生12次事件。

风险函数 $\lambda(t)$ 讲述了一个动态故事。它可能在开始时很高，然后下降，就像手术后并发症的风险。或者它可能很低，并随时间增加，就像一辆旧车抛锚的风险。**生存曲线**显示了在时间 $t$ 之后保持无事件的概率，它是直到该点所经历风险的直接结果。高风险时期对应于生存曲线中陡峭的下降斜率。两者通过**累积风险** $H(t) = \int_0^t \lambda(u)du$ 紧密相连，存在着优美的关系 $S(t) = \exp(-H(t))$ [@problem_id:1925081]。

### 比较不同世界：比例风险理念

现在，假设我们想要比较两个不同的世界。我们有存放在冰箱里的草莓和放在室温下的草莓 [@problem_id:1925081]。或者，我们有接受新药治疗的患者和接受安慰剂的患者。他们的风险随时间如何比较？

我们可以在每一个时刻都细致地比较它们的风险函数，但这会极其复杂。科学的进步常常是通过做出简化而优雅的假定。如果我们提出最简单的可能关系会怎样？如果一组的风险曲线只是另一组的完美缩放版本呢？想象一下，冷藏草莓的风险曲线随时间呈现某种形状。如果室温草莓的风险具有完全相同的形状，只是在每个时间点都乘以一个常数因子——比如说4——会怎样？

这就是优美而强大的**[比例风险](@entry_id:166780)（PH）假定**。它指出，两组的风险函数之比随时间是恒定的 [@problem_id:4789396] [@problem_id:4624440]。这个常数被称为**风险比（Hazard Ratio, HR）**。
$$ \frac{\lambda_{\text{group 1}}(t)}{\lambda_{\text{group 0}}(t)} = \text{HR (一个常数)} $$
如果HR为2，这意味着第1组中的个体发生事件的瞬时风险是第0组中可比个体的两倍，并且这在第1天、第100天和第1000天都成立。这个假定的美妙之处在于，它允许我们用一个单一且有意义的数字——风险比——来总结两个生存曲线之间整个潜在复杂的关系。这就是著名的[Cox比例风险模型](@entry_id:174252)的基础理念。

### 当世界不那么简单时：违反假定

但是，我们研究的世界总是如此整洁和成比例吗？通常并非如此。考虑一个现实世界的两难困境：比较一种激进的新型癌症手术与标准药物疗法 [@problem_id:1911730]。

*   手术初期风险很高，源于术后并发症。风险在开始时很高，但对于康复者来说会下降。
*   药物疗法的初期风险较低，但其效果可能随时间减弱，或者癌症可能产生耐药性。风险开始时较低，但可能随后上升。

在这种情况下，风险之比显然不是恒定的。手术在开始时风险更高，但从长远来看可能更安全。风险曲线将会交叉，比例风险假定被违反。如果它们的数学形式不同，我们可以立即看到这一点；比率 $\frac{A\exp(-kt) + C_1}{Bt + C_2}$ 显然是时间 $t$ 的函数 [@problem_id:1911730]。

当HR随时间变化时，我们就有了**非比例风险**。一个明显的迹象是看到两组的生存[曲线交叉](@entry_id:189391) [@problem_id:4968269]。在比例风险下，如果一组的风险更高（HR  1），其生存曲线将始终位于另一组之下；它们的位置不能互换。

一个更深层的直觉来自一个引人入胜的概念——**易感者耗尽** [@problem_id:4547007]。在早期风险高的组（手术组）中，最脆弱的个体被迅速“筛选”出群体。幸存者群体在某种意义上变得更加坚韧。在药物治疗组中，这种早期的“淘汰”过程不那么激烈。因此，当我们在研究[后期](@entry_id:165003)比较风险时，我们不再是同类比较。我们正在将早期“火的考验”的幸存者与一个更普通的群体进行比较。他们的相对风险发生了变化，这一点也不奇怪。

### 单一数字的危险：误导性的平均值

那么，如果我们忽略这种违反会发生什么？如果我们仍然拟合一个标准的[Cox模型](@entry_id:164053)，强迫它产生一个单一的风险比来总结非比例的现实，会怎样？它产生的数字是真实、随时间变化的风险比的一种复杂加权平均值，其中事件更多的时期对结果的影响更大 [@problem_id:4968269]。

这可能会产生严重的误导。这就像用一个“C”的最终成绩来总结一个第一学期得了“A”而第二学期得了“F”的学生的表现。那个“C”反映了他们的学习历程吗？完全没有。

让我们考虑一个鲜明的假设情景，看看真正的危险 [@problem_id:4846018]。想象一下一种新药正在测试。在最初的两年里，它具有极好的保护作用，将风险减半（$HR = 0.5$）。但在第三年，它变得有毒，使风险加倍（$HR = 2.0$）。假设这两个时期的持续时间正好使得在为期三年的研究结束时，药物组和安慰剂组中发生事件的总人数完全相同。

标准的Cox分析会报告什么？它会看到总事件数相等，计算出平均HR为1.0，并可能产生一个不显著的p值，从而得出“该药物无效”的结论 [@problem_id:4617822]。这个总结完全是错误的。它彻底掩盖了药物初期有益而[后期](@entry_id:165003)有害这一关键事实。一个单一的数字不仅不精确，而且在性质上是错误的。

### 如何成为一名好侦探：检验假定

鉴于PH假定在成立时功能强大，但在不成立时则充满陷阱，我们必须像优秀的侦探一样，在信任我们的模型之前严格检查线索。

**线索1：目视检查。** 第一步是绘制生存曲线（通常使用[Kaplan-Meier](@entry_id:169317)方法）。它们是否交叉？它们是开始时平行然后急剧发散或收敛吗？这些都是非比例性的强烈暗示 [@problem_id:4789396]。但请注意：没有交叉并不能保证比例性。我们需要更正式的工具。

**线索2：检查剩余物。** 最好的侦探常常通过翻查垃圾来找到线索。在统计学中，我们的“垃圾”是**残差**——在我们的[模型拟合](@entry_id:265652)后剩下的、未解释的误差。对于[Cox模型](@entry_id:164053)，我们有一个特殊的工具叫做**Schoenfeld残差** [@problem_id:4982837]。

其直觉是这样的：在每次事件发生时，某个协变量（如治疗组）的Schoenfeld残差是发生事件的个体的协变量值与当时所有仍在风险中的个体的该协变量加权平均值之差 [@problem_id:4982837]。如果PH假定成立，协变量的影响是恒定的，因此这些残差随时间应该随机散布在零附近。但是，如果我们将它们与时间作图并看到系统性趋势——一条斜线或曲线——这就是数据发出的明确信号，表明效应随时间在变化，我们的假定被违反了 [@problem_id:4624440]。这可以形式化为一个统计检验。

**线索3：“圈套行动”。** 一种非常强大的技术是直接挑战这个假定。我们可以拟合一个更灵活、扩展的[Cox模型](@entry_id:164053)，明确允许效应随时间变化。这通常通过添加一个**时间-协变量交互**项来完成，例如，将对数风险比建模为 $\beta(t) = \beta_0 + \beta_1 \log(t)$ [@problem_id:4617822]。然后我们可以对 $\beta_1$ 系数进行统计检验。如果 $\beta_1$ 显著不为零，我们就找到了反对效应恒定这一零假设的有力证据；数据“承认”PH假定被违反了 [@problem_id:4624440]。

### 超越比例性：拥抱复杂性

发现风险不呈比例性不应被视为失败，而应被看作一项发现！它揭示了我们正在研究的关系比我们最初假设的更有趣、更细致。

当我们检测到非比例性时，我们不会束手无策。我们会转向更好的工具。我们可以使用我们诊断检验中的时间交互模型来描述和报告效应*如何*随时间变化——这是一个比单一、误导性的HR能提供的更丰富、更诚实的故事 [@problem_id:4617822]。或者，我们可以使用不依赖于PH假定的其他汇总度量。一个流行的选择是**限制性平均生存时间（RMST）的差异**，它简单地比较在一个预先指定的临床时间范围内，各组之间的平均无事件时间 [@problem_id:4968269]。

从简单优雅的[比例风险](@entry_id:166780)假定，到检验它的侦探工作，再到最终拥抱复杂性的更复杂的模型，这个过程本身就是科学方法的一个缩影。我们从一个美丽的想法开始，无情地用现实来检验它，当它有不足之处时，我们构建更好的东西——让我们更接近真相的东西。

