{
    "hands_on_practices": [
        {
            "introduction": "需求侧管理的核心经济学原理在于利用电力系统边际成本的非线性。通过将用电从高成本时段转移到低成本时段，可以有效降低总发电成本。本练习旨在通过一个简化的双时段模型，让您亲手推导负荷转移所带来的精确成本节约，从而深刻理解发电成本曲线的凸性是如何驱动需求响应产生价值的 。",
            "id": "4083927",
            "problem": "考虑一个简化的双时段能源系统，该系统由单一代表性的供给堆栈运行，其边际成本函数为凸函数 $MC(g)=\\alpha+\\beta g$，其中 $\\beta>0$ 且 $\\alpha\\geq 0$。设高成本时段的基准净负荷为 $d_{h}>0$，低成本时段的基准净负荷为 $d_{\\ell}\\geq 0$，且 $d_{h}>d_{\\ell}$，因此 $MC(d_{h})>MC(d_{\\ell})$。一项需求侧管理 (DSM) 干预措施将 $0 \\le \\Delta \\le d_h$ 单位的交付能源从高成本时段转移到低成本时段，过程中无损耗、无反弹效应，且两个时段的总能源消耗不变。总可变生产成本函数为 $C(g)=\\alpha g+\\frac{1}{2}\\beta g^{2}$，且系统在两个时段内的总成本是各时段成本之和，各时段成本根据相应时段的负荷计算。\n\n从边际成本是总成本的导数的定义出发，利用由 $\\beta>0$ 所蕴含的 $C(\\cdot)$ 的凸性，以及独立时段成本的可加性，推导因 DSM 转移而产生的系统生产成本节约的精确闭式表达式。成本节约定义为基准总成本减去转移后的总成本。最终节约额以美元表示。无需四舍五入。",
            "solution": "在尝试求解之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n-   供给堆栈的边际成本函数：$MC(g)=\\alpha+\\beta g$\n-   边际成本函数的参数：$\\beta>0$ 且 $\\alpha\\geq 0$\n-   高成本时段的基准净负荷：$d_h > 0$\n-   低成本时段的基准净负荷：$d_\\ell \\geq 0$\n-   基准负荷之间的关系：$d_h > d_\\ell$\n-   需求侧管理 (DSM) 能源转移：$\\Delta$ 单位，其中 $0 \\le \\Delta \\le d_h$\n-   DSM 特征：无损耗、无反弹效应、总能源消耗不变。\n-   总可变生产成本函数：$C(g)=\\alpha g+\\frac{1}{2}\\beta g^{2}$\n-   系统总成本定义：各时段成本之和。\n-   目标：推导系统生产成本节约的闭式表达式，定义为基准总成本减去转移后的总成本。\n\n### 步骤2：使用提取的已知条件进行验证\n根据既定标准对问题进行评估。\n\n-   **科学依据：** 该问题基于微观经济学和能源系统工程的基本原理。使用与二次总成本函数 ($C$) 对应的线性边际成本函数 ($MC$) 是简化发电组合的标准有效模型。条件 $\\beta > 0$ 确保了成本函数是凸函数 ($C''(g) = \\beta > 0$)，这正确地模拟了优先调度成本较低的发电机组、从而导致边际成本递增的经济学原理。总成本和边际成本之间的关系是一致的，因为给定的总成本函数 $C(g)$ 对发电量 $g$ 的导数是 $\\frac{d}{dg}(\\alpha g + \\frac{1}{2}\\beta g^{2}) = \\alpha + \\beta g$，这正是给定的边际成本函数 $MC(g)$。\n-   **良构性：** 该问题是良构的。所有必要的函数、参数和约束都已明确定义。目标清晰明确，要求进行特定的解析推导。给定的信息足以推导出唯一解。\n-   **客观性：** 问题以精确、客观和数学化的语言陈述，不含任何主观或基于观点的内容。\n-   **完整性与一致性：** 问题是自洽的。所提供的数据和定义是完整且内部一致的。例如，约束 $\\Delta \\leq d_h$ 确保了高成本时段转移后的负荷 $d_h - \\Delta$ 为非负值。“总能量不变”的条件也定义明确。\n-   **现实性：** 如题所述，该模型是“简化的”，但其组成部分基于现实原理。无损耗或反弹效应的假设是入门模型中常见的简化，旨在分离负荷转移的主要经济效应。\n-   **结构性：** 问题结构逻辑清晰，要求根据所提供的定义进行直接推导。该问题不是病态问题、无意义问题或循环论证问题。\n\n### 步骤3：结论与行动\n该问题有效，因其在数学上一致、有科学依据且属良构问题。将推导解答。\n\n系统的总成本是两个时段的成本之和。每个时段的成本由总可变生产成本函数 $C(g)=\\alpha g+\\frac{1}{2}\\beta g^{2}$ 确定。\n\n首先，我们定义基准情景下的系统总成本，记为 $C_{total}^{base}$。在这种情景下，高成本时段和低成本时段的发电量分别等于各自的净负荷 $d_h$ 和 $d_\\ell$。\n$$C_{total}^{base} = C(d_h) + C(d_\\ell)$$\n代入 $C(g)$ 的表达式，我们得到：\n$$C_{total}^{base} = \\left(\\alpha d_h + \\frac{1}{2}\\beta d_h^2\\right) + \\left(\\alpha d_\\ell + \\frac{1}{2}\\beta d_\\ell^2\\right)$$\n\n接下来，我们定义 DSM 干预后的系统总成本，记为 $C_{total}^{post}$。该干预将 $\\Delta$ 单位的能源从高成本时段转移到低成本时段。\n高成本时段的新发电水平为 $g_h^{post} = d_h - \\Delta$。\n低成本时段的新发电水平为 $g_\\ell^{post} = d_\\ell + \\Delta$。\n转移后情景的总成本为：\n$$C_{total}^{post} = C(g_h^{post}) + C(g_\\ell^{post}) = C(d_h - \\Delta) + C(d_\\ell + \\Delta)$$\n代入 $C(g)$ 的表达式：\n$$C_{total}^{post} = \\left[\\alpha(d_h - \\Delta) + \\frac{1}{2}\\beta(d_h - \\Delta)^2\\right] + \\left[\\alpha(d_\\ell + \\Delta) + \\frac{1}{2}\\beta(d_\\ell + \\Delta)^2\\right]$$\n\n系统生产成本节约额（我们记为 $S$）定义为基准总成本减去转移后的总成本。\n$$S = C_{total}^{base} - C_{total}^{post}$$\n代入成本的详细表达式：\n$$S = \\left[ \\left(\\alpha d_h + \\frac{1}{2}\\beta d_h^2\\right) + \\left(\\alpha d_\\ell + \\frac{1}{2}\\beta d_\\ell^2\\right) \\right] - \\left[ \\left(\\alpha(d_h - \\Delta) + \\frac{1}{2}\\beta(d_h - \\Delta)^2\\right) + \\left(\\alpha(d_\\ell + \\Delta) + \\frac{1}{2}\\beta(d_\\ell + \\Delta)^2\\right) \\right]$$\n\n现在我们通过对含 $\\alpha$ 和含 $\\beta$ 的项进行分组来简化此表达式。\n包含 $\\alpha$ 的项是：\n$$(\\alpha d_h + \\alpha d_\\ell) - (\\alpha(d_h - \\Delta) + \\alpha(d_\\ell + \\Delta))$$\n$$= \\alpha d_h + \\alpha d_\\ell - (\\alpha d_h - \\alpha\\Delta + \\alpha d_\\ell + \\alpha\\Delta)$$\n$$= \\alpha d_h + \\alpha d_\\ell - (\\alpha d_h + \\alpha d_\\ell) = 0$$\n正如预期的那样，发电量的线性项相互抵消，因为两个时段的总发电量 $(d_h - \\Delta) + (d_\\ell + \\Delta) = d_h + d_\\ell$ 是守恒的。\n\n剩余的包含 $\\beta$ 的项决定了节约额：\n$$S = \\left(\\frac{1}{2}\\beta d_h^2 + \\frac{1}{2}\\beta d_\\ell^2\\right) - \\left(\\frac{1}{2}\\beta(d_h - \\Delta)^2 + \\frac{1}{2}\\beta(d_\\ell + \\Delta)^2\\right)$$\n提出因子 $\\frac{1}{2}\\beta$：\n$$S = \\frac{1}{2}\\beta \\left[ (d_h^2 + d_\\ell^2) - \\left((d_h - \\Delta)^2 + (d_\\ell + \\Delta)^2\\right) \\right]$$\n展开平方项：\n$$(d_h - \\Delta)^2 = d_h^2 - 2d_h\\Delta + \\Delta^2$$\n$$(d_\\ell + \\Delta)^2 = d_\\ell^2 + 2d_\\ell\\Delta + \\Delta^2$$\n将这些展开式代回 $S$ 的表达式中：\n$$S = \\frac{1}{2}\\beta \\left[ (d_h^2 + d_\\ell^2) - (d_h^2 - 2d_h\\Delta + \\Delta^2 + d_\\ell^2 + 2d_\\ell\\Delta + \\Delta^2) \\right]$$\n简化方括号内的表达式：\n$$S = \\frac{1}{2}\\beta \\left[ d_h^2 + d_\\ell^2 - d_h^2 + 2d_h\\Delta - \\Delta^2 - d_\\ell^2 - 2d_\\ell\\Delta - \\Delta^2 \\right]$$\n$d_h^2$ 和 $d_\\ell^2$ 项相互抵消。\n$$S = \\frac{1}{2}\\beta \\left[ 2d_h\\Delta - 2d_\\ell\\Delta - 2\\Delta^2 \\right]$$\n从括号项中提出因子 $2\\Delta$：\n$$S = \\frac{1}{2}\\beta \\cdot 2\\Delta \\left[ (d_h - d_\\ell) - \\Delta \\right]$$\n这简化为成本节约的最终闭式表达式：\n$$S = \\beta \\Delta (d_h - d_\\ell - \\Delta)$$\n此表达式代表了因 DSM 引起的 $\\Delta$ 单位能源消耗转移所产生的总生产成本节约额（以美元计）。如果转移量 $\\Delta$ 小于初始负荷差 $d_h - d_\\ell$，则节约额为正。由 $\\beta > 0$ 保证的成本函数的凸性是这些节约额的根本驱动因素。",
            "answer": "$$\n\\boxed{\\beta \\Delta (d_h - d_\\ell - \\Delta)}\n$$"
        },
        {
            "introduction": "在实际的需求响应事件中，负荷削减后往往会伴随着“反弹”效应，即用户在后续时段补偿性地增加用电。本练习引入了随时间变化的边际成本和反弹效应，要求您计算一个完整DR事件的净经济效益。通过这个练习，您将学会如何运用积分来处理动态成本，并评估反弹效应对总体节约的真实影响，这对于设计有效的DR策略至关重要 。",
            "id": "4083889",
            "problem": "一个商业聚合商执行一个需求响应 (DR) 事件，该事件会改变客户相对于其基线的用电量。设时间从DR事件开始的 $t=0$ 时刻开始计量，单位为小时。供应电力到电表的边际运营成本是随时间变化的，并被建模为时间的线性函数 $c(t)=c_{0}+c_{1}t$，其中 $c(t)$ 的单位是 $\\mathrm{USD}/\\mathrm{kWh}$，$t$ 的单位是 $\\mathrm{h}$，$c_{0}=0.20\\,\\mathrm{USD}/\\mathrm{kWh}$，以及 $c_{1}=0.05\\,\\mathrm{USD}/(\\mathrm{kWh}\\cdot\\mathrm{h})$。在DR事件期间，在时间区间 $t\\in[0,2]$ 内，聚合商将客户的用电量削减了 $3\\,\\mathrm{kW}$，持续 $2\\,\\mathrm{h}$，然后在时间区间 $t\\in(2,5]$ 内发生反弹，用电量增加了 $1.5\\,\\mathrm{kW}$，持续 $3\\,\\mathrm{h}$。假设没有发生其他偏离基线的情况，并且边际成本适用于增量用电量变化。\n\n使用关联能量、功率和成本的第一性原理，定义：\n- 在 $t\\in[0,2]$ 期间因削减产生的避免成本（节省）：定义为边际成本与削减功率乘积的积分。\n- 在 $t\\in(2,5]$ 期间因反弹产生的增加成本：定义为边际成本与增加功率乘积的积分。\n- 净节省：定义为避免成本减去增加成本。\n- 反弹幅度：定义为增加成本与避免成本的比值。\n\n在给定的线性边际成本下，计算此DR事件的净节省和反弹幅度。将两个量都四舍五入到四位有效数字。以 $\\mathrm{USD}$ 表示货币价值，并将反弹幅度表示为小数（无单位）。",
            "solution": "首先通过提取所有给定信息并评估其科学合理性、一致性和完整性来验证问题。\n\n**提取的已知条件：**\n1.  时间变量：$t$，以小时（$\\mathrm{h}$）为单位计量，$t=0$ 为需求响应 (DR) 事件的开始时刻。\n2.  边际运营成本函数：$c(t) = c_0 + c_1 t$，单位为 $\\mathrm{USD}/\\mathrm{kWh}$。\n3.  成本函数参数：$c_0 = 0.20\\,\\mathrm{USD}/\\mathrm{kWh}$ 和 $c_1 = 0.05\\,\\mathrm{USD}/(\\mathrm{kWh}\\cdot\\mathrm{h})$。\n4.  削减事件：在时间区间 $t \\in [0, 2]$ 内，用电量被削减了 $P_c = 3\\,\\mathrm{kW}$。\n5.  反弹事件：在时间区间 $t \\in (2, 5]$ 内，用电量增加了 $P_r = 1.5\\,\\mathrm{kW}$。\n6.  避免成本 (AC) 的定义：在 $t \\in [0, 2]$ 上，边际成本与削减功率乘积的积分。\n7.  增加成本 (AddC) 的定义：在 $t \\in (2, 5]$ 上，边际成本与增加功率乘积的积分。\n8.  净节省 (NS) 的定义：$\\mathrm{NS} = \\mathrm{AC} - \\mathrm{AddC}$。\n9.  反弹幅度 (RM) 的定义：$\\mathrm{RM} = \\mathrm{AddC} / \\mathrm{AC}$。\n10. 要求输出：计算净节省（以 $\\mathrm{USD}$ 为单位）和反弹幅度（无单位），两者均四舍五入到四位有效数字。\n\n**验证结论：**\n问题有科学依据、提法得当且客观。它基于能源系统建模的基本原理，包括需求响应、边际成本分析以及功率、能量和成本之间的关系。定义清晰，并且提供了所有必要的参数。单位一致：$(\\mathrm{USD}/\\mathrm{kWh}) \\times \\mathrm{kW}$ 对时间（单位 $\\mathrm{h}$）的积分正确地得到 $\\mathrm{USD}$ 单位。问题是有效的。\n\n**求解推导：**\n\n问题的核心是通过在特定时间区间内对随时间变化的边际成本率 $c(t)$ 和分段恒定的功率曲线 $\\Delta P(t)$ 的乘积进行积分，来计算总成本或节省。\n\n首先，我们计算削减阶段的避免成本 $\\mathrm{AC}$。在区间 $t \\in [0, 2]$ 内，给定的削减功率为 $P_c = 3\\,\\mathrm{kW}$。根据所提供的定义：\n$$\n\\mathrm{AC} = \\int_{0}^{2} c(t) \\cdot P_c \\, dt\n$$\n代入 $c(t)$ 和 $P_c$ 的表达式：\n$$\n\\mathrm{AC} = \\int_{0}^{2} (c_0 + c_1 t) \\cdot P_c \\, dt = P_c \\int_{0}^{2} (c_0 + c_1 t) \\, dt\n$$\n我们进行积分：\n$$\n\\mathrm{AC} = P_c \\left[ c_0 t + \\frac{c_1 t^2}{2} \\right]_{0}^{2}\n$$\n在积分上下限处计算定积分的值：\n$$\n\\mathrm{AC} = P_c \\left( \\left( c_0 \\cdot 2 + \\frac{c_1 \\cdot 2^2}{2} \\right) - \\left( c_0 \\cdot 0 + \\frac{c_1 \\cdot 0^2}{2} \\right) \\right) = P_c (2c_0 + 2c_1)\n$$\n现在，我们代入给定的数值：$P_c = 3\\,\\mathrm{kW}$，$c_0 = 0.20\\,\\mathrm{USD}/\\mathrm{kWh}$，和 $c_1 = 0.05\\,\\mathrm{USD}/(\\mathrm{kWh}\\cdot\\mathrm{h})$。\n$$\n\\mathrm{AC} = 3 \\cdot (2 \\cdot 0.20 + 2 \\cdot 0.05) = 3 \\cdot (0.40 + 0.10) = 3 \\cdot 0.50 = 1.50\\,\\mathrm{USD}\n$$\n\n接下来，我们计算反弹阶段的增加成本 $\\mathrm{AddC}$。在区间 $t \\in (2, 5]$ 内，给定的增加功率为 $P_r = 1.5\\,\\mathrm{kW}$。注意，对于定积分，端点的包含与否不改变结果，因此我们在 $[2, 5]$ 上积分。\n$$\n\\mathrm{AddC} = \\int_{2}^{5} c(t) \\cdot P_r \\, dt\n$$\n代入 $c(t)$ 和 $P_r$ 的表达式：\n$$\n\\mathrm{AddC} = \\int_{2}^{5} (c_0 + c_1 t) \\cdot P_r \\, dt = P_r \\int_{2}^{5} (c_0 + c_1 t) \\, dt\n$$\n我们进行积分：\n$$\n\\mathrm{AddC} = P_r \\left[ c_0 t + \\frac{c_1 t^2}{2} \\right]_{2}^{5}\n$$\n在积分上下限处计算定积分的值：\n$$\n\\mathrm{AddC} = P_r \\left( \\left( c_0 \\cdot 5 + \\frac{c_1 \\cdot 5^2}{2} \\right) - \\left( c_0 \\cdot 2 + \\frac{c_1 \\cdot 2^2}{2} \\right) \\right)\n$$\n$$\n\\mathrm{AddC} = P_r \\left( (5c_0 + 12.5c_1) - (2c_0 + 2c_1) \\right) = P_r (3c_0 + 10.5c_1)\n$$\n现在，我们代入数值：$P_r = 1.5\\,\\mathrm{kW}$，$c_0 = 0.20\\,\\mathrm{USD}/\\mathrm{kWh}$，和 $c_1 = 0.05\\,\\mathrm{USD}/(\\mathrm{kWh}\\cdot\\mathrm{h})$。\n$$\n\\mathrm{AddC} = 1.5 \\cdot (3 \\cdot 0.20 + 10.5 \\cdot 0.05) = 1.5 \\cdot (0.60 + 0.525) = 1.5 \\cdot 1.125 = 1.6875\\,\\mathrm{USD}\n$$\n\n在计算出避免成本和增加成本后，我们可以计算净节省 $\\mathrm{NS}$。\n$$\n\\mathrm{NS} = \\mathrm{AC} - \\mathrm{AddC} = 1.50 - 1.6875 = -0.1875\\,\\mathrm{USD}\n$$\n负号表示净成本，而不是节省。值 $-0.1875$ 有四位有效数字。\n\n最后，我们计算反弹幅度 $\\mathrm{RM}$。\n$$\n\\mathrm{RM} = \\frac{\\mathrm{AddC}}{\\mathrm{AC}} = \\frac{1.6875}{1.50} = 1.125\n$$\n这是一个无单位的比率。值 $1.125$ 有四位有效数字。\n\n最终计算值，按要求四舍五入到四位有效数字（这不需要改变精确结果），为净节省 $-0.1875\\,\\mathrm{USD}$ 和反弹幅度 $1.125$。",
            "answer": "$$\\boxed{\\begin{pmatrix} -0.1875  1.125 \\end{pmatrix}}$$"
        },
        {
            "introduction": "高级的需求侧管理模型需要在价格信号、用户舒适度和物理约束之间寻求最佳平衡。本练习将引导您构建一个二次规划模型，该模型旨在最小化用户的总广义成本（电费与不适度成本之和），同时遵守用电负荷的斜坡限制。您需要运用Karush-Kuhn-Tucker (KKT) 条件推导出该问题的解析解，并将其编写为代码来解决一系列测试案例，从而全面锻炼从理论建模到算法实现的综合能力 。",
            "id": "4083925",
            "problem": "考虑一个简单的需求侧管理模型，该模型针对单个灵活用电终端，涵盖两个决策周期，用电量变量为 $x_1$ 和 $x_2$，单位均为千瓦时 (kWh)。该用电终端面临一个价格向量 $(p_1,p_2)$，其中每个 $p_t$ 的单位为货币单位/千瓦时 ($$/\\text{kWh}$)。客户有一个偏好的用电曲线 $(x_1^{\\text{pref}},x_2^{\\text{pref}})$，单位为千瓦时 (kWh)。偏离此偏好曲线会产生不适成本，该成本被建模为一个二次惩罚项，权重为 $\\alpha$，单位为货币单位/平方千瓦时 ($$/\\text{kWh}^2$)。跨期灵活性受到爬坡约束 $|x_{t+1}-x_t| \\le r$ 的限制，其中 $r$ 的单位为千瓦时 (kWh)。\n\n根据成本最小化下的消费者选择基本原则，我们将该决策问题建模为最小化由电费和不适成本组成的广义总成本，并受到物理灵活性约束的限制。形式上，该优化问题为\n$$\n\\min_{x_1,x_2}\\ \\sum_{t=1}^{2} \\left( p_t x_t + \\alpha \\left(x_t - x_t^{\\text{pref}}\\right)^2 \\right)\n$$\n约束条件为\n$$\n|x_2 - x_1| \\le r.\n$$\n假设 $\\alpha > 0$，因此目标函数是严格凸的，可行集是凸集，这保证了存在唯一的极小值点。\n\n您的任务是：\n- 基于基本原理和 Karush–Kuhn–Tucker (KKT) 条件，推导出一个闭式算法，用于计算在任意给定参数 $(\\alpha,r,p_1,p_2,x_1^{\\text{pref}},x_2^{\\text{pref}})$ 下的唯一最优解 $(x_1^\\star,x_2^\\star)$（单位为 kWh）。\n- 将此算法实现为一个完整的、可运行的程序，为以下测试套件评估解决方案。报告每个 $(x_1^\\star,x_2^\\star)$ 的值（单位为 kWh）。\n\n使用以下五个科学上一致的测试用例（所有量均采用其规定的基本单位）：\n1. $\\alpha=0.10$, $r=1.5$, $p_1=0.20$, $p_2=0.12$, $x_1^{\\text{pref}}=5.0$, $x_2^{\\text{pref}}=5.5$。\n2. $\\alpha=0.08$, $r=0.5$, $p_1=0.10$, $p_2=0.05$, $x_1^{\\text{pref}}=2.0$, $x_2^{\\text{pref}}=4.0$。\n3. $\\alpha=0.05$, $r=1.0$, $p_1=0.15$, $p_2=0.25$, $x_1^{\\text{pref}}=6.0$, $x_2^{\\text{pref}}=3.0$。\n4. $\\alpha=0.10$, $r=2.0$, $p_1=0.20$, $p_2=0.20$, $x_1^{\\text{pref}}=5.0$, $x_2^{\\text{pref}}=7.0$。\n5. $\\alpha=0.04$, $r=2.0$, $p_1=0.10$, $p_2=-0.05$, $x_1^{\\text{pref}}=3.0$, $x_2^{\\text{pref}}=3.0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个测试用例结果本身就是一个双元素列表 $[x_1^\\star,x_2^\\star]$（单位为 kWh）。例如，格式应类似于 $[[a,b],[c,d],\\ldots]$，所有条目均以实数形式给出（单位为 kWh）。",
            "solution": "用户要求我解决一个与能源系统中需求侧管理相关的约束优化问题。\n\n我的计划如下：\n1.  **验证问题陈述。**\n    *   **步骤 1：提取给定条件。** 我将完全按照提供的方式列出所有变量、常数、目标函数和约束。\n    *   **步骤 2：验证。** 我将检查问题的科学依据、适定性、客观性及其他标准。\n        *   **科学依据：** 该模型是能源经济学中灵活性负荷的标准表示。它在服从线性约束（爬坡）的条件下，最小化一个二次成本函数（不适成本）加上一个线性成本（电费）。这是一个成熟的二次规划（QP）范式。单位是一致的。\n        *   **适定性：** 由于 $\\alpha > 0$，目标函数是严格凸的。由 $|x_2 - x_1| \\le r$ 定义的可行集是一个凸集。一个在非空凸集上的严格凸函数有唯一的最小值。该问题是适定的。\n        *   **客观性：** 问题使用数学公式和客观语言描述。\n        *   **完整性：** 所有必要的参数 ($\\alpha, r, p_1, p_2, x_1^{\\text{pref}}, x_2^{\\text{pref}}$) 均已定义，并提供了测试用例。\n        *   **一致性：** 单位是一致的。例如，目标函数的各项单位都是货币单位。$p_t x_t$ 是 ($/kWh) * (kWh) = $。$\\alpha(x_t - x_t^{\\text{pref}})^2$ 是 ($/kWh^2) * (kWh)^2 = $。这没有问题。\n    *   **步骤 3：结论。** 问题似乎是有效的。我将继续进行求解。\n\n2.  **解决问题。**\n    *   **推导闭式解。** 这是任务的核心。我需要使用 Karush-Kuhn-Tucker (KKT) 条件。\n    *   问题是：\n        $$\n        \\min_{x_1,x_2} f(x_1, x_2) = p_1 x_1 + \\alpha (x_1 - x_1^{\\text{pref}})^2 + p_2 x_2 + \\alpha (x_2 - x_2^{\\text{pref}})^2\n        $$\n        约束条件为：\n        $$\n        g_1(x_1, x_2) = x_2 - x_1 - r \\le 0 \\\\\n        $$\n        $$\n        g_2(x_1, x_2) = x_1 - x_2 - r \\le 0\n        $$\n    *   拉格朗日函数为：\n        $$\n        L(x_1, x_2, \\lambda_1, \\lambda_2) = f(x_1, x_2) + \\lambda_1(x_2 - x_1 - r) + \\lambda_2(x_1 - x_2 - r)\n        $$\n        其中 $\\lambda_1, \\lambda_2 \\ge 0$ 是拉格朗日乘子。\n    *   KKT 条件是：\n        1.  **平稳性 (Stationarity)：**\n            $$\n            \\frac{\\partial L}{\\partial x_1} = p_1 + 2\\alpha(x_1 - x_1^{\\text{pref}}) - \\lambda_1 + \\lambda_2 = 0 \\\\\n            $$\n            $$\n            \\frac{\\partial L}{\\partial x_2} = p_2 + 2\\alpha(x_2 - x_2^{\\text{pref}}) + \\lambda_1 - \\lambda_2 = 0\n            $$\n        2.  **原始可行性 (Primal Feasibility)：**\n            $$\n            x_2 - x_1 \\le r \\\\\n            $$\n            $$\n            x_1 - x_2 \\le r\n            $$\n        3.  **对偶可行性 (Dual Feasibility)：**\n            $$\n            \\lambda_1 \\ge 0 \\\\\n            $$\n            $$\n            \\lambda_2 \\ge 0\n            $$\n        4.  **互补松弛性 (Complementary Slackness)：**\n            $$\n            \\lambda_1(x_2 - x_1 - r) = 0 \\\\\n            $$\n            $$\n            \\lambda_2(x_1 - x_2 - r) = 0\n            $$\n\n    *   **KKT 条件分析：**\n        我们来简化平稳性方程：\n        $$\n        2\\alpha(x_1 - x_1^{\\text{pref}}) = -p_1 + \\lambda_1 - \\lambda_2 \\implies x_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1 - \\lambda_2}{2\\alpha} \\\\\n        $$\n        $$\n        2\\alpha(x_2 - x_2^{\\text{pref}}) = -p_2 - \\lambda_1 + \\lambda_2 \\implies x_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1 - \\lambda_2}{2\\alpha}\n        $$\n\n    *   我们定义“无约束”解，它对应于爬坡约束不生效的情况。这种情况发生在 $\\lambda_1 = 0$ 和 $\\lambda_2 = 0$ 时。\n        我们将此解称为 $(\\hat{x}_1, \\hat{x}_2)$。\n        $$\n        \\hat{x}_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} \\\\\n        $$\n        $$\n        \\hat{x}_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}\n        $$\n        这是在没有任何约束的情况下最小化目标函数的解。它就是目标函数梯度为零的点。\n\n    *   **情况 1：无约束解是可行的。**\n        如果 $|\\hat{x}_2 - \\hat{x}_1| \\le r$，那么无约束解就是最优解。在这种情况下，$(\\lambda_1, \\lambda_2) = (0, 0)$ 平凡地满足所有 KKT 条件。\n        因此，如果 $|(x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}) - (x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha})| \\le r$，则\n        $$\n        x_1^\\star = \\hat{x}_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} \\\\\n        $$\n        $$\n        x_2^\\star = \\hat{x}_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}\n        $$\n\n    *   **情况 2：爬坡约束生效：$x_2 - x_1 = r$。**\n        这意味着无约束解违反了上界，即 $\\hat{x}_2 - \\hat{x}_1 > r$。\n        根据互补松弛性，我们必须有 $\\lambda_1 > 0$ 和 $\\lambda_2 = 0$。\n        KKT 条件变为：\n        $$\n        x_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1}{2\\alpha} \\\\\n        $$\n        $$\n        x_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1}{2\\alpha} \\\\\n        $$\n        $$\n        x_2 - x_1 = r\n        $$\n        让我们将 $x_1$ 和 $x_2$ 的表达式代入约束方程：\n        $$\n        \\left(x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1}{2\\alpha}\\right) - \\left(x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1}{2\\alpha}\\right) = r\n        $$\n        $$\n        (x_2^{\\text{pref}} - x_1^{\\text{pref}}) - \\frac{p_2 - p_1}{2\\alpha} - \\frac{2\\lambda_1}{2\\alpha} = r\n        $$\n        回想一下无约束解的定义：$\\hat{x}_2 - \\hat{x}_1 = (x_2^{\\text{pref}} - x_1^{\\text{pref}}) - \\frac{p_2 - p_1}{2\\alpha}$。\n        所以，方程变为：\n        $$\n        \\hat{x}_2 - \\hat{x}_1 - \\frac{\\lambda_1}{\\alpha} = r\n        $$\n        求解 $\\lambda_1$：\n        $$\n        \\lambda_1 = \\alpha (\\hat{x}_2 - \\hat{x}_1 - r)\n        $$\n        因为我们处于 $\\hat{x}_2 - \\hat{x}_1 > r$ 的情况，所以我们有 $\\lambda_1 > 0$，这与我们的假设是一致的。\n        现在我们可以求出 $x_1^\\star$ 和 $x_2^\\star$。令 $\\lambda = \\lambda_1 - \\lambda_2$。此处 $\\lambda = \\lambda_1$。\n        $$\n        x_1^\\star = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1}{2\\alpha} = \\hat{x}_1 + \\frac{\\lambda_1}{2\\alpha} \\\\\n        $$\n        $$\n        x_2^\\star = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1}{2\\alpha} = \\hat{x}_2 - \\frac{\\lambda_1}{2\\alpha}\n        $$\n        代入 $\\lambda_1$ 的表达式：\n        $$\n        x_1^\\star = \\hat{x}_1 + \\frac{\\alpha (\\hat{x}_2 - \\hat{x}_1 - r)}{2\\alpha} = \\hat{x}_1 + \\frac{\\hat{x}_2 - \\hat{x}_1 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} \\\\\n        $$\n        $$\n        x_2^\\star = \\hat{x}_2 - \\frac{\\alpha (\\hat{x}_2 - \\hat{x}_1 - r)}{2\\alpha} = \\hat{x}_2 - \\frac{\\hat{x}_2 - \\hat{x}_1 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2}\n        $$\n        我们可以检查是否 $x_2^\\star - x_1^\\star = r$：\n        $$\n        \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} - \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} = \\frac{2r}{2} = r\n        $$\n        成立。因此，如果 $\\hat{x}_2 - \\hat{x}_1 > r$，最优解是：\n        $$\n        x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} \\\\\n        $$\n        $$\n        x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2}\n        $$\n\n    *   **情况 3：爬坡约束生效：$x_1 - x_2 = r$。**\n        这意味着无约束解违反了下界，即 $\\hat{x}_2 - \\hat{x}_1 < -r$。\n        根据互补松弛性，我们必须有 $\\lambda_2 > 0$ 和 $\\lambda_1 = 0$。\n        KKT 条件变为：\n        $$\n        x_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} - \\frac{\\lambda_2}{2\\alpha} \\\\\n        $$\n        $$\n        x_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} + \\frac{\\lambda_2}{2\\alpha} \\\\\n        $$\n        $$\n        x_1 - x_2 = r\n        $$\n        将 $x_1, x_2$ 代入约束：\n        $$\n        \\left(x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} - \\frac{\\lambda_2}{2\\alpha}\\right) - \\left(x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} + \\frac{\\lambda_2}{2\\alpha}\\right) = r\n        $$\n        $$\n        (x_1^{\\text{pref}} - x_2^{\\text{pref}}) - \\frac{p_1 - p_2}{2\\alpha} - \\frac{2\\lambda_2}{2\\alpha} = r\n        $$\n        $$\n        -(\\hat{x}_2 - \\hat{x}_1) - \\frac{\\lambda_2}{\\alpha} = r \\implies \\hat{x}_1 - \\hat{x}_2 - \\frac{\\lambda_2}{\\alpha} = r\n        $$\n        求解 $\\lambda_2$：\n        $$\n        \\lambda_2 = \\alpha (\\hat{x}_1 - \\hat{x}_2 - r)\n        $$\n        因为我们处于 $\\hat{x}_2 - \\hat{x}_1 < -r$（或 $\\hat{x}_1 - \\hat{x}_2 > r$）的情况，所以我们有 $\\lambda_2 > 0$，这是一致的。\n        现在求 $x_1^\\star$ 和 $x_2^\\star$：\n        $$\n        x_1^\\star = \\hat{x}_1 - \\frac{\\lambda_2}{2\\alpha} = \\hat{x}_1 - \\frac{\\alpha(\\hat{x}_1 - \\hat{x}_2 - r)}{2\\alpha} = \\hat{x}_1 - \\frac{\\hat{x}_1 - \\hat{x}_2 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} \\\\\n        $$\n        $$\n        x_2^\\star = \\hat{x}_2 + \\frac{\\lambda_2}{2\\alpha} = \\hat{x}_2 + \\frac{\\alpha(\\hat{x}_1 - \\hat{x}_2 - r)}{2\\alpha} = \\hat{x}_2 + \\frac{\\hat{x}_1 - \\hat{x}_2 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2}\n        $$\n        我们可以检查是否 $x_1^\\star - x_2^\\star = r$：\n        $$\n        \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} - \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} = \\frac{2r}{2} = r\n        $$\n        成立。因此，如果 $\\hat{x}_2 - \\hat{x}_1 < -r$，最优解是：\n        $$\n        x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} \\\\\n        $$\n        $$\n        x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2}\n        $$\n\n    *   **闭式算法总结：**\n        1.  给定参数 $(\\alpha, r, p_1, p_2, x_1^{\\text{pref}}, x_2^{\\text{pref}})$。\n        2.  计算无约束极小值点：\n            $$\n            \\hat{x}_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} \\\\\n            $$\n            $$\n            \\hat{x}_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}\n            $$\n        3.  计算差值：\n            $$\n            \\Delta\\hat{x} = \\hat{x}_2 - \\hat{x}_1\n            $$\n        4.  应用情况逻辑：\n            *   如果 $\\Delta\\hat{x} > r$：（上爬坡约束生效）\n                $$\n                x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} \\\\\n                $$\n                $$\n                x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2}\n                $$\n            *   如果 $\\Delta\\hat{x} < -r$：（下爬坡约束生效）\n                $$\n                x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} \\\\\n                $$\n                $$\n                x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2}\n                $$\n            *   否则（即 $-r \\le \\Delta\\hat{x} \\le r$）：（约束不生效）\n                $$\n                x_1^\\star = \\hat{x}_1 \\\\\n                $$\n                $$\n                x_2^\\star = \\hat{x}_2\n                $$",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal consumption profile (x1, x2) for a series of\n    demand-side management test cases based on a derived closed-form solution.\n    \"\"\"\n\n    test_cases = [\n        # (alpha, r, p1, p2, x1_pref, x2_pref)\n        (0.10, 1.5, 0.20, 0.12, 5.0, 5.5),\n        (0.08, 0.5, 0.10, 0.05, 2.0, 4.0),\n        (0.05, 1.0, 0.15, 0.25, 6.0, 3.0),\n        (0.10, 2.0, 0.20, 0.20, 5.0, 7.0),\n        (0.04, 2.0, 0.10, -0.05, 3.0, 3.0),\n    ]\n\n    results = []\n\n    def calculate_optimal_consumption(alpha, r, p1, p2, x1_pref, x2_pref):\n        \"\"\"\n        Implements the closed-form algorithm to find the optimal consumption profile (x1*, x2*).\n\n        The algorithm first computes the unconstrained cost minimizers and then checks if they\n        satisfy the ramping constraint. If they don't, the solution lies on the boundary\n        of the feasible region, and the corresponding closed-form is used.\n\n        Args:\n            alpha (float): Discomfort cost weight ($/kWh^2).\n            r (float): Ramping limit (kWh).\n            p1 (float): Price at time t=1 ($/kWh).\n            p2 (float): Price at time t=2 ($/kWh).\n            x1_pref (float): Preferred consumption at time t=1 (kWh).\n            x2_pref (float): Preferred consumption at time t=2 (kWh).\n\n        Returns:\n            list: A list containing the optimal consumption values [x1_star, x2_star].\n        \"\"\"\n        # Step 1: Calculate the unconstrained minimizers (where gradient of objective is zero)\n        x1_hat = x1_pref - p1 / (2 * alpha)\n        x2_hat = x2_pref - p2 / (2 * alpha)\n\n        # Step 2: Calculate the difference in unconstrained consumption\n        delta_x_hat = x2_hat - x1_hat\n\n        # Step 3: Apply case logic based on the ramping constraint\n        if delta_x_hat > r:\n            # Case: Upper ramp constraint is binding (x2 - x1 = r)\n            x1_star = (x1_hat + x2_hat - r) / 2\n            x2_star = (x1_hat + x2_hat + r) / 2\n        elif delta_x_hat  -r:\n            # Case: Lower ramp constraint is binding (x1 - x2 = r, or x2 - x1 = -r)\n            x1_star = (x1_hat + x2_hat + r) / 2\n            x2_star = (x1_hat + x2_hat - r) / 2\n        else:\n            # Case: Unconstrained solution is feasible (-r = delta_x_hat = r)\n            x1_star = x1_hat\n            x2_star = x2_hat\n            \n        return [x1_star, x2_star]\n\n    for case in test_cases:\n        alpha, r, p1, p2, x1_pref, x2_pref = case\n        optimal_x = calculate_optimal_consumption(alpha, r, p1, p2, x1_pref, x2_pref)\n        results.append(optimal_x)\n\n    # Format the results into the required string format \"[[a,b],[c,d],...]\"\n    # using map(str, ...) which correctly handles list-to-string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}