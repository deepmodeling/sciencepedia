{
    "hands_on_practices": [
        {
            "introduction": "需求侧管理的核心目标之一是将能源消耗从高成本的峰值时段转移到低成本的非峰值时段。这种转移的经济价值并非凭空产生，而是由电力系统的基本发电成本特性决定的。本练习提供了一个简化但功能强大的模型，用于从第一性原理推导负荷转移所产生的成本节约，其中发电的边际成本 $MC(g)$ 随发电量 $g$ 的增加而增加。通过解决这个问题，您将理解发电成本函数的凸性是实现这些节约的根本来源。",
            "id": "4083927",
            "problem": "考虑一个程式化的两期能源系统，该系统由一个单一代表性供应堆栈运营，其凸边际成本函数为 $MC(g)=\\alpha+\\beta g$，其中 $\\beta>0$ 且 $\\alpha\\geq 0$。设高成本时段的基准净负荷为 $d_{h}>0$，低成本时段的基准净负荷为 $d_{\\ell}\\geq 0$，且 $d_{h}>d_{\\ell}$，因此 $MC(d_{h})>MC(d_{\\ell})$。一次需求侧管理 (DSM) 干预将 $0  \\Delta \\leq d_h$ 单位的输送能量从高成本时段转移到低成本时段，此过程无损耗、无反弹，且两个时段的总能耗不变。总可变生产成本函数为 $C(g)=\\alpha g+\\frac{1}{2}\\beta g^{2}$，系统在两个时段内的总成本是根据各自时段负荷计算的各时段成本之和。\n\n从边际成本是总成本的导数的定义出发，利用 $\\beta0$ 所隐含的 $C(\\cdot)$ 的凸性，以及成本在独立时段间的可加性，推导由于 DSM 转移带来的系统生产成本节约的精确闭式表达式。成本节约定义为基准总成本减去转移后总成本。最终节约额以美元表示。无需四舍五入。",
            "solution": "在尝试求解之前，对问题进行验证。\n\n### 第一步：提取已知条件\n-   供应堆栈的边际成本函数：$MC(g)=\\alpha+\\beta g$\n-   边际成本函数的参数：$\\beta0$ 和 $\\alpha\\geq 0$\n-   高成本时段的基准净负荷：$d_h  0$\n-   低成本时段的基准净负荷：$d_\\ell \\geq 0$\n-   基准负荷之间的关系：$d_h  d_\\ell$\n-   需求侧管理 (DSM) 能量转移：$\\Delta$ 单位，且 $0  \\Delta \\leq d_h$\n-   DSM 特性：无损耗、无反弹、总能耗不变。\n-   总可变生产成本函数：$C(g)=\\alpha g+\\frac{1}{2}\\beta g^{2}$\n-   系统总成本定义：各时段成本之和。\n-   目标：推导系统生产成本节约的闭式表达式，定义为基准总成本减去转移后总成本。\n\n### 第二步：使用提取的已知条件进行验证\n根据既定标准对问题进行评估。\n\n-   **科学依据：** 问题基于微观经济学和能源系统工程的基本原理。使用线性边际成本函数 ($MC$) 对应二次总成本函数 ($C$) 是简化发电堆栈的标准有效模型。条件 $\\beta  0$ 确保了成本函数的凸性 ($C''(g) = \\beta  0$)，这正确地模拟了优先调度成本较低的发电机组、从而导致边际成本递增的经济学原理。总成本与边际成本之间的关系是一致的，因为给定的总成本函数 $C(g)$ 对发电量 $g$ 的导数为 $\\frac{d}{dg}(\\alpha g + \\frac{1}{2}\\beta g^{2}) = \\alpha + \\beta g$，这正是给定的边际成本函数 $MC(g)$。\n-   **适定性：** 问题是适定的。所有必要的函数、参数和约束都已明确定义。目标清晰明确，要求进行特定的解析推导。给定的信息足以推导出唯一解。\n-   **客观性：** 问题以精确、客观和数学化的语言陈述，不含任何主观或基于观点的内容。\n-   **完整性与一致性：** 问题是自洽的。所提供的数据和定义是完整且内部一致的。例如，约束 $\\Delta \\leq d_h$ 确保了转移后高成本时段的负荷 $d_h - \\Delta$ 为非负。“总能量不变”的条件也定义明确。\n-   **现实性：** 如问题所述，该模型是“程式化的”，但其组成部分基于现实原理。无损耗或无反弹效应的假设是入门模型中常见的简化，旨在分离负荷转移的主要经济效应。\n-   **结构性：** 问题结构逻辑清晰，需要根据所提供的定义进行直接推导。它不是不适定的、无关紧要的或循环论证的。\n\n### 第三步：结论与行动\n问题是有效的，因为它在数学上是一致的、有科学依据的并且是适定的。将推导解答。\n\n系统的总成本是两个时段成本的总和。每个时段的成本由总可变生产成本函数 $C(g)=\\alpha g+\\frac{1}{2}\\beta g^{2}$ 决定。\n\n首先，我们定义基准情景下的系统总成本，记为 $C_{total}^{base}$。在此情景下，高成本时段和低成本时段的发电量分别等于各自的净负荷 $d_h$ 和 $d_\\ell$。\n$$C_{total}^{base} = C(d_h) + C(d_\\ell)$$\n代入 $C(g)$ 的表达式，我们得到：\n$$C_{total}^{base} = \\left(\\alpha d_h + \\frac{1}{2}\\beta d_h^2\\right) + \\left(\\alpha d_\\ell + \\frac{1}{2}\\beta d_\\ell^2\\right)$$\n\n接下来，我们定义 DSM 干预后的系统总成本，记为 $C_{total}^{post}$。该干预将 $\\Delta$ 单位的能量从高成本时段转移到低成本时段。\n高成本时段的新发电水平为 $g_h^{post} = d_h - \\Delta$。\n低成本时段的新发电水平为 $g_\\ell^{post} = d_\\ell + \\Delta$。\n转移后情景的总成本为：\n$$C_{total}^{post} = C(g_h^{post}) + C(g_\\ell^{post}) = C(d_h - \\Delta) + C(d_\\ell + \\Delta)$$\n代入 $C(g)$ 的表达式：\n$$C_{total}^{post} = \\left[\\alpha(d_h - \\Delta) + \\frac{1}{2}\\beta(d_h - \\Delta)^2\\right] + \\left[\\alpha(d_\\ell + \\Delta) + \\frac{1}{2}\\beta(d_\\ell + \\Delta)^2\\right]$$\n\n系统生产成本节约额（我们记为 $S$）定义为基准总成本减去转移后总成本。\n$$S = C_{total}^{base} - C_{total}^{post}$$\n代入成本的详细表达式：\n$$S = \\left[ \\left(\\alpha d_h + \\frac{1}{2}\\beta d_h^2\\right) + \\left(\\alpha d_\\ell + \\frac{1}{2}\\beta d_\\ell^2\\right) \\right] - \\left[ \\left(\\alpha(d_h - \\Delta) + \\frac{1}{2}\\beta(d_h - \\Delta)^2\\right) + \\left(\\alpha(d_\\ell + \\Delta) + \\frac{1}{2}\\beta(d_\\ell + \\Delta)^2\\right) \\right]$$\n\n现在我们通过将含 $\\alpha$ 的项和含 $\\beta$ 的项分组来简化此表达式。\n包含 $\\alpha$ 的项是：\n$$(\\alpha d_h + \\alpha d_\\ell) - (\\alpha(d_h - \\Delta) + \\alpha(d_\\ell + \\Delta))$$\n$$= \\alpha d_h + \\alpha d_\\ell - (\\alpha d_h - \\alpha\\Delta + \\alpha d_\\ell + \\alpha\\Delta)$$\n$$= \\alpha d_h + \\alpha d_\\ell - (\\alpha d_h + \\alpha d_\\ell) = 0$$\n正如预期的那样，发电量中的线性项相互抵消，因为两个时段的总发电量 $(d_h - \\Delta) + (d_\\ell + \\Delta) = d_h + d_\\ell$ 是守恒的。\n\n剩余的包含 $\\beta$ 的项决定了节约额：\n$$S = \\left(\\frac{1}{2}\\beta d_h^2 + \\frac{1}{2}\\beta d_\\ell^2\\right) - \\left(\\frac{1}{2}\\beta(d_h - \\Delta)^2 + \\frac{1}{2}\\beta(d_\\ell + \\Delta)^2\\right)$$\n提出因子 $\\frac{1}{2}\\beta$：\n$$S = \\frac{1}{2}\\beta \\left[ (d_h^2 + d_\\ell^2) - \\left((d_h - \\Delta)^2 + (d_\\ell + \\Delta)^2\\right) \\right]$$\n展开平方项：\n$$(d_h - \\Delta)^2 = d_h^2 - 2d_h\\Delta + \\Delta^2$$\n$$(d_\\ell + \\Delta)^2 = d_\\ell^2 + 2d_\\ell\\Delta + \\Delta^2$$\n将这些展开式代回 $S$ 的表达式中：\n$$S = \\frac{1}{2}\\beta \\left[ (d_h^2 + d_\\ell^2) - (d_h^2 - 2d_h\\Delta + \\Delta^2 + d_\\ell^2 + 2d_\\ell\\Delta + \\Delta^2) \\right]$$\n简化方括号内的表达式：\n$$S = \\frac{1}{2}\\beta \\left[ d_h^2 + d_\\ell^2 - d_h^2 + 2d_h\\Delta - \\Delta^2 - d_\\ell^2 - 2d_\\ell\\Delta - \\Delta^2 \\right]$$\n项 $d_h^2$ 和 $d_\\ell^2$ 相互抵消。\n$$S = \\frac{1}{2}\\beta \\left[ 2d_h\\Delta - 2d_\\ell\\Delta - 2\\Delta^2 \\right]$$\n从括号内的项中提出因子 $2\\Delta$：\n$$S = \\frac{1}{2}\\beta \\cdot 2\\Delta \\left[ (d_h - d_\\ell) - \\Delta \\right]$$\n这可以简化为成本节约的最终闭式表达式：\n$$S = \\beta \\Delta (d_h - d_\\ell - \\Delta)$$\n该表达式代表了由 DSM 引起的 $\\Delta$ 单位能耗转移所产生的总生产成本节约额（以美元计）。如果转移量 $\\Delta$ 小于初始负荷差 $d_h - d_\\ell$，则节约额为正。由 $\\beta  0$ 保证的成本函数的凸性是这些节约额的根本驱动因素。",
            "answer": "$$\n\\boxed{\\beta \\Delta (d_h - d_\\ell - \\Delta)}\n$$"
        },
        {
            "introduction": "在理解了负荷转移能够创造价值的基本原理之后，下一个实际问题是如何具体安排这些灵活性负荷以实现成本最小化。许多居民和商业负荷，例如特定工业流程或家用电器，可以被建模为需要满足特定运行约束的离散任务。本练习提出了一个典型的离散调度问题，您需要为两个具有连续运行时间和互斥约束的电器找到成本最低的运行时间组合。解决这个问题将帮助您掌握实际需求侧管理调度问题中常见的组合优化思维。",
            "id": "4083945",
            "problem": "一家电力公司正在设计一个需求侧管理（DSM）项目，该项目在一个6小时的时间范围内进行，时间步长为小时，由 $t \\in \\{1,2,3,4,5,6\\}$ 索引。有两个用户的电器，由 $a \\in \\{1,2\\}$ 索引，它们是可调度的，每个电器都需要以1千瓦（$1\\ \\mathrm{kW}$）的恒定功率连续运行恰好2小时。系统强制执行容量限制，使得同时运行的功率最多为1千瓦（$1\\ \\mathrm{kW}$）。随时间变化的能源价格由小时向量 $(p_1,p_2,p_3,p_4,p_5,p_6)=(30,100,80,40,20,60)$ 给出，单位为美元/兆瓦时（$\\$/\\mathrm{MWh}$）。假设固定的时间步长为1小时，因此一个电器在任何一个活动小时内消耗的能量为1千瓦时（$1\\ \\mathrm{kWh}$），即等于 $10^{-3}$ 兆瓦时（$\\mathrm{MWh}$）。\n\n使用二进制变量 $x_{a,t} \\in \\{0,1\\}$ 将此调度问题建模为一个混合整数决策问题，其中 $x_{a,t}$ 表示电器 $a$ 在小时 $t$ 是否开启，并满足以下条件：\n- 每个电器恰好连续运行2小时。\n- 对所有 $t$，同时运行的约束为 $\\sum_{a=1}^{2} x_{a,t} \\leq 1$。\n\n总成本是每小时成本的总和，其中小时 $t$ 的成本等于 $p_t$ 乘以该小时消耗的能量（以$\\mathrm{MWh}$为单位）。\n\n根据负荷调度的基本原理和上述约束，推导最优解的结构，并确定最优调度下的最低总成本（以美元计）。用美元表示最终的最低总成本，并将答案四舍五入到四位有效数字。使用美元作为成本单位（在最终的方框答案中不要包含单位）。",
            "solution": "该问题要求计算在特定约束条件下运行两个电器的最低总成本。这是一个经典的负荷调度优化问题。我们将通过分析可行调度及其相关成本的结构，从基本原理出发确定解决方案。\n\n首先，我们根据所提供的信息将问题形式化。\n时间范围包括6个离散的小时步骤，$t \\in \\{1, 2, 3, 4, 5, 6\\}$。\n有两个电器，$a \\in \\{1, 2\\}$。每个电器必须连续运行恰好2小时。\n一个活动电器的功耗为 $P = 1 \\text{ kW}$。\n时间步长为 $\\Delta t = 1 \\text{ h}$。\n一个电器在一个活动小时内消耗的能量为 $E_{hour} = P \\times \\Delta t = 1 \\text{ kW} \\times 1 \\text{ h} = 1 \\text{ kWh}$。\n价格 $p_t$ 的单位是 美元/兆瓦时（$/MWh$）。我们必须将能量单位转换为兆瓦时（MWh）：$E_{hour} = 1 \\text{ kWh} = 10^{-3} \\text{ MWh}$。\n每小时的价格由向量 $(p_1, p_2, p_3, p_4, p_5, p_6) = (30, 100, 80, 40, 20, 60)$ 给出，单位为 美元/兆瓦时（$/MWh$）。\n\n问题的核心是确定两个电器的最优启动时间。设 $s_a$ 为电器 $a$ 进行2小时运行的启动时间。在一个6小时的时间范围内，一个2小时任务可能的启动时间为 $s_a \\in \\{1, 2, 3, 4, 5\\}$。如果一个电器在时间 $s$ 启动，它将在小时 $s$ 和 $s+1$ 运行。\n\n从时间 $s$ 开始运行一个电器的成本是小时 $s$ 和 $s+1$ 的能源成本之和。由于两个电器的额定功率相同，此成本仅取决于启动时间 $s$。我们将此成本表示为 $C(s)$：\n$$C(s) = (p_s \\cdot E_{hour}) + (p_{s+1} \\cdot E_{hour}) = (p_s + p_{s+1}) \\times 10^{-3} \\text{ 美元}$$\n\n让我们计算每个可能的2小时运行区块的成本：\n对于启动时间 $s=1$（在小时1、2运行）：\n$C(1) = (p_1 + p_2) \\times 10^{-3} = (30 + 100) \\times 10^{-3} = 130 \\times 10^{-3}$ 美元。\n对于启动时间 $s=2$（在小时2、3运行）：\n$C(2) = (p_2 + p_3) \\times 10^{-3} = (100 + 80) \\times 10^{-3} = 180 \\times 10^{-3}$ 美元。\n对于启动时间 $s=3$（在小时3、4运行）：\n$C(3) = (p_3 + p_4) \\times 10^{-3} = (80 + 40) \\times 10^{-3} = 120 \\times 10^{-3}$ 美元。\n对于启动时间 $s=4$（在小时4、5运行）：\n$C(4) = (p_4 + p_5) \\times 10^{-3} = (40 + 20) \\times 10^{-3} = 60 \\times 10^{-3}$ 美元。\n对于启动时间 $s=5$（在小时5、6运行）：\n$C(5) = (p_5 + p_6) \\times 10^{-3} = (20 + 60) \\times 10^{-3} = 80 \\times 10^{-3}$ 美元。\n\n系统有一个容量限制，即最多只能有 $1 \\text{ kW}$ 的功率同时运行。这意味着两个电器不能在同一小时内运行。如果电器1在 $s_1$ 启动，电器2在 $s_2$ 启动，它们的运行区间分别是 $[s_1, s_1+1]$ 和 $[s_2, s_2+1]$。为了使这些区间不相交，启动时间必须有足够的分隔。如果 $s_1 = s_2$，或者一个电器比另一个晚一小时启动（例如 $s_2 = s_1+1$），就会发生重叠。因此，启动时间必须至少相隔2小时，这在数学上表示为 $|s_1 - s_2| \\geq 2$。\n\n问题现在简化为从集合 $\\{1, 2, 3, 4, 5\\}$ 中选择两个不同的启动时间 $s_a$ 和 $s_b$，使得 $|s_a - s_b| \\geq 2$，并且总成本 $C(s_a) + C(s_b)$ 最小化。我们可以通过系统地枚举所有有效的启动时间对来找到最低成本。不失一般性，我们假设 $s_a  s_b$。\n\n满足 $s_b - s_a \\geq 2$ 的有效对 $(s_a, s_b)$ 及其相应的总成本如下：\n\\begin{enumerate}\n    \\item 对 $(1, 3)$：电器在 $t=1$ 和 $t=3$ 启动。调度不相交。\n    总成本 = $C(1) + C(3) = (130 + 120) \\times 10^{-3} = 250 \\times 10^{-3} = 0.250$ 美元。\n    \\item 对 $(1, 4)$：电器在 $t=1$ 和 $t=4$ 启动。调度不相交。\n    总成本 = $C(1) + C(4) = (130 + 60) \\times 10^{-3} = 190 \\times 10^{-3} = 0.190$ 美元。\n    \\item 对 $(1, 5)$：电器在 $t=1$ 和 $t=5$ 启动。调度不相交。\n    总成本 = $C(1) + C(5) = (130 + 80) \\times 10^{-3} = 210 \\times 10^{-3} = 0.210$ 美元。\n    \\item 对 $(2, 4)$：电器在 $t=2$ 和 $t=4$ 启动。调度不相交。\n    总成本 = $C(2) + C(4) = (180 + 60) \\times 10^{-3} = 240 \\times 10^{-3} = 0.240$ 美元。\n    \\item 对 $(2, 5)$：电器在 $t=2$ 和 $t=5$ 启动。调度不相交。\n    总成本 = $C(2) + C(5) = (180 + 80) \\times 10^{-3} = 260 \\times 10^{-3} = 0.260$ 美元。\n    \\item 对 $(3, 5)$：电器在 $t=3$ 和 $t=5$ 启动。调度不相交。\n    总成本 = $C(3) + C(5) = (120 + 80) \\times 10^{-3} = 200 \\times 10^{-3} = 0.200$ 美元。\n\\end{enumerate}\n\n比较为每个有效对计算的总成本，最小值为 $0.190$ 美元。该成本对应于一个电器在 $t=1$ 启动（在小时1和2运行）而另一个在 $t=4$ 启动（在小时4和5运行）的调度。\n\n在此最优调度中，总能量消耗发生在小时1、2、4和5。总成本为：\n成本 = $(p_1 + p_2 + p_4 + p_5) \\times 10^{-3} = (30 + 100 + 40 + 20) \\times 10^{-3} = 190 \\times 10^{-3} = 0.190$ 美元。\n\n问题要求最终答案四舍五入到四位有效数字。计算出的最低成本为 $0.190$。为了用四位有效数字表示该值，我们将其写为 $0.1900$。",
            "answer": "$$\\boxed{0.1900}$$"
        },
        {
            "introduction": "虽然许多负荷可以被视为离散的，但其他类型的资源，如暖通空调（HVAC）系统或电动汽车充电桩，提供了更连续的调节能力。对这类负荷进行建模需要一种不同的方法，该方法需要在经济激励、物理限制和用户舒适度之间寻求平衡。本高级练习深入探讨了这一主题，要求您构建一个凸二次规划模型，其约束条件形如 $|x_{t+1}-x_t| \\le r$。您将接触到二次不适度成本和斜坡约束等关键概念，并从第一性原理出发，使用 Karush-Kuhn-Tucker (KKT) 条件推导求解算法，这是研究生级别优化理论的基石。",
            "id": "4083925",
            "problem": "考虑一个简单的需求侧管理模型，该模型针对单一柔性终端用能在两个决策周期内的行为，其用电量变量为 $x_1$ 和 $x_2$，单位均为千瓦时 (kWh)。该终端用能面临一个价格向量 $(p_1,p_2)$，其中每个 $p_t$ 的单位为货币单位/千瓦时 ($$/\\text{kWh}$)。用户有一个偏好的用电曲线 $(x_1^{\\text{pref}},x_2^{\\text{pref}})$，单位为千瓦时 (kWh)。偏离此偏好曲线会产生不适成本，该成本被建模为一个权重为 $\\alpha$ 的二次惩罚，其单位为货币单位/平方千瓦时 ($$/\\text{kWh}^2$)。跨时段灵活性受到爬坡约束 $|x_{t+1}-x_t|\\le r$ 的限制，其中 $r$ 的单位为千瓦时 (kWh)。\n\n根据成本最小化下的消费者选择基本原理，我们将该决策问题建模为在物理灵活性约束下，最小化由能源账单和不适成本组成的总广义成本。形式上，该优化问题为\n$$\n\\min_{x_1,x_2}\\ \\sum_{t=1}^{2} \\left( p_t x_t + \\alpha \\left(x_t - x_t^{\\text{pref}}\\right)^2 \\right)\n$$\n约束条件为\n$$\n|x_2 - x_1| \\le r.\n$$\n假设 $\\alpha  0$，因此目标函数是严格凸的，可行集是凸集，这保证了存在唯一的最小值点。\n\n您的任务是：\n- 根据第一性原理和 Karush-Kuhn-Tucker (KKT) 条件，推导出一个闭式算法，用于计算在任何给定参数 $(\\alpha,r,p_1,p_2,x_1^{\\text{pref}},x_2^{\\text{pref}})$ 下的唯一最优解 $(x_1^\\star,x_2^\\star)$（单位 kWh）。\n- 将此算法实现为一个完整的、可运行的程序，为以下测试套件评估解。报告每个 $(x_1^\\star,x_2^\\star)$（单位 kWh）。\n\n使用以下五个科学一致的测试用例（所有量均采用其规定的基本单位）：\n1. $\\alpha=0.10$, $r=1.5$, $p_1=0.20$, $p_2=0.12$, $x_1^{\\text{pref}}=5.0$, $x_2^{\\text{pref}}=5.5$。\n2. $\\alpha=0.08$, $r=0.5$, $p_1=0.10$, $p_2=0.05$, $x_1^{\\text{pref}}=2.0$, $x_2^{\\text{pref}}=4.0$。\n3. $\\alpha=0.05$, $r=1.0$, $p_1=0.15$, $p_2=0.25$, $x_1^{\\text{pref}}=6.0$, $x_2^{\\text{pref}}=3.0$。\n4. $\\alpha=0.10$, $r=2.0$, $p_1=0.20$, $p_2=0.20$, $x_1^{\\text{pref}}=5.0$, $x_2^{\\text{pref}}=7.0$。\n5. $\\alpha=0.04$, $r=2.0$, $p_1=0.10$, $p_2=-0.05$, $x_1^{\\text{pref}}=3.0$, $x_2^{\\text{pref}}=3.0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身是一个二元列表 $[x_1^\\star,x_2^\\star]$（单位 kWh）。例如，格式应类似于 $[[a,b],[c,d],\\ldots]$，所有条目均为实数（单位 kWh）。",
            "solution": "用户希望我解决一个与能源系统中需求侧管理相关的约束优化问题。\n\n我的计划如下：\n1.  **验证问题陈述。**\n    *   **步骤 1：提取已知条件。** 我将完全按照给定的形式列出所有变量、常量、目标函数和约束。\n    *   **步骤 2：验证。** 我将检查问题的科学依据、适定性、客观性及其他标准。\n        *   **科学依据：** 该模型是能源经济学中柔性负荷的标准表示。它在服从线性约束（爬坡）的前提下，最小化一个二次成本函数（不适成本）加上一个线性成本（能源账单）。这是一个成熟的二次规划 (QP) 公式。单位是一致的。\n        *   **适定性：** 由于 $\\alpha  0$，目标函数是严格凸的。由 $|x_2 - x_1| \\le r$ 定义的可行集是一个凸集。一个在非空凸集上的严格凸函数有唯一的最小值。该问题是适定的。\n        *   **客观性：** 问题使用数学公式和客观语言进行描述。\n        *   **完整性：** 所有必要的参数（$\\alpha, r, p_1, p_2, x_1^{\\text{pref}}, x_2^{\\text{pref}}$）都已定义，并提供了测试用例。\n        *   **一致性：** 单位是一致的。例如，目标函数中的各项单位都是货币。$p_t x_t$ 是 ($/kWh) * (kWh) = $。$\\alpha(x_t - x_t^{\\text{pref}})^2$ 是 ($/kWh^2) * (kWh)^2 = $。这没有问题。\n    *   **步骤 3：结论。** 问题看起来是有效的。我将继续进行求解。\n\n2.  **解决问题。**\n    *   **推导闭式解。** 这是任务的核心。我需要使用 Karush-Kuhn-Tucker (KKT) 条件。\n    *   问题是：\n        $$\n        \\min_{x_1,x_2} f(x_1, x_2) = p_1 x_1 + \\alpha (x_1 - x_1^{\\text{pref}})^2 + p_2 x_2 + \\alpha (x_2 - x_2^{\\text{pref}})^2\n        $$\n        约束条件为：\n        $$\n        g_1(x_1, x_2) = x_2 - x_1 - r \\le 0 \\\\\n        g_2(x_1, x_2) = x_1 - x_2 - r \\le 0\n        $$\n    *   拉格朗日函数是：\n        $$\n        L(x_1, x_2, \\lambda_1, \\lambda_2) = f(x_1, x_2) + \\lambda_1(x_2 - x_1 - r) + \\lambda_2(x_1 - x_2 - r)\n        $$\n        其中 $\\lambda_1, \\lambda_2 \\ge 0$ 是拉格朗日乘子。\n    *   KKT 条件是：\n        1.  **平稳性：**\n            $$\n            \\frac{\\partial L}{\\partial x_1} = p_1 + 2\\alpha(x_1 - x_1^{\\text{pref}}) - \\lambda_1 + \\lambda_2 = 0 \\\\\n            \\frac{\\partial L}{\\partial x_2} = p_2 + 2\\alpha(x_2 - x_2^{\\text{pref}}) + \\lambda_1 - \\lambda_2 = 0\n            $$\n        2.  **原始可行性：**\n            $$\n            x_2 - x_1 \\le r \\\\\n            x_1 - x_2 \\le r\n            $$\n        3.  **对偶可行性：**\n            $$\n            \\lambda_1 \\ge 0 \\\\\n            \\lambda_2 \\ge 0\n            $$\n        4.  **互补松弛性：**\n            $$\n            \\lambda_1(x_2 - x_1 - r) = 0 \\\\\n            \\lambda_2(x_1 - x_2 - r) = 0\n            $$\n\n    *   **KKT 条件分析：**\n        让我们简化平稳性方程：\n        $$\n        2\\alpha(x_1 - x_1^{\\text{pref}}) = -p_1 + \\lambda_1 - \\lambda_2 \\implies x_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1 - \\lambda_2}{2\\alpha} \\\\\n        2\\alpha(x_2 - x_2^{\\text{pref}}) = -p_2 - \\lambda_1 + \\lambda_2 \\implies x_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1 - \\lambda_2}{2\\alpha}\n        $$\n\n    *   我们定义“无约束”解，它对应于爬坡约束无效的情况。这种情况发生在 $\\lambda_1 = 0$ 和 $\\lambda_2 = 0$ 时。\n        我们称此解为 $(\\hat{x}_1, \\hat{x}_2)$。\n        $$\n        \\hat{x}_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} \\\\\n        \\hat{x}_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}\n        $$\n        这是在没有任何约束的情况下最小化目标函数的解。它就是目标函数梯度为零的点。\n\n    *   **情况 1：无约束解是可行的。**\n        如果 $|\\hat{x}_2 - \\hat{x}_1| \\le r$，那么无约束解就是最优解。在这种情况下，$(\\lambda_1, \\lambda_2) = (0, 0)$ 显然满足所有 KKT 条件。\n        因此，如果 $|(x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}) - (x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha})| \\le r$，那么\n        $$\n        x_1^\\star = \\hat{x}_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} \\\\\n        x_2^\\star = \\hat{x}_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}\n        $$\n\n    *   **情况 2：爬坡约束有效：$x_2 - x_1 = r$。**\n        这意味着无约束解违反了上界，即 $\\hat{x}_2 - \\hat{x}_1  r$。\n        根据互补松弛性，我们必须有 $\\lambda_1  0$ 和 $\\lambda_2 = 0$。\n        KKT 条件变为：\n        $$\n        x_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1}{2\\alpha} \\\\\n        x_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1}{2\\alpha} \\\\\n        x_2 - x_1 = r\n        $$\n        让我们将 $x_1$ 和 $x_2$ 的表达式代入约束方程：\n        $$\n        \\left(x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1}{2\\alpha}\\right) - \\left(x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1}{2\\alpha}\\right) = r\n        $$\n        $$\n        (x_2^{\\text{pref}} - x_1^{\\text{pref}}) - \\frac{p_2 - p_1}{2\\alpha} - \\frac{2\\lambda_1}{2\\alpha} = r\n        $$\n        回想无约束解的定义：$\\hat{x}_2 - \\hat{x}_1 = (x_2^{\\text{pref}} - x_1^{\\text{pref}}) - \\frac{p_2 - p_1}{2\\alpha}$。\n        因此，方程变为：\n        $$\n        \\hat{x}_2 - \\hat{x}_1 - \\frac{\\lambda_1}{\\alpha} = r\n        $$\n        求解 $\\lambda_1$：\n        $$\n        \\lambda_1 = \\alpha (\\hat{x}_2 - \\hat{x}_1 - r)\n        $$\n        因为我们处于 $\\hat{x}_2 - \\hat{x}_1  r$ 的情况，所以我们有 $\\lambda_1  0$，这与我们的假设是一致的。\n        现在我们可以找到 $x_1^\\star$ 和 $x_2^\\star$。令 $\\lambda = \\lambda_1 - \\lambda_2$。这里 $\\lambda = \\lambda_1$。\n        $$\n        x_1^\\star = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} + \\frac{\\lambda_1}{2\\alpha} = \\hat{x}_1 + \\frac{\\lambda_1}{2\\alpha} \\\\\n        x_2^\\star = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} - \\frac{\\lambda_1}{2\\alpha} = \\hat{x}_2 - \\frac{\\lambda_1}{2\\alpha}\n        $$\n        代入 $\\lambda_1$ 的表达式：\n        $$\n        x_1^\\star = \\hat{x}_1 + \\frac{\\alpha (\\hat{x}_2 - \\hat{x}_1 - r)}{2\\alpha} = \\hat{x}_1 + \\frac{\\hat{x}_2 - \\hat{x}_1 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} \\\\\n        x_2^\\star = \\hat{x}_2 - \\frac{\\alpha (\\hat{x}_2 - \\hat{x}_1 - r)}{2\\alpha} = \\hat{x}_2 - \\frac{\\hat{x}_2 - \\hat{x}_1 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2}\n        $$\n        我们可以检查是否 $x_2^\\star - x_1^\\star = r$：\n        $$\n        \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} - \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} = \\frac{2r}{2} = r\n        $$\n        成立。因此，如果 $\\hat{x}_2 - \\hat{x}_1  r$，最优解是：\n        $$\n        x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} \\\\\n        x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2}\n        $$\n\n    *   **情况 3：爬坡约束有效：$x_1 - x_2 = r$。**\n        这意味着无约束解违反了下界，即 $\\hat{x}_2 - \\hat{x}_1  -r$。\n        根据互补松弛性，我们必须有 $\\lambda_2  0$ 和 $\\lambda_1 = 0$。\n        KKT 条件变为：\n        $$\n        x_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} - \\frac{\\lambda_2}{2\\alpha} \\\\\n        x_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} + \\frac{\\lambda_2}{2\\alpha} \\\\\n        x_1 - x_2 = r\n        $$\n        将 $x_1, x_2$ 代入约束中：\n        $$\n        \\left(x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} - \\frac{\\lambda_2}{2\\alpha}\\right) - \\left(x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha} + \\frac{\\lambda_2}{2\\alpha}\\right) = r\n        $$\n        $$\n        (x_1^{\\text{pref}} - x_2^{\\text{pref}}) - \\frac{p_1 - p_2}{2\\alpha} - \\frac{2\\lambda_2}{2\\alpha} = r\n        $$\n        $$\n        -(\\hat{x}_2 - \\hat{x}_1) - \\frac{\\lambda_2}{\\alpha} = r \\implies \\hat{x}_1 - \\hat{x}_2 - \\frac{\\lambda_2}{\\alpha} = r\n        $$\n        求解 $\\lambda_2$：\n        $$\n        \\lambda_2 = \\alpha (\\hat{x}_1 - \\hat{x}_2 - r)\n        $$\n        因为我们处于 $\\hat{x}_2 - \\hat{x}_1  -r$（或 $\\hat{x}_1 - \\hat{x}_2  r$）的情况，所以我们有 $\\lambda_2  0$，这是一致的。\n        现在求 $x_1^\\star$ 和 $x_2^\\star$：\n        $$\n        x_1^\\star = \\hat{x}_1 - \\frac{\\lambda_2}{2\\alpha} = \\hat{x}_1 - \\frac{\\alpha(\\hat{x}_1 - \\hat{x}_2 - r)}{2\\alpha} = \\hat{x}_1 - \\frac{\\hat{x}_1 - \\hat{x}_2 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} \\\\\n        x_2^\\star = \\hat{x}_2 + \\frac{\\lambda_2}{2\\alpha} = \\hat{x}_2 + \\frac{\\alpha(\\hat{x}_1 - \\hat{x}_2 - r)}{2\\alpha} = \\hat{x}_2 + \\frac{\\hat{x}_1 - \\hat{x}_2 - r}{2} = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2}\n        $$\n        我们可以检查是否 $x_1^\\star - x_2^\\star = r$：\n        $$\n        \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} - \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} = \\frac{2r}{2} = r\n        $$\n        成立。因此，如果 $\\hat{x}_2 - \\hat{x}_1  -r$，最优解是：\n        $$\n        x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} \\\\\n        x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2}\n        $$\n\n    *   **闭式算法总结：**\n        1.  给定参数 $(\\alpha, r, p_1, p_2, x_1^{\\text{pref}}, x_2^{\\text{pref}})$。\n        2.  计算无约束最小值点：\n            $$\n            \\hat{x}_1 = x_1^{\\text{pref}} - \\frac{p_1}{2\\alpha} \\\\\n            \\hat{x}_2 = x_2^{\\text{pref}} - \\frac{p_2}{2\\alpha}\n            $$\n        3.  计算差值：\n            $$\n            \\Delta\\hat{x} = \\hat{x}_2 - \\hat{x}_1\n            $$\n        4.  应用情况逻辑：\n            *   如果 $\\Delta\\hat{x}  r$：（上爬坡约束有效）\n                $$\n                x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2} \\\\\n                x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2}\n                $$\n            *   如果 $\\Delta\\hat{x}  -r$：（下爬坡约束有效）\n                $$\n                x_1^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 + r}{2} \\\\\n                x_2^\\star = \\frac{\\hat{x}_1 + \\hat{x}_2 - r}{2}\n                $$\n            *   否则（即 $-r \\le \\Delta\\hat{x} \\le r$）：（约束无效）\n                $$\n                x_1^\\star = \\hat{x}_1 \\\\\n                x_2^\\star = \\hat{x}_2\n                $$",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal consumption profile (x1, x2) for a series of\n    demand-side management test cases based on a derived closed-form solution.\n    \"\"\"\n\n    test_cases = [\n        # (alpha, r, p1, p2, x1_pref, x2_pref)\n        (0.10, 1.5, 0.20, 0.12, 5.0, 5.5),\n        (0.08, 0.5, 0.10, 0.05, 2.0, 4.0),\n        (0.05, 1.0, 0.15, 0.25, 6.0, 3.0),\n        (0.10, 2.0, 0.20, 0.20, 5.0, 7.0),\n        (0.04, 2.0, 0.10, -0.05, 3.0, 3.0),\n    ]\n\n    results = []\n\n    def calculate_optimal_consumption(alpha, r, p1, p2, x1_pref, x2_pref):\n        \"\"\"\n        Implements the closed-form algorithm to find the optimal consumption profile (x1*, x2*).\n\n        The algorithm first computes the unconstrained cost minimizers and then checks if they\n        satisfy the ramping constraint. If they don't, the solution lies on the boundary\n        of the feasible region, and the corresponding closed-form is used.\n\n        Args:\n            alpha (float): Discomfort cost weight ($/kWh^2).\n            r (float): Ramping limit (kWh).\n            p1 (float): Price at time t=1 ($/kWh).\n            p2 (float): Price at time t=2 ($/kWh).\n            x1_pref (float): Preferred consumption at time t=1 (kWh).\n            x2_pref (float): Preferred consumption at time t=2 (kWh).\n\n        Returns:\n            list: A list containing the optimal consumption values [x1_star, x2_star].\n        \"\"\"\n        # Step 1: Calculate the unconstrained minimizers (where gradient of objective is zero)\n        x1_hat = x1_pref - p1 / (2 * alpha)\n        x2_hat = x2_pref - p2 / (2 * alpha)\n\n        # Step 2: Calculate the difference in unconstrained consumption\n        delta_x_hat = x2_hat - x1_hat\n\n        # Step 3: Apply case logic based on the ramping constraint\n        if delta_x_hat  r:\n            # Case: Upper ramp constraint is binding (x2 - x1 = r)\n            x1_star = (x1_hat + x2_hat - r) / 2\n            x2_star = (x1_hat + x2_hat + r) / 2\n        elif delta_x_hat  -r:\n            # Case: Lower ramp constraint is binding (x1 - x2 = r, or x2 - x1 = -r)\n            x1_star = (x1_hat + x2_hat + r) / 2\n            x2_star = (x1_hat + x2_hat - r) / 2\n        else:\n            # Case: Unconstrained solution is feasible (-r = delta_x_hat = r)\n            x1_star = x1_hat\n            x2_star = x2_hat\n            \n        return [x1_star, x2_star]\n\n    for case in test_cases:\n        alpha, r, p1, p2, x1_pref, x2_pref = case\n        optimal_x = calculate_optimal_consumption(alpha, r, p1, p2, x1_pref, x2_pref)\n        results.append(optimal_x)\n\n    # Format the results into the required string format \"[[a,b],[c,d],...]\"\n    # using map(str, ...) which correctly handles list-to-string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}