{
    "hands_on_practices": [
        {
            "introduction": "温控负荷（TCL）模型的核心是集总热阻（$R$）和热容（$C$）参数。本练习将揭示这些抽象参数的物理来源，引导您从建筑物的具体几何形状和材料属性出发，运用傅里叶（Fourier）热传导定律和牛顿（Newton）对流换热定律等基本原理，亲手推导并估算这些关键参数。通过这项实践，您将深刻理解简化模型如何植根于物理现实，并掌握将复杂物理系统转化为可分析模型的基本技能。",
            "id": "4130995",
            "problem": "一个单区建筑可以被建模为一个恒温控制负荷（TCL），其中室内空气和内部质量被集中为一个单一的热容，而通向室外环境的围护结构路径提供了热阻。从傅里叶热传导定律、牛顿对流传热定律以及热容量的定义出发，推导如何从围护结构的材料和几何形状推断出住宅的总热阻和总热容。然后，为以下科学上真实的小型住宅计算其热时间常数的数量级估计，将室内视为充分混合，并在一个固定的恒温器设定点附近进行线性化，同时忽略空气渗透和内部得热。\n\n几何形状与围护结构：\n- 矩形平面，建筑面积为 $60$ m$^2$，尺寸为 $10$ m × $6$ m，天花板高度为 $2.5$ m。屋顶面积等于建筑面积，$60$ m$^2$。总墙体面积为周长乘以高度。总窗户面积为 $8$ m$^2$；剩余的墙体面积为不透明部分。\n- 不透明墙体组件，从室内到室外：厚度为 $0.0125$ m 的室内石膏板；厚度为 $0.09$ m 的带保温材料的立柱空腔；厚度为 $0.012$ m 的定向结构刨花板（OSB）护板；厚度为 $0.010$ m 的木质壁板。对于所有不透明组件，使用室内和室外表面薄膜对流系数 $h_{\\text{in}}=8$ W m$^{-2}$ K$^{-1}$ 和 $h_{\\text{out}}=25$ W m$^{-2}$ K$^{-1}$。\n- 屋顶组件，从室内到室外：厚度为 $0.0125$ m 的室内石膏板；厚度为 $0.20$ m 的阁楼保温层；厚度为 $0.012$ m 的 OSB 护板。使用相同的 $h_{\\text{in}}$ 和 $h_{\\text{out}}$。\n- 窗户：使用总传热系数 $U_{\\text{win}}=1.8$ W m$^{-2}$ K$^{-1}$，假定其已包含表面薄膜。\n\n材料属性（使用恒定值）：\n- 石膏板导热系数 $k_{\\text{gyp}}=0.17$ W m$^{-1}$ K$^{-1}$，密度 $800$ kg m$^{-3}$，比热 $c_{p,\\text{gyp}}=1090$ J kg$^{-1}$ K$^{-1}$。\n- 保温材料导热系数 $k_{\\text{ins}}=0.035$ W m$^{-1}$ K$^{-1}$。\n- OSB 导热系数 $k_{\\text{osb}}=0.12$ W m$^{-1}$ K$^{-1}$。\n- 木质壁板导热系数 $k_{\\text{wood}}=0.14$ W m$^{-1}$ K$^{-1}$。\n- 室内空气密度 $1.2$ kg m$^{-3}$，比热 $c_{p,\\text{air}}=1005$ J kg$^{-1}$ K$^{-1}$。\n- 厚度为 $0.10$ m 的混凝土地面楼板（与室内热耦合良好），密度 $2400$ kg m$^{-3}$，比热 $c_{p,\\text{conc}}=880$ J kg$^{-1}$ K$^{-1}$，面积等于建筑面积。\n- 由集中质量 $500$ kg 代表的家具，比热为 $c_{p,\\text{furn}}=1500$ J kg$^{-1}$ K$^{-1}$。\n\n假设所有不透明组件的各层在厚度方向上是串联的，并且屋顶、不透明墙体和窗户与室外并联换热。将室内热容视为室内空气、不透明墙体和天花板上的室内石膏板、混凝土地板以及家具的热容之和。计算热时间常数 $\\tau$，其定义为总热阻与总热容的乘积。将最终的 $\\tau$ 以小时为单位表示，并将答案四舍五入到三位有效数字。",
            "solution": "该问题需要两部分的解答：理论推导和数值计算。\n\n**第一部分：理论推导**\n\n建筑的总热阻 $R_{\\text{eq}}$ 和总热容 $C_{\\text{eq}}$ 是从基本原理推导出来的。\n\n**热阻, $R$**\n热阻是对热流的阻碍。对于由温差 $\\Delta T$ 驱动的给定传热速率 $\\dot{Q}$，热阻定义为 $R = \\frac{\\Delta T}{\\dot{Q}}$。\n\n1.  **传导：** 对于通过平面材料的一维稳态热流，傅里叶热传导定律为 $\\dot{Q} = -kA \\frac{dT}{dx}$，其中 $\\dot{Q}$ 是传热速率，$k$ 是导热系数，$A$ 是垂直于热流方向的面积，$\\frac{dT}{dx}$ 是温度梯度。对于厚度为 $L$、两侧温差为 $\\Delta T$ 的材料层，积分后得到 $\\dot{Q} = kA \\frac{\\Delta T}{L}$。因此，传导热阻为 $R_{\\text{cond}} = \\frac{\\Delta T}{\\dot{Q}} = \\frac{L}{kA}$。\n\n2.  **对流：** 从面积为 $A$ 的表面到流体的牛顿对流传热定律为 $\\dot{Q} = hA \\Delta T$，其中 $h$ 是对流传热系数，$\\Delta T$ 是表面与流体之间的温差。对流热阻为 $R_{\\text{conv}} = \\frac{\\Delta T}{\\dot{Q}} = \\frac{1}{hA}$。\n\n3.  **组件的总热阻：** 对于像墙体这样的建筑围护结构组件，它由多个串联的层组成，其总热阻是各个热阻之和：$R_{\\text{assembly}} = \\sum_{i} R_i$。通常使用单位面积热阻 $R' = R \\cdot A$。因此，对于多层墙体，$R'_{\\text{assembly}} = \\frac{1}{h_{\\text{in}}} + \\sum_{j} \\frac{L_j}{k_j} + \\frac{1}{h_{\\text{out}}}$。总传热系数，或称 U 值，是单位面积总热阻的倒数：$U = \\frac{1}{R'_{\\text{assembly}}}$。通过该组件的传热速率为 $\\dot{Q} = UA \\Delta T$。\n\n4.  **建筑的等效热阻：** 建筑围护结构由几个与室外环境并联传热的组件（墙体、屋顶、窗户）组成。总传热速率是流经每个组件的速率之和：$\\dot{Q}_{\\text{tot}} = \\sum_{j} \\dot{Q}_j = \\sum_{j} (UA)_j \\Delta T = (\\sum_{j} (UA)_j) \\Delta T$。项 $(UA)_{\\text{tot}} = \\sum_j (UA)_j$ 代表每度温差的总热损失率。整个建筑围护结构的等效热阻是该值的倒数：$R_{\\text{eq}} = \\frac{1}{(UA)_{\\text{tot}}} = \\frac{1}{\\sum_{j} (UA)_j}$。\n\n**热容, $C$**\n热容是物体储存热能的能力。它被定义为使物体温度升高一度所需的热能。温度变化 $dT$ 所需的热能为 $dQ = C dT$。对于质量为 $m$、比热容为 $c_p$ 的物质，有限温差 $\\Delta T$ 所需的热量为 $Q = mc_p \\Delta T$。因此，热容为 $C = mc_p$。对于体积为 $V$、密度为 $\\rho$ 的物体，其质量为 $m=\\rho V$，所以热容为 $C = \\rho V c_p$。\n\n对于集总热容建筑模型，总热容 $C_{\\text{eq}}$ 是假定处于均匀室内空气温度下的所有组件热容的总和。这包括室内空气本身以及与空气热耦合良好的朝内材料的质量。\n$C_{\\text{eq}} = \\sum_{i} C_i = \\sum_{i} m_i c_{p,i}$。\n\n**第二部分：数值计算**\n\n**步骤 A：计算总热阻 ($R_{\\text{eq}}$)**\n\n1.  **计算组件面积：**\n    - 地面/屋顶面积: $A_{\\text{floor}} = A_{\\text{roof}} = 60$ m$^2$。\n    - 建筑周长: $P = 2(10\\,\\text{m} + 6\\,\\text{m}) = 32$ m。\n    - 总墙体面积: $A_{\\text{wall,tot}} = P \\times H = 32\\,\\text{m} \\times 2.5\\,\\text{m} = 80$ m$^2$。\n    - 窗户面积: $A_{\\text{win}} = 8$ m$^2$。\n    - 不透明墙体面积: $A_{\\text{wall,op}} = A_{\\text{wall,tot}} - A_{\\text{win}} = 80\\,\\text{m}^2 - 8\\,\\text{m}^2 = 72$ m$^2$。\n\n2.  **计算不透明墙体的 U 值 ($U_{\\text{wall}}$)：**\n    单位面积总热阻 $R'_{\\text{wall,op}}$ 是串联热阻之和：\n    $R'_{\\text{wall,op}} = \\frac{1}{h_{\\text{in}}} + \\frac{L_{\\text{gyp}}}{k_{\\text{gyp}}} + \\frac{L_{\\text{ins}}}{k_{\\text{ins}}} + \\frac{L_{\\text{osb}}}{k_{\\text{osb}}} + \\frac{L_{\\text{wood}}}{k_{\\text{wood}}} + \\frac{1}{h_{\\text{out}}}$\n    $R'_{\\text{wall,op}} = \\frac{1}{8} + \\frac{0.0125}{0.17} + \\frac{0.09}{0.035} + \\frac{0.012}{0.12} + \\frac{0.010}{0.14} + \\frac{1}{25}$ m$^2$ K W$^{-1}$\n    $R'_{\\text{wall,op}} = (0.125 + 0.073529... + 2.571428... + 0.1 + 0.071428... + 0.04)$ m$^2$ K W$^{-1} = 2.98138...$ m$^2$ K W$^{-1}$。\n    $U_{\\text{wall}} = \\frac{1}{R'_{\\text{wall,op}}} = \\frac{1}{2.98138...}$ W m$^{-2}$ K$^{-1} = 0.33541...$ W m$^{-2}$ K$^{-1}$。\n\n3.  **计算屋顶的 U 值 ($U_{\\text{roof}}$)：**\n    $R'_{\\text{roof}} = \\frac{1}{h_{\\text{in}}} + \\frac{L_{\\text{gyp}}}{k_{\\text{gyp}}} + \\frac{L_{\\text{attic_ins}}}{k_{\\text{ins}}} + \\frac{L_{\\text{osb}}}{k_{\\text{osb}}} + \\frac{1}{h_{\\text{out}}}$\n    $R'_{\\text{roof}} = \\frac{1}{8} + \\frac{0.0125}{0.17} + \\frac{0.20}{0.035} + \\frac{0.012}{0.12} + \\frac{1}{25}$ m$^2$ K W$^{-1}$\n    $R'_{\\text{roof}} = (0.125 + 0.073529... + 5.714285... + 0.1 + 0.04)$ m$^2$ K W$^{-1} = 6.05281...$ m$^2$ K W$^{-1}$。\n    $U_{\\text{roof}} = \\frac{1}{R'_{\\text{roof}}} = \\frac{1}{6.05281...}$ W m$^{-2}$ K$^{-1} = 0.16521...$ W m$^{-2}$ K$^{-1}$。\n\n4.  **计算总 UA 乘积 ($(UA)_{\\text{tot}}$)：**\n    $(UA)_{\\text{tot}} = U_{\\text{wall}}A_{\\text{wall,op}} + U_{\\text{roof}}A_{\\text{roof}} + U_{\\text{win}}A_{\\text{win}}$\n    $(UA)_{\\text{tot}} = (0.33541... \\times 72) + (0.16521... \\times 60) + (1.8 \\times 8)$ W K$^{-1}$\n    $(UA)_{\\text{tot}} = (24.1498... + 9.9126... + 14.4)$ W K$^{-1} = 48.4625...$ W K$^{-1}$。\n\n5.  **计算等效热阻 ($R_{\\text{eq}}$)：**\n    $R_{\\text{eq}} = \\frac{1}{(UA)_{\\text{tot}}} = \\frac{1}{48.4625...}$ K W$^{-1} = 0.020634...$ K W$^{-1}$。\n\n**步骤 B：计算总热容 ($C_{\\text{eq}}$)**\n\n$C_{\\text{eq}} = C_{\\text{air}} + C_{\\text{gyp}} + C_{\\text{conc}} + C_{\\text{furn}}$\n\n1.  **空气热容 ($C_{\\text{air}}$)：**\n    $V_{\\text{air}} = A_{\\text{floor}} \\times H = 60\\,\\text{m}^2 \\times 2.5\\,\\text{m} = 150$ m$^3$。\n    $C_{\\text{air}} = \\rho_{\\text{air}} V_{\\text{air}} c_{p,\\text{air}} = 1.2 \\times 150 \\times 1005 = 180900$ J K$^{-1}$。\n\n2.  **石膏板热容 ($C_{\\text{gyp}}$)：**\n    石膏板位于不透明墙体和天花板的内侧。\n    $A_{\\text{gyp}} = A_{\\text{wall,op}} + A_{\\text{roof}} = 72\\,\\text{m}^2 + 60\\,\\text{m}^2 = 132$ m$^2$。\n    $V_{\\text{gyp}} = A_{\\text{gyp}} \\times L_{\\text{gyp}} = 132 \\times 0.0125 = 1.65$ m$^3$。\n    $C_{\\text{gyp}} = \\rho_{\\text{gyp}} V_{\\text{gyp}} c_{p,\\text{gyp}} = 800 \\times 1.65 \\times 1090 = 1438800$ J K$^{-1}$。\n\n3.  **混凝土地板热容 ($C_{\\text{conc}}$)：**\n    $V_{\\text{conc}} = A_{\\text{floor}} \\times L_{\\text{conc}} = 60 \\times 0.10 = 6$ m$^3$。\n    $C_{\\text{conc}} = \\rho_{\\text{conc}} V_{\\text{conc}} c_{p,\\text{conc}} = 2400 \\times 6 \\times 880 = 12672000$ J K$^{-1}$。\n\n4.  **家具热容 ($C_{\\text{furn}}$)：**\n    $C_{\\text{furn}} = m_{\\text{furn}} c_{p,\\text{furn}} = 500 \\times 1500 = 750000$ J K$^{-1}$。\n\n5.  **总等效热容 ($C_{\\text{eq}}$)：**\n    $C_{\\text{eq}} = 180900 + 1438800 + 12672000 + 750000 = 15041700$ J K$^{-1}$。\n\n**步骤 C：计算热时间常数 ($\\tau$)**\n\n热时间常数 $\\tau$ 是等效热阻和等效热容的乘积。\n$\\tau = R_{\\text{eq}} C_{\\text{eq}} = 0.020634... \\text{ K W}^{-1} \\times 15041700 \\text{ J K}^{-1}$\n单位是 $(\\text{K}/\\text{W}) \\times (\\text{J}/\\text{K}) = \\text{J}/\\text{W} = \\text{J}/(\\text{J}/\\text{s}) = \\text{s}$。\n$\\tau = 310379...$ s。\n\n最后，将时间常数转换为小时，并四舍五入到三位有效数字。\n$\\tau_{\\text{hours}} = \\frac{\\tau}{3600\\,\\text{s/hr}} = \\frac{310379...}{3600} = 86.216...$ hr。\n四舍五入到三位有效数字得到 $86.2$ 小时。",
            "answer": "$$\n\\boxed{86.2}\n$$"
        },
        {
            "introduction": "获得模型参数后，下一步是模拟TCL在运行过程中的动态行为。由于其控制逻辑（迟滞控制）的非线性和开关特性，传统的定步长数值积分可能引入误差。本练习将指导您实施一种事件驱动的模拟方法，通过解析求解温度轨迹与恒温器阈值的交点，来精确计算开关时间。这项实践不仅能让您掌握一种高效精确的混合系统仿真技术，还能加深对TCL独特循环特性的理解。",
            "id": "4131004",
            "problem": "你的任务是为能源系统建模领域中的温控负荷（TCL）实现一个事件驱动模拟器。该TCL是一个单区冷却设备，在分段恒定的环境条件下，基于滞回控制来调节室内温度。目标是通过解析求解温度轨迹的阈值穿越点，来计算恒温器改变状态的精确切换时间。\n\n从以下建模基础开始：\n- 室内温度动态遵循一个源于能量平衡和牛顿冷却定律的一阶集总热模型。其常微分方程（ODE）为\n$$\n\\frac{dT(t)}{dt} \\;=\\; -k \\,\\big(T(t) - T_a(t)\\big) \\;-\\; u(t) \\, q,\n$$\n其中，$T(t)$ 是室内温度（单位：摄氏度），$T_a(t)$ 是环境温度（单位：摄氏度），$k  0$ 是热损失率（单位：秒的倒数），$u(t) \\in \\{0,1\\}$ 是执行器模式，其中 $u(t)=1$ 表示冷却设备开启， $u(t)=0$ 表示关闭，而 $q  0$ 是有效冷却速率（单位：摄氏度/秒）。环境温度 $T_a(t)$ 在指定的时间段内是分段恒定的。参数 $k$ 和 $q$ 在整个模拟过程中是恒定的。单位：温度为摄氏度，时间为秒。\n\n- 恒温器采用围绕设定点的滞回控制，并带有死区。下阈值为 $T_{\\text{low}} = T_{\\text{set}} - \\Delta$，上阈值为 $T_{\\text{high}} = T_{\\text{set}} + \\Delta$，其中 $\\Delta  0$ 是死区宽度的一半。冷却设备的切换逻辑是：当 $u(t)=0$（设备关闭）时，它在满足 $T(t) \\ge T_{\\text{high}}$ 的第一个时间点 $t$ 开启；当 $u(t)=1$（设备开启）时，它在满足 $T(t) \\le T_{\\text{low}}$ 的第一个时间点 $t$ 关闭。在阈值处的临界情况通过在当前时间立即切换来解决，即，如果在任何决策时刻 $T(t)$ 等于活动阈值，则相应的切换在该时刻发生。\n\n你的任务：\n- 实现一个事件驱动的模拟算法，该算法能够精确积分 $T(t)$，并通过解析求解每个分段内的阈值穿越时间，来计算给定环境分段表下的切换事件时间。环境温度 $T_a(t)$ 在分段 $\\{(d_i, T_{a,i})\\}$ 上是分段恒定的，其中 $d_i$ 是持续时间（秒），$T_{a,i}$ 是分段 $i$ 的环境温度（摄氏度）。设备模式 $u(t)$ 在切换事件之间是分段恒定的。在任何具有恒定 $T_a$ 和恒定 $u$ 的分段内，$T(t)$ 根据给定的ODE演化。\n\n- 你的模拟器必须：\n  1. 接受模型参数 $(\\tau, q, T_{\\text{set}}, \\Delta, T_0, u_0, \\{(d_i, T_{a,i})\\})$, 其中 $\\tau$ 是热时间常数（秒），$k = 1/\\tau$, $q$ 是冷却速率（摄氏度/秒），$T_{\\text{set}}$ 是设定点（摄氏度），$\\Delta$ 是死区半宽（摄氏度），$T_0$ 是时间 $t=0$ 时的初始室内温度（摄氏度），$u_0 \\in \\{0,1\\}$ 是初始模式（0为关闭，1为开启），环境时间表是成对的 $(d_i, T_{a,i})$ 列表。\n  2. 在每个环境分段内精确计算室内温度轨迹，并确定恒温器切换状态的精确时间。事件之间的状态传播使用ODE的解析解来完成；不允许使用数值步进法。\n  3. 执行上述的滞回切换逻辑和阈值处的临界情况处理规则。\n  4. 返回一个列表，包含从 $t=0$ 到环境时间表结束的所有事件时间（以秒为单位）。\n\n解析积分规范：\n- 在任何 $T_a(t) = \\text{constant}$ 和 $u(t) = \\text{constant}$ 的区间内，必须精确积分 $T(t)$。事件时间通过求解 $T(t) = T_{\\text{thr}}$ 关于 $t$ 的方程来找到，其中 $T_{\\text{thr}}$ 是活动阈值（当 $u=0$ 时为 $T_{\\text{high}}$，当 $u=1$ 时为 $T_{\\text{low}}$）。只有当温度轨迹单调地朝向 $T_{\\infty}$ 演变，并且阈值位于当前温度和该分段的 $T_{\\infty}$ 之间时，才计算穿越；否则，在该分段内不会发生穿越。\n\n单位：\n- 将所有事件时间以秒为单位报告为浮点数值。\n\n测试套件：\n实现你的程序以运行以下五个测试用例，每个用例由 $(\\tau, q, T_{\\text{set}}, \\Delta, T_0, u_0, \\{(d_i, T_{a,i})\\})$ 定义：\n- 用例 1：$\\tau = 1200$, $q = 0.01$, $T_{\\text{set}} = 22$, $\\Delta = 1$, $T_0 = 22$, $u_0 = 0$, 环境分段 $\\{(1800, 30), (1800, 26), (1800, 28)\\}$。\n- 用例 2：$\\tau = 900$, $q = \\frac{8}{900}$, $T_{\\text{set}} = 24$, $\\Delta = 0.5$, $T_0 = 24.5$, $u_0 = 0$, 环境分段 $\\{(1200, 27)\\}$。\n- 用例 3：$\\tau = 1500$, $q = \\frac{10}{1500}$, $T_{\\text{set}} = 21$, $\\Delta = 0.7$, $T_0 = 21$, $u_0 = 0$, 环境分段 $\\{(3600, 18)\\}$。\n- 用例 4：$\\tau = 300$, $q = \\frac{12}{300}$, $T_{\\text{set}} = 25$, $\\Delta = 1$, $T_0 = 26$, $u_0 = 0$, 环境分段 $\\{(200, 32), (200, 34), (200, 30), (400, 29)\\}$。\n- 用例 5：$\\tau = 600$, $q = \\frac{15}{600}$, $T_{\\text{set}} = 22$, $\\Delta = 0.1$, $T_0 = 22$, $u_0 = 0$, 环境分段 $\\{(300, 27), (300, 27)\\}$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个条目必须是按顺序排列的一个测试用例的事件时间列表（以秒为单位）。例如，输出必须如下所示\n$$\n[ [t_{1,1}, t_{1,2}, \\dots], [t_{2,1}, \\dots], [\\dots], [\\dots], [\\dots] ].\n$$\n如果某个用例没有事件，则为该用例输出一个空列表，即 $[]$。",
            "solution": "该问题要求为在滞回控制下运行的温控负荷（TCL）实现一个事件驱动模拟器。模拟必须是精确的，在事件之间使用温度动态的解析解。\n\n模拟的核心是基于控制室内温度 $T(t)$ 的一阶常微分方程（ODE）：\n$$\n\\frac{dT(t)}{dt} = -k \\left(T(t) - T_a(t)\\right) - u(t) q\n$$\n此处，$k$ 是热损失率（$k=1/\\tau$，其中 $\\tau$ 是热时间常数），$T_a(t)$ 是环境温度，$u(t)$ 是执行器状态（1为开启，0为关闭），$q$ 是冷却速率。\n\n模拟通过识别并推进到下一个时间事件来进行。事件可以是恒温器状态切换（状态相关事件），也可以是环境温度的变化（时间相关事件）。\n\n首先，我们解析地求解ODE。在执行器状态 $u(t)$ 和环境温度 $T_a(t)$ 保持恒定的任何时间区间内，我们分别将它们表示为 $u_c$ 和 $T_{a,c}$。该ODE可以重写为一个标准的一阶线性ODE：\n$$\n\\frac{dT}{dt} + k T(t) = k T_{a,c} - u_c q\n$$\n方程的右侧是常数。此ODE的解由一个齐次部分和一个特解组成。特解是稳态或渐近温度 $T_{\\infty}$，通过设置 $\\frac{dT}{dt}=0$ 求得：\n$$\n0 = -k (T_{\\infty} - T_{a,c}) - u_c q \\implies T_{\\infty} = T_{a,c} - \\frac{u_c q}{k} = T_{a,c} - u_c q \\tau\n$$\n从时间 $t_s$ 的初始温度 $T_s$ 开始，温度 $T(t)$ 的通解由下式给出：\n$$\nT(t) = T_{\\infty} + (T_s - T_{\\infty}) e^{-k(t - t_s)}\n$$\n这个解析解使我们能够计算恒定参数区间内任何未来时间 $t$ 的温度，而无需借助数值积分。\n\n下一步是确定恒温器切换的时间。当温度 $T(t)$ 达到滞回阈值之一时发生切换：$T_{\\text{high}} = T_{\\text{set}} + \\Delta$ 或 $T_{\\text{low}} = T_{\\text{set}} - \\Delta$。活动阈值 $T_{\\text{thr}}$ 取决于当前的执行器模式 $u_c$：\n- 如果设备关闭（$u_c=0$），它将在达到 $T_{\\text{high}}$ 时开启。因此，$T_{\\text{thr}} = T_{\\text{high}}$。\n- 如果设备开启（$u_c=1$），它将在达到 $T_{\\text{low}}$ 时关闭。因此，$T_{\\text{thr}} = T_{\\text{low}}$。\n\n为了找到切换所需时间 $\\Delta t_{cross} = t_{cross} - t_s$，我们求解方程 $T(t_{cross}) = T_{\\text{thr}}$ 关于 $\\Delta t_{cross}$ 的解：\n$$\nT_{\\text{thr}} = T_{\\infty} + (T_s - T_{\\infty}) e^{-k \\Delta t_{cross}}\n$$\n整理并求解 $\\Delta t_{cross}$ 得：\n$$\n\\frac{T_{\\text{thr}} - T_{\\infty}}{T_s - T_{\\infty}} = e^{-k \\Delta t_{cross}}\n$$\n$$\n\\ln\\left(\\frac{T_{\\text{thr}} - T_{\\infty}}{T_s - T_{\\infty}}\\right) = -k \\Delta t_{cross}\n$$\n$$\n\\Delta t_{cross} = -\\frac{1}{k} \\ln\\left(\\frac{T_{\\text{thr}} - T_{\\infty}}{T_s - T_{\\infty}}\\right) = \\tau \\ln\\left(\\frac{T_s - T_{\\infty}}{T_{\\text{thr}} - T_{\\infty}}\\right)\n$$\n仅当自然对数的参数大于1时，才存在一个物理上有意义的（正的、有限的）切换时间 $\\Delta t_{cross}$。这对应于阈值 $T_{\\text{thr}}$ 位于当前温度 $T_s$ 和渐近温度 $T_{\\infty}$ 之间的条件。具体来说：\n- 对于开启事件（$u_c=0$）：如果 $T_s  T_{\\text{high}}$ 且系统正朝向高于阈值的渐近温度加热，即 $T_{\\infty} > T_{\\text{high}}$，则会发生穿越。\n- 对于关闭事件（$u_c=1$）：如果 $T_s > T_{\\text{low}}$ 且系统正朝向低于阈值的渐近温度冷却，即 $T_{\\infty}  T_{\\text{low}}$，则会发生穿越。\n如果不满足这些条件，在当前恒定参数区间内不会发生切换事件。临界情况处理规则指出，如果在决策瞬间 $T_s = T_{\\text{thr}}$，则立即切换，因此 $\\Delta t_{cross}=0$。\n\n事件驱动模拟算法的结构如下：\n1. 初始化模拟状态：当前时间 $t_{curr}=0$，温度 $T_{curr}=T_0$，执行器模式 $u_{curr}=u_0$。创建一个列表来存储事件时间。\n2. 根据初始条件 $T_0$、$u_0$ 和相应的阈值，检查在 $t=0$ 时是否发生立即切换。如果发生切换，记录事件时间 $t=0$ 并更新 $u_{curr}$。\n3. 进入一个循环，直到 $t_{curr}$ 达到总模拟时长。\n4. 在循环内，对于当前状态 $(t_{curr}, T_{curr}, u_{curr})$：\n   a. 确定当前的环境温度 $T_{a,c}$ 和下一次计划的环境温度变化时间 $t_{amb}$。\n   b. 根据 $T_{a,c}$ 和 $u_{curr}$ 计算渐近温度 $T_{\\infty}$。\n   c. 确定活动阈值 $T_{\\text{thr}}$ 并检查是否可能发生切换。\n   d. 如果可能发生切换，则计算 $\\Delta t_{cross}$。潜在的切换时间为 $t_{switch} = t_{curr} + \\Delta t_{cross}$。否则，将 $t_{switch}$ 设置为无穷大。\n   e. 下一个事件时间为 $t_{next} = \\min(t_{switch}, t_{amb})$。\n   f. 如果 $t_{next}$ 超过模拟范围，则将时间推进到模拟结束并终止。\n   g. 将模拟推进到 $t_{next}$。使用解析解计算此时的温度 $T_{next}$。更新 $t_{curr} = t_{next}$ 和 $T_{curr} = T_{next}$。\n   h. 如果事件是切换事件（$t_{next} = t_{switch}$），则在事件列表中记录 $t_{next}$，翻转执行器模式 $u_{curr}$，并将 $T_{curr}$ 精确设置为 $T_{\\text{thr}}$。\n5. 循环终止后，返回记录的事件时间列表。\n\n此过程确保了温度轨迹在事件之间被精确地演化，并且切换时间是以解析精度计算的，从而满足了问题的要求。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: tau, q, T_set, Delta, T0, u0, ambient_segments\n        (1200.0, 0.01, 22.0, 1.0, 22.0, 0, [(1800.0, 30.0), (1800.0, 26.0), (1800.0, 28.0)]),\n        # Case 2\n        (900.0, 8.0/900.0, 24.0, 0.5, 24.5, 0, [(1200.0, 27.0)]),\n        # Case 3\n        (1500.0, 10.0/1500.0, 21.0, 0.7, 21.0, 0, [(3600.0, 18.0)]),\n        # Case 4\n        (300.0, 12.0/300.0, 25.0, 1.0, 26.0, 0, [(200.0, 32.0), (200.0, 34.0), (200.0, 30.0), (400.0, 29.0)]),\n        # Case 5\n        (600.0, 15.0/600.0, 22.0, 0.1, 22.0, 0, [(300.0, 27.0), (300.0, 27.0)])\n    ]\n    \n    all_results = []\n    for case in test_cases:\n        result = simulate_tcl(*case)\n        all_results.append(result)\n\n    # Format the final output string as specified\n    output_str = \"[\" + \",\".join([str(res) for res in all_results]) + \"]\"\n    print(output_str)\n\ndef simulate_tcl(tau, q, t_set, delta, t0, u0, ambient_segments):\n    \"\"\"\n    Simulates a single Thermostatically Controlled Load (TCL) case.\n\n    Args:\n        tau (float): Thermal time constant in seconds.\n        q (float): Cooling rate in degrees Celsius per second.\n        t_set (float): Temperature setpoint in degrees Celsius.\n        delta (float): Deadband half-width in degrees Celsius.\n        t0 (float): Initial indoor temperature in degrees Celsius.\n        u0 (int): Initial actuator mode (0 for OFF, 1 for ON).\n        ambient_segments (list): A list of tuples (duration, ambient_temp).\n\n    Returns:\n        list: A list of floating-point event times in seconds.\n    \"\"\"\n    k = 1.0 / tau\n    t_low = t_set - delta\n    t_high = t_set + delta\n\n    current_time = 0.0\n    current_temp = t0\n    current_mode = u0\n    \n    event_times = []\n\n    # Build ambient event schedule\n    ambient_events = []\n    _time = 0.0\n    total_duration = 0.0\n    for duration, temp in ambient_segments:\n        _time += duration\n        ambient_events.append((_time, temp))\n        total_duration = _time\n    \n    ambient_idx = 0\n\n    # Initial state check for immediate switch at t=0\n    # This loop handles the rare case of multiple immediate switches if T_low == T_high\n    while True:\n      initial_mode = current_mode\n      if current_mode == 0 and current_temp >= t_high:\n          event_times.append(current_time)\n          current_mode = 1\n          current_temp = t_high # Snap to threshold\n      elif current_mode == 1 and current_temp = t_low:\n          event_times.append(current_time)\n          current_mode = 0\n          current_temp = t_low # Snap to threshold\n          \n      if current_mode == initial_mode:\n        break\n\n\n    while current_time  total_duration:\n        # Determine current ambient conditions\n        while ambient_idx  len(ambient_events) and current_time >= ambient_events[ambient_idx][0]:\n            ambient_idx += 1\n\n        t_a = ambient_segments[ambient_idx][1]\n        next_ambient_time = ambient_events[ambient_idx][0]\n        \n        # Calculate asymptotic temperature\n        t_inf = t_a - current_mode * q * tau\n        \n        # Determine active threshold and calculate time to next switch\n        next_switch_time = float('inf')\n        \n        t_s = current_temp\n        \n        if current_mode == 0:  # OFF, heating up\n            t_thr = t_high\n            # Condition for crossing: T_s  T_thr and T_inf > T_thr\n            if t_s  t_thr and t_inf > t_thr:\n                # Handle division by zero if t_thr is close to t_inf\n                if not np.isclose(t_thr, t_inf):\n                    arg = (t_s - t_inf) / (t_thr - t_inf)\n                    if arg > 0: # It must be > 1, but >0 is a sanity check\n                        dt_cross = tau * np.log(arg)\n                        if dt_cross >= 0:\n                            next_switch_time = current_time + dt_cross\n        else:  # ON, cooling down\n            t_thr = t_low\n            # Condition for crossing: T_s > T_thr and T_inf  T_thr\n            if t_s > t_thr and t_inf  t_thr:\n                if not np.isclose(t_thr, t_inf):\n                    arg = (t_s - t_inf) / (t_thr - t_inf)\n                    if arg > 0:\n                        dt_cross = tau * np.log(arg)\n                        if dt_cross >= 0:\n                            next_switch_time = current_time + dt_cross\n                            \n        # Determine the next event\n        next_event_time = min(next_switch_time, next_ambient_time, total_duration)\n\n        if next_event_time = current_time and not np.isclose(next_event_time, current_time):\n            # This indicates no forward progress is possible, break to avoid infinite loop\n            break\n        \n        is_switch_event = np.isclose(next_event_time, next_switch_time)\n        \n        if np.isclose(current_time, total_duration):\n            break\n\n        # Propagate state to the next event time\n        dt = next_event_time - current_time\n        current_temp = t_inf + (t_s - t_inf) * np.exp(-k * dt)\n        current_time = next_event_time\n        \n        # Handle the event\n        if is_switch_event and current_time  total_duration:\n            event_times.append(current_time)\n            current_mode = 1 - current_mode\n            current_temp = t_thr # Snap temperature to threshold after switch\n\n    return event_times\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "理想化的模型是理解系统的起点，但现实世界的系统总是伴随着各种不确定性，例如传感器噪声。本练习将探讨温度传感器的测量误差如何影响TCL的控制决策。您将学习如何运用概率论，特别是高斯分布的性质，来分析并量化由噪声引起的“错误开关”事件的概率。这项实践将帮助您从理想模型迈向实际应用，理解并评估系统在不确定性下的鲁棒性。",
            "id": "4131049",
            "problem": "考虑一个单区制冷温控负载（Thermostatically Controlled Load, TCL），其控制基于滞回。该滞回逻辑使用两个温度阈值：一个下阈值 $T_{\\ell}$ 和一个上阈值 $T_{h}$，且 $T_{\\ell}  T_{h}$。控制策略如下：当感测温度 $T_{m}$ 大于或等于 $T_{h}$ 时，设备切换到开启（ON）状态；当 $T_{m}$ 小于或等于 $T_{\\ell}$ 时，设备切换到关闭（OFF）状态；当 $T_{m}$ 严格介于 $T_{\\ell}$ 和 $T_{h}$ 之间时，设备保持当前状态。感测温度由一个传感器产生，其测量模型为 $T_{m} = T + \\varepsilon$，其中 $T$ 是真实温度，$\\varepsilon$ 是传感器误差。假设传感器误差 $\\varepsilon$ 与 $T$ 独立，并服从均值为零、方差为 $\\sigma^{2}$ 的高斯分布，记为 $\\varepsilon \\sim \\mathcal{N}(0,\\sigma^{2})$。\n\n在某一决策时刻 $t_{0}$，TCL 处于关闭（OFF）状态。一个基于物理的区域热模型预测真实温度为 $T(t_{0}) = T^{\\star}$，且 $T^{\\star}  T_{h}$。将在 $t_{0}$ 时刻从关闭到开启转换的错误切换概率定义为：尽管 $T^{\\star}  T_{h}$，滞回逻辑在 $t_{0}$ 时刻仍发出开启命令的概率。从测量模型和滞回切换规则出发，仅使用高斯概率密度函数和累积分布函数的性质，推导该错误切换概率作为 $T^{\\star}$、$T_{h}$ 和 $\\sigma$ 的函数的闭式表达式。\n\n然后，在以下科学上现实的情景中计算该概率：\n- 下阈值 $T_{\\ell} = 22.0$ 摄氏度。\n- 上阈值 $T_{h} = 24.0$ 摄氏度。\n- 由热模型给出的 $t_{0}$ 时刻的真实温度 $T^{\\star} = 23.4$ 摄氏度。\n- 传感器标准差 $\\sigma = 0.15$ 摄氏度。\n\n将最终概率表示为标准科学记数法下的无单位十进制数。将最终答案四舍五入至四位有效数字。",
            "solution": "我们从传感器测量模型 $T_{m} = T + \\varepsilon$ 开始，其中 $\\varepsilon \\sim \\mathcal{N}(0,\\sigma^{2})$ 与真实温度 $T$ 独立。制冷设备的滞回逻辑由两个阈值 $T_{\\ell}  T_{h}$ 定义：\n- 如果 $T_{m} \\geq T_{h}$，则开启。\n- 如果 $T_{m} \\leq T_{\\ell}$，则关闭。\n- 否则保持当前状态。\n\n在决策时刻 $t_{0}$，TCL 处于关闭（OFF）状态，且热模型预测 $T(t_{0}) = T^{\\star}$，其中 $T^{\\star}  T_{h}$。如果控制器在 $T^{\\star}  T_{h}$ 的情况下仍发出开启命令，就会发生错误的从关闭到开启的切换事件。根据逻辑规则，该事件等价于感测温度超过上阈值，而真实温度低于上阈值。形式上，错误的开启事件 $\\mathcal{F}$ 为\n$$\n\\mathcal{F} = \\{ T_{m} \\geq T_{h} \\ \\text{and} \\ T^{\\star}  T_{h} \\}.\n$$\n由于 $T^{\\star}  T_{h}$ 是给定的，随机性完全源于传感器误差 $\\varepsilon$。使用 $T_{m} = T^{\\star} + \\varepsilon$，事件 $\\mathcal{F}$ 简化为\n$$\n\\mathcal{F} = \\{ T^{\\star} + \\varepsilon \\geq T_{h} \\} = \\{ \\varepsilon \\geq T_{h} - T^{\\star} \\}.\n$$\n因此，在 $t_{0}$ 时刻的错误切换概率 $p_{\\text{false}}$ 是\n$$\np_{\\text{false}} = \\mathbb{P}\\left( \\varepsilon \\geq T_{h} - T^{\\star} \\right).\n$$\n因为 $\\varepsilon \\sim \\mathcal{N}(0,\\sigma^{2})$，标准化变量 $Z = \\varepsilon/\\sigma$ 服从标准高斯分布，即 $Z \\sim \\mathcal{N}(0,1)$。设高斯累积分布函数记为 $\\Phi(x) = \\mathbb{P}(Z \\leq x)$。那么\n$$\np_{\\text{false}} = \\mathbb{P}\\left( Z \\geq \\frac{T_{h} - T^{\\star}}{\\sigma} \\right) = 1 - \\Phi\\!\\left( \\frac{T_{h} - T^{\\star}}{\\sigma} \\right).\n$$\n等价地，使用互补误差函数 $\\operatorname{erfc}(x)$ 和恒等式 $1 - \\Phi(x) = \\frac{1}{2}\\operatorname{erfc}\\!\\left(\\frac{x}{\\sqrt{2}}\\right)$，我们可以写出\n$$\np_{\\text{false}} = \\frac{1}{2}\\,\\operatorname{erfc}\\!\\left( \\frac{T_{h} - T^{\\star}}{\\sqrt{2}\\,\\sigma} \\right).\n$$\n这就是由高斯传感器误差引起的从关闭到开启的错误切换概率的闭式表达式。\n\n接下来，我们针对指定的情景计算这个概率。参数为\n$$\nT_{\\ell} = 22.0, \\quad T_{h} = 24.0, \\quad T^{\\star} = 23.4, \\quad \\sigma = 0.15,\n$$\n所有温度单位均为摄氏度，$\\sigma$ 的单位也为摄氏度。计算阈值差距\n$$\n\\Delta = T_{h} - T^{\\star} = 24.0 - 23.4 = 0.6.\n$$\n用 $\\sigma$ 进行标准化：\n$$\nz = \\frac{\\Delta}{\\sigma} = \\frac{0.6}{0.15} = 4.\n$$\n因此\n$$\np_{\\text{false}} = 1 - \\Phi(4) = \\frac{1}{2}\\,\\operatorname{erfc}\\!\\left( \\frac{4}{\\sqrt{2}} \\right).\n$$\n使用高斯分布经过充分检验的性质，在 $z = 4$ 处的单侧尾部概率为\n$$\n1 - \\Phi(4) \\approx 3.167 \\times 10^{-5}.\n$$\n四舍五入到四位有效数字后，从关闭到开启的错误切换概率为 $3.167 \\times 10^{-5}$，表示为科学记数法下的无单位十进制数。\n\n我们注意到，$T_{\\ell}$ 并不直接影响从关闭到开启的错误切换概率，因为开启决策仅取决于是否超过 $T_{h}$。然而，在 $T^{\\star} > T_{\\ell}$ 的从开启到关闭的情况下，类似的推导将得出 $p_{\\text{false}} = \\mathbb{P}\\left( \\varepsilon \\leq T_{\\ell} - T^{\\star} \\right) = \\Phi\\!\\left( \\frac{T_{\\ell} - T^{\\star}}{\\sigma} \\right)$，这显示了噪声通过滞回阈值传播的对称性。",
            "answer": "$$\\boxed{3.167 \\times 10^{-5}}$$"
        }
    ]
}