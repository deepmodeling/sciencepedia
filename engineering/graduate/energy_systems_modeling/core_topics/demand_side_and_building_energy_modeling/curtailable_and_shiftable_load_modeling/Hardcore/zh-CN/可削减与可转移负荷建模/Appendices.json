{
    "hands_on_practices": [
        {
            "introduction": "理论知识需要通过实践来巩固。我们的第一个练习将分析最基本的一类灵活性资源：可削减负荷。通过构建一个成本最小化模型，我们将运用优化理论来确定在满足舒适度约束的前提下，负荷的最优运行策略。这项练习不仅能帮助你掌握基本模型的构建，更能让你深刻理解灵活性的经济价值——即“影子价格”——是如何通过对偶变量体现的。",
            "id": "4082073",
            "problem": "考虑一个单一的可削减电力负荷，在一个由 $t \\in \\{1,\\dots,T\\}$ 索引的 $T$ 个一小时周期的离散时间范围内运行。设 $x_t$ 表示在周期 $t$ 输送给该负荷的能量（单位为兆瓦时，MWh）。该负荷面临外生的能源价格 $p_t$（单位为美元/兆瓦时，$/ \\mathrm{MWh}$），并有一个舒适度偏好的基线消耗量 $b_t$（MWh）以及一个对称的舒适度容差 $\\Delta_t$（MWh）。该负荷是可削减的，但受到设备容量限制 $\\bar{x}_t$（MWh/小时）。决策者在满足舒适度和容量约束的条件下，最小化能源采购成本。该规划模型如下：\n- 目标：最小化 $\\sum_{t=1}^{T} p_t x_t$。\n- 容量约束：对所有 $t$，有 $0 \\leq x_t \\leq \\bar{x}_t$。\n- 舒适度区间：对所有 $t$，有 $b_t - \\Delta_t \\leq x_t \\leq b_t + \\Delta_t$。\n\n任务：\n1. 从拉格朗日函数的标准定义和凸规划的最优性条件出发，为上述问题建立拉格朗日函数，为每个不等式约束使用非负的拉格朗日乘子。明确指出与下、上舒适度约束相关的乘子。\n2. 推导最优性的卡罗需-库恩-塔克（KKT）条件，包括平稳性、原始可行性、对偶可行性以及互补松弛性。陈述你为证明这些条件是必要且充分的而使用的任何正则性条件。\n3. 在此背景下，解释与舒适度界限相关的影子价格（最优拉格朗日乘子）的经济含义。\n4. 现在考虑一个特定的周期 $t^\\star$，其数据如下：$p_{t^\\star} = 73.25$ $/ \\mathrm{MWh}$，$b_{t^\\star} = 2.5$ MWh，$\\Delta_{t^\\star} = 0.4$ MWh，以及 $\\bar{x}_{t^\\star} = 4$ MWh。假设时间范围的其余部分存在严格可行解（因此强对偶性成立），确定在 $t^\\star$ 时哪些约束是紧约束，并计算与 $t^\\star$ 时下舒适度界限相关的最优影子价格（最优拉格朗日乘子）。将你的最终数值答案以 $/ \\mathrm{MWh}$ 为单位表示，并四舍五入到四位有效数字。",
            "solution": "所提出的问题是一个标准的、可分离的线性规划问题，在能源系统建模中很常见。它具有科学依据，是良定的、客观的，并包含了得出完整解决方案所需的所有信息。因此，该问题被认为是有效的。\n\n该优化问题可以分解并对每个时间段 $t \\in \\{1, \\dots, T\\}$ 独立求解。对于任何给定的时间段 $t$，问题是选择能源消耗量 $x_t$ 以：\n$$\n\\text{最小化 } p_t x_t\n$$\n约束条件为：\n$$\n0 \\le x_t \\le \\bar{x}_t \\\\\nb_t - \\Delta_t \\le x_t \\le b_t + \\Delta_t\n$$\n这些约束可以写成四个独立的线性不等式：\n1. $x_t - \\bar{x}_t \\le 0$ (容量上界)\n2. $-x_t \\le 0$ (容量下界 / 非负性)\n3. $x_t - (b_t + \\Delta_t) \\le 0$ (舒适度上界)\n4. $(b_t - \\Delta_t) - x_t \\le 0$ (舒适度下界)\n\n### 任务1：拉格朗日公式化\n\n为了构建拉格朗日函数，我们为给定周期 $t$ 的四个不等式约束中的每一个引入一个非负的拉格朗日乘子。设它们为：\n- $\\mu_t^{\\text{cap}} \\ge 0$ 对应容量上界，$x_t \\le \\bar{x}_t$。\n- $\\mu_t^0 \\ge 0$ 对应非负性约束，$x_t \\ge 0$。\n- $\\lambda_t^{\\text{upper}} \\ge 0$ 对应上舒适度约束，$x_t \\le b_t + \\Delta_t$。\n- $\\lambda_t^{\\text{lower}} \\ge 0$ 对应下舒适度约束，$x_t \\ge b_t - \\Delta_t$。\n\n整个问题的拉格朗日函数 $\\mathcal{L}$ 是每个周期拉格朗日函数的和。单个周期 $t$ 的拉格朗日函数，记作 $\\mathcal{L}_t$，是通过将目标函数与各约束乘以其对应的拉格朗日乘子相加来构建的。遵循标准形式 $\\mathcal{L}(x, \\lambda) = f(x) + \\sum_i \\lambda_i g_i(x)$，其中约束为 $g_i(x) \\le 0$：\n$$\n\\mathcal{L}_t(x_t, \\mu_t^{\\text{cap}}, \\mu_t^0, \\lambda_t^{\\text{upper}}, \\lambda_t^{\\text{lower}}) = p_t x_t + \\mu_t^{\\text{cap}}(x_t - \\bar{x}_t) + \\mu_t^0(-x_t) + \\lambda_t^{\\text{upper}}(x_t - (b_t + \\Delta_t)) + \\lambda_t^{\\text{lower}}((b_t - \\Delta_t) - x_t)\n$$\n与下、上舒适度约束相关的乘子分别是 $\\lambda_t^{\\text{lower}}$ 和 $\\lambda_t^{\\text{upper}}$。\n\n### 任务2：卡罗需-库恩-塔克 (KKT) 条件\n\n对于具有可微函数的凸优化问题，卡罗需-库恩-塔克（KKT）条件为最优性提供了必要和充分条件，前提是满足某个约束规范。由于这是一个线性规划问题，KKT条件总是最优性的必要和充分条件，严格来说不需要进一步的正则性条件。然而，问题陈述中提到存在一个严格可行解，这满足了斯莱特条件（Slater's condition），从而保证强对偶性成立，并且KKT条件对于最优性是必要的。\n\n对于给定周期 $t$ 的一个最优解 $(x_t^*, \\mu_t^{\\text{cap}*}, \\mu_t^{0*}, \\lambda_t^{\\text{upper}*}, \\lambda_t^{\\text{lower}*})$，KKT条件是：\n\n1.  **平稳性 (Stationarity)：** 拉格朗日函数关于原始变量 $x_t$ 的梯度在最优点必须为零。\n    $$\n    \\frac{\\partial \\mathcal{L}_t}{\\partial x_t} = p_t + \\mu_t^{\\text{cap}*} - \\mu_t^{0*} + \\lambda_t^{\\text{upper}*} - \\lambda_t^{\\text{lower}*} = 0\n    $$\n\n2.  **原始可行性 (Primal Feasibility)：** 最优解 $x_t^*$ 必须满足所有原始约束。\n    $$\n    0 \\le x_t^* \\le \\bar{x}_t \\\\\n    b_t - \\Delta_t \\le x_t^* \\le b_t + \\Delta_t\n    $$\n\n3.  **对偶可行性 (Dual Feasibility)：** 所有拉格朗日乘子必须为非负。\n    $$\n    \\mu_t^{\\text{cap}*} \\ge 0, \\quad \\mu_t^{0*} \\ge 0, \\quad \\lambda_t^{\\text{upper}*} \\ge 0, \\quad \\lambda_t^{\\text{lower}*} \\ge 0\n    $$\n\n4.  **互补松弛性 (Complementary Slackness)：** 每个乘子与其对应约束（形式为 $g_i(x) \\le 0$）的乘积必须为零。这意味着一个乘子只有在其对应的约束是紧约束（即等式成立）时才能为正。\n    $$\n    \\mu_t^{\\text{cap}*}(x_t^* - \\bar{x}_t) = 0 \\\\\n    \\mu_t^{0*}(-x_t^*) = 0 \\\\\n    \\lambda_t^{\\text{upper}*}(x_t^* - (b_t + \\Delta_t)) = 0 \\\\\n    \\lambda_t^{\\text{lower}*}((b_t - \\Delta_t) - x_t^*) = 0\n    $$\n\n### 任务3：影子价格的经济学解释\n\n最优拉格朗日乘子，通常称为影子价格或对偶变量，提供了最优目标函数值（即最小成本）对相应约束边际松弛的敏感度。\n\n-   乘子 $\\lambda_t^{\\text{lower}*}$ 是下舒适度界限 $x_t \\ge b_t - \\Delta_t$ 的影子价格。它量化了将最低消耗需求 $b_t - \\Delta_t$ 增加（收紧）一个单位所导致的最小成本的边际增加量。反过来说，它代表了如果允许消费者将其最低消耗需求减少一个单位所能获得的边际成本节约（成本的减少）。$\\lambda_t^{\\text{lower}*}$ 的单位是美元/兆瓦时（$\\$/\\mathrm{MWh}$）。如果这个约束不是紧约束，$\\lambda_t^{\\text{lower}*} = 0$，意味着进一步放宽它不会有成本节约。\n\n-   乘子 $\\lambda_t^{\\text{upper}*}$ 是上舒适度界限 $x_t \\le b_t + \\Delta_t$ 的影子价格。它量化了将最高消耗限制 $b_t + \\Delta_t$ 增加（放宽）一个单位所导致的最小成本的边际减少量。它代表了增加一个单位消耗限额的经济价值。其单位也是 $\\$/\\mathrm{MWh}$。如果这个约束不是紧约束，$\\lambda_t^{\\text{upper}*} = 0$，意味着进一步提高消耗限制不会带来经济效益。\n\n### 任务4：对周期 $t^\\star$ 的数值计算\n\n我们得到特定周期 $t^\\star$ 的数据如下：\n- $p_{t^\\star} = 73.25$ $/ \\mathrm{MWh}$\n- $b_{t^\\star} = 2.5$ MWh\n- $\\Delta_{t^\\star} = 0.4$ MWh\n- $\\bar{x}_{t^\\star} = 4$ MWh\n\n首先，我们通过组合所有约束来确定 $x_{t^\\star}$ 的可行域。\n- 容量约束为 $0 \\le x_{t^\\star} \\le 4$。\n- 舒适度约束为 $2.5 - 0.4 \\le x_{t^\\star} \\le 2.5 + 0.4$，简化为 $2.1 \\le x_{t^\\star} \\le 2.9$。\n\n$x_{t^\\star}$ 的总可行域是这两个区间的交集：\n$$\n\\max(0, 2.1) \\le x_{t^\\star} \\le \\min(4, 2.9)\n$$\n$$\n2.1 \\le x_{t^\\star} \\le 2.9\n$$\n目标是最小化成本，即 $p_{t^\\star} x_{t^\\star} = 73.25 x_{t^\\star}$。由于价格 $p_{t^\\star} = 73.25 > 0$，通过为 $x_{t^\\star}$ 选择最小的可行值来最小化成本。从可行域来看，最小值为 $2.1$。\n因此，最优能源消耗为 $x_{t^\\star}^* = 2.1$ MWh。\n\n接下来，我们确定在该最优点哪些约束是紧约束：\n- 下舒适度界限：$x_{t^\\star} \\ge 2.1$。由于 $x_{t^\\star}^* = 2.1$，该约束是**紧约束**。\n- 上舒适度界限：$x_{t^\\star} \\le 2.9$。由于 $x_{t^\\star}^* = 2.1  2.9$，该约束不是紧约束。\n- 容量上界：$x_{t^\\star} \\le 4$。由于 $x_{t^\\star}^* = 2.1  4$，该约束不是紧约束。\n- 非负性：$x_{t^\\star} \\ge 0$。由于 $x_{t^\\star}^* = 2.1 > 0$，该约束不是紧约束。\n\n现在，我们使用KKT条件来找到下舒适度界限的影子价格 $\\lambda_{t^\\star}^{\\text{lower}*}$。\n根据互补松弛性，由于上舒适度、容量和非负性约束不是紧约束，它们对应的乘子必须为零：\n- $\\lambda_{t^\\star}^{\\text{upper}*} = 0$\n- $\\mu_{t^\\star}^{\\text{cap}*} = 0$\n- $\\mu_{t^\\star}^{0*} = 0$\n\n我们将这些值代入平稳性方程：\n$$\np_{t^\\star} + \\mu_{t^\\star}^{\\text{cap}*} - \\mu_{t^\\star}^{0*} + \\lambda_{t^\\star}^{\\text{upper}*} - \\lambda_{t^\\star}^{\\text{lower}*} = 0\n$$\n$$\n73.25 + 0 - 0 + 0 - \\lambda_{t^\\star}^{\\text{lower}*} = 0\n$$\n解出 $\\lambda_{t^\\star}^{\\text{lower}*}$，我们得到：\n$$\n\\lambda_{t^\\star}^{\\text{lower}*} = 73.25\n$$\n对偶可行性条件 $\\lambda_{t^\\star}^{\\text{lower}*} \\ge 0$ 得到满足，因为 $73.25 \\ge 0$。\n与下舒适度界限相关的最优影子价格是 $73.25$ $/ \\mathrm{MWh}$。该值已经给出四位有效数字。",
            "answer": "$$\\boxed{73.25}$$"
        },
        {
            "introduction": "现实世界中的许多负荷，如工业批处理任务或家用洗碗机，其运行是离散且不可中断的，这与可连续调节的负荷有本质区别。本练习将指导你如何为这类“可平移负荷”建立混合整数线性规划（MILP）模型。你将学习如何使用二元变量来表示启停决策，并找到在满足截止期限的同时，最小化总能源成本的最佳调度方案。",
            "id": "4081977",
            "problem": "一台不可中断的洗碗机被建模为离散时间下的可移动负载。设时间范围的索引为 $t \\in \\{1,2,\\dots,T\\}$，步长统一为 $\\Delta t$ 小时。一个二元决策变量 $x_t \\in \\{0,1\\}$ 表示，如果 $x_t=1$，则洗碗机在时间 $t$ 开始其运行周期。该洗碗机有一个长度为 $L$ 个步长的固定运行曲线，表示为序列 $\\{s_0,s_1,\\dots,s_{L-1}\\}$，单位为千瓦，其中 $s_k$ 是启动后第 $k$ 个步长消耗的功率。在时间 $t$ 的总功率，记为 $P_t$（单位为千瓦），是所有可能启动时间的功率叠加结果。给定一个每步长的电价序列 $\\{c_t\\}$，单位为美元/千瓦时，总成本是整个时间范围内的离散时间能源成本。洗碗机必须在硬性截止时间 $D$ 之前完成其周期，这意味着如果它在时间 $t$ 启动，则必须满足 $t+L-1 \\le D$。\n\n任务：\n- 使用离散时间线性时不变叠加的基本原理和卷积的定义，构建一个二元时间索引的公式，通过卷积将 $\\{x_t\\}$ 映射到 $\\{P_t\\}$，强制规定只启动一个周期，并保证在截止日期前完成。将最小化总能源成本的目标公式化，并在一个混合整数线性规划（MILP）中清晰地陈述所有决策变量、约束和目标函数。\n- 然后，对于下面的具体数据，确定能使总成本最小化的最优启动时间索引 $t^\\star$。\n\n数据：\n- 时间步长 $\\Delta t = 1$ 小时，时间范围长度 $T=6$。\n- 洗碗机运行曲线长度 $L=3$，功率为 $\\{s_0,s_1,s_2\\} = \\{1.4,\\,0.7,\\,0.2\\}$ 千瓦。\n- 电价 $\\{c_t\\}_{t=1}^{6} = \\{0.12,\\,0.10,\\,0.24,\\,0.30,\\,0.22,\\,0.15\\}$ 美元/千瓦时。\n- 截止时间 $D=5$。\n\n将最终答案表示为最优启动索引 $t^\\star$（一个整数）。$t^\\star$ 无需四舍五入，也无需物理单位。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于能源系统建模的原理，问题设定良好，具有明确的目标和充足的数据，并且语言客观。因此，我们可以着手解决该问题。\n\n该问题分为两部分：首先，为不可中断的可移动负载的最优调度构建一个通用的混合整数线性规划（MILP）公式；其次，解决一个具体实例以找到最优启动时间。\n\n### 第1部分：MILP 公式化\n\n目标是将最小化总能源成本的问题形式化为一个 MILP。这需要定义决策变量、一个目标函数以及一组模拟系统行为的约束条件。\n\n**1. 决策变量**\n主要决策是何时启动洗碗机周期。我们为调度范围 $t \\in \\{1, 2, \\dots, T\\}$ 中的每个时间步 $t$ 定义一组二元变量 $x_t$。\n- $x_t \\in \\{0, 1\\}$：一个二元变量，其中 $x_t = 1$ 表示洗碗机周期在时间步 $t$ 开始，否则 $x_t = 0$。\n\n**2. 作为卷积的功耗**\n在任何时间步 $t$ 的总功率 $P_t$ 是任何正在进行的洗碗机周期所消耗功率的叠加。洗碗机有一个长度为 $L$ 的固定功率曲线 $\\{s_0, s_1, \\dots, s_{L-1}\\}$。如果一个周期在时间 $\\tau$ 开始，它将在时间 $\\tau+k$ 消耗功率 $s_k$，其中 $k \\in \\{0, 1, \\dots, L-1\\}$。\n\n在时间 $t$ 的功率 $P_t$ 是所有可能启动时间 $\\tau$ 贡献的总和。一个在 $\\tau$ 开始的周期仅当 $t$ 在其运行窗口内（即 $\\tau \\le t  \\tau+L$）时才对时间 $t$ 的功率有贡献。从一个在 $\\tau$ 启动的周期在时间 $t$ 消耗的具体功率是 $s_{t-\\tau}$。对所有可能的启动时间 $\\tau$ 求和，我们得到：\n$$P_t = \\sum_{\\tau=1}^{T} s_{t-\\tau} x_\\tau$$\n该公式表示一个离散卷积。为使其精确，我们定义对于任何索引 $k  0$ 或 $k \\ge L$，$s_k = 0$。这确保了在 $\\tau$ 启动（$x_\\tau=1$）仅对 $t \\in \\{\\tau, \\tau+1, \\dots, \\tau+L-1\\}$ 的 $P_t$ 有贡献。这组方程（对于 $t=1, \\dots, T$）将 $P_t$ 定义为决策变量 $x_t$ 的线性函数。\n\n**3. 约束条件**\n必须强制执行两个主要约束：\na. **单次运行**：洗碗机在整个时间范围内必须且只能运行一次。\nb. **截止时间**：周期必须在截止时间 $D$ 之前完成。一个在 $t$ 开始的周期运行 $L$ 个步长，并在时间 $t+L-1$ 结束。因此，为了使周期在 $D$ 之前完成，我们必须有 $t+L-1 \\le D$，这可以简化为 $t \\le D-L+1$。\n\n这两个条件可以合并成一个简洁的约束。有效的启动时间集合是 $\\{1, 2, \\dots, D-L+1\\}$。我们必须从这个集合中选择一个且仅一个启动时间。这表示为：\n$$\\sum_{t=1}^{D-L+1} x_t = 1$$\n这个约束，结合 $x_t$ 的二元性质，确保了在有效范围内的 $x_t$ 中只有一个为 $1$，而所有其他（包括那些 $t > D-L+1$ 的）都为 $0$。\n\n**4. 目标函数**\n目标是最小化在时间范围 $T$ 内的总能源成本。在时间步 $t$ 中消耗的能量是 $E_t = P_t \\cdot \\Delta t$，其中 $\\Delta t$ 是时间步的持续时间（以小时为单位）。该时间步的成本是 $c_t \\cdot E_t$。总成本是所有时间步的总和：\n$$\\text{总成本} = \\sum_{t=1}^{T} c_t E_t = \\sum_{t=1}^{T} c_t (P_t \\Delta t) = \\Delta t \\sum_{t=1}^{T} c_t P_t$$\n由于 $\\Delta t$ 是一个正常数，最小化总成本等同于最小化 $\\sum_{t=1}^{T} c_t P_t$。\n\n**MILP 公式化总结：**\n- **参数：** $T, L, D, \\Delta t, \\{s_k\\}, \\{c_t\\}$。\n- **决策变量：** $x_t \\in \\{0, 1\\}$，对于 $t \\in \\{1, \\dots, D-L+1\\}$。\n- **目标：**\n  $$\\min \\Delta t \\sum_{t=1}^{T} c_t \\left( \\sum_{\\tau=1}^{t} s_{t-\\tau} x_\\tau \\right)$$\n- **约束条件：**\n  $$\\sum_{t=1}^{D-L+1} x_t = 1$$\n  （其中，对于 $k0$ 或 $k \\ge L$，$s_k=0$）。\n\n### 第2部分：具体计算\n\n现在我们使用给定数据来解决问题：\n- $\\Delta t = 1$ 小时\n- $T = 6$\n- $L = 3$ 个步长\n- $s = \\{s_0, s_1, s_2\\} = \\{1.4, 0.7, 0.2\\}$ 千瓦\n- $c = \\{c_1, \\dots, c_6\\} = \\{0.12, 0.10, 0.24, 0.30, 0.22, 0.15\\}$ 美元/千瓦时\n- $D = 5$\n\n首先，我们确定可行的启动时间集合。截止时间约束为 $t \\le D-L+1$：\n$$t \\le 5 - 3 + 1 \\implies t \\le 3$$\n因此，可能的启动时间为 $t \\in \\{1, 2, 3\\}$。我们需要计算这三种情况下的总成本，并选择成本最低的一种。\n\n在时间 $\\tau$ 启动一个周期（即 $x_\\tau=1$ 且其他 $x_t=0$）的总成本由以下公式给出：\n$$\\text{成本}(\\tau) = \\Delta t \\sum_{k=0}^{L-1} c_{\\tau+k} s_k$$\n当 $\\Delta t = 1$ 时，该公式简化为：\n$$\\text{成本}(\\tau) = c_{\\tau}s_0 + c_{\\tau+1}s_1 + c_{\\tau+2}s_2$$\n\n让我们计算每个可行启动时间的成本：\n\n**情况1：在 $t=1$ 启动** ($\\tau=1$)\n周期在时间步 $1, 2, 3$ 运行。\n$$\\text{成本}(1) = c_1 s_0 + c_2 s_1 + c_3 s_2$$\n$$\\text{成本}(1) = (0.12)(1.4) + (0.10)(0.7) + (0.24)(0.2)$$\n$$\\text{成本}(1) = 0.168 + 0.070 + 0.048 = 0.286$$\n\n**情况2：在 $t=2$ 启动** ($\\tau=2$)\n周期在时间步 $2, 3, 4$ 运行。\n$$\\text{成本}(2) = c_2 s_0 + c_3 s_1 + c_4 s_2$$\n$$\\text{成本}(2) = (0.10)(1.4) + (0.24)(0.7) + (0.30)(0.2)$$\n$$\\text{成本}(2) = 0.140 + 0.168 + 0.060 = 0.368$$\n\n**情况3：在 $t=3$ 启动** ($\\tau=3$)\n周期在时间步 $3, 4, 5$ 运行。\n$$\\text{成本}(3) = c_3 s_0 + c_4 s_1 + c_5 s_2$$\n$$\\text{成本}(3) = (0.24)(1.4) + (0.30)(0.7) + (0.22)(0.2)$$\n$$\\text{成本}(3) = 0.336 + 0.210 + 0.044 = 0.590$$\n\n比较总成本：\n- $\\text{成本}(1) = 0.286$\n- $\\text{成本}(2) = 0.368$\n- $\\text{成本}(3) = 0.590$\n\n最低成本为 $0.286$，这是在洗碗机周期于时间 $t=1$ 启动时实现的。\n因此，最优启动时间索引是 $t^\\star = 1$。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "掌握了单一负荷的建模方法后，我们将进入一个更真实、更复杂的场景：作为一名负荷聚合商，你需要管理一个包含多种资源的资产组合。本练习将前两个实践中的概念相结合，要求你同时调度一个连续可调的基线负荷和多个离散的、可平移的作业，并确保它们的总功耗不超过共享的容量限制。通过这个综合性练习，你将学会如何构建一个统一的优化模型，以协同管理不同类型的灵活性资源，实现组合层面的成本最小化。",
            "id": "4082022",
            "problem": "一个聚合商在一个由 $T=\\{1,2,3,4\\}$ 个长度为 $\\Delta t = 1$ 小时的时段组成的离散规划时域内管理电力消耗。其管理组合包括两类终端用户：(i) 可削减的基线负荷和 (ii) 多个可转移的工作。聚合商在每个时段受到外生功率容量 $C_t$ 的限制，并且必须分配消耗，以使由可削减基线和可转移工作所消耗的功率总和不超过该容量。使用以下经过充分测试的基本原理和核心定义：\n- 功率-能量关系：对于持续时间为 $\\Delta t$ 的时段，消耗的能量等于功率乘以时间。\n- 容量可行性：在某一给定时段内的总功率不能超过该时段的可用容量。\n- 可削减的基线负荷是一种连续、非负的功率量，可以削减至期望基线以下，并产生与所削减能量成正比的线性惩罚。\n- 可转移的工作是一种离散任务，当其在某一时段内活动时，会消耗固定的功率，并且必须在给定的可用时间窗口内安排指定的时段数。\n\n数据：\n- 容量概况（单位：千瓦）：$C_1=6$, $C_2=5$, $C_3=4$, $C_4=6$。\n- 期望基线（不可转移）功率概况（单位：千瓦）：$b_1=4$, $b_2=4$, $b_3=4$, $b_4=4$。\n- 削减惩罚系数（单位：美元/千瓦时）：$q_1=1$, $q_2=3$, $q_3=2$, $q_4=1$。\n- 可转移的工作：\n  - 工作 $A$：固定功率 $P_A=2$ 千瓦，持续时间 $D_A=2$ 个时段，可用时间窗口 $W_A=\\{1,2,3\\}$。\n  - 工作 $B$：固定功率 $P_B=3$ 千瓦，持续时间 $D_B=1$ 个时段，可用时间窗口 $W_B=\\{2,3,4\\}$。\n\n建模要求：\n- 使用连续变量 $l_t \\in [0,b_t]$ 来表示在每个时段 $t \\in T$ 内供应的可削减基线负荷功率。\n- 使用二元变量 $x_{i,t} \\in \\{0,1\\}$ 来表示工作 $i \\in \\{A,B\\}$ 在时段 $t \\in T$ 内是否处于活动状态（工作在时段之间是可抢占的，但在时段内是不可分割的）。\n- 对所有 $t \\in T$ 强制执行形式为 $\\sum_{i \\in \\{A,B\\}} P_i x_{i,t} + l_t \\le C_t$ 的共享容量约束。\n- 对每个工作 $i \\in \\{A,B\\}$ 强制执行形式为 $\\sum_{t \\in W_i} x_{i,t} = D_i$ 和 $x_{i,t}=0$（对 $t \\notin W_i$）的工作持续时间和窗口约束。\n- 最小化总削减惩罚 $\\sum_{t \\in T} q_t \\,(b_t - l_t)\\,\\Delta t$。\n\n任务：\n1. 将上述问题建立为混合整数线性规划（MILP）问题，明确说明决策变量、目标和约束。\n2. 针对提供的数据求解该 MILP 问题，并计算最小总削减惩罚。以美元（USD）表示最终成本。无需四舍五入。您的最终答案必须是单一实数。",
            "solution": "用户提供了一个能源系统建模领域的定义明确的问题，该问题需要建立并求解一个混合整数线性规划（MILP）问题。\n\n### 第 1 部分：MILP 公式化\n\n问题是安排一组可转移的工作，并确定要供应的可削减负荷的最佳水平，以在功率容量约束下最小化削减产生的总惩罚。\n\n**决策变量**\n设 $T = \\{1, 2, 3, 4\\}$ 为时段集合。设 $I = \\{A, B\\}$ 为可转移工作的集合。\n-   $l_t$：一个连续变量，表示在时段 $t \\in T$ 内供应给可削减基线负荷的功率（单位：kW）。\n-   $x_{i,t}$：针对每个工作 $i \\in I$ 和时段 $t \\in T$ 的二元变量，其中若工作 $i$ 在时段 $t$ 内活动，则 $x_{i,t} = 1$，否则 $x_{i,t} = 0$。\n\n**目标函数**\n目标是最小化总削减惩罚。时段 $t$ 内削减的功率是 $(b_t - l_t)$，削减的能量是 $(b_t - l_t)\\Delta t$。总惩罚是所有时段惩罚的总和。\n$$\n\\text{Minimize } Z = \\sum_{t \\in T} q_t (b_t - l_t) \\Delta t\n$$\n代入给定值，其中 $\\Delta t = 1$ 小时：\n$$\n\\text{Minimize } Z = 1(4 - l_1) \\cdot 1 + 3(4 - l_2) \\cdot 1 + 2(4 - l_3) \\cdot 1 + 1(4 - l_4) \\cdot 1\n$$\n$$\n\\text{Minimize } Z = (4 - l_1) + 3(4 - l_2) + 2(4 - l_3) + (4 - l_4)\n$$\n此表达式可重写为：\n$$\n\\text{Minimize } Z = (4 + 12 + 8 + 4) - (l_1 + 3l_2 + 2l_3 + l_4) = 28 - (l_1 + 3l_2 + 2l_3 + l_4)\n$$\n最小化此表达式等同于最大化项 $\\sum_{t \\in T} q_t l_t \\Delta t = l_1 + 3l_2 + 2l_3 + l_4$。\n\n**约束**\n此优化受以下约束的限制：\n1.  **容量约束**：对每个时段 $t \\in T$，总消耗功率不得超过可用容量 $C_t$。\n    $$\n    \\sum_{i \\in I} P_i x_{i,t} + l_t \\le C_t \\quad \\forall t \\in T\n    $$\n    -   $t=1$: $2x_{A,1} + 3x_{B,1} + l_1 \\le 6$\n    -   $t=2$: $2x_{A,2} + 3x_{B,2} + l_2 \\le 5$\n    -   $t=3$: $2x_{A,3} + 3x_{B,3} + l_3 \\le 4$\n    -   $t=4$: $2x_{A,4} + 3x_{B,4} + l_4 \\le 6$\n\n2.  **工作持续时间约束**：每个工作 $i$ 必须总共活动 $D_i$ 个时段。\n    -   工作 A: $\\sum_{t=1}^4 x_{A,t} = D_A = 2$\n    -   工作 B: $\\sum_{t=1}^4 x_{B,t} = D_B = 1$\n\n3.  **工作可用时间窗口约束**：工作只能在其指定的可用时间窗口内活动。\n    -   工作 A: $x_{A,t} = 0$ for $t \\notin W_A = \\{1, 2, 3\\}$。这意味着 $x_{A,4} = 0$。持续时间约束变为 $\\sum_{t \\in W_A} x_{A,t} = x_{A,1} + x_{A,2} + x_{A,3} = 2$。\n    -   工作 B: $x_{B,t} = 0$ for $t \\notin W_B = \\{2, 3, 4\\}$。这意味着 $x_{B,1} = 0$。持续时间约束变为 $\\sum_{t \\in W_B} x_{B,t} = x_{B,2} + x_{B,3} + x_{B,4} = 1$。\n\n4.  **变量边界**：\n    -   $0 \\le l_t \\le b_t$，即对所有 $t \\in T$，$0 \\le l_t \\le 4$。\n    -   $x_{i,t} \\in \\{0, 1\\}$ 对所有 $i \\in I, t \\in T$。\n\n### 第 2 部分：MILP 求解\n\n该问题足够小，可以通过枚举二元变量 $x_{i,t}$ 的所有可行排程，然后计算每个排程产生的最小成本来求解。\n\n对于一个固定的工作排程（即所有 $x_{i,t}$ 的值都已固定），目标是最小化 $\\sum_{t} q_t(b_t - l_t)\\Delta t$。这可以通过使每个 $l_t$ 尽可能大来实现。对 $l_t$ 的约束是 $0 \\le l_t \\le b_t$ 和 $l_t \\le C_t - \\sum_i P_i x_{i,t}$。因此，对于给定的排程，$l_t$ 的最优值是：\n$$\nl_t^* = \\min(b_t, C_t - \\sum_{i \\in I} P_i x_{i,t})\n$$\n如果对任何 $t$，$C_t - \\sum_{i \\in I} P_i x_{i,t}  0$，则该排程是不可行的。\n\n工作 A（在 $W_A=\\{1,2,3\\}$ 中需安排 $D_A=2$ 个时段）的可能排程是：\n-   A1：在时段 $\\{1, 2\\}$ 活动。\n-   A2：在时段 $\\{1, 3\\}$ 活动。\n-   A3：在时段 $\\{2, 3\\}$ 活动。\n\n工作 B（在 $W_B=\\{2,3,4\\}$ 中需安排 $D_B=1$ 个时段）的可能排程是：\n-   B1：在时段 $\\{2\\}$ 活动。\n-   B2：在时段 $\\{3\\}$ 活动。\n-   B3：在时段 $\\{4\\}$ 活动。\n\n我们现在评估这 $3 \\times 3 = 9$ 个组合排程。令 $P_{jobs,t} = P_A x_{A,t} + P_B x_{B,t}$ 为时段 $t$ 内已排程工作的总功率。时段 $t$ 内削减的能量为 $K_t = (b_t - \\min(b_t, C_t - P_{jobs,t}))\\Delta t$。总成本为 $\\sum_{t=1}^4 q_t K_t$。使用的数据是：容量 $C = (6, 5, 4, 6)$，基线 $b = (4, 4, 4, 4)$，惩罚 $q = (1, 3, 2, 1)$，$\\Delta t = 1$，$P_A=2$，$P_B=3$。\n\n-   **情况 1：A 在 $\\{1,2\\}$，B 在 $\\{2\\}$**\n    $P_{jobs} = (2, 5, 0, 0)$。$C^{rem} = (4, 0, 4, 6)$。$l^*=(4,0,4,4)$。削减的能量 $K=(0,4,0,0)$。成本 = $3 \\times 4 = 12$。\n\n-   **情况 2：A 在 $\\{1,2\\}$，B 在 $\\{3\\}$**\n    $P_{jobs} = (2, 2, 3, 0)$。$C^{rem} = (4, 3, 1, 6)$。$l^*=(4,3,1,4)$。削减的能量 $K=(0,1,3,0)$。成本 = $(3 \\times 1) + (2 \\times 3) = 9$。\n\n-   **情况 3：A 在 $\\{1,2\\}$，B 在 $\\{4\\}$**\n    $P_{jobs} = (2, 2, 0, 3)$。$C^{rem} = (4, 3, 4, 3)$。$l^*=(4,3,4,3)$。削减的能量 $K=(0,1,0,1)$。成本 = $(3 \\times 1) + (1 \\times 1) = 4$。\n\n-   **情况 4：A 在 $\\{1,3\\}$，B 在 $\\{2\\}$**\n    $P_{jobs} = (2, 3, 2, 0)$。$C^{rem} = (4, 2, 2, 6)$。$l^*=(4,2,2,4)$。削减的能量 $K=(0,2,2,0)$。成本 = $(3 \\times 2) + (2 \\times 2) = 10$。\n\n-   **情况 5：A 在 $\\{1,3\\}$，B 在 $\\{3\\}$**\n    $P_{jobs} = (2, 0, 5, 0)$。在时段 $t=3$，工作功率为 $P_A + P_B = 2+3=5$，但容量为 $C_3=4$。此排程不可行。\n\n-   **情况 6：A 在 $\\{1,3\\}$，B 在 $\\{4\\}$**\n    $P_{jobs} = (2, 0, 2, 3)$。$C^{rem} = (4, 5, 2, 3)$。$l^*=(4,4,2,3)$。削减的能量 $K=(0,0,2,1)$。成本 = $(2 \\times 2) + (1 \\times 1) = 5$。\n\n-   **情况 7：A 在 $\\{2,3\\}$，B 在 $\\{2\\}$**\n    $P_{jobs} = (0, 5, 2, 0)$。$C^{rem} = (6, 0, 2, 6)$。$l^*=(4,0,2,4)$。削减的能量 $K=(0,4,2,0)$。成本 = $(3 \\times 4) + (2 \\times 2) = 16$。\n\n-   **情况 8：A 在 $\\{2,3\\}$，B 在 $\\{3\\}$**\n    $P_{jobs} = (0, 2, 5, 0)$。在时段 $t=3$，工作功率为 $5$，容量为 $4$。此排程不可行。\n\n-   **情况 9：A 在 $\\{2,3\\}$，B 在 $\\{4\\}$**\n    $P_{jobs} = (0, 2, 2, 3)$。$C^{rem} = (6, 3, 2, 3)$。$l^*=(4,3,2,3)$。削减的能量 $K=(0,1,2,1)$。成本 = $(3 \\times 1) + (2 \\times 2) + (1 \\times 1) = 8$。\n\n比较所有可行排程的总成本：$\\{12, 9, 4, 10, 5, 16, 8\\}$。最小成本为 $4$ 美元。这发生在工作 A 被安排在时段 $\\{1, 2\\}$ 且工作 B 被安排在时段 $\\{4\\}$ 时。\n\n最佳解为：\n-   $x_{A,1}=1, x_{A,2}=1$，所有其他 $x_{A,t}=0$。\n-   $x_{B,4}=1$，所有其他 $x_{B,t}=0$。\n-   $l_1 = 4$ kW, $l_2 = 3$ kW, $l_3 = 4$ kW, $l_4 = 3$ kW。\n-   最小总削减惩罚 = $4$ 美元。",
            "answer": "$$\n\\boxed{4}\n$$"
        }
    ]
}