{
    "hands_on_practices": [
        {
            "introduction": "This first exercise lays the theoretical groundwork for modeling curtailable loads. By formulating a basic cost-minimization problem, you will apply the Karush-Kuhn-Tucker (KKT) conditions to not only solve for the optimal consumption but also to interpret the economic meaning of dual variables, or shadow prices . This practice is fundamental for understanding how market signals and physical constraints interact to determine the behavior of price-responsive demand.",
            "id": "4082073",
            "problem": "Consider a single curtailable electric load operated over a discrete horizon of $T$ one-hour periods indexed by $t \\in \\{1,\\dots,T\\}$. Let $x_t$ denote the energy delivered to the load in period $t$ (measured in megawatt-hours, MWh). The load faces exogenous energy prices $p_t$ (measured in dollars per megawatt-hour, $/ \\mathrm{MWh}$), and has a comfort-preferred baseline consumption $b_t$ (MWh) together with a symmetric comfort tolerance $\\Delta_t$ (MWh). The load is curtailable but subject to device capacity limits $\\bar{x}_t$ (MWh per hour). The decision-maker minimizes energy procurement cost subject to comfort and capacity constraints. The planning model is:\n- Objective: minimize $\\sum_{t=1}^{T} p_t x_t$.\n- Capacity: $0 \\leq x_t \\leq \\bar{x}_t$ for all $t$.\n- Comfort band: $b_t - \\Delta_t \\leq x_t \\leq b_t + \\Delta_t$ for all $t$.\n\nTasks:\n1. Starting from the standard definition of the Lagrangian and the optimality conditions for convex programs, formulate the Lagrangian for the above problem using nonnegative Lagrange multipliers for each inequality constraint. Clearly identify the multipliers associated with the lower and upper comfort constraints.\n2. Derive the Karush-Kuhn-Tucker (KKT) conditions for optimality, including stationarity, primal feasibility, dual feasibility, and complementary slackness. State any regularity condition you use to justify that these conditions are necessary and sufficient.\n3. Interpret the economic meaning of the shadow prices (optimal Lagrange multipliers) associated with the comfort bounds in this context.\n4. Now consider a particular period $t^\\star$ with the following data: $p_{t^\\star} = 73.25$ $/ \\mathrm{MWh}$, $b_{t^\\star} = 2.5$ MWh, $\\Delta_{t^\\star} = 0.4$ MWh, and $\\bar{x}_{t^\\star} = 4$ MWh. Assuming the rest of the horizon admits a strictly feasible solution (so that strong duality holds), determine which constraints bind at $t^\\star$, and calculate the optimal shadow price (the optimal Lagrange multiplier) associated with the lower comfort bound at $t^\\star$. Express your final numerical answer in $/ \\mathrm{MWh}$ and round your answer to four significant figures.",
            "solution": "The problem presented is a standard, separable linear programming problem common in energy systems modeling. It is scientifically grounded, well-posed, objective, and contains all necessary information for a complete solution. Therefore, the problem is deemed valid.\n\nThe optimization problem can be decomposed and solved independently for each time period $t \\in \\{1, \\dots, T\\}$. For any given period $t$, the problem is to choose the energy consumption $x_t$ to:\n$$\n\\text{Minimize } p_t x_t\n$$\nSubject to:\n$$\n0 \\le x_t \\le \\bar{x}_t \\\\\nb_t - \\Delta_t \\le x_t \\le b_t + \\Delta_t\n$$\nThese constraints can be written as four separate linear inequalities:\n1. $x_t - \\bar{x}_t \\le 0$ (Capacity upper bound)\n2. $-x_t \\le 0$ (Capacity lower bound / non-negativity)\n3. $x_t - (b_t + \\Delta_t) \\le 0$ (Comfort upper bound)\n4. $(b_t - \\Delta_t) - x_t \\le 0$ (Comfort lower bound)\n\n### Task 1: Lagrangian Formulation\n\nTo formulate the Lagrangian, we introduce a non-negative Lagrange multiplier for each of the four inequality constraints for a given period $t$. Let these be:\n- $\\mu_t^{\\text{cap}} \\ge 0$ for the capacity upper bound, $x_t \\le \\bar{x}_t$.\n- $\\mu_t^0 \\ge 0$ for the non-negativity constraint, $x_t \\ge 0$.\n- $\\lambda_t^{\\text{upper}} \\ge 0$ for the upper comfort constraint, $x_t \\le b_t + \\Delta_t$.\n- $\\lambda_t^{\\text{lower}} \\ge 0$ for the lower comfort constraint, $x_t \\ge b_t - \\Delta_t$.\n\nThe Lagrangian function $\\mathcal{L}$ for the entire problem is the sum of the Lagrangians for each period. The Lagrangian for a single period $t$, denoted $\\mathcal{L}_t$, is constructed by adding the objective function and the constraints multiplied by their respective Lagrange multipliers. Following the standard form $\\mathcal{L}(x, \\lambda) = f(x) + \\sum_i \\lambda_i g_i(x)$ for constraints $g_i(x) \\le 0$:\n$$\n\\mathcal{L}_t(x_t, \\mu_t^{\\text{cap}}, \\mu_t^0, \\lambda_t^{\\text{upper}}, \\lambda_t^{\\text{lower}}) = p_t x_t + \\mu_t^{\\text{cap}}(x_t - \\bar{x}_t) + \\mu_t^0(-x_t) + \\lambda_t^{\\text{upper}}(x_t - (b_t + \\Delta_t)) + \\lambda_t^{\\text{lower}}((b_t - \\Delta_t) - x_t)\n$$\nThe multipliers associated with the lower and upper comfort constraints are $\\lambda_t^{\\text{lower}}$ and $\\lambda_t^{\\text{upper}}$, respectively.\n\n### Task 2: Karush-Kuhn-Tucker (KKT) Conditions\n\nThe Karush-Kuhn-Tucker (KKT) conditions provide necessary and sufficient conditions for optimality for a convex optimization problem with differentiable functions, provided a constraint qualification holds. As this is a linear program, the KKT conditions are always necessary and sufficient for optimality, and no further regularity condition is strictly required. However, the problem states that a strictly feasible solution exists, which satisfies Slater's condition, thus guaranteeing that strong duality holds and the KKT conditions are necessary for optimality.\n\nFor an optimal solution $(x_t^*, \\mu_t^{\\text{cap}*}, \\mu_t^{0*}, \\lambda_t^{\\text{upper}*}, \\lambda_t^{\\text{lower}*})$ for a given period $t$, the KKT conditions are:\n\n1.  **Stationarity:** The gradient of the Lagrangian with respect to the primal variable $x_t$ must be zero at the optimal point.\n    $$\n    \\frac{\\partial \\mathcal{L}_t}{\\partial x_t} = p_t + \\mu_t^{\\text{cap}*} - \\mu_t^{0*} + \\lambda_t^{\\text{upper}*} - \\lambda_t^{\\text{lower}*} = 0\n    $$\n\n2.  **Primal Feasibility:** The optimal solution $x_t^*$ must satisfy all original constraints.\n    $$\n    0 \\le x_t^* \\le \\bar{x}_t \\\\\n    b_t - \\Delta_t \\le x_t^* \\le b_t + \\Delta_t\n    $$\n\n3.  **Dual Feasibility:** All Lagrange multipliers must be non-negative.\n    $$\n    \\mu_t^{\\text{cap}*} \\ge 0, \\quad \\mu_t^{0*} \\ge 0, \\quad \\lambda_t^{\\text{upper}*} \\ge 0, \\quad \\lambda_t^{\\text{lower}*} \\ge 0\n    $$\n\n4.  **Complementary Slackness:** The product of each multiplier and its corresponding constraint (in the form $g_i(x) \\le 0$) must be zero. This implies that a multiplier can only be positive if its corresponding constraint is active (i.e., holds with equality).\n    $$\n    \\mu_t^{\\text{cap}*}(x_t^* - \\bar{x}_t) = 0 \\\\\n    \\mu_t^{0*}(-x_t^*) = 0 \\\\\n    \\lambda_t^{\\text{upper}*}(x_t^* - (b_t + \\Delta_t)) = 0 \\\\\n    \\lambda_t^{\\text{lower}*}((b_t - \\Delta_t) - x_t^*) = 0\n    $$\n\n### Task 3: Economic Interpretation of Shadow Prices\n\nThe optimal Lagrange multipliers, often called shadow prices or dual variables, provide the sensitivity of the optimal objective function value (i.e., minimum cost) to a marginal relaxation of the corresponding constraint.\n\n-   The multiplier $\\lambda_t^{\\text{lower}*}$ is the shadow price of the lower comfort bound $x_t \\ge b_t - \\Delta_t$. It quantifies the marginal increase in the minimum cost for a unit increase (tightening) of the lower consumption requirement $b_t - \\Delta_t$. Inversely, it represents the marginal cost saving (a decrease in cost) if the consumer is allowed to reduce their minimum consumption requirement by one unit. The units of $\\lambda_t^{\\text{lower}*}$ are dollars per megawatt-hour ($\\$/\\mathrm{MWh}$). If this constraint is not binding, $\\lambda_t^{\\text{lower}*} = 0$, meaning there is no cost saving from relaxing it further.\n\n-   The multiplier $\\lambda_t^{\\text{upper}*}$ is the shadow price of the upper comfort bound $x_t \\le b_t + \\Delta_t$. It quantifies the marginal reduction in the minimum cost for a unit increase (relaxation) of the upper consumption limit $b_t + \\Delta_t$. It represents the economic value of having one more unit of consumption allowance. Its units are also $\\$/\\mathrm{MWh}$. If this constraint is not binding, $\\lambda_t^{\\text{upper}*} = 0$, meaning there is no economic benefit to be gained from increasing the consumption limit further.\n\n### Task 4: Numerical Calculation for Period $t^\\star$\n\nWe are given the following data for a specific period $t^\\star$:\n- $p_{t^\\star} = 73.25$ $/ \\mathrm{MWh}$\n- $b_{t^\\star} = 2.5$ MWh\n- $\\Delta_{t^\\star} = 0.4$ MWh\n- $\\bar{x}_{t^\\star} = 4$ MWh\n\nFirst, we determine the feasible region for $x_{t^\\star}$ by combining all constraints.\n- The capacity constraint is $0 \\le x_{t^\\star} \\le 4$.\n- The comfort constraint is $2.5 - 0.4 \\le x_{t^\\star} \\le 2.5 + 0.4$, which simplifies to $2.1 \\le x_{t^\\star} \\le 2.9$.\n\nThe overall feasible region for $x_{t^\\star}$ is the intersection of these two intervals:\n$$\n\\max(0, 2.1) \\le x_{t^\\star} \\le \\min(4, 2.9)\n$$\n$$\n2.1 \\le x_{t^\\star} \\le 2.9\n$$\nThe objective is to minimize the cost, which is $p_{t^\\star} x_{t^\\star} = 73.25 x_{t^\\star}$. Since the price $p_{t^\\star} = 73.25 > 0$, the cost is minimized by choosing the smallest possible feasible value for $x_{t^\\star}$. From the feasible region, the minimum value is $2.1$.\nTherefore, the optimal energy consumption is $x_{t^\\star}^* = 2.1$ MWh.\n\nNext, we identify which constraints are binding at this optimum:\n- Lower comfort bound: $x_{t^\\star} \\ge 2.1$. Since $x_{t^\\star}^* = 2.1$, this constraint is **binding**.\n- Upper comfort bound: $x_{t^\\star} \\le 2.9$. Since $x_{t^\\star}^* = 2.1  2.9$, this constraint is not binding.\n- Capacity upper bound: $x_{t^\\star} \\le 4$. Since $x_{t^\\star}^* = 2.1  4$, this constraint is not binding.\n- Non-negativity: $x_{t^\\star} \\ge 0$. Since $x_{t^\\star}^* = 2.1 > 0$, this constraint is not binding.\n\nNow, we use the KKT conditions to find the shadow price of the lower comfort bound, $\\lambda_{t^\\star}^{\\text{lower}*}$.\nFrom complementary slackness, since the upper comfort, capacity, and non-negativity constraints are not binding, their corresponding multipliers must be zero:\n- $\\lambda_{t^\\star}^{\\text{upper}*} = 0$\n- $\\mu_{t^\\star}^{\\text{cap}*} = 0$\n- $\\mu_{t^\\star}^{0*} = 0$\n\nWe substitute these values into the stationarity equation:\n$$\np_{t^\\star} + \\mu_{t^\\star}^{\\text{cap}*} - \\mu_{t^\\star}^{0*} + \\lambda_{t^\\star}^{\\text{upper}*} - \\lambda_{t^\\star}^{\\text{lower}*} = 0\n$$\n$$\n73.25 + 0 - 0 + 0 - \\lambda_{t^\\star}^{\\text{lower}*} = 0\n$$\nSolving for $\\lambda_{t^\\star}^{\\text{lower}*}$, we get:\n$$\n\\lambda_{t^\\star}^{\\text{lower}*} = 73.25\n$$\nThe dual feasibility condition $\\lambda_{t^\\star}^{\\text{lower}*} \\ge 0$ is satisfied, since $73.25 \\ge 0$.\nThe optimal shadow price associated with the lower comfort bound is $73.25$ $/ \\mathrm{MWh}$. The value is already given to four significant figures.",
            "answer": "$$\\boxed{73.25}$$"
        },
        {
            "introduction": "Shifting from continuously adjustable loads, this practice introduces the modeling of discrete, non-interruptible tasks like a dishwasher cycle. You will learn to use binary decision variables to represent start-time choices and formulate a Mixed-Integer Linear Program (MILP) . The core skill developed here is using discrete convolution to map a single decision into a multi-period power profile, a cornerstone technique for scheduling shiftable resources.",
            "id": "4081977",
            "problem": "A non-interruptible dishwasher is modeled as a shiftable load in discrete time. Let the time horizon have indices $t \\in \\{1,2,\\dots,T\\}$ with uniform step length $\\Delta t$ hours. A binary decision variable $x_t \\in \\{0,1\\}$ indicates that the dishwasher cycle starts at time $t$ if $x_t=1$. The dishwasher has a fixed operation profile of length $L$ steps, represented by a sequence $\\{s_0,s_1,\\dots,s_{L-1}\\}$ in kilowatts, where $s_k$ is the power drawn $k$ steps after the start. The total power at time $t$, denoted $P_t$ in kilowatts, results from the superposition over all possible start times. A per-step electricity price sequence $\\{c_t\\}$ in dollars per kilowatt-hour is given, and the total cost is the discrete-time energy cost over the horizon. The dishwasher must complete its cycle by a hard deadline $D$, meaning if it starts at time $t$ then $t+L-1 \\le D$ must hold.\n\nTasks:\n- Using the fundamental principles of discrete-time linear time-invariant superposition and the definition of convolution, construct a binary-time-indexed formulation that maps $\\{x_t\\}$ to $\\{P_t\\}$ via a convolution, enforces that exactly one cycle is started, and guarantees completion by the deadline. Formulate the objective of minimizing total energy cost and clearly state all decision variables, constraints, and the objective function in a Mixed-Integer Linear Program (MILP).\n- Then, for the specific data below, determine the optimal start time index $t^\\star$ that minimizes the total cost.\n\nData:\n- Time step length $\\Delta t = 1$ hour, horizon length $T=6$.\n- Dishwasher profile length $L=3$ with $\\{s_0,s_1,s_2\\} = \\{1.4,\\,0.7,\\,0.2\\}$ kilowatts.\n- Prices $\\{c_t\\}_{t=1}^{6} = \\{0.12,\\,0.10,\\,0.24,\\,0.30,\\,0.22,\\,0.15\\}$ dollars per kilowatt-hour.\n- Deadline $D=5$.\n\nExpress the final answer as the optimal start index $t^\\star$ (a single integer). No rounding is necessary, and no physical units are required for $t^\\star$.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of energy systems modeling, well-posed with a clear objective and sufficient data, and objective in its language. We can therefore proceed with the solution.\n\nThe problem is divided into two parts: first, to construct a general Mixed-Integer Linear Program (MILP) formulation for the optimal scheduling of a non-interruptible shiftable load, and second, to solve a specific instance to find the optimal start time.\n\n### Part 1: MILP Formulation\n\nThe goal is to formalize the problem of minimizing the total energy cost as an MILP. This requires defining decision variables, an objective function, and a set of constraints that model the system's behavior.\n\n**1. Decision Variables**\nThe primary decision is when to start the dishwasher cycle. We define a set of binary variables $x_t$ for each time step $t$ in the scheduling horizon $t \\in \\{1, 2, \\dots, T\\}$.\n- $x_t \\in \\{0, 1\\}$: A binary variable where $x_t = 1$ if the dishwasher cycle starts at time step $t$, and $x_t = 0$ otherwise.\n\n**2. Power Consumption as a Convolution**\nThe total power $P_t$ at any time step $t$ is the superposition of power consumed by any ongoing dishwasher cycle. The dishwasher has a fixed power profile $\\{s_0, s_1, \\dots, s_{L-1}\\}$ of length $L$. If a cycle starts at time $\\tau$, it draws power $s_k$ at time $\\tau+k$ for $k \\in \\{0, 1, \\dots, L-1\\}$.\n\nThe power at time $t$, $P_t$, is the sum of contributions from all possible start times $\\tau$. A cycle that started at $\\tau$ contributes to the power at $t$ only if $t$ is within the cycle's operating window, i.e., $\\tau \\le t  \\tau+L$. The specific power drawn at time $t$ from a cycle started at $\\tau$ is $s_{t-\\tau}$. Summing over all possible start times $\\tau$, we get:\n$$P_t = \\sum_{\\tau=1}^{T} s_{t-\\tau} x_\\tau$$\nThis formulation represents a discrete convolution. To make it precise, we define $s_k = 0$ for any index $k  0$ or $k \\ge L$. This ensures that a start at $\\tau$ ($x_\\tau=1$) only contributes to $P_t$ for $t \\in \\{\\tau, \\tau+1, \\dots, \\tau+L-1\\}$. This set of equations, for $t=1, \\dots, T$, defines $P_t$ as a linear function of the decision variables $x_t$.\n\n**3. Constraints**\nTwo main constraints must be enforced:\na. **Single Operation**: The dishwasher must run exactly once during the horizon.\nb. **Deadline**: The cycle must be completed by the deadline time $D$. A cycle starting at $t$ runs for $L$ steps and ends at time $t+L-1$. Therefore, for the cycle to complete by $D$, we must have $t+L-1 \\le D$, which simplifies to $t \\le D-L+1$.\n\nThese two conditions can be combined into a single elegant constraint. The set of valid start times is $\\{1, 2, \\dots, D-L+1\\}$. We must choose exactly one start time from this set. This is expressed as:\n$$\\sum_{t=1}^{D-L+1} x_t = 1$$\nThis constraint, combined with the binary nature of $x_t$, ensures that exactly one $x_t$ in the valid range is $1$, and all others (including those for $t > D-L+1$) are $0$.\n\n**4. Objective Function**\nThe objective is to minimize the total energy cost over the horizon $T$. The energy consumed in a time step $t$ is $E_t = P_t \\cdot \\Delta t$, where $\\Delta t$ is the duration of the time step in hours. The cost in that time step is $c_t \\cdot E_t$. The total cost is the sum over all time steps:\n$$\\text{Total Cost} = \\sum_{t=1}^{T} c_t E_t = \\sum_{t=1}^{T} c_t (P_t \\Delta t) = \\Delta t \\sum_{t=1}^{T} c_t P_t$$\nSince $\\Delta t$ is a positive constant, minimizing the total cost is equivalent to minimizing $\\sum_{t=1}^{T} c_t P_t$.\n\n**Summary of the MILP Formulation:**\n- **Parameters:** $T, L, D, \\Delta t, \\{s_k\\}, \\{c_t\\}$.\n- **Decision Variables:** $x_t \\in \\{0, 1\\}$ for $t \\in \\{1, \\dots, D-L+1\\}$.\n- **Objective:**\n  $$\\min \\Delta t \\sum_{t=1}^{T} c_t \\left( \\sum_{\\tau=1}^{t} s_{t-\\tau} x_\\tau \\right)$$\n- **Subject to:**\n  $$\\sum_{t=1}^{D-L+1} x_t = 1$$\n  (where $s_k=0$ for $k0$ or $k \\ge L$).\n\n### Part 2: Specific Calculation\n\nNow we solve the problem for the given data:\n- $\\Delta t = 1$ hour\n- $T = 6$\n- $L = 3$ steps\n- $s = \\{s_0, s_1, s_2\\} = \\{1.4, 0.7, 0.2\\}$ kW\n- $c = \\{c_1, \\dots, c_6\\} = \\{0.12, 0.10, 0.24, 0.30, 0.22, 0.15\\}$ $/kWh\n- $D = 5$\n\nFirst, we determine the set of feasible start times. The deadline constraint is $t \\le D-L+1$:\n$$t \\le 5 - 3 + 1 \\implies t \\le 3$$\nSo, the possible start times are $t \\in \\{1, 2, 3\\}$. We need to calculate the total cost for each of these three scenarios and select the one with the minimum cost.\n\nThe total cost for a cycle starting at time $\\tau$ (where $x_\\tau=1$ and other $x_t=0$) is given by:\n$$\\text{Cost}(\\tau) = \\Delta t \\sum_{k=0}^{L-1} c_{\\tau+k} s_k$$\nWith $\\Delta t = 1$, this simplifies to:\n$$\\text{Cost}(\\tau) = c_{\\tau}s_0 + c_{\\tau+1}s_1 + c_{\\tau+2}s_2$$\n\nLet's calculate the cost for each feasible start time:\n\n**Case 1: Start at $t=1$** ($\\tau=1$)\nThe cycle runs during time steps $1, 2, 3$.\n$$\\text{Cost}(1) = c_1 s_0 + c_2 s_1 + c_3 s_2$$\n$$\\text{Cost}(1) = (0.12)(1.4) + (0.10)(0.7) + (0.24)(0.2)$$\n$$\\text{Cost}(1) = 0.168 + 0.070 + 0.048 = 0.286$$\n\n**Case 2: Start at $t=2$** ($\\tau=2$)\nThe cycle runs during time steps $2, 3, 4$.\n$$\\text{Cost}(2) = c_2 s_0 + c_3 s_1 + c_4 s_2$$\n$$\\text{Cost}(2) = (0.10)(1.4) + (0.24)(0.7) + (0.30)(0.2)$$\n$$\\text{Cost}(2) = 0.140 + 0.168 + 0.060 = 0.368$$\n\n**Case 3: Start at $t=3$** ($\\tau=3$)\nThe cycle runs during time steps $3, 4, 5$.\n$$\\text{Cost}(3) = c_3 s_0 + c_4 s_1 + c_5 s_2$$\n$$\\text{Cost}(3) = (0.24)(1.4) + (0.30)(0.7) + (0.22)(0.2)$$\n$$\\text{Cost}(3) = 0.336 + 0.210 + 0.044 = 0.590$$\n\nComparing the total costs:\n- $\\text{Cost}(1) = 0.286$\n- $\\text{Cost}(2) = 0.368$\n- $\\text{Cost}(3) = 0.590$\n\nThe minimum cost is $0.286$, which is achieved when the dishwasher cycle starts at time $t=1$.\nTherefore, the optimal start time index is $t^\\star = 1$.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "In our final practice, we integrate the concepts from the previous exercises to model a more realistic scenario faced by an energy aggregator. This problem requires you to co-optimize a portfolio containing both a continuous curtailable load and several discrete shiftable jobs, all competing for a shared, limited power capacity . Mastering this type of integrated Mixed-Integer Linear Program (MILP) is key to understanding and designing modern demand-side management strategies.",
            "id": "4082022",
            "problem": "An aggregator manages electricity consumption over a discrete planning horizon of $T=\\{1,2,3,4\\}$ time slots of length $\\Delta t = 1$ hour. The portfolio consists of two categories of end-uses: (i) a curtailable baseline load and (ii) multiple shiftable jobs. The aggregator is limited by an exogenous power capacity $C_t$ in each time slot and must allocate consumption so that the sum of powers drawn by the curtailable baseline and the shiftable jobs does not exceed the capacity. Use the following well-tested fundamentals and core definitions:\n- Power-to-energy relation: for a time slot of duration $\\Delta t$, the energy drawn equals power times time.\n- Capacity feasibility: the total power synchronized in a given time slot cannot exceed the capacity available in that time slot.\n- A curtailable baseline load is a continuous, nonnegative quantity of power that can be reduced below a desired baseline, incurring a linear penalty proportional to the curtailed energy.\n- A shiftable job is a discrete task that, when active in a time slot, draws a fixed power and must be scheduled for a specified number of time slots within a given availability window.\n\nData:\n- Capacity profile (in kilowatts): $C_1=6$, $C_2=5$, $C_3=4$, $C_4=6$.\n- Desired baseline (non-shiftable) power profile (in kilowatts): $b_1=4$, $b_2=4$, $b_3=4$, $b_4=4$.\n- Curtailment penalty coefficients (in United States dollars per kilowatt-hour): $q_1=1$, $q_2=3$, $q_3=2$, $q_4=1$.\n- Shiftable jobs:\n  - Job $A$: fixed power $P_A=2$ kilowatts, duration $D_A=2$ time slots, availability window $W_A=\\{1,2,3\\}$.\n  - Job $B$: fixed power $P_B=3$ kilowatts, duration $D_B=1$ time slot, availability window $W_B=\\{2,3,4\\}$.\n\nModeling requirements:\n- Use continuous variables $l_t \\in [0,b_t]$ to represent the curtailable baseline power served in each time slot $t \\in T$.\n- Use binary variables $x_{i,t} \\in \\{0,1\\}$ to represent whether job $i \\in \\{A,B\\}$ is active in time slot $t \\in T$ (jobs are preemptive across time slots but non-divisible within a time slot).\n- Enforce shared capacity constraints of the form $\\sum_{i \\in \\{A,B\\}} P_i x_{i,t} + l_t \\le C_t$ for all $t \\in T$.\n- Enforce job duration and window constraints of the form $\\sum_{t \\in W_i} x_{i,t} = D_i$ and $x_{i,t}=0$ for $t \\notin W_i$, for each job $i \\in \\{A,B\\}$.\n- Minimize total curtailment penalty $\\sum_{t \\in T} q_t \\,(b_t - l_t)\\,\\Delta t$.\n\nTask:\n1. Formulate the above as a Mixed-Integer Linear Programming (MILP) problem, explicitly stating the decision variables, objective, and constraints.\n2. Solve the MILP for the provided data and compute the minimal total curtailment penalty. Express the final cost in United States dollars (USD). No rounding is required. Your final answer must be a single real number.",
            "solution": "The user has provided a well-defined problem in energy systems modeling that requires the formulation and solution of a Mixed-Integer Linear Programming (MILP) problem.\n\n### Part 1: MILP Formulation\n\nThe problem is to schedule a set of shiftable jobs and determine the optimal level of curtailable load to serve, in order to minimize the total penalty from curtailment, subject to power capacity constraints.\n\n**Decision Variables**\nLet $T = \\{1, 2, 3, 4\\}$ be the set of time slots. Let $I = \\{A, B\\}$ be the set of shiftable jobs.\n-   $l_t$: A continuous variable representing the power (in kW) supplied to the curtailable baseline load in time slot $t \\in T$.\n-   $x_{i,t}$: A binary variable for each job $i \\in I$ and time slot $t \\in T$, where $x_{i,t} = 1$ if job $i$ is active in time slot $t$, and $x_{i,t} = 0$ otherwise.\n\n**Objective Function**\nThe objective is to minimize the total curtailment penalty. The curtailed power in time slot $t$ is $(b_t - l_t)$, and the curtailed energy is $(b_t - l_t)\\Delta t$. The total penalty is the sum of penalties over all time slots.\n$$\n\\text{Minimize } Z = \\sum_{t \\in T} q_t (b_t - l_t) \\Delta t\n$$\nSubstituting the given values, where $\\Delta t = 1$ hour:\n$$\n\\text{Minimize } Z = 1(4 - l_1) \\cdot 1 + 3(4 - l_2) \\cdot 1 + 2(4 - l_3) \\cdot 1 + 1(4 - l_4) \\cdot 1\n$$\n$$\n\\text{Minimize } Z = (4 - l_1) + 3(4 - l_2) + 2(4 - l_3) + (4 - l_4)\n$$\nThis expression can be rewritten as:\n$$\n\\text{Minimize } Z = (4 + 12 + 8 + 4) - (l_1 + 3l_2 + 2l_3 + l_4) = 28 - (l_1 + 3l_2 + 2l_3 + l_4)\n$$\nMinimizing this is equivalent to maximizing the term $\\sum_{t \\in T} q_t l_t \\Delta t = l_1 + 3l_2 + 2l_3 + l_4$.\n\n**Constraints**\nThe optimization is subject to the following constraints:\n1.  **Capacity Constraints**: For each time slot $t \\in T$, the total power consumed must not exceed the available capacity $C_t$.\n    $$\n    \\sum_{i \\in I} P_i x_{i,t} + l_t \\le C_t \\quad \\forall t \\in T\n    $$\n    -   $t=1$: $2x_{A,1} + 3x_{B,1} + l_1 \\le 6$\n    -   $t=2$: $2x_{A,2} + 3x_{B,2} + l_2 \\le 5$\n    -   $t=3$: $2x_{A,3} + 3x_{B,3} + l_3 \\le 4$\n    -   $t=4$: $2x_{A,4} + 3x_{B,4} + l_4 \\le 6$\n\n2.  **Job Duration Constraints**: Each job $i$ must be active for a total of $D_i$ time slots.\n    -   Job A: $\\sum_{t=1}^4 x_{A,t} = D_A = 2$\n    -   Job B: $\\sum_{t=1}^4 x_{B,t} = D_B = 1$\n\n3.  **Job Availability Window Constraints**: Jobs can only be active within their specified availability windows.\n    -   Job A: $x_{A,t} = 0$ for $t \\notin W_A = \\{1, 2, 3\\}$. This means $x_{A,4} = 0$. The duration constraint becomes $\\sum_{t \\in W_A} x_{A,t} = x_{A,1} + x_{A,2} + x_{A,3} = 2$.\n    -   Job B: $x_{B,t} = 0$ for $t \\notin W_B = \\{2, 3, 4\\}$. This means $x_{B,1} = 0$. The duration constraint becomes $\\sum_{t \\in W_B} x_{B,t} = x_{B,2} + x_{B,3} + x_{B,4} = 1$.\n\n4.  **Variable Bounds**:\n    -   $0 \\le l_t \\le b_t$, which is $0 \\le l_t \\le 4$, for all $t \\in T$.\n    -   $x_{i,t} \\in \\{0, 1\\}$ for all $i \\in I, t \\in T$.\n\n### Part 2: Solution of the MILP\n\nThe problem is small enough to be solved by enumerating all feasible schedules for the binary variables $x_{i,t}$ and then calculating the resulting minimum cost for each schedule.\n\nFor a fixed schedule of jobs (i.e., fixed values for all $x_{i,t}$), the objective is to minimize $\\sum_{t} q_t(b_t - l_t)\\Delta t$. This is achieved by making each $l_t$ as large as possible. The constraints on $l_t$ are $0 \\le l_t \\le b_t$ and $l_t \\le C_t - \\sum_i P_i x_{i,t}$. Thus, the optimal value for $l_t$ for a given schedule is:\n$$\nl_t^* = \\min(b_t, C_t - \\sum_{i \\in I} P_i x_{i,t})\n$$\nIf for any $t$, $C_t - \\sum_{i \\in I} P_i x_{i,t}  0$, the schedule is infeasible.\n\nThe possible schedules for Job A ($D_A=2$ slots in $W_A=\\{1,2,3\\}$) are:\n-   A1: Active in slots $\\{1, 2\\}$.\n-   A2: Active in slots $\\{1, 3\\}$.\n-   A3: Active in slots $\\{2, 3\\}$.\n\nThe possible schedules for Job B ($D_B=1$ slot in $W_B=\\{2,3,4\\}$) are:\n-   B1: Active in slot $\\{2\\}$.\n-   B2: Active in slot $\\{3\\}$.\n-   B3: Active in slot $\\{4\\}$.\n\nWe now evaluate the $3 \\times 3 = 9$ combined schedules. Let $P_{jobs,t} = P_A x_{A,t} + P_B x_{B,t}$ be the total power of scheduled jobs in slot $t$. The curtailed energy in slot $t$ is $K_t = (b_t - \\min(b_t, C_t - P_{jobs,t}))\\Delta t$. The total cost is $\\sum_{t=1}^4 q_t K_t$. The data used is: capacities $C = (6, 5, 4, 6)$, baseline $b = (4, 4, 4, 4)$, penalties $q = (1, 3, 2, 1)$, $\\Delta t = 1$, $P_A=2$, $P_B=3$.\n\n-   **Case 1: A in $\\{1,2\\}$, B in $\\{2\\}$**\n    $P_{jobs} = (2, 5, 0, 0)$. $C^{rem} = (4, 0, 4, 6)$. $l^*=(4,0,4,4)$. Curtailed energy $K=(0,4,0,0)$. Cost = $3 \\times 4 = 12$.\n\n-   **Case 2: A in $\\{1,2\\}$, B in $\\{3\\}$**\n    $P_{jobs} = (2, 2, 3, 0)$. $C^{rem} = (4, 3, 1, 6)$. $l^*=(4,3,1,4)$. Curtailed energy $K=(0,1,3,0)$. Cost = $(3 \\times 1) + (2 \\times 3) = 9$.\n\n-   **Case 3: A in $\\{1,2\\}$, B in $\\{4\\}$**\n    $P_{jobs} = (2, 2, 0, 3)$. $C^{rem} = (4, 3, 4, 3)$. $l^*=(4,3,4,3)$. Curtailed energy $K=(0,1,0,1)$. Cost = $(3 \\times 1) + (1 \\times 1) = 4$.\n\n-   **Case 4: A in $\\{1,3\\}$, B in $\\{2\\}$**\n    $P_{jobs} = (2, 3, 2, 0)$. $C^{rem} = (4, 2, 2, 6)$. $l^*=(4,2,2,4)$. Curtailed energy $K=(0,2,2,0)$. Cost = $(3 \\times 2) + (2 \\times 2) = 10$.\n\n-   **Case 5: A in $\\{1,3\\}$, B in $\\{3\\}$**\n    $P_{jobs} = (2, 0, 5, 0)$. In slot $t=3$, job power is $P_A + P_B = 2+3=5$, but capacity is $C_3=4$. This schedule is infeasible.\n\n-   **Case 6: A in $\\{1,3\\}$, B in $\\{4\\}$**\n    $P_{jobs} = (2, 0, 2, 3)$. $C^{rem} = (4, 5, 2, 3)$. $l^*=(4,4,2,3)$. Curtailed energy $K=(0,0,2,1)$. Cost = $(2 \\times 2) + (1 \\times 1) = 5$.\n\n-   **Case 7: A in $\\{2,3\\}$, B in $\\{2\\}$**\n    $P_{jobs} = (0, 5, 2, 0)$. $C^{rem} = (6, 0, 2, 6)$. $l^*=(4,0,2,4)$. Curtailed energy $K=(0,4,2,0)$. Cost = $(3 \\times 4) + (2 \\times 2) = 16$.\n\n-   **Case 8: A in $\\{2,3\\}$, B in $\\{3\\}$**\n    $P_{jobs} = (0, 2, 5, 0)$. In slot $t=3$, job power is $5$, capacity is $4$. This schedule is infeasible.\n\n-   **Case 9: A in $\\{2,3\\}$, B in $\\{4\\}$**\n    $P_{jobs} = (0, 2, 2, 3)$. $C^{rem} = (6, 3, 2, 3)$. $l^*=(4,3,2,3)$. Curtailed energy $K=(0,1,2,1)$. Cost = $(3 \\times 1) + (2 \\times 2) + (1 \\times 1) = 8$.\n\nComparing the total costs of all feasible schedules: $\\{12, 9, 4, 10, 5, 16, 8\\}$. The minimum cost is $4$ USD. This occurs when Job A is scheduled in time slots $\\{1, 2\\}$ and Job B is scheduled in time slot $\\{4\\}$.\n\nThe optimal solution is:\n-   $x_{A,1}=1, x_{A,2}=1$, all other $x_{A,t}=0$.\n-   $x_{B,4}=1$, all other $x_{B,t}=0$.\n-   $l_1 = 4$ kW, $l_2 = 3$ kW, $l_3 = 4$ kW, $l_4 = 3$ kW.\n-   Minimal total curtailment penalty = $4$ USD.",
            "answer": "$$\n\\boxed{4}\n$$"
        }
    ]
}