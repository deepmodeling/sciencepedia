{
    "hands_on_practices": [
        {
            "introduction": "Many flexible loads, from residential dishwashers to industrial batch processes, operate on a fixed, non-interruptible cycle. The primary control decision is not *how much* power to use, but *when* to run the cycle. This practice guides you through the fundamental technique of using binary decision variables to model the start time and illustrates how a discrete convolution can elegantly map this single decision into a time-series power profile within a Mixed-Integer Linear Program (MILP). ",
            "id": "4081977",
            "problem": "A non-interruptible dishwasher is modeled as a shiftable load in discrete time. Let the time horizon have indices $t \\in \\{1,2,\\dots,T\\}$ with uniform step length $\\Delta t$ hours. A binary decision variable $x_t \\in \\{0,1\\}$ indicates that the dishwasher cycle starts at time $t$ if $x_t=1$. The dishwasher has a fixed operation profile of length $L$ steps, represented by a sequence $\\{s_0,s_1,\\dots,s_{L-1}\\}$ in kilowatts, where $s_k$ is the power drawn $k$ steps after the start. The total power at time $t$, denoted $P_t$ in kilowatts, results from the superposition over all possible start times. A per-step electricity price sequence $\\{c_t\\}$ in dollars per kilowatt-hour is given, and the total cost is the discrete-time energy cost over the horizon. The dishwasher must complete its cycle by a hard deadline $D$, meaning if it starts at time $t$ then $t+L-1 \\le D$ must hold.\n\nTasks:\n- Using the fundamental principles of discrete-time linear time-invariant superposition and the definition of convolution, construct a binary-time-indexed formulation that maps $\\{x_t\\}$ to $\\{P_t\\}$ via a convolution, enforces that exactly one cycle is started, and guarantees completion by the deadline. Formulate the objective of minimizing total energy cost and clearly state all decision variables, constraints, and the objective function in a Mixed-Integer Linear Program (MILP).\n- Then, for the specific data below, determine the optimal start time index $t^\\star$ that minimizes the total cost.\n\nData:\n- Time step length $\\Delta t = 1$ hour, horizon length $T=6$.\n- Dishwasher profile length $L=3$ with $\\{s_0,s_1,s_2\\} = \\{1.4,\\,0.7,\\,0.2\\}$ kilowatts.\n- Prices $\\{c_t\\}_{t=1}^{6} = \\{0.12,\\,0.10,\\,0.24,\\,0.30,\\,0.22,\\,0.15\\}$ dollars per kilowatt-hour.\n- Deadline $D=5$.\n\nExpress the final answer as the optimal start index $t^\\star$ (a single integer). No rounding is necessary, and no physical units are required for $t^\\star$.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of energy systems modeling, well-posed with a clear objective and sufficient data, and objective in its language. We can therefore proceed with the solution.\n\nThe problem is divided into two parts: first, to construct a general Mixed-Integer Linear Program (MILP) formulation for the optimal scheduling of a non-interruptible shiftable load, and second, to solve a specific instance to find the optimal start time.\n\n### Part 1: MILP Formulation\n\nThe goal is to formalize the problem of minimizing the total energy cost as an MILP. This requires defining decision variables, an objective function, and a set of constraints that model the system's behavior.\n\n**1. Decision Variables**\nThe primary decision is when to start the dishwasher cycle. We define a set of binary variables $x_t$ for each time step $t$ in the scheduling horizon $t \\in \\{1, 2, \\dots, T\\}$.\n- $x_t \\in \\{0, 1\\}$: A binary variable where $x_t = 1$ if the dishwasher cycle starts at time step $t$, and $x_t = 0$ otherwise.\n\n**2. Power Consumption as a Convolution**\nThe total power $P_t$ at any time step $t$ is the superposition of power consumed by any ongoing dishwasher cycle. The dishwasher has a fixed power profile $\\{s_0, s_1, \\dots, s_{L-1}\\}$ of length $L$. If a cycle starts at time $\\tau$, it draws power $s_k$ at time $\\tau+k$ for $k \\in \\{0, 1, \\dots, L-1\\}$.\n\nThe power at time $t$, $P_t$, is the sum of contributions from all possible start times $\\tau$. A cycle that started at $\\tau$ contributes to the power at $t$ only if $t$ is within the cycle's operating window, i.e., $\\tau \\le t < \\tau+L$. The specific power drawn at time $t$ from a cycle started at $\\tau$ is $s_{t-\\tau}$. Summing over all possible start times $\\tau$, we get:\n$$P_t = \\sum_{\\tau=1}^{T} s_{t-\\tau} x_\\tau$$\nThis formulation represents a discrete convolution. To make it precise, we define $s_k = 0$ for any index $k < 0$ or $k \\ge L$. This ensures that a start at $\\tau$ ($x_\\tau=1$) only contributes to $P_t$ for $t \\in \\{\\tau, \\tau+1, \\dots, \\tau+L-1\\}$. This set of equations, for $t=1, \\dots, T$, defines $P_t$ as a linear function of the decision variables $x_t$.\n\n**3. Constraints**\nTwo main constraints must be enforced:\na. **Single Operation**: The dishwasher must run exactly once during the horizon.\nb. **Deadline**: The cycle must be completed by the deadline time $D$. A cycle starting at $t$ runs for $L$ steps and ends at time $t+L-1$. Therefore, for the cycle to complete by $D$, we must have $t+L-1 \\le D$, which simplifies to $t \\le D-L+1$.\n\nThese two conditions can be combined into a single elegant constraint. The set of valid start times is $\\{1, 2, \\dots, D-L+1\\}$. We must choose exactly one start time from this set. This is expressed as:\n$$\\sum_{t=1}^{D-L+1} x_t = 1$$\nThis constraint, combined with the binary nature of $x_t$, ensures that exactly one $x_t$ in the valid range is $1$, and all others (including those for $t > D-L+1$) are $0$.\n\n**4. Objective Function**\nThe objective is to minimize the total energy cost over the horizon $T$. The energy consumed in a time step $t$ is $E_t = P_t \\cdot \\Delta t$, where $\\Delta t$ is the duration of the time step in hours. The cost in that time step is $c_t \\cdot E_t$. The total cost is the sum over all time steps:\n$$\\text{Total Cost} = \\sum_{t=1}^{T} c_t E_t = \\sum_{t=1}^{T} c_t (P_t \\Delta t) = \\Delta t \\sum_{t=1}^{T} c_t P_t$$\nSince $\\Delta t$ is a positive constant, minimizing the total cost is equivalent to minimizing $\\sum_{t=1}^{T} c_t P_t$.\n\n**Summary of the MILP Formulation:**\n- **Parameters:** $T, L, D, \\Delta t, \\{s_k\\}, \\{c_t\\}$.\n- **Decision Variables:** $x_t \\in \\{0, 1\\}$ for $t \\in \\{1, \\dots, D-L+1\\}$.\n- **Objective:**\n  $$\\min \\Delta t \\sum_{t=1}^{T} c_t \\left( \\sum_{\\tau=1}^{t} s_{t-\\tau} x_\\tau \\right)$$\n- **Subject to:**\n  $$\\sum_{t=1}^{D-L+1} x_t = 1$$\n  (where $s_k=0$ for $k<0$ or $k \\ge L$).\n\n### Part 2: Specific Calculation\n\nNow we solve the problem for the given data:\n- $\\Delta t = 1$ hour\n- $T = 6$\n- $L = 3$ steps\n- $s = \\{s_0, s_1, s_2\\} = \\{1.4, 0.7, 0.2\\}$ kW\n- $c = \\{c_1, \\dots, c_6\\} = \\{0.12, 0.10, 0.24, 0.30, 0.22, 0.15\\}$ $/kWh\n- $D = 5$\n\nFirst, we determine the set of feasible start times. The deadline constraint is $t \\le D-L+1$:\n$$t \\le 5 - 3 + 1 \\implies t \\le 3$$\nSo, the possible start times are $t \\in \\{1, 2, 3\\}$. We need to calculate the total cost for each of these three scenarios and select the one with the minimum cost.\n\nThe total cost for a cycle starting at time $\\tau$ (where $x_\\tau=1$ and other $x_t=0$) is given by:\n$$\\text{Cost}(\\tau) = \\Delta t \\sum_{k=0}^{L-1} c_{\\tau+k} s_k$$\nWith $\\Delta t = 1$, this simplifies to:\n$$\\text{Cost}(\\tau) = c_{\\tau}s_0 + c_{\\tau+1}s_1 + c_{\\tau+2}s_2$$\n\nLet's calculate the cost for each feasible start time:\n\n**Case 1: Start at $t=1$** ($\\tau=1$)\nThe cycle runs during time steps $1, 2, 3$.\n$$\\text{Cost}(1) = c_1 s_0 + c_2 s_1 + c_3 s_2$$\n$$\\text{Cost}(1) = (0.12)(1.4) + (0.10)(0.7) + (0.24)(0.2)$$\n$$\\text{Cost}(1) = 0.168 + 0.070 + 0.048 = 0.286$$\n\n**Case 2: Start at $t=2$** ($\\tau=2$)\nThe cycle runs during time steps $2, 3, 4$.\n$$\\text{Cost}(2) = c_2 s_0 + c_3 s_1 + c_4 s_2$$\n$$\\text{Cost}(2) = (0.10)(1.4) + (0.24)(0.7) + (0.30)(0.2)$$\n$$\\text{Cost}(2) = 0.140 + 0.168 + 0.060 = 0.368$$\n\n**Case 3: Start at $t=3$** ($\\tau=3$)\nThe cycle runs during time steps $3, 4, 5$.\n$$\\text{Cost}(3) = c_3 s_0 + c_4 s_1 + c_5 s_2$$\n$$\\text{Cost}(3) = (0.24)(1.4) + (0.30)(0.7) + (0.22)(0.2)$$\n$$\\text{Cost}(3) = 0.336 + 0.210 + 0.044 = 0.590$$\n\nComparing the total costs:\n- Cost(1) = 0.286\n- Cost(2) = 0.368\n- Cost(3) = 0.590\n\nThe minimum cost is $0.286$, which is achieved when the dishwasher cycle starts at time $t=1$.\nTherefore, the optimal start time index is $t^\\star = 1$.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "Real-world equipment often has physical limitations that restrict how frequently it can be turned on or off, which can be modeled with minimum up-time and down-time constraints. This exercise demonstrates how to encode these temporal dependencies for a curtailable load, a technique central to unit commitment problems. You will use binary variables to track state transitions and enforce cycling discipline, which is crucial for creating realistic and feasible operational plans. ",
            "id": "4082044",
            "problem": "Consider a discrete-time horizon with periods indexed by $t \\in \\{1,2,\\dots,T\\}$ and uniform duration $\\Delta t$ (hours). A single curtailable industrial load can be in one of two states each period: normal operation ($u_t = 0$) or curtailed operation ($u_t = 1$), where $u_t$ is a binary variable. When curtailed, the load reduces its power draw by a fixed amount $\\Delta P \\ge 0$ relative to a nominal power $P^{\\text{nom}}$, so that the period-$t$ power $P_t$ satisfies a linear state-to-power relationship. The load obeys cycling restrictions described by the following operational rules:\n\n- Minimum up time: if curtailment starts at period $t$, the load must remain curtailed for at least $M$ consecutive periods.\n- Minimum down time: if curtailment stops at period $t$, the load must remain in normal operation for at least $N$ consecutive periods.\n- Starts and stops: introduce binary variables $y_t$ indicating a start of curtailment at period $t$ and $z_t$ indicating a stop of curtailment at period $t$. The initial state is $u_0 = 0$ (normal operation before the horizon begins). The horizon admits exactly $K$ curtailment starts.\n\nYou are asked to construct a mixed-integer linear programming (MILP) encoding of these rules. Start from first principles of discrete-time logical modeling and state-to-action links, and write linear constraints that:\n\n- Correctly relate $u_t$, $y_t$, and $z_t$ to enforce the transition logic over time.\n- Enforce the minimum up time and minimum down time requirements, including appropriate end-of-horizon handling.\n- Link curtailment state to power via a linear equality for $P_t$ using $P^{\\text{nom}}$ and $\\Delta P$, along with simple physical bounds for $P_t$.\n- Enforce exactly $K$ starts over the horizon, consistent with the initial condition $u_0 = 0$.\n\nThen, using only the constructed constraints and fundamental time-accounting arguments, derive a closed-form analytical expression for the maximum total curtailed energy over the horizon, defined as the total energy reduction\n$$\nE^{\\text{curt}} \\triangleq \\Delta t \\sum_{t=1}^{T} \\Delta P \\, u_t,\n$$\nunder the assumption that a feasible schedule exists (that is, the minimum up/down time requirements and the exactly $K$ starts restriction can be satisfied within $T$ periods). Express your final answer as a single closed-form expression in terms of $T$, $M$, $N$, $K$, $\\Delta P$, and $\\Delta t$. Express the energy in kilowatt-hours (kWh). No numerical values are provided; an exact analytical expression is required. The final answer must be a single closed-form expression and not an inequality or an equation.",
            "solution": "The problem asks for two tasks: first, to construct a set of mixed-integer linear programming (MILP) constraints for a curtailable load, and second, to derive a closed-form expression for the maximum possible curtailed energy under these constraints, assuming feasibility.\n\n### Problem Validation\nFirst, the problem statement is validated against the required criteria.\n\n**Step 1: Extract Givens**\n-   Time horizon: discrete periods $t \\in \\{1, 2, \\dots, T\\}$ of duration $\\Delta t$ hours.\n-   State variable: $u_t \\in \\{0, 1\\}$, where $u_t=1$ denotes curtailment.\n-   Action variables: $y_t \\in \\{0, 1\\}$ for start of curtailment, $z_t \\in \\{0, 1\\}$ for stop of curtailment.\n-   Initial condition: $u_0 = 0$.\n-   Power parameters: nominal power $P^{\\text{nom}}$, power reduction $\\Delta P \\ge 0$.\n-   Operational constraints:\n    -   Minimum up time: at least $M$ consecutive periods of curtailment after a start.\n    -   Minimum down time: at least $N$ consecutive periods of normal operation after a stop.\n-   Total starts: exactly $K$ starts over the horizon, $\\sum_{t=1}^{T} y_t = K$.\n-   Power-state relation: linear. $P_t$ is the power in period $t$.\n-   Objective: maximize total curtailed energy $E^{\\text{curt}} \\triangleq \\Delta t \\sum_{t=1}^{T} \\Delta P \\, u_t$.\n-   Assumption: A feasible schedule satisfying all constraints exists.\n-   Required output: A closed-form analytical expression for max $E^{\\text{curt}}$ in terms of $T, M, N, K, \\Delta P, \\Delta t$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard unit commitment-style problem for a demand-side resource, which is a fundamental topic in energy systems modeling. The variables, parameters, and constraints are clearly defined. The assumption of feasibility prevents issues with parameter inconsistencies (e.g., trying to fit more curtailment cycles than the horizon allows) and focuses the task on characterizing the optimal solution. The problem is formalizable and non-trivial. No flaws are identified.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full solution is warranted.\n\n### Part 1: MILP Formulation\n\nWe construct the linear constraints based on the provided rules. All variables $u_t, y_t, z_t$ are binary for $t \\in \\{1, ..., T\\}$.\n\n1.  **State Transition Logic:** The relationship between the state $u_t$ and the actions $y_t$ (start) and $z_t$ (stop) is defined by the change in state from one period to the next. A start $y_t=1$ corresponds to a transition from $u_{t-1}=0$ to $u_t=1$. A stop $z_t=1$ corresponds to a transition from $u_{t-1}=1$ to $u_t=0$. This is captured by the following linear equality for each period $t \\in \\{1, \\dots, T\\}$:\n    $$y_t - z_t = u_t - u_{t-1}$$\n    Given the initial condition $u_0 = 0$, this set of equations correctly links the state and action variables. At any given time $t$, the load can either start or stop, but not both. This is enforced by:\n    $$y_t + z_t \\le 1$$\n\n2.  **Minimum Up Time:** If a curtailment block begins, it must last for at least $M$ periods. This means that if a stop occurs at period $t$ ($z_t=1$, implying $u_t=0$ and $u_{t-1}=1$), the load must have been in the curtailed state for the preceding $M$ periods (i.e., from $t-M$ to $t-1$). This is expressed as:\n    $$z_t \\le u_{t-k} \\quad \\forall t \\in \\{1, \\dots, T\\}, \\forall k \\in \\{1, \\dots, M\\}$$\n    For this constraint to be well-defined for all $t$, we can define $u_\\tau = 0$ for all $\\tau \\le 0$, which is consistent with the given $u_0=0$. This ensures that no stop can occur before period $M+1$ if the first start is at $t=1$.\n\n3.  **Minimum Down Time:** If a curtailment block ends, the load must remain in its normal operating state for at least $N$ periods. This means that if a start occurs at period $t$ ($y_t=1$), the load must have been in the normal state for the preceding $N$ periods. This is expressed as:\n    $$y_t \\le 1 - u_{t-k} \\quad \\forall t \\in \\{1, \\dots, T\\}, \\forall k \\in \\{1, \\dots, N\\}$$\n    Again, we use the convention $u_\\tau = 0$ for $\\tau \\le 0$. The initial condition $u_0=0$ correctly allows for a start at $t=1$ ($y_1=1$) since $u_{-k}=0$ for $k \\ge 0$.\n\n4.  **Power Equation and Bounds:** The power drawn in period $t$, $P_t$, is reduced by $\\Delta P$ from the nominal level $P^{\\text{nom}}$ if the load is curtailed. This gives the linear relation:\n    $$P_t = P^{\\text{nom}} - \\Delta P \\cdot u_t$$\n    A simple physical bound is that power cannot be negative, $P_t \\ge 0$. This implies $P^{\\text{nom}} - \\Delta P \\cdot u_t \\ge 0$. Since $u_t \\in \\{0, 1\\}$, this is equivalent to requiring $P^{\\text{nom}} \\ge \\Delta P$. We also have an upper bound $P_t \\le P^{\\text{nom}}$ since $\\Delta P \\ge 0$.\n\n5.  **Number of Starts:** The problem specifies exactly $K$ curtailment starts over the entire horizon. This is a simple summation constraint:\n    $$\\sum_{t=1}^{T} y_t = K$$\n\n### Part 2: Derivation of Maximum Curtailed Energy\n\nThe objective is to maximize the total curtailed energy, $E^{\\text{curt}} = \\Delta t \\sum_{t=1}^{T} \\Delta P \\, u_t$. Since $\\Delta t > 0$ and $\\Delta P \\ge 0$ are constants, this is equivalent to maximizing the total number of curtailed periods, $\\sum_{t=1}^{T} u_t$.\n\nThe time horizon of $T$ periods is partitioned into periods of curtailment ('up-time') and periods of normal operation ('down-time'). We have exactly $K$ starts, which initiate $K$ distinct blocks of curtailment. The timeline begins with an initial down-time block (of potentially zero length, as $u_0=0$), followed by an alternating sequence of $K$ up-time blocks and $K-1$ intermediate down-time blocks, and concludes with a final down-time block.\n\nLet $d_k$ be the duration (in periods) of the $k$-th curtailment block, for $k \\in \\{1, \\dots, K\\}$.\nLet $n_k$ be the duration of the $k$-th normal operation block. The sequence is $n_0, d_1, n_1, d_2, \\dots, d_K, n_K$, where $n_0$ is the initial down-time and $n_K$ is the final down-time.\n\nThe sum of the durations of all blocks must equal the total horizon length:\n$$\\sum_{k=1}^K d_k + \\sum_{k=0}^K n_k = T$$\n\nThe operational constraints impose lower bounds on these durations:\n-   Minimum up-time: $d_k \\ge M$ for all $k \\in \\{1, \\dots, K\\}$.\n-   Minimum down-time: $n_k \\ge N$ for the intermediate blocks, $k \\in \\{1, \\dots, K-1\\}$.\n-   The initial and final down-time blocks are not constrained by minimums other than being non-negative: $n_0 \\ge 0$ and $n_K \\ge 0$.\n\nWe want to maximize the total up-time, $\\sum_{k=1}^K d_k$. From the time balance equation, this is equivalent to minimizing the total down-time, $\\sum_{k=0}^K n_k$:\n$$\\max \\left( \\sum_{k=1}^K d_k \\right) = T - \\min \\left( \\sum_{k=0}^K n_k \\right)$$\n\nTo minimize the total down-time, we must choose the smallest possible values for each $n_k$:\n-   Minimize initial down-time: $\\min(n_0) = 0$. This corresponds to starting the first curtailment at $t=1$.\n-   Minimize intermediate down-time: The $K-1$ blocks between curtailment events must each have a duration of at least $N$. Thus, $\\min(n_k) = N$ for $k \\in \\{1, \\dots, K-1\\}$.\n-   Minimize final down-time: $\\min(n_K) = 0$. This corresponds to a schedule where the last curtailment block extends to the end of the horizon, $t=T$. In this case, the load is in the curtailed state at period $T$ ($u_T=1$), and there is no subsequent down-time block within the horizon. This choice yields a greater total up-time than a schedule that ends with a required down-time block.\n\nThe minimum possible total down-time is the sum of these minimums:\n$$\\min \\left( \\sum_{k=0}^K n_k \\right) = \\min(n_0) + \\sum_{k=1}^{K-1} \\min(n_k) + \\min(n_K) = 0 + (K-1)N + 0 = (K-1)N$$\n\nTherefore, the maximum total number of curtailed periods is:\n$$\\max \\left( \\sum_{t=1}^{T} u_t \\right) = T - (K-1)N$$\n\nThis result must be consistent with the minimum up-time constraint, $d_k \\ge M$. The total up-time $T-(K-1)N$ is distributed among $K$ events. Feasibility requires that this total duration is at least $K \\times M$. The problem statement explicitly directs us to assume that a feasible schedule exists, which means we must presume the condition $T - (K-1)N \\ge KM$ holds. Notably, the parameter $M$ does not appear in the expression for the maximum up-time, because it is a constraint on feasibility, not a determinant of the optimal duration once feasibility is guaranteed. Any time available for curtailment beyond the minimum $KM$ periods will be used to extend the curtailment, regardless of the specific value of $M$.\n\nFinally, the maximum total curtailed energy, expressed in kilowatt-hours (assuming $\\Delta P$ is in kW and $\\Delta t$ is in hours), is:\n$$E^{\\text{curt}}_{\\max} = \\Delta t \\cdot \\Delta P \\cdot \\max \\left( \\sum_{t=1}^{T} u_t \\right)$$\n$$E^{\\text{curt}}_{\\max} = \\Delta P \\, \\Delta t \\, (T - (K-1)N)$$",
            "answer": "$$\n\\boxed{\\Delta P \\Delta t (T - (K-1)N)}\n$$"
        },
        {
            "introduction": "An aggregator's primary task is to co-optimize a diverse portfolio of flexible resources. This practice challenges you to build an integrated model that combines continuously curtailable loads with discrete, shiftable jobs, all competing for a shared power capacity. By formulating and solving a Mixed-Integer Linear Program (MILP) that includes both continuous and binary variables, you will gain hands-on experience in modeling the complex trade-offs inherent in portfolio management. ",
            "id": "4082022",
            "problem": "An aggregator manages electricity consumption over a discrete planning horizon of $T=\\{1,2,3,4\\}$ time slots of length $\\Delta t = 1$ hour. The portfolio consists of two categories of end-uses: (i) a curtailable baseline load and (ii) multiple shiftable jobs. The aggregator is limited by an exogenous power capacity $C_t$ in each time slot and must allocate consumption so that the sum of powers drawn by the curtailable baseline and the shiftable jobs does not exceed the capacity. Use the following well-tested fundamentals and core definitions:\n- Power-to-energy relation: for a time slot of duration $\\Delta t$, the energy drawn equals power times time.\n- Capacity feasibility: the total power synchronized in a given time slot cannot exceed the capacity available in that time slot.\n- A curtailable baseline load is a continuous, nonnegative quantity of power that can be reduced below a desired baseline, incurring a linear penalty proportional to the curtailed energy.\n- A shiftable job is a discrete task that, when active in a time slot, draws a fixed power and must be scheduled for a specified number of time slots within a given availability window.\n\nData:\n- Capacity profile (in kilowatts): $C_1=6$, $C_2=5$, $C_3=4$, $C_4=6$.\n- Desired baseline (non-shiftable) power profile (in kilowatts): $b_1=4$, $b_2=4$, $b_3=4$, $b_4=4$.\n- Curtailment penalty coefficients (in United States dollars per kilowatt-hour): $q_1=1$, $q_2=3$, $q_3=2$, $q_4=1$.\n- Shiftable jobs:\n  - Job $A$: fixed power $P_A=2$ kilowatts, duration $D_A=2$ time slots, availability window $W_A=\\{1,2,3\\}$.\n  - Job $B$: fixed power $P_B=3$ kilowatts, duration $D_B=1$ time slot, availability window $W_B=\\{2,3,4\\}$.\n\nModeling requirements:\n- Use continuous variables $l_t \\in [0,b_t]$ to represent the curtailable baseline power served in each time slot $t \\in T$.\n- Use binary variables $x_{i,t} \\in \\{0,1\\}$ to represent whether job $i \\in \\{A,B\\}$ is active in time slot $t \\in T$ (jobs are preemptive across time slots but non-divisible within a time slot).\n- Enforce shared capacity constraints of the form $\\sum_{i \\in \\{A,B\\}} P_i x_{i,t} + l_t \\le C_t$ for all $t \\in T$.\n- Enforce job duration and window constraints of the form $\\sum_{t \\in W_i} x_{i,t} = D_i$ and $x_{i,t}=0$ for $t \\notin W_i$, for each job $i \\in \\{A,B\\}$.\n- Minimize total curtailment penalty $\\sum_{t \\in T} q_t \\,(b_t - l_t)\\,\\Delta t$.\n\nTask:\n1. Formulate the above as a Mixed-Integer Linear Programming (MILP) problem, explicitly stating the decision variables, objective, and constraints.\n2. Solve the MILP for the provided data and compute the minimal total curtailment penalty. Express the final cost in United States dollars (USD). No rounding is required. Your final answer must be a single real number.",
            "solution": "The user has provided a well-defined problem in energy systems modeling that requires the formulation and solution of a Mixed-Integer Linear Programming (MILP) problem.\n\n### Part 1: MILP Formulation\n\nThe problem is to schedule a set of shiftable jobs and determine the optimal level of curtailable load to serve, in order to minimize the total penalty from curtailment, subject to power capacity constraints.\n\n**Decision Variables**\nLet $T = \\{1, 2, 3, 4\\}$ be the set of time slots. Let $I = \\{A, B\\}$ be the set of shiftable jobs.\n-   $l_t$: A continuous variable representing the power (in kW) supplied to the curtailable baseline load in time slot $t \\in T$.\n-   $x_{i,t}$: A binary variable for each job $i \\in I$ and time slot $t \\in T$, where $x_{i,t} = 1$ if job $i$ is active in time slot $t$, and $x_{i,t} = 0$ otherwise.\n\n**Objective Function**\nThe objective is to minimize the total curtailment penalty. The curtailed power in time slot $t$ is $(b_t - l_t)$, and the curtailed energy is $(b_t - l_t)\\Delta t$. The total penalty is the sum of penalties over all time slots.\n$$\n\\text{Minimize } Z = \\sum_{t \\in T} q_t (b_t - l_t) \\Delta t\n$$\nSubstituting the given values, where $\\Delta t = 1$ hour, the objective is to minimize:\n$$\nZ = 1(4 - l_1) + 3(4 - l_2) + 2(4 - l_3) + 1(4 - l_4)\n$$\nThis expression can be rewritten as:\n$$\nZ = (4 + 12 + 8 + 4) - (l_1 + 3l_2 + 2l_3 + l_4) = 28 - (l_1 + 3l_2 + 2l_3 + l_4)\n$$\nMinimizing this is equivalent to maximizing the term $\\sum_{t \\in T} q_t l_t \\Delta t = l_1 + 3l_2 + 2l_3 + l_4$.\n\n**Constraints**\nThe optimization is subject to the following constraints:\n1.  **Capacity Constraints**: For each time slot $t \\in T$, the total power consumed must not exceed the available capacity $C_t$.\n    $$\n    \\sum_{i \\in I} P_i x_{i,t} + l_t \\le C_t \\quad \\forall t \\in T\n    $$\n    -   $t=1$: $2x_{A,1} + 3x_{B,1} + l_1 \\le 6$\n    -   $t=2$: $2x_{A,2} + 3x_{B,2} + l_2 \\le 5$\n    -   $t=3$: $2x_{A,3} + 3x_{B,3} + l_3 \\le 4$\n    -   $t=4$: $2x_{A,4} + 3x_{B,4} + l_4 \\le 6$\n\n2.  **Job Duration Constraints**: Each job $i$ must be active for a total of $D_i$ time slots.\n    -   Job A: $\\sum_{t=1}^4 x_{A,t} = D_A = 2$\n    -   Job B: $\\sum_{t=1}^4 x_{B,t} = D_B = 1$\n\n3.  **Job Availability Window Constraints**: Jobs can only be active within their specified availability windows.\n    -   Job A: $x_{A,t} = 0$ for $t \\notin W_A = \\{1, 2, 3\\}$. This means $x_{A,4} = 0$. The duration constraint becomes $\\sum_{t \\in W_A} x_{A,t} = x_{A,1} + x_{A,2} + x_{A,3} = 2$.\n    -   Job B: $x_{B,t} = 0$ for $t \\notin W_B = \\{2, 3, 4\\}$. This means $x_{B,1} = 0$. The duration constraint becomes $\\sum_{t \\in W_B} x_{B,t} = x_{B,2} + x_{B,3} + x_{B,4} = 1$.\n\n4.  **Variable Bounds**:\n    -   $0 \\le l_t \\le b_t$, which is $0 \\le l_t \\le 4$, for all $t \\in T$.\n    -   $x_{i,t} \\in \\{0, 1\\}$ for all $i \\in I, t \\in T$.\n\n### Part 2: Solution of the MILP\n\nThe problem is small enough to be solved by enumerating all feasible schedules for the binary variables $x_{i,t}$ and then calculating the resulting minimum cost for each schedule.\n\nFor a fixed schedule of jobs (i.e., fixed values for all $x_{i,t}$), the objective is to minimize $\\sum_{t} q_t(b_t - l_t)\\Delta t$. This is achieved by making each $l_t$ as large as possible. The constraints on $l_t$ are $0 \\le l_t \\le b_t$ and $l_t \\le C_t - \\sum_i P_i x_{i,t}$. Thus, the optimal value for $l_t$ for a given schedule is:\n$$\nl_t^* = \\min(b_t, C_t - \\sum_{i \\in I} P_i x_{i,t})\n$$\nIf for any $t$, $C_t - \\sum_{i \\in I} P_i x_{i,t}  0$, the schedule is infeasible.\n\nThe possible schedules for Job A ($D_A=2$ slots in $W_A=\\{1,2,3\\}$) are:\n-   A1: Active in slots $\\{1, 2\\}$.\n-   A2: Active in slots $\\{1, 3\\}$.\n-   A3: Active in slots $\\{2, 3\\}$.\n\nThe possible schedules for Job B ($D_B=1$ slot in $W_B=\\{2,3,4\\}$) are:\n-   B1: Active in slot $\\{2\\}$.\n-   B2: Active in slot $\\{3\\}$.\n-   B3: Active in slot $\\{4\\}$.\n\nWe now evaluate the $3 \\times 3 = 9$ combined schedules. Let $P_{jobs,t} = P_A x_{A,t} + P_B x_{B,t}$ be the total power of scheduled jobs in slot $t$. The curtailed energy in slot $t$ is $K_t = (b_t - \\min(b_t, C_t - P_{jobs,t}))\\Delta t$. The total cost is $\\sum_{t=1}^4 q_t K_t$. The data used is: capacities $C = (6, 5, 4, 6)$, baseline $b = (4, 4, 4, 4)$, penalties $q = (1, 3, 2, 1)$, $\\Delta t = 1$, $P_A=2$, $P_B=3$.\n\n-   **Case 1: A in $\\{1,2\\}$, B in $\\{2\\}$**\n    $P_{jobs} = (2, 5, 0, 0)$. $C^{rem} = (4, 0, 4, 6)$. $l^*=(4,0,4,4)$. Curtailed energy $K=(0,4,0,0)$. Cost = $3 \\times 4 = 12$.\n\n-   **Case 2: A in $\\{1,2\\}$, B in $\\{3\\}$**\n    $P_{jobs} = (2, 2, 3, 0)$. $C^{rem} = (4, 3, 1, 6)$. $l^*=(4,3,1,4)$. Curtailed energy $K=(0,1,3,0)$. Cost = $(3 \\times 1) + (2 \\times 3) = 9$.\n\n-   **Case 3: A in $\\{1,2\\}$, B in $\\{4\\}$**\n    $P_{jobs} = (2, 2, 0, 3)$. $C^{rem} = (4, 3, 4, 3)$. $l^*=(4,3,4,3)$. Curtailed energy $K=(0,1,0,1)$. Cost = $(3 \\times 1) + (1 \\times 1) = 4$.\n\n-   **Case 4: A in $\\{1,3\\}$, B in $\\{2\\}$**\n    $P_{jobs} = (2, 3, 2, 0)$. $C^{rem} = (4, 2, 2, 6)$. $l^*=(4,2,2,4)$. Curtailed energy $K=(0,2,2,0)$. Cost = $(3 \\times 2) + (2 \\times 2) = 10$.\n\n-   **Case 5: A in $\\{1,3\\}$, B in $\\{3\\}$**\n    $P_{jobs} = (2, 0, 5, 0)$. In slot $t=3$, job power is $P_A + P_B = 2+3=5$, but capacity is $C_3=4$. This schedule is infeasible.\n\n-   **Case 6: A in $\\{1,3\\}$, B in $\\{4\\}$**\n    $P_{jobs} = (2, 0, 2, 3)$. $C^{rem} = (4, 5, 2, 3)$. $l^*=(4,4,2,3)$. Curtailed energy $K=(0,0,2,1)$. Cost = $(2 \\times 2) + (1 \\times 1) = 5$.\n\n-   **Case 7: A in $\\{2,3\\}$, B in $\\{2\\}$**\n    $P_{jobs} = (0, 5, 2, 0)$. $C^{rem} = (6, 0, 2, 6)$. $l^*=(4,0,2,4)$. Curtailed energy $K=(0,4,2,0)$. Cost = $(3 \\times 4) + (2 \\times 2) = 16$.\n\n-   **Case 8: A in $\\{2,3\\}$, B in $\\{3\\}$**\n    $P_{jobs} = (0, 2, 5, 0)$. In slot $t=3$, job power is $5$, capacity is $4$. This schedule is infeasible.\n\n-   **Case 9: A in $\\{2,3\\}$, B in $\\{4\\}$**\n    $P_{jobs} = (0, 2, 2, 3)$. $C^{rem} = (6, 3, 2, 3)$. $l^*=(4,3,2,3)$. Curtailed energy $K=(0,1,2,1)$. Cost = $(3 \\times 1) + (2 \\times 2) + (1 \\times 1) = 8$.\n\nComparing the total costs of all feasible schedules: $\\{12, 9, 4, 10, 5, 16, 8\\}$. The minimum cost is $4$ USD. This occurs when Job A is scheduled in time slots $\\{1, 2\\}$ and Job B is scheduled in time slot $\\{4\\}$.\n\nThe optimal solution is:\n-   $x_{A,1}=1, x_{A,2}=1$, all other $x_{A,t}=0$.\n-   $x_{B,4}=1$, all other $x_{B,t}=0$.\n-   $l_1 = 4$ kW, $l_2 = 3$ kW, $l_3 = 4$ kW, $l_4 = 3$ kW.\n-   Minimal total curtailment penalty = $4$ USD.",
            "answer": "$$\n\\boxed{4}\n$$"
        }
    ]
}