{
    "hands_on_practices": [
        {
            "introduction": "在能源项目投资决策中，投资者常常需要在不同的激励政策之间做出选择，例如在生产税收抵免（PTC）和投资税收抵免（ITC）之间权衡。此练习将指导您如何利用混合整数线性规划（MILP）来构建一个优化模型，为单个可再生能源项目做出最优的政策选择。掌握这种建模方法是进行项目融资分析和评估政策影响的基本功。",
            "id": "4114349",
            "problem": "您的任务是构建并求解一个混合整数线性规划（MILP），该规划代表了在单一风电项目的程式化能源系统模型中，生产税收抵免（PTC）和投资税收抵免（ITC）之间的互斥选择。该模型必须根据现金流核算、容量限制生产和线性优化的基本原则进行公式化，然后实现为一个程序，为一小组测试套件计算最优选择、投资和运营决策。所有物理和金融量必须以指定的单位表示，所有变量、参数和数字必须用 LaTeX 书写。\n\n推导的基本基础是：\n1. 净现值（NPV）：现金流在各个时期内是可加的，具有现值权重。对于每个时期 $t$，收入现金流等于价格与数量的乘积，通过权重 $w_t$ 折算为现值。投资支出在 $t=0$ 时支付，不进行折现。需要最大化的NPV是收入加抵免的现值减去投资成本。\n2. 容量限制的生产：时期 $t$ 的发电量，记为 $g_t$（单位 $\\mathrm{MWh}$），受限于装机容量 $K$（单位 $\\mathrm{MW}$）和特定时期的性能，通过以下公式表示\n$$\ng_t \\leq \\mathrm{CF}_t \\cdot H_t \\cdot K,\n$$\n其中 $\\mathrm{CF}_t \\in [0,1]$ 是容量因子（无单位），$H_t$ 是时期 $t$ 的小时数（单位 $\\mathrm{h}$）。\n3. 线性目标和约束：目标是决策变量的线性函数，可行域由线性不等式和边界定义。二元决策变量用于强制执行政策制度的选择。\n\n定义以下符号和决策变量：\n- $K \\ge 0$（单位 $\\mathrm{MW}$）是装机容量。\n- $g_t \\ge 0$（单位 $\\mathrm{MWh}$）是时期 $t$ 的发电量。\n- $x \\in \\{0,1\\}$ 是选择生产税收抵免（PTC）制度的二元变量。\n- $y \\in \\{0,1\\}$ 是选择投资税收抵免（ITC）制度的二元变量。\n- 互斥性通过以下等式强制执行\n$$\nx + y = 1.\n$$\n- 时期 $t$ 的电价是 $p_t$（单位 $\\mathrm{USD/MWh}$）。\n- 单位能源的可变运营和维护成本是 $c_v$（单位 $\\mathrm{USD/MWh}$）。\n- 单位容量的资本支出是 $c_{\\mathrm{cap}}$（单位 $\\mathrm{USD/MW}$）。\n- PTC费率是 $r_{\\mathrm{PTC}}$（单位 $\\mathrm{USD/MWh}$）。\n- ITC费率是 $r_{\\mathrm{ITC}}$（$\\text{分数}$，无单位，例如，$0.3$ 代表百分之三十）。\n- 时期 $t$ 的现值权重是 $w_t$（无单位）。\n- 容量的物理上限是 $K_{\\max}$（单位 $\\mathrm{MW}$）。\n\n为在目标函数中保持线性，避免二元变量和连续变量相乘，使用标准的门控变量：\n- 引入 $g^{\\mathrm{PTC}}_t \\ge 0$（单位 $\\mathrm{MWh}$），使得当 $x=1$ 时 $g^{\\mathrm{PTC}}_t = g_t$，当 $x=0$ 时 $g^{\\mathrm{PTC}}_t = 0$。这通过带有 $g_t$ 上界 $U_t$ 的线性约束来表示：\n$$\n\\begin{aligned}\ng^{\\mathrm{PTC}}_t \\le g_t, \\\\\ng^{\\mathrm{PTC}}_t \\le x \\cdot U_t, \\\\\ng^{\\mathrm{PTC}}_t \\ge g_t - (1-x)\\cdot U_t, \\\\\ng^{\\mathrm{PTC}}_t \\ge 0,\n\\end{aligned}\n$$\n其中 $U_t$ 是 $g_t$ 的一个有效的常数上界，例如 $U_t = \\mathrm{CF}_t \\cdot H_t \\cdot K_{\\max}$（单位 $\\mathrm{MWh}$）。\n- 引入 $K^{\\mathrm{ITC}} \\ge 0$（单位 $\\mathrm{MW}$），使得当 $y=1$ 时 $K^{\\mathrm{ITC}} = K$，当 $y=0$ 时 $K^{\\mathrm{ITC}} = 0$，其约束条件为\n$$\n\\begin{aligned}\nK^{\\mathrm{ITC}} \\le K, \\\\\nK^{\\mathrm{ITC}} \\le y \\cdot K_{\\max}, \\\\\nK^{\\mathrm{ITC}} \\ge K - (1-y)\\cdot K_{\\max}, \\\\\nK^{\\mathrm{ITC}} \\ge 0.\n\\end{aligned}\n$$\n\n那么，NPV目标（单位 $\\mathrm{USD}$）为\n$$\n\\max\\ \\sum_{t} w_t \\left( (p_t - c_v) g_t + r_{\\mathrm{PTC}}\\, g^{\\mathrm{PTC}}_t \\right) - c_{\\mathrm{cap}} K + r_{\\mathrm{ITC}} c_{\\mathrm{cap}} K^{\\mathrm{ITC}}.\n$$\n\n所有变量和参数必须遵守其单位：\n- $K$ 和 $K^{\\mathrm{ITC}}$ 单位为 $\\mathrm{MW}$，\n- $g_t$ 和 $g^{\\mathrm{PTC}}_t$ 单位为 $\\mathrm{MWh}$，\n- $p_t$, $c_v$, $r_{\\mathrm{PTC}}$ 单位为 $\\mathrm{USD/MWh}$，\n- $c_{\\mathrm{cap}}$ 单位为 $\\mathrm{USD/MW}$，\n- NPV 单位为 $\\mathrm{USD}$。\n\n您的程序必须通过枚举二元决策 $\\{(x,y) : x \\in \\{0,1\\}, y=1-x\\}$ 来求解此MILP，对于每个固定的选择，当 $x=1$ 时设置 $g^{\\mathrm{PTC}}_t = g_t$，当 $x=0$ 时设置 $g^{\\mathrm{PTC}}_t = 0$，以及当 $y=1$ 时设置 $K^{\\mathrm{ITC}} = K$，当 $y=0$ 时设置 $K^{\\mathrm{ITC}} = 0$，从而将其简化为线性规划（LP）。使用标准线性规划求解得到的LP，选择具有较高NPV的二元制度，如果NPV相等，则选择投资税收抵免（ITC）制度（即，设置 $y=1$）来打破平局。\n\n测试套件：\n- 案例1（生产税收抵免可能占优的一般情况）：\n  - $T = 2$ 个时期。\n  - $H = [4380, 4380]$（单位 $\\mathrm{h}$）。\n  - $\\mathrm{CF} = [0.35, 0.25]$（无单位）。\n  - $p = [40, 45]$（单位 $\\mathrm{USD/MWh}$）。\n  - $c_v = 5$（单位 $\\mathrm{USD/MWh}$）。\n  - $r_{\\mathrm{PTC}} = 23$（单位 $\\mathrm{USD/MWh}$）。\n  - $r_{\\mathrm{ITC}} = 0.3$（无单位分数）。\n  - $c_{\\mathrm{cap}} = 100000$（单位 $\\mathrm{USD/MW}$）。\n  - $K_{\\max} = 100$（单位 $\\mathrm{MW}$）。\n  - $w = [0.95, 0.90]$（无单位）。\n- 案例2（生产税收抵免为零，有利于投资税收抵免的边界情况）：\n  - $T = 2$。\n  - $H = [4380, 4380]$（单位 $\\mathrm{h}$）。\n  - $\\mathrm{CF} = [0.35, 0.25]$。\n  - $p = [40, 45]$（单位 $\\mathrm{USD/MWh}$）。\n  - $c_v = 5$（单位 $\\mathrm{USD/MWh}$）。\n  - $r_{\\mathrm{PTC}} = 0$（单位 $\\mathrm{USD/MWh}$）。\n  - $r_{\\mathrm{ITC}} = 0.3$。\n  - $c_{\\mathrm{cap}} = 100000$（单位 $\\mathrm{USD/MW}$）。\n  - $K_{\\max} = 100$（单位 $\\mathrm{MW}$）。\n  - $w = [0.95, 0.90]$。\n- 案例3（能源价格低但高生产税收抵免可促成投资的边缘情况）：\n  - $T = 2$。\n  - $H = [4380, 4380]$（单位 $\\mathrm{h}$）。\n  - $\\mathrm{CF} = [0.35, 0.25]$。\n  - $p = [15, 16]$（单位 $\\mathrm{USD/MWh}$）。\n  - $c_v = 20$（单位 $\\mathrm{USD/MWh}$）。\n  - $r_{\\mathrm{PTC}} = 60$（单位 $\\mathrm{USD/MWh}$）。\n  - $r_{\\mathrm{ITC}} = 0.3$。\n  - $c_{\\mathrm{cap}} = 100000$（单位 $\\mathrm{USD/MW}$）。\n  - $K_{\\max} = 80$（单位 $\\mathrm{MW}$）。\n  - $w = [0.95, 0.90]$。\n\n输出规格：\n- 对于每个测试案例，您的程序必须计算最优二元选择 $(x^\\star, y^\\star)$，最优容量 $K^\\star$（单位 $\\mathrm{MW}$），每个时期 $t$ 的最优发电量 $g^\\star_t$（单位 $\\mathrm{MWh}$），以及最优净现值 $\\mathrm{NPV}^\\star$（单位 $\\mathrm{USD}$）。\n- 您的程序应生成单行输出，其中包含所有测试案例的结果，格式为用方括号括起来的逗号分隔列表。每个测试案例的结果本身必须是一个列表，形式为\n$$\n[x^\\star, y^\\star, K^\\star, g^\\star_1, \\dots, g^\\star_T, \\mathrm{NPV}^\\star],\n$$\n其中 $x^\\star$ 和 $y^\\star$ 是整数，而 $K^\\star$、$g^\\star_t$ 和 $\\mathrm{NPV}^\\star$ 是实数。单位如上所述。",
            "solution": "用户提供了一个问题，要求对一个混合整数线性规划（MILP）进行建模和求解，以模拟风电项目的投资决策。该决策涉及在两种税收抵免政策之间做出互斥选择：生产税收抵免（PTC）和投资税收抵免（ITC）。该问题将通过枚举离散选择，将问题简化为两个独立的线性规划（LP），并选择产生最高净现值（NPV）的政策来解决。\n\n所陈述的问题经过验证，发现其科学基础扎实、提法恰当、客观且内部一致。这是优化技术在能源经济建模中的一个标准应用。因此，我们可以继续进行推导和求解。\n\n问题的核心是最大化项目的NPV，它是装机容量 $K$（单位 $\\mathrm{MW}$）、每个时期 $t$ 的发电量 $g_t$（单位 $\\mathrm{MWh}$）以及由二元变量 $x$（代表PTC）和 $y$（代表ITC）表示的税收抵免制度选择的函数。\n\n完整的MILP公式如下：\n\n**决策变量：**\n-   $K \\ge 0$：装机容量（$\\mathrm{MW}$）。\n-   $g_t \\ge 0$：时期 $t$ 的发电量（$\\mathrm{MWh}$）。\n-   $x, y \\in \\{0, 1\\}$：PTC和ITC制度的二元指示符。\n-   $g^{\\mathrm{PTC}}_t \\ge 0$：时期 $t$ 符合PTC资格的发电量（$\\mathrm{MWh}$）。\n-   $K^{\\mathrm{ITC}} \\ge 0$：符合ITC资格的容量（$\\mathrm{MW}$）。\n\n**目标函数（最大化NPV）：**\n$$\n\\max_{K, g_t, x, y, g^{\\mathrm{PTC}}_t, K^{\\mathrm{ITC}}} \\left( \\sum_{t} w_t \\left( (p_t - c_v) g_t + r_{\\mathrm{PTC}}\\, g^{\\mathrm{PTC}}_t \\right) - c_{\\mathrm{cap}} K + r_{\\mathrm{ITC}} c_{\\mathrm{cap}} K^{\\mathrm{ITC}} \\right)\n$$\n\n**约束条件：**\n1.  税收抵免的互斥性：\n    $$x + y = 1$$\n2.  容量限制的发电：\n    $$g_t \\le \\mathrm{CF}_t \\cdot H_t \\cdot K \\quad \\forall t$$\n3.  容量上限：\n    $$0 \\le K \\le K_{\\max}$$\n4.  PTC发电量的门控约束（$g^{\\mathrm{PTC}}_t = x \\cdot g_t$）：\n    $$\n    \\begin{aligned}\n    g^{\\mathrm{PTC}}_t \\le g_t \\\\\n    g^{\\mathrm{PTC}}_t \\le x \\cdot U_t \\\\\n    g^{\\mathrm{PTC}}_t \\ge g_t - (1-x)\\cdot U_t\n    \\end{aligned}\n    $$\n    其中 $U_t = \\mathrm{CF}_t \\cdot H_t \\cdot K_{\\max}$ 是 $g_t$ 的一个有效上界。\n5.  ITC容量的门控约束（$K^{\\mathrm{ITC}} = y \\cdot K$）：\n    $$\n    \\begin{aligned}\n    K^{\\mathrm{ITC}} \\le K \\\\\n    K^{\\mathrm{ITC}} \\le y \\cdot K_{\\max} \\\\\n    K^{\\mathrm{ITC}} \\ge K - (1-y)\\cdot K_{\\max}\n    \\end{aligned}\n    $$\n6.  非负性：所有变量均为非负。\n\n问题指定通过将此MILP分解为两个独立的LP来求解，对应两种可能的税收抵免制度。\n\n**分解为线性规划**\n\n**1. 生产税收抵免（PTC）制度：$(x, y) = (1, 0)$**\n如果我们固定 $x=1$ 和 $y=0$，MILP会显著简化。\n互斥约束 $x+y=1$ 得到满足。\n$g^{\\mathrm{PTC}}_t$ 的门控约束简化为 $g^{\\mathrm{PTC}}_t \\le g_t$、$g^{\\mathrm{PTC}}_t \\le U_t$ 和 $g^{\\mathrm{PTC}}_t \\ge g_t$，这些共同强制 $g^{\\mathrm{PTC}}_t = g_t$。\n$K^{\\mathrm{ITC}}$ 的门控约束简化为 $K^{\\mathrm{ITC}} \\le K$、$K^{\\mathrm{ITC}} \\le 0$ 和 $K^{\\mathrm{ITC}} \\ge K - K_{\\max}$，连同非负性强制 $K^{\\mathrm{ITC}} = 0$。\n\n将这些代入目标函数，我们得到第一个线性规划，LP$_{\\mathrm{PTC}}$：\n$$\n\\mathrm{NPV}_{\\mathrm{PTC}} = \\max_{K, g_t} \\left( \\sum_{t} w_t (p_t - c_v + r_{\\mathrm{PTC}}) g_t - c_{\\mathrm{cap}} K \\right)\n$$\n受限于：\n$$\n\\begin{aligned}\ng_t \\le (\\mathrm{CF}_t \\cdot H_t) K \\quad \\forall t \\\\\n0 \\le K \\le K_{\\max} \\\\\ng_t \\ge 0 \\quad \\forall t\n\\end{aligned}\n$$\n这是一个以所有时期 $t$ 的 $K$ 和 $g_t$ 为决策变量的线性规划。\n\n**2. 投资税收抵免（ITC）制度：$(x, y) = (0, 1)$**\n如果我们固定 $x=0$ 和 $y=1$，会发生类似的简化。\n$g^{\\mathrm{PTC}}_t$ 的门控约束变为 $g^{\\mathrm{PTC}}_t \\le g_t$、$g^{\\mathrm{PTC}}_t \\le 0$ 和 $g^{\\mathrm{PTC}}_t \\ge g_t - U_t$。加上非负性，这强制 $g^{\\mathrm{PTC}}_t = 0$。\n$K^{\\mathrm{ITC}}$ 的门控约束变为 $K^{\\mathrm{ITC}} \\le K$、$K^{\\mathrm{ITC}} \\le K_{\\max}$ 和 $K^{\\mathrm{ITC}} \\ge K$，强制 $K^{\\mathrm{ITC}} = K$。\n\n将这些代入通用目标函数，得到第二个线性规划，LP$_{\\mathrm{ITC}}$：\n$$\n\\mathrm{NPV}_{\\mathrm{ITC}} = \\max_{K, g_t} \\left( \\sum_{t} w_t (p_t - c_v) g_t - (1 - r_{\\mathrm{ITC}}) c_{\\mathrm{cap}} K \\right)\n$$\n受限于与 LP$_{\\mathrm{PTC}}$ 相同的约束集：\n$$\n\\begin{aligned}\ng_t \\le (\\mathrm{CF}_t \\cdot H_t) K \\quad \\forall t \\\\\n0 \\le K \\le K_{\\max} \\\\\ng_t \\ge 0 \\quad \\forall t\n\\end{aligned}\n$$\n\n**求解算法**\n通过为每个测试案例执行以下步骤来找到整体解：\n1.  构建并求解 LP$_{\\mathrm{PTC}}$，以找到最优容量 $K_{\\mathrm{PTC}}^\\star$、发电水平 $g_{t, \\mathrm{PTC}}^\\star$ 和最大净现值 $\\mathrm{NPV}_{\\mathrm{PTC}}^\\star$。\n2.  构建并求解 LP$_{\\mathrm{ITC}}$，以找到最优容量 $K_{\\mathrm{ITC}}^\\star$、发电水平 $g_{t, \\mathrm{ITC}}^\\star$ 和最大净现值 $\\mathrm{NPV}_{\\mathrm{ITC}}^\\star$。\n3.  比较最优值：\n    -   如果 $\\mathrm{NPV}_{\\mathrm{PTC}}^\\star > \\mathrm{NPV}_{\\mathrm{ITC}}^\\star$，则最优策略是选择PTC制度。最终解为 $(x^\\star, y^\\star) = (1, 0)$、$K^\\star = K_{\\mathrm{PTC}}^\\star$、$g_t^\\star = g_{t, \\mathrm{PTC}}^\\star$ 和 $\\mathrm{NPV}^\\star = \\mathrm{NPV}_{\\mathrm{PTC}}^\\star$。\n    -   否则（如果 $\\mathrm{NPV}_{\\mathrm{PTC}}^\\star \\le \\mathrm{NPV}_{\\mathrm{ITC}}^\\star$，包括平局情况），最优策略是选择ITC制度。最终解为 $(x^\\star, y^\\star) = (0, 1)$、$K^\\star = K_{\\mathrm{ITC}}^\\star$、$g_t^\\star = g_{t, \\mathrm{ITC}}^\\star$ 和 $\\mathrm{NPV}^\\star = \\mathrm{NPV}_{\\mathrm{ITC}}^\\star$。\n\n每个LP将使用标准的线性规划求解器进行求解。求解器的决策变量将公式化为向量 $\\mathbf{z} = [K, g_1, \\dots, g_T]^T$。目标函数系数和约束矩阵将为两个子问题相应地构建。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a set of wind project investment problems, choosing between\n    Production Tax Credit (PTC) and Investment Tax Credit (ITC).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"T\": 2,\n            \"H\": np.array([4380, 4380]),\n            \"CF\": np.array([0.35, 0.25]),\n            \"p\": np.array([40, 45]),\n            \"c_v\": 5,\n            \"r_PTC\": 23,\n            \"r_ITC\": 0.3,\n            \"c_cap\": 100000,\n            \"K_max\": 100,\n            \"w\": np.array([0.95, 0.90]),\n        },\n        {\n            \"case_id\": 2,\n            \"T\": 2,\n            \"H\": np.array([4380, 4380]),\n            \"CF\": np.array([0.35, 0.25]),\n            \"p\": np.array([40, 45]),\n            \"c_v\": 5,\n            \"r_PTC\": 0,\n            \"r_ITC\": 0.3,\n            \"c_cap\": 100000,\n            \"K_max\": 100,\n            \"w\": np.array([0.95, 0.90]),\n        },\n        {\n            \"case_id\": 3,\n            \"T\": 2,\n            \"H\": np.array([4380, 4380]),\n            \"CF\": np.array([0.35, 0.25]),\n            \"p\": np.array([15, 16]),\n            \"c_v\": 20,\n            \"r_PTC\": 60,\n            \"r_ITC\": 0.3,\n            \"c_cap\": 100000,\n            \"K_max\": 80,\n            \"w\": np.array([0.95, 0.90]),\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        # Unpack parameters\n        T = params[\"T\"]\n        H = params[\"H\"]\n        CF = params[\"CF\"]\n        p = params[\"p\"]\n        c_v = params[\"c_v\"]\n        r_PTC = params[\"r_PTC\"]\n        r_ITC = params[\"r_ITC\"]\n        c_cap = params[\"c_cap\"]\n        K_max = params[\"K_max\"]\n        w = params[\"w\"]\n        \n        # --- Solve for PTC regime (x=1, y=0) ---\n        \n        # Objective function for maximization: \n        # sum(w_t * (p_t - c_v + r_PTC) * g_t) - c_cap * K\n        # For scipy.optimize.linprog (minimization):\n        # min c_cap*K - sum(w_t * (p_t - c_v + r_PTC) * g_t)\n        # Variables z = [K, g_1, ..., g_T]\n        \n        c_ptc = np.zeros(T + 1)\n        c_ptc[0] = c_cap\n        c_ptc[1:] = -w * (p - c_v + r_PTC)\n\n        # Constraints: g_t - CF_t * H_t * K = 0 for all t\n        # A_ub @ z = b_ub\n        A_ub = np.zeros((T, T + 1))\n        for t in range(T):\n            A_ub[t, 0] = -CF[t] * H[t]  # Coefficient for K\n            A_ub[t, t + 1] = 1         # Coefficient for g_t\n        b_ub = np.zeros(T)\n\n        # Bounds for variables: 0 = K = K_max, g_t >= 0\n        bounds = [(0, K_max)] + [(0, None) for _ in range(T)]\n        \n        res_ptc = linprog(c_ptc, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs')\n        \n        if res_ptc.success:\n            K_ptc = res_ptc.x[0] if res_ptc.x[0] > 1e-9 else 0.0\n            g_ptc = res_ptc.x[1:]\n            g_ptc[g_ptc  1e-9] = 0.0\n            npv_ptc = -res_ptc.fun\n        else:\n            # If solver fails, assume zero investment is the fallback\n            K_ptc, g_ptc, npv_ptc = 0.0, np.zeros(T), 0.0\n\n        # --- Solve for ITC regime (x=0, y=1) ---\n\n        # Objective function for maximization:\n        # sum(w_t * (p_t - c_v) * g_t) - (1 - r_ITC) * c_cap * K\n        # For scipy.optimize.linprog (minimization):\n        # min (1 - r_ITC) * c_cap * K - sum(w_t * (p_t - c_v) * g_t)\n        \n        c_itc = np.zeros(T + 1)\n        c_itc[0] = (1 - r_ITC) * c_cap\n        c_itc[1:] = -w * (p - c_v)\n\n        # Constraints and bounds are the same as for the PTC case.\n        res_itc = linprog(c_itc, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs')\n        \n        if res_itc.success:\n            K_itc = res_itc.x[0] if res_itc.x[0] > 1e-9 else 0.0\n            g_itc = res_itc.x[1:]\n            g_itc[g_itc  1e-9] = 0.0\n            npv_itc = -res_itc.fun\n        else:\n            # If solver fails, assume zero investment is the fallback\n            K_itc, g_itc, npv_itc = 0.0, np.zeros(T), 0.0\n\n        # --- Compare and select the optimal regime ---\n        \n        # Tie-breaking rule: if NPVs are equal, choose ITC\n        if npv_ptc > npv_itc:\n            x_star, y_star = 1, 0\n            K_star, g_star, npv_star = K_ptc, g_ptc, npv_ptc\n        else:\n            x_star, y_star = 0, 1\n            K_star, g_star, npv_star = K_itc, g_itc, npv_itc\n\n        # Format the result list for this case\n        case_result = [x_star, y_star, K_star] + list(g_star) + [npv_star]\n        results.append(case_result)\n\n\n    # Final print statement in the exact required format.\n    # The output format requires `str(list)` which includes brackets and spaces.\n    # Joining these string representations with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "成功的能源系统规划不仅要考虑当下的最优决策，还必须将政策的动态性纳入考量，尤其是税收抵免等激励政策的“日落条款”（legislative sunset）。本练习将视角从单个项目扩展到更宏观的系统级容量扩张规划。您将学习如何构建一个线性规划模型，以量化分析PTC政策的到期对长期可再生能源投资规模的深刻影响。",
            "id": "4114372",
            "problem": "考虑一个程式化的容量扩张规划问题，该问题涉及一种单一新型可再生技术，其提供的能源用于满足外生的年度能源需求。投资决策是从私人投资者的角度进行建模的，该投资者旨在最大化净现值，这等效于最小化净现值成本。该表示必须包含带有立法日落条款的生产税收抵免 (PTC)。规划期包含 $T$ 个年度周期，由 $t \\in \\{1,2,\\dots,T\\}$ 索引。设年度贴现率为 $r$，每期贴现因子为 $\\gamma_t = (1+r)^{-t}$。该可再生技术的资本成本为每兆瓦装机容量 $C$ 美元，可变运营成本为每兆瓦时 $v_R$ 美元，拥有一个时变容量因子 $CF_t \\in [0,1]$，在周期 $t$ 内最多可产生 $g_t^R \\leq K \\cdot CF_t \\cdot H$ 兆瓦时的电能，其中 $K$ 是代表以兆瓦为单位的装机容量的决策变量，而 $H$ 是一年中的小时数。未由可再生技术供应的能源由一种备用技术满足，其可变成本为每兆瓦时 $c_B$ 美元，且无容量限制。\n\n生产税收抵免 (PTC) 在周期 $t$ 为每兆瓦时的可再生能源发电量支付 $a_t$ 美元。为纳入立法日落条款，强制规定当 $t \\leq t^{sunset}$ 时 $a_t = a$，当 $t > t^{sunset}$ 时 $a_t = 0$，其中 $t^{sunset}$ 是一个满足 $0 \\leq t^{sunset} \\leq T$ 的整数。对于每个 $t$，需要精确满足的年度能源需求为 $D_t$ 兆瓦时。假设所有决策变量均为非负，且每个周期的需求都得到精确满足。\n\n从贴现现金流估值和完全竞争下的静态理性选择原则出发，将该决策问题建立为一个线性优化问题，其目标是在满足物理可行性约束的条件下，最小化总贴现系统成本。使用时间 0 的现值计算的总贴现系统成本，必须包括一次性资本投资成本和两种技术的贴现净可变成本，其中 PTC 在其适用周期内降低了可再生能源发电的有效可变成本。\n\n您的程序必须：\n- 针对每个测试用例，在两种情景下实现此模型并计算以兆瓦为单位的最优装机容量 $K$：(i) 有立法日落条款，以及 (ii) 无日落条款，即对于所有 $t \\in \\{1,\\dots,T\\}$ 都有 $a_t = a$。\n- 使用线性规划求解器获取最优决策变量。\n- 将最终容量以兆瓦为单位表示，并四舍五入到三位小数的浮点数。\n\n全程必须遵守物理单位：资本成本以美元/兆瓦 ($\\$$/MW) 为单位，可变成本以美元/兆瓦时 ($\\$$/MWh) 为单位，能源以兆瓦时 (MWh) 为单位，容量以兆瓦 (MW) 为单位，时间以小时/年 (h/year) 为单位。所有分数答案必须是小数，而非比率。\n\n测试套件：\n使用以下四个科学上一致的测试用例，每个用例由参数 $(T, r, H, C, v_R, c_B, a, t^{sunset}, \\{CF_t\\}_{t=1}^T, \\{D_t\\}_{t=1}^T)$ 定义。\n\n- 案例1（规划期中段出现日落条款的理想路径）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 25$ $\\$$/MWh, $t^{sunset} = 3$, $CF_t = 0.4$ for all $t$, $D_t = 14000$ MWh for all $t$.\n\n- 案例2（早期日落条款和中等PTC的边界条件）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 20$ $\\$$/MWh, $t^{sunset} = 1$, $CF_t = 0.4$ for all $t$, $D_t = 14000$ MWh for all $t$.\n\n- 案例3（PTC为零的边缘情况）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 0$ $\\$$/MWh, $t^{sunset} = 0$, $CF_t = 0.4$ for all $t$, $D_t = 14000$ MWh for all $t$.\n\n- 案例4（非均匀需求和部分日落条款的重要边缘情况）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1060000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 25$ $\\$$/MWh, $t^{sunset} = 3$, $CF_t = 0.4$ for all $t$, $D_t = [10000, 14000, 14000, 6000, 6000]$ MWh.\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身是一个包含两个以兆瓦为单位的浮点数 $[K^{sunset}, K^{nosunset}]$ 的列表，每个浮点数都四舍五入到三位小数。例如，输出必须类似于 $[[K_1^{sunset},K_1^{nosunset}],[K_2^{sunset},K_2^{nosunset}],[K_3^{sunset},K_3^{nosunset}],[K_4^{sunset},K_4^{nosunset}]]$，单位默认为兆瓦 (MW)。",
            "solution": "该问题要求为可再生能源容量扩张决策建立并求解一个线性优化模型。该模型旨在最小化在规划期内满足给定年度能源需求的净现值成本，其中考虑了对一种可再生技术的一次性投资以及一个不受约束的备用电源。该模型必须包含可能因立法日落条款而到期的生产税收抵免 (PTC)。\n\n### 原则与公式\n\n该问题是从一个理性投资者的角度构建的，他在时间 $t=0$ 做出决策以最大化净现值，这等效于最小化总贴现成本。贴现现金流分析的原则是核心。\n\n#### 决策变量\n在时间 $t=0$ 的投资决策是安装的可再生资源的容量：\n- $K$：已安装的可再生能源容量（单位：MW）。\n\n对于每个时间周期 $t \\in \\{1, 2, \\dots, T\\}$，需要做出关于每个来源产生多少能源的运营决策：\n- $g_t^R$：周期 $t$ 的可再生能源发电量（单位：MWh）。\n- $g_t^B$：周期 $t$ 的备用能源发电量（单位：MWh）。\n\n所有决策变量都被约束为非负：$K \\geq 0$，$g_t^R \\geq 0$，$g_t^B \\geq 0$。\n\n#### 目标函数\n目标是最小化贴现至时间 $t=0$ 的现值的总系统成本。总成本包括前期资本支出和规划期 $T$ 内的净运营成本流。\n\n1.  **资本成本**：可再生能源容量的一次性投资成本为 $C \\cdot K$，发生在 $t=0$。其现值就是 $C \\cdot K$。\n\n2.  **运营成本**：在每个周期 $t$，发电成本是可再生能源和备用能源成本的总和。PTC 提供抵免，有效降低了可再生能源的发电成本。周期 $t$ 的净运营成本为 $(v_R \\cdot g_t^R) + (c_B \\cdot g_t^B) - (a_t \\cdot g_t^R)$。\n\n周期 $t$ 的运营成本的现值使用贴现因子 $\\gamma_t = (1+r)^{-t}$ 计算。对所有周期求和，总贴现运营成本为 $\\sum_{t=1}^{T} \\gamma_t \\left( (v_R - a_t) g_t^R + c_B g_t^B \\right)$。\n\n要最小化的完整目标函数是资本成本和总贴现运营成本之和：\n$$ \\min_{K, g_t^R, g_t^B} \\quad Z = C \\cdot K + \\sum_{t=1}^{T} \\gamma_t \\left[ (v_R - a_t) g_t^R + c_B g_t^B \\right] $$\n\n#### 约束条件\n决策受到物理和市场约束的限制。\n\n1.  **需求满足**：对于每个周期 $t$，总发电量必须精确满足指定的需求 $D_t$。\n    $$ g_t^R + g_t^B = D_t \\quad \\forall t \\in \\{1, \\dots, T\\} $$\n\n2.  **可再生能源发电限制**：在任何周期 $t$，可再生技术的输出不能超过其物理潜力，该潜力由装机容量 $K$、时变容量因子 $CF_t$ 和一年中的总小时数 $H$ 决定。\n    $$ g_t^R \\leq K \\cdot CF_t \\cdot H \\quad \\forall t \\in \\{1, \\dots, T\\} $$\n\n这个完整的公式——一个受线性等式和不等式约束的线性目标函数——是一个线性规划 (LP) 问题。\n\n### 求解的算法设计\n\n该问题将使用 `scipy.optimize` 库中的 `linprog` 函数来求解，该函数旨在解决以下标准形式的线性规划问题：\n$$ \\min_x c^T x \\quad \\text{subject to} \\quad A_{ub} x \\leq b_{ub}, \\quad A_{eq} x = b_{eq}, \\quad \\text{and bounds on } x. $$\n\n要应用此求解器，我们必须将我们的模型映射到这种标准形式。\n\n1.  **决策向量 $x$**：决策变量被排列成一个单独的列向量 $x$。我们使用以下顺序：\n    $$ x = [K, g_1^R, \\dots, g_T^R, g_1^B, \\dots, g_T^B]^T $$\n    向量 $x$ 总共有 $1 + 2T$ 个元素。\n\n2.  **成本向量 $c$**：目标函数的系数被放入向量 $c$ 中，与 $x$ 中的顺序相匹配。\n    $$ c = [C, \\gamma_1(v_R-a_1), \\dots, \\gamma_T(v_R-a_T), \\gamma_1 c_B, \\dots, \\gamma_T c_B]^T $$\n\n3.  **等式约束 $A_{eq}, b_{eq}$**：需求满足约束 $g_t^R + g_t^B = D_t$ 被编码在矩阵 $A_{eq}$ 和向量 $b_{eq}$ 中。对于 $T$ 个周期中的每一个， $A_{eq}$ 中的一行将在对应于 $g_t^R$ 的列中有一个 $1$，在对应于 $g_t^B$ 的列中有一个 $1$。 $b_{eq}$ 中对应的条目将是 $D_t$。\n\n4.  **不等式约束 $A_{ub}, b_{ub}$**：可再生能源发电限制 $g_t^R \\leq K \\cdot CF_t \\cdot H$ 被重写为 $g_t^R - (CF_t \\cdot H)K \\leq 0$。对于 $T$ 个周期中的每一个， $A_{ub}$ 中的一行将对 $g_t^R$ 有一个系数 $1$，对 $K$ 有一个系数 $-CF_t \\cdot H$。 $b_{ub}$ 中对应的条目将是 $0$。\n\n5.  **边界**：所有决策变量都是非负的，因此 $x$ 中每个元素的下界是 $0$，上界是无穷大。\n\n程序将实现一个函数，该函数接收问题参数，构造这些矩阵和向量，并调用 `linprog`。对于每个测试用例，此函数将被调用两次：\n-   **情景 1 (日落)**：PTC 向量 $a_t$ 的构造方式是，当 $t \\leq t^{sunset}$ 时 $a_t=a$，当 $t > t^{sunset}$ 时 $a_t=0$。\n-   **情景 2 (无日落)**：PTC 向量的构造方式是，对于所有 $t$，$a_t=a$。\n\n最优容量 $K$ 是由 `linprog` 返回的解向量 `res.x` 的第一个元素，它将被提取并为每种情景存储。最终结果将被收集并按指定格式化。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_lp(T, r, H, C, v_R, c_B, a_vec, CF_vec, D_vec):\n    \"\"\"\n    Solves the capacity expansion LP for a given set of parameters.\n\n    Args:\n        T (int): Number of periods in the planning horizon.\n        r (float): Annual discount rate.\n        H (int): Number of hours in a year.\n        C (float): Capital cost of renewable technology ($/MW).\n        v_R (float): Variable cost of renewable technology ($/MWh).\n        c_B (float): Variable cost of backup technology ($/MWh).\n        a_vec (np.ndarray): Vector of PTC values for each period t ($/MWh).\n        CF_vec (np.ndarray): Vector of capacity factors for each period t.\n        D_vec (np.ndarray): Vector of energy demands for each period t (MWh).\n\n    Returns:\n        float: Optimal installed capacity K (MW).\n    \"\"\"\n    # Number of variables: 1 (for K) + T (for g_R) + T (for g_B)\n    num_vars = 1 + 2 * T\n\n    # --- Cost Vector c ---\n    # Discount factors gamma_t = (1+r)^-t for t=1,...,T\n    periods = np.arange(1, T + 1)\n    gamma_t = (1 + r) ** -periods\n\n    # Cost vector c for the objective function: min c'x\n    # x = [K, g_1^R, ..., g_T^R, g_1^B, ..., g_T^B]\n    c = np.zeros(num_vars)\n    # Coefficient for K\n    c[0] = C\n    # Coefficients for g_t^R\n    c[1:T + 1] = gamma_t * (v_R - a_vec)\n    # Coefficients for g_t^B\n    c[T + 1:] = gamma_t * c_B\n\n    # --- Equality Constraints A_eq, b_eq ---\n    # Constraint: g_t^R + g_t^B = D_t for t=1,...,T\n    A_eq = np.zeros((T, num_vars))\n    for t in range(T):\n        # Coefficient for g_{t+1}^R (index t+1)\n        A_eq[t, t + 1] = 1\n        # Coefficient for g_{t+1}^B (index T + t + 1)\n        A_eq[t, T + t + 1] = 1\n    b_eq = D_vec\n\n    # --- Inequality Constraints A_ub, b_ub ---\n    # Constraint: g_t^R = K * CF_t * H  =>  g_t^R - K * (CF_t * H) = 0\n    A_ub = np.zeros((T, num_vars))\n    for t in range(T):\n        # Coefficient for K (index 0)\n        A_ub[t, 0] = -CF_vec[t] * H\n        # Coefficient for g_{t+1}^R (index t+1)\n        A_ub[t, t + 1] = 1\n    b_ub = np.zeros(T)\n\n    # --- Bounds ---\n    # All variables are non-negative\n    bounds = (0, None)\n\n    # --- Solve LP ---\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    \n    if res.success:\n        optimal_K = res.x[0]\n        return optimal_K\n    else:\n        # Should not happen for this well-posed problem\n        return -1.0\n\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path with mid-horizon sunset)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 25, \"t_sunset\": 3, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 2 (boundary condition with early sunset and moderate PTC)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 20, \"t_sunset\": 1, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 3 (edge case with zero PTC)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 0, \"t_sunset\": 0, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 4 (significant edge case with nonuniform demand and partial sunset)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1060000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 25, \"t_sunset\": 3, \"CF_t\": 0.4, \"D_t\": [10000, 14000, 14000, 6000, 6000]\n        },\n    ]\n\n    all_results = []\n    for params in test_cases:\n        T, r, H, C, v_R, c_B = params[\"T\"], params[\"r\"], params[\"H\"], params[\"C\"], params[\"v_R\"], params[\"c_B\"]\n        a, t_sunset = params[\"a\"], params[\"t_sunset\"]\n        \n        # Ensure CF_t and D_t are numpy arrays of length T\n        if isinstance(params[\"CF_t\"], (int, float)):\n            CF_vec = np.full(T, params[\"CF_t\"])\n        else:\n            CF_vec = np.array(params[\"CF_t\"])\n            \n        if isinstance(params[\"D_t\"], (int, float)):\n            D_vec = np.full(T, params[\"D_t\"])\n        else:\n            D_vec = np.array(params[\"D_t\"])\n\n        # Scenario 1: With PTC Sunset\n        a_vec_sunset = np.array([a if t + 1 = t_sunset else 0 for t in range(T)])\n        K_sunset = solve_lp(T, r, H, C, v_R, c_B, a_vec_sunset, CF_vec, D_vec)\n\n        # Scenario 2: No PTC Sunset\n        a_vec_nosunset = np.full(T, a)\n        K_nosunset = solve_lp(T, r, H, C, v_R, c_B, a_vec_nosunset, CF_vec, D_vec)\n\n        case_results = [round(K_sunset, 3), round(K_nosunset, 3)]\n        all_results.append(case_results)\n\n    # Format the final output string\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在真实的财务模型中，税收抵免的“潜在”价值并不总能完全“实现”。一个项目能否充分享受PTC带来的优惠，取决于其是否有足够的应税收入来抵扣。本练习将深入探讨这一财务细节，通过对净经营亏损（NOL）结转的建模，精确计算项目在不同盈利情景下实际可获得的PTC价值。理解潜在价值与实现价值之间的差异，对于精确评估项目可行性和风险至关重要。",
            "id": "4114360",
            "problem": "本题要求您在一个多期情景下，根据能源系统建模中遇到的净营业亏损 (NOL) 结转规则，形式化并计算一个可再生能源项目的生产税收抵免 (PTC) 的可实现价值。请从以下基本依据出发：应税收入的定义、公司所得税的运作方式，以及税收抵免不能超过税收容量的惯例。目标是构建一个算法，该算法遵循所提供的建模规则，并输出在多个测试案例中汇总的可实现PTC和已付税款。\n\n使用以下核心定义，所有定义均以每个周期 $t$ 表示：\n- 生产税收抵免 (PTC)：一项与发电量成比例累积的法定抵免，确定性地定义为 $PTC_t^{potential} = p \\cdot G_t$，其中 $p$ 是法定抵免率（单位：美元/兆瓦时），$G_t$ 是发电量（单位：兆瓦时）。\n- 净营业亏损 (NOL)：对于周期 $t$，定义结转状态为 $NOL_t = \\max(0, -TI_t)$，其中 $TI_t$ 是抵免前的应税收入。下一周期的可用结转额为 $NOL_{t-1}$，在此建模练习中，亏损结转不累积超过一个周期。\n- 抵免实现的税收容量约束：强制要求 $PTC_t^{realized} \\le \\tau \\cdot TI_t + \\tau \\cdot NOL_{t-1}$，且 $PTC_t^{realized} \\ge 0$，其中 $\\tau$ 是以小数形式表示的公司税率。\n\n您必须从基本原理出发，实现以下步骤：\n1. 使用 $PTC_t^{potential} = p \\cdot G_t$ 计算每个周期的潜在抵免额（以美元计）。\n2. 对于每个周期 $t$，仅使用当前观察到的 $TI_t$ 更新 $NOL_t = \\max(0, -TI_t)$。\n3. 通过计算 $PTC_t^{realized} = \\min\\left(PTC_t^{potential}, \\max\\left(0, \\tau \\cdot TI_t + \\tau \\cdot NOL_{t-1}\\right)\\right)$ 来强制实现可实现性和非负性。\n4. 计算已付税款为 $Tax_t = \\max\\left(0, \\tau \\cdot \\max(0, TI_t) - PTC_t^{realized}\\right)$，确保税款不能为负。\n\n所有货币量必须以美元表示，并四舍五入到两位小数。发电量以兆瓦时表示，PTC税率 $p$ 以美元/兆瓦时表示。税率 $\\tau$ 必须以小数形式提供和使用，而不是百分比。\n\n您的程序必须处理以下测试套件，其中每个测试案例提供：\n- 一系列应税收入 $\\{TI_t\\}$（美元）。\n- 一系列发电量 $\\{G_t\\}$（兆瓦时）。\n- 税率 $\\tau$（小数）。\n- PTC税率 $p$（美元/兆瓦时）。\n- 初始结转额 $NOL_0$（美元）。\n\n测试套件：\n- 案例1（各周期抵免容量非约束性）：$\\{TI_t\\} = [100000, 120000, 90000, 110000]$，$\\{G_t\\} = [10000, 9500, 9800, 10200]$，$\\tau = 0.25$，$p = 1.5$，$NOL_0 = 0$。\n- 案例2（各周期抵免容量约束性，初始结转为零）：$\\{TI_t\\} = [100000, 120000, 90000, 110000]$，$\\{G_t\\} = [10000, 9500, 9800, 10200]$，$\\tau = 0.25$，$p = 30$，$NOL_0 = 0$。\n- 案例3（负收入，单周期结转促成未来实现）：$\\{TI_t\\} = [-50000, 30000, -10000, 0]$，$\\{G_t\\} = [1000, 1100, 800, 900]$，$\\tau = 0.21$，$p = 15$，$NOL_0 = 0$。\n- 案例4（全程应税收入为零，发电量为正）：$\\{TI_t\\} = [0, 0, 0, 0]$，$\\{G_t\\} = [500, 500, 500, 500]$，$\\tau = 0.30$，$p = 50$，$NOL_0 = 0$。\n- 案例5（正负收入交替，存在显著的结转效应）：$\\{TI_t\\} = [-40000, -5000, 20000, -30000]$，$\\{G_t\\} = [2000, 1500, 1000, 1200]$，$\\tau = 0.25$，$p = 10$，$NOL_0 = 0$。\n\n对于每个测试案例，计算两个以美元计的输出：\n- 总计可实现抵免额 $\\sum_t PTC_t^{realized}$，四舍五入到两位小数。\n- 总计已付税款 $\\sum_t Tax_t$，四舍五入到两位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试案例的结果本身就是一个格式为 $[TotalRealizedPTC,TotalTaxesPaid]$ 的双元素列表。例如：$[[x_1,y_1],[x_2,y_2],\\dots]$。请确保括号内或元素之间没有空格，并且所有值都四舍五入到两位小数。输出中的所有美元金额必须是以美元为单位且保留两位小数。",
            "solution": "该问题被认为是有效的。它为计算可再生能源项目在多个周期内的可实现生产税收抵免 (PTC) 和已付税款提供了一套自洽、数学上一致且定义明确的规则。该模型包含一个简化但定义清晰的单周期净营业亏损 (NOL) 结转机制。所提供的定义虽然是对现实世界税法的简化，但明确无误，并允许进行确定性的顺序计算。为指定的测试案例提供了所有必要的数据。该问题基于能源系统分析中的财务建模原理。\n\n解决方案需要实现一个离散时间模拟算法，该算法处理项目的一系列财务和运营数据。该算法的核心是逐期计算，它根据一组明确的公式更新项目的财务状况。任何周期 $t$ 开始时的状态由前一周期结转的净营业亏损来表征，记为 $NOL_{t-1}$。初始状态由 $NOL_0$ 给出。\n\n对于时间范围内的每个周期 $t$，给定应税收入 $TI_t$、发电量 $G_t$、公司税率 $\\tau$、法定PTC税率 $p$ 和结转额 $NOL_{t-1}$ 等输入，按顺序计算以下量：\n\n$1$. 潜在PTC被计算为发电量的直接函数：\n$$PTC_t^{potential} = p \\cdot G_t$$\n\n$2$. 确定实现税收抵免的能力。问题将此能力定义为当前周期的应税收入 $TI_t$ 和上一周期结转的亏损 $NOL_{t-1}$ 的函数。这个能力，我们称之为 $C_t$，由下式给出：\n$$C_t = \\max\\left(0, \\tau \\cdot TI_t + \\tau \\cdot NOL_{t-1}\\right)$$\n该公式意味着正应税收入和前期亏损都会创造实现抵免的能力。$\\max(0, \\dots)$ 函数确保此能力不能为负。\n\n$3$. 该周期的可实现PTC，$PTC_t^{realized}$，是潜在抵免额和可用抵免能力中的较小者：\n$$PTC_t^{realized} = \\min\\left(PTC_t^{potential}, C_t\\right)$$\n这强制执行了抵免额不能超过税收容量的约束。\n\n$4$. 计算该周期的已付税款，$Tax_t$。应纳税额基于当前周期应税收入的正值部分，即 $\\tau \\cdot \\max(0, TI_t)$，然后减去可实现的PTC。已付税款不能为负。\n$$Tax_t = \\max\\left(0, \\tau \\cdot \\max(0, TI_t) - PTC_t^{realized}\\right)$$\n\n$5$. 计算要结转到下一周期的NOL。它被定义为当前周期亏损的绝对值（如有）。该值成为后续周期的状态变量。\n$$NOL_t = \\max(0, -TI_t)$$\n这个 $NOL_t$ 将在周期 $t+1$ 的计算中用作 $NOL_{t-1}$ 的值。\n\n该算法对给定的测试案例遍历所有周期 $t = 1, 2, \\ldots, T$。总计可实现PTC是所有周期内可实现PTC的总和，即 $\\sum_{t=1}^{T} PTC_t^{realized}$。类似地，总计已付税款是 $\\sum_{t=1}^{T} Tax_t$ 的总和。这两个总和，四舍五入到两位小数，构成了每个案例的最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Processes a suite of test cases to calculate total realized PTC and taxes paid\n    based on a specified multi-period tax model with NOL carryforward.\n    \"\"\"\n    test_cases = [\n        # Case 1 (nonbinding credit capacity)\n        {\n            \"ti_seq\": [100000, 120000, 90000, 110000],\n            \"g_seq\": [10000, 9500, 9800, 10200],\n            \"tau\": 0.25,\n            \"p\": 1.5,\n            \"nol_0\": 0.0\n        },\n        # Case 2 (binding credit capacity)\n        {\n            \"ti_seq\": [100000, 120000, 90000, 110000],\n            \"g_seq\": [10000, 9500, 9800, 10200],\n            \"tau\": 0.25,\n            \"p\": 30.0,\n            \"nol_0\": 0.0\n        },\n        # Case 3 (negative income, carryforward effect)\n        {\n            \"ti_seq\": [-50000, 30000, -10000, 0],\n            \"g_seq\": [1000, 1100, 800, 900],\n            \"tau\": 0.21,\n            \"p\": 15.0,\n            \"nol_0\": 0.0\n        },\n        # Case 4 (zero taxable income)\n        {\n            \"ti_seq\": [0, 0, 0, 0],\n            \"g_seq\": [500, 500, 500, 500],\n            \"tau\": 0.30,\n            \"p\": 50.0,\n            \"nol_0\": 0.0\n        },\n        # Case 5 (alternating income, nontrivial carryforward)\n        {\n            \"ti_seq\": [-40000, -5000, 20000, -30000],\n            \"g_seq\": [2000, 1500, 1000, 1200],\n            \"tau\": 0.25,\n            \"p\": 10.0,\n            \"nol_0\": 0.0\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        ti_seq = case[\"ti_seq\"]\n        g_seq = case[\"g_seq\"]\n        tau = case[\"tau\"]\n        p = case[\"p\"]\n        nol_carryforward = case[\"nol_0\"]\n\n        total_realized_ptc = 0.0\n        total_taxes_paid = 0.0\n\n        for i in range(len(ti_seq)):\n            ti_t = ti_seq[i]\n            g_t = g_seq[i]\n\n            # 1. Compute potential PTC\n            ptc_potential = p * g_t\n\n            # 2. Compute tax capacity for credit realization\n            tax_capacity = np.maximum(0.0, tau * ti_t + tau * nol_carryforward)\n\n            # 3. Compute realized PTC\n            ptc_realized = np.minimum(ptc_potential, tax_capacity)\n\n            # 4. Compute taxes paid\n            tax_liability_pre_credits = tau * np.maximum(0.0, ti_t)\n            tax_paid = np.maximum(0.0, tax_liability_pre_credits - ptc_realized)\n\n            # 5. Update NOL for the next period\n            nol_carryforward = np.maximum(0.0, -ti_t)\n\n            # Aggregate results\n            total_realized_ptc += ptc_realized\n            total_taxes_paid += tax_paid\n\n        # Round final aggregated values to two decimals\n        rounded_ptc = round(total_realized_ptc, 2)\n        rounded_tax = round(total_taxes_paid, 2)\n        \n        all_results.append([rounded_ptc, rounded_tax])\n    \n    # Format the final output string as specified\n    formatted_results = [f\"[{res[0]:.2f},{res[1]:.2f}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}