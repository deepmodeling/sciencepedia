{
    "hands_on_practices": [
        {
            "introduction": "在构建能源系统模型时，确保所有物理和经济量的单位一致性是至关重要的第一步。政策激励（如生产税收抵免）的报价单位（例如，美元/千瓦时）常常与模型中的能量单位（例如，兆瓦时）不匹配。本练习旨在训练您从基本定义出发，推导出正确的换算系数，以保证模型中财务计算的准确性，这是建立任何可靠模型的基石 。",
            "id": "4114288",
            "problem": "一个能源系统模型以兆瓦时（$\\mathrm{MWh}$）为单位表示发电量。一项政策包含生产税收抵免（PTC），其报价费率为 $x$ 美元/千瓦时（$\\mathrm{USD}/\\mathrm{kWh}$）。该模型通过将单位费率与产生的能量相乘来计算总抵免额。为确保科学上的一致性，根据发电量计算出的抵免额必须不因能量单位表示的选择而改变。\n\n从功率和能量单位的定义，以及单位费率与总抵免额之间的线性关系出发，推导出以美元/兆瓦时（$\\mathrm{USD}/\\mathrm{MWh}$）为单位的费率 $s$。当该费率应用于以兆瓦时（$\\mathrm{MWh}$）计量的发电量时，应产生相同的总抵免额。您的推导必须使用基本单位定义和线性抵免泛函的结构来证明从 $\\mathrm{kWh}$ 到 $\\mathrm{MWh}$ 的单位转换是合理的。\n\n请提供一个用 $x$ 表示 $s$ 的单一闭式解析表达式。不需要进行数值近似。请以美元/兆瓦时（$\\mathrm{USD}/\\mathrm{MWh}$）为单位表示最终费率 $s$。最终答案必须是单个表达式。",
            "solution": "问题要求从一个给定的以美元/千瓦时（$\\mathrm{USD}/\\mathrm{kWh}$）为单位的费率 $x$，推导出一个新的以美元/兆瓦时（$\\mathrm{USD}/\\mathrm{MWh}$）为单位的生产税收抵免费率 $s$。基本约束是，对给定能量产量计算出的总抵免额必须不因能量单位的选择而改变。推导必须基于单位定义的第一性原理以及抵免计算的线性性质。\n\n设 $E$ 表示产生的特定能量。问题陈述总抵免额（我们记为 $C$）是所产生能量的线性泛函。\n\n当能量 $E$ 以千瓦时（$\\mathrm{kWh}$）计量时，其数值为 $E_{\\mathrm{kWh}}$。单位费率给定为 $x$，单位为 $\\mathrm{USD}/\\mathrm{kWh}$。总抵免额计算如下：\n$$C = x \\cdot E_{\\mathrm{kWh}}$$\n\n当相同能量 $E$ 以兆瓦时（$\\mathrm{MWh}$）计量时，其数值为 $E_{\\mathrm{MWh}}$。此时的单位费率是未知值 $s$，单位为 $\\mathrm{USD}/\\mathrm{MWh}$。总抵免额计算如下：\n$$C = s \\cdot E_{\\mathrm{MWh}}$$\n\n不变性核心原则规定，无论计算使用何种单位，总抵免额 $C$ 都必须相同。因此，我们可以令 $C$ 的两个表达式相等：\n$$s \\cdot E_{\\mathrm{MWh}} = x \\cdot E_{\\mathrm{kWh}}$$\n\n为了用 $x$ 解出 $s$，我们必须建立数值 $E_{\\mathrm{MWh}}$ 和 $E_{\\mathrm{kWh}}$ 之间的数学关系。这种关系源自能量单位 $\\mathrm{kWh}$ 和 $\\mathrm{MWh}$ 的定义。\n\n前缀“千”（k）和“兆”（M）是标准的国际单位制（SI）前缀，分别表示因子 $10^3$ 和 $10^6$。设 $\\mathrm{Wh}$ 表示瓦时的基本能量单位。\n千瓦时和兆瓦时的定义如下：\n$$1 \\ \\mathrm{kWh} = 10^3 \\ \\mathrm{Wh}$$\n$$1 \\ \\mathrm{MWh} = 10^6 \\ \\mathrm{Wh}$$\n\n从这两个定义，我们可以建立 $\\mathrm{MWh}$ 和 $\\mathrm{kWh}$ 之间的直接关系。我们可以从第一个方程中用 $\\mathrm{kWh}$ 表示 $\\mathrm{Wh}$：\n$$1 \\ \\mathrm{Wh} = 10^{-3} \\ \\mathrm{kWh}$$\n将此代入第二个方程，即可得到 $\\mathrm{MWh}$ 和 $\\mathrm{kWh}$ 之间的转换因子：\n$$1 \\ \\mathrm{MWh} = 10^6 \\cdot (10^{-3} \\ \\mathrm{kWh}) = 10^{(6-3)} \\ \\mathrm{kWh} = 10^3 \\ \\mathrm{kWh}$$\n因此，我们得到单位关系：\n$$1 \\ \\mathrm{MWh} = 1000 \\ \\mathrm{kWh}$$\n\n现在，我们将此关系应用于给定能量 $E$ 的数值 $E_{\\mathrm{MWh}}$ 和 $E_{\\mathrm{kWh}}$。能量 $E$ 可以表示为其数值与其单位的乘积：\n$$E = E_{\\mathrm{MWh}} \\ [\\mathrm{MWh}] = E_{\\mathrm{kWh}} \\ [\\mathrm{kWh}]$$\n使用单位关系 $1 \\ [\\mathrm{MWh}] = 1000 \\ [\\mathrm{kWh}]$，我们替换单位 $[\\mathrm{MWh}]$：\n$$E_{\\mathrm{MWh}} \\cdot (1000 \\ [\\mathrm{kWh}]) = E_{\\mathrm{kWh}} \\ [\\mathrm{kWh}]$$\n通过消去方程两边的共同单位 $[\\mathrm{kWh}]$，我们得到数值之间的关系：\n$$1000 \\cdot E_{\\mathrm{MWh}} = E_{\\mathrm{kWh}}$$\n这个结果是合乎逻辑的：因为千瓦时是比兆瓦时更小的能量单位，所以当以 $\\mathrm{kWh}$ 计量时，给定能量的数值将比以 $\\mathrm{MWh}$ 计量时大 $1000$ 倍。\n\n最后，我们将这个关于 $E_{\\mathrm{kWh}}$ 的关系代回到我们的抵免不变性方程中：\n$$s \\cdot E_{\\mathrm{MWh}} = x \\cdot (1000 \\cdot E_{\\mathrm{MWh}})$$\n对于任何非零的能量产量（$E_{\\mathrm{MWh}} \\neq 0$），我们可以将方程两边同时除以 $E_{\\mathrm{MWh}}$：\n$$s = 1000 \\cdot x$$\n这就是所求的用费率 $x$ 表示费率 $s$ 的闭式表达式。单位是一致的，因为因子 $1000$ 隐含了 $\\mathrm{kWh}/\\mathrm{MWh}$ 的单位：\n$$[s] = \\left[\\frac{\\mathrm{USD}}{\\mathrm{kWh}}\\right] \\cdot \\left[\\frac{\\mathrm{kWh}}{\\mathrm{MWh}}\\right] = \\left[\\frac{\\mathrm{USD}}{\\mathrm{MWh}}\\right]$$\n因此，推导出的费率 $s = 1000x$ 的单位将是 $\\mathrm{USD}/\\mathrm{MWh}$，这与问题陈述的要求一致。",
            "answer": "$$\\boxed{1000x}$$"
        },
        {
            "introduction": "能源系统优化模型通常基于线性规划，但这给表示“开关”式的条件逻辑带来了挑战。例如，当发电机组仅在符合资格时才能获得税收抵免，这在数学上表现为二进制资格变量与连续发电量变量的乘积，构成了一个非线性项。本练习将引导您掌握一种关键的线性化技术，将此类非线性关系转化为混合整数线性规划（MILP）框架下的线性约束，这是对复杂政策进行精确建模的核心技能 。",
            "id": "4114298",
            "problem": "一位能源系统规划师希望在一个混合整数线性规划中表示发电机的生产税收抵免 (PTC) 收入。对于每个机组索引 $i$ 和时间索引 $t$，定义一个二元资格变量 $a_{i,t}$，其定义域为 $a_{i,t} \\in \\{0,1\\}$，一个连续生产变量 $q_{i,t}$，其界限为 $L_{i,t} \\le q_{i,t} \\le U_{i,t}$，单位为兆瓦时 (MWh)，以及一个连续辅助变量 $y_{i,t}$，用于表示乘积 $y_{i,t} = a_{i,t} q_{i,t}$。设 PTC 税率为 $c_{i,t}$，单位为美元/兆瓦时 (USD/MWh)，并定义收入 $r_{i,t} = c_{i,t} y_{i,t}$，单位为美元 (USD)。目标是使用能够保持计算易行性的线性约束来表达 $a_{i,t}$ 和 $q_{i,t}$ 之间的乘积关系。\n\n仅从基本事实和定义（$a_{i,t}$ 的二元域、$q_{i,t}$ 的区间界限、混合整数线性规划中约束和目标的线性）出发，使用标准的大M (big-M) 或指示器约束逻辑，推导出一组线性约束，对所有可行的 $(a_{i,t}, q_{i,t})$ 精确地强制实现 $y_{i,t} = a_{i,t} q_{i,t}$。您的推导必须证明如何从已知界限 $L_{i,t}$ 和 $U_{i,t}$ 中选择最小且紧凑的常数，以保证计算的易行性。然后，通过推导每个案例中约束所蕴含的唯一 $y_{i,t}$ 值，实施所推导的表示法来计算特定测试案例的收入 $r_{i,t}$。\n\n实现一个程序，对于每个测试案例 $(L, U, a, q, c)$，根据您推导的线性约束计算出所蕴含的唯一 $y$ 值，然后计算 $r = c \\cdot y$。将 $r$ 表示为美元 (USD)，并四舍五入到两位小数的浮点数。\n\n使用以下参数值测试套件，每个案例以 $(L, U, a, q, c)$ 的形式给出，其中 $L$ 和 $U$ 的单位是兆瓦时 (MWh)，$a \\in \\{0,1\\}$，$q$ 的单位是兆瓦时 (MWh)，$c$ 的单位是美元/兆瓦时 (USD/MWh)：\n\n- 案例 1：$(L,U,a,q,c) = (0, 150, 0, 120, 26)$\n- 案例 2：$(L,U,a,q,c) = (0, 120, 1, 85, 26)$\n- 案例 3：$(L,U,a,q,c) = (10, 50, 0, 40, 26)$\n- 案例 4：$(L,U,a,q,c) = (10, 50, 1, 25, 26)$\n- 案例 5：$(L,U,a,q,c) = (0, 250, 1, 250, 15.75)$\n- 案例 6：$(L,U,a,q,c) = (5, 5, 1, 5, 30)$\n- 案例 7：$(L,U,a,q,c) = (0, 0, 1, 0, 26)$\n- 案例 8：$(L,U,a,q,c) = (0, 200, 0, 0, 26)$\n\n您的程序应生成单行输出，其中包含按顺序排列的各案例收入，形式为用方括号括起来的逗号分隔列表，例如 $[r_1,r_2,\\dots,r_8]$。每个 $r_k$ 必须是如上所述的、四舍五入到两位小数并以美元表示的浮点数。",
            "solution": "在混合整数线性规划 (MILP) 中，表示一个二元变量和一个连续变量的乘积是一个典型的任务。所述问题是有效的：它在科学上基于成熟的数学优化技术，问题陈述清晰且提供了所有必要信息，其表述是客观的。\n\n目标是建立一组线性约束来表示非线性关系 $y_{i,t} = a_{i,t} q_{i,t}$，其中 $a_{i,t} \\in \\{0, 1\\}$ 是一个二元变量，$q_{i,t}$ 是一个由 $L_{i,t} \\le q_{i,t} \\le U_{i,t}$ 界定的连续变量。我们寻求对一个辅助连续变量 $y_{i,t}$ 强制实施此关系。假设所有物理量均为非负，因此 $0 \\le L_{i,t} \\le q_{i,t} \\le U_{i,t}$。\n\n推导过程从乘积的定义开始，根据二元变量 $a_{i,t}$ 的值，可以将其分解为两个逻辑条件：\n1. 如果 $a_{i,t} = 1$，关系变为 $y_{i,t} = q_{i,t}$。\n2. 如果 $a_{i,t} = 0$，关系变为 $y_{i,t} = 0$。\n\n我们可以构建线性约束来强制实施这两个条件。这是通过构造不等式来实现的，这些不等式利用 $q_{i,t}$ 的已知界限 $L_{i,t}$ 和 $U_{i,t}$，正确地界定变量 $y_{i,t}$ 和差值 $y_{i,t} - q_{i,t}$。这是一种被称为“大M”(big-M) 公式化的标准方法，或者更准确地说，是 McCormick 松弛，它在这种特定情况下提供了精确的凸包表示。\n\n**线性约束的推导**\n\n我们将推导四个线性不等式。前两个将直接约束 $y_{i,t}$，后两个将约束差值 $y_{i,t} - q_{i,t}$。\n\n**约束 1：$y_{i,t}$ 的上界**\n- 如果 $a_{i,t} = 1$，则 $y_{i,t} = q_{i,t}$，且由于 $q_{i,t} \\le U_{i,t}$，我们必须有 $y_{i,t} \\le U_{i,t}$。\n- 如果 $a_{i,t} = 0$，则 $y_{i,t} = 0$。\n一个捕捉这两种情况的单一不等式是：\n$$y_{i,t} \\le U_{i,t} a_{i,t}$$\n如果 $a_{i,t}=1$，这得到 $y_{i,t} \\le U_{i,t}$。如果 $a_{i,t}=0$，它得到 $y_{i,t} \\le 0$。由于产量是非负的，$y_{i,t}$ 也必须是非负的，从而迫使 $y_{i,t}=0$。\n\n**约束 2：$y_{i,t}$ 的下界**\n- 如果 $a_{i,t} = 1$，则 $y_{i,t} = q_{i,t}$，且由于 $q_{i,t} \\ge L_{i,t}$，我们必须有 $y_{i,t} \\ge L_{i,t}$。\n- 如果 $a_{i,t} = 0$，则 $y_{i,t} = 0$。\n一个捕捉这两种情况的单一不等式是：\n$$y_{i,t} \\ge L_{i,t} a_{i,t}$$\n如果 $a_{i,t}=1$，这得到 $y_{i,t} \\ge L_{i,t}$。如果 $a_{i,t}=0$，它得到 $y_{i,t} \\ge 0$。\n\n我们来测试这两个约束。如果 $a_{i,t}=0$，我们有 $y_{i,t} \\le 0$ 和 $y_{i,t} \\ge 0$，这正确地迫使 $y_{i,t}=0$。如果 $a_{i,t}=1$，我们有 $L_{i,t} \\le y_{i,t} \\le U_{i,t}$。这是必要的，但不足以强制 $y_{i,t}=q_{i,t}$。我们需要进一步的约束。\n\n**约束 3：差值 $y_{i,t} - q_{i,t}$ 的上界**\n- 如果 $a_{i,t} = 1$，则 $y_{i,t} - q_{i,t} = 0$。\n- 如果 $a_{i,t} = 0$，则 $y_{i,t}=0$，所以差值为 $y_{i,t} - q_{i,t} = -q_{i,t}$。由于 $L_{i,t} \\le q_{i,t} \\le U_{i,t}$，差值的界限为 $-U_{i,t} \\le -q_{i,t} \\le -L_{i,t}$。差值的上界是 $-L_{i,t}$。\n我们需要一个形式为 $y_{i,t} - q_{i,t} \\le M$ 的不等式，其中 $M$ 取决于 $a_{i,t}$。设 $M = k(1-a_{i,t})$。当 $a_{i,t}=1$ 时，$M=0$。当 $a_{i,t}=0$ 时，$M=k$。在这种情况下，$k$ 需要至少是 $y_{i,t}-q_{i,t}$ 的最大值，即 $-L_{i,t}$。所以我们可以设 $k = -L_{i,t}$。该约束变为 $y_{i,t} - q_{i,t} \\le -L_{i,t}(1-a_{i,t})$，重新整理后得到：\n$$y_{i,t} - q_{i,t} + L_{i,t}(1-a_{i,t}) \\le 0$$\n如果 $a_{i,t}=1$，这得到 $y_{i,t} - q_{i,t} \\le 0$，或 $y_{i,t} \\le q_{i,t}$。\n如果 $a_{i,t}=0$，这得到 $y_{i,t} - q_{i,t} + L_{i,t} \\le 0$。由于 $y_{i,t}=0$，这变为 $-q_{i,t} + L_{i,t} \\le 0 \\implies q_{i,t} \\ge L_{i,t}$，这与 $q_{i,t}$ 的界限是一致的。\n\n**约束 4：差值 $y_{i,t} - q_{i,t}$ 的下界**\n- 如果 $a_{i,t} = 1$，下界是 $0$。\n- 如果 $a_{i,t} = 0$，下界是 $-U_{i,t}$。\n使用类似的逻辑，我们可以构建约束 $y_{i,t} - q_{i,t} \\ge -U_{i,t}(1-a_{i,t})$，重新整理后得到：\n$$y_{i,t} - q_{i,t} + U_{i,t}(1-a_{i,t}) \\ge 0$$\n如果 $a_{i,t}=1$，这得到 $y_{i,t} - q_{i,t} \\ge 0$，或 $y_{i,t} \\ge q_{i,t}$。\n如果 $a_{i,t}=0$，这得到 $y_{i,t} - q_{i,t} + U_{i,t} \\ge 0$。由于 $y_{i,t}=0$，这变为 $-q_{i,t} + U_{i,t} \\ge 0 \\implies q_{i,t} \\le U_{i,t}$，这也是一致的。\n\n**完整公式**\n精确模拟 $y_{i,t} = a_{i,t} q_{i,t}$ 的四个线性约束的完整集合是：\n1. $$y_{i,t} \\le U_{i,t} a_{i,t}$$\n2. $$y_{i,t} \\ge L_{i,t} a_{i,t}$$\n3. $$y_{i,t} - q_{i,t} \\le -L_{i,t} (1 - a_{i,t})$$\n4. $$y_{i,t} - q_{i,t} \\ge -U_{i,t} (1 - a_{i,t})$$\n\n当 $a_{i,t}=1$ 时，约束 3 和 4 结合起来强制 $y_{i,t} = q_{i,t}$。当 $a_{i,t}=0$ 时，约束 1 和 2 结合起来强制 $y_{i,t} = 0$。这个公式是精确的，并且使用了最紧凑的可能常数系数（$L_{i,t}$ 和 $U_{i,t}$），通过提供一个紧凑的线性规划松弛，提高了最终 MILP 的计算易行性。\n\n**在测试案例中的应用**\n问题要求为几个给定了 $L, U, a, q$ 和 $c$ 值的测试案例计算收入 $r_{i,t} = c_{i,t} y_{i,t}$。如推导所示，对于任何给定的可行对 $(a_{i,t}, q_{i,t})$，推导出的约束唯一地确定了 $y_{i,t}$ 的值。\n- 如果 $a_{i,t} = 0$，则 $y_{i,t}=0$。\n- 如果 $a_{i,t} = 1$，则 $y_{i,t}=q_{i,t}$。\n这正是原始的非线性定义 $y_{i,t} = a_{i,t} q_{i,t}$。因此，为了找到每个测试案例所蕴含的 $y_{i,t}$ 值和由此产生的收入，我们可以直接计算乘积。在特定测试案例的上下文中，为简单起见，省略了索引 $i,t$。对于每个案例 $(L, U, a, q, c)$，我们计算 $y = a \\cdot q$，然后计算 $r = c \\cdot y$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes PTC revenues for a series of test cases based on the\n    direct product of a binary and a continuous variable.\n    \"\"\"\n    test_cases = [\n        (0, 150, 0, 120, 26),\n        (0, 120, 1, 85, 26),\n        (10, 50, 0, 40, 26),\n        (10, 50, 1, 25, 26),\n        (0, 250, 1, 250, 15.75),\n        (5, 5, 1, 5, 30),\n        (0, 0, 1, 0, 26),\n        (0, 200, 0, 0, 26)\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack the parameters for the current test case.\n        _L, _U, a, q, c = case\n\n        # The solution demonstrates that the linear constraints uniquely determine\n        # the value of the auxiliary variable y to be the product of the binary\n        # variable 'a' and the continuous variable 'q'.\n        # If a = 0, then y = 0.\n        # If a = 1, then y = q.\n        # This is equivalent to y = a * q.\n        \n        # We can therefore compute y directly.\n        y = float(a) * float(q)\n        \n        # The revenue r is then the product of the PTC rate c and the\n        # production quantity receiving the credit, y.\n        revenue = float(c) * y\n        \n        # The problem requires the revenue to be rounded to two decimal places\n        # and formatted as a floating-point number.\n        results.append(f\"{revenue:.2f}\")\n\n    # The final output must be a single line containing a comma-separated list\n    # of the results, enclosed in square brackets.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "掌握了如何正确表示税收抵免后，我们便可将其应用于动态规划问题，以评估政策的长期影响。现实世界中的能源政策通常具有“日落条款”，即在未来某个时间点到期，这种政策的有限性深刻影响着长期的投资决策。本练习将指导您建立一个容量扩张模型，通过对比有日落条款的临时性 PTC 与永久性 PTC 对可再生能源投资规模的影响，来量化分析政策稳定性在能源转型中的关键作用 。",
            "id": "4114372",
            "problem": "考虑一个简化的容量扩张规划问题，该问题针对单一新型可再生能源技术，旨在满足外生的年度能源需求。投资决策是从一个私人投资者的角度建模的，该投资者旨在最大化净现值，这等同于最小化净现值成本。该模型必须包含带有立法日落条款的生产税收抵免（PTC）。规划期包含 $T$ 个年度周期，由 $t \\in \\{1,2,\\dots,T\\}$ 索引。设年折现率为 $r$，每期折现因子为 $\\gamma_t = (1+r)^{-t}$。该可再生能源技术的资本成本为 $C$ 美元/兆瓦装机容量，可变运营成本为 $v_R$ 美元/兆瓦时，具有时变容量因子 $CF_t \\in [0,1]$，并且在周期 $t$ 内最多可产生 $g_t^R \\leq K \\cdot CF_t \\cdot H$ 兆瓦时的电能，其中 $K$ 是代表装机容量（单位为兆瓦）的决策变量， $H$ 是一年的小时数。未由可再生能源技术供应的能源由备用技术满足，其可变成本为 $c_B$ 美元/兆瓦时，且无容量限制。\n\n生产税收抵免（PTC）为周期 $t$ 内的每兆瓦时可再生能源发电支付 $a_t$ 美元。为包含立法日落条款，规定当 $t \\leq t^{sunset}$ 时 $a_t = a$，当 $t > t^{sunset}$ 时 $a_t = 0$，其中 $t^{sunset}$ 是一个满足 $0 \\leq t^{sunset} \\leq T$ 的整数。每个周期 $t$ 需要精确满足的年度能源需求为 $D_t$ 兆瓦时。假设所有决策变量均为非负，且每个周期都精确满足需求。\n\n从折现现金流估值和完全竞争下的静态理性选择原则出发，将该决策问题构建为一个线性优化问题，该问题在满足物理可行性约束的条件下，最小化总折现系统成本。总折现系统成本（使用时间0的现值）必须包括一次性资本投资成本和两种技术的折现净可变成本，其中PTC在适用周期内降低了可再生能源发电的有效可变成本。\n\n您的程序必须：\n- 实现此模型，并计算每个测试用例在两种情景下的最优装机容量 $K$（单位为兆瓦）：(i) 存在立法日落条款，以及 (ii) 不存在日落条款，即对于所有 $t \\in \\{1,\\dots,T\\}$，$a_t = a$。\n- 使用线性规划求解器获取最优决策变量。\n- 将最终容量以兆瓦为单位表示为浮点数，并四舍五入到三位小数。\n\n在整个过程中必须遵守物理单位：资本成本单位为美元/兆瓦（$\\$$/MW），可变成本单位为美元/兆瓦时（$\\$$/MWh），能源单位为兆瓦时（MWh），容量单位为兆瓦（MW），时间单位为小时/年（h/year）。不使用角度。所有小数答案必须是十进制数，而不是分数。\n\n测试套件：\n使用以下四个科学上一致的测试用例，每个用例由参数 $(T, r, H, C, v_R, c_B, a, t^{sunset}, \\{CF_t\\}_{t=1}^T, \\{D_t\\}_{t=1}^T)$ 定义。\n\n- 案例1（正常路径，规划期中段有日落条款）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 25$ $\\$$/MWh, $t^{sunset} = 3$, 对所有 $t$, $CF_t = 0.4$, 对所有 $t$, $D_t = 14000$ MWh。\n\n- 案例2（边界条件，早期日落条款和中等PTC）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 20$ $\\$$/MWh, $t^{sunset} = 1$, 对所有 $t$, $CF_t = 0.4$, 对所有 $t$, $D_t = 14000$ MWh。\n\n- 案例3（边缘案例，零PTC）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 0$ $\\$$/MWh, $t^{sunset} = 0$, 对所有 $t$, $CF_t = 0.4$, 对所有 $t$, $D_t = 14000$ MWh。\n\n- 案例4（重要边缘案例，非均匀需求和部分日落条款）：\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1060000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 25$ $\\$$/MWh, $t^{sunset} = 3$, 对所有 $t$, $CF_t = 0.4$, $D_t = [10000, 14000, 14000, 6000, 6000]$ MWh。\n\n要求的最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，本身是一个包含两个浮点数（单位为兆瓦）的列表 $[K^{sunset}, K^{nosunset}]$，每个浮点数四舍五入到三位小数。例如，输出必须类似于 $[[K_1^{sunset},K_1^{nosunset}],[K_2^{sunset},K_2^{nosunset}],[K_3^{sunset},K_3^{nosunset}],[K_4^{sunset},K_4^{nosunset}]]$，单位默认为兆瓦（MW）。",
            "solution": "该问题要求构建并求解一个用于可再生能源容量扩张决策的线性优化模型。该模型旨在最小化在规划期内满足给定年度能源需求的净现值成本，考虑对可再生能源技术进行单次投资，并辅以一个无约束的备用电源。该模型必须包含一个可能因立法日落条款而到期的生产税收抵免（PTC）。\n\n### 原理与公式化\n\n该问题是从一个理性投资者的角度构建的，他在时间 $t=0$ 做出决策以最大化净现值，这等同于最小化总折现成本。折现现金流分析的原理是其核心。\n\n#### 决策变量\n在时间 $t=0$ 的投资决策是安装的可再生能源资源容量：\n- $K$: 已安装的可再生能源容量（单位为MW）。\n\n对于每个时间周期 $t \\in \\{1, 2, \\dots, T\\}$，存在关于从每种能源产生多少能量的运营决策：\n- $g_t^R$: 周期 $t$ 内的可再生能源发电量（单位为MWh）。\n- $g_t^B$: 周期 $t$ 内的备用能源发电量（单位为MWh）。\n\n所有决策变量都受非负约束：$K \\geq 0$，$g_t^R \\geq 0$，$g_t^B \\geq 0$。\n\n#### 目标函数\n目标是最小化折算至时间 $t=0$ 的现值的总系统成本。总成本包括前期资本支出和规划期 $T$ 内的净运营成本流。\n\n1.  **资本成本**：可再生能源容量的一次性投资成本为 $C \\cdot K$，发生在 $t=0$。其现值就是 $C \\cdot K$。\n\n2.  **运营成本**：在每个周期 $t$，发电成本是可再生能源和备用能源成本的总和。PTC提供信贷，有效降低了可再生能源的发电成本。周期 $t$ 的净运营成本为 $(v_R \\cdot g_t^R) + (c_B \\cdot g_t^B) - (a_t \\cdot g_t^R)$。\n\n周期 $t$ 的运营成本的现值使用折现因子 $\\gamma_t = (1+r)^{-t}$ 计算。对所有周期求和，总折现运营成本为 $\\sum_{t=1}^{T} \\gamma_t \\left( (v_R - a_t) g_t^R + c_B g_t^B \\right)$。\n\n需要最小化的完整目标函数是资本成本与总折现运营成本之和：\n$$ \\min_{K, g_t^R, g_t^B} \\quad Z = C \\cdot K + \\sum_{t=1}^{T} \\gamma_t \\left[ (v_R - a_t) g_t^R + c_B g_t^B \\right] $$\n\n#### 约束条件\n决策受到物理和市场约束的限制。\n\n1.  **需求满足**：对于每个周期 $t$，总发电量必须精确满足指定的需求 $D_t$。\n    $$ g_t^R + g_t^B = D_t \\quad \\forall t \\in \\{1, \\dots, T\\} $$\n\n2.  **可再生能源发电限制**：在任何周期 $t$，可再生能源技术的输出不能超过其物理潜力，该潜力由装机容量 $K$、时变容量因子 $CF_t$ 和一年中的总小时数 $H$ 决定。\n    $$ g_t^R \\leq K \\cdot CF_t \\cdot H \\quad \\forall t \\in \\{1, \\dots, T\\} $$\n\n这个完整的公式——一个线性目标函数受线性等式和不等式约束——是一个线性规划（LP）问题。\n\n### 求解的算法设计\n\n该问题将使用 `scipy.optimize` 库中的 `linprog` 函数来求解，该函数设计用于求解以下标准形式的LP问题：\n$$ \\min_x c^T x \\quad \\text{subject to} \\quad A_{ub} x \\leq b_{ub}, \\quad A_{eq} x = b_{eq}, \\quad \\text{and bounds on } x. $$\n\n为了应用此求解器，我们必须将我们的模型映射到这个标准形式。\n\n1.  **决策向量 $x$**：决策变量被排成一个单独的列向量 $x$。我们使用以下顺序：\n    $$ x = [K, g_1^R, \\dots, g_T^R, g_1^B, \\dots, g_T^B]^T $$\n    向量 $x$ 总共有 $1 + 2T$ 个元素。\n\n2.  **成本向量 $c$**：目标函数的系数被放入向量 $c$ 中，与 $x$ 中的顺序相匹配。\n    $$ c = [C, \\gamma_1(v_R-a_1), \\dots, \\gamma_T(v_R-a_T), \\gamma_1 c_B, \\dots, \\gamma_T c_B]^T $$\n\n3.  **等式约束 $A_{eq}, b_{eq}$**：需求满足约束 $g_t^R + g_t^B = D_t$ 被编码在矩阵 $A_{eq}$ 和向量 $b_{eq}$ 中。对于 $T$ 个周期中的每一个， $A_{eq}$ 中的一行在对应于 $g_t^R$ 的列中有一个 $1$，在对应于 $g_t^B$ 的列中也有一个 $1$。 $b_{eq}$ 中相应的条目将是 $D_t$。\n\n4.  **不等式约束 $A_{ub}, b_{ub}$**：可再生能源发电限制 $g_t^R \\leq K \\cdot CF_t \\cdot H$ 被重写为 $g_t^R - (CF_t \\cdot H)K \\leq 0$。对于 $T$ 个周期中的每一个， $A_{ub}$ 中的一行将对 $g_t^R$ 有一个系数 $1$，对 $K$ 有一个系数 $-CF_t \\cdot H$。 $b_{ub}$ 中相应的条目将是 $0$。\n\n5.  **边界**：所有决策变量都是非负的，所以 $x$ 中每个元素的下界是 $0$，上界是无穷大。\n\n该程序将实现一个函数，该函数接收问题参数，构建这些矩阵和向量，并调用 `linprog`。对于每个测试用例，该函数将被调用两次：\n-   **情景1（日落条款）**：PTC向量 $a_t$ 的构建方式为：当 $t \\leq t^{sunset}$ 时 $a_t=a$，当 $t > t^{sunset}$ 时 $a_t=0$。\n-   **情景2（无日落条款）**：PTC向量的构建方式为：对所有 $t$，$a_t=a$。\n\n最优容量 $K$ 是由 `linprog` 返回的解向量 `res.x` 的第一个元素，将被提取并为每种情景存储。最终结果将按规定格式收集和格式化。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_lp(T, r, H, C, v_R, c_B, a_vec, CF_vec, D_vec):\n    \"\"\"\n    Solves the capacity expansion LP for a given set of parameters.\n\n    Args:\n        T (int): Number of periods in the planning horizon.\n        r (float): Annual discount rate.\n        H (int): Number of hours in a year.\n        C (float): Capital cost of renewable technology ($/MW).\n        v_R (float): Variable cost of renewable technology ($/MWh).\n        c_B (float): Variable cost of backup technology ($/MWh).\n        a_vec (np.ndarray): Vector of PTC values for each period t ($/MWh).\n        CF_vec (np.ndarray): Vector of capacity factors for each period t.\n        D_vec (np.ndarray): Vector of energy demands for each period t (MWh).\n\n    Returns:\n        float: Optimal installed capacity K (MW).\n    \"\"\"\n    # Number of variables: 1 (for K) + T (for g_R) + T (for g_B)\n    num_vars = 1 + 2 * T\n\n    # --- Cost Vector c ---\n    # Discount factors gamma_t = (1+r)^-t for t=1,...,T\n    periods = np.arange(1, T + 1)\n    gamma_t = (1 + r) ** -periods\n\n    # Cost vector c for the objective function: min c'x\n    # x = [K, g_1^R, ..., g_T^R, g_1^B, ..., g_T^B]\n    c = np.zeros(num_vars)\n    # Coefficient for K\n    c[0] = C\n    # Coefficients for g_t^R\n    c[1:T + 1] = gamma_t * (v_R - a_vec)\n    # Coefficients for g_t^B\n    c[T + 1:] = gamma_t * c_B\n\n    # --- Equality Constraints A_eq, b_eq ---\n    # Constraint: g_t^R + g_t^B = D_t for t=1,...,T\n    A_eq = np.zeros((T, num_vars))\n    for t in range(T):\n        # Coefficient for g_{t+1}^R (index t+1)\n        A_eq[t, t + 1] = 1\n        # Coefficient for g_{t+1}^B (index T + t + 1)\n        A_eq[t, T + t + 1] = 1\n    b_eq = D_vec\n\n    # --- Inequality Constraints A_ub, b_ub ---\n    # Constraint: g_t^R = K * CF_t * H  =>  g_t^R - K * (CF_t * H) = 0\n    A_ub = np.zeros((T, num_vars))\n    for t in range(T):\n        # Coefficient for K (index 0)\n        A_ub[t, 0] = -CF_vec[t] * H\n        # Coefficient for g_{t+1}^R (index t+1)\n        A_ub[t, t + 1] = 1\n    b_ub = np.zeros(T)\n\n    # --- Bounds ---\n    # All variables are non-negative\n    bounds = (0, None)\n\n    # --- Solve LP ---\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    \n    if res.success:\n        optimal_K = res.x[0]\n        return optimal_K\n    else:\n        # Should not happen for this well-posed problem\n        return -1.0\n\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path with mid-horizon sunset)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 25, \"t_sunset\": 3, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 2 (boundary condition with early sunset and moderate PTC)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 20, \"t_sunset\": 1, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 3 (edge case with zero PTC)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 0, \"t_sunset\": 0, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 4 (significant edge case with nonuniform demand and partial sunset)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1060000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 25, \"t_sunset\": 3, \"CF_t\": 0.4, \"D_t\": [10000, 14000, 14000, 6000, 6000]\n        },\n    ]\n\n    all_results = []\n    for params in test_cases:\n        T, r, H, C, v_R, c_B = params[\"T\"], params[\"r\"], params[\"H\"], params[\"C\"], params[\"v_R\"], params[\"c_B\"]\n        a, t_sunset = params[\"a\"], params[\"t_sunset\"]\n        \n        # Ensure CF_t and D_t are numpy arrays of length T\n        if isinstance(params[\"CF_t\"], (int, float)):\n            CF_vec = np.full(T, params[\"CF_t\"])\n        else:\n            CF_vec = np.array(params[\"CF_t\"])\n            \n        if isinstance(params[\"D_t\"], (int, float)):\n            D_vec = np.full(T, params[\"D_t\"])\n        else:\n            D_vec = np.array(params[\"D_t\"])\n\n        # Scenario 1: With PTC Sunset\n        a_vec_sunset = np.array([a if (t + 1) = t_sunset else 0 for t in range(T)])\n        K_sunset = solve_lp(T, r, H, C, v_R, c_B, a_vec_sunset, CF_vec, D_vec)\n\n        # Scenario 2: No PTC Sunset\n        a_vec_nosunset = np.full(T, a)\n        K_nosunset = solve_lp(T, r, H, C, v_R, c_B, a_vec_nosunset, CF_vec, D_vec)\n\n        case_results = [round(K_sunset, 3), round(K_nosunset, 3)]\n        all_results.append(case_results)\n\n    # Format the final output string\n    formatted_results = [f\"[{res[0]:.3f},{res[1]:.3f}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}