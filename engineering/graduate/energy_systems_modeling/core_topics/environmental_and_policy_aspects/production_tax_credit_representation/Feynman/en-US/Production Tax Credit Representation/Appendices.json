{
    "hands_on_practices": [
        {
            "introduction": "A robust energy system model begins with data integrity. This first practice establishes a crucial foundation by addressing the conversion of the Production Tax Credit (PTC) rate from its commonly quoted units to those used in large-scale models. By grounding the conversion in first principles, you will ensure the financial impact of the PTC is accurately captured, a prerequisite for any meaningful analysis of its effects on the energy system .",
            "id": "4114288",
            "problem": "An energy system model represents generation outputs in megawatt-hours ($\\mathrm{MWh}$). A policy includes a Production Tax Credit (PTC), quoted as a rate $x$ in United States dollar per kilowatt-hour ($\\mathrm{USD}/\\mathrm{kWh}$). The model computes the total credit by multiplying a per-unit rate by the energy produced. To ensure scientific consistency, the credit computed from outputs must be invariant to the choice of energy unit representation.\n\nStarting from the definitions of power and energy units, and the linear relation between per-unit rates and total credit, derive the per-megawatt-hour rate $s$ in $\\mathrm{USD}/\\mathrm{MWh}$ that yields the same total credit when applied to outputs measured in $\\mathrm{MWh}$. Your derivation must justify the unit transformation from $\\mathrm{kWh}$ to $\\mathrm{MWh}$ using base unit definitions and the structure of a linear credit functional.\n\nProvide a single closed-form analytic expression for $s$ in terms of $x$. No numerical approximation is required. Express the final rate $s$ in $\\mathrm{USD}/\\mathrm{MWh}$. The final answer must be a single expression.",
            "solution": "The problem requires the derivation of a new production tax credit rate, $s$, in units of United States dollars per megawatt-hour ($\\mathrm{USD}/\\mathrm{MWh}$), from a given rate, $x$, in units of United States dollars per kilowatt-hour ($\\mathrm{USD}/\\mathrm{kWh}$). The fundamental constraint is that the total credit calculated for a given amount of energy production must be invariant to the choice of energy units. The derivation must be based on first principles of unit definitions and the linear nature of the credit calculation.\n\nLet $E$ represent a specific quantity of energy produced. The problem states that the total credit, which we denote as $C$, is a linear functional of the energy produced.\n\nWhen the energy $E$ is measured in kilowatt-hours ($\\mathrm{kWh}$), its numerical value is $E_{\\mathrm{kWh}}$. The per-unit rate is given as $x$, in units of $\\mathrm{USD}/\\mathrm{kWh}$. The total credit is calculated as:\n$$C = x \\cdot E_{\\mathrm{kWh}}$$\n\nWhen the same quantity of energy $E$ is measured in megawatt-hours ($\\mathrm{MWh}$), its numerical value is $E_{\\mathrm{MWh}}$. The per-unit rate in this case is the unknown value $s$, in units of $\\mathrm{USD}/\\mathrm{MWh}$. The total credit is calculated as:\n$$C = s \\cdot E_{\\mathrm{MWh}}$$\n\nThe core principle of invariance dictates that the total credit amount $C$ must be the same regardless of the units used for the calculation. Therefore, we can equate the two expressions for $C$:\n$$s \\cdot E_{\\mathrm{MWh}} = x \\cdot E_{\\mathrm{kWh}}$$\n\nTo solve for $s$ in terms of $x$, we must establish the mathematical relationship between the numerical values $E_{\\mathrm{MWh}}$ and $E_{\\mathrm{kWh}}$. This relationship is derived from the definitions of the energy units $\\mathrm{kWh}$ and $\\mathrm{MWh}$.\n\nThe prefixes 'kilo' (k) and 'mega' (M) are standard SI prefixes representing factors of $10^3$ and $10^6$, respectively. Let $\\mathrm{Wh}$ denote the base energy unit of a watt-hour.\nThe definitions of kilowatt-hour and megawatt-hour are:\n$$1 \\ \\mathrm{kWh} = 10^3 \\ \\mathrm{Wh}$$\n$$1 \\ \\mathrm{MWh} = 10^6 \\ \\mathrm{Wh}$$\n\nFrom these two definitions, we can establish a direct relationship between $\\mathrm{MWh}$ and $\\mathrm{kWh}$. We can express $\\mathrm{Wh}$ in terms of $\\mathrm{kWh}$ from the first equation:\n$$1 \\ \\mathrm{Wh} = 10^{-3} \\ \\mathrm{kWh}$$\nSubstituting this into the second equation yields the conversion factor between $\\mathrm{MWh}$ and $\\mathrm{kWh}$:\n$$1 \\ \\mathrm{MWh} = 10^6 \\cdot (10^{-3} \\ \\mathrm{kWh}) = 10^{(6-3)} \\ \\mathrm{kWh} = 10^3 \\ \\mathrm{kWh}$$\nThus, we have the unit relationship:\n$$1 \\ \\mathrm{MWh} = 1000 \\ \\mathrm{kWh}$$\n\nNow, we apply this relationship to the numerical values $E_{\\mathrm{MWh}}$ and $E_{\\mathrm{kWh}}$ for a given quantity of energy $E$. The quantity of energy $E$ can be expressed as the product of its numerical value and its unit:\n$$E = E_{\\mathrm{MWh}} \\ [\\mathrm{MWh}] = E_{\\mathrm{kWh}} \\ [\\mathrm{kWh}]$$\nUsing the unit relationship $1 \\ [\\mathrm{MWh}] = 1000 \\ [\\mathrm{kWh}]$, we substitute for the unit $[\\mathrm{MWh}]$:\n$$E_{\\mathrm{MWh}} \\cdot (1000 \\ [\\mathrm{kWh}]) = E_{\\mathrm{kWh}} \\ [\\mathrm{kWh}]$$\nBy canceling the common unit $[\\mathrm{kWh}]$ from both sides of the equation, we obtain the relationship between the numerical values:\n$$1000 \\cdot E_{\\mathrm{MWh}} = E_{\\mathrm{kWh}}$$\nThis result is logical: because a kilowatt-hour is a smaller unit of energy than a megawatt-hour, a given quantity of energy will have a numerical value that is $1000$ times larger when measured in $\\mathrm{kWh}$ compared to when it is measured in $\\mathrm{MWh}$.\n\nFinally, we substitute this relationship for $E_{\\mathrm{kWh}}$ back into our credit invariance equation:\n$$s \\cdot E_{\\mathrm{MWh}} = x \\cdot (1000 \\cdot E_{\\mathrm{MWh}})$$\nFor any non-zero amount of energy production, $E_{\\mathrm{MWh}} \\neq 0$, we can divide both sides of the equation by $E_{\\mathrm{MWh}}$:\n$$s = 1000 \\cdot x$$\nThis is the desired closed-form expression for the rate $s$ in terms of the rate $x$. The units are consistent, as the factor of $1000$ carries implicit units of $\\mathrm{kWh}/\\mathrm{MWh}$:\n$$[s] = \\left[\\frac{\\mathrm{USD}}{\\mathrm{kWh}}\\right] \\cdot \\left[\\frac{\\mathrm{kWh}}{\\mathrm{MWh}}\\right] = \\left[\\frac{\\mathrm{USD}}{\\mathrm{MWh}}\\right]$$\nThe derived rate $s = 1000x$ will therefore be in units of $\\mathrm{USD}/\\mathrm{MWh}$, as required by the problem statement.",
            "answer": "$$\\boxed{1000x}$$"
        },
        {
            "introduction": "Energy policies are dynamic, and their finite lifetimes can profoundly influence investment decisions. This exercise advances from static data representation to modeling the impact of a PTC with a legislative sunset provision on a capacity expansion choice . Through formulating and solving a linear optimization problem, you will explore how the duration of an incentive affects the optimal build-out of renewable capacity, a key skill in long-term energy planning and policy evaluation.",
            "id": "4114372",
            "problem": "Consider a stylized capacity expansion planning problem for a single new renewable technology providing energy to meet an exogenous annual energy demand. The investment decision is modeled from the perspective of a private investor maximizing net present value equivalently minimizing net present cost. The representation must incorporate a Production Tax Credit (PTC) with a legislative sunset. The planning horizon consists of $T$ annual periods indexed by $t \\in \\{1,2,\\dots,T\\}$. Let the annual discount rate be $r$, and the per-period discount factor be $\\gamma_t = (1+r)^{-t}$. The renewable technology has a capital cost of $C$ dollars per megawatt of installed capacity, a variable operating cost of $v_R$ dollars per megawatt-hour, a time-varying capacity factor $CF_t \\in [0,1]$, and can generate up to $g_t^R \\leq K \\cdot CF_t \\cdot H$ megawatt-hours in period $t$, where $K$ is the decision variable representing installed capacity in megawatts, and $H$ is the number of hours in a year. Energy not supplied by the renewable technology is met by a backup technology with variable cost $c_B$ dollars per megawatt-hour and no capacity limit.\n\nThe Production Tax Credit (PTC) pays $a_t$ dollars per megawatt-hour of renewable generation in period $t$. To incorporate a legislative sunset, enforce $a_t = a$ for $t \\leq t^{sunset}$ and $a_t = 0$ for $t > t^{sunset}$, where $t^{sunset}$ is an integer satisfying $0 \\leq t^{sunset} \\leq T$. The annual energy demand to be met exactly is given by $D_t$ megawatt-hours for each $t$. Assume nonnegativity of all decision variables and exact demand satisfaction in each period.\n\nStarting from the principles of discounted cash flow valuation and static rational choice under perfect competition, set up the decision problem as a linear optimization that minimizes total discounted system cost subject to the physical feasibility constraints. The total discounted system cost, using Present Value at time $0$, must include the one-time capital investment cost and the discounted net variable costs of both technologies, where the PTC reduces the effective variable cost of renewable generation in periods in which it applies.\n\nYour program must:\n- Implement this model and compute the optimal installed capacity $K$ in megawatts under two scenarios for each test case: (i) with the legislative sunset, and (ii) with no sunset where $a_t = a$ for all $t \\in \\{1,\\dots,T\\}$.\n- Use a linear programming solver to obtain the optimal decision variables.\n- Express the final capacities in megawatts as floats rounded to three decimal places.\n\nPhysical units must be respected throughout: capital costs in dollars per megawatt ($\\$$/MW), variable costs in dollars per megawatt-hour ($\\$$/MWh), energy in megawatt-hours (MWh), capacity in megawatts (MW), time in hours per year (h/year). Angles are not used. All fractional answers must be decimal numbers, not ratios.\n\nTest Suite:\nUse the following four scientifically consistent test cases, each defined by parameters $(T, r, H, C, v_R, c_B, a, t^{sunset}, \\{CF_t\\}_{t=1}^T, \\{D_t\\}_{t=1}^T)$.\n\n- Case 1 (happy path with mid-horizon sunset):\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 25$ $\\$$/MWh, $t^{sunset} = 3$, $CF_t = 0.4$ for all $t$, $D_t = 14000$ MWh for all $t$.\n\n- Case 2 (boundary condition with early sunset and moderate PTC):\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 20$ $\\$$/MWh, $t^{sunset} = 1$, $CF_t = 0.4$ for all $t$, $D_t = 14000$ MWh for all $t$.\n\n- Case 3 (edge case with zero PTC):\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1100000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 0$ $\\$$/MWh, $t^{sunset} = 0$, $CF_t = 0.4$ for all $t$, $D_t = 14000$ MWh for all $t$.\n\n- Case 4 (significant edge case with nonuniform demand and partial sunset):\n  $T = 5$, $r = 0.07$, $H = 8760$ h/year, $C = 1060000$ $\\$$/MW, $v_R = 10$ $\\$$/MWh, $c_B = 80$ $\\$$/MWh, $a = 25$ $\\$$/MWh, $t^{sunset} = 3$, $CF_t = 0.4$ for all $t$, $D_t = [10000, 14000, 14000, 6000, 6000]$ MWh.\n\nRequired final output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a two-element list of floats in megawatts $[K^{sunset}, K^{nosunset}]$, each rounded to three decimal places. For example, the output must look like $[[K_1^{sunset},K_1^{nosunset}],[K_2^{sunset},K_2^{nosunset}],[K_3^{sunset},K_3^{nosunset}],[K_4^{sunset},K_4^{nosunset}]]$ with units implied as megawatts (MW).",
            "solution": "The problem requires the formulation and solution of a linear optimization model for a renewable energy capacity expansion decision. The model aims to minimize the net present cost of meeting a given annual energy demand over a planning horizon, considering a single investment in a renewable technology alongside an unconstrained backup power source. The model must incorporate a Production Tax Credit (PTC) that may expire due to a legislative sunset.\n\n### Principles and Formulation\n\nThe problem is framed from the perspective of a rational investor making a decision at time $t=0$ to maximize net present value, which is equivalent to minimizing the total discounted costs. The principles of discounted cash flow analysis are central.\n\n#### Decision Variables\nThe investment decision at time $t=0$ is the capacity of the renewable resource to install:\n- $K$: Installed renewable capacity (in MW).\n\nFor each time period $t \\in \\{1, 2, \\dots, T\\}$, there are operational decisions on how much energy to generate from each source:\n- $g_t^R$: Renewable generation in period $t$ (in MWh).\n- $g_t^B$: Backup generation in period $t$ (in MWh).\n\nAll decision variables are constrained to be non-negative: $K \\geq 0$, $g_t^R \\geq 0$, $g_t^B \\geq 0$.\n\n#### Objective Function\nThe objective is to minimize the total system cost, discounted to its present value at $t=0$. The total cost consists of the upfront capital expenditure and the stream of net operational costs over the horizon $T$.\n\n1.  **Capital Cost**: The one-time investment cost for the renewable capacity is $C \\cdot K$, incurred at $t=0$. Its present value is simply $C \\cdot K$.\n\n2.  **Operational Costs**: In each period $t$, the cost of generation is the sum of costs from the renewable and backup sources. The PTC provides a credit, effectively reducing the renewable generation cost. The net operational cost in period $t$ is $(v_R \\cdot g_t^R) + (c_B \\cdot g_t^B) - (a_t \\cdot g_t^R)$.\n\nThe present value of the operational cost for period $t$ is calculated using the discount factor $\\gamma_t = (1+r)^{-t}$. Summing over all periods, the total discounted operational cost is $\\sum_{t=1}^{T} \\gamma_t \\left( (v_R - a_t) g_t^R + c_B g_t^B \\right)$.\n\nThe complete objective function to be minimized is the sum of the capital cost and the total discounted operational costs:\n$$ \\min_{K, g_t^R, g_t^B} \\quad Z = C \\cdot K + \\sum_{t=1}^{T} \\gamma_t \\left[ (v_R - a_t) g_t^R + c_B g_t^B \\right] $$\n\n#### Constraints\nThe decisions are bound by physical and market constraints.\n\n1.  **Demand Satisfaction**: For each period $t$, the total energy generated must exactly meet the specified demand $D_t$.\n    $$ g_t^R + g_t^B = D_t \\quad \\forall t \\in \\{1, \\dots, T\\} $$\n\n2.  **Renewable Generation Limit**: The output from the renewable technology in any period $t$ cannot exceed its physical potential, which is determined by the installed capacity $K$, the time-varying capacity factor $CF_t$, and the total hours in a year $H$.\n    $$ g_t^R \\leq K \\cdot CF_t \\cdot H \\quad \\forall t \\in \\{1, \\dots, T\\} $$\n\nThis complete formulation—a linear objective function subject to linear equality and inequality constraints—is a Linear Program (LP).\n\n### Algorithmic Design for Solution\n\nThe problem will be solved using the `linprog` function from the `scipy.optimize` library, which is designed to solve LPs in a standard form:\n$$ \\min_x c^T x \\quad \\text{subject to} \\quad A_{ub} x \\leq b_{ub}, \\quad A_{eq} x = b_{eq}, \\quad \\text{and bounds on } x. $$\n\nTo apply this solver, we must map our model to this standard form.\n\n1.  **Decision Vector $x$**: The decision variables are arranged into a single column vector $x$. We use the ordering:\n    $$ x = [K, g_1^R, \\dots, g_T^R, g_1^B, \\dots, g_T^B]^T $$\n    The vector $x$ has a total of $1 + 2T$ elements.\n\n2.  **Cost Vector $c$**: The coefficients of the objective function are placed in the vector $c$, matching the order in $x$.\n    $$ c = [C, \\gamma_1(v_R-a_1), \\dots, \\gamma_T(v_R-a_T), \\gamma_1 c_B, \\dots, \\gamma_T c_B]^T $$\n\n3.  **Equality Constraints $A_{eq}, b_{eq}$**: The demand satisfaction constraints $g_t^R + g_t^B = D_t$ are encoded in the matrix $A_{eq}$ and vector $b_{eq}$. For each of the $T$ periods, a row in $A_{eq}$ will have a $1$ in the column corresponding to $g_t^R$ and a $1$ in the column for $g_t^B$. The corresponding entry in $b_{eq}$ will be $D_t$.\n\n4.  **Inequality Constraints $A_{ub}, b_{ub}$**: The renewable generation limits $g_t^R \\leq K \\cdot CF_t \\cdot H$ are rewritten as $g_t^R - (CF_t \\cdot H)K \\leq 0$. For each of the $T$ periods, a row in $A_{ub}$ will have a coefficient of $1$ for $g_t^R$ and a coefficient of $-CF_t \\cdot H$ for $K$. The corresponding entry in $b_{ub}$ will be $0$.\n\n5.  **Bounds**: All decision variables are non-negative, so the lower bound for every element in $x$ is $0$, and the upper bound is infinity.\n\nThe program will implement a function that takes the problem parameters, constructs these matrices and vectors, and calls `linprog`. For each test case, this function will be called twice:\n-   **Scenario 1 (Sunset)**: The PTC vector $a_t$ is constructed with $a_t=a$ for $t \\leq t^{sunset}$ and $a_t=0$ for $t > t^{sunset}$.\n-   **Scenario 2 (No Sunset)**: The PTC vector is constructed with $a_t=a$ for all $t$.\n\nThe optimal capacity $K$, which is the first element of the solution vector `res.x` returned by `linprog`, is extracted and stored for each scenario. The final results are collected and formatted as specified.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_lp(T, r, H, C, v_R, c_B, a_vec, CF_vec, D_vec):\n    \"\"\"\n    Solves the capacity expansion LP for a given set of parameters.\n\n    Args:\n        T (int): Number of periods in the planning horizon.\n        r (float): Annual discount rate.\n        H (int): Number of hours in a year.\n        C (float): Capital cost of renewable technology ($/MW).\n        v_R (float): Variable cost of renewable technology ($/MWh).\n        c_B (float): Variable cost of backup technology ($/MWh).\n        a_vec (np.ndarray): Vector of PTC values for each period t ($/MWh).\n        CF_vec (np.ndarray): Vector of capacity factors for each period t.\n        D_vec (np.ndarray): Vector of energy demands for each period t (MWh).\n\n    Returns:\n        float: Optimal installed capacity K (MW).\n    \"\"\"\n    # Number of variables: 1 (for K) + T (for g_R) + T (for g_B)\n    num_vars = 1 + 2 * T\n\n    # --- Cost Vector c ---\n    # Discount factors gamma_t = (1+r)^-t for t=1,...,T\n    periods = np.arange(1, T + 1)\n    gamma_t = (1 + r) ** -periods\n\n    # Cost vector c for the objective function: min c'x\n    # x = [K, g_1^R, ..., g_T^R, g_1^B, ..., g_T^B]\n    c = np.zeros(num_vars)\n    # Coefficient for K\n    c[0] = C\n    # Coefficients for g_t^R\n    c[1:T + 1] = gamma_t * (v_R - a_vec)\n    # Coefficients for g_t^B\n    c[T + 1:] = gamma_t * c_B\n\n    # --- Equality Constraints A_eq, b_eq ---\n    # Constraint: g_t^R + g_t^B = D_t for t=1,...,T\n    A_eq = np.zeros((T, num_vars))\n    for t in range(T):\n        # Coefficient for g_{t+1}^R (index t+1)\n        A_eq[t, t + 1] = 1\n        # Coefficient for g_{t+1}^B (index T + t + 1)\n        A_eq[t, T + t + 1] = 1\n    b_eq = D_vec\n\n    # --- Inequality Constraints A_ub, b_ub ---\n    # Constraint: g_t^R <= K * CF_t * H  =>  g_t^R - K * (CF_t * H) <= 0\n    A_ub = np.zeros((T, num_vars))\n    for t in range(T):\n        # Coefficient for K (index 0)\n        A_ub[t, 0] = -CF_vec[t] * H\n        # Coefficient for g_{t+1}^R (index t+1)\n        A_ub[t, t + 1] = 1\n    b_ub = np.zeros(T)\n\n    # --- Bounds ---\n    # All variables are non-negative\n    bounds = (0, None)\n\n    # --- Solve LP ---\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    \n    if res.success:\n        optimal_K = res.x[0]\n        return optimal_K\n    else:\n        # Should not happen for this well-posed problem\n        return -1.0\n\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path with mid-horizon sunset)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 25, \"t_sunset\": 3, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 2 (boundary condition with early sunset and moderate PTC)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 20, \"t_sunset\": 1, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 3 (edge case with zero PTC)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1100000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 0, \"t_sunset\": 0, \"CF_t\": 0.4, \"D_t\": 14000\n        },\n        # Case 4 (significant edge case with nonuniform demand and partial sunset)\n        {\n            \"T\": 5, \"r\": 0.07, \"H\": 8760, \"C\": 1060000, \"v_R\": 10, \"c_B\": 80, \n            \"a\": 25, \"t_sunset\": 3, \"CF_t\": 0.4, \"D_t\": [10000, 14000, 14000, 6000, 6000]\n        },\n    ]\n\n    all_results = []\n    for params in test_cases:\n        T, r, H, C, v_R, c_B = params[\"T\"], params[\"r\"], params[\"H\"], params[\"C\"], params[\"v_R\"], params[\"c_B\"]\n        a, t_sunset = params[\"a\"], params[\"t_sunset\"]\n        \n        # Ensure CF_t and D_t are numpy arrays of length T\n        if isinstance(params[\"CF_t\"], (int, float)):\n            CF_vec = np.full(T, params[\"CF_t\"])\n        else:\n            CF_vec = np.array(params[\"CF_t\"])\n            \n        if isinstance(params[\"D_t\"], (int, float)):\n            D_vec = np.full(T, params[\"D_t\"])\n        else:\n            D_vec = np.array(params[\"D_t\"])\n\n        # Scenario 1: With PTC Sunset\n        a_vec_sunset = np.array([a if t + 1 <= t_sunset else 0 for t in range(T)])\n        K_sunset = solve_lp(T, r, H, C, v_R, c_B, a_vec_sunset, CF_vec, D_vec)\n\n        # Scenario 2: No PTC Sunset\n        a_vec_nosunset = np.full(T, a)\n        K_nosunset = solve_lp(T, r, H, C, v_R, c_B, a_vec_nosunset, CF_vec, D_vec)\n\n        case_results = [round(K_sunset, 3), round(K_nosunset, 3)]\n        all_results.append(case_results)\n\n    # Format the final output string\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The value of a Production Tax Credit is ultimately constrained by a firm's ability to use it against its tax liabilities. This final practice introduces a critical layer of financial realism by modeling the concepts of tax capacity and Net Operating Loss (NOL) carryforward . By implementing a sequential calculation that mimics corporate tax accounting, you will learn to distinguish between potential and realized credits, providing a more accurate assessment of a PTC's true financial impact on a project's bottom line.",
            "id": "4114360",
            "problem": "You are asked to formalize and compute the realizable value of the Production Tax Credit (PTC) for a renewable energy project in a multi-period setting under Net Operating Loss (NOL) carryforward, as encountered in energy systems modeling. Begin from the following primitive bases: the definition of taxable income, the operation of corporate income taxation, and the convention that tax credits cannot exceed tax liability. The goal is to construct an algorithm that respects the provided modeling rules and outputs the aggregated realizable PTC and tax paid across several test cases.\n\nUse the following core definitions and sequential accounting rules, all expressed per period $t$:\n- **Production Tax Credit (PTC)**: A statutory credit accruing proportionally to energy generation, defined as $PTC_t^{potential} = p \\cdot G_t$, where $p$ is the statutory credit rate and $G_t$ is energy generation.\n- **Net Operating Loss (NOL) Carryforward**: The NOL from the prior period, $NOL_{t-1}$, can be used to offset positive taxable income in the current period. Per the simplified rules of this exercise, there is no accumulation of NOLs; only the loss from the immediately preceding period is available.\n\nYou must implement the following steps sequentially for each period $t$:\n1.  **Calculate Potential Credit**: Compute the potential PTC for the period: $PTC_t^{potential} = p \\cdot G_t$.\n2.  **Apply NOL Carryforward**: Determine the amount of NOL from the previous period that can be used: $NOL_{used,t} = \\min(NOL_{t-1}, \\max(0, TI_t))$. This reduces the current taxable income: $TI_{adjusted,t} = TI_t - NOL_{used,t}$.\n3.  **Calculate Tax Liability**: Compute the tax liability based on the adjusted taxable income: $Tax_{liability,t} = \\tau \\cdot \\max(0, TI_{adjusted,t})$.\n4.  **Determine Realized PTC**: The realized PTC is limited by the tax liability. Any potential credit exceeding this liability is lost: $PTC_t^{realized} = \\min(PTC_t^{potential}, Tax_{liability,t})$.\n5.  **Calculate Taxes Paid**: The final taxes paid is the tax liability less the realized credit: $Tax_t = Tax_{liability,t} - PTC_t^{realized}$.\n6.  **Update NOL for Next Period**: The NOL to be carried forward to period $t+1$ is the loss incurred in the current period, $t$. Any unused portion of $NOL_{t-1}$ is lost: $NOL_t = \\max(0, -TI_t)$.\n\nAll monetary quantities must be expressed in dollars, rounded to two decimals. Energy generation is expressed in megawatt-hours, and the PTC rate $p$ is expressed in dollars per megawatt-hour. The tax rate $\\tau$ must be provided and used as a decimal fraction, not as a percentage.\n\nYour program must process the following test suite, where each test case provides:\n- A sequence of taxable incomes $\\{TI_t\\}$ in dollars.\n- A sequence of generations $\\{G_t\\}$ in megawatt-hours.\n- A tax rate $\\tau$ (decimal).\n- A PTC rate $p$ in dollars per megawatt-hour.\n- An initial carryforward $NOL_0$ in dollars.\n\nTest Suite:\n- Case $1$ (nonbinding credit capacity in each period): $\\{TI_t\\} = [100000, 120000, 90000, 110000]$, $\\{G_t\\} = [10000, 9500, 9800, 10200]$, $\\tau = 0.25$, $p = 1.5$, $NOL_0 = 0$.\n- Case $2$ (binding credit capacity in each period, zero initial carryforward): $\\{TI_t\\} = [100000, 120000, 90000, 110000]$, $\\{G_t\\} = [10000, 9500, 9800, 10200]$, $\\tau = 0.25$, $p = 30$, $NOL_0 = 0$.\n- Case $3$ (negative income, one-period carryforward enabling future realization): $\\{TI_t\\} = [-50000, 30000, -10000, 0]$, $\\{G_t\\} = [1000, 1100, 800, 900]$, $\\tau = 0.21$, $p = 15$, $NOL_0 = 0$.\n- Case $4$ (zero taxable income throughout, positive generation): $\\{TI_t\\} = [0, 0, 0, 0]$, $\\{G_t\\} = [500, 500, 500, 500]$, $\\tau = 0.30$, $p = 50$, $NOL_0 = 0$.\n- Case $5$ (alternating negative and positive income, nontrivial carryforward effect): $\\{TI_t\\} = [-40000, -5000, 20000, -30000]$, $\\{G_t\\} = [2000, 1500, 1000, 1200]$, $\\tau = 0.25$, $p = 10$, $NOL_0 = 0$.\n\nFor each test case, compute two outputs in dollars:\n- The total realized credit $\\sum_t PTC_t^{realized}$ rounded to two decimals.\n- The total taxes paid $\\sum_t Tax_t$ rounded to two decimals.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is itself a two-element list in the format $[TotalRealizedPTC,TotalTaxesPaid]$. For example: $[[x_1,y_1],[x_2,y_2],\\dots]$. Ensure there are no spaces inside the brackets or between elements, and all values are rounded to two decimals. All dollar amounts in the output must be in dollars with two decimal places.",
            "solution": "The solution requires implementing a sequential algorithm that models the annual tax calculation for a project, incorporating Net Operating Loss (NOL) carryforward and the realization of Production Tax Credits (PTC). The provided rules reflect a standard, albeit simplified, corporate tax accounting procedure. The process is iterated for each period in the time horizon. The state at the beginning of any period $t$ is the NOL carried forward from the previous period, $NOL_{t-1}$.\n\nFor each period $t$, the following steps are executed in order:\n\n1.  **Calculate Potential PTC**: The maximum possible credit is determined by the period's generation: $PTC_t^{potential} = p \\cdot G_t$.\n\n2.  **Apply NOL Carryforward**: The available NOL from period $t-1$ is used to offset any positive taxable income in period $t$. The amount used is $NOL_{used,t} = \\min(NOL_{t-1}, \\max(0, TI_t))$. This yields an adjusted taxable income: $TI_{adjusted,t} = TI_t - NOL_{used,t}$.\n\n3.  **Calculate Tax Liability**: The tax liability is calculated based on the positive portion of the adjusted taxable income: $Tax_{liability,t} = \\tau \\cdot \\max(0, TI_{adjusted,t})$.\n\n4.  **Determine Realized PTC**: The amount of PTC that can be monetized is the lesser of the potential credit and the calculated tax liability. Any potential credit above this limit is lost: $PTC_t^{realized} = \\min(PTC_t^{potential}, Tax_{liability,t})$.\n\n5.  **Calculate Taxes Paid**: The final taxes owed is the liability remaining after the realized credit has been applied: $Tax_t = Tax_{liability,t} - PTC_t^{realized}$.\n\n6.  **Update NOL for Next Period**: The NOL to be carried into period $t+1$ is defined by the loss in the current period, $t$. Consistent with the problem's rule of no NOL accumulation, any unused portion of $NOL_{t-1}$ is discarded: $NOL_t = \\max(0, -TI_t)$.\n\nThe algorithm iterates through all periods for a given test case, summing the period-by-period results to find the total realized PTC and total taxes paid.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Processes a suite of test cases to calculate total realized PTC and taxes paid\n    based on a specified multi-period tax model with NOL carryforward.\n    \"\"\"\n    test_cases = [\n        # Case 1 (nonbinding credit capacity)\n        {\n            \"ti_seq\": [100000, 120000, 90000, 110000],\n            \"g_seq\": [10000, 9500, 9800, 10200],\n            \"tau\": 0.25,\n            \"p\": 1.5,\n            \"nol_0\": 0.0\n        },\n        # Case 2 (binding credit capacity)\n        {\n            \"ti_seq\": [100000, 120000, 90000, 110000],\n            \"g_seq\": [10000, 9500, 9800, 10200],\n            \"tau\": 0.25,\n            \"p\": 30.0,\n            \"nol_0\": 0.0\n        },\n        # Case 3 (negative income, carryforward effect)\n        {\n            \"ti_seq\": [-50000, 30000, -10000, 0],\n            \"g_seq\": [1000, 1100, 800, 900],\n            \"tau\": 0.21,\n            \"p\": 15.0,\n            \"nol_0\": 0.0\n        },\n        # Case 4 (zero taxable income)\n        {\n            \"ti_seq\": [0, 0, 0, 0],\n            \"g_seq\": [500, 500, 500, 500],\n            \"tau\": 0.30,\n            \"p\": 50.0,\n            \"nol_0\": 0.0\n        },\n        # Case 5 (alternating income, nontrivial carryforward)\n        {\n            \"ti_seq\": [-40000, -5000, 20000, -30000],\n            \"g_seq\": [2000, 1500, 1000, 1200],\n            \"tau\": 0.25,\n            \"p\": 10.0,\n            \"nol_0\": 0.0\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        ti_seq = case[\"ti_seq\"]\n        g_seq = case[\"g_seq\"]\n        tau = case[\"tau\"]\n        p = case[\"p\"]\n        nol_carryforward = case[\"nol_0\"]\n\n        total_realized_ptc = 0.0\n        total_taxes_paid = 0.0\n\n        for i in range(len(ti_seq)):\n            ti_t = ti_seq[i]\n            g_t = g_seq[i]\n\n            # 1. Calculate Potential Credit\n            ptc_potential = p * g_t\n\n            # 2. Apply NOL Carryforward\n            nol_used = min(nol_carryforward, max(0, ti_t))\n            ti_adjusted = ti_t - nol_used\n\n            # 3. Calculate Tax Liability\n            tax_liability = tau * max(0, ti_adjusted)\n\n            # 4. Determine Realized PTC\n            ptc_realized = min(ptc_potential, tax_liability)\n\n            # 5. Calculate Taxes Paid\n            tax_paid = tax_liability - ptc_realized\n\n            # 6. Update NOL for Next Period\n            nol_carryforward = max(0, -ti_t)\n\n            # Aggregate results\n            total_realized_ptc += ptc_realized\n            total_taxes_paid += tax_paid\n\n        # Round final aggregated values to two decimals\n        rounded_ptc = round(total_realized_ptc, 2)\n        rounded_tax = round(total_taxes_paid, 2)\n        \n        all_results.append([rounded_ptc, rounded_tax])\n    \n    # Format the final output string as specified\n    formatted_results = [f\"[{res[0]:.2f},{res[1]:.2f}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}