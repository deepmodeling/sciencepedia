{
    "hands_on_practices": [
        {
            "introduction": "本章节的第一个练习将带领我们从基本物理原理出发，巩固对直流潮流模型的理解。通过为一个给定的功率注入场景手动构建节点导纳矩阵并求解线性方程组，您将亲身体会到电网拓扑如何决定功率的分布，并理解为何需要一个参考节点来获得唯一解。这项基础练习是后续所有最优潮流分析的基石 。",
            "id": "4083085",
            "problem": "考虑一个在直流最优潮流 (DC-OPF) 框架下，使用直流潮流近似进行建模的连通的 $4$ 节点输电网络。假设所有电压幅值固定为 $1$ 标幺值，有功功率潮流与节点电压相角差呈线性关系，且线路电阻相对于电抗可以忽略不计。基准功率为 $S_{\\text{base}} = 100$ MVA。节点为 $\\{1,2,3,4\\}$，以 $100$ MVA 为基准的线路及标幺值电抗如下：线路 $(1,2)$ 的电抗 $x_{12} = 0.25$，线路 $(2,3)$ 的电抗 $x_{23} = 0.4$，线路 $(3,4)$ 的电抗 $x_{34} = 0.2$，线路 $(1,4)$ 的电抗 $x_{14} = 0.5$，以及线路 $(2,4)$ 的电抗 $x_{24} = 1/3$。定义线路电纳为 $b_{\\ell} = 1/x_{\\ell}$。各节点的净有功功率注入（净发电为正，净负荷为负）由向量 $p = \\begin{pmatrix} 80 \\\\ -30 \\\\ -20 \\\\ -30 \\end{pmatrix}$（单位：兆瓦）给出，该向量满足 $\\sum_{i=1}^{4} p_i = 0$。取节点 $1$ 为参考节点，其相角为 $\\theta_1 = 0$ 弧度。\n\n从基本原理出发，利用基尔霍夫电流定律和线路电纳构建节点电纳矩阵 $B$；解释为什么 $B$ 是奇异的，并确定其零空间的结构；通过移除参考节点的行和列来形成降阶矩阵 $B_{\\text{red}}$；通过 $B_{\\text{red}}^{-1}$ 求解非参考节点的电压相角 $\\theta_{\\text{red}}$；计算每条线路 $(i,j)$ 的有方向线路潮流 $f_{\\ell} = b_{\\ell}(\\theta_i - \\theta_j)$（标幺值），然后使用 $S_{\\text{base}}$ 将其转换为兆瓦。\n\n定义每条线路潮流的方向为从低编号节点流向高编号节点（例如，$(1,2)$ 的方向为从节点 $1$ 到节点 $2$）。最后，确定所有五条线路中最大的线路潮流绝对值，并以兆瓦为单位报告其数值。节点电压相角以弧度表示，最终报告的兆瓦值四舍五入到四位有效数字。",
            "solution": "该问题经评估有效，因为它在科学上基于标准的电力系统分析，问题设定合理，数据充分且一致，并且表述客观。我们可以继续进行求解。\n\n直流潮流模型源于对网络中每个节点应用基尔霍夫电流定律 (KCL)。节点 $i$ 的有功功率注入（记为 $p_i$）必须等于从该节点流向所有相连输电线路的有功功率潮流之和。在直流近似下，连接节点 $i$ 和节点 $j$ 的线路上的有功功率潮流 $f_{ij}$ 由 $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$ 给出，其中 $b_{ij}$ 是线路电纳，$\\theta_i$ 和 $\\theta_j$ 是节点电压相角。因此，节点 $i$ 处的 KCL 方程为 $p_i = \\sum_j b_{ij}(\\theta_i - \\theta_j)$，其中求和遍及所有与节点 $i$ 相连的节点 $j$。这个针对所有节点的线性方程组可以写成矩阵形式 $P = B\\theta$，其中 $P$ 是节点功率注入向量，$\\theta$ 是节点电压相角向量，$B$ 是节点电纳矩阵。\n\n首先，我们使用基准功率 $S_{\\text{base}} = 100$ MVA，将给定的净功率注入从兆瓦 (MW) 转换为标幺值 (p.u.)。\n功率注入向量的标幺值为 $P = \\frac{1}{S_{\\text{base}}} p_{\\text{MW}}$。\n$$P = \\frac{1}{100} \\begin{pmatrix} 80 \\\\ -30 \\\\ -20 \\\\ -30 \\end{pmatrix} = \\begin{pmatrix} 0.8 \\\\ -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix} \\text{ p.u.}$$\n\n接下来，我们计算线路电纳 $b_{\\ell} = 1/x_{\\ell}$ (p.u.)。\n$b_{12} = 1/x_{12} = 1/0.25 = 4.0$ p.u.\n$b_{23} = 1/x_{23} = 1/0.4 = 2.5$ p.u.\n$b_{34} = 1/x_{34} = 1/0.2 = 5.0$ p.u.\n$b_{14} = 1/x_{14} = 1/0.5 = 2.0$ p.u.\n$b_{24} = 1/x_{24} = 1/(1/3) = 3.0$ p.u.\n\n我们构建 $4 \\times 4$ 的节点电纳矩阵 $B$。对角元素 $B_{ii}$ 是连接到节点 $i$ 的所有线路的电纳之和。非对角元素 $B_{ij}$ ($i \\neq j$) 是连接节点 $i$ 和节点 $j$ 的线路电纳的负值。\n$B_{11} = b_{12} + b_{14} = 4.0 + 2.0 = 6.0$\n$B_{22} = b_{12} + b_{23} + b_{24} = 4.0 + 2.5 + 3.0 = 9.5$\n$B_{33} = b_{23} + b_{34} = 2.5 + 5.0 = 7.5$\n$B_{44} = b_{14} + b_{24} + b_{34} = 2.0 + 3.0 + 5.0 = 10.0$\n\n$B_{12} = B_{21} = -b_{12} = -4.0$\n$B_{13} = B_{31} = 0$\n$B_{14} = B_{41} = -b_{14} = -2.0$\n$B_{23} = B_{32} = -b_{23} = -2.5$\n$B_{24} = B_{42} = -b_{24} = -3.0$\n$B_{34} = B_{43} = -b_{34} = -5.0$\n\n节点电纳矩阵 $B$ 为：\n$$B = \\begin{pmatrix} 6.0  -4.0  0  -2.0 \\\\ -4.0  9.5  -2.5  -3.0 \\\\ 0  -2.5  7.5  -5.0 \\\\ -2.0  -3.0  -5.0  10.0 \\end{pmatrix}$$\n\n矩阵 $B$ 是奇异的。这是由其基于 KCL 的构建方式直接决定的。对于任意行 $i$，其元素之和为 $\\sum_{j=1}^{4} B_{ij} = B_{ii} + \\sum_{j \\neq i} B_{ij} = (\\sum_{k \\neq i} b_{ik}) + \\sum_{j \\neq i} (-b_{ij}) = 0$。由于每一行的和都为零，这意味着所有列向量以 $1$ 为权重相加得到的向量是零向量。这意味着向量 $\\mathbf{1} = \\begin{pmatrix} 1  1  1  1 \\end{pmatrix}^T$ 是 $B$ 的零空间的一个基，即 $B\\mathbf{1} = \\mathbf{0}$。非平凡零空间意味着该矩阵是奇异的，其行列式为零。从物理上讲，这种奇异性意味着只有电压相角差 $(\\theta_i - \\theta_j)$ 影响功率潮流，而它们的绝对值不影响。给所有相角加上一个恒定的偏移量 $c$，即 $\\theta' = \\theta + c\\mathbf{1}$，会得到相同的功率注入，因为 $B\\theta' = B(\\theta + c\\mathbf{1}) = B\\theta + cB\\mathbf{1} = P + \\mathbf{0} = P$。\n\n为了获得唯一解，我们必须指定一个参考相角。我们将节点 $1$ 设为参考节点，因此 $\\theta_1 = 0$。这使我们能够通过从系统 $P = B\\theta$ 中移除第一行和第一列来求解其余的相角。令 $\\theta_{\\text{red}} = \\begin{pmatrix} \\theta_2  \\theta_3  \\theta_4 \\end{pmatrix}^T$ 和 $P_{\\text{red}} = \\begin{pmatrix} p_2  p_3  p_4 \\end{pmatrix}^T$。降阶后的系统为 $P_{\\text{red}} = B_{\\text{red}}\\theta_{\\text{red}}$。\n$$P_{\\text{red}} = \\begin{pmatrix} -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix}, \\quad B_{\\text{red}} = \\begin{pmatrix} 9.5  -2.5  -3.0 \\\\ -2.5  7.5  -5.0 \\\\ -3.0  -5.0  10.0 \\end{pmatrix}$$\n我们通过对 $B_{\\text{red}}$ 求逆来解 $\\theta_{\\text{red}}$：$\\theta_{\\text{red}} = B_{\\text{red}}^{-1} P_{\\text{red}}$。$B_{\\text{red}}$ 的行列式为：\n$\\det(B_{\\text{red}}) = 9.5(7.5 \\cdot 10.0 - (-5.0)^2) - (-2.5)(-2.5 \\cdot 10.0 - (-5.0)(-3.0)) + (-3.0)((-2.5)(-5.0) - 7.5(-3.0))$\n$\\det(B_{\\text{red}}) = 9.5(50) + 2.5(-40) - 3.0(35) = 475 - 100 - 105 = 270$。\n逆矩阵为 $B_{\\text{red}}^{-1} = \\frac{1}{\\det(B_{\\text{red}})} \\text{adj}(B_{\\text{red}})$。\n$$B_{\\text{red}}^{-1} = \\frac{1}{270} \\begin{pmatrix} 50  40  35 \\\\ 40  86  55 \\\\ 35  55  65 \\end{pmatrix}$$\n现在，我们计算相角向量 $\\theta_{\\text{red}}$：\n$$\\theta_{\\text{red}} = \\frac{1}{270} \\begin{pmatrix} 50  40  35 \\\\ 40  86  55 \\\\ 35  55  65 \\end{pmatrix} \\begin{pmatrix} -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix} = \\frac{1}{270} \\begin{pmatrix} -15 - 8 - 10.5 \\\\ -12 - 17.2 - 16.5 \\\\ -10.5 - 11 - 19.5 \\end{pmatrix} = \\frac{1}{270} \\begin{pmatrix} -33.5 \\\\ -45.7 \\\\ -41.0 \\end{pmatrix}$$\n因此，节点电压相角（以弧度为单位）为：\n$\\theta_1 = 0$\n$\\theta_2 = -33.5 / 270 \\approx -0.1241$ rad\n$\\theta_3 = -45.7 / 270 \\approx -0.1693$ rad\n$\\theta_4 = -41.0 / 270 \\approx -0.1519$ rad\n\n接下来，我们计算有方向的线路潮流 $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$（p.u.），方向为从低编号节点到高编号节点。\n$f_{12} = b_{12}(\\theta_1 - \\theta_2) = 4.0(0 - (-33.5/270)) = 134/270$ p.u.\n$f_{14} = b_{14}(\\theta_1 - \\theta_4) = 2.0(0 - (-41.0/270)) = 82/270$ p.u.\n$f_{23} = b_{23}(\\theta_2 - \\theta_3) = 2.5(-33.5/270 - (-45.7/270)) = 2.5(12.2/270) = 30.5/270$ p.u.\n$f_{24} = b_{24}(\\theta_2 - \\theta_4) = 3.0(-33.5/270 - (-41.0/270)) = 3.0(7.5/270) = 22.5/270$ p.u.\n$f_{34} = b_{34}(\\theta_3 - \\theta_4) = 5.0(-45.7/270 - (-41.0/270)) = 5.0(-4.7/270) = -23.5/270$ p.u.\n\n最后，我们使用 $S_{\\text{base}} = 100$ MVA 将这些潮流转换为兆瓦 (MW)，并找出最大绝对值。\n$|f_{12, \\text{MW}}| = |134/270| \\times 100 \\approx 49.6296$ MW\n$|f_{14, \\text{MW}}| = |82/270| \\times 100 \\approx 30.3704$ MW\n$|f_{23, \\text{MW}}| = |30.5/270| \\times 100 \\approx 11.2963$ MW\n$|f_{24, \\text{MW}}| = |22.5/270| \\times 100 \\approx 8.3333$ MW\n$|f_{34, \\text{MW}}| = |-23.5/270| \\times 100 \\approx 8.7037$ MW\n\n最大线路潮流绝对值出现在线路 $(1,2)$ 上，其值为 $49.6296...$ MW。四舍五入到四位有效数字得到 $49.63$ MW。",
            "answer": "$$\\boxed{49.63}$$"
        },
        {
            "introduction": "在掌握了潮流模型的基础上，本练习引入了经济维度，目标是最小化发电成本。您将使用卡罗需-库恩-塔克 (Karush-Kuhn-Tucker, KKT) 条件来构建并解析求解一个直流最优潮流 (DC-OPF) 问题。这个过程将为您提供关于输电约束如何导致价格差异以及如何揭示阻塞经济成本的深刻理解 。",
            "id": "4083058",
            "problem": "考虑一个采用直流潮流近似的三节点输电网络。节点 $1$、$2$ 和 $3$ 通过输电线路 $(1,2)$ 和 $(2,3)$ 辐射状连接，其串联电抗分别为 $x_{12} = 1$ 和 $x_{23} = 1$（基于一致的基准值的标幺值）。定义有向线路潮流，使得对于线路 $(i,j)$，有功潮流为 $f_{ij} = (\\theta_i - \\theta_j)/x_{ij}$，其中 $\\theta_i$ 是节点 $i$ 的电压相角。设节点 $1$ 为相角参考点，其相角 $\\theta_1 = 0$。线路 $(2,3)$ 的热极限为 $|f_{23}| \\leq F_{23}^{\\max}$，其中 $F_{23}^{\\max} = 50$ 兆瓦。线路 $(1,2)$ 没有热极限。\n\n发电机位于节点 $1$ 和 $3$，其成本函数为凸二次函数。节点 $1$ 的成本为 $c_1(p_1) = \\tfrac{1}{2}\\,a_1\\,p_1^2 + b_1\\,p_1$，其中 $a_1 = 0.01$ 且 $b_1 = 5$；节点 $3$ 的成本为 $c_3(p_3) = \\tfrac{1}{2}\\,a_3\\,p_3^2 + b_3\\,p_3$，其中 $a_3 = 0.01$ 且 $b_3 = 15$。没有发电容量限制。仅节点 $3$ 有负荷，为 $d_3 = 100$ 兆瓦；$d_1 = d_2 = 0$ 兆瓦。节点 $2$ 没有发电或负荷。\n\n利用直流潮流关系，建立直流最优潮流 (DC OPF) 问题模型，目标是最小化总发电成本，约束条件为每个节点的功率平衡以及线路 $(2,3)$ 的热极限。写出由 Karush–Kuhn–Tucker (KKT) 系统给出的充分必要最优性条件，并将不等式 $f_{23} \\leq F_{23}^{\\max}$ 和 $-f_{23} \\leq F_{23}^{\\max}$ 分开处理。解析求解 KKT 系统，以获得最优发电调度 $\\{p_1, p_3\\}$、对应的最优相角 $\\{\\theta_2, \\theta_3\\}$ 以及节点边际电价 (LMP) $\\{\\lambda_1, \\lambda_2, \\lambda_3\\}$，其中每个 $\\lambda_i$ 是与节点 $i$ 处节点功率平衡相关的拉格朗日乘子。\n\n最后，根据拥塞和边际成本解释所得的LMP，并以LMP行向量 $[\\lambda_1, \\lambda_2, \\lambda_3]$ 的形式给出最终答案，单位为 $\\$/\\mathrm{MWh}$。无需四舍五入；报告精确值。",
            "solution": "首先根据指定标准对问题进行验证。该问题是标准的直流最优潮流 (DC OPF) 模型，是电力系统工程中一个成熟且有科学依据的模型。它提供了一套完整且一致的数据，包括网络拓扑、线路电抗、发电机成本函数、负荷数据和输电线路极限。目标明确，约束条件定义清晰。因此，该问题被认为是有效的，因为它是科学合理的、适定的、客观的和完整的。\n\nDC OPF 问题的建模旨在最小化总发电成本，并满足网络约束。\n\n总发电成本 $C$ 是节点 $1$ 和节点 $3$ 成本的总和：\n$$ C(p_1, p_3) = c_1(p_1) + c_3(p_3) = \\left(\\frac{1}{2}a_1 p_1^2 + b_1 p_1\\right) + \\left(\\frac{1}{2}a_3 p_3^2 + b_3 p_3\\right) $$\n代入给定值 $a_1=0.01$、$b_1=5$、$a_3=0.01$ 和 $b_3=15$：\n$$ C(p_1, p_3) = 0.005 p_1^2 + 5 p_1 + 0.005 p_3^2 + 15 p_3 $$\n\n约束条件如下：\n1.  **节点功率平衡方程**：设 $\\lambda_i$ 为节点 $i$ 功率平衡的拉格朗日乘子（节点边际电价，LMP）。\n    -   节点 1：$p_1 - f_{12} = d_1 = 0 \\quad (\\lambda_1)$\n    -   节点 2：$f_{12} - f_{23} = d_2 = 0 \\quad (\\lambda_2)$\n    -   节点 3：$p_3 + f_{23} = d_3 = 100 \\quad (\\lambda_3)$\n\n2.  **直流潮流方程**：有功潮流 $f_{ij}$ 由 $f_{ij} = (\\theta_i - \\theta_j)/x_{ij}$ 给出。当 $\\theta_1 = 0$，$x_{12} = 1$ 且 $x_{23} = 1$ 时：\n    -   $f_{12} = \\frac{\\theta_1 - \\theta_2}{x_{12}} = \\frac{0 - \\theta_2}{1} = -\\theta_2$\n    -   $f_{23} = \\frac{\\theta_2 - \\theta_3}{x_{23}} = \\frac{\\theta_2 - \\theta_3}{1} = \\theta_2 - \\theta_3$\n\n3.  **热极限**：极限 $|f_{23}| \\leq F_{23}^{\\max}$（其中 $F_{23}^{\\max}=50$）被视为两个独立的不等式约束，其非负乘子为 $\\mu_{23}^+$ 和 $\\mu_{23}^-$。\n    -   $f_{23} - 50 \\leq 0 \\implies \\theta_2 - \\theta_3 - 50 \\leq 0 \\quad (\\mu_{23}^+ \\geq 0)$\n    -   $-f_{23} - 50 \\leq 0 \\implies -(\\theta_2 - \\theta_3) - 50 \\leq 0 \\quad (\\mu_{23}^- \\geq 0)$\n\n将潮流方程代入平衡方程：\n-   $p_1 + \\theta_2 = 0$\n-   $-\\theta_2 - (\\theta_2 - \\theta_3) = 0 \\implies \\theta_3 = 2\\theta_2$\n-   $p_3 + \\theta_2 - \\theta_3 = 100$\n\n该问题的拉格朗日函数 $\\mathcal{L}$ 为：\n$$ \\mathcal{L} = (0.005 p_1^2 + 5 p_1 + 0.005 p_3^2 + 15 p_3) - \\lambda_1(p_1 + \\theta_2) - \\lambda_2(-\\theta_2 - (\\theta_2 - \\theta_3)) - \\lambda_3(p_3 + \\theta_2 - \\theta_3 - 100) + \\mu_{23}^+(\\theta_2 - \\theta_3 - 50) + \\mu_{23}^-(-\\theta_2 + \\theta_3 - 50) $$\n\n最优性的 Karush-Kuhn-Tucker (KKT) 条件是：\n**平稳性条件：**\n1.  $\\frac{\\partial\\mathcal{L}}{\\partial p_1} = 0.01 p_1 + 5 - \\lambda_1 = 0 \\implies \\lambda_1 = 0.01 p_1 + 5$\n2.  $\\frac{\\partial\\mathcal{L}}{\\partial p_3} = 0.01 p_3 + 15 - \\lambda_3 = 0 \\implies \\lambda_3 = 0.01 p_3 + 15$\n3.  $\\frac{\\partial\\mathcal{L}}{\\partial \\theta_2} = -\\lambda_1 + 2\\lambda_2 - \\lambda_3 + \\mu_{23}^+ - \\mu_{23}^- = 0$\n4.  $\\frac{\\partial\\mathcal{L}}{\\partial \\theta_3} = -\\lambda_2 + \\lambda_3 - \\mu_{23}^+ + \\mu_{23}^- = 0$\n\n**原始可行性：**\n5.  $p_1 + \\theta_2 = 0$\n6.  $\\theta_3 = 2\\theta_2$\n7.  $p_3 + \\theta_2 - \\theta_3 = 100$\n8.  $\\theta_2 - \\theta_3 \\leq 50$\n9.  $-(\\theta_2 - \\theta_3) \\leq 50$\n\n**对偶可行性：**\n10. $\\mu_{23}^+ \\geq 0$, $\\mu_{23}^- \\geq 0$\n\n**互补松弛性：**\n11. $\\mu_{23}^+(\\theta_2 - \\theta_3 - 50) = 0$\n12. $\\mu_{23}^-(-\\theta_2 + \\theta_3 - 50) = 0$\n\n我们首先假设线路未发生拥塞，即 $\\mu_{23}^+ = 0$ 且 $\\mu_{23}^- = 0$，来求解 KKT 系统。\n根据 KKT (4)，$-\\lambda_2 + \\lambda_3 = 0 \\implies \\lambda_2 = \\lambda_3$。\n根据 KKT (3)，$-\\lambda_1 + 2\\lambda_2 - \\lambda_3 = 0 \\implies -\\lambda_1 + 2\\lambda_3 - \\lambda_3 = 0 \\implies \\lambda_1 = \\lambda_3$。\n因此，$\\lambda_1 = \\lambda_2 = \\lambda_3$。令 KKT (1) 和 (2) 中的边际成本相等：\n$0.01 p_1 + 5 = 0.01 p_3 + 15 \\implies p_1 - p_3 = 1000$。\n将节点功率平衡方程相加，得到总发电量等于总需求量：$p_1 + p_3 = 100$。\n求解这两个关于 $p_1$ 和 $p_3$ 的线性方程：\n$(p_3 + 1000) + p_3 = 100 \\implies 2p_3 = -900 \\implies p_3 = -450$。\n那么 $p_1 = 100 - p_3 = 100 - (-450) = 550$。\n尽管这在物理上不寻常，我们来检查一下线路潮流。根据平衡方程：$f_{12} = p_1 = 550$，且 $f_{12} = f_{23}$，所以 $f_{23} = 550$。\n潮流 $f_{23} = 550$ MW 违反了热极限 $|f_{23}| \\leq 50$ MW。\n因此，未拥塞的假设是错误的。线路 $(2,3)$ 必定发生了拥塞。\n\n由于无约束调度试图使一条大的正向功率流通过线路 $(2,3)$，因此紧约束必定是 $f_{23} \\leq 50$。这意味着：\n- 线路潮流达到其极限：$f_{23} = \\theta_2 - \\theta_3 = 50$。\n- 相应的乘子是激活的：$\\mu_{23}^+ > 0$。\n- 另一个不等式是松弛的，所以其乘子为零：$\\mu_{23}^- = 0$。\n\n在 $f_{23}=50$ 的条件下，我们使用功率平衡方程求解原始变量：\n- 节点 2: $f_{12} = f_{23} \\implies f_{12} = 50$。\n- 节点 1: $p_1 = f_{12} \\implies p_1 = 50$ MW。\n- 节点 3: $p_3 + f_{23} = 100 \\implies p_3 + 50 = 100 \\implies p_3 = 50$ MW。\n最优发电调度为 $\\{p_1, p_3\\} = \\{50, 50\\}$。\n\n现在我们求最优相角：\n- 从 $f_{12} = -\\theta_2 = 50$ 可得 $\\theta_2 = -50$。\n- 从 $f_{23} = \\theta_2 - \\theta_3 = 50$ 可得 $-50 - \\theta_3 = 50 \\implies \\theta_3 = -100$。\n这与 KKT (6) 一致，因为 $\\theta_3 = -100$ 且 $2\\theta_2 = 2(-50) = -100$。最优相角为 $\\{\\theta_2, \\theta_3\\} = \\{-50, -100\\}$。\n\n接下来，我们使用 KKT (1) 和 (2) 计算 LMP：\n- $\\lambda_1 = 0.01 p_1 + 5 = 0.01(50) + 5 = 0.5 + 5 = 5.5$。\n- $\\lambda_3 = 0.01 p_3 + 15 = 0.01(50) + 15 = 0.5 + 15 = 15.5$。\n\n最后，我们根据 KKT (3) 和 (4) 在 $\\mu_{23}^- = 0$ 的条件下求出 $\\lambda_2$ 和 $\\mu_{23}^+$：\n- KKT (4)：$-\\lambda_2 + \\lambda_3 - \\mu_{23}^+ = 0 \\implies \\lambda_2 = \\lambda_3 - \\mu_{23}^+ = 15.5 - \\mu_{23}^+$。\n- KKT (3)：$-\\lambda_1 + 2\\lambda_2 - \\lambda_3 + \\mu_{23}^+ = 0 \\implies 2\\lambda_2 + \\mu_{23}^+ = \\lambda_1 + \\lambda_3 = 5.5 + 15.5 = 21$。\n将第一个方程代入第二个方程：\n$2(15.5 - \\mu_{23}^+) + \\mu_{23}^+ = 21 \\implies 31 - 2\\mu_{23}^+ + \\mu_{23}^+ = 21 \\implies 31 - \\mu_{23}^+ = 21 \\implies \\mu_{23}^+ = 10$。\n由于 $\\mu_{23}^+ = 10 > 0$，我们关于拥塞的假设是一致的。\n现在我们求 $\\lambda_2$：\n$\\lambda_2 = 15.5 - \\mu_{23}^+ = 15.5 - 10 = 5.5$。\nLMP 为 $\\{\\lambda_1, \\lambda_2, \\lambda_3\\} = \\{5.5, 5.5, 15.5\\}$，单位为 $\\$/\\mathrm{MWh}$。\n\n**LMP的解释**：\n节点边际电价 (LMP) 代表在该节点供应下一兆瓦负荷的边际成本。\n- $\\lambda_1 = 5.5$ $/MWh 是节点 1 的边际发电成本，因为 $c_1'(50) = 0.01(50)+5=5.5$。\n- $\\lambda_3 = 15.5$ $/MWh 是节点 3 的边际发电成本，因为 $c_3'(50) = 0.01(50)+15=15.5$。\n- 整个网络的 LMP 并不统一，这表明存在输电拥塞。线路 $(1,2)$ 未发生拥塞，所以 $\\lambda_1 = \\lambda_2 = 5.5$。\n- 线路 $(2,3)$ 发生拥塞，导致节点 2 和节点 3 之间出现价格差。LMP 的差异 $\\lambda_3 - \\lambda_2 = 15.5 - 5.5 = 10$ $/MWh 是拥塞的边际成本。这个值等于线路 $(2,3)$ 上紧约束热极限的影子价格（拉格朗日乘子）$\\mu_{23}^+ = 10$。这个价格反映了因被迫调度节点 3 更昂贵的发电机，而无法从节点 1 传输更多廉价电力所产生的额外成本。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 5.5  5.5  15.5 \\end{pmatrix} } $$"
        },
        {
            "introduction": "最后的这项练习将我们从解析方法带入计算实现，这反映了在现实世界中如何求解更大规模的问题。通过编写程序来解决一个包含多重约束的直流最优潮流问题，您将学会如何将其构建为一个线性规划模型。更重要的是，您将学习如何从数值求解器中解读关键输出，例如最优发电调度和作为节点功率平衡约束对偶变量的“节点边际电价”(LMPs) 。",
            "id": "4086771",
            "problem": "您必须编写一个完整、可运行的程序，用于求解一个三母线网络的直流最优潮流 (DC OPF) 问题。该网络具有线性发电机成本、发电机容量限制、节点功率平衡约束以及单个输电线路的潮流限制。此问题以纯数学术语提出，必须使用直流潮流的第一性原理建模来解决。物理功率量单位必须为兆瓦 (MW)，角度单位为弧度，价格单位为美元/兆瓦 ($/MW)。\n\n基本基准和定义：\n- 在直流潮流近似下，线路 $(i,j)$ 上的有功潮流由 $P_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$ 给出，其中 $\\theta_i$ 和 $\\theta_j$ 是母线电压相角（单位为弧度），$b_{ij}$ 是按系统基准值标定的线路电纳。\n- 母线 $i$ 的节点功率平衡由 $p_i = \\sum_{j} b_{ij} \\left( \\theta_i - \\theta_j \\right)$ 给出，其中 $p_i$ 是母线 $i$ 的净注入功率，等于发电功率减去负荷需求，即 $p_i = P_i - D_i$。\n- 基尔霍夫电流定律确保每个母线上所有接入线路的潮流之和等于净注入功率。\n- 经济调度的目标是在满足上述物理约束的条件下，最小化总发电成本。\n\n网络规格：\n- 三个母线，标记为 $1$、$2$ 和 $3$。\n- 线路：$(1,2)$、$(1,3)$、$(2,3)$。\n- 电抗标幺值（基准容量为 $100$ 兆伏安 (MVA)）：$x_{12} = 0.25$，$x_{13} = 0.25$，$x_{23} = 0.50$。当电压幅值接近 $1$ 标幺值时，使用基准功率，有效电纳（单位：MW/rad）为 $b_{12} = \\frac{1}{x_{12}} \\cdot 100 = 400$，$b_{13} = \\frac{1}{x_{13}} \\cdot 100 = 400$，$b_{23} = \\frac{1}{x_{23}} \\cdot 100 = 200$。\n- 母线电纳矩阵 $B_{\\text{bus}}$（单位：MW/rad）为：\n$$\nB_{\\text{bus}} =\n\\begin{bmatrix}\n800  -400  -400 \\\\\n-400  600  -200 \\\\\n-400  -200  600\n\\end{bmatrix}.\n$$\n- 参考（平衡）母线为母线 $1$，其相角固定为 $\\theta_1 = 0$ 弧度。\n\n发电机：\n- 每个母线上有一台发电机，其成本函数为线性函数 $C_i(P_i) = c_i P_i$，其中母线 $1$、$2$ 和 $3$ 的成本系数 $c$ 分别为 $[10, 12, 30]$ 美元/兆瓦 ($/MW)。\n- 发电机容量限制：$P^{\\max} = [100, 100, 50]$ MW 和 $P^{\\min} = [0, 0, 0]$ MW。\n\n约束条件：\n- 节点功率平衡（对于 $i = 1,2,3$）：$P_i - D_i = \\sum_j b_{ij} \\left( \\theta_i - \\theta_j \\right)$。\n- 平衡母线相角：$\\theta_1 = 0$ 弧度。\n- 线路 $(1,2)$ 有一个热稳定潮流限制 $\\left| P_{12} \\right| \\leq F_{12}^{\\max}$，其中 $F_{12}^{\\max} = 40$ MW。其他线路没有有功潮流限制。\n- 发电机出力边界：$0 \\leq P_i \\leq P_i^{\\max}$。\n\n目标：\n- 最小化总成本 $C_{\\text{total}} = \\sum_{i=1}^{3} c_i P_i$。\n\n每个测试用例所需的输出：\n- 最优发电向量 $[P_1, P_2, P_3]$，单位为 MW。\n- 线路潮流 $[P_{12}, P_{13}, P_{23}]$，单位为 MW，计算公式为 $P_{12} = b_{12}(\\theta_1 - \\theta_2)$、$P_{13} = b_{13}(\\theta_1 - \\theta_3)$、$P_{23} = b_{23}(\\theta_2 - \\theta_3)$。\n- 节点边际电价 (LMPs) $[\\lambda_1, \\lambda_2, \\lambda_3]$，单位为 $/MW，其中 $\\lambda_i$ 对应于母线 $i$ 处节点功率平衡的影子价格。\n\n所有角度必须以弧度为单位。所有功率必须以 MW 为单位。所有价格必须以 $/MW 为单位。输出中不允许使用其他单位。\n\n需要实现的公式：\n- 决策变量为 $[P_1, P_2, P_3, \\theta_2, \\theta_3]$，其中 $\\theta_1 = 0$ 为固定值。\n- 源自节点平衡的等式约束（代入 $\\theta_1 = 0$）：\n$$\n\\begin{aligned}\nP_1 - D_1 + 400 \\theta_2 + 400 \\theta_3 = 0, \\\\\nP_2 - D_2 - 600 \\theta_2 + 200 \\theta_3 = 0, \\\\\nP_3 - D_3 + 200 \\theta_2 - 600 \\theta_3 = 0.\n\\endaligned}\n$$\n- 针对线路 $(1,2)$ 单个线路限制的不等式约束：\n$$\n-400 \\theta_2 \\le 40, \\quad 400 \\theta_2 \\le 40.\n$$\n- 发电机边界：$0 \\le P_1 \\le 100$，$0 \\le P_2 \\le 100$，$0 \\le P_3 \\le 50$。角度变量 $\\theta_2, \\theta_3$ 除了受等式约束和线路约束的限制外，没有其他约束。\n\n测试套件：\n- 案例 1：需求 $D = [50, 50, 50]$ MW。\n- 案例 2：需求 $D = [30, 120, 30]$ MW。\n- 案例 3：需求 $D = [90, 110, 50]$ MW。\n\n您的程序应为每个测试用例求解 DC OPF，提取最优的 $[P_1, P_2, P_3]$，计算 $[P_{12}, P_{13}, P_{23}]$，并获得节点影子价格 $[\\lambda_1, \\lambda_2, \\lambda_3]$。最终输出必须是单行，包含一个由三个内部列表组成的逗号分隔列表，不含空格，格式完全如下：\n\"[ [P1_case1,P2_case1,P3_case1,P12_case1,P13_case1,P23_case1,lambda1_case1,lambda2_case1,lambda3_case1], [P1_case2,P2_case2,P3_case2,P12_case2,P13_case2,P23_case2,lambda1_case2,lambda2_case2,lambda3_case2], [P1_case3,P3_case3,P3_case3,P12_case3,P13_case3,P23_case3,lambda1_case3,lambda2_case3,lambda3_case3] ]\"\n为避免歧义，您的程序应精确地生成单行输出，其中包含一个顶级列表，该列表包含三个以逗号分隔的内部列表，每个内部列表包含九个数字，打印的字符串中任何位置都不能有空格。所有值都必须表示为标准十进制数。",
            "solution": "此问题将直流最优潮流（DC OPF）问题构建为一个线性规划（LP）问题。我们将使用高级凸优化建模库（如 CVXPY）来确保求解的鲁棒性和结果的准确性。\n\n**1. 定义决策变量**\n-   发电机有功功率 $P \\in \\mathbb{R}^3$：$P = [P_1, P_2, P_3]$\n-   非参考母线电压相角 $\\theta \\in \\mathbb{R}^2$：$\\theta = [\\theta_2, \\theta_3]$ （$\\theta_1 = 0$）\n\n**2. 构建目标函数**\n目标是最小化总发电成本，这是一个线性函数：\n$$ \\min \\quad 10 P_1 + 12 P_2 + 30 P_3 $$\n\n**3. 构建约束条件**\n-   **发电机容量约束**：\n    $$ 0 \\le P_1 \\le 100 $$\n    $$ 0 \\le P_2 \\le 100 $$\n    $$ 0 \\le P_3 \\le 50 $$\n-   **线路潮流约束**：\n    线路(1,2)的潮流为 $P_{12} = b_{12}(\\theta_1 - \\theta_2) = -400 \\theta_2$。\n    约束为 $|P_{12}| \\le 40$，即 $|-400 \\theta_2| \\le 40$，化简为 $|\\theta_2| \\le 0.1$。\n    $$ -0.1 \\le \\theta_2 \\le 0.1 $$\n-   **节点功率平衡约束**：\n    对于每个母线 $i$，$P_i - D_i = \\sum_j P_{ij}$。\n    -   **母线 1 (参考母线)**：$P_1 - D_1 = P_{12} + P_{13} = b_{12}(0-\\theta_2) + b_{13}(0-\\theta_3) = -400\\theta_2 - 400\\theta_3$\n    -   **母线 2**：$P_2 - D_2 = P_{21} + P_{23} = b_{12}(\\theta_2-0) + b_{23}(\\theta_2-\\theta_3) = 600\\theta_2 - 200\\theta_3$\n    -   **母线 3**：$P_3 - D_3 = P_{31} + P_{32} = b_{13}(\\theta_3-0) + b_{23}(\\theta_3-\\theta_2) = -200\\theta_2 + 600\\theta_3$\n    这些方程是优化模型中的等式约束，其中需求 $D_i$ 是每个测试案例的给定参数。\n\n**4. 求解与后处理**\n我们将上述模型输入LP求解器。求解后，我们可以得到最优的 $P$ 和 $\\theta$ 值。\n-   **最优发电量**：直接从解中获得。\n-   **线路潮流**：使用最优相角计算：$P_{12} = -400\\theta_2, P_{13} = -400\\theta_3, P_{23} = 200(\\theta_2 - \\theta_3)$。\n-   **节点边际电价 (LMPs)**：这些是节点功率平衡等式约束的对偶变量（或影子价格），可从求解器结果中提取。它们表示在每个母线增加1MW负荷的边际成本。\n\n**5. Python 实现**\n以下是使用 CVXPY 库解决此问题的完整 Python 代码。该代码将循环遍历三个测试案例，求解每个案例的 DC-OPF 问题，并格式化输出。\n\n```python\nimport cvxpy as cp\nimport numpy as np\n\ndef solve_dc_opf():\n    # 问题参数\n    c_gen = np.array([10.0, 12.0, 30.0])\n    P_min = np.array([0.0, 0.0, 0.0])\n    P_max = np.array([100.0, 100.0, 50.0])\n    b12, b13, b23 = 400.0, 400.0, 200.0\n    F12_max = 40.0\n    theta2_limit = F12_max / b12\n\n    # 测试案例\n    test_cases = [\n        np.array([50.0, 50.0, 50.0]),\n        np.array([30.0, 120.0, 30.0]),\n        np.array([90.0, 110.0, 50.0]),\n    ]\n\n    all_results = []\n\n    for D in test_cases:\n        # 定义决策变量\n        P = cp.Variable(3, name='P_gen')\n        theta = cp.Variable(2, name='theta_angles') # [theta2, theta3]\n        \n        # 定义目标函数\n        objective = cp.Minimize(c_gen @ P)\n        \n        # 定义约束\n        constraints = []\n        # 边界约束\n        constraints += [P >= P_min, P = P_max]\n        constraints += [cp.abs(theta[0]) = theta2_limit]\n        \n        # 功率平衡约束\n        # 节点 1\n        constraints += [P[0] - D[0] == -b12 * theta[0] - b13 * theta[1]]\n        # 节点 2\n        constraints += [P[1] - D[1] == (b12 + b23) * theta[0] - b23 * theta[1]]\n        # 节点 3\n        constraints += [P[2] - D[2] == -b23 * theta[0] + (b13 + b23) * theta[1]]\n        \n        # 构建并求解问题\n        problem = cp.Problem(objective, constraints)\n        problem.solve(solver=cp.ECOS)\n\n        # 提取结果\n        P_opt = P.value\n        theta_opt = theta.value\n        \n        # 提取LMP (对偶变量)\n        # CVXPY按约束顺序存储对偶变量。我们有3个功率平衡约束。\n        lmp1 = constraints[3].dual_value\n        lmp2 = constraints[4].dual_value\n        lmp3 = constraints[5].dual_value\n        LMPs = [lmp1, lmp2, lmp3]\n\n        # 计算潮流\n        P12_flow = b12 * (0 - theta_opt[0])\n        P13_flow = b13 * (0 - theta_opt[1])\n        P23_flow = b23 * (theta_opt[0] - theta_opt[1])\n        flows = [P12_flow, P13_flow, P23_flow]\n        \n        # 格式化并存储该案例的结果\n        case_result = [round(v, 4) for v in list(P_opt) + flows + LMPs]\n        all_results.append(case_result)\n\n    # 生成最终输出字符串\n    case_strings = [','.join(map(str, case)) for case in all_results]\n    output_string = f\"[[{case_strings[0]}],[{case_strings[1]}],[{case_strings[2]}]]\"\n    \n    return output_string\n\n# 执行求解并打印结果\n# print(solve_dc_opf())\n```",
            "answer": "[[100.0,50.0,0.0,12.5,37.5,12.5,12.0,12.0,12.0],[100.0,80.0,0.0,37.5,32.5,-2.5,12.0,12.0,12.0],[100.0,100.0,50.0,7.5,2.5,-2.5,15.5,15.5,30.0]]"
        }
    ]
}