{
    "hands_on_practices": [
        {
            "introduction": "这项练习旨在将我们对直流潮流近似的理解建立在物理模型之上。在优化系统之前，我们必须能够准确预测其行为。本练习  将指导您如何从基本的网络数据构建核心的节点导纳矩阵（$B$ 矩阵），并用它来求解系统状态——即母线电压相角和线路功率潮流。",
            "id": "4083085",
            "problem": "考虑一个在直流最优潮流 (DC-OPF) 中使用直流 (DC) 潮流近似法建模的连通 $4$ 节点输电网络。假设所有电压幅值固定为 $1$ 标幺值，有功潮流与节点电压相角差成线性关系，且线路电阻相对于电抗可以忽略不计。基准功率为 $S_{\\text{base}} = 100$ MVA。节点为 $\\{1,2,3,4\\}$，线路和以 $100$ MVA 为基准的标幺值电抗如下：线路 $(1,2)$ 的电抗为 $x_{12} = 0.25$，线路 $(2,3)$ 的电抗为 $x_{23} = 0.4$，线路 $(3,4)$ 的电抗为 $x_{34} = 0.2$，线路 $(1,4)$ 的电抗为 $x_{14} = 0.5$，线路 $(2,4)$ 的电抗为 $x_{24} = 1/3$。定义线路电纳为 $b_{\\ell} = 1/x_{\\ell}$。节点处的净有功注入功率（净发电为正，净负荷为负）由向量 $p = \\begin{pmatrix} 80 \\\\ -30 \\\\ -20 \\\\ -30 \\end{pmatrix}$（单位为兆瓦）给出，且满足 $\\sum_{i=1}^{4} p_i = 0$。取节点 $1$ 为参考节点，其相角为 $\\theta_1 = 0$ 弧度。\n\n从第一性原理出发，使用基尔霍夫电流定律和线路电纳构建节点电纳矩阵 $B$，解释为什么 $B$ 是奇异的并确定其零空间的结构，通过移除参考节点的行和列来形成降阶矩阵 $B_{\\text{red}}$，通过 $B_{\\text{red}}^{-1}$ 求解非参考节点的电压相角 $\\theta_{\\text{red}}$，并计算每条线路 $(i,j)$ 的有向线路潮流 $f_{\\ell} = b_{\\ell}(\\theta_i - \\theta_j)$（以标幺值表示），然后使用 $S_{\\text{base}}$ 将其转换为兆瓦。\n\n定义每条线路潮流的方向为从索引较小的节点到索引较大的节点（例如，$(1,2)$ 的方向是从节点 $1$ 到节点 $2$）。最后，确定所有五条线路中线路潮流绝对值的最大值，并以兆瓦为单位报告其数值。以弧度表示节点电压相角，并将最终报告的兆瓦值四舍五入到四位有效数字。",
            "solution": "该问题经评估有效，因为它在科学上基于标准的电力系统分析，问题设定良好，数据充分且一致，并且表述客观。我们可以开始求解。\n\n直流潮流模型源于应用于网络中每个节点的基尔霍夫电流定律 (KCL)。节点 $i$ 处的有功功率注入（记为 $p_i$）必须等于离开该节点的所有相连输电线路上的有功潮流之和。在直流近似下，连接节点 $i$ 和节点 $j$ 的线路上的有功潮流 $f_{ij}$ 由 $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$ 给出，其中 $b_{ij}$ 是线路电纳，$\\theta_i$ 和 $\\theta_j$ 是节点电压相角。因此，节点 $i$ 处的 KCL 为 $p_i = \\sum_j b_{ij}(\\theta_i - \\theta_j)$，其中求和遍及所有与节点 $i$ 相连的节点 $j$。这个针对所有节点的线性方程组可以写成矩阵形式 $P = B\\theta$，其中 $P$ 是节点注入功率向量，$\\theta$ 是节点电压相角向量，$B$ 是节点电纳矩阵。\n\n首先，我们使用基准功率 $S_{\\text{base}} = 100$ MVA 将给定的净注入功率从兆瓦 (MW) 转换为标幺值 (p.u.)。\n以 p.u. 表示的注入功率向量为 $P = \\frac{1}{S_{\\text{base}}} p_{\\text{MW}}$。\n$$P = \\frac{1}{100} \\begin{pmatrix} 80 \\\\ -30 \\\\ -20 \\\\ -30 \\end{pmatrix} = \\begin{pmatrix} 0.8 \\\\ -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix} \\text{ p.u.}$$\n\n接下来，我们计算以 p.u. 表示的线路电纳 $b_{\\ell} = 1/x_{\\ell}$。\n$b_{12} = 1/x_{12} = 1/0.25 = 4.0$ p.u.\n$b_{23} = 1/x_{23} = 1/0.4 = 2.5$ p.u.\n$b_{34} = 1/x_{34} = 1/0.2 = 5.0$ p.u.\n$b_{14} = 1/x_{14} = 1/0.5 = 2.0$ p.u.\n$b_{24} = 1/x_{24} = 1/(1/3) = 3.0$ p.u.\n\n我们构建 $4 \\times 4$ 的节点电纳矩阵 $B$。对角元素 $B_{ii}$ 是连接到节点 $i$ 的所有线路的电纳之和。非对角元素 $B_{ij}$ ($i \\neq j$) 是连接节点 $i$ 和节点 $j$ 的线路电纳的相反数。\n$B_{11} = b_{12} + b_{14} = 4.0 + 2.0 = 6.0$\n$B_{22} = b_{12} + b_{23} + b_{24} = 4.0 + 2.5 + 3.0 = 9.5$\n$B_{33} = b_{23} + b_{34} = 2.5 + 5.0 = 7.5$\n$B_{44} = b_{14} + b_{24} + b_{34} = 2.0 + 3.0 + 5.0 = 10.0$\n\n$B_{12} = B_{21} = -b_{12} = -4.0$\n$B_{13} = B_{31} = 0$\n$B_{14} = B_{41} = -b_{14} = -2.0$\n$B_{23} = B_{32} = -b_{23} = -2.5$\n$B_{24} = B_{42} = -b_{24} = -3.0$\n$B_{34} = B_{43} = -b_{34} = -5.0$\n\n节点电纳矩阵 $B$ 为：\n$$B = \\begin{pmatrix} 6.0  -4.0  0  -2.0 \\\\ -4.0  9.5  -2.5  -3.0 \\\\ 0  -2.5  7.5  -5.0 \\\\ -2.0  -3.0  -5.0  10.0 \\end{pmatrix}$$\n\n矩阵 $B$ 是奇异的。这直接源于其基于 KCL 的构造方法。对于任意行 $i$，元素之和为 $\\sum_{j=1}^{4} B_{ij} = B_{ii} + \\sum_{j \\neq i} B_{ij} = (\\sum_{k \\neq i} b_{ik}) + \\sum_{j \\neq i} (-b_{ij}) = 0$。由于每行的和都为零，因此以 $1$ 为权重的列向量之和是零向量。这意味着向量 $\\mathbf{1} = \\begin{pmatrix} 1  1  1  1 \\end{pmatrix}^T$ 是 $B$ 的零空间的一个基，即 $B\\mathbf{1} = \\mathbf{0}$。非平凡的零空间意味着该矩阵是奇异的，其行列式为零。在物理上，这种奇异性意味着只有电压相角差 $(\\theta_i - \\theta_j)$ 影响潮流，而不是它们的绝对值。给所有相角增加一个恒定的偏移量，$\\theta' = \\theta + c\\mathbf{1}$，会得到相同的注入功率，因为 $B\\theta' = B(\\theta + c\\mathbf{1}) = B\\theta + cB\\mathbf{1} = P + \\mathbf{0} = P$。\n\n为了获得唯一解，我们必须指定一个参考相角。我们设置节点 $1$ 为参考节点，因此 $\\theta_1 = 0$。这使我们能够通过从系统 $P = B\\theta$ 中移除第一行和第一列来求解其余的相角。令 $\\theta_{\\text{red}} = \\begin{pmatrix} \\theta_2  \\theta_3  \\theta_4 \\end{pmatrix}^T$ 和 $P_{\\text{red}} = \\begin{pmatrix} p_2  p_3  p_4 \\end{pmatrix}^T$。降阶系统为 $P_{\\text{red}} = B_{\\text{red}}\\theta_{\\text{red}}$。\n$$P_{\\text{red}} = \\begin{pmatrix} -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix}, \\quad B_{\\text{red}} = \\begin{pmatrix} 9.5  -2.5  -3.0 \\\\ -2.5  7.5  -5.0 \\\\ -3.0  -5.0  10.0 \\end{pmatrix}$$\n我们通过对 $B_{\\text{red}}$ 求逆来求解 $\\theta_{\\text{red}}$：$\\theta_{\\text{red}} = B_{\\text{red}}^{-1} P_{\\text{red}}$。$B_{\\text{red}}$ 的行列式为：\n$\\det(B_{\\text{red}}) = 9.5(7.5 \\cdot 10.0 - (-5.0)^2) - (-2.5)(-2.5 \\cdot 10.0 - (-5.0)(-3.0)) + (-3.0)((-2.5)(-5.0) - 7.5(-3.0))$\n$\\det(B_{\\text{red}}) = 9.5(50) + 2.5(-40) - 3.0(35) = 475 - 100 - 105 = 270$。\n逆矩阵为 $B_{\\text{red}}^{-1} = \\frac{1}{\\det(B_{\\text{red}})} \\text{adj}(B_{\\text{red}})$。\n$$B_{\\text{red}}^{-1} = \\frac{1}{270} \\begin{pmatrix} 50  40  35 \\\\ 40  86  55 \\\\ 35  55  65 \\end{pmatrix}$$\n现在，我们计算相角向量 $\\theta_{\\text{red}}$：\n$$\\theta_{\\text{red}} = \\frac{1}{270} \\begin{pmatrix} 50  40  35 \\\\ 40  86  55 \\\\ 35  55  65 \\end{pmatrix} \\begin{pmatrix} -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix} = \\frac{1}{270} \\begin{pmatrix} -15 - 8 - 10.5 \\\\ -12 - 17.2 - 16.5 \\\\ -10.5 - 11 - 19.5 \\end{pmatrix} = \\frac{1}{270} \\begin{pmatrix} -33.5 \\\\ -45.7 \\\\ -41.0 \\end{pmatrix}$$\n因此，以弧度表示的节点电压相角为：\n$\\theta_1 = 0$\n$\\theta_2 = -33.5 / 270 \\approx -0.1241$ rad\n$\\theta_3 = -45.7 / 270 \\approx -0.1693$ rad\n$\\theta_4 = -41.0 / 270 \\approx -0.1519$ rad\n\n接下来，我们计算以 p.u. 表示的有向线路潮流 $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$，方向为从索引较小的节点到索引较大的节点。\n$f_{12} = b_{12}(\\theta_1 - \\theta_2) = 4.0(0 - (-33.5/270)) = 134/270$ p.u.\n$f_{14} = b_{14}(\\theta_1 - \\theta_4) = 2.0(0 - (-41.0/270)) = 82/270$ p.u.\n$f_{23} = b_{23}(\\theta_2 - \\theta_3) = 2.5(-33.5/270 - (-45.7/270)) = 2.5(12.2/270) = 30.5/270$ p.u.\n$f_{24} = b_{24}(\\theta_2 - \\theta_4) = 3.0(-33.5/270 - (-41.0/270)) = 3.0(7.5/270) = 22.5/270$ p.u.\n$f_{34} = b_{34}(\\theta_3 - \\theta_4) = 5.0(-45.7/270 - (-41.0/270)) = 5.0(-4.7/270) = -23.5/270$ p.u.\n\n最后，我们使用 $S_{\\text{base}} = 100$ MVA 将这些潮流转换为兆瓦，并找到最大绝对值。\n$|f_{12, \\text{MW}}| = |134/270| \\times 100 \\approx 49.6296$ MW\n$|f_{14, \\text{MW}}| = |82/270| \\times 100 \\approx 30.3704$ MW\n$|f_{23, \\text{MW}}| = |30.5/270| \\times 100 \\approx 11.2963$ MW\n$|f_{24, \\text{MW}}| = |22.5/270| \\times 100 \\approx 8.3333$ MW\n$|f_{34, \\text{MW}}| = |-23.5/270| \\times 100 \\approx 8.7037$ MW\n\n线路潮流绝对值的最大值出现在线路 $(1,2)$ 上，其值为 $49.6296...$ 兆瓦。四舍五入到四位有效数字得到 $49.63$ 兆瓦。",
            "answer": "$$\\boxed{49.63}$$"
        },
        {
            "introduction": "从物理建模转向经济优化，这项练习探讨了直流最优潮流（DC-OPF）的核心：在物理约束下最小化成本如何产生经济价格信号。通过为一个小型网络构建并解析求解卡鲁什-库恩-塔克（KKT）条件 ，您将从第一性原理层面理解节点边际电价（LMP）以及输电阻塞如何造成价格差异。",
            "id": "4083058",
            "problem": "考虑一个使用直流潮流近似的三节点输电网络。节点 $1$、$2$ 和 $3$ 通过串联电抗分别为 $x_{12} = 1$ 和 $x_{23} = 1$（基于统一基准的标幺值）的输电线路 $(1,2)$ 和 $(2,3)$ 呈辐射状连接。定义有向线路潮流，对于线路 $(i,j)$，其有功潮流为 $f_{ij} = (\\theta_i - \\theta_j)/x_{ij}$，其中 $\\theta_i$ 是节点 $i$ 的电压相角。设节点 $1$ 为相角参考点，其相角 $\\theta_1 = 0$。线路 $(2,3)$ 的热限制为 $|f_{23}| \\leq F_{23}^{\\max}$，其中 $F_{23}^{\\max} = 50$ 兆瓦。线路 $(1,2)$ 没有热限制。\n\n发电机位于节点 $1$ 和 $3$，其成本函数为凸二次函数。节点 $1$ 的成本为 $c_1(p_1) = \\tfrac{1}{2}\\,a_1\\,p_1^2 + b_1\\,p_1$，其中 $a_1 = 0.01$，$b_1 = 5$；节点 $3$ 的成本为 $c_3(p_3) = \\tfrac{1}{2}\\,a_3\\,p_3^2 + b_3\\,p_3$，其中 $a_3 = 0.01$，$b_3 = 15$。没有发电机容量限制。仅在节点 $3$ 有负荷，为 $d_3 = 100$ 兆瓦；$d_1 = d_2 = 0$ 兆瓦。节点 $2$ 没有发电或负荷。\n\n利用直流潮流关系，建立直流最优潮流 (DC OPF) 问题模型：以总发电成本最小为目标，并满足各节点的功率平衡约束以及线路 $(2,3)$ 的热限制约束。写出由 Karush–Kuhn–Tucker (KKT) 系统给出的充分必要最优性条件，将不等式 $f_{23} \\leq F_{23}^{\\max}$ 和 $-f_{23} \\leq F_{23}^{\\max}$ 分开处理。解析求解 KKT 系统，得到最优发电调度 $\\{p_1, p_3\\}$、对应的最优相角 $\\{\\theta_2, \\theta_3\\}$ 以及节点边际电价 (LMPs) $\\{\\lambda_1, \\lambda_2, \\lambda_3\\}$，其中每个 $\\lambda_i$ 是与节点 $i$ 的功率平衡相关的拉格朗日乘子。\n\n最后，根据阻塞和边际成本解释所得的 LMPs，并以 LMP 行向量 $[\\lambda_1, \\lambda_2, \\lambda_3]$ 的形式给出最终答案，单位为 $\\$/\\mathrm{MWh}$。无需四舍五入；报告精确值。",
            "solution": "首先根据指定标准对问题进行验证。该问题是一个标准的直流最优潮流 (DC OPF) 模型，这是电力系统工程中一个成熟且有科学依据的模型。它提供了一套完整且一致的数据，包括网络拓扑、线路电抗、发电机成本函数、负荷数据和输电线路限制。目标函数明确，约束条件定义清晰。因此，该问题被认为是有效的，因为它科学合理、适定、客观且完整。\n\n直流最优潮流 (DC OPF) 问题被构建为在满足网络约束的条件下最小化总发电成本。\n\n总发电成本 $C$ 是节点 $1$ 和节点 $3$ 的成本之和：\n$$ C(p_1, p_3) = c_1(p_1) + c_3(p_3) = \\left(\\frac{1}{2}a_1 p_1^2 + b_1 p_1\\right) + \\left(\\frac{1}{2}a_3 p_3^2 + b_3 p_3\\right) $$\n代入给定值 $a_1=0.01$，$b_1=5$，$a_3=0.01$ 和 $b_3=15$：\n$$ C(p_1, p_3) = 0.005 p_1^2 + 5 p_1 + 0.005 p_3^2 + 15 p_3 $$\n\n约束条件如下：\n1.  **节点功率平衡方程**：设 $\\lambda_i$ 为节点 $i$ 功率平衡的拉格朗日乘子（节点边际电价，LMP）。\n    -   节点 1：$p_1 - f_{12} = d_1 = 0 \\quad (\\lambda_1)$\n    -   节点 2：$f_{12} - f_{23} = d_2 = 0 \\quad (\\lambda_2)$\n    -   节点 3：$p_3 + f_{23} = d_3 = 100 \\quad (\\lambda_3)$\n\n2.  **直流潮流方程**：有功潮流 $f_{ij}$ 由 $f_{ij} = (\\theta_i - \\theta_j)/x_{ij}$ 给出。其中 $\\theta_1 = 0$，$x_{12} = 1$，$x_{23} = 1$：\n    -   $f_{12} = \\frac{\\theta_1 - \\theta_2}{x_{12}} = \\frac{0 - \\theta_2}{1} = -\\theta_2$\n    -   $f_{23} = \\frac{\\theta_2 - \\theta_3}{x_{23}} = \\frac{\\theta_2 - \\theta_3}{1} = \\theta_2 - \\theta_3$\n\n3.  **热限制**：限制条件 $|f_{23}| \\leq F_{23}^{\\max}$（其中 $F_{23}^{\\max}=50$）被视为两个独立的不等式约束，其非负乘子为 $\\mu_{23}^+$ 和 $\\mu_{23}^-$。\n    -   $f_{23} - 50 \\leq 0 \\implies \\theta_2 - \\theta_3 - 50 \\leq 0 \\quad (\\mu_{23}^+ \\geq 0)$\n    -   $-f_{23} - 50 \\leq 0 \\implies -(\\theta_2 - \\theta_3) - 50 \\leq 0 \\quad (\\mu_{23}^- \\geq 0)$\n\n将潮流方程代入平衡方程：\n-   $p_1 + \\theta_2 = 0$\n-   $-\\theta_2 - (\\theta_2 - \\theta_3) = 0 \\implies \\theta_3 = 2\\theta_2$\n-   $p_3 + \\theta_2 - \\theta_3 = 100$\n\n此问题的拉格朗日函数 $\\mathcal{L}$ 为：\n$$ \\mathcal{L} = (0.005 p_1^2 + 5 p_1 + 0.005 p_3^2 + 15 p_3) - \\lambda_1(p_1 + \\theta_2) - \\lambda_2(-\\theta_2 - (\\theta_2 - \\theta_3)) - \\lambda_3(p_3 + \\theta_2 - \\theta_3 - 100) + \\mu_{23}^+(\\theta_2 - \\theta_3 - 50) + \\mu_{23}^-(-\\theta_2 + \\theta_3 - 50) $$\n\n最优性的 Karush-Kuhn-Tucker (KKT) 条件如下：\n**驻点条件：**\n1.  $\\frac{\\partial\\mathcal{L}}{\\partial p_1} = 0.01 p_1 + 5 - \\lambda_1 = 0 \\implies \\lambda_1 = 0.01 p_1 + 5$\n2.  $\\frac{\\partial\\mathcal{L}}{\\partial p_3} = 0.01 p_3 + 15 - \\lambda_3 = 0 \\implies \\lambda_3 = 0.01 p_3 + 15$\n3.  $\\frac{\\partial\\mathcal{L}}{\\partial \\theta_2} = -\\lambda_1 + 2\\lambda_2 - \\lambda_3 + \\mu_{23}^+ - \\mu_{23}^- = 0$\n4.  $\\frac{\\partial\\mathcal{L}}{\\partial \\theta_3} = -\\lambda_2 + \\lambda_3 - \\mu_{23}^+ + \\mu_{23}^- = 0$\n\n**原始可行性：**\n5.  $p_1 + \\theta_2 = 0$\n6.  $\\theta_3 = 2\\theta_2$\n7.  $p_3 + \\theta_2 - \\theta_3 = 100$\n8.  $\\theta_2 - \\theta_3 \\leq 50$\n9.  $-(\\theta_2 - \\theta_3) \\leq 50$\n\n**对偶可行性：**\n10. $\\mu_{23}^+ \\geq 0$, $\\mu_{23}^- \\geq 0$\n\n**互补松弛性：**\n11. $\\mu_{23}^+(\\theta_2 - \\theta_3 - 50) = 0$\n12. $\\mu_{23}^-(-\\theta_2 + \\theta_3 - 50) = 0$\n\n我们首先假设线路未发生阻塞，即 $\\mu_{23}^+ = 0$ 且 $\\mu_{23}^- = 0$，来求解 KKT 系统。\n从 KKT (4) 得，$-\\lambda_2 + \\lambda_3 = 0 \\implies \\lambda_2 = \\lambda_3$。\n从 KKT (3) 得，$-\\lambda_1 + 2\\lambda_2 - \\lambda_3 = 0 \\implies -\\lambda_1 + 2\\lambda_3 - \\lambda_3 = 0 \\implies \\lambda_1 = \\lambda_3$。\n因此，$\\lambda_1 = \\lambda_2 = \\lambda_3$。令 KKT (1) 和 (2) 的边际成本相等：\n$0.01 p_1 + 5 = 0.01 p_3 + 15 \\implies p_1 - p_3 = 1000$。\n将节点功率平衡方程相加可得总发电量等于总需求量：$p_1 + p_3 = 100$。\n求解这两个关于 $p_1$ 和 $p_3$ 的线性方程：\n$(p_3 + 1000) + p_3 = 100 \\implies 2p_3 = -900 \\implies p_3 = -450$。\n则 $p_1 = 100 - p_3 = 100 - (-450) = 550$。\n尽管这在物理上不寻常，我们来检查一下线路潮流。从平衡方程得：$f_{12} = p_1 = 550$，且 $f_{12} = f_{23}$，所以 $f_{23} = 550$。\n潮流 $f_{23} = 550$ MW 违反了热限制 $|f_{23}| \\leq 50$ MW。\n因此，无阻塞的假设是错误的。线路 $(2,3)$ 必然发生了阻塞。\n\n由于无约束调度试图使一条大的正向潮流通过线路 $(2,3)$，因此紧约束必然是 $f_{23} \\leq 50$。这意味着：\n- 线路潮流达到其极限：$f_{23} = \\theta_2 - \\theta_3 = 50$。\n- 相应的乘子是激活的：$\\mu_{23}^+ > 0$。\n- 另一个不等式是松弛的，因此其乘子为零：$\\mu_{23}^- = 0$。\n\n在 $f_{23}=50$ 的条件下，我们使用功率平衡方程求解原始变量：\n- 节点 2：$f_{12} = f_{23} \\implies f_{12} = 50$。\n- 节点 1：$p_1 = f_{12} \\implies p_1 = 50$ MW。\n- 节点 3：$p_3 + f_{23} = 100 \\implies p_3 + 50 = 100 \\implies p_3 = 50$ MW。\n最优发电调度为 $\\{p_1, p_3\\} = \\{50, 50\\}$。\n\n现在我们求解最优相角：\n- 从 $f_{12} = -\\theta_2 = 50$，我们得到 $\\theta_2 = -50$。\n- 从 $f_{23} = \\theta_2 - \\theta_3 = 50$，我们得到 $-50 - \\theta_3 = 50 \\implies \\theta_3 = -100$。\n这与 KKT (6) 一致，因为 $\\theta_3 = -100$ 且 $2\\theta_2 = 2(-50) = -100$。最优相角为 $\\{\\theta_2, \\theta_3\\} = \\{-50, -100\\}$。\n\n接下来，我们使用 KKT (1) 和 (2) 计算 LMPs：\n- $\\lambda_1 = 0.01 p_1 + 5 = 0.01(50) + 5 = 0.5 + 5 = 5.5$。\n- $\\lambda_3 = 0.01 p_3 + 15 = 0.01(50) + 15 = 0.5 + 15 = 15.5$。\n\n最后，我们从 KKT (3) 和 (4) 中求解 $\\lambda_2$ 和 $\\mu_{23}^+$，其中 $\\mu_{23}^- = 0$：\n- KKT (4)：$-\\lambda_2 + \\lambda_3 - \\mu_{23}^+ = 0 \\implies \\lambda_2 = \\lambda_3 - \\mu_{23}^+ = 15.5 - \\mu_{23}^+$。\n- KKT (3)：$-\\lambda_1 + 2\\lambda_2 - \\lambda_3 + \\mu_{23}^+ = 0 \\implies 2\\lambda_2 + \\mu_{23}^+ = \\lambda_1 + \\lambda_3 = 5.5 + 15.5 = 21$。\n将第一个方程代入第二个方程：\n$2(15.5 - \\mu_{23}^+) + \\mu_{23}^+ = 21 \\implies 31 - 2\\mu_{23}^+ + \\mu_{23}^+ = 21 \\implies 31 - \\mu_{23}^+ = 21 \\implies \\mu_{23}^+ = 10$。\n由于 $\\mu_{23}^+ = 10 > 0$，我们关于阻塞的假设是一致的。\n现在我们求 $\\lambda_2$：\n$\\lambda_2 = 15.5 - \\mu_{23}^+ = 15.5 - 10 = 5.5$。\nLMPs 为 $\\{\\lambda_1, \\lambda_2, \\lambda_3\\} = \\{5.5, 5.5, 15.5\\}$，单位为 $\\$/\\mathrm{MWh}$。\n\n**LMP 的解释**：\n一个节点的节点边际电价 (LMP) 代表在该节点供应下一兆瓦负荷的边际成本。\n- $\\lambda_1 = 5.5$ $/MWh 是节点 1 的边际发电成本，因为 $c_1'(50) = 0.01(50)+5=5.5$。\n- $\\lambda_3 = 15.5$ $/MWh 是节点 3 的边际发电成本，因为 $c_3'(50) = 0.01(50)+15=15.5$。\n- 整个网络的 LMPs 并不统一，这表明存在输电阻塞。线路 $(1,2)$ 未发生阻塞，所以 $\\lambda_1 = \\lambda_2 = 5.5$。\n- 线路 $(2,3)$ 发生阻塞，导致节点 2 和节点 3 之间出现价格差异。LMP 的差值 $\\lambda_3 - \\lambda_2 = 15.5 - 5.5 = 10$ $/MWh，是阻塞的边际成本。该值等于线路上 $(2,3)$ 的紧约束热限制的影子价格（拉格朗日乘子）$\\mu_{23}^+ = 10$。这个价格反映了因被迫调度节点 3 更昂贵的发电机，而不能从节点 1 输送更多廉价电力所产生的额外成本。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 5.5  5.5  15.5 \\end{pmatrix} } $$"
        },
        {
            "introduction": "为了连接理论与实际应用，最后一项练习将要求您创建一个计算工具来执行经济调度。您需要将直流最优潮流问题  转化为标准的线性规划（LP）形式，并实现一个求解器，为不同的需求情景找到最优的发电调度方案。这项练习将巩固您对从问题构建、计算求解到结果解读（如节点边际电价）的完整直流最优潮流工作流程的理解。",
            "id": "4086771",
            "problem": "您必须编写一个完整、可运行的程序，用于求解一个三母线网络中的直流最优潮流 (DC OPF) 问题，该问题包含线性发电机成本、发电机容量限制、节点功率平衡约束以及单条输电线路的潮流限制。该问题以纯数学术语提出，并且必须使用直流潮流的第一性原理建模来解决。物理功率量单位必须是兆瓦 (MW)，角度单位为弧度，价格单位为美元/兆瓦 ($/MW)。\n\n基本基准和定义：\n- 在直流潮流近似下，线路 $(i,j)$ 上的有功功率潮流由 $P_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$ 给出，其中 $\\theta_i$ 和 $\\theta_j$ 是以弧度为单位的母线电压相角，而 $b_{ij}$ 是按系统基准功率换算后的线路电纳。\n- 母线 $i$ 处的节点功率平衡由 $p_i = \\sum_{j} b_{ij} \\left( \\theta_i - \\theta_j \\right)$ 给出，其中 $p_i$ 是母线 $i$ 处的净注入功率，等于发电功率减去负荷，即 $p_i = P_i - D_i$。\n- 每个母线处的基尔霍夫电流定律确保了所有接入线路的潮流之和等于净注入功率。\n- 经济调度旨在满足上述物理约束的同时，最小化总发电成本。\n\n网络参数说明：\n- 三个母线，标记为 $1$、$2$ 和 $3$。\n- 线路：$(1,2)$、$(1,3)$、$(2,3)$。\n- 电抗（单位：p.u.），基于 $100$ 兆伏安 (MVA) 基准：$x_{12} = 0.25$，$x_{13} = 0.25$，$x_{23} = 0.50$。在电压幅值接近 $1$ p.u. 并使用基准功率的情况下，有效电纳（单位：MW/rad）为 $b_{12} = \\frac{1}{x_{12}} \\cdot 100 = 400$，$b_{13} = \\frac{1}{x_{13}} \\cdot 100 = 400$，$b_{23} = \\frac{1}{x_{23}} \\cdot 100 = 200$。\n- 母线电纳矩阵 $B_{\\text{bus}}$（单位：MW/rad）为：\n$$\nB_{\\text{bus}} =\n\\begin{bmatrix}\n800  -400  -400 \\\\\n-400  600  -200 \\\\\n-400  -200  600\n\\end{bmatrix}.\n$$\n- 参考（平衡）母线为母线 $1$，其相角固定为 $\\theta_1 = 0$ 弧度。\n\n发电机：\n- 每个母线一台发电机，其成本函数为线性函数 $C_i(P_i) = c_i P_i$，其中对于母线 $1$、$2$ 和 $3$，成本系数 $c = [10, 12, 30]$（单位：$/MW）。\n- 发电机容量限制：$P^{\\max} = [100, 100, 50]$ MW 和 $P^{\\min} = [0, 0, 0]$ MW。\n\n约束条件：\n- 节点功率平衡（对于 $i = 1,2,3$）：$P_i - D_i = \\sum_j b_{ij} \\left( \\theta_i - \\theta_j \\right)$。\n- 平衡母线相角：$\\theta_1 = 0$ 弧度。\n- 线路 $(1,2)$ 有一个热稳定潮流限制 $\\left| P_{12} \\right| \\leq F_{12}^{\\max}$，其中 $F_{12}^{\\max} = 40$ MW。其他线路没有有功潮流限制。\n- 发电机边界：$0 \\leq P_i \\leq P_i^{\\max}$。\n\n目标函数：\n- 最小化总成本 $C_{\\text{total}} = \\sum_{i=1}^{3} c_i P_i$。\n\n每个测试用例需要输出：\n- 最优发电向量 $[P_1, P_2, P_3]$，单位为 MW。\n- 线路潮流 $[P_{12}, P_{13}, P_{23}]$，单位为 MW，计算方式为 $P_{12} = b_{12}(\\theta_1 - \\theta_2)$、$P_{13} = b_{13}(\\theta_1 - \\theta_3)$、$P_{23} = b_{23}(\\theta_2 - \\theta_3)$。\n- 节点边际电价 (LMPs) $[\\lambda_1, \\lambda_2, \\lambda_3]$，单位为 $/MW，其中 $\\lambda_i$ 对应于母线 $i$ 处节点功率平衡的影子价格。\n\n所有角度必须以弧度为单位。所有功率必须以兆瓦 (MW) 为单位。所有价格必须以美元/兆瓦 ($/MW) 为单位。输出中不允许使用其他单位。\n\n需实现的数学公式：\n- 决策变量为 $[P_1, P_2, P_3, \\theta_2, \\theta_3]$，其中 $\\theta_1 = 0$ 为固定值。\n- 由节点平衡导出的等式约束（代入 $\\theta_1 = 0$）：\n$$\n\\begin{aligned}\nP_1 - D_1 + b_{12} \\theta_2 + b_{13} \\theta_3 = 0, \\\\\nP_2 - D_2 - (b_{12} + b_{23}) \\theta_2 + b_{23} \\theta_3 = 0, \\\\\nP_3 - D_3 + b_{23} \\theta_2 - (b_{13} + b_{23}) \\theta_3 = 0.\n\\end{aligned}\n$$\n- 针对线路 $(1,2)$ 的单一线路限制的不等式约束：\n$$\n-b_{12} \\theta_2 \\le F_{12}^{\\max}, \\quad b_{12} \\theta_2 \\le F_{12}^{\\max}.\n$$\n- 发电机边界：$0 \\le P_1 \\le 100$，$0 \\le P_2 \\le 100$，$0 \\le P_3 \\le 50$。相角变量 $\\theta_2, \\theta_3$ 除了由等式约束和线路约束所隐含的限制外，不受其他约束。\n\n测试套件：\n- 用例 1：负荷 $D = [50, 50, 50]$ MW。\n- 用例 2：负荷 $D = [30, 120, 30]$ MW。\n- 用例 3：负荷 $D = [90, 110, 50]$ MW。\n\n您的程序应为每个测试用例求解直流最优潮流问题，提取最优的 $[P_1, P_2, P_3]$，计算 $[P_{12}, P_{13}, P_{23}]$，并获得节点影子价格 $[\\lambda_1, \\lambda_2, \\lambda_3]$。最终输出必须是单行，包含一个由三个内部列表组成的逗号分隔列表，每个测试用例一个列表，不含空格，格式完全如下：\n\"[ [P1_case1,P2_case1,P3_case1,P12_case1,P13_case1,P23_case1,lambda1_case1,lambda2_case1,lambda3_case1], [P1_case2,P2_case2,P3_case2,P12_case2,P13_case2,P23_case2,lambda1_case2,lambda2_case2,lambda3_case2], [P1_case3,P2_case3,P3_case3,P12_case3,P13_case3,P23_case3,lambda1_case3,lambda2_case3,lambda3_case3] ]\"\n为避免歧义，您的程序应精确地生成单行输出，其中包含一个顶级列表，该列表包含三个以逗号分隔的内部列表，每个内部列表包含九个数字，打印的字符串中任何位置都不能有空格。所有值都必须表示为标准十进制数。",
            "solution": "用户提供的问题陈述已经过严格评估，并被确定为 **有效**。\n\n### 步骤 1：提取的已知条件\n\n- **基本物理模型**：该问题基于直流 (DC) 潮流近似。\n  - 线路有功功率潮流：$P_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$。\n  - 节点功率平衡：$p_i = P_i - D_i = \\sum_{j} b_{ij} \\left( \\theta_i - \\theta_j \\right)$。\n- **网络数据**：\n  - 母线：$3$个（标记为 $1, 2, 3$）。\n  - 线路：$(1,2), (1,3), (2,3)$。\n  - 基准功率：$100$ MVA。\n  - 线路电抗（单位值）：$x_{12} = 0.25$，$x_{13} = 0.25$，$x_{23} = 0.50$。\n  - 线路电纳（MW/rad）：$b_{12} = 400$，$b_{13} = 400$，$b_{23} = 200$。\n  - 母线电纳矩阵 $B_{\\text{bus}}$（MW/rad）：\n    $$\n    B_{\\text{bus}} =\n    \\begin{bmatrix}\n    800  -400  -400 \\\\\n    -400  600  -200 \\\\\n    -400  -200  600\n    \\end{bmatrix}.\n    $$\n- **参考母线**：母线 $1$ 是平衡母线，其电压相角固定：$\\theta_1 = 0$ 弧度。\n- **发电机数据**：\n  - 线性成本函数：$C_i(P_i) = c_i P_i$。\n  - 成本系数：$c = [10, 12, 30]$（$/MW），用于母线 $1, 2, 3$ 上的发电机。\n  - 容量限制：$P^{\\min} = [0, 0, 0]$ MW，$P^{\\max} = [100, 100, 50]$ MW。\n- **约束条件**：\n  - 每个母线的功率平衡方程。\n  - 线路 $(1,2)$ 上的单个热限制：$|P_{12}| \\leq 40$ MW。\n  - 发电机出力限制：$0 \\leq P_i \\leq P_i^{\\max}$。\n- **目标函数**：最小化总发电成本 $C_{\\text{total}} = \\sum_{i=1}^{3} c_i P_i$。\n- **决策变量**：$[P_1, P_2, P_3, \\theta_2, \\theta_3]$。\n- **测试用例（负荷）**：\n  - 用例 1：$D = [50, 50, 50]$ MW。\n  - 用例 2：$D = [30, 120, 30]$ MW。\n  - 用例 3：$D = [90, 110, 50]$ MW。\n- **要求输出**：最优发电量 $[P_1, P_2, P_3]$、线路潮流 $[P_{12}, P_{13}, P_{23}]$ 和节点边际电价 (LMP) $[\\lambda_1, \\lambda_2, \\lambda_3]$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n根据指定标准对问题进行评估：\n- **科学依据**：直流最优潮流 (DC OPF) 是电力系统工程中用于经济分析的一种标准、广泛使用且易于理解的方法。该公式在科学上是合理的。\n- **适定性**：该问题是一个线性规划 (LP) 问题，其特点是具有线性目标函数和一组线性等式及不等式约束。因此，它是一个凸优化问题，具有适定性，并且在存在可行解的情况下有唯一的最小成本。所提供的负荷相对于发电容量而言是合理的。\n- **客观性**：该问题使用精确的数学和工程术语进行陈述，所有常数和参数都已明确定义。没有主观或模棱两可的语言。\n- **完整性和一致性**：所有必要的数据（网络拓扑、阻抗、成本、限制、负荷）均已提供。从电抗推导电纳的过程是正确的 ($b=1/x \\cdot 100$)。提供的 $B_{\\text{bus}}$ 矩阵与线路电纳一致。指定的功率平衡方程对于给定的网络和选择的平衡母线是正确的。该问题是自洽的，且内部一致。\n\n### 步骤 3：结论和行动\n\n该问题是 **有效** 的。这是一个标准的直流最优潮流问题，可以使用线性规划来解决。解决方案的步骤是，将问题表述为标准线性规划形式，并对每个测试用例进行求解。\n\n### 解法构建\n\n直流最优潮流问题将被构建为标准形式的线性规划 (LP) 问题，可以使用 `scipy.optimize.linprog` 求解：\n$$\n\\begin{align*}\n\\min_{x} \\quad  c^T x \\\\\n\\text{subject to} \\quad  A_{eq} x = b_{eq} \\\\\n A_{ub} x \\leq b_{ub} \\\\\n lb \\leq x \\leq ub\n\\end{align*}\n$$\n\n**1. 决策变量 ($x$)**\n决策变量向量 $x$ 包括发电机有功功率输出和非参考母线的电压相角：\n$$x = [P_1, P_2, P_3, \\theta_2, \\theta_3]^T$$\n\n**2. 目标函数 ($c^T x$)**\n目标是最小化总发电成本，$C_{\\text{total}} = 10 P_1 + 12 P_2 + 30 P_3$。母线相角没有成本。因此，成本向量 $c$ 为：\n$$c = [10, 12, 30, 0, 0]^T$$\n\n**3. 等式约束 ($A_{eq} x = b_{eq}$)**\n节点功率平衡方程构成等式约束。给定 $\\theta_1=0$，将问题陈述中提供的方程重新排列以适应标准形式 `A_eq * x = b_eq`：\n`P_1 - D_1 = -b_12 * theta_2 - b_13 * theta_3` 变为 `P_1 + b_12 * theta_2 + b_13 * theta_3 = D_1`。\n`P_2 - D_2 = b_12 * theta_2 + b_23 * (theta_2 - theta_3)` 变为 `P_2 - (b_12 + b_23) * theta_2 + b_23 * theta_3 = D_2`。\n`P_3 - D_3 = b_13 * theta_3 + b_23 * (theta_3 - theta_2)` 变为 `P_3 + b_23 * theta_2 - (b_13 + b_23) * theta_3 = D_3`。\n这给出了等式约束矩阵 $A_{eq}$ 和向量 $b_{eq}$：\n$$\nA_{eq} = \\begin{bmatrix}\n1  & 0 & 0 & b_{12} & b_{13} \\\\\n0  & 1 & 0 & -(b_{12} + b_{23}) & b_{23} \\\\\n0  & 0 & 1 & b_{23} & -(b_{13} + b_{23})\n\\end{bmatrix}, \\quad\nb_{eq} = \\begin{bmatrix} D_1 \\\\ D_2 \\\\ D_3 \\end{bmatrix}\n$$\n向量 $b_{eq}$ 将根据给定的负荷 $D$ 为每个测试用例进行更新。\n\n**4. 变量边界 ($lb \\leq x \\leq ub$)**\n变量的边界源自发电机容量限制和输电线路潮流限制。\n- 发电机限制：\n  - $0 \\leq P_1 \\leq 100$\n  - $0 \\leq P_2 \\leq 100$\n  - $0 \\leq P_3 \\leq 50$\n- 输电线路限制：线路 $(1,2)$ 上的潮流是 $P_{12} = b_{12}(\\theta_1 - \\theta_2) = -b_{12}\\theta_2$。约束是 $|P_{12}| \\leq 40$，这意味着 $|-400\\theta_2| \\leq 40$，或 $|\\theta_2| \\leq 40/400 = 0.1$。\n  - $-0.1 \\leq \\theta_2 \\leq 0.1$\n- 相角 $\\theta_3$ 无界。\n这些约束可以表示为决策变量的下界和上界：\n$$\nlb = [0, 0, 0, -0.1, -\\infty]^T, \\quad ub = [100, 100, 50, 0.1, +\\infty]^T\n$$\n将线路限制纳入边界后，不再需要不等式约束矩阵 $A_{ub}$ 和 $b_{ub}$。\n\n**5. 后处理**\n一旦针对给定的负荷向量 $D$ 求解了优化问题，得到最优解向量 $x^* = [P_1^*, P_2^*, P_3^*, \\theta_2^*, \\theta_3^*]^T$，就可以计算所需的输出：\n- **最优发电量**：$[P_1^*, P_2^*, P_3^*]$ 是 $x^*$ 的前三个元素。\n- **线路潮流**：使用最优相角计算，其中 $\\theta_1=0$：\n  - $P_{12} = b_{12}(\\theta_1 - \\theta_2^*) = -400 \\theta_2^*$\n  - $P_{13} = b_{13}(\\theta_1 - \\theta_3^*) = -400 \\theta_3^*$\n  - $P_{23} = b_{23}(\\theta_2^* - \\theta_3^*) = 200(\\theta_2^* - \\theta_3^*)$\n- **节点边际电价 (LMP)**：LMP $[\\lambda_1, \\lambda_2, \\lambda_3]$ 是与节点功率平衡等式约束相关的对偶变量（影子价格）。`scipy.optimize.linprog` 函数将这些值作为 `res.eqlin.marginals` 返回。这些值代表在每个母线供应额外一兆瓦电力的边际成本。\n\n此完整公式将针对问题中指定的三个测试用例中的每一个进行实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of DC Optimal Power Flow (DC-OPF) problems for a 3-bus network.\n\n    The problem is formulated as a Linear Program (LP) and solved using scipy.optimize.linprog.\n    The decision variables are x = [P1, P2, P3, theta2, theta3].\n    \"\"\"\n    \n    # ----------------------------------------------------------------------\n    # Define constants and problem parameters based on the problem statement\n    # ----------------------------------------------------------------------\n    \n    # Generator cost coefficients ($/MW)\n    c_gen = np.array([10.0, 12.0, 30.0])\n    \n    # Generator min/max power output (MW)\n    P_min = np.array([0.0, 0.0, 0.0])\n    P_max = np.array([100.0, 100.0, 50.0])\n    \n    # Line susceptances (MW/rad)\n    b12 = 400.0\n    b13 = 400.0\n    b23 = 200.0\n    \n    # Line flow limit for line (1,2) (MW)\n    F12_max = 40.0\n    \n    # Test cases: Demand vectors D = [D1, D2, D3] (MW)\n    test_cases = [\n        np.array([50.0, 50.0, 50.0]),\n        np.array([30.0, 120.0, 30.0]),\n        np.array([90.0, 110.0, 50.0]),\n    ]\n\n    # ----------------------------------------------------------------------\n    # Construct the LP matrices and vectors\n    # ----------------------------------------------------------------------\n    \n    # Objective function vector c for x = [P1, P2, P3, theta2, theta3]\n    # Costs are associated with P1, P2, P3. Angles theta2, theta3 have zero cost.\n    c = np.array([ c_gen[0], c_gen[1], c_gen[2], 0.0, 0.0 ])\n    \n    # Equality constraints: A_eq * x = b_eq\n    # Nodal power balance equations\n    # P1 + b12*theta2 + b13*theta3 = D1\n    # P2 - (b12+b23)*theta2 + b23*theta3 = D2\n    # P3 + b23*theta2 - (b13+b23)*theta3 = D3\n    A_eq = np.array([\n        [1, 0, 0, b12, b13],\n        [0, 1, 0, -(b12 + b23), b23],\n        [0, 0, 1, b23, -(b13 + b23)]\n    ])\n    \n    # Bounds for variables: lb = x = ub\n    # Bounds for P1, P2, P3\n    p_bounds = list(zip(P_min, P_max))\n    \n    # Bounds for theta2 from line limit: |P12| = F12_max\n    # |b12 * (theta1 - theta2)| = F12_max. With theta1=0, |-b12*theta2| = F12_max\n    # |theta2| = F12_max / b12\n    theta2_limit = F12_max / b12\n    theta_bounds = [(-theta2_limit, theta2_limit), (None, None)] # theta3 is unbounded\n    \n    bounds = p_bounds + theta_bounds\n\n    results = []\n    \n    # ----------------------------------------------------------------------\n    # Solve the LP for each test case\n    # ----------------------------------------------------------------------\n    for D in test_cases:\n        # The right-hand side of the equality constraints is the demand vector D\n        b_eq = D\n        \n        # Solve the linear program\n        res = linprog(c=c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res.success:\n            # Handle cases where the solver fails (e.g., infeasible)\n            # For this problem set, solutions are expected to exist.\n            # Using placeholder values if a case were to fail.\n            case_result = [np.nan] * 9\n        else:\n            # Extract optimal solution\n            P1_opt, P2_opt, P3_opt, theta2_opt, theta3_opt = res.x\n            \n            # Store optimal generation\n            P_opt = [P1_opt, P2_opt, P3_opt]\n            \n            # Calculate line flows with theta1=0\n            P12_flow = b12 * (0 - theta2_opt)\n            P13_flow = b13 * (0 - theta3_opt)\n            P23_flow = b23 * (theta2_opt - theta3_opt)\n            \n            flows = [P12_flow, P13_flow, P23_flow]\n            \n            # Extract Locational Marginal Prices (LMPs)\n            # These are the dual variables of the nodal power balance equality constraints\n            LMPs = res.eqlin.marginals\n            \n            # Combine all results for the current case\n            case_result = P_opt + flows + list(LMPs)\n            \n        results.append(case_result)\n\n    # ----------------------------------------------------------------------\n    # Format and print the final output exactly as specified\n    # ----------------------------------------------------------------------\n    # Convert each inner list of numbers to a comma-separated string\n    case_strings = [','.join(map(str, case)) for case in results]\n    # Join the case strings into the final list-of-lists format\n    output_string = f\"[[{case_strings[0]}],[{case_strings[1]}],[{case_strings[2]}]]\"\n    \n    print(output_string)\n\nsolve()\n```"
        }
    ]
}