{
    "hands_on_practices": [
        {
            "introduction": "第一个实践练习聚焦于电力系统分析的基石：标幺值系统。通过将高压输电线路的物理参数转换为标准化的基准值，我们可以简化全网络的计算，并对不同组件进行有意义的比较。本练习  还将突显建模选择的实际影响，特别是通过量化忽略线路并联电纳时的误差，这是一个常见的简化方法，其有效性取决于线路的具体特性。",
            "id": "4132685",
            "problem": "一条平衡三相特高压 (EHV) 输电走廊连接两个区域中心，距离为 $300\\,\\mathrm{km}$，在 $60\\,\\mathrm{Hz}$ 频率下以 $500\\,\\mathrm{kV}$ 的标称线电压运行。该走廊是换位的，其整个 $300\\,\\mathrm{km}$ 跨度的铭牌正序集总参数在基波频率下测得，如下所示：串联电阻 $R = 6.00\\,\\Omega$，串联电抗 $X = 90.0\\,\\Omega$，以及每相总并联充电电纳 $B = 1.357 \\times 10^{-3}\\,\\mathrm{S}$。考虑三相视在功率基准为 $S_{\\text{base}} = 1000\\,\\mathrm{MVA}$，线电压基准为 $V_{\\text{base}} = 500\\,\\mathrm{kV}$。\n\n仅从标准三相标幺值归一化定义和输电线路的π型等效模型出发，完成以下任务：\n- 在选定的基准上，计算标幺串联电阻 $r$、标幺串联电抗 $x$ 和标幺并联电纳 $b$。\n- 如果该走廊仅用其串联阻抗建模，且其并联充电电纳 $B$ 被忽略，请量化在标称 $500\\,\\mathrm{kV}$ 运行电压下，无功功率计算中引入的误差大小。将此误差表示为一个在 $S_{\\text{base}} = 1000\\,\\mathrm{MVA}$ 基准下的无单位标幺值。\n\n将这四个量按 $\\{r, x, b, \\text{error}\\}$ 的顺序以单行向量的形式报告。将所有四个报告值四舍五入至四位有效数字，并将其表示为无单位的标幺值。不允许有其他输出。",
            "solution": "**解答构建**\n解答需要两个主要部分：首先，计算输电线路的标幺参数；其次，量化忽略并联电纳时的无功功率误差。\n\n**第一部分：标幺参数计算**\n标幺系统将各物理量相对于一组选定的基准值进行归一化。基准阻抗 $Z_{\\text{base}}$ 是一个派生基准量，由基准电压和基准功率计算得出。对于三相系统，其定义为：\n$$Z_{\\text{base}} = \\frac{(V_{\\text{base, LL}})^2}{S_{\\text{base, 3}\\phi}}$$\n其中 $V_{\\text{base, LL}}$ 是线电压基准，$S_{\\text{base, 3}\\phi}$ 是三相视在功率基准。\n\n给定值：\n-   $V_{\\text{base}} = 500\\,\\mathrm{kV} = 500 \\times 10^3\\,\\mathrm{V}$\n-   $S_{\\text{base}} = 1000\\,\\mathrm{MVA} = 1000 \\times 10^6\\,\\mathrm{VA}$\n\n我们计算基准阻抗：\n$$Z_{\\text{base}} = \\frac{(500 \\times 10^3\\,\\mathrm{V})^2}{1000 \\times 10^6\\,\\mathrm{VA}} = \\frac{25 \\times 10^{10}\\,\\mathrm{V}^2}{1 \\times 10^9\\,\\mathrm{VA}} = 250\\,\\Omega$$\n\n标幺串联阻抗分量，即电阻 $r$ 和电抗 $x$，是通过将实际值（$R$ 和 $X$）除以基准阻抗得到的。线路的总串联阻抗为 $Z = R + jX$。标幺串联阻抗为 $z = r + jx$。\n$$r = \\frac{R}{Z_{\\text{base}}} = \\frac{6.00\\,\\Omega}{250\\,\\Omega} = 0.024$$\n$$x = \\frac{X}{Z_{\\text{base}}} = \\frac{90.0\\,\\Omega}{250\\,\\Omega} = 0.36$$\n\n标幺并联电纳 $b$ 是通过将实际总并联电纳 $B$ 乘以基准阻抗得到的。实际并联导纳为 $Y_{\\text{sh}} = jB$。标幺并联导纳为 $y_{\\text{sh}} = Y_{\\text{sh}} \\times Z_{\\text{base}} = jB \\times Z_{\\text{base}} = jb$。\n$$b = B \\times Z_{\\text{base}} = (1.357 \\times 10^{-3}\\,\\mathrm{S}) \\times (250\\,\\Omega) = 0.33925$$\n\n四舍五入到四位有效数字，标幺参数为：\n-   $r = 0.02400\\,\\mathrm{pu}$\n-   $x = 0.3600\\,\\mathrm{pu}$\n-   $b = 0.3393\\,\\mathrm{pu}$\n\n**第二部分：无功功率误差计算**\n无功功率计算中的误差是线路并联电容产生的总无功功率，这在仅有串联阻抗的模型中被忽略了。在π型等效模型中，总并联电纳 $B$ 通常被分成相等的两部分，分别位于线路的两端。产生的总无功功率 $Q_C$ 是这两个并联元件产生的无功功率之和。\n\n一个并联元件产生的总三相无功功率由 $Q_C = |V_{LL}|^2 B_{\\text{element}}$ 给出，其中 $|V_{LL}|$ 是该元件位置处的线电压幅值。问题指定在标称 $500\\,\\mathrm{kV}$ 运行电压下进行此计算。这意味着我们可以假设线路并联元件两端的电压幅值是恒定的，且等于标称线电压 $|V_{\\text{nom}}| = 500\\,\\mathrm{kV}$。\n\n在此假设下，由整个线路的并联电纳 $B$ 产生的总无功功率为：\n$$Q_C = |V_{\\text{nom}}|^2 B$$\n代入给定值：\n$$Q_C = (500 \\times 10^3\\,\\mathrm{V})^2 \\times (1.357 \\times 10^{-3}\\,\\mathrm{S})$$\n$$Q_C = (25 \\times 10^{10}\\,\\mathrm{V}^2) \\times (1.357 \\times 10^{-3}\\,\\mathrm{S}) = 3.3925 \\times 10^8\\,\\mathrm{VAR} = 339.25\\,\\mathrm{MVAR}$$\n\n该误差必须表示为在 $S_{\\text{base}} = 1000\\,\\mathrm{MVA}$ 基准下的无单位标幺值。标幺误差，记为'error'，为：\n$$\\text{error} = \\frac{Q_C}{S_{\\text{base}}} = \\frac{339.25\\,\\mathrm{MVAR}}{1000\\,\\mathrm{MVA}} = 0.33925\\,\\mathrm{pu}$$\n\n或者，这也可以直接在标幺系统中计算。由并联电纳 $b$ 产生的标幺无功功率为 $q_C = v^2 b$，其中 $v$ 是标幺电压幅值。标称运行电压为 $500\\,\\mathrm{kV}$，等于基准电压 $V_{\\text{base}} = 500\\,\\mathrm{kV}$。因此，标幺电压为：\n$$v = \\frac{|V_{\\text{nom}}|}{V_{\\text{base}}} = \\frac{500\\,\\mathrm{kV}}{500\\,\\mathrm{kV}} = 1.0\\,\\mathrm{pu}$$\n误差是产生的总无功功率，即：\n$$\\text{error} = q_C = v^2 b = (1.0\\,\\mathrm{pu})^2 \\times b = b$$\n使用之前计算的 $b$ 值：\n$$\\text{error} = 0.33925\\,\\mathrm{pu}$$\n\n将此值四舍五入到四位有效数字，得到：\n-   $\\text{error} = 0.3393\\,\\mathrm{pu}$\n\n**结果总结**\n所要求的四个量，四舍五入到四位有效数字，为：\n-   标幺电阻 $r = 0.02400$\n-   标幺电抗 $x = 0.3600$\n-   标幺并联电纳 $b = 0.3393$\n-   标幺无功功率误差 = $0.3393$\n这些量以单行向量的形式报告。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.02400  0.3600  0.3393  0.3393\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从组件建模转向网络分析，本实践练习将探索直流潮流近似法的应用，这是理解复杂电网中有功功率流动的强大工具。您将从基本原理出发，构建网络的电纳矩阵，并用它来计算功率转移分布因子（PTDF）。本练习  提供了一个直接的动手实践机会，让您理解网络拓扑结构的变化（如线路故障）如何重新分配整个系统的功率流。",
            "id": "4132665",
            "problem": "考虑一个在直流 (DC) 潮流近似下建模的无损输电网络。该网络有四个节点，分别标记为 $1$、$2$、$3$ 和 $4$。平衡节点为节点 $4$，其电压相角固定为 $0$。各支路及其电纳（单位为标幺值）如下：\n- 线路 $(1,2)$，电纳为 $b_{12} = 1$，\n- 线路 $(2,3)$，电纳为 $b_{23} = 1$，\n- 线路 $(3,4)$，电纳为 $b_{34} = 1$，\n- 线路 $(4,1)$，电纳为 $b_{41} = 1$，\n- 一条联络支路 $(2,4)$，电纳为 $b_{24} = 1$，初始状态为闭合。\n\n假设在每个有序对中，支路的方向是从第一个节点指向第二个节点。该网络在一个平衡注入的交易下运行：在节点 $2$ 注入 $+P$，在节点 $4$ 取出 $-P$，其中 $P = 1$。在直流潮流近似下，支路潮流由 $f_{ij} = b_{ij}(\\theta_{i} - \\theta_{j})$ 给出，其中 $\\theta_{k}$ 是节点 $k$ 的电压相角。定义线路 $(1,2)$ 相对于交易 $\\{ \\text{在 } 2 \\text{ 注入 } +P, \\text{在 } 4 \\text{ 取出 } -P \\}$ 的功率转移分布因子 (PTDF) 为单位交易 $P=1$ 在线路 $(1,2)$ 上产生的标幺潮流。\n\n然后，线路 $(2,4)$ 上的断路器断开，使该支路退出服务。这将网络电纳矩阵 $B$ 变为一个新的矩阵 $B'$。仅从直流潮流的基本原理（节点平衡和线性支路潮流-相角关系）出发，不使用任何预先制表的灵敏度公式，计算因线路 $(2,4)$ 断开而引起的线路 $(1,2)$ 的PTDF变化，定义为 $\\Delta \\text{PTDF}_{12} = \\text{PTDF}_{12}^{\\text{open}} - \\text{PTDF}_{12}^{\\text{closed}}$。通过显式地构建和求解与重新计算的 $B'$ 相对应的降阶节点电纳方程，来验证数学上的一致性。\n\n将最终答案表示为一个精确的实数（无量纲）。无需四舍五入。",
            "solution": "该问题要求计算当另一条线路退出服务时，特定输电线路的功率转移分布因子 (PTDF) 的变化。分析将使用直流 (DC) 潮流近似，并从基本原理出发。\n\n直流潮流模型通过节点电纳矩阵 $B$ 将各节点的净有功功率注入向量 $P$ 与节点电压相角向量 $\\theta$ 联系起来。该关系是一个线性方程组：\n$$P = B \\theta$$\n一个网络的节点电纳矩阵 $B$ 的元素定义如下：\n- 对角元素为 $B_{kk} = \\sum_{j \\neq k} b_{kj}$，其中求和遍及所有与节点 $k$ 相连的节点 $j$，$b_{kj}$ 是 $k$ 和 $j$ 之间线路的电纳。\n- 非对角元素为 $B_{kj} = -b_{kj}$（如果节点 $k$ 和 $j$ 之间有线路连接），否则 $B_{kj} = 0$。\n\n由于一个节点被指定为平衡节点，其电压相角被固定为参考值。在此问题中，节点 $4$ 是平衡节点，其 $\\theta_4 = 0$。这允许我们构建一个仅涉及非平衡节点（$1$、$2$ 和 $3$）的降阶方程组。降阶系统为 $P_{\\text{red}} = B_{\\text{red}} \\theta_{\\text{red}}$，其中 $B_{\\text{red}}$ 是通过从完整的 $B$ 矩阵中移除对应于平衡节点的行和列得到的。\n\n从节点 $i$ 到节点 $j$ 的支路上的有功潮流由 $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$ 给出。线路 $(i,j)$ 相对于从节点 $k$ 到节点 $l$ 的交易的 PTDF 定义为：当在节点 $k$ 施加单位功率注入 ($P=1$) 并在节点 $l$ 施加相应的取出 ($-P=-1$) 时，线路 $(i,j)$ 上的潮流。\n\n我们将分两部分解决这个问题：首先是针对初始网络配置（“闭合”情况），其次是针对线路故障后的网络（“断开”情况）。\n\n**第 1 部分：初始网络配置（线路 $(2,4)$ 闭合）**\n\n网络由四个节点和五条线路组成，电纳分别为 $b_{12} = 1$，$b_{23} = 1$，$b_{34} = 1$，$b_{41} = 1$ 和 $b_{24} = 1$。非平衡节点是 $1$、$2$ 和 $3$。我们首先构建 $3 \\times 3$ 的降阶电纳矩阵 $B_{\\text{red}}^{\\text{closed}}$。\n\n$B_{\\text{red}}^{\\text{closed}}$ 的对角元素为：\n- $B_{11} = b_{12} + b_{14} = 1 + 1 = 2$\n- $B_{22} = b_{21} + b_{23} + b_{24} = 1 + 1 + 1 = 3$\n- $B_{33} = b_{32} + b_{34} = 1 + 1 = 2$\n\n非对角元素为：\n- $B_{12} = -b_{12} = -1$\n- $B_{13} = 0$\n- $B_{23} = -b_{23} = -1$\n\n因此，降阶电纳矩阵为：\n$$B_{\\text{red}}^{\\text{closed}} = \\begin{pmatrix} 2  -1  0 \\\\ -1  3  -1 \\\\ 0  -1  2 \\end{pmatrix}$$\n\n该交易涉及在节点 $2$ 注入 $P=1$ 并在节点 $4$ 取出 $-P=-1$。非平衡节点上的注入功率为 $P_1 = 0$，$P_2 = 1$ 和 $P_3 = 0$。降阶注入向量为 $P_{\\text{red}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n\n我们求解线性系统 $B_{\\text{red}}^{\\text{closed}} \\theta_{\\text{red}}^{\\text{closed}} = P_{\\text{red}}$：\n$$\\begin{pmatrix} 2  -1  0 \\\\ -1  3  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix} \\theta_1 \\\\ \\theta_2 \\\\ \\theta_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n这对应于以下方程组：\n1. $2\\theta_1 - \\theta_2 = 0 \\implies \\theta_2 = 2\\theta_1$\n2. $-\\theta_1 + 3\\theta_2 - \\theta_3 = 1$\n3. $-\\theta_2 + 2\\theta_3 = 0 \\implies \\theta_2 = 2\\theta_3$\n\n从方程 (1) 和 (3) 中，我们得到 $\\theta_1 = \\theta_3$。将 $\\theta_2 = 2\\theta_1$ 和 $\\theta_3 = \\theta_1$ 代入方程 (2)：\n$$-\\theta_1 + 3(2\\theta_1) - \\theta_1 = 1$$\n$$-\\theta_1 + 6\\theta_1 - \\theta_1 = 1$$\n$$4\\theta_1 = 1 \\implies \\theta_1 = \\frac{1}{4}$$\n因此，相角为 $\\theta_1^{\\text{closed}} = \\frac{1}{4}$，$\\theta_2^{\\text{closed}} = 2(\\frac{1}{4}) = \\frac{1}{2}$ 和 $\\theta_3^{\\text{closed}} = \\frac{1}{4}$。平衡节点的相角为 $\\theta_4 = 0$。\n\n线路 $(1,2)$ 上的潮流为 $f_{12}^{\\text{closed}} = b_{12}(\\theta_1^{\\text{closed}} - \\theta_2^{\\text{closed}})$。\n$$f_{12}^{\\text{closed}} = 1 \\left(\\frac{1}{4} - \\frac{1}{2}\\right) = -\\frac{1}{4}$$\n由于此潮流是由单位交易 ($P=1$) 引起的，因此 PTDF 为：\n$$\\text{PTDF}_{12}^{\\text{closed}} = \\frac{f_{12}^{\\text{closed}}}{P} = \\frac{-1/4}{1} = -\\frac{1}{4}$$\n\n**第 2 部分：故障后网络（线路 $(2,4)$ 断开）**\n\n支路 $(2,4)$ 断开，因此其电纳变为 $b_{24}=0$。我们重新计算降阶电纳矩阵 $B_{\\text{red}}^{\\text{open}}$。\n\n$B_{\\text{red}}^{\\text{open}}$ 的对角元素为：\n- $B'_{11} = b_{12} + b_{14} = 1 + 1 = 2$\n- $B'_{22} = b_{21} + b_{23} = 1 + 1 = 2$ （这与“闭合”情况相比发生了变化）\n- $B'_{33} = b_{32} + b_{34} = 1 + 1 = 2$\n\n非对角元素保持不变。新的降阶矩阵为：\n$$B_{\\text{red}}^{\\text{open}} = \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix}$$\n\n注入向量 $P_{\\text{red}}$ 保持不变。我们求解新的系统 $B_{\\text{red}}^{\\text{open}} \\theta_{\\text{red}}^{\\text{open}} = P_{\\text{red}}$：\n$$\\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix} \\theta_1 \\\\ \\theta_2 \\\\ \\theta_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n这对应于新的方程组：\n1. $2\\theta_1 - \\theta_2 = 0 \\implies \\theta_2 = 2\\theta_1$\n2. $-\\theta_1 + 2\\theta_2 - \\theta_3 = 1$\n3. $-\\theta_2 + 2\\theta_3 = 0 \\implies \\theta_2 = 2\\theta_3$\n\n同样地，$\\theta_1 = \\theta_3$。将 $\\theta_2 = 2\\theta_1$ 和 $\\theta_3 = \\theta_1$ 代入新的方程 (2)：\n$$-\\theta_1 + 2(2\\theta_1) - \\theta_1 = 1$$\n$$-\\theta_1 + 4\\theta_1 - \\theta_1 = 1$$\n$$2\\theta_1 = 1 \\implies \\theta_1 = \\frac{1}{2}$$\n新的相角为 $\\theta_1^{\\text{open}} = \\frac{1}{2}$，$\\theta_2^{\\text{open}} = 2(\\frac{1}{2}) = 1$ 和 $\\theta_3^{\\text{open}} = \\frac{1}{2}$。平衡节点的相角仍然是 $\\theta_4 = 0$。\n\n线路 $(1,2)$ 上的新潮流为 $f_{12}^{\\text{open}} = b_{12}(\\theta_1^{\\text{open}} - \\theta_2^{\\text{open}})$。\n$$f_{12}^{\\text{open}} = 1 \\left(\\frac{1}{2} - 1\\right) = -\\frac{1}{2}$$\n“断开”情况下的 PTDF 为：\n$$\\text{PTDF}_{12}^{\\text{open}} = \\frac{f_{12}^{\\text{open}}}{P} = \\frac{-1/2}{1} = -\\frac{1}{2}$$\n\n**第 3 部分：PTDF 的变化**\n\n最后，我们按规定计算线路 $(1,2)$ 的 PTDF 变化：\n$$\\Delta \\text{PTDF}_{12} = \\text{PTDF}_{12}^{\\text{open}} - \\text{PTDF}_{12}^{\\text{closed}}$$\n$$\\Delta \\text{PTDF}_{12} = \\left(-\\frac{1}{2}\\right) - \\left(-\\frac{1}{4}\\right)$$\n$$\\Delta \\text{PTDF}_{12} = -\\frac{1}{2} + \\frac{1}{4} = -\\frac{2}{4} + \\frac{1}{4} = -\\frac{1}{4}$$\n该分析已按要求从第一性原理出发，通过为两种网络配置显式地构建和求解节点方程来进行。",
            "answer": "$$\n\\boxed{-\\frac{1}{4}}\n$$"
        },
        {
            "introduction": "最后的这个实践练习将我们的分析提升到优化层面，通过安全约束最优潮流（SCOPF）来解决在故障下确保电网安全的问题。基于直流模型，您的任务是构建一个线性规划问题，以确定在导致网络孤岛化的严重事件后，为维持系统可行性所需的最小切负荷量。本练习  展示了输电网络模型如何构成自动化决策系统的核心，以保障我们电网的可靠运行。",
            "id": "4132732",
            "problem": "考虑一个根据线性化直流潮流近似建模的输电网络，该模型源于基尔霍夫电路定律和交流潮流的小角度线性化。设该网络有 $n$ 个母线，索引为 $i \\in \\{0,1,\\dots,n-1\\}$，一组有向支路（对于物理潮流视为无向）$(i,j)$，其电纳为 $b_{ij} > 0$，每条支路上有热极限 $F_{ij}^{\\max} > 0$。令 $g_i$ 表示母线 $i$ 的发电量，其边界为 $0 \\le g_i \\le \\overline{g}_i$；令 $d_i \\ge 0$ 表示母线 $i$ 的固定需求；令 $s_i \\ge 0$ 表示母线 $i$ 的切负荷，其约束为 $0 \\le s_i \\le d_i$。用 $\\theta_i$（单位为弧度）表示母线电压相角。安全约束最优潮流（SCOPF）要求在特定预想事故下运行点的可行性。移除支路的预想事故可能会使网络孤岛化，将其划分为多个连通分量，每个分量都必须独立满足功率平衡。\n\n在线性化模型下，支路潮流满足 $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$，并且每个母线 $i$ 的节点功率平衡强制要求 $\\sum_{j: (i,j)\\in E} f_{ij} + g_i - (d_i - s_i) = 0$。热约束要求每条支路 $(i,j)$ 都满足 $|f_{ij}| \\le F_{ij}^{\\max}$。当预想事故移除一部分支路时，剩余的图可能会分解成多个孤岛，每个孤岛都必须满足其自身的平衡和约束。当事故后网络无法在发电机边界和线路限制条件下满足需求时，安全约束最优潮流（SCOPF）的可行性可能需要切负荷。\n\n任务：从上述物理定律和定义出发，推导在给定的孤岛化预想事故后，SCOPF可行性需要正切负荷的条件，并通过一个线性规划计算最小总切负荷。您的程序必须实现以下线性规划来确定最小切负荷：\n- 变量：所有母线 $i$ 的 $\\theta_i$，所有母线 $i$ 的 $g_i$，以及所有母线 $i$ 的 $s_i$。\n- 目标：最小化 $\\sum_{i=0}^{n-1} s_i$。\n- 等式约束：\n  1. 对每个母线 $i$，强制执行节点功率平衡 $\\sum_{j} b_{ij}(\\theta_i - \\theta_j) + g_i - d_i + s_i = 0$，其中求和是对事故后剩余支路连接的邻居 $j$ 进行的。\n  2. 对每个孤岛，将一个参考角度固定为零（选择孤岛中索引最小的母线）以使角度明确定义，即 $\\theta_{r_k} = 0$，其中 $r_k$ 是为孤岛 $k$ 选择的参考母线。\n- 不等式约束：对每条剩余支路 $(i,j)$，强制执行 $b_{ij}(\\theta_i - \\theta_j) \\le F_{ij}^{\\max}$ 和 $-b_{ij}(\\theta_i - \\theta_j) \\le F_{ij}^{\\max}$。\n- 边界：$0 \\le g_i \\le \\overline{g}_i$，$0 \\le s_i \\le d_i$，并且除了由参考角度等式约束固定的情况外，$\\theta_i$ 是自由的（无界的）。\n\n使用上述模型，母线索引从 $0$ 开始，所有功率量以兆瓦（MW）表示，角度量以弧度表示。程序必须从网络中移除指定的预想事故支路，识别孤岛，为每个孤岛添加一个参考角度约束，并求解线性规划以计算最小总切负荷 $\\sum_i s_i$（单位为MW）。对每个测试用例，返回一个浮点数，表示该最小总切负荷。\n\n测试套件：\n定义五个测试用例，以检验可行性和孤岛化的不同方面。\n1. 正常路径，连通且无拥塞，无切负荷：\n   - 母线：$n = 3$。\n   - 支路：$(0,1)$，电纳 $b_{01} = 10$，热极限 $F_{01}^{\\max} = 100$；$(1,2)$，电纳 $b_{12} = 10$，热极限 $F_{12}^{\\max} = 100$。\n   - 发电上限：$\\overline{g} = [150, 0, 0]$。\n   - 需求：$d = [40, 60, 50]$。\n   - 预想事故：不移除。\n   预期最小切负荷：$10$ MW。\n2. 孤岛无发电，该孤岛内完全切负荷：\n   - 与案例1相同，但预想事故移除了支路 $(1,2)$。\n   - 预期最小切负荷：$50$ MW（母线 $2$ 所在的孤岛需求为 $50$ 且无发电）。\n3. 尽管总发电量充足，但因传输拥塞导致切负荷：\n   - 母线：$n = 4$。\n   - 支路：$(0,2)$，电纳 $b_{02} = 10$，热极限 $F_{02}^{\\max} = 60$；$(0,3)$，电纳 $b_{03} = 10$，热极限 $F_{03}^{\\max} = 50$；$(1,2)$，电纳 $b_{12} = 10$，热极限 $F_{12}^{\\max} = 20$；$(1,3)$，电纳 $b_{13} = 10$，热极限 $F_{13}^{\\max} = 15$。\n   - 发电上限：$\\overline{g} = [120, 60, 0, 0]$。\n   - 需求：$d = [0, 0, 80, 70]$。\n   - 预想事故：不移除。\n   预期最小切负荷：$5$ MW（线路限制分别将向母线 $2$ 和 $3$ 的输电上限限制为 $80$ MW和 $65$ MW）。\n4. 边界仅有一条传输受限的线路：\n   - 母线：$n = 2$。\n   - 支路：$(0,1)$，电纳 $b_{01} = 10$，热极限 $F_{01}^{\\max} = 85$。\n   - 发电上限：$\\overline{g} = [90, 0]$。\n   - 需求：$d = [0, 100]$。\n   - 预想事故：不移除。\n   预期最小切负荷：$15$ MW（受 $F_{01}^{\\max} = 85$ MW 限制）。\n5. 孤岛化在一个孤岛中造成了功率缺口：\n   - 母线：$n = 4$。\n   - 支路：环形连接 $(0,1)$，电纳 $b_{01} = 10$，热极限 $F_{01}^{\\max} = 100$；$(1,2)$，电纳 $b_{12} = 10$，热极限 $F_{12}^{\\max} = 100$；$(2,3)$，电纳 $b_{23} = 10$，热极限 $F_{23}^{\\max} = 100$；$(3,0)$，电纳 $b_{30} = 10$，热极限 $F_{30}^{\\max} = 100$。\n   - 发电上限：$\\overline{g} = [50, 0, 50, 0]$。\n   - 需求：$d = [0, 40, 0, 60]$。\n   - 预想事故：移除支路 $(1,2)$ 和 $(3,0)$。\n   预期最小切负荷：$10$ MW（孤岛 $\\{2,3\\}$ 有 $50$ MW 发电和 $60$ MW 需求）。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述定义的五个测试用例的顺序排列结果，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_k$ 是测试用例 $k$ 的最小总切负荷（单位为MW）。",
            "solution": "该问题要求在线性化直流潮流近似下，构建并求解一个安全约束最优潮流（SCOPF）问题。目标是确定在指定的预想事故之后，为维持输电网络的可行运行点所需的最小总切负荷量，该事故可能将网络分割成几个不相连的孤岛。\n\n首先，我们讨论推导需要正切负荷的条件。系统必须满足节点功率平衡、发电机限制和输电线路热限制。一个没有切负荷（即所有 $s_i=0$）的可行解可能因两个主要原因而不存在：\n\n1.  **孤岛内的发电-需求不平衡**：预想事故可将网络分裂成多个孤岛（连通分量）。每个孤岛在功率平衡方面必须自给自足，即孤岛内的总发电量必须等于总需求量。如果对于任何一个孤岛 $k$，其最大可能发电量之和小于需求之和，即 $\\sum_{i \\in \\text{Island } k} \\overline{g}_i < \\sum_{i \\in \\text{Island } k} d_i$，那么物理上就不可能满足需求。功率缺口必须通过切负荷（即对该孤岛中的某些 $i$ 有 $s_i > 0$）来弥补。\n\n2.  **网络拥塞**：即使一个孤岛的总发电量足以满足其总需求，输电线路的物理限制也可能阻止电力从发电机输送到负荷。发电源和负荷中心之间的路径容量可能不足。如果一个母线或一组母线的需求超过了通过网络可以向其输入的最大功率，则必须进行切负GH荷以缓解这种拥塞并满足支路潮流限制 $|f_{ij}| \\le F_{ij}^{\\max}$。\n\n为了计算最小总切负荷，我们将问题表述为一个线性规划（LP），这是DCOPF问题的标准技术。LP将物理约束形式化，并寻求最小化总切负荷 $\\sum_i s_i$。\n\nLP的构建如下：\n-   **变量**：决策变量合并为一个向量 $x = [\\vec{\\theta}, \\vec{g}, \\vec{s}]^T$，其中 $\\vec{\\theta} = [\\theta_0, \\dots, \\theta_{n-1}]^T$ 是母线电压相角，$\\vec{g} = [g_0, \\dots, g_{n-1}]^T$ 是发电设定点，$\\vec{s} = [s_0, \\dots, s_{n-1}]^T$ 是切负荷量。总变量数为 $3n$。\n\n-   **目标函数**：目标是最小化总切负荷，这是一个关于变量的线性函数：\n    $$ \\text{minimize} \\quad \\sum_{i=0}^{n-1} s_i $$\n    这对应于标准LP形式 `min c^T x` 中的成本向量 $c$，其中与 $s_i$ 变量对应的元素为 $1$，所有其他元素为 $0$。\n\n-   **约束**：\n    1.  **节点功率平衡（等式）**：对于每个母线 $i$，净注入功率必须为零。这是基尔霍夫电流定律的应用。\n        $$ \\sum_{j:(i,j) \\in E'} b_{ij}(\\theta_i - \\theta_j) + g_i - (d_i - s_i) = 0 $$\n        其中 $E'$ 是事故后的支路集合。为适应标准LP形式 `A_eq x = b_eq` 进行整理：\n        $$ \\left(\\sum_{j:(i,j) \\in E'} b_{ij}\\right)\\theta_i - \\sum_{j:(i,j) \\in E'} b_{ij}\\theta_j + g_i + s_i = d_i $$\n        这提供了 $n$ 个线性等式约束。\n\n    2.  **参考角度（等式）**：物理规律仅取决于相角*差*。为获得角度的唯一解，必须为每个孤岛设置一个参考。对于每个孤岛 $k$，我们选择一个参考母线 $r_k$（例如，索引最小的那个）并将其角度固定为零。\n        $$ \\theta_{r_k} = 0 $$\n        这为事故后网络中的每个孤岛增加了一个等式约束。识别孤岛需要在由剩余支路定义的网络图上使用图遍历算法，如广度优先搜索（BFS）。\n\n    3.  **支路潮流限制（不等式）**：每条支路 $(i,j)$ 上的潮流绝对值不得超过其热极限 $F_{ij}^{\\max}$。\n        $$ |b_{ij}(\\theta_i - \\theta_j)| \\le F_{ij}^{\\max} $$\n        这表示为一对线性不等式，以适应标准形式 `A_ub x = b_ub`：\n        $$ b_{ij}(\\theta_i - \\theta_j) \\le F_{ij}^{\\max} $$\n        $$ -b_{ij}(\\theta_i - \\theta_j) \\le F_{ij}^{\\max} $$\n        这产生了 $2M$ 个不等式约束，其中 $M$ 是事故后的支路数量。\n\n    4.  **变量边界**：发电和切负荷的变量是有界的。\n        $$ 0 \\le g_i \\le \\overline{g}_i $$\n        $$ 0 \\le s_i \\le d_i $$\n        相角 $\\theta_i$ 是无界的（自由变量），但参考母线除外。\n\n解决方案通过构建矩阵 `A_eq`、`A_ub` 和向量 `b_eq`、`b_ub`、`c` 以及 `bounds` 列表来实现，然后使用 `scipy.optimize.linprog` 来求解得到的LP。目标函数的最优值 `res.fun` 给出了最小总切负荷。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of Security-Constrained Optimal Power Flow (SCOPF) problems\n    to find the minimum load shed under specified contingencies.\n    \"\"\"\n\n    # Define the five test cases from the problem statement.\n    test_cases = [\n        # Case 1: Happy path, connected and uncongested\n        {\n            \"n\": 3,\n            \"branches\": [(0, 1, 10, 100), (1, 2, 10, 100)],\n            \"g_bar\": [150, 0, 0],\n            \"d\": [40, 60, 50],\n            \"contingency\": [],\n        },\n        # Case 2: Island with zero generation\n        {\n            \"n\": 3,\n            \"branches\": [(0, 1, 10, 100), (1, 2, 10, 100)],\n            \"g_bar\": [150, 0, 0],\n            \"d\": [40, 60, 50],\n            \"contingency\": [(1, 2)],\n        },\n        # Case 3: Congestion-limited delivery\n        {\n            \"n\": 4,\n            \"branches\": [\n                (0, 2, 10, 60), (0, 3, 10, 50),\n                (1, 2, 10, 20), (1, 3, 10, 15)\n            ],\n            \"g_bar\": [120, 60, 0, 0],\n            \"d\": [0, 0, 80, 70],\n            \"contingency\": [],\n        },\n        # Case 4: Single transfer-limited line\n        {\n            \"n\": 2,\n            \"branches\": [(0, 1, 10, 85)],\n            \"g_bar\": [90, 0],\n            \"d\": [0, 100],\n            \"contingency\": [],\n        },\n        # Case 5: Islanding creates a deficit\n        {\n            \"n\": 4,\n            \"branches\": [\n                (0, 1, 10, 100), (1, 2, 10, 100),\n                (2, 3, 10, 100), (3, 0, 10, 100)\n            ],\n            \"g_bar\": [50, 0, 50, 0],\n            \"d\": [0, 40, 0, 60],\n            \"contingency\": [(1, 2), (3, 0)],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_scopf_case(**case)\n        results.append(result)\n\n    # Format the final output as a comma-separated list in brackets.\n    # Rounding to a reasonable precision for floating point comparison.\n    formatted_results = [f\"{r:.6f}\".rstrip('0').rstrip('.') for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef _solve_scopf_case(n, branches, g_bar, d, contingency):\n    \"\"\"\n    Formulates and solves the LP for a single SCOPF case.\n    \"\"\"\n    \n    # 1. Determine post-contingency branches\n    contingency_set = {tuple(sorted(c)) for c in contingency}\n    post_contingency_branches = []\n    for u, v, b, f_max in branches:\n        if tuple(sorted((u,v))) not in contingency_set:\n            post_contingency_branches.append((u, v, b, f_max))\n\n    # 2. Identify islands using BFS to find connected components\n    adj = [[] for _ in range(n)]\n    for u, v, _, _ in post_contingency_branches:\n        adj[u].append(v)\n        adj[v].append(u)\n\n    islands = []\n    visited = [False] * n\n    for i in range(n):\n        if not visited[i]:\n            current_island = []\n            q = [i]\n            visited[i] = True\n            while q:\n                u = q.pop(0)\n                current_island.append(u)\n                for v_neighbor in adj[u]:\n                    if not visited[v_neighbor]:\n                        visited[v_neighbor] = True\n                        q.append(v_neighbor)\n            islands.append(current_island)\n\n    ref_buses = [min(island) for island in islands]\n    num_islands = len(islands)\n\n    # 3. Set up the LP problem\n    # Variables: x = [theta_0..n-1, g_0..n-1, s_0..n-1]\n    num_vars = 3 * n\n    \n    # Objective: minimize sum(s_i)\n    c = np.zeros(num_vars)\n    c[2*n:] = 1.0\n\n    # Variable bounds\n    bounds = []\n    # theta_i: free\n    bounds.extend([(None, None)] * n)\n    # g_i: 0 = g_i = g_bar_i\n    bounds.extend([(0, gb) for gb in g_bar])\n    # s_i: 0 = s_i = d_i\n    bounds.extend([(0, dem) for dem in d])\n\n    # Equality constraints: A_eq @ x == b_eq\n    num_eq_constraints = n + num_islands\n    A_eq = np.zeros((num_eq_constraints, num_vars))\n    b_eq = np.zeros(num_eq_constraints)\n    \n    # Nodal power balance constraints (n constraints)\n    # sum(b_ij*(theta_i - theta_j)) + g_i - d_i + s_i = 0\n    # Rearranged: sum(b_ij*(theta_i - theta_j)) + g_i + s_i = d_i\n    for i in range(n):\n        A_eq[i, n + i] = 1.0  # g_i\n        A_eq[i, 2*n + i] = 1.0  # s_i\n        b_eq[i] = d[i]\n    \n    for u, v, b_uv, _ in post_contingency_branches:\n        A_eq[u, u] += b_uv\n        A_eq[u, v] -= b_uv\n        A_eq[v, v] += b_uv\n        A_eq[v, u] -= b_uv\n\n    # Reference angle constraints (num_islands constraints)\n    for i, ref_bus in enumerate(ref_buses):\n        A_eq[n + i, ref_bus] = 1.0\n        b_eq[n + i] = 0.0\n\n    # Inequality constraints: A_ub @ x = b_ub\n    num_ineq_constraints = 2 * len(post_contingency_branches)\n    A_ub = np.zeros((num_ineq_constraints, num_vars))\n    b_ub = np.zeros(num_ineq_constraints)\n\n    # Branch flow limits: |b_ij * (theta_i - theta_j)| = F_max_ij\n    for i, (u, v, b_uv, f_max) in enumerate(post_contingency_branches):\n        # b_uv * (theta_u - theta_v) = f_max\n        A_ub[2*i, u] = b_uv\n        A_ub[2*i, v] = -b_uv\n        b_ub[2*i] = f_max\n        # -b_uv * (theta_u - theta_v) = f_max\n        A_ub[2*i + 1, u] = -b_uv\n        A_ub[2*i + 1, v] = b_uv\n        b_ub[2*i + 1] = f_max\n\n    # 4. Solve the LP\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    \n    if res.success:\n        # The minimal total shed is the optimal value of the objective function.\n        # A small negative value can occur due to floating point inaccuracies, clamp to 0.\n        return max(0, res.fun)\n    else:\n        # Should not happen for a well-posed problem. Return NaN to indicate failure.\n        return float('nan')\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}