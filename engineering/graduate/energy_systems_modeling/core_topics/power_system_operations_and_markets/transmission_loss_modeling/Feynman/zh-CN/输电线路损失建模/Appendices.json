{
    "hands_on_practices": [
        {
            "introduction": "准确的输电损耗建模始于对构成电网的各个物理组件的深刻理解。本练习将深入探讨高压电缆中能量损耗的多种物理机制，要求您从第一性原理出发，分别量化导体中的焦耳热、绝缘介质中的介电损耗以及金属护套中的循环电流损耗。通过这项实践，您将掌握如何将基础电磁学理论应用于复杂工程部件，为建立精确的系统级损耗模型奠定坚实的基础 ()。",
            "id": "4132368",
            "problem": "一家电力公司运行一个平衡三相正弦输电系统，其线电压 $V_{\\text{LL}} = 220 \\,\\text{kV}$，频率 $f = 50 \\,\\text{Hz}$，通过一根长度为 $L = 12 \\,\\text{km}$ 的三芯交联聚乙烯 (XLPE) 绝缘电缆，为稳态负载提供均方根相电流幅值为 $I = 420 \\,\\text{A}$ 的电流。每相使用横截面积为 $A_c = 1.0 \\times 10^{-3} \\,\\text{m}^2$ 的铜导体，其在 $20^{\\circ}\\text{C}$ 时的电阻率为 $\\rho_c = 1.724 \\times 10^{-8} \\,\\Omega \\,\\text{m}$，温度系数为 $\\alpha_c = 3.93 \\times 10^{-3} \\,\\text{K}^{-1}$。在稳态负载下，导体在 $T = 90^{\\circ}\\text{C}$ 的温度下运行。由于集肤效应和邻近效应，交流电阻高于相同温度下的直流值；通过一个交流修正系数 $k_{\\text{ac}} = 1.12$ 来模拟此效应，该系数以乘法方式应用于 $T$ 温度下的直流电阻。\n\n该电缆的电介质特性为：每相单位长度电容 $C' = 0.20 \\,\\mu\\text{F}/\\text{km}$，介电损耗因数（损耗角正切）$\\tan \\delta = 8.0 \\times 10^{-4}$。假设三相系统是平衡的，并且在角频率 $\\omega = 2 \\pi f$ 下，电介质表现为线性有损电容器。\n\n每相都有自己的金属护套，两端固态连接，形成一种会产生护套环流的配置。将每单位长度的护套回路建模为一个串联阻抗，其电阻为 $r_s' = 0.25 \\,\\Omega/\\text{km}$，内电感为 $l_s' = 0.90 \\,\\text{mH}/\\text{km}$。相导体与其护套之间的磁耦合由单位长度互感 $m' = 0.35 \\,\\text{mH}/\\text{km}$ 表示。假设沿电缆的耦合是均匀的，忽略外部接地回路效应，并忽略护套间的互耦，因此护套中单位长度的感应电动势是根据法拉第定律应用于相电流与互感而产生的。将每相中的护套电流视为沿长度均匀，并由单位长度的局部感应电动势和单位长度的护套回路阻抗确定。\n\n仅从适用于能源系统建模和输电损耗建模的基本定律和核心定义（例如，电阻损耗的欧姆定律和焦耳热，介电损耗的复介电常数和损耗因数定义，以及护套电流的法拉第电磁感应定律）出发，从第一性原理推导表达式以计算：\n- 电流流过产生的总导体发热损耗，\n- 绝缘中的总介电损耗，\n- 以及总护套环流损耗，\n\n然后根据给定参数对它们进行数值评估。将这些损耗相加，得到在所述运行条件下，$L = 12 \\,\\text{km}$ 电缆的总三相损耗 $P_{\\text{tot}}$。\n\n以 $\\text{MW}$ 为单位表示最终总损耗，并将答案四舍五入到四位有效数字。",
            "solution": "总功率损耗 $P_{\\text{tot}}$ 是三个分量的总和：导体发热损耗 ($P_{\\text{cond}}$)、介电损耗 ($P_{\\text{diel}}$) 和护套环流损耗 ($P_{\\text{sheath}}$)。我们将从基本原理出发为每个分量推导表达式，然后进行评估。该系统是一个平衡三相系统，因此可以按每相进行计算，然后乘以 $3$。\n\n**1. 导体发热损耗 ($P_{\\text{cond}}$)**\n导体损耗是由焦耳热引起的。根据焦耳第一定律，电阻元件中耗散的功率为 $P = I^2 R$。对于三相系统，总导体损耗是三根导体中各自损耗的总和。\n$$P_{\\text{cond}} = 3 I^2 R_{\\text{AC}}$$\n在此，$I$ 是均方根相电流，$R_{\\text{AC}}$ 是单根导体在长度 $L$ 上的交流电阻。\n\n首先计算导体在工作温度 $T = 90^{\\circ}\\text{C}$ 下的直流电阻 $R_{\\text{DC}}$。使用线性温度依赖模型可以找到此温度下的电阻率 $\\rho_T$：\n$$\\rho_T = \\rho_c (1 + \\alpha_c (T - T_0))$$\n其中 $\\rho_c$ 是参考温度 $T_0 = 20^{\\circ}\\text{C}$ 时的电阻率，$\\alpha_c$ 是电阻温度系数。\n长度为 $L$、横截面积为 $A_c$ 的导体的直流电阻为：\n$$R_{\\text{DC}} = \\frac{\\rho_T L}{A_c} = \\frac{\\rho_c (1 + \\alpha_c (T - T_0)) L}{A_c}$$\n通过应用修正系数 $k_{\\text{ac}}$ 来考虑集肤效应和邻近效应，可以得到交流电阻：\n$$R_{\\text{AC}} = k_{\\text{ac}} R_{\\text{DC}}$$\n代入给定值：\n$\\rho_T = (1.724 \\times 10^{-8} \\,\\Omega\\,\\text{m}) (1 + (3.93 \\times 10^{-3} \\,\\text{K}^{-1}) (90^{\\circ}\\text{C} - 20^{\\circ}\\text{C})) = 1.724 \\times 10^{-8} \\times (1 + 0.2751) = 2.19827 \\times 10^{-8} \\,\\Omega\\,\\text{m}$\n$R_{\\text{DC}} = \\frac{(2.19827 \\times 10^{-8} \\,\\Omega\\,\\text{m}) (12 \\times 10^3 \\,\\text{m})}{1.0 \\times 10^{-3} \\,\\text{m}^2} = 0.26379 \\,\\Omega$\n$R_{\\text{AC}} = 1.12 \\times 0.26379 \\,\\Omega = 0.29545 \\,\\Omega$\n三相的总导体损耗为：\n$P_{\\text{cond}} = 3 \\times (420 \\,\\text{A})^2 \\times (0.29545 \\,\\Omega) = 156378 \\,\\text{W}$\n\n**2. 介电损耗 ($P_{\\text{diel}}$)**\n由于时变电场，绝缘材料中会发生介电损耗。我们将电介质建模为一个由纯电容 $C$ 和并联电导 $G$ 组成的并联等效电路。耗散的功率由电导和施加的电压决定。在给定的角频率 $\\omega = 2 \\pi f$ 下，损耗因数 $\\tan \\delta$ 将电导与电容联系起来。\n每相单位长度的复导纳为 $\\vec{Y}' = G' + j\\omega C'$，其中 $G'$ 是单位长度的并联电导，$C'$ 是单位长度的电容。损耗因数的定义为：\n$$\\tan \\delta = \\frac{G'}{\\omega C'}$$\n由此，我们求得单位长度的并联电导：$G' = \\omega C' \\tan \\delta$。\n每相单位长度的功率损耗为 $P'_{\\text{diel, 1ph}} = V_{\\text{ph}}^2 G'$，其中 $V_{\\text{ph}}$ 是相电压。对于平衡系统，$V_{\\text{ph}} = \\frac{V_{\\text{LL}}}{\\sqrt{3}}$。\n三相在长度 $L$ 上的总介电损耗为：\n$$P_{\\text{diel}} = 3 \\times P'_{\\text{diel, 1ph}} \\times L = 3 (V_{\\text{ph}}^2 G' L) = 3 \\left(\\frac{V_{\\text{LL}}}{\\sqrt{3}}\\right)^2 (\\omega C' \\tan \\delta) L = V_{\\text{LL}}^2 \\omega C' L \\tan \\delta$$\n代入给定值（转换单位以保持一致）：\n$\\omega = 2 \\pi f = 2 \\pi (50 \\,\\text{Hz}) = 100\\pi \\,\\text{rad/s}$\n$C' = 0.20 \\,\\mu\\text{F}/\\text{km} = 0.20 \\times 10^{-6} \\,\\text{F}/\\text{km}$\n$L = 12 \\,\\text{km}$\n$V_{\\text{LL}} = 220 \\,\\text{kV} = 220 \\times 10^3 \\,\\text{V}$\n$\\tan \\delta = 8.0 \\times 10^{-4}$\n$P_{\\text{diel}} = (220 \\times 10^3 \\,\\text{V})^2 \\times (100\\pi \\,\\text{rad/s}) \\times (0.20 \\times 10^{-6} \\,\\text{F}/\\text{km}) \\times (12 \\,\\text{km}) \\times (8.0 \\times 10^{-4}) = 29194 \\,\\text{W}$\n\n**3. 护套环流损耗 ($P_{\\text{sheath}}$)**\n由相电流产生的交变磁场在金属护套的长度上感应出电压。由于护套两端固态连接，该电压驱动一股环流通过由护套和连接件构成的回路。该电流在护套电阻中引起焦耳热。\n根据法拉第电磁感应定律，单位长度的感应电动势 $\\vec{\\mathcal{E}}'$ 与磁链的变化率成正比，而磁链由单位长度互感 $m'$ 和相电流 $\\vec{I}$ 给出。用相量形式表示：\n$$\\vec{\\mathcal{E}}' = -j\\omega (m' \\vec{I})$$\n该单位长度感应电压的幅值为 $\\mathcal{E}' = \\omega m' I$。\n该电压驱动电流 $\\vec{I}_s$ 流过护套自身的单位长度阻抗 $\\vec{z}_s' = r_s' + j\\omega l_s'$。根据问题的模型，$\\vec{I}_s = \\vec{\\mathcal{E}}' / \\vec{z}_s'$。\n护套电流的幅值为：\n$$I_s = |\\vec{I}_s| = \\frac{\\mathcal{E}'}{|\\vec{z}_s'|} = \\frac{\\omega m' I}{\\sqrt{(r_s')^2 + (\\omega l_s')^2}}$$\n功率损耗是由于该电流流过护套的电阻 $r_s'$。每相单位长度的损耗为 $P'_{\\text{sheath, 1ph}} = I_s^2 r_s'$。\n三相在长度 $L$ 上的总护套损耗为：\n$$P_{\\text{sheath}} = 3 \\times P'_{\\text{sheath, 1ph}} \\times L = 3 I_s^2 r_s' L = 3 \\left( \\frac{(\\omega m' I)^2}{(r_s')^2 + (\\omega l_s')^2} \\right) r_s' L$$\n为计算方便，我们使用每公里的单位：\n$r_s' = 0.25 \\,\\Omega/\\text{km}$\n$l_s' = 0.90 \\,\\text{mH}/\\text{km} = 0.90 \\times 10^{-3} \\,\\text{H}/\\text{km}$\n$m' = 0.35 \\,\\text{mH}/\\text{km} = 0.35 \\times 10^{-3} \\,\\text{H}/\\text{km}$\n单位长度护套电抗：$\\omega l_s' = (100\\pi \\,\\text{rad/s}) \\times (0.90 \\times 10^{-3} \\,\\text{H}/\\text{km}) = 0.28274 \\,\\Omega/\\text{km}$\n单位长度互感抗：$\\omega m' = (100\\pi \\,\\text{rad/s}) \\times (0.35 \\times 10^{-3} \\,\\text{H}/\\text{km}) = 0.10996 \\,\\Omega/\\text{km}$\n护套电流幅值：\n$I_s = \\frac{(0.10996 \\,\\Omega/\\text{km}) \\times (420 \\,\\text{A})}{\\sqrt{(0.25 \\,\\Omega/\\text{km})^2 + (0.28274 \\,\\Omega/\\text{km})^2}} = \\frac{46.183 \\,\\text{A}\\cdot\\Omega/\\text{km}}{0.37741 \\,\\Omega/\\text{km}} = 122.37 \\,\\text{A}$\n总护套损耗为：\n$P_{\\text{sheath}} = 3 \\times (122.37 \\,\\text{A})^2 \\times (0.25 \\,\\Omega/\\text{km}) \\times (12 \\,\\text{km}) = 134752 \\,\\text{W}$\n\n**4. 总三相损耗 ($P_{\\text{tot}}$)**\n总损耗是各部分损耗的总和：\n$$P_{\\text{tot}} = P_{\\text{cond}} + P_{\\text{diel}} + P_{\\text{sheath}}$$\n$P_{\\text{tot}} = 156378 \\,\\text{W} + 29194 \\,\\text{W} + 134752 \\,\\text{W} = 320324 \\,\\text{W}$\n转换为兆瓦：\n$P_{\\text{tot}} = 0.320324 \\,\\text{MW}$\n按要求四舍五入到四位有效数字，得到 $0.3203 \\,\\text{MW}$。",
            "answer": "$$\n\\boxed{0.3203}\n$$"
        },
        {
            "introduction": "在掌握了单个组件的损耗分析后，我们可以将视野提升到整个输电系统的层面，评估不同技术方案的优劣。本练习将引导您进行一项经典的工程经济比较：在长距离、大容量输电场景下，对比高压直流 (HVDC) 输电和传统高压交流 (AC) 输电的功率损耗。通过计算这两种技术方案下的总损耗，您将直观地理解为何 HVDC 在远距离输电中具有显著优势，并体会到损耗模型在重大电网规划决策中的关键作用 ()。",
            "id": "4132317",
            "problem": "一家电力公司正在评估长距离大容量电力传输方案，并寻求在相同有功功率传输水平下，对两种备选方案的有功损耗进行建模和比较。方案 A 是一条额定电压为 $\\pm 500$ kV、长度为 $L = 800$ km 的高压直流 (HVDC) 双极线路。每极使用相同的导线，其每公里直流电阻为 $r_{\\text{dc}} = 0.008$ $\\Omega$/km。每个换流站（两端各一个）的损耗被建模为直流电流的线性函数 $a + b I_{\\text{dc}}$，其中 $a = 8$ MW， $b = 0.004$ MW/A。方案 B 是一条电压为 $500$ kV（线电压有效值）的单回三相交流 (AC) 架空线路，长度同样为 $L = 800$ km，其每公里每相的串联参数为 $(r, x) = (0.012\\ \\Omega/\\text{km}, 0.30\\ \\Omega/\\text{km})$，并联电纳为 $b = 3.5 \\times 10^{-6}$ S/km 每相。两种方案都用于从发送端向接收端传输相同的有功功率 $P = 2500$ MW。\n\n假设以下建模条件：\n- 对于方案 A (HVDC)，每极承载相同的电流 $I_{\\text{dc}}$，不使用金属回路（两极都导电），且导线损耗为纯欧姆损耗。两端的换流站损耗为 $a + b I_{\\text{dc}}$。忽略电晕损耗和任何额外的寄生损耗。\n- 对于方案 B (AC)，理想的无功补偿（例如，并联电抗器和适当的无功支持）将接收端电压维持在 $500$ kV 线电压和单位功率因数，并抵消了净并联充电效应，因此有功损耗仅由串联电阻产生。忽略电晕损耗和介质损耗。使用标准的三相功率和欧姆损耗关系式。\n\n从电功率和欧姆耗散的基本定义出发，计算方案 A (HVDC) 和方案 B (AC) 的总有功损耗，然后计算其差值\n$$\\Delta P = P_{\\ell,\\text{dc}} - P_{\\ell,\\text{ac}}.$$\n将 $\\Delta P$ 的最终结果四舍五入至三位有效数字。以 MW 为单位表示最终答案。",
            "solution": "我们通过分别分析每种方案，然后计算它们的总有功损耗之差来求解。\n\n**方案 A：HVDC 系统分析**\n\nHVDC 系统是一条额定电压为 $\\pm 500$ kV 的双极线路。这意味着一极相对于地的电压为 $V_{\\text{dc\\_pole}} = 500$ kV，另一极为 $-500$ kV。传输到接收端的总功率 $P$ 为 $P = 2500$ MW。对于平衡的双极线路，此功率由两极共同输送。总功率、每极电压和每极直流电流 $I_{\\text{dc}}$ 之间的关系为：\n$$P = 2 \\times V_{\\text{dc\\_pole}} \\times I_{\\text{dc}}$$\n给定 $P = 2500 \\text{ MW} = 2500 \\times 10^6$ W 和 $V_{\\text{dc\\_pole}} = 500 \\text{ kV} = 500 \\times 10^3$ V。我们可以求解电流 $I_{\\text{dc}}$：\n$$I_{\\text{dc}} = \\frac{P}{2 V_{\\text{dc\\_pole}}} = \\frac{2500 \\times 10^6 \\text{ W}}{2 \\times (500 \\times 10^3 \\text{ V})} = \\frac{2500 \\times 10^6}{1 \\times 10^6} \\text{ A} = 2500 \\text{ A}$$\nHVDC 系统的总有功损耗 $P_{\\ell,\\text{dc}}$ 是导线损耗 ($P_{\\ell,\\text{cond}}$) 和换流站损耗 ($P_{\\ell,\\text{conv}}$) 的总和。\n\n首先，我们计算导线损耗。线路长度为 $L = 800$ km。每极每公里的电阻为 $r_{\\text{dc}} = 0.008\\ \\Omega/\\text{km}$。单根导线（极）的总直流电阻为：\n$$R_{\\text{dc\\_pole}} = r_{\\text{dc}} \\times L = (0.008 \\text{ } \\Omega/\\text{km}) \\times (800 \\text{ km}) = 6.4 \\text{ } \\Omega$$\n由于有两根相同的导线，每根都承载电流 $I_{\\text{dc}}$，总的导线欧姆损耗为：\n$$P_{\\ell,\\text{cond}} = 2 \\times I_{\\text{dc}}^2 R_{\\text{dc\\_pole}} = 2 \\times (2500 \\text{ A})^2 \\times (6.4 \\text{ } \\Omega) = 2 \\times (6.25 \\times 10^6 \\text{ A}^2) \\times (6.4 \\text{ } \\Omega) = 80 \\times 10^6 \\text{ W} = 80 \\text{ MW}$$\n\n接下来，我们计算换流站损耗。有两个换流站（发送端的整流站和接收端的逆变站）。每个站的损耗由函数 $a + b I_{\\text{dc}}$ 给出，其中 $a = 8$ MW，$b = 0.004$ MW/A。单个站的损耗为：\n$$P_{\\text{conv\\_station}} = a + b I_{\\text{dc}} = 8 \\text{ MW} + (0.004 \\text{ MW/A}) \\times (2500 \\text{ A}) = 8 \\text{ MW} + 10 \\text{ MW} = 18 \\text{ MW}$$\n两个站的总换流损耗为：\n$$P_{\\ell,\\text{conv}} = 2 \\times P_{\\text{conv\\_station}} = 2 \\times 18 \\text{ MW} = 36 \\text{ MW}$$\n\nHVDC 方案的总有功损耗是这些分量的总和：\n$$P_{\\ell,\\text{dc}} = P_{\\ell,\\text{cond}} + P_{\\ell,\\text{conv}} = 80 \\text{ MW} + 36 \\text{ MW} = 116 \\text{ MW}$$\n\n**方案 B：AC 系统分析**\n\nAC 系统是一条三相线路，其接收端电压为 $V_{R, \\text{LL}} = 500$ kV（线电压，有效值），输送相同的有功功率 $P = 2500$ MW。接收端的功率因数指定为单位功率因数 ($\\cos(\\theta_R) = 1$）。\n\n对于平衡的三相系统，总有功功率与线电压 $V_{\\text{LL}}$、线电流 $I_L$ 和功率因数 $\\cos(\\theta)$ 的关系如下：\n$$P = \\sqrt{3} V_{\\text{LL}} I_L \\cos(\\theta)$$\n使用接收端的值，我们可以计算线电流 $I_L$：\n$$I_L = \\frac{P}{\\sqrt{3} V_{R, \\text{LL}} \\cos(\\theta_R)} = \\frac{2500 \\times 10^6 \\text{ W}}{\\sqrt{3} \\times (500 \\times 10^3 \\text{ V}) \\times 1} = \\frac{5000}{\\sqrt{3}} \\text{ A}$$\n问题陈述指出，由于理想补偿，有功损耗仅由串联电阻引起。因此，损耗计算基于标准的三相欧姆损耗公式 $P_{\\ell,\\text{ac}} = 3 I_L^2 R_{\\text{ac\\_phase}}$。\n\n首先，我们使用给定的每公里电阻 $r = 0.012\\ \\Omega/\\text{km}$，计算线路长度 $L = 800$ km 上的总每相串联电阻 $R_{\\text{ac\\_phase}}$：\n$$R_{\\text{ac\\_phase}} = r \\times L = (0.012 \\text{ } \\Omega/\\text{km}) \\times (800 \\text{ km}) = 9.6 \\text{ } \\Omega$$\n现在，我们计算总的三相功率损耗：\n$$P_{\\ell,\\text{ac}} = 3 I_L^2 R_{\\text{ac\\_phase}} = 3 \\times \\left(\\frac{5000}{\\sqrt{3}} \\text{ A}\\right)^2 \\times (9.6 \\text{ } \\Omega) = 3 \\times \\frac{25 \\times 10^6}{3} \\text{ A}^2 \\times (9.6 \\text{ } \\Omega) = 240 \\times 10^6 \\text{ W} = 240 \\text{ MW}$$\n或者，我们可以用功率和电压来表示损耗，以避免对电流进行中间取整：\n$$P_{\\ell,\\text{ac}} = 3 \\left(\\frac{P}{\\sqrt{3} V_{R, \\text{LL}}}\\right)^2 R_{\\text{ac\\_phase}} = \\frac{P^2 R_{\\text{ac\\_phase}}}{V_{R, \\text{LL}}^2} = \\frac{(2500 \\times 10^6 \\text{ W})^2 \\times (9.6 \\text{ } \\Omega)}{(500 \\times 10^3 \\text{ V})^2} = 240 \\times 10^6 \\text{ W} = 240 \\text{ MW}$$\n\n**功率损耗差异**\n\n问题要求计算差值 $\\Delta P = P_{\\ell,\\text{dc}} - P_{\\ell,\\text{ac}}$。\n$$\\Delta P = 116 \\text{ MW} - 240 \\text{ MW} = -124 \\text{ MW}$$\n问题要求将最终结果四舍五入到三位有效数字。计算出的值 $-124$ 已经包含三位有效数字。以科学记数法格式表示，即为 $-1.24 \\times 10^2$。负号表示在此特定情景下，交流输电损耗大于高压直流输电损耗。",
            "answer": "$$\\boxed{-1.24 \\times 10^{2}}$$"
        },
        {
            "introduction": "输电损耗建模的最终目标不仅是进行能量平衡核算，更重要的是要揭示其对电力系统经济运行的深远影响。这项高级实践将带您进入电力市场的核心，探索输电损耗如何影响节点边际电价 (LMP)。您将通过编程实现并比较直流优化潮流 (DC-OPF) 中常用的线性化损耗模型和更为精确的二次损耗模型，分析不同建模选择对经济信号的扭曲程度，从而深刻理解在市场环境下进行高保真损耗建模的必要性 ()。",
            "id": "4132365",
            "problem": "您的任务是使用线性损耗近似法，在直流最优潮流 (DC-OPF) 中计算损耗对节点电价的边际效应，并将其与在标准直流 (DC) 近似下，从交流最优潮流 (AC-OPF) 损耗模型中导出的边际损耗因子进行比较。您的程序必须是一个完整、可运行的程序，能够执行所有计算并产生输出，无需任何外部输入。所有计算都必须以纯数学术语进行。角度必须以弧度处理。节点电价效应必须以美元/兆瓦时 ($/MWh) 表示，并以十进制数打印。\n\n从以下基本定律和定义出发，不直接使用任何目标公式作为输入：\n- 具有固定电压幅值和小相角差的直流潮流模型，得出的线路潮流是节点电压相角和线路电抗的函数。\n- 具有电阻的输电线路上的有功功率损耗与电流幅值的平方成正比，在单位电压的直流近似下，这些损耗是线路潮流的二次函数。\n- 节点边际电价 (LMP) 是节点注入的影子价格，包括电能分量以及由损耗和拥塞引起的调整。在统一边际电能成本的无拥塞网络中，电价调整仅由损耗引起。\n\n推导所需的定义：\n- 直流最优潮流 (DC-OPF)：使用直流网络模型对发电调度和节点注入进行的优化。\n- 交流最优潮流 (AC-OPF)：使用完整交流网络模型的优化；在这里，您将仅使用标准直流近似通过电阻项来表示有功功率损耗。\n- 节点边际电价 (LMP)：在某节点供应下一增量需求的边际成本，考虑了电能、损耗和拥塞。电价单位使用美元/兆瓦时 ($/MWh)。\n- 功率转移分布因子 (PTDF)：在线路潮流对节点注入变化的灵敏度，该变化在指定的平衡节点处达到平衡。\n- 边际损耗因子 (MLF)：总系统损耗对节点注入变化的灵敏度，该变化在平衡节点处达到平衡。\n\n您必须为每个测试网络和运行点计算：\n1. 使用直流潮流模型和指定的平衡节点，计算每条线路相对于每个非平衡节点的功率转移分布因子 (PTDF)。\n2. 使用直流模型，根据给定的运行注入功率计算总线路潮流。\n3. 在两种模型下，计算每个非平衡节点的边际损耗因子 (MLF)：\n   - DC-OPF中使用的线性损耗近似：损耗在指定的基准潮流点附近被线性化，并建模为潮流的线性函数；基于此线性化模型，计算损耗对节点电价的隐含边际效应。\n   - 与直流近似下的AC-OPF一致的二次损耗模型：损耗是线路潮流的二次函数；通过总损耗对节点注入的导数计算精确的边际损耗因子。\n4. 对于一个边际电能成本统一为 1 $/MWh 的无拥塞网络，确定两种模型下每个非平衡节点上损耗的边际电价效应，并为每个测试案例计算两种模型在所有非平衡节点上的最大绝对差值（单位为 $/MWh，以十进制数表示）。\n\n需要遵守的实现细节：\n- 使用节点电压相角和线路潮流之间的直流潮流关系，以及由线路电抗构成的网络电纳矩阵。\n- 通过在一个节点注入并在平衡节点取出时求解降阶线性系统以获得相角，来计算相对于指定平衡节点的PTDF。\n- 将线路 $\\ell$ 上的总有功功率损耗建模为与直流近似下的电阻损耗一致的线路潮流的二次函数。\n\n测试套件包含四个案例。对于每个案例，将角度以弧度处理，价格以 $/MWh$ 为单位：\n- 案例1（理想情况，辐射状网络，在运行点线性化）：\n  - 节点：$3$个；平衡节点：$1$。\n  - 线路：$(1,2)$ 电抗 $x=0.2$，电阻 $r=0.01$；$(2,3)$ 电抗 $x=0.25$，电阻 $r=0.015$。\n  - 运行注入功率（单位 MW）：$[100,-60,-40]$，总和为 $0$。\n  - 线性化基准潮流：等于上述指定运行注入功率下的潮流。\n- 案例2（在零潮流处线性化，相同的辐射状网络）：\n  - 节点：$3$个；平衡节点：$1$。\n  - 线路：$(1,2)$ 电抗 $x=0.2$，电阻 $r=0.01$；$(2,3)$ 电抗 $x=0.25$，电阻 $r=0.015$。\n  - 运行注入功率（单位 MW）：$[100,-60,-40]$，总和为 $0$。\n  - 线性化基准潮流：所有线路均为零。\n- 案例3（边界情况，电阻非常小）：\n  - 节点：$4$个；平衡节点：$1$。\n  - 线路：$(1,2)$ 电抗 $x=0.2$，电阻 $r=10^{-5}$；$(2,3)$ 电抗 $x=0.2$，电阻 $r=10^{-5}$；$(3,4)$ 电抗 $x=0.2$，电阻 $r=10^{-5}$。\n  - 运行注入功率（单位 MW）：$[80,-30,-30,-20]$，总和为 $0$。\n  - 线性化基准潮流：等于上述指定运行注入功率下的潮流。\n- 案例4（环形网络，在不同的基准点线性化）：\n  - 节点：$4$个；平衡节点：$1$。\n  - 线路：$(1,2)$ 电抗 $x=0.1$，电阻 $r=0.01$；$(2,3)$ 电抗 $x=0.15$，电阻 $r=0.012$；$(3,4)$ 电抗 $x=0.1$，电阻 $r=0.01$；$(4,1)$ 电抗 $x=0.2$，电阻 $r=0.008$。\n  - 运行注入功率（单位 MW）：$[50,-10,-20,-20]$，总和为 $0$。\n  - 线性化基准潮流：由基准注入功率 $[40,-15,-15,-10]$（总和为 $0$）计算得出的潮流。\n\n为每个案例计算：\n- 每个非平衡节点的PTDF。\n- 在两种模型下，每个非平衡节点的损耗对节点电价的边际效应，设统一边际电能成本为 $1$/MWh。\n- 在所有非平衡节点上，DC-OPF线性损耗电价分量与AC-OPF二次损耗电价分量之间的最大绝对差值。\n\n您的程序应生成单行输出，其中包含四个案例的结果，形式为用方括号括起来的逗号分隔列表，单位为 $/MWh$，以十进制数表示，并四舍五入到六位小数（例如，\"[0.000000,0.123456,0.000010,0.001234]\"）。",
            "solution": "该问题要求比较输电损耗对节点电价的边际效应，该效应使用两种不同的模型计算：一种是直流最优潮流 (DC-OPF) 中典型的线性化损耗模型，另一种是代表交流最优潮流 (AC-OPF) 分析中常见损耗近似的二次损耗模型。我们将从第一性原理出发推导必要的公式，然后将其应用于给定的测试案例。\n\n### 数学公式\n\n假设电力系统有 $N$ 个节点，索引从 $1$ 到 $N$，以及 $L$ 条输电线路。设平衡节点用索引 $s$ 表示。所有其他节点构成非平衡节点集合 $NS$。\n\n**1. 直流潮流模型**\n\n直流潮流近似将节点注入功率与节点电压相角关联起来。连接节点 $i$ 到节点 $j$ 的线路 $\\ell$ 上的有功潮流 $P_{\\ell}$ 由下式给出：\n$$\nP_{\\ell} = \\frac{1}{x_{\\ell}}(\\theta_i - \\theta_j) = b_{\\ell}(\\theta_i - \\theta_j)\n$$\n其中 $x_{\\ell}$ 是线路电抗，$b_{\\ell}$ 是线路电纳，$\\theta_i, \\theta_j$ 是节点 $i$ 和 $j$ 的电压相角（以弧度为单位）。\n\n任何节点 $i$ 的净注入功率 $p_i$ 是离开该节点的所有潮流之和。这可以表示为矩阵形式：\n$$\np = B \\theta\n$$\n其中 $p$ 是节点注入功率向量，$\\theta$ 是节点电压相角向量，$B$ 是节点电纳矩阵。$B$ 的元素定义如下：\n$$\nB_{ii} = \\sum_{k \\neq i, (i,k) \\in L} b_{ik} \\quad \\text{且} \\quad B_{ij} = -b_{ij} \\text{ 对于 } i \\neq j\n$$\n按照惯例，将平衡节点的相角设置为零，即 $\\theta_s = 0$，以提供一个参考。然后我们可以求解 $|NS| = N-1$ 个非平衡节点的相角。设 $p_{ns}$ 和 $\\theta_{ns}$ 分别为非平衡节点的注入功率向量和相角向量。该方程组可简化为：\n$$\np_{ns} = B_{ns,ns} \\theta_{ns}\n$$\n其中 $B_{ns,ns}$ 是从 $B$ 中移除与平衡节点对应的行和列后得到的降阶电纳矩阵。非平衡节点的相角可通过以下方式求得：\n$$\n\\theta_{ns} = B_{ns,ns}^{-1} p_{ns}\n$$\n我们将降阶电纳矩阵的逆记为 $X_B = B_{ns,ns}^{-1}$。\n\n**2. 功率转移分布因子 (PTDF)**\n\n功率转移分布因子 $\\text{PTDF}_{\\ell,k}$ 是指，假设在非平衡节点 $k$ 的注入功率由平衡节点 $s$ 的等量取出功率所平衡时，线路 $\\ell$ 上的潮流对该注入功率的灵敏度。数学上表示为：\n$$\n\\text{PTDF}_{\\ell,k} = \\frac{\\partial P_{\\ell}}{\\partial p_k}\n$$\n使用链式法则，$\\frac{\\partial P_{\\ell}}{\\partial p_k} = \\sum_{i \\in NS} \\frac{\\partial P_{\\ell}}{\\partial \\theta_i} \\frac{\\partial \\theta_i}{\\partial p_k}$。\n对于从节点 $i$ 到 $j$ 的线路 $\\ell$，$\\frac{\\partial P_{\\ell}}{\\partial \\theta_i} = b_{\\ell}$ 且 $\\frac{\\partial P_{\\ell}}{\\partial \\theta_j} = -b_{\\ell}$。项 $\\frac{\\partial \\theta_i}{\\partial p_k}$ 是矩阵 $X_B$ 的元素 $(X_B)_{ik}$。\nPTDF矩阵 $\\Psi$（大小为 $L \\times (N-1)$）的更紧凑的矩阵形式为：\n$$\n\\Psi = \\frac{\\partial P_L}{\\partial p_{ns}} = (D_b A M) X_B\n$$\n其中 $P_L$ 是所有线路潮流的向量，$D_b$ 是线路电纳 ($b_{\\ell}$) 的对角矩阵，$A$ 是支路-节点关联矩阵，$M$ 是一个将 $(N-1)$ 维的非平衡向量嵌入到 $N$ 维全系统空间中的映射矩阵。\n\n一旦 $\\Psi$ 已知，对于给定的非平衡注入向量 $p_{ns}$，线路潮流向量 $P_L$ 就是：\n$$\nP_L = \\Psi p_{ns}\n$$\n\n**3. 损耗模型和边际损耗因子 (MLF)**\n\n线路 $\\ell$ 上的有功功率损耗与其电阻 $r_{\\ell}$ 和电流的平方成正比。在单位电压假设为 $1$ 的直流近似下，这简化为有功潮流的二次函数：\n$$\nP_{loss, \\ell} = r_{\\ell} P_{\\ell}^2\n$$\n总系统损耗是所有线路损耗的总和：$P_{loss, total} = \\sum_{\\ell=1}^{L} r_{\\ell} P_{\\ell}^2$。\n\n边际损耗因子 $\\text{MLF}_k$ 量化了在节点 $k$ 进行边际注入（由平衡节点平衡）时总系统损耗的变化。\n$$\n\\text{MLF}_k = \\frac{\\partial P_{loss, total}}{\\partial p_k} = \\sum_{\\ell=1}^{L} \\frac{\\partial (r_{\\ell} P_{\\ell}^2)}{\\partial P_{\\ell}} \\frac{\\partial P_{\\ell}}{\\partial p_k} = \\sum_{\\ell=1}^{L} 2 r_{\\ell} P_{\\ell} \\cdot \\text{PTDF}_{\\ell,k}\n$$\n假设统一的边际电能成本为 $\\lambda_{energy}$（此处 $\\lambda_{energy}=1 \\text{ \\$/MWh}$），则节点 $k$ 处由损耗引起的边际电价分量由下式给出：\n$$\n\\lambda_{k, loss} = - \\lambda_{energy} \\cdot \\text{MLF}_k = - \\text{MLF}_k\n$$\n这表示在节点 $k$ 每注入 1 MW 功率，总损耗成本的变化。\n\n我们现在分析两种指定的损耗模型。\n\n**模型A：AC-OPF 二次损耗模型**\n该模型使用二次损耗函数的精确导数，在当前运行点潮流 $P_{L,op}$ 处进行评估。\n节点 $k$ 的边际损耗因子为：\n$$\n\\text{MLF}_k^{AC} = \\sum_{\\ell=1}^{L} 2 r_{\\ell} P_{\\ell,op} \\cdot \\text{PTDF}_{\\ell,k}\n$$\n相应的边际电价分量是 $\\lambda_{k, loss}^{AC} = -\\text{MLF}_k^{AC}$。\n\n**模型B：DC-OPF 线性化损耗模型**\n该模型在一个预定义的基准潮流点 $P_{L,base}$ 周围对总损耗函数进行线性化。损耗函数的泰勒展开式为：\n$$\nP_{loss, total}(P_L) \\approx P_{loss, total}(P_{L,base}) + \\sum_{\\ell=1}^{L} \\left( \\frac{\\partial P_{loss, total}}{\\partial P_{\\ell}} \\bigg|_{P_{L,base}} \\right) (P_{\\ell} - P_{\\ell,base})\n$$\n导数项为 $\\frac{\\partial P_{loss, total}}{\\partial P_{\\ell}} \\bigg|_{P_{L,base}} = 2 r_{\\ell} P_{\\ell,base}$。线性化损耗函数为 $P_{loss, total}^{lin}(P_L) = C + \\sum_{\\ell} (2 r_{\\ell} P_{\\ell,base}) P_{\\ell}$，其中 $C$ 是一个常数。\n\n对于这个线性化模型，边际损耗因子是 $P_{loss, total}^{lin}$ 对 $p_k$ 的导数：\n$$\n\\text{MLF}_k^{DC} = \\frac{\\partial P_{loss, total}^{lin}}{\\partial p_k} = \\sum_{\\ell=1}^{L} (2 r_{\\ell} P_{\\ell,base}) \\frac{\\partial P_{\\ell}}{\\partial p_k} = \\sum_{\\ell=1}^{L} 2 r_{\\ell} P_{\\ell,base} \\cdot \\text{PTDF}_{\\ell,k}\n$$\n相应的边际电价分量是 $\\lambda_{k, loss}^{DC} = - \\text{MLF}_k^{DC}$。\n\n**4. 比较与最终计算**\n\n问题要求计算在所有非平衡节点上，两种模型的边际电价分量之间的最大绝对差。对于每个非平衡节点 $k$，这个差值为：\n$$\n\\Delta_k = \\lambda_{k, loss}^{DC} - \\lambda_{k, loss}^{AC} = (-\\text{MLF}_k^{DC}) - (-\\text{MLF}_k^{AC}) = \\text{MLF}_k^{AC} - \\text{MLF}_k^{DC}\n$$\n代入 MLF 的表达式：\n$$\n\\Delta_k = \\left( \\sum_{\\ell=1}^{L} 2 r_{\\ell} P_{\\ell,op} \\cdot \\text{PTDF}_{\\ell,k} \\right) - \\left( \\sum_{\\ell=1}^{L} 2 r_{\\ell} P_{\\ell,base} \\cdot \\text{PTDF}_{\\ell,k} \\right)\n$$\n$$\n\\Delta_k = \\sum_{\\ell=1}^{L} 2 r_{\\ell} (P_{\\ell,op} - P_{\\ell,base}) \\cdot \\text{PTDF}_{\\ell,k}\n$$\n以矩阵形式，所有非平衡节点的这些差值的向量 $\\Delta$ 为：\n$$\n\\Delta = \\Psi^T D_{2r} (P_{L,op} - P_{L,base})\n$$\n其中 $D_{2r}$ 是一个对角矩阵，其元素为 $2r_{\\ell}$。\n\n每个测试案例的最终结果是向量 $\\Delta$ 中元素的最大绝对值：\n$$\n\\text{Result} = \\max_{k \\in NS} |\\Delta_k|\n$$\n\n每个测试案例的步骤如下：\n1. 构建降阶电纳矩阵 $B_{ns,ns}$ 并求其逆矩阵 $X_B$。\n2. 计算PTDF矩阵 $\\Psi$。\n3. 根据运行注入功率 $p_{op}$ 确定运行潮流 $P_{L,op}$。\n4. 根据案例规范确定基准潮流 $P_{L,base}$。\n5. 使用上述公式计算差值向量 $\\Delta$。\n6. 找出 $\\Delta$ 中的最大绝对值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_max_difference(\n    num_buses, slack_bus, lines, op_injections, base_flow_spec):\n    \"\"\"\n    Calculates the maximum absolute difference in marginal loss price effects.\n\n    Args:\n        num_buses (int): Total number of buses.\n        slack_bus (int): 1-based index of the slack bus.\n        lines (list): List of tuples, where each is (from, to, x, r).\n        op_injections (np.array): Vector of operating power injections.\n        base_flow_spec (tuple): Specification for base flows. Can be\n            ('from_op', None), ('zero', None), or \n            ('from_injections', base_injections_array).\n    \n    Returns:\n        float: The maximum absolute difference in $/MWh.\n    \"\"\"\n    # Convert to 0-based indexing\n    slack_bus_idx = slack_bus - 1\n    non_slack_indices = [i for i in range(num_buses) if i != slack_bus_idx]\n    bus_map = {idx: i for i, idx in enumerate(non_slack_indices)}\n    num_non_slack = len(non_slack_indices)\n    num_lines = len(lines)\n\n    # 1. Build reduced susceptance matrix B_ns,ns\n    B = np.zeros((num_buses, num_buses))\n    for u, v, x, r in lines:\n        u_idx, v_idx = u - 1, v - 1\n        b = 1.0 / x\n        B[u_idx, u_idx] += b\n        B[v_idx, v_idx] += b\n        B[u_idx, v_idx] -= b\n        B[v_idx, u_idx] -= b\n    \n    B_nsns = B[np.ix_(non_slack_indices, non_slack_indices)]\n    \n    # 2. Compute inverse of B_ns,ns\n    X_B = np.linalg.inv(B_nsns)\n\n    # 3. Build matrices for PTDF calculation: Db, A, M\n    D_b = np.diag([1.0 / line[2] for line in lines])\n    \n    A = np.zeros((num_lines, num_buses))\n    for i, line in enumerate(lines):\n        u, v, _, _ = line\n        u_idx, v_idx = u - 1, v - 1\n        A[i, u_idx] = 1\n        A[i, v_idx] = -1\n\n    M = np.zeros((num_buses, num_non_slack))\n    for i, bus_idx in enumerate(non_slack_indices):\n        M[bus_idx, i] = 1\n        \n    # 4. Compute PTDF matrix (Psi)\n    # Psi = Db @ A @ M @ X_B\n    Psi = D_b.dot(A.dot(M)).dot(X_B)\n\n    # 5. Compute operating flows and base flows\n    p_op_ns = op_injections[non_slack_indices]\n    P_L_op = Psi.dot(p_op_ns)\n    \n    base_calc_type, base_data = base_flow_spec\n    if base_calc_type == 'from_op':\n        P_L_base = P_L_op\n    elif base_calc_type == 'zero':\n        P_L_base = np.zeros(num_lines)\n    elif base_calc_type == 'from_injections':\n        p_base_ns = base_data[non_slack_indices]\n        P_L_base = Psi.dot(p_base_ns)\n    else:\n        raise ValueError(\"Invalid base flow specification\")\n\n    # 6. Compute vector of differences in marginal price effects\n    # Delta = Psi^T * D_2r * (P_L_op - P_L_base)\n    resistances = np.array([line[3] for line in lines])\n    D_2r = np.diag(2 * resistances)\n    \n    flow_diff = P_L_op - P_L_base\n    \n    delta_vector = Psi.T.dot(D_2r.dot(flow_diff))\n    \n    # 7. Find the maximum absolute difference\n    if delta_vector.size == 0:\n        return 0.0\n    return np.max(np.abs(delta_vector))\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Case 1\",\n            \"num_buses\": 3, \"slack_bus\": 1,\n            \"lines\": [\n                (1, 2, 0.2, 0.01), \n                (2, 3, 0.25, 0.015)\n            ],\n            \"op_injections\": np.array([100.0, -60.0, -40.0]),\n            \"base_flow_spec\": ('from_op', None),\n        },\n        {\n            \"name\": \"Case 2\",\n            \"num_buses\": 3, \"slack_bus\": 1,\n            \"lines\": [\n                (1, 2, 0.2, 0.01), \n                (2, 3, 0.25, 0.015)\n            ],\n            \"op_injections\": np.array([100.0, -60.0, -40.0]),\n            \"base_flow_spec\": ('zero', None),\n        },\n        {\n            \"name\": \"Case 3\",\n            \"num_buses\": 4, \"slack_bus\": 1,\n            \"lines\": [\n                (1, 2, 0.2, 1e-5), \n                (2, 3, 0.2, 1e-5), \n                (3, 4, 0.2, 1e-5)\n            ],\n            \"op_injections\": np.array([80.0, -30.0, -30.0, -20.0]),\n            \"base_flow_spec\": ('from_op', None),\n        },\n        {\n            \"name\": \"Case 4\",\n            \"num_buses\": 4, \"slack_bus\": 1,\n            \"lines\": [\n                (1, 2, 0.1, 0.01), \n                (2, 3, 0.15, 0.012), \n                (3, 4, 0.1, 0.01), \n                (4, 1, 0.2, 0.008)\n            ],\n            \"op_injections\": np.array([50.0, -10.0, -20.0, -20.0]),\n            \"base_flow_spec\": ('from_injections', np.array([40.0, -15.0, -15.0, -10.0])),\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        max_diff = calculate_max_difference(\n            case[\"num_buses\"],\n            case[\"slack_bus\"],\n            case[\"lines\"],\n            case[\"op_injections\"],\n            case[\"base_flow_spec\"]\n        )\n        results.append(f\"{max_diff:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        }
    ]
}