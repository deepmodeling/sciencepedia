{
    "hands_on_practices": [
        {
            "introduction": "Understanding generator ramp rates begins with the fundamental physics of how a generator's power output can change over time. This exercise grounds your understanding in a continuous-time framework, challenging you to determine the quickest possible dispatch trajectory for a single generator. By navigating both the generator's intrinsic ramp limit and an external, time-varying constraint, you will apply principles of time-optimal control to visualize how these limits directly shape feasible operations.",
            "id": "4093099",
            "problem": "A single thermal generator has continuous-time active power output trajectory $P(t)$ in $\\mathrm{MW}$ and is subject to a symmetric ramp-rate limit expressed as $|\\dot{P}(t)| \\le r$, where $r$ is a positive constant in $\\mathrm{MW}/\\mathrm{min}$. The generator must move from an initial operating point $P(0)=P_0$ to a target $P(T)=P_f$ in the shortest allowable time $T$, while respecting a time-varying transmission cap on injection given by the state constraint $P(t) \\le \\bar{P}(t)$. The cap is\n$$\n\\bar{P}(t)=\n\\begin{cases}\nP_b,  0 \\le t \\le \\tau,\\\\\nP_{\\max},  t > \\tau,\n\\end{cases}\n$$\nwith $P_{\\max} \\ge P_f$, so that the cap is nonbinding after time $\\tau$. Assume the generator has no minimum power limit other than nonnegativity and that $P_f > P_0$. Use only the definition of ramp-rate and first principles of time-optimal control for first-order systems.\n\nGiven numerical parameters $P_0=160\\ \\mathrm{MW}$, $P_f=300\\ \\mathrm{MW}$, $r=12\\ \\mathrm{MW}/\\mathrm{min}$, $P_b=200\\ \\mathrm{MW}$, $\\tau=6\\ \\mathrm{min}$, and $P_{\\max}=400\\ \\mathrm{MW}$:\n\n- Construct an explicit continuous-time piecewise-linear trajectory $P(t)$ that satisfies $|\\dot{P}(t)| \\le r$ and $P(t) \\le \\bar{P}(t)$ for all $t \\ge 0$, and that achieves $P(T)=P_f$ in the shortest allowable time.\n- Justify from first principles why your trajectory is time-optimal among all feasible trajectories under these constraints.\n\nWhat is the minimal time $T^{\\star}$, expressed in $\\mathrm{min}$, required to reach $P_f$ from $P_0$? Your final answer must be a single number. Do not round; provide the exact value.",
            "solution": "The problem is a time-optimal control problem for a first-order system with a state constraint. The system equation is $\\dot{P}(t) = u(t)$, where $P(t)$ is the generator's power output and $u(t)$ is the control variable, representing the ramp rate.\n\n**Problem Validation**\n\nFirst, the problem statement is validated.\nThe givens are:\n- State variable: Active power $P(t)$ in $\\mathrm{MW}$.\n- System dynamics: $\\dot{P}(t) = u(t)$.\n- Control constraint: $|u(t)| = |\\dot{P}(t)| \\le r$, with $r = 12 \\ \\mathrm{MW}/\\mathrm{min}$.\n- State constraint: $P(t) \\le \\bar{P}(t)$, where $\\bar{P}(t)$ is a piecewise-constant function.\n- Initial condition: $P(0) = P_0 = 160 \\ \\mathrm{MW}$.\n- Terminal condition: $P(T) = P_f = 300 \\ \\mathrm{MW}$.\n- Objective: Minimize the final time $T$.\n- The state constraint function is $\\bar{P}(t) = \\begin{cases} P_b,  0 \\le t \\le \\tau \\\\ P_{\\max},  t > \\tau \\end{cases}$, with $P_b = 200 \\ \\mathrm{MW}$, $\\tau = 6 \\ \\mathrm{min}$, and $P_{\\max} = 400 \\ \\mathrm{MW}$.\n- Other conditions: $P_f > P_0$ and $P_{\\max} \\ge P_f$.\n\nThe problem is scientifically grounded in power systems engineering, representing a simplified but standard generator dispatch problem. It is well-posed, with a clear objective, and a complete and consistent set of constraints and numerical data. The language is objective and precise. The problem is therefore deemed valid and solvable.\n\n**Justification of Optimal Trajectory from First Principles**\n\nThe goal is to increase the state variable $P(t)$ from $P_0$ to $P_f$ in minimum time. For the system $\\dot{P}(t) = u(t)$ with $|u(t)| \\le r$, the principle of time-optimal control dictates that the state variable must change as rapidly as possible. Since $P_f > P_0$, this means the control should be at its positive maximum, $u(t) = \\dot{P}(t) = r$, whenever this is feasible.\n\nThe state constraint $P(t) \\le \\bar{P}(t)$ may prevent the system from maintaining $\\dot{P}(t) = r$ at all times. The optimal strategy, therefore, is to follow a \"greedy\" approach: at any time $t$, the generator's power output $P(t)$ should be the maximum possible value that can be reached from $P_0$ without violating any past or present constraints. This means the trajectory will always lie on the upper boundary of the feasible region in the $(t, P)$ plane. This boundary is formed by the curve of maximum ramp-up, $P_0 + rt$, and the state constraint ceiling, $\\bar{P}(t)$.\n\n**Construction of the Optimal Trajectory**\n\nWe construct the optimal trajectory, $P^*(t)$, piecewise, following the principles outlined above.\n\n**Phase 1: Initial Ramp-Up**\nThe generator starts at $P(0) = P_0 = 160 \\ \\mathrm{MW}$ and ramps up at its maximum rate $r = 12 \\ \\mathrm{MW}/\\mathrm{min}$. The trajectory is:\n$$ P(t) = P_0 + rt = 160 + 12t $$\nThis continues until a constraint is met. The first relevant constraint is the transmission cap $P(t) \\le P_b = 200 \\ \\mathrm{MW}$, which is active for $t \\in [0, \\tau]$. We find the time $t_1$ when the trajectory intersects this cap:\n$$ 160 + 12t_1 = 200 \\implies 12t_1 = 40 \\implies t_1 = \\frac{40}{12} = \\frac{10}{3} \\ \\mathrm{min} $$\nSince $t_1 \\approx 3.33 \\ \\mathrm{min}$ is less than $\\tau = 6 \\ \\mathrm{min}$, the generator hits this cap.\nFor $t \\in [0, \\frac{10}{3}]$, the optimal trajectory is $P^*(t) = 160 + 12t$. At $t_1 = \\frac{10}{3} \\ \\mathrm{min}$, the power is $P^*(t_1) = 200 \\ \\mathrm{MW}$.\n\n**Phase 2: Holding at the Transmission Cap**\nFor $t > t_1$, ramping up would violate $P(t) \\le P_b$. To stay on the optimal path (i.e., at the highest possible power), the generator must maintain its output at the ceiling. This requires a ramp rate of $\\dot{P}(t) = 0$, which is valid as $|0| \\le r$. This phase continues until the cap is raised at $t = \\tau = 6 \\ \\mathrm{min}$.\nFor $t \\in (\\frac{10}{3}, 6]$, the optimal trajectory is $P^*(t) = P_b = 200 \\ \\mathrm{MW}$.\n\n**Phase 3: Final Ramp-Up to Target**\nAt $t = \\tau = 6 \\ \\mathrm{min}$, the generator's power is $P^*(\\tau) = 200 \\ \\mathrm{MW}$. The cap is raised to $P_{\\max} = 400 \\ \\mathrm{MW}$. Since the target is $P_f = 300 \\ \\mathrm{MW}$ and $P_f  P_{\\max}$, the path to the target is now unconstrained by the cap. To reach $P_f$ in minimum time, the generator must resume ramping at the maximum rate $r$. The trajectory for $t > 6 \\ \\mathrm{min}$ is:\n$$ P(t) = P^*(\\tau) + r(t - \\tau) = 200 + 12(t - 6) $$\nWe find the final time $T^{\\star}$ by setting $P(T^{\\star}) = P_f$:\n$$ 200 + 12(T^{\\star} - 6) = 300 $$\n$$ 12(T^{\\star} - 6) = 100 $$\n$$ T^{\\star} - 6 = \\frac{100}{12} = \\frac{25}{3} $$\n$$ T^{\\star} = 6 + \\frac{25}{3} = \\frac{18}{3} + \\frac{25}{3} = \\frac{43}{3} \\ \\mathrm{min} $$\n\nThe full, piecewise-linear, continuous-time trajectory is:\n$$\nP^*(t) =\n\\begin{cases}\n160 + 12t,  0 \\le t \\le \\frac{10}{3} \\\\\n200,  \\frac{10}{3}  t \\le 6 \\\\\n200 + 12(t-6),  6  t \\le \\frac{43}{3}\n\\end{cases}\n$$\nThis trajectory is feasible, satisfying $|\\dot{P}^*(t)| \\le r$ and $P^*(t) \\le \\bar{P}(t)$ for all $t \\in [0, T^{\\star}]$, and arrives at $P_f$ at time $T^{\\star} = \\frac{43}{3} \\ \\mathrm{min}$.\n\n**Optimality Proof**\nLet $\\tilde{P}(t)$ be any other feasible trajectory that starts at $P(0)=P_0$ and reaches $P_f$ at time $\\tilde{T}$. By definition, it must satisfy $\\dot{\\tilde{P}}(t) \\le r$ and $\\tilde{P}(t) \\le \\bar{P}(t)$ for all $t$.\nFor any $t \\ge 0$, $\\tilde{P}(t) = P_0 + \\int_0^t \\dot{\\tilde{P}}(s) ds \\le P_0 + \\int_0^t r ds = P_0 + rt$.\nIn Phase 1, $P^*(t) = P_0 + rt$, so $\\tilde{P}(t) \\le P^*(t)$.\nIn Phase 2, $\\tilde{P}(t) \\le \\bar{P}(t) = P_b$. Since $P^*(t) = P_b$ in this interval, we again have $\\tilde{P}(t) \\le P^*(t)$.\nIn Phase 3, we have $\\tilde{P}(\\tau) \\le P^*(\\tau) = P_b$. For $t>\\tau$, $\\tilde{P}(t) = \\tilde{P}(\\tau) + \\int_\\tau^t \\dot{\\tilde{P}}(s) ds \\le P^*(\\tau) + \\int_\\tau^t r ds = P^*(t)$.\nThus, $\\tilde{P}(t) \\le P^*(t)$ for all $t \\ge 0$.\nNow assume, for contradiction, that $\\tilde{T}  T^{\\star}$. Then $\\tilde{P}(\\tilde{T}) = P_f$. We also have $\\tilde{P}(\\tilde{T}) \\le P^*(\\tilde{T})$. This implies $P_f \\le P^*(\\tilde{T})$.\nHowever, since $\\tilde{T}  T^{\\star}$ and $P^*(t)$ is strictly increasing on the interval $(6, T^{\\star}]$, we must have $P^*(\\tilde{T})  P^*(T^{\\star}) = P_f$.\nThis leads to the contradiction $P_f  P_f$. Therefore, the assumption $\\tilde{T}  T^{\\star}$ is false. It must be that $\\tilde{T} \\ge T^{\\star}$, proving that $T^{\\star}$ is the minimal time.\n\nThe minimal time required is $T^{\\star}$.\n$$ T^{\\star} = \\frac{43}{3} \\ \\mathrm{min} $$",
            "answer": "$$\\boxed{\\frac{43}{3}}$$"
        },
        {
            "introduction": "Moving from continuous theory to practical application, we must represent physical constraints within discrete-time optimization models used for grid scheduling. This problem focuses on a crucial aspect of this translation: correctly formulating ramp limits in a Unit Commitment (UC) model, particularly during startup events. You will derive the specific constraints that govern a generator's output in its first interval of operation, highlighting the special considerations required for transient states versus sustained operation.",
            "id": "4093090",
            "problem": "Consider a single thermal generator in a discrete-time scheduling model for Unit Commitment (UC). Let the time step be of duration $\\Delta t$ hours, and let $P_t$ denote the electrical power output at time step $t$, $u_t \\in \\{0,1\\}$ the on/off commitment at time step $t$, $y_t \\in \\{0,1\\}$ the startup indicator at time $t$ (equal to $1$ if and only if the generator transitions from off at $t-1$ to on at $t$), and $w_t \\in \\{0,1\\}$ the shutdown indicator at time $t$ (equal to $1$ if and only if the generator transitions from on at $t-1$ to off at $t$). The generator has minimum and maximum power output limits when committed, written as $P^{\\min}$ and $P^{\\max}$, respectively. When the generator is on, its output must satisfy the bound $P^{\\min} u_t \\le P_t \\le P^{\\max} u_t$. The generator has a sustained ramp-up capability $R^{\\uparrow}$ expressed in $\\mathrm{MW}/\\mathrm{h}$ for steady operation and an additional startup ramp allowance $S^{\\uparrow}$ expressed in $\\mathrm{MW}$ per time step when a startup occurs. Similarly, it has a sustained ramp-down capability $R^{\\downarrow}$ and a shutdown ramp allowance $S^{\\downarrow}$, but these are not required for this question.\n\nFrom the basic definition of a ramp rate as a bound on the time derivative of power output, together with the discrete-time approximation of this bound over interval length $\\Delta t$, and the interpretation of the startup allowance as an additional permissible increment in output only when $y_t=1$, construct the tightest possible upper bound on $P_t$ by combining the output limit constraint $P_t \\le P^{\\max} u_t$ with the ramp-up inequality linking $P_t$ and $P_{t-1}$ under the event of a startup. Your derivation must begin from the fundamental definitions above (rate-of-change bounded by $R^{\\uparrow}$ over $\\Delta t$, plus startup allowance only when $y_t=1$), and logically arrive at a single closed-form expression for the upper bound on $P_t$ in terms of $P_{t-1}$, $u_{t-1}$, $u_t$, $y_t$, $P^{\\min}$, $P^{\\max}$, $R^{\\uparrow}$, $S^{\\uparrow}$, and $\\Delta t$.\n\nThen evaluate your bound numerically for the following data and transition:\n- $\\Delta t = 0.25$ $\\mathrm{h}$,\n- $P^{\\min} = 60$ $\\mathrm{MW}$,\n- $P^{\\max} = 220$ $\\mathrm{MW}$,\n- $R^{\\uparrow} = 180$ $\\mathrm{MW}/\\mathrm{h}$,\n- $S^{\\uparrow} = 100$ $\\mathrm{MW}$,\n- $u_{t-1} = 0$, $u_t = 1$ (a startup, so $y_t = 1$), and $P_{t-1} = 0$ $\\mathrm{MW}$.\n\nExpress the final numerical upper bound as a single number in $\\mathrm{MW}$. No rounding is necessary beyond exact arithmetic. Your final answer must be a single real-valued number.",
            "solution": "The problem requires the derivation of the tightest possible upper bound on a thermal generator's power output, $P_t$, during a startup event. This is to be followed by a numerical evaluation for a specific set of parameters. The derivation must logically combine the generator's maximum power limit and its ramp-up characteristics, including a special allowance for startups.\n\nFirst, we identify all constraints that impose an upper limit on the power output $P_t$ at time step $t$.\n\n1.  **Maximum Power Limit**: When the generator is committed (i.e., online, $u_t = 1$), its output $P_t$ cannot exceed its maximum rated capacity, $P^{\\max}$. When the generator is offline ($u_t=0$), its output must be zero. Both conditions are captured by the inequality:\n    $$P_t \\le P^{\\max} u_t$$\n\n2.  **Ramp-Up Limitations**: The rate at which the generator can increase its power output is physically limited. These limits are typically different for sustained operation versus a startup from an offline state.\n\n    a.  **Sustained Ramp-Up**: For \"steady operation,\" meaning the generator is online at both time $t-1$ and time $t$ (i.e., $u_{t-1}=1$ and $u_t=1$), the change in power output is limited by the sustained ramp-up capability $R^{\\uparrow}$ (in $\\mathrm{MW}/\\mathrm{h}$). In a discrete-time model with time steps of duration $\\Delta t$, this is approximated as:\n        $$P_t - P_{t-1} \\le R^{\\uparrow} \\Delta t$$\n        This provides an upper bound on $P_t$ based on its previous state: $P_t \\le P_{t-1} + R^{\\uparrow} \\Delta t$.\n\n    b.  **Startup Ramp Allowance**: When a generator starts up at time $t$, its state transitions from off at $t-1$ ($u_{t-1}=0$, hence $P_{t-1}=0$) to on at $t$ ($u_t=1$). The problem specifies a \"startup ramp allowance\" $S^{\\uparrow}$ in units of $\\mathrm{MW}$. The term \"allowance\" in conjunction with the unit $\\mathrm{MW}$ indicates a limit on the achievable power level itself, not a rate. The most rigorous interpretation in the context of power systems modeling is that $S^{\\uparrow}$ represents the maximum power output the generator can reach in its first time interval of operation. The modifier \"additional\" signifies that this is a special constraint applied in the case of a startup, in addition to the standard operational constraints like sustained ramping and maximum power limits. Therefore, for a startup event ($y_t=1$), the power output is bounded by:\n        $$P_t \\le S^{\\uparrow}$$\n\nTo construct a single expression for the ramp-related upper bound that is valid for both sustained operation and startup, we can use the binary indicator variables. A single inequality that combines these two mutually exclusive cases is:\n$$P_t \\le P_{t-1} + R^{\\uparrow} \\Delta t \\cdot u_{t-1} + S^{\\uparrow} \\cdot y_t$$\nThis formulation is valid under the condition that $P_{t-1}=0$ if $u_{t-1}=0$, which is enforced by the general output limit constraints ($P^{\\min}u_{t-1} \\le P_{t-1} \\le P^{\\max}u_{t-1}$). Let's verify this expression:\n-   For sustained operation ($u_{t-1}=1, u_t=1, y_t=0$): The inequality becomes $P_t \\le P_{t-1} + R^{\\uparrow} \\Delta t$, which is the correct sustained ramp-up limit.\n-   For startup ($u_{t-1}=0, u_t=1, y_t=1$): Since $u_{t-1}=0$, we have $P_{t-1}=0$. The inequality becomes $P_t \\le 0 + (R^{\\uparrow} \\Delta t)(0) + S^{\\uparrow}(1)$, which simplifies to $P_t \\le S^{\\uparrow}$. This is the correct startup ramp limit.\n\nThe problem asks for the *tightest possible* upper bound on $P_t$. This is found by taking the minimum of all active upper-bounding constraints. Thus, the most comprehensive upper bound on $P_t$ at any time $t$ is:\n$$P_t \\le \\min\\left( P^{\\max} u_t, \\quad P_{t-1} + R^{\\uparrow} \\Delta t \\cdot u_{t-1} + S^{\\uparrow} \\cdot y_t \\right)$$\nThis expression satisfies the requirement for a single closed-form upper bound in terms of the specified variables.\n\nNow, we evaluate this bound for the specific case given in the problem: a startup event. The conditions are:\n-   Generator state transition: $u_{t-1}=0$ to $u_t=1$.\n-   This implies the startup indicator is $y_t=1$.\n-   The previous power output was $P_{t-1}=0 \\, \\mathrm{MW}$.\n\nWe substitute these values into the general upper bound expression.\nThe first argument of the minimum function becomes:\n$$P^{\\max} u_t = P^{\\max} \\cdot 1 = P^{\\max}$$\nThe second argument of the minimum function becomes:\n$$P_{t-1} + R^{\\uparrow} \\Delta t \\cdot u_{t-1} + S^{\\uparrow} \\cdot y_t = 0 + (R^{\\uparrow} \\Delta t) \\cdot 0 + S^{\\uparrow} \\cdot 1 = S^{\\uparrow}$$\nTherefore, for the specific case of a startup, the tightest possible upper bound on the generator's output is:\n$$P_t \\le \\min(P^{\\max}, S^{\\uparrow})$$\n\nFinally, we calculate the numerical value of this bound using the provided data:\n-   $P^{\\max} = 220 \\, \\mathrm{MW}$\n-   $S^{\\uparrow} = 100 \\, \\mathrm{MW}$\n\nThe numerical upper bound is:\n$$P_t \\le \\min(220, 100) = 100 \\, \\mathrm{MW}$$\n\nThe other data ($\\Delta t$, $P^{\\min}$, $R^{\\uparrow}$) are not needed for calculating the upper bound in this specific startup scenario, according to the standard and most rigorous interpretation of the startup ramp allowance $S^{\\uparrow}$. The derived bound is consistent with the generator's minimum output requirement ($P_t \\ge P^{\\min} = 60 \\, \\mathrm{MW}$), as the resulting feasible range for the startup is $60 \\, \\mathrm{MW} \\le P_t \\le 100 \\, \\mathrm{MW}$. The question, however, only asks for the upper bound.",
            "answer": "$$\\boxed{100}$$"
        },
        {
            "introduction": "Finally, we elevate our perspective from a single generator to the entire power system, where ramp capabilities are not just physical constraints but also valuable economic resources. This exercise places you in the role of a system operator allocating upward ramp reserve to minimize costs while meeting a system-wide requirement. By applying principles of convex optimization, you will discover how a market-clearing price for ramp capacity emerges, ensuring the most economical dispatch and providing a clear justification for why some generators are chosen to provide this crucial service over others.",
            "id": "4093106",
            "problem": "Consider an energy systems modeling task focused on generator upward ramp-rate reserve allocation. There are $n$ thermal generator units indexed by $i \\in \\{1, \\dots, n\\}$. Each unit has an upward ramp-rate capability $RU_i$ measured in $\\mathrm{MW/min}$. An independent system operator must allocate upward ramp reserve $x_i$ (measured in $\\mathrm{MW/min}$) to each unit for a single dispatch interval, to meet a system-level upward ramp reserve requirement $R$ (measured in $\\mathrm{MW/min}$). The allocation must satisfy $0 \\leq x_i \\leq RU_i$ for all units and $\\sum_{i=1}^{n} x_i = R$.\n\nEach unitâ€™s upward ramp reserve incurs a strictly convex cost given by $C_i(x_i) = \\frac{1}{2} q_i x_i^2 + c_i x_i$, where $q_i  0$ has units of dollars per $(\\mathrm{MW/min})^2$ and $c_i \\geq 0$ has units of dollars per $\\mathrm{MW/min}$. The objective is to determine the allocation vector $\\mathbf{x} = (x_1, \\dots, x_n)$ that minimizes the total reserve cost $\\sum_{i=1}^{n} C_i(x_i)$ subject to the constraints described above.\n\nStarting from fundamental laws and core definitions in constrained optimization and calculus (e.g., the concept of marginal cost as the derivative of the cost function and feasibility in linear inequality constraints), you must derive the algorithmic approach and then implement a complete, runnable program that computes the optimal allocation $\\mathbf{x}$ for each of the provided test cases. You must also provide a principled justification of the resulting dispatch using marginal analysis in your solution. Do not use any shortcut formulas without derivation; derive your method from first principles.\n\nAssumptions:\n- $q_i  0$ for all $i$.\n- The requirement $R$ satisfies $0 \\leq R \\leq \\sum_{i=1}^{n} RU_i$ (i.e., feasibility).\n- All inputs are deterministic and represent a single dispatch interval, and each $x_i$ is continuous within its bounds.\n\nYour program must implement a robust numerical procedure to obtain $\\mathbf{x}$, achieving the equality constraint $\\sum_{i=1}^{n} x_i = R$ within a numerical tolerance of $10^{-9}$.\n\nPhysical units:\n- Express every allocation $x_i$ in $\\mathrm{MW/min}$.\n- In the final output, print each $x_i$ as a decimal float with exactly $6$ digits after the decimal point.\n\nTest suite:\nCompute the optimal allocation for the following four cases. Each case is specified by the tuple $(\\{RU_i\\}_{i=1}^{n}, \\{q_i\\}_{i=1}^{n}, \\{c_i\\}_{i=1}^{n}, R)$.\n\n- Case $1$: $n = 3$, $RU = [\\,30,\\,20,\\,10\\,]$ $\\mathrm{MW/min}$, $q = [\\,0.8,\\,0.4,\\,1.2\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,4.0,\\,3.0,\\,5.5\\,]$ dollars per $\\mathrm{MW/min}$, $R = 35$ $\\mathrm{MW/min}$.\n- Case $2$: $n = 2$, $RU = [\\,15,\\,15\\,]$ $\\mathrm{MW/min}$, $q = [\\,0.5,\\,0.5\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,2.0,\\,2.0\\,]$ dollars per $\\mathrm{MW/min}$, $R = 0$ $\\mathrm{MW/min}$.\n- Case $3$: $n = 4$, $RU = [\\,5,\\,10,\\,15,\\,20\\,]$ $\\mathrm{MW/min}$, $q = [\\,1.0,\\,0.2,\\,0.6,\\,0.4\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,3.5,\\,2.0,\\,2.5,\\,3.0\\,]$ dollars per $\\mathrm{MW/min}$, $R = 50$ $\\mathrm{MW/min}$.\n- Case $4$: $n = 4$, $RU = [\\,50,\\,5,\\,0,\\,40\\,]$ $\\mathrm{MW/min}$, $q = [\\,0.1,\\,1.5,\\,0.8,\\,0.3\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,1.0,\\,10.0,\\,2.0,\\,1.5\\,]$ dollars per $\\mathrm{MW/min}$, $R = 60$ $\\mathrm{MW/min}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is an inner list representing the optimal allocations $\\mathbf{x}$ for one case, in unit $\\mathrm{MW/min}$, with each value printed with exactly $6$ digits after the decimal point. For example, the output should have the form $[\\,[x_{1,1},x_{1,2},\\dots],\\,[x_{2,1},x_{2,2},\\dots],\\,\\dots\\,]$ with no spaces anywhere in the line.",
            "solution": "The user-provided problem is a well-posed, scientifically-grounded problem in the field of energy systems modeling, specifically concerning the economic dispatch of ramp-rate reserves. It is a classic convex optimization problem that can be solved using principles of constrained optimization.\n\n### Step 1: Extract Givens\n- **Indices**: $n$ generator units, indexed by $i \\in \\{1, \\dots, n\\}$.\n- **Parameters per unit $i$**:\n    - Upward ramp-rate capability: $RU_i$ [$\\mathrm{MW/min}$]\n    - Cost function coefficients: $q_i  0$ [dollars/($\\mathrm{MW/min})^2$] and $c_i \\geq 0$ [dollars/$\\mathrm{MW/min}$].\n- **System-level requirement**:\n    - Total upward ramp reserve requirement: $R$ [$\\mathrm{MW/min}$].\n- **Decision variables**:\n    - Upward ramp reserve allocation for unit $i$: $x_i$ [$\\mathrm{MW/min}$]. The vector of allocations is $\\mathbf{x} = (x_1, \\dots, x_n)$.\n- **Objective function**:\n    - Minimize total cost: $\\sum_{i=1}^{n} C_i(x_i)$, where $C_i(x_i) = \\frac{1}{2} q_i x_i^2 + c_i x_i$.\n- **Constraints**:\n    - System requirement: $\\sum_{i=1}^{n} x_i = R$.\n    - Individual capability: $0 \\leq x_i \\leq RU_i$ for all $i \\in \\{1, \\dots, n\\}$.\n- **Assumptions**:\n    - $q_i  0$ for all $i$.\n    - $0 \\leq R \\leq \\sum_{i=1}^{n} RU_i$.\n    - All inputs are deterministic.\n    - $x_i$ are continuous variables.\n- **Numerical precision**:\n    - The equality constraint $\\sum_{i=1}^{n} x_i = R$ must be met within a tolerance of $10^{-9}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is a standard economic dispatch model used in power systems engineering. The quadratic cost function represents the increasing marginal cost of providing a service, a common assumption for thermal generators. The constraints represent physical limitations and system-wide requirements. All concepts are firmly based on established engineering and optimization theory.\n2.  **Well-Posed**: The problem is well-posed. The objective function is a sum of strictly convex functions (since each $q_i  0$), making the total cost function strictly convex. The feasible region, defined by linear equality and inequality constraints, is a convex set. Minimizing a strictly convex function over a convex set guarantees that a unique optimal solution exists. The assumption $0 \\leq R \\leq \\sum_{i=1}^{n} RU_i$ ensures that the feasible set is non-empty, so a solution is guaranteed to exist.\n3.  **Objective**: The problem is stated using precise mathematical language, free of ambiguity or subjective claims.\n\nThe problem formulation is complete, consistent, and scientifically sound. It is a valid optimization problem.\n\n### Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\nThe problem is to find the allocation vector $\\mathbf{x} = (x_1, \\dots, x_n)$ that solves the following constrained optimization problem:\n$$\n\\begin{aligned}\n \\underset{\\mathbf{x}}{\\text{minimize}}\n  \\sum_{i=1}^{n} \\left(\\frac{1}{2} q_i x_i^2 + c_i x_i\\right) \\\\\n \\text{subject to}\n  \\sum_{i=1}^{n} x_i = R \\\\\n   0 \\leq x_i \\leq RU_i, \\quad \\forall i \\in \\{1, \\dots, n\\}\n\\end{aligned}\n$$\n\nThis is a convex optimization problem. We can derive the conditions for optimality using the method of Lagrange multipliers, specifically by formulating the Karush-Kuhn-Tucker (KKT) conditions. The constraints can be written as $R - \\sum_{i=1}^{n} x_i = 0$, $-x_i \\leq 0$, and $x_i - RU_i \\leq 0$.\n\nThe Lagrangian function $L$ for this problem is:\n$$\nL(\\mathbf{x}, \\lambda, \\boldsymbol{\\mu}, \\boldsymbol{\\nu}) = \\sum_{i=1}^{n} \\left(\\frac{1}{2} q_i x_i^2 + c_i x_i\\right) + \\lambda \\left(R - \\sum_{i=1}^{n} x_i\\right) + \\sum_{i=1}^{n} \\mu_i (-x_i) + \\sum_{i=1}^{n} \\nu_i (x_i - RU_i)\n$$\nwhere $\\lambda$ is the Lagrange multiplier for the equality constraint, and $\\mu_i \\geq 0$ and $\\nu_i \\geq 0$ are the multipliers for the lower and upper bound inequality constraints on $x_i$, respectively.\n\nThe KKT conditions for an optimal solution $(\\mathbf{x}^*, \\lambda^*, \\boldsymbol{\\mu}^*, \\boldsymbol{\\nu}^*)$ are:\n\n1.  **Stationarity**: The gradient of the Lagrangian with respect to each $x_i$ must be zero.\n    $$\n    \\frac{\\partial L}{\\partial x_i} = q_i x_i + c_i - \\lambda - \\mu_i + \\nu_i = 0 \\quad \\forall i\n    $$\n    This can be rearranged to $q_i x_i + c_i = \\lambda + \\mu_i - \\nu_i$. The term $q_i x_i + c_i$ is the derivative of the cost function, $C'_i(x_i)$, known as the **marginal cost** of unit $i$.\n\n2.  **Primal Feasibility**: The original constraints must be satisfied.\n    $$\n    \\sum_{i=1}^{n} x_i = R\n    $$\n    $$\n    0 \\leq x_i \\leq RU_i \\quad \\forall i\n    $$\n\n3.  **Dual Feasibility**: The Lagrange multipliers for inequality constraints must be non-negative.\n    $$\n    \\mu_i \\geq 0, \\quad \\nu_i \\geq 0 \\quad \\forall i\n    $$\n\n4.  **Complementary Slackness**: The product of an inequality multiplier and its corresponding constraint must be zero.\n    $$\n    \\mu_i x_i = 0 \\quad \\forall i\n    $$\n    $$\n    \\nu_i (x_i - RU_i) = 0 \\quad \\forall i\n    $$\n\nFrom these conditions, we derive the optimal allocation $x_i$ for a given system marginal price $\\lambda$. We analyze three cases for each unit $i$:\n\n-   **Case A: The unit is dispatched between its limits ($0  x_i  RU_i$)**\n    Since $x_i  0$ and $x_i  RU_i$, the complementary slackness conditions imply that $\\mu_i = 0$ and $\\nu_i = 0$. The stationarity condition then simplifies to:\n    $$\n    q_i x_i + c_i = \\lambda \\quad \\implies \\quad x_i = \\frac{\\lambda - c_i}{q_i}\n    $$\n    This shows that all units operating within their bounds must have the same marginal cost, equal to $\\lambda$.\n\n-   **Case B: The unit is at its lower bound ($x_i = 0$)**\n    Since $x_i  RU_i$ (assuming $RU_i  0$), complementary slackness implies $\\nu_i = 0$. The stationarity condition is $c_i - \\lambda - \\mu_i = 0$. Since $\\mu_i \\geq 0$, this means $c_i - \\lambda \\geq 0$, or $\\lambda \\leq c_i$. The unit's base marginal cost is too high relative to the system price $\\lambda$, so it is not dispatched.\n\n-   **Case C: The unit is at its upper bound ($x_i = RU_i$)**\n    Since $x_i  0$ (assuming $RU_i  0$), complementary slackness implies $\\mu_i = 0$. The stationarity condition is $q_i RU_i + c_i - \\lambda + \\nu_i = 0$. Since $\\nu_i \\geq 0$, this means $q_i RU_i + c_i - \\lambda \\leq 0$, or $\\lambda \\geq q_i RU_i + c_i$. The unit is so economical that even at its maximum output, its marginal cost is less than or equal to the system price $\\lambda$.\n\nCombining these three cases, we can express the optimal allocation for unit $i$ as a function of the single parameter $\\lambda$:\n$$\nx_i(\\lambda) = \\begin{cases}\nRU_i  \\text{if } \\lambda  q_i RU_i + c_i \\\\\n\\frac{\\lambda - c_i}{q_i}  \\text{if } c_i \\leq \\lambda \\leq q_i RU_i + c_i \\\\\n0  \\text{if } \\lambda  c_i\n\\end{cases}\n$$\nThis can be written more compactly as:\n$$\nx_i(\\lambda) = \\max\\left(0, \\min\\left(RU_i, \\frac{\\lambda - c_i}{q_i}\\right)\\right)\n$$\nThis function $x_i(\\lambda)$ is continuous and monotonically non-decreasing with respect to $\\lambda$.\n\n### Algorithmic Approach\nThe core of the problem is to find the unique value of the system marginal cost, $\\lambda^*$, such that the total allocation meets the system requirement:\n$$\n\\sum_{i=1}^{n} x_i(\\lambda^*) = R\n$$\nLet us define a function $f(\\lambda) = \\sum_{i=1}^{n} x_i(\\lambda) - R$. We are looking for the root of $f(\\lambda) = 0$. Since each $x_i(\\lambda)$ is a monotonically non-decreasing function of $\\lambda$, their sum $\\sum_{i=1}^{n} x_i(\\lambda)$ is also monotonic. This property makes the root-finding problem very well-suited for a bisection search algorithm.\n\nThe bisection algorithm proceeds as follows:\n\n1.  **Establish a search interval $[\\lambda_{\\text{low}}, \\lambda_{\\text{high}}]$ for $\\lambda$**:\n    -   A lower bound can be set to $\\lambda_{\\text{low}} = 0$, since $c_i \\geq 0$. If $\\lambda  0$, all $x_i$ would be $0$.\n    -   An upper bound $\\lambda_{\\text{high}}$ must be large enough such that $\\sum_{i=1}^{n} x_i(\\lambda_{\\text{high}}) \\geq R$. A safe, sufficiently large value can be chosen, for instance, by finding the maximum possible marginal cost across all units: $\\lambda_{\\text{high}} = \\max_i(c_i + q_i RU_i)$.\n\n2.  **Iterate to find the root**:\n    -   Repeat for a fixed number of iterations (e.g., $100$) to achieve high precision, or until the search interval is sufficiently small.\n    -   In each iteration, calculate the midpoint $\\lambda_{\\text{mid}} = (\\lambda_{\\text{low}} + \\lambda_{\\text{high}}) / 2$.\n    -   Calculate the total allocation at this trial value: $X_{\\text{total}} = \\sum_{i=1}^{n} \\max\\left(0, \\min\\left(RU_i, \\frac{\\lambda_{\\text{mid}} - c_i}{q_i}\\right)\\right)$.\n    -   Update the interval:\n        -   If $X_{\\text{total}}  R$, the trial $\\lambda_{\\text{mid}}$ is too low to meet the requirement. We need to increase the marginal cost to procure more reserve. Thus, we set $\\lambda_{\\text{low}} = \\lambda_{\\text{mid}}$.\n        -   If $X_{\\text{total}} \\geq R$, the trial $\\lambda_{\\text{mid}}$ is high enough or too high. We can potentially achieve the requirement with a lower cost. Thus, we set $\\lambda_{\\text{high}} = \\lambda_{\\text{mid}}$.\n\n3.  **Final Calculation**:\n    -   After the iterations complete, the optimal marginal cost $\\lambda^*$ is taken as the midpoint of the final interval, $\\lambda^* = (\\lambda_{\\text{low}} + \\lambda_{\\text{high}}) / 2$.\n    -   The final optimal allocation vector $\\mathbf{x}^* = (x_1^*, \\dots, x_n^*)$ is computed using this $\\lambda^*$:\n        $$\n        x_i^* = \\max\\left(0, \\min\\left(RU_i, \\frac{\\lambda^* - c_i}{q_i}\\right)\\right) \\quad \\forall i\n        $$\nThis algorithm is robust, efficient, and guaranteed to converge to the unique optimal solution due to the monotonicity of $f(\\lambda)$. A sufficient number of iterations (e.g., $100$) on standard double-precision floating-point numbers will ensure that the final constraint $\\left| \\sum x_i - R \\right|$ is well within the required tolerance of $10^{-9}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the ramp-rate reserve allocation problem for a series of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: n = 3, RU = [30, 20, 10], q = [0.8, 0.4, 1.2], c = [4.0, 3.0, 5.5], R = 35\n        (np.array([30.0, 20.0, 10.0]), np.array([0.8, 0.4, 1.2]), np.array([4.0, 3.0, 5.5]), 35.0),\n        # Case 2: n = 2, RU = [15, 15], q = [0.5, 0.5], c = [2.0, 2.0], R = 0\n        (np.array([15.0, 15.0]), np.array([0.5, 0.5]), np.array([2.0, 2.0]), 0.0),\n        # Case 3: n = 4, RU = [5, 10, 15, 20], q = [1.0, 0.2, 0.6, 0.4], c = [3.5, 2.0, 2.5, 3.0], R = 50\n        (np.array([5.0, 10.0, 15.0, 20.0]), np.array([1.0, 0.2, 0.6, 0.4]), np.array([3.5, 2.0, 2.5, 3.0]), 50.0),\n        # Case 4: n = 4, RU = [50, 5, 0, 40], q = [0.1, 1.5, 0.8, 0.3], c = [1.0, 10.0, 2.0, 1.5], R = 60\n        (np.array([50.0, 5.0, 0.0, 40.0]), np.array([0.1, 1.5, 0.8, 0.3]), np.array([1.0, 10.0, 2.0, 1.5]), 60.0),\n    ]\n\n    all_results = []\n\n    for RU, q, c, R in test_cases:\n        # Handle the trivial case where R=0\n        if R == 0:\n            allocations = np.zeros_like(RU)\n            all_results.append(allocations)\n            continue\n        \n        # Handle the trivial case where R is the sum of all capacities\n        if abs(R - np.sum(RU))  1e-9:\n            allocations = RU\n            all_results.append(allocations)\n            continue\n            \n        # 1. Establish a search interval for lambda\n        lambda_low = 0.0\n        # A safe upper bound for lambda is the max possible marginal cost\n        # Add a small epsilon to handle cases where RU might be zero\n        lambda_high = np.max(c + q * (RU + 1e-9)) * 1.5 # Multiplied by 1.5 for an extra margin\n        \n        # For a more robust upper bound, ensure it's sufficiently large\n        lambda_high = max(lambda_high, 1000.0)\n\n        # 2. Iterate using bisection search to find the optimal lambda\n        # 100 iterations are more than sufficient for double precision convergence\n        for _ in range(100):\n            lambda_mid = (lambda_low + lambda_high) / 2.0\n            \n            # Calculate total allocation for the current lambda_mid\n            # x_i = (lambda - c_i) / q_i, clipped by [0, RU_i]\n            # np.divide is used for safe division, although q_i > 0 is assumed\n            x = (lambda_mid - c) / q\n            allocations = np.maximum(0.0, np.minimum(RU, x))\n            \n            total_allocation = np.sum(allocations)\n            \n            # Update the search interval\n            if total_allocation  R:\n                lambda_low = lambda_mid\n            else:\n                lambda_high = lambda_mid\n        \n        # 3. Final calculation using the determined optimal lambda\n        lambda_opt = (lambda_low + lambda_high) / 2.0\n        \n        final_x = (lambda_opt - c) / q\n        final_allocations = np.maximum(0.0, np.minimum(RU, final_x))\n        \n        # An optional step to correct for floating point inaccuracies to perfectly match R.\n        # However, 100 iterations of bisection typically make the error negligible (well within 1e-9).\n        residual = R - np.sum(final_allocations)\n        # Identify generators not at their bounds\n        active_mask = (final_allocations > 1e-9)  (final_allocations  RU - 1e-9)\n        \n        if np.any(active_mask):\n            # Calculate sum of 1/q_i for active generators\n            inv_q_sum_active = np.sum(1.0 / q[active_mask])\n            if inv_q_sum_active > 0:\n                # Distribute residual proportionally\n                final_allocations[active_mask] += residual * (1.0 / q[active_mask]) / inv_q_sum_active\n        \n        # Ensure positivity and bounds again after correction\n        final_allocations = np.maximum(0.0, np.minimum(RU, final_allocations))\n\n        all_results.append(final_allocations)\n\n    # Format output string\n    output_parts = []\n    for result_vector in all_results:\n        formatted_vector = ','.join([f\"{val:.6f}\" for val in result_vector])\n        output_parts.append(f\"[{formatted_vector}]\")\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}