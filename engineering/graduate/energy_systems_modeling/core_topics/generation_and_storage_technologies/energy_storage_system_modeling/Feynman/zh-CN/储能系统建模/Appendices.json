{
    "hands_on_practices": [
        {
            "introduction": "本节的实践练习将从一个宏观尺度、基于成熟物理原理的储能系统开始：抽水蓄能。通过从第一性原理出发，推导一个抽水蓄能电站的往返效率，你将练习如何将基础的流体力学和能量守恒定律应用于实际的工程系统分析中。这项练习旨在强化对系统级效率建模的理解，特别是如何量化和整合水力损失与机电转换效率。",
            "id": "4090291",
            "problem": "一个抽水蓄能设施通过一根恒定圆形横截面的单直钢制压力钢管连接上、下两个水库。水库具有较大的自由表面，因此水库处的速度水头可以忽略不计。水库自由表面之间的总静态高程差为 $H = 120 \\ \\mathrm{m}$。压力钢管的长度为 $L = 800 \\ \\mathrm{m}$，内径为 $D = 4 \\ \\mathrm{m}$。在发电期间，体积流量为 $Q_{\\mathrm{gen}} = 50 \\ \\mathrm{m^3/s}$，持续时间为 $T_{\\mathrm{gen}} = 6 \\ \\mathrm{h}$；在抽水期间，流量为 $Q_{\\mathrm{pump}} = 45 \\ \\mathrm{m^3/s}$，抽水过程持续到上水库恢复到其初始高程。流体是水，被建模为不可压缩流体，密度为 $\\rho = 1000 \\ \\mathrm{kg/m^3}$。取重力加速度 $g = 9.81 \\ \\mathrm{m/s^2}$。假设水力损失参数与方向有关：在发电期间，达西-魏斯巴赫摩擦系数为 $f_{\\mathrm{gen}} = 0.018$，局部损失系数之和为 $K_{\\mathrm{gen}} = 2.0$；在抽水期间，$f_{\\mathrm{pump}} = 0.020$，$K_{\\mathrm{pump}} = 2.5$。水轮机的水力效率为 $\\eta_{\\mathrm{turb,h}} = 0.92$，发电机的机电效率为 $\\eta_{\\mathrm{e,gen}} = 0.98$。水泵的水力效率为 $\\eta_{\\mathrm{pump,h}} = 0.88$，电动机的机电效率为 $\\eta_{\\mathrm{motor}} = 0.96$。忽略大气压差、空化极限、压力波动现象以及除静态水头 $H$ 中隐含的高程变化外的任何压力钢管高程变化。\n\n从不可压缩流动的机械能平衡基本原理和重力势能的定义出发，推导将一定体积的流体提升静态水头所储存的重力势能的表达式，然后为该抽水蓄能系统建立包含水力损失和转换效率的往返能量平衡方程。利用给定数据，计算往返效率 (RTE)，其定义为当抽水体积恰好使上水库恢复到其初始高程时，发电期间产生的电能与抽水期间消耗的电能之比。\n\n将最终的 RTE 表示为无量纲小数，并将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求推导抽水蓄能系统的往返效率 (RTE) 并根据所提供的数据进行计算。求解过程分为三个阶段：势能公式的初步推导，系统能量平衡的建立，以及 RTE 的数值计算。\n\n首先，我们推导提升一定体积流体所储存的重力势能 $E_p$ 的表达式。将质量为 $m$ 的物体在重力（加速度为 $g$）作用下沿垂直高度 $H$ 提升所做的功 $W$ 会作为势能储存起来。\n$$ W = \\text{力} \\times \\text{距离} = (mg)H $$\n因此，势能为 $E_p = mgH$。对于密度为 $\\rho$、体积为 $V$ 的流体，其质量为 $m = \\rho V$。将此代入能量表达式可得：\n$$ E_p = \\rho g V H $$\n\n接下来，我们建立往返能量平衡方程。RTE 定义为在发电期间产生的电能 $E_{\\mathrm{elec,gen}}$ 与为使系统恢复到初始状态而在抽水期间消耗的电能 $E_{\\mathrm{elec,pump}}$ 之比。\n$$ \\mathrm{RTE} = \\frac{E_{\\mathrm{elec,gen}}}{E_{\\mathrm{elec,pump}}} $$\n\n**发电模式分析**\n我们在上水库表面（点1）和下水库表面（点2）之间应用不可压缩流体的机械能平衡（扩展伯努利方程）：\n$$ \\frac{P_1}{\\rho g} + \\frac{v_1^2}{2g} + z_1 = \\frac{P_2}{\\rho g} + \\frac{v_2^2}{2g} + z_2 + H_{\\mathrm{turb}} + h_{L,\\mathrm{gen}} $$\n在这里，$P$ 是压力，$v$ 是速度，$z$ 是高程，$H_{\\mathrm{turb}}$ 是水轮机提取的水头，$h_{L,\\mathrm{gen}}$ 是总水力水头损失。鉴于水库很大（$v_1 \\approx 0, v_2 \\approx 0$）且对大气开放（$P_1 = P_2$），并且静态水头为 $H = z_1 - z_2$，方程简化为 $H = H_{\\mathrm{turb}} + h_{L,\\mathrm{gen}}$。\n输送给水轮机的净水头为 $H_{\\mathrm{net,gen}} = H_{\\mathrm{turb}} = H - h_{L,\\mathrm{gen}}$。从水流中提取的水力功率为：\n$$ P_{\\mathrm{hyd,gen}} = \\rho g Q_{\\mathrm{gen}} H_{\\mathrm{net,gen}} = \\rho g Q_{\\mathrm{gen}} (H - h_{L,\\mathrm{gen}}) $$\n该水力功率以 $\\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}}$ 的综合效率转换为电功率：\n$$ P_{\\mathrm{elec,gen}} = \\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}} P_{\\mathrm{hyd,gen}} $$\n在持续时间 $T_{\\mathrm{gen}}$ 内产生的总能量为 $E_{\\mathrm{elec,gen}} = P_{\\mathrm{elec,gen}} T_{\\mathrm{gen}}$。\n\n**抽水模式分析**\n在抽水期间，下水库（点2）和上水库（点1）之间的能量平衡包括由水泵增加的水头 $H_{\\mathrm{pump}}$：\n$$ \\frac{P_2}{\\rho g} + \\frac{v_2^2}{2g} + z_2 + H_{\\mathrm{pump}} = \\frac{P_1}{\\rho g} + \\frac{v_1^2}{2g} + z_1 + h_{L,\\mathrm{pump}} $$\n在相同假设下，可得 $H_{\\mathrm{pump}} = (z_1 - z_2) + h_{L,\\mathrm{pump}} = H + h_{L,\\mathrm{pump}}$。这是水泵必须克服的总动水头。输送给水的水力功率为：\n$$ P_{\\mathrm{hyd,pump}} = \\rho g Q_{\\mathrm{pump}} H_{\\mathrm{pump}} = \\rho g Q_{\\mathrm{pump}} (H + h_{L,\\mathrm{pump}}) $$\n综合效率为 $\\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}$ 的电动机-水泵机组所消耗的电功率为：\n$$ P_{\\mathrm{elec,pump}} = \\frac{P_{\\mathrm{hyd,pump}}}{\\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}} $$\n为了将发电期间排开的水量 $V = Q_{\\mathrm{gen}} T_{\\mathrm{gen}}$ 抽回，抽水持续时间必须为 $T_{\\mathrm{pump}} = V / Q_{\\mathrm{pump}} = (Q_{\\mathrm{gen}} T_{\\mathrm{gen}}) / Q_{\\mathrm{pump}}$。消耗的总能量为 $E_{\\mathrm{elec,pump}} = P_{\\mathrm{elec,pump}} T_{\\mathrm{pump}}$。\n\n**RTE 计算**\n将能量表达式代入 RTE 定义中：\n$$ \\mathrm{RTE} = \\frac{ (\\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}}) (\\rho g Q_{\\mathrm{gen}} (H - h_{L,\\mathrm{gen}})) T_{\\mathrm{gen}} }{ \\frac{\\rho g Q_{\\mathrm{pump}} (H + h_{L,\\mathrm{pump}})}{\\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}} \\left( \\frac{Q_{\\mathrm{gen}} T_{\\mathrm{gen}}}{Q_{\\mathrm{pump}}} \\right) } $$\n通过消去公因子（$\\rho, g, T_{\\mathrm{gen}}, Q_{\\mathrm{gen}}, Q_{\\mathrm{pump}}$）进行简化，得到 RTE 的最终表达式：\n$$ \\mathrm{RTE} = (\\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}} \\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}) \\left( \\frac{H - h_{L,\\mathrm{gen}}}{H + h_{L,\\mathrm{pump}}} \\right) $$\n水力水头损失 $h_{L}$ 使用达西-魏斯巴赫方程计算摩擦损失，并使用局部损失公式计算：\n$$ h_{L} = \\left( f \\frac{L}{D} + K \\right) \\frac{v^2}{2g} $$\n其中 $v=Q/A$ 且 $A = \\pi D^2 / 4$。\n\n**数值计算**\n给定的数值如下：\n$H = 120 \\ \\mathrm{m}$，$L = 800 \\ \\mathrm{m}$，$D = 4 \\ \\mathrm{m}$，$g = 9.81 \\ \\mathrm{m/s^2}$。\n$Q_{\\mathrm{gen}} = 50 \\ \\mathrm{m^3/s}$，$f_{\\mathrm{gen}} = 0.018$，$K_{\\mathrm{gen}} = 2.0$。\n$Q_{\\mathrm{pump}} = 45 \\ \\mathrm{m^3/s}$，$f_{\\mathrm{pump}} = 0.020$，$K_{\\mathrm{pump}} = 2.5$。\n$\\eta_{\\mathrm{turb,h}} = 0.92$，$\\eta_{\\mathrm{e,gen}} = 0.98$，$\\eta_{\\mathrm{pump,h}} = 0.88$，$\\eta_{\\mathrm{motor}} = 0.96$。\n\n1.  压力钢管面积：$A = \\frac{\\pi (4 \\ \\mathrm{m})^2}{4} = 4\\pi \\ \\mathrm{m}^2$。\n\n2.  流速：\n    $v_{\\mathrm{gen}} = \\frac{50 \\ \\mathrm{m^3/s}}{4\\pi \\ \\mathrm{m}^2} = \\frac{12.5}{\\pi} \\ \\mathrm{m/s}$。\n    $v_{\\mathrm{pump}} = \\frac{45 \\ \\mathrm{m^3/s}}{4\\pi \\ \\mathrm{m}^2} = \\frac{11.25}{\\pi} \\ \\mathrm{m/s}$。\n\n3.  速度水头：\n    $\\frac{v_{\\mathrm{gen}}^2}{2g} = \\frac{(12.5/\\pi \\ \\mathrm{m/s})^2}{2(9.81 \\ \\mathrm{m/s^2})} \\approx 0.80690 \\ \\mathrm{m}$。\n    $\\frac{v_{\\mathrm{pump}}^2}{2g} = \\frac{(11.25/\\pi \\ \\mathrm{m/s})^2}{2(9.81 \\ \\mathrm{m/s^2})} \\approx 0.65359 \\ \\mathrm{m}$。\n\n4.  水头损失：\n    比值 $L/D = 800/4 = 200$。\n    $h_{L,\\mathrm{gen}} = (0.018 \\times 200 + 2.0) \\times (0.80690 \\ \\mathrm{m}) = (3.6 + 2.0) \\times 0.80690 \\ \\mathrm{m} = 5.6 \\times 0.80690 \\ \\mathrm{m} \\approx 4.51864 \\ \\mathrm{m}$。\n    $h_{L,\\mathrm{pump}} = (0.020 \\times 200 + 2.5) \\times (0.65359 \\ \\mathrm{m}) = (4.0 + 2.5) \\times 0.65359 \\ \\mathrm{m} = 6.5 \\times 0.65359 \\ \\mathrm{m} \\approx 4.24834 \\ \\mathrm{m}$。\n\n5.  往返效率：\n    设备效率的乘积为：\n    $\\eta_{\\mathrm{em}} = 0.92 \\times 0.98 \\times 0.88 \\times 0.96 = 0.76169216$。\n    水力循环效率为：\n    $\\eta_{\\mathrm{hyd}} = \\frac{H - h_{L,\\mathrm{gen}}}{H + h_{L,\\mathrm{pump}}} = \\frac{120 \\ \\mathrm{m} - 4.51864 \\ \\mathrm{m}}{120 \\ \\mathrm{m} + 4.24834 \\ \\mathrm{m}} = \\frac{115.48136}{124.24834} \\approx 0.929439$。\n    总往返效率为：\n    $\\mathrm{RTE} = \\eta_{\\mathrm{em}} \\times \\eta_{\\mathrm{hyd}} = 0.76169216 \\times 0.929439 \\approx 0.707915$。\n\n将结果四舍五入到四位有效数字，得到 $0.7079$。",
            "answer": "$$\\boxed{0.7079}$$"
        },
        {
            "introduction": "接下来，我们将深入到电化学储能装置的内部，以双电层电容器（EDLC）为例。这个练习要求你基于其电容特性，计算在考虑了实际工作约束（如温度降额和电压窗口）后的可用能量。通过这个练习，你将学会如何将理想化的储能公式（$W = \\frac{1}{2}CV^2$）与实际工程中的操作限制相结合，这是精确评估储能系统性能的关键一步。",
            "id": "4090324",
            "problem": "一个配电级快速频率响应装置使用电化学双电层电容器（EDLC）组作为其储能元件。该EDLC电容器组由$N_p$个并联的电容器串组成，每个串包含$N_s$个串联的电容器单元。每个单元被建模为一个线性电容器，其电容值取决于温度，但在工作电压范围内与电压无关。在恒定温度$T$下，将一个电容器从零电压充电到电压$V$所需的功由增量功$dW = v\\,dq$定义，其中$q$是电荷量，$v$是瞬时电压。对于一个在恒定温度$T$下的线性电容器，电荷与电压之间的本构关系为$q = C(T)\\,v$，其中$C(T)$是温度$T$下的电容值。\n\nEDLC单元在$25^\\circ\\mathrm{C}$时的标称电容为$C_{\\mathrm{cell},25}$，其温度系数为$\\alpha$，使得$C_{\\mathrm{cell}}(T) = C_{\\mathrm{cell},25}\\,[1 + \\alpha\\,(T - 25^\\circ\\mathrm{C})]$。在温度$T$下，允许的最大单元电压在超过阈值温度$T_0$时会根据$V_{\\mathrm{cell,max}}(T) = V_{\\mathrm{cell,nom}} - \\gamma\\,\\max(0,\\,T - T_0)$进行运行降额，其中$V_{\\mathrm{cell,nom}}$是在$T_0$或以下温度时的标称最大单元电压。与EDLC电容器组接口的电力电子变换器施加了一个直流母线电压窗口$[V_{\\min},\\,V_{\\max,\\mathrm{conv}}]$；EDLC电容器组被充电至变换器电压上限和温度降额后的电容器组最大电压中的较小值，并仅放电至变换器电压下限。\n\n参数和应用概况：\n- $N_s = 18$，$N_p = 2$。\n- $C_{\\mathrm{cell},25} = 3000$ F，$V_{\\mathrm{cell,nom}} = 2.7$ V，$T_0 = 35^\\circ\\mathrm{C}$，$\\alpha = 1.0 \\times 10^{-3}\\ \\mathrm{K}^{-1}$，$\\gamma = 1.0 \\times 10^{-2}$ V/K。\n- 环境温度$T = 50^\\circ\\mathrm{C}$。\n- 变换器电压窗口：$V_{\\min} = 30$ V，$V_{\\max,\\mathrm{conv}} = 48$ V。\n- 忽略放电过程中的电阻损耗和漏电，并假设在恒定温度$T$下，$C(T)$在整个电压窗口内是恒定的。\n\n任务：\n从定义式$dW = v\\,dq$和$q = C(T)\\,v$出发，推导在电压$V$和恒定温度$T$下，EDLC电容器组中储存的能量表达式。然后计算在$T = 50^\\circ\\mathrm{C}$时，从初始电容器组电压$V_i$（变换器电压上限与温度降额后的电容器组最大电压中的较小值）放电至最终电容器组电压$V_f = V_{\\min}$时可提取的可用能量。将最终数值答案四舍五入至四位有效数字，并以kJ为单位表示能量。最终答案必须是一个实数。",
            "solution": "第一个任务是推导EDLC电容器组中储存的能量表达式。我们从给出的基本定义开始：在电压为$v$时，向电容器增加增量电荷$dq$所需的增量功为$dW = v\\,dq$。对于一个在恒定温度$T$下的线性电容器，电荷$q$和电压$v$之间的关系是$q = C(T)\\,v$，其中$C(T)$是电容值。在恒定温度下，$C(T)$是常数，因此我们可以简单地将其表示为$C$。对电荷-电压关系进行微分，得到$dq = C\\,dv$。\n\n将电容器从电压0充电到最终电压$V$所储存的总能量$W$是增量功的积分：\n$$W = \\int_{v=0}^{v=V} dW = \\int_{v=0}^{v=V} v\\,dq$$\n代入$dq = C\\,dv$：\n$$W = \\int_{0}^{V} v\\,(C\\,dv) = C \\int_{0}^{V} v\\,dv = C \\left[ \\frac{1}{2}v^2 \\right]_{0}^{V} = \\frac{1}{2}CV^2$$\n这是一个线性电容器中储存能量的一般表达式。EDLC电容器组作为线性电容器的组合，其行为也像一个具有等效电容$C_{\\mathrm{bank}}$的单一线性电容器。因此，在电压$V_{\\mathrm{bank}}$下，电容器组中储存的能量为：\n$$W_{\\mathrm{bank}}(V_{\\mathrm{bank}}) = \\frac{1}{2} C_{\\mathrm{bank}}(T) V_{\\mathrm{bank}}^2$$\n\n接下来，我们根据其构成单元来确定整个EDLC电容器组的特性。该电容器组由$N_p$个并联的串组成，每个串有$N_s$个单元串联。\n对于$N_s$个串联的单元，总串电容为$C_{\\mathrm{string}} = \\frac{C_{\\mathrm{cell}}}{N_s}$，总串电压为各单元电压之和，$V_{\\mathrm{string}} = N_s V_{\\mathrm{cell}}$。\n对于$N_p$个并联的串，总电容器组电容为$C_{\\mathrm{bank}} = N_p C_{\\mathrm{string}} = \\frac{N_p}{N_s} C_{\\mathrm{cell}}$，电容器组电压与串电压相同，$V_{\\mathrm{bank}} = V_{\\mathrm{string}}$。\n因此，用单元参数表示的电容器组参数为：\n$$C_{\\mathrm{bank}}(T) = \\frac{N_p}{N_s} C_{\\mathrm{cell}}(T)$$\n$$V_{\\mathrm{bank,max}}(T) = N_s V_{\\mathrm{cell,max}}(T)$$\n\n给定工作温度$T = 50^\\circ\\mathrm{C}$。我们首先计算在此温度下单个单元的参数。温度依赖性给出的系数单位是$\\mathrm{K}^{-1}$和$\\mathrm{V/K}$，而温度单位是${}^\\circ\\mathrm{C}$。这是标准的，因为温差在开尔文和摄氏度下数值相同（即$\\Delta T_{\\mathrm{K}} = \\Delta T_{^\\circ\\mathrm{C}}$）。\n\n在$T = 50^\\circ\\mathrm{C}$时的单元电容为：\n$$C_{\\mathrm{cell}}(T) = C_{\\mathrm{cell},25}\\,[1 + \\alpha\\,(T - 25^\\circ\\mathrm{C})]$$\n$$C_{\\mathrm{cell}}(50^\\circ\\mathrm{C}) = 3000\\,\\text{F} \\times [1 + (1.0 \\times 10^{-3}\\,\\mathrm{K}^{-1}) \\times (50 - 25)\\,\\mathrm{K}] = 3000 \\times [1 + 0.025] = 3075\\,\\text{F}$$\n\n在$T = 50^\\circ\\mathrm{C}$时，由于$T > T_0$，允许的最大单元电压需要降额。\n$$V_{\\mathrm{cell,max}}(T) = V_{\\mathrm{cell,nom}} - \\gamma\\,\\max(0,\\,T - T_0)$$\n$$V_{\\mathrm{cell,max}}(50^\\circ\\mathrm{C}) = 2.7\\,\\text{V} - (1.0 \\times 10^{-2}\\,\\mathrm{V/K}) \\times \\max(0, 50 - 35)\\,\\mathrm{K} = 2.7 - (1.0 \\times 10^{-2}) \\times 15 = 2.7 - 0.15 = 2.55\\,\\text{V}$$\n\n现在，我们可以使用$N_s = 18$和$N_p = 2$计算电容器组级别的参数。\n在$T = 50^\\circ\\mathrm{C}$时的电容器组电容为：\n$$C_{\\mathrm{bank}}(50^\\circ\\mathrm{C}) = \\frac{N_p}{N_s} C_{\\mathrm{cell}}(50^\\circ\\mathrm{C}) = \\frac{2}{18} \\times 3075\\,\\text{F} = \\frac{3075}{9}\\,\\text{F} \\approx 341.67\\,\\text{F}$$\n在$T = 50^\\circ\\mathrm{C}$时允许的最大电容器组电压为：\n$$V_{\\mathrm{bank,max}}(50^\\circ\\mathrm{C}) = N_s V_{\\mathrm{cell,max}}(50^\\circ\\mathrm{C}) = 18 \\times 2.55\\,\\text{V} = 45.9\\,\\text{V}$$\n\n可用能量是通过在特定电压范围内对电容器组放电来提取的。初始电压$V_i$是完全充电状态下的电压，它是温度降额后的电容器组最大电压和变换器电压上限$V_{\\max,\\mathrm{conv}} = 48\\,\\text{V}$中的较小值。\n$$V_i = \\min(V_{\\mathrm{bank,max}}(50^\\circ\\mathrm{C}), V_{\\max,\\mathrm{conv}}) = \\min(45.9\\,\\text{V}, 48\\,\\text{V}) = 45.9\\,\\text{V}$$\n最终电压$V_f$是变换器的电压下限，$V_{\\min} = 30\\,\\text{V}$。\n$$V_f = V_{\\min} = 30\\,\\text{V}$$\n\n可用能量$\\Delta W$是在$V_i$时储存的能量与在$V_f$时储存的能量之差。\n$$\\Delta W = W_{\\mathrm{bank}}(V_i) - W_{\\mathrm{bank}}(V_f) = \\frac{1}{2}C_{\\mathrm{bank}}(50^\\circ\\mathrm{C})V_i^2 - \\frac{1}{2}C_{\\mathrm{bank}}(50^\\circ\\mathrm{C})V_f^2$$\n$$\\Delta W = \\frac{1}{2}C_{\\mathrm{bank}}(50^\\circ\\mathrm{C})(V_i^2 - V_f^2)$$\n代入计算出的值：\n$$\\Delta W = \\frac{1}{2} \\left(\\frac{3075}{9}\\,\\text{F}\\right) \\left( (45.9\\,\\text{V})^2 - (30\\,\\text{V})^2 \\right)$$\n$$\\Delta W = \\frac{3075}{18} (2106.81 - 900)\\,\\text{J}$$\n$$\\Delta W = \\frac{3075}{18} (1206.81)\\,\\text{J} \\approx 206200.708\\,\\text{J}$$\n\n问题要求答案以千焦（kJ）为单位，并四舍五入到四位有效数字。\n$$\\Delta W \\approx 206.200708\\,\\text{kJ}$$\n四舍五入到四位有效数字，我们得到：\n$$\\Delta W = 206.2\\,\\text{kJ}$$",
            "answer": "$$\\boxed{206.2}$$"
        },
        {
            "introduction": "掌握了单个设备的运行模型后，下一个核心挑战是预测其长期性能和寿命。本练习将引导你使用雨流计数法和基于应力的疲劳模型来评估锂离子电池在特定循环工况下的循环寿命。这项实践不仅连接了电化学行为（荷电状态变化）与机械应力退化机理，还介绍了将复杂、非规则的负载历史转化为可量化损伤的先进分析技术。",
            "id": "4090343",
            "problem": "给定代表电池荷电状态 (SoC) 循环曲线的离散时间序列，以及具有物理意义的参数，这些参数可将 SoC 的变化映射到电极应力。您的任务是计算每个曲线的累积外部能量吞吐量，并通过对诱导的应力信号应用雨流计数法和 Wöhler 型疲劳模型来估算循环寿命。解决方案必须以一个完整的、可运行的程序实现。\n\n假设以下基于物理的基本定义和定律：\n\n- 能量守恒：在一个时间步长内，电池中存储的能量变化与荷电状态的变化成正比。如果额定能量容量为 $C_{\\mathrm{Wh}}$（单位：瓦时，Wh），SoC 变化量为 $\\Delta s$，则内部能量变化为 $C_{\\mathrm{Wh}} \\,\\Delta s$（单位：Wh）。\n\n- 外部能量吞吐量考虑了充电和放电的转换效率。对于 SoC 变化为 $\\Delta s_k$ 的时间步长 $k$，充电（$\\Delta s_k > 0$）需要外部能量 $C_{\\mathrm{Wh}} \\,\\Delta s_k / \\eta_c$，而放电（$\\Delta s_k  0$）产生外部能量 $C_{\\mathrm{Wh}} \\,|\\Delta s_k| \\,\\eta_d$。这里，$\\eta_c$ 和 $\\eta_d$ 分别是充电和放电效率，均为 $(0,1]$ 区间内的无量纲数。\n\n- 应力-循环次数 (S–N) Wöhler 型疲劳模型：如果循环 $i$ 的应力幅为 $\\Delta \\sigma_i$，则在该振幅下的失效循环次数为 $N_i = N_{\\mathrm{ref}}\\left(\\dfrac{\\Delta \\sigma_{\\mathrm{ref}}}{\\Delta \\sigma_i}\\right)^m$，其中 $N_{\\mathrm{ref}}$ 是在参考应力幅 $\\Delta \\sigma_{\\mathrm{ref}}$ 下的失效循环次数，而 $m$ 是 Basquin 指数。每个循环的损伤为 $d_i = \\dfrac{1}{N_i} = \\dfrac{1}{N_{\\mathrm{ref}}}\\left(\\dfrac{\\Delta \\sigma_i}{\\Delta \\sigma_{\\mathrm{ref}}}\\right)^m$。\n\n- Miner 线性损伤累积法则：一个曲线上的总损伤为 $D_{\\mathrm{profile}} = \\sum_i \\alpha_i \\, d_i$，其中 $\\alpha_i$ 是循环计数权重（对于全循环 $\\alpha_i = 1$，对于半循环 $\\alpha_i = \\tfrac{1}{2}$）。给定曲线重复使用至失效的预测重复次数（即此重复使用下的循环寿命）为 $R^\\star = \\dfrac{1}{D_{\\mathrm{profile}}}$。\n\n- SoC 到应力的映射：使用线性映射将 SoC 映射到电极应力信号 $\\sigma(t)$，即 $\\sigma(t) = k_\\sigma \\, s(t)$，其中 $k_\\sigma$ 的单位是 $\\mathrm{MPa}$/单位SoC，而 $s(t)$ 是无量纲的。这确保了所计数循环的应力幅为 $\\Delta \\sigma = k_\\sigma \\, \\Delta s$。\n\n必须对从 SoC 样本 $\\{s_k\\}$ 获得的离散应力信号 $\\{\\sigma_k\\}$ 执行雨流计数法。使用一种算法，该算法：\n- 从 $\\{\\sigma_k\\}$ 中提取转折点（局部极值）以形成一系列反向点。\n- 迭代应用雨流计数规则以识别全循环和半循环及其振幅 $\\Delta \\sigma_i$。\n- 生成一组包含振幅和权重 $\\alpha_i \\in \\{1,\\tfrac{1}{2}\\}$ 的循环。\n\n对于每个测试用例，计算：\n- 所提供曲线上累积的外部能量吞吐量，单位为 $\\mathrm{Wh}$（外部充电和放电能量大小之和）。\n- 曲线上的总损伤 $D_{\\mathrm{profile}}$。\n- 预测的失效前重复次数 $R^\\star = \\dfrac{1}{D_{\\mathrm{profile}}}$，无量纲。如果 $D_{\\mathrm{profile}} = 0$，则定义 $R^\\star = +\\infty$。\n- 失效前能量吞吐量 $E_{\\mathrm{TTF}} = R^\\star \\times E_{\\mathrm{throughput}}$，以 $\\mathrm{Wh}$ 表示。如果 $R^\\star = +\\infty$，则定义 $E_{\\mathrm{TTF}} = +\\infty$。\n\n所有能量值以 $\\mathrm{Wh}$ 表示，无量纲的量不带单位。不涉及角度，也不需要角度单位。\n\n使用以下参数集测试套件。每个测试用例由一个元组 $(\\{s_k\\}, \\Delta t, C_{\\mathrm{Wh}}, \\eta_c, \\eta_d, k_\\sigma, \\Delta \\sigma_{\\mathrm{ref}}, N_{\\mathrm{ref}}, m)$ 定义：\n- 测试用例 1 (正常路径，混合振幅)：\n  - $\\{s_k\\} = [\\,0.50,\\,0.65,\\,0.40,\\,0.75,\\,0.35,\\,0.80,\\,0.45,\\,0.60\\,]$\n  - $\\Delta t = 600\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n- 测试用例 2 (边界情况，单调增加仅导致半循环)：\n  - $\\{s_k\\} = [\\,0.50,\\,0.55,\\,0.60,\\,0.65,\\,0.70\\,]$\n  - $\\Delta t = 900\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n- 测试用例 3 (边缘情况，混合半循环和全循环)：\n  - $\\{s_k\\} = [\\,0.20,\\,0.60,\\,0.30,\\,0.55,\\,0.25\\,]$\n  - $\\Delta t = 300\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n- 测试用例 4 (高应力摆动)：\n  - $\\{s_k\\} = [\\,0.10,\\,0.90,\\,0.20,\\,0.85,\\,0.30,\\,0.80\\,]$\n  - $\\Delta t = 1200\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例的结果本身就是一个形如 $[E_{\\mathrm{throughput}}, D_{\\mathrm{profile}}, R^\\star, E_{\\mathrm{TTF}}]$ 的列表。例如，最终输出应类似于 $[[x_1,y_1,z_1,w_1],[x_2,y_2,z_2,w_2],[x_3,y_3,z_3,w_3],[x_4,y_4,z_4,w_4]]$，其中的占位符被数值替换。",
            "solution": "此任务要求将基础的电化学能量核算与机械疲劳分析相结合。推导从第一性原理出发。\n\n首先从电池的能量守恒原理开始。设额定能量容量为 $C_{\\mathrm{Wh}}$，单位为瓦时。荷电状态序列为 $\\{s_k\\}$，无量纲且界于 $[0,1]$。在离散步骤 $k$ 上的内部能量变化为 $\\Delta E_{\\mathrm{int},k} = C_{\\mathrm{Wh}} \\,\\Delta s_k$，其中 $\\Delta s_k = s_{k+1} - s_k$。外部能量核算包含效率。对于充电步骤（$\\Delta s_k > 0$），所需的外部能量输入为 $E_{\\mathrm{ext},k}^{\\mathrm{in}} = \\dfrac{C_{\\mathrm{Wh}} \\,\\Delta s_k}{\\eta_c}$。对于放电步骤（$\\Delta s_k  0$），外部能量输出为 $E_{\\mathrm{ext},k}^{\\mathrm{out}} = C_{\\mathrm{Wh}} \\,|\\Delta s_k| \\,\\eta_d$。累积外部能量吞吐量定义为外部能量流动的绝对值之和，即\n$$\nE_{\\mathrm{throughput}} = \\sum_{k=0}^{K-2}\n\\begin{cases}\n\\frac{C_{\\mathrm{Wh}} \\Delta s_k}{\\eta_c}  \\text{if } \\Delta s_k > 0 \\\\\nC_{\\mathrm{Wh}} (-\\Delta s_k)\\eta_d  \\text{if } \\Delta s_k  0 \\\\\n0  \\text{if } \\Delta s_k = 0\n\\end{cases}\n$$\n此量以 $\\mathrm{Wh}$ 表示。\n\n接下来，使用线性模型 $\\sigma_k = k_\\sigma \\, s_k$ 将 SoC 信号映射到电极应力，其中 $k_\\sigma$ 的单位是 $\\mathrm{MPa}$/单位SoC。此映射反映了锂化状态与机械应力之间的比例关系，这与活性材料中的小应变近似一致。然后使用雨流计数法分析应力序列 $\\{\\sigma_k\\}$ 以提取循环振幅。雨流算法对转折点（反向点）序列进行操作，并对相邻范围应用基于堆栈的比较来识别闭合循环。对于三个连续的反向点 $\\sigma_{a}, \\sigma_{b}, \\sigma_{c}$，定义范围 $R_1 = |\\sigma_b - \\sigma_a|$ 和 $R_2 = |\\sigma_c - \\sigma_b|$。如果 $R_1 \\le R_2$，则计数一个振幅为 $\\Delta \\sigma = R_1$ 的循环；然后算法移除中间点并继续。遍历结束后，堆栈上残留的相邻对代表半循环。每个计数的元素都与一个权重相关联，全循环为 $\\alpha_i = 1$，半循环为 $\\alpha_i = \\tfrac{1}{2}$。\n\n利用循环振幅集合 $\\{\\Delta \\sigma_i\\}$ 和权重 $\\{\\alpha_i\\}$，应用 Wöhler 型疲劳模型。在振幅 $\\Delta \\sigma_i$ 下的失效循环次数为\n$$\nN_i = N_{\\mathrm{ref}}\\left(\\frac{\\Delta \\sigma_{\\mathrm{ref}}}{\\Delta \\sigma_i}\\right)^m,\n$$\n其中 $N_{\\mathrm{ref}}$ 是在参考应力幅 $\\Delta \\sigma_{\\mathrm{ref}}$ 下的失效循环次数，而 $m$ 是 Basquin 指数。循环 $i$ 的损伤为\n$$\nd_i = \\frac{1}{N_i} = \\frac{1}{N_{\\mathrm{ref}}}\\left(\\frac{\\Delta \\sigma_i}{\\Delta \\sigma_{\\mathrm{ref}}}\\right)^m.\n$$\n根据 Miner 法则，曲线上的总损伤为\n$$\nD_{\\mathrm{profile}} = \\sum_i \\alpha_i \\, d_i = \\sum_i \\alpha_i \\, \\frac{1}{N_{\\mathrm{ref}}}\\left(\\frac{\\Delta \\sigma_i}{\\Delta \\sigma_{\\mathrm{ref}}}\\right)^m.\n$$\n如果没有检测到循环或所有振幅均为零，则 $D_{\\mathrm{profile}} = 0$。预测的失效前重复次数为\n$$\nR^\\star = \\begin{cases}\n\\frac{1}{D_{\\mathrm{profile}}}  \\text{if } D_{\\mathrm{profile}} > 0 \\\\\n+\\infty  \\text{if } D_{\\mathrm{profile}} = 0\n\\end{cases}\n$$\n失效前能量吞吐量是曲线的累积吞吐量乘以重复次数：\n$$\nE_{\\mathrm{TTF}} = R^\\star \\times E_{\\mathrm{throughput}}.\n$$\n如果 $R^\\star = +\\infty$，则 $E_{\\mathrm{TTF}} = +\\infty$。\n\n算法设计：\n\n- 使用上述分段求和，直接从 $\\{s_k\\}$、$C_{\\mathrm{Wh}}$、$\\eta_c$ 和 $\\eta_d$ 计算 $E_{\\mathrm{throughput}}$。\n\n- 生成应力序列 $\\sigma_k = k_\\sigma \\, s_k$。\n\n- 提取反向点：包括第一个和最后一个点，以及任何满足 $(\\sigma_i - \\sigma_{i-1})(\\sigma_{i+1} - \\sigma_i) \\le 0$ 的中间点 $\\sigma_i$，当相邻值不同时，不等式为严格不等。移除连续的重复点以避免零长度范围。\n\n- 应用基于堆栈的雨流算法：\n  - 初始化一个空堆栈。\n  - 对于每个反向点值，将其推入堆栈，当堆栈中至少有三个点时，比较最后两个范围。如果前一个范围小于或等于后一个范围，则计数一个振幅等于前一个范围的全循环，并从堆栈中移除前两个点；否则停止内循环。\n  - 处理完所有反向点后，对堆栈上每个剩余的相邻对计数半循环，其振幅等于该对的范围。\n\n- 通过 Wöhler 模型计算每个循环振幅的 $D_{\\mathrm{profile}}$，并应用 $\\alpha_i$ 权重。\n\n- 计算 $R^\\star$ 和 $E_{\\mathrm{TTF}}$。\n\n此方法在吞吐量计算中遵循能量守恒，并使用经过充分测试的疲劳模型（应力-循环次数 Wöhler 关系）与雨流计数法相结合，雨流计数法是一种将变幅载荷历史转换为一组破坏性循环的标准方法。该程序将此过程应用于四个测试用例，并输出所要求的列表的列表，其中能量值以 Wh 为单位，损伤和重复次数为无量纲。",
            "answer": "```python\nimport numpy as np\n\ndef extract_reversals(series: np.ndarray) - np.ndarray:\n    \"\"\"\n    Extract turning points (reversals) from a numeric sequence.\n    Includes first and last points. Removes consecutive duplicates.\n    \"\"\"\n    if len(series) == 0:\n        return np.array([])\n    # Remove consecutive duplicates\n    s = [series[0]]\n    for x in series[1:]:\n        if x != s[-1]:\n            s.append(x)\n    s = np.array(s, dtype=float)\n    if len(s) == 1:\n        return s.copy()\n\n    rev = [s[0]]\n    for i in range(1, len(s) - 1):\n        prev = s[i - 1]\n        curr = s[i]\n        nxt = s[i + 1]\n        # reversal if direction changes or plateau transitions\n        if (curr - prev) * (nxt - curr) = 0:\n            if not (curr == prev and curr == nxt):\n                rev.append(curr)\n    rev.append(s[-1])\n    # Remove consecutive duplicates in reversals\n    clean = [rev[0]]\n    for x in rev[1:]:\n        if x != clean[-1]:\n            clean.append(x)\n    return np.array(clean, dtype=float)\n\ndef rainflow_ranges(series: np.ndarray):\n    \"\"\"\n    Perform rainflow counting on a sequence of stress values.\n    Returns a list of tuples (amplitude, weight) where weight is 1.0 for full cycle\n    and 0.5 for half cycle.\n    \"\"\"\n    rev = extract_reversals(series)\n    cycles = []\n    stack = []\n    for x in rev:\n        stack.append(x)\n        # While at least 3 reversals, compare ranges\n        while len(stack) = 3:\n            s0 = stack[-3]\n            s1 = stack[-2]\n            s2 = stack[-1]\n            r1 = abs(s1 - s0)\n            r2 = abs(s2 - s1)\n            if r1 = r2:\n                # Count a full cycle of amplitude r1\n                if r1  0.0:\n                    cycles.append((r1, 1.0))\n                # Remove middle two: first remove s1 (index -2), then s0 (now at index -2)\n                stack.pop(-2)\n                stack.pop(-2)\n            else:\n                break\n    # Remaining adjacent pairs are half cycles\n    for i in range(len(stack) - 1):\n        r = abs(stack[i + 1] - stack[i])\n        if r  0.0:\n            cycles.append((r, 0.5))\n    return cycles\n\ndef compute_throughput_wh(soc: np.ndarray, C_wh: float, eta_c: float, eta_d: float) - float:\n    \"\"\"\n    Compute cumulative external energy throughput in Wh from an SoC sequence.\n    Charging steps: external energy in = C_wh * delta_soc / eta_c\n    Discharging steps: external energy out = C_wh * (-delta_soc) * eta_d\n    \"\"\"\n    throughput = 0.0\n    for i in range(len(soc) - 1):\n        ds = soc[i + 1] - soc[i]\n        if ds  0:\n            throughput += C_wh * ds / eta_c\n        elif ds  0:\n            throughput += C_wh * (-ds) * eta_d\n        # ds == 0 contributes nothing\n    return throughput\n\ndef fatigue_damage_profile(soc: np.ndarray, k_sigma: float, sigma_ref: float,\n                           N_ref: float, m: float) - float:\n    \"\"\"\n    Map SoC to stress, apply rainflow counting, and compute total damage per profile.\n    Damage per cycle: d_i = (1/N_ref) * (Delta_sigma_i / sigma_ref)^m\n    \"\"\"\n    sigma = k_sigma * soc\n    cycles = rainflow_ranges(sigma)\n    D = 0.0\n    for amp, weight in cycles:\n        if amp = 0.0:\n            continue\n        # Damage contribution\n        D += weight * (amp / sigma_ref) ** m / N_ref\n    return D\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (soc_list, dt_seconds, C_wh, eta_c, eta_d, k_sigma, sigma_ref, N_ref, m)\n    test_cases = [\n        ([0.50, 0.65, 0.40, 0.75, 0.35, 0.80, 0.45, 0.60], 600, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n        ([0.50, 0.55, 0.60, 0.65, 0.70], 900, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n        ([0.20, 0.60, 0.30, 0.55, 0.25], 300, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n        ([0.10, 0.90, 0.20, 0.85, 0.30, 0.80], 1200, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n    ]\n\n    results = []\n    for case in test_cases:\n        soc_list, dt, C_wh, eta_c, eta_d, k_sigma, sigma_ref, N_ref, m = case\n        soc = np.array(soc_list, dtype=float)\n\n        # Energy throughput in Wh\n        E_throughput = compute_throughput_wh(soc, C_wh, eta_c, eta_d)\n\n        # Damage per profile\n        D_profile = fatigue_damage_profile(soc, k_sigma, sigma_ref, N_ref, m)\n\n        # Repeats to failure\n        if D_profile  0.0:\n            R_star = 1.0 / D_profile\n            E_ttf = R_star * E_throughput\n        else:\n            R_star = float('inf')\n            E_ttf = float('inf')\n\n        results.append([E_throughput, D_profile, R_star, E_ttf])\n\n    # Final print statement in the exact required format.\n    # Produce a single line with the list-of-lists.\n    print(f\"[{','.join([str(r) for r in results])}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}