{
    "hands_on_practices": [
        {
            "introduction": "在深入探讨跨期协调问题之前，我们必须首先掌握单个时期内多台发电机组经济调度的基本原理。本练习 () 旨在通过一个具体的场景，训练您如何在满足负荷和备用等实际约束的同时，以最低成本调度火电机组。这是理解更复杂的水火协调问题所必需的基础技能。",
            "id": "4095224",
            "problem": "考虑时段 $t$ 的一个单周期水火电协调问题，其中固定的水电注入功率 $P^{H}_{t}$ 部分满足了负荷需求 $D_{t}$。剩余的负荷必须由索引为 $i \\in \\{1,2\\}$ 的两台火电机组提供，每台机组都具有严格凸的二次生产成本函数 $C_{i}(P_{i,t}) = a_{i} P_{i,t}^{2} + b_{i} P_{i,t} + c_{i}$ 和铭牌容量 $P_{i,t}^{\\max}$。这些火电机组还必须共同承担旋转备用需求 $R_{t}$，该需求根据固定的参与因子 $w_{i}$ 进行分配，且 $w_{1} + w_{2} = 1$。旋转备用 (SR) 被建模为必须从计划发电量中预留的向上调整裕度，因此每台机组的调度约束为 $P_{i,t} \\leq P_{i,t}^{\\max} - r_{i,t}$，其中 $r_{i,t} = w_{i} R_{t}$。在此期间没有爬坡约束，且最小发电限制为零。\n\n系统必须满足有功功率平衡\n$$\nP^{H}_{t} + P_{1,t} + P_{2,t} = D_{t}.\n$$\n\n目标是在满足上述约束的条件下，最小化总火电生产成本。请使用凸优化和调度的第一性原理（不假设或引用任何快捷公式）来推导最优调度方案，然后计算火电机组 1 的最优发电量，记为 $P_{1,t}^{\\star}$。\n\n时段 $t$ 的数据：\n- 负荷 $D_{t} = 800~\\text{MW}$。\n- 水电注入功率 $P^{H}_{t} = 300~\\text{MW}$。\n- 旋转备用需求 $R_{t} = 100~\\text{MW}$，参与因子为 $w_{1} = 0.6$ 和 $w_{2} = 0.4$，因此 $r_{1,t} = 60~\\text{MW}$ 和 $r_{2,t} = 40~\\text{MW}$。\n- 火电机组 1：$C_{1}(P_{1,t}) = 0.020\\,P_{1,t}^{2} + 15.0\\,P_{1,t} + 0$, $P_{1,t}^{\\max} = 400~\\text{MW}$, $P_{1,t}^{\\min} = 0~\\text{MW}$。\n- 火电机组 2：$C_{2}(P_{2,t}) = 0.015\\,P_{2,t}^{2} + 16.0\\,P_{2,t} + 0$, $P_{2,t}^{\\max} = 300~\\text{MW}$, $P_{2,t}^{\\min} = 0~\\text{MW}$。\n\n在这些条件下计算 $P_{1,t}^{\\star}$。以 $\\text{MW}$ 为单位表示最终答案，并四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- **目标**：最小化总火电生产成本，$C_{1}(P_{1,t}) + C_{2}(P_{2,t})$。\n- **成本函数**：\n  - 机组 1：$C_{1}(P_{1,t}) = 0.020\\,P_{1,t}^{2} + 15.0\\,P_{1,t} + 0$。\n  - 机组 2：$C_{2}(P_{2,t}) = 0.015\\,P_{2,t}^{2} + 16.0\\,P_{2,t} + 0$。\n- **功率平衡约束**：$P^{H}_{t} + P_{1,t} + P_{2,t} = D_{t}$。\n- **发电限制**：\n  - 机组 1：$P_{1,t}^{\\min} = 0~\\text{MW}$, $P_{1,t}^{\\max} = 400~\\text{MW}$。\n  - 机组 2：$P_{2,t}^{\\min} = 0~\\text{MW}$, $P_{2,t}^{\\max} = 300~\\text{MW}$。\n- **旋转备用 (SR) 约束**：$P_{i,t} \\leq P_{i,t}^{\\max} - r_{i,t}$，其中 $r_{i,t} = w_{i} R_{t}$。\n- **时段 $t$ 的系统数据**：\n  - 负荷：$D_{t} = 800~\\text{MW}$。\n  - 水电注入功率：$P^{H}_{t} = 300~\\text{MW}$。\n  - SR 需求：$R_{t} = 100~\\text{MW}$。\n  - SR 参与因子：$w_{1} = 0.6$, $w_{2} = 0.4$。\n- **推导出的 SR 分配**：\n  - 机组 1：$r_{1,t} = w_{1} R_{t} = 0.6 \\times 100~\\text{MW} = 60~\\text{MW}$。\n  - 机组 2：$r_{2,t} = w_{2} R_{t} = 0.4 \\times 100~\\text{MW} = 40~\\text{MW}$。\n- **任务**：计算火电机组 1 的最优发电量 $P_{1,t}^{\\star}$，并四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：这是一个电力系统工程中的经典经济调度问题，属于能源系统建模的一个子领域。使用严格凸的二次成本函数、功率平衡和发电限制（包括旋转备用限制）是标准且科学合理的。\n- **良定性**：目标函数是两个严格凸二次函数的和，因此其本身也是严格凸的。约束都是线性的，定义了一个凸且非空的可行集。在一个非空、闭合的凸集上最小化一个严格凸函数，保证了唯一解的存在。\n- **客观性**：问题以精确的、量化的术语陈述。所有数据和约束都是客观的。\n- **完整性和一致性**：提供了构建和解决该优化问题所需的所有必要数据。已知条件内部是一致的（例如，$w_1 + w_2 = 0.6 + 0.4 = 1.0$）。\n- **现实性**：负荷、发电容量和成本函数系数的值在一个小型电力系统模型的现实范围内。\n\n### 步骤 3：结论和行动\n该问题具有科学依据、良定、完整且一致。这是一个有效的优化问题。我将继续进行求解。\n\n### 求解推导\n问题是在一组约束条件下，最小化总火电成本 $C_{\\text{total}}(P_{1,t}, P_{2,t}) = C_{1}(P_{1,t}) + C_{2}(P_{2,t})$。\n\n首先，我们确定必须由两台火电机组满足的净负荷。\n功率平衡方程为 $P^{H}_{t} + P_{1,t} + P_{2,t} = D_{t}$。\n代入给定值：$300 + P_{1,t} + P_{2,t} = 800$。\n这可以简化为仅包含火电机组的功率平衡约束：\n$$P_{1,t} + P_{2,t} = 800 - 300 = 500$$\n设 $P_{D} = 500~\\text{MW}$ 为净火电负荷。\n\n接下来，我们确定每台机组的有效发电限制，其中考虑了旋转备用需求。用于调度的有效最大发电容量 $P_{i,t}^{\\text{eff\\_max}}$ 由 $P_{i,t}^{\\text{eff\\_max}} = P_{i,t}^{\\max} - r_{i,t}$ 给出。\n对于机组 1：\n$P_{1,t}^{\\text{eff\\_max}} = P_{1,t}^{\\max} - r_{1,t} = 400~\\text{MW} - 60~\\text{MW} = 340~\\text{MW}$。\n机组 1 的运行范围是 $0 \\leq P_{1,t} \\leq 340$。\n\n对于机组 2：\n$P_{2,t}^{\\text{eff\\_max}} = P_{2,t}^{\\max} - r_{2,t} = 300~\\text{MW} - 40~\\text{MW} = 260~\\text{MW}$。\n机组 2 的运行范围是 $0 \\leq P_{2,t} \\leq 260$。\n\n完整的优化问题是：\n$$\n\\text{最小化 } \\quad C(P_{1,t}, P_{2,t}) = (0.020\\,P_{1,t}^{2} + 15.0\\,P_{1,t}) + (0.015\\,P_{2,t}^{2} + 16.0\\,P_{2,t})\n$$\n$$\n\\text{约束条件:} \\quad\n\\begin{cases}\nP_{1,t} + P_{2,t} = 500 \\\\\n0 \\leq P_{1,t} \\leq 340 \\\\\n0 \\leq P_{2,t} \\leq 260\n\\end{cases}\n$$\n\n这是一个凸优化问题。根据第一性原理，我们可以使用 Lagrange 乘子法。对于等式约束问题，Lagrangian 函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(P_{1,t}, P_{2,t}, \\lambda) = C_{1}(P_{1,t}) + C_{2}(P_{2,t}) - \\lambda(P_{1,t} + P_{2,t} - P_{D})\n$$\n通过将 $\\mathcal{L}$ 对决策变量的偏导数设为零，可以得到最优性的一阶必要条件：\n$$\n\\frac{\\partial\\mathcal{L}}{\\partial P_{1,t}} = \\frac{dC_{1}}{dP_{1,t}} - \\lambda = 0 \\implies \\frac{dC_{1}}{dP_{1,t}} = \\lambda\n$$\n$$\n\\frac{\\partial\\mathcal{L}}{\\partial P_{2,t}} = \\frac{dC_{2}}{dP_{2,t}} - \\lambda = 0 \\implies \\frac{dC_{2}}{dP_{2,t}} = \\lambda\n$$\n这导出了无约束经济调度的等增量成本原理：\n$$\n\\frac{dC_{1}}{dP_{1,t}} = \\frac{dC_{2}}{dP_{2,t}}\n$$\n每台机组 $i$ 的增量成本（或边际成本）函数为 $IC_{i}(P_{i,t}) = \\frac{dC_{i}}{dP_{i,t}} = 2a_{i}P_{i,t} + b_{i}$。\n对于机组 1：$IC_{1}(P_{1,t}) = 2(0.020)P_{1,t} + 15.0 = 0.040\\,P_{1,t} + 15.0$。\n对于机组 2：$IC_{2}(P_{2,t}) = 2(0.015)P_{2,t} + 16.0 = 0.030\\,P_{2,t} + 16.0$。\n\n令增量成本相等，我们得到：\n$0.040\\,P_{1,t} + 15.0 = 0.030\\,P_{2,t} + 16.0$。\n\n现在我们得到一个关于 $P_{1,t}$ 和 $P_{2,t}$ 的二元一次方程组：\n1) $0.040\\,P_{1,t} - 0.030\\,P_{2,t} = 1.0$\n2) $P_{1,t} + P_{2,t} = 500$\n\n从方程 (2)，我们将 $P_{2,t}$ 表示为 $P_{1,t}$ 的函数：$P_{2,t} = 500 - P_{1,t}$。\n将此代入方程 (1)：\n$0.040\\,P_{1,t} - 0.030(500 - P_{1,t}) = 1.0$\n$0.040\\,P_{1,t} - 15 + 0.030\\,P_{1,t} = 1.0$\n$0.070\\,P_{1,t} = 16.0$\n$P_{1,t} = \\frac{16.0}{0.070} = \\frac{1600}{7} \\approx 228.5714~\\text{MW}$。\n\n现在我们求出相应的 $P_{2,t}$：\n$P_{2,t} = 500 - P_{1,t} = 500 - \\frac{1600}{7} = \\frac{3500 - 1600}{7} = \\frac{1900}{7} \\approx 271.4286~\\text{MW}$。\n\n这个解 ($P_{1,t} \\approx 228.57$, $P_{2,t} \\approx 271.43$) 是在没有发电限制情况下的最优调度。现在我们必须通过与有效限制进行比较来检查该解是否可行。\n对于机组 1：$0 \\leq 228.57 \\leq 340$。机组 1 的调度在其限制范围内。\n对于机组 2：$0 \\leq 271.43 \\leq 260$。机组 2 的调度违反了其上限 ($271.43 > 260$)。\n\n由于无约束最优解是不可行的，真实最优解必须位于可行域的边界上。违约情况表明，在大部分调度范围内，机组 2 的增量成本低于机组 1，理想情况下我们希望更多地使用它，但受其容量限制而无法这样做。因此，在最优解处，约束 $P_{2,t} \\leq 260$ 必须是活动的（起作用的）。\n\n我们将机组 2 的发电量设为其上限：\n$P_{2,t}^{\\star} = 260~\\text{MW}$。\n\n机组 1 的发电量则由功率平衡方程确定：\n$P_{1,t}^{\\star} = P_{D} - P_{2,t}^{\\star} = 500 - 260 = 240~\\text{MW}$。\n\n我们必须验证这个新的调度点 $(P_{1,t}^{\\star}, P_{2,t}^{\\star}) = (240, 260)$ 是可行的。\n- 功率平衡：$240 + 260 = 500$。满足。\n- 机组 1 限制：$0 \\leq 240 \\leq 340$。满足。\n- 机组 2 限制：$0 \\leq 260 \\leq 260$。满足（在边界上）。\n\n该解是可行的。根据最优性的 Karush-Kuhn-Tucker (KKT) 条件，当一个机组处于其发电上限时，其增量成本必须小于或等于系统的边际成本 ($\\lambda$)。系统边际成本由未达到限制的机组设定。在这种情况下，$\\lambda$ 由机组 1 设定。\n$\\lambda = IC_{1}(P_{1,t}^{\\star}) = 0.040(240) + 15.0 = 9.6 + 15.0 = 24.6$。\n机组 2 的增量成本为：\n$IC_{2}(P_{2,t}^{\\star}) = 0.030(260) + 16.0 = 7.8 + 16.0 = 23.8$。\n按要求，$IC_{2}(P_{2,t}^{\\star})  \\lambda$ ($23.8  24.6$)，这证实了该调度的最优性。如果机组 2 能够增加其出力，从经济上看这样做是有利的，但它受到了其有效容量的限制。\n\n火电机组 1 的最优发电量为 $P_{1,t}^{\\star} = 240~\\text{MW}$。\n问题要求答案四舍五入到四位有效数字。值 $240$ 可以被解释为有两位或三位有效数字。为了用四位有效数字表示它，我们写作 $240.0$。\n\n火电机组 1 的最优发电量为 $P_{1,t}^{\\star} = 240.0~\\text{MW}$。",
            "answer": "$$\\boxed{240.0}$$"
        },
        {
            "introduction": "在掌握了静态调度之后，本练习将引导您进入水火协调的核心：跨期权衡。水是一种有限的资源，既可以当前使用，也可以储存起来以备将来。本练习 () 要求您通过在两个时期内平衡用水，以最小化总火电成本，从而量化被储存水的价值——即“水的价值”。这个概念是所有多周期水电调度问题的基石。",
            "id": "4095243",
            "problem": "考虑一个包含一个水电机组和一个火电机组的能源系统中的两周期水火电协调 (Hydro-Thermal Coordination, HTC) 问题。周期由 $t \\in \\{1,2\\}$ 索引。目标是在满足各周期需求的同时，最小化火电发电成本，以调度水电和火电的发电量。水力发电是无成本的，但受到可用水资源、转换效率和水轮机容量限制。\n\n在周期 $t$ 中，火电机组的发电量为 $g_t$，其成本函数为凸函数 $C_t(g_t) = a_t g_t^2 + b_t g_t$，其中 $a_t  0$ 且 $b_t \\geq 0$。在周期 $t$ 中，水电机组的发电量为 $h_t$，使用的水量为 $v_t$，它们之间的关系为 $h_t = k v_t$，其中 $k \\in (0,1]$ 是一个固定的转换效率。每个周期的需求平衡要求 $g_t + h_t = D_t$，其中给定的 $D_t  0$。每个周期的水轮机容量限制为 $0 \\leq h_t \\leq H_t^{\\max}$。\n\n跨期水量平衡由初始蓄水量 $S_1$、在各周期调度前实现的外部入流量 $I_1$ 和 $I_2$，以及在周期 2 结束时要求的期末蓄水量 $\\bar{S}$ 给出。假设没有弃水，两个周期内可用于发电的总水量为\n$$W = S_1 + I_1 + I_2 - \\bar{S},$$\n且总的水力发电量满足\n$$\\frac{h_1}{k} + \\frac{h_2}{k} \\leq W.$$\n\n给定以下参数：\n- $D_1 = 90$, $D_2 = 110$，\n- $a_1 = 0.02$, $b_1 = 12$; $a_2 = 0.015$, $b_2 = 10$，\n- $k = 0.9$，\n- $S_1 = 50$, $I_1 = 20$, $I_2 = 10$, $\\bar{S} = 15$，\n- $H_1^{\\max} = 80$, $H_2^{\\max} = 80$。\n\n建立以总火电成本最小化为目标，并受各周期需求平衡和总水量约束限制的优化问题。然后，根据凸经济调度的基本最优性原理进行推理，计算在给定蓄水量 $S_1$ 下的水价值。水价值定义为总用水量约束上的拉格朗日乘子，以每单位水量的货币单位表示。\n\n将最终数值答案四舍五入至四位有效数字，并以每单位水量的货币单位表示。",
            "solution": "首先验证问题，以确保其科学上合理、良定且客观。\n\n**第 1 步：提取已知条件**\n- **周期：** $t \\in \\{1, 2\\}$。\n- **火电发电量：** 周期 $t$ 的 $g_t$。\n- **火电成本：** $C_t(g_t) = a_t g_t^2 + b_t g_t$，其中 $a_t  0, b_t \\geq 0$。\n- **水电发电量：** 周期 $t$ 的 $h_t$。\n- **水电效率：** $h_t = k v_t$，其中 $v_t$ 是水量， $k \\in (0,1]$ 是效率。\n- **需求平衡：** $g_t + h_t = D_t$，其中 $D_t  0$。\n- **水电容量：** $0 \\leq h_t \\leq H_t^{\\max}$。\n- **水量平衡：** 可用于发电的总水量为 $W = S_1 + I_1 + I_2 - \\bar{S}$。\n- **总水量约束：** $\\frac{h_1}{k} + \\frac{h_2}{k} \\leq W$。\n- **参数：**\n  - $D_1 = 90$, $D_2 = 110$。\n  - $a_1 = 0.02$, $b_1 = 12$。\n  - $a_2 = 0.015$, $b_2 = 10$。\n  - $k = 0.9$。\n  - $S_1 = 50$, $I_1 = 20$, $I_2 = 10$, $\\bar{S} = 15$。\n  - $H_1^{\\max} = 80$, $H_2^{\\max} = 80$。\n- **目标：** 最小化总火电成本 $\\sum_{t=1}^2 C_t(g_t)$ 并求出水价值，即总水量约束的拉格朗日乘子。\n\n**第 2 步：验证**\n该问题描述了一个经典的水火电协调 (HTC) 场景，这是能源系统工程中一个标准且被充分理解的课题。目标函数是凸二次函数，约束是线性的，构成一个凸优化问题，该问题是良定的，并保证有唯一解。所有参数都已提供，没有内部矛盾、科学不准确之处或含糊不清的陈述。因此，该问题被认定为**有效**。\n\n**问题建模**\n目标是最小化两个周期内的总火电成本：\n$$ \\min_{g_1, g_2, h_1, h_2} \\sum_{t=1}^{2} C_t(g_t) = C_1(g_1) + C_2(g_2) $$\n使用需求平衡方程 $g_t = D_t - h_t$，我们可以将成本完全用水电发电量 $h_t$ 来表示：\n$$ \\min_{h_1, h_2} \\sum_{t=1}^{2} C_t(D_t - h_t) = \\left(a_1(D_1 - h_1)^2 + b_1(D_1 - h_1)\\right) + \\left(a_2(D_2 - h_2)^2 + b_2(D_2 - h_2)\\right) $$\n该最小化问题受一组约束条件的限制。\n首先，用于发电的总水量不能超过可用的总水量。用水量为 $v_t = h_t/k$。因此，总水量约束为：\n$$ \\frac{h_1}{k} + \\frac{h_2}{k} \\leq W $$\n可用的总水量 $W$ 根据给定的蓄水量和入流数据计算得出：\n$$ W = S_1 + I_1 + I_2 - \\bar{S} = 50 + 20 + 10 - 15 = 65 $$\n代入 $k=0.9$ 和 $W=65$，总水电能量的约束变为：\n$$ h_1 + h_2 \\leq k W = 0.9 \\times 65 = 58.5 $$\n其次，每个周期的水力发电量受水轮机容量的限制，并且不能超过需求（因为火电发电量 $g_t$ 必须为非负值，即 $g_t=D_t-h_t \\geq 0$）。\n对于周期 1：$0 \\leq h_1 \\leq \\min(D_1, H_1^{\\max}) = \\min(90, 80) = 80$。\n对于周期 2：$0 \\leq h_2 \\leq \\min(D_2, H_2^{\\max}) = \\min(110, 80) = 80$。\n\n完整的优化问题是：\n$$ \\min_{h_1, h_2} \\left[ a_1(D_1 - h_1)^2 + b_1(D_1 - h_1) + a_2(D_2 - h_2)^2 + b_2(D_2 - h_2) \\right] $$\n约束条件为：\n$$ h_1 + h_2 \\leq 58.5 \\quad (\\text{拉格朗日乘子为 } \\lambda_E) $$\n$$ 0 \\leq h_1 \\leq 80 $$\n$$ 0 \\leq h_2 \\leq 80 $$\n问题要求解“水价值”，即水量约束 $\\frac{h_1+h_2}{k} \\leq W$ 上的拉格朗日乘子。我们称这个乘子为 $\\lambda$。水电能量约束 $h_1+h_2 \\leq kW$ 的乘子为 $\\lambda_E$。这两个乘子之间的关系是 $\\lambda = k \\lambda_E$，因为一个边际单位的水量 $W$ 提供 $k$ 个边际单位的能量 $kW$。我们需要求解 $\\lambda$。\n\n**最优性条件**\n设 $J(h_1, h_2)$ 为目标函数。这是一个凸问题，因此卡罗需-库恩-塔克 (KKT) 条件是其最优性的充要条件。经济调度的核心原则是，资源的分配应使其在所有用途中的边际效益相等。在这里，“资源”是总的水电能量，“用途”是周期 1 和周期 2 的发电。\n\n在周期 $t$ 使用水力发电的边际效益是所避免的火电边际成本。火电的边际成本是 $C'_t(g_t) = 2a_t g_t + b_t$。因此，避免的成本，即水电的边际效益是：\n$$ \\beta_t(h_t) = -\\frac{\\partial J}{\\partial h_t} = - \\frac{d C_t(D_t - h_t)}{d h_t} = - [2a_t(D_t - h_t)(-1) + b_t(-1)] = 2a_t(D_t - h_t) + b_t $$\n使用水电能量的边际机会成本是其影子价格 $\\lambda_E = \\lambda/k$。在最优点，如果水电发电量 $h_1^*$ 和 $h_2^*$ 未达到其边界值，则必须有：\n$$ \\beta_1(h_1^*) = \\beta_2(h_2^*) = \\lambda_E = \\frac{\\lambda}{k} $$\n\n**求解最优调度**\n让我们用给定的参数计算边际效益函数：\n对于周期 1：\n$$ \\beta_1(h_1) = 2(0.02)(90 - h_1) + 12 = 0.04(90 - h_1) + 12 = 3.6 - 0.04h_1 + 12 = 15.6 - 0.04h_1 $$\n对于周期 2：\n$$ \\beta_2(h_2) = 2(0.015)(110 - h_2) + 10 = 0.03(110 - h_2) + 10 = 3.3 - 0.03h_2 + 10 = 13.3 - 0.03h_2 $$\n\n我们必须检查水量约束 $h_1 + h_2 \\leq 58.5$ 是否为紧约束。可能的最大水力发电量远大于可用水量（$80+80=160 > 58.5$）。此外，对于任何可行的 $h_t \\in [0, 80]$，边际效益 $\\beta_t(h_t)$ 都是正的。例如，在周期 1 中水电使用量最大时，$\\beta_1(80) = 15.6 - 0.04(80) = 12.4 > 0$。这意味着使用水电总是能节约成本。因此，所有可用的水都将被使用，水量约束是紧约束：\n$$ h_1 + h_2 = 58.5 $$\n在这种情况下，水力发电受限于可用水量，而非水轮机容量。最优调度将满足以下两个方程组：\n1. $h_1 + h_2 = 58.5$\n2. $\\beta_1(h_1) = \\beta_2(h_2) \\implies 15.6 - 0.04h_1 = 13.3 - 0.03h_2$\n\n由方程(1)，我们得到 $h_2 = 58.5 - h_1$。将其代入方程(2)：\n$$ 15.6 - 0.04h_1 = 13.3 - 0.03(58.5 - h_1) $$\n$$ 15.6 - 0.04h_1 = 13.3 - 1.755 + 0.03h_1 $$\n$$ 15.6 - 0.04h_1 = 11.545 + 0.03h_1 $$\n$$ 15.6 - 11.545 = 0.04h_1 + 0.03h_1 $$\n$$ 4.055 = 0.07h_1 $$\n$$ h_1 = \\frac{4.055}{0.07} \\approx 57.92857 $$\n然后，$h_2 = 58.5 - h_1 = 58.5 - 57.92857 \\approx 0.57143$。\n$h_1$ 和 $h_2$ 都在它们各自的边界 $[0, 80]$ 内，所以这个解是可行的。\n\n**计算水价值**\n水电能量的影子价格 $\\lambda_E$ 是最优调度时的共同边际效益：\n$$ \\lambda_E = \\beta_1(h_1) = 15.6 - 0.04 \\left(\\frac{4.055}{0.07}\\right) = 15.6 - \\frac{0.1622}{0.07} \\approx 15.6 - 2.31714 = 13.28286 $$\n我们可以用 $\\beta_2(h_2)$ 来验证：\n$$ \\lambda_E = \\beta_2(h_2) = 13.3 - 0.03 (58.5 - \\frac{4.055}{0.07}) = 13.3 - 1.755 + 0.03 \\left(\\frac{4.055}{0.07}\\right) = 11.545 + \\frac{0.12165}{0.07} \\approx 11.545 + 1.73786 = 13.28286 $$\n数值匹配。$\\lambda_E$ 的单位是每单位能量的货币单位（例如，美元/兆瓦时）。\n问题要求解水价值 $\\lambda$，即水量约束 $\\frac{h_1+h_2}{k} \\leq W$ 的拉格朗日乘子。它与 $\\lambda_E$ 的关系为 $\\lambda = k \\lambda_E$。\n$$ \\lambda = k \\times \\lambda_E = 0.9 \\times 13.28286 \\approx 11.954574 $$\n四舍五入到四位有效数字，我们得到：\n$$ \\lambda = 11.95 $$\n这个值代表了蓄存中每增加一个单位水量的边际价值，以货币单位表示。",
            "answer": "$$\\boxed{11.95}$$"
        },
        {
            "introduction": "真实的能源规划充满了对未来来水和需求的诸多不确定性。最后的这个练习将向您介绍随机对偶动态规划（Stochastic Dual Dynamic Programming, SDDP），这是一种解决不确定性下大规模、多阶段水火调度问题的标准算法。通过亲手完成一次SDDP的迭代 ()，您将获得关于该算法如何做出当前决策（“前向过程”）并从未来的结果中学习以改进后续决策（通过生成“割平面”的“后向过程”）的实践经验。这个练习搭建了从水的价值等理论概念到其实际算法实现的桥梁。",
            "id": "4095233",
            "problem": "考虑一个为随机对偶动态规划（SDDP）单次迭代构建的两阶段水火电协调问题。每个阶段的决策变量为水电释放量 $r_t$、火电发电量 $g_t$、弃水量 $s_t$ 和蓄水量 $v_t$，这些变量都受非负约束。水电转换通过一个恒定系数 $\\alpha$ 建模，因此水电发电量等于 $\\alpha r_t$。火力发电的成本是线性成本 $c g_t$。水库动态遵循水量平衡，并且水库蓄水量有上限 $V_{\\max}$，水电释放量有上限 $R_{\\max}$。所有量均以无物理量纲的归一化单位表示。不确定性在于第二阶段的入流和需求，存在两个等概率（各为 0.5）的情景。第一阶段的入流和需求是确定性的。目标是执行一次 SDDP 迭代，该迭代包括：一个前向传递，使用当前对第二阶段的未来成本函数近似（初始化为零）来确定第一阶段的决策；以及一个后向传递，为在前向传递中达到的蓄水量 $v_1$ 处的第二阶段期望未来成本计算一个仿射下界（一个“割”）。\n\n基本原理：\n- 水库水量平衡：对于阶段 $t \\in \\{1,2\\}$，$v_t = v_{t-1} + I_t - r_t - s_t$，其中 $I_t$ 是入流量（在第二阶段依赖于情景，在第一阶段是确定性的）。\n- 需求平衡：$g_t + \\alpha r_t \\ge D_t$。\n- 边界：$0 \\le r_t \\le R_{\\max}$，$0 \\le v_t \\le V_{\\max}$，$s_t \\ge 0$，$g_t \\ge 0$。\n- Bellman 最优性原理：第一阶段问题最小化即时火电成本加上当前期望未来成本的近似值；第二阶段问题最小化即时火电成本（无终端价值）。\n- 凸性和对偶性：作为 $v_1$ 的函数，第二阶段的期望未来成本在线性约束和成本下是凸且分段线性的。在 $v_1$ 处的一个仿射下界（“割”）由一个次梯度 $a$ 和一个截距 $b$ 定义，使得 $\\widehat{J}_2(v) \\ge a v + b$ 且 $\\widehat{J}_2(v_1) = a v_1 + b$，其中 $\\widehat{J}_2$ 是第二阶段的期望最优成本。\n\n前向传递规范：\n- 使用当前的第二阶段未来成本函数近似 $\\widehat{J}_2(v) \\equiv 0$。\n- 前向第一阶段问题在所述约束下最小化 $c g_1$。如果存在多个最小化解，则选择水电释放量 $r_1$ 最小的那个。\n\n后向传递规范：\n- 在访问到的蓄水量 $v_1$ 处，精确求解两个第二阶段情景子问题，以计算它们的最优成本，然后计算期望成本 $\\mathbb{E}[J_2(v_1)]$。\n- 通过对情景次梯度求平均，计算在 $v_1$ 处期望未来成本的一个有效次梯度 $a$。对于每个情景，当额外的蓄水能直接替代火电发电时（即当 $v_1 + I_2$ 严格低于有效阈值 $\\min(R_{\\max}, D_2/\\alpha)$ 时），关于 $v_1$ 的次梯度为 $-c \\alpha$，否则为 $0$。在严格相等的情况下，选择次梯度 $0$。\n- 设置割的截距 $b$，使割在 $v_1$ 处通过期望成本，即 $b = \\mathbb{E}[J_2(v_1)] - a v_1$。\n\n您的程序必须确定性地实现这单次 SDDP 迭代，并为每个测试用例输出列表 $[C_1, r_1, g_1, v_1, a, b]$，其中 $C_1$ 是前向传递第一阶段的即时成本 $c g_1$，$r_1$ 是前向水电释放量，$g_1$ 是前向火电发电量，$v_1$ 是第一阶段后的蓄水量，$a$ 是后向割的斜率，$b$ 是后向割的截距。所有量都应使用给定的归一化单位精确计算。\n\n测试套件：\n- 用例 1（一般“理想路径”，在阶段 2 使用火电）：$\\alpha = 1.0$, $c = 10.0$, $V_{\\max} = 100$, $R_{\\max} = 40$, $v_0 = 30$, $I_1 = 20$, $D_1 = 50$, 情景 A：$I_2^{(A)} = 15$, $D_2^{(A)} = 40$, 情景 B：$I_2^{(B)} = 5$, $D_2^{(B)} = 40$。\n- 用例 2（阶段 2 水电完全足够）：$\\alpha = 1.0$, $c = 10.0$, $V_{\\max} = 200$, $R_{\\max} = 100$, $v_0 = 150$, $I_1 = 10$, $D_1 = 20$, 情景 A：$I_2^{(A)} = 20$, $D_2^{(A)} = 100$, 情景 B：$I_2^{(B)} = 70$, $D_2^{(B)} = 100$。\n- 用例 3（跨情景的混合斜率）：$\\alpha = 1.0$, $c = 20.0$, $V_{\\max} = 120$, $R_{\\max} = 30$, $v_0 = 40$, $I_1 = 15$, $D_1 = 30$, 情景 A：$I_2^{(A)} = 4$, $D_2^{(A)} = 60$, 情景 B：$I_2^{(B)} = 10$, $D_2^{(B)} = 25$。\n- 用例 4（第一阶段弃水边界）：$\\alpha = 1.0$, $c = 5.0$, $V_{\\max} = 50$, $R_{\\max} = 10$, $v_0 = 45$, $I_1 = 20$, $D_1 = 5$, 情景 A：$I_2^{(A)} = 5$, $D_2^{(A)} = 40$, 情景 B：$I_2^{(B)} = 0$, $D_2^{(B)} = 8$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个用例结果的列表，每个结果本身就是一个列表 $[C_1, r_1, g_1, v_1, a, b]$。输出必须格式化为用方括号括起来的逗号分隔列表，例如 $[[\\dots],[\\dots],[\\dots],[\\dots]]$。不应打印任何其他文本。",
            "solution": "该问题是在水火电系统调度背景下定义明确的两阶段随机优化问题。它要求执行随机对偶动态规划（SDDP）算法的单次迭代。该问题在科学上是合理的、自洽的，并且所有数据和约束都已提供。验证成功，我们可以继续进行求解。\n\n求解过程涉及两个主要传递：一个用于确定第一阶段决策的前向传递，以及一个用于生成新的 Benders 割（期望未来成本函数的一个仿射下界）的后向传递。\n\n### 前向传递：阶段 1\n\n第一阶段的目标是最小化即时运营成本加上期望未来成本。对于这次单次迭代，期望未来成本函数 $\\widehat{J}_2(v_1)$ 对于所有期末蓄水量 $v_1$ 的值都被近似为零。\n因此，第一阶段的问题是：\n$$ \\min_{r_1, g_1, s_1, v_1} c g_1 $$\n受以下约束：\n1.  需求平衡：$g_1 + \\alpha r_1 \\ge D_1$\n2.  水库水量平衡：$v_1 = v_0 + I_1 - r_1 - s_1$\n3.  决策变量边界：$0 \\le r_1 \\le R_{\\max}$，$0 \\le v_1 \\le V_{\\max}$，$s_1 \\ge 0$，$g_1 \\ge 0$。\n\n由于火电成本系数 $c$ 是正数，最小化 $c g_1$ 等价于最小化火电发电量 $g_1$。从需求平衡约束可知，$g_1 \\ge D_1 - \\alpha r_1$。由于 $g_1$ 必须是非负的，这可以写成 $g_1 = \\max(0, D_1 - \\alpha r_1)$。为了最小化 $g_1$，我们必须最大化水电释放量 $r_1$。\n\n然而，问题指定了一个打破平局的规则：如果多个解产生相同的最小成本，则必须选择水电释放量 $r_1$ 最小的那个。这导致了以下用于确定最优第一阶段释放量 $r_1$ 的逻辑：\n\n1.  **确定需求是否能仅由水电满足。**如果存在一个可行的释放量 $r_1$ 使得 $\\alpha r_1 \\ge D_1$（即 $r_1 \\ge D_1/\\alpha$），则这是可能的。一个释放量 $r_1$ 如果遵守系统的物理限制，则为可行。最大可能释放量 $r_{1, \\text{max\\_feasible}}$ 受水轮机容量 $R_{\\max}$ 和水库中总可用水量 $v_0 + I_1$ 的约束。因此，$r_{1, \\text{max\\_feasible}} = \\min(R_{\\max}, v_0 + I_1)$。\n\n2.  **选择最优释放量 $r_1$**：\n    *   如果用水电满足需求是可行的（即 $D_1/\\alpha \\le r_{1, \\text{max\\_feasible}}$），则任何释放量 $r_1 \\in [D_1/\\alpha, r_{1, \\text{max\\_feasible}}]$ 都会导致 $g_1 = 0$，这是可能的最小火电发电量。根据打破平局的规则，我们必须选择满足条件的最小释放量，因此我们设置 $r_1 = D_1/\\alpha$。\n    *   如果需求不能完全由水电满足（$D_1/\\alpha > r_{1, \\text{max\\_feasible}}$），那么对于所有可行的 $r_1$，都有 $g_1 = D_1 - \\alpha r_1 > 0$。为了最小化 $g_1$，我们必须最大化 $r_1$。唯一的最大化解是 $r_1 = r_{1, \\text{max\\_feasible}}$。\n\n3.  **确定其他第一阶段变量**：\n    *   火电发电量为 $g_1 = \\max(0, D_1 - \\alpha r_1)$。即时成本为 $C_1 = c g_1$。\n    *   阶段末蓄水量 $v_1$ 和弃水量 $s_1$ 必须满足 $v_1 + s_1 = v_0 + I_1 - r_1$。由于未来成本函数为零，没有明确的蓄水激励。我们采用最小化弃水量的标准操作实践，这等同于最大化阶段末蓄水量 $v_1$。潜在蓄水量为 $v'_1 = v_0 + I_1 - r_1$。\n        *   如果 $v'_1 > V_{\\max}$，则水库已满。因此，$v_1 = V_{\\max}$ 且弃水量 $s_1 = v'_1 - V_{\\max}$。\n        *   如果 $0 \\le v'_1 \\le V_{\\max}$，我们可以储存所有剩余的水。因此，$v_1 = v'_1$ 且 $s_1 = 0$。\n\n这个过程唯一地确定了所有第一阶段的决策变量：$[C_1, r_1, g_1, v_1]$。\n\n### 后向传递：阶段 2\n\n后向传递计算一个 Benders 割（一个仿射函数），它为真实的期望未来成本函数 $\\mathbb{E}[J_2(v_1)]$ 提供下界。该割的形式为 $\\mathbb{E}[J_2(v)] \\ge a v + b$，并被构建为在前向传递中访问的点 $v_1$ 处是精确的。\n\n对于每个第二阶段情景 $s \\in \\{A, B\\}$，我们必须求解以下确定性子问题以找到最优成本 $J_2(v_1, s)$：\n$$ J_2(v_1, s) = \\min_{r_2, g_2, s_2, v_2} c g_2^{(s)} $$\n受第二阶段约束，给定初始蓄水量 $v_1$。\n\n1.  **求解情景子问题**：目标是最小化 $c g_2^{(s)}$，这同样意味着最大化水电释放量 $r_2^{(s)}$。最大可行释放量为 $r_{2, \\text{max\\_feasible}}^{(s)} = \\min(R_{\\max}, v_1 + I_2^{(s)})$。\n    *   最优释放量为 $r_2^{(s)} = r_{2, \\text{max\\_feasible}}^{(s)}$。\n    *   最优火电发电量为 $g_2^{(s)} = \\max(0, D_2^{(s)} - \\alpha r_2^{(s)})$。\n    *   情景 $s$ 的成本为 $J_2(v_1, s) = c g_2^{(s)}$。\n\n2.  **计算期望成本**：由于情景是等可能的（概率 $p=0.5$），期望成本为 $\\mathbb{E}[J_2(v_1)] = 0.5 \\cdot J_2(v_1, A) + 0.5 \\cdot J_2(v_1, B)$。\n\n3.  **计算割的斜率（次梯度）**：割的斜率 $a$ 是情景次梯度的期望值。$J_2(v_1, s)$ 关于 $v_1$ 的次梯度 $a^{(s)}$ 代表水的边际价值。如果一单位额外水量可以用来替代火电发电，它将使成本降低 $c\\alpha$。这只有在系统同时具有剩余水轮机容量和可以由水电满足的未满足需求时才可能。\n    问题指定了公式：\n    $$ a^{(s)} = \\begin{cases} -c \\alpha   \\text{if } v_1 + I_2^{(s)}  \\min(R_{\\max}, D_2^{(s)}/\\alpha) \\\\ 0   \\text{otherwise} \\end{cases} $$\n    这个条件检查总可用水量 $v_1 + I_2^{(s)}$ 是否小于可以有效通过水轮机释放的水量。如果小于，则边际水量的价值为 $c\\alpha$，次梯度为 $-c\\alpha$。否则，边际水量对于当前阶段的价值为零，次梯度为 $0$。\n    总斜率是期望值：$a = 0.5 \\cdot a^{(A)} + 0.5 \\cdot a^{(B)}$。\n\n4.  **计算割的截距**：选择截距 $b$，使得仿射函数在 $v_1$ 处是精确的：$\\mathbb{E}[J_2(v_1)] = a v_1 + b$。这得出 $b = \\mathbb{E}[J_2(v_1)] - a v_1$。\n\n此过程确定了割的参数 $[a, b]$，从而完成了单次 SDDP 迭代。该算法针对每个测试用例实现，以生成所需的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the given hydro-thermal coordination problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: alpha, c, V_max, R_max, v0, I1, D1, I2A, D2A, I2B, D2B\n        (1.0, 10.0, 100.0, 40.0, 30.0, 20.0, 50.0, 15.0, 40.0, 5.0, 40.0),\n        # Case 2\n        (1.0, 10.0, 200.0, 100.0, 150.0, 10.0, 20.0, 20.0, 100.0, 70.0, 100.0),\n        # Case 3\n        (1.0, 20.0, 120.0, 30.0, 40.0, 15.0, 30.0, 4.0, 60.0, 10.0, 25.0),\n        # Case 4\n        (1.0, 5.0, 50.0, 10.0, 45.0, 20.0, 5.0, 5.0, 40.0, 0.0, 8.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_sddp_iteration(case)\n        results.append(result)\n\n    # Format the final output string exactly as required.\n    # e.g., \"[[C1,r1,...],[C1,r1,...]]\"\n    results_as_strings = [f\"[{','.join(map(str, res))}]\" for res in results]\n    final_output = f\"[{','.join(results_as_strings)}]\"\n    print(final_output)\n\ndef run_sddp_iteration(params):\n    \"\"\"\n    Performs a single SDDP iteration (forward and backward pass) for one test case.\n\n    Args:\n        params (tuple): A tuple containing all parameters for the test case.\n\n    Returns:\n        list: A list of the calculated values [C1, r1, g1, v1, a, b].\n    \"\"\"\n    alpha, c, V_max, R_max, v0, I1, D1, I2A, D2A, I2B, D2B = params\n\n    # FORWARD PASS (Stage 1)\n    \n    # Water available in stage 1\n    water_available_1 = v0 + I1\n    \n    # Release required to meet demand D1 with hydro only\n    r_target = D1 / alpha\n    \n    # Maximum feasible release in stage 1\n    r_max_feasible = min(R_max, water_available_1)\n\n    r1, g1 = 0.0, 0.0\n    if r_target = r_max_feasible:\n        # Minimum cost (g1=0) is achievable. By tie-breaking rule, use smallest r1.\n        r1 = r_target\n        g1 = 0.0\n    else:\n        # Minimum cost requires maximizing r1, as g1 > 0.\n        r1 = r_max_feasible\n        g1 = D1 - alpha * r1\n\n    C1 = c * g1\n\n    # Determine end-of-stage storage v1 by maximizing storage (minimizing spillage)\n    v_potential = v0 + I1 - r1\n    v1 = 0.0\n    if v_potential > V_max:\n        v1 = V_max\n    else:\n        v1 = v_potential\n\n    # BACKWARD PASS (Stage 2)\n    \n    # Scenario A\n    water_available_2A = v1 + I2A\n    r2_opt_A = min(R_max, water_available_2A)\n    g2_A = max(0.0, D2A - alpha * r2_opt_A)\n    cost_A = c * g2_A\n    \n    threshold_A = min(R_max, D2A / alpha)\n    slope_A = -c * alpha if (v1 + I2A)  threshold_A else 0.0\n\n    # Scenario B\n    water_available_2B = v1 + I2B\n    r2_opt_B = min(R_max, water_available_2B)\n    g2_B = max(0.0, D2B - alpha * r2_opt_B)\n    cost_B = c * g2_B\n\n    threshold_B = min(R_max, D2B / alpha)\n    slope_B = -c * alpha if (v1 + I2B)  threshold_B else 0.0\n\n    # Calculate the Benders cut parameters (a, b)\n    # The scenarios have equal probability of 0.5\n    expected_future_cost = 0.5 * cost_A + 0.5 * cost_B\n    a = 0.5 * slope_A + 0.5 * slope_B\n    b = expected_future_cost - a * v1\n    \n    return [C1, r1, g1, v1, a, b]\n\nsolve()\n```"
        }
    ]
}