{
    "hands_on_practices": [
        {
            "introduction": "The central challenge in hydro-thermal coordination is deciding when to use a limited volume of water. Using water now for cheap electricity means forgoing its use in the future, where it might be even more valuable. This exercise  introduces the foundational concept of 'water value,' which is the opportunity cost of using water. By solving a simplified two-period problem, you will learn to quantify this value and understand the core economic principle of balancing marginal benefits across time.",
            "id": "4095243",
            "problem": "Consider a two-period Hydro-Thermal Coordination (HTC) problem in an energy system with one hydro unit and one thermal unit. Periods are indexed by $t \\in \\{1,2\\}$. The objective is to schedule hydro and thermal generation to meet the period demands while minimizing the thermal generation cost. Hydro generation is costless but limited by the available water resource, a conversion efficiency, and turbine capacity limits.\n\nThe thermal unit in period $t$ produces $g_t$ and has a convex cost $C_t(g_t) = a_t g_t^2 + b_t g_t$, where $a_t > 0$ and $b_t \\geq 0$. The hydro unit in period $t$ produces $h_t$ and uses water volume $v_t$ related by $h_t = k v_t$, where $k \\in (0,1]$ is a fixed conversion efficiency. Demand balance in each period requires $g_t + h_t = D_t$, with $D_t > 0$ given. Hydro turbine capacity in each period imposes $0 \\leq h_t \\leq H_t^{\\max}$.\n\nThe intertemporal water balance is given by an initial storage $S_1$, exogenous inflows $I_1$ and $I_2$ that materialize before dispatch in each respective period, and a required terminal storage $\\bar{S}$ at the end of period $2$. Assuming no spill, the total water available for generation across the two periods is\n$$W = S_1 + I_1 + I_2 - \\bar{S},$$\nand the aggregate hydro generation satisfies\n$$\\frac{h_1}{k} + \\frac{h_2}{k} \\leq W.$$\n\nYou are given the following parameters:\n- $D_1 = 90$, $D_2 = 110$,\n- $a_1 = 0.02$, $b_1 = 12$; $a_2 = 0.015$, $b_2 = 10$,\n- $k = 0.9$,\n- $S_1 = 50$, $I_1 = 20$, $I_2 = 10$, $\\bar{S} = 15$,\n- $H_1^{\\max} = 80$, $H_2^{\\max} = 80$.\n\nFormulate the minimization of total thermal cost subject to period-wise demand balance and the aggregate water constraint. Then, by reasoning from fundamental optimality principles for convex economic dispatch, compute the water value at the given storage level $S_1$, defined as the Lagrange multiplier on the aggregate water-use constraint expressed in monetary units per unit of water volume.\n\nRound your final numerical answer to four significant figures and express it in monetary units per unit of water volume.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n**Step 1: Extracted Givens**\n- **Periods:** $t \\in \\{1, 2\\}$.\n- **Thermal generation:** $g_t$ in period $t$.\n- **Thermal cost:** $C_t(g_t) = a_t g_t^2 + b_t g_t$, with $a_t > 0$, $b_t \\geq 0$.\n- **Hydro generation:** $h_t$ in period $t$.\n- **Hydro efficiency:** $h_t = k v_t$, where $v_t$ is water volume and $k \\in (0,1]$ is the efficiency.\n- **Demand balance:** $g_t + h_t = D_t$, with $D_t > 0$.\n- **Hydro capacity:** $0 \\leq h_t \\leq H_t^{\\max}$.\n- **Water balance:** Total available water for generation is $W = S_1 + I_1 + I_2 - \\bar{S}$.\n- **Aggregate water constraint:** $\\frac{h_1}{k} + \\frac{h_2}{k} \\leq W$.\n- **Parameters:**\n  - $D_1 = 90$, $D_2 = 110$.\n  - $a_1 = 0.02$, $b_1 = 12$.\n  - $a_2 = 0.015$, $b_2 = 10$.\n  - $k = 0.9$.\n  - $S_1 = 50$, $I_1 = 20$, $I_2 = 10$, $\\bar{S} = 15$.\n  - $H_1^{\\max} = 80$, $H_2^{\\max} = 80$.\n- **Objective:** Minimize total thermal cost $\\sum_{t=1}^2 C_t(g_t)$ and find the water value, which is the Lagrange multiplier on the aggregate water constraint.\n\n**Step 2: Validation**\nThe problem describes a classic Hydro-Thermal Coordination (HTC) scenario, a standard and well-understood topic in energy systems engineering. The objective function is a convex quadratic, and the constraints are linear, forming a convex optimization problem which is well-posed and guaranteed to have a unique solution. All parameters are provided, and there are no internal contradictions, scientific inaccuracies, or ambiguous statements. The problem is therefore deemed **valid**.\n\n**Problem Formulation**\nThe objective is to minimize the total thermal cost over the two periods:\n$$ \\min_{g_1, g_2, h_1, h_2} \\sum_{t=1}^{2} C_t(g_t) = C_1(g_1) + C_2(g_2) $$\nUsing the demand balance equation, $g_t = D_t - h_t$, we can express the cost solely in terms of hydro generation, $h_t$:\n$$ \\min_{h_1, h_2} \\sum_{t=1}^{2} C_t(D_t - h_t) = \\left(a_1(D_1 - h_1)^2 + b_1(D_1 - h_1)\\right) + \\left(a_2(D_2 - h_2)^2 + b_2(D_2 - h_2)\\right) $$\nThis minimization is subject to a set of constraints.\nFirst, the total water used for generation cannot exceed the total available water. The water use is $v_t = h_t/k$. Thus, the aggregate water constraint is:\n$$ \\frac{h_1}{k} + \\frac{h_2}{k} \\leq W $$\nThe total available water $W$ is calculated from the given storage and inflow data:\n$$ W = S_1 + I_1 + I_2 - \\bar{S} = 50 + 20 + 10 - 15 = 65 $$\nSubstituting $k=0.9$ and $W=65$, the constraint on total hydro energy becomes:\n$$ h_1 + h_2 \\leq k W = 0.9 \\times 65 = 58.5 $$\nSecond, hydro generation in each period is bounded by the turbine capacity and also cannot exceed the demand (since thermal generation $g_t$ must be non-negative, $g_t=D_t-h_t \\geq 0$).\nFor period $1$: $0 \\leq h_1 \\leq \\min(D_1, H_1^{\\max}) = \\min(90, 80) = 80$.\nFor period $2$: $0 \\leq h_2 \\leq \\min(D_2, H_2^{\\max}) = \\min(110, 80) = 80$.\n\nThe full optimization problem is:\n$$ \\min_{h_1, h_2} \\left[ a_1(D_1 - h_1)^2 + b_1(D_1 - h_1) + a_2(D_2 - h_2)^2 + b_2(D_2 - h_2) \\right] $$\nsubject to:\n$$ h_1 + h_2 \\leq 58.5 \\quad (\\text{with Lagrange multiplier } \\lambda_E) $$\n$$ 0 \\leq h_1 \\leq 80 $$\n$$ 0 \\leq h_2 \\leq 80 $$\nThe problem asks for the \"water value,\" which is the Lagrange multiplier on the water volume constraint $\\frac{h_1+h_2}{k} \\leq W$. Let's call this multiplier $\\lambda$. The constraint on hydro energy $h_1+h_2 \\leq kW$ would have a multiplier $\\lambda_E$. These multipliers are related by $\\lambda = k \\lambda_E$, as a marginal unit of water $W$ provides $k$ marginal units of energy $kW$. We are asked to find $\\lambda$.\n\n**Optimality Conditions**\nLet $J(h_1, h_2)$ be the objective function. This is a convex problem, so the Karush-Kuhn-Tucker (KKT) conditions are necessary and sufficient for optimality. The core principle of economic dispatch is that a resource should be allocated such that its marginal benefit is equal across all uses. Here, the \"resource\" is total hydro energy, and the \"uses\" are generation in period $1$ and period $2$.\n\nThe marginal benefit of using hydro generation in period $t$ is the avoided marginal cost of thermal generation. The marginal cost of thermal generation is $C'_t(g_t) = 2a_t g_t + b_t$. The avoided cost, or marginal benefit of hydro, is therefore:\n$$ \\beta_t(h_t) = -\\frac{\\partial J}{\\partial h_t} = - \\frac{d C_t(D_t - h_t)}{d h_t} = - [2a_t(D_t - h_t)(-1) + b_t(-1)] = 2a_t(D_t - h_t) + b_t $$\nThe marginal opportunity cost of using hydro energy is its shadow price, $\\lambda_E = \\lambda/k$. At the optimum, if the hydro generations $h_1^*$ and $h_2^*$ are not at their bounds, we must have:\n$$ \\beta_1(h_1^*) = \\beta_2(h_2^*) = \\lambda_E = \\frac{\\lambda}{k} $$\n\n**Solving for the Optimal Dispatch**\nLet's compute the marginal benefit functions with the given parameters:\nFor period $1$:\n$$ \\beta_1(h_1) = 2(0.02)(90 - h_1) + 12 = 0.04(90 - h_1) + 12 = 3.6 - 0.04h_1 + 12 = 15.6 - 0.04h_1 $$\nFor period $2$:\n$$ \\beta_2(h_2) = 2(0.015)(110 - h_2) + 10 = 0.03(110 - h_2) + 10 = 3.3 - 0.03h_2 + 10 = 13.3 - 0.03h_2 $$\n\nWe must check if the water constraint $h_1 + h_2 \\leq 58.5$ is binding. The maximum possible hydro generation is far greater than the available amount ($80+80=160 > 58.5$). Further, the marginal benefits $\\beta_t(h_t)$ are positive for any feasible $h_t \\in [0, 80]$. For example, at maximum hydro use in period $1$, $\\beta_1(80) = 15.6 - 0.04(80) = 12.4 > 0$. This implies that using hydro is always cost-saving. Therefore, all available water will be used, and the water constraint is binding:\n$$ h_1 + h_2 = 58.5 $$\nThe hydro generation is limited by water availability, not turbine capacity in this case. The optimal dispatch will satisfy the system of two equations:\n1. $h_1 + h_2 = 58.5$\n2. $\\beta_1(h_1) = \\beta_2(h_2) \\implies 15.6 - 0.04h_1 = 13.3 - 0.03h_2$\n\nFrom equation (1), we have $h_2 = 58.5 - h_1$. Substituting this into equation (2):\n$$ 15.6 - 0.04h_1 = 13.3 - 0.03(58.5 - h_1) $$\n$$ 15.6 - 0.04h_1 = 13.3 - 1.755 + 0.03h_1 $$\n$$ 15.6 - 0.04h_1 = 11.545 + 0.03h_1 $$\n$$ 15.6 - 11.545 = 0.04h_1 + 0.03h_1 $$\n$$ 4.055 = 0.07h_1 $$\n$$ h_1 = \\frac{4.055}{0.07} \\approx 57.92857 $$\nThen, $h_2 = 58.5 - h_1 = 58.5 - 57.92857 \\approx 0.57143$.\nBoth $h_1$ and $h_2$ are within their individual bounds $[0, 80]$, so this solution is feasible.\n\n**Calculating the Water Value**\nThe shadow price of hydro energy, $\\lambda_E$, is the common marginal benefit at the optimal dispatch:\n$$ \\lambda_E = \\beta_1(h_1) = 15.6 - 0.04 \\left(\\frac{4.055}{0.07}\\right) = 15.6 - \\frac{0.1622}{0.07} \\approx 15.6 - 2.31714 = 13.28286 $$\nWe can verify with $\\beta_2(h_2)$:\n$$ \\lambda_E = \\beta_2(h_2) = 13.3 - 0.03 (58.5 - \\frac{4.055}{0.07}) = 13.3 - 1.755 + 0.03 \\left(\\frac{4.055}{0.07}\\right) = 11.545 + \\frac{0.12165}{0.07} \\approx 11.545 + 1.73786 = 13.28286 $$\nThe values match. $\\lambda_E$ has units of monetary units per unit of energy (e.g., \\$/MWh).\nThe problem asks for the water value $\\lambda$, which is the Lagrange multiplier for the volume constraint $\\frac{h_1+h_2}{k} \\leq W$. This is related to $\\lambda_E$ by $\\lambda = k \\lambda_E$.\n$$ \\lambda = k \\times \\lambda_E = 0.9 \\times 13.28286 \\approx 11.954574 $$\nRounding to four significant figures, we get:\n$$ \\lambda = 11.95 $$\nThis value represents the marginal worth of an additional unit of water volume in storage, expressed in monetary units.",
            "answer": "$$\\boxed{11.95}$$"
        },
        {
            "introduction": "Once a high-level decision on hydro generation for a specific period is made, system operators face the task of orchestrating thermal generators to meet the remaining demand. This practice  hones in on this single-period economic dispatch problem. You will calculate the least-cost thermal generation schedule while respecting crucial operational limits, including the need to hold spinning reserves for system security, applying the principle of equal incremental costs.",
            "id": "4095224",
            "problem": "Consider a single-period hydro-thermal coordination problem at period $t$ in which a fixed hydro injection $P^{H}_{t}$ partially meets the demand $D_{t}$. The remaining demand must be supplied by two thermal units indexed by $i \\in \\{1,2\\}$, each with a strictly convex quadratic production cost function $C_{i}(P_{i,t}) = a_{i} P_{i,t}^{2} + b_{i} P_{i,t} + c_{i}$ and nameplate capacity $P_{i,t}^{\\max}$. The thermal units must also collectively carry a spinning reserve requirement $R_{t}$, allocated according to fixed participation factors $w_{i}$, with $w_{1} + w_{2} = 1$. Spinning Reserve (SR) is modeled as upward headroom that must be withheld from scheduled generation, so the scheduling constraint for each unit is $P_{i,t} \\leq P_{i,t}^{\\max} - r_{i,t}$ where $r_{i,t} = w_{i} R_{t}$. There are no ramping constraints in this period, and minimum generation limits are zero.\n\nThe system must satisfy the real power balance\n$$\nP^{H}_{t} + P_{1,t} + P_{2,t} = D_{t}.\n$$\n\nThe objective is to minimize total thermal production cost subject to the above constraints. Use first principles of convex optimization and dispatch (without assuming or quoting any shortcut formulas) to derive the optimal dispatch and then compute the optimal generation of Thermal Unit $1$, denoted $P_{1,t}^{\\star}$.\n\nData for period $t$:\n- Demand $D_{t} = 800~\\text{MW}$.\n- Hydro injection $P^{H}_{t} = 300~\\text{MW}$.\n- Spinning reserve requirement $R_{t} = 100~\\text{MW}$ with participation factors $w_{1} = 0.6$ and $w_{2} = 0.4$, so $r_{1,t} = 60~\\text{MW}$ and $r_{2,t} = 40~\\text{MW}$.\n- Thermal Unit $1$: $C_{1}(P_{1,t}) = 0.020\\,P_{1,t}^{2} + 15.0\\,P_{1,t} + 0$, $P_{1,t}^{\\max} = 400~\\text{MW}$, $P_{1,t}^{\\min} = 0~\\text{MW}$.\n- Thermal Unit $2$: $C_{2}(P_{2,t}) = 0.015\\,P_{2,t}^{2} + 16.0\\,P_{2,t} + 0$, $P_{2,t}^{\\max} = 300~\\text{MW}$, $P_{2,t}^{\\min} = 0~\\text{MW}$.\n\nCompute $P_{1,t}^{\\star}$ under these conditions. Express your final answer in $\\text{MW}$ and round your answer to four significant figures.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- **Objective**: Minimize total thermal production cost, $C_{1}(P_{1,t}) + C_{2}(P_{2,t})$.\n- **Cost Functions**:\n  - Unit $1$: $C_{1}(P_{1,t}) = 0.020\\,P_{1,t}^{2} + 15.0\\,P_{1,t} + 0$.\n  - Unit $2$: $C_{2}(P_{2,t}) = 0.015\\,P_{2,t}^{2} + 16.0\\,P_{2,t} + 0$.\n- **Power Balance Constraint**: $P^{H}_{t} + P_{1,t} + P_{2,t} = D_{t}$.\n- **Generation Limits**:\n  - Unit $1$: $P_{1,t}^{\\min} = 0~\\text{MW}$, $P_{1,t}^{\\max} = 400~\\text{MW}$.\n  - Unit $2$: $P_{2,t}^{\\min} = 0~\\text{MW}$, $P_{2,t}^{\\max} = 300~\\text{MW}$.\n- **Spinning Reserve (SR) Constraint**: $P_{i,t} \\leq P_{i,t}^{\\max} - r_{i,t}$, where $r_{i,t} = w_{i} R_{t}$.\n- **System Data for Period $t$**:\n  - Demand: $D_{t} = 800~\\text{MW}$.\n  - Hydro injection: $P^{H}_{t} = 300~\\text{MW}$.\n  - SR requirement: $R_{t} = 100~\\text{MW}$.\n  - SR participation factors: $w_{1} = 0.6$, $w_{2} = 0.4$.\n- **Derived SR Allocations**:\n  - Unit $1$: $r_{1,t} = w_{1} R_{t} = 0.6 \\times 100~\\text{MW} = 60~\\text{MW}$.\n  - Unit $2$: $r_{2,t} = w_{2} R_{t} = 0.4 \\times 100~\\text{MW} = 40~\\text{MW}$.\n- **Task**: Compute the optimal generation of Thermal Unit $1$, $P_{1,t}^{\\star}$, and round to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is a classic economic dispatch problem in power systems engineering, a subfield of energy systems modeling. The use of strictly convex quadratic cost functions, power balance, and generation limits (including those for spinning reserve) is standard and scientifically sound.\n- **Well-Posedness**: The objective function, being the sum of two strictly convex quadratic functions, is itself strictly convex. The constraints are all linear, defining a convex and non-empty feasible set. The minimization of a strictly convex function over a non-empty, closed, convex set guarantees the existence of a unique solution.\n- **Objectivity**: The problem is stated in precise, quantitative terms. All data and constraints are objective.\n- **Completeness and Consistency**: All necessary data to formulate and solve the optimization problem are provided. The givens are internally consistent (e.g., $w_1 + w_2 = 0.6 + 0.4 = 1.0$).\n- **Realism**: The values for demand, generation capacities, and cost function coefficients are within a realistic range for a small-scale power system model.\n\n### Step 3: Verdict and Action\nThe problem is scientifically grounded, well-posed, complete, and consistent. It is a valid optimization problem. I will proceed with the solution.\n\n### Solution Derivation\nThe problem is to minimize the total thermal cost $C_{\\text{total}}(P_{1,t}, P_{2,t}) = C_{1}(P_{1,t}) + C_{2}(P_{2,t})$ subject to a set of constraints.\n\nFirst, we establish the net demand that must be met by the two thermal units.\nThe power balance equation is $P^{H}_{t} + P_{1,t} + P_{2,t} = D_{t}$.\nSubstituting the given values: $300 + P_{1,t} + P_{2,t} = 800$.\nThis simplifies to the thermal-only power balance constraint:\n$$P_{1,t} + P_{2,t} = 800 - 300 = 500$$\nLet $P_{D} = 500~\\text{MW}$ be the net thermal demand.\n\nNext, we establish the effective generation limits for each unit, incorporating the spinning reserve requirement. The effective maximum generation capacity for scheduling, $P_{i,t}^{\\text{eff\\_max}}$, is given by $P_{i,t}^{\\text{eff\\_max}} = P_{i,t}^{\\max} - r_{i,t}$.\nFor Unit $1$:\n$P_{1,t}^{\\text{eff\\_max}} = P_{1,t}^{\\max} - r_{1,t} = 400~\\text{MW} - 60~\\text{MW} = 340~\\text{MW}$.\nThe operating range for Unit $1$ is $0 \\leq P_{1,t} \\leq 340$.\n\nFor Unit $2$:\n$P_{2,t}^{\\text{eff\\_max}} = P_{2,t}^{\\max} - r_{2,t} = 300~\\text{MW} - 40~\\text{MW} = 260~\\text{MW}$.\nThe operating range for Unit $2$ is $0 \\leq P_{2,t} \\leq 260$.\n\nThe complete optimization problem is:\n$$\n\\text{Minimize } \\quad C(P_{1,t}, P_{2,t}) = (0.020\\,P_{1,t}^{2} + 15.0\\,P_{1,t}) + (0.015\\,P_{2,t}^{2} + 16.0\\,P_{2,t})\n$$\n$$\n\\text{subject to:} \\quad\n\\begin{cases}\nP_{1,t} + P_{2,t} = 500 \\\\\n0 \\leq P_{1,t} \\leq 340 \\\\\n0 \\leq P_{2,t} \\leq 260\n\\end{cases}\n$$\n\nThis is a convex optimization problem. From first principles, we can use the method of Lagrange multipliers. The Lagrangian $\\mathcal{L}$ for the equality-constrained problem is:\n$$\n\\mathcal{L}(P_{1,t}, P_{2,t}, \\lambda) = C_{1}(P_{1,t}) + C_{2}(P_{2,t}) - \\lambda(P_{1,t} + P_{2,t} - P_{D})\n$$\nThe first-order necessary conditions for optimality are obtained by setting the partial derivatives of $\\mathcal{L}$ with respect to the decision variables to zero:\n$$\n\\frac{\\partial\\mathcal{L}}{\\partial P_{1,t}} = \\frac{dC_{1}}{dP_{1,t}} - \\lambda = 0 \\implies \\frac{dC_{1}}{dP_{1,t}} = \\lambda\n$$\n$$\n\\frac{\\partial\\mathcal{L}}{\\partial P_{2,t}} = \\frac{dC_{2}}{dP_{2,t}} - \\lambda = 0 \\implies \\frac{dC_{2}}{dP_{2,t}} = \\lambda\n$$\nThis leads to the principle of equal incremental costs for an unconstrained economic dispatch:\n$$\n\\frac{dC_{1}}{dP_{1,t}} = \\frac{dC_{2}}{dP_{2,t}}\n$$\nThe incremental cost (or marginal cost) function for each unit $i$ is $IC_{i}(P_{i,t}) = \\frac{dC_{i}}{dP_{i,t}} = 2a_{i}P_{i,t} + b_{i}$.\nFor Unit $1$: $IC_{1}(P_{1,t}) = 2(0.020)P_{1,t} + 15.0 = 0.040\\,P_{1,t} + 15.0$.\nFor Unit $2$: $IC_{2}(P_{2,t}) = 2(0.015)P_{2,t} + 16.0 = 0.030\\,P_{2,t} + 16.0$.\n\nSetting the incremental costs equal, we have:\n$0.040\\,P_{1,t} + 15.0 = 0.030\\,P_{2,t} + 16.0$.\n\nWe now have a system of two linear equations for $P_{1,t}$ and $P_{2,t}$:\n1) $0.040\\,P_{1,t} - 0.030\\,P_{2,t} = 1.0$\n2) $P_{1,t} + P_{2,t} = 500$\n\nFrom equation (2), we express $P_{2,t}$ in terms of $P_{1,t}$: $P_{2,t} = 500 - P_{1,t}$.\nSubstitute this into equation (1):\n$0.040\\,P_{1,t} - 0.030(500 - P_{1,t}) = 1.0$\n$0.040\\,P_{1,t} - 15 + 0.030\\,P_{1,t} = 1.0$\n$0.070\\,P_{1,t} = 16.0$\n$P_{1,t} = \\frac{16.0}{0.070} = \\frac{1600}{7} \\approx 228.5714~\\text{MW}$.\n\nNow we find the corresponding $P_{2,t}$:\n$P_{2,t} = 500 - P_{1,t} = 500 - \\frac{1600}{7} = \\frac{3500 - 1600}{7} = \\frac{1900}{7} \\approx 271.4286~\\text{MW}$.\n\nThis solution ($P_{1,t} \\approx 228.57$, $P_{2,t} \\approx 271.43$) is the optimal dispatch if there were no generation limits. We must now check if this solution is feasible by comparing it against the effective limits.\nFor Unit $1$: $0 \\leq 228.57 \\leq 340$. The dispatch for Unit $1$ is within its limits.\nFor Unit $2$: $0 \\leq 271.43 \\leq 260$. The dispatch for Unit $2$ violates its upper limit ($271.43 > 260$).\n\nSince the unconstrained optimum is not feasible, the true optimum must lie on the boundary of the feasible region. The violation indicates that the incremental cost of Unit $2$ is lower than that of Unit $1$ for much of the dispatch range, and we would ideally use it more, but are prevented from doing so by its capacity limit. Therefore, at the optimal solution, the constraint $P_{2,t} \\leq 260$ must be active (binding).\n\nWe set the generation of Unit $2$ to its upper limit:\n$P_{2,t}^{\\star} = 260~\\text{MW}$.\n\nThe generation of Unit $1$ is then determined by the power balance equation:\n$P_{1,t}^{\\star} = P_{D} - P_{2,t}^{\\star} = 500 - 260 = 240~\\text{MW}$.\n\nWe must verify that this new dispatch point, $(P_{1,t}^{\\star}, P_{2,t}^{\\star}) = (240, 260)$, is feasible.\n- Power Balance: $240 + 260 = 500$. Satisfied.\n- Unit 1 Limits: $0 \\leq 240 \\leq 340$. Satisfied.\n- Unit 2 Limits: $0 \\leq 260 \\leq 260$. Satisfied (at the boundary).\n\nThe solution is feasible. According to the Karush-Kuhn-Tucker (KKT) conditions for optimality, when a unit is at its upper generation limit, its incremental cost must be less than or equal to the system's marginal cost ($\\lambda$). The system marginal cost is set by the unit(s) that are not at a limit. In this case, $\\lambda$ is set by Unit $1$.\n$\\lambda = IC_{1}(P_{1,t}^{\\star}) = 0.040(240) + 15.0 = 9.6 + 15.0 = 24.6$.\nThe incremental cost of Unit $2$ is:\n$IC_{2}(P_{2,t}^{\\star}) = 0.030(260) + 16.0 = 7.8 + 16.0 = 23.8$.\nAs required, $IC_{2}(P_{2,t}^{\\star}) < \\lambda$ ($23.8 < 24.6$), which confirms the optimality of this dispatch. If Unit $2$ were able to increase its output, it would be economically favorable to do so, but it is constrained by its effective capacity.\n\nThe optimal generation for Thermal Unit $1$ is $P_{1,t}^{\\star} = 240~\\text{MW}$.\nThe problem asks for the answer rounded to four significant figures. The value $240$ can be interpreted as having two or three significant figures. To express it with four, we write it as $240.0$.\n\nThe optimal generation of Thermal Unit $1$ is $P_{1,t}^{\\star} = 240.0~\\text{MW}$.",
            "answer": "$$\\boxed{240.0}$$"
        },
        {
            "introduction": "Real-world hydro-thermal scheduling spans long horizons with significant uncertainty in future water inflows, making simple deterministic models insufficient. This hands-on coding exercise  provides a practical introduction to Stochastic Dual Dynamic Programming (SDDP), the state-of-the-art method for solving such problems. By implementing a single forward and backward pass, you will demystify how SDDP iteratively builds policies (in the form of Benders cuts) that approximate the future value of water and guide optimal decisions under uncertainty.",
            "id": "4095233",
            "problem": "Consider a two-stage hydro-thermal coordination problem formulated for one iteration of Stochastic Dual Dynamic Programming (SDDP). The decision variables at each stage are the hydro release $r_t$, thermal generation $g_t$, spillage $s_t$, and storage $v_t$, each constrained to be nonnegative. The hydroelectric conversion is modeled by a constant factor $\\alpha$ so that hydro energy produced equals $\\alpha r_t$. Thermal generation has linear cost $c g_t$. The reservoir dynamics follow mass balance, and there are upper bounds on reservoir storage $V_{\\max}$ and on the hydro release $R_{\\max}$. All quantities are expressed in normalized units without physical dimensions. The uncertainty is in the stage-$2$ inflow and demand, with two equally likely scenarios (probability $0.5$ each). The stage-$1$ inflow and demand are deterministic. The objective is to perform a single SDDP iteration that consists of a forward pass to determine stage-$1$ decisions using the current cost-to-go approximation for stage-$2$ (initialized to zero), and a backward pass to compute one affine lower bound (a \"cut\") for the expected stage-$2$ cost-to-go at the storage $v_1$ reached in the forward pass.\n\nFundamentals:\n- Reservoir mass balance: for stage $t \\in \\{1,2\\}$, $v_t = v_{t-1} + I_t - r_t - s_t$, where $I_t$ is the inflow (scenario-dependent at stage $2$ and deterministic at stage $1$).\n- Demand balance: $g_t + \\alpha r_t \\ge D_t$.\n- Bounds: $0 \\le r_t \\le R_{\\max}$, $0 \\le v_t \\le V_{\\max}$, $s_t \\ge 0$, $g_t \\ge 0$.\n- Bellman optimality principle: the stage-$1$ problem minimizes immediate thermal cost plus the current approximation of the expected future cost; the stage-$2$ problem minimizes immediate thermal cost (no terminal value).\n- Convexity and duality: the expected stage-$2$ cost-to-go as a function of $v_1$ is convex and piecewise linear under linear constraints and costs. An affine lower bound (\"cut\") at $v_1$ is defined by a subgradient $a$ and intercept $b$ such that $\\widehat{J}_2(v) \\ge a v + b$ and $\\widehat{J}_2(v_1) = a v_1 + b$, where $\\widehat{J}_2$ is the expected optimal stage-$2$ cost.\n\nForward pass specification:\n- Use the current stage-$2$ cost-to-go approximation $\\widehat{J}_2(v) \\equiv 0$.\n- The forward stage-$1$ problem minimizes $c g_1$ subject to the constraints stated. If multiple minimizers exist, select the one with the smallest hydro release $r_1$.\n\nBackward pass specification:\n- At the visited storage $v_1$, solve both stage-$2$ scenario subproblems exactly to compute their optimal costs and then the expected cost $\\mathbb{E}[J_2(v_1)]$.\n- Compute one valid subgradient $a$ of the expected cost-to-go at $v_1$ by averaging scenario subgradients. For each scenario, the subgradient with respect to $v_1$ is $-c \\alpha$ when additional storage directly allows replacing thermal generation (that is, when $v_1 + I_2$ is strictly below the binding threshold $\\min(R_{\\max}, D_2/\\alpha)$), and $0$ otherwise. In the strict equality case, choose the subgradient $0$.\n- Set the cut intercept $b$ so that the cut passes through the expected cost at $v_1$, namely $b = \\mathbb{E}[J_2(v_1)] - a v_1$.\n\nYour program must implement this single SDDP iteration deterministically and output, for each test case, the list `[$C_1, r_1, g_1, v_1, a, b]`, where $C_1$ is the forward pass stage-$1$ immediate cost $c g_1$, $r_1$ is the forward hydro release, $g_1$ is the forward thermal generation, $v_1$ is the storage after stage 1, $a$ is the backward cut slope, and $b$ is the backward cut intercept. All quantities should be computed exactly in the normalized units given.\n\nTest suite:\n- Case $1$ (general \"happy path\" with thermal use in stage $2$): $\\alpha = 1.0$, $c = 10.0$, $V_{\\max} = 100$, $R_{\\max} = 40$, $v_0 = 30$, $I_1 = 20$, $D_1 = 50$, scenario $A$: $I_2^{(A)} = 15$, $D_2^{(A)} = 40$, scenario $B$: $I_2^{(B)} = 5$, $D_2^{(B)} = 40$.\n- Case $2$ (hydro suffices fully at stage $2$): $\\alpha = 1.0$, $c = 10.0$, $V_{\\max} = 200$, $R_{\\max} = 100$, $v_0 = 150$, $I_1 = 10$, $D_1 = 20$, scenario $A$: $I_2^{(A)} = 20$, $D_2^{(A)} = 100$, scenario $B$: $I_2^{(B)} = 70$, $D_2^{(B)} = 100$.\n- Case $3$ (mixed slope across scenarios): $\\alpha = 1.0$, $c = 20.0$, $V_{\\max} = 120$, $R_{\\max} = 30$, $v_0 = 40$, $I_1 = 15$, $D_1 = 30$, scenario $A$: $I_2^{(A)} = 4$, $D_2^{(A)} = 60$, scenario $B$: $I_2^{(B)} = 10$, $D_2^{(B)} = 25$.\n- Case $4$ (stage-$1$ spillage boundary): $\\alpha = 1.0$, $c = 5.0$, $V_{\\max} = 50$, $R_{\\max} = 10$, $v_0 = 45$, $I_1 = 20$, $D_1 = 5$, scenario $A$: $I_2^{(A)} = 5$, $D_2^{(A)} = 40$, scenario $B$: $I_2^{(B)} = 0$, $D_2^{(B)} = 8$.\n\nFinal output format:\n- Your program should produce a single line of output containing a list of the four case results, each result itself being a list $[C_1, r_1, g_1, v_1, a, b]$. The output must be formatted as a comma-separated list enclosed in square brackets, for example, `[[...],[...],[...],[...]]`. No other text should be printed.",
            "solution": "The problem is a well-defined two-stage stochastic optimization problem in the context of hydro-thermal power system scheduling. It requests a single iteration of the Stochastic Dual Dynamic Programming (SDDP) algorithm. The problem is scientifically sound, self-contained, and all data and constraints are provided. The validation is successful and we may proceed with the solution.\n\nThe solution process involves two main passes: a forward pass to determine the first-stage decisions and a backward pass to generate a new Benders cut (an affine lower bound on the expected future cost function).\n\n### Forward Pass: Stage 1\n\nThe objective in the first stage is to minimize the immediate operational cost plus the expected future cost. For this single iteration, the expected future cost function, $\\widehat{J}_2(v_1)$, is approximated as zero for all values of the final storage $v_1$.\nThe stage-1 problem is thus:\n$$ \\min_{r_1, g_1, s_1, v_1} c g_1 $$\nsubject to the constraints:\n1.  Demand balance: $g_1 + \\alpha r_1 \\ge D_1$\n2.  Reservoir mass balance: $v_1 = v_0 + I_1 - r_1 - s_1$\n3.  Decision variable bounds: $0 \\le r_1 \\le R_{\\max}$, $0 \\le v_1 \\le V_{\\max}$, $s_1 \\ge 0$, $g_1 \\ge 0$.\n\nSince the thermal cost coefficient $c$ is positive, minimizing $c g_1$ is equivalent to minimizing the thermal generation $g_1$. From the demand balance constraint, $g_1 \\ge D_1 - \\alpha r_1$. As $g_1$ must be non-negative, this can be written as $g_1 = \\max(0, D_1 - \\alpha r_1)$. To minimize $g_1$, we must maximize the hydro release $r_1$.\n\nHowever, the problem specifies a tie-breaking rule: if multiple solutions yield the same minimum cost, the one with the smallest hydro release $r_1$ must be chosen. This leads to the following logic for determining the optimal stage-1 release, $r_1$:\n\n1.  **Determine if demand can be met by hydro alone.** This is possible if there exists a feasible release $r_1$ such that $\\alpha r_1 \\ge D_1$, or $r_1 \\ge D_1/\\alpha$. A release $r_1$ is feasible if it respects the physical limits of the system. The maximum possible release, $r_{1, \\text{max\\_feasible}}$, is constrained by the turbine capacity $R_{\\max}$ and the total water available in the reservoir, $v_0 + I_1$. Thus, $r_{1, \\text{max\\_feasible}} = \\min(R_{\\max}, v_0 + I_1)$.\n\n2.  **Select optimal release $r_1$**:\n    *   If meeting demand with hydro is feasible (i.e., $D_1/\\alpha \\le r_{1, \\text{max\\_feasible}}$), any release $r_1 \\in [D_1/\\alpha, r_{1, \\text{max\\_feasible}}]$ results in $g_1 = 0$, the minimum possible thermal generation. According to the tie-breaking rule, we must select the smallest such release, so we set $r_1 = D_1/\\alpha$.\n    *   If demand cannot be fully met by hydro ($D_1/\\alpha > r_{1, \\text{max\\_feasible}}$), then $g_1 = D_1 - \\alpha r_1 > 0$ for all feasible $r_1$. To minimize $g_1$, we must maximize $r_1$. The unique maximizer is $r_1 = r_{1, \\text{max\\_feasible}}$.\n\n3.  **Determine other stage-1 variables**:\n    *   Thermal generation is $g_1 = \\max(0, D_1 - \\alpha r_1)$. The immediate cost is $C_1 = c g_1$.\n    *   The end-of-stage storage $v_1$ and spillage $s_1$ must satisfy $v_1 + s_1 = v_0 + I_1 - r_1$. Since the future cost function is zero, there is no explicit incentive to store water. We adopt the standard operational practice of minimizing spillage, which is equivalent to maximizing the end-of-stage storage $v_1$. The potential storage is $v'_1 = v_0 + I_1 - r_1$.\n        *   If $v'_1 > V_{\\max}$, the reservoir is full. Thus, $v_1 = V_{\\max}$ and spillage $s_1 = v'_1 - V_{\\max}$.\n        *   If $0 \\le v'_1 \\le V_{\\max}$, we can store all remaining water. Thus, $v_1 = v'_1$ and $s_1 = 0$.\n\nThis procedure uniquely determines all stage-1 decision variables: $[C_1, r_1, g_1, v_1]$.\n\n### Backward Pass: Stage 2\n\nThe backward pass computes a Benders cut (an affine function) that lower-bounds the true expected future cost function, $\\mathbb{E}[J_2(v_1)]$. The cut is of the form $\\mathbb{E}[J_2(v)] \\ge a v + b$, and it is constructed to be exact at the point $v_1$ visited in the forward pass.\n\nFor each stage-2 scenario $s \\in \\{A, B\\}$, we must solve the following deterministic subproblem to find the optimal cost $J_2(v_1, s)$:\n$$ J_2(v_1, s) = \\min_{r_2, g_2, s_2, v_2} c g_2^{(s)} $$\nsubject to stage-2 constraints, given the starting storage $v_1$.\n\n1.  **Solve Scenario Subproblems**: The objective is to minimize $c g_2^{(s)}$, which again implies maximizing the hydro release $r_2^{(s)}$. The maximum feasible release is $r_{2, \\text{max\\_feasible}}^{(s)} = \\min(R_{\\max}, v_1 + I_2^{(s)})$.\n    *   The optimal release is $r_2^{(s)} = r_{2, \\text{max\\_feasible}}^{(s)}$.\n    *   The optimal thermal generation is $g_2^{(s)} = \\max(0, D_2^{(s)} - \\alpha r_2^{(s)})$.\n    *   The cost for scenario $s$ is $J_2(v_1, s) = c g_2^{(s)}$.\n\n2.  **Compute the Expected Cost**: With scenarios being equally likely (probability $p=0.5$), the expected cost is $\\mathbb{E}[J_2(v_1)] = 0.5 \\cdot J_2(v_1, A) + 0.5 \\cdot J_2(v_1, B)$.\n\n3.  **Compute the Cut Slope (Subgradient)**: The slope $a$ of the cut is the expected value of the scenario subgradients. A subgradient $a^{(s)}$ of $J_2(v_1, s)$ with respect to $v_1$ represents the marginal value of water. An additional unit of water reduces cost by $c\\alpha$ if it can be used to displace thermal generation. This is possible only if the system has both remaining turbine capacity and unmet demand that can be served by hydro.\n    The problem specifies the formula:\n    $$ a^{(s)} = \\begin{cases} -c \\alpha & \\text{if } v_1 + I_2^{(s)} < \\min(R_{\\max}, D_2^{(s)}/\\alpha) \\\\ 0 & \\text{otherwise} \\end{cases} $$\n    This condition checks if the total water available, $v_1 + I_2^{(s)}$, is less than the amount that can be usefully released through the turbines. If it is less, marginal water has a value of $c\\alpha$, and the subgradient is $-c\\alpha$. Otherwise, the marginal water has zero value for the current stage, and the subgradient is $0$.\n    The overall slope is the expectation: $a = 0.5 \\cdot a^{(A)} + 0.5 \\cdot a^{(B)}$.\n\n4.  **Compute the Cut Intercept**: The intercept $b$ is chosen so that the affine function is exact at $v_1$: $\\mathbb{E}[J_2(v_1)] = a v_1 + b$. This gives $b = \\mathbb{E}[J_2(v_1)] - a v_1$.\n\nThis procedure determines the cut parameters $[a, b]$, completing the single SDDP iteration. The algorithm is implemented for each test case to produce the required output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the given hydro-thermal coordination problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: alpha, c, V_max, R_max, v0, I1, D1, I2A, D2A, I2B, D2B\n        (1.0, 10.0, 100.0, 40.0, 30.0, 20.0, 50.0, 15.0, 40.0, 5.0, 40.0),\n        # Case 2\n        (1.0, 10.0, 200.0, 100.0, 150.0, 10.0, 20.0, 20.0, 100.0, 70.0, 100.0),\n        # Case 3\n        (1.0, 20.0, 120.0, 30.0, 40.0, 15.0, 30.0, 4.0, 60.0, 10.0, 25.0),\n        # Case 4\n        (1.0, 5.0, 50.0, 10.0, 45.0, 20.0, 5.0, 5.0, 40.0, 0.0, 8.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_sddp_iteration(case)\n        results.append(result)\n\n    # Format the final output string exactly as required.\n    # e.g., \"[[C1,r1,...],[C1,r1,...]]\"\n    results_as_strings = [f\"[{','.join(map(str, res))}]\" for res in results]\n    final_output = f\"[{','.join(results_as_strings)}]\"\n    print(final_output)\n\ndef run_sddp_iteration(params):\n    \"\"\"\n    Performs a single SDDP iteration (forward and backward pass) for one test case.\n\n    Args:\n        params (tuple): A tuple containing all parameters for the test case.\n\n    Returns:\n        list: A list of the calculated values [C1, r1, g1, v1, a, b].\n    \"\"\"\n    alpha, c, V_max, R_max, v0, I1, D1, I2A, D2A, I2B, D2B = params\n\n    # FORWARD PASS (Stage 1)\n    \n    # Water available in stage 1\n    water_available_1 = v0 + I1\n    \n    # Release required to meet demand D1 with hydro only\n    r_target = D1 / alpha\n    \n    # Maximum feasible release in stage 1\n    r_max_feasible = min(R_max, water_available_1)\n\n    r1, g1 = 0.0, 0.0\n    if r_target = r_max_feasible:\n        # Minimum cost (g1=0) is achievable. By tie-breaking rule, use smallest r1.\n        r1 = r_target\n        g1 = 0.0\n    else:\n        # Minimum cost requires maximizing r1, as g1 > 0.\n        r1 = r_max_feasible\n        g1 = D1 - alpha * r1\n\n    C1 = c * g1\n\n    # Determine end-of-stage storage v1 by maximizing storage (minimizing spillage)\n    v_potential = v0 + I1 - r1\n    v1 = 0.0\n    if v_potential > V_max:\n        v1 = V_max\n    else:\n        v1 = v_potential\n\n    # BACKWARD PASS (Stage 2)\n    \n    # Scenario A\n    water_available_2A = v1 + I2A\n    r2_opt_A = min(R_max, water_available_2A)\n    g2_A = max(0.0, D2A - alpha * r2_opt_A)\n    cost_A = c * g2_A\n    \n    threshold_A = min(R_max, D2A / alpha)\n    slope_A = -c * alpha if (v1 + I2A)  threshold_A else 0.0\n\n    # Scenario B\n    water_available_2B = v1 + I2B\n    r2_opt_B = min(R_max, water_available_2B)\n    g2_B = max(0.0, D2B - alpha * r2_opt_B)\n    cost_B = c * g2_B\n\n    threshold_B = min(R_max, D2B / alpha)\n    slope_B = -c * alpha if (v1 + I2B)  threshold_B else 0.0\n\n    # Calculate the Benders cut parameters (a, b)\n    # The scenarios have equal probability of 0.5\n    expected_future_cost = 0.5 * cost_A + 0.5 * cost_B\n    a = 0.5 * slope_A + 0.5 * slope_B\n    b = expected_future_cost - a * v1\n    \n    return [C1, r1, g1, v1, a, b]\n\nsolve()\n```"
        }
    ]
}