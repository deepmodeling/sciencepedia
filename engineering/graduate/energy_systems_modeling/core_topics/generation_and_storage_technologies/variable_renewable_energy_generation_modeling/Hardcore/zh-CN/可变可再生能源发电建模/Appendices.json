{
    "hands_on_practices": [
        {
            "introduction": "精确预测风机轮毂高度处的风速是风能建模的第一步，也是项目可行性评估的核心。本练习将引导你从大气边界层物理学的基本原理出发，推导出对数风廓线这一微观选址的基石工具。你将运用该模型()，在一个包含地形影响的实际场景中，学习如何从参考高度的风速测量值推算轮毂高度的风速，从而掌握连接理论与实际资源评估的关键技能。",
            "id": "4134886",
            "problem": "一个风力涡轮机场址的特征是其上游具有水平均质的地表，粗糙度长度为 $z_{0}$，且大气稳定度为中性。气象塔上的一台校准过的杯式风速计报告了离地参考高度 $z_{\\mathrm{ref}}$ 处的 $10$ 分钟平均水平风速 $U_{\\mathrm{ref}}$。涡轮机轮毂高度为 $z_{h}$。在场址附近，气流遇到一个平缓的二维山脊，其脊顶与涡轮机排平行，因此平均气流垂直于山脊。该山脊相对于周围平原的几何高度为 $H$，上风向坡长尺度为 $L$（定义为高程从平原上升到脊顶的水平距离），且 $H/L \\ll 1$。假设平原上和山脊上的粗糙度长度相同，且位移高度可忽略不计。\n\n从中性分层、定常、水平均质的湍流边界层在粗糙地表上流动的以下基本原理出发：\n- 垂直湍流动量通量（切应力）不随高度变化，可表示为 $\\tau = \\rho\\,u_{*}^{2}$，其中 $\\rho$ 是空气密度， $u_{*}$ 是摩擦速度，\n- 采用涡黏性（动量扩散率）$K_{m}$ 和通量-梯度关系 $\\tau = \\rho\\,K_{m}\\,\\frac{\\mathrm{d}U}{\\mathrm{d}z}$ 的一阶闭合，\n- 在中性稳定度下，根据混合长度理论得出 $K_{m} = \\kappa\\,u_{*}\\,z$，\n\n推导出平坦地形上的平均风速廓线 $U(z)$，并利用给定的 $z_{0}$ 和在 $z_{\\mathrm{ref}}$ 处测得的 $U_{\\mathrm{ref}}$，计算平坦地形上的轮毂高度风速 $U_{\\mathrm{flat}}(z_{h})$。然后，为考虑山脊顶部的地形加速效应，采用一个适用于中性条件下平缓二维山脊的简单线性地形加速模型，其中脊顶的分数加速比与上风向坡度成正比，\n$$S = c\\,\\frac{H}{L},$$\n比例常数 $c = 2.0$。将脊顶处的轮毂高度风速估计为 $U_{\\mathrm{crest}}(z_{h}) = U_{\\mathrm{flat}}(z_{h})\\,(1+S)$。\n\n使用以下数值：\n- $\\kappa = 0.40$,\n- $U_{\\mathrm{ref}} = 7.50~\\mathrm{m}\\,\\mathrm{s}^{-1}$ 于 $z_{\\mathrm{ref}} = 10~\\mathrm{m}$,\n- $z_{0} = 0.050~\\mathrm{m}$,\n- $z_{h} = 120~\\mathrm{m}$,\n- $H = 40.0~\\mathrm{m}$,\n- $L = 400.0~\\mathrm{m}$.\n\n计算 $U_{\\mathrm{crest}}(z_{h})$，并以 $\\mathrm{m}\\,\\mathrm{s}^{-1}$ 为单位表示您的最终答案。将答案四舍五入到四位有效数字。",
            "solution": "问题陈述已解析和验证。\n\n### 第1步：提取给定条件\n- 上游地表粗糙度长度：$z_{0}$\n- 大气稳定度：中性\n- 参考平均水平风速：$U_{\\mathrm{ref}}$，在参考高度 $z_{\\mathrm{ref}}$\n- 涡轮机轮毂高度：$z_{h}$\n- 山脊几何高度：$H$\n- 山脊上风向坡长尺度：$L$\n- 条件：$H/L \\ll 1$\n- 假设：粗糙度长度均匀。\n- 假设：位移高度可忽略。\n- 基本原理1：垂直湍流动量通量（切应力）为 $\\tau = \\rho\\,u_{*}^{2}$，其中 $\\rho$ 为空气密度， $u_{*}$ 为摩擦速度。$\\tau$ 不随高度变化。\n- 基本原理2：通量-梯度关系为 $\\tau = \\rho\\,K_{m}\\,\\frac{\\mathrm{d}U}{\\mathrm{d}z}$，其中 $K_{m}$ 为涡黏性。\n- 基本原理3：涡黏性的混合长度模型为 $K_{m} = \\kappa\\,u_{*}\\,z$。\n- 地形加速模型：脊顶的分数加速比为 $S = c\\,\\frac{H}{L}$。\n- 脊顶处的轮毂高度风速：$U_{\\mathrm{crest}}(z_{h}) = U_{\\mathrm{flat}}(z_{h})\\,(1+S)$。\n- 数值：\n    - von Kármán 常数, $\\kappa = 0.40$\n    - $U_{\\mathrm{ref}} = 7.50~\\mathrm{m}\\,\\mathrm{s}^{-1}$\n    - $z_{\\mathrm{ref}} = 10~\\mathrm{m}$\n    - $z_{0} = 0.050~\\mathrm{m}$\n    - $z_{h} = 120~\\mathrm{m}$\n    - $H = 40.0~\\mathrm{m}$\n    - $L = 400.0~\\mathrm{m}$\n    - 比例常数, $c = 2.0$\n\n### 第2步：使用提取的给定条件进行验证\n该问题具有科学依据，提法恰当且客观。它基于大气边界层物理学的标准、成熟原理（对数风廓线）以及一个常见的、简化的平缓地形上流动的模型（线性理论）。该问题是自洽的，提供了所有必要的物理假设和数值数据。条件 $H/L = 40.0/400.0 = 0.1 \\ll 1$ 得到满足，这为使用线性加速模型提供了依据。所提供的值在风资源评估的背景下是物理上现实的。该问题不是病态的、矛盾的或微不足道的。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n首要任务是根据所提供的关于中性分层、定常、水平均质湍流边界层的基本原理，推导出平坦地形上的平均风速廓线 $U(z)$。\n\n我们有两个关于切应力 $\\tau$ 的表达式：\n$$\n\\tau = \\rho\\,u_{*}^{2}\n$$\n和\n$$\n\\tau = \\rho\\,K_{m}\\,\\frac{\\mathrm{d}U}{\\mathrm{d}z}\n$$\n将这两个表达式相等，并除以空气密度 $\\rho$，得到：\n$$\nu_{*}^{2} = K_{m}\\,\\frac{\\mathrm{d}U}{\\mathrm{d}z}\n$$\n接下来，我们代入给定的涡黏性混合长度模型，$K_{m} = \\kappa\\,u_{*}\\,z$：\n$$\nu_{*}^{2} = (\\kappa\\,u_{*}\\,z)\\,\\frac{\\mathrm{d}U}{\\mathrm{d}z}\n$$\n假设摩擦速度不为零（$u_{*} > 0$），我们可以除以 $u_{*}$：\n$$\nu_{*} = \\kappa\\,z\\,\\frac{\\mathrm{d}U}{\\mathrm{d}z}\n$$\n这是一个关于风速 $U$ 作为高度 $z$ 的函数的可分离一阶常微分方程。我们重新整理它以便积分：\n$$\n\\mathrm{d}U = \\frac{u_{*}}{\\kappa}\\,\\frac{\\mathrm{d}z}{z}\n$$\n为了找到廓线 $U(z)$，我们对该方程进行积分。粗糙地表上流动的边界条件是，风速在外推至粗糙度长度时为零，即 $U(z_{0}) = 0$。我们从粗糙度高度 $z_{0}$ 积分到一个任意高度 $z$：\n$$\n\\int_{0}^{U(z)} \\mathrm{d}U' = \\int_{z_{0}}^{z} \\frac{u_{*}}{\\kappa}\\,\\frac{\\mathrm{d}z'}{z'}\n$$\n由于在此模型中 $u_{*}$ 和 $\\kappa$ 不随高度变化，我们有：\n$$\nU(z) = \\frac{u_{*}}{\\kappa} \\int_{z_{0}}^{z} \\frac{1}{z'}\\,\\mathrm{d}z' = \\frac{u_{*}}{\\kappa} [\\ln(z')]_{z_0}^{z}\n$$\n$$\nU(z) = \\frac{u_{*}}{\\kappa} (\\ln(z) - \\ln(z_{0}))\n$$\n利用对数的性质，我们得到对数风廓线：\n$$\nU(z) = \\frac{u_{*}}{\\kappa} \\ln\\left(\\frac{z}{z_{0}}\\right)\n$$\n该廓线描述了平坦地形上的风速，我们将其记为 $U_{\\mathrm{flat}}(z)$。\n\n下一步是利用在高度 $z_{\\mathrm{ref}}$ 处测得的风速 $U_{\\mathrm{ref}}$ 来确定此平坦地形上轮毂高度 $z_{h}$ 处的风速 $U_{\\mathrm{flat}}(z_h)$。我们有两个对数廓线的实例：\n在参考高度处：$U_{\\mathrm{ref}} = U_{\\mathrm{flat}}(z_{\\mathrm{ref}}) = \\frac{u_{*}}{\\kappa} \\ln\\left(\\frac{z_{\\mathrm{ref}}}{z_{0}}\\right)$\n在轮毂高度处：$U_{\\mathrm{flat}}(z_{h}) = \\frac{u_{*}}{\\kappa} \\ln\\left(\\frac{z_{h}}{z_{0}}\\right)$\n\n为了在不显式计算中间参数 $u_{*}$ 的情况下求得 $U_{\\mathrm{flat}}(z_{h})$，我们可以取这两个方程的比值：\n$$\n\\frac{U_{\\mathrm{flat}}(z_{h})}{U_{\\mathrm{ref}}} = \\frac{\\frac{u_{*}}{\\kappa} \\ln\\left(\\frac{z_h}{z_0}\\right)}{\\frac{u_{*}}{\\kappa} \\ln\\left(\\frac{z_{\\mathrm{ref}}}{z_0}\\right)} = \\frac{\\ln\\left(z_h / z_0\\right)}{\\ln\\left(z_{\\mathrm{ref}} / z_0\\right)}\n$$\n由此，我们可以解出 $U_{\\mathrm{flat}}(z_{h})$：\n$$\nU_{\\mathrm{flat}}(z_{h}) = U_{\\mathrm{ref}} \\frac{\\ln\\left(z_{h} / z_0\\right)}{\\ln\\left(z_{\\mathrm{ref}} / z_0\\right)}\n$$\n现在我们代入给定的数值：$U_{\\mathrm{ref}} = 7.50~\\mathrm{m}\\,\\mathrm{s}^{-1}$，$z_{\\mathrm{ref}} = 10~\\mathrm{m}$，$z_{h} = 120~\\mathrm{m}$，以及 $z_{0} = 0.050~\\mathrm{m}$。\n$$\n\\frac{z_{h}}{z_{0}} = \\frac{120}{0.050} = 2400\n$$\n$$\n\\frac{z_{\\mathrm{ref}}}{z_{0}} = \\frac{10}{0.050} = 200\n$$\n将这些值代入 $U_{\\mathrm{flat}}(z_h)$ 的方程中：\n$$\nU_{\\mathrm{flat}}(z_{h}) = 7.50 \\times \\frac{\\ln(2400)}{\\ln(200)} \\approx 7.50 \\times \\frac{7.78322}{5.29832} \\approx 7.50 \\times 1.46898 \\approx 11.01735~\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\n接下来，我们计算由山脊引起的分数加速比 $S$。给定的模型是 $S = c\\,\\frac{H}{L}$。我们代入数值 $c = 2.0$，$H = 40.0~\\mathrm{m}$ 和 $L = 400.0~\\mathrm{m}$：\n$$\nS = 2.0 \\times \\frac{40.0}{400.0} = 2.0 \\times 0.1 = 0.2\n$$\n问题陈述指出，脊顶处的轮毂高度风速 $U_{\\mathrm{crest}}(z_{h})$ 由公式 $U_{\\mathrm{crest}}(z_{h}) = U_{\\mathrm{flat}}(z_{h})\\,(1+S)$ 给出。\n我们使用刚刚计算出的 $U_{\\mathrm{flat}}(z_{h})$ 和 $S$ 的值：\n$$\nU_{\\mathrm{crest}}(z_{h}) = 11.01735 \\times (1 + 0.2) = 11.01735 \\times 1.2\n$$\n$$\nU_{\\mathrm{crest}}(z_{h}) \\approx 13.22082~\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\n问题要求将最终答案四舍五入到四位有效数字。\n$$\nU_{\\mathrm{crest}}(z_{h}) \\approx 13.22~\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$",
            "answer": "$$\n\\boxed{13.22}\n$$"
        },
        {
            "introduction": "现实世界中，光伏系统的性能常常因局部遮挡等非理想条件而偏离理论值。本练习要求你构建一个精细的、基于物理的光伏组串模型，以模拟其在遮挡下的复杂非线性行为，特别是旁路二极管的关键作用。通过量化“失配损失”()，你将深入理解不均匀辐照度如何影响系统输出，并认识到组件级分析对于精确发电量建模的重要性。",
            "id": "4134879",
            "problem": "您的任务是使用一种基于物理原理的方法，对局部遮挡下的光伏组串的可变可再生能源发电进行建模。考虑一个由串联的子组串组成的光伏组串，每个子组串包含一系列相同的光伏电池和一个反并联的旁路二极管。其物理行为必须使用经典的单二极管光伏电池模型、基尔霍夫电流定律 (KCL) 和基尔霍夫电压定律 (KVL) 以及旁路二极管的分段导通模型来表示。您的程序必须实现一个数值稳定的算法，该算法能够聚合子组串的电流-电压行为以形成组串的电流-电压曲线，识别组串的最大功率点，并量化相对于独立优化子组串的失配损耗。\n\n基本原理和定义：\n- 每个光伏电池均由半导体输运理论和肖克利二极管方程推导出的单二极管方程建模。根据 KCL，电池电流作为电池端电压的函数被隐式定义为 $I = I_{\\mathrm{ph}} - I_{0}\\left(\\exp\\left(\\frac{V_{\\mathrm{cell}} + I R_{\\mathrm{s}}}{n V_{\\mathrm{T}}}\\right) - 1\\right) - \\frac{V_{\\mathrm{cell}} + I R_{\\mathrm{s}}}{R_{\\mathrm{sh}}}$，其中 $I$ 是端电流，$V_{\\mathrm{cell}}$ 是端电压，$I_{\\mathrm{ph}}$ 是光生电流，$I_{0}$ 是二极管饱和电流，$R_{\\mathrm{s}}$ 是串联电阻，$R_{\\mathrm{sh}}$ 是并联电阻，$n$ 是二极管理想因子，$V_{\\mathrm{T}}$ 是热电压 $V_{\\mathrm{T}} = \\frac{k_{\\mathrm{B}} T}{q}$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度，$q$ 是元电荷。对于给定的 $I$，必须通过求解关于 $V_{\\mathrm{cell}}$ 的隐式非线性方程来找到相应的 $V_{\\mathrm{cell}}(I)$。\n- 在每个子组串内，相同的电池串联连接，因此根据 KCL，所有串联电池中的电流 $I$ 均相同。根据 KVL，没有旁路导通时，子组串的光伏电压为 $V_{\\mathrm{sub,PV}}(I) = N_{\\mathrm{cell}} \\, V_{\\mathrm{cell}}(I)$，其中 $N_{\\mathrm{cell}}$ 是每个子组串的串联电池数量。\n- 旁路二极管与子组串反并联连接。其导通被分段建模：当子组串的净电压变得比二极管正向阈值更负时，二极管导通并将子组串电压钳位在 $V_{\\mathrm{sub,BD}}(I) = -V_{\\mathrm{BD}} - I R_{\\mathrm{BD}}$，其中 $V_{\\mathrm{BD}}$ 是正向阈值电压，$R_{\\mathrm{BD}}$ 是二极管串联电阻。因此，子组串的端电压为 $V_{\\mathrm{sub}}(I) = \\max\\left(V_{\\mathrm{sub,PV}}(I), \\; -V_{\\mathrm{BD}} - I R_{\\mathrm{BD}}\\right)$，当 $V_{\\mathrm{sub,PV}}(I)  -V_{\\mathrm{BD}}$ 时，认为旁路二极管导通。\n- 子组串串联形成组串，因此根据 KVL，对于电流 $I$，组串电压为 $V_{\\mathrm{string}}(I) = \\sum_{s=1}^{N_{\\mathrm{sub}}} V_{\\mathrm{sub},s}(I)$，其中 $N_{\\mathrm{sub}}$ 是子组串的数量。组串功率为 $P_{\\mathrm{string}}(I) = I \\, V_{\\mathrm{string}}(I)$。\n- 独立优化的功率基准定义为每个子组串在其各自最优电流下独立工作时最大功率的总和，$P_{\\mathrm{ind}} = \\sum_{s=1}^{N_{\\mathrm{sub}}} \\max_{I \\ge 0} \\left(I \\, V_{\\mathrm{sub},s}(I)\\right)$。失配损耗是分数 $L = 1 - \\frac{P_{\\mathrm{string,MPP}}}{P_{\\mathrm{ind}}}$，其中 $P_{\\mathrm{string,MPP}} = \\max_{I \\ge 0} P_{\\mathrm{string}}(I)$。\n\n实现要求：\n- 构建一个算法，对于给定的电流 $I$，使用稳健的数值求根方法求解单二极管隐式方程，为每一组唯一的电池参数计算 $V_{\\mathrm{cell}}(I)$，然后聚合到 $V_{\\mathrm{sub,PV}}(I)$ 并应用旁路二极管分段规则得到 $V_{\\mathrm{sub}}(I)$。最后，将子组串串联聚合形成 $V_{\\mathrm{string}}(I)$ 并计算 $P_{\\mathrm{string}}(I)$。在物理上合理的范围内进行电流扫描，以确定组串和每个独立子组串的最大值。扫描边界必须根据光生电流的大小从第一性原理中选择。\n- 对于每个测试用例，计算：\n  1. 失配损耗 $L$，以小数形式表示，四舍五入到四位小数（无百分号）。\n  2. 在组串最大功率点时，处于导通状态的旁路二极管的数量，以整数表示。\n\n单位：\n- 电流以安培（$\\mathrm{A}$）表示，电压以伏特（$\\mathrm{V}$）表示，功率以瓦特（$\\mathrm{W}$）表示。输出值对于损耗是无量纲的，对于计数是整数值的，但所有内部计算必须一致地使用这些单位。\n\n测试套件规范：\n- 所有测试用例共享以下固定参数：$N_{\\mathrm{sub}} = 3$，$N_{\\mathrm{cell}} = 18$，$I_{0} = 1.0 \\times 10^{-9} \\, \\mathrm{A}$，$n = 1.2$，$R_{\\mathrm{s}} = 0.005 \\, \\Omega$，$R_{\\mathrm{sh}} = 1000 \\, \\Omega$，$T = 298 \\, \\mathrm{K}$，$R_{\\mathrm{BD}} = 0.02 \\, \\Omega$。\n- 旁路二极管阈值 $V_{\\mathrm{BD}}$ 和每个子组串的光生电流向量 $\\left[I_{\\mathrm{ph},1}, I_{\\mathrm{ph},2}, I_{\\mathrm{ph},3}\\right]$ 因情况而异：\n  - 情况 $1$（均匀辐照度，理想情况）：$V_{\\mathrm{BD}} = 0.6 \\, \\mathrm{V}$，$\\left[I_{\\mathrm{ph},1}, I_{\\mathrm{ph},2}, I_{\\mathrm{ph},3}\\right] = [8.0, 8.0, 8.0] \\, \\mathrm{A}$。\n  - 情况 $2$（一个子组串有中度局部遮挡）：$V_{\\mathrm{BD}} = 0.6 \\, \\mathrm{V}$，$\\left[I_{\\mathrm{ph},1}, I_{\\mathrm{ph},2}, I_{\\mathrm{ph},3}\\right] = [8.0, 6.0, 8.0] \\, \\mathrm{A}$。\n  - 情况 $3$（严重遮挡导致旁路导通）：$V_{\\mathrm{BD}} = 0.6 \\, \\mathrm{V}$，$\\left[I_{\\mathrm{ph},1}, I_{\\mathrm{ph},2}, I_{\\mathrm{ph},3}\\right] = [8.0, 1.0, 8.0] \\, \\mathrm{A}$。\n  - 情况 $4$（阈值边缘灵敏度）：$V_{\\mathrm{BD}} = 0.3 \\, \\mathrm{V}$，$\\left[I_{\\mathrm{ph},1}, I_{\\mathrm{ph},2}, I_{\\mathrm{ph},3}\\right] = [8.0, 2.5, 8.0] \\, \\mathrm{A}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。该列表必须按顺序包含情况 $1$ 到 $4$ 的结果，即四舍五入到四位小数的失配损耗，后跟该情况下组串最大功率点时导通的旁路二极管的整数数量。例如，输出格式为 $\\left[ L_{1}, C_{1}, L_{2}, C_{2}, L_{3}, C_{3}, L_{4}, C_{4} \\right]$，其中 $L_{k}$ 是浮点数，$C_{k}$ 是整数。",
            "solution": "该问题经评估有效。其科学基础是已确立的光伏电池单二极管模型和基尔霍夫电路定律。问题阐述清晰，提供了所有必要的参数以及一套明确、客观的定义和计算目标。所提供的参数对于硅光伏技术是物理上现实的。因此，下面将给出完整的解决方案。\n\n解决方案首先建立基本的物理模型和常数，然后开发用于求解控制方程的数值算法，最后将这些算法应用于指定的测试用例。\n\n**1. 基本常数和参数**\n\n该模型依赖于两个基本物理常数：\n- 玻尔兹曼常数，$k_{\\mathrm{B}} \\approx 1.380649 \\times 10^{-23} \\, \\mathrm{J/K}$。\n- 元电荷，$q \\approx 1.60217663 \\times 10^{-19} \\, \\mathrm{C}$。\n\n给定的绝对温度为 $T = 298 \\, \\mathrm{K}$。由此计算出热电压 $V_{\\mathrm{T}}$：\n$$V_{\\mathrm{T}} = \\frac{k_{\\mathrm{B}} T}{q}$$\n代入数值，我们得到 $V_{\\mathrm{T}} \\approx \\frac{(1.380649 \\times 10^{-23} \\, \\mathrm{J/K}) \\cdot (298 \\, \\mathrm{K})}{1.60217663 \\times 10^{-19} \\, \\mathrm{C}} \\approx 0.025679 \\, \\mathrm{V}$。\n\n在所有测试用例中固定的模型参数是：\n- 子组串数量，$N_{\\mathrm{sub}} = 3$。\n- 每个子组串的电池数量，$N_{\\mathrm{cell}} = 18$。\n- 二极管饱和电流，$I_{0} = 1.0 \\times 10^{-9} \\, \\mathrm{A}$。\n- 二极管理想因子，$n = 1.2$。\n- 电池串联电阻，$R_{\\mathrm{s}} = 0.005 \\, \\Omega$。\n- 电池并联电阻，$R_{\\mathrm{sh}} = 1000 \\, \\Omega$。\n- 旁路二极管串联电阻，$R_{\\mathrm{BD}} = 0.02 \\, \\Omega$。\n\n**2. 电池电压计算**\n\n模型的核心是单个光伏电池的单二极管方程，它隐式地关联了电池的端电流 $I$ 和端电压 $V_{\\mathrm{cell}}$：\n$$I = I_{\\mathrm{ph}} - I_{0}\\left(\\exp\\left(\\frac{V_{\\mathrm{cell}} + I R_{\\mathrm{s}}}{n V_{\\mathrm{T}}}\\right) - 1\\right) - \\frac{V_{\\mathrm{cell}} + I R_{\\mathrm{s}}}{R_{\\mathrm{sh}}}$$\n为了找到给定电流 $I$ 和光生电流 $I_{\\mathrm{ph}}$ 下的电压 $V_{\\mathrm{cell}}$，必须求解该方程以得到 $V_{\\mathrm{cell}}$。我们将其重新排列为一个求根问题 $f(V_{\\mathrm{cell}}) = 0$：\n$$f(V_{\\mathrm{cell}}) = I_{\\mathrm{ph}} - I_{0}\\left(\\exp\\left(\\frac{V_{\\mathrm{cell}} + I R_{\\mathrm{s}}}{n V_{\\mathrm{T}}}\\right) - 1\\right) - \\frac{V_{\\mathrm{cell}} + I R_{\\mathrm{s}}}{R_{\\mathrm{sh}}} - I = 0$$\n这是一个需要数值方法求解的超越方程。为了提高数值稳定性，我们可以将结电压定义为 $V_{\\mathrm{j}} = V_{\\mathrm{cell}} + I R_{\\mathrm{s}}$，并首先求解 $V_{\\mathrm{j}}$：\n$$g(V_{\\mathrm{j}}) = I_{\\mathrm{ph}} - I_{0}\\left(\\exp\\left(\\frac{V_{\\mathrm{j}}}{n V_{\\mathrm{T}}}\\right) - 1\\right) - \\frac{V_{\\mathrm{j}}}{R_{\\mathrm{sh}}} - I = 0$$\n函数 $g(V_{\\mathrm{j}})$ 是单调的，确保了唯一解的存在。像 Brent-Dekker 方法（`brentq`）这样的稳健数值求根器适用于此任务，因为我们可以为解确定区间。一旦找到 $V_{\\mathrm{j}}$，电池电压就可以通过 $V_{\\mathrm{cell}} = V_{\\mathrm{j}} - I R_{\\mathrm{s}}$ 恢复。\n\n**3. 子组串和组串模型聚合**\n\n模型是分层构建的：电池构成子组串，子组串构成组串。\n- **子组串电压**：一个子组串内的所有 $N_{\\mathrm{cell}}$ 个电池都是串联的，并被假定为相同的（除了它们共享的 $I_{\\mathrm{ph}}$）。根据 KVL，对于电流 $I$，光伏电池在子组串中产生的总电压为 $V_{\\mathrm{sub,PV}}(I) = N_{\\mathrm{cell}} \\, V_{\\mathrm{cell}}(I)$。\n- **旁路二极管作用**：反并联的旁路二极管为电流提供了另一条路径。其效应被建模为电压钳位。子组串端电压 $V_{\\mathrm{sub}}(I)$ 是光伏电池产生的电压和导通的旁路二极管两端电压中的最大值：\n$$V_{\\mathrm{sub}}(I) = \\max\\left(V_{\\mathrm{sub,PV}}(I), \\; -V_{\\mathrm{BD}} - I R_{\\mathrm{BD}}\\right)$$\n旁路二极管被定义为在光伏电压变得比二极管正向压降更负时导通，即 $V_{\\mathrm{sub,PV}}(I)  -V_{\\mathrm{BD}}$。这个条件是确定在给定工作电流下哪些子组串被旁路的关键。\n- **组串电压**：$N_{\\mathrm{sub}}$ 个子组串串联连接。根据 KVL，总组串电压是各个子组串电压的总和：\n$$V_{\\mathrm{string}}(I) = \\sum_{s=1}^{N_{\\mathrm{sub}}} V_{\\mathrm{sub},s}(I)$$\n然后，组串提供的功率为 $P_{\\mathrm{string}}(I) = I \\cdot V_{\\mathrm{string}}(I)$。\n\n**4. 功率最大化和失配损耗**\n\n为了确定运行特性和损耗，我们必须找到完整组串以及每个独立工作的子组串的最大功率点 (MPP)。\n\n- **MPP 搜索**：这通过在相关范围内扫描电流 $I$ 并计算每一步的功率来实现。一个合适的扫描范围是从 $I=0$（开路条件）到一个略大于系统中最大可能光生电流 $\\max_{s}(I_{\\mathrm{ph},s})$ 的值，以确保覆盖短路区域。我们生成一个细粒度的电流值数组，并计算相应的功率曲线 $P(I) = I \\cdot V(I)$。该数组中的最大值是 MPP 的精确近似。\n- **组串 MPP**：组串的最大功率点 $P_{\\mathrm{string,MPP}}$ 通过最大化 $P_{\\mathrm{string}}(I)$ 找到：\n$$P_{\\mathrm{string,MPP}} = \\max_{I \\ge 0} P_{\\mathrm{string}}(I)$$\n出现此最大值时的电流表示为 $I_{\\mathrm{MPP}}$。\n- **独立功率基准**：用于比较的基准 $P_{\\mathrm{ind}}$ 是如果每个子组串都能在其自己独立的 MPP 下工作时可实现的最大理论功率。这是每个子组串最大功率的总和：\n$$P_{\\mathrm{ind}} = \\sum_{s=1}^{N_{\\mathrm{sub}}} \\max_{I \\ge 0} \\left(I \\, V_{\\mathrm{sub},s}(I)\\right)$$\n- **失配损耗**：失配损耗 $L$ 量化了由于串联连接迫使所有子组串使用单一工作电流而导致的功率降低，表示为理想独立功率的一部分：\n$$L = 1 - \\frac{P_{\\mathrm{string,MPP}}}{P_{\\mathrm{ind}}}$$\n\n**5. 算法实现**\n\n对于每个测试用例，总体算法如下：\n1.  定义一个离散的电流值网格 `I_sweep`，范围从 $0$ 到 $\\max(I_{\\mathrm{ph,all}}) \\times 1.05$。一个包含 $10000$ 个点的网格提供了足够的分辨率。\n2.  初始化一个变量 `P_ind_sum` 为 $0$。\n3.  对于每个子组串 $s \\in \\{1, 2, 3\\}$：\n    a. 对于 `I_sweep` 中的每个电流 `I`，使用数值求根器计算 $V_{\\mathrm{cell}}(I)$，然后计算 $V_{\\mathrm{sub,PV},s}(I)$ 和 $V_{\\mathrm{sub},s}(I)$。这将生成子组串的完整 I-V 曲线。\n    b. 计算子组串的功率曲线 $P_{\\mathrm{sub},s}(I) = I \\cdot V_{\\mathrm{sub},s}(I)$。\n    c. 找到该功率曲线的最大值 $P_{\\mathrm{sub},s,\\mathrm{MPP}}$，并将其加到 `P_ind_sum` 中。\n4.  将各个子组串的电压曲线 $V_{\\mathrm{sub},s}(I)$ 相加，得到组串电压曲线 $V_{\\mathrm{string}}(I)$。\n5.  计算组串功率曲线 $P_{\\mathrm{string}}(I) = I \\cdot V_{\\mathrm{string}}(I)$。\n6.  找到组串的最大功率 $P_{\\mathrm{string,MPP}}$ 及其出现的索引 `mpp_idx`。\n7.  使用 $P_{\\mathrm{string,MPP}}$ 和 `P_ind_sum` 计算失配损耗 $L$。\n8.  在索引 `mpp_idx` 处，检查每个子组串预先计算的 $V_{\\mathrm{sub,PV},s}$ 值。计算 $V_{\\mathrm{sub,PV},s}(I_{\\mathrm{MPP}})  -V_{\\mathrm{BD}}$ 的子组串数量。\n9.  存储得到的损耗（四舍五入到 $4$ 位小数）和二极管计数。\n\n对所有四个测试用例重复此过程，以生成最终输出。",
            "answer": "[0.0,0,0.0195,0,0.3015,1,0.2282,1]"
        },
        {
            "introduction": "将高比例的可再生能源并入电网，需要先进的控制与运行策略来保证电网的可靠性。本练习将挑战你解决一个前沿的能源系统问题：为一个光伏-风电-储能混合电站进行优化调度，以满足其签订的固定电力输送合同()。通过构建并求解一个混合整数线性规划模型，你将学会如何利用储能系统来缓冲可再生能源的波动性，从而将间歇性的资源转化为可调度的宝贵资产。",
            "id": "4134839",
            "problem": "考虑一个由光伏发电、风力发电和电化学储能系统组成的混合电站。设时间范围被离散化为 $T$ 个小时间隔，其中 $\\Delta t = 1$ 小时。光伏可用功率曲线由一个长度为 $T$ 的数组给出，每个元素以 $\\mathrm{MW}$ 为单位。风电可用功率曲线由一个长度为 $T$ 的数组给出，每个元素以 $\\mathrm{MW}$ 为单位。确定性功率责任是一个长度为 $T$ 的数组，每个元素以 $\\mathrm{MW}$ 为单位。储能系统具有以 $\\mathrm{MWh}$ 为单位的最大储能容量、以 $\\mathrm{MW}$ 为单位的最大充电功率、以 $\\mathrm{MW}$ 为单位的最大放电功率、充电效率（无量纲）和放电效率（无量纲）。初始荷电状态以 $\\mathrm{MWh}$ 为单位，并要求荷电状态在时间范围结束时返回到相同的值。\n\n仅从适用于能源系统建模的基本守恒原理和核心运行定义出发，推导一个混合整数线性优化模型，用于调度光伏发电、风力发电以及储能的充放电，以在给定的可变性下，只要物理上可行，就满足确定性功率责任。推导必须从以下几点开始：\n\n- 储能系统在离散时间步长上的能量守恒。\n- 每个时间步长的功率平衡，它将净上网功率与确定性功率责任联系起来。\n- 所有组件的功率和能量容量的物理限制。\n- 强制储能系统非同时充放电的二元决策变量。\n\n您的推导必须产生一个适用于混合整数线性规划（Mixed-Integer Linear Programming）的公式，其中充放电决策是二元的，所有其他决策变量是连续的。目标应是在遵守所有物理约束的同时，最小化整个时间范围内的总未满足确定性功率。每个时间步长的未满足确定性功率必须是一个以 $\\mathrm{MW}$ 为单位的非负松弛变量，其总和需要被最小化。为保证数值鲁棒性，可行性评估应接受总未满足确定性功率可忽略不计的解，该可忽略量由一个远小于典型 $\\mathrm{MW}$ 值的容差阈值定义。\n\n您必须实现一个程序，使用通用求解器为下面的一组测试用例求解所推导的混合整数线性优化问题，并返回每个用例的可行性。当且仅当最优总未满足确定性功率在一个小的数值容差范围内等于 $0$ 时，一个用例才被视为可行。\n\n要求的物理单位：\n- 所有功率量，包括光伏可用功率、风电可用功率、充电功率、放电功率、确定性功率责任和未满足确定性功率，单位必须是 $\\mathrm{MW}$。\n- 所有能量量，包括储能容量和荷电状态，单位必须是 $\\mathrm{MWh}$。\n- 此问题不涉及任何角度量。\n- 任何比率都必须以小数形式报告。\n\n需要实现的测试套件：\n- 案例 $1$（通用理想路径）：$T = 6$。光伏可用功率 $[3.0, 2.0, 1.0, 0.5, 1.5, 2.0]$ $\\mathrm{MW}$。风电可用功率 $[1.0, 1.5, 2.0, 1.2, 0.8, 1.5]$ $\\mathrm{MW}$。确定性功率责任 $[2.0, 2.0, 2.0, 2.0, 2.0, 2.0]$ $\\mathrm{MW}$。储能参数：最大能量 $1.0$ $\\mathrm{MWh}$，初始荷电状态 $0.5$ $\\mathrm{MWh}$，最大充电功率 $1.5$ $\\mathrm{MW}$，最大放电功率 $1.5$ $\\mathrm{MW}$，充电效率 $0.95$，放电效率 $0.95$。\n- 案例 $2$（全局能量赤字）：$T = 4$。光伏可用功率 $[0.2, 0.2, 0.2, 0.2]$ $\\mathrm{MW}$。风电可用功率 $[0.1, 0.1, 0.1, 0.1]$ $\\mathrm{MW}$。确定性功率责任 $[0.5, 0.5, 0.5, 0.5]$ $\\mathrm{MW}$。储能参数：最大能量 $10.0$ $\\mathrm{MWh}$，初始荷电状态 $0.0$ $\\mathrm{MWh}$，最大充电功率 $5.0$ $\\mathrm{MW}$，最大放电功率 $5.0$ $\\mathrm{MW}$，充电效率 $0.95$，放电效率 $0.95$。\n- 案例 $3$（具有可变性和精确储能容量的单一低谷）：$T = 5$。光伏可用功率 $[2.5, 2.2, 0.2, 2.1, 2.3]$ $\\mathrm{MW}$。风电可用功率 $[0.3, 0.5, 0.3, 0.2, 0.3]$ $\\mathrm{MW}$。确定性功率责任 $[2.0, 2.0, 1.4, 2.0, 2.0]$ $\\mathrm{MW}$。储能参数：最大能量 $1.6$ $\\mathrm{MWh}$，初始荷电状态 $0.0$ $\\mathrm{MWh}$，最大充电功率 $1.5$ $\\mathrm{MW}$，最大放电功率 $1.5$ $\\mathrm{MW}$，充电效率 $0.95$，放电效率 $0.95$。\n- 案例 $4$（低谷时功率受限导致不可行）：$T = 3$。光伏可用功率 $[3.0, 1.0, 3.0]$ $\\mathrm{MW}$。风电可用功率 $[0.0, 0.0, 0.0]$ $\\mathrm{MW}$。确定性功率责任 $[2.5, 2.5, 2.5]$ $\\mathrm{MW}$。储能参数：最大能量 $10.0$ $\\mathrm{MWh}$，初始荷电状态 $0.0$ $\\mathrm{MWh}$，最大充电功率 $3.0$ $\\mathrm{MW}$，最大放电功率 $1.0$ $\\mathrm{MW}$，充电效率 $0.95$，放电效率 $0.95$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{False}]$）作为结果，其中每个条目是一个布尔值，如果用例在上述定义下是可行的，则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。布尔值必须完全按照 Python 布尔文字量打印，不得包含额外文本。",
            "solution": "我们从支撑能源系统建模的核心定义和基本定律开始。在离散的小时间隔上，我们利用能量守恒和运行边界来推导一个混合整数线性规划问题，该问题决定如何调度光伏发电、风力发电和储能以满足确定性功率责任。\n\n为每个时间 $t \\in \\{0,1,\\dots,T-1\\}$ 定义以下决策变量：\n- $p^{\\mathrm{pv}}_t \\ge 0$ 是调度到电网的光伏功率，单位为 $\\mathrm{MW}$。\n- $p^{\\mathrm{w}}_t \\ge 0$ 是调度到电网的风电功率，单位为 $\\mathrm{MW}$。\n- $p^{\\mathrm{ch}}_t \\ge 0$ 是储能充电功率，单位为 $\\mathrm{MW}$。\n- $p^{\\mathrm{dis}}_t \\ge 0$ 是储能放电功率，单位为 $\\mathrm{MW}$。\n- $u^{\\mathrm{ch}}_t \\in \\{0,1\\}$ 是二元充电决策变量，指示充电是否激活。\n- $u^{\\mathrm{dis}}_t \\in \\{0,1\\}$ 是二元放电决策变量，指示放电是否激活。\n- $r_t \\ge 0$ 是未满足的确定性功率（松弛变量），单位为 $\\mathrm{MW}$。\n为 $t \\in \\{0,1,\\dots,T\\}$ 定义储能的荷电状态 $s_t$，单位为 $\\mathrm{MWh}$，初始条件 $s_0$ 已知，终端条件为 $s_T = s_0$。\n\n物理和运行参数如下：\n- 光伏可用功率曲线 $a^{\\mathrm{pv}}_t$，单位为 $\\mathrm{MW}$。\n- 风电可用功率曲线 $a^{\\mathrm{w}}_t$，单位为 $\\mathrm{MW}$。\n- 确定性功率责任 $P^{\\mathrm{firm}}_t$，单位为 $\\mathrm{MW}$。\n- 最大储能能量 $E^{\\mathrm{max}}$，单位为 $\\mathrm{MWh}$。\n- 最大充电功率 $P^{\\mathrm{ch,max}}$，单位为 $\\mathrm{MW}$。\n- 最大放电功率 $P^{\\mathrm{dis,max}}$，单位为 $\\mathrm{MW}$。\n- 充电效率 $\\eta^{\\mathrm{ch}} \\in (0,1]$（无量纲）。\n- 放电效率 $\\eta^{\\mathrm{dis}} \\in (0,1]$（无量纲）。\n我们取 $\\Delta t = 1$ 小时，因此在每个时间步长，能量和功率可以直接比较。\n\n根据储能在单个步长内的能量守恒，储存能量的变化等于储能的净输入减去损耗。以功率 $p^{\\mathrm{ch}}_t$ 充电 $\\Delta t = 1$ 小时会使储存的能量增加 $\\eta^{\\mathrm{ch}} p^{\\mathrm{ch}}_t$，而以功率 $p^{\\mathrm{dis}}_t$ 放电会使储存的能量减少 $\\frac{1}{\\eta^{\\mathrm{dis}}} p^{\\mathrm{dis}}_t$。因此，对于每个 $t \\in \\{0,\\dots,T-1\\}$，\n$$\ns_{t+1} = s_t + \\eta^{\\mathrm{ch}} p^{\\mathrm{ch}}_t - \\frac{1}{\\eta^{\\mathrm{dis}}} p^{\\mathrm{dis}}_t.\n$$\n运行边界强制要求对所有 $t$ 都有 $0 \\le s_t \\le E^{\\mathrm{max}}$。\n\n对于输送到电网的净功率平衡，在每个时间 $t$，电网接收的功率是调度发电量与储能放电量之和，减去任何用于给储能充电的功率。为确保在可能的情况下满足确定性功率责任，我们引入一个非负松弛变量 $r_t$ 来表示未满足的确定性功率。因此，净功率平衡必须满足\n$$\np^{\\mathrm{pv}}_t + p^{\\mathrm{w}}_t + p^{\\mathrm{dis}}_t - p^{\\mathrm{ch}}_t + r_t \\ge P^{\\mathrm{firm}}_t.\n$$\n发电的物理限制意味着\n$$\n0 \\le p^{\\mathrm{pv}}_t \\le a^{\\mathrm{pv}}_t, \\quad 0 \\le p^{\\mathrm{w}}_t \\le a^{\\mathrm{w}}_t.\n$$\n储能的功率限制为\n$$\n0 \\le p^{\\mathrm{ch}}_t \\le P^{\\mathrm{ch,max}}, \\quad 0 \\le p^{\\mathrm{dis}}_t \\le P^{\\mathrm{dis,max}}.\n$$\n为了以线性的方式强制非同时充放电，我们使用二元决策和大 $M$ 型关联约束：\n$$\np^{\\mathrm{ch}}_t \\le P^{\\mathrm{ch,max}} u^{\\mathrm{ch}}_t, \\quad p^{\\mathrm{dis}}_t \\le P^{\\mathrm{dis,max}} u^{\\mathrm{dis}}_t, \\quad u^{\\mathrm{ch}}_t + u^{\\mathrm{dis}}_t \\le 1.\n$$\n终端条件 $s_T = s_0$ 强制了在整个时间范围内的循环操作。\n\n目标是最小化总未满足确定性功率：\n$$\n\\min \\sum_{t=0}^{T-1} r_t.\n$$\n所有约束都是线性的，只有 $u^{\\mathrm{ch}}_t$ 和 $u^{\\mathrm{dis}}_t$ 是二元变量，因此该问题是一个混合整数线性规划问题。\n\n算法设计：\n- 构建一个决策向量，堆叠 $p^{\\mathrm{pv}}_t$、$p^{\\mathrm{w}}_t$、$p^{\\mathrm{ch}}_t$、$p^{\\mathrm{dis}}_t$、$s_t$（对于 $t=0,\\dots,T$）、$u^{\\mathrm{ch}}_t$、$u^{\\mathrm{dis}}_t$ 和 $r_t$。\n- 使用可用发电限制、储能容量和储能功率限制来设置变量边界。设置二元边界 $0 \\le u^{\\mathrm{ch}}_t \\le 1$ 和 $0 \\le u^{\\mathrm{dis}}_t \\le 1$，以及非负边界 $r_t \\ge 0$ 并为其设置一个合理的上界以保证数值稳定性。\n- 构建线性约束：\n  - 储能动态等式 $s_{t+1} - s_t - \\eta^{\\mathrm{ch}} p^{\\mathrm{ch}}_t + \\frac{1}{\\eta^{\\mathrm{dis}}} p^{\\mathrm{dis}}_t = 0$ 对所有 $t$ 成立。\n  - 初始和终端荷电状态等式 $s_0 = \\text{给定值}$ 和 $s_T = s_0$。\n  - 大 $M$ 关联约束 $p^{\\mathrm{ch}}_t - P^{\\mathrm{ch,max}} u^{\\mathrm{ch}}_t \\le 0$ 和 $p^{\\mathrm{dis}}_t - P^{\\mathrm{dis,max}} u^{\\mathrm{dis}}_t \\le 0$，以及 $u^{\\mathrm{ch}}_t + u^{\\mathrm{dis}}_t \\le 1$。\n  - 功率平衡不等式 $p^{\\mathrm{pv}}_t + p^{\\mathrm{w}}_t + p^{\\mathrm{dis}}_t - p^{\\mathrm{ch}}_t + r_t \\ge P^{\\mathrm{firm}}_t$。\n- 使用混合整数线性规划求解器最小化 $\\sum_t r_t$。如果最优的 $\\sum_t r_t$ 在一个小的容差范围内为零（例如，小于 $10^{-6}$ $\\mathrm{MW}$-小时，在 $\\Delta t = 1$ 小时内匹配单位），则认为该解对于确定性功率责任是可行的。\n\n可变性下的可行性评估：\n- 案例 $1$ 有足够的发电和储能来弥补短暂的低谷；模型应能找到满足确定性功率责任的调度方案，使得 $\\sum_t r_t$ 接近 $0$。\n- 案例 $2$ 存在全局能量赤字；储能不能创造能量，因此 $\\sum_t r_t$ 必须严格为正。\n- 案例 $3$ 需要在早期充电以弥补具有实际效率的单一低谷；参数的选择使得充电足够，且 $\\sum_t r_t \\approx 0$。\n- 案例 $4$ 有足够的能量，但在深度低谷期间放电功率不足，因此由于放电速率的限制，$\\sum_t r_t$ 保持为正值。\n\n程序输出一行布尔值列表，每个布尔值指示相应的测试用例在基于第一性原理推导出的最优混合整数线性规划调度下是否可行。",
            "answer": "[True,False,True,False]"
        }
    ]
}