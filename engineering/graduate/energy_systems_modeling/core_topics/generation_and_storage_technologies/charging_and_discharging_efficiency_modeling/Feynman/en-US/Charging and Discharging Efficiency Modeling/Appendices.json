{
    "hands_on_practices": [
        {
            "introduction": "To begin, we explore the most fundamental source of inefficiency in an electrochemical cell: its internal resistance. This exercise uses a simple yet powerful equivalent circuit model to connect the macroscopic concept of round-trip efficiency to the cell's physical properties and its operating current. By calculating the efficiency at different C-rates, you will gain a first-principles understanding of the inherent trade-off between power delivery and energy conservation in battery systems .",
            "id": "4077752",
            "problem": "A single lithium-ion cell is modeled by a series internal resistance and a state-dependent open-circuit voltage. Consider a cell with nominal capacity $C_{\\text{nom}} = 50\\ \\text{Ah}$, series internal resistance $R = 4\\ \\text{m}\\Omega$, and an open-circuit voltage that is approximately constant over the cycle, $U(\\text{State of Charge (SOC)}) \\approx 3.7\\ \\text{V}$. Assume negligible kinetic and concentration overpotentials, unity coulombic efficiency, and that the series internal resistance model is valid over the entire operating range. Perform a symmetric full cycle consisting of constant-current charge from $\\text{SOC} = 0$ to $\\text{SOC} = 1$ and constant-current discharge back to $\\text{SOC} = 0$, once at $0.5\\ \\text{C}$ and once at $2\\ \\text{C}$, where a $n\\ \\text{C}$ rate means a constant current $I = n\\,C_{\\text{nom}}$ in amperes.\n\nUsing first principles of electrical energy and the series-resistance model, compute the round-trip energy efficiency $\\eta$, defined as the ratio of the total energy delivered to the external circuit during discharge to the total energy supplied from the external source during charge, for both $0.5\\ \\text{C}$ and $2\\ \\text{C}$. Express both efficiencies as unitless decimals, and round your answers to four significant figures. Provide your final result as a two-component row vector $\\left[\\eta_{0.5\\ \\text{C}},\\ \\eta_{2\\ \\text{C}}\\right]$.",
            "solution": "The round-trip energy efficiency, $\\eta$, is defined as the ratio of the total energy delivered to the external circuit during discharge, $E_{\\text{dis}}$, to the total energy supplied from the external source during charge, $E_{\\text{ch}}$.\n$$\n\\eta = \\frac{E_{\\text{dis}}}{E_{\\text{ch}}}\n$$\nThe problem models a lithium-ion cell as an ideal voltage source with a constant open-circuit voltage, $U$, in series with a constant internal resistance, $R$. The terminal voltage of the cell, $V_{t}$, is therefore a function of the current, $I$. By convention, a positive current, $I > 0$, corresponds to discharge, and a negative current, $I < 0$, corresponds to charge. However, for this problem involving symmetric constant-current cycles, it is more convenient to work with the magnitude of the current, which we denote as $I$, and explicitly account for the voltage effects.\n\nDuring charging, the external power source must overcome both the cell's open-circuit voltage $U$ and the resistive loss. The terminal voltage is:\n$$\nV_{t, \\text{ch}} = U + IR\n$$\nDuring discharging, the internal resistance causes a voltage drop, so the voltage delivered to the external load is:\n$$\nV_{t, \\text{dis}} = U - IR\n$$\nThe problem specifies a constant-current cycle. The energy transferred during a process is the integral of power over time, $E = \\int P(t) dt$. Since the current $I$, resistance $R$, and open-circuit voltage $U$ are all constant, the power is constant throughout each phase (charge and discharge). Thus, the energy is simply the product of power and time duration.\n\nEnergy supplied during charge, $E_{\\text{ch}}$, is:\n$$\nE_{\\text{ch}} = P_{\\text{ch}} \\cdot \\Delta t_{\\text{ch}} = (V_{t, \\text{ch}} \\cdot I) \\cdot \\Delta t_{\\text{ch}} = (U + IR) I \\Delta t_{\\text{ch}}\n$$\nEnergy delivered during discharge, $E_{\\text{dis}}$, is:\n$$\nE_{\\text{dis}} = P_{\\text{dis}} \\cdot \\Delta t_{\\text{dis}} = (V_{t, \\text{dis}} \\cdot I) \\cdot \\Delta t_{\\text{dis}} = (U - IR) I \\Delta t_{\\text{dis}}\n$$\nThe problem states the cycle is from $\\text{SOC}=0$ to $\\text{SOC}=1$ and back to $\\text{SOC}=0$. The total charge transferred in each phase is equal to the nominal capacity, $C_{\\text{nom}}$. For a constant current $I$, the duration of the process $\\Delta t$ is given by $\\Delta t = C_{\\text{nom}} / I$. The problem specifies unity coulombic efficiency and a symmetric cycle, which implies that the magnitude of the current $I$ and the duration $\\Delta t$ are the same for both charging and discharging. Therefore, the total charge transferred, $I \\Delta t$, is equal to $C_{\\text{nom}}$ for both processes.\n$$\nI \\Delta t_{\\text{ch}} = C_{\\text{nom}}\n$$\n$$\nI \\Delta t_{\\text{dis}} = C_{\\text{nom}}\n$$\nSubstituting this into the energy expressions:\n$$\nE_{\\text{ch}} = (U + IR) C_{\\text{nom}}\n$$\n$$\nE_{\\text{dis}} = (U - IR) C_{\\text{nom}}\n$$\nThe efficiency $\\eta$ can now be expressed as:\n$$\n\\eta = \\frac{E_{\\text{dis}}}{E_{\\text{ch}}} = \\frac{(U - IR) C_{\\text{nom}}}{(U + IR) C_{\\text{nom}}} = \\frac{U - IR}{U + IR}\n$$\nThis general expression shows that the efficiency depends on the open-circuit voltage, internal resistance, and the magnitude of the current.\n\nThe problem specifies two cases based on the C-rate, $n$. A rate of $n \\ \\text{C}$ corresponds to a current $I = n \\cdot Q_{\\text{nom}}$, where $Q_{\\text{nom}}$ is the numerical value of the nominal capacity in Ampere-hours.\nGiven values:\n$U = 3.7\\ \\text{V}$\n$R = 4\\ \\text{m}\\Omega = 0.004\\ \\Omega$\n$C_{\\text{nom}} = 50\\ \\text{Ah}$, so $Q_{\\text{nom}} = 50$.\n\nCase 1: $0.5\\ \\text{C}$ rate.\nThe current is $I_{0.5\\ \\text{C}} = 0.5 \\times 50\\ \\text{A} = 25\\ \\text{A}$.\nThe voltage drop (or rise) across the resistor is $I_{0.5\\ \\text{C}}R = 25\\ \\text{A} \\times 0.004\\ \\Omega = 0.1\\ \\text{V}$.\nThe efficiency is:\n$$\n\\eta_{0.5\\ \\text{C}} = \\frac{3.7 - 0.1}{3.7 + 0.1} = \\frac{3.6}{3.8} \\approx 0.947368...\n$$\nRounding to four significant figures, $\\eta_{0.5\\ \\text{C}} = 0.9474$.\n\nCase 2: $2\\ \\text{C}$ rate.\nThe current is $I_{2\\ \\text{C}} = 2 \\times 50\\ \\text{A} = 100\\ \\text{A}$.\nThe voltage drop (or rise) across the resistor is $I_{2\\ \\text{C}}R = 100\\ \\text{A} \\times 0.004\\ \\Omega = 0.4\\ \\text{V}$.\nThe efficiency is:\n$$\n\\eta_{2\\ \\text{C}} = \\frac{3.7 - 0.4}{3.7 + 0.4} = \\frac{3.3}{4.1} \\approx 0.804878...\n$$\nRounding to four significant figures, $\\eta_{2\\ \\text{C}} = 0.8049$.\n\nThe final result is the two-component row vector $[\\eta_{0.5\\ \\text{C}}, \\eta_{2\\ \\text{C}}]$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.9474 & 0.8049\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Building on the basic series-resistance model, this practice introduces the crucial real-world concept of parameter uncertainty. In any practical application, model parameters such as internal resistance $R$ and open-circuit voltage $U$ are not known with perfect certainty but are typically specified within a range of tolerance. This exercise will guide you through using worst-case bounding to determine how uncertainties in these fundamental parameters propagate to the calculated energy efficiency, a key skill in assessing the robustness and reliability of any engineering model .",
            "id": "4077714",
            "problem": "A single-cell electrochemical energy storage device (for example, a lithium-ion cell) is modeled during a constant-current discharge by an equilibrium (open-circuit) potential $U$ in series with an ohmic internal resistance $R$. Assume that over a short discharge window the quantities $U$ and $R$ are constant in time and that kinetic overpotentials other than the ohmic drop are negligible. Let the discharge current be held constant at $I$ for a duration $T$.\n\nFrom first principles, energy delivered to the external load equals the time integral of the terminal power, and energy withdrawn reversibly from the cell equals the time integral of $U$ times the current. Using these definitions, derive the expression for the discharge energy efficiency as a function of $U$, $R$, and $I$. Then, treating uncertainties in $U$ and $R$ as independent bounded intervals,\n- $R = 3 \\pm 0.2\\ \\text{m}\\Omega$ (that is, $R \\in [2.8, 3.2]\\ \\text{m}\\Omega$),\n- $U = 3.7 \\pm 0.05\\ \\text{V}$ (that is, $U \\in [3.65, 3.75]\\ \\text{V}$),\nevaluate the resulting worst-case uncertainty interval for the energy efficiency during a $T = 1\\ \\text{h}$ discharge at $I = 30\\ \\text{A}$.\n\nUse worst-case bounding (interval arithmetic) consistent with the monotonicity of the derived efficiency with respect to $U$ and $R$. Express the final answer as the two endpoints of the efficiency interval in decimal form (dimensionless, no units). Round your two endpoints to four significant figures. Provide your final answer as a two-entry row matrix $\\begin{pmatrix}\\text{lower} & \\text{upper}\\end{pmatrix}$.",
            "solution": "### Part 1: Derivation of Discharge Energy Efficiency ($\\eta_{\\text{discharge}}$)\nThe discharge energy efficiency, $\\eta_{\\text{discharge}}$, is the ratio of the useful energy delivered to the load, $E_{\\text{load}}$, to the total (reversible) energy withdrawn from the cell, $E_{\\text{rev}}$.\n\nBased on the given model, the terminal voltage of the cell, $V_t$, during discharge at a constant current $I$ is the open-circuit potential $U$ minus the voltage drop across the internal resistance $R$:\n$$V_t = U - I R$$\nThe energy delivered to the load over a duration $T$ is the integral of the terminal power, $P_{\\text{load}} = V_t I$:\n$$E_{\\text{load}} = \\int_0^T V_t I \\, dt = (U - I R) I T$$\nThe reversible energy withdrawn from the cell is the integral of the power associated with the open-circuit potential:\n$$E_{\\text{rev}} = \\int_0^T U I \\, dt = U I T$$\nThe efficiency is therefore:\n$$\\eta_{\\text{discharge}} = \\frac{E_{\\text{load}}}{E_{\\text{rev}}} = \\frac{(U - I R) I T}{U I T}$$\nAssuming a non-zero current $I$ and duration $T$, this simplifies to:\n$$\\eta_{\\text{discharge}}(U, R) = \\frac{U - I R}{U} = 1 - \\frac{I R}{U}$$\nThis expression is independent of the discharge duration $T$.\n\n### Part 2: Worst-Case Uncertainty Analysis\nWe need to find the worst-case uncertainty interval for $\\eta_{\\text{discharge}}$ given the intervals for $U$ and $R$. Let the efficiency function be denoted as $\\eta(U, R) = 1 - \\frac{IR}{U}$. We analyze its monotonicity by examining its partial derivatives.\n\nThe partial derivative of $\\eta$ with respect to $R$ is:\n$$\\frac{\\partial \\eta}{\\partial R} = \\frac{\\partial}{\\partial R} \\left(1 - \\frac{I R}{U}\\right) = -\\frac{I}{U}$$\nSince the current $I$ and potential $U$ are positive quantities ($I > 0, U > 0$), we have $\\frac{\\partial \\eta}{\\partial R}  0$. This indicates that $\\eta(U, R)$ is a monotonically decreasing function of $R$.\n\nThe partial derivative of $\\eta$ with respect to $U$ is:\n$$\\frac{\\partial \\eta}{\\partial U} = \\frac{\\partial}{\\partial U} \\left(1 - I R U^{-1}\\right) = -I R (-1) U^{-2} = \\frac{I R}{U^2}$$\nSince $I > 0$, $R > 0$, and $U > 0$, we have $\\frac{\\partial \\eta}{\\partial U} > 0$. This indicates that $\\eta(U, R)$ is a monotonically increasing function of $U$.\n\nBased on this analysis, the bounds of the efficiency interval are:\n- The minimum efficiency, $\\eta_{\\min}$, occurs at the lowest value of $U$ ($U_{\\min}$) and the highest value of $R$ ($R_{\\max}$).\n- The maximum efficiency, $\\eta_{\\max}$, occurs at the highest value of $U$ ($U_{\\max}$) and the lowest value of $R$ ($R_{\\min}$).\n\n### Part 3: Numerical Evaluation\nThe given values are:\n- $I = 30\\ \\text{A}$\n- $R \\in [2.8, 3.2]\\ \\text{m}\\Omega \\implies R_{\\min} = 0.0028\\ \\Omega, R_{\\max} = 0.0032\\ \\Omega$\n- $U \\in [3.65, 3.75]\\ \\text{V} \\implies U_{\\min} = 3.65\\ \\text{V}, U_{\\max} = 3.75\\ \\text{V}$\n\n**Lower Bound ($\\eta_{\\min}$):**\n$$\\eta_{\\min} = \\eta(U_{\\min}, R_{\\max}) = 1 - \\frac{I R_{\\max}}{U_{\\min}} = 1 - \\frac{(30\\ \\text{A}) \\times (0.0032\\ \\Omega)}{3.65\\ \\text{V}}$$\n$$\\eta_{\\min} = 1 - \\frac{0.096}{3.65} \\approx 1 - 0.02630137... \\approx 0.9736986...$$\nRounding to four significant figures gives $\\eta_{\\min} = 0.9737$.\n\n**Upper Bound ($\\eta_{\\max}$):**\n$$\\eta_{\\max} = \\eta(U_{\\max}, R_{\\min}) = 1 - \\frac{I R_{\\min}}{U_{\\max}} = 1 - \\frac{(30\\ \\text{A}) \\times (0.0028\\ \\Omega)}{3.75\\ \\text{V}}$$\n$$\\eta_{\\max} = 1 - \\frac{0.084}{3.75} = 1 - 0.0224 = 0.9776$$\nThis value is exact and has four significant figures.\n\nThe worst-case uncertainty interval for the energy efficiency is $[0.9737, 0.9776]$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.9737  0.9776 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Our final practice takes a significant step towards high-fidelity modeling by considering the dynamic, coupled nature of battery behavior. Internal resistance is not a static parameter; it changes with temperature, which in turn is affected by the heat generated during operation. This exercise requires you to develop a coupled electro-thermal model, solve the governing differential equation, and implement it computationally to explore how thermal management directly impacts the time-varying efficiency of a battery, providing essential insights into the design of effective cooling systems .",
            "id": "4077760",
            "problem": "A constant-current discharge of a single lumped battery module is modeled using a first-principles energy balance with Joule heating and convective cooling. The objective is to evaluate the impact of cooling effectiveness on energy efficiency by comparing the temperature-dependent internal resistance trajectories under different thermal conductance values. The battery is discharged at current $I$ for a duration $t_f$, starting at ambient temperature $T_{\\text{amb}}$. The internal resistance depends linearly on temperature as $R(T) = R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right)$, where $R_0$ is the temperature-independent baseline resistance at reference temperature $T_{\\text{ref}}$, and $\\alpha$ is the temperature coefficient of resistance. The thermal dynamics are represented by a single-node lumped thermal capacitance $C_{\\text{th}}$ exchanging heat convectively with ambient via an aggregate thermal conductance $h$. The terminal voltage is $U_{\\text{term}}(t) = U_{\\text{oc}} - I\\,R(T(t))$, where $U_{\\text{oc}}$ is the open-circuit voltage (OCV), assumed constant over the short discharge considered.\n\nStarting from the energy conservation law and standard definitions of Joule heating and convective heat transfer, determine the time evolution $T(t)$ and the associated trajectory $R(T(t))$ during the discharge. Using these, compute the energy efficiency over the interval $[0,t_f]$, defined as the ratio of useful electrical energy delivered to the external circuit to the ideal electrical energy with no internal resistance:\n$$\n\\eta = \\frac{\\int_0^{t_f} I\\,U_{\\text{term}}(t)\\,dt}{\\int_0^{t_f} I\\,U_{\\text{oc}}\\,dt},\n$$\nwhich must be expressed as a decimal (not a percentage). All quantities and parameters in your derivation and computation must be treated in the International System of Units.\n\nYou must implement a complete, runnable program that performs the calculation for each parameter set in the test suite given below and outputs the energy efficiencies as specified. The program should solve the thermal-resistance dynamics exactly for the given linear temperature dependence without numerical time stepping.\n\nParameters are:\n- Discharge current $I$ in $\\text{A}$,\n- Thermal conductance $h$ in $\\text{W}\\,\\text{K}^{-1}$,\n- Baseline internal resistance $R_0$ in $\\Omega$,\n- Temperature coefficient $\\alpha$ in $\\text{K}^{-1}$,\n- Thermal capacitance $C_{\\text{th}}$ in $\\text{J}\\,\\text{K}^{-1}$,\n- Reference temperature $T_{\\text{ref}}$ in $\\text{K}$,\n- Ambient temperature $T_{\\text{amb}}$ in $\\text{K}$,\n- Open-circuit voltage $U_{\\text{oc}}$ in $\\text{V}$,\n- Discharge duration $t_f$ in $\\text{s}$.\n\nTest suite (each case is independent and should be computed from first principles):\n1. Baseline cooling and negative temperature coefficient (happy path): $I = 40\\ \\text{A}$, $h = 5\\ \\text{W}\\,\\text{K}^{-1}$, $R_0 = 5\\times 10^{-3}\\ \\Omega$, $\\alpha = -2\\times 10^{-3}\\ \\text{K}^{-1}$, $C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\ \\text{K}$, $T_{\\text{amb}} = 298.15\\ \\text{K}$, $U_{\\text{oc}} = 3.7\\ \\text{V}$, $t_f = 600\\ \\text{s}$.\n2. Stronger cooling (comparison target): $I = 40\\ \\text{A}$, $h = 20\\ \\text{W}\\,\\text{K}^{-1}$, $R_0 = 5\\times 10^{-3}\\ \\Omega$, $\\alpha = -2\\times 10^{-3}\\ \\text{K}^{-1}$, $C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\ \\text{K}$, $T_{\\text{amb}} = 298.15\\ \\text{K}$, $U_{\\text{oc}} = 3.7\\ \\text{V}$, $t_f = 600\\ \\text{s}$.\n3. Adiabatic edge case: $I = 40\\ \\text{A}$, $h = 0\\ \\text{W}\\,\\text{K}^{-1}$, $R_0 = 5\\times 10^{-3}\\ \\Omega$, $\\alpha = -2\\times 10^{-3}\\ \\text{K}^{-1}$, $C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\ \\text{K}$, $T_{\\text{amb}} = 298.15\\ \\text{K}$, $U_{\\text{oc}} = 3.7\\ \\text{V}$, $t_f = 600\\ \\text{s}$.\n4. Temperature-independent resistance boundary: $I = 40\\ \\text{A}$, $h = 5\\ \\text{W}\\,\\text{K}^{-1}$, $R_0 = 5\\times 10^{-3}\\ \\Omega$, $\\alpha = 0\\ \\text{K}^{-1}$, $C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\ \\text{K}$, $T_{\\text{amb}} = 298.15\\ \\text{K}$, $U_{\\text{oc}} = 3.7\\ \\text{V}$, $t_f = 600\\ \\text{s}$.\n5. Positive temperature coefficient scenario: $I = 40\\ \\text{A}$, $h = 5\\ \\text{W}\\,\\text{K}^{-1}$, $R_0 = 5\\times 10^{-3}\\ \\Omega$, $\\alpha = +2\\times 10^{-3}\\ \\text{K}^{-1}$, $C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\ \\text{K}$, $T_{\\text{amb}} = 298.15\\ \\text{K}$, $U_{\\text{oc}} = 3.7\\ \\text{V}$, $t_f = 600\\ \\text{s}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the energy efficiencies for the five test cases as a comma-separated list enclosed in square brackets, with each efficiency expressed as a decimal rounded to six places (e.g., $[0.950000,0.946000,0.948500,0.945946,0.945834]$). No other text must be printed.",
            "solution": "The problem requires the calculation of the energy efficiency of a battery module undergoing a constant-current discharge. The solution necessitates determining the time-evolution of the battery's temperature, which in turn affects its internal resistance and, consequently, its terminal voltage and energy output. An analytical solution is derived from the governing principles of energy conservation.\n\n### 1. Thermal Model and Governing Equation\n\nThe energy balance for the lumped-capacitance battery module is given by the first law of thermodynamics. The rate of change of the module's internal energy is equal to the rate of internal heat generation minus the rate of heat loss to the surroundings.\n$$\nC_{\\text{th}} \\frac{dT(t)}{dt} = P_{\\text{gen}}(t) - P_{\\text{loss}}(t)\n$$\nHere, $C_{\\text{th}}$ is the thermal capacitance and $T(t)$ is the temperature of the module at time $t$.\n\nThe heat generation, $P_{\\text{gen}}(t)$, is due to Joule heating, given by $P_{\\text{gen}}(t) = I^2 R(T(t))$, where $I$ is the constant discharge current and $R(T(t))$ is the temperature-dependent internal resistance.\n\nThe heat loss, $P_{\\text{loss}}(t)$, is modeled as convective heat transfer to the ambient environment, described by Newton's law of cooling: $P_{\\text{loss}}(t) = h(T(t) - T_{\\text{amb}})$, where $h$ is the thermal conductance and $T_{\\text{amb}}$ is the ambient temperature.\n\nSubstituting these expressions into the energy balance equation yields:\n$$\nC_{\\text{th}} \\frac{dT(t)}{dt} = I^2 R(T(t)) - h(T(t) - T_{\\text{amb}})\n$$\nThe internal resistance is given by a linear function of temperature: $R(T) = R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right)$. Substituting this into the differential equation gives:\n$$\nC_{\\text{th}} \\frac{dT}{dt} = I^2 R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right) - h(T - T_{\\text{amb}})\n$$\nTo solve this equation, we rearrange it into the standard form of a first-order linear ordinary differential equation, $\\frac{dT}{dt} + pT = q$.\n$$\nC_{\\text{th}} \\frac{dT}{dt} = I^2 R_0 + I^2 R_0 \\alpha T - I^2 R_0 \\alpha T_{\\text{ref}} - hT + hT_{\\text{amb}}\n$$\n$$\nC_{\\text{th}} \\frac{dT}{dt} + (h - I^2 R_0 \\alpha)T = I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}\n$$\nDividing by $C_{\\text{th}}$, we get:\n$$\n\\frac{dT}{dt} + \\left(\\frac{h - I^2 R_0 \\alpha}{C_{\\text{th}}}\\right)T = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{C_{\\text{th}}}\n$$\nLet us define the constants $k_1$ and $k_2$:\n$$\nk_1 = \\frac{h - I^2 R_0 \\alpha}{C_{\\text{th}}}\n$$\n$$\nk_2 = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{C_{\\text{th}}}\n$$\nThe differential equation is now $\\frac{dT}{dt} + k_1 T = k_2$.\n\n### 2. Analytical Solution for Temperature Evolution\n\nThis is a first-order linear ODE with constant coefficients. Its solution is composed of a transient part and a steady-state part. The steady-state temperature, $T_{ss}$, is achieved when $\\frac{dT}{dt} = 0$, which gives $k_1 T_{ss} = k_2$, so $T_{ss} = \\frac{k_2}{k_1}$.\n$$\nT_{ss} = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{h - I^2 R_0 \\alpha}\n$$\nThe general solution is of the form $T(t) = T_{ss} + C e^{-k_1 t}$, where $C$ is a constant of integration determined by the initial condition. The problem states that the battery starts at ambient temperature, so $T(0) = T_{\\text{amb}}$.\n$$\nT(0) = T_{ss} + C e^0 = T_{ss} + C = T_{\\text{amb}} \\implies C = T_{\\text{amb}} - T_{ss}\n$$\nThus, the analytical solution for the temperature as a function of time is:\n$$\nT(t) = T_{ss} + (T_{\\text{amb}} - T_{ss}) e^{-k_1 t}\n$$\nThis solution is valid provided $k_1 \\neq 0$, which is equivalent to $h - I^2 R_0 \\alpha \\neq 0$. This condition holds for all test cases provided.\n\n### 3. Energy Efficiency Calculation\n\nThe energy efficiency $\\eta$ is defined as the ratio of the useful electrical energy delivered to the external circuit to the ideal electrical energy available from the source (with no internal resistance):\n$$\n\\eta = \\frac{\\int_0^{t_f} I\\,U_{\\text{term}}(t)\\,dt}{\\int_0^{t_f} I\\,U_{\\text{oc}}\\,dt}\n$$\nGiven that $I$ and $U_{\\text{oc}}$ are constant, the formula simplifies. Substituting $U_{\\text{term}}(t) = U_{\\text{oc}} - I R(T(t))$:\n$$\n\\eta = \\frac{\\int_0^{t_f} I(U_{\\text{oc}} - I R(T(t)))\\,dt}{I U_{\\text{oc}} t_f} = \\frac{I U_{\\text{oc}} t_f - I^2 \\int_0^{t_f} R(T(t))\\,dt}{I U_{\\text{oc}} t_f}\n$$\n$$\n\\eta = 1 - \\frac{I}{U_{\\text{oc}} t_f} \\int_0^{t_f} R(T(t))\\,dt\n$$\nTo calculate $\\eta$, we must evaluate the time-integral of the resistance, $\\mathcal{I}_R = \\int_0^{t_f} R(T(t))\\,dt$.\n$$\n\\mathcal{I}_R = \\int_0^{t_f} R_0\\left(1 + \\alpha(T(t) - T_{\\text{ref}})\\right)dt = \\int_0^{t_f} \\left(R_0(1 - \\alpha T_{\\text{ref}}) + R_0 \\alpha T(t)\\right)dt\n$$\n$$\n\\mathcal{I}_R = R_0(1 - \\alpha T_{\\text{ref}}) t_f + R_0 \\alpha \\int_0^{t_f} T(t)\\,dt\n$$\nLet $\\mathcal{I}_T = \\int_0^{t_f} T(t)\\,dt$. We can integrate the expression for $T(t)$:\n$$\n\\mathcal{I}_T = \\int_0^{t_f} \\left( T_{ss} + (T_{\\text{amb}} - T_{ss}) e^{-k_1 t} \\right) dt\n$$\n$$\n\\mathcal{I}_T = \\left[ T_{ss} t + \\frac{T_{\\text{amb}} - T_{ss}}{-k_1} e^{-k_1 t} \\right]_0^{t_f}\n$$\n$$\n\\mathcal{I}_T = T_{ss} t_f + \\frac{T_{ss} - T_{\\text{amb}}}{k_1} (e^{-k_1 t_f} - 1)\n$$\nBy substituting $\\mathcal{I}_T$ into the expression for $\\mathcal{I}_R$, and subsequently $\\mathcal{I}_R$ into the formula for $\\eta$, we can compute the energy efficiency for each set of parameters.\n\n### 4. Special Cases\n\n-   **Temperature-Independent Resistance ($\\alpha=0$)**: In this case, $R(T) = R_0$ is constant. The integral $\\mathcal{I}_R = R_0 t_f$, and the efficiency simplifies to $\\eta = 1 - \\frac{I R_0}{U_{\\text{oc}}}$. Our general formula correctly reduces to this limit.\n-   **Adiabatic Case ($h=0$)**: The formulas remain valid. $k_1 = -I^2 R_0 \\alpha / C_{\\text{th}}$ and $T_{ss} = T_{\\text{ref}} - 1/\\alpha$.\n-   **Critical Condition ($h - I^2 R_0 \\alpha=0$)**: In this case, $k_1=0$. The ODE becomes $\\frac{dT}{dt} = k_2$, leading to a linear temperature rise: $T(t) = T_{\\text{amb}} + k_2 t$. The integral $\\mathcal{I}_T$ would be $T_{\\text{amb}} t_f + \\frac{1}{2} k_2 t_f^2$. This case is not encountered in the provided test suite but is handled for robustness.\n\nThe computational procedure for each test case is to first calculate $k_1$ and $T_{ss}$, then evaluate $\\mathcal{I}_T$, followed by $\\mathcal{I}_R$, and finally compute $\\eta$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the energy efficiency for battery discharge scenarios.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Baseline cooling and negative temperature coefficient\n        (40.0, 5.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 2: Stronger cooling\n        (40.0, 20.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 3: Adiabatic edge case\n        (40.0, 0.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 4: Temperature-independent resistance boundary\n        (40.0, 5.0, 5e-3, 0.0, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 5: Positive temperature coefficient scenario\n        (40.0, 5.0, 5e-3, 2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        eff = calculate_efficiency(*params)\n        results.append(f\"{eff:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_efficiency(I, h, R0, alpha, C_th, T_ref, T_amb, U_oc, t_f):\n    \"\"\"\n    Computes the energy efficiency for a given set of battery parameters.\n\n    The function first solves the ordinary differential equation for temperature T(t)\n    analytically, then integrates the resulting resistance R(T(t)) over time to\n    find the total energy loss and efficiency.\n    \"\"\"\n    \n    # Special case: alpha = 0 (temperature-independent resistance)\n    if alpha == 0:\n        eta = 1 - (I * R0) / U_oc\n        return eta\n\n    # This term appears in the denominator of T_ss and the definition of k1\n    denominator_term = h - I**2 * R0 * alpha\n\n    # This is a special case when k1=0, leading to a linear temperature profile.\n    # Handled with a small tolerance for floating-point arithmetic.\n    if abs(denominator_term)  1e-12:\n        k2 = (I**2 * R0 * (1 - alpha * T_ref) + h * T_amb) / C_th\n        # T(t) = T_amb + k2*t, so its integral is T_amb*t_f + 0.5*k2*t_f^2\n        integral_T = T_amb * t_f + 0.5 * k2 * t_f**2\n    else:\n        # General case (k1 != 0)\n        # Constant k1 for the ODE dT/dt + k1*T = k2\n        k1 = denominator_term / C_th\n        \n        # Steady-state temperature\n        T_ss = (I**2 * R0 * (1 - alpha * T_ref) + h * T_amb) / denominator_term\n        \n        # Analytical integral of T(t) from 0 to t_f\n        # T(t) = T_ss + (T_amb - T_ss) * exp(-k1*t)\n        integral_T = T_ss * t_f + (T_ss - T_amb) / k1 * (np.exp(-k1 * t_f) - 1.0)\n\n    # Integral of resistance R(t) from 0 to t_f\n    # R(t) = R0 * (1 - alpha*T_ref) + R0*alpha*T(t)\n    integral_R = R0 * (1 - alpha * T_ref) * t_f + R0 * alpha * integral_T\n\n    # Energy efficiency eta = 1 - (I * integral_R) / (U_oc * t_f)\n    eta = 1 - (I / (U_oc * t_f)) * integral_R\n\n    return eta\n\nsolve()\n```"
        }
    ]
}