{
    "hands_on_practices": [
        {
            "introduction": "我们将从电池效率损失最基本也是最重要的来源——内阻——开始。本练习旨在建立一个计算往返能量效率的基础模型。通过比较不同充放电倍率（C-rate）下的效率，您将定量地理解为何高功率运行电池本质上效率更低，这是设计和运营储能系统时的关键概念。",
            "id": "4077752",
            "problem": "单个锂离子电池被建模为一个串联内阻和一个与状态相关的开路电压。考虑一个电池，其额定容量为 $C_{\\text{nom}} = 50\\ \\text{Ah}$，串联内阻为 $R = 4\\ \\text{m}\\Omega$，开路电压在整个循环中近似恒定，$U(\\text{荷电状态 (SOC)}) \\approx 3.7\\ \\text{V}$。假设动力学和浓差过电势可以忽略不计，库仑效率为1，并且串联内阻模型在整个工作范围内均有效。请执行一个对称的完整循环，该循环包括从 $\\text{SOC} = 0$ 恒流充电至 $\\text{SOC} = 1$，然后再恒流放电回到 $\\text{SOC} = 0$。分别以 $0.5\\ \\text{C}$ 和 $2\\ \\text{C}$ 的倍率各进行一次，其中 $n\\ \\text{C}$ 倍率表示恒定电流 $I = n\\,C_{\\text{nom}}$（单位为安培）。\n\n使用电能的第一性原理和串联电阻模型，计算在 $0.5\\ \\text{C}$ 和 $2\\ \\text{C}$ 倍率下的往返能量效率 $\\eta$。该效率定义为放电期间向外部电路输送的总能量与充电期间从外部电源获取的总能量之比。将两种效率均表示为无单位小数，并将您的答案四舍五入到四位有效数字。将最终结果以一个双分量行向量 $\\left[\\eta_{0.5\\ \\text{C}},\\ \\eta_{2\\ \\text{C}}\\right]$ 的形式给出。",
            "solution": "往返能量效率 $\\eta$ 定义为放电期间向外部电路输送的总能量 $E_{\\text{dis}}$ 与充电期间从外部电源获取的总能量 $E_{\\text{ch}}$ 之比。\n$$\n\\eta = \\frac{E_{\\text{dis}}}{E_{\\text{ch}}}\n$$\n该问题将锂离子电池建模为一个理想电压源（具有恒定的开路电压 $U$）与一个恒定的内阻 $R$ 串联。因此，电池的端电压 $V_{t}$ 是电流 $I$ 的函数。按照惯例，正电流 $I > 0$ 对应于放电，负电流 $I < 0$ 对应于充电。然而，对于这个涉及对称恒流循环的问题，使用电流的绝对值（我们记为 $I$）并明确考虑电压效应会更方便。\n\n在充电期间，外部电源必须同时克服电池的开路电压 $U$ 和电阻损耗。端电压为：\n$$\nV_{t, \\text{ch}} = U + IR\n$$\n在放电期间，内阻引起电压降，因此输送到外部负载的电压为：\n$$\nV_{t, \\text{dis}} = U - IR\n$$\n问题指定了一个恒流循环。在一个过程中传输的能量是功率对时间的积分，$E = \\int P(t) dt$。由于电流 $I$、电阻 $R$ 和开路电压 $U$ 都是恒定的，因此在每个阶段（充电和放电）功率都是恒定的。因此，能量就是功率与时间持续的乘积。\n\n充电期间提供的能量 $E_{\\text{ch}}$ 为：\n$$\nE_{\\text{ch}} = P_{\\text{ch}} \\cdot \\Delta t_{\\text{ch}} = (V_{t, \\text{ch}} \\cdot I) \\cdot \\Delta t_{\\text{ch}} = (U + IR) I \\Delta t_{\\text{ch}}\n$$\n放电期间输送的能量 $E_{\\text{dis}}$ 为：\n$$\nE_{\\text{dis}} = P_{\\text{dis}} \\cdot \\Delta t_{\\text{dis}} = (V_{t, \\text{dis}} \\cdot I) \\cdot \\Delta t_{\\text{dis}} = (U - IR) I \\Delta t_{\\text{dis}}\n$$\n问题指出循环是从 $\\text{SOC}=0$ 到 $\\text{SOC}=1$，再回到 $\\text{SOC}=0$。每个阶段传输的总电荷等于额定容量 $C_{\\text{nom}}$。对于恒定电流 $I$，过程的持续时间 $\\Delta t$ 由 $\\Delta t = C_{\\text{nom}} / I$ 给出。问题指定了库仑效率为1和一个对称循环，这意味着充电和放电的电流大小 $I$ 和持续时间 $\\Delta t$ 是相同的。因此，对于这两个过程，传输的总电荷 $I \\Delta t$ 等于 $C_{\\text{nom}}$。\n$$\nI \\Delta t_{\\text{ch}} = C_{\\text{nom}}\n$$\n$$\nI \\Delta t_{\\text{dis}} = C_{\\text{nom}}\n$$\n将此代入能量表达式中：\n$$\nE_{\\text{ch}} = (U + IR) C_{\\text{nom}}\n$$\n$$\nE_{\\text{dis}} = (U - IR) C_{\\text{nom}}\n$$\n现在，效率 $\\eta$ 可以表示为：\n$$\n\\eta = \\frac{E_{\\text{dis}}}{E_{\\text{ch}}} = \\frac{(U - IR) C_{\\text{nom}}}{(U + IR) C_{\\text{nom}}} = \\frac{U - IR}{U + IR}\n$$\n这个通用表达式表明，效率取决于开路电压、内阻和电流的大小。\n\n问题根据C倍率 $n$ 指定了两种情况。$n \\ \\text{C}$ 的倍率对应于电流 $I = n \\cdot Q_{\\text{nom}}$，其中 $Q_{\\text{nom}}$ 是以安培小时为单位的额定容量的数值。\n给定值：\n$U = 3.7\\ \\text{V}$\n$R = 4\\ \\text{m}\\Omega = 0.004\\ \\Omega$\n$C_{\\text{nom}} = 50\\ \\text{Ah}$，所以 $Q_{\\text{nom}} = 50$。\n\n情况1：$0.5\\ \\text{C}$ 倍率。\n电流为 $I_{0.5\\ \\text{C}} = 0.5 \\times 50\\ \\text{A} = 25\\ \\text{A}$。\n电阻上的压降（或压升）为 $I_{0.5\\ \\text{C}}R = 25\\ \\text{A} \\times 0.004\\ \\Omega = 0.1\\ \\text{V}$。\n效率为：\n$$\n\\eta_{0.5\\ \\text{C}} = \\frac{3.7 - 0.1}{3.7 + 0.1} = \\frac{3.6}{3.8} \\approx 0.947368...\n$$\n四舍五入到四位有效数字，$\\eta_{0.5\\ \\text{C}} = 0.9474$。\n\n情况2：$2\\ \\text{C}$ 倍率。\n电流为 $I_{2\\ \\text{C}} = 2 \\times 50\\ \\text{A} = 100\\ \\text{A}$。\n电阻上的压降（或压升）为 $I_{2\\ \\text{C}}R = 100\\ \\text{A} \\times 0.004\\ \\Omega = 0.4\\ \\text{V}$。\n效率为：\n$$\n\\eta_{2\\ \\text{C}} = \\frac{3.7 - 0.4}{3.7 + 0.4} = \\frac{3.3}{4.1} \\approx 0.804878...\n$$\n四舍五入到四位有效数字，$\\eta_{2\\ \\text{C}} = 0.8049$。\n\n最终结果是双分量行向量 $[\\eta_{0.5\\ \\text{C}}, \\eta_{2\\ \\text{C}}]$。",
            "answer": "$$\n\\boxed{[0.9474, 0.8049]}\n$$"
        },
        {
            "introduction": "现实世界中的电池系统常常连接到开关电源转换器，这会在直流电流上叠加高频纹波。本练习超越了简单的直流模型，探索这些电流波动如何影响能量损失。您将从第一性原理出发，推导纹波电流如何导致额外的焦耳热，这一现象对于精确建模效率和管理电动汽车及电网储能逆变器等应用中的热应力至关重要。",
            "id": "4077707",
            "problem": "为开关电源变换器供电的电池，其端子电流由于脉冲宽度调制而包含一个直流 (DC) 分量和一个叠加的纹波。假设在纹波频带内，电池的内阻抗主要由一个恒定的等效串联电阻 (ESR) $R$ 决定。设瞬时电流写作 $i(t)=I_{0}+\\tilde{i}(t)$，其中 $I_{0}$ 是一个开关周期内的时间平均（直流）电流，$\\tilde{i}(t)$ 是一个零均值纹波，即 $\\frac{1}{T}\\int_{0}^{T}\\tilde{i}(t)\\,\\mathrm{d}t=0$，$T$ 为开关周期。\n\n仅使用第一性原理，即对于一个电阻元件，瞬时焦耳热的定义为 $p(t)=v(t)i(t)$ 且 $v(t)=R\\,i(t)$，以及一个周期内的时间平均定义为 $\\langle x \\rangle \\equiv \\frac{1}{T}\\int_{0}^{T}x(t)\\,\\mathrm{d}t$，推导出一个平均焦耳损耗 $\\langle p \\rangle$ 的表达式，该表达式能清晰地分离直流电流和纹波各自的贡献。然后，将问题具体化到正弦纹波 $\\tilde{i}(t)=\\Delta I \\sin(\\omega t)$ 的情况，其振幅为 $\\Delta I$，角频率为 $\\omega$，并说明纹波如何使有效 $I^{2}R$ 损耗超过仅有直流分量时的值。\n\n最后，在平均电流 $I_{0}=50\\ \\text{A}$、电阻 $R=3\\ \\text{m}\\Omega$ 的条件下，估算当纹波振幅为平均电流的 $10\\%$ 时，完全由纹波引起的额外平均损耗。最终数值答案以瓦特 (W) 为单位表示，并四舍五入到四位有效数字。",
            "solution": "在电压为 $v(t)$、电流为 $i(t)$ 的电阻元件中，瞬时焦耳热由 $p(t)=v(t)i(t)$ 给出。对于线性电阻，$v(t)=R\\,i(t)$，因此\n$$\np(t)=R\\,i(t)^{2}.\n$$\n任何量 $x(t)$ 在一个周期 $T$ 内的时间平均定义为\n$$\n\\langle x \\rangle \\equiv \\frac{1}{T}\\int_{0}^{T}x(t)\\,\\mathrm{d}t.\n$$\n因此，平均焦耳损耗为\n$$\n\\langle p \\rangle = \\left\\langle R\\,i(t)^{2} \\right\\rangle = R\\,\\left\\langle i(t)^{2} \\right\\rangle.\n$$\n将电流分解为一个均值和一个零均值纹波：\n$$\ni(t) = I_{0} + \\tilde{i}(t), \\quad \\text{with} \\quad \\left\\langle \\tilde{i}(t) \\right\\rangle = 0.\n$$\n展开平方并取平均，\n$$\n\\left\\langle i(t)^{2} \\right\\rangle = \\left\\langle \\left(I_{0} + \\tilde{i}(t)\\right)^{2} \\right\\rangle = \\left\\langle I_{0}^{2} + 2 I_{0}\\tilde{i}(t) + \\tilde{i}(t)^{2} \\right\\rangle.\n$$\n利用平均的线性性质和零均值性质 $\\left\\langle \\tilde{i}(t) \\right\\rangle = 0$，我们得到\n$$\n\\left\\langle i(t)^{2} \\right\\rangle = I_{0}^{2} + 2 I_{0}\\left\\langle \\tilde{i}(t) \\right\\rangle + \\left\\langle \\tilde{i}(t)^{2} \\right\\rangle = I_{0}^{2} + \\left\\langle \\tilde{i}(t)^{2} \\right\\rangle.\n$$\n因此，平均焦耳损耗分离为直流分量的贡献和纹波分量的贡献：\n$$\n\\langle p \\rangle = R \\left( I_{0}^{2} + \\left\\langle \\tilde{i}(t)^{2} \\right\\rangle \\right).\n$$\n相对于纯直流损耗 $R I_{0}^{2}$，完全由纹波引起的增量损耗为\n$$\n\\Delta \\langle p \\rangle = R\\,\\left\\langle \\tilde{i}(t)^{2} \\right\\rangle.\n$$\n现在具体化到正弦纹波 $\\tilde{i}(t) = \\Delta I \\sin(\\omega t)$。正弦函数平方在一个周期内的时间平均是\n$$\n\\left\\langle \\sin^{2}(\\omega t) \\right\\rangle = \\frac{1}{2},\n$$\n所以\n$$\n\\left\\langle \\tilde{i}(t)^{2} \\right\\rangle = \\left\\langle \\Delta I^{2} \\sin^{2}(\\omega t) \\right\\rangle = \\Delta I^{2} \\left\\langle \\sin^{2}(\\omega t) \\right\\rangle = \\frac{\\Delta I^{2}}{2}.\n$$\n因此，由纹波引起的增量平均损耗为\n$$\n\\Delta \\langle p \\rangle = R \\,\\frac{\\Delta I^{2}}{2}.\n$$\n对于纹波振幅为平均电流 $10\\%$ 的情况，$\\Delta I = 0.1\\,I_{0}$。在 $I_{0} = 50\\ \\text{A}$ 和 $R = 3\\ \\text{m}\\Omega = 3 \\times 10^{-3}\\ \\Omega$ 的条件下，我们计算\n$$\n\\Delta I = 0.1 \\times 50 = 5,\n$$\n$$\n\\frac{\\Delta I^{2}}{2} = \\frac{5^{2}}{2} = \\frac{25}{2} = 12.5,\n$$\n因此\n$$\n\\Delta \\langle p \\rangle = R \\times 12.5 = \\left(3 \\times 10^{-3}\\right) \\times 12.5 = 0.0375.\n$$\n四舍五入到四位有效数字并以瓦特表示，由纹波引起的额外平均损耗为 $0.03750\\ \\text{W}$。",
            "answer": "$$\\boxed{0.03750}$$"
        },
        {
            "introduction": "在我们的最后一个练习中，我们将整合热效应，创建一个更复杂的电-热耦合模型，以反映电池电气状态与热状态之间的强耦合关系。您将分析内阻如何随温度变化，以及这种受冷却系统效能影响的动态相互作用最终如何决定运行期间的整体能量效率。此练习展示了耦合多物理场建模对于准确性能预测和热管理设计的必要性。",
            "id": "4077760",
            "problem": "一个单一集总参数电池模块的恒流放电过程，通过包含焦耳热和对流冷却的第一性原理能量平衡进行建模。目标是通过比较不同热导值下随温度变化的内阻轨迹，来评估冷却效果对能量效率的影响。该电池以电流 $I$ 放电，持续时间为 $t_f$，起始温度为环境温度 $T_{\\text{amb}}$。内阻随温度线性变化，关系式为 $R(T) = R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right)$，其中 $R_0$ 是在参考温度 $T_{\\text{ref}}$ 下与温度无关的基准电阻，$\\alpha$ 是电阻温度系数。热动态由一个单节点集总热容 $C_{\\text{th}}$ 表示，它通过一个总热导 $h$ 与环境进行对流换热。端电压为 $U_{\\text{term}}(t) = U_{\\text{oc}} - I\\,R(T(t))$，其中 $U_{\\text{oc}}$ 是开路电压 (OCV)，在所考虑的短时放电过程中假设为常数。\n\n从能量守恒定律以及焦耳热和对流传热的标准定义出发，确定放电期间的时间演化过程 $T(t)$ 以及相关的轨迹 $R(T(t))$。利用这些结果，计算在区间 $[0,t_f]$ 上的能量效率，其定义为输送到外部电路的有用电能与无内阻时的理想电能之比：\n$$\n\\eta = \\frac{\\int_0^{t_f} I\\,U_{\\text{term}}(t)\\,dt}{\\int_0^{t_f} I\\,U_{\\text{oc}}\\,dt},\n$$\n该效率必须表示为小数（而非百分比）。在您的推导和计算中，所有量和参数都必须采用国际单位制。\n\n您必须实现一个完整、可运行的程序，该程序对下面给出的测试套件中的每一组参数进行计算，并按规定格式输出能量效率。该程序应针对给定的线性温度依赖关系，精确求解热-阻动态，而无需使用数值时间步进。\n\n参数为：\n- 放电电流 $I$，单位为 $\\text{A}$，\n- 热导 $h$，单位为 $\\text{W}\\,\\text{K}^{-1}$，\n- 基准内阻 $R_0$，单位为 $\\Omega$，\n- 温度系数 $\\alpha$，单位为 $\\text{K}^{-1}$，\n- 热容 $C_{\\text{th}}$，单位为 $\\text{J}\\,\\text{K}^{-1}$，\n- 参考温度 $T_{\\text{ref}}$，单位为 $\\text{K}$，\n- 环境温度 $T_{\\text{amb}}$，单位为 $\\text{K}$，\n- 开路电压 $U_{\\text{oc}}$，单位为 $\\text{V}$，\n- 放电持续时间 $t_f$，单位为 $\\text{s}$。\n\n测试套件（每个案例都是独立的，应从第一性原理开始计算）：\n1. 基准冷却和负温度系数（正常路径）：$I = 40\\ \\text{A}$，$h = 5\\ \\text{W}\\,\\text{K}^{-1}$，$R_0 = 5\\times 10^{-3}\\ \\Omega$，$\\alpha = -2\\times 10^{-3}\\ \\text{K}^{-1}$，$C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$，$T_{\\text{ref}} = 298.15\\ \\text{K}$，$T_{\\text{amb}} = 298.15\\ \\text{K}$，$U_{\\text{oc}} = 3.7\\ \\text{V}$，$t_f = 600\\ \\text{s}$。\n2. 增强冷却（比较目标）：$I = 40\\ \\text{A}$，$h = 20\\ \\text{W}\\,\\text{K}^{-1}$，$R_0 = 5\\times 10^{-3}\\ \\Omega$，$\\alpha = -2\\times 10^{-3}\\ \\text{K}^{-1}$，$C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$，$T_{\\text{ref}} = 298.15\\ \\text{K}$，$T_{\\text{amb}} = 298.15\\ \\text{K}$，$U_{\\text{oc}} = 3.7\\ \\text{V}$，$t_f = 600\\ \\text{s}$。\n3. 绝热边界情况：$I = 40\\ \\text{A}$，$h = 0\\ \\text{W}\\,\\text{K}^{-1}$，$R_0 = 5\\times 10^{-3}\\ \\Omega$，$\\alpha = -2\\times 10^{-3}\\ \\text{K}^{-1}$，$C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$，$T_{\\text{ref}} = 298.15\\ \\text{K}$，$T_{\\text{amb}} = 298.15\\ \\text{K}$，$U_{\\text{oc}} = 3.7\\ \\text{V}$，$t_f = 600\\ \\text{s}$。\n4. 电阻与温度无关的边界情况：$I = 40\\ \\text{A}$，$h = 5\\ \\text{W}\\,\\text{K}^{-1}$，$R_0 = 5\\times 10^{-3}\\ \\Omega$，$\\alpha = 0\\ \\text{K}^{-1}$，$C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$，$T_{\\text{ref}} = 298.15\\ \\text{K}$，$T_{\\text{amb}} = 298.15\\ \\text{K}$，$U_{\\text{oc}} = 3.7\\ \\text{V}$，$t_f = 600\\ \\text{s}$。\n5. 正温度系数场景：$I = 40\\ \\text{A}$，$h = 5\\ \\text{W}\\,\\text{K}^{-1}$，$R_0 = 5\\times 10^{-3}\\ \\Omega$，$\\alpha = +2\\times 10^{-3}\\ \\text{K}^{-1}$，$C_{\\text{th}} = 900\\ \\text{J}\\,\\text{K}^{-1}$，$T_{\\text{ref}} = 298.15\\ \\text{K}$，$T_{\\text{amb}} = 298.15\\ \\text{K}$，$U_{\\text{oc}} = 3.7\\ \\text{V}$，$t_f = 600\\ \\text{s}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含五个测试案例的能量效率，格式为用方括号括起来的逗号分隔列表，每个效率表示为四舍五入到六位小数的小数（例如，$[0.950000,0.946000,0.948500,0.945946,0.945834]$）。不得打印任何其他文本。",
            "solution": "该问题要求计算正在进行恒流放电的电池模块的能量效率。求解过程需要确定电池温度的时间演化，这会进而影响其内阻，并因此影响其端电压和能量输出。解析解是从能量守恒的基本原理推导出来的。\n\n### 1. 热模型与控制方程\n\n集总热容电池模块的能量平衡由热力学第一定律给出。模块内能的变化率等于内部产热率减去向环境的散热率。\n$$\nC_{\\text{th}} \\frac{dT(t)}{dt} = P_{\\text{gen}}(t) - P_{\\text{loss}}(t)\n$$\n其中，$C_{\\text{th}}$ 是热容，$T(t)$ 是模块在时间 $t$ 的温度。\n\n产热 $P_{\\text{gen}}(t)$ 是由焦耳热引起的，由 $P_{\\text{gen}}(t) = I^2 R(T(t))$ 给出，其中 $I$ 是恒定放电电流，$R(T(t))$ 是随温度变化的内阻。\n\n散热 $P_{\\text{loss}}(t)$ 被建模为到周围环境的对流传热，由牛顿冷却定律描述：$P_{\\text{loss}}(t) = h(T(t) - T_{\\text{amb}})$，其中 $h$ 是热导，$T_{\\text{amb}}$ 是环境温度。\n\n将这些表达式代入能量平衡方程，得到：\n$$\nC_{\\text{th}} \\frac{dT(t)}{dt} = I^2 R(T(t)) - h(T(t) - T_{\\text{amb}})\n$$\n内阻由温度的线性函数给出：$R(T) = R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right)$。将其代入微分方程，得到：\n$$\nC_{\\text{th}} \\frac{dT}{dt} = I^2 R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right) - h(T - T_{\\text{amb}})\n$$\n为了求解此方程，我们将其整理成一阶线性常微分方程的标准形式 $\\frac{dT}{dt} + pT = q$。\n$$\nC_{\\text{th}} \\frac{dT}{dt} = I^2 R_0 + I^2 R_0 \\alpha T - I^2 R_0 \\alpha T_{\\text{ref}} - hT + hT_{\\text{amb}}\n$$\n$$\nC_{\\text{th}} \\frac{dT}{dt} + (h - I^2 R_0 \\alpha)T = I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}\n$$\n两边同除以 $C_{\\text{th}}$，我们得到：\n$$\n\\frac{dT}{dt} + \\left(\\frac{h - I^2 R_0 \\alpha}{C_{\\text{th}}}\\right)T = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{C_{\\text{th}}}\n$$\n我们定义常数 $k_1$ 和 $k_2$：\n$$\nk_1 = \\frac{h - I^2 R_0 \\alpha}{C_{\\text{th}}}\n$$\n$$\nk_2 = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{C_{\\text{th}}}\n$$\n现在微分方程为 $\\frac{dT}{dt} + k_1 T = k_2$。\n\n### 2. 温度演化的解析解\n\n这是一个一阶线性常系数常微分方程。其解由暂态部分和稳态部分组成。当 $\\frac{dT}{dt} = 0$ 时达到稳态温度 $T_{ss}$，这给出 $k_1 T_{ss} = k_2$，因此 $T_{ss} = \\frac{k_2}{k_1}$。\n$$\nT_{ss} = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{h - I^2 R_0 \\alpha}\n$$\n通解的形式为 $T(t) = T_{ss} + C e^{-k_1 t}$，其中 $C$ 是由初始条件确定的积分常数。问题设定电池的初始温度为环境温度，因此 $T(0) = T_{\\text{amb}}$。\n$$\nT(0) = T_{ss} + C e^0 = T_{ss} + C = T_{\\text{amb}} \\implies C = T_{\\text{amb}} - T_{ss}\n$$\n因此，温度随时间变化的解析解为：\n$$\nT(t) = T_{ss} + (T_{\\text{amb}} - T_{ss}) e^{-k_1 t}\n$$\n该解在 $k_1 \\neq 0$ 时有效，这等价于 $h - I^2 R_0 \\alpha \\neq 0$。对于所有提供的测试案例，该条件均成立。\n\n### 3. 能量效率计算\n\n能量效率 $\\eta$ 定义为输送到外部电路的有用电能与电源可提供的理想电能（无内阻时）之比：\n$$\n\\eta = \\frac{\\int_0^{t_f} I\\,U_{\\text{term}}(t)\\,dt}{\\int_0^{t_f} I\\,U_{\\text{oc}}\\,dt}\n$$\n鉴于 $I$ 和 $U_{\\text{oc}}$ 是常数，公式可以简化。代入 $U_{\\text{term}}(t) = U_{\\text{oc}} - I R(T(t))$：\n$$\n\\eta = \\frac{\\int_0^{t_f} I(U_{\\text{oc}} - I R(T(t)))\\,dt}{I U_{\\text{oc}} t_f} = \\frac{I U_{\\text{oc}} t_f - I^2 \\int_0^{t_f} R(T(t))\\,dt}{I U_{\\text{oc}} t_f}\n$$\n$$\n\\eta = 1 - \\frac{I}{U_{\\text{oc}} t_f} \\int_0^{t_f} R(T(t))\\,dt\n$$\n为了计算 $\\eta$，我们必须评估电阻的时间积分 $\\mathcal{I}_R = \\int_0^{t_f} R(T(t))\\,dt$。\n$$\n\\mathcal{I}_R = \\int_0^{t_f} R_0\\left(1 + \\alpha(T(t) - T_{\\text{ref}})\\right)dt = \\int_0^{t_f} \\left(R_0(1 - \\alpha T_{\\text{ref}}) + R_0 \\alpha T(t)\\right)dt\n$$\n$$\n\\mathcal{I}_R = R_0(1 - \\alpha T_{\\text{ref}}) t_f + R_0 \\alpha \\int_0^{t_f} T(t)\\,dt\n$$\n设 $\\mathcal{I}_T = \\int_0^{t_f} T(t)\\,dt$。我们可以对 $T(t)$ 的表达式进行积分：\n$$\n\\mathcal{I}_T = \\int_0^{t_f} \\left( T_{ss} + (T_{\\text{amb}} - T_{ss}) e^{-k_1 t} \\right) dt\n$$\n$$\n\\mathcal{I}_T = \\left[ T_{ss} t + \\frac{T_{\\text{amb}} - T_{ss}}{-k_1} e^{-k_1 t} \\right]_0^{t_f}\n$$\n$$\n\\mathcal{I}_T = T_{ss} t_f + \\frac{T_{ss} - T_{\\text{amb}}}{k_1} (e^{-k_1 t_f} - 1)\n$$\n通过将 $\\mathcal{I}_T$ 代入 $\\mathcal{I}_R$ 的表达式，再将 $\\mathcal{I}_R$ 代入 $\\eta$ 的公式，我们可以计算出每组参数下的能量效率。\n\n### 4. 特殊情况\n\n-   **电阻与温度无关（$\\alpha=0$）**：在这种情况下，$R(T) = R_0$ 是一个常数。积分 $\\mathcal{I}_R = R_0 t_f$，效率简化为 $\\eta = 1 - \\frac{I R_0}{U_{\\text{oc}}}$。我们的通用公式能正确地简化到这个极限情况。\n-   **绝热情况（$h=0$）**：公式仍然有效。$k_1 = -I^2 R_0 \\alpha / C_{\\text{th}}$ 且 $T_{ss} = T_{\\text{ref}} - 1/\\alpha$。\n-   **临界条件（$h - I^2 R_0 \\alpha=0$）**：在这种情况下，$k_1=0$。常微分方程变为 $\\frac{dT}{dt} = k_2$，导致温度线性上升：$T(t) = T_{\\text{amb}} + k_2 t$。积分 $\\mathcal{I}_T$ 将为 $T_{\\text{amb}} t_f + \\frac{1}{2} k_2 t_f^2$。在提供的测试套件中未遇到此情况，但为了稳健性已作处理。\n\n每个测试案例的计算步骤是：首先计算 $k_1$ 和 $T_{ss}$，然后评估 $\\mathcal{I}_T$，接着计算 $\\mathcal{I}_R$，最后计算 $\\eta$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the energy efficiency for battery discharge scenarios.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Baseline cooling and negative temperature coefficient\n        (40.0, 5.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 2: Stronger cooling\n        (40.0, 20.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 3: Adiabatic edge case\n        (40.0, 0.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 4: Temperature-independent resistance boundary\n        (40.0, 5.0, 5e-3, 0.0, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 5: Positive temperature coefficient scenario\n        (40.0, 5.0, 5e-3, 2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        eff = calculate_efficiency(*params)\n        results.append(f\"{eff:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_efficiency(I, h, R0, alpha, C_th, T_ref, T_amb, U_oc, t_f):\n    \"\"\"\n    Computes the energy efficiency for a given set of battery parameters.\n\n    The function first solves the ordinary differential equation for temperature T(t)\n    analytically, then integrates the resulting resistance R(T(t)) over time to\n    find the total energy loss and efficiency.\n    \"\"\"\n    \n    # Special case: alpha = 0 (temperature-independent resistance)\n    if alpha == 0:\n        eta = 1 - (I * R0) / U_oc\n        return eta\n\n    # This term appears in the denominator of T_ss and the definition of k1\n    denominator_term = h - I**2 * R0 * alpha\n\n    # This is a special case when k1=0, leading to a linear temperature profile.\n    # Handled with a small tolerance for floating-point arithmetic.\n    if abs(denominator_term)  1e-12:\n        k2 = (I**2 * R0 * (1 - alpha * T_ref) + h * T_amb) / C_th\n        # T(t) = T_amb + k2*t, so its integral is T_amb*t_f + 0.5*k2*t_f^2\n        integral_T = T_amb * t_f + 0.5 * k2 * t_f**2\n    else:\n        # General case (k1 != 0)\n        # Constant k1 for the ODE dT/dt + k1*T = k2\n        k1 = denominator_term / C_th\n        \n        # Steady-state temperature\n        T_ss = (I**2 * R0 * (1 - alpha * T_ref) + h * T_amb) / denominator_term\n        \n        # Analytical integral of T(t) from 0 to t_f\n        # T(t) = T_ss + (T_amb - T_ss) * exp(-k1*t)\n        integral_T = T_ss * t_f + (T_ss - T_amb) / k1 * (np.exp(-k1 * t_f) - 1.0)\n\n    # Integral of resistance R(t) from 0 to t_f\n    # R(t) = R0 * (1 - alpha*T_ref) + R0*alpha*T(t)\n    integral_R = R0 * (1 - alpha * T_ref) * t_f + R0 * alpha * integral_T\n\n    # Energy efficiency eta = 1 - (I * integral_R) / (U_oc * t_f)\n    eta = 1 - (I / (U_oc * t_f)) * integral_R\n\n    return eta\n\nsolve()\n```"
        }
    ]
}