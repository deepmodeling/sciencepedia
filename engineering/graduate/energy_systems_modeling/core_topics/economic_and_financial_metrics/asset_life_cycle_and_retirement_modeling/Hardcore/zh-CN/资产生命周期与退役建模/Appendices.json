{
    "hands_on_practices": [
        {
            "introduction": "资产搁浅是能源转型中的一个核心金融问题。当发电厂等长期资产因市场或政策变化而提前退役时，其在账面上尚未折旧的价值可能无法完全收回。本练习将通过一个具体案例，帮助您掌握如何量化这种被称为“搁浅成本”的财务影响，您将结合直线折旧法等会计准则与资产残值等市场现实，推导出搁浅资产净现值的解析表达式。",
            "id": "4069753",
            "problem": "一家投资者拥有的电力公司在第0年将一座基荷发电厂投入运营，其初始资本化成本为$C_0$美元。该发电厂被纳入受监管的费率基数，并采用直线折旧法在$n$年的监管年限内进行折旧，折旧计划中不包括期末残值。在第$t$年（其中$0  t  n$），由于市场和政策的变化，该电力公司提前退役了该发电厂，从而触发了搁浅成本的计算。为确保科学上的真实性并避免歧义，假设以下条件成立：$C_0  0$，$n \\in \\mathbb{N}$，$t \\in (0,n)$，$\\sigma \\in [0,1)$，$\\lambda  0$，$\\delta \\ge 0$ 以及 $r  -1$。\n\n在退役时，该发电厂产生一个市场残值，该残值随日历时间呈指数衰减：$S(t) = \\sigma C_0 \\exp(-\\lambda t)$，其中$\\sigma$是在$t=0$时可回收的$C_0$的比例，$\\lambda$是一个非负的陈旧化参数。在退役时的退役和拆除工作会产生与初始成本成正比的现金成本，在$t$时等于$\\delta C_0$。该电力公司将搁浅账面价值评估为$t$时刻未回收的账面价值（扣除残值并计入拆除成本），然后使用一个恒定的真实贴现率$r$计算其在第0年的净现值（NPV）。\n\n从直线折旧和账面价值的核心定义出发，并使用指定的残值和拆除模型，推导出一个因在第$t$年提前退役而产生的搁浅账面价值的第0年现值的封闭形式解析表达式。请将您的最终答案以美元（USD）为单位，表示为一个包含$C_0$、$n$、$t$、$\\sigma$、$\\lambda$、$\\delta$和$r$的单一符号表达式。不要代入具体数值。无需进行四舍五入。",
            "solution": "在尝试提供解决方案之前，需对问题进行验证。\n\n### 第1步：提取已知条件\n- 初始资本化成本：$C_0$\n- 投入使用年份：$0$\n- 折旧方法：直线法\n- 折旧的监管年限：$n$年\n- 折旧计划中的期末残值：$0$\n- 提前退役年份：$t$，其中$0  t  n$\n- 第$t$年的市场残值：$S(t) = \\sigma C_0 \\exp(-\\lambda t)$\n- 第$t$年的退役和拆除成本：$\\delta C_0$\n- 搁浅账面价值的定义：$t$时刻的未回收账面价值，扣除残值并计入拆除成本。\n- 用于计算第0年净现值（NPV）的贴现率：$r$\n- 参数约束：$C_0  0$, $n \\in \\mathbb{N}$, $t \\in (0,n)$, $\\sigma \\in [0,1)$, $\\lambda  0$, $\\delta \\ge 0$, and $r  -1$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，提法明确且客观。它基于工程经济学和财务会计学的标准、公认原则，特别是应用于能源领域的资本密集型资产。所有术语都定义清晰，并提供了足够的信息来推导出唯一的解析解。参数的约束在物理上和经济上都是合理的。“扣除残值并计入拆除成本”（net of salvage and net of removal costs）这一措辞需要解释，但唯一经济上合理的解释是，残值（现金流入）减少了搁浅金额，而拆除成本（现金流出）则增加了搁浅金额。任何其他解释都将是毫无意义的。因此，该问题被认定为有效。\n\n### 第3步：结论与行动\n该问题有效。将提供一个完整的、有理有据的解决方案。\n\n推导过程分三步进行：\n1.  计算资产在退役时刻$t$的账面价值。\n2.  计算在时刻$t$产生的总搁浅成本。\n3.  将搁浅成本折现回第0年，以计算其净现值（NPV）。\n\n**1. 第$t$年的账面价值**\n\n资产采用直线法在$n$年的监管年限内进行折旧。初始成本为$C_0$，问题指明折旧计划中的期末残值为零。\n\n年度折旧费用$D$是应计折旧基数除以资产寿命：\n$$D = \\frac{C_0 - 0}{n} = \\frac{C_0}{n}$$\n在第$t$年，累计折旧总额$A(t)$是年度折旧乘以电厂已投入使用的年数：\n$$A(t) = D \\times t = \\frac{C_0 t}{n}$$\n在任意时刻$t$的账面价值$B(t)$是初始成本减去累计折旧：\n$$B(t) = C_0 - A(t) = C_0 - \\frac{C_0 t}{n}$$\n提出因子$C_0$，我们得到退役时刻账面价值的表达式：\n$$B(t) = C_0 \\left(1 - \\frac{t}{n}\\right)$$\n\n**2. 第$t$年的搁浅成本**\n\n问题将搁浅账面价值定义为$t$时刻的未回收账面价值，扣除残值并计入拆除成本。这代表了在退役时刻（第$t$年）产生的总财务损失或成本。我们将其表示为$SC(t)$。\n\n- 未回收的账面价值为$B(t)$。\n- 市场残值$S(t) = \\sigma C_0 \\exp(-\\lambda t)$是一笔减少损失的现金流入。\n- 退役和拆除成本$\\delta C_0$是一笔增加损失的现金流出。\n\n因此，在时刻$t$的搁浅成本计算如下：\n$$SC(t) = B(t) - S(t) + \\delta C_0$$\n代入$B(t)$和$S(t)$的表达式：\n$$SC(t) = C_0 \\left(1 - \\frac{t}{n}\\right) - \\sigma C_0 \\exp(-\\lambda t) + \\delta C_0$$\n我们可以提出初始成本$C_0$以简化在第$t$年产生的总搁浅成本的表达式：\n$$SC(t) = C_0 \\left[ \\left(1 - \\frac{t}{n}\\right) - \\sigma \\exp(-\\lambda t) + \\delta \\right]$$\n\n**3. 第0年的净现值**\n\n搁浅成本$SC(t)$是在第$t$年发生的一笔一次性现金流。问题要求使用恒定的真实贴现率$r$计算此成本在第0年的净现值（NPV）。该现值我们称之为$V_0$，通过将未来现金流$SC(t)$向前折现$t$年得到。\n\n$t$时刻单笔支付的折现因子是$(1+r)^{-t}$。约束条件$r  -1$确保了指数的底数$1+r$为正。\n因此，第0年的净现值（NPV）为：\n$$V_0 = SC(t) \\cdot (1+r)^{-t}$$\n代入$SC(t)$的表达式：\n$$V_0 = \\left( C_0 \\left[ \\left(1 - \\frac{t}{n}\\right) - \\sigma \\exp(-\\lambda t) + \\delta \\right] \\right) (1+r)^{-t}$$\n重新整理各项，得到搁浅账面价值的第0年现值的最终封闭形式解析表达式：\n$$V_0 = C_0 (1+r)^{-t} \\left(1 - \\frac{t}{n} - \\sigma \\exp(-\\lambda t) + \\delta \\right)$$\n该表达式按要求以给定的参数$C_0$、$n$、$t$、$\\sigma$、$\\lambda$、$\\delta$和$r$表示。",
            "answer": "$$\\boxed{C_0 (1+r)^{-t} \\left(1 - \\frac{t}{n} - \\sigma \\exp(-\\lambda t) + \\delta \\right)}$$"
        },
        {
            "introduction": "资产的退役决策不仅取决于其账面价值，更关键的是其运营的经济性。随着设备老化，运营维护成本和灾难性故障风险会逐渐增加，最终可能侵蚀其发电利润。本练习将引导您进行一项盈亏平衡分析，通过建立一个数学模型来权衡发电毛利润与随役龄增长的成本，从而确定资产达到其经济寿命终点的确切役龄。",
            "id": "4069721",
            "problem": "考虑一个单机组热力发电机，其铭牌功率为 $P$（单位：兆瓦），以恒定的容量因子 $\\mathrm{CF}$（无量纲）调度运行，生产的电力以恒定价格 $p$（单位：美元/兆瓦时）出售。设不包括与役龄相关的运营和维护（OM）成本的可变成本为 $c_{\\mathrm{var}}$（单位：美元/兆瓦时）。将扣除与役龄相关成本前的单位能源毛营业利润定义为 $m_{0} \\equiv p - c_{\\mathrm{var}}$（单位：美元/兆瓦时）。假设资产役龄为 $a$（单位：年）时，与役龄相关的单位能源运维成本为 $c_{\\mathrm{O\\}}(a) = c_{0} + \\alpha a$（单位：美元/兆瓦时），其中 $c_{0} \\ge 0$ 和 $\\alpha \\ge 0$ 是常数。该资产会发生灾难性故障，其模型由一个威布尔风险函数描述，该函数具有形状参数 $\\beta  0$ 和尺度参数 $\\eta  0$，因此在役龄 $a$ 时的瞬时风险率为 $h(a) = \\frac{\\beta}{\\eta^{\\beta}} a^{\\beta - 1}$（单位：年分之一）。每次灾难性故障会造成集中的经济后果 $C_{f}$（单位：美元），包括维修和短缺成本。假设故障足够罕见，以至于在役龄 $a$ 时的预期故障成本率可以近似为 $C_{f} h(a)$（单位：美元/年）。在长度为 $T$（单位：小时）的时间间隔内，预期发电量为 $E = P \\cdot \\mathrm{CF} \\cdot T$（单位：兆瓦时）。将盈亏平衡退役役龄 $a^{\\star}$ 视为使瞬时预期单位能源净运营盈余（扣除与役龄相关成本前的毛利润减去预期的与役龄相关的单位能源成本）为非正的最小役龄。\n\n仅使用这些定义以及风险函数和容量因子的标准属性，确定以下参数值对应的 $a^{\\star}$：\n- $P = 500$ 兆瓦，\n- $\\mathrm{CF} = 0.70$,\n- $p = 55$ 美元/兆瓦时，\n- $c_{\\mathrm{var}} = 32$ 美元/兆瓦时，因此 $m_{0} = p - c_{\\mathrm{var}}$,\n- $c_{0} = 3.5$ 美元/兆瓦时，\n- $\\alpha = 0.40$ 美元/兆瓦时/年，\n- $\\beta = 2$ 且 $\\eta = 30$ 年（因此 $h(a) = \\frac{\\beta}{\\eta^{\\beta}} a^{\\beta - 1}$），\n- $C_{f} = 5.0 \\times 10^{7}$ 美元。\n\n将你的最终答案表示为盈亏平衡役龄 $a^{\\star}$（单位：年），并四舍五入到四位有效数字。最终答案只陈述数值。",
            "solution": "该问题要求计算热力发电机的盈亏平衡退役役龄 $a^{\\star}$。该役龄被定义为使瞬时预期单位能源净运营盈余为非正的最小役龄。我们必须首先构建该盈余的表达式。\n\n在役龄 $a$ 时，瞬时预期单位能源净运营盈余（记为 $S(a)$）是单位能源的毛营业利润减去所有预期的与役龄相关的单位能源成本。\n\n单位能源的毛营业利润 $m_0$ 由电价 $p$ 和可变成本 $c_{\\mathrm{var}}$ 之差给出：\n$$m_0 = p - c_{\\mathrm{var}}$$\n\n与役龄相关的成本包括两个部分：与役龄相关的运营和维护（OM）成本 $c_{\\mathrm{O\\}}(a)$，以及灾难性故障的预期成本（我们将其记为 $c_{\\mathrm{fail}}(a)$）。两者都必须以美元/兆瓦时表示。\n\n单位能源的与役龄相关的运维成本由以下线性函数直接给出：\n$$c_{\\mathrm{O\\}}(a) = c_{0} + \\alpha a$$\n其中 $a$ 是以年为单位的役龄，$c_0$ 是基础成本，$\\alpha$ 是成本增长率。\n\n单位能源的灾难性故障预期成本 $c_{\\mathrm{fail}}(a)$ 必须推导得出。问题陈述，在役龄 $a$ 时的预期故障成本率为 $C_f h(a)$，其中 $C_f$ 是单次故障的集中成本，$h(a)$ 是瞬时风险率。该成本率的单位是美元/年。要将其转换为单位能源成本（美元/兆瓦时），我们必须用它除以年发电率。\n\n年发电量 $E_{\\mathrm{yr}}$ 是铭牌功率 $P$、容量因子 $\\mathrm{CF}$ 和一年中的小时数 $H_{\\mathrm{yr}}$ 的乘积。我们使用 $H_{\\mathrm{yr}} = 24 \\frac{\\text{小时}}{\\text{天}} \\times 365.25 \\frac{\\text{天}}{\\text{年}} = 8766 \\frac{\\text{小时}}{\\text{年}}$。\n$$E_{\\mathrm{yr}} = P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}}$$\n$E_{\\mathrm{yr}}$ 的单位是兆瓦时/年。\n\n因此，单位能源的预期故障成本为：\n$$c_{\\mathrm{fail}}(a) = \\frac{C_f h(a)}{E_{\\mathrm{yr}}} = \\frac{C_f h(a)}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}}}$$\n风险函数由威布尔分布给出：\n$$h(a) = \\frac{\\beta}{\\eta^{\\beta}} a^{\\beta - 1}$$\n将此代入 $c_{\\mathrm{fail}}(a)$ 的表达式中：\n$$c_{\\mathrm{fail}}(a) = \\frac{C_f}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}}} \\left( \\frac{\\beta}{\\eta^{\\beta}} a^{\\beta - 1} \\right)$$\n\n现在，我们可以写出单位能源净运营盈余 $S(a)$ 的完整表达式：\n$$S(a) = m_0 - \\left( c_{\\mathrm{O\\}}(a) + c_{\\mathrm{fail}}(a) \\right)$$\n$$S(a) = (p - c_{\\mathrm{var}}) - \\left( (c_0 + \\alpha a) + \\frac{C_f \\beta}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}} \\cdot \\eta^{\\beta}} a^{\\beta - 1} \\right)$$\n\n盈亏平衡退役役龄 $a^{\\star}$ 是使 $S(a) \\le 0$ 的最小役龄 $a$。我们通过求解 $S(a^{\\star}) = 0$ 来找到它。\n$$(p - c_{\\mathrm{var}}) - c_0 - \\alpha a^{\\star} - \\frac{C_f \\beta}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}} \\cdot \\eta^{\\beta}} (a^{\\star})^{\\beta - 1} = 0$$\n让我们代入给定的参数值：\n- $P = 500$ 兆瓦\n- $\\mathrm{CF} = 0.70$\n- $p = 55$ 美元/兆瓦时\n- $c_{\\mathrm{var}} = 32$ 美元/兆瓦时\n- $m_0 = p - c_{\\mathrm{var}} = 55 - 32 = 23$ 美元/兆瓦时\n- $c_{0} = 3.5$ 美元/兆瓦时\n- $\\alpha = 0.40$ 美元/兆瓦时/年\n- $\\beta = 2$\n- $\\eta = 30$ 年\n- $C_{f} = 5.0 \\times 10^{7}$ 美元\n- $H_{\\mathrm{yr}} = 8766$ 小时/年\n\n当 $\\beta=2$ 时，方程显著简化。项 $(a^{\\star})^{\\beta-1}$ 变为 $(a^{\\star})^{2-1} = a^{\\star}$。\n方程变为关于 $a^{\\star}$ 的线性方程：\n$$m_0 - c_0 - \\alpha a^{\\star} - \\frac{2 C_f}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}} \\cdot \\eta^2} a^{\\star} = 0$$\n我们可以重新整理此方程以求解 $a^{\\star}$：\n$$m_0 - c_0 = \\alpha a^{\\star} + \\frac{2 C_f}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}} \\cdot \\eta^2} a^{\\star}$$\n$$m_0 - c_0 = \\left( \\alpha + \\frac{2 C_f}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}} \\cdot \\eta^2} \\right) a^{\\star}$$\n$$a^{\\star} = \\frac{m_0 - c_0}{\\alpha + \\frac{2 C_f}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}} \\cdot \\eta^2}}$$\n\n现在，我们将数值代入此表达式。\n分子是：\n$m_0 - c_0 = 23 - 3.5 = 19.5$\n\n分母有两部分。第一部分是 $\\alpha = 0.40$。第二部分是故障成本项：\n$$\\frac{2 C_f}{P \\cdot \\mathrm{CF} \\cdot H_{\\mathrm{yr}} \\cdot \\eta^2} = \\frac{2 \\cdot (5.0 \\times 10^7)}{500 \\cdot 0.70 \\cdot 8766 \\cdot 30^2}$$\n$$ = \\frac{1.0 \\times 10^8}{350 \\cdot 8766 \\cdot 900}$$\n$$ = \\frac{1.0 \\times 10^8}{3068100 \\cdot 900}$$\n$$ = \\frac{1.0 \\times 10^8}{2761290000} \\approx 0.036215305$$\n分母是：\n$$0.40 + 0.036215305 = 0.436215305$$\n\n最后，我们计算 $a^{\\star}$：\n$$a^{\\star} = \\frac{19.5}{0.436215305} \\approx 44.70275$$\n问题要求答案四舍五入到四位有效数字。\n$$a^{\\star} \\approx 44.70$$\n退役役龄 $a^{\\star}$ 约为 $44.70$ 年。在给定参数下，盈余函数 $S(a)$ 在 $a=0$ 时为正，并且对于 $a \\ge 0$ 是一个严格递减函数，因此这个解是唯一的。",
            "answer": "$$\\boxed{44.70}$$"
        },
        {
            "introduction": "在现实世界中，单个资产的投资与退役决策并非孤立进行，而必须服务于整个能源系统的宏观目标，例如以最低成本满足不断变化的电力需求。这个综合性练习将挑战您构建并求解一个多周期的线性规划模型。通过该模型，您将在满足系统需求和碳排放政策等多重约束下，对新建产能投资和老旧机组退役进行联合优化，从而深刻理解系统层面的资产组合管理策略。",
            "id": "4069793",
            "problem": "考虑一个电力系统的多周期容量扩张与退役规划问题，该系统拥有多种发电技术。规划者必须决定投资和退役计划，以满足外生指定的需求，同时最小化系统总贴现成本。系统规划期包含$T$个离散时期，索引为$t \\in \\{1,2,\\dots,T\\}$，技术索引为$k \\in \\{1,2,\\dots,K\\}$。必须使用以下基本建模基础：\n\n- 能量平衡：对于每个时期$t$，总发电量必须等于需求，即$\\sum_{k} G_{t,k} = D_t$，其中$G_{t,k}$是时期$t$技术$k$的发电量，$D_t$是时期$t$的需求。\n- 物理容量限制：发电量受可用容量和容量因子的限制，即$G_{t,k} \\leq H \\cdot \\text{CF}_k \\cdot \\left(R_{t,k}^{\\text{old}} + N_{t,k}^{\\text{new}}\\right)$，其中$H$是每时期的小时数，$\\text{CF}_k$是技术$k$的容量因子，$R_{t,k}^{\\text{old}}$是时期$t$技术$k$的在役剩余旧容量，$N_{t,k}^{\\text{new}}$是时期$t$技术$k$的在役新容量。\n- 资本存量演变与退役：旧容量的演变遵循$R_{t,k}^{\\text{old}} + V_{t,k}^{\\text{ret}} = R_{t-1,k}^{\\text{old}} - M_{t,k}$（对于$t \\geq 2$）和$R_{1,k}^{\\text{old}} + V_{1,k}^{\\text{ret}} = R_{0,k}^{\\text{old}} - M_{1,k}$（对于$t=1$），其中$V_{t,k}^{\\text{ret}} \\geq 0$是时期$t$旧容量的自愿退役量，$M_{t,k} \\geq 0$是时期$t$旧容量的外生强制退役量。初始旧容量$R_{0,k}^{\\text{old}}$是给定的。在役新容量是先前投资的累积总和，存在一期的建设滞后，即$N_{t,k}^{\\text{new}} = \\sum_{s=1}^{t-1} I_{s,k}$（对于$t \\geq 2$）和$N_{1,k}^{\\text{new}} = 0$（对于$t=1$），其中$I_{t,k} \\geq 0$是时期$t$对技术$k$新容量的投资。\n- 成本核算与贴现：目标是最小化总净现值（NPV），定义为所有时期成本的现值。各时期成本包括燃料成本、可变运维成本、碳排放成本、固定运维成本和投资成本。贴现因子 $d_t = \\frac{1}{(1+r)^t}$（贴现率为$r$）适用于时期$t$的支出。\n\n决策变量为$G_{t,k} \\geq 0$、$I_{t,k} \\geq 0$、$V_{t,k}^{\\text{ret}} \\geq 0$、$R_{t,k}^{\\text{old}} \\geq 0$和$N_{t,k}^{\\text{new}} \\geq 0$。参数包括$D_t$（单位：兆瓦时）、$H$（单位：小时）、$\\text{CF}_k$、燃料成本$c_k^{\\text{fuel}}$（单位：美元/兆瓦时）、可变运维成本$c_k^{\\text{vom}}$（单位：美元/兆瓦时）、排放强度$e_k$（单位：公吨二氧化碳/兆瓦时）、碳价$p_t^{\\text{CO2}}$（单位：美元/公吨二氧化碳）、固定运维成本$c_k^{\\text{fom}}$（单位：美元/兆瓦/时期）、资本成本$C_k^{\\text{capex}}$（单位：美元/兆瓦）、强制退役量$M_{t,k}$（单位：兆瓦）、初始旧容量$R_{0,k}^{\\text{old}}$（单位：兆瓦）和贴现率$r$（小数）。所有物理变量必须以其指定单位表示。目标函数为：\n$$\n\\min \\sum_{t=1}^{T} d_t \\left[ \\sum_{k=1}^{K} \\left( \\left(c_k^{\\text{fuel}} + c_k^{\\text{vom}} + p_t^{\\text{CO2}} \\cdot e_k \\right) G_{t,k} + c_k^{\\text{fom}} \\left(R_{t,k}^{\\text{old}} + N_{t,k}^{\\text{new}}\\right) \\right) \\right] + \\sum_{t=1}^{T} d_t \\sum_{k=1}^{K} C_k^{\\text{capex}} I_{t,k}.\n$$\n\n你的任务是使用任何现代编程语言，根据下面提供的约束和参数，实现一个程序来构建和求解这个线性优化模型。程序必须计算最优总贴现成本（单位：美元），并为每个测试案例输出以百万美元为单位的结果，四舍五入到两位小数。不涉及角度，因此不需要角度单位。\n\n测试套件：\n- 测试案例1（均衡增长，中等碳价）：\n    - $T = 4$，$K = 2$，技术：煤电（$k=1$）、风电（$k=2$）。\n    - $H = 8760$ 小时。\n    - 需求$D_t$（单位：兆瓦时）：$[6{,}000{,}000, 6{,}400{,}000, 6{,}800{,}000, 7{,}200{,}000]$。\n    - 容量因子$\\text{CF}_k$：煤电$0.85$，风电$0.35$。\n    - 初始旧容量$R_{0,k}^{\\text{old}}$（单位：兆瓦）：煤电$1000$，风电$200$。\n    - 强制退役量$M_{t,k}$（单位：兆瓦）：煤电$[0, 100, 200, 0]$，风电$[0, 0, 0, 0]$。\n    - 燃料成本$c_k^{\\text{fuel}}$（单位：美元/兆瓦时）：煤电$20$，风电$0$。\n    - 可变运维成本$c_k^{\\text{vom}}$（单位：美元/兆瓦时）：煤电$3$，风电$8$。\n    - 排放强度$e_k$（单位：公吨二氧化碳/兆瓦时）：煤电$0.9$，风电$0.0$。\n    - 碳价$p_t^{\\text{CO2}}$（单位：美元/公吨二氧化碳）：$[30, 40, 50, 60]$。\n    - 固定运维成本$c_k^{\\text{fom}}$（单位：美元/兆瓦/时期）：煤电$40{,}000$，风电$30{,}000$。\n    - 资本成本$C_k^{\\text{capex}}$（单位：美元/兆瓦）：煤电$1{,}300{,}000$，风电$1{,}600{,}000$。\n    - 贴现率$r = 0.07$。\n- 测试案例2（高碳价，急剧退役）：\n    - $T = 4$，$K = 2$，技术：煤电（$k=1$）、风电（$k=2$）。\n    - $H = 8760$ 小时。\n    - 需求$D_t$（单位：兆瓦时）：$[5{,}000{,}000, 5{,}200{,}000, 5{,}400{,}000, 5{,}600{,}000]$。\n    - 容量因子$\\text{CF}_k$：煤电$0.85$，风电$0.35$。\n    - 初始旧容量$R_{0,k}^{\\text{old}}$（单位：兆瓦）：煤电$800$，风电$0$。\n    - 强制退役量$M_{t,k}$（单位：兆瓦）：煤电$[0, 400, 400, 0]$，风电$[0, 0, 0, 0]$。\n    - 燃料成本$c_k^{\\text{fuel}}$（单位：美元/兆瓦时）：煤电$20$，风电$0$。\n    - 可变运维成本$c_k^{\\text{vom}}$（单位：美元/兆瓦时）：煤电$3$，风电$8$。\n    - 排放强度$e_k$（单位：公吨二氧化碳/兆瓦时）：煤电$0.9$，风电$0.0$。\n    - 碳价$p_t^{\\text{CO2}}$（单位：美元/公吨二氧化碳）：$[100, 120, 140, 160]$。\n    - 固定运维成本$c_k^{\\text{fom}}$（单位：美元/兆瓦/时期）：煤电$40{,}000$，风电$30{,}000$。\n    - 资本成本$C_k^{\\text{capex}}$（单位：美元/兆瓦）：煤电$1{,}300{,}000$，风电$1{,}600{,}000$。\n    - 贴现率$r = 0.07$。\n- 测试案例3（需求下降，低碳价）：\n    - $T = 4$，$K = 2$，技术：煤电（$k=1$）、风电（$k=2$）。\n    - $H = 8760$ 小时。\n    - 需求$D_t$（单位：兆瓦时）：$[3{,}000{,}000, 2{,}900{,}000, 2{,}800{,}000, 2{,}700{,}000]$。\n    - 容量因子$\\text{CF}_k$：煤电$0.85$，风电$0.35$。\n    - 初始旧容量$R_{0,k}^{\\text{old}}$（单位：兆瓦）：煤电$500$，风电$0$。\n    - 强制退役量$M_{t,k}$（单位：兆瓦）：煤电$[0, 0, 0, 0]$，风电$[0, 0, 0, 0]$。\n    - 燃料成本$c_k^{\\text{fuel}}$（单位：美元/兆瓦时）：煤电$20$，风电$0$。\n    - 可变运维成本$c_k^{\\text{vom}}$（单位：美元/兆瓦时）：煤电$3$，风电$8$。\n    - 排放强度$e_k$（单位：公吨二氧化碳/兆瓦时）：煤电$0.9$，风电$0.0$。\n    - 碳价$p_t^{\\text{CO2}}$（单位：美元/公吨二氧化碳）：$[10, 10, 10, 10]$。\n    - 固定运维成本$c_k^{\\text{fom}}$（单位：美元/兆瓦/时期）：煤电$40{,}000$，风电$30{,}000$。\n    - 资本成本$C_k^{\\text{capex}}$（单位：美元/兆瓦）：煤电$1{,}300{,}000$，风电$1{,}600{,}000$。\n    - 贴现率$r = 0.07$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$\\texttt{[result1,result2,result3]}$）。每个结果必须是对应上述测试案例的最优总贴现成本（单位：百万美元），四舍五入到两位小数。",
            "solution": "## 问题验证\n\n### 步骤1：提取已知条件\n\n该问题为一个电力系统提供了多周期容量扩张和退役规划模型的数学公式。已知条件如下：\n\n**索引：**\n- $t \\in \\{1, 2, \\dots, T\\}$：离散时间周期。\n- $k \\in \\{1, 2, \\dots, K\\}$：发电技术。\n\n**参数：**\n- $T$：周期数。\n- $K$：技术种类数。\n- $D_t$：周期$t$的需求（MWh）。\n- $H$：每周期的小时数（h）。\n- $\\text{CF}_k$：技术$k$的容量因子（无量纲）。\n- $R_{0,k}^{\\text{old}}$：在$t=0$时技术$k$的初始旧容量（MW）。\n- $M_{t,k}$：在周期$t$技术$k$的强制退役旧容量（MW），$M_{t,k} \\geq 0$。\n- $c_k^{\\text{fuel}}$：燃料成本（美元/MWh）。\n- $c_k^{\\text{vom}}$：可变运维成本（美元/MWh）。\n- $e_k$：CO$_2$排放强度（tCO$_2$/MWh）。\n- $p_t^{\\text{CO2}}$：碳价（美元/tCO$_2$）。\n- $c_k^{\\text{fom}}$：固定运维成本（美元/MW/周期）。\n- $C_k^{\\text{capex}}$：资本成本（美元/MW）。\n- $r$：贴现率（小数）。\n- $d_t = \\frac{1}{(1+r)^t}$：周期$t$的贴现因子。\n\n**决策变量：**\n所有变量均为非负。\n- $G_{t,k}$：在周期$t$技术$k$的发电量（MWh），$G_{t,k} \\geq 0$。\n- $I_{t,k}$：在周期$t$对技术$k$新容量的投资（MW），$I_{t,k} \\geq 0$。\n- $V_{t,k}^{\\text{ret}}$：在周期$t$技术$k$的旧容量自愿退役量（MW），$V_{t,k}^{\\text{ret}} \\geq 0$。\n- $R_{t,k}^{\\text{old}}$：在周期$t$技术$k$的剩余在役旧容量（MW），$R_{t,k}^{\\text{old}} \\geq 0$。\n- $N_{t,k}^{\\text{new}}$：在周期$t$技术$k$的在役新容量（MW），$N_{t,k}^{\\text{new}} \\geq 0$。\n\n**约束（模型方程）：**\n1.  **能量平衡：** $\\sum_{k=1}^{K} G_{t,k} = D_t$，对每个周期$t$。\n2.  **物理容量限制：** $G_{t,k} \\leq H \\cdot \\text{CF}_k \\cdot \\left(R_{t,k}^{\\text{old}} + N_{t,k}^{\\text{new}}\\right)$，对每个周期$t$和技术$k$。\n3.  **资本存量演变（旧）：**\n    - 对于$t \\geq 2$：$R_{t,k}^{\\text{old}} + V_{t,k}^{\\text{ret}} = R_{t-1,k}^{\\text{old}} - M_{t,k}$。\n    - 对于$t = 1$：$R_{1,k}^{\\text{old}} + V_{1,k}^{\\text{ret}} = R_{0,k}^{\\text{old}} - M_{1,k}$。\n4.  **资本存量演变（新）：**\n    - 对于$t \\geq 2$：$N_{t,k}^{\\text{new}} = \\sum_{s=1}^{t-1} I_{s,k}$。\n    - 对于$t = 1$：$N_{1,k}^{\\text{new}} = 0$。\n\n**目标函数：**\n最小化总成本的净现值（NPV）：\n$$\n\\min \\sum_{t=1}^{T} d_t \\left[ \\sum_{k=1}^{K} \\left( \\left(c_k^{\\text{fuel}} + c_k^{\\text{vom}} + p_t^{\\text{CO2}} \\cdot e_k \\right) G_{t,k} + c_k^{\\text{fom}} \\left(R_{t,k}^{\\text{old}} + N_{t,k}^{\\text{new}}\\right) \\right) \\right] + \\sum_{t=1}^{T} d_t \\sum_{k=1}^{K} C_k^{\\text{capex}} I_{t,k}\n$$\n\n**测试案例：** 提供了三个测试案例，包含所有参数的具体数值。\n\n### 步骤2：使用提取的已知条件进行验证\n\n1.  **科学依据：** 该问题描述了一个容量扩张和退役模型，这是能源系统分析和运筹学中一个标准且广泛使用的框架。能量平衡、容量限制、资本存量动态（包括退役和带建设滞后的投资）以及成本核算的方程均基于基本的经济学和工程学原理。该公式是科学合理的。\n\n2.  **适定性：** 该问题被表述为一个线性规划（LP）。目标函数是决策变量的线性组合，所有约束都是线性等式或不等式。鉴于允许投资（$I_{t,k} \\geq 0$），模型总是有一个可行解（假设参数为非负），因为总可以建造足够的新容量来满足需求。在一个凸可行集上最小化线性目标函数的最优解保证存在。因此，该问题是适定的。\n\n3.  **客观性：** 该问题使用精确的数学语言和客观、可验证的参数进行陈述。它没有主观断言或含糊之处。\n\n4.  **完整性与一致性：** 该问题是自洽的。它提供了构建和求解优化模型所需的所有必要方程、参数和决策变量。单位已指定，并在各方程间保持一致（例如，以MWh为单位的发电量受到以MW为单位的容量乘以小时数的约束）。资本存量的递归定义与标准库存/存量流量模型在逻辑上是一致的。所提供的目标函数正确计算了所有指定成本组成部分的净现值。该公式假定完全预见，这是此类规划模型的标准假设。\n\n5.  **无其他缺陷：** 该问题没有表现出任何其他缺陷，如过于简单、同义反复、不切实际或不科学。在指定领域中，这是一个标准的、具有挑战性的、相关的问题。\n\n### 步骤3：结论与行动\n\n问题陈述是**有效的**。它是一个基于能源系统建模既定原则的、定义明确的线性规划问题。我将继续构建并求解该模型。\n\n## 解决方案\n\n该问题是一个线性规划（LP）问题，可以使用标准优化求解器来解决。任务是将问题表述为求解器（如`scipy.optimize.linprog`）所需的规范形式，该求解器解决以下形式的问题：\n$$\n\\min_{x} c^T x \\quad \\text{subject to} \\quad A_{eq} x = b_{eq}, \\quad A_{ub} x \\leq b_{ub}, \\quad l \\leq x \\leq u\n$$\n解决方案的核心涉及将问题的决策变量、目标函数和约束映射到这些矩阵和向量组件中。\n\n**1. 决策变量向量（$x$）**\n决策变量是$G_{t,k}$、$I_{t,k}$、$V_{t,k}^{\\text{ret}}$、$R_{t,k}^{\\text{old}}$和$N_{t,k}^{\\text{new}}$，适用于所有周期$t$和技术$k$。我们将它们扁平化为一个单一的一维向量$x$。系统化的排序至关重要。我们将按类型对变量进行分组：首先是所有$G$变量，然后是所有$I$变量，依此类推。\n变量总数为$N_{\\text{vars}} = 5 \\cdot T \\cdot K$。\n特定变量在向量$x$中的索引可以通过辅助函数找到，该函数将$(t, k)$和变量类型映射到从$0$到$N_{\\text{vars}}-1$的单个索引。\n\n**2. 成本向量（$c$）**\n成本向量$c$包含目标函数中每个变量的系数。我们根据目标函数的定义填充$c$：\n- 对于$G_{t,k}$：系数是$d_t (c_k^{\\text{fuel}} + c_k^{\\text{vom}} + p_t^{\\text{CO2}} e_k)$。\n- 对于$I_{t,k}$：系数是$d_t C_k^{\\text{capex}}$。\n- 对于$R_{t,k}^{\\text{old}}$和$N_{t,k}^{\\text{new}}$：系数是$d_t c_k^{\\text{fom}}$。\n- 对于$V_{t,k}^{\\text{ret}}$：系数是$0$。\n\n**3. 等式约束（$A_{eq}$, $b_{eq}$）**\n我们通过构建矩阵$A_{eq}$和向量$b_{eq}$来制定等式约束。\n- **能量平衡：** 对每个周期$t$，约束$\\sum_{k=1}^{K} G_{t,k} = D_t$构成一行。这将产生$T$行。\n- **旧容量演变：** 对每对$(t, k)$，关联$R_{t,k}^{\\text{old}}$、$V_{t,k}^{\\text{ret}}$和$R_{t-1,k}^{\\text{old}}$（或$R_{0,k}^{\\text{old}}$，当$t=1$时）的方程构成一行。这将产生$T \\cdot K$行。\n- **新容量演变：** 对每对$(t, k)$，关联$N_{t,k}^{\\text{new}}$、$N_{t-1,k}^{\\text{new}}$和$I_{t-1,k}$（或$N_{1,k}^{\\text{new}}=0$，当$t=1$时）的方程构成一行。这将产生$T \\cdot K$行。\n\n**4. 不等式约束（$A_{ub}$, $b_{ub}$）**\n我们通过构建矩阵$A_{ub}$和向量$b_{ub}$来制定不等式约束。\n- **容量限制：** 对每对$(t, k)$，约束$G_{t,k} \\leq H \\cdot \\text{CF}_k \\cdot (R_{t,k}^{\\text{old}} + N_{t,k}^{\\text{new}})$被重写为$G_{t,k} - H \\cdot \\text{CF}_k \\cdot R_{t,k}^{\\text{old}} - H \\cdot \\text{CF}_k \\cdot N_{t,k}^{\\text{new}} \\leq 0$。这将产生$T \\cdot K$行。\n\n**5. 边界（$l$, $u$）**\n所有决策变量都被指定为非负。因此，$x$的所有元素的下界是$0$，上界是无穷大。\n\n一旦构建了这些矩阵和向量，我们使用`scipy.optimize.linprog`来找到最优解。返回的函数值`res.fun`是最小的总贴现成本，然后将其缩放为百万美元并四舍五入。实现将为每个测试案例系统地构建这些组件并报告结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_model(params):\n    \"\"\"\n    Constructs and solves the linear programming model for capacity expansion.\n    \"\"\"\n    T = params['T']\n    K = params['K']\n    H = params['H']\n    D = params['D']\n    CF = params['CF']\n    R0_old = params['R0_old']\n    M = params['M']\n    c_fuel = params['c_fuel']\n    c_vom = params['c_vom']\n    e = params['e']\n    p_co2 = params['p_co2']\n    c_fom = params['c_fom']\n    C_capex = params['C_capex']\n    r = params['r']\n\n    # --- Variable Indexing ---\n    # Variables are ordered as [G, I, V, R, N]\n    # Within each block, variables are ordered by t, then k.\n    num_vars = 5 * T * K\n    \n    _T_K = T * K\n    offsets = {\n        'G': 0 * _T_K,\n        'I': 1 * _T_K,\n        'V': 2 * _T_K,\n        'R': 3 * _T_K,\n        'N': 4 * _T_K,\n    }\n\n    def get_var_idx(var_type, t_idx, k_idx):\n        return offsets[var_type] + t_idx * K + k_idx\n\n    # --- Objective Function (Cost Vector c) ---\n    c = np.zeros(num_vars)\n    for t_idx in range(T):\n        t = t_idx + 1\n        d_t = 1 / ((1 + r) ** t)\n        for k_idx in range(K):\n            # Variable cost component\n            var_cost_per_mwh = c_fuel[k_idx] + c_vom[k_idx] + p_co2[t_idx] * e[k_idx]\n            c[get_var_idx('G', t_idx, k_idx)] = d_t * var_cost_per_mwh\n            # Fixed O cost component\n            c[get_var_idx('R', t_idx, k_idx)] = d_t * c_fom[k_idx]\n            c[get_var_idx('N', t_idx, k_idx)] = d_t * c_fom[k_idx]\n            # Capital expenditure component\n            c[get_var_idx('I', t_idx, k_idx)] = d_t * C_capex[k_idx]\n\n    # --- Constraints ---\n    num_eq_constraints = T + T * K + T * K\n    num_ub_constraints = T * K\n    A_eq = np.zeros((num_eq_constraints, num_vars))\n    b_eq = np.zeros(num_eq_constraints)\n    A_ub = np.zeros((num_ub_constraints, num_vars))\n    b_ub = np.zeros(num_ub_constraints)\n    \n    eq_row_idx = 0\n    ub_row_idx = 0\n\n    for t_idx in range(T):\n        # 1. Energy Balance: sum(k, G_tk) = D_t\n        for k_idx in range(K):\n            A_eq[eq_row_idx, get_var_idx('G', t_idx, k_idx)] = 1\n        b_eq[eq_row_idx] = D[t_idx]\n        eq_row_idx += 1\n\n        for k_idx in range(K):\n            # 2. Capacity Limit: G_tk = H * CF_k * (R_tk + N_tk)\n            # G_tk - (H*CF_k)*R_tk - (H*CF_k)*N_tk = 0\n            A_ub[ub_row_idx, get_var_idx('G', t_idx, k_idx)] = 1\n            A_ub[ub_row_idx, get_var_idx('R', t_idx, k_idx)] = -H * CF[k_idx]\n            A_ub[ub_row_idx, get_var_idx('N', t_idx, k_idx)] = -H * CF[k_idx]\n            b_ub[ub_row_idx] = 0\n            ub_row_idx += 1\n\n            # 3. Old Capacity Evolution: R_tk + V_tk = R_{t-1,k} - M_tk\n            # R_tk + V_tk - R_{t-1,k} = -M_tk\n            A_eq[eq_row_idx, get_var_idx('R', t_idx, k_idx)] = 1\n            A_eq[eq_row_idx, get_var_idx('V', t_idx, k_idx)] = 1\n            if t_idx == 0:\n                b_eq[eq_row_idx] = R0_old[k_idx] - M[k_idx, t_idx]\n            else:\n                A_eq[eq_row_idx, get_var_idx('R', t_idx - 1, k_idx)] = -1\n                b_eq[eq_row_idx] = -M[k_idx, t_idx]\n            eq_row_idx += 1\n            \n            # 4. New Capacity Evolution: N_tk = N_{t-1,k} + I_{t-1,k}\n            # N_tk - N_{t-1,k} - I_{t-1,k} = 0\n            A_eq[eq_row_idx, get_var_idx('N', t_idx, k_idx)] = 1\n            if t_idx == 0:\n                # N_1k = 0\n                b_eq[eq_row_idx] = 0\n            else:\n                A_eq[eq_row_idx, get_var_idx('N', t_idx - 1, k_idx)] = -1\n                A_eq[eq_row_idx, get_var_idx('I', t_idx - 1, k_idx)] = -1\n                b_eq[eq_row_idx] = 0\n            eq_row_idx += 1\n\n    # --- Solve ---\n    bounds = (0, None)  # All variables are non-negative\n    res = linprog(c=c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n    if not res.success:\n        raise RuntimeError(f\"Optimization failed: {res.message}\")\n\n    total_cost_millions = res.fun / 1_000_000\n    return round(total_cost_millions, 2)\n\n\ndef solve():\n    test_cases = [\n        # Test Case 1\n        {\n            \"T\": 4, \"K\": 2, \"H\": 8760,\n            \"D\": np.array([6_000_000, 6_400_000, 6_800_000, 7_200_000]),\n            \"CF\": np.array([0.85, 0.35]),\n            \"R0_old\": np.array([1000, 200]),\n            \"M\": np.array([[0, 100, 200, 0], [0, 0, 0, 0]]), # M[k_idx, t_idx]\n            \"c_fuel\": np.array([20, 0]),\n            \"c_vom\": np.array([3, 8]),\n            \"e\": np.array([0.9, 0.0]),\n            \"p_co2\": np.array([30, 40, 50, 60]),\n            \"c_fom\": np.array([40_000, 30_000]),\n            \"C_capex\": np.array([1_300_000, 1_600_000]),\n            \"r\": 0.07,\n        },\n        # Test Case 2\n        {\n            \"T\": 4, \"K\": 2, \"H\": 8760,\n            \"D\": np.array([5_000_000, 5_200_000, 5_400_000, 5_600_000]),\n            \"CF\": np.array([0.85, 0.35]),\n            \"R0_old\": np.array([800, 0]),\n            \"M\": np.array([[0, 400, 400, 0], [0, 0, 0, 0]]),\n            \"c_fuel\": np.array([20, 0]),\n            \"c_vom\": np.array([3, 8]),\n            \"e\": np.array([0.9, 0.0]),\n            \"p_co2\": np.array([100, 120, 140, 160]),\n            \"c_fom\": np.array([40_000, 30_000]),\n            \"C_capex\": np.array([1_300_000, 1_600_000]),\n            \"r\": 0.07,\n        },\n        # Test Case 3\n        {\n            \"T\": 4, \"K\": 2, \"H\": 8760,\n            \"D\": np.array([3_000_000, 2_900_000, 2_800_000, 2_700_000]),\n            \"CF\": np.array([0.85, 0.35]),\n            \"R0_old\": np.array([500, 0]),\n            \"M\": np.array([[0, 0, 0, 0], [0, 0, 0, 0]]),\n            \"c_fuel\": np.array([20, 0]),\n            \"c_vom\": np.array([3, 8]),\n            \"e\": np.array([0.9, 0.0]),\n            \"p_co2\": np.array([10, 10, 10, 10]),\n            \"c_fom\": np.array([40_000, 30_000]),\n            \"C_capex\": np.array([1_300_000, 1_600_000]),\n            \"r\": 0.07,\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_model(case)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.2f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}