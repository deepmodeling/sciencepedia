{
    "hands_on_practices": [
        {
            "introduction": "This first exercise addresses the fundamental problem of economic dispatch within an islanded microgrid. It explores how to satisfy electrical load at the lowest possible cost by systematically prioritizing generation resources according to their marginal cost. This practice is crucial for understanding the core economic logic behind grid operation and introduces the concept of load shedding and its associated high penalty, the Value of Lost Load (VOLL), which is essential for modeling system reliability and resilience .",
            "id": "4103643",
            "problem": "Consider an islanded direct current alternating current (DC-AC) microgrid during a single scheduling interval of duration $\\Delta t = 1$ hour. The microgrid supplies an exogenous load $L$ using three resources: a photovoltaic array with available real power $P^{\\text{pv}}$, a diesel generator with dispatchable real power $P_g$, and a battery storage system delivering real power $p_b$ from its state-of-charge. The microgrid operator must ensure instantaneous real power balance by making up any shortfall through involuntary curtailment modeled by a nonnegative load shedding variable $s \\ge 0$, subject to an upper bound $s \\le L$. The objective is to minimize operating cost consisting of a linear fuel cost for the generator and a large penalty reflecting the Value of Lost Load (VOLL) for shedding, while the photovoltaic array has no marginal cost and battery discharge has negligible marginal cost. The fundamental physical constraint is real power balance on the AC bus.\n\nYou are asked to derive from first principles a correct optimization formulation for this single-interval problem and determine the optimal involuntary curtailment $s^{\\star}$ under the following data and assumptions:\n\n- The instantaneous real power balance constraint on the AC bus is\n$$\np_{\\text{pv}} + p_b + P_g = L - s,\n$$\nwhere $p_{\\text{pv}}$ is the utilized photovoltaic real power, $p_b$ is the battery discharge real power delivered to the AC bus, $P_g$ is the generator real power, and $s$ is the load shedding variable.\n\n- Photovoltaic utilization satisfies\n$$\n0 \\le p_{\\text{pv}} \\le P^{\\text{pv}},\n$$\nand curtailment of photovoltaic power has zero marginal cost.\n\n- The battery discharge delivered to the AC bus is limited by both an inverter power limit and the available energy in the state-of-charge, with discharge efficiency $\\eta_{\\text{dis}} \\in (0,1]$. Over a duration $\\Delta t$, the delivered real power constraint is\n$$\n0 \\le p_b \\le \\eta_{\\text{dis}} \\min\\!\\left(P^{\\max}_{\\text{dis}}, \\frac{E^{\\text{avail}}}{\\Delta t}\\right).\n$$\n\n- The diesel generator is dispatchable within its nameplate rating:\n$$\n0 \\le P_g \\le P^{\\max}_g,\n$$\nand incurs a linear fuel cost with marginal cost $c_g  0$ dollars per kilowatt-hour.\n\n- Involuntary curtailment incurs a large penalty $\\nu  0$ dollars per kilowatt-hour representing the Value of Lost Load (VOLL). The load shedding variable obeys\n$$\n0 \\le s \\le L.\n$$\n\n- The optimization objective is the sum of linear fuel cost and VOLL penalty:\n$$\n\\min \\; c_g P_g \\Delta t + \\nu s \\Delta t.\n$$\nAssume $\\nu \\gg c_g$, so the optimizer will prefer using any available zero- or low-cost supply before shedding load.\n\nUse the following numerical values, all of which are scientifically realistic and self-consistent:\n- $L = 670$ kilowatts.\n- $P^{\\text{pv}} = 130$ kilowatts.\n- $\\eta_{\\text{dis}} = 0.92$.\n- $P^{\\max}_{\\text{dis}} = 60$ kilowatts.\n- $E^{\\text{avail}} = 42$ kilowatt-hours.\n- $P^{\\max}_g = 420$ kilowatts.\n- $c_g = 0.20$ dollars per kilowatt-hour.\n- $\\nu = 12.00$ dollars per kilowatt-hour.\n\nStarting from the physical real power balance and resource constraints above, and using the stated cost structure, determine the optimal involuntary curtailment $s^{\\star}$. Express your final answer in kilowatts and round your answer to four significant figures.",
            "solution": "The problem is first evaluated for validity based on the provided rubric.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n- Objective function: $\\min \\; c_g P_g \\Delta t + \\nu s \\Delta t$.\n- Real power balance constraint: $p_{\\text{pv}} + p_b + P_g = L - s$.\n- Photovoltaic power constraint: $0 \\le p_{\\text{pv}} \\le P^{\\text{pv}}$.\n- Battery power constraint: $0 \\le p_b \\le \\eta_{\\text{dis}} \\min\\!\\left(P^{\\max}_{\\text{dis}}, \\frac{E^{\\text{avail}}}{\\Delta t}\\right)$.\n- Generator power constraint: $0 \\le P_g \\le P^{\\max}_g$.\n- Load shedding constraint: $0 \\le s \\le L$.\n- Problem data:\n  - Load: $L = 670$ kW.\n  - Available PV power: $P^{\\text{pv}} = 130$ kW.\n  - Battery discharge efficiency: $\\eta_{\\text{dis}} = 0.92$.\n  - Battery inverter power limit: $P^{\\max}_{\\text{dis}} = 60$ kW.\n  - Battery available energy: $E^{\\text{avail}} = 42$ kWh.\n  - Generator maximum power: $P^{\\max}_g = 420$ kW.\n  - Generator marginal cost: $c_g = 0.20$ dollars per kWh.\n  - Value of Lost Load (VOLL): $\\nu = 12.00$ dollars per kWh.\n  - Scheduling interval: $\\Delta t = 1$ h.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem describes a single-interval economic dispatch for a microgrid. This is a standard and fundamental problem in power systems engineering. The formulation, including the power balance equation, resource constraints, and cost function, is based on established physical and economic principles.\n- **Well-Posedness**: The problem is a linear program, characterized by a linear objective function and linear constraints. Since a feasible solution exists (e.g., set all generation to zero and shed the entire load, $s=L$) and the objective function is bounded below by zero, a unique optimal solution is guaranteed to exist.\n- **Objectivity and Consistency**: The problem is stated using precise, unambiguous technical language. All data are provided, and dimensional analysis confirms consistency. For example, $\\frac{E^{\\text{avail}}}{\\Delta t}$ gives units of power ($\\frac{\\text{kWh}}{\\text{h}} = \\text{kW}$), consistent with the power limit $P^{\\max}_{\\text{dis}}$. The cost function units are dollars.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid** as it is scientifically grounded, well-posed, objective, and self-consistent. The solution process may proceed.\n\n**Solution Derivation**\n\nThe objective is to minimize the total operating cost, which is a function of generator usage and load shedding:\n$$\n\\text{Cost} = c_g P_g \\Delta t + \\nu s \\Delta t\n$$\nSince the duration $\\Delta t$ is a positive constant ($1$ hour), minimizing this cost is equivalent to minimizing the expression $c_g P_g + \\nu s$. This problem can be solved by applying the principle of economic dispatch, which prioritizes the use of generation resources based on their marginal cost, from lowest to highest.\n\nThe marginal costs of the available resources are:\n1. Photovoltaic power ($p_{\\text{pv}}$): Marginal cost is $0$.\n2. Battery discharge power ($p_b$): Marginal cost is negligible, thus taken as $0$.\n3. Diesel generator power ($P_g$): Marginal cost is $c_g = 0.20$ \\$/kWh.\n4. Load shedding ($s$): This is the most expensive option, representing a failure to serve the load, with a penalty cost of $\\nu = 12.00$ \\$/kWh.\n\nThe dispatch order is therefore: (1) Photovoltaics and Battery, (2) Diesel Generator, and (3) Load Shedding. The system will use all available power from a cheaper resource before dispatching a more expensive one.\n\nFirst, we calculate the maximum power available from each generating unit.\nThe maximum usable photovoltaic power is given as:\n$$\nP^{\\max}_{\\text{pv}} = P^{\\text{pv}} = 130 \\, \\text{kW}\n$$\nThe maximum battery discharge power, $P^{\\max}_b$, delivered to the AC bus is determined by the lesser of its power rating and energy capacity, adjusted for efficiency:\n$$\nP^{\\max}_b = \\eta_{\\text{dis}} \\min\\!\\left(P^{\\max}_{\\text{dis}}, \\frac{E^{\\text{avail}}}{\\Delta t}\\right)\n$$\nWith the given values, the energy-limited power is $\\frac{E^{\\text{avail}}}{\\Delta t} = \\frac{42 \\, \\text{kWh}}{1 \\, \\text{h}} = 42 \\, \\text{kW}$.\nThe binding constraint is the minimum of the inverter limit and the energy limit: $\\min(60 \\, \\text{kW}, 42 \\, \\text{kW}) = 42 \\, \\text{kW}$.\nApplying the discharge efficiency, the maximum real power delivered to the bus is:\n$$\nP^{\\max}_b = 0.92 \\times 42 \\, \\text{kW} = 38.64 \\, \\text{kW}\n$$\nThe maximum diesel generator power is its nameplate rating:\n$$\nP^{\\max}_g = 420 \\, \\text{kW}\n$$\nThe total available generation capacity is the sum of the maximum power from all sources:\n$$\nP^{\\text{supply}}_{\\text{total}} = P^{\\max}_{\\text{pv}} + P^{\\max}_b + P^{\\max}_g\n$$\n$$\nP^{\\text{supply}}_{\\text{total}} = 130 \\, \\text{kW} + 38.64 \\, \\text{kW} + 420 \\, \\text{kW} = 588.64 \\, \\text{kW}\n$$\nThe system load is $L = 670$ kW. We compare the load to the total available supply:\n$$\nL = 670 \\, \\text{kW}  P^{\\text{supply}}_{\\text{total}} = 588.64 \\, \\text{kW}\n$$\nSince the load exceeds the total generation capacity, a shortfall is inevitable. To maintain power balance, this shortfall must be met by involuntary load curtailment (shedding). The optimal amount of load shedding, $s^{\\star}$, is precisely this deficit.\n$$\ns^{\\star} = L - P^{\\text{supply}}_{\\text{total}}\n$$\n$$\ns^{\\star} = 670 \\, \\text{kW} - 588.64 \\, \\text{kW} = 81.36 \\, \\text{kW}\n$$\nTo minimize cost, all available generation resources must be dispatched at their maximum capacity: $p^{\\star}_{\\text{pv}} = 130$ kW, $p^{\\star}_b = 38.64$ kW, and $P^{\\star}_g = 420$ kW. The remaining power imbalance is handled by shedding $s^{\\star} = 81.36$ kW.\n\nThe problem asks for the optimal involuntary curtailment $s^{\\star}$ rounded to four significant figures. Our calculated value is $81.36$ kW, which is already expressed to four significant figures.",
            "answer": "$$\\boxed{81.36}$$"
        },
        {
            "introduction": "Building on static dispatch, this problem introduces dynamic optimization over multiple time periods, a key feature of energy scheduling. You will formulate and solve a linear program to determine the optimal charging and discharging schedule for a battery to maximize profit through energy arbitrage. This hands-on exercise develops proficiency in modeling inter-temporal constraints, such as state-of-charge dynamics and efficiency losses, which are fundamental to scheduling energy storage systems and other stateful resources .",
            "id": "4103641",
            "problem": "Consider a three-period energy arbitrage problem for a microgrid equipped with a single electrochemical battery. The battery interacts with an external market in each period, buying energy to charge and selling energy when discharging. Assume discrete time with a fixed time step of one hour per period so that energy and power are numerically equal over a period. Use the following physical modeling principles and core definitions:\n\n- Energy conservation over each period, expressed by the state-of-charge recursion, derived from conservation of energy with conversion losses. Let the charge power in period $t$ be $c_t \\ge 0$ and the discharge power in period $t$ be $d_t \\ge 0$. Let the end-of-period state of charge be $E_t$. Assume a single round-trip efficiency parameter $0 lt; \\eta \\le 1$, which is decomposed into symmetric charge efficiency and discharge efficiency as $\\eta_c = \\sqrt{\\eta}$ and $\\eta_d = \\sqrt{\\eta}$ so that the round-trip efficiency is $\\eta_c \\eta_d = \\eta$. The state-of-charge update obeys\n$$\nE_t = E_{t-1} + \\eta_c \\, c_t - \\frac{1}{\\eta_d} \\, d_t,\n$$\nfor $t \\in \\{1,2,3\\}$, with given initial state of charge $E_0$.\n- Bound constraints follow from physical limitations:\n  - Energy bounds $E_{\\min} \\le E_t \\le E_{\\max}$ for $t \\in \\{1,2,3\\}$.\n  - Charge power bounds $0 \\le c_t \\le P_{\\max}^{\\mathrm{ch}}$ and discharge power bounds $0 \\le d_t \\le P_{\\max}^{\\mathrm{dis}}$ for each $t$.\n- Market transactions are priced at $p_t$ dollars per kilowatt-hour for $t \\in \\{1,2,3\\}$. Buying $c_t$ incurs a cost of $p_t c_t$, while selling $d_t$ earns revenue $p_t d_t$.\n- To prevent artificial value from leftover energy, impose a terminal constraint $E_3 = E_{\\mathrm{final}}$, where $E_{\\mathrm{final}}$ is specified. All energy quantities are in kilowatt-hours (kWh), all power quantities are in kilowatts (kW), and all prices are in dollars per kilowatt-hour ($/kWh).\n\nStarting from these principles, formulate and solve the microgrid battery arbitrage problem as a linear optimization that maximizes total profit over the three periods subject to the energy conservation, bound constraints, and terminal constraint. Your program must compute, for each test case, the optimal charge/discharge amounts $(c_1,c_2,c_3)$ and $(d_1,d_2,d_3)$ and the resulting total profit. The energy balance, bound consistency, and objective must be respected for all test cases.\n\nExpress all charge and discharge values in kilowatt-hours (kWh) and the total profit in dollars, each rounded to three decimal places. The final program output must be a single line containing a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a bracket-enclosed, comma-separated list of seven decimal numbers:\n$$\n[c_1,c_2,c_3,d_1,d_2,d_3,\\text{profit}].\n$$\n\nUse the following test suite. For each test case, the parameters are $(p_1,p_2,p_3)$, $\\eta$, $E_0$, $E_{\\mathrm{final}}$, $E_{\\min}$, $E_{\\max}$, $P_{\\max}^{\\mathrm{ch}}$, $P_{\\max}^{\\mathrm{dis}}$:\n\n- Test case 1 (canonical arbitrage with price valley then peak):\n  - Prices: $(p_1,p_2,p_3) = (\\,\\$\\,0.03,\\,\\$\\,0.01,\\,\\$\\,0.08\\,)$ per kWh.\n  - Efficiency: $\\eta = 0.9$.\n  - Initial state: $E_0 = 5$ kWh.\n  - Terminal state: $E_{\\mathrm{final}} = 5$ kWh.\n  - Energy bounds: $E_{\\min} = 0$ kWh, $E_{\\max} = 10$ kWh.\n  - Power bounds: $P_{\\max}^{\\mathrm{ch}} = 5$ kW, $P_{\\max}^{\\mathrm{dis}} = 5$ kW.\n- Test case 2 (monotone decreasing prices with full battery):\n  - Prices: $(p_1,p_2,p_3) = (\\,\\$\\,0.07,\\,\\$\\,0.05,\\,\\$\\,0.04\\,)$ per kWh.\n  - Efficiency: $\\eta = 0.88$.\n  - Initial state: $E_0 = 8$ kWh.\n  - Terminal state: $E_{\\mathrm{final}} = 8$ kWh.\n  - Energy bounds: $E_{\\min} = 0$ kWh, $E_{\\max} = 8$ kWh.\n  - Power bounds: $P_{\\max}^{\\mathrm{ch}} = 10$ kW, $P_{\\max}^{\\mathrm{dis}} = 10$ kW.\n- Test case 3 (flat prices, no profitable cycling due to losses):\n  - Prices: $(p_1,p_2,p_3) = (\\,\\$\\,0.05,\\,\\$\\,0.05,\\,\\$\\,0.05\\,)$ per kWh.\n  - Efficiency: $\\eta = 0.95$.\n  - Initial state: $E_0 = 5$ kWh.\n  - Terminal state: $E_{\\mathrm{final}} = 5$ kWh.\n  - Energy bounds: $E_{\\min} = 0$ kWh, $E_{\\max} = 10$ kWh.\n  - Power bounds: $P_{\\max}^{\\mathrm{ch}} = 5$ kW, $P_{\\max}^{\\mathrm{dis}} = 5$ kW.\n- Test case 4 (tight discharge power and low round-trip efficiency):\n  - Prices: $(p_1,p_2,p_3) = (\\,\\$\\,0.04,\\,\\$\\,0.10,\\,\\$\\,0.06\\,)$ per kWh.\n  - Efficiency: $\\eta = 0.6$.\n  - Initial state: $E_0 = 2$ kWh.\n  - Terminal state: $E_{\\mathrm{final}} = 2$ kWh.\n  - Energy bounds: $E_{\\min} = 0$ kWh, $E_{\\max} = 6$ kWh.\n  - Power bounds: $P_{\\max}^{\\mathrm{ch}} = 2$ kW, $P_{\\max}^{\\mathrm{dis}} = 1.5$ kW.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is a bracketed list of seven decimal numbers in the order $[c_1,c_2,c_3,d_1,d_2,d_3,\\text{profit}]$, rounded to three decimal places, for example:\n$$\n[[0.000,0.000,0.000,0.000,0.000,0.000,0.000],[\\dots],\\dots].\n$$",
            "solution": "The problem posed is to determine the optimal energy arbitrage strategy for a battery in a microgrid over a three-period time horizon. This requires formulating and solving a mathematical optimization problem that maximizes profit, subject to the physical and operational constraints of the system. The problem statement is scientifically grounded, self-contained, and well-posed, making it valid for a formal solution.\n\nThe core of the solution lies in expressing the problem as a Linear Program (LP). An LP consists of an objective function to be optimized and a set of constraints, where both the objective and the constraints are linear functions of the decision variables.\n\nFirst, we define the decision variables. For each time period $t \\in \\{1, 2, 3\\}$, the battery can either charge or discharge. Let $c_t$ be the energy charged during period $t$, and $d_t$ be the energy discharged during period $t$. Since the time step is $1$ hour, power (in kW) is numerically equal to energy (in kWh). The decision variables for the entire horizon are collected into a single vector $x$:\n$$\nx = [c_1, c_2, c_3, d_1, d_2, d_3]^T\n$$\nThese variables are non-negative, i.e., $c_t \\ge 0$ and $d_t \\ge 0$.\n\nNext, we formulate the objective function. The goal is to maximize total profit, which is the total revenue from selling energy minus the total cost of buying energy. With market prices $p_t$, the profit $\\Pi$ is:\n$$\n\\text{maximize} \\quad \\Pi = \\sum_{t=1}^{3} (p_t d_t - p_t c_t)\n$$\nStandard LP solvers perform minimization. Maximizing $\\Pi$ is equivalent to minimizing $-\\Pi$. Thus, the objective function to minimize is:\n$$\n\\text{minimize} \\quad \\sum_{t=1}^{3} (p_t c_t - p_t d_t)\n$$\nThis can be written in matrix form as $c_{obj}^T x$, where the cost vector $c_{obj}$ is:\n$$\nc_{obj} = [p_1, p_2, p_3, -p_1, -p_2, -p_3]^T\n$$\n\nThe system is governed by several constraints.\n\n1.  **State-of-Charge (SOC) Dynamics:** The energy stored in the battery, $E_t$, at the end of period $t$ evolves according to the conservation of energy, accounting for efficiency losses. The given state equation is:\n    $$\n    E_t = E_{t-1} + \\eta_c c_t - \\frac{1}{\\eta_d} d_t\n    $$\n    where $\\eta_c = \\sqrt{\\eta}$ and $\\eta_d = \\sqrt{\\eta}$ are the charge and discharge efficiencies, respectively. We can express $E_t$ for $t \\in \\{1, 2, 3\\}$ in terms of the initial state $E_0$ and the decision variables:\n    $$\n    E_1 = E_0 + \\eta_c c_1 - \\frac{1}{\\eta_d} d_1\n    $$\n    $$\n    E_2 = E_1 + \\eta_c c_2 - \\frac{1}{\\eta_d} d_2 = E_0 + \\eta_c(c_1 + c_2) - \\frac{1}{\\eta_d}(d_1 + d_2)\n    $$\n    $$\n    E_3 = E_2 + \\eta_c c_3 - \\frac{1}{\\eta_d} d_3 = E_0 + \\eta_c(c_1 + c_2 + c_3) - \\frac{1}{\\eta_d}(d_1 + d_2 + d_3)\n    $$\n\n2.  **Energy Bounds:** The stored energy must remain within physical limits at all times:\n    $$\n    E_{\\min} \\le E_t \\le E_{\\max} \\quad \\text{for } t \\in \\{1, 2, 3\\}\n    $$\n    These inequalities are applied to the expressions for $E_1$ and $E_2$. For $E_3$, a more specific constraint is given. These constraints are linear in the decision variables. For $t=1$:\n    $$\n    \\eta_c c_1 - \\frac{1}{\\eta_d} d_1 \\le E_{\\max} - E_0\n    $$\n    $$\n    -\\eta_c c_1 + \\frac{1}{\\eta_d} d_1 \\le E_0 - E_{\\min}\n    $$\n    Similarly for $t=2$:\n    $$\n    \\eta_c(c_1 + c_2) - \\frac{1}{\\eta_d}(d_1 + d_2) \\le E_{\\max} - E_0\n    $$\n    $$\n    -\\eta_c(c_1 + c_2) + \\frac{1}{\\eta_d}(d_1 + d_2) \\le E_0 - E_{\\min}\n    $$\n\n3.  **Terminal State Constraint:** A terminal constraint is imposed to ensure the final state of charge is a specified value, $E_{\\mathrm{final}}$:\n    $$\n    E_3 = E_{\\mathrm{final}}\n    $$\n    Substituting the expression for $E_3$:\n    $$\n    E_0 + \\eta_c \\sum_{t=1}^{3} c_t - \\frac{1}{\\eta_d} \\sum_{t=1}^{3} d_t = E_{\\mathrm{final}}\n    $$\n    This can be rearranged into a linear equality constraint:\n    $$\n    \\eta_c \\sum_{t=1}^{3} c_t - \\frac{1}{\\eta_d} \\sum_{t=1}^{3} d_t = E_{\\mathrm{final}} - E_0\n    $$\n\n4.  **Power Bounds:** The charge and discharge rates are limited by the battery's power capacity:\n    $$\n    0 \\le c_t \\le P_{\\max}^{\\mathrm{ch}} \\quad \\text{for } t \\in \\{1, 2, 3\\}\n    $$\n    $$\n    0 \\le d_t \\le P_{\\max}^{\\mathrm{dis}} \\quad \\text{for } t \\in \\{1, 2, 3\\}\n    $$\n    These are simple box constraints on the decision variables.\n\nThe problem formulation does not require an explicit constraint to prevent simultaneous charging and discharging (i.e., $c_t d_t = 0$). Any feasible solution where $c_t  0$ and $d_t  0$ for some period $t$ is suboptimal. One could reduce both $c_t$ and $d_t$ by a small amount in a way that keeps the net energy change the same but reduces the cost, due to the round-trip efficiency loss $(\\eta = \\eta_c \\eta_d  1)$. An LP solver will thus naturally drive one of the two variables to $0$ for each period.\n\nThe complete problem is solved by using a standard LP solver. We construct the matrices and vectors for the canonical LP form: minimize $c_{obj}^T x$ subject to $A_{eq} x = b_{eq}$, $A_{ub} x \\le b_{ub}$, and element-wise bounds on $x$.\n\nFor a given set of parameters $(p_1, p_2, p_3), \\eta, E_0, E_{\\mathrm{final}}, E_{\\min}, E_{\\max}, P_{\\max}^{\\mathrm{ch}}, P_{\\max}^{\\mathrm{dis}}$:\n\n- **Equality Constraint:** $A_{eq}$ is a $1 \\times 6$ matrix and $b_{eq}$ is a scalar.\n  $$\n  A_{eq} = [\\eta_c, \\eta_c, \\eta_c, -1/\\eta_d, -1/\\eta_d, -1/\\eta_d]\n  $$\n  $$\n  b_{eq} = [E_{\\mathrm{final}} - E_0]\n  $$\n\n- **Inequality Constraints:** $A_{ub}$ is a $4 \\times 6$ matrix and $b_{ub}$ is a $4 \\times 1$ vector.\n  $$\n  A_{ub} = \\begin{pmatrix}\n  \\eta_c  0  0  -1/\\eta_d  0  0 \\\\\n  -\\eta_c  0  0  1/\\eta_d  0  0 \\\\\n  \\eta_c  \\eta_c  0  -1/\\eta_d  -1/\\eta_d  0 \\\\\n  -\\eta_c  -\\eta_c  0  1/\\eta_d  1/\\eta_d  0\n  \\end{pmatrix}\n  $$\n  $$\n  b_{ub} = [E_{\\max} - E_0, E_0 - E_{\\min}, E_{\\max} - E_0, E_0 - E_{\\min}]^T\n  $$\n\n- **Bounds:** The lower bounds are all $0$. The upper bounds are:\n  $$\n  [P_{\\max}^{\\mathrm{ch}}, P_{\\max}^{\\mathrm{ch}}, P_{\\max}^{\\mathrm{ch}}, P_{\\max}^{\\mathrm{dis}}, P_{\\max}^{\\mathrm{dis}}, P_{\\max}^{\\mathrm{dis}}]^T\n  $$\n\nThe Python implementation will construct these matrices and vectors for each test case and pass them to the `scipy.optimize.linprog` function to find the optimal charge/discharge schedule $x^*$ and the corresponding minimal cost. The maximum profit is the negative of the minimal cost. The final results are then formatted as specified.",
            "answer": "[[0.000,5.000,0.000,0.000,0.000,4.743,0.280],[0.000,0.000,0.000,0.000,0.000,0.000,0.000],[0.000,0.000,0.000,0.000,0.000,0.000,0.000],[2.000,0.000,0.451,0.000,1.500,0.000,0.043]]"
        },
        {
            "introduction": "This advanced practice confronts the challenges of uncertainty and discrete decisions inherent in real-world microgrid scheduling. You will implement Benders decomposition, a powerful technique to solve a two-stage stochastic unit commitment problem where generator on/off decisions are made before renewable generation is known. By separating the problem into a master problem for commitments and subproblems for dispatch, you will gain deep insight into solving large-scale optimization problems under uncertainty, a vital skill for advanced energy systems modeling .",
            "id": "4103624",
            "problem": "Consider a two-stage microgrid optimal scheduling problem over $T$ discrete time periods with scenario-wise uncertainty in net demand. The microgrid has two dispatchable generators and an external grid connection with a per-period import capacity limit. The first stage decides binary commitments of the generators, and the second stage decides, for each scenario independently, economic dispatch subject to the first-stage commitments. Your task is to implement Benders decomposition by separating the first-stage commitments and the second-stage scenario-wise dispatch, and to derive optimality and feasibility cuts that iteratively refine the master problem.\n\nFundamental base and definitions:\n- Let $y_1 \\in \\{0,1\\}$ and $y_2 \\in \\{0,1\\}$ be first-stage commitment decisions for generator $1$ and generator $2$, respectively. The binary value indicates whether a generator is committed (on) or not (off).\n- For each scenario $s \\in \\mathcal{S}$ and each time period $t \\in \\{1,\\dots,T\\}$, define net deficit $d_{s,t} = D_{s,t} - \\text{PV}_{s,t}$, where $D_{s,t}$ is the demand and $\\text{PV}_{s,t}$ is the renewable photovoltaic generation. Each period is of duration $1$ hour, so power in $\\text{kW}$ equals energy in $\\text{kWh}$ over the period.\n- Second-stage decision variables under scenario $s$ are $g_{1,t} \\ge 0$, $g_{2,t} \\ge 0$ (generator outputs), and $g^{\\text{grid}}_{t} \\ge 0$ (grid import), for $t=1,\\dots,T$.\n- Generator capacities are $C_1$ and $C_2$ in $\\text{kW}$; grid import capacity per period is $G^{\\max}_t$ in $\\text{kW}$. Variable generation costs are $c_1$, $c_2$, and grid energy price $c_G$ in $\\$/\\text{kWh}$. Fixed commitment costs are $F_1$ and $F_2$ in $\\$$.\n- The second-stage dispatch problem for scenario $s$ is a linear program that minimizes operating cost subject to per-period balance and capacity constraints.\n- The Benders master problem includes first-stage costs and a scenario-wise recourse cost approximation via variables $\\theta_s$, refined iteratively using cuts derived from duality of the second-stage linear programs and feasibility conditions.\n\nYou must start from linear programming duality and feasibility conditions and derive:\n- For each scenario $s$, an optimality cut of the form $\\theta_s \\ge \\alpha_s + \\beta_{1,s} y_1 + \\beta_{2,s} y_2$ using the dual multipliers of the second-stage linear program.\n- If a scenario’s second-stage dispatch is infeasible for a given $(y_1,y_2)$, a feasibility cut ensuring sufficient committed capacity in each time period: $C_1 y_1 + C_2 y_2 \\ge \\max\\{d_{s,t} - G^{\\max}_t, 0\\}$ for all $t$ in that scenario.\n\nImplement an iterative Benders algorithm:\n- Initialize with no optimality cuts and no feasibility cuts.\n- At each iteration, solve the master problem by enumerating all binary combinations of $(y_1,y_2)$ and selecting the feasible one (w.r.t. accumulated feasibility cuts) that minimizes the current master objective with $\\theta_s$ replaced by the maximum of existing optimality cuts for scenario $s$ evaluated at $(y_1,y_2)$, or $0$ if no optimality cut exists yet for $s$.\n- Given the selected $(y_1,y_2)$, solve each scenario’s second-stage dispatch linear program. If feasible, add its optimality cut; if infeasible, add feasibility cuts for all periods with unmet deficit. Maintain and update global lower and upper bounds until convergence or until all feasible $(y_1,y_2)$ combinations have been processed.\n\nPhysical and numerical units:\n- All power and energy quantities must be treated in $\\text{kW}$ and $\\text{kWh}$. All costs must be in dollars $\\$$. Express the final expected total cost for each test case in dollars, rounded to two decimal places.\n\nAngle units are not applicable. Percentages must not be used.\n\nTest suite and parameter specification:\nImplement the above for the following three test cases. Each test case is a tuple of parameters $(T, C_1, C_2, c_1, c_2, c_G, F_1, F_2, \\{G^{\\max}_t\\}_{t=1}^T, \\mathcal{S}, \\{p_s\\}_{s \\in \\mathcal{S}})$, where scenario data include $\\{D_{s,t}\\}_{t=1}^T$ and $\\{\\text{PV}_{s,t}\\}_{t=1}^T$.\n\n- Test Case $1$ (happy path; grid and photovoltaic suffice without commitments):\n  - $T = 3$, $C_1 = 50$, $C_2 = 40$, $c_1 = 0.18$, $c_2 = 0.22$, $c_G = 0.25$, $F_1 = 100$, $F_2 = 80$.\n  - $G^{\\max} = [80, 80, 80]$.\n  - Scenarios $\\mathcal{S} = \\{A, B\\}$ with probabilities $p_A = 0.5$, $p_B = 0.5$.\n  - Scenario $A$: $D_{A} = [70, 60, 50]$, $\\text{PV}_{A} = [30, 40, 50]$.\n  - Scenario $B$: $D_{B} = [60, 55, 65]$, $\\text{PV}_{B} = [35, 25, 30]$.\n\n- Test Case $2$ (grid-limited; at least one generator must commit):\n  - $T = 3$, $C_1 = 50$, $C_2 = 40$, $c_1 = 0.18$, $c_2 = 0.22$, $c_G = 0.25$, $F_1 = 100$, $F_2 = 80$.\n  - $G^{\\max} = [20, 20, 20]$.\n  - Scenarios $\\mathcal{S} = \\{A, B\\}$ with probabilities $p_A = 0.5$, $p_B = 0.5$.\n  - Scenario $A$: $D_{A} = [70, 60, 50]$, $\\text{PV}_{A} = [30, 40, 50]$.\n  - Scenario $B$: $D_{B} = [60, 55, 65]$, $\\text{PV}_{B} = [35, 25, 30]$.\n\n- Test Case $3$ (boundary; both generators required to satisfy all periods):\n  - $T = 3$, $C_1 = 50$, $C_2 = 40$, $c_1 = 0.18$, $c_2 = 0.22$, $c_G = 0.25$, $F_1 = 100$, $F_2 = 80$.\n  - $G^{\\max} = [0, 0, 0]$.\n  - Scenarios $\\mathcal{S} = \\{C\\}$ with probability $p_C = 1.0$.\n  - Scenario $C$: $D_{C} = [100, 100, 100]$, $\\text{PV}_{C} = [10, 10, 10]$.\n\nFinal output format:\nYour program should produce a single line of output containing the expected total optimal cost for each of the three test cases, as a comma-separated list enclosed in square brackets (e.g., \"[$x_1$,$x_2$,$x_3$]\"), where each $x_i$ is a float rounded to two decimals in $\\$$.",
            "solution": "The user has specified a two-stage stochastic optimization problem for microgrid scheduling, to be solved using Benders decomposition. The problem is well-defined, scientifically grounded in power systems engineering and operations research, and all necessary parameters for the specified test cases are provided. The problem is thus deemed valid.\n\nThe solution approach involves decomposing the problem into a master problem for first-stage generator commitment decisions and a set of second-stage subproblems for the economic dispatch under each uncertain scenario. The master problem is iteratively refined by adding optimality and feasibility cuts derived from the subproblems.\n\n### Mathematical Formulation\n\nThe overall objective is to minimize the sum of first-stage fixed costs and the expected second-stage operational costs.\n\n**First-Stage (Master) Problem**\nThe master problem decides the binary generator commitment variables $y_1, y_2 \\in \\{0, 1\\}$. Its objective function includes the fixed commitment costs and an approximation of the expected second-stage costs, represented by recourse variables $\\theta_s \\ge 0$ for each scenario $s \\in \\mathcal{S}$.\n\n$$\n\\min_{y_1, y_2, \\theta_s} \\quad F_1 y_1 + F_2 y_2 + \\sum_{s \\in \\mathcal{S}} p_s \\theta_s\n$$\nSubject to:\n$$\ny_1, y_2 \\in \\{0, 1\\}\n$$\n$$\n\\theta_s \\ge 0 \\quad \\forall s \\in \\mathcal{S}\n$$\nAnd a set of Benders cuts (optimality and feasibility) that are added iteratively.\n\n**Second-Stage (Subproblem)**\nFor a given first-stage decision $(\\bar{y}_1, \\bar{y}_2)$ and a specific scenario $s$, the second-stage subproblem is a linear program (LP) that minimizes the operational cost. The full subproblem is separable by time period $t \\in \\{1, \\dots, T\\}$. For each period, we solve:\n\n$$\nQ_{s,t}(\\bar{y}_1, \\bar{y}_2) = \\min_{g_{1,t}, g_{2,t}, g^{\\text{grid}}_{t}} \\quad c_1 g_{1,t} + c_2 g_{2,t} + c_G g^{\\text{grid}}_{t}\n$$\nSubject to:\n\\begin{align*}\n(S1_t):  \\quad g_{1,t} + g_{2,t} + g^{\\text{grid}}_{t} \\ge d_{s,t}  [\\lambda_{s,t} \\ge 0] \\\\\n(S2_{1,t}):  \\quad g_{1,t} \\le C_1 \\bar{y}_1  [\\mu_{1,s,t} \\ge 0] \\\\\n(S3_{2,t}):  \\quad g_{2,t} \\le C_2 \\bar{y}_2  [\\mu_{2,s,t} \\ge 0] \\\\\n(S4_t):  \\quad g^{\\text{grid}}_{t} \\le G^{\\max}_t  [\\nu_{s,t} \\ge 0] \\\\\n \\quad g_{1,t}, g_{2,t}, g^{\\text{grid}}_{t} \\ge 0\n\\end{align*}\nThe total second-stage cost for scenario $s$ is $Q_s(\\bar{y}_1, \\bar{y}_2) = \\sum_{t=1}^T Q_{s,t}(\\bar{y}_1, \\bar{y}_2)$. The dual variables for each constraint are indicated in brackets.\n\n### Benders Cut Derivation\n\n**1. Feasibility Cut**\nThe subproblem for a given period $t$ and scenario $s$ is infeasible if the total available generation capacity is less than the net deficit $d_{s,t} = D_{s,t} - \\text{PV}_{s,t}$. The maximum available supply is $C_1 \\bar{y}_1 + C_2 \\bar{y}_2 + G^{\\max}_t$. Feasibility requires:\n$$\nC_1 \\bar{y}_1 + C_2 \\bar{y}_2 + G^{\\max}_t \\ge d_{s,t}\n$$\nIf this condition is violated for a particular $(\\bar{y}_1, \\bar{y}_2)$, a feasibility cut is generated and added to the master problem to exclude such infeasible commitment decisions in future iterations. The cut is formulated for general $y_1, y_2$:\n$$\nC_1 y_1 + C_2 y_2 \\ge d_{s,t} - G^{\\max}_t\n$$\nSince the left side is non-negative, this cut is only meaningful if the right side is positive. Thus, for each period $t'$ where the subproblem under scenario $s$ is infeasible, we add the following cut:\n$$\nC_1 y_1 + C_2 y_2 \\ge \\max\\{0, d_{s,t'} - G^{\\max}_{t'}\\}\n$$\n\n**2. Optimality Cut**\nIf the subproblem for scenario $s$ is feasible for a given $(\\bar{y}_1, \\bar{y}_2)$, an optimality cut is generated from its dual. The dual of the per-period subproblem is:\n$$\n\\max_{\\lambda, \\mu, \\nu} \\quad d_{s,t} \\lambda_{s,t} - C_1 \\bar{y}_1 \\mu_{1,s,t} - C_2 \\bar{y}_2 \\mu_{2,s,t} - G^{\\max}_t \\nu_{s,t}\n$$\nSubject to:\n\\begin{align*}\n\\lambda_{s,t} - \\mu_{1,s,t} \\le c_1 \\\\\n\\lambda_{s,t} - \\mu_{2,s,t} \\le c_2 \\\\\n\\lambda_{s,t} - \\nu_{s,t} \\le c_G \\\\\n\\lambda_{s,t}, \\mu_{1,s,t}, \\mu_{2,s,t}, \\nu_{s,t} \\ge 0\n\\end{align*}\nBy strong duality, the optimal objective value of the primal subproblem, $Q_{s,t}(\\bar{y}_1, \\bar{y}_2)$, is equal to the optimal value of this dual. Let $(\\bar{\\lambda}_{s,t}, \\bar{\\mu}_{1,s,t}, \\bar{\\mu}_{2,s,t}, \\bar{\\nu}_{s,t})$ be the optimal dual variables. The value $Q_s(\\bar{y}_1, \\bar{y}_2) = \\sum_t Q_{s,t}(\\bar{y}_1, \\bar{y}_2)$ provides a value for $\\theta_s$ that serves as a lower bound for any feasible commitment. An optimality cut is a linear under-approximation of the recourse function $Q_s(y_1, y_2)$. It takes the form:\n$$\n\\theta_s \\ge Q_s(\\bar{y}_1, \\bar{y}_2) + \\nabla Q_s(\\bar{y}_1, \\bar{y}_2)^T \\begin{pmatrix} y_1 - \\bar{y}_1 \\\\ y_2 - \\bar{y}_2 \\end{pmatrix}\n$$\nThe gradient components are $\\frac{\\partial Q_s}{\\partial y_i} = - \\sum_{t=1}^T C_i \\bar{\\mu}_{i,s,t}$. This leads to the cut $\\theta_s \\ge \\alpha_s + \\beta_{1,s} y_1 + \\beta_{2,s} y_2$, where:\n$$\n\\alpha_s = \\sum_{t=1}^T (d_{s,t} \\bar{\\lambda}_{s,t} - G^{\\max}_t \\bar{\\nu}_{s,t})\n$$\n$$\n\\beta_{1,s} = - \\sum_{t=1}^T C_1 \\bar{\\mu}_{1,s,t}\n$$\n$$\n\\beta_{2,s} = - \\sum_{t=1}^T C_2 \\bar{\\mu}_{2,s,t}\n$$\nThis cut is added to the master problem, improving its approximation of the second-stage cost function.\n\n### Benders Decomposition Algorithm\n\nThe iterative algorithm proceeds as follows:\n\n1.  **Initialization**: Initialize a global lower bound $LB = -\\infty$ and an upper bound $UB = +\\infty$. The sets of optimality and feasibility cuts are empty.\n2.  **Master Problem Solution**: At each iteration, solve the master problem. Given the small scale of the first-stage decisions ($2^2=4$ combinations), this is done by enumerating all pairs $(y_1, y_2) \\in \\{(0,0), (0,1), (1,0), (1,1)\\}$. For each pair:\n    *   Check if it satisfies all current feasibility cuts.\n    *   If feasible, calculate its master objective value $F_1 y_1 + F_2 y_2 + \\sum_s p_s \\theta_s$, where each $\\theta_s$ is the maximum value returned by evaluating all existing optimality cuts for that scenario at $(y_1, y_2)$.\n    *   The pair $(y_1^{(k)}, y_2^{(k)})$ with the minimum master objective value is chosen. This objective value, $Z_{MP}^{(k)}$, updates the global lower bound: $LB = \\max(LB, Z_{MP}^{(k)})$.\n3.  **Subproblem Solution**: For the chosen $(y_1^{(k)}, y_2^{(k)})$, solve the second-stage LP for each scenario $s \\in \\mathcal{S}$.\n    *   If the subproblem for any scenario $s$ is infeasible (for any period $t$), add the corresponding feasibility cut(s) to the master problem. The true cost for this commitment is infinite.\n    *   If the subproblems for all scenarios are feasible, calculate the total true cost: $Z^{(k)} = F_1 y_1^{(k)} + F_2 y_2^{(k)} + \\sum_s p_s Q_s(y_1^{(k)}, y_2^{(k)})$. This value updates the global upper bound: $UB = \\min(UB, Z^{(k)})$. For each scenario $s$, an optimality cut is generated using the dual variables from its subproblem solution and added to the master problem.\n4.  **Convergence Check**: The algorithm terminates if the gap between the upper and lower bounds is below a small tolerance ($UB - LB \\le \\epsilon$), or if all four possible commitment combinations have been evaluated via the subproblems. The optimal solution is the commitment decision that produced the best upper bound, and the optimal value is $UB$.\n\nThis procedure is implemented to solve the three specified test cases.",
            "answer": "[18.75,98.00,233.40]"
        }
    ]
}