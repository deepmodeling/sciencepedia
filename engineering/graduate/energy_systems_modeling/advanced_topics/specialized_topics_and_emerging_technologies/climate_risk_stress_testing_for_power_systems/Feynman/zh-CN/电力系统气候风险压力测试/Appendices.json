{
    "hands_on_practices": [
        {
            "introduction": "压力测试始于对气候灾害如何影响单个电力系统资产的坚实物理理解。第一个实践练习将聚焦于一个基本组件：光伏（PV）阵列，其性能对高温尤为敏感。你将从第一性原理出发，推导出一个光伏功率输出模型，将环境温度和太阳辐照度与光伏电池的运行效率联系起来，从而为了解物理脆弱性建模提供一个具体的范例 。",
            "id": "4077987",
            "problem": "一个公用事业规模的光伏（PV）阵列正在一个与输电系统连接的电力系统的热浪压力测试情景下进行评估。目标是推导出一个基于物理原理的、表示阵列电功率作为辐照度和温度函数的表达式，然后计算在压力事件期间的预期输出。\n\n假设以下基本要素：\n\n- 在标准测试条件（STC）下，定义为电池温度 $T_{\\text{STC}} = 298\\,\\mathrm{K}$ 和阵列平面辐照度 $G_{\\text{STC}} = 1000\\,\\mathrm{W/m^2}$，阵列的电功率为 $P_{\\text{STC}} = 4.5\\,\\mathrm{kW}$。\n- 阵列电功率对电池温度 $T_c$ 的响应可以通过在 $T_{\\text{STC}}$ 附近的一阶线性化来近似，使用已知的温度系数 $\\gamma$（单位为 $\\mathrm{K^{-1}}$），其中当 $\\gamma  0$ 时，增加 $T_c$ 会降低功率。\n- 组件电池温度 $T_c$ 由吸收的太阳能功率与向环境空气的对流散热之间的能量平衡决定，这通过一个由传热系数参数化的、广泛使用的稳态热模型来表示。\n\n仅从这些要素出发，不使用任何简便公式，完成以下任务：\n\n1. 推导光伏阵列电功率 $P$ 作为辐照度 $G$、环境空气温度 $T_a$ 和风速 $v$ 的函数表达式，该表达式应使用 $P_{\\text{STC}}$、$G_{\\text{STC}}$、$T_{\\text{STC}}$、$\\gamma$、组件电效率 $\\eta$ 以及传热系数 $U_0$ 和 $U_1$ 来表示。您的推导必须从组件的热平衡和围绕 $T_{\\text{STC}}$ 的电功率一阶近似出发。\n2. 使用您推导的表达式，计算在热浪情景下的阵列功率，参数如下：环境空气温度 $T_a = 310\\,\\mathrm{K}$，风速 $v = 0.5\\,\\mathrm{m/s}$，辐照度 $G = 950\\,\\mathrm{W/m^2}$，温度系数 $\\gamma = -0.004\\,\\mathrm{K^{-1}}$，组件效率 $\\eta = 0.18$，以及热系数 $U_0 = 20\\,\\mathrm{W/(m^2\\cdot K)}$ 和 $U_1 = 6\\,\\mathrm{W/(m^2\\cdot K)}$。\n3. 在气候风险压力测试的背景下，简要讨论 $\\gamma$、$\\eta$、$U_0$ 和 $U_1$ 的物理上合理的选择，包括它们的值如何影响功率 $P$ 对热浪的敏感性。\n\n将您最终的 $P$ 数值答案四舍五入到四位有效数字。最终功率以 $\\mathrm{kW}$ 为单位表示。",
            "solution": "所述问题具有科学依据、提法明确、客观，并包含足够的信息以获得唯一解。它基于光伏器件物理和热传递的既定第一性原理。因此，该问题被认为是有效的。\n\n根据要求，解答分为三个部分：功率表达式的推导、特定情景的数值计算，以及模型参数的物理解释。\n\n### 第1部分：光伏阵列电功率表达式的推导\n\n推导从两个基本模型出发：一个用于功率输出的电学模型和一个用于电池温度的热学模型。\n\n**1. 电功率模型**\n光伏（PV）阵列的电功率输出 $P$ 主要与入射的阵列平面太阳辐照度 $G$ 成正比。在标准测试条件（STC）下，当辐照度为 $G_{\\text{STC}}$、电池温度为 $T_{\\text{STC}}$ 时，功率为 $P_{\\text{STC}}$。如果电池温度保持在 $T_{\\text{STC}}$ 不变，那么在不同辐照度 $G$ 下的功率将由以下比例关系给出：\n$$ P'(G) = P_{\\text{STC}} \\frac{G}{G_{\\text{STC}}} $$\n然而，光伏电池的电性能会随着其温度的升高而下降。问题指明，这种依赖关系可以建模为围绕参考温度 $T_{\\text{STC}}$ 的一阶线性化。这通过功率的温度系数 $\\gamma$ 来表示，其单位为 $\\mathrm{K^{-1}}$，通常为负值。因此，在电池温度为 $T_c$ 和辐照度为 $G$ 时的功率 $P$ 为：\n$$ P(G, T_c) = P'(G) \\left[ 1 + \\gamma (T_c - T_{\\text{STC}}) \\right] $$\n代入 $P'(G)$ 的表达式，得到功率作为辐照度和电池温度的函数：\n$$ P(G, T_c) = P_{\\text{STC}} \\frac{G}{G_{\\text{STC}}} \\left[ 1 + \\gamma (T_c - T_{\\text{STC}}) \\right] $$\n这个方程还不是最终形式，因为它依赖于内部变量 $T_c$。下一步是将 $T_c$ 用外部环境条件来表示。\n\n**2. 电池温度 ($T_c$) 的热学模型**\n电池温度 $T_c$ 由稳态能量平衡决定。在稳态下，组件内部产生的热能等于散发到周围环境的热量。\n\n*   **热量产生 ($Q_{\\text{gen}}$):** 入射到面积为 $A$ 的组件上的太阳辐射提供的功率等于 $G \\cdot A$。这部分功率中的一小部分，由组件的电效率 $\\eta$ 描述，被转换为电能，即 $P_{\\text{elec}} = \\eta G A$。剩余的入射能量被转换为必须散发的热能。因此，热量产生的速率为：\n    $$ Q_{\\text{gen}} = G A - P_{\\text{elec}} = G A - \\eta G A = G A (1 - \\eta) $$\n*   **热量散失 ($Q_{\\text{loss}}$):** 热量通过对流和辐射从组件表面散失到环境空气中（温度为 $T_a$）。这个过程使用牛顿冷却定律进行建模，其中热量损失的速率与电池和环境空气之间的温差 $(T_c - T_a)$ 以及总传热系数 $U_L$ 成正比。\n    $$ Q_{\\text{loss}} = U_L A (T_c - T_a) $$\n    问题指明 $U_L$ 是风速 $v$ 的线性函数，由系数 $U_0$（代表与风无关的传热，如辐射和自然对流）和 $U_1$（代表强制对流）参数化：\n    $$ U_L = U_0 + U_1 v $$\n    将此代入热损失方程，得到：\n    $$ Q_{\\text{loss}} = (U_0 + U_1 v) A (T_c - T_a) $$\n\n*   **稳态能量平衡:** 通过令热量产生等于热量损失 ($Q_{\\text{gen}} = Q_{\\text{loss}}$):\n    $$ G A (1 - \\eta) = (U_0 + U_1 v) A (T_c - T_a) $$\n    未给出的组件面积 $A$ 恰好在方程两边被消去。我们现在可以求解电池温度 $T_c$：\n    $$ G (1 - \\eta) = (U_0 + U_1 v) (T_c - T_a) $$\n    $$ T_c - T_a = \\frac{G(1 - \\eta)}{U_0 + U_1 v} $$\n    $$ T_c = T_a + \\frac{G(1 - \\eta)}{U_0 + U_1 v} $$\n\n**3. 最终功率表达式**\n最后，我们将推导出的 $T_c$ 表达式代入电功率模型，以获得光伏功率 $P$ 作为自变量 $G$、$T_a$ 和 $v$ 的函数：\n$$ P(G, T_a, v) = P_{\\text{STC}} \\frac{G}{G_{\\text{STC}}} \\left[ 1 + \\gamma \\left( \\left( T_a + \\frac{G(1 - \\eta)}{U_0 + U_1 v} \\right) - T_{\\text{STC}} \\right) \\right] $$\n这就是所要求的基于物理原理的表达式。\n\n### 第2部分：热浪情景下阵列功率的计算\n\n我们现在使用推导出的公式和给定的参数来计算阵列功率。\n给定值为：\n$P_{\\text{STC}} = 4.5\\,\\mathrm{kW}$\n$G_{\\text{STC}} = 1000\\,\\mathrm{W/m^2}$\n$T_{\\text{STC}} = 298\\,\\mathrm{K}$\n$G = 950\\,\\mathrm{W/m^2}$\n$T_a = 310\\,\\mathrm{K}$\n$v = 0.5\\,\\mathrm{m/s}$\n$\\gamma = -0.004\\,\\mathrm{K^{-1}}$\n$\\eta = 0.18$\n$U_0 = 20\\,\\mathrm{W/(m^2\\cdot K)}$\n$U_1 = 6\\,\\mathrm{W/(m^2\\cdot K)}$\n\n首先，我们计算热浪条件下的电池温度 $T_c$：\n$$ T_c = T_a + \\frac{G(1 - \\eta)}{U_0 + U_1 v} = 310 + \\frac{950(1 - 0.18)}{20 + 6(0.5)} $$\n$$ T_c = 310 + \\frac{950(0.82)}{20 + 3} = 310 + \\frac{779}{23} $$\n$$ T_c \\approx 310 + 33.869565\\,\\mathrm{K} = 343.869565\\,\\mathrm{K} $$\n\n接下来，我们使用这个电池温度计算功率 $P$：\n$$ P = P_{\\text{STC}} \\frac{G}{G_{\\text{STC}}} \\left[ 1 + \\gamma (T_c - T_{\\text{STC}}) \\right] $$\n$$ P = 4.5\\,\\mathrm{kW} \\times \\frac{950}{1000} \\left[ 1 + (-0.004) (343.869565 - 298) \\right] $$\n$$ P = 4.275\\,\\mathrm{kW} \\times \\left[ 1 - 0.004 (45.869565) \\right] $$\n$$ P = 4.275\\,\\mathrm{kW} \\times \\left[ 1 - 0.183478 \\right] $$\n$$ P = 4.275\\,\\mathrm{kW} \\times 0.816522 $$\n$$ P \\approx 3.491413\\,\\mathrm{kW} $$\n四舍五入到四位有效数字，热浪情景下的预期阵列功率为 $3.491\\,\\mathrm{kW}$。\n\n### 第3部分：模型参数的物理解释\n\n下面简要讨论参数 $\\gamma$、$\\eta$、$U_0$ 和 $U_1$ 及其在热浪期间对系统性能的影响。\n\n*   **$\\gamma$，功率的温度系数：** 此参数量化了光伏组件功率输出对其工作温度变化的敏感性。对于主导市场的晶体硅技术，$\\gamma$ 通常在 $-0.003\\,\\mathrm{K^{-1}}$ 到 $-0.005\\,\\mathrm{K^{-1}}$ 的范围内。给定值 $-0.004\\,\\mathrm{K^{-1}}$ 是标准值。一个更负的值（更大的绝对值）意味着每升高一度温度，功率损失更大。在气候风险压力测试的背景下，对于给定的技术，选择在合理范围内更敏感的一端（例如，$-0.005\\,\\mathrm{K^{-1}}$）的 $\\gamma$ 值，构成了对热浪影响的保守、最坏情况的假设。\n\n*   **$\\eta$，组件电效率：** 这代表了入射太阳能转换为电能的比例。对于现代公用事业规模的硅组件，$\\eta$ 通常在 $0.18$ 到 $0.22$（$18\\%$ 到 $22\\%$）之间。值 $\\eta = 0.18$ 是合理的。从热学模型来看，更高的 $\\eta$ 意味着更小比例的太阳能 $(1-\\eta)$ 被转化为废热。这导致工作电池温度 $T_c$ 较低。因此，更高效率的组件天生运行温度更低，受温度引起的功率衰减影响也稍小。对于压力测试，为所建模型技术使用一个偏低但现实的效率是一个保守的选择，因为它将预测更高的电池温度，从而在热浪期间产生更大的功率损失。\n\n*   **$U_0$ 和 $U_1$，传热系数：** 这些系数定义了组件散热的能力。$U_0$ 捕捉了辐射和自然对流冷却，而 $U_1$ 模拟了由风引起的强制对流冷却。它们的值高度依赖于组件的安装方式；具有良好空气流通的开放式支架安装将比气流受限的屋顶集成系统具有更高的 $U_0$ 和 $U_1$ 值。对于典型的开放式支架安装， $U_0$ 通常在 $20-30\\,\\mathrm{W/(m^2\\cdot K)}$ 的范围内，而 $U_1$ 在 $2-7\\,\\mathrm{W/(m^2\\cdot K)}$ 的范围内。所提供的值（$U_0 = 20\\,\\mathrm{W/(m^2\\cdot K)}$, $U_1 = 6\\,\\mathrm{W/(m^2\\cdot K)}$）在物理上是合理的。较低的 $U_0$ 和 $U_1$ 值意味着散热较差，导致更高的电池温度和更大的功率损失。热浪通常与静止空气（低风速, $v$）相关，这会减小 $U_1$ 项的贡献，并使系统性能严重依赖于 $U_0$。对于保守的压力测试，人们会选择对应于通风不良的安装配置的 $U_0$ 和 $U_1$ 值，从而最大化预测的温升。",
            "answer": "$$\\boxed{3.491}$$"
        },
        {
            "introduction": "在对组件级影响进行建模之后，压力测试要求我们描述未来气候条件的特征及其对全系统的影响。本练习将指导你处理一组气候模型的输出，以创建一个概率性的温度预测。接着，你将学习如何通过应用温度敏感性模型，将这种气候不确定性传播到关键的系统变量——峰值电力需求中 。",
            "id": "4078017",
            "problem": "考虑一个区域电力系统，正在对未来2050年夏季进行气候风险压力测试。一个由5个全球环流模型 (GCMs) 组成的集合，提供了对该地区夏季平均2米气温的预测。该集合的特征在于模型特定的预测夏季平均气温 $\\mu_i$ 和基于性能的权重 $w_i$，且满足 $\\sum_{i=1}^{5} w_i = 1$。每个模型均值周围的夏季年际变率近似为具有共同标准差 $\\sigma$ 的高斯分布。为了同时表示模型离差和内部变率，采用分层表示法，其中潜在的模型均值 $\\mu$ 被视为一个随机变量，而年际温度 $T$ 在给定 $\\mu$ 的条件下服从高斯分布。GCM集合提供了以下输入：\n- 加权模型均值：$(\\mu_1, \\mu_2, \\mu_3, \\mu_4, \\mu_5) = (30.1, 29.8, 30.5, 30.3, 30.0)$ 摄氏度，\n- 权重：$(w_1, w_2, w_3, w_4, w_5) = (0.25, 0.15, 0.20, 0.25, 0.15)$，\n- 年际标准差：$\\sigma = 1.1$ 摄氏度。\n\n假设 $\\mu$ 被建模为一个高斯随机变量，其均值和方差由 $(\\mu_i, w_i)$ 的加权集合确定。在给定 $\\mu$ 的条件下，夏季温度 $T$ 服从均值为 $\\mu$、方差为 $\\sigma^2$ 的高斯分布。\n\n一个线性温度-需求敏感性模型用于夏季峰值需求预测。设参考温度下的基准峰值需求为 $D_{\\text{ref}} = 9.5$ 吉瓦，此时参考温度为 $T_{\\text{ref}} = 28$ 摄氏度。温度敏感性系数为 $\\alpha = 0.35$ 吉瓦/摄氏度，峰值需求建模为 $D(T) = D_{\\text{ref}} + \\alpha (T - T_{\\text{ref}})$。\n\n从集合平均、全期望定律和全方差定律的基本定义，以及通过高斯分布的累积分布函数 (CDF) 定义的分位数出发，从第一性原理推导 $T$ 的集合均值和上十分位数（$0.9$-分位数）。然后，使用线性敏感性模型将 $0.9$-分位数温度传播到峰值需求预测中。\n\n计算2050年预测的夏季峰值需求的 $0.9$-分位数。最终答案以吉瓦为单位，并四舍五入到四位有效数字。",
            "solution": "该问题被评估为有效，因为它在科学上基于标准的统计和能源建模实践，问题陈述清晰，提供了所有必要信息，并以客观、明确的语言表达。所有数据都是一致且物理上合理的。\n\n目标是计算2050年夏季峰值需求 $D$ 的 $0.9$-分位数。需求 $D$ 是夏季平均温度 $T$ 的线性函数，而 $T$ 是一个随机变量。求解过程分为三个主要步骤：首先，从给定的分层模型中推导 $T$ 的无条件概率分布；其次，计算温度的 $0.9$-分位数 $T_{0.9}$；第三，将此分位数通过需求模型传播，以找到相应的需求分位数 $D_{0.9}$。\n\n**第1步：推导温度 $T$ 的无条件分布**\n\n温度 $T$ 由一个分层高斯模型描述。潜在平均温度 $\\mu$ 代表模型不确定性，被建模为一个高斯随机变量，其参数由加权的 GCM 集合推导得出。在给定 $\\mu$ 的特定值的情况下，夏季温度 $T$ 也服从高斯分布，代表年际变率。\n\n潜在均值 $\\mu$ 的分布由 $\\mu \\sim \\mathcal{N}(\\mu_{\\text{ens}}, \\sigma_{\\text{ens}}^2)$ 给出，其中 $\\mu_{\\text{ens}}$ 是 GCM 集合预测的加权平均值，$\\sigma_{\\text{ens}}^2$ 是加权方差。\n$\\mu$ 的均值是其期望值 $E[\\mu]$，计算为 GCM 均值 $\\mu_i$ 的加权平均值：\n$$E[\\mu] = \\mu_{\\text{ens}} = \\sum_{i=1}^{5} w_i \\mu_i$$\n$\\mu$ 的方差 $\\text{Var}(\\mu)$ 是 GCM 均值的加权方差：\n$$\\text{Var}(\\mu) = \\sigma_{\\text{ens}}^2 = \\sum_{i=1}^{5} w_i (\\mu_i - \\mu_{\\text{ens}})^2$$\n\n给定潜在均值 $\\mu$ 时，温度 $T$ 的条件分布是 $T \\mid \\mu \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其中 $\\sigma$ 是年际标准差。\n\n为了找到 $T$ 的无条件分布，我们应用全期望定律和全方差定律。\n\n$T$ 的无条件均值使用全期望定律求得：\n$$E[T] = E[E[T \\mid \\mu]]$$\n由于 $E[T \\mid \\mu] = \\mu$，我们有：\n$$E[T] = E[\\mu] = \\mu_{\\text{ens}}$$\n$T$ 的无条件方差使用全方差定律求得：\n$$\\text{Var}(T) = E[\\text{Var}(T \\mid \\mu)] + \\text{Var}(E[T \\mid \\mu])$$\n由于 $\\text{Var}(T \\mid \\mu) = \\sigma^2$ (一个常数) 且 $E[T \\mid \\mu] = \\mu$：\n$$\\text{Var}(T) = E[\\sigma^2] + \\text{Var}(\\mu) = \\sigma^2 + \\sigma_{\\text{ens}}^2$$\n因为混合分布 ($\\mu$) 和条件分布 ($T \\mid \\mu$) 都是高斯分布，所以得到的 $T$ 的无条件分布也是高斯分布：\n$$T \\sim \\mathcal{N}(\\mu_{\\text{ens}}, \\sigma_{\\text{ens}}^2 + \\sigma^2)$$\n\n现在，我们使用提供的数据计算这些参数的数值：\n$\\mu_i = (30.1, 29.8, 30.5, 30.3, 30.0)$\n$w_i = (0.25, 0.15, 0.20, 0.25, 0.15)$\n$\\sigma = 1.1$\n\n集合均值 $\\mu_{\\text{ens}}$ 是：\n$$\\mu_{\\text{ens}} = (0.25)(30.1) + (0.15)(29.8) + (0.20)(30.5) + (0.25)(30.3) + (0.15)(30.0)$$\n$$\\mu_{\\text{ens}} = 7.525 + 4.470 + 6.100 + 7.575 + 4.500 = 30.17$$\n集合方差 $\\sigma_{\\text{ens}}^2$ 是：\n$$\\sigma_{\\text{ens}}^2 = 0.25(30.1 - 30.17)^2 + 0.15(29.8 - 30.17)^2 + 0.20(30.5 - 30.17)^2 + 0.25(30.3 - 30.17)^2 + 0.15(30.0 - 30.17)^2$$\n$$\\sigma_{\\text{ens}}^2 = 0.25(-0.07)^2 + 0.15(-0.37)^2 + 0.20(0.33)^2 + 0.25(0.13)^2 + 0.15(-0.17)^2$$\n$$\\sigma_{\\text{ens}}^2 = 0.25(0.0049) + 0.15(0.1369) + 0.20(0.1089) + 0.25(0.0169) + 0.15(0.0289)$$\n$$\\sigma_{\\text{ens}}^2 = 0.001225 + 0.020535 + 0.021780 + 0.004225 + 0.004335 = 0.0521$$\n温度 $T$ 的总方差是：\n$$\\text{Var}(T) = \\sigma^2 + \\sigma_{\\text{ens}}^2 = (1.1)^2 + 0.0521 = 1.21 + 0.0521 = 1.2621$$\n因此，温度的无条件分布是 $T \\sim \\mathcal{N}(30.17, 1.2621)$。集合平均温度是 $30.17$ 摄氏度。\n\n**第2步：计算温度的 $0.9$-分位数 ($T_{0.9}$)**\n\n对于一个具有累积分布函数 (CDF) $F_X(x)$ 的随机变量 $X$，其 $q$-分位数是值 $x_q$，使得 $F_X(x_q) = P(X \\le x_q) = q$。对于一个高斯变量 $T \\sim \\mathcal{N}(\\mu_T, \\sigma_T^2)$，其 $q$-分位数 $T_q$ 由下式给出：\n$$T_q = \\mu_T + \\sigma_T z_q$$\n其中 $z_q$ 是标准正态分布 $\\mathcal{N}(0, 1)$ 的 $q$-分位数。\n\n我们需要找到 $0.9$-分位数 ($q=0.9$)，也称为上十分位数。从标准统计表或计算可知，对应于累积概率 $0.9$ 的 $z$-分数是 $z_{0.9} \\approx 1.28155$。\n$T$ 的分布参数是 $\\mu_T = 30.17$ 和 $\\sigma_T^2 = 1.2621$。标准差是 $\\sigma_T = \\sqrt{1.2621}$。\n$$T_{0.9} = 30.17 + \\sqrt{1.2621} \\times z_{0.9} \\approx 30.17 + (1.123432) \\times (1.28155) \\approx 30.17 + 1.43979 \\approx 31.60979$$\n\n**第3步：将分位数传播到峰值需求**\n\n峰值需求 $D$ 是温度 $T$ 的线性函数：\n$$D(T) = D_{\\text{ref}} + \\alpha (T - T_{\\text{ref}})$$\n其中 $D_{\\text{ref}} = 9.5$ 吉瓦， $T_{\\text{ref}} = 28$ 摄氏度，$\\alpha = 0.35$ 吉瓦/°C。\n由于系数 $\\alpha = 0.35  0$，函数 $D(T)$ 是单调递增的。对于一个单调递增函数 $g(X)$，变换后的变量 $Y=g(X)$ 的 $q$-分位数由 $y_q = g(x_q)$ 给出。因此，需求的 $0.9$-分位数 $D_{0.9}$ 可以通过在 $T_{0.9}$ 处评估需求函数来找到。\n$$D_{0.9} = D(T_{0.9}) = D_{\\text{ref}} + \\alpha (T_{0.9} - T_{\\text{ref}})$$\n代入数值：\n$$D_{0.9} \\approx 9.5 + 0.35 (31.60979 - 28)$$\n$$D_{0.9} \\approx 9.5 + 0.35 (3.60979) \\approx 9.5 + 1.2634265 = 10.7634265$$\n问题要求最终答案四舍五入到四位有效数字。\n$$D_{0.9} \\approx 10.76$$\n\n预测的2050年夏季峰值需求的 $0.9$-分位数是 $10.76$ 吉瓦。",
            "answer": "$$\\boxed{10.76}$$"
        },
        {
            "introduction": "气候风险压力测试的最终目标是为更稳健的运营和规划决策提供信息。最后的这个实践练习将各种影响整合到一个不确定性下的决策框架中，使用一个简化的机组组合（UC）问题作为案例。你将比较传统的期望成本优化方法与使用风险价值条件 ($CVaR$) 的风险规避方法，学习如何明确地管理由极端气候事件暴露出的尾部风险 。",
            "id": "4078008",
            "problem": "给定一个表示电力系统气候压力下场景不确定性的单区间机组组合 (UC) 问题。UC 决策是一个针对三个火电机组的二进制启停向量，在场景实现之前的日前选定。每个场景指定一个净负荷（需求减去可变可再生能源）和相关的概率。每个场景中的调度必须遵守发电机容量约束和最小稳定运行水平。允许出现缺电（未服务能源），并会产生旨在代表社会失负荷价值 (VOLL) 的罚款。您必须为两种策略计算可靠性指标和成本风险：期望成本UC和风险条件价值UC。\n\n定义和约束：\n- 机组组合 (UC) 为每个火电机组 $i$ 确定一个二进制决策 $x_i \\in \\{0,1\\}$，指示该机组在该区间是否启停。\n- 如果启停，发电机 $i$ 必须至少产生其最小稳定出力 $P^{\\min}_i$，最多产生 $P^{\\max}_i$；如果未启停，则其出力为 $0$。\n- 发电机 $i$ 的可变成本为每兆瓦时 (MWh) $c_i$ 美元，如果启停则启动成本为 $s_i$ 美元，未服务能源的罚款为每兆瓦时 $c^{\\text{short}}$ 美元。\n- 每个场景中的调度在满足容量约束的情况下，最小化可变发电成本，并尽可能满足净负荷；允许出现缺电。已启停机组必须产生其最小出力，额外的调度按照优先顺序（首先是最低的 $c_i$）分配，直至达到 $P^{\\max}_i$。在耗尽 $\\sum_i x_i P^{\\max}_i$ 后任何剩余的未满足需求即为缺电量 $\\text{shortfall}_s$。\n- 期望总成本为 $\\mathbb{E}[C] = \\sum_{s} p_s C_s$，其中 $C_s$ 是场景 $s$ 中的总成本，而 $p_s$ 是该场景的概率。\n- 对于成本随机变量 $C$，在水平 $\\alpha \\in (0,1)$ 的风险条件价值 (CVaR) 定义为最差的 $(1-\\alpha)$ 尾部结果的平均值。对于具有成本 $C_s$ 和概率 $p_s$ 的离散分布，让 $(C_{(1)},p_{(1)}),\\dots,(C_{(m)},p_{(m)})$ 按 $C$ 递增排序，并让 $k$ 是满足 $\\sum_{j=1}^{k} p_{(j)} \\ge \\alpha$ 的最小索引。那么，在水平 $\\alpha$ 的风险价值 (VaR) 是 $C_{(k)}$，而风险条件价值是\n$$\n\\text{CVaR}_\\alpha(C) = \\frac{1}{1-\\alpha}\\left(\\sum_{j=k+1}^{m} p_{(j)} C_{(j)} + \\left(\\sum_{j=1}^{k} p_{(j)} - \\alpha\\right) C_{(k)}\\right).\n$$\n- 可靠性指标：\n  - 缺电概率为 $\\sum_s p_s \\mathbf{1}\\{\\text{shortfall}_s > 0\\}$，以小数表示。\n  - 期望未服务能源为 $\\sum_s p_s \\cdot \\text{shortfall}_s$，单位为兆瓦时 (MWh)。\n\n策略：\n- 期望成本UC选择一个启停向量 $x$，在上述场景和调度规则下最小化 $\\mathbb{E}[C]$。\n- 风险条件价值 (CVaR) UC选择一个启停向量 $x$，在相同的场景和调度规则下最小化 $\\text{CVaR}_\\alpha(C)$。\n\n任务：\n1. 对于下面的每个测试用例，枚举所有 $2^3$ 个启停向量 $x \\in \\{0,1\\}^3$，并对每个 $x$ 计算场景成本 $C_s$。这需要解决每个场景的最低成本调度问题，并满足以下条件：\n   - 如果 $x_i=1$，调度 $g_i \\in [P^{\\min}_i, P^{\\max}_i]$；如果 $x_i=0$，则 $g_i=0$。\n   - 设 $L_s$ 为场景 $s$ 的净负荷。首先满足强制性最小出力 $\\sum_i x_i P^{\\min}_i$。如果仍有剩余需求，则按 $c_i$ 的递增顺序将额外发电量分配给已启停机组，直至达到 $P^{\\max}_i$。在耗尽 $\\sum_i x_i P^{\\max}_i$ 后的任何剩余未满足需求即为缺电量 $\\text{shortfall}_s$。\n   - 场景成本为 $C_s = \\sum_i x_i s_i + \\sum_i c_i g_i + c^{\\text{short}} \\cdot \\text{shortfall}_s$。\n2. 针对每个测试用例，确定最小化 $\\mathbb{E}[C]$ 的期望成本UC策略和最小化 $\\text{CVaR}_\\alpha(C)$ 的CVaR UC策略。\n3. 对于每个确定的策略，计算：\n   - 期望总成本，单位为美元。\n   - 成本的 $\\text{CVaR}_\\alpha$，单位为美元。\n   - 缺电概率，以小数表示。\n   - 期望未服务能源，单位为兆瓦时 (MWh)。\n\n单位和格式：\n- 所有成本必须以美元表示，四舍五入到两位小数。\n- 能源量必须以 MWh 表示，四舍五入到三位小数。\n- 概率必须以小数表示，四舍五入到三位小数。\n- 不涉及角度。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，结果必须按顺序排列如下：\n  - 期望成本UC：期望总成本（美元），$\\text{CVaR}_\\alpha$（美元），缺电概率（小数），期望未服务能源（MWh），\n  - CVaR UC：期望总成本（美元），$\\text{CVaR}_\\alpha$（美元），缺电概率（小数），期望未服务能源（MWh）。\n\n测试套件：\n- 所有测试通用的发电机组：\n  - 发电机 1：$P^{\\min}_1 = 20$ MW, $P^{\\max}_1 = 100$ MW, $c_1 = 50$ 美元/MWh, $s_1 = 1000$ 美元。\n  - 发电机 2：$P^{\\min}_2 = 10$ MW, $P^{\\max}_2 = 50$ MW, $c_2 = 80$ 美元/MWh, $s_2 = 600$ 美元。\n  - 发电机 3：$P^{\\min}_3 = 0$ MW, $P^{\\max}_3 = 30$ MW, $c_3 = 200$ 美元/MWh。其启动成本 $s_3$ 根据测试用例的不同而变化。\n- 测试用例 1（一般情况）：\n  - 场景：净负荷 $L = [120, 160, 90]$ MW，概率 $p = [0.5, 0.3, 0.2]$。\n  - 罚款 $c^{\\text{short}} = 10000$ 美元/MWh。\n  - 启动成本向量 $s = [1000, 600, 200]$ 美元。\n  - 风险水平 $\\alpha = 0.9$。\n- 测试用例 2（在VaR处有集中质量的边界尾部概率）：\n  - 场景：净负荷 $L = [100, 150, 200]$ MW，概率 $p = [0.7, 0.29, 0.01]$。\n  - 罚款 $c^{\\text{short}} = 10000$ 美元/MWh。\n  - 启动成本向量 $s = [1000, 600, 200]$ 美元。\n  - 风险水平 $\\alpha = 0.99$。\n- 测试用例 3（CVaR策略与期望成本策略不同的边缘情况）：\n  - 场景：净负荷 $L = [120, 140, 190]$ MW，概率 $p = [0.6, 0.32, 0.08]$。\n  - 罚款 $c^{\\text{short}} = 500$ 美元/MWh。\n  - 启动成本向量 $s = [1000, 600, 2000]$ 美元。\n  - 风险水平 $\\alpha = 0.9$。\n\n您的程序必须实现上述逻辑，并按所述的确切格式生成单行输出。不需要外部输入，所有数值结果都应根据此处提供的测试套件计算得出。",
            "solution": "该问题是有效的。这是一个定义明确的优化问题，其基础是电力系统工程和金融风险管理的标准原则。所有必要的数据、定义、约束和目标函数都已提供。该问题是自洽的、科学上合理的，并且可以通过算法求解。\n\n### 第1步：提取已知条件\n\n**发电机参数（所有测试用例通用）：**\n- 发电机 1：$P^{\\min}_1 = 20$ MW, $P^{\\max}_1 = 100$ MW, $c_1 = 50$ 美元/MWh。\n- 发电机 2：$P^{\\min}_2 = 10$ MW, $P^{\\max}_2 = 50$ MW, $c_2 = 80$ 美元/MWh。\n- 发电机 3：$P^{\\min}_3 = 0$ MW, $P^{\\max}_3 = 30$ MW, $c_3 = 200$ 美元/MWh。\n- 调度优先顺序：发电机 1，然后是发电机 2，然后是发电机 3，基于递增的可变成本 $c_i$。\n\n**决策变量：**\n- 机组组合 (UC)：对每个发电机 $i \\in \\{1, 2, 3\\}$，$x_i \\in \\{0,1\\}$。\n- 发电调度：对每个发电机 $i$，$g_i \\ge 0$。\n\n**约束：**\n- 如果 $x_i = 0$，则 $g_i = 0$。\n- 如果 $x_i = 1$，则 $P^{\\min}_i \\le g_i \\le P^{\\max}_i$。\n\n**成本组成部分：**\n- 启动成本：如果机组 $i$ 启停 ($x_i=1$)，则为 $s_i$。\n- 可变成本：每兆瓦时发电量 $g_i$ 的成本为 $c_i$。\n- 缺电罚款：每兆瓦时未服务能源的成本为 $c^{\\text{short}}$。\n\n**场景成本计算：**\n- 对于给定的启停向量 $x$ 和具有净负荷 $L_s$ 的场景 $s$：\n  1. 设置最小发电量：$g_i = x_i P^{\\min}_i$。\n  2. 按照优先顺序将剩余需求分配给已启停机组，直至其 $P^{\\max}_i$。\n  3. 缺电量 $\\text{shortfall}_s$ 是任何剩余的未满足需求。\n  4. 总场景成本：$C_s = \\sum_i x_i s_i + \\sum_i c_i g_i + c^{\\text{short}} \\cdot \\text{shortfall}_s$。\n\n**用于UC策略选择的目标函数：**\n- 期望成本：最小化 $\\mathbb{E}[C] = \\sum_{s} p_s C_s$。\n- 风险条件价值 (CVaR)：最小化 $\\text{CVaR}_\\alpha(C) = \\frac{1}{1-\\alpha}\\left(\\sum_{j=k+1}^{m} p_{(j)} C_{(j)} + \\left(\\sum_{j=1}^{k} p_{(j)} - \\alpha\\right) C_{(k)}\\right)$，其中 $(C_{(j)}, p_{(j)})$ 是按成本排序的成本和概率，而 $k$ 是满足 $\\sum_{j=1}^{k} p_{(j)} \\ge \\alpha$ 的最小索引。\n\n**可靠性指标：**\n- 缺电概率：$\\sum_s p_s \\mathbf{1}\\{\\text{shortfall}_s > 0\\}$。\n- 期望未服务能源：$\\sum_s p_s \\cdot \\text{shortfall}_s$。\n\n**测试用例 1：**\n- 场景：$L = [120, 160, 90]$ MW, $p = [0.5, 0.3, 0.2]$。\n- $c^{\\text{short}} = 10000$ 美元/MWh。\n- 启动成本：$s = [1000, 600, 200]$ 美元。\n- 风险水平：$\\alpha = 0.9$。\n\n**测试用例 2：**\n- 场景：$L = [100, 150, 200]$ MW, $p = [0.7, 0.29, 0.01]$。\n- $c^{\\text{short}} = 10000$ 美元/MWh。\n- 启动成本：$s = [1000, 600, 200]$ 美元。\n- 风险水平：$\\alpha = 0.99$。\n\n**测试用例 3：**\n- 场景：$L = [120, 140, 190]$ MW, $p = [0.6, 0.32, 0.08]$。\n- $c^{\\text{short}} = 500$ 美元/MWh。\n- 启动成本：$s = [1000, 600, 2000]$ 美元。\n- 风险水平：$\\alpha = 0.9$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题是**有效的**。\n- **科学基础：** 机组组合、经济调度、优先顺序、期望成本最小化和风险条件价值等概念是电力系统运行和风险管理中的标准和基础内容。\n- **适定性：** 该问题的结构保证了其存在唯一的、稳定的解。对有限集合 $2^3=8$ 个启停决策的枚举确保了 $\\mathbb{E}[C]$ 和 $\\text{CVaR}_\\alpha(C)$ 的最小值都存在并且可以被找到。\n- **客观性：** 该问题使用精确、形式化的数学和工程术语陈述，没有主观语言。\n- **完整且一致：** 为每个测试用例提供了所有必要的参数（发电机特性、成本、负荷场景、概率、风险水平）。所提供的数据或约束中没有矛盾。\n- **可行性：** 所描述的条件在简化的电力系统模型背景下是物理上和经济上合理的。\n\n### 第3步：算法求解\n求解方法涉及对每个测试用例的所有可能的启停决策进行系统性评估。\n\n1.  **定义系统参数**：为每个测试用例定义发电机数据、场景数据（负荷和概率）、启动成本、缺电罚款和 $\\alpha$ 水平。发电机索引为 0、1、2，它们的调度优先顺序是固定的，因为这对应于它们递增的可变成本（$c_0 = 50$，$c_1 = 80$，$c_2 = 200$ 美元/MWh）。\n\n2.  **枚举启停向量**：存在 $2^3=8$ 个可能的二进制启停向量，从 $x=[0,0,0]$到 $x=[1,1,1]$。我们将遍历这些向量中的每一个。\n\n3.  **计算每个启停决策的场景结果**：对于给定的启停向量 $x$：\n    a.  **计算总启动成本**：$S(x) = \\sum_{i=0}^{2} x_i s_i$。\n    b.  **对于每个场景 $s$（负荷为 $L_s$，概率为 $p_s$）：**\n        i.  如果机组 $i$ 启停，则将其初始发电量设置为其最小稳定水平：$g_{i,s} = x_i P^{\\min}_i$。\n        ii. 计算总最小发电量 $G_{\\min} = \\sum_i g_{i,s}$。\n        iii. 计算待由可调度容量满足的剩余需求：$D^{\\text{resid}}_s = L_s - G_{\\min}$。我们可以假设 $D^{\\text{resid}}_s \\ge 0$，因为所有给定的负荷都超过了可能的最大最小出力总和。\n        iv. 按优先顺序（$i=0, 1, 2$）从已启停机组顺序调度额外电力：\n            - 对于每个机组 $i$，可用的可调度容量为 $\\Delta P_i^{\\max} = x_i (P^{\\max}_i - P^{\\min}_i)$。\n            - 该机组调度的电量为 $\\Delta g_{i,s} = \\min(D^{\\text{resid}}_s, \\Delta P_i^{\\max})$。\n            - 更新该机组的发电量：$g_{i,s} = g_{i,s} + \\Delta g_{i,s}$。\n            - 更新剩余需求：$D^{\\text{resid}}_s = D^{\\text{resid}}_s - \\Delta g_{i,s}$。\n        v. 遍历所有机组后，任何剩余的 $D^{\\text{resid}}_s  0$ 都是该场景的能源缺口：$\\text{shortfall}_s = D^{\\text{resid}}_s$。\n        vi. 计算此场景的总成本：$C_s(x) = S(x) + \\sum_{i=0}^{2} c_i g_{i,s} + c^{\\text{short}} \\cdot \\text{shortfall}_s$。\n\n4.  **计算每个启停决策的聚合指标**：在计算了启停决策 $x$ 下所有场景的成本 $C_s(x)$ 和缺电量 $\\text{shortfall}_s$ 后：\n    a.  **期望成本**：$\\mathbb{E}[C(x)] = \\sum_s p_s C_s(x)$。\n    b.  **风险条件价值**：\n        i.  创建 $(C_s(x), p_s)$ 对，并按成本 $C_s(x)$ 升序排序，得到 $(C_{(j)}, p_{(j)})$。\n        ii. 找到满足累积概率 $\\sum_{j=1}^{k} p_{(j)} \\ge \\alpha$ 的最小索引 $k$。\n        iii. 应用所提供的公式计算 $\\text{CVaR}_\\alpha(C(x))$。\n    c.  **缺电概率**：$P(\\text{shortfall}0) = \\sum_{s \\text{ s.t. } \\text{shortfall}_s  0} p_s$。\n    d.  **期望未服务能源 (EUE)**：$\\mathbb{E}[\\text{shortfall}] = \\sum_s p_s \\cdot \\text{shortfall}_s$。\n\n5.  **确定最优策略**：\n    a.  在计算完所有 8 个启停向量的指标后，找到具有最小 $\\mathbb{E}[C(x)]$ 的向量 $x_{\\text{E}}$。\n    b.  找到具有最小 $\\text{CVaR}_\\alpha(C(x))$ 的向量 $x_{\\text{CVaR}}$。\n    c.  如果多个向量达到最小值，任何一个都是有效选择。实现将选择遇到的第一个。\n\n6.  **报告结果**：对于每个测试用例，为 $x_{\\text{E}}$ 策略和 $x_{\\text{CVaR}}$ 策略编制所需的四个指标（$\\mathbb{E}[C]$、$\\text{CVaR}_\\alpha(C)$、$P(\\text{shortfall})$、EUE）。数值必须按规定进行四舍五入。\n\n这个全面的过程在以下 Python 代码中实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the climate risk stress testing problem for unit commitment.\n    \"\"\"\n    \n    # Common generator parameters (index 0, 1, 2)\n    gen_params_base = [\n        {'p_min': 20, 'p_max': 100, 'c': 50},  # Gen 1\n        {'p_min': 10, 'p_max': 50,  'c': 80},  # Gen 2\n        {'p_min': 0,  'p_max': 30,  'c': 200}, # Gen 3\n    ]\n\n    test_cases = [\n        {\n            # Test case 1\n            \"scenarios\": {'L': np.array([120, 160, 90]), 'p': np.array([0.5, 0.3, 0.2])},\n            \"c_short\": 10000,\n            \"s\": [1000, 600, 200],\n            \"alpha\": 0.9\n        },\n        {\n            # Test case 2\n            \"scenarios\": {'L': np.array([100, 150, 200]), 'p': np.array([0.7, 0.29, 0.01])},\n            \"c_short\": 10000,\n            \"s\": [1000, 600, 200],\n            \"alpha\": 0.99\n        },\n        {\n            # Test case 3\n            \"scenarios\": {'L': np.array([120, 140, 190]), 'p': np.array([0.6, 0.32, 0.08])},\n            \"c_short\": 500,\n            \"s\": [1000, 600, 2000],\n            \"alpha\": 0.9\n        }\n    ]\n\n    final_results = []\n    \n    # Define merit order based on variable cost\n    merit_order = sorted(range(len(gen_params_base)), key=lambda i: gen_params_base[i]['c'])\n\n    def calculate_cvar(costs, probs, alpha):\n        if not (0  alpha  1):\n            raise ValueError(\"Alpha must be in (0,1)\")\n        \n        items = sorted(zip(costs, probs))\n        sorted_costs = np.array([item[0] for item in items])\n        sorted_probs = np.array([item[1] for item in items])\n\n        cum_probs = np.cumsum(sorted_probs)\n        \n        # Find index k_idx where cumulative probability first exceeds or equals alpha\n        k_idx = np.searchsorted(cum_probs, alpha, side='left')\n\n        if k_idx >= len(sorted_costs): # Should not happen if sum(probs) is 1\n            k_idx = len(sorted_costs) - 1\n\n        val_at_risk = sorted_costs[k_idx]\n        \n        # Sum of p*C for outcomes worse than VaR\n        tail_sum = np.sum(sorted_probs[k_idx+1:] * sorted_costs[k_idx+1:])\n        \n        # Probability mass at VaR\n        prob_sum_at_k = cum_probs[k_idx]\n        \n        # Formula from problem statement\n        cvar_numerator = tail_sum + (prob_sum_at_k - alpha) * val_at_risk\n        cvar = cvar_numerator / (1 - alpha)\n        \n        return cvar\n\n    def calculate_scenario_outcomes(commitment, generators, scenarios, c_short):\n        num_scenarios = len(scenarios['L'])\n        startup_cost = sum(gen['s'] for i, gen in enumerate(generators) if commitment[i] == 1)\n        \n        scenario_costs = np.zeros(num_scenarios)\n        shortfalls = np.zeros(num_scenarios)\n\n        for s_idx, load in enumerate(scenarios['L']):\n            g = np.array([generators[i]['p_min'] if commitment[i] else 0 for i in range(len(generators))])\n            min_gen_total = np.sum(g)\n            \n            residual_demand = load - min_gen_total\n            variable_cost = np.sum(g * np.array([gen['c'] for gen in generators]))\n            \n            if residual_demand > 0:\n                for unit_idx in merit_order:\n                    if commitment[unit_idx]:\n                        dispatchable_range = generators[unit_idx]['p_max'] - generators[unit_idx]['p_min']\n                        dispatch = min(residual_demand, dispatchable_range)\n                        \n                        g[unit_idx] += dispatch\n                        variable_cost += dispatch * generators[unit_idx]['c']\n                        residual_demand -= dispatch\n\n                        if residual_demand = 1e-9: # Floating point tolerance\n                            break\n            \n            shortfall = max(0, residual_demand)\n            shortfall_cost = shortfall * c_short\n            \n            scenario_costs[s_idx] = startup_cost + variable_cost + shortfall_cost\n            shortfalls[s_idx] = shortfall\n\n        return scenario_costs, shortfalls\n\n    for case in test_cases:\n        generators = [dict(base, s=startup) for base, startup in zip(gen_params_base, case['s'])]\n        scenarios = case['scenarios']\n        c_short = case['c_short']\n        alpha = case['alpha']\n        \n        uc_results = []\n        \n        for i in range(8): # Iterate through 2^3=8 commitment vectors\n            commitment = [(i >> 2)  1, (i >> 1)  1, i  1]\n            \n            scenario_costs, shortfalls = calculate_scenario_outcomes(commitment, generators, scenarios, c_short)\n            \n            probs = scenarios['p']\n            exp_cost = np.sum(probs * scenario_costs)\n            cvar = calculate_cvar(scenario_costs, probs, alpha)\n            prob_shortfall = np.sum(probs[shortfalls > 1e-9])\n            eue = np.sum(probs * shortfalls)\n            \n            uc_results.append({\n                \"exp_cost\": exp_cost,\n                \"cvar\": cvar,\n                \"prob_shortfall\": prob_shortfall,\n                \"eue\": eue\n            })\n\n        # Find best policies\n        exp_cost_uc_result = min(uc_results, key=lambda x: x['exp_cost'])\n        cvar_uc_result = min(uc_results, key=lambda x: x['cvar'])\n        \n        # Append results for Expected Cost UC policy\n        final_results.append(f\"{exp_cost_uc_result['exp_cost']:.2f}\")\n        final_results.append(f\"{exp_cost_uc_result['cvar']:.2f}\")\n        final_results.append(f\"{exp_cost_uc_result['prob_shortfall']:.3f}\")\n        final_results.append(f\"{exp_cost_uc_result['eue']:.3f}\")\n\n        # Append results for CVaR UC policy\n        final_results.append(f\"{cvar_uc_result['exp_cost']:.2f}\")\n        final_results.append(f\"{cvar_uc_result['cvar']:.2f}\")\n        final_results.append(f\"{cvar_uc_result['prob_shortfall']:.3f}\")\n        final_results.append(f\"{cvar_uc_result['eue']:.3f}\")\n\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```"
        }
    ]
}