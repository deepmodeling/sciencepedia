{
    "hands_on_practices": [
        {
            "introduction": "在能源系统建模中，尤其是在电力系统分析中，我们经常面临在节点模型（高精度）和区域模型（高效率）之间的选择。区域模型通过聚合节点来简化网络，但这会掩盖区域内部的输电阻塞，可能导致对潮流的错误估计。本练习 () 将引导您通过一个具体的四节点系统，从第一性原理出发计算节点和区域的功率传输分布因子（PTDFs），从而亲手量化空间聚合所引入的误差。",
            "id": "4124091",
            "problem": "给定一个由 $4$ 个节点和 $5$ 条输电线路组成的连通输电网络的直流 (DC) 近似模型。在直流近似法下，节点电压幅值设为 $1$ 标幺值，忽略无功功率，有功功率潮流通过线路电纳与节点电压相角呈线性关系。对于每条电纳为 $b_{ij}$ 的线路 $(i,j)$，其有功功率潮流 $f_{ij}$ 由 $f_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$ 给出，其中 $\\theta_i$ 是节点 $i$ 的电压相角，单位为弧度。节点功率平衡要求 $\\sum_j B_{ij} \\theta_j = P_i$，其中 $P_i$ 是节点 $i$ 的净有功功率注入，单位为兆瓦 (MW)，$B$ 是由线路电纳 $b_{ij}$ 构成的节点电纳矩阵。将节点 $1$ 作为平衡（参考）节点，其相角固定为 $\\theta_1 = 0$ 弧度。所有相角单位必须为弧度，所有有功功率单位必须为兆瓦 (MW)。\n\n网络参数：\n- 节点：$\\{1,2,3,4\\}$。\n- 线路（具有固定方向和电纳，单位为 $\\text{MW}/\\text{rad}$）：\n  - 线路 $\\ell_1$：$(1 \\rightarrow 2)$，$b_{12} = 10$。\n  - 线路 $\\ell_2$：$(2 \\rightarrow 3)$，$b_{23} = 5$。\n  - 线路 $\\ell_3$：$(3 \\rightarrow 4)$，$b_{34} = 8$。\n  - 线路 $\\ell_4$：$(1 \\rightarrow 4)$，$b_{14} = 7$。\n  - 线路 $\\ell_5$：$(2 \\rightarrow 4)$，$b_{24} = 6$。\n\n区域与聚合：\n- 定义 $2$ 个区域：区域 $\\mathcal{A} = \\{2,3\\}$ 和区域 $\\mathcal{B} = \\{4\\}$。节点 $1$ 是平衡节点，不属于任何区域。\n- 区域聚合在每个区域内使用固定的分配权重：在区域 $\\mathcal{A}$ 中，权重为 $w_2 = 0.5$ 和 $w_3 = 0.5$；在区域 $\\mathcal{B}$ 中，权重为 $w_4 = 1.0$。这些权重表明，区域净注入功率 $Z_{\\mathcal{A}}$ 在内部分配为 $P_2 = 0.5 Z_{\\mathcal{A}}$ 和 $P_3 = 0.5 Z_{\\mathcal{A}}$，而区域净注入功率 $Z_{\\mathcal{B}}$ 则完全分配给节点 $4$。\n\n任务：\n1. 仅使用上述直流近似法和网络定义，构建节点电纳矩阵 $B$ 和非平衡节点的降阶系统。计算线路 $\\ell_1$ 到 $\\ell_5$ 相对于节点 $\\{2,3,4\\}$ 和平衡节点 $1$ 的节点功率转移分布因子 (PTDF)，其定义为：在节点 $n \\in \\{2,3,4\\}$ 注入 $+1$ MW 功率并在平衡节点 $1$ 取出 $-1$ MW 功率时，线路潮流 $f_{\\ell}$ (单位 MW) 的灵敏度。\n2. 根据节点 PTDF 和给定的区域权重，计算在上述聚合规则下，将区域净注入功率 $(Z_{\\mathcal{A}}, Z_{\\mathcal{B}})$ 映射到线路潮流的区域 PTDF。\n3. 对于下方的每个测试用例，计算：\n   - 使用节点 PTDF 和指定的节点 $\\{2,3,4\\}$ 的节点级注入功率，计算实际线路潮流 (MW)，其中平衡节点注入功率 $P_1$ 的选择应确保 $\\sum_{i=1}^4 P_i = 0$。\n   - 使用区域 PTDF 和相应的区域净注入功率 $Z_{\\mathcal{A}} = P_2 + P_3$ 和 $Z_{\\mathcal{B}} = P_4$，计算聚合（近似）线路潮流 (MW)。\n   - $5$ 条线路上的最大绝对聚合误差，定义为 $\\max_{\\ell \\in \\{\\ell_1,\\dots,\\ell_5\\}} \\left| f_{\\ell}^{\\text{zonal}} - f_{\\ell}^{\\text{actual}} \\right|$，以 MW 表示。\n\n测试套件（节点 $\\{2,3,4\\}$ 的节点级注入功率，单位为 MW；所有相角单位为弧度）：\n- 用例 $1$：$(P_2, P_3, P_4) = (30, 30, -60)$。\n- 用例 $2$：$(P_2, P_3, P_4) = (60, 0, -60)$。\n- 用例 $3$：$(P_2, P_3, P_4) = (0, 0, 0)$。\n- 用例 $4$：$(P_2, P_3, P_4) = (100, -80, -20)$。\n\n您的程序必须：\n- 根据描述从第一性原理实现所需的计算。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，单位为 MW，每个测试用例对应一个浮点数，并按上述顺序排列。例如，输出格式必须与 $[r_1,r_2,r_3,r_4]$ 完全一样，其中每个 $r_k$ 是用例 $k$ 的最大绝对聚合误差 (MW)。",
            "solution": "该问题经评估是有效的，因为它的科学基础是直流潮流分析的原理，这是电力系统工程中的一种标准方法。该问题是适定的，具有足够的信息和明确的目标，可以导出一个唯一的、有意义的解。语言客观，数据内部一致。\n\n解题过程如问题中所述，分为三个主要步骤：\n1.  构建系统矩阵并计算节点功率转移分布因子 (PTDF)。\n2.  基于指定的聚合方案计算区域 PTDF。\n3.  计算每个测试用例的实际线路潮流和聚合线路潮流，以确定最大聚合误差。\n\n### 步骤 1：系统矩阵和节点 PTDF 计算\n直流潮流模型通过节点电纳矩阵 $B$ 将净节点注入功率 $P$ 与节点电压相角 $\\theta$ 关联起来：\n$$B \\theta = P$$\n\n首先，我们为该网络构建 $4 \\times 4$ 的节点电纳矩阵 $B$。对角元素 $B_{ii}$ 是连接到节点 $i$ 的所有线路的电纳之和，非对角元素 $B_{ij}$ ($i \\neq j$) 是节点 $i$ 和节点 $j$ 之间线路电纳的负值。\n给定的电纳为 $b_{12}=10$、$b_{23}=5$、$b_{34}=8$、$b_{14}=7$ 和 $b_{24}=6$。\n- $B_{11} = b_{12} + b_{14} = 10 + 7 = 17$\n- $B_{22} = b_{12} + b_{23} + b_{24} = 10 + 5 + 6 = 21$\n- $B_{33} = b_{23} + b_{34} = 5 + 8 = 13$\n- $B_{44} = b_{14} + b_{24} + b_{34} = 7 + 6 + 8 = 21$\n- $B_{12} = B_{21} = -b_{12} = -10$\n- $B_{23} = B_{32} = -b_{23} = -5$\n- $B_{34} = B_{43} = -b_{34} = -8$\n- $B_{14} = B_{41} = -b_{14} = -7$\n- $B_{24} = B_{42} = -b_{24} = -6$\n- $B_{13} = B_{31} = 0$\n\n完整的节点电纳矩阵为：\n$$B = \\begin{pmatrix} 17  -10  0  -7 \\\\ -10  21  -5  -6 \\\\ 0  -5  13  -8 \\\\ -7  -6  -8  21 \\end{pmatrix}$$\n\n节点 $1$ 是平衡节点，因此其相角固定为 $\\theta_1=0$。我们可以为非平衡节点 $\\{2, 3, 4\\}$ 构建一个降阶系统。这需要移除 $B$ 的第一行和第一列，得到降阶矩阵 $B_{\\text{red}}$。未知相角 $\\theta_{\\text{red}} = [\\theta_2, \\theta_3, \\theta_4]^T$ 的方程组为 $B_{\\text{red}} \\theta_{\\text{red}} = P_{\\text{red}}$，其中 $P_{\\text{red}} = [P_2, P_3, P_4]^T$。\n$$B_{\\text{red}} = \\begin{pmatrix} 21  -5  -6 \\\\ -5  13  -8 \\\\ -6  -8  21 \\end{pmatrix}$$\n相角的解为 $\\theta_{\\text{red}} = B_{\\text{red}}^{-1} P_{\\text{red}}$。令 $X = B_{\\text{red}}^{-1}$。\n\n线路 $(i,j)$ 上的有功功率潮流 $f_{ij}$ 为 $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$。我们可以将所有 $5$ 条线路潮流的向量 $f = [f_{12}, f_{23}, f_{34}, f_{14}, f_{24}]^T$ 表示为非平衡相角向量 $\\theta_{\\text{red}}$ 的线性变换：$f = M \\theta_{\\text{red}}$。\n- $f_{12} = b_{12}(\\theta_1 - \\theta_2) = 10(0 - \\theta_2) = -10\\theta_2$\n- $f_{23} = b_{23}(\\theta_2 - \\theta_3) = 5\\theta_2 - 5\\theta_3$\n- $f_{34} = b_{34}(\\theta_3 - \\theta_4) = 8\\theta_3 - 8\\theta_4$\n- $f_{14} = b_{14}(\\theta_1 - \\theta_4) = 7(0 - \\theta_4) = -7\\theta_4$\n- $f_{24} = b_{24}(\\theta_2 - \\theta_4) = 6\\theta_2 - 6\\theta_4$\n\n这定义了矩阵 $M$：\n$$M = \\begin{pmatrix} -10  0  0 \\\\ 5  -5  0 \\\\ 0  8  -8 \\\\ 0  0  -7 \\\\ 6  0  -6 \\end{pmatrix}$$\n代入 $\\theta_{\\text{red}} = X P_{\\text{red}}$，我们得到线路潮流和节点注入功率之间的关系：$f = M X P_{\\text{red}}$。节点 PTDF 矩阵就是与 $P_{\\text{red}}$ 相乘得到 $f$ 的矩阵。\n$$\\text{PTDF}_{\\text{nodal}} = M X = M B_{\\text{red}}^{-1}$$\n$\\text{PTDF}_{\\text{nodal}}$ 是一个 $5 \\times 3$ 的矩阵，其中元素 $(\\ell, n)$ 表示在非平衡节点 $n$ 注入 $1$ MW 功率（并在平衡节点相应地取出功率）时，线路 $\\ell$ 上的潮流变化。\n\n### 步骤 2：区域 PTDF 计算\n问题定义了两个区域 $\\mathcal{A}=\\{2,3\\}$ 和 $\\mathcal{B}=\\{4\\}$，其净注入功率分别为 $Z_{\\mathcal{A}}$ 和 $Z_{\\mathcal{B}}$。节点注入功率根据权重从区域注入功率中分配：对于区域 $\\mathcal{A}$，权重为 $w_2 = 0.5, w_3 = 0.5$；对于区域 $\\mathcal{B}$，权重为 $w_4=1.0$。\n这定义了一个从区域注入功率 $Z = [Z_{\\mathcal{A}}, Z_{\\mathcal{B}}]^T$ 到节点注入功率 $P_{\\text{red}}$ 的线性映射：\n$$P_{\\text{red}} = W Z \\quad \\text{其中} \\quad W = \\begin{pmatrix} 0.5  0 \\\\ 0.5  0 \\\\ 0  1.0 \\end{pmatrix}$$\n使用区域模型计算的线路潮流 $f^{\\text{zonal}}$ 由下式给出：\n$$f^{\\text{zonal}} = \\text{PTDF}_{\\text{nodal}} (W Z)$$\n这可以重写为 $f^{\\text{zonal}} = (\\text{PTDF}_{\\text{nodal}} W) Z$。括号中的项即为区域 PTDF 矩阵：\n$$\\text{PTDF}_{\\text{zonal}} = \\text{PTDF}_{\\text{nodal}} W$$\n$\\text{PTDF}_{\\text{zonal}}$ 是一个 $5 \\times 2$ 的矩阵，将区域注入功率映射到线路潮流。\n\n### 步骤 3：聚合误差计算\n对于每个测试用例，我们都给定了一组节点注入功率 $(P_2, P_3, P_4)$。\n实际线路潮流 $f^{\\text{actual}}$ 使用完整节点模型计算：\n$$f^{\\text{actual}} = \\text{PTDF}_{\\text{nodal}} \\begin{pmatrix} P_2 \\\\ P_3 \\\\ P_4 \\end{pmatrix}$$\n聚合（近似）线路潮流 $f^{\\text{zonal}}$ 使用区域模型计算。首先，我们求出区域净注入功率：$Z_{\\mathcal{A}} = P_2 + P_3$ 和 $Z_{\\mathcal{B}} = P_4$。\n$$f^{\\text{zonal}} = \\text{PTDF}_{\\text{zonal}} \\begin{pmatrix} Z_{\\mathcal{A}} \\\\ Z_{\\mathcal{B}} \\end{pmatrix} = \\text{PTDF}_{\\text{zonal}} \\begin{pmatrix} P_2+P_3 \\\\ P_4 \\end{pmatrix}$$\n最后，每条线路的聚合误差是差值 $f_{\\ell}^{\\text{zonal}} - f_{\\ell}^{\\text{actual}}$。问题要求计算每个测试用例中所有 $5$ 条线路的最大绝对聚合误差：\n$$\\text{Error} = \\max_{\\ell \\in \\{1,\\dots,5\\}} \\left| f_{\\ell}^{\\text{zonal}} - f_{\\ell}^{\\text{actual}} \\right|$$\n对所有四个测试用例重复此过程。误差源于区域 $\\mathcal{A}$ 内的实际节点注入模式 $[P_2, P_3]^T$ 与聚合权重所假设的模式 $[0.5(P_2+P_3), 0.5(P_2+P_3)]^T$ 之间的差异。如果实际注入功率 $P_2, P_3$ 相等，则误差为零，因为它们与 50%-50% 的分配完全匹配。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the power system aggregation error problem.\n\n    The solution follows these steps:\n    1. Define the network parameters (susceptances).\n    2. Construct the reduced bus susceptance matrix (B_red) for non-slack buses.\n    3. Compute its inverse (X), which relates nodal injections to bus angles.\n    4. Construct the matrix M, which maps non-slack bus angles to line flows.\n    5. Compute the nodal PTDF matrix: PTDF_nodal = M @ X.\n    6. Define the zonal aggregation weight matrix W.\n    7. Compute the zonal PTDF matrix: PTDF_zonal = PTDF_nodal @ W.\n    8. For each test case:\n        a. Calculate actual line flows using nodal PTDFs and nodal injections.\n        b. Calculate aggregated line flows using zonal PTDFs and zonal injections.\n        c. Compute the maximum absolute difference between the two flow vectors.\n    9. Format and print the results.\n    \"\"\"\n\n    # --- Step 1  2: Construct system matrices ---\n    # Reduced bus susceptance matrix B_red for buses {2, 3, 4}\n    # B_22 = 10 + 5 + 6 = 21\n    # B_33 = 5 + 8 = 13\n    # B_44 = 7 + 8 + 6 = 21\n    # B_23 = -5, B_24 = -6, B_34 = -8\n    B_red = np.array([\n        [21., -5., -6.],\n        [-5., 13., -8.],\n        [-6., -8., 21.]\n    ])\n\n    # --- Step 3: Compute inverse of B_red ---\n    # X = B_red^{-1}\n    X = np.linalg.inv(B_red)\n\n    # --- Step 4: Construct line flow mapping matrix M ---\n    # f = M * [theta_2, theta_3, theta_4]^T\n    # Lines are l1:(1-2), l2:(2-3), l3:(3-4), l4:(1-4), l5:(2-4)\n    # Susceptances b12=10, b23=5, b34=8, b14=7, b24=6\n    # f12 = 10(t1-t2) = -10*t2 since t1=0\n    # f23 = 5(t2-t3)\n    # f34 = 8(t3-t4)\n    # f14 = 7(t1-t4) = -7*t4\n    # f24 = 6(t2-t4)\n    M = np.array([\n        [-10.,  0.,  0.],\n        [  5., -5.,  0.],\n        [  0.,  8., -8.],\n        [  0.,  0., -7.],\n        [  6.,  0., -6.]\n    ])\n\n    # --- Step 5: Compute nodal PTDF matrix ---\n    PTDF_nodal = M @ X\n\n    # --- Step 6: Define zonal aggregation matrix W ---\n    # P_red = W * Z\n    # P2 = 0.5*ZA, P3 = 0.5*ZA, P4 = 1.0*ZB\n    W = np.array([\n        [0.5, 0.0],\n        [0.5, 0.0],\n        [0.0, 1.0]\n    ])\n\n    # --- Step 7: Compute zonal PTDF matrix ---\n    PTDF_zonal = PTDF_nodal @ W\n\n    # --- Step 8: Process test cases ---\n    test_cases = [\n        (30., 30., -60.),\n        (60., 0., -60.),\n        (0., 0., 0.),\n        (100., -80., -20.),\n    ]\n\n    results = []\n    for case in test_cases:\n        P2, P3, P4 = case\n        \n        # Nodal (actual) model\n        P_red = np.array([P2, P3, P4])\n        f_actual = PTDF_nodal @ P_red\n\n        # Zonal (aggregated) model\n        Z_A = P2 + P3\n        Z_B = P4\n        Z = np.array([Z_A, Z_B])\n        f_zonal = PTDF_zonal @ Z\n        \n        # Calculate maximum absolute aggregation error\n        max_error = np.max(np.abs(f_zonal - f_actual))\n        results.append(max_error)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理解了聚合会引入误差后，一个自然而然的问题是：我们应该如何选择合适的空间分辨率？本练习 () 探讨了如何为连续空间场（例如太阳辐照度）的监测确定最优的传感器布局密度。通过应用高斯过程（Gaussian Process）这一强大的统计工具，您将学习如何量化空间相关性，并推导出在满足特定插值精度要求下，所需的最大传感器间距和最小传感器数量。",
            "id": "4124062",
            "problem": "考虑一条长度为 $D = 40\\,\\mathrm{km}$ 的直线型沿海配电馈线，其上承载了分布式光伏逆变器。为了支持空间精细化的能源系统建模，运营商希望为该馈线配备一组均匀分布的固定传感器，用于测量地面太阳辐照度与其日均剖面沿一维坐标 $x \\in [0, D]$ 的偏差 $X(x)$。假设 $X(x)$ 是一个零均值、宽义平稳高斯过程（GP），其各向同性协方差函数为\n$$\nC(h) = \\sigma^{2} \\exp\\!\\left(-\\frac{h^{2}}{2 L^{2}}\\right),\n$$\n其中 $h$ 是分离距离，$\\sigma = 0.20\\,\\mathrm{kW\\,m^{-2}}$ 是辐照度偏差的标准差，$L = 3.0\\,\\mathrm{km}$ 是相关长度。运营商使用最优线性最小均方估计（Linear Minimum Mean Square Error (LMMSE)）对传感器之间的 $X(x)$ 进行插值。\n\n假设 $N$ 个传感器均匀放置在 $[0,D]$ 上，相对于 $L$ 而言，边界效应可以忽略不计，且插值误差在相邻传感器的中点处达到最大。从零均值平稳高斯过程的性质和有限多个点传感器的 LMMSE 插值定义出发，推导两个相邻传感器中点处的插值均方误差表达式，该表达式是均匀间距 $s$ 的函数。利用该表达式，评估空间采样密度（即最大间距 $s_{\\max}$），以确保中点插值的均方根误差不超过目标界限 $\\varepsilon = 0.050\\,\\mathrm{kW\\,m^{-2}}$。最后，计算在 $[0, D]$ 上为确保整个区间内的间距 $s \\leq s_{\\max}$ 所需的最小整数传感器数量 $N$。\n\n只报告最小整数 $N$ 作为最终答案。如果进行任何中间数值计算（例如 $s_{\\max}$），请以 $\\mathrm{km}$ 为单位表示。",
            "solution": "问题是确定在空间域 $[0, D]$ 上监测物理过程 $X(x)$ 所需的最小传感器数量 $N$，以使插值误差保持在指定的阈值以下。该问题具有科学依据，提法明确，并包含得出唯一解所需的所有信息。\n\n过程 $X(x)$ 是一个零均值、宽义平稳高斯过程，其各向同性协方差函数为：\n$$\nC(h) = \\mathbb{E}[X(x)X(x+h)] = \\sigma^{2} \\exp\\left(-\\frac{h^{2}}{2 L^{2}}\\right)\n$$\n其中 $h$ 是分离距离，$\\sigma = 0.20\\,\\mathrm{kW\\,m^{-2}}$ 是标准差，$L = 3.0\\,\\mathrm{km}$ 是相关长度。馈线总长度为 $D = 40\\,\\mathrm{km}$。\n\n估计方法是最优线性最小均方估计 (LMMSE)。对于零均值高斯过程，给定一组测量值 $\\mathbf{X}_s = [X(x_1), \\dots, X(x_k)]^T$ 时，$X(x_0)$ 的 LMMSE 估计是条件均值 $\\hat{X}(x_0) = \\mathbb{E}[X(x_0) | \\mathbf{X}_s]$。相应的均方误差 (MSE) 是条件方差 $\\text{MSE} = \\text{Var}(X(x_0) | \\mathbf{X}_s)$。\n\n问题指定了均匀的传感器间距 $s$，并假设边界效应可以忽略不计，且最大插值误差出现在相邻传感器的中点处。这使我们能够通过只考虑中点两侧的两个传感器来分析误差。设中点位于坐标 $0$ 处，两个相邻的传感器位于坐标 $-\\frac{s}{2}$ 和 $+\\frac{s}{2}$ 处。\n\n令待估计的随机变量为 $X_0 = X(0)$。令测量值来自两个传感器，即 $\\mathbf{X}_s = [X(-s/2), X(s/2)]^T$。LMMSE 估计的均方误差 (MSE) 由多元高斯分布的条件方差标准公式给出：\n$$\n\\text{MSE}(s) = \\text{Var}(X_0) - \\mathbf{c}_s^T \\mathbf{C}_{ss}^{-1} \\mathbf{c}_s\n$$\n其中：\n- $\\text{Var}(X_0) = C(0) = \\sigma^2$ 是过程的先验方差。\n- $\\mathbf{C}_{ss}$ 是测量值的协方差矩阵：\n$$\n\\mathbf{C}_{ss} = \\begin{pmatrix} \\text{Cov}(X(-\\frac{s}{2}), X(-\\frac{s}{2}))  \\text{Cov}(X(-\\frac{s}{2}), X(+\\frac{s}{2})) \\\\ \\text{Cov}(X(+\\frac{s}{2}), X(-\\frac{s}{2}))  \\text{Cov}(X(+\\frac{s}{2}), X(+\\frac{s}{2})) \\end{pmatrix} = \\begin{pmatrix} C(0)  C(s) \\\\ C(s)  C(0) \\end{pmatrix}\n$$\n- $\\mathbf{c}_s$ 是估计点和测量点之间的协方差向量：\n$$\n\\mathbf{c}_s = \\begin{pmatrix} \\text{Cov}(X(0), X(-\\frac{s}{2})) \\\\ \\text{Cov}(X(0), X(+\\frac{s}{2})) \\end{pmatrix} = \\begin{pmatrix} C(\\frac{s}{2}) \\\\ C(\\frac{s}{2}) \\end{pmatrix}\n$$\n代入协方差函数，我们得到：\n$C(0) = \\sigma^2$\n$C(s) = \\sigma^2 \\exp\\left(-\\frac{s^2}{2L^2}\\right)$\n$C(\\frac{s}{2}) = \\sigma^2 \\exp\\left(-\\frac{(s/2)^2}{2L^2}\\right) = \\sigma^2 \\exp\\left(-\\frac{s^2}{8L^2}\\right)$\n\n协方差矩阵 $\\mathbf{C}_{ss}$ 是：\n$$\n\\mathbf{C}_{ss} = \\sigma^2 \\begin{pmatrix} 1  \\exp\\left(-\\frac{s^2}{2L^2}\\right) \\\\ \\exp\\left(-\\frac{s^2}{2L^2}\\right)  1 \\end{pmatrix}\n$$\n其逆矩阵为：\n$$\n\\mathbf{C}_{ss}^{-1} = \\frac{1}{\\sigma^2 \\left(1 - \\exp\\left(-\\frac{s^2}{L^2}\\right)\\right)} \\begin{pmatrix} 1  -\\exp\\left(-\\frac{s^2}{2L^2}\\right) \\\\ -\\exp\\left(-\\frac{s^2}{2L^2}\\right)  1 \\end{pmatrix}\n$$\n现在，我们计算项 $\\mathbf{c}_s^T \\mathbf{C}_{ss}^{-1} \\mathbf{c}_s$：\n$$\n\\mathbf{c}_s^T \\mathbf{C}_{ss}^{-1} \\mathbf{c}_s = \\left(\\sigma^2 \\exp\\left(-\\frac{s^2}{8L^2}\\right) \\begin{pmatrix} 1  1 \\end{pmatrix}\\right) \\mathbf{C}_{ss}^{-1} \\left(\\sigma^2 \\exp\\left(-\\frac{s^2}{8L^2}\\right) \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\\right)\n$$\n$$\n= \\frac{\\sigma^2 \\exp\\left(-\\frac{s^2}{4L^2}\\right)}{1 - \\exp\\left(-\\frac{s^2}{L^2}\\right)} \\begin{pmatrix} 1  1 \\end{pmatrix} \\begin{pmatrix} 1  -\\exp\\left(-\\frac{s^2}{2L^2}\\right) \\\\ -\\exp\\left(-\\frac{s^2}{2L^2}\\right)  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\n$$\n$$\n= \\frac{\\sigma^2 \\exp\\left(-\\frac{s^2}{4L^2}\\right)}{1 - \\exp\\left(-\\frac{s^2}{L^2}\\right)} \\begin{pmatrix} 1-\\exp\\left(-\\frac{s^2}{2L^2}\\right)  1-\\exp\\left(-\\frac{s^2}{2L^2}\\right) \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\n$$\n$$\n= \\frac{\\sigma^2 \\exp\\left(-\\frac{s^2}{4L^2}\\right) \\left[2\\left(1-\\exp\\left(-\\frac{s^2}{2L^2}\\right)\\right)\\right]}{\\left(1-\\exp\\left(-\\frac{s^2}{2L^2}\\right)\\right)\\left(1+\\exp\\left(-\\frac{s^2}{2L^2}\\right)\\right)} = \\frac{2\\sigma^2 \\exp\\left(-\\frac{s^2}{4L^2}\\right)}{1+\\exp\\left(-\\frac{s^2}{2L^2}\\right)}\n$$\n因此，中点处的均方误差 (MSE) 为：\n$$\n\\text{MSE}(s) = \\sigma^2 - \\frac{2\\sigma^2 \\exp\\left(-\\frac{s^2}{4L^2}\\right)}{1+\\exp\\left(-\\frac{s^2}{2L^2}\\right)} = \\sigma^2 \\left(1 - \\frac{2 \\exp\\left(-\\frac{s^2}{4L^2}\\right)}{1+\\exp\\left(-\\frac{s^2}{2L^2}\\right)}\\right)\n$$\n该表达式给出了中点插值均方误差 (MSE) 作为传感器间距 $s$ 的函数。\n\n接下来，我们必须找到最大间距 $s_{\\max}$，以确保均方根误差 (RMSE) 不超过 $\\varepsilon = 0.050\\,\\mathrm{kW\\,m^{-2}}$。条件是 $\\text{RMSE}(s) \\le \\varepsilon$，即 $\\text{MSE}(s) \\le \\varepsilon^2$。\n$$\n\\sigma^2 \\left(1 - \\frac{2 \\exp\\left(-\\frac{s^2}{4L^2}\\right)}{1+\\exp\\left(-\\frac{s^2}{2L^2}\\right)}\\right) \\le \\varepsilon^2\n$$\n$$\n1 - \\frac{\\varepsilon^2}{\\sigma^2} \\le \\frac{2 \\exp\\left(-\\frac{s^2}{4L^2}\\right)}{1+\\exp\\left(-\\frac{s^2}{2L^2}\\right)}\n$$\n令 $y = \\exp\\left(-\\frac{s^2}{4L^2}\\right)$。则 $\\exp\\left(-\\frac{s^2}{2L^2}\\right) = y^2$。不等式变为：\n$$\n1 - \\frac{\\varepsilon^2}{\\sigma^2} \\le \\frac{2y}{1+y^2}\n$$\n给定 $\\sigma = 0.20$ 和 $\\varepsilon = 0.050$，我们有 $\\frac{\\varepsilon^2}{\\sigma^2} = (\\frac{0.050}{0.20})^2 = (\\frac{1}{4})^2 = \\frac{1}{16}$。\n$$\n1 - \\frac{1}{16} \\le \\frac{2y}{1+y^2} \\implies \\frac{15}{16} \\le \\frac{2y}{1+y^2}\n$$\n$$\n15(1+y^2) \\le 32y \\implies 15y^2 - 32y + 15 \\le 0\n$$\n为了找到该二次式为非正的区域，我们求其根：\n$$\ny = \\frac{32 \\pm \\sqrt{32^2 - 4(15)(15)}}{2(15)} = \\frac{32 \\pm \\sqrt{1024 - 900}}{30} = \\frac{32 \\pm \\sqrt{124}}{30} = \\frac{16 \\pm \\sqrt{31}}{15}\n$$\n该二次式在其两根之间为非正。由于 $y = \\exp(-s^2/(4L^2))$，我们知道 $0  y \\le 1$。较大的根 $\\frac{16+\\sqrt{31}}{15} > 1$，因此解的唯一相关部分是：\n$$\n\\frac{16 - \\sqrt{31}}{15} \\le y \\le 1\n$$\n对 $s$ 的约束来自于 $y$ 的下界：\n$$\n\\exp\\left(-\\frac{s^2}{4L^2}\\right) \\ge \\frac{16 - \\sqrt{31}}{15}\n$$\n对两边取自然对数（并反转不等号，因为 $\\ln$ 是一个增函数，而 exp 的参数是负的）：\n$$\n-\\frac{s^2}{4L^2} \\ge \\ln\\left(\\frac{16 - \\sqrt{31}}{15}\\right) \\implies s^2 \\le -4L^2 \\ln\\left(\\frac{16 - \\sqrt{31}}{15}\\right)\n$$\n$$\ns^2 \\le 4L^2 \\ln\\left(\\left(\\frac{16 - \\sqrt{31}}{15}\\right)^{-1}\\right) = 4L^2 \\ln\\left(\\frac{15}{16 - \\sqrt{31}}\\right)\n$$\n因此，允许的最大间距 $s_{\\max}$ 是：\n$$\ns_{\\max} = 2L \\sqrt{\\ln\\left(\\frac{15}{16 - \\sqrt{31}}\\right)}\n$$\n代入 $L = 3.0\\,\\mathrm{km}$：\n$$\ns_{\\max} = 2(3.0) \\sqrt{\\ln\\left(\\frac{15}{16 - \\sqrt{31}}\\right)} \\approx 6 \\sqrt{\\ln\\left(\\frac{15}{16 - 5.56776}\\right)} \\approx 6 \\sqrt{\\ln(1.43783)} \\approx 6 \\sqrt{0.36316} \\approx 3.6158\\,\\mathrm{km}\n$$\n最后，我们计算最小传感器数量 $N$。将 $N$ 个传感器均匀放置在距离 $D$ 上，包括端点 $x=0$ 和 $x=D$ 处的传感器，共有 $N-1$ 个区间。间距为 $s = \\frac{D}{N-1}$。为满足误差规范，我们必须有 $s \\le s_{\\max}$。\n$$\n\\frac{D}{N-1} \\le s_{\\max} \\implies N-1 \\ge \\frac{D}{s_{\\max}} \\implies N \\ge \\frac{D}{s_{\\max}} + 1\n$$\n使用数值 $D = 40\\,\\mathrm{km}$ 和 $s_{\\max} \\approx 3.6158\\,\\mathrm{km}$：\n$$\nN \\ge \\frac{40}{3.6158} + 1 \\approx 11.0626 + 1 = 12.0626\n$$\n由于 $N$ 必须是整数，所需的最小传感器数量是大于或等于 $12.0626$ 的最小整数，即 $13$。",
            "answer": "$$\n\\boxed{13}\n$$"
        },
        {
            "introduction": "空间聚合的挑战不仅限于物理精度的损失，更会影响到高层次的规划和决策。本练习 () 旨在揭示“可变单元问题”（Modifiable Areal Unit Problem, MAUP）的深刻影响，即分析结果会随着空间单元的划分方式而改变。通过一个合成的能源系统案例，您将看到两种同样合理的区域划分方案如何导致关于输电扩容的决策建议完全相反，从而深刻体会到空间表征选择对模型结论的决定性作用。",
            "id": "4124078",
            "problem": "考虑一个由四个节点和单个区间输电接口组成的合成能源系统。每个节点 $i \\in \\{1,2,3,4\\}$ 都有固定的需求 $D_i$（单位：兆瓦，MW），一台最大容量为 $\\overline{G}_i$（单位：MW）的发电机，以及恒定的边际成本 $c_i$（单位：美元/兆瓦时，$\\text{\\$/MWh}$）。该系统在最低成本调度和一个评估是否建议加强区间接口的输电规划规则下运行。系统必须满足电量平衡，即总发电量等于总需求。\n\n基本依据如下：\n- 电量平衡：$$\\sum_{i=1}^{4} g_i = \\sum_{i=1}^{4} D_i,$$ 其中 $g_i$ 是节点 $i$ 的调度发电量（单位：MW）。\n- 运行可行性：$$0 \\le g_i \\le \\overline{G}_i \\quad \\text{for all } i.$$\n- 成本最小化：最低成本调度在满足上述约束的条件下，最小化 $$\\sum_{i=1}^{4} c_i g_i$$，并为计算无约束最低成本调度，假设区间输电容量不构成约束。\n\n定义两种分区方案，将四个节点各自分成两个区域，从而产生不同的区间接口：\n- 分区方案 $\\mathcal{Z}_A$：西区 $W_A = \\{1,2\\}$ 和东区 $E_A = \\{3,4\\}$。\n- 分区方案 $\\mathcal{Z}_B$：西区 $W_B = \\{1,3\\}$ 和东区 $E_B = \\{2,4\\}$。\n\n区间接口的容量为 $K$（单位：MW）。在给定的分区方案 $\\mathcal{Z}$ 下，令 $G_Z$ 表示西区的总发电量，$D_Z$ 表示西区的总需求。在无约束最低成本调度下，所需的区间传输量 $T_{\\mathcal{Z}}$（单位：MW）为：\n$$T_{\\mathcal{Z}} = \\left|D_Z - G_Z\\right|.$$\n该量代表西区的绝对净输入（如果 $G_Z > D_Z$，则等效于绝对净输出），并且由于恰好有两个区域，它等于跨区间接口相应输入/输出的量值。\n\n规划规则：在分区方案 $\\mathcal{Z}$ 下，如果无约束最低成本所需区间传输量 $T_{\\mathcal{Z}}$ 严格超过现有容量 $K$，即 $$T_{\\mathcal{Z}} > K$$，则建议进行输电加强。\n\n可变分区单元问题 (MAUP) 不稳定性度量：对于一对分区方案 $(\\mathcal{Z}_A,\\mathcal{Z}_B)$ 和给定的容量 $K$，定义每种方案下的二元决策为\n$$d_{\\mathcal{Z}} = \\begin{cases}\n1  \\text{if } T_{\\mathcal{Z}} > K,\\\\\n0  \\text{if } T_{\\mathcal{Z}} \\le K.\n\\end{cases}$$\n定义 MAUP 引致的决策不稳定性指标\n$$I = |d_{\\mathcal{Z}_A} - d_{\\mathcal{Z}_B}|,$$\n以及归一化传输差异（一个无量纲的小数）\n$$R = \\frac{\\left|T_{\\mathcal{Z}_A} - T_{\\mathcal{Z}_B}\\right|}{K},$$\n其中要求 $K > 0$。如果两种分区方案对是否需要加强得出相反的结论，则数量 $I$ 为 $1$，否则为 $0$；$R$ 捕捉了所需区间传输量的相对大小差异（按容量归一化），并且必须表示为小数，而不是百分比。\n\n合成系统数据：\n- 需求：$D_1 = 10$ MW, $D_2 = 10$ MW, $D_3 = 30$ MW, $D_4 = 30$ MW。\n- 发电机最大容量：$\\overline{G}_1 = 60$ MW, $\\overline{G}_2 = 20$ MW, $\\overline{G}_3 = 40$ MW, $\\overline{G}_4 = 40$ MW。\n- 边际成本：$c_1 = 20 \\, \\text{\\$/MWh}$, $c_2 = 30 \\, \\text{\\$/MWh}$, $c_3 = 100 \\, \\text{\\$/MWh}$, $c_4 = 120 \\, \\text{\\$/MWh}$。\n\n您必须计算满足电量平衡和容量约束的无约束最低成本调度 $g_i$，然后计算 $T_{\\mathcal{Z}_A}$ 和 $T_{\\mathcal{Z}_B}$，最后为每个测试用例计算 $I$ 和 $R$。\n\n测试套件：\n- 案例 1：$K = 50$ MW（一个旨在得出相反结论的案例）。\n- 案例 2：$K = 60$ MW（一个边界案例，其中一种方案下所需传输量等于容量）。\n- 案例 3：$K = 10$ MW（一个两种方案都建议加强的案例）。\n- 案例 4：$K = 80$ MW（一个两种方案都不建议加强的案例）。\n\n物理单位：所有功率量（$D_i$、$g_i$、$\\overline{G}_i$、$T_{\\mathcal{Z}}$、$K$）必须以兆瓦（MW）为单位进行处理和计算。所有成本均以美元/兆瓦时（$\\text{\\$/MWh}$）为单位。不使用角度。归一化传输差异 $R$ 必须表示为不带百分号的小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是一个双元素列表 $[I,R]$。例如，输出格式必须为：\n$$\\left[ [I_1,R_1],[I_2,R_2],[I_3,R_3],[I_4,R_4] \\right]$$\n其中符号由数值替换。",
            "solution": "问题陈述经评估被确定为 **有效**。它在科学上基于能源系统经济学（最低成本调度）的原理，问题设定良好，具有唯一且可推导的解，并且陈述客观，提供了所有必要的数据。该问题是在输电规划背景下对可变分区单元问题（MAUP）的形式化探索。\n\n解决方案主要分三步进行：\n1.  确定无约束最低成本调度。\n2.  计算每种分区方案所需的区间传输量。\n3.  评估每个测试用例的不稳定性度量。\n\n### 步骤 1：无约束最低成本调度\n\n目标是在满足电量平衡和发电机容量约束的条件下，最小化总发电成本 $\\sum_{i=1}^{4} c_i g_i$。这是通过按边际成本 ($c_i$) 从低到高的顺序调度发电机（一种称为经济顺序调度的原则）来实现的，直到满足总需求为止。\n\n系统参数如下：\n- 需求：$D_1 = 10$ MW, $D_2 = 10$ MW, $D_3 = 30$ MW, $D_4 = 30$ MW。\n- 发电机容量：$\\overline{G}_1 = 60$ MW, $\\overline{G}_2 = 20$ MW, $\\overline{G}_3 = 40$ MW, $\\overline{G}_4 = 40$ MW。\n- 边际成本：$c_1 = 20 \\, \\text{\\$/MWh}$, $c_2 = 30 \\, \\text{\\$/MWh}$, $c_3 = 100 \\, \\text{\\$/MWh}$, $c_4 = 120 \\, \\text{\\$/MWh}$。\n\n首先，我们计算系统总需求：\n$$D_{\\text{total}} = \\sum_{i=1}^{4} D_i = 10 + 10 + 30 + 30 = 80 \\text{ MW}$$\n\n总可用发电容量为 $\\sum \\overline{G}_i = 60+20+40+40 = 160$ MW，超过了总需求，确保存在可行解。\n\n发电机的经济顺序（从最便宜到最贵）是：\n1.  发电机 1 ($c_1 = 20 \\, \\text{\\$/MWh}$)\n2.  发电机 2 ($c_2 = 30 \\, \\text{\\$/MWh}$)\n3.  发电机 3 ($c_3 = 100 \\, \\text{\\$/MWh}$)\n4.  发电机 4 ($c_4 = 120 \\, \\text{\\$/MWh}$)\n\n我们按顺序调度发电机以满足 80 MW 的需求：\n- 调度发电机 1：其容量为 $\\overline{G}_1 = 60$ MW。我们全额调度它。\n  - $g_1 = 60$ MW。\n  - 剩余需求：$80 - 60 = 20$ MW。\n- 调度发电机 2：其容量为 $\\overline{G}_2 = 20$ MW。我们使用其全部容量来满足剩余需求。\n  - $g_2 = 20$ MW。\n  - 剩余需求：$20 - 20 = 0$ MW。\n- 总需求现已满足。不需要发电机 3 和 4。\n  - $g_3 = 0$ MW。\n  - $g_4 = 0$ MW。\n\n无约束最低成本调度向量为 $g = (g_1, g_2, g_3, g_4) = (60, 20, 0, 0)$ MW。\n\n### 步骤 2：计算区间传输量\n\n使用步骤 1 的调度结果，我们计算每种分区方案所需的区间传输量 $T_{\\mathcal{Z}} = |D_Z - G_Z|$，其中 $Z$ 代表各自的西区。\n\n**分区方案 $\\mathcal{Z}_A$**：\n- 西区 $W_A = \\{1,2\\}$，东区 $E_A = \\{3,4\\}$。\n- 西区需求：$D_{W_A} = D_1 + D_2 = 10 + 10 = 20$ MW。\n- 西区发电量：$G_{W_A} = g_1 + g_2 = 60 + 20 = 80$ MW。\n- 所需传输量：$T_{\\mathcal{Z}_A} = |D_{W_A} - G_{W_A}| = |20 - 80| = 60$ MW。\n\n**分区方案 $\\mathcal{Z}_B$**：\n- 西区 $W_B = \\{1,3\\}$，东区 $E_B = \\{2,4\\}$。\n- 西区需求：$D_{W_B} = D_1 + D_3 = 10 + 30 = 40$ MW。\n- 西区发电量：$G_{W_B} = g_1 + g_3 = 60 + 0 = 60$ MW。\n- 所需传输量：$T_{\\mathcal{Z}_B} = |D_{W_B} - G_{W_B}| = |40 - 60| = 20$ MW。\n\n### 步骤 3：评估测试用例\n\n我们现在为每个给定的容量 $K$ 评估不稳定性指标 $I = |d_{\\mathcal{Z}_A} - d_{\\mathcal{Z}_B}|$ 和归一化传输差异 $R = \\frac{|T_{\\mathcal{Z}_A} - T_{\\mathcal{Z}_B}|}{K}$。决策变量 $d_{\\mathcal{Z}}$ 在 $T_{\\mathcal{Z}} > K$ 时为 $1$，否则为 $0$。所有案例中传输量的绝对差异是一个常数：$|T_{\\mathcal{Z}_A} - T_{\\mathcal{Z}_B}| = |60 - 20| = 40$ MW。\n\n**案例 1: $K = 50$ MW**\n- $d_{\\mathcal{Z}_A}$: $T_{\\mathcal{Z}_A} = 60 > 50$，所以 $d_{\\mathcal{Z}_A} = 1$。\n- $d_{\\mathcal{Z}_B}$: $T_{\\mathcal{Z}_B} = 20 \\le 50$，所以 $d_{\\mathcal{Z}_B} = 0$。\n- $I_1 = |1 - 0| = 1$。\n- $R_1 = \\frac{40}{50} = 0.8$。\n- 结果：$[1, 0.8]$。\n\n**案例 2: $K = 60$ MW**\n- $d_{\\mathcal{Z}_A}$: $T_{\\mathcal{Z}_A} = 60 \\ngtr 60$（条件是严格不等式），所以 $d_{\\mathcal{Z}_A} = 0$。\n- $d_{\\mathcal{Z}_B}$: $T_{\\mathcal{Z}_B} = 20 \\le 60$，所以 $d_{\\mathcal{Z}_B} = 0$。\n- $I_2 = |0 - 0| = 0$。\n- $R_2 = \\frac{40}{60} = \\frac{2}{3} \\approx 0.666...$。\n- 结果：$[0, 0.666...]$。\n\n**案例 3: $K = 10$ MW**\n- $d_{\\mathcal{Z}_A}$: $T_{\\mathcal{Z}_A} = 60 > 10$，所以 $d_{\\mathcal{Z}_A} = 1$。\n- $d_{\\mathcal{Z}_B}$: $T_{\\mathcal{Z}_B} = 20 > 10$，所以 $d_{\\mathcal{Z}_B} = 1$。\n- $I_3 = |1 - 1| = 0$。\n- $R_3 = \\frac{40}{10} = 4.0$。\n- 结果：$[0, 4.0]$。\n\n**案例 4: $K = 80$ MW**\n- $d_{\\mathcal{Z}_A}$: $T_{\\mathcal{Z}_A} = 60 \\le 80$，所以 $d_{\\mathcal{Z}_A} = 0$。\n- $d_{\\mathcal{Z}_B}$: $T_{\\mathcal{Z}_B} = 20 \\le 80$，所以 $d_{\\mathcal{Z}_B} = 0$。\n- $I_4 = |0 - 0| = 0$。\n- $R_4 = \\frac{40}{80} = 0.5$。\n- 结果：$[0, 0.5]$。\n\n四个测试用例的最终汇总结果是 $[[1, 0.8], [0, 0.666...], [0, 4.0], [0, 0.5]]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the energy system modeling problem presented, calculating MAUP instability metrics.\n    \"\"\"\n    # Define the system data from the problem statement.\n    # Demands (MW)\n    demands = np.array([10.0, 10.0, 30.0, 30.0])\n    # Generator max capacities (MW)\n    gen_caps = np.array([60.0, 20.0, 40.0, 40.0])\n    # Marginal costs ($/MWh)\n    gen_costs = np.array([20.0, 30.0, 100.0, 120.0])\n    # Node indices\n    nodes = np.arange(len(demands))\n    \n    # Define the test cases for transmission capacity K (MW).\n    test_cases = [50.0, 60.0, 10.0, 80.0]\n\n    # Step 1: Calculate the unconstrained least-cost dispatch.\n    # This follows the principle of merit-order dispatch.\n    total_demand = np.sum(demands)\n    \n    # Combine generator properties and sort by cost in ascending order.\n    # Each element is (cost, capacity, original_index)\n    generators_sorted = sorted(zip(gen_costs, gen_caps, nodes), key=lambda x: x[0])\n    \n    # Initialize dispatched generation for each node to zero.\n    dispatched_generation = np.zeros(len(demands))\n    demand_to_meet = total_demand\n    \n    for cost, capacity, index in generators_sorted:\n        if demand_to_meet == 0:\n            break\n        # Dispatch the cheaper generator up to its capacity or until demand is met.\n        dispatch_amount = min(demand_to_meet, capacity)\n        dispatched_generation[index] = dispatch_amount\n        demand_to_meet -= dispatch_amount\n\n    # Step 2: Calculate the required interzonal transfers for each zoning scheme.\n    # Zoning scheme Z_A: West zone W_A = {1,2} (indices 0, 1)\n    D_WA = demands[0] + demands[1]\n    G_WA = dispatched_generation[0] + dispatched_generation[1]\n    T_zA = abs(D_WA - G_WA)\n\n    # Zoning scheme Z_B: West zone W_B = {1,3} (indices 0, 2)\n    D_WB = demands[0] + demands[2]\n    G_WB = dispatched_generation[0] + dispatched_generation[2]\n    T_zB = abs(D_WB - G_WB)\n\n    # Step 3: Evaluate MAUP metrics for each test case.\n    results = []\n    for k_capacity in test_cases:\n        # Determine the binary decision for each scheme. Reinforcement is\n        # recommended if the required transfer strictly exceeds capacity K.\n        d_zA = 1 if T_zA > k_capacity else 0\n        d_zB = 1 if T_zB > k_capacity else 0\n        \n        # Calculate MAUP-induced decision instability indicator I.\n        I = abs(d_zA - d_zB)\n        \n        # Calculate normalized transfer difference R.\n        # This is guaranteed to be safe as K > 0 in all test cases.\n        R = abs(T_zA - T_zB) / k_capacity\n        \n        results.append([I, R])\n\n    # Final print statement in the exact required format.\n    # The format is [[I1,R1],[I2,R2],...], created by joining string representations.\n    stringified_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(stringified_results)}]\")\n\nsolve()\n```"
        }
    ]
}