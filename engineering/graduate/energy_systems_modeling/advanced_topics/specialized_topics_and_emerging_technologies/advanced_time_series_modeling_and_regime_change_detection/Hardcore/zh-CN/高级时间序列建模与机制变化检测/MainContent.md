## 引言
在能源系统、金融市场和气候科学等众多领域，时间序列数据是理解复杂动态现象的基础。然而，这些系统的底层过程并非一成不变，常会因政策干预、技术革新或自然事件而经历突然或渐进的“机制变化”。传统的假设统计特性恒定的时间序列模型在面对这类结构性断裂时会失效，可能导致错误的预测和决策。因此，准确识别并建模这些机制变化，对于深入理解系统行为、提高预测精度和进行有效的[风险管理](@entry_id:141282)至关重要。

本文旨在系统性地介绍高级[时间序列建模](@entry_id:1133184)与机制变化检测的核心理论与实践应用。我们将填补基础理论与复杂现实之间的知识鸿沟，为读者提供一套强大的分析工具。在接下来的章节中，您将学习到：

在“原理与机制”部分，我们将深入探讨机制变化的数学定义，区分离线分割与在线检测，并详细介绍可观测的[阈值模型](@entry_id:172428)、潜在的[马尔可夫转换模型](@entry_id:146116)，以及它们在[多变量系统](@entry_id:169616)和波动率建模中的扩展。

随后，在“应用与跨学科联系”部分，我们将展示这些理论在[电力](@entry_id:264587)[负荷预测](@entry_id:1127381)、能源价格分析、可再生能源依赖性建模以及气候模型集成等真实场景中的强大应用，揭示其在不同学科间的深刻联系。

最后，“动手实践”部分将通过具体的编程练习，引导您亲手实现和分析这些高级模型，将理论知识转化为解决实际问题的能力。

## 原理与机制

本章旨在深入阐述高级[时间序列建模](@entry_id:1133184)与机制变化检测的核心原理与机制。我们将从[时间序列分析](@entry_id:178930)的基本概念出发，系统地建立描述和识别机制变化的数学框架。内容将涵盖可观测[机制模型](@entry_id:202454)、潜在[机制模型](@entry_id:202454)、[多变量系统](@entry_id:169616)中的机制变化以及波动率动态，最后讨论模型选择和数据缺失等实际应用中的关键问题。

### 时间序列分析的基础：[平稳性](@entry_id:143776)、依赖性与[线性模型](@entry_id:178302)

[时间序列分析](@entry_id:178930)的基石是**[随机过程](@entry_id:268487)**（stochastic process）的概念，即一系列按时间索引的[随机变量](@entry_id:195330)。为了对这些过程进行有意义的统计推断，我们通常需要对其统计特性施加某些结构性假设，其中最核心的是**[平稳性](@entry_id:143776)**（stationarity）。

#### 平稳性的层次

[平稳性](@entry_id:143776)描述了过程的统计特性不随时间推移而改变的性质。我们主要区分两种层次的[平稳性](@entry_id:143776)：

**[弱平稳性](@entry_id:171204)**（weak stationarity），或称协方差[平稳性](@entry_id:143776)（covariance stationarity），要求一个过程 $\{X_t\}$ 的前两个矩不随时间变化。具体而言，须满足以下三个条件：
1.  **均值恒定**: 对所有时间点 $t$，均值 $E[X_t] = \mu$ 为一个常数。
2.  **二阶矩有限**: 对所有时间点 $t$，二阶矩 $E[X_t^2] \lt \infty$，这保证了方差和协方差的存在。
3.  **[自协方差函数](@entry_id:262114)仅依赖于时间差**: 对所有时间点 $t$ 和任意时间差 $h$，[自协方差](@entry_id:270483) $\operatorname{Cov}(X_t, X_{t+h}) = \gamma(h)$ 仅是滞后阶数 $h$ 的函数，而与具体时间 $t$ 无关。

这意味着过程的方差 $\operatorname{Var}(X_t) = \gamma(0)$ 也是一个常数。[弱平稳性](@entry_id:171204)是大多数经典时间序列模型（如[ARMA模型](@entry_id:139294)）的基础。

**[严平稳性](@entry_id:260987)**（strict stationarity）是一个更强的条件。它要求过程的整个联合概率分布在时间平移下保持不变。也就是说，对于任意整数 $k \geq 1$，任意一组时间索引 $t_1, \dots, t_k$ 和任意时间平移量 $s$，随机向量 $(X_{t_1}, \dots, X_{t_k})$ 的[联合分布](@entry_id:263960)与 $(X_{t_1+s}, \dots, X_{t_k+s})$ 的[联合分布](@entry_id:263960)完全相同。

如果一个严[平稳过程](@entry_id:196130)存在有限的二阶矩，那么它必然是弱平稳的。反之则不一定成立。一个重要的特例是**高斯过程**（Gaussian process）：由于其任何[有限维分布](@entry_id:197042)都是[多元正态分布](@entry_id:175229)，而正态分布完全由其均值和协方差矩阵决定，因此对于高斯过程而言，[弱平稳性](@entry_id:171204)与[严平稳性](@entry_id:260987)是等价的。

#### 依赖性与渐近推断

经典的大数定律（Law of Large Numbers, LLN）和[中心极限定理](@entry_id:143108)（Central Limit Theorem, CLT）通常建立在[独立同分布](@entry_id:169067)（i.i.d.）的假设之上。然而，[时间序列数据](@entry_id:262935)（如能源需求）的本质特征是其**序列依赖性**（serial dependence）。在这种情况下，仅有[平稳性](@entry_id:143776)不足以保证样本矩（如样本均值 $T^{-1}\sum_{t=1}^{T}X_t$）能够收敛到其总体对应量，或者保证标准化后的统计量具有渐近正态分布。

为了对相依序列进行有效的渐近推断，我们需要引入额外的条件来约束依赖性的强度，确保相距遥远的观测值是“渐近独立”的。这类条件统称为**混合条件**（mixing conditions）。例如，$\alpha$-混合（或强混合）条件要求相隔时间 $h$ 的两个事件之间的最大依赖性（由[混合系数](@entry_id:1127968) $\alpha(h)$ 度量）随着 $h \to \infty$ 而趋于零。如果 $\alpha(h)$ 衰减得足够快，并满足适当的[矩条件](@entry_id:136365)，我们就可以为相依数据建立[大数定律](@entry_id:140915)和中心极限定理。因此，在进行[参数估计](@entry_id:139349)和假设检验时，除了[平稳性假设](@entry_id:272270)，通常还需要依赖性衰减的假设，而[弱平稳性](@entry_id:171204)本身并不蕴含这一点。

#### 经典线性时序模型

在深入研究机制变化之前，我们先回顾一下作为基准的经典线性模型。这些模型通常使用**[滞后算子](@entry_id:266398)**（backshift operator）$B$ 来简洁地表示，其定义为 $B X_t = X_{t-1}$。

-   **[ARMA模型](@entry_id:139294)**: [自回归移动平均](@entry_id:143076)模型 **ARMA($p,q$)** 是对弱平稳[时间序列建模](@entry_id:1133184)的基本工具。其形式为：
    $$ \phi(B) X_t = c + \theta(B) \varepsilon_t $$
    其中 $\phi(B) = 1 - \sum_{i=1}^{p} \phi_i B^i$ 是 $p$ 阶自回归多项式，$\theta(B) = 1 + \sum_{j=1}^{q} \theta_j B^j$ 是 $q$ 阶移动平均多项式，$\{\varepsilon_t\}$ 是一个零均值、恒定方差的[白噪声过程](@entry_id:146877)。

-   **[ARIMA模型](@entry_id:146503)**: 许多经济和能源时间序列（如价格）呈现出非平稳性，但其差分序列是平稳的。这类过程被称为**[单位根](@entry_id:143302)过程**（unit root process），或**$d$阶单整**（integrated of order $d$），记为 $I(d)$。一个 $I(1)$ 过程经过一次差分后会变为 $I(0)$（即平稳）过程。自回归单整[移动平均模型](@entry_id:136461) **[ARIMA](@entry_id:1121103)($p,d,q$)** 正是用于描述这类过程，它等价于对原始序列进行 $d$ 次差分后应用一个 ARMA($p,q$) 模型：
    $$ \phi(B) (1 - B)^d X_t = c + \theta(B) \varepsilon_t $$

-   **[ARMAX模型](@entry_id:171938)**: 在[能源系统建模](@entry_id:1124496)中，我们常常需要考虑外生变量（如天气）的影响。**[ARMAX模型](@entry_id:171938)**（带外生变量的[ARMA模型](@entry_id:139294)）将外生变量 $Z_t$（如温度及其滞后项）线性地引入到条件均值中：
    $$ \phi(B) X_t = c + \beta^\top Z_t + \theta(B) \varepsilon_t $$
    在这个框架下，外生变量 $Z_t$ 直接、加性地影响 $X_t$ 的[条件期望](@entry_id:159140)，而不是影响其随机冲击项 $\varepsilon_t$。这是将外生影响纳入时序模型的最直接方式。

### 定义与检测机制变化

当一个时间序列的底层数据生成过程的参数发生突变时，我们就说发生了一次**机制变化**（regime change）。这种现象意味着序列不再是全局平稳的，而是可能呈现**分段平稳**（piecewise stationary）的特性。发生变化的时刻 $\tau$ 被称为**变化点**（change point）。例如，在[电力](@entry_id:264587)系统中，一次[发电机](@entry_id:268282)组的意外跳闸或一项新的能源政策的实施，都可能导致电网频率或电价的统计特性发生根本性改变。

针对机制变化的研究主要包含两大任务：

1.  **离线分割（Offline Segmentation）**: 这是一种回顾性分析。在收集到完整的数据集 $X_{1:T}$ 之后，我们的目标是找到最优的一组变化点 $\{\tau_1, \dots, \tau_k\}$，将整个时间序列划分为若干个统计特性一致的“机制”或“分段”。这通常被构建为一个优化问题，即在所有可能分割方案中，寻找一个能够最好地平衡段内[拟合优度](@entry_id:176037)与模型复杂度的方案。由于算法可以利用整个数据集，包括某个潜在变化点之后的“未来”信息，因此能够更精确地定位变化点。

2.  **在线检测（Online Detection）**: 这是一种序贯的、实时的分析方法。数据点 $X_1, X_2, \dots$ 依次到达，在每个时间点 $t$，算法必须仅基于已经观测到的历史信息（形式上由$\sigma$-代数 $\mathcal{F}_t$ 表示）做出决策，判断一个变化点是否刚刚发生。其目标是在变化发生后尽快发出警报。决策规则被形式化为一个**停止时**（stopping time）。在线检测面临一个固有的权衡：试图快速检测（低**检测延迟**）会不可避免地增加在没有变化时误发警报的概率（高**虚警率**）。设计高效的在线检测算法，核心就在于优化这种权衡。

### 可观测[机制模型](@entry_id:202454)：[阈值模型](@entry_id:172428)

一类重要的机制变化模型假设机制的转换由一个**可观测**的变量所驱动。这类模型中最具代表性的是[阈值模型](@entry_id:172428)。

#### 阈值自回归模型 (TAR)

**阈值自回归 (Threshold Autoregressive, TAR)** 模型是一种[分段线性](@entry_id:201467)的[自回归模型](@entry_id:140558)。其核心思想是，时间序列的动态特性（即[AR模型](@entry_id:189434)的参数）取决于一个**阈值变量**（threshold variable）$q_t$ 是否超过了某个**阈值**（threshold）$c$。这导致了机制之间的**突变**（abrupt change）。一个双机制的T[AR模型](@entry_id:189434)可以表示为：
$$
y_t = 
\begin{cases} 
\phi_{1,0} + \sum_{i=1}^p \phi_{1,i} y_{t-i} + \epsilon_{1,t}  \text{if } q_t \le c \\
\phi_{2,0} + \sum_{i=1}^p \phi_{2,i} y_{t-i} + \epsilon_{2,t}  \text{if } q_t > c 
\end{cases}
$$
阈值变量 $q_t$ 可以是外生的，例如环境温度；也可以是内生的，例如序列自身的某个滞后值 $y_{t-d}$，后者定义了所谓的**自激励阈值自回归 (Self-Exciting TAR, SETAR)** 模型。例如，在[电力](@entry_id:264587)[负荷建模](@entry_id:1127383)中，可以使用温度作为阈值变量。当温度低于某个舒适区间（如15°C）时，负荷主要由供暖驱动；当温度高于另一个舒适区间（如25°C）时，负荷主要由制冷驱动。在这两个机制中，负荷对温度变化的敏感性（即自回归参数）是截然不同的。

#### 平滑转换自回归模型 (STAR)

与T[AR模型](@entry_id:189434)中的突变不同，**平滑转换自回归 (Smooth Transition Autoregressive, STAR)** 模型允许机制之间的转换是**渐进**和**平滑**的。它通过一个连续的、值域在 $[0, 1]$ 之间的**转换函数**（transition function）$G(q_t; \gamma, c)$ 来实现。模型形式上是两个不同[AR模型](@entry_id:189434)动态的加权平均：
$$
y_t = (1 - G(q_t; \gamma, c)) \left(\text{机制1的AR动态}\right) + G(q_t; \gamma, c) \left(\text{机制2的AR动态}\right) + \epsilon_t
$$
转换函数 $G(\cdot)$ 的值从0平滑地变化到1，其变化速率由参数 $\gamma$ 控制。常用的转换函数包括逻辑函数（Logistic function，产生LST[AR模型](@entry_id:189434)）和指数函数（Exponential function，产生EST[AR模型](@entry_id:189434)）。ST[AR模型](@entry_id:189434)在描述那些机制边界不清晰、转变过程循序渐进的现象时特别有用。

### 潜在[机制模型](@entry_id:202454)：[马尔可夫转换模型](@entry_id:146116)

在许多现实情境中，驱动机制变化的变量是不可观测的，即机制本身是一个**潜在（latent）**或**隐（hidden）**的状态。对此类[系统建模](@entry_id:197208)的标准工具是[马尔可夫转换模型](@entry_id:146116)，也称为隐马尔可夫模型（Hidden Markov Model, HMM）。

**马尔可夫转换自回归 (Markov-Switching Autoregressive, MS-AR)** 模型是该领域的典范。其核心结构包含两个部分：
1.  一个不可观测的**潜在状态过程** $\{s_t\}$，它是一个具有 $K$ 个离散状态 $\{1, \dots, K\}$ 的一阶马尔可夫链。该过程的动态由一个 $K \times K$ 的**转移[概率矩阵](@entry_id:274812)**（transition probability matrix）$P$ 决定，其中元素 $P_{ij} = P(s_t = j | s_{t-1} = i)$ 表示从状态 $i$ 转移到状态 $j$ 的概率。
2.  一个**观测过程** $\{y_t\}$，其[条件分布](@entry_id:138367)取决于当前的潜在状态 $s_t$。在MS-[AR模型](@entry_id:189434)中，每个状态 $k$ 都对应一组独立的AR参数 $(\phi_k, c_k, \sigma_k^2)$。因此，在时间 $t$，观测值 $y_t$ 的动态遵循由 $s_t$ 所选择的那个[AR模型](@entry_id:189434)。

在给定模型参数和潜在状态路径的情况下，观测序列和状态序列的[联合概率分布](@entry_id:171550)可以分解为：
$$ p(y_{1:T},s_{1:T}) = p(s_1) \prod_{t=2}^T p(s_t|s_{t-1}) \times \prod_{t=1}^T p(y_t | y_{t-1:t-p}, s_t) $$
其中第一部分是[马尔可夫链](@entry_id:150828)的路径概率，第二部分是给定状态和历史观测下的条件观测概率。

#### [标签切换](@entry_id:751100)问题

在对MS-AR这类潜在[机制模型](@entry_id:202454)进行贝叶斯推断时，一个关键的实践挑战是**[标签切换](@entry_id:751100)**（label switching）问题。由于潜在状态是不可观测的，模型的[似然函数](@entry_id:921601)对于状态标签的任意置换（permutation）是不变的。例如，如果我们交换状态“1”和状态“2”的所有相关参数（AR系数、截距、方差，以及[转移矩阵](@entry_id:145510)的相应行和列），模型的[似然](@entry_id:167119)值将保持完全相同。

这种对称性导致，在使用诸如[马尔可夫链蒙特卡洛](@entry_id:138779)（MCMC）等[采样方法](@entry_id:141232)进行后验推断时，[后验分布](@entry_id:145605)会呈现出 $K!$ 个对称的模态。如果不对模型施加额外的约束，[MCMC采样](@entry_id:751801)器可能会在这些等价的模态之间来回“切换”，导致对任何单个机制（例如“机制1”）的参数估计变得毫无意义，因为“机制1”在不同的采样迭代中可能指代不同的动态行为。

值得注意的是，[标签切换](@entry_id:751100)问题虽然严重影响参数的**[可解释性](@entry_id:637759)**，但通常不影响**预测**。因为在进行预测时，我们会对所有可能的机制状态进行加权平均，这个过程不受标签的具体指派影响。解决[标签切换](@entry_id:751100)问题以获得可解释的[参数估计](@entry_id:139349)，通常需要施加**可识别性约束**，例如，对某些机制特定的参数进行排序（如要求机制的均值或方差满足 $\mu_1 \lt \mu_2 \lt \dots \lt \mu_K$ 或 $\sigma_1^2 \lt \dots \lt \sigma_K^2$），从而打破对称性，为每个机制赋予一个唯一的标签。

### [多变量系统](@entry_id:169616)与机制变化

机制变化的概念可以自然地推广到多变量时间序列系统，如向量自回归（VAR）模型。在多变量框架下，机制变化不仅可能影响单个序列的动态，还可能改变序列之间的相互关系。

#### [协整](@entry_id:140284)与[结构突变](@entry_id:636506)

在分析非平稳的经济或能源价格序列时，**[协整](@entry_id:140284)**（cointegration）是一个核心概念。如果一组 $I(1)$ 变量的某个线性组合是 $I(0)$（即平稳的），则我们称这些变量是[协整](@entry_id:140284)的。这个平稳的[线性组合](@entry_id:154743)代表了变量之间的一种[长期均衡](@entry_id:139043)关系，由**[协整](@entry_id:140284)向量**（cointegrating vector）$\beta$ 定义，使得 $\beta'X_t$ 是平稳的。

一个重要的机制变化形式是[协整](@entry_id:140284)关系的**[结构突变](@entry_id:636506)**。例如，由于[碳税](@entry_id:1122078)政策的改变或燃料混合技术的进步，[电力](@entry_id:264587)价格 $p^E_t$ 和天然气价格 $p^G_t$ 之间的[长期均衡](@entry_id:139043)关系可能会发生改变。这表现为[协整](@entry_id:140284)向量在某个变化点 $\tau$ 前后发生了变化（即 $\beta_1 \neq \beta_2$）。在这种情况下，尽管在每个机制内部都存在稳定的[协整](@entry_id:140284)关系，但如果分析师忽略了这个[结构突变](@entry_id:636506)，使用标准的[协整](@entry_id:140284)检验方法（如Engle-Granger检验或[Johansen检验](@entry_id:144889)）对整个样本进行分析，很可能会错误地得出变量之间不存在[协整](@entry_id:140284)关系的结论。这是因为任何一个固定的线性组合都无法在整个样本期间都产生平稳的残差序列，从而导致[检验功效](@entry_id:175836)降低。

#### 格兰杰因果关系与机制变化

**格兰杰因果关系**（Granger causality）是检验时间序列之间预测关系的标准工具。在VAR框架下，如果变量 $W_t$ 的滞后值能够显著提高对变量 $L_t$ 的预测能力（在给定 $L_t$ 自身滞后值和其他相关变量滞后值的条件下），我们就说“$W_t$ 格兰杰导致 $L_t$”。这本质上是一个关于**增量预测能力**的概念，必须与**同期相关性**（contemporaneous correlation）严格区分开来。两个变量可能同期高度相关（由它们创新项之间的相关性驱动），但不存在任何[格兰杰因果关系](@entry_id:137286)。

模型设定中的机制变化会对格兰杰因果检验产生严重影响，可能导致**伪因果关系**（spurious causality）的出现：
1.  **忽略[结构突变](@entry_id:636506)导致的伪因果**: 假设真实的数据生成过程（DGP）中，$W_{t-1}$ 在任何机制下都不能预测 $L_t$。但如果模型参数（如截距）在不同机制下存在显著差异，而分析师忽略了这一[结构突变](@entry_id:636506)，将所有数据混合在一起估计一个单一的[VAR模型](@entry_id:139665)，那么 $W_{t-1}$ 的高值（可能来自某个机制）可能会与 $L_t$ 的高值（也来自该机制）相关联。这种由混合不同机制数据所产生的相关性，可能被错误地解释为从 $W$ 到 $L$ 的格兰杰因果关系。
2.  **遗漏变量导致的伪因果**: 即使在单一[机制模型](@entry_id:202454)中，遗漏重要的共同驱动因素也会导致伪因果。假设天然气价格 $G_t$ 同时影响系统负荷 $L_t$ 和风力发电 $W_t$。如果在构建[VAR模型](@entry_id:139665)时忽略了变量 $G_t$，那么 $W_{t-1}$ 可能会“代理”了被遗漏的 $G_{t-1}$ 的信息。由于 $G_{t-1}$ 确实能预测 $L_t$，这部分效应可能会被错误地归因于 $W_{t-1}$，从而得出 $W$ 格兰杰导致 $L$ 的虚[假结](@entry_id:168307)论。这个问题在存在机制变化的环境中会变得更加复杂。

### 波动率机制的建模：[GARCH模型](@entry_id:142443)

除了条件均值，时间序列的[条件方差](@entry_id:183803)（即波动率）也常常表现出机制变化的特征。金融和能源价格的收益率序列通常呈现出**[波动率聚集](@entry_id:145675)**（volatility clustering）的现象：大的价格变动之后倾向于跟随大的变动，而小的变动之后倾向于跟随小的变动。这种现象被称为**[条件异方差](@entry_id:141394)**（conditional heteroskedasticity）。

**广义[自回归条件异方差](@entry_id:137546) (Generalized Autoregressive Conditional Heteroskedasticity, GARCH)** 模型是刻画这种动态的标杆模型。一个 **GARCH($p,q$)** 模型将时间 $t$ 的[条件方差](@entry_id:183803) $\sigma_t^2 = \operatorname{Var}(\epsilon_t | \mathcal{F}_{t-1})$ 表示为过去平方残差（ARCH项）和过去[条件方差](@entry_id:183803)（GARCH项）的线性函数：
$$ \sigma_t^2 = \omega + \sum_{i=1}^{q} \alpha_i \epsilon_{t-i}^2 + \sum_{j=1}^{p} \beta_j \sigma_{t-j}^2 $$
这里，$\omega > 0, \alpha_i \geq 0, \beta_j \geq 0$ 是保证方差非负的约束。

至关重要的是区分**[条件方差](@entry_id:183803)**和**无[条件方差](@entry_id:183803)**：
-   **[条件方差](@entry_id:183803)** $\sigma_t^2$ 是随时间变化的，它捕捉了波动率的短期动态。
-   **无[条件方差](@entry_id:183803)** $\operatorname{Var}(\epsilon_t)$ 是过程的长期平均方差。如果GARCH过程是协方差平稳的（这要求系数和 $\sum \alpha_i + \sum \beta_j \lt 1$），那么它的无[条件方差](@entry_id:183803)是一个常数，对于GARCH(1,1)模型，其值为 $\sigma^2 = \omega / (1 - \alpha_1 - \beta_1)$。

波动率的机制变化可以被理解为[GARCH模型](@entry_id:142443)的参数 $(\omega, \alpha_i, \beta_j)$ 发生了结构性突变。例如，一次市场监管政策的变化可能导致价格波动率的长期水平（由 $\omega$ 和无[条件方差](@entry_id:183803)决定）和对冲击的反应模式（由 $\alpha_i$ 和 $\beta_j$ 决定）发生永久性改变。

### 建模与推断中的实践考量

在应用上述模型时，研究者必须面对两个关键的实践问题：如何选择最合适的模型，以及如何处理不完整的数据。

#### [模型选择](@entry_id:155601)：[信息准则](@entry_id:635818)

在比较具有不同阶数（如AR阶数 $p$）或不同机制数量（如 $S$）的[竞争模型](@entry_id:1122715)时，我们需要一个能够[平衡模型](@entry_id:636099)[拟合优度](@entry_id:176037)和复杂度的标准。**[信息准则](@entry_id:635818)**（Information Criteria）为此提供了正式的框架。它们通常具有以下形式：
$$ \text{IC} = -2\ell(\hat{\theta}) + \text{惩罚项} $$
其中 $\ell(\hat{\theta})$ 是最大化后的对数似然值，代表模型的[拟合优度](@entry_id:176037)。我们选择IC值最小的模型。三个最常用的准则是：
-   **[赤池信息准则 (AIC)](@entry_id:193149)**: $ \text{AIC} = -2\ell(\hat{\theta}) + 2k $
-   **[贝叶斯信息准则 (BIC)](@entry_id:181959)**: $ \text{BIC} = -2\ell(\hat{\theta}) + k \ln(n) $
-   **汉南-奎因[信息准则](@entry_id:635818) (HQIC)**: $ \text{HQIC} = -2\ell(\hat{\theta}) + 2k \ln(\ln n) $

这里的 $n$ 是观测数量，$k$ 是模型中自由估计的参数数量。正确计算 $k$ 对于复杂模型至关重要。例如，对于一个具有 $S$ 个机制的MS-AR($p$)模型，参数总数 $k$ 包括：
-   $S \times p$ 个自[回归系数](@entry_id:634860)
-   $S$ 个截距
-   $S$ 个创新项方差
-   $S(S-1)$ 个自由的转移概率（因为每个状态的转移概率之和为1）
-   如果初始状态分布也被估计，则还需加上 $S-1$ 个参数。
必须强调，潜在状态序列 $\{s_t\}$ 不是参数，而是在计算[似然](@entry_id:167119)时被积分掉的[随机变量](@entry_id:195330)，不应计入 $k$ 中。

#### 数据缺失问题

现实世界中的传感器数据常常存在缺失。处理[缺失数据](@entry_id:271026)的有效性取决于**缺失机制**（missingness mechanism），即数据缺失的概率如何依赖于数据本身。我们区分三种主要机制：

1.  **[完全随机缺失](@entry_id:170286) (Missing Completely At Random, MCAR)**: 缺失的发生与任何观测值或未观测值都无关。即 $p(R | Y_{\text{com}}, X, \psi) = p(R | \psi)$。
2.  **[随机缺失](@entry_id:164190) (Missing At Random, MAR)**: 缺失的发生可能依赖于已观测到的数据，但在给定已观测数据后，它与未观测到的（缺失的）数据无关。即 $p(R | Y_{\text{com}}, X, \psi) = p(R | Y_{\text{obs}}, X, \psi)$。在时间序列中，一个例子是 $y_t$ 的缺失概率依赖于前一时刻的观测值 $y_{t-1}$。
3.  **[非随机缺失](@entry_id:899134) (Missing Not At Random, [MNAR](@entry_id:899134))**: 缺失的发生依赖于未观测到的数据本身。例如，当负荷 $y_t$ 超过某个阈值时传感器发生故障，导致 $y_t$ 的值缺失。

这些机制对推断的有效性有重大影响。对于[基于似然的推断](@entry_id:922306)，如果数据是MAR或MCAR，并且数据模型参数与缺失模型参数“分离”，那么缺失机制是**可忽略的**（ignorable）。在这种情况下，我们可以通过最大化**观测数据似然**来获得对模型参数（包括变化点）的一致估计。诸如将模型置于[状态空间](@entry_id:160914)形式并使用卡尔曼滤波器和[EM算法](@entry_id:274778)等方法，正是通过有效计算观测数据[似然](@entry_id:167119)而在MAR下保持有效性的。相反，简单的完整案例分析（仅使用没有缺失值的观测对）虽然在某些MAR条件下可能仍是一致的，但会损[失效率](@entry_id:266388)；而简单的均值[插补](@entry_id:270805)等方法则会严重扭曲时间序列的动态结构，导致有偏估计。

当数据是[MNAR](@entry_id:899134)时，缺失机制不可忽略。忽略缺失机制会导致对模型参数的严重偏误，并且可能掩盖真实的变化点或制造虚假的变化点。在这种情况下，有效的推断要求对数据生成过程和缺失过程进行**联合建模**。