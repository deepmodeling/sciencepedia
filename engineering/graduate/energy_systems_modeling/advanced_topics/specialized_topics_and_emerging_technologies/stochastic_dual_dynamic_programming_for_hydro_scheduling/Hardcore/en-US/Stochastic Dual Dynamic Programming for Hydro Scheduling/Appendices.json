{
    "hands_on_practices": [
        {
            "introduction": "At the core of any hydro scheduling model lies the principle of mass conservation. This fundamental practice challenges you to construct and apply the reservoir's state transition equation, which describes how storage evolves over a single time step. By mastering this calculation, you solidify your understanding of the \"dynamics\" in Stochastic Dual Dynamic Programming and build the foundational block for any multi-stage optimization. ",
            "id": "4125511",
            "problem": "Consider a single-reservoir hydro system modeled within Stochastic Dual Dynamic Programming (SDDP). At stage $t$, the reservoir storage state variable is $s_{t}$, expressed in hm$^{3}$, and the system experiences inflow $a_{t}$, turbine discharge $q_{t}$, uncontrolled spill $\\text{spill}_{t}$, and evaporation $e_{t}$, all expressed in m$^{3}$/s. The decision period has duration $\\Delta t$ hours, and the balance of water over the control volume is governed by mass conservation. The next-stage storage $s_{t+1}$ is determined by integrating the net volumetric flow over the decision period and converting to the storage unit hm$^{3}$, using the fact that $1 \\text{ hm}^3 = 10^6 \\text{ m}^3$. The feasible storage region is defined by bounds $s_{\\min}$ and $s_{\\max}$.\n\nUsing the mass conservation principle as the fundamental base and the discrete-time accumulation over the period $\\Delta t$, derive the storage transition and compute the next-stage storage for the following data: $s_{t}=90$ hm$^{3}$, $a_{t}=12$ m$^{3}$/s, $q_{t}=30$ m$^{3}$/s, $\\text{spill}_{t}=5$ m$^{3}$/s, $e_{t}=1$ m$^{3}$/s, and $\\Delta t=3$ h. Check the feasibility of $s_{t+1}$ against the bounds $s_{\\min}=50$ hm$^{3}$ and $s_{\\max}=120$ hm$^{3}$.\n\nReport your final answer as a row matrix containing two entries: the value of $s_{t+1}$ (expressed in hm$^{3}$ and rounded to four significant figures) and a feasibility indicator equal to $1$ if $s_{\\min} \\leq s_{t+1} \\leq s_{\\max}$ and $0$ otherwise.",
            "solution": "The problem is valid as it is scientifically grounded in the principle of mass conservation, is well-posed with all necessary data provided, and is expressed in objective, formal language. We proceed with the solution.\n\nThe core of the problem lies in establishing the storage transition equation for the reservoir based on the principle of mass conservation. This principle states that the rate of change of the volume of water within a control volume is equal to the net rate of volumetric flow into that volume.\n\nLet $V(t)$ represent the volume of water in the reservoir at time $t$, expressed in cubic meters (m$^3$). The state variable $s_t$ is the storage in hectometers cubed (hm$^3$) at the beginning of the decision period $t$. The relationship between these two quantities is given by the conversion factor $1 \\text{ hm}^3 = 10^6 \\text{ m}^3$. Therefore, the initial volume at the start of stage $t$ is $V_t = s_t \\times 10^6$.\n\nThe rates of flow into and out of the reservoir are given in m$^3$/s. The total inflow rate is $a_t$. The total outflow rate is the sum of turbine discharge $q_t$, uncontrolled spill $\\text{spill}_t$, and evaporation $e_t$. The net flow rate, $f_{\\text{net}}$, into the reservoir is thus:\n$$f_{\\text{net}} = a_t - (q_t + \\text{spill}_t + e_t)$$\n\nAssuming these flow rates are constant throughout the decision period of duration $\\Delta t$, the change in reservoir volume, $\\Delta V$, is the product of the net flow rate and the duration of the period. Crucially, the units must be consistent. The flow rates are in m$^3$/s, so the time duration must be in seconds.\nThe duration is given as $\\Delta t$ in hours. To convert hours to seconds, we use the conversion factor $1 \\text{ h} = 3600 \\text{ s}$. Let $\\Delta t_{\\text{sec}}$ be the duration in seconds:\n$$\\Delta t_{\\text{sec}} = \\Delta t \\times 3600$$\n\nThe change in volume $\\Delta V$ over the period is:\n$$\\Delta V = f_{\\text{net}} \\times \\Delta t_{\\text{sec}} = (a_t - q_t - \\text{spill}_t - e_t) \\times (\\Delta t \\times 3600)$$\nThis change $\\Delta V$ is in m$^3$.\n\nThe storage at the next stage, $s_{t+1}$, is the initial storage $s_t$ plus the change in storage, $\\Delta s$. The change in storage must be converted from m$^3$ to hm$^3$:\n$$\\Delta s = \\frac{\\Delta V}{10^6} = \\frac{(a_t - q_t - \\text{spill}_t - e_t) \\times \\Delta t \\times 3600}{10^6}$$\nThe storage transition equation is therefore:\n$$s_{t+1} = s_t + \\Delta s = s_t + \\frac{(a_t - q_t - \\text{spill}_t - e_t) \\times \\Delta t \\times 3600}{10^6}$$\n\nNow, we substitute the given numerical values into this equation:\n- Initial storage: $s_t = 90 \\text{ hm}^3$\n- Inflow: $a_t = 12 \\text{ m}^3/\\text{s}$\n- Turbine discharge: $q_t = 30 \\text{ m}^3/\\text{s}$\n- Uncontrolled spill: $\\text{spill}_t = 5 \\text{ m}^3/\\text{s}$\n- Evaporation: $e_t = 1 \\text{ m}^3/\\text{s}$\n- Time duration: $\\Delta t = 3 \\text{ h}$\n\nFirst, we calculate the net flow rate $f_{\\text{net}}$:\n$$f_{\\text{net}} = 12 - (30 + 5 + 1) = 12 - 36 = -24 \\text{ m}^3/\\text{s}$$\nA negative value indicates a net outflow of water from the reservoir.\n\nNext, we calculate the change in storage $\\Delta s$ in hm$^3$:\n$$\\Delta s = \\frac{(-24 \\text{ m}^3/\\text{s}) \\times (3 \\text{ h} \\times 3600 \\text{ s/h})}{10^6 \\text{ m}^3/\\text{hm}^3}$$\n$$\\Delta s = \\frac{-24 \\times 10800}{10^6} = \\frac{-259200}{1000000} = -0.2592 \\text{ hm}^3$$\n\nFinally, we compute the storage at the next stage, $s_{t+1}$:\n$$s_{t+1} = s_t + \\Delta s = 90 + (-0.2592) = 89.7408 \\text{ hm}^3$$\nThe problem requires this value to be rounded to four significant figures.\n$$s_{t+1} \\approx 89.74 \\text{ hm}^3$$\n\nThe second part of the task is to check the feasibility of this resulting storage level against the given bounds:\n- Minimum storage: $s_{\\min} = 50 \\text{ hm}^3$\n- Maximum storage: $s_{\\max} = 120 \\text{ hm}^3$\n\nWe must verify if $s_{\\min} \\leq s_{t+1} \\leq s_{\\max}$:\n$$50 \\leq 89.7408 \\leq 120$$\nThis inequality is true. Therefore, the resulting storage is feasible. The feasibility indicator is $1$.\n\nThe final answer is a row matrix containing the rounded value of $s_{t+1}$ and the feasibility indicator.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n89.74 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from physical dynamics to economic optimization, this exercise places you in the role of a system operator making a real-time dispatch decision. The central concept in SDDP is the marginal water value, $\\pi_t$, which represents the opportunity cost of using water now versus saving it for the future. This practice will guide you through using this value to decide the optimal mix of hydro and thermal generation, illustrating the core economic trade-off at the heart of the SDDP forward pass. ",
            "id": "4125540",
            "problem": "Consider a single stage of a hydro-thermal scheduling problem solved by Stochastic Dual Dynamic Programming (SDDP), where Stochastic Dual Dynamic Programming (SDDP) denotes a decomposition-based algorithm that approximates the Bellman cost-to-go function by a collection of affine cuts. At the current stage, the system operator chooses hydro generation $P_{t}$ and thermal generation $P_{t}^{\\text{thermal}}$ to satisfy the deterministic power balance $P_{t} + P_{t}^{\\text{thermal}} = D_{t}$. The demand is $D_{t} = 100$ MW. The thermal unit has linear variable cost $c^{\\text{th}} = 30$ $\\$/\\text{MWh}$. The marginal water opportunity cost (i.e., the subgradient of the current cost-to-go cut with respect to storage translated into energy units) is $\\pi_{t} = 60$ $\\$/\\text{MWh}$. Assume no ramping or capacity limits and that feasibility is guaranteed.\n\nUsing only fundamental principles of dynamic programming and convex optimization, formulate the one-stage economic dispatch that minimizes the sum of immediate thermal production cost and the opportunity cost of using hydro energy at price $\\pi_{t}$, subject to the power balance and nonnegativity. Derive the first-order optimality conditions and use them to determine the optimal hydro dispatch $P_{t}^{\\star}$. Express your final answer as a single real number in MW. No rounding is required. Report only $P_{t}^{\\star}$ in MW.",
            "solution": "The problem asks for the optimal hydro generation $P_{t}^{\\star}$ for a single-stage economic dispatch problem within a Stochastic Dual Dynamic Programming (SDDP) framework. The solution is derived from the fundamental principles of convex optimization.\n\nFirst, we formulate the optimization problem. The objective is to minimize the total system cost for the current stage, $t$. This cost is the sum of the immediate thermal generation cost and the opportunity cost of dispatching hydro energy. The opportunity cost represents the expected future cost incurred by using water now instead of saving it for later, and it is given by the marginal water value, $\\pi_{t}$.\n\nThe decision variables are the hydro generation, $P_{t}$, and the thermal generation, $P_{t}^{\\text{thermal}}$. Both are measured in MW.\n\nThe total cost, $C(P_{t}, P_{t}^{\\text{thermal}})$, for one hour of operation is given by:\n$$C(P_{t}, P_{t}^{\\text{thermal}}) = c^{\\text{th}} \\cdot P_{t}^{\\text{thermal}} + \\pi_{t} \\cdot P_{t}$$\nwhere $c^{\\text{th}}$ is the variable cost of the thermal unit and $\\pi_{t}$ is the marginal opportunity cost of water.\n\nThe system is subject to the following constraints:\n1.  **Power Balance:** The total generation must meet the demand $D_{t}$.\n    $$P_{t} + P_{t}^{\\text{thermal}} = D_{t}$$\n2.  **Non-negativity:** Generation cannot be negative.\n    $$P_{t} \\ge 0$$\n    $$P_{t}^{\\text{thermal}} \\ge 0$$\nThe problem states that there are no capacity or ramping limits.\n\nWe can simplify the problem by substituting the power balance constraint into the objective function. From the power balance, we have $P_{t}^{\\text{thermal}} = D_{t} - P_{t}$. Substituting this into the cost function yields an objective function solely in terms of $P_{t}$:\n$$f(P_{t}) = c^{\\text{th}} (D_{t} - P_{t}) + \\pi_{t} P_{t}$$\n$$f(P_{t}) = c^{\\text{th}} D_{t} - c^{\\text{th}} P_{t} + \\pi_{t} P_{t}$$\n$$f(P_{t}) = c^{\\text{th}} D_{t} + (\\pi_{t} - c^{\\text{th}}) P_{t}$$\n\nThe non-negativity constraint $P_{t}^{\\text{thermal}} \\ge 0$ implies $D_{t} - P_{t} \\ge 0$, which means $P_{t} \\le D_{t}$. Combined with $P_{t} \\ge 0$, the feasible range for the hydro dispatch is $0 \\le P_{t} \\le D_{t}$.\n\nThe optimization problem is now reduced to:\n$$\\min_{P_{t}} \\quad c^{\\text{th}} D_{t} + (\\pi_{t} - c^{\\text{th}}) P_{t}$$\nSubject to:\n$$0 \\le P_{t} \\le D_{t}$$\n\nThis is a linear programming problem. The term $c^{\\text{th}} D_{t}$ is a constant with respect to the decision variable $P_{t}$, so it does not affect the optimal solution. The solution is determined by the sign of the coefficient of $P_{t}$, which is $(\\pi_{t} - c^{\\text{th}})$.\n\nLet's substitute the given values:\n-   Demand: $D_{t} = 100$ MW\n-   Thermal cost: $c^{\\text{th}} = 30$ $\\$/\\text{MWh}$\n-   Marginal water value: $\\pi_{t} = 60$ $\\$/\\text{MWh}$\n\nThe coefficient is $(\\pi_{t} - c^{\\text{th}}) = 60 - 30 = 30$. Since this coefficient is positive, to minimize the objective function, we must choose the smallest possible value for $P_{t}$ within its feasible range. The feasible range is $[0, 100]$. The minimum value is $0$.\nTherefore, the optimal hydro dispatch is $P_{t}^{\\star} = 0$ MW. This implies that the entire demand should be met by the cheaper thermal generation, $P_{t}^{\\text{thermal}\\star} = 100$ MW.\n\nTo confirm this result using first-order optimality conditions, as requested, we formulate the Karush-Kuhn-Tucker (KKT) conditions for the original problem.\nThe problem is:\n$$\\min_{P_t, P_t^{\\text{thermal}}} \\quad c^{\\text{th}} P_t^{\\text{thermal}} + \\pi_t P_t$$\nSubject to:\n1.  $P_t + P_t^{\\text{thermal}} - D_t = 0 \\quad (\\text{with multiplier } \\lambda)$\n2.  $-P_t \\le 0 \\quad (\\text{with multiplier } \\mu_1)$\n3.  $-P_t^{\\text{thermal}} \\le 0 \\quad (\\text{with multiplier } \\mu_2)$\n\nThe Lagrangian function $\\mathcal{L}$ is:\n$$\\mathcal{L}(P_t, P_t^{\\text{thermal}}, \\lambda, \\mu_1, \\mu_2) = c^{\\text{th}} P_t^{\\text{thermal}} + \\pi_t P_t - \\lambda(P_t + P_t^{\\text{thermal}} - D_t) - \\mu_1 P_t - \\mu_2 P_t^{\\text{thermal}}$$\nThe KKT conditions for optimality are:\n\n1.  **Stationarity:**\n    $$\\frac{\\partial \\mathcal{L}}{\\partial P_t} = \\pi_t - \\lambda - \\mu_1 = 0 \\implies \\lambda = \\pi_t - \\mu_1$$\n    $$\\frac{\\partial \\mathcal{L}}{\\partial P_t^{\\text{thermal}}} = c^{\\text{th}} - \\lambda - \\mu_2 = 0 \\implies \\lambda = c^{\\text{th}} - \\mu_2$$\n2.  **Primal Feasibility:**\n    $$P_t + P_t^{\\text{thermal}} = D_t$$\n    $$P_t \\ge 0, \\quad P_t^{\\text{thermal}} \\ge 0$$\n3.  **Dual Feasibility:**\n    $$\\mu_1 \\ge 0, \\quad \\mu_2 \\ge 0$$\n4.  **Complementary Slackness:**\n    $$\\mu_1 P_t = 0$$\n    $$\\mu_2 P_t^{\\text{thermal}} = 0$$\n\nFrom the stationarity conditions, we equate the expressions for $\\lambda$:\n$$\\pi_t - \\mu_1 = c^{\\text{th}} - \\mu_2$$\n$$\\pi_t - c^{\\text{th}} = \\mu_1 - \\mu_2$$\nSubstituting the given values, $c^{\\text{th}} = 30$ and $\\pi_{t} = 60$:\n$$60 - 30 = \\mu_1 - \\mu_2 \\implies 30 = \\mu_1 - \\mu_2$$\nThis implies $\\mu_1 = \\mu_2 + 30$. Since $\\mu_2 \\ge 0$ (dual feasibility), it must be that $\\mu_1 \\ge 30$.\nBecause $\\mu_1$ is strictly positive ($\\mu_1 > 0$), the complementary slackness condition $\\mu_1 P_t = 0$ requires that $P_t = 0$.\n\nLet's check for consistency. The optimal hydro dispatch is $P_{t}^{\\star} = 0$.\n-   From the power balance, $P_{t}^{\\text{thermal}\\star} = D_t - P_{t}^{\\star} = 100 - 0 = 100$.\n-   Both $P_{t}^{\\star} = 0$ and $P_{t}^{\\text{thermal}\\star} = 100$ satisfy the non-negativity constraints.\n-   Since $P_{t}^{\\text{thermal}\\star} = 100 > 0$, the complementary slackness condition $\\mu_2 P_t^{\\text{thermal}} = 0$ requires that $\\mu_2 = 0$.\n-   Using $\\mu_1 = \\mu_2 + 30$, we find $\\mu_1 = 0 + 30 = 30$. This satisfies dual feasibility ($\\mu_1 \\ge 0$).\n-   The system marginal price, $\\lambda$, can be calculated from either stationarity condition:\n    $$\\lambda = c^{\\text{th}} - \\mu_2 = 30 - 0 = 30$$\n    $$\\lambda = \\pi_t - \\mu_1 = 60 - 30 = 30$$\nThe value of $\\lambda$ is consistent. All KKT conditions are satisfied.\nThe economic interpretation is that the marginal cost of hydro energy ($\\pi_t = 60$ $\\$/\\text{MWh}) is greater than the marginal cost of thermal energy ($c^{\\text{th}} = 30$ $\\$/\\text{MWh}). Therefore, the system operator minimizes cost by dispatching the cheapest available resource, which is the thermal unit, to meet the entire demand. The more expensive hydro resource is not dispatched.\n\nThe optimal hydro dispatch is $P_{t}^{\\star} = 0$ MW.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "An SDDP-derived policy is optimized for a specific set of statistical assumptions about the future, and its true value is revealed only when tested against reality. This advanced, implementation-focused practice challenges you to perform an out-of-sample stress test, a critical step in real-world deployment. You will simulate your policy's performance under extreme drought scenarios not seen during its training, allowing you to quantify its robustness and understand its behavior at the operational edge. ",
            "id": "4125523",
            "problem": "Consider a single-reservoir hydropower system operated over a finite horizon of $T$ discrete periods under uncertain inflows. The Stochastic Dual Dynamic Programming (SDDP) policy is approximated by a convex, piecewise-linear future value function in storage that yields a state-dependent marginal water value. The out-of-sample stress test must evaluate policy robustness under drought inflow scenarios by quantifying worst-case revenue and spill violations.\n\nFundamental base and physical relationships:\n- Reservoir mass balance: for storage $S_t$ at the start of period $t$, inflow $I_t$, and release $R_t$, the post-decision storage is\n$$ S_{t+1} = \\min\\{V_{\\max}, \\max\\{V_{\\min}, S_t + I_t - R_t\\}\\}.$$\n- Spillage beyond reservoir capacity occurs when $S_t + I_t - R_t > V_{\\max}$, with spilled volume\n$$ \\text{spill}_t = \\max\\{0, S_t + I_t - R_t - V_{\\max}\\}.$$\n- Physical constraints on release include availability of water and plant limits:\n$$ 0 \\le R_t \\le \\min\\{R_{\\max}, S_t + I_t - V_{\\min}\\}, $$\nand an environmental minimum release\n$$ R_t \\ge R_{\\min} \\quad \\text{if} \\quad S_t + I_t - V_{\\min} \\ge R_{\\min}. $$\n- Hydropower energy conversion per unit volume is derived from gravitational potential energy:\n$$ E_{\\text{per } m^3} = \\frac{\\rho g H \\eta}{3.6 \\times 10^9} \\quad \\text{MWh per } m^3, $$\nwhere $\\rho$ is water density in $\\text{kg}/\\text{m}^3$, $g$ is gravitational acceleration in $\\text{m}/\\text{s}^2$, $H$ is effective hydraulic head in $\\text{m}$, and $\\eta$ is turbine-generator efficiency. Revenue in period $t$ is $p_t E_{\\text{per } m^3} R_t$ in dollars.\n\nSDDP-derived policy approximation and decision rule:\n- The SDDP future value function in storage at period $t+1$ is approximated by a piecewise-linear convex function with slopes (marginal water values) that depend on the storage region:\n$$ \\beta(S_t) = \\begin{cases}\n\\beta_{\\text{low}}, & \\text{if } S_t < S_{\\text{split}}, \\\\\n\\beta_{\\text{high}}, & \\text{otherwise},\n\\end{cases} $$\nwith $\\beta_{\\text{low}} > \\beta_{\\text{high}}$ representing higher scarcity at low storage.\n- At each period $t$, the release $R_t$ is chosen to maximize the sum of immediate revenue and the approximated future value, subject to physical constraints. Using the linear approximation, the objectiveâ€™s derivative with respect to $R_t$ is\n$$ \\frac{\\partial}{\\partial R_t} \\left( p_t E_{\\text{per } m^3} R_t + \\beta(S_t) \\cdot (S_t + I_t - R_t) \\right) = p_t E_{\\text{per } m^3} - \\beta(S_t). $$\nThus, an optimal threshold policy emerges:\n- If $p_t E_{\\text{per } m^3} \\ge \\beta(S_t)$, set $R_t$ to the largest feasible value to exploit high prices:\n$$ R_t = \\min\\{R_{\\max}, S_t + I_t - V_{\\min}\\}, $$\nsubject to the availability constraint $R_t \\le S_t + I_t$.\n- If $p_t E_{\\text{per } m^3} < \\beta(S_t)$, set $R_t$ to the smallest feasible value:\n$$ R_t = \\max\\{0, \\min\\{R_{\\min}, S_t + I_t - V_{\\min}\\}\\}, $$\nunless needed to avoid immediate spill, in which case increase $R_t$ just enough to satisfy\n$$ R_t \\ge S_t + I_t - V_{\\max}, $$\nstill respecting the upper bound on $R_t$. This spill-avoidance adjustment is consistent with convexity of the future value function and the physical penalty associated with loss of control over spilled water.\n\nStress-test design:\n- Consider $T = 6$ periods. Use the following physical constants for conversion:\n    - $\\rho = 1000$ $\\text{kg}/\\text{m}^3$, $g = 9.81$ $\\text{m}/\\text{s}^2$, $H = 150$ $\\text{m}$, and $\\eta = 0.9$.\n- Baseline inflow vector (in $\\text{m}^3$ per period): $[2 \\times 10^6, 1.8 \\times 10^6, 1.5 \\times 10^6, 1.3 \\times 10^6, 1.1 \\times 10^6, 0.9 \\times 10^6]$.\n- Out-of-sample drought scenarios:\n    - Mild drought: $0.5$ times baseline inflows.\n    - Severe drought: $0.2$ times baseline inflows.\n    - Extreme drought: $0.05$ times baseline inflows.\nFor each test case below, evaluate the SDDP-derived threshold policy over the three drought scenarios and report the worst-case revenue (minimum across scenarios, in dollars) and worst-case total spillage (maximum across scenarios, in $\\text{m}^3$).\n\nTest suite and parameterization:\n- Case $1$:\n    - Prices $p_t$ in $\\$/\\text{MWh}$: $[40, 45, 50, 55, 50, 45]$.\n    - Reservoir bounds: $V_{\\min} = 1.0 \\times 10^6$ $\\text{m}^3$, $V_{\\max} = 6.0 \\times 10^6$ $\\text{m}^3$.\n    - Turbine capacity: $R_{\\max} = 1.5 \\times 10^6$ $\\text{m}^3$ per period.\n    - Environmental minimum release: $R_{\\min} = 0.2 \\times 10^6$ $\\text{m}^3$ per period.\n    - Initial storage: $S_0 = 3.0 \\times 10^6$ $\\text{m}^3$.\n    - SDDP water value slopes and storage split: $S_{\\text{split}} = 3.0 \\times 10^6$ $\\text{m}^3$, $\\beta_{\\text{low}} = 0.03$ $\\$/\\text{m}^3$, $\\beta_{\\text{high}} = 0.012$ $\\$/\\text{m}^3$.\n- Case $2$:\n    - Prices $p_t$ in $\\$/\\text{MWh}$: $[30, 80, 90, 70, 40, 35]$.\n    - Reservoir bounds: $V_{\\min} = 1.0 \\times 10^6$ $\\text{m}^3$, $V_{\\max} = 6.0 \\times 10^6$ $\\text{m}^3$.\n    - Turbine capacity: $R_{\\max} = 2.0 \\times 10^6$ $\\text{m}^3$ per period.\n    - Environmental minimum release: $R_{\\min} = 0.2 \\times 10^6$ $\\text{m}^3$ per period.\n    - Initial storage: $S_0 = 5.0 \\times 10^6$ $\\text{m}^3$.\n    - SDDP water value slopes and storage split: $S_{\\text{split}} = 4.0 \\times 10^6$ $\\text{m}^3$, $\\beta_{\\text{low}} = 0.025$ $\\$/\\text{m}^3$, $\\beta_{\\text{high}} = 0.011$ $\\$/\\text{m}^3$.\n- Case $3$:\n    - Prices $p_t$ in $\\$/\\text{MWh}$: $[20, 25, 22, 24, 23, 21]$.\n    - Reservoir bounds: $V_{\\min} = 1.0 \\times 10^6$ $\\text{m}^3$, $V_{\\max} = 6.0 \\times 10^6$ $\\text{m}^3$.\n    - Turbine capacity: $R_{\\max} = 1.2 \\times 10^6$ $\\text{m}^3$ per period.\n    - Environmental minimum release: $R_{\\min} = 0.15 \\times 10^6$ $\\text{m}^3$ per period.\n    - Initial storage: $S_0 = 2.0 \\times 10^6$ $\\text{m}^3$.\n    - SDDP water value slopes and storage split: $S_{\\text{split}} = 2.5 \\times 10^6$ $\\text{m}^3$, $\\beta_{\\text{low}} = 0.035$ $\\$/\\text{m}^3$, $\\beta_{\\text{high}} = 0.015$ $\\$/\\text{m}^3$.\n\nRequired outputs:\n- For each case, compute:\n    - Worst-case revenue across the three drought scenarios (minimum of scenario revenues), expressed in dollars as a float.\n    - Worst-case total spillage across the three drought scenarios (maximum of scenario total spilled volume), expressed in $\\text{m}^3$ as a float.\n- Final output format: your program should produce a single line of output containing a list of three elements, one per case, where each element is the pair $[\\text{worst\\_revenue}, \\text{worst\\_spill}]$ for that case. The outer list must be printed as a comma-separated list enclosed in square brackets, for example, $[[x_1,y_1],[x_2,y_2],[x_3,y_3]]$.\n\nUnits:\n- Express final revenues in dollars (no rounding requirement).\n- Express total spillage in cubic meters (no rounding requirement).\n- Angles do not appear; no angle unit is required.\n- If any fraction or percentage arises, express it as a decimal number without the percentage symbol.\n\nYour task is to implement the above stress test under the specified policy and parameters, and produce the required final output exactly as specified.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of hydropower operations and resource management, mathematically well-posed, and objectively stated. It presents a standard, albeit simplified, model for evaluating a hydropower dispatch policy under uncertainty. We will proceed with a full solution.\n\nThe solution involves simulating the operation of a single-reservoir hydropower system over a finite time horizon of $T=6$ periods. The core of the problem is to apply a pre-defined operating policy, derived from a simplified Stochastic Dual Dynamic Programming (SDDP) framework, to determine water release decisions under various drought scenarios. The goal is to evaluate the policy's robustness by calculating the worst-case revenue and spillage.\n\nFirst, we establish the physical and economic constants. The energy generated per unit volume of water is determined by the conversion of gravitational potential energy. The formula is given as:\n$$ E_{\\text{per } m^3} = \\frac{\\rho g H \\eta}{3.6 \\times 10^9} \\quad [\\text{MWh} / \\text{m}^3] $$\nwhere $\\rho$ is the density of water ($1000$ kg/m$^3$), $g$ is the acceleration due to gravity ($9.81$ m/s$^2$), $H$ is the effective hydraulic head ($150$ m), and $\\eta$ is the turbine-generator efficiency ($0.9$). The denominator $3.6 \\times 10^9$ converts joules to megawatt-hours (MWh).\nSubstituting the given values:\n$$ E_{\\text{per } m^3} = \\frac{(1000)(9.81)(150)(0.9)}{3.6 \\times 10^9} = 0.000367875 \\text{ MWh/m}^3 $$\nThe revenue generated in period $t$ is the product of the energy produced and the electricity price $p_t$:\n$$ \\text{Revenue}_t = p_t \\cdot E_{\\text{per } m^3} \\cdot R_t $$\nwhere $R_t$ is the volume of water released through the turbines in period $t$. The term $p_t E_{\\text{per } m^3}$ represents the marginal revenue of releasing one cubic meter of water, which is the opportunity cost of storing it.\n\nThe operating policy is a threshold policy based on comparing this opportunity cost with the marginal value of water stored for future use, $\\beta(S_t)$. The future value function is approximated as a piecewise-linear convex function of storage $S_t$, resulting in two marginal values: $\\beta_{\\text{low}}$ for when storage is scarce ($S_t < S_{\\text{split}}$) and $\\beta_{\\text{high}}$ otherwise ($S_t \\ge S_{\\text{split}}$), with $\\beta_{\\text{low}} > \\beta_{\\text{high}}$.\n\nThe decision rule for each period $t$ is as follows:\n1.  **If $p_t E_{\\text{per } m^3} \\ge \\beta(S_t)$:** The immediate revenue from generation is greater than or equal to the expected future value of water. The policy is to **release** the maximum feasible amount of water.\n2.  **If $p_t E_{\\text{per } m^3} < \\beta(S_t)$:** The future value of water is higher than the immediate revenue. The policy is to **store** water by releasing the minimum feasible amount.\n\nTo implement this, we must precisely define the \"maximum\" and \"minimum\" feasible releases, which are governed by physical constraints. Let $S_t$ be the storage at the start of period $t$ and $I_t$ be the inflow during period $t$.\n\nThe constraints are:\n- Reservoir capacity: $V_{\\min} \\le S_{t+1} \\le V_{\\max}$.\n- Turbine capacity: $R_t \\le R_{\\max}$.\n- Environmental flow: $R_t \\ge R_{\\min}$ (if sufficient water is available).\n\nFrom these, we derive the operational release bounds:\n- **Maximum Feasible Release ($R_{t, \\text{upper}}$):** This is limited by the turbine capacity $R_{\\max}$ and the amount of water available without violating the minimum end-of-period storage, $V_{\\min}$. The water available is $S_t + I_t - V_{\\min}$. Since release cannot be negative, we have:\n$$ R_{t, \\text{upper}} = \\max\\{0, \\min\\{R_{\\max}, S_t + I_t - V_{\\min}\\}\\} $$\n- **Minimum Feasible Release ($R_{t, \\text{lower}}$):** This is determined by the environmental minimum $R_{\\min}$, but only if it can be satisfied without violating $V_{\\min}$. If not, the release is limited to the available water. This gives a base minimum release:\n$$ R_{t, \\text{lower\\_base}} = \\max\\{0, \\min\\{R_{\\min}, S_t + I_t - V_{\\min}\\}\\} $$\nFurthermore, when storing water, we must avoid spilling if possible. To prevent the next storage level $S_{t+1}$ from exceeding $V_{\\max}$, the release $R_t$ must satisfy $S_t + I_t - R_t \\le V_{\\max}$, which implies $R_t \\ge S_t + I_t - V_{\\max}$. This defines a spill-avoidance minimum release:\n$$ R_{t, \\text{spill\\_avoid}} = \\max\\{0, S_t + I_t - V_{\\max}\\} $$\nThe final release in the **store** case must satisfy both minimums, while not exceeding the maximum feasible release:\n$$ R_t^{\\text{store}} = \\min\\{R_{t, \\text{upper}}, \\max\\{R_{t, \\text{lower\\_base}}, R_{t, \\text{spill\\_avoid}}\\}\\} $$\n\nThe simulation proceeds iteratively for each period $t=0, \\dots, T-1$:\n1.  Given the state $S_t$ and parameters for period $t$ (inflow $I_t$, price $p_t$), determine the marginal water value $\\beta(S_t)$.\n2.  Calculate the opportunity cost of generation, $C_g = p_t E_{\\text{per } m^3}$.\n3.  Apply the decision rule: If $C_g \\ge \\beta(S_t)$, set $R_t = R_{t, \\text{upper}}$; otherwise, set $R_t = R_t^{\\text{store}}$.\n4.  Calculate the period's revenue: $\\text{Revenue}_t = C_g \\cdot R_t$.\n5.  Update the reservoir state. The potential next storage is $S'_{t+1} = S_t + I_t - R_t$.\n6.  Calculate spillage for the period: $\\text{spill}_t = \\max\\{0, S'_{t+1} - V_{\\max}\\}$.\n7.  The actual storage for the next period is then bounded by the reservoir limits: $S_{t+1} = \\min\\{V_{\\max}, \\max\\{V_{\\min}, S'_{t+1}\\}\\}$.\n8.  Accumulate total revenue and total spillage over the $T$ periods.\n\nThis simulation is performed for each of the three drought scenarios (mild, severe, extreme), which are defined by scaling a baseline inflow vector. For each test case, the worst-case revenue is the minimum of the total revenues across the three scenarios, and the worst-case total spillage is the maximum of the total spillages. The procedure is repeated for all three test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the stress test for the hydropower system.\n    It sets up constants, defines test cases, runs simulations for each\n    drought scenario, and calculates the worst-case outcomes.\n    \"\"\"\n\n    # Physical and conversion constants\n    RHO = 1000.0  # Water density in kg/m^3\n    G = 9.81      # Gravitational acceleration in m/s^2\n    H = 150.0     # Effective hydraulic head in m\n    ETA = 0.9     # Turbine-generator efficiency\n    E_PER_M3 = (RHO * G * H * ETA) / 3.6e9  # MWh per m^3\n\n    # Simulation parameters\n    T = 6  # Number of periods\n    BASELINE_INFLOWS = np.array([2.0e6, 1.8e6, 1.5e6, 1.3e6, 1.1e6, 0.9e6])\n    DROUGHT_MULTIPLIERS = [0.5, 0.2, 0.05]  # Mild, Severe, Extreme\n\n    # Test suite and parameterization\n    test_cases = [\n        # Case 1\n        {\n            \"prices\": np.array([40, 45, 50, 55, 50, 45]),\n            \"V_min\": 1.0e6, \"V_max\": 6.0e6, \"R_max\": 1.5e6, \"R_min\": 0.2e6,\n            \"S_0\": 3.0e6, \"S_split\": 3.0e6, \"beta_low\": 0.03, \"beta_high\": 0.012\n        },\n        # Case 2\n        {\n            \"prices\": np.array([30, 80, 90, 70, 40, 35]),\n            \"V_min\": 1.0e6, \"V_max\": 6.0e6, \"R_max\": 2.0e6, \"R_min\": 0.2e6,\n            \"S_0\": 5.0e6, \"S_split\": 4.0e6, \"beta_low\": 0.025, \"beta_high\": 0.011\n        },\n        # Case 3\n        {\n            \"prices\": np.array([20, 25, 22, 24, 23, 21]),\n            \"V_min\": 1.0e6, \"V_max\": 6.0e6, \"R_max\": 1.2e6, \"R_min\": 0.15e6,\n            \"S_0\": 2.0e6, \"S_split\": 2.5e6, \"beta_low\": 0.035, \"beta_high\": 0.015\n        }\n    ]\n\n    final_results = []\n    for case_params in test_cases:\n        scenario_revenues = []\n        scenario_spills = []\n\n        for multiplier in DROUGHT_MULTIPLIERS:\n            inflows = BASELINE_INFLOWS * multiplier\n            total_revenue, total_spill = run_simulation(case_params, inflows, E_PER_M3, T)\n            scenario_revenues.append(total_revenue)\n            scenario_spills.append(total_spill)\n\n        worst_revenue = min(scenario_revenues)\n        worst_spill = max(scenario_spills)\n        final_results.append([worst_revenue, worst_spill])\n\n    # Format and print the final output as a single-line string\n    pairs = [f\"[{rev},{spill}]\" for rev, spill in final_results]\n    print(f\"[{','.join(pairs)}]\")\n\ndef run_simulation(params, inflows, e_per_m3, T):\n    \"\"\"\n    Simulates the reservoir operation for one scenario over T periods.\n\n    Args:\n        params (dict): A dictionary containing all parameters for the test case.\n        inflows (np.array): The vector of inflows for the simulation horizon.\n        e_per_m3 (float): Energy conversion factor (MWh/m^3).\n        T (int): The number of periods in the simulation horizon.\n\n    Returns:\n        tuple: A pair of (total_revenue, total_spill) for the scenario.\n    \"\"\"\n    # Unpack parameters for readability\n    prices = params[\"prices\"]\n    V_min, V_max = params[\"V_min\"], params[\"V_max\"]\n    R_max, R_min = params[\"R_max\"], params[\"R_min\"]\n    S_split, beta_low, beta_high = params[\"S_split\"], params[\"beta_low\"], params[\"beta_high\"]\n\n    S_t = params[\"S_0\"]  # Initial storage\n    total_revenue = 0.0\n    total_spill = 0.0\n\n    for t in range(T):\n        I_t = inflows[t]\n        p_t = prices[t]\n\n        # 1. Determine marginal water value based on current storage\n        beta_St = beta_low if S_t  S_split else beta_high\n\n        # 2. Calculate opportunity cost of generation\n        Cg_t = p_t * e_per_m3\n\n        # 3. Calculate release bounds\n        water_available = S_t + I_t - V_min\n        R_t_upper = max(0.0, min(R_max, water_available))\n        R_t_lower_base = max(0.0, min(R_min, water_available))\n        R_t_spill_avoid = max(0.0, S_t + I_t - V_max)\n\n        # 4. Determine release R_t based on the threshold policy\n        if Cg_t >= beta_St:\n            # Release policy: discharge at maximum feasible rate\n            R_t = R_t_upper\n        else:\n            # Store policy: discharge at minimum feasible rate, avoiding spill if possible\n            R_t = min(R_t_upper, max(R_t_lower_base, R_t_spill_avoid))\n\n        # 5. Calculate period revenue\n        total_revenue += Cg_t * R_t\n        \n        # 6. Update state (storage and spillage)\n        S_prime_tp1 = S_t + I_t - R_t  # Potential storage before bounding\n        \n        spill_t = max(0.0, S_prime_tp1 - V_max)\n        total_spill += spill_t\n        \n        S_t = min(V_max, max(V_min, S_prime_tp1)) # Actual next-period storage\n        \n    return total_revenue, total_spill\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}