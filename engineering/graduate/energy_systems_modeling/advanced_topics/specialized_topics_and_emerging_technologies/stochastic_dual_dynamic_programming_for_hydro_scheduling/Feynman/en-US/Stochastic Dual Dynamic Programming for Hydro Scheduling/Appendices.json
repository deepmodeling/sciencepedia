{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any hydro scheduling model is an accurate representation of the physical system. At its heart, this involves applying the principle of mass conservation to track the volume of water in a reservoir over time. This first exercise  grounds you in this fundamental concept by tasking you with building the state transition equation, a critical component of any dynamic programming framework. By calculating the next-stage storage based on various inflows and outflows, you will also practice the essential unit conversions that are ubiquitous in energy systems modeling.",
            "id": "4125511",
            "problem": "Consider a single-reservoir hydro system modeled within Stochastic Dual Dynamic Programming (SDDP). At stage $t$, the reservoir storage state variable is $s_{t}$, expressed in $\\text{hm}^{3}$, and the system experiences inflow $a_{t}$, turbine discharge $q_{t}$, uncontrolled spill $\\text{spill}_{t}$, and evaporation $e_{t}$, all expressed in $\\text{m}^{3}/\\text{s}$. The decision period has duration $\\Delta t$ hours, and the balance of water over the control volume is governed by mass conservation. The next-stage storage $s_{t+1}$ is determined by integrating the net volumetric flow over the decision period and converting to the storage unit $\\text{hm}^{3}$, using the fact that $1 \\text{ hm}^{3} = 10^{6} \\text{ m}^{3}$. The feasible storage region is defined by bounds $s_{\\min}$ and $s_{\\max}$.\n\nUsing the mass conservation principle as the fundamental base and the discrete-time accumulation over the period $\\Delta t$, derive the storage transition and compute the next-stage storage for the following data: $s_{t}=90 \\text{ hm}^{3}$, $a_{t}=12 \\text{ m}^{3}/\\text{s}$, $q_{t}=30 \\text{ m}^{3}/\\text{s}$, $\\text{spill}_{t}=5 \\text{ m}^{3}/\\text{s}$, $e_{t}=1 \\text{ m}^{3}/\\text{s}$, and $\\Delta t=3$ h. Check the feasibility of $s_{t+1}$ against the bounds $s_{\\min}=50 \\text{ hm}^{3}$ and $s_{\\max}=120 \\text{ hm}^{3}$.\n\nReport your final answer as a row matrix containing two entries: the value of $s_{t+1}$ (expressed in $\\text{hm}^{3}$ and rounded to four significant figures) and a feasibility indicator equal to $1$ if $s_{\\min} \\leq s_{t+1} \\leq s_{\\max}$ and $0$ otherwise.",
            "solution": "The problem is valid as it is scientifically grounded in the principle of mass conservation, is well-posed with all necessary data provided, and is expressed in objective, formal language. We proceed with the solution.\n\nThe core of the problem lies in establishing the storage transition equation for the reservoir based on the principle of mass conservation. This principle states that the rate of change of the volume of water within a control volume is equal to the net rate of volumetric flow into that volume.\n\nLet $V(t)$ represent the volume of water in the reservoir at time $t$, expressed in cubic meters ($\\text{m}^3$). The state variable $s_t$ is the storage in hectometers cubed ($\\text{hm}^3$) at the beginning of the decision period $t$. The relationship between these two quantities is given by the conversion factor $1 \\text{ hm}^3 = 10^6 \\text{ m}^3$. Therefore, the initial volume at the start of stage $t$ is $V_t = s_t \\times 10^6$.\n\nThe rates of flow into and out of the reservoir are given in $\\text{m}^3/\\text{s}$. The total inflow rate is $a_t$. The total outflow rate is the sum of turbine discharge $q_t$, uncontrolled spill $\\text{spill}_t$, and evaporation $e_t$. The net flow rate, $f_{\\text{net}}$, into the reservoir is thus:\n$$f_{\\text{net}} = a_t - (q_t + \\text{spill}_t + e_t)$$\n\nAssuming these flow rates are constant throughout the decision period of duration $\\Delta t$, the change in reservoir volume, $\\Delta V$, is the product of the net flow rate and the duration of the period. Crucially, the units must be consistent. The flow rates are in $\\text{m}^3/\\text{s}$, so the time duration must be in seconds.\nThe duration is given as $\\Delta t$ in hours. To convert hours to seconds, we use the conversion factor $1 \\text{ h} = 3600 \\text{ s}$. Let $\\Delta t_{\\text{sec}}$ be the duration in seconds:\n$$\\Delta t_{\\text{sec}} = \\Delta t \\times 3600$$\n\nThe change in volume $\\Delta V$ over the period is:\n$$\\Delta V = f_{\\text{net}} \\times \\Delta t_{\\text{sec}} = (a_t - q_t - \\text{spill}_t - e_t) \\times (\\Delta t \\times 3600)$$\nThis change $\\Delta V$ is in $\\text{m}^3$.\n\nThe storage at the next stage, $s_{t+1}$, is the initial storage $s_t$ plus the change in storage, $\\Delta s$. The change in storage must be converted from $\\text{m}^3$ to $\\text{hm}^3$:\n$$\\Delta s = \\frac{\\Delta V}{10^6} = \\frac{(a_t - q_t - \\text{spill}_t - e_t) \\times \\Delta t \\times 3600}{10^6}$$\nThe storage transition equation is therefore:\n$$s_{t+1} = s_t + \\Delta s = s_t + \\frac{(a_t - q_t - \\text{spill}_t - e_t) \\times \\Delta t \\times 3600}{10^6}$$\n\nNow, we substitute the given numerical values into this equation:\n- Initial storage: $s_t = 90 \\text{ hm}^3$\n- Inflow: $a_t = 12 \\text{ m}^3/\\text{s}$\n- Turbine discharge: $q_t = 30 \\text{ m}^3/\\text{s}$\n- Uncontrolled spill: $\\text{spill}_t = 5 \\text{ m}^3/\\text{s}$\n- Evaporation: $e_t = 1 \\text{ m}^3/\\text{s}$\n- Time duration: $\\Delta t = 3 \\text{ h}$\n\nFirst, we calculate the net flow rate $f_{\\text{net}}$:\n$$f_{\\text{net}} = 12 - (30 + 5 + 1) = 12 - 36 = -24 \\text{ m}^3/\\text{s}$$\nA negative value indicates a net outflow of water from the reservoir.\n\nNext, we calculate the change in storage $\\Delta s$ in $\\text{hm}^3$:\n$$\\Delta s = \\frac{(-24 \\text{ m}^3/\\text{s}) \\times (3 \\text{ h} \\times 3600 \\text{ s/h})}{10^6 \\text{ m}^3/\\text{hm}^3}$$\n$$\\Delta s = \\frac{-24 \\times 10800}{10^6} = \\frac{-259200}{1000000} = -0.2592 \\text{ hm}^3$$\n\nFinally, we compute the storage at the next stage, $s_{t+1}$:\n$$s_{t+1} = s_t + \\Delta s = 90 + (-0.2592) = 89.7408 \\text{ hm}^3$$\nThe problem requires this value to be rounded to four significant figures.\n$$s_{t+1} \\approx 89.74 \\text{ hm}^3$$\n\nThe second part of the task is to check the feasibility of this resulting storage level against the given bounds:\n- Minimum storage: $s_{\\min} = 50 \\text{ hm}^3$\n- Maximum storage: $s_{\\max} = 120 \\text{ hm}^3$\n\nWe must verify if $s_{\\min} \\leq s_{t+1} \\leq s_{\\max}$:\n$$50 \\leq 89.7408 \\leq 120$$\nThis inequality is true. Therefore, the resulting storage is feasible. The feasibility indicator is $1$.\n\nThe final answer is a row matrix containing the rounded value of $s_{t+1}$ and the feasibility indicator.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n89.74 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The \"dynamic programming\" in SDDP involves making an optimal decision at each stage that balances immediate costs against the future consequences of that decision. These future consequences are neatly summarized by the cost-to-go function, whose slope—the marginal water value—acts as the shadow price of water. This practice  places you in the role of a system operator for a single time step, performing an economic dispatch between hydropower and a thermal generator. By using the marginal water value to make the optimal trade-off, you will uncover the core economic logic that drives the entire scheduling process.",
            "id": "4125540",
            "problem": "Consider a single stage of a hydro-thermal scheduling problem solved by Stochastic Dual Dynamic Programming (SDDP). At the current stage, the system operator chooses hydro generation $P_{t}$ and thermal generation $P_{t}^{\\text{thermal}}$ to satisfy the deterministic power balance $P_{t} + P_{t}^{\\text{thermal}} = D_{t}$. The demand is $D_{t} = 100$ MW. The thermal unit has linear variable cost $c^{\\text{th}} = 30$ $/MWh$. The marginal water opportunity cost (i.e., the subgradient of the current cost-to-go cut with respect to storage translated into energy units) is $\\pi_{t} = 60$ $/MWh$. Assume no ramping or capacity limits and that feasibility is guaranteed.\n\nUsing only fundamental principles of dynamic programming and convex optimization, formulate the one-stage economic dispatch that minimizes the sum of immediate thermal production cost and the opportunity cost of using hydro energy at price $\\pi_{t}$, subject to the power balance and nonnegativity. Derive the first-order optimality conditions and use them to determine the optimal hydro dispatch $P_{t}^{\\star}$. Express your final answer as a single real number in MW. No rounding is required. Report only $P_{t}^{\\star}$ in MW.",
            "solution": "The problem asks for the optimal hydro generation $P_{t}^{\\star}$ for a single-stage economic dispatch problem within a Stochastic Dual Dynamic Programming (SDDP) framework. The solution is derived from the fundamental principles of convex optimization.\n\nFirst, we formulate the optimization problem. The objective is to minimize the total system cost for the current stage, $t$. This cost is the sum of the immediate thermal generation cost and the opportunity cost of dispatching hydro energy. The opportunity cost represents the expected future cost incurred by using water now instead of saving it for later, and it is given by the marginal water value, $\\pi_{t}$.\n\nThe decision variables are the hydro generation, $P_{t}$, and the thermal generation, $P_{t}^{\\text{thermal}}$. Both are measured in MW.\n\nThe total cost, $C(P_{t}, P_{t}^{\\text{thermal}})$, for one hour of operation is given by:\n$$C(P_{t}, P_{t}^{\\text{thermal}}) = c^{\\text{th}} \\cdot P_{t}^{\\text{thermal}} + \\pi_{t} \\cdot P_{t}$$\nwhere $c^{\\text{th}}$ is the variable cost of the thermal unit and $\\pi_{t}$ is the marginal opportunity cost of water.\n\nThe system is subject to the following constraints:\n1.  **Power Balance:** The total generation must meet the demand $D_{t}$.\n    $$P_{t} + P_{t}^{\\text{thermal}} = D_{t}$$\n2.  **Non-negativity:** Generation cannot be negative.\n    $$P_{t} \\ge 0$$\n    $$P_{t}^{\\text{thermal}} \\ge 0$$\nThe problem states that there are no capacity or ramping limits.\n\nWe can simplify the problem by substituting the power balance constraint into the objective function. From the power balance, we have $P_{t}^{\\text{thermal}} = D_{t} - P_{t}$. Substituting this into the cost function yields an objective function solely in terms of $P_{t}$:\n$$f(P_{t}) = c^{\\text{th}} (D_{t} - P_{t}) + \\pi_{t} P_{t}$$\n$$f(P_{t}) = c^{\\text{th}} D_{t} - c^{\\text{th}} P_{t} + \\pi_{t} P_{t}$$\n$$f(P_{t}) = c^{\\text{th}} D_{t} + (\\pi_{t} - c^{\\text{th}}) P_{t}$$\n\nThe non-negativity constraint $P_{t}^{\\text{thermal}} \\ge 0$ implies $D_{t} - P_{t} \\ge 0$, which means $P_{t} \\le D_{t}$. Combined with $P_{t} \\ge 0$, the feasible range for the hydro dispatch is $0 \\le P_{t} \\le D_{t}$.\n\nThe optimization problem is now reduced to:\n$$\\min_{P_{t}} \\quad c^{\\text{th}} D_{t} + (\\pi_{t} - c^{\\text{th}}) P_{t}$$\nSubject to:\n$$0 \\le P_{t} \\le D_{t}$$\n\nThis is a linear programming problem. The term $c^{\\text{th}} D_{t}$ is a constant with respect to the decision variable $P_{t}$, so it does not affect the optimal solution. The solution is determined by the sign of the coefficient of $P_{t}$, which is $(\\pi_{t} - c^{\\text{th}})$.\n\nLet's substitute the given values:\n-   Demand: $D_{t} = 100$ MW\n-   Thermal cost: $c^{\\text{th}} = 30$ $/MWh$\n-   Marginal water value: $\\pi_{t} = 60$ $/MWh$\n\nThe coefficient is $(\\pi_{t} - c^{\\text{th}}) = 60 - 30 = 30$. Since this coefficient is positive, to minimize the objective function, we must choose the smallest possible value for $P_{t}$ within its feasible range. The feasible range is $[0, 100]$. The minimum value is $0$.\nTherefore, the optimal hydro dispatch is $P_{t}^{\\star} = 0$ MW. This implies that the entire demand should be met by the cheaper thermal generation, $P_{t}^{\\text{thermal}\\star} = 100$ MW.\n\nTo confirm this result using first-order optimality conditions, as requested, we formulate the Karush-Kuhn-Tucker (KKT) conditions for the original problem.\nThe problem is:\n$$\\min_{P_t, P_t^{\\text{thermal}}} \\quad c^{\\text{th}} P_t^{\\text{thermal}} + \\pi_t P_t$$\nSubject to:\n1.  $P_t + P_t^{\\text{thermal}} - D_t = 0 \\quad (\\text{with multiplier } \\lambda)$\n2.  $-P_t \\le 0 \\quad (\\text{with multiplier } \\mu_1)$\n3.  $-P_t^{\\text{thermal}} \\le 0 \\quad (\\text{with multiplier } \\mu_2)$\n\nThe Lagrangian function $\\mathcal{L}$ is:\n$$\\mathcal{L}(P_t, P_t^{\\text{thermal}}, \\lambda, \\mu_1, \\mu_2) = c^{\\text{th}} P_t^{\\text{thermal}} + \\pi_t P_t - \\lambda(P_t + P_t^{\\text{thermal}} - D_t) - \\mu_1 P_t - \\mu_2 P_t^{\\text{thermal}}$$\nThe KKT conditions for optimality are:\n\n1.  **Stationarity:**\n    $$\\frac{\\partial \\mathcal{L}}{\\partial P_t} = \\pi_t - \\lambda - \\mu_1 = 0 \\implies \\lambda = \\pi_t - \\mu_1$$\n    $$\\frac{\\partial \\mathcal{L}}{\\partial P_t^{\\text{thermal}}} = c^{\\text{th}} - \\lambda - \\mu_2 = 0 \\implies \\lambda = c^{\\text{th}} - \\mu_2$$\n2.  **Primal Feasibility:**\n    $$P_t + P_t^{\\text{thermal}} = D_t$$\n    $$P_t \\ge 0, \\quad P_t^{\\text{thermal}} \\ge 0$$\n3.  **Dual Feasibility:**\n    $$\\mu_1 \\ge 0, \\quad \\mu_2 \\ge 0$$\n4.  **Complementary Slackness:**\n    $$\\mu_1 P_t = 0$$\n    $$\\mu_2 P_t^{\\text{thermal}} = 0$$\n\nFrom the stationarity conditions, we equate the expressions for $\\lambda$:\n$$\\pi_t - \\mu_1 = c^{\\text{th}} - \\mu_2$$\n$$\\pi_t - c^{\\text{th}} = \\mu_1 - \\mu_2$$\nSubstituting the given values, $c^{\\text{th}} = 30$ and $\\pi_{t} = 60$:\n$$60 - 30 = \\mu_1 - \\mu_2 \\implies 30 = \\mu_1 - \\mu_2$$\nThis implies $\\mu_1 = \\mu_2 + 30$. Since $\\mu_2 \\ge 0$ (dual feasibility), it must be that $\\mu_1 \\ge 30$.\nBecause $\\mu_1$ is strictly positive ($\\mu_1 > 0$), the complementary slackness condition $\\mu_1 P_t = 0$ requires that $P_t = 0$.\n\nLet's check for consistency. The optimal hydro dispatch is $P_{t}^{\\star} = 0$.\n-   From the power balance, $P_{t}^{\\text{thermal}\\star} = D_t - P_{t}^{\\star} = 100 - 0 = 100$.\n-   Both $P_{t}^{\\star} = 0$ and $P_{t}^{\\text{thermal}\\star} = 100$ satisfy the non-negativity constraints.\n-   Since $P_{t}^{\\text{thermal}\\star} = 100 > 0$, the complementary slackness condition $\\mu_2 P_t^{\\text{thermal}} = 0$ requires that $\\mu_2 = 0$.\n-   Using $\\mu_1 = \\mu_2 + 30$, we find $\\mu_1 = 0 + 30 = 30$. This satisfies dual feasibility ($\\mu_1 \\ge 0$).\n-   The system marginal price, $\\lambda$, can be calculated from either stationarity condition:\n    $$\\lambda = c^{\\text{th}} - \\mu_2 = 30 - 0 = 30$$\n    $$\\lambda = \\pi_t - \\mu_1 = 60 - 30 = 30$$\nThe value of $\\lambda$ is consistent. All KKT conditions are satisfied.\nThe economic interpretation is that the marginal cost of hydro energy ($\\pi_t = 60$ $/MWh) is greater than the marginal cost of thermal energy ($c^{\\text{th}} = 30$ $/MWh). Therefore, the system operator minimizes cost by dispatching the cheapest available resource, which is the thermal unit, to meet the entire demand. The more expensive hydro resource is not dispatched.\n\nThe optimal hydro dispatch is $P_{t}^{\\star} = 0$ MW.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Why use a complex stochastic method like SDDP when a simpler deterministic model using average inflows might seem sufficient? The answer lies in the value of correctly managing risk and preserving flexibility in the face of an uncertain future. This final exercise  provides a powerful, concrete demonstration of this principle by asking you to compute the Value of the Stochastic Solution (VSS). By quantifying the economic benefit of the stochastic approach over a deterministic one, you will solidify your understanding of why explicitly modeling uncertainty leads to more robust and cost-effective operational strategies.",
            "id": "4125539",
            "problem": "Consider a two-stage hydrothermal scheduling problem suitable for solution by Stochastic Dual Dynamic Programming (SDDP), with uncertain inflow in the second stage. A single reservoir with constant head produces electric energy with a conversion factor of $1$ megawatt-hour per unit of water released. The objective is to minimize the expected thermal generation cost over the two stages. The system data are as follows:\n- Initial storage is $S_{0} = 4$.\n- Stage $1$ demand is $D_{1} = 6$.\n- Stage $2$ demand is $D_{2} = 6$.\n- Thermal generation costs are $c_{1} = 30$ in stage $1$ and $c_{2} = 80$ in stage $2$ (units are dollars per megawatt-hour).\n- Release limits are $0 \\le r_{t} \\le R_{\\max}$ with $R_{\\max} = 6$ for $t \\in \\{1,2\\}$.\n- Stage $1$ inflow is $0$.\n- Stage $2$ inflow $\\tilde{I}_{2}$ is uncertain with two equiprobable scenarios: a low inflow $I_{2}^{\\mathrm{L}} = 0$ with probability $p^{\\mathrm{L}} = \\frac{1}{2}$, and a high inflow $I_{2}^{\\mathrm{H}} = 6$ with probability $p^{\\mathrm{H}} = \\frac{1}{2}$. There is no end-of-horizon salvage value of water and no spillage penalty.\n- Hydropower and thermal generation are perfectly substitutable to meet demand, with energy balance constraints $r_{t} + g_{t} = D_{t}$ for $t \\in \\{1,2\\}$, and nonnegativity constraints $g_{t} \\ge 0$.\n\nLet the policy derived from the full stochastic problem (the Recourse Problem) be called the stochastic policy, and let the deterministic expected value solution be defined by replacing $\\tilde{I}_{2}$ with its expectation $\\mathbb{E}[\\tilde{I}_{2}]$ and solving the resulting deterministic two-stage problem to obtain a first-stage decision, which is then implemented in the stochastic world with optimal second-stage recourse.\n\nTask:\n1. Define the Value of the Stochastic Solution (VSS) for this minimization problem in terms of expected total costs under the stochastic policy versus the deterministic expected value policy implemented with recourse.\n2. Compute the VSS for the given data by:\n   - Solving for the optimal first-stage release under the stochastic policy and computing its expected total cost.\n   - Solving for the optimal first-stage release under the deterministic expected value formulation and computing the expected total cost when this first-stage decision is implemented in the stochastic world with optimal recourse.\n   - Taking the difference according to your definition of VSS.\nExpress the final VSS value in dollars and provide a single real number. If any approximation is needed, round to four significant figures. No approximation is needed for the provided data.",
            "solution": "The user has provided a well-posed problem in the domain of stochastic optimization for energy systems. I will proceed with a formal solution.\n\n### Step 1: Problem Validation\n\n**1.1. Extracted Givens**\n- System: Two-stage hydrothermal scheduling problem.\n- Objective: Minimize the expected total thermal generation cost.\n- Initial storage: $S_{0} = 4$.\n- Stage $1$ demand: $D_{1} = 6$.\n- Stage $2$ demand: $D_{2} = 6$.\n- Thermal generation cost, stage $1$: $c_{1} = 30$.\n- Thermal generation cost, stage $2$: $c_{2} = 80$.\n- Hydropower energy conversion factor: $1$ MWh per unit of water.\n- Release limits: $0 \\le r_{t} \\le R_{\\max}$ with $R_{\\max} = 6$ for $t \\in \\{1,2\\}$.\n- Stage $1$ inflow: $I_{1} = 0$.\n- Stage $2$ uncertain inflow $\\tilde{I}_{2}$:\n    - Scenario Low (L): $I_{2}^{\\mathrm{L}} = 0$ with probability $p^{\\mathrm{L}} = \\frac{1}{2}$.\n    - Scenario High (H): $I_{2}^{\\mathrm{H}} = 6$ with probability $p^{\\mathrm{H}} = \\frac{1}{2}$.\n- Energy balance: $r_{t} + g_{t} = D_{t}$ for $t \\in \\{1,2\\}$, with thermal generation $g_{t} \\ge 0$.\n- No end-of-horizon salvage value or spillage penalty.\n\nIn addition to the explicit constraints, a fundamental physical constraint is that water release cannot exceed the available water in the reservoir.\nFor stage $1$, this implies $r_{1} \\le S_{0} + I_{1}$. Given $S_{0}=4$ and $I_{1}=0$, we have $r_{1} \\le 4$. Combining with the given release limit $r_{1} \\le 6$ and the non-negativity of thermal generation $g_{1} = D_{1} - r_{1} = 6 - r_{1} \\ge 0 \\implies r_{1} \\le 6$, the effective constraint on the first-stage release is $0 \\le r_{1} \\le 4$.\n\n**1.2. Validation Verdict**\nThe problem is scientifically grounded as a standard exercise in stochastic optimization for power systems. It is well-posed, objective, and self-contained, with all necessary data provided and no internal contradictions. Therefore, the problem is **valid**.\n\n### Step 2: Definition of the Value of the Stochastic Solution (VSS)\n\nThe Value of the Stochastic Solution (VSS) quantifies the benefit of solving the full stochastic problem over a deterministic simplification. For this minimization problem, it is defined as the difference between the expected cost of the deterministic policy and the expected cost of the optimal stochastic policy.\n\nLet $Z_{\\mathrm{RP}}$ be the optimal expected cost of the Recourse Problem (the full stochastic problem). This is the minimum achievable expected cost.\nLet the Expected Value (EV) problem be the deterministic problem where the random variable $\\tilde{I}_{2}$ is replaced by its expectation, $\\mathbb{E}[\\tilde{I}_{2}]$. Let the optimal first-stage decision of the EV problem be $r_{1}^{\\mathrm{EV}}$.\nThe Expected cost of the Expected Value solution (EEV) is the cost incurred when the decision $r_{1}^{\\mathrm{EV}}$ is implemented in the true stochastic environment, with optimal recourse (actions) in the second stage.\n\nThe VSS is then defined as:\n$$\n\\mathrm{VSS} = \\mathrm{EEV} - Z_{\\mathrm{RP}}\n$$\nBy construction, $\\mathrm{VSS} \\ge 0$.\n\n### Step 3: Computation of the VSS\n\n**3.1. Solving the Recourse Problem (RP) for $Z_{\\mathrm{RP}}$**\n\nWe use stochastic dynamic programming. The method proceeds backward from the final stage.\n\n**Stage 2:**\nFor a given starting storage $S_{1}$ and inflow scenario $s \\in \\{\\mathrm{L}, \\mathrm{H}\\}$, the objective is to minimize the stage $2$ cost, $C_{2}^{s} = c_{2} g_{2}^{s}$.\nThis is equivalent to maximizing the hydro release $r_{2}^{s}$, since $g_{2}^{s} = D_{2} - r_{2}^{s} = 6 - r_{2}^{s}$.\nThe release $r_{2}^{s}$ is constrained by the turbine capacity $R_{\\max}=6$ and water availability $S_{1} + I_{2}^{s}$.\nThus, the optimal release is $r_{2}^{s,*} = \\min(R_{\\max}, S_{1} + I_{2}^{s}) = \\min(6, S_{1} + I_{2}^{s})$.\nThe optimal generation is $g_{2}^{s,*} = 6 - r_{2}^{s,*}$.\nThe minimum stage $2$ cost for a given $S_1$ and scenario $s$ is $Q_{2}^{s}(S_{1}) = c_{2} g_{2}^{s,*} = 80 \\cdot (6 - \\min(6, S_{1} + I_{2}^{s})) = 80 \\cdot \\max(0, 6 - S_{1} - I_{2}^{s})$.\n\nThe expected future cost function, $\\mathcal{F}_{2}(S_1)$, as seen from stage $1$ is the expected value of these minimum costs over the scenarios:\n$\\mathcal{F}_{2}(S_1) = \\mathbb{E}[Q_{2}(\\tilde{I}_2, S_1)] = p^{\\mathrm{L}} Q_{2}^{\\mathrm{L}}(S_{1}) + p^{\\mathrm{H}} Q_{2}^{\\mathrm{H}}(S_{1})$\n$\\mathcal{F}_{2}(S_1) = \\frac{1}{2} \\cdot 80 \\cdot \\max(0, 6 - S_{1} - 0) + \\frac{1}{2} \\cdot 80 \\cdot \\max(0, 6 - S_{1} - 6)$\n$\\mathcal{F}_{2}(S_1) = 40 \\max(0, 6 - S_{1}) + 40 \\max(0, -S_{1})$.\n\n**Stage 1:**\nThe objective is to minimize the sum of the stage $1$ cost and the expected future cost:\n$J(r_{1}) = c_{1} g_{1} + \\mathcal{F}_{2}(S_{1})$\nThe state variable $S_{1}$ is determined by the stage $1$ release $r_{1}$: $S_{1} = S_{0} + I_{1} - r_{1} = 4 + 0 - r_{1} = 4 - r_{1}$.\nThe stage $1$ thermal generation is $g_{1} = D_{1} - r_{1} = 6 - r_{1}$.\nThe feasible range for $r_{1}$ is $[0, 4]$. For any $r_{1}$ in this range, $S_{1} = 4 - r_{1}$ is in $[0, 4]$.\nTherefore, $S_{1} \\ge 0 \\implies \\max(0, -S_{1}) = 0$, and $6-S_1 > 0 \\implies \\max(0, 6-S_1) = 6-S_1$.\nThe expected future cost simplifies to $\\mathcal{F}_{2}(S_1) = 40(6 - S_{1})$.\nSubstituting $S_{1} = 4 - r_{1}$: $\\mathcal{F}_{2}(4 - r_{1}) = 40(6 - (4 - r_{1})) = 40(2 + r_{1}) = 80 + 40r_{1}$.\nThe stage $1$ problem is to minimize:\n$J(r_{1}) = c_{1}(D_{1} - r_{1}) + 80 + 40r_{1}$\n$J(r_{1}) = 30(6 - r_{1}) + 80 + 40r_{1}$\n$J(r_{1}) = 180 - 30r_{1} + 80 + 40r_{1} = 260 + 10r_{1}$.\n\nTo minimize $J(r_{1})$ over the interval $r_{1} \\in [0, 4]$, we must choose the smallest possible value for $r_1$, as the cost function is strictly increasing.\nThe optimal first-stage release for the stochastic problem is $r_{1}^{\\mathrm{RP}} = 0$.\n\nThe minimum expected total cost, $Z_{\\mathrm{RP}}$, is $J(0) = 260 + 10(0) = 260$.\nSo, $Z_{\\mathrm{RP}} = 260$.\n\n**3.2. Solving for the EEV**\n\nFirst, we solve the deterministic Expected Value (EV) problem. We replace the random inflow $\\tilde{I}_{2}$ with its expected value:\n$\\mathbb{E}[\\tilde{I}_{2}] = p^{\\mathrm{L}} I_{2}^{\\mathrm{L}} + p^{\\mathrm{H}} I_{2}^{\\mathrm{H}} = \\frac{1}{2}(0) + \\frac{1}{2}(6) = 3$.\n\nThe EV problem is a deterministic two-stage problem:\nMinimize $C = c_{1}g_{1} + c_{2}g_{2} = 30(6 - r_{1}) + 80(6 - r_{2})$\nSubject to:\n$0 \\le r_{1} \\le 4$\n$S_{1} = 4 - r_{1}$\n$0 \\le r_{2} \\le \\min(R_{\\max}, S_{1} + \\mathbb{E}[\\tilde{I}_{2}]) = \\min(6, (4-r_1) + 3) = \\min(6, 7-r_1)$.\n\nTo minimize cost, we must decide how to allocate the total available water, $S_0 + I_1 + \\mathbb{E}[\\tilde{I}_{2}] = 4+0+3=7$ units, between the two stages. Water used in stage $1$ displaces generation costing $c_1=30$, while water used in stage $2$ displaces generation costing $c_2=80$. Since $c_2 > c_1$, water is more valuable in stage $2$. We should prioritize using water in stage $2$.\nThe maximum release in stage $2$ is $r_2=6$. To achieve this, we need $7-r_1 \\ge 6$, which implies $r_1 \\le 1$. We have $7$ units of water in total; if we use $6$ in stage $2$, we have $1$ unit left for stage $1$. This gives the candidate solution $(r_1, r_2) = (1, 6)$. This is feasible, as $0 \\le 1 \\le 4$.\nThis strategy maximizes the use of water in the more expensive period and must be optimal for the deterministic problem.\nThe optimal first-stage release for the EV problem is $r_{1}^{\\mathrm{EV}} = 1$.\n\nNow, we calculate the EEV by implementing $r_{1}^{\\mathrm{EV}} = 1$ in the true stochastic world.\n**Stage 1:**\n- Release: $r_{1} = 1$.\n- Thermal generation: $g_{1} = D_{1} - r_{1} = 6 - 1 = 5$.\n- Cost: $C_{1} = c_{1} g_{1} = 30 \\cdot 5 = 150$.\n- End-of-stage storage: $S_{1} = S_{0} - r_{1} = 4 - 1 = 3$.\n\n**Stage 2 (with optimal recourse):**\n- **Scenario L ($I_{2}^{\\mathrm{L}}=0$):**\n    - Water available: $S_{1} + I_{2}^{\\mathrm{L}} = 3 + 0 = 3$.\n    - Optimal release: $r_{2}^{\\mathrm{L}} = \\min(6, 3) = 3$.\n    - Thermal generation: $g_{2}^{\\mathrm{L}} = D_{2} - r_{2}^{\\mathrm{L}} = 6 - 3 = 3$.\n    - Cost: $C_{2}^{\\mathrm{L}} = c_{2} g_{2}^{\\mathrm{L}} = 80 \\cdot 3 = 240$.\n- **Scenario H ($I_{2}^{\\mathrm{H}}=6$):**\n    - Water available: $S_{1} + I_{2}^{\\mathrm{H}} = 3 + 6 = 9$.\n    - Optimal release: $r_{2}^{\\mathrm{H}} = \\min(6, 9) = 6$.\n    - Thermal generation: $g_{2}^{\\mathrm{H}} = D_{2} - r_{2}^{\\mathrm{H}} = 6 - 6 = 0$.\n    - Cost: $C_{2}^{\\mathrm{H}} = c_{2} g_{2}^{\\mathrm{H}} = 80 \\cdot 0 = 0$.\n\nThe expected stage $2$ cost is $\\mathbb{E}[C_{2}] = p^{\\mathrm{L}} C_{2}^{\\mathrm{L}} + p^{\\mathrm{H}} C_{2}^{\\mathrm{H}} = \\frac{1}{2}(240) + \\frac{1}{2}(0) = 120$.\nThe total expected cost of the EV policy (EEV) is:\n$\\mathrm{EEV} = C_{1} + \\mathbb{E}[C_{2}] = 150 + 120 = 270$.\n\n**3.3. Final VSS Calculation**\n\nUsing the definition of VSS:\n$\\mathrm{VSS} = \\mathrm{EEV} - Z_{\\mathrm{RP}} = 270 - 260 = 10$.\n\nThe Value of the Stochastic Solution is $10$ dollars. This indicates that explicitly modeling the uncertainty of inflow provides an expected cost saving of $10$ compared to a deterministic policy based on average inflows. The stochastic policy is more conservative (saving all water for the uncertain future) and performs better on average.",
            "answer": "$$\\boxed{10}$$"
        }
    ]
}