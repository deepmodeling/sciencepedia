{
    "hands_on_practices": [
        {
            "introduction": "Multi-scale modeling often begins with simplifying detailed subsystems to create computationally tractable representations. This exercise introduces the fundamental concept of spatial aggregation, where a complex network is reduced to a single equivalent component for use in a higher-level model . By calculating the equivalent impedance of parallel distribution feeders, you will practice a core technique used to interface detailed distribution models with coarse-grained transmission system simulations.",
            "id": "4106591",
            "problem": "A distribution substation is interfaced with a transmission-level dynamic model through an aggregated representation of downstream feeders to enable multi-scale coupling between transmission dynamics and distribution power flows. Three identical balanced three-phase feeders connect in parallel at the substation bus and supply a downstream district. Each feeder has a uniform per-phase series impedance per unit length given by $\\left(R,X\\right)=\\left(0.2,0.4\\right)\\,\\Omega/\\mathrm{km}$ at nominal frequency, and each feeder has length $5\\,\\mathrm{km}$. Assume quasi-static sinusoidal steady state, negligible shunt admittance, and per-phase analysis under balanced conditions so that the series impedance can be treated as lumped and linear. Using fundamental network combination principles derived from Kirchhoff's Current Law (KCL) and Kirchhoff's Voltage Law (KVL), aggregate the three parallel feeders into a single equivalent per-phase series impedance seen by the substation. Compute the effective resistance $R_{\\mathrm{eq}}$ and reactance $X_{\\mathrm{eq}}$ of this equivalent impedance using series-parallel equivalences. Express your final answer as a two-entry row matrix $\\left(R_{\\mathrm{eq}},X_{\\mathrm{eq}}\\right)$ in $\\Omega$. No rounding is required; provide exact values.",
            "solution": "The problem requires the calculation of an equivalent per-phase series impedance for three identical, parallel-connected distribution feeders. This is a standard problem in circuit theory applied to power systems analysis, specifically for model aggregation in multi-scale simulations.\n\nFirst, we validate the problem statement.\n\n**Step 1: Extract Givens**\n- Number of feeders: $3$\n- Feeder connection: Parallel\n- Feeder identity: All three feeders are identical.\n- Per-phase series impedance per unit length: $(R, X) = (0.2, 0.4) \\, \\Omega/\\mathrm{km}$\n- Length of each feeder: $L = 5 \\, \\mathrm{km}$\n- Assumptions: Quasi-static sinusoidal steady state, negligible shunt admittance, per-phase analysis under balanced conditions, lumped and linear series impedance.\n- Objective: Compute the effective resistance $R_{\\mathrm{eq}}$ and reactance $X_{\\mathrm{eq}}$ of the single equivalent per-phase series impedance.\n- Final answer format: Two-entry row matrix $(R_{\\mathrm{eq}}, X_{\\mathrm{eq}})$ in $\\Omega$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in the principles of electrical circuit theory (Ohm's Law, KCL, KVL) as applied to AC power systems. The concept of aggregating parallel feeders is a fundamental technique in creating reduced-order models for large-scale power system studies, which is a core part of multi-scale modeling. The provided physical parameters are realistic. The problem is well-posed, with all necessary information provided and no contradictions. The objective is clear and the language is precise. The problem is therefore deemed valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Solution Derivation**\n\nThe per-phase series impedance per unit length is given as a pair of values for resistance and reactance, $(R, X) = (0.2, 0.4) \\, \\Omega/\\mathrm{km}$. In complex number notation, this is represented as $z$:\n$$z = R + jX = 0.2 + j0.4 \\, \\frac{\\Omega}{\\mathrm{km}}$$\nwhere $j$ is the imaginary unit.\n\nEach feeder has a length $L = 5 \\, \\mathrm{km}$. Since the impedance is uniform and shunt admittance is negligible, the total series impedance of a single feeder, which we denote as $Z_{\\mathrm{feeder}}$, is the impedance per unit length multiplied by the total length of the feeder.\n$$Z_{\\mathrm{feeder}} = z \\times L$$\nSubstituting the given values:\n$$Z_{\\mathrm{feeder}} = (0.2 + j0.4) \\, \\frac{\\Omega}{\\mathrm{km}} \\times 5 \\, \\mathrm{km}$$\n$$Z_{\\mathrm{feeder}} = (5 \\times 0.2) + j(5 \\times 0.4) \\, \\Omega$$\n$$Z_{\\mathrm{feeder}} = 1 + j2 \\, \\Omega$$\nThis means that for a single feeder, the resistance is $R_{\\mathrm{feeder}} = 1 \\, \\Omega$ and the reactance is $X_{\\mathrm{feeder}} = 2 \\, \\Omega$.\n\nThe problem states that there are three identical feeders connected in parallel at the substation bus. The equivalent impedance, $Z_{\\mathrm{eq}}$, of $N$ identical impedances $Z$ connected in parallel is given by the formula:\n$$Z_{\\mathrm{eq}} = \\frac{Z}{N}$$\nThis formula can be derived from the general rule for parallel admittances. The admittance $Y$ is the reciprocal of impedance $Z$, i.e., $Y = \\frac{1}{Z}$. For parallel components, the total admittance is the sum of the individual admittances:\n$$Y_{\\mathrm{eq}} = \\sum_{i=1}^{N} Y_i$$\nSince all feeders are identical, $Y_i = Y_{\\mathrm{feeder}} = \\frac{1}{Z_{\\mathrm{feeder}}}$ for all $i$.\n$$Y_{\\mathrm{eq}} = N \\times Y_{\\mathrm{feeder}} = \\frac{N}{Z_{\\mathrm{feeder}}}$$\nThe equivalent impedance is the reciprocal of the equivalent admittance:\n$$Z_{\\mathrm{eq}} = \\frac{1}{Y_{\\mathrm{eq}}} = \\frac{Z_{\\mathrm{feeder}}}{N}$$\nIn this problem, we have $N = 3$ identical feeders and $Z_{\\mathrm{feeder}} = 1 + j2 \\, \\Omega$. Therefore, the equivalent impedance $Z_{\\mathrm{eq}}$ is:\n$$Z_{\\mathrm{eq}} = \\frac{1 + j2}{3} \\, \\Omega$$\nTo find the equivalent resistance $R_{\\mathrm{eq}}$ and equivalent reactance $X_{\\mathrm{eq}}$, we separate the real and imaginary parts of $Z_{\\mathrm{eq}}$:\n$$Z_{\\mathrm{eq}} = \\frac{1}{3} + j\\frac{2}{3} \\, \\Omega$$\nBy definition, $Z_{\\mathrm{eq}} = R_{\\mathrm{eq}} + jX_{\\mathrm{eq}}$. Comparing the expressions, we find:\n$$R_{\\mathrm{eq}} = \\frac{1}{3} \\, \\Omega$$\n$$X_{\\mathrm{eq}} = \\frac{2}{3} \\, \\Omega$$\nThe problem requires the final answer as a two-entry row matrix $(R_{\\mathrm{eq}}, X_{\\mathrm{eq}})$. These are exact values as requested.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{3} & \\frac{2}{3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "When simulating systems with both very fast and very slow dynamics, a numerical challenge known as \"stiffness\" arises, which is central to multi-scale temporal coupling. This practice explores the profound impact of choosing the right numerical integrator by comparing a simple explicit method with a more robust implicit one for a stiff system . You will quantify the computational trade-offs, gaining insight into why implicit methods are often essential for the stable and efficient simulation of coupled cross-domain energy systems.",
            "id": "4106641",
            "problem": "Consider a linear time-invariant cross-domain energy system with ordinary differential equation (ODE) dynamics given by $\\dot{x}(t) = A x(t) + s(t)$, where $x(t) \\in \\mathbb{R}^{n}$ is the state vector that includes both electrical and thermal states, $A \\in \\mathbb{R}^{n \\times n}$ is the Jacobian matrix linearized around an operating point, and $s(t)$ is a known source term representing exogenous inputs. The system couples a fast electrical subdomain with a characteristic (fastest) time constant $\\tau_{f} = 1\\,\\mathrm{ms}$ and a slow thermal subdomain with a characteristic (slowest) time constant $\\tau_{s} = 1\\,\\mathrm{h}$. Such cross-domain coupling arises from resistive heating (electrical) influencing temperature (thermal), and thermo-electric effects feeding back into electrical parameters. You will integrate the system over a horizon $T = 1\\,\\mathrm{h}$.\n\nTwo time integration strategies are considered:\n- Explicit Euler with time step $\\Delta t_{\\mathrm{EE}} = 0.1\\,\\mathrm{ms}$.\n- Backward Euler with time step $\\Delta t_{\\mathrm{BE}} = 1\\,\\mathrm{s}$.\n\nAssume:\n- The stability of explicit Euler for a linear mode with real negative eigenvalue $\\lambda$ is governed by the condition $|1 + \\Delta t_{\\mathrm{EE}} \\lambda| < 1$, and the backward Euler method is unconditionally stable for such modes.\n- The system dimension is $n = 2000$, composed of $n_{e} = 1200$ electrical states and $n_{t} = 800$ thermal states.\n- The Jacobian $A$ is sparse, with the following scientifically plausible structure: each state has on average $4$ within-domain couplings; there is one diagonal entry per state; and there are $400$ cross-domain coupling entries resulting from interfacial power-temperature dependencies. Therefore, the total number of nonzero entries is $\\mathrm{nnz} = n$ (diagonal) $+ 4n$ (within-domain couplings) $+ 400 = 10400$.\n- The cost of a sparse matrix-vector multiplication of $A x$ is approximated as $2\\,\\mathrm{nnz}$ floating-point operations (flops).\n- For backward Euler, the linear system $(I - \\Delta t_{\\mathrm{BE}} A) x_{k+1} = x_{k} + \\Delta t_{\\mathrm{BE}} s_{k+1}$ is solved at each step. Because $A$ and $\\Delta t_{\\mathrm{BE}}$ are constant, the system matrix is constant in time; hence a single sparse Lower-Upper (LU) factorization can be reused across all steps. Assume the LU factorization costs $10\\,\\mathrm{nnz}$ flops, and each subsequent forward-plus-backward triangular solve per time step costs $4\\,\\mathrm{nnz}$ flops.\n- Neglect costs common to both methods that do not change the ratio, such as vector axpy operations not involving $A$.\n\nTasks:\n1. Using $T = 3600\\,\\mathrm{s}$, compute the total number of time steps $N_{\\mathrm{EE}}$ for explicit Euler and $N_{\\mathrm{BE}}$ for backward Euler.\n2. Compute the total operation counts $C_{\\mathrm{EE}}$ and $C_{\\mathrm{BE}}$ under the cost model above, and then compute the dimensionless ratio $R = C_{\\mathrm{EE}} / C_{\\mathrm{BE}}$ as a measure of comparative computational cost.\n\nReport the final answer as a row matrix containing the three quantities $\\left(N_{\\mathrm{EE}}, N_{\\mathrm{BE}}, R\\right)$. Use exact integers for $N_{\\mathrm{EE}}$ and $N_{\\mathrm{BE}}$. Round $R$ to four significant figures. The ratio is dimensionless; do not include any units in the final answer.",
            "solution": "We begin from the linear time-invariant ODE $\\dot{x}(t) = A x(t) + s(t)$, where stiffness arises due to widely separated time scales: the fastest electrical mode with $\\tau_{f} = 1\\,\\mathrm{ms}$ and the slowest thermal mode with $\\tau_{s} = 1\\,\\mathrm{h}$. For explicit Euler applied to a scalar linear mode $\\dot{y} = \\lambda y$, the update is $y_{k+1} = y_{k} + \\Delta t_{\\mathrm{EE}} \\lambda y_{k}$, and stability requires $|1 + \\Delta t_{\\mathrm{EE}} \\lambda| < 1$ for real negative $\\lambda$. With the fastest mode characterized by $\\lambda_{f} \\approx -\\frac{1}{\\tau_{f}}$, the stability condition can be assessed in terms of $\\Delta t_{\\mathrm{EE}}$ relative to $\\tau_{f}$. Backward Euler applied to the same mode uses $y_{k+1} = \\frac{y_{k}}{1 - \\Delta t_{\\mathrm{BE}} \\lambda}$, which is stable for all $\\Delta t_{\\mathrm{BE}} > 0$ when $\\lambda < 0$.\n\nWe are asked to compute the number of time steps for each method over the horizon $T = 3600\\,\\mathrm{s}$:\n- For explicit Euler with $\\Delta t_{\\mathrm{EE}} = 0.1\\,\\mathrm{ms} = 10^{-4}\\,\\mathrm{s}$, the number of steps is\n$$\nN_{\\mathrm{EE}} = \\frac{T}{\\Delta t_{\\mathrm{EE}}} = \\frac{3600}{10^{-4}} = 36{,}000{,}000.\n$$\n- For backward Euler with $\\Delta t_{\\mathrm{BE}} = 1\\,\\mathrm{s}$, the number of steps is\n$$\nN_{\\mathrm{BE}} = \\frac{T}{\\Delta t_{\\mathrm{BE}}} = \\frac{3600}{1} = 3600.\n$$\n\nNext, we compute computational costs (operation counts) under the provided model. The Jacobian has\n$$\n\\mathrm{nnz} = n + 4n + 400 = 2000 + 8000 + 400 = 10400\n$$\nnonzero entries. For explicit Euler, each step requires a sparse matrix-vector multiplication of $A x$, modeled as $2\\,\\mathrm{nnz}$ flops. Therefore, the total explicit Euler cost is\n$$\nC_{\\mathrm{EE}} = N_{\\mathrm{EE}} \\cdot (2\\,\\mathrm{nnz}) = 36{,}000{,}000 \\times (2 \\times 10400).\n$$\nCompute the per-step flop count:\n$$\n2 \\times 10400 = 20800,\n$$\nso\n$$\nC_{\\mathrm{EE}} = 36{,}000{,}000 \\times 20800 = 748{,}800 \\times 10^{6} = 7.488 \\times 10^{11}.\n$$\n\nFor backward Euler, the system matrix $(I - \\Delta t_{\\mathrm{BE}} A)$ is constant, so we perform a single sparse Lower-Upper (LU) factorization at cost $10\\,\\mathrm{nnz}$ flops and then reuse it at each step with two triangular solves, modeled as $4\\,\\mathrm{nnz}$ flops per step. The total backward Euler cost is\n$$\nC_{\\mathrm{BE}} = (10\\,\\mathrm{nnz}) + N_{\\mathrm{BE}} \\cdot (4\\,\\mathrm{nnz}) = 10 \\times 10400 + 3600 \\times (4 \\times 10400).\n$$\nWe compute the terms:\n$$\n10 \\times 10400 = 104000, \\quad 4 \\times 10400 = 41600,\n$$\nso\n$$\nC_{\\mathrm{BE}} = 104000 + 3600 \\times 41600.\n$$\nMultiplying,\n$$\n3600 \\times 41600 = (36 \\times 41600) \\times 100 = (1497600) \\times 100 = 149{,}760{,}000,\n$$\nand therefore,\n$$\nC_{\\mathrm{BE}} = 149{,}760{,}000 + 104{,}000 = 149{,}864{,}000 = 1.49864 \\times 10^{8}.\n$$\n\nThe comparative cost ratio is\n$$\nR = \\frac{C_{\\mathrm{EE}}}{C_{\\mathrm{BE}}} = \\frac{7.488 \\times 10^{11}}{1.49864 \\times 10^{8}}.\n$$\nPerforming the division,\n$$\nR \\approx 4.996532 \\times 10^{3}.\n$$\nRounding $R$ to four significant figures yields\n$$\nR \\approx 4997.\n$$\n\nWe now assemble the final outputs as requested: the exact integers $N_{\\mathrm{EE}} = 36{,}000{,}000$, $N_{\\mathrm{BE}} = 3600$, and the rounded dimensionless ratio $R = 4997$ to four significant figures.",
            "answer": "$$\\boxed{\\begin{pmatrix}36000000 & 3600 & 4997\\end{pmatrix}}$$"
        },
        {
            "introduction": "Beyond simulation, multi-scale modeling is crucial for making optimal long-term decisions that account for fast-timescale operational uncertainties. This advanced practice introduces Benders decomposition, a powerful method that systematically separates slow investment decisions from fast operational subproblems . By generating optimality and feasibility \"cuts,\" you will learn how information about operational costs and constraints is communicated back to the master investment problem, enabling robust planning across different time scales.",
            "id": "4106621",
            "problem": "Consider a two-stage capacity expansion and operation problem for an electric power system that couples slow investment decisions with fast operational decisions across multiple uncertain scenarios, reflecting multi-scale modeling and cross-domain coupling between economics and meteorology. The first stage chooses capacities for two technologies, a fossil generator and a wind plant. The second stage operates the system to meet scenario-specific demand at minimum variable cost, subject to physical constraints.\n\nDefine the investment vector $y = (y_G, y_W)$ where $y_G \\ge 0$ and $y_W \\ge 0$ are the installed nameplate capacities of the gas generator and wind plant, respectively, measured in megawatts (MW). For each scenario $s$, define:\n- Demand $d_s$ in megawatts (MW).\n- Gas marginal cost $c_G^s$ in dollars per megawatt-hour ($\\$/\\text{MWh}$).\n- Wind marginal cost $c_W^s$ in dollars per megawatt-hour ($\\$/\\text{MWh}$).\n- Wind availability factor $a^s \\in [0,1]$, dimensionless, such that the operable wind output is bounded by $a^s y_W$.\n\nFor each scenario $s$, the operational Linear Programming (LP) subproblem is:\nMinimize the variable generation cost\n$$\\min_{p_G, p_W} \\; c_G^s \\, p_G + c_W^s \\, p_W,$$\nsubject to the physical constraints\n$$p_G + p_W \\ge d_s,$$\n$$0 \\le p_G \\le y_G,$$\n$$0 \\le p_W \\le a^s y_W.$$\nHere $p_G$ and $p_W$ are the dispatch levels of gas and wind, respectively, in megawatts (MW), and energy is measured over one hour so that costs are in dollars ($\\$$). The first-stage master problem includes for each scenario $s$ a recourse cost placeholder variable $\\theta_s$ (in dollars), and Benders Decomposition (BD) adds cuts of two types:\n- Optimality cuts that upper-bound $\\theta_s$ by the value of the scenario $s$ operational LP, expressed as an affine function of $y$.\n- Feasibility cuts that enforce necessary conditions on $y$ so that the scenario $s$ operational LP is feasible.\n\nStarting from the fundamental base of Linear Programming (LP) duality and the Farkas Lemma for infeasibility certificates, your task is to compute, for a given investment vector $y$ and scenario parameters, either:\n- A valid Benders optimality cut of the form\n$$\\theta_s \\ge \\gamma_s + \\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W,$$\nwith explicit numerical values for $\\gamma_s$, $\\eta_{G,s}$, and $\\eta_{W,s}$; or\n- A valid Benders feasibility cut of the form\n$$\\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W \\ge -\\gamma_s,$$\nwith explicit numerical values for $\\gamma_s$, $\\eta_{G,s}$, and $\\eta_{W,s}$.\n\nAll physical quantities must be handled with consistent units. Demands are in megawatts (MW), costs are in dollars ($\\$$). If a feasibility cut is returned, it constrains capacities and should be interpreted in MW; if an optimality cut is returned, it constrains recourse cost and should be interpreted in dollars ($\\$$).\n\nYou are given the following scenario data set (three scenarios), which acts as the test suite backdrop:\n- Scenario $s=1$: $d_1 = 120$ MW, $c_G^1 = 50$ $\\$/\\text{MWh}$, $c_W^1 = 5$ $\\$/\\text{MWh}$, $a^1 = 0.4$.\n- Scenario $s=2$: $d_2 = 80$ MW, $c_G^2 = 70$ $\\$/\\text{MWh}$, $c_W^2 = 10$ $\\$/\\text{MWh}$, $a^2 = 0.9$.\n- Scenario $s=3$: $d_3 = 200$ MW, $c_G^3 = 60$ $\\$/\\text{MWh}$, $c_W^3 = 20$ $\\$/\\text{MWh}$, $a^3 = 0.2$.\n\nYour program must evaluate the following five test cases, each specified by a scenario index $s$ and an investment vector $y$:\n1. $(s=1, y_G = 160 \\text{ MW}, y_W = 50 \\text{ MW})$.\n2. $(s=2, y_G = 60 \\text{ MW}, y_W = 50 \\text{ MW})$.\n3. $(s=3, y_G = 20 \\text{ MW}, y_W = 100 \\text{ MW})$.\n4. $(s=1, y_G = 100 \\text{ MW}, y_W = 50 \\text{ MW})$.\n5. $(s=2, y_G = 0 \\text{ MW}, y_W = 100 \\text{ MW})$.\n\nFor each test case, determine whether the operational LP is feasible given $y$ and the scenario parameters. If infeasible, return the feasibility cut coefficients $(\\gamma_s, \\eta_{G,s}, \\eta_{W,s})$ in MW such that $\\eta_{G,s} y_G + \\eta_{W,s} y_W \\ge -\\gamma_s$; if feasible, return the optimality cut coefficients $(\\gamma_s, \\eta_{G,s}, \\eta_{W,s})$ in dollars ($\\$$) such that $\\theta_s \\ge \\gamma_s + \\eta_{G,s} y_G + \\eta_{W,s} y_W$.\n\nFinal output format specification:\n- For each test case, output a list of four fundamental values $[t, \\gamma_s, \\eta_{G,s}, \\eta_{W,s}]$, where $t$ is an integer indicator with $t=0$ for an optimality cut (cost units in dollars) and $t=1$ for a feasibility cut (capacity units in megawatts).\n- Aggregate all five per-test-case lists into a single Python-style list literal and print it on one line. For example, the format must be `[[t_1, gamma_1, eta_G_1, eta_W_1], [t_2, gamma_2, eta_G_2, eta_W_2], ...]`.\n\nYour program must produce exactly one line containing the specified list, with numerical values expressed as Python floats or integers. No other text must be printed. Answer units are implied by the cut type indicator $t$ as described above.",
            "solution": "The user's request is to derive Benders cuts for a two-stage stochastic capacity expansion problem. This requires analyzing the operational subproblem for given first-stage investment decisions and specific uncertainty scenarios. The analysis hinges on the principles of Linear Programming (LP) duality.\n\n### 1. Primal and Dual Operational Subproblems\n\nFor a given scenario $s$ and a fixed investment vector $y = (y_G, y_W)$, the second-stage operational subproblem is a Linear Program (LP) to determine the minimum cost dispatch $(p_G, p_W)$.\n\n**Primal Subproblem $P_s(y)$:**\nThe primal LP is given as:\n$$\n\\min_{p_G, p_W} \\; c_G^s \\, p_G + c_W^s \\, p_W\n$$\nsubject to:\n$$\n\\begin{align*}\np_G + p_W &\\ge d_s \\\\\n0 \\le p_G &\\le y_G \\\\\n0 \\le p_W &\\le a^s y_W\n\\end{align*}\n$$\nTo construct the dual, we associate dual variables with each constraint. Let's rewrite the primal in a standard form ($\\min c^T x$ subject to $Ax \\ge b, x \\ge 0$):\n$$ \\min_{p_G, p_W} c_G^s p_G + c_W^s p_W $$\nsubject to:\n$$\n\\begin{array}{lcll}\np_G + p_W &\\ge& d_s & (\\text{dual var } \\lambda_s \\ge 0) \\\\\np_G &\\le& y_G & \\iff -p_G \\ge -y_G \\quad (\\text{dual var } \\mu_{G,s} \\ge 0) \\\\\np_W &\\le& a^s y_W & \\iff -p_W \\ge -a^s y_W \\quad (\\text{dual var } \\mu_{W,s} \\ge 0) \\\\\np_G, p_W &\\ge& 0 &\n\\end{array}\n$$\n\n**Dual Subproblem $D_s(y)$:**\nThe corresponding dual LP is a maximization problem:\n$$\n\\max_{\\lambda_s, \\mu_{G,s}, \\mu_{W,s}} \\; d_s \\lambda_s - y_G \\mu_{G,s} - a^s y_W \\mu_{W,s}\n$$\nsubject to:\n$$\n\\begin{align*}\n\\lambda_s - \\mu_{G,s} &\\le c_G^s \\\\\n\\lambda_s - \\mu_{W,s} &\\le c_W^s \\\\\n\\lambda_s, \\mu_{G,s}, \\mu_{W,s} &\\ge 0\n\\end{align*}\n$$\nThe value of the recourse cost for scenario $s$, denoted $Q_s(y)$, is the optimal objective value of these LPs. Benders cuts are derived from the structure of the dual problem.\n\n### 2. Feasibility and Infeasibility Analysis\n\nThe feasibility of the primal subproblem determines the type of cut to be generated.\n\n**Feasibility Condition:** The primal subproblem is feasible if and only if the maximum possible generation can meet the demand $d_s$. This condition is:\n$$\ny_G + a^s y_W \\ge d_s\n$$\n\n**Case 1: Primal Infeasibility ($y_G + a^s y_W < d_s$) and Feasibility Cuts**\nIf the primal is infeasible, its dual is unbounded (as the dual is always feasible, e.g., with all dual variables set to $0$). An unbounded dual problem implies the existence of an extreme ray of the dual feasible region along which the objective function increases indefinitely. A Benders feasibility cut is designed to eliminate the current infeasible investment vector $y$ by making the dual objective along this ray non-positive.\n\nAn extreme ray is a direction vector $v = (\\bar{\\lambda}_s, \\bar{\\mu}_{G,s}, \\bar{\\mu}_{W,s})$ satisfying $\\bar{\\lambda}_s - \\bar{\\mu}_{G,s} \\le 0$, $\\bar{\\lambda}_s - \\bar{\\mu}_{W,s} \\le 0$, and $v \\ge 0$. For the dual to be unbounded, the objective must increase along this ray: $d_s \\bar{\\lambda}_s - y_G \\bar{\\mu}_{G,s} - a^s y_W \\bar{\\mu}_{W,s} > 0$.\n\nA simple and valid choice for such a ray is $(\\bar{\\lambda}_s, \\bar{\\mu}_{G,s}, \\bar{\\mu}_{W,s}) = (1, 1, 1)$. This vector satisfies the ray conditions. The unboundedness condition becomes $d_s - y_G - a^s y_W > 0$, which is precisely the condition for primal infeasibility.\n\nThe feasibility cut is derived by enforcing that the objective change along this ray is non-positive:\n$$\nd_s \\bar{\\lambda}_s - y_G \\bar{\\mu}_{G,s} - y_W (a^s \\bar{\\mu}_{W,s}) \\le 0\n$$\nSubstituting the ray $(1, 1, 1)$, we get $d_s - y_G - a^s y_W \\le 0$, which simplifies to $y_G + a^s y_W \\ge d_s$.\nTo match the required format $\\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W \\ge -\\gamma_s$, we rewrite this as $1 \\cdot y_G + a^s \\cdot y_W \\ge d_s$.\nComparing the terms yields the feasibility cut coefficients:\n- $\\gamma_s = -d_s$\n- $\\eta_{G,s} = 1$\n- $\\eta_{W,s} = a^s$\nThe cut type indicator is $t=1$.\n\n**Case 2: Primal Feasibility ($y_G + a^s y_W \\ge d_s$) and Optimality Cuts**\nIf the primal is feasible, an optimality cut is generated. By strong duality, the optimal recourse cost $Q_s(y)$ is equal to the optimal value of the dual problem. For an optimal dual solution $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*)$, we have:\n$$\nQ_s(y) = d_s \\lambda_s^* - y_G \\mu_{G,s}^* - y_W (a^s \\mu_{W,s}^*)\n$$\nA Benders optimality cut is a lower bound on the recourse cost variable $\\theta_s$, given by $\\theta_s \\ge Q_s(y)$. This gives the cut:\n$$\n\\theta_s \\ge d_s \\lambda_s^* - y_G \\mu_{G,s}^* - y_W (a^s \\mu_{W,s}^*)\n$$\nMatching this to the required format $\\theta_s \\ge \\gamma_s + \\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W$, we find the coefficients:\n- $\\gamma_s = d_s \\lambda_s^*$\n- $\\eta_{G,s} = -\\mu_{G,s}^*$\n- $\\eta_{W,s} = -a^s \\mu_{W,s}^*$\nThe cut type indicator is $t=0$.\n\nTo find the optimal dual variables $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*)$, we first solve the primal subproblem using a merit-order dispatch logic. In all scenarios, wind is cheaper than gas ($c_W^s < c_G^s$), so wind is dispatched first.\n\n**Subcase 2.1: Wind is sufficient ($a^s y_W \\ge d_s$)**\nThe dispatch is $p_W^* = d_s$ and $p_G^* = 0$. By applying Karush-Kuhn-Tucker (KKT) or complementary slackness conditions:\n- The wind capacity constraint $p_W \\le a^s y_W$ is inactive, so its dual variable $\\mu_{W,s}^* = 0$.\n- The gas capacity constraint $p_G \\le y_G$ is inactive, so $\\mu_{G,s}^* = 0$.\n- Since $p_W^* > 0$, the corresponding dual constraint is active: $\\lambda_s^* - \\mu_{W,s}^* = c_W^s$, which gives $\\lambda_s^* = c_W^s$.\nThe optimal dual solution is $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*) = (c_W^s, 0, 0)$.\nThe optimality cut coefficients are:\n- $\\gamma_s = d_s c_W^s$\n- $\\eta_{G,s} = 0$\n- $\\eta_{W,s} = 0$\n\n**Subcase 2.2: Wind is insufficient ($a^s y_W < d_s$)**\nThe dispatch is $p_W^* = a^s y_W$ and $p_G^* = d_s - a^s y_W$.\n- The wind capacity constraint is active, so $\\mu_{W,s}^* \\ge 0$.\n- The gas capacity constraint is inactive (assuming $y_G + a^s y_W > d_s$), so $\\mu_{G,s}^* = 0$.\n- Since $p_G^* > 0$, the corresponding dual constraint is active: $\\lambda_s^* - \\mu_{G,s}^* = c_G^s$, which gives $\\lambda_s^* = c_G^s$.\n- Since $p_W^* > 0$, the other dual constraint is active: $\\lambda_s^* - \\mu_{W,s}^* = c_W^s$, which gives $c_G^s - \\mu_{W,s}^* = c_W^s$, so $\\mu_{W,s}^* = c_G^s - c_W^s$.\nThe optimal dual solution is $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*) = (c_G^s, 0, c_G^s - c_W^s)$. This solution also holds for the boundary case where $y_G + a^s y_W = d_s$.\nThe optimality cut coefficients are:\n- $\\gamma_s = d_s c_G^s$\n- $\\eta_{G,s} = 0$\n- $\\eta_{W,s} = -a^s(c_G^s - c_W^s)$\n\n### 3. Application to Test Cases\n\nThe logic above is applied to each test case.\n\n**Test Case 1: $(s=1, y_G = 160, y_W = 50)$**\n$d_1=120, a^1=0.4$. Total capacity $160 + 0.4 \\times 50 = 180 \\ge 120$ (Feasible). Wind capacity $0.4 \\times 50 = 20 < 120$ (Subcase 2.2).\n$\\gamma_1 = 120 \\times 50 = 6000$. $\\eta_{G,1} = 0$. $\\eta_{W,1} = -0.4 \\times (50-5) = -18$. Result: $[0, 6000.0, 0.0, -18.0]$.\n\n**Test Case 2: $(s=2, y_G = 60, y_W = 50)$**\n$d_2=80, a^2=0.9$. Total capacity $60 + 0.9 \\times 50 = 105 \\ge 80$ (Feasible). Wind capacity $0.9 \\times 50 = 45 < 80$ (Subcase 2.2).\n$\\gamma_2 = 80 \\times 70 = 5600$. $\\eta_{G,2} = 0$. $\\eta_{W,2} = -0.9 \\times (70-10) = -54$. Result: $[0, 5600.0, 0.0, -54.0]$.\n\n**Test Case 3: $(s=3, y_G = 20, y_W = 100)$**\n$d_3=200, a^3=0.2$. Total capacity $20 + 0.2 \\times 100 = 40 < 200$ (Infeasible).\n$\\gamma_3 = -200$. $\\eta_{G,3} = 1$. $\\eta_{W,3} = 0.2$. Result: $[1, -200.0, 1.0, 0.2]$.\n\n**Test Case 4: $(s=1, y_G = 100, y_W = 50)$**\n$d_1=120, a^1=0.4$. Total capacity $100 + 0.4 \\times 50 = 120 \\ge 120$ (Feasible). Wind capacity $0.4 \\times 50 = 20 < 120$ (Subcase 2.2).\n$\\gamma_1 = 120 \\times 50 = 6000$. $\\eta_{G,1} = 0$. $\\eta_{W,1} = -0.4 \\times (50-5) = -18$. Result: $[0, 6000.0, 0.0, -18.0]$.\n\n**Test Case 5: $(s=2, y_G = 0, y_W = 100)$**\n$d_2=80, a^2=0.9$. Total capacity $0 + 0.9 \\times 100 = 90 \\ge 80$ (Feasible). Wind capacity $0.9 \\times 100 = 90 \\ge 80$ (Subcase 2.1).\n$\\gamma_2 = 80 \\times 10 = 800$. $\\eta_{G,2} = 0$. $\\eta_{W,2} = 0$. Result: $[0, 800.0, 0.0, 0.0]$.",
            "answer": "```\n[[0, 6000.0, 0.0, -18.0], [0, 5600.0, 0.0, -54.0], [1, -200.0, 1.0, 0.2], [0, 6000.0, 0.0, -18.0], [0, 800.0, 0.0, 0.0]]\n```"
        }
    ]
}