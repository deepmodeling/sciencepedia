{
    "hands_on_practices": [
        {
            "introduction": "本节将通过一个基础的网络聚合练习，帮助你掌握核心概念。在能源系统建模中，理解如何合并电网中的节点（母线）对于简化大规模模型至关重要。这项实践将指导你从第一性原理出发，推导一个聚合后的功率传输分布因子（$PTDF$），从而将抽象的聚合概念与电力系统的具体物理约束联系起来。",
            "id": "4133834",
            "problem": "考虑一个包含三个母线（标记为$1$、$2$和$3$）的$3$母线网络上的直流（DC）潮流近似。该网络有三条输电线路：$(1,2)$、$(1,3)$和$(2,3)$。设串联电抗分别为 $x_{12} = 0.5$、$x_{13} = 1$ 和 $x_{23} = 1$。用 $b_{ij} = \\frac{1}{x_{ij}}$ 表示相应的电纳。将母线$1$作为平衡母线，其相角为 $\\theta_{1} = 0$。采用从小编号母线到大编号母线的线路方向，即$1 \\to 2$、$1 \\to 3$和$2 \\to 3$，并根据这些方向定义线路潮流 $f_{ij} = b_{ij}(\\theta_{i} - \\theta_{j})$。\n\n您需要将母线$2$和$3$合并成一个聚合母线$A$。将聚合传输定义为在母线$1$处的单位注入和在母线$A$处的单位取出，其中在母线$A$处的取出在原始母线$2$和$3$之间分配为 $p_{2} = -\\alpha$ 和 $p_{3} = -(1-\\alpha)$，其中 $0 \\leq \\alpha \\leq 1$。施加物理合并所需的相角一致性约束，即在聚合取出下 $\\theta_{2} = \\theta_{3}$。\n\n仅从直流潮流定义和所提供的网络数据出发，确定强制 $\\theta_{2} = \\theta_{3}$ 的唯一$\\alpha$值，并计算物理线路$(1,2)$相对于从母线$1$到母线$A$的单位传输的聚合功率转移分布因子（PTDF）。线路$(1,2)$的聚合PTDF定义为，在强制 $\\theta_{2} = \\theta_{3}$ 的取出分配下，原始网络中流经$(1,2)$的单位传输功率的比例。在您的推导中验证：\n- 线路$(1,2)$和$(1,3)$上的总潮流之和等于单位传输功率（功率平衡），并且\n- 聚合PTDF等于以相同的$\\alpha$和$1-\\alpha$加权时，针对母线$2$和$3$处负荷的母线级PTDF的加权和。\n\n以精确分数形式提供线路$(1,2)$上的聚合PTDF。无单位。无需四舍五入。",
            "solution": "首先将根据指定标准对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 网络：包含三个母线（标记为$1$、$2$和$3$）的$3$母线网络。\n- 输电线路：$(1,2)$、$(1,3)$和$(2,3)$。\n- 串联电抗：$x_{12} = 0.5$, $x_{13} = 1$, $x_{23} = 1$。\n- 电纳：$b_{ij} = \\frac{1}{x_{ij}}$。\n- 平衡母线：母线$1$是平衡母线，其相角为 $\\theta_{1} = 0$。\n- 线路潮流定义：对于方向 $i \\to j$，$f_{ij} = b_{ij}(\\theta_{i} - \\theta_{j})$。方向给定为 $1 \\to 2$、$1 \\to 3$和$2 \\to 3$。\n- 聚合：母线$2$和$3$合并成一个聚合母线$A$。\n- 聚合传输：在母线$1$处单位注入($p_1 = 1$)，在母线$A$处单位取出。\n- 取出分配：在母线$A$处的取出分配为 $p_{2} = -\\alpha$ 和 $p_{3} = -(1-\\alpha)$，其中 $0 \\leq \\alpha \\leq 1$。\n- 相角一致性约束：施加 $\\theta_{2} = \\theta_{3}$。\n- 聚合PTDF定义：在强制 $\\theta_{2} = \\theta_{3}$ 的取出分配下，从母线$1$到母线$A$的单位传输在线路$(1,2)$上产生的潮流。\n- 验证要求：(1) 潮流 $f_{12}$ 和 $f_{13}$ 之和等于单位传输。(2) 聚合PTDF等于加权和 $\\alpha \\cdot PTDF_{12, 12} + (1-\\alpha) \\cdot PTDF_{12, 13}$。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学基础（关键）**：该问题基于直流（DC）潮流近似，这是电力系统分析中的一个标准和基本工具。网络聚合和功率转移分布因子（PTDFs）的概念也是公认的原则。所有定义和关系都与公认的电力系统工程理论一致。\n- **适定性**：该问题提供了一套完整的线性方程组，并有足够的约束条件来确定未知变量（$\\alpha$, $\\theta_2$, $\\theta_3$）的唯一解。\n- **客观性（关键）**：该问题使用电力系统工程的精确、标准术语进行陈述。数据是数值的，目标是定量的。没有主观或基于意见的陈述。\n\n### 步骤3：结论和行动\n该问题有效。这是一个定义明确、自成体系且科学合理的电力系统分析练习。可以继续求解过程。\n\n### 求解推导\n主要目标是找到满足相角一致性约束 $\\theta_{2} = \\theta_{3}$ 的 $\\alpha$ 值，然后计算线路 $(1,2)$ 的聚合功率转移分布因子（PTDF）。\n\n首先，我们根据给定的电抗 $x_{ij}$ 计算电纳 $b_{ij}$。假设这些值是标幺值。\n$b_{12} = \\frac{1}{x_{12}} = \\frac{1}{0.5} = 2$\n$b_{13} = \\frac{1}{x_{13}} = \\frac{1}{1} = 1$\n$b_{23} = \\frac{1}{x_{23}} = \\frac{1}{1} = 1$\n\n直流潮流方程由矩阵关系 $P = B\\theta$ 给出，其中 $P$ 是净注入功率向量，$\\theta$ 是母线电压相角向量，$B$ 是网络的电纳矩阵。$B$ 矩阵的元素为：\n$B_{ii} = \\sum_{j \\neq i} b_{ij}$\n$B_{ij} = -b_{ij}$ for $i \\neq j$\n\n对于给定的网络，完整的 $B$ 矩阵为：\n$B_{11} = b_{12} + b_{13} = 2 + 1 = 3$\n$B_{22} = b_{12} + b_{23} = 2 + 1 = 3$\n$B_{33} = b_{13} + b_{23} = 1 + 1 = 2$\n$B_{12} = B_{21} = -b_{12} = -2$\n$B_{13} = B_{31} = -b_{13} = -1$\n$B_{23} = B_{32} = -b_{23} = -1$\n\n因此，完整的电纳矩阵为：\n$$ B = \\begin{pmatrix} 3  -2  -1 \\\\ -2  3  -1 \\\\ -1  -1  2 \\end{pmatrix} $$\n由于母线$1$是平衡母线且 $\\theta_1 = 0$，我们可以为非平衡母线（$2$和$3$）写出降阶方程组：\n$$ \\begin{pmatrix} p_2 \\\\ p_3 \\end{pmatrix} = \\begin{pmatrix} B_{22}  B_{23} \\\\ B_{32}  B_{33} \\end{pmatrix} \\begin{pmatrix} \\theta_2 \\\\ \\theta_3 \\end{pmatrix} $$\n这是系统 $P' = B'\\theta'$，其中 $P'$ 是非平衡母线上的注入功率向量，$B'$ 是降阶电纳矩阵。\n注入功率给定为 $p_2 = -\\alpha$ 和 $p_3 = -(1-\\alpha)$。降阶系统为：\n$$ \\begin{pmatrix} -\\alpha \\\\ -(1-\\alpha) \\end{pmatrix} = \\begin{pmatrix} 3  -1 \\\\ -1  2 \\end{pmatrix} \\begin{pmatrix} \\theta_2 \\\\ \\theta_3 \\end{pmatrix} $$\n为了求解相角 $\\theta_2$ 和 $\\theta_3$，我们必须求出降阶矩阵 $B'$ 的逆矩阵。\n$\\det(B') = (3)(2) - (-1)(-1) = 6 - 1 = 5$。\n逆矩阵是 $(B')^{-1} = \\frac{1}{5} \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix}$。\n\n现在我们可以用 $\\alpha$ 来求解相角：\n$$ \\begin{pmatrix} \\theta_2 \\\\ \\theta_3 \\end{pmatrix} = (B')^{-1} \\begin{pmatrix} p_2 \\\\ p_3 \\end{pmatrix} = \\frac{1}{5} \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} -\\alpha \\\\ -(1-\\alpha) \\end{pmatrix} $$\n$\\theta_2 = \\frac{1}{5} (2(-\\alpha) + 1(-(1-\\alpha))) = \\frac{1}{5} (-2\\alpha - 1 + \\alpha) = \\frac{1}{5} (-\\alpha - 1)$\n$\\theta_3 = \\frac{1}{5} (1(-\\alpha) + 3(-(1-\\alpha))) = \\frac{1}{5} (-\\alpha - 3 + 3\\alpha) = \\frac{1}{5} (2\\alpha - 3)$\n\n聚合需要物理约束 $\\theta_2 = \\theta_3$。我们强制实施此约束以找到 $\\alpha$ 的唯一值：\n$\\frac{1}{5} (-\\alpha - 1) = \\frac{1}{5} (2\\alpha - 3)$\n$-\\alpha - 1 = 2\\alpha - 3$\n$2 = 3\\alpha$\n$\\alpha = \\frac{2}{3}$\n\n利用这个 $\\alpha$ 值，我们可以求出相角的数值：\n$\\theta_2 = \\frac{1}{5} \\left(-\\frac{2}{3} - 1\\right) = \\frac{1}{5} \\left(-\\frac{5}{3}\\right) = -\\frac{1}{3}$\n$\\theta_3 = \\frac{1}{5} \\left(2\\left(\\frac{2}{3}\\right) - 3\\right) = \\frac{1}{5} \\left(\\frac{4}{3} - \\frac{9}{3}\\right) = \\frac{1}{5} \\left(-\\frac{5}{3}\\right) = -\\frac{1}{3}$\n相角确实相等，符合要求。\n\n线路 $(1,2)$ 相对于从母线 $1$ 到聚合母线 $A$ 的传输的聚合 PTDF 是在这些条件下的潮流 $f_{12}$。\n$f_{12} = b_{12}(\\theta_1 - \\theta_2) = 2\\left(0 - \\left(-\\frac{1}{3}\\right)\\right) = 2\\left(\\frac{1}{3}\\right) = \\frac{2}{3}$。\n因此，线路 $(1,2)$ 的聚合 PTDF 为 $\\frac{2}{3}$。\n\n接下来，我们执行两个指定的验证。\n\n**验证1：功率平衡**\n我们必须验证从源母线 $1$ 流出的总潮流等于单位注入功率。总潮流为 $f_{12} + f_{13}$。\n我们已经有 $f_{12} = \\frac{2}{3}$。\n我们计算 $f_{13} = b_{13}(\\theta_1 - \\theta_3) = 1\\left(0 - \\left(-\\frac{1}{3}\\right)\\right) = \\frac{1}{3}$。\n总潮流为 $f_{12} + f_{13} = \\frac{2}{3} + \\frac{1}{3} = 1$。这与母线 $1$ 处的单位注入功率 $p_1=1$ 相匹配。验证成功。\n\n**验证2：母线级PTDF的加权和**\n我们需要证明聚合PTDF等于 $\\alpha \\cdot PTDF_{12, 12} + (1-\\alpha) \\cdot PTDF_{12, 13}$。首先，我们计算各个母线级的PTDF。\n\n$PTDF_{12, 12}$：这是从母线 $1$ 到母线 $2$ 的单位传输在线路 $(1,2)$ 上的潮流。注入功率为 $p_1=1$, $p_2=-1$, $p_3=0$。\n$\\begin{pmatrix} \\theta_2 \\\\ \\theta_3 \\end{pmatrix} = (B')^{-1} \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix} = \\frac{1}{5} \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix} = \\frac{1}{5} \\begin{pmatrix} -2 \\\\ -1 \\end{pmatrix}$。\n所以，$\\theta_2 = -\\frac{2}{5}$。\n潮流为 $f_{12} = b_{12}(\\theta_1 - \\theta_2) = 2\\left(0 - \\left(-\\frac{2}{5}\\right)\\right) = \\frac{4}{5}$。\n因此，$PTDF_{12, 12} = \\frac{4}{5}$。\n\n$PTDF_{12, 13}$：这是从母线 $1$ 到母线 $3$ 的单位传输在线路 $(1,2)$ 上的潮流。注入功率为 $p_1=1$, $p_2=0$, $p_3=-1$。\n$\\begin{pmatrix} \\theta_2 \\\\ \\theta_3 \\end{pmatrix} = (B')^{-1} \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = \\frac{1}{5} \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = \\frac{1}{5} \\begin{pmatrix} -1 \\\\ -3 \\end{pmatrix}$。\n所以，$\\theta_2 = -\\frac{1}{5}$。\n潮流为 $f_{12} = b_{12}(\\theta_1 - \\theta_2) = 2\\left(0 - \\left(-\\frac{1}{5}\\right)\\right) = \\frac{2}{5}$。\n因此，$PTDF_{12, 13} = \\frac{2}{5}$。\n\n现在，我们使用 $\\alpha = \\frac{2}{3}$ 和 $1-\\alpha = \\frac{1}{3}$ 计算加权和：\n加权和 = $\\alpha \\cdot PTDF_{12, 12} + (1-\\alpha) \\cdot PTDF_{12, 13}$\n加权和 = $\\left(\\frac{2}{3}\\right) \\left(\\frac{4}{5}\\right) + \\left(\\frac{1}{3}\\right) \\left(\\frac{2}{5}\\right) = \\frac{8}{15} + \\frac{2}{15} = \\frac{10}{15} = \\frac{2}{3}$。\n这个值 $\\frac{2}{3}$ 与先前计算的聚合PTDF相同。此验证也成功。\n\n最终答案是线路 $(1,2)$ 的聚合PTDF的值。",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "这项练习将带你实际操作时间序列聚合，这是处理大量时间序列数据时能源建模中的一项常见任务。本练习的核心原则是确保聚合模型能够保留关键的系统级总量，在本例中即年度总能量。通过实现一种为代表日计算适当权重的方法，你将在时间序列聚类的核心技术方面获得亲手编码的经验。",
            "id": "4133899",
            "problem": "考虑一个全年每小时负荷的时间序列，表示为每日负荷曲线的序列。假设有 $D$ 天，每天有 $H$ 个小时的时间步长，且恒定的时间步长为 $\\Delta t$ 小时。令 $x_{d,h}$ 表示第 $d \\in \\{1,\\dots,D\\}$ 天第 $h \\in \\{1,\\dots,H\\}$ 小时的电力负荷，单位为兆瓦（MW）。年总能量（单位：兆瓦时，MWh）由功率与能量的基本关系定义，\n$$\nE_{\\text{annual}} \\;=\\; \\sum_{d=1}^{D}\\sum_{h=1}^{H} x_{d,h}\\,\\Delta t,\n$$\n其中 $\\Delta t$ 的单位必须是小时，$x_{d,h}$ 的单位必须是兆瓦，这样乘积 $x_{d,h}\\Delta t$ 的单位才是兆瓦时。日的聚类由一个映射 $c:\\{1,\\dots,D\\}\\to\\{1,\\dots,K\\}$ 给出，该映射将每一天分配到 $K$ 个聚类中的一个。对于每个聚类 $k\\in\\{1,\\dots,K\\}$，选择一个单一的代表日负荷曲线 $r_{k,h}$。定义非负权重 $w_k$ 来缩放代表日，以使能量守恒约束成立，\n$$\n\\sum_{k=1}^{K} w_k \\sum_{h=1}^{H} r_{k,h}\\,\\Delta t \\;=\\; \\sum_{d=1}^{D}\\sum_{h=1}^{H} x_{d,h}\\,\\Delta t.\n$$\n您必须计算满足此能量守恒约束的权重 $w_k$，如果不可能，则检测其不可行性。所有能量值必须以兆瓦时（MWh）计算。三角函数中使用的所有角度必须以弧度为单位。数值相等性必须在 $\\varepsilon=10^{-9}$ 兆瓦时的绝对容差范围内进行验证。\n\n您的程序必须实现以下测试套件，涵盖一般情况、非均值代表日情况、零能量边界情况以及可证明的不可行情况。在每个测试用例中，设置 $H=24$ 和 $\\Delta t=1$ 小时。\n\n- 测试用例 1（理想情况：代表日等于聚类均值）：\n    - 参数：$D=6$, $K=3$, $\\Delta t=1$ 小时。\n    - 每日负荷曲线的构造：对于每一天 $d\\in\\{1,\\dots,6\\}$ 和每一小时 $h\\in\\{0,\\dots,23\\}$，定义\n      $$\n      x_{d,h} \\;=\\; 50 \\;+\\; 10\\,\\sin\\!\\left(\\frac{2\\pi\\, h}{24}\\right) \\;+\\; \\delta_d,\n      $$\n      其中偏移量 $\\delta_1=0$, $\\delta_2=2$, $\\delta_3=-4$, $\\delta_4=6$, $\\delta_5=-1$, $\\delta_6=3$（均以兆瓦为单位）。角度以弧度为单位。\n    - 聚类：$c(1)=1$, $c(2)=1$, $c(3)=2$, $c(4)=2$, $c(5)=3$, $c(6)=3$。\n    - 每个聚类的代表日：对于每个 $k\\in\\{1,2,3\\}$，将 $r_{k,h}$ 设置为所有满足 $c(d)=k$ 的 $d$ 的 $x_{d,h}$ 的算术平均值。\n    - 预期可行性：可行。\n\n- 测试用例 2（类中心点代表日：代表日不是均值）：\n    - 参数：$D=5$, $K=2$, $\\Delta t=1$ 小时。\n    - 每日负荷曲线的构造：对于相移 $\\phi_1=0$, $\\phi_2=0.5$, $\\phi_3=-0.5$, $\\phi_4=1.0$, $\\phi_5=-1.0$（均以弧度为单位），为每一天 $d\\in\\{1,\\dots,5\\}$ 和每一小时 $h\\in\\{0,\\dots,23\\}$ 定义，\n      $$\n      x_{d,h} \\;=\\; 60 \\;+\\; 8\\,\\sin\\!\\left(\\frac{2\\pi\\, h}{24} + \\phi_d\\right),\n      $$\n      单位为兆瓦，角度以弧度为单位。\n    - 聚类：$c(1)=1$, $c(2)=1$, $c(3)=1$, $c(4)=2$, $c(5)=2$。\n    - 每个聚类的代表日：对于 $k=1$，选择 $r_{1,h}=x_{2,h}$（即 $d=2$ 的那一天）；对于 $k=2$，选择 $r_{2,h}=x_{4,h}$（即 $d=4$ 的那一天）。\n    - 预期可行性：可行。\n\n- 测试用例 3（边界情况：零能量聚类与零能量代表日）：\n    - 参数：$D=3$, $K=2$, $\\Delta t=1$ 小时。\n    - 每日负荷曲线的构造：\n      - 第 1 天：对于所有 $h\\in\\{0,\\dots,23\\}$，$x_{1,h}=0$ 兆瓦。\n      - 第 2 天：对于所有 $h\\in\\{0,\\dots,23\\}$，$x_{2,h}=45 + 5\\,\\sin\\!\\left(\\frac{2\\pi\\, h}{24}\\right)$ 兆瓦。\n      - 第 3 天：对于所有 $h\\in\\{0,\\dots,23\\}$，$x_{3,h}=47 + 4\\,\\sin\\!\\left(\\frac{2\\pi\\, h}{24}\\right)$ 兆瓦。\n    - 聚类：$c(1)=1$, $c(2)=2$, $c(3)=2$。\n    - 每个聚类的代表日：对于所有小时，$r_{1,h}=0$ 兆瓦；$r_{2,h}$ 等于 $x_{2,h}$ 和 $x_{3,h}$ 的算术平均值。\n    - 预期可行性：可行。\n\n- 测试用例 4（不可行情况：非零能量聚类与零能量代表日）：\n    - 参数：$D=2$, $K=2$, $\\Delta t=1$ 小时。\n    - 每日负荷曲线的构造：\n      - 第 1 天：对于所有 $h\\in\\{0,\\dots,23\\}$，$x_{1,h}=30 + 6\\,\\sin\\!\\left(\\frac{2\\pi\\, h}{24}\\right)$ 兆瓦。\n      - 第 2 天：对于所有 $h\\in\\{0,\\dots,23\\}$，$x_{2,h}=35 + 4\\,\\sin\\!\\left(\\frac{2\\pi\\, h}{24}\\right)$ 兆瓦。\n    - 聚类：$c(1)=1$, $c(2)=2$。\n    - 每个聚类的代表日：对于所有小时，$r_{1,h}=0$ 兆瓦；$r_{2,h}=x_{2,h}$。\n    - 预期可行性：不可行。\n\n您的程序必须：\n- 计算试图满足能量守恒约束的权重 $w_k$。如果 $\\sum_{h=1}^{H} r_{k,h}\\,\\Delta t = 0$ 且 $\\sum_{d: c(d)=k}\\sum_{h=1}^{H} x_{d,h}\\,\\Delta t > 0$，则声明该情况为不可行，因为没有非负有限的 $w_k$ 能够满足该聚类的等式。\n- 当情况可行时，在 $\\varepsilon=10^{-9}$ 兆瓦时的绝对容差范围内，对能量守恒等式进行数值验证。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按四个测试用例的顺序排列结果。每个结果必须是布尔值：如果情况可行且等式在容差范围内成立，则为 $\\,\\text{True}\\,$，否则为 $\\,\\text{False}\\,$。例如，输出格式必须与 $[r_1,r_2,r_3,r_4]$ 完全一样。\n\n所有三角函数都必须使用弧度角进行计算。所有能量都必须以兆瓦时（MWh）计算。容差为 $\\varepsilon=10^{-9}$ 兆瓦时。",
            "solution": "该问题要求计算非负权重 $w_k$，以确保时间序列的简化表示的总能量与原始时间序列的总能量相匹配。该问题定义明确，并在科学上基于能源系统建模的原理，特别是时间序列聚合的原理。\n\n基本原理是能量守恒。原始时间序列的总能量 $E_{\\text{total}}$ 由 $D$ 天的数据组成，每天有 $H$ 个小时的测量值 $x_{d,h}$（单位为兆瓦），时间步长为 $\\Delta t$（单位为小时），其总能量通过对所有时间步的求和给出：\n$$\nE_{\\text{total}} \\;=\\; \\sum_{d=1}^{D}\\sum_{h=1}^{H} x_{d,h}\\,\\Delta t\n$$\n该物理量的单位是兆瓦时（MWh）。\n\n聚合表示由 $K$ 个代表性的每日负荷曲线 $r_{k,h}$ 组成，每个曲线都由一个非负权重 $w_k$ 进行缩放。此聚合表示的总能量为：\n$$\nE_{\\text{agg}} \\;=\\; \\sum_{k=1}^{K} w_k \\left( \\sum_{h=1}^{H} r_{k,h}\\,\\Delta t \\right)\n$$\n问题指定了全局能量守恒约束 $E_{\\text{agg}} = E_{\\text{total}}$。这个单一的线性方程 $\\sum_{k=1}^{K} w_k E_{R,k} = E_{\\text{total}}$（其中 $E_{R,k} = \\sum_{h=1}^{H} r_{k,h}\\,\\Delta t$）有 $K$ 个未知数（权重 $w_k$），因此如果 $K > 1$，该方程是欠定的。\n\n为了获得唯一且有意义的解，必须分解全局约束。聚类的逻辑意味着每个代表日 $r_{k,h}$ 代表了分配给聚类 $k$ 的特定原始日集合。因此，一个更严谨的提法是按每个聚类强制执行能量守恒。这确保了每个聚类的聚合能量贡献与该聚类内原始日的总能量相匹配。\n\n对于每个聚类 $k \\in \\{1, \\dots, K\\}$，我们建立以下约束：\n$$\nw_k \\left( \\sum_{h=1}^{H} r_{k,h}\\,\\Delta t \\right) \\;=\\; \\sum_{d: c(d)=k}\\left(\\sum_{h=1}^{H} x_{d,h}\\,\\Delta t\\right)\n$$\n令 $E_{C,k}$ 为分配给聚类 $k$ 的所有原始日的总能量，令 $E_{R,k}$ 为聚类 $k$ 的代表日负荷曲线的能量。每个权重 $w_k$ 的方程简化为：\n$$\nw_k E_{R,k} \\;=\\; E_{C,k}\n$$\n这个公式为独立确定每个权重 $w_k$ 提供了一条清晰的路径。将这些按聚类划分的方程对所有从 $1$ 到 $K$ 的 $k$ 求和，自然可以恢复全局能量平衡：$\\sum_{k=1}^{K} w_k E_{R,k} = \\sum_{k=1}^{K} E_{C,k} = E_{\\text{total}}$。\n\n找到一个非负权重 $w_k$ 的可行性取决于 $E_{C,k}$ 和 $E_{R,k}$ 的值：\n$1$. 如果 $E_{R,k} \\neq 0$，则通过除法可以找到唯一的权重：$w_k = E_{C,k} / E_{R,k}$。由于负荷曲线 $x_{d,h}$ 通常是非负的，所以 $E_{C,k} \\geq 0$。如果代表日负荷曲线 $r_{k,h}$ 也是由非负值构成的，那么 $E_{R,k} > 0$，得到的权重 $w_k$ 将是非负的，满足问题的要求。\n$2$. 如果 $E_{R,k} = 0$：\n    a. 如果 $E_{C,k} \\neq 0$，方程变为 $w_k \\cdot 0 = E_{C,k}$，这是一个矛盾。没有有限的 $w_k$ 值可以满足这个等式。这种情况对应于问题中明确指出的不可行条件：一个具有非零总能量的聚类不能由一个零能量的负荷曲线来代表。在数值上，通过测试 $|E_{R,k}| < \\varepsilon$ 同时 $E_{C,k} > \\varepsilon$ 来检查这种情况，其中 $\\varepsilon = 10^{-9}$ MWh 是指定的容差。\n    b. 如果 $E_{C,k} = 0$，方程变为 $w_k \\cdot 0 = 0$。这对任何非负实数 $w_k$ 都成立。在这种情况下，$w_k$ 的选择不影响总能量平衡，因为无论如何该聚类对 $E_{\\text{agg}}$ 的贡献都为零。一个合乎逻辑的选择是将 $w_k$ 设置为该聚类中的天数。\n\n解决该问题的算法如下：\n对于 $K$ 个聚类中的每一个：\n- 计算聚类中原始日的总能量，$E_{C,k} = \\Delta t \\sum_{d: c(d)=k}\\sum_{h=1}^{H} x_{d,h}$。\n- 计算聚类代表日的能量，$E_{R,k} = \\Delta t \\sum_{h=1}^{H} r_{k,h}$。\n- 检查不可行条件：如果 $|E_{R,k}| < \\varepsilon$ 且 $E_{C,k} > \\varepsilon$，则此测试用例不可行。\n如果没有任何聚类满足不可行条件，则该测试用例是可行的。通过根据此逻辑检查四个测试用例中的每一个来确定其总体有效性。最终输出是每个测试用例的布尔值，表示其可行性。\n\n在实现上，使用 NumPy 进行基于数组的计算是高效的。小时 $h$ 的索引从 $0$ 到 $23$，以与标准编程惯例保持一致，这也与问题中对整个周期进行求和的公式相符。",
            "answer": "```python\nimport numpy as np\n\ndef solve_case(D, K, dt, H, x_profiles, cluster_map, r_profiles, tolerance):\n    \"\"\"\n    Solves a single test case for energy-preserving weights.\n\n    Args:\n        D (int): Number of days.\n        K (int): Number of clusters.\n        dt (float): Time step duration in hours.\n        H (int): Number of hours per day.\n        x_profiles (np.ndarray): Original daily load profiles (D x H).\n        cluster_map (list): A list of length D mapping each day to a cluster ID (1-based).\n        r_profiles (np.ndarray): Representative profiles (K x H).\n        tolerance (float): Absolute tolerance for energy comparison.\n\n    Returns:\n        bool: True if feasible, False otherwise.\n    \"\"\"\n    # Group day indices (0-based) by cluster ID (1-based)\n    clusters = {k: [] for k in range(1, K + 1)}\n    for day_idx, cluster_id in enumerate(cluster_map):\n        clusters[cluster_id].append(day_idx)\n\n    for k in range(1, K + 1):\n        # Calculate cluster energy E_Ck\n        day_indices_in_cluster = clusters.get(k, [])\n        \n        if not day_indices_in_cluster:\n            # An empty cluster has zero energy.\n            E_Ck = 0.0\n        else:\n            cluster_day_profiles = x_profiles[day_indices_in_cluster, :]\n            E_Ck = np.sum(cluster_day_profiles) * dt\n        \n        # Calculate representative energy E_Rk\n        # Representative profiles are 0-indexed, so r_profiles[k-1]\n        representative_profile = r_profiles[k-1, :]\n        E_Rk = np.sum(representative_profile) * dt\n\n        # Check for the infeasibility condition\n        if abs(E_Rk) < tolerance and E_Ck > tolerance:\n            return False\n\n    # If the loop completes, no infeasibility was found for any cluster\n    return True\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    H = 24\n    dt = 1.0\n    tolerance = 1e-9\n    h_vals = np.arange(H)\n    sin_base = np.sin(2 * np.pi * h_vals / H)\n    \n    test_cases_params = []\n\n    # Test Case 1: Happy path\n    D1, K1 = 6, 3\n    deltas1 = np.array([0, 2, -4, 6, -1, 3]).reshape(D1, 1)\n    x_profiles1 = 50.0 + 10.0 * sin_base + deltas1\n    cluster_map1 = [1, 1, 2, 2, 3, 3]\n    r_profiles1 = np.zeros((K1, H))\n    r_profiles1[0, :] = np.mean(x_profiles1[[0, 1], :], axis=0)\n    r_profiles1[1, :] = np.mean(x_profiles1[[2, 3], :], axis=0)\n    r_profiles1[2, :] = np.mean(x_profiles1[[4, 5], :], axis=0)\n    test_cases_params.append((D1, K1, dt, H, x_profiles1, cluster_map1, r_profiles1, tolerance))\n\n    # Test Case 2: Medoid-like representatives\n    D2, K2 = 5, 2\n    phis2 = np.array([0, 0.5, -0.5, 1.0, -1.0]).reshape(D2, 1)\n    sin_args2 = (2 * np.pi * h_vals / H) + phis2\n    x_profiles2 = 60.0 + 8.0 * np.sin(sin_args2)\n    cluster_map2 = [1, 1, 1, 2, 2]\n    r_profiles2 = np.vstack([x_profiles2[1, :], x_profiles2[3, :]])\n    test_cases_params.append((D2, K2, dt, H, x_profiles2, cluster_map2, r_profiles2, tolerance))\n\n    # Test Case 3: Boundary case with zero energy\n    D3, K3 = 3, 2\n    x1_3 = np.zeros(H)\n    x2_3 = 45.0 + 5.0 * sin_base\n    x3_3 = 47.0 + 4.0 * sin_base\n    x_profiles3 = np.vstack([x1_3, x2_3, x3_3])\n    cluster_map3 = [1, 2, 2]\n    r1_3 = np.zeros(H)\n    r2_3 = np.mean(x_profiles3[[1, 2], :], axis=0)\n    r_profiles3 = np.vstack([r1_3, r2_3])\n    test_cases_params.append((D3, K3, dt, H, x_profiles3, cluster_map3, r_profiles3, tolerance))\n\n    # Test Case 4: Infeasible case\n    D4, K4 = 2, 2\n    x1_4 = 30.0 + 6.0 * sin_base\n    x2_4 = 35.0 + 4.0 * sin_base\n    x_profiles4 = np.vstack([x1_4, x2_4])\n    cluster_map4 = [1, 2]\n    r1_4 = np.zeros(H)\n    r2_4 = x_profiles4[1, :]\n    r_profiles4 = np.vstack([r1_4, r2_4])\n    test_cases_params.append((D4, K4, dt, H, x_profiles4, cluster_map4, r_profiles4, tolerance))\n\n    results = []\n    for params in test_cases_params:\n        result = solve_case(*params)\n        results.append(result)\n\n    # Format the output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Call the main function to run the solution\nsolve()\n```"
        },
        {
            "introduction": "最后的这项实践将挑战你对聚合方法固有局限性的批判性思考。我们将探讨，虽然聚合可以简化模型，但有时会产生“松弛间隙”（relaxation gap），即简化后的模型存在可行解，而这些解在原始的、详细的单元上是无法实现的。本练习通过一个经典的机组组合问题来展示这一间隙，要求你量化这种差异，并思考其在现实世界中的运行意义。",
            "id": "4133909",
            "problem": "考虑一个单周期机组组合 (UC) 设置，其中包含一个由相同火电机组组成的集群。共有 $N$ 台相同的机组，每台机组的特点是其二元启停决策和最小稳定运行水平。对于功率输出 $p_i$ 和启停状态 $u_i$，其原始的单个机组析取可行集为\n$$\n\\mathcal{S} \\;=\\; \\{(u_i,p_i) \\,\\mid\\, u_i \\in \\{0,1\\},\\; p_i = 0 \\text{ if } u_i=0,\\; P^{\\min} \\le p_i \\le P^{\\max} \\text{ if } u_i=1\\}.\n$$\n功率必须精确平衡，且不允许弃电和切负荷。\n\n现在将 $N$ 台相同的机组聚合成一个单一集群，并考虑标准的凸聚合方法。在该方法中，已启动机组的整数数量被松弛为一个连续量 $y \\in [0,N]$，集群输出 $p$ 满足由 $\\mathcal{S}$ 的凸包所隐含的凸包络：\n$$\ny \\in [0,N], \\qquad y\\,P^{\\min} \\le p \\le y\\,P^{\\max}.\n$$\n\n给定以下数据定义一个具体实例：\n- 机组数量 $N = 3$，\n- 最小和最大输出 $P^{\\min} = 50$ MW 和 $P^{\\max} = 100$ MW，\n- 需要精确满足的净负荷 $D = 30$ MW。\n\n任务：\n1) 仅使用上述模型定义，为聚合凸松弛模型构造一个精确满足负荷的可行点，并证明其在聚合模型中是可行的。\n2) 证明对于相同的数据，原始的析取整数UC模型是不可行的。\n3) 将可行性差距 $G$ 定义为当精确的功率平衡等式被替换为绝对不匹配目标时，原始析取模型可实现的最小绝对功率平衡偏差（单位：MW），即：\n$$\nG \\;:=\\; \\min_{\\substack{u_i \\in \\{0,1\\}\\\\ p_i}} \\left| \\sum_{i=1}^{N} p_i \\;-\\; D \\right| \\quad \\text{subject to } (u_i,p_i) \\in \\mathcal{S} \\text{ for all } i \\in \\{1,\\ldots,N\\}.\n$$\n计算给定数据下的 $G$ 值。以 MW 为单位给出 $G$，并将答案四舍五入至四位有效数字。\n\n最后，简要解释计算出的 $G$ 在运行方面的影响，即，要用原始的物理机组实现聚合松弛模型的调度方案，需要采取哪些物理操作（如果有的话）。您的最终数值答案必须仅为 $G$ 的单个值（单位为 MW，按要求四舍五入）。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于电力系统工程和优化的原理，提法得当，设置清晰完整，并且表述客观。因此，我们可以进行完整解答。\n\n该问题要求根据为一个机组组合问题所提供的数据完成三项任务：$N=3$ 台相同的机组，每台机组的最小输出为 $P^{\\min} = 50$ MW，最大输出为 $P^{\\max} = 100$ MW。需要满足的净负荷为 $D = 30$ MW。\n\n**任务1：聚合凸松弛模型的可行性**\n\n聚合凸松弛模型由变量 $y$（表示连续的已启动机组数量）和 $p$（集群的总功率输出）定义。其约束条件为：\n$$(1) \\quad y \\in [0, N]$$\n$$(2) \\quad y P^{\\min} \\le p \\le y P^{\\max}$$\n给定 $N=3$，$P^{\\min}=50$ 和 $P^{\\max}=100$。该模型还必须满足功率平衡方程，该方程要求总输出等于负荷：\n$$(3) \\quad p = D$$\n给定 $D=30$，我们需要找到一个满足所有约束条件的 $y$ 值。将 $p=D=30$ 代入不等式 $(2)$，我们得到：\n$$y \\times 50 \\le 30 \\le y \\times 100$$\n这个复合不等式可以分为两部分：\n$$y \\times 50 \\le 30 \\implies y \\le \\frac{30}{50} \\implies y \\le 0.6$$\n$$30 \\le y \\times 100 \\implies y \\ge \\frac{30}{100} \\implies y \\ge 0.3$$\n因此，我们必须找到一个满足 $0.3 \\le y \\le 0.6$ 的 $y$。我们还必须满足约束 $(1)$，即 $y \\in [0, 3]$。区间 $[0.3, 0.6]$ 是 $[0, 3]$ 的子集，所以 $[0.3, 0.6]$ 中的任何 $y$ 都是有效的。\n\n为了构造一个可行点，我们可以在此范围内选择任何 $y$ 值，例如 $y=0.4$。这给出了点 $(y,p) = (0.4, 30)$。\n这个点在聚合模型中是可行的，因为：\n1.  功率输出 $p=30$ MW 精确地满足了负荷 $D=30$ MW。\n2.  连续启停变量 $y=0.4$ 在其允许的范围内，因为 $0 \\le 0.4 \\le 3$。\n3.  发电不等式得到满足：$y P^{\\min} \\le p \\le y P^{\\max}$ 变为 $0.4 \\times 50 \\le 30 \\le 0.4 \\times 100$，简化为 $20 \\le 30 \\le 40$。这是一个真命题。\n因此，对于聚合凸松弛模型存在一个可行点。\n\n**任务2：原始析取模型的不可行性**\n\n原始析取模型要求已启动机组的数量 $n_{on} = \\sum_{i=1}^{3} u_i$ 是一个整数，其中 $u_i \\in \\{0, 1\\}$。总功率输出 $P_{total} = \\sum_{i=1}^{3} p_i$ 必须等于负荷 $D=30$ MW。每个运行中的机组 $i$（$u_i=1$）必须在 $[P^{\\min}, P^{\\max}]$（即 $[50, 100]$）范围内发电 $p_i$。\n\n让我们根据已启动机组的整数数量 $n_{on} \\in \\{0, 1, 2, 3\\}$ 来分析可能的可行总功率输出。\n-   如果 $n_{on} = 0$：所有机组都关闭（对所有 $i$ 都有 $u_i=0$），所以对所有 $i$ 都有 $p_i=0$。总功率输出为 $P_{total} = 0$ MW。这不等于负荷 $D=30$ MW。\n-   如果 $n_{on} = 1$：一台机组开启。其功率输出 $p_1$ 必须在 $[50, 100]$ 范围内。因此，总功率 $P_{total} = p_1$ 也必须在 $[50, 100]$ MW 范围内。所需的负荷 $D=30$ MW 在此范围之外。\n-   如果 $n_{on} = 2$：两台机组开启。总功率输出 $P_{total} = p_1 + p_2$ 必须在 $[2 \\times P^{\\min}, 2 \\times P^{\\max}]$ 范围内，即 $[2 \\times 50, 2 \\times 100] = [100, 200]$ MW。所需的负荷 $D=30$ MW 在此范围之外。\n-   如果 $n_{on} = 3$：三台机组开启。总功率输出 $P_{total} = p_1 + p_2 + p_3$ 必须在 $[3 \\times P^{\\min}, 3 \\times P^{\\max}]$ 范围内，即 $[3 \\times 50, 3 \\times 100] = [150, 300]$ MW。所需的负荷 $D=30$ MW 在此范围之外。\n\n由于对于任何可能的已启动机组整数数量，可实现的总功率输出范围都不包含 $D=30$ MW，因此无法满足功率平衡约束。所以，对于给定的数据，原始的析取整数UC模型是不可行的。\n\n**任务3：可行性差距 $G$ 的计算**\n\n可行性差距 $G$ 被定义为原始析取模型的最小可能绝对功率平衡偏差：\n$$G = \\min_{\\substack{u_i \\in \\{0,1\\}\\\\ p_i}} \\left| \\sum_{i=1}^{N} p_i - D \\right| \\quad \\text{subject to } (u_i,p_i) \\in \\mathcal{S}$$\n我们需要找到与负荷 $D=30$ MW 最接近的可行总功率输出 $P_{total} = \\sum p_i$。$P_{total}$ 的所有可能值的集合是我们在任务2中找到的范围的并集：\n$$\\text{Feasible } P_{total} \\in \\{0\\} \\cup [50, 100] \\cup [100, 200] \\cup [150, 300]$$\n这可以简化为集合 $\\{0\\} \\cup [50, 300]$。我们要在这个集合中找到一个点，使得它到 $30$ 的距离最小。\n\n我们对集合的两个不相交部分分别评估距离：\n1.  对于点 $P_{total}=0$，不匹配量为 $|0 - 30| = 30$。\n2.  对于区间 $P_{total} \\in [50, 300]$，最接近 $30$ 的点是区间的下界，即 $50$。不匹配量为 $|50 - 30| = 20$。\n\n比较这两个最小不匹配量，$\\min(30, 20) = 20$。\n因此，可行性差距为 $G = 20$ MW。四舍五入到四位有效数字得到 $20.00$。\n\n**运行方面的影响**\n\n聚合松弛模型存在可行解而原始整数模型不存在，这突显了“松弛差距”。聚合模型因其凸性和计算易处理性而常用于经济调度，它产生了一个解 $(y,p)=(0.4, 30)$，这个解在经济上是可取的（精确满足负荷），但用给定的离散机组在物理上是无法实现的。\n\n可行性差距 $G=20$ MW 量化了物理现实必须偏离松弛模型目标的最小程度。为了满足 $30$ MW 的负荷，物理上最接近的可实现调度是启动一台机组，并使其在最小稳定水平 $P^{\\min}=50$ MW 下运行。这导致了 $50 - 30 = 20$ MW 的功率盈余，这恰好是 $G$ 的值。\n\n其运行方面的影响是，为了实现聚合模型所建议的经济结果（即完美满足 $30$ MW 的负荷），系统运营商必须采取额外的、在简单的UC模型中未包含的物理操作。这些操作必须管理 $20$ MW 的过度发电。这可能包括：\n-   **弃电：** 有意浪费或“抛弃”多余的 $20$ MW 功率。\n-   **储能：** 将多余的 $20$ MW 功率引导至储能系统，如电池或抽水蓄能。\n-   **辅助服务：** 使用电网上的其他资源，如快速爬坡发电机或需求侧响应，来吸收盈余功率。\n\n本质上，可行性差距 $G$ 代表了为弥合连续的、经济最优的松弛模型与离散的、受物理约束的现实之间的差异，所需要由辅助服务或其他模型外机制提供的最小纠正措施量（单位：MW）。",
            "answer": "$$\\boxed{20.00}$$"
        }
    ]
}