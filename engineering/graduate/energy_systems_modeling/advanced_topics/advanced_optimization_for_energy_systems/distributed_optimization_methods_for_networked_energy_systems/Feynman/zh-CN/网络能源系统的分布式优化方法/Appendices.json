{
    "hands_on_practices": [
        {
            "introduction": "掌握分布式优化的第一步是理解其基础机制。对偶上升法是其中一种最基本的方法，它通过一个“价格”信号（即对偶变量）来协调多个自治代理的行为，以满足共享的资源约束。这项练习  提供了一个具体的计算过程，让您亲手体验对偶价格如何根据资源稀缺性进行调整，并引导局部决策趋向全局最优。",
            "id": "4085630",
            "problem": "考虑一个网络化的多能源系统，该系统有两个本地代理，通过一个具有有限热通量的共享天然气馈线耦合。代理 $1$ 是一个带有热电联产 (CHP) 单元的微电网，代理 $2$ 是一个带有锅炉的工业供热厂。在单个调度间隔内，每个代理 $i \\in \\{1,2\\}$ 选择其天然气热功率消耗 $u_{i}$（单位为 $\\mathrm{MW_{th}}$），以追踪由本地多能源需求得出的期望设定点 $t_{i}$。本地追踪的非效用被建模为凸二次成本 $c_{i}(u_{i}) = \\frac{1}{2} a_{i} (u_{i} - t_{i})^{2}$，并且每个代理必须遵守本地边界 $0 \\leq u_{i} \\leq U_{i}^{\\max}$。网络级的耦合约束是馈线通量限制 $\\sum_{i=1}^{2} u_{i} \\leq G^{\\max}$。\n\n假设一个中心化的规划器旨在最小化 $\\sum_{i=1}^{2} c_{i}(u_{i})$，同时满足耦合约束和本地边界，并应用拉格朗日对偶上升 (DA) 方法，其中对偶变量 $\\lambda \\geq 0$ 代表每单位天然气通量的边际价格（影子成本）。对于给定的对偶价格 $\\lambda$，每个代理求解其由 $\\lambda$ 参数化的本地问题，并返回 $u_{i}^{\\star}(\\lambda)$。然后，规划器使用耦合约束的残差通过对偶上升步骤更新 $\\lambda$，并将其投影到非负象限上，以确保 $\\lambda \\geq 0$。\n\n使用以下数值指定且科学合理参数：\n- 代理 $1$：$a_{1} = 3$， $t_{1} = 7\\,\\mathrm{MW_{th}}$， $U_{1}^{\\max} = 9\\,\\mathrm{MW_{th}}$。\n- 代理 $2$：$a_{2} = 2$， $t_{2} = 6\\,\\mathrm{MW_{th}}$， $U_{2}^{\\max} = 10\\,\\mathrm{MW_{th}}$。\n- 馈线限制：$G^{\\max} = 12\\,\\mathrm{MW_{th}}$。\n- 当前对偶价格：$\\lambda^{(0)} = 1\\,\\mathrm{\\$\\,MW_{th}^{-1}}$。\n- 对偶上升步长：$\\rho = 0.4\\,\\mathrm{\\$\\,MW_{th}^{-2}}$。\n\n从 $\\lambda^{(0)}$ 开始，计算一个对偶上升步骤以获得 $\\lambda^{(1)}$。根据拉格朗日对偶性的基本原理，明确确定本地最优决策 $u_{1}^{\\star}(\\lambda^{(0)})$ 和 $u_{2}^{\\star}(\\lambda^{(0)})$，形成耦合残差，并应用投影对偶上升更新。按照指示，以美元每兆瓦热功率为单位表示最终的对偶价格，但最终答案框中仅提供数值。无需四舍五入；报告精确值。",
            "solution": "用户要求对问题陈述进行严格验证，如果问题被认为是有效的，则提供完整的解决方案。\n\n### 第1步：提取给定信息\n-   代理1成本参数：$a_{1} = 3$\n-   代理1设定点：$t_{1} = 7\\,\\mathrm{MW_{th}}$\n-   代理1本地边界：$U_{1}^{\\max} = 9\\,\\mathrm{MW_{th}}$\n-   代理2成本参数：$a_{2} = 2$\n-   代理2设定点：$t_{2} = 6\\,\\mathrm{MW_{th}}$\n-   代理2本地边界：$U_{2}^{\\max} = 10\\,\\mathrm{MW_{th}}$\n-   馈线通量限制：$G^{\\max} = 12\\,\\mathrm{MW_{th}}$\n-   当前对偶价格：$\\lambda^{(0)} = 1\\,\\mathrm{\\$\\,MW_{th}^{-1}}$\n-   对偶上升步长：$\\rho = 0.4\\,\\mathrm{\\$\\,MW_{th}^{-2}}$\n-   代理决策变量：$u_{i}$，对于 $i \\in \\{1,2\\}$\n-   代理成本函数：$c_{i}(u_{i}) = \\frac{1}{2} a_{i} (u_{i} - t_{i})^{2}$\n-   本地约束：$0 \\leq u_{i} \\leq U_{i}^{\\max}$\n-   耦合约束：$\\sum_{i=1}^{2} u_{i} \\leq G^{\\max}$\n-   目标：最小化 $\\sum_{i=1}^{2} c_{i}(u_{i})$\n-   方法：一步投影对偶上升。\n\n### 第2步：使用提取的给定信息进行验证\n1.  **科学依据**：该问题在能源系统的优化与控制领域有充分的依据。它描述了一个经典的经济调度问题，这是电力和能源系统运行中的一个基本任务。使用二次成本函数、线性约束和拉格朗日对偶上升方法是解决此类问题的标准、成熟的技术，特别是在分布式方式下。参数和单位在物理上是一致的。\n2.  **适定性**：目标函数 $\\sum_{i=1}^{2} \\frac{1}{2} a_{i} (u_{i} - t_{i})^{2}$ 是严格凸的，因为 $a_i > 0$。由线性不等式（箱式约束和总和约束）定义的可行域是一个凸且紧凑的集合。这保证了原始问题存在唯一的最优解。计算对偶上升算法的单一步骤是一个明确定义的数学过程。\n3.  **客观性**：问题陈述由精确、量化和技术性的定义和指令组成。它不含任何主观、模糊或基于观点性的语言。\n4.  **完整性和一致性**：执行计算所需的所有数值和函数形式都已提供。无约束最优解 ($u_1 = 7, u_2 = 6$) 的总和为 $13$，这违反了耦合约束 $G^{\\max}=12$，使得该约束有效，问题变得不平凡。本地设定点在其各自的边界内 ($t_1  U_1^{\\max}$ 和 $t_2  U_2^{\\max}$)。没有矛盾之处。\n\n### 第3步：结论与行动\n该问题科学合理、适定且完整。这是一个有效的问题。我将继续进行解答。\n\n中心化规划器要解决的优化问题是：\n$$\n\\min_{u_1, u_2} \\quad J(u_1, u_2) = \\frac{1}{2} a_{1} (u_{1} - t_{1})^{2} + \\frac{1}{2} a_{2} (u_{2} - t_{2})^{2}\n$$\n约束条件为：\n$$\n\\sum_{i=1}^{2} u_{i} \\leq G^{\\max}\n$$\n$$\n0 \\leq u_{i} \\leq U_{i}^{\\max}, \\quad i \\in \\{1, 2\\}\n$$\n\n为了应用对偶上升法，我们通过将一个对偶变量（拉格朗日乘子）$\\lambda \\geq 0$ 与耦合约束 $\\sum_{i=1}^{2} u_{i} - G^{\\max} \\leq 0$ 关联起来，构建拉格朗日函数。本地约束（箱式约束）在每个代理的子问题中显式处理。\n拉格朗日函数 $\\mathcal{L}(u_1, u_2, \\lambda)$ 是：\n$$\n\\mathcal{L}(u_1, u_2, \\lambda) = \\sum_{i=1}^{2} c_{i}(u_{i}) + \\lambda \\left( \\sum_{i=1}^{2} u_{i} - G^{\\max} \\right)\n$$\n通过重新整理各项，拉格朗日函数可以分解为两个独立的问题，每个代理一个，外加一个相对于原始变量 $u_i$ 为常数的项：\n$$\n\\mathcal{L}(u_1, u_2, \\lambda) = \\left[ \\frac{1}{2} a_{1} (u_{1} - t_{1})^{2} + \\lambda u_{1} \\right] + \\left[ \\frac{1}{2} a_{2} (u_{2} - t_{2})^{2} + \\lambda u_{2} \\right] - \\lambda G^{\\max}\n$$\n对于给定的对偶价格 $\\lambda$，每个代理 $i$ 解决其本地子问题，以找到其最优天然气消耗量 $u_i^{\\star}(\\lambda)$：\n$$\nu_{i}^{\\star}(\\lambda) = \\arg\\min_{0 \\leq u_{i} \\leq U_{i}^{\\max}} \\left( \\frac{1}{2} a_{i} (u_{i} - t_{i})^{2} + \\lambda u_{i} \\right)\n$$\n为了找到本地目标的无约束最小化器，我们对 $u_i$ 求导，并令结果为零：\n$$\n\\frac{\\partial}{\\partial u_i} \\left( \\frac{1}{2} a_{i} (u_{i} - t_{i})^{2} + \\lambda u_{i} \\right) = a_{i}(u_{i} - t_{i}) + \\lambda = 0\n$$\n求解 $u_i$ 得到无约束解：\n$$\nu_{i} = t_{i} - \\frac{\\lambda}{a_{i}}\n$$\n有约束解 $u_i^{\\star}(\\lambda)$ 是将该值投影到可行区间 $[0, U_{i}^{\\max}]$ 上的结果：\n$$\nu_{i}^{\\star}(\\lambda) = \\max\\left(0, \\min\\left(U_{i}^{\\max}, t_{i} - \\frac{\\lambda}{a_{i}}\\right)\\right)\n$$\n我们给定的初始对偶价格为 $\\lambda^{(0)} = 1$。我们首先计算最优的本地决策 $u_{1}^{\\star}(\\lambda^{(0)})$ 和 $u_{2}^{\\star}(\\lambda^{(0)})$。\n\n对于代理 $1$：$a_1=3$, $t_1=7$, $U_1^{\\max}=9$。\n$$\nu_{1}^{\\text{unc}}(\\lambda^{(0)}) = t_{1} - \\frac{\\lambda^{(0)}}{a_{1}} = 7 - \\frac{1}{3} = \\frac{21 - 1}{3} = \\frac{20}{3}\n$$\n由于 $0 \\leq \\frac{20}{3} \\leq 9$ 成立，本地约束未激活。\n$$\nu_{1}^{\\star}(\\lambda^{(0)}) = \\frac{20}{3}\n$$\n\n对于代理 $2$：$a_2=2$, $t_2=6$, $U_2^{\\max}=10$。\n$$\nu_{2}^{\\text{unc}}(\\lambda^{(0)}) = t_{2} - \\frac{\\lambda^{(0)}}{a_{2}} = 6 - \\frac{1}{2} = \\frac{12 - 1}{2} = \\frac{11}{2}\n$$\n由于 $0 \\leq \\frac{11}{2} \\leq 10$ 成立，本地约束未激活。\n$$\nu_{2}^{\\star}(\\lambda^{(0)}) = \\frac{11}{2}\n$$\n\n$\\lambda$ 的投影对偶上升更新规则由下式给出：\n$$\n\\lambda^{(k+1)} = \\left[ \\lambda^{(k)} + \\rho \\left( \\sum_{i=1}^{2} u_{i}^{\\star}(\\lambda^{(k)}) - G^{\\max} \\right) \\right]^{+}\n$$\n其中 $[\\cdot]^{+} = \\max(0, \\cdot)$ 表示投影到非负象限。项 $\\sum u_i^{\\star} - G^{\\max}$ 是对偶函数的（次）梯度。\n\n现在我们计算第一步的梯度项（耦合约束残差），使用上面计算的 $u_i^{\\star}(\\lambda^{(0)})$ 值和馈线限制 $G^{\\max} = 12$：\n$$\n\\sum_{i=1}^{2} u_{i}^{\\star}(\\lambda^{(0)}) - G^{\\max} = u_{1}^{\\star}(1) + u_{2}^{\\star}(1) - 12 = \\frac{20}{3} + \\frac{11}{2} - 12\n$$\n为了对这些值求和，我们找到一个公分母，即 $6$：\n$$\n\\frac{20 \\cdot 2}{6} + \\frac{11 \\cdot 3}{6} - \\frac{12 \\cdot 6}{6} = \\frac{40}{6} + \\frac{33}{6} - \\frac{72}{6} = \\frac{40 + 33 - 72}{6} = \\frac{73 - 72}{6} = \\frac{1}{6}\n$$\n残差为正，表明当前消耗超过了馈线限制，因此对偶价格 $\\lambda$ 应该增加。\n\n最后，我们使用初始价格 $\\lambda^{(0)} = 1$ 和步长 $\\rho = 0.4 = \\frac{2}{5}$ 应用更新规则：\n$$\n\\lambda^{(1)} = \\left[ 1 + (0.4) \\cdot \\left(\\frac{1}{6}\\right) \\right]^{+} = \\left[ 1 + \\frac{2}{5} \\cdot \\frac{1}{6} \\right]^{+}\n$$\n$$\n\\lambda^{(1)} = \\left[ 1 + \\frac{2}{30} \\right]^{+} = \\left[ 1 + \\frac{1}{15} \\right]^{+} = \\left[ \\frac{15}{15} + \\frac{1}{15} \\right]^{+} = \\left[ \\frac{16}{15} \\right]^{+}\n$$\n由于 $\\frac{16}{15} > 0$，投影没有影响。更新后的对偶价格是：\n$$\n\\lambda^{(1)} = \\frac{16}{15}\n$$\n这是一次迭代后对偶变量的值，单位为 $\\mathrm{\\$\\,MW_{th}^{-1}}$。",
            "answer": "$$\\boxed{\\frac{16}{15}}$$"
        },
        {
            "introduction": "在对偶上升法的基础上，交替方向乘子法（ADMM）是一种更强大且应用更广泛的算法。这项练习  将 ADMM 应用于一个实际的网络化能源系统模型预测控制（MPC）问题。您将为一个含两条轨迹的系统构建一个基于一致性的 ADMM 方案，学习如何处理更为复杂的矢量决策变量，这对于解决动态优化问题至关重要。",
            "id": "4085653",
            "problem": "考虑一个由单条联络线连接的双区域网络化能源系统。每个区域实施模型预测控制（MPC），在长度为 $N=3$ 个时间步的有限时域内，规划预测的联络线潮流轨迹。设区域 $i \\in \\{\\text{A}, \\text{B}\\}$ 的有向联络线潮流轨迹由向量 $\\boldsymbol{x}_{i} \\in \\mathbb{R}^{3}$ 表示，其分量单位为兆瓦（MW）。每个区域旨在跟踪一个预测的净需求不匹配量 $\\boldsymbol{d}_{i} \\in \\mathbb{R}^{3}$，同时通过对一阶差分施加二次惩罚来平滑斜率变化。区域 $i$ 的局部凸目标函数为\n$$\nf_{i}(\\boldsymbol{x}_{i}) \\;=\\; \\frac{1}{2}\\|\\boldsymbol{x}_{i} - \\boldsymbol{d}_{i}\\|_{2}^{2} \\;+\\; \\frac{\\gamma_{i}}{2}\\|D \\boldsymbol{x}_{i}\\|_{2}^{2},\n$$\n其中 $D \\in \\mathbb{R}^{2 \\times 3}$ 是一阶差分矩阵\n$$\nD \\;=\\; \\begin{pmatrix}\n1  -1  0 \\\\\n0  1  -1\n\\end{pmatrix},\n$$\n且 $\\gamma_{i} > 0$ 是区域 $i$ 的斜率权重。\n\n为确保预测联络线潮流的物理一致性，两个区域必须就一个共享轨迹达成一致，该轨迹由一个共识变量 $\\boldsymbol{z} \\in \\mathbb{R}^{3}$ 表示，即共识约束 $\\boldsymbol{x}_{\\text{A}} = \\boldsymbol{z}$ 和 $\\boldsymbol{x}_{\\text{B}} = \\boldsymbol{z}$。由此产生的分布式优化问题使用交替方向乘子法（ADMM）求解，其中采用带有缩放对偶变量 $\\boldsymbol{y}_{\\text{A}}$ 和 $\\boldsymbol{y}_{\\text{B}}$、惩罚参数 $\\rho > 0$ 以及标准共识更新的缩放形式交替方向乘子法（ADMM）。\n\n从共识公式的增广拉格朗日函数及其缩放形式出发，构建ADMM方案，写出 $\\boldsymbol{x}_{\\text{A}}^{k+1}$、$\\boldsymbol{x}_{\\text{B}}^{k+1}$、$\\boldsymbol{z}^{k+1}$、$\\boldsymbol{y}_{\\text{A}}^{k+1}$ 和 $\\boldsymbol{y}_{\\text{B}}^{k+1}$ 的显式更新表达式，并将 $\\boldsymbol{x}_{i}$-更新具体化到给定的二次目标函数。然后，使用以下数值参数：\n- 时域长度 $N = 3$，\n- 斜率权重 $\\gamma_{\\text{A}} = 0.2$ 和 $\\gamma_{\\text{B}} = 0.5$，\n- 惩罚参数 $\\rho = 2$，\n- 初始共识变量和对偶变量 $\\boldsymbol{z}^{0} = \\boldsymbol{0}$, $\\boldsymbol{y}_{\\text{A}}^{0} = \\boldsymbol{0}$, $\\boldsymbol{y}_{\\text{B}}^{0} = \\boldsymbol{0}$，\n- 预测的不匹配量 $\\boldsymbol{d}_{\\text{A}} = \\begin{pmatrix}10 \\\\ 8 \\\\ 6\\end{pmatrix}$ MW 和 $\\boldsymbol{d}_{\\text{B}} = \\begin{pmatrix}8 \\\\ 9 \\\\ 7\\end{pmatrix}$ MW，\n在第一次ADMM迭代后（即基于 $\\boldsymbol{y}^{0}$ 执行 $\\boldsymbol{x}$-更新和 $\\boldsymbol{z}$-更新之后），精确计算更新后的共识轨迹 $\\boldsymbol{z}^{1}$ 的第二个分量。最终数值以兆瓦（MW）为单位表示。无需四舍五入。",
            "solution": "首先验证问题，以确保其具有科学依据、适定且客观。\n\n### 步骤1：提取已知条件\n- **系统**：一个双区域网络化能源系统，标记为A和B。\n- **控制时域**：$N=3$。\n- **局部变量**：区域 $i \\in \\{\\text{A}, \\text{B}\\}$ 的联络线潮流轨迹 $\\boldsymbol{x}_{i} \\in \\mathbb{R}^{3}$。\n- **局部目标函数**：$f_{i}(\\boldsymbol{x}_{i}) = \\frac{1}{2}\\|\\boldsymbol{x}_{i} - \\boldsymbol{d}_{i}\\|_{2}^{2} + \\frac{\\gamma_{i}}{2}\\|D \\boldsymbol{x}_{i}\\|_{2}^{2}$。\n- **一阶差分矩阵**：$D = \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix}$。\n- **斜率权重**：$\\gamma_{\\text{A}} = 0.2$ 和 $\\gamma_{\\text{B}} = 0.5$。\n- **共识变量**：$\\boldsymbol{z} \\in \\mathbb{R}^{3}$。\n- **共识约束**：$\\boldsymbol{x}_{\\text{A}} = \\boldsymbol{z}$ 和 $\\boldsymbol{x}_{\\text{B}} = \\boldsymbol{z}$。\n- **算法**：缩放形式的交替方向乘子法（ADMM）。\n- **ADMM参数**：惩罚参数 $\\rho = 2$，缩放对偶变量 $\\boldsymbol{y}_{\\text{A}}, \\boldsymbol{y}_{\\text{B}}$。\n- **初始条件**：$\\boldsymbol{z}^{0} = \\boldsymbol{0}$，$\\boldsymbol{y}_{\\text{A}}^{0} = \\boldsymbol{0}$，$\\boldsymbol{y}_{\\text{B}}^{0} = \\boldsymbol{0}$。\n- **预测的不匹配量**：$\\boldsymbol{d}_{\\text{A}} = \\begin{pmatrix} 10 \\\\ 8 \\\\ 6 \\end{pmatrix}$ MW 和 $\\boldsymbol{d}_{\\text{B}} = \\begin{pmatrix} 8 \\\\ 9 \\\\ 7 \\end{pmatrix}$ MW。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题使用标准的共识优化框架（ADMM）来解决网络化能源系统的模型预测控制（MPC）问题。目标函数由一个跟踪项和一个吉洪诺夫正则化项（用于平滑斜率）组成，是控制和电力系统工程中的标准提法。这是一个成熟且科学合理的问题。\n- **适定性**：目标函数 $f_i$ 是严格凸的，因为它们是欧几里得范数平方和，其中涉及 $D^T D$ 的项是半正定的，其他项是严格凸的。约束是线性的。这定义了一个凸优化问题，它有唯一的解。ADMM是适用于这种结构的算法，并保证收敛到最优解。\n- **客观性**：问题通过精确的数学定义和数值来规定。没有歧义或主观语言。所有必要信息均已提供。\n\n### 步骤3：结论与行动\n问题有效。现在将提供一个完整的、有理有据的解答。\n\n该分布式优化问题是在共识约束下，最小化局部目标之和：\n$$ \\min_{\\boldsymbol{x}_{\\text{A}}, \\boldsymbol{x}_{\\text{B}}, \\boldsymbol{z}} f_{\\text{A}}(\\boldsymbol{x}_{\\text{A}}) + f_{\\text{B}}(\\boldsymbol{x}_{\\text{B}}) \\quad \\text{subject to} \\quad \\boldsymbol{x}_{\\text{A}} = \\boldsymbol{z}, \\boldsymbol{x}_{\\text{B}} = \\boldsymbol{z}. $$\n此问题的缩放形式增广拉格朗日函数 $L_{\\rho}$ 为：\n$$ L_{\\rho}(\\boldsymbol{x}_{\\text{A}}, \\boldsymbol{x}_{\\text{B}}, \\boldsymbol{z}, \\boldsymbol{y}_{\\text{A}}, \\boldsymbol{y}_{\\text{B}}) = \\sum_{i \\in \\{\\text{A},\\text{B}\\}} \\left( f_{i}(\\boldsymbol{x}_{i}) + \\frac{\\rho}{2}\\|\\boldsymbol{x}_{i} - \\boldsymbol{z} + \\boldsymbol{y}_{i}\\|_{2}^{2} - \\frac{\\rho}{2}\\|\\boldsymbol{y}_{i}\\|_{2}^{2} \\right). $$\nADMM方案包含迭代更新。在第 $k+1$ 次迭代中：\n\n1.  **$\\boldsymbol{x}$-更新（对每个区域 $i$ 并行进行）：**\n    $$ \\boldsymbol{x}_{i}^{k+1} = \\arg\\min_{\\boldsymbol{x}_{i}} \\left( f_{i}(\\boldsymbol{x}_{i}) + \\frac{\\rho}{2}\\|\\boldsymbol{x}_{i} - \\boldsymbol{z}^{k} + \\boldsymbol{y}_{i}^{k}\\|_{2}^{2} \\right). $$\n    代入给定的二次目标函数 $f_i$：\n    $$ \\boldsymbol{x}_{i}^{k+1} = \\arg\\min_{\\boldsymbol{x}_{i}} \\left( \\frac{1}{2}\\|\\boldsymbol{x}_{i} - \\boldsymbol{d}_{i}\\|_{2}^{2} + \\frac{\\gamma_{i}}{2}\\|D \\boldsymbol{x}_{i}\\|_{2}^{2} + \\frac{\\rho}{2}\\|\\boldsymbol{x}_{i} - (\\boldsymbol{z}^{k} - \\boldsymbol{y}_{i}^{k})\\|_{2}^{2} \\right). $$\n    目标函数是凸且可微的。我们通过将关于 $\\boldsymbol{x}_{i}$ 的梯度设为零来求最小值：\n    $$ (\\boldsymbol{x}_{i} - \\boldsymbol{d}_{i}) + \\gamma_{i} D^{T}D \\boldsymbol{x}_{i} + \\rho(\\boldsymbol{x}_{i} - (\\boldsymbol{z}^{k} - \\boldsymbol{y}_{i}^{k})) = \\boldsymbol{0}. $$\n    重新整理各项以求解 $\\boldsymbol{x}_{i}$：\n    $$ (I + \\gamma_{i}D^{T}D + \\rho I) \\boldsymbol{x}_{i} = \\boldsymbol{d}_{i} + \\rho(\\boldsymbol{z}^{k} - \\boldsymbol{y}_{i}^{k}). $$\n    $\\boldsymbol{x}_{i}^{k+1}$ 的显式更新表达式为：\n    $$ \\boldsymbol{x}_{i}^{k+1} = \\left((1+\\rho)I + \\gamma_{i}D^{T}D\\right)^{-1} \\left( \\boldsymbol{d}_{i} + \\rho(\\boldsymbol{z}^{k} - \\boldsymbol{y}_{i}^{k}) \\right). $$\n    因此，对于区域 A 和 B，我们有：\n    $$ \\boldsymbol{x}_{\\text{A}}^{k+1} = \\left((1+\\rho)I + \\gamma_{\\text{A}}D^{T}D\\right)^{-1} \\left( \\boldsymbol{d}_{\\text{A}} + \\rho(\\boldsymbol{z}^{k} - \\boldsymbol{y}_{\\text{A}}^{k}) \\right) $$\n    $$ \\boldsymbol{x}_{\\text{B}}^{k+1} = \\left((1+\\rho)I + \\gamma_{\\text{B}}D^{T}D\\right)^{-1} \\left( \\boldsymbol{d}_{\\text{B}} + \\rho(\\boldsymbol{z}^{k} - \\boldsymbol{y}_{\\text{B}}^{k}) \\right) $$\n\n2.  **$\\boldsymbol{z}$-更新：**\n    $$ \\boldsymbol{z}^{k+1} = \\arg\\min_{\\boldsymbol{z}} \\left( \\frac{\\rho}{2}\\|\\boldsymbol{x}_{\\text{A}}^{k+1} - \\boldsymbol{z} + \\boldsymbol{y}_{\\text{A}}^{k}\\|_{2}^{2} + \\frac{\\rho}{2}\\|\\boldsymbol{x}_{\\text{B}}^{k+1} - \\boldsymbol{z} + \\boldsymbol{y}_{\\text{B}}^{k}\\|_{2}^{2} \\right). $$\n    将关于 $\\boldsymbol{z}$ 的梯度设为零：\n    $$ -\\rho(\\boldsymbol{x}_{\\text{A}}^{k+1} - \\boldsymbol{z} + \\boldsymbol{y}_{\\text{A}}^{k}) - \\rho(\\boldsymbol{x}_{\\text{B}}^{k+1} - \\boldsymbol{z} + \\boldsymbol{y}_{\\text{B}}^{k}) = \\boldsymbol{0}. $$\n    求解 $\\boldsymbol{z}$ 得到原始-对偶变量的平均值：\n    $$ \\boldsymbol{z}^{k+1} = \\frac{1}{2}\\left( (\\boldsymbol{x}_{\\text{A}}^{k+1} + \\boldsymbol{y}_{\\text{A}}^{k}) + (\\boldsymbol{x}_{\\text{B}}^{k+1} + \\boldsymbol{y}_{\\text{B}}^{k}) \\right). $$\n\n3.  **$\\boldsymbol{y}$-更新（对偶变量更新）：**\n    $$ \\boldsymbol{y}_{\\text{A}}^{k+1} = \\boldsymbol{y}_{\\text{A}}^{k} + \\boldsymbol{x}_{\\text{A}}^{k+1} - \\boldsymbol{z}^{k+1} $$\n    $$ \\boldsymbol{y}_{\\text{B}}^{k+1} = \\boldsymbol{y}_{\\text{B}}^{k} + \\boldsymbol{x}_{\\text{B}}^{k+1} - \\boldsymbol{z}^{k+1} $$\n\n现在，我们使用给定的数值参数计算第一次迭代（$k=0$）。\n初始值：$\\boldsymbol{z}^{0}=\\boldsymbol{0}$，$\\boldsymbol{y}_{\\text{A}}^{0}=\\boldsymbol{0}$，$\\boldsymbol{y}_{\\text{B}}^{0}=\\boldsymbol{0}$。\n\n首先，计算矩阵 $D^{T}D$：\n$$ D^{T}D = \\begin{pmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{pmatrix} \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} = \\begin{pmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{pmatrix}. $$\n在 $k=0$ 时的 $\\boldsymbol{x}$-更新简化为：\n$$ \\boldsymbol{x}_{i}^{1} = \\left((1+\\rho)I + \\gamma_{i}D^{T}D\\right)^{-1} \\boldsymbol{d}_{i}. $$\n当 $\\rho=2$ 时，我们有 $1+\\rho=3$。\n\n对于区域 A（$\\gamma_{\\text{A}}=0.2$）：\n令 $H_{\\text{A}} = 3I + 0.2 D^{T}D = \\begin{pmatrix} 3  0  0 \\\\ 0  3  0 \\\\ 0  0  3 \\end{pmatrix} + 0.2 \\begin{pmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{pmatrix} = \\begin{pmatrix} 3.2  -0.2  0 \\\\ -0.2  3.4  -0.2 \\\\ 0  -0.2  3.2 \\end{pmatrix}$。\n我们求解 $H_{\\text{A}}\\boldsymbol{x}_{\\text{A}}^{1} = \\boldsymbol{d}_{\\text{A}}$：\n$$ \\begin{pmatrix} 3.2  -0.2  0 \\\\ -0.2  3.4  -0.2 \\\\ 0  -0.2  3.2 \\end{pmatrix} \\begin{pmatrix} x_{\\text{A},1}^{1} \\\\ x_{\\text{A},2}^{1} \\\\ x_{\\text{A},3}^{1} \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 8 \\\\ 6 \\end{pmatrix}. $$\n这是一个线性方程组。使用分数表示法，$H_{\\text{A}} = \\frac{1}{5}\\begin{pmatrix} 16  -1  0 \\\\ -1  17  -1 \\\\ 0  -1  16 \\end{pmatrix}$。方程组变为 $\\begin{pmatrix} 16  -1  0 \\\\ -1  17  -1 \\\\ 0  -1  16 \\end{pmatrix}\\boldsymbol{x}_{\\text{A}}^{1} = 5\\boldsymbol{d}_{\\text{A}} = \\begin{pmatrix} 50 \\\\ 40 \\\\ 30 \\end{pmatrix}$。\n解此方程组可得 $x_{\\text{A},1}^{1} = \\frac{79}{24}$，$x_{\\text{A},2}^{1} = \\frac{8}{3}$，以及 $x_{\\text{A},3}^{1} = \\frac{49}{24}$。所以，$\\boldsymbol{x}_{\\text{A}}^{1} = \\begin{pmatrix} 79/24 \\\\ 8/3 \\\\ 49/24 \\end{pmatrix}$。\n\n对于区域 B（$\\gamma_{\\text{B}}=0.5$）：\n令 $H_{\\text{B}} = 3I + 0.5 D^{T}D = \\begin{pmatrix} 3  0  0 \\\\ 0  3  0 \\\\ 0  0  3 \\end{pmatrix} + 0.5 \\begin{pmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{pmatrix} = \\begin{pmatrix} 3.5  -0.5  0 \\\\ -0.5  4  -0.5 \\\\ 0  -0.5  3.5 \\end{pmatrix}$。\n我们求解 $H_{\\text{B}}\\boldsymbol{x}_{\\text{B}}^{1} = \\boldsymbol{d}_{\\text{B}}$：\n$$ \\begin{pmatrix} 3.5  -0.5  0 \\\\ -0.5  4  -0.5 \\\\ 0  -0.5  3.5 \\end{pmatrix} \\begin{pmatrix} x_{\\text{B},1}^{1} \\\\ x_{\\text{B},2}^{1} \\\\ x_{\\text{B},3}^{1} \\end{pmatrix} = \\begin{pmatrix} 8 \\\\ 9 \\\\ 7 \\end{pmatrix}. $$\n使用分数表示法，$H_{\\text{B}} = \\frac{1}{2}\\begin{pmatrix} 7  -1  0 \\\\ -1  8  -1 \\\\ 0  -1  7 \\end{pmatrix}$。方程组变为 $\\begin{pmatrix} 7  -1  0 \\\\ -1  8  -1 \\\\ 0  -1  7 \\end{pmatrix}\\boldsymbol{x}_{\\text{B}}^{1} = 2\\boldsymbol{d}_{\\text{B}} = \\begin{pmatrix} 16 \\\\ 18 \\\\ 14 \\end{pmatrix}$。\n解此方程组可得 $x_{\\text{B},1}^{1} = \\frac{170}{63}$，$x_{\\text{B},2}^{1} = \\frac{26}{9}$，以及 $x_{\\text{B},3}^{1} = \\frac{152}{63}$。所以，$\\boldsymbol{x}_{\\text{B}}^{1} = \\begin{pmatrix} 170/63 \\\\ 26/9 \\\\ 152/63 \\end{pmatrix}$。\n\n接下来，我们对 $k=0$ 进行 $\\boldsymbol{z}$-更新。由于 $\\boldsymbol{y}_{\\text{A}}^{0} = \\boldsymbol{0}$ 且 $\\boldsymbol{y}_{\\text{B}}^{0} = \\boldsymbol{0}$，更新表达式就是 $\\boldsymbol{x}^{1}$ 变量的平均值：\n$$ \\boldsymbol{z}^{1} = \\frac{1}{2}(\\boldsymbol{x}_{\\text{A}}^{1} + \\boldsymbol{x}_{\\text{B}}^{1}). $$\n问题要求计算 $\\boldsymbol{z}^{1}$ 的第二个分量，记为 $z_{2}^{1}$：\n$$ z_{2}^{1} = \\frac{1}{2}(x_{\\text{A},2}^{1} + x_{\\text{B},2}^{1}). $$\n代入计算出的值：\n$$ z_{2}^{1} = \\frac{1}{2}\\left(\\frac{8}{3} + \\frac{26}{9}\\right). $$\n为了将分数相加，我们找到一个公分母：\n$$ z_{2}^{1} = \\frac{1}{2}\\left(\\frac{8 \\times 3}{3 \\times 3} + \\frac{26}{9}\\right) = \\frac{1}{2}\\left(\\frac{24}{9} + \\frac{26}{9}\\right). $$\n$$ z_{2}^{1} = \\frac{1}{2}\\left(\\frac{24+26}{9}\\right) = \\frac{1}{2}\\left(\\frac{50}{9}\\right). $$\n$$ z_{2}^{1} = \\frac{25}{9}. $$\n更新后的共识轨迹 $\\boldsymbol{z}^{1}$ 的第二个分量是 $\\frac{25}{9}$ MW。",
            "answer": "$$ \\boxed{\\frac{25}{9}} $$"
        },
        {
            "introduction": "在实际应用任何迭代算法时，一个关键问题是确定何时停止计算。这项练习  深入探讨了 ADMM 的收敛性与终止准则。通过推导和计算原始残差与对偶残差，您将学会如何量化算法在每一次迭代中的进展，并了解如何基于这些度量来设定稳健的停止条件，这是有效实现 ADMM 算法的核心技能。",
            "id": "4085665",
            "problem": "考虑一个网络化能源系统的分布式经济调度问题，该系统包含三个通过一致性变量协调的代理（微电网），并使用交替方向乘子法（ADMM; Alternating Direction Method of Multipliers）进行建模。设三个代理的发电决策分别为 $g_1, g_2, g_3$，并将它们堆叠成一个向量 $g = (g_1, g_2, g_3)^\\top \\in \\mathbb{R}^{3}$。全局一致性信号为 $z \\in \\mathbb{R}$，一致性约束为 $g_{i} = z$，其中 $i \\in \\{1,2,3\\}$。将此约束写为 $A g + B z = c$ 的形式，其中 $A = I_{3}$，$B = -\\mathbf{1}_{3}$，$c = \\mathbf{0}_{3}$，$I_{3}$ 是 $3 \\times 3$ 的单位矩阵，$\\mathbf{1}_{3}$ 是 $3 \\times 1$ 的全1向量。所有量都以共享基准下的标幺值（无量纲）表示。\n\n从增广拉格朗日量的定义和线性约束凸规划的 Karush-Kuhn-Tucker (KKT) 条件出发，推导 ADMM 缩放形式下的原始残差 $r^{k}$ 和对偶残差 $s^{k}$，用 $A$、$B$、$c$、$g^{k}$、$z^{k}$ 和 $z^{k-1}$ 表示。然后，基于原始和对偶可行性容差 $\\epsilon_{\\mathrm{pri}}$ 和 $\\epsilon_{\\mathrm{dual}}$ 定义停止准则，使用标准的绝对容差 $\\epsilon_{\\mathrm{abs}}$ 和相对容差 $\\epsilon_{\\mathrm{rel}}$，以及未缩放的对偶变量 $y^{k} = \\rho u^{k}$，其中 $u^{k}$ 是缩放对偶变量，$\\rho > 0$ 是惩罚参数。\n\n最后，对于 ADMM 的某次迭代 $k$，根据给定数据计算范数 $\\| r^{k} \\|_{2}$ 和 $\\| s^{k} \\|_{2}$ 以及容差 $\\epsilon_{\\mathrm{pri}}$ 和 $\\epsilon_{\\mathrm{dual}}$ 的数值：\n- $g^{k} = \\begin{pmatrix} 1.023 \\\\ 0.978 \\\\ 0.999 \\end{pmatrix}$,\n- $z^{k} = 1.000$,\n- $z^{k-1} = 0.994$,\n- $u^{k} = \\begin{pmatrix} 0.15 \\\\ -0.20 \\\\ 0.05 \\end{pmatrix}$,\n- $\\rho = 0.8$,\n- $\\epsilon_{\\mathrm{abs}} = 10^{-3}$,\n- $\\epsilon_{\\mathrm{rel}} = 10^{-2}$.\n\n将您的最终结果表示为行向量 $\\left( \\| r^{k} \\|_{2}, \\| s^{k} \\|_{2}, \\epsilon_{\\mathrm{pri}}, \\epsilon_{\\mathrm{dual}} \\right)$，并四舍五入到四位有效数字。由于所有量均为标幺值，最终数值无需物理单位。",
            "solution": "我们从标准的凸线性约束规划形式开始\n$$\n\\min_{g,\\,z} \\; f(g) + h(z) \\quad \\text{subject to} \\quad A g + B z = c,\n$$\n其中 $A = I_{3}$，$B = -\\mathbf{1}_{3}$，$c = \\mathbf{0}_{3}$，用以编码一致性约束 $g_{i} = z$，$i \\in \\{1,2,3\\}$。对于惩罚参数 $\\rho > 0$ 和未缩放的对偶变量 $y$，其增广拉格朗日量为\n$$\n\\mathcal{L}_{\\rho}(g, z, y) \\;=\\; f(g) + h(z) + y^{\\top}\\!\\left(A g + B z - c \\right) + \\frac{\\rho}{2} \\left\\| A g + B z - c \\right\\|_{2}^{2}.\n$$\n交替方向乘子法 (ADMM) 通过对 $g$ 和 $z$ 的交替最小化以及对偶上升步骤进行。在 ADMM 的缩放形式中，我们使用缩放对偶变量 $u^{k} = \\frac{1}{\\rho} y^{k}$，并将第 $k$ 次迭代的原始残差定义为线性约束的违反量，\n$$\nr^{k} \\;=\\; A g^{k} + B z^{k} - c.\n$$\n对偶残差源于关于 $g$ 的平稳性条件，并捕捉了由约束中的耦合项加权的 $z$ 迭代量的变化。其在缩放 ADMM 中的标准表达式为\n$$\ns^{k} \\;=\\; \\rho\\, A^{\\top} B \\left( z^{k} - z^{k-1} \\right).\n$$\n对于我们特定的具有 $A = I_{3}$ 和 $B = -\\mathbf{1}_{3}$ 的一致性约束，这些表达式可简化为\n$$\nr^{k} \\;=\\; g^{k} - \\mathbf{1}_{3} z^{k}, \\qquad s^{k} \\;=\\; -\\,\\rho\\, \\mathbf{1}_{3} \\left( z^{k} - z^{k-1} \\right).\n$$\n\nADMM 停止准则将原始和对偶残差的范数与由绝对和相对分量组成的容差进行比较。原始容差为\n$$\n\\epsilon_{\\mathrm{pri}} \\;=\\; \\sqrt{p}\\, \\epsilon_{\\mathrm{abs}} \\;+\\; \\epsilon_{\\mathrm{rel}}\\, \\max\\!\\left\\{ \\left\\| A g^{k} \\right\\|_{2},\\, \\left\\| B z^{k} \\right\\|_{2},\\, \\left\\| c \\right\\|_{2} \\right\\},\n$$\n其中 $p$ 是约束的维度（此处 $p = 3$）。对偶容差为\n$$\n\\epsilon_{\\mathrm{dual}} \\;=\\; \\sqrt{n}\\, \\epsilon_{\\mathrm{abs}} \\;+\\; \\epsilon_{\\mathrm{rel}}\\, \\left\\| A^{\\top} y^{k} \\right\\|_{2},\n$$\n其中 $n$ 是 $g$ 的维度（此处 $n = 3$），$y^{k} = \\rho\\, u^{k}$ 是未缩放的对偶变量。\n\n现在，我们根据给定的迭代数据数值计算所要求的量。\n\n首先，原始残差\n$$\nr^{k} \\;=\\; g^{k} - \\mathbf{1}_{3} z^{k} \\;=\\; \\begin{pmatrix} 1.023 \\\\ 0.978 \\\\ 0.999 \\end{pmatrix} - \\begin{pmatrix} 1.000 \\\\ 1.000 \\\\ 1.000 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0.023 \\\\ -0.022 \\\\ -0.001 \\end{pmatrix}.\n$$\n其欧几里得范数为\n$$\n\\| r^{k} \\|_{2} \\;=\\; \\sqrt{(0.023)^{2} + (-0.022)^{2} + (-0.001)^{2}} \\;=\\; \\sqrt{0.000529 + 0.000484 + 0.000001} \\;=\\; \\sqrt{0.001014}.\n$$\n\n其次，对偶残差\n$$\ns^{k} \\;=\\; -\\,\\rho\\, \\mathbf{1}_{3} \\left( z^{k} - z^{k-1} \\right) \\;=\\; -\\,0.8\\, \\mathbf{1}_{3} \\left( 1.000 - 0.994 \\right) \\;=\\; -\\,0.8\\, \\mathbf{1}_{3} \\cdot 0.006 \\;=\\; -\\,0.0048\\, \\mathbf{1}_{3}.\n$$\n其欧几里得范数为\n$$\n\\| s^{k} \\|_{2} \\;=\\; \\| -0.0048\\, \\mathbf{1}_{3} \\|_{2} \\;=\\; 0.0048\\, \\| \\mathbf{1}_{3} \\|_{2} \\;=\\; 0.0048\\, \\sqrt{3}.\n$$\n\n第三，原始容差需要计算 $\\| A g^{k} \\|_{2}$、$\\| B z^{k} \\|_{2}$ 和 $\\| c \\|_{2}$。我们有\n$$\n\\| A g^{k} \\|_{2} \\;=\\; \\| g^{k} \\|_{2} \\;=\\; \\sqrt{(1.023)^{2} + (0.978)^{2} + (0.999)^{2}} \\;=\\; \\sqrt{1.046529 + 0.956484 + 0.998001} \\;=\\; \\sqrt{3.001014},\n$$\n$$\n\\| B z^{k} \\|_{2} \\;=\\; \\| -\\mathbf{1}_{3} \\cdot 1.000 \\|_{2} \\;=\\; \\| \\mathbf{1}_{3} \\|_{2} \\cdot |1.000| \\;=\\; \\sqrt{3},\n$$\n$$\n\\| c \\|_{2} \\;=\\; \\| \\mathbf{0}_{3} \\|_{2} \\;=\\; 0.\n$$\n因此，\n$$\n\\epsilon_{\\mathrm{pri}} \\;=\\; \\sqrt{3}\\, \\epsilon_{\\mathrm{abs}} \\;+\\; \\epsilon_{\\mathrm{rel}} \\cdot \\max\\!\\left\\{ \\sqrt{3.001014},\\, \\sqrt{3},\\, 0 \\right\\} \\;=\\; \\sqrt{3}\\cdot 10^{-3} \\;+\\; 10^{-2} \\cdot \\sqrt{3.001014}.\n$$\n\n第四，为了计算对偶容差，我们计算 $y^{k} = \\rho\\, u^{k} = 0.8 \\begin{pmatrix} 0.15 \\\\ -0.20 \\\\ 0.05 \\end{pmatrix} = \\begin{pmatrix} 0.12 \\\\ -0.16 \\\\ 0.04 \\end{pmatrix}$。然后，由于 $A^{\\top} = I_{3}$，\n$$\n\\| A^{\\top} y^{k} \\|_{2} \\;=\\; \\| y^{k} \\|_{2} \\;=\\; \\sqrt{(0.12)^{2} + (-0.16)^{2} + (0.04)^{2}} \\;=\\; \\sqrt{0.0144 + 0.0256 + 0.0016} \\;=\\; \\sqrt{0.0416}.\n$$\n因此，\n$$\n\\epsilon_{\\mathrm{dual}} \\;=\\; \\sqrt{3}\\, \\epsilon_{\\mathrm{abs}} \\;+\\; \\epsilon_{\\mathrm{rel}} \\cdot \\| A^{\\top} y^{k} \\|_{2} \\;=\\; \\sqrt{3}\\cdot 10^{-3} \\;+\\; 10^{-2} \\cdot \\sqrt{0.0416}.\n$$\n\n汇总数值：\n- $\\| r^{k} \\|_{2} = \\sqrt{0.001014}$,\n- $\\| s^{k} \\|_{2} = 0.0048\\, \\sqrt{3}$,\n- $\\epsilon_{\\mathrm{pri}} = \\sqrt{3}\\cdot 10^{-3} + 10^{-2}\\cdot \\sqrt{3.001014}$,\n- $\\epsilon_{\\mathrm{dual}} = \\sqrt{3}\\cdot 10^{-3} + 10^{-2}\\cdot \\sqrt{0.0416}$.\n\n数值计算并四舍五入到四位有效数字：\n- $\\| r^{k} \\|_{2} \\approx 0.03184$,\n- $\\| s^{k} \\|_{2} \\approx 0.008314$,\n- $\\epsilon_{\\mathrm{pri}} \\approx 0.01906$,\n- $\\epsilon_{\\mathrm{dual}} \\approx 0.003772$.\n\n因此，所求的行向量为 $\\left( \\| r^{k} \\|_{2}, \\| s^{k} \\|_{2}, \\epsilon_{\\mathrm{pri}}, \\epsilon_{\\mathrm{dual}} \\right)$，其值为上述四舍五入后的数值。",
            "answer": "$$\\boxed{\\begin{pmatrix}0.03184  0.008314  0.01906  0.003772\\end{pmatrix}}$$"
        }
    ]
}