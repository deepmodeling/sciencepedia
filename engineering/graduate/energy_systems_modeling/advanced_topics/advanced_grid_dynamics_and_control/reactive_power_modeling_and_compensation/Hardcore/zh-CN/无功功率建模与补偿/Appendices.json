{
    "hands_on_practices": [
        {
            "introduction": "在电力系统中，管理无功功率对于提高效率和降低成本至关重要，尤其是在工业环境中。本练习提供了一个典型的工程场景：通过计算来确定改善一个大型工业负载功率因数所需的无功补偿量。通过这个实践，您将巩固对功率三角形（$P$、$Q$、$S$）之间关系的理解，并掌握如何设计补偿方案以达到指定的运行目标。",
            "id": "4115151",
            "problem": "一个平衡的三相工业负载连接到线电压为 $V = 13.8\\,\\mathrm{kV}$ 的中压母线上，消耗有功功率 $P = 10\\,\\mathrm{MW}$，测得的滞后功率因数（power factor）为 $\\mathrm{pf} = 0.85$。系统在稳态正弦条件下运行，母线电压保持稳定。假设采用常规符号约定，即感性无功功率为正，容性无功功率为负。现需在同一母线上安装一台并联静止补偿器，该补偿器可视为理想无功功率源（纯无功、无损耗且谐波可忽略不计），以将功率因数提高到一个新的滞后值 $\\mathrm{pf} = 0.98$，同时保持相同的有功功率传输。\n\n请仅使用交流稳态下复功率的基本定义和功率因数的定义，确定初始工作点和补偿后工作点的以下三个量：负载吸收的初始无功功率 $Q$、初始视在功率幅值 $\\lvert S \\rvert$，以及为达到目标功率因数所需的并联无功补偿的幅值。请将 $Q$ 和所需无功补偿的最终值以兆乏 $\\left(\\mathrm{MVAr}\\right)$ 为单位表示，将 $\\lvert S \\rvert$ 以兆伏安 $\\left(\\mathrm{MVA}\\right)$ 为单位表示。将所需补偿的幅值报告为正数，并理解为它是在母线上以容性方式提供的。答案四舍五入至三位有效数字。",
            "solution": "在尝试任何解答之前，首先对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n- 母线线电压：$V = 13.8\\,\\mathrm{kV}$\n- 负载消耗的有功功率：$P = 10\\,\\mathrm{MW}$\n- 初始功率因数：$\\mathrm{pf}_1 = 0.85$ (滞后)\n- 目标功率因数：$\\mathrm{pf}_2 = 0.98$ (滞后)\n- 约束条件：保持有功功率传输不变（$P$ 为常数）。\n- 系统条件：平衡三相，稳态正弦。\n- 补偿器模型：理想无功功率源（无损，纯无功）。\n- 符号约定：感性无功功率为正 ($Q > 0$)；容性无功功率为负 ($Q  0$)。\n- 要求输出：初始无功功率 $Q_1$、初始视在功率幅值 $|\\boldsymbol{S}_1|$，以及所需并联无功补偿的幅值 $|Q_{\\text{comp}}|$。\n- 报告要求：将最终值四舍五入至三位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n对问题的有效性进行评估：\n- **科学依据**：该问题基于交流 (AC) 电力系统的基本原理，特别是关于有功功率、无功功率、视在功率和功率因数之间的关系。这些概念是电力工程的基石。使用并联补偿来提高工业负载功率因数的场景是这些原理的经典且实用的应用。\n- **提法恰当**：该问题提供了确定所求量所需的所有必要数据。给定变量和目标变量之间的关系在电气理论中有明确定义，确保存在唯一解。\n- **客观性**：该问题使用清晰、明确且标准的电气工程术语进行陈述。“功率因数”、“滞后”、“有功功率”和“无功功率”等术语具有精确的数学定义。\n\n### 第 3 步：结论与行动\n该问题在科学上是合理的、自洽的且提法恰当。它是一个电力系统分析的标准练习，没有任何逻辑矛盾、物理上不可能或事实不准确之处。因此，该问题被视为 **有效的**，并将提供解答。\n\n### 解题推导\n复功率 ($\\boldsymbol{S}$)、有功功率 ($P$) 和无功功率 ($Q$) 之间的关系由表达式 $\\boldsymbol{S} = P + jQ$ 给出，其中 $j$ 是虚数单位。复功率的幅值是视在功率 $|\\boldsymbol{S}|$，它通过功率三角形关系与 $P$ 和 $Q$ 相关联：$|\\boldsymbol{S}|^2 = P^2 + Q^2$。\n\n功率因数 $\\mathrm{pf}$ 定义为功率角 $\\theta$ 的余弦，功率角是电压和电流之间的相位差，也是复功率矢量 $\\boldsymbol{S}$ 相对于有功功率轴的角度。它由 $\\mathrm{pf} = \\cos(\\theta) = \\frac{P}{|\\boldsymbol{S}|}$ 给出。\n\n“滞后”功率因数表示感性负载，其中电流滞后于电压。根据指定的符号约定，这对应于正的无功功率，$Q > 0$。$P$、$Q$ 和 $\\theta$ 之间的关系是 $Q = P \\tan(\\theta)$。由于 $\\theta = \\arccos(\\mathrm{pf})$，我们可以写出 $Q = P \\tan(\\arccos(\\mathrm{pf}))$。\n\n问题分为两部分：分析初始状态和确定达到最终状态所需的补偿。\n\n**1. 初始工作点**\n\n初始状态的特点是有功功率 $P_1 = 10\\,\\mathrm{MW}$ 和滞后功率因数 $\\mathrm{pf}_1 = 0.85$。\n\n首先，我们计算初始视在功率幅值 $|\\boldsymbol{S}_1|$：\n$$\n|\\boldsymbol{S}_1| = \\frac{P_1}{\\mathrm{pf}_1} = \\frac{10\\,\\mathrm{MW}}{0.85} \\approx 11.7647\\,\\mathrm{MVA}\n$$\n四舍五入到三位有效数字，我们得到 $|\\boldsymbol{S}_1| \\approx 11.8\\,\\mathrm{MVA}$。\n\n接下来，我们计算初始无功功率 $Q_1$。由于功率因数是滞后的，所以 $Q_1$ 为正。\n功率角为 $\\theta_1 = \\arccos(\\mathrm{pf}_1) = \\arccos(0.85)$。\n$$\nQ_1 = P_1 \\tan(\\theta_1) = (10\\,\\mathrm{MW}) \\times \\tan(\\arccos(0.85))\n$$\n使用三角恒等式 $\\tan(\\arccos(x)) = \\frac{\\sqrt{1 - x^2}}{x}$，我们有：\n$$\nQ_1 = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - (0.85)^2}}{0.85} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - 0.7225}}{0.85} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{0.2775}}{0.85} \\approx 6.1974\\,\\mathrm{MVAr}\n$$\n四舍五入到三位有效数字，初始无功功率为 $Q_1 \\approx 6.20\\,\\mathrm{MVAr}$。\n\n**2. 补偿后工作点及所需补偿**\n\n目标是达到新的滞后功率因数 $\\mathrm{pf}_2 = 0.98$，同时保持有功功率传输不变，因此 $P_2 = P_1 = 10\\,\\mathrm{MW}$。并联补偿器是纯无功的，不消耗也不提供有功功率。\n\n补偿后从电源吸收的新无功功率 $Q_2$ 的计算方法与初始状态类似：\n新的功率角为 $\\theta_2 = \\arccos(\\mathrm{pf}_2) = \\arccos(0.98)$。\n$$\nQ_2 = P_2 \\tan(\\theta_2) = (10\\,\\mathrm{MW}) \\times \\tan(\\arccos(0.98))\n$$\n$$\nQ_2 = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - (0.98)^2}}{0.98} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - 0.9604}}{0.98} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{0.0396}}{0.98} \\approx 2.0306\\,\\mathrm{MVAr}\n$$\n补偿器提供的无功功率 $Q_{\\text{comp}}$ 是补偿后的总无功功率 ($Q_2$) 与负载吸收的初始无功功率 ($Q_1$) 之差。总无功功率是负载无功功率和补偿器无功功率的代数和：$Q_2 = Q_1 + Q_{\\text{comp}}$。\n$$\nQ_{\\text{comp}} = Q_2 - Q_1 \\approx 2.0306\\,\\mathrm{MVAr} - 6.1974\\,\\mathrm{MVAr} \\approx -4.1668\\,\\mathrm{MVAr}\n$$\n负号表示补偿器提供容性无功功率，这符合预期，因为需要减少系统的净感性（滞后）无功功率。\n\n问题要求的是所需并联无功补偿的幅值。\n$$\n|Q_{\\text{comp}}| \\approx |-4.1668\\,\\mathrm{MVAr}| = 4.1668\\,\\mathrm{MVAr}\n$$\n四舍五入到三位有效数字，补偿的幅值为 $|Q_{\\text{comp}}| \\approx 4.17\\,\\mathrm{MVAr}$。\n\n总结要求的值（四舍五入到三位有效数字）：\n- 初始无功功率：$Q_1 = 6.20\\,\\mathrm{MVAr}$\n- 初始视在功率幅值：$|\\boldsymbol{S}_1| = 11.8\\,\\mathrm{MVA}$\n- 所需无功补偿的幅值：$|Q_{\\text{comp}}| = 4.17\\,\\mathrm{MVAr}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 6.20  11.8  4.17 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "无功功率的平衡不仅涉及负载侧的补偿，更取决于发电侧的供应能力。同步发电机是电网无功功率的主要来源，但其输出能力并非无限，而是受到其物理设计和运行安全的严格限制。本练习将引导您从发电机的稳态模型出发，推导其在特定有功出力下的无功功率调节范围，即“无功功率灵活性”，并识别出决定其极限运行点的关键约束条件。",
            "id": "4115163",
            "problem": "一台三相同步发电机在稳态下进行建模，使用标准的每相相量关系，并忽略定子电阻和磁饱和。该发电机连接到一个强交流（AC）母线，使其端电压幅值保持恒定。该发电机的额定视在功率为 $S_{\\text{rated}} = 400\\,\\mathrm{MVA}$，其额定有功功率 $P_{\\text{rated}}$ 等于在单位功率因数下的 $S_{\\text{rated}}$。选择的标幺值（pu）基准为 $S_{\\text{base}} = S_{\\text{rated}}$，端电压幅值为 $V = 1.0\\,\\mathrm{pu}$。直轴同步电抗为 $X_{d} = 1.0\\,\\mathrm{pu}$。该发电机配备了保护装置，施加了定子电流幅值限制 $|I| \\leq I_{\\max}$，其中 $I_{\\max} = 1.0\\,\\mathrm{pu}$；以及一个励磁系统，施加了内电动势（EMF）幅值限制 $E \\leq E_{\\max}$，其中 $E_{\\max} = 1.5\\,\\mathrm{pu}$。该发电机在有功功率 $P = 0.8\\,P_{\\text{rated}}$ 和端电压 $V = 1.0\\,\\mathrm{pu}$ 的工况下运行。\n\n假设发电机处于稳定稳态运行，功角满足 $0  \\delta  \\pi/2$。仅从每相同步发电机稳态模型和复功率的定义出发，推导在给定的有功功率 $P$ 和电压 $V$ 下，满足约束条件 $|I| \\leq I_{\\max}$ 和 $E \\leq E_{\\max}$ 的无功功率 $Q$ 的可行范围。将此运行点的无功功率灵活性 $\\Delta Q$ 定义为差值 $\\Delta Q = Q_{\\max} - Q_{\\min}$，其中 $Q_{\\max}$ 是可实现的最大滞后无功功率，$Q_{\\min}$ 是可实现的最小超前无功功率。计算 $\\Delta Q$ 并以兆乏（Mvar）为单位表示最终答案。将您的答案四舍五入至四位有效数字。在您的推导过程中，请指明在 $Q_{\\max}$ 和 $Q_{\\min}$ 处分别是哪个约束起作用。",
            "solution": "首先对问题进行验证。\n逐字提取的已知条件如下：\n-   三相同步发电机，稳态，忽略定子电阻和磁饱和。\n-   连接到强交流母线，端电压幅值恒定。\n-   额定视在功率：$S_{\\text{rated}} = 400\\,\\mathrm{MVA}$。\n-   额定有功功率：$P_{\\text{rated}}$ 等于在单位功率因数下的 $S_{\\text{rated}}$。\n-   标幺值基准：$S_{\\text{base}} = S_{\\text{rated}}$。\n-   端电压幅值：$V = 1.0\\,\\mathrm{pu}$。\n-   直轴同步电抗：$X_{d} = 1.0\\,\\mathrm{pu}$。\n-   定子电流幅值限制：$|I| \\leq I_{\\max}$，其中 $I_{\\max} = 1.0\\,\\mathrm{pu}$。\n-   内电动势幅值限制：$E \\leq E_{\\max}$，其中 $E_{\\max} = 1.5\\,\\mathrm{pu}$。\n-   运行有功功率：$P = 0.8\\,P_{\\text{rated}}$。\n-   运行端电压：$V = 1.0\\,\\mathrm{pu}$。\n-   功角稳定约束：$0  \\delta  \\pi/2$。\n-   任务：推导无功功率 $Q$ 的可行范围。\n-   任务：计算 $\\Delta Q = Q_{\\max} - Q_{\\min}$，单位为 Mvar，结果四舍五入至四位有效数字。\n-   任务：指明在 $Q_{\\max}$ 和 $Q_{\\min}$ 处分别是哪个约束起作用。\n\n验证结论是，该问题具有科学依据、提法得当、客观、完整、一致且非平凡。这是电力系统分析中一个关于同步发电机运行能力曲线的标准问题。所提供的数据对于大型发电机而言是物理上现实的。因此，该问题是有效的，可以求解。\n\n求解过程首先推导发电机的运行能力极限。我们从忽略定子电阻的每相同步发电机稳态模型开始。关联内电动势（EMF）$\\vec{E}$、端电压 $\\vec{V}$ 和定子电流 $\\vec{I}$ 的相量方程为：\n$$ \\vec{E} = \\vec{V} + j X_d \\vec{I} $$\n其中 $X_d$ 是直轴同步电抗。所有量均以标幺值（pu）表示。\n\n发电机输送至母线的复功率 $S$ 由 $S = P + jQ$ 给出，其中 $P$ 是有功功率，$Q$ 是无功功率。这与电压和电流的关系如下：\n$$ S = \\vec{V} \\vec{I}^* $$\n其中 $\\vec{I}^*$ 是电流相量 $\\vec{I}$ 的复共轭。\n\n我们选择端电压相量作为参考相量，因此 $\\vec{V} = V \\angle 0^\\circ$。给定 $V=1.0\\,\\mathrm{pu}$，我们有 $\\vec{V} = 1.0$。从复功率方程中，我们可以用 $P$ 和 $Q$ 表示电流相量：\n$$ \\vec{I}^* = \\frac{P + jQ}{\\vec{V}} = \\frac{P + jQ}{1.0} = P + jQ $$\n$$ \\vec{I} = (P + jQ)^* = P - jQ $$\n现在将 $\\vec{I}$ 的这个表达式代入发电机模型方程：\n$$ \\vec{E} = V + jX_d (P - jQ) = V + jX_d P - j^2 X_d Q = (V + X_d Q) + j(X_d P) $$\n因此，内电动势的幅值 $E = |\\vec{E}|$ 为：\n$$ E = \\sqrt{(V + X_d Q)^2 + (X_d P)^2} $$\n定子电流的幅值 $|I| = |\\vec{I}|$ 为：\n$$ |I| = \\sqrt{P^2 + (-Q)^2} = \\sqrt{P^2 + Q^2} $$\n问题指定了运行点 $P = 0.8\\,P_{\\text{rated}}$。由于 $P_{\\text{rated}}$ 是在单位功率因数下，视在功率为 $S_{\\text{rated}}$ 时的有功功率，所以 $P_{\\text{rated}} = S_{\\text{rated}} = 400\\,\\mathrm{MW}$。基准功率为 $S_{\\text{base}} = S_{\\text{rated}} = 400\\,\\mathrm{MVA}$。因此，$P_{\\text{base}} = 400\\,\\mathrm{MW}$ 且 $P_{\\text{rated}} = 1.0\\,\\mathrm{pu}$。运行的有功功率为 $P = 0.8 \\times 1.0 = 0.8\\,\\mathrm{pu}$。\n\n我们现在应用两个运行约束来确定在 $P=0.8\\,\\mathrm{pu}$ 时 $Q$ 的可行范围。\n\n1.  定子电流极限（电枢发热极限）：$|I| \\leq I_{\\max}$\n    这个约束与定子绕组的热极限有关。\n    $$ \\sqrt{P^2 + Q^2} \\leq I_{\\max} $$\n    代入给定值 $P=0.8\\,\\mathrm{pu}$ 和 $I_{\\max}=1.0\\,\\mathrm{pu}$：\n    $$ \\sqrt{(0.8)^2 + Q^2} \\leq 1.0 $$\n    $$ 0.64 + Q^2 \\leq 1.0^2 = 1.0 $$\n    $$ Q^2 \\leq 1.0 - 0.64 = 0.36 $$\n    这得出了基于电流极限的 $Q$ 的范围：\n    $$ -0.6 \\leq Q \\leq 0.6 $$\n\n2.  内电动势极限（励磁电流极限）：$E \\leq E_{\\max}$\n    这个约束与转子上励磁绕组的热极限有关。\n    $$ \\sqrt{(V + X_d Q)^2 + (X_d P)^2} \\leq E_{\\max} $$\n    代入给定值 $V=1.0\\,\\mathrm{pu}$、$X_d=1.0\\,\\mathrm{pu}$、$P=0.8\\,\\mathrm{pu}$ 和 $E_{\\max}=1.5\\,\\mathrm{pu}$：\n    $$ \\sqrt{(1.0 + 1.0 \\cdot Q)^2 + (1.0 \\cdot 0.8)^2} \\leq 1.5 $$\n    $$ (1+Q)^2 + (0.8)^2 \\leq 1.5^2 $$\n    $$ (1+Q)^2 + 0.64 \\leq 2.25 $$\n    $$ (1+Q)^2 \\leq 2.25 - 0.64 = 1.61 $$\n    两边取平方根：\n    $$ -\\sqrt{1.61} \\leq 1+Q \\leq \\sqrt{1.61} $$\n    这得出了基于内电动势极限的 $Q$ 的范围：\n    $$ -1 - \\sqrt{1.61} \\leq Q \\leq -1 + \\sqrt{1.61} $$\n    数值上，$\\sqrt{1.61} \\approx 1.26886$，所以范围大约是 $[-2.26886, 0.26886]$。\n\n为了找到 $Q$ 的总体可行范围，我们必须同时满足两个约束。这需要取两个推导范围的交集。\n下界 $Q_{\\min}$ 是两个下界中的最大值：\n$$ Q_{\\min} = \\max(-0.6, -1-\\sqrt{1.61}) = -0.6\\,\\mathrm{pu} $$\n上界 $Q_{\\max}$ 是两个上界中的最小值：\n$$ Q_{\\max} = \\min(0.6, -1+\\sqrt{1.61}) = -1+\\sqrt{1.61}\\,\\mathrm{pu} $$\n值 $Q_{\\min}=-0.6\\,\\mathrm{pu}$ 由定子电流极限决定。因此，在最小无功功率点（最大超前功率因数），定子电流极限是起作用的约束。\n值 $Q_{\\max}=-1+\\sqrt{1.61}\\,\\mathrm{pu}$ 由内电动势极限决定。因此，在最大无功功率点（最大滞后功率因数），内电动势极限是起作用的约束。\n\n还必须检查稳定性约束 $0  \\delta  \\pi/2$。功角 $\\delta$ 由 $\\tan(\\delta) = \\frac{X_d P}{V+X_d Q}$ 给出。为使 $\\delta > 0$，由于 $X_d > 0$ 和 $P > 0$，我们需要 $V+X_d Q > 0$。根据给定值，这意味着 $1+Q > 0$，或 $Q > -1.0$。推导出的 $Q$ 的可行范围是 $[-0.6, -1+\\sqrt{1.61}]$，约等于 $[-0.6, 0.26886]$。这个整个范围都满足 $Q > -1.0$，所以稳定性约束不是限制因素。\n\n无功功率灵活性 $\\Delta Q$ 定义为 $Q_{\\max} - Q_{\\min}$。\n以标幺值表示：\n$$ \\Delta Q_{\\mathrm{pu}} = Q_{\\max} - Q_{\\min} = (-1+\\sqrt{1.61}) - (-0.6) = \\sqrt{1.61} - 0.4\\,\\mathrm{pu} $$\n为将其表示为兆乏（Mvar），我们乘以基准视在功率 $S_{\\text{base}} = 400\\,\\mathrm{MVA}$。\n$$ \\Delta Q = \\Delta Q_{\\mathrm{pu}} \\times S_{\\text{base}} = (\\sqrt{1.61} - 0.4) \\times 400\\,\\mathrm{Mvar} $$\n$$ \\Delta Q \\approx (1.26885775 - 0.4) \\times 400 = 0.86885775 \\times 400 = 347.5431\\,\\mathrm{Mvar} $$\n将结果四舍五入至四位有效数字，得到 $347.5\\,\\mathrm{Mvar}$。",
            "answer": "$$\\boxed{347.5}$$"
        },
        {
            "introduction": "将静态分析推向动态控制是能源系统建模的关键一步。现实世界中的电力负载是随时间变化的，因此无功补偿设备（如电容器组）需要被主动控制，以在满足系统约束（如电压范围）的同时，最小化运行成本（如开关损耗）。本练习要求您构建一个动态优化问题，应用动态规划（Dynamic Programming）方法来制定一个最优的电容器开关策略，从而将无功功率理论与先进的控制和优化技术相结合。",
            "id": "4115155",
            "problem": "考虑一个单相径向馈线，它由一个强电源向单个负载总线供电。电源的电压幅值为 $V_s$，连接到负载的线路具有串联阻抗 $Z = R + j X$，其中 $R$ 和 $X$ 分别是代表电阻和电抗的实常数。在离散时间 $t = 0,1,\\dots,T-1$，负载消耗的有功功率为 $P_t$，无功功率为 $Q_t$。位于负载总线处的并联电容器组可以按离散步长进行切换，其状态由一个非负整数 $s_t \\in \\{0,1,\\dots,N\\}$ 建模，注入的无功功率为 $Q_{c,t} = s_t q_{\\text{step}}$。假设遵循以下符号约定：感性负载的 $Q_t \\ge 0$，电容器注入的无功功率 $Q_{c,t} \\ge 0$ 会减少净无功需求。为建模目的，请使用基于复功率和 Kirchhoff 电路定律基本定义推导出的线性化交流 (AC) 馈线关系，将总线电压幅值 $V_t$ 表示为 $V_s$、$R$、$X$、$P_t$、$Q_t$ 和 $Q_{c,t}$ 的显式函数，并假设电压降和相角均很小。线性化必须仅保留 $R$、$X$、$P_t$、$Q_t$ 和 $Q_{c,t}$ 的一阶项。\n\n您的任务是构建并求解一个优化问题，以找到一个电容器切换调度 $\\{s_t\\}_{t=0}^{T-1}$，该调度能在满足硬约束条件（即在每个时间步 $t$，总线电压幅值 $V_t$ 保持在指定范围 $[V_{\\min}, V_{\\max}]$ 内）的前提下，最小化切换操作的次数（即 $s_t$ 在连续时间步之间发生变化的次数）。如果 $s_0 \\ne s_{\\text{init}}$，则在第一个时间步的切换操作将被计数，其中 $s_{\\text{init}}$ 是 $t=0$ 之前给定的初始电容器状态。您必须使用动态规划 (DP) 来解决此问题，并确保在每个时间步都强制执行可行性。如果不存在可行的调度，则该测试用例的输出必须是一个空列表。\n\n单位和约定：\n- 电压以伏特 (V) 表示。\n- 电阻和电抗以欧姆 ($\\Omega$) 表示。\n- 有功功率以瓦特 (W) 表示。\n- 无功功率以伏安无功 (var) 表示。\n- 在此问题中，频率不显式地出现在线性化电压关系中。\n- 不使用角度；如果在推导中需要，必须在解决方案中明确说明并证明小角度近似的合理性。\n\n测试套件：\n提供一个程序来解决以下三个测试用例。每个用例都指定了 $\\{P_t\\}$、$\\{Q_t\\}$、$V_s$、$R$、$X$、$q_{\\text{step}}$、$N$、$s_{\\text{init}}$、$V_{\\min}$ 和 $V_{\\max}$。\n\n- 案例 A（具有中等补偿步长的常规负载曲线）：\n  - $T = 8$,\n  - $V_s = 12470 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 12350 \\text{ V}$,\n  - $V_{\\max} = 12650 \\text{ V}$,\n  - $q_{\\text{step}} = 200000 \\text{ var}$,\n  - $N = 4$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [900000, 1200000, 1600000, 1400000, 1100000, 800000, 700000, 1000000] \\text{ W}$,\n  - $\\{Q_t\\} = [700000, 900000, 1100000, 1000000, 800000, 500000, 400000, 600000] \\text{ var}$。\n\n- 案例 B（如果过度补偿，可能出现过电压的边界条件）：\n  - $T = 8$,\n  - $V_s = 12000 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 11950 \\text{ V}$,\n  - $V_{\\max} = 12050 \\text{ V}$,\n  - $q_{\\text{step}} = 300000 \\text{ var}$,\n  - $N = 5$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [200000, 200000, 200000, 200000, 200000, 200000, 200000, 200000] \\text{ W}$,\n  - $\\{Q_t\\} = [100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000] \\text{ var}$。\n\n- 案例 C（由于电压上限，交替出现的重载和轻载迫使多次切换的边缘案例）：\n  - $T = 8$,\n  - $V_s = 12470 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 12350 \\text{ V}$,\n  - $V_{\\max} = 12400 \\text{ V}$,\n  - $q_{\\text{step}} = 300000 \\text{ var}$,\n  - $N = 2$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [900000, 1600000, 1600000, 900000, 1600000, 1600000, 900000, 900000] \\text{ W}$,\n  - $\\{Q_t\\} = [700000, 1100000, 1100000, 700000, 1100000, 1100000, 700000, 700000] \\text{ var}$。\n\n您的程序必须：\n- 推导并使用与所述基本依据和假设一致的适当线性化电压关系。\n- 实现一个动态规划 (DP) 求解器，返回在每个 $t$ 满足 $V_{\\min} \\le V_t \\le V_{\\max}$ 的同时，最小化切换操作次数的调度 $\\{s_t\\}$。\n- 如果多个调度达到相同的最小切换次数，则通过在每个时间步选择最小的可行电容器状态 $s_t$ 来打破平局，以确保确定性。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含三个测试用例的调度，格式为一个由方括号括起来的逗号分隔列表，每个调度本身是一个整数列表，代表每个时间步的电容器状态，例如 $[[s_0^{(A)},\\dots,s_7^{(A)}],[s_0^{(B)},\\dots,s_7^{(B)}],[s_0^{(C)},\\dots,s_7^{(C)}]]$。",
            "solution": "我们从复功率和 Kirchhoff 电路定律的基本定义出发，构建一个适用于离散电容器状态优化的线性化电压模型。\n\n设电源电压相量为 $V_s \\angle 0$，通过串联阻抗 $Z = R + j X$ 为单个负载总线供电。在时间 $t$，负载消耗的复功率为 $S_t = P_t + j Q_t$，符号约定为感性需求时 $Q_t \\ge 0$。负载端的并联电容器通过选择整数步长 $s_t \\in \\{0,\\dots,N\\}$ 注入无功功率 $Q_{c,t} = s_t q_{\\text{step}}$，从而将净无功需求减少到 $Q_{t}^{\\text{net}} = Q_t - Q_{c,t}$。\n\n根据交流 (AC) 系统中复功率的定义，在小压降假设下，负载总线电压幅值近似为 $V_t \\approx V_s$，则复电流为\n$$\nI_t = \\frac{S_t^{\\ast}}{V_t} \\approx \\frac{P_t - j Q_t}{V_s}.\n$$\n线路上的串联电压降由欧姆定律给出，\n$$\n\\Delta V_t = Z I_t = (R + j X) \\frac{P_t - j Q_{t}^{\\text{net}}}{V_s}.\n$$\n展开乘积，\n$$\n\\Delta V_t = \\frac{R P_t + X Q_{t}^{\\text{net}}}{V_s} + j \\frac{X P_t - R Q_{t}^{\\text{net}}}{V_s}.\n$$\n在小角度近似下，其中 $V_s$ 的相位是参考，且电压幅值偏差很小，幅值变化的主导分量与实轴投影对齐。因此，一阶近似下，总线电压幅值满足\n$$\nV_t \\approx V_s - \\frac{R P_t + X Q_{t}^{\\text{net}}}{V_s} = V_s - \\frac{R P_t + X \\left(Q_t - s_t q_{\\text{step}}\\right)}{V_s}.\n$$\n该线性化是通过仅保留 $R$、$X$、$P_t$、$Q_t$ 和 $Q_{c,t}$ 的一阶项得到的，与广泛使用的线性化配电网潮流模型（例如，LinDistFlow 近似）一致，并以 Kirchhoff 定律和复功率的定义为基础。\n\n运行约束要求\n$$\nV_{\\min} \\le V_t \\le V_{\\max}\n$$\n对所有时间步 $t$ 均成立。优化目标是最小化切换操作的次数，定义为索引 $t \\in \\{0,\\dots,T-1\\}$ 的数量，其中当 $t=0$ 时 $s_0 \\ne s_{\\text{init}}$，或者当 $t \\ge 1$ 时 $s_t \\ne s_{t-1}$。\n\n我们现在描述动态规划 (DP) 的构建。令时间 $t$ 的可行状态集为\n$$\n\\mathcal{S}_t = \\left\\{ s \\in \\{0,\\dots,N\\} \\ \\bigg| \\ V_{\\min} \\le V_s - \\frac{R P_t + X \\left(Q_t - s \\, q_{\\text{step}}\\right)}{V_s} \\le V_{\\max} \\right\\}.\n$$\n定义 DP 成本表 $C[t,s]$ 为到达时间 $t$ 并处于状态 $s$ 所需的最小切换次数，以及一个前驱表 $\\text{prev}[t,s]$ 用于存储实现该最小值的先前状态。在 $t=0$ 时的初始化为\n$$\nC[0,s] = \n\\begin{cases}\n0,  \\text{if } s = s_{\\text{init}} \\text{ and } s \\in \\mathcal{S}_0,\\\\\n1,  \\text{if } s \\ne s_{\\text{init}} \\text{ and } s \\in \\mathcal{S}_0,\\\\\n+\\infty,  \\text{if } s \\notin \\mathcal{S}_0.\n\\end{cases}\n$$\n对于 $t \\ge 1$，递推关系为\n$$\nC[t,s] = \n\\begin{cases}\n\\min\\limits_{s' \\in \\mathcal{S}_{t-1}} \\left( C[t-1,s'] + \\mathbf{1}_{\\{s \\ne s'\\}} \\right),  \\text{if } s \\in \\mathcal{S}_t, \\\\\n+\\infty,  \\text{if } s \\notin \\mathcal{S}_t,\n\\end{cases}\n$$\n其中，如果 $s \\ne s'$，$\\mathbf{1}_{\\{s \\ne s'\\}}$ 等于 $1$，否则等于 $0$。如果出现最小值相同的情况，我们通过在每个时间步选择最小的 $s$ 来确定性地打破平局，这在多个最优解中强制执行了一致的调度。\n\n在为所有 $t$ 和 $s$ 填充 $C[t,s]$ 和 $\\text{prev}[t,s]$ 之后，选择最优的终端状态 $s^\\ast$ 为\n$$\ns^\\ast \\in \\arg\\min_{s \\in \\mathcal{S}_{T-1}} C[T-1,s],\n$$\n再次应用选择最小状态的平局打破规则。通过使用 $\\text{prev}[t,s]$ 从 $t=T-1$ 回溯到 $t=0$ 来恢复最优调度。如果不存在有限的 $C[T-1,s]$，则该问题在约束下是不可行的，调度被定义为空列表。\n\n算法设计考虑：\n- 可行性检查仅依赖于上面推导的线性化电压表达式，并在每个时间步强制执行严格的电压边界。\n- DP 的最坏情况复杂度为 $\\mathcal{O}(T \\cdot N^2)$，这对于实践中典型的小型离散电容器组来说是可以接受的。\n- 当切换成本相同时，通过选择最小的 $s$ 来打破平局，会产生偏好较低电容器使用率的调度，这在操作上可能是可取的，并能确保确定性的输出。\n\n将此方法应用于提供的测试套件，可得到在满足电压边界的同时最小化切换次数的调度。程序实现直接遵循推导过程：它通过推导出的线性模型评估可行性，构建并求解具有指定初始化和打破平局规则的 DP 递推关系，并以所需的单行列表嵌套列表格式打印所有三个案例的调度。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_voltage(Vs, R, X, P, Q, s, q_step):\n    \"\"\"\n    Linearized voltage magnitude at the load bus:\n    V_t ≈ Vs - (R*P + X*(Q - s*q_step)) / Vs\n    \"\"\"\n    Q_net = Q - s * q_step\n    delta_V = (R * P + X * Q_net) / Vs\n    V = Vs - delta_V\n    return V\n\ndef feasible_states(Vs, R, X, P_t, Q_t, q_step, N, Vmin, Vmax):\n    \"\"\"\n    Return list of states s in {0,...,N} that keep voltage within [Vmin, Vmax] at time t.\n    \"\"\"\n    feas = []\n    for s in range(N + 1):\n        V = compute_voltage(Vs, R, X, P_t, Q_t, s, q_step)\n        if Vmin = V = Vmax:\n            feas.append(s)\n    return feas\n\ndef dp_schedule(Vs, R, X, P, Q, q_step, N, s_init, Vmin, Vmax):\n    \"\"\"\n    Dynamic Programming to minimize number of switching events while maintaining voltage bounds.\n    Returns the schedule list [s_0, ..., s_{T-1}]. Empty list if infeasible.\n    Tie-breaking: choose smallest s when multiple transitions yield equal cost.\n    \"\"\"\n    T = len(P)\n    # Precompute feasible states per time step\n    feas_per_t = [feasible_states(Vs, R, X, P[t], Q[t], q_step, N, Vmin, Vmax) for t in range(T)]\n    if any(len(fs) == 0 for fs in feas_per_t):\n        return []  # Infeasible at some time\n\n    # Initialize DP tables\n    INF = 10**9\n    cost = np.full((T, N + 1), INF, dtype=int)\n    prev = np.full((T, N + 1), -1, dtype=int)\n\n    # Initialization at t=0\n    for s in feas_per_t[0]:\n        cost[0, s] = 0 if s == s_init else 1\n        prev[0, s] = s_init  # store initial for backtracking clarity\n\n    # DP recursion\n    for t in range(1, T):\n        feas_prev = feas_per_t[t - 1]\n        feas_curr = feas_per_t[t]\n        for s in feas_curr:\n            # Find best predecessor s'\n            best_c = INF\n            best_sp = -1\n            # Iterate predecessors in ascending order to realize tie-breaking to smaller s\n            for sp in feas_prev:\n                c = cost[t - 1, sp] + (0 if s == sp else 1)\n                if c  best_c or (c == best_c and sp  best_sp):\n                    best_c = c\n                    best_sp = sp\n            cost[t, s] = best_c\n            prev[t, s] = best_sp\n\n    # Choose terminal state with minimal cost; tie-break by smallest s\n    feas_last = feas_per_t[-1]\n    best_terminal_cost = INF\n    best_terminal_state = -1\n    for s in sorted(feas_last):\n        c = cost[T - 1, s]\n        if c  best_terminal_cost or (c == best_terminal_cost and s  best_terminal_state):\n            best_terminal_cost = c\n            best_terminal_state = s\n\n    if best_terminal_state == -1 or best_terminal_cost >= INF:\n        return []  # infeasible\n\n    # Backtrack to recover schedule\n    schedule = [0] * T\n    schedule[T - 1] = best_terminal_state\n    for t in range(T - 1, 0, -1):\n        schedule[t - 1] = prev[t, schedule[t]]\n    # Ensure s_0 respects feasibility and initial tie-breaking; cost[0, s_0] already handled\n    return schedule\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"Vs\": 12470.0,\n            \"R\": 0.5,\n            \"X\": 1.0,\n            \"Vmin\": 12350.0,\n            \"Vmax\": 12650.0,\n            \"q_step\": 200000.0,\n            \"N\": 4,\n            \"s_init\": 0,\n            \"P\": [900000.0, 1200000.0, 1600000.0, 1400000.0, 1100000.0, 800000.0, 700000.0, 1000000.0],\n            \"Q\": [700000.0, 900000.0, 1100000.0, 1000000.0, 800000.0, 500000.0, 400000.0, 600000.0],\n        },\n        # Case B\n        {\n            \"Vs\": 12000.0,\n            \"R\": 0.5,\n            \"X\": 1.0,\n            \"Vmin\": 11950.0,\n            \"Vmax\": 12050.0,\n            \"q_step\": 300000.0,\n            \"N\": 5,\n            \"s_init\": 0,\n            \"P\": [200000.0] * 8,\n            \"Q\": [100000.0] * 8,\n        },\n        # Case C\n        {\n            \"Vs\": 12470.0,\n            \"R\": 0.5,\n            \"X\": 1.0,\n            \"Vmin\": 12350.0,\n            \"Vmax\": 12400.0,\n            \"q_step\": 300000.0,\n            \"N\": 2,\n            \"s_init\": 0,\n            \"P\": [900000.0, 1600000.0, 1600000.0, 900000.0, 1600000.0, 1600000.0, 900000.0, 900000.0],\n            \"Q\": [700000.0, 1100000.0, 1100000.0, 700000.0, 1100000.0, 1100000.0, 700000.0, 700000.0],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        Vs = case[\"Vs\"]\n        R = case[\"R\"]\n        X = case[\"X\"]\n        Vmin = case[\"Vmin\"]\n        Vmax = case[\"Vmax\"]\n        q_step = case[\"q_step\"]\n        N = int(case[\"N\"])\n        s_init = int(case[\"s_init\"])\n        P = case[\"P\"]\n        Q = case[\"Q\"]\n\n        schedule = dp_schedule(Vs, R, X, P, Q, q_step, N, s_init, Vmin, Vmax)\n        results.append(schedule)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}