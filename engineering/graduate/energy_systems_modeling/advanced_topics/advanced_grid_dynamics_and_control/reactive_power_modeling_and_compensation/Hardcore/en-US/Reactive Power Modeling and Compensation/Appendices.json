{
    "hands_on_practices": [
        {
            "introduction": "To effectively model and control reactive power, one must first master its definition within the framework of alternating current (AC) circuits. This foundational exercise guides you through deriving the expressions for real power ($P$), reactive power ($Q$), and complex power ($S$) from first principles using phasor analysis . By completing this practice, you will solidify the crucial link between a load's impedance characteristics and whether it absorbs or supplies reactive power, a cornerstone of power system analysis.",
            "id": "4115160",
            "problem": "A single-phase sinusoidal source with phasor voltage $V\\angle 0$ supplies a lumped linear time-invariant load with series impedance $Z=R+jX$, where $R>0$ and $X\\in\\mathbb{R}$. Assume steady-state operation and use the root-mean-square convention for phasors. Adopt the sign convention that positive real power $P$ and reactive power $Q$ are absorbed by the load as seen from the source terminals, with positive $Q$ corresponding to inductive behavior.\n\nUsing only fundamental phasor relationships and the definition of complex power, derive closed-form expressions for the real power $P$, reactive power $Q$, and complex power $S$ absorbed by the load in terms of $V$, $R$, and $X$. Then, starting from those expressions, deduce how the sign of $X$ determines the sign of $Q$ and provide a physical interpretation for inductive ($X>0$) and capacitive ($X<0$) cases.\n\nFinally, suppose a purely reactive shunt compensator with admittance $jB$ is connected in parallel at the load terminals (so that the source sees the parallel combination of the load and the compensator). Determine the susceptance $B$ that results in zero net reactive power as seen by the source, expressed in terms of $V$, $R$, and $X$.\n\nExpress your final answers as simplified analytic expressions in terms of $V$, $R$, and $X$. Do not include units in your final expressions. No numerical evaluation or rounding is required.",
            "solution": "First, we derive the expressions for real power $P$, reactive power $Q$, and complex power $S$ for the uncompensated load. The source voltage is given as the phasor $\\mathbf{V} = V \\angle 0^{\\circ}$, which can be written as the real number $V$ since it is the reference phasor. The load impedance is $\\mathbf{Z} = R + jX$.\n\nAccording to Ohm's law in phasor form, the current $\\mathbf{I}$ flowing into the load is:\n$$\n\\mathbf{I} = \\frac{\\mathbf{V}}{\\mathbf{Z}} = \\frac{V}{R+jX}\n$$\nThe complex power $S$ absorbed by the load is defined as $S = \\mathbf{V} \\mathbf{I}^*$, where $\\mathbf{I}^*$ is the complex conjugate of the current phasor. We first find $\\mathbf{I}^*$:\n$$\n\\mathbf{I}^* = \\left( \\frac{V}{R+jX} \\right)^* = \\frac{V^*}{(R+jX)^*} = \\frac{V}{R-jX}\n$$\nHere, $V^* = V$ since $V$ is a real number (the magnitude of the phasor $\\mathbf{V}$). Now, we can write the expression for $S$:\n$$\nS = \\mathbf{V} \\mathbf{I}^* = V \\left( \\frac{V}{R-jX} \\right) = \\frac{V^2}{R-jX}\n$$\nTo separate this into real and imaginary parts, we rationalize the denominator:\n$$\nS = \\frac{V^2}{R-jX} \\cdot \\frac{R+jX}{R+jX} = \\frac{V^2(R+jX)}{R^2 - (jX)^2} = \\frac{V^2(R+jX)}{R^2+X^2}\n$$\nBy definition, complex power is $S = P + jQ$. Equating the real and imaginary parts of our derived expression for $S$:\n$$\nP = \\frac{V^2 R}{R^2+X^2}\n$$\n$$\nQ = \\frac{V^2 X}{R^2+X^2}\n$$\nThese are the expressions for the real and reactive power absorbed by the load. The complex power is thus $S = \\frac{V^2 R}{R^2+X^2} + j\\frac{V^2 X}{R^2+X^2}$.\n\nNext, we analyze the sign of the reactive power $Q$. In the expression for $Q$, the term $V$ represents the RMS magnitude of the voltage, so $V^2$ is non-negative. The denominator $R^2+X^2 = |\\mathbf{Z}|^2$ is the square of the impedance magnitude and is strictly positive since $R>0$. Therefore, the sign of $Q$ is determined entirely by the sign of the reactance $X$:\n- If $X > 0$, the load is inductive. Then $Q > 0$, meaning the load absorbs positive reactive power. Physically, this corresponds to the energy stored and returned by the magnetic field of the inductive component. The current phasor lags the voltage phasor.\n- If $X < 0$, the load is capacitive. Then $Q < 0$, meaning the load absorbs negative reactive power, or equivalently, supplies reactive power to the system. Physically, this corresponds to the energy stored and returned by the electric field of the capacitive component. The current phasor leads the voltage phasor.\n- If $X = 0$, the load is purely resistive. Then $Q = 0$, and the load absorbs no reactive power. The current is in phase with the voltage.\n\nFinally, we determine the susceptance $B$ of a shunt compensator required to make the net reactive power zero. A compensator with admittance $\\mathbf{Y}_{comp} = jB$ is connected in parallel with the load. For parallel connections, it is convenient to work with admittances. The admittance of the load, $\\mathbf{Y}_{load}$, is the reciprocal of its impedance:\n$$\n\\mathbf{Y}_{load} = \\frac{1}{\\mathbf{Z}} = \\frac{1}{R+jX} = \\frac{R-jX}{R^2+X^2} = \\frac{R}{R^2+X^2} - j \\frac{X}{R^2+X^2}\n$$\nThe total admittance $\\mathbf{Y}_{total}$ seen by the source is the sum of the parallel admittances:\n$$\n\\mathbf{Y}_{total} = \\mathbf{Y}_{load} + \\mathbf{Y}_{comp} = \\left(\\frac{R}{R^2+X^2} - j \\frac{X}{R^2+X^2}\\right) + jB\n$$\nGrouping real and imaginary parts, we get:\n$$\n\\mathbf{Y}_{total} = \\frac{R}{R^2+X^2} + j \\left(B - \\frac{X}{R^2+X^2}\\right)\n$$\nThe total complex power supplied by the source is $S_{total} = V^2 \\mathbf{Y}_{total}^*$:\n$$\nS_{total} = V^2 \\left( \\frac{R}{R^2+X^2} - j \\left(B - \\frac{X}{R^2+X^2}\\right) \\right)\n$$\nThe net reactive power $Q_{total}$ is the imaginary part of $S_{total}$:\n$$\nQ_{total} = \\text{Im}(S_{total}) = -V^2 \\left(B - \\frac{X}{R^2+X^2}\\right)\n$$\nFor the net reactive power to be zero ($Q_{total}=0$), we must have:\n$$\n-V^2 \\left(B - \\frac{X}{R^2+X^2}\\right) = 0\n$$\nSince $V \\neq 0$ for a non-trivial source, the term in the parentheses must be zero:\n$$\nB - \\frac{X}{R^2+X^2} = 0\n$$\nSolving for the required susceptance $B$:\n$$\nB = \\frac{X}{R^2+X^2}\n$$\nThis value of $B$ exactly cancels the susceptance of the original load. The load's susceptance is $B_{load} = -\\frac{X}{R^2+X^2}$, and the compensator's susceptance is $B = -B_{load}$. The total susceptance becomes zero, resulting in a purely conductive total admittance and thus unity power factor. The final derived expressions, in the order requested ($P, Q, S, B$), are provided in the final answer. Note that the expression for $B$ does not depend on $V$, which is physically correct as the required compensation depends only on the load's characteristics.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{V^2 R}{R^2+X^2} & \\frac{V^2 X}{R^2+X^2} & \\frac{V^2(R+jX)}{R^2+X^2} & \\frac{X}{R^2+X^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from theory to a common industrial application, this practice addresses the essential task of power factor correction. You will apply the power triangle relationships to a realistic scenario, calculating the reactive power compensation needed to improve a system's efficiency and reduce losses . This exercise provides hands-on experience in quantifying the economic and technical benefits of reactive power management, a core skill for any power systems engineer.",
            "id": "4115151",
            "problem": "A balanced three-phase industrial load is connected to a medium-voltage bus at line-to-line voltage $V = 13.8\\,\\mathrm{kV}$ and consumes real power $P = 10\\,\\mathrm{MW}$ at a measured lagging power factor (power factor) $\\mathrm{pf} = 0.85$. The system operates under steady-state sinusoidal conditions, and the bus voltage remains regulated. Assume the usual sign convention in which inductive reactive power is positive and capacitive reactive power is negative. A shunt static compensator that behaves as an ideal reactive power source (purely reactive, lossless, and with negligible harmonics) is to be installed at the same bus to raise the power factor to a new lagging value $\\mathrm{pf} = 0.98$ while maintaining the same real power transfer.\n\nUsing only foundational definitions of complex power in alternating current steady state and the definition of power factor, determine the following three quantities for the initial operating point and the compensated operating point: the initial reactive power $Q$ drawn by the load, the initial apparent power magnitude $\\lvert S \\rvert$, and the required magnitude of shunt reactive compensation to achieve the target power factor. Express the final values for $Q$ and the required reactive compensation in megavolt-ampere reactive $\\left(\\mathrm{MVAr}\\right)$, and $\\lvert S \\rvert$ in megavolt-ampere $\\left(\\mathrm{MVA}\\right)$. Report the magnitude of the required compensation as a positive number, understanding that it is supplied capacitively at the bus. Round your answers to three significant figures.",
            "solution": "The relationship between complex power ($\\mathbf{S}$), real power ($P$), and reactive power ($Q$) is given by the expression $\\mathbf{S} = P + jQ$, where $j$ is the imaginary unit. The magnitude of the complex power is the apparent power, $|\\mathbf{S}|$, and is related to $P$ and $Q$ by the power triangle relationship: $|\\mathbf{S}|^2 = P^2 + Q^2$.\n\nThe power factor, $\\mathrm{pf}$, is defined as the cosine of the power angle $\\theta$, which is the phase difference between voltage and current, and also the angle of the complex power vector $\\mathbf{S}$ with respect to the real power axis. It is given by $\\mathrm{pf} = \\cos(\\theta) = \\frac{P}{|\\mathbf{S}|}$.\n\nA 'lagging' power factor signifies an inductive load, where the current lags the voltage. According to the specified sign convention, this corresponds to a positive reactive power, $Q > 0$. The relationship between $P$, $Q$, and $\\theta$ is $Q = P \\tan(\\theta)$. Since $\\theta = \\arccos(\\mathrm{pf})$, we can write $Q = P \\tan(\\arccos(\\mathrm{pf}))$.\n\nThe problem is divided into two parts: analyzing the initial state and determining the required compensation to reach the final state.\n\n**1. Initial Operating Point**\n\nThe initial state is characterized by a real power $P_1 = 10\\,\\mathrm{MW}$ and a lagging power factor $\\mathrm{pf}_1 = 0.85$.\n\nFirst, we calculate the initial apparent power magnitude, $|\\mathbf{S}_1|$:\n$$\n|\\mathbf{S}_1| = \\frac{P_1}{\\mathrm{pf}_1} = \\frac{10\\,\\mathrm{MW}}{0.85} \\approx 11.7647\\,\\mathrm{MVA}\n$$\nRounding to three significant figures, we get $|\\mathbf{S}_1| \\approx 11.8\\,\\mathrm{MVA}$.\n\nNext, we calculate the initial reactive power, $Q_1$. Since the power factor is lagging, $Q_1$ is positive.\nThe power angle is $\\theta_1 = \\arccos(\\mathrm{pf}_1) = \\arccos(0.85)$.\n$$\nQ_1 = P_1 \\tan(\\theta_1) = (10\\,\\mathrm{MW}) \\times \\tan(\\arccos(0.85))\n$$\nUsing the trigonometric identity $\\tan(\\arccos(x)) = \\frac{\\sqrt{1 - x^2}}{x}$, we have:\n$$\nQ_1 = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - (0.85)^2}}{0.85} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - 0.7225}}{0.85} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{0.2775}}{0.85} \\approx 6.1974\\,\\mathrm{MVAr}\n$$\nRounding to three significant figures, the initial reactive power is $Q_1 \\approx 6.20\\,\\mathrm{MVAr}$.\n\n**2. Compensated Operating Point and Required Compensation**\n\nThe goal is to achieve a new lagging power factor of $\\mathrm{pf}_2 = 0.98$ while maintaining the real power transfer, so $P_2 = P_1 = 10\\,\\mathrm{MW}$. The shunt compensator is purely reactive and does not consume or supply real power.\n\nThe new reactive power, $Q_2$, drawn from the source after compensation is calculated similarly to the initial state:\nThe new power angle is $\\theta_2 = \\arccos(\\mathrm{pf}_2) = \\arccos(0.98)$.\n$$\nQ_2 = P_2 \\tan(\\theta_2) = (10\\,\\mathrm{MW}) \\times \\tan(\\arccos(0.98))\n$$\n$$\nQ_2 = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - (0.98)^2}}{0.98} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{1 - 0.9604}}{0.98} = (10\\,\\mathrm{MW}) \\times \\frac{\\sqrt{0.0396}}{0.98} \\approx 2.0306\\,\\mathrm{MVAr}\n$$\nThe reactive power supplied by the compensator, $Q_{\\text{comp}}$, is the difference between the new total reactive power ($Q_2$) and the initial reactive power drawn by the load ($Q_1$). The total reactive power is the algebraic sum of the load's reactive power and the compensator's reactive power: $Q_2 = Q_1 + Q_{\\text{comp}}$.\n$$\nQ_{\\text{comp}} = Q_2 - Q_1 \\approx 2.0306\\,\\mathrm{MVAr} - 6.1974\\,\\mathrm{MVAr} \\approx -4.1668\\,\\mathrm{MVAr}\n$$\nThe negative sign indicates that the compensator supplies capacitive reactive power, as expected to reduce the net inductive (lagging) reactive power of the system.\n\nThe problem asks for the magnitude of the required shunt reactive compensation.\n$$\n|Q_{\\text{comp}}| \\approx |-4.1668\\,\\mathrm{MVAr}| = 4.1668\\,\\mathrm{MVAr}\n$$\nRounding to three significant figures, the magnitude of the compensation is $|Q_{\\text{comp}}| \\approx 4.17\\,\\mathrm{MVAr}$.\n\nTo summarize the requested quantities rounded to three significant figures:\n- Initial reactive power: $Q_1 = 6.20\\,\\mathrm{MVAr}$\n- Initial apparent power magnitude: $|\\mathbf{S}_1| = 11.8\\,\\mathrm{MVA}$\n- Magnitude of required reactive compensation: $|Q_{\\text{comp}}| = 4.17\\,\\mathrm{MVAr}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 6.20 & 11.8 & 4.17 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "This advanced practice elevates the concept of compensation from a static calculation to a dynamic optimization problem, a central theme in modern energy systems modeling. You are tasked with developing an optimal switching schedule for a capacitor bank to regulate voltage over time, balancing performance against operational costs . By formulating and solving this problem using Dynamic Programming, you will gain experience in integrating physical system models with sophisticated computational algorithms to create intelligent control strategies.",
            "id": "4115155",
            "problem": "Consider a single-phase radial feeder supplying a single load bus from a stiff source. The source has voltage magnitude $V_s$ and the line to the load has series impedance $Z = R + j X$, where $R$ and $X$ are real constants representing the resistance and reactance, respectively. The load consumes active power $P_t$ and reactive power $Q_t$ at discrete times $t = 0,1,\\dots,T-1$. A shunt capacitor bank located at the load bus can be switched in discrete steps, modeled by a nonnegative integer state $s_t \\in \\{0,1,\\dots,N\\}$ that injects reactive power $Q_{c,t} = s_t q_{\\text{step}}$. Assume the following sign convention: inductive loads have $Q_t \\ge 0$ and the capacitor injection $Q_{c,t} \\ge 0$ reduces the net reactive demand. For modeling purposes, use the linearized alternating current (AC) feeder relation derived from fundamental definitions of complex power and Kirchhoff's circuit laws to express the bus voltage magnitude $V_t$ as an explicit function of $V_s$, $R$, $X$, $P_t$, $Q_t$, and $Q_{c,t}$, under the assumption of small voltage drops and small phase angles. The linearization must be consistent with retaining first-order terms in $R$, $X$, $P_t$, $Q_t$, and $Q_{c,t}$ only.\n\nYour task is to formulate and solve the optimization problem of finding a capacitor switching schedule $\\{s_t\\}_{t=0}^{T-1}$ that minimizes the number of switching operations (the number of times $s_t$ changes between consecutive time steps), subject to the hard constraint that the bus voltage magnitude $V_t$ remains within specified bounds $[V_{\\min}, V_{\\max}]$ at every time step $t$. A switch at the first time step is counted if $s_0 \\ne s_{\\text{init}}$, where $s_{\\text{init}}$ is the given initial capacitor state before $t=0$. You must solve this problem using Dynamic Programming (DP), ensuring that feasibility is enforced at each time step. If no feasible schedule exists, the output for that test case must be an empty list.\n\nUnits and conventions:\n- Express voltages in volts (V).\n- Express resistances and reactances in ohms ($\\Omega$).\n- Express active power in watts (W).\n- Express reactive power in volt-amperes reactive (var).\n- Frequency does not enter the linearized voltage relation explicitly in this problem.\n- No angles are to be used; if needed in derivation, small-angle approximations must be clearly stated and justified in the solution.\n\nTest suite:\nProvide a program that solves the following three test cases. Each case specifies $\\{P_t\\}$, $\\{Q_t\\}$, $V_s$, $R$, $X$, $q_{\\text{step}}$, $N$, $s_{\\text{init}}$, $V_{\\min}$, and $V_{\\max}$.\n\n- Case A (general load profile with moderate compensation steps):\n  - $T = 8$,\n  - $V_s = 12470 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 12350 \\text{ V}$,\n  - $V_{\\max} = 12650 \\text{ V}$,\n  - $q_{\\text{step}} = 200000 \\text{ var}$,\n  - $N = 4$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [900000, 1200000, 1600000, 1400000, 1100000, 800000, 700000, 1000000] \\text{ W}$,\n  - $\\{Q_t\\} = [700000, 900000, 1100000, 1000000, 800000, 500000, 400000, 600000] \\text{ var}$.\n\n- Case B (boundary condition with potential overvoltage if overcompensated):\n  - $T = 8$,\n  - $V_s = 12000 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 11950 \\text{ V}$,\n  - $V_{\\max} = 12050 \\text{ V}$,\n  - $q_{\\text{step}} = 300000 \\text{ var}$,\n  - $N = 5$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [200000, 200000, 200000, 200000, 200000, 200000, 200000, 200000] \\text{ W}$,\n  - $\\{Q_t\\} = [100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000] \\text{ var}$.\n\n- Case C (edge case with alternating heavy and light loads forcing multiple switches due to an upper voltage bound):\n  - $T = 8$,\n  - $V_s = 12470 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 12350 \\text{ V}$,\n  - $V_{\\max} = 12400 \\text{ V}$,\n  - $q_{\\text{step}} = 300000 \\text{ var}$,\n  - $N = 2$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [900000, 1600000, 1600000, 900000, 1600000, 1600000, 900000, 900000] \\text{ W}$,\n  - $\\{Q_t\\} = [700000, 1100000, 1100000, 700000, 1100000, 1100000, 700000, 700000] \\text{ var}$.\n\nYour program must:\n- Derive and use the appropriate linearized voltage relation consistent with the fundamental base and assumptions stated.\n- Implement a Dynamic Programming (DP) solver that returns the schedule $\\{s_t\\}$ minimizing the number of switching operations while satisfying $V_{\\min} \\le V_t \\le V_{\\max}$ at each $t$.\n- If multiple schedules attain the same minimal number of switches, break ties by choosing, at each time step, the smallest feasible capacitor state $s_t$ to ensure determinism.\n\nFinal output format:\nYour program should produce a single line of output containing the schedules for the three test cases as a comma-separated list enclosed in square brackets, where each schedule itself is a list of integers representing the capacitor states for each time step, for example, $[[s_0^{(A)},\\dots,s_7^{(A)}],[s_0^{(B)},\\dots,s_7^{(B)}],[s_0^{(C)},\\dots,s_7^{(C)}]]$.",
            "solution": "We begin from fundamental definitions of complex power and Kirchhoff's circuit laws to construct a linearized voltage model suitable for optimization over discrete capacitor states.\n\nLet the source voltage phasor be $V_s \\angle 0$ feeding a single load bus through series impedance $Z = R + j X$. The load consumes complex power $S_t = P_t + j Q_t$ at time $t$, with the sign convention that $Q_t \\ge 0$ for inductive demand. A shunt capacitor at the load injects reactive power $Q_{c,t} = s_t q_{\\text{step}}$ by selecting the integer step $s_t \\in \\{0,\\dots,N\\}$, reducing the net reactive demand to $Q_{t}^{\\text{net}} = Q_t - Q_{c,t}$.\n\nBy the definition of complex power in an alternating current (AC) system, for load bus voltage magnitude approximately $V_t \\approx V_s$ under small-drop assumptions, the complex current is\n$$\nI_t = \\frac{S_t^{\\ast}}{V_t} \\approx \\frac{P_t - j Q_t}{V_s}.\n$$\nThe series voltage drop across the line is given by Ohm's law,\n$$\n\\Delta V_t = Z I_t = (R + j X) \\frac{P_t - j Q_{t}^{\\text{net}}}{V_s}.\n$$\nExpanding the product,\n$$\n\\Delta V_t = \\frac{R P_t + X Q_{t}^{\\text{net}}}{V_s} + j \\frac{X P_t - R Q_{t}^{\\text{net}}}{V_s}.\n$$\nUnder the small-angle approximation where the phase of $V_s$ is the reference and voltage magnitude deviations are small, the dominant component of the magnitude change aligns with the real-axis projection. Therefore, to first order, the bus voltage magnitude satisfies\n$$\nV_t \\approx V_s - \\frac{R P_t + X Q_{t}^{\\text{net}}}{V_s} = V_s - \\frac{R P_t + X \\left(Q_t - s_t q_{\\text{step}}\\right)}{V_s}.\n$$\nThis linearization is obtained by retaining only first-order terms in $R$, $X$, $P_t$, $Q_t$, and $Q_{c,t}$, consistent with widely used linearized distribution flow models (for example, the LinDistFlow approximation) and is grounded in Kirchhoff's laws and the definition of complex power.\n\nThe operational constraint requires that\n$$\nV_{\\min} \\le V_t \\le V_{\\max}\n$$\nfor all time steps $t$. The optimization objective is to minimize the number of switching operations, defined as the count of indices $t \\in \\{0,\\dots,T-1\\}$ where either $t=0$ and $s_0 \\ne s_{\\text{init}}$ or $t \\ge 1$ and $s_t \\ne s_{t-1}$.\n\nWe now describe the Dynamic Programming (DP) construction. Let the feasible state set at time $t$ be\n$$\n\\mathcal{S}_t = \\left\\{ s \\in \\{0,\\dots,N\\} \\ \\bigg| \\ V_{\\min} \\le V_s - \\frac{R P_t + X \\left(Q_t - s \\, q_{\\text{step}}\\right)}{V_s} \\le V_{\\max} \\right\\}.\n$$\nDefine the DP cost-to-go table $C[t,s]$ as the minimal number of switches to reach time $t$ in state $s$, and a predecessor table $\\text{prev}[t,s]$ storing the previous state achieving the minimum. Initialization at $t=0$ is\n$$\nC[0,s] = \n\\begin{cases}\n0, & \\text{if } s = s_{\\text{init}} \\text{ and } s \\in \\mathcal{S}_0,\\\\\n1, & \\text{if } s \\ne s_{\\text{init}} \\text{ and } s \\in \\mathcal{S}_0,\\\\\n+\\infty, & \\text{if } s \\notin \\mathcal{S}_0.\n\\end{cases}\n$$\nFor $t \\ge 1$, the recurrence is\n$$\nC[t,s] = \n\\begin{cases}\n\\min\\limits_{s' \\in \\mathcal{S}_{t-1}} \\left( C[t-1,s'] + \\mathbf{1}_{\\{s \\ne s'\\}} \\right), & \\text{if } s \\in \\mathcal{S}_t, \\\\\n+\\infty, & \\text{if } s \\notin \\mathcal{S}_t,\n\\end{cases}\n$$\nwhere $\\mathbf{1}_{\\{s \\ne s'\\}}$ equals $1$ if $s \\ne s'$ and $0$ otherwise. In the event of ties for the minimum, we break ties deterministically by selecting the smallest $s$ at each time step, which enforces a consistent schedule among multiple optimal solutions.\n\nAfter filling $C[t,s]$ and $\\text{prev}[t,s]$ for all $t$ and $s$, the optimal terminal state $s^\\ast$ is chosen as\n$$\ns^\\ast \\in \\arg\\min_{s \\in \\mathcal{S}_{T-1}} C[T-1,s],\n$$\nagain applying the smallest-state tie-breaking rule. The optimal schedule is recovered by backtracking using $\\text{prev}[t,s]$ from $t=T-1$ to $t=0$. If no finite $C[T-1,s]$ exists, the problem is infeasible under the constraints and the schedule is defined to be the empty list.\n\nAlgorithmic design considerations:\n- The feasibility check depends only on the linearized voltage expression derived above and enforces the hard voltage bounds at each time step.\n- The DP complexity is $\\mathcal{O}(T \\cdot N^2)$ in the worst case, which is acceptable for small discrete capacitor banks typical in practice.\n- Tie-breaking by smallest $s$ yields schedules that prefer lower capacitor usage when switching costs are equal, which can be desirable operationally and ensures deterministic outputs.\n\nApplying this method to the provided test suite yields schedules that minimize switching while satisfying voltage bounds. The program implementation follows directly from the derivation: it evaluates feasibility via the derived linear model, constructs and solves the DP recurrence with the specified initialization and tie-breaking, and prints the schedules for all three cases in the required single-line list-of-lists format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_voltage(Vs, R, X, P, Q, s, q_step):\n    \"\"\"\n    Linearized voltage magnitude at the load bus:\n    V_t â‰ˆ Vs - (R*P + X*(Q - s*q_step)) / Vs\n    \"\"\"\n    Q_net = Q - s * q_step\n    delta_V = (R * P + X * Q_net) / Vs\n    V = Vs - delta_V\n    return V\n\ndef feasible_states(Vs, R, X, P_t, Q_t, q_step, N, Vmin, Vmax):\n    \"\"\"\n    Return list of states s in {0,...,N} that keep voltage within [Vmin, Vmax] at time t.\n    \"\"\"\n    feas = []\n    for s in range(N + 1):\n        V = compute_voltage(Vs, R, X, P_t, Q_t, s, q_step)\n        if Vmin <= V <= Vmax:\n            feas.append(s)\n    return feas\n\ndef dp_schedule(Vs, R, X, P, Q, q_step, N, s_init, Vmin, Vmax):\n    \"\"\"\n    Dynamic Programming to minimize number of switching events while maintaining voltage bounds.\n    Returns the schedule list [s_0, ..., s_{T-1}]. Empty list if infeasible.\n    Tie-breaking: choose smallest s when multiple transitions yield equal cost.\n    \"\"\"\n    T = len(P)\n    # Precompute feasible states per time step\n    feas_per_t = [feasible_states(Vs, R, X, P[t], Q[t], q_step, N, Vmin, Vmax) for t in range(T)]\n    if any(len(fs) == 0 for fs in feas_per_t):\n        return []  # Infeasible at some time\n\n    # Initialize DP tables\n    INF = 10**9\n    cost = np.full((T, N + 1), INF, dtype=int)\n    prev = np.full((T, N + 1), -1, dtype=int)\n\n    # Initialization at t=0\n    for s in feas_per_t[0]:\n        cost[0, s] = 0 if s == s_init else 1\n        prev[0, s] = s_init  # store initial for backtracking clarity\n\n    # DP recursion\n    for t in range(1, T):\n        feas_prev = feas_per_t[t - 1]\n        feas_curr = feas_per_t[t]\n        for s in feas_curr:\n            # Find best predecessor s'\n            best_c = INF\n            best_sp = -1\n            # Iterate predecessors in ascending order to realize tie-breaking to smaller s\n            for sp in feas_prev:\n                c = cost[t - 1, sp] + (0 if s == sp else 1)\n                if c < best_c or (c == best_c and sp < best_sp):\n                    best_c = c\n                    best_sp = sp\n            cost[t, s] = best_c\n            prev[t, s] = best_sp\n\n    # Choose terminal state with minimal cost; tie-break by smallest s\n    feas_last = feas_per_t[-1]\n    best_terminal_cost = INF\n    best_terminal_state = -1\n    for s in sorted(feas_last):\n        c = cost[T - 1, s]\n        if c < best_terminal_cost or (c == best_terminal_cost and s < best_terminal_state):\n            best_terminal_cost = c\n            best_terminal_state = s\n\n    if best_terminal_state == -1 or best_terminal_cost >= INF:\n        return []  # infeasible\n\n    # Backtrack to recover schedule\n    schedule = [0] * T\n    schedule[T - 1] = best_terminal_state\n    for t in range(T - 1, 0, -1):\n        schedule[t - 1] = prev[t, schedule[t]]\n    # Ensure s_0 respects feasibility and initial tie-breaking; cost[0, s_0] already handled\n    return schedule\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"Vs\": 12470.0,\n            \"R\": 0.5,\n            \"X\": 1.0,\n            \"Vmin\": 12350.0,\n            \"Vmax\": 12650.0,\n            \"q_step\": 200000.0,\n            \"N\": 4,\n            \"s_init\": 0,\n            \"P\": [900000.0, 1200000.0, 1600000.0, 1400000.0, 1100000.0, 800000.0, 700000.0, 1000000.0],\n            \"Q\": [700000.0, 900000.0, 1100000.0, 1000000.0, 800000.0, 500000.0, 400000.0, 600000.0],\n        },\n        # Case B\n        {\n            \"Vs\": 12000.0,\n            \"R\": 0.5,\n            \"X\": 1.0,\n            \"Vmin\": 11950.0,\n            \"Vmax\": 12050.0,\n            \"q_step\": 300000.0,\n            \"N\": 5,\n            \"s_init\": 0,\n            \"P\": [200000.0] * 8,\n            \"Q\": [100000.0] * 8,\n        },\n        # Case C\n        {\n            \"Vs\": 12470.0,\n            \"R\": 0.5,\n            \"X\": 1.0,\n            \"Vmin\": 12350.0,\n            \"Vmax\": 12400.0,\n            \"q_step\": 300000.0,\n            \"N\": 2,\n            \"s_init\": 0,\n            \"P\": [900000.0, 1600000.0, 1600000.0, 900000.0, 1600000.0, 1600000.0, 900000.0, 900000.0],\n            \"Q\": [700000.0, 1100000.0, 1100000.0, 700000.0, 1100000.0, 1100000.0, 700000.0, 700000.0],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        Vs = case[\"Vs\"]\n        R = case[\"R\"]\n        X = case[\"X\"]\n        Vmin = case[\"Vmin\"]\n        Vmax = case[\"Vmax\"]\n        q_step = case[\"q_step\"]\n        N = int(case[\"N\"])\n        s_init = int(case[\"s_init\"])\n        P = case[\"P\"]\n        Q = case[\"Q\"]\n\n        schedule = dp_schedule(Vs, R, X, P, Q, q_step, N, s_init, Vmin, Vmax)\n        results.append(schedule)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}