{
    "hands_on_practices": [
        {
            "introduction": "A deep understanding of any physical phenomenon begins with its first principles. This exercise grounds your knowledge of reactive power by guiding you through the derivation of the fundamental expressions for complex power ($S$), real power ($P$), and reactive power ($Q$) from the basic phasor relationship of Ohm's Law. By working from the ground up, you will not only derive these crucial formulas but also develop a concrete physical intuition for why inductive loads absorb reactive power and capacitive loads supply it, a key concept that underpins all compensation strategies .",
            "id": "4115160",
            "problem": "A single-phase sinusoidal source with phasor voltage $V\\angle 0$ supplies a lumped linear time-invariant load with series impedance $Z=R+jX$, where $R0$ and $X\\in\\mathbb{R}$. Assume steady-state operation and use the root-mean-square convention for phasors. Adopt the sign convention that positive real power $P$ and reactive power $Q$ are absorbed by the load as seen from the source terminals, with positive $Q$ corresponding to inductive behavior.\n\nUsing only fundamental phasor relationships and the definition of complex power, derive closed-form expressions for the real power $P$, reactive power $Q$, and complex power $S$ absorbed by the load in terms of $V$, $R$, and $X$. Then, starting from those expressions, deduce how the sign of $X$ determines the sign of $Q$ and provide a physical interpretation for inductive ($X0$) and capacitive ($X0$) cases.\n\nFinally, suppose a purely reactive shunt compensator with admittance $jB$ is connected in parallel at the load terminals (so that the source sees the parallel combination of the load and the compensator). Determine the susceptance $B$ that results in zero net reactive power as seen by the source, expressed in terms of $V$, $R$, and $X$.\n\nExpress your final answers as simplified analytic expressions in terms of $V$, $R$, and $X$. Do not include units in your final expressions. No numerical evaluation or rounding is required.",
            "solution": "First, we derive the expressions for real power $P$, reactive power $Q$, and complex power $S$ for the uncompensated load. The source voltage is given as the phasor $\\mathbf{V} = V \\angle 0^{\\circ}$, which can be written as the real number $V$ since it is the reference phasor. The load impedance is $\\mathbf{Z} = R + jX$.\n\nAccording to Ohm's law in phasor form, the current $\\mathbf{I}$ flowing into the load is:\n$$\n\\mathbf{I} = \\frac{\\mathbf{V}}{\\mathbf{Z}} = \\frac{V}{R+jX}\n$$\nThe complex power $S$ absorbed by the load is defined as $S = \\mathbf{V} \\mathbf{I}^*$, where $\\mathbf{I}^*$ is the complex conjugate of the current phasor. We first find $\\mathbf{I}^*$:\n$$\n\\mathbf{I}^* = \\left( \\frac{V}{R+jX} \\right)^* = \\frac{V^*}{(R+jX)^*} = \\frac{V}{R-jX}\n$$\nHere, $V^* = V$ since $V$ is a real number (the magnitude of the phasor $\\mathbf{V}$). Now, we can write the expression for $S$:\n$$\nS = \\mathbf{V} \\mathbf{I}^* = V \\left( \\frac{V}{R-jX} \\right) = \\frac{V^2}{R-jX}\n$$\nTo separate this into real and imaginary parts, we rationalize the denominator:\n$$\nS = \\frac{V^2}{R-jX} \\cdot \\frac{R+jX}{R+jX} = \\frac{V^2(R+jX)}{R^2 - (jX)^2} = \\frac{V^2(R+jX)}{R^2+X^2}\n$$\nBy definition, complex power is $S = P + jQ$. Equating the real and imaginary parts of our derived expression for $S$:\n$$\nP = \\frac{V^2 R}{R^2+X^2}\n$$\n$$\nQ = \\frac{V^2 X}{R^2+X^2}\n$$\nThese are the expressions for the real and reactive power absorbed by the load. The complex power is thus $S = \\frac{V^2 R}{R^2+X^2} + j\\frac{V^2 X}{R^2+X^2}$.\n\nNext, we analyze the sign of the reactive power $Q$. In the expression for $Q$, the term $V$ represents the RMS magnitude of the voltage, so $V^2$ is non-negative. The denominator $R^2+X^2 = |\\mathbf{Z}|^2$ is the square of the impedance magnitude and is strictly positive since $R0$. Therefore, the sign of $Q$ is determined entirely by the sign of the reactance $X$:\n- If $X  0$, the load is inductive. Then $Q  0$, meaning the load absorbs positive reactive power. Physically, this corresponds to the energy stored and returned by the magnetic field of the inductive component. The current phasor lags the voltage phasor.\n- If $X  0$, the load is capacitive. Then $Q  0$, meaning the load absorbs negative reactive power, or equivalently, supplies reactive power to the system. Physically, this corresponds to the energy stored and returned by the electric field of the capacitive component. The current phasor leads the voltage phasor.\n- If $X = 0$, the load is purely resistive. Then $Q = 0$, and the load absorbs no reactive power. The current is in phase with the voltage.\n\nFinally, we determine the susceptance $B$ of a shunt compensator required to make the net reactive power zero. A compensator with admittance $\\mathbf{Y}_{comp} = jB$ is connected in parallel with the load. For parallel connections, it is convenient to work with admittances. The admittance of the load, $\\mathbf{Y}_{load}$, is the reciprocal of its impedance:\n$$\n\\mathbf{Y}_{load} = \\frac{1}{\\mathbf{Z}} = \\frac{1}{R+jX} = \\frac{R-jX}{R^2+X^2} = \\frac{R}{R^2+X^2} - j \\frac{X}{R^2+X^2}\n$$\nThe total admittance $\\mathbf{Y}_{total}$ seen by the source is the sum of the parallel admittances:\n$$\n\\mathbf{Y}_{total} = \\mathbf{Y}_{load} + \\mathbf{Y}_{comp} = \\left(\\frac{R}{R^2+X^2} - j \\frac{X}{R^2+X^2}\\right) + jB\n$$\nGrouping real and imaginary parts, we get:\n$$\n\\mathbf{Y}_{total} = \\frac{R}{R^2+X^2} + j \\left(B - \\frac{X}{R^2+X^2}\\right)\n$$\nThe total complex power supplied by the source is $S_{total} = V^2 \\mathbf{Y}_{total}^*$:\n$$\nS_{total} = V^2 \\left( \\frac{R}{R^2+X^2} - j \\left(B - \\frac{X}{R^2+X^2}\\right) \\right)\n$$\nThe net reactive power $Q_{total}$ is the imaginary part of $S_{total}$:\n$$\nQ_{total} = \\text{Im}(S_{total}) = -V^2 \\left(B - \\frac{X}{R^2+X^2}\\right)\n$$\nFor the net reactive power to be zero ($Q_{total}=0$), we must have:\n$$\n-V^2 \\left(B - \\frac{X}{R^2+X^2}\\right) = 0\n$$\nSince $V \\neq 0$ for a non-trivial source, the term in the parentheses must be zero:\n$$\nB - \\frac{X}{R^2+X^2} = 0\n$$\nSolving for the required susceptance $B$:\n$$\nB = \\frac{X}{R^2+X^2}\n$$\nThis value of $B$ exactly cancels the susceptance of the original load. The load's susceptance is $B_{load} = -\\frac{X}{R^2+X^2}$, and the compensator's susceptance is $B = -B_{load}$. The total susceptance becomes zero, resulting in a purely conductive total admittance and thus unity power factor.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{V^2 R}{R^2+X^2}  \\frac{V^2 X}{R^2+X^2}  \\frac{V^2(R+jX)}{R^2+X^2}  \\frac{X}{R^2+X^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "After mastering the behavior of reactive power at the load, we now turn our attention to the source. The ability of a power system to meet reactive power demands is fundamentally constrained by the capabilities of its synchronous generators. This practice challenges you to model these constraints by deriving a generator's reactive power operating range from its physical limits—namely, the thermal limits of its armature and field windings—and constructing a segment of its capability curve, a critical tool for any power system operator or planner .",
            "id": "4115163",
            "problem": "A three-phase synchronous generator is modeled in steady state using the standard per-phase phasor relation and neglecting stator resistance and magnetic saturation. The machine is connected to a stiff Alternating Current (AC) bus so that its terminal voltage magnitude is fixed. The generator is rated at an apparent power of $S_{\\text{rated}} = 400\\,\\mathrm{MVA}$ and has a real power rating $P_{\\text{rated}}$ equal to $S_{\\text{rated}}$ at unity power factor. The per-unit (pu) base is chosen such that $S_{\\text{base}} = S_{\\text{rated}}$ and the terminal voltage magnitude is $V = 1.0\\,\\mathrm{pu}$. The direct-axis synchronous reactance is $X_{d} = 1.0\\,\\mathrm{pu}$. The generator is equipped with protections that impose a stator current magnitude limit of $|I| \\leq I_{\\max}$ with $I_{\\max} = 1.0\\,\\mathrm{pu}$, and an excitation system that imposes an internal electromotive force (EMF) magnitude limit of $E \\leq E_{\\max}$ with $E_{\\max} = 1.5\\,\\mathrm{pu}$. The machine operates at a real power of $P = 0.8\\,P_{\\text{rated}}$ and terminal voltage $V = 1.0\\,\\mathrm{pu}$.\n\nAssume stable steady-state operation with the torque angle satisfying $0  \\delta  \\pi/2$. Starting only from the per-phase synchronous generator steady-state model and the definition of complex power, derive the feasible range of reactive power $Q$ at the specified real power $P$ and voltage $V$ under the constraints $|I| \\leq I_{\\max}$ and $E \\leq E_{\\max}$. Define the reactive power flexibility $\\Delta Q$ at this operating point as the difference $\\Delta Q = Q_{\\max} - Q_{\\min}$, where $Q_{\\max}$ is the maximum achievable lagging reactive power and $Q_{\\min}$ is the minimum achievable leading reactive power. Compute $\\Delta Q$ and express your final answer in megavolt-amperes reactive (Mvar). Round your answer to four significant figures. In your derivation, identify which constraint is binding at $Q_{\\max}$ and which constraint is binding at $Q_{\\min}$.",
            "solution": "The solution proceeds by deriving the generator's capability limits. We start from the per-phase steady-state model of a synchronous generator, neglecting stator resistance. The phasor equation relating the internal electromotive force (EMF) $\\vec{E}$, the terminal voltage $\\vec{V}$, and the stator current $\\vec{I}$ is:\n$$ \\vec{E} = \\vec{V} + j X_d \\vec{I} $$\nwhere $X_d$ is the direct-axis synchronous reactance. All quantities are in per-unit (pu).\n\nThe complex power $S$ delivered by the generator to the bus is given by $S = P + jQ$, where $P$ is the real power and $Q$ is the reactive power. This is related to voltage and current by:\n$$ S = \\vec{V} \\vec{I}^* $$\nwhere $\\vec{I}^*$ is the complex conjugate of the current phasor $\\vec{I}$.\n\nWe choose the terminal voltage phasor as the reference, so $\\vec{V} = V \\angle 0^\\circ$. Given $V=1.0\\,\\mathrm{pu}$, we have $\\vec{V} = 1.0$. From the complex power equation, we can express the current phasor in terms of $P$ and $Q$:\n$$ \\vec{I}^* = \\frac{P + jQ}{\\vec{V}} = \\frac{P + jQ}{1.0} = P + jQ $$\n$$ \\vec{I} = (P + jQ)^* = P - jQ $$\nNow substitute this expression for $\\vec{I}$ into the generator model equation:\n$$ \\vec{E} = V + jX_d (P - jQ) = V + jX_d P - j^2 X_d Q = (V + X_d Q) + j(X_d P) $$\nThe magnitude of the internal EMF, $E = |\\vec{E}|$, is therefore:\n$$ E = \\sqrt{(V + X_d Q)^2 + (X_d P)^2} $$\nThe magnitude of the stator current, $|I| = |\\vec{I}|$, is:\n$$ |I| = \\sqrt{P^2 + (-Q)^2} = \\sqrt{P^2 + Q^2} $$\nThe problem specifies the operating point $P = 0.8\\,P_{\\text{rated}}$. Since $P_{\\text{rated}}$ is the real power at $S_{\\text{rated}}$ with unity power factor, $P_{\\text{rated}} = S_{\\text{rated}} = 400\\,\\mathrm{MW}$. The base power is $S_{\\text{base}} = S_{\\text{rated}} = 400\\,\\mathrm{MVA}$. Thus, $P_{\\text{base}} = 400\\,\\mathrm{MW}$ and $P_{\\text{rated}} = 1.0\\,\\mathrm{pu}$. The operating real power is $P = 0.8 \\times 1.0 = 0.8\\,\\mathrm{pu}$.\n\nWe now apply the two operational constraints to determine the feasible range for $Q$ at $P=0.8\\,\\mathrm{pu}$.\n\n1.  Stator Current Limit (Armature Heating Limit): $|I| \\leq I_{\\max}$\n    This constraint is related to the thermal limit of the stator windings.\n    $$ \\sqrt{P^2 + Q^2} \\leq I_{\\max} $$\n    Substituting the given values $P=0.8\\,\\mathrm{pu}$ and $I_{\\max}=1.0\\,\\mathrm{pu}$:\n    $$ \\sqrt{(0.8)^2 + Q^2} \\leq 1.0 $$\n    $$ 0.64 + Q^2 \\leq 1.0^2 = 1.0 $$\n    $$ Q^2 \\leq 1.0 - 0.64 = 0.36 $$\n    This yields the range for $Q$ based on the current limit:\n    $$ -0.6 \\leq Q \\leq 0.6 $$\n\n2.  Internal EMF Limit (Field Current Limit): $E \\leq E_{\\max}$\n    This constraint is related to the thermal limit of the field winding on the rotor.\n    $$ \\sqrt{(V + X_d Q)^2 + (X_d P)^2} \\leq E_{\\max} $$\n    Substituting the given values $V=1.0\\,\\mathrm{pu}$, $X_d=1.0\\,\\mathrm{pu}$, $P=0.8\\,\\mathrm{pu}$, and $E_{\\max}=1.5\\,\\mathrm{pu}$:\n    $$ \\sqrt{(1.0 + 1.0 \\cdot Q)^2 + (1.0 \\cdot 0.8)^2} \\leq 1.5 $$\n    $$ (1+Q)^2 + (0.8)^2 \\leq 1.5^2 $$\n    $$ (1+Q)^2 + 0.64 \\leq 2.25 $$\n    $$ (1+Q)^2 \\leq 2.25 - 0.64 = 1.61 $$\n    Taking the square root of both sides:\n    $$ -\\sqrt{1.61} \\leq 1+Q \\leq \\sqrt{1.61} $$\n    This yields the range for $Q$ based on the EMF limit:\n    $$ -1 - \\sqrt{1.61} \\leq Q \\leq -1 + \\sqrt{1.61} $$\n    Numerically, $\\sqrt{1.61} \\approx 1.26886$, so the range is approximately $[-2.26886, 0.26886]$.\n\nTo find the overall feasible range for $Q$, we must satisfy both constraints simultaneously. This requires taking the intersection of the two derived ranges.\nThe lower bound, $Q_{\\min}$, is the maximum of the two lower bounds:\n$$ Q_{\\min} = \\max(-0.6, -1-\\sqrt{1.61}) = -0.6\\,\\mathrm{pu} $$\nThe upper bound, $Q_{\\max}$, is the minimum of the two upper bounds:\n$$ Q_{\\max} = \\min(0.6, -1+\\sqrt{1.61}) = -1+\\sqrt{1.61}\\,\\mathrm{pu} $$\nThe value $Q_{\\min}=-0.6\\,\\mathrm{pu}$ is determined by the stator current limit. Therefore, the stator current limit is binding at the point of minimum reactive power (maximum leading power factor).\nThe value $Q_{\\max}=-1+\\sqrt{1.61}\\,\\mathrm{pu}$ is determined by the EMF limit. Therefore, the EMF limit is binding at the point of maximum reactive power (maximum lagging power factor).\n\nThe stability constraint $0  \\delta  \\pi/2$ must also be checked. The torque angle $\\delta$ is given by $\\tan(\\delta) = \\frac{X_d P}{V+X_d Q}$. For $\\delta  0$, since $X_d  0$ and $P  0$, we need $V+X_d Q  0$. With the given values, this means $1+Q  0$, or $Q  -1.0$. The derived feasible range for $Q$ is $[-0.6, -1+\\sqrt{1.61}]$, which is approximately $[-0.6, 0.26886]$. This entire range satisfies $Q  -1.0$, so the stability constraint is not the limiting factor.\n\nThe reactive power flexibility $\\Delta Q$ is defined as $Q_{\\max} - Q_{\\min}$.\nIn per-unit:\n$$ \\Delta Q_{\\mathrm{pu}} = Q_{\\max} - Q_{\\min} = (-1+\\sqrt{1.61}) - (-0.6) = \\sqrt{1.61} - 0.4\\,\\mathrm{pu} $$\nTo express this in megavolt-amperes reactive (Mvar), we multiply by the base apparent power $S_{\\text{base}} = 400\\,\\mathrm{MVA}$.\n$$ \\Delta Q = \\Delta Q_{\\mathrm{pu}} \\times S_{\\text{base}} = (\\sqrt{1.61} - 0.4) \\times 400\\,\\mathrm{Mvar} $$\n$$ \\Delta Q \\approx (1.26885775 - 0.4) \\times 400 = 0.86885775 \\times 400 = 347.5431\\,\\mathrm{Mvar} $$",
            "answer": "$$\\boxed{347.5}$$"
        },
        {
            "introduction": "Effective reactive power management goes beyond static calculations and into the realm of dynamic control and optimization. In this advanced computational practice, you will tackle the real-world problem of scheduling a shunt capacitor bank to regulate voltage on a distribution feeder over time. You will formulate this as an optimal control problem and solve it using dynamic programming, learning how to balance the technical requirement of maintaining voltage within safe limits against the operational goal of minimizing costly switching actions .",
            "id": "4115155",
            "problem": "Consider a single-phase radial feeder supplying a single load bus from a stiff source. The source has voltage magnitude $V_s$ and the line to the load has series impedance $Z = R + j X$, where $R$ and $X$ are real constants representing the resistance and reactance, respectively. The load consumes active power $P_t$ and reactive power $Q_t$ at discrete times $t = 0,1,\\dots,T-1$. A shunt capacitor bank located at the load bus can be switched in discrete steps, modeled by a nonnegative integer state $s_t \\in \\{0,1,\\dots,N\\}$ that injects reactive power $Q_{c,t} = s_t q_{\\text{step}}$. Assume the following sign convention: inductive loads have $Q_t \\ge 0$ and the capacitor injection $Q_{c,t} \\ge 0$ reduces the net reactive demand. For modeling purposes, use the linearized alternating current (AC) feeder relation derived from fundamental definitions of complex power and Kirchhoff's circuit laws to express the bus voltage magnitude $V_t$ as an explicit function of $V_s$, $R$, $X$, $P_t$, $Q_t$, and $Q_{c,t}$, under the assumption of small voltage drops and small phase angles. The linearization must be consistent with retaining first-order terms in $R$, $X$, $P_t$, $Q_t$, and $Q_{c,t}$ only.\n\nYour task is to formulate and solve the optimization problem of finding a capacitor switching schedule $\\{s_t\\}_{t=0}^{T-1}$ that minimizes the number of switching operations (the number of times $s_t$ changes between consecutive time steps), subject to the hard constraint that the bus voltage magnitude $V_t$ remains within specified bounds $[V_{\\min}, V_{\\max}]$ at every time step $t$. A switch at the first time step is counted if $s_0 \\ne s_{\\text{init}}$, where $s_{\\text{init}}$ is the given initial capacitor state before $t=0$. You must solve this problem using Dynamic Programming (DP), ensuring that feasibility is enforced at each time step. If no feasible schedule exists, the output for that test case must be an empty list.\n\nUnits and conventions:\n- Express voltages in volts (V).\n- Express resistances and reactances in ohms ($\\Omega$).\n- Express active power in watts (W).\n- Express reactive power in volt-amperes reactive (var).\n- Frequency does not enter the linearized voltage relation explicitly in this problem.\n- No angles are to be used; if needed in derivation, small-angle approximations must be clearly stated and justified in the solution.\n\nTest suite:\nProvide a program that solves the following three test cases. Each case specifies $\\{P_t\\}$, $\\{Q_t\\}$, $V_s$, $R$, $X$, $q_{\\text{step}}$, $N$, $s_{\\text{init}}$, $V_{\\min}$, and $V_{\\max}$.\n\n- Case A (general load profile with moderate compensation steps):\n  - $T = 8$,\n  - $V_s = 12470 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 12350 \\text{ V}$,\n  - $V_{\\max} = 12650 \\text{ V}$,\n  - $q_{\\text{step}} = 200000 \\text{ var}$,\n  - $N = 4$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [900000, 1200000, 1600000, 1400000, 1100000, 800000, 700000, 1000000] \\text{ W}$,\n  - $\\{Q_t\\} = [700000, 900000, 1100000, 1000000, 800000, 500000, 400000, 600000] \\text{ var}$.\n\n- Case B (boundary condition with potential overvoltage if overcompensated):\n  - $T = 8$,\n  - $V_s = 12000 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 11950 \\text{ V}$,\n  - $V_{\\max} = 12050 \\text{ V}$,\n  - $q_{\\text{step}} = 300000 \\text{ var}$,\n  - $N = 5$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [200000, 200000, 200000, 200000, 200000, 200000, 200000, 200000] \\text{ W}$,\n  - $\\{Q_t\\} = [100000, 100000, 100000, 100000, 100000, 100000, 100000, 100000] \\text{ var}$.\n\n- Case C (edge case with alternating heavy and light loads forcing multiple switches due to an upper voltage bound):\n  - $T = 8$,\n  - $V_s = 12470 \\text{ V}$,\n  - $R = 0.5 \\ \\Omega$,\n  - $X = 1.0 \\ \\Omega$,\n  - $V_{\\min} = 12350 \\text{ V}$,\n  - $V_{\\max} = 12400 \\text{ V}$,\n  - $q_{\\text{step}} = 300000 \\text{ var}$,\n  - $N = 2$,\n  - $s_{\\text{init}} = 0$,\n  - $\\{P_t\\} = [900000, 1600000, 1600000, 900000, 1600000, 1600000, 900000, 900000] \\text{ W}$,\n  - $\\{Q_t\\} = [700000, 1100000, 1100000, 700000, 1100000, 1100000, 700000, 700000] \\text{ var}$.\n\nYour program must:\n- Derive and use the appropriate linearized voltage relation consistent with the fundamental base and assumptions stated.\n- Implement a Dynamic Programming (DP) solver that returns the schedule $\\{s_t\\}$ minimizing the number of switching operations while satisfying $V_{\\min} \\le V_t \\le V_{\\max}$ at each $t$.\n- If multiple schedules attain the same minimal number of switches, break ties by choosing, at each time step, the smallest feasible capacitor state $s_t$ to ensure determinism.\n\nFinal output format:\nYour program should produce a single line of output containing the schedules for the three test cases as a comma-separated list enclosed in square brackets, where each schedule itself is a list of integers representing the capacitor states for each time step, for example, $[[s_0^{(A)},\\dots,s_7^{(A)}],[s_0^{(B)},\\dots,s_7^{(B)}],[s_0^{(C)},\\dots,s_7^{(C)}]]$.",
            "solution": "We begin from fundamental definitions of complex power and Kirchhoff's circuit laws to construct a linearized voltage model suitable for optimization over discrete capacitor states.\n\nLet the source voltage phasor be $V_s \\angle 0$ feeding a single load bus through series impedance $Z = R + j X$. The load consumes complex power $S_t = P_t + j Q_t$ at time $t$, with the sign convention that $Q_t \\ge 0$ for inductive demand. A shunt capacitor at the load injects reactive power $Q_{c,t} = s_t q_{\\text{step}}$ by selecting the integer step $s_t \\in \\{0,1,\\dots,N\\}$, reducing the net reactive demand to $Q_{t}^{\\text{net}} = Q_t - Q_{c,t}$.\n\nBy the definition of complex power in an alternating current (AC) system, for load bus voltage magnitude approximately $V_t \\approx V_s$ under small-drop assumptions, the complex current is\n$$\nI_t = \\frac{S_t^{\\ast}}{V_t} \\approx \\frac{P_t - j Q_t}{V_s}.\n$$\nThe series voltage drop across the line is given by Ohm's law,\n$$\n\\Delta V_t = Z I_t = (R + j X) \\frac{P_t - j Q_{t}^{\\text{net}}}{V_s}.\n$$\nExpanding the product,\n$$\n\\Delta V_t = \\frac{R P_t + X Q_{t}^{\\text{net}}}{V_s} + j \\frac{X P_t - R Q_{t}^{\\text{net}}}{V_s}.\n$$\nUnder the small-angle approximation where the phase of $V_s$ is the reference and voltage magnitude deviations are small, the dominant component of the magnitude change aligns with the real-axis projection. Therefore, to first order, the bus voltage magnitude satisfies\n$$\nV_t \\approx V_s - \\frac{R P_t + X Q_{t}^{\\text{net}}}{V_s} = V_s - \\frac{R P_t + X \\left(Q_t - s_t q_{\\text{step}}\\right)}{V_s}.\n$$\nThis linearization is obtained by retaining only first-order terms in $R$, $X$, $P_t$, $Q_t$, and $Q_{c,t}$, consistent with widely used linearized distribution flow models and is grounded in Kirchhoff's laws and the definition of complex power.\n\nThe operational constraint requires that\n$$\nV_{\\min} \\le V_t \\le V_{\\max}\n$$\nfor all time steps $t$. The optimization objective is to minimize the number of switching operations, defined as the count of indices $t \\in \\{0,\\dots,T-1\\}$ where either $t=0$ and $s_0 \\ne s_{\\text{init}}$ or $t \\ge 1$ and $s_t \\ne s_{t-1}$.\n\nWe now describe the Dynamic Programming (DP) construction. Let the feasible state set at time $t$ be\n$$\n\\mathcal{S}_t = \\left\\{ s \\in \\{0,\\dots,N\\} \\ \\bigg| \\ V_{\\min} \\le V_s - \\frac{R P_t + X \\left(Q_t - s \\, q_{\\text{step}}\\right)}{V_s} \\le V_{\\max} \\right\\}.\n$$\nDefine the DP cost table $C[t,s]$ as the minimal number of switches to reach time $t$ in state $s$, and a predecessor table $\\text{prev}[t,s]$ storing the previous state achieving the minimum. Initialization at $t=0$ is\n$$\nC[0,s] = \n\\begin{cases}\n0,  \\text{if } s = s_{\\text{init}} \\text{ and } s \\in \\mathcal{S}_0,\\\\\n1,  \\text{if } s \\ne s_{\\text{init}} \\text{ and } s \\in \\mathcal{S}_0,\\\\\n+\\infty,  \\text{if } s \\notin \\mathcal{S}_0.\n\\end{cases}\n$$\nFor $t \\ge 1$, the recurrence is\n$$\nC[t,s] = \n\\begin{cases}\n\\min\\limits_{s' \\in \\mathcal{S}_{t-1}} \\left( C[t-1,s'] + \\mathbf{1}_{\\{s \\ne s'\\}} \\right),  \\text{if } s \\in \\mathcal{S}_t, \\\\\n+\\infty,  \\text{if } s \\notin \\mathcal{S}_t,\n\\end{cases}\n$$\nwhere $\\mathbf{1}_{\\{s \\ne s'\\}}$ equals $1$ if $s \\ne s'$ and $0$ otherwise. In the event of ties for the minimum, we break ties deterministically by selecting the path from the smallest predecessor state $s'$.\n\nAfter filling $C[t,s]$ and $\\text{prev}[t,s]$ for all $t$ and $s$, the optimal terminal state $s^\\ast$ is chosen as\n$$\ns^\\ast \\in \\arg\\min_{s \\in \\mathcal{S}_{T-1}} C[T-1,s],\n$$\nagain applying a smallest-state tie-breaking rule. The optimal schedule is recovered by backtracking using $\\text{prev}[t,s]$ from $t=T-1$ to $t=0$. If no finite $C[T-1,s]$ exists, the problem is infeasible.\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_voltage(Vs, R, X, P, Q, s, q_step):\n    \"\"\"\n    Linearized voltage magnitude at the load bus:\n    V_t ≈ Vs - (R*P + X*(Q - s*q_step)) / Vs\n    \"\"\"\n    Q_net = Q - s * q_step\n    delta_V = (R * P + X * Q_net) / Vs\n    V = Vs - delta_V\n    return V\n\ndef feasible_states(Vs, R, X, P_t, Q_t, q_step, N, Vmin, Vmax):\n    \"\"\"\n    Return list of states s in {0,...,N} that keep voltage within [Vmin, Vmax] at time t.\n    \"\"\"\n    feas = []\n    for s in range(N + 1):\n        V = compute_voltage(Vs, R, X, P_t, Q_t, s, q_step)\n        if Vmin = V = Vmax:\n            feas.append(s)\n    return feas\n\ndef dp_schedule(Vs, R, X, P, Q, q_step, N, s_init, Vmin, Vmax):\n    \"\"\"\n    Dynamic Programming to minimize number of switching events while maintaining voltage bounds.\n    Returns the schedule list [s_0, ..., s_{T-1}]. Empty list if infeasible.\n    Tie-breaking: choose path from smallest predecessor state; for terminal state, choose smallest state.\n    \"\"\"\n    T = len(P)\n    # Precompute feasible states per time step\n    feas_per_t = [feasible_states(Vs, R, X, P[t], Q[t], q_step, N, Vmin, Vmax) for t in range(T)]\n    if any(len(fs) == 0 for fs in feas_per_t):\n        return []  # Infeasible at some time\n\n    # Initialize DP tables\n    INF = 10**9\n    cost = np.full((T, N + 1), INF, dtype=int)\n    prev = np.full((T, N + 1), -1, dtype=int)\n\n    # Initialization at t=0\n    for s in feas_per_t[0]:\n        cost[0, s] = 0 if s == s_init else 1\n        prev[0, s] = s_init  # store initial for backtracking clarity\n\n    # DP recursion\n    for t in range(1, T):\n        feas_prev = feas_per_t[t - 1]\n        feas_curr = feas_per_t[t]\n        for s in feas_curr:\n            best_c = INF\n            best_sp = -1\n            # Iterate predecessors in ascending order to realize tie-breaking to smaller s'\n            for sp in sorted(feas_prev):\n                if cost[t - 1, sp] >= INF:\n                    continue\n                c = cost[t - 1, sp] + (0 if s == sp else 1)\n                if c  best_c:\n                    best_c = c\n                    best_sp = sp\n            if best_sp != -1:\n                cost[t, s] = best_c\n                prev[t, s] = best_sp\n\n    # Choose terminal state with minimal cost; tie-break by smallest s\n    feas_last = feas_per_t[-1]\n    best_terminal_cost = INF\n    best_terminal_state = -1\n    for s in sorted(feas_last):\n        c = cost[T - 1, s]\n        if c  best_terminal_cost:\n            best_terminal_cost = c\n            best_terminal_state = s\n\n    if best_terminal_state == -1 or best_terminal_cost >= INF:\n        return []  # infeasible\n\n    # Backtrack to recover schedule\n    schedule = [0] * T\n    schedule[T - 1] = best_terminal_state\n    for t in range(T - 1, 0, -1):\n        schedule[t - 1] = prev[t, schedule[t]]\n    \n    return schedule\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"Vs\": 12470.0, \"R\": 0.5, \"X\": 1.0, \"Vmin\": 12350.0, \"Vmax\": 12650.0,\n            \"q_step\": 200000.0, \"N\": 4, \"s_init\": 0,\n            \"P\": [900000.0, 1200000.0, 1600000.0, 1400000.0, 1100000.0, 800000.0, 700000.0, 1000000.0],\n            \"Q\": [700000.0, 900000.0, 1100000.0, 1000000.0, 800000.0, 500000.0, 400000.0, 600000.0],\n        },\n        # Case B\n        {\n            \"Vs\": 12000.0, \"R\": 0.5, \"X\": 1.0, \"Vmin\": 11950.0, \"Vmax\": 12050.0,\n            \"q_step\": 300000.0, \"N\": 5, \"s_init\": 0,\n            \"P\": [200000.0] * 8, \"Q\": [100000.0] * 8,\n        },\n        # Case C\n        {\n            \"Vs\": 12470.0, \"R\": 0.5, \"X\": 1.0, \"Vmin\": 12350.0, \"Vmax\": 12400.0,\n            \"q_step\": 300000.0, \"N\": 2, \"s_init\": 0,\n            \"P\": [900000.0, 1600000.0, 1600000.0, 900000.0, 1600000.0, 1600000.0, 900000.0, 900000.0],\n            \"Q\": [700000.0, 1100000.0, 1100000.0, 700000.0, 1100000.0, 1100000.0, 700000.0, 700000.0],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        schedule = dp_schedule(**case)\n        results.append(schedule)\n\n    # Final print statement in the exact required format.\n    return f\"[{','.join(map(str, results))}]\".replace(\" \", \"\")\n\n# The answer is the output of this program.\n# print(solve())\n```",
            "answer": "[[2,3,4,4,3,2,1,2],[1,1,1,1,1,1,1,1],[1,2,2,1,2,2,1,1]]"
        }
    ]
}