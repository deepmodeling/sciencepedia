{
    "hands_on_practices": [
        {
            "introduction": "Our first practice addresses a fundamental question: why use a complex stochastic model when a simpler deterministic one based on average forecasts exists? This exercise introduces the concept of the Value of the Stochastic Solution (VSS), a critical metric that quantifies the economic benefit of explicitly modeling uncertainty. By comparing the outcomes of a stochastic approach against a deterministic one, you will gain a tangible understanding of how SUC models can lead to more robust and economically efficient decisions in the face of unpredictable conditions .",
            "id": "4104477",
            "problem": "A two-stage stochastic unit commitment decision problem arises from the need to commit generating units before uncertain net load is realized. The fundamental base is expected-cost minimization under uncertainty and linear economic dispatch, both of which are widely accepted in energy systems modeling. In the first stage, the operator commits thermal units; in the second stage, after scenarios of demand are realized, the operator dispatches committed units to meet demand, possibly incurring a penalty for unmet load. All costs are expressed in dollars. Power and energy are measured consistently by assuming each period has duration $1$ hour, so megawatts (MW) equal megawatt-hours (MWh) over a period.\n\nConsider a toy system with $2$ thermal units, indexed by $i \\in \\{1,2\\}$, and a single time period of duration $1$ hour. Each unit $i$ is characterized by:\n- Maximum capacity $P^{\\max}_i$ in MW,\n- Linear variable production cost $c_i$ in dollars per MWh,\n- Startup cost $C^{\\mathrm{su}}_i$ in dollars,\n- No-load cost $C^{\\mathrm{nl}}_i$ in dollars per period when committed.\n\nThe first-stage decisions are binary commitments $u_i \\in \\{0,1\\}$ for each unit, made before uncertainty is realized. The second-stage decisions, for each scenario $s$, are the dispatch levels $g_{i,s} \\ge 0$ and the nonserved energy $l_s \\ge 0$ (load shedding), with per-MWh penalty $M$ dollars. The scenario demands $D_s$ are in MWh, and scenario probabilities $p_s$ satisfy $\\sum_s p_s = 1$ with $p_s \\ge 0$.\n\nThe dispatch must satisfy, for each scenario $s$,\n$$\n\\sum_{i=1}^2 g_{i,s} + l_s = D_s, \\quad 0 \\le g_{i,s} \\le P^{\\max}_i u_i,\n$$\nand the second-stage cost per scenario is\n$$\n\\sum_{i=1}^2 c_i g_{i,s} + M l_s.\n$$\nFirst-stage costs are\n$$\n\\sum_{i=1}^2 \\left(C^{\\mathrm{su}}_i u_i + C^{\\mathrm{nl}}_i u_i\\right).\n$$\n\nThe Stochastic Unit Commitment (SUC) problem minimizes the sum of first-stage costs and expected second-stage costs over all feasible commitments. The Deterministic Expected-Value (EV) problem replaces random demand with the expected demand\n$$\n\\bar{D} = \\sum_s p_s D_s,\n$$\nand minimizes the sum of first-stage costs and second-stage variable costs at $\\bar{D}$, subject to meeting $\\bar{D}$ exactly with committed capacity and without load shedding.\n\nOnce the EV commitment is found, the expected cost of evaluating this fixed commitment under the stochastic scenarios (allowing load shedding in recourse) is computed; this is known as the evaluated expected value (EEV). The quantity to compute is the increase in expected cost when using the EV commitment versus the optimal SUC commitment, expressed in dollars for each test case. The program must:\n- Enumerate first-stage commitments.\n- For SUC, compute the optimal expected cost over all commitments.\n- For EV, select the commitment that exactly meets $\\bar{D}$ and minimizes deterministic cost, then compute its expected cost under the stochastic scenarios.\n- Output, for each test case, the difference between the EEV cost and the SUC optimal expected cost, in dollars.\n\nUnit data (common to all test cases):\n- Unit $1$: $P^{\\max}_1 = 100$ MW, $c_1 = 20$ dollars/MWh, $C^{\\mathrm{su}}_1 = 1000$ dollars, $C^{\\mathrm{nl}}_1 = 500$ dollars.\n- Unit $2$: $P^{\\max}_2 = 50$ MW, $c_2 = 25$ dollars/MWh, $C^{\\mathrm{su}}_2 = 100$ dollars, $C^{\\mathrm{nl}}_2 = 0$ dollars.\n\nScenario sets and penalty values for the test suite:\n- Case $1$ (general case):\n  - Scenarios: $D_1 = 40$ MWh with $p_1 = 0.6$, $D_2 = 120$ MWh with $p_2 = 0.4$.\n  - Penalty: $M = 200$ dollars/MWh.\n- Case $2$ (boundary case where deterministic expected-value commitment coincides with the stochastic optimum):\n  - Scenarios: $D_1 = 40$ MWh with $p_1 = 0.95$, $D_2 = 120$ MWh with $p_2 = 0.05$.\n  - Penalty: $M = 200$ dollars/MWh.\n- Case $3$ (edge case with low penalty for nonserved energy):\n  - Scenarios: $D_1 = 40$ MWh with $p_1 = 0.6$, $D_2 = 120$ MWh with $p_2 = 0.4$.\n  - Penalty: $M = 30$ dollars/MWh.\n\nAssumptions:\n- Each period has duration $1$ hour, so $1$ MW equals $1$ MWh in the period.\n- Initial commitment status is off for all units, so startup costs apply when a unit is committed.\n- Minimum generation is $0$ MWh, and ramping constraints are absent.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3]$, where $r_k$ is the computed difference between the evaluated expected value cost and the optimal stochastic unit commitment cost for case $k$, expressed in dollars as a float.",
            "solution": "The user wants me to solve a two-stage stochastic unit commitment problem.\n\nHere's my plan:\n1.  **Validate the problem:**\n    *   Extract all the given data, definitions, and constraints.\n    *   Check for scientific soundness, clarity, completeness, and consistency. The problem is from energy systems modeling, a well-established field. The model described (two-stage stochastic linear program for unit commitment) is a standard textbook model. The parameters seem reasonable for a toy problem.\n2.  **Deconstruct the problem:**\n    *   The goal is to calculate the \"Value of the Stochastic Solution\" (VSS), which is defined here as `EEV cost - SUC cost`.\n    *   `SUC cost` is the minimum expected total cost over all possible first-stage commitments.\n    *   `EEV cost` is the expected total cost of the commitment chosen by the `EV` problem.\n    *   The `EV` problem is a deterministic version where demand is replaced by its expected value.\n\n3.  **Formulate the solution approach:**\n    *   The system has $2$ thermal units.\n    *   The first-stage decisions are the commitment statuses $u_1, u_2 \\in \\{0, 1\\}$.\n    *   This gives $2^2 = 4$ possible commitment combinations: $(u_1, u_2) \\in \\{(0,0), (0,1), (1,0), (1,1)\\}$.\n    *   Since the problem is small, I can solve it by enumerating all 4 commitment decisions.\n\n4.  **Develop the algorithm for a single test case:**\n\n    *   **Define the system parameters:**\n        *   Unit 1: $P^{\\max}_1 = 100$, $c_1 = 20$, $C^{\\mathrm{su}}_1 = 1000$, $C^{\\mathrm{nl}}_1 = 500$.\n        *   Unit 2: $P^{\\max}_2 = 50$, $c_2 = 25$, $C^{\\mathrm{su}}_2 = 100$, $C^{\\mathrm{nl}}_2 = 0$.\n        *   Commitment combinations (decision space): $U = \\{(0,0), (0,1), (1,0), (1,1)\\}$.\n\n    *   **For a given commitment $(u_1, u_2)$, calculate its expected cost:**\n        *   First-stage cost: $C_1(u_1, u_2) = (C^{\\mathrm{su}}_1 + C^{\\mathrm{nl}}_1)u_1 + (C^{\\mathrm{su}}_2 + C^{\\mathrm{nl}}_2)u_2$.\n        *   For each scenario $s \\in \\{1, 2\\}$ with demand $D_s$ and probability $p_s$:\n            *   Calculate the second-stage (recourse) cost, $Q_s(u_1, u_2)$. This is a small linear program (LP) for economic dispatch.\n            *   The objective is to minimize $\\sum_{i=1}^2 c_i g_{i,s} + M l_s$.\n            *   The constraints are:\n                *   $\\sum_{i=1}^2 g_{i,s} + l_s = D_s$\n                *   $0 \\le g_{1,s} \\le P^{\\max}_1 u_1$\n                *   $0 \\le g_{2,s} \\le P^{\\max}_2 u_2$\n                *   $l_s \\ge 0$\n            *   This LP can be solved analytically by a merit-order loading. The available generators are those with $u_i = 1$. Load them in increasing order of their variable cost $c_i$. If the total capacity is not enough to meet the demand $D_s$, the remaining demand is shed at cost $M$.\n            *   Let's create a function `calculate_dispatch_cost(demand, u)`.\n                *   Committed units: $I_{commit} = \\{i \\mid u_i = 1\\}$.\n                *   Sort committed units by cost $c_i$. Unit 1 ($c_1=20$) is cheaper than Unit 2 ($c_2=25$).\n                *   Remaining demand `rem_demand = demand`.\n                *   Dispatch cost `dispatch_cost = 0`.\n                *   For each committed unit `i` in cost order:\n                    *   `dispatch = min(rem_demand, P_max_i)`.\n                    *   `dispatch_cost += dispatch * c_i`.\n                    *   `rem_demand -= dispatch`.\n                *   If `rem_demand > 0`, this is load shedding `l_s`.\n                    *   `dispatch_cost += rem_demand * M`.\n                *   This function returns the total second-stage variable cost for a given scenario.\n        *   Expected second-stage cost: $C_2(u_1, u_2) = \\sum_s p_s Q_s(u_1, u_2)$.\n        *   Total expected cost for commitment $(u_1, u_2)$: $C_{total}(u_1, u_2) = C_1(u_1, u_2) + C_2(u_1, u_2)$.\n\n    *   **Calculate the SUC optimal cost:**\n        *   Calculate $C_{total}(u_1, u_2)$ for all 4 commitment combinations.\n        *   The SUC optimal cost is $C_{SUC}^* = \\min_{(u_1, u_2) \\in U} C_{total}(u_1, u_2)$.\n        *   The SUC optimal commitment is $(u_1^*, u_2^*) = \\arg\\min_{(u_1, u_2) \\in U} C_{total}(u_1, u_2)$.\n\n    *   **Calculate the EV commitment and its evaluated cost (EEV):**\n        *   Calculate the expected demand: $\\bar{D} = \\sum_s p_s D_s$.\n        *   Solve the Deterministic Expected-Value (EV) problem. This is a deterministic unit commitment problem for demand $\\bar{D}$.\n        *   The objective is to minimize first-stage cost + second-stage cost for demand $\\bar{D}$, *without load shedding*.\n        *   For each commitment $(u_1, u_2) \\in U$:\n            *   Check if the commitment is feasible for the EV problem: Total committed capacity must be sufficient to meet $\\bar{D}$.\n                *   Feasibility condition: $\\sum_i P^{\\max}_i u_i \\ge \\bar{D}$.\n            *   If feasible, calculate the deterministic cost:\n                *   First-stage cost: $C_1(u_1, u_2)$.\n                *   Dispatch cost for demand $\\bar{D}$: This is an economic dispatch problem without load shedding. Use the same merit-order logic.\n                    *   `dispatch_cost_ev = calculate_dispatch_cost(demand = \\bar{D}, u = (u_1,u_2))`, but ensuring `rem_demand` at the end is 0.\n                *   Total deterministic cost: $C_{EV}(u_1, u_2) = C_1(u_1, u_2) + \\text{dispatch\\_cost\\_ev}$.\n        *   Find the optimal EV commitment $(u_1^{EV}, u_2^{EV})$ by minimizing $C_{EV}(u_1, u_2)$ over all feasible commitments.\n            *   $C_{EV}^* = \\min_{(u_1, u_2) \\text{ is feasible}} C_{EV}(u_1, u_2)$.\n            *   $(u_1^{EV}, u_2^{EV}) = \\arg\\min_{(u_1, u_2) \\text{ is feasible}} C_{EV}(u_1, u_2)$.\n        *   Now, evaluate the cost of this *fixed* EV commitment $(u_1^{EV}, u_2^{EV})$ under the original stochastic scenarios.\n        *   The evaluated expected value (EEV) is simply the total expected cost for the specific commitment $(u_1^{EV}, u_2^{EV})$.\n        *   $C_{EEV} = C_{total}(u_1^{EV}, u_2^{EV}) = C_1(u_1^{EV}, u_2^{EV}) + \\sum_s p_s Q_s(u_1^{EV}, u_2^{EV})$.\n\n    *   **Calculate the final result:**\n        *   Result = $C_{EEV} - C_{SUC}^*$.\n\n5.  **Apply the algorithm to each test case:**\n\n    *   **Unit Data (common):**\n        *   Unit 1: $P^{\\max}_1=100, c_1=20, C^{\\mathrm{su}}_1=1000, C^{\\mathrm{nl}}_1=500$. Total fixed cost if on: $1500$.\n        *   Unit 2: $P^{\\max}_2=50, c_2=25, C^{\\mathrm{su}}_2=100, C^{\\mathrm{nl}}_2=0$. Total fixed cost if on: $100$.\n\n    *   **Commitment Combinations:**\n        *   $u=(0,0)$: Capacity $0$. Fixed cost $0$.\n        *   $u=(0,1)$: Capacity $50$. Fixed cost $100$.\n        *   $u=(1,0)$: Capacity $100$. Fixed cost $1500$.\n        *   $u=(1,1)$: Capacity $150$. Fixed cost $1600$.\n\n    ---\n    ### **Case 1: General**\n    *   Scenarios: $D_1=40, p_1=0.6$; $D_2=120, p_2=0.4$.\n    *   Penalty: $M=200$.\n\n    **Step A: Calculate Expected Costs for All Commitments (for SUC)**\n    Let's write a function `get_dispatch_cost(demand, u, M)`.\n    *   `u=(0,0)`: Capacity $0$.\n        *   Scenario 1 (Demand 40): Shed 40. Cost = $40 \\times 200 = 8000$.\n        *   Scenario 2 (Demand 120): Shed 120. Cost = $120 \\times 200 = 24000$.\n        *   Fixed cost: $0$.\n        *   Expected cost: $0 + 0.6 \\times 8000 + 0.4 \\times 24000 = 4800 + 9600 = 14400$.\n    *   `u=(0,1)`: Capacity $50$. Unit 2 is on.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 2. Cost = $40 \\times 25 = 1000$.\n        *   Scenario 2 (Demand 120): Dispatch 50 from Unit 2, shed 70. Cost = $50 \\times 25 + 70 \\times 200 = 1250 + 14000 = 15250$.\n        *   Fixed cost: $100$.\n        *   Expected cost: $100 + 0.6 \\times 1000 + 0.4 \\times 15250 = 100 + 600 + 6100 = 6800$.\n    *   `u=(1,0)`: Capacity $100$. Unit 1 is on.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 1. Cost = $40 \\times 20 = 800$.\n        *   Scenario 2 (Demand 120): Dispatch 100 from Unit 1, shed 20. Cost = $100 \\times 20 + 20 \\times 200 = 2000 + 4000 = 6000$.\n        *   Fixed cost: $1500$.\n        *   Expected cost: $1500 + 0.6 \\times 800 + 0.4 \\times 6000 = 1500 + 480 + 2400 = 4380$.\n    *   `u=(1,1)`: Capacity $150$. Both units on.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 1. Cost = $40 \\times 20 = 800$.\n        *   Scenario 2 (Demand 120): Dispatch 100 from Unit 1, 20 from Unit 2. Cost = $100 \\times 20 + 20 \\times 25 = 2000 + 500 = 2500$.\n        *   Fixed cost: $1600$.\n        *   Expected cost: $1600 + 0.6 \\times 800 + 0.4 \\times 2500 = 1600 + 480 + 1000 = 3080$.\n\n    **Step B: Find SUC Optimum**\n    Costs for each commitment:\n    *   $u=(0,0)$: $14400$\n    *   $u=(0,1)$: $6800$\n    *   $u=(1,0)$: $4380$\n    *   $u=(1,1)$: $3080$\n    *   $C_{SUC}^* = 3080$.\n    *   Optimal SUC commitment: $u_{SUC}^* = (1,1)$.\n\n    **Step C: Solve EV Problem**\n    *   Expected demand: $\\bar{D} = 0.6 \\times 40 + 0.4 \\times 120 = 24 + 48 = 72$.\n    *   Find EV commitment. We need to find the cheapest commitment that can supply $72$ MW.\n        *   $u=(0,0)$: Capacity 0 < 72. Infeasible.\n        *   $u=(0,1)$: Capacity 50 < 72. Infeasible.\n        *   $u=(1,0)$: Capacity 100 > 72. Feasible.\n            *   Fixed cost: $1500$.\n            *   Dispatch cost for 72 MW: Dispatch 72 from Unit 1. Cost = $72 \\times 20 = 1440$.\n            *   Total EV cost: $1500 + 1440 = 2940$.\n        *   $u=(1,1)$: Capacity 150 > 72. Feasible.\n            *   Fixed cost: $1600$.\n            *   Dispatch cost for 72 MW: Dispatch 72 from Unit 1. Cost = $72 \\times 20 = 1440$.\n            *   Total EV cost: $1600 + 1440 = 3040$.\n    *   Compare costs for feasible EV commitments: $2940 < 3040$.\n    *   Optimal EV commitment: $u_{EV}^* = (1,0)$.\n\n    **Step D: Calculate EEV Cost**\n    *   The EEV cost is the expected cost of the EV commitment, $u_{EV}^* = (1,0)$.\n    *   We already calculated this in Step A.\n    *   $C_{EEV} = C_{total}(1,0) = 4380$.\n\n    **Step E: Final Calculation for Case 1**\n    *   Result = $C_{EEV} - C_{SUC}^* = 4380 - 3080 = 1300$.\n\n    ---\n    ### **Case 2: Boundary case**\n    *   Scenarios: $D_1=40, p_1=0.95$; $D_2=120, p_2=0.05$.\n    *   Penalty: $M=200$.\n\n    **Step A: Calculate Expected Costs for All Commitments (for SUC)**\n    *   `u=(0,0)`: Capacity $0$.\n        *   Scenario 1 (Demand 40): Shed 40. Cost = $40 \\times 200 = 8000$.\n        *   Scenario 2 (Demand 120): Shed 120. Cost = $120 \\times 200 = 24000$.\n        *   Expected cost: $0.95 \\times 8000 + 0.05 \\times 24000 = 7600 + 1200 = 8800$.\n    *   `u=(0,1)`: Capacity $50$.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 2. Cost = $40 \\times 25 = 1000$.\n        *   Scenario 2 (Demand 120): Dispatch 50 from Unit 2, shed 70. Cost = $50 \\times 25 + 70 \\times 200 = 1250 + 14000 = 15250$.\n        *   Fixed cost: $100$.\n        *   Expected cost: $100 + 0.95 \\times 1000 + 0.05 \\times 15250 = 100 + 950 + 762.5 = 1812.5$.\n    *   `u=(1,0)`: Capacity $100$.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 1. Cost = $40 \\times 20 = 800$.\n        *   Scenario 2 (Demand 120): Dispatch 100 from Unit 1, shed 20. Cost = $100 \\times 20 + 20 \\times 200 = 2000 + 4000 = 6000$.\n        *   Fixed cost: $1500$.\n        *   Expected cost: $1500 + 0.95 \\times 800 + 0.05 \\times 6000 = 1500 + 760 + 300 = 2560$.\n    *   `u=(1,1)`: Capacity $150$.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 1. Cost = $40 \\times 20 = 800$.\n        *   Scenario 2 (Demand 120): Dispatch 100 from Unit 1, 20 from Unit 2. Cost = $100 \\times 20 + 20 \\times 25 = 2500$.\n        *   Fixed cost: $1600$.\n        *   Expected cost: $1600 + 0.95 \\times 800 + 0.05 \\times 2500 = 1600 + 760 + 125 = 2485$.\n\n    **Step B: Find SUC Optimum**\n    Costs for each commitment:\n    *   $u=(0,0)$: $8800$\n    *   $u=(0,1)$: $1812.5$\n    *   $u=(1,0)$: $2560$\n    *   $u=(1,1)$: $2485$\n    *   $C_{SUC}^* = 1812.5$.\n    *   Optimal SUC commitment: $u_{SUC}^* = (0,1)$.\n\n    **Step C: Solve EV Problem**\n    *   Expected demand: $\\bar{D} = 0.95 \\times 40 + 0.05 \\times 120 = 38 + 6 = 44$.\n    *   Find EV commitment. We need capacity $\\ge 44$.\n        *   $u=(0,0)$: Capacity 0 < 44. Infeasible.\n        *   $u=(0,1)$: Capacity 50 > 44. Feasible.\n            *   Fixed cost: $100$.\n            *   Dispatch cost for 44 MW: Dispatch 44 from Unit 2. Cost = $44 \\times 25 = 1100$.\n            *   Total EV cost: $100 + 1100 = 1200$.\n        *   $u=(1,0)$: Capacity 100 > 44. Feasible.\n            *   Fixed cost: $1500$.\n            *   Dispatch cost for 44 MW: Dispatch 44 from Unit 1. Cost = $44 \\times 20 = 880$.\n            *   Total EV cost: $1500 + 880 = 2380$.\n        *   $u=(1,1)$: Capacity 150 > 44. Feasible.\n            *   Fixed cost: $1600$.\n            *   Dispatch cost for 44 MW: Dispatch 44 from Unit 1. Cost = $44 \\times 20 = 880$.\n            *   Total EV cost: $1600 + 880 = 2480$.\n    *   Compare costs for feasible EV commitments: $1200 < 2380 < 2480$.\n    *   Optimal EV commitment: $u_{EV}^* = (0,1)$.\n\n    **Step D: Calculate EEV Cost**\n    *   The EEV cost is the expected cost of the EV commitment, $u_{EV}^* = (0,1)$.\n    *   We calculated this in Step A.\n    *   $C_{EEV} = C_{total}(0,1) = 1812.5$.\n    *   Notice that $u_{EV}^* = u_{SUC}^* = (0,1)$.\n\n    **Step E: Final Calculation for Case 2**\n    *   Result = $C_{EEV} - C_{SUC}^* = 1812.5 - 1812.5 = 0$. This makes sense, as the problem statement hints that the EV and SUC commitments would coincide.\n\n    ---\n    ### **Case 3: Low penalty**\n    *   Scenarios: $D_1=40, p_1=0.6$; $D_2=120, p_2=0.4$. (Same as Case 1)\n    *   Penalty: $M=30$.\n\n    **Step A: Calculate Expected Costs for All Commitments (for SUC)**\n    The dispatch logic changes slightly because the penalty $M=30$ is now between the costs of Unit 1 ($c_1=20$) and Unit 2 ($c_2=25$). No, wait, $M=30$ is more expensive than both units. The merit order is Unit 1, Unit 2, Load Shedding.\n    Let's check: $c_1=20 < c_2=25 < M=30$. The economic dispatch merit order remains the same.\n    So I just need to re-calculate with the new $M$.\n\n    *   `u=(0,0)`: Capacity $0$.\n        *   Scenario 1 (Demand 40): Shed 40. Cost = $40 \\times 30 = 1200$.\n        *   Scenario 2 (Demand 120): Shed 120. Cost = $120 \\times 30 = 3600$.\n        *   Expected cost: $0.6 \\times 1200 + 0.4 \\times 3600 = 720 + 1440 = 2160$.\n    *   `u=(0,1)`: Capacity $50$.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 2. Cost = $40 \\times 25 = 1000$.\n        *   Scenario 2 (Demand 120): Dispatch 50 from Unit 2, shed 70. Cost = $50 \\times 25 + 70 \\times 30 = 1250 + 2100 = 3350$.\n        *   Fixed cost: $100$.\n        *   Expected cost: $100 + 0.6 \\times 1000 + 0.4 \\times 3350 = 100 + 600 + 1340 = 2040$.\n    *   `u=(1,0)`: Capacity $100$.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 1. Cost = $40 \\times 20 = 800$.\n        *   Scenario 2 (Demand 120): Dispatch 100 from Unit 1, shed 20. Cost = $100 \\times 20 + 20 \\times 30 = 2000 + 600 = 2600$.\n        *   Fixed cost: $1500$.\n        *   Expected cost: $1500 + 0.6 \\times 800 + 0.4 \\times 2600 = 1500 + 480 + 1040 = 3020$.\n    *   `u=(1,1)`: Capacity $150$.\n        *   Scenario 1 (Demand 40): Dispatch 40 from Unit 1. Cost = $40 \\times 20 = 800$.\n        *   Scenario 2 (Demand 120): Dispatch 100 from Unit 1, 20 from Unit 2. Cost = $100 \\times 20 + 20 \\times 25 = 2000 + 500 = 2500$.\n        *   Fixed cost: $1600$.\n        *   Expected cost: $1600 + 0.6 \\times 800 + 0.4 \\times 2500 = 1600 + 480 + 1000 = 3080$.\n\n    **Step B: Find SUC Optimum**\n    Costs for each commitment:\n    *   $u=(0,0)$: $2160$\n    *   $u=(0,1)$: $2040$\n    *   $u=(1,0)$: $3020$\n    *   $u=(1,1)$: $3080$\n    *   $C_{SUC}^* = 2040$.\n    *   Optimal SUC commitment: $u_{SUC}^* = (0,1)$.\n\n    **Step C: Solve EV Problem**\n    *   Scenarios are the same as Case 1, so $\\bar{D} = 72$.\n    *   The EV problem does not involve the penalty M, as it assumes demand is met exactly.\n    *   Therefore, the calculation for the EV commitment is identical to Case 1.\n    *   EV costs for feasible commitments: $C_{EV}(1,0) = 2940$, $C_{EV}(1,1) = 3040$.\n    *   Optimal EV commitment: $u_{EV}^* = (1,0)$.\n\n    **Step D: Calculate EEV Cost**\n    *   The EEV cost is the expected cost of the EV commitment, $u_{EV}^* = (1,0)$, calculated with $M=30$.\n    *   We already calculated this in Step A.\n    *   $C_{EEV} = C_{total}(1,0) = 3020$.\n\n    **Step E: Final Calculation for Case 3**\n    *   Result = $C_{EEV} - C_{SUC}^* = 3020 - 2040 = 980$.\n\n    ---\n    **Summary of Results:**\n    *   Case 1: $1300.0$\n    *   Case 2: $0.0$\n    *   Case 3: $980.0$\n\n    Final output should be `[1300.0,0.0,980.0]`.\n\n    **Implementation Details:**\n    *   Need a `solve()` function.\n    *   Inside `solve()`, define the test cases as a list of tuples/dicts. Each case contains the scenario data ($D_s, p_s$) and the penalty $M$.\n    *   The unit data is constant and can be defined outside the loop.\n    *   Main loop iterates through the test cases.\n    *   Inside the loop, implement the 5 steps:\n        1.  `calculate_all_expected_costs` function:\n            *   Iterates through the 4 commitments.\n            *   For each commitment, calculate fixed cost.\n            *   For each commitment, calculate expected dispatch cost by looping through scenarios.\n            *   The dispatch cost calculation itself is a merit-order loading.\n            *   Store the total expected costs in a dictionary or list, e.g., `expected_costs[(u1,u2)] = cost`.\n        2.  Find SUC optimum: `min(expected_costs.values())`.\n        3.  `find_ev_commitment` function:\n            *   Calculate expected demand `D_bar`.\n            *   Iterate through the 4 commitments.\n            *   Filter for feasible ones (`P_total >= D_bar`).\n            *   For each feasible commitment, calculate its deterministic cost (fixed cost + dispatch cost for `D_bar` *without* shedding).\n            *   Find the commitment with the minimum deterministic cost. This is `u_ev_star`.\n        4.  Calculate EEV cost: This is simply `expected_costs[u_ev_star]`.\n        5.  Calculate the difference: `EEV_cost - SUC_opt_cost`.\n    *   Store results in a list and format the final print statement.\n\n    Let's double-check the logic for the EV problem. \"minimizes the sum of first-stage costs and second-stage variable costs at $\\bar{D}$, subject to meeting $\\bar{D}$ exactly with committed capacity and without load shedding.\" This means I must filter out any commitment `u` where `sum(P_max_i * u_i) < D_bar`. My logic for this is correct.\n\n    The structure of the code will be:\n    ```python\n    # unit_data\n    # test_cases\n\n    # helper function: calculate_dispatch_cost(demand, u, P_max_list, c_list, M)\n        # sort committed units by cost\n        # dispatch greedily\n        # handle load shedding\n        # return cost\n\n    def solve():\n        # ...\n        results = []\n        for case in test_cases:\n            # scenarios, M = case\n            \n            # Step A & B: SUC Calculation\n            all_commitments = [(0,0), (0,1), (1,0), (1,1)]\n            commitment_costs = {}\n            for u in all_commitments:\n                fixed_cost = (C_su1 + C_nl1)*u[0] + (C_su2 + C_nl2)*u[1]\n                expected_dispatch_cost = 0\n                for d, p in scenarios:\n                    dispatch_cost = calculate_dispatch_cost(d, u, ...)\n                    expected_dispatch_cost += p * dispatch_cost\n                total_expected_cost = fixed_cost + expected_dispatch_cost\n                commitment_costs[u] = total_expected_cost\n            \n            suc_cost = min(commitment_costs.values())\n            \n            # Step C: EV Calculation\n            d_bar = sum(p * d for d, p in scenarios)\n            \n            ev_candidates = []\n            for u in all_commitments:\n                capacity = P_max1*u[0] + P_max2*u[1]\n                if capacity >= d_bar:\n                    # In EV problem, M is effectively infinite, no shedding allowed\n                    # The dispatch logic is the same, but it's an error if demand > capacity\n                    dispatch_cost_ev = calculate_dispatch_cost(d_bar, u, P_max_list, c_list, M=float('inf'))\n                    fixed_cost = (C_su1 + C_nl1)*u[0] + (C_su2 + C_nl2)*u[1]\n                    total_ev_cost = fixed_cost + dispatch_cost_ev\n                    ev_candidates.append((total_ev_cost, u))\n                    \n            best_ev_cost, u_ev_star = min(ev_candidates, key=lambda x: x[0])\n            \n            # Step D: EEV Calculation\n            eev_cost = commitment_costs[u_ev_star]\n            \n            # Step E: Final result\n            result = eev_cost - suc_cost\n            results.append(result)\n            \n        print(...)\n    ```\n    This looks solid. The merit order dispatch function will be key.\n    - Units sorted by cost: Unit 1 ($c=20$), Unit 2 ($c=25$).\n    - So if both are on, always use Unit 1 first up to its capacity, then Unit 2.\n\n    Let's refine the `calculate_dispatch_cost` logic.\n    `calculate_dispatch_cost(demand, u, M)`\n    - `dispatch_cost = 0`\n    - `rem_demand = demand`\n    - `u1, u2 = u`\n    - if `u1 == 1`:\n        `dispatch1 = min(rem_demand, P_max1)`\n        `dispatch_cost += dispatch1 * c1`\n        `rem_demand -= dispatch1`\n    - if `u2 == 1`:\n        `dispatch2 = min(rem_demand, P_max2)`\n        `dispatch_cost += dispatch2 * c2`\n        `rem_demand -= dispatch2`\n    - if `rem_demand > 0`:\n        `dispatch_cost += rem_demand * M`\n    - return `dispatch_cost`\n    This is simple and will work for the two-unit case. A more general implementation would loop through the sorted committed units.\n\n    The problem validation step is crucial.\n    **Step 1: Extract Givens**\n    - System: 2 thermal units ($i \\in \\{1,2\\}$), 1 time period (1 hour).\n    - Unit 1 data: $P^{\\max}_1 = 100$ MW, $c_1 = 20$ \\$/MWh, $C^{\\mathrm{su}}_1 = 1000$ \\$, $C^{\\mathrm{nl}}_1 = 500$ \\$.\n    - Unit 2 data: $P^{\\max}_2 = 50$ MW, $c_2 = 25$ \\$/MWh, $C^{\\mathrm{su}}_2 = 100$ \\$, $C^{\\mathrm{nl}}_2 = 0$ \\$.\n    - First-stage decisions: $u_i \\in \\{0,1\\}$ (commitment).\n    - Second-stage decisions: $g_{i,s} \\ge 0$ (dispatch), $l_s \\ge 0$ (load shedding).\n    - Scenarios: $s$, with demand $D_s$ and probability $p_s$.\n    - Penalty: $M$ \\$/MWh for non-served energy.\n    - Second-stage constraints (for each scenario $s$):\n        - $\\sum_{i=1}^2 g_{i,s} + l_s = D_s$\n        - $0 \\le g_{i,s} \\le P^{\\max}_i u_i$\n    - Second-stage cost (for scenario $s$): $\\sum_{i=1}^2 c_i g_{i,s} + M l_s$.\n    - First-stage cost: $\\sum_{i=1}^2 (C^{\\mathrm{su}}_i u_i + C^{\\mathrm{nl}}_i u_i)$.\n    - SUC problem: Minimize sum of first-stage costs and expected second-stage costs.\n    - EV problem: Replace $D_s$ with $\\bar{D} = \\sum_s p_s D_s$. Minimize deterministic cost for $\\bar{D}$, meeting demand exactly (no load shedding).\n    - EEV: Expected cost of the fixed EV commitment under the stochastic scenarios.\n    - Quantity to compute: EEV cost - SUC optimal cost.\n    - Case 1: $D_1 = 40, p_1 = 0.6; D_2 = 120, p_2 = 0.4$. $M = 200$.\n    - Case 2: $D_1 = 40, p_1 = 0.95; D_2 = 120, p_2 = 0.05$. $M = 200$.\n    - Case 3: $D_1 = 40, p_1 = 0.6; D_2 = 120, p_2 = 0.4$. $M = 30$.\n    - Assumptions: 1hr period, units initially off, min generation is 0, no ramping.\n\n    **Step 2: Validate a priori**\n    - Scientifically Grounded: Yes. This is a standard, simplified model in power systems economics and operations research. The concepts of unit commitment, economic dispatch, stochastic programming, expected value solution, and value of the stochastic solution are fundamental in this field.\n    - Well-Posed: Yes. The objective function and constraints are linear. The decision space is finite and small (4 commitment choices). For each choice, the recourse problem (economic dispatch) is a simple LP with a unique, stable solution. The overall problem is a two-stage stochastic integer program, which for this small size is guaranteed to have a solution. The problem asks for a specific, computable quantity.\n    - Objective: Yes. The language is precise, using standard technical terms. All parameters are given numerically. The goal is clearly defined.\n    - Factual Soundness: OK.\n    - Formalizable: Yes, it's already formalized mathematically.\n    - Complete/Consistent: Yes, all necessary data ($P^{\\max}, c, C^{\\mathrm{su}}, C^{\\mathrm{nl}}, D_s, p_s, M$) is provided. There are no contradictions. The assumptions clarify potential ambiguities (initial state, min generation).\n    - Realistic: The values are for a \"toy\" system, but they are not physically impossible or inconsistent.\n    - Well-Structured: Yes, a unique solution exists and the path to it is clear.\n    - Not Trivial: No, it requires understanding and applying the definitions of SUC, EV, and EEV, and performing several calculation steps.\n    - Verifiable: Yes, the calculations are deterministic and can be independently verified.\n\n    **Step 3: Verdict**\n    The problem is valid. I can proceed with the solution I've outlined.\n\n    Final check of my calculations.\n    *Case 1:*\n    - SUC cost for `u=(1,1)` is $1600 + 0.6 \\times (40 \\times 20) + 0.4 \\times (100 \\times 20 + 20 \\times 25) = 1600 + 0.6 \\times 800 + 0.4 \\times 2500 = 1600 + 480 + 1000 = 3080$. Correct.\n    - EV commitment is `u=(1,0)`. Its deterministic cost is $1500 + 72 \\times 20 = 1500 + 1440 = 2940$. Correct.\n    - EEV cost is the stochastic cost of `u=(1,0)`. $1500 + 0.6 \\times (40 \\times 20) + 0.4 \\times (100 \\times 20 + 20 \\times 200) = 1500 + 0.6 \\times 800 + 0.4 \\times 6000 = 1500 + 480 + 2400 = 4380$. Correct.\n    - Difference = $4380 - 3080 = 1300$. OK.\n\n    *Case 2:*\n    - SUC cost for `u=(0,1)` is $100 + 0.95 \\times (40 \\times 25) + 0.05 \\times (50 \\times 25 + 70 \\times 200) = 100 + 0.95 \\times 1000 + 0.05 \\times 15250 = 100 + 950 + 762.5 = 1812.5$. Correct.\n    - SUC cost for `u=(1,1)` is $1600 + 0.95 \\times (40 \\times 20) + 0.05 \\times (100 \\times 20 + 20 \\times 25) = 1600 + 0.95 \\times 800 + 0.05 \\times 2500 = 1600 + 760 + 125 = 2485$. Correct.\n    - EV commitment is `u=(0,1)`. Its deterministic cost is $100 + 44 \\times 25 = 100 + 1100 = 1200$. Correct.\n    - EV and SUC commitments match.\n    - EEV cost = SUC cost = 1812.5.\n    - Difference = $0$. OK.\n\n    *Case 3:*\n    - SUC cost for `u=(0,1)` is $100 + 0.6 \\times (40 \\times 25) + 0.4 \\times (50 \\times 25 + 70 \\times 30) = 100 + 0.6 \\times 1000 + 0.4 \\times (1250 + 2100) = 100 + 600 + 0.4 \\times 3350 = 700 + 1340 = 2040$. Correct.\n    - EV commitment is `u=(1,0)` (same as Case 1).\n    - EEV cost is stochastic cost of `u=(1,0)` with $M=30$. $1500 + 0.6 \\times (40 \\times 20) + 0.4 \\times (100 \\times 20 + 20 \\times 30) = 1500 + 0.6 \\times 800 + 0.4 \\times (2000+600) = 1500 + 480 + 0.4 \\times 2600 = 1980 + 1040 = 3020$. Correct.\n    - Difference = $3020 - 2040 = 980$. OK.\n\n    The calculations seem robust. I can proceed to write the code.\n    The code should be clean and readable, a function for each major component would be good.\n    - `calculate_dispatch_and_cost`\n    - `calculate_total_expected_cost`\n    - `solve_ev_problem`\n    - `solve_case`\n    - main `solve` orchestrator function.\n\n    The problem asks for the code in a specific structure. I'll follow that structure.\n    I can use a tuple `(cost, dispatch_plan)` from the dispatch function if I want to be more explicit, but the problem only requires the cost.\n    The units are sorted by cost: unit 1, then unit 2. This is constant.\n    `units = [{'id': 1, 'Pmax': 100, 'c': 20, 'Csu': 1000, 'Cnl': 500}, {'id': 2, 'Pmax': 50, 'c': 25, 'Csu': 100, 'Cnl': 0}]`\n    `fixed_cost = Csu + Cnl`\n    Let's refine the dispatch logic again to be robust.\n    `def economic_dispatch(demand, commitment, units, penalty_cost)`:\n        - `rem_demand = demand`\n        - `cost = 0`\n        - committed_units = `[u for i, u in enumerate(units) if commitment[i] == 1]`\n        - `committed_units.sort(key=lambda u: u['c'])` -- not needed as they are already sorted by cost in my definition.\n        - if `commitment[0] == 1`: # Unit 1\n            `dispatch = min(rem_demand, units[0]['Pmax'])`\n            `cost += dispatch * units[0]['c']`\n            `rem_demand -= dispatch`\n        - if `commitment[1] == 1`: # Unit 2\n            `dispatch = min(rem_demand, units[1]['Pmax'])`\n            `cost += dispatch * units[1]['c']`\n            `rem_demand -= dispatch`\n        - if `rem_demand > 0`:\n            `cost += rem_demand * penalty_cost`\n        - return `cost`\n    This is simple and will work for the two-unit case. A more general implementation would loop through the sorted committed units.\n\n    The problem states `scipy` is available but `numpy` should be sufficient. In fact, no external libraries are needed at all for this problem. I will import numpy as requested. The problem has a specific requirement on `numpy==1.23.5` and `scipy==1.11.4`, even if I don't use `scipy`. I will make sure the code reflects the specified environment. The code itself won't need these libraries, but the template in the prompt includes them, so I will stick to it. Wait, the prompt states `scipy, version: 1.11.4` is available but not necessarily required to be imported. I'll import `numpy` since it's common practice for numerical problems, even if standard lists and floats would suffice here. I'll use `np.dot` for some calculations if it cleans up the code.\n    E.g., `np.dot(probabilities, scenario_costs)`. Ok, let's use that.\n\n    Final check on output format: `[r_1,r_2,r_3]`, comma-separated list of floats in brackets. `f\"[{','.join(map(str, results))}]\"` looks correct.\n\n    The problem validation text should be formal and follow the required structure. I will state the validation verdict and then proceed to the solution. The problem statement itself is very clear and well-formed, so validation is straightforward.\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **System Parameters**: $2$ thermal units ($i \\in \\{1,2\\}$), $1$ time period of duration $1$ hour.\n- **Unit 1 Data**: $P^{\\max}_1 = 100$ MW, $c_1 = 20$ dollars/MWh, $C^{\\mathrm{su}}_1 = 1000$ dollars, $C^{\\mathrm{nl}}_1 = 500$ dollars.\n- **Unit 2 Data**: $P^{\\max}_2 = 50$ MW, $c_2 = 25$ dollars/MWh, $C^{\\mathrm{su}}_2 = 100$ dollars, $C^{\\mathrm{nl}}_2 = 0$ dollars.\n- **First-Stage Decisions**: Binary commitment variables $u_i \\in \\{0,1\\}$ for each unit $i$.\n- **Second-Stage Decisions**: Dispatch levels $g_{i,s} \\ge 0$ and nonserved energy $l_s \\ge 0$ for each scenario $s$.\n- **Penalty Cost**: $M$ dollars per MWh of nonserved energy.\n- **Scenario Data**: Scenarios are defined by demand $D_s$ (MWh) and probability $p_s$.\n- **Model Equations**:\n    - First-stage cost: $\\sum_{i=1}^2 (C^{\\mathrm{su}}_i + C^{\\mathrm{nl}}_i) u_i$.\n    - Second-stage constraints per scenario $s$: $\\sum_{i=1}^2 g_{i,s} + l_s = D_s$ and $0 \\le g_{i,s} \\le P^{\\max}_i u_i$.\n    - Second-stage cost per scenario $s$: $\\sum_{i=1}^2 c_i g_{i,s} + M l_s$.\n- **Problem Definitions**:\n    - **Stochastic Unit Commitment (SUC)**: Minimizes the sum of first-stage cost and the expected second-stage costs over all feasible commitments.\n    - **Deterministic Expected-Value (EV)**: Replaces random demand $D_s$ with expected demand $\\bar{D} = \\sum_s p_s D_s$. Minimizes total cost for $\\bar{D}$ subject to meeting demand exactly (no load shedding).\n    - **Evaluated Expected Value (EEV)**: The expected cost under stochastic scenarios resulting from using the fixed commitment found by solving the EV problem.\n- **Objective**: Compute the difference between the EEV cost and the optimal SUC cost in dollars.\n- **Test Cases**:\n    - **Case 1**: Scenarios: $D_1 = 40$ MWh, $p_1 = 0.6$; $D_2 = 120$ MWh, $p_2 = 0.4$. Penalty: $M = 200$ dollars/MWh.\n    - **Case 2**: Scenarios: $D_1 = 40$ MWh, $p_1 = 0.95$; $D_2 = 120$ MWh, $p_2 = 0.05$. Penalty: $M = 200$ dollars/MWh.\n    - **Case 3**: Scenarios: $D_1 = 40$ MWh, $p_1 = 0.6$; $D_2 = 120$ MWh, $p_2 = 0.4$. Penalty: $M = 30$ dollars/MWh.\n- **Assumptions**: $1$ hour period duration ($1$ MW = $1$ MWh), all units initially off, minimum generation is $0$ MWh, no ramping constraints.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is evaluated against the validation criteria:\n- **Scientifically Grounded**: The problem is a classic application of two-stage stochastic integer programming to the unit commitment problem in power systems, which is a standard and well-established topic in energy systems modeling and operations research. All concepts (economic dispatch, stochastic optimization, expected value solution) are scientifically sound.\n- **Well-Posed**: The problem is well-posed. The decision space for the first-stage commitment is finite ($2^2 = 4$ possibilities). For each commitment, the second-stage subproblem (economic dispatch) is a linear program with a unique, stable solution. The objective functions and constraints are clearly defined, ensuring a single, meaningful solution for the required value.\n- **Objective**: The problem is stated in precise, objective, and formal mathematical language. All terms are standard within the field.\n- **Completeness and Consistency**: All necessary data for the units, scenarios, and costs are provided for each case. The assumptions clarify any potential ambiguities (e.g., initial state, minimum generation). There are no internal contradictions.\n- **Realism**: The parameters describe a \"toy\" system, but they are physically consistent and plausible within that context.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is **valid**. It is self-contained, scientifically grounded, well-posed, and all its components are clearly and consistently defined. The solution process can proceed.\n\n### Principle-Based Design and Solution\n\nThe core task is to compute the value of the stochastic solution (VSS), which measures the benefit of using a stochastic optimization model over a simpler deterministic one. Here, it is defined as the cost increase from using the deterministic (EV) solution in the stochastic environment, i.e., $VSS = C_{EEV} - C_{SUC}^*$. The solution proceeds by enumerating all possible first-stage decisions for the two-unit system.\n\n**1. First-Stage Decision Space**\nWith two units, there are four possible commitment decisions $(u_1, u_2)$: $(0,0)$, $(0,1)$, $(1,0)$, and $(1,1)$. We will evaluate the costs associated with each.\n\n**2. Second-Stage Economic Dispatch**\nFor any given commitment $(u_1, u_2)$ and demand scenario $D_s$, the second-stage problem is an economic dispatch. The goal is to meet the demand at minimum variable cost. This is solved using a merit-order loading principle: dispatch the committed generator with the lowest variable cost first, up to its maximum capacity, then the next-cheapest generator, and so on. If the total committed capacity is insufficient to meet demand, the deficit is met by \"load shedding\" (nonserved energy $l_s$) at a high penalty cost $M$.\nThe unit data gives $c_1 = 20 < c_2 = 25$. Thus, Unit $1$ is always dispatched before Unit $2$.\n\n**3. Stochastic Unit Commitment (SUC) Solution**\nThe SUC problem seeks to find the commitment $(u_1, u_2)$ that minimizes the total expected cost. The total expected cost for a given commitment is the sum of its fixed first-stage cost and the expected second-stage dispatch cost.\n- First-stage cost: $C_1(u_1, u_2) = (C^{\\mathrm{su}}_1 + C^{\\mathrm{nl}}_1)u_1 + (C^{\\mathrm{su}}_2 + C^{\\mathrm{nl}}_2)u_2$.\n- Expected second-stage cost: $E[C_2(u_1, u_2)] = \\sum_s p_s \\left( \\sum_{i=1}^2 c_i g_{i,s} + M l_s \\right)$, where $g_{i,s}$ and $l_s$ are the optimal solutions to the economic dispatch subproblem for scenario $s$.\n- Total Expected Cost: $C_{total}(u_1, u_2) = C_1(u_1, u_2) + E[C_2(u_1, u_2)]$.\n\nBy calculating $C_{total}$ for all four commitment options, we can find the optimal SUC cost, $C_{SUC}^* = \\min_{(u_1, u_2)} C_{total}(u_1, u_2)$, and the corresponding optimal commitment $(u_1^*, u_2^*)_{SUC}$.\n\n**4. Expected Value (EV) Solution and Evaluated Expected Value (EEV)**\nThe EV problem is a deterministic simplification where the uncertain demand $D_s$ is replaced by its expected value, $\\bar{D} = \\sum_s p_s D_s$. The problem is to find the commitment $(u_1, u_2)$ that minimizes the deterministic cost to serve $\\bar{D}$, with the constraint that total committed capacity must be sufficient, i.e., $\\sum_i P_i^{\\max} u_i \\ge \\bar{D}$.\n- Deterministic Cost: $C_{EV}(u_1, u_2) = C_1(u_1, u_2) + (\\text{dispatch cost for }\\bar{D})$.\nThe optimal EV commitment, $(u_1, u_2)_{EV}$, is the one that minimizes $C_{EV}$ among all feasible commitments.\n\nThe Evaluated Expected Value (EEV) is the total expected cost of using this fixed EV commitment, $(u_1, u_2)_{EV}$, in the original stochastic environment. This is calculated as:\n$C_{EEV} = C_{total}((u_1, u_2)_{EV})$.\n\n**5. Final Calculation**\nThe final result for each case is the difference $C_{EEV} - C_{SUC}^*$.\n\n**Calculations for Case 1 ($D_1=40, p_1=0.6; D_2=120, p_2=0.4; M=200$):**\n- **SUC:** By enumerating the four commitments, we find the minimum total expected cost is $C_{SUC}^* = \\$3080$ for the commitment $(u_1, u_2) = (1,1)$.\n- **EV:** Expected demand $\\bar{D} = 0.6(40) + 0.4(120) = 72$ MW. The optimal EV commitment to serve $72$ MW is $(1,0)$, which has a deterministic cost of $\\$2940$.\n- **EEV:** The total expected cost for the EV commitment $(1,0)$ in the stochastic environment is $C_{EEV} = C_{total}(1,0) = \\$4380$.\n- **Result:** $C_{EEV} - C_{SUC}^* = 4380 - 3080 = \\$1300$.\n\n**Calculations for Case 2 ($D_1=40, p_1=0.95; D_2=120, p_2=0.05; M=200$):**\n- **SUC:** Minimum total expected cost is $C_{SUC}^* = \\$1812.50$ for the commitment $(u_1, u_2) = (0,1)$.\n- **EV:** Expected demand $\\bar{D} = 0.95(40) + 0.05(120) = 44$ MW. The optimal EV commitment to serve $44$ MW is $(0,1)$.\n- **EEV:** Since the EV commitment $(0,1)$ is the same as the SUC optimal commitment, $C_{EEV} = C_{SUC}^* = \\$1812.50$.\n- **Result:** $C_{EEV} - C_{SUC}^* = 1812.50 - 1812.50 = \\$0$.\n\n**Calculations for Case 3 ($D_1=40, p_1=0.6; D_2=120, p_2=0.4; M=30$):**\n- **SUC:** With the lower penalty, the minimum total expected cost is $C_{SUC}^* = \\$2040$ for the commitment $(u_1, u_2) = (0,1)$.\n- **EV:** Expected demand is $\\bar{D} = 72$ MW, same as Case 1. The EV problem is independent of $M$, so the optimal EV commitment remains $(1,0)$.\n- **EEV:** The total expected cost for the EV commitment $(1,0)$ with $M=30$ is $C_{EEV} = C_{total}(1,0) = \\$3020$.\n- **Result:** $C_{EEV} - C_{SUC}^* = 3020 - 2040 = \\$980$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the two-stage stochastic unit commitment problem for three test cases.\n    \"\"\"\n\n    # Unit data (common to all test cases)\n    # Units are pre-sorted by variable cost c_i\n    units = [\n        {'id': 1, 'P_max': 100.0, 'c': 20.0, 'C_su': 1000.0, 'C_nl': 500.0},\n        {'id': 2, 'P_max': 50.0, 'c': 25.0, 'C_su': 100.0, 'C_nl': 0.0}\n    ]\n\n    # Test cases\n    test_cases = [\n        {\n            \"scenarios\": [(40.0, 0.6), (120.0, 0.4)],  # (Demand, Probability)\n            \"penalty\": 200.0\n        },\n        {\n            \"scenarios\": [(40.0, 0.95), (120.0, 0.05)],\n            \"penalty\": 200.0\n        },\n        {\n            \"scenarios\": [(40.0, 0.6), (120.0, 0.4)],\n            \"penalty\": 30.0\n        }\n    ]\n\n    # Possible first-stage commitment decisions (u1, u2)\n    commitments = [(0, 0), (0, 1), (1, 0), (1, 1)]\n\n    results = []\n\n    def economic_dispatch(demand, commitment, units_data, penalty_cost):\n        \"\"\"\n        Calculates the minimum dispatch cost for a given demand and commitment.\n        \"\"\"\n        dispatch_cost = 0.0\n        remaining_demand = float(demand)\n\n        # Dispatch units in merit order (pre-sorted by cost)\n        for i, unit_spec in enumerate(units_data):\n            if commitment[i] == 1:\n                dispatch = min(remaining_demand, unit_spec['P_max'])\n                dispatch_cost += dispatch * unit_spec['c']\n                remaining_demand -= dispatch\n\n        # Add penalty for non-served energy (load shedding)\n        if remaining_demand > 1e-6: # Use a small tolerance for float comparison\n            dispatch_cost += remaining_demand * penalty_cost\n        \n        return dispatch_cost\n\n    for case in test_cases:\n        scenarios = case[\"scenarios\"]\n        penalty = case[\"penalty\"]\n\n        # --- 1. SUC (Stochastic Unit Commitment) Solution ---\n        # Calculate the total expected cost for every possible commitment\n        stochastic_costs = {}\n        for u in commitments:\n            # First-stage cost (startup + no-load)\n            first_stage_cost = sum(\n                (unit['C_su'] + unit['C_nl']) * u[i]\n                for i, unit in enumerate(units)\n            )\n\n            # Expected second-stage cost\n            scenario_costs = np.array([\n                economic_dispatch(demand, u, units, penalty)\n                for demand, prob in scenarios\n            ])\n            probabilities = np.array([prob for demand, prob in scenarios])\n            expected_second_stage_cost = np.dot(probabilities, scenario_costs)\n            \n            total_expected_cost = first_stage_cost + expected_second_stage_cost\n            stochastic_costs[u] = total_expected_cost\n        \n        # The optimal SUC cost is the minimum over all commitments\n        suc_optimal_cost = min(stochastic_costs.values())\n        \n        # --- 2. EV (Expected Value) Solution ---\n        # Calculate expected demand\n        expected_demand = sum(prob * demand for demand, prob in scenarios)\n\n        # Find the optimal commitment for the deterministic EV problem\n        ev_candidates = []\n        for u in commitments:\n            total_capacity = sum(\n                unit['P_max'] * u[i] for i, unit in enumerate(units)\n            )\n            # Commitment must be feasible (capacity >= expected demand)\n            if total_capacity >= expected_demand:\n                first_stage_cost = sum(\n                    (unit['C_su'] + unit['C_nl']) * u[i]\n                    for i, unit in enumerate(units)\n                )\n                # Dispatch cost for expected demand (no shedding allowed, penalty is effectively infinite)\n                dispatch_cost_ev = economic_dispatch(expected_demand, u, units, float('inf'))\n                \n                deterministic_cost = first_stage_cost + dispatch_cost_ev\n                ev_candidates.append((deterministic_cost, u))\n        \n        # The EV commitment is the one with the minimum deterministic cost\n        if not ev_candidates: # Should not happen in these test cases\n             # Handle case where no commitment is feasible for expected demand\n             # This would imply a flawed problem setup, but we'll be robust.\n             # E.g., select the highest capacity commitment\n             max_cap = -1\n             u_ev = (0,0)\n             for u in commitments:\n                 cap = sum(unit['P_max'] * u[i] for i, unit in enumerate(units))\n                 if cap > max_cap:\n                     max_cap = cap\n                     u_ev = u\n        else:\n             _, u_ev = min(ev_candidates, key=lambda x: x[0])\n\n        \n        # --- 3. EEV (Evaluated Expected Value) Cost ---\n        # The EEV is the stochastic cost of the commitment chosen by the EV problem\n        eev_cost = stochastic_costs[u_ev]\n        \n        # --- 4. Final Calculation ---\n        # Value of the Stochastic Solution (VSS) / Cost difference\n        result = eev_cost - suc_optimal_cost\n        results.append(result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, [round(r, 4) for r in results]))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established the value of stochastic modeling, we now construct a foundational SUC model. This practice focuses on the canonical two-stage structure, where \"here-and-now\" commitment decisions are made before uncertainty is revealed, and \"wait-and-see\" dispatch actions provide optimal recourse once a scenario unfolds. By implementing a solution for this problem, you will develop a core understanding of how first-stage choices constrain future flexibility and how to evaluate the expected cost of recourse actions .",
            "id": "4104492",
            "problem": "Consider a two-period Stochastic Unit Commitment (SUC) problem with two thermal generating units and two demand scenarios revealed at the start of the second period. Stochastic Unit Commitment (SUC) is modeled as a Mixed-Integer Linear Programming (MILP) problem in which binary commitment variables represent on/off status of generators and continuous dispatch variables represent power outputs. The fundamental base for the derivation consists of the power balance law (total generation equals demand in each period), linear generation cost functions (fuel costs proportional to energy produced), startup costs for transitioning from off to on, and the expected value principle for stochastic optimization. All time intervals are of length $1$ hour, so energy in megawatt-hours equals power in megawatts.\n\nSets and data:\n- Generators $\\mathcal{G}=\\{1,2\\}$.\n- Time periods $\\mathcal{T}=\\{1,2\\}$.\n- Scenarios $\\mathcal{S}=\\{A,B\\}$ with probabilities $\\pi_A$ and $\\pi_B$ satisfying $\\pi_A+\\pi_B=1$.\n- For each generator $g\\in\\mathcal{G}$: minimum output $\\underline{P}_g$ in $\\mathrm{MW}$, maximum output $\\overline{P}_g$ in $\\mathrm{MW}$, linear variable cost $c_g$ in $\\$/\\mathrm{MWh}$, and startup cost $h_g$ in $\\$$. The initial status is $y_{g,0}=0$ (off).\n- Demands $D_{1}$ in $\\mathrm{MW}$ for period $1$ (common across scenarios) and $D_{2,s}$ in $\\mathrm{MW}$ for period $2$ in scenario $s\\in\\mathcal{S}$.\n\nDecision variables:\n- First-stage (before scenarios are revealed): binary commitment $y_{g,1}\\in\\{0,1\\}$ and continuous dispatch $p_{g,1}\\ge 0$; startup binary $v_{g,1}\\in\\{0,1\\}$.\n- Second-stage (after scenarios are revealed): for each scenario $s\\in\\mathcal{S}$, binary commitment $y_{g,2,s}\\in\\{0,1\\}$ and continuous dispatch $p_{g,2,s}\\ge 0$; startup binary $v_{g,2,s}\\in\\{0,1\\}$.\n\nDeterministic-equivalent MILP derivation:\nThe expected total cost objective is\n$$\n\\min \\left\\{\\sum_{g\\in\\mathcal{G}} \\left(h_g v_{g,1} + c_g p_{g,1}\\right) + \\sum_{s\\in\\mathcal{S}} \\pi_s \\sum_{g\\in\\mathcal{G}} \\left(h_g v_{g,2,s} + c_g p_{g,2,s}\\right)\\right\\}.\n$$\nPhysical and logical constraints:\n- Power balance in period $1$:\n$$\n\\sum_{g\\in\\mathcal{G}} p_{g,1} = D_1.\n$$\n- Power balance in period $2$, scenario $s$:\n$$\n\\sum_{g\\in\\mathcal{G}} p_{g,2,s} = D_{2,s},\\quad \\forall s\\in\\mathcal{S}.\n$$\n- Capacity linking with commitment in period $1$:\n$$\n\\underline{P}_g\\, y_{g,1} \\le p_{g,1} \\le \\overline{P}_g\\, y_{g,1},\\quad \\forall g\\in\\mathcal{G}.\n$$\n- Capacity linking with commitment in period $2$:\n$$\n\\underline{P}_g\\, y_{g,2,s} \\le p_{g,2,s} \\le \\overline{P}_g\\, y_{g,2,s},\\quad \\forall g\\in\\mathcal{G},\\ \\forall s\\in\\mathcal{S}.\n$$\n- Startup logic in period $1$:\n$$\nv_{g,1} \\ge y_{g,1} - y_{g,0},\\quad v_{g,1}\\in\\{0,1\\},\\quad y_{g,1}\\in\\{0,1\\},\\quad \\forall g\\in\\mathcal{G}.\n$$\n- Startup logic in period $2$:\n$$\nv_{g,2,s} \\ge y_{g,2,s} - y_{g,1},\\quad v_{g,2,s}\\in\\{0,1\\},\\quad y_{g,2,s}\\in\\{0,1\\},\\quad \\forall g\\in\\mathcal{G},\\ \\forall s\\in\\mathcal{S}.\n$$\n- Nonanticipativity constraints on first-stage variables:\nBecause period $1$ precedes scenario revelation, the first-stage variables must be identical across scenarios. In deterministic equivalent form, this is enforced by either modeling $y_{g,1}$ and $p_{g,1}$ without scenario index or with explicit equalities if scenario-indexed:\n$$\ny_{g,1,A} = y_{g,1,B},\\quad p_{g,1,A} = p_{g,1,B},\\quad \\forall g\\in\\mathcal{G},\n$$\nwhich we implement by using the scenario-independent $y_{g,1}$ and $p_{g,1}$ above.\n\nYou must compute the optimal expected total cost in $\\$$ and the optimal first-stage commitments $y_{1,1}$ and $y_{2,1}$ for each of the following test cases. Express the final costs in $\\$$ rounded to two decimal places. The commitment decisions must be reported as integers $0$ or $1$. Use the generator data:\n- Unit $1$: $\\underline{P}_1=10$ $\\mathrm{MW}$, $\\overline{P}_1=50$ $\\mathrm{MW}$, $c_1=20$ $\\$/\\mathrm{MWh}$, $h_1=100$ $\\$$.\n- Unit $2$: $\\underline{P}_2=5$ $\\mathrm{MW}$, $\\overline{P}_2=30$ $\\mathrm{MW}$, $c_2=30$ $\\$/\\mathrm{MWh}$, $h_2=50$ $\\$$.\n- Initial statuses: $y_{1,0}=0$, $y_{2,0}=0$.\n\nTest suite:\n- Case $1$ (general): $D_1=40$ $\\mathrm{MW}$, $D_{2,A}=60$ $\\mathrm{MW}$, $D_{2,B}=35$ $\\mathrm{MW}$, $\\pi_A=0.4$, $\\pi_B=0.6$.\n- Case $2$ (boundary feasibility near minimum outputs): $D_1=15$ $\\mathrm{MW}$, $D_{2,A}=15$ $\\mathrm{MW}$, $D_{2,B}=15$ $\\mathrm{MW}$, $\\pi_A=0.5$, $\\pi_B=0.5$.\n- Case $3$ (edge with high demand followed by low demand): $D_1=55$ $\\mathrm{MW}$, $D_{2,A}=80$ $\\mathrm{MW}$, $D_{2,B}=10$ $\\mathrm{MW}$, $\\pi_A=0.8$, $\\pi_B=0.2$.\n\nOutput specification:\nYour program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets. Each inner list must be of the form $[E^\\star, y_{1,1}^\\star, y_{2,1}^\\star]$, where $E^\\star$ is the optimal expected total cost in $\\$$ rounded to two decimal places, and $y_{1,1}^\\star$, $y_{2,1}^\\star$ are the optimal first-stage commitments for units $1$ and $2$. For example, an output might look like $[[1234.56,1,0],[\\dots]]$.",
            "solution": "The user has provided a well-defined two-period Stochastic Unit Commitment (SUC) problem, modeled as a Mixed-Integer Linear Program (MILP). The problem is scientifically grounded, self-contained, and all necessary data for its solution are provided. It is a canonical problem in power systems optimization. Therefore, the problem is deemed valid.\n\nThe objective is to find the minimum expected total cost and the corresponding optimal first-stage commitment decisions $(y_{1,1}^\\star, y_{2,1}^\\star)$. The total cost comprises first-stage startup and generation costs, plus the expected value of second-stage startup and generation costs over two scenarios, $A$ and $B$.\n\nGiven the small scale of the problemtwo generating units and binary commitment decisions in the first stagethe most direct and transparent method of solution is a structured enumeration of all possible first-stage commitment strategies. There are $2^2=4$ such strategies for $(y_{1,1}, y_{2,1})$: $(0,0)$, $(0,1)$, $(1,0)$, and $(1,1)$. For each of these strategies, we can calculate the total expected cost. The optimal strategy is the one that yields the minimum total expected cost.\n\nThe process for evaluating a single first-stage commitment strategy $(y_{1,1}, y_{2,1})$ is as follows:\n\n**1. First-Stage Analysis**\nFirst, we evaluate the cost and feasibility for the first time period, $t=1$.\n- **Feasibility Check:** The chosen commitment must be capable of satisfying the demand $D_1$. That is, the sum of minimum power outputs of committed units must not exceed the demand, and the sum of maximum power outputs must be at least the demand:\n$$\n\\sum_{g \\in \\mathcal{G}} \\underline{P}_g y_{g,1} \\le D_1 \\le \\sum_{g \\in \\mathcal{G}} \\overline{P}_g y_{g,1}\n$$\nIf this condition is not met, the commitment strategy is infeasible, and its cost is considered infinite.\n- **Economic Dispatch:** If feasible, the power outputs $p_{g,1}$ are determined by economic dispatch to meet $D_1$ at minimum generation cost. Since the variable costs $c_g$ are linear, this involves loading the unit with the lower $c_g$ (Unit 1, with $c_1=20$ $\\$/\\mathrm{MWh}$) before the unit with the higher $c_g$ (Unit 2, with $c_2=30$ $\\$/\\mathrm{MWh}$), while respecting the minimum and maximum output limits, $\\underline{P}_g$ and $\\overline{P}_g$.\n- **First-Stage Cost ($C_1$):** The cost for period $1$ is the sum of startup costs and generation costs. Since both units start from an off-state ($y_{g,0}=0$), the startup variable $v_{g,1}$ is equal to $y_{g,1}$. The cost is:\n$$\nC_1(y_{1,1}, y_{2,1}) = \\sum_{g \\in \\mathcal{G}} (h_g y_{g,1} + c_g p_{g,1})\n$$\n\n**2. Second-Stage Analysis (Recourse)**\nNext, for the given first-stage commitment $(y_{1,1}, y_{2,1})$, we must determine the optimal decisions for the second stage for each scenario $s \\in \\{A, B\\}$ and calculate the expected cost. The decisions in the second stage are \"recourse\" actions taken after the uncertainty (the demand $D_{2,s}$) is revealed.\n\nFor each scenario $s \\in \\{A, B\\}$:\n- **Optimal Second-Stage Commitment:** We must find the least-cost commitment decision $(y_{1,2,s}, y_{2,2,s})$ to meet the scenario-specific demand $D_{2,s}$. This involves evaluating all $4$ possible second-stage commitments. For each choice:\n    - We check feasibility against $D_{2,s}$.\n    - If feasible, we calculate the startup cost. The startup variable $v_{g,2,s}$ is determined by the transition from the first-stage state $y_{g,1}$: $v_{g,2,s} = \\max(0, y_{g,2,s} - y_{g,1})$. The startup cost for the scenario is $\\sum_{g \\in \\mathcal{G}} h_g v_{g,2,s}$.\n    - We perform an economic dispatch to find the generation levels $p_{g,2,s}$ and the associated minimum generation cost $\\sum_{g \\in \\mathcal{G}} c_g p_{g,2,s}$.\n    - The total second-stage cost for that commitment choice is the sum of its startup and generation costs.\n- **Minimum Scenario Cost ($C_{2,s}^\\star$):** By comparing the total costs of the feasible second-stage commitment options, we find the minimum possible cost for scenario $s$, denoted $C^\\star_{2,s}$.\n- **Expected Second-Stage Cost ($E[C_2]$):** The expected cost for the second stage is the probability-weighted average of the minimum costs for each scenario:\n$$\nE[C_2] = \\pi_A C^\\star_{2,A} + \\pi_B C^\\star_{2,B}\n$$\n\n**3. Total Expected Cost and Optimization**\nThe total expected cost for the initial first-stage strategy $(y_{1,1}, y_{2,1})$ is the sum of the first-stage cost and the expected second-stage cost:\n$$\nE[C_{\\text{total}}] = C_1 + E[C_2]\n$$\nThis calculation is repeated for all four initial first-stage commitment strategies. The optimal strategy $(y_{1,1}^\\star, y_{2,1}^\\star)$ is the one that yields the minimum $E[C_{\\text{total}}]$, and this minimum value is the optimal expected total cost, $E^\\star$.\n\nThe generator data used are:\n- Unit 1: $\\underline{P}_1=10$ $\\mathrm{MW}$, $\\overline{P}_1=50$ $\\mathrm{MW}$, $c_1=20$ $\\$/\\mathrm{MWh}$, $h_1=100$ $\\$$.\n- Unit 2: $\\underline{P}_2=5$ $\\mathrm{MW}$, $\\overline{P}_2=30$ $\\mathrm{MW}$, $c_2=30$ $\\$/\\mathrm{MWh}$, $h_2=50$ $\\$$.\n- Initial statuses: $y_{1,0}=0$, $y_{2,0}=0$.\n\nBy applying this systematic enumeration and cost calculation to each of the three test cases, we arrive at the optimal first-stage decisions and the corresponding minimum expected costs.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the two-period stochastic unit commitment problem for the given test cases.\n    \"\"\"\n    \n    # Generator data\n    generators = [\n        {'id': 1, 'P_min': 10, 'P_max': 50, 'cost': 20, 'startup': 100, 'y0': 0},\n        {'id': 2, 'P_min': 5, 'P_max': 30, 'cost': 30, 'startup': 50, 'y0': 0}\n    ]\n    # Sort generators by cost for economic dispatch, cheaper first.\n    # We create a mapping to their original indices.\n    sorted_gen_indices = sorted(range(len(generators)), key=lambda k: generators[k]['cost'])\n\n    # Test suite\n    test_cases = [\n        {'D1': 40, 'D2A': 60, 'D2B': 35, 'pi_A': 0.4, 'pi_B': 0.6},\n        {'D1': 15, 'D2A': 15, 'D2B': 15, 'pi_A': 0.5, 'pi_B': 0.5},\n        {'D1': 55, 'D2A': 80, 'D2B': 10, 'pi_A': 0.8, 'pi_B': 0.2}\n    ]\n\n    def economic_dispatch(demand, commitment_status):\n        \"\"\"\n        Calculates the minimum generation cost and dispatch levels for a given demand and set of\n        committed units.\n        \n        Args:\n            demand (float): The load to be met.\n            commitment_status (tuple): A tuple of binary values (0 or 1) indicating which\n                                       generators are committed.\n\n        Returns:\n            tuple: (generation_cost, dispatch_levels) or (inf, None) if infeasible.\n        \"\"\"\n        p_min_total = sum(gen['P_min'] for i, gen in enumerate(generators) if commitment_status[i])\n        p_max_total = sum(gen['P_max'] for i, gen in enumerate(generators) if commitment_status[i])\n\n        if not (p_min_total = demand = p_max_total):\n            return float('inf'), None\n\n        dispatch = np.zeros(len(generators))\n        gen_cost = 0.0\n        \n        # Load all committed units to their minimum output\n        for i, gen in enumerate(generators):\n            if commitment_status[i]:\n                dispatch[i] = gen['P_min']\n                gen_cost += gen['cost'] * gen['P_min']\n\n        remaining_demand = demand - p_min_total\n\n        # Load incrementally based on cost\n        for i in sorted_gen_indices:\n            if commitment_status[i]:\n                gen = generators[i]\n                capacity_above_min = gen['P_max'] - gen['P_min']\n                load_increase = min(remaining_demand, capacity_above_min)\n                \n                dispatch[i] += load_increase\n                gen_cost += gen['cost'] * load_increase\n                remaining_demand -= load_increase\n        \n        return gen_cost, dispatch\n\n    results = []\n    \n    for case in test_cases:\n        min_total_exp_cost = float('inf')\n        optimal_y1 = None\n\n        # Enumerate all 4 possible first-stage commitments (y1_1, y2_1)\n        for y11 in [0, 1]:\n            for y21 in [0, 1]:\n                y1 = (y11, y21)\n                \n                # --- STAGE 1 ANALYSIS ---\n                # Calculate first-stage cost\n                stage1_gen_cost, _ = economic_dispatch(case['D1'], y1)\n                \n                if stage1_gen_cost == float('inf'):\n                    continue\n\n                stage1_startup_cost = sum(gen['startup'] * y1[i] for i, gen in enumerate(generators))\n                total_stage1_cost = stage1_startup_cost + stage1_gen_cost\n                \n                # --- STAGE 2 ANALYSIS ---\n                # Calculate expected second-stage cost\n                exp_stage2_cost = 0.0\n                scenarios = [('A', case['D2A'], case['pi_A']), ('B', case['D2B'], case['pi_B'])]\n                \n                for _, d2_s, pi_s in scenarios:\n                    min_cost_s = float('inf')\n                    \n                    # Find optimal recourse action for scenario s by enumerating y2_s\n                    for y12s in [0, 1]:\n                        for y22s in [0, 1]:\n                            y2_s = (y12s, y22s)\n                            \n                            gen_cost_s, _ = economic_dispatch(d2_s, y2_s)\n                            if gen_cost_s == float('inf'):\n                                continue\n                                \n                            startup_cost_s = sum(gen['startup'] * max(0, y2_s[i] - y1[i]) for i, gen in enumerate(generators))\n                            total_cost_s = startup_cost_s + gen_cost_s\n                            \n                            if total_cost_s  min_cost_s:\n                                min_cost_s = total_cost_s\n                    \n                    if min_cost_s == float('inf'):\n                        # If a scenario is infeasible for a given y1, that y1 is invalid.\n                        exp_stage2_cost = float('inf')\n                        break\n                    \n                    exp_stage2_cost += pi_s * min_cost_s\n\n                if exp_stage2_cost == float('inf'):\n                    continue\n                \n                # --- TOTAL COST  OPTIMIZATION ---\n                total_exp_cost = total_stage1_cost + exp_stage2_cost\n                \n                if total_exp_cost  min_total_exp_cost:\n                    min_total_exp_cost = total_exp_cost\n                    optimal_y1 = y1\n        \n        # Format and append result\n        results.append([float(f\"{min_total_exp_cost:.2f}\"), optimal_y1[0], optimal_y1[1]])\n\n    # Print results in the specified format\n    print(f\"{results}\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world power systems are governed by complex physical limitations. This final practice enhances our model by incorporating crucial inter-temporal constraints, specifically the ramping limits of thermal generators. Solving this problem will give you hands-on experience in managing how decisions in one period dynamically affect the feasible options in the next, revealing the intricate trade-offs between commitment costs and the operational flexibility needed to navigate uncertainty across time .",
            "id": "4125912",
            "problem": "Consider a stochastic unit commitment (SUC) planning and operations problem for a thermal generation portfolio over a discrete time horizon with $T = 3$ periods and $G = 2$ generators. There are $S = 3$ demand scenarios indexed by $s \\in \\{1,2,3\\}$, each with probability $p_s$ and time-varying net load $D_{t,s}$ for each period $t \\in \\{1,2,3\\}$. The decision variables are the binary on/off commitment $x_{g,t} \\in \\{0,1\\}$, identical across scenarios (non-anticipativity), and the scenario-dependent dispatch $p_{g,t,s} \\ge 0$. The objective is to minimize expected total cost subject to generator capacity and ramping constraints and nodal balance. All generators start offline with zero output at period $t=0$.\n\nStart from the following fundamental base:\n- The expected value operator over scenarios with probabilities $p_s$.\n- Linear dispatch cost per unit of energy and linear fixed costs per period of commitment.\n- Real-power balance between generation and demand in each scenario period.\n- Physical ramping constraints on real-power outputs between consecutive periods.\n- Binary commitment non-anticipativity across scenarios.\n\nLet $c_g$ denote the variable energy cost for generator $g$ in dollars per megawatt-hour ($\\$\\!/\\,\\mathrm{MWh}$), $f_g$ the no-load cost in dollars per period, $SU_g$ the startup cost in dollars per startup, $\\overline{P}_g$ the maximum power in megawatts ($\\mathrm{MW}$), $R^{\\uparrow}_g$ the ramp-up limit in megawatts per period ($\\mathrm{MW}/\\mathrm{period}$), and $R^{\\downarrow}_g$ the ramp-down limit in megawatts per period ($\\mathrm{MW}/\\mathrm{period}$). Assume minimum power is zero ($P^{\\min}_g = 0$). The binary startup indicator $y_{g,t}$ is implied by $x_{g,t}$ as $y_{g,t} = \\max\\{0, x_{g,t} - x_{g,t-1}\\}$ with $x_{g,0} = 0$.\n\nThe SUC formulation is:\nMinimize\n$$\n\\sum_{g=1}^{G} \\left( SU_g \\sum_{t=1}^{T} y_{g,t} + f_g \\sum_{t=1}^{T} x_{g,t} \\right) + \\sum_{s=1}^{S} p_s \\sum_{t=1}^{T} \\sum_{g=1}^{G} c_g \\, p_{g,t,s}\n$$\nsubject to, for all $t \\in \\{1,2,3\\}$ and $s \\in \\{1,2,3\\}$:\n$$\n\\sum_{g=1}^{G} p_{g,t,s} = D_{t,s},\n$$\n$$\n0 \\le p_{g,t,s} \\le \\overline{P}_g \\, x_{g,t},\n$$\n$$\n- R^{\\downarrow}_g \\le p_{g,t,s} - p_{g,t-1,s} \\le R^{\\uparrow}_g, \\quad \\text{with } p_{g,0,s} = 0,\n$$\nand for all $t$, $x_{g,t} \\in \\{0,1\\}$ identical across scenarios.\n\nYou must compute the optimal commitment schedule that minimizes the expected cost under the above model. Your algorithmic design should be derived from the base principles and produce a correct optimal schedule for small instances by exhaustive enumeration of feasible commitment schedules and cost-minimal dispatch per scenario-period. For each candidate commitment schedule, perform economic dispatch that minimizes the per-period linear cost subject to the ramp and capacity constraints and the sum-to-demand equality. If a schedule is infeasible for any scenario-period, discard it.\n\nUse the following test suite of three instances. All costs must be computed in dollars ($\\$$), power in megawatts ($\\mathrm{MW}$), energy in megawatt-hours ($\\mathrm{MWh}$), and ramp in megawatts per period ($\\mathrm{MW}/\\mathrm{period}$). The final output is unitless binary integers indicating commitment. The three instances are:\n\n- Instance $1$:\n  - Generator $1$: $\\overline{P}_1 = 100\\,\\mathrm{MW}$, $R^{\\uparrow}_1 = 50\\,\\mathrm{MW}/\\mathrm{period}$, $R^{\\downarrow}_1 = 100\\,\\mathrm{MW}/\\mathrm{period}$, $c_1 = 20\\,\\$\\!/\\,\\mathrm{MWh}$, $f_1 = 500\\,\\$/\\mathrm{period}$, $SU_1 = 2000\\,\\$.$\n  - Generator $2$: $\\overline{P}_2 = 80\\,\\mathrm{MW}$, $R^{\\uparrow}_2 = 80\\,\\mathrm{MW}/\\mathrm{period}$, $R^{\\downarrow}_2 = 80\\,\\mathrm{MW}/\\mathrm{period}$, $c_2 = 30\\,\\$\\!/\\,\\mathrm{MWh}$, $f_2 = 300\\,\\$/\\mathrm{period}$, $SU_2 = 1500\\,\\$.$\n  - Scenario probabilities: $(p_1,p_2,p_3) = (0.3, 0.4, 0.3)$.\n  - Demands: $D_{\\cdot,1} = [60, 100, 80]\\,\\mathrm{MW}$, $D_{\\cdot,2} = [50, 70, 110]\\,\\mathrm{MW}$, $D_{\\cdot,3} = [40, 90, 60]\\,\\mathrm{MW}.$\n\n- Instance $2$:\n  - Generator $1$: $\\overline{P}_1 = 120\\,\\mathrm{MW}$, $R^{\\uparrow}_1 = 30\\,\\mathrm{MW}/\\mathrm{period}$, $R^{\\downarrow}_1 = 120\\,\\mathrm{MW}/\\mathrm{period}$, $c_1 = 18\\,\\$\\!/\\,\\mathrm{MWh}$, $f_1 = 700\\,\\$/\\mathrm{period}$, $SU_1 = 2500\\,\\$.$\n  - Generator $2$: $\\overline{P}_2 = 100\\,\\mathrm{MW}$, $R^{\\uparrow}_2 = 100\\,\\mathrm{MW}/\\mathrm{period}$, $R^{\\downarrow}_2 = 100\\,\\mathrm{MW}/\\mathrm{period}$, $c_2 = 26\\,\\$\\!/\\,\\mathrm{MWh}$, $f_2 = 200\\,\\$/\\mathrm{period}$, $SU_2 = 1000\\,\\$.$\n  - Scenario probabilities: $(p_1,p_2,p_3) = (0.2, 0.5, 0.3)$.\n  - Demands: $D_{\\cdot,1} = [40, 120, 80]\\,\\mathrm{MW}$, $D_{\\cdot,2} = [60, 140, 70]\\,\\mathrm{MW}$, $D_{\\cdot,3} = [50, 100, 90]\\,\\mathrm{MW}.$\n\n- Instance $3$:\n  - Generator $1$: $\\overline{P}_1 = 90\\,\\mathrm{MW}$, $R^{\\uparrow}_1 = 45\\,\\mathrm{MW}/\\mathrm{period}$, $R^{\\downarrow}_1 = 90\\,\\mathrm{MW}/\\mathrm{period}$, $c_1 = 22\\,\\$\\!/\\,\\mathrm{MWh}$, $f_1 = 400\\,\\$/\\mathrm{period}$, $SU_1 = 1000\\,\\$.$\n  - Generator $2$: $\\overline{P}_2 = 150\\,\\mathrm{MW}$, $R^{\\uparrow}_2 = 150\\,\\mathrm{MW}/\\mathrm{period}$, $R^{\\downarrow}_2 = 150\\,\\mathrm{MW}/\\mathrm{period}$, $c_2 = 24\\,\\$\\!/\\,\\mathrm{MWh}$, $f_2 = 50\\,\\$/\\mathrm{period}$, $SU_2 = 6000\\,\\$.$\n  - Scenario probabilities: $(p_1,p_2,p_3) = (0.3, 0.4, 0.3)$.\n  - Demands: $D_{\\cdot,1} = [30, 80, 30]\\,\\mathrm{MW}$, $D_{\\cdot,2} = [20, 60, 20]\\,\\mathrm{MW}$, $D_{\\cdot,3} = [25, 75, 25]\\,\\mathrm{MW}.$\n\nYou must implement the expected-cost minimization by:\n- Enumerating all possible commitment schedules $x_{g,t}$ for $g \\in \\{1,2\\}$ and $t \\in \\{1,2,3\\}$.\n- For a fixed schedule, performing per-scenario economic dispatch that minimizes $\\sum_{g} c_g \\, p_{g,t,s}$ for each period $t$ subject to $p_{g,t,s} \\in [L_{g,t,s}, U_{g,t,s}]$ and $\\sum_{g} p_{g,t,s} = D_{t,s}$ where\n  $L_{g,t,s} = 0$ if $x_{g,t} = 0$, else $L_{g,t,s} = \\max\\{0, p_{g,t-1,s} - R^{\\downarrow}_g\\}$,\n  and\n  $U_{g,t,s} = 0$ if $x_{g,t} = 0$, else $U_{g,t,s} = \\min\\{\\overline{P}_g, p_{g,t-1,s} + R^{\\uparrow}_g\\}$,\n  with $p_{g,0,s} = 0$.\n- If a period fails feasibility, the schedule is infeasible.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must be a flattened list of six binary integers representing the optimal commitment schedule in the order $[x_{1,1}, x_{1,2}, x_{1,3}, x_{2,1}, x_{2,2}, x_{2,3}]$. Hence the final output should look like $[[\\dots],[\\dots],[\\dots]]$ where each inner list consists of integers ($0$ or $1$) only.",
            "solution": "The problem presented is a valid, well-posed stochastic unit commitment (SUC) problem for a small power system. It is grounded in the established principles of operations research and power systems engineering. The objective is to determine the optimal commitment schedule for two thermal generators over a three-period time horizon, considering three different demand scenarios. The solution must minimize the total expected cost, which comprises fixed commitment costs, startup costs, and variable dispatch costs.\n\nThe problem formulation can be stated as a mixed-integer linear program (MILP). The decision variables are the first-stage (non-anticipative) binary commitment variables $x_{g,t} \\in \\{0,1\\}$ for each generator $g \\in \\{1,2\\}$ and time period $t \\in \\{1,2,3\\}$, and the second-stage (scenario-dependent) continuous dispatch variables $p_{g,t,s} \\ge 0$. The objective is to minimize the sum of the deterministic commitment and startup costs and the expected value of the dispatch costs over all scenarios.\n\nThe objective function to minimize is:\n$$\nC_{total} = C_{commit} + \\mathbb{E}[C_{dispatch}] = \\sum_{g=1}^{G} \\left( SU_g \\sum_{t=1}^{T} y_{g,t} + f_g \\sum_{t=1}^{T} x_{g,t} \\right) + \\sum_{s=1}^{S} \\pi_s \\left( \\sum_{t=1}^{T} \\sum_{g=1}^{G} c_g \\, p_{g,t,s} \\right)\n$$\nwhere $y_{g,t} = \\max\\{0, x_{g,t} - x_{g,t-1}\\}$ is the startup indicator, with the initial state $x_{g,0}=0$. The constraints enforce power balance, generator capacity limits, and ramping limits for each scenario $s$ and time period $t$:\n1.  Power Balance: $\\sum_{g=1}^{G} p_{g,t,s} = D_{t,s}$\n2.  Generation Capacity: $0 \\le p_{g,t,s} \\le \\overline{P}_g x_{g,t}$\n3.  Ramping Limits: $p_{g,t-1,s} - R^{\\downarrow}_g \\le p_{g,t,s} \\le p_{g,t-1,s} + R^{\\uparrow}_g$, with the initial dispatch $p_{g,0,s}=0$.\n\nThe problem specifies an exhaustive enumeration approach to find the optimal commitment schedule. With $G=2$ generators and $T=3$ time periods, there are $G \\times T = 6$ binary commitment variables ($x_{1,1}, x_{1,2}, x_{1,3}, x_{2,1}, x_{2,2}, x_{2,3}$). This results in a total of $2^{G \\times T} = 2^6 = 64$ possible commitment schedules for the entire system. The algorithm iterates through each of these candidate schedules, evaluates its total expected cost, and identifies the schedule with the minimum cost.\n\nFor each candidate commitment schedule, a two-part cost evaluation is performed:\n\nFirst, the deterministic commitment cost ($C_{commit}$) is calculated. This cost is independent of the scenarios and depends only on the commitment schedule $x = \\{x_{g,t}\\}$. For each generator $g$, the number of startups and the total number of periods it is committed are counted. The cost is computed as:\n$$\nC_{commit}(x) = \\sum_{g=1}^{G} \\left( SU_g \\sum_{t=1}^{T} \\max\\{0, x_{g,t} - x_{g,t-1}\\} + f_g \\sum_{t=1}^{T} x_{g,t} \\right)\n$$\n\nSecond, the expected dispatch cost ($\\mathbb{E}[C_{dispatch}]$) is calculated. This requires evaluating the feasibility and cost of dispatch for each scenario. For a given commitment schedule $x$, we proceed scenario by scenario. For each scenario $s$, we simulate the dispatch over the time horizon $t=1,2,3$:\nAt each period $t$, we must solve an economic dispatch subproblem to find the generator outputs $p_{g,t,s}$ that meet the demand $D_{t,s}$ at minimum cost. The available dispatch range for each generator is constrained by its commitment status, maximum capacity $\\overline{P}_g$, and its ramp-rate limits relative to its output in the previous period, $p_{g,t-1,s}$. The effective feasible dispatch range $[L_{g,t,s}, U_{g,t,s}]$ for generator $g$ is:\n-   If generator $g$ is offline ($x_{g,t}=0$): $L_{g,t,s} = U_{g,t,s} = 0$.\n-   If generator $g$ is online ($x_{g,t}=1$):\n    $$\n    L_{g,t,s} = \\max\\{0, p_{g,t-1,s} - R^{\\downarrow}_g\\}\n    $$\n    $$\n    U_{g,t,s} = \\min\\{\\overline{P}_g, p_{g,t-1,s} + R^{\\uparrow}_g\\}\n    $$\nThe initial condition is $p_{g,0,s}=0$ for all $g,s$.\n\nA feasible dispatch for period $t$ in scenario $s$ exists only if the total demand $D_{t,s}$ is within the aggregated system capacity, i.e., $\\sum_{g=1}^{G} L_{g,t,s} \\le D_{t,s} \\le \\sum_{g=1}^{G} U_{g,t,s}$. If this condition is violated for any period $t$ in any scenario $s$, the entire commitment schedule is deemed infeasible and is discarded from consideration.\n\nIf the period is feasible, the optimal dispatch is found by loading the generators in increasing order of their variable costs $c_g$ (merit-order dispatch). For a two-generator system, with costs $c_1$ and $c_2$, assume without loss of generality that $c_1 \\le c_2$. To minimize the dispatch cost $c_1 p_{1,t,s} + c_2 p_{2,t,s}$ subject to $p_{1,t,s} + p_{2,t,s} = D_{t,s}$ and the bounds $[L_{g,t,s}, U_{g,t,s}]$, we should maximize the output of the cheaper generator, $p_{1,t,s}$. The feasible range for $p_{1,t,s}$ is derived from its own bounds and the bounds on $p_{2,t,s}$:\n$$\np_{1,t,s} \\in [\\max(L_{1,t,s}, D_{t,s} - U_{2,t,s}), \\min(U_{1,t,s}, D_{t,s} - L_{2,t,s})]\n$$\nTo maximize $p_{1,t,s}$, we set it to the upper limit of this range:\n$$\np_{1,t,s}^* = \\min(U_{1,t,s}, D_{t,s} - L_{2,t,s})\n$$\nThe dispatch for the more expensive generator is then determined by the power balance equation:\n$$\np_{2,t,s}^* = D_{t,s} - p_{1,t,s}^*\n$$\nIf $c_2  c_1$, we would instead minimize $p_{1,t,s}$ by setting it to the lower limit of its feasible range, $p_{1,t,s}^* = \\max(L_{1,t,s}, D_{t,s} - U_{2,t,s})$.\n\nThe dispatch cost for this period is $C_{t,s} = \\sum_{g} c_g p_{g,t,s}^*$. The total dispatch cost for scenario $s$ is $C_{dispatch,s} = \\sum_{t=1}^{T} C_{t,s}$. The expected dispatch cost is then computed by weighting each scenario's cost by its probability: $\\mathbb{E}[C_{dispatch}] = \\sum_{s=1}^{S} \\pi_s C_{dispatch,s}$.\n\nThe total expected cost for the candidate schedule is $C_{total}(x) = C_{commit}(x) + \\mathbb{E}[C_{dispatch}]$. This process is repeated for all $64$ schedules. The schedule that yields the minimum finite total cost is the optimal solution.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the stochastic unit commitment problem for three given instances\n    using exhaustive enumeration of commitment schedules.\n    \"\"\"\n\n    test_cases = [\n        # Instance 1\n        {\n            \"G1\": {\"P_max\": 100, \"R_up\": 50, \"R_down\": 100, \"c\": 20, \"f\": 500, \"SU\": 2000},\n            \"G2\": {\"P_max\": 80, \"R_up\": 80, \"R_down\": 80, \"c\": 30, \"f\": 300, \"SU\": 1500},\n            \"probs\": [0.3, 0.4, 0.3],\n            \"demands\": [\n                [60, 100, 80],\n                [50, 70, 110],\n                [40, 90, 60],\n            ],\n        },\n        # Instance 2\n        {\n            \"G1\": {\"P_max\": 120, \"R_up\": 30, \"R_down\": 120, \"c\": 18, \"f\": 700, \"SU\": 2500},\n            \"G2\": {\"P_max\": 100, \"R_up\": 100, \"R_down\": 100, \"c\": 26, \"f\": 200, \"SU\": 1000},\n            \"probs\": [0.2, 0.5, 0.3],\n            \"demands\": [\n                [40, 120, 80],\n                [60, 140, 70],\n                [50, 100, 90],\n            ],\n        },\n        # Instance 3\n        {\n            \"G1\": {\"P_max\": 90, \"R_up\": 45, \"R_down\": 90, \"c\": 22, \"f\": 400, \"SU\": 1000},\n            \"G2\": {\"P_max\": 150, \"R_up\": 150, \"R_down\": 150, \"c\": 24, \"f\": 50, \"SU\": 6000},\n            \"probs\": [0.3, 0.4, 0.3],\n            \"demands\": [\n                [30, 80, 30],\n                [20, 60, 20],\n                [25, 75, 25],\n            ],\n        },\n    ]\n\n    results = []\n    T = 3\n    G = 2\n\n    for case in test_cases:\n        min_total_cost = float('inf')\n        best_schedule = None\n\n        # Enumerate all 2^(G*T) = 64 possible commitment schedules\n        for i in range(2**(G * T)):\n            # Generate the schedule from the integer i\n            # Format: [x11, x12, x13, x21, x22, x23]\n            schedule_flat = [int(bit) for bit in format(i, f'0{G*T}b')]\n            x = np.array(schedule_flat).reshape((G, T))\n            \n            # --- 1. Calculate deterministic commitment cost ---\n            commit_cost = 0.0\n            gens = [case[\"G1\"], case[\"G2\"]]\n            for g in range(G):\n                x_g_t = x[g, :]\n                x_g_t_prev = np.insert(x_g_t[:-1], 0, 0) # x_{g,t-1} with x_{g,0}=0\n                startups = np.maximum(0, x_g_t - x_g_t_prev)\n                \n                commit_cost += gens[g][\"SU\"] * np.sum(startups)\n                commit_cost += gens[g][\"f\"] * np.sum(x_g_t)\n\n            # --- 2. Calculate expected dispatch cost ---\n            expected_dispatch_cost = 0.0\n            schedule_is_feasible = True\n\n            for s, prob in enumerate(case[\"probs\"]):\n                scenario_dispatch_cost = 0.0\n                is_feasible_scenario = True\n                p_prev = np.zeros(G) # p_{g,t-1,s}, initialized for t=1\n\n                for t in range(T):\n                    demand = case[\"demands\"][s][t]\n                    \n                    # Calculate generator bounds [L_g, U_g] for this period\n                    L_g = np.zeros(G)\n                    U_g = np.zeros(G)\n                    for g in range(G):\n                        if x[g, t] == 1:\n                            L_g[g] = max(0, p_prev[g] - gens[g][\"R_down\"])\n                            U_g[g] = min(gens[g][\"P_max\"], p_prev[g] + gens[g][\"R_up\"])\n                        # If x[g,t] == 0, bounds are already 0.\n\n                    # Check feasibility for the period\n                    if not (np.sum(L_g) = demand = np.sum(U_g)):\n                        is_feasible_scenario = False\n                        break\n                    \n                    # Economic dispatch\n                    # Sort generators by cost\n                    gen_indices = sorted(range(G), key=lambda g_idx: gens[g_idx][\"c\"])\n                    g_cheap, g_exp = gen_indices[0], gen_indices[1]\n                    \n                    # Effective bounds for the cheaper generator's dispatch\n                    p_cheap_min = max(L_g[g_cheap], demand - U_g[g_exp])\n                    p_cheap_max = min(U_g[g_cheap], demand - L_g[g_exp])\n\n                    # Dispatch cheaper generator to its max feasible limit to minimize cost\n                    p_dispatch = np.zeros(G)\n                    p_dispatch[g_cheap] = p_cheap_max\n                    p_dispatch[g_exp] = demand - p_dispatch[g_cheap]\n                    \n                    # Calculate period dispatch cost and update for next period\n                    period_cost = p_dispatch[0] * gens[0][\"c\"] + p_dispatch[1] * gens[1][\"c\"]\n                    scenario_dispatch_cost += period_cost\n                    p_prev = p_dispatch\n                \n                if not is_feasible_scenario:\n                    schedule_is_feasible = False\n                    break\n                else:\n                    expected_dispatch_cost += prob * scenario_dispatch_cost\n            \n            if schedule_is_feasible:\n                total_cost = commit_cost + expected_dispatch_cost\n                if total_cost  min_total_cost:\n                    min_total_cost = total_cost\n                    best_schedule = schedule_flat\n\n        results.append(best_schedule)\n    \n    # Format the final output as a list of lists of integers\n    def format_results(res):\n        return '[' + ','.join(str(r) for r in res) + ']'\n    \n    print(f\"[{','.join(format_results(res) for res in results)}]\")\n\nsolve()\n```"
        }
    ]
}