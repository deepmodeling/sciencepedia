{
    "hands_on_practices": [
        {
            "introduction": "This exercise grounds our study in the fundamentals of market clearing. By solving a single-node economic dispatch problem, we establish the core principle of merit-order dispatch. More importantly, through the lens of Karush-Kuhn-Tucker (KKT) conditions, we will uncover the profound economic meaning behind dual variables, interpreting them as the shadow prices of binding constraints and quantifying the marginal value of generation capacity .",
            "id": "4072001",
            "problem": "Consider a single-period, single-node electricity market clearing problem stated as a social cost minimization with linear generation costs and an inelastic demand. There are three generators, indexed by $i \\in \\{1,2,3\\}$, with decision variables $P_i$ representing their dispatch in megawatts. The total demand is $D = 160$. Generator $i$ has a constant marginal production cost $c_i$ in dollars per megawatt-hour and an upper capacity limit $\\bar{P}_i$ in megawatts. Specifically, the data are:\n- $c_1 = 14$, $\\bar{P}_1 = 60$,\n- $c_2 = 27$, $\\bar{P}_2 = 70$,\n- $c_3 = 55$, $\\bar{P}_3 = 120$.\n\nThe primal market clearing problem is to minimize total production cost subject to the power balance and capacity constraints:\n$$\n\\min_{P_1,P_2,P_3} \\;\\; c_1 P_1 + c_2 P_2 + c_3 P_3\n$$\nsubject to\n$$\nP_1 + P_2 + P_3 = D, \\quad 0 \\leq P_i \\leq \\bar{P}_i \\;\\; \\text{for all } i \\in \\{1,2,3\\}.\n$$\n\nLet $\\lambda$ denote the Lagrange multiplier associated with the power balance equality constraint (interpretable as the market price), let $\\alpha_i \\geq 0$ denote the Lagrange multiplier associated with the lower bound constraint $P_i \\geq 0$, and let $\\mu_i \\geq 0$ denote the Lagrange multiplier associated with the upper bound constraint $P_i \\leq \\bar{P}_i$.\n\nStarting from first principles of convex optimization and linear programming duality, in particular the Karush–Kuhn–Tucker (KKT) optimality conditions, derive the optimal dispatch and the corresponding KKT multipliers. Verify complementary slackness explicitly for the upper bound constraints, i.e., verify that $\\mu_i \\left(P_i - \\bar{P}_i\\right) = 0$ for all $i \\in \\{1,2,3\\}$ at the optimum. Then interpret the upper-bound multiplier $\\mu_2$ as the marginal value of capacity of Generator $2$ (the change in optimal objective per unit increase in $\\bar{P}_2$), and compute its value.\n\nReport the marginal value of capacity of Generator $2$ as a single real number in dollars per megawatt-hour ($\\$/\\mathrm{MWh}$). No rounding is required; provide the exact value.",
            "solution": "The user has provided a single-period, single-node electricity market clearing problem, which is a classic linear programming problem. The task is to find the optimal generator dispatch, the corresponding Karush-Kuhn-Tucker (KKT) multipliers, and to interpret and compute the marginal value of capacity for a specific generator.\n\nFirst, we validate the problem. The problem is a standard economic dispatch formulation. All data, variables, and constraints are provided. The objective function is $\\sum_{i} c_i P_i$. The units of the cost coefficients $c_i$ are dollars per megawatt-hour ($\\$/\\mathrm{MWh}$), and the units of the dispatch variables $P_i$ are megawatts ($\\mathrm{MW}$). Therefore, the objective function has units of $(\\$/\\mathrm{MWh}) \\times \\mathrm{MW} = (\\$/(\\mathrm{MW}\\cdot\\mathrm{h})) \\times \\mathrm{MW} = \\$/\\mathrm{h}$. This represents the total cost rate of generation. The constraints on power are all in $\\mathrm{MW}$. The Lagrange multipliers associated with these power constraints will have units of cost rate per unit of power, i.e., $(\\$/\\mathrm{h})/\\mathrm{MW}$, which is equivalent to $\\$/(\\mathrm{MW}\\cdot\\mathrm{h})$ or $\\$/\\mathrm{MWh}$. The problem asks for the final answer in $\\$/\\mathrm{MWh}$, which is consistent with this interpretation. The problem is thus scientifically grounded, well-posed, and all data are dimensionally consistent under the standard interpretation of such models. The problem is deemed valid.\n\nThe optimization problem is:\n$$ \\min_{P_1,P_2,P_3} \\;\\; 14 P_1 + 27 P_2 + 55 P_3 $$\nsubject to:\n$$ P_1 + P_2 + P_3 = 160 $$\n$$ 0 \\leq P_1 \\leq 60 $$\n$$ 0 \\leq P_2 \\leq 70 $$\n$$ 0 \\leq P_3 \\leq 120 $$\n\nTo solve this, we can use the economic merit order principle, which states that it is optimal to dispatch generators in increasing order of their marginal cost. The marginal costs are $c_1 = 14$, $c_2 = 27$, and $c_3 = 55$. The merit order is Generator $1$, followed by Generator $2$, then Generator $3$. The total demand is $D = 160$ MW.\n\n1.  Dispatch Generator $1$ (cost $c_1=14$): Its capacity is $\\bar{P}_1=60$. Since the demand $160$ is greater than $60$, we dispatch Generator $1$ at its maximum capacity.\n    $P_1^* = 60$.\n    Remaining demand = $160 - 60 = 100$.\n\n2.  Dispatch Generator $2$ (cost $c_2=27$): Its capacity is $\\bar{P}_2=70$. The remaining demand $100$ is greater than $70$, so we dispatch Generator $2$ at its maximum capacity.\n    $P_2^* = 70$.\n    Remaining demand = $100 - 70 = 30$.\n\n3.  Dispatch Generator $3$ (cost $c_3=55$): Its capacity is $\\bar{P}_3=120$. We only need to meet the remaining demand of $30$. Since $30 < 120$, we dispatch Generator $3$ to cover this remainder.\n    $P_3^* = 30$.\n\nThe optimal dispatch is therefore $P_1^* = 60$, $P_2^* = 70$, and $P_3^* = 30$.\nLet's verify the power balance: $60 + 70 + 30 = 160 = D$. The solution is feasible.\n\nNext, we derive the KKT multipliers. The Lagrangian for this problem is:\n$$ \\mathcal{L}(P, \\lambda, \\alpha, \\mu) = \\sum_{i=1}^3 c_i P_i + \\lambda \\left( \\sum_{i=1}^3 P_i - D \\right) - \\sum_{i=1}^3 \\alpha_i P_i + \\sum_{i=1}^3 \\mu_i (P_i - \\bar{P}_i) $$\nwhere $\\lambda$ is the multiplier for the equality constraint, and $\\alpha_i \\geq 0$, $\\mu_i \\geq 0$ are the multipliers for the inequality constraints $-P_i \\leq 0$ and $P_i - \\bar{P}_i \\leq 0$, respectively.\n\nThe KKT conditions at the optimum $(P^*, \\lambda^*, \\alpha^*, \\mu^*)$ are:\n1.  **Primal Feasibility**: The dispatch $P_1^*=60, P_2^*=70, P_3^*=30$ is feasible, as shown above.\n2.  **Dual Feasibility**: $\\alpha_i^* \\geq 0, \\mu_i^* \\geq 0$ for all $i$.\n3.  **Stationarity**: $\\frac{\\partial \\mathcal{L}}{\\partial P_i} = c_i + \\lambda^* - \\alpha_i^* + \\mu_i^* = 0$ for $i=1,2,3$.\n4.  **Complementary Slackness**: $\\alpha_i^* P_i^* = 0$ and $\\mu_i^* (P_i^* - \\bar{P}_i) = 0$ for $i=1,2,3$.\n\nWe use these conditions to find the multipliers:\n\n-   **For Generator 3 ($i=3$)**: The dispatch is $P_3^*=30$. Since $0 < P_3^* < \\bar{P}_3$, this generator is inframarginal (i.e., not at a bound). By complementary slackness:\n    -   $P_3^* > 0 \\implies \\alpha_3^* P_3^* = 0 \\implies \\alpha_3^* = 0$.\n    -   $P_3^* < \\bar{P}_3 \\implies \\mu_3^*(P_3^* - \\bar{P}_3) = 0 \\implies \\mu_3^* = 0$.\n    Substituting $\\alpha_3^*=0$ and $\\mu_3^*=0$ into the stationarity condition for $i=3$:\n    $c_3 + \\lambda^* - 0 + 0 = 0 \\implies \\lambda^* = -c_3 = -55$.\n    The market clearing price, often defined as $-\\lambda^*$ in this type of formulation, is $55$, set by the marginal generator.\n\n-   **For Generator 1 ($i=1$)**: The dispatch is $P_1^*=60 = \\bar{P}_1$.\n    -   $P_1^* > 0 \\implies \\alpha_1^* = 0$.\n    -   The constraint $P_1 \\leq \\bar{P}_1$ is active, so $\\mu_1^*$ can be non-zero.\n    From the stationarity condition for $i=1$:\n    $c_1 + \\lambda^* - \\alpha_1^* + \\mu_1^* = 0 \\implies 14 + (-55) - 0 + \\mu_1^* = 0 \\implies \\mu_1^* = 41$.\n\n-   **For Generator 2 ($i=2$)**: The dispatch is $P_2^*=70 = \\bar{P}_2$.\n    -   $P_2^* > 0 \\implies \\alpha_2^* = 0$.\n    -   The constraint $P_2 \\leq \\bar{P}_2$ is active, so $\\mu_2^*$ can be non-zero.\n    From the stationarity condition for $i=2$:\n    $c_2 + \\lambda^* - \\alpha_2^* + \\mu_2^* = 0 \\implies 27 + (-55) - 0 + \\mu_2^* = 0 \\implies \\mu_2^* = 28$.\n\nThe optimal KKT multipliers are $\\lambda^* = -55$, $\\alpha_1^*=\\alpha_2^*=\\alpha_3^*=0$, $\\mu_1^*=41$, $\\mu_2^*=28$, and $\\mu_3^*=0$. All dual feasibility conditions ($\\alpha_i^* \\geq 0, \\mu_i^* \\geq 0$) are satisfied.\n\nNext, we verify the complementary slackness condition for the upper bounds, $\\mu_i(P_i - \\bar{P}_i) = 0$:\n-   For $i=1$: $\\mu_1^*(P_1^* - \\bar{P}_1) = 41(60 - 60) = 41 \\times 0 = 0$.\n-   For $i=2$: $\\mu_2^*(P_2^* - \\bar{P}_2) = 28(70 - 70) = 28 \\times 0 = 0$.\n-   For $i=3$: $\\mu_3^*(P_3^* - \\bar{P}_3) = 0(30 - 120) = 0 \\times (-90) = 0$.\nThe condition is verified for all generators.\n\nFinally, we interpret and compute the value of $\\mu_2$. The multiplier $\\mu_i$ is the shadow price of the capacity constraint $P_i \\leq \\bar{P}_i$. By the envelope theorem for constrained optimization, the derivative of the optimal objective function value (let's call it $V^*$) with respect to the constraint right-hand side is the negative of the corresponding Lagrange multiplier. Our constraint is $P_i - \\bar{P}_i \\leq 0$. Let $V^*(\\bar{P}_1, \\bar{P}_2, \\bar{P}_3)$ be the minimal cost. Then $\\frac{\\partial V^*}{\\partial \\bar{P}_i} = -\\mu_i^*$.\nThe \"marginal value of capacity\" is defined as the reduction in total cost per unit increase in capacity. This is precisely $-\\frac{\\partial V^*}{\\partial \\bar{P}_i}$, which equals $\\mu_i^*$.\nTherefore, the marginal value of capacity for Generator $2$ is $\\mu_2^*$. We calculated $\\mu_2^* = 28$.\n\nThis value can be understood intuitively. If the capacity of Generator $2$ were increased by one unit (e.g., to $71$ MW), it could produce one more MW at its cost of $c_2 = 27$. To maintain the power balance, the most expensive generator, Generator $3$, would decrease its production by one MW, saving its cost of $c_3 = 55$. The net change in total cost would be $c_2 - c_3 = 27 - 55 = -28$. The cost decreases by $28$, so the marginal value of that extra capacity is $28$.\nAs established earlier, the units of this value are $\\$/\\mathrm{MWh}$.\n\nThe marginal value of capacity of Generator $2$ is $28$ $\\$/\\mathrm{MWh}$.",
            "answer": "$$\n\\boxed{28}\n$$"
        },
        {
            "introduction": "Building on the single-node model, this practice introduces the critical impact of network constraints on market outcomes. We will solve a Direct Current Optimal Power Flow (DC-OPF) for a simple three-bus system with a congested transmission line. This exercise demonstrates how network congestion fragments the single market price into distinct Locational Marginal Prices (LMPs), revealing the economic cost of delivering power across a constrained grid .",
            "id": "4072007",
            "problem": "Consider a stylized bilevel market interaction in an electric power system where the upper-level participants submit offers equal to their true marginal costs, and the lower-level Independent System Operator (ISO) clears the market via Direct Current Optimal Power Flow (DC-OPF). The lower-level problem is a linear program with a single monitored transmission constraint represented by Power Transfer Distribution Factors (PTDFs). There are three buses, indexed by $i \\in \\{1,2,3\\}$, each with one generator and inelastic demand. Generators have linear marginal costs $c_i$ in dollars per megawatt-hour ($\\$/\\mathrm{MWh}$) and choose nonnegative dispatch $p_i$ in megawatts (MW).\n\nData:\n- Demands: $d_1 = 40$ $\\mathrm{MW}$, $d_2 = 40$ $\\mathrm{MW}$, $d_3 = 20$ $\\mathrm{MW}$.\n- Marginal costs: $c_1 = 40$ $\\$/\\mathrm{MWh}$, $c_2 = 20$ $\\$/\\mathrm{MWh}$, $c_3 = 10$ $\\$/\\mathrm{MWh}$.\n- Monitored line $L$ is oriented from bus $1$ to bus $2$, with PTDFs $\\phi_1 = 0.7$, $\\phi_2 = -0.2$, and $\\phi_3 = -0.5$. The line flow is $f = \\sum_{i=1}^{3} \\phi_i (p_i - d_i)$.\n- Transmission limit: an upper bound $f \\le \\bar{F}$ with $\\bar{F} = 10$ $\\mathrm{MW}$, and no other network constraints are enforced.\n- Generator capacities: $0 \\le p_i$ with no upper bounds.\n\nThe lower-level DC-OPF minimizes total variable cost $\\sum_{i=1}^{3} c_i p_i$ subject to power balance $\\sum_{i=1}^{3} p_i = \\sum_{i=1}^{3} d_i$ and the single line limit $f \\le \\bar{F}$. Locational Marginal Prices (LMPs) $\\pi_i$ are defined as the nodal shadow prices obtained from the Karush-Kuhn-Tucker (KKT) conditions, with $\\pi_i = \\lambda + \\mu \\phi_i$, where $\\lambda$ is the dual variable for the power balance constraint and $\\mu \\ge 0$ is the dual variable for the binding line constraint $f \\le \\bar{F}$.\n\nTasks:\n1. Formulate the lower-level DC-OPF and its Lagrangian, derive the KKT conditions, and compute the optimal dispatch vector $(p_1, p_2, p_3)$ and the nodal Locational Marginal Prices $(\\pi_1, \\pi_2, \\pi_3)$.\n2. Verify dual feasibility and complementary slackness for the generator nonnegativity constraints and the single binding line limit.\n3. Confirm that the computed LMPs are consistent with stationarity at producing generators and with nonnegativity slackness at nonproducing generators.\n\nProvide your final numerical answer as a single row matrix containing $p_1$, $p_2$, $p_3$ in $\\mathrm{MW}$ followed by $\\pi_1$, $\\pi_2$, $\\pi_3$ in $\\$/\\mathrm{MWh}$. No rounding is required; use exact values where convenient. Do not include units inside the final boxed answer.",
            "solution": "The user-provided problem is evaluated as valid. It is scientifically grounded in the principles of power system economics and optimization, well-posed as a linear program, and objectively stated with a complete set of data.\n\nThe first step is to formally state the lower-level DC-OPF problem. The objective is to minimize the total generation cost, given by $\\sum_{i=1}^{3} c_i p_i$, where $p_i$ is the power output of generator $i$ and $c_i$ is its marginal cost. The decision variables are the generator dispatch levels $p_1, p_2, p_3$.\n\nThe given data are:\n- Demands: $d_1 = 40$ $\\mathrm{MW}$, $d_2 = 40$ $\\mathrm{MW}$, $d_3 = 20$ $\\mathrm{MW}$. Total demand is $\\sum_{i=1}^{3} d_i = 100$ $\\mathrm{MW}$.\n- Marginal costs: $c_1 = 40$ $\\$/\\mathrm{MWh}$, $c_2 = 20$ $\\$/\\mathrm{MWh}$, $c_3 = 10$ $\\$/\\mathrm{MWh}$.\n- PTDFs: $\\phi_1 = 0.7$, $\\phi_2 = -0.2$, $\\phi_3 = -0.5$.\n- Transmission limit: $\\bar{F} = 10$ $\\mathrm{MW}$.\n\nThe optimization problem is:\n$$\n\\min_{p_1, p_2, p_3} \\quad 40 p_1 + 20 p_2 + 10 p_3\n$$\nsubject to:\n1.  Power balance: $p_1 + p_2 + p_3 = 100$\n2.  Transmission limit: $\\sum_{i=1}^{3} \\phi_i (p_i - d_i) \\le \\bar{F}$\n    $0.7(p_1 - 40) - 0.2(p_2 - 40) - 0.5(p_3 - 20) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - (0.7 \\cdot 40 - 0.2 \\cdot 40 - 0.5 \\cdot 20) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - (28 - 8 - 10) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - 10 \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 \\le 20$\n3.  Non-negativity: $p_i \\ge 0$ for $i \\in \\{1, 2, 3\\}$\n\nThe Lagrangian for this problem is formulated to derive the Karush-Kuhn-Tucker (KKT) conditions. Let $\\lambda$ be the dual variable for the power balance constraint and $\\mu$ be the dual variable for the transmission limit.\n$$\n\\mathcal{L}(p_i; \\lambda, \\mu) = \\sum_{i=1}^{3} c_i p_i - \\lambda\\left(\\sum_{i=1}^{3} p_i - \\sum_{i=1}^{3} d_i\\right) - \\mu\\left(\\bar{F} - \\sum_{i=1}^{3} \\phi_i(p_i-d_i)\\right)\n$$\nThe KKT conditions for optimality couple the primal and dual variables. The stationarity condition with respect to a dispatch variable $p_i$ (assuming $p_i > 0$ and it is not at a capacity limit) is $\\frac{\\partial\\mathcal{L}}{\\partial p_i} = 0$, which yields:\n$$\nc_i - \\lambda + \\mu\\phi_i = 0 \\implies c_i = \\lambda - \\mu\\phi_i\n$$\nThe problem statement defines the Locational Marginal Price (LMP) at bus $i$ as $\\pi_i = \\lambda + \\mu\\phi_i$. There appears to be a sign convention difference. In standard power systems literature, the Lagrangian is often written as $L = \\sum c_i p_i - \\lambda(\\sum p_i - \\sum d_i) + \\mu(\\sum \\phi_i p_i - \\text{limit})$. With the given LMP definition $\\pi_i = \\lambda + \\mu\\phi_i$, the stationarity conditions for optimality are:\n- If $p_i > 0$, then $c_i = \\pi_i = \\lambda + \\mu\\phi_i$.\n- If $p_i = 0$, then $c_i \\ge \\pi_i = \\lambda + \\mu\\phi_i$.\nAdditionally, for the inequality constraints:\n- $\\mu \\ge 0$ and $\\mu(\\sum_{i=1}^{3} \\phi_i(p_i-d_i) - \\bar{F}) = 0$.\n\nThe problem states that $\\mu$ is the dual variable for the *binding* line constraint, which implies we should operate under the assumption that the constraint is active and thus $\\mu > 0$.\nWith $\\mu > 0$, the LMPs are differentiated by the PTDFs:\n$\\pi_1 = \\lambda + 0.7\\mu$\n$\\pi_2 = \\lambda - 0.2\\mu$\n$\\pi_3 = \\lambda - 0.5\\mu$\nThis implies a price separation: $\\pi_1 > \\pi_2 > \\pi_3$.\n\nThe solution to this LP will have at most two generators dispatched to satisfy the two active constraints (power balance and the binding line limit). We test combinations of two dispatched generators.\nHypothesis 1: Generators $2$ and $3$ are dispatched ($p_2 > 0, p_3 > 0, p_1 = 0$).\nThis requires $c_2 = \\pi_2$ and $c_3 = \\pi_3$.\n$20 = \\lambda - 0.2\\mu$\n$10 = \\lambda - 0.5\\mu$\nSubtracting the two equations gives $10 = 0.3\\mu$, so $\\mu = 100/3$. Substituting back, $\\lambda = 20 + 0.2(100/3) = 20 + 20/3 = 80/3$.\nNow, we must check the condition for the non-dispatched generator $1$: $c_1 \\ge \\pi_1$.\n$\\pi_1 = \\lambda + 0.7\\mu = 80/3 + 0.7(100/3) = (80+70)/3 = 150/3 = 50$.\nThe condition is $c_1 \\ge \\pi_1 \\implies 40 \\ge 50$, which is false. Thus, this hypothesis is incorrect.\n\nHypothesis 2: Generators $1$ and $3$ are dispatched ($p_1 > 0, p_3 > 0, p_2 = 0$).\nThis requires $c_1 = \\pi_1$ and $c_3 = \\pi_3$.\n$40 = \\lambda + 0.7\\mu$\n$10 = \\lambda - 0.5\\mu$\nSubtracting the equations gives $30 = 1.2\\mu$, so $\\mu = 30/1.2 = 25$. Since $\\mu > 0$, this is consistent with a binding constraint.\nSubstituting back, $\\lambda = 10 + 0.5\\mu = 10 + 0.5(25) = 10 + 12.5 = 22.5$.\nNow, check the condition for the non-dispatched generator $2$: $c_2 \\ge \\pi_2$.\n$\\pi_2 = \\lambda - 0.2\\mu = 22.5 - 0.2(25) = 22.5 - 5 = 17.5$.\nThe condition is $c_2 \\ge \\pi_2 \\implies 20 \\ge 17.5$, which is true. This hypothesis is consistent.\n\nHaving found the correct set of dispatched generators and dual variables, we now solve for the primal variables $p_1, p_2, p_3$.\nWe have $p_2 = 0$ and the two active constraints:\n1. $p_1 + p_3 = 100$\n2. $0.7p_1 - 0.5p_3 = 20$\nFrom (1), $p_1 = 100 - p_3$. Substituting into (2):\n$0.7(100 - p_3) - 0.5p_3 = 20$\n$70 - 0.7p_3 - 0.5p_3 = 20$\n$50 = 1.2p_3$\n$p_3 = 50 / 1.2 = 500 / 12 = 125 / 3$.\nThen, $p_1 = 100 - 125/3 = (300 - 125)/3 = 175/3$.\nThe optimal dispatch is $(p_1, p_2, p_3) = (175/3, 0, 125/3)$. Both $p_1$ and $p_3$ are positive, consistent with our assumption.\n\nThe Locational Marginal Prices are computed using $\\lambda = 22.5$ and $\\mu=25$:\n$\\pi_1 = \\lambda + \\mu\\phi_1 = 22.5 + 25(0.7) = 22.5 + 17.5 = 40$.\n$\\pi_2 = \\lambda + \\mu\\phi_2 = 22.5 + 25(-0.2) = 22.5 - 5 = 17.5$.\n$\\pi_3 = \\lambda + \\mu\\phi_3 = 22.5 + 25(-0.5) = 22.5 - 12.5 = 10$.\nThe optimal LMPs are $(\\pi_1, \\pi_2, \\pi_3) = (40, 17.5, 10)$.\n\nFinally, we verify the remaining KKT conditions.\n- **Dual feasibility and complementary slackness for the line limit**:\nDual feasibility requires $\\mu \\ge 0$, and we found $\\mu=25$, which holds.\nComplementary slackness requires $\\mu(0.7p_1 - 0.2p_2 - 0.5p_3 - 20)=0$.\nThe line flow term is $0.7(175/3) - 0.2(0) - 0.5(125/3) - 20 = (122.5 - 62.5)/3 - 20 = 60/3 - 20 = 20 - 20 = 0$.\nThe condition $25 \\cdot 0 = 0$ holds.\n\n- **Dual feasibility and complementary slackness for generator non-negativity**: This is equivalent to confirming the LMP consistency.\nFor producing generator $1$: $p_1 = 175/3 > 0$. We check if $c_1 = \\pi_1$. $40 = 40$. This is consistent.\nFor producing generator $3$: $p_3 = 125/3 > 0$. We check if $c_3 = \\pi_3$. $10 = 10$. This is consistent.\nFor non-producing generator $2$: $p_2 = 0$. We check if $c_2 \\ge \\pi_2$. $20 \\ge 17.5$. This is consistent.\n\nAll KKT conditions are satisfied. The solution is optimal.\nThe final result combines the dispatch vector $(p_1, p_2, p_3)$ and the LMP vector $(\\pi_1, \\pi_2, \\pi_3)$.\n$p_1 = 175/3$ $\\mathrm{MW}$, $p_2 = 0$ $\\mathrm{MW}$, $p_3 = 125/3$ $\\mathrm{MW}$.\n$\\pi_1 = 40$ $\\$/\\mathrm{MWh}$, $\\pi_2 = 17.5$ $\\$/\\mathrm{MWh}$, $\\pi_3 = 10$ $\\$/\\mathrm{MWh}$.\nIn fraction form, $17.5$ is $35/2$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{175}{3} & 0 & \\frac{125}{3} & 40 & \\frac{35}{2} & 10 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "This final practice elevates our analysis to a full bilevel model, capturing the strategic interplay between a firm's investment decision and the resulting market equilibrium. We will first derive the true equilibrium of this leader-follower game, then explore a common computational approach: the big-M linearization. This exercise is designed to reveal a critical pitfall in practice, showing how improperly chosen bounds can lead to an incorrect solution and underscoring the necessity of using economic insight to guide mathematical formulation .",
            "id": "4071973",
            "problem": "Consider a single-price energy market with a representative firm that decides an installed capacity $K \\geq 0$ at the upper level and a centralized market clearing at the lower level. The inverse demand is $p(q) = a - bq$ with $a > 0$ and $b > 0$, and the firm has constant marginal cost $c$ and pays a fixed capacity cost $F$ per unit installed. The lower-level market clearing maximizes total surplus subject to feasibility. The overall problem is a Mathematical Program with Equilibrium Constraints (MPEC) with Karush–Kuhn–Tucker (KKT) complementarity capturing market clearing.\n\nData for this instance are $a = 100$, $b = 2$, $c = 10$, and $F = 5$. The lower-level problem is welfare maximization with decision variable $q$,\n$$\n\\max_{q} \\ \\int_{0}^{q} (a - b t) \\, dt - c q \\quad \\text{s.t.} \\quad 0 \\leq q \\leq K,\n$$\nwith dual variables $\\mu \\geq 0$ (for $q \\geq 0$) and $\\lambda \\geq 0$ (for $q \\leq K$). The upper-level chooses $K$ to maximize profit given price $p(q) = a - bq$, namely\n$$\n\\max_{K \\geq 0} \\ \\pi(K) = p(q) q - c q - F K,\n$$\nwhere $q$ is the lower-level optimal dispatch for the given $K$.\n\nYou will analyze two formulations of the complementarity $0 \\leq \\lambda \\perp K - q \\geq 0$ at the lower level:\n- An incorrect Mixed-Integer Linear Programming (MILP) big-$M$ linearization that imposes $\\lambda \\leq M_{\\lambda} z$, $K - q \\leq U_{q} (1 - z)$, with $z \\in \\{0,1\\}$, and uses $M_{\\lambda} = 20$ and an uninformative bound $U_{q} = 200$.\n- A corrected big-$M$ with tightened bounds derived from economics and feasibility.\n\nTasks:\n1. Starting from first principles of welfare maximization and KKT optimality, derive the true equilibrium $q^{\\star}$ and $K^{\\star}$ that solve the bilevel problem with correctly enforced complementarity (no artificial upper bounds on dual variables). Determine the associated price $p^{\\star} = a - b q^{\\star}$.\n2. Show how the incorrect big-$M$ choice $M_{\\lambda} = 20$ distorts the lower-level KKT conditions and compute the equilibrium that the MILP would return in this case. Explain why this equilibrium is wrong.\n3. Identify economically valid tightened bounds that guarantee correctness of the big-$M$ linearization in this instance. Specifically, provide and justify an upper bound $\\overline{q}$ satisfying $q \\leq \\overline{q}$ for all feasible equilibria and a corresponding safe upper bound $\\overline{\\lambda}$ such that $\\lambda \\leq \\overline{\\lambda}$ for all feasible equilibria. Argue that with these corrected bounds the true equilibrium is recovered.\n\nExpress the final price $p^{\\star}$ in $\\$/\\mathrm{MWh}$. Give the final answer exactly (no rounding).",
            "solution": "The problem asks for an analysis of a bilevel market equilibrium model, structured as a Mathematical Program with Equilibrium Constraints (MPEC). We will address the three tasks in sequence: deriving the true equilibrium, analyzing a flawed Mixed-Integer Linear Programming (MILP) formulation, and determining correct bounds for the MILP formulation.\n\nThe given data are: $a = 100$, $b = 2$, $c = 10$, and $F = 5$. The inverse demand is $p(q) = a - bq = 100 - 2q$.\n\n### Task 1: Derivation of the True Equilibrium\n\nThe true equilibrium is found by solving the bilevel problem where the leader (firm) anticipates the follower's (market operator's) response.\n\n**Lower-Level Problem (Market Clearing)**\n\nThe market operator maximizes social welfare, $W(q)$, subject to operational constraints. The welfare is the integral of the demand curve (gross consumer surplus) minus the production cost.\n$$\n\\max_{q} \\ W(q) = \\int_{0}^{q} (a - b t) \\, dt - c q = \\left[at - \\frac{1}{2}bt^2\\right]_0^q - cq = aq - \\frac{1}{2}bq^2 - cq\n$$\nThe constraints are $0 \\leq q \\leq K$. The Lagrangian for this problem is:\n$$\n\\mathcal{L}(q, \\mu, \\lambda) = aq - \\frac{1}{2}bq^2 - cq + \\mu q - \\lambda(q - K)\n$$\nwhere $\\mu \\geq 0$ is the dual variable for $q \\geq 0$ and $\\lambda \\geq 0$ is the dual variable for $q \\leq K$.\n\nThe Karush-Kuhn-Tucker (KKT) conditions for optimality are:\n1.  **Stationarity:** $\\frac{\\partial \\mathcal{L}}{\\partial q} = a - bq - c + \\mu - \\lambda = 0$.\n2.  **Primal Feasibility:** $0 \\leq q \\leq K$.\n3.  **Dual Feasibility:** $\\mu \\geq 0, \\lambda \\geq 0$.\n4.  **Complementarity:** $\\mu q = 0$ and $\\lambda(K - q) = 0$.\n\nSince $a > c$ ($100 > 10$), the price for the first unit is greater than the cost, so we will always have $q > 0$. The condition $\\mu q = 0$ thus implies $\\mu = 0$. The stationarity condition simplifies to $a - bq - c - \\lambda = 0$, or $\\lambda = a - c - bq$.\n\nWe analyze the second complementarity condition, $\\lambda(K - q) = 0$:\n-   If $\\lambda = 0$, then $a - c - bq = 0 \\implies q = \\frac{a - c}{b}$. For this to be valid, we must have $q < K$ (since if $q=K$, $\\lambda$ can be positive). So, if $K > \\frac{a-c}{b}$, the market dispatches $q = \\frac{a-c}{b}$. For our data, this quantity is $q_{comp} = \\frac{100-10}{2} = 45$. In this case, the market price is $p = a - bq = a - b(\\frac{a-c}{b}) = c = 10$. This is the competitive outcome where price equals marginal cost.\n-   If $K - q = 0$, then $q=K$. For this to be valid, the corresponding dual variable must be non-negative: $\\lambda = a - c - bK \\geq 0$, which implies $K \\leq \\frac{a-c}{b} = 45$.\n\nCombining these cases, the market dispatch quantity $q$ as a function of the installed capacity $K$ is:\n$$\nq(K) = \\min\\left(K, \\frac{a-c}{b}\\right) = \\min(K, 45)\n$$\n\n**Upper-Level Problem (Firm's Profit Maximization)**\n\nThe firm chooses its capacity $K \\geq 0$ to maximize its profit, anticipating the market outcome $q(K)$. The profit function is $\\pi(K) = p(q(K))q(K) - cq(K) - FK$.\n$$\n\\pi(K) = (a - bq(K))q(K) - cq(K) - FK\n$$\nWe analyze this function over two regions for $K$:\n\n-   **Region 1: $0 \\leq K \\leq 45$.**\n    In this region, $q(K) = K$. The profit is:\n    $$\n    \\pi(K) = (a - bK)K - cK - FK = (a - c - F)K - bK^2\n    $$\n    Substituting the data: $\\pi(K) = (100 - 10 - 5)K - 2K^2 = 85K - 2K^2$.\n    This is a concave quadratic function of $K$. To find the maximum, we set the first derivative to zero:\n    $$\n    \\frac{d\\pi}{dK} = 85 - 4K = 0 \\implies K = \\frac{85}{4} = 21.25\n    $$\n    Since $0 \\leq 21.25 \\leq 45$, this is the optimal capacity within this region. Let's call this $K^{\\star} = 21.25$.\n    The maximum profit in this region is $\\pi(21.25) = 85(21.25) - 2(21.25)^2 = 1806.25 - 903.125 = 903.125$.\n\n-   **Region 2: $K > 45$.**\n    In this region, $q(K) = 45$. The profit is:\n    $$\n    \\pi(K) = (a - b(45))(45) - c(45) - FK\n    $$\n    Since $p(45) = 100 - 2(45) = 10 = c$, the operating profit is zero: $(p(45)-c) \\times 45 = 0$.\n    Thus, $\\pi(K) = -FK = -5K$.\n    This function is strictly decreasing for $K > 45$. The highest profit in this region is achieved at the boundary $K \\to 45^{+}$, yielding $\\pi(45) = -5(45) = -225$.\n\nComparing the optimal profits in both regions ($903.125$ vs $-225$), the firm's optimal choice is $K^{\\star} = 21.25$.\n\n**Equilibrium Outcome:**\n-   Optimal capacity: $K^{\\star} = 21.25$.\n-   Equilibrium quantity: Since $K^{\\star} \\leq 45$, $q^{\\star} = K^{\\star} = 21.25$.\n-   Equilibrium price: $p^{\\star} = a - bq^{\\star} = 100 - 2(21.25) = 100 - 42.5 = 57.5$.\n\n### Task 2: Analysis of the Incorrect Big-$M$ Formulation\n\nThe MPEC formulation replaces the complementarity condition $\\lambda(K-q) = 0$ with the big-$M$ constraints using $z \\in \\{0, 1\\}$:\n1.  $\\lambda \\leq M_{\\lambda} z$\n2.  $K - q \\leq U_q (1-z)$\nWith the given incorrect values $M_{\\lambda} = 20$ and $U_q = 200$.\n\nThe firm maximizes $\\pi = (a-c)q - bq^2 - FK$ subject to the KKT conditions, which now include these big-$M$ constraints as well as $\\lambda = a-c-bq = 90-2q$ (with $\\mu=0$), $q \\ge 0$, $\\lambda \\ge 0$, and $K \\ge q$. Substituting the expression for $\\lambda$, the full problem is to maximize $\\pi = 90q - 2q^2 - 5K$ subject to:\n-   $K \\geq q$\n-   $90 - 2q \\geq 0 \\implies q \\leq 45$\n-   $90 - 2q \\leq 20 z$\n-   $K - q \\leq 200(1-z)$\n-   $K \\geq 0, q \\geq 0, z \\in \\{0,1\\}$\n\nWe analyze by case on the binary variable $z$:\n\n-   **Case $z = 1$:**\n    The constraints become: $K \\geq q$, $q \\leq 45$, $90 - 2q \\leq 20 \\implies 70 \\leq 2q \\implies q \\geq 35$, and $K-q \\leq 0 \\implies K=q$.\n    So, we must have $K=q$ and $35 \\leq K \\leq 45$.\n    The firm's problem is to maximize $\\pi(K) = (a-c-F)K - bK^2 = 85K - 2K^2$ over the interval $[35, 45]$.\n    The unconstrained maximum of this parabola is at $K=21.25$. Since this is outside and to the left of the interval $[35, 45]$, the function is decreasing over this interval. The maximum is attained at the leftmost point, $K = 35$.\n    The solution for this case is $(K, q) = (35, 35)$, with profit $\\pi(35) = 85(35) - 2(35^2) = 2975 - 2450 = 525$.\n\n-   **Case $z = 0$:**\n    The constraints become: $K \\geq q$, $q \\leq 45$, $90 - 2q \\leq 0 \\implies q \\geq 45$, and $K-q \\leq 200$.\n    The quantity constraints imply $q=45$. The capacity constraint is $K \\geq 45$.\n    The profit function is $\\pi(K) = 90(45) - 2(45^2) - 5K = 4050 - 4050 - 5K = -5K$.\n    To maximize $-5K$ for $K \\geq 45$, the firm chooses the smallest possible value, $K=45$.\n    The solution for this case is $(K, q) = (45, 45)$, with profit $\\pi(45) = -5(45) = -225$.\n\nComparing the profits from the two cases ($525$ vs $-225$), the optimal solution for the flawed MILP is $(K, q) = (35, 35)$. The resulting price is $p = 100 - 2(35) = 30$.\n\n**Explanation of the Error:**\nThis result is incorrect because the chosen $M_{\\lambda}=20$ is too small. At the true equilibrium $(K^{\\star}, q^{\\star}) = (21.25, 21.25)$, we have $K-q=0$, which forces $z=1$ in the big-$M$ formulation. The true dual variable is $\\lambda^{\\star} = a - c - bq^{\\star} = 100 - 10 - 2(21.25) = 47.5$. The big-$M$ constraint $\\lambda \\leq M_{\\lambda} z$ becomes $\\lambda \\leq 20(1)$, which is $\\lambda \\leq 20$. Since $\\lambda^{\\star} = 47.5 > 20$, the true equilibrium solution is infeasible under this flawed formulation. The model is artificially forced to find a suboptimal solution that satisfies the overly restrictive constraint $\\lambda \\leq 20$. This corresponds to $a-c-bq \\leq 20 \\implies 90-2q \\leq 20 \\implies q \\geq 35$, which explains why the model chose the smallest possible quantity in this range, $q=35$.\n\n### Task 3: Derivation of Tightened Bounds\n\nTo ensure the big-$M$ formulation is correct, the constants $M_{\\lambda}$ and $U_q$ must be valid upper bounds for $\\lambda$ and $K-q$, respectively, over the set of all feasible solutions.\n\n**Upper Bound on Quantity, $\\overline{q}$:**\nThe lower-level problem maximizes the concave welfare function $W(q) = (a-c)q - \\frac{1}{2}bq^2 = 90q - q^2$ over the interval $[0, K]$. The unconstrained maximum of $W(q)$ occurs at $q = \\frac{a-c}{b} = 45$. Therefore, the solution to the constrained problem, $q(K) = \\min(K, 45)$, can never exceed this value. A valid and tight upper bound for the dispatch quantity is $\\overline{q} = \\frac{a-c}{b} = 45$. A firm would not rationally build capacity $K > \\overline{q}$, as this leads to negative profits. Thus, a valid upper bound for $K-q$ is $\\overline{q} - 0 = 45$. A safe choice is $U_q = 45$.\n\n**Upper Bound on Dual Variable, $\\overline{\\lambda}$:**\nFrom the KKT stationarity condition, $\\lambda = a - c - bq$ (since $q>0 \\implies \\mu=0$). To find an upper bound for $\\lambda$, we need a lower bound for $q$. The quantity $q$ is physically non-negative, $q \\geq 0$. Therefore:\n$$\n\\lambda = a - c - bq \\leq a - c - b(0) = a - c\n$$\nA valid upper bound for $\\lambda$ is $\\overline{\\lambda} = a - c = 100 - 10 = 90$. This bound corresponds to the shadow price of the very first unit of capacity, which is the difference between the market choke price and the marginal cost.\n\n**Correctness with Tightened Bounds:**\nUsing the valid bounds $M_{\\lambda} = \\overline{\\lambda} = 90$ and $U_q = 45$, the big-$M$ constraints are:\n1.  $\\lambda \\leq 90 z$\n2.  $K - q \\leq 45 (1-z)$\n\nLet's check if the true equilibrium solution is feasible in this corrected formulation. The true solution is $(K^{\\star}, q^{\\star})=(21.25, 21.25)$ with $\\lambda^{\\star} = 47.5$.\n-   At this solution, $K-q = 0$. The constraint $K - q \\leq 45(1-z)$ becomes $0 \\leq 45(1-z)$, which requires $z=1$.\n-   With $z=1$, the first constraint becomes $\\lambda \\leq 90$.\n-   The true dual variable value $\\lambda^{\\star} = 47.5$ satisfies this condition, since $47.5 \\leq 90$.\n\nBecause the true optimal solution is a feasible point in the search space of the MPEC with these tightened bounds, and the objective function is the same, an exact MILP solver is guaranteed to find this true global optimum. The use of economically-derived, valid bounds ensures the integrity of the bilevel problem's reformulation.\n\nThe final price $p^{\\star}$ from the true equilibrium (Task 1) is $57.5$ $\\$/\\mathrm{MWh}$.",
            "answer": "$$\n\\boxed{57.5}\n$$"
        }
    ]
}