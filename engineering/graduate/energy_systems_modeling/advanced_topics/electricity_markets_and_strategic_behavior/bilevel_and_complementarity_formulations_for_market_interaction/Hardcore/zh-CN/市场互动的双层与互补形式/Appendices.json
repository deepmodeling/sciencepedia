{
    "hands_on_practices": [
        {
            "introduction": "本次实践从最基础的单节点电力市场模型入手，帮助你掌握经济调度的核心原理。通过求解一个成本最小化的线性规划问题，你将学会如何运用Karush-Kuhn-Tucker (KKT) 条件来验证最优性，并深入理解拉格朗日乘子（即对偶变量）如何揭示重要的经济信号，例如市场出清价格以及发电机容量的边际价值。这项练习旨在将抽象的优化理论与具体的市场经济学解释联系起来。",
            "id": "4072001",
            "problem": "考虑一个单周期、单节点的电力市场出清问题，该问题被表述为具有线性发电成本和刚性需求的社会成本最小化问题。存在三台发电机组，索引为 $i \\in \\{1,2,3\\}$，其决策变量 $P_i$ 代表它们的出力（单位为兆瓦）。总需求为 $D = 160$。发电机组 $i$ 的恒定边际生产成本为 $c_i$（单位为美元/兆瓦时），容量上限为 $\\bar{P}_i$（单位为兆瓦）。具体数据如下：\n- $c_1 = 14$，$\\bar{P}_1 = 60$，\n- $c_2 = 27$，$\\bar{P}_2 = 70$，\n- $c_3 = 55$，$\\bar{P}_3 = 120$。\n\n原始市场出清问题是在满足功率平衡和容量约束的条件下，最小化总生产成本：\n$$\n\\min_{P_1,P_2,P_3} \\;\\; c_1 P_1 + c_2 P_2 + c_3 P_3\n$$\n约束条件为\n$$\nP_1 + P_2 + P_3 = D, \\quad 0 \\leq P_i \\leq \\bar{P}_i \\;\\; \\text{for all } i \\in \\{1,2,3\\}。\n$$\n\n令 $\\lambda$ 表示与功率平衡等式约束相关的拉格朗日乘子（可解释为市场价格），令 $\\alpha_i \\geq 0$ 表示与下限约束 $P_i \\geq 0$ 相关的拉格朗日乘子，令 $\\mu_i \\geq 0$ 表示与上限约束 $P_i \\leq \\bar{P}_i$ 相关的拉格朗日乘子。\n\n从凸优化和线性规划对偶的基本原理出发，特别是利用 Karush–Kuhn–Tucker (KKT) 最优性条件，推导最优出力及相应的 KKT 乘子。显式地验证上限约束的互补松弛性，即验证在最优解下，对于所有 $i \\in \\{1,2,3\\}$ 都有 $\\mu_i \\left(P_i - \\bar{P}_i\\right) = 0$。然后将上限乘子 $\\mu_2$ 解释为发电机组 2 的容量边际价值（即 $\\bar{P}_2$ 每增加一个单位，最优目标值的变化量），并计算其值。\n\n将发电机组 2 的容量边际价值以美元/兆瓦时（$\\$/\\mathrm{MWh}$）为单位，作为一个实数报告。无需四舍五入，提供精确值。",
            "solution": "用户提供了一个单周期、单节点的电力市场出清问题，这是一个经典的线性规划问题。任务是找到最优的发电机组出力、相应的 Karush-Kuhn-Tucker (KKT) 乘子，并解释和计算特定发电机组的容量边际价值。\n\n首先，我们验证该问题。这是一个标准的经济调度模型。所有数据、变量和约束都已提供。目标函数为 $\\sum_{i} c_i P_i$。成本系数 $c_i$ 的单位是美元/兆瓦时（$\\$/\\mathrm{MWh}$），出力变量 $P_i$ 的单位是兆瓦（$\\mathrm{MW}$）。因此，目标函数的单位是 $(\\$/\\mathrm{MWh}) \\times \\mathrm{MW} = (\\$/(\\mathrm{MW}\\cdot\\mathrm{h})) \\times \\mathrm{MW} = \\$/\\mathrm{h}$。这代表了总的发电成本率。功率约束的单位都是 $\\mathrm{MW}$。与这些功率约束相关的拉格朗日乘子的单位将是单位功率的成本率，即 $(\\$/\\mathrm{h})/\\mathrm{MW}$，这等同于 $\\$/(\\mathrm{MW}\\cdot\\mathrm{h})$ 或 $\\$/\\mathrm{MWh}$。题目要求最终答案以 $\\$/\\mathrm{MWh}$ 为单位，这与此解释一致。因此，该问题在科学上是合理的、适定的，并且在对此类模型的标准解释下，所有数据在量纲上都是一致的。该问题被认为是有效的。\n\n优化问题为：\n$$ \\min_{P_1,P_2,P_3} \\;\\; 14 P_1 + 27 P_2 + 55 P_3 $$\n约束条件为：\n$$ P_1 + P_2 + P_3 = 160 $$\n$$ 0 \\leq P_1 \\leq 60 $$\n$$ 0 \\leq P_2 \\leq 70 $$\n$$ 0 \\leq P_3 \\leq 120 $$\n\n为了解决这个问题，我们可以使用经济优先次序原则，该原则指出，按照边际成本递增的顺序调度发电机组是最优的。边际成本分别为 $c_1 = 14$，$c_2 = 27$ 和 $c_3 = 55$。优先次序是发电机组 1，然后是发电机组 2，最后是发电机组 3。总需求为 $D = 160$ 兆瓦。\n\n1.  调度发电机组 1（成本 $c_1=14$）：其容量为 $\\bar{P}_1=60$。由于需求 $160$ 大于 $60$，我们以其最大容量调度发电机组 1。\n    $P_1^* = 60$。\n    剩余需求 = $160 - 60 = 100$。\n\n2.  调度发电机组 2（成本 $c_2=27$）：其容量为 $\\bar{P}_2=70$。剩余需求 $100$ 大于 $70$，所以我们以其最大容量调度发电机组 2。\n    $P_2^* = 70$。\n    剩余需求 = $100 - 70 = 30$。\n\n3.  调度发电机组 3（成本 $c_3=55$）：其容量为 $\\bar{P}_3=120$。我们只需要满足剩余的 $30$ 需求。由于 $30 \\le 120$，我们调度发电机组 3 来满足这部分剩余需求。\n    $P_3^* = 30$。\n\n因此，最优出力为 $P_1^* = 60$，$P_2^* = 70$，$P_3^* = 30$。我们来验证功率平衡：$60 + 70 + 30 = 160 = D$。该解是可行的。\n\n接下来，我们推导 KKT 乘子。该问题的拉格朗日函数为：\n$$ \\mathcal{L}(P, \\lambda, \\alpha, \\mu) = \\sum_{i=1}^3 c_i P_i + \\lambda \\left( \\sum_{i=1}^3 P_i - D \\right) - \\sum_{i=1}^3 \\alpha_i P_i + \\sum_{i=1}^3 \\mu_i (P_i - \\bar{P}_i) $$\n其中 $\\lambda$ 是等式约束的乘子，$\\alpha_i \\geq 0$ 和 $\\mu_i \\geq 0$ 分别是不等式约束 $-P_i \\leq 0$ 和 $P_i - \\bar{P}_i \\leq 0$ 的乘子。\n\n在最优解 $(P^*, \\lambda^*, \\alpha^*, \\mu^*)$ 处的 KKT 条件是：\n1.  **原始可行性**：如上所示，出力 $P_1^*=60, P_2^*=70, P_3^*=30$ 是可行的。\n2.  **对偶可行性**：对于所有 $i$，$\\alpha_i^* \\geq 0, \\mu_i^* \\geq 0$。\n3.  **平稳性**：对于 $i=1,2,3$，$\\frac{\\partial \\mathcal{L}}{\\partial P_i} = c_i + \\lambda^* - \\alpha_i^* + \\mu_i^* = 0$。\n4.  **互补松弛性**：对于 $i=1,2,3$，$\\alpha_i^* P_i^* = 0$ 且 $\\mu_i^* (P_i^* - \\bar{P}_i) = 0$。\n\n我们使用这些条件来求解乘子：\n\n-   **对于发电机组 3 ($i=3$)**：出力为 $P_3^*=30$。由于 $0 < P_3^* < \\bar{P}_3$，该机组是边际内的（即不在边界上）。根据互补松弛性：\n    -   $P_3^* > 0 \\implies \\alpha_3^* P_3^* = 0 \\implies \\alpha_3^* = 0$。\n    -   $P_3^* < \\bar{P}_3 \\implies \\mu_3^*(P_3^* - \\bar{P}_3) = 0 \\implies \\mu_3^* = 0$。\n    将 $\\alpha_3^*=0$ 和 $\\mu_3^*=0$ 代入 $i=3$ 的平稳性条件：\n    $c_3 + \\lambda^* - 0 + 0 = 0 \\implies \\lambda^* = -c_3 = -55$。\n    市场出清价通常在这种模型中定义为 $-\\lambda^*$，由边际发电机组决定，为 $55$。\n\n-   **对于发电机组 1 ($i=1$)**：出力为 $P_1^*=60 = \\bar{P}_1$。\n    -   $P_1^* > 0 \\implies \\alpha_1^* = 0$。\n    -   约束 $P_1 \\leq \\bar{P}_1$ 是激活的，所以 $\\mu_1^*$ 可以非零。\n    根据 $i=1$ 的平稳性条件：\n    $c_1 + \\lambda^* - \\alpha_1^* + \\mu_1^* = 0 \\implies 14 + (-55) - 0 + \\mu_1^* = 0 \\implies \\mu_1^* = 41$。\n\n-   **对于发电机组 2 ($i=2$)**：出力为 $P_2^*=70 = \\bar{P}_2$。\n    -   $P_2^* > 0 \\implies \\alpha_2^* = 0$。\n    -   约束 $P_2 \\leq \\bar{P}_2$ 是激活的，所以 $\\mu_2^*$ 可以非零。\n    根据 $i=2$ 的平稳性条件：\n    $c_2 + \\lambda^* - \\alpha_2^* + \\mu_2^* = 0 \\implies 27 + (-55) - 0 + \\mu_2^* = 0 \\implies \\mu_2^* = 28$。\n\n最优 KKT 乘子为 $\\lambda^* = -55$，$\\alpha_1^*=\\alpha_2^*=\\alpha_3^*=0$，$\\mu_1^*=41$，$\\mu_2^*=28$ 和 $\\mu_3^*=0$。所有对偶可行性条件（$\\alpha_i^* \\geq 0, \\mu_i^* \\geq 0$）均得到满足。\n\n接下来，我们验证上限约束的互补松弛性条件 $\\mu_i(P_i - \\bar{P}_i) = 0$：\n-   对于 $i=1$：$\\mu_1^*(P_1^* - \\bar{P}_1) = 41(60 - 60) = 41 \\times 0 = 0$。\n-   对于 $i=2$：$\\mu_2^*(P_2^* - \\bar{P}_2) = 28(70 - 70) = 28 \\times 0 = 0$。\n-   对于 $i=3$：$\\mu_3^*(P_3^* - \\bar{P}_3) = 0(30 - 120) = 0 \\times (-90) = 0$。\n所有发电机组的该条件都得到了验证。\n\n最后，我们解释并计算 $\\mu_2$ 的值。乘子 $\\mu_i$ 是容量约束 $P_i \\leq \\bar{P}_i$ 的影子价格。根据约束优化的包络定理，最优目标函数值（我们称之为 $V^*$）对约束右侧项的导数是相应拉格朗日乘子的负值。我们的约束是 $P_i - \\bar{P}_i \\leq 0$。设 $V^*(\\bar{P}_1, \\bar{P}_2, \\bar{P}_3)$ 为最小成本。那么 $\\frac{\\partial V^*}{\\partial \\bar{P}_i} = -\\mu_i^*$。“容量的边际价值”定义为容量每增加一个单位所带来的总成本的减少量。这恰好是 $-\\frac{\\partial V^*}{\\partial \\bar{P}_i}$，也就是等于 $\\mu_i^*$。因此，发电机组 2 的容量边际价值是 $\\mu_2^*$。我们计算出 $\\mu_2^* = 28$。\n\n这个值可以直观地理解。如果发电机组 2 的容量增加一个单位（例如，增加到 71 兆瓦），它就可以以其成本 $c_2 = 27$ 多生产一兆瓦的电力。为了保持功率平衡，最昂贵的发电机组 3 将其产量减少一兆瓦，从而节省其成本 $c_3 = 55$。总成本的净变化将是 $c_2 - c_3 = 27 - 55 = -28$。成本减少了 28，所以额外容量的边际价值是 28。如前所述，这个值的单位是 $\\$/\\mathrm{MWh}$。\n\n发电机组 2 的容量边际价值是 $28$ $\\$/\\mathrm{MWh}$。",
            "answer": "$$\n\\boxed{28}\n$$"
        },
        {
            "introduction": "真实电力系统并非单点，而是由复杂的输电网络构成。本次实践将模型从单节点扩展到一个包含输电约束的三节点网络，向你介绍直流最优潮流 (DC-OPF) 的基本概念。你将通过一个具体的案例，分析当输电线路上出现拥堵时，市场价格如何在不同地点产生差异，从而形成“地点边际电价”(LMP)。这项练习是理解现代电力市场中价格形成机制的关键一步。",
            "id": "4072007",
            "problem": "考虑一个电力系统中的理想化双层市场交互，其中上层参与者提交与其真实边际成本相等的报价，下层独立系统运营商（ISO）通过直流最优潮流（DC-OPF）进行市场出清。下层问题是一个线性规划问题，其具有由功率传输分布因子（PTDF）表示的单一受监控输电约束。系统中有三个母线，索引为 $i \\in \\{1,2,3\\}$，每个母线都有一台发电机和刚性需求。发电机的线性边际成本 $c_i$ 以美元/兆瓦时（$\\$/\\mathrm{MWh}$）为单位，并选择非负的调度功率 $p_i$（单位为兆瓦，MW）。\n\n数据：\n- 需求：$d_1 = 40$ $\\mathrm{MW}$，$d_2 = 40$ $\\mathrm{MW}$，$d_3 = 20$ $\\mathrm{MW}$。\n- 边际成本：$c_1 = 40$ $\\$/\\mathrm{MWh}$，$c_2 = 20$ $\\$/\\mathrm{MWh}$，$c_3 = 10$ $\\$/\\mathrm{MWh}$。\n- 受监控线路 $L$ 的方向为从母线 $1$ 到母线 $2$，其PTDF为 $\\phi_1 = 0.7$，$\\phi_2 = -0.2$，$\\phi_3 = -0.5$。线路潮流为 $f = \\sum_{i=1}^{3} \\phi_i (p_i - d_i)$。\n- 输电极限：上限为 $f \\le \\bar{F}$，其中 $\\bar{F} = 10$ $\\mathrm{MW}$，无其他网络约束。\n- 发电机容量：$0 \\le p_i$，无上限。\n\n下层DC-OPF问题是在满足功率平衡约束 $\\sum_{i=1}^{3} p_i = \\sum_{i=1}^{3} d_i$ 和单条线路极限约束 $f \\le \\bar{F}$ 的前提下，最小化总可变成本 $\\sum_{i=1}^{3} c_i p_i$。节点边际电价（LMP）$\\pi_i$ 定义为从 Karush-Kuhn-Tucker (KKT) 条件中获得的节点影子价格，其中 $\\pi_i = \\lambda + \\mu \\phi_i$，$\\lambda$ 是功率平衡约束的对偶变量，$\\mu \\ge 0$ 是起作用的线路约束 $f \\le \\bar{F}$ 的对偶变量。\n\n任务：\n1. 构建下层DC-OPF问题及其拉格朗日函数，推导KKT条件，并计算最优调度向量 $(p_1, p_2, p_3)$ 和节点边际电价 $(\\pi_1, \\pi_2, \\pi_3)$。\n2. 验证发电机非负性约束和单一的起作用线路极限的对偶可行性和互补松弛性。\n3. 确认计算出的LMP与有功出力发电机的驻定性条件以及未出力发电机的非负松弛性条件一致。\n\n请将您的最终数值答案以一个单行矩阵的形式提供，该矩阵包含 $p_1$、$p_2$、$p_3$（单位为 $\\mathrm{MW}$），后跟 $\\pi_1$、$\\pi_2$、$\\pi_3$（单位为 $\\$/\\mathrm{MWh}$）。无需四舍五入；在方便时使用精确值。最终的方框答案中不要包含单位。",
            "solution": "用户提供的问题经评估有效。该问题基于电力系统经济学和优化的原理，具有科学依据，作为一个线性规划问题是适定的，并且数据完整、陈述客观。\n\n第一步是正式地陈述下层DC-OPF问题。目标是最小化总发电成本，即 $\\sum_{i=1}^{3} c_i p_i$，其中 $p_i$ 是发电机 $i$ 的功率输出，$c_i$ 是其边际成本。决策变量是发电机的调度水平 $p_1, p_2, p_3$。\n\n给定数据如下：\n- 需求：$d_1 = 40$ $\\mathrm{MW}$，$d_2 = 40$ $\\mathrm{MW}$，$d_3 = 20$ $\\mathrm{MW}$。总需求为 $\\sum_{i=1}^{3} d_i = 100$ $\\mathrm{MW}$。\n- 边际成本：$c_1 = 40$ $\\$/\\mathrm{MWh}$，$c_2 = 20$ $\\$/\\mathrm{MWh}$，$c_3 = 10$ $\\$/\\mathrm{MWh}$。\n- PTDF：$\\phi_1 = 0.7$，$\\phi_2 = -0.2$，$\\phi_3 = -0.5$。\n- 输电极限：$\\bar{F} = 10$ $\\mathrm{MW}$。\n\n优化问题是：\n$$\n\\min_{p_1, p_2, p_3} \\quad 40 p_1 + 20 p_2 + 10 p_3\n$$\n约束条件：\n1.  功率平衡：$p_1 + p_2 + p_3 = 100$\n2.  输电极限：$\\sum_{i=1}^{3} \\phi_i (p_i - d_i) \\le \\bar{F}$\n    $0.7(p_1 - 40) - 0.2(p_2 - 40) - 0.5(p_3 - 20) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - (0.7 \\cdot 40 - 0.2 \\cdot 40 - 0.5 \\cdot 20) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - (28 - 8 - 10) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - 10 \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 \\le 20$\n3.  非负性：$p_i \\ge 0$ for $i \\in \\{1, 2, 3\\}$\n\n为推导 Karush-Kuhn-Tucker (KKT) 条件，构建该问题的拉格朗日函数。设 $\\lambda$ 为功率平衡约束的对偶变量，$\\mu$ 为输电极限约束的对偶变量。\n$$\n\\mathcal{L}(p_i; \\lambda, \\mu) = \\sum_{i=1}^{3} c_i p_i - \\lambda\\left(\\sum_{i=1}^{3} p_i - \\sum_{i=1}^{3} d_i\\right) - \\mu\\left(\\bar{F} - \\sum_{i=1}^{3} \\phi_i(p_i-d_i)\\right)\n$$\n最优性的KKT条件将原始变量和对偶变量耦合起来。关于调度变量 $p_i$ 的驻定性条件（假设 $p_i > 0$ 且未达到容量极限）是 $\\frac{\\partial\\mathcal{L}}{\\partial p_i} = 0$，由此得出：\n$$\nc_i - \\lambda + \\mu\\phi_i = 0 \\implies c_i = \\lambda - \\mu\\phi_i\n$$\n问题陈述将母线 $i$ 处的节点边际电价 (LMP) 定义为 $\\pi_i = \\lambda + \\mu\\phi_i$。这里似乎存在一个符号约定差异。在标准的电力系统文献中，拉格朗日函数通常写作 $L = \\sum c_i p_i - \\lambda(\\sum p_i - \\sum d_i) + \\mu(\\sum \\phi_i p_i - \\text{limit})$。根据给定的LMP定义 $\\pi_i = \\lambda + \\mu\\phi_i$，最优性的驻定性条件为：\n- 如果 $p_i > 0$，则 $c_i = \\pi_i = \\lambda + \\mu\\phi_i$。\n- 如果 $p_i = 0$，则 $c_i \\ge \\pi_i = \\lambda + \\mu\\phi_i$。\n此外，对于不等式约束：\n- $\\mu \\ge 0$ 且 $\\mu(\\sum_{i=1}^{3} \\phi_i(p_i-d_i) - \\bar{F}) = 0$。\n\n问题陈述指出 $\\mu$ 是*起作用的*线路约束的对偶变量，这意味着我们应在约束是起作用的（即有效约束）且因此 $\\mu > 0$ 的假设下进行分析。\n当 $\\mu > 0$ 时，LMP因PTDF的不同而有所差异：\n$\\pi_1 = \\lambda + 0.7\\mu$\n$\\pi_2 = \\lambda - 0.2\\mu$\n$\\pi_3 = \\lambda - 0.5\\mu$\n这意味着价格分离：$\\pi_1 > \\pi_2 > \\pi_3$。\n\n该线性规划问题的解将最多有两台发电机被调度，以满足两个起作用的约束（功率平衡和起作用的线路极限）。我们测试两台被调度发电机的不同组合。\n假设1：发电机2和3被调度（$p_2 > 0, p_3 > 0, p_1 = 0$）。\n这要求 $c_2 = \\pi_2$ 和 $c_3 = \\pi_3$。\n$20 = \\lambda - 0.2\\mu$\n$10 = \\lambda - 0.5\\mu$\n两方程相减得到 $10 = 0.3\\mu$，所以 $\\mu = 100/3$。代回计算，$\\lambda = 20 + 0.2(100/3) = 20 + 20/3 = 80/3$。\n现在，我们必须检查未被调度发电机1的条件：$c_1 \\ge \\pi_1$。\n$\\pi_1 = \\lambda + 0.7\\mu = 80/3 + 0.7(100/3) = (80+70)/3 = 150/3 = 50$。\n条件为 $c_1 \\ge \\pi_1 \\implies 40 \\ge 50$，这是错误的。因此，这个假设不正确。\n\n假设2：发电机1和3被调度（$p_1 > 0, p_3 > 0, p_2 = 0$）。\n这要求 $c_1 = \\pi_1$ 和 $c_3 = \\pi_3$。\n$40 = \\lambda + 0.7\\mu$\n$10 = \\lambda - 0.5\\mu$\n两方程相减得到 $30 = 1.2\\mu$，所以 $\\mu = 30/1.2 = 25$。由于 $\\mu > 0$，这与起作用的约束是一致的。\n代回计算，$\\lambda = 10 + 0.5\\mu = 10 + 0.5(25) = 10 + 12.5 = 22.5$。\n现在，检查未被调度发电机2的条件：$c_2 \\ge \\pi_2$。\n$\\pi_2 = \\lambda - 0.2\\mu = 22.5 - 0.2(25) = 22.5 - 5 = 17.5$。\n条件为 $c_2 \\ge \\pi_2 \\implies 20 \\ge 17.5$，这是正确的。这个假设是一致的。\n\n找到了正确的被调度发电机集合和对偶变量后，我们现在求解原始变量 $p_1, p_2, p_3$。\n我们有 $p_2 = 0$ 和两个起作用的约束：\n1. $p_1 + p_3 = 100$\n2. $0.7p_1 - 0.5p_3 = 20$\n由(1)式，$p_1 = 100 - p_3$。代入(2)式：\n$0.7(100 - p_3) - 0.5p_3 = 20$\n$70 - 0.7p_3 - 0.5p_3 = 20$\n$50 = 1.2p_3$\n$p_3 = 50 / 1.2 = 500 / 12 = 125 / 3$。\n然后，$p_1 = 100 - 125/3 = (300 - 125)/3 = 175/3$。\n最优调度为 $(p_1, p_2, p_3) = (175/3, 0, 125/3)$。$p_1$ 和 $p_3$ 均为正，与我们的假设一致。\n\n使用 $\\lambda = 22.5$ 和 $\\mu=25$ 计算节点边际电价：\n$\\pi_1 = \\lambda + \\mu\\phi_1 = 22.5 + 25(0.7) = 22.5 + 17.5 = 40$。\n$\\pi_2 = \\lambda + \\mu\\phi_2 = 22.5 + 25(-0.2) = 22.5 - 5 = 17.5$。\n$\\pi_3 = \\lambda + \\mu\\phi_3 = 22.5 + 25(-0.5) = 22.5 - 12.5 = 10$。\n最优LMP为 $(\\pi_1, \\pi_2, \\pi_3) = (40, 17.5, 10)$。\n\n最后，我们验证剩余的KKT条件。\n- **线路极限的对偶可行性和互补松弛性**：\n对偶可行性要求 $\\mu \\ge 0$，我们求得 $\\mu=25$，该条件成立。\n互补松弛性要求 $\\mu(0.7p_1 - 0.2p_2 - 0.5p_3 - 20)=0$。\n线路潮流项为 $0.7(175/3) - 0.2(0) - 0.5(125/3) - 20 = (122.5 - 62.5)/3 - 20 = 60/3 - 20 = 20 - 20 = 0$。\n条件 $25 \\cdot 0 = 0$ 成立。\n\n- **发电机非负性的对偶可行性和互补松弛性**：这等同于确认LMP的一致性。\n对于有功出力发电机1：$p_1 = 175/3 > 0$。我们检查是否 $c_1 = \\pi_1$。$40 = 40$。这与条件一致。\n对于有功出力发电机3：$p_3 = 125/3 > 0$。我们检查是否 $c_3 = \\pi_3$。$10 = 10$。这与条件一致。\n对于未出力发电机2：$p_2 = 0$。我们检查是否 $c_2 \\ge \\pi_2$。$20 \\ge 17.5$。这与条件一致。\n\n所有KKT条件都已满足。该解是最优解。\n最终结果结合了调度向量 $(p_1, p_2, p_3)$ 和LMP向量 $(\\pi_1, \\pi_2, \\pi_3)$。\n$p_1 = 175/3$ $\\mathrm{MW}$，$p_2 = 0$ $\\mathrm{MW}$，$p_3 = 125/3$ $\\mathrm{MW}$。\n$\\pi_1 = 40$ $\\$/\\mathrm{MWh}$，$\\pi_2 = 17.5$ $\\$/\\mathrm{MWh}$，$\\pi_3 = 10$ $\\$/\\mathrm{MWh}$。\n用分数形式表示，$17.5$ 是 $35/2$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{175}{3} & 0 & \\frac{125}{3} & 40 & \\frac{35}{2} & 10 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在更高级的市场模型中，市场参与者并非总是价格的被动接受者，而是会采取战略性行动以最大化自身利益。本次实践引入了一个双层优化问题，上层是战略性发电商的决策，下层是市场出清，这构成了“带均衡约束的数学规划”(MPEC) 模型。你将探索一种将MPEC问题转化为混合整数线性规划 (MILP) 的常用技术——“大M方法”，并亲身体会如果“M”值选择不当，为何会导致错误的均衡解，从而深刻理解严谨的、基于经济学原理的建模是何等重要。",
            "id": "4071973",
            "problem": "考虑一个单一价格的能源市场，其中一个代表性公司在上层决定装机容量 $K \\geq 0$，而在下层进行集中式市场出清。逆需求函数为 $p(q) = a - b q$，其中 $a > 0$ 且 $b > 0$。该公司具有恒定的边际成本 $c$，并为每单位装机容量支付固定的容量成本 $F$。下层市场出清在满足可行性约束的条件下最大化总盈余。整个问题是一个带均衡约束的数学规划（MPEC），其中市场出清由 Karush–Kuhn–Tucker (KKT) 互补条件刻画。\n\n此实例的数据为 $a = 100$，$b = 2$，$c = 10$ 和 $F = 5$。下层问题是关于决策变量 $q$ 的福利最大化问题，\n$$\n\\max_{q} \\ \\int_{0}^{q} (a - b t) \\, dt - c q \\quad \\text{s.t.} \\quad 0 \\leq q \\leq K,\n$$\n其中 $\\mu \\geq 0$（对应于 $q \\geq 0$）和 $\\lambda \\geq 0$（对应于 $q \\leq K$）是对偶变量。上层选择 $K$ 以在给定价格 $p(q) = a - b q$ 的情况下最大化利润，即\n$$\n\\max_{K \\geq 0} \\ \\pi(K) = p(q) q - c q - F K,\n$$\n其中 $q$ 是给定 $K$ 时下层的最优调度量。\n\n您将分析下层互补条件 $0 \\leq \\lambda \\perp K - q \\geq 0$ 的两种建模方法：\n- 一个不正确的混合整数线性规划（MILP）大M线性化方法，该方法施加约束 $\\lambda \\leq M_{\\lambda} z$ 和 $K - q \\leq U_{q} (1 - z)$，其中 $z \\in \\{0,1\\}$，并使用 $M_{\\lambda} = 20$ 和一个无信息量的界 $U_{q} = 200$。\n- 一个使用从经济学和可行性推导出的紧致界进行修正的大M方法。\n\n任务：\n1. 从福利最大化和 KKT 最优性的基本原理出发，推导求解该双层问题的真实均衡解 $q^{\\star}$ 和 $K^{\\star}$，其中互补性被正确地强制执行（无对偶变量的人为上界）。确定相关的价格 $p^{\\star} = a - b q^{\\star}$。\n2. 展示不正确的大M选择 $M_{\\lambda} = 20$ 如何扭曲下层的 KKT 条件，并计算在这种情况下 MILP 模型将返回的均衡解。解释为什么这个均衡是错误的。\n3. 确定能够保证此例中大M线性化正确性的、经济上有效的紧致界。具体来说，提供并论证一个上界 $\\overline{q}$（对于所有可行均衡满足 $q \\leq \\overline{q}$）和一个相应的安全上界 $\\overline{\\lambda}$（对于所有可行均衡满足 $\\lambda \\leq \\overline{\\lambda}$）。论证使用这些修正后的界可以恢复真实的均衡解。\n\n以 $\\$/\\mathrm{MWh}$ 为单位表示最终价格 $p^{\\star}$。给出精确答案（不要四舍五入）。",
            "solution": "该问题要求分析一个双层市场均衡模型，其结构为带均衡约束的数学规划（MPEC）。我们将按顺序解决三个任务：推导真实均衡，分析一个有缺陷的混合整数线性规划（MILP）模型，以及为 MILP 模型确定正确的界。\n\n给定数据为：$a = 100$，$b = 2$，$c = 10$ 和 $F = 5$。逆需求函数为 $p(q) = a - bq = 100 - 2q$。\n\n### 任务1：真实均衡的推导\n\n真实均衡是通过求解双层问题找到的，其中领导者（公司）预测跟随者（市场运营商）的响应。\n\n**下层问题（市场出清）**\n\n市场运营商在运营约束下最大化社会福利 $W(q)$。福利是需求曲线的积分（总消费者剩余）减去生产成本。\n$$\n\\max_{q} \\ W(q) = \\int_{0}^{q} (a - b t) \\, dt - c q = \\left[at - \\frac{1}{2}bt^2\\right]_0^q - cq = aq - \\frac{1}{2}bq^2 - cq\n$$\n约束条件为 $0 \\leq q \\leq K$。该问题的拉格朗日函数是：\n$$\n\\mathcal{L}(q, \\mu, \\lambda) = aq - \\frac{1}{2}bq^2 - cq + \\mu q - \\lambda(q - K)\n$$\n其中 $\\mu \\geq 0$ 是对应于 $q \\geq 0$ 的对偶变量，$\\lambda \\geq 0$ 是对应于 $q \\leq K$ 的对偶变量。\n\n最优性的 Karush-Kuhn-Tucker (KKT) 条件是：\n1.  **平稳性 (Stationarity):** $\\frac{\\partial \\mathcal{L}}{\\partial q} = a - bq - c + \\mu - \\lambda = 0$。\n2.  **原始可行性 (Primal Feasibility):** $0 \\leq q \\leq K$。\n3.  **对偶可行性 (Dual Feasibility):** $\\mu \\geq 0, \\lambda \\geq 0$。\n4.  **互补性 (Complementarity):** $\\mu q = 0$ 且 $\\lambda(K - q) = 0$。\n\n由于 $a > c$ ($100 > 10$)，第一单位的价格高于成本，因此我们总是有 $q > 0$。因此，条件 $\\mu q = 0$ 意味着 $\\mu = 0$。平稳性条件简化为 $a - bq - c - \\lambda = 0$，或 $\\lambda = a - c - bq$。\n\n我们分析第二个互补条件，$\\lambda(K - q) = 0$：\n-   如果 $\\lambda = 0$，则 $a - c - bq = 0 \\implies q = \\frac{a - c}{b}$。为使此条件有效，必须有 $q < K$（因为如果 $q=K$，$\\lambda$ 可以为正）。所以，如果 $K > \\frac{a-c}{b}$，市场调度量为 $q = \\frac{a-c}{b}$。对于我们的数据，这个数量是 $q_{comp} = \\frac{100-10}{2} = 45$。在这种情况下，市场价格为 $p = a - bq = a - b(\\frac{a-c}{b}) = c = 10$。这是价格等于边际成本的竞争性结果。\n-   如果 $K - q = 0$，则 $q=K$。为使此条件有效，相应的对偶变量必须为非负：$\\lambda = a - c - bK \\geq 0$，这意味着 $K \\leq \\frac{a-c}{b} = 45$。\n\n结合这些情况，作为装机容量 $K$ 函数的市场调度量 $q$ 是：\n$$\nq(K) = \\min\\left(K, \\frac{a-c}{b}\\right) = \\min(K, 45)\n$$\n\n**上层问题（公司利润最大化）**\n\n公司选择其容量 $K \\geq 0$ 以最大化其利润，同时预测市场结果 $q(K)$。利润函数为 $\\pi(K) = p(q(K))q(K) - cq(K) - FK$。\n$$\n\\pi(K) = (a - bq(K))q(K) - cq(K) - FK\n$$\n我们在 $K$ 的两个区域上分析这个函数：\n\n-   **区域 1：$0 \\leq K \\leq 45$。**\n    在这个区域，$q(K) = K$。利润为：\n    $$\n    \\pi(K) = (a - bK)K - cK - FK = (a - c - F)K - bK^2\n    $$\n    代入数据：$\\pi(K) = (100 - 10 - 5)K - 2K^2 = 85K - 2K^2$。\n    这是一个关于 $K$ 的凹二次函数。为了找到最大值，我们将一阶导数设为零：\n    $$\n    \\frac{d\\pi}{dK} = 85 - 4K = 0 \\implies K = \\frac{85}{4} = 21.25\n    $$\n    由于 $0 \\leq 21.25 \\leq 45$，这是该区域内的最优容量。我们称之为 $K^{\\star} = 21.25$。\n    该区域的最大利润为 $\\pi(21.25) = 85(21.25) - 2(21.25)^2 = 1806.25 - 903.125 = 903.125$。\n\n-   **区域 2：$K > 45$。**\n    在这个区域，$q(K) = 45$。利润为：\n    $$\n    \\pi(K) = (a - b(45))(45) - c(45) - FK\n    $$\n    由于 $p(45) = 100 - 2(45) = 10 = c$，运营利润为零：$(p(45)-c) \\times 45 = 0$。\n    因此，$\\pi(K) = -FK = -5K$。\n    这个函数对于 $K > 45$ 是严格递减的。该区域的最高利润在边界 $K \\to 45^{+}$ 处取得，得到 $\\pi(45) = -5(45) = -225$。\n\n比较两个区域的最优利润（$903.125$ 对比 $-225$），公司的最优选择是 $K^{\\star} = 21.25$。\n\n**均衡结果：**\n-   最优容量：$K^{\\star} = 21.25$。\n-   均衡数量：由于 $K^{\\star} \\leq 45$，$q^{\\star} = K^{\\star} = 21.25$。\n-   均衡价格：$p^{\\star} = a - bq^{\\star} = 100 - 2(21.25) = 100 - 42.5 = 57.5$。\n\n### 任务2：不正确的大M模型的分析\n\nMPEC 模型用使用 $z \\in \\{0, 1\\}$ 的大M约束替换了互补条件 $\\lambda(K-q) = 0$：\n1.  $\\lambda \\leq M_{\\lambda} z$\n2.  $K - q \\leq U_q (1-z)$\n给定不正确的值 $M_{\\lambda} = 20$ 和 $U_q = 200$。\n\n公司在 KKT 条件下最大化 $\\pi = (a-c)q - bq^2 - FK$，这些条件现在包括大M约束以及 $bq = a-c-\\lambda$（其中 $\\mu=0$）、$q \\ge 0$、$\\lambda \\ge 0$ 和 $K \\ge q$。代入 $\\lambda = a-c-bq = 90-2q$，完整的问题是最大化 $\\pi = 90q - 2q^2 - 5K$，约束条件为：\n-   $K \\geq q$\n-   $90 - 2q \\geq 0 \\implies q \\leq 45$\n-   $90 - 2q \\leq 20 z$\n-   $K - q \\leq 200(1-z)$\n-   $K \\geq 0, q \\geq 0, z \\in \\{0,1\\}$\n\n我们按二元变量 $z$ 的情况进行分析：\n\n-   **情况 $z = 1$：**\n    约束变为：$K \\geq q$，$q \\leq 45$，$90 - 2q \\leq 20 \\implies 70 \\leq 2q \\implies q \\geq 35$，以及 $K-q \\leq 0 \\implies K=q$。\n    因此，我们必须有 $K=q$ 和 $35 \\leq K \\leq 45$。\n    公司的问题是在区间 $[35, 45]$ 上最大化 $\\pi(K) = (a-c-F)K - bK^2 = 85K - 2K^2$。\n    这个抛物线的无约束最大值点在 $K=21.25$。由于该点在区间 $[35, 45]$ 之外且在其左侧，函数在此区间上是递减的。最大值在最左侧的点取得，即 $K = 35$。\n    此情况的解为 $(K, q) = (35, 35)$，利润为 $\\pi(35) = 85(35) - 2(35^2) = 2975 - 2450 = 525$。\n\n-   **情况 $z = 0$：**\n    约束变为：$K \\geq q$，$q \\leq 45$，$90 - 2q \\leq 0 \\implies q \\geq 45$，以及 $K-q \\leq 200$。\n    数量约束意味着 $q=45$。容量约束为 $K \\geq 45$。\n    利润函数为 $\\pi(K) = 90(45) - 2(45^2) - 5K = 4050 - 4050 - 5K = -5K$。\n    为了在 $K \\geq 45$ 时最大化 $-5K$，公司选择最小可能的值，即 $K=45$。\n    此情况的解为 $(K, q) = (45, 45)$，利润为 $\\pi(45) = -5(45) = -225$。\n\n比较两种情况的利润（$525$ 对比 $-225$），有缺陷的 MILP 模型的解为 $(K, q) = (35, 35)$。由此产生的价格为 $p = 100 - 2(35) = 30$。\n\n**错误解释：**\n这个结果是不正确的，因为选择的 $M_{\\lambda}=20$ 太小了。在真实均衡点 $(K^{\\star}, q^{\\star}) = (21.25, 21.25)$，我们有 $K-q=0$，这在大M模型中强制 $z=1$。真实的对偶变量是 $\\lambda^{\\star} = a - c - bq^{\\star} = 100 - 10 - 2(21.25) = 47.5$。大M约束 $\\lambda \\leq M_{\\lambda} z$ 变为 $\\lambda \\leq 20(1)$，即 $\\lambda \\leq 20$。由于 $\\lambda^{\\star} = 47.5 > 20$，真实的均衡解在这个有缺陷的模型下是不可行的。该模型被人为地强制去寻找一个满足过于严格的约束 $\\lambda \\leq 20$ 的次优解。这对应于 $a-c-bq \\leq 20 \\implies 90-2q \\leq 20 \\implies q \\geq 35$，这就解释了为什么模型选择该范围内的最小可能数量 $q=35$。\n\n### 任务3：紧致界的推导\n\n为确保大M模型的正确性，常数 $M_{\\lambda}$ 和 $U_q$ 必须分别是 $\\lambda$ 和 $K-q$ 在所有可行解集合上的有效上界。\n\n**数量的上界, $\\overline{q}$：**\n下层问题是在区间 $[0, K]$ 上最大化凹福利函数 $W(q) = (a-c)q - \\frac{1}{2}bq^2 = 90q - q^2$。$W(q)$ 的无约束最大值出现在 $q = \\frac{a-c}{b} = 45$。因此，有约束问题的解 $q(K) = \\min(K, 45)$ 永远不会超过这个值。一个有效且紧致的调度量上界是 $\\overline{q} = \\frac{a-c}{b} = 45$。一个理性的公司不会建造超过 $\\overline{q}$ 的容量 $K$，因为这会导致负利润。因此，$K-q$ 的一个有效上界是 $\\overline{q} - 0 = 45$。一个安全的选择是 $U_q = 45$。\n\n**对偶变量的上界, $\\overline{\\lambda}$：**\n根据 KKT 平稳性条件，$\\lambda = a - c - bq$（因为 $q>0 \\implies \\mu=0$）。为了找到 $\\lambda$ 的上界，我们需要 $q$ 的下界。数量 $q$ 是物理非负的，$q \\geq 0$。因此：\n$$\n\\lambda = a - c - bq \\leq a - c - b(0) = a - c\n$$\n$\\lambda$ 的一个有效上界是 $\\overline{\\lambda} = a - c = 100 - 10 = 90$。这个界对应于第一单位容量的影子价格，即市场抑制价格与边际成本之差。\n\n**使用紧致界的正确性：**\n使用有效界 $M_{\\lambda} = \\overline{\\lambda} = 90$ 和 $U_q = 45$，大M约束为：\n1.  $\\lambda \\leq 90 z$\n2.  $K - q \\leq 45 (1-z)$\n\n我们来检查真实均衡解在这个修正后的模型中是否可行。真实解为 $(K^{\\star}, q^{\\star})=(21.25, 21.25)$，对应的 $\\lambda^{\\star} = 47.5$。\n-   在这个解上，$K-q = 0$。约束 $K - q \\leq 45(1-z)$ 变为 $0 \\leq 45(1-z)$，这要求 $z=1$。\n-   当 $z=1$ 时，第一个约束变为 $\\lambda \\leq 90$。\n-   真实的对偶变量值 $\\lambda^{\\star} = 47.5$ 满足这个条件，因为 $47.5 \\leq 90$。\n\n因为真实最优解是使用这些紧致界的 MPEC 搜索空间中的一个可行点，并且目标函数相同，所以精确的 MILP 求解器保证能够找到这个真实的全局最优解。使用经济学推导的有效界确保了双层问题重构的完整性。\n\n来自真实均衡（任务1）的最终价格 $p^{\\star}$ 是 $57.5$ $/MWh$。",
            "answer": "$$\n\\boxed{57.5}\n$$"
        }
    ]
}