{
    "hands_on_practices": [
        {
            "introduction": "在理想化的电力市场中，边际定价可以有效地引导资源。然而，现实世界中的发电机组存在最小出力、启动成本等非凸性约束，这使得情况变得复杂。本练习  将通过一个具体案例，揭示辅助服务需求如何迫使昂贵的机组启动，以及在这种情况下，为何需要“增补付款”（uplift payment）来弥补其市场收益无法覆盖的成本，从而帮助您理解联合优化的一个核心经济挑战。",
            "id": "4078317",
            "problem": "考虑一个电力系统中单周期、单母线的能量和旋转备用联合优化问题。系统运营商必须同时满足固定的能量需求和旋转备用要求。该系统包含两种资源：\n\n1. 一台风电机组，其可变能量成本为 $c_{W} = 0$ 美元/兆瓦时，最大可用功率为 $P_{W}^{\\max} = 100$ 兆瓦，且不具备提供旋转备用的能力。\n\n2. 一台火电机组，其可变能量成本为 $c_{T} = 40$ 美元/兆瓦时，最小稳定出力为 $P_{T}^{\\min} = 15$ 兆瓦，最大出力为 $P_{T}^{\\max} = 75$ 兆瓦，其向上旋转备用能力受限于 $R_{T} \\leq P_{T}^{\\max} - P_{T}$。该火电机组的空载成本为 $F = 600$ 美元/小时，启动成本为 $S = 900$ 美元/次。假设该火电机组从离线状态启动。\n\n设能量需求为 $D = 100$ 兆瓦，旋转备用要求为 $R^{\\mathrm{req}} = 30$ 兆瓦。假设除了容量裕度约束所隐含的机会成本外，提供备用没有单独的边际成本。\n\n从最低成本调度和联合优化的第一性原理出发：将原问题建模为在满足能量平衡、备用要求和机组能力约束（包括最小出力和备用能力）的条件下，最小化总生产成本。并将价格定义为在给定启停状态下，凸松弛问题中相应约束的拉格朗日乘子。\n\n在标准边际定价下，系统以节点边际电价（LMP）支付能量费用，以旋转备用出清价格（SRCP）支付备用费用。定义补偿（uplift）为确保火电机组在一个结算周期内的净利润为零所需的最小非负支付额，当其在边际价格下的市场收入（能量加备用）不足以覆盖其实际成本（可变能量成本、空载成本和启动成本）时。\n\n构建并分析联合优化调度，以展示一个案例，在该案例中，即使能量LMP低于火电机组的边际能量成本，旋转备用要求仍驱动了火电机组的启动。分别从能量平衡和备用要求的拉格朗日对偶变量推导出LMP和SRCP，并计算火电机组在一小时结算周期内所需的补偿。最终补偿以美元表示。无需四舍五入；提供精确值。",
            "solution": "在尝试求解之前，将根据指定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n-   风电机组可变成本：$c_{W} = 0$ 美元/兆瓦时\n-   风电机组最大功率：$P_{W}^{\\max} = 100$ 兆瓦\n-   风电机组备用能力：$0$\n-   火电机组可变成本：$c_{T} = 40$ 美元/兆瓦时\n-   火电机组最小稳定出力：$P_{T}^{\\min} = 15$ 兆瓦\n-   火电机组最大出力：$P_{T}^{\\max} = 75$ 兆瓦\n-   火电机组向上旋转备用能力：$R_{T} \\leq P_{T}^{\\max} - P_{T}$\n-   火电机组空载成本：$F = 600$ 美元/小时\n-   火电机组启动成本：$S = 900$ 美元/次（从离线状态）\n-   能量需求：$D = 100$ 兆瓦\n-   旋转备用要求：$R^{\\mathrm{req}} = 30$ 兆瓦\n-   结算周期：$1$ 小时\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，提法明确且客观。这是一个标准的、尽管经过简化的机组组合和经济调度问题，源于电力系统工程和电力市场设计领域。参数是自洽且一致的，术语（LMP, SRCP, uplift）在该领域内是标准的。该问题不违反任何科学原理，不是比喻性的，不是不完整或矛盾的，并且不是微不足道的。它展示了一个经典案例，说明了在具有非凸发电机约束的市场中需要补偿支付（uplift payments）。\n\n### 步骤3：结论与行动\n问题有效。将提供解决方案。\n\n系统运营商旨在最小化的总系统成本，是已启动机组的成本之和。火电机组的成本包括启动成本、空载成本（如果启动）和可变能量成本。风电机组只有可变能量成本。令 $u_T \\in \\{0, 1\\}$ 为火电机组的二进制启停变量，其中 $u_T=1$ 表示机组在线，$u_T=0$ 表示机组离线。令 $P_W$ 和 $P_T$ 分别为风电和火电机组的调度能量，令 $R_T$ 为火电机组提供的旋转备用。\n\n该联合优化问题可以表述为混合整数线性规划：\n$$\n\\min_{u_T, P_W, P_T, R_T} \\quad C = c_W P_W + c_T P_T + u_T (F + S)\n$$\n约束条件：\n1.  能量平衡：$P_W + P_T = D$\n2.  备用要求：$R_T \\ge R^{\\mathrm{req}}$（因为只有火电机组提供备用）\n3.  风电机组容量：$0 \\le P_W \\le P_W^{\\max}$\n4.  火电机组容量：$u_T P_T^{\\min} \\le P_T \\le u_T P_T^{\\max}$\n5.  火电机组备用容量裕度：$P_T + R_T \\le u_T P_T^{\\max}$\n6.  备用非负性：$R_T \\ge 0$\n7.  二进制启停变量：$u_T \\in \\{0, 1\\}$\n\n代入给定值：\n$$\n\\min_{u_T, P_W, P_T, R_T} \\quad C = (0) P_W + 40 P_T + u_T (600 + 900) = 40 P_T + 1500 u_T\n$$\n约束条件：\n1.  $P_W + P_T = 100$\n2.  $R_T \\ge 30$\n3.  $0 \\le P_W \\le 100$\n4.  $15 u_T \\le P_T \\le 75 u_T$\n5.  $P_T + R_T \\le 75 u_T$\n\n我们通过考虑 $u_T$ 的两种可能情况来解决这个问题。\n\n情况1：火电机组离线 ($u_T = 0$)。\n约束条件变为：$P_T = 0$ 和 $R_T = 0$。\n备用要求 $R_T \\ge 30$ 变为 $0 \\ge 30$，这是不成立的。\n因此，这种情况是不可行的。必须启动火电机组以满足旋转备用要求。\n\n情况2：火电机组在线 ($u_T = 1$)。\n问题变为一个寻找最优调度的线性规划：\n$$\n\\min_{P_W, P_T, R_T} \\quad C = 40 P_T + 1500\n$$\n约束条件：\n1.  $P_W + P_T = 100$\n2.  $R_T \\ge 30$\n3.  $0 \\le P_W \\le 100$\n4.  $15 \\le P_T \\le 75$\n5.  $P_T + R_T \\le 75$\n\n为了最小化成本 $C$，我们必须最小化 $P_T$。\n根据能量平衡，$P_W = 100 - P_T$。将其代入风电容量约束，得到 $0 \\le 100 - P_T \\le 100$，这意味着 $0 \\le P_T \\le 100$。结合火电机组的容量约束（$15 \\le P_T \\le 75$），$P_T$ 的有效范围是 $[15, 75]$。\n目标函数在 $P_T$ 的最低可能值处最小化，即 $P_T^* = 15$ 兆瓦。\n我们来检查这个调度是否满足备用约束。\n当 $P_T^* = 15$ 时，备用容量裕度约束为 $15 + R_T \\le 75$，这意味着 $R_T \\le 60$。\n系统要求 $R_T \\ge 30$。\n由于范围 $[30, 60]$ 对 $R_T$ 是有效的，因此存在可行解。系统运营商将采购所需的最小量，因此 $R_T^* = 30$ 兆瓦。\n相应的风电调度为 $P_W^* = 100 - P_T^* = 100 - 15 = 85$ 兆瓦。这在风电机组的容量范围内。\n\n最优调度为：$P_T^* = 15$ 兆瓦, $P_W^* = 85$ 兆瓦, 以及 $R_T^* = 30$ 兆瓦。\n该调度表明，尽管有足够便宜的风电容量来满足全部能量需求，但由于备用要求，火电机组仍被启动 ($u_T=1$)。\n总系统成本为 $C^* = 40(15) + 1500 = 600 + 1500 = 2100$ 美元。\n\n接下来，我们从松弛后的线性规划（$u_T=1$）的对偶问题中推导出市场出清价格，即LMP和SRCP。目标函数的可变成本部分是 $40 P_T$。\n设 $\\lambda$ 是能量平衡约束的拉格朗日乘子（LMP），$\\mu$ 是备用要求约束的乘子（SRCP）。\n\n可变成本最小化的拉格朗日函数是：\n$L = 40 P_T - \\lambda(P_W + P_T - 100) - \\mu(R_T - 30) - \\nu(75 - P_T - R_T) - \\alpha(P_T - 15) - ...$ （包括所有约束的乘子）。\n最优性的 Karush-Kuhn-Tucker (KKT) 条件包括：\n$\\frac{\\partial L}{\\partial P_W} = -\\lambda - \\gamma_W = 0$，其中 $\\gamma_W$ 是风电容量的乘子，由于 $P_W^* = 85 < P_W^{\\max}=100$，所以 $\\gamma_W = 0$。因此，$\\lambda=0$。\n$\\frac{\\partial L}{\\partial P_T} = 40 - \\lambda - \\alpha + \\nu = 0$，其中 $\\alpha$ 对应 $P_T \\ge 15$，$\\nu$ 对应 $P_T+R_T \\le 75$。\n$\\frac{\\partial L}{\\partial R_T} = -\\mu + \\nu = 0 \\implies \\mu = \\nu$。\n\n在最优解处（$P_T^*=15$, $R_T^*=30$）：\n-   能量价格是LMP，即 $\\lambda$。由于能量的边际机组是风电（$c_W=0$），并且它有备用容量（$P_W^*=85 < P_W^{\\max}=100$），因此增加一兆瓦能量的成本为零。因此，LMP = $0$ 美元/MWh。\n-   备用价格是SRCP，即 $\\mu$。在最优点，$P_T^* + R_T^* = 15 + 30 = 45 < 75$。火电机组有备用容量来提供更多备用，而无需减少其能量输出。约束 $P_T+R_T \\le 75$ 不是紧约束，因此其对偶变量 $\\nu = 0$。由于 $\\mu=\\nu$，所以 SRCP = $0$ 美元/MWh。\n\nLMP $=0$ 和 SRCP $=0$ 这个结果是基于松弛凸问题定价的后果，其中非凸的最小出力约束是调度的主要驱动因素，但其成本未在边际价格中反映出来。\n\n最后，我们计算火电机组的补偿（uplift）。补偿是为了覆盖未能通过能量和备用市场收回的成本而需要的支付。\n火电机组的市场收入：\n$$\n\\text{收入} = (\\text{LMP} \\times P_T^*) + (\\text{SRCP} \\times R_T^*) = (0 \\text{ 美元/MWh} \\times 15 \\text{ MW}) + (0 \\text{ 美元/MWh} \\times 30 \\text{ MW}) = 0 \\text{ 美元}\n$$\n计算是针对1小时的周期。\n火电机组的总成本：\n$$\n\\text{成本} = (\\text{可变成本}) + (\\text{空载成本}) + (\\text{启动成本})\n$$\n$$\n\\text{成本} = (c_T \\times P_T^*) + F + S = (40 \\text{ 美元/MWh} \\times 15 \\text{ MW}) + 600 \\text{ 美元} + 900 \\text{ 美元} = 600 \\text{ 美元} + 600 \\text{ 美元} + 900 \\text{ 美元} = 2100 \\text{ 美元}\n$$\n该机组的市场运营利润为 收入 - 成本 = $0$ 美元 - $2100$ 美元 = $-2100$ 美元。\n补偿支付必须使净利润为零。\n$$\n\\text{补偿} = -(\\text{利润}) = -(-2100 \\text{ 美元}) = 2100 \\text{ 美元}\n$$",
            "answer": "$$\\boxed{2100}$$"
        },
        {
            "introduction": "储能系统，特别是电池，因其快速响应和高度灵活性，在现代电网中扮演着日益重要的角色。它们能够同时提供能量和多种辅助服务，实现“收益叠加”。本练习  将指导您如何构建一个电池联合优化模型，该模型考虑了功率、能量、效率和退化成本等物理与经济特性，旨在找到在多个服务市场中的最优容量分配策略。",
            "id": "4078365",
            "problem": "您需要形式化并求解一个协同优化问题，其中单个电化学电池在单个小时间隔内同时提供应急备用和调频服务。决策变量是调频容量 $r$（单位为 $\\mathrm{MW}$）和应急备用容量 $c$（单位为 $\\mathrm{MW}$）。该电池的特性包括最大充放电功率额定值 $P_{\\max}$（单位为 $\\mathrm{MW}$）和能量裕度 $S$（单位为 $\\mathrm{MWh}$），该能量裕度可用于小时内（相对于基线能量调度）的非计划调度。该电池的往返效率为 $\\eta \\in (0,1)$，并会产生与绝对能量吞吐量成正比的退化成本。调频容量获得容量支付 $\\pi^{\\mathrm{reg}}$（单位为 货币单位/MW/小时），应急备用容量获得容量支付 $\\pi^{\\mathrm{cont}}$（单位为 货币单位/MW/小时）。退化成本参数 $c_{\\mathrm{deg}}$ 以 货币单位/MWh（绝对能量吞吐量）给出。\n\n基本原理和物理现实性：\n- 小时内与任何服务相关的绝对能量吞吐量定义为放电能量的大小与返回初始充电状态所需的再充电能量的大小之和。根据能量守恒和往返效率的定义，如果电池放电 $x$（单位为 $\\mathrm{MWh}$）并且必须返回初始充电状态，则所需的再充电能量为 $x/\\eta$。因此，与该事件相关的绝对吞吐量为 $x + x/\\eta$。\n- 对于调频服务，令 $\\gamma$（单位为 MWh/MW/小时）表示每 MW 调频容量在小时内的预期放电侧能量调度；这个 $\\gamma$ 捕捉了放电侧的统计强度（有时称为里程）。对于应急备用服务，令 $p$ 为小时内的激活概率， $d$ 为激活条件下的预期激活持续时间（单位为小时）；那么每 MW 应急备用容量的预期放电侧能量为 $p \\cdot d$。请使用上述能量守恒原理，将这些放电侧能量映射为每种产品的每 MW 绝对吞吐量。\n- 能量裕度 $S$ 必须足以在所选容量下将电池保持在允许的充电状态限制内。为抽象不同的运行策略，假设存在固定的能量裕度系数 $e^{\\mathrm{reg}}$（单位为 MWh/MW）和 $e^{\\mathrm{cont}}$（单位为 MWh/MW），使得 $e^{\\mathrm{reg}} \\cdot r + e^{\\mathrm{cont}} \\cdot c \\le S$ 能强制满足所选容量下的能量限制可行性。这是在规划层面上用于充电状态可行性的标准线性鲁棒性替代模型。\n\n您的任务：\n- 将此协同优化问题形式化为一个关于 $r$ 和 $c$ 的、受物理约束的小时净利润最大化问题。净利润目标是容量收入总和减去根据绝对吞吐量计算的退化成本。您必须仅使用上述基本定义来构建吞吐量和约束条件；不得假设任何超出这些基础知识的外部捷径。\n- 可行集必须包括功率约束 $r + c \\le P_{\\max}$ 和能量裕度约束 $e^{\\mathrm{reg}} \\cdot r + e^{\\mathrm{cont}} \\cdot c \\le S$，以及非负约束 $r \\ge 0$ 和 $c \\ge 0$。\n- 对于每个测试用例，计算在给定参数下使净利润最大化的最优对 $(r^{\\star}, c^{\\star})$。\n\n单位和输出：\n- 将 $r^{\\star}$ 和 $c^{\\star}$ 以 $\\mathrm{MW}$ 为单位表示，并四舍五入到三位小数。\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，格式为列表的列表，每个内部列表为 $[r^{\\star}, c^{\\star}]$。例如，格式必须与 $[[r_1,c_1],[r_2,c_2],\\dots]$ 完全一样，数字采用十进制形式。\n\n测试套件：\n使用以下四个测试用例来验证模型和算法。每个测试用例指定了 $(P_{\\max}, S, \\eta, c_{\\mathrm{deg}}, \\pi^{\\mathrm{reg}}, \\pi^{\\mathrm{cont}}, \\gamma, p, d, e^{\\mathrm{reg}}, e^{\\mathrm{cont}})$ 及其所示单位。\n- 案例1（理想情况，功率受限且偏向调频）：$P_{\\max} = 100\\,\\mathrm{MW}$，$S = 40\\,\\mathrm{MWh}$，$\\eta = 0.9$，$c_{\\mathrm{deg}} = 10$，$\\pi^{\\mathrm{reg}} = 30$，$\\pi^{\\mathrm{cont}} = 15$，$\\gamma = 0.5$，$p = 0.1$，$d = 0.25$，$e^{\\mathrm{reg}} = 0.2$，$e^{\\mathrm{cont}} = 0.25$。\n- 案例2（能量约束起作用，调频边际利润为负，偏向应急备用）：$P_{\\max} = 100\\,\\mathrm{MW}$，$S = 40\\,\\mathrm{MWh}$，$\\eta = 0.9$，$c_{\\mathrm{deg}} = 40$，$\\pi^{\\mathrm{reg}} = 30$，$\\pi^{\\mathrm{cont}} = 15$，$\\gamma = 0.5$，$p = 0.1$，$d = 0.25$，$e^{\\mathrm{reg}} = 0.2$，$e^{\\mathrm{cont}} = 0.5$。\n- 案例3（能量严格受限，应急备用更有价值）：$P_{\\max} = 100\\,\\mathrm{MW}$，$S = 10\\,\\mathrm{MWh}$，$\\eta = 0.9$，$c_{\\mathrm{deg}} = 10$，$\\pi^{\\mathrm{reg}} = 20$，$\\pi^{\\mathrm{cont}} = 25$，$\\gamma = 0.5$，$p = 0.1$，$d = 0.25$，$e^{\\mathrm{reg}} = 0.25$，$e^{\\mathrm{cont}} = 0.3$。\n- 案例4（两者边际利润均为负，零解）：$P_{\\max} = 100\\,\\mathrm{MW}$，$S = 40\\,\\mathrm{MWh}$，$\\eta = 0.9$，$c_{\\mathrm{deg}} = 300$，$\\pi^{\\mathrm{reg}} = 20$，$\\pi^{\\mathrm{cont}} = 10$，$\\gamma = 0.5$，$p = 0.1$，$d = 0.25$，$e^{\\mathrm{reg}} = 0.2$，$e^{\\mathrm{cont}} = 0.25$。\n\n算法要求：\n实现一个算法，对于每个测试用例，仅使用上述能量守恒和往返效率定义计算调频和应急备用的每 MW 绝对吞吐量，构建线性净利润目标函数，并在多面体可行域上找到最优解 $(r^{\\star}, c^{\\star})$。该算法必须在上述所有情况下（包括边界和边缘情况）都是正确的。最终程序必须是自包含的，并生成包含 $[[r_1,c_1],[r_2,c_2],[r_3,c_3],[r_4,c_4]]$ 的指定单行输出，所有值均以 $\\mathrm{MW}$ 为单位，并四舍五入到三位小数。",
            "solution": "该问题要求建立并求解一个线性优化问题，以最大化同时提供调频和应急备用服务的电池系统的净利润。求解过程首先从所提供的基本原理出发，构建目标函数和约束条件。\n\n决策变量是调频容量 $r$（单位为 $\\mathrm{MW}$）和应急备用容量 $c$（单位为 $\\mathrm{MW}$）。目标是最大化小时净利润 $Z$，即容量支付的总收入减去预期的总退化成本。\n\n$Z(r, c) = \\text{收入}(r, c) - \\text{成本}(r, c)$\n\n**1. 收入模型构建**\n\n收入是各项服务容量支付的总和。\n- 调频服务收入：$\\pi^{\\mathrm{reg}} \\cdot r$\n- 应急备用服务收入：$\\pi^{\\mathrm{cont}} \\cdot c$\n总收入 $= \\pi^{\\mathrm{reg}} r + \\pi^{\\mathrm{cont}} c$\n\n**2. 退化成本模型构建**\n\n退化成本与预期的总绝对能量吞吐量成正比，成本参数为 $c_{\\mathrm{deg}}$。\n总成本 $= c_{\\mathrm{deg}} \\cdot (\\text{预期吞吐量}_{\\mathrm{reg}} + \\text{预期吞吐量}_{\\mathrm{cont}})$\n\n问题陈述，对于 $x$ $\\mathrm{MWh}$ 的放电，由于往返效率为 $\\eta$，返回初始充电状态所需的再充电量为 $x/\\eta$ $\\mathrm{MWh}$。因此，此循环的绝对能量吞吐量为 $x + x/\\eta = x(1 + 1/\\eta)$。我们将此原理应用于两种服务。\n\n- **调频服务吞吐量**：\n  每 MW 调频容量的预期放电侧能量为 $\\gamma$。对于承诺容量 $r$ $\\mathrm{MW}$，总预期放电量为 $x_{\\mathrm{reg}} = \\gamma \\cdot r$。\n  调频服务的预期绝对吞吐量为 $x_{\\mathrm{reg}}(1 + 1/\\eta) = \\gamma r (1 + 1/\\eta)$。\n  令 $\\tau^{\\mathrm{reg}} = \\gamma (1 + 1/\\eta)$ 为调频服务的单位吞吐量（单位为 $\\mathrm{MWh/MW}$）。\n\n- **应急备用服务吞吐量**：\n  每 MW 应急备用容量的预期放电侧能量是激活概率 $p$ 和预期持续时间 $d$ 的乘积，即 $p \\cdot d$。对于承诺容量 $c$ $\\mathrm{MW}$，总预期放电量为 $x_{\\mathrm{cont}} = (p \\cdot d) \\cdot c$。\n  应急备用服务的预期绝对吞吐量为 $x_{\\mathrm{cont}}(1 + 1/\\eta) = (p \\cdot d) c (1 + 1/\\eta)$。\n  令 $\\tau^{\\mathrm{cont}} = p \\cdot d (1 + 1/\\eta)$ 为应急备用服务的单位吞吐量（单位为 $\\mathrm{MWh/MW}$）。\n\n总退化成本为 $c_{\\mathrm{deg}}(\\tau^{\\mathrm{reg}} r + \\tau^{\\mathrm{cont}} c)$。\n\n**3. 净利润目标函数**\n\n结合收入和成本，净利润函数为：\n$Z(r, c) = (\\pi^{\\mathrm{reg}} r + \\pi^{\\mathrm{cont}} c) - c_{\\mathrm{deg}}(\\tau^{\\mathrm{reg}} r + \\tau^{\\mathrm{cont}} c)$\n\n按决策变量 $r$ 和 $c$ 对各项进行分组：\n$Z(r, c) = (\\pi^{\\mathrm{reg}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{reg}}) r + (\\pi^{\\mathrm{cont}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{cont}}) c$\n\n我们为每项服务定义净边际利润：\n- $m^{\\mathrm{reg}} = \\pi^{\\mathrm{reg}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{reg}} = \\pi^{\\mathrm{reg}} - c_{\\mathrm{deg}} \\gamma (1 + 1/\\eta)$\n- $m^{\\mathrm{cont}} = \\pi^{\\mathrm{cont}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{cont}} = \\pi^{\\mathrm{cont}} - c_{\\mathrm{deg}} p d (1 + 1/\\eta)$\n\n目标函数简化为最大化 $Z(r, c) = m^{\\mathrm{reg}} r + m^{\\mathrm{cont}} c$。\n\n**4. 约束条件**\n\n该优化问题受以下物理和运行约束：\n1.  **功率约束**：承诺的总容量不能超过电池的功率额定值：$r + c \\le P_{\\max}$。\n2.  **能量裕度约束**：提供的容量必须有足够的能量裕度支持：$e^{\\mathrm{reg}} r + e^{\\mathrm{cont}} c \\le S$。\n3.  **非负性**：容量不能为负：$r \\ge 0$ 和 $c \\ge 0$。\n\n**5. 线性规划模型**\n\n完整的协同优化问题是一个线性规划（LP）问题：\n$$\n\\begin{align*}\n\\text{maximize}_{r, c} \\quad  m^{\\mathrm{reg}} r + m^{\\mathrm{cont}} c \\\\\n\\text{subject to} \\quad  r + c \\le P_{\\max} \\\\\n e^{\\mathrm{reg}} r + e^{\\mathrm{cont}} c \\le S \\\\\n r \\ge 0 \\\\\n c \\ge 0\n\\end{align*}\n$$\n\n**6. 求解方法**\n\n这是一个二维线性规划问题。由线性不等式定义的可行域是 $(r, c)$ 平面上的一个凸多边形。线性规划的一个基本定理指出，如果存在最优解，它必然出现在该可行域的一个顶点上。\n\n找到最优解 $(r^{\\star}, c^{\\star})$ 的算法如下：\n1.  对每个测试用例，计算净边际利润 $m^{\\mathrm{reg}}$ 和 $m^{\\mathrm{cont}}$。\n2.  确定可行多边形的顶点。顶点是位于可行域内的约束边界线的交点。这些顶点包括：\n    - 原点：$(0, 0)$。\n    - $r$轴截距，由 $(\\min(P_{\\max}, S/e^{\\mathrm{reg}}), 0)$ 给出。\n    - $c$轴截距，由 $(0, \\min(P_{\\max}, S/e^{\\mathrm{cont}}))$ 给出。\n    - 两条主要约束线 $r + c = P_{\\max}$ 和 $e^{\\mathrm{reg}} r + e^{\\mathrm{cont}} c = S$ 的交点。仅当该点的两个坐标均为非负时，它才是一个顶点。\n3.  在每个顶点处评估目标函数 $Z(r, c)$ 的值。\n4.  最优解 $(r^{\\star}, c^{\\star})$ 是产生最大目标函数值的顶点。如果所有边际利润都非正，则最优解为 $(0, 0)$。所实现的算法通过在所有顶点中找到最大值来正确处理所有情况。\n将此过程应用于每个测试用例，以确定其最优容量分配。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the battery co-optimization problem for a given set of test cases.\n    \"\"\"\n    # Test cases: (P_max, S, eta, c_deg, pi_reg, pi_cont, gamma, p, d, e_reg, e_cont)\n    test_cases = [\n        # Case 1: happy path, power-limited to regulation\n        (100.0, 40.0, 0.9, 10.0, 30.0, 15.0, 0.5, 0.1, 0.25, 0.2, 0.25),\n        # Case 2: energy binding with negative regulation margin, contingency preferred\n        (100.0, 40.0, 0.9, 40.0, 30.0, 15.0, 0.5, 0.1, 0.25, 0.2, 0.5),\n        # Case 3: strongly energy-limited, contingency more valuable\n        (100.0, 10.0, 0.9, 10.0, 20.0, 25.0, 0.5, 0.1, 0.25, 0.25, 0.3),\n        # Case 4: both margins negative, zero solution\n        (100.0, 40.0, 0.9, 300.0, 20.0, 10.0, 0.5, 0.1, 0.25, 0.2, 0.25),\n    ]\n\n    results = []\n    # Use a small tolerance for floating point comparisons\n    TOL = 1e-9\n\n    for case in test_cases:\n        P_max, S, eta, c_deg, pi_reg, pi_cont, gamma, p, d, e_reg, e_cont = case\n\n        # 1. Calculate net marginal profits (m_reg, m_cont)\n        # Throughput is proportional to x * (1 + 1/eta)\n        throughput_factor = 1.0 + 1.0 / eta\n        \n        # Specific throughput for regulation (MWh/MW)\n        tau_reg = gamma * throughput_factor\n        # Specific throughput for contingency (MWh/MW)\n        tau_cont = p * d * throughput_factor\n        \n        # Marginal profit for regulation ($/MW)\n        m_reg = pi_reg - c_deg * tau_reg\n        # Marginal profit for contingency ($/MW)\n        m_cont = pi_cont - c_deg * tau_cont\n\n        # 2. Identify the vertices of the feasible region polygon\n        vertices = [(0.0, 0.0)]\n        \n        # r-axis intercept\n        r_intercept = P_max\n        if e_reg > TOL:\n            r_intercept = min(r_intercept, S / e_reg)\n        vertices.append((r_intercept, 0.0))\n\n        # c-axis intercept\n        c_intercept = P_max\n        if e_cont > TOL:\n            c_intercept = min(c_intercept, S / e_cont)\n        vertices.append((0.0, c_intercept))\n\n        # Intersection of the two constraint lines:\n        # r + c = P_max\n        # e_reg * r + e_cont * c = S\n        if abs(e_cont - e_reg) > TOL:\n            # Solve for c: e_reg * (P_max - c) + e_cont * c = S\n            # c * (e_cont - e_reg) = S - e_reg * P_max\n            c_int = (S - e_reg * P_max) / (e_cont - e_reg)\n            r_int = P_max - c_int\n            \n            # The intersection is a valid vertex if it's in the first quadrant\n            if r_int >= -TOL and c_int >= -TOL:\n                # Check if this intersection point is within the feasible set.\n                # Since it lies on both lines, we just need to check if it violates\n                # any other constraints, but since our constraints are r+c = P_max and\n                # e_reg*r+e_cont*c = S, and it lies on the boundaries, it is a valid\n                # candidate if non-negative.\n                if r_int + c_int = P_max + TOL and e_reg * r_int + e_cont * c_int = S + TOL:\n                    vertices.append((max(0, r_int), max(0, c_int)))\n\n        # 3. Evaluate objective function at each vertex to find the optimum\n        max_profit = -np.inf\n        optimal_rc = (0.0, 0.0)\n\n        for r_v, c_v in vertices:\n            # Ensure the vertex is truly feasible before evaluation\n            if r_v + c_v = P_max + TOL and e_reg * r_v + e_cont * c_v = S + TOL:\n                 profit = m_reg * r_v + m_cont * c_v\n                 if profit > max_profit:\n                    max_profit = profit\n                    optimal_rc = (r_v, c_v)\n\n        results.append(optimal_rc)\n\n    # 4. Format the final output string as specified\n    final_output = []\n    for r_star, c_star in results:\n        final_output.append([round(r_star, 3), round(c_star, 3)])\n    \n    print(str(final_output).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "电网运行中的不确定性（主要来自可再生能源和负荷波动）是需要辅助服务的根本原因之一。为了在日前决策中有效对冲这些不确定性，我们引入了随机规划方法。本练习  将引导您构建一个两阶段随机联合优化模型，您将学习如何做出最优的“此时此地”决策（日前能量和备用计划），以便在未来多种可能的“等待观察”情景下，通过最优的实时调整将期望总成本降至最低。",
            "id": "4078378",
            "problem": "考虑一个小型系统的单小时能量与辅助服务随机协同优化问题，该系统包含 $2$ 台常规发电机和 $2$ 种净负荷场景。调度周期为 $1$ 小时，因此在此小时内，以 $\\mathrm{MWh}$ 为单位的电能量在数值上等于以 $\\mathrm{MW}$ 为单位的功率量。目标是确定第一阶段的日前承诺和上调备用分配，以最小化包含实时校正措施的期望总成本。该模型必须满足功率平衡和物理可行性约束，并包含实时调整：上调调节、下调调节和非自愿切负荷。\n\n使用以下基本依据：\n- 能量/功率守恒平衡：对于每个场景，总供给（经过实时调整后）加上切负荷量等于净负荷。\n- 期望值定义：期望总成本等于各场景概率与其成本乘积之和。\n- 能量、备用容量和实时行为的线性边际成本表示。\n\n决策变量：\n- 每个发电机 $i \\in \\{1,2\\}$ 的第一阶段变量：计划能量 $e_i \\, (\\mathrm{MW})$ 和计划上调备用容量 $r_i \\, (\\mathrm{MW})$。\n- 每个场景 $s \\in \\{1,2\\}$ 和发电机 $i \\in \\{1,2\\}$ 的第二阶段校正变量：上调调节 $u_{i}^{(s)} \\, (\\mathrm{MW})$、下调调节 $d_{i}^{(s)} \\, (\\mathrm{MW})$ 和场景切负荷 $\\ell^{(s)} \\, (\\mathrm{MW})$。\n\n参数（均为非负且科学上合理）：\n- 发电机容量 $G_i \\, (\\mathrm{MW})$。\n- 边际能量成本 $C_i \\, (\\$/\\mathrm{MWh})$。\n- 上调备用容量成本 $A_i \\, (\\$/\\mathrm{MW}\\text{-}\\mathrm{h})$。\n- 实时上调调节边际成本 $U_i \\, (\\$/\\mathrm{MWh})$。\n- 实时下调调节边际成本 $D_i \\, (\\$/\\mathrm{MWh})$。\n- 切负荷惩罚 $S \\, (\\$/\\mathrm{MWh})$。\n- 场景负荷 $L^{(s)} \\, (\\mathrm{MW})$，其中 $s \\in \\{1,2\\}$。\n- 场景概率 $p^{(s)}$，满足 $p^{(1)} + p^{(2)} = 1$。\n\n将此协同优化建模为线性规划 (LP)：\n- 目标：最小化期望总成本\n$$\n\\sum_{i=1}^{2} C_i \\, e_i \\;+\\; \\sum_{i=1}^{2} A_i \\, r_i \\;+\\; \\sum_{s=1}^{2} p^{(s)}\\left(\\sum_{i=1}^{2} U_i \\, u_{i}^{(s)} \\;+\\; \\sum_{i=1}^{2} D_i \\, d_{i}^{(s)} \\;+\\; S \\, \\ell^{(s)}\\right).\n$$\n- 物理可行性约束：\n  - 对于每个发电机 $i$：$0 \\le e_i \\le G_i$，$0 \\le r_i$ 且 $e_i + r_i \\le G_i$。\n  - 对于每个场景 $s$ 和发电机 $i$：$0 \\le u_{i}^{(s)} \\le r_i$ 且 $0 \\le d_{i}^{(s)} \\le e_i$。\n  - 对于每个场景 $s$：功率平衡\n$$\n\\sum_{i=1}^{2} e_i \\;+\\; \\sum_{i=1}^{2} u_{i}^{(s)} \\;-\\; \\sum_{i=1}^{2} d_{i}^{(s)} \\;+\\; \\ell^{(s)} \\;=\\; L^{(s)},\n$$\n其中 $\\ell^{(s)} \\ge 0$。\n\n测试套件：\n提供 $3$ 组参数集，用于探究问题的不同方面。对于每种情况，报告最优的第一阶段承诺和备用分配 $\\left[e_1,e_2,r_1,r_2\\right]$（单位为 $\\mathrm{MW}$）。\n\n- 情况 1 (理想情况，容量充足，存在重要的备用权衡)：\n  - $G_1 = 80$, $G_2 = 70$.\n  - $C_1 = 10$, $C_2 = 25$.\n  - $A_1 = 2$, $A_2 = 4$.\n  - $U_1 = 15$, $U_2 = 35$.\n  - $D_1 = 1$, $D_2 = 1$.\n  - $S = 1000$.\n  - $L^{(1)} = 90$, $L^{(2)} = 130$.\n  - $p^{(1)} = 0.6$, $p^{(2)} = 0.4$.\n\n- 情况 2 (边缘情况，总容量不足导致在高负荷场景下出现带惩罚的切负荷)：\n  - $G_1 = 60$, $G_2 = 60$.\n  - $C_1 = 12$, $C_2 = 24$.\n  - $A_1 = 1$, $A_2 = 2$.\n  - $U_1 = 18$, $U_2 = 30$.\n  - $D_1 = 0.5$, $D_2 = 0.5$.\n  - $S = 2000$.\n  - $L^{(1)} = 90$, $L^{(2)} = 130$.\n  - $p^{(1)} = 0.5$, $p^{(2)} = 0.5$.\n\n- 情况 3 (边界权衡情况，高昂的备用容量成本鼓励调度发电量接近高负荷并依赖下调调节)：\n  - $G_1 = 80$, $G_2 = 80$.\n  - $C_1 = 12$, $C_2 = 20$.\n  - $A_1 = 20$, $A_2 = 50$.\n  - $U_1 = 18$, $U_2 = 30$.\n  - $D_1 = 1$, $D_2 = 1$.\n  - $S = 1000$.\n  - $L^{(1)} = 95$, $L^{(2)} = 105$.\n  - $p^{(1)} = 0.5$, $p^{(2)} = 0.5$.\n\n要求的输出：\n- 将 $e_1$、$e_2$、$r_1$ 和 $r_2$（单位为 $\\mathrm{MW}$）表示为四舍五入到三位小数的浮点数。\n- 您的程序应生成单行输出，其中包含三个情况的结果，格式为方括号内包含的逗号分隔列表，每个情况的结果也表示为一个列表。例如，输出格式必须为\n$$\n\\left[\\left[e_1^{(1)},e_2^{(1)},r_1^{(1)},r_2^{(1)}\\right],\\left[e_1^{(2)},e_2^{(2)},r_1^{(2)},r_2^{(2)}\\right],\\left[e_1^{(3)},e_2^{(3)},r_1^{(3)},r_2^{(3)}\\right]\\right].\n$$",
            "solution": "用户在能源系统工程领域提供了一个定义明确的问题，具体是关于不确定性下的能量和辅助服务协同优化。该问题被表述为一个两阶段随机线性规划，适用于一个包含 $2$ 台发电机和 $2$ 个场景的系统。\n\n### 问题验证\n\n**步骤 1：提取已知信息**\n\n- **决策变量（第一阶段）：**\n  - $e_i$: 发电机 $i \\in \\{1,2\\}$ 的计划能量 $(\\mathrm{MW})$。\n  - $r_i$: 发电机 $i \\in \\{1,2\\}$ 的计划上调备用容量 $(\\mathrm{MW})$。\n- **决策变量（第二阶段）：**\n  - $u_{i}^{(s)}$: 场景 $s \\in \\{1,2\\}$ 中发电机 $i$ 的上调调节量 $(\\mathrm{MW})$。\n  - $d_{i}^{(s)}$: 场景 $s \\in \\{1,2\\}$ 中发电机 $i$ 的下调调节量 $(\\mathrm{MW})$。\n  - $\\ell^{(s)}$: 场景 $s \\in \\{1,2\\}$ 中的切负荷量 $(\\mathrm{MW})$。\n- **参数：**\n  - $G_i$: 发电机 $i$ 的容量 $(\\mathrm{MW})$。\n  - $C_i$: 发电机 $i$ 的边际能量成本 $(\\$/\\mathrm{MWh})$。\n  - $A_i$: 发电机 $i$ 的上调备用容量成本 $(\\$/\\mathrm{MW}\\text{-}\\mathrm{h})$。\n  - $U_i$: 发电机 $i$ 的上调调节边际成本 $(\\$/\\mathrm{MWh})$。\n  - $D_i$: 发电机 $i$ 的下调调节边际成本 $(\\$/\\mathrm{MWh})$。\n  - $S$: 切负荷惩罚 $(\\$/\\mathrm{MWh})$。\n  - $L^{(s)}$: 场景 $s$ 中的净负荷 $(\\mathrm{MW})$。\n  - $p^{(s)}$: 场景 $s$ 的概率，其中 $p^{(1)} + p^{(2)} = 1$。\n- **目标函数：** 最小化期望总成本：\n$$ \\sum_{i=1}^{2} C_i \\, e_i \\;+\\; \\sum_{i=1}^{2} A_i \\, r_i \\;+\\; \\sum_{s=1}^{2} p^{(s)}\\left(\\sum_{i=1}^{2} U_i \\, u_{i}^{(s)} \\;+\\; \\sum_{i=1}^{2} D_i \\, d_{i}^{(s)} \\;+\\; S \\, \\ell^{(s)}\\right) $$\n- **约束条件：**\n  - $0 \\le e_i \\le G_i$ 对 $i \\in \\{1,2\\}$。\n  - $0 \\le r_i$ 对 $i \\in \\{1,2\\}$。\n  - $e_i + r_i \\le G_i$ 对 $i \\in \\{1,2\\}$。\n  - $0 \\le u_{i}^{(s)} \\le r_i$ 对 $s \\in \\{1,2\\}, i \\in \\{1,2\\}$。\n  - $0 \\le d_{i}^{(s)} \\le e_i$ 对 $s \\in \\{1,2\\}, i \\in \\{1,2\\}$。\n  - $\\ell^{(s)} \\ge 0$ 对 $s \\in \\{1,2\\}$。\n  - $\\sum_{i=1}^{2} e_i \\;+\\; \\sum_{i=1}^{2} u_{i}^{(s)} \\;-\\; \\sum_{i=1}^{2} d_{i}^{(s)} \\;+\\; \\ell^{(s)} \\;=\\; L^{(s)}$ 对 $s \\in \\{1,2\\}$。\n- **测试用例：** 提供了三组不同的参数集。\n\n**步骤 2：使用提取的已知信息进行验证**\n\n- **科学依据：** 该问题是两阶段随机机组组合问题的标准（尽管是简化的）表述，这是现代电力系统运行和规划的基石。日前能量和备用调度、实时校正措施（调节）、切负荷及其相关成本等概念都是基础性的，并得到了准确的表述。该模型正确地使用了期望值最小化和能量守恒（功率平衡）。\n- **适定性：** 问题被表述为线性规划 (LP)。给定一个非空有界可行域（由发电机容量约束保证）和线性目标函数，保证存在最优解。所有术语都定义清晰。\n- **客观性：** 语言精确，符合数学规范，没有主观或含糊的陈述。\n- **其他标准：** 问题是自包含的，为每个测试用例提供了所有必要的数据。参数在物理上是合理的，并且不包含内部矛盾。这是一个非平凡的优化问题，需要在不同时间阶段和场景之间平衡相互竞争的成本。\n\n**步骤 3：结论与行动**\n\n问题有效。它是一个适定的、科学上合理的、客观的优化任务。将提供完整的解决方案。\n\n### 解决方案\n\n该问题是一个两阶段随机线性规划问题。第一阶段决策 ($e_1, e_2, r_1, r_2$) 是在不确定净负荷实现之前“此时此地”做出的。第二阶段或追索决策 ($u_i^{(s)}, d_i^{(s)}, \\ell^{(s)}$) 是为每个场景 $s$“等待观察”后做出的，以最优地纠正计划发电量与实际负荷之间的任何不平衡。解决此问题的标准方法是构建其确定性等价形式，这是一个单一的大型线性规划，涵盖所有场景的所有变量和约束。这正是问题陈述中提供的表述。\n\n我们将使用标准的数值优化工具来解决这个 LP。该表述被转换为通用 LP 求解器所需的规范形式：\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  c^T x \\\\\n\\text{subject to} \\quad  A_{eq} x = b_{eq} \\\\\n A_{ub} x \\le b_{ub} \\\\\n l \\le x \\le u\n\\end{aligned}\n$$\n其中 $x$ 是所有决策变量的向量。\n\n**1. 决策变量向量**\n\n决策变量被排列成一个单一的向量 $x \\in \\mathbb{R}^{14}$：\n$$\nx = [e_1, e_2, r_1, r_2, u_1^{(1)}, u_2^{(1)}, d_1^{(1)}, d_2^{(1)}, \\ell^{(1)}, u_1^{(2)}, u_2^{(2)}, d_1^{(2)}, d_2^{(2)}, \\ell^{(2)}]^T\n$$\n索引映射如下：$e_1 \\to 0$, $e_2 \\to 1$, $r_1 \\to 2$, $r_2 \\to 3$, $u_1^{(1)} \\to 4$, ..., $\\ell^{(2)} \\to 13$。\n\n**2. 目标函数（成本向量 $c$）**\n\n目标是最小化第一阶段成本和期望的第二阶段成本之和。成本向量 $c \\in \\mathbb{R}^{14}$ 直接从目标函数系数构建：\n$$\nc = [C_1, C_2, A_1, A_2, p^{(1)}U_1, p^{(1)}U_2, p^{(1)}D_1, p^{(1)}D_2, p^{(1)}S, p^{(2)}U_1, p^{(2)}U_2, p^{(2)}D_1, p^{(2)}D_2, p^{(2)}S]^T\n$$\n\n**3. 等式约束 ($A_{eq}, b_{eq}$)**\n\n等式约束强制执行每个场景中的功率平衡。这产生一个矩阵 $A_{eq} \\in \\mathbb{R}^{2 \\times 14}$ 和一个向量 $b_{eq} \\in \\mathbb{R}^{2}$。\n\n- **场景 1 平衡：** $\\sum_{i=1}^{2} e_i + \\sum_{i=1}^{2} u_{i}^{(1)} - \\sum_{i=1}^{2} d_{i}^{(1)} + \\ell^{(1)} = L^{(1)}$\n  这对应于 $A_{eq}$ 的第一行，其中 $e_1, e_2, u_1^{(1)}, u_2^{(1)}, \\ell^{(1)}$ 的系数为 $1$，$d_1^{(1)}, d_2^{(1)}$ 的系数为 $-1$。\n- **场景 2 平衡：** $\\sum_{i=1}^{2} e_i + \\sum_{i=1}^{2} u_{i}^{(2)} - \\sum_{i=1}^{2} d_{i}^{(2)} + \\ell^{(2)} = L^{(2)}$\n  这对应于 $A_{eq}$ 的第二行，其中 $e_1, e_2, u_1^{(2)}, u_2^{(2)}, \\ell^{(2)}$ 的系数为 $1$，$d_1^{(2)}, d_2^{(2)}$ 的系数为 $-1$。\n\n右侧是 $b_{eq} = [L^{(1)}, L^{(2)}]^T$。\n\n**4. 不等式约束 ($A_{ub}, b_{ub}$)**\n\n不等式约束规定了发电机的物理限制以及第一阶段和第二阶段决策之间的耦合关系。共有 $10$ 个这样的约束，形成一个矩阵 $A_{ub} \\in \\mathbb{R}^{10 \\times 14}$ 和一个向量 $b_{ub} \\in \\mathbb{R}^{10}$。\n\n- **发电机容量：** $e_i + r_i \\le G_i$ 对 $i \\in \\{1,2\\}$。（2 个约束）\n- **上调调节限制：** $u_{i}^{(s)} \\le r_i \\implies u_{i}^{(s)} - r_i \\le 0$ 对 $i \\in \\{1,2\\}, s \\in \\{1,2\\}$。（4 个约束）\n- **下调调节限制：** $d_{i}^{(s)} \\le e_i \\implies d_{i}^{(s)} - e_i \\le 0$ 对 $i \\in \\{1,2\\}, s \\in \\{1,2\\}$。（4 个约束）\n\n右侧是 $b_{ub} = [G_1, G_2, 0, 0, 0, 0, 0, 0, 0, 0]^T$。\n\n**5. 变量边界 ($l, u$)**\n\n边界定义了每个单独变量的域。\n\n- $0 \\le e_i \\le G_i$ 对 $i=1,2$。\n- 所有其他变量都是非负的：$r_i \\ge 0$, $u_{i}^{(s)} \\ge 0$, $d_{i}^{(s)} \\ge 0$, $\\ell^{(s)} \\ge 0$。\n\n这个完整的 LP 模型为三个测试用例中的每一个构建并求解。从解向量 $x$ 中提取第一阶段变量 ($e_1, e_2, r_1, r_2$) 的最优值。结果展示了系统如何根据日前调度、备用采购和实时调整的相对成本来最优地对冲负荷不确定性。\n\n- **情况 1** 容量充足。关键权衡在于，是从更便宜的发电机（G1）获取备用（这需要减少其廉价的能量输出），还是使用更昂贵的发电机（G2）作为备用。\n- **情况 2** 受到系统总容量的限制，该容量低于高负荷需求。这迫使在高负荷场景下产生确定数量的切负荷，从而简化了权衡。\n- **情况 3** 的特点是备用容量成本 ($A_i$) 非常高。这产生了一种经济激励，即通过将能量调度得更接近高负荷场景，并在低负荷场景中依赖更便宜的下调调节，来最小化采购的备用量。\n\n实现将为每个情况构建这些矩阵和向量，并使用 `scipy.optimize.linprog` 函数找到最优解。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the stochastic co-optimization problem for three test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Happy path\n        {\n            \"G\": np.array([80.0, 70.0]),\n            \"C\": np.array([10.0, 25.0]),\n            \"A\": np.array([2.0, 4.0]),\n            \"U\": np.array([15.0, 35.0]),\n            \"D\": np.array([1.0, 1.0]),\n            \"S\": 1000.0,\n            \"L\": np.array([90.0, 130.0]),\n            \"p\": np.array([0.6, 0.4]),\n        },\n        # Case 2: Insufficient capacity\n        {\n            \"G\": np.array([60.0, 60.0]),\n            \"C\": np.array([12.0, 24.0]),\n            \"A\": np.array([1.0, 2.0]),\n            \"U\": np.array([18.0, 30.0]),\n            \"D\": np.array([0.5, 0.5]),\n            \"S\": 2000.0,\n            \"L\": np.array([90.0, 130.0]),\n            \"p\": np.array([0.5, 0.5]),\n        },\n        # Case 3: Boundary trade-off\n        {\n            \"G\": np.array([80.0, 80.0]),\n            \"C\": np.array([12.0, 20.0]),\n            \"A\": np.array([20.0, 50.0]),\n            \"U\": np.array([18.0, 30.0]),\n            \"D\": np.array([1.0, 1.0]),\n            \"S\": 1000.0,\n            \"L\": np.array([95.0, 105.0]),\n            \"p\": np.array([0.5, 0.5]),\n        },\n    ]\n\n    all_results = []\n    \n    # Variable mapping to indices in the decision vector x:\n    # x = [e1, e2, r1, r2, u1_1, u2_1, d1_1, d2_1, l_1, u1_2, u2_2, d1_2, d2_2, l_2]\n    # Indices: 0, 1, 2,  3,  4,    5,    6,    7,    8,   9,    10,   11,   12,   13\n\n    for case_params in test_cases:\n        G, C, A, U, D, S, L, p = (\n            case_params[\"G\"],\n            case_params[\"C\"],\n            case_params[\"A\"],\n            case_params[\"U\"],\n            case_params[\"D\"],\n            case_params[\"S\"],\n            case_params[\"L\"],\n            case_params[\"p\"],\n        )\n        G1, G2 = G\n        L1, L2 = L\n        p1, p2 = p\n        C1, C2 = C\n        A1, A2 = A\n        U1, U2 = U\n        D1, D2 = D\n\n        # Objective function vector c (14 variables)\n        c = np.array([\n            C1, C2, A1, A2,          # First-stage costs\n            p1 * U1, p1 * U2, p1 * D1, p1 * D2, p1 * S, # Scenario 1 recourse costs\n            p2 * U1, p2 * U2, p2 * D1, p2 * D2, p2 * S, # Scenario 2 recourse costs\n        ])\n\n        # Equality constraints A_eq * x = b_eq (2 constraints for power balance)\n        A_eq = np.zeros((2, 14))\n        # Scenario 1: e1+e2 + u1_1+u2_1 - d1_1-d2_1 + l_1 = L1\n        A_eq[0, [0, 1, 4, 5, 8]] = 1\n        A_eq[0, [6, 7]] = -1\n        # Scenario 2: e1+e2 + u1_2+u2_2 - d1_2-d2_2 + l_2 = L2\n        A_eq[1, [0, 1, 9, 10, 13]] = 1\n        A_eq[1, [11, 12]] = -1\n        b_eq = np.array([L1, L2])\n\n        # Inequality constraints A_ub * x = b_ub (10 constraints)\n        A_ub = np.zeros((10, 14))\n        # e1 + r1 = G1\n        A_ub[0, [0, 2]] = 1\n        # e2 + r2 = G2\n        A_ub[1, [1, 3]] = 1\n        # u1_1 - r1 = 0\n        A_ub[2, [4, 2]] = [1, -1]\n        # u2_1 - r2 = 0\n        A_ub[3, [5, 3]] = [1, -1]\n        # u1_2 - r1 = 0\n        A_ub[4, [9, 2]] = [1, -1]\n        # u2_2 - r2 = 0\n        A_ub[5, [10, 3]] = [1, -1]\n        # d1_1 - e1 = 0\n        A_ub[6, [6, 0]] = [1, -1]\n        # d2_1 - e2 = 0\n        A_ub[7, [7, 1]] = [1, -1]\n        # d1_2 - e1 = 0\n        A_ub[8, [11, 0]] = [1, -1]\n        # d2_2 - e2 = 0\n        A_ub[9, [12, 1]] = [1, -1]\n        \n        b_ub = np.array([G1, G2, 0, 0, 0, 0, 0, 0, 0, 0])\n\n        # Bounds for each variable\n        bounds = [\n            (0, G1), (0, G2),      # e1, e2\n            (0, None), (0, None), # r1, r2\n            (0, None), (0, None), # u1_1, u2_1\n            (0, None), (0, None), # d1_1, d2_1\n            (0, None),            # l_1\n            (0, None), (0, None), # u1_2, u2_2\n            (0, None), (0, None), # d1_2, d2_2\n            (0, None),            # l_2\n        ]\n\n        # Solve the linear program\n        res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n        if res.success:\n            # Extract first-stage variables [e1, e2, r1, r2]\n            e1, e2, r1, r2 = res.x[0:4]\n            # Format to 3 decimal places\n            case_result_list = [float(f\"{val:.3f}\") for val in [e1, e2, r1, r2]]\n            all_results.append(case_result_list)\n        else:\n            # This should not happen for this well-posed problem\n            all_results.append(['error','error','error','error'])\n    \n    # Final print statement in the exact required format\n    print(str(all_results).replace(\" \", \"\"))\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}