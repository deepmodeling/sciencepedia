{
    "hands_on_practices": [
        {
            "introduction": "This first exercise delves into a core challenge in electricity market design: compensating for costs not captured by marginal prices. By analyzing a system with a thermal generator, you will see how the need for ancillary services can force the commitment of a unit even when its energy is out-of-merit, requiring an \"uplift\" payment to ensure its financial viability. This practice  is crucial for understanding the economic implications of non-convex costs, such as startup and no-load costs, in centralized markets.",
            "id": "4078317",
            "problem": "Consider a single-period, single-bus co-optimization of energy and spinning reserve in an electric power system. The system operator must meet a fixed energy demand and a spinning reserve requirement simultaneously. The system comprises two resources:\n\n1. A wind unit with variable energy cost $c_{W} = 0$ dollars per megawatt-hour, maximum available power $P_{W}^{\\max} = 100$ megawatts, and no capability to provide spinning reserve.\n\n2. A thermal unit with variable energy cost $c_{T} = 40$ dollars per megawatt-hour, minimum stable output $P_{T}^{\\min} = 15$ megawatts, maximum output $P_{T}^{\\max} = 75$ megawatts, and upward spinning reserve capability limited by $R_{T} \\leq P_{T}^{\\max} - P_{T}$. The thermal unit has a no-load cost $F = 600$ dollars per hour and a startup cost $S = 900$ dollars per start. Assume the thermal unit starts from the offline state.\n\nLet the energy demand be $D = 100$ megawatts and the spinning reserve requirement be $R^{\\mathrm{req}} = 30$ megawatts. Assume there is no separate marginal cost for providing reserve beyond the opportunity cost implied by headroom constraints.\n\nWork from first principles of least-cost dispatch and co-optimization: model the primal problem as minimizing total production cost subject to energy balance, reserve requirement, and unit capability constraints (including minimum output and reserve capability), and define prices as Lagrange multipliers of the corresponding constraints in the convex relaxation conditional on commitment.\n\nUnder standard marginal pricing, the system pays energy at the Locational Marginal Price (LMP) and reserve at the Spinning Reserve Clearing Price (SRCP). Define uplift as the minimal nonnegative payment required to ensure that the thermal unitâ€™s net profit over the settlement interval equals zero if its market revenues (energy plus reserve) under marginal prices do not cover its realized costs (variable energy cost, no-load cost, and startup cost).\n\nConstruct and analyze the co-optimized dispatch to show a case in which the spinning reserve requirement drives commitment of the thermal unit even though the energy LMP is below its marginal energy cost. Derive the LMP and SRCP from the Lagrangian duals of the energy balance and reserve requirement, respectively, and compute the required uplift for the thermal unit over the one-hour settlement interval. Express the final uplift in dollars. No rounding instruction is necessary; provide the exact value.",
            "solution": "The problem will be validated against the specified criteria before a solution is attempted.\n\n### Step 1: Extract Givens\n-   Wind unit variable cost: $c_{W} = 0$ dollars per megawatt-hour\n-   Wind unit maximum power: $P_{W}^{\\max} = 100$ megawatts\n-   Wind unit reserve capability: $0$\n-   Thermal unit variable cost: $c_{T} = 40$ dollars per megawatt-hour\n-   Thermal unit minimum stable output: $P_{T}^{\\min} = 15$ megawatts\n-   Thermal unit maximum output: $P_{T}^{\\max} = 75$ megawatts\n-   Thermal unit upward spinning reserve capability: $R_{T} \\leq P_{T}^{\\max} - P_{T}$\n-   Thermal unit no-load cost: $F = 600$ dollars per hour\n-   Thermal unit startup cost: $S = 900$ dollars per start (from offline state)\n-   Energy demand: $D = 100$ megawatts\n-   Spinning reserve requirement: $R^{\\mathrm{req}} = 30$ megawatts\n-   Settlement interval: $1$ hour\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It is a standard, albeit simplified, unit commitment and economic dispatch problem from the field of power systems engineering and electricity market design. The parameters are self-contained and consistent, and the terminology (LMP, SRCP, uplift) is standard within the domain. The problem does not violate any scientific principles, is not metaphorical, is not incomplete or contradictory, and is not trivial. It presents a classic case illustrating the need for uplift payments in markets with non-convex generator constraints.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be provided.\n\nThe total system cost, which the system operator aims to minimize, is the sum of the costs of the committed units. The costs for the thermal unit include a startup cost, a no-load cost (if committed), and a variable energy cost. The wind unit has only a variable energy cost. Let $u_T \\in \\{0, 1\\}$ be the binary commitment variable for the thermal unit, where $u_T=1$ if the unit is online and $u_T=0$ if it is offline. Let $P_W$ and $P_T$ be the energy dispatched from the wind and thermal units, respectively, and let $R_T$ be the spinning reserve provided by the thermal unit.\n\nThe co-optimization problem can be formulated as a mixed-integer linear program:\n$$\n\\min_{u_T, P_W, P_T, R_T} \\quad C = c_W P_W + c_T P_T + u_T (F + S)\n$$\nSubject to:\n1.  Energy balance: $P_W + P_T = D$\n2.  Reserve requirement: $R_T \\ge R^{\\mathrm{req}}$ (as only the thermal unit provides reserve)\n3.  Wind unit capacity: $0 \\le P_W \\le P_W^{\\max}$\n4.  Thermal unit capacity: $u_T P_T^{\\min} \\le P_T \\le u_T P_T^{\\max}$\n5.  Thermal unit reserve headroom: $P_T + R_T \\le u_T P_T^{\\max}$\n6.  Non-negativity of reserve: $R_T \\ge 0$\n7.  Binary commitment: $u_T \\in \\{0, 1\\}$\n\nSubstituting the given values:\n$$\n\\min_{u_T, P_W, P_T, R_T} \\quad C = (0) P_W + 40 P_T + u_T (600 + 900) = 40 P_T + 1500 u_T\n$$\nSubject to:\n1.  $P_W + P_T = 100$\n2.  $R_T \\ge 30$\n3.  $0 \\le P_W \\le 100$\n4.  $15 u_T \\le P_T \\le 75 u_T$\n5.  $P_T + R_T \\le 75 u_T$\n\nWe solve this by considering the two possible cases for $u_T$.\n\nCase 1: Thermal unit is offline ($u_T = 0$).\nThe constraints become: $P_T = 0$ and $R_T = 0$.\nThe reserve requirement $R_T \\ge 30$ becomes $0 \\ge 30$, which is false.\nThus, this case is infeasible. The thermal unit must be committed to satisfy the spinning reserve requirement.\n\nCase 2: Thermal unit is online ($u_T = 1$).\nThe problem becomes a linear program to find the optimal dispatch:\n$$\n\\min_{P_W, P_T, R_T} \\quad C = 40 P_T + 1500\n$$\nSubject to:\n1.  $P_W + P_T = 100$\n2.  $R_T \\ge 30$\n3.  $0 \\le P_W \\le 100$\n4.  $15 \\le P_T \\le 75$\n5.  $P_T + R_T \\le 75$\n\nTo minimize the cost $C$, we must minimize $P_T$.\nFrom the energy balance, $P_W = 100 - P_T$. Substituting this into the wind capacity constraint gives $0 \\le 100 - P_T \\le 100$, which implies $0 \\le P_T \\le 100$. Combining this with the thermal unit's capacity constraint ($15 \\le P_T \\le 75$), the effective range for $P_T$ is $[15, 75]$.\nThe objective function is minimized at the lowest possible value of $P_T$, which is $P_T^* = 15$ MW.\nLet's check if this dispatch is feasible with the reserve constraints.\nWith $P_T^* = 15$, the reserve headroom constraint is $15 + R_T \\le 75$, which implies $R_T \\le 60$.\nThe system requires $R_T \\ge 30$.\nSince the range $[30, 60]$ is valid for $R_T$, a feasible solution exists. The system operator will procure the minimum required amount, so $R_T^* = 30$ MW.\nThe corresponding wind dispatch is $P_W^* = 100 - P_T^* = 100 - 15 = 85$ MW. This is within the wind unit's capacity.\n\nThe optimal dispatch is: $P_T^* = 15$ MW, $P_W^* = 85$ MW, and $R_T^* = 30$ MW.\nThis dispatch demonstrates that the thermal unit is committed ($u_T=1$) due to the reserve requirement, even though there is enough cheaper wind capacity to meet the entire energy demand.\nThe total system cost is $C^* = 40(15) + 1500 = 600 + 1500 = 2100$ dollars.\n\nNext, we derive the market clearing prices, LMP and SRCP, from the dual of the relaxed linear program (with $u_T=1$). The variable-cost portion of the objective function is $40 P_T$.\nLet $\\lambda$ be the Lagrange multiplier for the energy balance constraint (LMP) and $\\mu$ be the multiplier for the reserve requirement constraint (SRCP).\n\nThe Lagrangian for the variable cost minimization is:\n$L = 40 P_T - \\lambda(P_W + P_T - 100) - \\mu(R_T - 30) - \\nu(75 - P_T - R_T) - \\alpha(P_T - 15) - ...$\n(including multipliers for all constraints).\nThe Karush-Kuhn-Tucker (KKT) conditions for optimality include:\n$\\frac{\\partial L}{\\partial P_W} = -\\lambda - \\gamma_W = 0$, where $\\gamma_W$ is the multiplier for wind capacity, which is $0$ as $P_W^* = 85$ is not at its bounds. Thus, $\\lambda=0$.\n$\\frac{\\partial L}{\\partial P_T} = 40 - \\lambda - \\alpha + \\nu = 0$, where $\\alpha$ is for $P_T \\ge 15$ and $\\nu$ is for $P_T+R_T \\le 75$.\n$\\frac{\\partial L}{\\partial R_T} = -\\mu + \\nu = 0 \\implies \\mu = \\nu$.\n\nAt the optimal solution ($P_T^*=15$, $R_T^*=30$):\n-   The energy price is the LMP, $\\lambda$. Since the marginal unit for energy is wind ($c_W=0$) and it has spare capacity ($P_W^*=85  P_W^{\\max}=100$), the cost of an additional megawatt of energy is zero. Thus, LMP = $\\lambda=0$ $/MWh$.\n-   The reserve price is the SRCP, $\\mu$. At the optimum, $P_T^* + R_T^* = 15 + 30 = 45  75$. The thermal unit has spare capacity to provide more reserve without reducing its energy output. The constraint $P_T+R_T \\le 75$ is not binding, so its dual variable $\\nu = 0$. Since $\\mu=\\nu$, it follows that SRCP = $\\mu=0$ $/MWh$.\n\nThis result, LMP $=0$ and SRCP $=0$, is a consequence of pricing based on the relaxed convex problem, where the non-convex minimum output constraint is a primary driver of the dispatch but its cost is not reflected in the marginal prices.\n\nFinally, we compute the uplift for the thermal unit. Uplift is the payment required to cover costs not recovered through the energy and reserve markets.\nMarket Revenue for the thermal unit:\n$$\n\\text{Revenue} = (\\text{LMP} \\times P_T^*) + (\\text{SRCP} \\times R_T^*) = (0 \\text{ $/MWh} \\times 15 \\text{ MW}) + (0 \\text{ $/MWh} \\times 30 \\text{ MW}) = \\$0\n$$\nThe calculation is for a $1$-hour period.\nTotal Cost for the thermal unit:\n$$\n\\text{Cost} = (\\text{Variable Cost}) + (\\text{No-Load Cost}) + (\\text{Startup Cost})\n$$\n$$\n\\text{Cost} = (c_T \\times P_T^*) + F + S = (40 \\text{ $/MWh} \\times 15 \\text{ MW}) + \\$600 + \\$900 = \\$600 + \\$600 + \\$900 = \\$2100\n$$\nThe unit's profit from market operations is Revenue - Cost = $\\$0 - \\$2100 = -\\$2100$.\nThe uplift payment must make the net profit zero.\n$$\n\\text{Uplift} = -(\\text{Profit}) = -(-\\$2100) = \\$2100\n$$",
            "answer": "$$\\boxed{2100}$$"
        },
        {
            "introduction": "Moving from conventional generators to modern assets, this practice focuses on the co-optimization problem for a battery energy storage system. You will formulate a model that maximizes profit by providing multiple services simultaneously, explicitly accounting for critical physical characteristics like round-trip efficiency and degradation costs . This exercise demonstrates how to adapt the co-optimization framework to capture the unique operational economics of energy storage, a vital skill for modeling future grids.",
            "id": "4078365",
            "problem": "You are to formalize and solve a co-optimization problem in which a single electrochemical battery provides both contingency reserves and regulation services within a single hourly interval. The decision variables are the regulation capacity $r$ (in $\\mathrm{MW}$) and the contingency reserve capacity $c$ (in $\\mathrm{MW}$). The battery is characterized by a maximum discharge/charge power rating $P_{\\max}$ (in $\\mathrm{MW}$) and an energy headroom $S$ (in $\\mathrm{MWh}$) available for unscheduled movements (relative to a baseline energy schedule) within the hour. The battery has round-trip efficiency $\\eta \\in (0,1)$, and experiences degradation costs that are proportional to the absolute energy throughput. Regulation capacity earns a capacity payment $\\pi^{\\mathrm{reg}}$ (in currency per $\\mathrm{MW}$ per hour) and contingency reserve capacity earns a capacity payment $\\pi^{\\mathrm{cont}}$ (in currency per $\\mathrm{MW}$ per hour). The degradation cost parameter $c_{\\mathrm{deg}}$ is given in currency per $\\mathrm{MWh}$ of absolute energy throughput.\n\nFundamental base and physical realism:\n- The absolute energy throughput associated with any service in the hour is defined as the sum of the magnitude of discharge energy and the magnitude of the recharge energy required to return to the initial state of charge. By energy conservation and the definition of round-trip efficiency, if the battery discharges $x$ (in $\\mathrm{MWh}$) and must return to the initial state of charge, then the required recharge energy is $x/\\eta$. Thus, the absolute throughput associated with that event is $x + x/\\eta$.\n- For regulation, let $\\gamma$ (in $\\mathrm{MWh}$ per $\\mathrm{MW}$ per hour) denote the expected discharge-side energy movement per $\\mathrm{MW}$ of regulation capacity over the hour; this $\\gamma$ captures the statistical intensity (sometimes called mileage) on the discharge side. For contingency reserve, let $p$ be the probability of activation in the hour and $d$ be the expected duration of activation (in hours) conditional on activation; then the expected discharge-side energy per $\\mathrm{MW}$ of contingency capacity is $p \\cdot d$. Use the above energy conservation principle to map these discharge-side energies into absolute throughput per $\\mathrm{MW}$ for each product.\n- The energy headroom $S$ must be sufficient to keep the battery within allowed state-of-charge limits under the chosen capacities. To abstract diverse operational policies, assume fixed energy headroom coefficients $e^{\\mathrm{reg}}$ (in $\\mathrm{MWh}$ per $\\mathrm{MW}$) and $e^{\\mathrm{cont}}$ (in $\\mathrm{MWh}$ per $\\mathrm{MW}$) such that $e^{\\mathrm{reg}} \\cdot r + e^{\\mathrm{cont}} \\cdot c \\le S$ enforces feasibility of energy limits under the chosen capacities. This is a standard linear robustness surrogate for state-of-charge feasibility at the planning level.\n\nYour task:\n- Formulate the co-optimization as an hourly net-profit maximization over $r$ and $c$ subject to physical constraints. The net-profit objective is the sum of capacity revenues minus degradation cost computed from absolute throughput. Use only the above fundamental definitions to construct the throughput and the constraints; you must not assume any external shortcuts beyond these basics.\n- The feasible set must include the power constraint $r + c \\le P_{\\max}$ and the energy headroom constraint $e^{\\mathrm{reg}} \\cdot r + e^{\\mathrm{cont}} \\cdot c \\le S$, together with non-negativity constraints $r \\ge 0$ and $c \\ge 0$.\n- For each test case, compute the optimal pair $(r^{\\star}, c^{\\star})$ that maximizes the net profit under the given parameters.\n\nUnits and output:\n- Express $r^{\\star}$ and $c^{\\star}$ in $\\mathrm{MW}$, rounded to three decimal places.\n- Your program should produce a single line of output containing the results for all test cases as a list of lists, where each inner list is $[r^{\\star}, c^{\\star}]$. For example, the format must be exactly like $[[r_1,c_1],[r_2,c_2],\\dots]$ with numbers in decimal form.\n\nTest suite:\nUse the following four test cases to validate the model and algorithm. Each test case specifies $(P_{\\max}, S, \\eta, c_{\\mathrm{deg}}, \\pi^{\\mathrm{reg}}, \\pi^{\\mathrm{cont}}, \\gamma, p, d, e^{\\mathrm{reg}}, e^{\\mathrm{cont}})$ with indicated units.\n- Case 1 (happy path, power-limited to regulation): $P_{\\max} = 100\\,\\mathrm{MW}$, $S = 40\\,\\mathrm{MWh}$, $\\eta = 0.9$, $c_{\\mathrm{deg}} = 10$, $\\pi^{\\mathrm{reg}} = 30$, $\\pi^{\\mathrm{cont}} = 15$, $\\gamma = 0.5$, $p = 0.1$, $d = 0.25$, $e^{\\mathrm{reg}} = 0.2$, $e^{\\mathrm{cont}} = 0.25$.\n- Case 2 (energy binding with negative regulation margin, contingency preferred): $P_{\\max} = 100\\,\\mathrm{MW}$, $S = 40\\,\\mathrm{MWh}$, $\\eta = 0.9$, $c_{\\mathrm{deg}} = 40$, $\\pi^{\\mathrm{reg}} = 30$, $\\pi^{\\mathrm{cont}} = 15$, $\\gamma = 0.5$, $p = 0.1$, $d = 0.25$, $e^{\\mathrm{reg}} = 0.2$, $e^{\\mathrm{cont}} = 0.5$.\n- Case 3 (strongly energy-limited, contingency more valuable): $P_{\\max} = 100\\,\\mathrm{MW}$, $S = 10\\,\\mathrm{MWh}$, $\\eta = 0.9$, $c_{\\mathrm{deg}} = 10$, $\\pi^{\\mathrm{reg}} = 20$, $\\pi^{\\mathrm{cont}} = 25$, $\\gamma = 0.5$, $p = 0.1$, $d = 0.25$, $e^{\\mathrm{reg}} = 0.25$, $e^{\\mathrm{cont}} = 0.3$.\n- Case 4 (both margins negative, zero solution): $P_{\\max} = 100\\,\\mathrm{MW}$, $S = 40\\,\\mathrm{MWh}$, $\\eta = 0.9$, $c_{\\mathrm{deg}} = 300$, $\\pi^{\\mathrm{reg}} = 20$, $\\pi^{\\mathrm{cont}} = 10$, $\\gamma = 0.5$, $p = 0.1$, $d = 0.25$, $e^{\\mathrm{reg}} = 0.2$, $e^{\\mathrm{cont}} = 0.25$.\n\nAlgorithmic requirement:\nImplement an algorithm that, for each test case, computes the absolute throughput per $\\mathrm{MW}$ for regulation and contingency using only the energy conservation and round-trip efficiency definitions stated above, constructs the linear net-profit objective, and finds the optimal $(r^{\\star}, c^{\\star})$ over the polyhedral feasible region. The algorithm must be correct across the above cases, including boundary and edge cases. The final program must be self-contained and produce the specified single-line output containing $[[r_1,c_1],[r_2,c_2],[r_3,c_3],[r_4,c_4]]$ with all values in $\\mathrm{MW}$ rounded to three decimal places.",
            "solution": "The problem requires the formulation and solution of a linear optimization problem to maximize the net profit of a battery system providing regulation and contingency reserve services simultaneously. The solution process begins by constructing the objective function and constraints from the fundamental principles provided.\n\nThe decision variables are the regulation capacity $r$ (in $\\mathrm{MW}$) and the contingency reserve capacity $c$ (in $\\mathrm{MW}$). The objective is to maximize the hourly net profit, $Z$, which is the total revenue from capacity payments minus the total expected degradation cost.\n\n$Z(r, c) = \\text{Revenue}(r, c) - \\text{Cost}(r, c)$\n\n**1. Revenue Formulation**\n\nThe revenue is the sum of the capacity payments for each service.\n- Revenue from regulation: $\\pi^{\\mathrm{reg}} \\cdot r$\n- Revenue from contingency reserve: $\\pi^{\\mathrm{cont}} \\cdot c$\nTotal Revenue $= \\pi^{\\mathrm{reg}} r + \\pi^{\\mathrm{cont}} c$\n\n**2. Degradation Cost Formulation**\n\nThe degradation cost is proportional to the total expected absolute energy throughput, with a cost parameter $c_{\\mathrm{deg}}$.\nTotal Cost $= c_{\\mathrm{deg}} \\cdot (\\text{Expected Throughput}_{\\mathrm{reg}} + \\text{Expected Throughput}_{\\mathrm{cont}})$\n\nThe problem states that for a discharge of $x$ $\\mathrm{MWh}$, the required recharge to return to the initial state of charge is $x/\\eta$ $\\mathrm{MWh}$ due to the round-trip efficiency $\\eta$. The absolute energy throughput for this cycle is therefore $x + x/\\eta = x(1 + 1/\\eta)$. We apply this principle to both services.\n\n- **Regulation Service Throughput**:\n  The expected discharge-side energy per $\\mathrm{MW}$ of regulation capacity is given as $\\gamma$. For a committed capacity of $r$ $\\mathrm{MW}$, the total expected discharge is $x_{\\mathrm{reg}} = \\gamma \\cdot r$.\n  The expected absolute throughput for regulation is $x_{\\mathrm{reg}}(1 + 1/\\eta) = \\gamma r (1 + 1/\\eta)$.\n  Let $\\tau^{\\mathrm{reg}} = \\gamma (1 + 1/\\eta)$ be the specific throughput for regulation (in $\\mathrm{MWh/MW}$).\n\n- **Contingency Reserve Service Throughput**:\n  The expected discharge-side energy per $\\mathrm{MW}$ of contingency capacity is the product of the activation probability $p$ and the expected duration $d$, i.e., $p \\cdot d$. For a committed capacity of $c$ $\\mathrm{MW}$, the total expected discharge is $x_{\\mathrm{cont}} = (p \\cdot d) \\cdot c$.\n  The expected absolute throughput for contingency reserve is $x_{\\mathrm{cont}}(1 + 1/\\eta) = (p \\cdot d) c (1 + 1/\\eta)$.\n  Let $\\tau^{\\mathrm{cont}} = p \\cdot d (1 + 1/\\eta)$ be the specific throughput for contingency reserve (in $\\mathrm{MWh/MW}$).\n\nThe total degradation cost is $c_{\\mathrm{deg}}(\\tau^{\\mathrm{reg}} r + \\tau^{\\mathrm{cont}} c)$.\n\n**3. Net-Profit Objective Function**\n\nCombining revenue and cost, the net-profit function is:\n$Z(r, c) = (\\pi^{\\mathrm{reg}} r + \\pi^{\\mathrm{cont}} c) - c_{\\mathrm{deg}}(\\tau^{\\mathrm{reg}} r + \\tau^{\\mathrm{cont}} c)$\n\nGrouping terms by the decision variables $r$ and $c$:\n$Z(r, c) = (\\pi^{\\mathrm{reg}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{reg}}) r + (\\pi^{\\mathrm{cont}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{cont}}) c$\n\nLet us define the net marginal profit for each service:\n- $m^{\\mathrm{reg}} = \\pi^{\\mathrm{reg}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{reg}} = \\pi^{\\mathrm{reg}} - c_{\\mathrm{deg}} \\gamma (1 + 1/\\eta)$\n- $m^{\\mathrm{cont}} = \\pi^{\\mathrm{cont}} - c_{\\mathrm{deg}} \\tau^{\\mathrm{cont}} = \\pi^{\\mathrm{cont}} - c_{\\mathrm{deg}} p d (1 + 1/\\eta)$\n\nThe objective function simplifies to maximizing $Z(r, c) = m^{\\mathrm{reg}} r + m^{\\mathrm{cont}} c$.\n\n**4. Constraints**\n\nThe optimization is subject to physical and operational constraints:\n1.  **Power Constraint**: The total capacity committed cannot exceed the battery's power rating: $r + c \\le P_{\\max}$.\n2.  **Energy Headroom Constraint**: The provisioned capacity must be supported by sufficient energy headroom: $e^{\\mathrm{reg}} r + e^{\\mathrm{cont}} c \\le S$.\n3.  **Non-negativity**: Capacities cannot be negative: $r \\ge 0$ and $c \\ge 0$.\n\n**5. Linear Programming Formulation**\n\nThe complete co-optimization problem is a Linear Program (LP):\n$$\n\\begin{align*}\n\\text{maximize}_{r, c} \\quad  m^{\\mathrm{reg}} r + m^{\\mathrm{cont}} c \\\\\n\\text{subject to} \\quad  r + c \\le P_{\\max} \\\\\n e^{\\mathrm{reg}} r + e^{\\mathrm{cont}} c \\le S \\\\\n r \\ge 0 \\\\\n c \\ge 0\n\\end{align*}\n$$\n\n**6. Solution Methodology**\n\nThis is a two-dimensional LP. The feasible region defined by the linear inequalities is a convex polygon in the $(r, c)$ plane. A fundamental theorem of linear programming states that if an optimal solution exists, it must occur at one of the vertices of this feasible region.\n\nThe algorithm to find the optimal solution $(r^{\\star}, c^{\\star})$ is as follows:\n1.  For each test case, calculate the net marginal profits, $m^{\\mathrm{reg}}$ and $m^{\\mathrm{cont}}$.\n2.  Identify the vertices of the feasible polygon. The vertices are the intersections of the boundary lines of the constraints that lie within the feasible region. These are:\n    - The origin: $(0, 0)$.\n    - The $r$-axis intercept, given by $(\\min(P_{\\max}, S/e^{\\mathrm{reg}}), 0)$.\n    - The $c$-axis intercept, given by $(0, \\min(P_{\\max}, S/e^{\\mathrm{cont}}))$.\n    - The intersection of the two main constraint lines, $r + c = P_{\\max}$ and $e^{\\mathrm{reg}} r + e^{\\mathrm{cont}} c = S$. This point is a vertex only if both its coordinates are non-negative.\n3.  Evaluate the objective function $Z(r, c)$ at each of these vertices.\n4.  The optimal solution $(r^{\\star}, c^{\\star})$ is the vertex that yields the maximum objective function value. If all marginal profits are non-positive, the optimum is $(0, 0)$. The implemented algorithm finds the maximum among all vertices, which correctly handles all cases.\nThis procedure is applied to each test case to determine its optimal capacity allocation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the battery co-optimization problem for a given set of test cases.\n    \"\"\"\n    # Test cases: (P_max, S, eta, c_deg, pi_reg, pi_cont, gamma, p, d, e_reg, e_cont)\n    test_cases = [\n        # Case 1: happy path, power-limited to regulation\n        (100.0, 40.0, 0.9, 10.0, 30.0, 15.0, 0.5, 0.1, 0.25, 0.2, 0.25),\n        # Case 2: energy binding with negative regulation margin, contingency preferred\n        (100.0, 40.0, 0.9, 40.0, 30.0, 15.0, 0.5, 0.1, 0.25, 0.2, 0.5),\n        # Case 3: strongly energy-limited, contingency more valuable\n        (100.0, 10.0, 0.9, 10.0, 20.0, 25.0, 0.5, 0.1, 0.25, 0.25, 0.3),\n        # Case 4: both margins negative, zero solution\n        (100.0, 40.0, 0.9, 300.0, 20.0, 10.0, 0.5, 0.1, 0.25, 0.2, 0.25),\n    ]\n\n    results = []\n    # Use a small tolerance for floating point comparisons\n    TOL = 1e-9\n\n    for case in test_cases:\n        P_max, S, eta, c_deg, pi_reg, pi_cont, gamma, p, d, e_reg, e_cont = case\n\n        # 1. Calculate net marginal profits (m_reg, m_cont)\n        # Throughput is proportional to x * (1 + 1/eta)\n        throughput_factor = 1.0 + 1.0 / eta\n        \n        # Specific throughput for regulation (MWh/MW)\n        tau_reg = gamma * throughput_factor\n        # Specific throughput for contingency (MWh/MW)\n        tau_cont = p * d * throughput_factor\n        \n        # Marginal profit for regulation ($/MW)\n        m_reg = pi_reg - c_deg * tau_reg\n        # Marginal profit for contingency ($/MW)\n        m_cont = pi_cont - c_deg * tau_cont\n\n        # 2. Identify the vertices of the feasible region polygon\n        vertices = [(0.0, 0.0)]\n        \n        # r-axis intercept\n        r_intercept = P_max\n        if e_reg > TOL:\n            r_intercept = min(r_intercept, S / e_reg)\n        vertices.append((r_intercept, 0.0))\n\n        # c-axis intercept\n        c_intercept = P_max\n        if e_cont > TOL:\n            c_intercept = min(c_intercept, S / e_cont)\n        vertices.append((0.0, c_intercept))\n\n        # Intersection of the two constraint lines:\n        # r + c = P_max\n        # e_reg * r + e_cont * c = S\n        if abs(e_cont - e_reg) > TOL:\n            # Solve for c: e_reg * (P_max - c) + e_cont * c = S\n            # c * (e_cont - e_reg) = S - e_reg * P_max\n            c_int = (S - e_reg * P_max) / (e_cont - e_reg)\n            r_int = P_max - c_int\n            \n            # The intersection is a valid vertex if it's in the first quadrant\n            if r_int >= -TOL and c_int >= -TOL:\n                vertices.append((max(0, r_int), max(0, c_int)))\n\n        # 3. Evaluate objective function at each vertex to find the optimum\n        max_profit = -np.inf\n        optimal_rc = (0.0, 0.0)\n\n        for r_v, c_v in vertices:\n            profit = m_reg * r_v + m_cont * c_v\n            if profit > max_profit:\n                max_profit = profit\n                optimal_rc = (r_v, c_v)\n\n        results.append(optimal_rc)\n\n    # 4. Format the final output string as specified\n    output_parts = []\n    for r_star, c_star in results:\n        # Round the final values to three decimal places\n        r_str = f\"{r_star:.3f}\"\n        c_str = f\"{c_star:.3f}\"\n        output_parts.append(f\"[{r_str},{c_str}]\")\n    \n    final_output_string = f\"[{','.join(output_parts)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world power systems are subject to significant uncertainty from variable generation and load. This final practice introduces two-stage stochastic programming as a powerful tool to manage this uncertainty, moving beyond deterministic models . You will build a model to find optimal day-ahead energy and reserve commitments that minimize *expected* total costs, considering recourse actions available in real time across different future scenarios. This exercise provides hands-on experience with an advanced technique for making robust decisions in complex environments.",
            "id": "4078378",
            "problem": "Consider a single-hour stochastic co-optimization of energy and ancillary services for a small system with $2$ conventional generators and $2$ net-load scenarios. The scheduling horizon is $1$ hour, so energy quantities in $\\mathrm{MWh}$ are numerically equal to power quantities in $\\mathrm{MW}$ for this hour. The goal is to decide first-stage day-ahead commitments and upward reserve allocations that minimize expected total cost with real-time recourse. The formulation must satisfy power balance and physical feasibility and incorporate real-time adjustments: upward regulation, downward regulation, and involuntary load shedding.\n\nUse the following fundamental bases:\n- Conservation of energy/power balance: for each scenario, total supply (after real-time adjustments) plus load shedding equals net load.\n- Expected value definition: expected total cost equals the sum over scenarios of scenario probability times scenario cost.\n- Linear marginal cost representations for energy, reserve capacity, and real-time actions.\n\nDecision variables:\n- First-stage variables for each generator $i \\in \\{1,2\\}$: scheduled energy $e_i \\, (\\mathrm{MW})$ and scheduled upward reserve capacity $r_i \\, (\\mathrm{MW})$.\n- Second-stage recourse variables for each scenario $s \\in \\{1,2\\}$ and generator $i \\in \\{1,2\\}$: upward regulation $u_{i}^{(s)} \\, (\\mathrm{MW})$, downward regulation $d_{i}^{(s)} \\, (\\mathrm{MW})$, and scenario load shedding $\\ell^{(s)} \\, (\\mathrm{MW})$.\n\nParameters (all nonnegative and scientifically plausible):\n- Generator capacities $G_i \\, (\\mathrm{MW})$.\n- Marginal energy costs $C_i \\, (\\$/\\mathrm{MWh})$.\n- Upward reserve capacity costs $A_i \\, (\\$/\\mathrm{MW}\\text{-}\\mathrm{h})$.\n- Real-time upward regulation marginal costs $U_i \\, (\\$/\\mathrm{MWh})$.\n- Real-time downward regulation marginal costs $D_i \\, (\\$/\\mathrm{MWh})$.\n- Load-shedding penalty $S \\, (\\$/\\mathrm{MWh})$.\n- Scenario loads $L^{(s)} \\, (\\mathrm{MW})$ for $s \\in \\{1,2\\}$.\n- Scenario probabilities $p^{(s)}$ such that $p^{(1)} + p^{(2)} = 1$.\n\nModel the co-optimization as a Linear Program (LP):\n- Objective: minimize expected total cost\n$$\n\\sum_{i=1}^{2} C_i \\, e_i \\;+\\; \\sum_{i=1}^{2} A_i \\, r_i \\;+\\; \\sum_{s=1}^{2} p^{(s)}\\left(\\sum_{i=1}^{2} U_i \\, u_{i}^{(s)} \\;+\\; \\sum_{i=1}^{2} D_i \\, d_{i}^{(s)} \\;+\\; S \\, \\ell^{(s)}\\right).\n$$\n- Physical feasibility constraints:\n  - For each generator $i$: $0 \\le e_i \\le G_i$, $0 \\le r_i$, and $e_i + r_i \\le G_i$.\n  - For each scenario $s$ and generator $i$: $0 \\le u_{i}^{(s)} \\le r_i$ and $0 \\le d_{i}^{(s)} \\le e_i$.\n  - For each scenario $s$: power balance\n$$\n\\sum_{i=1}^{2} e_i \\;+\\; \\sum_{i=1}^{2} u_{i}^{(s)} \\;-\\; \\sum_{i=1}^{2} d_{i}^{(s)} \\;+\\; \\ell^{(s)} \\;=\\; L^{(s)},\n$$\nwith $\\ell^{(s)} \\ge 0$.\n\nTest suite:\nProvide $3$ parameter sets that probe different facets of the problem. In each case, report the optimal first-stage commitments and reserve allocations $\\left[e_1,e_2,r_1,r_2\\right]$ in $\\mathrm{MW}$.\n\n- Case $1$ (happy path, ample capacity, nontrivial reserve trade-offs):\n  - $G_1 = 80$, $G_2 = 70$.\n  - $C_1 = 10$, $C_2 = 25$.\n  - $A_1 = 2$, $A_2 = 4$.\n  - $U_1 = 15$, $U_2 = 35$.\n  - $D_1 = 1$, $D_2 = 1$.\n  - $S = 1000$.\n  - $L^{(1)} = 90$, $L^{(2)} = 130$.\n  - $p^{(1)} = 0.6$, $p^{(2)} = 0.4$.\n\n- Case $2$ (edge case, insufficient total capacity leads to penalized shedding in the high-load scenario):\n  - $G_1 = 60$, $G_2 = 60$.\n  - $C_1 = 12$, $C_2 = 24$.\n  - $A_1 = 1$, $A_2 = 2$.\n  - $U_1 = 18$, $U_2 = 30$.\n  - $D_1 = 0.5$, $D_2 = 0.5$.\n  - $S = 2000$.\n  - $L^{(1)} = 90$, $L^{(2)} = 130$.\n  - $p^{(1)} = 0.5$, $p^{(2)} = 0.5$.\n\n- Case $3$ (boundary trade-off case, high reserve capacity costs encourage scheduling nearer the higher load and relying on downward regulation):\n  - $G_1 = 80$, $G_2 = 80$.\n  - $C_1 = 12$, $C_2 = 20$.\n  - $A_1 = 20$, $A_2 = 50$.\n  - $U_1 = 18$, $U_2 = 30$.\n  - $D_1 = 1$, $D_2 = 1$.\n  - $S = 1000$.\n  - $L^{(1)} = 95$, $L^{(2)} = 105$.\n  - $p^{(1)} = 0.5$, $p^{(2)} = 0.5$.\n\nRequired output:\n- Express $e_1$, $e_2$, $r_1$, and $r_2$ in $\\mathrm{MW}$ as floating-point numbers rounded to three decimal places.\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list enclosed in square brackets, with each case reported as its own list. For example, the output format must be\n$$\n\\left[\\left[e_1^{(1)},e_2^{(1)},r_1^{(1)},r_2^{(1)}\\right],\\left[e_1^{(2)},e_2^{(2)},r_1^{(2)},r_2^{(2)}\\right],\\left[e_1^{(3)},e_2^{(3)},r_1^{(3)},r_2^{(3)}\\right]\\right].\n$$",
            "solution": "The user has provided a well-defined problem in the domain of energy systems engineering, specifically the co-optimization of energy and ancillary services under uncertainty. The problem is formulated as a two-stage stochastic linear program for a system with $2$ generators and $2$ scenarios.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Decision Variables (First-Stage):**\n  - $e_i$: Scheduled energy for generator $i \\in \\{1,2\\}$ $(\\mathrm{MW})$.\n  - $r_i$: Scheduled upward reserve capacity for generator $i \\in \\{1,2\\}$ $(\\mathrm{MW})$.\n- **Decision Variables (Second-Stage):**\n  - $u_{i}^{(s)}$: Upward regulation for generator $i$ in scenario $s \\in \\{1,2\\}$ $(\\mathrm{MW})$.\n  - $d_{i}^{(s)}$: Downward regulation for generator $i$ in scenario $s \\in \\{1,2\\}$ $(\\mathrm{MW})$.\n  - $\\ell^{(s)}$: Load shedding in scenario $s \\in \\{1,2\\}$ $(\\mathrm{MW})$.\n- **Parameters:**\n  - $G_i$: Capacity of generator $i$ $(\\mathrm{MW})$.\n  - $C_i$: Marginal energy cost for generator $i$ $(\\$/\\mathrm{MWh})$.\n  - $A_i$: Upward reserve capacity cost for generator $i$ $(\\$/\\mathrm{MW}\\text{-}\\mathrm{h})$.\n  - $U_i$: Upward regulation marginal cost for generator $i$ $(\\$/\\mathrm{MWh})$.\n  - $D_i$: Downward regulation marginal cost for generator $i$ $(\\$/\\mathrm{MWh})$.\n  - $S$: Load shedding penalty $(\\$/\\mathrm{MWh})$.\n  - $L^{(s)}$: Net load in scenario $s$ $(\\mathrm{MW})$.\n  - $p^{(s)}$: Probability of scenario $s$, with $p^{(1)} + p^{(2)} = 1$.\n- **Objective Function:** Minimize expected total cost:\n$$ \\sum_{i=1}^{2} C_i \\, e_i \\;+\\; \\sum_{i=1}^{2} A_i \\, r_i \\;+\\; \\sum_{s=1}^{2} p^{(s)}\\left(\\sum_{i=1}^{2} U_i \\, u_{i}^{(s)} \\;+\\; \\sum_{i=1}^{2} D_i \\, d_{i}^{(s)} \\;+\\; S \\, \\ell^{(s)}\\right) $$\n- **Constraints:**\n  - $0 \\le e_i \\le G_i$ for $i \\in \\{1,2\\}$.\n  - $0 \\le r_i$ for $i \\in \\{1,2\\}$.\n  - $e_i + r_i \\le G_i$ for $i \\in \\{1,2\\}$.\n  - $0 \\le u_{i}^{(s)} \\le r_i$ for $s \\in \\{1,2\\}, i \\in \\{1,2\\}$.\n  - $0 \\le d_{i}^{(s)} \\le e_i$ for $s \\in \\{1,2\\}, i \\in \\{1,2\\}$.\n  - $\\ell^{(s)} \\ge 0$ for $s \\in \\{1,2\\}$.\n  - $\\sum_{i=1}^{2} e_i \\;+\\; \\sum_{i=1}^{2} u_{i}^{(s)} \\;-\\; \\sum_{i=1}^{2} d_{i}^{(s)} \\;+\\; \\ell^{(s)} \\;=\\; L^{(s)}$ for $s \\in \\{1,2\\}$.\n- **Test Cases:** Three distinct sets of parameters are provided.\n\n**Step 2: Validate Using Extracted Givens**\n\n- **Scientifically Grounded:** The problem is a standard, albeit simplified, formulation of a two-stage stochastic unit commitment problem, a cornerstone of modern power systems operations and planning. The concepts of day-ahead energy and reserve scheduling, real-time recourse actions (regulation), load shedding, and their associated costs are fundamental and accurately represented. The model correctly uses expected value minimization and conservation of energy (power balance).\n- **Well-Posed:** The problem is formulated as a Linear Program (LP). Given a non-empty, bounded feasible region (which is ensured by the generator capacity constraints) and a linear objective function, an optimal solution is guaranteed to exist. All terms are clearly defined.\n- **Objective:** The language is precise, mathematical, and free of subjective or ambiguous statements.\n- **Other Criteria:** The problem is self-contained, with all necessary data provided for each test case. The parameters are physically plausible and do not contain internal contradictions. It is a non-trivial optimization problem that requires balancing competing costs across different time stages and scenarios.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. It is a well-posed, scientifically sound, and objective optimization task. A complete solution will be provided.\n\n### Solution\n\nThe problem is a two-stage stochastic linear program. The first-stage decisions ($e_1, e_2, r_1, r_2$) are made \"here-and-now\" before the realization of the uncertain net load. The second-stage or recourse decisions ($u_i^{(s)}, d_i^{(s)}, \\ell^{(s)}$) are made \"wait-and-see\" for each scenario $s$ to optimally correct any imbalance between the scheduled generation and the realized load. The standard method for solving this problem is to construct its deterministic equivalent, which is a single, large linear program that encompasses all variables and constraints across all scenarios. This is the formulation provided in the problem statement.\n\nWe will solve this LP using standard numerical optimization tooling. The formulation is translated into the canonical form required by a generic LP solver:\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  c^T x \\\\\n\\text{subject to} \\quad  A_{eq} x = b_{eq} \\\\\n A_{ub} x \\le b_{ub} \\\\\n l \\le x \\le u\n\\end{aligned}\n$$\nwhere $x$ is the vector of all decision variables.\n\n**1. Decision Variable Vector**\n\nThe decision variables are ordered into a single vector $x \\in \\mathbb{R}^{14}$:\n$$\nx = [e_1, e_2, r_1, r_2, u_1^{(1)}, u_2^{(1)}, d_1^{(1)}, d_2^{(1)}, \\ell^{(1)}, u_1^{(2)}, u_2^{(2)}, d_1^{(2)}, d_2^{(2)}, \\ell^{(2)}]^T\n$$\nThe indices map as follows: $e_1 \\to 0$, $e_2 \\to 1$, $r_1 \\to 2$, $r_2 \\to 3$, $u_1^{(1)} \\to 4$, ..., $\\ell^{(2)} \\to 13$.\n\n**2. Objective Function (Cost Vector $c$)**\n\nThe objective is to minimize the sum of the first-stage costs and the expected second-stage costs. The cost vector $c \\in \\mathbb{R}^{14}$ is constructed directly from the objective function coefficients:\n$$\nc = [C_1, C_2, A_1, A_2, p^{(1)}U_1, p^{(1)}U_2, p^{(1)}D_1, p^{(1)}D_2, p^{(1)}S, p^{(2)}U_1, p^{(2)}U_2, p^{(2)}D_1, p^{(2)}D_2, p^{(2)}S]^T\n$$\n\n**3. Equality Constraints ($A_{eq}, b_{eq}$)**\n\nThe equality constraints enforce the power balance in each of the $2$ scenarios. This results in a matrix $A_{eq} \\in \\mathbb{R}^{2 \\times 14}$ and a vector $b_{eq} \\in \\mathbb{R}^{2}$.\n\n- **Scenario 1 Balance:** $\\sum_{i=1}^{2} e_i + \\sum_{i=1}^{2} u_{i}^{(1)} - \\sum_{i=1}^{2} d_{i}^{(1)} + \\ell^{(1)} = L^{(1)}$\n  This corresponds to the first row of $A_{eq}$, with coefficients of $1$ for $e_1, e_2, u_1^{(1)}, u_2^{(1)}, \\ell^{(1)}$ and $-1$ for $d_1^{(1)}, d_2^{(1)}$.\n- **Scenario 2 Balance:** $\\sum_{i=1}^{2} e_i + \\sum_{i=1}^{2} u_{i}^{(2)} - \\sum_{i=1}^{2} d_{i}^{(2)} + \\ell^{(2)} = L^{(2)}$\n  This corresponds to the second row of $A_{eq}$, with coefficients of $1$ for $e_1, e_2, u_1^{(2)}, u_2^{(2)}, \\ell^{(2)}$ and $-1$ for $d_1^{(2)}, d_2^{(2)}$.\n\nThe right-hand side is $b_{eq} = [L^{(1)}, L^{(2)}]^T$.\n\n**4. Inequality Constraints ($A_{ub}, b_{ub}$)**\n\nThe inequality constraints codify the physical limits of the generators and the coupling between first-stage and second-stage decisions. There are $10$ such constraints, forming a matrix $A_{ub} \\in \\mathbb{R}^{10 \\times 14}$ and a vector $b_{ub} \\in \\mathbb{R}^{10}$.\n\n- **Generator Capacity:** $e_i + r_i \\le G_i$ for $i \\in \\{1,2\\}$. (2 constraints)\n- **Upward Regulation Limit:** $u_{i}^{(s)} \\le r_i \\implies u_{i}^{(s)} - r_i \\le 0$ for $i \\in \\{1,2\\}, s \\in \\{1,2\\}$. (4 constraints)\n- **Downward Regulation Limit:** $d_{i}^{(s)} \\le e_i \\implies d_{i}^{(s)} - e_i \\le 0$ for $i \\in \\{1,2\\}, s \\in \\{1,2\\}$. (4 constraints)\n\nThe right-hand side is $b_{ub} = [G_1, G_2, 0, 0, 0, 0, 0, 0, 0, 0]^T$.\n\n**5. Variable Bounds ($l, u$)**\n\nThe bounds define the domain of each individual variable.\n\n- $0 \\le e_i \\le G_i$ for $i=1,2$.\n- All other variables are non-negative: $r_i \\ge 0$, $u_{i}^{(s)} \\ge 0$, $d_{i}^{(s)} \\ge 0$, $\\ell^{(s)} \\ge 0$.\n\nThis complete LP formulation is constructed and solved for each of the three test cases. The optimal values for the first-stage variables ($e_1, e_2, r_1, r_2$) are extracted from the solution vector $x$. The results demonstrate how the system optimally hedges against load uncertainty based on the relative costs of day-ahead scheduling, reserve procurement, and real-time adjustments.\n\n- **Case 1** has ample capacity. The key trade-off is between procuring reserve from the cheaper generator (G1), which requires reducing its cheap energy output, versus using the more expensive generator (G2) for reserve.\n- **Case 2** is constrained by total system capacity, which is less than the high-load requirement. This forces a deterministic amount of load-shedding in the high-load scenario, simplifying the trade-offs.\n- **Case 3** features very high reserve capacity costs ($A_i$). This creates an economic incentive to minimize procured reserve, potentially by scheduling energy closer to the high-load scenario and relying on cheaper downward regulation in the low-load scenario.\n\nThe implementation will construct these matrices and vectors for each case and use the `scipy.optimize.linprog` function to find the optimal solution.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the stochastic co-optimization problem for three test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Happy path\n        {\n            \"G\": np.array([80.0, 70.0]),\n            \"C\": np.array([10.0, 25.0]),\n            \"A\": np.array([2.0, 4.0]),\n            \"U\": np.array([15.0, 35.0]),\n            \"D\": np.array([1.0, 1.0]),\n            \"S\": 1000.0,\n            \"L\": np.array([90.0, 130.0]),\n            \"p\": np.array([0.6, 0.4]),\n        },\n        # Case 2: Insufficient capacity\n        {\n            \"G\": np.array([60.0, 60.0]),\n            \"C\": np.array([12.0, 24.0]),\n            \"A\": np.array([1.0, 2.0]),\n            \"U\": np.array([18.0, 30.0]),\n            \"D\": np.array([0.5, 0.5]),\n            \"S\": 2000.0,\n            \"L\": np.array([90.0, 130.0]),\n            \"p\": np.array([0.5, 0.5]),\n        },\n        # Case 3: Boundary trade-off\n        {\n            \"G\": np.array([80.0, 80.0]),\n            \"C\": np.array([12.0, 20.0]),\n            \"A\": np.array([20.0, 50.0]),\n            \"U\": np.array([18.0, 30.0]),\n            \"D\": np.array([1.0, 1.0]),\n            \"S\": 1000.0,\n            \"L\": np.array([95.0, 105.0]),\n            \"p\": np.array([0.5, 0.5]),\n        },\n    ]\n\n    all_results = []\n    \n    # Variable mapping to indices in the decision vector x:\n    # x = [e1, e2, r1, r2, u1_1, u2_1, d1_1, d2_1, l_1, u1_2, u2_2, d1_2, d2_2, l_2]\n    # Indices: 0, 1, 2,  3,  4,    5,    6,    7,    8,   9,    10,   11,   12,   13\n\n    for case_params in test_cases:\n        G, C, A, U, D, S, L, p = (\n            case_params[\"G\"],\n            case_params[\"C\"],\n            case_params[\"A\"],\n            case_params[\"U\"],\n            case_params[\"D\"],\n            case_params[\"S\"],\n            case_params[\"L\"],\n            case_params[\"p\"],\n        )\n        G1, G2 = G\n        L1, L2 = L\n        p1, p2 = p\n        C1, C2 = C\n        A1, A2 = A\n        U1, U2 = U\n        D1, D2 = D\n\n        # Objective function vector c (14 variables)\n        c = np.array([\n            C1, C2, A1, A2,          # First-stage costs\n            p1 * U1, p1 * U2, p1 * D1, p1 * D2, p1 * S, # Scenario 1 recourse costs\n            p2 * U1, p2 * U2, p2 * D1, p2 * D2, p2 * S, # Scenario 2 recourse costs\n        ])\n\n        # Equality constraints A_eq * x = b_eq (2 constraints for power balance)\n        A_eq = np.zeros((2, 14))\n        # Scenario 1: e1+e2 + u1_1+u2_1 - d1_1-d2_1 + l_1 = L1\n        A_eq[0, [0, 1, 4, 5, 8]] = 1\n        A_eq[0, [6, 7]] = -1\n        # Scenario 2: e1+e2 + u1_2+u2_2 - d1_2-d2_2 + l_2 = L2\n        A_eq[1, [0, 1, 9, 10, 13]] = 1\n        A_eq[1, [11, 12]] = -1\n        b_eq = np.array([L1, L2])\n\n        # Inequality constraints A_ub * x = b_ub (10 constraints)\n        A_ub = np.zeros((10, 14))\n        # e1 + r1 = G1\n        A_ub[0, [0, 2]] = 1\n        # e2 + r2 = G2\n        A_ub[1, [1, 3]] = 1\n        # u1_1 - r1 = 0\n        A_ub[2, [4, 2]] = [1, -1]\n        # u2_1 - r2 = 0\n        A_ub[3, [5, 3]] = [1, -1]\n        # u1_2 - r1 = 0\n        A_ub[4, [9, 2]] = [1, -1]\n        # u2_2 - r2 = 0\n        A_ub[5, [10, 3]] = [1, -1]\n        # d1_1 - e1 = 0\n        A_ub[6, [6, 0]] = [1, -1]\n        # d2_1 - e2 = 0\n        A_ub[7, [7, 1]] = [1, -1]\n        # d1_2 - e1 = 0\n        A_ub[8, [11, 0]] = [1, -1]\n        # d2_2 - e2 = 0\n        A_ub[9, [12, 1]] = [1, -1]\n        \n        b_ub = np.array([G1, G2, 0, 0, 0, 0, 0, 0, 0, 0])\n\n        # Bounds for each variable\n        bounds = [\n            (0, G1), (0, G2),      # e1, e2\n            (0, None), (0, None), # r1, r2\n            (0, None), (0, None), # u1_1, u2_1\n            (0, None), (0, None), # d1_1, d2_1\n            (0, None),            # l_1\n            (0, None), (0, None), # u1_2, u2_2\n            (0, None), (0, None), # d1_2, d2_2\n            (0, None),            # l_2\n        ]\n\n        # Solve the linear program\n        res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n        if res.success:\n            # Extract first-stage variables [e1, e2, r1, r2]\n            e1, e2, r1, r2 = res.x[0:4]\n            # Format to 3 decimal places\n            case_result = [f\"{val:.3f}\" for val in [e1, e2, r1, r2]]\n            all_results.append(f\"[{','.join(case_result)}]\")\n        else:\n            # This should not happen for this well-posed problem\n            all_results.append(\"['error','error','error','error']\")\n    \n    # Final print statement in the exact required format\n    print(f\"[{','.join(all_results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}