{
    "hands_on_practices": [
        {
            "introduction": "At the heart of any capacity market is the fundamental need to quantify the reliability of a power system. This process begins with understanding the probability of generation resources being unavailable when needed. This first hands-on practice  establishes this foundation by guiding you through the calculation of the Loss of Load Probability (LOLP), a cornerstone reliability metric. You will compute LOLP from first principles, comparing a precise analytical enumeration of all possible system states with a widely-used numerical approach, the Monte Carlo simulation, to solidify your understanding of the probabilistic nature of resource adequacy.",
            "id": "4074779",
            "problem": "Consider a capacity market reliability assessment for a system with $3$ generating units. Let unit $i$ have nameplate capacity $c_i$ measured in megawatts (MW) and an independent forced outage probability $p_i$ for a given hour. Define a Bernoulli random variable $X_i$ that equals $1$ if unit $i$ is online (available) and equals $0$ if unit $i$ is on forced outage during that hour. Assume independence across units. The available capacity in the hour is the random sum $S = \\sum_{i=1}^{3} c_i X_i$. The Loss of Load Probability (LOLP) for a given hourly load $L$ is defined as the probability that available capacity is strictly less than the load, that is, $P(S  L)$. In capacity market modeling, hourly LOLP is a foundational reliability metric used to inform planning reserve requirements.\n\nStarting only from the core definitions of probability for independent Bernoulli random variables and the law of total probability (no specialized shortcut formulas), compute the hourly $P(S  L)$ exactly by enumerating all availability states and verify the result via a Monte Carlo simulation that samples unit outages independently. Treat the forced outage probability $p_i$ as the probability that $X_i = 0$, so that $P(X_i = 1) = 1 - p_i$ and $P(X_i = 0) = p_i$. For the Monte Carlo verification, use at least $200{,}000$ independent hour realizations per test case with a fixed random seed $42$ to ensure reproducibility. Express all probabilities as decimals (not using the percent sign), and treat all loads and capacities in megawatts (MW).\n\nTest suite:\n- Case A (general case): $c = [500, 300, 200]$ MW, $p = [0.05, 0.10, 0.20]$, $L = 700$ MW.\n- Case B (boundary low load): $c = [500, 300, 200]$ MW, $p = [0.05, 0.10, 0.20]$, $L = 0$ MW.\n- Case C (boundary load above total capacity): $c = [500, 300, 200]$ MW, $p = [0.05, 0.10, 0.20]$, $L = 1100$ MW.\n- Case D (edge reliability mix): $c = [400, 350, 250]$ MW, $p = [0.00, 0.10, 0.80]$, $L = 850$ MW.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each entry corresponds to a test case and is itself a two-element list $[ \\text{analytical\\_LOLP}, \\text{monte\\_carlo\\_LOLP} ]$ with each value formatted as a decimal. For example, an output for two test cases would look like $[[a_1, b_1],[a_2, b_2]]$, where $a_k$ is the exact enumerated probability and $b_k$ is the Monte Carlo estimate for test case $k$.",
            "solution": "The user has provided a problem that is scientifically grounded, well-posed, and objective. It is based on fundamental principles of probability theory applied to a classic problem in power system reliability engineering, known as Loss of Load Probability (LOLP) calculation. The problem provides all necessary data and definitions, contains no contradictions, and asks for a standard, verifiable calculation using two different methods (analytical state enumeration and numerical Monte Carlo simulation). The data values are physically realistic. Therefore, the problem is valid and a solution will be provided.\n\nThe problem requires the calculation of the Loss of Load Probability (LOLP) for a power system with $3$ independent generating units. Let the set of units be indexed by $i \\in \\{1, 2, 3\\}$. For each unit $i$, we are given a nameplate capacity $c_i$ in megawatts (MW) and a forced outage probability $p_i$.\n\nThe operational status of each unit $i$ is modeled by a Bernoulli random variable $X_i$, where:\n-   $X_i = 1$ if the unit is available (online), which occurs with probability $P(X_i=1) = 1 - p_i$.\n-   $X_i = 0$ if the unit is on a forced outage (offline), which occurs with probability $P(X_i=0) = p_i$.\n\nThe units are assumed to be statistically independent. The total available capacity in the system at any given moment is the random variable $S$, defined as the sum of the capacities of the available units:\n$$S = \\sum_{i=1}^{3} c_i X_i$$\n\nThe LOLP is defined as the probability that the total available capacity $S$ is strictly less than the system load $L$.\n$$LOLP = P(S  L)$$\n\nWe will compute this value using two methods: exact calculation through state enumeration and estimation via Monte Carlo simulation.\n\n### 1. Analytical Calculation via State Enumeration\n\nThis method relies on the law of total probability. The set of all possible combinations of unit availability forms a partition of the sample space. Since there are $3$ units, and each can be in one of $2$ states (online or offline), there are $2^3 = 8$ mutually exclusive system states.\n\nA system state can be represented by a binary vector $\\mathbf{x} = (x_1, x_2, x_3)$, where $x_i \\in \\{0, 1\\}$ is a specific realization of the random variable $X_i$. Due to the independence of the units, the probability of the system being in a specific state $\\mathbf{x}$ is the product of the individual unit state probabilities:\n$$P(\\mathbf{X}=\\mathbf{x}) = P(X_1=x_1, X_2=x_2, X_3=x_3) = \\prod_{i=1}^{3} P(X_i=x_i)$$\nwhere $P(X_i=1) = 1-p_i$ and $P(X_i=0) = p_i$.\n\nFor each state $\\mathbf{x}$, the total available capacity is a deterministic value:\n$$S_{\\mathbf{x}} = \\sum_{i=1}^{3} c_i x_i$$\n\nA loss-of-load event occurs in state $\\mathbf{x}$ if $S_{\\mathbf{x}}  L$. The total LOLP is the sum of the probabilities of all such states where this condition holds:\n$$LOLP = \\sum_{\\mathbf{x} \\in \\{0,1\\}^3 \\text{ s.t. } S_{\\mathbf{x}}  L} P(\\mathbf{X}=\\mathbf{x})$$\n\nThe algorithm is as follows:\n1.  Iterate through all $8$ possible states $\\mathbf{x} = (x_1, x_2, x_3)$ from $(0,0,0)$ to $(1,1,1)$.\n2.  For each state, calculate its probability, $P(\\mathbf{x}) = \\prod_{i=1}^3 (p_i)^{1-x_i} (1-p_i)^{x_i}$.\n3.  For each state, calculate the corresponding available capacity, $S_{\\mathbf{x}} = c_1 x_1 + c_2 x_2 + c_3 x_3$.\n4.  If $S_{\\mathbf{x}}  L$, add $P(\\mathbf{x})$ to a running sum for the total LOLP.\n5.  The final sum is the exact analytical LOLP.\n\n### 2. Monte Carlo Simulation\n\nThis method uses random sampling to estimate the probability. According to the Law of Large Numbers, the frequency of an event in a large number of independent trials approximates its true probability.\n\nThe algorithm is as follows:\n1.  Initialize a counter for loss-of-load events, $N_{LOL}$, to $0$.\n2.  Specify the total number of simulations, $K$. The problem mandates $K \\ge 200,000$. We will use $K = 200,000$.\n3.  Set the random number generator seed to $42$ to ensure reproducibility.\n4.  Repeat for $j=1, \\dots, K$:\n    a.  For each unit $i=1, 2, 3$, simulate its state. Generate a random number $u_i$ from a uniform distribution on $[0, 1)$. If $u_i  p_i$, the unit is on outage ($x_i^{(j)} = 0$); otherwise, it is available ($x_i^{(j)} = 1$).\n    b.  Calculate the total available capacity for this simulation (realization): $S^{(j)} = \\sum_{i=1}^{3} c_i x_i^{(j)}$.\n    c.  If $S^{(j)}  L$, increment the counter: $N_{LOL} = N_{LOL} + 1$.\n5.  The estimated LOLP is the fraction of simulations that resulted in a loss of load:\n$$\\widehat{LOLP} = \\frac{N_{LOL}}{K}$$\n\nBoth methods will be applied to each test case specified in the problem statement. The analytical method provides the exact theoretical probability, while the Monte Carlo method provides a numerical estimate that should converge to the analytical result as $K$ increases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the capacity market reliability assessment problem for all test cases.\n    \"\"\"\n    \n    # Test cases defined in the problem statement.\n    # Each case is a tuple: (capacities, outage_probabilities, load)\n    test_cases = [\n        # Case A (general case)\n        ([500, 300, 200], [0.05, 0.10, 0.20], 700),\n        # Case B (boundary low load)\n        ([500, 300, 200], [0.05, 0.10, 0.20], 0),\n        # Case C (boundary load above total capacity)\n        ([500, 300, 200], [0.05, 0.10, 0.20], 1100),\n        # Case D (edge reliability mix)\n        ([400, 350, 250], [0.00, 0.10, 0.80], 850),\n    ]\n\n    # Monte Carlo simulation parameters\n    num_simulations = 200000\n    random_seed = 42\n\n    results = []\n    for c, p, L in test_cases:\n        analytical_lolp = calculate_analytical_lolp(c, p, L)\n        mc_lolp = run_monte_carlo_simulation(c, p, L, num_simulations, random_seed)\n        results.append([analytical_lolp, mc_lolp])\n\n    # Final print statement in the exact required format.\n    # The str() of a list includes spaces, e.g., '[1.0, 2.0]', which matches the\n    # problem's example output format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_analytical_lolp(capacities, outage_probs, load):\n    \"\"\"\n    Calculates the exact LOLP by enumerating all possible availability states.\n    \n    Args:\n        capacities (list of int): List of generator capacities in MW.\n        outage_probs (list of float): List of generator forced outage probabilities.\n        load (int): System load in MW.\n    \n    Returns:\n        float: The analytically calculated LOLP.\n    \"\"\"\n    num_units = len(capacities)\n    total_lolp = 0.0\n    \n    # Iterate through all 2^n possible states using itertools.product\n    # Each state is a tuple like (1, 1, 0) where 1=online, 0=offline\n    for state_vector in itertools.product([1, 0], repeat=num_units):\n        state_prob = 1.0\n        available_capacity = 0.0\n        \n        for i in range(num_units):\n            if state_vector[i] == 1:  # Unit is online\n                state_prob *= (1 - outage_probs[i])\n                available_capacity += capacities[i]\n            else:  # Unit is offline (on outage)\n                state_prob *= outage_probs[i]\n        \n        # Check for loss of load condition\n        if available_capacity  load:\n            total_lolp += state_prob\n            \n    return total_lolp\n\ndef run_monte_carlo_simulation(capacities, outage_probs, load, num_simulations, seed):\n    \"\"\"\n    Estimates the LOLP using a Monte Carlo simulation.\n    \n    Args:\n        capacities (list of int): List of generator capacities in MW.\n        outage_probs (list of float): List of generator forced outage probabilities.\n        load (int): System load in MW.\n        num_simulations (int): The number of independent trials to run.\n        seed (int): The seed for the random number generator for reproducibility.\n    \n    Returns:\n        float: The Monte Carlo estimated LOLP.\n    \"\"\"\n    num_units = len(capacities)\n    \n    # Use NumPy's recommended random number generation interface\n    rng = np.random.default_rng(seed)\n    \n    # Convert lists to numpy arrays for vectorized operations\n    c_np = np.array(capacities)\n    p_np = np.array(outage_probs)\n\n    # Generate random numbers for all simulations and units at once\n    # Shape: (num_simulations, num_units)\n    random_samples = rng.random(size=(num_simulations, num_units))\n    \n    # Determine unit availability: 1 if online, 0 if offline\n    # A unit is online if its random sample is >= its outage probability.\n    availability_matrix = (random_samples >= p_np).astype(int)\n    \n    # Calculate available capacity for each simulation via matrix multiplication\n    # (num_simulations, num_units) @ (num_units,) -> (num_simulations,)\n    available_capacities = availability_matrix @ c_np\n    \n    # Count the number of simulations where capacity was less than load\n    loss_of_load_count = np.sum(available_capacities  load)\n    \n    # The estimated LOLP is the fraction of loss-of-load events\n    mc_lolp = loss_of_load_count / num_simulations\n    \n    return mc_lolp\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "Once reliability can be quantified, the next step is to embed this physical concept into an economic market framework. This comprehensive exercise  synthesizes the core components of a capacity market, bridging the gap between engineering reliability and market economics. You will construct a reliability-based demand curve derived from the economic Value of Lost Load (VOLL), build a supply stack from generator offers, and clear the market to discover the equilibrium capacity price, providing a complete, end-to-end view of the modeling process.",
            "id": "4074806",
            "problem": "You are to construct and analyze a stylized capacity market for resource adequacy in energy systems modeling, using a synthetic dataset of $10$ generating units. The modeling must proceed from first principles that define Unforced Capacity (UCAP), Equivalent Forced Outage Rate on Demand (EFORd), and the Capacity Outage Probability Table (COPT), and must treat capacity market demand as arising from the economic valuation of reliability.\n\nStart from the following foundational base:\n\n- The Equivalent Forced Outage Rate on Demand (EFORd) of unit $i$ is the probability $p_i \\in [0,1]$ that the unit is unavailable (on forced outage) when demanded.\n- Installed Capacity (ICAP) of unit $i$ is denoted $C_i$ in megawatts ($\\mathrm{MW}$). The Unforced Capacity (UCAP) is defined from first principles as $$\\text{UCAP}_i = C_i \\cdot (1 - p_i).$$\n- The Capacity Outage Probability Table (COPT) is the probability distribution over total system capacity outage, assuming independent Bernoulli outages of each unit: each unit $i$ either fully contributes $0$ outage with probability $(1 - p_i)$ or contributes $C_i$ outage with probability $p_i$. Let the total installed capacity be $$S = \\sum_{i=1}^{10} C_i.$$ Let the random outage capacity be $$O = \\sum_{i=1}^{10} X_i,$$ where $$X_i = \\begin{cases} C_i  \\text{with probability } p_i, \\\\ 0  \\text{with probability } 1 - p_i. \\end{cases}$$ The available capacity is $$A = S - O.$$\n- Let the peak load level be $L$ (in $\\mathrm{MW}$), and let $H$ (in hours per year) denote the number of peak hours over which adequacy risk is assessed. The Loss of Load Expectation (LOLE) at an increment of perfectly reliable capacity $Q$ (in $\\mathrm{MW}$) is defined as the expected number of hours per year with a shortfall when that increment is added to the system: $$\\text{LOLE}(Q) = H \\cdot \\mathbb{P}\\left(A + Q  L\\right) = H \\cdot \\mathbb{P}\\left(O  S - (L - Q)\\right).$$\n- Let the Value of Lost Load (VOLL) be $V$ (in $\\mathrm{\\$ / MWh}$). The willingness-to-pay for capacity at quantity $Q$ is derived by equating the marginal procurement cost to the marginal avoided outage cost. In the stylized case where adding $1$ $\\mathrm{MW}$ of perfectly reliable capacity reduces unserved energy approximately by $1$ $\\mathrm{MW}$ during each hour of shortage, the demand price function for capacity is $$P(Q) = V \\cdot \\text{LOLE}(Q),$$ yielding price in $\\mathrm{\\$ / MW\\text{-}year}$. Let an administratively set reliability standard be $\\text{LOLE}^\\star$ (in hours per year); the reliability requirement $R$ (in $\\mathrm{MW}$) is the quantity solving $$\\text{LOLE}(R) = \\text{LOLE}^\\star.$$\n\nYou are given a synthetic dataset of $10$ units:\n- Installed capacities in $\\mathrm{MW}$: $$C = [200,\\,180,\\,160,\\,140,\\,120,\\,100,\\,90,\\,80,\\,70,\\,60].$$\n- Equivalent Forced Outage Rates on Demand: $$p = [0.04,\\,0.05,\\,0.06,\\,0.07,\\,0.08,\\,0.06,\\,0.10,\\,0.12,\\,0.08,\\,0.09].$$\n- Supply offers (bids) in $\\mathrm{\\$ / MW\\text{-}year}$: $$b = [10000,\\,11000,\\,12000,\\,13000,\\,14000,\\,15000,\\,16000,\\,18000,\\,20000,\\,22000].$$\n\nTasks to implement in your program:\n\n1. Compute the Unforced Capacity for each unit using the definition $\\text{UCAP}_i = C_i \\cdot (1 - p_i)$.\n\n2. Construct the Capacity Outage Probability Table (COPT) for the outage capacity $O$, treating the $10$ unit outages as independent Bernoulli random variables with outage amounts $C_i$ and probabilities $p_i$. Use integer megawatt resolution. This is a discrete convolution over outage states:\n   - Initialize with probability mass function (PMF) over outages as $$\\mathbb{P}(O = 0) = 1.$$\n   - For each unit $i$, update the PMF: for every outage level $o$, the new PMF satisfies\n     $$\\mathbb{P}_{\\text{new}}(O = o) = \\mathbb{P}_{\\text{old}}(O = o) \\cdot (1 - p_i) + \\mathbb{P}_{\\text{old}}(O = o - C_i) \\cdot p_i,$$\n     with the understanding that $\\mathbb{P}_{\\text{old}}(O = o - C_i) = 0$ when $o - C_i  0$.\n\n3. Derive the demand curve as the function $$P(Q) = V \\cdot H \\cdot \\mathbb{P}\\left(O  S - (L - Q)\\right),$$ where $Q$ is the quantity of perfectly reliable capacity to be procured (in $\\mathrm{MW}$), $S$ is the total installed capacity, $L$ is the peak load, $H$ is the number of peak hours per year, and $V$ is the Value of Lost Load (in $\\mathrm{\\$ / MWh}$). Ensure that $P(Q)$ is computed for any $Q \\ge 0$ for the given system and load parameters.\n\n4. Run a single-price market clearing using a stepwise supply curve from the $10$ offers. Sort units by increasing bid $b_i$, accumulate UCAPs to form cumulative offered quantity levels $Q_k$, and at each level compare the marginal offer price $b_i$ to the demand price $P(Q_k)$. The cleared quantity $Q^\\star$ is the largest cumulative UCAP such that the marginal bid is less than or equal to the demand price at that quantity:\n   $$Q^\\star = \\max \\left\\{ Q_k \\,\\middle|\\, b_{\\text{marginal at }Q_k} \\le P(Q_k) \\right\\}.$$\n   The resulting capacity price is $$P^\\star = P(Q^\\star).$$\n\n5. The capacity price must be reported in $\\mathrm{\\$ / MW\\text{-}year}$ as a floating-point number.\n\nTest suite and output requirements:\n\n- Implement the following four test cases, each specified by the tuple $(V,\\,H,\\,L,\\,\\text{LOLE}^\\star,\\,\\text{EFORd override})$, where the EFORd override is either an empty instruction or a single pair $(i,\\,p_i^{\\text{new}})$ to modify the forced outage rate of unit $i$ (using $1$-based indexing) for that test case:\n  1. Case $1$: $(2000,\\,50,\\,1080,\\,3,\\,\\text{no override})$.\n  2. Case $2$: $(5000,\\,50,\\,1080,\\,3,\\,\\text{no override})$.\n  3. Case $3$: $(2000,\\,50,\\,1020,\\,3,\\,\\text{no override})$.\n  4. Case $4$: $(2000,\\,50,\\,1080,\\,3,\\,\\text{override }(1,\\,0.20))$.\n\n- For each test case, compute the resulting capacity price $P^\\star$ in $\\mathrm{\\$ / MW\\text{-}year}$ and round to two decimal places.\n\n- Final output format: Your program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,result_3,result_4]$), where each $result_k$ is the floating-point capacity price in $\\mathrm{\\$ / MW\\text{-}year}$ for test case $k$.\n\nAll numerical answers must be expressed in the specified units. Capacity values are in $\\mathrm{MW}$, time values are in hours per year, and prices are in $\\mathrm{\\$ / MW\\text{-}year}$. Angles are not involved in this problem. Percentages must always be expressed as decimals (e.g., $0.10$ rather than $10\\%$).",
            "solution": "The problem RCM#2024â€“8A requires the construction and analysis of a stylized electricity capacity market. The solution involves calculating unforced capacity (UCAP) for a set of generating units, constructing a system-wide capacity outage probability table (COPT), deriving a demand curve based on reliability valuation, and clearing the market by finding the equilibrium point between the UCAP supply curve and the derived demand curve.\n\nThe validation of the problem statement has been completed. All givens, definitions, and constraints are scientifically grounded, formally specified, and internally consistent. The problem is well-posed and solvable. We proceed with a step-by-step solution based on first principles as laid out in the problem.\n\nFirst, we establish the base parameters for the system, which consists of $10$ generating units.\nThe Installed Capacities (ICAP) are given as a vector $C$ in units of megawatts ($\\mathrm{MW}$):\n$$C = [200,\\,180,\\,160,\\,140,\\,120,\\,100,\\,90,\\,80,\\,70,\\,60]$$\nThe Equivalent Forced Outage Rates on Demand (EFORd) are given as a vector of probabilities $p$:\n$$p = [0.04,\\,0.05,\\,0.06,\\,0.07,\\,0.08,\\,0.06,\\,0.10,\\,0.12,\\,0.08,\\,0.09]$$\nThe supply offers (bids) are provided in units of dollars per megawatt-year ($\\mathrm{\\$ / MW\\text{-}year}$):\n$$b = [10000,\\,11000,\\,12000,\\,13000,\\,14000,\\,15000,\\,16000,\\,18000,\\,20000,\\,22000]$$\n\nThe total installed capacity of the system is the sum of the individual capacities:\n$$S = \\sum_{i=1}^{10} C_i = 200+180+160+140+120+100+90+80+70+60 = 1200 \\, \\mathrm{MW}$$\n\n**Step 1: Unforced Capacity (UCAP) Calculation**\nThe Unforced Capacity, $\\text{UCAP}_i$, represents the expected available capacity of a unit, accounting for its probability of being on forced outage. It is defined by the principle that a unit's contribution to system reliability is its installed capacity derated by its unavailability.\nThe formula is:\n$$\\text{UCAP}_i = C_i \\cdot (1 - p_i)$$\nApplying this formula to each of the $10$ units yields their respective UCAP values:\n- $\\text{UCAP}_1 = 200 \\cdot (1 - 0.04) = 192.0 \\, \\mathrm{MW}$\n- $\\text{UCAP}_2 = 180 \\cdot (1 - 0.05) = 171.0 \\, \\mathrm{MW}$\n- $\\text{UCAP}_3 = 160 \\cdot (1 - 0.06) = 150.4 \\, \\mathrm{MW}$\n- $\\text{UCAP}_4 = 140 \\cdot (1 - 0.07) = 130.2 \\, \\mathrm{MW}$\n- $\\text{UCAP}_5 = 120 \\cdot (1 - 0.08) = 110.4 \\, \\mathrm{MW}$\n- $\\text{UCAP}_6 = 100 \\cdot (1 - 0.06) = 94.0 \\, \\mathrm{MW}$\n- $\\text{UCAP}_7 = 90 \\cdot (1 - 0.10) = 81.0 \\, \\mathrm{MW}$\n- $\\text{UCAP}_8 = 80 \\cdot (1 - 0.12) = 70.4 \\, \\mathrm{MW}$\n- $\\text{UCAP}_9 = 70 \\cdot (1 - 0.08) = 64.4 \\, \\mathrm{MW}$\n- $\\text{UCAP}_{10} = 60 \\cdot (1 - 0.09) = 54.6 \\, \\mathrm{MW}$\n\n**Step 2: Capacity Outage Probability Table (COPT) Construction**\nThe COPT is the probability mass function (PMF) of the total system outage capacity, denoted by the random variable $O$. It is derived by assuming that the outages of the $10$ units are independent random events. For each unit $i$, an outage of magnitude $C_i$ occurs with probability $p_i$, and an outage of $0 \\, \\mathrm{MW}$ occurs with probability $1 - p_i$. The total outage $O$ is the sum of these individual, independent random variables.\nThe PMF of $O$ is constructed iteratively via convolution. We start with a system having $0$ outage with probability $1$. Then, for each unit, we update the PMF. Let $\\mathbb{P}_k(O=o)$ be the probability of a total outage of $o \\, \\mathrm{MW}$ considering units $1$ to $k$. When adding unit $k+1$, the new PMF is calculated as:\n$$\\mathbb{P}_{k+1}(O = o) = \\mathbb{P}_{k}(O = o) \\cdot (1 - p_{k+1}) + \\mathbb{P}_{k}(O = o - C_{k+1}) \\cdot p_{k+1}$$\nThis process is repeated for all $10$ units. The possible outage states range from $0$ to $S = 1200 \\, \\mathrm{MW}$. The resulting PMF, $\\mathbb{P}(O=o)$, is an array where the index corresponds to the outage amount $o$ in megawatts. From this PMF, we can compute the complementary cumulative distribution function (CCDF), $\\mathbb{P}(O \\ge o)$, which is essential for calculating reliability metrics.\n\n**Step 3: Demand Curve Formulation**\nThe demand for capacity is not given directly but is derived from the economic value of reliability. The demand price, $P(Q)$, represents the system operator's willingness-to-pay for an additional increment of perfectly reliable capacity, $Q$. It is defined as a function of the Value of Lost Load ($V$), the number of peak hours ($H$), and the Loss of Load Expectation ($\\text{LOLE}$).\nThe LOLE for a given level of procured reliable capacity $Q$ is:\n$$\\text{LOLE}(Q) = H \\cdot \\mathbb{P}(\\text{Available Capacity} + Q  \\text{Peak Load})$$\n$$\\text{LOLE}(Q) = H \\cdot \\mathbb{P}((S-O) + Q  L) = H \\cdot \\mathbb{P}(O  S - L + Q)$$\nThe demand price function is then given by:\n$$P(Q) = V \\cdot \\text{LOLE}(Q) = V \\cdot H \\cdot \\mathbb{P}(O  S - L + Q)$$\nThe probability term $\\mathbb{P}(O  k)$ where $k = S - L + Q$ is calculated from the COPT's CCDF. Since $O$ takes integer values, $\\mathbb{P}(O  k) = \\mathbb{P}(O \\ge \\lfloor k \\rfloor + 1)$. This function $P(Q)$ forms the demand curve.\n\n**Step 4: Supply Curve and Market Clearing**\nThe supply curve for capacity is constructed by ordering the generating units by their bid prices $b_i$ from lowest to highest. This creates a stepwise supply function where each step's height is the bid price $b_i$ and its width is the unit's UCAP$_i$.\nThe market clears at the intersection of this supply curve and the demand curve $P(Q)$. The cleared quantity, $Q^\\star$, is the maximum cumulative UCAP at which the marginal offer price is less than or equal to the demand price at that quantity. Formally, if the units are indexed $j_1, j_2, \\ldots, j_{10}$ such that $b_{j_1} \\le b_{j_2} \\le \\ldots$, and the cumulative UCAP is $Q_k = \\sum_{m=1}^{k} \\text{UCAP}_{j_m}$, then:\n$$Q^\\star = \\max \\left\\{ Q_k \\,\\middle|\\, b_{j_k} \\le P(Q_k) \\right\\}$$\nIf no units meet this condition, $Q^\\star = 0$.\nThe single market clearing price, $P^\\star$, paid to all cleared capacity, is determined by the demand price at the total cleared quantity:\n$$P^\\star = P(Q^\\star)$$\n\n**Step 5: Test Case Computation**\nThe above procedure is applied to each of the four specified test cases. For each case, the parameters $(V, H, L)$ are set, and the EFORd vector $p$ is adjusted if an override is specified. The COPT is built, the demand curve is implicitly defined, the market is cleared to find $Q^\\star$, and the final price $P^\\star$ is calculated and rounded to two decimal places. The results for the four cases will be presented in the final output. For Case 4, the EFORd of unit 1 (with $C_1 = 200 \\, \\mathrm{MW}$) is changed from $p_1 = 0.04$ to $p_1^{\\text{new}} = 0.20$. This requires re-calculating the UCAP for that unit and rebuilding the COPT for that specific test case before market clearing.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves a series of capacity market clearing problems based on a stylized reliability model.\n    \"\"\"\n\n    # Base data for the 10 generating units\n    # Installed Capacities (ICAP) in MW\n    C_base = np.array([200, 180, 160, 140, 120, 100, 90, 80, 70, 60], dtype=np.int32)\n    # Equivalent Forced Outage Rates on Demand (EFORd)\n    p_base = np.array([0.04, 0.05, 0.06, 0.07, 0.08, 0.06, 0.10, 0.12, 0.08, 0.09])\n    # Supply offers (bids) in $/MW-year\n    b_base = np.array([10000, 11000, 12000, 13000, 14000, 15000, 16000, 18000, 20000, 22000])\n\n    # Test suite: (V, H, L, LOLE_star, EFORd_override)\n    # V: Value of Lost Load ($/MWh)\n    # H: Peak hours per year\n    # L: Peak load (MW)\n    # LOLE_star: Reliability standard (h/yr) - not used in clearing, for context only\n    # EFORd_override: (unit_index_1based, new_p_value) or None\n    test_cases = [\n        (2000, 50, 1080, 3, None),\n        (5000, 50, 1080, 3, None),\n        (2000, 50, 1020, 3, None),\n        (2000, 50, 1080, 3, (1, 0.20)),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        V, H, L, _, override = case\n        \n        # Make copies of base data to allow for modification\n        C = C_base.copy()\n        p = p_base.copy()\n        b = b_base.copy()\n        \n        # Apply EFORd override if specified\n        if override:\n            unit_idx, new_p = override\n            p[unit_idx - 1] = new_p\n\n        # --- Step 1: UCAP Calculation ---\n        UCAP = C * (1 - p)\n\n        # --- Step 2: COPT Construction ---\n        S = np.sum(C) # Total installed capacity\n        \n        # Initialize PMF for outages: P(O=0) = 1\n        pmf = np.zeros(S + 1)\n        pmf[0] = 1.0\n        \n        # Iteratively convolve with each unit's outage distribution\n        for i in range(len(C)):\n            Ci = C[i]\n            pi = p[i]\n            \n            # Using a temporary array for the new PMF is conceptually clearer\n            # and safer than in-place modification.\n            prev_pmf = pmf.copy()\n            # Contribution from unit 'i' not being on outage\n            pmf = prev_pmf * (1 - pi)\n            # Contribution from unit 'i' being on outage\n            pmf[Ci:] += prev_pmf[:-Ci] * pi\n            \n        # Compute the complementary cumulative distribution function (CCDF)\n        # ccdf[k] = P(O >= k)\n        ccdf = np.cumsum(pmf[::-1])[::-1]\n\n        # --- Step 3: Demand Curve Function ---\n        def get_demand_price(Q, V_val, H_val, L_val, S_val, ccdf_val):\n            \"\"\"\n            Calculates the demand price P(Q) for a given quantity Q.\n            P(Q) = V * H * P(O > S - L + Q)\n            \"\"\"\n            outage_threshold = S_val - L_val + Q\n            \n            # P(O > k) = P(O >= floor(k) + 1)\n            # Find the index for the CCDF lookup\n            lookup_idx = int(np.floor(outage_threshold)) + 1\n            \n            prob_shortfall = 0.0\n            if lookup_idx >= len(ccdf_val):\n                prob_shortfall = 0.0\n            elif lookup_idx  0:\n                prob_shortfall = 1.0\n            else:\n                prob_shortfall = ccdf_val[lookup_idx]\n                \n            return V_val * H_val * prob_shortfall\n\n        # --- Step 4: Supply Curve and Market Clearing ---\n        # Combine unit data and sort by bid price to form the supply curve\n        # (bid, ucap, capacity)\n        supply_stack = sorted(zip(b, UCAP, C), key=lambda x: x[0])\n        \n        cleared_ucap = 0.0\n        cumulative_ucap_at_step = 0.0\n        \n        for bid_i, ucap_i, _ in supply_stack:\n            potential_cleared_ucap = cumulative_ucap_at_step + ucap_i\n            \n            # Calculate demand price at this potential cumulative quantity\n            demand_price_at_ucap = get_demand_price(\n                potential_cleared_ucap, V, H, L, S, ccdf)\n            \n            # Check clearing condition\n            if bid_i = demand_price_at_ucap:\n                # If the unit's bid is below or at the demand price, it clears\n                cleared_ucap = potential_cleared_ucap\n                cumulative_ucap_at_step = potential_cleared_ucap\n            else:\n                # This unit is the first not to clear, so we stop\n                break\n        \n        # --- Step 5: Final Price Calculation ---\n        # The clearing price is the demand price at the final cleared quantity\n        Q_star = cleared_ucap\n        P_star = get_demand_price(Q_star, V, H, L, S, ccdf)\n        \n        results.append(round(P_star, 2))\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world power systems are not monolithic \"copper plates\" but interconnected networks with physical transmission limitations. These constraints can significantly alter the reliability value of a generating resource depending on its location. This final practice  delves into this critical, advanced topic by modeling a two-zone system, allowing you to investigate how export or import constraints affect system-wide reliability. By calculating a resource's \"accreditation fraction,\" you will gain hands-on experience in quantifying the practical, location-dependent contribution of capacity in a constrained network.",
            "id": "4074729",
            "problem": "Consider a two-zone electric power system used for capacity market modeling and reliability assessment. The system comprises Zone $1$ and Zone $2$ connected by a single transmission interface with a symmetric bidirectional transfer limit of $L$ megawatts. Each zone has a set of generating units. Each generating unit $i$ has a nameplate capacity $P_i$ in megawatts and an independent forced outage rate $q_i$ (a decimal in the interval $[0,1]$). A unit is either available at its full nameplate capacity with probability $(1 - q_i)$ or unavailable (zero capacity) with probability $q_i$. Loads in Zone $1$ and Zone $2$ in hour $h$ are deterministic values $D_1(h)$ and $D_2(h)$ in megawatts. Let the expected number of hours per year that hour-state $h$ occurs be $w_h$ in hours/year. Loss of Load Expectation (LOLE) is defined as the expected number of hours per year in which any unserved load occurs anywhere in the system.\n\nStart from the following foundational principles:\n- The definition of Loss of Load Expectation (LOLE) as the expected count of hours with unserved load: for an hour-state $h$, the probability of shortage is the probability that there is no feasible power transfer $f$ satisfying both zone balances and the interface constraint, that is, $C_1 + f \\ge D_1(h)$, $C_2 - f \\ge D_2(h)$, and $-L \\le f \\le L$, where $C_1$ and $C_2$ are the random available capacities in Zone $1$ and Zone $2$ in hour $h$.\n- Independence of unit outages across all units and hours, and independence across zones.\n- Feasibility of serving load in a given hour-state is equivalent to the existence of a transfer $f$ in the interval $[-L, L]$ such that both zones meet their load constraints. Define the deficits $S_1 = D_1(h) - C_1$ and $S_2 = D_2(h) - C_2$. A feasible transfer exists if and only if the intersection $[S_1, -S_2] \\cap [-L, L]$ is non-empty.\n\nUsing these principles, derive an algorithm to compute system-level LOLE (in hours/year) by exactly enumerating the joint distributions of random available capacities $C_1$ and $C_2$ implied by the independent outage model, and checking feasibility for each hour-state and each $(C_1, C_2)$ pair.\n\nDefine the accreditation fraction for a candidate resource as follows: consider adding a resource with nameplate $P_{\\text{add}}$ and forced outage rate $q_{\\text{add}}$ either to Zone $2$ (an export-constrained zone) or, for reference, to Zone $1$. Let $\\Delta \\text{LOLE}_2$ be the reduction in LOLE from adding the resource to Zone $2$ and $\\Delta \\text{LOLE}_1$ be the reduction in LOLE from adding the same resource to Zone $1$. The accreditation fraction $\\alpha$ is the ratio $\\alpha = \\Delta \\text{LOLE}_2 / \\Delta \\text{LOLE}_1$ expressed as a decimal (unitless). This ratio captures the effective reliability value of the resource in the export-constrained zone relative to its value in the import-critical zone.\n\nYour task is to implement a program that:\n- Computes LOLE for a base system.\n- Computes LOLE after adding the candidate resource to Zone $2$.\n- Computes LOLE after adding the same candidate resource to Zone $1$.\n- Computes the accreditation fraction $\\alpha$ for each test case.\n\nScientific realism requirement: the program must strictly use the feasibility condition derived from the interface constraint and unit outage model, must not assume any simplified or heuristic reliability formula, and must perform exact enumeration of the capacity distributions consistent with the independent outage assumptions.\n\nUnits and numerical specification:\n- All capacities $P_i$, loads $D_1(h)$ and $D_2(h)$, and the interface limit $L$ must be handled in megawatts.\n- LOLE must be computed and internally handled in hours/year.\n- The final accreditation fraction $\\alpha$ must be expressed as a decimal number.\n- Round the reported accreditation fractions to three decimal places in the final output.\n\nTest suite specification. For each test case, the system is defined by:\n- Zone $1$ units given as $(P_i, q_i)$ pairs.\n- Zone $2$ units given as $(P_i, q_i)$ pairs.\n- Interface limit $L$ in megawatts.\n- Candidate added resource $(P_{\\text{add}}, q_{\\text{add}})$.\n- Load hour-states $(D_1(h), D_2(h), w_h)$.\n\nUse the following four test cases:\n\nTest case $1$ (moderate transfer, surplus export often usable):\n- Zone $1$ units: $(200, 0.1)$, $(150, 0.1)$.\n- Zone $2$ units: $(200, 0.1)$, $(100, 0.1)$.\n- Interface: $L = 150$.\n- Added resource: $(100, 0.05)$.\n- Hour-states: $(250, 80, 7800)$, $(350, 80, 800)$, $(380, 90, 160)$.\n\nTest case $2$ (export fully constrained, $L = 0$, added capacity in Zone $2$ cannot reduce system LOLE):\n- Zone $1$ units: $(200, 0.1)$, $(150, 0.1)$.\n- Zone $2$ units: $(200, 0.1)$, $(100, 0.1)$.\n- Interface: $L = 0$.\n- Added resource: $(100, 0.05)$.\n- Hour-states: $(250, 60, 8000)$, $(360, 60, 760)$.\n\nTest case $3$ (boundary-limited interface, export sometimes insufficient without added capacity):\n- Zone $1$ units: $(200, 0.1)$, $(150, 0.1)$.\n- Zone $2$ units: $(200, 0.1)$, $(100, 0.1)$.\n- Interface: $L = 100$.\n- Added resource: $(100, 0.05)$.\n- Hour-states: $(250, 120, 8300)$, $(370, 120, 460)$.\n\nTest case $4$ (export-constrained zone with high local load; added capacity mostly serves local demand):\n- Zone $1$ units: $(200, 0.1)$, $(150, 0.1)$.\n- Zone $2$ units: $(200, 0.1)$, $(100, 0.1)$.\n- Interface: $L = 150$.\n- Added resource: $(100, 0.05)$.\n- Hour-states: $(270, 180, 8500)$, $(360, 210, 260)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the accreditation fractions $\\alpha$ for the four test cases as a comma-separated list enclosed in square brackets, with each value rounded to three decimal places (for example, $[0.000,0.532,0.217,0.845]$).",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in established principles of power system reliability analysis, is well-posed with a complete and consistent set of data and definitions, and is framed in objective, formal language. The task is to compute a specific metric, the accreditation fraction, based on a clearly defined probabilistic model of generation unavailability and network constraints.\n\nThe solution proceeds by first deriving the necessary theoretical components from the foundational principles provided, and then structuring an algorithm to compute the required quantities.\n\n1.  **Modeling of Zonal Available Capacity**\n\nThe system consists of two zones, Zone $1$ and Zone $2$. Each zone contains a set of generating units. For any given unit $i$, it has a nameplate capacity $P_i$ and a forced outage rate $q_i$. The problem states that the unit is available with its full capacity $P_i$ with probability $1-q_i$, and unavailable (zero capacity) with probability $q_i$. The outages of all units are mutually independent.\n\nTo determine the total available capacity in a zone, say Zone $1$, denoted by the random variable $C_1$, we must consider all possible combinations of unit outages. This results in a probability mass function (PMF) for $C_1$, often called a Capacity Outage Probability Table (COPT). Let the units in Zone $1$ be indexed from $j=1$ to $N_1$. The PMF for $C_1$ can be constructed recursively.\n\nLet $p_j(c)$ be the PMF for unit $j$, which is $p_j(P_j) = 1-q_j$ and $p_j(0) = q_j$. The PMF for the sum of the first $k$ units, $C_{1}^{(k)} = \\sum_{j=1}^{k} C_{1,j}$, is obtained by the convolution of the PMF of $C_{1}^{(k-1)}$ and the PMF of unit $k$.\n\nAlgorithmically, we can build the COPT, which is a set of pairs $(C, \\text{Pr}(C))$, as follows:\n- Start with an initial state of zero capacity with probability $1$: $\\{(0, 1.0)\\}$.\n- For each unit $(P_i, q_i)$ in the zone:\n  - Create a new, empty COPT.\n  - For each existing capacity state $(C_{\\text{old}}, \\text{Pr}_{\\text{old}})$ in the current COPT:\n    - The new unit being unavailable (with probability $q_i$) results in a state $(C_{\\text{old}}, \\text{Pr}_{\\text{old}} \\cdot q_i)$.\n    - The new unit being available (with probability $1-q_i$) results in a state $(C_{\\text{old}} + P_i, \\text{Pr}_{\\text{old}} \\cdot (1-q_i))$.\n    - Add these new probabilities to the corresponding capacity levels in the new COPT, summing probabilities for identical capacity values.\n- Replace the old COPT with the new one.\nThis procedure is repeated for all units in the zone. Let the resulting COPTs for Zone $1$ and Zone $2$ be $\\text{COPT}_1 = \\{(C_{1,j}, \\text{Pr}(C_{1,j}))\\}$ and $\\text{COPT}_2 = \\{(C_{2,k}, \\text{Pr}(C_{2,k}))\\}$ respectively.\n\n2.  **Two-Zone Feasibility and Loss of Load**\n\nFor a given hour-state $h$, the loads are deterministic values $D_1(h)$ and $D_2(h)$. The available capacities $C_1$ and $C_2$ are random variables. A specific realization of the system state is given by a pair $(C_1, C_2)$. Since outages in the two zones are independent, the joint probability of this state is $\\text{Pr}(C_1, C_2) = \\text{Pr}(C_1) \\cdot \\text{Pr}(C_2)$.\n\nA Loss-of-Load (shortage) event occurs if it's impossible to serve the demand in both zones. According to the problem's principles, this happens when there is no feasible power transfer $f$ (from Zone $2$ to Zone $1$) that satisfies the constraints:\n$$C_1 + f \\ge D_1(h)$$\n$$C_2 - f \\ge D_2(h)$$\n$$-L \\le f \\le L$$\nThese inequalities define an interval for the required transfer $f$: $f \\in [D_1(h) - C_1, C_2 - D_2(h)]$. We define the deficits as $S_1 = D_1(h) - C_1$ and $S_2 = D_2(h) - C_2$, so the interval is $[S_1, -S_2]$. A feasible transfer must also lie in the interval $[-L, L]$ defined by the transmission limit.\n\nA feasible transfer exists if and only if the intersection of these two intervals, $[S_1, -S_2] \\cap [-L, L]$, is non-empty. A shortage occurs if this intersection is empty. The intersection of two closed intervals $[a, b]$ and $[c, d]$ is empty if and only if $b  c$ or $d  a$. In our case, this would mean $-S_2  S_1$ (which implies $C_1+C_2  D_1(h)+D_2(h)$, a system-wide capacity deficit) or that the intervals do not overlap for other reasons. A more direct condition for a non-empty intersection is $\\max(a, c) \\le \\min(b, d)$.\n\nTherefore, the condition for **no shortage** is:\n$$\\max(S_1, -L) \\le \\min(-S_2, L)$$\nSubstituting the definitions of $S_1$ and $S_2$:\n$$\\max(D_1(h) - C_1, -L) \\le \\min(C_2 - D_2(h), L)$$\nA **Loss-of-Load event occurs** if this condition is violated:\n$$\\max(D_1(h) - C_1, -L) > \\min(C_2 - D_2(h), L)$$\n\n3.  **Loss of Load Expectation (LOLE) Calculation**\n\nThe LOLE is the expected number of hours per year with a shortage. For a single hour-state $h$, the probability of shortage, $\\text{LOLP}_h$, is the sum of probabilities of all joint capacity states $(C_1, C_2)$ that cause a shortage:\n$$\\text{LOLP}_h = \\sum_{(C_1, C_2) \\text{ causing shortage}} \\text{Pr}(C_1) \\cdot \\text{Pr}(C_2)$$\nThe total system LOLE is the weighted sum of these probabilities over all hour-states, where the weights $w_h$ are the durations of each hour-state:\n$$\\text{LOLE} = \\sum_{h} w_h \\cdot \\text{LOLP}_h$$\n\nThe overall algorithm to compute LOLE is:\n- For a given system configuration (units in each zone, interface limit $L$):\n  - Compute $\\text{COPT}_1$ and $\\text{COPT}_2$.\n  - Initialize total $\\text{LOLE} = 0$.\n  - For each hour-state $(D_1(h), D_2(h), w_h)$:\n    - Initialize hour-state shortage probability $\\text{LOLP}_h = 0$.\n    - For each capacity state $(C_1, \\text{Pr}(C_1))$ in $\\text{COPT}_1$:\n      - For each capacity state $(C_2, \\text{Pr}(C_2))$ in $\\text{COPT}_2$:\n        - If $\\max(D_1(h) - C_1, -L) > \\min(C_2 - D_2(h), L)$:\n          - $\\text{LOLP}_h = \\text{LOLP}_h + \\text{Pr}(C_1) \\cdot \\text{Pr}(C_2)$.\n    - Add $w_h \\cdot \\text{LOLP}_h$ to the total $\\text{LOLE}$.\n- Return total $\\text{LOLE}$.\n\n4.  **Accreditation Fraction ($\\alpha$) Computation**\n\nThe accreditation fraction $\\alpha$ quantifies the reliability value of adding a new resource in the export-constrained Zone $2$ relative to its value in the import-critical Zone $1$. We must compute three LOLE values for each test case:\n- $\\text{LOLE}_{\\text{base}}$: LOLE of the system as initially defined.\n- $\\text{LOLE}_{\\text{Z1-add}}$: LOLE after adding the candidate resource $(P_{\\text{add}}, q_{\\text{add}})$ to Zone $1$.\n- $\\text{LOLE}_{\\text{Z2-add}}$: LOLE after adding the candidate resource $(P_{\\text{add}}, q_{\\text{add}})$ to Zone $2$.\n\nThe respective LOLE reductions are:\n$$\\Delta\\text{LOLE}_1 = \\text{LOLE}_{\\text{base}} - \\text{LOLE}_{\\text{Z1-add}}$$\n$$\\Delta\\text{LOLE}_2 = \\text{LOLE}_{\\text{base}} - \\text{LOLE}_{\\text{Z2-add}}$$\n\nThe accreditation fraction $\\alpha$ is the ratio of these reductions:\n$$\\alpha = \\frac{\\Delta\\text{LOLE}_2}{\\Delta\\text{LOLE}_1}$$\nA value of $\\alpha=1$ would imply the resource is equally effective in either zone, as in a system with no transmission constraints. A value of $\\alpha  1$ indicates that its effectiveness is diminished by being placed in the export-constrained zone, as its surplus capacity might be \"trapped\" and unable to serve load in the other zone. If $\\Delta\\text{LOLE}_1 = 0$, the ratio is only well-defined if $\\Delta\\text{LOLE}_2 = 0$, in which case $\\alpha=0$. Given the problem context, adding capacity to the import-critical Zone $1$ is expected to yield a non-zero LOLE reduction if $\\text{LOLE}_{\\text{base}} > 0$. The final result for each test case is this value $\\alpha$, rounded to three decimal places.",
            "answer": "```python\nimport numpy as np\nfrom collections import defaultdict\n\ndef get_copt(units):\n    \"\"\"\n    Computes the Capacity Outage Probability Table (COPT) for a set of generating units.\n    A unit is defined by a tuple (capacity, forced_outage_rate).\n\n    Args:\n        units (list of tuples): A list of (P_i, q_i) for each unit in the zone.\n\n    Returns:\n        dict: A dictionary mapping capacity levels to their probabilities.\n    \"\"\"\n    # Initialize COPT with a single state: 0 capacity with probability 1.0\n    copt = {0.0: 1.0}\n    for p_i, q_i in units:\n        next_copt = defaultdict(float)\n        for capacity, prob in copt.items():\n            # Case 1: The current unit is unavailable (outage)\n            # Capacity remains the same, probability is prob * q_i\n            next_copt[capacity] += prob * q_i\n            \n            # Case 2: The current unit is available\n            # Capacity increases by p_i, probability is prob * (1 - q_i)\n            next_copt[capacity + p_i] += prob * (1.0 - q_i)\n        copt = dict(next_copt)\n    return copt\n\ndef calculate_lole(units1, units2, L, hour_states):\n    \"\"\"\n    Calculates the system-wide Loss of Load Expectation (LOLE) in hours/year.\n\n    Args:\n        units1 (list): Units in Zone 1.\n        units2 (list): Units in Zone 2.\n        L (float): Bidirectional transfer limit in MW.\n        hour_states (list): Hourly load states as (D1, D2, weight_h).\n\n    Returns:\n        float: The total system LOLE in hours/year.\n    \"\"\"\n    copt1 = get_copt(units1)\n    copt2 = get_copt(units2)\n    \n    total_lole = 0.0\n    \n    for d1, d2, w_h in hour_states:\n        prob_shortage_h = 0.0\n        for c1, pr1 in copt1.items():\n            for c2, pr2 in copt2.items():\n                # A shortage occurs if no feasible transfer f exists.\n                # This is true if max(D1 - C1, -L) > min(C2 - D2, L).\n                if max(d1 - c1, -L) > min(c2 - d2, L):\n                    prob_shortage_h += pr1 * pr2\n        \n        total_lole += prob_shortage_h * w_h\n        \n    return total_lole\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and compute accreditation fractions.\n    \"\"\"\n    test_cases = [\n        {\n            \"units1\": [(200, 0.1), (150, 0.1)],\n            \"units2\": [(200, 0.1), (100, 0.1)],\n            \"L\": 150,\n            \"added_resource\": (100, 0.05),\n            \"hour_states\": [(250, 80, 7800), (350, 80, 800), (380, 90, 160)],\n        },\n        {\n            \"units1\": [(200, 0.1), (150, 0.1)],\n            \"units2\": [(200, 0.1), (100, 0.1)],\n            \"L\": 0,\n            \"added_resource\": (100, 0.05),\n            \"hour_states\": [(250, 60, 8000), (360, 60, 760)],\n        },\n        {\n            \"units1\": [(200, 0.1), (150, 0.1)],\n            \"units2\": [(200, 0.1), (100, 0.1)],\n            \"L\": 100,\n            \"added_resource\": (100, 0.05),\n            \"hour_states\": [(250, 120, 8300), (370, 120, 460)],\n        },\n        {\n            \"units1\": [(200, 0.1), (150, 0.1)],\n            \"units2\": [(200, 0.1), (100, 0.1)],\n            \"L\": 150,\n            \"added_resource\": (100, 0.05),\n            \"hour_states\": [(270, 180, 8500), (360, 210, 260)],\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        base_units1 = case[\"units1\"]\n        base_units2 = case[\"units2\"]\n        added_res = case[\"added_resource\"]\n        L_val = case[\"L\"]\n        states = case[\"hour_states\"]\n\n        # 1. Calculate LOLE for the base case\n        lole_base = calculate_lole(base_units1, base_units2, L_val, states)\n\n        # 2. Calculate LOLE with resource added to Zone 1\n        units1_plus = base_units1 + [added_res]\n        lole_z1_add = calculate_lole(units1_plus, base_units2, L_val, states)\n\n        # 3. Calculate LOLE with resource added to Zone 2\n        units2_plus = base_units2 + [added_res]\n        lole_z2_add = calculate_lole(base_units1, units2_plus, L_val, states)\n\n        # 4. Calculate LOLE reductions\n        delta_lole1 = lole_base - lole_z1_add\n        delta_lole2 = lole_base - lole_z2_add\n\n        # 5. Compute accreditation fraction alpha\n        if delta_lole1 == 0:\n            # If the reference improvement is zero, the ratio is ill-defined.\n            # If the improvement in Zone 2 is also zero, alpha is 0.\n            # Otherwise, the relative value is infinite, but this case is\n            # not expected in physically meaningful scenarios with non-zero base LOLE.\n            alpha = 0.0 if delta_lole2 == 0.0 else float('inf')\n        else:\n            alpha = delta_lole2 / delta_lole1\n            \n        results.append(f\"{alpha:.3f}\")\n\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nsolve()\n\n```"
        }
    ]
}