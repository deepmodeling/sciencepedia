## 引言
随着全球能源结构向可再生能源的深刻转型，确保[电力](@entry_id:264587)系统的长期[资源充裕性](@entry_id:1130949)已成为一项日益严峻且复杂的挑战。容量市场作为一种核心市场机制，旨在通过提供明确的经济激励，保障未来有足够的发电资源以满足峰值负荷，从而维持整个系统的可靠性。它回答了一个根本性问题：我们如何确保在十年后某个炎热夏日的午后，当空调负荷达到顶峰而风力不足时，系统仍然有足够的备用容量来避免停电？

然而，许多[电力市场](@entry_id:1124241)的设计，特别是依赖于实时能源价格的“纯能源市场”，面临着著名的“缺失的资金”问题。在这种市场中，仅在极少数的[电力](@entry_id:264587)稀缺时段出现的高昂电价，往往不足以覆盖调峰机组等关键可靠性资源的全部固定成本，这严重削弱了对这些至关重要资产的长期投资激励。本文旨在系统性地解决这一知识鸿沟，为读者提供一个关于容量市场建模的全面理论与实践框架，揭示如何通过严谨的建模来设计和评估能够有效保障长期可靠性的市场机制。

为实现这一目标，本文将分为三个紧密相连的部分展开：

*   **第一章：原理与机制** 将奠定理论基础，深入探讨可靠性背后的经济学原理和[概率论基础](@entry_id:158925)，介绍如何从单个[发电机](@entry_id:268282)组的[故障率](@entry_id:264373)构建起整个系统的可靠性模型（如COPT和LOLE），并阐明容量市场的核心经济逻辑与清算机制。

*   **第二章：应用与跨学科联系** 将理论与实践相结合，展示这些模型如何应用于可再生能源、储能和需求响应等不同资源的容量认证，如何将电网的物理约束（即可交付性）融入市场设计，以及市场规则如何影响和引导参与者的经济行为。

*   **第三章：动手实践** 将通过一系列精心设计的建模练习，引导读者将前两章学到的理论知识转化为可操作的分析技能，亲手构建容量市场的核心计算模块。

通过这一结构化的学习路径，读者将全面掌握容量市场建模的核心思想、关键技术与前沿应用，为应对未来[电力](@entry_id:264587)系统在可靠性、经济性和可持续性方面所面临的挑战做好准备。

## 原理与机制

本章深入探讨了容量市场建模的核心原理和机制，旨在为系统规划者和市场参与者提供一个严谨的分析框架。我们将从[电力系统可靠性](@entry_id:1130080)的基本概念出发，逐步构建用于量化可靠性的概率模型，并最终将这些技术模型与市场经济学原理相结合，阐释容量市场如何确保[资源充裕性](@entry_id:1130949)并确定其经济价值。

### 可靠性的经济学与[概率基础](@entry_id:187304)

[电力](@entry_id:264587)系统的根本任务是在所有时间点上精确匹配[电力](@entry_id:264587)供应与需求。然而，由于[发电机](@entry_id:268282)的随机故障和负荷的不可预测性，完美的匹配是不可能实现的。**[资源充裕性](@entry_id:1130949) (resource adequacy)** 的目标是确保拥有足够的发电容量，以将供应短缺事件的频率和规模控制在社会可接受的水平内。

#### 可靠性目标与社会福利

从经济学角度看，最优的[系统可靠性](@entry_id:274890)水平是在增加容量的成本与供应不足造成的社会损失之间取得平衡。假设容量的安装成本为 $C(K)$，这是一个随容量 $K$ 增加的凸函数。当负荷 $N$ 超过可用容量 $K$ 时，会发生能量短缺，即所谓的 **未服务能源 (unserved energy)**。这种短缺会造成巨大的经济损失，其边际价值通常用一个称为 **缺电价值 (Value of Lost Load, VOLL)** 的参数 $v$ 来衡量。

社会规划者的目标是选择最优容量 $K^*$，以最小化总社会成本，即容量成本与预期缺电成本之和：
$$
S(K) = C(K) + v \cdot \mathbb{E}[(N - K)_+]
$$
其中 $(x)_+ = \max\{x, 0\}$。通过求解该优化问题的[一阶条件](@entry_id:140702)，我们可以得到最优容量的基本经济原理 。最优容量 $K^*$ 必须满足：
$$
C'(K^*) = v \cdot P(N > K^*)
$$
这里的 $C'(K^*)$ 是在最优水平上增加单位容量的边际成本。$P(N > K^*)$ 是负荷超过容量的概率，即 **缺电概率 (Loss of Load Probability, LOLP)**。这个等式直观地表明，在最优状态下，**增加容量的边际成本应等于其带来的边际可靠性收益**。边际可靠性收益等于避免停电的价值 (VOLL) 乘以该单位容量能够避免停电的概率。

这个基本框架确立了[可靠性分析](@entry_id:192790)的核心任务：精确计算缺电概率 (LOLP) 或相关指标。

#### 定义与计算缺电期望 (LOLE)

虽然 LOLP 是一个瞬时指标，但在规划中更常用的是一个长期累计指标：**缺电期望 (Loss of Load Expectation, LOLE)**。LOLE 定义为在给定时间跨度（例如一年）内，预期发生供应短缺的总时长（通常以小时或天为单位）。

为了从第一性原理构建 LOLE，我们考虑一个包含 $H$ 个小时的规划周期。在每个小时 $h$，系统负荷 $L_h$ 和可用容量 $A_h$ 都是[随机变量](@entry_id:195330)。当 $L_h > A_h$ 时，该小时发生缺电事件。我们可以定义一个[指示变量](@entry_id:266428) $I_h$：
$$
I_h = \begin{cases} 1  \text{if } L_h > A_h \\ 0  \text{if } L_h \le A_h \end{cases}
$$
根据[期望的线性](@entry_id:273513)性质，LOLE 是所有小时[指示变量](@entry_id:266428)[期望值](@entry_id:150961)的总和，这等于所有小时缺电概率的总和：
$$
\text{LOLE} = \mathbb{E}\left[\sum_{h=1}^{H} I_h\right] = \sum_{h=1}^{H} \mathbb{E}[I_h] = \sum_{h=1}^{H} P(L_h > A_h)
$$
若已知负荷与可用容量的[联合概率密度函数](@entry_id:267139) $f_{L_h, A_h}(l, a)$，则每个小时的缺电概率可以通过对负荷大于容量的区域进行积分来计算。这为我们提供了 LOLE 的严谨数学表达式 ：
$$
\text{LOLE} = \sum_{h=1}^{H} \int_{0}^{\infty} \int_{0}^{l} f_{L_h, A_h}(l, a) \, da \, dl
$$
这个公式构成了所有[资源充裕性](@entry_id:1130949)评估的理论基石。接下来的挑战在于如何为系统的可用容量 $A_h$ 和负荷 $L_h$ 建立准确的概率模型。

### 系统容量的[概率建模](@entry_id:168598)

为了计算 LOLE，我们必须能够描述整个[发电机](@entry_id:268282)组总可用容量的概率分布。这需要从单个[发电机](@entry_id:268282)的可靠性建模开始，然后将它们聚合为系统模型。

#### 单个[发电机](@entry_id:268282)可靠性

[发电机](@entry_id:268282)的容量贡献并非其铭牌上标注的恒定数值。由于计划外（强制）停运，[发电机](@entry_id:268282)的实际可用性具有随机性。

*   **装机容量 (Installed Capacity, ICAP)**：这是[发电机](@entry_id:268282)的铭牌额定容量，代表其理论上的最大出力。

*   **等效[强迫停运率](@entry_id:1125211) (Equivalent Forced Outage Rate on demand, EFORd)**：这是一个关键的可靠性指标，衡量[发电机](@entry_id:268282)在被需要时因强迫停运而不可用的概率。它是一个条件概率，反映了[发电机](@entry_id:268282)在系统紧张、需要其贡献[电力](@entry_id:264587)时的真实表现 。

*   **无强迫停运容量 (Unforced Capacity, UCAP)**：UCAP 是对 ICAP 的一种减额，用于反映[发电机](@entry_id:268282)的不可靠性。它代表了在系统需要时，该[发电机](@entry_id:268282)的**预期可用容量**。在一个简单的两状态模型（完全可用或完全停运）中，UCAP 的推导非常直观。如果一个[发电机](@entry_id:268282)的 EFORd 为 $p$，那么它在被需要时可用的概率就是 $1-p$。因此，其预期可用容量为 ：
    $$
    \text{UCAP} = \text{ICAP} \cdot (1 - \text{EFORd})
    $$
    UCAP 是容量市场上对[发电机](@entry_id:268282)进行“认证”或“授信”的核心概念，因为它衡量的是对系统可靠性的实际期望贡献，而非理论上的最大容量。

为了更深入地理解 EFORd 等指标的来源，我们可以使用[随机过程](@entry_id:268487)进行建模。一个常见的模型是[连续时间马尔可夫链](@entry_id:267837)，它假设[发电机](@entry_id:268282)在“可用”和“停运”两个状态之间转换。从可用到停运的转换率（[故障率](@entry_id:264373)）为 $\lambda$，从停运到可用的转换率（修复率）为 $\mu$。在此模型下，可以推导出[稳态](@entry_id:139253)的**[强迫停运率](@entry_id:1125211) (Forced Outage Rate, FOR)**，即[发电机](@entry_id:268282)处于停运状态的长期时间比例 ：
$$
\text{FOR} = \frac{\lambda}{\lambda + \mu}
$$
EFORd 的概念更进一步，它考虑了在一段持续时间 $\tau$ 内的可靠性。在一个简化的模型中，我们可以将“被需要”定义为需要持续运行 $\tau$ 小时，从而将EFORd近似为[发电机](@entry_id:268282)无法完成此任务的概率。这不仅包括开始时就处于停运状态的情况，还包括开始时可用但在 $\tau$ 时间内发生故障的情况。基于此简化模型，EFORd 可以推导为 ：
$$
\text{EFORd} = 1 - \frac{\mu}{\lambda + \mu}\exp(-\lambda\tau)
$$
这个模型揭示了（在这种近似下）EFORd 不仅依赖于故障和修复率，还与系统对机组持续运行时间的要求 $\tau$ 有关。

#### 系统总可用容量聚合

在掌握了单个[发电机](@entry_id:268282)的可靠性模型后，下一步是聚合所有[发电机](@entry_id:268282)，得到整个系统总可用容量的概率分布。这个分布表被称为 **容量短缺概率表 (Capacity Outage Probability Table, COPT)**。

构建 COPT 的基本假设是各[发电机](@entry_id:268282)的停运事件是相互独立的。其核心算法是一个[递归卷积](@entry_id:754162)过程 。该过程如下：

1.  **基础情况**：从一个容量为 0、概率为 1 的系统开始（即 `dist = {0: 1.0}`）。
2.  **递归步骤**：依次将每个[发电机](@entry_id:268282)加入系统。假设我们已经有了前 $k-1$ 个[发电机](@entry_id:268282)的 COPT，现在要加入第 $k$ 个[发电机](@entry_id:268282)（容量为 $c_k$，[强迫停运率](@entry_id:1125211)为 $p_k$）。对于原 COPT 中的每一个容量状态 $C$ 及其概率 $P(C)$，新加入的[发电机](@entry_id:268282)有两种可能：
    *   **可用状态**（概率为 $1-p_k$）：系统总容量变为 $C+c_k$，此路径的概率为 $P(C) \cdot (1-p_k)$。
    *   **停运状态**（概率为 $p_k$）：系统总容量仍为 $C$，此路径的概率为 $P(C) \cdot p_k$。
3.  **合并**：将所有可能路径产生的概率相加，得到新的 COPT。例如，多个不同的[发电机](@entry_id:268282)组合可能产生相同的总可用容量，它们的概率需要累加。

通过对所有[发电机](@entry_id:268282)重复此过程，最终得到的 COPT 给出了系统所有可能的可用容量水平及其对应的发生概率。

### 从模型到可靠性指标的计算

有了系统供应侧的 COPT 模型和需求侧的负荷数据，我们就可以计算关键的可靠性指标 LOLE。通常，需求侧数据以 **[负荷持续时间曲线](@entry_id:1127380) (Load Duration Curve, LDC)** 的形式给出，该曲线将一年中所有小时的负荷从高到低排序。

计算 LOLE 的算法如下 ：

1.  对于 LDC 上的每一个小时 $h$ 的负荷值 $L_h$：
2.  计算该小时的缺电概率 (LOLP)。这通过查询 COPT 完成：将 COPT 中所有可用容量水平 $C$ 严格小于 $L_h$ 的对应概率相加。
    $$
    \text{LOLP}_h = P(\text{可用容量}  L_h) = \sum_{C  L_h} P(\text{可用容量} = C)
    $$
3.  将所有小时的 LOLP 值相加，得到整个周期的 LOLE。
    $$
    \text{LOLE} = \sum_{h=1}^{H} \text{LOLP}_h
    $$
这个计算过程将供应侧的随机性和需求侧的时间分布结合起来，为衡量系统是否满足其可靠性目标（例如，常见的“10年1天”标准，约等于 LOLE 为 2.4 小时/年）提供了量化依据。

### 容量市场的经济学原理

虽然可靠性模型告诉我们*需要*多少容量，但它们没有说明如何激励市场主体投资和维护这些容量。这就是容量市场的经济学有用武之地。

#### “缺失的资金”问题

在传统的**纯能源市场 (energy-only market)** 中，[发电机](@entry_id:268282)仅通过出售电能获得收入。在大多数时间里，市场价格由边际成本较低的机组决定，导致价格较低。只有在系统容量紧张、接近供应极限时，价格才会飙升至非常高的水平（理论上接近 VOLL）。对于很少运行的**尖峰负荷机组 (peaker)** 而言，它们的大部分乃至全部利润都必须在这些稀少的“稀缺时段”内赚取。

“**缺失的资金” (missing money)** 问题指出，由于市场价格上限、运行者规避风险的行为或市场设计缺陷，纯能源市场中的稀缺电价可能不足以让尖峰机组收回其全部固定成本（包括投资和固定运维费用）。如果这些机组无法实现收支平衡，它们就不会进入市场或选择退役，从而损害系统长期可靠性。

为了量化“缺失的资金”，我们需要比较[发电机](@entry_id:268282)的成本和预期收入。

*   **新进入者成本 (Cost of New Entry, CONE)**：代表一个边际新建机组（通常是尖峰燃气轮机）的总年化成本，包括其资本投资的年化值和年度固定运维成本 。资本投资的年化通常使用**资本回收因子 (Capital Recovery Factor, CRF)** 计算，该因子将一笔前期投资转换为在资产生命周期内的一系列等额年度付款。
    $$
    \text{CONE} = (\text{总投资成本} \cdot \text{CRF}) + \text{年度固定运维成本}
    $$
*   **净新进入者成本 (Net CONE)**：这是 CONE 扣除该机组预期从能源和[辅助服务](@entry_id:1121004)市场获得的净收入后的部分。Net CONE 代表了需要通过其他机制（即容量市场）来弥补的资金缺口。
    $$
    \text{Net CONE} = \text{CONE} - \text{预期能源与辅助服务净收入}
    $$

我们可以通过一个具体的模型来估算纯能源市场中的预期稀缺收入，并计算“缺失的资金” 。假设稀缺电价由**[运行备用](@entry_id:1129146)需求曲线 (Operating Reserve Demand Curve, ORDC)** 决定，价格会随着备用容量的减少而升高。通过对稀缺时段内备用水平的概率分布进行积分，可以计算出[发电机](@entry_id:268282)在这些时段的预期小时收入。将其乘以年预期稀缺小时数，便得到年度稀缺收入。将此收入与 Net CONE 比较，即可量化“缺失的资金”，从而证明设立容量市场的必要性。

### 容量市场的清算机制

容量市场通过直接为可用容量付费，为[发电机](@entry_id:268282)提供了除能源市场之外的第二条收入来源，从而解决了“缺失的资金”问题。其核心机制是一个集中清算过程，旨在以最低成本满足系统的可靠性目标。

#### 容量需求曲线

容量市场的需求方是整个系统，其“[支付意愿](@entry_id:919482)”源于维持可靠性所带来的社会福利。我们可以将可靠性目标转化为一条**倾斜的容量需求曲线 (sloped capacity demand curve)**。这条曲线上的每一点 $(K, p(K))$ 代表：为了获得 $K$ 的总容量，市场愿意支付的最高价格是 $p(K)$。

这个价格 $p(K)$ 等于增加一单位容量所带来的边际可靠性收益，即它能减少的预期缺电成本 。其数学表达式为：
$$
p(K) = -V \cdot \bar{u} \cdot \frac{d\text{LOLE}(K)}{dK}
$$
其中 $\bar{u}$ 是缺电期间的平均缺电功率。此公式表明，容量越少，LOLE 对容量变化的敏感度越高，从而导致容量价格越高。这条需求曲线的**价格弹性**与 LOLE [函数的曲率](@entry_id:173664)直接相关。例如，在一个 LOLE 随容量指数衰减的常见模型 $\text{LOLE}(K) = L_0 \exp(-\beta K)$ 中，需求弹性恰好为 $-\beta K$ ，这为市场设计者提供了一个分析工具。

#### 集中清算模型

容量市场的供给方是所有愿意提供容量的[发电机](@entry_id:268282)，它们根据自己的成本提交报价，形成一条总供给曲线。独立系统运营商 (ISO) 的任务是进行集中清算，以最小化总采购成本，同时确保采购的总容量 $X$ 满足预先设定的可靠性要求 $R$（例如，通过 LOLE 计算得出的目标容量）。

这个清算问题可以被表述为一个标准的[凸优化](@entry_id:137441)问题 ：
$$
\min_{X} \quad \int_{0}^{X} c(u) \, du
$$
约束条件为：
$$
X \ge R, \quad X \le K_{\text{max}}, \quad X \ge 0
$$
其中 $c(u)$ 是边际采购成本（供给曲线），$R$ 是最低可靠性要求，$K_{\text{max}}$ 是市场上可供的总容量。

通过求解此问题的 **[Karush-Kuhn-Tucker](@entry_id:634966) (KKT)** 条件，我们可以得到[市场出清价格](@entry_id:144985)。KKT 条件中的**对偶变量（或[拉格朗日乘子](@entry_id:142696)）** 具有清晰的经济学含义：与可靠性约束 $X \ge R$ 相关联的对偶变量 $\lambda_R$ 正是该约束的“影子价格”。它衡量了如果将可靠性要求 $R$ 提高一个单位，总采购成本会增加多少。

在一个典型的、非稀缺的出清场景中，系统采购的容量恰好等于可靠性要求，即 $X^* = R$。此时，[市场出清价格](@entry_id:144985)就等于在 $R$ 这一点的边际采购成本，即 $\lambda_R^* = c(R)$。例如，如果边际成本曲线是线性的 $c(x) = \alpha + \beta x$，那么出清价格就是 $\alpha + \beta R$ 。这个价格将支付给所有中标的容量提供者，确保系统获得了满足其长期可靠性目标所需的资源，并为这些资源的提供者提供了必要的收入。