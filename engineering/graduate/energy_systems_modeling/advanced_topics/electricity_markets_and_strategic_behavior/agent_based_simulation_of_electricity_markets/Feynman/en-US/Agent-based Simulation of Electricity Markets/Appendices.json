{
    "hands_on_practices": [
        {
            "introduction": "At the core of any agent-based electricity market simulation is the price formation mechanism. This exercise models the role of the Independent System Operator (ISO) agent, who must aggregate supply offers from individual generator agents to construct a market-wide supply curve. By solving for the intersection of aggregate supply and demand, you will determine the uniform market-clearing price, a fundamental process in simulating competitive wholesale markets. ",
            "id": "4068982",
            "problem": "Consider a stylized agent-based wholesale electricity market operated by an Independent System Operator (ISO), in which $3$ generator agents submit continuous quantity offers as functions of the market price $p$ under a uniform-price auction. Each generator $i \\in \\{1,2,3\\}$ has a capacity constraint $\\bar{q}_{i}$ and an offer curve defined by the nondecreasing mapping $q_{i}(p)$ from price to offered quantity. The ISO aggregates these offers into a supply function $S(p)=\\sum_{i=1}^{3} q_{i}(p)$ and sets the clearing price $p^{\\ast}$ according to the standard market clearing rule for perfectly inelastic demand: choose the lowest price $p^{\\ast}$ such that $S(p^{\\ast}) \\geq D$, where $D$ is the fixed demand.\n\nAssume the following structural specifications reflecting simple marginal-cost-driven offers with capacity limits and a reservation price:\n- For each generator $i$, the offer curve is $q_{i}(p) = \\max\\{\\,0,\\ \\min\\{\\,\\bar{q}_{i},\\ \\frac{p-10}{0.2}\\}\\,\\}$.\n- The capacity vector is $\\bar{q} = (50,80,120)$, where each component is measured in megawatts (MW).\n- Demand is perfectly inelastic at $D=180$ MW.\n\nStarting from the definitions of aggregated supply and the clearing rule described above, and using only the given structural form for $q_{i}(p)$ and the capacity constraints, compute:\n- The aggregate supply $S(30)$ at the price $p=30$.\n- The clearing price $p^{\\ast}$ for demand $D=180$.\n\nExpress $S(30)$ in megawatts (MW) and $p^{\\ast}$ in dollars per megawatt-hour (\\$/MWh). Provide exact values; no rounding is required.",
            "solution": "The problem requires us to compute two values for a simple wholesale electricity market: the aggregate supply at a specific price, and the market-clearing price for a given demand.\n\n**Part 1: Compute Aggregate Supply $S(30)$**\n\nThe aggregate supply $S(p)$ is the sum of the individual quantities offered by each of the $3$ generator agents: $S(p) = q_1(p) + q_2(p) + q_3(p)$. We need to evaluate this at $p=30$.\n\nThe offer curve for each generator $i$ is given by $q_{i}(p) = \\max\\{0, \\min\\{\\bar{q}_{i}, \\frac{p-10}{0.2}\\}\\}$.\nFirst, let's calculate the unconstrained quantity offered at $p=30$:\n$$ \\frac{p-10}{0.2} = \\frac{30-10}{0.2} = \\frac{20}{0.2} = 100 \\text{ MW} $$\nNow we apply the capacity constraint $\\bar{q}_i$ for each generator:\n- Generator 1 ($i=1$): $\\bar{q}_1 = 50$ MW. The offered quantity is $q_1(30) = \\min\\{50, 100\\} = 50$ MW.\n- Generator 2 ($i=2$): $\\bar{q}_2 = 80$ MW. The offered quantity is $q_2(30) = \\min\\{80, 100\\} = 80$ MW.\n- Generator 3 ($i=3$): $\\bar{q}_3 = 120$ MW. The offered quantity is $q_3(30) = \\min\\{120, 100\\} = 100$ MW.\n\nThe aggregate supply at $p=30$ is the sum of these quantities:\n$$ S(30) = q_1(30) + q_2(30) + q_3(30) = 50 + 80 + 100 = 230 \\text{ MW} $$\n\n**Part 2: Compute the Clearing Price $p^{\\ast}$**\n\nThe clearing price $p^{\\ast}$ is the lowest price at which the aggregate supply meets or exceeds the demand, $S(p^{\\ast}) \\ge D$, where $D=180$ MW. To find this, we must construct the aggregate supply curve $S(p)$.\n\nThe supply curve is piecewise linear. We first identify the prices at which each generator reaches its capacity limit. A generator $i$ hits its capacity $\\bar{q}_i$ when $\\frac{p-10}{0.2} = \\bar{q}_i$, which gives the price $p_i^{\\text{cap}} = 10 + 0.2\\bar{q}_i$.\n- Generator 1: $p_1^{\\text{cap}} = 10 + 0.2(50) = 20$ \\$/MWh.\n- Generator 2: $p_2^{\\text{cap}} = 10 + 0.2(80) = 26$ \\$/MWh.\n- Generator 3: $p_3^{\\text{cap}} = 10 + 0.2(120) = 34$ \\$/MWh.\n\nNow we define the aggregate supply curve $S(p)$ in segments based on these prices:\n1.  For $10  p \\le 20$: No generators are at capacity.\n    $S(p) = 3 \\times \\frac{p-10}{0.2} = 15p - 150$.\n    At the end of this segment, $S(20) = 15(20) - 150 = 150$ MW.\n2.  For $20  p \\le 26$: Generator 1 is at capacity (50 MW), but generators 2 and 3 are not.\n    $S(p) = 50 + 2 \\times \\frac{p-10}{0.2} = 50 + 10p - 100 = 10p - 50$.\n    At the end of this segment, $S(26) = 10(26) - 50 = 210$ MW.\n\nThe demand is $D=180$ MW. Since $S(20) = 150  180$ and $S(26) = 210 \\ge 180$, the clearing price $p^{\\ast}$ must lie in the second segment, where $20  p \\le 26$. We find $p^{\\ast}$ by setting the supply in this segment equal to demand:\n$$ S(p^{\\ast}) = 10p^{\\ast} - 50 = 180 $$\n$$ 10p^{\\ast} = 230 $$\n$$ p^{\\ast} = 23 $$\nThe clearing price is $p^{\\ast} = 23$ \\$/MWh. This value is within the segment's price range ($20  23 \\le 26$), confirming our calculation.\n\nThe two computed values are $S(30) = 230$ MW and $p^{\\ast} = 23$ \\$/MWh.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} 230  23 \\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "An agent's profitability extends beyond the day-ahead auction and into the complexities of real-time operations. This practice explores the financial consequences of deviations from scheduled production in a two-settlement market, a critical feature in realistic agent-based models. Calculating the net outcome, including imbalance charges and penalties, demonstrates how these mechanisms create financial incentives for generator agents to adhere to their commitments. ",
            "id": "4069020",
            "problem": "Consider an agent-based model of a generator participating in a two-settlement electricity market comprising a Day-Ahead Market (DAM) and a Real-Time Market (RTM). In the two-settlement design, the following foundational definitions apply: the DAM clears a scheduled production quantity at the day-ahead price, while the RTM settles any deviation between realized production and the day-ahead schedule at the real-time price. In addition, suppose the system operator applies a linear deviation penalty that is proportional to the absolute deviation magnitude. Assume a single settlement interval of duration $\\Delta t = 1$ hour so that power in megawatts corresponds numerically to energy in megawatt-hours over the interval.\n\nA generator agent commits a day-ahead quantity of $q^{DA} = 50$ megawatts and realizes $q = 45$ megawatts in real time. The day-ahead price is $\\pi^{DA} = 30$ dollars per megawatt-hour and the real-time price is $\\pi^{RT} = 60$ dollars per megawatt-hour. A deviation penalty with rate $\\gamma = 5$ dollars per megawatt-hour is assessed on the absolute deviation.\n\nUsing only the definitions of the two-settlement design and the linear deviation penalty, derive the net monetary outcome by combining the day-ahead settlement for the scheduled quantity, the real-time imbalance settlement for the deviation, and the deviation penalty. Express the final net monetary outcome in dollars as a single real number. No rounding is required.",
            "solution": "The problem asks for the net monetary outcome for a generator participating in a two-settlement electricity market, given a set of quantities, prices, and a penalty rate. First, the validity of the problem statement is assessed.\n\n### Step 1: Extract Givens\nThe data provided in the problem statement are:\n-   Scheduled day-ahead quantity: $q^{DA} = 50$ megawatts.\n-   Realized production quantity: $q = 45$ megawatts.\n-   Day-ahead market price: $\\pi^{DA} = 30$ dollars per megawatt-hour.\n-   Real-time market price: $\\pi^{RT} = 60$ dollars per megawatt-hour.\n-   Deviation penalty rate: $\\gamma = 5$ dollars per megawatt-hour.\n-   Settlement interval duration: $\\Delta t = 1$ hour.\n\nThe problem also defines the settlement mechanism:\n1.  The Day-Ahead Market (DAM) settles the scheduled quantity $q^{DA}$ at the day-ahead price $\\pi^{DA}$.\n2.  The Real-Time Market (RTM) settles the deviation from the schedule, defined as $q - q^{DA}$, at the real-time price $\\pi^{RT}$.\n3.  A linear deviation penalty is applied to the absolute magnitude of the deviation, $|q - q^{DA}|$, at a rate $\\gamma$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as the two-settlement market model with imbalance penalties is a standard and fundamental concept in power systems economics and energy systems modeling. The problem is well-posed; it provides all necessary data and definitions to calculate a unique monetary outcome. The language is objective and precise. The provided numerical values are plausible for electricity market operations. The problem is self-contained, with no contradictions or missing information. Therefore, the problem is deemed valid.\n\n### Step 3: Derivation of the Solution\nThe net monetary outcome, denoted as $M_{net}$, is the sum of the cash flows from the three components described: the day-ahead settlement, the real-time imbalance settlement, and the deviation penalty. The settlement interval duration is $\\Delta t = 1$ hour, which implies that power values in megawatts (MW) are numerically equivalent to energy values in megawatt-hours (MWh).\n\n1.  **Day-Ahead Market (DAM) Settlement:** The generator is paid for its scheduled quantity $q^{DA}$ at the day-ahead price $\\pi^{DA}$. This is a revenue stream.\n    $$M_{DA} = q^{DA} \\times \\pi^{DA}$$\n\n2.  **Real-Time Market (RTM) Imbalance Settlement:** The generator's deviation from its schedule is $\\Delta q = q - q^{DA}$. This imbalance is settled at the real-time price $\\pi^{RT}$. If the deviation is negative (under-production), this settlement represents a cost, as the generator must effectively buy back the deficit at the real-time price. If the deviation is positive (over-production), it represents additional revenue from selling surplus energy.\n    $$M_{RT} = (q - q^{DA}) \\times \\pi^{RT}$$\n\n3.  **Deviation Penalty Settlement:** A penalty is assessed on the absolute magnitude of the deviation, $|q - q^{DA}|$, at the specified rate $\\gamma$. This is always a cost to the generator.\n    $$M_{penalty} = - \\gamma \\times |q - q^{DA}|$$\n\nThe total net monetary outcome is the algebraic sum of these three components:\n$$M_{net} = M_{DA} + M_{RT} + M_{penalty}$$\nSubstituting the expressions for each component gives the general formula for the net outcome:\n$$M_{net} = (q^{DA} \\times \\pi^{DA}) + ((q - q^{DA}) \\times \\pi^{RT}) - (\\gamma \\times |q - q^{DA}|)$$\n\nNow, we substitute the given numerical values into this formula:\n-   $q^{DA} = 50$ MWh\n-   $q = 45$ MWh\n-   $\\pi^{DA} = 30 \\text{ \\$/MWh}$\n-   $\\pi^{RT} = 60 \\text{ \\$/MWh}$\n-   $\\gamma = 5 \\text{ \\$/MWh}$\n\nFirst, calculate the deviation quantity, $\\Delta q$:\n$$\\Delta q = q - q^{DA} = 45 - 50 = -5 \\text{ MWh}$$\nThe absolute deviation is:\n$$|\\Delta q| = |45 - 50| = |-5| = 5 \\text{ MWh}$$\n\nNow, calculate each settlement component:\n1.  DAM Settlement:\n    $$M_{DA} = 50 \\times 30 = 1500 \\text{ dollars}$$\n2.  RTM Imbalance Settlement:\n    $$M_{RT} = (-5) \\times 60 = -300 \\text{ dollars}$$\n3.  Deviation Penalty:\n    $$M_{penalty} = - 5 \\times 5 = -25 \\text{ dollars}$$\n\nFinally, the net monetary outcome is the sum of these values:\n$$M_{net} = 1500 + (-300) + (-25)$$\n$$M_{net} = 1500 - 300 - 25 = 1175 \\text{ dollars}$$\n\nThus, the final net monetary outcome for the generator is $1175$ dollars.",
            "answer": "$$\\boxed{1175}$$"
        },
        {
            "introduction": "Moving beyond simple reactive agents, sophisticated market participants like energy storage systems use forward-looking optimization to inform their strategy. This hands-on coding problem challenges you to implement the 'brain' of a storage agent by formulating its price arbitrage strategy as a linear program. By maximizing profit subject to physical constraints like capacity, ramp rates, and efficiency, you will directly engage with the core task of modeling strategic agent behavior. ",
            "id": "4068999",
            "problem": "Consider an Agent-Based Model (ABM) of a wholesale electricity market in which a single storage agent performs price arbitrage over a finite horizon. The storage operates over $T$ hourly periods indexed by $t \\in \\{0,1,\\dots,T-1\\}$ and observes exogenous market prices $p_t$ in dollars per megawatt-hour (\\$/MWh). The storage has energy state $e_t$ in megawatt-hour (MWh), with energy capacity $E_{\\max}$ in MWh, and chooses nonnegative charging and discharging actions $u_t^{\\text{ch}}$ and $u_t^{\\text{dis}}$ in megawatt-hour (MWh) per hour subject to ramp limits $R^{\\text{ch}}$ and $R^{\\text{dis}}$ in megawatt (MW), assuming that one hour is the time step so that MW equals MWh/hour. The round-trip efficiency is $\\eta \\in (0,1]$, which must be split symmetrically as $\\eta_{\\text{ch}} = \\sqrt{\\eta}$ and $\\eta_{\\text{dis}} = \\sqrt{\\eta}$, yielding the standard linear energy balance\n$$\ne_{t+1} = e_t + \\eta_{\\text{ch}}\\, u_t^{\\text{ch}} - \\frac{1}{\\eta_{\\text{dis}}}\\, u_t^{\\text{dis}},\n$$\nfor all $t \\in \\{0,1,\\dots,T-1\\}$, with $0 \\le e_t \\le E_{\\max}$. The storage pays $p_t$ dollars per megawatt-hour when charging and earns $p_t$ dollars per megawatt-hour when discharging. To avoid artificial terminal value effects, impose the neutrality constraint $e_T = e_0$, with given initial energy $e_0$. Assume no simultaneous charge and discharge constraint is imposed; with positive prices it is unnecessary for optimality, and the linear program will select $u_t^{\\text{ch}}$ and $u_t^{\\text{dis}}$ accordingly. The one-hour profits sum to\n$$\n\\Pi = \\sum_{t=0}^{T-1} \\big( p_t\\, u_t^{\\text{dis}} - p_t\\, u_t^{\\text{ch}} \\big),\n$$\nwhich must be maximized subject to all constraints. The decision variables are the vectors $\\{u_t^{\\text{ch}}\\}_{t=0}^{T-1}$, $\\{u_t^{\\text{dis}}\\}_{t=0}^{T-1}$, and $\\{e_t\\}_{t=0}^{T}$, with bounds $0 \\le u_t^{\\text{ch}} \\le R^{\\text{ch}}$, $0 \\le u_t^{\\text{dis}} \\le R^{\\text{dis}}$, and $0 \\le e_t \\le E_{\\max}$ except $e_0 = e_T = e_0$ fixed. Work in purely mathematical terms and implement a linear optimization that is scientifically realistic and self-consistent. Express all physical quantities with their appropriate units and compute the profit in dollars (\\$), rounded to two decimal places.\n\nYour task is to implement a complete, runnable program that solves this ramp-constrained storage arbitrage problem via linear programming for the following test suite. For each test case, the program must compute the optimal profit $\\Pi$ in dollars (\\$), rounded to two decimal places.\n\nTest suite parameter sets (each case specifies $T$, price series $\\{p_t\\}$ in \\$/MWh, $R^{\\text{ch}}$ in MW, $R^{\\text{dis}}$ in MW, round-trip efficiency $\\eta$, energy capacity $E_{\\max}$ in MWh, and initial energy $e_0$ in MWh):\n- Case $1$ (happy path, provided thumbnail): $T = 4$, prices $\\{30,10,50,40\\}$, $R^{\\text{ch}} = 25$, $R^{\\text{dis}} = 25$, $\\eta = 0.9$, $E_{\\max} = 50$, $e_0 = 0$.\n- Case $2$ (capacity-binding): $T = 4$, prices $\\{30,10,50,40\\}$, $R^{\\text{ch}} = 25$, $R^{\\text{dis}} = 25$, $\\eta = 0.9$, $E_{\\max} = 25$, $e_0 = 0$.\n- Case $3$ (no-arbitrage due to monotone decrease): $T = 4$, prices $\\{50,40,30,20\\}$, $R^{\\text{ch}} = 25$, $R^{\\text{dis}} = 25$, $\\eta = 0.9$, $E_{\\max} = 50$, $e_0 = 0$.\n- Case $4$ (negative-price exploitation): $T = 4$, prices $\\{10,-20,60,-10\\}$, $R^{\\text{ch}} = 25$, $R^{\\text{dis}} = 25$, $\\eta = 0.9$, $E_{\\max} = 50$, $e_0 = 0$.\n- Case $5$ (boundary, zero discharge capability): $T = 4$, prices $\\{30,10,50,40\\}$, $R^{\\text{ch}} = 25$, $R^{\\text{dis}} = 0$, $\\eta = 0.9$, $E_{\\max} = 50$, $e_0 = 0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots]$), where each $result_i$ is the computed optimal profit for the corresponding test case, rounded to two decimal places, and expressed in dollars (\\$).",
            "solution": "The user-provided problem is a well-posed and scientifically grounded formulation of an optimal energy storage arbitrage problem over a finite horizon. The problem is structured as a linear program (LP), a standard and appropriate methodology for this class of optimization tasks. All necessary parameters, constraints, and the objective function are clearly defined, without any internal contradictions or violations of physical principles. The problem is valid.\n\nThe task is to maximize the total profit, $\\Pi$, for a storage agent operating over a time horizon of $T$ periods. The profit function is given by:\n$$\n\\Pi = \\sum_{t=0}^{T-1} \\big( p_t\\, u_t^{\\text{dis}} - p_t\\, u_t^{\\text{ch}} \\big)\n$$\nwhere $p_t$ are the market prices, and $u_t^{\\text{ch}}$ and $u_t^{\\text{dis}}$ are the charging and discharging actions, respectively. Maximizing $\\Pi$ is equivalent to minimizing $-\\Pi$, which fits the standard form for many LP solvers.\n$$\n\\min \\sum_{t=0}^{T-1} \\big( p_t\\, u_t^{\\text{ch}} - p_t\\, u_t^{\\text{dis}} \\big)\n$$\nThis optimization is subject to a set of linear constraints governing the storage's physical and operational limits.\n\nTo solve this, we will formulate the problem in the canonical LP form:\n$$\n\\min_{\\mathbf{x}} \\mathbf{c}^T \\mathbf{x} \\quad \\text{subject to} \\quad \\mathbf{A}_{eq} \\mathbf{x} = \\mathbf{b}_{eq}, \\quad \\mathbf{l} \\le \\mathbf{x} \\le \\mathbf{u}\n$$\n\nFirst, we define the decision vector $\\mathbf{x}$. This vector comprises all decision variables for the entire horizon. A logical arrangement is to concatenate the charging actions, discharging actions, and energy states:\n$$\n\\mathbf{x} = [u_0^{\\text{ch}}, \\dots, u_{T-1}^{\\text{ch}}, u_0^{\\text{dis}}, \\dots, u_{T-1}^{\\text{dis}}, e_1, \\dots, e_T]^T\n$$\nThe energy state at time $t=0$, $e_0$, is a given parameter, not a variable. The total number of decision variables is $3T$.\n\nThe objective vector $\\mathbf{c}$ contains the cost coefficients for each variable in $\\mathbf{x}$. Based on the objective function to minimize $\\sum (p_t u_t^{\\text{ch}} - p_t u_t^{\\text{dis}})$, the vector $\\mathbf{c}$ of size $3T$ is constructed as:\n- For variables $u_t^{\\text{ch}}$ (indices $t=0, \\dots, T-1$): the coefficients are $p_t$.\n- For variables $u_t^{\\text{dis}}$ (indices $t=T, \\dots, 2T-1$): the coefficients are $-p_t$.\n- For variables $e_t$ (indices $t=2T, \\dots, 3T-1$): the coefficients are $0$, as the energy state itself does not directly contribute to the cost.\n$$\n\\mathbf{c}^T = [p_0, \\dots, p_{T-1}, -p_0, \\dots, -p_{T-1}, 0, \\dots, 0]\n$$\n\nThe equality constraints $\\mathbf{A}_{eq} \\mathbf{x} = \\mathbf{b}_{eq}$ enforce the system dynamics and terminal conditions. There are $T+1$ such constraints.\n1.  **Energy Balance ($T$ equations):** The state transition equation $e_{t+1} = e_t + \\eta_{\\text{ch}}\\, u_t^{\\text{ch}} - \\frac{1}{\\eta_{\\text{dis}}}\\, u_t^{\\text{dis}}$ must hold for each time step $t \\in \\{0, \\dots, T-1\\}$. With $\\eta_{\\text{ch}} = \\eta_{\\text{dis}} = \\sqrt{\\eta}$, we can write these as a system of linear equations.\n    - For $t=0$: $e_1 = e_0 + \\sqrt{\\eta}\\, u_0^{\\text{ch}} - \\frac{1}{\\sqrt{\\eta}}\\, u_0^{\\text{dis}}$. Rearranging places the variables on the left-hand side (LHS) and the constant $e_0$ on the right-hand side (RHS):\n    $$\n    e_1 - \\sqrt{\\eta}\\, u_0^{\\text{ch}} + \\frac{1}{\\sqrt{\\eta}}\\, u_0^{\\text{dis}} = e_0\n    $$\n    - For $t \\in \\{1, \\dots, T-1\\}$: $e_{t+1} = e_t + \\sqrt{\\eta}\\, u_t^{\\text{ch}} - \\frac{1}{\\sqrt{\\eta}}\\, u_t^{\\text{dis}}$. Rearranging gives:\n    $$\n    e_{t+1} - e_t - \\sqrt{\\eta}\\, u_t^{\\text{ch}} + \\frac{1}{\\sqrt{\\eta}}\\, u_t^{\\text{dis}} = 0\n    $$\n2.  **Terminal State ($1$ equation):** The neutrality constraint $e_T = e_0$ ensures no artificial value is extracted by depleting the storage at the end of the horizon. This is a direct linear equality on the final state variable.\n\nThese $T+1$ equations populate the matrix $\\mathbf{A}_{eq}$ (size $(T+1) \\times 3T$) and the vector $\\mathbf{b}_{eq}$ (size $T+1$).\n\nFinally, the bounds $\\mathbf{l} \\le \\mathbf{x} \\le \\mathbf{u}$ define the valid range for each decision variable.\n- **Charging Action:** $0 \\le u_t^{\\text{ch}} \\le R^{\\text{ch}}$ for $t \\in \\{0, \\dots, T-1\\}$.\n- **Discharging Action:** $0 \\le u_t^{\\text{dis}} \\le R^{\\text{dis}}$ for $t \\in \\{0, \\dots, T-1\\}$.\n- **Energy State:** $0 \\le e_t \\le E_{\\max}$ for $t \\in \\{1, \\dots, T\\}$.\n\nWith the LP fully specified by $(\\mathbf{c}, \\mathbf{A}_{eq}, \\mathbf{b}_{eq}, \\mathbf{l}, \\mathbf{u})$, a standard solver, such as `scipy.optimize.linprog`, can be employed to find the optimal decision vector $\\mathbf{x}^*$. The optimal objective value from the solver will be $-\\Pi^*$. The maximum profit is therefore $\\Pi^* = -(\\mathbf{c}^T \\mathbf{x}^*)$. The implementation will construct these matrices and vectors for each test case and solve the resulting LP to find the maximum profit.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to solve the test suite for the storage arbitrage problem.\n    \"\"\"\n    test_cases = [\n        # Case 1: T=4, prices={30,10,50,40}, R_ch=25, R_dis=25, eta=0.9, E_max=50, e_0=0\n        (4, np.array([30, 10, 50, 40]), 25, 25, 0.9, 50, 0),\n        # Case 2: T=4, prices={30,10,50,40}, R_ch=25, R_dis=25, eta=0.9, E_max=25, e_0=0\n        (4, np.array([30, 10, 50, 40]), 25, 25, 0.9, 25, 0),\n        # Case 3: T=4, prices={50,40,30,20}, R_ch=25, R_dis=25, eta=0.9, E_max=50, e_0=0\n        (4, np.array([50, 40, 30, 20]), 25, 25, 0.9, 50, 0),\n        # Case 4: T=4, prices={10,-20,60,-10}, R_ch=25, R_dis=25, eta=0.9, E_max=50, e_0=0\n        (4, np.array([10, -20, 60, -10]), 25, 25, 0.9, 50, 0),\n        # Case 5: T=4, prices={30,10,50,40}, R_ch=25, R_dis=0, eta=0.9, E_max=50, e_0=0\n        (4, np.array([30, 10, 50, 40]), 25, 0, 0.9, 50, 0),\n    ]\n\n    results = []\n    for case in test_cases:\n        profit = solve_storage_lp(*case)\n        results.append(f\"{profit:.2f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef solve_storage_lp(T, p, R_ch, R_dis, eta, E_max, e_0):\n    \"\"\"\n    Solves the storage arbitrage linear programming problem for a single case.\n\n    The decision vector x is structured as:\n    x = [u_ch_0, ..., u_ch_{T-1},  (T variables)\n         u_dis_0, ..., u_dis_{T-1}, (T variables)\n         e_1, ..., e_T]             (T variables)\n    Total variables = 3T.\n    \n    Args:\n        T (int): Number of time periods.\n        p (np.array): Price series for T periods.\n        R_ch (float): Charging ramp limit in MW.\n        R_dis (float): Discharging ramp limit in MW.\n        eta (float): Round-trip efficiency.\n        E_max (float): Energy capacity in MWh.\n        e_0 (float): Initial energy state in MWh.\n    \n    Returns:\n        float: Maximum profit in dollars.\n    \"\"\"\n    \n    # Symmetrical efficiency split\n    eta_ch = np.sqrt(eta)\n    eta_dis = np.sqrt(eta)\n\n    num_vars = 3 * T\n\n    # 1. Objective function vector c\n    # We want to maximize sum(p*u_dis - p*u_ch), which is equivalent to\n    # minimizing sum(p*u_ch - p*u_dis).\n    c = np.zeros(num_vars)\n    c[0:T] = p  # Costs for charging\n    c[T:2*T] = -p # Revenues (negative costs) for discharging\n\n    # 2. Equality constraints matrix A_eq and vector b_eq\n    # T energy balance equations + 1 terminal state equation\n    A_eq = np.zeros((T + 1, num_vars))\n    b_eq = np.zeros(T + 1)\n\n    # Populate T energy balance equations: e_{t+1} - e_t - eta_ch*u_ch_t + (1/eta_dis)*u_dis_t = 0\n    for t in range(T):\n        # Coefficient for u_ch_t\n        A_eq[t, t] = -eta_ch\n        # Coefficient for u_dis_t\n        A_eq[t, T + t] = 1/eta_dis\n        \n        if t == 0:\n            # e_1 - eta_ch*u_ch_0 + (1/eta_dis)*u_dis_0 = e_0\n            # Coefficient for e_1\n            A_eq[t, 2*T] = 1\n            b_eq[t] = e_0\n        else:\n            # e_{t+1} - e_t - ... = 0\n            # Coefficient for e_{t+1}\n            A_eq[t, 2*T + t] = 1\n            # Coefficient for e_t\n            A_eq[t, 2*T + t - 1] = -1\n            b_eq[t] = 0\n\n    # Populate terminal state constraint: e_T = e_0\n    A_eq[T, 3*T - 1] = 1  # Coefficient for e_T\n    b_eq[T] = e_0\n\n    # 3. Bounds for variables (l = x = u)\n    u_ch_bounds = [(0, R_ch)] * T\n    u_dis_bounds = [(0, R_dis)] * T\n    e_bounds = [(0, E_max)] * T\n    bounds = u_ch_bounds + u_dis_bounds + e_bounds\n\n    # Solve the linear program\n    # The 'highs' method is robust and the default in recent SciPy versions.\n    res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n    if res.success:\n        # The solver minimizes the objective function. Profit is the negative of the result.\n        max_profit = -res.fun\n        return max_profit\n    else:\n        # If optimization fails, which it shouldn't for a feasible LP, return 0.\n        # This case suggests no profitable arbitrage is possible, or the problem is ill-formulated.\n        return 0.0\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}