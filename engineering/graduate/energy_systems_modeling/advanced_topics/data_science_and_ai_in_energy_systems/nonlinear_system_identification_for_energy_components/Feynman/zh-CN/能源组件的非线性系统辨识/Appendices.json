{
    "hands_on_practices": [
        {
            "introduction": "有效的系统辨识始于精心设计的实验。输入信号必须具有“持续激励性”以揭示系统动态，但同时必须遵守严格的操作和安全限制。本练习  要求您为电池模型设计这样一个输入，旨在平衡获取丰富数据的需求与温度、荷电状态等关键约束。",
            "id": "4108722",
            "problem": "设计一个使用伪随机二进制序列（PRBS）的输入序列，以激励电池组件，用于在安全约束下进行非线性系统辨识。考虑一个单体电池，其模型由以下经过充分检验且具有物理基础的关系式描述，这些关系式源于电荷守恒和热能平衡定律。设采样间隔为 $\\Delta t$，在样本 $k$ 处的电流为 $I_k$，荷电状态为 $\\mathrm{SOC}_k$（在 $[0,1]$ 区间内的无量纲分数），温度为 $T_k$（单位为 $\\mathrm{K}$）。电荷守恒由微分方程 $\\frac{d\\,\\mathrm{SOC}}{dt} = -\\frac{I(t)}{Q}$ 给出，其中 $Q$ 是以 $\\mathrm{C}$ 为单位的容量；在离散时间中，使用前向欧拉更新 $\\mathrm{SOC}_{k+1} = \\mathrm{SOC}_k - \\frac{I_k \\Delta t}{Q}$。热平衡遵循 $C_{\\mathrm{th}} \\frac{d T}{dt} = R_h I^2(t) - h (T(t) - T_{\\mathrm{amb}})$，其中 $C_{\\mathrm{th}}$ 是以 $\\mathrm{J}/\\mathrm{K}$ 为单位的热容，$R_h$ 是以 $\\mathrm{W}/\\mathrm{A}^2$ 为单位的生热系数，$h$ 是以 $\\mathrm{W}/\\mathrm{K}$ 为单位的传热系数，$T_{\\mathrm{amb}}$ 是以 $\\mathrm{K}$ 为单位的环境温度；通过 $T_{k+1} = T_k + \\Delta t \\left( \\frac{R_h I_k^2 - h (T_k - T_{\\mathrm{amb}})}{C_{\\mathrm{th}}} \\right)$ 进行离散化。PRBS激励必须在所有时间步 $k$ 满足以下约束：(i) 幅值约束 $\\lvert I_k \\rvert \\le I_{\\max}$，(ii) 斜率约束 $\\lvert I_{k+1} - I_k \\rvert \\le S_{\\max} \\Delta t$，(iii) 荷电状态边界 $\\mathrm{SOC}_{\\min} \\le \\mathrm{SOC}_k \\le \\mathrm{SOC}_{\\max}$，以及 (iv) 温度边界 $T_k \\le T_{\\max}$。\n\n为了非线性动力学的可辨识性，需要基于测量信号为一个类多项式Hammerstein回归器评估费雪信息矩阵（FIM）。通过 $x_{k+1} = a x_k + b I_k + c I_k^2$ 定义一个辅助动态状态 $x_k$，其中 $x_0 = 0$，且 $a, b, c$ 为已知的稳定常数。在每个时间步 $k$ 构建回归向量 $\\psi_k = \\begin{bmatrix} 1 & \\mathrm{SOC}_k & \\mathrm{SOC}_k^2 & I_k & I_k^2 & x_k \\end{bmatrix}^{\\top}$，并为一个包含 $N$ 个样本的序列构建堆叠回归矩阵 $\\Psi = \\begin{bmatrix} \\psi_0^{\\top} \\\\ \\psi_1^{\\top} \\\\ \\cdots \\\\ \\psi_{N-1}^{\\top} \\end{bmatrix}$。使用归一化费雪信息矩阵 $F = \\frac{1}{N} \\Psi^{\\top} \\Psi$（假设单位测量噪声方差），并将可辨识性度量定义为最小特征值 $\\lambda_{\\min}(F)$。设计目标是生成一个具有足够持续激励性的PRBS电流序列，使得 $\\lambda_{\\min}(F)$ 超过给定阈值，同时满足安全约束。PRBS应通过一个指定阶数且具有已知抽头的线性反馈移位寄存器（LFSR）构建，以生成一个确定性比特序列，该序列被映射到设定点集合 $\\{-I_{\\max}, +I_{\\max}\\}$ 中，然后通过一个离散时间斜率限制器以生成 $I_k$。为在保持持续性的同时减轻热违规，实现一个简单的振幅包络，当 $T_k$ 超过预警阈值 $T_{\\mathrm{pre}} = T_{\\max} - \\delta_T$ 时，将设定点幅值减半，其中 $\\delta_T$ 是一个小的裕度；否则，使用完整的设定点幅值。不允许进行其他针对特定约束的自适应调整。如果在任何时间违反了任何安全约束，或者可辨识性度量 $\\lambda_{\\min}(F)$ 未超过提供的阈值 $\\gamma_{\\mathrm{th}}$，则报告失败。\n\n您的程序必须：\n- 使用一个阶数为 $p$、抽头用于反馈的LFSR来构建PRBS比特流，精确生成 $n_{\\mathrm{bits}}$ 个比特。\n- 将比特映射到电流设定点 $\\{-I_{\\max}, +I_{\\max}\\}$，应用一个振幅包络（当 $T_k \\ge T_{\\mathrm{pre}}$ 时使用半幅值，否则使用全幅值），并通过一个斜率限制器来强制执行 $\\lvert I_{k+1} - I_k \\rvert \\le S_{\\max} \\Delta t$ 和 $\\lvert I_k \\rvert \\le I_{\\max}$。\n- 使用上述离散动力学模型及初始条件 $\\mathrm{SOC}_0$ 和 $T_0$ 来仿真 $\\mathrm{SOC}_k$ 和 $T_k$。\n- 构建 $\\Psi$，计算 $F$，并且当且仅当所有约束均被满足且 $\\lambda_{\\min}(F) \\ge \\gamma_{\\mathrm{th}}$ 时，返回 $\\lambda_{\\min}(F)$；否则返回 $-1.0$。\n\n所有物理量均需统一使用国际单位制（SI），电流单位为 $\\mathrm{A}$，时间单位为 $\\mathrm{s}$，温度单位为 $\\mathrm{K}$。角度不适用。最终输出格式必须是单行，包含一个由方括号括起来的、以逗号分隔的浮点数列表。\n\n使用以下测试套件，其中每个案例指定了参数 $(\\Delta t, n_{\\mathrm{bits}}, \\text{dwell}, I_{\\max}, S_{\\max}, Q, \\mathrm{SOC}_0, \\mathrm{SOC}_{\\min}, \\mathrm{SOC}_{\\max}, C_{\\mathrm{th}}, R_h, h, T_{\\mathrm{amb}}, T_0, T_{\\max}, a, b, c, p, \\text{taps}, \\gamma_{\\mathrm{th}}, \\delta_T)$:\n- 案例 1 (正常路径，可行且信息丰富)：\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 1.0$, $I_{\\max} = 6.0$, $S_{\\max} = 3.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.15$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0005$, $\\delta_T = 2.0$。\n- 案例 2 (因高热量导致热违规，应失败)：\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 1.0$, $I_{\\max} = 8.0$, $S_{\\max} = 6.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 5.0$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 305.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0001$, $\\delta_T = 1.0$。\n- 案例 3 (因长驻留时间导致荷电状态漂移，应失败)：\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 6.0$, $I_{\\max} = 20.0$, $S_{\\max} = 100.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.49$, $\\mathrm{SOC}_{\\max} = 0.51$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.1$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0005$, $\\delta_T = 2.0$。\n- 案例 4 (低幅值，可辨识性差，应因可辨识性阈值而失败)：\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 1.0$, $I_{\\max} = 1.0$, $S_{\\max} = 3.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.15$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.001$, $\\delta_T = 2.0$。\n- 案例 5 (短驻留时间，高频激励，可行且信息丰富)：\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 0.2$, $I_{\\max} = 6.0$, $S_{\\max} = 20.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.15$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0005$, $\\delta_T = 2.0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，例如 $\\texttt{[r_1,r_2,r_3,r_4,r_5]}$，其中每个 $r_i$ 要么是当约束被满足且 $\\lambda_{\\min}(F) \\ge \\gamma_{\\mathrm{th}}$ 时计算出的浮点数 $\\lambda_{\\min}(F)$，要么是 $-1.0$。所有数字输出必须使用基本单位，不含额外文本。",
            "solution": "该问题要求为电池单元的非线性系统辨识设计并评估一个伪随机二进制序列（PRBS）输入。该过程涉及生成输入信号、仿真电池的电热响应、检查是否违反操作安全约束，以及使用费雪信息矩阵（FIM）评估所得数据的质量以用于系统辨识。具体执行的详细、分步方法如下。\n\n### 步骤 1：PRBS 生成\n激励信号的核心是由线性反馈移位寄存器（LFSR）生成的PRBS。LFSR是一种移位寄存器，其输入位是其先前状态的线性函数（具体来说是异或，XOR）。\n\n对于一个阶数为 $p$ 且具有指定抽头的LFSR，生成一个包含 $n_{\\mathrm{bits}}$ 比特序列的步骤如下：\n1.  初始化一个 $p$ 位的寄存器。使用一个标准的非零初始状态，例如全为1：$\\text{reg} = [1, 1, \\dots, 1]$。\n2.  对于要生成的 $n_{\\mathrm{bits}}$ 中的每一个比特：\n    a. 输出位是寄存器的最后一位。\n    b. 通过对`taps`数组指定位置的比特进行异或求和来计算反馈位。假设抽头是1-索引的，反馈为 $\\bigoplus_{i \\in \\text{taps}} \\text{reg}[i-1]$。\n    c. 寄存器被移位（例如，向右），并将反馈位插入到开头。\n此过程产生一个确定性的、可重复的伪随机比特序列。\n\n### 步骤 2：输入电流序列的生成与整形\n来自LFSR的原始比特流被转换为一个连续时间电流信号 $I(t)$，并经过多层整形以确保安全性和可行性。\n\n1.  **驻留时间**：PRBS序列中的每个比特保持一个恒定的持续时间，$\\text{dwell}$。给定采样时间 $\\Delta t$，每个比特对应 $m = \\text{dwell} / \\Delta t$ 个离散时间步。总仿真步数为 $N = n_{\\mathrm{bits}} \\times m$。\n\n2.  **设定点映射**：二进制序列（0和1）被映射到电流设定点。使用标准映射，其中比特0对应充电电流 $-I_{\\mathrm{set}}$，比特1对应放电电流 $+I_{\\mathrm{set}}$。\n\n3.  **温感振幅包络**：为防止过热，一个简单的反馈机制根据当前电芯温度 $T_k$ 调整电流设定点 $I_{\\mathrm{set}}$ 的幅值。预警温度阈值定义为 $T_{\\mathrm{pre}} = T_{\\max} - \\delta_T$。在每个时间步 $k$，设定点幅值按如下方式确定：\n    $$\n    I_{\\mathrm{set}, k} = \n    \\begin{cases} \n    0.5 \\times I_{\\max} & \\text{if } T_k \\ge T_{\\mathrm{pre}} \\\\\n    I_{\\max} & \\text{if } T_k  T_{\\mathrm{pre}}\n    \\end{cases}\n    $$\n    然后，在步骤 $k$ 时用于斜率限制器的目标电流（我们称之为 $I_{\\text{target}, k}$）是 $(2 \\times \\text{bit}_k - 1) \\times I_{\\mathrm{set}, k}$，其中 $\\text{bit}_k$ 是当前时间区间的PRBS比特。\n\n4.  **斜率与幅值限制**：物理执行器具有有限的响应速度。这通过一个斜率限制器来建模。连续步骤之间的电流变化受限于 $|\\Delta I| \\le S_{\\max} \\Delta t$。实际电流 $I_k$ 由前一个电流 $I_{k-1}$ 和目标电流 $I_{\\text{target}, k}$ 生成：\n    $$\n    \\Delta I_{\\text{unconstrained}} = I_{\\text{target}, k} - I_{k-1}\n    $$\n    $$\n    \\Delta I_{\\text{limited}} = \\max(-S_{\\max}\\Delta t, \\min(S_{\\max}\\Delta t, \\Delta I_{\\text{unconstrained}}))\n    $$\n    $$\n    I_k' = I_{k-1} + \\Delta I_{\\text{limited}}\n    $$\n    最后，信号被钳位以遵守绝对幅值约束 $|I_k| \\le I_{\\max}$：\n    $$\n    I_k = \\max(-I_{\\max}, \\min(I_{\\max}, I_k'))\n    $$\n\n### 步骤 3：电池状态仿真\n在输入电流序列 $\\{I_k\\}_{k=0}^{N-1}$ 完全定义后，使用提供的离散时间模型随时间仿真电池的状态变量：荷电状态（$\\mathrm{SOC}_k$）和温度（$T_k$）。\n\n- **初始条件**：仿真从给定的初始状态 $(\\mathrm{SOC}_0, T_0)$ 开始。首次斜率计算所需的初始电流 $I_{-1}$ 假定为 $0$。\n\n- **状态更新方程**：对于每个时间步 $k = 0, 1, \\dots, N-1$：\n    - 使用前向欧拉法更新SOC以满足电荷守恒：\n      $$\n      \\mathrm{SOC}_{k+1} = \\mathrm{SOC}_k - \\frac{I_k \\Delta t}{Q}\n      $$\n    - 基于热能平衡更新温度：\n      $$\n      T_{k+1} = T_k + \\frac{\\Delta t}{C_{\\mathrm{th}}} \\left( R_h I_k^2 - h (T_k - T_{\\mathrm{amb}}) \\right)\n      $$\n同时，用于回归器的辅助状态 $x_k$ 也被传播：\n    $$\n    x_{k+1} = a x_k + b I_k + c I_k^2\n    $$\n    其中 $x_0 = 0$。\n\n### 步骤 4：约束验证\n安全至上。在每个时间步监控仿真，以确保所有约束都得到满足。\n这些约束是：\n1.  $\\lvert I_k \\rvert \\le I_{\\max}$（通过输入整形强制执行）。\n2.  $\\lvert I_{k+1} - I_k \\rvert \\le S_{\\max} \\Delta t$（通过输入整形强制执行）。\n3.  $\\mathrm{SOC}_{\\min} \\le \\mathrm{SOC}_k \\le \\mathrm{SOC}_{\\max}$ 对于所有 $k \\in [0, N]$。\n4.  $T_k \\le T_{\\max}$ 对于所有 $k \\in [0, N]$。\n\n如果任何SOC或温度约束被违反，仿真将立即停止。在这种情况下，实验被视为失败。\n\n### 步骤 5：通过费雪信息矩阵进行可辨识性分析\n如果仿真在没有任何约束违规的情况下完成，则评估所收集数据的“丰富性”或“信息含量”。这对于确保模型参数能够被可靠地估计至关重要。\n\n1.  **回归矩阵构建**：在每个时间步 $k=0, \\dots, N-1$ 形成一个回归向量 $\\psi_k$：\n    $$\n    \\psi_k = \\begin{bmatrix} 1  \\mathrm{SOC}_k  \\mathrm{SOC}_k^2  I_k  I_k^2  x_k \\end{bmatrix}^{\\top}\n    $$\n    这些向量被堆叠起来形成 $N \\times 6$ 的回归矩阵 $\\Psi$：\n    $$\n    \\Psi = \\begin{bmatrix} \\psi_0^{\\top} \\\\ \\psi_1^{\\top} \\\\ \\vdots \\\\ \\psi_{N-1}^{\\top} \\end{bmatrix}\n    $$\n\n2.  **FIM 计算**：归一化的费雪信息矩阵（FIM）计算如下：\n    $$\n    F = \\frac{1}{N} \\Psi^{\\top} \\Psi\n    $$\n    FIM 是一个对称、半正定矩阵。其特征值量化了参数空间中不同方向的信息含量。\n\n3.  **可辨识性度量**：FIM的最小特征值 $\\lambda_{\\min}(F)$ 被用作可辨识性的标量度量。一个小的或为零的 $\\lambda_{\\min}(F)$ 表明 $\\Psi$ 的列向量几乎是线性相关的，这意味着某些参数无法从数据中辨识出来。\n\n### 步骤 6：最终决策逻辑\n该程序的结果由以下逻辑确定：\n- 如果仿真在任何点因违反约束而失败，结果为 $-1.0$。\n- 如果仿真成功完成，则计算 $\\lambda_{\\min}(F)$。\n- 如果 $\\lambda_{\\min}(F)$ 大于或等于指定的阈值 $\\gamma_{\\mathrm{th}}$，则实验成功，结果为 $\\lambda_{\\min}(F)$ 的值。\n- 如果 $\\lambda_{\\min}(F)$ 小于 $\\gamma_{\\mathrm{th}}$，则激励不够“持续激励”，结果为 $-1.0$。\n这一全面的程序确保了生成的输入信号不仅安全，而且对于系统辨识的目的也是有效的。",
            "answer": "```python\nimport numpy as np\n\ndef generate_prbs(p, taps, n_bits):\n    \"\"\"Generates a Pseudo-Random Binary Sequence using an LFSR.\"\"\"\n    # Initialize register with all ones, a common choice for a non-zero start.\n    register = [1] * p\n    bits = []\n    # Adjust taps to be 0-indexed for Python list access.\n    taps_0_indexed = [t - 1 for t in taps]\n    \n    for _ in range(n_bits):\n        # Calculate feedback bit using XOR of specified taps (Fibonacci LFSR).\n        feedback = 0\n        for tap_idx in taps_0_indexed:\n            feedback ^= register[tap_idx]\n        \n        # The output bit is conventionally the last bit in the register.\n        output_bit = register[-1]\n        bits.append(output_bit)\n        \n        # Shift the register to the right and insert the new feedback bit at the start.\n        register = [feedback] + register[:-1]\n        \n    return bits\n\ndef run_simulation(params):\n    \"\"\"\n    Runs a single battery excitation simulation case.\n    \"\"\"\n    # Unpack parameters\n    (\n        delta_t, n_bits, dwell, i_max, s_max, q,\n        soc_0, soc_min, soc_max, c_th, r_h, h,\n        t_amb, t_0, t_max, a, b, c, p, taps, gamma_th, delta_t_warn\n    ) = params\n    \n    # Calculate simulation length\n    samples_per_bit = int(round(dwell / delta_t))\n    if samples_per_bit == 0: # Dwell time smaller than sampling time\n        return -1.0\n    num_samples = n_bits * samples_per_bit\n\n    # Generate PRBS bitstream\n    prbs_bits = generate_prbs(p, taps, n_bits)\n\n    # Initialize state and measurement arrays\n    i_signal = np.zeros(num_samples)\n    soc = np.zeros(num_samples + 1)\n    temp = np.zeros(num_samples + 1)\n    x_aux = np.zeros(num_samples + 1)\n    \n    soc[0] = soc_0\n    temp[0] = t_0\n    x_aux[0] = 0.0\n    i_prev = 0.0  # Assume current is zero before t=0\n\n    # Define pre-warning temperature threshold\n    t_pre_warning = t_max - delta_t_warn\n\n    # Check initial conditions against constraints\n    if not (soc_min = soc[0] = soc_max and temp[0] = t_max):\n        return -1.0\n\n    # Main simulation loop\n    for k in range(num_samples):\n        # 1. Determine target current setpoint\n        bit_index = k // samples_per_bit\n        current_bit = prbs_bits[bit_index]\n        \n        # Apply thermal-aware amplitude envelope\n        amp_multiplier = 0.5 if temp[k] >= t_pre_warning else 1.0\n        target_i = (2 * current_bit - 1) * amp_multiplier * i_max\n        \n        # 2. Apply slew-rate and magnitude limiters\n        max_delta_i = s_max * delta_t\n        delta_i_unconstrained = target_i - i_prev\n        delta_i_limited = np.clip(delta_i_unconstrained, -max_delta_i, max_delta_i)\n        \n        i_k = i_prev + delta_i_limited\n        i_k = np.clip(i_k, -i_max, i_max)\n        i_signal[k] = i_k\n        \n        # 3. Update system states using Euler forward integration\n        # SOC update\n        soc[k+1] = soc[k] - (i_k * delta_t) / q\n        \n        # Temperature update\n        heat_generation = r_h * i_k**2\n        heat_dissipation = h * (temp[k] - t_amb)\n        temp[k+1] = temp[k] + (delta_t / c_th) * (heat_generation - heat_dissipation)\n        \n        # Auxiliary state update\n        x_aux[k+1] = a * x_aux[k] + b * i_k + c * i_k**2\n        \n        # 4. Check safety constraints at current step\n        if not (soc_min = soc[k+1] = soc_max and temp[k+1] = t_max):\n            return -1.0\n            \n        # 5. Prepare for next iteration\n        i_prev = i_k\n        \n    # 5. Build regressor matrix Psi\n    # Psi has num_samples rows, using states from k=0 to k=num_samples-1\n    psi_matrix = np.zeros((num_samples, 6))\n    psi_matrix[:, 0] = 1.0\n    psi_matrix[:, 1] = soc[:num_samples]\n    psi_matrix[:, 2] = soc[:num_samples]**2\n    psi_matrix[:, 3] = i_signal\n    psi_matrix[:, 4] = i_signal**2\n    psi_matrix[:, 5] = x_aux[:num_samples]\n\n    # 6. Compute Fisher Information Matrix (FIM) and its minimum eigenvalue\n    # Check for rank deficiency before computing FIM to avoid numerical issues\n    if np.linalg.matrix_rank(psi_matrix)  psi_matrix.shape[1]:\n        lambda_min = 0.0\n    else:\n        fim = (psi_matrix.T @ psi_matrix) / num_samples\n        # Use eigvalsh for symmetric matrices; it's faster and more stable.\n        # It also returns eigenvalues in ascending order.\n        eigenvalues = np.linalg.eigvalsh(fim)\n        lambda_min = eigenvalues[0]\n\n    # 7. Final decision based on identifiability threshold\n    if lambda_min >= gamma_th:\n        return lambda_min\n    else:\n        return -1.0\n\n\ndef solve():\n    test_cases = [\n        # Case 1 (happy path, feasible and informative)\n        (0.1, 63, 1.0, 6.0, 3.0, 36000, 0.5, 0.2, 0.8, 500.0, 0.15, 2.0, 298.0, 298.0, 315.0, 0.95, 0.05, 0.01, 6, [5, 4], 0.0005, 2.0),\n        # Case 2 (thermal violation due to high heating, should fail)\n        (0.1, 63, 1.0, 8.0, 6.0, 36000, 0.5, 0.2, 0.8, 500.0, 5.0, 2.0, 298.0, 298.0, 305.0, 0.95, 0.05, 0.01, 6, [5, 4], 0.0001, 1.0),\n        # Case 3 (state-of-charge drift due to long dwell, should fail)\n        (0.1, 63, 6.0, 20.0, 100.0, 36000, 0.5, 0.49, 0.51, 500.0, 0.1, 2.0, 298.0, 298.0, 315.0, 0.95, 0.05, 0.01, 6, [5, 4], 0.0005, 2.0),\n        # Case 4 (low amplitude, poor identifiability, should fail on identifiability threshold)\n        (0.1, 63, 1.0, 1.0, 3.0, 36000, 0.5, 0.2, 0.8, 500.0, 0.15, 2.0, 298.0, 298.0, 315.0, 0.95, 0.05, 0.01, 6, [5, 4], 0.001, 2.0),\n        # Case 5 (short dwell, high-frequency excitation, feasible and informative)\n        (0.1, 63, 0.2, 6.0, 20.0, 36000, 0.5, 0.2, 0.8, 500.0, 0.15, 2.0, 298.0, 298.0, 315.0, 0.95, 0.05, 0.01, 6, [5, 4], 0.0005, 2.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在尝试估计非线性系统的内部状态之前，我们必须回答一个基本问题：这些状态能否通过可用的测量值被观测到？这个被称为“能观测性”的性质，对于设计状态估计器和验证模型结构至关重要。在本练习  中，您将使用李导数这一严谨的数学框架来评估一个非线性燃料电池模型的局部能观测性。",
            "id": "4108685",
            "problem": "考虑一个用于能源系统建模的三状态、输入驱动的质子交换膜燃料电池堆模型。状态向量为 $x = \\begin{pmatrix} x_{1}  x_{2}  x_{3} \\end{pmatrix}^{\\top}$，其中 $x_{1}$ 是膜含水量（单位：摩尔），$x_{2}$ 是电池堆温度（单位：开尔文），$x_{3}$ 是阳极氢气分压（单位：巴）。标量输入 $u$ 是电池堆电流（单位：安培），该输入是已知且给定的。\n\n动态特性由以下常微分方程 (ODE) 给出：\n$$\n\\dot{x}_{1} = -a\\left(x_{1} - \\alpha x_{2}\\right) + b\\,u,\\quad\n\\dot{x}_{2} = \\frac{1}{C}\\left(\\beta\\,u - \\gamma\\left(x_{2} - T_{a}\\right)\\right),\\quad\n\\dot{x}_{3} = -\\delta\\,u + \\varepsilon\\left(p_{s} - x_{3}\\right),\n$$\n其中常数参数为 $a = 0.1\\,\\mathrm{s}^{-1}$，$\\alpha = 0.02\\,\\mathrm{mol/K}$，$b = 5.0\\times 10^{-3}\\,\\mathrm{mol/(A\\cdot s)}$，$C = 500\\,\\mathrm{J/K}$，$\\beta = 0.6\\,\\mathrm{W/A}$，$\\gamma = 50\\,\\mathrm{W/K}$，$T_{a} = 298\\,\\mathrm{K}$，$\\delta = 10^{-3}\\,\\mathrm{bar/(A\\cdot s)}$，$\\varepsilon = 0.2\\,\\mathrm{s}^{-1}$，$p_{s} = 2.0\\,\\mathrm{bar}$。\n\n通过两个输出可进行部分传感。第一个输出是电池堆电压，其模型为\n$$\ny_{1} = h_{1}(x,u) = E_{0} + k_{T}\\,x_{2}\\,\\ln(x_{3}) - \\frac{r_{1}}{x_{1}} - r_{2}\\,u - r_{0},\n$$\n其中 $E_{0} = 0.95\\,\\mathrm{V}$，$r_{0} = 0.05\\,\\mathrm{V}$，$r_{1} = 2.0\\times 10^{-2}\\,\\mathrm{V\\cdot mol}$，$r_{2} = 10^{-3}\\,\\mathrm{V/A}$，以及 $k_{T} = \\frac{R}{2F}$，普适气体常数 $R = 8.314\\,\\mathrm{J/(mol\\cdot K)}$ 和 Faraday 常数 $F = 96485\\,\\mathrm{C/mol}$。第二个输出直接测量电池堆温度，\n$$\ny_{2} = h_{2}(x) = x_{2}.\n$$\n\n对于固定的恒定输入 $u = u^{\\star} = 200\\,\\mathrm{A}$ 和工作点 $x^{\\star} = \\begin{pmatrix} 5.0\\,\\mathrm{mol}  350\\,\\mathrm{K}  e\\,\\mathrm{bar} \\end{pmatrix}^{\\top}$（其中 $e$ 是自然对数的底），请解决以下问题：\n\n1. 从非线性系统的局部弱可观测性的核心定义出发，使用李导数定义可观测性秩条件。具体来说，解释如何从输出及其沿系统向量场的逐次李导数的梯度构建可观测性矩阵。\n\n2. 将此构造方法应用于上述燃料电池堆模型。使用行向量 $\\nabla h_{1}(x^{\\star})$、$\\nabla h_{2}(x^{\\star})$ 和 $\\nabla \\left(L_{f} h_{1}\\right)(x^{\\star})$——其中 $L_{f} h_{1}$ 表示当 $u$ 保持在 $u^{\\star}$ 恒定时，$h_{1}$ 沿漂移向量场 $f(x) = \\begin{pmatrix} \\dot{x}_{1}  \\dot{x}_{2}  \\dot{x}_{3} \\end{pmatrix}^{\\top}$ 的李导数——在给定的工作点和参数值下评估这些梯度，组装得到的三行三列可观测性矩阵，并确定其秩。\n\n将最终答案表示为所构造的可观测性矩阵的整数秩。最终答案无需单位。最终答案必须是单个实数。",
            "solution": "分析按照问题陈述的要求分两部分进行。首先，我们为一般非线性系统定义可观测性秩条件。其次，我们将此条件应用于给定工作点下的特定燃料电池模型。\n\n### 第 1 部分：可观测性秩条件\n\n考虑一个由以下方程描述的一般非线性时不变系统：\n$$\n\\dot{x} = f(x, u) \\\\\ny = h(x, u)\n$$\n其中 $x \\in \\mathbb{R}^{n}$ 是状态向量，$u \\in \\mathbb{R}^{m}$ 是输入向量，$y \\in \\mathbb{R}^{p}$ 是输出向量。为了进行可观测性分析，假设输入 $u(t)$ 是一个已知的时间函数。因此，我们可以将该系统视为由状态空间上的一个时变向量场控制，即 $\\dot{x} = f(x(t), u(t)) \\equiv f_t(x(t))$。\n\n如果对于某个输入 $u(t)$，在状态 $x^{\\star}$ 的一个邻域内的任何初始状态 $x(0)$ 都可以通过有限时间区间内的输出历史 $y(t)$ 唯一确定，则称该系统在状态 $x^{\\star}$ 处是局部弱可观测的。\n\n分析可观测性的形式化工具是李导数。标量场（一个函数）$\\phi(x)$ 沿向量场 $g(x)$ 的李导数定义为：\n$$\nL_{g}\\phi(x) = \\nabla \\phi(x) \\cdot g(x) = \\sum_{i=1}^{n} \\frac{\\partial \\phi}{\\partial x_{i}} g_{i}(x)\n$$\n它表示 $\\phi$ 沿向量场 $g$ 的流的变化率。逐次李导数递归定义为：$L_{g}^{0}\\phi = \\phi$ 且当 $k \\ge 1$ 时，$L_{g}^{k}\\phi = L_{g}(L_{g}^{k-1}\\phi)$。\n\n输出分量 $y_j = h_j(x)$（为记法清晰，此处省略了对已知输入 $u$ 的显式依赖）沿系统轨迹的时间导数为 $\\dot{y}_j = \\frac{d}{dt}h_j(x(t)) = (\\nabla h_j) \\cdot \\dot{x} = L_f h_j(x)$。类似地，输出的更高阶时间导数可以表示为逐次李导数：$\\frac{d^k y_j}{dt^k} = L_f^k h_j(x)$。\n\n系统的可观测性由输出及其时间导数中所包含的关于状态 $x$ 的“信息”决定。这些信息由输出函数的逐次李导数的梯度（微分）捕获。所有这些独立梯度的集合张成了可观测性余分布。\n\n可观测性秩条件指出，如果可观测性空间的维数等于状态空间的维数 $n$，则系统在 $x^{\\star}$ 处是局部弱可观测的。这可以通过构造可观测性矩阵 $\\mathcal{M_O}(x)$ 来检验，其行向量是输出分量的李导数的梯度：\n$$\n\\mathcal{M_O}(x) = \\begin{pmatrix}\n\\nabla (L_f^0 h_1)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^0 h_p)(x) \\\\\n\\nabla (L_f^1 h_1)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^1 h_p)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^{n-1} h_1)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^{n-1} h_p)(x)\n\\end{pmatrix}\n$$\n如果 $\\text{rank}(\\mathcal{M_O}(x^{\\star})) = n$，则系统在 $x^{\\star}$ 处是局部弱可观测的。本问题要求从这些行向量的一个特定子集构造一个 $3 \\times 3$ 的矩阵。\n\n### 第 2 部分：在燃料电池模型上的应用\n\n该系统的状态维数为 $n=3$，输出维数为 $p=2$。输入保持恒定在 $u = u^{\\star} = 200\\,\\mathrm{A}$。这使得系统成为一个自治系统，其向量场 $f(x) = (\\dot{x}_1, \\dot{x}_2, \\dot{x}_3)^\\top$ 由下式给出：\n$$\nf(x) = \\begin{pmatrix}\n-a(x_1 - \\alpha x_2) + b u^{\\star} \\\\\n\\frac{1}{C}(\\beta u^{\\star} - \\gamma(x_2 - T_a)) \\\\\n-\\delta u^{\\star} + \\varepsilon(p_s - x_3)\n\\end{pmatrix}\n$$\n输出函数为：\n$$\nh_1(x) = E_0 + k_T x_2 \\ln(x_3) - \\frac{r_1}{x_1} - r_2 u^{\\star} - r_0 \\\\\nh_2(x) = x_2\n$$\n本问题要求从行向量 $\\nabla h_1(x^\\star)$、$\\nabla h_2(x^\\star)$ 和 $\\nabla (L_f h_1)(x^\\star)$ 构造一个 $3 \\times 3$ 的可观测性矩阵，并在工作点 $x^{\\star} = \\begin{pmatrix} 5.0  350  e \\end{pmatrix}^{\\top}$ 处进行评估。\n\n首先，我们符号化地计算所需的梯度。\n$h_1(x)$ 的梯度为：\n$$\n\\nabla h_1(x) = \\begin{pmatrix} \\frac{\\partial h_1}{\\partial x_1},  \\frac{\\partial h_1}{\\partial x_2},  \\frac{\\partial h_1}{\\partial x_3} \\end{pmatrix} = \\begin{pmatrix} \\frac{r_1}{x_1^2}  k_T \\ln(x_3)  \\frac{k_T x_2}{x_3} \\end{pmatrix}\n$$\n$h_2(x)$ 的梯度为：\n$$\n\\nabla h_2(x) = \\begin{pmatrix} \\frac{\\partial h_2}{\\partial x_1},  \\frac{\\partial h_2}{\\partial x_2},  \\frac{\\partial h_2}{\\partial x_3} \\end{pmatrix} = \\begin{pmatrix} 0  1  0 \\end{pmatrix}\n$$\n接下来，我们计算李导数 $L_f h_1$：\n$$\nL_f h_1(x) = \\nabla h_1(x) \\cdot f(x) = \\left(\\frac{r_1}{x_1^2}\\right)f_1(x) + \\left(k_T \\ln(x_3)\\right)f_2(x) + \\left(\\frac{k_T x_2}{x_3}\\right)f_3(x)\n$$\n现在，我们求 $L_f h_1(x)$ 的梯度。\n$\\frac{\\partial}{\\partial x_1}(L_f h_1) = \\frac{\\partial}{\\partial x_1}\\left(\\frac{r_1}{x_1^2} f_1(x)\\right) = \\frac{-2r_1}{x_1^3}f_1(x) + \\frac{r_1}{x_1^2}\\frac{\\partial f_1}{\\partial x_1} = \\frac{-2r_1}{x_1^3}(-a(x_1-\\alpha x_2)+bu^\\star) + \\frac{r_1}{x_1^2}(-a) = \\frac{r_1}{x_1^3}(ax_1 - 2a\\alpha x_2 - 2bu^\\star)$。\n\n$\\frac{\\partial}{\\partial x_2}(L_f h_1) = \\frac{\\partial}{\\partial x_2}\\left(\\frac{r_1}{x_1^2} f_1\\right) + \\frac{\\partial}{\\partial x_2}\\left(k_T \\ln(x_3) f_2\\right) + \\frac{\\partial}{\\partial x_2}\\left(\\frac{k_T x_2}{x_3} f_3\\right) = \\frac{r_1}{x_1^2}\\frac{\\partial f_1}{\\partial x_2} + k_T \\ln(x_3)\\frac{\\partial f_2}{\\partial x_2} + \\frac{k_T}{x_3}f_3 = \\frac{a \\alpha r_1}{x_1^2} - \\frac{\\gamma k_T}{C} \\ln(x_3) + \\frac{k_T}{x_3}(-\\delta u^\\star + \\varepsilon(p_s-x_3))$。\n\n$\\frac{\\partial}{\\partial x_3}(L_f h_1) = \\frac{\\partial}{\\partial x_3}\\left(k_T \\ln(x_3) f_2\\right) + \\frac{\\partial}{\\partial x_3}\\left(\\frac{k_T x_2}{x_3} f_3\\right) = \\frac{k_T}{x_3}f_2 + \\frac{k_T x_2}{-x_3^2}f_3 + \\frac{k_T x_2}{x_3}\\frac{\\partial f_3}{\\partial x_3} = \\frac{k_T}{x_3}f_2 - \\frac{k_T x_2}{x_3^2}f_3 + \\frac{k_T x_2}{x_3}(-\\varepsilon) = \\frac{k_T}{x_3}f_2 - \\frac{k_T x_2}{x_3^2}(-\\delta u^\\star + \\varepsilon p_s) - \\frac{2k_T x_2 \\varepsilon}{x_3}$。一条更简单的路径得出 $\\frac{k_T}{C x_3}(\\beta u^\\star - \\gamma(x_2 - T_a)) + \\frac{k_T x_2}{x_3^2}(\\delta u^\\star - \\varepsilon p_s)$。\n\n我们在 $x^{\\star} = \\begin{pmatrix} 5  350  e\\end{pmatrix}^{\\top}$ 和 $u^{\\star}=200\\,\\mathrm{A}$ 的条件下评估这些梯度。\n参数：$a=0.1$，$\\alpha=0.02$，$b=5\\times 10^{-3}$，$C=500$，$\\beta=0.6$，$\\gamma=50$，$T_a=298$，$\\delta=10^{-3}$，$\\varepsilon=0.2$，$p_s=2$，$r_1=0.02$。\n$k_T = \\frac{R}{2F} = \\frac{8.314}{2 \\times 96485} \\approx 4.3084 \\times 10^{-5}$。\n\n第 1 行：$\\nabla h_1(x^{\\star})$\n$\\frac{\\partial h_1}{\\partial x_1}\\bigg|_{x^\\star} = \\frac{0.02}{5^2} = 0.0008$。\n$\\frac{\\partial h_1}{\\partial x_2}\\bigg|_{x^\\star} = k_T \\ln(e) = k_T \\approx 4.3084 \\times 10^{-5}$。\n$\\frac{\\partial h_1}{\\partial x_3}\\bigg|_{x^\\star} = k_T \\frac{350}{e} \\approx 128.755 k_T \\approx 5.5473 \\times 10^{-3}$。\n$\\nabla h_1(x^{\\star}) \\approx \\begin{pmatrix} 8 \\times 10^{-4}  4.3084 \\times 10^{-5}  5.5473 \\times 10^{-3} \\end{pmatrix}$。\n\n第 2 行：$\\nabla h_2(x^{\\star})$\n$\\nabla h_2(x^{\\star}) = \\begin{pmatrix} 0  1  0 \\end{pmatrix}$。\n\n第 3 行：$\\nabla (L_f h_1)(x^{\\star})$\n$\\frac{\\partial}{\\partial x_1}(L_f h_1)\\bigg|_{x^\\star} = \\frac{0.02}{5^3}(0.1(5) - 2(0.1)(0.02)(350) - 2(0.005)(200)) = \\frac{0.02}{125}(0.5 - 1.4 - 2) = -0.000464$。\n$\\frac{\\partial}{\\partial x_2}(L_f h_1)\\bigg|_{x^\\star} = \\frac{0.1(0.02)(0.02)}{5^2} - \\frac{50 k_T}{500}(1) + \\frac{k_T}{e}(-10^{-3}(200) + 0.2(2-e)) = 1.6 \\times 10^{-6} - 0.1 k_T + \\frac{k_T}{e}(0.2 - 0.2e) = 1.6 \\times 10^{-6} - 0.2264 k_T \\approx -8.154 \\times 10^{-6}$。\n$\\frac{\\partial}{\\partial x_3}(L_f h_1)\\bigg|_{x^\\star} = \\frac{k_T}{500e}(0.6(200) - 50(350-298)) + \\frac{k_T(350)}{e^2}(10^{-3}(200) - 0.2(2)) = \\frac{k_T}{500e}(-2480) + \\frac{350k_T}{e^2}(-0.2) = k_T(-\\frac{4.96}{e} - \\frac{70}{e^2}) \\approx -11.298 k_T \\approx -4.8675 \\times 10^{-4}$。\n$\\nabla (L_f h_1)(x^{\\star}) \\approx \\begin{pmatrix} -4.64 \\times 10^{-4}  -8.154 \\times 10^{-6}  -4.8675 \\times 10^{-4} \\end{pmatrix}$。\n\n可观测性矩阵 $\\mathcal{M}$ 为：\n$$\n\\mathcal{M} = \\begin{pmatrix} \\nabla h_1(x^{\\star}) \\\\ \\nabla h_2(x^{\\star}) \\\\ \\nabla (L_f h_1)(x^{\\star}) \\end{pmatrix} \\approx \\begin{pmatrix} 8 \\times 10^{-4}  4.3084 \\times 10^{-5}  5.5473 \\times 10^{-3} \\\\ 0  1  0 \\\\ -4.64 \\times 10^{-4}  -8.154 \\times 10^{-6}  -4.8675 \\times 10^{-4} \\end{pmatrix}\n$$\n为了求秩，我们计算 $\\mathcal{M}$ 的行列式。沿第二行展开可以简化计算：\n$$\n\\det(\\mathcal{M}) = (1) \\cdot \\det \\begin{pmatrix} 8 \\times 10^{-4}  5.5473 \\times 10^{-3} \\\\ -4.64 \\times 10^{-4}  -4.8675 \\times 10^{-4} \\end{pmatrix}\n$$\n$$\n\\det(\\mathcal{M}) \\approx (8 \\times 10^{-4})(-4.8675 \\times 10^{-4}) - (5.5473 \\times 10^{-3})(-4.64 \\times 10^{-4})\n$$\n$$\n\\det(\\mathcal{M}) \\approx -3.894 \\times 10^{-7} - (-2.574 \\times 10^{-6}) = -0.3894 \\times 10^{-6} + 2.574 \\times 10^{-6} = 2.1846 \\times 10^{-6}\n$$\n由于行列式非零，矩阵 $\\mathcal{M}$ 是满秩的。所构造的可观测性矩阵的秩为 $3$。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "没有模型是完美的，确定需要改进的地方是一项关键的工程技能。灵敏度分析提供了一种系统化的方法，用以确定哪些模型参数对输出影响最大，从而指导模型的改进工作。本练习  提供了一个实践机会，让您推导并计算制冷机冷却能力对其传热系数的灵敏度，将第一性原理分析与数据驱动的模型验证联系起来。",
            "id": "4108755",
            "problem": "一个蒸汽压缩式制冷机的蒸发器，使用第一性原理的热交换和能量平衡进行非线性系统辨识建模。模型的输出是制冷量 $Q_{e}$，一个关键参数是蒸发器的总传热导 $U_{e}A_{e}$。为了确定模型优化的优先级，要求您计算在指定工作点下的局部灵敏度 $\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}$。\n\n假设制冷剂在饱和温度 $T_{e}$下等温蒸发，冷却水以质量流量 $\\dot{m}_{w}$ 和比热容 $c_{p}$ 流过蒸发器。冷却水的入口温度为 $T_{w,\\mathrm{in}}$，出口温度为 $T_{w,\\mathrm{out}}$。蒸发器的传热遵循标准的对数平均温差（LMTD）关系，该关系适用于一侧为等温热源或冷源，另一侧为单相液体的情况。控制关系式如下：\n- 水侧的能量平衡：$$Q_{e} = \\dot{m}_{w} c_{p} \\bigl(T_{w,\\mathrm{in}} - T_{w,\\mathrm{out}}\\bigr).$$\n- 对数平均温差（LMTD）：$$\\Delta T_{\\mathrm{lm}} = \\frac{\\bigl(T_{w,\\mathrm{in}} - T_{e}\\bigr) - \\bigl(T_{w,\\mathrm{out}} - T_{e}\\bigr)}{\\ln\\!\\left(\\frac{T_{w,\\mathrm{in}} - T_{e}}{T_{w,\\mathrm{out}} - T_{e}}\\right)}.$$\n- 传热速率：$$Q_{e} = (U_{e}A_{e})\\,\\Delta T_{\\mathrm{lm}}.$$\n\n仅使用这些关系式，通过消去 $T_{w,\\mathrm{out}}$，推导出 $Q_{e}$ 作为 $(U_{e}A_{e})$ 函数的解析表达式，并由此表达式获得灵敏度 $\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}$ 的闭式解。在以下基准工作点下评估该灵敏度：\n$$\\dot{m}_{w} = 10~\\mathrm{kg/s},\\quad c_{p} = 4.186~\\mathrm{kJ/(kg\\,K)},\\quad T_{w,\\mathrm{in}} = 12~\\mathrm{^\\circ C},\\quad T_{e} = 5~\\mathrm{^\\circ C},\\quad (U_{e}A_{e}) = 35~\\mathrm{kW/K}.$$\n\n将您计算出的 $\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}$ 的最终数值以开尔文（Kelvin）为单位表示。将您的答案四舍五入到四位有效数字。",
            "solution": "我们从适用于能源系统建模的第一性原理出发：水侧的能量守恒和用于换热器分析的、经过充分验证的对数平均温差（LMTD）公式。\n\n定义水侧的热容率为 $$M \\equiv \\dot{m}_{w} c_{p}.$$ 水侧的能量平衡给出\n$$Q_{e} = M \\bigl(T_{w,\\mathrm{in}} - T_{w,\\mathrm{out}}\\bigr),$$\n因此出口温度可以表示为 $Q_{e}$ 的函数：\n$$T_{w,\\mathrm{out}} = T_{w,\\mathrm{in}} - \\frac{Q_{e}}{M}.$$\n\n设入口温差（相对于蒸发的制冷剂）为\n$$\\Delta T_{1} \\equiv T_{w,\\mathrm{in}} - T_{e},$$\n出口温差为\n$$\\Delta T_{2} \\equiv T_{w,\\mathrm{out}} - T_{e} = \\bigl(T_{w,\\mathrm{in}} - \\frac{Q_{e}}{M}\\bigr) - T_{e} = \\Delta T_{1} - \\frac{Q_{e}}{M}.$$\n\n对于等温的制冷剂侧，水和制冷剂之间的 LMTD 为\n$$\\Delta T_{\\mathrm{lm}} = \\frac{\\Delta T_{1} - \\Delta T_{2}}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{2}}\\right)}.$$\n代入 $\\Delta T_{2} = \\Delta T_{1} - \\frac{Q_{e}}{M}$ 得\n$$\\Delta T_{\\mathrm{lm}} = \\frac{\\frac{Q_{e}}{M}}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right)}.$$\n\n蒸发器的传热关系 $Q_{e} = (U_{e}A_{e})\\,\\Delta T_{\\mathrm{lm}}$ 于是得到隐式方程\n$$Q_{e} = (U_{e}A_{e}) \\cdot \\frac{\\frac{Q_{e}}{M}}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right)}.$$\n假设 $Q_{e}  0$，两边同除以 $Q_{e}$ 得到\n$$1 = \\frac{(U_{e}A_{e})}{M} \\cdot \\frac{1}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right)}.$$\n取倒数以分离对数项：\n$$\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right) = \\frac{(U_{e}A_{e})}{M}.$$\n对两边取指数：\n$$\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}} = \\exp\\!\\left(\\frac{(U_{e}A_{e})}{M}\\right).$$\n求解 $Q_{e}$：\n$$\\Delta T_{1} - \\frac{Q_{e}}{M} = \\Delta T_{1}\\,\\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right),$$\n$$\\frac{Q_{e}}{M} = \\Delta T_{1}\\left[1 - \\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right],$$\n$$Q_{e}\\bigl((U_{e}A_{e})\\bigr) = M\\,\\Delta T_{1}\\left[1 - \\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right].$$\n\n这是一个从输出 $Q_{e}$ 到参数 $(U_{e}A_{e})$ 的闭式非线性映射，它完全由能量平衡和 LMTD 推导得出。参数优化优先级所需的灵敏度是 $Q_{e}$ 对 $(U_{e}A_{e})$ 的偏导数：\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})} = M\\,\\Delta T_{1} \\cdot \\frac{\\partial}{\\partial (U_{e}A_{e})}\\left[1 - \\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right] = M\\,\\Delta T_{1}\\left[\\frac{1}{M}\\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right].$$\n化简后得到\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})} = \\Delta T_{1}\\,\\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right).$$\n\n在给定的工作点下进行评估。首先计算\n$$M = \\dot{m}_{w} c_{p} = 10~\\mathrm{kg/s} \\times 4.186~\\mathrm{kJ/(kg\\,K)} = 41.86~\\mathrm{kW/K},$$\n以及\n$$\\Delta T_{1} = T_{w,\\mathrm{in}} - T_{e} = 12 - 5 = 7~\\mathrm{K}.$$\n现在代入 $(U_{e}A_{e}) = 35~\\mathrm{kW/K}$：\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}\\bigg|_{(U_{e}A_{e})=35} = 7 \\,\\exp\\!\\left(-\\frac{35}{41.86}\\right).$$\n计算指数因子：\n$$\\frac{35}{41.86} \\approx 0.83612,$$\n所以\n$$\\exp(-0.83612) \\approx 0.43338.$$\n因此，\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}\\bigg|_{(U_{e}A_{e})=35} \\approx 7 \\times 0.43338 \\approx 3.034~\\mathrm{K}.$$\n\n该灵敏度量化了在工作点附近，$(U_{e}A_{e})$ 每发生单位变化，会引起多少开尔文的制冷量变化（单位为 $(\\mathrm{kW})/(\\mathrm{kW/K})$，简化为开尔文）。它为在制冷机的非线性系统辨识中，优先优化 $(U_{e}A_{e})$ 参数提供了有原则的度量标准。",
            "answer": "$$\\boxed{3.034}$$"
        }
    ]
}