{
    "hands_on_practices": [
        {
            "introduction": "在构建任何复杂的图神经网络（GNN）模型之前，首要任务是正确地准备输入数据。在电力系统工程中，标幺值（per-unit）系统是实现标准化的通用语言，它能确保所有物理量都处于可比较的尺度上，这对于机器学习模型的训练至关重要。本练习  旨在通过一个基础但关键的计算任务，强化您对这一基本预处理步骤的理解，即将原始物理测量值转换为无量纲的特征，为GNN分析做好准备。",
            "id": "4094182",
            "problem": "一个输电网络被表示为一个图，其中每个母线是一个节点，线路是边。为了训练用于状态估计和异常检测的图神经网络（GNN），节点特征在标幺（p.u.）系统中进行归一化，以确保输入是无量纲、尺度一致的。考虑单个母线 $i$，其净有功功率注入为 $P_i=150\\,\\mathrm{MW}$，电压幅值为 $|V_i|=230\\,\\mathrm{kV}$。系统的标幺基准值为视在功率基准 $S_{\\mathrm{base}}=100\\,\\mathrm{MVA}$ 和电压基准 $V_{\\mathrm{base}}=230\\,\\mathrm{kV}$，与额定输电等级一致。从交流网络中复功率的定义 $S=P+jQ$ 和由与基准量之比定义的标幺归一化原理出发，并强制量纲一致性，推导母线 $i$ 的标幺归一化特征 $P_i^{\\mathrm{pu}}$ 和 $|V_i|^{\\mathrm{pu}}$。将母线 $i$ 的最终归一化行特征向量组合为 $\\begin{pmatrix}P_i^{\\mathrm{pu}}  |V_i|^{\\mathrm{pu}}\\end{pmatrix}$，其元素为无量纲值。请以单行矩阵的形式提供最终答案。无需四舍五入；请给出精确值。",
            "solution": "该问题要求推导电力系统母线的标幺归一化特征，特别是有功功率注入和电压幅值。标幺系统是电力系统分析中一种归一化物理量的方法，其中实际值表示为基准值的小数部分。\n\n### 步骤1：问题验证\n\n**1.1. 提取给定条件**\n- 母线：$i$\n- 净有功功率注入：$P_i=150\\,\\mathrm{MW}$\n- 电压幅值：$|V_i|=230\\,\\mathrm{kV}$\n- 视在功率基准：$S_{\\mathrm{base}}=100\\,\\mathrm{MVA}$\n- 电压基准：$V_{\\mathrm{base}}=230\\,\\mathrm{kV}$\n- 复功率定义：$S=P+jQ$\n- 标幺原理：与基准量之比。\n- 要求输出：行特征向量 $\\begin{pmatrix}P_i^{\\mathrm{pu}}  |V_i|^{\\mathrm{pu}}\\end{pmatrix}$。\n\n**1.2. 使用提取的给定条件进行验证**\n该问题在科学上基于电气工程的原理，特别是交流电力电路分析和标幺系统，这是分析电力网络和为图神经网络等计算模型准备数据的标准技术。所提供的值对于高压输电系统是符合实际的。该问题是适定的，提供了计算唯一解所需的所有基准量和实际值。它使用标准术语进行了客观陈述。该问题是完整的、一致的，并且没有违反任何科学或数学原理。\n\n**1.3. 结论与行动**\n该问题被判定为**有效**。将推导解答。\n\n### 步骤2：求解推导\n\n标幺值的基本定义是实际量与选定的同量纲基准量之比。\n$$ \\text{Quantity}_{\\mathrm{pu}} = \\frac{\\text{Actual Quantity}}{\\text{Base Quantity}} $$\n此运算的结果是一个无量纲值。我们将此原理应用于电压幅值和有功功率。\n\n**2.1. 标幺电压幅值 ($|V_i|^{\\mathrm{pu}}$)**\n母线 $i$ 的实际电压幅值给定为 $|V_i| = 230\\,\\mathrm{kV}$。系统电压基准给定为 $V_{\\mathrm{base}} = 230\\,\\mathrm{kV}$。\n应用标幺定义：\n$$ |V_i|^{\\mathrm{pu}} = \\frac{|V_i|}{V_{\\mathrm{base}}} $$\n代入给定值：\n$$ |V_i|^{\\mathrm{pu}} = \\frac{230\\,\\mathrm{kV}}{230\\,\\mathrm{kV}} = 1.0 $$\n得到的标幺电压幅值为无量纲值 $1.0$。\n\n**2.2. 标幺有功功率 ($P_i^{\\mathrm{pu}}$)**\n母线 $i$ 的实际净有功功率注入给定为 $P_i = 150\\,\\mathrm{MW}$。\n在标准的标幺系统中，所有功率量——有功功率（$P$）、无功功率（$Q$）和视在功率（$S$）——都通过一个单一的、共同的视在功率基准 $S_{\\mathrm{base}}$ 进行归一化。这种约定确保了以复功率形式表示的功率三角形关系 $S=P+jQ$ 对标幺量仍然有效，即 $S^{\\mathrm{pu}} = P^{\\mathrm{pu}} + jQ^{\\mathrm{pu}}$。\n视在功率基准给定为 $S_{\\mathrm{base}} = 100\\,\\mathrm{MVA}$。因此，有功功率的基准也是这个值。\n$$ P_{\\mathrm{base}} = S_{\\mathrm{base}} = 100\\,\\mathrm{MVA} $$\n实际量（$P_i$ 单位为 $\\mathrm{MW}$）和基准量（$S_{\\mathrm{base}}$ 单位为 $\\mathrm{MVA}$）的单位必须一致。在功率的背景下，兆瓦（$\\mathrm{MW}$）和兆伏安（$\\mathrm{MVA}$）为了这个比值的目的在量纲上是一致的，因为 $P=|S|\\cos\\phi$。功率的基本单位是伏安（$\\mathrm{VA}$），而瓦特（$\\mathrm{W}$）在归一化目的上是等效的（$1\\,\\mathrm{W} = 1\\,\\mathrm{VA} \\times (\\text{power factor})$）。由于标幺系统旨在创建一个无量纲的表示，因此直接形成比值。\n应用功率的标幺定义：\n$$ P_i^{\\mathrm{pu}} = \\frac{P_i}{S_{\\mathrm{base}}} $$\n代入给定值：\n$$ P_i^{\\mathrm{pu}} = \\frac{150\\,\\mathrm{MW}}{100\\,\\mathrm{MVA}} = 1.5 $$\n得到的标幺有功功率为无量纲值 $1.5$。\n\n**2.3. 组合特征向量**\n问题要求将最终的归一化特征组合成一个形如 $\\begin{pmatrix}P_i^{\\mathrm{pu}}  |V_i|^{\\mathrm{pu}}\\end{pmatrix}$ 的行特征向量。\n代入计算出的标幺值：\n$$ \\begin{pmatrix} 1.5 & 1.0 \\end{pmatrix} $$\n该向量表示母线 $i$ 的归一化特征，将用作图神经网络模型中一个节点的输入。",
            "answer": "$$\\boxed{\\begin{pmatrix} 1.5 & 1.0 \\end{pmatrix}}$$"
        },
        {
            "introduction": "一旦节点特征准备就绪，下一步便是将系统的拓扑结构和物理定律转化为GNN能够理解的数学形式。本练习  将指导您从第一性原理出发，为一个简单的电力网络推导出关键的图矩阵——关联矩阵 $A$、节点导纳矩阵 $Y_{\\mathrm{bus}}$ 和拉普拉斯矩阵 $L$。通过这个过程，您将深刻理解网络的电气特性是如何被精确编码为图结构，从而弥合经典电力系统分析与现代基于图的机器学习之间的差距。",
            "id": "4094186",
            "problem": "考虑一个无损输电网络，表示为一个由总线 $1$–$2$–$3$ 组成的简单链式结构，包含两个串联支路 $(1,2)$ 和 $(2,3)$，其标幺串联电抗分别为 $X_{12}=0.2$ 和 $X_{23}=0.25$。假设采用直流 (DC) 潮流近似法，其中总线电压幅值固定为 $1$ 标幺，相角差很小，忽略支路电阻和并联元件，且线路是纯电抗性的。为两个有向边 $e_{1}: 1 \\to 2$ 和 $e_{2}: 2 \\to 3$ 指定方向。\n\n在这些直流假设下，利用每个总线处的 Kirchhoff 电流定律和每条线路上的 Ohm 定律，从第一性原理推导：\n\n(a) 对应于所选方向的节点-支路关联矩阵 $A$，\n\n(b) 标幺制的总线导纳矩阵 $Y_{\\mathrm{bus}}$，\n\n(c) 与网络电纳权重相关的加权图拉普拉斯矩阵 $L$。\n\n然后，根据代数连通度的定义（即 $L$ 的第二小特征值），精确计算该特征值，并以简化的解析表达式给出。将最终答案表示为单个无单位的闭式表达式。不要四舍五入；请提供精确表达式。",
            "solution": "本问题要求推导表示一个简单电力网络的关键矩阵，并计算其代数连通度。我们将按要求分步进行，从第一性原理推导每个量。该网络由三个标记为 $1$、$2$ 和 $3$ 的总线组成，通过两条输电线路 $(1,2)$ 和 $(2,3)$ 链式连接。分析是在标准的直流 (DC) 潮流近似假设下进行的。\n\n给定的标幺串联电抗为 $X_{12}=0.2$ 和 $X_{23}=0.25$。在直流潮流模型中，电阻被忽略，因此支路的阻抗是纯虚数：$Z_{ik} = jX_{ik}$。导纳是阻抗的倒数，$y_{ik} = Z_{ik}^{-1} = (jX_{ik})^{-1} = -j/X_{ik}$。$B_{ik} = 1/X_{ik}$ 这一项是支路电纳。\n\n对于给定的支路：\n线路 $(1,2)$ 的支路电纳为 $B_{12} = \\frac{1}{X_{12}} = \\frac{1}{0.2} = 5$ 标幺。\n支路导纳为 $y_{12} = -jB_{12} = -j5$ 标幺。\n\n线路 $(2,3)$ 的支路电纳为 $B_{23} = \\frac{1}{X_{23}} = \\frac{1}{0.25} = 4$ 标幺。\n支路导纳为 $y_{23} = -jB_{23} = -j4$ 标幺。\n\n(a) 推导节点-支路关联矩阵 $A$\n\n节点-支路关联矩阵（记为 $A$）描述了有向图的拓扑结构。对于一个有 $n$ 个节点和 $m$ 条边的图，$A$ 是一个 $n \\times m$ 的矩阵。其元素 $A_{ie}$ 根据给定的边的方向定义如下：\n- 如果节点 $i$ 是边 $e$ 的源点（起点），则 $A_{ie} = +1$。\n- 如果节点 $i$ 是边 $e$ 的汇点（终点），则 $A_{ie} = -1$。\n- 如果节点 $i$ 与边 $e$ 不关联，则 $A_{ie} = 0$。\n\n该网络有 $n=3$ 个节点（总线）和 $m=2$ 条边（线路）。指定的边方向为 $e_1: 1 \\to 2$ 和 $e_2: 2 \\to 3$。\n\n对于边 $e_1$（$A$ 的第 1 列）：节点 $1$ 是源点（$+1$），节点 $2$ 是汇点（$-1$），节点 $3$ 不关联（$0$）。\n对于边 $e_2$（$A$ 的第 2 列）：节点 $2$ 是源点（$+1$），节点 $3$ 是汇点（$-1$），节点 $1$ 不关联（$0$）。\n\n构建 $3 \\times 2$ 的关联矩阵 $A$，其行对应节点 $\\{1, 2, 3\\}$，列对应边 $\\{e_1, e_2\\}$：\n$$\nA = \\begin{pmatrix}\n1 & 0 \\\\\n-1 & 1 \\\\\n0 & -1\n\\end{pmatrix}\n$$\n\n(b) 推导总线导纳矩阵 $Y_{\\mathrm{bus}}$\n\n总线导纳矩阵 $Y_{\\mathrm{bus}}$ 通过方程 $I = Y_{\\mathrm{bus}}V$ 将总线注入电流矢量 $I$ 与总线电压矢量 $V$ 联系起来。它可以通过在每个总线上使用 Kirchhoff 电流定律 (KCL) 从第一性原理推导出来。\n\n设 $V_1, V_2, V_3$ 是总线 $1, 2, 3$ 处的复电压，$I_1, I_2, I_3$ 是注入这些总线的电流。\n总线 1 处的 KCL：从总线 $1$ 流向总线 $2$ 的电流为 $(V_1-V_2)y_{12}$。因此，注入电流为 $I_1 = (V_1-V_2)y_{12} = y_{12}V_1 - y_{12}V_2$。\n总线 2 处的 KCL：从总线 $2$ 流向总线 $1$ 的电流为 $(V_2-V_1)y_{12}$，流向总线 $3$ 的电流为 $(V_2-V_3)y_{23}$。注入电流为 $I_2 = (V_2-V_1)y_{12} + (V_2-V_3)y_{23} = -y_{12}V_1 + (y_{12}+y_{23})V_2 - y_{23}V_3$。\n总线 3 处的 KCL：从总线 $3$ 流向总线 $2$ 的电流为 $(V_3-V_2)y_{23}$。注入电流为 $I_3 = (V_3-V_2)y_{23} = -y_{23}V_2 + y_{23}V_3$。\n\n将这些方程整理成矩阵形式 $[I] = [Y_{\\mathrm{bus}}][V]$：\n$$\n\\begin{pmatrix} I_1 \\\\ I_2 \\\\ I_3 \\end{pmatrix} =\n\\begin{pmatrix}\ny_{12} & -y_{12} & 0 \\\\\n-y_{12} & y_{12}+y_{23} & -y_{23} \\\\\n0 & -y_{23} & y_{23}\n\\end{pmatrix}\n\\begin{pmatrix} V_1 \\\\ V_2 \\\\ V_3 \\end{pmatrix}\n$$\n代入计算出的导纳值 $y_{12} = -j5$ 和 $y_{23} = -j4$：\n$$\nY_{\\mathrm{bus}} =\n\\begin{pmatrix}\n-j5 & -(-j5) & 0 \\\\\n-(-j5) & (-j5)+(-j4) & -(-j4) \\\\\n0 & -(-j4) & -j4\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-j5 & j5 & 0 \\\\\nj5 & -j9 & j4 \\\\\n0 & j4 & -j4\n\\end{pmatrix}\n$$\n\n(c) 推导加权图拉普拉斯矩阵 $L$\n\n在直流潮流近似中，有功功率注入矢量 $P$ 与总线电压相角矢量 $\\theta$ 通过方程 $P = B' \\theta$ 相关联，其中 $B'$ 是直流总线导纳矩阵。该矩阵定义为 $B' = -\\mathrm{Im}(Y_{\\mathrm{bus}})$，并且与网络的加权图拉普拉斯矩阵 $L$ 相同，其中边的权重是电纳 $B_{ik}$。\n\n使用推导出的 $Y_{\\mathrm{bus}}$：\n$$\n\\mathrm{Im}(Y_{\\mathrm{bus}}) =\n\\begin{pmatrix}\n-5 & 5 & 0 \\\\\n5 & -9 & 4 \\\\\n0 & 4 & -4\n\\end{pmatrix}\n$$\n因此，加权图拉普拉斯矩阵 $L$ 为：\n$$\nL = B' = -\\mathrm{Im}(Y_{\\mathrm{bus}}) = -\n\\begin{pmatrix}\n-5 & 5 & 0 \\\\\n5 & -9 & 4 \\\\\n0 & 4 & -4\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n5 & -5 & 0 \\\\\n-5 & 9 & -4 \\\\\n0 & -4 & 4\n\\end{pmatrix}\n$$\n该矩阵是对称的，且行和与列和均为零，这些是拉普拉斯矩阵的性质。\n\n代数连通度的计算\n\n图的代数连通度是其拉普拉斯矩阵的第二小特征值，记为 $\\lambda_2$。对于任何连通图，最小特征值 $\\lambda_1$ 始终为 $0$。我们需要找到 $L$ 的特征值。\n特征方程为 $\\det(L - \\lambda I) = 0$。\n$$\n\\det\\left(\n\\begin{pmatrix}\n5-\\lambda & -5 & 0 \\\\\n-5 & 9-\\lambda & -4 \\\\\n0 & -4 & 4-\\lambda\n\\end{pmatrix}\n\\right) = 0\n$$\n我们沿第一行展开行列式：\n$$\n(5-\\lambda) \\det\\left(\\begin{pmatrix} 9-\\lambda & -4 \\\\ -4 & 4-\\lambda \\end{pmatrix}\\right) - (-5) \\det\\left(\\begin{pmatrix} -5 & -4 \\\\ 0 & 4-\\lambda \\end{pmatrix}\\right) = 0\n$$\n$$\n(5-\\lambda)[(9-\\lambda)(4-\\lambda) - 16] + 5[-5(4-\\lambda) - 0] = 0\n$$\n$$\n(5-\\lambda)[\\lambda^2 - 13\\lambda + 36 - 16] + 5[-20 + 5\\lambda] = 0\n$$\n$$\n(5-\\lambda)(\\lambda^2 - 13\\lambda + 20) - 100 + 25\\lambda = 0\n$$\n$$\n5\\lambda^2 - 65\\lambda + 100 - \\lambda^3 + 13\\lambda^2 - 20\\lambda - 100 + 25\\lambda = 0\n$$\n合并各项，我们得到：\n$$\n-\\lambda^3 + (5+13)\\lambda^2 + (-65-20+25)\\lambda + (100-100) = 0\n$$\n$$\n-\\lambda^3 + 18\\lambda^2 - 60\\lambda = 0\n$$\n$$\n\\lambda^3 - 18\\lambda^2 + 60\\lambda = 0\n$$\n提出因子 $\\lambda$：\n$$\n\\lambda(\\lambda^2 - 18\\lambda + 60) = 0\n$$\n一个特征值是 $\\lambda_1 = 0$，正如连通图所预期的。另外两个特征值是二次方程 $\\lambda^2 - 18\\lambda + 60 = 0$ 的根。\n使用二次方程求根公式，$\\lambda = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$：\n$$\n\\lambda = \\frac{18 \\pm \\sqrt{(-18)^2 - 4(1)(60)}}{2(1)}\n$$\n$$\n\\lambda = \\frac{18 \\pm \\sqrt{324 - 240}}{2}\n$$\n$$\n\\lambda = \\frac{18 \\pm \\sqrt{84}}{2}\n$$\n为简化 $\\sqrt{84}$，我们注意到 $84 = 4 \\times 21$，所以 $\\sqrt{84} = 2\\sqrt{21}$。\n$$\n\\lambda = \\frac{18 \\pm 2\\sqrt{21}}{2} = 9 \\pm \\sqrt{21}\n$$\n三个特征值为 $\\lambda_1=0$，$\\lambda_2=9 - \\sqrt{21}$ 和 $\\lambda_3=9 + \\sqrt{21}$。由于 $\\sqrt{16}  \\sqrt{21}  \\sqrt{25}$，我们有 $4  \\sqrt{21}  5$，这证实了 $0  9 - \\sqrt{21}  9 + \\sqrt{21}$。\n按升序排列的特征值为 $\\lambda_{(1)}=0$，$\\lambda_{(2)}=9 - \\sqrt{21}$ 和 $\\lambda_{(3)}=9 + \\sqrt{21}$。\n\n代数连通度是第二小特征值 $\\lambda_{(2)}$。",
            "answer": "$$\n\\boxed{9-\\sqrt{21}}\n$$"
        },
        {
            "introduction": "在拥有了标准化的节点特征和明确的图结构之后，我们便可以探索GNN的核心运作机制：消息传递。聚合函数（Aggregation）作为消息传递中的关键环节，其选择直接影响模型的性能。本练习  是一个动手编程任务，它引导您模拟并比较不同的聚合器（例如求和与最大值聚合），并定量分析它们在捕捉潮流分布等关键物理现象方面的表现，从而为您在GNN模型设计中做出明智决策提供深刻见解。",
            "id": "4094253",
            "problem": "考虑一个由 $5$ 个母线组成的连通电力传输网络，表示为一个无向图。每条线路 $(i,j)$ 都有一个以标幺值 (p.u.) 表示的串联电抗，该网络使用线性化直流 (DC) 潮流近似模型进行建模。设净有功功率注入向量为 $\\mathbf{p} \\in \\mathbb{R}^{5}$ (p.u.)，约定发电为正，负荷为负，且功率平衡 $\\sum_{i=1}^{5} p_i = 0$ 成立。角度以弧度为单位。选择母线 $1$ 作为平衡母线，其角度 $\\theta_1 = 0$。直流潮流模型表述为\n$$\n\\mathbf{p} = \\mathbf{B} \\, \\boldsymbol{\\theta},\n$$\n其中 $\\boldsymbol{\\theta} \\in \\mathbb{R}^{5}$ 是母线电压相角向量，$\\mathbf{B} \\in \\mathbb{R}^{5 \\times 5}$ 是母线电纳矩阵，定义为\n$$\nB_{ij} = \\begin{cases}\n-\\frac{1}{x_{ij}}  \\text{若母线 } i \\text{ 和 } j \\text{ 直接相连},\\\\\n0  \\text{若母线 } i \\text{ 和 } j \\text{ 未直接相连且 } i \\neq j,\\\\\n-\\sum_{k \\neq i} B_{ik}  \\text{若 } i = j,\n\\end{cases}\n$$\n其中 $x_{ij}$ 是线路 $(i,j)$ 的串联电抗 (p.u.)。对于每个连接对 $(i,j)$，直流支路潮流 (p.u.) 为\n$$\nF_{ij} = \\frac{1}{x_{ij}} \\left(\\theta_i - \\theta_j\\right),\n$$\n母线 $i$ 上的总关联潮流幅值定义为\n$$\nd_i = \\sum_{j \\in \\mathcal{N}(i)} \\left| F_{ij} \\right|,\n$$\n其中 $\\mathcal{N}(i)$ 表示母线 $i$ 的邻居集合。\n\n在该图上定义一个图神经网络 (GNN) 的消息传递步骤如下。设初始节点特征为 $h_i^{(0)} = p_i$ (p.u.)，并为每个连接对 $(i,j)$ 定义一个边权重 $s_{ij} = \\left| B_{ij} \\right|$。从节点 $j$ 发送到节点 $i$ 的消息是\n$$\nm_{ij} = s_{ij} \\cdot \\left| h_j^{(0)} \\right| = \\left| B_{ij} \\right| \\cdot \\left| p_j \\right|.\n$$\n在每个节点 $i$ 上考虑两种聚合算子：\n- 求和聚合 (Sum-aggregation): \n$$\na_i^{\\mathrm{sum}} = \\sum_{j \\in \\mathcal{N}(i)} m_{ij} = \\sum_{j \\in \\mathcal{N}(i)} \\left| B_{ij} \\right| \\cdot \\left| p_j \\right|.\n$$\n- 最大值聚合 (Max-aggregation):\n$$\na_i^{\\mathrm{max}} = \\max_{j \\in \\mathcal{N}(i)} m_{ij} = \\max_{j \\in \\mathcal{N}(i)} \\left\\{ \\left| B_{ij} \\right| \\cdot \\left| p_j \\right| \\right\\}.\n$$\n\n目标是定量比较每种聚合在多大程度上捕捉了由 $\\{ d_i \\}_{i=1}^{5}$ 编码的分布式潮流依赖关系。定义聚合向量 $\\mathbf{a} \\in \\mathbb{R}^{5}$ 相对于 $\\mathbf{d} \\in \\mathbb{R}^{5}$ 的归一化平均绝对误差 (无量纲) 为\n$$\n\\operatorname{NMAE}(\\mathbf{a}, \\mathbf{d}) = \\frac{\\sum_{i=1}^{5} \\left| a_i - d_i \\right|}{\\sum_{i=1}^{5} d_i}.\n$$\n对于每个测试用例，计算改进因子\n$$\n\\gamma = \\frac{\\operatorname{NMAE}\\left(\\mathbf{a}^{\\mathrm{max}}, \\mathbf{d}\\right)}{\\operatorname{NMAE}\\left(\\mathbf{a}^{\\mathrm{sum}}, \\mathbf{d}\\right)},\n$$\n如果求和聚合比最大值聚合更接近 (误差更低) 分布式依赖 $\\mathbf{d}$，则该因子大于 $1$。\n\n使用以下 $5$-母线网络和线路电抗 (p.u.):\n- 线路 $(1,2)$: $x_{12} = 0.2$,\n- 线路 $(1,3)$: $x_{13} = 0.25$,\n- 线路 $(2,3)$: $x_{23} = 0.3$,\n- 线路 $(2,4)$: $x_{24} = 0.4$,\n- 线路 $(3,5)$: $x_{35} = 0.35$,\n- 线路 $(4,5)$: $x_{45} = 0.5$,\n- 线路 $(1,5)$: $x_{15} = 0.45$.\n\n相应地构建 $\\mathbf{B}$。使用直流潮流关系和平衡母线角度 $\\theta_1 = 0$ 求解 $\\boldsymbol{\\theta}$。计算每条连接线路的 $F_{ij}$，然后计算每个母线的 $d_i$。\n\n测试套件 (所有注入功率均为 p.u.，每个向量 $\\mathbf{p}$ 满足 $\\sum_i p_i = 0$):\n- 用例 1 (分布式注入): $\\mathbf{p}^{(1)} = [0.4,\\,-0.1,\\,0.0,\\,-0.15,\\,-0.15]$,\n- 用例 2 (单源单汇): $\\mathbf{p}^{(2)} = [1.0,\\,-1.0,\\,0.0,\\,0.0,\\,0.0]$,\n- 用例 3 (相邻母线相反): $\\mathbf{p}^{(3)} = [0.0,\\,0.6,\\,-0.6,\\,0.0,\\,0.0]$,\n- 用例 4 (轻度分散): $\\mathbf{p}^{(4)} = [0.25,\\,-0.05,\\,-0.1,\\,-0.05,\\,-0.05]$.\n\n你的程序应生成一行输出，其中包含四个用例的改进因子 $\\gamma$，格式为方括号内以逗号分隔的列表 (例如，$[r_1,r_2,r_3,r_4]$)。角度必须以弧度处理，电抗和注入功率以 p.u. 处理，最终的改进因子是无量纲的浮点数。不要进行任何四舍五入；报告原始计算出的浮点数。",
            "solution": "用户提供的问题经确认为具有科学依据、定义明确、客观且自洽。这是一个电力系统分析和图神经网络领域的规范问题，未发现任何缺陷。因此，有必要提供完整的解决方案。\n\n解决方法包括对每个提供的测试用例进行系统性计算。核心步骤是：1) 构建网络的数学表示，2) 求解直流潮流方程以找到母线电压相角，3) 计算基准潮流分布度量 $\\mathbf{d}$，4) 计算基于 GNN 的聚合度量 $\\mathbf{a}^{\\mathrm{sum}}$ 和 $\\mathbf{a}^{\\mathrm{max}}$，以及 5) 评估最终的改进因子 $\\gamma$。\n\n### 步骤 1：网络表示与电纳矩阵构建\n\n$5$-母线电力网络被表示为一个图，其中母线是节点，输电线路是边。直流潮流模型的关键电气属性是母线电纳矩阵 $\\mathbf{B} \\in \\mathbb{R}^{5 \\times 5}$。其元素由给定的线路电抗 $x_{ij}$ 导出。\n\n非对角元素由 $B_{ij} = -1/x_{ij}$ 给出 (如果母线 $i$ 和母线 $j$ 之间存在边)，否则 $B_{ij} = 0$。对角元素为 $B_{ii} = -\\sum_{k \\neq i} B_{ik}$。我们将线路的电纳大小表示为 $b_{ij} = 1/x_{ij}$。给定的电抗为：\n- $x_{12} = 0.2 \\implies b_{12} = 5.0$ p.u.\n- $x_{13} = 0.25 \\implies b_{13} = 4.0$ p.u.\n- $x_{23} = 0.3 \\implies b_{23} \\approx 3.333$ p.u.\n- $x_{24} = 0.4 \\implies b_{24} = 2.5$ p.u.\n- $x_{35} = 0.35 \\implies b_{35} \\approx 2.857$ p.u.\n- $x_{45} = 0.5 \\implies b_{45} = 2.0$ p.u.\n- $x_{15} = 0.45 \\implies b_{15} \\approx 2.222$ p.u.\n\n使用这些值，母线电纳矩阵 $\\mathbf{B}$ 构建如下：\n$$\n\\mathbf{B} = \\begin{pmatrix}\nb_{12}+b_{13}+b_{15}  -b_{12}  -b_{13}  0  -b_{15} \\\\\n-b_{12}  b_{12}+b_{23}+b_{24}  -b_{23}  -b_{24}  0 \\\\\n-b_{13}  -b_{23}  b_{13}+b_{23}+b_{35}  0  -b_{35} \\\\\n0  -b_{24}  0  b_{24}+b_{45}  -b_{45} \\\\\n-b_{15}  0  -b_{35}  -b_{45}  b_{15}+b_{35}+b_{45}\n\\end{pmatrix}\n$$\n数值上，它近似为：\n$$\n\\mathbf{B} \\approx \\begin{pmatrix}\n11.222  -5.0  -4.0  0.0  -2.222 \\\\\n-5.0  10.833  -3.333  -2.5  0.0 \\\\\n-4.0  -3.333  10.190  0.0  -2.857 \\\\\n0.0  -2.5  0.0  4.5  -2.0 \\\\\n-2.222  0.0  -2.857  -2.0  7.079\n\\end{pmatrix}\n$$\n\n### 步骤 2：求解母线电压相角\n\n直流潮流模型是一个线性系统 $\\mathbf{p} = \\mathbf{B} \\boldsymbol{\\theta}$，其中 $\\mathbf{p}$ 是净有功功率注入向量，$\\boldsymbol{\\theta}$ 是母线电压相角向量。矩阵 $\\mathbf{B}$ 是奇异的，因为其行和与列和均为零。为获得唯一解，我们必须指定一个参考相角。问题指定母线 $1$ 为平衡母线，其相角 $\\theta_1 = 0$ 弧度。\n\n这使我们能够求解剩余的未知相角 $(\\theta_2, \\theta_3, \\theta_4, \\theta_5)$。我们通过移除原始系统的第一行和第一列来形成一个降阶线性系统：\n$$\n\\mathbf{p}_{\\text{red}} = \\mathbf{B}_{\\text{red}} \\boldsymbol{\\theta}_{\\text{red}}\n$$\n其中 $\\mathbf{p}_{\\text{red}} = [p_2, p_3, p_4, p_5]^T$，$\\boldsymbol{\\theta}_{\\text{red}} = [\\theta_2, \\theta_3, \\theta_4, \\theta_5]^T$，而 $\\mathbf{B}_{\\text{red}}$ 是 $\\mathbf{B}$ 中对应于母线 $2$ 到 $5$ 的 $4 \\times 4$ 子矩阵。由于网络是连通的，$\\mathbf{B}_{\\text{red}}$ 是可逆的。通过求解该系统可找到未知相角：\n$$\n\\boldsymbol{\\theta}_{\\text{red}} = \\mathbf{B}_{\\text{red}}^{-1} \\mathbf{p}_{\\text{red}}\n$$\n网络的完整相角向量则为 $\\boldsymbol{\\theta} = [0, \\theta_2, \\theta_3, \\theta_4, \\theta_5]^T$。\n\n### 步骤 3：计算目标潮流依赖 ($\\mathbf{d}$)\n\n向量 $\\mathbf{d}$ 表示每个母线上潮流应力的基准分布。首先，我们计算每条线路 $(i,j)$ 上的有功潮流 $F_{ij}$：\n$$\nF_{ij} = \\frac{1}{x_{ij}} (\\theta_i - \\theta_j) = b_{ij}(\\theta_i - \\theta_j)\n$$\n然后，对于每个母线 $i$，我们对连接到它的所有线路上的潮流幅值求和：\n$$\nd_i = \\sum_{j \\in \\mathcal{N}(i)} |F_{ij}|\n$$\n其中 $\\mathcal{N}(i)$ 是母线 $i$ 的邻居母线集合。对所有 $i \\in \\{1, \\dots, 5\\}$ 执行此计算以形成向量 $\\mathbf{d}$。\n\n### 步骤 4：计算 GNN 聚合 ($\\mathbf{a}^{\\mathrm{sum}}$ 和 $\\mathbf{a}^{\\mathrm{max}}$)\n\n问题定义了一个单一的 GNN 消息传递步骤，其中初始节点特征是功率注入 $h_i^{(0)} = p_i$。聚合 $\\mathbf{a}^{\\mathrm{sum}}$ 和 $\\mathbf{a}^{\\mathrm{max}}$ 是潮流分布的局部近似，计算时无需求解全局潮流方程。\n\n对于每个母线 $i$，来自邻居母线 $j$ 的消息为 $m_{ij} = |B_{ij}| \\cdot |p_j| = b_{ij} |p_j|$。然后，两个聚合算子为：\n- 求和聚合： $a_i^{\\mathrm{sum}} = \\sum_{j \\in \\mathcal{N}(i)} m_{ij} = \\sum_{j \\in \\mathcal{N}(i)} b_{ij} |p_j|$\n- 最大值聚合： $a_i^{\\mathrm{max}} = \\max_{j \\in \\mathcal{N}(i)} m_{ij} = \\max_{j \\in \\mathcal{N}(i)} \\{ b_{ij} |p_j| \\}$\n\n对所有 $i \\in \\{1, \\dots, 5\\}$ 执行这些计算，以形成向量 $\\mathbf{a}^{\\mathrm{sum}}$ 和 $\\mathbf{a}^{\\mathrm{max}}$。\n\n### 步骤 5：误差与改进因子计算\n\n归一化平均绝对误差 (NMAE) 量化了聚合向量 $\\mathbf{a}$ 与目标向量 $\\mathbf{d}$ 之间的差异：\n$$\n\\operatorname{NMAE}(\\mathbf{a}, \\mathbf{d}) = \\frac{\\sum_{i=1}^{5} |a_i - d_i|}{\\sum_{i=1}^{5} d_i}\n$$\n最终的改进因子 $\\gamma$ 比较了求和聚合与最大值聚合的性能：\n$$\n\\gamma = \\frac{\\operatorname{NMAE}(\\mathbf{a}^{\\mathrm{max}}, \\mathbf{d})}{\\operatorname{NMAE}(\\mathbf{a}^{\\mathrm{sum}}, \\mathbf{d})} = \\frac{\\sum_{i=1}^{5} |a_i^{\\mathrm{max}} - d_i| / \\sum_{i=1}^{5} d_i}{\\sum_{i=1}^{5} |a_i^{\\mathrm{sum}} - d_i| / \\sum_{i=1}^{5} d_i} = \\frac{\\sum_{i=1}^{5} |a_i^{\\mathrm{max}} - d_i|}{\\sum_{i=1}^{5} |a_i^{\\mathrm{sum}} - d_i|}\n$$\n$\\gamma  1$ 的值表示求和聚合比最大值聚合更好地近似了真实潮流分布 $\\mathbf{d}$。对于功率注入向量 $\\mathbf{p}$ 的四个指定测试用例，重复此整个过程。\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the power system GNN analysis problem for four test cases.\n    \"\"\"\n    \n    # Define network parameters using 1-based indexing for clarity.\n    reactances = {\n        (1, 2): 0.2, (1, 3): 0.25, (2, 3): 0.3, (2, 4): 0.4,\n        (3, 5): 0.35, (4, 5): 0.5, (1, 5): 0.45\n    }\n    num_buses = 5\n\n    # Convert to 0-based indexing for implementation.\n    connections = [(u - 1, v - 1, x) for (u, v), x in reactances.items()]\n\n    # Build susceptance-related structures.\n    # We use 0-based indexing for all arrays and lists from here on.\n    B = np.zeros((num_buses, num_buses))\n    neighbors = [[] for _ in range(num_buses)]\n    b_values = {} # To store |B_ij| = 1/x_ij\n\n    for u, v, x in connections:\n        susceptance = -1.0 / x\n        # Off-diagonal elements of B matrix\n        B[u, v] = susceptance\n        B[v, u] = susceptance\n        \n        # Store absolute value b_ij = 1/x_ij for future calculations\n        b_values[(u, v)] = 1.0 / x\n        b_values[(v, u)] = 1.0 / x\n\n        # Adjacency list for graph traversal\n        if v not in neighbors[u]:\n            neighbors[u].append(v)\n        if u not in neighbors[v]:\n            neighbors[v].append(u)\n    \n    # Sort neighbor lists for deterministic behavior (optional but good practice)\n    for i in range(num_buses):\n        neighbors[i].sort()\n\n    # Diagonal elements of B matrix\n    for i in range(num_buses):\n        B[i, i] = -np.sum(B[i, :]) + B[i,i] # sum B_ik for k!=i\n\n    # Reduced B matrix for solving with slack bus 1 (index 0)\n    B_red = B[1:, 1:]\n    \n    # Define the test cases for power injections p.\n    test_cases = [\n        np.array([0.4, -0.1, 0.0, -0.15, -0.15]),\n        np.array([1.0, -1.0, 0.0, 0.0, 0.0]),\n        np.array([0.0, 0.6, -0.6, 0.0, 0.0]),\n        np.array([0.25, -0.05, -0.1, -0.05, -0.05]),\n    ]\n\n    results = []\n\n    for p in test_cases:\n        # Step 1: Solve for angles theta using DC power flow\n        p_red = p[1:]\n        theta_red = np.linalg.solve(B_red, p_red)\n        theta = np.concatenate(([0.0], theta_red))\n\n        # Step 2: Calculate the target vector d (total incident flow magnitude)\n        d = np.zeros(num_buses)\n        for i in range(num_buses):\n            total_incident_flow = 0.0\n            for j in neighbors[i]:\n                # F_ij = (1/x_ij) * (theta_i - theta_j)\n                flow = b_values[(i, j)] * (theta[i] - theta[j])\n                total_incident_flow += abs(flow)\n            d[i] = total_incident_flow\n\n        # Step 3: Calculate GNN aggregation vectors a_sum and a_max\n        a_sum = np.zeros(num_buses)\n        a_max = np.zeros(num_buses)\n        p_abs = np.abs(p)\n\n        for i in range(num_buses):\n            messages = []\n            for j in neighbors[i]:\n                # m_ij = |B_ij| * |p_j| = (1/x_ij) * |p_j|\n                msg = b_values[(i, j)] * p_abs[j]\n                messages.append(msg)\n            \n            # Aggregate messages\n            if messages:\n                a_sum[i] = np.sum(messages)\n                a_max[i] = np.max(messages)\n        \n        # Step 4: Calculate NMAEs and the improvement factor gamma\n        mae_sum = np.sum(np.abs(a_sum - d))\n        mae_max = np.sum(np.abs(a_max - d))\n\n        # The factor gamma is the ratio of the Mean Absolute Errors (MAE), as the\n        # normalization factor sum(d_i) cancels out.\n        if mae_sum == 0:\n            # If sum-aggregation is perfect, its error is 0.\n            # If max-aggregation is also perfect, they are equally good (gamma=1).\n            # If max-aggregation is not perfect, sum is infinitely better (gamma=inf).\n            gamma = 1.0 if mae_max == 0 else float('inf')\n        else:\n            gamma = mae_max / mae_sum\n        \n        results.append(gamma)\n\n    # Print the final results in the specified format without rounding.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```",
            "answer": "[3.313437330541991,4.401174246014493,1.6033324623193233,2.443743540228308]"
        }
    ]
}