{
    "hands_on_practices": [
        {
            "introduction": "We begin with the most fundamental building block of robust optimization: the robust counterpart. This first exercise guides you through deriving the deterministic equivalent of an uncertain linear constraint, $a^{\\top} x \\ge b$, from first principles using a simple but common 'box' uncertainty set. Mastering this procedure  is essential for building and solving any robust optimization model, providing a solid foundation for handling uncertainty.",
            "id": "4119827",
            "problem": "An aggregator plans capacity procurement for a set of $n$ technologies to meet a firm capacity requirement under uncertain availability. Let $x \\in \\mathbb{R}^{n}$ denote the procurement decision vector, where $x_{i}$ represents the procured nameplate capacity of technology $i$. Let $a \\in \\mathbb{R}^{n}$ denote uncertain availability multipliers, where $a_{i}$ is the realized fraction of procured capacity that is deliverable at the time of need. The firm capacity requirement is $b \\in \\mathbb{R}$, measured in Megawatt (MW). The reliability constraint requires the realized firm capacity to satisfy $a^{\\top} x \\ge b$.\n\nAssume a box uncertainty set around the nominal availability vector $\\bar a \\in \\mathbb{R}^{n}$ with componentwise radius $\\Delta \\in \\mathbb{R}_{+}^{n}$, defined as\n$$\n\\mathcal{U} \\;=\\; \\left\\{ a \\in \\mathbb{R}^{n} \\;:\\; |a_{i} - \\bar a_{i}| \\le \\Delta_{i},\\;\\; i=1,\\dots,n \\right\\}.\n$$\nUsing the fundamental definition of robust optimization, a robust constraint must hold for all realizations $a \\in \\mathcal{U}$, which is equivalently enforced by requiring the worst-case (minimum) value of $a^{\\top} x$ over $\\mathcal{U}$ to be at least $b$.\n\nDerive, from first principles and without invoking pre-memorized formulas, a closed-form analytic expression for the worst-case value\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x\n$$\nas a function of $\\bar a$, $\\Delta$, and $x$. Then, write the robust counterpart of $a^{\\top} x \\ge b$ in terms of $x$ only. Express your final answer as the closed-form analytic expression for $\\min_{a \\in \\mathcal{U}} a^{\\top} x$. No numerical approximation or rounding is required.",
            "solution": "The problem will be validated before a solution is attempted.\n\n### Step 1: Extract Givens\n- Decision vector: $x \\in \\mathbb{R}^{n}$, where $x_{i}$ is the procured nameplate capacity of technology $i$.\n- Uncertain parameter vector: $a \\in \\mathbb{R}^{n}$, where $a_{i}$ is the realized availability multiplier.\n- Firm capacity requirement: $b \\in \\mathbb{R}$.\n- Reliability constraint: $a^{\\top} x \\ge b$.\n- Nominal availability vector: $\\bar a \\in \\mathbb{R}^{n}$.\n- Uncertainty radius vector: $\\Delta \\in \\mathbb{R}_{+}^{n}$.\n- Uncertainty set definition: $\\mathcal{U} \\;=\\; \\left\\{ a \\in \\mathbb{R}^{n} \\;:\\; |a_{i} - \\bar a_{i}| \\le \\Delta_{i},\\;\\; i=1,\\dots,n \\right\\}$.\n- Task 1: Derive a closed-form analytic expression for $\\min_{a \\in \\mathcal{U}} a^{\\top} x$.\n- Task 2: Write the robust counterpart of $a^{\\top} x \\ge b$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is evaluated against the validation criteria.\n\n- **Scientifically Grounded**: The problem is a standard application of robust optimization, a well-established subfield of mathematical optimization. The formulation models capacity planning under uncertainty, a common and important problem in energy systems engineering. The concepts used are standard and the model, while simplified, is scientifically sound.\n- **Well-Posed**: The problem asks for the minimum of a linear function, $f(a) = a^{\\top}x$, over a non-empty, compact, and convex set $\\mathcal{U}$ (a hyperrectangle). By the Weierstrass Extreme Value Theorem, a continuous function (in this case, linear) on a compact set attains its minimum and maximum. The minimum value is unique. Therefore, the problem is well-posed.\n- **Objective**: The problem is stated using precise, unambiguous mathematical language and standard terminology from optimization and energy systems.\n- **Completeness and Consistency**: The problem provides all necessary information to derive the requested expression. The definitions of the vectors and the uncertainty set are clear and self-contained. There are no internal contradictions. While the physical interpretation of \"procured capacity\" suggests $x_i \\ge 0$, the problem is formulated more generally for $x \\in \\mathbb{R}^n$, which is mathematically coherent. The derivation will be performed for the general case.\n- **Other Flaws**: The problem does not violate any other criteria such as being unrealistic, ill-structured, trivial, or containing pseudoscience. It is a fundamental and instructive exercise in robust optimization.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full, reasoned solution will be provided.\n\n### Solution Derivation\nThe objective is to find the closed-form analytical expression for the worst-case value of the realized capacity, which is formulated as the following minimization problem:\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x\n$$\nThe objective function can be written as a sum over the individual components:\n$$\na^{\\top} x = \\sum_{i=1}^{n} a_{i} x_{i}\n$$\nThe uncertainty set $\\mathcal{U}$ defines independent constraints on each component $a_i$. Specifically, for each $i \\in \\{1, \\dots, n\\}$, the variable $a_i$ is constrained to lie within the closed interval $[\\bar{a}_{i} - \\Delta_{i}, \\bar{a}_{i} + \\Delta_{i}]$.\n\nSince the objective function is a sum of terms where each term $a_i x_i$ involves only one variable $a_i$, and the constraints for each $a_i$ are independent of the other variables $a_j$ for $j \\neq i$, the minimization problem is separable. This allows us to exchange the sum and the minimization operators:\n$$\n\\min_{a \\in \\mathcal{U}} \\left( \\sum_{i=1}^{n} a_{i} x_{i} \\right) = \\sum_{i=1}^{n} \\left( \\min_{\\bar{a}_{i} - \\Delta_{i} \\le a_{i} \\le \\bar{a}_{i} + \\Delta_{i}} a_{i} x_{i} \\right)\n$$\nWe now analyze the inner minimization problem for each component $i$:\n$$\n\\min_{\\bar{a}_{i} - \\Delta_{i} \\le a_{i} \\le \\bar{a}_{i} + \\Delta_{i}} a_{i} x_{i}\n$$\nThe function to be minimized, $f(a_i) = a_i x_i$, is a linear function of the variable $a_i$. The minimum of a linear function over a closed interval must occur at one of the interval's endpoints. The two endpoints for $a_i$ are $\\bar{a}_{i} - \\Delta_{i}$ and $\\bar{a}_{i} + \\Delta_{i}$. The choice of endpoint that minimizes $a_i x_i$ depends on the sign of the fixed coefficient $x_i$.\n\n1.  If $x_{i} > 0$: To minimize the product $a_i x_i$, we must choose the smallest possible value for $a_i$. This value is the lower bound of the interval, $a_{i}^{*} = \\bar{a}_{i} - \\Delta_{i}$. The minimum value of the term is $(\\bar{a}_{i} - \\Delta_{i}) x_{i}$.\n\n2.  If $x_{i}  0$: To minimize the product $a_i x_i$, we must choose the largest possible value for $a_i$, as multiplying by a negative $x_i$ will reverse the inequality. This value is the upper bound of the interval, $a_{i}^{*} = \\bar{a}_{i} + \\Delta_{i}$. The minimum value of the term is $(\\bar{a}_{i} + \\Delta_{i}) x_{i}$.\n\n3.  If $x_{i} = 0$: The product $a_i x_i$ is always $0$, regardless of the value of $a_i$. The minimum value is $0$.\n\nThese three cases can be unified into a single expression. We can express the minimum value of the term $a_i x_i$ as follows:\n- For $x_i > 0$: $\\bar{a}_{i}x_{i} - \\Delta_{i}x_{i} = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|$\n- For $x_i  0$: $\\bar{a}_{i}x_{i} + \\Delta_{i}x_{i} = \\bar{a}_{i}x_{i} - \\Delta_{i}(-x_{i}) = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|$\n- For $x_i = 0$: $0 = \\bar{a}_{i}(0) - \\Delta_{i}|0| = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|$\n\nThus, for any $x_i \\in \\mathbb{R}$, the minimum value of $a_i x_i$ over its feasible interval is given by:\n$$\n\\min_{a_{i}} a_{i} x_{i} = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|\n$$\nThe value of $a_i$ that achieves this minimum is $a_i^* = \\bar{a}_i - \\Delta_i \\cdot \\text{sgn}(x_i)$, where $\\text{sgn}(\\cdot)$ is the sign function.\n\nSumming these individual minimum values over all $i$ from $1$ to $n$ gives the overall minimum of $a^{\\top}x$:\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x = \\sum_{i=1}^{n} (\\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|)\n$$\nThis expression can be separated into two parts:\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x = \\sum_{i=1}^{n} \\bar{a}_{i}x_{i} - \\sum_{i=1}^{n} \\Delta_{i}|x_{i}|\n$$\nThe first term is the dot product of the nominal availability vector $\\bar a$ and the decision vector $x$. The final expression is:\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x = \\bar{a}^{\\top}x - \\sum_{i=1}^{n} \\Delta_{i}|x_{i}|\n$$\nThis is the closed-form analytic expression requested.\n\nThe robust counterpart of the original constraint $a^{\\top} x \\ge b$ requires the constraint to hold for all possible realizations of $a$ in the uncertainty set $\\mathcal{U}$. This is equivalent to ensuring that the minimum possible value of the left-hand side is greater than or equal to the right-hand side:\n$$\n\\min_{a \\in \\mathcal{U}} (a^{\\top} x) \\ge b\n$$\nSubstituting the derived expression for the minimum, we obtain the robust counterpart, which is an inequality constraint on $x$ only:\n$$\n\\bar{a}^{\\top}x - \\sum_{i=1}^{n} \\Delta_{i}|x_{i}| \\ge b\n$$\nThis is a convex constraint, as $\\bar{a}^{\\top}x$ is linear and $\\sum_{i=1}^{n} \\Delta_{i}|x_{i}|$ is a convex function (a weighted L1-norm).\nThe final answer requested is the closed-form expression for the minimum value itself.",
            "answer": "$$\n\\boxed{\\bar{a}^{\\top}x - \\sum_{i=1}^{n} \\Delta_{i} |x_{i}|}\n$$"
        },
        {
            "introduction": "Next, we explore the core concept of distributionally robust optimization (DRO), where uncertainty is captured by a family of possible probability distributions. This practice challenges you to derive the 'worst-case' probability distribution for an uncertain power line flow, given only its mean $\\mu_{F}$ and variance $\\sigma_{F}^{2}$. The exercise  demonstrates how an adversary would concentrate probability mass to maximize risk, offering a deep insight into the mechanics of moment-based DRO.",
            "id": "4119953",
            "problem": "Consider a single transmission line in an electric power network modeled under the Direct Current (DC) power flow approximation. Let the uncertain real-time line flow be represented by the random variable $F$, whose true probability distribution is unknown but is known to satisfy the following moment information obtained from forecasting and historical data: its mean is $\\mu_{F}$ and its variance is $\\sigma_{F}^{2}$. A planning decision imposes the chance constraint that the line flow must not exceed a thermal limit $\\bar{F}$ with high probability. Specifically, the decision must be feasible for any distribution of $F$ consistent with this moment information, in the sense of Distributionally Robust Optimization (DRO).\n\nFormally, define the ambiguity set as the family of all probability distributions on $\\mathbb{R}$ with mean $\\mu_{F}$ and variance $\\sigma_{F}^{2}$. The distributionally robust chance constraint requires that $\\mathbb{P}(F \\leq \\bar{F}) \\geq 1 - \\varepsilon$ for all distributions in this ambiguity set. Assume $\\bar{F} > \\mu_{F}$ so that the limit is above the mean line flow. Construct the worst-case distribution (within the ambiguity set) that maximizes the violation probability $\\mathbb{P}(F > \\bar{F})$, and interpret the way its probability mass is aligned relative to the violation boundary $F = \\bar{F}$ to maximize risk. Then, compute the corresponding worst-case violation probability as a closed-form expression in terms of $\\mu_{F}$, $\\sigma_{F}$, and $\\bar{F}$.\n\nExpress your final answer as a single closed-form analytic expression. No rounding is required, and no physical units should be included in the final expression.",
            "solution": "The problem is valid. It is scientifically grounded in the fields of probability theory and distributionally robust optimization, well-posed, and objective. All necessary information is provided.\n\nThe problem asks for the worst-case violation probability of a chance constraint on a power transmission line flow, $F$. The constraint is that the flow $F$ must not exceed a thermal limit $\\bar{F}$. The violation event is therefore $F > \\bar{F}$. We are given that the uncertain flow $F$ is a random variable whose distribution is unknown, but its mean $\\mathbb{E}[F] = \\mu_{F}$ and variance $\\mathbb{V}[F] = \\sigma_{F}^{2}$ are known. The problem is posed within a Distributionally Robust Optimization (DRO) framework, which means we must find the maximum possible violation probability over all conceivable distributions of $F$ that are consistent with the given moment information.\n\nLet $\\mathcal{P}$ be the ambiguity set, which is the family of all probability distributions on $\\mathbb{R}$ with a mean of $\\mu_{F}$ and a variance of $\\sigma_{F}^{2}$. The task is to solve the following optimization problem:\n$$ \\sup_{P \\in \\mathcal{P}} \\mathbb{P}(F > \\bar{F}) $$\nThis is a classic problem in the theory of moments. The extremal distributions for such problems, which maximize or minimize probabilities of events subject to moment constraints, are known to be discrete distributions with a finite number of support points.\n\nTo maximize the probability mass in the region $( \\bar{F}, \\infty)$, the worst-case distribution should avoid \"wasting\" probability mass by spreading it out. Intuitively, it should concentrate the mass at specific points. Let us hypothesize that the worst-case distribution is a discrete distribution with two support points, $x_1$ and $x_2$. Let the corresponding probabilities be $p_1$ and $p_2$. In order to have a non-zero violation probability, at least one point must be in the violation region. Let $x_2 > \\bar{F}$ and $x_1 \\le \\bar{F}$. The violation probability is $p_2 = \\mathbb{P}(F > \\bar{F})$.\n\nThe distribution must satisfy the three constraints given by the moment information and the law of total probability:\n1.  $p_1 + p_2 = 1$\n2.  $p_1 x_1 + p_2 x_2 = \\mu_F$\n3.  $p_1 (x_1 - \\mu_F)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n\nFrom constraint (1), $p_1 = 1 - p_2$. Substituting this into constraint (2):\n$(1 - p_2) x_1 + p_2 x_2 = \\mu_F$\n$x_1 - p_2 x_1 + p_2 x_2 = \\mu_F$\n$x_1 = \\mu_F - p_2(x_2 - x_1)$\nThis expression is not directly useful. Let's express $x_1$ and $x_2$ in terms of their deviations from the mean. From constraint (2):\n$p_1(x_1 - \\mu_F) + p_2(x_2 - \\mu_F) = 0 \\implies (1-p_2)(x_1 - \\mu_F) = -p_2(x_2 - \\mu_F)$.\nSo, $x_1 - \\mu_F = -\\frac{p_2}{1-p_2}(x_2 - \\mu_F)$.\n\nNow, substitute this into the variance constraint (3):\n$(1-p_2) \\left( -\\frac{p_2}{1-p_2}(x_2 - \\mu_F) \\right)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n$(1-p_2) \\frac{p_2^2}{(1-p_2)^2} (x_2 - \\mu_F)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n$\\frac{p_2^2}{1-p_2} (x_2 - \\mu_F)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\left( \\frac{p_2^2}{1-p_2} + p_2 \\right) = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\left( \\frac{p_2^2 + p_2(1-p_2)}{1-p_2} \\right) = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\left( \\frac{p_2^2 + p_2 - p_2^2}{1-p_2} \\right) = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\frac{p_2}{1-p_2} = \\sigma_F^2$\n\nWe can now solve for $p_2$, the violation probability we wish to maximize:\n$p_2(x_2 - \\mu_F)^2 = (1-p_2)\\sigma_F^2 = \\sigma_F^2 - p_2 \\sigma_F^2$\n$p_2 \\left( (x_2 - \\mu_F)^2 + \\sigma_F^2 \\right) = \\sigma_F^2$\n$$ p_2 = \\frac{\\sigma_F^2}{\\sigma_F^2 + (x_2 - \\mu_F)^2} $$\nTo maximize $p_2$, we must minimize the denominator. This means we must minimize the term $(x_2 - \\mu_F)^2$ subject to the constraint that $x_2$ represents the violating outcome, i.e., $x_2 > \\bar{F}$.\nWe are given that $\\bar{F} > \\mu_F$. The function $g(x_2) = (x_2 - \\mu_F)^2$ is an increasing function for $x_2 > \\mu_F$. Since our domain for $x_2$ is $(\\bar{F}, \\infty)$, which is a subset of $(\\mu_F, \\infty)$, we must choose $x_2$ to be as small as possible. The infimum of $x_2$ over the set $(\\bar{F}, \\infty)$ is $\\bar{F}$.\nThe supremum of the probability $p_2$ is therefore achieved as $x_2$ approaches $\\bar{F}$ from above:\n$$ \\sup_{x_2 > \\bar{F}} p_2 = \\lim_{x_2 \\to \\bar{F}^+} \\frac{\\sigma_F^2}{\\sigma_F^2 + (x_2 - \\mu_F)^2} = \\frac{\\sigma_F^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} $$\nThis expression represents the worst-case violation probability. This result is a form of the one-sided Chebyshev inequality, also known as Cantelli's inequality.\n\nThe problem also asks to construct the worst-case distribution and interpret its structure. The supremum is not technically attained by a distribution for the strict inequality $\\mathbb{P}(F > \\bar{F})$. However, the same value is the maximum for the non-strict inequality $\\mathbb{P}(F \\ge \\bar{F})$, and this maximum is attained. In engineering and optimization practice, this distinction is often elided, and the distribution that attains the maximum for the non-strict inequality is referred to as the \"worst-case distribution\".\n\nThis worst-case distribution concentrates all probability mass at two points. One point is placed exactly at the violation boundary $x_2 = \\bar{F}$. The other point, $x_1$, is placed such that the mean and variance constraints are met.\nThe probability mass at $x_2 = \\bar{F}$ is the worst-case probability itself:\n$$ p_2 = \\mathbb{P}(F = \\bar{F}) = \\frac{\\sigma_F^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} $$\nThe probability mass at $x_1$ is:\n$$ p_1 = 1 - p_2 = 1 - \\frac{\\sigma_F^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} = \\frac{(\\bar{F} - \\mu_F)^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} $$\nThe location of the point $x_1$ is found from the relation $x_1 - \\mu_F = -\\frac{p_2}{1-p_2}(x_2 - \\mu_F)$:\n$$ \\frac{p_2}{1-p_2} = \\frac{\\sigma_F^2 / (\\dots)}{(\\bar{F} - \\mu_F)^2 / (\\dots)} = \\frac{\\sigma_F^2}{(\\bar{F} - \\mu_F)^2} $$\nSo, with $x_2 = \\bar{F}$:\n$$ x_1 = \\mu_F - \\frac{\\sigma_F^2}{(\\bar{F} - \\mu_F)^2}(\\bar{F} - \\mu_F) = \\mu_F - \\frac{\\sigma_F^2}{\\bar{F} - \\mu_F} $$\nThe interpretation of this distribution is that nature, or uncertainty, acts as an adversary. To maximize the probability of violating the limit $\\bar{F}$, it creates a binary world. With probability $p_2$, the \"bad\" outcome occurs, where the line flow lands precisely on the most critical point, the boundary $\\bar{F}$. With probability $p_1$, the \"good\" outcome occurs, but to satisfy the moment constraints, this outcome $x_1$ must be located far to the left of the mean. This structure represents the most damaging possible realization of uncertainty given only mean and variance information, eschewing well-behaved distributions like the Gaussian in favor of extreme, polarized outcomes.\n\nThe final answer is the closed-form expression for the worst-case violation probability.",
            "answer": "$$\\boxed{\\frac{\\sigma_{F}^{2}}{\\sigma_{F}^{2} + (\\bar{F} - \\mu_{F})^{2}}}$$"
        },
        {
            "introduction": "Having practiced the fundamentals of RO and DRO, this final exercise synthesizes these concepts in a practical, comparative study. You are tasked with implementing and evaluating pure robust, pure distributionally robust, and hybrid models for a wind-integrated power dispatch problem . By assessing each model's solution in terms of expected cost and operational reliability, you will gain a tangible understanding of the critical trade-offs between conservatism, performance, and modeling philosophy.",
            "id": "4119893",
            "problem": "Consider a single-period dispatch problem for a wind-integrated power system. A conventional generator schedules a dispatch decision $x$ (in $\\mathrm{MW}$) before the wind power $w$ (in $\\mathrm{MW}$) is realized. Demand is $D$ (in $\\mathrm{MW}$). The scheduled conventional generation incurs a linear cost $c$ (in $\\mathrm{dollars}/\\mathrm{MW}$), and any unmet demand incurs a load-shedding penalty $p$ (in $\\mathrm{dollars}/\\mathrm{MW}$), with $p \\gg c$. The conventional generator has an upper capacity limit $X_{\\max}$ (in $\\mathrm{MW}$), and $x \\in [0, X_{\\max}]$.\n\nUncertainty in wind power $w$ has known support $[a,b]$ (in $\\mathrm{MW}$) and a nominal mean $\\mu$ (in $\\mathrm{MW}$), where $a \\le \\mu \\le b$. Define the shortfall function $s(w;x) = \\max\\{0, D - x - w\\}$ (in $\\mathrm{MW}$). The objective is to select $x$ to hedge wind uncertainty according to one of three models:\n\n- Pure robust optimization: Assume wind lies within a robust uncertainty interval $U_{R} = [w_{\\min}^{R}, w_{\\max}^{R}]$, where $w_{\\min}^{R} = \\mu - \\theta_{R} (\\mu - a)$ and $w_{\\max}^{R} = \\mu + \\theta_{R} (b - \\mu)$ for a given robustness level $\\theta_{R} \\in [0,1]$. The robust decision minimizes the worst-case cost over $U_{R}$, i.e., minimize $c x + p \\cdot \\sup_{w \\in U_{R}} s(w;x)$, subject to $x \\in [0, X_{\\max}]$.\n\n- Pure Distributionally Robust Optimization (DRO): Consider the ambiguity set of probability distributions supported on $[a,b]$ with mean $\\mu$. The distributionally robust decision minimizes the worst-case expected cost $\\sup_{\\mathbb{P}} \\mathbb{E}_{\\mathbb{P}}[c x + p \\cdot s(w;x)]$ over all $\\mathbb{P}$ in this ambiguity set, subject to $x \\in [0, X_{\\max}]$.\n\n- Hybrid robust–DRO: Combine robust and distributionally robust perspectives by minimizing $c x + \\alpha \\, p \\cdot \\sup_{w \\in U_{R}} s(w;x) + (1 - \\alpha) \\, \\sup_{\\mathbb{P}} \\mathbb{E}_{\\mathbb{P}}[p \\cdot s(w;x)]$ for a mixing parameter $\\alpha \\in [0,1]$, subject to $x \\in [0, X_{\\max}]$.\n\nFor comparing solution quality and reliability, assume the true wind distribution is uniform over $[a,b]$. For any chosen $x$, define:\n\n- The expected total cost under the true distribution (quality): $Q(x) = c x + p \\cdot \\mathbb{E}[s(w;x)]$ (in $\\mathrm{dollars}$), where the expectation is with respect to the uniform distribution on $[a,b]$.\n\n- The reliability metric as the probability of a shortfall under the true distribution: $R(x) = \\mathbb{P}(w  D - x)$, expressed as a decimal in $[0,1]$.\n\nYour task is to implement a program that, for each of the following test cases, computes the optimal dispatch $x$ under the three models (pure robust, pure Distributionally Robust Optimization (DRO), and hybrid robust–DRO), and then reports the pair $(Q(x), R(x))$ for each model using the assumed true uniform wind distribution. All power quantities must be in $\\mathrm{MW}$, all costs must be in $\\mathrm{dollars}$, and all probabilities must be decimals.\n\nUse the following test suite of parameter values, each specified as $(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha)$:\n\n- Case $1$ (general comparison with ample capacity): $(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha) = (120, 20, 80, 50, 30, 300, 120, 0.6, 0.5)$.\n- Case $2$ (capacity-limited boundary behavior): $(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha) = (150, 0, 100, 40, 25, 500, 90, 0.8, 0.3)$.\n- Case $3$ (narrow robust interval; robustness emphasized): $(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha) = (100, 30, 90, 70, 35, 400, 120, 0.2, 0.7)$.\n\nYour program should, for each case, output the six values $[Q_{\\mathrm{robust}}, R_{\\mathrm{robust}}, Q_{\\mathrm{DRO}}, R_{\\mathrm{DRO}}, Q_{\\mathrm{hybrid}}, R_{\\mathrm{hybrid}}]$ in the specified units and decimal formats, concatenated across all three cases into a single list. The final output must be a single line containing a comma-separated list enclosed in square brackets, for example, `[result1,result2,...]`, ordered case by case and model by model, i.e., `[Qrob1,Rrob1,Qdro1,Rdro1,Qhyb1,Rhyb1,Qrob2,Rrob2,...]`.",
            "solution": "The problem requires us to determine the optimal dispatch decision $x$ for a conventional generator under three different uncertainty models for wind power $w$: pure robust optimization (RO), pure distributionally robust optimization (DRO), and a hybrid RO-DRO model. For each optimal decision, we must then evaluate its performance using two metrics, expected cost $Q(x)$ and reliability $R(x)$, under an assumed true uniform distribution for wind power. The problem is a variant of the classic newsvendor problem, framed within the context of energy systems.\n\nThe core of the problem is to minimize a cost function subject to the constraint $x \\in [0, X_{\\max}]$. For each model, the objective function is of the form $C(x) = c x + \\text{UncertaintyCost}(x)$, where $c$ is the constant marginal cost of generation. The uncertainty cost term is a function of the shortfall $s(w;x) = \\max\\{0, D - x - w\\}$. Since the shortfall is a convex function of $x$, and all optimization models use positive combinations of worst-case values or expectations of this function, the total cost function $C(x)$ is convex in $x$. The feasible set $[0, X_{\\max}]$ is a compact and convex interval. Therefore, for each model, a unique minimizer exists. We can find the unconstrained minimizer $x^*$ by finding where the subgradient of the objective function contains zero, i.e., $0 \\in \\partial C(x^*)$. The final optimal dispatch is then found by projecting $x^*$ onto the feasible interval: $x_{\\text{opt}} = \\max\\{0, \\min\\{x^*, X_{\\max}\\}\\}$.\n\nLet's analyze each model to find its optimal dispatch $x$.\n\n**1. Pure Robust Optimization (RO) Model**\n\nThe objective is to minimize the worst-case cost over the uncertainty set $U_{R} = [w_{\\min}^{R}, w_{\\max}^{R}]$:\n$$\n\\min_{x \\in [0, X_{\\max}]} C_{R}(x) = c x + p \\cdot \\sup_{w \\in U_{R}} s(w;x)\n$$\nThe shortfall function $s(w;x) = \\max\\{0, D - x - w\\}$ is non-increasing in $w$. The supremum (worst case) therefore occurs at the minimum value of $w$ in the set $U_R$, which is $w_{\\min}^{R} = \\mu - \\theta_{R} (\\mu - a)$.\nThe objective function simplifies to:\n$$\nC_{R}(x) = c x + p \\cdot \\max\\{0, D - x - w_{\\min}^{R}\\}\n$$\nThis is a convex, piecewise-linear function. To find the minimum, we analyze its subgradient with respect to $x$. Let $K_{R} = D - w_{\\min}^{R}$. The subgradient is:\n$$\n\\partial C_{R}(x) = \\begin{cases}\n    c  \\text{if } x > K_{R} \\\\\n    [c-p, c]  \\text{if } x = K_{R} \\\\\n    c-p  \\text{if } x  K_{R}\n\\end{cases}\n$$\nSince it is given that $p \\gg c$, we have $c-p  0$ and $c > 0$. The optimality condition $0 \\in \\partial C_{R}(x)$ is met at $x = K_{R}$. The unconstrained optimal dispatch is $x_{R}^* = K_{R} = D - w_{\\min}^{R}$.\nProjecting onto the feasible set, the optimal robust dispatch is:\n$$\nx_{R} = \\max\\{0, \\min\\{D - w_{\\min}^{R}, X_{\\max}\\}\\}\n$$\n\n**2. Pure Distributionally Robust Optimization (DRO) Model**\n\nThe objective is to minimize the worst-case expected cost over the ambiguity set $\\mathcal{P}$ of all probability distributions on $[a,b]$ with mean $\\mu$:\n$$\n\\min_{x \\in [0, X_{\\max}]} C_{DRO}(x) = c x + p \\cdot \\sup_{\\mathbb{P} \\in \\mathcal{P}} \\mathbb{E}_{\\mathbb{P}}[s(w;x)]\n$$\nThe function $s(w;x) = \\max\\{0, D - x - w\\}$ is a convex function of the random variable $w$. For a given mean and support, the expected value of a convex function is maximized by a distribution that places probability mass only at the extremal points of the support, which are $a$ and $b$. Let this worst-case distribution $\\mathbb{P}^*$ have mass $\\pi_a$ at $w=a$ and $\\pi_b$ at $w=b$. The conditions $\\pi_a + \\pi_b = 1$ and $\\pi_a a + \\pi_b b = \\mu$ yield the probabilities:\n$$\n\\pi_a = \\frac{b - \\mu}{b - a} \\quad \\text{and} \\quad \\pi_b = \\frac{\\mu - a}{b - a}\n$$\nThe worst-case expectation is then:\n$$\n\\sup_{\\mathbb{P}} \\mathbb{E}_{\\mathbb{P}}[s(w;x)] = \\pi_a s(a;x) + \\pi_b s(b;x) = \\frac{b - \\mu}{b - a}\\max\\{0, D-x-a\\} + \\frac{\\mu - a}{b - a}\\max\\{0, D-x-b\\}\n$$\nThe objective is $C_{DRO}(x) = c x + p(\\dots)$. This is again a convex, piecewise-linear function with kinks at $x=D-a$ and $x=D-b$. Let's analyze the subgradient. Let $\\gamma = c/p$. The subgradient is zero when the cost-to-penalty ratio $\\gamma$ balances the marginal change in expected shortfall. The optimal policy is to hedge against one of the two extreme scenarios:\n- If $\\gamma > \\frac{b-\\mu}{b-a}$, the marginal cost of generation is too high compared to the reduction in expected penalty, so it is optimal to hedge only against the best-case wind scenario, $w=b$. The unconstrained solution is $x_{DRO}^* = D-b$.\n- If $\\gamma \\le \\frac{b-\\mu}{b-a}$, it is optimal to hedge against the worst-case wind scenario, $w=a$. The unconstrained solution is $x_{DRO}^* = D-a$.\nThe optimal DRO dispatch is:\n$$\nx_{DRO} = \\max\\{0, \\min\\{x_{DRO}^*, X_{\\max}\\}\\} \\quad \\text{where} \\quad x_{DRO}^* = \\begin{cases} D-a  \\text{if } c/p \\le (b-\\mu)/(b-a) \\\\ D-b  \\text{if } c/p > (b-\\mu)/(b-a) \\end{cases}\n$$\n\n**3. Hybrid Robust-DRO Model**\n\nThe objective is a weighted combination of the RO and DRO objectives:\n$$\n\\min_{x \\in [0, X_{\\max}]} c x + p \\left( \\alpha \\cdot \\sup_{w \\in U_{R}} s(w;x) + (1 - \\alpha) \\cdot \\sup_{\\mathbb{P} \\in \\mathcal{P}} \\mathbb{E}_{\\mathbb{P}}[s(w;x)] \\right)\n$$\nSubstituting the expressions from the previous models, the objective function is a convex combination of three piecewise-linear functions, with kinks at $D-a$, $D-b$, and $D-w_{\\min}^R$. Since $a \\le w_{\\min}^R \\le \\mu \\le b$, we have $D-b \\le D-w_{\\min}^R \\le D-a$. Let $\\gamma = c/p$. The optimal unconstrained dispatch $x_H^*$ is determined by comparing $\\gamma$ to two thresholds derived from the slopes of the objective function:\n- Let $S_1 = (1-\\alpha) \\frac{b-\\mu}{b-a}$.\n- Let $S_2 = \\alpha + (1-\\alpha) \\frac{b-\\mu}{b-a} = \\alpha + S_1$.\nThe slope of the cost function changes at each kink. The unconstrained optimum $x_H^*$ is found by identifying the interval where the slope changes from negative to positive:\n- If $\\gamma > S_2$, the cost is always increasing. Minimum at smallest $x$. Hedges against $w=b$. $x_H^* = D-b$.\n- If $S_1  \\gamma \\le S_2$, the minimum occurs at the middle kink. Hedges against $w=w_{\\min}^R$. $x_H^* = D-w_{\\min}^R$.\n- If $\\gamma \\le S_1$, the cost is decreasing until the last kink. Hedges against $w=a$. $x_H^* = D-a$.\nThe final dispatch is $x_H = \\max\\{0, \\min\\{x_H^*, X_{\\max}\\}\\}$.\n\n**4. Performance Evaluation Metrics**\n\nFor any given dispatch $x$, we evaluate its performance assuming the true wind distribution is uniform on $[a,b]$, i.e., $w \\sim U(a,b)$ with probability density function $f(w) = 1/(b-a)$ for $w \\in [a,b]$.\n\n- **Reliability ($R(x)$)**: Probability of a shortfall.\n$$\nR(x) = \\mathbb{P}(w  D-x) = \\int_a^b \\mathbb{I}(w  D-x) \\frac{1}{b-a} dw\n$$\nLet $k = D-x$. The integral evaluates to the length of the interval $[a,b] \\cap (-\\infty, k)$, divided by $(b-a)$.\n$$\nR(x) = \\frac{\\max\\{0, \\min\\{k,b\\} - a\\}}{b-a} = \\frac{\\max\\{a, \\min\\{b, D-x\\}\\} - a}{b-a}\n$$\n- **Quality ($Q(x)$)**: Expected total cost.\n$$\nQ(x) = c x + p \\cdot \\mathbb{E}[s(w;x)] = c x + p \\cdot \\mathbb{E}[\\max\\{0, D-x-w\\}]\n$$\nThe expected shortfall is calculated by integration:\n$$\n\\mathbb{E}[s(w;x)] = \\int_a^b \\max\\{0, D-x-w\\} \\frac{1}{b-a} dw\n$$\nLet $k=D-x$. The integral yields:\n$$\n\\mathbb{E}[s(w;x)] = \\begin{cases} 0  \\text{if } k \\le a \\\\ \\frac{(k-a)^2}{2(b-a)}  \\text{if } a  k  b \\\\ k - \\frac{a+b}{2}  \\text{if } k \\ge b \\end{cases}\n$$\nThe final quality metric $Q(x)$ is calculated by substituting this expected shortfall into its definition. The computational procedure for each test case involves first calculating the optimal dispatches $x_R, x_{DRO}, x_H$ and then evaluating the pair $(Q(x), R(x))$ for each of them.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_metrics(x, D, a, b, c, p):\n    \"\"\"\n    Calculates the quality (Q) and reliability (R) metrics for a given dispatch x.\n    The true wind distribution is assumed to be uniform on [a, b].\n    \"\"\"\n    k = D - x\n\n    # Calculate Reliability R(x) = P(w  D-x)\n    # This is the CDF of U(a,b) evaluated at k = D-x.\n    if b - a > 0:\n        reliability = (np.clip(k, a, b) - a) / (b - a)\n    else: # Handles case a == b\n        reliability = 1.0 if k > a else 0.0\n\n    # Calculate expected shortfall E[s(w;x)]\n    if k = a:\n        expected_shortfall = 0.0\n    elif k >= b:\n        if b - a > 0:\n             expected_shortfall = k - (a + b) / 2.0\n        else: # Handles case a == b\n             expected_shortfall = k - a\n    else: # a  k  b\n        if b - a > 0:\n            expected_shortfall = (k - a)**2 / (2.0 * (b - a))\n        else: # This case should not be reached due to a  k  b\n            expected_shortfall = 0.0\n            \n    # Calculate Quality Q(x) = c*x + p*E[s(w;x)]\n    quality = c * x + p * expected_shortfall\n\n    return quality, reliability\n\ndef solve_models(D, a, b, mu, c, p, X_max, theta_R, alpha):\n    \"\"\"\n    Solves for the optimal dispatch x for the three models and evaluates their performance.\n    \"\"\"\n    results = []\n\n    # ======== Model 1: Pure Robust Optimization (RO) ========\n    w_min_R = mu - theta_R * (mu - a)\n    x_star_R = D - w_min_R\n    x_R = np.clip(x_star_R, 0, X_max)\n    q_r, r_r = calculate_metrics(x_R, D, a, b, c, p)\n    results.extend([q_r, r_r])\n\n    # ======== Model 2: Pure Distributionally Robust Optimization (DRO) ========\n    gamma = c / p\n    if b - a > 0:\n        dro_threshold = (b - mu) / (b - a)\n    else: # a == b, mean mu must be a.\n        dro_threshold = 0.0 # Effectively makes gamma > threshold unless c=0.\n\n    if gamma > dro_threshold:\n        x_star_DRO = D - b\n    else:\n        x_star_DRO = D - a\n    x_DRO = np.clip(x_star_DRO, 0, X_max)\n    q_dro, r_dro = calculate_metrics(x_DRO, D, a, b, c, p)\n    results.extend([q_dro, r_dro])\n\n    # ======== Model 3: Hybrid Robust-DRO ========\n    if b - a > 0:\n        s1 = (1 - alpha) * ((b - mu) / (b - a))\n    else:\n        s1 = 0.0\n    s2 = alpha + s1\n    \n    if gamma > s2:\n        x_star_H = D - b\n    elif gamma > s1:\n        x_star_H = D - w_min_R\n    else:\n        x_star_H = D - a\n        \n    x_H = np.clip(x_star_H, 0, X_max)\n    q_h, r_h = calculate_metrics(x_H, D, a, b, c, p)\n    results.extend([q_h, r_h])\n\n    return results\n\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final output.\n    \"\"\"\n    test_cases = [\n        # (D, a, b, mu, c, p, X_max, theta_R, alpha)\n        (120, 20, 80, 50, 30, 300, 120, 0.6, 0.5),\n        (150, 0, 100, 40, 25, 500, 90, 0.8, 0.3),\n        (100, 30, 90, 70, 35, 400, 120, 0.2, 0.7),\n    ]\n\n    final_results = []\n    for case in test_cases:\n        D, a, b, mu, c, p, X_max, theta_R, alpha = case\n        case_results = solve_models(D, a, b, mu, c, p, X_max, theta_R, alpha)\n        final_results.extend(case_results)\n    \n    # Format the final output as a comma-separated list of values in brackets.\n    # The problem implies floating point output, not scientific notation.\n    print(f\"[{','.join(f'{res:.10f}'.rstrip('0').rstrip('.') for res in final_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}