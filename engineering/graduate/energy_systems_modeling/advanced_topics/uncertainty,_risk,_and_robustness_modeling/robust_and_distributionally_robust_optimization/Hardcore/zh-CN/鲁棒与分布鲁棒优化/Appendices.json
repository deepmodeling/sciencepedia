{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导你完成鲁棒优化中的一个基本操作：为一个具有不确定系数的线性约束推导其鲁棒对等式。通过从第一性原理出发处理一个经典的“盒子”不确定性集合，你将掌握将一个包含无限可能实现的问题转化为一个易于求解的确定性问题的核心技术。这项技能是构建更复杂鲁棒模型的基石。",
            "id": "4119827",
            "problem": "一个聚合商计划为一组 $n$ 种技术进行容量采购，以在可用性不确定的情况下满足固定的容量需求。令 $x \\in \\mathbb{R}^{n}$ 表示采购决策向量，其中 $x_{i}$ 代表技术 $i$ 的采购铭牌容量。令 $a \\in \\mathbb{R}^{n}$ 表示不确定的可用性乘数向量，其中 $a_{i}$ 是在需要时可交付的已采购容量的实现比例。固定容量需求为 $b \\in \\mathbb{R}$，单位为兆瓦 (MW)。可靠性约束要求实现的固定容量满足 $a^{\\top} x \\ge b$。\n\n假设围绕名义可用性向量 $\\bar a \\in \\mathbb{R}^{n}$ 的是一个分量半径为 $\\Delta \\in \\mathbb{R}_{+}^{n}$ 的箱式不确定性集合，定义为\n$$\n\\mathcal{U} \\;=\\; \\left\\{ a \\in \\mathbb{R}^{n} \\;:\\; |a_{i} - \\bar a_{i}| \\le \\Delta_{i},\\;\\; i=1,\\dots,n \\right\\}。\n$$\n根据鲁棒优化的基本定义，一个鲁棒约束必须对所有实现 $a \\in \\mathcal{U}$ 均成立，这等价于要求 $a^{\\top} x$ 在 $\\mathcal{U}$ 上的最坏情况（最小）值至少为 $b$。\n\n从第一性原理出发，且不使用预先记好的公式，推导最坏情况值\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x\n$$\n的闭式解析表达式，该表达式应是 $\\bar a$, $\\Delta$ 和 $x$ 的函数。然后，写出 $a^{\\top} x \\ge b$ 的鲁棒对等式，仅用 $x$ 来表示。将你的最终答案表示为 $\\min_{a \\in \\mathcal{U}} a^{\\top} x$ 的闭式解析表达式。不需要进行数值近似或四舍五入。",
            "solution": "在尝试提供解答之前，将对问题进行验证。\n\n### 步骤 1：提取已知条件\n- 决策向量：$x \\in \\mathbb{R}^{n}$，其中 $x_{i}$ 是技术 $i$ 的采购铭牌容量。\n- 不确定参数向量：$a \\in \\mathbb{R}^{n}$，其中 $a_{i}$ 是实现的可用性乘数。\n- 固定容量需求：$b \\in \\mathbb{R}$。\n- 可靠性约束：$a^{\\top} x \\ge b$。\n- 名义可用性向量：$\\bar a \\in \\mathbb{R}^{n}$。\n- 不确定性半径向量：$\\Delta \\in \\mathbb{R}_{+}^{n}$。\n- 不确定性集合定义：$\\mathcal{U} \\;=\\; \\left\\{ a \\in \\mathbb{R}^{n} \\;:\\; |a_{i} - \\bar a_{i}| \\le \\Delta_{i},\\;\\; i=1,\\dots,n \\right\\}$。\n- 任务 1：推导 $\\min_{a \\in \\mathcal{U}} a^{\\top} x$ 的闭式解析表达式。\n- 任务 2：写出 $a^{\\top} x \\ge b$ 的鲁棒对等式。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题陈述进行评估。\n\n- **科学性**：该问题是鲁棒优化的一个标准应用，鲁棒优化是数学优化中一个成熟的分支领域。该公式对不确定性下的容量规划进行建模，这是能源系统工程中一个常见且重要的问题。所使用的概念是标准的，模型虽然经过简化，但科学上是合理的。\n- **适定性**：问题要求在一个非空、紧致且凸的集合 $\\mathcal{U}$（一个超矩形）上求线性函数 $f(a) = a^{\\top}x$ 的最小值。根据 Weierstrass 极值定理，紧集上的连续函数（在本例中为线性函数）必能达到其最小值和最大值。最小值是唯一的。因此，该问题是适定的。\n- **客观性**：问题使用精确、无歧义的数学语言以及优化和能源系统的标准术语进行陈述。\n- **完整性和一致性**：问题提供了推导所要求表达式的所有必要信息。向量和不确定性集合的定义清晰且自洽。没有内部矛盾。虽然“采购容量”的物理释义表明 $x_i \\ge 0$，但问题更一般地表述为 $x \\in \\mathbb{R}^n$，这在数学上是连贯的。将针对一般情况进行推导。\n- **其他缺陷**：该问题不违反任何其他标准，例如不切实际、结构不良、微不足道或包含伪科学。这是鲁棒优化中一个基础且具有指导意义的练习。\n\n### 步骤 3：结论与行动\n问题是 **有效的**。将提供一个完整的、有理有据的解答。\n\n### 解题推导\n目标是找到实现容量最坏情况值的闭式解析表达式，这可表示为以下最小化问题：\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x\n$$\n目标函数可以写成各分量的总和：\n$$\na^{\\top} x = \\sum_{i=1}^{n} a_{i} x_{i}\n$$\n不确定性集合 $\\mathcal{U}$ 对每个分量 $a_i$ 定义了独立的约束。具体来说，对于每个 $i \\in \\{1, \\dots, n\\}$，变量 $a_i$ 被约束在闭区间 $[\\bar{a}_{i} - \\Delta_{i}, \\bar{a}_{i} + \\Delta_{i}]$ 内。\n\n由于目标函数是各项之和，其中每一项 $a_i x_i$ 只涉及一个变量 $a_i$，并且对每个 $a_i$ 的约束独立于其他变量 $a_j$（其中 $j \\neq i$），因此该最小化问题是可分的。这使我们可以交换求和与最小化运算符：\n$$\n\\min_{a \\in \\mathcal{U}} \\left( \\sum_{i=1}^{n} a_{i} x_{i} \\right) = \\sum_{i=1}^{n} \\left( \\min_{\\bar{a}_{i} - \\Delta_{i} \\le a_{i} \\le \\bar{a}_{i} + \\Delta_{i}} a_{i} x_{i} \\right)\n$$\n我们现在分析每个分量 $i$ 的内部最小化问题：\n$$\n\\min_{\\bar{a}_{i} - \\Delta_{i} \\le a_{i} \\le \\bar{a}_{i} + \\Delta_{i}} a_{i} x_{i}\n$$\n待最小化的函数 $f(a_i) = a_i x_i$ 是变量 $a_i$ 的线性函数。线性函数在闭区间上的最小值必然出现在区间的某个端点上。$a_i$ 的两个端点是 $\\bar{a}_{i} - \\Delta_{i}$ 和 $\\bar{a}_{i} + \\Delta_{i}$。选择哪个端点使 $a_i x_i$ 最小化取决于固定系数 $x_i$ 的符号。\n\n1.  如果 $x_{i} > 0$：为了最小化乘积 $a_i x_i$，我们必须为 $a_i$ 选择可能的最小值。这个值是区间的下界，即 $a_{i}^{*} = \\bar{a}_{i} - \\Delta_{i}$。该项的最小值为 $(\\bar{a}_{i} - \\Delta_{i}) x_{i}$。\n\n2.  如果 $x_{i}  0$：为了最小化乘积 $a_i x_i$，我们必须为 $a_i$ 选择可能的最大值，因为乘以一个负数 $x_i$ 会反转不等号。这个值是区间的上界，即 $a_{i}^{*} = \\bar{a}_{i} + \\Delta_{i}$。该项的最小值为 $(\\bar{a}_{i} + \\Delta_{i}) x_{i}$。\n\n3.  如果 $x_{i} = 0$：无论 $a_i$ 的值是多少，乘积 $a_i x_i$ 总是 $0$。最小值为 $0$。\n\n这三种情况可以统一为一个表达式。我们可以将项 $a_i x_i$ 的最小值表示如下：\n- 对于 $x_i > 0$：$\\bar{a}_{i}x_{i} - \\Delta_{i}x_{i} = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|$\n- 对于 $x_i  0$：$\\bar{a}_{i}x_{i} + \\Delta_{i}x_{i} = \\bar{a}_{i}x_{i} - \\Delta_{i}(-x_{i}) = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|$\n- 对于 $x_i = 0$：$0 = \\bar{a}_{i}(0) - \\Delta_{i}|0| = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|$\n\n因此，对于任意 $x_i \\in \\mathbb{R}$，在其可行区间内 $a_i x_i$ 的最小值为：\n$$\n\\min_{a_{i}} a_{i} x_{i} = \\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|\n$$\n达到此最小值的 $a_i$ 是 $a_i^* = \\bar{a}_i - \\Delta_i \\cdot \\text{sgn}(x_i)$，其中 $\\text{sgn}(\\cdot)$ 是符号函数。\n\n将这些单独的最小值对所有从 $1$ 到 $n$ 的 $i$ 求和，得到 $a^{\\top}x$ 的总最小值：\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x = \\sum_{i=1}^{n} (\\bar{a}_{i}x_{i} - \\Delta_{i}|x_{i}|)\n$$\n这个表达式可以分为两部分：\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x = \\sum_{i=1}^{n} \\bar{a}_{i}x_{i} - \\sum_{i=1}^{n} \\Delta_{i}|x_{i}|\n$$\n第一项是名义可用性向量 $\\bar a$ 和决策向量 $x$ 的点积。最终表达式为：\n$$\n\\min_{a \\in \\mathcal{U}} a^{\\top} x = \\bar{a}^{\\top}x - \\sum_{i=1}^{n} \\Delta_{i}|x_{i}|\n$$\n这就是所要求的闭式解析表达式。\n\n原始约束 $a^{\\top} x \\ge b$ 的鲁棒对等式要求该约束对不确定性集合 $\\mathcal{U}$ 中所有可能的 $a$ 的实现都成立。这等价于确保左侧的可能最小值大于或等于右侧：\n$$\n\\min_{a \\in \\mathcal{U}} (a^{\\top} x) \\ge b\n$$\n代入推导出的最小值表达式，我们得到鲁棒对等式，它是一个只关于 $x$ 的不等式约束：\n$$\n\\bar{a}^{\\top}x - \\sum_{i=1}^{n} \\Delta_{i}|x_{i}| \\ge b\n$$\n这是一个凸约束，因为 $\\bar{a}^{\\top}x$ 是线性的，而 $\\sum_{i=1}^{n} \\Delta_{i}|x_{i}|$ 是一个凸函数（一个加权的 L1-范数）。\n所要求的最终答案是最小值本身的闭式表达式。",
            "answer": "$$\n\\boxed{\\bar{a}^{\\top}x - \\sum_{i=1}^{n} \\Delta_{i} |x_{i}|}\n$$"
        },
        {
            "introduction": "切换到分布鲁棒优化（DRO），这个练习挑战你识别和构建“最坏情况”的概率分布。给定一个随机变量的已知矩（例如均值和方差），你需要找出在所有可能的分布中，使违规概率最大化的那个分布。这个过程揭示了DRO如何通过对抗性的视角来量化和防范模型风险，其结果直接关联到著名的Cantelli不等式。",
            "id": "4119953",
            "problem": "考虑一个电力网络中的单条输电线路，该线路在直流（DC）潮流近似下建模。设不确定的实时线路潮流由随机变量 $F$ 表示，其真实概率分布未知，但已知其满足从预测和历史数据中获得的以下矩信息：其均值为 $\\mu_{F}$，方差为 $\\sigma_{F}^{2}$。一项规划决策施加了机会约束，要求线路潮流以高概率不超过热极限 $\\bar{F}$。具体来说，在分布鲁棒优化（DRO）的意义上，该决策对于任何与此矩信息一致的 $F$ 的分布都必须是可行的。\n\n形式上，将模糊集定义为 $\\mathbb{R}$ 上所有均值为 $\\mu_{F}$、方差为 $\\sigma_{F}^{2}$ 的概率分布族。分布鲁棒机会约束要求对于此模糊集中的所有分布，$\\mathbb{P}(F \\leq \\bar{F}) \\geq 1 - \\varepsilon$ 成立。假设 $\\bar{F}  \\mu_{F}$，因此极限值高于平均线路潮流。构建（在模糊集内）使违规概率 $\\mathbb{P}(F  \\bar{F})$ 最大化的最坏情况分布，并解释其概率质量相对于违规边界 $F = \\bar{F}$ 是如何排列以最大化风险的。然后，计算相应的最坏情况违规概率，以 $\\mu_{F}$、$\\sigma_{F}$ 和 $\\bar{F}$ 的闭式表达式表示。\n\n将您的最终答案表示为单个闭式解析表达式。无需四舍五入，最终表达式中不应包含任何物理单位。",
            "solution": "该问题是有效的。它在概率论和分布鲁棒优化领域有科学依据，问题提法得当且客观。所有必要信息均已提供。\n\n该问题要求计算电力输电线路潮流 $F$ 的机会约束的最坏情况违规概率。约束条件是潮流 $F$ 不得超过热极限 $\\bar{F}$。因此，违规事件为 $F  \\bar{F}$。我们已知不确定潮流 $F$ 是一个随机变量，其分布未知，但其均值 $\\mathbb{E}[F] = \\mu_{F}$ 和方差 $\\mathbb{V}[F] = \\sigma_{F}^{2}$ 是已知的。该问题是在分布鲁棒优化（DRO）框架下提出的，这意味着我们必须在所有与给定矩信息一致的 $F$ 的可能分布中，找到最大的可能违规概率。\n\n设 $\\mathcal{P}$ 为模糊集，即 $\\mathbb{R}$ 上所有均值为 $\\mu_{F}$、方差为 $\\sigma_{F}^{2}$ 的概率分布族。任务是解决以下优化问题：\n$$ \\sup_{P \\in \\mathcal{P}} \\mathbb{P}(F  \\bar{F}) $$\n这是矩理论中的一个经典问题。已知此类问题（在矩约束下最大化或最小化事件概率）的极值分布是具有有限数量支撑点的离散分布。\n\n为了最大化区域 $( \\bar{F}, \\infty)$ 中的概率质量，最坏情况分布应避免通过分散质量来“浪费”概率质量。直观上，它应该将质量集中在特定的点上。我们假设最坏情况分布是一个具有两个支撑点 $x_1$ 和 $x_2$ 的离散分布。设相应的概率为 $p_1$ 和 $p_2$。为了使违规概率非零，至少有一个点必须在违规区域内。设 $x_2  \\bar{F}$ 和 $x_1 \\le \\bar{F}$。违规概率为 $p_2 = \\mathbb{P}(F  \\bar{F})$。\n\n该分布必须满足由矩信息和全概率定律给出的三个约束条件：\n1.  $p_1 + p_2 = 1$\n2.  $p_1 x_1 + p_2 x_2 = \\mu_F$\n3.  $p_1 (x_1 - \\mu_F)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n\n根据约束(1)，$p_1 = 1 - p_2$。将其代入约束(2)：\n$(1 - p_2) x_1 + p_2 x_2 = \\mu_F$\n$x_1 - p_2 x_1 + p_2 x_2 = \\mu_F$\n$x_1 = \\mu_F - p_2(x_2 - x_1)$\n这个表达式不是很有用。让我们用 $x_1$ 和 $x_2$ 与均值的偏差来表示它们。根据约束(2)：\n$p_1(x_1 - \\mu_F) + p_2(x_2 - \\mu_F) = 0 \\implies (1-p_2)(x_1 - \\mu_F) = -p_2(x_2 - \\mu_F)$。\n所以，$x_1 - \\mu_F = -\\frac{p_2}{1-p_2}(x_2 - \\mu_F)$。\n\n现在，将此代入方差约束(3)：\n$(1-p_2) \\left( -\\frac{p_2}{1-p_2}(x_2 - \\mu_F) \\right)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n$(1-p_2) \\frac{p_2^2}{(1-p_2)^2} (x_2 - \\mu_F)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n$\\frac{p_2^2}{1-p_2} (x_2 - \\mu_F)^2 + p_2 (x_2 - \\mu_F)^2 = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\left( \\frac{p_2^2}{1-p_2} + p_2 \\right) = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\left( \\frac{p_2^2 + p_2(1-p_2)}{1-p_2} \\right) = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\left( \\frac{p_2^2 + p_2 - p_2^2}{1-p_2} \\right) = \\sigma_F^2$\n$(x_2 - \\mu_F)^2 \\frac{p_2}{1-p_2} = \\sigma_F^2$\n\n现在我们可以求解我们希望最大化的违规概率 $p_2$：\n$p_2(x_2 - \\mu_F)^2 = (1-p_2)\\sigma_F^2 = \\sigma_F^2 - p_2 \\sigma_F^2$\n$p_2 \\left( (x_2 - \\mu_F)^2 + \\sigma_F^2 \\right) = \\sigma_F^2$\n$$ p_2 = \\frac{\\sigma_F^2}{\\sigma_F^2 + (x_2 - \\mu_F)^2} $$\n为了最大化 $p_2$，我们必须最小化分母。这意味着我们必须在 $x_2$ 代表违规结果（即 $x_2 > \\bar{F}$）的约束下，最小化 $(x_2 - \\mu_F)^2$ 这一项。\n已知 $\\bar{F} > \\mu_F$。函数 $g(x_2) = (x_2 - \\mu_F)^2$ 在 $x_2 > \\mu_F$ 时是增函数。由于我们的 $x_2$ 定义域是 $(\\bar{F}, \\infty)$，它是 $(\\mu_F, \\infty)$ 的一个子集，我们必须选择尽可能小的 $x_2$。在集合 $(\\bar{F}, \\infty)$ 上，$x_2$ 的下确界是 $\\bar{F}$。\n因此，当 $x_2$ 从上方趋近于 $\\bar{F}$ 时，概率 $p_2$ 达到其上确界：\n$$ \\sup_{x_2 > \\bar{F}} p_2 = \\lim_{x_2 \\to \\bar{F}^+} \\frac{\\sigma_F^2}{\\sigma_F^2 + (x_2 - \\mu_F)^2} = \\frac{\\sigma_F^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} $$\n这个表达式代表了最坏情况的违规概率。这个结果是单边切比雪夫不等式的一种形式，也称为 Cantelli 不等式。\n\n问题还要求构建最坏情况分布并解释其结构。严格来说，对于严格不等式 $\\mathbb{P}(F > \\bar{F})$，这个上确界无法由某个分布达到。然而，对于非严格不等式 $\\mathbb{P}(F \\ge \\bar{F})$，该值是其最大值，并且这个最大值是可以达到的。在工程和优化实践中，这种区别常常被忽略，而将达到非严格不等式最大值的分布称为“最坏情况分布”。\n\n这种最坏情况分布将所有概率质量集中在两个点上。一个点正好位于违规边界 $x_2 = \\bar{F}$。另一个点 $x_1$ 的位置则要满足均值和方差约束。\n在 $x_2 = \\bar{F}$ 处的概率质量就是最坏情况概率本身：\n$$ p_2 = \\mathbb{P}(F = \\bar{F}) = \\frac{\\sigma_F^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} $$\n在 $x_1$ 处的概率质量是：\n$$ p_1 = 1 - p_2 = 1 - \\frac{\\sigma_F^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} = \\frac{(\\bar{F} - \\mu_F)^2}{\\sigma_F^2 + (\\bar{F} - \\mu_F)^2} $$\n点 $x_1$ 的位置由关系式 $x_1 - \\mu_F = -\\frac{p_2}{1-p_2}(x_2 - \\mu_F)$ 得出：\n$$ \\frac{p_2}{1-p_2} = \\frac{\\sigma_F^2 / (\\dots)}{(\\bar{F} - \\mu_F)^2 / (\\dots)} = \\frac{\\sigma_F^2}{(\\bar{F} - \\mu_F)^2} $$\n因此，当 $x_2 = \\bar{F}$ 时：\n$$ x_1 = \\mu_F - \\frac{\\sigma_F^2}{(\\bar{F} - \\mu_F)^2}(\\bar{F} - \\mu_F) = \\mu_F - \\frac{\\sigma_F^2}{\\bar{F} - \\mu_F} $$\n对这种分布的解释是，自然界或不确定性扮演着一个对手的角色。为了最大化违反极限 $\\bar{F}$ 的概率，它创造了一个二元世界。以概率 $p_2$，“坏”结果发生，此时线路潮流正好落在最关键的点，即边界 $\\bar{F}$ 上。以概率 $p_1$，“好”结果发生，但为了满足矩约束，这个结果 $x_1$ 必须位于均值左侧很远的位置。这种结构代表了在仅给定均值和方差信息的情况下，不确定性可能造成的最具破坏性的实现方式，它避开了像高斯分布这样行为良好的分布，而选择了极端的、两极分化的结果。\n\n最终答案是最坏情况违规概率的闭式表达式。",
            "answer": "$$\\boxed{\\frac{\\sigma_{F}^{2}}{\\sigma_{F}^{2} + (\\bar{F} - \\mu_{F})^{2}}}$$"
        },
        {
            "introduction": "这个综合性练习将理论付诸实践，要求你通过编程来比较纯鲁棒优化（RO）、纯分布鲁棒优化（DRO）以及混合模型在电力系统调度问题中的表现。你需要为每个模型推导最优决策策略，并实施一个评估框架来量化它们在“真实”不确定性下的成本和可靠性。通过这个练习，你将对不同不确定性建模方法之间的权衡获得深刻的直观理解。",
            "id": "4119893",
            "problem": "考虑一个含风电的电力系统的单周期调度问题。常规发电机在风力发电 $w$（单位 $\\mathrm{MW}$）实现之前，安排一个调度决策 $x$（单位 $\\mathrm{MW}$）。需求为 $D$（单位 $\\mathrm{MW}$）。计划的常规发电会产生线性成本 $c$（单位 $\\mathrm{美元}/\\mathrm{MW}$），任何未满足的需求会产生切负荷惩罚 $p$（单位 $\\mathrm{美元}/\\mathrm{MW}$），其中 $p \\gg c$。常规发电机的容量上限为 $X_{\\max}$（单位 $\\mathrm{MW}$），且 $x \\in [0, X_{\\max}]$。\n\n风电 $w$ 的不确定性具有已知的支撑集 $[a,b]$（单位 $\\mathrm{MW}$）和名义均值 $\\mu$（单位 $\\mathrm{MW}$），其中 $a \\le \\mu \\le b$。定义短缺函数 $s(w;x) = \\max\\{0, D - x - w\\}$（单位 $\\mathrm{MW}$）。目标是根据以下三种模型之一选择 $x$ 来对冲风电的不确定性：\n\n- 纯鲁棒优化：假设风电位于鲁棒不确定性区间 $U_{R} = [w_{\\min}^{R}, w_{\\max}^{R}]$ 内，其中 $w_{\\min}^{R} = \\mu - \\theta_{R} (\\mu - a)$ 且 $w_{\\max}^{R} = \\mu + \\theta_{R} (b - \\mu)$，对于给定的鲁棒性水平 $\\theta_{R} \\in [0,1]$。鲁棒决策最小化 $U_{R}$ 上的最坏情况成本，即，最小化 $c x + p \\cdot \\sup_{w \\in U_{R}} s(w;x)$，约束条件为 $x \\in [0, X_{\\max}]$。\n\n- 纯分布鲁棒优化 (DRO)：考虑支撑集为 $[a,b]$ 且均值为 $\\mu$ 的所有概率分布组成的模糊集。分布鲁棒决策最小化此模糊集中所有 $\\mathbb{P}$ 上的最坏情况期望成本 $\\sup_{\\mathbb{P}} \\mathbb{E}_{\\mathbb{P}}[c x + p \\cdot s(w;x)]$，约束条件为 $x \\in [0, X_{\\max}]$。\n\n- 混合鲁棒-DRO：结合鲁棒和分布鲁棒的观点，通过最小化 $c x + \\alpha \\, p \\cdot \\sup_{w \\in U_{R}} s(w;x) + (1 - \\alpha) \\, \\sup_{\\mathbb{P}} \\mathbb{E}_{\\mathbb{P}}[p \\cdot s(w;x)]$，对于混合参数 $\\alpha \\in [0,1]$，约束条件为 $x \\in [0, X_{\\max}]$。\n\n为了比较解决方案的质量和可靠性，假设真实的​风电分布是在 $[a,b]$ 上的均匀分布。对于任何选定的 $x$，定义：\n\n- 真实分布下的期望总成本（质量）：$Q(x) = c x + p \\cdot \\mathbb{E}[s(w;x)]$（单位 $\\mathrm{美元}$），其中期望是关于 $[a,b]$ 上的均匀分布计算的。\n\n- 可靠性指标，即真实分布下发生短缺的概率：$R(x) = \\mathbb{P}(w  D - x)$，表示为 $[0,1]$ 内的一个小数。\n\n您的任务是实现一个程序，对于以下每个测试用例，计算三种模型（纯鲁棒、纯分布鲁棒优化 (DRO) 和混合鲁棒-DRO）下的最优调度 $x$，然后使用假设的真实均匀风电分布报告每个模型的配对 $(Q(x), R(x))$。所有功率量必须以 $\\mathrm{MW}$ 为单位，所有成本必须以 $\\mathrm{美元}$ 为单位，所有概率必须是小数。\n\n使用以下参数值测试套件，每个都指定为 $(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha)$：\n\n- 案例 $1$（容量充足下的一般比较）：$(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha) = (120, 20, 80, 50, 30, 300, 120, 0.6, 0.5)$。\n- 案例 $2$（容量受限的边界行为）：$(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha) = (150, 0, 100, 40, 25, 500, 90, 0.8, 0.3)$。\n- 案例 $3$（鲁棒区间较窄；强调鲁棒性）：$(D, a, b, \\mu, c, p, X_{\\max}, \\theta_{R}, \\alpha) = (100, 30, 90, 70, 35, 400, 120, 0.2, 0.7)$。\n\n您的程序应针对每个案例，输出六个值 $[Q_{\\mathrm{robust}}, R_{\\mathrm{robust}}, Q_{\\mathrm{DRO}}, R_{\\mathrm{DRO}}, Q_{\\mathrm{hybrid}}, R_{\\mathrm{hybrid}}]$，使用指定的单位和小数格式，并将所有三个案例的结果连接成一个单一列表。最终输出必须是单行，包含一个用方括号括起来的逗号分隔列表，例如 `[result1,result2,...]`，按案例和模型排序，即 `[Qrob1,Rrob1,Qdro1,Rdro1,Qhyb1,Rhyb1,Qrob2,Rrob2,...]`。",
            "solution": "该问题要求我们确定在三种不同的风电 $w$ 不确定性模型下，常规发电机的最优调度决策 $x$：纯鲁棒优化 (RO)、纯分布鲁棒优化 (DRO) 和混合 RO-DRO 模型。对于每个最优决策，我们必须在假设真实风电分布为均匀分布的情况下，使用两个指标——期望成本 $Q(x)$ 和可靠性 $R(x)$——来评估其性能。该问题是经典报童问题的一个变体，置于能源系统的背景下。\n\n问题的核心是在约束条件 $x \\in [0, X_{\\max}]$ 下最小化成本函数。对于每个模型，目标函数的形式为 $C(x) = c x + \\text{UncertaintyCost}(x)$，其中 $c$ 是发电的恒定边际成本。不确定性成本项是短缺函数 $s(w;x) = \\max\\{0, D - x - w\\}$ 的函数。由于短缺是 $x$ 的凸函数，且所有优化模型都使用该函数的最坏情况值或期望值的正组合，因此总成本函数 $C(x)$ 是 $x$ 的凸函数。可行集 $[0, X_{\\max}]$ 是一个紧凑的凸区间。因此，对于每个模型，都存在唯一的最小化器。我们可以通过找到目标函数的次梯度包含零的位置来找到无约束最小化器 $x^*$，即 $0 \\in \\partial C(x^*)$。然后通过将 $x^*$ 投影到可行区间上来找到最终的最优调度：$x_{\\text{opt}} = \\max\\{0, \\min\\{x^*, X_{\\max}\\}\\}$。\n\n让我们分析每个模型以找到其最优调度 $x$。\n\n**1. 纯鲁棒优化 (RO) 模型**\n\n目标是最小化不确定性集 $U_{R} = [w_{\\min}^{R}, w_{\\max}^{R}]$ 上的最坏情况成本：\n$$\n\\min_{x \\in [0, X_{\\max}]} C_{R}(x) = c x + p \\cdot \\sup_{w \\in U_{R}} s(w;x)\n$$\n短缺函数 $s(w;x) = \\max\\{0, D - x - w\\}$ 是关于 $w$ 的非增函数。因此，上确界（最坏情况）发生在集合 $U_R$ 中 $w$ 的最小值处，即 $w_{\\min}^{R} = \\mu - \\theta_{R} (\\mu - a)$。\n目标函数简化为：\n$$\nC_{R}(x) = c x + p \\cdot \\max\\{0, D - x - w_{\\min}^{R}\\}\n$$\n这是一个凸的分段线性函数。为了找到最小值，我们分析其关于 $x$ 的次梯度。令 $K_{R} = D - w_{\\min}^{R}$。次梯度为：\n$$\n\\partial C_{R}(x) = \\begin{cases}\n    c  \\text{if } x  K_{R} \\\\\n    [c-p, c]  \\text{if } x = K_{R} \\\\\n    c-p  \\text{if } x  K_{R}\n\\end{cases}\n$$\n由于给定 $p \\gg c$，我们有 $c-p  0$ 且 $c  0$。最优性条件 $0 \\in \\partial C_{R}(x)$ 在 $x = K_{R}$ 处满足。无约束最优调度为 $x_{R}^* = K_{R} = D - w_{\\min}^{R}$。\n投影到可行集上，最优鲁棒调度为：\n$$\nx_{R} = \\max\\{0, \\min\\{D - w_{\\min}^{R}, X_{\\max}\\}\\}\n$$\n\n**2. 纯分布鲁棒优化 (DRO) 模型**\n\n目标是最小化在均值为 $\\mu$、支撑集为 $[a,b]$ 的所有概率分布组成的模糊集 $\\mathcal{P}$ 上的最坏情况期望成本：\n$$\n\\min_{x \\in [0, X_{\\max}]} C_{DRO}(x) = c x + p \\cdot \\sup_{\\mathbb{P} \\in \\mathcal{P}} \\mathbb{E}_{\\mathbb{P}}[s(w;x)]\n$$\n函数 $s(w;x) = \\max\\{0, D - x - w\\}$ 是随机变量 $w$ 的一个凸函数。对于给定的均值和支撑集，凸函数的期望值由一个仅在支撑集极值点（即 $a$ 和 $b$）上放置概率质量的分布来最大化。设这个最坏情况分布 $\\mathbb{P}^*$ 在 $w=a$ 处的质量为 $\\pi_a$，在 $w=b$ 处的质量为 $\\pi_b$。条件 $\\pi_a + \\pi_b = 1$ 和 $\\pi_a a + \\pi_b b = \\mu$ 产生以下概率：\n$$\n\\pi_a = \\frac{b - \\mu}{b - a} \\quad \\text{and} \\quad \\pi_b = \\frac{\\mu - a}{b - a}\n$$\n那么最坏情况的期望值为：\n$$\n\\sup_{\\mathbb{P}} \\mathbb{E}_{\\mathbb{P}}[s(w;x)] = \\pi_a s(a;x) + \\pi_b s(b;x) = \\frac{b - \\mu}{b - a}\\max\\{0, D-x-a\\} + \\frac{\\mu - a}{b - a}\\max\\{0, D-x-b\\}\n$$\n目标是 $C_{DRO}(x) = c x + p(\\dots)$。这又是一个凸的分段线性函数，在 $x=D-a$ 和 $x=D-b$ 处有扭结（kinks）。我们来分析其次梯度。令 $\\gamma = c/p$。当成本与惩罚之比 $\\gamma$ 平衡了期望短缺的边际变化时，次梯度为零。最优策略是针对两种极端情景之一进行对冲：\n- 如果 $\\gamma  \\frac{b-\\mu}{b-a}$，发电的边际成本相对于期望惩罚的减少量来说过高，因此仅针对最佳风况情景 $w=b$ 进行对冲是最优的。无约束解为 $x_{DRO}^* = D-b$。\n- 如果 $\\gamma \\le \\frac{b-\\mu}{b-a}$，针对最差风况情景 $w=a$ 进行对冲是最优的。无约束解为 $x_{DRO}^* = D-a$。\n最优 DRO 调度为：\n$$\nx_{DRO} = \\max\\{0, \\min\\{x_{DRO}^*, X_{\\max}\\}\\} \\quad \\text{where} \\quad x_{DRO}^* = \\begin{cases} D-a  \\text{if } c/p \\le (b-\\mu)/(b-a) \\\\ D-b  \\text{if } c/p  (b-\\mu)/(b-a) \\end{cases}\n$$\n\n**3. 混合鲁棒-DRO 模型**\n\n目标是 RO 和 DRO 目标的加权组合：\n$$\n\\min_{x \\in [0, X_{\\max}]} c x + p \\left( \\alpha \\cdot \\sup_{w \\in U_{R}} s(w;x) + (1 - \\alpha) \\cdot \\sup_{\\mathbb{P} \\in \\mathcal{P}} \\mathbb{E}_{\\mathbb{P}}[s(w;x)] \\right)\n$$\n代入前面模型的表达式，目标函数是三个分段线性函数的凸组合，在 $D-a$、$D-b$ 和 $D-w_{\\min}^R$ 处有扭结。由于 $a \\le w_{\\min}^R \\le \\mu \\le b$，我们有 $D-b \\le D-w_{\\min}^R \\le D-a$。令 $\\gamma = c/p$。最优无约束调度 $x_H^*$ 是通过将 $\\gamma$ 与从目标函数斜率派生出的两个阈值进行比较来确定的：\n- 令 $S_1 = (1-\\alpha) \\frac{b-\\mu}{b-a}$。\n- 令 $S_2 = \\alpha + (1-\\alpha) \\frac{b-\\mu}{b-a} = \\alpha + S_1$。\n成本函数的斜率在每个扭结处发生变化。无约束最优解 $x_H^*$ 是通过识别斜率从负变正的区间来找到的：\n- 如果 $\\gamma  S_2$，成本总是增加的。最小值在最小的 $x$ 处。针对 $w=b$ 进行对冲。$x_H^* = D-b$。\n- 如果 $S_1  \\gamma \\le S_2$，最小值出现在中间的扭结处。针对 $w=w_{\\min}^R$ 进行对冲。$x_H^* = D-w_{\\min}^R$。\n- 如果 $\\gamma \\le S_1$，成本在最后一个扭结前是递减的。针对 $w=a$ 进行对冲。$x_H^* = D-a$。\n最终调度为 $x_H = \\max\\{0, \\min\\{x_H^*, X_{\\max}\\}\\}$。\n\n**4. 性能评估指标**\n\n对于任何给定的调度 $x$，我们假设真实风电分布在 $[a,b]$ 上是均匀的，即 $w \\sim U(a,b)$，其概率密度函数为 $f(w) = 1/(b-a)$，适用于 $w \\in [a,b]$，来评估其性能。\n\n- **可靠性 ($R(x)$)**：发生短缺的概率。\n$$\nR(x) = \\mathbb{P}(w  D-x) = \\int_a^b \\mathbb{I}(w  D-x) \\frac{1}{b-a} dw\n$$\n令 $k = D-x$。该积分的计算结果为区间 $[a,b] \\cap (-\\infty, k)$ 的长度除以 $(b-a)$。\n$$\nR(x) = \\frac{\\max\\{0, \\min\\{k,b\\} - a\\}}{b-a} = \\frac{\\max\\{a, \\min\\{b, D-x\\}\\} - a}{b-a}\n$$\n- **质量 ($Q(x)$)**：期望总成本。\n$$\nQ(x) = c x + p \\cdot \\mathbb{E}[s(w;x)] = c x + p \\cdot \\mathbb{E}[\\max\\{0, D-x-w\\}]\n$$\n期望短缺通过积分计算：\n$$\n\\mathbb{E}[s(w;x)] = \\int_a^b \\max\\{0, D-x-w\\} \\frac{1}{b-a} dw\n$$\n令 $k=D-x$。该积分得出：\n$$\n\\mathbb{E}[s(w;x)] = \\begin{cases} 0  \\text{if } k \\le a \\\\ \\frac{(k-a)^2}{2(b-a)}  \\text{if } a  k  b \\\\ k - \\frac{a+b}{2}  \\text{if } k \\ge b \\end{cases}\n$$\n最终的质量指标 $Q(x)$ 是通过将此期望短缺代入其定义中计算得出的。每个测试用例的计算过程包括首先计算最优调度 $x_R, x_{DRO}, x_H$，然后对每个调度评估配对 $(Q(x), R(x))$。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_metrics(x, D, a, b, c, p):\n    \"\"\"\n    Calculates the quality (Q) and reliability (R) metrics for a given dispatch x.\n    The true wind distribution is assumed to be uniform on [a, b].\n    \"\"\"\n    k = D - x\n\n    # Calculate Reliability R(x) = P(w  D-x)\n    # This is the CDF of U(a,b) evaluated at k = D-x.\n    if b - a > 0:\n        reliability = (np.clip(k, a, b) - a) / (b - a)\n    else: # Handles case a == b\n        reliability = 1.0 if k > a else 0.0\n\n    # Calculate expected shortfall E[s(w;x)]\n    if k = a:\n        expected_shortfall = 0.0\n    elif k >= b:\n        if b - a > 0:\n             expected_shortfall = k - (a + b) / 2.0\n        else: # Handles case a == b\n             expected_shortfall = k - a\n    else: # a  k  b\n        if b - a > 0:\n            expected_shortfall = (k - a)**2 / (2.0 * (b - a))\n        else: # This case should not be reached due to a  k  b\n            expected_shortfall = 0.0\n            \n    # Calculate Quality Q(x) = c*x + p*E[s(w;x)]\n    quality = c * x + p * expected_shortfall\n\n    return quality, reliability\n\ndef solve_models(D, a, b, mu, c, p, X_max, theta_R, alpha):\n    \"\"\"\n    Solves for the optimal dispatch x for the three models and evaluates their performance.\n    \"\"\"\n    results = []\n\n    # ======== Model 1: Pure Robust Optimization (RO) ========\n    w_min_R = mu - theta_R * (mu - a)\n    x_star_R = D - w_min_R\n    x_R = np.clip(x_star_R, 0, X_max)\n    q_r, r_r = calculate_metrics(x_R, D, a, b, c, p)\n    results.extend([q_r, r_r])\n\n    # ======== Model 2: Pure Distributionally Robust Optimization (DRO) ========\n    gamma = c / p\n    if b - a > 0:\n        dro_threshold = (b - mu) / (b - a)\n    else: # a == b, mean mu must be a.\n        dro_threshold = 0.0 # Effectively makes gamma > threshold unless c=0.\n\n    if gamma > dro_threshold:\n        x_star_DRO = D - b\n    else:\n        x_star_DRO = D - a\n    x_DRO = np.clip(x_star_DRO, 0, X_max)\n    q_dro, r_dro = calculate_metrics(x_DRO, D, a, b, c, p)\n    results.extend([q_dro, r_dro])\n\n    # ======== Model 3: Hybrid Robust-DRO ========\n    if b - a > 0:\n        s1 = (1 - alpha) * ((b - mu) / (b - a))\n    else:\n        s1 = 0.0\n    s2 = alpha + s1\n    \n    if gamma > s2:\n        x_star_H = D - b\n    elif gamma > s1:\n        x_star_H = D - w_min_R\n    else:\n        x_star_H = D - a\n        \n    x_H = np.clip(x_star_H, 0, X_max)\n    q_h, r_h = calculate_metrics(x_H, D, a, b, c, p)\n    results.extend([q_h, r_h])\n\n    return results\n\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final output.\n    \"\"\"\n    test_cases = [\n        # (D, a, b, mu, c, p, X_max, theta_R, alpha)\n        (120, 20, 80, 50, 30, 300, 120, 0.6, 0.5),\n        (150, 0, 100, 40, 25, 500, 90, 0.8, 0.3),\n        (100, 30, 90, 70, 35, 400, 120, 0.2, 0.7),\n    ]\n\n    final_results = []\n    for case in test_cases:\n        D, a, b, mu, c, p, X_max, theta_R, alpha = case\n        case_results = solve_models(D, a, b, mu, c, p, X_max, theta_R, alpha)\n        final_results.extend(case_results)\n    \n    # Format the final output as a comma-separated list of values in brackets.\n    # The problem implies floating point output, not scientific notation.\n    print(f\"[{','.join(f'{res:.10f}'.rstrip('0').rstrip('.') for res in final_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}