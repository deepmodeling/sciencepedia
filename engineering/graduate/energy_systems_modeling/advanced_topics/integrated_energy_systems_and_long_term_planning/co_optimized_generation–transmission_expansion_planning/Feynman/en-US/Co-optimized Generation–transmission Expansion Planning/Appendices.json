{
    "hands_on_practices": [
        {
            "introduction": "At its core, co-optimized expansion planning is an economic problem of choosing the least-cost portfolio of investments over a long time horizon. Before diving into complex optimization models, it is essential to master the fundamental tools of engineering economics. This practice  will guide you through a foundational Net Present Value (NPV) analysis, comparing a local generation project against a remote generation project that requires transmission reinforcement, reinforcing your understanding of time value of money, annuitization, and salvage value.",
            "id": "4078601",
            "problem": "Consider a two-node power system over a finite planning horizon of $T = 20$ years for co-optimized generation–transmission expansion planning. Node $1$ has an inelastic annual energy requirement equal to the energy produced by a constant-output generator of nameplate capacity $100$ megawatts with capacity factor $0.6$. The annual energy requirement is therefore $100 \\times 8760 \\times 0.6$ megawatt-hours per year. There is an existing transmission intertie from node $2$ to node $1$ with thermal capacity $50$ megawatts. One candidate transmission reinforcement is available that, if built, increases transfer capacity by $100$ megawatts.\n\nTwo mutually exclusive investment portfolios are feasible to fully meet the annual energy requirement at node $1$:\n\n- Portfolio $\\mathrm{A}$ (local generation only): Build a generator at node $1$ with nameplate capacity $100$ megawatts, real overnight capital cost $1800$ United States dollars per kilowatt, fixed Operations and Maintenance (O&M) cost $30$ United States dollars per kilowatt-year, variable production cost $45$ United States dollars per megawatt-hour, technical lifetime $30$ years, and constant capacity factor $0.6$ over the planning horizon. No transmission reinforcement is built.\n\n- Portfolio $\\mathrm{B}$ (remote generation plus transmission reinforcement): Build a generator at node $2$ with nameplate capacity $100$ megawatts, real overnight capital cost $1200$ United States dollars per kilowatt, fixed O&M cost $40$ United States dollars per kilowatt-year, variable production cost $20$ United States dollars per megawatt-hour, technical lifetime $25$ years, and constant capacity factor $0.6$ over the planning horizon; and build the transmission reinforcement that increases transfer capacity by $100$ megawatts with real overnight capital cost $60$ million United States dollars, fixed O&M cost $1$ million United States dollars per year, and technical lifetime $40$ years.\n\nAssume a constant real discount rate $r = 0.05$ per year. All capital investments occur at year $0$ and are paid once at that time. Fixed O&M and variable production costs are incurred at the end of each year from year $1$ to year $T$. If an asset’s technical lifetime $L$ exceeds the planning horizon $T$, treat the residual value at year $T$ as a linear salvage equal to the undepreciated fraction of its original capital cost, namely a cash inflow at year $T$ of $\\text{capital cost} \\times (L - T)/L$. Ignore taxes, inflation beyond the specified real discounting, and any decommissioning costs. Assume the network operates without congestion beyond what is stated, so portfolio $\\mathrm{B}$ delivers the full energy requirement to node $1$ via the reinforced intertie.\n\nUsing only the fundamental definitions of the time value of money based on discounting of cash flows and geometric sums, determine the net present value of total system cost for the least-cost portfolio among $\\mathrm{A}$ and $\\mathrm{B}$.\n\nExpress the final net present value in million United States dollars (million USD). Round your answer to four significant figures.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded, well-posed, objective, and fully specified. It represents a standard engineering economics problem in the context of power system expansion planning. All data are consistent and sufficient for a unique solution.\n\nThe objective is to determine the least-cost portfolio by comparing the Net Present Value (NPV) of total system costs for two mutually exclusive portfolios, A and B, over a planning horizon $T = 20$ years with a real discount rate of $r = 0.05$. The NPV of costs is the sum of all discounted cash outflows minus the sum of all discounted cash inflows.\n\nThe general formula for the NPV of costs for a given portfolio is:\n$$NPV = C_{CAP, 0} + \\sum_{t=1}^{T} \\frac{A_t}{(1+r)^t} - \\frac{S_T}{(1+r)^T}$$\nwhere $C_{CAP, 0}$ is the total capital investment cost incurred at year $t=0$, $A_t$ is the annual cost incurred at the end of year $t$, and $S_T$ is the total salvage value realized as a cash inflow at the end of the planning horizon, year $T$.\n\nIn this problem, the annual costs are constant, so $A_t = A$ for all years $t=1, \\dots, T$. The summation term represents the present value of a uniform annuity, which is a geometric series:\n$$\\sum_{t=1}^{T} \\frac{A}{(1+r)^t} = A \\left[ \\frac{1 - (1+r)^{-T}}{r} \\right]$$\nThe term in the brackets is the Present Value Annuity Factor, $PVAF(r, T)$. For $r=0.05$ and $T=20$:\n$$PVAF(0.05, 20) = \\frac{1 - (1+0.05)^{-20}}{0.05} = \\frac{1 - (1.05)^{-20}}{0.05}$$\n\nThe problem specifies the annual energy requirement $E$ is met by a generator of $100$ megawatts nameplate capacity with a capacity factor of $0.6$:\n$$E = 100 \\text{ MW} \\times 8760 \\frac{\\text{h}}{\\text{year}} \\times 0.6 = 525,600 \\frac{\\text{MWh}}{\\text{year}}$$\nThis energy production is required for both portfolios.\n\n**Portfolio A: Local Generation**\n\n1.  **Capital Cost ($C_{CAP, A}$):**\n    The generator has a nameplate capacity of $100 \\text{ MW} = 100,000 \\text{ kW}$. The overnight capital cost is $1800$ USD/kW.\n    $$C_{CAP, A} = 100,000 \\text{ kW} \\times 1800 \\frac{\\text{USD}}{\\text{kW}} = 180,000,000 \\text{ USD}$$\n    This cost is incurred at year $t=0$.\n\n2.  **Annual Cost ($A_A$):**\n    The annual cost is the sum of fixed O&M and variable production costs.\n    Fixed O&M cost: $100,000 \\text{ kW} \\times 30 \\frac{\\text{USD}}{\\text{kW-year}} = 3,000,000 \\frac{\\text{USD}}{\\text{year}}$.\n    Variable cost: $525,600 \\frac{\\text{MWh}}{\\text{year}} \\times 45 \\frac{\\text{USD}}{\\text{MWh}} = 23,652,000 \\frac{\\text{USD}}{\\text{year}}$.\n    $$A_A = 3,000,000 + 23,652,000 = 26,652,000 \\frac{\\text{USD}}{\\text{year}}$$\n    The present value of this annuity over $T=20$ years is:\n    $$PV_{ANN, A} = A_A \\times PVAF(0.05, 20) = 26,652,000 \\times \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right]$$\n\n3.  **Salvage Value ($S_A$):**\n    The generator has a technical lifetime $L_{G,A} = 30$ years, which is greater than the planning horizon $T = 20$ years. The salvage value is the undepreciated fraction of the capital cost.\n    $$S_A = C_{CAP, A} \\times \\frac{L_{G,A} - T}{L_{G,A}} = 180,000,000 \\text{ USD} \\times \\frac{30 - 20}{30} = 60,000,000 \\text{ USD}$$\n    This is a cash inflow at year $T=20$. Its present value is:\n    $$PV_{SAL, A} = \\frac{S_A}{(1+r)^T} = \\frac{60,000,000}{(1.05)^{20}}$$\n\n4.  **Net Present Value ($NPV_A$):**\n    $$NPV_A = C_{CAP, A} + PV_{ANN, A} - PV_{SAL, A}$$\n    $$NPV_A = 180,000,000 + 26,652,000 \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right] - \\frac{60,000,000}{(1.05)^{20}}$$\n    Using $(1.05)^{20} \\approx 2.6532977$:\n    $$NPV_A \\approx 180,000,000 + 26,652,000 \\times 12.46221 - 22,613,369 = 180,000,000 + 332,143,623 - 22,613,369 = 489,530,254 \\text{ USD}$$\n\n**Portfolio B: Remote Generation and Transmission Reinforcement**\n\n1.  **Capital Cost ($C_{CAP, B}$):**\n    This includes capital costs for both the generator and the transmission line, incurred at $t=0$.\n    Generator: $100,000 \\text{ kW} \\times 1200 \\frac{\\text{USD}}{\\text{kW}} = 120,000,000 \\text{ USD}$.\n    Transmission: $60,000,000 \\text{ USD}$.\n    $$C_{CAP, B} = 120,000,000 + 60,000,000 = 180,000,000 \\text{ USD}$$\n\n2.  **Annual Cost ($A_B$):**\n    This includes fixed O&M for generator and transmission, and variable cost for the generator.\n    Generator Fixed O&M: $100,000 \\text{ kW} \\times 40 \\frac{\\text{USD}}{\\text{kW-year}} = 4,000,000 \\frac{\\text{USD}}{\\text{year}}$.\n    Generator Variable cost: $525,600 \\frac{\\text{MWh}}{\\text{year}} \\times 20 \\frac{\\text{USD}}{\\text{MWh}} = 10,512,000 \\frac{\\text{USD}}{\\text{year}}$.\n    Transmission Fixed O&M: $1,000,000 \\frac{\\text{USD}}{\\text{year}}$.\n    $$A_B = 4,000,000 + 10,512,000 + 1,000,000 = 15,512,000 \\frac{\\text{USD}}{\\text{year}}$$\n    The present value of this annuity is:\n    $$PV_{ANN, B} = A_B \\times PVAF(0.05, 20) = 15,512,000 \\times \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right]$$\n\n3.  **Salvage Value ($S_B$):**\n    Salvage values are calculated for both assets as their lifetimes ($L_{G,B}=25$, $L_{T,B}=40$) exceed $T=20$.\n    Generator: $S_{G,B} = 120,000,000 \\times \\frac{25 - 20}{25} = 24,000,000 \\text{ USD}$.\n    Transmission: $S_{T,B} = 60,000,000 \\times \\frac{40 - 20}{40} = 30,000,000 \\text{ USD}$.\n    Total salvage value:\n    $$S_B = S_{G,B} + S_{T,B} = 24,000,000 + 30,000,000 = 54,000,000 \\text{ USD}$$\n    The present value of this inflow at year $T=20$ is:\n    $$PV_{SAL, B} = \\frac{S_B}{(1+r)^T} = \\frac{54,000,000}{(1.05)^{20}}$$\n\n4.  **Net Present Value ($NPV_B$):**\n    $$NPV_B = C_{CAP, B} + PV_{ANN, B} - PV_{SAL, B}$$\n    $$NPV_B = 180,000,000 + 15,512,000 \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right] - \\frac{54,000,000}{(1.05)^{20}}$$\n    $$NPV_B \\approx 180,000,000 + 15,512,000 \\times 12.46221 - 20,352,032 = 180,000,000 + 193,310,959 - 20,352,032 = 352,958,927 \\text{ USD}$$\n\n**Comparison**\n\nComparing the total NPV of costs for both portfolios:\n$NPV_A \\approx 489,530,254 \\text{ USD}$\n$NPV_B \\approx 352,958,927 \\text{ USD}$\n\nSince $NPV_B < NPV_A$, Portfolio B is the least-cost portfolio. The question asks for the net present value of this least-cost portfolio, expressed in million USD and rounded to four significant figures.\n\n$NPV_B = 352.958927$ million USD.\nRounding to four significant figures gives $353.0$ million USD.",
            "answer": "$$\\boxed{353.0}$$"
        },
        {
            "introduction": "Building on basic financial evaluation, we can develop stylized models to analyze the fundamental trade-offs in system expansion. This exercise  introduces the concept of screening curves and Long-Run Marginal Cost (LRMC) to determine the economic tipping point between building local generation versus investing in both remote generation and transmission capacity. By deriving the breakeven hours of operation, you will gain a deeper intuition for how the interplay of fixed and variable costs drives optimal investment decisions in a network.",
            "id": "4078594",
            "problem": "A central planner is undertaking co-optimized generation–transmission expansion planning in a stylized two-node network. Node $1$ has unlimited potential to build a baseload technology with constant variable cost $c_{B}$ and annualized fixed cost $f_{B}$ per $\\mathrm{MW}$-year. Node $2$ has unlimited potential to build a peaking technology with constant variable cost $c_{P}$ and annualized fixed cost $f_{P}$ per $\\mathrm{MW}$-year. The nodes are connected by a single transmission corridor whose capacity can be expanded at an annualized fixed cost $f_{T}$ per $\\mathrm{MW}$-year. Assume lossless Direct Current (DC) power flow and ignore pre-existing capacities for the purpose of marginal analysis.\n\nLong-Run Marginal Cost (LRMC) at a node is defined as the minimum increase in total annualized system cost per unit increase in annual energy demand at that node, allowing optimal re-optimization of generation and transmission investments and dispatch. Consider a small, constant load block at node $2$ with magnitude $\\Delta$ $\\mathrm{MW}$ that occurs for $h$ hours per year; the associated annual energy is $E=\\Delta h$ $\\mathrm{MWh}$. The planner may meet this incremental block either by installing the peaking technology locally at node $2$, or by installing the baseload technology at node $1$ and expanding the transmission corridor to deliver power to node $2$.\n\nUsing first principles of cost minimization and the definition of LRMC, derive the breakeven annual hours-of-use $h^{\\star}$ at which the LRMC delivered by remote baseload generation at node $1$ plus transmission expansion exactly equals the LRMC delivered by local peaking generation at node $2$. Then compute the numerical value of $h^{\\star}$ for the following data:\n- $f_{B} = 200{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$,\n- $c_{B} = 25$ $\\mathrm{\\$}/\\mathrm{MWh}$,\n- $f_{P} = 80{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$,\n- $c_{P} = 120$ $\\mathrm{\\$}/\\mathrm{MWh}$,\n- $f_{T} = 60{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$.\n\nRound your final numeric answer to four significant figures. Express the final answer in hours.",
            "solution": "The problem will first be validated according to the specified procedure.\n\n### Step 1: Extract Givens\n-   System: A two-node network, Node $1$ and Node $2$.\n-   Generation at Node $1$: Baseload technology with variable cost $c_{B}$ and annualized fixed cost $f_{B}$ per $\\mathrm{MW}$-year. Unlimited installation potential.\n-   Generation at Node $2$: Peaking technology with variable cost $c_{P}$ and annualized fixed cost $f_{P}$ per $\\mathrm{MW}$-year. Unlimited installation potential.\n-   Transmission: A single corridor connecting the nodes. Capacity can be expanded at an annualized fixed cost $f_{T}$ per $\\mathrm{MW}$-year.\n-   Modeling Assumptions: Lossless Direct Current (DC) power flow. Pre-existing capacities are ignored for marginal analysis.\n-   Definition of LRMC: Long-Run Marginal Cost (LRMC) at a node is the minimum increase in total annualized system cost per unit increase in annual energy demand at that node, allowing optimal re-optimization of generation and transmission investments and dispatch.\n-   Incremental Load: A small, constant load block at node $2$ with magnitude $\\Delta$ $\\mathrm{MW}$ occurring for $h$ hours per year.\n-   Incremental Energy: The annual energy associated with the load block is $E=\\Delta h$ $\\mathrm{MWh}$.\n-   Data:\n    -   $f_{B} = 200{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n    -   $c_{B} = 25$ $\\mathrm{\\$}/\\mathrm{MWh}$\n    -   $f_{P} = 80{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n    -   $c_{P} = 120$ $\\mathrm{\\$}/\\mathrm{MWh}$\n    -   $f_{T} = 60{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   Task 1: Derive the breakeven annual hours-of-use $h^{\\star}$.\n-   Task 2: Compute the numerical value of $h^{\\star}$ and round to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded. It represents a classic, albeit stylized, problem in energy economics and systems engineering, specifically concerning generation and transmission expansion planning. This type of analysis, often known as a screening curve analysis, is a fundamental tool in the field. The model is based on well-established principles of cost minimization. The problem is well-posed. The objective is clear (find the breakeven hours), the data provided are sufficient, and the assumptions (e.g., linear costs, lossless DC flow, ignoring existing capacity for marginal analysis) create a solvable system. The language is objective and precise. The problem is self-contained and internally consistent. It does not violate any scientific or mathematical principles. All terms are clearly defined or standard within the discipline.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A solution will be provided.\n\nThe problem requires a derivation of the breakeven hours of use, $h^{\\star}$, where two options for serving an incremental load have an equal Long-Run Marginal Cost (LRMC). The incremental load is a block of $\\Delta$ $\\mathrm{MW}$ at Node $2$ for $h$ hours per year. The associated annual energy demand increase is $E = \\Delta h$ $\\mathrm{MWh}$.\n\nAccording to the problem's definition, the LRMC is the increase in total annualized system cost, $\\delta C_{sys}$, per unit increase in annual energy demand, $\\delta E$. For a small, discrete block of load, this can be written as:\n$$\n\\mathrm{LRMC} = \\frac{\\delta C_{sys}}{\\delta E} = \\frac{\\delta C_{sys}}{\\Delta h}\n$$\nWe must evaluate the LRMC for the two supply options for this incremental load.\n\n**Option 1: Local Peaking Generation at Node $2$**\nTo serve a load of $\\Delta$ $\\mathrm{MW}$ at Node $2$, a capacity of $\\Delta$ $\\mathrm{MW}$ of the peaking technology must be installed locally.\nThe annualized fixed cost for this new capacity is the fixed cost per $\\mathrm{MW}$-year times the capacity added:\n$$\n\\delta C_{fixed, P} = f_{P} \\Delta\n$$\nThe annual variable cost is the cost to generate $\\Delta$ $\\mathrm{MW}$ of power for $h$ hours:\n$$\n\\delta C_{var, P} = c_{P} (\\Delta h)\n$$\nThe total increase in annualized system cost for this option is the sum of the fixed and variable costs:\n$$\n\\delta C_{sys, P} = f_{P} \\Delta + c_{P} \\Delta h\n$$\nThe LRMC for the local peaking option, $\\mathrm{LRMC}_{P}$, is therefore:\n$$\n\\mathrm{LRMC}_{P} = \\frac{\\delta C_{sys, P}}{\\Delta h} = \\frac{f_{P} \\Delta + c_{P} \\Delta h}{\\Delta h} = \\frac{f_{P}}{h} + c_{P}\n$$\n\n**Option 2: Remote Baseload Generation at Node $1$ plus Transmission Expansion**\nTo serve the $\\Delta$ $\\mathrm{MW}$ load at Node $2$ using generation from Node $1$, new baseload capacity of $\\Delta$ $\\mathrm{MW}$ must be built at Node $1$, and the transmission capacity must be expanded by $\\Delta$ $\\mathrm{MW}$ to deliver the power.\nThe annualized fixed cost for the new baseload generation capacity is:\n$$\n\\delta C_{fixed, B} = f_{B} \\Delta\n$$\nThe annualized fixed cost for the new transmission capacity is:\n$$\n\\delta C_{fixed, T} = f_{T} \\Delta\n$$\nThe total annualized fixed cost for this option is the sum of the generation and transmission fixed costs:\n$$\n\\delta C_{fixed, B+T} = (f_{B} + f_{T}) \\Delta\n$$\nThe annual variable cost is for generation from the baseload plant for $h$ hours:\n$$\n\\delta C_{var, B} = c_{B} (\\Delta h)\n$$\nThe total increase in annualized system cost for this option is:\n$$\n\\delta C_{sys, B+T} = (f_{B} + f_{T}) \\Delta + c_{B} \\Delta h\n$$\nThe LRMC for the remote baseload option, $\\mathrm{LRMC}_{B+T}$, is:\n$$\n\\mathrm{LRMC}_{B+T} = \\frac{\\delta C_{sys, B+T}}{\\Delta h} = \\frac{(f_{B} + f_{T}) \\Delta + c_{B} \\Delta h}{\\Delta h} = \\frac{f_{B} + f_{T}}{h} + c_{B}\n$$\n\n**Derivation of Breakeven Hours ($h^{\\star}$)**\nThe breakeven point, $h^{\\star}$, is the number of hours at which the LRMC of both options are equal.\n$$\n\\mathrm{LRMC}_{P} = \\mathrm{LRMC}_{B+T}\n$$\nSubstituting the derived expressions at $h = h^{\\star}$:\n$$\n\\frac{f_{P}}{h^{\\star}} + c_{P} = \\frac{f_{B} + f_{T}}{h^{\\star}} + c_{B}\n$$\nTo solve for $h^{\\star}$, we first group terms with $h^{\\star}$ and constant terms:\n$$\nc_{P} - c_{B} = \\frac{f_{B} + f_{T}}{h^{\\star}} - \\frac{f_{P}}{h^{\\star}}\n$$\n$$\nc_{P} - c_{B} = \\frac{f_{B} + f_{T} - f_{P}}{h^{\\star}}\n$$\nAssuming $c_{P} \\neq c_{B}$, we can isolate $h^{\\star}$:\n$$\nh^{\\star} = \\frac{f_{B} + f_{T} - f_{P}}{c_{P} - c_{B}}\n$$\nThis is the symbolic expression for the breakeven annual hours-of-use.\n\n**Numerical Calculation**\nNow, we substitute the provided numerical values into the derived expression. The given values are:\n-   $f_{B} = 200000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   $f_{P} = 80000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   $f_{T} = 60000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   $c_{B} = 25$ $\\mathrm{\\$}/\\mathrm{MWh}$\n-   $c_{P} = 120$ $\\mathrm{\\$}/\\mathrm{MWh}$\n\nPlugging these values into the formula for $h^{\\star}$:\n$$\nh^{\\star} = \\frac{200000 + 60000 - 80000}{120 - 25}\n$$\n$$\nh^{\\star} = \\frac{180000}{95}\n$$\n$$\nh^{\\star} \\approx 1894.736842... \\text{ hours}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\nh^{\\star} \\approx 1895 \\text{ hours}\n$$\nThe breakeven point occurs at approximately $1895$ hours per year. For durations shorter than this, the local peaker is more economical. For durations longer than this, the remote baseload plant with transmission expansion is the cheaper option for serving the incremental load.",
            "answer": "$$\\boxed{1895}$$"
        },
        {
            "introduction": "Full-scale expansion planning relies on solving mathematical optimization problems, typically linear programs. The value of these models extends beyond just finding the least-cost investment plan; they also provide rich economic insights through their dual variables (shadow prices). In this hands-on coding practice , you will implement and solve a co-optimization model and learn to interpret its dual solution as locational marginal prices and the marginal value of capacity, numerically verifying these concepts using sensitivity analysis.",
            "id": "4078588",
            "problem": "Consider a co-optimized Generation–Transmission Expansion Planning linear program with a single time snapshot, formulated on a two-bus network. The decision variables are the generation dispatch at bus $1$ and bus $2$, denoted $g_1$ and $g_2$ (in $\\mathrm{MW}$), the power flow from bus $1$ to bus $2$ denoted $f$ (in $\\mathrm{MW}$, allowed to be positive or negative), and the nonnegative capacity expansions $\\Delta G_1$, $\\Delta G_2$ (in $\\mathrm{MW}$) for generation at bus $1$ and bus $2$, respectively, and $\\Delta L$ (in $\\mathrm{MW}$) for the transmission line. The given parameters are the demands $d_1$, $d_2$ (in $\\mathrm{MW}$), the existing capacities $G_1^{\\mathrm{base}}$, $G_2^{\\mathrm{base}}$ and $L^{\\mathrm{base}}$ (in $\\mathrm{MW}$), the variable generation costs $v_1$, $v_2$ (in $\\mathrm{\\$/MWh}$), and the amortized per-hour capacity expansion costs $k_{G_1}$, $k_{G_2}$, and $k_L$ (in $\\mathrm{\\$/MW\\text{-}h}$). The objective is to minimize the total hourly system cost in $\\mathrm{\\$/h}$.\n\nThe primal linear program is:\nMinimize the objective\n$$\nJ = v_1 g_1 + v_2 g_2 + k_{G_1} \\Delta G_1 + k_{G_2} \\Delta G_2 + k_L \\Delta L\n$$\nsubject to the nodal power balance equalities\n$$\ng_1 - f = d_1, \\quad g_2 + f = d_2,\n$$\nthe capacity inequalities\n$$\ng_1 - \\Delta G_1 \\leq G_1^{\\mathrm{base}}, \\quad g_2 - \\Delta G_2 \\leq G_2^{\\mathrm{base}},\n$$\n$$\nf - \\Delta L \\leq L^{\\mathrm{base}}, \\quad -f - \\Delta L \\leq L^{\\mathrm{base}},\n$$\nand bounds\n$$\ng_1 \\ge 0, \\quad g_2 \\ge 0, \\quad \\Delta G_1 \\ge 0, \\quad \\Delta G_2 \\ge 0, \\quad \\Delta L \\ge 0, \\quad f \\in \\mathbb{R}.\n$$\n\nFrom the base of linear programming duality and the envelope theorem, the shadow prices (dual variables) associated with the nodal balance equalities provide the sensitivity (directional derivatives) of the optimal objective $J^\\star$ with respect to the demands $d_1$ and $d_2$, in $\\mathrm{\\$/MWh}$, while the shadow prices associated with the line capacity inequalities provide the sensitivity of $J^\\star$ with respect to $L^{\\mathrm{base}}$ in $\\mathrm{\\$/MWh}$.\n\nYour program must:\n- Solve the primal problem for specified parameter sets.\n- Extract the dual variables (shadow prices) for the nodal balance equalities and for each capacity inequality.\n- Compute the sensitivity of $J^\\star$ with respect to $L^{\\mathrm{base}}$ as the sum of the two line inequality dual variables, since $L^{\\mathrm{base}}$ appears in both line inequalities with the same sign.\n- Verify the envelope theorem numerically for $d_2$ by computing a finite-difference approximation of $\\partial J^\\star / \\partial d_2$ using a small perturbation $\\delta$ (in $\\mathrm{MW}$), i.e., $\\left(J^\\star(d_2+\\delta) - J^\\star(d_2)\\right)/\\delta$, and comparing it to the dual variable of the bus $2$ nodal balance.\n\nPhysical units in all computations must be consistent: $g_1$, $g_2$, $f$, $\\Delta G_1$, $\\Delta G_2$, $\\Delta L$, $d_1$, $d_2$, $G_1^{\\mathrm{base}}$, $G_2^{\\mathrm{base}}$, $L^{\\mathrm{base}}$ are in $\\mathrm{MW}$; $v_1$, $v_2$ are in $\\mathrm{\\$/MWh}$; $k_{G_1}$, $k_{G_2}$, $k_L$ are in $\\mathrm{\\$/MW\\text{-}h}$; the optimal objective value $J^\\star$ is in $\\mathrm{\\$/h}$; sensitivities with respect to demands and capacities are in $\\mathrm{\\$/MWh}$.\n\nTest Suite:\nProvide results for the following three parameter sets, chosen to cover different regimes.\n\n- Case $1$ (cheap generation at bus $1$, moderate line expansion cost, tight base capacities):\n    - $d_1 = 80$, $d_2 = 20$.\n    - $G_1^{\\mathrm{base}} = 50$, $G_2^{\\mathrm{base}} = 10$, $L^{\\mathrm{base}} = 10$.\n    - $v_1 = 20$, $v_2 = 60$.\n    - $k_{G_1} = 15$, $k_{G_2} = 8$, $k_{L} = 5$.\n- Case $2$ (expensive transmission expansion, favor local supply at bus $2$):\n    - $d_1 = 10$, $d_2 = 90$.\n    - $G_1^{\\mathrm{base}} = 30$, $G_2^{\\mathrm{base}} = 50$, $L^{\\mathrm{base}} = 20$.\n    - $v_1 = 25$, $v_2 = 40$.\n    - $k_{G_1} = 20$, $k_{G_2} = 12$, $k_{L} = 100$.\n- Case $3$ (abundant base capacities, no expansions needed, equal variable costs):\n    - $d_1 = 30$, $d_2 = 30$.\n    - $G_1^{\\mathrm{base}} = 100$, $G_2^{\\mathrm{base}} = 100$, $L^{\\mathrm{base}} = 100$.\n    - $v_1 = 30$, $v_2 = 30$.\n    - $k_{G_1} = 100$, $k_{G_2} = 100$, $k_{L} = 100$.\n\nFor each case, your program must output a list of five floats:\n$[J^\\star, \\lambda_1, \\lambda_2, \\partial J^\\star / \\partial L^{\\mathrm{base}}, \\widehat{\\partial J^\\star / \\partial d_2}]$, where $\\lambda_1$ and $\\lambda_2$ are the dual variables of the bus $1$ and bus $2$ nodal balance equalities (in $\\mathrm{\\$/MWh}$), $\\partial J^\\star / \\partial L^{\\mathrm{base}}$ is computed as the sum of the two line inequality dual variables (in $\\mathrm{\\$/MWh}$), and $\\widehat{\\partial J^\\star / \\partial d_2}$ is the finite-difference estimate (in $\\mathrm{\\$/MWh}$) using a perturbation $\\delta = 10^{-4}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results for the three test cases as a comma-separated list of lists enclosed in square brackets, for example $[[\\dots],[\\dots],[\\dots]]$. All numeric outputs represent values in the units specified above and must be expressed as plain decimal numbers without unit symbols.",
            "solution": "We start from the fundamental base of linear programming and duality. The primal problem is a linear program with decision vector $x = [g_1, g_2, f, \\Delta G_1, \\Delta G_2, \\Delta L]^\\top$. The objective function is linear,\n$$\nJ(x) = c^\\top x,\n$$\nwith cost vector $c = [v_1, v_2, 0, k_{G_1}, k_{G_2}, k_L]^\\top$. The equality constraints encode power balance at each bus,\n$$\nA_{\\mathrm{eq}} x = b_{\\mathrm{eq}}, \\quad A_{\\mathrm{eq}} = \\begin{bmatrix} 1  0  -1  0  0  0 \\\\ 0  1  1  0  0  0 \\end{bmatrix}, \\quad b_{\\mathrm{eq}} = \\begin{bmatrix} d_1 \\\\ d_2 \\end{bmatrix}.\n$$\nThe inequality constraints encode capacity limits rewritten into the standard form $A_{\\mathrm{ub}} x \\le b_{\\mathrm{ub}}$,\n$$\nA_{\\mathrm{ub}} = \\begin{bmatrix}\n1  0  0  -1  0  0 \\\\\n0  1  0  0  -1  0 \\\\\n0  0  1  0  0  -1 \\\\\n0  0  -1  0  0  -1\n\\end{bmatrix}, \\quad\nb_{\\mathrm{ub}} = \\begin{bmatrix}\nG_1^{\\mathrm{base}} \\\\\nG_2^{\\mathrm{base}} \\\\\nL^{\\mathrm{base}} \\\\\nL^{\\mathrm{base}}\n\\end{bmatrix}.\n$$\nThe variable bounds are $g_1 \\ge 0$, $g_2 \\ge 0$, $\\Delta G_1 \\ge 0$, $\\Delta G_2 \\ge 0$, $\\Delta L \\ge 0$, and $f$ is free.\n\nBy the well-tested theory of linear programming duality, the dual to the primal minimization problem has dual variables $\\lambda \\in \\mathbb{R}^2$ associated with the equality constraints and $\\mu \\in \\mathbb{R}^4_{\\ge 0}$ associated with the inequality constraints. The Lagrangian is\n$$\n\\mathcal{L}(x, \\lambda, \\mu) = c^\\top x + \\lambda^\\top (A_{\\mathrm{eq}} x - b_{\\mathrm{eq}}) + \\mu^\\top (A_{\\mathrm{ub}} x - b_{\\mathrm{ub}}),\n$$\nand the Karush–Kuhn–Tucker conditions (first-order optimality for linear programs) include primal feasibility $A_{\\mathrm{eq}} x = b_{\\mathrm{eq}}$, $A_{\\mathrm{ub}} x \\le b_{\\mathrm{ub}}$, bounds satisfaction; dual feasibility $A_{\\mathrm{eq}}^\\top \\lambda + A_{\\mathrm{ub}}^\\top \\mu \\le c$ for variables with nonnegativity bounds, with appropriate handling of free variables; and complementary slackness $\\mu_i \\cdot (A_{\\mathrm{ub},i} x - b_{\\mathrm{ub},i}) = 0$ for each inequality $i$.\n\nSensitivity analysis follows from the envelope theorem: under regularity and uniqueness, the gradient of the optimal value $J^\\star$ with respect to the right-hand sides is given by the optimal dual variables. Specifically, for the equality right-hand side $b_{\\mathrm{eq}}$, we have\n$$\n\\frac{\\partial J^\\star}{\\partial b_{\\mathrm{eq}}} = \\lambda^\\star,\n$$\nso $\\frac{\\partial J^\\star}{\\partial d_1} = \\lambda_1^\\star$ and $\\frac{\\partial J^\\star}{\\partial d_2} = \\lambda_2^\\star$, each in $\\mathrm{\\$/MWh}$. For the inequality right-hand side $b_{\\mathrm{ub}}$, we have\n$$\n\\frac{\\partial J^\\star}{\\partial b_{\\mathrm{ub},i}} = \\mu_i^\\star,\n$$\nso the sensitivity of $J^\\star$ with respect to $L^{\\mathrm{base}}$ is the sum of the dual variables of the two line inequalities, since $L^{\\mathrm{base}}$ appears in both with coefficient $+1$:\n$$\n\\frac{\\partial J^\\star}{\\partial L^{\\mathrm{base}}} = \\mu_3^\\star + \\mu_4^\\star.\n$$\n\nAlgorithmic design:\n- Construct the primal matrices $A_{\\mathrm{eq}}$, $b_{\\mathrm{eq}}$, $A_{\\mathrm{ub}}$, $b_{\\mathrm{ub}}$, the cost vector $c$, and bounds, directly from the provided parameters.\n- Solve the primal linear program with a numerically stable solver that exposes dual information. The High-performance Interior Point or Simplex implementation in Highs (accessed via a standard scientific computing library) returns the dual variables (marginals) for each equality and inequality constraint.\n- Extract $\\lambda^\\star$ from the equality marginals and $\\mu^\\star$ from the inequality marginals.\n- Compute the sensitivity $\\partial J^\\star / \\partial L^{\\mathrm{base}}$ as $\\mu_3^\\star + \\mu_4^\\star$.\n- Verify the envelope theorem for $\\partial J^\\star / \\partial d_2$ by computing a finite-difference approximation with a small perturbation $\\delta$:\n$$\n\\widehat{\\frac{\\partial J^\\star}{\\partial d_2}} = \\frac{J^\\star(d_2 + \\delta) - J^\\star(d_2)}{\\delta}.\n$$\nChoose $\\delta = 10^{-4}$ to ensure the perturbation is small relative to the scale of the variables, balancing numerical stability and accuracy.\n\nUnits and interpretation:\n- The optimal objective $J^\\star$ is in $\\mathrm{\\$/h}$ because generation dispatch costs $v_i g_i$ are $\\mathrm{\\$/MWh} \\cdot \\mathrm{MW} = \\mathrm{\\$/h}$ in a one-hour snapshot, and capacity expansion costs $k_{G_i} \\Delta G_i$, $k_L \\Delta L$ are in $\\mathrm{\\$/MW\\text{-}h} \\cdot \\mathrm{MW} = \\mathrm{\\$/h}$.\n- The dual variables $\\lambda_1^\\star$, $\\lambda_2^\\star$ represent Locational Marginal Prices (LMPs) in $\\mathrm{\\$/MWh}$ at bus $1$ and bus $2$, respectively. They equal the marginal cost of serving an additional $\\mathrm{MW}$ at each bus within the co-optimized planning framework, including the possibility of capacity expansion at per-hour amortized costs.\n- The sensitivity $\\partial J^\\star / \\partial L^{\\mathrm{base}}$ equals the marginal value of increasing the base line capacity by one $\\mathrm{MW}$, also in $\\mathrm{\\$/MWh}$, summing the contributions from both flow-direction constraints.\n\nImplementation details:\n- Use robust linear programming functionality that provides primal and dual solutions.\n- Assemble each test case, solve, and collect the required outputs.\n- Perform the finite-difference check for $d_2$ with $\\delta = 10^{-4}$.\n\nFinally, aggregate the results for the three test cases into the specified single-line output format, where each case yields the list $[J^\\star, \\lambda_1^\\star, \\lambda_2^\\star, \\partial J^\\star / \\partial L^{\\mathrm{base}}, \\widehat{\\partial J^\\star / \\partial d_2}]$, printed as a comma-separated list of lists enclosed in square brackets.\n\n```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_case(params, fd_eps=1e-4):\n    # Unpack parameters\n    d1 = params[\"d1\"]\n    d2 = params[\"d2\"]\n    G1_base = params[\"G1_base\"]\n    G2_base = params[\"G2_base\"]\n    L_base = params[\"L_base\"]\n    v1 = params[\"v1\"]\n    v2 = params[\"v2\"]\n    kG1 = params[\"kG1\"]\n    kG2 = params[\"kG2\"]\n    kL = params[\"kL\"]\n\n    # Cost vector: [g1, g2, f, dG1, dG2, dL]\n    c = np.array([v1, v2, 0.0, kG1, kG2, kL], dtype=float)\n\n    # Equality constraints A_eq x = b_eq\n    # g1 - f = d1\n    # g2 + f = d2\n    A_eq = np.array([\n        [1, 0, -1, 0, 0, 0],\n        [0, 1,  1, 0, 0, 0]\n    ], dtype=float)\n    b_eq = np.array([d1, d2], dtype=float)\n\n    # Inequality constraints A_ub x = b_ub\n    # g1 - dG1 = G1_base\n    # g2 - dG2 = G2_base\n    # f - dL = L_base\n    # -f - dL = L_base\n    A_ub = np.array([\n        [1, 0, 0, -1, 0,  0],\n        [0, 1, 0,  0,-1,  0],\n        [0, 0, 1,  0, 0, -1],\n        [0, 0,-1,  0, 0, -1]\n    ], dtype=float)\n    b_ub = np.array([G1_base, G2_base, L_base, L_base], dtype=float)\n\n    # Variable bounds: g1>=0, g2>=0, f free, dG1>=0, dG2>=0, dL>=0\n    bounds = [(0, None), (0, None), (None, None), (0, None), (0, None), (0, None)]\n\n    # Solve the LP\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method=\"highs\")\n\n    if not res.success:\n        raise RuntimeError(f\"LP did not solve successfully: {res.message}\")\n\n    J_star = float(res.fun)\n\n    # Extract dual variables (marginals)\n    lam_eq = np.array(res.eqlin.marginals, dtype=float) if hasattr(res.eqlin, \"marginals\") and res.eqlin.marginals is not None else np.zeros(2)\n    mu_ineq = np.array(res.ineqlin.marginals, dtype=float) if hasattr(res.ineqlin, \"marginals\") and res.ineqlin.marginals is not None else np.zeros(4)\n\n    lambda1 = float(lam_eq[0])\n    lambda2 = float(lam_eq[1])\n\n    # Sensitivity wrt L_base appears in both line constraints (indices 2 and 3)\n    # The sensitivity is the sum of the duals, which are the marginals returned by the solver.\n    dJ_dLbase = float(mu_ineq[2] + mu_ineq[3])\n\n    # Finite-difference check for derivative wrt d2\n    b_eq_fd = np.array([d1, d2 + fd_eps], dtype=float)\n    res_fd = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq_fd, bounds=bounds, method=\"highs\")\n    if not res_fd.success:\n        raise RuntimeError(f\"FD LP did not solve successfully: {res_fd.message}\")\n    J_star_fd = float(res_fd.fun)\n    fd_dJ_dd2 = (J_star_fd - J_star) / fd_eps\n\n    return [J_star, lambda1, lambda2, dJ_dLbase, fd_dJ_dd2]\n\ndef solve():\n    test_cases = [\n        {\n            \"d1\": 80.0, \"d2\": 20.0,\n            \"G1_base\": 50.0, \"G2_base\": 10.0, \"L_base\": 10.0,\n            \"v1\": 20.0, \"v2\": 60.0,\n            \"kG1\": 15.0, \"kG2\": 8.0, \"kL\": 5.0\n        },\n        {\n            \"d1\": 10.0, \"d2\": 90.0,\n            \"G1_base\": 30.0, \"G2_base\": 50.0, \"L_base\": 20.0,\n            \"v1\": 25.0, \"v2\": 40.0,\n            \"kG1\": 20.0, \"kG2\": 12.0, \"kL\": 100.0\n        },\n        {\n            \"d1\": 30.0, \"d2\": 30.0,\n            \"G1_base\": 100.0, \"G2_base\": 100.0, \"L_base\": 100.0,\n            \"v1\": 30.0, \"v2\": 30.0,\n            \"kG1\": 100.0, \"kG2\": 100.0, \"kL\": 100.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(solve_case(case, fd_eps=1e-4))\n\n    # Print single-line aggregated output as specified\n    print(\"[\" + \",\".join([\"[\" + \",\".join(map(str, r)) + \"]\" for r in results]) + \"]\")\n\n# solve() can be executed to generate the answer\n```",
            "answer": "[[2800.0,35.0,40.0,-5.0,40.00000000014552],[3790.0,25.0,52.0,-27.0,52.00000000014552],[1800.0,30.0,30.0,0.0,30.00000000014552]]"
        }
    ]
}