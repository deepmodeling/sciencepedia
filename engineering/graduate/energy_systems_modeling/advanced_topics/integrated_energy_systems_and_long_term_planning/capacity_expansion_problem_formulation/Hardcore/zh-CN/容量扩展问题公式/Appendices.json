{
    "hands_on_practices": [
        {
            "introduction": "容量扩张模型从根本上涉及在长时间范围内进行经济权衡。本练习将让您掌握工程经济学的核心原则，通过计算一组能源资产的净现成本（$NPC$），并仔细考虑现金流、折现和残值 。掌握这项技能对于准确比较不同投资策略的全生命周期成本至关重要。",
            "id": "4074209",
            "problem": "一位系统规划师正在为一个区域电力系统制定一个为期 $T = 7$ 年的有限规划期内的多年容量扩展计划。规划师必须评估由三个资产的资本支出现金流组成的投资流的净现成本，使用年末离散贴现法，恒定的实际年贴现率为 $r = 0.07$。所有现金流均以实际美元 (USD) 计价。这三个资产、其支付时间表、投产时间以及经济寿命如下：\n- 资产 $\\mathcal{A}$ (电池储能)：在第 $t = 0$ 年资本支出为 $6000$ 万美元，在第 $t = 1$ 年资本支出为 $6000$ 万美元，于第 $t = 1$ 年末投产，经济寿命为 $L_{\\mathcal{A}} = 10$ 年。\n- 资产 $\\mathcal{B}$ (陆上风电场)：在第 $t = 2$ 年资本支出为 $9000$ 万美元，在第 $t = 3$ 年资本支出为 $9000$ 万美元，于第 $t = 3$ 年末投产，经济寿命为 $L_{\\mathcal{B}} = 25$ 年。\n- 资产 $\\mathcal{C}$ (输电升级)：在第 $t = 5$ 年单笔资本支出为 $5000$ 万美元，于第 $t = 5$ 年末投产，经济寿命为 $L_{\\mathcal{C}} = 40$ 年。\n\n在规划期末（第 $t = 7$ 年末），每项资产都保留有残值，必须作为现金流入处理。残值定义为采用直线折旧法计算的未折旧账面价值，其中直线折旧法在经济寿命期内分配相等的年度折旧费用，从投产开始计算。规划期末的未折旧账面价值由剩余账面寿命相对于经济寿命的比率决定。忽略任何运营支出、税收、通货膨胀和退役成本。\n\n从货币时间价值和直线折旧法的基本原理出发，计算该投资流的净现成本。净现成本定义为所有资本支出的现值减去在 $t = 7$ 时所有残值流入的现值，并使用 $r=0.07$ 的贴现率贴现至 $t=0$。最终结果以百万美元 (USD) 表示，并四舍五入至四位有效数字。",
            "solution": "该问题陈述是工程经济学中的一个适定问题，具体应用于能源系统容量扩展。所有必要的数据、定义和边界条件均已提供，并且它们是自洽且有科学依据的。该问题有效。\n\n目标是计算一系列投资的净现成本 (NPC)。NPC 定义为所有现金流出（资本支出）的现值减去所有现金流入（残值）的现值。使用离散年贴现率 $r$ 将其贴现至时间 $t=0$。发生在第 $t$ 年末的未来现金流 $F_t$ 的现值 (PV) 公式为：\n$$ PV(F_t) = \\frac{F_t}{(1+r)^t} $$\n因此，总 NPC 为：\n$$ NPC = PV(\\text{Capital Expenditures}) - PV(\\text{Salvage Inflows}) $$\n\n计算分三部分进行：\n1.  计算资本支出的现值 (PVC)。\n2.  计算在规划期末 $t=7$ 时每项资产的残值 (SV)，然后计算这些流入的现值 (PVSV)。\n3.  计算最终的 NPC，即 $NPC = PVC - PVSV$。\n\n所有货币价值均以百万美元 (USD) 为单位。给定的参数是：\n- 规划期在 $T=7$ 年末结束。\n- 贴现率 $r = 0.07$。\n\n**第一部分：资本支出的现值 (PVC)**\n\n资本支出是在指定年份的一系列现金流出。其总现值是每笔支出贴现值的总和。\n设 $C_{\\mathcal{A},t}$、$C_{\\mathcal{B},t}$ 和 $C_{\\mathcal{C},t}$ 分别为资产 $\\mathcal{A}$、$\\mathcal{B}$ 和 $\\mathcal{C}$ 在第 $t$ 年的资本支出。给定的支出如下：\n- $C_{\\mathcal{A},0} = 6000$ 万美元，在 $t=0$。\n- $C_{\\mathcal{A},1} = 6000$ 万美元，在 $t=1$。\n- $C_{\\mathcal{B},2} = 9000$ 万美元，在 $t=2$。\n- $C_{\\mathcal{B},3} = 9000$ 万美元，在 $t=3$。\n- $C_{\\mathcal{C},5} = 5000$ 万美元，在 $t=5$。\n\n总 PVC 计算如下：\n$$ PVC = \\frac{C_{\\mathcal{A},0}}{(1+r)^0} + \\frac{C_{\\mathcal{A},1}}{(1+r)^1} + \\frac{C_{\\mathcal{B},2}}{(1+r)^2} + \\frac{C_{\\mathcal{B},3}}{(1+r)^3} + \\frac{C_{\\mathcal{C},5}}{(1+r)^5} $$\n代入给定值：\n$$ PVC = \\frac{60}{(1.07)^0} + \\frac{60}{(1.07)^1} + \\frac{90}{(1.07)^2} + \\frac{90}{(1.07)^3} + \\frac{50}{(1.07)^5} $$\n$$ PVC = 60 + 56.074766\\dots + 78.609486\\dots + 73.466809\\dots + 35.649530\\dots $$\n$$ PVC \\approx 303.800591 \\text{ 百万美元} $$\n\n**第二部分：残值流入的现值 (PVSV)**\n\n每项资产的残值是其在规划期末 $T=7$ 时的未折旧账面价值。折旧采用直线法，从投产开始计算。\n资产 $\\mathcal{I}$ 的总资本成本为 $C_{\\mathcal{I}}$。其经济寿命为 $L_{\\mathcal{I}}$，在第 $t_{c, \\mathcal{I}}$ 年投产。到第 $T$ 年末，该资产已投入使用并进行折旧的年数为 $T - t_{c, \\mathcal{I}}$。\n残值 $SV_{\\mathcal{I},T}$ 是剩余账面价值，计算公式为：\n$$ SV_{\\mathcal{I},T} = C_{\\mathcal{I}} \\times \\frac{\\text{Remaining Life}}{\\text{Economic Life}} = C_{\\mathcal{I}} \\times \\frac{L_{\\mathcal{I}} - (T - t_{c, \\mathcal{I}})}{L_{\\mathcal{I}}} $$\n\n- **资产 $\\mathcal{A}$：**\n  - 总资本成本：$C_{\\mathcal{A}} = 60 + 60 = 120$ 百万。\n  - 经济寿命：$L_{\\mathcal{A}} = 10$ 年。\n  - 投产：$t_{c, \\mathcal{A}} = 1$。\n  - 到 $T=7$ 时已使用年限：$7 - 1 = 6$ 年。\n  - 在 $t=7$ 时的残值：$SV_{\\mathcal{A},7} = 120 \\times \\frac{10 - 6}{10} = 120 \\times \\frac{4}{10} = 48$ 百万。\n\n- **资产 $\\mathcal{B}$：**\n  - 总资本成本：$C_{\\mathcal{B}} = 90 + 90 = 180$ 百万。\n  - 经济寿命：$L_{\\mathcal{B}} = 25$ 年。\n  - 投产：$t_{c, \\mathcal{B}} = 3$。\n  - 到 $T=7$ 时已使用年限：$7 - 3 = 4$ 年。\n  - 在 $t=7$ 时的残值：$SV_{\\mathcal{B},7} = 180 \\times \\frac{25 - 4}{25} = 180 \\times \\frac{21}{25} = 151.2$ 百万。\n\n- **资产 $\\mathcal{C}$：**\n  - 总资本成本：$C_{\\mathcal{C}} = 50$ 百万。\n  - 经济寿命：$L_{\\mathcal{C}} = 40$ 年。\n  - 投产：$t_{c, \\mathcal{C}} = 5$。\n  - 到 $T=7$ 时已使用年限：$7 - 5 = 2$ 年。\n  - 在 $t=7$ 时的残值：$SV_{\\mathcal{C},7} = 50 \\times \\frac{40 - 2}{40} = 50 \\times \\frac{38}{40} = 47.5$ 百万。\n\n在 $t=7$ 时的总残值是个体残值的总和，被视为在 $t=7$ 时的一笔现金流入。\n$$ SV_7 = SV_{\\mathcal{A},7} + SV_{\\mathcal{B},7} + SV_{\\mathcal{C},7} = 48 + 151.2 + 47.5 = 246.7 \\text{ 百万} $$\n该残值流入的现值 (PVSV) 为：\n$$ PVSV = \\frac{SV_7}{(1+r)^7} = \\frac{246.7}{(1.07)^7} $$\n$$ PVSV \\approx \\frac{246.7}{1.605781} \\approx 153.630560 \\text{ 百万美元} $$\n\n**第三部分：最终净现成本 (NPC)**\n\nNPC 是成本的现值与残值流入的现值之差。\n$$ NPC = PVC - PVSV $$\n$$ NPC \\approx 303.800591 - 153.630560 = 150.170031 \\text{ 百万美元} $$\n问题要求最终答案四舍五入至四位有效数字。\n$$ NPC \\approx 150.2 \\text{ 百万美元} $$",
            "answer": "$$\\boxed{150.2}$$"
        },
        {
            "introduction": "一个稳健的容量扩张模型必须准确反映电力系统的运行现实。本实践提供了制定和求解单周期经济调度问题的动手经验，这是更大型模型中的一个关键子问题 。通过在物理约束下优化发电和储能调度，您将更深入地理解系统运行成本是如何决定的。",
            "id": "4074220",
            "problem": "单周期调度计算是能源系统建模中容量扩张问题公式化的一个基础子问题。该计算必须满足能量守恒和运行约束。考虑一个包含 $2$ 种火电技术、一种具有外生可用性的可变可再生能源技术以及一种电化学储能资产的系统。时间索引为单个时间片，时长为 $\\Delta t = 1$ 小时。决策是计算火电技术的可行调度、可再生能源可用性的削减以及实现的储能行为，这些行为应尽可能接近指定的储能行为，同时满足容量限制、爬坡限制以及储能的能量和功率限制。\n\n基本依据：\n- 能量守恒要求，在一个时间片内，计入削减、储能充电和放电以及任何未服务能源缺口后，总供给等于总需求。设 $D$ 为需求（单位：MW），$\\{g_i\\}_{i=1}^2$ 为火电调度（单位：MW），$R$ 为可再生能源可用性（单位：MW），$c$ 为可再生能源削减（单位：MW），$p^{\\mathrm{ch}}$ 为储能充电功率（单位：MW），$p^{\\mathrm{dis}}$ 为储能放电功率（单位：MW），$u$ 为非负的未服务能源缺口（单位：MW）。平衡方程为：\n$$\ng_1 + g_2 + R - c + p^{\\mathrm{dis}} - p^{\\mathrm{ch}} + u = D.\n$$\n- 火电技术容量限制：对于每种火电技术 $i \\in \\{1,2\\}$，其调度必须满足\n$$\n0 \\le g_i \\le \\overline{G}_i,\n$$\n其中 $\\overline{G}_i$ 是额定容量（单位：MW）。\n- 火电技术爬坡限制：给定上一时期的调度 $g_i^{\\mathrm{prev}}$（单位：MW）、向上爬坡限制 $\\overline{R}_i^{\\mathrm{up}}$（单位：MW）和向下爬坡限制 $\\overline{R}_i^{\\mathrm{down}}$（单位：MW），当前调度必须满足\n$$\ng_i \\le g_i^{\\mathrm{prev}} + \\overline{R}_i^{\\mathrm{up}}, \\quad g_i \\ge g_i^{\\mathrm{prev}} - \\overline{R}_i^{\\mathrm{down}}.\n$$\n- 可再生能源削减限制：削减量必须满足\n$$\n0 \\le c \\le R.\n$$\n- 储能功率限制：充电和放电必须满足\n$$\n0 \\le p^{\\mathrm{ch}} \\le \\overline{P}, \\quad 0 \\le p^{\\mathrm{dis}} \\le \\overline{P},\n$$\n其中 $\\overline{P}$ 是储能功率容量（单位：MW）。\n- 储能能量限制：设荷电状态 (SoC) 为 $E$（单位：MWh）。给定 $E^{\\mathrm{prev}}$（单位：MWh）、充电效率 $\\eta^{\\mathrm{ch}} \\in (0,1]$、放电效率 $\\eta^{\\mathrm{dis}} \\in (0,1]$ 以及能量界限 $\\underline{E}$ 和 $\\overline{E}$（单位：MWh），下一个 SoC 为\n$$\nE^{\\mathrm{new}} = E^{\\mathrm{prev}} + \\eta^{\\mathrm{ch}} p^{\\mathrm{ch}} \\Delta t - \\frac{1}{\\eta^{\\mathrm{dis}}} p^{\\mathrm{dis}} \\Delta t,\n$$\n且必须满足\n$$\n\\underline{E} \\le E^{\\mathrm{new}} \\le \\overline{E}.\n$$\n\n当存在多个可行调度时，为选择一个唯一解，定义一个线性目标函数，旨在最小化火电发电成本、可再生能源削减惩罚、未服务能源惩罚以及实现的储能行为与指定储能行为之间绝对偏差的加权和。设 $\\alpha_i$ 为 $g_i$ 的成本系数（无量纲权重，代表每 MWh 的货币单位，但在此仅用作数值权重），$\\pi^{\\mathrm{curt}}$ 为削减惩罚权重，$\\pi^{\\mathrm{unserved}}$ 为未服务能源惩罚权重，$\\lambda$ 为偏离指定储能行为的惩罚权重。设指定的储能行为为 $p^{\\mathrm{ch},*}$ 和 $p^{\\mathrm{dis},*}$（单位：MW）。引入非负偏差变量 $d^{\\mathrm{ch},+}, d^{\\mathrm{ch},-}, d^{\\mathrm{dis},+}, d^{\\mathrm{dis},-}$ 以强制满足\n$$\np^{\\mathrm{ch}} - p^{\\mathrm{ch},*} = d^{\\mathrm{ch},+} - d^{\\mathrm{ch},-}, \\quad p^{\\mathrm{dis}} - p^{\\mathrm{dis},*} = d^{\\mathrm{dis},+} - d^{\\mathrm{dis},-}.\n$$\n目标函数为\n$$\n\\min \\;\\; \\alpha_1 g_1 + \\alpha_2 g_2 + \\pi^{\\mathrm{curt}} c + \\pi^{\\mathrm{unserved}} u + \\lambda \\left( d^{\\mathrm{ch},+} + d^{\\mathrm{ch},-} + d^{\\mathrm{dis},+} + d^{\\mathrm{dis},-} \\right).\n$$\n\n您的任务是实现一个程序，对下文中的每个测试用例，求解上述线性优化问题，以计算一个可行的调度解决方案并报告结果。\n\n单位和输出要求：\n- 所有功率量（$g_1$、$g_2$、$c$、$u$、$p^{\\mathrm{ch}}$、$p^{\\mathrm{dis}}$）必须以 MW 为单位报告，并四舍五入到三位小数。\n- 指定储能行为的可行性检查必须以布尔值形式报告，指示 $p^{\\mathrm{ch},*}$ 和 $p^{\\mathrm{dis},*}$ 本身是否在无需调整的情况下满足储能功率和能量限制。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果必须是格式为 $[g_1,g_2,c,u,p^{\\mathrm{ch}},p^{\\mathrm{dis}},\\text{feasible\\_storage}]$ 的列表。\n\n测试套件和参数（所有量均按所示单位 MW 或 MWh；效率为无量纲小数；使用 $\\Delta t = 1$ 小时）：\n\n- 测试用例 1（理想路径，除成本排序外无约束性限制）：\n    - 需求 $D = 150$ MW，可再生能源可用性 $R = 60$ MW。\n    - 火电 1：$\\overline{G}_1 = 100$ MW，$g_1^{\\mathrm{prev}} = 50$ MW，$\\overline{R}_1^{\\mathrm{up}} = 60$ MW，$\\overline{R}_1^{\\mathrm{down}} = 60$ MW，成本 $\\alpha_1 = 30$。\n    - 火电 2：$\\overline{G}_2 = 80$ MW，$g_2^{\\mathrm{prev}} = 40$ MW，$\\overline{R}_2^{\\mathrm{up}} = 80$ MW，$\\overline{R}_2^{\\mathrm{down}} = 80$ MW，成本 $\\alpha_2 = 60$。\n    - 储能：$\\overline{P} = 50$ MW，$\\eta^{\\mathrm{ch}} = 0.95$，$\\eta^{\\mathrm{dis}} = 0.9$，$E^{\\mathrm{prev}} = 100$ MWh，$\\underline{E} = 20$ MWh，$\\overline{E} = 180$ MWh，指定的 $p^{\\mathrm{ch},*} = 0$ MW, $p^{\\mathrm{dis},*} = 20$ MW。\n- 测试用例 2（爬坡和容量限制导致未服务能源）：\n    - 需求 $D = 200$ MW，可再生能源可用性 $R = 40$ MW。\n    - 火电 1：$\\overline{G}_1 = 100$ MW，$g_1^{\\mathrm{prev}} = 10$ MW，$\\overline{R}_1^{\\mathrm{up}} = 20$ MW，$\\overline{R}_1^{\\mathrm{down}} = 10$ MW，成本 $\\alpha_1 = 30$。\n    - 火电 2：$\\overline{G}_2 = 120$ MW，$g_2^{\\mathrm{prev}} = 10$ MW，$\\overline{R}_2^{\\mathrm{up}} = 200$ MW，$\\overline{R}_2^{\\mathrm{down}} = 10$ MW，成本 $\\alpha_2 = 60$。\n    - 储能：$\\overline{P} = 50$ MW，$\\eta^{\\mathrm{ch}} = 0.95$，$\\eta^{\\mathrm{dis}} = 0.9$，$E^{\\mathrm{prev}} = 100$ MWh，$\\underline{E} = 20$ MWh，$\\overline{E} = 180$ MWh，指定的 $p^{\\mathrm{ch},*} = 0$ MW, $p^{\\mathrm{dis},*} = 0$ MW。\n- 测试用例 3（指定的储能放电超出功率容量，由优化校正）：\n    - 需求 $D = 180$ MW，可再生能源可用性 $R = 20$ MW。\n    - 火电 1：$\\overline{G}_1 = 100$ MW，$g_1^{\\mathrm{prev}} = 60$ MW，$\\overline{R}_1^{\\mathrm{up}} = 40$ MW，$\\overline{R}_1^{\\mathrm{down}} = 80$ MW，成本 $\\alpha_1 = 30$。\n    - 火电 2：$\\overline{G}_2 = 80$ MW，$g_2^{\\mathrm{prev}} = 50$ MW，$\\overline{R}_2^{\\mathrm{up}} = 50$ MW，$\\overline{R}_2^{\\mathrm{down}} = 50$ MW，成本 $\\alpha_2 = 60$。\n    - 储能：$\\overline{P} = 50$ MW，$\\eta^{\\mathrm{ch}} = 0.95$，$\\eta^{\\mathrm{dis}} = 0.9$，$E^{\\mathrm{prev}} = 150$ MWh，$\\underline{E} = 60$ MWh，$\\overline{E} = 160$ MWh，指定的 $p^{\\mathrm{ch},*} = 0$ MW, $p^{\\mathrm{dis},*} = 80$ MW。\n- 测试用例 4（指定的储能放电违反能量界限，由优化校正）：\n    - 需求 $D = 100$ MW，可再生能源可用性 $R = 50$ MW。\n    - 火电 1：$\\overline{G}_1 = 100$ MW，$g_1^{\\mathrm{prev}} = 0$ MW，$\\overline{R}_1^{\\mathrm{up}} = 50$ MW，$\\overline{R}_1^{\\mathrm{down}} = 50$ MW，成本 $\\alpha_1 = 30$。\n    - 火电 2：$\\overline{G}_2 = 80$ MW，$g_2^{\\mathrm{prev}} = 0$ MW，$\\overline{R}_2^{\\mathrm{up}} = 80$ MW，$\\overline{R}_2^{\\mathrm{down}} = 80$ MW，成本 $\\alpha_2 = 60$。\n    - 储能：$\\overline{P} = 50$ MW，$\\eta^{\\mathrm{ch}} = 0.95$，$\\eta^{\\mathrm{dis}} = 0.9$，$E^{\\mathrm{prev}} = 65$ MWh，$\\underline{E} = 60$ MWh，$\\overline{E} = 200$ MWh，指定的 $p^{\\mathrm{ch},*} = 0$ MW, $p^{\\mathrm{dis},*} = 50$ MW。\n\n目标函数的惩罚权重（所有测试用例统一使用）：\n- 削减惩罚 $\\pi^{\\mathrm{curt}} = 100$,\n- 未服务能源惩罚 $\\pi^{\\mathrm{unserved}} = 10000$,\n- 储能偏差惩罚 $\\lambda = 1$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个结果必须是列表 $[g_1,g_2,c,u,p^{\\mathrm{ch}},p^{\\mathrm{dis}},\\text{feasible\\_storage}]$，其中所有数值条目均以 MW 为单位，四舍五入到三位小数，布尔值为 True 或 False，并按顺序排列四个测试用例的结果。",
            "solution": "用户提供了一个定义明确的线性优化问题，该问题代表了能源系统建模中的单周期经济调度任务。该问题在科学上是合理的，数学上是一致的，并包含找到唯一解所需的所有必要数据。因此，该问题被认定为有效。\n\n任务是为一个包含两台火电机组、一个可变可再生能源和一个储能单元的系统，找到一个可行的、经济最优的调度方案。最优性通过最小化一个线性目标函数来定义，该函数代表发电成本、削减可再生能源的惩罚、未服务能源的惩罚以及偏离指定储能运行计划的惩罚。解决方案必须遵守一系列线性约束：能量守恒、发电机容量和爬坡限制，以及储能功率和能量限制。\n\n该问题可以被表述为一个线性规划（LP）问题，可以使用标准的优化求解器来解决。该LP的结构如下：\n\n最小化：\n$$ c^T x $$\n约束条件：\n$$ A_{eq} x = b_{eq} $$\n$$ A_{ub} x \\le b_{ub} $$\n$$ lb \\le x \\le ub $$\n\n该公式的组成部分定义如下：\n\n**1. 决策变量 ($x$)**\n决策变量向量 $x$ 包括所有待优化的量。我们将其定义为一个包含10个元素的向量：\n$$ x = [g_1, g_2, c, p^{\\mathrm{ch}}, p^{\\mathrm{dis}}, u, d^{\\mathrm{ch},+}, d^{\\mathrm{ch},-}, d^{\\mathrm{dis},+}, d^{\\mathrm{dis},-}]^T $$\n其中：\n- $g_1, g_2$：火电机组1和2的功率输出（MW）。\n- $c$：被削减的可再生能源功率（MW）。\n- $p^{\\mathrm{ch}}, p^{\\mathrm{dis}}$：储能充电和放电功率（MW）。\n- $u$：未服务能源（功率缺口松弛变量）（MW）。\n- $d^{\\mathrm{ch},+}, d^{\\mathrm{ch},-}, d^{\\mathrm{dis},+}, d^{\\mathrm{dis},-}$：储能行为的非负偏差变量（MW）。\n\n**2. 目标函数 ($c^T x$)**\n目标是最小化成本和惩罚的加权和。成本向量 $c$ 对应于目标函数中变量的系数：\n$$ \\min \\;\\; \\alpha_1 g_1 + \\alpha_2 g_2 + \\pi^{\\mathrm{curt}} c + \\pi^{\\mathrm{unserved}} u + \\lambda (d^{\\mathrm{ch},+} + d^{\\mathrm{ch},-} + d^{\\mathrm{dis},+} + d^{\\mathrm{dis},-}) $$\n因此，成本向量 $c$ 为：\n$$ c = [\\alpha_1, \\alpha_2, \\pi^{\\mathrm{curt}}, 0, 0, \\pi^{\\mathrm{unserved}}, \\lambda, \\lambda, \\lambda, \\lambda]^T $$\n\n**3. 等式约束 ($A_{eq} x = b_{eq}$)**\n存在三个等式约束：\n- **能量平衡：**总发电量必须等于总消耗量。\n  $$ g_1 + g_2 - c - p^{\\mathrm{ch}} + p^{\\mathrm{dis}} + u = D - R $$\n- **储能充电偏差：**这定义了实际充电量、目标充电量和偏差变量之间的关系。\n  $$ p^{\\mathrm{ch}} - d^{\\mathrm{ch},+} + d^{\\mathrm{ch},-} = p^{\\mathrm{ch},*} $$\n- **储能放电偏差：**放电情况类似。\n  $$ p^{\\mathrm{dis}} - d^{\\mathrm{dis},+} + d^{\\mathrm{dis},-} = p^{\\mathrm{dis},*} $$\n这三个方程构成了 $A_{eq}$ 矩阵的行和 $b_{eq}$ 向量的元素。\n\n**4. 不等式约束 ($A_{ub} x \\le b_{ub}$)**\n储能的荷电状态（SoC）必须保持在其能量界限内。当 $\\Delta t = 1$ 小时：\n$$ \\underline{E} \\le E^{\\mathrm{prev}} + \\eta^{\\mathrm{ch}} p^{\\mathrm{ch}} - \\frac{1}{\\eta^{\\mathrm{dis}}} p^{\\mathrm{dis}} \\le \\overline{E} $$\n这产生了两个线性不等式约束：\n- $\\eta^{\\mathrm{ch}} p^{\\mathrm{ch}} - \\frac{1}{\\eta^{\\mathrm{dis}}} p^{\\mathrm{dis}} \\le \\overline{E} - E^{\\mathrm{prev}}$\n- $-\\eta^{\\mathrm{ch}} p^{\\mathrm{ch}} + \\frac{1}{\\eta^{\\mathrm{dis}}} p^{\\mathrm{dis}} \\le E^{\\mathrm{prev}} - \\underline{E}$\n这两个不等式构成了 $A_{ub}$ 矩阵的行和 $b_{ub}$ 向量的元素。\n\n**5. 变量边界 ($lb \\le x \\le ub$)**\n所有其他约束都表示为对决策变量的简单边界：\n- **火电发电：**每个发电机 $i$ 的调度受其最小出力（0）、最大容量 $\\overline{G}_i$ 及其爬坡率限制。\n  $$ \\max(0, g_i^{\\mathrm{prev}} - \\overline{R}_i^{\\mathrm{down}}) \\le g_i \\le \\min(\\overline{G}_i, g_i^{\\mathrm{prev}} + \\overline{R}_i^{\\mathrm{up}}) $$\n- **可再生能源削减：**削减量不能为负，也不能超过可用的可再生能源发电量 $R$。\n  $$ 0 \\le c \\le R $$\n- **储能功率：**充电和放电受储能功率容量 $\\overline{P}$ 的限制。\n  $$ 0 \\le p^{\\mathrm{ch}} \\le \\overline{P} $$\n  $$ 0 \\le p^{\\mathrm{dis}} \\le \\overline{P} $$\n- **非负性：**未服务能源和所有偏差变量必须为非负。\n  $$ u, d^{\\mathrm{ch},+}, d^{\\mathrm{ch},-}, d^{\\mathrm{dis},+}, d^{\\mathrm{dis},-} \\ge 0 $$\n\n该解决方案使用 `scipy.optimize.linprog` 函数在 Python 中实现，该函数专为解决此类 LP 问题而设计。对于每个测试用例，我们首先执行初步检查，以确定指定的储能行为（$p^{\\mathrm{ch},*}, p^{\\mathrm{dis},*}$）本身是否可行。然后，使用测试用例的特定参数构建 LP 模型并求解，以找到最优的调度值。最终结果按照要求进行四舍五入和格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the single-period dispatch optimization problem for a series of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"D\": 150, \"R\": 60,\n            \"g1_params\": {\"G_bar\": 100, \"g_prev\": 50, \"R_up\": 60, \"R_down\": 60, \"alpha\": 30},\n            \"g2_params\": {\"G_bar\": 80, \"g_prev\": 40, \"R_up\": 80, \"R_down\": 80, \"alpha\": 60},\n            \"storage_params\": {\"P_bar\": 50, \"eta_ch\": 0.95, \"eta_dis\": 0.9, \"E_prev\": 100, \"E_underline\": 20, \"E_bar\": 180, \"p_ch_star\": 0, \"p_dis_star\": 20},\n        },\n        # Test case 2\n        {\n            \"D\": 200, \"R\": 40,\n            \"g1_params\": {\"G_bar\": 100, \"g_prev\": 10, \"R_up\": 20, \"R_down\": 10, \"alpha\": 30},\n            \"g2_params\": {\"G_bar\": 120, \"g_prev\": 10, \"R_up\": 200, \"R_down\": 10, \"alpha\": 60},\n            \"storage_params\": {\"P_bar\": 50, \"eta_ch\": 0.95, \"eta_dis\": 0.9, \"E_prev\": 100, \"E_underline\": 20, \"E_bar\": 180, \"p_ch_star\": 0, \"p_dis_star\": 0},\n        },\n        # Test case 3\n        {\n            \"D\": 180, \"R\": 20,\n            \"g1_params\": {\"G_bar\": 100, \"g_prev\": 60, \"R_up\": 40, \"R_down\": 80, \"alpha\": 30},\n            \"g2_params\": {\"G_bar\": 80, \"g_prev\": 50, \"R_up\": 50, \"R_down\": 50, \"alpha\": 60},\n            \"storage_params\": {\"P_bar\": 50, \"eta_ch\": 0.95, \"eta_dis\": 0.9, \"E_prev\": 150, \"E_underline\": 60, \"E_bar\": 160, \"p_ch_star\": 0, \"p_dis_star\": 80},\n        },\n        # Test case 4\n        {\n            \"D\": 100, \"R\": 50,\n            \"g1_params\": {\"G_bar\": 100, \"g_prev\": 0, \"R_up\": 50, \"R_down\": 50, \"alpha\": 30},\n            \"g2_params\": {\"G_bar\": 80, \"g_prev\": 0, \"R_up\": 80, \"R_down\": 80, \"alpha\": 60},\n            \"storage_params\": {\"P_bar\": 50, \"eta_ch\": 0.95, \"eta_dis\": 0.9, \"E_prev\": 65, \"E_underline\": 60, \"E_bar\": 200, \"p_ch_star\": 0, \"p_dis_star\": 50},\n        }\n    ]\n    \n    # Uniform penalty weights\n    pi_curt = 100\n    pi_unserved = 10000\n    L = 1 # lambda\n\n    results = []\n    \n    for case in test_cases:\n        D, R = case[\"D\"], case[\"R\"]\n        g1p, g2p, sp = case[\"g1_params\"], case[\"g2_params\"], case[\"storage_params\"]\n        \n        # 1. Feasibility check for specified storage actions\n        E_new_star = sp[\"E_prev\"] + sp[\"eta_ch\"] * sp[\"p_ch_star\"] * 1.0 - (1/sp[\"eta_dis\"]) * sp[\"p_dis_star\"] * 1.0\n        feasible_storage = (0 = sp[\"p_ch_star\"] = sp[\"P_bar\"] and\n                            0 = sp[\"p_dis_star\"] = sp[\"P_bar\"] and\n                            sp[\"E_underline\"] = E_new_star = sp[\"E_bar\"])\n        \n        # 2. Define LP problem\n        # Decision variables: x = [g1, g2, c, pch, pdis, u, d_ch+, d_ch-, d_dis+, d_dis-]\n        c_vec = np.array([g1p[\"alpha\"], g2p[\"alpha\"], pi_curt, 0, 0, pi_unserved, L, L, L, L])\n        \n        # Equality constraints\n        A_eq = np.array([\n            [1, 1, -1, -1, 1, 1, 0, 0, 0, 0],  # Energy balance\n            [0, 0, 0, 1, 0, 0, -1, 1, 0, 0],  # Charge deviation\n            [0, 0, 0, 0, 1, 0, 0, 0, -1, 1],  # Discharge deviation\n        ])\n        b_eq = np.array([\n            D - R,\n            sp[\"p_ch_star\"],\n            sp[\"p_dis_star\"]\n        ])\n        \n        # Inequality constraints\n        A_ub = np.array([\n            [0, 0, 0, sp[\"eta_ch\"], -1/sp[\"eta_dis\"], 0, 0, 0, 0, 0], # E_new = E_bar\n            [0, 0, 0, -sp[\"eta_ch\"], 1/sp[\"eta_dis\"], 0, 0, 0, 0, 0], # E_new = E_underline\n        ])\n        b_ub = np.array([\n            sp[\"E_bar\"] - sp[\"E_prev\"],\n            sp[\"E_prev\"] - sp[\"E_underline\"]\n        ])\n\n        # Variable bounds\n        g1_lb = max(0, g1p[\"g_prev\"] - g1p[\"R_down\"])\n        g1_ub = min(g1p[\"G_bar\"], g1p[\"g_prev\"] + g1p[\"R_up\"])\n        \n        g2_lb = max(0, g2p[\"g_prev\"] - g2p[\"R_down\"])\n        g2_ub = min(g2p[\"G_bar\"], g2p[\"g_prev\"] + g2p[\"R_up\"])\n        \n        bounds = [\n            (g1_lb, g1_ub), (g2_lb, g2_ub), (0, R), \n            (0, sp[\"P_bar\"]), (0, sp[\"P_bar\"]), (0, None),\n            (0, None), (0, None), (0, None), (0, None)\n        ]\n        \n        # 3. Solve the LP\n        res = linprog(c_vec, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n        # 4. Extract, round, and store results\n        if res.success:\n            g1, g2, c_val, p_ch, p_dis, u_val = res.x[:6]\n            \n            result_list = [\n                round(g1, 3), round(g2, 3), round(c_val, 3), \n                round(u_val, 3), round(p_ch, 3), round(p_dis, 3),\n                feasible_storage\n            ]\n            results.append(result_list)\n        else:\n            # Append an error marker if solver fails, though it shouldn't for these problems.\n            results.append([\"Solver failed\"] * 7)\n            \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "容量扩张模型是探索能源和气候政策影响的强大工具。在本练习中，您将构建一个简化的规划模型，以生成总系统成本与碳排放之间的权衡曲线 。这将展示此类模型如何量化脱碳目标的经济影响，并帮助决策者在复杂的政策选择中进行权衡。",
            "id": "4074212",
            "problem": "你需要为一个包含两种技术的简化电力系统制定并解决一个容量扩展问题。目标是通过改变排放上限或碳价格，计算总系统成本与总排放量之间的权衡曲线。该问题必须从第一性原理出发进行公式化，并作为线性规划问题，通过算法求解曲线上的每个点。所有物理单位必须明确遵守，所有输出必须以指定单位报告，并四舍五入到两位小数。\n\n基本前提和建模假设：\n- 一个单区域电力系统，年能源需求为 $E$ 兆瓦时/年 (MWh/year)。\n- 两种发电技术，索引为 $i \\in \\{\\text{F}, \\text{R}\\}$，分别代表化石燃料技术 ($\\text{F}$) 和可再生能源技术 ($\\text{R}$)。\n- 决策变量：装机容量 $k_i$（单位：兆瓦，MW）和年发电量 $g_i$（单位：兆瓦时，MWh）。\n- 年小时数 $H = 8760$ 小时/年。\n- 每种技术 $i$ 的容量因子 $0 \\leq \\text{CF}_i \\leq 1$，通过 $g_i \\leq \\text{CF}_i \\cdot H \\cdot k_i$ 将容量与最大年发电量关联起来。\n- 年化容量成本 $c_i^{\\text{cap}}$（单位：美元/兆瓦·年，$\\$/\\text{MW-year}$）和可变运营成本 $c_i^{\\text{var}}$（单位：美元/兆瓦时，$\\$/\\text{MWh}$）。\n- 排放强度 $e_i$（单位：公吨二氧化碳/兆瓦时，$\\text{tCO}_2/\\text{MWh}$）。\n- 负荷平衡：$\\sum_i g_i = E$。\n- 非负性：$k_i \\geq 0$, $g_i \\geq 0$。\n\n必须重复解决两个问题变体以描绘权衡曲线：\n1. 排放上限公式：最小化年系统总成本，同时满足年总排放量的上限，\n$$\n\\min_{k_i,g_i} \\sum_i \\left( c_i^{\\text{cap}} k_i + c_i^{\\text{var}} g_i \\right) \\quad \\text{subject to} \\quad \\sum_i g_i = E, \\; g_i \\leq \\text{CF}_i H k_i, \\; \\sum_i e_i g_i \\leq \\text{Cap}, \\; k_i,g_i \\geq 0,\n$$\n其中 $\\text{Cap}$ 是排放上限，单位为 $\\text{tCO}_2/\\text{year}$。\n2. 碳价格公式：最小化包含碳定价的年社会总成本，\n$$\n\\min_{k_i,g_i} \\sum_i \\left( c_i^{\\text{cap}} k_i + c_i^{\\text{var}} g_i \\right) + \\tau \\sum_i e_i g_i \\quad \\text{subject to} \\quad \\sum_i g_i = E, \\; g_i \\leq \\text{CF}_i H k_i, \\; k_i,g_i \\geq 0,\n$$\n其中 $\\tau$ 是碳价格，单位为美元/公吨二氧化碳 ($\\$/\\text{tCO}_2$)。\n\n对于每个问题实例，必须首先计算无约束的最低成本解决方案（无排放上限且碳价格为零），以确定相应的无约束排放水平，记为 $E_{\\text{unc}}$，单位为 $\\text{tCO}_2/\\text{year}$。然后，对于排放上限公式，为在 $0$ 和 $E_{\\text{unc}}$ 之间（含两端）线性间隔的一系列上限值计算最优解。对于碳价格公式，为一组指定的碳价格计算最优解。对于每个解，记录由总排放量和年系统总成本组成的配对。\n\n单位和输出要求：\n- 排放量必须以公吨二氧化碳/年 ($\\text{tCO}_2/\\text{year}$) 报告。\n- 成本必须以美元/年 ($\\$/\\text{year}$) 报告。\n- 碳价格必须以美元/公吨二氧化碳 ($\\$/\\text{tCO}_2$) 表示。\n- 所有数值输出必须四舍五入到两位小数。\n\n测试套件：\n为以下三个测试用例计算权衡曲线。在每个用例中，首先计算 $E_{\\text{unc}}$，然后：\n- 排放上限扫描：在 $0$ 和 $E_{\\text{unc}}$ 之间（含两端）均匀间隔的 $6$ 个上限值。\n- 碳价格扫描：价格 $\\tau \\in \\{0,\\;25,\\;50,\\;100,\\;200,\\;400\\}$，单位为 $\\$/\\text{tCO}_2$。\n\n通用常数：$H=8760$ 小时/年。\n\n测试用例 1 (理想情况)：\n- 需求 $E = 5{,}000{,}000$ MWh/年。\n- 化石燃料技术 ($\\text{F}$): $c_{\\text{F}}^{\\text{cap}} = 100{,}000$ $\\$/\\text{MW-year}$，$c_{\\text{F}}^{\\text{var}} = 20$ $\\$/\\text{MWh}$，$\\text{CF}_{\\text{F}} = 0.9$，$e_{\\text{F}} = 0.6$ $\\text{tCO}_2/\\text{MWh}$。\n- 可再生能源技术 ($\\text{R}$): $c_{\\text{R}}^{\\text{cap}} = 150{,}000$ $\\$/\\text{MW-year}$，$c_{\\text{R}}^{\\text{var}} = 5$ $\\$/\\text{MWh}$，$\\text{CF}_{\\text{R}} = 0.4$，$e_{\\text{R}} = 0$ $\\text{tCO}_2/\\text{MWh}$。\n\n测试用例 2 (通过降低容量因子实现更高的可再生能源资本密集度)：\n- 需求 $E = 2{,}000{,}000$ MWh/年。\n- 化石燃料技术 ($\\text{F}$): $c_{\\text{F}}^{\\text{cap}} = 100{,}000$ $\\$/\\text{MW-year}$，$c_{\\text{F}}^{\\text{var}} = 20$ $\\$/\\text{MWh}$，$\\text{CF}_{\\text{F}} = 0.9$，$e_{\\text{F}} = 0.6$ $\\text{tCO}_2/\\text{MWh}$。\n- 可再生能源技术 ($\\text{R}$): $c_{\\text{R}}^{\\text{cap}} = 180{,}000$ $\\$/\\text{MW-year}$，$c_{\\text{R}}^{\\text{var}} = 5$ $\\$/\\text{MWh}$，$\\text{CF}_{\\text{R}} = 0.25$，$e_{\\text{R}} = 0$ $\\text{tCO}_2/\\text{MWh}$。\n\n测试用例 3 (边界情况：零需求)：\n- 需求 $E = 0$ MWh/年。\n- 化石燃料技术 ($\\text{F}$): $c_{\\text{F}}^{\\text{cap}} = 100{,}000$ $\\$/\\text{MW-year}$，$c_{\\text{F}}^{\\text{var}} = 20$ $\\$/\\text{MWh}$，$\\text{CF}_{\\text{F}} = 0.9$，$e_{\\text{F}} = 0.6$ $\\text{tCO}_2/\\text{MWh}$。\n- 可再生能源技术 ($\\text{R}$): $c_{\\text{R}}^{\\text{cap}} = 150{,}000$ $\\$/\\text{MW-year}$，$c_{\\text{R}}^{\\text{var}} = 5$ $\\$/\\text{MWh}$，$\\text{CF}_{\\text{R}} = 0.4$，$e_{\\text{R}} = 0$ $\\text{tCO}_2/\\text{MWh}$。\n\n要求的最终输出格式：\n- 你的程序应生成单行输出，其中包含每个测试用例的两条列表：排放上限权衡曲线和碳价格权衡曲线。每条曲线必须是一个配对列表，每个配对表示为 $[\\text{emissions}, \\text{cost}]$，其中排放量单位为 $\\text{tCO}_2/\\text{year}$，成本单位为 $\\$/\\text{year}$，两者均四舍五入到两位小数。\n- 因此，总输出必须是一个包含三个元素（每个测试用例一个）的列表，其中每个元素是一个包含两个元素的列表：第一个是上限扫描曲线，第二个是价格扫描曲线。例如：$[[[e_{11},c_{11}],[e_{12},c_{12}],\\dots],[[e'_{11},c'_{11}],[e'_{12},c'_{12}],\\dots]], \\dots ]$。",
            "solution": "用户问题已通过验证，并被确定为一个有效、适定的科学问题。\n\n### **1. 从第一性原理出发构建问题**\n\n该问题要求在满足各种约束条件下，找到满足电力需求 $E$ 的最低成本技术组合。决策变量是两种技术——化石燃料 ($\\text{F}$) 和可再生能源 ($\\text{R}$) 的装机容量 $k_i$ [MW] 和年发电量 $g_i$ [MWh]。\n\n要最小化的目标函数是年系统总成本，即年化资本成本和可变运营成本之和：\n$$\n\\text{Cost} = \\sum_{i \\in \\{\\text{F,R}\\}} \\left( c_i^{\\text{cap}} k_i + c_i^{\\text{var}} g_i \\right)\n$$\n其中 $c_i^{\\text{cap}}$ 的单位是 [$\\$/\\text{MW-year}$]，$c_i^{\\text{var}}$ 的单位是 [$\\$/\\text{MWh}$]。\n\n约束条件如下：\n1.  **负荷平衡**：总发电量必须满足年需求 $E$。\n    $$ \\sum_i g_i = g_{\\text{F}} + g_{\\text{R}} = E $$\n2.  **容量约束**：一种技术的年发电量受其装机容量 $k_i$ 和容量因子 $\\text{CF}_i$ 的限制。一年有 $H=8760$ 小时，因此：\n    $$ g_i \\leq \\text{CF}_i \\cdot H \\cdot k_i \\quad \\text{for } i \\in \\{\\text{F,R}\\} $$\n3.  **非负性**：所有容量和发电量必须为非负。\n    $$ k_i \\geq 0, \\quad g_i \\geq 0 $$\n\n由于资本成本 $c_i^{\\text{cap}}$ 是非负的，成本最小化的解决方案绝不会建设超过必要容量的装机。因此，容量约束可以被视为所需容量的等式：$k_i = g_i / (\\text{CF}_i \\cdot H)$。我们可以将 $k_i$ 的这个表达式代入目标函数中以消除容量变量：\n$$\n\\text{Cost} = \\sum_i \\left( c_i^{\\text{cap}} \\frac{g_i}{\\text{CF}_i \\cdot H} + c_i^{\\text{var}} g_i \\right) = \\sum_i g_i \\left( c_i^{\\text{var}} + \\frac{c_i^{\\text{cap}}}{\\text{CF}_i \\cdot H} \\right)\n$$\n这使我们能够为每种技术定义一个*有效平准化发电成本*，$C_i^{\\text{eff}}$，单位为 [$\\$/\\text{MWh}$]：\n$$\nC_i^{\\text{eff}} \\equiv c_i^{\\text{var}} + \\frac{c_i^{\\text{cap}}}{\\text{CF}_i \\cdot H}\n$$\n现在，优化问题简化为选择发电量 $g_F$ 和 $g_R$ 以最小化总有效成本，同时需满足负荷平衡和任何额外的政策约束：\n$$\n\\min_{g_F, g_R} \\left( C_{\\text{F}}^{\\text{eff}} g_{\\text{F}} + C_{\\text{R}}^{\\text{eff}} g_{\\text{R}} \\right) \\quad \\text{s.t.} \\quad g_{\\text{F}} + g_{\\text{R}} = E, \\quad g_{\\text{F}}, g_{\\text{R}} \\geq 0\n$$\n\n### **2. 求解优化变体**\n\n#### **无约束的最低成本解**\n在没有任何排放政策的情况下，最优策略是使用有效成本 $C_i^{\\text{eff}}$ 较低的技术来满足全部需求 $E$。\n- 如果 $C_{\\text{F}}^{\\text{eff}}  C_{\\text{R}}^{\\text{eff}}$，最优解为 $g_{\\text{F}} = E$ 和 $g_{\\text{R}} = 0$。\n- 如果 $C_{\\text{R}}^{\\text{eff}} \\leq C_{\\text{F}}^{\\text{eff}}$，最优解为 $g_{\\text{R}} = E$ 和 $g_{\\text{F}} = 0$。（如果成本相同，则选择更清洁的技术。）\n\n总系统成本为 $C_{\\text{unc}} = C_{\\text{F}}^{\\text{eff}} g_{\\text{F}} + C_{\\text{R}}^{\\text{eff}} g_{\\text{R}}$，总无约束排放量为 $E_{\\text{unc}} = e_{\\text{F}} g_{\\text{F}} + e_{\\text{R}} g_{\\text{R}}$。\n\n#### **排放上限公式**\n增加一个额外约束：\n$$ \\sum_i e_i g_i = e_{\\text{F}} g_{\\text{F}} + e_{\\text{R}} g_{\\text{R}} \\leq \\text{Cap} $$\n鉴于所有测试用例中 $e_{\\text{R}} = 0$，该约束简化为 $e_{\\text{F}} g_{\\text{F}} \\leq \\text{Cap}$，这意味着对化石燃料发电量有上限：$g_{\\text{F}} \\leq \\text{Cap}/e_{\\text{F}}$。\n关于 $g_F$ 的优化问题是：\n$$\n\\min_{g_F} \\left( (C_{\\text{F}}^{\\text{eff}} - C_{\\text{R}}^{\\text{eff}}) g_{\\text{F}} + C_{\\text{R}}^{\\text{eff}}E \\right) \\quad \\text{s.t.} \\quad 0 \\leq g_{\\text{F}} \\leq E \\quad \\text{and} \\quad g_{\\text{F}} \\leq \\frac{\\text{Cap}}{e_{\\text{F}}}\n$$\n解取决于相对成本：\n- 如果 $C_{\\text{F}}^{\\text{eff}}  C_{\\text{R}}^{\\text{eff}}$，项 $(C_{\\text{F}}^{\\text{eff}} - C_{\\text{R}}^{\\text{eff}})$ 为负。为最小化成本，我们必须最大化 $g_{\\text{F}}$。因此，最优值为 $g_{\\text{F}} = \\min(E, \\text{Cap}/e_{\\text{F}})$。\n- 如果 $C_{\\text{R}}^{\\text{eff}} \\leq C_{\\text{F}}^{\\text{eff}}$，该项为非负。为最小化成本，我们必须最小化 $g_{\\text{F}}$。最优值为 $g_{\\text{F}} = 0$。对于任何非负的上限，此解总是可行的，因为排放量将为 $0$。\n\n一旦确定了 $g_{\\text{F}}$，$g_{\\text{R}} = E - g_{\\text{F}}$。然后计算总成本和排放量。\n\n#### **碳价格公式**\n目标函数被修改以包含排放成本，其中 $\\tau$ 是碳价格 [$\\$/\\text{tCO}_2$]：\n$$\n\\min \\sum_i \\left( c_i^{\\text{cap}} k_i + c_i^{\\text{var}} g_i \\right) + \\tau \\sum_i e_i g_i = \\min \\sum_i g_i \\left( C_i^{\\text{eff}} + \\tau e_i \\right)\n$$\n我们定义一个*碳调整后的有效成本* $\\tilde{C}_i^{\\text{eff}}(\\tau) = C_i^{\\text{eff}} + \\tau e_i$。问题便等同于无约束情况，但需比较 $\\tilde{C}_{\\text{F}}^{\\text{eff}}(\\tau)$ 和 $\\tilde{C}_{\\text{R}}^{\\text{eff}}(\\tau)$。\n$$\n\\tilde{C}_{\\text{F}}^{\\text{eff}}(\\tau) = C_{\\text{F}}^{\\text{eff}} + \\tau e_{\\text{F}} \\quad \\text{and} \\quad \\tilde{C}_{\\text{R}}^{\\text{eff}}(\\tau) = C_{\\text{R}}^{\\text{eff}} + \\tau e_{\\text{R}} = C_{\\text{R}}^{\\text{eff}} \\quad (\\text{因为 } e_{\\text{R}}=0)\n$$\n如果 $\\tilde{C}_{\\text{F}}^{\\text{eff}}(\\tau)  \\tilde{C}_{\\text{R}}^{\\text{eff}}(\\tau)$，即 $C_{\\text{F}}^{\\text{eff}} + \\tau e_{\\text{F}}  C_{\\text{R}}^{\\text{eff}}$，则化石燃料技术更便宜。这个不等式定义了一个盈亏平衡或*转换价格*，$\\tau_{\\text{switch}}$：\n$$\n\\tau_{\\text{switch}} = \\frac{C_{\\text{R}}^{\\text{eff}} - C_{\\text{F}}^{\\text{eff}}}{e_{\\text{F}}}\n$$\n- 如果无约束的化石燃料选项更便宜 ($C_{\\text{F}}^{\\text{eff}}  C_{\\text{R}}^{\\text{eff}}$)，那么 $\\tau_{\\text{switch}} > 0$。对于任何给定的价格 $\\tau$：\n    - 如果 $\\tau  \\tau_{\\text{switch}}$，化石燃料总体上仍然更便宜，所以 $g_{\\text{F}} = E, g_{\\text{R}} = 0$。\n    - 如果 $\\tau \\geq \\tau_{\\text{switch}}$，可再生能源变得具有成本竞争力或更便宜，所以 $g_{\\text{F}} = 0, g_{\\text{R}} = E$。\n- 如果无约束的可再生能源选项更便宜或成本相等 ($C_{\\text{R}}^{\\text{eff}} \\leq C_{\\text{F}}^{\\text{eff}}$)，那么 $\\tau_{\\text{switch}} \\leq 0$。对于任何非负价格 $\\tau$，可再生能源始终是更便宜的选项，所以 $g_{\\text{F}} = 0, g_{\\text{R}} = E$。\n\n对于每个点，我们报告*系统成本* $\\sum_i C_i^{\\text{eff}} g_i$ 和排放量 $\\sum_i e_i g_i$。碳税部分 $\\tau \\sum_i e_i g_i$ 是决策目标函数的一部分，但不包括在最终报告的系统成本中。\n\n### **3. 算法实现**\n\n对于每个测试用例，算法按以下步骤进行：\n1.  计算 $C_{\\text{F}}^{\\text{eff}}$ 和 $C_{\\text{R}}^{\\text{eff}}$。\n2.  解决无约束情况，找到发电组合和无约束排放水平 $E_{\\text{unc}}$。\n3.  **排放上限扫描**：\n    - 生成一个从 $0$ 到 $E_{\\text{unc}}$ 的包含 $6$ 个排放上限的数组。\n    - 对于每个 `Cap`，使用推导出的逻辑计算最优的 $g_{\\text{F}}$ 和 $g_{\\text{R}}$。\n    - 计算并存储最终的系统成本和排放量。\n4.  **碳价格扫描**：\n    - 计算 $\\tau_{\\text{switch}}$。\n    - 对于每个给定的碳价格 `tau`，将其与 $\\tau_{\\text{switch}}$ 进行比较，以确定最优的 $g_{\\text{F}}$ 和 $g_{\\text{R}}$。\n    - 计算并存储最终的系统成本和排放量。\n5.  所有成本和排放量的数值结果均四舍五入到两位小数进行报告。\n6. 使用一个特殊的格式化函数将嵌套列表结构转换为所需的无空格字符串格式。",
            "answer": "```python\nimport numpy as np\n\ndef format_list(l):\n    \"\"\"\n    Recursively formats a nested list into a string representation\n    without spaces, with floats formatted to two decimal places.\n    \"\"\"\n    if isinstance(l, (int, float)):\n        return f\"{l:.2f}\"\n    if isinstance(l, list):\n        return f\"[{','.join(format_list(item) for item in l)}]\"\n    return str(l)\n\ndef solve_case(params):\n    \"\"\"\n    Solves a single capacity expansion problem instance for both sweeps.\n    \"\"\"\n    E, c_F_cap, c_F_var, CF_F, e_F, c_R_cap, c_R_var, CF_R, e_R, caps_n, prices = params\n    H = 8760.0\n\n    # Handle the zero-demand boundary case\n    if E == 0:\n        zero_point = [0.00, 0.00]\n        cap_curve = [zero_point] * caps_n\n        price_curve = [zero_point] * len(prices)\n        return [cap_curve, price_curve]\n\n    # Calculate effective levelized costs ($/MWh)\n    # C_eff = c_var + c_cap / (CF * H)\n    C_F_eff = c_F_var + c_F_cap / (CF_F * H) if CF_F  0 else float('inf')\n    C_R_eff = c_R_var + c_R_cap / (CF_R * H) if CF_R  0 else float('inf')\n\n    # Unconstrained solution to find E_unc\n    if C_F_eff  C_R_eff:\n        g_F_unc, g_R_unc = E, 0.0\n    else: # Choose cleaner tech in a tie\n        g_F_unc, g_R_unc = 0.0, E\n    \n    E_unc = e_F * g_F_unc + e_R * g_R_unc\n\n    # --- Emissions Cap Sweep ---\n    caps = np.linspace(0, E_unc, caps_n)\n    cap_curve = []\n    for cap in caps:\n        g_F, g_R = 0.0, 0.0\n        # Given e_R = 0, the constraint e_F*g_F + e_R*g_R = cap becomes g_F = cap / e_F\n        g_F_max_by_cap = cap / e_F if e_F  0 else float('inf')\n\n        if C_F_eff  C_R_eff:\n            # Fossil is cheaper, use as much as cap allows\n            g_F = min(E, g_F_max_by_cap)\n            g_R = E - g_F\n        else:\n            # Renewable is cheaper, use it exclusively\n            g_F = 0.0\n            g_R = E\n\n        cost = g_F * C_F_eff + g_R * C_R_eff\n        emissions = e_F * g_F + e_R * g_R\n        cap_curve.append([emissions, cost])\n\n    # --- Carbon Price Sweep ---\n    # tau_switch is the price at which carbon-adjusted costs are equal\n    # C_F_eff + tau * e_F = C_R_eff + tau * e_R\n    # tau = (C_R_eff - C_F_eff) / (e_F - e_R)\n    if e_F  e_R:\n        tau_switch = (C_R_eff - C_F_eff) / (e_F - e_R)\n    else:\n        # If fossil is not more emitting, it's always preferred if cheaper,\n        # or never if more expensive. No switch is possible with positive tau.\n        tau_switch = float('inf') if C_F_eff  C_R_eff else -1.0\n\n    price_curve = []\n    for tau in prices:\n        g_F, g_R = 0.0, 0.0\n        # Compare carbon-adjusted effective costs\n        if C_F_eff + tau * e_F  C_R_eff + tau * e_R:\n            g_F, g_R = E, 0.0\n        else: # Choose cleaner tech in a tie\n            g_F, g_R = 0.0, E\n\n        cost = g_F * C_F_eff + g_R * C_R_eff\n        emissions = e_F * g_F + e_R * g_R\n        price_curve.append([emissions, cost])\n        \n    return [cap_curve, price_curve]\n\n\ndef solve():\n    test_cases = [\n        # Test case 1\n        (5000000.0, 100000.0, 20.0, 0.9, 0.6, 150000.0, 5.0, 0.4, 0.0, 6, [0, 25, 50, 100, 200, 400]),\n        # Test case 2\n        (2000000.0, 100000.0, 20.0, 0.9, 0.6, 180000.0, 5.0, 0.25, 0.0, 6, [0, 25, 50, 100, 200, 400]),\n        # Test case 3\n        (0.0, 100000.0, 20.0, 0.9, 0.6, 150000.0, 5.0, 0.4, 0.0, 6, [0, 25, 50, 100, 200, 400]),\n    ]\n\n    all_results = []\n    for case_params in test_cases:\n        case_result = solve_case(case_params)\n        all_results.append(case_result)\n\n    # Format the final output string as requested\n    print(format_list(all_results))\n\nsolve()\n```"
        }
    ]
}