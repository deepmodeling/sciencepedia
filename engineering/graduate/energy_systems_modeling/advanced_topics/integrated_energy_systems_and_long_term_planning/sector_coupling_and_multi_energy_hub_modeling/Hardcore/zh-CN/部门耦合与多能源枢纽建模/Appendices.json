{
    "hands_on_practices": [
        {
            "introduction": "掌握任何复杂系统建模的第一步都是理解其基本原理。本练习旨在通过一个基础的能量平衡计算，巩固您对多能源枢纽核心功能的理解。您将应用热力学第一定律以及效率和性能系数（COP）等标准定义，来计算一个简化枢纽在接收电力和天然气输入时，能同时提供的最大热力和冷力输出。通过这个练习 ，您将为后续更复杂的优化和调度问题打下坚实的物理基础。",
            "id": "4122226",
            "problem": "一个单一的多能源枢纽在稳态下为同一地点的供热和制冷终端提供服务。该枢纽有两个外部能源输入：电力输入 $u_{e}=5\\,\\mathrm{MW}$ 和以高热值（HHV）为基准测量的天然气输入 $u_{g}=8\\,\\mathrm{MW}$。该枢纽包含两个转换设备：\n- 一个燃气锅炉，其以高热值（HHV）为基准定义的第一定律效率恒为 $\\eta_{h}=0.9$，用于提供有效热量。\n- 一个电动蒸汽压缩式制冷机，其性能系数恒为 $\\mathrm{COP}_{c}=3.5$，定义为提供的制冷量与电力输入之比。\n\n该枢纽还有一个固定的内部辅助电力需求（水泵和控制系统）$\\dot{E}_{\\mathrm{loss}}=1\\,\\mathrm{MW}$。该辅助需求必须首先由电力输入满足，然后才有电力可供给制冷机。假设所有剩余的电力都可供给制冷机，所有天然气都可供给锅炉。不存在燃气发电，也没有其他设备。废热和排热离开枢纽边界，不计为有效输出。\n\n仅使用设备层面的能量守恒以及效率和性能系数的定义，确定当所有可用输入在满足辅助电力需求的前提下都用于这些服务时，该枢纽可以提供的最大同步稳态有效热输出 $\\dot{Q}_{h}$ 和有效制冷输出 $\\dot{Q}_{c}$。以 $\\mathrm{MW}$ 为单位，用精确值表示最终答案。将最终答案以包含两个数字的行向量形式提供，顺序为 $\\dot{Q}_{h}$、$\\dot{Q}_{c}$。",
            "solution": "首先对用户提供的问题进行严格的验证过程。\n\n### 步骤 1：提取已知条件\n以下数据和定义逐字从问题陈述中提取：\n- 电力输入：$u_{e}=5\\,\\mathrm{MW}$\n- 天然气输入（以高热值为基准）：$u_{g}=8\\,\\mathrm{MW}$\n- 燃气锅炉效率（以高热值为基准）：$\\eta_{h}=0.9$\n- 电动蒸汽压缩式制冷机性能系数：$\\mathrm{COP}_{c}=3.5$\n- 内部辅助电力需求：$\\dot{E}_{\\mathrm{loss}}=1\\,\\mathrm{MW}$\n- 系统处于稳态。\n- 锅炉效率定义为 $\\eta_{h} = (\\text{有效热量}) / (\\text{天然气输入, HHV})$。\n- 制冷机 COP 定义为 $\\mathrm{COP}_{c} = (\\text{提供的制冷量}) / (\\text{电力输入})$。\n- 辅助需求必须首先由电力输入满足，然后才有电力可供给制冷机。\n- 所有剩余电力都供给制冷机。\n- 所有天然气都供给锅炉。\n- 不存在燃气发电，也没有其他设备。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据所需标准对问题进行评估。\n- **科学依据**：该问题基于热力学第一定律以及能量转换性能指标（效率 $\\eta$ 和性能系数 $\\mathrm{COP}$）的标准定义。所提供的数值（$\\eta_h = 0.9$，$\\mathrm{COP}_c = 3.5$）对于现代锅炉和制冷机技术而言是符合物理实际的。\n- **适定性**：该问题是适定的。它提供了所有必要的输入、转换参数和内部需求，以唯一地确定输出。目标明确陈述：求最大同步有效热输出和制冷输出。\n- **客观性**：该问题使用精确、客观和定量的语言陈述。不存在主观或基于观点的陈述。\n- **缺陷分析**：问题陈述没有表现出任何缺陷。它在科学上是合理的，完全指定，不包含矛盾，并使用标准、定义明确的术语。约束条件清晰，并导向一个唯一解。两个能量转换路径（燃气到热能和电力到制冷）是解耦的，这使得可以对其各自的最大输出进行直接计算。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n该问题要求计算两个不同的能量输出：有效热量（$\\dot{Q}_{h}$）和有效制冷量（$\\dot{Q}_{c}$）。这些是通过将能量守恒原理应用于多能源枢纽内的每个转换设备来确定的。\n\n首先，我们计算燃气锅炉的有效热输出 $\\dot{Q}_{h}$。锅炉的能量输入是全部的天然气输入，$u_{g} = 8\\,\\mathrm{MW}$。转换效率 $\\eta_{h}$ 给定为 $0.9$。该效率的定义是有效热输出与燃料能量输入之比。\n$$\n\\eta_{h} = \\frac{\\dot{Q}_{h}}{u_{g}}\n$$\n求解 $\\dot{Q}_{h}$，我们得到：\n$$\n\\dot{Q}_{h} = \\eta_{h} \\cdot u_{g}\n$$\n代入给定值：\n$$\n\\dot{Q}_{h} = 0.9 \\cdot 8\\,\\mathrm{MW} = 7.2\\,\\mathrm{MW}\n$$\n\n接下来，我们计算电动制冷机的有效制冷输出 $\\dot{Q}_{c}$。枢纽的总电力输入为 $u_{e} = 5\\,\\mathrm{MW}$。根据问题陈述，必须首先满足内部辅助电力需求 $\\dot{E}_{\\mathrm{loss}} = 1\\,\\mathrm{MW}$。剩余的电力，我们记为 $\\dot{E}_{\\mathrm{chiller}}$，可供给制冷机。\n$$\n\\dot{E}_{\\mathrm{chiller}} = u_{e} - \\dot{E}_{\\mathrm{loss}}\n$$\n代入给定值：\n$$\n\\dot{E}_{\\mathrm{chiller}} = 5\\,\\mathrm{MW} - 1\\,\\mathrm{MW} = 4\\,\\mathrm{MW}\n$$\n制冷机的性能由其制冷性能系数 $\\mathrm{COP}_{c}$ 描述，给定值为 $3.5$。这被定义为有效制冷输出与所需电力输入之比。\n$$\n\\mathrm{COP}_{c} = \\frac{\\dot{Q}_{c}}{\\dot{E}_{\\mathrm{chiller}}}\n$$\n求解 $\\dot{Q}_{c}$，我们得到：\n$$\n\\dot{Q}_{c} = \\mathrm{COP}_{c} \\cdot \\dot{E}_{\\mathrm{chiller}}\n$$\n代入 $\\dot{E}_{\\mathrm{chiller}}$ 的计算值和 $\\mathrm{COP}_{c}$ 的给定值：\n$$\n\\dot{Q}_{c} = 3.5 \\cdot 4\\,\\mathrm{MW} = 14.0\\,\\mathrm{MW}\n$$\n\n问题要求的是最大同步稳态输出。由于产热路径（使用天然气）和制冷路径（使用电力）是独立的，并且所有可用输入都按指示被充分利用，因此计算出的值代表了可能的最大同步输出。\n\n因此，有效热输出为 $\\dot{Q}_{h} = 7.2\\,\\mathrm{MW}$，有效制冷输出为 $\\dot{Q}_{c} = 14.0\\,\\mathrm{MW}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n7.2  14.0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在掌握了基础的能量平衡之后，我们进一步探讨具有耦合输出的能源转换设备，这是行业耦合建模中的一个核心挑战。热电联产（CHP）机组是典型的例子，其电输出和热输出紧密相关，形成了一个特定的可行运行区域。本练习  将引导您分析一个具有线性背压特性的CHP机组，如何在满足特定电、热需求的同时，确定其唯一的运行点，并计算相应的燃料消耗。这个过程强调了在优化之前，理解并验证运行约束的重要性。",
            "id": "4122268",
            "problem": "考虑一个多能源枢纽，其包含一个连接电力和区域供热部门的单一背压式热电联产（CHP）单元。该CHP单元的可行运行区域由电功率 $P_{e} \\in [1,5]$ 兆瓦（MW）、热功率 $Q_{h} \\in [2,12]$ MW，以及背压耦合关系 $Q_{h} = \\alpha P_{e} + \\beta$（其中 $\\alpha = 1.5$ 且 $\\beta = 1$ MW）定义。该枢纽必须同时满足 $P_{e}^{d} = 4$ MW的电力需求和 $Q_{h}^{d} = 7$ MW的热力需求。\n\n使用热力学第一定律对CHP的燃料输入进行建模：燃料能量率 $\\dot{E}_{\\text{fuel}}$ 等于提供的有用输出与不可逆损失之和。假设不可逆损失由固定的寄生损耗 $\\ell_{0}$（以MW燃料能量为单位）和与输出呈线性关系的可变开销组成，其中电输出的无量纲系数为 $\\ell_{e}$，热输出的无量纲系数为 $\\ell_{h}$。取 $\\ell_{0} = 0.5$ MW, $\\ell_{e} = 0.2$, $\\ell_{h} = 0.1$。\n\n在满足可行区域和耦合约束的条件下，确定一个最优运行点，该点在满足给定需求的同时，能使燃料输入最小化。计算最小燃料输入率（以兆瓦燃料能量为单位），并以MW为单位表示最终答案。如果需要任何数值近似，请将答案四舍五入到四位有效数字。否则，请提供精确值。",
            "solution": "首先评估问题的有效性。\n\n步骤1：提取已知条件\n- CHP电功率范围：$P_{e} \\in [1, 5]$ MW\n- CHP热功率范围：$Q_{h} \\in [2, 12]$ MW\n- 背压耦合关系：$Q_{h} = \\alpha P_{e} + \\beta$\n- 耦合系数：$\\alpha = 1.5$\n- 耦合偏移量：$\\beta = 1$ MW\n- 电力需求：$P_{e}^{d} = 4$ MW\n- 热力需求：$Q_{h}^{d} = 7$ MW\n- 燃料输入模型：$\\dot{E}_{\\text{fuel}} = (\\text{有用输出}) + (\\text{不可逆损失})$\n- 固定寄生损耗：$\\ell_{0} = 0.5$ MW\n- 可变电损耗系数：$\\ell_{e} = 0.2$（无量纲）\n- 可变热损耗系数：$\\ell_{h} = 0.1$（无量纲）\n- 目标：最小化燃料输入率 $\\dot{E}_{\\text{fuel}}$。\n\n步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于能源系统工程和热力学原理。将热电联产（CHP）单元建模为具有线性运行特性和仿射燃料消耗函数，是能源枢纽优化中一种标准且科学有效的简化方法。热力学第一定律被正确地用作燃料模型的基础。\n- **适定性**：该问题提供了一个明确的目标（最小化燃料输入）和一组约束条件。解的存在性和唯一性取决于这些约束。如下所示，这些约束唯一地确定了运行点，使得该优化问题虽然平凡但却是适定的，从而导出一个唯一且有意义的解。\n- **客观性**：该问题使用精确、客观的语言和定量数据进行陈述。不存在主观或基于意见的陈述。\n- **完整性与一致性**：解决该问题所需的所有必要数据均已提供。我们必须验证这些约束条件是否相互矛盾。该枢纽必须满足 $P_{e}^{d}=4$ MW 和 $Q_{h}^{d}=7$ MW 的需求。要让单一的CHP单元满足此需求，其运行点必须是 $(P_{e}, Q_{h}) = (4, 7)$。我们检查该点是否可行：\n    1.  电功率：$1 \\le 4 \\le 5$。此条件满足。\n    2.  热功率：$2 \\le 7 \\le 12$。此条件满足。\n    3.  耦合关系：我们检查是否满足 $Q_{h} = \\alpha P_{e} + \\beta$。代入数值：$7 = (1.5)(4) + 1 \\Rightarrow 7 = 6 + 1 \\Rightarrow 7=7$。此条件满足。\n由于所需运行点与所有约束条件一致，因此该问题是自洽的。\n- **其他标准**：该问题是可形式化的，与其陈述的主题相关，现实的，并且是科学可验证的。它并非伪深刻问题，因为它需要对约束条件进行系统性检查并应用给定模型。\n\n步骤3：结论与行动\n问题被认为是有效的。将提供完整解答。\n\n目标是在满足指定需求并遵守CHP单元运行约束的条件下，最小化燃料输入率 $\\dot{E}_{\\text{fuel}}$。\n\n首先，我们将燃料输入率的目标函数形式化。问题陈述，燃料能量率 $\\dot{E}_{\\text{fuel}}$ 是提供的有用输出（$P_{e}$ 和 $Q_{h}$）与不可逆损失之和。\n$$\n\\dot{E}_{\\text{fuel}} = P_{e} + Q_{h} + \\text{Irreversibilities}\n$$\n不可逆损失由固定寄生损耗 $\\ell_{0}$ 和与输出呈线性关系的变动开销 $\\ell_{e}P_{e} + \\ell_{h}Q_{h}$ 之和给出。\n$$\n\\text{Irreversibilities} = \\ell_{0} + \\ell_{e} P_{e} + \\ell_{h} Q_{h}\n$$\n将此代入 $\\dot{E}_{\\text{fuel}}$ 的方程中，得到：\n$$\n\\dot{E}_{\\text{fuel}}(P_{e}, Q_{h}) = P_{e} + Q_{h} + (\\ell_{0} + \\ell_{e} P_{e} + \\ell_{h} Q_{h})\n$$\n该表达式可以通过对与 $P_{e}$ 和 $Q_{h}$ 相关的项进行分组来重新整理：\n$$\n\\dot{E}_{\\text{fuel}}(P_{e}, Q_{h}) = \\ell_{0} + (1 + \\ell_{e})P_{e} + (1 + \\ell_{h})Q_{h}\n$$\n这就是要最小化的目标函数。\n\n接下来，我们分析约束条件。该能源枢纽必须精确满足需求，这意味着CHP单元必须生产 $P_{e} = P_{e}^{d} = 4$ MW 和 $Q_{h} = Q_{h}^{d} = 7$ MW。这表明运行点不是一个在某个区域内进行优化的变量，而是由需求要求固定的。因此，寻找“最优运行点”的问题简化为验证这个由需求驱动的单一点是否可行。\n\n正如在验证阶段所确立的，点 $(P_{e}, Q_{h}) = (4, 7)$ 满足CHP单元的所有运行约束：\n1.  $P_{e} = 4$ 位于区间 $[1, 5]$ 内。\n2.  $Q_{h} = 7$ 位于区间 $[2, 12]$ 内。\n3.  点 $(4, 7)$ 位于背压耦合线 $Q_{h} = 1.5 P_{e} + 1$ 上。\n\n由于只有一个可能的运行点可以满足需求，根据定义，该点就是最优运行点。因此，这个问题不是一个优化问题，而是在一个预定点上进行计算的问题。\n\n现在，我们将运行点 $(P_{e}, Q_{h}) = (4, 7)$ 和给定的参数值代入目标函数，以计算最小燃料输入率。\n给定的参数是：\n- $\\ell_{0} = 0.5$ MW\n- $\\ell_{e} = 0.2$\n- $\\ell_{h} = 0.1$\n\n燃料输入率为：\n$$\n\\dot{E}_{\\text{fuel}} = \\ell_{0} + (1 + \\ell_{e})P_{e} + (1 + \\ell_{h})Q_{h}\n$$\n$$\n\\dot{E}_{\\text{fuel}} = 0.5 + (1 + 0.2)(4) + (1 + 0.1)(7)\n$$\n$$\n\\dot{E}_{\\text{fuel}} = 0.5 + (1.2)(4) + (1.1)(7)\n$$\n$$\n\\dot{E}_{\\text{fuel}} = 0.5 + 4.8 + 7.7\n$$\n$$\n\\dot{E}_{\\text{fuel}} = 5.3 + 7.7\n$$\n$$\n\\dot{E}_{\\text{fuel}} = 13.0\n$$\n最小燃料输入率为 $13.0$ MW。结果是一个精确的小数值，因此无需四舍五入。",
            "answer": "$$\\boxed{13.0}$$"
        },
        {
            "introduction": "现实世界中的能源系统决策总是在不确定性下进行的，例如未来的能源价格和负荷需求。为了在这种环境下做出最优决策，我们引入了随机优化的概念。本练习  构建了一个两阶段随机规划问题，您需要为一台热电联产（CHP）机组做出第一阶段的“启停”决策，然后在第二阶段根据展现的两种可能场景（不同的价格和需求）进行最优的经济调度。通过权衡启动成本和在不同场景下运行所带来的期望节约，您将学会如何量化并决策一个灵活性资产的经济价值，这是高级能源系统分析的一项关键技能。",
            "id": "4122248",
            "problem": "考虑一个单周期多能源枢纽，它通过一个热电联产（CHP）单元耦合电力和热力。该枢纽面临两种需求-价格情景，概率分别为 $p_1 = 0.6$ 和 $p_2 = 0.4$。第一阶段决策是 CHP 单元的二进制开/关机承诺，用 $y \\in \\{0,1\\}$ 表示，在情景实现之前做出选择。在每个情景 $s \\in \\{1,2\\}$ 中，追索决策调度枢纽的组件以满足电力和热力需求。目标是最小化总期望成本，即各情景特定运营成本的概率加权和，再加上适用的第一阶段启动成本。\n\n基本依据和物理现实性：\n- 根据能量守恒第一定律，每个情景中的能量平衡必须成立：供应的电量总和等于电力需求，供应的热量总和等于热力需求。\n- CHP 单元以固定的转换效率将燃料转化为电力和热力。设 $f_s$ 为情景 $s$ 中的燃料输入，电力输出为 $e_s = \\eta_e f_s$，热力输出为 $h_s = \\eta_h f_s$，其中 $\\eta_e \\in (0,1)$ 和 $\\eta_h \\in (0,1)$ 是给定的。\n- 非 CHP 供应是购自电网的电力和由锅炉产生的热力。电网电力和锅炉热力按给定的、与情景相关的价格购买。\n- CHP 有最大燃料输入容量 $F^{\\max}$，该容量仅在 $y=1$ 时强制执行；即，$0 \\le f_s \\le F^{\\max} y$。\n- 仅当 $y=1$ 且前一个承诺状态为关闭时，才会产生启动成本。\n\n每个情景 $s \\in \\{1,2\\}$ 的约束条件：\n- 电力平衡：$\\eta_e f_s + g_s = D^e_s$，其中 $g_s \\ge 0$ 是从电网购买的电力，$D^e_s$ 是电力需求。\n- 热力平衡：$\\eta_h f_s + b_s = D^h_s$，其中 $b_s \\ge 0$ 是由锅炉产生的热力，$D^h_s$ 是热力需求。\n- CHP 燃料输入限制：$0 \\le f_s \\le F^{\\max} y$。\n- 非负性：$g_s \\ge 0$, $b_s \\ge 0$, $f_s \\ge 0$。\n\n每个情景 $s$ 的运营成本是采购成本和燃料成本的总和：\n- 电网电力：$c^e_s$ 美元/兆瓦时电力，因此成本为 $c^e_s g_s$。\n- 锅炉热力：$c^b_s$ 美元/兆瓦时热力，因此成本为 $c^b_s b_s$。\n- CHP 燃料：$c^{f}$ 美元/兆瓦时燃料，因此成本为 $c^{f} f_s$。\n\n总期望成本为 $\\sum_{s=1}^2 p_s \\cdot \\left(c^e_s g_s + c^b_s b_s + c^{f} f_s\\right)$，如果 $y=1$ 且 $y^{prev}=0$，则加上启动成本 $c^{su}$，否则为零。\n\n所有物理量必须使用指定的单位：\n- 电力需求 $D^e_s$，单位为兆瓦时（$\\mathrm{MWh}$）。\n- 热力需求 $D^h_s$，单位为兆瓦时热力（$\\mathrm{MWh_{th}}$）。\n- 燃料输入 $f_s$，单位为兆瓦时燃料（$\\mathrm{MWh_{fuel}}$）。\n- 价格 $c^e_s$, $c^b_s$ 的单位为美元/兆瓦时（$\\$/\\mathrm{MWh}$），$c^{f}$ 的单位为美元/兆瓦时燃料（$\\$/\\mathrm{MWh_{fuel}}$）。\n- 效率 $\\eta_e$, $\\eta_h$ 是无量纲的。\n\n您的任务是为下面的每个参数集计算最优的第一阶段承诺 $y \\in \\{0,1\\}$，以最小化总期望成本。对于每个参数集，程序必须：\n- 使用 $p_1 = 0.6$ 和 $p_2 = 0.4$。\n- 使用给定的 $y^{prev}$, $F^{\\max}$, $c^{su}$, $c^{f}$, $\\eta_e$, $\\eta_h$ 和情景数据 $\\{D^e_s, D^h_s, c^e_s, c^b_s\\}_{s=1,2}$。\n- 在遵守所有约束的情况下，针对 $y=0$ 和 $y=1$ 两种情况，求解每个情景下的追索调度问题。\n- 通过将情景成本按 $p_s$ 加权求和，并加上适用的启动成本，计算 $y=0$ 和 $y=1$ 的总期望成本。\n- 选择产生较低期望成本的 $y$。如果成本完全相等，则选择 $y=0$。\n\n测试套件（五组参数集）：\n- 案例 1（理想路径，两种情景下 CHP 均有利可图）：\n    - $y^{prev} = 0$, $F^{\\max} = 100$, $c^{su} = 500$, $c^{f} = 35$, $\\eta_e = 0.35$, $\\eta_h = 0.45$.\n    - 情景 1: $D^e_1 = 60$, $D^h_1 = 70$, $c^e_1 = 110$, $c^b_1 = 50$.\n    - 情景 2: $D^e_2 = 40$, $D^h_2 = 30$, $c^e_2 = 90$, $c^b_2 = 40$.\n- 案例 2（价格低，启动成本高，从不使用 CHP）：\n    - $y^{prev} = 0$, $F^{\\max} = 100$, $c^{su} = 3000$, $c^{f} = 50$, $\\eta_e = 0.35$, $\\eta_h = 0.45$.\n    - 情景 1: $D^e_1 = 40$, $D^h_1 = 30$, $c^e_1 = 70$, $c^b_1 = 30$.\n    - 情景 2: $D^e_2 = 40$, $D^h_2 = 30$, $c^e_2 = 60$, $c^b_2 = 25$.\n- 案例 3（之前已开启，在一种情景下有利可图）：\n    - $y^{prev} = 1$, $F^{\\max} = 50$, $c^{su} = 1000$, $c^{f} = 45$, $\\eta_e = 0.35$, $\\eta_h = 0.45$.\n    - 情景 1: $D^e_1 = 50$, $D^h_1 = 20$, $c^e_1 = 120$, $c^b_1 = 70$.\n    - 情景 2: $D^e_2 = 30$, $D^h_2 = 30$, $c^e_2 = 50$, $c^b_2 = 20$.\n- 案例 4（热力需求限制了 CHP 的使用；节省的成本低于启动成本）：\n    - $y^{prev} = 0$, $F^{\\max} = 1000$, $c^{su} = 1500$, $c^{f} = 35$, $\\eta_e = 0.35$, $\\eta_h = 0.45$.\n    - 情景 1: $D^e_1 = 200$, $D^h_1 = 10$, $c^e_1 = 130$, $c^b_1 = 30$.\n    - 情景 2: $D^e_2 = 100$, $D^h_2 = 5$, $c^e_2 = 90$, $c^b_2 = 30$.\n- 案例 5（容量受限，节省的成本超过启动成本）：\n    - $y^{prev} = 0$, $F^{\\max} = 10$, $c^{su} = 200$, $c^{f} = 35$, $\\eta_e = 0.35$, $\\eta_h = 0.45$.\n    - 情景 1: $D^e_1 = 30$, $D^h_1 = 30$, $c^e_1 = 100$, $c^b_1 = 60$.\n    - 情景 2: $D^e_2 = 35$, $D^h_2 = 25$, $c^e_2 = 80$, $c^b_2 = 50$.\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个整数代表对应案例的最优 $y$（其中 $0$ 表示关闭， $1$ 表示开启）。例如：$[y_1,y_2,y_3,y_4,y_5]$。",
            "solution": "该问题是一个针对多能源枢纽的两阶段随机优化问题。目标是确定热电联产（CHP）单元的最优第一阶段承诺决策（用二进制变量 $y \\in \\{0, 1\\}$ 表示），以最小化在两种可能的未来情景 $s \\in \\{1, 2\\}$ 下的总期望成本。\n\n总期望成本 $C(y)$ 是第一阶段成本与第二阶段（追索）成本期望值的总和。第一阶段成本是启动成本 $C^{su}$，它仅在 CHP 从关闭状态（$y^{prev}=0$）开启（$y=1$）时产生。第二阶段成本是每个情景下的运营成本，它取决于枢纽资产的调度。\n\n总期望成本可以表示为：\n$$\nC(y) = C_{\\text{startup}}(y, y^{prev}) + \\sum_{s=1}^{2} p_s \\cdot C_{\\text{op}, s}(y)\n$$\n其中 $C_{\\text{startup}}(y, y^{prev}) = c^{su} \\cdot y \\cdot (1 - y^{prev})$ 是启动成本，$p_s$ 是情景 $s$ 的概率，$C_{\\text{op}, s}(y)$ 是在给定承诺 $y$ 的情况下，情景 $s$ 中的最低运营成本。\n\n我们的任务是计算 $C(0)$ 和 $C(1)$，并选择产生最低成本的 $y$ 值。如果 $C(0) = C(1)$，我们选择 $y=0$。\n\n### 对承诺 $y=0$（CHP 关闭）的分析\n如果 CHP 单元未承诺运行，则其在两种情景下的燃料消耗 $f_s$ 必须为零（$f_s=0$）。能量平衡约束变为：\n- 电力：$g_s = D^e_s$\n- 热力：$b_s = D^h_s$\n这意味着所有电力需求 $D^e_s$ 必须通过从电网购电来满足，所有热力需求 $D^h_s$ 必须由锅炉来满足。\n因此，对于 $y=0$，情景 $s$ 中的运营成本是固定的：\n$$\nC_{\\text{op}, s}(0) = c^e_s D^e_s + c^b_s D^h_s\n$$\n启动成本为 $C_{\\text{startup}}(0, y^{prev}) = 0$。\n对于 $y=0$ 的总期望成本是基准成本，我们将用它来评估运行 CHP 的决策：\n$$\nC(0) = p_1 (c^e_1 D^e_1 + c^b_1 D^h_1) + p_2 (c^e_2 D^e_2 + c^b_2 D^h_2)\n$$\n\n### 对承诺 $y=1$（CHP 开启）的分析\n如果 CHP 单元承诺运行，我们必须为每个情景 $s$ 求解一个追索优化问题，以找到最优调度和相应的最低运营成本 $C_{\\text{op}, s}(1)$。\n\n对于给定的情景 $s$，目标是最小化运营成本：\n$$\n\\min_{f_s, g_s, b_s} \\left( c^{f} f_s + c^e_s g_s + c^b_s b_s \\right)\n$$\n受以下约束：\n1. $\\eta_e f_s + g_s = D^e_s$ (电力平衡)\n2. $\\eta_h f_s + b_s = D^h_s$ (热力平衡)\n3. $0 \\le f_s \\le F^{\\max}$ (CHP 容量, 因为 $y=1$)\n4. $g_s \\ge 0, b_s \\ge 0$ (采购量的非负性)\n\n我们可以使用平衡方程将购买的电力 $g_s$ 和热力 $b_s$ 表示为 CHP 燃料输入 $f_s$ 的函数：\n$g_s = D^e_s - \\eta_e f_s$\n$b_s = D^h_s - \\eta_h f_s$\n\n将这些代入成本函数，可以使其仅用 $f_s$ 表示：\n$$\nC_{\\text{op}, s}(f_s) = c^{f} f_s + c^e_s (D^e_s - \\eta_e f_s) + c^b_s (D^h_s - \\eta_h f_s)\n$$\n重新整理各项：\n$$\nC_{\\text{op}, s}(f_s) = (c^e_s D^e_s + c^b_s D^h_s) + (c^{f} - c^e_s \\eta_e - c^b_s \\eta_h) f_s\n$$\n第一项 $(c^e_s D^e_s + c^b_s D^h_s)$ 正是 CHP 关闭时的运营成本 $C_{\\text{op}, s}(0)$。设 $\\Delta_s = c^e_s \\eta_e + c^b_s \\eta_h - c^{f}$ 为在 CHP 中使用 $1 \\, \\mathrm{MWh_{fuel}}$ 燃料的边际经济价值。正的 $\\Delta_s$ 意味着 CHP 产生的电力和热力的价值超过了所需燃料的成本。成本函数简化为：\n$$\nC_{\\text{op}, s}(f_s) = C_{\\text{op}, s}(0) - \\Delta_s f_s\n$$\n为了最小化此成本，我们选择最优燃料输入 $f_s^*$ 的策略很明确：\n- 如果 $\\Delta_s  0$，我们应使 $f_s$ 尽可能大。\n- 如果 $\\Delta_s \\le 0$，运行 CHP 不经济，因此我们应使 $f_s$ 尽可能小，即 $f_s=0$。\n\n$f_s$ 的可行范围必须满足所有约束。约束条件 $g_s \\ge 0$ 和 $b_s \\ge 0$ 转化为 $f_s$ 的上界：\n- $D^e_s - \\eta_e f_s \\ge 0 \\implies f_s \\le D^e_s / \\eta_e$\n- $D^h_s - \\eta_h f_s \\ge 0 \\implies f_s \\le D^h_s / \\eta_h$\n将这些与 CHP 容量约束（$f_s \\le F^{\\max}$）和非负性（$f_s \\ge 0$）相结合，$f_s$ 的可行范围是：\n$$\n0 \\le f_s \\le \\min\\left( F^{\\max}, \\frac{D^e_s}{\\eta_e}, \\frac{D^h_s}{\\eta_h} \\right)\n$$\n我们将这个上界称为 $f_{s, \\text{max-feasible}}$。最优燃料调度 $f_s^*$ 为：\n$$\nf_s^* =\n\\begin{cases}\nf_{s, \\text{max-feasible}}  \\text{if } \\Delta_s  0 \\\\\n0  \\text{if } \\Delta_s \\le 0\n\\end{cases}\n$$\n那么，在 $y=1$ 的情况下，情景 $s$ 的最低运营成本为 $C_{\\text{op}, s}(1) = C_{\\text{op}, s}(0) - \\Delta_s f_s^*$。注意，如果 $\\Delta_s \\le 0$，则 $f_s^*=0$ 且 $C_{\\text{op}, s}(1) = C_{\\text{op}, s}(0)$。\n\n对于 $y=1$ 的总期望成本，通过将启动成本与各情景的概率加权最优运营成本相加来计算：\n$$\nC(1) = C_{\\text{startup}}(1, y^{prev}) + \\sum_{s=1}^{2} p_s \\cdot C_{\\text{op}, s}(1)\n$$\n$$\nC(1) = c^{su} \\cdot (1 - y^{prev}) + \\sum_{s=1}^{2} p_s \\cdot (C_{\\text{op}, s}(0) - \\Delta_s f_s^*)\n$$\n\n### 最终决策\n通过比较总期望成本来找到最优的第一阶段决策：\n- 如果 $C(1)  C(0)$，则最优决策为 $y_{opt} = 1$。\n- 否则（如果 $C(1) \\ge C(0)$），最优决策为 $y_{opt} = 0$。\n\n这完成了解决任何给定参数集问题的逻辑步骤。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the two-stage stochastic energy hub commitment problem for a series of test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1 (happy path, beneficial CHP in both scenarios)\n        {\n            \"params\": {\"y_prev\": 0, \"F_max\": 100, \"c_su\": 500, \"c_f\": 35, \"eta_e\": 0.35, \"eta_h\": 0.45},\n            \"s1\": {\"D_e\": 60, \"D_h\": 70, \"c_e\": 110, \"c_b\": 50},\n            \"s2\": {\"D_e\": 40, \"D_h\": 30, \"c_e\": 90, \"c_b\": 40},\n        },\n        # Case 2 (low prices, high startup, CHP never used)\n        {\n            \"params\": {\"y_prev\": 0, \"F_max\": 100, \"c_su\": 3000, \"c_f\": 50, \"eta_e\": 0.35, \"eta_h\": 0.45},\n            \"s1\": {\"D_e\": 40, \"D_h\": 30, \"c_e\": 70, \"c_b\": 30},\n            \"s2\": {\"D_e\": 40, \"D_h\": 30, \"c_e\": 60, \"c_b\": 25},\n        },\n        # Case 3 (previously on, beneficial in one scenario)\n        {\n            \"params\": {\"y_prev\": 1, \"F_max\": 50, \"c_su\": 1000, \"c_f\": 45, \"eta_e\": 0.35, \"eta_h\": 0.45},\n            \"s1\": {\"D_e\": 50, \"D_h\": 20, \"c_e\": 120, \"c_b\": 70},\n            \"s2\": {\"D_e\": 30, \"D_h\": 30, \"c_e\": 50, \"c_b\": 20},\n        },\n        # Case 4 (heat demand caps CHP use; savings below startup)\n        {\n            \"params\": {\"y_prev\": 0, \"F_max\": 1000, \"c_su\": 1500, \"c_f\": 35, \"eta_e\": 0.35, \"eta_h\": 0.45},\n            \"s1\": {\"D_e\": 200, \"D_h\": 10, \"c_e\": 130, \"c_b\": 30},\n            \"s2\": {\"D_e\": 100, \"D_h\": 5, \"c_e\": 90, \"c_b\": 30},\n        },\n        # Case 5 (capacity-limited, savings exceed startup)\n        {\n            \"params\": {\"y_prev\": 0, \"F_max\": 10, \"c_su\": 200, \"c_f\": 35, \"eta_e\": 0.35, \"eta_h\": 0.45},\n            \"s1\": {\"D_e\": 30, \"D_h\": 30, \"c_e\": 100, \"c_b\": 60},\n            \"s2\": {\"D_e\": 35, \"D_h\": 25, \"c_e\": 80, \"c_b\": 50},\n        },\n    ]\n\n    p1, p2 = 0.6, 0.4\n    results = []\n\n    for case in test_cases:\n        params = case[\"params\"]\n        s1 = case[\"s1\"]\n        s2 = case[\"s2\"]\n\n        # --- Calculate Total Expected Cost for y = 0 ---\n        # No startup cost for y=0.\n        # Operating cost is simply satisfying all demand from grid/boiler.\n        op_cost_s1_y0 = s1[\"c_e\"] * s1[\"D_e\"] + s1[\"c_b\"] * s1[\"D_h\"]\n        op_cost_s2_y0 = s2[\"c_e\"] * s2[\"D_e\"] + s2[\"c_b\"] * s2[\"D_h\"]\n        cost_y0 = p1 * op_cost_s1_y0 + p2 * op_cost_s2_y0\n\n        # --- Calculate Total Expected Cost for y = 1 ---\n        # Calculate startup cost for y=1\n        startup_cost_y1 = params[\"c_su\"] * 1 * (1 - params[\"y_prev\"])\n\n        # Calculate recourse (operating) cost for scenario 1 with y=1\n        delta_s1 = s1[\"c_e\"] * params[\"eta_e\"] + s1[\"c_b\"] * params[\"eta_h\"] - params[\"c_f\"]\n        f_star_s1 = 0\n        if delta_s1  0:\n            f_max_feasible_s1 = np.min([\n                params[\"F_max\"],\n                s1[\"D_e\"] / params[\"eta_e\"],\n                s1[\"D_h\"] / params[\"eta_h\"]\n            ])\n            f_star_s1 = f_max_feasible_s1\n        \n        op_cost_s1_y1 = op_cost_s1_y0 - delta_s1 * f_star_s1\n\n        # Calculate recourse (operating) cost for scenario 2 with y=1\n        delta_s2 = s2[\"c_e\"] * params[\"eta_e\"] + s2[\"c_b\"] * params[\"eta_h\"] - params[\"c_f\"]\n        f_star_s2 = 0\n        if delta_s2  0:\n            f_max_feasible_s2 = np.min([\n                params[\"F_max\"],\n                s2[\"D_e\"] / params[\"eta_e\"],\n                s2[\"D_h\"] / params[\"eta_h\"]\n            ])\n            f_star_s2 = f_max_feasible_s2\n\n        op_cost_s2_y1 = op_cost_s2_y0 - delta_s2 * f_star_s2\n\n        expected_op_cost_y1 = p1 * op_cost_s1_y1 + p2 * op_cost_s2_y1\n        cost_y1 = startup_cost_y1 + expected_op_cost_y1\n\n        # --- Decision ---\n        # Choose y that yields lower cost. In case of equality, choose y=0.\n        optimal_y = 1 if cost_y1  cost_y0 else 0\n        results.append(optimal_y)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}