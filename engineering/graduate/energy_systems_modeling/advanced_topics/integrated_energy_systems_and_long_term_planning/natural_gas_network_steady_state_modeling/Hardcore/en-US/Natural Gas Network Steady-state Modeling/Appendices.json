{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any network model is the accurate representation of its components. This practice connects fundamental fluid dynamics to the algebraic model for a single gas pipeline by deriving the relationship between pressure $p$ and mass flow rate $q$ from first principles. Completing this exercise  builds crucial intuition for how physical properties and pipe geometry dictate a network's operational limits.",
            "id": "4107328",
            "problem": "A single straight horizontal pipeline edge connects node $i$ to node $j$ in a natural gas transmission network. The gas is modeled as an ideal gas with a constant compressibility factor ($Z$), and the flow is steady, one-dimensional, and isothermal. The pipe has constant diameter and roughness along its length, and the friction is represented by a constant Darcy–Weisbach friction factor. Let the mass flow rate be $q$ (defined positive from node $i$ to node $j$), the upstream pressure be $p_i$, and the downstream pressure be $p_j$. The pipe’s aggregated resistance coefficient $\\alpha_e$, which lumps geometry and gas properties under the stated assumptions, is known from prior calibration.\n\nStarting from the steady momentum balance for a compressible fluid with wall friction and the ideal-gas relation under isothermal conditions, derive the steady-state algebraic relation connecting $(p_i,p_j,q)$ for this pipe and identify how the coefficient $\\alpha_e$ emerges. Then, using this relation, impose the operating constraint that the downstream pressure must satisfy $p_j \\ge 40$ bar when the upstream pressure is $p_i=60$ bar, and compute the allowable range of the forward mass flow rate $q$ (i.e., with $q \\ge 0$).\n\nUse the following numerical data:\n- $p_i = 60$ bar,\n- $p_j \\ge 40$ bar,\n- $\\alpha_e = 8.0 \\times 10^{11}$ $\\text{Pa}^2 \\text{s}^2 \\text{kg}^{-2}$,\n- $1$ bar $= 10^{5}$ $\\text{Pa}$.\n\nReport the numerical lower and upper bounds of the allowable range of $q$ and express the mass flow rate in kilograms per second. Round your final numerical bounds to four significant figures.",
            "solution": "The steady, one-dimensional momentum balance for flow in a horizontal pipe of length $L$ and diameter $D$ is given by:\n$$\n\\frac{d p}{d x} + \\rho v \\frac{d v}{d x} + \\frac{f}{D} \\frac{\\rho v^2}{2} = 0\n$$\nwhere $p$ is pressure, $x$ is the spatial coordinate, $\\rho$ is density, $v$ is velocity, and $f$ is the friction factor. For long gas pipelines, frictional losses dominate, and it is a standard engineering simplification to neglect the inertial (convective acceleration) term $\\rho v \\frac{dv}{dx}$. This leads to:\n$$\n\\frac{d p}{d x} = -\\frac{f}{2D} \\rho v^2\n$$\nThe mass flow rate $q$ is constant along the pipe, $q = \\rho A v$, where $A$ is the cross-sectional area. Thus, $v = q / (\\rho A)$. The equation of state is $p = \\rho Z R T$, which gives $\\rho = p / (ZRT)$. Substituting for $v$ and then $\\rho$:\n$$\n\\frac{d p}{d x} = -\\frac{f q^2}{2 D A^2 \\rho} = -\\frac{f q^2}{2 D A^2 \\left(\\frac{p}{ZRT}\\right)} = -\\left(\\frac{f Z R T}{2 D A^2}\\right) \\frac{q^2}{p}\n$$\nThis is a separable ordinary differential equation. We integrate from the inlet ($x=0$, $p=p_i$) to the outlet ($x=L$, $p=p_j$):\n$$\n\\int_{p_i}^{p_j} p \\, dp = -\\int_{0}^{L} \\left(\\frac{f Z R T}{2 D A^2}\\right) q^2 \\, dx\n$$\nSince all terms on the right-hand side are assumed constant:\n$$\n\\left[ \\frac{p^2}{2} \\right]_{p_i}^{p_j} = -\\left(\\frac{f L Z R T}{2 D A^2}\\right) q^2\n$$\n$$\n\\frac{p_j^2 - p_i^2}{2} = -\\left(\\frac{f L Z R T}{2 D A^2}\\right) q^2\n$$\nMultiplying by $-2$ gives the algebraic relation:\n$$\np_i^2 - p_j^2 = \\left(\\frac{f L Z R T}{D A^2}\\right) q^2\n$$\nComparing this to the form $p_i^2 - p_j^2 = \\alpha_e q^2$, we identify the resistance coefficient as $\\alpha_e = \\frac{f L Z R T}{D A^2}$.\n\nNow, we compute the allowable range for the forward mass flow rate $q \\ge 0$. The given data are:\n- $p_i = 60$ bar $= 6.0 \\times 10^6$ Pa\n- $p_j \\ge 40$ bar $= 4.0 \\times 10^6$ Pa\n- $\\alpha_e = 8.0 \\times 10^{11}$ $\\text{Pa}^2 \\text{s}^2 \\text{kg}^{-2}$\n- $q \\ge 0$ implies $p_i \\ge p_j$.\n\nThe allowable range for the downstream pressure is $4.0 \\times 10^6 \\text{ Pa} \\le p_j \\le 6.0 \\times 10^6 \\text{ Pa}$. We solve for $q$:\n$$\nq(p_j) = \\sqrt{\\frac{p_i^2 - p_j^2}{\\alpha_e}}\n$$\nThis function is monotonically decreasing with $p_j$.\nThe minimum mass flow rate, $q_{\\text{min}}$, occurs at the maximum value of $p_j = 6.0 \\times 10^6$ Pa:\n$$\nq_{\\text{min}} = \\sqrt{\\frac{(6.0 \\times 10^6)^2 - (6.0 \\times 10^6)^2}{8.0 \\times 10^{11}}} = 0 \\text{ kg/s}\n$$\nThe maximum mass flow rate, $q_{\\text{max}}$, occurs at the minimum value of $p_j = 4.0 \\times 10^6$ Pa:\n$$\nq_{\\text{max}} = \\sqrt{\\frac{(6.0 \\times 10^6)^2 - (4.0 \\times 10^6)^2}{8.0 \\times 10^{11}}} = \\sqrt{\\frac{36.0 \\times 10^{12} - 16.0 \\times 10^{12}}{8.0 \\times 10^{11}}} = \\sqrt{\\frac{20.0 \\times 10^{12}}{8.0 \\times 10^{11}}} = \\sqrt{25} = 5.0 \\text{ kg/s}\n$$\nThe allowable range is $0 \\le q \\le 5.0$ kg/s. Rounding the bounds to four significant figures gives $0.000$ and $5.000$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.000  5.000\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Before attempting a numerical solution, it is vital to determine if a network is physically feasible. This practice demonstrates that satisfying global mass balance is not enough, as directional components like check valves impose strict topological constraints on flow paths. Analyzing the specific network of directed edges presented here  will equip you with a graph-based diagnostic to identify such inherent infeasibilities.",
            "id": "4107316",
            "problem": "Consider a steady-state natural gas network with nodes $\\{1,2,3,4\\}$ and directed edges representing components that constrain flow direction. Let $q_{ij}$ denote the mass flow from node $i$ to node $j$ and $p_i$ denote the absolute pressure at node $i$. The governing base is the steady-state mass conservation at each node: for every node $i$, the sum of flows leaving equals the net injection at that node, i.e., $\\sum_{j} q_{ij} - \\sum_{k} q_{ki} = s_i - d_i$, where $s_i \\ge 0$ is the exogenous injection and $d_i \\ge 0$ is the exogenous withdrawal. For passive components with monotone flow–pressure relations (e.g., pipelines under standard quasi-steady models), if $q_{ij}  0$ then $p_i  p_j$; for a check valve with cracking requirement, if $q_{ij}  0$ then $p_i \\ge p_j + \\delta_{ij}$ for some $\\delta_{ij} \\ge 0$; for a one-way pressure reducing regulator oriented $i \\to j$, flow is allowed only with $q_{ij} \\ge 0$ and $p_j \\le p_i$ with a minimum drop $p_i - p_j \\ge \\delta_{ij}$ when $q_{ij}  0$. All such devices enforce nonnegativity of $q_{ij}$ in the forward orientation and require $p$ to strictly decrease (by at least $\\delta_{ij}$) along any edge that carries positive flow.\n\nThe network edges and orientations are:\n- Edge $(2,1)$: a check valve allowing only flow $2 \\to 1$.\n- Edge $(2,3)$: a one-way pressure reducing regulator allowing only flow $2 \\to 3$.\n- Edge $(3,4)$: a check valve allowing only flow $3 \\to 4$.\n- Edge $(4,1)$: a check valve allowing only flow $4 \\to 1$.\n\nSuppose the exogenous supply and demand are:\n- Node $1$: injection $s_1 = 10$ and withdrawal $d_1 = 0$.\n- Node $2$: injection $s_2 = 0$ and withdrawal $d_2 = 0$.\n- Node $3$: injection $s_3 = 0$ and withdrawal $d_3 = 6$.\n- Node $4$: injection $s_4 = 0$ and withdrawal $d_4 = 4$.\n\nHence, total injection equals total withdrawal, i.e., $\\sum_i s_i = \\sum_i d_i = 10$.\n\nFrom first principles, analyze whether the directional constraints imposed by the check valves and the one-way regulator can render the network infeasible at steady state, even though global mass balance is satisfied. Then, select the option that best describes a correct diagnostic for detecting such infeasibility a priori from topology and device orientations, without resorting to numerical nonlinear solves.\n\nA. Because $\\sum_i s_i = \\sum_i d_i$, the network is feasible; a correct diagnostic is to verify only global mass balance.\n\nB. The network is infeasible; a correct diagnostic is to examine cuts $(S,T)$ of the directed device graph and check whether the net required flow from $S$ to $T$, $\\sum_{i \\in S} s_i - \\sum_{i \\in S} d_i$, is strictly positive while all edges crossing from $S$ to $T$ are directionally blocked (i.e., only oriented $T \\to S$ or otherwise prohibit $S \\to T$ flow). If such a cut exists, feasibility is impossible irrespective of pressures.\n\nC. The network can be made feasible by raising $p_1$ sufficiently; a correct diagnostic is to verify that the sum of minimum drops $\\sum \\delta_{ij}$ along any directed cycle is less than the maximum feasible $p_1$.\n\nD. The network is feasible if the regulator’s minimum drop $\\delta_{23}$ is lowered enough; a correct diagnostic is to progressively relax regulator setpoints until a Newton-based solver finds a solution.",
            "solution": "The problem describes a network that is infeasible due to its topology and the directionality of its components, despite satisfying global mass balance. Here is the step-by-step analysis:\n\n1.  **Analyze the Nodal Balances and Flow Directions:**\n    *   **Node 1** is a supply node with a net injection of $s_1 - d_1 = 10$. For the system to be in steady state, this amount of mass must flow out of node 1 into the rest of the network.\n    *   **Node 3** is a demand node with a net withdrawal of $d_3 - s_3 = 6$. It requires a net inflow of 6 units.\n    *   **Node 4** is a demand node with a net withdrawal of $d_4 - s_4 = 4$. It requires a net inflow of 4 units.\n    *   **Node 2** is a transshipment node with no net injection or withdrawal ($s_2 - d_2 = 0$).\n\n2.  **Examine the Topology around the Supply Node:**\n    *   The problem states that node 1 must supply 10 units of gas to the network. This requires a flow path *originating* at node 1.\n    *   Let's inspect the edges connected to node 1:\n        *   Edge $(2,1)$: A check valve allowing flow *only from node 2 to node 1*.\n        *   Edge $(4,1)$: A check valve allowing flow *only from node 4 to node 1*.\n    *   Both connected edges are directed *into* node 1. There are no edges directed *away* from node 1. Therefore, it is topologically impossible for gas to flow out of node 1 to supply the demands at nodes 3 and 4. The network cannot satisfy the required nodal balances.\n\n3.  **Apply a Formal Cut-Based Diagnostic (as described in Option B):**\n    *   This problem is an application of the max-flow min-cut theorem concept. A network is feasible only if for every possible partition (or \"cut\") of the nodes into two sets, $S$ and $T$, the maximum possible flow capacity from $S$ to $T$ is greater than or equal to the required flow from $S$ to $T$.\n    *   Let's define a cut with the supply node in one set and all other nodes in the other:\n        *   Set $S = \\{1\\}$\n        *   Set $T = \\{2, 3, 4\\}$\n    *   The net required flow from set $S$ to set $T$ is calculated as the sum of net injections in $S$:\n        $$ \\text{Required Flow}_{S \\to T} = \\sum_{i \\in S} (s_i - d_i) = s_1 - d_1 = 10 - 0 = 10 $$\n    *   Now, we examine the capacity of the cut. This is the maximum possible flow across all edges that go from a node in $S$ to a node in $T$.\n        *   The edges crossing the cut are $(2,1)$ and $(4,1)$. Both edges are oriented from $T$ to $S$.\n        *   There are no edges oriented from $S$ to $T$.\n    *   The maximum possible flow capacity from $S$ to $T$ is therefore zero.\n    *   Since the required flow (10) is strictly greater than the available capacity (0), the network is infeasible.\n\n4.  **Evaluate the Options:**\n    *   **A:** Incorrect. Global mass balance ($\\sum s_i = \\sum d_i$) is a necessary but not sufficient condition for feasibility. This problem is a direct counterexample.\n    *   **B:** Correct. This option perfectly describes the cut-based analysis performed above. Finding such a cut proves a priori that the network is structurally infeasible, regardless of pressures or other parameters.\n    *   **C:** Incorrect. The problem is not related to pressure levels or pressure drops. The components (check valves) physically prevent reverse flow. No matter how high $p_1$ is, it cannot force flow through an edge in the wrong direction.\n    *   **D:** Incorrect. The infeasibility is caused by the inability of the supply node to export gas, a problem unrelated to the regulator on edge $(2,3)$. Relaxing the regulator's setpoint would have no effect on this fundamental topological flaw. A numerical solver would fail to converge.\n\nTherefore, the network is infeasible, and the correct diagnostic is to identify a cut where the required flow exceeds the capacity due to directional constraints.",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "Gas network models produce systems of nonlinear equations that require iterative numerical solvers. This exercise demystifies that process by guiding you through one complete step of the Newton-Raphson method for a simple two-node system. By explicitly calculating the residual vector $F(x)$, the Jacobian matrix $J(x)$, and the update step $\\Delta x$ , you will gain a tangible understanding of how these solvers converge to a physically consistent state.",
            "id": "4107337",
            "problem": "Consider a steady-state natural gas network consisting of two nodes, node $1$ and node $2$, connected by a single pipe oriented from node $1$ to node $2$. The supply node $1$ is pressure-controlled with fixed pressure $p_1 = 50$ bar. The demand node $2$ has a fixed withdrawal $d_2 = 5$ standard cubic meters per second (Sm$^3$/s). The pipe’s steady-state pressure–flow relationship is given by the Weymouth equation\n$$\nq_{12} |q_{12}| = \\alpha \\left(p_1^2 - p_2^2\\right),\n$$\nwith a known friction coefficient $\\alpha = 0.02$ Sm$^6$/s$^2$·bar$^{-2}$. Assume isothermal flow, constant gas properties, and that the flow is oriented and positive from node $1$ to node $2$. At node $2$, steady-state mass conservation requires the net inflow to balance the fixed withdrawal.\n\nYou will use a Newton step on the nonlinear residual equations with the state vector $x = (p_2, q_{12})$, where $p_2$ is the pressure at node $2$ and $q_{12}$ is the flow from node $1$ to node $2$. The residual vector is formed by (i) the mass balance at node $2$ and (ii) the pressure–flow relation of the pipe. Starting from the current iterate $p_2^{(k)} = 49$ bar and $q_{12}^{(k)} = 3$ Sm$^3$/s:\n\n- Derive the residuals and the Jacobian from first principles based on the above physical laws.\n- Compute one full Newton step $\\Delta x$ by solving the linear system defined by the Jacobian at the current iterate and the residual evaluated at the current iterate.\n- Update the state to obtain $(p_2^{(k+1)}, q_{12}^{(k+1)})$.\n- Interpret the update direction physically in terms of pressure drop and flow adjustment in the pipe.\n\nReport the numerical values of $(p_2^{(k+1)}, q_{12}^{(k+1)})$ rounded to four significant figures. Express $p_2$ in bar and $q_{12}$ in Sm$^3$/s. Provide the final numeric pair in the order $(p_2^{(k+1)}, q_{12}^{(k+1)})$.",
            "solution": "The problem requires performing one step of the Newton-Raphson method to solve a system of nonlinear equations. Let the state vector be $x = \\begin{pmatrix} p_2 \\\\ q_{12} \\end{pmatrix}$. The method involves solving the linear system $J(x^{(k)}) \\Delta x^{(k)} = -F(x^{(k)})$ to find the update step $\\Delta x^{(k)}$, and then updating the state via $x^{(k+1)} = x^{(k)} + \\Delta x^{(k)}$.\n\n**1. Formulate the Residual Equations**\nWe define a residual vector $F(x)$ that is zero at the solution.\n(i) **Mass Balance at Node 2**: The inflow $q_{12}$ must equal the withdrawal $d_2$.\nThe first residual equation is $F_1(p_2, q_{12}) = q_{12} - d_2 = 0$.\n(ii) **Pipe Pressure-Flow Relation**: Since flow is positive ($q_{12}  0$), the Weymouth equation is $q_{12}^2 = \\alpha (p_1^2 - p_2^2)$.\nThe second residual equation is $F_2(p_2, q_{12}) = q_{12}^2 - \\alpha (p_1^2 - p_2^2) = 0$.\nThe full residual vector is:\n$$ F(x) = \\begin{pmatrix} q_{12} - d_2 \\\\ q_{12}^2 + \\alpha p_2^2 - \\alpha p_1^2 \\end{pmatrix} $$\n\n**2. Derive the Jacobian Matrix**\nThe Jacobian matrix $J(x)$ contains the partial derivatives of $F(x)$:\n$$ J(x) = \\begin{pmatrix} \\frac{\\partial F_1}{\\partial p_2}  \\frac{\\partial F_1}{\\partial q_{12}} \\\\ \\frac{\\partial F_2}{\\partial p_2}  \\frac{\\partial F_2}{\\partial q_{12}} \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ 2 \\alpha p_2  2 q_{12} \\end{pmatrix} $$\n\n**3. Compute the Newton Step at the Current Iterate**\nThe given data are: $p_1 = 50$, $d_2 = 5$, $\\alpha = 0.02$. The current iterate is $x^{(k)} = (p_2^{(k)}, q_{12}^{(k)}) = (49, 3)$.\n\n- **Evaluate the residual vector $F(x^{(k)})$**:\n$$ F_1^{(k)} = 3 - 5 = -2 $$\n$$ F_2^{(k)} = 3^2 - 0.02(50^2 - 49^2) = 9 - 0.02(2500 - 2401) = 9 - 0.02(99) = 9 - 1.98 = 7.02 $$\nSo, $F^{(k)} = \\begin{pmatrix} -2 \\\\ 7.02 \\end{pmatrix}$.\n\n- **Evaluate the Jacobian matrix $J(x^{(k)})$**:\n$$ J^{(k)} = \\begin{pmatrix} 0  1 \\\\ 2(0.02)(49)  2(3) \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ 1.96  6 \\end{pmatrix} $$\n\n- **Solve the linear system $J^{(k)} \\Delta x^{(k)} = -F^{(k)}$**:\nLet $\\Delta x^{(k)} = \\begin{pmatrix} \\Delta p_2 \\\\ \\Delta q_{12} \\end{pmatrix}$. The system is:\n$$ \\begin{pmatrix} 0  1 \\\\ 1.96  6 \\end{pmatrix} \\begin{pmatrix} \\Delta p_2 \\\\ \\Delta q_{12} \\end{pmatrix} = - \\begin{pmatrix} -2 \\\\ 7.02 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ -7.02 \\end{pmatrix} $$\nFrom the first row: $0 \\cdot \\Delta p_2 + 1 \\cdot \\Delta q_{12} = 2 \\implies \\Delta q_{12} = 2$.\nFrom the second row: $1.96 \\cdot \\Delta p_2 + 6 \\cdot \\Delta q_{12} = -7.02$. Substituting $\\Delta q_{12}$:\n$$ 1.96 \\cdot \\Delta p_2 + 6(2) = -7.02 $$\n$$ 1.96 \\cdot \\Delta p_2 = -7.02 - 12 = -19.02 $$\n$$ \\Delta p_2 = \\frac{-19.02}{1.96} \\approx -9.70408 $$\n\n**4. Update the State**\nThe new state is $x^{(k+1)} = x^{(k)} + \\Delta x^{(k)}$:\n$$ p_2^{(k+1)} = p_2^{(k)} + \\Delta p_2 = 49 - 9.70408 = 39.29592 \\text{ bar} $$\n$$ q_{12}^{(k+1)} = q_{12}^{(k)} + \\Delta q_{12} = 3 + 2 = 5 \\text{ Sm}^3/\\text{s} $$\nRounding to four significant figures:\n$$ p_2^{(k+1)} = 39.30 \\text{ bar} $$\n$$ q_{12}^{(k+1)} = 5.000 \\text{ Sm}^3/\\text{s} $$\n\n**Physical Interpretation:**\nThe initial flow ($3$ Sm$^3$/s) was less than the demand ($5$ Sm$^3$/s), so the mass balance equation had a residual of $-2$. The Newton step for flow, $\\Delta q_{12} = +2$, corrects this deficit exactly in one step because the mass balance equation is linear. To drive this higher flow through the pipe, a larger pressure drop is required. Since $p_1$ is fixed, $p_2$ must decrease. The Newton step correctly calculates a large negative update for the pressure, $\\Delta p_2 \\approx -9.70$ bar, to create the necessary pressure differential to support a flow of $5$ Sm$^3$/s. The updated state $(39.30, 5.000)$ now perfectly satisfies the mass balance equation, and is much closer to satisfying the Weymouth pressure-flow equation.",
            "answer": "$$ \\boxed{\\begin{pmatrix} 39.30  5.000 \\end{pmatrix}} $$"
        }
    ]
}