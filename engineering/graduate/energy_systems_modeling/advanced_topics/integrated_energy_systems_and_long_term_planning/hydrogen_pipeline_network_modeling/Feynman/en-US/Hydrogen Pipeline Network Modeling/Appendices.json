{
    "hands_on_practices": [
        {
            "introduction": "The structural integrity of a pipeline is the foremost concern in its design. This first exercise grounds our network modeling in fundamental solid mechanics, challenging you to derive the minimum required wall thickness for a high-pressure hydrogen pipeline from first principles. By applying Lamé's equations for thick-walled cylinders, you will connect material properties and operating pressures to a critical design parameter, ensuring the safety of the infrastructure .",
            "id": "4095685",
            "problem": "A straight, buried hydrogen transmission pipeline segment is modeled as a long, isotropic, linearly elastic cylindrical shell subject to uniform internal pressure. The pipeline has a specified outside diameter $D_{o} = 762 \\text{ mm}$ and operates at a Maximum Allowable Operating Pressure (MAOP) $P = 7.5 \\text{ MPa}$. External ground pressure effects are negligible relative to $P$, so the external pressure at the pipe wall can be taken as zero. The material has an allowable stress in the hydrogen service environment of $S_{a} = 290 \\text{ MPa}$. The operator applies a design factor (DF) $F = 0.50$ to the allowable stress when sizing wall thickness to ensure conservatism under uncertainty.\n\nStarting from the fundamental equilibrium of stresses in a pressurized, thick-walled, axisymmetric cylinder and using appropriate boundary conditions, derive the expression for the circumferential (hoop) stress at the inner wall. Impose the condition that the maximum hoop stress at the inner wall shall not exceed the design-factored allowable stress, and determine the minimum wall thickness $t_{\\min}$ that satisfies this requirement. Treat the pipeline as a thick-walled cylinder with inner radius $r_{i}$ and outer radius $r_{o} = D_{o}/2$, and do not assume a thin-wall approximation in the derivation; you may use a thin-wall check only after obtaining the exact solution.\n\nCompute the numerical value of $t_{\\min}$ using the given parameters. Express the final answer in millimeters (mm) and round your result to four significant figures.",
            "solution": "The problem requires the determination of the minimum wall thickness of a thick-walled cylindrical pipeline under internal pressure, based on a specified allowable stress and design factor. The derivation must start from the fundamental stress equations for a thick-walled cylinder.\n\nThe general equations for radial stress, $\\sigma_r$, and circumferential (hoop) stress, $\\sigma_{\\theta}$, at a radius $r$ in a thick-walled cylinder subjected to internal and external pressure are known as Lamé's equations:\n$$ \\sigma_r(r) = A - \\frac{B}{r^2} $$\n$$ \\sigma_{\\theta}(r) = A + \\frac{B}{r^2} $$\nwhere $A$ and $B$ are constants determined by the boundary conditions.\n\nThe pipeline has an inner radius $r_i$ and an outer radius $r_o$. The problem specifies the following boundary conditions:\n1.  At the inner surface ($r=r_i$), the radial stress is equal to the negative of the internal pressure, $P$.\n    $$ \\sigma_r(r_i) = -P $$\n2.  At the outer surface ($r=r_o$), the external pressure is negligible, so it is taken as zero.\n    $$ \\sigma_r(r_o) = 0 $$\n\nWe apply these boundary conditions to solve for the constants $A$ and $B$.\nFrom the second boundary condition:\n$$ \\sigma_r(r_o) = A - \\frac{B}{r_o^2} = 0 \\implies A = \\frac{B}{r_o^2} $$\n\nSubstitute this expression for $A$ into the first boundary condition:\n$$ \\sigma_r(r_i) = \\frac{B}{r_o^2} - \\frac{B}{r_i^2} = -P $$\nFactor out $B$:\n$$ B \\left( \\frac{1}{r_o^2} - \\frac{1}{r_i^2} \\right) = -P $$\n$$ B \\left( \\frac{r_i^2 - r_o^2}{r_i^2 r_o^2} \\right) = -P $$\nSolving for $B$:\n$$ B = \\frac{-P r_i^2 r_o^2}{r_i^2 - r_o^2} = \\frac{P r_i^2 r_o^2}{r_o^2 - r_i^2} $$\n\nNow, solve for $A$:\n$$ A = \\frac{B}{r_o^2} = \\frac{1}{r_o^2} \\left( \\frac{P r_i^2 r_o^2}{r_o^2 - r_i^2} \\right) = \\frac{P r_i^2}{r_o^2 - r_i^2} $$\n\nWith $A$ and $B$ determined, we can write the expression for the hoop stress $\\sigma_{\\theta}(r)$:\n$$ \\sigma_{\\theta}(r) = A + \\frac{B}{r^2} = \\frac{P r_i^2}{r_o^2 - r_i^2} + \\frac{1}{r^2} \\left( \\frac{P r_i^2 r_o^2}{r_o^2 - r_i^2} \\right) $$\n$$ \\sigma_{\\theta}(r) = \\frac{P r_i^2}{r_o^2 - r_i^2} \\left( 1 + \\frac{r_o^2}{r^2} \\right) $$\nThe hoop stress is tensile and is maximum at the inner wall, where $r=r_i$. Substituting $r=r_i$ into the equation gives the maximum hoop stress, $\\sigma_{\\theta, \\max}$:\n$$ \\sigma_{\\theta, \\max} = \\sigma_{\\theta}(r_i) = \\frac{P r_i^2}{r_o^2 - r_i^2} \\left( 1 + \\frac{r_o^2}{r_i^2} \\right) $$\n$$ \\sigma_{\\theta, \\max} = \\frac{P r_i^2}{r_o^2 - r_i^2} \\left( \\frac{r_i^2 + r_o^2}{r_i^2} \\right) $$\n$$ \\sigma_{\\theta, \\max} = P \\frac{r_o^2 + r_i^2}{r_o^2 - r_i^2} $$\nThis is the derived expression for the hoop stress at the inner wall.\n\nThe problem states that this maximum stress must not exceed the design-factored allowable stress. The allowable stress is $S_a$ and the design factor is $F$. Thus, the design stress limit is $S_{design} = F \\cdot S_a$. The condition for minimum thickness is:\n$$ \\sigma_{\\theta, \\max} = F \\cdot S_a $$\n$$ P \\frac{r_o^2 + r_i^2}{r_o^2 - r_i^2} = F S_a $$\n\nWe must now solve this equation for the wall thickness, $t = r_o - r_i$. Let's first solve for the ratio $r_o/r_i$:\n$$ P(r_o^2 + r_i^2) = F S_a (r_o^2 - r_i^2) $$\n$$ P r_o^2 + P r_i^2 = F S_a r_o^2 - F S_a r_i^2 $$\n$$ r_i^2 (P + F S_a) = r_o^2 (F S_a - P) $$\n$$ \\frac{r_o^2}{r_i^2} = \\frac{F S_a + P}{F S_a - P} $$\n$$ \\frac{r_o}{r_i} = \\sqrt{\\frac{F S_a + P}{F S_a - P}} $$\n\nThe wall thickness is $t = r_o - r_i$. From the previous equation, we can express $r_i$ in terms of $r_o$:\n$$ r_i = r_o \\sqrt{\\frac{F S_a - P}{F S_a + P}} $$\nSubstituting this into the expression for thickness, we find the minimum required thickness, $t_{\\min}$:\n$$ t_{\\min} = r_o - r_o \\sqrt{\\frac{F S_a - P}{F S_a + P}} $$\n$$ t_{\\min} = r_o \\left( 1 - \\sqrt{\\frac{F S_a - P}{F S_a + P}} \\right) $$\n\nNow, we substitute the given numerical values:\nOutside diameter $D_o = 762 \\text{ mm}$, so the outer radius is $r_o = \\frac{D_o}{2} = \\frac{762}{2} = 381 \\text{ mm}$.\nInternal pressure $P = 7.5 \\text{ MPa}$.\nAllowable stress $S_a = 290 \\text{ MPa}$.\nDesign factor $F = 0.50$.\n\nFirst, calculate the design stress limit:\n$$ F S_a = 0.50 \\times 290 \\text{ MPa} = 145 \\text{ MPa} $$\nNow, substitute this and other values into the expression for $t_{\\min}$:\n$$ t_{\\min} = 381 \\left( 1 - \\sqrt{\\frac{145 - 7.5}{145 + 7.5}} \\right) $$\n$$ t_{\\min} = 381 \\left( 1 - \\sqrt{\\frac{137.5}{152.5}} \\right) $$\n$$ t_{\\min} = 381 \\left( 1 - \\sqrt{0.90163934...} \\right) $$\n$$ t_{\\min} = 381 \\left( 1 - 0.94954691... \\right) $$\n$$ t_{\\min} = 381 \\left( 0.05045308... \\right) $$\n$$ t_{\\min} \\approx 19.2226257 \\text{ mm} $$\n\nThe problem requires the final answer to be rounded to four significant figures.\n$$ t_{\\min} \\approx 19.22 \\text{ mm} $$",
            "answer": "$$\\boxed{19.22}$$"
        },
        {
            "introduction": "With the design of a single pipeline segment understood, we now scale up to analyze a small network. This practice introduces the fundamental principles of nodal analysis, where mass conservation must hold at every junction. You will model a three-node system incorporating supply, demand, and a compressor, using the Weymouth equation to relate pressure drop and flow, and ultimately solve for the required supply pressure to keep the network in balance .",
            "id": "4095759",
            "problem": "Consider a steady-state, isothermal, single-phase hydrogen pipeline network with three nodes and two directed edges. Node $1$ is a supply node feeding a compressor; Node $2$ is a junction node with a fixed withdrawal (demand); Node $3$ is a demand node with a specified withdrawal and a minimum pressure requirement. The topology is: an edge from Node $1$ to Node $2$ that includes a compressor at the inlet of the edge, and an edge from Node $2$ to Node $3$. Elevation differences are negligible, all pressures are absolute, and hydrogen behaves as an ideal gas under these operating conditions. Let flows be positive in the direction of the edge orientation.\n\nUse the following widely accepted modeling foundations:\n- Conservation of mass at each node (steady-state nodal continuity).\n- The isothermal Weymouth-type relation for turbulent gas flow in pipelines: for a pipeline from node $i$ to node $j$ with $p_i > p_j$, the mass flow is $q_{ij} = K_{ij}\\sqrt{p_i^2 - p_j^2}$, where $K_{ij} > 0$ is a constant that aggregates pipe geometry, friction, and gas properties.\n- An ideal compressor raises the inlet pressure $p_{\\text{in}}$ to $p_{\\text{out}} = \\alpha p_{\\text{in}}$, where $\\alpha > 1$ is the compressor pressure ratio, and the mass flow across the compressor is conserved.\n\nNetwork data:\n- Compressor on edge $(1 \\to 2)$ has pressure ratio $\\alpha = 1.30$.\n- Pipeline $(1 \\to 2)$ constant $K_{12} = 4.0 \\times 10^{-6}\\ \\text{kg}\\cdot\\text{s}^{-1}\\cdot\\text{Pa}^{-1}$.\n- Pipeline $(2 \\to 3)$ constant $K_{23} = 5.0 \\times 10^{-6}\\ \\text{kg}\\cdot\\text{s}^{-1}\\cdot\\text{Pa}^{-1}$.\n- Demand at Node $2$: $D_2 = 5.0\\ \\text{kg}\\cdot\\text{s}^{-1}$.\n- Demand at Node $3$: $D_3 = 15.0\\ \\text{kg}\\cdot\\text{s}^{-1}$.\n- Node $3$ pressure requirement: $p_3 = 6.0\\ \\text{MPa}$.\n\nTasks:\n1. Define the nodal continuity equations for Nodes $1$, $2$, and $3$ in terms of the edge mass flows $q_{12}$ and $q_{23}$, the supply injection at Node $1$ denoted $S_1$, and the withdrawals $D_2$ and $D_3$.\n2. Using the compressor relation and the Weymouth-type pipeline relations, express $q_{12}$ and $q_{23}$ in terms of the node pressures and the given parameters.\n3. Derive a closed-form analytic expression for the minimum supply pressure at Node $1$, denoted $p_1$, required to satisfy the specified withdrawals while maintaining $p_3 = 6.0\\ \\text{MPa}$.\n4. Compute the numerical value of $p_1$ based on the provided data. Express the final pressure in megapascals (MPa) and round your answer to four significant figures.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the principles of fluid mechanics and network analysis, is well-posed with sufficient information to yield a unique solution, and is formulated objectively without ambiguity. We may therefore proceed with the solution.\n\nThe solution is structured to address the four tasks sequentially.\n\nTask 1: Nodal Continuity Equations\nIn a steady-state network, conservation of mass dictates that the sum of mass flows into any node must equal the sum of mass flows out of that node. Let $S_1$ be the supply at Node $1$, $D_2$ the demand at Node $2$, and $D_3$ the demand at Node $3$. Let $q_{12}$ and $q_{23}$ be the mass flows along the directed edges $(1 \\to 2)$ and $(2 \\to 3)$, respectively.\n\nFor Node $1$ (supply node): The inflow is $S_1$ and the outflow is $q_{12}$.\n$$S_1 = q_{12}$$\nFor Node $2$ (junction node): The inflow is $q_{12}$ and the outflows are the demand $D_2$ and the flow $q_{23}$.\n$$q_{12} = q_{23} + D_2$$\nFor Node $3$ (demand node): The inflow is $q_{23}$ and the outflow is the demand $D_3$.\n$$q_{23} = D_3$$\n\nTask 2: Flow-Pressure Relations\nThe problem specifies the isothermal Weymouth-type relation for turbulent gas flow, $q_{ij} = K_{ij}\\sqrt{p_i^2 - p_j^2}$, and an ideal compressor relation, $p_{\\text{out}} = \\alpha p_{\\text{in}}$.\n\nFor the edge $(1 \\to 2)$, a compressor at the inlet (Node $1$) raises the pressure from $p_1$ to $\\alpha p_1$. This boosted pressure is the inlet pressure for the pipeline segment. The outlet pressure of this segment is $p_2$. Thus, the mass flow $q_{12}$ is given by:\n$$q_{12} = K_{12}\\sqrt{(\\alpha p_1)^2 - p_2^2}$$\nFor the edge $(2 \\to 3)$, there is no compressor. The flow is directly governed by the pressures at Node $2$ and Node $3$:\n$$q_{23} = K_{23}\\sqrt{p_2^2 - p_3^2}$$\n\nTask 3: Derivation of the Analytic Expression for $p_1$\nWe derive the expression for the supply pressure $p_1$ by starting from the downstream boundary condition at Node $3$ and solving the system of equations backward.\n\nFirst, we determine the required flows from the continuity equations.\nFrom Node $3$ continuity: $q_{23} = D_3$.\nFrom Node $2$ continuity: $q_{12} = q_{23} + D_2 = D_3 + D_2$.\n\nNext, we use the flow-pressure relation for edge $(2 \\to 3)$ to find the pressure at Node $2$, $p_2$.\n$$q_{23} = K_{23}\\sqrt{p_2^2 - p_3^2}$$\nSubstituting $q_{23} = D_3$ and squaring both sides:\n$$D_3^2 = K_{23}^2 (p_2^2 - p_3^2)$$\nSolving for $p_2^2$:\n$$p_2^2 = p_3^2 + \\frac{D_3^2}{K_{23}^2} = p_3^2 + \\left(\\frac{D_3}{K_{23}}\\right)^2$$\nNow, we use the flow-pressure relation for edge $(1 \\to 2)$ to find the supply pressure $p_1$.\n$$q_{12} = K_{12}\\sqrt{(\\alpha p_1)^2 - p_2^2}$$\nSubstituting $q_{12} = D_2 + D_3$ and squaring both sides:\n$$\\left(D_2 + D_3\\right)^2 = K_{12}^2 ((\\alpha p_1)^2 - p_2^2)$$\nSolving for $(\\alpha p_1)^2$:\n$$(\\alpha p_1)^2 = p_2^2 + \\frac{(D_2 + D_3)^2}{K_{12}^2} = p_2^2 + \\left(\\frac{D_2 + D_3}{K_{12}}\\right)^2$$\nSubstitute the expression derived for $p_2^2$:\n$$(\\alpha p_1)^2 = \\left(p_3^2 + \\left(\\frac{D_3}{K_{23}}\\right)^2\\right) + \\left(\\frac{D_2 + D_3}{K_{12}}\\right)^2$$\nFinally, solving for $p_1$ by taking the square root (noting pressure is positive) and dividing by $\\alpha$:\n$$p_1 = \\frac{1}{\\alpha} \\sqrt{p_3^2 + \\left(\\frac{D_3}{K_{23}}\\right)^2 + \\left(\\frac{D_2 + D_3}{K_{12}}\\right)^2}$$\nThis is the closed-form analytic expression for the minimum supply pressure $p_1$ that satisfies all problem constraints.\n\nTask 4: Numerical Computation of $p_1$\nWe substitute the given numerical values into the derived expression. All calculations will be performed in base SI units (Pa, kg, s).\n\nGiven data:\n$\\alpha = 1.30$\n$K_{12} = 4.0 \\times 10^{-6}\\ \\text{kg}\\cdot\\text{s}^{-1}\\cdot\\text{Pa}^{-1}$\n$K_{23} = 5.0 \\times 10^{-6}\\ \\text{kg}\\cdot\\text{s}^{-1}\\cdot\\text{Pa}^{-1}$\n$D_2 = 5.0\\ \\text{kg}\\cdot\\text{s}^{-1}$\n$D_3 = 15.0\\ \\text{kg}\\cdot\\text{s}^{-1}$\n$p_3 = 6.0\\ \\text{MPa} = 6.0 \\times 10^6\\ \\text{Pa}$\n\nFirst, we compute the squared pressure terms.\n$$p_3^2 = (6.0 \\times 10^6\\ \\text{Pa})^2 = 36.0 \\times 10^{12}\\ \\text{Pa}^2$$\n$$\\left(\\frac{D_3}{K_{23}}\\right)^2 = \\left(\\frac{15.0}{5.0 \\times 10^{-6}}\\right)^2\\ \\text{Pa}^2 = (3.0 \\times 10^6)^2\\ \\text{Pa}^2 = 9.0 \\times 10^{12}\\ \\text{Pa}^2$$\n$$D_2 + D_3 = 5.0 + 15.0 = 20.0\\ \\text{kg}\\cdot\\text{s}^{-1}$$\n$$\\left(\\frac{D_2 + D_3}{K_{12}}\\right)^2 = \\left(\\frac{20.0}{4.0 \\times 10^{-6}}\\right)^2\\ \\text{Pa}^2 = (5.0 \\times 10^6)^2\\ \\text{Pa}^2 = 25.0 \\times 10^{12}\\ \\text{Pa}^2$$\nSumming these terms:\n$$p_3^2 + \\left(\\frac{D_3}{K_{23}}\\right)^2 + \\left(\\frac{D_2 + D_3}{K_{12}}\\right)^2 = (36.0 + 9.0 + 25.0) \\times 10^{12}\\ \\text{Pa}^2 = 70.0 \\times 10^{12}\\ \\text{Pa}^2$$\nNow, substitute this sum into the expression for $p_1$:\n$$p_1 = \\frac{1}{1.30} \\sqrt{70.0 \\times 10^{12}\\ \\text{Pa}^2} = \\frac{\\sqrt{70.0} \\times 10^6}{1.30}\\ \\text{Pa}$$\nCalculating the numerical value:\n$$p_1 \\approx \\frac{8.366600265 \\times 10^6}{1.30}\\ \\text{Pa} \\approx 6.435846358 \\times 10^6\\ \\text{Pa}$$\nConverting to megapascals:\n$$p_1 \\approx 6.435846358\\ \\text{MPa}$$\nRounding to four significant figures as requested:\n$$p_1 \\approx 6.436\\ \\text{MPa}$$",
            "answer": "$$\\boxed{6.436}$$"
        },
        {
            "introduction": "Modern energy systems are not just about feasibility, but also economic efficiency. This final exercise moves from static analysis to dynamic optimization, tasking you with minimizing the operational cost of a hydrogen system over time. You will learn to model the pipeline's inherent storage capacity—its linepack—as a flexible asset, using linear programming to create an optimal schedule for hydrogen injection that takes advantage of fluctuating electricity prices .",
            "id": "4095721",
            "problem": "You are tasked with computing the optimal dispatch schedule for a simplified integrated hydrogen pipeline system that minimizes electricity cost while meeting fixed withdrawals (demand) and respecting compressor limits and pipeline linepack storage constraints. The system consists of a single compressor injecting hydrogen into one pipeline segment, and a single demand node withdrawing hydrogen exogenously at each discrete time step. All quantities must be consistently modeled from fundamental physical principles and expressed in mathematically precise terms. Your program must solve the optimization problem for a specified test suite and output the total minimal electricity cost for each case on a single line.\n\nThe fundamental bases to use are:\n- Conservation of mass (inventory balance): the hydrogen inventory in the pipeline evolves by the net injection minus withdrawals.\n- Ideal Gas Law: the linepack inventory is the number of moles of hydrogen that can be stored within the pipeline at a given pressure.\n- Isentropic compression of an ideal gas with a constant ratio of specific heats, and a fixed isentropic efficiency.\n\nDefine the discrete time horizon with $T$ periods and time step $\\Delta t$ in hours, and denote by $x_t$ the compressor injection (in $\\mathrm{kmol}$) in period $t$, and by $d_t$ the withdrawal (demand) (in $\\mathrm{kmol}$) in period $t$. Let $L_t$ be the pipeline inventory (in $\\mathrm{kmol}$) at the end of period $t$. The inventory dynamics must satisfy the conservation of mass:\n$$\nL_{t+1} = L_t + x_t - d_t \\quad \\text{for all } t \\in \\{0,1,\\dots,T-1\\},\n$$\nwith $L_0$ given by the initial pressure using the Ideal Gas Law. Impose a terminal inventory constraint $L_T = L_0$ so the net inventory is unchanged over the horizon. Impose storage bounds $L_{\\min} \\le L_t \\le L_{\\max}$ for all $t \\in \\{1,\\dots,T-1\\}$ derived from minimum and maximum pipeline pressures via the Ideal Gas Law.\n\nUse the Ideal Gas Law to relate moles $n$ to pressure $p$, volume $V$, temperature $T$ and the universal gas constant $R$:\n$$\nn = \\frac{p\\,V}{R\\,T}.\n$$\nConvert to $\\mathrm{kmol}$ by dividing by $1000$. Compute $L_{\\min}$, $L_{\\max}$, and $L_0$ using $p_{\\min}$, $p_{\\max}$, and $p_0$, respectively. All pressures must be used in Pascal, with the conversion $1\\,\\mathrm{bar} = 10^{5}\\,\\mathrm{Pa}$.\n\nModel compressor energy using isentropic compression of an ideal gas with ratio of specific heats $k$ (also known as the adiabatic index), inlet temperature $T_{\\mathrm{in}}$, inlet pressure $p_{\\mathrm{in}}$, outlet pressure $p_{\\mathrm{out}}$, and isentropic efficiency $\\eta$. The specific compression work per mole (in $\\mathrm{J/mol}$) is given by\n$$\nw_{\\mathrm{mol}} = \\frac{k}{k-1}\\,R\\,T_{\\mathrm{in}} \\left[\\left(\\frac{p_{\\mathrm{out}}}{p_{\\mathrm{in}}}\\right)^{\\frac{k-1}{k}} - 1\\right]\\frac{1}{\\eta}.\n$$\nConvert this to per-period energy per injected $\\mathrm{kmol}$ (in $\\mathrm{MWh/kmol}$) by\n$$\n\\alpha = \\frac{1000\\,w_{\\mathrm{mol}}}{3.6\\times 10^{9}}.\n$$\nAssume the compressor operates to maintain a fixed compression ratio $\\frac{p_{\\mathrm{out}}}{p_{\\mathrm{in}}}$ over the horizon, and that injection $x_t$ immediately contributes to linepack. Impose a per-period compressor energy limit $E_{\\max} = P_{\\max}\\,\\Delta t$ (in $\\mathrm{MWh}$), yielding an injection upper bound\n$$\n0 \\le x_t \\le x_{\\max} = \\frac{E_{\\max}}{\\alpha}.\n$$\n\nLet $c_t$ be the electricity price in $\\mathrm{\\$/MWh}$ at period $t$. The per-period compressor energy is $E_t = \\alpha\\,x_t$, and the total electricity cost is\n$$\n\\text{Cost} = \\sum_{t=0}^{T-1} c_t\\,E_t = \\sum_{t=0}^{T-1} c_t\\,\\alpha\\,x_t.\n$$\nYou must formulate and solve the resulting linear optimization problem that minimizes $\\text{Cost}$ subject to the inventory dynamics, bounds, terminal inventory constraint, and nonnegativity/bounds on injection.\n\nPhysical constants and units to use:\n- Universal gas constant $R = 8.314462618\\,\\mathrm{J/(mol\\cdot K)}$.\n- Hydrogen (chemical symbol $\\mathrm{H_2}$) is treated as an ideal gas with ratio of specific heats $k$ and constant temperature $T$.\n- All pressures must be converted from $\\mathrm{bar}$ to $\\mathrm{Pa}$ by multiplying by $10^{5}$.\n- Pipeline volume $V$ is in $\\mathrm{m^3}$.\n- Temperature $T$ and $T_{\\mathrm{in}}$ are in $\\mathrm{K}$.\n- Electricity prices $c_t$ are in $\\mathrm{\\$/MWh}$.\n- Compressor maximum power $P_{\\max}$ is in $\\mathrm{MW}$, and per-period energy limit $E_{\\max}$ is in $\\mathrm{MWh}$.\n- Demands $d_t$ and injections $x_t$ are in $\\mathrm{kmol}$.\n\nAnswer specification:\n- For each test case, compute the minimal total cost in dollars ($\\mathrm{\\$}$) as a float rounded to $3$ decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, e.g., $\\left[\\text{result1},\\text{result2},\\text{result3}\\right]$.\n\nTest Suite:\nCompute the minimal total cost for each of the following three cases. In all cases, use $\\Delta t = 1\\,\\mathrm{h}$ (that is, $\\Delta t = 1$), $R = 8.314462618\\,\\mathrm{J/(mol\\cdot K)}$, and $T = T_{\\mathrm{in}} = 300\\,\\mathrm{K}$ (that is, $T = 300$ and $T_{\\mathrm{in}} = 300$).\n\n- Case A (happy path, ample compressor capacity):\n    - Time periods: $T = 6$.\n    - Electricity prices (in $\\mathrm{\\$/MWh}$): $\\left[50,40,30,100,70,20\\right]$.\n    - Demands (in $\\mathrm{kmol}$): $\\left[3000,3500,4000,4500,3500,3000\\right]$.\n    - Pipeline volume: $V = 10000\\,\\mathrm{m^3}$.\n    - Pressure bounds: $p_{\\min} = 40\\,\\mathrm{bar}$, $p_{\\max} = 80\\,\\mathrm{bar}$.\n    - Initial pressure: $p_0 = 60\\,\\mathrm{bar}$.\n    - Compressor parameters: $p_{\\mathrm{in}} = 20\\,\\mathrm{bar}$, $p_{\\mathrm{out}} = 60\\,\\mathrm{bar}$, $k = 1.41$, $\\eta = 0.75$, $P_{\\max} = 100\\,\\mathrm{MW}$.\n\n- Case B (binding compressor capacity in peak hours but feasible overall):\n    - Time periods: $T = 6$.\n    - Electricity prices (in $\\mathrm{\\$/MWh}$): $\\left[80,60,50,200,150,40\\right]$.\n    - Demands (in $\\mathrm{kmol}$): $\\left[3000,3000,3000,4500,4500,3000\\right]$.\n    - Pipeline volume: $V = 10000\\,\\mathrm{m^3}$.\n    - Pressure bounds: $p_{\\min} = 40\\,\\mathrm{bar}$, $p_{\\max} = 80\\,\\mathrm{bar}$.\n    - Initial pressure: $p_0 = 70\\,\\mathrm{bar}$.\n    - Compressor parameters: $p_{\\mathrm{in}} = 10\\,\\mathrm{bar}$, $p_{\\mathrm{out}} = 80\\,\\mathrm{bar}$, $k = 1.41$, $\\eta = 0.75$, $P_{\\max} = 15\\,\\mathrm{MW}$.\n\n- Case C (negative price hours encourage shifting within storage bounds):\n    - Time periods: $T = 6$.\n    - Electricity prices (in $\\mathrm{\\$/MWh}$): $\\left[-10,-20,30,60,-5,25\\right]$.\n    - Demands (in $\\mathrm{kmol}$): $\\left[3500,3500,3500,3500,3500,3500\\right]$.\n    - Pipeline volume: $V = 10000\\,\\mathrm{m^3}$.\n    - Pressure bounds: $p_{\\min} = 30\\,\\mathrm{bar}$, $p_{\\max} = 70\\,\\mathrm{bar}$.\n    - Initial pressure: $p_0 = 50\\,\\mathrm{bar}$.\n    - Compressor parameters: $p_{\\mathrm{in}} = 50\\,\\mathrm{bar}$, $p_{\\mathrm{out}} = 70\\,\\mathrm{bar}$, $k = 1.41$, $\\eta = 0.75$, $P_{\\max} = 20\\,\\mathrm{MW}$.\n\nYour program must:\n- For each case, derive $L_{\\min}$, $L_{\\max}$, and $L_0$ via the Ideal Gas Law using pressures converted to $\\mathrm{Pa}$.\n- Derive $\\alpha$ via the isentropic compression relationship and convert to $\\mathrm{MWh/kmol}$.\n- Formulate and solve the linear program to find the optimal $x_t$.\n- Compute the minimal total cost in dollars for each case and print the list of three results in the specified single-line format. Express each result in dollars as a float rounded to $3$ decimal places.",
            "solution": "The user has provided a well-defined optimization problem for scheduling hydrogen injection in a pipeline network. The problem is to be modeled as a linear program (LP). I will first validate the problem statement according to the specified criteria.\n\n### Step 1: Extract Givens\nThe problem provides the following data, definitions, and equations:\n\n**Time Discretization:**\n- Time horizon with $T$ periods.\n- Time step $\\Delta t$ in hours.\n\n**Variables:**\n- $x_t$: compressor injection in $\\mathrm{kmol}$ in period $t$.\n- $d_t$: withdrawal (demand) in $\\mathrm{kmol}$ in period $t$.\n- $L_t$: pipeline inventory (linepack) in $\\mathrm{kmol}$ at the end of period $t$.\n\n**Physical Principles and Constraints:**\n- **Conservation of Mass:** $L_{t+1} = L_t + x_t - d_t$ for $t \\in \\{0, 1, \\dots, T-1\\}$.\n- **Initial and Terminal Inventory:** Initial inventory $L_0$ is given. Terminal inventory $L_T = L_0$.\n- **Inventory Bounds:** $L_{\\min} \\le L_t \\le L_{\\max}$ for $t \\in \\{1, \\dots, T-1\\}$.\n- **Ideal Gas Law:** $n = \\frac{p\\,V}{R\\,T}$, used to calculate $L_0$, $L_{\\min}$, and $L_{\\max}$ from pressures $p_0$, $p_{\\min}$, and $p_{\\max}$. Note that the problem uses $L$ for kilomoles, so $L = n/1000$.\n- **Compressor Work:** Specific work per mole is $w_{\\mathrm{mol}} = \\frac{k}{k-1}\\,R\\,T_{\\mathrm{in}} \\left[\\left(\\frac{p_{\\mathrm{out}}}{p_{\\mathrm{in}}}\\right)^{\\frac{k-1}{k}} - 1\\right]\\frac{1}{\\eta}$.\n- **Energy Conversion:** Specific energy per kilomole is $\\alpha = \\frac{1000\\,w_{\\mathrm{mol}}}{3.6\\times 10^{9}}\\,\\mathrm{[MWh/kmol]}$.\n- **Injection Bounds:** $0 \\le x_t \\le x_{\\max}$, where $x_{\\max} = \\frac{E_{\\max}}{\\alpha}$ and $E_{\\max} = P_{\\max}\\,\\Delta t$.\n\n**Objective Function:**\n- Minimize total electricity cost: $\\text{Cost} = \\sum_{t=0}^{T-1} c_t\\,\\alpha\\,x_t$, where $c_t$ is the electricity price in $\\mathrm{\\$/MWh}$.\n\n**Physical Constants and Parameters:**\n- $R = 8.314462618\\,\\mathrm{J/(mol\\cdot K)}$.\n- $1\\,\\mathrm{bar} = 10^{5}\\,\\mathrm{Pa}$.\n- Pipeline volume $V$ in $\\mathrm{m^3}$.\n- Temperatures $T, T_{\\mathrm{in}}$ in $\\mathrm{K}$.\n- Compressor ratio of specific heats $k$, efficiency $\\eta$, inlet/outlet pressures $p_{\\mathrm{in}}, p_{\\mathrm{out}}$, max power $P_{\\max}$.\n\n**Test Suite Data:**\n- Three cases (A, B, C) are provided with specific numerical values for all parameters: $T$, $\\Delta t$, $c_t$, $d_t$, $V$, $p_{\\min}$, $p_{\\max}$, $p_0$, $p_{\\mathrm{in}}$, $p_{\\mathrm{out}}$, $k$, $\\eta$, $P_{\\max}$, $T$, $T_{\\mathrm{in}}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Soundness:** The problem is firmly grounded in fundamental principles of thermodynamics (Ideal Gas Law, isentropic compression) and mass conservation. The equations provided are standard models used in energy systems engineering. The treatment of hydrogen as an ideal gas is a common and acceptable simplification for this type of modeling problem. All physical relationships are correct.\n2.  **Non-Formalizable or Irrelevant:** The problem is highly formalizable. It explicitly asks for the formulation and solution of a linear optimization problem, which is a standard mathematical technique. The topic is directly relevant to hydrogen pipeline network modeling.\n3.  **Incomplete or Contradictory Setup:** All necessary data and parameters for solving the problem are provided for each test case. There are no apparent contradictions in the constraints. The terminal constraint $L_T=L_0$ combined with the mass balance implies $\\sum x_t = \\sum d_t$, ensuring total injection meets total demand, which is a logical consistency check.\n4.  **Unrealistic or Infeasible:** The parameter values given in the test cases are within physically plausible ranges for hydrogen pipeline operations. Pressures, temperatures, and equipment ratings are realistic. There are no dimensional inconsistencies.\n5.  **Ill-Posed or Poorly Structured:** The problem is structured as a linear program. The objective function is linear, and all constraints (mass balance, inventory bounds, injection bounds) are linear in the decision variables $x_t$. The feasible region is a convex polytope, and a linear objective function over such a region is guaranteed to have a minimum if the region is non-empty. The test cases appear to be designed to have feasible solutions. Therefore, the problem is well-posed.\n6.  **Pseudo-Profound, Trivial, or Tautological:** The problem is not trivial. It requires correctly deriving a set of parameters from physical principles and then formulating and solving a constrained optimization problem. The interplay between time-varying prices, demand, and storage constraints presents a genuine optimization challenge.\n7.  **Outside Scientific Verifiability:** The problem is a mathematical optimization task based on scientific models. The solution is verifiable by solving the LP and checking that the resulting schedule satisfies all constraints and achieves the minimum cost.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is scientifically sound, well-posed, and all necessary information is provided. I will now proceed with the solution.\n\nThe problem is a linear program (LP) of the form:\n$$\n\\begin{aligned}\n& \\underset{x_0, \\dots, x_{T-1}}{\\text{minimize}} && \\sum_{t=0}^{T-1} (\\alpha c_t) x_t \\\\\n& \\text{subject to} \\\\\n& && L_0 + \\sum_{i=0}^{t-1} (x_i - d_i) \\le L_{\\max}, & \\quad \\forall t \\in \\{1, \\dots, T-1\\} \\\\\n& && L_0 + \\sum_{i=0}^{t-1} (x_i - d_i) \\ge L_{\\min}, & \\quad \\forall t \\in \\{1, \\dots, T-1\\} \\\\\n& && \\sum_{t=0}^{T-1} x_t = \\sum_{t=0}^{T-1} d_t \\\\\n& && 0 \\le x_t \\le x_{\\max}, & \\quad \\forall t \\in \\{0, \\dots, T-1\\}\n\\end{aligned}\n$$\n\nThe solution algorithm proceeds as follows for each test case:\n1.  **Parameter Calculation:**\n    - Convert all pressure values from $\\mathrm{bar}$ to $\\mathrm{Pa}$ by multiplying by $10^5$.\n    - Calculate the inventory-to-pressure conversion factor, $\\frac{V}{R T \\times 1000}$, which gives $\\mathrm{kmol/Pa}$.\n    - Use this factor to compute the initial inventory $L_0$ and the bounds $L_{\\min}$ and $L_{\\max}$ from the respective pressures $p_0$, $p_{\\min}$, and $p_{\\max}$.\n    - Calculate the specific energy consumption $\\alpha$ in $\\mathrm{MWh/kmol}$ using the given formula for isentropic compression work $w_{\\mathrm{mol}}$.\n    - Calculate the maximum hourly energy supply $E_{\\max} = P_{\\max} \\Delta t$ and the corresponding maximum injection rate $x_{\\max} = E_{\\max} / \\alpha$.\n\n2.  **LP Formulation:**\n    - The decision variables are the injections $x_t$ for $t=0, \\dots, T-1$.\n    - The objective function coefficient for each $x_t$ is $\\alpha c_t$.\n    - The constraints are formulated for use with a standard LP solver (`scipy.optimize.linprog`):\n        - **Equality Constraints ($A_{eq}x = b_{eq}$):** A single constraint ensures total injection equals total demand over the horizon.\n        - **Inequality Constraints ($A_{ub}x \\le b_{ub}$):** These represent the upper and lower bounds on the pipeline inventory $L_t$ for each time step $t \\in \\{1, \\dots, T-1\\}$.\n        - **Variable Bounds:** Simple bounds on each decision variable, $0 \\le x_t \\le x_{\\max}$.\n\n3.  **Solving and Reporting:**\n    - The constructed LP is solved using `scipy.optimize.linprog`.\n    - The optimal value of the objective function, which represents the minimum total cost, is extracted.\n    - The cost is rounded to $3$ decimal places as required. This process is repeated for all test cases, and the results are aggregated into a single list for the final output.\n\nThis methodology will be implemented in Python, using the `numpy` library for efficient array operations and `scipy.optimize.linprog` for solving the optimization problem.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the solving of all test cases.\n    \"\"\"\n    # Universal constants and parameters\n    R = 8.314462618  # J/(mol.K)\n    bar_to_pa = 1e5\n    j_to_mwh = 1 / (3.6e9)\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"T\": 6, \"delta_t\": 1.0,\n            \"prices\": [50, 40, 30, 100, 70, 20],\n            \"demands\": [3000, 3500, 4000, 4500, 3500, 3000],\n            \"V\": 10000.0,\n            \"p_min\": 40.0, \"p_max\": 80.0, \"p_0\": 60.0,\n            \"p_in\": 20.0, \"p_out\": 60.0,\n            \"k\": 1.41, \"eta\": 0.75, \"P_max\": 100.0,\n            \"T_gas\": 300.0, \"T_in\": 300.0\n        },\n        {\n            \"name\": \"Case B\",\n            \"T\": 6, \"delta_t\": 1.0,\n            \"prices\": [80, 60, 50, 200, 150, 40],\n            \"demands\": [3000, 3000, 3000, 4500, 4500, 3000],\n            \"V\": 10000.0,\n            \"p_min\": 40.0, \"p_max\": 80.0, \"p_0\": 70.0,\n            \"p_in\": 10.0, \"p_out\": 80.0,\n            \"k\": 1.41, \"eta\": 0.75, \"P_max\": 15.0,\n            \"T_gas\": 300.0, \"T_in\": 300.0\n        },\n        {\n            \"name\": \"Case C\",\n            \"T\": 6, \"delta_t\": 1.0,\n            \"prices\": [-10, -20, 30, 60, -5, 25],\n            \"demands\": [3500, 3500, 3500, 3500, 3500, 3500],\n            \"V\": 10000.0,\n            \"p_min\": 30.0, \"p_max\": 70.0, \"p_0\": 50.0,\n            \"p_in\": 50.0, \"p_out\": 70.0,\n            \"k\": 1.41, \"eta\": 0.75, \"P_max\": 20.0,\n            \"T_gas\": 300.0, \"T_in\": 300.0\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        cost = _compute_cost(params, R, bar_to_pa, j_to_mwh)\n        results.append(round(cost, 3))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _compute_cost(params, R, bar_to_pa, j_to_mwh):\n    \"\"\"\n    Computes the minimal electricity cost for a single test case.\n    \"\"\"\n    # Unpack parameters\n    T = params[\"T\"]\n    delta_t = params[\"delta_t\"]\n    prices = np.array(params[\"prices\"])\n    demands = np.array(params[\"demands\"])\n    V = params[\"V\"]\n    p_min_bar, p_max_bar, p_0_bar = params[\"p_min\"], params[\"p_max\"], params[\"p_0\"]\n    p_in_bar, p_out_bar = params[\"p_in\"], params[\"p_out\"]\n    k, eta, P_max = params[\"k\"], params[\"eta\"], params[\"P_max\"]\n    T_gas, T_in = params[\"T_gas\"], params[\"T_in\"]\n\n    # 1. Calculate derived constants\n    p_in = p_in_bar * bar_to_pa\n    p_out = p_out_bar * bar_to_pa\n    \n    # Linepack (inventory) calculation in kmol\n    # L = (p * V) / (R * T_gas * 1000)\n    kmol_per_pa = V / (R * T_gas * 1000.0)\n    L_min = p_min_bar * bar_to_pa * kmol_per_pa\n    L_max = p_max_bar * bar_to_pa * kmol_per_pa\n    L_0 = p_0_bar * bar_to_pa * kmol_per_pa\n\n    # Specific energy consumption alpha (MWh/kmol)\n    compression_ratio = p_out / p_in\n    exponent = (k - 1) / k\n    w_mol = (k / (k - 1)) * R * T_in * (compression_ratio**exponent - 1) / eta\n    alpha = (1000.0 * w_mol) * j_to_mwh\n\n    # Max injection rate x_max (kmol)\n    E_max = P_max * delta_t\n    x_max = E_max / alpha if alpha > 0 else float('inf')\n\n    # 2. Formulate the Linear Program\n    # Decision variables x_t for t=0, ..., T-1\n    n_vars = T\n    \n    # Objective function: minimize sum(c_t * alpha * x_t)\n    c = prices * alpha\n\n    # Equality constraint: sum(x_t) = sum(d_t)\n    A_eq = np.ones((1, n_vars))\n    b_eq = np.array([np.sum(demands)])\n    \n    # Inequality constraints for linepack: L_min <= L_t <= L_max\n    # This gives 2 * (T-1) constraints.\n    # L_t = L_0 + sum_{i=0}^{t-1} (x_i - d_i)\n    # Upper bound: sum_{i=0}^{t-1} x_i <= L_max - L_0 + sum_{i=0}^{t-1} d_i\n    # Lower bound: sum_{i=0}^{t-1} x_i >= L_min - L_0 + sum_{i=0}^{t-1} d_i\n    # --> -sum_{i=0}^{t-1} x_i <= -(L_min - L_0 + sum_{i=0}^{t-1} d_i)\n    \n    num_ineq_constraints = 2 * (T - 1)\n    A_ub = np.zeros((num_ineq_constraints, n_vars))\n    b_ub = np.zeros(num_ineq_constraints)\n\n    cumulative_demands = np.cumsum(demands)\n\n    for t_idx in range(T - 1): # Corresponds to t = 1, ..., T-1 for L_t\n        t = t_idx + 1 # Time step for inventory L_t\n        \n        # Upper bound constraint for L_t\n        A_ub[t_idx, :t] = 1.0\n        b_ub[t_idx] = L_max - L_0 + cumulative_demands[t_idx]\n\n        # Lower bound constraint for L_t\n        A_ub[t_idx + T - 1, :t] = -1.0\n        b_ub[t_idx + T - 1] = -(L_min - L_0 + cumulative_demands[t_idx])\n\n    # Bounds on variables: 0 <= x_t <= x_max\n    bounds = [(0, x_max) for _ in range(n_vars)]\n\n    # 3. Solve the LP\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n    if not res.success:\n        raise RuntimeError(f\"LP solver failed for {params['name']}: {res.message}\")\n\n    return res.fun\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}