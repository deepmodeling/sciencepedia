{
    "hands_on_practices": [
        {
            "introduction": "我们首先解决长期建模中的一个基本挑战：如何将数千小时的运行细节提炼成一组易于处理的“代表日”。本练习探讨了两种流行的聚类算法——k-均值（k-means）和k-中心点（k-medoids）——的选择，并要求我们思考哪种算法更适用于能源系统。在能源系统中，准确捕捉罕见但极端的事件（如热浪）对于保障系统可靠性至关重要。理解这一选择是构建一个既计算可行又具备风险意识的简化模型的第一步。",
            "id": "4102547",
            "problem": "一个垂直一体化的电力公司正在规划一个多年期的确定性容量，并将短期的运营可变性压缩为一组简化的代表性日，用于优化模型。设每日峰值需求的原始集合为 $\\{x_i\\}_{i=1}^N$，其表现出重尾行为：一小部分天数由于热浪或寒潮而呈现极端峰值。规划模型强制执行一个可靠性机会约束，形式为 $\\mathbb{P}(X \\le C) \\ge 1 - \\epsilon$，其中 $C$ 是容量，$X$ 表示基础过程中的随机日峰值，$\\epsilon \\in (0,1)$ 是一个小值。规划者也关心尾部风险，使用水平为 $\\alpha \\in (0,1)$ 的条件风险价值 (CVaR) 来衡量，定义为 $\\mathrm{CVaR}_\\alpha(Z) = \\mathbb{E}[Z \\mid Z \\ge \\mathrm{VaR}_\\alpha(Z)]$，其中 $Z$ 是损失，$\\mathrm{VaR}_\\alpha(Z)$ 是 $Z$ 的 $\\alpha$-分位数。\n\n为了形成 $k$ 个代表性日，规划者考虑对包括至少峰值 $x_i$ 和可能包括形状描述符的每日特征进行 $k$-means 或 $k$-medoids 聚类。聚类产生原型 $\\{y_j\\}_{j=1}^k$ 和权重 $\\{p_j\\}_{j=1}^k$（簇概率），然后在简化的优化中使用这些原型和权重来近似机会约束和尾部风险。为简化分析，我们关注一维情况，其中每日特征是峰值 $x_i \\in \\mathbb{R}$，具有重尾混合分布：$N-1$ 个典型峰值在 $x_i = \\mu$，一个极端峰值在 $x_N = \\mu + E$，$E \\gg 0$，并考虑当 $E$ 增长时的极限行为。假设 $k$-medoids 的相异性度量是绝对偏差 $|x - y|$，而 $k$-means 使用平方欧几里得偏差 $(x - y)^2$。简化模型使用原型 $\\{y_j\\}$ 来确定容量 $C$ 的大小，以便对于每个代表性日，模型都是可行的，并且当通过 $\\{p_j\\}$ 提升回原始分布时，机会约束和尾部风险的经验近似得到满足。\n\n下列哪个陈述最好地捕捉了 $k$-means 与 $k$-medoids 对极端峰值离群点的鲁棒性，并为在可靠性约束和尾部风险下的时域设计证明了更优选择？\n\nA. $k$-means 更可取：因为平方偏差随着 $E$ 的增长放大了极端日的影响，质心 $\\{y_j\\}$ 将向尾部移动，从而产生保守的容量规划，满足 $\\mathbb{P}(X \\le C) \\ge 1 - \\epsilon$ 并降低 $\\mathrm{CVaR}_\\alpha$。\n\nB. $k$-medoids 更可取：因为原型必须是实际观测到的日，并且目标函数基于绝对偏差，所以中心点对单个极端离群点不那么敏感，并避免将峰值平滑为中间值；通过考虑尾部的加权或设置专门的簇，$k$-medoids 可以将一个极端峰值日作为代表，保留尾部质量，从而更好地近似机会约束和 $\\mathrm{CVaR}_\\alpha$。\n\nC. 一旦使用簇概率 $\\{p_j\\}$，$k$-means 和 $k$-medoids 对于考虑尾部风险的时域设计是等效的，因为任何加权都会使原型在期望上相同，因此对 $\\mathbb{P}(X \\le C)$ 和 $\\mathrm{CVaR}_\\alpha$ 的近似是相同的。\n\nD. $k$-means 更可取：在聚类中最小化 $x_i$ 的方差直接最小化了容量短缺的尾部风险 $\\mathrm{CVaR}_\\alpha$，从而在不明确表示极端日的情况下确保满足可靠性约束。",
            "solution": "### **阶段一：问题验证**\n\n*   **步骤一：提取已知信息**\n    *   - 一个垂直一体化的电力公司正在规划一个多年期的确定性容量。\n    *   - 短期的运营可变性被压缩为一组简化的代表性日。\n    *   - 每日峰值需求的原始集合：$\\{x_i\\}_{i=1}^N$。\n    *   - $\\{x_i\\}$ 的分布具有重尾行为。\n    *   - 可靠性机会约束：$\\mathbb{P}(X \\le C) \\ge 1 - \\epsilon$，其中 $C$ 是容量，$X$ 是随机日峰值，$\\epsilon \\in (0,1)$ 很小。\n    *   - 尾部风险使用水平为 $\\alpha \\in (0,1)$ 的条件风险价值 (CVaR) 来衡量。\n    *   - CVaR 定义：$\\mathrm{CVaR}_\\alpha(Z) = \\mathbb{E}[Z \\mid Z \\ge \\mathrm{VaR}_\\alpha(Z)]$，其中 $Z$ 是损失，$\\mathrm{VaR}_\\alpha(Z)$ 是 $Z$ 的 $\\alpha$-分位数。\n    *   - 为了形成 $k$ 个代表性日，规划者考虑使用 $k$-means 或 $k$-medoids 聚类。\n    *   - 聚类基于至少包括峰值 $x_i$ 的每日特征。\n    *   - 聚类产生原型 $\\{y_j\\}_{j=1}^k$ 和权重 $\\{p_j\\}_{j=1}^k$（簇概率）。\n    *   - 简化分析案例：一维特征，峰值 $x_i \\in \\mathbb{R}$。\n    *   - 用于分析的数据集：$N-1$ 个典型峰值在 $x_i = \\mu$，一个极端峰值在 $x_N = \\mu + E$，$E \\gg 0$。考虑当 $E$ 增长时的极限行为。\n    *   - $k$-medoids 相异性度量：绝对偏差 $|x - y|$。\n    *   - $k$-means 相异性度量：平方欧几里得偏差 $(x - y)^2$。\n    *   - 简化模型使用 $\\{y_j\\}$ 和 $\\{p_j\\}$ 来确定容量 $C$ 的大小，以便对于每个代表性日，模型都是可行的，并且当通过 $\\{p_j\\}$ 提升回原始分布时，机会约束和尾部风险的经验近似得到满足。\n    *   - 问题：下列哪个陈述最好地捕捉了 $k$-means 与 $k$-medoids 对极端峰值离群点的鲁棒性，并为在可靠性约束和尾部风险下的时域设计证明了更优选择？\n\n*   **步骤二：使用提取的已知信息进行验证**\n    *   问题陈述在运筹学、统计学和能源系统建模领域内定义明确且有科学依据。\n    *   **科学依据：** 所提出的概念——$k$-means 和 $k$-medoids 聚类、机会约束、条件风险价值 (CVaR) 以及用于随机优化的代表性日——都是相关文献中标准且广泛使用的。简化的数据集是分析统计算法鲁棒性的经典方法。\n    *   **适定性：** 问题的结构旨在引出两种明确定义的算法（$k$-means 和 $k$-medoids）在特定、可分析处理的情景（单个大离群点）中行为的比较。目标——近似可靠性和尾部风险指标——为判断哪种算法更优提供了明确的标准。该问题允许一个唯一的、合理的答案。\n    *   **客观性：** 语言精确且技术性强。关键术语都给出了定义。设置是客观的，不依赖于主观声明。\n    *   **完整性和一致性：** 问题提供了分析两种聚类方法行为所需的所有必要信息。简化的数据集足以对两种算法在离群点敏感性背景下的核心差异进行概念性分析。没有内部矛盾。\n\n*   **步骤三：结论和行动**\n    *   问题有效。可以推导出严谨的解决方案。\n\n### **阶段二：解决方案推导和选项评估**\n\n#### 基于原理的推导\n\n问题要求比较 $k$-means 和 $k$-medoids 聚类，目的是为能源容量规划模型创建一组简化的代表性日。数据的关键特征是重尾，被简化为单个极端离群点。规划模型必须满足可靠性机会约束 $\\mathbb{P}(X \\le C) \\ge 1 - \\epsilon$，并通过 $\\mathrm{CVaR}_\\alpha$ 来考虑尾部风险。因此，一个成功的简化方法必须准确地表示极端峰值负荷。\n\n让我们分析两种算法在给定数据集上的行为：$\\{x_i\\}_{i=1}^N$ 其中对于 $i=1, \\dots, N-1$ 有 $x_i = \\mu$，而 $x_N = \\mu+E$ 且 $E \\gg 0$。我们假设簇的数量 $k$ 至少为2，这是将典型日与极端日分开的自然选择。\n\n**1. $k$-medoids 分析：**\n$k$-medoids 算法旨在找到一组 $k$ 个数据点（中心点）$\\{y_j\\}_{j=1}^k \\subseteq \\{x_i\\}_{i=1}^N$，以最小化到最近中心点的绝对偏差之和：\n$$ \\min \\sum_{j=1}^k \\sum_{x_i \\in C_j} |x_i - y_j| $$\n其中 $C_j$ 是分配给中心点 $y_j$ 的点集。\n\n对于 $k=2$ 和我们的数据集，中心点的唯一可能选择是 $\\mu$ 和 $\\mu+E$。让我们测试最优选择：$y_1 = \\mu$ 和 $y_2 = \\mu+E$。\n- $N-1$ 个在 $x_i=\\mu$ 的点被分配给中心点 $y_1=\\mu$，对成本的贡献为 $0$。\n- 单个在 $x_N=\\mu+E$ 的点被分配给中心点 $y_2=\\mu+E$，对成本的贡献为 $0$。\n总成本为 $0$，这是全局最小值。\n\n因此，对于 $k=2$，$k$-medoids 产生以下表示：\n- 原型：$y_1 = \\mu$（典型日）和 $y_2 = \\mu+E$（极端日）。\n- 权重：$p_1 = \\frac{N-1}{N}$ 和 $p_2 = \\frac{1}{N}$。\n\n这个简化模型完美地保留了原始的经验分布。极端峰值 $\\mu+E$ 被精确地表示为原型之一。这使得后续的优化模型能够“看到”峰值日的真实大小并据此做出决策。设置容量 $C \\ge \\mu+E$ 将满足机会约束 $\\mathbb{P}(X \\le C) = 1 \\ge 1-\\epsilon$（假设 $\\epsilon > 0$）。$\\mathrm{CVaR}$ 也可以从这个保留的分布中准确计算。关键特征是，极端日的原型是一个实际的、未经平均的极端观测值。\n\n**2. $k$-means 分析：**\n$k$-means 算法旨在找到一组 $k$ 个质心 $\\{y_j\\}_{j=1}^k$，以最小化平方欧几里得偏差之和：\n$$ \\min \\sum_{j=1}^k \\sum_{x_i \\in C_j} (x_i - y_j)^2 $$\n质心 $y_j$ 是其各自簇中点的均值，$y_j = \\frac{1}{|C_j|} \\sum_{x_i \\in C_j} x_i$。\n\n对于 $k=2$ 和我们的数据集，将平方误差和最小化到零的最优聚类是将 $N-1$ 个在 $\\mu$ 的点放在一个簇中，将单个在 $\\mu+E$ 的点放在另一个簇中。\n- 簇1：$\\{x_1, \\dots, x_{N-1}\\}$。质心 $y_1 = \\mu$。\n- 簇2：$\\{x_N\\}$。质心 $y_2 = \\mu+E$。\n这也产生了一个精确的表示。\n\n然而，问题询问的是方法的*鲁棒性*和一般性质。$k$-means 的平方误差成本函数使其对离群点高度敏感。虽然在这个简单的一维案例中，当 $k=2$ 时它工作得很好，但考虑一个稍微复杂一点的场景，其中存在中间数量的点，或者在更高维度中。一个离群点可以显著地“拉动”一个簇的质心。例如，如果一个簇包含点 $\\{\\mu+E, \\mu+E_2\\}$，其质心将是 $y_j = \\mu + (E+E_2)/2$。这是一个从未被观测到的人工值，它将两个峰值“平滑”成一个中间值。这种平均行为可能系统性地低估单个最高峰值，而这对于满足可靠性约束至关重要。机会约束要求知道最大值，而不是高值的平均值。\n\n相比之下，$k$-medoids 被约束为从实际数据中选择一个原型。如果簇包含 $\\{\\mu+E, \\mu+E_2\\}$，中心点将是 $\\mu+E$ 或 $\\mu+E_2$（取决于簇中的其他点），从而保留了一个真实的峰值。这种避免创建人工的、平滑的数据点的特性在规避风险的规划中是一个显著的优势。\n\n统计学中的“鲁棒性”一词通常指对离群点的不敏感性。中位数（以及引申出的中心点）是鲁棒的，而均值（和质心）则不是。例如，如果我们被迫使用 $k=1$，单个 $k$-medoids 原型将是 $y_1=\\mu$，忽略了离群点，这虽然鲁棒但对可靠性不利。单个 $k$-means 原型将是 $y_1 = \\mu + E/N$，它被离群点非鲁棒地拉动。关键的洞见在于这个性质如何转化为手头的任务。对于容量规划，我们不希望*忽略*离群点。我们希望*准确地表示它*。当 $k$ 足够大，允许为离群点设置一个专门的簇时，$k$-medoids 通过将离群点本身作为其原型，完美地实现了这一点，没有任何平滑或平均。其目标函数的鲁棒性保护了*其他*簇（例如，典型日的簇）不被离群点扭曲。\n\n#### 逐项选项分析\n\n**A. $k$-means 更可取：因为平方偏差随着 $E$ 的增长放大了极端日的影响，质心 $\\{y_j\\}$ 将向尾部移动，从而产生保守的容量规划，满足 $\\mathbb{P}(X \\le C) \\ge 1 - \\epsilon$ 并降低 $\\mathrm{CVaR}_\\alpha$。**\n**不正确。** 虽然平方偏差项确实意味着质心对离群点敏感，但这并不必然导致“保守”的容量规划。离群点的影响将质心拉向一个*平均*位置。如果一个簇包含一个极端点和几个不那么极端的点，产生的质心将是一个*小于*该极端点的值。基于这种平滑的、低于最大值的原型制定的容量计划将是非保守的，并且可能无法满足所需的可靠性。\n\n**B. $k$-medoids 更可取：因为原型必须是实际观测到的日，并且目标函数基于绝对偏差，所以中心点对单个极端离群点不那么敏感，并避免将峰值平滑为中间值；通过考虑尾部的加权或设置专门的簇，$k$-medoids 可以将一个极端峰值日作为代表，保留尾部质量，从而更好地近似机会约束和 $\\mathrm{CVaR}_\\alpha$。**\n**正确。** 这个陈述准确地描述了 $k$-medoids 在此应用中的优势。1. 原型是实际观测到的数据点，这防止了创建人工的、“平滑”的峰值。这对于模拟系统的真实压力至关重要。2. 使用绝对偏差使算法更加鲁棒。这意味着典型日的簇的中心点将位于 $\\mu$，并且不会因为遥远的极端日的存在而失真。3. 极端日与其他日非常不同，自然会形成自己的簇（对于 $k \\ge 2$），其中心点将是极端点本身（$\\mu+E$）。4. 这种对极端事件的明确和精确的表示正是正确建模机会约束和计算像 CVaR 这样的尾部风险度量所需要的。\n\n**C. 一旦使用簇概率 $\\{p_j\\}$，$k$-means 和 $k$-medoids 对于考虑尾部风险的时域设计是等效的，因为任何加权都会使原型在期望上相同，因此对 $\\mathbb{P}(X \\le C)$ 和 $\\mathrm{CVaR}_\\alpha$ 的近似是相同的。**\n**不正确。** 这两种方法在根本上是不同的，并且产生不同的原型集。原型 $\\{y_j\\}$ 是由聚类算法的目标函数决定的，而不是由聚类后确定的权重 $\\{p_j\\}$ 决定的。如分析所示，根据数据和 $k$ 的值，原型可以有显著差异。例如，$k$-means 的质心可以是一个原始数据中不存在的值，而 $k$-medoids 的原型必须存在。因此，最终的近似是不等效的。声称它们“在期望上相同”通常也是错误的。简化模型的期望是 $\\sum_j p_j y_j$。虽然 $k$-means 简化模型的总期望与数据的样本均值匹配，但 $k$-medoids 模型不一定。更重要的是，期望上的相等并不意味着在近似可靠性约束或 CVaR 方面是等效的，因为这些指标依赖于分布的尾部，而不仅仅是其均值。\n\n**D. $k$-means 更可取：在聚类中最小化 $x_i$ 的方差直接最小化了容量短缺的尾部风险 $\\mathrm{CVaR}_\\alpha$，从而在不明确表示极端日的情况下确保满足可靠性约束。**\n**不正确。** 这个陈述包含多个逻辑谬误。首先，$k$-means 最小化的是*簇内*方差之和，而不是像 CVaR 这样的全局风险指标。这两个目标之间没有直接的数学恒等关系。其次，声称可以在“不明确表示极端日的情况下”确保可靠性，这与可靠性规划的整个原则相悖。为了防范罕见但影响重大的事件，该事件必须在规划模型中得到明确考虑。像这个选项所建议的那样忽略或平均掉它，是通向系统失败的道路。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "选定代表性时段后，我们必须确保简化模型不会违反关键的物理约束，例如火电机组的最小启动和停机时间。本练习提供了一个具体的计算，用以确定要可行地表示一个典型的运行周期，所需的最少连续时间块数量。这个练习揭示了模型的时间结构与其捕捉关键跨期动态能力之间的直接联系。",
            "id": "4102481",
            "problem": "一个电力系统规划模型使用基于代表性时段的简化时序表示，以将长期投资决策与短期运行可行性相结合。考虑一个受最小启动和最小停机时间约束的单个非弹性火电机组，其调度通过一个二进制启停变量进行，该变量的状态只能在固定长度的代表性时段的边界处改变。\n\n假设以下基于物理现实的数据和建模选择：\n- 每个代表性时段的长度为 $L$ 小时，并且各时段按顺序连接以强制执行时序性。在本问题中，取 $L = 24$ 小时。\n- 该机组的最小启动时间为 $U$ 小时，最小停机时间为 $D$ 小时。在本问题中，取 $U = 72$ 小时， $D = 36$ 小时。\n- 典型的每周净负荷模式是，在没有最小时间约束的情况下，该机组在每个重复的周循环中会经济地连续启动 $H_{\\text{on}}$ 小时，然后连续停机 $H_{\\text{off}}$ 小时。在本问题中，取 $H_{\\text{on}} = 5 \\times 24$ 小时和 $H_{\\text{off}} = 2 \\times 24$ 小时，这反映了五个高负荷工作日和随后的两个低负荷周末日。\n\n仅从机组组合中最小启动和最小停机时间的核心定义，以及将代表性时段构建为固定长度时序块的构造出发，推导出一个必要的下界，即必须按顺序连接的代表性时段数量 $K$ 的下界，以使简化模型能够表示至少一个相对于机组最小时间约束可行且忠实于所述每周负荷状况的完整启停周循环。然后，在给定的数值下计算最小的 $K$。将最终答案表示为一个无单位的整数。无需四舍五入。",
            "solution": "在尝试求解之前，将对问题进行验证。\n\n### 第1步：提取已知条件\n- 代表性时段的长度：$L = 24$ 小时。\n- 火电机组的最小启动时间：$U = 72$ 小时。\n- 火电机组的最小停机时间：$D = 36$ 小时。\n- 每个周期的经济启动持续时间：$H_{\\text{on}} = 5 \\times 24$ 小时。\n- 每个周期的经济停机持续时间：$H_{\\text{off}} = 2 \\times 24$ 小时。\n- 机组的启停状态（开/关）由一个二进制变量表示。\n- 状态变化只能在代表性时段的边界发生。\n- 目标是找到所需连接的代表性时段数量 $K$ 的必要下界，以表示一个完整的、可行的启停周期。\n\n### 第2步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题在电力系统工程和运筹学领域有充分的依据。机组组合、最小启停时间以及使用代表性时段（时间切片）等概念是长期能源规划模型（如容量扩张模型）中用于管理计算复杂性同时保留运行可行性的标准技术。所提供的数值对于大型基荷或中等负荷的火电厂是符合实际的。\n- **适定性**：该问题是适定的。它提供了一个明确的目标（找到最小整数 $K$）和一套完整的约束与参数（$L, U, D, H_{\\text{on}}, H_{\\text{off}}$）。从给定的信息中可以推导出唯一且有意义的解。\n- **客观性**：该问题以工程和数学建模中常见的精确、客观的语言陈述。没有主观或模棱两可的术语。\n\n该问题没有表现出任何无效性缺陷。它不是科学上不合理、不可形式化、不完整、不切实际、不适定或琐碎的。它提出了一个能源系统建模中真实且相关的问题。\n\n### 第3步：结论与行动\n问题有效。将推导解答。\n\n### 解答推导\n\n问题要求确定需要按顺序连接的代表性时段的最小数量 $K$，以模拟火电机组单个可行的启停周期。模型的时域表示是离散的，由长度为 $L$ 的时段组成。然而，机组的物理约束是在连续时间内运行的。\n\n设机组连续启动（ON）的时段数为 $N_{\\text{on}}$，连续停机（OFF）的时段数为 $N_{\\text{off}}$。由于启停状态只能在时段边界改变，因此 $N_{\\text{on}}$ 和 $N_{\\text{off}}$ 必须是整数。\n\n模型中启动阶段的总持续时间为 $T_{\\text{on}} = N_{\\text{on}} L$。该持续时间必须满足两个条件：\n1.  **物理可行性**：启动持续时间必须满足机组的最小启动时间 $U$。因此，$T_{\\text{on}} \\geq U$。\n2.  **对负荷状况的忠实性**：模型必须能够表示在线 $H_{\\text{on}}$ 小时的经济必要性。这意味着计划的启动持续时间必须至少与期望的经济启动持续时间一样长。如果 $T_{\\text{on}}  H_{\\text{on}}$，模型就无法满足经济信号，从而违反了问题的前提。因此，$T_{\\text{on}} \\geq H_{\\text{on}}$。\n\n结合这两个条件，简化模型中的总启动时间必须大于或等于物理要求和经济要求的最大值：\n$$N_{\\text{on}} L \\geq \\max(U, H_{\\text{on}})$$\n由于 $N_{\\text{on}}$ 必须是整数，启动阶段所需的最小周期数通过分离 $N_{\\text{on}}$ 并对所得表达式取上取整（向上取整）来得到，因为任何小数部分都将需要一个额外的完整时段。\n$$N_{\\text{on}} = \\left\\lceil \\frac{\\max(U, H_{\\text{on}})}{L} \\right\\rceil$$\n\n同样，停机阶段的总持续时间为 $T_{\\text{off}} = N_{\\text{off}} L$。该持续时间也必须满足两个类似的条件：\n1.  **物理可行性**：停机持续时间必须满足机组的最小停机时间 $D$。因此，$T_{\\text{off}} \\geq D$。\n2.  **对负荷状况的忠实性**：模型必须能够表示离线 $H_{\\text{off}}$ 小时的经济必要性。因此，$T_{\\text{off}} \\geq H_{\\text{off}}$。\n\n结合这些，总停机时间必须满足：\n$$N_{\\text{off}} L \\geq \\max(D, H_{\\text{off}})$$\n停机阶段所需的最小整数时段数为：\n$$N_{\\text{off}} = \\left\\lceil \\frac{\\max(D, H_{\\text{off}})}{L} \\right\\rceil$$\n\n一个“完整的启停周循环”需要一个启动时段序列后跟一个停机时段序列。模拟这个完整周期所需的代表性时段总数 $K$ 是启动阶段所需的最小时段数与停机阶段所需的最小时段数之和。\n$$K = N_{\\text{on}} + N_{\\text{off}} = \\left\\lceil \\frac{\\max(U, H_{\\text{on}})}{L} \\right\\rceil + \\left\\lceil \\frac{\\max(D, H_{\\text{off}})}{L} \\right\\rceil$$\n\n现在，我们代入给定的数值：\n- $L = 24$\n- $U = 72$\n- $D = 36$\n- $H_{\\text{on}} = 5 \\times 24 = 120$\n- $H_{\\text{off}} = 2 \\times 24 = 48$\n\n首先，计算 $N_{\\text{on}}$:\n$$\\max(U, H_{\\text{on}}) = \\max(72, 120) = 120$$\n$$N_{\\text{on}} = \\left\\lceil \\frac{120}{24} \\right\\rceil = \\lceil 5 \\rceil = 5$$\n\n接着，计算 $N_{\\text{off}}$:\n$$\\max(D, H_{\\text{off}}) = \\max(36, 48) = 48$$\n$$N_{\\text{off}} = \\left\\lceil \\frac{48}{24} \\right\\rceil = \\lceil 2 \\rceil = 2$$\n\n最后，连接时段的总最小数量 $K$ 为：\n$$K = N_{\\text{on}} + N_{\\text{off}} = 5 + 2 = 7$$\n\n因此，必须按时间顺序连接最少 $7$ 个代表性时段（每个长度为 $24$ 小时），以确保模型能够表示一个既符合机组物理约束又符合指定每周运行模式的可行启停周期。",
            "answer": "$$\\boxed{7}$$"
        },
        {
            "introduction": "最后，我们运用一种强大的分解技术，将长期投资决策与其短期运行成本后果联系起来。这个高级练习将指导您从一个详细的运行子问题中推导出 Benders 最优性割平面。通过构建对偶问题，您将发现影子价格——代表容量的经济价值——如何为指导主投资问题提供精确信息，从而构成了分层能源系统优化的基石。",
            "id": "4102493",
            "problem": "考虑一个电力系统的两层规划模型，该模型包含一个长期投资主问题和一个短期运行子问题。投资向量为 $y = (y_{E}, y_{P}, y_{G})$，其中 $y_{E}$ 是已安装的储能能量容量，单位为兆瓦时 (MWh)；$y_{P}$ 是已安装的储能功率容量，单位为兆瓦 (MW)（假设其同时限制充电和放电速率）；$y_{G}$ 是已安装的可调度发电容量，单位为兆瓦 (MW)。对于给定的投资 $y$，运行子问题在 $T$ 个小时的时间段内进行优化。对于每个小时 $t \\in \\{1,\\dots,T\\}$，运行决策变量包括：可调度发电量 $g_{t} \\geq 0$、储能充电量 $c_{t} \\geq 0$、储能放电量 $d_{t} \\geq 0$ 和荷电状态 $s_{t} \\geq 0$。设需求 $D_{t} \\geq 0$ 为给定值，初始荷电状态为 $s_{0} \\geq 0$，充电和放电效率分别为 $\\eta_{c} \\in (0,1]$ 和 $\\eta_{d} \\in (0,1]$。设发电、充电和放电的非负线性运行成本分别为 $C_{G}$（单位：美元/兆瓦时，记作 $\\$\\!/ \\mathrm{MWh}$）、$C_{c}$（单位：$\\$\\!/ \\mathrm{MWh}$）和 $C_{d}$（单位：$\\$\\!/ \\mathrm{MWh}$）。运行子问题是如下的线性规划：\n$$\n\\min_{g_{t},\\,c_{t},\\,d_{t},\\,s_{t} \\geq 0} \\;\\sum_{t=1}^{T} \\big( C_{G}\\, g_{t} + C_{c}\\, c_{t} + C_{d}\\, d_{t} \\big)\n$$\n约束条件为，对于所有 $t=1,\\dots,T$，\n$$\n\\text{(平衡)}\\quad g_{t} + d_{t} - c_{t} = D_{t},\n$$\n$$\n\\text{(跨期)}\\quad s_{t} = s_{t-1} + \\eta_{c}\\, c_{t} - \\eta_{d}^{-1} d_{t},\n$$\n$$\n\\text{(发电容量)}\\quad g_{t} \\leq y_{G},\n$$\n$$\n\\text{(充电容量)}\\quad c_{t} \\leq y_{P},\n$$\n$$\n\\text{(放电容量)}\\quad d_{t} \\leq y_{P},\n$$\n$$\n\\text{(能量容量)}\\quad s_{t} \\leq y_{E},\n$$\n以及终端循环条件\n$$\n\\text{(终端)}\\quad s_{T} = s_{0}.\n$$\n您可以假设所有数据都是可行的，并且对于任意非负的 $y$，运行子问题都存在有限最优解。\n\n从线性规划的标准对偶理论出发，并且仅使用基本的线性优化原理，按以下步骤进行：\n- 将运行子问题重构为一个最小化问题的矩阵形式，该问题包含等式约束和小于等于容量约束，其中约束的右侧项仿射地依赖于 $y$。\n- 推导其对偶问题，清楚地标明与每类约束相关联的对偶变量：设 $\\lambda_{t}$ 为平衡等式的对偶变量，$\\nu_{t}$ 为跨期等式的对偶变量，$\\tau$ 为终端等式的对偶变量，并设 $\\alpha_{t} \\geq 0$, $\\beta_{t} \\geq 0$, $\\gamma_{t} \\geq 0$, $\\sigma_{t} \\geq 0$ 分别为发电、充电、放电和能量容量约束的对偶变量。\n- 使用强对偶性，将最优运行成本写为最优对偶解下的对偶目标函数值。确定追索值对 $y$ 的依赖关系，并将 Benders 最优性割关于 $y$ 的系数向量表示为最优对偶变量的函数。\n\n您的最终输出应为关于 $(y_{E}, y_{P}, y_{G})$ 的 Benders 最优性割的系数向量，该向量应紧凑地写成一个单行向量，其分量为对偶变量 $\\alpha_{t}$、$\\beta_{t}$、$\\gamma_{t}$ 和 $\\sigma_{t}$ 的符号表达式。以每单位容量的货币单位表示此向量，其中第一个分量的单位为美元/兆瓦时，第二和第三个分量的单位为美元/兆瓦。不要在最终的方框答案中包含单位。无需四舍五入；请提供精确的符号表达式。",
            "solution": "用户希望为一个两层能源系统规划问题推导 Benders 最优性割的系数向量。\n\n### **步骤 1：问题验证**\n问题陈述描述了一个应用于能源系统规划的标准两阶段随机规划结构，其中第一阶段（主问题）决策是投资 $y = (y_E, y_P, y_G)$，第二阶段（子问题）决策是小时运行。子问题是一个线性规划 (LP)，其约束依赖于投资向量 $y$。任务是重构此 LP，推导其对偶问题，并确定与投资变量相对应的 Benders 最优性割的系数。\n\n**已知条件：**\n-   投资向量：$y = (y_{E}, y_{P}, y_{G})$，分别对应储能能量容量 (MWh)、储能功率容量 (MW) 和发电容量 (MW)。\n-   对于 $t \\in \\{1,\\dots,T\\}$ 的运行变量：$g_t, c_t, d_t, s_t \\ge 0$。\n-   参数：$D_t, s_0, \\eta_c, \\eta_d, C_G, C_c, C_d$。\n-   原始运行子问题 $P(y)$:\n    $$\n    \\min_{g_{t},\\,c_{t},\\,d_{t},\\,s_{t} \\geq 0} \\;\\sum_{t=1}^{T} \\big( C_{G}\\, g_{t} + C_{c}\\, c_{t} + C_{d}\\, d_{t} \\big)\n    $$\n    约束条件为，对于 $t=1,\\dots,T$：\n    1.  $g_{t} + d_{t} - c_{t} = D_{t}$\n    2.  $s_{t} = s_{t-1} + \\eta_{c}\\, c_{t} - \\eta_{d}^{-1} d_{t}$\n    3.  $g_{t} \\leq y_{G}$\n    4.  $c_{t} \\leq y_{P}$\n    5.  $d_{t} \\leq y_{P}$\n    6.  $s_{t} \\leq y_{E}$\n    以及 $s_{T} = s_{0}$。\n-   假设：对于任意 $y \\ge 0$，子问题都是可行且有界的。\n-   对偶变量分配：$\\lambda_t$ 对应平衡约束，$\\nu_t$ 对应跨期约束，$\\tau$ 对应终端约束，$\\alpha_t, \\beta_t, \\gamma_t, \\sigma_t \\ge 0$ 对应容量约束。\n\n**验证：**\n1.  **科学基础：** 该模型是一个包含可调度发电和储能的电力系统的标准、简化表示。约束代表了能量平衡和容量限制等基本原理。该模型构建在科学上是合理的。\n2.  **适定性：** 该问题是一个定义明确的线性规划。从一个 LP 子问题推导 Benders 割是优化理论中的一个标准流程。可行性和有界性的假设确保了解的存在。\n3.  **目标：** 问题陈述具有数学上的精确性，没有歧义。\n\n该问题被认为是**有效**的。我们可以继续进行求解。\n\n### **步骤 2：重构与对偶推导**\n\n我们首先将原始子问题 $P(y)$ 形式化，然后推导其对偶问题。该问题可以写成一个对偶理论适用的标准形式。\n\n**原始问题重构：**\n运行子问题可以表述为：\n$$\nQ(y) = \\min_{g,c,d,s} \\sum_{t=1}^{T} (C_{G} g_{t} + C_{c} c_{t} + C_{d} d_{t})\n$$\n约束条件：\n-   $g_{t} - c_{t} + d_{t} - D_{t} = 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$ (关联对偶变量: $\\lambda_t$)\n-   $s_{t} - s_{t-1} - \\eta_{c} c_{t} + \\eta_{d}^{-1} d_{t} = 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$ (关联对偶变量: $\\nu_t$)\n-   $s_{T} - s_{0} = 0$ (关联对偶变量: $\\tau$)\n-   $g_{t} - y_{G} \\le 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$ (关联对偶变量: $\\alpha_t \\ge 0$)\n-   $c_{t} - y_{P} \\le 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$ (关联对偶变量: $\\beta_t \\ge 0$)\n-   $d_{t} - y_{P} \\le 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$ (关联对偶变量: $\\gamma_t \\ge 0$)\n-   $s_{t} - y_{E} \\le 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$ (关联对偶变量: $\\sigma_t \\ge 0$)\n-   $g_t, c_t, d_t, s_t \\ge 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$\n\n注意，$s_0$ 是一个固定参数。在 $t=1$ 的跨期约束中，$s_{t-1}$ 就是 $s_0$。这可以通过将约束重写为线性系统 $Ax=b$ 来正式地并入，但构建拉格朗日函数更为直接。\n\n**拉格朗日公式：**\n该问题的拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L} = \\sum_{t=1}^{T} (C_{G} g_{t} + C_{c} c_{t} + C_{d} d_{t}) \\\\\n+ \\sum_{t=1}^{T} \\lambda_{t} (g_{t} - c_{t} + d_{t} - D_{t}) \\\\\n+ \\sum_{t=1}^{T} \\nu_{t} (s_{t} - s_{t-1} - \\eta_{c} c_{t} + \\eta_{d}^{-1} d_{t}) \\\\\n+ \\tau (s_{T} - s_{0}) \\\\\n+ \\sum_{t=1}^{T} \\alpha_{t} (g_{t} - y_{G}) \\\\\n+ \\sum_{t=1}^{T} \\beta_{t} (c_{t} - y_{P}) \\\\\n+ \\sum_{t=1}^{T} \\gamma_{t} (d_{t} - y_{P}) \\\\\n+ \\sum_{t=1}^{T} \\sigma_{t} (s_{t} - y_{E})\n$$\n其中 $\\alpha_t, \\beta_t, \\gamma_t, \\sigma_t \\ge 0$，而 $\\lambda_t, \\nu_t, \\tau$ 的符号无约束。我们已经将常数 $s_0$ 融入结构中：项 $\\sum_t \\nu_t (s_t - s_{t-1})$ 展开为 $\\nu_T s_T + \\sum_{t=1}^{T-1} (\\nu_t - \\nu_{t+1})s_t - \\nu_1 s_0$。\n\n我们按原始决策变量 $g_t, c_t, d_t, s_t$ 对各项进行分组：\n$$\n\\mathcal{L} = \\sum_{t=1}^{T} g_{t} (C_{G} + \\lambda_{t} + \\alpha_{t}) \\\\\n+ \\sum_{t=1}^{T} c_{t} (C_{c} - \\lambda_{t} - \\eta_{c} \\nu_{t} + \\beta_{t}) \\\\\n+ \\sum_{t=1}^{T} d_{t} (C_{d} + \\lambda_{t} + \\eta_{d}^{-1} \\nu_{t} + \\gamma_{t}) \\\\\n+ \\sum_{t=1}^{T-1} s_{t} (\\nu_{t} - \\nu_{t+1} + \\sigma_{t}) + s_{T}(\\nu_T + \\tau + \\sigma_T) \\\\\n+ \\text{不涉及决策变量的项}\n$$\n对偶问题通过最大化对偶函数 $q(\\lambda, \\dots, \\sigma) = \\inf_{g,c,d,s \\ge 0} \\mathcal{L}$ 得到。为使该下确界有界，原始变量的系数必须为非负。这就得出了对偶约束。\n\n**对偶问题：**\n对偶约束为：\n1.  $C_{G} + \\lambda_{t} + \\alpha_{t} \\ge 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$\n2.  $C_{c} - \\lambda_{t} - \\eta_{c} \\nu_{t} + \\beta_{t} \\ge 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$\n3.  $C_{d} + \\lambda_{t} + \\eta_{d}^{-1} \\nu_{t} + \\gamma_{t} \\ge 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$\n4.  $\\nu_{t} - \\nu_{t+1} + \\sigma_{t} \\ge 0 \\quad \\forall t \\in \\{1, \\dots, T-1\\}$\n5.  $\\nu_T + \\tau + \\sigma_T \\ge 0$\n6.  $\\alpha_t, \\beta_t, \\gamma_t, \\sigma_t \\ge 0 \\quad \\forall t \\in \\{1, \\dots, T\\}$\n\n对偶目标是最大化 $\\mathcal{L}$ 的剩余项，这些项构成了对偶函数 $q$：\n$$\n\\max_{\\lambda, \\nu, \\tau, \\alpha, \\beta, \\gamma, \\sigma} \\left\\{ -\\sum_{t=1}^{T} \\lambda_{t} D_{t} - \\nu_{1}s_{0} - \\tau s_{0} - \\sum_{t=1}^{T} \\alpha_t y_G - \\sum_{t=1}^{T} \\beta_t y_P - \\sum_{t=1}^{T} \\gamma_t y_P - \\sum_{t=1}^{T} \\sigma_t y_E \\right\\}\n$$\n这可以写作：\n$$\n\\max \\left\\{ -\\sum_{t=1}^{T} \\lambda_{t} D_{t} - (\\nu_{1} + \\tau)s_{0} - y_G \\sum_{t=1}^{T} \\alpha_t - y_P \\sum_{t=1}^{T} (\\beta_t + \\gamma_t) - y_E \\sum_{t=1}^{T} \\sigma_t \\right\\}\n$$\n约束条件为上述推导出的对偶约束。\n\n### **步骤 3：Benders 最优性割**\n根据线性规划的强对偶性（因为原始问题假设是可行且有界的），原始子问题的最优值 $Q(y)$ 等于其对偶问题的最优值。设对偶问题的一个最优解表示为 $(\\lambda^*, \\nu^*, \\tau^*, \\alpha^*, \\beta^*, \\gamma^*, \\sigma^*)$。那么：\n$$\nQ(y) = -\\sum_{t=1}^{T} \\lambda^*_{t} D_{t} - (\\nu^*_{1} + \\tau^*)s_{0} - y_G \\sum_{t=1}^{T} \\alpha^*_t - y_P \\sum_{t=1}^{T} (\\beta^*_t + \\gamma^*_t) - y_E \\sum_{t=1}^{T} \\sigma^*_t\n$$\n函数 $Q(y)$ 是子问题的值函数。它是 $y$ 的一个凸函数。在 Benders 分解的背景下，主问题最小化投资成本加上 $Q(y)$ 的一个近似值。最优性割提供了 $Q(y)$ 的一个线性下界。对于一个给定的投资点 $\\bar{y}$，该割是使用在 $\\bar{y}$ 处求解的子问题所得的最优对偶变量构成的。\n\nBenders 最优性割是 $Q(y)$ 在 $\\bar{y}$ 处的上境图的一个支撑超平面。它由以下不等式给出：\n$$\n\\theta \\ge Q(\\bar{y}) + (\\nabla_y Q(\\bar{y}))^T (y - \\bar{y})\n$$\n其中 $\\theta$ 是代表子问题成本的主问题变量。\n梯度（如果不是唯一的，则为次梯度）$\\nabla_y Q(y)$ 可以通过应用灵敏度分析（或 Danskin 定理）找到。最优值函数 $Q(y)$ 关于右端参数的偏导数由相应约束的最优对偶变量的负值给出。\n在我们的公式中，约束的形式是 $g_t \\le y_G$。一个更直接的方法是将对偶目标值对 $y$ 求导，同时将最优对偶变量固定在它们在 $\\bar{y}$ 处的值：\n$$\n\\frac{\\partial Q(y)}{\\partial y_E} = -\\sum_{t=1}^{T} \\sigma^*_t\n$$\n$$\n\\frac{\\partial Q(y)}{\\partial y_P} = -\\sum_{t=1}^{T} (\\beta^*_t + \\gamma^*_t)\n$$\n$$\n\\frac{\\partial Q(y)}{\\partial y_G} = -\\sum_{t=1}^{T} \\alpha^*_t\n$$\nBenders 割在主问题中通常写为 $\\theta + (\\text{系数})^T y \\ge \\text{常数}$。在这种形式下，$y = (y_E, y_P, y_G)$ 的系数向量是 $-\\nabla_y Q(\\bar{y})$。\n因此，系数向量为：\n$$\n\\begin{pmatrix} -\\frac{\\partial Q(\\bar{y})}{\\partial y_E} \\\\ -\\frac{\\partial Q(\\bar{y})}{\\partial y_P} \\\\ -\\frac{\\partial Q(\\bar{y})}{\\partial y_G} \\end{pmatrix} = \\begin{pmatrix} \\sum_{t=1}^{T} \\sigma^*_t \\\\ \\sum_{t=1}^{T} (\\beta^*_t + \\gamma^*_t) \\\\ \\sum_{t=1}^{T} \\alpha^*_t \\end{pmatrix}\n$$\n问题要求得到关于 $(y_E, y_P, y_G)$ 的系数向量，并写成行向量。按照最终表达式中的惯例，为了符号简洁，我们省略了星号上标。这些分量是最优对偶变量的和，代表了每种容量的边际价值（影子价格）。\n\n-   $y_E$ 的系数（单位：$\\$\\!/ \\mathrm{MWh}$）：$\\sum_{t=1}^{T} \\sigma_t$\n-   $y_P$ 的系数（单位：$\\$\\!/ \\mathrm{MW}$）：$\\sum_{t=1}^{T} (\\beta_t + \\gamma_t)$\n-   $y_G$ 的系数（单位：$\\$\\!/ \\mathrm{MW}$）：$\\sum_{t=1}^{T} \\alpha_t$\n\n得到的系数行向量是 $(\\sum_{t=1}^{T} \\sigma_t, \\sum_{t=1}^{T} (\\beta_t + \\gamma_t), \\sum_{t=1}^{T} \\alpha_t)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sum_{t=1}^{T} \\sigma_{t}  \\sum_{t=1}^{T} (\\beta_{t} + \\gamma_{t})  \\sum_{t=1}^{T} \\alpha_{t}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}