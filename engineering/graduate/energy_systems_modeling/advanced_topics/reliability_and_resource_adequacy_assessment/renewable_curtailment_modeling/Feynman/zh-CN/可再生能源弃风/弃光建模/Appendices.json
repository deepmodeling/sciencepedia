{
    "hands_on_practices": [
        {
            "introduction": "从根本上说，弃电通常是一个经济决策。本练习将通过构建一个简化的单元承诺（Unit Commitment, UC）模型来探讨这一点。你将需要确定，为了满足负荷需求，是启动一台传统发电机更具成本效益，还是削减“免费”的可再生能源更为经济，同时要考虑最小发电水平和启动成本等因素。这个练习揭示了导致电力系统中出现弃电的基本经济权衡。",
            "id": "4116370",
            "problem": "考虑一个单周期机组组合（Unit Commitment, UC）问题，包含一台可调度火电机组和一座风力发电厂。目标是确定火电机组的启停决策、火电调度、风电调度、弃风量以及任何未满足的能源需求，以在满足物理约束的同时最小化总系统成本。使用以下基本框架：能量平衡、非负性和容量约束，以及一个结合了与启停和调度相关的线性成本函数。\n\n将决策变量定义如下，所有变量均以兆瓦（MW）为单位：火电机组启停状态指示变量 $y \\in \\{0,1\\}$，火电出力 $p^{\\text{th}} \\ge 0$，风电出力 $p^{\\text{w}} \\ge 0$，弃风量 $c^{\\text{w}} \\ge 0$，以及缺电量 $s \\ge 0$。参数包括：负荷 $L$（MW），火电机组最小稳定出力 $P^{\\min}$（MW），火电机组最大出力 $P^{\\max}$（MW），可用风电 $P^{\\text{avail}}$（MW），火电边际能源成本 $c_{\\text{m}}$（美元/兆瓦时），启动成本 $C_{\\text{su}}$（美元），空载成本 $C_{\\text{nl}}$（美元），弃风惩罚成本 $\\pi_{\\text{curt}}$（美元/兆瓦时），以及失负荷价值（Value of Lost Load, VOLL）$V$（美元/兆瓦时）。假设火电机组初始状态为关闭，因此如果 $y=1$（开机），则会产生启动成本。\n\n物理和运行约束如下：\n- 功率平衡：$$p^{\\text{th}} + p^{\\text{w}} + s = L.$$\n- 火电机组可操作性：$$y \\in \\{0,1\\}, \\quad p^{\\text{th}} \\le y \\, P^{\\max}, \\quad p^{\\text{th}} \\ge y \\, P^{\\min}.$$\n- 风电可用性与弃风定义：$$0 \\le p^{\\text{w}} \\le P^{\\text{avail}}, \\quad c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}}, \\quad c^{\\text{w}} \\ge 0.$$\n- 缺电量的非负性：$$s \\ge 0.$$\n\n需要最小化的总成本为：\n$$\\text{Cost} = C_{\\text{su}} \\, y + C_{\\text{nl}} \\, y + c_{\\text{m}} \\, p^{\\text{th}} + \\pi_{\\text{curt}} \\, c^{\\text{w}} + V \\, s.$$\n\n解释：\n- 火力发电具有二进制的启停决策，并且在启动时必须遵守最小和最大出力限制。\n- 风力发电可以在其可用功率内自由调度，任何未使用的可用风电都计为弃风，并受到 $\\pi_{\\text{curt}}$ 的惩罚。\n- 允许出现缺电量（短缺），但会受到VOLL $V$ 的高额惩罚。\n- 所有功率量必须以 MW 表示，所有成本量必须以美元表示。对于输出，所有 MW 值和美元值都应表示为四舍五入到两位小数的十进制数。\n\n实现一个程序，对下方测试套件中的每一组参数，计算出最优元组 $[y, p^{\\text{th}}, p^{\\text{w}}, c^{\\text{w}}, s, \\text{Cost}]$，该元组在满足约束条件的情况下使总成本最小化。你的程序应生成单行输出，其中包含一个方括号内的逗号分隔列表，每个测试用例的结果本身也是一个不含空格的方括号逗号分隔列表。例如，最终输出格式必须为 $$[ [y_1,p^{\\text{th}}_1,p^{\\text{w}}_1,c^{\\text{w}}_1,s_1,\\text{Cost}_1], [y_2,p^{\\text{th}}_2,p^{\\text{w}}_2,c^{\\text{w}}_2,s_2,\\text{Cost}_2], \\ldots ].$$\n\n测试套件（所有功率单位为 MW，所有成本单位为美元或美元/兆瓦时，计算中所有数字均应视为精确常数）：\n- 案例 1：$L=100$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 2：$L=60$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 3：$L=40$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=20$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 4：$L=300$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 5：$L=370$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n\n你的程序必须生成单行输出，其中包含一个方括号内的逗号分隔列表，每个案例编码为 $[y,p^{\\text{th}},p^{\\text{w}},c^{\\text{w}},s,\\text{Cost}]$，其中 $y$ 是一个整数（$0$ 或 $1$），所有其他条目都是四舍五入到两位小数的十进制数。打印行中任何地方都不能有空格。",
            "solution": "用户希望解决一个单周期机组组合问题。我将首先验证问题陈述。\n\n### 步骤 1：提取已知条件\n该问题是在一组约束条件下，求一个成本函数的最小值。\n\n**决策变量（均以 MW 为单位）：**\n- 火电机组启停状态指示变量：$y \\in \\{0,1\\}$\n- 火电出力：$p^{\\text{th}} \\ge 0$\n- 风电调度出力：$p^{\\text{w}} \\ge 0$\n- 弃风量：$c^{\\text{w}} \\ge 0$\n- 缺电量（短缺）：$s \\ge 0$\n\n**参数：**\n- 负荷：$L$ (MW)\n- 火电机组最小稳定出力：$P^{\\min}$ (MW)\n- 火电机组最大出力：$P^{\\max}$ (MW)\n- 可用风电功率：$P^{\\text{avail}}$ (MW)\n- 火电边际能源成本：$c_{\\text{m}}$ ($\\$/MWh$)\n- 火电机组启动成本：$C_{\\text{su}}$ ($\\$$)\n- 火电机组空载成本：$C_{\\text{nl}}$ ($\\$$)\n- 弃风惩罚成本：$\\pi_{\\text{curt}}$ ($\\$/MWh$)\n- 失负荷价值（VOLL）：$V$ ($\\$/MWh$)\n\n**初始条件：**\n- 火电机组初始为关闭状态。\n\n**约束：**\n1.  功率平衡：$p^{\\text{th}} + p^{\\text{w}} + s = L$\n2.  火电机组可操作性：$y \\in \\{0,1\\}$，$p^{\\text{th}} \\le y \\, P^{\\max}$，$p^{\\text{th}} \\ge y \\, P^{\\min}$\n3.  风电可用性：$0 \\le p^{\\text{w}} \\le P^{\\text{avail}}$\n4.  弃风定义：$c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}}$\n5.  非负性：$c^{\\text{w}} \\ge 0$，$s \\ge 0$\n\n**目标函数：**\n- 最小化总成本：$\\text{Cost} = C_{\\text{su}} \\, y + C_{\\text{nl}} \\, y + c_{\\text{m}} \\, p^{\\text{th}} + \\pi_{\\text{curt}} \\, c^{\\text{w}} + V \\, s$\n\n**测试套件：**\n- 案例 1：$L=100$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 2：$L=60$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 3：$L=40$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=20$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 4：$L=300$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n- 案例 5：$L=370$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题描述了一个简化但标准的经济调度和机组组合模型，这是能源系统建模的基石。它被建模为一个混合整数线性规划（Mixed-Integer Linear Program, MILP）问题。\n\n- **科学依据**：该问题基于电力系统运行的基本原理，包括功率平衡、发电机限制和成本最小化。所有组成部分（火电/风电、负荷、弃电、缺电）都是标准概念。\n- **适定性**：该问题是一个优化问题，对于整数变量 $y$ 的每个固定值，其目标函数是线性的，约束条件在凸域上也是线性的。由于 $y$ 只有两种可能的值，因此保证存在唯一、稳定且有意义的解。\n- **问题定义**：该问题使用精确的数学和技术语言定义，所有参数和变量都得到了明确的指定。\n\n该问题是自洽、一致且科学合理的。没有发现任何缺陷。\n\n### 步骤 3：结论与行动\n问题是有效的。我现在将着手解决。\n\n该问题可以通过根据火电机组的二进制启停决策 $y \\in \\{0, 1\\}$ 进行分解来解决。我们将分析每种情况下的最优调度和相关成本，然后选择产生最低总成本的情况。时间周期为一小时，因此 MWh 和 MW 在数值上是等效的，所有以 $/MWh 为单位的成本率都可以视为每 MW 的成本。\n\n**情况 A：火电机组关闭 ($y=0$)**\n如果火电机组关闭，其启停状态为 $y = 0$。对 $p^{\\text{th}}$ 的运行约束变为 $p^{\\text{th}} \\le 0 \\cdot P^{\\max}$ 和 $p^{\\text{th}} \\ge 0 \\cdot P^{\\min}$，这迫使 $p^{\\text{th}} = 0$。成本函数简化为：\n$$ \\text{Cost}_{y=0} = \\pi_{\\text{curt}} \\, c^{\\text{w}} + V \\, s $$\n功率平衡变为 $p^{\\text{w}} + s = L$。我们可以将 $s$ 表示为 $s = L - p^{\\text{w}}$，将 $c^{\\text{w}}$ 表示为 $c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}}$。将这些代入成本函数得到：\n$$ \\text{Cost}_{y=0} = \\pi_{\\text{curt}}(P^{\\text{avail}} - p^{\\text{w}}) + V(L - p^{\\text{w}}) = (\\pi_{\\text{curt}}P^{\\text{avail}} + VL) - (\\pi_{\\text{curt}} + V)p^{\\text{w}} $$\n为了最小化此成本，我们必须最大化 $p^{\\text{w}}$，因为其系数 $-(\\pi_{\\text{curt}} + V)$ 是负的。对 $p^{\\text{w}}$ 的约束是 $0 \\le p^{\\text{w}} \\le P^{\\text{avail}}$ 和 $s = L - p^{\\text{w}} \\ge 0 \\implies p^{\\text{w}} \\le L$。综合这些，$p^{\\text{w}}$ 的可行范围是 $0 \\le p^{\\text{w}} \\le \\min(L, P^{\\text{avail}})$。\n因此，最优风电调度为 $p^{\\text{w}}_{(0)} = \\min(L, P^{\\text{avail}})$。\n其余变量则为：\n- $p^{\\text{th}}_{(0)} = 0$\n- $c^{\\text{w}}_{(0)} = P^{\\text{avail}} - p^{\\text{w}}_{(0)}$\n- $s_{(0)} = L - p^{\\text{w}}_{(0)}$\n总成本为 $\\text{Cost}_{y=0} = \\pi_{\\text{curt}}c^{\\text{w}}_{(0)} + V s_{(0)}$。\n\n**情况 B：火电机组开启 ($y=1$)**\n如果火电机组开启 ($y = 1$)，它会产生固定成本 $C_{\\text{su}} + C_{\\text{nl}}$，并且必须在其限制范围内运行，$P^{\\min} \\le p^{\\text{th}} \\le P^{\\max}$。总成本为：\n$$ \\text{Cost}_{y=1} = (C_{\\text{su}} + C_{\\text{nl}}) + c_{\\text{m}} p^{\\text{th}} + \\pi_{\\text{curt}} c^{\\text{w}} + V s $$\n一个关键约束来自功率平衡方程 $p^{\\text{th}} + p^{\\text{w}} + s = L$。由于 $p^{\\text{w}} \\ge 0$ 和 $s \\ge 0$，我们有 $p^{\\text{th}} \\le L$。结合最小出力约束 $p^{\\text{th}} \\ge P^{\\min}$，这意味着 $y=1$ 的情况仅在 $L \\ge P^{\\min}$ 时可行。如果 $L  P^{\\min}$，任何满足 $p^{\\text{th}} \\ge P^{\\min}$ 的调度都会违反功率平衡方程（因为 $p^{\\text{th}} > L$ 将需要 $p^{\\text{w}} + s  0$，这是不可能的）。因此，如果 $L  P^{\\min}$，$y=1$ 的情况是不可行的，其成本可以视为无穷大。\n\n假设 $L \\ge P^{\\min}$，我们继续确定最优调度。根据经济优先次序（economic merit order），由于典型的成本层级关系 $\\pi_{\\text{curt}}  c_{\\text{m}}  V$，建议首先使用风电，然后是火电，最后才产生缺电量。\n\n$y=1$ 有两个主要的子情况：\n1.  **容量不足 ($L > P^{\\max} + P^{\\text{avail}}$)：** 总可用发电量小于负荷。为了最小化极其昂贵的缺电量 $s$，必须调度所有可用的发电量。\n    - $p^{\\text{th}}_{(1)} = P^{\\max}$\n    - $p^{\\text{w}}_{(1)} = P^{\\text{avail}}$ (这意味着 $c^{\\text{w}}_{(1)} = 0$)\n    - $s_{(1)} = L - P^{\\max} - P^{\\text{avail}}$\n\n2.  **容量充足 ($P^{\\min} \\le L \\le P^{\\max} + P^{\\text{avail}}$)：** 负荷可以在没有缺电量的情况下得到满足，所以我们可以设置 $s_{(1)} = 0$。功率平衡为 $p^{\\text{th}} + p^{\\text{w}} = L$。目标是最小化 $(C_{\\text{su}} + C_{\\text{nl}}) + c_{\\text{m}}p^{\\text{th}} + \\pi_{\\text{curt}}c^{\\text{w}}$。代入 $p^{\\text{w}} = L - p^{\\text{th}}$ 和 $c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}} = P^{\\text{avail}} - (L - p^{\\text{th}})$，成本的可变部分变为：\n    $$ c_{\\text{m}}p^{\\text{th}} + \\pi_{\\text{curt}}(P^{\\text{avail}} - L + p^{\\text{th}}) = (c_{\\text{m}} + \\pi_{\\text{curt}})p^{\\text{th}} + \\pi_{\\text{curt}}(P^{\\text{avail}} - L) $$\n    由于系数 $(c_{\\text{m}} + \\pi_{\\text{curt}})$ 是正的，我们必须为 $p^{\\text{th}}$ 选择可能的最小值。$p^{\\text{th}}$ 的可行范围由其自身限制和风电功率限制决定：\n    - $P^{\\min} \\le p^{\\text{th}} \\le P^{\\max}$\n    - $0 \\le p^{\\text{w}} \\le P^{\\text{avail}} \\implies 0 \\le L - p^{\\text{th}} \\le P^{\\text{avail}}$，这得出 $L - P^{\\text{avail}} \\le p^{\\text{th}} \\le L$。\n    综合这些，$p^{\\text{th}}$ 的可行范围是 $[\\max(P^{\\min}, L - P^{\\text{avail}}), \\min(P^{\\max}, L)]$。\n    为了最小化成本，我们从此范围中选择最小值：\n    - $p^{\\text{th}}_{(1)} = \\max(P^{\\min}, L - P^{\\text{avail}})$\n    - 其他变量随之确定：$p^{\\text{w}}_{(1)} = L - p^{\\text{th}}_{(1)}$，$c^{\\text{w}}_{(1)} = P^{\\text{avail}} - p^{\\text{w}}_{(1)}$，以及 $s_{(1)} = 0$。\n\n**最终决策算法**\n对于每个参数集：\n1.  计算 $y=0$ 情况下的决策变量和总成本 $\\text{Cost}_{y=0}$。\n2.  计算 $y=1$ 情况下的决策变量和总成本 $\\text{Cost}_{y=1}$。如果 $L  P^{\\min}$，则设置 $\\text{Cost}_{y=1} = \\infty$。\n3.  比较成本。如果 $\\text{Cost}_{y=0} \\le \\text{Cost}_{y=1}$，则最优解是在 $y=0$ 情况下找到的解。否则，最优解来自 $y=1$ 的情况。\n4.  将结果元组 $[y, p^{\\text{th}}, p^{\\text{w}}, c^{\\text{w}}, s, \\text{Cost}]$ 格式化以供输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the single-period unit commitment problem for a series of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: L=100, P_min=50, P_max=200, P_avail=80, ...\n        {\n            \"L\": 100.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 80.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 2: L=60, P_min=50, P_max=200, P_avail=80, ...\n        {\n            \"L\": 60.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 80.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 3: L=40, P_min=50, P_max=200, P_avail=20, ...\n        {\n            \"L\": 40.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 20.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 4: L=300, P_min=50, P_max=200, P_avail=120, ...\n        {\n            \"L\": 300.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 120.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 5: L=370, P_min=50, P_max=200, P_avail=120, ...\n        {\n            \"L\": 370.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 120.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        }\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        L, P_min, P_max, P_avail = params[\"L\"], params[\"P_min\"], params[\"P_max\"], params[\"P_avail\"]\n        c_m, C_su, C_nl, pi_curt, V = params[\"c_m\"], params[\"C_su\"], params[\"C_nl\"], params[\"pi_curt\"], params[\"V\"]\n\n        # Case y = 0 (Thermal OFF)\n        y0 = 0\n        p_th0 = 0.0\n        p_w0 = min(L, P_avail)\n        c_w0 = P_avail - p_w0\n        s0 = L - p_w0\n        cost0 = pi_curt * c_w0 + V * s0\n        res0 = [y0, p_th0, p_w0, c_w0, s0, cost0]\n\n        # Case y = 1 (Thermal ON)\n        cost1 = float('inf')\n        res1 = []\n\n        # The y=1 case is infeasible if load is less than the thermal minimum run level.\n        if L >= P_min:\n            y1 = 1\n            fixed_cost1 = C_su + C_nl\n            \n            # Subcase: Insufficient capacity\n            if L > P_max + P_avail:\n                p_th1 = P_max\n                p_w1 = P_avail\n                c_w1 = 0.0\n                s1 = L - p_th1 - p_w1\n            # Subcase: Sufficient capacity\n            else:\n                s1 = 0.0\n                p_th1 = max(P_min, L - P_avail)\n                p_w1 = L - p_th1\n                c_w1 = P_avail - p_w1\n            \n            cost1 = fixed_cost1 + c_m * p_th1 + pi_curt * c_w1 + V * s1\n            res1 = [y1, p_th1, p_w1, c_w1, s1, cost1]\n\n        # Compare costs and select optimal solution\n        if cost0 = cost1:\n            optimal_res = res0\n        else:\n            optimal_res = res1\n            \n        # Format for output\n        y_opt = int(optimal_res[0])\n        p_th_opt = f\"{optimal_res[1]:.2f}\"\n        p_w_opt = f\"{optimal_res[2]:.2f}\"\n        c_w_opt = f\"{optimal_res[3]:.2f}\"\n        s_opt = f\"{optimal_res[4]:.2f}\"\n        cost_opt = f\"{optimal_res[5]:.2f}\"\n        \n        results.append(f\"[{y_opt},{p_th_opt},{p_w_opt},{c_w_opt},{s_opt},{cost_opt}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在经济学基础上，本练习将引入输电网络所扮演的关键角色。我们将使用潮流分布因子（Power Transfer Distribution Factors, PTDFs）来分析在不同位置削减发电对缓解线路阻塞的效用有何不同。这个练习不仅阐释了经济上最高效的弃电原则，还将其与基于公平性的方法进行对比，从而突出了系统运营商面临的一个核心挑战。",
            "id": "4116381",
            "problem": "考虑一个网状输电网络的线性化直流（DC）潮流模型。假设有一组母线，索引为 $i \\in \\{1,\\dots,N\\}$，以及一个具有热极限的受监控输电元件（线路）$\\ell$。母线 $i$ 相对于线路 $\\ell$ 的功率转移分布因子（PTDF），记为 $p_i$，表示在直流近似下，母线 $i$ 处 $1$兆瓦（MW）的净注入功率以及相应的在平衡节点处 $1$兆瓦的功率取出所导致的线路 $\\ell$ 上的潮流变化（单位为兆瓦，MW）。母线 $i$ 处的可再生能源削减被建模为净注入功率减少了 $c_i$（单位为MW），其中 $0 \\le c_i \\le r_i$，$r_i$ 是母线 $i$ 削减前的可再生能源出力（单位为MW）。假设只有 $p_i  0$ 的母线可以通过削减来缓解受监控线路上的拥塞；$p_i \\le 0$ 的母线处的削减无助于缓解线路 $\\ell$ 上的拥塞，因此必须忽略。\n\n受监控线路上的基础潮流为 $F_0$（单位为MW），热极限为 $F_{\\max}$（单位为MW）。所需的拥塞缓解量为 $D = \\max\\{0, F_0 - F_{\\max}\\}$（单位为MW）。在直流模型下，由削减向量 $\\mathbf{c} = (c_1,\\dots,c_N)$ 引起的线路 $\\ell$ 上的潮流变化为 $\\Delta F = \\sum_{i=1}^N p_i c_i$。一个可行的削减方案必须满足 $\\sum_{i=1}^N p_i c_i \\ge D$，其中 $0 \\le c_i \\le r_i$，并且当 $p_i \\le 0$ 时，$c_i = 0$。\n\n任务A：效率。从直流潮流线性化和PTDF的定义出发，且不假设任何专门的最优性公式，从第一性原理推导应削减哪些母线，以在满足约束 $\\sum_{i=1}^N p_i c_i \\ge D$ 和边界条件 $0 \\le c_i \\le r_i$ 的情况下，最小化总削减能量 $\\sum_{i=1}^N c_i$。推导过程仅关注 $p_i  0$ 的母线。利用你的推导证明，在 $p_i$ 较低的母线进行削减是低效的，即与在 $p_i$ 较高的母线进行削减相比，需要更多的总削减量（单位为MW）才能实现相同的拥塞缓解量 $D$。\n\n任务B：公平性约束下的分配。施加一个公平性约束，即所有有贡献的可再生能源生产者（$p_i  0$ 的生产者）面临相同的按比例削减负担：存在一个标量 $\\phi \\in [0,1]$，使得对于所有 $p_i  0$ 的 $i$，$c_i = \\phi r_i$，且不超过 $r_i$。在此公平性约束下，推导满足拥塞缓解要求同时实现最小比例负担 $\\phi$ 的分配方案。将得到的 $\\phi$ 表示为小数，总削减量 $\\sum_{i=1}^N c_i$ 以兆瓦为单位表示。\n\n实现要求：编写一个完整的程序，为每个给定的测试用例计算以下四个输出：\n- 任务A中最小的总削减量（单位MW），四舍五入到三位小数。\n- 当按 $p_i$ 升序贪婪地应用削减时（即，首先优先考虑最低的正 $p_i$，然后是次低的，依此类推），总削减量（单位MW），四舍五入到三位小数。此升序方案用于证明相对于高效方案的低效性。\n- 任务B中的公平性负担 $\\phi$，表示为小数，四舍五入到六位小数。\n- 任务B中公平性约束分配下的总削减量（单位MW），四舍五入到三位小数。\n\n你的程序应假设所有量纲均为兆瓦（MW），并以MW为单位表示所有削减输出。公平性负担应表示为小数，而不是百分比。你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[result\\_1,result\\_2,\\dots]$）。对于多个测试用例，将每个测试用例的结果聚合为一个列表的列表。\n\n使用以下测试套件，其中每个测试用例是一个元组 $(\\mathbf{p}, \\mathbf{r}, F_0, F_{\\max})$：\n- 测试用例1：$\\mathbf{p} = [0.9, 0.6, 0.1, -0.2, 0.0]$，$\\mathbf{r} = [70, 50, 500, 20, 10]$ 单位为MW，$F_0 = 140$ MW，$F_{\\max} = 110$ MW。\n- 测试用例2：$\\mathbf{p} = [0.7, 0.3, -0.2]$，$\\mathbf{r} = [20, 10, 5]$ 单位为MW，$F_0 = 117$ MW，$F_{\\max} = 100$ MW。\n- 测试用例3：$\\mathbf{p} = [0.5, 0.2, 0.0, -0.1]$，$\\mathbf{r} = [10, 10, 100, 5]$ 单位为MW，$F_0 = 95$ MW，$F_{\\max} = 100$ MW。\n\n注意：\n- 对于每个测试用例，计算 $D = \\max\\{0, F_0 - F_{\\max}\\}$（单位为MW）。\n- 假设所有测试用例都满足可行性，即 $\\phi \\in [0,1]$ 的公平性约束分配能够满足所需的缓解量 $D$。如果 $D = 0$，则所有削减量应为 $0$ MW，且 $\\phi = 0$。\n- 在所有计算中，为了拥塞缓解的目的，忽略 $p_i \\le 0$ 的母线。\n\n最终输出格式：你的程序应生成单行输出，表示一个包含三个元素（每个测试用例一个）的列表。每个元素本身必须是包含四个浮点数的列表，顺序与上文描述完全一致，并应用规定的四舍五入。例如，打印输出应类似于 $[[a,b,c,d],[\\dots],[\\dots]]$，其中 $a,b,d$ 的单位是MW，$c$ 是一个小数。",
            "solution": "问题陈述经评估有效。它在科学上基于电力系统工程中的标准方法——线性化直流潮流分析的既定原则。问题提法恰当，包含了推导已定义任务的唯一且有意义的解所需的所有必要数据和约束。语言客观而精确。\n\n核心任务是确定用于缓解输电拥塞的最优和公平的可再生能源削减策略。给定一组母线 $i \\in \\{1,\\dots,N\\}$，它们相对于拥塞线路 $\\ell$ 的功率转移分布因子（PTDF）$p_i$，以及它们可用的可再生能源发电量 $r_i$。拥塞被量化为所需的缓解量 $D = \\max\\{0, F_0 - F_{\\max}\\}$，其中 $F_0$ 是基础潮流，$F_{\\max}$ 是线路的热极限。\n\n母线 $i$ 处的削减动作 $c_i$ 减少了净注入功率，提供的总缓解量为 $\\sum_{i=1}^N p_i c_i$。削减的约束条件是对于所有 $i$，$0 \\le c_i \\le r_i$，并且重要的是，只有 $p_i  0$ 的母线才能有效缓解此特定拥塞，因此对于所有 $p_i \\le 0$ 的 $i$，我们必须有 $c_i = 0$。令 $I_+$ 为 $p_i  0$ 的索引集合。因此，缓解约束为 $\\sum_{i \\in I_+} p_i c_i \\ge D$。\n\n如果 $D = 0$，则不存在拥塞，也无需进行削减。在这种简单情况下，所有计算出的削减值都将为 $0$，公平性负担 $\\phi$ 也将为 $0$。下面的推导假设 $D  0$。\n\n### 任务 A：基于效率的削减\n\n目标是在满足缓解约束的同时，最小化总削减能量 $C_{total} = \\sum_{i \\in I_+} c_i$。该问题被表述为一个线性规划问题：\n$$\n\\begin{aligned}\n\\text{最小化} \\quad  \\sum_{i \\in I_+} c_i \\\\\n\\text{约束条件} \\quad  \\sum_{i \\in I_+} p_i c_i \\ge D \\\\\n 0 \\le c_i \\le r_i, \\quad \\forall i \\in I_+\n\\end{aligned}\n$$\n为了从第一性原理推导解，我们分析每个母线处削减的效率。母线 $i \\in I_+$ 的效率可以定义为每单位削减能量所实现的拥塞缓解量。对于一次削减 $c_i$，缓解量为 $p_i c_i$。“成本”为 $c_i$。效益（缓解量）与成本（削减量）之比为 $\\frac{p_i c_i}{c_i} = p_i$。\n\n因此，PTDF值 $p_i$ 是母线 $i$ 削减效率的直接度量。为了以最小的总削减量 $\\sum c_i$ 实现所需的缓解量 $D$，我们必须优先从最有效的母线——即那些具有最高 $p_i$ 值的母线——进行削减。\n\n这导出了一个贪心算法：\n1. 识别所有母线 $i \\in I_+$（其中 $p_i  0$）。\n2. 按其 $p_i$ 值对这些母线进行降序排序。\n3. 遍历排序后的母线，从每个母线削减发电量，直到累积缓解量达到或超过 $D$。对于排序序列中的每个母线 $j$，我们确定必要的削减量 $c_j$。设 $D_{rem}$ 为剩余所需的缓解量。母线 $j$ 的削减量为 $c_j = \\min\\left(r_j, \\frac{D_{rem}}{p_j}\\right)$。我们更新 $D_{rem} \\leftarrow D_{rem} - p_j c_j$，如果 $D_{rem}  0$，则继续处理下一个母线。\n\n由于问题的线性特性，这种贪心策略是最优的。任何偏离此策略的做法，例如用来自低PTDF母线 $j$ ($p_j  p_k$) 的削减来替代来自高PTDF母线 $k$ 的少量削减 $\\delta c_k$，都将是低效的。为了维持相同的缓解量 $\\Delta F = p_k \\delta c_k$，母线 $j$ 处的替代削减量必须为 $\\delta c_j = \\frac{p_k}{p_j} \\delta c_k$。由于 $p_k > p_j$，因此 $\\delta c_j > \\delta c_k$，导致总削减量更大。这证明了升序削减方案本质上比降序方案效率低，除非无论顺序如何都必须削减所有可用发电量。\n\n实现将计算最优策略（$p_i$ 降序）和可证明的低效策略（$p_i$ 升序）的总削减量。\n\n### 任务 B：公平性约束下的削减\n\n该任务施加了一个公平性约束：所有有贡献的生产者（$p_i  0$ 的生产者）必须按其可用发电量的相同比例 $\\phi \\in [0,1]$ 进行削减。这意味着对于所有 $i \\in I_+$，$c_i = \\phi r_i$，否则 $c_i=0$。\n\n我们需要找到满足缓解约束的最小 $\\phi$。我们将公平性约束的削减代入缓解不等式：\n$$\n\\sum_{i \\in I_+} p_i c_i \\ge D\n$$\n$$\n\\sum_{i \\in I_+} p_i (\\phi r_i) \\ge D\n$$\n由于 $\\phi$ 对于 $I_+$ 中的所有母线都是一个标量常数，我们可以将其因子提出：\n$$\n\\phi \\left( \\sum_{i \\in I_+} p_i r_i \\right) \\ge D\n$$\n为了找到满足条件的 $\\phi$ 的最小值，我们求解等式：\n$$\n\\phi = \\frac{D}{\\sum_{i \\in I_+} p_i r_i}\n$$\n问题陈述保证了存在一个 $\\phi \\in [0,1]$ 的可行解，这意味着最大可能的缓解量 $\\sum_{i \\in I_+} p_i r_i$ 大于或等于 $D$。如果分母为零，则必然有 $D=0$，因此 $\\phi=0$。\n\n在这种公平性约束分配下的总削减量是各个削减量之和：\n$$\nC_{total, fair} = \\sum_{i \\in I_+} c_i = \\sum_{i \\in I_+} \\phi r_i = \\phi \\sum_{i \\in I_+} r_i\n$$\n结合这两个表达式，我们得到：\n$$\nC_{total, fair} = \\left( \\frac{D}{\\sum_{j \\in I_+} p_j r_j} \\right) \\left( \\sum_{i \\in I_+} r_i \\right)\n$$\n这为公平性方案下的总削减量提供了一个直接的公式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the renewable curtailment problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        (np.array([0.9, 0.6, 0.1, -0.2, 0.0]), np.array([70, 50, 500, 20, 10]), 140.0, 110.0),\n        (np.array([0.7, 0.3, -0.2]), np.array([20, 10, 5]), 117.0, 100.0),\n        (np.array([0.5, 0.2, 0.0, -0.1]), np.array([10, 10, 100, 5]), 95.0, 100.0),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        p_vec, r_vec, f0, fmax = case\n        \n        # Calculate required congestion relief D\n        D = max(0.0, f0 - fmax)\n\n        if D == 0.0:\n            # No congestion, all curtailment values are zero.\n            all_results.append([0.0, 0.0, 0.0, 0.0])\n            continue\n\n        # Filter for buses that can help relieve congestion (p_i > 0)\n        positive_p_mask = p_vec > 0\n        p_pos = p_vec[positive_p_mask]\n        r_pos = r_vec[positive_p_mask]\n\n        if len(p_pos) == 0:\n            # This case assumes feasibility, but as a safeguard.\n            # If no generators can help, curtailment is impossible. For this problem,\n            # this implies D=0, which is handled above.\n            all_results.append([0.0, 0.0, 0.0, 0.0])\n            continue\n            \n        # --- Task A: Efficiency-based curtailment (Greedy, descending PTDF) ---\n        sorted_indices_desc = np.argsort(p_pos)[::-1]\n        p_sorted_desc = p_pos[sorted_indices_desc]\n        r_sorted_desc = r_pos[sorted_indices_desc]\n\n        total_curtailment_eff = 0.0\n        relief_needed = D\n        for p_i, r_i in zip(p_sorted_desc, r_sorted_desc):\n            max_relief_from_bus = p_i * r_i\n            if relief_needed > max_relief_from_bus:\n                total_curtailment_eff += r_i\n                relief_needed -= max_relief_from_bus\n            else:\n                curtailment_needed = relief_needed / p_i\n                total_curtailment_eff += curtailment_needed\n                relief_needed = 0.0\n                break\n        \n        # --- Inefficient curtailment (Greedy, ascending PTDF) ---\n        sorted_indices_asc = np.argsort(p_pos)\n        p_sorted_asc = p_pos[sorted_indices_asc]\n        r_sorted_asc = r_pos[sorted_indices_asc]\n\n        total_curtailment_ineff = 0.0\n        relief_needed_ineff = D\n        for p_i, r_i in zip(p_sorted_asc, r_sorted_asc):\n            max_relief_from_bus = p_i * r_i\n            if relief_needed_ineff > max_relief_from_bus:\n                total_curtailment_ineff += r_i\n                relief_needed_ineff -= max_relief_from_bus\n            else:\n                curtailment_needed = relief_needed_ineff / p_i\n                total_curtailment_ineff += curtailment_needed\n                relief_needed_ineff = 0.0\n                break\n\n        # --- Task B: Fairness-constrained allocation ---\n        max_possible_relief = np.sum(p_pos * r_pos)\n        \n        phi = 0.0\n        if max_possible_relief > 0:\n            phi = D / max_possible_relief\n        \n        total_renewable_at_pos_buses = np.sum(r_pos)\n        total_curtailment_fair = phi * total_renewable_at_pos_buses\n        \n        # Store results for the current test case with specified rounding\n        case_results = [\n            round(total_curtailment_eff, 3),\n            round(total_curtailment_ineff, 3),\n            round(phi, 6),\n            round(total_curtailment_fair, 3)\n        ]\n        all_results.append(case_results)\n\n    # Format final output string to match [[a,b,c,d],[e,f,g,h],...]\n    formatted_cases = []\n    for res_list in all_results:\n        # Format numbers to avoid trailing .0 for integers\n        formatted_list = [f\"{x:.3f}\" if i in [0,1,3] else f\"{x:.6f}\" for i, x in enumerate(res_list)]\n        inner_str = ','.join(formatted_list)\n        formatted_cases.append(f\"[{inner_str}]\")\n        \n    final_output_str = f\"[{','.join(formatted_cases)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了为何以及在何处会发生弃电之后，我们必须能够准确地对其进行度量。本练习旨在解决一个常见的现实世界数据分析问题：因数据“削峰”（clipping）而导致的弃电量低估，即当可用功率数据被限制在逆变器的交流额定容量时。你将量化这种偏差，并开发一种修正方法，从而强调在能源分析中理解数据局限性的重要性。",
            "id": "4116409",
            "problem": "一个为可再生能源发电建模的发电厂，拥有一年（即 $N = 8760$ 小时）的每小时遥测数据。设该发电厂的直流 (DC) 额定功率为 $R^{\\mathrm{DC}}$（单位：兆瓦，MW），交流 (AC) 铭牌额定功率为 $R^{\\mathrm{AC}}$（单位：兆瓦，MW）。对于每个小时 $t \\in \\{1,2,\\dots,N\\}$，定义以下量：\n- 无约束潜在功率 $P^{\\mathrm{pot}}_t$（单位：兆瓦，MW），即在没有任何电网限电或交流转换瓶颈的情况下本应产生的功率。\n- 电网调度限电上限 $U_t$（单位：兆瓦，MW），表示系统运营商在小时 $t$ 允许的最大交流功率，其中 $U_t = +\\infty$ 表示没有限电上限。\n- 实际交流输出功率 $P^{\\mathrm{AC}}_t$（单位：兆瓦，MW），遵循物理约束 $P^{\\mathrm{AC}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}, U_t\\right)$。\n\n定义交流受限的可用性遥测数据为 $A^{\\mathrm{clip}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}\\right)$，适用于每个小时 $t$。使用以一小时为分辨率（$\\Delta t = 1$ 小时）的基本能量核算，无交流削峰的年度可用电能为 $E^{\\mathrm{avail,true}} = \\sum_{t=1}^N P^{\\mathrm{pot}}_t \\Delta t$（单位：兆瓦时，MWh），年度输送电能为 $E^{\\mathrm{deliv}} = \\sum_{t=1}^N P^{\\mathrm{AC}}_t \\Delta t$（单位：兆瓦时，MWh），基于真实情况的年度弃电电能为 $E^{\\mathrm{curt,true}} = \\sum_{t=1}^N \\max\\left(0, P^{\\mathrm{pot}}_t - P^{\\mathrm{AC}}_t\\right) \\Delta t$（单位：兆瓦时，MWh）。电站级的真实弃电率为\n$$\nCF^{\\mathrm{true}} = \\frac{E^{\\mathrm{curt,true}}}{E^{\\mathrm{avail,true}}}.\n$$\n另外，如果可用性报告中已包含交流受限的削峰，则年度削峰后可用电能为 $E^{\\mathrm{avail,clip}} = \\sum_{t=1}^N A^{\\mathrm{clip}}_t \\Delta t$（单位：兆瓦时，MWh），年度削峰后弃电电能为 $E^{\\mathrm{curt,clip}} = \\sum_{t=1}^N \\max\\left(0, A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t\\right) \\Delta t$（单位：兆瓦时，MWh），削峰后的弃电率为\n$$\nCF^{\\mathrm{clip}} = \\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}}.\n$$\n由交流削峰在弃电量化中引起的偏差为 $B = CF^{\\mathrm{clip}} - CF^{\\mathrm{true}}$。请从基本原理出发，证明 $B \\le 0$，用交流额定功率和无约束潜在功率来量化 $B$，并设计一种校正方法，以便在已知 $P^{\\mathrm{pot}}_t$ 和 $R^{\\mathrm{AC}}$ 的情况下，从 $CF^{\\mathrm{clip}}$ 中恢复 $CF^{\\mathrm{true}}$。\n\n您的程序必须：\n- 根据以下方法，为每个测试用例生成一整年（$N = 8760$）的确定性合成每小时遥测数据。使用一个经季节性调制的日变化形态来构建物理上合理的 $P^{\\mathrm{pot}}_t$。具体来说，对于小时索引 $h \\in \\{0,1,\\dots,8759\\}$，设年内日为 $d = \\lfloor h/24 \\rfloor + 1$，日内小时为 $q = h \\bmod 24$。定义一个季节性因子\n$$\nS(d) = \\max\\left(0, \\min\\left(1, 0.6 + 0.4 \\cos\\left(\\frac{2\\pi (d - 172)}{365}\\right)\\right)\\right),\n$$\n和一个日变化因子\n$$\nD(q) = \\max\\left(0, \\cos\\left(\\frac{\\pi (q - 12)}{12}\\right)\\right)^{1.2}.\n$$\n然后设置\n$$\nP^{\\mathrm{pot}}_t = R^{\\mathrm{DC}} \\cdot S(d) \\cdot D(q),\n$$\n其中 $R^{\\mathrm{DC}}$ 的单位为兆瓦 (MW)。对于每个小时，根据下面指定的限电窗口构建 $U_t$，并计算 $P^{\\mathrm{AC}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}, U_t\\right)$。\n- 计算每个测试用例的 $CF^{\\mathrm{true}}$、$CF^{\\mathrm{clip}}$ 和 $B$。所有弃电率均表示为小数值（例如，$0.125$），不带百分号。\n- 实现并应用校正方法，使用您推导出的恒等式从削峰后的遥测数据中恢复 $CF^{\\mathrm{true}}$，并数值验证校正后的值在数值精度范围内与 $CF^{\\mathrm{true}}$ 相等。\n\n使用以下参数值的测试套件，该套件涵盖了一般情况、无削峰边界情况、重度削峰情况以及无电网限电的纯削峰情况：\n- 测试用例 1（“一般情况”）：$R^{\\mathrm{DC}} = 120$ MW，$R^{\\mathrm{AC}} = 100$ MW，在年内日 $d \\in \\{80,81,\\dots,110\\}$ 且日内小时 $q \\in \\{10,11,12,13,14,15\\}$ 的所有小时内，电网限电上限 $U_t = 70$ MW，其他时间 $U_t = +\\infty$。\n- 测试用例 2（“无削峰”）：$R^{\\mathrm{DC}} = 100$ MW，$R^{\\mathrm{AC}} = 150$ MW，在年内日 $d \\in \\{80,81,\\dots,110\\}$ 且日内小时 $q \\in \\{10,11,12,13,14,15\\}$ 的所有小时内，电网限电上限 $U_t = 60$ MW，其他时间 $U_t = +\\infty$。\n- 测试用例 3（“重度削峰”）：$R^{\\mathrm{DC}} = 160$ MW，$R^{\\mathrm{AC}} = 80$ MW，在年内日 $d \\in \\{180,181,\\dots,210\\}$ 且日内小时 $q \\in \\{10,11,12,13,14,15\\}$ 的所有小时内，电网限电上限 $U_t = 50$ MW，其他时间 $U_t = +\\infty$。\n- 测试用例 4（“纯削峰，无弃电”）：$R^{\\mathrm{DC}} = 120$ MW，$R^{\\mathrm{AC}} = 100$ MW，无电网限电上限，即所有小时 $U_t = +\\infty$。\n\n所有功率量的单位必须为兆瓦 (MW)，所有电能量的单位必须为兆瓦时 (MWh)。您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起，结果按 $[CF^{\\mathrm{true}}_1, CF^{\\mathrm{clip}}_1, B_1, CF^{\\mathrm{true}}_2, CF^{\\mathrm{clip}}_2, B_2, CF^{\\mathrm{true}}_3, CF^{\\mathrm{clip}}_3, B_3, CF^{\\mathrm{true}}_4, CF^{\\mathrm{clip}}_4, B_4]$ 的顺序排列，每个条目格式化为小数值。",
            "solution": "所述问题是有效的。这是一个表述清晰、自成体系且具有科学依据的能源系统分析练习，具体涉及可再生能源弃电核算领域。所有术语都经过数学上的精确定义，数据生成过程明确，而目标——数学推导和数值验证——是标准的科学任务。该问题没有事实错误、歧义和主观性。\n\n核心任务是分析在使用交流受限的可用性数据（而非真实的、无约束的潜在功率）计算弃电损失时引入的系统性偏差。设偏差为 $B = CF^{\\mathrm{clip}} - CF^{\\mathrm{true}}$。我们的分析将首先推导能量分量的关键恒等式，然后用这些恒等式证明 $B \\le 0$ 并对其进行量化，最后推导出一个用于校正此偏差的公式。\n\n首先，我们建立主要能量量之间的关系。所有能量聚合量均在 $N = 8760$ 小时内以 $\\Delta t = 1$ 小时的时间分辨率计算。因此，任何以 MWh 为单位的年度电能量在数值上等于相应每小时功率值（以 MW 为单位）的总和。\n\n每小时无约束潜在功率 $P^{\\mathrm{pot}}_t$ 可以分解为两个部分：在交流逆变器容量范围内的部分 $A^{\\mathrm{clip}}_t = \\min(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}})$，以及超过该容量的部分，我们将其定义为每小时削峰损失 $P^{\\mathrm{loss,clip}}_t$。\n$$P^{\\mathrm{loss,clip}}_t = \\max\\left(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}}\\right)$$\n根据定义，对于每个小时 $t$：\n$$P^{\\mathrm{pot}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}\\right) + \\max\\left(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}}\\right) = A^{\\mathrm{clip}}_t + P^{\\mathrm{loss,clip}}_t$$\n对所有小时 $t \\in \\{1, 2, \\dots, N\\}$ 求和，得到年度可用电能指标之间的关系：\n$$E^{\\mathrm{avail,true}} = \\sum_{t=1}^N P^{\\mathrm{pot}}_t \\Delta t = \\sum_{t=1}^N A^{\\mathrm{clip}}_t \\Delta t + \\sum_{t=1}^N P^{\\mathrm{loss,clip}}_t \\Delta t = E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}$$\n其中 $E^{\\mathrm{loss,clip}}$ 是由于交流逆变器削峰而损失的总年度电能。\n\n接下来，我们分析弃电电能。真实的每小时未捕获功率是差值 $P^{\\mathrm{pot}}_t - P^{\\mathrm{AC}}_t$。削峰后的每小时未捕获功率是 $A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t$。使用 $P^{\\mathrm{pot}}_t$ 的分解，我们发现：\n$$P^{\\mathrm{pot}}_t - P^{\\mathrm{AC}}_t = \\left(A^{\\mathrm{clip}}_t + P^{\\mathrm{loss,clip}}_t\\right) - P^{\\mathrm{AC}}_t = \\left(A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t\\right) + P^{\\mathrm{loss,clip}}_t$$\n由于 $P^{\\mathrm{pot}}_t \\ge A^{\\mathrm{clip}}_t \\ge P^{\\mathrm{AC}}_t$，此恒等式中的所有项都是非负的。项 $(A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t)$ 表示被电网运营商限制的功率（即低于交流受限可用性的部分），而 $P^{\\mathrm{loss,clip}}_t$ 表示因交流削峰而损失的功率。“真实”的未捕获功率是这两种不同损失机制的总和。对所有小时求和，得到年度弃电电能的关系：\n$$E^{\\mathrm{curt,true}} = E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}$$\n\n有了这些基本恒等式，我们就可以分析偏差 $B$：\n$$B = CF^{\\mathrm{clip}} - CF^{\\mathrm{true}} = \\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}} - \\frac{E^{\\mathrm{curt,true}}}{E^{\\mathrm{avail,true}}}$$\n代入“真实”量的推导恒等式，得到：\n$$B = \\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}} - \\frac{E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$$\n要证明 $B \\le 0$，我们必须证明 $\\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}} \\le \\frac{E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$。设 $x = E^{\\mathrm{curt,clip}}$，$y = E^{\\mathrm{avail,clip}}$，且 $z = E^{\\mathrm{loss,clip}}$。这三个量都是非负的。假设有非平凡的发电量，则 $y  0$。不等式为 $\\frac{x}{y} \\le \\frac{x+z}{y+z}$。由于分母为正，我们可以交叉相乘：\n$$x(y+z) \\le y(x+z) \\implies xy + xz \\le yx + yz \\implies xz \\le yz$$\n如果 $z=0$ 或 $x \\le y$，则此不等式成立。根据定义，$z = E^{\\mathrm{loss,clip}} \\ge 0$。为了检查是否 $x \\le y$，我们比较 $E^{\\mathrm{curt,clip}} = \\sum_t \\max(0, A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t)\\Delta t$ 和 $E^{\\mathrm{avail,clip}} = \\sum_t A^{\\mathrm{clip}}_t \\Delta t$。由于 $P^{\\mathrm{AC}}_t = \\min(A^{\\mathrm{clip}}_t, U_t) \\ge 0$，我们有对所有 $t$ 都有 $\\max(0, A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t) \\le A^{\\mathrm{clip}}_t$。对所有小时求和证实了 $E^{\\mathrm{curt,clip}} \\le E^{\\mathrm{avail,clip}}$，即 $x \\le y$。因此，条件 $xz \\le yz$ 总是满足的，从而证明了 $B \\le 0$。这证实了，基于削峰后的可用性基准计算弃电率会系统性地低估（或至多等于）真实的弃电率。等式 $B=0$ 成立当且仅当 $E^{\\mathrm{loss,clip}} \\cdot E^{\\mathrm{deliv}} = 0$，其中 $E^{\\mathrm{deliv}} = E^{\\mathrm{avail,clip}} - E^{\\mathrm{curt,clip}}$。这发生在没有削峰损失（$E^{\\mathrm{loss,clip}}=0$）或没有电能输送（$E^{\\mathrm{deliv}}=0$）的情况下。\n\n用交流额定功率和无约束潜在功率来量化 $B$ 由为 $B$ 推导的表达式给出。项 $E^{\\mathrm{curt,clip}}$、$E^{\\mathrm{avail,clip}}$ 和 $E^{\\mathrm{loss,clip}} = \\sum_t \\max(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}})\\Delta t$ 都依赖于 $P^{\\mathrm{pot}}_t$ 和 $R^{\\mathrm{AC}}$。\n\n最后，为了设计一种能恢复 $CF^{\\mathrm{true}}$ 的校正方法，我们从其以分解能量量表示的定义开始：\n$$CF^{\\mathrm{true}} = \\frac{E^{\\mathrm{curt,true}}}{E^{\\mathrm{avail,true}}} = \\frac{E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$$\n根据定义 $CF^{\\mathrm{clip}} = E^{\\mathrm{curt,clip}} / E^{\\mathrm{avail,clip}}$，我们可以写出 $E^{\\mathrm{curt,clip}} = CF^{\\mathrm{clip}} \\cdot E^{\\mathrm{avail,clip}}$。将此代入 $CF^{\\mathrm{true}}$ 的方程中，得到校正公式：\n$$CF^{\\mathrm{true}} = \\frac{CF^{\\mathrm{clip}} \\cdot E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$$\n这个公式可以精确地恢复 $CF^{\\mathrm{true}}$。要使用它，需要 $CF^{\\mathrm{clip}}$ 和 $E^{\\mathrm{avail,clip}}$（可以从交流侧遥测数据，即 $A^{\\mathrm{clip}}_t$ 和 $P^{\\mathrm{AC}}_t$ 计算得出）以及总削峰损失 $E^{\\mathrm{loss,clip}}$。问题指明 $P^{\\mathrm{pot}}_t$ 和 $R^{\\mathrm{AC}}$ 是已知的，这使得可以直接计算 $E^{\\mathrm{loss,clip}} = \\sum_t \\max(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}})\\Delta t$，从而实现校正。\n\n此任务的数值部分涉及实现此框架以生成合成数据并为指定的测试用例计算这些量。实现将构建时间序列，计算总能量聚合，计算弃电率和偏差，并验证校正公式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the renewable curtailment modeling problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"general\",\n            \"R_DC\": 120.0,\n            \"R_AC\": 100.0,\n            \"curtail_cap\": 70.0,\n            \"curtail_day_range\": (80, 110),\n            \"curtail_hour_range\": (10, 15),\n        },\n        {\n            \"name\": \"no clipping\",\n            \"R_DC\": 100.0,\n            \"R_AC\": 150.0,\n            \"curtail_cap\": 60.0,\n            \"curtail_day_range\": (80, 110),\n            \"curtail_hour_range\": (10, 15),\n        },\n        {\n            \"name\": \"heavy clipping\",\n            \"R_DC\": 160.0,\n            \"R_AC\": 80.0,\n            \"curtail_cap\": 50.0,\n            \"curtail_day_range\": (180, 210),\n            \"curtail_hour_range\": (10, 15),\n        },\n        {\n            \"name\": \"pure clipping, no curtailment\",\n            \"R_DC\": 120.0,\n            \"R_AC\": 100.0,\n            \"curtail_cap\": np.inf,\n            \"curtail_day_range\": (0, 0), # No curtailment window\n            \"curtail_hour_range\": (0, 0),\n        },\n    ]\n\n    results = []\n    N = 8760\n    delta_t = 1.0  # hour\n\n    # Generate time indices\n    h = np.arange(N)\n    d = np.floor(h / 24).astype(int) + 1  # Day of year, 1 to 365\n    q = h % 24  # Hour of day, 0 to 23\n\n    for case in test_cases:\n        R_DC = case[\"R_DC\"]\n        R_AC = case[\"R_AC\"]\n\n        # Step 1: Generate synthetic telemetry\n        \n        # Seasonal factor S(d)\n        seasonal_factor = np.maximum(0, np.minimum(1, 0.6 + 0.4 * np.cos(2 * np.pi * (d - 172) / 365)))\n        \n        # Diurnal factor D(q)\n        diurnal_factor = np.maximum(0, np.cos(np.pi * (q - 12) / 12))**1.2\n        \n        # Unconstrained potential power P_pot_t\n        P_pot = R_DC * seasonal_factor * diurnal_factor\n\n        # Grid-dispatch curtailment cap U_t\n        U = np.full(N, np.inf)\n        if np.isfinite(case[\"curtail_cap\"]):\n            d_start, d_end = case[\"curtail_day_range\"]\n            q_start, q_end = case[\"curtail_hour_range\"]\n            curtailment_mask = (d >= d_start)  (d = d_end)  (q >= q_start)  (q = q_end)\n            U[curtailment_mask] = case[\"curtail_cap\"]\n\n        # Realized AC output P_AC_t\n        P_AC = np.minimum(P_pot, R_AC)\n        P_AC = np.minimum(P_AC, U)\n        \n        # AC-limited availability A_clip_t\n        A_clip = np.minimum(P_pot, R_AC)\n\n        # Step 2: Compute annual energy quantities\n        # Note: Since delta_t = 1, Energy (MWh) = sum of Power (MW)\n        E_avail_true = np.sum(P_pot)\n        E_avail_clip = np.sum(A_clip)\n        E_deliv = np.sum(P_AC)\n\n        # It is numerically more stable and definitionally equivalent to calculate\n        # curtailed energies from the delivered energy.\n        E_curt_true = E_avail_true - E_deliv\n        E_curt_clip = E_avail_clip - E_deliv\n        \n        # Step 3: Compute curtailment factors and bias\n        \n        # Handle division by zero for cases with no generation\n        CF_true = E_curt_true / E_avail_true if E_avail_true > 0 else 0.0\n        CF_clip = E_curt_clip / E_avail_clip if E_avail_clip > 0 else 0.0\n        \n        B = CF_clip - CF_true\n        \n        results.extend([CF_true, CF_clip, B])\n\n        # Step 4 (Numerical Verification): Apply correction to recover CF_true\n        # This part verifies the derived formula but is not part of the final output string itself.\n        E_loss_clip = E_avail_true - E_avail_clip\n        if (E_avail_clip + E_loss_clip) > 0:\n            CF_true_corrected = (CF_clip * E_avail_clip + E_loss_clip) / (E_avail_clip + E_loss_clip)\n            assert np.isclose(CF_true, CF_true_corrected), f\"Correction failed for case {case['name']}\"\n        else: # Trivial case of no generation\n            assert np.isclose(CF_true, 0.0)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}