{
    "hands_on_practices": [
        {
            "introduction": "在使用聚合时间序列的模型得到优化结果后，一个基本任务是将其扩展回原始的完整时间范围，以估算年度总成本或排放量。此过程依赖于频率权重进行线性缩放，即每个代表日的结果乘以它所代表的原始天数。这个练习将帮助你掌握从聚合模型输出重建全年指标的基本计算方法。",
            "id": "4117300",
            "problem": "一个电力系统模型使用时间聚类方法，将全年$365$天的每日时间序列聚合成$4$个代表性日，以降低运营和投资优化问题的维度。这$365$个原始日被划分为$4$个不相交的簇，每个簇由一个单独的典型日代表。该模型假设运营成本和排放在时间上具有线性可加性，并且当一个代表性日代表多个原始日时，进行线性缩放。聚合过程遵守天数守恒原则，并使用等于每个典型日所代表的原始天数的频率权重。聚合后的优化模型为每个代表性日生成了以下输出：每日运营成本（单位：美元/天）和每日排放量（单位：公吨二氧化碳(CO2)/天）。此外，优化模型还生成了由容量投资产生的年度固定成本。\n\n代表性日 A：\n- 簇大小 $n_{\\mathrm{A}} = 120$\n- 每日运营成本 $C_{\\mathrm{A}} = 1.35 \\times 10^{6}$ 美元/天\n- 每日排放量 $E_{\\mathrm{A}} = 780$ 公吨CO2/天\n\n代表性日 B：\n- 簇大小 $n_{\\mathrm{B}} = 150$\n- 每日运营成本 $C_{\\mathrm{B}} = 1.10 \\times 10^{6}$ 美元/天\n- 每日排放量 $E_{\\mathrm{B}} = 620$ 公吨CO2/天\n\n代表性日 C：\n- 簇大小 $n_{\\mathrm{C}} = 80$\n- 每日运营成本 $C_{\\mathrm{C}} = 1.80 \\times 10^{6}$ 美元/天\n- 每日排放量 $E_{\\mathrm{C}} = 950$ 公吨CO2/天\n\n代表性日 D：\n- 簇大小 $n_{\\mathrm{D}} = 15$\n- 每日运营成本 $C_{\\mathrm{D}} = 2.40 \\times 10^{6}$ 美元/天\n- 每日排放量 $E_{\\mathrm{D}} = 1{,}300$ 公吨CO2/天\n\n容量投资的年度固定成本：\n- $F = 2.50 \\times 10^{8}$ 美元/年\n\n假设排放量的估值使用每公吨CO2 $50$美元的碳价$\\lambda = 50$，并且所有成本和排放量都与其代表性日的频率权重呈线性关系。计算每个代表性日的频率权重，并用它们来重构年度运营成本和年度排放量。然后，计算重构的年度总目标值，其定义为年度固定成本、年度运营成本和年度排放量碳估值之和。以百万美元为单位表示最终答案，并将结果四舍五入到四位有效数字。",
            "solution": "问题陈述已经过验证，是自洽的，其科学基础植根于能源系统建模的原理，并且在数学上是适定的。所提供的数据是一致的，因为各簇的大小之和 $n_{\\mathrm{A}} + n_{\\mathrm{B}} + n_{\\mathrm{C}} + n_{\\mathrm{D}} = 120 + 150 + 80 + 15 = 365$，这正确地涵盖了一年中的所有天数。该问题要求根据基于代表性日的优化模型输出，重构年度总成本和排放量。\n\n这种重构的核心原则是每日数量（成本和排放量）根据其相应的频率权重进行线性缩放。问题陈述指出，频率权重等于簇的大小，即每个代表性日所代表的原始时间序列中的天数。\n\n设代表性日的集合为 $\\mathcal{D} = \\{\\mathrm{A}, \\mathrm{B}, \\mathrm{C}, \\mathrm{D}\\}$。对于每个代表性日 $i \\in \\mathcal{D}$，我们已知其簇大小 $n_i$、每日运营成本 $C_i$ 和每日排放量 $E_i$。\n\n首先，我们确定每个代表性日的频率权重 $w_i$。根据问题描述，这些权重等于簇的大小：\n- A日的频率权重：$w_{\\mathrm{A}} = n_{\\mathrm{A}} = 120$ 天\n- B日的频率权重：$w_{\\mathrm{B}} = n_{\\mathrm{B}} = 150$ 天\n- C日的频率权重：$w_{\\mathrm{C}} = n_{\\mathrm{C}} = 80$ 天\n- D日的频率权重：$w_{\\mathrm{D}} = n_{\\mathrm{D}} = 15$ 天\n\n接下来，我们通过将每个代表性日的每日运营成本乘以其频率权重后求和，来计算重构的年度运营成本 $C_{\\text{annual}}$。\n$$C_{\\text{annual}} = \\sum_{i \\in \\mathcal{D}} w_i C_i = n_{\\mathrm{A}}C_{\\mathrm{A}} + n_{\\mathrm{B}}C_{\\mathrm{B}} + n_{\\mathrm{C}}C_{\\mathrm{C}} + n_{\\mathrm{D}}C_{\\mathrm{D}}$$\n代入给定值：\n$$C_{\\text{annual}} = (120 \\ \\text{天}) \\times (1.35 \\times 10^{6} \\ \\text{美元/天}) + (150 \\ \\text{天}) \\times (1.10 \\times 10^{6} \\ \\text{美元/天}) + (80 \\ \\text{天}) \\times (1.80 \\times 10^{6} \\ \\text{美元/天}) + (15 \\ \\text{天}) \\times (2.40 \\times 10^{6} \\ \\text{美元/天})$$\n$$C_{\\text{annual}} = (1.62 \\times 10^{8} \\ \\text{美元}) + (1.65 \\times 10^{8} \\ \\text{美元}) + (1.44 \\times 10^{8} \\ \\text{美元}) + (0.36 \\times 10^{8} \\ \\text{美元})$$\n$$C_{\\text{annual}} = (1.62 + 1.65 + 1.44 + 0.36) \\times 10^{8} \\ \\text{美元} = 5.07 \\times 10^{8} \\ \\text{美元}$$\n\n同样地，我们通过将每个代表性日的每日排放量乘以其频率权重后求和，来计算重构的年度排放量 $E_{\\text{annual}}$。\n$$E_{\\text{annual}} = \\sum_{i \\in \\mathcal{D}} w_i E_i = n_{\\mathrm{A}}E_{\\mathrm{A}} + n_{\\mathrm{B}}E_{\\mathrm{B}} + n_{\\mathrm{C}}E_{\\mathrm{C}} + n_{\\mathrm{D}}E_{\\mathrm{D}}$$\n代入给定值：\n$$E_{\\text{annual}} = (120 \\ \\text{天}) \\times (780 \\ \\text{公吨CO2/天}) + (150 \\ \\text{天}) \\times (620 \\ \\text{公吨CO2/天}) + (80 \\ \\text{天}) \\times (950 \\ \\text{公吨CO2/天}) + (15 \\ \\text{天}) \\times (1300 \\ \\text{公吨CO2/天})$$\n$$E_{\\text{annual}} = (93600 \\ \\text{公吨CO2}) + (93000 \\ \\text{公吨CO2}) + (76000 \\ \\text{公吨CO2}) + (19500 \\ \\text{公吨CO2})$$\n$$E_{\\text{annual}} = 282100 \\ \\text{公吨CO2}$$\n\n年度碳排放成本 $V_{\\text{carbon}}$ 是年度排放量与碳价 $\\lambda = 50$ 美元/公吨CO2 的乘积。\n$$V_{\\text{carbon}} = E_{\\text{annual}} \\times \\lambda$$\n$$V_{\\text{carbon}} = (282100 \\ \\text{公吨CO2}) \\times (50 \\ \\text{美元/公吨CO2}) = 14,105,000 \\ \\text{美元}$$\n$$V_{\\text{carbon}} = 1.4105 \\times 10^{7} \\ \\text{美元}$$\n\n年度总目标值 $Z_{\\text{total}}$ 是年度固定成本 $F$、年度运营成本 $C_{\\text{annual}}$ 和年度碳成本 $V_{\\text{carbon}}$ 的总和。\n$$Z_{\\text{total}} = F + C_{\\text{annual}} + V_{\\text{carbon}}$$\n给定的年度固定成本为 $F = 2.50 \\times 10^{8}$ 美元。\n$$Z_{\\text{total}} = (2.50 \\times 10^{8} \\ \\text{美元}) + (5.07 \\times 10^{8} \\ \\text{美元}) + (1.4105 \\times 10^{7} \\ \\text{美元})$$\n为了将这些值相加，我们用共同的 $10$ 的幂来表示它们：\n$$Z_{\\text{total}} = (2.50 \\times 10^{8}) + (5.07 \\times 10^{8}) + (0.14105 \\times 10^{8}) \\ \\text{美元}$$\n$$Z_{\\text{total}} = (2.50 + 5.07 + 0.14105) \\times 10^{8} \\ \\text{美元} = 7.71105 \\times 10^{8} \\ \\text{美元}$$\n\n问题要求最终答案以百万美元为单位表示。我们转换总目标值：\n$$Z_{\\text{total}} = 7.71105 \\times 10^{8} \\ \\text{美元} = 771.105 \\times 10^{6} \\ \\text{美元} = 771.105 \\ \\text{百万美元}$$\n\n最后，该值必须四舍五入到四位有效数字。该数字为 $771.105$。前四位有效数字是 $7$、$7$、$1$ 和 $1$。第五位数字是 $0$，所以我们向下舍入（截断）。\n四舍五入后的结果是 $771.1$ 百万美元。",
            "answer": "$$\\boxed{771.1}$$"
        },
        {
            "introduction": "选择何种方法来创建代表日并非无关紧要，它会直接影响关键系统特征的保留情况。本练习将对比两种最常见的技术：质心法（centroid-based），即通过对聚类中的所有日期进行逐时平均来构造一个“合成”日；以及中心点法（medoid-based），即选择一个聚类中“最具代表性”的真实日期。通过计算和比较峰值、爬坡和能量等关键指标，你将能亲身体会不同聚合选择所带来的权衡。",
            "id": "4117366",
            "problem": "观测一个电力需求时间序列，跨越连续 $4$ 天，每天包含 $6$ 个以千瓦为单位测量的小时值。这 $4$ 天的小时值按时间顺序排列如下：\n第 $1$ 天：$\\{10, 14, 12, 8, 9, 11\\}$，第 $2$ 天：$\\{9, 13, 15, 10, 8, 12\\}$，第 $3$ 天：$\\{7, 9, 12, 18, 14, 10\\}$，第 $4$ 天：$\\{6, 8, 11, 17, 13, 9\\}$。时间步长为 $1$ 小时。第 $1$ 天和第 $2$ 天构成聚类 $A$，第 $3$ 天和第 $4$ 天构成聚类 $B$。\n\n代表日聚合通过两种变体进行：\n- 基于质心：对于每个聚类，代表日是其成员日的小时级别算术平均值。\n- 基于中心点：对于每个聚类，代表日是与该聚类质心的欧几里得距离最小的那个实际成员日；如果出现平局，则选择时间顺序上较早的一天。\n\n聚合后的时间序列是通过将每个原始日（在其原始时间位置上）替换为其所属聚类的代表日而形成的。考虑在整个 $4$ 天聚合序列上计算的以下性能指标：\n- 峰值指标：所有小时中的最大值。\n- 爬坡指标：整个串联序列中相邻小时值之间的最大绝对差值，包括从一天的最后一个小时到下一天的第一个小时的过渡。\n- 能量指标：$4$ 天内所有小时值的总和，以千瓦时（kWh）表示。\n\n从算术平均值、实数向量空间中的欧几里得距离以及这些指标的定义出发，构建基于质心和基于中心点的聚合序列，为两种变体计算这三个指标，然后计算一个单一的复合标量。该标量定义为基于质心和基于中心点的指标之间相对差异向量的欧几里得范数，其中每个分量都通过在原始（未聚合）$4$ 天时间序列上计算的相应指标进行归一化。\n\n以纯小数形式提供最终的复合值。将答案四舍五入到四位有效数字。该复合值是无量纲的，请勿包含单位。",
            "solution": "问题陈述经评估为有效。它在标准的时间序列分析和能源系统建模技术方面具有科学依据。问题提法恰当，提供了所有必要的数据、关于聚类、聚合方法（质心和中心点）、性能指标（峰值、爬坡、能量）以及最终复合标量的清晰定义。中心点选择的平局决胜规则确保了解的唯一性。该问题客观且无歧义。\n\n设这四个日时间序列表示为 $\\mathbb{R}^6$ 中的向量：\n$D_1 = \\langle 10, 14, 12, 8, 9, 11 \\rangle$\n$D_2 = \\langle 9, 13, 15, 10, 8, 12 \\rangle$\n$D_3 = \\langle 7, 9, 12, 18, 14, 10 \\rangle$\n$D_4 = \\langle 6, 8, 11, 17, 13, 9 \\rangle$\n\n聚类为聚类 $A = \\{D_1, D_2\\}$ 和聚类 $B = \\{D_3, D_4\\}$。\n\n**1. 基于质心的代表日**\n一个向量聚类的质心是它们的小时级别算术平均值。对于一个包含 $N$ 天 $\\{X_1, ..., X_N\\}$ 的聚类，其质心 $C$ 由 $C = \\frac{1}{N} \\sum_{i=1}^{N} X_i$ 给出。\n\n对于聚类 $A$ (其中 $N=2$)：\n$R_A^C = \\frac{1}{2}(D_1 + D_2) = \\frac{1}{2}(\\langle 10+9, 14+13, 12+15, 8+10, 9+8, 11+12 \\rangle)$\n$R_A^C = \\frac{1}{2}(\\langle 19, 27, 27, 18, 17, 23 \\rangle) = \\langle 9.5, 13.5, 13.5, 9, 8.5, 11.5 \\rangle$\n\n对于聚类 $B$ (其中 $N=2$)：\n$R_B^C = \\frac{1}{2}(D_3 + D_4) = \\frac{1}{2}(\\langle 7+6, 9+8, 12+11, 18+17, 14+13, 10+9 \\rangle)$\n$R_B^C = \\frac{1}{2}(\\langle 13, 17, 23, 35, 27, 19 \\rangle) = \\langle 6.5, 8.5, 11.5, 17.5, 13.5, 9.5 \\rangle$\n\n**2. 基于中心点的代表日**\n中心点是使到聚类质心的欧几里得距离最小化的实际成员日。两个向量 $p, q \\in \\mathbb{R}^k$ 之间的欧几里得距离平方为 $d(p,q)^2 = \\sum_{i=1}^k (p_i - q_i)^2$。\n\n对于聚类 $A$，我们比较 $D_1$ 和 $D_2$ 到 $R_A^C$ 的距离：\n$d(D_1, R_A^C)^2 = (10-9.5)^2 + (14-13.5)^2 + (12-13.5)^2 + (8-9)^2 + (9-8.5)^2 + (11-11.5)^2$\n$d(D_1, R_A^C)^2 = 0.5^2 + 0.5^2 + (-1.5)^2 + (-1)^2 + 0.5^2 + (-0.5)^2 = 0.25 + 0.25 + 2.25 + 1 + 0.25 + 0.25 = 4.25$\n$d(D_2, R_A^C)^2 = (9-9.5)^2 + (13-13.5)^2 + (15-13.5)^2 + (10-9)^2 + (8-8.5)^2 + (12-11.5)^2$\n$d(D_2, R_A^C)^2 = (-0.5)^2 + (-0.5)^2 + 1.5^2 + 1^2 + (-0.5)^2 + 0.5^2 = 0.25 + 0.25 + 2.25 + 1 + 0.25 + 0.25 = 4.25$\n距离相等。平局决胜规则选择较早的一天，即 $D_1$。因此，$R_A^M = D_1$。\n\n对于聚类 $B$，我们比较 $D_3$ 和 $D_4$ 到 $R_B^C$ 的距离：\n$d(D_3, R_B^C)^2 = (7-6.5)^2 + (9-8.5)^2 + (12-11.5)^2 + (18-17.5)^2 + (14-13.5)^2 + (10-9.5)^2$\n$d(D_3, R_B^C)^2 = 0.5^2 + 0.5^2 + 0.5^2 + 0.5^2 + 0.5^2 + 0.5^2 = 6 \\times 0.25 = 1.5$\n$d(D_4, R_B^C)^2 = (6-6.5)^2 + (8-8.5)^2 + (11-11.5)^2 + (17-17.5)^2 + (13-13.5)^2 + (9-9.5)^2$\n$d(D_4, R_B^C)^2 = (-0.5)^2 + (-0.5)^2 + (-0.5)^2 + (-0.5)^2 + (-0.5)^2 + (-0.5)^2 = 6 \\times 0.25 = 1.5$\n距离相等。平局决胜规则选择较早的一天，即 $D_3$。因此，$R_B^M = D_3$。\n\n**3. 性能指标计算**\n构建完整的时间序列：\n原始：$S_{orig} = \\{D_1, D_2, D_3, D_4\\}$\n基于质心：$S_C = \\{R_A^C, R_A^C, R_B^C, R_B^C\\}$\n基于中心点：$S_M = \\{R_A^M, R_A^M, R_B^M, R_B^M\\} = \\{D_1, D_1, D_3, D_3\\}$\n\n设完整的 $24$ 个小时值序列表示为 $\\{s_i\\}_{i=1}^{24}$。\n- 峰值指标：$P = \\max_{i} s_i$\n- 爬坡指标：$R = \\max_{i=1}^{23} |s_{i+1} - s_i|$\n- 能量指标：$E = \\sum_{i=1}^{24} s_i \\cdot \\Delta t$。当 $\\Delta t = 1 \\text{ 小时}$ 时，$E$ 是每小时千瓦值的总和，结果单位为千瓦时（kWh）。\n\n**原始序列 ($S_{orig}$) 的指标**\n$P_{orig} = \\max(\\text{values in } D_1, D_2, D_3, D_4) = \\max(14, 15, 18, 17) = 18$\n$E_{orig} = \\sum D_1 + \\sum D_2 + \\sum D_3 + \\sum D_4 = 64 + 67 + 70 + 64 = 265$\n$R_{orig}$：任意一天内或天与天之间的最大小时爬坡。最大差值出现在 $D_3$（$|18-12| = 6$）和 $D_4$（$|17-11| = 6$）中。因此，$R_{orig} = 6$。\n\n**基于质心序列 ($S_C$) 的指标**\n$P_C = \\max(\\text{values in } R_A^C, R_B^C) = \\max(13.5, 17.5) = 17.5$\n$E_C = 2 \\times \\sum R_A^C + 2 \\times \\sum R_B^C = 2 \\times 65.5 + 2 \\times 67 = 131 + 134 = 265$\n$R_C$：最大爬坡出现在 $R_B^C$ 中，在其第3和第4小时之间：$|17.5 - 11.5| = 6$。因此，$R_C = 6$。\n\n**基于中心点序列 ($S_M$) 的指标**\n$P_M = \\max(\\text{values in } D_1, D_3) = \\max(14, 18) = 18$\n$E_M = 2 \\times \\sum D_1 + 2 \\times \\sum D_3 = 2 \\times 64 + 2 \\times 70 = 128 + 140 = 268$\n$R_M$：最大爬坡出现在 $D_3$ 中，在其第3和第4小时之间：$|18 - 12| = 6$。因此，$R_M = 6$。\n\n**4. 最终复合标量计算**\n相对差异向量为 $v = \\left( \\frac{P_C - P_M}{P_{orig}}, \\frac{R_C - R_M}{R_{orig}}, \\frac{E_C - E_M}{E_{orig}} \\right)$。\n$P_{orig}=18, P_C=17.5, P_M=18 \\implies v_P = \\frac{17.5 - 18}{18} = \\frac{-0.5}{18} = -\\frac{1}{36}$\n$R_{orig}=6, R_C=6, R_M=6 \\implies v_R = \\frac{6 - 6}{6} = 0$\n$E_{orig}=265, E_C=265, E_M=268 \\implies v_E = \\frac{265 - 268}{265} = -\\frac{3}{265}$\n\n复合标量 $C$ 是 $v$ 的欧几里得范数：\n$C = \\|v\\| = \\sqrt{v_P^2 + v_R^2 + v_E^2}$\n$C = \\sqrt{\\left(-\\frac{1}{36}\\right)^2 + 0^2 + \\left(-\\frac{3}{265}\\right)^2}$\n$C = \\sqrt{\\frac{1}{1296} + \\frac{9}{70225}}$\n\n计算数值：\n$\\frac{1}{1296} \\approx 0.0007716049$\n$\\frac{9}{70225} \\approx 0.0001281601$\n$C = \\sqrt{0.0007716049 + 0.0001281601} = \\sqrt{0.000899765}$\n$C \\approx 0.02999608...$\n\n四舍五入到四位有效数字，我们得到 $0.03000$。",
            "answer": "$$\n\\boxed{0.03000}\n$$"
        },
        {
            "introduction": "时间序列聚合方法对模型输出的经济和可靠性结果有深远影响，尤其是在处理极端事件（如热浪或设备故障）时。本练习探讨了如何处理“离群日”：是将其平均化处理，还是作为固定的代表日明确包含在内。通过解决一个容量扩张问题，你将量化这两种处理方式对最优投资决策和系统可靠性指标（如缺电期望和未服务能源）的差异，从而深刻理解聚合策略对高风险规划决策的重要性。",
            "id": "4117398",
            "problem": "考虑一个用于能源系统建模的、在时间序列聚合下的单节点容量扩展与可靠性评估问题。一位规划者选择一个非负的可靠容量 $K$ (单位：兆瓦) 以满足外生的小时需求曲线。未满足的需求会根据缺电价值 (VOLL) 产生罚款，而安装的容量会产生固定的年化投资成本。全年需求通过具有相应整数日权重的代表日来近似。比较两种聚合场景，以展示将异常日明确作为固定代表日所产生的影响。\n\n基本基础：\n- 将任一小时的短缺量定义为 $\\max(L - K, 0)$，其中 $L$ 是实际需求（单位：兆瓦），$K$ 是已安装的可靠容量（单位：兆瓦）。\n- 设 $C_{\\text{inv}}$ 为每兆瓦每年的投资成本（单位：货币），$v$ 为每兆瓦时的缺电价值 (VOLL)（单位：货币）。\n- 给定由 $d$ 索引的代表日曲线，其整数权重为 $w_d$（天），小时由 $h$ 从 $1$ 索引到 $24$，对于给定的 $K$，年度目标函数为\n$$J(K) = C_{\\text{inv}} \\cdot K + v \\cdot \\sum_{d} w_d \\sum_{h=1}^{24} \\max\\left(L_{d,h} - K, 0\\right).$$\n- 可靠性指标在加权时间范围内定义如下：\n  - 缺负荷期望 (LOLE)，单位为小时/年，等于 $\\sum_d w_d \\sum_{h=1}^{24} \\mathbf{1}\\{L_{d,h} > K\\}$。\n  - 缺电量期望 (EUE)，单位为兆瓦时/年，等于 $\\sum_d w_d \\sum_{h=1}^{24} \\max(L_{d,h} - K, 0)$。\n\n时间序列和聚合定义：\n- 构建一个每日24小时的合成日需求曲线集。其中有10个“正常”日，由 $d \\in \\{1,\\dots,10\\}$ 索引，以及1个“异常”日。对于小时 $h \\in \\{1,\\dots,24\\}$，将正常日的需求定义为\n$$L^{\\text{norm}}_{d,h} = 50 + 10 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{h - 8}{24}\\right) + 2 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{d}{10}\\right).$$\n- 通过采用与 $d=1$ 相同的基本日变化形状，并在傍晚/夜间时段增加一个30兆瓦的局部峰值，来定义异常日曲线 $L^{\\text{out}}_{h}$：\n$$L^{\\text{out}}_{h} = \\left(50 + 10 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{h - 8}{24}\\right) + 2 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{1}{10}\\right)\\right) + \\Delta_h,$$\n其中，当 $h \\in \\{17, 18, 19, 20\\}$ 时 $\\Delta_h = 30$，否则 $\\Delta_h = 0$。\n- 聚合场景A（排除异常日）：使用单个代表日，该代表日等于10个正常日的算术平均值，权重为10。形式上，$L^{A}_{h} = \\frac{1}{10} \\sum_{d=1}^{10} L^{\\text{norm}}_{d,h}$，权重 $w^{A} = 10$。\n- 聚合场景B（将异常日作为固定代表日纳入）：使用两个代表日，即权重为10的平均正常日 $L^{A}_{h}$ 和权重为1的异常日 $L^{\\text{out}}_{h}$。\n\n两种场景下的决策问题：\n- 对于给定的 $C_{\\text{inv}}$（货币单位/兆瓦/年）和 $v$（货币单位/兆瓦时），选择 $K \\ge 0$ 以最小化使用该场景的代表日集和权重所定义的 $J(K)$。在最优解 $K^\\star$ 处，计算 LOLE（单位：小时/年）和 EUE（单位：兆瓦时/年）。\n\n算法要求：\n- 通过在由 $K=0$ 和场景代表日曲线中出现的所有唯一小时需求值组成的有限候选集上评估目标函数 $J(K)$ 来求解 $K^\\star$。选择最小化 $J(K)$ 的 $K$。如果存在多个最小值点，则选择其中最小的 $K$。\n\n单位与报告：\n- 报告容量 $K^\\star$（单位：兆瓦）、LOLE（单位：小时/年）和 EUE（单位：兆瓦时/年）。所有报告的数值必须四舍五入到三位小数。\n\n测试组：\n- 使用以下三个测试用例，每个由 $(C_{\\text{inv}}, v)$ 指定：\n  - 测试 1：$(50{,}000, 10{,}000)$。\n  - 测试 2：$(3{,}000{,}000, 10{,}000)$。\n  - 测试 3：$(1{,}000, 10{,}000)$。\n这些测试涵盖了一个典型的权衡情况、一个零容量可能是最优的高投资成本极端情况，以及一个接近“覆盖峰值”的情况。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由18个数字组成的扁平列表，按以下顺序排列，所有数字均四舍五入至三位小数：对于每个按升序排列的测试 $t \\in \\{1,2,3\\}$，列出 $[K^{A,\\star}_t,\\ \\text{LOLE}^{A}_t,\\ \\text{EUE}^{A}_t,\\ K^{B,\\star}_t,\\ \\text{LOLE}^{B}_t,\\ \\text{EUE}^{B}_t]$，然后将这些每个测试的列表连接成一个长度为18的扁平列表。输出必须严格按照单个带方括号、逗号分隔的 Python 风格列表（例如 $[x_1,x_2,\\dots,x_{18}]$）打印。",
            "solution": "我们根据目标函数的定义和分段线性的缺负荷罚金，从第一性原理推导出解决方案。\n\n1. 构建时间序列。\n   - 对每个正常日 $d \\in \\{1,\\dots,10\\}$ 和小时 $h \\in \\{1,\\dots,24\\}$，定义负荷\n   $$L^{\\text{norm}}_{d,h} = 50 + 10 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{h - 8}{24}\\right) + 2 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{d}{10}\\right).$$\n   这产生了一个在午后晚些时候达到峰值的日变化模式，由于项 $2 \\cdot \\sin\\!\\left(2\\pi \\cdot d/10\\right)$ 的存在，日间变化较为平缓。\n   - 通过为 $d=1$ 的基本曲线增加一个日末峰值来定义异常日：\n   $$L^{\\text{out}}_{h} = \\left(50 + 10 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{h - 8}{24}\\right) + 2 \\cdot \\sin\\!\\left(2\\pi \\cdot \\frac{1}{10}\\right)\\right) + \\Delta_h,$$\n   其中，当 $h \\in \\{17,18,19,20\\}$ 时 $\\Delta_h = 30$，否则 $\\Delta_h = 0$。这构建了一个在短时间窗口内合理的极端峰值。\n\n2. 构建代表性场景。\n   - 场景A：代表日是10个正常日在每个小时 $h$ 的算术平均值，\n   $$L^{A}_{h} = \\frac{1}{10} \\sum_{d=1}^{10} L^{\\text{norm}}_{d,h},$$\n   权重 $w^{A} = 10$ 天。总加权小时数为 $24 \\cdot 10$。\n   - 场景B：使用两个代表日，即权重为10的平均正常日 $L^{A}_{h}$ 和权重为1的异常日 $L^{\\text{out}}_{h}$。总加权小时数为 $24 \\cdot 11$。\n\n3. 为给定的非负容量 $K$ 定义目标函数和指标。\n   - 年化成本为\n   $$J(K) = C_{\\text{inv}} \\cdot K + v \\cdot \\sum_{d} w_d \\sum_{h=1}^{24} \\max(L_{d,h} - K, 0).$$\n   - 可靠性指标为\n   $$\\text{LOLE}(K) = \\sum_{d} w_d \\sum_{h=1}^{24} \\mathbf{1}\\{L_{d,h} > K\\}, \\quad \\text{EUE}(K) = \\sum_{d} w_d \\sum_{h=1}^{24} \\max(L_{d,h} - K, 0).$$\n\n4. 凸性与最优解的刻画。\n   - 对每个小时，$f_h(K) = \\max(L_h - K, 0)$ 是关于 $K$ 的凸且分段线性的函数，当 $K  L_h$ 时次梯度为 $-1$，当 $K = L_h$ 时为 $[-1,0]$ 内的任意值，当 $K > L_h$ 时为 $0$。\n   - 因为 $J(K)$ 是一个线性项 $C_{\\text{inv}} \\cdot K$ 与凸函数 $f_h(K)$ 的非负加权和之和，所以 $J(K)$ 是凸且分段线性的。因此，最优解 $K^\\star$ 存在于 $J(K)$ 的某个断点处，这些断点发生在 $K$ 等于 $0$ 或聚合代表集中的小时负荷值处。\n   - $J$ 在 $K$ 处的次梯度为\n   $$\\partial J(K) \\ni C_{\\text{inv}} - v \\cdot \\sum_{d} w_d \\sum_{h=1}^{24} g_{d,h}(K),$$\n   其中，如果 $K  L_{d,h}$ 则 $g_{d,h}(K) = 1$，如果 $K = L_{d,h}$ 则 $g_{d,h}(K) \\in [0,1]$，如果 $K > L_{d,h}$ 则 $g_{d,h}(K) = 0$。在任何可微点（即非断点处），$g_{d,h}(K) = \\mathbf{1}\\{L_{d,h} > K\\}$，所以导数为\n   $$J'(K) = C_{\\text{inv}} - v \\cdot \\sum_{d} w_d \\sum_{h=1}^{24} \\mathbf{1}\\{L_{d,h}  K\\}.$$\n   内部最小化点的一阶最优性条件是 $J'(K^\\star) = 0$，其解释为边际投资成本与期望短缺成本的边际减少量相平衡，后者与超过 $K^\\star$ 的加权小时数成正比。\n   - 在离散、分段线性的设定中，可以通过在有限集 $\\{0\\} \\cup \\{L_{d,h}\\ \\text{for all representative hours}\\}$ 上评估 $J(K)$ 并选择最小化 $J(K)$ 的最小 $K$ 来找到精确的最小化点。这满足了凸最优性条件，并避免了在平坦区域的模糊性。\n\n5. 针对任一给定的 $(C_{\\text{inv}}, v)$ 和任一聚合场景计算所需输出的算法。\n   - 步骤1：为场景构建代表性数组 $\\{L_{d,h}\\}$ 和权重 $\\{w_d\\}$。\n   - 步骤2：构建非负断点的候选集 $\\mathcal{K} = \\{0\\} \\cup \\{L_{d,h}\\}$。\n   - 步骤3：对于每个 $K \\in \\mathcal{K}$，计算如上定义的 $J(K)$、$\\text{LOLE}(K)$ 和 $\\text{EUE}(K)$。选择最小化 $J(K)$ 的 $K^\\star$；如果存在多个最小化点，则选择最小的 $K$。\n   - 步骤4：报告 $K^\\star$（兆瓦）、$\\text{LOLE}(K^\\star)$（小时/年）和 $\\text{EUE}(K^\\star)$（兆瓦时/年），每个值都四舍五入到三位小数。\n\n6. 解释测试组以及包含异常日的影响。\n   - 测试1中 $(C_{\\text{inv}}, v) = (50{,}000, 10{,}000)$ 产生了一个与几个小时相当的“允许”超限小时数，因此场景B中异常日的4小时尖峰的存在，使得最优 $K^\\star$ 相对于场景A向上移动，从而在场景B中以更高的容量为代价降低了 $\\text{LOLE}$ 和 $\\text{EUE}$。\n   - 测试2中 $(C_{\\text{inv}}, v) = (3{,}000{,}000, 10{,}000)$ 意味着边际投资成本在整个加权时间范围内都主导着短缺成本（因为 $C_{\\text{inv}}/v$ 超过了总加权小时数），所以在两种场景下 $K^\\star = 0$ 都是最优的；由于总加权小时数和峰值大小不同，场景间的可靠性指标会有所不同，这说明即使投资为零，可靠性核算仍然有意义。\n   - 测试3中 $(C_{\\text{inv}}, v) = (1{,}000, 10{,}000)$ 使得短缺相对于容量变得非常昂贵，从而驱使 $K^\\star$ 基本上覆盖了场景中的最大小时负荷。将异常日作为固定代表日加入，增加了场景的最大负荷，因此在场景B中增加了 $K^\\star$，与场景A相比进一步降低了 $\\text{LOLE}$ 和 $\\text{EUE}$。\n\n程序精确地实现了这些步骤，计算了在指定测试用例下两种聚合场景的最优容量和可靠性指标，并按要求的顺序和单位打印出一个包含18个四舍五入数值的扁平列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef build_normal_days():\n    \"\"\"\n    Build 10 normal days, each with 24 hours.\n    L_norm[d, h]: d=0..9 corresponds to days 1..10, h=0..23 corresponds to hours 1..24.\n    \"\"\"\n    hours = np.arange(1, 25)  # 1..24\n    # Base diurnal shape\n    diurnal = 50.0 + 10.0 * np.sin(2.0 * np.pi * (hours - 8.0) / 24.0)\n    normals = []\n    for d in range(1, 11):  # days 1..10\n        day_variation = 2.0 * np.sin(2.0 * np.pi * d / 10.0)\n        L_d = diurnal + day_variation\n        normals.append(L_d)\n    return np.array(normals)  # shape (10, 24)\n\ndef build_outlier_day():\n    \"\"\"\n    Build the outlier day using the base diurnal shape for d=1 and add +30 MW at hours {17, 18, 19, 20}.\n    \"\"\"\n    hours = np.arange(1, 25)  # 1..24\n    diurnal = 50.0 + 10.0 * np.sin(2.0 * np.pi * (hours - 8.0) / 24.0)\n    base = diurnal + 2.0 * np.sin(2.0 * np.pi * 1.0 / 10.0)  # d=1 baseline\n    delta = np.zeros_like(base)\n    # Add 30 MW to hours 17,18,19,20\n    for h in [17, 18, 19, 20]:\n        delta[h - 1] = 30.0\n    return base + delta  # shape (24,)\n\ndef representative_scenario_A(normals):\n    \"\"\"\n    Scenario A: single representative day = mean of normals, weight = 10.\n    Returns list of (profile, weight).\n    \"\"\"\n    mean_day = normals.mean(axis=0)\n    return [(mean_day, 10)]\n\ndef representative_scenario_B(normals, outlier):\n    \"\"\"\n    Scenario B: two representatives: mean normal day (weight 10), outlier day (weight 1).\n    Returns list of (profile, weight).\n    \"\"\"\n    mean_day = normals.mean(axis=0)\n    return [(mean_day, 10), (outlier, 1)]\n\ndef evaluate_objective_and_metrics(K, reps, C_inv, v):\n    \"\"\"\n    Compute J(K), LOLE(K), EUE(K) for given K and representative days.\n    reps: list of (profile array length 24, weight integer)\n    \"\"\"\n    total_eue = 0.0\n    total_lole = 0.0\n    for prof, w in reps:\n        shortage = np.maximum(prof - K, 0.0)\n        total_eue += w * shortage.sum()\n        total_lole += w * np.count_nonzero(prof > K)\n    J = C_inv * K + v * total_eue\n    return J, total_lole, total_eue\n\ndef solve_one_scenario(reps, C_inv, v):\n    \"\"\"\n    Enumerate candidate K values: {0} union all unique hourly loads in reps.\n    Return optimal (K*, LOLE*, EUE*) with the smallest K* among minimizers.\n    \"\"\"\n    # Collect candidate K values\n    candidates = [0.0]\n    for prof, _ in reps:\n        candidates.extend(prof.tolist())\n    # Unique and sorted\n    K_candidates = np.unique(np.array(candidates))\n    best_J = None\n    best_K = None\n    best_lole = None\n    best_eue = None\n    for K in K_candidates:\n        J, lole, eue = evaluate_objective_and_metrics(K, reps, C_inv, v)\n        if (best_J is None) or (J  best_J - 1e-12) or (abs(J - best_J) = 1e-12 and K  best_K):\n            best_J = J\n            best_K = K\n            best_lole = lole\n            best_eue = eue\n    return best_K, best_lole, best_eue\n\ndef round3(x):\n    return float(f\"{x:.3f}\")\n\ndef solve():\n    # Build data\n    normals = build_normal_days()\n    outlier = build_outlier_day()\n    reps_A = representative_scenario_A(normals)\n    reps_B = representative_scenario_B(normals, outlier)\n\n    # Define the test cases (C_inv, v)\n    test_cases = [\n        (50000.0, 10000.0),   # Test 1\n        (3000000.0, 10000.0), # Test 2\n        (1000.0, 10000.0),    # Test 3\n    ]\n\n    results = []\n    for C_inv, v in test_cases:\n        # Scenario A\n        K_A, LOLE_A, EUE_A = solve_one_scenario(reps_A, C_inv, v)\n        # Scenario B\n        K_B, LOLE_B, EUE_B = solve_one_scenario(reps_B, C_inv, v)\n        # Append rounded results in required order\n        results.extend([\n            round3(K_A), round3(LOLE_A), round3(EUE_A),\n            round3(K_B), round3(LOLE_B), round3(EUE_B),\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}