{
    "hands_on_practices": [
        {
            "introduction": "本练习将通过一个具体的一维对流扩散问题，让你亲手实践并量化不同出口边界条件处理方式对解的影响。在对流主导的流动中，出口边界的数值处理对解的稳定性和准确性至关重要。通过对比“无为”出口与能量稳定出口公式，你将深入理解基于物理原则的边界处理如何在流线迎风Petrov-Galerkin (SUPG) 有限元方法中提升高佩克莱数 ($Pe_h$) 流动模拟的质量 。",
            "id": "3996494",
            "problem": "考虑非量纲形式的稳态一维被动标量对流扩散方程，\n$$-k\\,u_{xx} + a\\,u_{x} = 0,$$\n定义在区间 $x \\in [0,2h]$ 上，其中对流速度 $a0$ 为正常数，扩散率 $k0$ 为正常数，入流狄利克雷条件为 $u(0)=1$。网格由两个均匀有限元组成，节点为 $x_{0}=0$、$x_{1}=h$ 和 $x_{2}=2h$。使用标准的线性有限元法 (FEM) 和流线迎风 Petrov–Galerkin (SUPG) 稳定化方法，其中稳定化测试函数为 $v + \\tau\\,a\\,v_{x}$，并且在高单元佩克莱数情况下，稳定化参数取为 $\\tau = h/(2a)$。单元佩克莱数定义为 $Pe_{h} = a h / (2 k)$。\n\n请构建弱形式，组装关于未知节点值 $u_{1} = u(h)$ 和 $u_{2} = u(2h)$ 的二乘二线性系统，并比较在 $x=2h$ 处以下两种出流边界条件处理方式：\n- 无为出流：对扩散项使用自然边界条件（在 $x=2h$ 处无额外边界贡献）。\n- 能量稳定出流：用一致的迎风出流边界项 $\\int_{x=2h} a\\,u\\,v\\,\\mathrm{d}s$（在一维情况下，此项贡献为 $a\\,u(2h)\\,v(2h)$）来增强弱形式。\n\n将相对出流误差定义为\n$$E_{\\mathrm{out}}(Pe_{h}) = 1 - \\frac{u_{2}^{\\mathrm{ES}}}{u_{2}^{\\mathrm{DN}}},$$\n其中 $u_{2}^{\\mathrm{ES}}$ 和 $u_{2}^{\\mathrm{DN}}$ 分别是在能量稳定和无为出流处理下计算得到的出流节点值。计算其渐近极限\n$$\\lim_{Pe_{h} \\to \\infty} E_{\\mathrm{out}}(Pe_{h}).$$\n请将最终答案表示为一个无量纲数。无需四舍五入；给出精确值。",
            "solution": "用户要求我分析一维稳态对流扩散方程的一个特定有限元方法 (FEM) 设置。我将首先验证问题，如果有效，则进行详细推导。\n\n### 步骤 1：提取已知条件\n- **控制方程**：$-k\\,u_{xx} + a\\,u_{x} = 0$，对于 $x \\in [0, 2h]$。\n- **参数**：对流速度 $a  0$，扩散率 $k  0$。\n- **边界条件**：入流狄利克雷条件 $u(0)=1$。\n- **网格**：两个均匀线性有限元，节点位于 $x_{0}=0$，$x_{1}=h$ 和 $x_{2}=2h$。未知数为节点值 $u_{1}=u(h)$ 和 $u_{2}=u(2h)$。\n- **FEM 公式**：标准的线性 FEM，采用流线迎风 Petrov–Galerkin (SUPG) 稳定化。\n- **稳定化测试函数**：$w = v + \\tau\\,a\\,v_{x}$。\n- **稳定化参数**：$\\tau = h/(2a)$（针对高单元佩克莱数情况）。\n- **单元佩克莱数**：$Pe_{h} = a h / (2 k)$。\n- **在 $x=2h$ 处要比较的出流条件**：\n    1.  **无为 (DN)**：使用扩散项分部积分产生的自然边界条件。\n    2.  **能量稳定 (ES)**：用项 $a\\,u(2h)\\,v(2h)$ 增强弱形式。\n- **待计算量**：相对出流误差 $E_{\\mathrm{out}}(Pe_{h}) = 1 - \\frac{u_{2}^{\\mathrm{ES}}}{u_{2}^{\\mathrm{DN}}}$ 在 $Pe_{h} \\to \\infty$ 时的渐近极限。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **有科学依据**：该问题描述了一种标准数值方法 (SUPG-FEM)，用于求解流体动力学中的一个基本模型方程（对流扩散方程）。所有概念在计算科学与工程领域都是公认的。该问题在科学上是合理的。\n2.  **适定的**：问题陈述清晰，包含了组装和求解所得线性代数系统所需的所有信息。目标是计算一个明确定义的特定极限。该问题是适定的。\n3.  **客观的**：语言精确，没有主观论断。数值方法和误差度量的定义是明确的。该问题是客观的。\n4.  **完整性和一致性**：问题提供了偏微分方程、定义域、边界条件、网格、基函数（由“线性 FEM”隐含）以及稳定化和出流条件的具体公式。没有矛盾之处。\n\n### 步骤 3：结论与行动\n该问题有效。我现在将进行求解。\n\n### 推导\n该问题要求构建并求解由稳态一维对流扩散方程的特定 SUPG-FEM 离散化产生的离散方程组。\n\n**1. 弱形式**\n\n我们从偏微分方程的残差开始：$R(u) = a\\,u_{x} - k\\,u_{xx}$。SUPG 弱形式为 $\\int_{0}^{2h} R(u) w \\, dx = 0$，其中测试函数为 $w = v + \\tau a v_x$。\n$$ \\int_{0}^{2h} (a u_x - k u_{xx}) (v + \\tau a v_x) \\, dx = 0 $$\n展开此式，得到标准的 Galerkin 项和稳定化项：\n$$ \\int_{0}^{2h} (a u_x - k u_{xx}) v \\, dx + \\int_{0}^{2h} (a u_x - k u_{xx}) (\\tau a v_x) \\, dx = 0 $$\n我们对二阶导数项进行分部积分：$\\int (-k u_{xx}) v \\, dx = \\int k u_x v_x \\, dx - [k u_x v]$。\n弱形式变为：\n$$ \\int_{0}^{2h} (k u_x v_x + a u_x v) \\, dx - [k u_x v]_{0}^{2h} + \\int_{0}^{2h} \\tau a v_x (a u_x - k u_{xx}) \\, dx = 0 $$\n对于分段线性近似 $u_h$，其二阶导数 $u_{hxx}$ 在每个单元内为零。因此，离散解 $u_h$ 和测试函数 $v_h$ 的弱形式为：\n$$ \\sum_{e} \\int_{\\Omega_e} (k u_{hx} v_{hx} + a u_{hx} v_h + \\tau a^2 u_{hx} v_{hx}) \\, dx - [k u_{hx} v_h]_{0}^{2h} = \\text{边界条件项} $$\n我们定义一个稳定化扩散率 $k_{stab} = k + \\tau a^2$。双线性形式为：\n$$ B(u_h, v_h) = \\int_{0}^{2h} (k_{stab} u_{hx} v_{hx} + a u_{hx} v_h) \\, dx $$\n代入 $\\tau = h/(2a)$，我们得到 $k_{stab} = k + \\frac{h}{2a}a^2 = k + \\frac{ah}{2}$。\n\n**2. 单元矩阵公式**\n\n我们来求解长度为 $h$、节点为 A 和 B 的通用单元上的单元刚度矩阵。局部近似为 $u_h(x) = u_A N_A(x) + u_B N_B(x)$。线性基函数的导数为 $N_{Ax} = -1/h$ 和 $N_{Bx} = 1/h$。\n单元矩阵项为 $K^e_{ij} = \\int_{x_A}^{x_B} (k_{stab} N_{ix} N_{jx} + a N_{jx} N_i) \\, dx$。\n经过标准计算，单元矩阵为：\n$$ \\mathbf{K}^e = \\begin{pmatrix} \\frac{k_{stab}}{h} - \\frac{a}{2}  -\\frac{k_{stab}}{h} + \\frac{a}{2} \\\\ -\\frac{k_{stab}}{h} - \\frac{a}{2}  \\frac{k_{stab}}{h} + \\frac{a}{2} \\end{pmatrix} $$\n代入 $k_{stab} = k + ah/2$，我们发现 $k_{stab}/h = k/h + a/2$。单元矩阵简化为：\n$$ \\mathbf{K}^e = \\begin{pmatrix} \\frac{k}{h}  -\\frac{k}{h} \\\\ -\\frac{k}{h} - a  \\frac{k}{h} + a \\end{pmatrix} $$\n该矩阵对两个单元 $\\Omega_1 = [0, h]$ 和 $\\Omega_2 = [h, 2h]$ 都是相同的。\n\n**3. 组装全局系统**\n\n未知数是 $u_1$ 和 $u_2$，因为 $u_0=1$ 是给定的狄利克雷条件。我们为测试函数 $v_h = N_1$ 和 $v_h = N_2$ 组装方程。\n\n- **方程 1 (对于 $v_h = N_1$)：**\n该方程接收来自单元 1（节点 1 是局部第二个节点）和单元 2（节点 1 是局部第一个节点）的贡献。\n来自 $\\Omega_1$ 的贡献：$[K^e_{21} \\quad K^e_{22}] \\begin{pmatrix} u_0 \\\\ u_1 \\end{pmatrix} = (-\\frac{k}{h}-a)u_0 + (\\frac{k}{h}+a)u_1$。\n来自 $\\Omega_2$ 的贡献：$[K^e_{11} \\quad K^e_{12}] \\begin{pmatrix} u_1 \\\\ u_2 \\end{pmatrix} = (\\frac{k}{h})u_1 + (-\\frac{k}{h})u_2$。\n将贡献相加，并将已知项移至右侧 (RHS)，其中 $u_0=1$：\n$(\\frac{k}{h}+a)u_1 + (\\frac{k}{h})u_1 + (-\\frac{k}{h})u_2 = (\\frac{k}{h}+a)u_0 = \\frac{k}{h}+a$。\n$$ \\left(\\frac{2k}{h} + a\\right)u_1 - \\frac{k}{h}u_2 = \\frac{k}{h} + a $$\n\n- **方程 2 (对于 $v_h = N_2$)：**\n该方程仅接收来自单元 2 的贡献。\n来自 $\\Omega_2$ 的贡献：$[K^e_{21} \\quad K^e_{22}] \\begin{pmatrix} u_1 \\\\ u_2 \\end{pmatrix} = (-\\frac{k}{h}-a)u_1 + (\\frac{k}{h}+a)u_2$。\n组装后的方程为：\n$$ \\left(-\\frac{k}{h} - a\\right)u_1 + \\left(\\frac{k}{h} + a\\right)u_2 = 0 $$\n\n这些方程必须通过分部积分产生的边界项和任何指定的出流处理进行修正。扩散通量的分部积分项为 $-[k u_{hx} v_h]_{0}^{2h}$。由于对于 $v_h \\in \\{N_1, N_2\\}$ 有 $v_h(0)=0$，并且 $v_1(2h)=0$，该项仅影响方程 2，其中 $v_2(2h)=1$。贡献为 $-k u_{hx}(2h)$。在 $\\Omega_2$ 上近似导数，我们有 $u_{hx}(2h) \\approx (u_2 - u_1)/h$。因此，我们必须从方程 2 的左侧减去 $\\frac{k}{h}(u_2 - u_1)$。\n\n**4. 无为 (DN) 出流条件**\n\n对于 DN 情况，我们包含分部积分的自然边界项。\n方程 1 不变：\n(1) $\\left(\\frac{2k}{h} + a\\right)u_1 - \\frac{k}{h}u_2 = \\frac{k}{h} + a$\n方程 2 变为：\n$\\left(-\\frac{k}{h} - a\\right)u_1 + \\left(\\frac{k}{h} + a\\right)u_2 - \\frac{k}{h}(u_2 - u_1) = 0$\n$\\left(-\\frac{k}{h} - a + \\frac{k}{h}\\right)u_1 + \\left(\\frac{k}{h} + a - \\frac{k}{h}\\right)u_2 = 0$\n(2) $-a u_1 + a u_2 = 0 \\implies u_1 = u_2$。\n\n将 $u_2=u_1$ 代入方程 (1)：\n$\\left(\\frac{2k}{h} + a\\right)u_1 - \\frac{k}{h}u_1 = \\frac{k}{h} + a$\n$\\left(\\frac{k}{h} + a\\right)u_1 = \\frac{k}{h} + a \\implies u_1 = 1$。\n因此，$u_{2}^{\\mathrm{DN}} = u_1 = 1$。\n\n**5. 能量稳定 (ES) 出流条件**\n\n对于 ES 情况，我们用项 $a u(2h) v(2h)$ 增强弱形式。离散地，这会在左侧加上 $a u_2 v_h(2h)$。对于 $v_h=N_1$，该项为零；对于 $v_h=N_2$，该项为 $a u_2$。\n因此，方程 1 与 DN 情况相同。对于方程 2，我们在 DN 方程 (2) 的左侧加上 $a u_2$。\n(1) $\\left(\\frac{2k}{h} + a\\right)u_1 - \\frac{k}{h}u_2 = \\frac{k}{h} + a$\n(2) $-a u_1 + a u_2 + a u_2 = 0 \\implies -a u_1 + 2a u_2 = 0 \\implies u_1 = 2u_2$。\n\n将 $u_1 = 2u_2$ 代入方程 (1)：\n$\\left(\\frac{2k}{h} + a\\right)(2u_2) - \\frac{k}{h}u_2 = \\frac{k}{h} + a$\n$u_2 \\left( 2\\left(\\frac{2k}{h} + a\\right) - \\frac{k}{h} \\right) = \\frac{k}{h} + a$\n$u_2 \\left( \\frac{4k}{h} + 2a - \\frac{k}{h} \\right) = \\frac{k}{h} + a$\n$u_2 \\left( \\frac{3k}{h} + 2a \\right) = \\frac{k}{h} + a$\n$u_{2}^{\\mathrm{ES}} = \\frac{\\frac{k}{h} + a}{\\frac{3k}{h} + 2a}$。\n\n**6. 相对出流误差的渐近极限**\n\n相对出流误差定义为 $E_{\\mathrm{out}}(Pe_{h}) = 1 - \\frac{u_{2}^{\\mathrm{ES}}}{u_{2}^{\\mathrm{DN}}}$。\n代入推导出的值：\n$$ E_{\\mathrm{out}}(Pe_{h}) = 1 - \\frac{\\frac{\\frac{k}{h} + a}{\\frac{3k}{h} + 2a}}{1} = 1 - \\frac{\\frac{k}{h} + a}{\\frac{3k}{h} + 2a} $$\n$$ E_{\\mathrm{out}}(Pe_{h}) = \\frac{(\\frac{3k}{h} + 2a) - (\\frac{k}{h} + a)}{\\frac{3k}{h} + 2a} = \\frac{\\frac{2k}{h} + a}{\\frac{3k}{h} + 2a} $$\n我们需要计算当 $Pe_{h} = \\frac{ah}{2k} \\to \\infty$ 时的极限。这等价于让比率 $\\frac{k}{ah} \\to 0$。我们将 $E_{\\mathrm{out}}$ 的分子和分母同除以 $a$：\n$$ E_{\\mathrm{out}}(Pe_{h}) = \\frac{2\\frac{k}{ah} + 1}{3\\frac{k}{ah} + 2} $$\n单元佩克莱数是 $Pe_h = \\frac{ah}{2k}$，所以 $\\frac{k}{ah} = \\frac{1}{2 Pe_h}$。\n$$ E_{\\mathrm{out}}(Pe_{h}) = \\frac{2(\\frac{1}{2 Pe_h}) + 1}{3(\\frac{1}{2 Pe_h}) + 2} = \\frac{\\frac{1}{Pe_h} + 1}{\\frac{3}{2Pe_h} + 2} $$\n现在，我们取 $Pe_h \\to \\infty$ 时的极限：\n$$ \\lim_{Pe_{h} \\to \\infty} E_{\\mathrm{out}}(Pe_{h}) = \\lim_{Pe_{h} \\to \\infty} \\frac{\\frac{1}{Pe_h} + 1}{\\frac{3}{2Pe_h} + 2} = \\frac{0 + 1}{0 + 2} = \\frac{1}{2} $$\n相对出流误差的渐近极限是 $\\frac{1}{2}$。",
            "answer": "$$\n\\boxed{\\frac{1}{2}}\n$$"
        },
        {
            "introduction": "除了单元内部的SUPG方法，基于单元交界面的稳定化方法在CFD中也扮演着重要角色。本练习旨在让你从第一性原理出发，设计并实现一个界面稳定化权重函数 $\\omega_F$ 。通过构建并验证该函数所满足的对称性、方向选择性和网格尺寸缩放性等关键性质，你将掌握内部罚方法 (Interior Penalty methods) 等技术的核心思想，即如何通过合理惩罚解的跳跃来抑制非物理振荡。",
            "id": "3996448",
            "problem": "考虑在二维空间中的稳态线性平流方程，该方程定义在一个有界域 $\\Omega \\subset \\mathbb{R}^2$ 上，其边界 $\\partial \\Omega$ 上的外向单位法向量为 $\\boldsymbol{n}$，方程形式如下：\n$$\n\\boldsymbol{a} \\cdot \\nabla u = 0 \\quad \\text{in } \\Omega,\n$$\n其中 $\\boldsymbol{a} \\in \\mathbb{R}^2$ 是一个恒定的平流速度向量，$u$ 是一个足够光滑的标量场。在对 $\\Omega$ 进行特征网格尺寸为 $h$ 的形状规则的三角剖分，并采用协调有限元法（FEM）进行离散化时，通常会添加基于面的稳定化项来处理对流占优的情况。一种通用的内面稳定化项可用于增广伽辽金双线性形式，其写法如下：\n$$\nS(u_h, v_h) = \\sum_{F \\in \\mathcal{F}_{\\mathrm{int}}} \\omega_F(\\boldsymbol{n}_F, \\boldsymbol{a}, h) \\int_{F} [\\phi_u]_F \\, [\\phi_v]_F \\, \\mathrm{d}s,\n$$\n其中 $\\mathcal{F}_{\\mathrm{int}}$ 是内面的集合，$\\boldsymbol{n}_F$ 是与面 $F$ 相关联的单位法向量，$\\omega_F(\\boldsymbol{n}_F, \\boldsymbol{a}, h)$ 是一个待设计的非负权重，$[\\cdot]_F$ 表示跨越面 $F$ 的跳跃，其作用于适当选择的、依赖于离散解 $u_h$ 和测试函数 $v_h$ 的量 $\\phi_u$ 和 $\\phi_v$（例如，非连续格式的迹的跳跃，或连续内罚格式的法向导数的跳跃），而 $\\mathrm{d}s$ 是沿面的线测度。假设所有量都是无量纲的。\n\n你的任务是实现一个基于面的权重函数 $\\omega_F(\\boldsymbol{n}, \\boldsymbol{a}, h)$，该函数依赖于面法向量 $\\boldsymbol{n}$、平流向量 $\\boldsymbol{a}$ 和网格尺寸 $h$，并通过一组计算测试来验证该权重是否满足由守恒性、对称性和对流占优流动中的方向选择性所暗示的基本一致性条件。具体来说，程序必须：\n\n1. 实现一个候选映射 $(\\boldsymbol{n}, \\boldsymbol{a}, h) \\mapsto \\omega(\\boldsymbol{n}, \\boldsymbol{a}, h)$，并在你的求解推导中基于第一性原理进行论证，该映射强制满足：\n   - 关于面方向的对称性：$\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) = \\omega(-\\boldsymbol{n}, \\boldsymbol{a}, h)$。\n   - 方向选择性：当 $\\boldsymbol{a} \\cdot \\boldsymbol{n} = 0$ 时，$\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) = 0$。\n   - 非负性：对于所有 $\\boldsymbol{n}, \\boldsymbol{a}, h  0$，$\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) \\ge 0$。\n   - h 的线性缩放：对于固定的 $\\boldsymbol{n}, \\boldsymbol{a}$，当 $\\boldsymbol{a} \\cdot \\boldsymbol{n} \\ne 0$ 时，比率 $\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h_1)/\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h_2)$ 等于 $h_1/h_2$。\n\n2. 检查常数状态下的离散一致性代理：在长度为 $h$ 的单个内面 $F$ 上，如果 $u$ 和 $v$ 是全局常数，从而使得所选面量的跳跃为零，那么 $F$ 上的稳定化贡献恰好为零，即\n   $$\n   \\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) \\int_{F} [\\phi_u]_F \\, [\\phi_v]_F \\, \\mathrm{d}s = 0.\n   $$\n\n使用以下具有显式输入的测试套件，其中每个面的长度为 $h$，每个法向量为单位向量，每个平流向量为二维向量：\n\n- 测试 1 (正常路径浮点数)：$\\boldsymbol{a} = (2, 1)$, $\\boldsymbol{n} = (1, 0)$, $h = 0.1$。输出计算出的权重，保留六位小数的浮点数。\n- 测试 2 (方向选择性布尔值)：$\\boldsymbol{a} = (0, 3)$, $\\boldsymbol{n} = (1, 0)$, $h = 0.1$。输出一个布尔值，指示权重是否等于零。\n- 测试 3 (逆流下的非负性布尔值)：$\\boldsymbol{a} = (-5, 0)$, $\\boldsymbol{n} = (1, 0)$, $h = 0.2$。输出一个布尔值，指示权重是否严格为正。\n- 测试 4 (对称性布尔值)：$\\boldsymbol{a} = (1, -4)$, $\\boldsymbol{n} = (0, 1)$, $h = 0.05$。输出一个布尔值，指示 $\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h)$ 是否在 $10^{-12}$ 的容差内等于 $\\omega(-\\boldsymbol{n}, \\boldsymbol{a}, h)$。\n- 测试 5 (h 线性缩放布尔值)：$\\boldsymbol{a} = (3, 4)$, $\\boldsymbol{n} = \\frac{1}{\\sqrt{2}}(1, 1)$，以及 $h_1 = 0.5$ 和 $h_2 = 0.25$。输出一个布尔值，指示 $\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h_1)/\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h_2)$ 是否在 $10^{-12}$ 的容差内等于 $h_1/h_2$。\n- 测试 6 (常数状态面贡献布尔值)：考虑任意常数 $c_1, c_2 \\in \\mathbb{R}$ 和一个单面，其参数为 $\\boldsymbol{a} = (2, 2)$, $\\boldsymbol{n} = (0, 1)$, $h = 0.1$。使用跳跃项为 $[\\phi_u]_F = 0$ 和 $[\\phi_v]_F = 0$ 的稳定化被积函数，输出一个布尔值，指示计算出的面贡献是否恰好等于零。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，\"[result1,result2,result3,result4,result5,result6]\"）。第一个条目必须是测试 1 中保留六位小数的浮点值，其余条目必须是布尔值。不使用任何物理单位；所有量都是无量纲的。",
            "solution": "所提出的问题是有效的，因为它在科学上基于计算流体动力学的原理，特别是针对平流现象的有限元法（FEM）。该问题是适定的、客观的，并包含了构建和验证解所需的所有必要信息。\n\n任务是为稳态线性平流方程 $\\boldsymbol{a} \\cdot \\nabla u = 0$ 的 FEM 离散化中的一个基于面的稳定化项设计一个稳定化权重函数 $\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h)$。该函数必须满足一系列源于物理和数值一致性要求的基本性质。\n\n权重函数 $\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h)$ 所需的性质如下：\n1.  **关于面方向的对称性**：$\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) = \\omega(-\\boldsymbol{n}, \\boldsymbol{a}, h)$。这确保了稳定化与内面的法向量方向的任意选择无关。\n2.  **方向选择性**：如果 $\\boldsymbol{a} \\cdot \\boldsymbol{n} = 0$，则 $\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) = 0$。这个性质有其物理动机；当平流 $\\boldsymbol{a}$ 与面 $F$ 完全对齐（即平行）时，不應施加稳定化，因为没有输运穿過该面。\n3.  **非负性**：$\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) \\ge 0$。稳定化项通常旨在为数值格式增加耗散以控制振荡。负权重可能引入能量，导致不稳定。\n4.  **h 的线性缩放**：对于非零的法向流动分量，$\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h_1)/\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h_2) = h_1/h_2$。这种缩放是量纲分析或数值方法的形式一致性分析的常见结果，确保了稳定化项在网格细化时具有正确的渐近行为。\n\n我们可以通过系统地整合这些性质来构建一个合适的函数。特征网格尺寸 $h$ 的线性缩放（性质 4）意味着 $\\omega$ 必须具有以下形式：\n$$\n\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) = C \\cdot h \\cdot g(\\boldsymbol{n}, \\boldsymbol{a})\n$$\n其中 $g$ 是一个仅依赖于平流向量 $\\boldsymbol{a}$ 和面法向量 $\\boldsymbol{n}$ 的函数，而 $C$ 是一个无量纲常数。\n\n其余性质约束了函数 $g(\\boldsymbol{n}, \\boldsymbol{a})$。控制跨面输运的关键物理量是平流速度垂直于该面的分量，由标量积 $\\boldsymbol{a} \\cdot \\boldsymbol{n}$ 给出。让我们测试基于此量的函数形式。\n\n- 性质 2（方向选择性）要求当 $\\boldsymbol{a} \\cdot \\boldsymbol{n} = 0$ 时，$g(\\boldsymbol{n}, \\boldsymbol{a})$ 应为零。这表明 $g$ 与 $\\boldsymbol{a} \\cdot \\boldsymbol{n}$ 的某个次幂成正比。\n- 性质 1（对称性）要求 $g(\\boldsymbol{n}, \\boldsymbol{a}) = g(-\\boldsymbol{n}, \\boldsymbol{a})$。函数 $\\boldsymbol{a} \\cdot \\boldsymbol{n}$ 是反对称的，因为 $\\boldsymbol{a} \\cdot (-\\boldsymbol{n}) = -(\\boldsymbol{a} \\cdot \\boldsymbol{n})$。要从一个反对称函数构造一个对称函数，绝对值是一个自然的选择。\n- 性质 3（非负性）要求 $C \\cdot h \\cdot g(\\boldsymbol{n}, \\boldsymbol{a}) \\ge 0$。由于 $h0$，我们需要 $C \\cdot g(\\boldsymbol{n}, \\boldsymbol{a}) \\ge 0$。\n\n让我们提出满足这些标准的最简单的 $g$ 的形式：$g(\\boldsymbol{n}, \\boldsymbol{a}) = |\\boldsymbol{a} \\cdot \\boldsymbol{n}|$。我们验证这个选择：\n- 对称性：$|\\boldsymbol{a} \\cdot (-\\boldsymbol{n})| = |-(\\boldsymbol{a} \\cdot \\boldsymbol{n})| = |\\boldsymbol{a} \\cdot \\boldsymbol{n}|$。此项成立。\n- 方向选择性：如果 $\\boldsymbol{a} \\cdot \\boldsymbol{n} = 0$，则 $|\\boldsymbol{a} \\cdot \\boldsymbol{n}| = 0$。此项成立。\n- 非负性：对于所有 $\\boldsymbol{a}$ 和 $\\boldsymbol{n}$， $|\\boldsymbol{a} \\cdot \\boldsymbol{n}| \\ge 0$。此项成立。\n\n通过综合这些发现，并为简单起见选择比例常数 $C=1$（这是定义此类参数的常见做法），我们得到了候选权重函数：\n$$\n\\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) = h |\\boldsymbol{a} \\cdot \\boldsymbol{n}|\n$$\n这种形式被广泛用于对流占优问题的稳定化方法中，例如连续内罚（CIP）或间断伽辽金（DG）方法。它提供了与网格尺寸和垂直于单元面的速度分量大小成正比的稳定化，这在物理上是直观的，在数值上也是合理的。\n\n最后，我们考虑关于常数状态下离散一致性的第六个测试。单个面 $F$ 上的稳定化贡献由 $S_F = \\omega(\\boldsymbol{n}, \\boldsymbol{a}, h) \\int_{F} [\\phi_u]_F \\, [\\phi_v]_F \\, \\mathrm{d}s$ 给出。如果离散解 $u_h$ 和测试函数 $v_h$ 在整个域上是常数，那么任何合理定义的跳跃算子（例如，迹的跳跃）都将产生零，即 $[\\phi_u]_F = 0$ 和 $[\\phi_v]_F = 0$。在这种情况下，被积函数本身恒等于零。因此，积分计算结果为零，整个面贡献 $S_F$ 也为零，而与权重 $\\omega$ 的值无关。这是一个基本的一致性要求：对于任何应由伽辽金部分精确捕捉的解，稳定化项必须为零。对于平流方程 $\\boldsymbol{a} \\cdot \\nabla u = 0$，任何常数函数 $u=c$ 都是一个平凡解，数值格式不能对其施加惩罚。该测试证实了这种行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a face-based stabilization weight function and verifies its properties\n    through a series of computational tests as specified in the problem statement.\n    \"\"\"\n\n    def compute_weight(a: tuple[float, float], n: tuple[float, float], h: float) - float:\n        \"\"\"\n        Computes the stabilization weight omega = h * |a . n|.\n        \n        Args:\n            a: The constant advection vector (a_x, a_y).\n            n: The face normal unit vector (n_x, n_y).\n            h: The characteristic mesh size (face length).\n            \n        Returns:\n            The computed nonnegative weight.\n        \"\"\"\n        a_vec = np.array(a)\n        n_vec = np.array(n)\n        return h * np.abs(np.dot(a_vec, n_vec))\n\n    results = []\n    TOLERANCE = 1e-12\n\n    # Test 1: Happy path float calculation\n    a1, n1, h1 = (2.0, 1.0), (1.0, 0.0), 0.1\n    w1 = compute_weight(a1, n1, h1)\n    results.append(f\"{w1:.6f}\")\n\n    # Test 2: Directional selectivity (a . n = 0)\n    a2, n2, h2 = (0.0, 3.0), (1.0, 0.0), 0.1\n    w2 = compute_weight(a2, n2, h2)\n    results.append(np.isclose(w2, 0.0, atol=TOLERANCE))\n\n    # Test 3: Nonnegativity under reverse flow (a . n  0)\n    a3, n3, h3 = (-5.0, 0.0), (1.0, 0.0), 0.2\n    w3 = compute_weight(a3, n3, h3)\n    results.append(w3  0.0)\n\n    # Test 4: Symmetry w.r.t. face orientation (n vs -n)\n    a4, n4_val, h4 = (1.0, -4.0), (0.0, 1.0), 0.05\n    n4 = np.array(n4_val)\n    w4_pos_n = compute_weight(a4, n4, h4)\n    w4_neg_n = compute_weight(a4, -n4, h4)\n    results.append(np.isclose(w4_pos_n, w4_neg_n, atol=TOLERANCE, rtol=TOLERANCE))\n\n    # Test 5: Linear h-scaling\n    a5, n5_unnormalized, h5_1, h5_2 = (3.0, 4.0), (1.0, 1.0), 0.5, 0.25\n    n5 = np.array(n5_unnormalized) / np.linalg.norm(n5_unnormalized)\n    w5_1 = compute_weight(a5, n5, h5_1)\n    w5_2 = compute_weight(a5, n5, h5_2)\n    \n    # Avoid division by zero if w5_2 is zero\n    if np.isclose(w5_2, 0.0, atol=TOLERANCE):\n        # If w5_2 is zero, a.n must be zero, so w5_1 is also zero.\n        # The test condition holds trivially if h1/h2 is not singular.\n        # But for the given a and n, w5_2 will be non-zero.\n        is_ratio_correct = np.isclose(w5_1, 0.0, atol=TOLERANCE)\n    else:\n        ratio_w = w5_1 / w5_2\n        ratio_h = h5_1 / h5_2\n        is_ratio_correct = np.isclose(ratio_w, ratio_h, atol=TOLERANCE, rtol=TOLERANCE)\n    results.append(is_ratio_correct)\n\n    # Test 6: Constant-state face contribution\n    # The stabilization integrand contains jump terms [phi_u] and [phi_v].\n    # The problem specifies that for this test, [phi_u] = 0 and [phi_v] = 0.\n    # Therefore, the integrand is [phi_u]*[phi_v] = 0.\n    # The integral over the face is 0, and the total contribution is omega * 0 = 0.\n    # This is true irrespective of the values of a, n, h, or omega.\n    face_contribution = 0.0\n    results.append(np.isclose(face_contribution, 0.0, atol=TOLERANCE))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "稳定化方法的目标不仅仅是获得一个光滑无振荡的数值解，更关键的是要准确预测如升力、阻力等工程关注量。本项高级练习将引导你探究一个精妙而深刻的概念：伴随一致性 。通过对一个特定的SUPG格式进行分析，你将亲手推导并量化由于伴随不一致性而导致的输出泛函（如出口值）的系统性偏差，从而理解为何不恰当的稳定化格式可能损害CFD仿真对关键性能指标的预测精度。",
            "id": "3996444",
            "problem": "考虑一个代表航空航天计算流体动力学 (CFD) 中由输出驱动的待求量的稳态一维对流扩散模型问题：求解在定义域 $[0,1]$ 上的函数 $u(x)$，使得 $a\\,\\frac{d u}{d x}(x) - \\nu\\,\\frac{d^{2} u}{d x^{2}}(x) = s(x)$，并满足入流 Dirichlet 边界条件 $u(0) = 1$ 和出流自然边界条件 $-\\nu\\,\\frac{d u}{d x}(1) = 0$。此处，$a  0$ 为对流速度，$\\nu  0$ 为扩散系数，$s(x)$ 为源项。其弱形式为：求解 $u \\in H^{1}(0,1)$ 且 $u(0)=1$，使得对于所有满足 $w(0)=0$ 的测试函数 $w \\in H^{1}(0,1)$，都有 $\\int_{0}^{1} \\left( a\\,u'(x)\\,w(x) + \\nu\\,u'(x)\\,w'(x) \\right)\\,dx = \\int_{0}^{1} s(x)\\,w(x)\\,dx + \\left( -\\nu\\,u'(1) \\right)\\,w(1)$。考虑一种使用 Streamline Upwind/Petrov-Galerkin (SUPG) 思想的稳定化有限元方法：对于单个单元 $[0,1]$ 上的连续分片线性空间中的试探函数 $u_{h}$ 和测试函数 $w_{h}$，通过内部稳定项 $\\int_{0}^{1} \\tau\\,\\left( a\\,u'_{h}(x) - s(x) \\right)\\,a\\,w'_{h}(x)\\,dx$ 对弱形式进行增广，其中 $\\tau0$ 是一个常数稳定化参数。该格式有意在残差中省略了 $-\\nu\\,u''$ 的贡献，从而失去了伴随一致性。\n\n令待求量（泛函）为 $J(u) = u(1)$，它可作为在出流边界上测量的某个输出（例如，阻力）的代理。在相同的有限元空间中定义离散伴随 $z_{h}$，要求离散双线性形式 $B_{h}(v_{h},z_{h})$ 对测试空间中的所有 $v_{h}$ 都满足 $B_{h}(v_{h},z_{h}) = J(v_{h})$，其中 $B_{h}$ 是由上述离散化所导出的稳定化双线性形式。使用在 $[0,1]$ 上的单个线性单元，其节点基函数为 $N_{1}(x) = 1-x$ 和 $N_{2}(x) = x$，并在强制施加入流本质边界条件 $u_{h}(0) = 1$ 后，测试空间由 $N_{2}$ 张成。\n\n1. 从控制方程和边界数据出发，选择构造源项 $s(x) = (a - \\nu)\\,\\exp(x)$，并推导满足 $u(0) = 1$ 和 $-\\nu\\,u'(1) = 0$ 的精确解 $u(x)$。然后计算 $u'(0)$ 和 $u'(1)$。\n\n2. 推导此单单元稳定化方法的离散双线性形式 $B_{h}(v_{h},w_{h})$，并计算标量 $B_{h}(N_{2},N_{2})$。\n\n3. 使用离散伴随定义，证明 $z_{h}(x) = \\alpha\\,N_{2}(x)$，其中 $\\alpha = 1/B_{h}(N_{2},N_{2})$，并证明由缺少伴随一致性引起的输出偏差为 $b = \\int_{0}^{1} \\tau\\,\\nu\\,a\\,u''(x)\\,z'_{h}(x)\\,dx$。将 $b$ 化简为包含 $u'(0)$ 和 $u'(1)$ 的闭式形式。\n\n4. 在此设置下，为恢复 $J(u)$ 的伴随一致性，提出所需的最小修正项，并解释该修正项的物理诠释。\n\n最后，对于参数 $a = 5$，$\\nu = 0.02$ 和 $\\tau = 0.1$，数值计算偏差 $b$。将 $b$ 的最终答案表示为精确到四位有效数字的小数，不带单位。",
            "solution": "用户希望解决一个与对流扩散方程的稳定化有限元方法相关的多部分问题。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n-   **控制方程**：$a\\,\\frac{d u}{d x}(x) - \\nu\\,\\frac{d^{2} u}{d x^{2}}(x) = s(x)$，在定义域 $[0,1]$ 上。\n-   **参数**：对流速度 $a  0$，扩散系数 $\\nu  0$。\n-   **边界条件**：$u(0) = 1$（入流 Dirichlet），$-\\nu\\,\\frac{d u}{d x}(1) = 0$（出流自然）。\n-   **弱形式**：求解 $u \\in H^{1}(0,1)$ 且 $u(0)=1$，使得对于所有满足 $w(0)=0$ 的测试函数 $w \\in H^{1}(0,1)$，都有 $\\int_{0}^{1} \\left( a\\,u'(x)\\,w(x) + \\nu\\,u'(x)\\,w'(x) \\right)\\,dx = \\int_{0}^{1} s(x)\\,w(x)\\,dx + \\left( -\\nu\\,u'(1) \\right)\\,w(1)$。\n-   **稳定化方法**：在单个单元 $[0,1]$ 上的 Streamline Upwind/Petrov-Galerkin (SUPG) 格式。\n-   **稳定项**：$\\int_{0}^{1} \\tau\\,\\left( a\\,u'_{h}(x) - s(x) \\right)\\,a\\,w'_{h}(x)\\,dx$，其中 $\\tau0$ 是一个常数稳定化参数。此项的残差中有意省略了 $-\\nu\\,u''$。\n-   **有限元空间**：在单个单元 $[0,1]$ 上的连续分片线性空间。\n-   **基函数**：节点基函数 $N_{1}(x) = 1-x$ 和 $N_{2}(x) = x$。\n-   **试探/测试空间**：试探函数 $u_h$ 和测试函数 $w_h$。由于强制施加了 $u_h(0)=1$，变分的测试空间由 $N_2(x)$ 张成。\n-   **待求量**：$J(u) = u(1)$。\n-   **离散伴随定义**：$z_h$ 由 $B_{h}(v_{h},z_{h}) = J(v_{h})$ 定义，对测试空间中的所有 $v_{h}$ 均成立，其中 $B_h$ 是稳定化双线性形式。\n-   **第 1 部分任务**：当 $s(x) = (a - \\nu)\\,\\exp(x)$ 时，推导精确解 $u(x)$ 并计算 $u'(0)$ 和 $u'(1)$。\n-   **第 2 部分任务**：推导离散双线性形式 $B_{h}(v_{h},w_{h})$ 并计算 $B_{h}(N_{2},N_{2})$。\n-   **第 3 部分任务**：证明 $z_{h}(x) = \\alpha\\,N_{2}(x)$，其中 $\\alpha = 1/B_{h}(N_{2},N_{2})$，并将偏差 $b = \\int_{0}^{1} \\tau\\,\\nu\\,a\\,u''(x)\\,z'_{h}(x)\\,dx$ 化简为闭式形式。\n-   **第 4 部分任务**：为恢复 $J(u)$ 的伴随一致性，提出并解释所需的最小修正项。\n-   **最终任务**：对于 $a = 5$，$\\nu = 0.02$，$\\tau = 0.1$，数值计算偏差 $b$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n-   **科学上成立的**：该问题是偏微分方程数值分析中的一个标准练习，特别关注于对流主导流动的稳定化有限元方法 (FEM)。SUPG、伴随一致性和目标导向误差估计等概念是计算流体动力学 (CFD) 的核心主题。该设置在科学和数学上是合理的。\n-   **良态的**：问题被清晰地划分为四个顺序部分，最终进行数值计算。每个部分都定义明确，并建立在前一部分的基础上，从而导向一个唯一且有意义的解。\n-   **客观的**：语言是形式化、精确且无歧义的，使用了数学和有限元方法的标准术语。没有主观或基于观点的陈述。\n-   **完整性和一致性**：提供了所有必要的组成部分：PDE、定义域、边界条件、弱形式（标准和稳定化的）、基函数以及任务所需的定义。在稳定化残差中有意省略扩散项是该问题设置的一个关键特征，旨在探讨伴随不一致性的概念，而不是一个缺陷。\n\n**步骤 3：结论和行动**\n\n问题是有效的。这是一个关于稳定化有限元方法理论的良态、自洽且科学上成立的练习。我现在将着手解决问题。\n\n### 解答\n\n**第 1 部分：精确解**\n\n控制微分方程为 $a\\,u' - \\nu\\,u'' = s(x)$。给定源项 $s(x) = (a - \\nu)\\,\\exp(x)$，方程为：\n$$\n\\nu\\,u'' - a\\,u' = -(a - \\nu)\\,\\exp(x)\n$$\n这是一个二阶线性常微分方程。其通解是齐次解 $u_c(x)$ 和一个特解 $u_p(x)$ 的和。\n\n齐次部分（$\\nu\\,r^2 - a\\,r = 0$）的特征方程是 $r(\\nu\\,r - a) = 0$，其根为 $r_1 = 0$ 和 $r_2 = a/\\nu$。互补解为：\n$$\nu_c(x) = C_1 + C_2\\,\\exp\\left(\\frac{a}{\\nu}x\\right)\n$$\n对于特解，我们使用待定系数法，并假设一个形式为 $u_p(x) = A\\,\\exp(x)$ 的解。将其代入常微分方程中得到：\n$$\n\\nu\\,(A\\,\\exp(x)) - a\\,(A\\,\\exp(x)) = -(a - \\nu)\\,\\exp(x)\n$$\n$$\nA(\\nu - a)\\,\\exp(x) = -(a - \\nu)\\,\\exp(x)\n$$\n这意味着 $A(\\nu - a) = \\nu - a$，所以 $A = 1$。特解是 $u_p(x) = \\exp(x)$。\n\n通解是 $u(x) = C_1 + C_2\\,\\exp(\\frac{a}{\\nu}x) + \\exp(x)$。我们根据边界条件来确定常数 $C_1$ 和 $C_2$。\n第一个边界条件是 $u(0) = 1$：\n$$\nu(0) = C_1 + C_2\\,\\exp(0) + \\exp(0) = C_1 + C_2 + 1 = 1 \\implies C_1 + C_2 = 0 \\implies C_1 = -C_2\n$$\n第二个边界条件是 $-\\nu\\,u'(1) = 0$，由于 $\\nu0$，这意味着 $u'(1) = 0$。通解的导数是：\n$$\nu'(x) = \\frac{a}{\\nu}C_2\\,\\exp\\left(\\frac{a}{\\nu}x\\right) + \\exp(x)\n$$\n在 $x=1$ 处应用该条件：\n$$\nu'(1) = \\frac{a}{\\nu}C_2\\,\\exp\\left(\\frac{a}{\\nu}\\right) + \\exp(1) = 0 \\implies C_2 = -\\frac{\\nu}{a}\\,\\exp(1)\\,\\exp\\left(-\\frac{a}{\\nu}\\right) = -\\frac{\\nu}{a}\\,\\exp\\left(1 - \\frac{a}{\\nu}\\right)\n$$\n于是，$C_1 = -C_2 = \\frac{\\nu}{a}\\,\\exp(1 - \\frac{a}{\\nu})$。\n将常数代回，精确解为：\n$$\nu(x) = \\exp(x) + \\frac{\\nu}{a}\\,\\exp\\left(1 - \\frac{a}{\\nu}\\right) - \\frac{\\nu}{a}\\,\\exp\\left(1 - \\frac{a}{\\nu}\\right)\\exp\\left(\\frac{a}{\\nu}x\\right)\n$$\n$$\nu(x) = \\exp(x) + \\frac{\\nu}{a}\\,\\exp\\left(1 - \\frac{a}{\\nu}\\right)\\left(1 - \\exp\\left(\\frac{a}{\\nu}x\\right)\\right)\n$$\n现在我们计算所需的导数。导数为：\n$$\nu'(x) = \\exp(x) + \\frac{\\nu}{a}\\,\\exp\\left(1 - \\frac{a}{\\nu}\\right)\\left(-\\frac{a}{\\nu}\\exp\\left(\\frac{a}{\\nu}x\\right)\\right) = \\exp(x) - \\exp\\left(1 - \\frac{a}{\\nu}\\right)\\exp\\left(\\frac{a}{\\nu}x\\right)\n$$\n$$\nu'(x) = \\exp(x) - \\exp\\left(1 - \\frac{a}{\\nu} + \\frac{a}{\\nu}x\\right)\n$$\n在 $x=0$ 处：\n$$\nu'(0) = \\exp(0) - \\exp\\left(1 - \\frac{a}{\\nu}\\right) = 1 - \\exp\\left(1 - \\frac{a}{\\nu}\\right)\n$$\n在 $x=1$ 处：\n$$\nu'(1) = \\exp(1) - \\exp\\left(1 - \\frac{a}{\\nu} + \\frac{a}{\\nu}\\right) = \\exp(1) - \\exp(1) = 0\n$$\n结果 $u'(1)=0$ 证实了边界条件的正确应用。\n\n**第 2 部分：离散双线性形式**\n\n稳定化弱形式是求解 $u_h$ 使得对于所有 $w_h$：\n$$\n\\int_{0}^{1} \\left( a\\,u'_{h}w_{h} + \\nu\\,u'_{h}w'_{h} \\right)dx + \\int_{0}^{1} \\tau\\,\\left( a\\,u'_{h} - s \\right)\\,a\\,w'_{h}dx = \\int_{0}^{1} s\\,w_{h}dx\n$$\n我们重新整理这个方程，将包含未知量 $u_h$ 的项（左侧）与已知项（右侧）分开。\n双线性形式 $B_{h}(u_h, w_h)$ 收集了所有关于 $u_h$ 的线性项。\n$$\nB_{h}(u_h, w_h) = \\int_{0}^{1} \\left( a\\,u'_{h}w_{h} + \\nu\\,u'_{h}w'_{h} \\right)dx + \\int_{0}^{1} \\tau\\,(a\\,u'_{h})(a\\,w'_{h})dx\n$$\n合并含有 $u'_h w'_h$ 的项：\n$$\nB_{h}(v_{h}, w_{h}) = \\int_{0}^{1} \\left( a\\,v'_{h}w_{h} + (\\nu + a^2 \\tau) v'_{h}w'_{h} \\right) dx\n$$\n题目要求计算 $B_{h}(N_{2}, N_{2})$。为此，我们设置 $v_h = N_2(x) = x$ 和 $w_h = N_2(x) = x$。其导数为 $v'_h = N'_2(x) = 1$ 和 $w'_h = N'_2(x) = 1$。\n$$\nB_{h}(N_{2}, N_{2}) = \\int_{0}^{1} \\left( a(1)(x) + (\\nu + a^2 \\tau) (1)(1) \\right) dx = \\int_{0}^{1} (ax + \\nu + a^2\\tau) dx\n$$\n$$\nB_{h}(N_{2}, N_{2}) = \\left[ a\\frac{x^2}{2} + (\\nu + a^2\\tau)x \\right]_0^1 = \\left( a\\frac{1}{2} + \\nu + a^2\\tau \\right) - 0 = \\frac{a}{2} + \\nu + a^2\\tau\n$$\n\n**第 3 部分：伴随解和偏差项**\n\n离散伴随 $z_h$ 由 $B_{h}(v_{h}, z_{h}) = J(v_{h})$ 定义，对测试空间中的所有 $v_h$ 均成立。测试空间由 $N_2(x)$ 张成，所以我们只需要考虑 $v_h = N_2(x)$。伴随解 $z_h$ 必须满足齐次本质边界条件 $z_h(0)=0$，所以它必须具有形式 $z_h(x) = \\alpha N_2(x)$，其中 $\\alpha$ 是某个常数。泛函为 $J(v_h) = v_h(1)$。\n对于 $v_h = N_2(x)$，我们有 $J(N_2) = N_2(1) = 1$。\n$z_h$ 的定义方程变为：\n$$\nB_{h}(N_2, \\alpha N_2) = J(N_2) \\implies \\alpha B_{h}(N_2, N_2) = 1\n$$\n解出 $\\alpha$：\n$$\n\\alpha = \\frac{1}{B_{h}(N_{2}, N_{2})} = \\frac{1}{\\frac{a}{2} + \\nu + a^2\\tau}\n$$\n这证实了 $z_h(x) = \\alpha N_2(x)$，其中 $\\alpha$ 如上所述。\n\n由伴随不一致性引起的偏差项为 $b = \\int_{0}^{1} \\tau\\,\\nu\\,a\\,u''(x)\\,z'_{h}(x)\\,dx$。\n我们有 $z_h(x) = \\alpha x$，所以其导数 $z'_h(x) = \\alpha$ 是一个常数。\n$$\nb = \\int_{0}^{1} \\tau\\,\\nu\\,a\\,u''(x)\\,\\alpha\\,dx = \\alpha\\tau\\nu a \\int_{0}^{1} u''(x)\\,dx\n$$\n使用微积分基本定理计算二阶导数的积分：\n$$\n\\int_{0}^{1} u''(x)\\,dx = [u'(x)]_0^1 = u'(1) - u'(0)\n$$\n将此代入 $b$ 的表达式中：\n$$\nb = \\alpha\\tau\\nu a (u'(1) - u'(0))\n$$\n现在，我们代入 $\\alpha$、$u'(1)$ 和 $u'(0)$ 的表达式：\n$$\nb = \\left(\\frac{1}{\\frac{a}{2} + \\nu + a^2\\tau}\\right) \\tau\\nu a \\left(0 - \\left(1 - \\exp\\left(1 - \\frac{a}{\\nu}\\right)\\right)\\right)\n$$\n$$\nb = -\\frac{\\tau\\nu a}{\\frac{a}{2} + \\nu + a^2\\tau} \\left(1 - \\exp\\left(1 - \\frac{a}{\\nu}\\right)\\right) = \\frac{\\tau\\nu a}{\\frac{a}{2} + \\nu + a^2\\tau} \\left(\\exp\\left(1 - \\frac{a}{\\nu}\\right) - 1\\right)\n$$\n这是偏差 $b$ 所需的闭式形式。\n\n**第 4 部分：为实现伴随一致性的修正**\n\n伴随一致性之所以会丧失，是因为稳定项 $\\int_{0}^{1} \\tau\\,( a\\,u'_{h} - s )\\,a\\,w'_{h}\\,dx$ 使用了对真实微分方程残差 $R(u) = a u' - \\nu u'' - s$ 的不完全表示。该格式省略了扩散项 $-\\nu u''$。\n\n为恢复伴随一致性，稳定项必须基于完整的残差。最小的修正是将省略项的贡献加回格式中。需要添加到弱形式中的修正项为：\n$$\nC(u_h, w_h) = \\int_{0}^{1} \\tau\\,(-\\nu\\,u_h'')\\,a\\,w'_h\\,dx\n$$\n对于 $C^0$ 类分片线性函数的有限元空间，二阶导数 $u_h''$ 在单元内部没有良好定义（它为零），但在节点处会产生狄拉克δ分布。为了正确处理这一点，修正项在单元域 $K=[0,1]$ 上进行分部积分：\n$$\nC(u_h, w_h) = \\int_{0}^{1} \\tau a \\nu u'_h (w'_h)' dx - [\\tau a \\nu u'_h w'_h]_0^1\n$$\n由于 $w_h$ 是单元上的线性多项式，其一阶导数 $w'_h$ 是常数，其二阶导数 $(w'_h)'$ 为零。因此，积分项消失。修正项简化为边界项：\n$$\nC(u_h, w_h) = -[\\tau a \\nu u'_h w'_h]_0^1\n$$\n这是为恢复伴随一致性而需要添加到双线性形式 $B_h(u_h,w_h)$ 中的最小修正项。这种修正后的方法是 Galerkin/Least-Squares (GLS) 方法的一种形式。\n\n**物理诠释：** 标准的 SUPG 稳定化方法纯粹在流线方向上增加了人工扩散（其大小由参数 $\\tau a^2$ 调节）以抑制振荡。这种不一致的格式仅基于残差的对流部分来计算这种扩散的需要。修正项将物理扩散 ($\\nu$) 的效应重新引入到稳定化中。它在物理扩散和流线方向的人工扩散之间建立了耦合。这确保了稳定化的量对问题的完整物理特性（由单元佩克莱数表示）敏感，而不仅仅是对流输运，从而得到一个更准确和鲁棒的数值格式。\n\n**偏差的最终数值计算**\n\n我们对给定参数 $a = 5$，$\\nu = 0.02$ 和 $\\tau = 0.1$ 计算偏差 $b$。\n$b$ 的表达式为：\n$$\nb = \\frac{\\tau\\nu a}{\\frac{a}{2} + \\nu + a^2\\tau} \\left(\\exp\\left(1 - \\frac{a}{\\nu}\\right) - 1\\right)\n$$\n首先，我们计算各个部分：\n-   $\\tau\\nu a = (0.1)(0.02)(5) = 0.01$\n-   $\\frac{a}{2} + \\nu + a^2\\tau = \\frac{5}{2} + 0.02 + (5^2)(0.1) = 2.5 + 0.02 + (25)(0.1) = 2.5 + 0.02 + 2.5 = 5.02$\n-   $1 - \\frac{a}{\\nu} = 1 - \\frac{5}{0.02} = 1 - 250 = -249$\n-   $\\exp(1 - \\frac{a}{\\nu}) - 1 = \\exp(-249) - 1$。$\\exp(-249)$ 项是一个极度接近零的数。出于实际目的，$\\exp(-249) - 1 \\approx -1$。\n\n将这些值代入 $b$ 的表达式中：\n$$\nb \\approx \\frac{0.01}{5.02} \\times (-1) = -0.00199203187...\n$$\n将结果四舍五入到四位有效数字，得到 -0.001992。",
            "answer": "$$\\boxed{-0.001992}$$"
        }
    ]
}