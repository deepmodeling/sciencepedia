{
    "hands_on_practices": [
        {
            "introduction": "Before constructing advanced numerical schemes, it is crucial to understand the fundamental challenges they are designed to overcome. When applying standard high-order methods to nonlinear equations, a phenomenon known as aliasing error can corrupt the solution. This practice provides a concrete, analytical look at how this error arises, tasking you with quantifying the energy of the unresolved modes generated by the quadratic flux in the Burgers' equation . By working through this derivation, you will build a solid intuition for why more sophisticated discretizations, such as the split-form Summation-by-Parts (SBP) operators, are essential for robust simulations.",
            "id": "3999352",
            "problem": "Consider the one-dimensional scalar conservation law with a purely convective flux, such as the inviscid Burgers equation, given by $u_{t} + \\partial_{x} f(u) = 0$ with $f(u) = \\tfrac{1}{2} u^{2}$. In a high-order element method employing Summation-By-Parts (SBP) operators and polynomial modal bases, nonlinear aliasing arises because the nonlinear flux $f(u)$ generally has a higher polynomial degree than the discrete state $u$, causing unresolved high-frequency content to be truncated or misrepresented. In entropy-stable and kinetic-energy-preserving split-form discretizations, this phenomenon is mitigated by reformulating nonlinear operations. In contrast, a naive polynomial projection of $f(u)$ onto a space of degree $N$ will discard all content above degree $N$; the portion of $f(u)$ that lies above degree $N$ is the truncated remainder, and its $L^{2}$ energy quantifies the modal aliasing.\n\nWork on a single reference element $x \\in [-1,1]$ with the standard Legendre polynomial basis $\\{P_{n}(x)\\}_{n=0}^{\\infty}$, where $\\int_{-1}^{1} P_{m}(x) P_{n}(x) \\, dx = 0$ for $m \\neq n$ and $\\int_{-1}^{1} P_{n}^{2}(x) \\, dx = \\tfrac{2}{2n+1}$. Let the discrete state be of degree $N=2$,\n$$\nu(x) = \\alpha \\, P_{1}(x) + \\beta \\, P_{2}(x),\n$$\nwith real coefficients $\\alpha$ and $\\beta$. The nonlinear flux $f(u) = \\tfrac{1}{2}u^{2}$ is then a polynomial of degree $4$. Define the $L^{2}$ projection of $f(u)$ onto the degree-$2$ space $\\mathcal{P}_{2} = \\mathrm{span}\\{P_{0}, P_{1}, P_{2}\\}$ by\n$$\n\\Pi_{\\le 2} f(u) = \\sum_{n=0}^{2} c_{n} P_{n}(x), \\quad c_{n} = \\frac{\\int_{-1}^{1} f(u(x)) P_{n}(x) \\, dx}{\\int_{-1}^{1} P_{n}^{2}(x) \\, dx}.\n$$\nLet the truncation (aliasing) error be $E(x) = f(u(x)) - \\Pi_{\\le 2} f(u(x))$, which lies entirely in the span of $\\{P_{3}, P_{4}\\}$. Derive from first principles how the nonlinear aliasing arises in this setting, and then, using the Legendre basis and exact integration on $[-1,1]$, compute a closed-form analytic expression for the squared $L^{2}$-norm of the truncation error,\n$$\n\\|E\\|_{L^{2}([-1,1])}^{2} = \\int_{-1}^{1} E^{2}(x) \\, dx,\n$$\nin terms of $\\alpha$ and $\\beta$. Express your final answer as a single simplified analytic expression. No numerical rounding is required and no physical units apply.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It presents a standard problem in the numerical analysis of partial differential equations, specifically assessing the aliasing error from a nonlinear term in a spectral method context. All provided information is sufficient and consistent for deriving a unique analytical solution.\n\nThe core of the problem lies in understanding how nonlinear operations create higher-frequency content that cannot be represented within a given finite-dimensional polynomial space, leading to aliasing errors. Given a discrete state $u(x)$ belonging to a polynomial space of degree $N$, a nonlinear function of this state, such as $f(u(x)) = \\frac{1}{2}u(x)^2$, will generally be a polynomial of a higher degree. Specifically, if $u(x)$ is a polynomial of degree $N$, then $u(x)^2$ is a polynomial of degree $2N$. When working within a discrete framework that can only represent polynomials up to degree $N$, this higher-degree content must be either truncated or projected. The error resulting from this process is known as aliasing or truncation error. This problem asks us to quantify this error in the $L^2$ sense for a specific case.\n\nThe discrete state $u(x)$ is given as a polynomial of degree $N=2$ on the reference element $x \\in [-1,1]$:\n$$\nu(x) = \\alpha \\, P_{1}(x) + \\beta \\, P_{2}(x)\n$$\nwhere $\\alpha$ and $\\beta$ are real coefficients and $P_n(x)$ are the Legendre polynomials. The nonlinear flux function is $f(u) = \\frac{1}{2}u^2$. Thus, the flux is:\n$$\nf(u(x)) = \\frac{1}{2} \\left[ \\alpha P_{1}(x) + \\beta P_{2}(x) \\right]^2 = \\frac{1}{2} \\left[ \\alpha^2 P_{1}(x)^2 + 2\\alpha\\beta P_{1}(x)P_{2}(x) + \\beta^2 P_{2}(x)^2 \\right]\n$$\nSince $P_1(x)$ is degree $1$ and $P_2(x)$ is degree $2$, the highest degree term in $f(u(x))$ comes from $P_2(x)^2$, making $f(u(x))$ a polynomial of degree $4$.\n\nTo compute the projection and the error, we must express $f(u(x))$ as a linear combination of Legendre polynomials, i.e., in the form $f(u(x)) = \\sum_{n=0}^{4} d_n P_n(x)$. This requires the expansion of products of Legendre polynomials into the Legendre basis. The required product-to-sum formulas are:\n\\begin{enumerate}\n    \\item $P_1(x)^2$: $P_1(x) = x$. Thus, $P_1(x)^2 = x^2$. The first few Legendre polynomials are $P_0(x) = 1$ and $P_2(x) = \\frac{1}{2}(3x^2 - 1)$. From $P_2(x)$, we can write $x^2 = \\frac{2}{3}P_2(x) + \\frac{1}{3}P_0(x)$. Therefore, $P_1(x)^2 = \\frac{1}{3}P_0(x) + \\frac{2}{3}P_2(x)$.\n    \\item $P_1(x)P_2(x)$: The general recurrence relation $x P_n(x) = \\frac{n+1}{2n+1}P_{n+1}(x) + \\frac{n}{2n+1}P_{n-1}(x)$ with $n=2$ gives $P_1(x)P_2(x) = x P_2(x) = \\frac{3}{5}P_3(x) + \\frac{2}{5}P_1(x)$.\n    \\item $P_2(x)^2$: We use the power representation. We found $x^2 = \\frac{2}{3}P_2(x) + \\frac{1}{3}P_0(x)$. We also need $x^4$. $P_4(x) = \\frac{1}{8}(35x^4 - 30x^2 + 3)$. Rearranging yields $x^4 = \\frac{8}{35}P_4(x) + \\frac{6}{7}x^2 - \\frac{3}{35}$. Substituting for $x^2$: $x^4 = \\frac{8}{35}P_4(x) + \\frac{6}{7}(\\frac{2}{3}P_2(x) + \\frac{1}{3}P_0(x)) - \\frac{3}{35}P_0(x) = \\frac{8}{35}P_4(x) + \\frac{4}{7}P_2(x) + \\frac{1}{5}P_0(x)$. Now we expand $P_2(x)^2 = (\\frac{1}{2}(3x^2-1))^2 = \\frac{9}{4}x^4 - \\frac{3}{2}x^2 + \\frac{1}{4}$. Substituting the Legendre expansions for $x^4$ and $x^2$:\n    $$\n    P_2(x)^2 = \\frac{9}{4}\\left(\\frac{8}{35}P_4 + \\frac{4}{7}P_2 + \\frac{1}{5}P_0\\right) - \\frac{3}{2}\\left(\\frac{2}{3}P_2 + \\frac{1}{3}P_0\\right) + \\frac{1}{4}P_0 = \\frac{18}{35}P_4(x) + \\frac{2}{7}P_2(x) + \\frac{1}{5}P_0(x).\n    $$\n\\end{enumerate}\n\nSubstituting these expansions back into the expression for $f(u(x))$:\n$$\nf(u(x)) = \\frac{1}{2} \\left[ \\alpha^2 \\left( \\frac{1}{3}P_0 + \\frac{2}{3}P_2 \\right) + 2\\alpha\\beta \\left( \\frac{2}{5}P_1 + \\frac{3}{5}P_3 \\right) + \\beta^2 \\left( \\frac{1}{5}P_0 + \\frac{2}{7}P_2 + \\frac{18}{35}P_4 \\right) \\right]\n$$\nWe group the terms by the order of the Legendre polynomials:\n$$\nf(u(x)) = \\left(\\frac{\\alpha^2}{6} + \\frac{\\beta^2}{10}\\right)P_0(x) + \\left(\\frac{2\\alpha\\beta}{5}\\right)P_1(x) + \\left(\\frac{\\alpha^2}{3} + \\frac{\\beta^2}{7}\\right)P_2(x) + \\left(\\frac{3\\alpha\\beta}{5}\\right)P_3(x) + \\left(\\frac{9\\beta^2}{35}\\right)P_4(x)\n$$\nThis is the complete Legendre series expansion for $f(u(x))$. The $L^2$ projection of $f(u(x))$ onto the space $\\mathcal{P}_2 = \\mathrm{span}\\{P_0, P_1, P_2\\}$, denoted $\\Pi_{\\le 2} f(u)$, consists of the terms with degree up to $2$:\n$$\n\\Pi_{\\le 2} f(u) = \\left(\\frac{\\alpha^2}{6} + \\frac{\\beta^2}{10}\\right)P_0(x) + \\left(\\frac{2\\alpha\\beta}{5}\\right)P_1(x) + \\left(\\frac{\\alpha^2}{3} + \\frac{\\beta^2}{7}\\right)P_2(x)\n$$\nThe truncation error, $E(x)$, is the remainder of the series, which contains the higher-order terms:\n$$\nE(x) = f(u(x)) - \\Pi_{\\le 2} f(u(x)) = \\left(\\frac{3\\alpha\\beta}{5}\\right)P_3(x) + \\left(\\frac{9\\beta^2}{35}\\right)P_4(x)\n$$\nWe are asked to compute the squared $L^2$-norm of this error, $\\|E\\|_{L^2}^2 = \\int_{-1}^{1} E(x)^2 \\, dx$.\n$$\n\\|E\\|_{L^2}^2 = \\int_{-1}^{1} \\left[ \\left(\\frac{3\\alpha\\beta}{5}\\right)P_3(x) + \\left(\\frac{9\\beta^2}{35}\\right)P_4(x) \\right]^2 \\, dx\n$$\nDue to the orthogonality of the Legendre polynomials, $\\int_{-1}^{1} P_m(x) P_n(x) \\, dx = 0$ for $m \\neq n$. Expanding the square, the cross-term integral $\\int_{-1}^{1} P_3(x)P_4(x) \\, dx$ vanishes. The squared norm is therefore the sum of the squared norms of the individual components:\n$$\n\\|E\\|_{L^2}^2 = \\left(\\frac{3\\alpha\\beta}{5}\\right)^2 \\int_{-1}^{1} P_3(x)^2 \\, dx + \\left(\\frac{9\\beta^2}{35}\\right)^2 \\int_{-1}^{1} P_4(x)^2 \\, dx\n$$\nUsing the given normalization property $\\int_{-1}^{1} P_n(x)^2 \\, dx = \\frac{2}{2n+1}$:\n$$\n\\int_{-1}^{1} P_3(x)^2 \\, dx = \\frac{2}{2(3)+1} = \\frac{2}{7}\n$$\n$$\n\\int_{-1}^{1} P_4(x)^2 \\, dx = \\frac{2}{2(4)+1} = \\frac{2}{9}\n$$\nSubstituting these values back into the expression for $\\|E\\|_{L^2}^2$:\n$$\n\\|E\\|_{L^2}^2 = \\left(\\frac{9\\alpha^2\\beta^2}{25}\\right) \\left(\\frac{2}{7}\\right) + \\left(\\frac{81\\beta^4}{35^2}\\right) \\left(\\frac{2}{9}\\right)\n$$\n$$\n\\|E\\|_{L^2}^2 = \\frac{18\\alpha^2\\beta^2}{175} + \\frac{9 \\cdot 2 \\cdot \\beta^4}{1225} = \\frac{18\\alpha^2\\beta^2}{175} + \\frac{18\\beta^4}{1225}\n$$\nTo combine these terms, we find a common denominator, which is $1225 = 7 \\times 175$:\n$$\n\\|E\\|_{L^2}^2 = \\frac{18\\alpha^2\\beta^2 \\cdot 7}{175 \\cdot 7} + \\frac{18\\beta^4}{1225} = \\frac{126\\alpha^2\\beta^2}{1225} + \\frac{18\\beta^4}{1225}\n$$\nCombining and factoring the numerator:\n$$\n\\|E\\|_{L^2}^2 = \\frac{126\\alpha^2\\beta^2 + 18\\beta^4}{1225} = \\frac{18\\beta^2(7\\alpha^2 + \\beta^2)}{1225}\n$$\nThis is the final simplified closed-form expression for the squared $L^2$-norm of the truncation error.",
            "answer": "$$\n\\boxed{\\frac{18\\beta^2(7\\alpha^2 + \\beta^2)}{1225}}\n$$"
        },
        {
            "introduction": "Having established the need for structure-preserving discretizations, this practice guides you through the foundational process of building one from the ground up. You will construct an entropy-stable scheme for the inviscid Burgers' equation, a canonical model for nonlinear wave phenomena and shock formation. The exercise involves designing a two-point entropy-conservative flux and then augmenting it with a carefully constructed dissipation term to guarantee that the discrete solution respects the second law of thermodynamics . Implementing and verifying these principles will solidify your understanding of how entropy stability is achieved at the discrete level.",
            "id": "3999364",
            "problem": "Consider the one-dimensional scalar conservation law $u_t + f(u)_x = 0$ on a periodic domain $[-L/2, L/2]$ with $L = 2$, where the flux is $f(u) = \\frac{1}{2} u^2$ (inviscid Burgers equation). Adopt a uniform grid of $N$ points with spacing $\\Delta x = \\frac{L}{N}$ and cell centers $x_i = -\\frac{L}{2} + \\left(i + \\frac{1}{2}\\right)\\Delta x$ for integers $i \\in \\{0,1,\\dots,N-1\\}$. Use a Summation-By-Parts (SBP) first-derivative operator with diagonal mass matrix to approximate spatial derivatives under periodic boundary conditions, meaning the central-difference operator is skew-symmetric with respect to the diagonal inner-product matrix. The entropy function is $\\eta(u) = \\frac{1}{2} u^2$ with entropy variable $v = \\eta'(u) = u$ and entropy flux $q(u) = \\frac{1}{3} u^3$.\n\nDesign a two-point, entropy-conservative flux $\\hat{f}^{\\,ec}(u_L,u_R)$ for Burgers and augment it with a symmetric, consistent dissipation to obtain an entropy-stable flux $\\hat{f}^{\\,es}(u_L,u_R)$. The scheme must be written in flux-differencing (finite-volume) form on the periodic grid as\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(\\hat{f}^{\\,es}_{i+\\frac{1}{2}} - \\hat{f}^{\\,es}_{i-\\frac{1}{2}}\\right),\n$$\nwhere $\\hat{f}^{\\,es}_{i+\\frac{1}{2}} = \\hat{f}^{\\,es}(u_i,u_{i+1})$ and indices are taken modulo $N$ for periodicity.\n\nStarting from the fundamental definitions of entropy, entropy variables, and the Tadmor framework for entropy-conservative and entropy-stable fluxes, derive the discrete entropy production per interface $p_{i+\\frac{1}{2}}$ implied by your entropy-stable flux and show that it is nonnegative, i.e., $p_{i+\\frac{1}{2}} \\ge 0$. Then, implement a program to compute this per-interface production $p_{i+\\frac{1}{2}}$ and the semi-discrete entropy rate\n$$\n\\frac{d}{dt}\\left(\\sum_{i=0}^{N-1} \\Delta x \\,\\eta(u_i)\\right) = \\Delta x \\sum_{i=0}^{N-1} v_i \\,\\frac{d u_i}{dt},\n$$\nfor the following test suite. For each test, verify nonnegativity and localization of entropy production across shocks when applicable, and kinetic-energy preservation (interpreted here as preservation of the quadratic entropy $\\eta(u)$) when dissipation is removed.\n\nUse the following test suite:\n- Test $\\mathrm{A}$ (happy path, shock): $N = 128$, $u_L = 1$, $u_R = -1$, initial data $u_i = u_L$ if $x_i < 0$ and $u_i = u_R$ otherwise, dissipation scaling $\\alpha = 1$. Verify that:\n  $1)$ all $p_{i+\\frac{1}{2}} \\ge 0$,\n  $2)$ entropy production is localized only at discontinuities, i.e., exactly two interfaces on the periodic grid (one at $x=0$ and one at the periodic wrap) have strictly positive production.\n- Test $\\mathrm{B}$ (entropy-conservative, kinetic-energy-preserving): $N = 128$, same initial data as Test $\\mathrm{A}$, dissipation scaling $\\alpha = 0$. Verify that the total semi-discrete entropy rate equals $0$ (to within numerical tolerance), i.e., discrete kinetic energy is preserved.\n- Test $\\mathrm{C}$ (edge case, coarse shock): $N = 4$, same initial data as Test $\\mathrm{A}$, dissipation scaling $\\alpha = 1$. Verify that:\n  $1)$ all $p_{i+\\frac{1}{2}} \\ge 0$,\n  $2)$ exactly two interfaces have strictly positive production.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The entries must be in the following order and type:\n$[\\text{A\\_nonneg}, \\text{A\\_localized}, \\text{B\\_energy\\_preserved}, \\text{C\\_nonneg}, \\text{C\\_localized}]$,\nwhere each entry is a boolean ($\\text{True}$ or $\\text{False}$). No physical units are required for any quantity in this problem. Angles do not appear. Percentages must not be used.\n\nImplement the complete program in Python and ensure it runs without any user input, using only the libraries specified in the execution environment.",
            "solution": "The problem as stated is scientifically sound, well-posed, and contains all necessary information for a rigorous derivation and computational verification. I will proceed with the solution.\n\nThe foundation of this problem lies in constructing a numerical scheme for the one-dimensional scalar conservation law,\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0,\n$$\nthat respects a discrete version of the second law of thermodynamics. For the inviscid Burgers' equation, the flux is $f(u) = \\frac{1}{2} u^2$. The continuous system is endowed with an infinite number of entropy pairs $(\\eta(u), q(u))$ satisfying the compatibility condition $q'(u) = \\eta'(u) f'(u)$. For any convex entropy function $\\eta(u)$, the exact solution satisfies the inequality\n$$\n\\frac{\\partial \\eta(u)}{\\partial t} + \\frac{\\partial q(u)}{\\partial x} \\le 0.\n$$\nThe problem specifies the quadratic entropy function $\\eta(u) = \\frac{1}{2} u^2$, which corresponds to the physical kinetic energy density for this equation. The associated entropy variable is $v(u) = \\eta'(u) = u$, and the entropy flux is $q(u) = \\int^u v(\\xi) f'(\\xi) d\\xi = \\int^u \\xi \\cdot \\xi \\, d\\xi = \\frac{1}{3} u^3$.\n\nWe consider a finite volume discretization on a uniform periodic grid,\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(\\hat{f}_{i+\\frac{1}{2}} - \\hat{f}_{i-\\frac{1}{2}}\\right),\n$$\nwhere $\\hat{f}_{i+\\frac{1}{2}} = \\hat{f}(u_i, u_{i+1})$ is a two-point numerical flux function consistent with $f(u)$.\n\nAn entropy-stable scheme is one that guarantees a discrete version of the entropy inequality. Following the framework by Tadmor, this is achieved by first designing an entropy-conservative flux and then adding a carefully controlled amount of dissipation.\n\n**1. Entropy-Conservative (EC) Flux**\n\nA two-point numerical flux $\\hat{f}^{\\,ec}(u_L, u_R)$ is defined as entropy-conservative if it satisfies the condition\n$$\n(v_R - v_L) \\hat{f}^{\\,ec}(u_L, u_R) - (q_R - q_L) = 0,\n$$\nwhere $v_L = v(u_L)$, $v_R = v(u_R)$, and similarly for the entropy flux $q$. This condition ensures that the numerical scheme, without any added dissipation, conserves the total discrete entropy $\\sum_i \\Delta x \\eta(u_i)$ exactly.\n\nFor the given entropy pair, where $v(u) = u$ and $q(u) = \\frac{1}{3}u^3$, we can solve for $\\hat{f}^{\\,ec}$:\n$$\n\\hat{f}^{\\,ec}(u_L, u_R) = \\frac{q_R - q_L}{v_R - v_L} = \\frac{\\frac{1}{3}u_R^3 - \\frac{1}{3}u_L^3}{u_R - u_L}.\n$$\nAssuming $u_L \\ne u_R$, we can factor the numerator:\n$$\n\\hat{f}^{\\,ec}(u_L, u_R) = \\frac{\\frac{1}{3}(u_R - u_L)(u_L^2 + u_L u_R + u_R^2)}{u_R - u_L} = \\frac{1}{3} (u_L^2 + u_L u_R + u_R^2).\n$$\nIf $u_L = u_R = u$, this formula correctly limits to $\\frac{1}{3}(3u^2) = u^2$. The physical flux is $f(u) = \\frac{1}{2}u^2$. This flux is not consistent, as $\\hat{f}^{\\,ec}(u, u) = u^2 \\neq \\frac{1}{2}u^2$. Let's re-examine the EC-flux definition. It is $\\hat{f}^{ec}(u_L, u_R) = \\frac{q(u_R) - q(u_L)}{v(u_R) - v(u_L)}$. Wait, this is not the general definition. A general symmetric and consistent entropy conservative flux for Burgers' equation is $\\hat{f}^{ec}(u_L, u_R) = \\frac{f(u_L) + f(u_R)}{2} + \\dots$. A widely used form, derived correctly, is actually $\\hat{f}^{ec}(u_L, u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6}$. Let's re-derive. The potential function $\\psi(u)$ is defined as $v(u)f(u)-q(u) = u \\cdot \\frac{1}{2}u^2 - \\frac{1}{3}u^3 = \\frac{1}{6}u^3$. The EC flux is $\\hat{f}^{ec}(u_L, u_R)=\\frac{\\psi_R-\\psi_L}{v_R-v_L} = \\frac{\\frac{1}{6}u_R^3-\\frac{1}{6}u_L^3}{u_R-u_L} = \\frac{1}{6}(u_L^2+u_L u_R+u_R^2)$. This is consistent: $\\hat{f}^{ec}(u,u) = \\frac{3u^2}{6} = \\frac{1}{2}u^2 = f(u)$. My initial derivation resulted in an inconsistent flux, which is a critical flaw. The corrected flux is used henceforth.\n\nCorrect EC Flux:\n$$\n\\hat{f}^{\\,ec}(u_L, u_R) = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2).\n$$\n\n**2. Entropy-Stable (ES) Flux**\n\nTo capture shocks correctly, we must introduce entropy dissipation. An entropy-stable flux $\\hat{f}^{\\,es}$ is formed by adding a numerical dissipation term to the EC flux. The added term must be symmetric and act in the direction of the entropy variable jump, $\\llbracket v \\rrbracket = v_R - v_L$:\n$$\n\\hat{f}^{\\,es}(u_L, u_R) = \\hat{f}^{\\,ec}(u_L, u_R) - \\frac{1}{2} D(u_L, u_R) (v_R - v_L),\n$$\nwhere $D(u_L, u_R) \\ge 0$ is a scalar dissipation coefficient. For consistency with the conservation law, the dissipation must be proportional to the jump in state, which is guaranteed here since it's proportional to the jump in entropy variables. A standard choice, which ensures stability, is based on the wave speeds of the system:\n$$\nD(u_L, u_R) = \\alpha \\max(|f'(u_L)|, |f'(u_R)|) = \\alpha \\max(|u_L|, |u_R|),\n$$\nwhere $\\alpha \\ge 0$ is a scaling parameter. With $v(u)=u$, the ES flux is:\n$$\n\\hat{f}^{\\,es}(u_L, u_R) = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2) - \\frac{1}{2} \\alpha \\max(|u_L|, |u_R|) (u_R - u_L).\n$$\n\n**3. Discrete Entropy Production**\n\nThe numerical entropy production at the interface between states $u_L$ and $u_R$ is defined as the amount by which the entropy conservation condition is violated:\n$$\np(u_L, u_R) := (v_R - v_L) \\hat{f}^{\\,es}(u_L, u_R) - (q_R - q_L).\n$$\nEntropy stability requires this production term to be non-positive, i.e., $p \\le 0$, which corresponds to entropy dissipation. The problem implicitly defines production $p_{i+1/2}$ as a non-negative quantity, suggesting a sign convention difference. Let's define the production rate as $P_{i+1/2} = -p(u_i, u_{i+1})$, so we must show $P_{i+1/2} \\ge 0$.\n$$\nP(u_L, u_R) = (q_R - q_L) - (v_R - v_L) \\hat{f}^{\\,es}(u_L, u_R).\n$$\nSubstitute the definition of the ES flux:\n$$\nP(u_L, u_R) = (q_R - q_L) - (v_R - v_L) \\left[ \\hat{f}^{\\,ec}(u_L, u_R) - \\frac{1}{2} D(u_L, u_R) (v_R - v_L) \\right].\n$$\n$$\nP(u_L, u_R) = \\underbrace{\\left[ (q_R - q_L) - (v_R - v_L) \\hat{f}^{\\,ec}(u_L, u_R) \\right]}_{=0 \\text{ by EC property}} + \\frac{1}{2} D(u_L, u_R) (v_R - v_L)^2.\n$$\nThis gives the per-interface entropy production rate explicitly:\n$$\np_{i+1/2} \\equiv P(u_i, u_{i+1}) = \\frac{1}{2} D(u_i, u_{i+1}) (v_{i+1} - v_i)^2.\n$$\nSubstituting our choices for $D$ and $v$:\n$$\np_{i+1/2} = \\frac{1}{2} \\alpha \\max(|u_i|, |u_{i+1}|) (u_{i+1} - u_i)^2.\n$$\nSince $\\alpha \\ge 0$, $\\max(|u_i|, |u_{i+1}|) \\ge 0$, and $(u_{i+1} - u_i)^2 \\ge 0$, it is proven that the per-interface production $p_{i+1/2}$ is non-negative. Production is strictly positive only if $\\alpha > 0$, $u_i \\ne u_{i+1}$, and at least one of $u_i, u_{i+1}$ is non-zero.\n\n**4. Semi-Discrete Entropy Rate**\n\nThe total discrete entropy is $E = \\sum_{i=0}^{N-1} \\Delta x\\, \\eta(u_i)$. Its rate of change is:\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\Delta x \\frac{d\\eta(u_i)}{dt} = \\sum_{i=0}^{N-1} \\Delta x\\, v_i \\frac{du_i}{dt}.\n$$\nThis is the expression provided in the problem statement. By substituting the semi-discrete scheme and applying summation-by-parts on the periodic grid, we can relate this to the entropy production.\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\Delta x\\, v_i \\left( -\\frac{1}{\\Delta x}(\\hat{f}^{\\,es}_{i+\\frac{1}{2}} - \\hat{f}^{\\,es}_{i-\\frac{1}{2}}) \\right) = -\\sum_{i=0}^{N-1} v_i (\\hat{f}^{\\,es}_{i+\\frac{1}{2}} - \\hat{f}^{\\,es}_{i-\\frac{1}{2}}).\n$$\nUsing summation-by-parts (noting that on a periodic domain $\\sum a_i(b_{i+1}-b_i) = -\\sum b_i(a_i-a_{i-1})$), we transform the sum:\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\hat{f}^{\\,es}_{i+\\frac{1}{2}} (v_{i+1} - v_i).\n$$\nFrom the definition of $p_{i+1/2}$, we have $(v_{i+1} - v_i) \\hat{f}^{\\,es}_{i+1/2} = (q_{i+1} - q_i) - p_{i+1/2}$. Substituting this into the sum:\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\left( (q_{i+1} - q_i) - p_{i+1/2} \\right) = \\sum_{i=0}^{N-1} (q_{i+1} - q_i) - \\sum_{i=0}^{N-1} p_{i+1/2}.\n$$\nThe first term on the right is a telescoping sum on a periodic grid, $\\sum_{i=0}^{N-1} (q_{i+1} - q_i) = q_N - q_0$. Due to periodicity, $u_N=u_0$ and thus $q_N=q_0$, making this sum zero. This leaves the final relationship:\n$$\n\\frac{d}{dt}\\left(\\sum_{i=0}^{N-1} \\Delta x \\,\\eta(u_i)\\right) = - \\sum_{i=0}^{N-1} p_{i+1/2}.\n$$\nSince we proved $p_{i+1/2} \\ge 0$, the total entropy rate $\\frac{dE}{dt}$ is non-positive, satisfying the discrete entropy inequality. If $\\alpha=0$ (no dissipation), then all $p_{i+1/2}=0$, and the entropy rate is zero, meaning the scheme is entropy-conservative (and thus kinetic-energy-preserving).\nThe implementation will now compute these quantities for the specified test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and tests an entropy-stable scheme for the 1D Burgers' equation.\n    \"\"\"\n    \n    test_cases = [\n        {'id': 'A', 'N': 128, 'uL': 1.0, 'uR': -1.0, 'alpha': 1.0, 'L': 2.0},\n        {'id': 'B', 'N': 128, 'uL': 1.0, 'uR': -1.0, 'alpha': 0.0, 'L': 2.0},\n        {'id': 'C', 'N': 4,   'uL': 1.0, 'uR': -1.0, 'alpha': 1.0, 'L': 2.0}\n    ]\n\n    all_results = {}\n    tolerance = 1e-14\n\n    for params in test_cases:\n        test_id = params['id']\n        N = params['N']\n        uL = params['uL']\n        uR = params['uR']\n        alpha = params['alpha']\n        L = params['L']\n\n        # 1. Grid and Initial Condition\n        dx = L / N\n        x = -L / 2 + (np.arange(N) + 0.5) * dx\n        u = np.where(x < 0, uL, uR)\n\n        # 2. Define entropy pair and flux\n        # Entropy variable: v(u) = u\n        # Entropy flux: q(u) = u^3 / 3\n        # In this specific case, u is the state and the entropy variable.\n        v = u\n\n        # 3. Compute numerical fluxes and per-interface production\n        f_hat_es = np.zeros(N)\n        p = np.zeros(N)\n        \n        for i in range(N):\n            u_i = u[i]\n            u_ip1 = u[(i + 1) % N]\n            \n            # Entropy-conservative flux\n            f_hat_ec = (u_i**2 + u_i * u_ip1 + u_ip1**2) / 6.0\n            \n            # Dissipation term\n            # D = alpha * max(|f'(u_L)|, |f'(u_R)|) = alpha * max(|u_L|, |u_R|)\n            D = alpha * max(abs(u_i), abs(u_ip1))\n            \n            # Entropy-stable flux at interface i+1/2\n            v_i = u_i\n            v_ip1 = u_ip1\n            f_hat_es[i] = f_hat_ec - 0.5 * D * (v_ip1 - v_i)\n            \n            # Per-interface entropy production p_{i+1/2}\n            # p = 0.5 * D * (v_{i+1} - v_i)^2\n            p[i] = 0.5 * D * (v_ip1 - v_i)**2\n\n        # 4. Compute semi-discrete time derivative du/dt\n        dudt = np.zeros(N)\n        for i in range(N):\n            f_hat_plus = f_hat_es[i]\n            f_hat_minus = f_hat_es[(i - 1 + N) % N]\n            dudt[i] = -(f_hat_plus - f_hat_minus) / dx\n\n        # 5. Compute total semi-discrete entropy rate\n        # S_dot = integral(eta_t dx) = integral(v * u_t dx)\n        # S_dot_discrete = sum(dx * v_i * du_i/dt)\n        total_entropy_rate = dx * np.sum(v * dudt)\n        \n        # 6. Perform verifications based on test case ID\n        if test_id == 'A':\n            # 1) Non-negativity of entropy production\n            all_results['A_nonneg'] = np.all(p >= -tolerance)\n            # 2) Localization of production to shock interfaces\n            # For this IC, shocks are at x=0 and periodic boundary.\n            # Only two interfaces should have non-zero production.\n            positive_production_count = np.sum(p > tolerance)\n            all_results['A_localized'] = (positive_production_count == 2)\n        \n        elif test_id == 'B':\n            # With alpha=0, scheme is EC, entropy/energy must be conserved.\n            # Total entropy rate must be zero.\n            all_results['B_energy_preserved'] = (abs(total_entropy_rate) < tolerance)\n\n        elif test_id == 'C':\n            # 1) Non-negativity of entropy production\n            all_results['C_nonneg'] = np.all(p >= -tolerance)\n            # 2) Localization on a coarse grid\n            positive_production_count = np.sum(p > tolerance)\n            all_results['C_localized'] = (positive_production_count == 2)\n\n    # 7. Format final output\n    ordered_results = [\n        all_results['A_nonneg'],\n        all_results['A_localized'],\n        all_results['B_energy_preserved'],\n        all_results['C_nonneg'],\n        all_results['C_localized']\n    ]\n\n    print(f\"[{','.join(map(str, ordered_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The principles of entropy stability generalize to complex systems like the compressible Euler equations, where they are often formulated to preserve a related invariant: kinetic energy. This exercise transitions from the scalar Burgers' equation to this fundamental system of gas dynamics, focusing on a Kinetic-Energy-Preserving (KEP) scheme . Rather than building the scheme, your task is to numerically verify its properties by computing the discrete kinetic energy budget, confirming that the convective terms are perfectly non-dissipative. This practice demonstrates how these advanced formulations maintain physical fidelity in simulations of complex flows, such as those involving turbulence and acoustics.",
            "id": "3999356",
            "problem": "Consider the one-dimensional compressible Euler equations on a periodic domain of length $L = 2\\pi$ (angle unit in radians), written in nondimensional form for density $\\,\\rho(x,t)\\,$, velocity $\\,u(x,t)\\,$, and pressure $\\,p(x,t)\\,$ with the ratio of specific heats $\\,\\gamma = 1.4\\,$. We focus on the semidiscrete momentum equation with a kinetic-energy-preserving (KEP) split form for the nonlinear convective flux and a linear numerical viscosity. The semidiscrete momentum equation is\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}(\\rho u) = -\\mathcal{C}_m(\\rho,u) - D p + D\\left(\\mu D u\\right),\n$$\nwhere $\\,D\\,$ is a discrete periodic central-difference derivative operator satisfying the Summation-By-Parts (SBP) property, $\\,\\mu\\,$ is a constant numerical viscosity coefficient, and $\\,\\mathcal{C}_m(\\rho,u)\\,$ is the KEP split-form discretization of the convective term $\\,\\partial_x(\\rho u^2)\\,$. The discrete derivative operator $\\,D\\,$ on a uniform grid with $\\,N\\,$ points and spacing $\\,\\Delta x = L/N\\,$ is defined by\n$$\n(D v)_i = \\frac{v_{i+1} - v_{i-1}}{2\\Delta x},\n$$\nwith periodic indexing. The SBP property is\n$$\n\\Delta x \\sum_{i=0}^{N-1} v_i (D w)_i = - \\Delta x \\sum_{i=0}^{N-1} (D v)_i w_i,\n$$\nfor all discrete grid functions $\\,v,w\\,$.\n\nThe KEP split form for the momentum convective operator is the triple-product symmetric split\n$$\n\\mathcal{C}_m(\\rho,u) = \\frac{1}{3}\\left[ D\\left(\\rho u^2\\right) + u\\, D(\\rho u) + \\rho u\\, D u \\right].\n$$\nDefine the discrete kinetic energy\n$$\nK = \\Delta x \\sum_{i=0}^{N-1} \\frac{1}{2}\\rho_i u_i^2.\n$$\nUsing the SBP property and the above split form, the exact discrete kinetic-energy budget reads\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = - \\Delta x \\sum_{i=0}^{N-1} u_i (D p)_i \\;-\\; \\Delta x \\sum_{i=0}^{N-1} \\mu \\left(D u\\right)_i^2,\n$$\nwhich shows exact transport (no spurious change of kinetic energy due to convective discretization) and controlled dissipation due to numerical viscosity (negative semidefinite contribution).\n\nYour task is to implement a program that, for given discrete fields $\\,\\rho, u, p\\,$, computes three quantitative diagnostics of the discrete kinetic-energy budget:\n\n1. The transport residual\n$$\nR_{\\mathrm{trans}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, \\mathcal{C}_m(\\rho,u)_i \\right|,\n$$\nwhich must be numerically near zero for an exact KEP split form and SBP derivative.\n\n2. The viscous residual\n$$\nR_{\\mathrm{visc}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, D\\left(\\mu D u\\right)_i \\;+\\; \\Delta x \\sum_{i=0}^{N-1} \\mu \\left(D u\\right)_i^2 \\right|,\n$$\nwhich must be numerically near zero, verifying that the numerical viscosity contributes a negative semidefinite dissipation to the kinetic-energy rate.\n\n3. The full budget residual\n$$\nR_{\\mathrm{budget}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i \\left(-\\mathcal{C}_m(\\rho,u)_i - (D p)_i + D(\\mu D u)_i \\right) \\;-\\; \\left( - \\Delta x \\sum_{i=0}^{N-1} u_i (D p)_i \\;-\\; \\Delta x \\sum_{i=0}^{N-1} \\mu (D u)_i^2 \\right) \\right|,\n$$\nwhich must be numerically near zero, verifying that the assembled semidiscrete right-hand side matches the exact discrete kinetic-energy budget.\n\nAll quantities are nondimensional. Angles are in radians. No physical units are required.\n\nImplement the above on the periodic domain $[0,2\\pi)$ with the following test suite of initial conditions, each representing a distinct compressible, spatially varying state mimicking features of decaying compressible turbulence:\n\n- Test case 1 (general multimode fluctuations, \"happy path\"):\n    - $N = 128$\n    - $\\mu = 5\\times 10^{-3}$\n    - $x_i = i \\Delta x$, $\\,\\Delta x = 2\\pi/N$\n    - $\\rho(x) = 1 + 0.20 \\sin(x) + 0.10 \\sin(7x)$\n    - $u(x) = 0.50 \\sin(2x) + 0.20 \\cos(3x) + 0.10 \\sin(5x)$\n    - $p(x) = 1 + 0.10 \\cos(x) + 0.05 \\sin(5x) + 0.03 \\cos(7x)$\n\n- Test case 2 (constant state, boundary condition check):\n    - $N = 128$\n    - $\\mu = 5\\times 10^{-3}$\n    - $\\rho(x) = 1$\n    - $u(x) = 0$\n    - $p(x) = 1$\n\n- Test case 3 (stronger compressibility and gradients, edge case):\n    - $N = 257$\n    - $\\mu = 1\\times 10^{-2}$\n    - $x_i = i \\Delta x$, $\\,\\Delta x = 2\\pi/N$\n    - $\\rho(x) = 1 + 0.50 \\sin(x) + 0.25 \\sin(4x)$\n    - $u(x) = 0.70 \\sin(3x) + 0.50 \\cos(2x)$\n    - $p(x) = 1 + 0.20 \\cos(2x) + 0.10 \\sin(6x)$\n\nYour program must compute, for each test case, the three residuals $\\,R_{\\mathrm{trans}}, R_{\\mathrm{visc}}, R_{\\mathrm{budget}}\\,$ as floating-point numbers. The final output format must be a single line containing a list of three-element lists, one per test case, in the order given above. For example,\n$$\n\\text{[ [}R_{\\mathrm{trans}}^{(1)}, R_{\\mathrm{visc}}^{(1)}, R_{\\mathrm{budget}}^{(1)}\\text{], [}R_{\\mathrm{trans}}^{(2)}, R_{\\mathrm{visc}}^{(2)}, R_{\\mathrm{budget}}^{(2)}\\text{], [}R_{\\mathrm{trans}}^{(3)}, R_{\\mathrm{visc}}^{(3)}, R_{\\mathrm{budget}}^{(3)}\\text{] ]}\n$$\nwith no additional text. All residuals must be computed using the discrete SBP inner product $\\,\\Delta x \\sum\\,$ defined above and must be reported as plain decimal numbers (no percentage signs). The numerical results should be close to zero (to within machine precision) for exact preservation or exact dissipation identities, but your program must still output the computed residual values as-is and not round them to zero.",
            "solution": "The problem requires the implementation and verification of the properties of a semidiscrete scheme for the one-dimensional compressible momentum equation. The verification is performed by computing three residuals related to the discrete kinetic-energy budget. The provided scheme uses a periodic central-difference operator that satisfies the Summation-By-Parts (SBP) property and a specific split-form for the convective term designed to be Kinetic-Energy-Preserving (KEP).\n\nFirst, we establish the computational framework. The domain is a periodic interval $[0, 2\\pi)$ discretized with $N$ uniformly spaced points $x_i = i \\Delta x$ for $i=0, 1, \\dots, N-1$, where $\\Delta x = 2\\pi/N$. A discrete function $v$ is represented as a vector of its values $v_i = v(x_i)$ at these grid points.\n\nThe core of the discretization is the periodic central-difference operator $D$, defined as\n$$\n(D v)_i = \\frac{v_{i+1} - v_{i-1}}{2\\Delta x}\n$$\nThe indices are periodic, meaning $v_{N} = v_0$ and $v_{-1} = v_{N-1}$. This operator possesses the Summation-By-Parts (SBP) property, which is a discrete analogue of integration by parts. For any two periodic grid functions $v$ and $w$, the SBP property states:\n$$\n\\Delta x \\sum_{i=0}^{N-1} v_i (D w)_i = - \\Delta x \\sum_{i=0}^{N-1} (D v)_i w_i\n$$\nThis property is crucial for deriving discrete conservation laws that mimic their continuous counterparts. In our implementation, we can efficiently compute the action of $D$ on a vector representing a grid function using array-shifting operations, specifically `np.roll` in NumPy, which naturally handles periodic boundaries.\n\nThe semidiscrete momentum equation is given as:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}(\\rho u) = -\\mathcal{C}_m(\\rho,u) - D p + D\\left(\\mu D u\\right)\n$$\nWe analyze the contribution of each term on the right-hand side to the rate of change of the total discrete kinetic energy, $K = \\Delta x \\sum_{i=0}^{N-1} \\frac{1}{2}\\rho_i u_i^2$. The analysis relies on forming the discrete inner product of the right-hand side with the velocity $u$.\n\n**1. Convective Term and Transport Residual, $R_{\\mathrm{trans}}$**\n\nThe convective term is discretized using a specific Kinetic-Energy-Preserving (KEP) split form:\n$$\n\\mathcal{C}_m(\\rho,u) = \\frac{1}{3}\\left[ D\\left(\\rho u^2\\right) + u\\, D(\\rho u) + \\rho u\\, D u \\right]\n$$\nA discretization is KEP if its contribution to the kinetic energy budget is zero. This contribution is given by the inner product $-\\Delta x \\sum u_i (\\mathcal{C}_m)_i$. For this specific form, it can be shown analytically that $\\Delta x \\sum u_i (\\mathcal{C}_m)_i = 0$ in exact arithmetic. The transport residual,\n$$\nR_{\\mathrm{trans}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, \\mathcal{C}_m(\\rho,u)_i \\right|\n$$\nnumerically verifies this property. Any non-zero value should be on the order of machine floating-point precision.\n\n**2. Viscous Term and Viscous Residual, $R_{\\mathrm{visc}}$**\n\nThe numerical viscosity term is $D(\\mu D u)$. Its contribution to the kinetic energy rate is $\\Delta x \\sum u_i D(\\mu D u)_i$. Since the viscosity coefficient $\\mu$ is a constant, this is $\\mu \\Delta x \\sum u_i D(D u)_i$. Applying the SBP property once transforms this into:\n$$\n\\mu \\Delta x \\sum_{i=0}^{N-1} u_i (D(D u))_i = - \\mu \\Delta x \\sum_{i=0}^{N-1} (D u)_i (D u)_i = - \\Delta x \\sum_{i=0}^{N-1} \\mu (D u)_i^2\n$$\nThis final term is manifestly negative semidefinite, representing a physical dissipation of kinetic energy. The viscous residual,\n$$\nR_{\\mathrm{visc}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, D\\left(\\mu D u\\right)_i \\;+\\; \\Delta x \\sum_{i=0}^{N-1} \\mu \\left(D u\\right)_i^2 \\right|\n$$\nis designed to be exactly zero in discrete arithmetic, thereby confirming that our implementation of the viscous operator and the SBP property are consistent. A non-zero value would indicate an implementation error or significant floating-point accumulation.\n\n**3. Full Budget Residual, $R_{\\mathrm{budget}}$**\n\nThe full budget residual serves as an overall consistency check. It compares the kinetic energy tendency computed directly from the full right-hand side of the momentum equation with the theoretically derived expression for the kinetic energy budget.\nLet the momentum equation's right-hand side be $\\mathcal{F} = -\\mathcal{C}_m - D p + D(\\mu D u)$. The kinetic energy tendency is $\\Delta x \\sum u_i \\mathcal{F}_i$.\nThe theoretical budget is $\\mathcal{B} = - \\Delta x \\sum u_i (D p)_i - \\Delta x \\sum \\mu (D u)_i^2$.\nThe residual is defined as $R_{\\mathrm{budget}} = \\left| \\Delta x \\sum u_i \\mathcal{F}_i - \\mathcal{B} \\right|$.\nSubstituting the expressions for $\\mathcal{F}$ and $\\mathcal{B}$ and simplifying, we find:\n$$\nR_{\\mathrm{budget}} = \\left| \\left( \\Delta x \\sum u_i D(\\mu D u)_i + \\Delta x \\sum \\mu (D u)_i^2 \\right) - \\left( \\Delta x \\sum u_i \\mathcal{C}_m \\right) \\right|\n$$\nThis shows that $R_{\\mathrm{budget}}$ is the magnitude of the difference between the un-abs'd values of the viscous and transport residual terms. If both $R_{\\mathrm{trans}}$ and $R_{\\mathrm{visc}}$ are near zero, $R_{\\mathrm{budget}}$ must also be near zero, confirming the self-consistency of the entire numerical formulation and its implementation.\n\nThe algorithm proceeds by iterating through each test case. For each case, it sets up the grid and initial fields $\\rho, u, p$. It then computes the operators $\\mathcal{C}_m$ and $D$, and assembles the three residuals according to their definitions. All vector operations are performed using NumPy for efficiency.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes kinetic-energy budget residuals for a semidiscrete momentum equation\n    for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 128, \"mu\": 5e-3,\n            \"rho_func\": lambda x: 1 + 0.20 * np.sin(x) + 0.10 * np.sin(7*x),\n            \"u_func\": lambda x: 0.50 * np.sin(2*x) + 0.20 * np.cos(3*x) + 0.10 * np.sin(5*x),\n            \"p_func\": lambda x: 1 + 0.10 * np.cos(x) + 0.05 * np.sin(5*x) + 0.03 * np.cos(7*x)\n        },\n        {\n            \"N\": 128, \"mu\": 5e-3,\n            \"rho_func\": lambda x: np.ones_like(x),\n            \"u_func\": lambda x: np.zeros_like(x),\n            \"p_func\": lambda x: np.ones_like(x)\n        },\n        {\n            \"N\": 257, \"mu\": 1e-2,\n            \"rho_func\": lambda x: 1 + 0.50 * np.sin(x) + 0.25 * np.sin(4*x),\n            \"u_func\": lambda x: 0.70 * np.sin(3*x) + 0.50 * np.cos(2*x),\n            \"p_func\": lambda x: 1 + 0.20 * np.cos(2*x) + 0.10 * np.sin(6*x)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # 1. Setup grid and discrete fields\n        N = case[\"N\"]\n        mu = case[\"mu\"]\n        L = 2 * np.pi\n        dx = L / N\n        x = np.arange(N) * dx\n\n        rho = case[\"rho_func\"](x)\n        u = case[\"u_func\"](x)\n        p = case[\"p_func\"](x)\n\n        # 2. Define the discrete periodic central-difference operator D\n        def D(v):\n            \"\"\"Computes the SBP-compatible central difference on a periodic grid.\"\"\"\n            return (np.roll(v, -1) - np.roll(v, 1)) / (2 * dx)\n\n        # 3. Compute terms for the residuals\n        \n        # Convective operator C_m\n        rho_u2 = rho * u**2\n        rho_u = rho * u\n        D_rho_u2 = D(rho_u2)\n        D_rho_u = D(rho_u)\n        D_u = D(u)\n        Cm = (1/3) * (D_rho_u2 + u * D_rho_u + rho_u * D_u)\n\n        # Dissipative operator term D(mu*D(u))\n        D_Du = D(D_u)\n        visc_term_mom_eq = mu * D_Du\n        \n        # 4. Compute the residuals\n        \n        # R_trans: Transport residual\n        # This term should be zero in exact arithmetic for a KEP scheme.\n        val_trans = dx * np.sum(u * Cm)\n        R_trans = np.abs(val_trans)\n\n        # R_visc: Viscous residual\n        # This term should be zero in exact arithmetic, verifying SBP for the viscous term.\n        val_visc = dx * np.sum(u * visc_term_mom_eq) + dx * np.sum(mu * D_u**2)\n        R_visc = np.abs(val_visc)\n\n        # R_budget: Full budget residual\n        # This combines the two checks above.\n        # R_budget = | val_visc - val_trans |\n        # As derived in the solution text, the pressure terms cancel.\n        R_budget = np.abs(val_visc - val_trans)\n        \n        results.append([R_trans, R_visc, R_budget])\n\n    # Final print statement in the exact required format.\n    # repr() produces a string representation that matches the format, including spaces.\n    print(repr(results))\n\nsolve()\n```"
        }
    ]
}