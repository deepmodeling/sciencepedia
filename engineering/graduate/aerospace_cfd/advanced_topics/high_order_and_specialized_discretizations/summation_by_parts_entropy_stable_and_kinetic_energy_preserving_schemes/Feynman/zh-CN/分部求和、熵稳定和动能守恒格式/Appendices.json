{
    "hands_on_practices": [
        {
            "introduction": "在高阶数值方法中，例如那些使用多项式基函数的方法，非线性项的处理是一个核心挑战。当天真地计算一个非线性通量（如对流项）时，会产生“混淆误差”（aliasing error）。这是因为两个 $N$ 阶多项式的乘积是一个 $2N$ 阶的多项式，其产生的高阶模态无法在原有的 $N$ 阶多项式空间中被精确表示。这个练习将通过一个基于第一性原理的具体计算，帮助你深入理解混淆误差的来源，并通过量化该误差，让你认识到为何需要发展特殊的“分裂形式”或“去混淆”离散格式来保证高阶格式的稳定性。",
            "id": "3999352",
            "problem": "考虑一维标量守恒律，其具有纯对流通量，例如由 $u_{t} + \\partial_{x} f(u) = 0$ 给出的无粘性Burgers方程，其中 $f(u) = \\tfrac{1}{2} u^{2}$。在采用分部求和（SBP）算子和多项式模态基的高阶单元法中，会产生非线性混叠现象，因为非线性通量 $f(u)$ 的多项式次数通常高于离散状态 $u$，导致未能解析的高频内容被截断或错误表示。在熵稳定和动能守恒的分裂形式离散化中，通过重构非线性运算来缓解此现象。相比之下，将 $f(u)$ 朴素地多项式投影到次数为 $N$ 的空间上会丢弃所有次数高于 $N$ 的内容；$f(u)$ 中次数高于 $N$ 的部分是截断余项，其 $L^{2}$ 能量可以量化模态混叠。\n\n考虑单个参考单元 $x \\in [-1,1]$，使用标准勒让德（Legendre）多项式基 $\\{P_{n}(x)\\}_{n=0}^{\\infty}$，其中当 $m \\neq n$ 时 $\\int_{-1}^{1} P_{m}(x) P_{n}(x) \\, dx = 0$，且 $\\int_{-1}^{1} P_{n}^{2}(x) \\, dx = \\tfrac{2}{2n+1}$。设离散状态的次数为 $N=2$，\n$$\nu(x) = \\alpha \\, P_{1}(x) + \\beta \\, P_{2}(x),\n$$\n其中 $\\alpha$ 和 $\\beta$ 为实系数。那么非线性通量 $f(u) = \\tfrac{1}{2}u^{2}$ 是一个4次多项式。定义 $f(u)$ 在2次空间 $\\mathcal{P}_{2} = \\mathrm{span}\\{P_{0}, P_{1}, P_{2}\\}$ 上的 $L^{2}$ 投影为\n$$\n\\Pi_{\\le 2} f(u) = \\sum_{n=0}^{2} c_{n} P_{n}(x), \\quad c_{n} = \\frac{\\int_{-1}^{1} f(u(x)) P_{n}(x) \\, dx}{\\int_{-1}^{1} P_{n}^{2}(x) \\, dx}。\n$$\n设截断（混叠）误差为 $E(x) = f(u(x)) - \\Pi_{\\le 2} f(u(x))$，该误差完全位于 $\\{P_{3}, P_{4}\\}$ 的张成空间内。从第一性原理出发，推导在此设置下非线性混叠是如何产生的，然后使用勒让德基和在 $[-1,1]$ 上的精确积分，计算截断误差的 $L^{2}$ 范数平方的闭式解析表达式，\n$$\n\\|E\\|_{L^{2}([-1,1])}^{2} = \\int_{-1}^{1} E^{2}(x) \\, dx,\n$$\n该表达式用 $\\alpha$ 和 $\\beta$ 表示。将最终答案表示为单一的简化解析表达式。无需进行数值取整，且不涉及物理单位。",
            "solution": "该问题陈述经证实具有科学依据、是适定且客观的。它提出了一个偏微分方程数值分析中的标准问题，特别是在谱方法背景下评估非线性项产生的混叠误差。所有提供的信息都充分且一致，足以推导出一个唯一的解析解。\n\n问题的核心在于理解非线性运算如何产生无法在给定的有限维多项式空间中表示的更高频率内容，从而导致混叠误差。给定一个属于次数为 $N$ 的多项式空间的离散状态 $u(x)$，该状态的非线性函数，如 $f(u(x)) = \\frac{1}{2}u(x)^2$，通常会是一个次数更高的多项式。具体来说，如果 $u(x)$ 是一个 $N$ 次多项式，那么 $u(x)^2$ 就是一个 $2N$ 次多项式。在一个只能表示最高 $N$ 次多项式的离散框架下工作时，这些更高次数的内容必须被截断或投影。此过程产生的误差称为混叠误差或截断误差。本问题要求我们针对一个具体情况，在 $L^2$ 意义下量化此误差。\n\n离散状态 $u(x)$ 在参考单元 $x \\in [-1,1]$ 上被给定为次数 $N=2$ 的多项式：\n$$\nu(x) = \\alpha \\, P_{1}(x) + \\beta \\, P_{2}(x)\n$$\n其中 $\\alpha$ 和 $\\beta$ 是实系数，$P_n(x)$ 是勒让德多项式。非线性通量函数为 $f(u) = \\frac{1}{2}u^2$。因此，通量为：\n$$\nf(u(x)) = \\frac{1}{2} \\left[ \\alpha P_{1}(x) + \\beta P_{2}(x) \\right]^2 = \\frac{1}{2} \\left[ \\alpha^2 P_{1}(x)^2 + 2\\alpha\\beta P_{1}(x)P_{2}(x) + \\beta^2 P_{2}(x)^2 \\right]\n$$\n由于 $P_1(x)$ 是1次多项式，$P_2(x)$ 是2次多项式，因此 $f(u(x))$ 中的最高次项来自 $P_2(x)^2$，使得 $f(u(x))$ 成为一个4次多项式。\n\n为了计算投影和误差，我们必须将 $f(u(x))$ 表示为勒让德多项式的线性组合，即形式为 $f(u(x)) = \\sum_{n=0}^{4} d_n P_n(x)$。这需要将勒让德多项式的乘积展开到勒让德基上。所需的乘积展开公式如下：\n\\begin{enumerate}\n    \\item $P_1(x)^2$：$P_1(x) = x$。因此，$P_1(x)^2 = x^2$。前几个勒让德多项式是 $P_0(x) = 1$ 和 $P_2(x) = \\frac{1}{2}(3x^2 - 1)$。从 $P_2(x)$ 我们可以写出 $x^2 = \\frac{2}{3}P_2(x) + \\frac{1}{3}P_0(x)$。所以，$P_1(x)^2 = \\frac{1}{3}P_0(x) + \\frac{2}{3}P_2(x)$。\n    \\item $P_1(x)P_2(x)$：使用 $n=2$ 的一般递推关系 $x P_n(x) = \\frac{n+1}{2n+1}P_{n+1}(x) + \\frac{n}{2n+1}P_{n-1}(x)$，可得 $P_1(x)P_2(x) = x P_2(x) = \\frac{3}{5}P_3(x) + \\frac{2}{5}P_1(x)$。\n    \\item $P_2(x)^2$：我们使用幂次表示。我们已得到 $x^2 = \\frac{2}{3}P_2(x) + \\frac{1}{3}P_0(x)$。我们还需要 $x^4$。$P_4(x) = \\frac{1}{8}(35x^4 - 30x^2 + 3)$。整理可得 $x^4 = \\frac{8}{35}P_4(x) + \\frac{6}{7}x^2 - \\frac{3}{35}$。代入 $x^2$ 的表达式：$x^4 = \\frac{8}{35}P_4(x) + \\frac{6}{7}(\\frac{2}{3}P_2(x) + \\frac{1}{3}P_0(x)) - \\frac{3}{35}P_0(x) = \\frac{8}{35}P_4(x) + \\frac{4}{7}P_2(x) + \\frac{1}{5}P_0(x)$。现在我们展开 $P_2(x)^2 = (\\frac{1}{2}(3x^2-1))^2 = \\frac{9}{4}x^4 - \\frac{3}{2}x^2 + \\frac{1}{4}$。代入 $x^4$ 和 $x^2$ 的勒让德展开式：\n    $$\n    P_2(x)^2 = \\frac{9}{4}\\left(\\frac{8}{35}P_4 + \\frac{4}{7}P_2 + \\frac{1}{5}P_0\\right) - \\frac{3}{2}\\left(\\frac{2}{3}P_2 + \\frac{1}{3}P_0\\right) + \\frac{1}{4}P_0 = \\frac{18}{35}P_4(x) + \\frac{2}{7}P_2(x) + \\frac{1}{5}P_0(x).\n    $$\n\\end{enumerate}\n\n将这些展开式代回 $f(u(x))$ 的表达式中：\n$$\nf(u(x)) = \\frac{1}{2} \\left[ \\alpha^2 \\left( \\frac{1}{3}P_0 + \\frac{2}{3}P_2 \\right) + 2\\alpha\\beta \\left( \\frac{2}{5}P_1 + \\frac{3}{5}P_3 \\right) + \\beta^2 \\left( \\frac{1}{5}P_0 + \\frac{2}{7}P_2 + \\frac{18}{35}P_4 \\right) \\right]\n$$\n我们按勒让德多项式的阶数对各项进行分组：\n$$\nf(u(x)) = \\left(\\frac{\\alpha^2}{6} + \\frac{\\beta^2}{10}\\right)P_0(x) + \\left(\\frac{2\\alpha\\beta}{5}\\right)P_1(x) + \\left(\\frac{\\alpha^2}{3} + \\frac{\\beta^2}{7}\\right)P_2(x) + \\left(\\frac{3\\alpha\\beta}{5}\\right)P_3(x) + \\left(\\frac{9\\beta^2}{35}\\right)P_4(x)\n$$\n这是 $f(u(x))$ 的完整勒让德级数展开。$f(u(x))$ 在空间 $\\mathcal{P}_2 = \\mathrm{span}\\{P_0, P_1, P_2\\}$ 上的 $L^2$ 投影，记为 $\\Pi_{\\le 2} f(u)$，由次数不高于2的项组成：\n$$\n\\Pi_{\\le 2} f(u) = \\left(\\frac{\\alpha^2}{6} + \\frac{\\beta^2}{10}\\right)P_0(x) + \\left(\\frac{2\\alpha\\beta}{5}\\right)P_1(x) + \\left(\\frac{\\alpha^2}{3} + \\frac{\\beta^2}{7}\\right)P_2(x)\n$$\n截断误差 $E(x)$ 是级数的余项，它包含高阶项：\n$$\nE(x) = f(u(x)) - \\Pi_{\\le 2} f(u(x)) = \\left(\\frac{3\\alpha\\beta}{5}\\right)P_3(x) + \\left(\\frac{9\\beta^2}{35}\\right)P_4(x)\n$$\n我们需要计算该误差的 $L^2$ 范数的平方，即 $\\|E\\|_{L^2}^2 = \\int_{-1}^{1} E(x)^2 \\, dx$。\n$$\n\\|E\\|_{L^2}^2 = \\int_{-1}^{1} \\left[ \\left(\\frac{3\\alpha\\beta}{5}\\right)P_3(x) + \\left(\\frac{9\\beta^2}{35}\\right)P_4(x) \\right]^2 \\, dx\n$$\n由于勒让德多项式的正交性，当 $m \\neq n$ 时 $\\int_{-1}^{1} P_m(x) P_n(x) \\, dx = 0$。展开平方后，交叉项积分 $\\int_{-1}^{1} P_3(x)P_4(x) \\, dx$ 为零。因此，范数的平方是各个分量范数平方的和：\n$$\n\\|E\\|_{L^2}^2 = \\left(\\frac{3\\alpha\\beta}{5}\\right)^2 \\int_{-1}^{1} P_3(x)^2 \\, dx + \\left(\\frac{9\\beta^2}{35}\\right)^2 \\int_{-1}^{1} P_4(x)^2 \\, dx\n$$\n使用给定的归一化性质 $\\int_{-1}^{1} P_n(x)^2 \\, dx = \\frac{2}{2n+1}$：\n$$\n\\int_{-1}^{1} P_3(x)^2 \\, dx = \\frac{2}{2(3)+1} = \\frac{2}{7}\n$$\n$$\n\\int_{-1}^{1} P_4(x)^2 \\, dx = \\frac{2}{2(4)+1} = \\frac{2}{9}\n$$\n将这些值代回 $\\|E\\|_{L^2}^2$ 的表达式中：\n$$\n\\|E\\|_{L^2}^2 = \\left(\\frac{9\\alpha^2\\beta^2}{25}\\right) \\left(\\frac{2}{7}\\right) + \\left(\\frac{81\\beta^4}{35^2}\\right) \\left(\\frac{2}{9}\\right)\n$$\n$$\n\\|E\\|_{L^2}^2 = \\frac{18\\alpha^2\\beta^2}{175} + \\frac{9 \\cdot 2 \\cdot \\beta^4}{1225} = \\frac{18\\alpha^2\\beta^2}{175} + \\frac{18\\beta^4}{1225}\n$$\n为了合并这些项，我们找到公分母，即 $1225 = 7 \\times 175$：\n$$\n\\|E\\|_{L^2}^2 = \\frac{18\\alpha^2\\beta^2 \\cdot 7}{175 \\cdot 7} + \\frac{18\\beta^4}{1225} = \\frac{126\\alpha^2\\beta^2}{1225} + \\frac{18\\beta^4}{1225}\n$$\n合并并对分子进行因式分解：\n$$\n\\|E\\|_{L^2}^2 = \\frac{126\\alpha^2\\beta^2 + 18\\beta^4}{1225} = \\frac{18\\beta^2(7\\alpha^2 + \\beta^2)}{1225}\n$$\n这就是截断误差的 $L^2$ 范数平方的最终简化闭式表达式。",
            "answer": "$$\n\\boxed{\\frac{18\\beta^2(7\\alpha^2 + \\beta^2)}{1225}}\n$$"
        },
        {
            "introduction": "理解了混淆误差带来的挑战后，我们自然会问：如何构建一个能够保持稳定性的数值格式？一种强大的方法是设计能够模拟热力学第二定律的数值通量。本练习将指导你构建一个基于 Tadmor 框架的熵稳定 (entropy-stable, ES) 格式。你将从一个熵守恒 (entropy-conservative, EC) 通量出发，然后添加一个经过精心设计的耗散项，以确保熵产非负，从而抑制由混淆效应引起的非物理振荡和不稳定性。通过为无粘伯格斯方程实现并测试此格式，你将获得构建现代、稳健的激波捕捉方法的基础实践经验。",
            "id": "3999364",
            "problem": "考虑一维标量守恒律 $u_t + f(u)_x = 0$，其定义在周期性区域 $[-L/2, L/2]$ 上，其中 $L = 2$。通量为 $f(u) = \\frac{1}{2} u^2$（无粘伯格斯方程）。采用一个包含 $N$ 个点的均匀网格，网格间距为 $\\Delta x = \\frac{L}{N}$，单元中心为 $x_i = -\\frac{L}{2} + \\left(i + \\frac{1}{2}\\right)\\Delta x$，其中整数 $i \\in \\{0,1,\\dots,N-1\\}$。使用带有对角质量矩阵的分部求和（SBP）一阶导数算子，在周期性边界条件下近似空间导数，这意味着中心差分算子相对于对角内积矩阵是反对称的。熵函数为 $\\eta(u) = \\frac{1}{2} u^2$，熵变量为 $v = \\eta'(u) = u$，熵通量为 $q(u) = \\frac{1}{3} u^3$。\n\n为伯格斯方程设计一个两点熵守恒通量 $\\hat{f}^{\\,ec}(u_L,u_R)$，并通过增加一个对称、相容的耗散项来得到一个熵稳定通量 $\\hat{f}^{\\,es}(u_L,u_R)$。该格式必须以通量差分（有限体积）形式写在周期性网格上，如下所示：\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(\\hat{f}^{\\,es}_{i+\\frac{1}{2}} - \\hat{f}^{\\,es}_{i-\\frac{1}{2}}\\right),\n$$\n其中 $\\hat{f}^{\\,es}_{i+\\frac{1}{2}} = \\hat{f}^{\\,es}(u_i,u_{i+1})$ 且指数在周期性条件下对 $N$ 取模。\n\n从熵、熵变量以及 Tadmor 的熵守恒和熵稳定通量框架的基本定义出发，推导由您的熵稳定通量所蕴含的每个界面的离散熵产生 $p_{i+\\frac{1}{2}}$，并证明其为非负，即 $p_{i+\\frac{1}{2}} \\ge 0$。然后，实现一个程序，为以下测试套件计算每个界面的熵产生 $p_{i+\\frac{1}{2}}$ 和半离散熵率\n$$\n\\frac{d}{dt}\\left(\\sum_{i=0}^{N-1} \\Delta x \\,\\eta(u_i)\\right) = \\Delta x \\sum_{i=0}^{N-1} v_i \\,\\frac{d u_i}{dt},\n$$\n\n使用以下测试套件：\n- 测试 $\\mathrm{A}$ （正常路径，激波）：$N = 128$，$u_L = 1$，$u_R = -1$，初始数据为 $u_i = u_L$（如果 $x_i  0$）和 $u_i = u_R$（其他情况），耗散标度 $\\alpha = 1$。验证：\n  $1)$ 所有 $p_{i+\\frac{1}{2}} \\ge 0$，\n  $2)$ 熵产生仅局部化于不连续处，即在周期性网格上恰好有两个界面（一个在 $x=0$，另一个在周期性边界处）具有严格正的产生。\n- 测试 $\\mathrm{B}$ （熵守恒，动能守恒）：$N = 128$，初始数据与测试 $\\mathrm{A}$ 相同，耗散标度 $\\alpha = 0$。验证总半离散熵率等于 $0$（在数值容差范围内），即离散动能守恒。\n- 测试 $\\mathrm{C}$ （边界情况，粗糙激波）：$N = 4$，初始数据与测试 $\\mathrm{A}$ 相同，耗散标度 $\\alpha = 1$。验证：\n  $1)$ 所有 $p_{i+\\frac{1}{2}} \\ge 0$，\n  $2)$ 恰好有两个界面具有严格正的产生。\n\n您的程序应产生单行输出，包含一个方括号内的逗号分隔列表。条目必须按以下顺序和类型排列：\n$[\\text{A\\_nonneg}, \\text{A\\_localized}, \\text{B\\_energy\\_preserved}, \\text{C\\_nonneg}, \\text{C\\_localized}]$，\n其中每个条目都是布尔值（$\\text{True}$ 或 $\\text{False}$）。此问题中任何量都不需要物理单位。不出现角度。不得使用百分比。\n\n用 Python 实现完整的程序，并确保它在没有任何用户输入的情况下运行，仅使用执行环境中指定的库。",
            "solution": "所述问题在科学上是合理的、适定的，并包含进行严格推导和计算验证所需的所有信息。我将开始进行解答。\n\n此问题的基础在于为一维标量守恒律\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0,\n$$\n构造一个遵循热力学第二定律离散版本的数值格式。对于无粘伯格斯方程，通量为 $f(u) = \\frac{1}{2} u^2$。该连续系统具有无穷多对熵对 $(\\eta(u), q(u))$，它们满足相容性条件 $q'(u) = \\eta'(u) f'(u)$。对于任何凸熵函数 $\\eta(u)$，精确解都满足不等式\n$$\n\\frac{\\partial \\eta(u)}{\\partial t} + \\frac{\\partial q(u)}{\\partial x} \\le 0.\n$$\n问题指定了二次熵函数 $\\eta(u) = \\frac{1}{2} u^2$，它对应于此方程的物理动能密度。相关的熵变量是 $v(u) = \\eta'(u) = u$，熵通量是 $q(u) = \\int^u v(\\xi) f'(\\xi) d\\xi = \\int^u \\xi \\cdot \\xi \\, d\\xi = \\frac{1}{3} u^3$。\n\n我们考虑在均匀周期性网格上的有限体积离散化，\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(\\hat{f}_{i+\\frac{1}{2}} - \\hat{f}_{i-\\frac{1}{2}}\\right),\n$$\n其中 $\\hat{f}_{i+\\frac{1}{2}} = \\hat{f}(u_i, u_{i+1})$ 是一个与 $f(u)$ 相容的两点数值通量函数。\n\n熵稳定格式是指能够保证熵不等式离散版本成立的格式。根据 Tadmor 提出的框架，这可以通过首先设计一个熵守恒通量，然后加入一个经过精确控制的耗散量来实现。\n\n**1. 熵守恒（EC）通量**\n\n一个两点数值通量 $\\hat{f}^{\\,ec}(u_L, u_R)$ 被定义为熵守恒的，如果它满足条件\n$$\n(v_R - v_L) \\hat{f}^{\\,ec}(u_L, u_R) - (q_R - q_L) = 0,\n$$\n其中 $v_L = v(u_L)$，$v_R = v(u_R)$，熵通量 $q$ 也类似。此条件确保数值格式在没有任何附加耗散的情况下，能够精确地守恒总离散熵 $\\sum_i \\Delta x \\eta(u_i)$。\n\n对于伯格斯方程，一个通用的对称且相容的熵守恒通量是 $\\hat{f}^{ec}(u_L, u_R) = \\frac{f(u_L) + f(u_R)}{2} + \\dots$。一个被广泛使用且正确推导出的形式实际上是 $\\hat{f}^{ec}(u_L, u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6}$。让我们重新推导。势函数 $\\psi(u)$ 定义为 $v(u)f(u)-q(u) = u \\cdot \\frac{1}{2}u^2 - \\frac{1}{3}u^3 = \\frac{1}{6}u^3$。EC 通量是 $\\hat{f}^{ec}(u_L, u_R)=\\frac{\\psi_R-\\psi_L}{v_R-v_L} = \\frac{\\frac{1}{6}u_R^3-\\frac{1}{6}u_L^3}{u_R-u_L} = \\frac{1}{6}(u_L^2+u_L u_R+u_R^2)$。这是相容的：$\\hat{f}^{ec}(u,u) = \\frac{3u^2}{6} = \\frac{1}{2}u^2 = f(u)$。\n\n修正的EC通量：\n$$\n\\hat{f}^{\\,ec}(u_L, u_R) = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2).\n$$\n\n**2. 熵稳定（ES）通量**\n\n为了正确捕捉激波，我们必须引入熵耗散。一个熵稳定通量 $\\hat{f}^{\\,es}$ 是通过在 EC 通量上添加一个数值耗散项构成的。该附加项必须是对称的，并且作用于熵变量跳跃 $\\llbracket v \\rrbracket = v_R - v_L$ 的方向：\n$$\n\\hat{f}^{\\,es}(u_L, u_R) = \\hat{f}^{\\,ec}(u_L, u_R) - \\frac{1}{2} D(u_L, u_R) (v_R - v_L),\n$$\n其中 $D(u_L, u_R) \\ge 0$ 是一个标量耗散系数。为了与守恒律相容，耗散必须与状态的跳跃成正比，这里通过与熵变量的跳跃成正比来保证。一个确保稳定性的标准选择是基于系统的波速：\n$$\nD(u_L, u_R) = \\alpha \\max(|f'(u_L)|, |f'(u_R)|) = \\alpha \\max(|u_L|, |u_R|),\n$$\n其中 $\\alpha \\ge 0$ 是一个缩放参数。当 $v(u)=u$ 时，ES 通量为：\n$$\n\\hat{f}^{\\,es}(u_L, u_R) = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2) - \\frac{1}{2} \\alpha \\max(|u_L|, |u_R|) (u_R - u_L).\n$$\n\n**3. 离散熵产生**\n\n在状态 $u_L$ 和 $u_R$ 之间的界面上，数值熵产生被定义为熵守恒条件被违反的量：\n$$\np(u_L, u_R) := (v_R - v_L) \\hat{f}^{\\,es}(u_L, u_R) - (q_R - q_L).\n$$\n熵稳定性要求这个产生项为非正，即 $p \\le 0$，这对应于熵耗散。问题中隐含地将产生项 $p_{i+1/2}$ 定义为一个非负量，这表明存在符号约定上的差异。让我们将产生率定义为 $P_{i+1/2} = -p(u_i, u_{i+1})$，因此我们必须证明 $P_{i+1/2} \\ge 0$。\n$$\nP(u_L, u_R) = (q_R - q_L) - (v_R - v_L) \\hat{f}^{\\,es}(u_L, u_R).\n$$\n代入 ES 通量的定义：\n$$\nP(u_L, u_R) = (q_R - q_L) - (v_R - v_L) \\left[ \\hat{f}^{\\,ec}(u_L, u_R) - \\frac{1}{2} D(u_L, u_R) (v_R - v_L) \\right].\n$$\n$$\nP(u_L, u_R) = \\underbrace{\\left[ (q_R - q_L) - (v_R - v_L) \\hat{f}^{\\,ec}(u_L, u_R) \\right]}_{=0 \\text{ 由 EC 属性}} + \\frac{1}{2} D(u_L, u_R) (v_R - v_L)^2.\n$$\n这给出了每个界面的熵产生率的显式表达式：\n$$\np_{i+1/2} \\equiv P(u_i, u_{i+1}) = \\frac{1}{2} D(u_i, u_{i+1}) (v_{i+1} - v_i)^2.\n$$\n代入我们为 $D$ 和 $v$ 选择的表达式：\n$$\np_{i+1/2} = \\frac{1}{2} \\alpha \\max(|u_i|, |u_{i+1}|) (u_{i+1} - u_i)^2.\n$$\n因为 $\\alpha \\ge 0$，$\\max(|u_i|, |u_{i+1}|) \\ge 0$，且 $(u_{i+1} - u_i)^2 \\ge 0$，所以证明了每个界面的产生项 $p_{i+1/2}$ 是非负的。只有当 $\\alpha  0$，$u_i \\ne u_{i+1}$，且 $u_i, u_{i+1}$ 中至少有一个非零时，产生项才严格为正。\n\n**4. 半离散熵率**\n\n总离散熵为 $E = \\sum_{i=0}^{N-1} \\Delta x\\, \\eta(u_i)$。其变化率为：\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\Delta x \\frac{d\\eta(u_i)}{dt} = \\sum_{i=0}^{N-1} \\Delta x\\, v_i \\frac{du_i}{dt}.\n$$\n这是问题陈述中给出的表达式。通过代入半离散格式并在周期性网格上应用分部求和，我们可以将其与熵产生联系起来。\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\Delta x\\, v_i \\left( -\\frac{1}{\\Delta x}(\\hat{f}^{\\,es}_{i+\\frac{1}{2}} - \\hat{f}^{\\,es}_{i-\\frac{1}{2}}) \\right) = -\\sum_{i=0}^{N-1} v_i (\\hat{f}^{\\,es}_{i+\\frac{1}{2}} - \\hat{f}^{\\,es}_{i-\\frac{1}{2}}).\n$$\n使用分部求和（注意到在周期性区域上 $\\sum a_i(b_{i+1}-b_i) = -\\sum b_i(a_i-a_{i-1})$），我们变换求和式：\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\hat{f}^{\\,es}_{i+\\frac{1}{2}} (v_{i+1} - v_i).\n$$\n根据 $p_{i+1/2}$ 的定义，我们有 $(v_{i+1} - v_i) \\hat{f}^{\\,es}_{i+1/2} = (q_{i+1} - q_i) - p_{i+1/2}$。将此代入求和式：\n$$\n\\frac{dE}{dt} = \\sum_{i=0}^{N-1} \\left( (q_{i+1} - q_i) - p_{i+1/2} \\right) = \\sum_{i=0}^{N-1} (q_{i+1} - q_i) - \\sum_{i=0}^{N-1} p_{i+1/2}.\n$$\n右边的第一项是在周期性网格上的伸缩求和，$\\sum_{i=0}^{N-1} (q_{i+1} - q_i) = q_N - q_0$。由于周期性，$u_N=u_0$ 因而 $q_N=q_0$，使得这个和为零。这就得到了最终关系：\n$$\n\\frac{d}{dt}\\left(\\sum_{i=0}^{N-1} \\Delta x \\,\\eta(u_i)\\right) = - \\sum_{i=0}^{N-1} p_{i+1/2}.\n$$\n由于我们证明了 $p_{i+1/2} \\ge 0$，总熵率 $\\frac{dE}{dt}$ 是非正的，满足离散熵不等式。如果 $\\alpha=0$（无耗散），则所有的 $p_{i+1/2}=0$，熵率为零，这意味着该格式是熵守恒的（因此也是动能守恒的）。\n实现部分现在将为指定的测试用例计算这些量。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and tests an entropy-stable scheme for the 1D Burgers' equation.\n    \"\"\"\n    \n    test_cases = [\n        {'id': 'A', 'N': 128, 'uL': 1.0, 'uR': -1.0, 'alpha': 1.0, 'L': 2.0},\n        {'id': 'B', 'N': 128, 'uL': 1.0, 'uR': -1.0, 'alpha': 0.0, 'L': 2.0},\n        {'id': 'C', 'N': 4,   'uL': 1.0, 'uR': -1.0, 'alpha': 1.0, 'L': 2.0}\n    ]\n\n    all_results = {}\n    tolerance = 1e-14\n\n    for params in test_cases:\n        test_id = params['id']\n        N = params['N']\n        uL = params['uL']\n        uR = params['uR']\n        alpha = params['alpha']\n        L = params['L']\n\n        # 1. Grid and Initial Condition\n        dx = L / N\n        x = -L / 2 + (np.arange(N) + 0.5) * dx\n        u = np.where(x  0, uL, uR)\n\n        # 2. Define entropy pair and flux\n        # Entropy variable: v(u) = u\n        # Entropy flux: q(u) = u^3 / 3\n        # In this specific case, u is the state and the entropy variable.\n        v = u\n\n        # 3. Compute numerical fluxes and per-interface production\n        f_hat_es = np.zeros(N)\n        p = np.zeros(N)\n        \n        for i in range(N):\n            u_i = u[i]\n            u_ip1 = u[(i + 1) % N]\n            \n            # Entropy-conservative flux\n            f_hat_ec = (u_i**2 + u_i * u_ip1 + u_ip1**2) / 6.0\n            \n            # Dissipation term\n            # D = alpha * max(|f'(u_L)|, |f'(u_R)|) = alpha * max(|u_L|, |u_R|)\n            D = alpha * max(abs(u_i), abs(u_ip1))\n            \n            # Entropy-stable flux at interface i+1/2\n            v_i = u_i\n            v_ip1 = u_ip1\n            f_hat_es[i] = f_hat_ec - 0.5 * D * (v_ip1 - v_i)\n            \n            # Per-interface entropy production p_{i+1/2}\n            # p = 0.5 * D * (v_{i+1} - v_i)^2\n            p[i] = 0.5 * D * (v_ip1 - v_i)**2\n\n        # 4. Compute semi-discrete time derivative du/dt\n        dudt = np.zeros(N)\n        for i in range(N):\n            f_hat_plus = f_hat_es[i]\n            f_hat_minus = f_hat_es[(i - 1 + N) % N]\n            dudt[i] = -(f_hat_plus - f_hat_minus) / dx\n\n        # 5. Compute total semi-discrete entropy rate\n        # S_dot = integral(eta_t dx) = integral(v * u_t dx)\n        # S_dot_discrete = sum(dx * v_i * du_i/dt)\n        total_entropy_rate = dx * np.sum(v * dudt)\n        \n        # 6. Perform verifications based on test case ID\n        if test_id == 'A':\n            # 1) Non-negativity of entropy production\n            all_results['A_nonneg'] = np.all(p >= -tolerance)\n            # 2) Localization of production to shock interfaces\n            # For this IC, shocks are at x=0 and periodic boundary.\n            # Only two interfaces should have non-zero production.\n            positive_production_count = np.sum(p > tolerance)\n            all_results['A_localized'] = (positive_production_count == 2)\n        \n        elif test_id == 'B':\n            # With alpha=0, scheme is EC, entropy/energy must be conserved.\n            # Total entropy rate must be zero.\n            all_results['B_energy_preserved'] = (abs(total_entropy_rate)  tolerance)\n\n        elif test_id == 'C':\n            # 1) Non-negativity of entropy production\n            all_results['C_nonneg'] = np.all(p >= -tolerance)\n            # 2) Localization on a coarse grid\n            positive_production_count = np.sum(p > tolerance)\n            all_results['C_localized'] = (positive_production_count == 2)\n\n    # 7. Format final output\n    ordered_results = [\n        all_results['A_nonneg'],\n        all_results['A_localized'],\n        all_results['B_energy_preserved'],\n        all_results['C_nonneg'],\n        all_results['C_localized']\n    ]\n\n    print(f\"[{','.join(map(str, ordered_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "熵稳定性的原理可以推广到更复杂的物理系统，例如可压缩欧拉方程。对于这类系统，保持其他相关不变量（如动能）的守恒对于格式的长期稳定性和物理保真度同样至关重要。本练习聚焦于动能守恒 (kinetic-energy-preserving, KEP) 格式，特别是针对动量方程中对流项的一种分裂形式离散。你将运用求和分部 (Summation-By-Parts, SBP) 算子的性质，从理论和数值上验证所构造的对流项离散格式不会人为地产生或耗散动能。这项实践将巩固你对如何在半离散层面分析和验证数值格式守恒性质的理解，并让你熟练运用离散微积分（SBP）这一现代数值分析中的有力工具。",
            "id": "3999356",
            "problem": "考虑一个长度为 $L = 2\\pi$（角度单位为弧度）的周期性域上的一维可压缩欧拉方程，其无量纲形式由密度 $\\,\\rho(x,t)\\,$、速度 $\\,u(x,t)\\,$ 和压力 $\\,p(x,t)\\,$ 描述，比热比 $\\,\\gamma = 1.4\\,$。我们关注半离散动量方程，其中非线性对流通量采用动能守恒（KEP）分裂形式，并包含线性数值粘性。半离散动量方程为\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}(\\rho u) = -\\mathcal{C}_m(\\rho,u) - D p + D\\left(\\mu D u\\right),\n$$\n其中 $\\,D\\,$ 是一个满足分部求和（SBP）性质的离散周期中心差分导数算子，$\\,\\mu\\,$ 是一个恒定的数值粘性系数，而 $\\,\\mathcal{C}_m(\\rho,u)\\,$ 是对流项 $\\,\\partial_x(\\rho u^2)\\,$ 的KEP分裂形式离散化。在具有 $\\,N\\,$ 个点和间距 $\\,\\Delta x = L/N\\,$ 的均匀网格上，离散导数算子 $\\,D\\,$ 定义为\n$$\n(D v)_i = \\frac{v_{i+1} - v_{i-1}}{2\\Delta x},\n$$\n采用周期性索引。SBP性质为\n$$\n\\Delta x \\sum_{i=0}^{N-1} v_i (D w)_i = - \\Delta x \\sum_{i=0}^{N-1} (D v)_i w_i,\n$$\n对所有离散网格函数 $\\,v,w\\,$ 成立。\n\n动量对流算子的KEP分裂形式是三重积对称分裂\n$$\n\\mathcal{C}_m(\\rho,u) = \\frac{1}{3}\\left[ D\\left(\\rho u^2\\right) + u\\, D(\\rho u) + \\rho u\\, D u \\right].\n$$\n定义离散动能\n$$\nK = \\Delta x \\sum_{i=0}^{N-1} \\frac{1}{2}\\rho_i u_i^2.\n$$\n使用SBP性质和上述分裂形式，精确的离散动能收支可表示为\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = - \\Delta x \\sum_{i=0}^{N-1} u_i (D p)_i \\;-\\; \\Delta x \\sum_{i=0}^{N-1} \\mu \\left(D u\\right)_i^2,\n$$\n这表明输运是精确的（对流离散化不会引起动能的伪变化），并且数值粘性带来了受控的耗散（半负定贡献）。\n\n你的任务是实现一个程序，对于给定的离散场 $\\,\\rho, u, p\\,$，计算离散动能收支的三个定量诊断量：\n\n1. 输运残差\n$$\nR_{\\mathrm{trans}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, \\mathcal{C}_m(\\rho,u)_i \\right|,\n$$\n对于精确的KEP分裂形式和SBP导数，该值在数值上必须接近于零。\n\n2. 粘性残差\n$$\nR_{\\mathrm{visc}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, D\\left(\\mu D u\\right)_i \\;+\\; \\Delta x \\sum_{i=0}^{N-1} \\mu \\left(D u\\right)_i^2 \\right|,\n$$\n该值在数值上必须接近于零，从而验证数值粘性对动能变化率贡献了一个半负定的耗散。\n\n3. 总收支残差\n$$\nR_{\\mathrm{budget}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i \\left(-\\mathcal{C}_m(\\rho,u)_i - (D p)_i + D(\\mu D u)_i \\right) \\;-\\; \\left( - \\Delta x \\sum_{i=0}^{N-1} u_i (D p)_i \\;-\\; \\Delta x \\sum_{i=0}^{N-1} \\mu (D u)_i^2 \\right) \\right|,\n$$\n该值在数值上必须接近于零，从而验证组装的半离散右端项与精确的离散动能收支相匹配。\n\n所有量均为无量纲。角度以弧度为单位。无需物理单位。\n\n请在周期性域 $[0,2\\pi)$ 上使用以下初始条件测试套件实现上述计算，每个测试用例代表一个不同的、模拟衰减可压缩湍流特征的可压缩空间变化状态：\n\n- 测试用例1（一般多模态波动，“理想路径”）：\n    - $N = 128$\n    - $\\mu = 5\\times 10^{-3}$\n    - $x_i = i \\Delta x$, $\\,\\Delta x = 2\\pi/N$\n    - $\\rho(x) = 1 + 0.20 \\sin(x) + 0.10 \\sin(7x)$\n    - $u(x) = 0.50 \\sin(2x) + 0.20 \\cos(3x) + 0.10 \\sin(5x)$\n    - $p(x) = 1 + 0.10 \\cos(x) + 0.05 \\sin(5x) + 0.03 \\cos(7x)$\n\n- 测试用例2（恒定状态，边界条件检查）：\n    - $N = 128$\n    - $\\mu = 5\\times 10^{-3}$\n    - $\\rho(x) = 1$\n    - $u(x) = 0$\n    - $p(x) = 1$\n\n- 测试用例3（更强的可压缩性和梯度，边界情况）：\n    - $N = 257$\n    - $\\mu = 1\\times 10^{-2}$\n    - $x_i = i \\Delta x$, $\\,\\Delta x = 2\\pi/N$\n    - $\\rho(x) = 1 + 0.50 \\sin(x) + 0.25 \\sin(4x)$\n    - $u(x) = 0.70 \\sin(3x) + 0.50 \\cos(2x)$\n    - $p(x) = 1 + 0.20 \\cos(2x) + 0.10 \\sin(6x)$\n\n你的程序必须为每个测试用例计算三个残差 $\\,R_{\\mathrm{trans}}, R_{\\mathrm{visc}}, R_{\\mathrm{budget}}\\,$，结果为浮点数。最终输出格式必须是单行，其中包含一个由三元素列表组成的列表，每个子列表对应一个测试用例，并按上述顺序排列。例如：\n$$\n\\text{[ [}R_{\\mathrm{trans}}^{(1)}, R_{\\mathrm{visc}}^{(1)}, R_{\\mathrm{budget}}^{(1)}\\text{], [}R_{\\mathrm{trans}}^{(2)}, R_{\\mathrm{visc}}^{(2)}, R_{\\mathrm{budget}}^{(2)}\\text{], [}R_{\\mathrm{trans}}^{(3)}, R_{\\mathrm{visc}}^{(3)}, R_{\\mathrm{budget}}^{(3)}\\text{] ]}\n$$\n输出不含任何额外文本。所有残差必须使用上面定义的离散SBP内积 $\\,\\Delta x \\sum\\,$ 计算，并以普通十进制数（无百分号）报告。对于精确守恒或精确耗散的恒等式，数值结果应接近于零（在机器精度范围内），但你的程序仍必须按原样输出计算出的残差值，不得将其四舍五入为零。",
            "solution": "该问题要求实现并验证一个用于一维可压缩动量方程的半离散格式的性质。验证通过计算与离散动能收支相关的三个残差来执行。所提供的格式使用了一个满足分部求和（SBP）性质的周期性中心差分算子，以及一个为对流项设计的特定动能守恒（KEP）分裂形式。\n\n首先，我们建立计算框架。域是一个周期性区间 $[0, 2\\pi)$，用 $N$ 个均匀间隔的点 $x_i = i \\Delta x$（$i=0, 1, \\dots, N-1$）进行离散化，其中 $\\Delta x = 2\\pi/N$。一个离散函数 $v$ 由其在这些网格点上的值 $v_i = v(x_i)$ 组成的向量表示。\n\n离散化的核心是周期性中心差分算子 $D$，定义为\n$$\n(D v)_i = \\frac{v_{i+1} - v_{i-1}}{2\\Delta x}\n$$\n索引是周期性的，意味着 $v_{N} = v_0$ 且 $v_{-1} = v_{N-1}$。该算子具有分部求和（SBP）性质，这是分部积分的离散模拟。对于任意两个周期性网格函数 $v$ 和 $w$，SBP性质表明：\n$$\n\\Delta x \\sum_{i=0}^{N-1} v_i (D w)_i = - \\Delta x \\sum_{i=0}^{N-1} (D v)_i w_i\n$$\n这个性质对于推导模拟其连续对应物的离散守恒律至关重要。在我们的实现中，我们可以使用数组移位操作（特别是在NumPy中的`np.roll`）来高效地计算 $D$ 对表示网格函数的向量的作用，`np.roll`能自然地处理周期性边界。\n\n半离散动量方程给出如下：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}(\\rho u) = -\\mathcal{C}_m(\\rho,u) - D p + D\\left(\\mu D u\\right)\n$$\n我们分析右侧各项对总离散动能 $K = \\Delta x \\sum_{i=0}^{N-1} \\frac{1}{2}\\rho_i u_i^2$ 变化率的贡献。该分析依赖于构造右侧项与速度 $u$ 的离散内积。\n\n**1. 对流项与输运残差, $R_{\\mathrm{trans}}$**\n\n对流项使用一种特定的动能守恒（KEP）分裂形式进行离散化：\n$$\n\\mathcal{C}_m(\\rho,u) = \\frac{1}{3}\\left[ D\\left(\\rho u^2\\right) + u\\, D(\\rho u) + \\rho u\\, D u \\right]\n$$\n如果一个离散化方案对动能收支的贡献为零，则该方案是KEP的。此贡献由内积 $-\\Delta x \\sum u_i (\\mathcal{C}_m)_i$ 给出。对于这种特定形式，可以解析地证明，在精确算术中 $\\Delta x \\sum u_i (\\mathcal{C}_m)_i = 0$。输运残差，\n$$\nR_{\\mathrm{trans}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, \\mathcal{C}_m(\\rho,u)_i \\right|\n$$\n在数值上验证了此性质。任何非零值都应在机器浮点精度的量级。\n\n**2. 粘性项与粘性残差, $R_{\\mathrm{visc}}$**\n\n数值粘性项是 $D(\\mu D u)$。它对动能变化率的贡献是 $\\Delta x \\sum u_i D(\\mu D u)_i$。由于粘性系数 $\\mu$ 是常数，这等于 $\\mu \\Delta x \\sum u_i D(D u)_i$。应用一次SBP性质将其转换为：\n$$\n\\mu \\Delta x \\sum_{i=0}^{N-1} u_i (D(D u))_i = - \\mu \\Delta x \\sum_{i=0}^{N-1} (D u)_i (D u)_i = - \\Delta x \\sum_{i=0}^{N-1} \\mu (D u)_i^2\n$$\n最后一项显然是半负定的，代表了动能的物理耗散。粘性残差，\n$$\nR_{\\mathrm{visc}} = \\left| \\Delta x \\sum_{i=0}^{N-1} u_i\\, D\\left(\\mu D u\\right)_i \\;+\\; \\Delta x \\sum_{i=0}^{N-1} \\mu \\left(D u\\right)_i^2 \\right|\n$$\n被设计为在离散算术中精确为零，从而证实我们对粘性算子和SBP性质的实现是一致的。非零值将表明存在实现错误或显著的浮点累积误差。\n\n**3. 总收支残差, $R_{\\mathrm{budget}}$**\n\n总收支残差可作为一项整体一致性检查。它将直接由动量方程完整右端项计算出的动能趋势与理论推导的动能收支表达式进行比较。\n设动量方程的右端项为 $\\mathcal{F} = -\\mathcal{C}_m - D p + D(\\mu D u)$。动能趋势为 $\\Delta x \\sum u_i \\mathcal{F}_i$。\n理论收支为 $\\mathcal{B} = - \\Delta x \\sum u_i (D p)_i - \\Delta x \\sum \\mu (D u)_i^2$。\n残差定义为 $R_{\\mathrm{budget}} = \\left| \\Delta x \\sum u_i \\mathcal{F}_i - \\mathcal{B} \\right|$。\n代入 $\\mathcal{F}$ 和 $\\mathcal{B}$ 的表达式并化简，我们得到：\n$$\nR_{\\mathrm{budget}} = \\left| \\left( \\Delta x \\sum u_i D(\\mu D u)_i + \\Delta x \\sum \\mu (D u)_i^2 \\right) - \\left( \\Delta x \\sum u_i \\mathcal{C}_m \\right) \\right|\n$$\n这表明 $R_{\\mathrm{budget}}$ 是粘性残差项和输运残差项（未取绝对值时）之差的绝对值。如果 $R_{\\mathrm{trans}}$ 和 $R_{\\mathrm{visc}}$ 的计算结果都接近于零，那么 $R_{\\mathrm{budget}}$ 也必须接近于零，这证实了整个数值公式及其实现的自洽性。\n\n该算法通过遍历每个测试用例来进行。对于每个用例，它设置网格和初始场 $\\rho, u, p$。然后，它计算算子 $\\mathcal{C}_m$ 和 $D$，并根据它们的定义组装三个残差。所有向量操作都使用NumPy来提高效率。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes kinetic-energy budget residuals for a semidiscrete momentum equation\n    for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 128, \"mu\": 5e-3,\n            \"rho_func\": lambda x: 1 + 0.20 * np.sin(x) + 0.10 * np.sin(7*x),\n            \"u_func\": lambda x: 0.50 * np.sin(2*x) + 0.20 * np.cos(3*x) + 0.10 * np.sin(5*x),\n            \"p_func\": lambda x: 1 + 0.10 * np.cos(x) + 0.05 * np.sin(5*x) + 0.03 * np.cos(7*x)\n        },\n        {\n            \"N\": 128, \"mu\": 5e-3,\n            \"rho_func\": lambda x: np.ones_like(x),\n            \"u_func\": lambda x: np.zeros_like(x),\n            \"p_func\": lambda x: np.ones_like(x)\n        },\n        {\n            \"N\": 257, \"mu\": 1e-2,\n            \"rho_func\": lambda x: 1 + 0.50 * np.sin(x) + 0.25 * np.sin(4*x),\n            \"u_func\": lambda x: 0.70 * np.sin(3*x) + 0.50 * np.cos(2*x),\n            \"p_func\": lambda x: 1 + 0.20 * np.cos(2*x) + 0.10 * np.sin(6*x)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # 1. Setup grid and discrete fields\n        N = case[\"N\"]\n        mu = case[\"mu\"]\n        L = 2 * np.pi\n        dx = L / N\n        x = np.arange(N) * dx\n\n        rho = case[\"rho_func\"](x)\n        u = case[\"u_func\"](x)\n        p = case[\"p_func\"](x)\n\n        # 2. Define the discrete periodic central-difference operator D\n        def D(v):\n            \"\"\"Computes the SBP-compatible central difference on a periodic grid.\"\"\"\n            return (np.roll(v, -1) - np.roll(v, 1)) / (2 * dx)\n\n        # 3. Compute terms for the residuals\n        \n        # Convective operator C_m\n        rho_u2 = rho * u**2\n        rho_u = rho * u\n        D_rho_u2 = D(rho_u2)\n        D_rho_u = D(rho_u)\n        D_u = D(u)\n        Cm = (1/3) * (D_rho_u2 + u * D_rho_u + rho_u * D_u)\n\n        # Dissipative operator term D(mu*D(u))\n        D_Du = D(D_u)\n        visc_term_mom_eq = mu * D_Du\n        \n        # 4. Compute the residuals\n        \n        # R_trans: Transport residual\n        # This term should be zero in exact arithmetic for a KEP scheme.\n        val_trans = dx * np.sum(u * Cm)\n        R_trans = np.abs(val_trans)\n\n        # R_visc: Viscous residual\n        # This term should be zero in exact arithmetic, verifying SBP for the viscous term.\n        val_visc = dx * np.sum(u * visc_term_mom_eq) + dx * np.sum(mu * D_u**2)\n        R_visc = np.abs(val_visc)\n\n        # R_budget: Full budget residual\n        # This combines the two checks above.\n        # R_budget = | val_visc - val_trans |\n        # As derived in the solution text, the pressure terms cancel.\n        R_budget = np.abs(val_visc - val_trans)\n        \n        results.append([R_trans, R_visc, R_budget])\n\n    # Final print statement in the exact required format.\n    # repr() produces a string representation that matches the format, including spaces.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}