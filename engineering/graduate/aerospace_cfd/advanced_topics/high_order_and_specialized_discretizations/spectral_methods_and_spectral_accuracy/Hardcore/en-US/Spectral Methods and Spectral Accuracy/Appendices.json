{
    "hands_on_practices": [
        {
            "introduction": "To begin our hands-on exploration, we will analyze the performance of a Fourier pseudospectral method in its most ideal setting. This exercise focuses on the linear advection equation, a fundamental model for transport phenomena, in a periodic domain. By deriving the exact discrete dispersion relation, you will discover a remarkable property of spectral methods: their ability to represent wave propagation without any phase or dispersion error for all resolved frequencies, a key aspect of spectral accuracy .",
            "id": "3995720",
            "problem": "In aerospace Computational Fluid Dynamics (CFD), passive scalar transport by uniform convection is modeled by the linear advection equation $u_{t} + c\\,u_{x} = 0$ for a spatially periodic field $u(x,t)$ on the domain $[0,2\\pi]$ with periodic boundary conditions and constant advection speed $c>0$. Consider a Fourier pseudospectral construction on $N$ equispaced collocation points $x_{j} = \\frac{2\\pi j}{N}$ for $j=0,1,\\dots,N-1$, where the spatial derivative is evaluated by mapping nodal values to Fourier space, applying exact spectral differentiation for all resolved modes, and mapping back to physical space. \n\nStarting from fundamental definitions for periodic functions on $[0,2\\pi]$ and the properties of complex Fourier modes as eigenfunctions of the differentiation operator, construct the semi-discrete Fourier pseudospectral scheme for the nodal values $u_{j}(t) \\equiv u(x_{j},t)$, without introducing any time discretization. Then, by analyzing the evolution of a single resolved discrete Fourier mode, determine the exact discrete dispersion relation, expressed as the angular frequency $\\omega_{h}$ in terms of the integer spatial wavenumber $\\kappa$ and the speed $c$.\n\nProvide your final answer as a single closed-form expression for $\\omega_{h}$ in terms of $\\kappa$ and $c$. No rounding is required, and do not include any physical units in your expression.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It represents a fundamental exercise in the numerical analysis of partial differential equations using spectral methods. We can therefore proceed with the solution.\n\nThe problem asks for two things: first, the construction of the semi-discrete Fourier pseudospectral scheme for the linear advection equation, and second, the determination of the discrete dispersion relation for this scheme.\n\nThe governing equation is the linear advection equation:\n$$\nu_{t} + c\\,u_{x} = 0\n$$\nwhere $u(x,t)$ is a spatially periodic function on the domain $x \\in [0, 2\\pi]$ and $c>0$ is a constant advection speed.\n\nThe Fourier pseudospectral method discretizes the spatial domain using $N$ equispaced collocation points $x_{j} = \\frac{2\\pi j}{N}$ for $j=0, 1, \\dots, N-1$. The solution at these points is denoted by $u_{j}(t) \\equiv u(x_{j},t)$. The core of the method is to use the Discrete Fourier Transform (DFT) to relate the physical space nodal values $\\{u_{j}(t)\\}$ to a finite set of Fourier coefficients $\\{\\hat{u}_{\\kappa}(t)\\}$.\n\nA function defined on these grid points can be represented by a finite Fourier series, also known as the discrete Fourier expansion or interpolant:\n$$\nu_{j}(t) = \\sum_{\\kappa \\in K} \\hat{u}_{\\kappa}(t) \\exp(i\\kappa x_{j})\n$$\nwhere $K$ is the set of resolved integer wavenumbers. For an even number of points $N$, this set is typically chosen as $K = \\{-\\frac{N}{2}, \\dots, \\frac{N}{2}-1\\}$. The Fourier coefficients $\\hat{u}_{\\kappa}(t)$ are given by the forward DFT:\n$$\n\\hat{u}_{\\kappa}(t) = \\frac{1}{N} \\sum_{j=0}^{N-1} u_{j}(t) \\exp(-i\\kappa x_{j})\n$$\n\nThe problem states that the spatial derivative $u_{x}$ is evaluated by applying exact spectral differentiation in Fourier space. This procedure consists of three steps:\n1.  Transform the nodal values $u_{j}(t)$ to their Fourier coefficients $\\hat{u}_{\\kappa}(t)$ using the DFT.\n2.  The exact derivative of a single Fourier mode $\\exp(i\\kappa x)$ is $(i\\kappa)\\exp(i\\kappa x)$. Therefore, differentiation in spectral space corresponds to multiplying each Fourier coefficient $\\hat{u}_{\\kappa}(t)$ by its corresponding factor $i\\kappa$. Let the Fourier coefficients of the derivative be $\\widehat{(u_{x})}_{\\kappa}$. Then, for each resolved mode $\\kappa \\in K$, we have:\n    $$\n    \\widehat{(u_{x})}_{\\kappa}(t) = i\\kappa \\, \\hat{u}_{\\kappa}(t)\n    $$\n3.  Transform the new coefficients $\\widehat{(u_{x})}_{\\kappa}(t)$ back to physical space using the inverse DFT to obtain the nodal values of the derivative, which we denote by $(u_{x})_{j}$:\n    $$\n    (u_{x})_{j} \\equiv \\frac{\\partial u}{\\partial x}\\bigg|_{x=x_j} \\approx \\sum_{\\kappa \\in K} \\widehat{(u_{x})}_{\\kappa}(t) \\exp(i\\kappa x_{j}) = \\sum_{\\kappa \\in K} (i\\kappa \\, \\hat{u}_{\\kappa}(t)) \\exp(i\\kappa x_{j})\n    $$\n\nThis completes the construction of the spatial derivative approximation. The semi-discrete scheme is formed by substituting this approximation into the governing PDE at each collocation point $x_{j}$:\n$$\n\\frac{d u_{j}(t)}{dt} + c (u_{x})_{j} = 0\n$$\nSubstituting the expression for $(u_{x})_{j}$:\n$$\n\\frac{d u_{j}(t)}{dt} + c \\sum_{\\kappa \\in K} (i\\kappa \\, \\hat{u}_{\\kappa}(t)) \\exp(i\\kappa x_{j}) = 0, \\quad \\text{for } j=0, 1, \\dots, N-1\n$$\nThis is a system of $N$ coupled ordinary differential equations (ODEs) for the nodal values $u_{j}(t)$. This is the semi-discrete Fourier pseudospectral scheme.\n\nNext, we determine the discrete dispersion relation by analyzing the evolution of a single resolved discrete Fourier mode. Let us assume the solution is a single mode with integer wavenumber $\\kappa_{0} \\in K$:\n$$\nu_{j}(t) = A(t) \\exp(i\\kappa_{0} x_{j})\n$$\nwhere $A(t)$ is a time-dependent amplitude. To proceed, we can work entirely in Fourier space, which simplifies the analysis. Applying the DFT to the semi-discrete ODE system decouples the equations. The time derivative of the Fourier coefficient $\\hat{u}_{\\kappa}(t)$ is:\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = \\frac{1}{N} \\sum_{j=0}^{N-1} \\frac{du_{j}(t)}{dt} \\exp(-i\\kappa x_{j})\n$$\nSubstituting $\\frac{du_{j}(t)}{dt} = -c(u_{x})_{j}$:\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = -c \\left( \\frac{1}{N} \\sum_{j=0}^{N-1} (u_{x})_{j} \\exp(-i\\kappa x_{j}) \\right)\n$$\nThe term in the parenthesis is, by definition, the forward DFT of $(u_{x})_{j}$, which is the Fourier coefficient $\\widehat{(u_{x})}_{\\kappa}(t)$. Thus, the system of ODEs in Fourier space is:\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = -c \\, \\widehat{(u_{x})}_{\\kappa}(t)\n$$\nUsing the relation $\\widehat{(u_{x})}_{\\kappa}(t) = i\\kappa \\, \\hat{u}_{\\kappa}(t)$, we obtain a decoupled ODE for each Fourier coefficient:\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = -c (i\\kappa) \\hat{u}_{\\kappa}(t) = -ic\\kappa \\, \\hat{u}_{\\kappa}(t)\n$$\nThis equation describes the evolution of the amplitude of the Fourier mode with wavenumber $\\kappa$. The solution to this ODE is:\n$$\n\\hat{u}_{\\kappa}(t) = \\hat{u}_{\\kappa}(0) \\exp(-ic\\kappa t)\n$$\nA general discrete plane wave solution is written in the form $u_{j}(t) \\propto \\exp(i(\\kappa x_{j} - \\omega_{h} t))$, where $\\omega_{h}$ is the discrete angular frequency. The time evolution of the corresponding Fourier coefficient is $\\hat{u}_{\\kappa}(t) \\propto \\exp(-i\\omega_{h} t)$.\n\nBy comparing this general form with the solution we derived, $\\hat{u}_{\\kappa}(t) = \\hat{u}_{\\kappa}(0) \\exp(-ic\\kappa t)$, we can equate the time-dependent exponential terms:\n$$\n\\exp(-i\\omega_{h} t) = \\exp(-ic\\kappa t)\n$$\nThis implies that $-i\\omega_{h} t = -ic\\kappa t$. Therefore, the discrete dispersion relation is:\n$$\n\\omega_{h} = c\\kappa\n$$\nThis result demonstrates a key property of the Fourier spectral method for the linear advection equation: the spatial discretization introduces no dispersion error. The numerical phase speed, given by $\\frac{\\omega_{h}}{\\kappa}$, is exactly equal to the physical advection speed $c$ for all resolved wavenumbers $\\kappa$. Any error in a full numerical solution would arise solely from the time integration scheme and the aliasing of unresolved modes if they were present initially or generated by nonlinearities (which are not present in this problem).",
            "answer": "$$\n\\boxed{c\\kappa}\n$$"
        },
        {
            "introduction": "Building upon the ideal case, we now tackle the challenges of nonlinearity and bounded domains, which are common in practical CFD applications. This practice involves implementing a Chebyshev collocation method to solve the viscous Burgers' equation, a model that captures both nonlinear advection and diffusion. You will investigate how different mathematical formulations of the nonlinear term—advective, conservative, and skew-symmetric—impact the energy stability of the numerical solution, providing critical insight into designing robust spectral schemes for complex fluid dynamics problems .",
            "id": "3995744",
            "problem": "Consider the one-dimensional viscous Burgers equation on the closed interval $[-1,1]$ with homogeneous Dirichlet boundary conditions,\n$$\nu_t + u\\,u_x = \\nu\\,u_{xx}, \\quad x \\in [-1,1], \\quad t \\ge 0, \\quad u(-1,t) = u(1,t) = 0,\n$$\nand a smooth, boundary-compatible initial condition\n$$\nu(x,0) = A \\sin(\\pi x).\n$$\nUsing a Chebyshev collocation method based on Chebyshev–Gauss–Lobatto points, discretize the problem and evolve in time. Your task is to implement three distinct discrete representations of the nonlinear term $u\\,u_x$ and to quantify the energy behavior of each:\n\n1. The advective form: directly discretize $u\\,u_x$ by replacing $u_x$ with the Chebyshev differentiation matrix acting on $u$ and using pointwise multiplication for $u$.\n2. The conservative form: rewrite $u\\,u_x$ as $(1/2)\\,\\partial_x(u^2)$ and discretize the spatial derivative with the Chebyshev differentiation matrix acting on $u^2$.\n3. The skew-symmetric form: discretize $u\\,u_x$ as the arithmetic mean of the advective and conservative discrete forms.\n\nThe numerical approximation must conform to the following requirements:\n\n- Collocation points: Use $N+1$ Chebyshev–Gauss–Lobatto nodes $x_j = \\cos\\!\\left( \\frac{\\pi j}{N} \\right)$ for $j=0,1,\\dots,N$ with $N \\in \\mathbb{N}$.\n- Differentiation: Construct the Chebyshev first-derivative matrix $D$ associated with these nodes, and use $D^2$ to represent the second derivative.\n- Quadrature: Use Clenshaw–Curtis quadrature weights to approximate spatial integrals over $[-1,1]$. The discrete energy at time $t$ must be computed as\n$$\nE(t) = \\frac{1}{2}\\sum_{j=0}^N w_j\\,u(x_j,t)^2,\n$$\nwhere $w_j$ are the Clenshaw–Curtis weights on $[-1,1]$ at the Chebyshev–Gauss–Lobatto nodes.\n- Time integration: Advance the solution in time from $t=0$ to $t=T$ using a splitting strategy that treats the linear diffusive part $\\nu\\,u_{xx}$ by an exact matrix exponential over half steps and the nonlinear advective part by an explicit Runge–Kutta method. Specifically, at each full time step $\\Delta t$, apply half a diffusive step using the matrix exponential of $\\nu D^2$ over $\\Delta t/2$, then a full explicit step for the nonlinear part using the classical fourth-order Runge–Kutta method, and finally another half diffusive step using the same matrix exponential. Enforce the Dirichlet boundary conditions strongly during all Runge–Kutta intermediate stages and after each diffusive half-step.\n- Energy behavior metric: For each of the three discrete nonlinear forms, compute the cumulative positive energy increments over the time steps, defined as\n$$\n\\mathcal{D} = \\sum_{n=0}^{M-1} \\max\\!\\left(0,\\,E^{n+1}-E^n\\right),\n$$\nwhere $E^n$ is the discrete energy at the $n$-th time level, and $M$ is the total number of time steps, $M = \\lfloor T/\\Delta t \\rceil$.\n\nUse the following test suite of parameter sets $(N,\\nu,A,\\Delta t,T)$, representing a general case, a highly diffusive case, and an inviscid edge case, respectively. No physical units are required because the problem is nondimensional.\n\n- Test 1 (general): $(N,\\nu,A,\\Delta t,T) = (64,\\,0.01,\\,1.0,\\,2\\times 10^{-4},\\,2\\times 10^{-2})$.\n- Test 2 (high diffusion): $(N,\\nu,A,\\Delta t,T) = (32,\\,0.05,\\,1.0,\\,5\\times 10^{-4},\\,5\\times 10^{-2})$.\n- Test 3 (inviscid edge): $(N,\\nu,A,\\Delta t,T) = (128,\\,0.0,\\,0.5,\\,10^{-4},\\,10^{-2})$.\n\nFor each test case, compute the energy monotonicity defect $\\mathcal{D}$ for the advective, conservative, and skew-symmetric discrete nonlinear forms. Your program should produce a single line of output containing the nine results as a comma-separated list enclosed in square brackets, ordered as\n$$\n[\\mathcal{D}_{\\text{adv, T1}}, \\mathcal{D}_{\\text{cons, T1}}, \\mathcal{D}_{\\text{skew, T1}}, \\mathcal{D}_{\\text{adv, T2}}, \\mathcal{D}_{\\text{cons, T2}}, \\mathcal{D}_{\\text{skew, T2}}, \\mathcal{D}_{\\text{adv, T3}}, \\mathcal{D}_{\\text{cons, T3}}, \\mathcal{D}_{\\text{skew, T3}}].\n$$\nThe output values must be floating-point numbers in the order specified, and no other text should be printed.",
            "solution": "The user has requested a solution to the one-dimensional viscous Burgers' equation using a Chebyshev collocation method, with a focus on analyzing the energy behavior of three different discrete forms of the nonlinear term. The problem is scientifically and mathematically sound, well-posed, and all necessary parameters and methods are specified. We shall proceed with a formal solution.\n\n### 1. Problem Formulation\nThe governing partial differential equation (PDE) is the viscous Burgers' equation on the spatial domain $x \\in [-1, 1]$:\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^2 u}{\\partial x^2}\n$$\nwith homogeneous Dirichlet boundary conditions $u(-1,t) = u(1,t) = 0$ and a smooth initial condition $u(x,0) = A \\sin(\\pi x)$.\n\n### 2. Spatial Discretization\nWe employ a Chebyshev collocation method. The domain $[-1, 1]$ is discretized using $N+1$ Chebyshev–Gauss–Lobatto (CGL) points:\n$$\nx_j = \\cos\\left(\\frac{\\pi j}{N}\\right), \\quad j = 0, 1, \\dots, N\n$$\nThe solution $u(x,t)$ at these points is represented by the vector $\\mathbf{u}(t) = [u(x_0,t), u(x_1,t), \\dots, u(x_N,t)]^T$.\n\nSpatial derivatives are approximated using a Chebyshev differentiation matrix, $D$. The first derivative of $u$ at the collocation points is approximated by the matrix-vector product $D\\mathbf{u}$, and the second derivative is approximated by $D^2\\mathbf{u}$. The entries of the $(N+1) \\times (N+1)$ matrix $D$ are given by well-established formulas.\n\nThis spatial discretization transforms the PDE into a system of ordinary differential equations (ODEs):\n$$\n\\frac{d\\mathbf{u}}{dt} = -\\mathcal{N}(\\mathbf{u}) + \\nu D^2 \\mathbf{u}\n$$\nwhere $\\mathcal{N}(\\mathbf{u})$ represents the discrete approximation of the nonlinear term $u u_x$.\n\nThe homogeneous Dirichlet boundary conditions imply $u(x_0, t) = u(1, t) = 0$ and $u(x_N, t) = u(-1, t) = 0$. These are enforced strongly, meaning we only solve for the $N-1$ interior points, $u_j$ for $j=1, \\dots, N-1$. Let $\\mathbf{u}_{int}(t)=[u(x_1,t), \\dots, u(x_{N-1},t)]^T$. The ODE system for these interior points is:\n$$\n\\frac{d\\mathbf{u}_{int}}{dt} = -\\mathcal{N}(\\mathbf{u})_{int} + \\nu (D^2 \\mathbf{u})_{int}\n$$\nwhere the subscript $int$ denotes the sub-vector corresponding to interior points. Since $\\mathbf{u}$ has zeros at the boundaries, the linear term simplifies to $\\nu \\tilde{D}^2 \\mathbf{u}_{int}$, where $\\tilde{D}^2$ is the $(N-1) \\times (N-1)$ sub-matrix of $D^2$ corresponding to the interior points.\n\n### 3. Discretization of the Nonlinear Term\nThe core of the problem is to compare three forms for $\\mathcal{N}(\\mathbf{u})$:\n\n1.  **Advective Form**: This is a direct discretization of $u u_x$. Let $\\text{diag}(\\mathbf{u})$ be the diagonal matrix with entries from $\\mathbf{u}$. Then,\n    $$\n    \\mathcal{N}_{\\text{adv}}(\\mathbf{u}) = \\text{diag}(\\mathbf{u}) (D \\mathbf{u})\n    $$\n2.  **Conservative Form**: This form is derived from the conservative expression $u u_x = \\frac{1}{2} \\frac{\\partial}{\\partial x}(u^2)$. Discretizing this gives:\n    $$\n    \\mathcal{N}_{\\text{cons}}(\\mathbf{u}) = \\frac{1}{2} D (\\mathbf{u} \\odot \\mathbf{u})\n    $$\n    where $\\odot$ denotes the element-wise (Hadamard) product.\n3.  **Skew-Symmetric Form**: This is the arithmetic mean of the advective and conservative forms:\n    $$\n    \\mathcal{N}_{\\text{skew}}(\\mathbf{u}) = \\frac{1}{2} \\left( \\mathcal{N}_{\\text{adv}}(\\mathbf{u}) + \\mathcal{N}_{\\text{cons}}(\\mathbf{u}) \\right) = \\frac{1}{2} \\left( \\text{diag}(\\mathbf{u}) (D \\mathbf{u}) + \\frac{1}{2} D (\\mathbf{u} \\odot \\mathbf{u}) \\right)\n    $$\nThis form is designed to better preserve certain integral invariants, like energy, at the discrete level.\n\n### 4. Time Integration\nThe semi-discrete system is of the form $\\frac{d\\mathbf{u}_{int}}{dt} = L(\\mathbf{u}_{int}) + N(\\mathbf{u}_{int})$, where $L(\\mathbf{u}_{int}) = \\nu \\tilde{D}^2 \\mathbf{u}_{int}$ is the linear diffusive part and $N(\\mathbf{u}_{int}) = -\\mathcal{N}(\\mathbf{u})_{int}$ is the nonlinear advective part. We use a second-order Strang splitting scheme to advance the solution from time $t_n$ to $t_{n+1} = t_n + \\Delta t$:\n$$\n\\mathbf{u}_{int}^{n+1} \\approx \\Phi_L(\\Delta t/2) \\circ \\Phi_N(\\Delta t) \\circ \\Phi_L(\\Delta t/2) (\\mathbf{u}_{int}^n)\n$$\n-   The linear flow $\\Phi_L(\\tau)$ is computed exactly using the matrix exponential: $\\Phi_L(\\tau)(\\mathbf{v}) = \\exp(\\nu \\tilde{D}^2 \\tau) \\mathbf{v}$.\n-   The nonlinear flow $\\Phi_N(\\Delta t)$ is approximated by one step of the classical fourth-order Runge-Kutta (RK4) method. For an ODE $\\frac{d\\mathbf{v}}{dt} = N(\\mathbf{v})$, one RK4 step is:\n    $$\n    \\begin{align*}\n    \\mathbf{k}_1 &= N(\\mathbf{v}^n) \\\\\n    \\mathbf{k}_2 &= N(\\mathbf{v}^n + \\frac{\\Delta t}{2} \\mathbf{k}_1) \\\\\n    \\mathbf{k}_3 &= N(\\mathbf{v}^n + \\frac{\\Delta t}{2} \\mathbf{k}_2) \\\\\n    \\mathbf{k}_4 &= N(\\mathbf{v}^n + \\Delta t \\mathbf{k}_3) \\\\\n    \\mathbf{v}^{n+1} &= \\mathbf{v}^n + \\frac{\\Delta t}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n    \\end{align*}\n    $$\nDuring each intermediate stage of the RK4 calculation, the full vector $\\mathbf{u}$ is reconstructed with zero boundary values to correctly evaluate the nonlinear term $N(\\mathbf{u}_{int})$.\n\n### 5. Energy and Monotonicity Defect\nThe energy of the continuous system, $E_{cont}(t) = \\frac{1}{2} \\int_{-1}^1 u(x,t)^2 dx$, is non-increasing for $\\nu \\ge 0$. We monitor the discrete analogue of this property. The discrete energy is calculated using Clenshaw-Curtis quadrature:\n$$\nE(t) = \\frac{1}{2} \\sum_{j=0}^{N} w_j u(x_j, t)^2\n$$\nwhere $w_j$ are the Clenshaw-Curtis quadrature weights corresponding to the CGL nodes $x_j$. Numerical errors can cause this discrete energy to increase over a time step. The energy monotonicity defect $\\mathcal{D}$ quantifies the total spurious energy gain over the simulation:\n$$\n\\mathcal{D} = \\sum_{n=0}^{M-1} \\max(0, E^{n+1} - E^n)\n$$\nwhere $E^n$ is the discrete energy at time $t_n = n\\Delta t$ and $M = \\lfloor T/\\Delta t \\rceil$ is the total number of time steps. A smaller value of $\\mathcal{D}$ indicates better energy behavior of the numerical scheme.\n\nThe implementation will construct the necessary matrices and vectors, loop through the specified test cases, and for each case, loop through the three nonlinear forms. In each sub-case, it will perform the time integration and compute the final value of $\\mathcal{D}$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef chebyshev_cgl(N):\n    \"\"\"\n    Computes Chebyshev-Gauss-Lobatto nodes and differentiation matrix.\n    Uses the formulas from Trefethen, \"Spectral Methods in MATLAB\".\n    \"\"\"\n    if N == 0:\n        return np.array([0.0]), np.array([[0.0]])\n    \n    x = np.cos(np.pi * np.arange(N + 1) / N)\n    c = np.ones(N + 1)\n    c[0] = 2.0\n    c[N] = 2.0\n    c = c * (-1) ** np.arange(N + 1)\n    \n    X = np.tile(x, (N + 1, 1))\n    dX = X - X.T\n    \n    D = (c[:, None] * (1.0 / c)[None, :]) / (dX + np.eye(N + 1))\n    D = D - np.diag(np.sum(D, axis=1))\n    \n    return x, D\n\ndef clenshaw_curtis_weights(N):\n    \"\"\"\n    Computes Clenshaw-Curtis quadrature weights for CGL nodes.\n    Implementation based on the algorithm in 'clencurt.m' from Trefethen's book.\n    \"\"\"\n    if N == 0:\n        return np.array([2.0])\n    if N == 1:\n        return np.array([1.0, 1.0])\n\n    theta = np.pi * np.arange(N + 1) / N\n    w = np.zeros(N + 1)\n    ii = np.arange(1, N)\n    v = np.ones(N - 1)\n    \n    if N % 2 == 0:\n        w[0] = 1.0 / (N**2 - 1)\n        w[N] = w[0]\n        for k in range(1, N // 2):\n            v = v - 2 * np.cos(2 * k * theta[ii]) / (4 * k**2 - 1)\n        v = v - np.cos(N * theta[ii]) / (N**2 - 1)\n    else:\n        w[0] = 1.0 / N**2\n        w[N] = w[0]\n        for k in range(1, (N - 1) // 2 + 1):\n            v = v - 2 * np.cos(2 * k * theta[ii]) / (4 * k**2 - 1)\n            \n    w[ii] = 2 * v / N\n    return w\n\ndef solve():\n    \"\"\"\n    Main solver function for the 1D viscous Burgers' equation.\n    \"\"\"\n    test_cases = [\n        (64, 0.01, 1.0, 2e-4, 2e-2),\n        (32, 0.05, 1.0, 5e-4, 5e-2),\n        (128, 0.0, 0.5, 1e-4, 1e-2),\n    ]\n\n    results = []\n\n    for N, nu, A, dt, T in test_cases:\n        M = int(np.round(T / dt))\n        \n        # Spatial discretization\n        x, D = chebyshev_cgl(N)\n        D2 = D @ D\n        w = clenshaw_curtis_weights(N)\n        \n        # Slices for interior points\n        interior_indices = slice(1, N)\n        \n        # Initial condition\n        u_ic = A * np.sin(np.pi * x)\n        \n        # Enforce BCs on initial condition\n        u_ic[0] = 0.0\n        u_ic[N] = 0.0\n        \n        u_int_ic = u_ic[interior_indices]\n\n        # Time-stepping operator for linear part\n        if nu > 0:\n            D2_int = D2[interior_indices, interior_indices]\n            L_int = nu * D2_int\n            exp_L_half = expm(L_int * dt / 2.0)\n        else: # Inviscid case\n            exp_L_half = np.eye(N - 1)\n\n        def nonlinear_rhs(u_int_arg, form_type):\n            u_full = np.zeros(N + 1)\n            u_full[interior_indices] = u_int_arg\n            \n            if form_type == 'advective':\n                N_op = u_full * (D @ u_full)\n            elif form_type == 'conservative':\n                N_op = 0.5 * (D @ (u_full**2))\n            elif form_type == 'skew-symmetric':\n                N_adv = u_full * (D @ u_full)\n                N_cons = 0.5 * (D @ (u_full**2))\n                N_op = 0.5 * (N_adv + N_cons)\n            \n            return -N_op[interior_indices]\n\n        forms = ['advective', 'conservative', 'skew-symmetric']\n        \n        for form in forms:\n            u_int = u_int_ic.copy()\n            u_full = u_ic.copy()\n            \n            E_prev = 0.5 * np.sum(w * u_full**2)\n            D_total = 0.0\n\n            for _ in range(M):\n                # Strang Splitting step\n                # 1. Half diffusive step\n                u_int = exp_L_half @ u_int\n\n                # 2. Full nonlinear step (RK4)\n                k1 = nonlinear_rhs(u_int, form)\n                k2 = nonlinear_rhs(u_int + 0.5 * dt * k1, form)\n                k3 = nonlinear_rhs(u_int + 0.5 * dt * k2, form)\n                k4 = nonlinear_rhs(u_int + dt * k3, form)\n                u_int = u_int + (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n\n                # 3. Second half diffusive step\n                u_int = exp_L_half @ u_int\n\n                # Update full solution vector and calculate energy\n                u_full_new = np.zeros(N + 1)\n                u_full_new[interior_indices] = u_int\n                E_curr = 0.5 * np.sum(w * u_full_new**2)\n                \n                # Update energy monotonicity defect\n                D_total += max(0, E_curr - E_prev)\n                E_prev = E_curr\n\n            results.append(D_total)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "To solve problems in complex geometries, spectral methods are often extended to the Spectral Element Method (SEM), which applies high-order techniques on a mesh of quadrilateral or hexahedral elements. This exercise lays the groundwork for SEM by having you construct the essential building blocks on a single reference element. You will define the tensor-product basis functions from one-dimensional Lagrange polynomials on Gauss-Lobatto-Legendre nodes and derive the element mass and stiffness matrices, which are the fundamental components assembled to solve PDEs on arbitrary domains .",
            "id": "3995767",
            "problem": "Consider the Spectral Element Method (SEM) for a two-dimensional elliptic operator arising in a pressure Poisson substep of incompressible flow in Computational Fluid Dynamics (CFD), posed on a single reference quadrilateral element. Let the reference element be $\\hat{\\Omega} = [-1,1] \\times [-1,1]$ with identity mapping to physical space, so the metric terms are constant and equal to unity. A spectral element of polynomial degree $N$ uses tensor-product interpolants built from one-dimensional Gauss–Lobatto–Legendre (GLL) nodes.\n\nStarting from foundational definitions, do the following:\n\n1. Define a spectral element of degree $N$ on $\\hat{\\Omega}$ and construct the one-dimensional GLL nodes $\\{\\xi_{i}\\}_{i=0}^{N}$ and weights $\\{w_{i}\\}_{i=0}^{N}$ associated with the Legendre polynomial of degree $N$. Using these, define the one-dimensional Lagrange nodal basis $\\{\\ell_{i}(\\xi)\\}_{i=0}^{N}$ that interpolates at the GLL nodes and then construct the two-dimensional tensor-product nodal basis $\\{\\phi_{i,j}(\\xi,\\eta)\\}_{i,j=0}^{N}$ on $\\hat{\\Omega}$.\n\n2. From the weak form on $\\hat{\\Omega}$, derive the element mass matrix $\\mathbf{M}$ and stiffness matrix $\\mathbf{K}$ for the Laplacian operator, using GLL quadrature in both dimensions. Express $\\mathbf{M}$ and $\\mathbf{K}$ in terms of one-dimensional weights and differentiation of the Lagrange basis, and show their tensor-product structure. Do not assume any special symmetry beyond that implied by the construction.\n\n3. Finally, consider the south-west corner node of the tensor grid, corresponding to $(i,j)=(0,0)$. Using only the definitions and properties introduced, provide the closed-form analytic expression for the diagonal mass entry $M_{(0,0),(0,0)}$ as a function of the polynomial degree $N$. Your final answer must be a single analytic expression. No rounding is required, and no units are to be included with the final answer.",
            "solution": "The posed problem is a well-defined exercise in the formulation of the Spectral Element Method (SEM) on a reference element. It is scientifically sound, internally consistent, and requires the application of fundamental principles of numerical analysis, approximation theory, and the properties of orthogonal polynomials. All necessary information is provided for a unique, verifiable solution. The problem is therefore deemed valid.\n\nThe solution proceeds in three parts as requested. First, we define the necessary components of a spectral element of degree $N$. Second, we derive the entries of the element mass and stiffness matrices using Gauss–Lobatto–Legendre (GLL) quadrature. Third, we compute the specific mass matrix entry for the corner node.\n\n1.  **Spectral Element Definition**\n\nA spectral element of polynomial degree $N$ on the reference domain $\\hat{\\Omega} = [-1,1] \\times [-1,1]$ is defined by a set of nodes, basis functions, and a quadrature rule.\n\nThe one-dimensional Gauss–Lobatto–Legendre (GLL) nodes, denoted $\\{\\xi_{i}\\}_{i=0}^{N}$, are the $N+1$ points on the interval $[-1,1]$ that are the roots of the polynomial $(1-\\xi^2)P'_N(\\xi)$, where $P_N(\\xi)$ is the Legendre polynomial of degree $N$ and $P'_N(\\xi)$ is its derivative. Explicitly, the two endpoint nodes are $\\xi_0 = -1$ and $\\xi_N = 1$, and the $N-1$ interior nodes are the zeros of $P'_N(\\xi)$.\n\nThe GLL quadrature weights, $\\{w_{i}\\}_{i=0}^{N}$, associated with these nodes are given by the formula:\n$$w_i = \\frac{2}{N(N+1)} \\frac{1}{[P_N(\\xi_i)]^2}$$\nThis quadrature rule, $\\int_{-1}^{1} f(\\xi) \\, d\\xi \\approx \\sum_{i=0}^{N} f(\\xi_i) w_i$, is exact for any polynomial $f(\\xi)$ of degree up to $2N-1$.\n\nThe one-dimensional nodal basis is the set of Lagrange interpolating polynomials $\\{\\ell_{i}(\\xi)\\}_{i=0}^{N}$, defined with respect to the GLL nodes. Each basis polynomial $\\ell_i(\\xi)$ is a polynomial of degree $N$ that satisfies the Kronecker delta property at the nodes:\n$$\\ell_i(\\xi_j) = \\delta_{ij} = \\begin{cases} 1 & \\text{if } i=j \\\\ 0 & \\text{if } i \\neq j \\end{cases}$$\n\nThe two-dimensional nodal basis on $\\hat{\\Omega}$ is constructed as a tensor product of the one-dimensional bases. The set of $(N+1)^2$ basis functions is $\\{\\phi_{i,j}(\\xi,\\eta)\\}_{i,j=0}^{N}$, where each function is defined as:\n$$\\phi_{i,j}(\\xi,\\eta) = \\ell_i(\\xi) \\ell_j(\\eta)$$\nThese two-dimensional basis functions are defined on the grid of two-dimensional GLL nodes $(\\xi_k, \\eta_l)$ for $k,l \\in \\{0, 1, \\dots, N\\}$. They possess the two-dimensional interpolation property:\n$$\\phi_{i,j}(\\xi_k, \\eta_l) = \\ell_i(\\xi_k) \\ell_j(\\eta_l) = \\delta_{ik} \\delta_{jl}$$\n\n2.  **Derivation of Mass and Stiffness Matrices**\n\nThe element mass matrix $\\mathbf{M}$ and stiffness matrix $\\mathbf{K}$ for the Laplacian operator $-\\nabla^2$ arise from the weak formulation of the problem. For trial functions $u = \\sum_{r,s} u_{rs} \\phi_{rs}$ and test functions $v = \\phi_{pq}$, the matrix entries are given by integrals over the reference element $\\hat{\\Omega}$.\n\nThe entry of the mass matrix $\\mathbf{M}$ corresponding to basis functions $\\phi_{pq}$ and $\\phi_{rs}$ is:\n$$M_{(p,q),(r,s)} = \\int_{\\hat{\\Omega}} \\phi_{pq}(\\xi, \\eta) \\phi_{rs}(\\xi, \\eta) \\,d\\xi d\\eta = \\int_{-1}^{1}\\int_{-1}^{1} \\ell_p(\\xi)\\ell_q(\\eta) \\ell_r(\\xi)\\ell_s(\\eta) \\,d\\xi d\\eta$$\nBy separating the variables, this becomes:\n$$M_{(p,q),(r,s)} = \\left( \\int_{-1}^{1} \\ell_p(\\xi) \\ell_r(\\xi) \\,d\\xi \\right) \\left( \\int_{-1}^{1} \\ell_q(\\eta) \\ell_s(\\eta) \\,d\\eta \\right)$$\n\nThe entry of the stiffness matrix $\\mathbf{K}$ is:\n$$K_{(p,q),(r,s)} = \\int_{\\hat{\\Omega}} \\nabla\\phi_{pq} \\cdot \\nabla\\phi_{rs} \\,d\\xi d\\eta = \\int_{-1}^{1}\\int_{-1}^{1} \\left( \\frac{\\partial\\phi_{pq}}{\\partial\\xi}\\frac{\\partial\\phi_{rs}}{\\partial\\xi} + \\frac{\\partial\\phi_{pq}}{\\partial\\eta}\\frac{\\partial\\phi_{rs}}{\\partial\\eta} \\right) \\,d\\xi d\\eta$$\nSubstituting the tensor-product form and separating variables yields:\n$$K_{(p,q),(r,s)} = \\left(\\int_{-1}^{1} \\ell'_p(\\xi)\\ell'_r(\\xi)d\\xi\\right) \\left(\\int_{-1}^{1} \\ell_q(\\eta)\\ell_s(\\eta)d\\eta\\right) + \\left(\\int_{-1}^{1} \\ell_p(\\xi)\\ell_r(\\xi)d\\xi\\right) \\left(\\int_{-1}^{1} \\ell'_q(\\eta)\\ell'_s(\\eta)d\\eta\\right)$$\nHere, $\\ell'(\\xi)$ denotes the derivative of $\\ell(\\xi)$ with respect to its argument.\n\nThese expressions reveal the tensor-product structure. If we define the one-dimensional mass and stiffness matrices with entries $M_{pr}^{(1D)} = \\int_{-1}^{1} \\ell_p(\\xi)\\ell_r(\\xi) d\\xi$ and $K_{pr}^{(1D)} = \\int_{-1}^{1} \\ell'_p(\\xi)\\ell'_r(\\xi) d\\xi$, then the two-dimensional matrix entries are $M_{(p,q),(r,s)} = M_{pr}^{(1D,\\xi)} M_{qs}^{(1D,\\eta)}$ and $K_{(p,q),(r,s)} = K_{pr}^{(1D,\\xi)} M_{qs}^{(1D,\\eta)} + M_{pr}^{(1D,\\xi)} K_{qs}^{(1D,\\eta)}$.\n\nWe now use GLL quadrature to evaluate these one-dimensional integrals. For the mass matrix integral, the integrand $\\ell_p(\\xi)\\ell_r(\\xi)$ is a polynomial of degree up to $2N$. Since GLL quadrature is only exact for polynomials of degree up to $2N-1$, this integration is not exact and leads to mass lumping.\n$$M_{pr}^{(1D)} \\approx \\sum_{k=0}^{N} \\ell_p(\\xi_k) \\ell_r(\\xi_k) w_k = \\sum_{k=0}^{N} \\delta_{pk} \\delta_{rk} w_k = \\delta_{pr} w_p$$\nThus, the one-dimensional mass matrix is diagonal with the quadrature weights on the diagonal. The two-dimensional mass matrix entry becomes:\n$$M_{(p,q),(r,s)} = (\\delta_{pr} w_p) (\\delta_{qs} w_q) = \\delta_{pr}\\delta_{qs} w_p w_q$$\n\nFor the stiffness matrix, the integrand $\\ell'_p(\\xi)\\ell'_r(\\xi)$ is a polynomial of degree $2N-2$. GLL quadrature is exact for this integral.\n$$K_{pr}^{(1D)} = \\int_{-1}^{1} \\ell'_p(\\xi)\\ell'_r(\\xi) d\\xi = \\sum_{k=0}^{N} \\ell'_p(\\xi_k) \\ell'_r(\\xi_k) w_k$$\nCombining these results, the stiffness matrix entry using GLL quadrature is:\n$$K_{(p,q),(r,s)} = \\left(\\sum_{k=0}^{N} \\ell'_p(\\xi_k)\\ell'_r(\\xi_k)w_k\\right) (\\delta_{qs}w_q) + (\\delta_{pr}w_p) \\left(\\sum_{l=0}^{N} \\ell'_q(\\eta_l)\\ell'_s(\\eta_l)w_l\\right)$$\nThis explicitly shows the tensor-product structure in terms of one-dimensional weights and basis function derivatives evaluated at the quadrature points.\n\n3.  **Calculation of $M_{(0,0),(0,0)}$**\n\nThe final step is to find the closed-form expression for the diagonal mass matrix entry corresponding to the south-west corner node, which is indexed by $(i,j)=(0,0)$. Using the derived formula for the mass matrix entries:\n$$M_{(p,q),(r,s)} = \\delta_{pr}\\delta_{qs} w_p w_q$$\nWe set the indices to $(p,q)=(r,s)=(0,0)$:\n$$M_{(0,0),(0,0)} = \\delta_{00}\\delta_{00} w_0 w_0 = (w_0)^2$$\nTo evaluate this, we need the expression for the GLL weight $w_0$. The general formula is:\n$$w_i = \\frac{2}{N(N+1)} \\frac{1}{[P_N(\\xi_i)]^2}$$\nFor the index $i=0$, the corresponding GLL node is $\\xi_0 = -1$. We must evaluate the Legendre polynomial $P_N(\\xi)$ at this point. A standard property of Legendre polynomials is that $P_N(-1) = (-1)^N$.\nTherefore, $[P_N(\\xi_0)]^2 = [P_N(-1)]^2 = [(-1)^N]^2 = 1$.\n\nSubstituting this result into the formula for $w_0$:\n$$w_0 = \\frac{2}{N(N+1)} \\frac{1}{1} = \\frac{2}{N(N+1)}$$\nFinally, the mass matrix entry $M_{(0,0),(0,0)}$ is the square of this value:\n$$M_{(0,0),(0,0)} = (w_0)^2 = \\left(\\frac{2}{N(N+1)}\\right)^2 = \\frac{4}{N^2(N+1)^2}$$\nThis is the closed-form analytic expression for the specified diagonal mass entry as a function of the polynomial degree $N$.",
            "answer": "$$\\boxed{\\frac{4}{N^2(N+1)^2}}$$"
        }
    ]
}