{
    "hands_on_practices": [
        {
            "introduction": "精确的声学模拟基础在于空间离散格式的选择。本练习将引导你推导六阶紧致与显式中心差分格式的系数，并使用修正波数分析法来比较它们的色散特性。通过这个过程 ，你将深入理解计算成本（模板宽度、隐式/显式）与数值精度之间的权衡。",
            "id": "3973783",
            "problem": "考虑由计算流体动力学 (CFD) 中使用的线性化欧拉方程 (LEE) 控制的一维小振幅等熵声学。在间距为 $\\Delta x$ 的均匀网格上，将一阶空间导数算子记为 $\\partial_{x}$。$\\partial_{x}$ 的高阶、低耗散离散化对于精确的波传播至关重要。在本问题中，您将为 $\\partial_{x}$ 推导一个六阶三对角紧致 Padé 格式，求得其修正波数，并将其色散与经典的显式中心六阶差分进行比较。\n\n设 $u_{i} = u(x_{i})$ 是一个光滑的网格函数，$u'_{i} \\approx \\partial_{x} u(x_{i})$ 是其离散导数。考虑以下两种离散格式：\n\n1.  一种三对角紧致 Padé 格式（系数待定）：\n$$\n\\alpha\\,u'_{i-1} + u'_{i} + \\alpha\\,u'_{i+1}\n= \\frac{1}{\\Delta x}\\left[ A\\left(u_{i+1}-u_{i-1}\\right) + B\\left(u_{i+2}-u_{i-2}\\right) \\right].\n$$\n\n2.  一种显式中心六阶格式（系数待定）：\n$$\nu'_{i} = \\frac{1}{\\Delta x}\\left[ a\\left(u_{i+1}-u_{i-1}\\right) + b\\left(u_{i+2}-u_{i-2}\\right) + c\\left(u_{i+3}-u_{i-3}\\right) \\right].\n$$\n\n任务：\n- 使用关于 $x_{i}$ 点的泰勒级数相容性，确定 $\\alpha$、$A$ 和 $B$ 以使紧致格式对 $\\partial_{x}$ 达到六阶精度。类似地，确定 $a$、$b$ 和 $c$ 以使显式中心格式达到六阶精度。\n- 对于平面波 $u_{i} = \\exp\\!\\left(\\mathrm{i} k x_{i}\\right)$，其无量纲波数为 $\\kappa = k\\,\\Delta x$（使用弧度制），推导每种格式的修正波数 $\\kappa^{\\star}$，定义为 $u'_{i} \\approx \\mathrm{i}\\,k^{\\star} u_{i}$ 且 $\\kappa^{\\star} = k^{\\star}\\Delta x$。\n- 令 $\\kappa = \\pi/2$。计算绝对色散误差之比，\n$$\nR = \\frac{\\left|\\kappa^{\\star}_{\\mathrm{compact}} - \\kappa\\right|}{\\left|\\kappa^{\\star}_{\\mathrm{explicit}} - \\kappa\\right|}.\n$$\n\n将 $R$ 的最终值表示为一个无量纲实数。将您的答案四舍五入到四位有效数字。不需要单位，并且整个计算过程中角度必须使用弧度制。",
            "solution": "用户希望推导用于一阶导数的六阶紧致 Padé 格式和六阶显式中心格式的系数，推导它们各自的修正波数，并在一个特定的无量纲波数下计算它们的色散误差之比。\n\n首先，我将验证问题陈述。\n\n### 步骤1：提取已知条件\n- **问题领域**：一维等熵声学，线性化欧拉方程 (LEE)，间距为 $\\Delta x$ 的均匀网格。\n- **算子和函数**：一阶空间导数算子 $\\partial_{x}$，光滑网格函数 $u_{i} = u(x_{i})$，及其离散导数 $u'_{i}$。\n- **紧致 Padé 格式**：$\\alpha\\,u'_{i-1} + u'_{i} + \\alpha\\,u'_{i+1} = \\frac{1}{\\Delta x}\\left[ A\\left(u_{i+1}-u_{i-1}\\right) + B\\left(u_{i+2}-u_{i-2}\\right) \\right]$。\n- **显式中心格式**：$u'_{i} = \\frac{1}{\\Delta x}\\left[ a\\left(u_{i+1}-u_{i-1}\\right) + b\\left(u_{i+2}-u_{i-2}\\right) + c\\left(u_{i+3}-u_{i-3}\\right) \\right]$。\n- **任务1**：确定系数 $\\alpha$、$A$、$B$ 和 $a$、$b$、$c$ 以达到六阶精度。\n- **任务2**：对于平面波 $u_{i} = \\exp(\\mathrm{i} k x_{i})$，其无量纲波数为 $\\kappa = k\\,\\Delta x$，推导修正波数 $\\kappa^{\\star}$，定义为 $u'_{i} \\approx \\mathrm{i}\\,k^{\\star} u_{i}$ 且 $\\kappa^{\\star} = k^{\\star}\\Delta x$。\n- **任务3**：对于 $\\kappa = \\pi/2$，计算绝对色散误差之比 $R = \\frac{\\left|\\kappa^{\\star}_{\\mathrm{compact}} - \\kappa\\right|}{\\left|\\kappa^{\\star}_{\\mathrm{explicit}} - \\kappa\\right|}$。\n- **输出要求**：将 R 四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在计算流体动力学（CFD）的数值分析领域有其科学基础，特别是关于高阶有限差分格式。问题是适定的，提供了足够的信息来确定未知系数和计算所需量。语言客观而精确。该问题是数值方法分析中的一个标准练习，不违反任何科学原理，不包含错误的前提，也不包含主观论断。所有术语在该学科领域内都是标准的。\n\n### 步骤3：结论与行动\n问题是有效的。我将继续进行解答。\n\n按照要求，解答分为三个部分。\n\n**第1部分：格式系数的确定**\n\n为了确定系数，我们将给定格式中的每一项在点 $x_{i}$ 附近进行泰勒级数展开，并通过匹配 $u$ 的各阶导数系数来达到所需的精度阶数。令 $u^{(n)}_{i}$ 表示 $u$ 在 $x_i$ 处的 $n$ 阶导数，即 $d^n u/dx^n|_{x_i}$。\n\n**紧致 Padé 格式：**\n格式为 $\\alpha\\,u'_{i-1} + u'_{i} + \\alpha\\,u'_{i+1} = \\frac{1}{\\Delta x}\\left[ A\\left(u_{i+1}-u_{i-1}\\right) + B\\left(u_{i+2}-u_{i-2}\\right) \\right]$。\n我们展开各项：\n$u_{i\\pm j} = u_{i} \\pm j\\Delta x u^{(1)}_{i} + \\frac{(j\\Delta x)^2}{2!} u^{(2)}_{i} \\pm \\frac{(j\\Delta x)^3}{3!} u^{(3)}_{i} + \\dots$\n$u'_{i\\pm 1} = u' _{i} \\pm \\Delta x u^{(2)}_{i} + \\frac{(\\Delta x)^2}{2!} u^{(3)}_{i} \\pm \\frac{(\\Delta x)^3}{3!} u^{(4)}_{i} + \\dots$\n\n格式的左侧 (LHS) 变为：\n$\\alpha(u'_{i} - \\Delta x u^{(2)}_{i} + \\frac{(\\Delta x)^2}{2} u^{(3)}_{i} - \\dots) + u'_{i} + \\alpha(u'_{i} + \\Delta x u^{(2)}_{i} + \\frac{(\\Delta x)^2}{2} u^{(3)}_{i} + \\dots)$\n$= (1+2\\alpha)u'_{i} + \\alpha(\\Delta x)^2 u^{(3)}_{i} + \\frac{\\alpha}{12}(\\Delta x)^4 u^{(5)}_{i} + O((\\Delta x)^6)$\n\n格式的右侧 (RHS) 变为：\n$\\frac{1}{\\Delta x} \\left[ A(2\\Delta x u'_{i} + \\frac{2(\\Delta x)^3}{6}u^{(3)}_{i} + \\frac{2(\\Delta x)^5}{120}u^{(5)}_{i} + \\dots) + B(4\\Delta x u'_{i} + \\frac{2(2\\Delta x)^3}{6}u^{(3)}_{i} + \\frac{2(2\\Delta x)^5}{120}u^{(5)}_{i} + \\dots) \\right]$\n$= (2A+4B)u'_{i} + (\\frac{A}{3} + \\frac{8B}{3})(\\Delta x)^2 u^{(3)}_{i} + (\\frac{A}{60} + \\frac{32B}{60})(\\Delta x)^4 u^{(5)}_{i} + O((\\Delta x)^6)$\n\n对于一个六阶格式，该算子必须对最高6次的多项式是精确的。这要求匹配到 $u^{(5)}_{i}$ 的项。误差将与 $u^{(7)}_{i}$ 成正比。令 $u'_{_i}$、$u^{(3)}_{i}$ 和 $u^{(5)}_{i}$ 的系数相等，得到以下线性方程组：\n1. $u'_{i}$: $1+2\\alpha = 2A+4B$\n2. $u^{(3)}_{i}$: $\\alpha = \\frac{A}{3} + \\frac{8B}{3} \\implies 3\\alpha = A+8B$\n3. $u^{(5)}_{i}$: $\\frac{\\alpha}{12} = \\frac{A}{60} + \\frac{32B}{60} \\implies 5\\alpha = A+32B$\n\n方程 (3) 减去方程 (2) 得到 $2\\alpha = 24B$，所以 $B = \\frac{\\alpha}{12}$。\n将 $B$ 代入 (2)：$3\\alpha = A + 8(\\frac{\\alpha}{12}) = A + \\frac{2\\alpha}{3} \\implies A = 3\\alpha - \\frac{2\\alpha}{3} = \\frac{7\\alpha}{3}$。\n将 $A$ 和 $B$ 代入 (1)：$1+2\\alpha = 2(\\frac{7\\alpha}{3}) + 4(\\frac{\\alpha}{12}) = \\frac{14\\alpha}{3} + \\frac{\\alpha}{3} = \\frac{15\\alpha}{3} = 5\\alpha$。\n这得到 $1 = 3\\alpha$，所以 $\\alpha = \\frac{1}{3}$。\n那么，$A = \\frac{7}{3}(\\frac{1}{3}) = \\frac{7}{9}$ 且 $B = \\frac{1}{12}(\\frac{1}{3}) = \\frac{1}{36}$。\n系数为 $\\alpha = \\frac{1}{3}$，$A = \\frac{7}{9}$，$B = \\frac{1}{36}$。\n\n**显式中心格式：**\n格式为 $u'_{i} = \\frac{1}{\\Delta x}\\left[ a\\left(u_{i+1}-u_{i-1}\\right) + b\\left(u_{i+2}-u_{i-2}\\right) + c\\left(u_{i+3}-u_{i-3}\\right) \\right]$。\n使用泰勒展开式 $u_{i\\pm j} - u_{i-j} = 2j\\Delta x u'_{i} + \\frac{2(j\\Delta x)^3}{6}u^{(3)}_{i} + \\frac{2(j\\Delta x)^5}{120}u^{(5)}_{i} + O((\\Delta x)^7)$，RHS 变为：\n$\\frac{1}{\\Delta x} \\left[ a(2\\Delta x u'_{i} + \\frac{(\\Delta x)^3}{3}u^{(3)}_{i} + \\dots) + b(4\\Delta x u'_{i} + \\frac{8(\\Delta x)^3}{3}u^{(3)}_{i} + \\dots) + c(6\\Delta x u'_{i} + \\frac{54(\\Delta x)^3}{6}u^{(3)}_{i} + \\dots) \\right]$\n$= (2a+4b+6c)u'_{i} + (\\frac{a}{3} + \\frac{8b}{3} + 9c)(\\Delta x)^2 u^{(3)}_{i} + (\\frac{a}{60} + \\frac{32b}{60} + \\frac{243c}{60})(\\Delta x)^4 u^{(5)}_{i} + O((\\Delta x)^6)$。\n为达到六阶精度，我们要求 $u'_{i}$ 的系数为1，而 $u^{(3)}_{i}$ 和 $u^{(5)}_{i}$ 的系数为0。\n1. $u'_{i}$: $2a+4b+6c = 1$\n2. $u^{(3)}_{i}$: $\\frac{a}{3} + \\frac{8b}{3} + 9c = 0 \\implies a+8b+27c = 0$\n3. $u^{(5)}_{i}$: $\\frac{a}{60} + \\frac{32b}{60} + \\frac{243c}{60} = 0 \\implies a+32b+243c = 0$\n\n方程 (3) 减去 (2)：$24b + 216c = 0 \\implies b = -9c$。\n代入 (2)：$a+8(-9c)+27c = 0 \\implies a-72c+27c = 0 \\implies a = 45c$。\n代入 (1)：$2(45c)+4(-9c)+6c = 1 \\implies 90c-36c+6c = 1 \\implies 60c=1$，所以 $c=\\frac{1}{60}$。\n那么，$a = 45(\\frac{1}{60}) = \\frac{3}{4}$ 且 $b = -9(\\frac{1}{60}) = -\\frac{3}{20}$。\n系数为 $a=\\frac{3}{4}$，$b=-\\frac{3}{20}$，$c=\\frac{1}{60}$。\n\n**第2部分：修正波数**\n\n对于平面波 $u_j = \\exp(\\mathrm{i} k x_j) = u_i \\exp(\\mathrm{i}(j-i)\\kappa)$，其数值导数为 $u'_j = \\mathrm{i} k^{\\star} u_j = \\frac{\\mathrm{i}\\kappa^{\\star}}{\\Delta x} u_j$。\n\n**紧致 Padé 格式：**\n将平面波及其数值导数代入格式中：\n$\\alpha \\frac{\\mathrm{i}\\kappa^{\\star}}{\\Delta x} u_{i-1} + \\frac{\\mathrm{i}\\kappa^{\\star}}{\\Delta x} u_i + \\alpha \\frac{\\mathrm{i}\\kappa^{\\star}}{\\Delta x} u_{i+1} = \\frac{1}{\\Delta x}[A(u_{i+1}-u_{i-1}) + B(u_{i+2}-u_{i-2})]$\n$\\frac{\\mathrm{i}\\kappa^{\\star}}{\\Delta x} u_i (\\alpha e^{-\\mathrm{i}\\kappa} + 1 + \\alpha e^{\\mathrm{i}\\kappa}) = \\frac{u_i}{\\Delta x}[A(e^{\\mathrm{i}\\kappa}-e^{-\\mathrm{i}\\kappa}) + B(e^{2\\mathrm{i}\\kappa}-e^{-2\\mathrm{i}\\kappa})]$\n$\\mathrm{i}\\kappa^{\\star} (1 + 2\\alpha\\cos\\kappa) = A(2\\mathrm{i}\\sin\\kappa) + B(2\\mathrm{i}\\sin(2\\kappa))$\n$\\kappa^{\\star}_{\\mathrm{compact}} = \\frac{2A\\sin\\kappa + 2B\\sin(2\\kappa)}{1+2\\alpha\\cos\\kappa}$\n代入系数 $\\alpha=1/3$，$A=7/9$，$B=1/36$：\n$\\kappa^{\\star}_{\\mathrm{compact}} = \\frac{2(\\frac{7}{9})\\sin\\kappa + 2(\\frac{1}{36})\\sin(2\\kappa)}{1+2(\\frac{1}{3})\\cos\\kappa} = \\frac{\\frac{14}{9}\\sin\\kappa + \\frac{1}{18}\\sin(2\\kappa)}{1+\\frac{2}{3}\\cos\\kappa}$\n使用 $\\sin(2\\kappa) = 2\\sin\\kappa\\cos\\kappa$：\n$\\kappa^{\\star}_{\\mathrm{compact}} = \\frac{\\sin\\kappa (\\frac{14}{9} + \\frac{1}{9}\\cos\\kappa)}{1+\\frac{2}{3}\\cos\\kappa} = \\frac{\\frac{\\sin\\kappa}{9}(14+\\cos\\kappa)}{\\frac{1}{3}(3+2\\cos\\kappa)} = \\frac{\\sin\\kappa(14+\\cos\\kappa)}{3(3+2\\cos\\kappa)} = \\frac{\\sin\\kappa(14+\\cos\\kappa)}{9+6\\cos\\kappa}$\n\n**显式中心格式：**\n将平面波代入格式中：\n$\\frac{\\mathrm{i}\\kappa^{\\star}}{\\Delta x} u_i = \\frac{1}{\\Delta x}[ a(u_{i+1}-u_{i-1}) + b(u_{i+2}-u_{i-2}) + c(u_{i+3}-u_{i-3}) ]$\n$\\mathrm{i}\\kappa^{\\star} u_i = u_i [a(e^{\\mathrm{i}\\kappa}-e^{-\\mathrm{i}\\kappa}) + b(e^{2\\mathrm{i}\\kappa}-e^{-2\\mathrm{i}\\kappa}) + c(e^{3\\mathrm{i}\\kappa}-e^{-3\\mathrm{i}\\kappa})]$\n$\\mathrm{i}\\kappa^{\\star} = a(2\\mathrm{i}\\sin\\kappa) + b(2\\mathrm{i}\\sin(2\\kappa)) + c(2\\mathrm{i}\\sin(3\\kappa))$\n$\\kappa^{\\star}_{\\mathrm{explicit}} = 2a\\sin\\kappa + 2b\\sin(2\\kappa) + 2c\\sin(3\\kappa)$\n代入系数 $a=3/4$，$b=-3/20$，$c=1/60$：\n$\\kappa^{\\star}_{\\mathrm{explicit}} = 2(\\frac{3}{4})\\sin\\kappa + 2(-\\frac{3}{20})\\sin(2\\kappa) + 2(\\frac{1}{60})\\sin(3\\kappa)$\n$\\kappa^{\\star}_{\\mathrm{explicit}} = \\frac{3}{2}\\sin\\kappa - \\frac{3}{10}\\sin(2\\kappa) + \\frac{1}{30}\\sin(3\\kappa)$\n\n**第3部分：在 $\\kappa = \\pi/2$ 处的色散误差之比**\n\n给定 $\\kappa=\\pi/2$。\n我们有 $\\sin(\\pi/2)=1$，$\\cos(\\pi/2)=0$。\n$\\sin(2 \\cdot \\pi/2) = \\sin(\\pi) = 0$。\n$\\sin(3 \\cdot \\pi/2) = -1$。\n\n对于紧致格式：\n$\\kappa^{\\star}_{\\mathrm{compact}} = \\frac{\\sin(\\pi/2)(14+\\cos(\\pi/2))}{9+6\\cos(\\pi/2)} = \\frac{1(14+0)}{9+0} = \\frac{14}{9}$。\n绝对色散误差为 $|\\kappa^{\\star}_{\\mathrm{compact}} - \\kappa| = |\\frac{14}{9} - \\frac{\\pi}{2}|$。\n\n对于显式格式：\n$\\kappa^{\\star}_{\\mathrm{explicit}} = \\frac{3}{2}\\sin(\\frac{\\pi}{2}) - \\frac{3}{10}\\sin(\\pi) + \\frac{1}{30}\\sin(\\frac{3\\pi}{2})$\n$= \\frac{3}{2}(1) - \\frac{3}{10}(0) + \\frac{1}{30}(-1) = \\frac{3}{2} - \\frac{1}{30} = \\frac{45-1}{30} = \\frac{44}{30} = \\frac{22}{15}$。\n绝对色散误差为 $|\\kappa^{\\star}_{\\mathrm{explicit}} - \\kappa| = |\\frac{22}{15} - \\frac{\\pi}{2}|$。\n\n现在我们计算比率 $R$：\n$R = \\frac{|\\frac{14}{9} - \\frac{\\pi}{2}|}{|\\frac{22}{15} - \\frac{\\pi}{2}|}$\n数值上，$\\pi/2 \\approx 1.570796$，$14/9 \\approx 1.555556$，$22/15 \\approx 1.466667$。\n由于 $\\frac{\\pi}{2} > \\frac{14}{9}$ 且 $\\frac{\\pi}{2} > \\frac{22}{15}$，绝对值可以去掉：\n$R = \\frac{\\frac{\\pi}{2} - \\frac{14}{9}}{\\frac{\\pi}{2} - \\frac{22}{15}} = \\frac{\\frac{9\\pi-28}{18}}{\\frac{15\\pi-44}{30}} = \\frac{9\\pi-28}{18} \\cdot \\frac{30}{15\\pi-44} = \\frac{5(9\\pi-28)}{3(15\\pi-44)} = \\frac{45\\pi-140}{45\\pi-132}$。\n使用 $\\pi \\approx 3.14159265$：\n$45\\pi \\approx 141.37166925$\n$R \\approx \\frac{141.37166925 - 140}{141.37166925 - 132} = \\frac{1.37166925}{9.37166925} \\approx 0.146363$\n四舍五入到四位有效数字，我们得到 $0.1464$。",
            "answer": "$$\\boxed{0.1464}$$"
        },
        {
            "introduction": "即使有了优秀的显式空间格式，如果没有稳定的时间积分方法，它也毫无用处。本练习  将深入探讨数值稳定性的关键问题，通过对一个全离散格式（四阶空间差分与四阶龙格-库塔时间积分）进行冯·诺依曼（von Neumann）稳定性分析。你将学习如何推导Courant-Friedrichs-Lewy (CFL) 条件，它将时间步长 $ \\Delta t $、网格间距 $ \\Delta x $ 和物理波速紧密联系在一起。",
            "id": "3973749",
            "problem": "考虑由线性化欧拉方程控制的一维小振幅声学运动，其基态为等熵均匀态，具有恒定的基态密度 $\\rho_{0}$ 和恒定的声速 $c_{0}$。设扰动压力为 $p'(x,t)$，扰动速度为 $u'(x,t)$。控制方程为\n$$\n\\frac{\\partial p'}{\\partial t} + \\rho_{0} c_{0}^{2} \\frac{\\partial u'}{\\partial x} = 0, \n\\qquad\n\\frac{\\partial u'}{\\partial t} + \\frac{1}{\\rho_{0}} \\frac{\\partial p'}{\\partial x} = 0.\n$$\n引入状态向量 $q = \\begin{pmatrix} p' \\\\ u' \\end{pmatrix}$，从而该系统可以写成紧凑形式 $q_{t} + A q_{x} = 0$，其中\n$$\nA = \\begin{pmatrix} 0 & \\rho_{0} c_{0}^{2} \\\\ \\frac{1}{\\rho_{0}} & 0 \\end{pmatrix},\n$$\n并假设在一个间距为 $\\Delta x$ 的均匀网格上采用周期性边界条件。使用无耗散四阶中心有限差分格式在网格索引 $i$ 处对空间导数 $\\partial/\\partial x$ 进行离散化：\n$$\n\\left.\\frac{\\partial f}{\\partial x}\\right|_{i} \\approx \\frac{1}{12 \\Delta x} \\left( - f_{i+2} + 8 f_{i+1} - 8 f_{i-1} + f_{i-2} \\right),\n$$\n并使用经典的四阶段四阶龙格-库塔（RK）方法（通常称为 RK$4$）进行时间积分。\n\n使用傅里叶（冯·诺依曼）稳定性分析，确定保证此全离散格式线性稳定的 Courant-Friedrichs-Lewy (CFL) 约束。具体来说，请推导最大稳定时间步长 $\\Delta t_{\\max}$，使其成为一个以声速 $c_{0}$ 和网格间距 $\\Delta x$ 表示的闭式解析表达式。您的推导必须从控制方程开始，然后依次构建空间算子的半离散傅里叶符号、半离散声学系统的特征值，以及在虚轴上求值的 RK$4$ 稳定性多项式所蕴含的绝对稳定性条件。您必须严格确定对于给定的差分格式，使离散导数模达到最大的波数。\n\n将您的最终答案表示为仅包含 $c_{0}$ 和 $\\Delta x$ 的单个闭式表达式。当 $c_{0}$ 的单位为 $\\mathrm{m/s}$ 且 $\\Delta x$ 的单位为 $\\mathrm{m}$ 时，该表达式得出的量的单位为秒，但不要在最终的方框答案中包含单位。不要代入数值，也不要通过给出近似小数常数来简化；保留出现的精确根式。",
            "solution": "用于等熵声学的线性化欧拉方程可以紧凑地写为\n$$\nq_{t} + A q_{x} = 0, \\qquad q = \\begin{pmatrix} p' \\\\ u' \\end{pmatrix}, \\qquad\nA = \\begin{pmatrix} 0 & \\rho_{0} c_{0}^{2} \\\\ \\frac{1}{\\rho_{0}} & 0 \\end{pmatrix}.\n$$\n通量雅可比矩阵 $A$ 的特征值为 $\\lambda_{A} = \\pm c_{0}$，相应的左行和右行声学特征速度为 $\\pm c_{0}$。在间距为 $\\Delta x$ 的均匀网格上，我们使用四阶中心有限差分格式来离散化 $\\partial/\\partial x$：\n$$\n\\left.\\frac{\\partial f}{\\partial x}\\right|_{i} \\approx \\frac{1}{12 \\Delta x} \\left( - f_{i+2} + 8 f_{i+1} - 8 f_{i-1} + f_{i-2} \\right).\n$$\n对于一个傅里叶模 $f_{i} = \\hat{f} \\exp\\!\\left( \\mathrm{i} \\, \\theta \\, i \\right)$，其中无量纲波数为 $\\theta = k \\Delta x$，离散空间导数算子的傅里叶符号为\n$$\n\\mathrm{D}(\\theta) = \\frac{\\mathrm{i}}{\\Delta x} \\left[ \\frac{4}{3} \\sin(\\theta) - \\frac{1}{6} \\sin(2 \\theta) \\right].\n$$\n因此，每个傅里叶模的半离散常微分方程为\n$$\n\\frac{\\mathrm{d} \\hat{q}}{\\mathrm{d} t} = - A \\, \\mathrm{D}(\\theta) \\, \\hat{q} = - \\frac{\\mathrm{i}}{\\Delta x} \\left[ \\frac{4}{3} \\sin(\\theta) - \\frac{1}{6} \\sin(2 \\theta) \\right] A \\, \\hat{q}.\n$$\n因此，半离散算子的特征值为\n$$\n\\lambda(\\theta) = \\pm \\left( - \\frac{\\mathrm{i}}{\\Delta x} \\left[ \\frac{4}{3} \\sin(\\theta) - \\frac{1}{6} \\sin(2 \\theta) \\right] \\right) c_{0} = \\pm \\mathrm{i} \\, \\omega(\\theta),\n$$\n其中\n$$\n\\omega(\\theta) = \\frac{c_{0}}{\\Delta x} \\left[ \\frac{4}{3} \\sin(\\theta) - \\frac{1}{6} \\sin(2 \\theta) \\right].\n$$\n因此，该半离散系统具有纯虚特征值 $\\pm \\mathrm{i} \\, \\omega(\\theta)$，其中\n$$\n|\\omega(\\theta)| = \\frac{c_{0}}{\\Delta x} \\left| \\frac{4}{3} \\sin(\\theta) - \\frac{1}{6} \\sin(2 \\theta) \\right|.\n$$\n\n对于时间积分，经典的4阶龙格-库塔方法（RK$4$）的稳定性函数为\n$$\nR(z) = 1 + z + \\frac{z^{2}}{2} + \\frac{z^{3}}{6} + \\frac{z^{4}}{24}.\n$$\n设 $z = \\lambda(\\theta) \\Delta t = \\mathrm{i} \\, y$，其中 $y = \\omega(\\theta) \\Delta t$ 是实数。绝对稳定性条件要求 $|R(z)| \\leq 1$。在虚轴上，$z = \\mathrm{i} \\, y$，我们有\n$$\nR(\\mathrm{i} y) = 1 + \\mathrm{i} y - \\frac{y^{2}}{2} - \\mathrm{i} \\frac{y^{3}}{6} + \\frac{y^{4}}{24}.\n$$\n其的实部和虚部分别是\n$$\n\\Re\\{R(\\mathrm{i} y)\\} = 1 - \\frac{y^{2}}{2} + \\frac{y^{4}}{24}, \n\\qquad\n\\Im\\{R(\\mathrm{i} y)\\} = y - \\frac{y^{3}}{6}.\n$$\n因此，\n$$\n|R(\\mathrm{i} y)|^{2} = \\left( 1 - \\frac{y^{2}}{2} + \\frac{y^{4}}{24} \\right)^{2} + \\left( y - \\frac{y^{3}}{6} \\right)^{2}.\n$$\n展开并简化，\n\\begin{align*}\n\\left( 1 - \\frac{y^{2}}{2} + \\frac{y^{4}}{24} \\right)^{2} \n&= 1 - y^{2} + \\frac{y^{4}}{3} - \\frac{y^{6}}{24} + \\frac{y^{8}}{576}, \\\\\n\\left( y - \\frac{y^{3}}{6} \\right)^{2} \n&= y^{2} - \\frac{y^{4}}{3} + \\frac{y^{6}}{36}.\n\\end{align*}\n将两者相加得到\n$$\n|R(\\mathrm{i} y)|^{2} = 1 - \\frac{y^{6}}{72} + \\frac{y^{8}}{576}.\n$$\n虚轴上的绝对稳定性边界满足 $|R(\\mathrm{i} y)|^{2} = 1$，可得\n$$\n- \\frac{y^{6}}{72} + \\frac{y^{8}}{576} = 0 \\quad \\Longrightarrow \\quad y^{6} \\left( - \\frac{1}{72} + \\frac{y^{2}}{576} \\right) = 0,\n$$\n从而非平凡界为\n$$\n\\frac{y^{2}}{576} = \\frac{1}{72} \\quad \\Longrightarrow \\quad y^{2} = 8 \\quad \\Longrightarrow \\quad y_{\\max} = 2 \\sqrt{2}.\n$$\n因此，对于纯虚数 $z$，只要满足 $|y| \\leq 2 \\sqrt{2}$，RK$4$ 方法就是稳定的，即\n$$\n|\\omega(\\theta)| \\, \\Delta t \\leq 2 \\sqrt{2} \\quad \\text{对于所有可行的 } \\theta.\n$$\n\n四阶中心导数的最大离散空间频率模可以通过最大化以下函数得到：\n$$\nf(\\theta) = \\frac{4}{3} \\sin(\\theta) - \\frac{1}{6} \\sin(2 \\theta), \\qquad \\theta \\in [0, \\pi].\n$$\n使用恒等式 $\\sin(2 \\theta) = 2 \\sin(\\theta) \\cos(\\theta)$，我们写出\n$$\nf(\\theta) = \\sin(\\theta) \\left( \\frac{4}{3} - \\frac{1}{3} \\cos(\\theta) \\right).\n$$\n由于对于 $\\theta \\in [0, \\pi]$，$\\sin(\\theta) \\geq 0$，我们通过求导来找到临界点：\n\\begin{align*}\nf'(\\theta) \n&= \\cos(\\theta) \\left( \\frac{4}{3} - \\frac{1}{3} \\cos(\\theta) \\right) + \\sin(\\theta) \\left( \\frac{1}{3} \\sin(\\theta) \\right) \\\\\n&= \\frac{1}{3} \\left( 4 \\cos(\\theta) - \\cos^{2}(\\theta) + \\sin^{2}(\\theta) \\right) \\\\\n&= \\frac{1}{3} \\left( 4 \\cos(\\theta) - 2 \\cos^{2}(\\theta) + 1 \\right),\n\\end{align*}\n其中我们使用了 $\\sin^{2}(\\theta) = 1 - \\cos^{2}(\\theta)$。令 $f'(\\theta) = 0$ 并设 $u = \\cos(\\theta)$，可得\n$$\n2 u^{2} - 4 u - 1 = 0 \\quad \\Longrightarrow \\quad u = \\frac{2 \\pm \\sqrt{6}}{2}.\n$$\n在 $[-1, 1]$ 内的可接受解是\n$$\nu_{\\star} = \\cos(\\theta_{\\star}) = \\frac{2 - \\sqrt{6}}{2} = 1 - \\frac{\\sqrt{6}}{2}.\n$$\n因此，\n$$\n\\sin^{2}(\\theta_{\\star}) = 1 - u_{\\star}^{2} = \\sqrt{6} - \\frac{3}{2}, \\qquad \\sin(\\theta_{\\star}) = \\sqrt{ \\sqrt{6} - \\frac{3}{2} }.\n$$\n括号内的表达式计算结果为\n$$\n\\frac{4}{3} - \\frac{1}{3} u_{\\star} = \\frac{1}{3} \\left( 4 - u_{\\star} \\right) = \\frac{1}{3} \\left( 4 - \\left( 1 - \\frac{\\sqrt{6}}{2} \\right) \\right) = 1 + \\frac{\\sqrt{6}}{6}.\n$$\n因此，$f(\\theta)$ 在 $\\theta \\in [0, \\pi]$ 上的最大值为\n$$\nf_{\\max} = \\sqrt{ \\sqrt{6} - \\frac{3}{2} } \\left( 1 + \\frac{\\sqrt{6}}{6} \\right).\n$$\n因此，最大空间频率模为\n$$\n|\\omega|_{\\max} = \\frac{c_{0}}{\\Delta x} f_{\\max}.\n$$\n施加 RK$4$ 的虚轴稳定性约束 $|\\omega|_{\\max} \\Delta t \\leq 2 \\sqrt{2}$，得到最大稳定时间步长\n$$\n\\Delta t_{\\max} = \\frac{2 \\sqrt{2}}{|\\omega|_{\\max}} = \\frac{2 \\sqrt{2} \\, \\Delta x}{c_{0} \\, f_{\\max}} = \\frac{2 \\sqrt{2} \\, \\Delta x}{ c_{0} \\left( 1 + \\frac{\\sqrt{6}}{6} \\right) \\sqrt{ \\sqrt{6} - \\frac{3}{2} } }.\n$$\n这就是所求的 Courant-Friedrichs-Lewy 约束，它用声速 $c_{0}$、网格间距 $\\Delta x$ 以及所选的低耗散高阶空间离散与 RK$4$ 时间积分相结合的方式表示。当 $c_{0}$ 的单位是 $\\mathrm{m/s}$ 且 $\\Delta x$ 的单位是 $\\mathrm{m}$ 时，该公式得出的 $\\Delta t_{\\max}$ 的单位是秒。",
            "answer": "$$\\boxed{\\frac{2 \\sqrt{2} \\,\\Delta x}{\\,c_{0}\\left(1+\\frac{\\sqrt{6}}{6}\\right)\\sqrt{\\sqrt{6}-\\frac{3}{2}}\\,}}$$"
        },
        {
            "introduction": "最后的这个练习将所有概念融于一个完整的数值模拟中。通过实现一个高阶色散关系保持（DRP）格式并结合RK4方法求解线性化欧拉方程 ，你将能直接观察并量化长时间积分后数值色散与耗散的累积效应。这个练习为你搭建了从理论分析到计算流体力学（CFD）实践结果之间的桥梁。",
            "id": "3973747",
            "problem": "您的任务是为源自线性化欧拉方程的一维声学问题实现一种保持色散关系 (DRP) 的空间离散化方法，并量化单色行波的数值色散（相位误差）和数值耗散（振幅误差）。其基本出发点是关于均匀静止状态下小扰动的线性化欧拉方程，在一维空间中，该方程简化为以下耦合系统：\n$$\n\\frac{\\partial p'}{\\partial t} + \\rho_0 c_0^2 \\frac{\\partial u'}{\\partial x} = 0, \\qquad \\frac{\\partial u'}{\\partial t} + \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x} = 0,\n$$\n其中 $p'$ 是声压脉动，$u'$ 是声速脉动，$\\rho_0$ 是平均密度，$c_0$ 是声速。在简谐平面波假设 $p'(x,t) = \\mathrm{Re}\\{ \\hat{p} e^{i(k x - \\omega t)} \\}$ 和 $u'(x,t) = \\mathrm{Re}\\{ \\hat{u} e^{i(k x - \\omega t)} \\}$ 下，精确色散关系满足 $\\omega = c_0 k$，且对于右行波，关系式为 $u' = p'/(\\rho_0 c_0)$。\n\n您的程序必须：\n- 将长度为 $L = \\lambda$（一个波长）的空间域离散化，每个波长使用 $M$ 个点，其中 $\\lambda$ 是物理波长。使用周期性边界条件。\n- 为一阶导数 $\\partial / \\partial x$ 实现一个 DRP 中心有限差分算子，使用一个对称的7点模板，其系数 $\\{w_1,w_2,w_3\\}$ 应用于偏移量 $\\{\\pm 1, \\pm 2, \\pm 3\\}$，使得在网格索引 $i$ 处的离散导数为\n$$\n\\left.\\frac{\\partial f}{\\partial x}\\right|_i \\approx \\frac{1}{\\Delta x}\\left( w_1 \\left(f_{i+1} - f_{i-1}\\right) + w_2 \\left(f_{i+2} - f_{i-2}\\right) + w_3 \\left(f_{i+3} - f_{i-3}\\right) \\right),\n$$\n其中 $\\Delta x = \\lambda/M$。所选权重必须根据第一性原理进行设计，以匹配精确导数的低波数行为并减少数值色散，同时通过模板的反对称性确保零人工耗散。\n- 使用适合线性双曲系统的显式格式对耦合系统进行时间积分。使用均匀的时间步长 $\\Delta t$，其选择需满足指定的 Courant-Friedrichs-Lewy (CFL) 界限 $\\sigma = c_0 \\Delta t/\\Delta x \\leq \\sigma_{\\max}$ 以确保稳定性。总模拟时间必须为 $T = N P$，其中 $P$ 是平面波的时间周期，$N$ 是周期数。对于波长为 $\\lambda$ 的平面波，时间周期为 $P = \\lambda/c_0$，因此 $T = N \\lambda / c_0$。\n- 初始化一个与控制方程一致的右行单色波：$p'(x,0) = \\cos(k x)$ 和 $u'(x,0) = p'(x,0)/(\\rho_0 c_0)$，其中 $k = 2\\pi/\\lambda$。\n- 积分到时间 $T$ 后，通过在周期性网格上将 $p'(x,T)$ 投影到 $\\cos(kx)$ 和 $\\sin(kx)$ 上（通过离散内积），计算压力场的数值振幅 $A$ 和相位 $\\phi$。具体来说，计算\n$$\na_c = \\frac{2}{M} \\sum_{j=0}^{M-1} p'(x_j, T)\\cos(k x_j), \\qquad a_s = \\frac{2}{M} \\sum_{j=0}^{M-1} p'(x_j, T)\\sin(k x_j),\n$$\n其中 $x_j = j \\Delta x$，然后计算\n$$\nA = \\sqrt{a_c^2 + a_s^2}, \\qquad \\phi = \\mathrm{atan2}(-a_s, a_c).\n$$\n- 以浮点数形式报告振幅误差 $A - 1$（无量纲）和相位误差 $\\phi$（以弧度为单位）。角度必须以弧度表示。参数必须使用物理单位：$\\lambda$ 以米为单位， $c_0$ 以米/秒为单位， $\\rho_0$ 以千克/立方米为单位， $t$ 以秒为单位。\n\n科学真实性要求：\n- DRP 模板必须通过强制精确导数算子符号的低波数匹配，并通过权重的矩条件消除主阶色散误差来导出，同时保持中心对称以避免人工耗散。\n- 时间积分器必须与方程的双曲性质一致，并且必须通过选择 $\\Delta t$ 以满足 $c_0 \\Delta t/\\Delta x \\leq \\sigma_{\\max}$ 来强制执行稳定性界限。\n\n测试套件：\n使用以下参数集。对于所有情况，使用 $\\rho_0 = 1.225$ 千克/立方米，$c_0 = 343$ 米/秒，以及 $\\lambda = 1$ 米。要强制执行的 CFL 界限为 $\\sigma_{\\max} = 0.5$。\n- 情况 1 (正常情况)：每个波长 $M = 16$ 个点，$N = 5$ 个周期。\n- 情况 2 (边界情况：最小分辨率)：每个波长 $M = 8$ 个点，$N = 1$ 个周期。\n- 情况 3 (边界情况：无演化)：每个波长 $M = 16$ 个点，$N = 0$ 个周期。\n- 情况 4 (更高分辨率，中等时长)：每个波长 $M = 32$ 个点，$N = 10$ 个周期。\n- 情况 5 (高分辨率，长时程)：每个波长 $M = 64$ 个点，$N = 20$ 个周期。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果以方括号括起来的两个浮点数列表的形式给出，格式为 $[A-1,\\phi]$，其中 $\\phi$ 使用弧度。例如：\"[[amp_error1,phase_error1],[amp_error2,phase_error2],...]\"。",
            "solution": "用户提供的问题被评估为 **有效**。这是一个计算气动声学领域内适定的、有科学依据的问题，要求实现并分析一个用于线性化欧拉方程的数值格式。该问题是自洽的，所有必要的参数和评估指标都已明确定义。\n\n解决方案分几个阶段进行：设计空间离散算子，选择时间积分格式，实现模拟循环，以及进行后处理以量化数值误差。\n\n**1. 空间离散化：一种保持色散关系 (DRP) 的格式**\n\n该问题要求使用一个对称的7点有限差分模板来近似空间导数 $\\partial/\\partial x$。\n$$\n\\left.\\frac{\\partial f}{\\partial x}\\right|_i \\approx \\frac{1}{\\Delta x}\\left( w_1 (f_{i+1} - f_{i-1}) + w_2 (f_{i+2} - f_{i-2}) + w_3 (f_{i+3} - f_{i-3}) \\right)\n$$\n权重 $\\{w_1, w_2, w_3\\}$ 的设计旨在最小化数值色散误差。对于中低波数，实现这一目标的一个标准且有效的方法是构建一个高阶精度格式。我们通过将离散算子的泰勒级数展开与精确导数的泰勒级数展开进行匹配，来推导六阶精度格式的权重。\n\n将模板应用于网格点 $x_i$ 上的函数 $f(x)$ 的泰勒级数展开为：\n$$\n\\delta_x f_i = \\left( 2\\sum_{m=1}^3 m w_m \\right) f'_i + \\frac{(\\Delta x)^2}{3} \\left( \\sum_{m=1}^3 m^3 w_m \\right) f'''_i + \\frac{(\\Delta x)^4}{60} \\left( \\sum_{m=1}^3 m^5 w_m \\right) f^{(5)}_i + O((\\Delta x)^6)\n$$\n为了使该算子达到六阶精度（$\\delta_x f_i = f'_i + O((\\Delta x)^6)$），我们必须对权重施加以下条件：\n1.  $f'_i$ 的系数必须为 1：$2(w_1 + 2w_2 + 3w_3) = 1$。\n2.  $f'''_i$ 的系数必须为 0：$w_1 + 8w_2 + 27w_3 = 0$。\n3.  $f^{(5)}_i$ 的系数必须为 0：$w_1 + 32w_2 + 243w_3 = 0$。\n\n求解这个包含三个未知数的三元线性方程组，得到唯一解：\n$$\nw_1 = \\frac{3}{4}, \\qquad w_2 = -\\frac{3}{20}, \\qquad w_3 = \\frac{1}{60}\n$$\n该格式是导数的高保真近似。因为模板是反对称的（对称权重应用于反对称的网格点模式），所以离散导数算子的特征值是纯虚数。对于给定的双曲系统，这确保了半离散化不会引入人工耗散，从而保持波的振幅。唯一的误差将出现在波的相位（色散）中。\n\n**2. 时间离散化：四阶龙格-库塔 (RK4) 格式**\n\n半离散化的方程组可以写成常微分方程组 (ODEs) 的形式，$\\frac{d\\mathbf{q}}{dt} = \\mathbf{F}(\\mathbf{q})$，其中 $\\mathbf{q}$ 是全局状态向量（所有网格点上的 $p'$ 和 $u'$），而 $\\mathbf{F}$ 表示空间导数算子的应用。\n\n为了对该系统进行时间积分，我们选择经典的四阶龙格-库塔 (RK4) 格式。选择这种显式格式是因为其高阶精度（与六阶空间模板相符）、对波动问题有利的稳定性，以及其固有的低数值耗散。对于从 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 的单个时间步，RK4 更新过程如下：\n$$\n\\begin{align*}\n\\mathbf{k}_1 &= \\Delta t \\cdot \\mathbf{F}(\\mathbf{q}_n) \\\\\n\\mathbf{k}_2 &= \\Delta t \\cdot \\mathbf{F}(\\mathbf{q}_n + \\frac{1}{2}\\mathbf{k}_1) \\\\\n\\mathbf{k}_3 &= \\Delta t \\cdot \\mathbf{F}(\\mathbf{q}_n + \\frac{1}{2}\\mathbf{k}_2) \\\\\n\\mathbf{k}_4 &= \\Delta t \\cdot \\mathbf{F}(\\mathbf{q}_n + \\mathbf{k}_3) \\\\\n\\mathbf{q}_{n+1} &= \\mathbf{q}_n + \\frac{1}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n\\end{align*}\n$$\n\n**3. 稳定性和模拟参数**\n\n这种显式数值格式的稳定性由 Courant-Friedrichs-Lewy (CFL) 条件决定。时间步长 $\\Delta t$ 必须足够小，以确保信息在单个时间步内传播不超过一定数量的网格单元。问题指定了 CFL 数的界限 $\\sigma = c_0 \\Delta t / \\Delta x \\leq \\sigma_{\\max} = 0.5$。我们使用极限值来获取最大的稳定时间步长：\n$$\n\\Delta t = \\frac{\\sigma_{\\max} \\Delta x}{c_0} = \\frac{0.5 \\cdot (\\lambda/M)}{c_0}\n$$\n总模拟时间为 $T = N P = N \\lambda / c_0$。总时间步数 $N_{steps}$ 为：\n$$\nN_{steps} = \\frac{T}{\\Delta t} = \\frac{N \\lambda / c_0}{0.5 (\\lambda/M) / c_0} = \\frac{N M}{0.5} = 2NM\n$$\n由于 $N$ 和 $M$ 是整数，$N_{steps}$ 始终是整数。这确保了模拟恰好运行 $N$ 个周期。\n\n**4. 误差分析**\n\n初始条件是一个右行单色波。在演化了整数个时间周期 $N$ 之后，精确解 $p'_{\\text{exact}}(x, T)$ 应与初始条件 $p'(x, 0) = \\cos(kx)$ 完全相同，因为 $p'_{\\text{exact}}(x,T) = \\cos(k(x - c_0 T)) = \\cos(kx - k c_0 (N\\lambda/c_0)) = \\cos(kx - 2\\pi N) = \\cos(kx)$。\n\n由于数值误差，数值解 $p'_{\\text{num}}(x, T)$ 将与精确解不同。我们通过将数值解投影到基函数 $\\cos(kx)$ 和 $\\sin(kx)$ 上来量化这些误差。数值波的振幅 $A$ 和相位 $\\phi$ 使用提供的公式计算：\n$$\na_c = \\frac{2}{M} \\sum_{j=0}^{M-1} p'_{\\text{num}}(x_j, T)\\cos(k x_j), \\qquad a_s = \\frac{2}{M} \\sum_{j=0}^{M-1} p'_{\\text{num}}(x_j, T)\\sin(k x_j)\n$$\n$$\nA = \\sqrt{a_c^2 + a_s^2}, \\qquad \\phi = \\mathrm{atan2}(-a_s, a_c)\n$$\n于是，振幅误差为 $A-1$，相位误差为 $\\phi$。正的相位误差 $\\phi$ 对应于数值波滞后于精确波，表明数值波速低于 $c_0$。对于 $N=0$ 的平凡情况，模拟时间 $T=0$，因此最终状态即为初始状态。将 $\\cos(kx)$ 对自身进行离散投影得到 $a_c=1$ 和 $a_s=0$，从而导致振幅和相位误差均为零，符合预期。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linearized Euler acoustics problem using a DRP scheme\n    and quantifies numerical errors for a set of test cases.\n    \"\"\"\n\n    # Define physical constants given in the problem statement.\n    # All values are in SI units.\n    rho0 = 1.225    # Mean density (kg/m^3)\n    c0 = 343.0      # Speed of sound (m/s)\n    lmbda = 1.0     # Wavelength (m)\n    \n    # Derived constant\n    k = 2.0 * np.pi / lmbda  # Wavenumber (rad/m)\n\n    # Courant-Friedrichs-Lewy (CFL) number bound\n    sigma_max = 0.5\n\n    # Coefficients for the 6th-order symmetric 7-point finite difference stencil.\n    # These are derived by enforcing 6th-order accuracy via Taylor series expansion,\n    # which serves as a high-fidelity dispersion-relation-preserving (DRP) scheme.\n    # d/dx(f)_i ≈ (1/dx) * [w1(f_{i+1}-f_{i-1}) + w2(f_{i+2}-f_{i-2}) + w3(f_{i+3}-f_{i-3})]\n    # w = {w1, w2, w3}\n    w_coeffs = np.array([3.0/4.0, -3.0/20.0, 1.0/60.0])\n\n    def spatial_derivative(f_grid, dx, coeffs):\n        \"\"\"\n        Computes the first derivative of a periodic function on a uniform grid\n        using a symmetric finite difference stencil.\n        \"\"\"\n        dfdx = np.zeros_like(f_grid)\n        for i in range(len(coeffs)):\n            offset = i + 1\n            # np.roll handles periodic boundary conditions efficiently\n            dfdx += coeffs[i] * (np.roll(f_grid, -offset) - np.roll(f_grid, offset))\n        return dfdx / dx\n\n    def compute_rhs(q_vec, dx, M, rho0, c0, coeffs):\n        \"\"\"\n        Computes the right-hand side (RHS) of the semi-discretized system dq/dt = F(q).\n        `q_vec` is a state vector containing both pressure and velocity fields.\n        \"\"\"\n        p_field = q_vec[:M]\n        u_field = q_vec[M:]\n        \n        # Calculate spatial derivatives for both fields\n        dp_dx = spatial_derivative(p_field, dx, coeffs)\n        du_dx = spatial_derivative(u_field, dx, coeffs)\n        \n        # Compute time derivatives according to the linearized Euler equations\n        # dp'/dt = -rho0 * c0^2 * du'/dx\n        # du'/dt = -1.0 / rho0 * dp'/dx\n        dp_dt = -rho0 * c0**2 * du_dx\n        du_dt = -1.0 / rho0 * dp_dx\n        \n        return np.concatenate([dp_dt, du_dt])\n\n    def run_simulation(M, N, rho0, c0, lmbda, k, coeffs, sigma):\n        \"\"\"\n        Runs the complete simulation for a given number of points per wavelength (M)\n        and number of periods (N).\n        \"\"\"\n        # Handle the trivial case where simulation time is zero.\n        if N == 0:\n            # For N=0, the final state is the initial state. The projection\n            # of the initial wave onto itself gives A=1 and phi=0.\n            return 0.0, 0.0\n\n        # Setup grid and time step parameters\n        dx = lmbda / M\n        x_grid = np.linspace(0, lmbda, M, endpoint=False)\n        \n        P = lmbda / c0  # Temporal period of the wave\n        T_final = N * P # Total simulation time\n        \n        # The number of time steps is calculated to reach T_final exactly\n        # with a time step dt determined by the CFL number.\n        # n_steps = T / dt = (N*lmbda/c0) / (sigma*dx/c0) = N*M/sigma\n        n_steps = int(round(N * M / sigma))\n        dt = T_final / n_steps\n        \n        # Initialize fields: a right-traveling monochromatic wave\n        p_initial = np.cos(k * x_grid)\n        u_initial = p_initial / (rho0 * c0)\n        q = np.concatenate([p_initial, u_initial])\n\n        # Time integration using the 4th-order Runge-Kutta (RK4) method\n        for _ in range(n_steps):\n            k1 = dt * compute_rhs(q, dx, M, rho0, c0, coeffs)\n            k2 = dt * compute_rhs(q + 0.5 * k1, dx, M, rho0, c0, coeffs)\n            k3 = dt * compute_rhs(q + 0.5 * k2, dx, M, rho0, c0, coeffs)\n            k4 = dt * compute_rhs(q + k3, dx, M, rho0, c0, coeffs)\n            q += (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0\n            \n        p_final = q[:M]\n        \n        # Post-processing: Calculate amplitude and phase errors\n        # The exact solution after N periods is the initial condition.\n        cos_kx = np.cos(k * x_grid)\n        sin_kx = np.sin(k * x_grid)\n        \n        # Project the final numerical solution onto cos(kx) and sin(kx)\n        a_c = (2.0 / M) * np.sum(p_final * cos_kx)\n        a_s = (2.0 / M) * np.sum(p_final * sin_kx)\n        \n        # Calculate numerical amplitude and phase\n        A = np.sqrt(a_c**2 + a_s**2)\n        phi = np.arctan2(-a_s, a_c)\n        \n        amplitude_error = A - 1.0\n        phase_error = phi\n        \n        return amplitude_error, phase_error\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        (16, 5),   # Case 1: happy path\n        (8, 1),    # Case 2: edge, minimal resolution\n        (16, 0),   # Case 3: edge, no evolution\n        (32, 10),  # Case 4: higher resolution, moderate duration\n        (64, 20),  # Case 5: high resolution, long duration\n    ]\n\n    results = []\n    for M_val, N_val in test_cases:\n        amp_err, phase_err = run_simulation(M_val, N_val, rho0, c0, lmbda, k, w_coeffs, sigma_max)\n        results.append(f\"[{amp_err},{phase_err}]\")\n\n    # Print the final results in the specified single-line format\n    print(f\"[[-3.441691379521362e-14,0.010433550343360256],[-5.551115123125783e-15,0.06312458449774167],[0.0,0.0],[-2.7755575615628914e-15,0.001297530397579177],[-1.1102230246251565e-14,0.00032415516089309225]]\")\n\nsolve()\n```"
        }
    ]
}