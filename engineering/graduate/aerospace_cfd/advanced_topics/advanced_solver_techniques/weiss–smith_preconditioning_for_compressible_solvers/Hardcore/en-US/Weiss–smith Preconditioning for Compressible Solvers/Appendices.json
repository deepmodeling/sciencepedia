{
    "hands_on_practices": [
        {
            "introduction": "We begin by exploring the fundamental reason why preconditioning is necessary for compressible flow solvers operating at low speeds. Standard numerical schemes can introduce errors that behave counter-intuitively as the Mach number $M$ approaches zero. This exercise guides you through a theoretical analysis to uncover how the numerical dissipation in a Roe-type scheme becomes unphysically large, damaging the crucial coupling between pressure and velocity and motivating the need for preconditioning .",
            "id": "4006379",
            "problem": "Consider the one-dimensional compressible Euler equations written in conservative variables $\\boldsymbol{U} = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}}$ and discretized in space on a uniform grid with spacing $\\Delta x$ using a Roe-type approximate Riemann solver. The numerical flux at an interface $i+\\tfrac{1}{2}$ is constructed by a central average plus a dissipation term derived from the spectral decomposition of the flux Jacobian at the Roe-averaged state. Assume a uniform base flow with constant density $\\rho_0$, pressure $p_0$, and velocity $u_0$, and define the Mach number $M = u_0/a_0$, where $a_0 = \\sqrt{\\gamma p_0/\\rho_0}$ is the speed of sound and $\\gamma$ is the ratio of specific heats. Consider small-amplitude, smoothly varying isentropic perturbations about this base state.\n\nStarting from the compressible Euler equations and the structure of a Roe-type flux, perform a linearization of the semi-discrete scheme about the uniform base state and derive the leading-order equivalent differential operator that the numerical dissipation induces for the pressure perturbation $p'(x,t)$. Carefully use Taylor expansions to relate flux differences to spatial derivatives, and explicitly identify how the acoustic characteristic speeds enter the equivalent artificial diffusion that appears in the linearized system. In the low-Mach-number limit $M \\to 0$, determine the leading-order dependence of the artificial pressure diffusion coefficient on $M$.\n\nThen, explain why this scaling damages pressure–velocity coupling as $M \\to 0$ when using naive flux splitting (i.e., using the unmodified acoustic eigenvalues in the dissipation), and briefly relate this to the motivation for Weiss–Smith preconditioning, which rescales the acoustic contributions to restore correct low-Mach behavior.\n\nYour final task is to provide the analytic expression for the leading-order artificial diffusion coefficient multiplying $\\partial_{xx} p'$ in the equivalent linearized pressure evolution induced by the Roe-type dissipation without preconditioning, expressed in terms of $\\Delta x$, $u_0$, and $M$. Express your final answer in SI units of $\\mathrm{m}^2/\\mathrm{s}$. No numerical evaluation is required.",
            "solution": "The analysis begins with the one-dimensional compressible Euler equations in conservative form, $\\partial_t \\boldsymbol{U} + \\partial_x \\boldsymbol{F}(\\boldsymbol{U}) = 0$, where the state vector is $\\boldsymbol{U} = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}}$ and the flux vector is $\\boldsymbol{F}(\\boldsymbol{U}) = (\\rho u, \\rho u^2 + p, u(\\rho E + p))^{\\mathsf{T}}$. The total energy per unit mass is $E = \\frac{p}{\\rho(\\gamma-1)} + \\frac{1}{2}u^2$.\n\nA semi-discretization on a uniform grid with spacing $\\Delta x$ using a Roe-type approximate Riemann solver leads to the following equation at node $i$:\n$$\n\\frac{d\\boldsymbol{U}_i}{dt} = -\\frac{1}{\\Delta x}(\\boldsymbol{F}_{i+1/2} - \\boldsymbol{F}_{i-1/2})\n$$\nThe numerical flux $\\boldsymbol{F}_{i+1/2}$ is constructed from a central average and a dissipation term:\n$$\n\\boldsymbol{F}_{i+1/2} = \\frac{1}{2}(\\boldsymbol{F}(\\boldsymbol{U}_i) + \\boldsymbol{F}(\\boldsymbol{U}_{i+1})) - \\frac{1}{2} |\\tilde{\\boldsymbol{A}}_{i+1/2}| (\\boldsymbol{U}_{i+1} - \\boldsymbol{U}_i)\n$$\nwhere $\\tilde{\\boldsymbol{A}}_{i+1/2}$ is the flux Jacobian $\\partial\\boldsymbol{F}/\\partial\\boldsymbol{U}$ evaluated at the Roe-averaged state between $\\boldsymbol{U}_i$ and $\\boldsymbol{U}_{i+1}$. The matrix $|\\tilde{\\boldsymbol{A}}|$ is defined via the spectral decomposition $\\tilde{\\boldsymbol{A}} = \\tilde{\\boldsymbol{R}} \\tilde{\\boldsymbol{\\Lambda}} \\tilde{\\boldsymbol{L}}$, such that $|\\tilde{\\boldsymbol{A}}| = \\tilde{\\boldsymbol{R}} |\\tilde{\\boldsymbol{\\Lambda}}| \\tilde{\\boldsymbol{L}}$, where $|\\tilde{\\boldsymbol{\\Lambda}}|$ is the diagonal matrix of the absolute values of the eigenvalues of $\\tilde{\\boldsymbol{A}}$.\n\nSubstituting the flux expression into the semi-discrete equation yields:\n$$\n\\frac{d\\boldsymbol{U}_i}{dt} = -\\frac{\\boldsymbol{F}_{i+1} - \\boldsymbol{F}_{i-1}}{2\\Delta x} + \\frac{1}{2\\Delta x} \\left( |\\tilde{\\boldsymbol{A}}_{i+1/2}|(\\boldsymbol{U}_{i+1} - \\boldsymbol{U}_i) - |\\tilde{\\boldsymbol{A}}_{i-1/2}|(\\boldsymbol{U}_{i} - \\boldsymbol{U}_{i-1}) \\right)\n$$\nThe first term is a central difference approximation of the flux derivative. The second term represents the numerical dissipation. For small, smooth perturbations around a uniform base flow $(\\rho_0, u_0, p_0)$, the Roe-averaged Jacobian $\\tilde{\\boldsymbol{A}}$ at any interface can be approximated by the constant Jacobian at the base state, $\\boldsymbol{A}_0$. The dissipation term operator on $\\boldsymbol{U}_i$ then becomes:\n$$\n\\boldsymbol{D}_i \\approx \\frac{1}{2\\Delta x} |\\boldsymbol{A}_0| ((\\boldsymbol{U}_{i+1} - \\boldsymbol{U}_i) - (\\boldsymbol{U}_i - \\boldsymbol{U}_{i-1})) = \\frac{1}{2\\Delta x} |\\boldsymbol{A}_0| (\\boldsymbol{U}_{i+1} - 2\\boldsymbol{U}_i + \\boldsymbol{U}_{i-1})\n$$\nUsing a Taylor series expansion, the term $(\\boldsymbol{U}_{i+1} - 2\\boldsymbol{U}_i + \\boldsymbol{U}_{i-1})$ is a second-order approximation of $(\\Delta x)^2 \\partial_{xx}\\boldsymbol{U}$. Thus, the leading-order equivalent differential operator for the numerical dissipation is:\n$$\n\\boldsymbol{D} = \\frac{\\Delta x}{2} |\\boldsymbol{A}_0| \\partial_{xx}\\boldsymbol{U}\n$$\nThe linearized semi-discrete scheme is equivalent to the system $\\partial_t \\boldsymbol{U}' + \\boldsymbol{A}_0 \\partial_x \\boldsymbol{U}' = \\frac{\\Delta x}{2} |\\boldsymbol{A}_0| \\partial_{xx} \\boldsymbol{U}'$, where $\\boldsymbol{U}'$ represents the perturbation from the base state.\n\nTo analyze the effect on pressure, we transform to characteristic variables. Let $\\boldsymbol{L}_0$ be the matrix of left eigenvectors of $\\boldsymbol{A}_0$. Multiplying by $\\boldsymbol{L}_0$ diagonalizes the system, yielding a set of decoupled advection-diffusion equations for the characteristic variable perturbations $\\boldsymbol{W} = \\boldsymbol{L}_0 \\boldsymbol{U}'$:\n$$\n\\partial_t \\boldsymbol{W} + \\boldsymbol{\\Lambda}_0 \\partial_x \\boldsymbol{W} = \\frac{\\Delta x}{2} |\\boldsymbol{\\Lambda}_0| \\partial_{xx} \\boldsymbol{W}\n$$\nHere, $\\boldsymbol{\\Lambda}_0$ is the diagonal matrix of eigenvalues of $\\boldsymbol{A}_0$, which are the characteristic speeds: $\\lambda_1 = u_0$ (entropy/contact wave), $\\lambda_2 = u_0 - a_0$ (left-running acoustic wave), and $\\lambda_3 = u_0 + a_0$ (right-running acoustic wave), with $a_0 = \\sqrt{\\gamma p_0/\\rho_0}$.\n\nEach characteristic variable perturbation $w_k$ evolves according to:\n$$\n\\partial_t w_k + \\lambda_k \\partial_x w_k = \\frac{\\Delta x}{2} |\\lambda_k| \\partial_{xx} w_k\n$$\nFor isentropic perturbations, the change in pressure $dp$ and density $d\\rho$ are related by $dp = a^2 d\\rho$. The characteristic variable corresponding to the entropy wave is stationary ($dw_1 \\propto dp - a^2 d\\rho = 0$). The acoustic characteristic perturbations can be defined in terms of primitive variable perturbations $(p', u')$ as $dw_2 = dp' - \\rho_0 a_0 du'$ and $dw_3 = dp' + \\rho_0 a_0 du'$. From this, we can express the pressure perturbation as $p' = \\frac{1}{2}(w_2 + w_3)$.\n\nThe evolution equation for $p'$ is obtained by summing the equations for $w_2$ and $w_3$ and dividing by $2$. The diffusion part of the resulting equation for $p'$ is:\n$$\nD_{p'} = \\frac{1}{2} \\left( \\frac{\\Delta x}{2}|\\lambda_2| \\partial_{xx}w_2 + \\frac{\\Delta x}{2}|\\lambda_3| \\partial_{xx}w_3 \\right) = \\frac{\\Delta x}{4} \\left( |u_0-a_0|\\partial_{xx}w_2 + |u_0+a_0|\\partial_{xx}w_3 \\right)\n$$\nTo find the artificial diffusion coefficient for $p'$, we substitute $w_2 = p' - \\rho_0 a_0 u'$ and $w_3 = p' + \\rho_0 a_0 u'$:\n$$\nD_{p'} = \\frac{\\Delta x}{4} \\left( |u_0-a_0|\\partial_{xx}(p' - \\rho_0 a_0 u') + |u_0+a_0|\\partial_{xx}(p' + \\rho_0 a_0 u') \\right)\n$$\nThe coefficient of the $\\partial_{xx}p'$ term is the artificial pressure diffusion coefficient, $\\nu_{pp}$:\n$$\n\\nu_{pp} = \\frac{\\Delta x}{4} \\left( |u_0-a_0| + |u_0+a_0| \\right)\n$$\nIn the low-Mach-number limit ($M = u_0/a_0 \\to 0$), the flow is subsonic, $u_0  a_0$. Therefore, $|u_0-a_0| = a_0-u_0$ and $|u_0+a_0| = a_0+u_0$. The coefficient simplifies to:\n$$\n\\nu_{pp} = \\frac{\\Delta x}{4} \\left( (a_0 - u_0) + (a_0 + u_0) \\right) = \\frac{\\Delta x a_0}{2}\n$$\nTo express this in terms of $M=u_0/a_0$, we substitute $a_0 = u_0/M$:\n$$\n\\nu_{pp} = \\frac{\\Delta x}{2} \\left(\\frac{u_0}{M}\\right) = \\frac{\\Delta x u_0}{2M}\n$$\nThis expression reveals the core problem of naive compressible solvers at low speeds. As $M \\to 0$, the artificial diffusion coefficient for pressure $\\nu_{pp}$ scales as $M^{-1}$, becoming excessively large. The physical behavior of low-Mach-number flows approaches that of incompressible flow, where pressure and velocity are tightly coupled through an elliptic constraint ($\\nabla^2 p \\sim \\text{source}$). The enormous artificial pressure diffusion, scaled by the large acoustic speed $a_0$ rather than the small flow speed $u_0$, overwhelms the physical pressure evolution. It effectively decouples the pressure field from the velocity field, preventing the scheme from correctly capturing the incompressible behavior. This leads to severe convergence degradation and inaccurate solutions, particularly for the pressure field.\n\nWeiss–Smith preconditioning is designed to remedy this flaw. It modifies the system's time derivatives, which has the effect of re-scaling the eigenvalues of the system Jacobian. The goal is to make all eigenvalues of the same order of magnitude in the low-Mach limit. For the numerical flux, this corresponds to replacing the dissipation scaling $|\\lambda_k|$ with a re-scaled value. Specifically, the acoustic speeds $|u_0 \\pm a_0| \\approx a_0$ are replaced by a modified speed on the order of the flow velocity, i.e., scaling with $u_0$. This reduces the artificial pressure diffusion coefficient from $O(a_0)$ to $O(u_0)$, thereby restoring the correct pressure-velocity coupling and ensuring the scheme has the proper incompressible limit.\n\nThe leading-order artificial diffusion coefficient multiplying $\\partial_{xx}p'$ is $\\frac{\\Delta x a_0}{2}$. Expressed in the requested variables, this is $\\frac{\\Delta x u_0}{2M}$.",
            "answer": "$$\\boxed{\\frac{\\Delta x u_0}{2M}}$$"
        },
        {
            "introduction": "Having established the need for preconditioning, we now examine its impact on the numerical algorithm itself. While preconditioning cures the physical stiffness of the partial differential equation system, it directly alters the system's characteristic speeds. This practice uses von Neumann stability analysis, a cornerstone of numerical methods, to quantify the trade-off between improved physical conditioning and the modified stability limits of an explicit time-marching scheme .",
            "id": "4006455",
            "problem": "Consider the one-dimensional linearized isentropic acoustic subsystem of the compressible Euler equations about a uniform state within the context of Computational Fluid Dynamics (CFD). Let the primitive variable vector be $q = \\begin{pmatrix} p \\\\ u \\end{pmatrix}$, where $p$ is pressure and $u$ is velocity. Assume constant base density $\\rho$ and constant speed of sound $a$. The linearized system can be written as\n$$\n\\frac{\\partial q}{\\partial t} + A \\frac{\\partial q}{\\partial x} = 0,\n$$\nwith the flux Jacobian\n$$\nA = \\begin{pmatrix} 0  \\rho a^{2} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix}.\n$$\nTo address low-Mach-number stiffness, apply Weiss–Smith preconditioning using a diagonal preconditioning matrix $P(\\beta) = \\operatorname{diag}(\\beta, 1)$ (with $0  \\beta \\leq 1$), producing the preconditioned system\n$$\nP(\\beta)\\,\\frac{\\partial q}{\\partial t} + A\\,\\frac{\\partial q}{\\partial x} = 0.\n$$\nDiscretize this system on a uniform grid with spacing $\\Delta x$ using explicit forward Euler time stepping with time step $\\Delta t$, and a first-order upwind spatial discretization applied in characteristic variables of the preconditioned operator. Perform a von Neumann (Fourier) analysis by considering a single Fourier mode $q_{j}^{n} = \\hat{q}^{n}\\exp(i \\theta j)$, where $j$ indexes grid points and $n$ indexes time levels, to derive the amplification matrix and its eigenvalues. Then, obtain the stability condition in terms of the preconditioning parameter $\\beta$ and the conventional acoustic Courant–Friedrichs–Lewy (CFL) number defined by\n$$\n\\mathrm{CFL}_{a} = \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\nDetermine the boundary of the stability region in the $(\\beta,\\mathrm{CFL}_{a})$-plane for this explicit scheme by expressing the maximal admissible $\\mathrm{CFL}_{a}$ as a function of $\\beta$. Provide the final answer as a single closed-form analytic expression for the maximal $\\mathrm{CFL}_{a}$ in terms of $\\beta$. No rounding is required. The CFL number is dimensionless; do not include units in your final answer.",
            "solution": "The user wants to find the stability condition for a preconditioned system.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n-   The system of partial differential equations is $\\frac{\\partial q}{\\partial t} + A \\frac{\\partial q}{\\partial x} = 0$.\n-   The primitive variable vector is $q = \\begin{pmatrix} p \\\\ u \\end{pmatrix}$, where $p$ is pressure and $u$ is velocity.\n-   The flux Jacobian is $A = \\begin{pmatrix} 0  \\rho a^{2} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix}$, with constant density $\\rho$ and constant speed of sound $a$.\n-   The preconditioning matrix is $P(\\beta) = \\operatorname{diag}(\\beta, 1) = \\begin{pmatrix} \\beta  0 \\\\ 0  1 \\end{pmatrix}$, with $0  \\beta \\leq 1$.\n-   The preconditioned system is $P(\\beta)\\,\\frac{\\partial q}{\\partial t} + A\\,\\frac{\\partial q}{\\partial x} = 0$.\n-   The numerical scheme is:\n    -   Time integration: Explicit forward Euler.\n    -   Spatial discretization: First-order upwind applied to the characteristic variables of the preconditioned operator.\n    -   Grid: Uniform with spacing $\\Delta x$ and time step $\\Delta t$.\n-   The analysis method is a von Neumann (Fourier) analysis using a single mode $q_{j}^{n} = \\hat{q}^{n}\\exp(i \\theta j)$.\n-   The conventional acoustic Courant–Friedrichs–Lewy (CFL) number is defined as $\\mathrm{CFL}_{a} = \\frac{a\\,\\Delta t}{\\Delta x}$.\n-   The objective is to find the maximal admissible $\\mathrm{CFL}_{a}$ as a function of $\\beta$.\n\n**1.2. Validate Using Extracted Givens**\n-   **Scientifically Grounded**: The problem is set in the context of computational fluid dynamics (CFD), using the linearized Euler equations, a standard model for acoustics. Weiss–Smith preconditioning is a well-established technique for low-Mach-number flows. Von Neumann stability analysis is a fundamental tool for analyzing numerical schemes. The problem is firmly rooted in established principles of applied mathematics and fluid dynamics.\n-   **Well-Posed**: The problem is clearly defined. It specifies the governing equations, the preconditioning, the numerical method, and the analysis technique. The goal is a specific, derivable quantity (the stability boundary). A unique solution is expected.\n-   **Objective**: The language is precise, mathematical, and free of any subjectivity.\n-   **Completeness and Consistency**: All necessary matrices, parameters, and definitions are provided. There are no apparent contradictions in the problem statement.\n\n**1.3. Verdict and Action**\nThe problem is deemed **valid**. I will proceed with the solution.\n\n### Step 2: Solution\n\nThe preconditioned system is given by\n$$\nP(\\beta)\\,\\frac{\\partial q}{\\partial t} + A\\,\\frac{\\partial q}{\\partial x} = 0\n$$\nMultiplying by the inverse of the preconditioning matrix, $P^{-1}(\\beta)$, we obtain a system in standard conservative form:\n$$\n\\frac{\\partial q}{\\partial t} + P^{-1}(\\beta)A\\,\\frac{\\partial q}{\\partial x} = 0\n$$\nLet's define the preconditioned flux Jacobian $A'$ as\n$$\nA' = P^{-1}(\\beta)A\n$$\nGiven $P(\\beta) = \\begin{pmatrix} \\beta  0 \\\\ 0  1 \\end{pmatrix}$, its inverse is $P^{-1}(\\beta) = \\begin{pmatrix} 1/\\beta  0 \\\\ 0  1 \\end{pmatrix}$.\nThus,\n$$\nA' = \\begin{pmatrix} \\frac{1}{\\beta}  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 0  \\rho a^{2} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix} = \\begin{pmatrix} 0  \\frac{\\rho a^{2}}{\\beta} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix}\n$$\nThe spatial discretization is a first-order upwind scheme applied to the characteristic variables of the preconditioned operator $A'$. To do this, we first need to find the eigenvalues and eigenvectors of $A'$, which will allow us to decouple the system.\n\nThe eigenvalues $\\lambda'$ of $A'$ are the roots of the characteristic equation $\\det(A' - \\lambda'I) = 0$.\n$$\n\\det\\begin{pmatrix} -\\lambda'  \\frac{\\rho a^{2}}{\\beta} \\\\ \\frac{1}{\\rho}  -\\lambda' \\end{pmatrix} = (-\\lambda')^2 - \\left(\\frac{\\rho a^{2}}{\\beta}\\right)\\left(\\frac{1}{\\rho}\\right) = (\\lambda')^2 - \\frac{a^2}{\\beta} = 0\n$$\nThe eigenvalues, which represent the characteristic speeds of the preconditioned system, are:\n$$\n\\lambda'_{1,2} = \\pm \\frac{a}{\\sqrt{\\beta}}\n$$\nWe can define a transformation to characteristic variables $w$ such that the system $\\frac{\\partial q}{\\partial t} + A' \\frac{\\partial q}{\\partial x} = 0$ becomes a set of decoupled scalar advection equations:\n$$\n\\frac{\\partial w_k}{\\partial t} + \\lambda'_k \\frac{\\partial w_k}{\\partial x} = 0, \\quad k=1, 2\n$$\nThe problem specifies a first-order upwind spatial discretization for these characteristic equations, combined with a forward Euler time step. For a generic scalar advection equation $\\frac{\\partial w}{\\partial t} + c \\frac{\\partial w}{\\partial x} = 0$, the scheme is:\n$$\n\\frac{w_j^{n+1} - w_j^n}{\\Delta t} + c \\frac{w_j^n - w_{j-1}^n}{\\Delta x} = 0 \\quad \\text{if } c  0\n$$\n$$\n\\frac{w_j^{n+1} - w_j^n}{\\Delta t} + c \\frac{w_{j+1}^n - w_j^n}{\\Delta x} = 0 \\quad \\text{if } c  0\n$$\nHere, $j$ is the grid point index and $n$ is the time level.\n\nFor our first characteristic field, we have $\\lambda'_1 = \\frac{a}{\\sqrt{\\beta}}  0$. The discretized equation is:\n$$\nw_{1,j}^{n+1} = w_{1,j}^n - \\frac{\\lambda'_1 \\Delta t}{\\Delta x} (w_{1,j}^n - w_{1,j-1}^n)\n$$\nFor our second characteristic field, we have $\\lambda'_2 = -\\frac{a}{\\sqrt{\\beta}}  0$. The discretized equation is:\n$$\nw_{2,j}^{n+1} = w_{2,j}^n - \\frac{\\lambda'_2 \\Delta t}{\\Delta x} (w_{2,j+1}^n - w_{2,j}^n)\n$$\nNow we perform a von Neumann stability analysis. We substitute a single Fourier mode $w_j^n = \\hat{w}^n e^{i \\theta j}$ where $\\theta = k \\Delta x$ is the dimensionless wave number.\n\nFor the first equation (with $\\lambda'_1  0$):\n$$\n\\hat{w}_1^{n+1} e^{i\\theta j} = \\hat{w}_1^n e^{i\\theta j} - \\frac{\\lambda'_1 \\Delta t}{\\Delta x} (\\hat{w}_1^n e^{i\\theta j} - \\hat{w}_1^n e^{i\\theta (j-1)})\n$$\nDividing by $\\hat{w}_1^n e^{i\\theta j}$, we find the amplification factor $g_1 = \\hat{w}_1^{n+1} / \\hat{w}_1^n$:\n$$\ng_1 = 1 - \\frac{\\lambda'_1 \\Delta t}{\\Delta x} (1 - e^{-i\\theta})\n$$\nFor stability, we require $|g_1| \\leq 1$ for all $\\theta$. Let $\\nu_1 = \\frac{\\lambda'_1 \\Delta t}{\\Delta x} = \\frac{a \\Delta t}{\\sqrt{\\beta} \\Delta x}$.\n$$\n|g_1|^2 = |1 - \\nu_1(1 - \\cos\\theta + i\\sin\\theta)|^2 = |(1 - \\nu_1 + \\nu_1\\cos\\theta) - i\\nu_1\\sin\\theta|^2\n$$\n$$\n|g_1|^2 = (1 - \\nu_1 + \\nu_1\\cos\\theta)^2 + (\\nu_1\\sin\\theta)^2\n$$\n$$\n|g_1|^2 = (1-\\nu_1)^2 + 2\\nu_1(1-\\nu_1)\\cos\\theta + \\nu_1^2\\cos^2\\theta + \\nu_1^2\\sin^2\\theta\n$$\n$$\n|g_1|^2 = 1 - 2\\nu_1 + \\nu_1^2 + 2\\nu_1(1-\\nu_1)\\cos\\theta + \\nu_1^2\n$$\n$$\n|g_1|^2 = 1 - 2\\nu_1(1-\\nu_1) - 2\\nu_1(1-\\nu_1)\\cos\\theta = 1 + 2\\nu_1(\\nu_1-1)(1-\\cos\\theta)\n$$\nSince $\\nu_1  0$ and $1-\\cos\\theta \\ge 0$, for $|g_1|^2 \\le 1$ we must have $2\\nu_1(\\nu_1-1) \\le 0$, which implies $\\nu_1-1 \\le 0$, or $\\nu_1 \\le 1$. This is the standard CFL condition for the first-order upwind scheme.\n\nFor the second equation (with $\\lambda'_2  0$):\n$$\n\\hat{w}_2^{n+1} e^{i\\theta j} = \\hat{w}_2^n e^{i\\theta j} - \\frac{\\lambda'_2 \\Delta t}{\\Delta x} (\\hat{w}_2^n e^{i\\theta (j+1)} - \\hat{w}_2^n e^{i\\theta j})\n$$\nThe amplification factor $g_2 = \\hat{w}_2^{n+1} / \\hat{w}_2^n$ is:\n$$\ng_2 = 1 - \\frac{\\lambda'_2 \\Delta t}{\\Delta x} (e^{i\\theta} - 1)\n$$\nLet $\\nu_2 = \\frac{|\\lambda'_2| \\Delta t}{\\Delta x} = \\frac{a \\Delta t}{\\sqrt{\\beta} \\Delta x}$. Note that $\\nu_2 = \\nu_1$. The expression for $g_2$ becomes:\n$$\ng_2 = 1 + \\nu_2 (e^{i\\theta} - 1)\n$$\nAn analogous calculation for $|g_2|^2$ yields:\n$$\n|g_2|^2 = |(1 - \\nu_2 + \\nu_2\\cos\\theta) + i\\nu_2\\sin\\theta|^2 = 1 + 2\\nu_2(\\nu_2-1)(1-\\cos\\theta)\n$$\nThis leads to the same stability requirement, $\\nu_2 \\le 1$.\n\nThe stability of the system requires stability for all characteristic components. Since $\\nu_1 = \\nu_2$, the single condition is:\n$$\n\\frac{a \\Delta t}{\\sqrt{\\beta} \\Delta x} \\le 1\n$$\nThe problem defines the conventional acoustic CFL number as $\\mathrm{CFL}_{a} = \\frac{a \\Delta t}{\\Delta x}$. Substituting this definition into our stability condition, we get:\n$$\n\\frac{\\mathrm{CFL}_{a}}{\\sqrt{\\beta}} \\le 1\n$$\n$$\n\\mathrm{CFL}_{a} \\le \\sqrt{\\beta}\n$$\nThis inequality defines the stable region in the $(\\beta,\\mathrm{CFL}_{a})$-plane. The boundary of this region corresponds to the maximum admissible CFL number. Therefore, the maximal value of $\\mathrm{CFL}_{a}$ is given by:\n$$\n\\mathrm{CFL}_{a, \\max} = \\sqrt{\\beta}\n$$\nThis expression represents the stability boundary as a function of the preconditioning parameter $\\beta$. For the unpreconditioned case ($\\beta=1$), we recover the standard acoustic CFL limit, $\\mathrm{CFL}_{a} \\le 1$. For $\\beta  1$, the preconditioning tightens the stability limit for this explicit scheme.",
            "answer": "$$\n\\boxed{\\sqrt{\\beta}}\n$$"
        },
        {
            "introduction": "Ultimately, theoretical concepts and numerical analyses must be validated through correct software implementation, a crucial skill in computational science. This final practice bridges that gap by tasking you with designing and implementing a verification test for a preconditioned solver. Using the well-understood case of channel flow, you will confirm the fundamental principle that a correctly implemented preconditioner does not alter the physical steady-state solution, such as wall friction and pressure drop, while also ensuring the test can detect common implementation errors .",
            "id": "4006439",
            "problem": "Design and implement a self-contained computational verification test that assesses whether Weiss–Smith preconditioning in a compressible solver at low Mach number preserves the correct friction and pressure drop in fully developed channel flow. The test must be formulated in terms of fundamental laws and well-tested formulas and must generate quantifiable, unit-consistent outputs for a small suite of parameter values.\n\nUse the following physical and mathematical base to derive the verification quantities:\n\n- The flow is assumed isothermal and fully developed in a straight channel of height $2H$, with constant properties and negligible axial density variation at low Mach number $M=0.1$.\n- The Mach number is defined as $M = U/a$, where $U$ is the bulk (cross-section averaged) velocity and $a$ is the speed of sound given by $a = \\sqrt{\\gamma R T}$, with $\\gamma$ the ratio of specific heats, $R$ the specific gas constant, and $T$ the absolute temperature.\n- The gas density is computed from the Ideal Gas Law as $\\rho = p/(R T)$, with $p$ the static pressure.\n- The Reynolds number based on hydraulic diameter is $Re = \\dfrac{\\rho U D_h}{\\mu}$, with hydraulic diameter $D_h = 2H$ for a wide parallel-plate channel and dynamic viscosity $\\mu$ assumed constant and known.\n- The Darcy friction factor $f_D$ is defined in terms of the pressure gradient via the Darcy–Weisbach relation for internal flows,\n$$\n\\frac{dp}{dx} = -\\, f_D \\,\\frac{\\rho U^2}{2} \\,\\frac{1}{D_h}.\n$$\nFor laminar flow in a parallel-plate channel, use the well-tested correlation\n$$\nf_D = \\frac{96}{Re},\n$$\nand for turbulent flow in a smooth duct (with hydraulic diameter used as the characteristic length), use the Blasius correlation\n$$\nf_D = 0.3164\\,Re^{-0.25},\n$$\nvalid for $Re$ in the range where this correlation is typically applied in smooth-wall conditions.\n\n- Weiss–Smith preconditioning modifies the compressible equations by scaling the propagation speeds associated with pressure waves at low Mach number. A commonly used preconditioning parameter can be represented as a pseudo-acoustic speed scaling based on\n$$\n\\beta(M, M_{\\mathrm{cut}}) = \\max\\left(M^2,\\, M_{\\mathrm{cut}}^2\\right),\n$$\nwhere $M_{\\mathrm{cut}}$ is a small positive cutoff Mach number ensuring well-conditioned Jacobians as $M \\to 0$. For steady problems, the preconditioning matrix multiplies only the time derivative of the state vector and does not alter the steady-state spatial residuals.\n\nYou must implement the following in code:\n\n1. For each test case, compute the speed of sound $a = \\sqrt{\\gamma R T}$, the bulk velocity $U = M a$, the density $\\rho = p/(R T)$, the hydraulic diameter $D_h = 2 H$, and the Reynolds number $Re = \\rho U D_h / \\mu$.\n\n2. Using the appropriate correlation (laminar if $Re \\le Re_{\\mathrm{crit}}$, turbulent otherwise, with $Re_{\\mathrm{crit}} = 2300$), compute the Darcy friction factor $f_D$.\n\n3. Compute the pressure gradient $\\dfrac{dp}{dx}$ using the Darcy–Weisbach relation, and then the total pressure drop over length $L$ as $\\Delta p = \\left|\\dfrac{dp}{dx}\\right| L$. Express $\\Delta p$ in $\\mathrm{Pa}$.\n\n4. Emulate a physically correct preconditioning scenario at steady-state by asserting that the friction factor and pressure drop are unchanged by preconditioning, that is, the \"preconditioned\" prediction equals the reference prediction.\n\n5. Emulate an incorrect preconditioning scenario by erroneously scaling viscous/friction effects with a factor derived from the preconditioning parameter, for instance, $s_{\\mathrm{bad}} = 1/\\beta(M, M_{\\mathrm{cut}})$, and compute the resulting \"incorrect\" friction factor and pressure drop. This represents a common implementation mistake where the steady residual is improperly modified.\n\n6. Evaluate the following verification criteria for each test case:\n   - Invariance under correct preconditioning: the relative differences between the preconditioned and reference friction factors, and between the preconditioned and reference pressure drops, must both be less than a tolerance $\\varepsilon = 10^{-10}$ (dimensionless).\n   - Sensitivity under incorrect preconditioning: the relative difference between the incorrectly scaled and reference pressure drops must be at least $10^{-3}$ (dimensionless), indicating the test would detect the error.\n\n7. For each test case, return a boolean that is true if both invariance criteria are met and the incorrect-preconditioning sensitivity criterion is met; otherwise, return false.\n\nUse the following constants and test suite:\n\n- Physical constants and properties:\n  - Ratio of specific heats $\\gamma = 1.4$.\n  - Specific gas constant for air $R = 287\\,\\mathrm{J/(kg\\,K)}$.\n  - Temperature $T = 300\\,\\mathrm{K}$.\n  - Static pressure $p = 101325\\,\\mathrm{Pa}$.\n  - Dynamic viscosity $\\mu = 1.8\\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}$.\n  - Mach number $M = 0.1$.\n  - Preconditioning cutoff $M_{\\mathrm{cut}} = 0.05$.\n  - Critical Reynolds number $Re_{\\mathrm{crit}} = 2300$.\n\n- Test suite (channel half-heights $H$ and lengths $L$ in meters):\n  - Case $1$ (laminar): $H = 2.0\\times 10^{-4}$, $L = 2.0$.\n  - Case $2$ (near transition): $H = 4.9\\times 10^{-4}$, $L = 3.0$.\n  - Case $3$ (turbulent): $H = 2.0\\times 10^{-2}$, $L = 5.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"), where each result is a boolean corresponding to the pass/fail outcome of one test case. Pressure drops must be computed in $\\mathrm{Pa}$, and all relative differences are dimensionless decimals as specified. Angles are not involved in this problem.",
            "solution": "The objective is to design and implement a computational verification test for the Weiss–Smith preconditioning method as applied to a compressible flow solver operating at low Mach numbers. The test is based on the canonical problem of fully developed, isothermal channel flow. Its purpose is twofold: first, to verify that a correctly implemented preconditioning scheme does not alter the steady-state physical solution, and second, to demonstrate that the test is sensitive enough to detect a common class of implementation errors.\n\nThe foundation of this verification test rests on comparing the output of a simulated solver to a known analytical or well-established empirical solution. The physical system is a gas flowing through a wide parallel-plate channel of full height $2H$. Under the specified conditions—isothermal, fully developed, low Mach number ($M=0.1$)—the flow properties can be determined from fundamental principles.\n\nFirst, we establish the reference state. The gas properties are determined by the provided state variables and constants. The speed of sound, $a$, is given by the formula for an ideal gas:\n$$a = \\sqrt{\\gamma R T}$$\nwhere $\\gamma$ is the ratio of specific heats, $R$ is the specific gas constant, and $T$ is the absolute temperature. The bulk velocity $U$ is defined via the Mach number, $M = U/a$. The gas density $\\rho$ is computed from the Ideal Gas Law:\n$$\\rho = \\frac{p}{R T}$$\nwhere $p$ is the static pressure.\n\nThe flow regime is characterized by the Reynolds number, $Re$, based on the hydraulic diameter $D_h$. For a wide parallel-plate channel, the hydraulic diameter is $D_h = 2H$. The Reynolds number is thus:\n$$Re = \\frac{\\rho U D_h}{\\mu}$$\nwhere $\\mu$ is the constant dynamic viscosity.\n\nThe pressure drop along the channel is governed by viscous friction at the walls. This relationship is quantified by the Darcy-Weisbach equation, which defines the Darcy friction factor, $f_D$, in terms of the axial pressure gradient, $\\frac{dp}{dx}$:\n$$\\frac{dp}{dx} = -f_D \\frac{\\rho U^2}{2} \\frac{1}{D_h}$$\nTo obtain a reference value for the friction factor, we use well-validated correlations that depend on the Reynolds number. For laminar flow, defined here as $Re \\le Re_{\\mathrm{crit}} = 2300$, the exact analytical solution for channel flow is:\n$$f_D = \\frac{96}{Re}$$\nFor turbulent flow ($Re  2300$) in a smooth channel, the empirical Blasius correlation provides a reliable approximation:\n$$f_D = 0.3164\\,Re^{-0.25}$$\nOnce the reference friction factor, $f_{D, \\text{ref}}$, is computed using the appropriate correlation, the reference pressure gradient is calculated. The total reference pressure drop over a channel of length $L$, denoted $\\Delta p_{\\text{ref}}$, is then:\n$$\\Delta p_{\\text{ref}} = \\left| \\frac{dp}{dx}_{\\text{ref}} \\right| L$$\n\nNext, we formulate the verification criteria based on the properties of Weiss–Smith preconditioning. This numerical technique is designed to improve the convergence rate of solvers at low Mach numbers by modifying the time-dependent part of the governing equations. The system of equations can be written abstractly as $\\mathbf{\\Gamma} \\frac{\\partial \\mathbf{Q}}{\\partial t} + \\mathcal{R}(\\mathbf{Q}) = 0$, where $\\mathbf{Q}$ is the vector of conserved variables, $\\mathcal{R}(\\mathbf{Q})$ represents the spatial discretization of the flux and source terms (the steady-state residual), and $\\mathbf{\\Gamma}$ is the preconditioning matrix. A key principle of this method is that for steady-state problems ($\\frac{\\partial \\mathbf{Q}}{\\partial t} = 0$), the equation reduces to $\\mathcal{R}(\\mathbf{Q}) = 0$. Therefore, the preconditioning matrix $\\mathbf{\\Gamma}$ has no influence on the final, converged steady-state solution.\n\nThis principle directly leads to the first verification criterion: **invariance**. A correctly preconditioned solver must yield a steady-state solution identical to the non-preconditioned one. We emulate this by asserting that the \"correctly preconditioned\" friction factor, $f_{D, \\text{correct}}$, and pressure drop, $\\Delta p_{\\text{correct}}$, are identical to their reference values. The test checks if the relative differences are below a machine-precision tolerance, $\\varepsilon = 10^{-10}$:\n$$\\frac{|f_{D, \\text{correct}} - f_{D, \\text{ref}}|}{f_{D, \\text{ref}}}  \\varepsilon \\quad \\text{and} \\quad \\frac{|\\Delta p_{\\text{correct}} - \\Delta p_{\\text{ref}}|}{\\Delta p_{\\text{ref}}}  \\varepsilon$$\n\nA robust verification test must also be able to detect errors. We simulate a plausible implementation bug where the scaling used in the preconditioning matrix erroneously \"leaks\" into the calculation of the steady-state residual. The Weiss–Smith preconditioning parameter is based on $\\beta(M, M_{\\mathrm{cut}}) = \\max(M^2, M_{\\mathrm{cut}}^2)$. A common bug would be to incorrectly multiply a term in the residual by a factor related to the preconditioning, such as $s_{\\text{bad}} = 1/\\beta$. We model this error by assuming the viscous/friction effects are scaled by this factor. This leads to an incorrect friction factor $f_{D, \\text{bad}} = f_{D, \\text{ref}} \\cdot s_{\\text{bad}}$ and, consequently, an incorrect pressure drop $\\Delta p_{\\text{bad}} = \\Delta p_{\\text{ref}} \\cdot s_{\\text{bad}}$.\n\nThis leads to the second verification criterion: **sensitivity**. The test must be sensitive enough to flag this error. We check that the relative difference between the incorrectly computed pressure drop and the reference value is significant, specifically greater than a threshold of $10^{-3}$:\n$$\\frac{|\\Delta p_{\\text{bad}} - \\Delta p_{\\text{ref}}|}{\\Delta p_{\\text{ref}}} \\ge 10^{-3}$$\n\nFor each test case defined by a specific channel geometry ($H, L$), the procedure is as follows:\n1.  Compute the constant physical properties $a, U, \\rho$.\n2.  Calculate the case-specific $D_h$ and $Re$.\n3.  Determine $f_{D, \\text{ref}}$ based on the flow regime (laminar or turbulent).\n4.  Calculate the reference pressure drop $\\Delta p_{\\text{ref}}$.\n5.  Check the invariance criterion by comparing the reference values to themselves, which will yield a relative error of $0$.\n6.  Calculate the incorrectly scaled pressure drop $\\Delta p_{\\text{bad}}$ and check the sensitivity criterion.\n7.  The test case passes if and only if both the invariance and sensitivity criteria are met. This confirms the test correctly identifies the true solution and is capable of detecting the seeded error.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a computational verification test for Weiss–Smith\n    preconditioning in a compressible solver at low Mach number.\n    \"\"\"\n\n    # Define physical constants and properties\n    GAMMA = 1.4  # Ratio of specific heats\n    R_GAS = 287.0  # Specific gas constant for air in J/(kg K)\n    TEMP = 300.0  # Temperature in K\n    PRESSURE = 101325.0  # Static pressure in Pa\n    MU = 1.8e-5  # Dynamic viscosity in kg/(m s)\n    MACH = 0.1  # Mach number\n    M_CUT = 0.05  # Preconditioning cutoff Mach number\n    RE_CRIT = 2300.0  # Critical Reynolds number for transition\n\n    # Test suite: (H, L) where H is half-height and L is length, in meters\n    test_cases = [\n        (2.0e-4, 2.0),  # Case 1: Laminar\n        (4.9e-4, 3.0),  # Case 2: Near transition\n        (2.0e-2, 5.0),  # Case 3: Turbulent\n    ]\n\n    # Pre-compute constant fluid properties\n    a = np.sqrt(GAMMA * R_GAS * TEMP)  # Speed of sound\n    U = MACH * a  # Bulk velocity\n    rho = PRESSURE / (R_GAS * TEMP)  # Density\n\n    results = []\n    for h_half, length in test_cases:\n        # Step 1: Compute derived quantities for the specific case\n        d_h = 2.0 * h_half  # Hydraulic diameter\n        reynolds_num = (rho * U * d_h) / MU\n\n        # Step 2: Compute the reference Darcy friction factor\n        if reynolds_num = RE_CRIT:\n            # Laminar flow correlation\n            f_d_ref = 96.0 / reynolds_num\n        else:\n            # Turbulent flow correlation (Blasius)\n            f_d_ref = 0.3164 * (reynolds_num**-0.25)\n        \n        # Step 3: Compute the reference pressure drop\n        dp_dx_ref = -f_d_ref * (rho * U**2) / (2.0 * d_h)\n        delta_p_ref = abs(dp_dx_ref) * length\n\n        # Step 4: Emulate correct preconditioning (no change to steady state)\n        # By definition, the correct preconditioned results are the reference ones.\n        f_d_correct = f_d_ref\n        delta_p_correct = delta_p_ref\n\n        # Step 5: Emulate incorrect preconditioning (residual scaled)\n        beta = max(MACH**2, M_CUT**2)\n        s_bad = 1.0 / beta\n        \n        # The error scales the friction effect, thus scaling the friction factor\n        # and the resulting pressure drop.\n        f_d_bad = f_d_ref * s_bad\n        delta_p_bad = delta_p_ref * s_bad\n\n        # Step 6: Evaluate verification criteria\n        \n        # Invariance under correct preconditioning\n        # The relative differences should be zero (or within machine epsilon).\n        rel_diff_fd_correct = abs(f_d_correct - f_d_ref) / f_d_ref if f_d_ref != 0 else 0\n        rel_diff_dp_correct = abs(delta_p_correct - delta_p_ref) / delta_p_ref if delta_p_ref != 0 else 0\n        \n        invariance_passed = (rel_diff_fd_correct  1e-10) and (rel_diff_dp_correct  1e-10)\n\n        # Sensitivity to incorrect preconditioning\n        # The relative difference must be large enough to be detected.\n        rel_diff_dp_bad = abs(delta_p_bad - delta_p_ref) / delta_p_ref if delta_p_ref != 0 else 0\n        \n        sensitivity_passed = rel_diff_dp_bad = 1e-3\n\n        # Step 7: Final result for the test case\n        # The test is valid if it passes the correct case and flags the bad one.\n        case_result = invariance_passed and sensitivity_passed\n        results.append(case_result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}