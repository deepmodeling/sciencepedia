{
    "hands_on_practices": [
        {
            "introduction": "要理解无反射边界条件的核心思想，最有效的方法之一是分析一个简化的理想情况。本练习将探讨一种基础的辐射边界条件（Orlanski型），它试图模拟波无障碍地传出计算区域。通过推导一个简单一维波动方程的反射系数，您将亲手揭示当边界条件所假设的波速与介质中的真实波速不匹配时，必然会产生虚假反射的根本原因 。这个经典练习量化了这种不匹配所带来的影响，为设计和评估更复杂的边界条件提供了物理直觉。",
            "id": "3980869",
            "problem": "考虑一个在一维半无限域 $x \\le 0$ 中的小振幅声扰动，该区域在 $x = 0$ 处有一个平面边界，扰动由线性波动方程控制。波的动力学源于线性化的一维声学方程，这些方程导出了标量扰动 $q(x,t)$ 的二阶波动方程 $q_{tt} = c^{2} q_{xx}$，其中 $c > 0$ 是介质的真实相速度。在计算流体力学（CFD）中，一种常见的无反射边界处理方法，即Orlanski型辐射边界条件（RBC），在边界 $x = 0$ 处规定了一阶关系 $q_{t} + \\hat{c}\\, q_{x} = 0$，其中 $\\hat{c} > 0$ 是边界条件使用的估计相速度，它可能与 $c$ 不同。\n\n假设一个单位振幅的右行谐波从内部入射到边界：\n$$\nq_{i}(x,t) = \\exp\\!\\big(i(k x - \\omega t)\\big),\n$$\n其中，根据波动方程的色散关系，有 $k > 0$ 和 $\\omega = c\\, k$。边界附近的总场是入射波和一个可能反射的左行谐波的叠加：\n$$\nq(x,t) = q_{i}(x,t) + q_{r}(x,t), \\quad q_{r}(x,t) = R\\, \\exp\\!\\big(-i(k x + \\omega t)\\big),\n$$\n其中 $R$ 是复振幅反射系数，定义为反射振幅与入射振幅之比。\n\n通过在 $x = 0$ 处施加Orlanski型辐射边界条件，推导反射系数 $R$ 关于真实速度 $c$ 和估计速度 $\\hat{c}$ 的闭式解析表达式。您的答案必须是单个解析表达式。不需要数值近似或四舍五入，最终表达式中不应包含任何物理单位。",
            "solution": "该问题被验证为科学上成立、适定、客观，并包含足够的信息以推导出唯一解。这是波动方程数值边界条件分析中的一个标准问题。\n\n问题要求计算一个谐波入射到 $x=0$ 处的边界时的反射系数 $R$，该边界上施加了Orlanski型辐射边界条件（RBC）。区域为 $x \\le 0$。\n\n标量扰动 $q(x,t)$ 的控制方程是一维波动方程：\n$$\n\\frac{\\partial^2 q}{\\partial t^2} = c^2 \\frac{\\partial^2 q}{\\partial x^2}\n$$\n其中 $c > 0$ 是介质的真实相速度。\n\n总波场 $q(x,t)$ 是右行入射波 $q_i(x,t)$ 和左行反射波 $q_r(x,t)$ 的叠加。\n入射波由下式给出：\n$$\nq_i(x,t) = \\exp(i(kx - \\omega t))\n$$\n这是一个沿 $x$ 轴正方向传播，朝向边界 $x=0$ 的波。参数 $k > 0$ 和 $\\omega$ 分别是波数和角频率。它们通过控制波动方程的色散关系 $\\omega = ck$ 相关联。\n\n反射波由下式给出：\n$$\nq_r(x,t) = R \\exp(-i(kx + \\omega t))\n$$\n这是一个沿 $x$ 轴负方向传播，远离边界的波。$R$ 是我们需要确定的复反射系数。\n\n总场是入射波和反射波之和：\n$$\nq(x,t) = q_i(x,t) + q_r(x,t) = \\exp(i(kx - \\omega t)) + R \\exp(-i(kx + \\omega t))\n$$\n\n在边界 $x=0$ 处，应用Orlanski型RBC：\n$$\n\\frac{\\partial q}{\\partial t} + \\hat{c} \\frac{\\partial q}{\\partial x} = 0 \\quad \\text{at } x=0\n$$\n其中 $\\hat{c} > 0$ 是边界条件中使用的估计相速度。\n\n为了求出 $R$，我们必须将总场 $q(x,t)$ 的表达式代入边界条件。首先，我们计算 $q(x,t)$ 所需的偏导数。\n\n关于时间 $t$ 的偏导数为：\n$$\n\\frac{\\partial q}{\\partial t} = \\frac{\\partial}{\\partial t} \\left[ \\exp(i(kx - \\omega t)) + R \\exp(-i(kx + \\omega t)) \\right]\n$$\n$$\n\\frac{\\partial q}{\\partial t} = (-i\\omega) \\exp(i(kx - \\omega t)) + R (-i\\omega) \\exp(-i(kx + \\omega t))\n$$\n$$\n\\frac{\\partial q}{\\partial t} = -i\\omega \\left[ \\exp(i(kx - \\omega t)) + R \\exp(-i(kx + \\omega t)) \\right]\n$$\n\n关于位置 $x$ 的偏导数为：\n$$\n\\frac{\\partial q}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\exp(i(kx - \\omega t)) + R \\exp(-i(kx + \\omega t)) \\right]\n$$\n$$\n\\frac{\\partial q}{\\partial x} = (ik) \\exp(i(kx - \\omega t)) + R (-ik) \\exp(-i(kx + \\omega t))\n$$\n$$\n\\frac{\\partial q}{\\partial x} = ik \\left[ \\exp(i(kx - \\omega t)) - R \\exp(-i(kx + \\omega t)) \\right]\n$$\n\n接下来，我们在边界 $x=0$ 处计算这些导数的值：\n$$\n\\left. \\frac{\\partial q}{\\partial t} \\right|_{x=0} = -i\\omega \\left[ \\exp(-i\\omega t) + R \\exp(-i\\omega t) \\right] = -i\\omega (1+R) \\exp(-i\\omega t)\n$$\n$$\n\\left. \\frac{\\partial q}{\\partial x} \\right|_{x=0} = ik \\left[ \\exp(-i\\omega t) - R \\exp(-i\\omega t) \\right] = ik (1-R) \\exp(-i\\omega t)\n$$\n\n现在，我们将这些表达式代入边界条件方程 $\\left. \\frac{\\partial q}{\\partial t} \\right|_{x=0} + \\hat{c} \\left. \\frac{\\partial q}{\\partial x} \\right|_{x=0} = 0$ 中：\n$$\n-i\\omega (1+R) \\exp(-i\\omega t) + \\hat{c} \\left( ik (1-R) \\exp(-i\\omega t) \\right) = 0\n$$\n由于此方程必须对所有时间 $t$ 成立，且项 $\\exp(-i\\omega t)$ 永不为零，我们可以用它来除整个方程。我们还可以除以公因子 $i$：\n$$\n-\\omega(1+R) + \\hat{c} k(1-R) = 0\n$$\n问题陈述色散关系为 $\\omega = ck$。我们用此式代入 $\\omega$：\n$$\n-ck(1+R) + \\hat{c}k(1-R) = 0\n$$\n由于波数 $k$ 给定为 $k>0$，它不为零，我们可以用 $k$ 来除此方程：\n$$\n-c(1+R) + \\hat{c}(1-R) = 0\n$$\n现在我们求解这个关于反射系数 $R$ 的代数方程。我们展开各项：\n$$\n-c - cR + \\hat{c} - \\hat{c}R = 0\n$$\n将含 $R$ 的项分组到一边，常数项分组到另一边：\n$$\n\\hat{c} - c = cR + \\hat{c}R\n$$\n提出因子 $R$：\n$$\n\\hat{c} - c = R(c + \\hat{c})\n$$\n最后，我们分离出 $R$ 得到最终表达式：\n$$\nR = \\frac{\\hat{c} - c}{c + \\hat{c}}\n$$\n该表达式给出了反射系数 $R$ 作为真实相速度 $c$ 和边界条件中使用的估计相速度 $\\hat{c}$ 的函数。我们注意到，只有当估计速度与真实速度匹配，即 $\\hat{c} = c$ 时，才能实现完美无反射，$R=0$。",
            "answer": "$$\n\\boxed{\\frac{\\hat{c} - c}{\\hat{c} + c}}\n$$"
        },
        {
            "introduction": "在从解析边界条件转向诸如海绵层这样的体积阻尼方法时，我们必须考虑其对数值稳定性的影响。当计算流体力学（CFD）模拟采用显式时间积分格式时，海绵层中引入的强阻尼项可能会带来比传统对流项的Courant–Friedrichs–Lewy (CFL) 条件更严格的时间步长限制。本练习通过对一个包含海绵层源项的简化方程进行线性稳定性分析，旨在揭示这一额外的数值约束 。掌握这项技能对于在实际应用中正确设置时间步长至关重要，它能确保在使用海绵层时的数值稳定性和计算效率。",
            "id": "3980938",
            "problem": "考虑一维线性化扰动场 $q'(x,t)$ 在计算流体力学 (CFD) 的可压缩流模拟中，于出口边界附近演化。为了实现无反射边界，在一定厚度的缓冲区内应用了海绵层，其中的阻尼源项会迫使 $q'$ 趋向一个均匀的参考态。假设扰动是围绕均匀基态的小振幅扰动，因此 $q'$ 的主阶动力学遵循一个带有阻尼源项的线性双曲型偏微分方程，其形式为\n$$\n\\frac{\\partial q'}{\\partial t} + a \\frac{\\partial q'}{\\partial x} = -\\sigma(x)\\,q'(x,t),\n$$\n其中 $a$ 是一个常数，代表边界附近向右传播的最大波速的特征速度，而 $\\sigma(x) \\ge 0$ 是空间变化的耗散强度，在海绵层区域其最大值为 $\\sigma_{\\max}$。\n\n假设半离散的线方法采用前向欧拉时间积分和对流项的一阶迎风空间离散格式，并通过算子分裂法显式处理海绵层源项：一个显式平流步，后跟一个显式海绵层源项步。对平流步的单个傅里叶模态进行线性冯·诺依曼稳定性分析，并对海绵层步进行独立的线性稳定性分析，然后推导与海绵层源项相关的、保证线性化更新稳定性的时间步长约束。然后，将其与平流步的对流 Courant–Friedrichs–Lewy (CFL) 约束进行比较。\n\n给定一个特定出口缓冲区的设置参数如下：\n- 网格间距 $\\Delta x = 2.0 \\times 10^{-3}\\,\\text{m}$，\n- 最大特征速度 $a_{\\max} = 350\\,\\text{m}\\,\\text{s}^{-1}$，\n- 迎风对流步的目标 CFL 系数 $C_{\\mathrm{CFL}} = 0.5$，\n- 最大耗散强度 $\\sigma_{\\max} = 800\\,\\text{s}^{-1}$，\n\n确定能够同时满足对流 CFL 约束和海绵层稳定性约束的最大稳定时间步长 $\\Delta t$。\n\n以秒为单位表示您的最终答案，并将结果四舍五入至四位有效数字。",
            "solution": "该问题要求确定一个用于求解带阻尼源项的一维线性化平流方程的数值格式的最大稳定时间步长 $\\Delta t$。该格式采用算子分裂法，将平流项和源项分为两个独立的显式步骤处理。我们必须为每个步骤推导其稳定性约束，然后找出最严格的约束，该约束将决定总体的最大稳定时间步长。\n\n扰动场 $q'(x,t)$ 的控制偏微分方程为：\n$$\n\\frac{\\partial q'}{\\partial t} + a \\frac{\\partial q'}{\\partial x} = -\\sigma(x)\\,q'(x,t)\n$$\n其中 $a > 0$ 是一个常数波速。对于从 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 的每个时间推进，该数值方法包括两个连续的步骤：\n\n步骤 1：平流（显式，一阶迎风，前向欧拉）\n$$\n\\frac{\\partial q'}{\\partial t} + a \\frac{\\partial q'}{\\partial x} = 0\n$$\n\n步骤 2：海绵层阻尼（显式，前向欧拉）\n$$\n\\frac{\\partial q'}{\\partial t} = -\\sigma(x)\\,q'\n$$\n\n我们将分别分析每个步骤的稳定性。\n\n**1. 平流步的稳定性分析**\n\n平流方程在时间上使用前向欧拉格式离散，在空间上使用一阶迎风格式离散。对于正波速 $a > 0$，迎风格式在网格点 $j$ 和时间层 $n$ 处的空间导数近似为 $(\\frac{\\partial q'}{\\partial x})_j^n \\approx \\frac{q'_j{}^n - q'_{j-1}{}^n}{\\Delta x}$。平流步的半离散方程为：\n$$\n\\frac{q'^{*}_j - q'_j{}^n}{\\Delta t} + a \\left( \\frac{q'_j{}^n - q'_{j-1}{}^n}{\\Delta x} \\right) = 0\n$$\n其中 $q'^{*}$ 是平流步后的中间解。整理得到 $q'^{*}_j$ 的更新规则：\n$$\nq'^{*}_j = q'_j{}^n - \\frac{a \\Delta t}{\\Delta x} (q'_j{}^n - q'_{j-1}{}^n)\n$$\n令 $C = \\frac{a \\Delta t}{\\Delta x}$ 为库朗数。方程变为：\n$$\nq'^{*}_j = q'_j{}^n - C (q'_j{}^n - q'_{j-1}{}^n)\n$$\n为了进行冯·诺依曼稳定性分析，我们考虑形式为 $q'_j{}^n = \\hat{q}^n(k) \\exp(i k x_j)$ 的单个傅里叶模态，其中 $k$ 是波数，$x_j = j \\Delta x$。放大因子 $G_{adv}(k) = \\frac{\\hat{q}^{n+1}(k)}{\\hat{q}^n(k)}$ 可通过将此形式代入更新规则求得：\n$$\nG_{adv} \\exp(i k j \\Delta x) = \\exp(i k j \\Delta x) - C (\\exp(i k j \\Delta x) - \\exp(i k (j-1) \\Delta x))\n$$\n两边同除以 $\\exp(i k j \\Delta x)$ 得：\n$$\nG_{adv} = 1 - C (1 - \\exp(-i k \\Delta x))\n$$\n为保证稳定性，对于所有波数，放大因子的模必须小于或等于 1，即 $|G_{adv}| \\le 1$。令 $\\theta = k \\Delta x$。\n$$\nG_{adv} = 1 - C (1 - \\cos(\\theta) + i \\sin(\\theta)) = (1 - C + C\\cos(\\theta)) - i C\\sin(\\theta)\n$$\n模的平方为：\n$$\n|G_{adv}|^2 = (1 - C + C\\cos(\\theta))^2 + (-C\\sin(\\theta))^2\n$$\n$$\n|G_{adv}|^2 = (1-C)^2 + 2C(1-C)\\cos(\\theta) + C^2\\cos^2(\\theta) + C^2\\sin^2(\\theta)\n$$\n$$\n|G_{adv}|^2 = 1 - 2C + C^2 + 2C(1-C)\\cos(\\theta) + C^2 = 1 - 2C + 2C^2 + (2C-2C^2)\\cos(\\theta)\n$$\n$$\n|G_{adv}|^2 = 1 - 2C(1 - \\cos(\\theta)) + 2C^2(1 - \\cos(\\theta)) = 1 - 2C(1-C)(1 - \\cos(\\theta))\n$$\n为保证稳定性，需满足 $|G_{adv}|^2 \\le 1$。由于 $C = \\frac{a \\Delta t}{\\Delta x} > 0$ 且 $(1 - \\cos(\\theta)) \\ge 0$，这要求 $-2C(1-C)(1 - \\cos(\\theta))$ 这一项为非正。此条件在 $C(1-C) \\ge 0$ 时满足。因为 $C>0$，我们必须有 $1-C \\ge 0$，即 $C \\le 1$。\n这就是该格式的 Courant–Friedrichs–Lewy (CFL) 条件。问题指定了目标 CFL 系数 $C_{\\mathrm{CFL}} = 0.5$，我们将其解释为操作上限。因此，来自平流步的对 $\\Delta t$ 的约束为：\n$$\n\\frac{a_{\\max} \\Delta t}{\\Delta x} \\le C_{\\mathrm{CFL}} \\implies \\Delta t \\le \\frac{C_{\\mathrm{CFL}} \\Delta x}{a_{\\max}}\n$$\n我们将此上限称为 $\\Delta t_{\\text{conv}}$。\n\n**2. 海绵层源项步的稳定性分析**\n\n第二步求解每个网格点上阻尼的常微分方程 (ODE)：\n$$\n\\frac{d q'}{d t} = -\\sigma(x) q'\n$$\n使用前向欧拉格式，从中间状态 $q'^{*}$ 离散到最终状态 $q'^{n+1}$：\n$$\n\\frac{q'_j{}^{n+1} - q'^{*}_j}{\\Delta t} = -\\sigma_j q'^{*}_j\n$$\n更新规则为：\n$$\nq'_j{}^{n+1} = q'^{*}_j - \\sigma_j \\Delta t \\, q'^{*}_j = (1 - \\sigma_j \\Delta t) q'^{*}_j\n$$\n此步的放大因子 $G_{sponge}$ 就是乘法因子：\n$$\nG_{sponge} = 1 - \\sigma_j \\Delta t\n$$\n为保证稳定性，我们要求对所有网格点 $j$ 都有 $|G_{sponge}| \\le 1$。此不等式为 $|1 - \\sigma_j \\Delta t| \\le 1$，等价于：\n$$\n-1 \\le 1 - \\sigma_j \\Delta t \\le 1\n$$\n右侧不等式 $1 - \\sigma_j \\Delta t \\le 1$ 意味着 $-\\sigma_j \\Delta t \\le 0$。由于 $\\sigma_j \\ge 0$ 且 $\\Delta t > 0$，此条件恒成立。\n左侧不等式 $-1 \\le 1 - \\sigma_j \\Delta t$ 意味着 $\\sigma_j \\Delta t \\le 2$。\n此约束必须对定义域中所有的耗散强度 $\\sigma_j$ 都成立。最严格的情况对应于最大耗散强度 $\\sigma_{\\max}$。因此，来自海绵层的稳定性约束为：\n$$\n\\Delta t \\le \\frac{2}{\\sigma_{\\max}}\n$$\n我们将此上限称为 $\\Delta t_{\\text{sponge}}$。\n\n**3. 组合稳定性约束与最终计算**\n\n为使整个算子分裂格式稳定，时间步长 $\\Delta t$ 必须同时满足两个约束。因此，允许的最大时间步长是两个独立上限中的最小值：\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{conv}}, \\Delta t_{\\text{sponge}}) = \\min\\left( \\frac{C_{\\mathrm{CFL}} \\Delta x}{a_{\\max}}, \\frac{2}{\\sigma_{\\max}} \\right)\n$$\n给定以下参数值：\n- 网格间距: $\\Delta x = 2.0 \\times 10^{-3}\\,\\text{m}$\n- 最大特征速度: $a_{\\max} = 350\\,\\text{m}\\,\\text{s}^{-1}$\n- 目标 CFL 系数: $C_{\\mathrm{CFL}} = 0.5$\n- 最大耗散强度: $\\sigma_{\\max} = 800\\,\\text{s}^{-1}$\n\n现在我们计算两个时间步长限制。\n对流时间步长限制为：\n$$\n\\Delta t_{\\text{conv}} = \\frac{C_{\\mathrm{CFL}} \\Delta x}{a_{\\max}} = \\frac{0.5 \\times (2.0 \\times 10^{-3}\\,\\text{m})}{350\\,\\text{m}\\,\\text{s}^{-1}} = \\frac{1.0 \\times 10^{-3}}{350}\\,\\text{s} \\approx 2.85714 \\times 10^{-6}\\,\\text{s}\n$$\n海绵层时间步长限制为：\n$$\n\\Delta t_{\\text{sponge}} = \\frac{2}{\\sigma_{\\max}} = \\frac{2}{800\\,\\text{s}^{-1}} = \\frac{1}{400}\\,\\text{s} = 0.0025\\,\\text{s} = 2.5 \\times 10^{-3}\\,\\text{s}\n$$\n比较这两个限制：\n$$\n\\Delta t_{\\text{conv}} \\approx 2.857 \\times 10^{-6}\\,\\text{s}\n$$\n$$\n\\Delta t_{\\text{sponge}} = 2.5 \\times 10^{-3}\\,\\text{s}\n$$\n对流 CFL 约束远比海绵层阻尼约束更严格。因此，总体的最大稳定时间步长由平流步决定。\n$$\n\\Delta t_{\\max} = \\min(2.85714 \\times 10^{-6}\\,\\text{s}, 2.5 \\times 10^{-3}\\,\\text{s}) = 2.85714 \\times 10^{-6}\\,\\text{s}\n$$\n问题要求将结果四舍五入至四位有效数字。\n$$\n\\Delta t_{\\max} \\approx 2.857 \\times 10^{-6}\\,\\text{s}\n$$",
            "answer": "$$\n\\boxed{2.857 \\times 10^{-6}}\n$$"
        },
        {
            "introduction": "理论分析往往基于简化的几何形状，但在实际的航空航天应用中，计算边界通常是复杂的曲线。本练习将理论与计算实践相结合，要求您通过编程来评估一种先进的边界条件（NSCBC）在弯曲边界上的性能。通过在一个正弦形的边界上模拟平面声波的入射，您将计算出反射如何随局部入射角的变化而变化 。这项计算实践不仅强化了对反射与入射角关系的理解，还教授了如何量化和评估边界条件在非理想几何情况下的鲁棒性，这是将理论知识应用于真实世界CFD模拟的关键一步。",
            "id": "3980880",
            "problem": "考虑可压缩 Navier–Stokes 方程在无平均流情况下的二维 ($2$D) 线性声学极限，其中声压 $p(x,y,t)$ 和质点速度 $\\mathbf{u}(x,y,t)$ 满足质量守恒和线性动量守恒，从而得到声速为常数 $a$、参考密度为常数 $\\rho_0$ 的标量声波方程。在航空航天计算流体动力学中，一种广泛使用的无反射边界处理方法是 Navier–Stokes 特征边界条件 (NSCBC)，该方法将特征变量与局部边界法线对齐，以最小化入射波。在声学极限下，一个边界对齐的 NSCBC 简化为一阶吸收边界条件，该条件对于法向入射是精确的，但对于斜向入射通常不完美。\n\n您需要在一个几何形状为正弦曲线的曲线边界段上开发一个计算测试。边界是矩形计算域中的曲线 $y_b(x) = A \\sin\\left( \\frac{2\\pi x}{L} \\right)$，其中 $A$ 是正弦振幅，$L$ 是波长。在该边界上的每一点，定义物理笛卡尔坐标系中的局部单位切向量 $\\hat{\\mathbf{t}}(x)$ 和局部向外单位法向量 $\\hat{\\mathbf{n}}(x)$。考虑一个单位振幅、角频率为 $\\omega$ 的入射平面声波，其波矢量方向由与 $x$ 轴的夹角 $\\phi$（以弧度为单位）指定，因此方向单位向量为 $\\hat{\\mathbf{k}} = (\\cos\\phi, \\sin\\phi)$。假设色散关系为 $\\omega = a \\|\\mathbf{k}\\|$，并且在 $\\hat{\\mathbf{n}}(x) \\cdot \\hat{\\mathbf{k}} \\ge 0$ 的任何地方，波都朝向边界传播。此外，模拟一个紧邻边界（沿法线方向测量）的可选海绵层，其厚度为 $d$，具有均匀的线性阻尼系数 $\\sigma$（单位为 $\\mathrm{s}^{-1}$）。海绵层在传播距离 $s$ 上将波幅衰减一个因子 $\\exp\\left(-\\frac{\\sigma s}{a}\\right)$；对于穿过厚度为 $d$ 的海绵层的一次往返反射，在远离边界处测得的反射波幅会衰减 $\\exp\\left(-\\frac{2\\sigma d}{a}\\right)$。\n\n从二维线性声学方程和边界对齐 NSCBC 的定义出发，推导出边界处的局部反射振幅比，作为相对于法线方向的局部入射角的函数，并为远离边界测量的反射振幅计入海绵层的衰减。然后，实现一个程序，在给定一组物理参数的情况下，将边界的一个波长（$x \\in [0, L)$）离散化，计算局部单位法向量 $\\hat{\\mathbf{n}}(x)$，使用 $\\hat{\\mathbf{n}}(x) \\cdot \\hat{\\mathbf{k}}$ 确定入射条件，在每个边界点评估由边界对齐的 NSCBC 预测的局部反射振幅比，乘以海绵层衰减因子 $\\exp\\left(-\\frac{2\\sigma d}{a}\\right)$，最后报告汇总统计数据：在发生入射的边界上，测量的反射振幅的空间平均值和最大值。对于 $\\hat{\\mathbf{n}}(x) \\cdot \\hat{\\mathbf{k}} < 0$（无入射）的位置，为了汇总计算，将局部反射振幅视为零。\n\n您的程序必须使用以下单位和约定：\n- 所有长度（$A$, $L$, $d$）单位为米。\n- 声速 $a$ 单位为米/秒。\n- 阻尼系数 $\\sigma$ 单位为 1/秒。\n- 角度 $\\phi$ 单位为弧度。\n- 报告的反射振幅比是无量纲的浮点数。\n- 所有三角函数均对以弧度为单位的角度进行运算。\n\n在一个正弦波长上使用 $N$ 个点的均匀离散化，$x_j = j \\Delta x$，$j = 0,1,\\dots,N-1$，且 $\\Delta x = L/N$。在每个 $x_j$ 处，计算 $y_b'(x_j)$，然后计算 $\\hat{\\mathbf{n}}(x_j) = \\frac{(-y_b'(x_j), 1)}{\\sqrt{1 + (y_b'(x_j))^2}}$ 和 $\\hat{\\mathbf{k}} = (\\cos\\phi, \\sin\\phi)$。将相对于法线的入射角的局部余弦定义为 $\\cos\\theta_\\mathrm{eff}(x_j) = \\hat{\\mathbf{n}}(x_j) \\cdot \\hat{\\mathbf{k}}$。\n\n您的程序应为以下参数集测试套件实现上述计算，每个参数集均以指定单位表示：\n- 测试用例 1 (一般斜向入射，无海绵层): $a = 340$, $A = 0.05$, $L = 1.0$, $\\phi = 0.35$, $\\sigma = 0.0$, $d = 0.0$, $N = 200$。\n- 测试用例 2 (在弯曲边界上的近法向入射，无海绵层): $a = 340$, $A = 0.10$, $L = 1.0$, $\\phi = \\frac{\\pi}{2}$, $\\sigma = 0.0$, $d = 0.0$, $N = 200$。\n- 测试用例 3 (掠射，带海绵层): $a = 340$, $A = 0.05$, $L = 1.0$, $\\phi = 0.0$, $\\sigma = 50.0$, $d = 0.2$, $N = 200$。\n\n对于每个测试用例，您的程序必须输出两个浮点数：测量的反射振幅的空间平均值和空间最大值，两者都在 $N$ 个采样位置上计算。您的程序应生成单行输出，其中包含所有测试用例的结果，连接成一个用方括号括起来的逗号分隔列表，顺序如上所示，即 $[\\text{avg}_1,\\text{max}_1,\\text{avg}_2,\\text{max}_2,\\text{avg}_3,\\text{max}_3]$，不含任何附加文本。",
            "solution": "我们从均匀静止介质中的可压缩 Navier–Stokes 方程的二维 ($2$D) 线性声学极限开始，该介质具有恒定的参考密度 $\\rho_0$ 和恒定的声速 $a$。声压 $p$ 和质点速度 $\\mathbf{u}$ 的线性化方程为\n$$\n\\frac{\\partial p}{\\partial t} + \\rho_0 a^2 \\nabla \\cdot \\mathbf{u} = 0,\\quad \\frac{\\partial \\mathbf{u}}{\\partial t} + \\frac{1}{\\rho_0} \\nabla p = \\mathbf{0}.\n$$\n消去 $\\mathbf{u}$ 可得到 $p$ 的标量波方程，\n$$\n\\frac{\\partial^2 p}{\\partial t^2} - a^2 \\nabla^2 p = 0,\n$$\n对于平面波解 $p(\\mathbf{x},t) = \\Re\\{\\hat{p}\\, e^{i(\\mathbf{k}\\cdot \\mathbf{x} - \\omega t)}\\}$，其色散关系为 $\\omega = a \\|\\mathbf{k}\\|$。\n\nNavier–Stokes 特征边界条件 (NSCBC) 代表了一类通过将特征变量与局部边界法线对齐的无反射边界处理方法。在零平均流的声学极限下，光滑边界上一个边界对齐的 NSCBC 简化为沿边界法线的出射声学特征上的一阶吸收条件，对于压力，其在边界上可以写成如下形式\n$$\n\\frac{\\partial p}{\\partial t} + a \\frac{\\partial p}{\\partial n} = 0\n$$\n其中 $\\frac{\\partial}{\\partial n} = \\hat{\\mathbf{n}} \\cdot \\nabla$，$\\hat{\\mathbf{n}}$ 是从计算域向外指的单位法向量。这个吸收条件对于法向入射波是精确的，但对于斜向入射则不完美，会导致部分反射。\n\n为了量化在法线为 $\\hat{\\mathbf{n}}$ 的局部平面边界上，方向单位向量为 $\\hat{\\mathbf{k}}$ 的单位振幅入射平面波的反射，我们考虑边界位置的总场 $p = p_i + p_r$，其中入射波为 $p_i = e^{i(\\mathbf{k}\\cdot \\mathbf{x} - \\omega t)}$，反射波为 $p_r = r\\, e^{i(\\mathbf{k}_r\\cdot \\mathbf{x} - \\omega t)}$，其反射振幅为 $r$，反射波矢量 $\\mathbf{k}_r$ 通过翻转 $\\mathbf{k}$ 的法向分量同时保持切向分量不变而得到。令 $\\cos\\theta_\\mathrm{eff} = \\hat{\\mathbf{n}} \\cdot \\hat{\\mathbf{k}}$ 为从法线测量的入射角的余弦（$\\theta_\\mathrm{eff} = 0$ 表示法向入射，$\\theta_\\mathrm{eff} = \\frac{\\pi}{2}$ 表示掠射）。将吸收边界算子应用于边界位置的 $p$，并使用平面波形式，我们有\n$$\n\\left(\\frac{\\partial}{\\partial t} + a \\frac{\\partial}{\\partial n}\\right) (p_i + p_r)\\bigg|_{\\text{boundary}} = \\left(-i\\omega + a\\, i\\, k_n\\right) + r \\left(-i\\omega - a\\, i\\, k_n\\right) = 0,\n$$\n其中 $k_n = \\|\\mathbf{k}\\| \\cos\\theta_\\mathrm{eff}$ 是入射波矢量的法向分量。色散关系给出 $\\omega = a \\|\\mathbf{k}\\|$，因此\n$$\n-i a\\|\\mathbf{k}\\| + i a \\|\\mathbf{k}\\| \\cos\\theta_\\mathrm{eff} + r \\left(-i a\\|\\mathbf{k}\\| - i a \\|\\mathbf{k}\\| \\cos\\theta_\\mathrm{eff}\\right) = 0,\n$$\n消去 $i a \\|\\mathbf{k}\\|$ 后，我们得到\n$$\n-1 + \\cos\\theta_\\mathrm{eff} + r \\left(-1 - \\cos\\theta_\\mathrm{eff}\\right) = 0.\n$$\n求解反射振幅 $r$ 得到\n$$\nr = \\frac{1 - \\cos\\theta_\\mathrm{eff}}{1 + \\cos\\theta_\\mathrm{eff}}.\n$$\n这个振幅比关系到吸收条件下的边界反射。对于 $\\theta_\\mathrm{eff} = 0$（法向入射），它给出 $r = 0$，是精确的；当 $\\theta_\\mathrm{eff} \\to \\frac{\\pi}{2}$（掠射）时，它趋近于 $r = 1$，表示全反射。对于波不冲击边界的位置（即 $\\hat{\\mathbf{n}} \\cdot \\hat{\\mathbf{k}} < 0$），没有朝向边界的入射能量，我们为了汇总计算将局部反射振幅设为零。\n\n为了考虑紧邻边界的海绵层，我们引入一个沿法线测量的厚度为 $d$、具有均匀线性阻尼系数 $\\sigma$ 的层。在声学极限下，传播距离 $s$ 的振幅会衰减 $\\exp\\left(-\\frac{\\sigma s}{a}\\right)$，因为时间 $t$ 上的时间衰减因子 $e^{-\\sigma t}$ 映射到距离 $s=at$ 上的空间衰减。对于在两次穿过海绵层（入射和反射出）后在远离边界处测量的反射波，其测量的反射振幅为\n$$\nr_\\mathrm{meas}(x) = r(x) \\exp\\left(-\\frac{2\\sigma d}{a}\\right).\n$$\n这种缩放将局部边界反射振幅乘以往返衰减。\n\n我们现在定义正弦边界。设 $y_b(x) = A \\sin\\left(\\frac{2\\pi x}{L}\\right)$，因此其导数为\n$$\ny_b'(x) = \\frac{2\\pi A}{L} \\cos\\left(\\frac{2\\pi x}{L}\\right).\n$$\n未归一化的法向量是 $\\mathbf{n}(x) = \\left(-y_b'(x), 1\\right)$，单位法向量是\n$$\n\\hat{\\mathbf{n}}(x) = \\frac{\\mathbf{n}(x)}{\\|\\mathbf{n}(x)\\|} = \\frac{\\left(-y_b'(x), 1\\right)}{\\sqrt{1 + \\left(y_b'(x)\\right)^2}}.\n$$\n对于与 $x$ 轴夹角为 $\\phi$ 的平面波，其方向单位向量是\n$$\n\\hat{\\mathbf{k}} = \\left(\\cos\\phi, \\sin\\phi\\right).\n$$\n因此，有效入射角的局部余弦是\n$$\n\\cos\\theta_\\mathrm{eff}(x) = \\hat{\\mathbf{n}}(x) \\cdot \\hat{\\mathbf{k}} = \\frac{-y_b'(x)\\cos\\phi + \\sin\\phi}{\\sqrt{1 + \\left(y_b'(x)\\right)^2}}.\n$$\n在每个边界点 $x$，当 $\\cos\\theta_\\mathrm{eff}(x) \\ge 0$ 时，在边界对齐的 NSCBC 吸收条件下的局部边界反射振幅为\n$$\nr(x) = \\frac{1 - \\cos\\theta_\\mathrm{eff}(x)}{1 + \\cos\\theta_\\mathrm{eff}(x)},\n$$\n而带海绵层时测量的反射振幅为\n$$\nr_\\mathrm{meas}(x) = r(x)\\, \\exp\\left(-\\frac{2\\sigma d}{a}\\right).\n$$\n对于 $\\cos\\theta_\\mathrm{eff}(x) < 0$ 的情况，设置 $r_\\mathrm{meas}(x) = 0$ 以表示没有与边界相遇。\n\n从算法上讲，我们用 $N$ 个点将一个波长离散化，点的位置为 $x_j = j \\Delta x$，$j = 0,1,\\dots,N-1$ 且 $\\Delta x = L/N$。我们计算 $y_b'(x_j)$ 和 $\\hat{\\mathbf{n}}(x_j)$，评估 $\\cos\\theta_\\mathrm{eff}(x_j)$，为入射子集计算 $r(x_j)$，乘以海绵层衰减因子 $\\exp\\left(-\\frac{2\\sigma d}{a}\\right)$，并汇总所有 $j$ 的空间平均值和空间最大值。这个过程评估了边界对齐的 NSCBC 投影在正弦边界引起的不同局部方向上的鲁棒性。测试用例探究了：无海绵层的一般斜向入射，无海绵层的弯曲边界上的近法向入射，以及带海绵层的掠射。输出是浮点数，表示每个测试用例的平均和最大测量反射振幅，并按规定连接成一个单一的、用方括号括起来的逗号分隔列表。",
            "answer": "```python\nimport numpy as np\n\ndef reflection_stats(a, A, L, phi, sigma, d, N):\n    \"\"\"\n    Compute spatial average and maximum of measured reflection amplitude\n    along a sinusoidal boundary for a boundary-aligned absorbing condition,\n    with optional sponge attenuation.\n\n    Parameters:\n    a (float): sound speed [m/s]\n    A (float): sinusoid amplitude [m]\n    L (float): sinusoid wavelength [m]\n    phi (float): wave direction angle from x-axis [rad]\n    sigma (float): sponge damping coefficient [1/s]\n    d (float): sponge thickness [m]\n    N (int): number of boundary samples\n\n    Returns:\n    (avg_reflection, max_reflection): tuple of floats\n    \"\"\"\n    # Discretize one wavelength\n    x = np.linspace(0.0, L, N, endpoint=False)\n\n    # Derivative of the boundary y_b'(x)\n    yp = (2.0 * np.pi * A / L) * np.cos(2.0 * np.pi * x / L)\n\n    # Unit normal at each x: n_hat = (-y', 1) / sqrt(1 + y'^2)\n    denom = np.sqrt(1.0 + yp**2)\n    n_hat_x = -yp / denom\n    n_hat_y = 1.0 / denom\n\n    # Incident wave direction unit vector k_hat\n    k_hat_x = np.cos(phi)\n    k_hat_y = np.sin(phi)\n\n    # Cosine of effective incidence angle relative to local normal\n    cos_eff = n_hat_x * k_hat_x + n_hat_y * k_hat_y\n\n    # Attenuation factor due to sponge for round trip\n    attenuation = np.exp(-2.0 * sigma * d / a) if (sigma > 0.0 and d > 0.0) else 1.0\n\n    # Reflection amplitude ratio for absorbing boundary:\n    # r = (1 - cos(theta_eff)) / (1 + cos(theta_eff)), for cos(theta_eff) >= 0\n    # For cos(theta_eff)  0 (no incidence), set r = 0\n    r_base = np.zeros_like(cos_eff)\n    # To avoid division by zero, handle cos_eff == -1 separately, but here we only apply for cos_eff >= 0\n    mask_incident = cos_eff >= 0.0\n    denom_safe = 1.0 + cos_eff[mask_incident]\n    # Compute base reflection where incident\n    r_base[mask_incident] = (1.0 - cos_eff[mask_incident]) / denom_safe\n\n    # Measured reflection after sponge attenuation\n    r_meas = r_base * attenuation\n\n    avg_reflection = float(np.mean(r_meas))\n    max_reflection = float(np.max(r_meas))\n\n    return avg_reflection, max_reflection\n\ndef solve():\n    # Define the test cases from the problem statement:\n    # Each test case is (a, A, L, phi, sigma, d, N)\n    test_cases = [\n        (340.0, 0.05, 1.0, 0.35, 0.0, 0.0, 200),          # Test 1: oblique incidence, no sponge\n        (340.0, 0.10, 1.0, np.pi / 2.0, 0.0, 0.0, 200),   # Test 2: near-normal incidence, no sponge\n        (340.0, 0.05, 1.0, 0.0, 50.0, 0.2, 200),          # Test 3: grazing with sponge\n    ]\n\n    results = []\n    for case in test_cases:\n        a, A, L, phi, sigma, d, N = case\n        avg_reflection, max_reflection = reflection_stats(a, A, L, phi, sigma, d, N)\n        results.append(avg_reflection)\n        results.append(max_reflection)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}