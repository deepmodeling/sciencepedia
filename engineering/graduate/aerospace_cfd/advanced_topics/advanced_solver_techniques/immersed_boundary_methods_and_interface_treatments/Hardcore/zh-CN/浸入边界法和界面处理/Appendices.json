{
    "hands_on_practices": [
        {
            "introduction": "布林克曼（Brinkman）惩罚法是浸入边界法中一种强大而灵活的技术，它通过在动量方程中引入一个惩罚项来近似施加边界条件。这个练习将指导你推导惩罚参数 $ \\alpha $ 与壁面滑移误差 $ \\epsilon $ 之间的直接关系，让你从理论上理解如何精确控制模拟精度。通过这个实践 ()，你将不再视惩罚参数为一个需要反复试错的“魔法数字”，而是能够根据期望的精度要求进行理性设计。",
            "id": "3966952",
            "problem": "在航空航天计算流体动力学 (CFD) 的不可压缩流模拟中，考虑在浸入边界法中使用 Brinkman 惩罚方法，在静止的、平坦的浸入式壁面上施加无滑移条件。该惩罚方法通过添加一个线性阻尼项 $-\\alpha \\chi (\\mathbf{u} - \\mathbf{u}_{b})$ 来增强动量方程，其中 $\\alpha$ 是惩罚参数，单位为 $s^{-1}$，$\\chi$ 是指示函数，在固体内部等于 $1$，在流体中等于 $0$，$\\mathbf{u}$ 是速度，$\\mathbf{u}_{b}$ 是指定的边界速度。对于静止壁面，$\\mathbf{u}_{b} = \\mathbf{0}$。\n\n假设在时间上采用步长为 $\\Delta t$ 的一阶算子分裂，其中带有运动粘度 $\\nu$ 的粘性扩散项在对流-扩散子步中处理，以产生一个尚未满足浸入边界条件的中间速度场 $\\mathbf{u}^{\\ast}$。然后，应用一个纯惩罚子步来施加无滑移条件。\n\n将滑移误差 $\\epsilon$ 定义为惩罚子步后壁面处的切向速度大小与惩罚子步前壁面处的切向速度大小的无量纲比率，即\n$$\n\\epsilon \\equiv \\frac{\\|\\mathbf{u}^{n+1}\\|_{\\text{wall}}}{\\|\\mathbf{u}^{\\ast}\\|_{\\text{wall}}}.\n$$\n从第一性原理出发，从带有 Brinkman 惩罚的半离散动量方程和一个时间步 $\\Delta t$ 内惩罚项的隐式时间积分开始，推导在静止的、平坦的浸入式壁面上实现滑移误差 $\\epsilon$ 所需的最小惩罚参数 $\\alpha$。将你的最终答案表示为 $\\alpha$ 的封闭形式解析表达式，单位为 $s^{-1}$。无需代入任何数值。",
            "solution": "该问题要求推导在浸入边界环境中使用 Brinkman 惩罚方法的惩罚参数 $\\alpha$。该推导需基于一阶算子分裂时间积分方案产生的指定滑移误差 $\\epsilon$。\n\n整个时间步进过程被分为两个子步。第一个子步涉及对流和扩散，它从时刻 $n$ 的速度（记为 $\\mathbf{u}^{n}$）计算出一个中间速度场 $\\mathbf{u}^{\\ast}$。此步骤不施加浸入边界条件。第二个子步是一个纯惩罚步骤，它将 $\\mathbf{u}^{\\ast}$ 更新为 $\\mathbf{u}^{n+1}$，从而施加边界条件。\n\n纯惩罚子步的控制方程由仅惩罚项引起的速度变化给出：\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\alpha \\chi (\\mathbf{u} - \\mathbf{u}_{b})\n$$\n问题陈述在浸入式壁面上，指示函数 $\\chi$ 等于 $1$，并且壁面是静止的，意味着指定的边界速度 $\\mathbf{u}_{b}$ 为 $\\mathbf{0}$。因此，在壁面处，控制方程简化为：\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\alpha \\mathbf{u}\n$$\n我们被要求在一个大小为 $\\Delta t$ 的时间步内，使用隐式时间积分方案离散化这个方程。设该子步开始时的速度为 $\\mathbf{u}^{\\ast}$，结束时的速度为 $\\mathbf{u}^{n+1}$。应用于该方程的一阶隐式格式（向后欧拉法）为：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{\\ast}}{\\Delta t} = -\\alpha \\mathbf{u}^{n+1}\n$$\n我们的目标是找到最终速度 $\\mathbf{u}^{n+1}$ 和中间速度 $\\mathbf{u}^{\\ast}$ 之间的关系。我们可以重新整理离散化的方程以求解 $\\mathbf{u}^{n+1}$：\n$$\n\\mathbf{u}^{n+1} - \\mathbf{u}^{\\ast} = -\\alpha \\Delta t \\mathbf{u}^{n+1}\n$$\n将所有包含 $\\mathbf{u}^{n+1}$ 的项收集到一边：\n$$\n\\mathbf{u}^{n+1} + \\alpha \\Delta t \\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast}\n$$\n提取公因子 $\\mathbf{u}^{n+1}$：\n$$\n\\mathbf{u}^{n+1} (1 + \\alpha \\Delta t) = \\mathbf{u}^{\\ast}\n$$\n这给出了惩罚子步后壁面处速度的表达式：\n$$\n\\mathbf{u}^{n+1} = \\frac{1}{1 + \\alpha \\Delta t} \\mathbf{u}^{\\ast}\n$$\n问题将无量纲滑移误差 $\\epsilon$ 定义为惩罚步骤之前和之后壁面处速度大小的比率：\n$$\n\\epsilon \\equiv \\frac{\\|\\mathbf{u}^{n+1}\\|_{\\text{wall}}}{\\|\\mathbf{u}^{\\ast}\\|_{\\text{wall}}}\n$$\n我们将推导出的 $\\mathbf{u}^{n+1}$ 表达式代入此定义。项 $\\|\\cdot\\|_{\\text{wall}}$ 表示在壁面点上评估的速度向量的大小（欧几里得范数）。\n$$\n\\epsilon = \\frac{\\left\\| \\frac{1}{1 + \\alpha \\Delta t} \\mathbf{u}^{\\ast} \\right\\|_{\\text{wall}}}{\\|\\mathbf{u}^{\\ast}\\|_{\\text{wall}}}\n$$\n项 $\\frac{1}{1 + \\alpha \\Delta t}$ 是一个标量。一个标量乘以一个向量的范数等于该标量的绝对值乘以该向量的范数。由于惩罚参数 $\\alpha$ 和时间步长 $\\Delta t$ 都是非负的物理量，标量项 $(1 + \\alpha \\Delta t)^{-1}$ 是正的。因此，我们可以写成：\n$$\n\\epsilon = \\frac{\\frac{1}{1 + \\alpha \\Delta t} \\|\\mathbf{u}^{\\ast}\\|_{\\text{wall}}}{\\|\\mathbf{u}^{\\ast}\\|_{\\text{wall}}}\n$$\n假设在惩罚之前存在非零的滑移速度，即 $\\|\\mathbf{u}^{\\ast}\\|_{\\text{wall}} \\neq 0$，我们可以从分子和分母中消去这一项：\n$$\n\\epsilon = \\frac{1}{1 + \\alpha \\Delta t}\n$$\n这个方程将期望的滑移误差 $\\epsilon$ 与惩罚参数 $\\alpha$ 和时间步长 $\\Delta t$ 联系起来。最后的任务是求解 $\\alpha$。\n$$\n1 + \\alpha \\Delta t = \\frac{1}{\\epsilon}\n$$\n$$\n\\alpha \\Delta t = \\frac{1}{\\epsilon} - 1\n$$\n$$\n\\alpha \\Delta t = \\frac{1 - \\epsilon}{\\epsilon}\n$$\n最后，除以 $\\Delta t$ 得到为实现滑移误差 $\\epsilon$ 所需的最小惩罚参数 $\\alpha$ 的封闭形式解析表达式：\n$$\n\\alpha = \\frac{1 - \\epsilon}{\\epsilon \\Delta t}\n$$\n该表达式的单位是一致的。滑移误差 $\\epsilon$ 是一个无量纲的比率。时间步长 $\\Delta t$ 的单位是秒 ($s$)。因此，$\\alpha$ 的单位是 $s^{-1}$，这与问题陈述相符。对于一个期望的误差减小（例如，$\\epsilon=0.01$），所需的惩罚参数 $\\alpha$ 与时间步长 $\\Delta t$ 成反比，这是一个在物理上和数值上都一致的结果。",
            "answer": "$$\n\\boxed{\\frac{1 - \\epsilon}{\\epsilon \\Delta t}}\n$$"
        },
        {
            "introduction": "在不可压流动的模拟中，维持离散散度的零守恒（即质量守恒）是至关重要的。然而，当在交错网格上使用浸入边界法时，为边界附近的“虚拟单元”构造速度值的插值方案可能会无意中引入误差，从而破坏散度守恒。这个练习提供了一个理想化的流场，让你能够亲手计算并量化由简单的线性插值引起的离散散度误差 ()，从而深刻理解插值算子对数值守恒性的影响。",
            "id": "3966940",
            "problem": "考虑一个在二维空间中的不可压缩流，该流场采用浸入边界法 (IBM) 在间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀标记网格法 (MAC) 交错网格上进行离散。流体占据区域 $x > s$，固体占据区域 $x \\le s$，其中浸入边界为垂直线 $x = s$，且在该边界上满足无滑移边界条件 $u = 0$ 和 $v = 0$。设所关注的单元的垂直面位于 $x = 0$ 和 $x = \\Delta x$，中心位于 $(\\Delta x/2, 0)$，浸入边界穿过该单元内部，其位置为 $x = s$，满足 $0  s  \\Delta x$。单元中心的离散散度算子定义为\n$$\nD_{h} \\equiv \\frac{u_{E} - u_{W}}{\\Delta x} + \\frac{v_{N} - v_{S}}{\\Delta y},\n$$\n其中 $u_{E}$ 和 $u_{W}$ 分别是东面和西面上的 $x$ 方向速度值，$v_{N}$ 和 $v_{S}$ 分别是北面和南面上的 $y$ 方向速度值。\n\n假设连续速度场由流函数 $\\psi(x,y)$ 生成，使得不可压缩条件 $\\nabla \\cdot \\boldsymbol{u} = 0$ 恒成立，其中 $u = \\partial \\psi / \\partial y$ 且 $v = - \\partial \\psi / \\partial x$。设流函数为\n$$\n\\psi(x,y) = \\alpha (x - s)^{2} y,\n$$\n其中 $\\alpha$ 为常数，且 $0  s  \\Delta x$。这提供了一个在 $x = s$ 处满足无滑移条件的无散流。\n\n对于位于固体区域内的被切割的西面 $x = 0$ 的 IBM 处理，考虑使用两种插值算子来构建虚拟值 $u_{W}$，使得在 $x = s$ 处求值的插值函数能够强制施加边界值 $u(x=s)=0$：\n- 一阶线性插值算子，它在 $x=0$ (虚拟点) 和 $x=\\Delta x$ (流体点) 之间对 $u$ 沿 $x$ 方向进行线性插值。\n- 二阶二次插值算子，它使用 $x = s$ (边界，值为 $u=0$)、$x = \\Delta x$ (流体点) 和 $x = 2\\Delta x$ (流体点) 这三个点对 $u$ 沿 $x$ 方向进行二次插值。\n\n使用上述定义，计算每种插值算子在单元中心的离散散度，并推导相对于连续散度（其值为零）的离散散度误差。请以单个简化表达式的形式，报告一阶线性插值算子在单元中心的离散散度误差。无需四舍五入。最终表达式为无量纲。",
            "solution": "首先对问题进行验证，以确保其科学依据充分、适定且客观。\n\n**步骤 1：提取已知条件**\n- **几何与网格**：一个在间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀标记网格法（MAC）网格上离散的二维域。\n- **浸入边界 (IB)**：位于 $x=s$ 的一条垂直线，其中 $0  s  \\Delta x$。流体区域为 $x > s$，固体区域为 $x \\le s$。\n- **边界条件**：在边界 $x=s$ 处为无滑移，即 $u=0$ 和 $v=0$。\n- **所关注的单元**：中心位于 $(\\frac{\\Delta x}{2}, 0)$，垂直面位于 $x=0$ 和 $x=\\Delta x$。\n- **离散散度算子**：在单元中心， $D_{h} \\equiv \\frac{u_{E} - u_{W}}{\\Delta x} + \\frac{v_{N} - v_{S}}{\\Delta y}$。其中，$u_{E}$ 和 $u_{W}$ 分别是东 ($x=\\Delta x$) 西 ($x=0$) 两面上的 x 方向速度，$v_{N}$ 和 $v_{S}$ 分别是散度控制体北 ($y=\\frac{\\Delta y}{2}$) 南 ($y=-\\frac{\\Delta y}{2}$) 两面上的 y 方向速度。\n- **连续流场**：由流函数 $\\psi(x,y) = \\alpha (x - s)^{2} y$ 定义，其中 $\\alpha$ 是常数。速度分量为 $u = \\frac{\\partial \\psi}{\\partial y}$ 和 $v = - \\frac{\\partial \\psi}{\\partial x}$。连续散度 $\\nabla \\cdot \\boldsymbol{u} = 0$ 成立。\n- **虚拟单元处理**：对于位于固体区域内的西面 $x=0$，速度 $u_W$ 是一个虚拟值。它通过在虚拟点 $x=0$ 和第一个流体点 $x=\\Delta x$ 之间进行一阶线性插值来确定。此插值必须强制施加边界条件 $u(s)=0$。\n- **目标**：计算一阶线性插值方案的离散散度误差。最终答案要求是无量纲表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题定义明确，并基于计算流体动力学的原理，特别是关于交错网格上的浸入边界法。给定的流函数 $\\psi(x,y) = \\alpha (x-s)^2 y$ 正确地生成了一个速度场 $u = \\alpha(x-s)^2$ 和 $v = -2\\alpha(x-s)y$。该场是无散的，因为 $\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = 2\\alpha(x-s) - 2\\alpha(x-s) = 0$，并且它在边界 $x=s$ 处满足无滑移条件 ($u=0, v=0$)。插值方案已明确指定。问题是自洽和一致的。\n\n要求最终表达式为无量纲，这可能带来一个潜在的模糊之处。量纲分析表明，如果 $x, y, s$ 的单位是长度 $[L]$，$\\psi$ 的单位是 $[L]^2/[T]$，那么 $\\alpha$ 的单位是 $1/([L][T])$，得到的离散散度 $\\alpha s$ 的单位是时间倒数 $[T]^{-1}$。然而，通过采纳理论流体力学中的标准惯例，将所有提供的变量和常数视为无量纲量，这个问题可以得到解决。这种解释与明确的指令一致，并使问题有效。\n\n**步骤 3：结论与行动**\n该问题被认为是有效的。将推导其解答。\n\n**解答推导**\n目标是计算位于 $(\\frac{\\Delta x}{2}, 0)$ 的指定控制体中心的离散散度 $D_h$。离散散度由下式给出：\n$$\nD_{h} = \\frac{u_{E} - u_{W}}{\\Delta x} + \\frac{v_{N} - v_{S}}{\\Delta y}\n$$\n连续速度场由流函数 $\\psi(x,y) = \\alpha (x-s)^2 y$ 推导得出：\n$$\nu(x,y) = \\frac{\\partial \\psi}{\\partial y} = \\alpha (x-s)^2\n$$\n$$\nv(x,y) = -\\frac{\\partial \\psi}{\\partial x} = -2\\alpha(x-s)y\n$$\n我们在散度控制体的各个面上计算速度分量。MAC 网格的交错布局将 $u$ 速度置于垂直面的中心，将 $v$ 速度置于水平面的中心。对于中心位于 $(\\frac{\\Delta x}{2}, 0)$ 的单元，面的位置如下：\n- 东面中心 (对于 $u_E$)：$(\\Delta x, 0)$\n- 西面中心 (对于 $u_W$)：$(0, 0)$\n- 北面中心 (对于 $v_N$)：$(\\frac{\\Delta x}{2}, \\frac{\\Delta y}{2})$\n- 南面中心 (对于 $v_S$)：$(\\frac{\\Delta x}{2}, -\\frac{\\Delta y}{2})$\n\n流体侧各面上的速度从连续场中取值：\n$$\nu_E = u(\\Delta x, 0) = \\alpha(\\Delta x - s)^2\n$$\n$$\nv_N = v\\left(\\frac{\\Delta x}{2}, \\frac{\\Delta y}{2}\\right) = -2\\alpha\\left(\\frac{\\Delta x}{2} - s\\right)\\left(\\frac{\\Delta y}{2}\\right) = -\\alpha\\left(\\frac{\\Delta x}{2} - s\\right)\\Delta y = -\\alpha\\left(\\frac{\\Delta x - 2s}{2}\\right)\\Delta y\n$$\n$$\nv_S = v\\left(\\frac{\\Delta x}{2}, -\\frac{\\Delta y}{2}\\right) = -2\\alpha\\left(\\frac{\\Delta x}{2} - s\\right)\\left(-\\frac{\\Delta y}{2}\\right) = \\alpha\\left(\\frac{\\Delta x}{2} - s\\right)\\Delta y = \\alpha\\left(\\frac{\\Delta x - 2s}{2}\\right)\\Delta y\n$$\n垂直速度对离散散度的贡献是：\n$$\n\\frac{v_N - v_S}{\\Delta y} = \\frac{-\\alpha(\\frac{\\Delta x - 2s}{2})\\Delta y - \\alpha(\\frac{\\Delta x - 2s}{2})\\Delta y}{\\Delta y} = -\\alpha(\\Delta x - 2s)\n$$\n接下来，我们确定在 $x=0$ 处的虚拟速度 $u_W$。一阶方案在虚拟点值 $u_W$ (位于 $x=0$) 和流体点值 $u_E$ (位于 $x=\\Delta x$) 之间使用线性插值。设 $x$ 方向速度的线性插值函数为 $u_{\\text{interp}}(x)$。\n$$\nu_{\\text{interp}}(x) = u_W + \\frac{u_E - u_W}{\\Delta x} x\n$$\n此插值必须满足在 $x=s$ 处的边界条件 $u=0$。因此，我们令 $u_{\\text{interp}}(s)=0$：\n$$\nu_W + \\frac{u_E - u_W}{\\Delta x} s = 0\n$$\n求解虚拟值 $u_W$：\n$$\nu_W \\left(1 - \\frac{s}{\\Delta x}\\right) = -u_E \\frac{s}{\\Delta x}\n$$\n$$\nu_W \\left(\\frac{\\Delta x - s}{\\Delta x}\\right) = -u_E \\frac{s}{\\Delta x}\n$$\n$$\nu_W = -u_E \\frac{s}{\\Delta x - s}\n$$\n代入 $u_E = \\alpha(\\Delta x - s)^2$ 的表达式：\n$$\nu_W = -\\left(\\alpha(\\Delta x - s)^2\\right) \\frac{s}{\\Delta x - s} = -\\alpha s (\\Delta x - s)\n$$\n现在，我们可以计算水平速度对离散散度的贡献：\n$$\n\\frac{u_E - u_W}{\\Delta x} = \\frac{\\alpha(\\Delta x - s)^2 - (-\\alpha s (\\Delta x - s))}{\\Delta x} = \\frac{\\alpha(\\Delta x - s) [(\\Delta x - s) + s]}{\\Delta x}\n$$\n$$\n\\frac{u_E - u_W}{\\Delta x} = \\frac{\\alpha(\\Delta x - s) (\\Delta x)}{\\Delta x} = \\alpha(\\Delta x - s)\n$$\n最后，我们将水平和垂直贡献相加，得到总离散散度 $D_h$：\n$$\nD_h = \\alpha(\\Delta x - s) + (-\\alpha(\\Delta x - 2s)) = \\alpha(\\Delta x - s - \\Delta x + 2s) = \\alpha s\n$$\n离散散度误差是离散散度与连续散度之差。由于该流根据构造是不可压缩的，连续散度 $\\nabla \\cdot \\boldsymbol{u}$ 恒等于零。\n$$\n\\text{误差} = D_h - (\\nabla \\cdot \\boldsymbol{u}) = \\alpha s - 0 = \\alpha s\n$$\n因此，一阶插值方案的离散散度误差为 $\\alpha s$。",
            "answer": "$$\\boxed{\\alpha s}$$"
        },
        {
            "introduction": "在模拟带有表面张力的多相流时，一个臭名昭著的数值难题是“寄生流”的产生，即在静态界面附近出现非物理的微小涡流。这个高级实践将引导你探索并实现一种精妙的“力平衡”算法 ()，它是解决此问题的关键技术。你将通过理论证明和代码实现，理解保证离散压力梯度 $ \\nabla p $ 和表面张力项 $ \\mathbf{f}_{\\sigma} $ 在形式上完全一致的重要性，并直观地对比平衡与非平衡算法在抑制寄生流方面的巨大差异。",
            "id": "3966969",
            "problem": "考虑一个二维静态液滴，它在流体体积（VOF）框架内，使用连续表面力（CSF）方法，通过浸入边界（IB）界面处理来表示。目标是实现一种力平衡格式，其中离散压力梯度和离散表面张力共享相同的微分算子和空间排列，从而最大限度地减少寄生流。请在均匀笛卡尔网格上进行操作，并假设使用无量纲变量（不需要物理单位）。推导必须从不可压缩稳态动量平衡和一个通过平滑相指示函数对表面张力进行体积力标准近似出发。\n\n使用以下基础：\n- 稳态下的不可压缩动量方程简化为$$\\nabla p = \\mathbf{f}_{\\sigma},$$ 其中$p$是压力，$\\mathbf{f}_{\\sigma}$是单位体积的表面张力。\n- CSF方法将在界面上局部化的奇异表面张力近似为$$\\mathbf{f}_{\\sigma} \\approx \\sigma \\kappa \\nabla H_{\\epsilon}(\\phi),$$ 其中$\\sigma$是表面张力系数，$\\kappa$是界面曲率，$H_{\\epsilon}$是有符号距离函数$\\phi$的平滑亥维赛德函数，$\\epsilon$是平滑半宽。\n- 对于半径为$R$的圆形液滴，平均曲率是恒定的，等于$$\\kappa = \\frac{1}{R}。$$\n\n您必须：\n1. 在一个$N_x \\times N_y$的周期性域$\\Omega = [0,1] \\times [0,1]$上实现一个离散格式，其均匀间距为$$\\Delta x = \\frac{1}{N_x}, \\quad \\Delta y = \\frac{1}{N_y},$$ 单元中心位于$$x_i = \\left(i+\\frac{1}{2}\\right)\\Delta x, \\quad y_j = \\left(j+\\frac{1}{2}\\right)\\Delta y。$$\n2. 对于一个半径为$R$、中心在$(c_x,c_y)$的液滴，构建一个有符号距离函数$$\\phi(x,y) = \\sqrt{(x-c_x)^2 + (y-c_y)^2} - R$$，并定义平滑亥维赛德函数$$H_{\\epsilon}(\\phi) = \\begin{cases} 0,  \\phi \\le -\\epsilon, \\\\ \\frac{1}{2}\\left[1 + \\frac{\\phi}{\\epsilon} + \\frac{1}{\\pi}\\sin\\left(\\frac{\\pi \\phi}{\\epsilon}\\right)\\right],  |\\phi|  \\epsilon, \\\\ 1,  \\phi \\ge \\epsilon. \\end{cases}$$\n3. 对任意标量场$q_{i,j}$，使用带周期性边界条件的二阶中心差分实现离散梯度算子，使得$$\\left(\\nabla q\\right)_{i,j} = \\left(\\frac{q_{i+1,j} - q_{i-1,j}}{2\\Delta x}, \\frac{q_{i,j+1} - q_{i,j-1}}{2\\Delta y}\\right),$$ 其中索引周期性环绕。\n4. 将力平衡压力定义为$$p = p_0 + \\sigma \\kappa H_{\\epsilon}(\\phi),$$ 其中$p_0 = 0$，并使用相同的中心差分算子计算两个梯度，从而计算稳态动量平衡的离散残差$$\\mathbf{R}_{\\text{bal}} = \\sigma \\kappa \\nabla H_{\\epsilon}(\\phi) - \\nabla p。$$\n5. 定义一个故意不平衡的格式，该格式中的算子和平滑处理不匹配：计算$$\\mathbf{R}_{\\text{unbal}} = \\sigma \\kappa \\nabla^{\\text{fwd}} H(\\phi) - \\nabla p,$$ 其中$H$是未平滑的亥维赛德函数$$H(\\phi) = \\begin{cases} 0,  \\phi  0, \\\\ 1,  \\phi \\ge 0, \\end{cases}$$ 且$\\nabla^{\\text{fwd}}$是带周期性边界条件的一阶向前差分梯度：\n$$\\left(\\nabla^{\\text{fwd}} q\\right)_{i,j} = \\left(\\frac{q_{i+1,j} - q_{i,j}}{\\Delta x}, \\frac{q_{i,j+1} - q_{i,j}}{\\Delta y}\\right)。$$\n6. 通过计算标量残差范数来量化每种情况下的不平衡程度$$\\|\\mathbf{R}\\|_2 = \\left(\\frac{1}{N_x N_y} \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left(R_x^2 + R_y^2\\right)\\right)^{1/2}。$$\n7. 在你的解中证明，在上述假设下，并且对两项使用相同的离散梯度算子时，当$\\kappa$为常数时，离散残差$\\mathbf{R}_{\\text{bal}}$恒等于零，从而在稳态下展示离散力平衡。\n\n测试套件：\n对于每种情况，取$\\epsilon = \\alpha \\Delta x$，其中$\\alpha$为指定值，$\\sigma = 1$。\n- 情况1（通用“理想路径”）：$N_x = 64$, $N_y = 64$, $R = 0.20$, $(c_x,c_y) = (0.50,0.50)$, $\\alpha = 1.5$。\n- 情况2（偏离中心靠近边界）：$N_x = 64$, $N_y = 64$, $R = 0.15$, $(c_x,c_y) = (0.35,0.40)$, $\\alpha = 1.5$。\n- 情况3（接近网格分辨率极限）：$N_x = 64$, $N_y = 64$, $R = 2\\Delta x$, $(c_x,c_y) = (0.52,0.47)$, $\\alpha = 1.0$。\n\n对于每种情况，您的程序必须计算并返回两个浮点数：平衡残差范数和非平衡残差范数，两者均为无量纲。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个情况贡献一个表示为二元列表的对，例如，$$[\\,[r_{1,\\text{bal}}, r_{1,\\text{unbal}}],\\,[r_{2,\\text{bal}}, r_{2,\\text{unbal}}],\\,[r_{3,\\text{bal}}, r_{3,\\text{unbal}}]\\,].$$",
            "solution": "所提出的问题是计算流体动力学中一个有效且适定的练习，具体涉及静态界面表面张力力的数值处理。它在科学上基于流体体积（VOF）方法与连续表面力（CSF）模型相结合的原理。其目标是展示“力平衡”离散化的重要性，即离散压力梯度和表面张力算子被一致地构造，以消除被称为寄生流的伪数值伪影。我们将首先提供离散力平衡的形式化证明，然后描述用于数值验证的算法实现。\n\n所有数学实体，包括变量、符号、算子和数字，都按要求以LaTeX格式呈现。\n\n**基于原理的推导和算法设计**\n\n所考虑的基本状态是处于平衡状态的静态流体液滴。在没有流体运动和外部体力（如重力）的情况下，不可压缩稳态Navier-Stokes动量方程简化为压力梯度力与表面张力之间的平衡：\n$$\n\\nabla p = \\mathbf{f}_{\\sigma}\n$$\n其中$p$是压力场，$\\mathbf{f}_{\\sigma}$是体积表面张力。连续表面力（CSF）方法将这种物理上局限于界面的力，通过使用平滑的相指示函数建模为一个连续场。指定的模型是：\n$$\n\\mathbf{f}_{\\sigma} = \\sigma \\kappa \\nabla H_{\\epsilon}(\\phi)\n$$\n这里，$\\sigma$是恒定的表面张力系数，$\\kappa$是界面平均曲率，$\\phi$是到界面的有符号距离函数（SDF），$H_{\\epsilon}$是一个正则化或平滑的亥维赛德函数，它在厚度为$2\\epsilon$的界面上从$0$（液滴内部）平滑过渡到$1$（液滴外部）。对于半径为$R$的圆形液滴，曲率$\\kappa = 1/R$在界面上处处恒定。\n\n**离散力平衡的证明**\n\n力平衡格式的核心原则是确保压力梯度和表面张力的离散近似在静态平衡情况下精确地相互抵消。这可以防止产生会错误地引发流体运动的非零合力。\n\n我们被要求证明平衡格式的离散残差$\\mathbf{R}_{\\text{bal}}$恒等于零。该残差定义为：\n$$\n\\mathbf{R}_{\\text{bal}} = \\sigma \\kappa \\nabla H_{\\epsilon}(\\phi) - \\nabla p\n$$\n“平衡”的方面是通过对压力场$p$的特定定义引入的。与杨-拉普拉斯方程一致，穿过界面的压力跳跃为$\\Delta p = \\sigma \\kappa$。在CSF框架中，这是通过用与表面张力相同的平滑亥维赛德函数来定义压力场本身来实现的：\n$$\np = p_0 + \\sigma \\kappa H_{\\epsilon}(\\phi)\n$$\n将参考压力$p_0$设为$0$，这简化为$p = \\sigma \\kappa H_{\\epsilon}(\\phi)$。\n\n将$p$的这个定义代入残差方程，得到：\n$$\n\\mathbf{R}_{\\text{bal}} = \\sigma \\kappa \\nabla H_{\\epsilon}(\\phi) - \\nabla \\left( \\sigma \\kappa H_{\\epsilon}(\\phi) \\right)\n$$\n在连续域中，由于$\\sigma$和$\\kappa$是常数，它们可以从梯度算子中提取出来。梯度算子$\\nabla$是一个线性算子，意味着对于任何常数标量$c$和标量场$f$，有$\\nabla(c f) = c \\nabla f$。因此，\n$$\n\\mathbf{R}_{\\text{bal}} = \\sigma \\kappa \\nabla H_{\\epsilon}(\\phi) - \\sigma \\kappa \\nabla H_{\\epsilon}(\\phi) = \\mathbf{0}\n$$\n关键步骤是验证这也适用于*离散*算子。设$\\mathcal{G}$表示指定的离散二阶中心差分梯度算子。问题陈述中指出，在$\\mathbf{R}_{\\text{bal}}$中，两项都使用完全相同的算子。在网格单元格$(i,j)$处的离散残差为：\n$$\n(\\mathbf{R}_{\\text{bal}})_{i,j} = \\sigma \\kappa \\mathcal{G}(H_{\\epsilon})_{i,j} - \\mathcal{G}(p)_{i,j}\n$$\n离散压力场在每个单元中心定义为$p_{i,j} = \\sigma \\kappa (H_{\\epsilon})_{i,j}$，其中$(H_{\\epsilon})_{i,j}$是该单元中心处平滑亥维赛德函数的值。将其代入残差：\n$$\n(\\mathbf{R}_{\\text{bal}})_{i,j} = \\sigma \\kappa \\mathcal{G}(H_{\\epsilon})_{i,j} - \\mathcal{G}(\\sigma \\kappa H_{\\epsilon})_{i,j}\n$$\n中心差分算子$\\mathcal{G}$是一个线性算子。例如，其作用于场$q$的x分量是$\\mathcal{G}_x(q)_{i,j} = (q_{i+1,j} - q_{i-1,j}) / (2\\Delta x)$。将此应用于$\\sigma \\kappa H_{\\epsilon}$：\n$$\n\\mathcal{G}_x(\\sigma \\kappa H_{\\epsilon})_{i,j} = \\frac{(\\sigma \\kappa H_{\\epsilon})_{i+1,j} - (\\sigma \\kappa H_{\\epsilon})_{i-1,j}}{2\\Delta x} = \\sigma \\kappa \\left( \\frac{(H_{\\epsilon})_{i+1,j} - (H_{\\epsilon})_{i-1,j}}{2\\Delta x} \\right) = \\sigma \\kappa \\mathcal{G}_x(H_{\\epsilon})_{i,j}\n$$\n这表明$\\mathcal{G}(\\sigma \\kappa H_{\\epsilon}) = \\sigma \\kappa \\mathcal{G}(H_{\\epsilon})$。因此，离散残差变为：\n$$\n(\\mathbf{R}_{\\text{bal}})_{i,j} = \\sigma \\kappa \\mathcal{G}(H_{\\epsilon})_{i,j} - \\sigma \\kappa \\mathcal{G}(H_{\\epsilon})_{i,j} = \\mathbf{0}\n$$\n这对域中的每个单元格$(i,j)$都成立。因此，残差的范数$\\|\\mathbf{R}_{\\text{bal}}\\|_2$必须恒等于零（或由于浮点运算而处于机器精度量级的值）。证明完毕。\n\n相比之下，非平衡格式，\n$$\n\\mathbf{R}_{\\text{unbal}} = \\sigma \\kappa \\nabla^{\\text{fwd}} H(\\phi) - \\nabla p\n$$\n被设计为无法通过此平衡测试。不平衡源于两个不同的方面：\n1.  **算子不匹配**：表面张力项使用一阶向前差分（$\\nabla^{\\text{fwd}}$）进行离散化，而压力梯度使用二阶中心差分（$\\nabla$）。这些算子具有不同的模板和截断误差，因此即使使用相同的函数，$\\sigma \\kappa \\nabla^{\\text{fwd}} H_{\\epsilon}(\\phi) \\neq \\nabla (\\sigma \\kappa H_{\\epsilon}(\\phi))$。\n2.  **函数不匹配**：表面张力项使用原始、未平滑的亥维赛德函数$H(\\phi)$，而压力是使用平滑函数$H_{\\epsilon}(\\phi)$定义的。$H(\\phi)$的梯度是狄拉克δ函数的离散近似，这与$H_{\\epsilon}(\\phi)$的光滑、钟形导数有本质上的不同。\n\n由于这些不一致性，$\\mathbf{R}_{\\text{unbal}}$将显著不为零，导致数值结果中预期出现较大的残差范数。\n\n**数值实现算法**\n\n为每个测试案例计算残差的数值过程遵循以下步骤：\n1.  **网格设置**：对于给定的分辨率$N_x, N_y$，定义域大小$L_x = 1, L_y = 1$并计算网格间距$\\Delta x = L_x/N_x$和$\\Delta y = L_y/N_y$。构建两个$N_y \\times N_x$的数组，表示单元中心坐标$x_{i,j} = (i+0.5)\\Delta x$和$y_{i,j} = (j+0.5)\\Delta y$。\n2.  **参数计算**：对于每个测试案例，使用给定的$R, c_x, c_y, \\alpha$来确定曲率$\\kappa = 1/R$和平滑宽度$\\epsilon = \\alpha \\Delta x$。表面张力系数为$\\sigma = 1$。\n3.  **场计算**：\n    -   计算有符号距离函数场$\\phi_{i,j} = \\sqrt{(x_{i,j}-c_x)^2 + (y_{i,j}-c_y)^2} - R$。\n    -   使用提供的分段公式计算平滑亥维赛德场$(H_{\\epsilon})_{i,j}$。\n    -   计算未平滑的亥维赛德场$(H)_{i,j}$。\n    -   计算压力场$p_{i,j} = \\sigma \\kappa (H_{\\epsilon})_{i,j}$。\n4.  **梯度计算**：实现两个处理周期性边界的离散梯度函数。\n    -   `grad_cen(q)`：此函数接受一个二维场$q$，并返回中心差分梯度的x和y分量的两个二维场。周期性通过数组滚动操作（例如 `numpy.roll`）来处理。\n    -   `grad_fwd(q)`：类似地，此函数计算向前差分梯度。\n5.  **残差计算**：\n    -   **平衡情况**：\n        -   使用`grad_cen`计算$(\\nabla H_{\\epsilon})_{i,j}$。\n        -   使用`grad_cen`计算$(\\nabla p)_{i,j}$。\n        -   计算残差分量：$R_{\\text{bal},x} = \\sigma \\kappa (\\nabla H_{\\epsilon})_x - (\\nabla p)_x$和$R_{\\text{bal},y} = \\sigma \\kappa (\\nabla H_{\\epsilon})_y - (\\nabla p)_y$。\n    -   **非平衡情况**：\n        -   使用`grad_fwd`计算$(\\nabla^{\\text{fwd}} H)_{i,j}$。\n        -   压力梯度$(\\nabla p)_{i,j}$与平衡情况中的相同（基于中心差分）。\n        -   计算残差分量：$R_{\\text{unbal},x} = \\sigma \\kappa (\\nabla^{\\text{fwd}} H)_x - (\\nabla p)_x$和$R_{\\text{unbal},y} = \\sigma \\kappa (\\nabla^{\\text{fwd}} H)_y - (\\nabla p)_y$。\n6.  **范数计算**：对于$\\mathbf{R}_{\\text{bal}}$和$\\mathbf{R}_{\\text{unbal}}$，按规定计算均方根范数：$\\|\\mathbf{R}\\|_2 = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (R_x^2 + R_y^2)}$。这可以高效地计算为`np.sqrt(np.mean(R_x**2 + R_y**2))`。\n7.  **迭代**：对套件中提供的所有测试案例重复步骤2-6，并按要求格式化生成的范数。",
            "answer": "```python\nimport numpy as np\n\n# Meticulous adherence to the specified execution environment:\n# language: Python 3.12\n# libraries:\n#     - name: numpy, version: 1.23.5\n\ndef solve():\n    \"\"\"\n    Computes balanced and unbalanced force residuals for a static droplet\n    using an Immersed Boundary (CSF) method.\n    \"\"\"\n\n    def grad_cen(q, dx, dy):\n        \"\"\"Computes the 2D gradient using second-order central differences\n        with periodic boundary conditions.\"\"\"\n        grad_x = (np.roll(q, -1, axis=1) - np.roll(q, 1, axis=1)) / (2.0 * dx)\n        grad_y = (np.roll(q, -1, axis=0) - np.roll(q, 1, axis=0)) / (2.0 * dy)\n        return grad_x, grad_y\n\n    def grad_fwd(q, dx, dy):\n        \"\"\"Computes the 2D gradient using first-order forward differences\n        with periodic boundary conditions.\"\"\"\n        grad_x = (np.roll(q, -1, axis=1) - q) / dx\n        grad_y = (np.roll(q, -1, axis=0) - q) / dy\n        return grad_x, grad_y\n\n    def H_eps_func(phi, epsilon):\n        \"\"\"Computes the smoothed Heaviside function H_epsilon(phi).\"\"\"\n        H = np.zeros_like(phi)\n        \n        # Condition: phi >= epsilon\n        H[phi >= epsilon] = 1.0\n        \n        # Condition: |phi|  epsilon\n        mask = np.abs(phi)  epsilon\n        phi_masked = phi[mask]\n        \n        # The transition region\n        term1 = 1.0 + phi_masked / epsilon\n        term2 = (1.0 / np.pi) * np.sin(np.pi * phi_masked / epsilon)\n        H[mask] = 0.5 * (term1 + term2)\n        \n        # For phi = -epsilon, H remains 0, which is correct.\n        \n        return H\n\n    def H_func(phi):\n        \"\"\"Computes the unsmoothed Heaviside function H(phi).\"\"\"\n        H = np.zeros_like(phi)\n        H[phi >= 0] = 1.0\n        return H\n\n    def calculate_residual_norm(Rx, Ry):\n        \"\"\"Computes the L2 norm of the residual vector field.\"\"\"\n        return np.sqrt(np.mean(Rx**2 + Ry**2))\n\n    # Test suite as defined in the problem statement.\n    test_cases = [\n        # (Nx, Ny, R, cx, cy, alpha)\n        (64, 64, 0.20, 0.50, 0.50, 1.5),  # Case 1\n        (64, 64, 0.15, 0.35, 0.40, 1.5),  # Case 2\n        (64, 64, 2.0 * (1.0/64), 0.52, 0.47, 1.0), # Case 3 R=2*dx\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Nx, Ny, R, cx, cy, alpha = case\n        \n        # --- 1. Grid and Parameter Setup ---\n        sigma = 1.0\n        dx = 1.0 / Nx\n        dy = 1.0 / Ny\n        \n        # Check for R=0 to avoid division by zero, although not in test cases\n        if R == 0:\n            kappa = np.inf\n        else:\n            kappa = 1.0 / R\n            \n        epsilon = alpha * dx # Assuming dx=dy for simplicity in definition\n\n        x = (np.arange(Nx) + 0.5) * dx\n        y = (np.arange(Ny) + 0.5) * dy\n        X, Y = np.meshgrid(x, y, indexing='ij') # Use 'ij' indexing to match loop order (i,j) -> (x,y)\n\n        # --- 2. Field Computations ---\n        phi = np.sqrt((X - cx)**2 + (Y - cy)**2) - R\n        \n        H_eps_field = H_eps_func(phi, epsilon)\n        H_field = H_func(phi)\n        \n        p_field = sigma * kappa * H_eps_field\n\n        # --- 3. Balanced Case Calculation ---\n        # Surface tension term using central differences on H_eps\n        f_sigma_x_bal, f_sigma_y_bal = grad_cen(H_eps_field, dx, dy)\n        f_sigma_x_bal *= sigma * kappa\n        f_sigma_y_bal *= sigma * kappa\n        \n        # Pressure gradient term using central differences on p\n        grad_p_x_cen, grad_p_y_cen = grad_cen(p_field, dx, dy)\n\n        # Balanced residual\n        R_bal_x = f_sigma_x_bal - grad_p_x_cen\n        R_bal_y = f_sigma_y_bal - grad_p_y_cen\n        \n        norm_bal = calculate_residual_norm(R_bal_x.T, R_bal_y.T) # Transpose back due to 'ij' indexing change\n\n        # --- 4. Unbalanced Case Calculation ---\n        # Surface tension term using forward differences on H\n        f_sigma_x_unbal, f_sigma_y_unbal = grad_fwd(H_field, dx, dy)\n        f_sigma_x_unbal *= sigma * kappa\n        f_sigma_y_unbal *= sigma * kappa\n\n        # Pressure gradient is the same as before (central difference on p based on H_eps)\n        # grad_p_x_cen, grad_p_y_cen are already computed\n\n        # Unbalanced residual\n        R_unbal_x = f_sigma_x_unbal - grad_p_x_cen\n        R_unbal_y = f_sigma_y_unbal - grad_p_y_cen\n        \n        norm_unbal = calculate_residual_norm(R_unbal_x.T, R_unbal_y.T) # Transpose back\n\n        results.append([norm_bal, norm_unbal])\n\n    # --- 5. Final Output Formatting ---\n    # The required format is [[r1_bal, r1_unbal],[r2_bal, r2_unbal],...], which\n    # is a list of lists. The str() of a list of lists gives '[...]', so we join them.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}