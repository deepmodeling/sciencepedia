{
    "hands_on_practices": [
        {
            "introduction": "Before diving into the mechanics of residual smoothing, it's crucial to understand why we apply this process to the residuals and not directly to the solution variables. This first exercise provides a compelling demonstration using a simple linear system. By comparing two iterative strategies—one that smooths the solution and one that smooths the residual—you will discover how the former can lead to an incorrect converged solution, while the latter is designed to preserve the true fixed point of the system .",
            "id": "3990444",
            "problem": "Consider a steady linear discrete system arising from a one-dimensional second-order elliptic operator in Computational Fluid Dynamics (CFD), written as $A u = f$ with\n$$\nA = \\begin{pmatrix} 2 & -1 \\\\ -1 & 2 \\end{pmatrix}, \\qquad f = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.\n$$\nLet the residual at iteration $k$ be $r^{(k)} = f - A u^{(k)}$. Define a simple averaging filter $S$ acting on two-component vectors by\n$$\nS = \\begin{pmatrix} \\tfrac{1}{2} & \\tfrac{1}{2} \\\\ \\tfrac{1}{2} & \\tfrac{1}{2} \\end{pmatrix},\n$$\nwhich replaces both components by their arithmetic mean. Consider explicit Richardson iteration with relaxation parameter $\\omega \\neq 0$, and two distinct smoothing strategies used in steady iteration:\n\n- Strategy $\\mathrm{V}$ (solution-variable smoothing): $u^{(k+1)} = S\\big(u^{(k)} + \\omega (f - A u^{(k)})\\big)$,\n- Strategy $\\mathrm{R}$ (residual smoothing): $u^{(k+1)} = u^{(k)} + \\omega S\\big(f - A u^{(k)}\\big)$.\n\nStarting from the fundamental definitions of residual and fixed point, and without appealing to any unstated properties of $A$ or $S$, derive the fixed-point conditions for both strategies. Then, compute the exact solution $u^{\\star}$ to $A u = f$, determine the fixed point $u_{\\mathrm{V}}^{\\star}$ of Strategy $\\mathrm{V}$, and verify that $u^{\\star}$ is a fixed point of Strategy $\\mathrm{R}$. Finally, compute the Euclidean norm $\\|u_{\\mathrm{V}}^{\\star} - u^{\\star}\\|_{2}$ and provide its exact value. Express the final answer in exact form with no rounding and no units.",
            "solution": "The problem statement is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\n- The linear system is $A u = f$.\n- Matrix $A$:\n$$\nA = \\begin{pmatrix} 2 & -1 \\\\ -1 & 2 \\end{pmatrix}\n$$\n- Vector $f$:\n$$\nf = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}\n$$\n- Residual definition: $r^{(k)} = f - A u^{(k)}$.\n- Smoothing filter $S$:\n$$\nS = \\begin{pmatrix} \\tfrac{1}{2} & \\tfrac{1}{2} \\\\ \\tfrac{1}{2} & \\tfrac{1}{2} \\end{pmatrix}\n$$\n- Relaxation parameter: $\\omega \\neq 0$.\n- Strategy V (solution-variable smoothing): $u^{(k+1)} = S\\big(u^{(k)} + \\omega (f - A u^{(k)})\\big)$.\n- Strategy R (residual smoothing): $u^{(k+1)} = u^{(k)} + \\omega S\\big(f - A u^{(k)}\\big)$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is a well-defined exercise in numerical linear algebra, specifically concerning iterative methods for solving linear systems of equations. Such systems commonly arise from the discretization of partial differential equations in CFD and other fields. The matrices $A$ and $S$ are explicitly given and well-behaved. The iterative schemes are standard forms, and the tasks are direct applications of the definitions. The matrix $A$ represents a discrete one-dimensional Laplacian, a fundamental elliptic operator. The smoother $S$ is a simple averaging filter.\nThe problem is scientifically grounded, objective, and self-contained. It contains no contradictions, ambiguities, or factual unsoundness. A unique solution for all requested quantities can be determined.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full solution will be provided.\n\n**Derivation of Fixed-Point Conditions**\nA fixed point $u^{\\star}$ of any iterative scheme $u^{(k+1)} = G(u^{(k)})$ must satisfy the condition $u^{\\star} = G(u^{\\star})$.\n\nFor Strategy V, the iteration is $u^{(k+1)} = S\\big(u^{(k)} + \\omega (f - A u^{(k)})\\big)$. The fixed-point condition is thus:\n$$\nu_{\\mathrm{V}}^{\\star} = S\\big(u_{\\mathrm{V}}^{\\star} + \\omega (f - A u_{\\mathrm{V}}^{\\star})\\big)\n$$\nThis is the fixed-point condition for Strategy V. It can be written as a linear system for $u_{\\mathrm{V}}^{\\star}$: $(I - S(I - \\omega A))u_{\\mathrm{V}}^{\\star} = \\omega S f$, where $I$ is the identity matrix.\n\nFor Strategy R, the iteration is $u^{(k+1)} = u^{(k)} + \\omega S\\big(f - A u^{(k)}\\big)$. The fixed-point condition is:\n$$\nu_{\\mathrm{R}}^{\\star} = u_{\\mathrm{R}}^{\\star} + \\omega S\\big(f - A u_{\\mathrm{R}}^{\\star}\\big)\n$$\nSubtracting $u_{\\mathrm{R}}^{\\star}$ from both sides gives:\n$$\n0 = \\omega S\\big(f - A u_{\\mathrm{R}}^{\\star}\\big)\n$$\nSince the problem states $\\omega \\neq 0$, we can divide by $\\omega$ to obtain the fixed-point condition for Strategy R:\n$$\nS\\big(f - A u_{\\mathrm{R}}^{\\star}\\big) = 0\n$$\nThis condition means that the smoothed residual at the fixed point must be zero.\n\n**Computation of the Exact Solution $u^{\\star}$**\nThe exact solution $u^{\\star}$ satisfies the linear system $A u^{\\star} = f$. We can find $u^{\\star}$ by computing the inverse of $A$. The determinant of $A$ is $\\det(A) = (2)(2) - (-1)(-1) = 4 - 1 = 3$. The inverse is:\n$$\nA^{-1} = \\frac{1}{\\det(A)} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}\n$$\nThe solution $u^{\\star}$ is then calculated as:\n$$\nu^{\\star} = A^{-1}f = \\frac{1}{3} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} (2)(1) + (1)(0) \\\\ (1)(1) + (2)(0) \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{3} \\\\ \\frac{1}{3} \\end{pmatrix}\n$$\n\n**Determination of the Fixed Point $u_{\\mathrm{V}}^{\\star}$ of Strategy V**\nThe fixed-point equation for Strategy V is $u_{\\mathrm{V}}^{\\star} = S\\big(u_{\\mathrm{V}}^{\\star} + \\omega(f - A u_{\\mathrm{V}}^{\\star})\\big)$. The matrix $S$ maps any vector to a vector whose components are equal (the average of the input components). Therefore, the output of the right-hand side, and thus $u_{\\mathrm{V}}^{\\star}$ itself, must have equal components. Let $u_{\\mathrm{V}}^{\\star} = \\begin{pmatrix} c \\\\ c \\end{pmatrix}$ for some scalar $c$.\nWe substitute this form into the fixed-point equation. First, we compute the term inside the parentheses:\n$$\nu_{\\mathrm{V}}^{\\star} + \\omega(f - A u_{\\mathrm{V}}^{\\star}) = \\begin{pmatrix} c \\\\ c \\end{pmatrix} + \\omega \\left( \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 2 & -1 \\\\ -1 & 2 \\end{pmatrix} \\begin{pmatrix} c \\\\ c \\end{pmatrix} \\right)\n$$\n$$\n= \\begin{pmatrix} c \\\\ c \\end{pmatrix} + \\omega \\left( \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 2c-c \\\\ -c+2c \\end{pmatrix} \\right) = \\begin{pmatrix} c \\\\ c \\end{pmatrix} + \\omega \\begin{pmatrix} 1-c \\\\ -c \\end{pmatrix} = \\begin{pmatrix} c + \\omega(1-c) \\\\ c - \\omega c \\end{pmatrix}\n$$\nNow, apply the smoothing operator $S$:\n$$\nS \\begin{pmatrix} c + \\omega - \\omega c \\\\ c - \\omega c \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} & \\frac{1}{2} \\\\ \\frac{1}{2} & \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} c + \\omega - \\omega c \\\\ c - \\omega c \\end{pmatrix} = \\frac{1}{2} \\begin{pmatrix} (c + \\omega - \\omega c) + (c - \\omega c) \\\\ (c + \\omega - \\omega c) + (c - \\omega c) \\end{pmatrix} = \\begin{pmatrix} c + \\frac{\\omega}{2} - \\omega c \\\\ c + \\frac{\\omega}{2} - \\omega c \\end{pmatrix}\n$$\nFor this to be a fixed point, the result must be equal to $u_{\\mathrm{V}}^{\\star} = \\begin{pmatrix} c \\\\ c \\end{pmatrix}$. Thus, we must have:\n$$\nc = c + \\frac{\\omega}{2} - \\omega c\n$$\n$$\n0 = \\frac{\\omega}{2} - \\omega c = \\omega \\left( \\frac{1}{2} - c \\right)\n$$\nSince $\\omega \\neq 0$, it follows that $\\frac{1}{2} - c = 0$, which gives $c = \\frac{1}{2}$.\nTherefore, the fixed point for Strategy V is:\n$$\nu_{\\mathrm{V}}^{\\star} = \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix}\n$$\nThis demonstrates that the fixed point for solution-variable smoothing is different from the true solution $u^{\\star}$.\n\n**Verification that $u^{\\star}$ is a Fixed Point of Strategy R**\nThe fixed-point condition for Strategy R is $S(f - A u_{\\mathrm{R}}^{\\star}) = 0$. We must verify if $u^{\\star} = \\begin{pmatrix} 2/3 \\\\ 1/3 \\end{pmatrix}$ satisfies this condition.\nWe substitute $u_{\\mathrm{R}}^{\\star} = u^{\\star}$ into the condition:\n$$\nS(f - A u^{\\star})\n$$\nBy definition, $u^{\\star}$ is the solution to $A u = f$, so $A u^{\\star} = f$. This implies that the residual is the zero vector: $f - A u^{\\star} = 0$.\nThe expression becomes:\n$$\nS(0) = \\begin{pmatrix} \\frac{1}{2} & \\frac{1}{2} \\\\ \\frac{1}{2} & \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nThe condition $0=0$ is satisfied. Thus, the exact solution $u^{\\star}$ is indeed a fixed point of Strategy R.\n\n**Computation of the Euclidean Norm of the Difference**\nFinally, we compute the Euclidean norm of the difference between the fixed point of Strategy V and the exact solution, $\\|u_{\\mathrm{V}}^{\\star} - u^{\\star}\\|_{2}$.\nThe difference vector is:\n$$\nu_{\\mathrm{V}}^{\\star} - u^{\\star} = \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{1}{2} \\end{pmatrix} - \\begin{pmatrix} \\frac{2}{3} \\\\ \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{3}{6} - \\frac{4}{6} \\\\ \\frac{3}{6} - \\frac{2}{6} \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{6} \\\\ \\frac{1}{6} \\end{pmatrix}\n$$\nThe Euclidean norm is calculated as $\\sqrt{v_1^2 + v_2^2}$:\n$$\n\\|u_{\\mathrm{V}}^{\\star} - u^{\\star}\\|_{2} = \\sqrt{\\left(-\\frac{1}{6}\\right)^2 + \\left(\\frac{1}{6}\\right)^2} = \\sqrt{\\frac{1}{36} + \\frac{1}{36}} = \\sqrt{\\frac{2}{36}} = \\sqrt{\\frac{1}{18}}\n$$\nSimplifying the result:\n$$\n\\sqrt{\\frac{1}{18}} = \\frac{1}{\\sqrt{18}} = \\frac{1}{\\sqrt{9 \\times 2}} = \\frac{1}{3\\sqrt{2}} = \\frac{1}{3\\sqrt{2}} \\cdot \\frac{\\sqrt{2}}{\\sqrt{2}} = \\frac{\\sqrt{2}}{6}\n$$\nThe exact value of the norm is $\\frac{\\sqrt{2}}{6}$.",
            "answer": "$$\n\\boxed{\\frac{\\sqrt{2}}{6}}\n$$"
        },
        {
            "introduction": "With the motivation for residual smoothing established, let's turn to its practical implementation, particularly in the context of finite volume methods on unstructured meshes. This practice guides you through a concrete calculation on a small mesh patch, where you will compute geometric weights based on face areas and centroid distances. This exercise demystifies the abstract smoothing operator by grounding it in a tangible numerical task common in real-world CFD codes .",
            "id": "3990443",
            "problem": "In steady-state explicit Computational Fluid Dynamics (CFD) for compressible flow in aerospace applications, residual smoothing is used to accelerate convergence without violating conservation. Consider a two-dimensional unstructured finite-volume patch consisting of a central control volume indexed by $i$ and four face-sharing neighbors indexed by $j \\in \\{1,2,3,4\\}$. Let the residual associated with the conservation equations in control volume $i$ be $r_{i}$ and the neighbor residuals be $r_{j}$. A smoothing operator must be constructed from first principles such that it is consistent with discrete diffusion derived from fluxes computed via Fick's law, preserves any constant residual field, and uses positive, normalized geometric weights built from face areas and neighbor distances.\n\nStarting from the requirement that the smoothing be a local discrete diffusion step consistent with face-based fluxes proportional to face area and the gradient approximated over inter-centroid distance, construct a smoothing operator for $r_{i}$ using weights of the form $w_{ij} = s_{ij} / S_{i}$ with $s_{ij} \\propto A_{ij} / d_{ij}$, where $A_{ij}$ is the shared face area between control volumes $i$ and $j$ and $d_{ij}$ is the distance between their centroids, and $S_{i} = \\sum_{k \\in N(i)} s_{ik}$. The operator must preserve constant residual fields and ensure positivity and normalization of weights.\n\nFor the specific patch, the geometric data and residuals are:\n- $A_{i1} = 0.8$, $d_{i1} = 0.4$, $r_{1} = 0.012$.\n- $A_{i2} = 0.6$, $d_{i2} = 0.3$, $r_{2} = 0.020$.\n- $A_{i3} = 1.2$, $d_{i3} = 0.6$, $r_{3} = 0.018$.\n- $A_{i4} = 0.9$, $d_{i4} = 0.3$, $r_{4} = 0.010$.\n- Central residual $r_{i} = 0.015$.\n\nUse a dimensionless smoothing coefficient $\\alpha$ with $0 < \\alpha < 1$, specifically $\\alpha = 0.35$. Compute the smoothed residual in cell $i$ produced by a convex combination of $r_{i}$ and the normalized neighbor average constructed from the weights $w_{ij}$ built from $s_{ij} = A_{ij}/d_{ij}$. Verify that the weights satisfy the normalization requirement. Express your final answer as a dimensionless number and round your answer to four significant figures.",
            "solution": "The problem presents a valid and well-posed scenario in computational fluid dynamics, specifically concerning the application of a residual smoothing technique to accelerate convergence in an explicit numerical scheme. The task is to compute the smoothed residual for a central control volume given its own residual, the residuals of its neighbors, and the geometric properties of the computational mesh patch.\n\nThe process of residual smoothing can be formulated as a discrete diffusion process. The smoothed residual, which we shall denote as $\\bar{r}_{i}$ for the central control volume $i$, is an updated value based on the original residual $r_{i}$ and a weighted average of the residuals from its neighboring control volumes $j \\in N(i)$. The problem specifies that the smoothed residual is a convex combination of $r_{i}$ and the normalized neighbor average. This is expressed as:\n$$ \\bar{r}_{i} = (1 - \\alpha) r_{i} + \\alpha \\sum_{j \\in N(i)} w_{ij} r_{j} $$\nwhere $\\alpha$ is a dimensionless smoothing coefficient, and $w_{ij}$ are the normalized weights. This formulation ensures that if the residual field is constant (i.e., $r_{j} = r_{i}$ for all neighbors $j$), then $\\bar{r}_{i} = r_{i}$, a key property for any such operator.\n\nThe weights $w_{ij}$ must be constructed from the geometric data provided. The problem specifies that the unnormalized weights, $s_{ij}$, are given by the ratio of the shared face area $A_{ij}$ to the distance between the cell centroids $d_{ij}$:\n$$ s_{ij} = \\frac{A_{ij}}{d_{ij}} $$\nThese unnormalized weights are consistent with a discrete diffusion flux, where the \"diffusivity\" is proportional to the geometric conductance between cells.\n\nThe normalized weights $w_{ij}$ are then computed by dividing each $s_{ij}$ by the sum of all unnormalized weights for the neighbors of cell $i$:\n$$ w_{ij} = \\frac{s_{ij}}{S_{i}}, \\quad \\text{where} \\quad S_{i} = \\sum_{k \\in N(i)} s_{ik} $$\nBy this construction, the weights are guaranteed to be positive (since $A_{ij} > 0$ and $d_{ij} > 0$) and normalized, such that $\\sum_{j \\in N(i)} w_{ij} = 1$.\n\nWe are given the following data for the central cell $i$ and its four neighbors $j \\in \\{1, 2, 3, 4\\}$:\n- Central residual: $r_{i} = 0.015$\n- Smoothing coefficient: $\\alpha = 0.35$\n- Neighbor data:\n  - $A_{i1} = 0.8$, $d_{i1} = 0.4$, $r_{1} = 0.012$\n  - $A_{i2} = 0.6$, $d_{i2} = 0.3$, $r_{2} = 0.020$\n  - $A_{i3} = 1.2$, $d_{i3} = 0.6$, $r_{3} = 0.018$\n  - $A_{i4} = 0.9$, $d_{i4} = 0.3$, $r_{4} = 0.010$\n\nFirst, we compute the unnormalized weights $s_{ij}$:\n$$ s_{i1} = \\frac{A_{i1}}{d_{i1}} = \\frac{0.8}{0.4} = 2.0 $$\n$$ s_{i2} = \\frac{A_{i2}}{d_{i2}} = \\frac{0.6}{0.3} = 2.0 $$\n$$ s_{i3} = \\frac{A_{i3}}{d_{i3}} = \\frac{1.2}{0.6} = 2.0 $$\n$$ s_{i4} = \\frac{A_{i4}}{d_{i4}} = \\frac{0.9}{0.3} = 3.0 $$\n\nNext, we calculate the normalization factor $S_{i}$:\n$$ S_{i} = s_{i1} + s_{i2} + s_{i3} + s_{i4} = 2.0 + 2.0 + 2.0 + 3.0 = 9.0 $$\n\nNow, we compute the normalized weights $w_{ij}$:\n$$ w_{i1} = \\frac{s_{i1}}{S_{i}} = \\frac{2.0}{9.0} = \\frac{2}{9} $$\n$$ w_{i2} = \\frac{s_{i2}}{S_{i}} = \\frac{2.0}{9.0} = \\frac{2}{9} $$\n$$ w_{i3} = \\frac{s_{i3}}{S_{i}} = \\frac{2.0}{9.0} = \\frac{2}{9} $$\n$$ w_{i4} = \\frac{s_{i4}}{S_{i}} = \\frac{3.0}{9.0} = \\frac{3}{9} = \\frac{1}{3} $$\n\nAs required, we verify that the weights are normalized:\n$$ \\sum_{j=1}^{4} w_{ij} = w_{i1} + w_{i2} + w_{i3} + w_{i4} = \\frac{2}{9} + \\frac{2}{9} + \\frac{2}{9} + \\frac{3}{9} = \\frac{2+2+2+3}{9} = \\frac{9}{9} = 1 $$\nThe normalization requirement is satisfied.\n\nNext, we calculate the normalized neighbor average of the residuals, which we denote as $\\langle r \\rangle_{N(i)}$:\n$$ \\langle r \\rangle_{N(i)} = \\sum_{j=1}^{4} w_{ij} r_{j} = w_{i1}r_{1} + w_{i2}r_{2} + w_{i3}r_{3} + w_{i4}r_{4} $$\n$$ \\langle r \\rangle_{N(i)} = \\left(\\frac{2}{9}\\right)(0.012) + \\left(\\frac{2}{9}\\right)(0.020) + \\left(\\frac{2}{9}\\right)(0.018) + \\left(\\frac{3}{9}\\right)(0.010) $$\n$$ \\langle r \\rangle_{N(i)} = \\frac{1}{9} \\left( 2 \\cdot 0.012 + 2 \\cdot 0.020 + 2 \\cdot 0.018 + 3 \\cdot 0.010 \\right) $$\n$$ \\langle r \\rangle_{N(i)} = \\frac{1}{9} \\left( 0.024 + 0.040 + 0.036 + 0.030 \\right) $$\n$$ \\langle r \\rangle_{N(i)} = \\frac{1}{9} (0.130) $$\n\nFinally, we compute the smoothed residual $\\bar{r}_{i}$ using the convex combination:\n$$ \\bar{r}_{i} = (1 - \\alpha) r_{i} + \\alpha \\langle r \\rangle_{N(i)} $$\nSubstituting the given values $\\alpha = 0.35$ and $r_{i} = 0.015$:\n$$ \\bar{r}_{i} = (1 - 0.35)(0.015) + (0.35)\\left(\\frac{0.130}{9}\\right) $$\n$$ \\bar{r}_{i} = (0.65)(0.015) + \\frac{0.0455}{9} $$\n$$ \\bar{r}_{i} = 0.00975 + 0.0050555... $$\n$$ \\bar{r}_{i} = 0.01480555... $$\n\nThe problem requires the final answer to be rounded to four significant figures. The first four significant figures are $1$, $4$, $8$, $0$. The fifth digit is $5$, which requires rounding up the fourth digit.\n$$ \\bar{r}_{i} \\approx 0.01481 $$",
            "answer": "$$\n\\boxed{0.01481}\n$$"
        },
        {
            "introduction": "Residual smoothing is a powerful tool, but its application is governed by stability constraints; applying too much smoothing can destabilize the entire numerical scheme. This final practice uses Fourier analysis—a cornerstone of numerical stability theory—to determine the maximum allowable smoothing parameter, $\\alpha_{\\max}$, for a standard 2D smoother on a structured grid. You will see firsthand how grid properties, specifically the cell aspect ratio, dictate the stable operating range of the smoother .",
            "id": "3990484",
            "problem": "Consider the two-dimensional linear advection equation on a periodic rectangular domain,\n$$\nu_t + a\\,u_x + b\\,u_y = 0,\n$$\nwith constant velocities $a$ and $b$, discretized on a structured uniform grid with spacings $h_x$ and $h_y$ in the $x$ and $y$ directions, respectively. Let $r_{i,j}$ denote the discrete residual at grid point $(i,j)$ arising from any linear, consistent finite-volume or finite-difference spatial operator for the advection equation. A residual smoothing strategy is applied before the pseudo-time update by performing a single explicit smoothing step using the standard $5$-point discrete Laplacian:\n$$\nr^{\\mathrm{sm}}_{i,j} \\;=\\; r_{i,j} \\;+\\; \\alpha\\left(\\frac{r_{i+1,j} - 2 r_{i,j} + r_{i-1,j}}{h_x^2} \\;+\\; \\frac{r_{i,j+1} - 2 r_{i,j} + r_{i,j-1}}{h_y^2}\\right),\n$$\nwhere $\\alpha$ is a scalar smoothing parameter. Assume periodic boundary conditions in both directions and a uniform infinite grid approximation so that Fourier analysis applies.\n\nUsing only fundamental stability analysis via Fourier (Von Neumann) modes and the properties of the discrete Laplacian on a uniform structured grid, derive the largest value $\\alpha_{\\max}$ such that for every grid Fourier mode the smoothing map $r \\mapsto r^{\\mathrm{sm}}$ is non-amplifying in magnitude, that is, the amplification factor of the smoothing step has modulus less than or equal to $1$ for all wavenumbers. Express your answer as a function of $h_x$ and $h_y$. Explain why the advection velocities $a$ and $b$ do not enter the final bound for $\\alpha$ under this residual smoothing strategy.\n\nThen, implement a program that computes $\\alpha_{\\max}$ for each of the following test cases:\n- Case $1$: $h_x = 1.0$, $h_y = 1.0$.\n- Case $2$: $h_x = 1.0$, $h_y = 0.5$.\n- Case $3$: $h_x = 0.1$, $h_y = 0.1$.\n- Case $4$: $h_x = 0.05$, $h_y = 0.2$.\n\nAll quantities are to be treated as dimensionless numbers. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases given above. Specifically, the output format must be\n$$\n[\\alpha_{\\max}^{(1)},\\alpha_{\\max}^{(2)},\\alpha_{\\max}^{(3)},\\alpha_{\\max}^{(4)}].\n$$",
            "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique and meaningful solution. The question addresses a standard technique in computational fluid dynamics (CFD) and its analysis is tractable via fundamental principles of numerical stability theory.\n\nThe core of the problem is to determine the stability limit of the residual smoothing operator. This is accomplished using Fourier (or Von Neumann) stability analysis. The smoothing operation is a linear map from the initial residual field, $r$, to the smoothed residual field, $r^{\\mathrm{sm}}$. We analyze its effect on a single generic Fourier mode of the residual field.\n\nConsider a single Fourier mode on the discrete grid, where the residual at grid point $(i,j)$, with coordinates $(x_i, y_j) = (i h_x, j h_y)$, is given by\n$$\nr_{i,j} = \\hat{r}(k_x, k_y) e^{I(k_x x_i + k_y y_j)} = \\hat{r}(k_x, k_y) e^{I(k_x i h_x + k_y j h_y)}\n$$\nwhere $I = \\sqrt{-1}$ is the imaginary unit, $(k_x, k_y)$ are the wavenumbers in the $x$ and $y$ directions, and $\\hat{r}$ is the complex amplitude of the mode. It is convenient to define the dimensionless phase angles $\\theta_x = k_x h_x$ and $\\theta_y = k_y h_y$. For a discrete grid, these angles range from $-\\pi$ to $\\pi$. A single mode can thus be written as $r_{i,j} \\propto e^{I(i\\theta_x + j\\theta_y)}$.\n\nThe smoothed residual, $r^{\\mathrm{sm}}_{i,j}$, is related to the original residual, $r_{i,j}$, by an amplification factor $G(\\theta_x, \\theta_y)$, such that $r^{\\mathrm{sm}}_{i,j} = G(\\theta_x, \\theta_y) r_{i,j}$. Our goal is to find this amplification factor by substituting the Fourier mode into the given smoothing formula:\n$$\nr^{\\mathrm{sm}}_{i,j} = r_{i,j} + \\alpha\\left(\\frac{r_{i+1,j} - 2 r_{i,j} + r_{i-1,j}}{h_x^2} + \\frac{r_{i,j+1} - 2 r_{i,j} + r_{i,j-1}}{h_y^2}\\right)\n$$\nSubstituting the relationships for neighboring points, $r_{i\\pm1, j} = r_{i,j} e^{\\pm I\\theta_x}$ and $r_{i, j\\pm1} = r_{i,j} e^{\\pm I\\theta_y}$, we obtain:\n$$\nG r_{i,j} = r_{i,j} + \\alpha\\left(\\frac{r_{i,j}(e^{I\\theta_x} - 2 + e^{-I\\theta_x})}{h_x^2} + \\frac{r_{i,j}(e^{I\\theta_y} - 2 + e^{-I\\theta_y})}{h_y^2}\\right)\n$$\nDividing by $r_{i,j}$ (which is non-zero for a given mode) yields the amplification factor $G$:\n$$\nG(\\theta_x, \\theta_y) = 1 + \\alpha\\left(\\frac{e^{I\\theta_x} + e^{-I\\theta_x} - 2}{h_x^2} + \\frac{e^{I\\theta_y} + e^{-I\\theta_y} - 2}{h_y^2}\\right)\n$$\nUsing the identity $e^{I\\theta} + e^{-I\\theta} = 2\\cos(\\theta)$, we can simplify the expression:\n$$\nG(\\theta_x, \\theta_y) = 1 + \\alpha\\left(\\frac{2\\cos(\\theta_x) - 2}{h_x^2} + \\frac{2\\cos(\\theta_y) - 2}{h_y^2}\\right)\n$$\n$$\nG(\\theta_x, \\theta_y) = 1 - 2\\alpha\\left(\\frac{1 - \\cos(\\theta_x)}{h_x^2} + \\frac{1 - \\cos(\\theta_y)}{h_y^2}\\right)\n$$\nFurther simplification using the half-angle trigonometric identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$ gives:\n$$\nG(\\theta_x, \\theta_y) = 1 - 4\\alpha\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right)\n$$\nThe problem requires the smoothing map to be non-amplifying, meaning the magnitude of the amplification factor must not exceed $1$ for any Fourier mode. Since $\\alpha$, $h_x^2$, $h_y^2$, and $\\sin^2(\\cdot)$ are all non-negative, the amplification factor $G$ is always a real number. The condition is therefore $|G(\\theta_x, \\theta_y)| \\leq 1$, which is equivalent to the two inequalities:\n$$\n-1 \\leq G(\\theta_x, \\theta_y) \\leq 1\n$$\nLet us analyze these two inequalities. First, $G \\leq 1$:\n$$\n1 - 4\\alpha\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right) \\leq 1\n$$\n$$\n-4\\alpha\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right) \\leq 0\n$$\nSince the term in the parenthesis is always non-negative, this inequality holds if and only if $\\alpha \\geq 0$. This is physically consistent, as $\\alpha$ represents a form of numerical diffusion coefficient.\n\nSecond, $G \\geq -1$:\n$$\n1 - 4\\alpha\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right) \\geq -1\n$$\n$$\n2 \\geq 4\\alpha\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right)\n$$\n$$\n\\alpha \\leq \\frac{2}{4\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right)} = \\frac{1}{2\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right)}\n$$\nThis inequality must hold for all possible phase angles $\\theta_x, \\theta_y \\in [-\\pi, \\pi]$. To guarantee this, $\\alpha$ must be less than or equal to the minimum possible value of the right-hand side. This minimum occurs when the denominator is maximized. The denominator is maximized when the term $\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}$ is maximized.\n\nThe function $\\sin^2(\\theta/2)$ reaches its maximum value of $1$ when $\\theta/2 = \\pm\\pi/2$, which corresponds to $\\theta = \\pm\\pi$. These are the highest frequency modes (Nyquist frequencies) that can be represented on the grid. The \"worst case\" for stability therefore occurs for the mode $(\\theta_x, \\theta_y) = (\\pm\\pi, \\pm\\pi)$.\n\nThe maximum value of the denominator term is:\n$$\n\\max_{\\theta_x, \\theta_y} \\left[ 2\\left(\\frac{\\sin^2(\\theta_x/2)}{h_x^2} + \\frac{\\sin^2(\\theta_y/2)}{h_y^2}\\right) \\right] = 2\\left(\\frac{1}{h_x^2} + \\frac{1}{h_y^2}\\right)\n$$\nThe stability constraint then becomes:\n$$\n\\alpha \\leq \\frac{1}{2\\left(\\frac{1}{h_x^2} + \\frac{1}{h_y^2}\\right)}\n$$\nThe largest value of $\\alpha$ that satisfies this condition for all modes is:\n$$\n\\alpha_{\\max} = \\frac{1}{2\\left(\\frac{1}{h_x^2} + \\frac{1}{h_y^2}\\right)} = \\frac{1}{2\\left(\\frac{h_y^2+h_x^2}{h_x^2 h_y^2}\\right)} = \\frac{h_x^2 h_y^2}{2(h_x^2 + h_y^2)}\n$$\nThis expression provides the maximum permissible value for the smoothing parameter $\\alpha$ as a function of the grid spacings $h_x$ and $h_y$.\n\nFinally, we address why the advection velocities $a$ and $b$ do not influence the result for $\\alpha_{\\max}$. The stability analysis was performed on the smoothing operator, which maps the residual field $r$ to a smoothed field $r^{\\mathrm{sm}}$. The definition of this operator,\n$r^{\\mathrm{sm}}_{i,j} = r_{i,j} + \\alpha \\Delta_d r_{i,j}$, where $\\Delta_d$ is the discrete Laplacian, involves only the residual field $r$ and its spatial differences. It does not contain the advection velocities $a$ or $b$. The residual $r$ itself is indeed a function of the underlying PDE and the state $u$, and thus depends on $a$ and $b$. However, the question asks for the condition under which the smoothing *step* itself is non-amplifying for *any* given residual field. The stability of this isolated operation depends only on its own structure. A full stability analysis of the complete time-stepping scheme (e.g., Runge-Kutta plus residual smoothing) would, of course, depend on $a$ and $b$ through the eigenvalues of the spatial discretization of the advection operator. But for the smoothing step alone, they are irrelevant.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the maximum residual smoothing parameter alpha_max for given test cases.\n\n    The problem asks for the largest value of the smoothing parameter alpha\n    in the 2D residual smoothing formula:\n    r_sm = r + alpha * Laplacian(r)\n    such that the smoothing step is non-amplifying for all Fourier modes.\n\n    The derivation via Von Neumann stability analysis yields the formula for alpha_max:\n    alpha_max = (h_x^2 * h_y^2) / (2 * (h_x^2 + h_y^2))\n    where h_x and h_y are the grid spacings in the x and y directions.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (h_x, h_y).\n    test_cases = [\n        (1.0, 1.0),  # Case 1\n        (1.0, 0.5),  # Case 2\n        (0.1, 0.1),  # Case 3\n        (0.05, 0.2), # Case 4\n    ]\n\n    results = []\n    for hx, hy in test_cases:\n        # Calculate h_x squared and h_y squared\n        hx2 = hx**2\n        hy2 = hy**2\n\n        # Apply the derived formula for alpha_max\n        numerator = hx2 * hy2\n        denominator = 2 * (hx2 + hy2)\n        \n        alpha_max = numerator / denominator\n        results.append(alpha_max)\n\n    # Format the results into the required string format: \"[val1,val2,val3,val4]\"\n    # The map(str, ...) converts each float in the results list to its string representation.\n    # ','.join(...) then concatenates these strings with a comma in between.\n    output_string = f\"[{','.join(map(str, results))}]\"\n    \n    # Print the final output string. This must be the only output of the program.\n    print(output_string)\n\n# Execute the solver function\nsolve()\n```"
        }
    ]
}