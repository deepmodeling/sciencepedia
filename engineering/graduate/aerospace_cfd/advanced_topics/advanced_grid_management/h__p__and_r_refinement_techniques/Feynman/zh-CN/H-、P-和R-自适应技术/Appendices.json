{
    "hands_on_practices": [
        {
            "introduction": "在深入研究高级的自适应技术之前，我们首先需要理解为什么要进行网格加密：其根本目的是减小数值误差。本练习通过分析一个一维线性平流方程，带您剖析两种最主要的数值误差——色散误差（导致波形相位失真）和耗散误差（导致波形振幅衰减）。通过推导这些误差与网格尺寸 $h$ 和多项式阶数 $p$ 的关系，您将为理解网格加密技术提高解算精度的基本原理打下坚实的基础。",
            "id": "3964562",
            "problem": "考虑周期域上的一维线性平流方程，\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\n$$\n其中 $a>0$ 是一个恒定的平流速度。该方程在空间上使用谱元法在尺寸为 $h$ 的均匀单元网格上进行离散化，其中每个单元内使用 $p$ 次多项式。对于单元间的耦合，使用迎风数值通量。为了与波传播的傅里叶分析联系起来，假设解在单元网格上由单元中心的模态值表示。\n\n将分析限定于分段常数情况 $p=0$（即最低阶谱元或间断伽辽金近似），采用均匀单元尺寸 $h$ 和迎风数值通量。在这种情况下，对于正平流速度 $a$，其半离散格式可以为位于 $x_j = j h$ 位置的单元索引值 $u_j(t)$ 写为\n$$\n\\frac{d u_j}{d t} = -\\frac{a}{h} \\left( u_j - u_{j-1} \\right).\n$$\n通过考虑波数为 $k$ 的离散傅里叶模态 $u_j(t) = \\hat{u}(t) \\exp(i k x_j)$，进行傅里叶或冯·诺依曼分析，并推导半离散色散关系。根据此色散关系，定义：\n- 数值相速度 $c_{\\mathrm{num}}(k)$，通过 $-\\Im(\\lambda(k)) = c_{\\mathrm{num}}(k)\\,k$ 定义，其中 $\\lambda(k)$ 是作用于傅里叶模态的半离散算子的特征值，以及\n- 数值耗散率 $d_{\\mathrm{num}}(k)$，通过 $d_{\\mathrm{num}}(k) = -\\Re(\\lambda(k))$ 定义。\n\n计算这些色散和耗散特性，使其成为单元尺寸 $h$ 和波数 $k$ 的显式函数。然后，通过讨论对于小的无量纲波数 $k h$，主阶色散和耗散行为如何随 $p$ 变化，来解释 $h$-细化（减小 $h$）和 $p$-细化（增加 $p$）之间的权衡。\n\n你的最终答案必须是数值相速度与精确相速度之比 $c_{\\mathrm{num}}(k)/a$ 的一个单一闭式解析表达式，表示为无量纲量 $k h$ 的函数。不需要进行数值计算。最终答案中不要包含单位。在此上下文中，所有角度都是无量纲的。如果在推理过程中进行了任何小 $k h$ 展开，请保持常数为符号形式，除非为清晰起见绝对必要，否则避免数值代入。最终方框内的答案必须是所要求的、具有精确解析形式的比率。",
            "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 第1步：提取给定条件\n-   **控制方程**：一维线性平流方程为 $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$，其中平流速度 $a>0$ 为常数。\n-   **区域**：周期性。\n-   **离散化方法**：在尺寸为 $h$ 的均匀单元网格上采用谱元法，每个单元内使用 $p$ 次多项式。\n-   **单元间通量**：迎风数值通量。\n-   **用于分析的特例**：分段常数近似（$p=0$），单元尺寸 $h$ 均匀。\n-   **半离散格式**：对于位于 $x_j = j h$ 位置的单元索引值 $u_j(t)$，格式为 $\\frac{d u_j}{d t} = -\\frac{a}{h} \\left( u_j - u_{j-1} \\right)$。\n-   **分析方法**：采用波数为 $k$ 的离散傅里叶模态 $u_j(t) = \\hat{u}(t) \\exp(i k x_j)$ 进行傅里叶或冯·诺依曼分析。\n-   **定义**：\n    -   $\\lambda(k)$ 是作用于傅里叶模态的半离散算子的特征值。\n    -   数值相速度 $c_{\\mathrm{num}}(k)$ 由 $-\\Im(\\lambda(k)) = c_{\\mathrm{num}}(k)\\,k$ 定义。\n    -   数值耗散率 $d_{\\mathrm{num}}(k)$ 由 $d_{\\mathrm{num}}(k) = -\\Re(\\lambda(k))$ 定义。\n-   **任务**：\n    1.  计算 $c_{\\mathrm{num}}(k)$ 和 $d_{\\mathrm{num}}(k)$ 作为 $h$ 和 $k$ 的显式函数。\n    2.  通过讨论对于小 $kh$ 时主阶色散和耗散的变化，解释 $h$-细化与 $p$-细化之间的权衡。\n    3.  最终答案必须是比率 $c_{\\mathrm{num}}(k)/a$。\n\n### 第2步：使用提取的给定条件进行验证\n-   **科学依据**：该问题是偏微分方程数值分析中的一个标准、基础练习，特别是分析线性平流方程的一阶迎风格式的性质。它牢固地建立在已有的数学原理之上。\n-   **适定性**：问题陈述清晰，提供了要分析的精确半离散方程和要推导的量的明确定义。存在唯一解。\n-   **客观性**：语言精确、技术性强，没有任何主观性或模糊性。\n-   **完整性**：提供了所有必要的信息（半离散方程、傅里叶模态形式和定义）。\n\n### 第3步：结论与行动\n该问题是有效的，因为它科学合理、适定、客观且自洽。将提供完整解答。\n\n分析从给定的单元平均值 $u_j(t)$ 的半离散方程开始：\n$$\n\\frac{d u_j}{d t} = -\\frac{a}{h} \\left( u_j - u_{j-1} \\right)\n$$\n我们通过代入离散傅里叶模态 $u_j(t) = \\hat{u}(t) \\exp(i k x_j)$（其中 $x_j = j h$）来进行冯·诺依曼稳定性分析。左侧的时间导数变为：\n$$\n\\frac{d}{dt} \\left( \\hat{u}(t) \\exp(i k j h) \\right) = \\frac{d\\hat{u}}{dt} \\exp(i k j h)\n$$\n右侧变为：\n$$\n-\\frac{a}{h} \\left( \\hat{u}(t) \\exp(i k j h) - \\hat{u}(t) \\exp(i k (j-1) h) \\right)\n$$\n将两边相等并除以公因子 $\\exp(i k j h)$，得到关于模态振幅 $\\hat{u}(t)$ 的常微分方程：\n$$\n\\frac{d\\hat{u}}{dt} = -\\frac{a}{h} \\left( \\hat{u}(t) - \\hat{u}(t) \\exp(-i k h) \\right) = \\left[ -\\frac{a}{h} \\left( 1 - \\exp(-i k h) \\right) \\right] \\hat{u}(t)\n$$\n该方程的形式为 $\\frac{d\\hat{u}}{dt} = \\lambda(k) \\hat{u}$。因此，半离散算子的特征值 $\\lambda(k)$ 为：\n$$\n\\lambda(k) = -\\frac{a}{h} \\left( 1 - \\exp(-i k h) \\right)\n$$\n为了找到 $\\lambda(k)$ 的实部和虚部，我们使用欧拉公式 $\\exp(-i\\theta) = \\cos(\\theta) - i\\sin(\\theta)$：\n$$\n\\lambda(k) = -\\frac{a}{h} \\left( 1 - (\\cos(kh) - i\\sin(kh)) \\right) = -\\frac{a}{h} (1 - \\cos(kh)) - i \\frac{a}{h} \\sin(kh)\n$$\n由此，我们确定实部和虚部：\n$$\n\\Re(\\lambda(k)) = -\\frac{a}{h} (1 - \\cos(kh))\n$$\n$$\n\\Im(\\lambda(k)) = -\\frac{a}{h} \\sin(kh)\n$$\n使用问题中提供的定义，我们现在可以计算数值耗散率和相速度。数值耗散率 $d_{\\mathrm{num}}(k)$ 是：\n$$\nd_{\\mathrm{num}}(k) = -\\Re(\\lambda(k)) = - \\left( -\\frac{a}{h} (1 - \\cos(kh)) \\right) = \\frac{a}{h} (1 - \\cos(kh))\n$$\n数值相速度 $c_{\\mathrm{num}}(k)$ 由关系式 $-\\Im(\\lambda(k)) = c_{\\mathrm{num}}(k)\\,k$ 定义。代入 $\\Im(\\lambda(k))$ 的表达式：\n$$\n- \\left( -\\frac{a}{h} \\sin(kh) \\right) = c_{\\mathrm{num}}(k)\\,k\n$$\n$$\n\\frac{a}{h} \\sin(kh) = c_{\\mathrm{num}}(k)\\,k\n$$\n求解 $c_{\\mathrm{num}}(k)$ 得到：\n$$\nc_{\\mathrm{num}}(k) = \\frac{a \\sin(kh)}{kh}\n$$\n对于连续平流方程 $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$，精确相速度是常数 $a$。因此，数值相速度与精确相速度之比为：\n$$\n\\frac{c_{\\mathrm{num}}(k)}{a} = \\frac{\\frac{a \\sin(kh)}{kh}}{a} = \\frac{\\sin(kh)}{kh}\n$$\n这就提供了所需的解析表达式。\n\n为了解释h-p权衡，我们分析了在无量纲波数 $kh \\ll 1$ 较小的情况下，所推导量的行为。我们使用 $\\sin(x)$ 和 $\\cos(x)$ 的泰勒级数展开：\n对于相速度比：\n$$\n\\frac{c_{\\mathrm{num}}(k)}{a} = \\frac{kh - \\frac{(kh)^3}{3!} + O((kh)^5)}{kh} = 1 - \\frac{(kh)^2}{6} + O((kh)^4)\n$$\n数值色散误差 $c_{\\mathrm{num}}(k) - a$ 近似为 $-a \\frac{(kh)^2}{6}$。该误差是 $O(h^2)$ 阶的，并导致波的传播速度慢于精确速度，这种现象被称为相位滞后。\n对于耗散率：\n$$\nd_{\\mathrm{num}}(k) = \\frac{a}{h} \\left( 1 - \\left[1 - \\frac{(kh)^2}{2!} + O((kh)^4)\\right] \\right) = \\frac{a}{h} \\left( \\frac{k^2 h^2}{2} - O(k^4 h^4) \\right) = \\frac{ak^2h}{2} + O(h^3)\n$$\n数值耗散是 $O(h)$ 阶的。由于该格式的主导误差项是 $O(h)$ 阶的耗散项，因此 $p=0$ 格式（一阶迎风）是一阶精度的。\n\n通过从这个 $p=0$ 的情况进行推广，可以解释 $h$-细化和 $p$-细化之间的权衡。\n1.  **精度阶数**：对于一个 $p$ 阶多项式的通用间断伽辽金或谱元格式，其总精度阶数为 $p+1$。对于所分析的情况 $p=0$，格式是一阶精度的，这与理论一致。将 $p$ 增加到 $p=1$（线性元）会得到一个二阶格式，依此类推。\n2.  **收敛性**：\n    -   **$h$-细化**：对于固定的多项式阶数 $p$，减小单元尺寸 $h$ 会减小数值误差。误差以代数方式收敛到零，与 $h^{p+1}$ 成正比。这是一种可靠但可能较慢的提高精度的方法。\n    -   **$p$-细化**：对于固定的网格（固定的 $h$），增加多项式阶数 $p$ 也会减小误差。对于具有光滑解的问题，这种收敛是指数级的，意味着误差的减小速度远快于 $h$-细化。这使得 $p$-细化对此类问题非常高效。\n3.  **误差特性**：权衡的一个关键方面是主导误差项的性质，对于基于迎风通量的格式，该性质随 $p$ 的奇偶性而交替变化。\n    -   对于偶数 $p$（例如 $p=0, 2, ...$），主导误差项是耗散性的（对于 $p=0$，与偶数阶导数成正比，如 $\\frac{\\partial^2 u}{\\partial x^2}$）。这些格式在数值上会衰减波，特别是高频波，这会抹平尖锐梯度，但可以防止伪振荡。\n    -   对于奇数 $p$（例如 $p=1, 3, ...$），主导误差项是色散性的（对于 $p=1$，与奇数阶导数成正比，如 $\\frac{\\partial^3 u}{\\partial x^3}$）。这些格式在主导阶上不增加数值阻尼，能更好地保持波幅，但它们可能在不连续点或尖锐梯度附近引入非物理振荡（吉布斯现象）。\n\n总而言之，$h$-细化提供可预测的代数误差减小，而 $p$-细化为光滑解提供更快的指数收敛。两者之间的选择涉及收敛速度和数值误差特性（耗散性与色散性）之间的权衡，而误差特性随多项式阶数 $p$ 的变化而改变。",
            "answer": "$$\n\\boxed{\\frac{\\sin(kh)}{kh}}\n$$"
        },
        {
            "introduction": "在认识到网格加密对提高精度的益处后，我们必须面对其带来的实际代价，尤其是在计算成本方面。本练习聚焦于显式时间推进格式的稳定性，这在可压缩流的高阶方法中十分常见。通过推导和应用 Courant–Friedrichs–Lewy (CFL) 条件，您将清晰地看到 $h$-加密（减小 $h$）和 $p$-加密（增加 $p$）如何共同对稳定时间步长施加严格的限制，从而深刻理解高精度计算背后所付出的巨大计算努力。",
            "id": "3964587",
            "problem": "考虑控制气体中质量、动量和能量守恒的无粘可压缩欧拉方程，其守恒形式写作 $\\partial_{t} \\mathbf{U} + \\nabla \\cdot \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$，其中 $\\mathbf{U}$ 表示守恒变量向量，$\\mathbf{F}(\\mathbf{U})$ 表示相应的通量张量。设方程在空间上使用协调网格的每个单元 $K$ 上的 $p$ 次高阶不连续多项式逼近进行离散，并假设采用显式Runge–Kutta时间积分格式，其稳定性极限由一个正常数 $C$ 表征。对每个单元 $K$，定义特征网格尺寸 $h_{K}$，并设双曲系统的最大特征波速用 $\\lambda_{\\max,K}$ 表示，其定义为通量雅可比矩阵沿单位法线投影的特征值绝对值在所有方向上的最大值。显式时间推进格式的稳定性的Courant–Friedrichs–Lewy (CFL) 条件要求离散数值依赖域必须包含偏微分方程的依赖域。\n\n任务1：从欧拉方程的线性化双曲特性出发，利用单元 $K$ 上 $p$ 次多项式的标准逆估计，并结合显式时间积分器的稳定域限制半离散空间算子谱半径的要求，推导出一个形式为 $\\Delta t \\le C \\min_{K} \\frac{h_{K}}{(2p+1)\\lambda_{\\max,K}}$ 的时间步长充分稳定性约束。请清楚地陈述导致因子 $(2p+1)$ 和项 $\\lambda_{\\max,K}$ 出现的假设。\n\n任务2：考虑一个二维均匀空气流，其速度大小为 $|u| = 200$ m/s，温度为 $T = 300$ K。假设为量热完全气体，比热比 $\\gamma = 1.4$，特定气体常数 $R = 287$ J/(kg·K)，因此声速为 $c = \\sqrt{\\gamma R T}$。对于可压缩欧拉系统，取每个单元上的最大特征速度为 $\\lambda_{\\max,K} = |u| + c$。在一个三角网格上，三个代表性单元的尺寸分别为 $h_{K_{1}} = 0.010$ m、$h_{K_{2}} = 0.008$ m 和 $h_{K_{3}} = 0.012$ m。设多项式次数为 $p = 3$，显式Runge–Kutta稳定性常数为 $C = 0.5$。计算推导出的约束所蕴含的最大全局稳定时间步长 $\\Delta t_{\\max}$。将最终时间步长以微秒表示，并四舍五入至四位有效数字。\n\n任务3：基于推导出的约束，简要解释在可压缩计算流体动力学(CFD)中，$h$-细化（减小 $h_{K}$）和 $p$-细化（增加 $p$）如何共同限制允许的时间步长，并定性评论 $r$-细化（网格移动）如何通过改变局部 $h_{K}$ 和方向波速来间接影响该界限。",
            "solution": "用户提供了一个关于计算流体动力学(CFD)中数值稳定性的多部分问题。必须首先验证该问题陈述的科学合理性、自洽性和适定性。\n\n### 第一步：提取已知条件\n- **控制方程**：无粘可压缩欧拉方程，守恒形式为 $\\partial_{t} \\mathbf{U} + \\nabla \\cdot \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$。\n- **守恒变量向量**：$\\mathbf{U}$。\n- **通量张量**：$\\mathbf{F}(\\mathbf{U})$。\n- **空间离散化**：在协调网格的每个单元 $K$ 上采用 $p$ 次高阶不连续多项式逼近。\n- **时间积分**：显式Runge–Kutta格式，具有一个正常数稳定性常数 $C$。\n- **单元特征尺寸**：每个单元 $K$ 为 $h_{K}$。\n- **最大特征波速**：每个单元 $K$ 为 $\\lambda_{\\max,K}$。\n- **CFL条件原理**：数值依赖域必须包含物理依赖域。\n- **任务1目标**：推导稳定性约束 $\\Delta t \\le C \\min_{K} \\frac{h_{K}}{(2p+1)\\lambda_{\\max,K}}$，并陈述导致因子 $(2p+1)$ 和项 $\\lambda_{\\max,K}$ 出现的假设。\n- **任务2数据**：\n    - 流动：二维均匀流。\n    - 速度大小：$|u| = 200 \\text{ m/s}$。\n    - 温度：$T = 300 \\text{ K}$。\n    - 气体性质：量热完全气体，$\\gamma = 1.4$ 且 $R = 287 \\text{ J/(kg·K)}$。\n    - 声速定义：$c = \\sqrt{\\gamma R T}$。\n    - 此任务的最大波速定义：$\\lambda_{\\max,K} = |u| + c$。\n    - 网格单元尺寸：$h_{K_{1}} = 0.010 \\text{ m}$，$h_{K_{2}} = 0.008 \\text{ m}$，$h_{K_{3}} = 0.012 \\text{ m}$。\n    - 多项式次数：$p = 3$。\n    - 稳定性常数：$C = 0.5$。\n    - 任务2目标：计算最大全局稳定时间步长 $\\Delta t_{\\max}$，以微秒为单位，并四舍五入至四位有效数字。\n- **任务3目标**：解释 $h$-、$p$- 和 $r$-细化对推导出的时间步长约束的影响。\n\n### 第二步：使用提取的已知条件进行验证\n- **科学基础**：该问题根植于双曲守恒律数值方法的标准理论，特别是不连续伽辽金(DG)方法应用于欧拉方程。CFL稳定性、特征波速和细化技术等概念是该领域的基础。所提供的物理常数和参数对于接近标准条件下的空气是符合实际的。待推导的稳定性约束是DG方法中一个被广泛引用的结果。\n- **适定性**：所有三个任务都定义明确。任务1要求基于数值分析的标准原理进行推导。任务2为直接计算提供了一套完整的数值。任务3要求基于任务1的结果进行概念性解释。问题结构从理论到应用再到解释，条理清晰。\n- **客观性**：问题陈述使用精确的技术语言，没有歧义或主观论断。\n- **完整性与一致性**：问题是自洽的。它提供了执行所需任务的所有必要方程、常数和定义。没有内部矛盾。\n\n### 第三步：结论与行动\n该问题是有效的。它科学合理、适定且完整。将提供完整解答。\n\n### 解答\n\n此问题分三部分解决：一个稳定性约束的理论推导，该约束的一个数值应用，以及关于网格细化策略的概念性讨论。\n\n**任务1：稳定性约束的推导**\n\n我们从控制偏微分方程的半离散形式开始，它可以写成关于时间的常微分方程(ODEs)组：\n$$\n\\frac{d\\mathbf{U}_h}{dt} = \\mathcal{L}_h(\\mathbf{U}_h)\n$$\n其中 $\\mathbf{U}_h$ 是网格上多项式解的所有离散自由度向量，$\\mathcal{L}_h$ 是代表 $-\\nabla \\cdot \\mathbf{F}$ 的不连续伽辽金(DG)逼近的半离散空间算子。\n\n对于一个显式时间积分格式，如Runge-Kutta方法，稳定性要求时间步长 $\\Delta t$ 乘以空间算子的谱半径 $\\rho(\\mathcal{L}_h)$ 位于ODE求解器稳定域之内。对于双曲问题，$\\mathcal{L}_h$ 的特征值主要为虚数。稳定性条件可以表示为：\n$$\n\\Delta t \\cdot \\rho(\\mathcal{L}_h) \\le C\n$$\n其中 $C$ 是一个取决于所选显式Runge-Kutta格式稳定域沿虚轴范围的常数。整理此式可得对时间步长的约束：\n$$\n\\Delta t \\le \\frac{C}{\\rho(\\mathcal{L}_h)}\n$$\n全局空间算子 $\\mathcal{L}_h$ 耦合了网格中的所有单元。其谱半径由“最具限制性”的单元决定，即施加最严格约束的单元。因此，我们可以通过局部谱半径的最大值来限制全局谱半径，稳定性约束变为对所有单元 $K$ 取最小值：\n$$\n\\Delta t \\le C \\min_{K} \\frac{1}{\\rho(\\mathcal{L}_{h,K})}\n$$\n其中 $\\rho(\\mathcal{L}_{h,K})$ 是与单元 $K$ 相关联的算子的谱半径。\n\n下一步是估计 $\\rho(\\mathcal{L}_{h,K})$。对于非线性欧拉方程，我们进行局域线性化。在每个单元 $K$ 上，系统的行为由通量雅可比矩阵的特征值决定。最大特征波速 $\\lambda_{\\max,K}$ 代表信息在局部传播的最快速度。单元上空间算子的谱半径与此波速成正比，与单元的特征尺寸 $h_K$ 成反比。逼近的多项式次数 $p$ 也进入此关系。\n\n一个关键步骤是确定对 $p$ 的依赖关系。空间算子涉及多项式基函数的导数。单元 $K$ 上 $p$ 次多项式的逆估计将多项式导数的范数与多项式本身的范数联系起来，并引入了对 $p$ 和 $h_K$ 的依赖。一个典型的逆不等式表明，对于多项式 $v_p \\in P^p(K)$，有 $\\|\\nabla v_p\\|_{L^2(K)} \\le C_{inv} h_K^{-1} \\|v_p\\|_{L^2(K)}$，其中常数 $C_{inv}$ 与 $p^2$ 成比例。这表明谱半径应按 $\\rho(\\mathcal{L}_{h,K}) \\propto \\frac{\\lambda_{\\max,K} p^2}{h_K}$ 的比例变化。\n\n然而，问题要求推导一个带有 $(2p+1)$ 因子的形式。这个特定因子源于对一维线性平流方程 $u_t + \\lambda u_x = 0$ 在单元界面处使用迎风数值通量时不连续伽辽金(DG)算子的更详细谱分析。该分析通常通过傅里叶方法或使用Legendre多项式基检查算子的显式矩阵形式来进行，它为谱半径得出了以下精确结果：\n$$\n\\rho(\\mathcal{L}_{h,K}) = \\frac{(2p+1)\\lambda}{h_K}\n$$\n导致这种形式的主要假设是：\n1.  **线性化**：非线性系统被局部分析为线性平流问题，其中 $\\lambda$ 被最大特征波速 $\\lambda_{\\max,K}$ 替代，$\\lambda_{\\max,K}$ 是通量雅可比矩阵特征值绝对值在所有空间方向上的最大值。\n2.  **迎风通量**：使用迎风数值通量来计算单元界面处的通量。不同的通量格式（例如，中心通量）会导致不同的谱半径，从而产生不同的稳定性约束。\n3.  **一维模型**：该分析基于一维模型问题，其结果通过使用整个网格上的最小单元尺寸 $h_K$ 和最大波速 $\\lambda_{\\max,K}$ 推广到多维，这代表了最坏情况。\n\n将谱半径的这个表达式代入稳定性条件，得到所需结果：\n$$\n\\Delta t \\le C \\min_{K} \\frac{h_{K}}{(2p+1)\\lambda_{\\max,K}}\n$$\n这是一个充分稳定性条件。\n\n**任务2：最大稳定时间步长的计算**\n\n首先，我们计算气体的物理性质。声速 $c$ 由下式给出：\n$$\nc = \\sqrt{\\gamma R T}\n$$\n代入给定值：\n$$\nc = \\sqrt{1.4 \\times 287 \\frac{\\text{J}}{\\text{kg·K}} \\times 300 \\text{ K}} = \\sqrt{120540} \\frac{\\text{m}}{\\text{s}} \\approx 347.1887 \\frac{\\text{m}}{\\text{s}}\n$$\n接下来，我们计算最大特征波速，对于本问题，假定其在整个域上是恒定的：\n$$\n\\lambda_{\\max,K} = \\lambda_{\\max} = |u| + c = 200 \\frac{\\text{m}}{\\text{s}} + 347.1887 \\frac{\\text{m}}{\\text{s}} = 547.1887 \\frac{\\text{m}}{\\text{s}}\n$$\n稳定性约束为 $\\Delta t \\le C \\min_{K} \\frac{h_{K}}{(2p+1)\\lambda_{\\max}}$。当等式对最具限制性的单元成立时，达到最大全局稳定时间步长 $\\Delta t_{\\max}$。这对应于 $h_K$ 的最小值。\n$$\nh_{\\min} = \\min(h_{K_{1}}, h_{K_{2}}, h_{K_{3}}) = \\min(0.010 \\text{ m}, 0.008 \\text{ m}, 0.012 \\text{ m}) = 0.008 \\text{ m}\n$$\n多项式次数为 $p=3$，所以因子 $(2p+1)$ 是：\n$$\n2p+1 = 2(3)+1 = 7\n$$\n稳定性常数给定为 $C=0.5$。我们现在可以计算 $\\Delta t_{\\max}$：\n$$\n\\Delta t_{\\max} = C \\frac{h_{\\min}}{(2p+1)\\lambda_{\\max}} = 0.5 \\times \\frac{0.008 \\text{ m}}{7 \\times 547.1887 \\frac{\\text{m}}{\\text{s}}}\n$$\n$$\n\\Delta t_{\\max} = \\frac{0.004}{3830.3209} \\text{ s} \\approx 1.044298 \\times 10^{-6} \\text{ s}\n$$\n问题要求答案以微秒($\\mu$s)为单位，其中 $1 \\text{ s} = 10^6 \\mu\\text{s}$。\n$$\n\\Delta t_{\\max} \\approx 1.044298 \\mu\\text{s}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n\\Delta t_{\\max} = 1.044 \\mu\\text{s}\n$$\n\n**任务3：细化策略的解释**\n\n推导出的稳定性约束 $\\Delta t \\le C \\min_{K} \\frac{h_{K}}{(2p+1)\\lambda_{\\max,K}}$ 清楚地显示了不同的网格细化策略如何影响显式方法允许的时间步长。\n\n**$h$-细化**：该策略涉及减小单元尺寸 $h_K$ 以增加空间分辨率，特别是在解梯度较大的区域。根据公式，最大允许时间步长 $\\Delta t$ 与 $h_K$ 成正比。因此，减小 $h_K$（即细化网格）直接导致允许的 $\\Delta t$ 变小。这种线性依赖关系意味着，将每个方向的网格分辨率加倍（将 $h_K$ 减半）需要将时间步长减半以维持稳定性，这显著增加了模拟给定物理时间所需的总时间步数。\n\n**$p$-细化**：该策略涉及在单元内增加多项式次数 $p$ 以实现更高阶的精度。公式表明 $\\Delta t$ 与因子 $(2p+1)$ 成反比。随着 $p$ 的增加，$(2p+1)$ 增加，导致允许的 $\\Delta t$ 减小。虽然不像基本逆估计所建议的 $p^2$ 缩放那样严重，但这仍然施加了显著的惩罚。例如，从 $p=1$ 变为 $p=3$ 会使时间步长减少一个因子 $(2 \\cdot 1+1)/(2 \\cdot 3+1) = 3/7$。因此，通过 $p$-细化实现更高的精度也以减小稳定时间步长为代价。$h$-细化和 $p$-细化共同严重地约束了 $\\Delta t$，使得显式格式对于高保真度模拟在计算上非常昂贵。\n\n**$r$-细化**：该策略涉及重新定位网格顶点（网格移动），而不改变单元数量或其连接性。它对时间步长的影响是间接但显著的，通过项 $\\min_{K} \\frac{h_{K}}{\\lambda_{\\max,K}}$ 起作用。一个有效的 $r$-细化算法会将节点移动到需要更高分辨率的区域。这可能意味着在某些区域（例如，激波或边界层附近）减小 $h_K$，这往往会降低全局的 $\\Delta t$。然而，一个复杂的 $r$-细化策略也可以优化单元形状和大小。例如，它可能旨在使整个网格上的局部误差指标均衡。由于时间步长约束通常与局部误差有关，因此可以设计这样的策略，使量 $\\frac{h_{K}}{(2p+1)\\lambda_{\\max,K}}$ 在所有单元上更加均匀。通过这样做，与具有相似单元数的固定网格相比，它提高了该项的最小值，从而在给定整体精度下最大化全局稳定时间步长 $\\Delta t$。此外，通过拉伸单元以与各向异性流动特征对齐，$r$-细化可以改变局部特征长度尺度 $h_K$ 及其与构成 $\\lambda_{\\max,K}$ 的方向波速的关系，从而进一步影响稳定性界限。",
            "answer": "$$\\boxed{1.044}$$"
        },
        {
            "introduction": "同时掌握了 $h$-加密和 $p$-加密的优势（精度）与代价（成本）之后，最终的挑战在于如何在一个给定的计算预算下，明智地组合使用这些工具。这项综合性练习将引导您构建一个决策模型，用于量化 $h$-加密与 $p$-加密的边际效益，并求解最优的计算资源分配方案 $(N^\\star, p^\\star)$。通过这个实践，您将学会如何将理论知识转化为解决实际工程问题的定量策略，从而在复杂的 $hp$-自适应模拟中做出最佳权衡。",
            "id": "3964543",
            "problem": "您的任务是为应用于二维跨音速翼型的计算流体动力学（CFD）中的网格加密实现一个基于原理的决策模型。从基本近似理论出发，将解的某个泛函 $Q$（例如，升力系数 $C_L$ 和阻力系数 $C_D$）中的离散误差视为由特征网格尺寸 $h$ 和高阶有限元或间断伽辽金（DG）离散化的多项式阶数 $p$ 控制。您将比较在相等增量计算成本下，增加 $p$ 与减小 $h$ 的边际效益，然后计算在固定计算预算下 $h$ 和 $p$ 的最优联合分配。\n\n使用以下基础且经过充分检验的公式和事实：\n- 有限光滑性函数的近似：如果真实解局部属于 $s$ 阶索伯列夫空间（受激波引起的非光滑性限制），那么对于相对于诱导范数连续的泛函 $Q$，$p$ 阶高阶多项式近似实现的误差会以 $h^{\\min(p+1,s)}$ 的形式代数衰减。这捕捉了在存在非光滑特征时 $p$ 加密的饱和现象。\n- 对于一个覆盖固定区域面积 $A$ 的包含 $N$ 个单元的二维网格，通过 $h = \\sqrt{A/N}$ 定义特征尺寸 $h$。\n- 计算成本模型：主阶成本与自由度数量和局部算子复杂度成比例；使用 $C_{\\text{comp}} = c \\, N \\, (p+1)^{\\gamma}$，其中 $c$ 是一个正常数，$\\gamma > 2$ 表示每个单元与多项式阶数相关的工作量。\n\n将升力和阻力预测的组合误差建模为加权和\n$$\nJ(N,p; M, \\rho) = w_L \\, \\varepsilon_L(N,p; M, \\rho) + w_D \\, \\varepsilon_D(N,p; M, \\rho),\n$$\n其中 $M$ 是马赫数，$\\rho \\in [0,1]$ 是一个标量 r-加密质量指标（$\\rho=0$ 意味着没有激波对齐，$\\rho=1$ 意味着近乎完美的激波对齐）。对于每个泛函 $Q \\in \\{L,D\\}$，设置\n$$\n\\varepsilon_Q(N,p; M, \\rho) = K_Q \\, h^{\\min(p+1, s_Q(M,\\rho))}, \\quad h = \\sqrt{\\frac{A}{N}},\n$$\n其中 $K_Q > 0$ 且\n$$\ns_Q(M,\\rho) = s_{0,Q} - a_Q \\, (M - 0.8) + b_Q \\, \\rho,\n$$\n该值被限制在区间 $[0.5, 3.0]$ 内，以反映跨音速流中合理的正则性界限。这捕捉了正则性随 $M$ 增加而退化，以及通过对齐（$\\rho$）进行 r-加密所带来的改善。\n\n定义在当前 $(N,p)$ 状态下将 $p$ 增加 1 的边际效益为减少量 $\\Delta J_p = J(N,p) - J(N,p+1)$，其增量成本为\n$$\n\\Delta C_p = c \\, N \\left[ (p+2)^{\\gamma} - (p+1)^{\\gamma} \\right].\n$$\n定义通过将 $N$ 增加到 $N'$ 来减小 $h$ 的边际效益，使得增量成本等于 $\\Delta C_p$，即\n$$\nc \\, N' \\, (p+1)^{\\gamma} - c \\, N \\, (p+1)^{\\gamma} = \\Delta C_p,\n$$\n然后 $\\Delta J_h = J(N,p) - J(N',p)$。使用 $N' = \\left\\lceil N \\, \\frac{(p+2)^{\\gamma}}{(p+1)^{\\gamma}} \\right\\rceil$ 以确保增量成本不被低估。通过比率报告成本归一化的边际效益比较\n$$\nR = \\frac{\\Delta J_p}{\\Delta J_h},\n$$\n该比率是无量纲的。如果 $\\Delta J_h = 0$，定义 $R = +\\infty$；如果 $\\Delta J_p = 0$ 且 $\\Delta J_h = 0$，定义 $R = 0$。\n\n在固定计算预算 $B$ 下，确定最优分配 $(N^\\star, p^\\star)$，求解\n$$\n\\min_{N \\in \\mathbb{Z}_{\\ge 1}, \\, p \\in \\mathbb{Z}_{\\ge 0}} \\; J(N,p; M, \\rho) \\quad \\text{subject to} \\quad c \\, N \\, (p+1)^{\\gamma} \\le B.\n$$\n\n本问题中的所有量都是无量纲的；将数值报告为小数值。不涉及角度（如果有的话）。您的程序必须为每个测试用例计算：\n- 在提供的基准 $(N_0,p_0)$ 下的边际效益比 $R$。\n- 在预算 $B$ 下的最优 $(N^\\star, p^\\star)$ 和相应的最小组合误差 $J^\\star = J(N^\\star, p^\\star)$。\n\n数值和格式要求：\n- 对于每个测试用例，按顺序输出四个值：$R$, $N^\\star$, $p^\\star$, $J^\\star$。\n- 将 $R$ 和 $J^\\star$ 输出为保留六位小数的小数。\n- 将 $N^\\star$ 和 $p^\\star$ 输出为整数。\n- 将所有测试用例的结果聚合到一行中，形式为用方括号括起来的逗号分隔列表，顺序与下面提供的测试用例序列一致，即 $[R_1,N^\\star_1,p^\\star_1,J^\\star_1,R_2,N^\\star_2,p^\\star_2,J^\\star_2,\\dots]$。\n\n使用以下包含科学上合理参数的测试套件：\n- 用例 1 (理想情况，无 r-加密): $A = 1.0$, $M = 0.85$, $\\rho = 0.0$, $B = 5000$, $c = 10.0$, $\\gamma = 2.6$, $K_L = 0.04$, $K_D = 0.08$, $w_L = 0.6$, $w_D = 0.4$, $s_{0,L} = 1.6$, $s_{0,D} = 1.2$, $a_L = 0.8$, $a_D = 1.2$, $b_L = 0.6$, $b_D = 0.5$, 基准 $(N_0,p_0) = (200,2)$。\n- 用例 2 (部分 r-加密，更高 $M$ 值): $A = 1.0$, $M = 0.90$, $\\rho = 0.5$, $B = 12000$, $c = 10.0$, $\\gamma = 2.6$, $K_L = 0.04$, $K_D = 0.08$, $w_L = 0.5$, $w_D = 0.5$, $s_{0,L} = 1.6$, $s_{0,D} = 1.2$, $a_L = 0.8$, $a_D = 1.2$, $b_L = 0.6$, $b_D = 0.5$, 基准 $(N_0,p_0) = (150,3)$。\n- 用例 3 (近乎完全 r-加密，更高预算): $A = 1.0$, $M = 0.92$, $\\rho = 1.0$, $B = 18000$, $c = 10.0$, $\\gamma = 2.6$, $K_L = 0.04$, $K_D = 0.08$, $w_L = 0.5$, $w_D = 0.5$, $s_{0,L} = 1.6$, $s_{0,D} = 1.2$, $a_L = 0.8$, $a_D = 1.2$, $b_L = 0.6$, $b_D = 0.5$, 基准 $(N_0,p_0) = (100,4)$。\n- 用例 4 (边界情况，小预算): $A = 1.0$, $M = 0.88$, $\\rho = 0.0$, $B = 1200$, $c = 10.0$, $\\gamma = 2.6$, $K_L = 0.04$, $K_D = 0.08$, $w_L = 0.7$, $w_D = 0.3$, $s_{0,L} = 1.6$, $s_{0,D} = 1.2$, $a_L = 0.8$, $a_D = 1.2$, $b_L = 0.6$, $b_D = 0.5$, 基准 $(N_0,p_0) = (50,1)$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。",
            "solution": "该问题要求为计算流体动力学中的计算网格加密开发一个决策模型，比较增加多项式阶数（$p$-加密）与减小网格尺寸（$h$-加密）的效益。这涉及两个不同的任务：首先，在给定状态下计算一个成本归一化的边际效益比 $R$；其次，在固定的计算预算下，找到使离散误差泛函最小化的网格尺寸和多项式阶数的最优组合 $(N^\\star, p^\\star)$。\n\n该分析基于高阶数值方法的近似理论中的既有模型。我们首先将模型的各个组成部分形式化。\n\n**模型构建**\n\n总误差 $J$ 是升力（$L$）和阻力（$D$）泛函误差的加权和：\n$$\nJ(N,p; M, \\rho) = w_L \\, \\varepsilon_L(N,p; M, \\rho) + w_D \\, \\varepsilon_D(N,p; M, \\rho)\n$$\n对于泛函 $Q \\in \\{L,D\\}$，每个单独的误差分量 $\\varepsilon_Q$ 由下式给出：\n$$\n\\varepsilon_Q(N,p; M, \\rho) = K_Q \\, h^{\\min(p+1, s_Q(M,\\rho))}\n$$\n这里，$h = \\sqrt{A/N}$ 是在面积为 $A$ 的域上具有 $N$ 个单元的网格的特征网格尺寸。参数 $s_Q$ 代表解的索伯列夫正则性，它限制了收敛速度。它被建模为依赖于马赫数 $M$ 和一个 r-加密质量指标 $\\rho$：\n$$\ns_Q(M,\\rho) = s_{0,Q} - a_Q \\, (M - 0.8) + b_Q \\, \\rho\n$$\n该值被限制在区间 $[0.5, 3.0]$ 内，以保持在物理和理论上合理的范围内。项 $\\min(p+1, s_Q)$ 正确地捕捉了饱和现象：当多项式阶数 $p$ 足够高以至于 $p+1 > s_Q$ 时，收敛速度将受限于解的光滑度 $s_Q$，而不是多项式的近似能力。\n\n计算成本模型为：\n$$\nC_{\\text{comp}}(N,p) = c \\, N \\, (p+1)^{\\gamma}\n$$\n\n有了这些定义，我们可以着手处理两个主要任务。\n\n**第 1 部分：边际效益比 (R)**\n\n比率 $R$ 比较了从基准状态 $(N_0, p_0)$ 开始，$p$-加密相对于等成本的 $h$-加密的边际效益。\n\n1.  **计算解的正则性**：对于给定的测试用例，其参数为 $M$ 和 $\\rho$，我们首先使用提供的公式计算正则性参数 $s_L$ 和 $s_D$，并应用指定的区间限制。\n    $$\n    s_Q \\leftarrow \\text{clamp}(s_{0,Q} - a_Q(M-0.8) + b_Q\\rho, [0.5, 3.0]) \\quad \\text{for } Q \\in \\{L, D\\}\n    $$\n\n2.  **计算 p-加密的边际效益 ($\\Delta J_p$)**：这是在保持单元数 $N_0$ 不变的情况下，将多项式阶数从 $p_0$ 增加到 $p_0+1$ 所实现的误差减少量。\n    $$\n    \\Delta J_p = J(N_0,p_0) - J(N_0,p_0+1)\n    $$\n    此计算涉及在 $(N_0, p_0)$ 和 $(N_0, p_0+1)$ 处评估误差泛函 $J$。\n\n3.  **计算 h-加密的边际效益 ($\\Delta J_h$)**：这个计算更为复杂。首先，我们确定 $p$-加密步骤的增量成本：\n    $$\n    \\Delta C_p = C_{\\text{comp}}(N_0, p_0+1) - C_{\\text{comp}}(N_0, p_0) = c \\, N_0 \\left[ (p_0+2)^{\\gamma} - (p_0+1)^{\\gamma} \\right]\n    $$\n    接下来，我们找到增加后的单元数 $N'$，如果我们在原始多项式阶数 $p_0$ 下加密网格，这个增加的单元数将产生相同的成本增量：\n    $$\n    C_{\\text{comp}}(N', p_0) - C_{\\text{comp}}(N_0, p_0) = c \\, (N' - N_0) (p_0+1)^{\\gamma} \\approx \\Delta C_p\n    $$\n    求解 $N'$，并按规定使用向上取整函数以确保成本不被低估，我们得到：\n    $$\n    N' = \\left\\lceil N_0 \\frac{(p_0+2)^{\\gamma}}{(p_0+1)^{\\gamma}} \\right\\rceil\n    $$\n    这种 $h$-加密的边际效益就是误差的减少量：\n    $$\n    \\Delta J_h = J(N_0,p_0) - J(N',p_0)\n    $$\n\n4.  **计算比率 $R$**：该比率定义为：\n    $$\n    R = \\frac{\\Delta J_p}{\\Delta J_h}\n    $$\n    问题为边界情况指定了规则：如果 $\\Delta J_h = 0$（且 $\\Delta J_p \\neq 0$），则 $R = +\\infty$；如果 $\\Delta J_p = 0$ 且 $\\Delta J_h = 0$，则 $R = 0$。\n\n**第 2 部分：最优分配 ($N^\\star, p^\\star$)**\n\n第二个任务是解决带约束的离散优化问题：\n$$\n\\min_{N \\in \\mathbb{Z}_{\\ge 1}, \\, p \\in \\mathbb{Z}_{\\ge 0}} \\; J(N,p) \\quad \\text{subject to} \\quad c \\, N \\, (p+1)^{\\gamma} \\le B\n$$\n对 $(N, p)$ 的二维空间进行暴力搜索的计算成本可能很高。然而，我们可以通过分析目标函数 $J(N,p)$ 的结构来简化问题。对于任何固定的多项式阶数 $p$，误差泛函 $J(N,p)$ 是关于单元数量 $N$ 的单调递减函数。这是因为 $h = \\sqrt{A/N}$，所以增加 $N$ 会减小 $h$，进而减小误差项 $\\varepsilon_Q$（因为指数 $\\min(p+1, s_Q)$ 总是正的）。\n\n这一关键观察意味着，对于给定的 $p$，要最小化误差 $J$，我们应始终使用计算预算 $B$ 所允许的最大单元数 $N$。\n从预算约束中，我们可以为给定的 $p$ 找到这个最大的 $N$：\n$$\nN \\le \\frac{B}{c \\, (p+1)^{\\gamma}}\n$$\n由于 $N$ 必须是整数，对于固定的 $p$，最优的 $N$ 是：\n$$\nN_{opt}(p) = \\left\\lfloor \\frac{B}{c \\, (p+1)^{\\gamma}} \\right\\rfloor\n$$\n这一见解将二维搜索问题简化为关于多项式阶数 $p$ 的一维搜索。算法如下：\n\n1.  将最小误差 $J^\\star$ 初始化为一个非常大的值，并将 $N^\\star$ 和 $p^\\star$ 初始化为哨兵值。\n2.  遍历多项式阶数 $p = 0, 1, 2, \\dots$。\n3.  对于每个 $p$，计算最大允许的单元数 $N_p = \\lfloor B / (c(p+1)^\\gamma) \\rfloor$。\n4.  如果 $N_p  1$，意味着在此阶数 $p$ 下单个单元的成本就超过了预算。任何更高的 $p$ 也将无效，因此我们可以终止搜索。\n5.  如果 $N_p \\ge 1$，计算误差 $J_{current} = J(N_p, p)$。\n6.  如果 $J_{current}  J^\\star$，更新最优解：$J^\\star = J_{current}$，$N^\\star = N_p$，$p^\\star = p$。\n7.  在遍历所有可行的 $p$ 值之后，存储的 $(N^\\star, p^\\star, J^\\star)$ 将是全局最优解。\n\n这个基于原理的算法保证了在给定模型和约束下能高效地找到全局最小值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the mesh refinement problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: happy path, no r-refinement\n        {\n            'params': {'A': 1.0, 'M': 0.85, 'rho': 0.0, 'B': 5000, 'c': 10.0, 'gamma': 2.6, \n                       'K_L': 0.04, 'K_D': 0.08, 'w_L': 0.6, 'w_D': 0.4, \n                       's0_L': 1.6, 's0_D': 1.2, 'a_L': 0.8, 'a_D': 1.2, 'b_L': 0.6, 'b_D': 0.5},\n            'baseline': (200, 2)\n        },\n        # Case 2: partial r-refinement, higher M\n        {\n            'params': {'A': 1.0, 'M': 0.90, 'rho': 0.5, 'B': 12000, 'c': 10.0, 'gamma': 2.6, \n                       'K_L': 0.04, 'K_D': 0.08, 'w_L': 0.5, 'w_D': 0.5, \n                       's0_L': 1.6, 's0_D': 1.2, 'a_L': 0.8, 'a_D': 1.2, 'b_L': 0.6, 'b_D': 0.5},\n            'baseline': (150, 3)\n        },\n        # Case 3: near full r-refinement, higher budget\n        {\n            'params': {'A': 1.0, 'M': 0.92, 'rho': 1.0, 'B': 18000, 'c': 10.0, 'gamma': 2.6, \n                       'K_L': 0.04, 'K_D': 0.08, 'w_L': 0.5, 'w_D': 0.5, \n                       's0_L': 1.6, 's0_D': 1.2, 'a_L': 0.8, 'a_D': 1.2, 'b_L': 0.6, 'b_D': 0.5},\n            'baseline': (100, 4)\n        },\n        # Case 4: edge case, small budget\n        {\n            'params': {'A': 1.0, 'M': 0.88, 'rho': 0.0, 'B': 1200, 'c': 10.0, 'gamma': 2.6, \n                       'K_L': 0.04, 'K_D': 0.08, 'w_L': 0.7, 'w_D': 0.3, \n                       's0_L': 1.6, 's0_D': 1.2, 'a_L': 0.8, 'a_D': 1.2, 'b_L': 0.6, 'b_D': 0.5},\n            'baseline': (50, 1)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        case_results = solve_case(case['params'], case['baseline'])\n        R_formatted = \"{:.6f}\".format(case_results[0])\n        J_star_formatted = \"{:.6f}\".format(case_results[3])\n        results.extend([R_formatted, case_results[1], case_results[2], J_star_formatted])\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_case(params, baseline):\n    \"\"\"\n    Computes the solution for a single test case.\n    \"\"\"\n    A, M, rho, B, c, gamma = params['A'], params['M'], params['rho'], params['B'], params['c'], params['gamma']\n    K_L, K_D, w_L, w_D = params['K_L'], params['K_D'], params['w_L'], params['w_D']\n    s0_L, s0_D, a_L, a_D, b_L, b_D = params['s0_L'], params['s0_D'], params['a_L'], params['a_D'], params['b_L'], params['b_D']\n    N0, p0 = baseline\n\n    # Helper function to calculate s_Q\n    def calculate_s(s0, a, b, M, rho):\n        s_val = s0 - a * (M - 0.8) + b * rho\n        return np.clip(s_val, 0.5, 3.0)\n\n    # Helper function to calculate total error J\n    def calculate_J(N, p, s_L, s_D):\n        if N  1:\n            return float('inf')\n        h = np.sqrt(A / N)\n        eps_L = K_L * np.power(h, min(p + 1, s_L))\n        eps_D = K_D * np.power(h, min(p + 1, s_D))\n        return w_L * eps_L + w_D * eps_D\n\n    # Pre-calculate regularities for the case\n    s_L = calculate_s(s0_L, a_L, b_L, M, rho)\n    s_D = calculate_s(s0_D, a_D, b_D, M, rho)\n    \n    # --- Part 1: Marginal Benefit Ratio R ---\n    J0 = calculate_J(N0, p0, s_L, s_D)\n\n    # p-refinement\n    J_p = calculate_J(N0, p0 + 1, s_L, s_D)\n    delta_Jp = J0 - J_p\n\n    # h-refinement\n    N_prime_float = N0 * np.power((p0 + 2) / (p0 + 1), gamma)\n    N_prime = int(np.ceil(N_prime_float))\n    \n    J_h = calculate_J(N_prime, p0, s_L, s_D)\n    delta_Jh = J0 - J_h\n\n    if delta_Jh == 0.0:\n        if delta_Jp == 0.0:\n            R = 0.0\n        else:\n            R = float('inf')\n    else:\n        R = delta_Jp / delta_Jh\n\n    # --- Part 2: Optimal Allocation ---\n    min_J = float('inf')\n    N_star, p_star = -1, -1\n\n    p = 0\n    while True:\n        # Calculate max N for current p\n        cost_per_element = c * np.power(p + 1, gamma)\n        if cost_per_element > B:\n            break\n        \n        N = int(np.floor(B / cost_per_element))\n        \n        if N  1:\n            break\n\n        current_J = calculate_J(N, p, s_L, s_D)\n        \n        if current_J  min_J:\n            min_J = current_J\n            N_star = N\n            p_star = p\n        \n        p += 1\n        # Add a safety break for very large budgets, though not needed for these cases\n        if p > 100: \n            break\n\n    return R, N_star, p_star, min_J\n\nsolve()\n```"
        }
    ]
}