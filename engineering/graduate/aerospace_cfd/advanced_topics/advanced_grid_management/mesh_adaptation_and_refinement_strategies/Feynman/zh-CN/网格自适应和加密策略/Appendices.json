{
    "hands_on_practices": [
        {
            "introduction": "网格加密的主要目标之一是将离散误差降低到可接受的水平。在进行自适应加密之前，我们必须能够量化这种误差。本练习介绍了一种名为网格收敛指数（Grid Convergence Index, GCI）的标准方法，它允许我们根据一系列网格上的仿真结果，来系统地估计离散误差并验证我们代码的收敛阶 。",
            "id": "3975807",
            "problem": "在计算流体动力学 (CFD) 中，进行了一项可压缩无粘翼型的计算，该计算使用了三个连续加密的结构化网格，其网格间距分别为 $h_1 > h_2 > h_3$，并具有恒定的加密比 $r = h_1/h_2 = h_2/h_3$。对于一个标量关注量 (QoI) $Q$，您分别在这些网格上获得了网格收敛解 $Q_1$、$Q_2$ 和 $Q_3$。假设解处于渐近区，离散误差遵循主阶模型 $Q(h) = Q^{\\ast} + K h^{p} + \\mathcal{O}(h^{p+1})$，其中 $Q^{\\ast}$ 是精确的关注量，$K$ 是一个非零常数，$p$ 是观测到的精度阶。这三套网格序列是单调收敛的。\n\n给定数据 $Q_1 = 0.142$，$Q_2 = 0.138$，$Q_3 = 0.1365$ 和 $r = 2$。仅使用这些数据和渐近误差模型：\n\n1. 从第一性原理出发，推导一个根据三套网格数据和恒定加密比 $r$ 估计观测阶 $p$ 的公式，然后计算其数值。\n2. 使用相同的渐近模型，推导用 $Q_3$、$Q_2$、$r$ 和 $p$ 表示 $Q^{\\ast}$ 的两套网格的理查森外推表达式，并计算外推值 $Q_{\\text{ext}}$。\n3. 概述计算网格对 $(h_3, h_2)$ 的细网格网格收敛指数 ($\\text{GCI}$) 的标准步骤，包括安全因子 $F_s$ 的选择和作用，然后使用 $F_s = 1.25$ 计算 $\\text{GCI}_{32}$ 的数值。将 $\\text{GCI}_{32}$ 表示为无量纲的小数形式。\n\n将 $p$ 的数值和 $\\text{GCI}_{32}$ 的数值均四舍五入到四位有效数字。以 $(p, \\text{GCI}_{32})$ 的顺序提供您的最终答案，包含两个数字。",
            "solution": "对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 计算流体动力学 (CFD) 中的可压缩无粘翼型计算。\n- 三套连续加密的结构化网格，网格间距为 $h_1 > h_2 > h_3$。\n- 恒定的加密比 $r = h_1/h_2 = h_2/h_3$。\n- 标量关注量 (QoI) $Q$ 的网格收敛解：$Q_1$, $Q_2$, 和 $Q_3$。\n- 渐近误差模型：$Q(h) = Q^{\\ast} + K h^{p} + \\mathcal{O}(h^{p+1})$，其中 $Q^{\\ast}$ 是精确关注量，$K$ 是非零常数，$p$ 是观测到的精度阶。\n- 三套网格序列是单调收敛的。\n- 已知数据：$Q_1 = 0.142$, $Q_2 = 0.138$, $Q_3 = 0.1365$，以及 $r = 2$。\n- 任务：\n  1. 推导并计算观测阶 $p$。\n  2. 推导 $Q^{\\ast}$ 的理查森外推表达式并计算其值 $Q_{\\text{ext}}$。\n  3. 概述计算网格收敛指数 $\\text{GCI}_{32}$ 的步骤，并使用安全因子 $F_s = 1.25$ 进行计算。\n- 四舍五入要求：$p$ 和 $\\text{GCI}_{32}$ 取四位有效数字。\n- 最终答案格式：一个包含 $p$ 和 $\\text{GCI}_{32}$ 数值的行矩阵。\n\n### 步骤 2：使用提取的已知条件进行验证\n- 科学依据：该问题描述了 CFD 中一个标准的、被广泛接受的验证与确认程序，即网格收敛指数 ($\\text{GCI}$) 方法，该方法基于理查森外推。渐近误差模型是此方法的基本假设。该程序在科学文献（例如，Roache、Celik 等人的著作）中有详细记载。\n- 适定性：问题提供了所有必要的数据（$Q_1, Q_2, Q_3, r, F_s$）来唯一确定所需的量（$p$ 和 $\\text{GCI}_{32}$）。数据满足了收敛单调的条件（$0.142 > 0.138 > 0.1365$），这是该方法标准应用的先决条件。\n- 客观性：问题以精确的技术语言陈述，没有主观性或模糊性。\n\n### 步骤 3：结论与行动\n该问题在科学上是合理的、适定的、客观的和完整的。这是数值方法和计算流体动力学领域中的一个有效问题。我将继续进行解答。\n\n解答需要执行问题陈述中指定的三个任务。\n\n**1. 观测精度阶 $p$ 的推导与计算**\n\n假设解处于渐近区，误差由主导项决定。误差模型由 $Q(h) \\approx Q^{\\ast} + K h^{p}$ 给出。我们可以为三套网格写出这个表达式：\n$$Q_1 \\approx Q^{\\ast} + K h_1^{p}$$\n$$Q_2 \\approx Q^{\\ast} + K h_2^{p}$$\n$$Q_3 \\approx Q^{\\ast} + K h_3^{p}$$\n为了消去未知的精确解 $Q^{\\ast}$，我们取连续网格上解的差值：\n$$Q_1 - Q_2 \\approx K (h_1^p - h_2^p)$$\n$$Q_2 - Q_3 \\approx K (h_2^p - h_3^p)$$\n接下来，我们取这些差值的比率以消去未知的常数 $K$：\n$$\\frac{Q_1 - Q_2}{Q_2 - Q_3} \\approx \\frac{h_1^p - h_2^p}{h_2^p - h_3^p}$$\n使用恒定的网格加密比 $r = h_1/h_2 = h_2/h_3$，我们可以用 $h_2$ 来表示 $h_1$ 和 $h_3$：$h_1 = r h_2$ 和 $h_3 = h_2/r$。将这些代入比率中：\n$$\\frac{Q_1 - Q_2}{Q_2 - Q_3} \\approx \\frac{(r h_2)^p - h_2^p}{h_2^p - (h_2/r)^p} = \\frac{h_2^p (r^p - 1)}{h_2^p (1 - r^{-p})} = \\frac{r^p - 1}{(r^p - 1)/r^p} = r^p$$\n这就得到了 $p$ 的公式。为了求解 $p$，我们对两边取自然对数：\n$$\\ln\\left(\\frac{Q_1 - Q_2}{Q_2 - Q_3}\\right) \\approx p \\ln(r)$$\n因此，推导出的观测精度阶公式为：\n$$p \\approx \\frac{\\ln\\left(\\frac{Q_1 - Q_2}{Q_2 - Q_3}\\right)}{\\ln(r)}$$\n现在，我们代入给定的数值：$Q_1 = 0.142$，$Q_2 = 0.138$，$Q_3 = 0.1365$，以及 $r = 2$。\n$$p \\approx \\frac{\\ln\\left(\\frac{0.142 - 0.138}{0.138 - 0.1365}\\right)}{\\ln(2)} = \\frac{\\ln\\left(\\frac{0.004}{0.0015}\\right)}{\\ln(2)} = \\frac{\\ln(8/3)}{\\ln(2)}$$\n计算数值：\n$$p \\approx \\frac{0.980829253}{0.693147181} \\approx 1.415037499$$\n四舍五入到四位有效数字，我们得到 $p \\approx 1.415$。\n\n**2. 理查森外推值 $Q_{\\text{ext}}$ 的推导与计算**\n\n我们使用两套最细网格的解 $Q_2$ 和 $Q_3$ 来求外推值，我们将其表示为 $Q_{\\text{ext}}$。模型给出：\n$$Q_2 \\approx Q_{\\text{ext}} + K h_2^{p}$$\n$$Q_3 \\approx Q_{\\text{ext}} + K h_3^{p}$$\n使用 $h_2 = r h_3$，第一个方程变为 $Q_2 \\approx Q_{\\text{ext}} + K (r h_3)^{p} = Q_{\\text{ext}} + K r^p h_3^p$。为了消去 $K$，我们将第二个方程乘以 $r^p$：\n$$r^p Q_3 \\approx r^p Q_{\\text{ext}} + K r^p h_3^p$$\n从中减去 $Q_2$ 的表达式得到：\n$$r^p Q_3 - Q_2 \\approx (r^p Q_{\\text{ext}} - Q_{\\text{ext}}) = Q_{\\text{ext}}(r^p - 1)$$\n求解 $Q_{\\text{ext}}$，我们推导出两套网格的理查森外推公式：\n$$Q_{\\text{ext}} = \\frac{r^p Q_3 - Q_2}{r^p - 1}$$\n这可以重写以显示对细网格解的修正：\n$$Q_{\\text{ext}} = Q_3 + \\frac{Q_3 - Q_2}{r^p - 1}$$\n我们使用上一步得到的精确比率 $r^p = 8/3$ 以及 $Q_2 = 0.138$ 和 $Q_3 = 0.1365$ 来计算 $Q_{\\text{ext}}$ 的数值：\n$$Q_{\\text{ext}} = 0.1365 + \\frac{0.1365 - 0.138}{(8/3) - 1} = 0.1365 + \\frac{-0.0015}{5/3} = 0.1365 - (0.0015 \\times \\frac{3}{5}) = 0.1365 - 0.0009 = 0.1356$$\n所以，外推值为 $Q_{\\text{ext}} = 0.1356$。\n\n**3. 网格收敛指数 ($\\text{GCI}_{32}$)**\n\n网格收敛指数 ($\\text{GCI}$) 提供了因离散误差引起的细网格解不确定性的度量。计算网格对 $(h_3, h_2)$ 的细网格 GCI（表示为 $\\text{GCI}_{32}$）的标准步骤如下：\n- 步骤 A：使用三套网格的解数据计算表观精度阶 $p$。这已在第 1 部分完成。\n- 步骤 B：计算两套最细网格解 $Q_2$ 和 $Q_3$ 之间的相对差异。标准公式使用细网格解进行归一化：\n  $$e_{a,32} = \\left| \\frac{Q_3 - Q_2}{Q_3} \\right|$$\n- 步骤 C：应用 GCI 公式，该公式将此相对差异乘以一个因子，该因子包括安全因子 $F_s$ 和加密比 $r$ 的 $p$ 次方：\n  $$\\text{GCI}_{32} = \\frac{F_s |e_{a,32}|}{r^p - 1} = \\frac{F_s}{r^p - 1} \\left| \\frac{Q_3 - Q_2}{Q_3} \\right|$$\n安全因子 $F_s$ 考虑了解可能不完全处于渐近区的情况。当观测阶 $p$ 接近格式的理论阶时，推荐使用 $F_s = 1.25$；当 $p$ 未能很好地确定或变化显著时，则使用 $F_s=3$。此处给定 $F_s=1.25$。\n\n现在我们使用给定的数据和中间结果计算 $\\text{GCI}_{32}$ 的数值：\n$F_s = 1.25$，$r^p = 8/3$，$Q_2 = 0.138$，$Q_3 = 0.1365$。\n$$\\text{GCI}_{32} = \\frac{1.25}{(8/3) - 1} \\left| \\frac{0.1365 - 0.138}{0.1365} \\right| = \\frac{1.25}{5/3} \\left| \\frac{-0.0015}{0.1365} \\right|$$\n$$\\text{GCI}_{32} = (1.25 \\times \\frac{3}{5}) \\left(\\frac{0.0015}{0.1365}\\right) = 0.75 \\times \\frac{15}{1365} = 0.75 \\times \\frac{1}{91}$$\n计算最终数值：\n$$\\text{GCI}_{32} \\approx 0.00824175824$$\n作为无量纲小数，并四舍五入到四位有效数字，我们得到 $\\text{GCI}_{32} \\approx 0.008242$。这个值意味着细网格解 $Q_3$ 的估计不确定度约为 $0.82\\%$。\n\n最终要求的值是 $p$ 和 $\\text{GCI}_{32}$，四舍五入到四位有效数字。\n$p \\approx 1.415$\n$\\text{GCI}_{32} \\approx 0.008242$",
            "answer": "$$\\boxed{\\begin{pmatrix} 1.415  0.008242 \\end{pmatrix}}$$"
        },
        {
            "introduction": "尽管全局一致加密简单，但计算成本通常很高且效率低下。更先进的方法是“目标导向自适应”，它只在对我们关心的特定工程量（如升力）影响最大的区域进行加密。本练习将深入探讨伴随方法（adjoint method）的推导，这是一种强大的技术，能高效计算出升力等目标函数对全场所有网格单元解的敏感度，从而为我们提供一张精确的“地图”，指导我们何处加密能最有效地提升目标量的计算精度 。",
            "id": "3975841",
            "problem": "在计算流体动力学（CFD）的背景下，考虑一个由欧拉方程控制的绕翼型的二维、定常、无粘、可压缩流动。令守恒状态向量为 $u = (\\rho, \\rho u, \\rho v, \\rho E)^{\\top}$，比热比为 $\\gamma$。计算域 $\\Omega$ 通过单元中心有限体积法进行离散，其一致边界被划分为三个不相交的集合：翼型表面 $\\Gamma_{L}$、远场入流 $\\Gamma_{\\mathrm{in}}$ 和远场出流 $\\Gamma_{\\mathrm{out}}$，在 $\\partial \\Omega = \\Gamma_{L} \\cup \\Gamma_{\\mathrm{in}} \\cup \\Gamma_{\\mathrm{out}}$ 上定义了外单位法向量 $\\boldsymbol{n} = (n_{x}, n_{y})$。压力由 $p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho (u^{2} + v^{2})\\right)$ 给出，代表标量升力的泛函为\n$$\nJ(u) = \\int_{\\Gamma_{L}} p\\, n_{y}\\, ds.\n$$\n离散定常残差 $R(u) = 0$ 源于所有单元面（包括边界面）上无粘数值通量的有限体积平衡。假设远场为亚音速，因此 $|u_{n}|  a$，其中 $u_{n} = u n_{x} + v n_{y}$，$a$ 为声速。远场边界条件通过在 $\\Gamma_{\\mathrm{in}}$ 上规定原始入流特征数据和在 $\\Gamma_{\\mathrm{out}}$ 上规定互补数据来确保适定性。\n\n从守恒欧拉方程和定常有限体积残差的定义出发，通过引入形式为 $L(u,\\lambda) = J(u) + \\lambda^{\\top} R(u)$ 的拉格朗日量，构建与 $J(u)$ 相关的目标导向的离散伴随系统，其中 $\\lambda$ 是离散伴随变量的向量。通过线性化推导内部伴随方程，并说明边界项如何导出伴随边界条件。明确指出在亚音速条件下，如何根据沿 $\\boldsymbol{n}$ 投影的无粘通量雅可比矩阵的特征结构来确定 $\\Gamma_{\\mathrm{in}}$ 和 $\\Gamma_{\\mathrm{out}}$ 上的伴随边界条件，并解释 $\\Gamma_{L}$ 上的升力泛函在设定伴随边界源中的作用。\n\n最后，考虑一个位于 $\\Gamma_{L}$ 上长度为 $\\Delta s$ 的单个边界面 $f \\subset \\Gamma_{L}$，其面状态 $u_{f} = (\\rho, \\rho u, \\rho v, \\rho E)^{\\top}$ 和外法向量 $\\boldsymbol{n} = (n_{x}, n_{y})$ 均为常数。将该面对离散泛函的贡献视为 $J_{f}(u_{f}) = p(u_{f})\\, n_{y}\\, \\Delta s$，请提供四分量基于面的灵敏度向量 $\\frac{\\partial J_{f}}{\\partial u_{f}}$ 的闭式解析表达式，其分量顺序为 $\\left(\\frac{\\partial J_{f}}{\\partial \\rho}, \\frac{\\partial J_{f}}{\\partial (\\rho u)}, \\frac{\\partial J_{f}}{\\partial (\\rho v)}, \\frac{\\partial J_{f}}{\\partial (\\rho E)}\\right)$，并表示为 $(\\rho, \\rho u, \\rho v, \\rho E)$、$n_{y}$、$\\Delta s$ 和 $\\gamma$ 的函数。你的最终答案必须是一个无单位的单一闭式表达式。",
            "solution": "问题陈述具有科学依据，是适定的、客观的。它描述了在计算流体动力学中为欧拉系统推导离散伴随方程的标准框架，这是空气动力学设计和优化中的一项基本技术。所有给出的定义，如状态向量、压力关系、升力泛函和拉格朗日量，都是标准且一致的。该问题是对一个数学推导的正式请求，并且给出了完整的说明。因此，该问题是有效的，将提供一个解答。\n\n问题的核心是为欧拉方程推导目标导向的离散伴随系统，以计算升力泛函 $J(u)$ 的灵敏度。伴随方法通过求解一个与参数扰动无关的单一线性系统（即伴随系统），提供了一种计算一个泛函相对于多个参数的梯度的高效方法。\n\n我们从给定的拉格朗日量开始：\n$$\nL(u, \\lambda) = J(u) + \\lambda^{\\top} R(u)\n$$\n这里，$u$ 是网格中所有单元上的离散状态向量，$\\lambda$ 是相同维度的离散伴随向量，$J(u)$ 是我们感兴趣的标量泛函（升力），$R(u)=0$ 代表定常离散有限体积方程组。状态 $u$ 是 $R(u)=0$ 的解。泛函 $J$ 关于任意参数 $\\alpha$（该参数可以定义几何形状、流动条件等）的灵敏度由全导数 $\\frac{dJ}{d\\alpha}$ 给出。由于 $u$ 隐式地依赖于 $\\alpha$，我们有：\n$$\n\\frac{dJ}{d\\alpha} = \\frac{\\partial J}{\\partial u} \\frac{du}{d\\alpha} + \\frac{\\partial J}{\\partial \\alpha}\n$$\n项 $\\frac{du}{d\\alpha}$ 是状态灵敏度，直接计算它的代价很高。伴随方法避免了这个问题。由于 $R(u(\\alpha))=0$，其关于 $\\alpha$ 的全导数也为零：\n$$\n\\frac{dR}{d\\alpha} = \\frac{\\partial R}{\\partial u} \\frac{du}{d\\alpha} + \\frac{\\partial R}{\\partial \\alpha} = 0 \\implies \\frac{\\partial R}{\\partial u} \\frac{du}{d\\alpha} = - \\frac{\\partial R}{\\partial \\alpha}\n$$\n拉格朗日量提供了一条更优雅的路径。由于当 $R(u)=0$ 时，对于任意 $\\lambda$ 都有 $L(u, \\lambda) = J(u)$，它们的全导数相等：\n$$\n\\frac{dJ}{d\\alpha} = \\frac{dL}{d\\alpha} = \\frac{\\partial L}{\\partial u} \\frac{du}{d\\alpha} + \\frac{\\partial L}{\\partial\\lambda} \\frac{d\\lambda}{d\\alpha} + \\frac{\\partial L}{\\partial\\alpha}\n$$\n由于 $\\frac{\\partial L}{\\partial\\lambda} = R(u)^{\\top}$ 且 $R(u)=0$，中间项消失。我们剩下：\n$$\n\\frac{dJ}{d\\alpha} = \\left(\\frac{\\partial J}{\\partial u} + \\lambda^{\\top} \\frac{\\partial R}{\\partial u}\\right) \\frac{du}{d\\alpha} + \\left(\\frac{\\partial J}{\\partial \\alpha} + \\lambda^{\\top} \\frac{\\partial R}{\\partial \\alpha}\\right)\n$$\n伴随方法的核心思想是选择伴随向量 $\\lambda$ 以消除包含未知状态灵敏度 $\\frac{du}{d\\alpha}$ 的项。这通过将其系数设为零来实现：\n$$\n\\frac{\\partial J}{\\partial u} + \\lambda^{\\top} \\frac{\\partial R}{\\partial u} = 0 \\implies \\left(\\frac{\\partial R}{\\partial u}\\right)^{\\top} \\lambda = - \\left(\\frac{\\partial J}{\\partial u}\\right)^{\\top}\n$$\n这就是离散伴随方程。它是一个关于伴随向量 $\\lambda$ 的线性系统，其中矩阵是流动残差雅可比矩阵的转置 $(\\frac{\\partial R}{\\partial u})^{\\top}$，右端项是泛函关于状态变量梯度的负转置。通过求解该系统得到 $\\lambda$ 后，泛函的灵敏度即为：\n$$\n\\frac{dJ}{d\\alpha} = \\frac{\\partial J}{\\partial \\alpha} + \\lambda^{\\top} \\frac{\\partial R}{\\partial \\alpha}\n$$\n这个表达式不再包含项 $\\frac{du}{d\\alpha}$。\n\n为了理解伴随方程及其边界条件的结构，我们分析项 $\\lambda^{\\top} \\frac{\\partial R}{\\partial u}$。在单元中心有限体积法中，单元 $i$ 的残差 $R_i$ 是其所有面上的数值通量 $\\mathcal{F}_{ij}$ 的总和：$R_i(u) = \\sum_{j \\in N(i)} \\mathcal{F}_{ij}(u_i, u_j, \\boldsymbol{n}_{ij}) \\Delta s_{ij}$。线性化此项并执行分部积分的离散模拟（对单元和面求和）揭示了其结构。由此产生的内部伴随方程具有 $\\lambda$ 的守恒律形式，其中伴随信息在域内传播。\n\n伴随系统的边界条件源于确保离散分部积分不会在计算域边界上留下任何伪项。在连续设定下，这对应于从弱形式推导伴随偏微分方程时将边界积分设为零。边界项的形式为 $\\int_{\\partial\\Omega} \\lambda^{\\top} A_n \\delta u \\, dS$，其中 $A_n = \\frac{\\partial (\\mathcal{F} \\cdot \\boldsymbol{n})}{\\partial u}$ 是投影到边界面法向量 $\\boldsymbol{n}$ 上的通量雅可比矩阵。对于所有容许变分 $\\delta u$，该积分与来自泛函的任何边界贡献相结合后必须为零。一个容许变分 $\\delta u$ 是指尊重原始问题边界条件的变分。\n\n我们分析 $\\partial\\Omega$ 各部分的边界条件：\n在翼型表面 $\\Gamma_{L}$ 上定义了泛函 $J(u)$。其变分贡献了一个源项 $\\delta J = \\int_{\\Gamma_L} \\frac{\\partial p}{\\partial u} \\delta u \\, n_y \\, ds$。这个导数 $\\frac{\\partial p}{\\partial u}$ 作为伴随方程的源项，局部作用于邻近翼型的单元。这就是“目标”（升力泛函）驱动伴随系统的机制。剩余项 $\\lambda^{\\top}A_n \\delta u$ 由原始问题的滑移壁面边界条件处理，该条件约束了容许变分 $\\delta u$。\n\n在远场边界 $\\Gamma_{\\mathrm{in}}$ 和 $\\Gamma_{\\mathrm{out}}$ 上，泛函为零，因此我们只需要确保 $\\int \\lambda^{\\top} A_n \\delta u \\, dS = 0$。我们对 $A_n$ 进行特征分解 $A_n = K \\Lambda K^{-1}$，其中 $\\Lambda$ 是特征值组成的对角矩阵，$K$ 包含右特征向量。边界项变为 $\\int \\hat{\\lambda}^{\\top} \\Lambda \\delta\\hat{u} \\, dS = 0$，其中 $\\hat{\\lambda}^{\\top} = \\lambda^{\\top} K$ 和 $\\delta\\hat{u} = K^{-1} \\delta u$ 分别是伴随特征变量和原始特征变量。\n对于原始问题，亚音速边界上的适定性要求指定由进入计算域的特征波所携带的信息。对于一个容许变分 $\\delta u$，入流特征变量的变分必须为零（$\\delta\\hat{u}_{\\text{in}} = 0$），而出流特征变量的变分（$\\delta\\hat{u}_{\\text{out}}$）则不受约束。\n边界积分分裂为两部分：$\\sum_{\\text{in}} \\hat{\\lambda}_{\\text{in}} \\Lambda_{\\text{in}} \\delta\\hat{u}_{\\text{in}} + \\sum_{\\text{out}} \\hat{\\lambda}_{\\text{out}} \\Lambda_{\\text{out}} \\delta\\hat{u}_{\\text{out}}$。第一项和为零，因为 $\\delta\\hat{u}_{\\text{in}}=0$。为了使第二项和对任意的 $\\delta\\hat{u}_{\\text{out}}$ 都为零，我们必须强制 $\\hat{\\lambda}_{\\text{out}}=0$（因为 $\\Lambda_{\\text{out}} \\neq 0$）。\n因此，伴随边界条件是：将与原始问题的出射特征相对应的伴随特征变量设为零。\n- 在 $\\Gamma_{\\mathrm{in}}$（亚音速入流，$\\boldsymbol{u}\\cdot\\boldsymbol{n}  0$）上，有一个出射特征（$u_n+a > 0$）。相应的伴随特征变量被设为零。\n- 在 $\\Gamma_{\\mathrm{out}}$（亚音速出流，$\\boldsymbol{u}\\cdot\\boldsymbol{n} > 0$）上，有三个出射特征（$u_n, u_n, u_n+a$，均为正）。相应的三个伴随特征变量被设为零。\n\n最后，我们推导基于面的灵敏度向量 $\\frac{\\partial J_f}{\\partial u_f}$ 的闭式表达式。来自翼型上单个面 $f$ 的泛函贡献为 $J_f(u_f) = p(u_f) n_y \\Delta s$。面上的状态向量为 $u_f = (\\rho, \\rho u, \\rho v, \\rho E)^{\\top}$。为清晰起见，我们将 $u_f$ 的分量表示为 $w_1 = \\rho$, $w_2 = \\rho u$, $w_3 = \\rho v$, 和 $w_4 = \\rho E$。\n\n压力 $p$ 由 $p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho (u^2 + v^2)\\right)$ 给出。我们必须用守恒变量 $w_i$ 来表示它：\n$u = \\frac{\\rho u}{\\rho} = \\frac{w_2}{w_1}$, $v = \\frac{\\rho v}{\\rho} = \\frac{w_3}{w_1}$。\n将这些代入压力方程：\n$$\np = (\\gamma-1)\\left(w_4 - \\frac{1}{2} w_1 \\left( \\left(\\frac{w_2}{w_1}\\right)^2 + \\left(\\frac{w_3}{w_1}\\right)^2 \\right) \\right) = (\\gamma-1)\\left(w_4 - \\frac{w_2^2 + w_3^2}{2w_1}\\right)\n$$\n现在我们计算 $J_f = p \\, n_y \\Delta s$ 关于 $u_f = (w_1, w_2, w_3, w_4)$ 各分量的偏导数。$n_y \\Delta s$ 项是一个常数因子。\n\n1. 关于 $w_1 = \\rho$ 的导数：\n$$\n\\frac{\\partial J_f}{\\partial \\rho} = n_y \\Delta s \\, \\frac{\\partial p}{\\partial w_1} = n_y \\Delta s (\\gamma-1) \\left( - \\frac{w_2^2+w_3^2}{2} \\right) (-w_1^{-2}) = n_y \\Delta s (\\gamma-1) \\frac{w_2^2+w_3^2}{2w_1^2}\n$$\n\n2. 关于 $w_2 = \\rho u$ 的导数：\n$$\n\\frac{\\partial J_f}{\\partial (\\rho u)} = n_y \\Delta s \\, \\frac{\\partial p}{\\partial w_2} = n_y \\Delta s (\\gamma-1) \\left( - \\frac{2w_2}{2w_1} \\right) = -n_y \\Delta s (\\gamma-1) \\frac{w_2}{w_1}\n$$\n\n3. 关于 $w_3 = \\rho v$ 的导数：\n$$\n\\frac{\\partial J_f}{\\partial (\\rho v)} = n_y \\Delta s \\, \\frac{\\partial p}{\\partial w_3} = n_y \\Delta s (\\gamma-1) \\left( - \\frac{2w_3}{2w_1} \\right) = -n_y \\Delta s (\\gamma-1) \\frac{w_3}{w_1}\n$$\n\n4. 关于 $w_4 = \\rho E$ 的导数：\n$$\n\\frac{\\partial J_f}{\\partial (\\rho E)} = n_y \\Delta s \\, \\frac{\\partial p}{\\partial w_4} = n_y \\Delta s (\\gamma-1) (1) = n_y \\Delta s (\\gamma-1)\n$$\n\n灵敏度向量 $\\frac{\\partial J_f}{\\partial u_f}$ 是这四个偏导数组成的向量。将它们组合成所要求的行矩阵，并用原始问题变量 $(\\rho, \\rho u, \\rho v, \\rho E)$ 表示：\n$$\n\\left( \\frac{\\partial J_f}{\\partial \\rho}, \\frac{\\partial J_f}{\\partial (\\rho u)}, \\frac{\\partial J_f}{\\partial (\\rho v)}, \\frac{\\partial J_f}{\\partial (\\rho E)} \\right) = n_y \\Delta s (\\gamma-1) \\begin{pmatrix} \\frac{(\\rho u)^2+(\\rho v)^2}{2\\rho^2}  -\\frac{\\rho u}{\\rho}  -\\frac{\\rho v}{\\rho}  1 \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{n_{y} \\Delta s (\\gamma-1) \\begin{pmatrix} \\frac{(\\rho u)^{2} + (\\rho v)^{2}}{2\\rho^{2}}  -\\frac{\\rho u}{\\rho}  -\\frac{\\rho v}{\\rho}  1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "网格自适应不仅仅是增加更多网格单元，选择正确的策略至关重要。知道了“何处”需要加密后，下一个问题是“如何”加密。本练习通过分析两种基本策略——$h$-自适应（减小单元尺寸）和$p$-自适应（提高单元内的多项式阶数）——在求解一个光滑流动问题时达到目标精度所需的计算成本，来对比它们的效率。这个计算过程突显了一个核心原则：最优的自适应策略取决于解本身的特性 。",
            "id": "3975808",
            "problem": "考虑使用高阶间断伽辽金（DG）方法求解可压缩欧拉方程，在一个边长为 $L=1$ 的正方形区域上，一个二维等熵涡以恒定速度对流。初始均匀网格使用 $N_{x}=N_{y}=16$ 个张量积四边形单元，得到基本单元尺寸 $h_{0}=L/N_{x}=0.0625$ 和 $N_{0}=N_{x}N_{y}=256$ 个单元。解在所有时间上都是光滑且解析的。您将比较两种加密策略，以在固定的结束时间 $T=1$ 内达到目标时空 $L^{2}$ 误差容限 $e_{\\mathrm{tol}}=10^{-6}$：\n\n- 策略 $\\mathrm{(p)}$：均匀增加多项式次数 $p$，同时保持 $h=h_{0}$ 不变。\n- 策略 $\\mathrm{(h)}$：将每个单元均匀分裂成四个子单元 $L$ 次（在每一层级上沿每个坐标方向二等分），同时保持 $p=p_{f}$ 固定。\n\n假设双曲系统的显式 DG 方法具有以下经过充分测试的建模关系：\n- 对于光滑解析解，在固定 $h$ 的 $p$-加密下，$L^{2}$ 误差随 $p$ 呈指数衰减：$e_{p}(p)=\\alpha\\,\\exp(-\\beta p)$，其中 $\\alpha=2.0\\times 10^{-2}$ 且 $\\beta=0.9$。\n- 在固定 $p_{f}$ 的 $h$-加密下，$L^{2}$ 误差随 $h$ 呈代数衰减：$e_{h}(h)=\\eta\\,h^{p_{f}+1}$，其中 $\\eta=5.0$ 且 $p_{f}=2$。\n- 稳定时间步长满足 Courant–Friedrichs–Lewy (CFL) 关系 $\\Delta t=\\mathrm{CFL}\\,\\dfrac{h}{a\\,(p+1)^{2}}$，其中对流速度 $a=1$ 且 $\\mathrm{CFL}=0.5$，因此达到时间 $T$ 所需的时间步数是 $n_{t}=\\dfrac{T}{\\Delta t}=\\dfrac{a\\,T\\,(p+1)^{2}}{\\mathrm{CFL}\\,h}$。\n- 每个单元每个时间步的浮点运算量与 $c_{e}(p)=\\gamma\\,(p+1)^{3}$ 成比例，其中 $\\gamma=2.0\\times 10^{5}$。\n- 四边形上张量积 DG 基的每个单元的自由度（DoF）为 $N_{e}(p)=(p+1)^{2}\\,m$，其中 $m=4$ 是可压缩欧拉方程中守恒变量的数量。\n\n在 $h$-加密策略中，$L$ 级均匀分裂得到 $h=h_{0}/2^{L}$ 和 $N=N_{0}\\,4^{L}$ 个单元。在 $p$-加密策略中，$h=h_{0}$ 且 $N=N_{0}$。\n\n任务：\n1. 使用误差模型，确定策略 $\\mathrm{(p)}$ 中为确保 $e_{p}(p)\\leq e_{\\mathrm{tol}}$ 所需的最小整数多项式次数 $p$，以及策略 $\\mathrm{(h)}$ 中为确保 $e_{h}(h)\\leq e_{\\mathrm{tol}}$ 所需的最小整数加密级别 $L$。\n2. 对于每种策略，在任务1得到的最小配置下，计算：\n   - 总自由度数，$N_{\\mathrm{DoF}}=N\\,N_{e}(p)$。\n   - 时间步数 $n_{t}$。\n   - 将解推进到时间 $T$ 的总浮点运算次数，定义为 $W=N\\,n_{t}\\,c_{e}(p)$。\n   - 每个自由度的计算量，$w_{\\mathrm{DoF}}=W/N_{\\mathrm{DoF}}$。\n3. 选择以最小总计算成本 $W$ 达到目标精度的策略，并报告该最小总成本。\n\n以 $10^{9}$ 次浮点运算（FLOPs）为单位表示最终的最小计算成本。将您的答案四舍五入到四位有效数字。",
            "solution": "首先对用户提供的问题进行严格的验证过程。\n\n### 步骤 1：提取已知条件\n问题提供了以下数据、定义和模型：\n- 区域：正方形，边长 $L=1$。\n- 初始网格：$N_{x}=N_{y}=16$ 个四边形单元。\n- 初始单元数：$N_{0}=N_{x}N_{y}=256$。\n- 基本单元尺寸：$h_{0}=L/N_{x}=1/16=0.0625$。\n- 控制方程：可压缩欧拉方程。\n- 流动特性：等熵涡，光滑且解析的解。\n- 数值方法：间断伽辽金（DG）。\n- 模拟结束时间：$T=1$。\n- 目标误差容限：$e_{\\mathrm{tol}}=10^{-6}$。\n\n**策略 $\\mathrm{(p)}$（p-加密）：**\n- 多项式次数 $p$ 增加。\n- 网格尺寸：$h=h_{0}$（常数）。\n- 单元数：$N=N_{0}$（常数）。\n- 误差模型：$e_{p}(p)=\\alpha\\,\\exp(-\\beta p)$，其中 $\\alpha=2.0\\times 10^{-2}$ 且 $\\beta=0.9$。\n\n**策略 $\\mathrm{(h)}$（h-加密）：**\n- 多项式次数：$p=p_{f}=2$（固定）。\n- 均匀加密级别：$L$。\n- 网格尺寸：$h=h_{0}/2^{L}$。\n- 单元数：$N=N_{0}\\,4^{L}$。\n- 误差模型：$e_{h}(h)=\\eta\\,h^{p_{f}+1}$，其中 $\\eta=5.0$。\n\n**通用模型：**\n- 稳定时间步长：$\\Delta t=\\mathrm{CFL}\\,\\dfrac{h}{a\\,(p+1)^{2}}$。\n- 常数：$\\mathrm{CFL}=0.5$，对流速度 $a=1$。\n- 时间步数：$n_{t}=\\dfrac{T}{\\Delta t}=\\dfrac{a\\,T\\,(p+1)^{2}}{\\mathrm{CFL}\\,h}$。\n- 每个单元每步的计算量：$c_{e}(p)=\\gamma\\,(p+1)^{3}$，其中 $\\gamma=2.0\\times 10^{5}$。\n- 每个单元的自由度（DoF）：$N_{e}(p)=(p+1)^{2}\\,m$，其中 $m=4$。\n\n**任务：**\n1. 确定策略 $\\mathrm{(p)}$ 中满足误差容限的最小整数 $p$，以及策略 $\\mathrm{(h)}$ 中满足误差容限的最小整数 $L$。\n2. 对每种策略，计算总自由度（$N_{\\mathrm{DoF}}$）、时间步数（$n_{t}$）、总计算量（$W$）以及每个自由度的计算量（$w_{\\mathrm{DoF}}$）。\n3. 选择总计算量 $W$ 最小的策略，并以 $10^9$ FLOPs 为单位报告该值，四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 该问题是偏微分方程数值分析中的一个标准练习，特别是在计算流体力学领域。$p$-加密（对于光滑解呈指数衰减）和 $h$-加密（代数衰减，速率为 $p+1$）的误差衰减模型在理论上是为 DG 方法建立的。计算成本和 CFL 条件的缩放关系也代表了显式 DG 格式的特点。该问题在科学上是合理的。\n- **适定性：** 所有必要的参数和方程都已提供。任务定义明确，并根据所提供的模型可以得到一组唯一的结果。\n- **客观性：** 问题以精确、定量的术语陈述，没有主观性语言。\n- **完整性与一致性：** 问题是自洽的，没有矛盾。给定的数值是一致的（例如，$h_{0} = 1/16 = 0.0625$）。\n- **现实性：** 该设置描述了一个常见的基准问题（对流涡），模型参数对于此类模拟是合理的。\n\n### 步骤 3：结论与行动\n该问题是有效的，因为它具有科学依据、适定、客观且内部一致。我们可以继续进行求解。\n\n### 任务 1：确定最小加密参数\n**策略 $\\mathrm{(p)}$：最小多项式次数 $p$**\n我们必须找到满足 $e_{p}(p) \\leq e_{\\mathrm{tol}}$ 的最小整数 $p$。\n$$ \\alpha\\,\\exp(-\\beta p) \\leq e_{\\mathrm{tol}} $$\n代入给定值：\n$$ (2.0 \\times 10^{-2}) \\exp(-0.9 p) \\leq 10^{-6} $$\n$$ \\exp(-0.9 p) \\leq \\frac{10^{-6}}{2.0 \\times 10^{-2}} = 5.0 \\times 10^{-5} $$\n对两边取自然对数：\n$$ -0.9 p \\leq \\ln(5.0 \\times 10^{-5}) $$\n$$ p \\geq -\\frac{\\ln(5.0 \\times 10^{-5})}{0.9} $$\n使用 $\\ln(5.0 \\times 10^{-5}) \\approx -9.9034875$：\n$$ p \\geq -\\frac{-9.9034875}{0.9} \\approx 11.003875 $$\n由于 $p$ 必须是整数，所需的最小多项式次数为 $p_{\\min}=12$。\n\n**策略 $\\mathrm{(h)}$：最小加密级别 $L$**\n我们必须找到满足 $e_{h}(h) \\leq e_{\\mathrm{tol}}$ 的最小整数 $L$。多项式次数固定为 $p_f=2$。单元尺寸为 $h = h_0 / 2^L$。\n$$ \\eta\\,h^{p_{f}+1} \\leq e_{\\mathrm{tol}} $$\n代入给定值：\n$$ 5.0\\,h^{3} \\leq 10^{-6} $$\n$$ h^{3} \\leq \\frac{10^{-6}}{5.0} = 2.0 \\times 10^{-7} $$\n$$ h \\leq (2.0 \\times 10^{-7})^{1/3} \\approx 0.005848 \\; \\mathrm{m} $$\n现在，我们将其与加密级别 $L$ 联系起来：\n$$ \\frac{h_{0}}{2^{L}} \\leq 0.005848 $$\n$$ \\frac{0.0625}{2^{L}} \\leq 0.005848 $$\n$$ 2^{L} \\geq \\frac{0.0625}{0.005848} \\approx 10.6875 $$\n我们必须找到满足此条件的最小整数 $L$。当 $L=3$ 时，$2^3=8$，不满足条件。当 $L=4$ 时，$2^4=16$，满足条件。因此，所需的最小加密级别为 $L_{\\min}=4$。\n\n### 任务 2：计算性能指标\n**策略 $\\mathrm{(p)}$，其中 $p=12$**\n- 参数：$p=12$, $h=h_{0}=0.0625$, $N=N_{0}=256$。\n- 总自由度：$N_{\\mathrm{DoF}, p} = N\\,N_{e}(p) = N_{0}(p+1)^{2}m = 256(12+1)^{2}(4) = 1024(13)^{2} = 1024(169) = 173056$。\n- 时间步数：$n_{t, p} = \\dfrac{a\\,T\\,(p+1)^{2}}{\\mathrm{CFL}\\,h} = \\dfrac{(1)(1)(12+1)^{2}}{(0.5)(0.0625)} = \\dfrac{169}{0.03125} = 5408$。\n- 总计算量：$W_{p} = N\\,n_{t, p}\\,c_{e}(p) = N_{0}\\,n_{t, p}\\,\\gamma(p+1)^{3} = 256(5408)(2.0 \\times 10^{5})(12+1)^{3} = 256(5408)(2.0 \\times 10^{5})(2197)$。\n$W_{p} = 6.083264512 \\times 10^{14}$ FLOPs。\n- 每个自由度的计算量：$w_{\\mathrm{DoF}, p} = W_{p} / N_{\\mathrm{DoF}, p} = \\dfrac{6.08326 \\times 10^{14}}{173056} \\approx 3.5152 \\times 10^{9}$ FLOPs/DoF。\n\n**策略 $\\mathrm{(h)}$，其中 $L=4$**\n- 参数：$p=p_{f}=2$, $L=4$。\n- 单元数：$N = N_{0}\\,4^{L} = 256 \\cdot 4^4 = 256 \\cdot 256 = 65536$。\n- 单元尺寸：$h = h_{0}/2^{L} = 0.0625/2^4 = 0.0625/16 = 0.00390625$。\n- 总自由度：$N_{\\mathrm{DoF}, h} = N\\,N_{e}(p_{f}) = N(p_f+1)^{2}m = 65536(2+1)^{2}(4) = 65536(9)(4) = 2359296$。\n- 时间步数：$n_{t, h} = \\dfrac{a\\,T\\,(p_f+1)^{2}}{\\mathrm{CFL}\\,h} = \\dfrac{(1)(1)(2+1)^{2}}{(0.5)(0.00390625)} = \\dfrac{9}{0.001953125} = 4608$。\n- 总计算量：$W_{h} = N\\,n_{t, h}\\,c_{e}(p_f) = N\\,n_{t, h}\\,\\gamma(p_f+1)^{3} = 65536(4608)(2.0 \\times 10^{5})(2+1)^{3} = 65536(4608)(2.0 \\times 10^{5})(27)$。\n$W_{h} = 1.6307453952 \\times 10^{15}$ FLOPs。\n- 每个自由度的计算量：$w_{\\mathrm{DoF}, h} = W_{h} / N_{\\mathrm{DoF}, h} = \\dfrac{1.63075 \\times 10^{15}}{2359296} \\approx 6.912 \\times 10^{8}$ FLOPs/DoF。\n\n### 任务 3：选择最小成本策略\n为了找到最有效的策略，我们比较总计算成本 $W_{p}$ 和 $W_{h}$。\n$$ W_{p} \\approx 6.083 \\times 10^{14} \\text{ FLOPs} $$\n$$ W_{h} \\approx 1.631 \\times 10^{15} \\text{ FLOPs} $$\n由于 $W_{p}  W_{h}$，对于这个光滑问题，$p$-加密策略在达到所需精度方面的计算成本更低，这与高阶方法的理论是一致的。\n\n最小总成本为 $W_{\\min} = W_{p} = 6.083264512 \\times 10^{14}$ FLOPs。\n问题要求以 $10^9$ FLOPs（GFLOPs）为单位表示此成本，并四舍五入到四位有效数字。\n$$ \\text{以 GFLOPs 为单位的成本} = \\frac{W_{\\min}}{10^9} = \\frac{6.083264512 \\times 10^{14}}{10^9} = 6.083264512 \\times 10^{5} $$\n这个值是 $608326.4512$。四舍五入到四位有效数字得到 $608300$，即 $6.083 \\times 10^5$。",
            "answer": "$$\\boxed{6.083 \\times 10^{5}}$$"
        }
    ]
}