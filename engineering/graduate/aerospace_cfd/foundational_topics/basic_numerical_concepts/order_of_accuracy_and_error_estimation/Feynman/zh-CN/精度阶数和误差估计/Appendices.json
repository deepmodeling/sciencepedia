{
    "hands_on_practices": [
        {
            "introduction": "有限差分法的基石是通过泰勒级数展开来推导离散格式的系数。本练习将带你实践这一核心技能，巩固导数的数学定义与其离散近似之间的联系。通过系统性地消除低阶误差项以达到更高的精度，你将学会如何推导一个四阶精度的拉普拉斯算子格式，并确定其主截断误差项，该项决定了格式的收敛率。",
            "id": "3982491",
            "problem": "航空航天计算流体动力学 (CFD) 模拟通常需要对粘性扩散算子进行高保真离散化，以控制数值耗散并解析薄边界层。考虑一个一维、足够光滑的函数 $u(x)$，它描述了层流边界层计算中沿一条线的速度流向分量，该函数定义在间距为 $h$、节点为 $x_i = x_0 + i h$ 的均匀网格上。您的任务是使用一个以 $x_i$ 为中心的对称 $5$ 点模板，构建一个用于一维拉普拉斯算子（二阶导数）的四阶精度有限差分近似。\n\n从函数 $u(x)$ 在点 $x_i$ 处关于点 $x_{i \\pm h}$ 和 $x_{i \\pm 2 h}$ 的 Taylor 级数展开式出发，并强制其与连续二阶导数算子的主阶项保持一致，推导出能够产生 $u''(x_i)$ 的四阶精度近似的唯一对称 $5$ 点模板。然后，使用相同的 Taylor 展开框架，推导截断误差，并明确确定您的离散拉普拉斯算子截断误差级数中乘以 $h^4 u^{(6)}(x_i)$ 项的系数。\n\n您最终报告的量必须是截断误差中乘以 $h^4 u^{(6)}(x_i)$ 的那个实值系数。将该系数表示为一个精确的有理数。无需四舍五入。不包括单位。",
            "solution": "该问题要求推导二阶导数 $u''(x_i)$ 的一个四阶精度、对称的 $5$ 点有限差分近似，并随后确定其截断误差中主项的系数。\n\n设均匀网格间距为 $h$。节点 $x_i$ 处二阶导数的近似值（我们记为 $L_h u_i$）是五个对称点 $x_{i-2}$、$x_{i-1}$、$x_i$、$x_{i+1}$ 和 $x_{i+2}$ 处函数值的线性组合。我们可以将此近似写为：\n$$\nL_h u_i = \\frac{1}{h^2} \\left[ c_{-2} u(x_{i-2}) + c_{-1} u(x_{i-1}) + c_0 u(x_i) + c_1 u(x_{i+1}) + c_2 u(x_{i+2}) \\right]\n$$\n对于对称模板，系数必须满足 $c_{-k} = c_k$。因此，我们有 $c_{-1} = c_1$ 和 $c_{-2} = c_2$。\n\n为确定系数 $c_0$、$c_1$ 和 $c_2$，我们使用 $u(x)$ 在点 $x_i$ 附近的 Taylor 级数展开。对于一个足够光滑的函数 $u(x)$，我们有：\n$$\nu(x_{i+k}) = u(x_i + kh) = \\sum_{n=0}^{\\infty} \\frac{(kh)^n}{n!} u^{(n)}(x_i)\n$$\n其中 $u^{(n)}(x_i)$ 是 $u$ 在 $x_i$ 处的 $n$ 阶导数。\n\n将这些展开式代入 $L_h u_i$ 的公式中：\n$$\nL_h u_i = \\frac{1}{h^2} \\sum_{k=-2}^{2} c_k \\left( \\sum_{n=0}^{\\infty} \\frac{(kh)^n}{n!} u^{(n)}(x_i) \\right)\n$$\n通过交换求和顺序，我们得到：\n$$\nL_h u_i = \\sum_{n=0}^{\\infty} \\left[ \\frac{h^{n-2}}{n!} \\sum_{k=-2}^{2} c_k k^n \\right] u^{(n)}(x_i)\n$$\n我们希望我们的近似 $L_h u_i$ 等于 $u''(x_i)$，且误差为 $O(h^4)$ 阶。这意味着我们需要将展开式中的各项与表达式 $u''(x_i) + O(h^4)$ 进行匹配。\n\n对于 $n=0$：$u(x_i)$ 的系数必须为零。\n$$\n\\frac{h^{-2}}{0!} \\sum_{k=-2}^{2} c_k k^0 = \\frac{1}{h^2}(c_{-2} + c_{-1} + c_0 + c_1 + c_2) = 0 \\implies c_0 + 2c_1 + 2c_2 = 0\n$$\n\n对于 $n=1$：$u'(x_i)$ 的系数必须为零。\n$$\n\\frac{h^{-1}}{1!} \\sum_{k=-2}^{2} c_k k^1 = \\frac{1}{h}(c_1 - c_1 + 2c_2 - 2c_2) = 0\n$$\n由于对称性 $c_{-k}=c_k$，此条件自动满足。\n\n对于 $n=2$：$u''(x_i)$ 的系数必须为 $1$。\n$$\n\\frac{h^{0}}{2!} \\sum_{k=-2}^{2} c_k k^2 = \\frac{1}{2} (c_1(1)^2 + c_1(-1)^2 + c_2(2)^2 + c_2(-2)^2) = 1 \\implies \\frac{1}{2}(2c_1 + 8c_2) = 1 \\implies c_1 + 4c_2 = 1\n$$\n\n对于 $n=3$：由于对称性，$u'''(x_i)$ 的系数自动为零。\n$$\n\\frac{h^{1}}{3!} \\sum_{k=-2}^{2} c_k k^3 = \\frac{h}{6} (c_1(1)^3 + c_1(-1)^3 + c_2(2)^3 + c_2(-2)^3) = 0\n$$\n\n对于 $n=4$：为达到四阶精度，$h^2 u^{(4)}(x_i)$ 项的系数必须为零。\n$$\n\\frac{h^{2}}{4!} \\sum_{k=-2}^{2} c_k k^4 = \\frac{h^2}{24} (c_1(1)^4 + c_1(-1)^4 + c_2(2)^4 + c_2(-2)^4) = 0 \\implies \\frac{h^2}{24}(2c_1 + 32c_2) = 0 \\implies c_1 + 16c_2 = 0\n$$\n\n我们现在有一个关于 $c_1$ 和 $c_2$ 的线性方程组：\n1) $c_1 + 4c_2 = 1$\n2) $c_1 + 16c_2 = 0$\n\n方程 (2) 减去方程 (1)：\n$$\n(c_1 + 16c_2) - (c_1 + 4c_2) = 0 - 1 \\implies 12c_2 = -1 \\implies c_2 = -\\frac{1}{12}\n$$\n将 $c_2$ 代回方程 (2)：\n$$\nc_1 + 16\\left(-\\frac{1}{12}\\right) = 0 \\implies c_1 - \\frac{16}{12} = 0 \\implies c_1 = \\frac{16}{12} = \\frac{4}{3}\n$$\n最后，我们从第一个条件中求出 $c_0$：\n$$\nc_0 = -2c_1 - 2c_2 = -2\\left(\\frac{4}{3}\\right) - 2\\left(-\\frac{1}{12}\\right) = -\\frac{8}{3} + \\frac{2}{12} = -\\frac{16}{6} + \\frac{1}{6} = -\\frac{15}{6} = -\\frac{5}{2}\n$$\n有限差分近似为：\n$$\nL_h u_i = \\frac{1}{12h^2} \\left[ -u_{i-2} + 16u_{i-1} - 30u_i + 16u_{i+1} - u_{i+2} \\right]\n$$\n\n截断误差 $\\tau$ 定义为 $\\tau = L_h u_i - u''(x_i)$。截断误差的主项对应于展开式中 $u''(x_i)$ 项之后的第一个非零项。$n=3$、$n=4$ 和 $n=5$ 的项（因对称性）为零。主误差项来自 $n=6$。\n$$\n\\tau = \\left[ \\frac{h^{6-2}}{6!} \\sum_{k=-2}^{2} c_k k^6 \\right] u^{(6)}(x_i) + O(h^6)\n$$\n因此，乘以 $h^4 u^{(6)}(x_i)$ 的系数为：\n$$\nK = \\frac{1}{6!} \\sum_{k=-2}^{2} c_k k^6 = \\frac{1}{720} \\left[ c_{-2}(-2)^6 + c_{-1}(-1)^6 + c_1(1)^6 + c_2(2)^6 \\right]\n$$\n使用 $c_{-k}=c_k$：\n$$\nK = \\frac{1}{720} \\left[ 2c_1 (1)^6 + 2c_2 (2)^6 \\right] = \\frac{2c_1 + 128c_2}{720} = \\frac{c_1 + 64c_2}{360}\n$$\n代入推导出的 $c_1$ 和 $c_2$ 的值：\n$$\nc_1 = \\frac{4}{3} \\quad \\text{and} \\quad c_2 = -\\frac{1}{12}\n$$\n$$\nK = \\frac{\\frac{4}{3} + 64\\left(-\\frac{1}{12}\\right)}{360} = \\frac{\\frac{4}{3} - \\frac{64}{12}}{360} = \\frac{\\frac{4}{3} - \\frac{16}{3}}{360}\n$$\n$$\nK = \\frac{-\\frac{12}{3}}{360} = \\frac{-4}{360} = -\\frac{1}{90}\n$$\n因此，截断误差级数中乘以 $h^4 u^{(6)}(x_i)$ 项的系数是 $-\\frac{1}{90}$。",
            "answer": "$$ \\boxed{-\\frac{1}{90}} $$"
        },
        {
            "introduction": "在泰勒级数分析的基础上，本练习将我们带入更复杂的有限体积法（FVM）框架中。它揭示了一个关键且常被忽视的问题：即使使用了高阶的解重构，对非线性通量积分的简单近似处理也可能导致整个格式的精度下降。通过这个练习，你将理解数值离散中各个环节保持一致性的重要性，这是开发高稳健性CFD求解器的关键原则。",
            "id": "3982499",
            "problem": "考虑在一维标量守恒律 $u_{t} + \\partial_{x} f(u) = 0$ 上应用有限体积法 (FVM) 进行离散化，该方法使用均匀网格，单元中心位于 $x_{i}$，单元宽度为 $h$。在每个单元内，假设解在由 $x = x_{i} + \\frac{h}{2} \\xi$ 定义的局部无量纲面心坐标 $\\xi \\in [-1,1]$ 中被重构为一个二次多项式。设重构为\n$$\nu(\\xi) = u_{0} + \\alpha \\,\\xi + \\beta \\,\\xi^{2} + \\mathcal{O}(h^{3}),\n$$\n其中 $u_{0} = u(x_{i})$，且对于足够光滑的 $u(x)$，重构系数满足网格尺度关系 $\\alpha = \\mathcal{O}(h)$ 和 $\\beta = \\mathcal{O}(h^{2})$。\n\n假设在半离散 FVM 中的数值更新需要计算非线性通量 $f(u)$ 在单元上的平均值，记为\n$$\n\\overline{f} \\equiv \\frac{1}{h} \\int_{x_{i}-h/2}^{x_{i}+h/2} f\\big(u(x)\\big)\\, dx.\n$$\n在实践中，一种常见的低成本近似是中点法则，\n$$\n\\overline{f}_{\\text{mid}} \\equiv f\\big(u(x_{i})\\big) = f(u_{0}).\n$$\n\n从标准的泰勒展开和链式法则出发，分析在给定的二次重构下，对于非线性通量 $f(u)$，近似值 $\\overline{f}_{\\text{mid}}$ 相对于精确值 $\\overline{f}$ 的精度阶。具体而言：\n\n- 推导误差 $E \\equiv \\overline{f} - \\overline{f}_{\\text{mid}}$ 的主阶项，并用 $f'(u_{0})$、$f''(u_{0})$、$\\alpha$ 和 $\\beta$ 表示。\n- 仅使用 $\\alpha$ 和 $\\beta$ 的网格尺度关系，确定 $E$ 的阶数（表示为 $h$ 的幂次），并解释在何种条件下，中点法则与二次重构结合使用时会导致精度阶下降。\n- 找出关于 $f'(u_{0})$、$f''(u_{0})$、$\\alpha$ 和 $\\beta$ 的解析条件，在该条件下中点法则不会降低二次重构所暗示的名义三阶空间精度。\n\n将误差 $E$ 的主阶项关于 $f'(u_{0})$、$f''(u_{0})$、$\\alpha$ 和 $\\beta$ 的闭式解析表达式作为你的最终答案。无需数值计算，无需单位。如果需要任何近似，请以精确的符号形式表示，不要四舍五入。",
            "solution": "目标是分析在一个采用二次重构的有限体积法 (FVM) 框架内，使用中点法则近似非线性通量函数 $f(u)$ 的单元平均值所产生的误差 $E \\equiv \\overline{f} - \\overline{f}_{\\text{mid}}$。\n\n定义的误差为 $E = \\overline{f} - \\overline{f}_{\\text{mid}}$，其中\n$$\n\\overline{f} \\equiv \\frac{1}{h} \\int_{x_{i}-h/2}^{x_{i}+h/2} f\\big(u(x)\\big)\\, dx \\quad \\text{and} \\quad \\overline{f}_{\\text{mid}} \\equiv f\\big(u(x_{i})\\big) = f(u_0).\n$$\n首先，我们将 $\\overline{f}$ 的积分转换到局部的无量纲坐标 $\\xi \\in [-1,1]$ 中。该变换由 $x = x_{i} + \\frac{h}{2} \\xi$ 给出，这意味着 $dx = \\frac{h}{2} d\\xi$。积分限 $x = x_{i} \\pm \\frac{h}{2}$ 对应于 $\\xi = \\pm 1$。将这些代入 $\\overline{f}$ 的定义中，得到：\n$$\n\\overline{f} = \\frac{1}{h} \\int_{-1}^{1} f\\big(u(\\xi)\\big) \\left(\\frac{h}{2}\\right) d\\xi = \\frac{1}{2} \\int_{-1}^{1} f\\big(u(\\xi)\\big) d\\xi.\n$$\n单元内的解由二次重构 $u(\\xi) = u_{0} + \\alpha \\xi + \\beta \\xi^{2} + \\mathcal{O}(h^{3})$ 给出，其中 $u_0 = u(x_i)$。为了计算该积分，我们对通量函数 $f\\big(u(\\xi)\\big)$ 在单元中心值 $u_0$ 附近进行泰勒级数展开。令 $\\delta u = u(\\xi) - u_0 = \\alpha \\xi + \\beta \\xi^{2} + \\mathcal{O}(h^3)$。展开式为：\n$$\nf\\big(u(\\xi)\\big) = f(u_0) + f'(u_0) \\delta u + \\frac{f''(u_0)}{2!} (\\delta u)^{2} + \\frac{f'''(u_0)}{3!} (\\delta u)^{3} + \\dots\n$$\n代入 $\\delta u$ 的表达式：\n$$\nf\\big(u(\\xi)\\big) = f(u_0) + f'(u_0) (\\alpha \\xi + \\beta \\xi^{2}) + \\frac{f''(u_0)}{2} (\\alpha \\xi + \\beta \\xi^{2})^{2} + \\mathcal{O}((\\delta u)^3) + \\dots\n$$\n我们展开二次项：$(\\alpha \\xi + \\beta \\xi^{2})^{2} = \\alpha^{2} \\xi^{2} + 2\\alpha \\beta \\xi^{3} + \\beta^{2} \\xi^{4}$。通量函数的表达式变为：\n$$\nf\\big(u(\\xi)\\big) = f(u_0) + f'(u_0)\\alpha \\xi + f'(u_0)\\beta \\xi^{2} + \\frac{f''(u_0)}{2}\\alpha^{2} \\xi^{2} + f''(u_0)\\alpha \\beta \\xi^{3} + \\frac{f''(u_0)}{2}\\beta^{2} \\xi^{4} + \\dots\n$$\n此处我们忽略了重构中 $\\mathcal{O}(h^3)$ 的部分以及泰勒展开中的更高阶项，因为我们只寻找主阶误差。\n\n现在，我们通过将此展开式在 $\\xi \\in [-1,1]$ 上积分来计算单元平均通量 $\\overline{f}$：\n$$\n\\overline{f} = \\frac{1}{2} \\int_{-1}^{1} \\left[ f(u_0) + f'(u_0)\\alpha \\xi + \\left( f'(u_0)\\beta + \\frac{f''(u_0)}{2}\\alpha^{2} \\right) \\xi^{2} + f''(u_0)\\alpha \\beta \\xi^{3} + \\frac{f''(u_0)}{2}\\beta^{2} \\xi^{4} + \\dots \\right] d\\xi\n$$\n我们使用在对称区间 $[-1,1]$ 上关于 $\\xi$ 幂次的标准积分恒等式：\n$$\n\\int_{-1}^{1} \\xi^{n} d\\xi =\n\\begin{cases}\n0  \\text{if } n \\text{ is odd} \\\\\n\\frac{2}{n+1}  \\text{if } n \\text{ is even}\n\\end{cases}\n$$\n应用此恒等式，所有含 $\\xi$ 奇次幂的项积分都为零。逐项进行积分：\n$$\n\\overline{f} = \\frac{1}{2} \\left[ f(u_0) \\int_{-1}^{1} d\\xi + \\left( f'(u_0)\\beta + \\frac{f''(u_0)}{2}\\alpha^{2} \\right) \\int_{-1}^{1} \\xi^{2} d\\xi + \\frac{f''(u_0)}{2}\\beta^{2} \\int_{-1}^{1} \\xi^{4} d\\xi + \\dots \\right]\n$$\n$$\n\\overline{f} = \\frac{1}{2} \\left[ f(u_0) \\cdot 2 + \\left( f'(u_0)\\beta + \\frac{f''(u_0)}{2}\\alpha^{2} \\right) \\cdot \\frac{2}{3} + \\frac{f''(u_0)}{2}\\beta^{2} \\cdot \\frac{2}{5} + \\dots \\right]\n$$\n$$\n\\overline{f} = f(u_0) + \\frac{1}{3}f'(u_0)\\beta + \\frac{1}{6}f''(u_0)\\alpha^{2} + \\frac{1}{10}f''(u_0)\\beta^{2} + \\dots\n$$\n误差 $E$ 是此表达式与 $\\overline{f}_{\\text{mid}} = f(u_0)$ 之间的差：\n$$\nE = \\overline{f} - \\overline{f}_{\\text{mid}} = \\frac{1}{3}f'(u_0)\\beta + \\frac{1}{6}f''(u_0)\\alpha^{2} + \\frac{1}{10}f''(u_0)\\beta^{2} + \\dots\n$$\n为了找到主阶项，我们使用给定的尺度关系 $\\alpha = \\mathcal{O}(h)$ 和 $\\beta = \\mathcal{O}(h^{2})$ 来检查每一项的量级（作为网格间距 $h$ 的函数）：\n- 项 $\\frac{1}{3}f'(u_0)\\beta$ 的阶为 $\\mathcal{O}(\\beta) = \\mathcal{O}(h^{2})$。\n- 项 $\\frac{1}{6}f''(u_0)\\alpha^{2}$ 的阶为 $\\mathcal{O}(\\alpha^{2}) = \\mathcal{O}(h^{2})$。\n- 项 $\\frac{1}{10}f''(u_0)\\beta^{2}$ 的阶为 $\\mathcal{O}(\\beta^{2}) = \\mathcal{O}((h^{2})^{2}) = \\mathcal{O}(h^{4})$。\n所有其他被忽略的项的阶均为 $\\mathcal{O}(h^4)$ 或更高。\n\n主阶误差是最低阶项的总和。在本例中，有两个 $\\mathcal{O}(h^2)$ 阶的项。\n因此，主阶误差为：\n$$\nE = \\frac{1}{6}f''(u_{0})\\alpha^{2} + \\frac{1}{3}f'(u_{0})\\beta + \\mathcal{O}(h^{4})\n$$\n该表达式提供了问题第一部分的答案。\n\n对于第二部分，我们分析此误差的阶。如前所定，主阶误差 $E$ 是 $\\mathcal{O}(h^{2})$。一个空间三阶精度的格式要求空间离散项中的所有误差源至少是 $\\mathcal{O}(h^{3})$ 阶。由于中点通量平均引入的误差是 $\\mathcal{O}(h^{2})$，它的阶低于重构的名义精度。这个 $\\mathcal{O}(h^{2})$ 的误差项将在空间算子的整体截断误差中占主导地位，从而将格式的整体精度阶从三阶降至二阶。只要 $E \\neq 0$，就会发生这种精度下降，而对于非线性通量（$f''(u_0) \\neq 0$）和非均匀解状态（$\\alpha \\neq 0$ 或 $\\beta \\neq 0$），这通常是成立的。\n\n对于第三部分，我们寻找中点法则不降低名义三阶精度的条件。这要求 $\\mathcal{O}(h^{2})$ 的主阶误差项恒等于零。如果满足此条件，误差 $E$ 将变为 $\\mathcal{O(h^4)}$，这高于所要求的 $\\mathcal{O}(h^{3})$，因此保持了格式的三阶精度。因此，解析条件为：\n$$\n\\frac{1}{6}f''(u_{0})\\alpha^{2} + \\frac{1}{3}f'(u_{0})\\beta = 0\n$$\n该条件代表了通量函数的曲率（$f''(u_0)$）、通量函数的线性部分（$f'(u_0)$）以及二次重构的系数（$\\alpha$ 和 $\\beta$）之间的一种特定平衡关系。\n\n所要求的最终答案是主阶误差 $E$ 的闭式解析表达式。",
            "answer": "$$\\boxed{\\frac{f''(u_{0})}{6}\\alpha^{2} + \\frac{f'(u_{0})}{3}\\beta}$$"
        },
        {
            "introduction": "最后的这个练习将理论与实践相结合，通过一个编码任务来应对真实世界CFD中的一个关键挑战：在曲面网格上进行方程离散。你将亲手实现并比较两种处理几何度量项的方法，从而直接观察到在几何离散中的微小不一致性如何导致精度的显著下降。这个练习不仅强调了“几何守恒律”（GCL）的重要性，也让你通过“人造解方法”（MMS）在代码验证方面获得宝贵的实践经验。",
            "id": "3982485",
            "problem": "在计算流体动力学（CFD）的背景下，考虑一个圆柱面上的标量场。设该物理表面由角坐标 $\\theta$ 和轴向坐标 $z$ 参数化。圆柱体具有一个标称半径 $R_0$，并受到一个平滑的正弦变化扰动。物理映射 $\\mathbf{x}(\\theta,z)$ 由下式给出\n$$\nx(\\theta) = r(\\theta)\\cos\\theta,\\quad y(\\theta) = r(\\theta)\\sin\\theta,\\quad z = z,\n$$\n其中\n$$\nr(\\theta) = R_0 + \\varepsilon \\sin\\theta,\n$$\n其中 $\\theta$ 以弧度为单位。表面上的诱导度量具有以下分量\n$$\ng_{\\theta\\theta} = r(\\theta)^2 + \\left(\\frac{dr}{d\\theta}\\right)^2,\\quad g_{zz} = 1,\\quad g_{\\theta z} = 0,\n$$\n并且行列式 $g$ 满足 $\\sqrt{g} = \\sqrt{g_{\\theta\\theta}}$。作用于标量场 $u(\\theta,z)$ 的表面拉普拉斯-贝尔特拉米算子（即内蕴表面拉普拉斯算子）为\n$$\n\\Delta_s u = \\frac{1}{\\sqrt{g}} \\frac{\\partial}{\\partial \\theta}\\left(\\sqrt{g}\\, g^{\\theta\\theta}\\, \\frac{\\partial u}{\\partial \\theta}\\right) + \\frac{1}{\\sqrt{g}} \\frac{\\partial}{\\partial z}\\left(\\sqrt{g}\\, g^{zz}\\, \\frac{\\partial u}{\\partial z}\\right),\n$$\n其中 $g^{\\theta\\theta} = \\left(g_{\\theta\\theta}\\right)^{-1}$ 且 $g^{zz} = 1$。由于 $\\sqrt{g}$ 不依赖于 $z$，上式可简化为\n$$\n\\Delta_s u = \\frac{1}{\\sqrt{g}} \\frac{\\partial}{\\partial \\theta}\\left(\\sqrt{g}\\, g^{\\theta\\theta}\\, \\frac{\\partial u}{\\partial \\theta}\\right) + \\frac{\\partial^2 u}{\\partial z^2}.\n$$\n定义人造（解析）解\n$$\nu(\\theta,z) = \\sin(3\\theta)\\,\\cos\\left(\\frac{2\\pi}{L} z\\right),\n$$\n其中 $L$ 是轴向周期。使用以上定义，并记 $G(\\theta) = r(\\theta)^2 + \\left(\\frac{dr}{d\\theta}\\right)^2$ 和 $B(\\theta) = \\frac{1}{\\sqrt{G(\\theta)}}$，我们可以将算子等价地重写为\n$$\n\\Delta_s u = B(\\theta)\\left( \\frac{d B}{d\\theta} \\frac{\\partial u}{\\partial \\theta} + B(\\theta) \\frac{\\partial^2 u}{\\partial \\theta^2} \\right) + \\frac{\\partial^2 u}{\\partial z^2}.\n$$\n对于所选的 $r(\\theta)$，其精确导数为 $r'(\\theta) = \\varepsilon \\cos\\theta$ 以及\n$$\nG(\\theta) = R_0^2 + \\varepsilon^2 + 2 R_0 \\varepsilon \\sin\\theta,\\quad B(\\theta) = \\left(R_0^2 + \\varepsilon^2 + 2 R_0 \\varepsilon \\sin\\theta\\right)^{-1/2},\n$$\n$$\n\\frac{dB}{d\\theta} = - \\frac{R_0 \\varepsilon \\cos\\theta}{\\left(R_0^2 + \\varepsilon^2 + 2 R_0 \\varepsilon \\sin\\theta\\right)^{3/2}}.\n$$\n\n您的任务是在 $\\theta$ 和 $z$ 方向上的均匀周期性网格上，实现 $\\Delta_s u$ 的两种离散近似：\n\n1. 一种“精确度量”离散化方法，该方法对 $B(\\theta)$ 和 $\\frac{dB}{d\\theta}$ 使用解析表达式，并对 $\\frac{\\partial u}{\\partial \\theta}$、$\\frac{\\partial^2 u}{\\partial \\theta^2}$ 和 $\\frac{\\partial^2 u}{\\partial z^2}$ 使用二阶中心有限差分。\n\n2. 一种“朴素度量”离散化方法，该方法纯粹使用一阶向前差分从离散几何中计算几何度量，具体而言\n   - 通过向前差分近似 $r'(\\theta)$：$r'(\\theta_i) \\approx \\frac{r(\\theta_{i+1}) - r(\\theta_i)}{\\Delta\\theta}$，\n   - 构建 $G(\\theta_i) = r(\\theta_i)^2 + \\left(r'(\\theta_i)\\right)^2$ 和 $B(\\theta_i) = \\frac{1}{\\sqrt{G(\\theta_i)}}$，\n   - 通过向前差分近似 $\\frac{dB}{d\\theta}$：$\\frac{dB}{d\\theta}(\\theta_i) \\approx \\frac{B(\\theta_{i+1}) - B(\\theta_i)}{\\Delta\\theta}$，\n   同时仍然对 $u$ 的导数使用二阶中心有限差分。\n\n对于每种离散化方法，在网格上计算离散算子 $\\Delta_{s,h} u$ 的值，并使用 $u$ 的解析表达式和导数计算 $\\Delta_s u(\\theta_i,z_j)$ 的逐点精确值。然后计算离散均方根（RMS）误差\n$$\nE_h = \\left( \\frac{1}{N_\\theta N_z} \\sum_{i=0}^{N_\\theta - 1} \\sum_{j=0}^{N_z - 1} \\left[ \\Delta_{s,h} u(\\theta_i,z_j) - \\Delta_s u(\\theta_i,z_j) \\right]^2 \\right)^{1/2}.\n$$\n\n为测量观察到的收敛率，请使用三个连续加密的网格，并对 $\\log E_h$ 与 $\\log h$ 进行线性回归，其中 $h = \\Delta\\theta = \\frac{2\\pi}{N_\\theta}$ 是角向网格间距。该拟合的斜率即为观察到的阶数 $p$。\n\n实现一个程序，对以下四个测试用例执行此过程（所有角度均以弧度为单位，所有长度均使用相同的任意单位）：\n\n- 情况 A（理想情况）：$R_0 = 1.0$, $\\varepsilon = 0.1$, $L = 1.0$，使用网格 $(N_\\theta,N_z) = (32,32)$, $(64,64)$, $(128,128)$。\n- 情况 B（强扰动）：$R_0 = 1.0$, $\\varepsilon = 0.5$, $L = 1.0$，使用网格 $(N_\\theta,N_z) = (32,32)$, $(64,64)$, $(128,128)$。\n- 情况 C（无扰动的边界条件）：$R_0 = 1.0$, $\\varepsilon = 0.0$, $L = 1.0$，使用网格 $(N_\\theta,N_z) = (32,32)$, $(64,64)$, $(128,128)$。\n- 情况 D（不同轴向周期）：$R_0 = 2.0$, $\\varepsilon = 0.2$, $L = 3.0$，使用网格 $(N_\\theta,N_z) = (32,32)$, $(64,64)$, $(128,128)$。\n\n您的程序应生成单行输出，其中包含观察到的收敛率，格式为方括号内以逗号分隔的列表，顺序如下\n$$\n[\\;p_{\\text{naive},A},\\;p_{\\text{exact},A},\\;p_{\\text{naive},B},\\;p_{\\text{exact},B},\\;p_{\\text{naive},C},\\;p_{\\text{exact},C},\\;p_{\\text{naive},D},\\;p_{\\text{exact},D}\\;].\n$$\n每个 $p$ 都必须是浮点数。不应产生任何其他输出。",
            "solution": "用户希望分析在受扰动的圆柱面上，拉普拉斯-贝尔特拉米算子的两种不同数值离散方法的精度阶。\n\n### 第 1 步：问题验证\n\n该问题经过了严格的验证过程。\n\n- **提取已知条件**：所有提供的信息，包括圆柱面的参数化 $r(\\theta) = R_0 + \\varepsilon \\sin\\theta$、度量张量的分量（$g_{\\theta\\theta}$、$g_{zz}$）、拉普拉斯-贝尔特拉米算子的简化形式 $\\Delta_s u = B(\\theta)( \\frac{d B}{d\\theta} \\frac{\\partial u}{\\partial \\theta} + B(\\theta) \\frac{\\partial^2 u}{\\partial \\theta^2} ) + \\frac{\\partial^2 u}{\\partial z^2}$、人造解 $u(\\theta,z) = \\sin(3\\theta)\\cos(\\frac{2\\pi}{L} z)$、两种离散化方案（“精确度量”和“朴素度量”）的定义、误差度量（均方根误差）、确定收敛率的方法（对数-对数线性回归），以及具体的测试用例（参数和网格尺寸）均已被适当记录。所有为 $G(\\theta)$、$B(\\theta)$ 和 $\\frac{dB}{d\\theta}$ 提供的解析表达式已经过验证且正确无误。\n\n- **验证检查**：\n    1.  **科学依据**：该问题在根本上是合理的，植根于微分几何（度量张量、拉普拉斯-贝尔特拉米算子）和数值分析（人造解方法、有限差分法、收敛性研究）的既定原理。这是计算物理和工程领域中一项标准的验证与确认（V\n    2.  **适定性**：该任务是适定的。它要求根据一组给定的输入和明确的方法，计算一个具体的、明确定义的数值量（观察到的精度阶）。收敛率存在唯一且稳定的解。\n    3.  **客观性**：该问题使用精确、无歧义的数学术语进行规定。没有主观内容。\n    4.  **完整性与一致性**：所有必需的公式、参数和边界条件（周期性）均已提供。该问题是自洽的。对度量项 $B(\\theta)$ 的分母，即 $G(\\theta) = (R_0 - \\varepsilon)^2 + 2R_0\\varepsilon(1+\\sin\\theta)$ 进行检查，确认其对于所有 $\\varepsilon>0$ 的测试用例均为严格正值，因为 $R_0 > \\varepsilon$ 总是满足。对于 $\\varepsilon=0$，它也为正值。因此，不会发生除以零的情况。\n    5.  **可行性**：所需的计算在数值上是可行的，并且完全在标准科学计算库的能力范围之内。参数是物理上合理的。\n\n- **结论**：该问题被评估为**有效**。这是一个在应用于计算流体动力学（CFD）相关背景下的数值分析问题，其表述清晰、科学合理。\n\n### 第 2 步：求解推导与算法设计\n\n问题的核心是计算两种方案的观察收敛阶 $p$，方法是在三个网格序列上计算均方根误差 $E_h$，并求出 $\\log E_h$ 相对于 $\\log h$ 的斜率，其中 $h = \\Delta\\theta$。\n\n**A. 解析参考解**\n将精确的拉普拉斯-贝尔特拉米算子应用于人造解 $u(\\theta,z)$ 的结果，是误差计算所需的基准。给定 $u(\\theta,z) = \\sin(3\\theta)\\cos(kz)$，其中 $k = 2\\pi/L$，其偏导数为：\n$$\n\\frac{\\partial u}{\\partial \\theta} = 3\\cos(3\\theta)\\cos(kz), \\quad \\frac{\\partial^2 u}{\\partial \\theta^2} = -9\\sin(3\\theta)\\cos(kz), \\quad \\frac{\\partial^2 u}{\\partial z^2} = -k^2\\sin(3\\theta)\\cos(kz).\n$$\n将这些导数代入算子的给定形式 $\\Delta_s u = B(\\theta)\\left( \\frac{dB}{d\\theta} \\frac{\\partial u}{\\partial \\theta} + B(\\theta) \\frac{\\partial^2 u}{\\partial \\theta^2} \\right) + \\frac{\\partial^2 u}{\\partial z^2}$，即可得到在任意点 $(\\theta, z)$ 的精确值：\n$$\n\\Delta_s u(\\theta,z) = \\left[ B(\\theta)\\left( \\frac{dB}{d\\theta} (3\\cos(3\\theta)) - 9B(\\theta)\\sin(3\\theta) \\right) - k^2\\sin(3\\theta) \\right] \\cos(kz).\n$$\n项 $B(\\theta)$ 和 $\\frac{dB}{d\\theta}$ 使用问题陈述中的解析公式计算。该表达式将在网格上进行评估，作为误差计算的精确解。\n\n**B. 数值离散化**\n一个均匀周期性网格由 $\\theta_i = i \\Delta\\theta$ 和 $z_j = j \\Delta z$ 定义，其中 $\\Delta\\theta = 2\\pi/N_\\theta$ 且 $\\Delta z = L/N_z$。在此网格上，任何函数 $f(\\theta_i, z_j)$ 表示为一个二维数组 $f_{i,j}$。\n\n$u$ 的导数所需的二阶中心有限差分近似（考虑周期性）为：\n$$\n\\left(\\frac{\\partial u}{\\partial \\theta}\\right)_{i,j} \\approx \\frac{u_{i+1,j} - u_{i-1,j}}{2\\Delta\\theta}\n$$\n$$\n\\left(\\frac{\\partial^2 u}{\\partial \\theta^2}\\right)_{i,j} \\approx \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{(\\Delta\\theta)^2}\n$$\n$$\n\\left(\\frac{\\partial^2 u}{\\partial z^2}\\right)_{i,j} \\approx \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{(\\Delta z)^2}\n$$\n这些将使用 `numpy.roll` 来高效实现，以处理周期性边界条件。\n\n**C. 方案实现**\n\n1.  **精确度量方案**：该方案将 $u$ 的数值计算导数与解析计算的度量系数相结合。\n    -   使用精确公式为网格上的每个 $\\theta_i$ 计算度量项 $B(\\theta_i)$ 和 $\\frac{dB}{d\\theta}(\\theta_i)$。\n    -   离散算子组装如下：\n        $\\Delta_{s,h} u = B_{\\text{exact}} \\left( \\frac{dB}{d\\theta}_{\\text{exact}} \\left(\\frac{\\partial u}{\\partial \\theta}\\right)_h + B_{\\text{exact}} \\left(\\frac{\\partial^2 u}{\\partial \\theta^2}\\right)_h \\right) + \\left(\\frac{\\partial^2 u}{\\partial z^2}\\right)_h$。\n    -   截断误差主要由 $u$ 的有限差分所带来的 $O(h^2)$ 误差决定。因此，我们预期收敛率 $p \\approx 2$。\n\n2.  **朴素度量方案**：该方案对度量项使用低阶数值近似。\n    -   在每个点 $\\theta_i$， $r'_i$ 通过一阶向前差分近似：$r'_i \\approx (r_{i+1} - r_i)/\\Delta\\theta$。\n    -   这用于计算“朴素”的 $G_i = r_i^2 + (r'_i)^2$ 和 $B_i = 1/\\sqrt{G_i}$。\n    -   然后，$\\frac{dB}{d\\theta}$ 也通过一阶向前差分近似：$(\\frac{dB}{d\\theta})_i \\approx (B_{i+1} - B_i)/\\Delta\\theta$。\n    -   离散算子以类似方式组装，但使用这些朴素度量项 $B_{\\text{naive}}$ 和 $(\\frac{dB}{d\\theta})_{\\text{naive}}$。\n    -   总体精度将受到度量计算中引入的一阶 $O(h)$ 误差的限制。因此，我们预期收敛率 $p \\approx 1$。\n    -   一个例外是情况 C ($\\varepsilon=0$)，此时几何形状为完美圆柱体。对于常数半径 $r(\\theta)=R_0$，$r'$ 和 $dB/d\\theta$ 的一阶向前差分计算结果都恰好为零，这与正确的解析值相符。在这种特殊情况下，朴素度量方案变得与精确度量方案完全相同，两者均预期以二阶收敛（$p \\approx 2$）。\n\n**D. 收敛率计算**\n对于每个测试用例和每个方案，步骤如下：\n1.  对于三种网格分辨率，计算均方根误差 $E_h = \\sqrt{\\frac{1}{N_\\theta N_z}\\sum_{i,j} (\\Delta_{s,h}u_{i,j} - \\Delta_s u(\\theta_i,z_j))^2}$，得到 $(E_{h_1}, E_{h_2}, E_{h_3})$。\n2.  对应的网格间距为 $h_k = 2\\pi/N_{\\theta,k}$。\n3.  对点 $(\\log(h_k), \\log(E_{h_k}))$ 进行线性回归。该直线的斜率即为观察到的精度阶 $p$。此步骤使用 `scipy.stats.linregress` 函数。\n\n最终的程序将对所有四个测试用例系统地执行这整个过程，并按指定格式输出八个得到的收敛率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Computes the observed convergence rates for two discretizations\n    of the Laplace-Beltrami operator on a perturbed cylinder.\n    \"\"\"\n    test_cases = [\n        # (R0, epsilon, L)\n        (1.0, 0.1, 1.0),  # Case A\n        (1.0, 0.5, 1.0),  # Case B\n        (1.0, 0.0, 1.0),  # Case C\n        (2.0, 0.2, 3.0),  # Case D\n    ]\n    grid_resolutions = [(32, 32), (64, 64), (128, 128)]\n    \n    all_convergence_rates = []\n\n    for R0, eps, L in test_cases:\n        errors_naive = []\n        errors_exact = []\n        h_values = []\n\n        for N_theta, N_z in grid_resolutions:\n            # 1. Grid setup\n            d_theta = 2.0 * np.pi / N_theta\n            d_z = L / N_z\n            h_values.append(d_theta)\n\n            theta_1d = np.linspace(0.0, 2.0 * np.pi, N_theta, endpoint=False)\n            z_1d = np.linspace(0.0, L, N_z, endpoint=False)\n            THETA, Z = np.meshgrid(theta_1d, z_1d, indexing='ij')\n\n            k = 2.0 * np.pi / L\n\n            # 2. Manufactured solution and its analytical derivatives\n            u = np.sin(3.0 * THETA) * np.cos(k * Z)\n            u_theta = 3.0 * np.cos(3.0 * THETA) * np.cos(k * Z)\n            u_thetatheta = -9.0 * np.sin(3.0 * THETA) * np.cos(k * Z)\n            u_zz = -(k**2) * u\n\n            # 3. Analytical Laplace-Beltrami operator evaluation\n            G_analytic = R0**2 + eps**2 + 2.0 * R0 * eps * np.sin(THETA)\n            B_analytic = G_analytic**(-0.5)\n            dBdtheta_analytic = -R0 * eps * np.cos(THETA) * G_analytic**(-1.5)\n            \n            lap_u_analytic = B_analytic * (dBdtheta_analytic * u_theta + B_analytic * u_thetatheta) + u_zz\n\n            # 4. Numerical derivatives of u (2nd-order centered differences)\n            u_ip1 = np.roll(u, -1, axis=0) # i+1\n            u_im1 = np.roll(u, 1, axis=0)  # i-1\n            u_jp1 = np.roll(u, -1, axis=1) # j+1\n            u_jm1 = np.roll(u, 1, axis=1)  # j-1\n            \n            du_dtheta_h = (u_ip1 - u_im1) / (2.0 * d_theta)\n            d2u_dtheta2_h = (u_ip1 - 2.0 * u + u_im1) / (d_theta**2)\n            d2u_dz2_h = (u_jp1 - 2.0 * u + u_jm1) / (d_z**2)\n            \n            # --- Scheme 1: \"Exact-Metric\" Discretization ---\n            G_exact_1d = R0**2 + eps**2 + 2.0 * R0 * eps * np.sin(theta_1d)\n            B_exact_1d = G_exact_1d**(-0.5)\n            dBdtheta_exact_1d = -R0 * eps * np.cos(theta_1d) * G_exact_1d**(-1.5)\n            \n            # Broadcast metric terms to 2D grid shape\n            B_exact = B_exact_1d[:, np.newaxis]\n            dBdtheta_exact = dBdtheta_exact_1d[:, np.newaxis]\n            \n            lap_u_h_exact = B_exact * (dBdtheta_exact * du_dtheta_h + B_exact * d2u_dtheta2_h) + d2u_dz2_h\n            \n            error_exact = np.sqrt(np.mean((lap_u_h_exact - lap_u_analytic)**2))\n            errors_exact.append(error_exact)\n\n            # --- Scheme 2: \"Naive-Metric\" Discretization ---\n            r_vals = R0 + eps * np.sin(theta_1d)\n            # 1st-order forward difference for r'\n            rp_naive = (np.roll(r_vals, -1) - r_vals) / d_theta\n            \n            G_naive_1d = r_vals**2 + rp_naive**2\n            B_naive_1d = G_naive_1d**(-0.5)\n            # 1st-order forward difference for B'\n            dBdtheta_naive_1d = (np.roll(B_naive_1d, -1) - B_naive_1d) / d_theta\n            \n            # Broadcast metric terms to 2D grid shape\n            B_naive = B_naive_1d[:, np.newaxis]\n            dBdtheta_naive = dBdtheta_naive_1d[:, np.newaxis]\n\n            lap_u_h_naive = B_naive * (dBdtheta_naive * du_dtheta_h + B_naive * d2u_dtheta2_h) + d2u_dz2_h\n\n            error_naive = np.sqrt(np.mean((lap_u_h_naive - lap_u_analytic)**2))\n            errors_naive.append(error_naive)\n\n        # 5. Convergence analysis via log-log linear regression\n        log_h = np.log(h_values)\n        \n        # Naive scheme rate\n        log_err_naive = np.log(errors_naive)\n        p_naive = stats.linregress(log_h, log_err_naive).slope\n        \n        # Exact scheme rate\n        log_err_exact = np.log(errors_exact)\n        p_exact = stats.linregress(log_h, log_err_exact).slope\n        \n        all_convergence_rates.extend([p_naive, p_exact])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_convergence_rates))}]\")\n\nsolve()\n```"
        }
    ]
}