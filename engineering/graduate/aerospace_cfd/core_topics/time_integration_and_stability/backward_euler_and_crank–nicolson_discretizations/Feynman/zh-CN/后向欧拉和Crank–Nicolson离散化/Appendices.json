{
    "hands_on_practices": [
        {
            "introduction": "理论是数值分析的基石，但只有通过实践才能真正内化。本练习旨在验证 Crank-Nicolson (CN) 格式最关键的特性之一：其在时间上的二阶精度。我们将该格式应用于一个由热方程简化的常微分方程模型，该模型具有已知的精确解。通过计算不同时间步长下的离散化误差，您将亲眼见证误差如何随着时间步长 $\\Delta t$ 的减小而呈二次方收敛，这是理解数值方法收敛阶的核心实践 。",
            "id": "3945392",
            "problem": "考虑在计算流体动力学 (CFD) 中广泛使用的一维热传导方程 $u_t = \\alpha u_{xx}$，该方程定义在周期性域 $x \\in [0,2\\pi]$ 上，其中热扩散率 $\\alpha > 0$。对于初始条件 $u(x,0) = \\sin(m x)$，其中波数 $m \\geq 0$ 为整数（角度以弧度为单位），作用于该正弦模态的空间算子是精确的，其傅里叶振幅 $a(t)$ 满足标量常微分方程 $a'(t) = -\\lambda a(t)$，其中 $\\lambda = \\alpha m^2$。精确解为 $a(t) = \\exp(-\\lambda t)a(0)$。\n\n您的任务是编写一个完整、可运行的程序，该程序能够：\n- 使用 Crank-Nicolson 格式，通过 $N$ 个大小为 $\\Delta t$ 的均匀时间步长，对标量振幅 $a(t)$ 进行时间积分，直至最终时间 $T$（假设 $T$ 是 $\\Delta t$ 的整数倍，因此 $N = T/\\Delta t$ 是一个整数）。\n- 计算在最终时间 $T$ 的时间离散误差大小 $E(\\Delta t) = |a_{\\text{CN}}(T) - a_{\\text{exact}}(T)|$。其中，$a_{\\text{CN}}(T)$ 是从 $a(0) = 1$ 开始，对标量常微分方程应用 Crank-Nicolson 格式 $N$ 步后得到的近似值，而 $a_{\\text{exact}}(T) = \\exp(-\\lambda T)$。\n- 通过报告特定测试用例的比率 $E(\\Delta t)/\\Delta t^2$ 来量化二阶时间步长缩放特性。\n\n使用以下参数值测试套件（每个测试用例由 $(\\alpha, m, T, \\Delta t)$ 指定）：\n- 用例 1（缩放量化，三个 $\\Delta t$ 值）：$(\\alpha, m, T, \\Delta t) = (0.5, 3, 1.0, 0.2)$、$(0.5, 3, 1.0, 0.1)$、$(0.5, 3, 1.0, 0.05)$。\n- 用例 2（边界情况 $m=0$，意味着 $\\lambda=0$）：$(\\alpha, m, T, \\Delta t) = (0.7, 0, 1.0, 0.25)$。\n- 用例 3（边界情况 $T=0$）：$(\\alpha, m, T, \\Delta t) = (1.0, 4, 0.0, 0.1)$。\n- 用例 4（大时间步长但稳定）：$(\\alpha, m, T, \\Delta t) = (1.0, 1, 2.0, 1.0)$。\n\n所有量均为无量纲。角度必须以弧度为单位进行解释。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果的顺序必须严格如下：\n$[E(0.2)/0.2^2,\\;E(0.1)/0.1^2,\\;E(0.05)/0.05^2,\\;E_{\\text{case 2}}/0.25^2,\\;E_{\\text{case 3}}/0.1^2,\\;E_{\\text{case 4}}/1.0^2]$。\n\n最终输出必须是浮点数。",
            "solution": "该问题是有效的。这是一个适定的、有科学依据的关于常微分方程 (ODE) 数值分析的练习，这类问题源于计算流体动力学中对偏微分方程 (PDE) 的研究。所有必要的参数和条件都已给出，问题没有任何矛盾或含糊之处。\n\n任务是分析将 Crank-Nicolson 格式应用于一个模型问题时的时间离散误差。这个模型问题是控制一维热传导方程单个傅里叶模态振幅的标量常微分方程。\n\n热传导方程为 $u_t = \\alpha u_{xx}$。对于周期性域上的单个傅里叶模态初始条件 $u(x,0) = \\sin(m x)$，解将保持其空间形式 $u(x,t) = a(t)\\sin(m x)$。将其代入偏微分方程（PDE）可得到关于振幅 $a(t)$ 的常微分方程（ODE）：\n$$\n\\frac{d}{dt}(a(t)\\sin(m x)) = \\alpha \\frac{\\partial^2}{\\partial x^2}(a(t)\\sin(m x))\n$$\n$$\na'(t)\\sin(m x) = \\alpha a(t) (-m^2 \\sin(m x))\n$$\n$$\na'(t) = -(\\alpha m^2) a(t)\n$$\n这就是模型 ODE $a'(t) = -\\lambda a(t)$，其中衰减率 $\\lambda = \\alpha m^2$。\n问题指定初始振幅为 $a(0) = 1$。该初值问题的精确解为：\n$$\na_{\\text{exact}}(t) = a(0) e^{-\\lambda t} = e^{-\\lambda t}\n$$\n在最终时间 $T$，精确解为 $a_{\\text{exact}}(T) = e^{-\\lambda T}$。\n\n我们需要使用 Crank-Nicolson 时间积分格式来近似求解。设 $a^n$ 是 $a(t_n)$ 的数值近似，其中 $t_n = n\\Delta t$。对于 ODE $a' = f(a) = -\\lambda a$，Crank-Nicolson 格式是一种隐式方法，它对 $t_n$ 和 $t_{n+1}$ 时刻的导数进行平均：\n$$\n\\frac{a^{n+1} - a^n}{\\Delta t} = \\frac{1}{2} \\left[ f(a^{n+1}) + f(a^n) \\right]\n$$\n代入 $f(a) = -\\lambda a$：\n$$\n\\frac{a^{n+1} - a^n}{\\Delta t} = \\frac{1}{2} \\left[ (-\\lambda a^{n+1}) + (-\\lambda a^n) \\right]\n$$\n为了找到更新规则，我们求解 $a^{n+1}$：\n$$\na^{n+1} - a^n = -\\frac{\\lambda \\Delta t}{2} (a^{n+1} + a^n)\n$$\n$$\na^{n+1} \\left(1 + \\frac{\\lambda \\Delta t}{2}\\right) = a^n \\left(1 - \\frac{\\lambda \\Delta t}{2}\\right)\n$$\n$$\na^{n+1} = \\left( \\frac{1 - \\frac{\\lambda \\Delta t}{2}}{1 + \\frac{\\lambda \\Delta t}{2}} \\right) a^n\n$$\n这个递推关系可以求解。从 $a^0 = a(0) = 1$ 开始，经过 $N$ 步（其中 $N=T/\\Delta t$）后的解为：\n$$\na_{\\text{CN}}(T) = a^N = \\left( \\frac{1 - \\frac{\\lambda \\Delta t}{2}}{1 + \\frac{\\lambda \\Delta t}{2}} \\right)^N a^0 = \\left( \\frac{1 - \\frac{\\lambda \\Delta t}{2}}{1 + \\frac{\\lambda \\Delta t}{2}} \\right)^N\n$$\n在最终时间 $T$ 的时间离散误差定义为数值解与精确解之差的绝对值：\n$$\nE(\\Delta t) = |a_{\\text{CN}}(T) - a_{\\text{exact}}(T)|\n$$\nCrank-Nicolson 格式在时间上是二阶精确的，这意味着对于小的 $\\Delta t$，误差 $E(\\Delta t)$ 预期与 $\\Delta t^2$ 成正比，即 $E(\\Delta t) \\approx C \\Delta t^2$，其中 $C$ 是一个依赖于问题参数但不依赖于 $\\Delta t$ 的常数。为验证这一点，我们计算比率 $E(\\Delta t) / \\Delta t^2$。对于一个二阶格式，当 $\\Delta t \\to 0$ 时，这个比率应该近似为一个常数。\n\n特定的测试用例将按如下方式进行评估：\n对于每个元组 $(\\alpha, m, T, \\Delta t)$：\n1. 计算衰减率 $\\lambda = \\alpha m^2$。\n2. 计算时间步数 $N = T/\\Delta t$。如果 $T=0$，则 $N=0$。如果 $m=0$，则 $\\lambda=0$。\n3. 计算精确解 $a_{\\text{exact}}(T) = e^{-\\lambda T}$。\n4. 计算数值解 $a_{\\text{CN}}(T) = \\left( \\frac{1 - 0.5\\lambda \\Delta t}{1 + 0.5\\lambda \\Delta t} \\right)^N$。如果 $\\lambda=0$ 或 $T=0$，这个表达式可以正确地简化。对于 $\\lambda=0$，分数值为 $1$，$a_{\\text{CN}}(T)=1$。对于 $T=0$，$N=0$，$a_{\\text{CN}}(T)=1$（因为任何非零底数的 0 次方都为 1）。\n5. 计算误差 $E(\\Delta t) = |a_{\\text{CN}}(T) - a_{\\text{exact}}(T)|$。\n6. 计算最终所需的比率 $E(\\Delta t) / \\Delta t^2$。在 $E(\\Delta t)=0$ 的情况下，该比率为 $0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the second-order time-step scaling ratio for a Crank-Nicolson\n    discretization of a model ODE derived from the 1D heat equation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (alpha, m, T, dt).\n    test_cases = [\n        (0.5, 3, 1.0, 0.2),\n        (0.5, 3, 1.0, 0.1),\n        (0.5, 3, 1.0, 0.05),\n        (0.7, 0, 1.0, 0.25),\n        (1.0, 4, 0.0, 0.1),\n        (1.0, 1, 2.0, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha, m, T, dt = case\n\n        # 1. Calculate the decay rate lambda\n        lambda_val = alpha * m**2\n\n        # 2. Calculate the number of time steps N.\n        # The problem statement guarantees T is an integer multiple of dt.\n        # To be robust with floating point, we can round, but int(T/dt) is sufficient here.\n        if T == 0.0:\n            N = 0\n        else:\n            N = int(T / dt)\n\n        # 3. Compute the exact solution at time T.\n        # The initial condition is a(0) = 1.\n        a_exact = np.exp(-lambda_val * T)\n\n        # 4. Compute the numerical solution using Crank-Nicolson.\n        # The update is a^{n+1} = g_cn * a^n, where g_cn is the amplification factor.\n        # So a_cn(T) = (g_cn)^N * a(0).\n        # Handle the case where the denominator could be zero, though not possible\n        # for lambda >= 0.\n        denominator = 1.0 + 0.5 * lambda_val * dt\n        if denominator == 0:\n            # This physical scenario is not expected but included for robustness.\n            # It would imply infinite amplification.\n            # For this problem, lambda_val >= 0 and dt > 0, so denominator > 1.\n            a_cn = float('inf')\n        else:\n            g_cn = (1.0 - 0.5 * lambda_val * dt) / denominator\n            a_cn = g_cn**N\n\n        # 5. Compute the error magnitude.\n        error = abs(a_cn - a_exact)\n\n        # 6. Compute the second-order scaling ratio.\n        # The denominator dt**2 is guaranteed to be non-zero by the problem's dt > 0.\n        ratio = error / (dt**2)\n        results.append(ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在验证了 CN 格式对扩散类问题的卓越精度后，我们必须认识到其应用的局限性。本练习将展示一个经典的反例：将标准的 CN 格式与中心差分联用求解一个纯对流问题。通过追踪一个尖锐阶跃初值的演化，您将计算出解中出现的非物理振荡（下冲和过冲）。这个结果突显了该格式在处理双曲型问题时缺乏数值耗散的本质缺陷，尤其是在高 Courant 数条件下 。",
            "id": "3945376",
            "problem": "考虑线性平流守恒律 $\\partial_{t} u + a \\,\\partial_{x} u = 0$，其中对流速度 $a > 0$ 为常数，定义在一个周期性域上，该域由 4 个均匀间隔的节点离散化，节点索引为 $j \\in \\{0,1,2,3\\}$，间距为 $\\Delta x$。令 $u_{j}^{n}$ 表示在时间层 $t^{n}$ 的节点解。对空间导数使用二阶中心有限差分，即 $\\partial_{x} u \\approx \\left(u_{j+1}^{n} - u_{j-1}^{n}\\right)/(2 \\Delta x)$，并采用周期性索引。应用 Crank-Nicolson 时间离散化方法，将解从 $t^{0}$ 推进到 $t^{1} = t^{0} + \\Delta t$。\n\n定义 Courant–Friedrichs–Lewy (CFL) 数 $C = a \\,\\Delta t/\\Delta x$，并设 $C = 4$。设初始数据为在 4 节点周期性网格上的离散阶跃函数：$u_{0}^{0} = 1$, $u_{1}^{0} = 1$, $u_{2}^{0} = 0$, $u_{3}^{0} = 0$。从守恒律和给定的离散空间算子出发，推导一个时间步的 Crank-Nicolson 更新格式，并计算在 $t^{1}$ 时的节点值 $u_{j}^{1}$。证明该格式在这种对流主导的情况下会产生下冲和上冲。\n\n报告 $j \\in \\{0,1,2,3\\}$ 中 $u_{j}^{1}$ 的最大值，结果表示为一个最简分数。无需单位。无需四舍五入。",
            "solution": "对问题陈述的分析表明，该问题具有科学依据、是适定的、客观且完整的。解决该问题所需的所有数据和定义都已提供，并且其设置符合偏微分方程数值分析的标准原则。因此，该问题被认为是有效的。\n\n控制方程是线性平流守恒律：\n$$\n\\partial_{t} u + a \\,\\partial_{x} u = 0\n$$\n其中 $a > 0$ 是一个恒定的对流速度。\n\n问题指定使用 Crank-Nicolson 方法进行时间离散化。对于形式为 $\\frac{du}{dt} = F(u)$ 的常微分方程，Crank-Nicolson 格式为：\n$$\n\\frac{u^{n+1} - u^{n}}{\\Delta t} = \\frac{1}{2} \\left( F(u^{n+1}) + F(u^{n}) \\right)\n$$\n在我们的例子中，$F(u) = -a \\,\\partial_{x} u$。将其应用于节点值 $u_j$，我们得到：\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = -\\frac{a}{2} \\left( (\\partial_{x} u)_{j}^{n+1} + (\\partial_{x} u)_{j}^{n} \\right)\n$$\n空间导数 $\\partial_{x} u$ 使用二阶中心有限差分进行近似：\n$$\n(\\partial_{x} u)_{j} \\approx \\frac{u_{j+1} - u_{j-1}}{2 \\Delta x}\n$$\n将此空间离散化代入 Crank-Nicolson 公式中，得到：\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = -\\frac{a}{2} \\left( \\frac{u_{j+1}^{n+1} - u_{j-1}^{n+1}}{2 \\Delta x} + \\frac{u_{j+1}^{n} - u_{j-1}^{n}}{2 \\Delta x} \\right)\n$$\n乘以 $\\Delta t$ 并重新整理各项，将时间层 $n+1$ 的未知数放在左侧 (LHS)，时间层 $n$ 的已知数放在右侧 (RHS)：\n$$\nu_{j}^{n+1} + \\frac{a \\Delta t}{4 \\Delta x} (u_{j+1}^{n+1} - u_{j-1}^{n+1}) = u_{j}^{n} - \\frac{a \\Delta t}{4 \\Delta x} (u_{j+1}^{n} - u_{j-1}^{n})\n$$\n我们已知 Courant–Friedrichs–Lewy (CFL) 数 $C = \\frac{a \\Delta t}{\\Delta x}$。将此定义代入方程：\n$$\nu_{j}^{n+1} + \\frac{C}{4} u_{j+1}^{n+1} - \\frac{C}{4} u_{j-1}^{n+1} = u_{j}^{n} - \\frac{C}{4} u_{j+1}^{n} + \\frac{C}{4} u_{j-1}^{n}\n$$\n问题指定 $C=4$。更新方程简化为：\n$$\nu_{j}^{n+1} + u_{j+1}^{n+1} - u_{j-1}^{n+1} = u_{j}^{n} - u_{j+1}^{n} + u_{j-1}^{n}\n$$\n我们需要根据 $t^{0}$ 时的初始数据 $u_{j}^{0}$ 求解 $t^{1}$ 时的节点值 $u_{j}^{1}$。网格有 4 个节点，索引为 $j \\in \\{0,1,2,3\\}$，具有周期性边界条件。这意味着索引是模 4 的，例如 $u_{-1} = u_{3}$ 和 $u_{4} = u_{0}$。\n\n让我们写出关于未知数 $\\mathbf{u}^{1} = [u_{0}^{1}, u_{1}^{1}, u_{2}^{1}, u_{3}^{1}]^T$ 的线性方程组。\n\n对于 $j=0$：\n$u_{0}^{1} + u_{1}^{1} - u_{-1}^{1} = u_{0}^{0} - u_{1}^{0} + u_{-1}^{0}$\n使用周期性 ($u_{-1}=u_3$)：\n$u_{0}^{1} + u_{1}^{1} - u_{3}^{1} = u_{0}^{0} - u_{1}^{0} + u_{3}^{0} = 1 - 1 + 0 = 0$\n\n对于 $j=1$：\n$u_{1}^{1} + u_{2}^{1} - u_{0}^{1} = u_{1}^{0} - u_{2}^{0} + u_{0}^{0} = 1 - 0 + 1 = 2$\n\n对于 $j=2$：\n$u_{2}^{1} + u_{3}^{1} - u_{1}^{1} = u_{2}^{0} - u_{3}^{0} + u_{1}^{0} = 0 - 0 + 1 = 1$\n\n对于 $j=3$：\n$u_{3}^{1} + u_{4}^{1} - u_{2}^{1} = u_{3}^{0} - u_{4}^{0} + u_{2}^{0}$\n使用周期性 ($u_{4}=u_0$)：\n$u_{3}^{1} + u_{0}^{1} - u_{2}^{1} = u_{3}^{0} - u_{0}^{0} + u_{2}^{0} = 0 - 1 + 0 = -1$\n\n得到的 4 个线性方程组是：\n1. $u_{0}^{1} + u_{1}^{1} - u_{3}^{1} = 0$\n2. $-u_{0}^{1} + u_{1}^{1} + u_{2}^{1} = 2$\n3. $-u_{1}^{1} + u_{2}^{1} + u_{3}^{1} = 1$\n4. $u_{0}^{1} - u_{2}^{1} + u_{3}^{1} = -1$\n\n我们来解这个方程组。\n从方程 (1) 中，我们可以用 $u_{0}^{1}$ 和 $u_{1}^{1}$ 表示 $u_{3}^{1}$：\n$u_{3}^{1} = u_{0}^{1} + u_{1}^{1}$\n\n将此代入方程 (3)：\n$-u_{1}^{1} + u_{2}^{1} + (u_{0}^{1} + u_{1}^{1}) = 1 \\implies u_{0}^{1} + u_{2}^{1} = 1$\n这给了我们 $u_{2}^{1} = 1 - u_{0}^{1}$。\n\n将 $u_{3}^{1}$ 的表达式代入方程 (4)：\n$u_{0}^{1} - u_{2}^{1} + (u_{0}^{1} + u_{1}^{1}) = -1 \\implies 2u_{0}^{1} - u_{2}^{1} + u_{1}^{1} = -1$\n现在，将 $u_{2}^{1}$ 的表达式代入这个新方程：\n$2u_{0}^{1} - (1 - u_{0}^{1}) + u_{1}^{1} = -1 \\implies 3u_{0}^{1} - 1 + u_{1}^{1} = -1 \\implies 3u_{0}^{1} + u_{1}^{1} = 0$\n这给了我们 $u_{1}^{1} = -3u_{0}^{1}$。\n\n现在我们已经用 $u_{0}^{1}$ 表示了 $u_{1}^{1}$、$u_{2}^{1}$ 和 $u_{3}^{1}$。我们使用剩下的方程 (2) 来求解 $u_{0}^{1}$：\n$-u_{0}^{1} + u_{1}^{1} + u_{2}^{1} = 2$\n代入 $u_{1}^{1}$ 和 $u_{2}^{1}$ 的表达式：\n$-u_{0}^{1} + (-3u_{0}^{1}) + (1 - u_{0}^{1}) = 2$\n$-5u_{0}^{1} + 1 = 2$\n$-5u_{0}^{1} = 1$\n$u_{0}^{1} = -\\frac{1}{5}$\n\n现在我们可以回代以找到其他节点值：\n$u_{1}^{1} = -3u_{0}^{1} = -3(-\\frac{1}{5}) = \\frac{3}{5}$\n$u_{2}^{1} = 1 - u_{0}^{1} = 1 - (-\\frac{1}{5}) = 1 + \\frac{1}{5} = \\frac{6}{5}$\n$u_{3}^{1} = u_{0}^{1} + u_{1}^{1} = -\\frac{1}{5} + \\frac{3}{5} = \\frac{2}{5}$\n\n在时间 $t^{1}$ 的解是向量 $\\mathbf{u}^{1} = [-\\frac{1}{5}, \\frac{3}{5}, \\frac{6}{5}, \\frac{2}{5}]^T$。\n\n初始数据的范围是 $u_{min}^{0}=0$ 到 $u_{max}^{0}=1$。计算出的 $t^{1}$ 时的解包含值 $u_{0}^{1} = -1/5$，低于初始最小值。这是一个下冲。解中还包含值 $u_{2}^{1} = 6/5 = 1.2$，高于初始最大值。这是一个上冲。因此，该格式产生了非物理振荡，这是中心差分格式用于对流主导问题时的典型特征，尤其是在高 CFL 数下。\n\n问题要求 $j \\in \\{0,1,2,3\\}$ 中 $u_{j}^{1}$ 的最大值。\n这些值的集合是 $\\{-\\frac{1}{5}, \\frac{3}{5}, \\frac{6}{5}, \\frac{2}{5}\\}$。\n比较这些分数：\n$-\\frac{1}{5} < \\frac{2}{5} < \\frac{3}{5} < \\frac{6}{5}$\n最大值是 $\\frac{6}{5}$。\n这符合要求，是一个最简分数。",
            "answer": "$$\\boxed{\\frac{6}{5}}$$"
        },
        {
            "introduction": "计算流体力学中的实际问题几乎都是非线性的，这为隐式格式的实施带来了额外的挑战。当将 Crank-Nicolson 格式应用于非线性偏微分方程时，每个时间步都将产生一个非线性代数方程组，无法直接求解。本高级练习将指导您使用牛顿法这一强大且标准的工具来求解该非线性系统。通过解决一个非线性对流-扩散-反应方程，您将获得处理这类问题的实践经验，而这也是许多真实 CFD 求解器中的核心步骤 。",
            "id": "3945416",
            "problem": "考虑一维无量纲对流-扩散-反应方程，这是航空航天计算流体动力学 (CFD) 中一个常见的标量模型，用于描述在空间区间 $x \\in [0,1]$ 和时间 $t \\ge 0$ 上定义的量 $u(x,t)$：\n$$\n\\frac{\\partial u}{\\partial t} + v(x,t)\\,\\frac{\\partial u}{\\partial x} \\;=\\; \\nu\\,\\frac{\\partial^2 u}{\\partial x^2} \\;+\\; \\sigma\\,u^3,\n$$\n该方程服从齐次狄利克雷边界条件 $u(0,t)=0$ 和 $u(1,t)=0$。假设所有变量均为无量纲。此处，$v(x,t)$ 是对流速度，$\\nu>0$ 是黏度系数，$\\sigma\\ge 0$ 是非线性反应系数。\n\n您将应用 Crank-Nicolson (CN) 时间离散化，从时间层 $t^n$ 到 $t^{n+1}=t^n+\\Delta t$ 进行单步时间推进，并采用滞后对流，即隐式项中的对流速度使用前一时间层的值进行计算。具体来说，使用 $v(x,t^n)=u(x,t^n)$ 作为滞后对流速度，并对空间导数使用中心差分：\n- 对于内部网格点 $x_i$ 的一阶导数，使用中心差分 $(u_{i+1}-u_{i-1})/(2\\Delta x)$。\n- 对于内部网格点 $x_i$ 的二阶导数，使用中心差分 $(u_{i+1}-2u_i+u_{i-1})/\\Delta x^2$。\n\n使用包含 $N$ 个点（包括边界）的均匀网格对空间进行离散化，网格间距为 $\\Delta x = 1/(N-1)$，并强制 $u_0 = u_{N-1} = 0$。令内部未知数为 $u_i$，其中 $i=1,2,\\dots,N-2$。将前一时间层的值记为 $u_i^n$，将未知的新时间层的值记为 $u_i^{n+1}$。\n\n使用 Crank-Nicolson 方法和滞后对流，根据下式构建每个内部网格点的非线性残差：\n$$\n\\frac{u^{n+1}-u^n}{\\Delta t} \\;+\\; \\frac{1}{2}\\left[v^*\\,\\frac{\\partial u^{n+1}}{\\partial x} + v^n\\,\\frac{\\partial u^n}{\\partial x}\\right]\n\\;=\\;\n\\frac{1}{2}\\left[\\nu\\,\\frac{\\partial^2 u^{n+1}}{\\partial x^2} + \\nu\\,\\frac{\\partial^2 u^n}{\\partial x^2}\\right]\n\\;+\\;\n\\frac{1}{2}\\left[\\sigma\\,(u^{n+1})^3 + \\sigma\\,(u^n)^3\\right],\n$$\n其中 $v^* = v^n = u^n$ 是滞后对流速度。离散残差是关于内部未知向量 $u^{n+1}$ 的向量函数，在解处为零。\n\n通过在给定的 $u^{n+1}$ 的初始猜测 $u^{(0)}$ 周围对残差进行线性化，定义一个求解非线性系统的牛顿步。令雅可比矩阵为残差相对于 $u^{n+1}$ 在 $u^{(0)}$ 处的导数，通过求解线性系统得到增量，并构建牛顿更新 $u^{(1)} = u^{(0)}$ 加上该增量。计算此单次牛顿步后残差二范数的缩减，定义为：\n$$\n\\rho \\;=\\; \\frac{\\left\\|R\\!\\left(u^{(1)}\\right)\\right\\|_2}{\\left\\|R\\!\\left(u^{(0)}\\right)\\right\\|_2},\n$$\n其中 $R(\\cdot)$ 是非线性残差向量，$\\|\\cdot\\|_2$ 是欧几里得范数。\n\n为以下测试套件实现上述过程，该套件指定了网格大小 $N$、时间步长 $\\Delta t$、黏度 $\\nu$、反应系数 $\\sigma$、前一时间层 $u^n(x)$ 以及 $u^{n+1}$ 的初始猜测 $u^{(0)}(x)$：\n\n- 测试用例 1（一般情况，中等非线性）：\n  - $N = 51$，$\\Delta t = 0.005$，$\\nu = 0.01$，$\\sigma = 1.0$。\n  - $u^n(x) = \\sin(\\pi x)$。\n  - $u^{(0)}(x) = u^n(x)$。\n\n- 测试用例 2（更强非线性及更大时间步长）：\n  - $N = 51$，$\\Delta t = 0.05$，$\\nu = 0.005$，$\\sigma = 5.0$。\n  - $u^n(x) = 0.5\\,\\sin(2\\pi x) + 0.25\\,\\sin(\\pi x)$。\n  - $u^{(0)}(x) = 0$（对于所有内部点）。\n\n- 测试用例 3（线性情况，零反应）：\n  - $N = 31$，$\\Delta t = 0.01$，$\\nu = 0.02$，$\\sigma = 0.0$。\n  - $u^n(x) = \\sin(\\pi x)$。\n  - $u^{(0)}(x) = 0$（对于所有内部点）。\n\n所有量均视为无量纲，无需物理单位。您的程序应计算每个测试用例的缩减因子 $\\rho$，并生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[\\rho_1,\\rho_2,\\rho_3]$。这些值必须是浮点数。按所述使用中心差分，并在所有时间和所有近似中强制执行 $u(0,t)=u(1,t)=0$。",
            "solution": "### 问题验证\n\n#### 步骤1：提取给定信息\n\n问题为一维对流-扩散-反应方程提供了以下关于量 $u(x,t)$ 的信息：\n-   **控制方程**: $\\frac{\\partial u}{\\partial t} + v(x,t)\\,\\frac{\\partial u}{\\partial x} \\;=\\; \\nu\\,\\frac{\\partial^2 u}{\\partial x^2} \\;+\\; \\sigma\\,u^3$\n-   **域**: $x \\in [0,1]$, $t \\ge 0$。\n-   **边界条件**: 齐次狄利克雷，$u(0,t)=0$ 和 $u(1,t)=0$。\n-   **对流速度**: $v(x,t) = u(x,t)$。\n-   **系数**: 黏度 $\\nu>0$，非线性反应 $\\sigma\\ge 0$。\n-   **时间离散化**: 从 $t^n$ 到 $t^{n+1}=t^n+\\Delta t$ 的 Crank-Nicolson 方法，具有滞后对流速度 $v^* = v^n = u^n$。离散方程为：\n    $$\n    \\frac{u^{n+1}-u^n}{\\Delta t} \\;+\\; \\frac{1}{2}\\left[u^n\\,\\frac{\\partial u^{n+1}}{\\partial x} + u^n\\,\\frac{\\partial u^n}{\\partial x}\\right]\n    \\;=\\;\n    \\frac{1}{2}\\left[\\nu\\,\\frac{\\partial^2 u^{n+1}}{\\partial x^2} + \\nu\\,\\frac{\\partial^2 u^n}{\\partial x^2}\\right]\n    \\;+\\;\n    \\frac{1}{2}\\left[\\sigma\\,(u^{n+1})^3 + \\sigma\\,(u^n)^3\\right]\n    $$\n-   **空间离散化**: 具有 $N$ 个点的均匀网格，间距 $\\Delta x = 1/(N-1)$。内部点为 $i=1, 2, \\dots, N-2$。边界节点为 $u_0 = u_{N-1} = 0$。\n    -   一阶导数（中心差分）：$\\frac{\\partial u}{\\partial x} \\approx \\frac{u_{i+1}-u_{i-1}}{2\\Delta x}$\n    -   二阶导数（中心差分）：$\\frac{\\partial^2 u}{\\partial x^2} \\approx \\frac{u_{i+1}-2u_i+u_{i-1}}{\\Delta x^2}$\n-   **任务**:\n    1.  构建非线性残差向量 $R(u^{n+1})$。\n    2.  执行一个牛顿步，从初始猜测 $u^{(0)}$ 找到 $u^{(1)}$。牛顿更新为 $u^{(1)} = u^{(0)} - J(u^{(0)})^{-1}R(u^{(0)})$。\n    3.  计算残差缩减因子 $\\rho = \\frac{\\left\\|R(u^{(1)})\\right\\|_2}{\\left\\|R(u^{(0)})\\right\\|_2}$。\n-   **测试用例**:\n    -   **用例 1**: $N = 51$, $\\Delta t = 0.005$, $\\nu = 0.01$, $\\sigma = 1.0$, $u^n(x) = \\sin(\\pi x)$, $u^{(0)}(x) = u^n(x)$。\n    -   **用例 2**: $N = 51$, $\\Delta t = 0.05$, $\\nu = 0.005$, $\\sigma = 5.0$, $u^n(x) = 0.5\\,\\sin(2\\pi x) + 0.25\\,\\sin(\\pi x)$, $u^{(0)}(x) = 0$。\n    -   **用例 3**: $N = 31$, $\\Delta t = 0.01$, $\\nu = 0.02$, $\\sigma = 0.0$, $u^n(x) = \\sin(\\pi x)$, $u^{(0)}(x) = 0$。\n\n#### 步骤2：使用提取的给定信息进行验证\n\n该问题经过了严格的验证检查。\n-   **科学依据**：控制方程是带反应项的黏性 Burgers 方程的变体，这是流体动力学和非线性物理学中一个基础且经过充分研究的模型。所规定的数值方法——Crank-Nicolson 法、中心差分和牛顿法——是求解此类偏微分方程的标准、典型技术。\n-   **适定的**：该问题是适定的。它提供了一个特定的偏微分方程、边界条件、一个明确定义的数值方案，以及三个不同测试用例所需的所有参数和初始数据。目标是计算一个特定的、唯一定义的数值量 $\\rho$。\n-   **客观性**：问题以精确的数学语言陈述，没有任何主观性或歧义。\n-   **完整性与一致性**：执行计算所需的所有信息都已提供。离散化方案虽然是 Crank-Nicolson 的一种特定半隐式变体，但其定义明确且不包含任何矛盾。每个测试用例的变量和参数都已清楚指定。\n-   **可行性**：该问题是一个标准的数值分析练习。参数是无量纲的，不会带来任何物理或计算上的不可行性。\n\n#### 步骤3：结论与行动\n\n问题陈述是**有效的**。这是一个清晰、自洽且科学上合理的数值分析和计算流体动力学问题。我将继续进行求解。\n\n### 解法推导\n\n目标是计算单次牛顿迭代后非线性残差 $L_2$-范数的缩减。这需要构建残差向量、其雅可比矩阵以及实现牛顿步。\n\n令内部网格点上的未知数向量为 $\\mathbf{u}^{n+1} = [u_1^{n+1}, u_2^{n+1}, \\dots, u_{M}^{n+1}]^T$，其中 $M = N-2$ 是内部点的数量。为简化起见，我们省略未知向量的上标 $n+1$，将其表示为 $\\mathbf{u}$。\n\n**1. 非线性残差公式**\n对于每个内部点 $i=1, \\dots, M$，离散残差 $R_i(\\mathbf{u})$ 是通过将给定的 Crank-Nicolson 方程的所有项移到一边得到的。\n$$\nR_i(\\mathbf{u}) = \\frac{u_i - u_i^n}{\\Delta t} + \\frac{1}{2}\\left[u_i^n\\,\\frac{u_{i+1}-u_{i-1}}{2\\Delta x} + u_i^n\\,\\frac{u_{i+1}^n-u_{i-1}^n}{2\\Delta x}\\right] - \\frac{\\nu}{2}\\left[\\frac{u_{i+1}-2u_i+u_{i-1}}{\\Delta x^2} + \\frac{u_{i+1}^n-2u_i^n+u_{i-1}^n}{\\Delta x^2}\\right] - \\frac{\\sigma}{2}\\left[u_i^3 + (u_i^n)^3\\right]\n$$\n该方程定义了残差向量 $R(\\mathbf{u})$ 的第 $i$ 个分量。需要求解的非线性方程组是 $R(\\mathbf{u})=\\mathbf{0}$。$u$ 和 $u^n$ 的索引通过边界条件处理，即 $u_0=u_N=u_0^n=u_N^n=0$。\n\n**2. 牛顿法**\n为求解 $R(\\mathbf{u}) = \\mathbf{0}$，采用牛顿法。给定一个初始猜测 $\\mathbf{u}^{(0)}$，通过求解线性系统来找到一个更好的近似 $\\mathbf{u}^{(1)}$，以获得更新量 $\\delta \\mathbf{u} = \\mathbf{u}^{(1)} - \\mathbf{u}^{(0)}$：\n$$\nJ(\\mathbf{u}^{(0)}) \\delta \\mathbf{u} = -R(\\mathbf{u}^{(0)})\n$$\n其中 $J(\\mathbf{u}^{(0)})$ 是残差向量 $R$ 在 $\\mathbf{u}^{(0)}$ 处求值的雅可比矩阵。雅可比矩阵的元素是 $J_{ij} = \\frac{\\partial R_i}{\\partial u_j}$。求解出 $\\delta \\mathbf{u}$ 后，更新解：$\\mathbf{u}^{(1)} = \\mathbf{u}^{(0)} + \\delta \\mathbf{u}$。\n\n**3. 雅可比矩阵推导**\n残差 $R_i$ 依赖于 $u_{i-1}$、$u_i$ 和 $u_{i+1}$。因此，雅可比矩阵 $J$ 是三对角的。第 $i$ 行的非零元素是 $J_{i,i-1}$、$J_{i,i}$ 和 $J_{i,i+1}$。让我们根据 $R_i$ 的表达式计算这些偏导数，并在任意点 $\\mathbf{u}$ 处进行求值：\n\n-   **次对角线项 ($j=i-1$)**:\n    $$\n    J_{i,i-1} = \\frac{\\partial R_i}{\\partial u_{i-1}} = \\frac{1}{2}\\left[u_i^n \\frac{-1}{2\\Delta x}\\right] - \\frac{\\nu}{2}\\left[\\frac{1}{\\Delta x^2}\\right] = -\\frac{u_i^n}{4\\Delta x} - \\frac{\\nu}{2\\Delta x^2}\n    $$\n\n-   **主对角线项 ($j=i$)**:\n    $$\n    J_{i,i} = \\frac{\\partial R_i}{\\partial u_i} = \\frac{1}{\\Delta t} - \\frac{\\nu}{2}\\left[\\frac{-2}{\\Delta x^2}\\right] - \\frac{\\sigma}{2}[3u_i^2] = \\frac{1}{\\Delta t} + \\frac{\\nu}{\\Delta x^2} - \\frac{3\\sigma}{2}u_i^2\n    $$\n\n-   **超对角线项 ($j=i+1$)**:\n    $$\n    J_{i,i+1} = \\frac{\\partial R_i}{\\partial u_{i+1}} = \\frac{1}{2}\\left[u_i^n \\frac{1}{2\\Delta x}\\right] - \\frac{\\nu}{2}\\left[\\frac{1}{\\Delta x^2}\\right] = \\frac{u_i^n}{4\\Delta x} - \\frac{\\nu}{2\\Delta x^2}\n    $$\n雅可比矩阵在牛顿步中于 $\\mathbf{u}^{(0)}$ 处求值。\n\n**4. 算法摘要**\n对于每个测试用例，执行以下步骤：\n1.  初始化参数 $N$、$\\Delta t$、$\\nu$、$\\sigma$ 和空间网格 $x_i$。\n2.  定义内部点的向量 $\\mathbf{u}^n$ 和初始猜测 $\\mathbf{u}^{(0)}$。\n3.  计算初始残差向量 $R^{(0)} = R(\\mathbf{u}^{(0)})$ 及其欧几里得范数 $\\|R^{(0)}\\|_2$。\n4.  如果 $\\|R^{(0)}\\|_2$ 非零，则组装雅可比矩阵 $J_0 = J(\\mathbf{u}^{(0)})$。\n5.  求解线性系统 $J_0 \\delta \\mathbf{u} = -R^{(0)}$ 以获得更新向量 $\\delta \\mathbf{u}$。\n6.  计算更新后的解 $\\mathbf{u}^{(1)} = \\mathbf{u}^{(0)} + \\delta \\mathbf{u}$。\n7.  计算新的残差向量 $R^{(1)} = R(\\mathbf{u}^{(1)})$ 及其范数 $\\|R^{(1)}\\|_2$。\n8.  计算缩减因子 $\\rho = \\|R^{(1)}\\|_2 / \\|R^{(0)}\\|_2$。如果 $\\|R^{(0)}\\|_2 = 0$，则认为缩减是完美的，因此 $\\rho=0$。\n\n对提供的三个测试用例中的每一个都实施此程序。对于测试用例3，其中 $\\sigma=0$，系统对于 $\\mathbf{u}$ 是线性的，单次牛顿步即可收敛到精确解，导致 $R(\\mathbf{u}^{(1)}) \\approx \\mathbf{0}$ 且 $\\rho \\approx 0$（在机器精度范围内）。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the results.\n    \"\"\"\n\n    def calculate_residual(u_next, u_prev, N, dt, nu, sigma):\n        \"\"\"\n        Calculates the nonlinear residual vector for the discretized PDE.\n\n        Args:\n            u_next (np.ndarray): The unknown solution vector u^{n+1} at interior points.\n            u_prev (np.ndarray): The solution vector u^n at interior points from the previous time step.\n            N (int): Total number of grid points.\n            dt (float): Time step size.\n            nu (float): Viscosity coefficient.\n            sigma (float): Reaction coefficient.\n\n        Returns:\n            np.ndarray: The residual vector R.\n        \"\"\"\n        dx = 1.0 / (N - 1)\n        \n        # Pad with zeros for homogeneous Dirichlet boundary conditions\n        u_next_full = np.pad(u_next, (1, 1), 'constant')\n        u_prev_full = np.pad(u_prev, (1, 1), 'constant')\n\n        # Spatial derivatives for u^{n+1} (u_next)\n        du_dx_next = (u_next_full[2:] - u_next_full[:-2]) / (2.0 * dx)\n        d2u_dx2_next = (u_next_full[2:] - 2.0 * u_next_full[1:-1] + u_next_full[:-2]) / (dx**2)\n\n        # Spatial derivatives for u^n (u_prev)\n        du_dx_prev = (u_prev_full[2:] - u_prev_full[:-2]) / (2.0 * dx)\n        d2u_dx2_prev = (u_prev_full[2:] - 2.0 * u_prev_full[1:-1] + u_prev_full[:-2]) / (dx**2)\n        \n        # Lagged advective velocity v^n is u^n at interior points\n        v_prev = u_prev\n\n        # Assemble the residual vector R based on the Crank-Nicolson formula\n        temporal_term = (u_next - u_prev) / dt\n        advective_term = 0.5 * (v_prev * du_dx_next + v_prev * du_dx_prev)\n        diffusive_term = 0.5 * nu * (d2u_dx2_next + d2u_dx2_prev)\n        reaction_term = 0.5 * sigma * (u_next**3 + u_prev**3)\n        \n        R = temporal_term + advective_term - diffusive_term - reaction_term\n        return R\n\n    def assemble_jacobian(u_linearize, u_prev, N, dt, nu, sigma):\n        \"\"\"\n        Assembles the Jacobian matrix for the nonlinear residual.\n\n        Args:\n            u_linearize (np.ndarray): The solution vector u^{(0)} at which to linearize.\n            u_prev (np.ndarray): The solution vector u^n from the previous time step.\n            N (int): Total number of grid points.\n            dt (float): Time step size.\n            nu (float): Viscosity coefficient.\n            sigma (float): Reaction coefficient.\n\n        Returns:\n            np.ndarray: The Jacobian matrix J.\n        \"\"\"\n        dx = 1.0 / (N - 1)\n        M = N - 2  # Number of interior points\n        J = np.zeros((M, M))\n\n        # Main diagonal entries\n        diag_vals = 1.0 / dt + nu / dx**2 - 1.5 * sigma * u_linearize**2\n        np.fill_diagonal(J, diag_vals)\n        \n        if M > 1:\n            # Sub-diagonal entries\n            sub_diag_vals = -u_prev[1:] / (4.0 * dx) - nu / (2.0 * dx**2)\n            np.fill_diagonal(J[1:, :], sub_diag_vals)\n\n            # Super-diagonal entries\n            super_diag_vals = u_prev[:-1] / (4.0 * dx) - nu / (2.0 * dx**2)\n            np.fill_diagonal(J[:, 1:], super_diag_vals)\n            \n        return J\n\n    def run_newton_step(params):\n        \"\"\"\n        Performs a single Newton step and computes the residual reduction.\n        \"\"\"\n        N, dt, nu, sigma, u_n_func, u0_func = params\n        \n        # Setup grid and initial vectors\n        x = np.linspace(0.0, 1.0, N)\n        x_interior = x[1:-1]\n        \n        u_prev = u_n_func(x_interior)\n        u0_guess = u0_func(x_interior)\n\n        # Calculate initial residual R(u^(0)) and its norm\n        R0 = calculate_residual(u0_guess, u_prev, N, dt, nu, sigma)\n        norm_R0 = np.linalg.norm(R0)\n\n        # Handle case where initial guess is already the solution\n        if np.isclose(norm_R0, 0.0):\n            return 0.0\n        \n        # Assemble Jacobian J(u^(0))\n        J0 = assemble_jacobian(u0_guess, u_prev, N, dt, nu, sigma)\n        \n        # Solve for the update: J * du = -R\n        delta_u = np.linalg.solve(J0, -R0)\n        \n        # Update the solution: u^(1) = u^(0) + du\n        u1_next = u0_guess + delta_u\n        \n        # Calculate new residual R(u^(1)) and its norm\n        R1 = calculate_residual(u1_next, u_prev, N, dt, nu, sigma)\n        norm_R1 = np.linalg.norm(R1)\n        \n        # Compute the reduction factor\n        rho = norm_R1 / norm_R0\n        return rho\n\n    test_cases = [\n        # Case 1: (N, dt, nu, sigma, u^n(x), u^(0)(x))\n        (51, 0.005, 0.01, 1.0, lambda x: np.sin(np.pi * x), lambda x: np.sin(np.pi * x)),\n        # Case 2\n        (51, 0.05, 0.005, 5.0, lambda x: 0.5 * np.sin(2 * np.pi * x) + 0.25 * np.sin(np.pi * x), lambda x: np.zeros_like(x)),\n        # Case 3\n        (31, 0.01, 0.02, 0.0, lambda x: np.sin(np.pi * x), lambda x: np.zeros_like(x)),\n    ]\n\n    results = []\n    for case in test_cases:\n        rho = run_newton_step(case)\n        results.append(rho)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}