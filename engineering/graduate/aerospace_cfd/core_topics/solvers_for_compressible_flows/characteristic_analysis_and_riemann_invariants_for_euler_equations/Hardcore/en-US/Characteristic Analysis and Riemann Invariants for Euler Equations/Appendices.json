{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of characteristic analysis is the identification of quantities that remain constant along characteristic curves. This first practice provides a foundational exercise, guiding you through the derivation of these quantities—the Riemann invariants—for the 1D isentropic Euler equations . You will then immediately apply this theory to a computational problem, reinforcing the direct link between the mathematical framework and its power to predict physical outcomes.",
            "id": "3947229",
            "problem": "Consider one-dimensional, unsteady, inviscid compressible flow of a perfect gas within Computational Fluid Dynamics (CFD). The evolution is governed by the compressible Euler equations, specialized to one spatial dimension with the assumptions of no body forces and, in regions without shocks, isentropic behavior. Begin from the following fundamental base:\n\n- The one-dimensional continuity equation: $\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u \\right) = 0$.\n- The one-dimensional momentum equation: $\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u^2 + p \\right) = 0$.\n- The isentropic perfect-gas relation: $p = K \\rho^{\\gamma}$, where $K$ is a constant along an isentrope and $\\gamma$ is the ratio of specific heats.\n- The definition of the local speed of sound: $a = \\sqrt{\\gamma \\frac{p}{\\rho}}$.\n\nFrom this base, perform a characteristic analysis of the quasi-linear form of the Euler system to identify the characteristic families defined by $dx/dt = u \\pm a$, and derive the corresponding compatibility relations and Riemann invariants appropriate to isentropic perfect-gas flow.\n\nImplementation task:\n- Using only the above base, derive the compatibility relations along the characteristic families and the associated invariant quantities. Then, design an algorithm that, given an initial state $(\\rho_0, u_0, p_0)$ at some point in the flow and a target pressure $p_1$ along the same isentrope, computes the final velocity $u_1$ at a state $(\\rho_1, u_1, p_1)$ consistent with remaining on the chosen characteristic family ($C^+$ for $dx/dt = u + a$, or $C^-$ for $dx/dt = u - a$). Assume the process is isentropic; that is, $K = p_0 / \\rho_0^{\\gamma}$ remains constant so that $\\rho_1 = \\left( \\frac{p_1}{K} \\right)^{1/\\gamma}$ and $a_1 = \\sqrt{\\gamma \\frac{p_1}{\\rho_1}}$.\n\n- Your program must compute, for each test case, the final velocity $u_1$ in meters per second, using the derived compatibility relations and Riemann invariants, with results rounded to six decimal places.\n\n- The final output format must be a single line containing a comma-separated list of the computed velocities enclosed in square brackets, for example, `\"[u_1^{(1)},u_1^{(2)},...]\"`.\n\nTest suite:\nUse the following six test cases, each specified by $(\\gamma, \\rho_0, u_0, p_0,$ family, $p_1)$, where the family is either $C^+$ or $C^-$.\n\n1. Happy path rarefaction along $C^+$: $(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 90000.0 \\text{ Pa})$.\n2. Gentle compression along $C^+$: $(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 105000.0 \\text{ Pa})$.\n3. Rarefaction along $C^-$: $(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 120.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^-, p_1 = 95000.0 \\text{ Pa})$.\n4. Near-sonic initial state along $C^-$: $(\\gamma = 1.4, \\rho_0 = 1.200 \\text{ kg/m}^3, u_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 101325.0 \\text{ Pa}, C^-, p_1 = 100000.0 \\text{ Pa})$. Note that $u_0$ must be computed from $a_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}}$ and set equal to $a_0$.\n5. Supersonic initial state along $C^+$: $(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 2 \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 95000.0 \\text{ Pa})$.\n6. Edge case with extremely small pressure change along $C^+$: $(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 99999.0 \\text{ Pa})$.\n\nRequired outputs:\n- For each test case, compute $u_1$ in $\\text{m/s}$ and round to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, `\"[u_1^{(1)},u_1^{(2)},u_1^{(3)},u_1^{(4)},u_1^{(5)},u_1^{(6)}]\"`.",
            "solution": "The user wants to solve a problem based on the characteristic analysis of the 1D Euler equations.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Governing Equations**:\n    1.  Continuity: $\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u \\right) = 0$\n    2.  Momentum: $\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u^2 + p \\right) = 0$\n- **State Relations for Isentropic Perfect Gas**:\n    1.  Pressure-density relation: $p = K \\rho^{\\gamma}$, where $K$ is a constant.\n    2.  Speed of sound definition: $a = \\sqrt{\\gamma \\frac{p}{\\rho}}$\n- **Assumptions**: One-dimensional, unsteady, inviscid, compressible flow of a perfect gas; no body forces; isentropic flow.\n- **Problem Goal**:\n    1.  Perform a characteristic analysis to derive the compatibility relations and Riemann invariants for the characteristic families $dx/dt = u \\pm a$.\n    2.  Implement an algorithm to compute the final velocity $u_1$ at a state $(\\rho_1, u_1, p_1)$ given an initial state $(\\rho_0, u_0, p_0)$ and a target pressure $p_1$, assuming the state change occurs along a single characteristic ($C^+$ or $C^-$).\n- **Test Cases**:\n    1.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 90000.0 \\text{ Pa})$\n    2.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 105000.0 \\text{ Pa})$\n    3.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 120.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^-, p_1 = 95000.0 \\text{ Pa})$\n    4.  $(\\gamma = 1.4, \\rho_0 = 1.2 \\text{ kg/m}^3, u_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 101325.0 \\text{ Pa}, C^-, p_1 = 100000.0 \\text{ Pa})$\n    5.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 2 \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 95000.0 \\text{ Pa})$\n    6.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 99999.0 \\text{ Pa})$\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded (Critical)**: The problem is fundamentally sound. It is based on the Euler equations, which are the cornerstone of inviscid fluid dynamics, and the method of characteristics, a standard mathematical technique for hyperbolic Partial Differential Equations (PDEs).\n- **Well-Posed**: The problem is well-posed. The derivation of Riemann invariants from the Euler equations is a standard procedure in gas dynamics. The implementation task is clearly defined with sufficient input data for each test case to yield a unique solution.\n- **Objective (Critical)**: The problem is stated using precise, objective, and quantitative language, devoid of any subjectivity or ambiguity.\n- The problem is fully **self-contained and consistent**. All necessary physical laws and mathematical definitions are provided. It does not exhibit any of the flaws listed in the validation criteria (e.g., scientific unsoundness, incompleteness, ambiguity).\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. Proceeding with the solution.\n\n### Derivation of Compatibility Relations and Riemann Invariants\n\nThe objective is to derive the compatibility relations and Riemann invariants for the $1$D Euler equations under the assumption of isentropic flow. We begin with the provided equations in conservative form and transform them into a non-conservative, primitive variable form suitable for characteristic analysis.\n\nThe primitive variables are density, $\\rho$, and velocity, $u$. The pressure, $p$, is related to $\\rho$ through the isentropic law.\n\n**1. Transformation to Primitive Variables**\n\nThe continuity equation is:\n$$ \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 $$\nExpanding the spatial derivative using the product rule gives:\n$$ \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0 \\quad (1) $$\n\nFor the momentum equation, we first expand the terms:\n$\\frac{\\partial (\\rho u)}{\\partial t} = u \\frac{\\partial \\rho}{\\partial t} + \\rho \\frac{\\partial u}{\\partial t}$\n$\\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 2\\rho u \\frac{\\partial u}{\\partial x} + u^2 \\frac{\\partial \\rho}{\\partial x} + \\frac{\\partial p}{\\partial x}$\nAdding these gives the expanded momentum equation:\n$$ u \\frac{\\partial \\rho}{\\partial t} + \\rho \\frac{\\partial u}{\\partial t} + u^2 \\frac{\\partial \\rho}{\\partial x} + 2\\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\nWe can group terms by $u$:\n$$ u \\left( \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} \\right) + \\rho \\frac{\\partial u}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\nThe term in parentheses is the continuity equation, which is equal to zero. This leaves:\n$$ \\rho \\frac{\\partial u}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\nDividing by $\\rho$ (since $\\rho > 0$):\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho} \\frac{\\partial p}{\\partial x} = 0 \\quad (2) $$\n\n**2. Eliminating Pressure**\n\nFor an isentropic process, $p = K\\rho^\\gamma$, so the pressure gradient can be related to the density gradient:\n$$ \\frac{\\partial p}{\\partial x} = \\frac{dp}{d\\rho} \\frac{\\partial \\rho}{\\partial x} $$\nThe derivative $\\frac{dp}{d\\rho}$ is:\n$$ \\frac{dp}{d\\rho} = \\frac{d}{d\\rho}(K\\rho^\\gamma) = \\gamma K \\rho^{\\gamma-1} = \\gamma \\frac{K\\rho^\\gamma}{\\rho} = \\gamma \\frac{p}{\\rho} $$\nBy definition, the speed of sound squared is $a^2 = \\gamma \\frac{p}{\\rho}$. Thus, $\\frac{dp}{d\\rho} = a^2$.\nSubstituting $\\frac{\\partial p}{\\partial x} = a^2 \\frac{\\partial \\rho}{\\partial x}$ into the momentum equation $(2)$:\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{a^2}{\\rho} \\frac{\\partial \\rho}{\\partial x} = 0 \\quad (2') $$\n\nNow we have a system of two PDEs in variables $\\rho$ and $u$:\n1.  $\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0$\n2.  $\\frac{\\partial u}{\\partial t} + \\frac{a^2}{\\rho} \\frac{\\partial \\rho}{\\partial x} + u \\frac{\\partial u}{\\partial x} = 0$\n\n**3. Characteristic Analysis**\n\nWe write the system in quasi-linear matrix form, $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{0}$, with state vector $\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ u \\end{pmatrix}$:\n$$ \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial t} \\\\ \\frac{\\partial u}{\\partial t} \\end{pmatrix} + \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial x} \\\\ \\frac{\\partial u}{\\partial x} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\nThe Jacobian matrix is $\\mathbf{A} = \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix}$. The characteristic speeds are the eigenvalues $\\lambda$ of $\\mathbf{A}$, found by solving $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$:\n$$ \\det \\begin{pmatrix} u-\\lambda  \\rho \\\\ a^2/\\rho  u-\\lambda \\end{pmatrix} = (u-\\lambda)^2 - \\rho(a^2/\\rho) = (u-\\lambda)^2 - a^2 = 0 $$\nThis yields $\\lambda - u = \\pm a$, so the eigenvalues are $\\lambda_{\\pm} = u \\pm a$. These are the propagation speeds of disturbances, defining the characteristic curves in the $(x,t)$-plane by $\\frac{dx}{dt} = u \\pm a$.\n\nTo find the compatibility relations, we determine the left eigenvectors $\\mathbf{l} = [l_1, l_2]$ of $\\mathbf{A}$, which satisfy $\\mathbf{l} \\mathbf{A} = \\lambda \\mathbf{l}$:\n$$ [l_1, l_2] \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix} = \\lambda [l_1, l_2] $$\nThis gives the system:\n1.  $l_1 u + l_2 (a^2/\\rho) = \\lambda l_1 \\implies l_2 (a^2/\\rho) = (\\lambda - u) l_1$\n2.  $l_1 \\rho + l_2 u = \\lambda l_2 \\implies l_1 \\rho = (\\lambda - u) l_2$\n\nSubstituting $\\lambda - u = \\pm a$, we get $l_1 \\rho = (\\pm a) l_2$, which gives $l_1 = \\pm \\frac{a}{\\rho} l_2$.\nThe left eigenvectors corresponding to $\\lambda_{\\pm} = u \\pm a$ are thus proportional to $\\mathbf{l}^{\\pm} = [\\pm a/\\rho, 1]$.\n\nMultiplying the original matrix system $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{0}$ from the left by an eigenvector $\\mathbf{l}^{\\pm}$ gives:\n$$ \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial t} + (\\mathbf{l}^{\\pm} \\mathbf{A}) \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial t} + \\lambda_{\\pm} \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial x} = 0 $$\nWriting this out, we get:\n$$ [\\pm a/\\rho, 1] \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial t} \\\\ \\frac{\\partial u}{\\partial t} \\end{pmatrix} + (u \\pm a) [\\pm a/\\rho, 1] \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial x} \\\\ \\frac{\\partial u}{\\partial x} \\end{pmatrix} = 0 $$\n$$ \\pm \\frac{a}{\\rho} \\left( \\frac{\\partial \\rho}{\\partial t} + (u \\pm a) \\frac{\\partial \\rho}{\\partial x} \\right) + \\left( \\frac{\\partial u}{\\partial t} + (u \\pm a) \\frac{\\partial u}{\\partial x} \\right) = 0 $$\nThis is equivalent to the total derivatives along the characteristic curves $\\frac{dx}{dt} = u \\pm a$:\n$$ \\pm \\frac{a}{\\rho} \\frac{d\\rho}{dt} + \\frac{du}{dt} = 0 $$\nThese are the compatibility relations.\n\n**4. Riemann Invariants**\n\nTo find the invariants, we must integrate the compatibility relations. The term $\\frac{a}{\\rho} d\\rho$ needs to be expressed as the differential of a single variable. For isentropic flow, $p = K\\rho^\\gamma$, and $a^2 = \\gamma p/\\rho$, so $a = \\sqrt{\\gamma K \\rho^{\\gamma-1}} = \\sqrt{\\gamma K} \\rho^{(\\gamma-1)/2}$.\nThe integral is:\n$$ \\int \\frac{a}{\\rho} d\\rho = \\int \\sqrt{\\gamma K} \\rho^{(\\gamma-3)/2} d\\rho = \\sqrt{\\gamma K} \\frac{\\rho^{(\\gamma-1)/2}}{(\\gamma-1)/2} = \\frac{2}{\\gamma-1} \\left( \\sqrt{\\gamma K} \\rho^{(\\gamma-1)/2} \\right) = \\frac{2a}{\\gamma-1} $$\nSo, $d\\left(\\frac{2a}{\\gamma-1}\\right) = \\frac{a}{\\rho} d\\rho$.\nSubstituting this back into the compatibility relations:\n- For the $C^+$ family ($\\frac{dx}{dt} = u+a$):\n$$ \\frac{du}{dt} + \\frac{d}{dt}\\left(\\frac{2a}{\\gamma-1}\\right) = 0 \\implies \\frac{d}{dt}\\left(u + \\frac{2a}{\\gamma-1}\\right) = 0 $$\nThis means the quantity $J^+ = u + \\frac{2a}{\\gamma-1}$ is constant along the $C^+$ characteristics.\n\n- For the $C^-$ family ($\\frac{dx}{dt} = u-a$):\n$$ \\frac{du}{dt} - \\frac{d}{dt}\\left(\\frac{2a}{\\gamma-1}\\right) = 0 \\implies \\frac{d}{dt}\\left(u - \\frac{2a}{\\gamma-1}\\right) = 0 $$\nThis means the quantity $J^- = u - \\frac{2a}{\\gamma-1}$ is constant along the $C^-$ characteristics.\n\nThe quantities $J^+$ and $J^-$ are the Riemann invariants for $1$D isentropic flow.\n\n### Algorithm Design\n\nThe task is to compute a final velocity $u_1$ given an initial state $(\\rho_0, u_0, p_0)$ and a final pressure $p_1$, assuming the change occurs along a specific characteristic family.\nLet the initial state be $(\\rho_0, u_0, p_0)$ and the final state be $(\\rho_1, u_1, p_1)$.\n\nThe initial speed of sound is $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$. To find the final speed of sound $a_1$, we use the isentropic relation:\n$$ a = \\sqrt{\\gamma p/\\rho} \\quad \\text{and} \\quad p/\\rho^\\gamma = \\text{const} \\implies p = C\\rho^\\gamma $$\n$$ a^2 = \\gamma p/\\rho = \\gamma (C\\rho^\\gamma)/\\rho = \\gamma C \\rho^{\\gamma-1} $$\nAlso, $p^{1/\\gamma} = C^{1/\\gamma} \\rho \\implies \\rho = C^{-1/\\gamma} p^{1/\\gamma}$.\nSubstituting $\\rho$ into the expression for $a^2$:\n$$ a^2 = \\gamma C (C^{-1/\\gamma} p^{1/\\gamma})^{\\gamma-1} = \\gamma C^{1- (\\gamma-1)/\\gamma} p^{(\\gamma-1)/\\gamma} = \\gamma C^{1/\\gamma} p^{(\\gamma-1)/\\gamma} $$\nThis shows that $a \\propto p^{(\\gamma-1)/(2\\gamma)}$. Therefore, the ratio of speeds of sound is:\n$$ \\frac{a_1}{a_0} = \\left(\\frac{p_1}{p_0}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\implies a_1 = a_0 \\left(\\frac{p_1}{p_0}\\right)^{\\frac{\\gamma-1}{2\\gamma}} $$\nThis relation allows us to calculate $a_1$ from known quantities without needing to find $K$ or $\\rho_1$.\n\n- If the process is along a $C^+$ characteristic, the invariant $J^+$ is conserved:\n$$ u_0 + \\frac{2a_0}{\\gamma-1} = u_1 + \\frac{2a_1}{\\gamma-1} \\implies u_1 = u_0 + \\frac{2}{\\gamma-1}(a_0 - a_1) $$\n\n- If the process is along a $C^-$ characteristic, the invariant $J^-$ is conserved:\n$$ u_0 - \\frac{2a_0}{\\gamma-1} = u_1 - \\frac{2a_1}{\\gamma-1} \\implies u_1 = u_0 - \\frac{2}{\\gamma-1}(a_0 - a_1) = u_0 + \\frac{2}{\\gamma-1}(a_1 - a_0) $$\n\nThe algorithm is as follows:\n1. For a given test case $(\\gamma, \\rho_0, u_0, p_0, \\text{family}, p_1)$:\n2. Calculate the initial speed of sound, $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$. Handle cases where $u_0$ is defined in terms of $a_0$.\n3. Calculate the final speed of sound, $a_1 = a_0 (p_1/p_0)^{(\\gamma-1)/(2\\gamma)}$.\n4. If `family` is $C^+$, compute $u_1 = u_0 + \\frac{2}{\\gamma-1}(a_0 - a_1)$.\n5. If `family` is $C^-$, compute $u_1 = u_0 + \\frac{2}{\\gamma-1}(a_1 - a_0)$.\n6. Round the result to six decimal places.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes final velocities for 1D isentropic flow problems using Riemann invariants.\n    \"\"\"\n    # The test suite as specified in the problem statement.\n    # Format: (gamma, rho_0, u_0_spec, p_0, family, p_1)\n    # u_0_spec can be a number or a string ('a_0' or '2*a_0')\n    test_cases = [\n        # 1. Happy path rarefaction along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 90000.0),\n        # 2. Gentle compression along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 105000.0),\n        # 3. Rarefaction along C-\n        (1.4, 1.0, 120.0, 100000.0, 'C-', 95000.0),\n        # 4. Near-sonic initial state along C-\n        (1.4, 1.2, 'a_0', 101325.0, 'C-', 100000.0),\n        # 5. Supersonic initial state along C+\n        (1.4, 1.0, '2*a_0', 100000.0, 'C+', 95000.0),\n        # 6. Edge case with extremely small pressure change along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 99999.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        gamma, rho_0, u_0_spec, p_0, family, p_1 = case\n        \n        # Step 1: Calculate initial speed of sound a_0\n        a_0 = np.sqrt(gamma * p_0 / rho_0)\n        \n        # Step 2: Determine initial velocity u_0\n        if isinstance(u_0_spec, str):\n            if u_0_spec == 'a_0':\n                u_0 = a_0\n            elif u_0_spec == '2*a_0':\n                u_0 = 2 * a_0\n        else:\n            u_0 = u_0_spec\n        \n        # Step 3: Calculate final speed of sound a_1\n        # Using the relation a1/a0 = (p1/p0)^((gamma-1)/(2*gamma))\n        exponent = (gamma - 1.0) / (2.0 * gamma)\n        a_1 = a_0 * np.power(p_1 / p_0, exponent)\n        \n        # Pre-compute the term 2/(gamma-1)\n        two_over_gamma_minus_1 = 2.0 / (gamma - 1.0)\n        \n        # Step 4: Calculate final velocity u_1 based on the characteristic family\n        u_1 = 0.0\n        if family == 'C+':\n            # Invariant: u + 2a/(gamma-1) = const\n            # u1 = u0 + 2/(gamma-1) * (a0 - a1)\n            u_1 = u_0 + two_over_gamma_minus_1 * (a_0 - a_1)\n        elif family == 'C-':\n            # Invariant: u - 2a/(gamma-1) = const\n            # u1 = u0 + 2/(gamma-1) * (a1 - a0)\n            u_1 = u_0 + two_over_gamma_minus_1 * (a_1 - a_0)\n        \n        # Step 5: Round the result to six decimal places and store\n        results.append(f\"{u_1:.6f}\") # Use format specifier for rounding half up\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Building on the properties of single waves, this exercise tackles the full Riemann problem, where two initial states interact to produce a complex wave pattern. By applying characteristic analysis, you will derive the conditions under which a strong expansion can lead to the formation of a vacuum state . This practice also bridges the gap between analytical theory and computational reality, revealing how the exact solution structure informs the design of robust numerical schemes.",
            "id": "3441122",
            "problem": "Consider the one-dimensional compressible Euler equations for a polytropic ideal gas with adiabatic index $\\gamma$,\n$$\n\\partial_{t}\n\\begin{pmatrix}\n\\rho \\\\\n\\rho u \\\\\nE\n\\end{pmatrix}\n+\n\\partial_{x}\n\\begin{pmatrix}\n\\rho u \\\\\n\\rho u^{2} + p \\\\\nu(E + p)\n\\end{pmatrix}\n= \\mathbf{0},\n$$\nwhere $\\rho$ is the mass density, $u$ is the velocity, $p$ is the pressure, and $E$ is the total energy defined by $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^{2}$. The equation of state is $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^{2}\\right)$, and the sound speed is $a = \\sqrt{\\gamma p / \\rho}$. Consider the Riemann problem with initial data\n$$\n(\\rho, u, p)(x,0) = \n\\begin{cases}\n(\\rho_{L}, u_{L}, p_{L}),  x  0, \\\\\n(\\rho_{R}, u_{R}, p_{R}),  x  0,\n\\end{cases}\n$$\nfor a gas with adiabatic index $\\gamma = \\frac{7}{5}$. Let the left and right states be nondimensionalized so that\n$$\n\\rho_{L} = 1, \\quad u_{L} = 0, \\quad p_{L} = \\frac{1}{\\gamma}, \\qquad\n\\rho_{R} = 1, \\quad p_{R} = \\frac{4}{\\gamma},\n$$\nand $u_{R}$ is to be chosen. Using only the conservation law structure and characteristic analysis for the Euler system (including rarefaction-wave properties derived from Riemann invariants), perform the following:\n\n1. Derive from first principles the condition on the velocity jump $u_{R} - u_{L}$ under which the exact solution contains a vacuum state (i.e., the intermediate pressure tends to $0$ and the density tends to $0$).\n2. Compute the exact minimal positive value of $u_{R} - u_{L}$ in these nondimensional variables that guarantees vacuum formation in the exact solution for the given left and right states. Express your final velocity threshold in nondimensional units.\n3. Analyze, in the regime where the exact solution would form vacuum, the conditions on wave speed estimates required by positivity-preserving approximate Riemann solvers of Harten–Lax–van Leer type (HLLE) to maintain $p \\ge 0$ and $\\rho \\ge 0$ in a single explicit Euler time step with Courant–Friedrichs–Lewy (CFL) number less than or equal to $1$. Your analysis must be based on invariant-region and convex-combination arguments derived from the conservation law structure and characteristic speeds, without invoking any prepackaged solver-specific formulas.\n\nYour final numerical answer should be the exact threshold value of $u_{R} - u_{L}$ obtained in part 2. No rounding is required.",
            "solution": "The user has provided a three-part problem concerning the one-dimensional compressible Euler equations. I will address each part sequentially after validating the problem statement.\n\nThe problem is scientifically well-posed, grounded in the established theory of hyperbolic conservation laws, and provides a complete and consistent set of data and definitions. All given parameters are physically and mathematically sound. Therefore, the problem is valid, and I will proceed with a full solution.\n\nThe system of equations is given by $\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$, with the state vector $\\mathbf{U} = (\\rho, \\rho u, E)^T$ and flux vector $\\mathbf{F}(\\mathbf{U}) = (\\rho u, \\rho u^2+p, u(E+p))^T$. The variables are density $\\rho$, velocity $u$, pressure $p$, and total energy per unit volume $E$. The equation of state for a polytropic ideal gas is $p = (\\gamma-1)(E - \\frac{1}{2}\\rho u^2)$. The sound speed is $a = \\sqrt{\\gamma p / \\rho}$.\n\nThe Riemann problem is defined by the initial data:\n$$\n(\\rho, u, p)(x,0) = \n\\begin{cases}\n(\\rho_{L}, u_{L}, p_{L}),  x  0, \\\\\n(\\rho_{R}, u_{R}, p_{R}),  x  0,\n\\end{cases}\n$$\nThe specific values provided are $\\gamma = \\frac{7}{5}$, and the nondimensionalized states:\nLeft state: $\\rho_{L} = 1$, $u_{L} = 0$, $p_{L} = \\frac{1}{\\gamma} = \\frac{5}{7}$.\nRight state: $\\rho_{R} = 1$, $u_{R}$ is variable, $p_{R} = \\frac{4}{\\gamma} = \\frac{20}{7}$.\n\n**Part 1: Derivation of the Vacuum Formation Condition**\n\nThe solution to the Riemann problem is self-similar and depends on the variable $\\xi = x/t$. The solution consists of constant states separated by waves (shocks or rarefactions) and a contact discontinuity. The intermediate state between the left- and right-going waves is characterized by a constant velocity $u_*$ and pressure $p_*$.\n\nA vacuum state occurs when the intermediate pressure and density tend to zero, i.e., $p_* \\to 0$ and $\\rho_* \\to 0$. This phenomenon happens when the initial states are moving apart from each other with sufficient velocity, causing the formation of two rarefaction waves that pull the fluid apart.\n\nWe analyze the change in velocity across a rarefaction wave using Riemann invariants. For the Euler equations, the Riemann invariants associated with the characteristic fields $\\lambda_1 = u-a$, $\\lambda_2 = u$, and $\\lambda_3 = u+a$ are:\n$R_1 = u - \\frac{2a}{\\gamma-1}$ is invariant across $2$- and $3$-waves.\n$R_2 = s = p/\\rho^\\gamma$ (entropy) is invariant across $1$- and $3$-waves (for smooth solutions like rarefactions).\n$R_3 = u + \\frac{2a}{\\gamma-1}$ is invariant across $1$- and $2$-waves.\n\nA 1-rarefaction wave connects the left state $(\\rho_L, u_L, p_L)$ to the intermediate state $(\\rho_{*,L}, u_*, p_*)$. Across this wave, $R_3$ is constant:\n$$u_L + \\frac{2 a_L}{\\gamma-1} = u_* + \\frac{2 a_{*,L}}{\\gamma-1}$$\nwhere $a_L$ is the sound speed in the left state and $a_{*,L}$ is the sound speed in the left intermediate state. Entropy is also constant, $p_L/\\rho_L^\\gamma = p_*/\\rho_{*,L}^\\gamma$. The sound speed $a = \\sqrt{\\gamma p/\\rho}$ relates to pressure and density as $a^2 = \\gamma p^{1-1/\\gamma} (p/\\rho^\\gamma)^{1/\\gamma}$. Since $p/\\rho^\\gamma$ is constant through the rarefaction wave, $a \\propto p^{(\\gamma-1)/(2\\gamma)}$. Thus, $a_{*,L} = a_L (p_*/p_L)^{(\\gamma-1)/(2\\gamma)}$.\nSubstituting this into the $R_3$ invariant equation, we can express $u_*$ as a function of $p_*$:\n$$u_* = u_L + \\frac{2a_L}{\\gamma-1} - \\frac{2a_L}{\\gamma-1} \\left(\\frac{p_*}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} = u_L + \\frac{2a_L}{\\gamma-1} \\left[1 - \\left(\\frac{p_*}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}}\\right]$$\n\nA 3-rarefaction wave connects the right state $(\\rho_R, u_R, p_R)$ to the intermediate state $(\\rho_{*,R}, u_*, p_*)$. Across this wave, $R_1$ is constant:\n$$u_R - \\frac{2 a_R}{\\gamma-1} = u_* - \\frac{2 a_{*,R}}{\\gamma-1}$$\nSimilarly, $a_{*,R} = a_R (p_*/p_R)^{(\\gamma-1)/(2\\gamma)}$. Solving for $u_*$:\n$$u_* = u_R - \\frac{2a_R}{\\gamma-1} + \\frac{2a_R}{\\gamma-1} \\left(\\frac{p_*}{p_R}\\right)^{\\frac{\\gamma-1}{2\\gamma}} = u_R - \\frac{2a_R}{\\gamma-1} \\left[1 - \\left(\\frac{p_*}{p_R}\\right)^{\\frac{\\gamma-1}{2\\gamma}}\\right]$$\n\nA solution with an intermediate pressure $p_* > 0$ exists if the two rarefaction curves for $u_*(p_*)$ intersect. Vacuum formation occurs at the threshold where a solution with $p_*>0$ ceases to exist. This happens when the initial states are pulled apart so fast that the pressure in the middle drops to zero. We find this threshold by taking the limit $p_* \\to 0$ in the expressions for velocity.\n\nFrom the 1-rarefaction, the maximum velocity attained by the fluid expanding into a vacuum ($p_*\\to 0$) is:\n$$u_{*,L} = \\lim_{p_*\\to 0} u_*(p_*) = u_L + \\frac{2a_L}{\\gamma-1}$$\nThis represents the velocity of the tail of the rarefaction fan expanding from the left.\n\nFrom the 3-rarefaction, the minimum velocity of the fluid expanding into a vacuum is:\n$$u_{*,R} = \\lim_{p_*\\to 0} u_*(p_*) = u_R - \\frac{2a_R}{\\gamma-1}$$\nThis is the velocity of the tail of the rarefaction fan expanding from the right.\n\nA vacuum region opens up between the two states if the fluid at the right edge of the vacuum region moves faster than the fluid at the left edge, i.e., $u_{*,R} > u_{*,L}$. The threshold for vacuum formation is the equality, $u_{*,R} = u_{*,L}$.\n$$u_R - \\frac{2a_R}{\\gamma-1} = u_L + \\frac{2a_L}{\\gamma-1}$$\nRearranging gives the condition on the velocity jump $u_R - u_L$ for vacuum formation:\n$$u_R - u_L \\ge \\frac{2}{\\gamma-1}(a_L + a_R)$$\nThe minimal velocity jump occurs at the equality.\n\n**Part 2: Computation of the Minimal Positive Velocity Jump**\n\nWe use the threshold condition derived in Part 1 and substitute the given nondimensional values.\nThe adiabatic index is $\\gamma = \\frac{7}{5}$, so $\\gamma - 1 = \\frac{2}{5}$.\nThe initial velocity on the left is $u_L=0$.\nWe first compute the sound speeds in the left and right states.\nFor the left state: $\\rho_L = 1$, $p_L = \\frac{1}{\\gamma} = \\frac{5}{7}$.\n$$a_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{(7/5) \\cdot (5/7)}{1}} = \\sqrt{1} = 1$$\nFor the right state: $\\rho_R = 1$, $p_R = \\frac{4}{\\gamma} = \\frac{20}{7}$.\n$$a_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}} = \\sqrt{\\frac{(7/5) \\cdot (20/7)}{1}} = \\sqrt{4} = 2$$\nThe minimal velocity jump $u_R - u_L$ that guarantees vacuum formation is:\n$$(u_R - u_L)_{crit} = \\frac{2}{\\gamma-1}(a_L + a_R) = \\frac{2}{2/5}(1 + 2) = 5 \\times 3 = 15$$\nSince $u_L=0$, the minimal positive value of $u_R$ is $15$. The required quantity is the velocity jump $u_R - u_L$.\n\n**Part 3: Analysis of Positivity-Preserving Conditions for HLLE Solvers**\n\nThe Harten–Lax–van Leer (HLLE) approximate Riemann solver replaces the detailed wave structure of the exact solution between states $\\mathbf{U}_L$ and $\\mathbf{U}_R$ with a single intermediate state $\\mathbf{U}^{HLL}$, separated by two waves with speeds $s_L$ and $s_R$. The finite volume method update for a cell average $\\mathbf{U}_j^n$ is given by:\n$$\\mathbf{U}_j^{n+1} = \\mathbf{U}_j^n - \\frac{\\Delta t}{\\Delta x}(\\mathbf{F}_{j+1/2} - \\mathbf{F}_{j-1/2})$$\nwhere $\\mathbf{F}_{j+1/2}$ is the numerical flux at the interface $x_{j+1/2}$.\n\nThe positivity of the scheme (maintaining $\\rho \\ge 0$ and $p \\ge 0$) relies on ensuring that the updated state $\\mathbf{U}_j^{n+1}$ remains within the convex set of physical states $G = \\{\\mathbf{U} | \\rho > 0, p > 0\\}$. A Godunov-type scheme, of which HLLE is an example, constructs the new state $\\mathbf{U}_j^{n+1}$ by averaging the approximate solution over the cell $[x_j-\\Delta x/2, x_j+\\Delta x/2]$ at time $\\Delta t$. Subject to a Courant-Friedrichs-Lewy (CFL) condition, this averaging process can be expressed as a convex combination of states from the previous time step. Specifically, $\\mathbf{U}_j^{n+1}$ is a convex combination of $\\mathbf{U}_j^n$ and the intermediate states from the Riemann problems at the cell boundaries, $\\mathbf{U}_{j-1/2}^{HLL}$ and $\\mathbf{U}_{j+1/2}^{HLL}$.\n\nSince $G$ is a convex set, if the initial states $\\mathbf{U}_j^n$ are in $G$, the updated state $\\mathbf{U}_j^{n+1}$ will also be in $G$ provided that the intermediate HLLE states $\\mathbf{U}^{HLL}$ are themselves in $G$. The core of the analysis is thus to determine the conditions on the wave speed estimates $s_L$ and $s_R$ that guarantee the physical admissibility of $\\mathbf{U}^{HLL}$.\n\nThe HLLE intermediate state can be understood as the integral average of the exact, self-similar solution $\\mathbf{U}_{ex}(\\xi)$ over the interval defined by the estimated wave speeds:\n$$ \\mathbf{U}^{HLL} = \\frac{1}{s_R - s_L} \\int_{s_L}^{s_R} \\mathbf{U}_{ex}(\\xi) d\\xi $$\nThis formula follows directly from integrating the conservation law $\\xi \\frac{d\\mathbf{U}}{d\\xi} = \\frac{d\\mathbf{F}}{d\\xi}$ over $[s_L, s_R]$.\nSince the exact solution $\\mathbf{U}_{ex}(\\xi)$ for the Euler equations is always in the physical set $G$ (or on its boundary $\\partial G$ in the case of vacuum), its integral average $\\mathbf{U}^{HLL}$ will also be in $G$ due to the convexity of $G$, provided that the averaging interval $[s_L, s_R]$ encompasses the entire wave structure of the exact solution. If the interval is chosen too narrowly, the average might be taken over an unrepresentative part of the solution, potentially yielding an unphysical state.\n\nThe wave structure of the exact Riemann solution is supported on the interval of self-similar speeds $[\\lambda_{min}, \\lambda_{max}]$, where $\\lambda_{min}$ and $\\lambda_{max}$ are the minimum and maximum characteristic speeds present in the solution. For the Euler equations, the characteristic speeds are $u-a$, $u$, and $u+a$. The minimal speed of the entire fan is determined by the head of the leftmost wave, and the maximal speed by the head of the rightmost wave. These are determined by the initial states $\\mathbf{U}_L$ and $\\mathbf{U}_R$.\n- The speed of the head of the left-going wave (1-wave) is $\\lambda_1(\\mathbf{U}_L) = u_L - a_L$.\n- The speed of the head of the right-going wave (3-wave) is $\\lambda_3(\\mathbf{U}_R) = u_R + a_R$.\n\nTherefore, to ensure that the averaging interval contains the entire fan, the estimated wave speeds must satisfy:\n$$s_L \\le u_L - a_L \\quad \\text{and} \\quad s_R \\ge u_R + a_R$$\nThese inequalities are the conditions on the wave speed estimates required for the HLLE solver to be positivity-preserving. This holds true for any solution structure, including the case where a vacuum is formed. The fact that the initial data leads to vacuum formation does not alter this fundamental requirement for the robustness and positivity of the HLLE scheme.",
            "answer": "$$\n\\boxed{15}\n$$"
        },
        {
            "introduction": "One of the most critical applications of characteristic theory in CFD is the formulation of physically correct boundary conditions. This final practice guides you through the design of a sophisticated, mixed-regime outlet condition by analyzing the direction of information flow via characteristics . Implementing a treatment that correctly handles subsonic, transonic, and supersonic flow will equip you with a fundamental skill for developing stable and accurate simulations.",
            "id": "3368282",
            "problem": "Consider a one-dimensional characteristic analysis of the compressible Euler equations at a computational domain outlet with outward-pointing unit normal. Let the primitive state adjacent to the outlet inside the domain be $(\\rho, u_n, p)$, where $\\rho$ is density, $u_n$ is the velocity component normal to the outlet (positive when pointing out of the domain), and $p$ is static pressure. Assume a calorically perfect gas with ratio of specific heats $\\gamma$, and that the local closure is the ideal-gas, isentropic relation along characteristics. Let the speed of sound be $a = \\sqrt{\\gamma p / \\rho}$, and define the normal Mach number $M_n = u_n/a$. The characteristic wave speeds of the one-dimensional system in the normal direction are $\\lambda_1 = u_n - a$, $\\lambda_2 = u_n$, and $\\lambda_3 = u_n + a$. The number of incoming characteristics equals the count of $\\lambda_i$ with negative sign. For a nominally supersonic outlet, small pockets with $M_n$ slightly less than $1$ can occur locally. These alter the set of required boundary conditions. \n\nStarting only from these fundamentals, derive the required count of scalar boundary conditions as a function of the signs of $\\lambda_i$, and construct a robust mixed subsonic/supersonic outlet treatment that switches based on $M_n$ as follows:\n- For outflow with $M_n \\ge M_{\\text{up}}$ (strictly supersonic), impose no conditions on the hyperbolic part and extrapolate all primitive variables from the interior.\n- For outflow with $M_n \\le M_{\\text{low}}$ (subsonic), impose exactly one scalar condition by prescribing static pressure to a given reference $p_{\\text{ref}}$ and keep entropy from the interior. Use characteristic compatibility to compute the boundary velocity.\n- For $M_{\\text{low}}  M_n  M_{\\text{up}}$, blend smoothly between these two limits using a switching function $s(M_n)$.\n- Additionally, handle local reversed flow at the outlet (inflow through the outlet). For subsonic inflow, two characteristics enter; supply two conditions from a specified reservoir state by enforcing the incoming characteristic and entropy to match the reservoir while taking the outgoing characteristic from the interior. For supersonic inflow, three characteristics enter; set the boundary state equal to the reservoir.\n\nUse these well-tested formulas and definitions:\n- Isentropic constant $K = p/\\rho^\\gamma$.\n- Riemann invariants for isentropic flow, $w^+ = u_n + \\dfrac{2a}{\\gamma-1}$ along $\\dfrac{dx}{dt} = u_n + a$ and $w^- = u_n - \\dfrac{2a}{\\gamma-1}$ along $\\dfrac{dx}{dt} = u_n - a$.\n- For subsonic outflow, take $K$ and $w^+$ from the interior, set $p = p_{\\text{ref}}$, and recover $a$ and $u_n$ compatibly.\n- For subsonic inflow, take $K$ and $w^-$ from the reservoir and $w^+$ from the interior, then recover $a$, $u_n$, $\\rho$, and $p$ compatibly.\n- For supersonic inflow, set $(\\rho, u_n, p)$ equal to the reservoir.\n\nYour program must implement this mixed treatment with a smooth switch in the near-sonic band using a linear switching function between thresholds $M_{\\text{low}} = 1 - \\delta$ and $M_{\\text{up}} = 1 + \\delta$, where $\\delta$ is given. Specifically, for outflow define\n$$\ns(M_n) = \n\\begin{cases}\n1,  M_n \\le M_{\\text{low}},\\\\\n\\dfrac{M_{\\text{up}} - M_n}{M_{\\text{up}} - M_{\\text{low}}},  M_{\\text{low}}  M_n  M_{\\text{up}},\\\\\n0,  M_n \\ge M_{\\text{up}}.\n\\end{cases}\n$$\nThen compute the boundary state for outflow via\n$$\n\\begin{aligned}\n(\\rho, u_n, p)_{\\text{sup}} = (\\rho, u_n, p)_{\\text{int}},\\\\\n(\\rho, u_n, p)_{\\text{sub}} : \\quad p_{\\text{sub}} = p_{\\text{ref}}, \\quad K_{\\text{int}} = \\dfrac{p_{\\text{int}}}{\\rho_{\\text{int}}^\\gamma}, \\quad \\rho_{\\text{sub}} = \\left(\\dfrac{p_{\\text{sub}}}{K_{\\text{int}}}\\right)^{1/\\gamma}, \\\\\n\\qquad a_{\\text{sub}} = \\sqrt{\\dfrac{\\gamma p_{\\text{sub}}}{\\rho_{\\text{sub}}}}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1}, \\quad u_{n,\\text{sub}} = w^+_{\\text{int}} - \\dfrac{2 a_{\\text{sub}}}{\\gamma - 1},\\\\\n(\\rho, u_n, p)_{\\text{bc}} = (1-s)(\\rho, u_n, p)_{\\text{sup}} + s(\\rho, u_n, p)_{\\text{sub}}.\n\\end{aligned}\n$$\nFor inflow through the outlet, use the reservoir state $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$:\n- If $|M_n|  1$ with $u_n  0$ (subsonic inflow), compute\n$$\nK_\\infty = \\dfrac{p_\\infty}{\\rho_\\infty^\\gamma}, \\quad a_\\infty = \\sqrt{\\dfrac{\\gamma p_\\infty}{\\rho_\\infty}}, \\quad w^-_\\infty = u_{n,\\infty} - \\dfrac{2a_\\infty}{\\gamma - 1}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1},\n$$\nthen\n$$\na_{\\text{bc}} = \\dfrac{\\gamma - 1}{4}\\left(w^+_{\\text{int}} - w^-_\\infty\\right), \\quad u_{n,\\text{bc}} = \\dfrac{w^+_{\\text{int}} + w^-_\\infty}{2}, \\quad \n\\rho_{\\text{bc}} = \\left(\\dfrac{a_{\\text{bc}}^2}{\\gamma K_\\infty}\\right)^{\\!\\!1/(\\gamma - 1)}, \\quad p_{\\text{bc}} = K_\\infty \\rho_{\\text{bc}}^\\gamma.\n$$\n- If $|M_n| \\ge 1$ with $u_n  0$ (supersonic inflow), set $(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$.\n\nTest suite. Use the following constants and states in International System of Units (SI):\n- $\\gamma = 1.4$, $\\delta = 0.05$,\n- Outlet reference pressure $p_{\\text{ref}} = 101325\\,\\text{Pa}$,\n- Inflow reservoir state $(\\rho_\\infty, u_{n,\\infty}, p_\\infty) = (1.2\\,\\text{kg/m}^3, -200\\,\\text{m/s}, 300000\\,\\text{Pa})$.\n\nDefine six test cases with interior states $(\\rho_{\\text{int}}, u_{n,\\text{int}}, p_{\\text{int}})$:\n- Case A (strict supersonic outflow): $(0.5\\,\\text{kg/m}^3, 600\\,\\text{m/s}, 100000\\,\\text{Pa})$.\n- Case B (slightly subsonic outflow pocket): $(0.5\\,\\text{kg/m}^3, 0.98\\,a_{\\text{int}}, 100000\\,\\text{Pa})$ where $a_{\\text{int}} = \\sqrt{\\gamma p_{\\text{int}}/\\rho_{\\text{int}}}$.\n- Case C (near-sonic outflow, $M_n = 1.01$): $(0.5\\,\\text{kg/m}^3, 1.01\\,a_{\\text{int}}, 100000\\,\\text{Pa})$.\n- Case D (near-sonic outflow, $M_n = 0.99$): $(0.5\\,\\text{kg/m}^3, 0.99\\,a_{\\text{int}}, 100000\\,\\text{Pa})$.\n- Case E (subsonic inflow through the outlet): $(0.5\\,\\text{kg/m}^3, -100\\,\\text{m/s}, 100000\\,\\text{Pa})$.\n- Case F (supersonic inflow through the outlet): $(0.5\\,\\text{kg/m}^3, -600\\,\\text{m/s}, 100000\\,\\text{Pa})$.\n\nTasks. For each test case, compute:\n- The integer count of incoming characteristics $n_{\\text{in}}$ as the number of $\\lambda_i$ that are negative.\n- The normal Mach number $M_n$.\n- The boundary state $(\\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}})$ produced by the mixed treatment above.\n\nExpress $\\rho_{\\text{bc}}$ in $\\text{kg/m}^3$, $u_{n,\\text{bc}}$ in $\\text{m/s}$, and $p_{\\text{bc}}$ in $\\text{Pa}$. Round all floating-point outputs to six decimal places.\n\nFinal output format. Your program should produce a single line of output containing the concatenated results for the six cases in the order A, B, C, D, E, F, where each case contributes the five-tuple $[n_{\\text{in}}, M_n, \\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}}]$. Aggregate them into a single list on one line, as a comma-separated list enclosed in square brackets, for example, $[n_{\\text{in},A}, M_{n,A}, \\rho_{\\text{bc},A}, u_{n,\\text{bc},A}, p_{\\text{bc},A}, \\dots, n_{\\text{in},F}, M_{n,F}, \\rho_{\\text{bc},F}, u_{n,\\text{bc},F}, p_{\\text{bc},F}]$.",
            "solution": "The problem requires the implementation of a mixed subsonic/supersonic boundary condition treatment for a one-dimensional outlet in a computational fluid dynamics context. The analysis is based on the theory of characteristics for the compressible Euler equations.\n\n### Principle-Based Design: Characteristic Analysis\n\nThe foundation of hyperbolic partial differential equations, such as the Euler equations, is the method of characteristics. For the one-dimensional Euler equations, there are three characteristic waves that propagate information through the fluid. At a computational boundary, the direction of this propagation determines whether information is needed from outside the domain (a boundary condition) or if the state is determined by the flow inside the domain.\n\nThe propagation speeds of these waves, relative to the stationary boundary, are given by the eigenvalues of the system Jacobian matrix. For a boundary with an outward-pointing normal vector, and with fluid properties $(\\rho, u_n, p)$ representing density, normal velocity, and pressure, these eigenvalues are:\n- $\\lambda_1 = u_n - a$\n- $\\lambda_2 = u_n$\n- $\\lambda_3 = u_n + a$\n\nHere, $u_n$ is the velocity component normal to the outlet (positive for outflow), and $a = \\sqrt{\\gamma p / \\rho}$ is the local speed of sound. A negative eigenvalue ($\\lambda_i  0$) signifies a characteristic wave propagating into the computational domain, thus requiring a boundary condition to be supplied. A positive eigenvalue ($\\lambda_i > 0$) signifies a wave propagating out of the domain, carrying information from the interior. The number of required boundary conditions, $n_{\\text{in}}$, is therefore the number of negative eigenvalues.\n\nThe flow regime at the outlet is classified by the normal Mach number, $M_n = u_n/a$. We analyze the sign of the eigenvalues for each regime:\n\n1.  **Supersonic Outflow ($u_n > 0, M_n > 1$)**: Since $u_n > a$, all three eigenvalues are positive: $\\lambda_1 = u_n - a > 0$, $\\lambda_2 = u_n > 0$, $\\lambda_3 = u_n + a > 0$. All information propagates out of the domain. Thus, $n_{\\text{in}} = 0$, and no boundary conditions are imposed. The state at the boundary is determined entirely by the interior flow, typically by extrapolation.\n\n2.  **Subsonic Outflow ($u_n > 0, 0  M_n  1$)**: Since $0  u_n  a$, we have $\\lambda_1 = u_n - a  0$, $\\lambda_2 = u_n > 0$, and $\\lambda_3 = u_n + a > 0$. One characteristic enters the domain. Thus, $n_{\\text{in}} = 1$, and one scalar boundary condition must be provided. For subsonic outlets, it is common to prescribe the static pressure $p_{\\text{bc}} = p_{\\text{ref}}$.\n\n3.  **Subsonic Inflow ($u_n  0, |M_n|  1$)**: Since $-a  u_n  0$, we have $\\lambda_1 = u_n - a  0$, $\\lambda_2 = u_n  0$, and $\\lambda_3 = u_n + a > 0$. Two characteristics enter the domain. Thus, $n_{\\text{in}} = 2$, and two scalar conditions are required. These are typically provided from a far-field or reservoir state.\n\n4.  **Supersonic Inflow ($u_n  0, |M_n| > 1$)**: Since $u_n  -a$, all three eigenvalues are negative: $\\lambda_1 = u_n - a  0$, $\\lambda_2 = u_n  0$, and $\\lambda_3 = u_n + a  0$. All information propagates into the domain. Thus, $n_{\\text{in}} = 3$, and the entire flow state ($\\rho, u_n, p$) must be prescribed from a reservoir.\n\n### Algorithmic Implementation based on Characteristics\n\nThe problem provides specific formulas to implement these conditions using characteristic variables called Riemann invariants ($w^+, w^-$) and entropy (via the isentropic constant $K = p/\\rho^\\gamma$).\n\n**Outflow ($u_n \\ge 0$):**\nA robust treatment must handle the transition between subsonic and supersonic outflow smoothly. The problem defines a blending approach using a switching function $s(M_n)$ in the trans-sonic region $M_{\\text{low}}  M_n  M_{\\text{up}}$, where $M_{\\text{low}} = 1 - \\delta$ and $M_{\\text{up}} = 1 + \\delta$.\nThe boundary state $(\\rho, u_n, p)_{\\text{bc}}$ is a weighted average:\n$$(\\rho, u_n, p)_{\\text{bc}} = (1-s(M_n))(\\rho, u_n, p)_{\\text{sup}} + s(M_n)(\\rho, u_n, p)_{\\text{sub}}$$\n-   The supersonic state $(\\rho, u_n, p)_{\\text{sup}}$ is simply the extrapolated interior state $(\\rho, u_n, p)_{\\text{int}}$, consistent with $n_{\\text{in}}=0$.\n-   The subsonic state $(\\rho, u_n, p)_{\\text{sub}}$ is calculated by imposing one condition ($p_{\\text{sub}} = p_{\\text{ref}}$) and using information from the two outgoing characteristics from the interior. This is accomplished by conserving the Riemann invariant $w^+ = u_n + \\frac{2a}{\\gamma-1}$ and the isentropic constant $K = p/\\rho^\\gamma$ from the interior state. With $p_{\\text{sub}}$ and $K_{\\text{int}}$ known, $\\rho_{\\text{sub}}$ and $a_{\\text{sub}}$ are found. Then, $u_{n,\\text{sub}}$ is found from the conserved $w^+_{\\text{int}}$.\n\n**Inflow ($u_n  0$):**\n-   **Subsonic Inflow ($|M_n|  1$, $n_{\\text{in}}=2$)**: Two conditions are needed. The boundary condition is constructed by taking the properties of the two incoming characteristics from the reservoir state $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$ and the one outgoing characteristic from the interior. This means the incoming Riemann invariant $w^- = u_n - \\frac{2a}{\\gamma-1}$ and the entropy (via $K$) are set to their reservoir values ($w^-_\\infty, K_\\infty$). The outgoing Riemann invariant $w^+$ is taken from the interior ($w^+_{\\text{int}}$). This provides a system of equations to solve for the boundary state $(\\rho, u_n, p)_{\\text{bc}}$.\n-   **Supersonic Inflow ($|M_n| \\ge 1$, $n_{\\text{in}}=3$)**: All information comes from outside. The boundary state is simply set to the reservoir state: $(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$.\n\nThe following program implements this logic for the specified test cases. It first computes the interior Mach number $M_n$ and the number of incoming characteristics $n_{\\text{in}}$. Then, it applies the appropriate logic based on the sign of $u_n$ and the value of $M_n$ to determine the final boundary state.",
            "answer": "```python\nimport numpy as np\n\n# Global constants from the problem statement\nGAMMA = 1.4\nDELTA = 0.05\nP_REF = 101325.0\nRHO_INF = 1.2\nU_N_INF = -200.0\nP_INF = 300000.0\n\ndef solve():\n    \"\"\"\n    Solves the mixed supersonic/subsonic outlet boundary condition problem\n    for a series of test cases.\n    \"\"\"\n    \n    m_low = 1.0 - DELTA\n    m_up = 1.0 + DELTA\n\n    # Pre-calculate reservoir properties\n    a_inf = np.sqrt(GAMMA * P_INF / RHO_INF)\n    k_inf = P_INF / (RHO_INF**GAMMA)\n    w_minus_inf = U_N_INF - 2.0 * a_inf / (GAMMA - 1.0)\n    \n    # Define test cases. For cases with u_n defined relative to a_int,\n    # we first calculate a_int and then u_n.\n    p_base_int = 100000.0\n    rho_base_int = 0.5\n    a_base_int = np.sqrt(GAMMA * p_base_int / rho_base_int)\n\n    test_cases = [\n        # Case A (strict supersonic outflow)\n        (rho_base_int, 600.0, p_base_int),\n        # Case B (slightly subsonic outflow pocket)\n        (rho_base_int, 0.98 * a_base_int, p_base_int),\n        # Case C (near-sonic outflow, M_n = 1.01)\n        (rho_base_int, 1.01 * a_base_int, p_base_int),\n        # Case D (near-sonic outflow, M_n = 0.99)\n        (rho_base_int, 0.99 * a_base_int, p_base_int),\n        # Case E (subsonic inflow through the outlet)\n        (rho_base_int, -100.0, p_base_int),\n        # Case F (supersonic inflow through the outlet)\n        (rho_base_int, -600.0, p_base_int),\n    ]\n\n    final_results = []\n\n    for rho_int, u_n_int, p_int in test_cases:\n        a_int = np.sqrt(GAMMA * p_int / rho_int)\n        m_n_int = u_n_int / a_int if a_int != 0 else 0.0\n\n        # Task 1: Calculate the number of incoming characteristics\n        lambda1 = u_n_int - a_int\n        lambda2 = u_n_int\n        lambda3 = u_n_int + a_int\n        n_in = sum(1 for lam in [lambda1, lambda2, lambda3] if lam  0)\n\n        rho_bc, u_n_bc, p_bc = 0.0, 0.0, 0.0\n\n        # Task 3: Compute boundary state based on flow regime\n        if u_n_int >= 0:  # Outflow\n            # Supersonic limit state (extrapolation)\n            rho_sup, u_n_sup, p_sup = rho_int, u_n_int, p_int\n\n            # Subsonic limit state (pressure-based)\n            p_sub = P_REF\n            k_int = p_int / (rho_int**GAMMA)\n            rho_sub = (p_sub / k_int)**(1.0 / GAMMA)\n            a_sub = np.sqrt(GAMMA * p_sub / rho_sub)\n            w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n            u_n_sub = w_plus_int - 2.0 * a_sub / (GAMMA - 1.0)\n            \n            # Blending function s(M_n)\n            s = 0.0\n            if m_n_int = m_low:\n                s = 1.0\n            elif m_low  m_n_int  m_up:\n                s = (m_up - m_n_int) / (m_up - m_low)\n            \n            # Blended boundary state\n            rho_bc = (1.0 - s) * rho_sup + s * rho_sub\n            u_n_bc = (1.0 - s) * u_n_sup + s * u_n_sub\n            p_bc = (1.0 - s) * p_sup + s * p_sub\n            \n        else:  # Inflow (reversed flow)\n            if abs(m_n_int)  1.0: # Subsonic inflow\n                w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n                \n                a_bc = (GAMMA - 1.0) / 4.0 * (w_plus_int - w_minus_inf)\n                u_n_bc = 0.5 * (w_plus_int + w_minus_inf)\n                rho_bc = (a_bc**2 / (GAMMA * k_inf))**(1.0 / (GAMMA - 1.0))\n                p_bc = k_inf * rho_bc**GAMMA\n            else: # Supersonic inflow\n                rho_bc, u_n_bc, p_bc = RHO_INF, U_N_INF, P_INF\n\n        # Store results for this case, rounded to 6 decimal places\n        final_results.extend([\n            n_in,\n            round(m_n_int, 6),\n            round(rho_bc, 6),\n            round(u_n_bc, 6),\n            round(p_bc, 6)\n        ])\n\n    # Format the final output string as a comma-separated list in brackets\n    output_str = \"[\" + \",\".join(map(str, final_results)) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}