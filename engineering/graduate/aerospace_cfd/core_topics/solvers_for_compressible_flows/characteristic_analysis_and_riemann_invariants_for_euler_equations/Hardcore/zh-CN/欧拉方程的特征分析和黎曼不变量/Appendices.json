{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握特征线法，第一步是从控制方程本身出发，推导出其内在的不变量。这项练习将指导您从一维欧拉方程中为理想气体推导出黎曼不变量 (Riemann invariants)，然后通过一个基础的计算任务，来实践如何应用这些不变量预测沿单一特征波传播时流场速度的变化。通过这项练习 ，您将把抽象的数学推导与具体的物理结果联系起来，为更复杂的应用奠定坚实的基础。",
            "id": "3947229",
            "problem": "在计算流体力学 (CFD) 中，考虑理想气体的一维、非定常、无粘性可压缩流。其演化由可压缩欧拉方程控制，在无彻体力、在无激波区域呈等熵行为的假设下，该方程被简化为一维空间形式。从以下基本方程组开始：\n\n- 一维连续性方程：$\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u \\right) = 0$。\n- 一维动量方程：$\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u^2 + p \\right) = 0$。\n- 理想气体等熵关系：$p = K \\rho^{\\gamma}$，其中 $K$ 是沿等熵线为常数的量，$\\gamma$ 是比热比。\n- 当地声速的定义：$a = \\sqrt{\\gamma \\frac{p}{\\rho}}$。\n\n基于此，对欧拉系统的准线性形式进行特征线分析，以识别由 $\\frac{dx}{dt} = u \\pm a$ 定义的特征族，并推导适用于理想气体等熵流的相应相容性关系和 Riemann 不变量。\n\n实现任务：\n- 仅使用上述基本方程组，推导沿特征族的相容性关系及相关的不变量。然后，设计一个算法，给定流场中某点的初始状态 $(\\rho_0, u_0, p_0)$ 和沿同一等熵线的目​​标压力 $p_1$，计算在状态 $(\\rho_1, u_1, p_1)$ 下的最终速度 $u_1$，该状态需与保持在所选特征族（$C^+$ 对应 $\\frac{dx}{dt} = u + a$，或 $C^-$ 对应 $\\frac{dx}{dt} = u - a$）上保持一致。假设过程是等熵的；即，$K = p_0 / \\rho_0^{\\gamma}$ 保持不变，因此 $\\rho_1 = \\left( \\frac{p_1}{K} \\right)^{1/\\gamma}$ 且 $a_1 = \\sqrt{\\gamma \\frac{p_1}{\\rho_1}}$。\n\n- 您的程序必须针对每个测试用例，使用推导出的相容性关系和 Riemann 不变量计算最终速度 $u_1$（单位：米/秒），结果四舍五入到六位小数。\n\n- 最终输出格式必须是单行文本，包含一个由方括号括起来的逗号分隔的计算速度列表，例如，$\"[u_1^{(1)},u_1^{(2)},\\dots]\"$。\n\n测试套件：\n使用以下六个测试用例，每个用例由 $(\\gamma,\\rho_0,u_0,p_0,$ family$,p_1)$ 指定，其中 family 是 $C^+$ 或 $C^-$。\n\n1. 沿 $C^+$ 的典型稀疏情况：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 90000.0 \\text{ Pa})$。\n2. 沿 $C^+$ 的轻微压缩：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 105000.0 \\text{ Pa})$。\n3. 沿 $C^-$ 的稀疏：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 120.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^-, p_1 = 95000.0 \\text{ Pa})$。\n4. 沿 $C^-$ 的近音速初始状态：$(\\gamma = 1.4, \\rho_0 = 1.200 \\text{ kg/m}^3, u_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 101325.0 \\text{ Pa}, C^-, p_1 = 100000.0 \\text{ Pa})$。注意，$u_0$ 必须根据 $a_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}}$ 计算并设为等于 $a_0$。\n5. 沿 $C^+$ 的超音速初始状态：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 2 \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 95000.0 \\text{ Pa})$。\n6. 沿 $C^+$ 的压力变化极小的边界情况：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 99999.0 \\text{ Pa})$。\n\n所需输出：\n- 对每个测试用例，计算 $u_1$（单位：$\\text{m/s}$）并四舍五入到六位小数。\n- 您的程序应生成一行输出，其中包含一个由方括号括起来的逗号分隔的结果列表，例如，$\"[u_1^{(1)},u_1^{(2)},u_1^{(3)},u_1^{(4)},u_1^{(5)},u_1^{(6)}]\"$。",
            "solution": "用户希望解决一个基于一维欧拉方程特征线分析的问题。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n- **控制方程**：\n    1. 连续性方程：$\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u \\right) = 0$\n    2. 动量方程：$\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u^2 + p \\right) = 0$\n- **理想气体等熵状态关系**：\n    1. 压力-密度关系：$p = K \\rho^{\\gamma}$，其中 $K$ 是一个常数。\n    2. 声速定义：$a = \\sqrt{\\gamma \\frac{p}{\\rho}}$\n- **假设**：一维、非定常、无粘性、可压缩的理想气体流动；无彻体力；等熵流。\n- **问题目标**：\n    1. 进行特征线分析，以推导特征族 $\\frac{dx}{dt} = u \\pm a$ 的相容性关系和 Riemann 不变量。\n    2. 实现一个算法，在给定初始状态 $(\\rho_0, u_0, p_0)$ 和目标压力 $p_1$ 的情况下，计算状态 $(\\rho_1, u_1, p_1)$ 的最终速度 $u_1$，假设状态变化沿单一特征线（$C^+$ 或 $C^-$）发生。\n- **测试用例**：\n    1.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 90000.0 \\text{ Pa})$\n    2.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 105000.0 \\text{ Pa})$\n    3.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 120.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^-, p_1 = 95000.0 \\text{ Pa})$\n    4.  $(\\gamma = 1.4, \\rho_0 = 1.2 \\text{ kg/m}^3, u_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 101325.0 \\text{ Pa}, C^-, p_1 = 100000.0 \\text{ Pa})$\n    5.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 2 \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 95000.0 \\text{ Pa})$\n    6.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 99999.0 \\text{ Pa})$\n\n**第 2 步：使用提取的已知条件进行验证**\n- **科学依据（关键）**：该问题在根本上是合理的。它基于欧拉方程（无粘性流体动力学的基石）和特征线法（双曲型偏微分方程的标准数学技术）。\n- **适定性**：问题是适定的。从欧拉方程推导 Riemann 不变量是气体动力学的标准流程。实现任务定义清晰，每个测试用例都有足够的输入数据以得出唯一解。\n- **客观性（关键）**：问题陈述使用精确、客观和定量的语言，没有任何主观性或歧义。\n- 问题是完全**自洽且一致的**。所有必要的物理定律和数学定义都已提供。它没有表现出验证标准中列出的任何缺陷（例如，科学上不合理、不完整、含糊不清）。\n\n**第 3 步：结论与行动**\n该问题是**有效的**。继续进行求解。\n\n### 相容性关系与 Riemann 不变量的推导\n\n目标是在等熵流假设下，推导一维欧拉方程的相容性关系和 Riemann 不变量。我们从给定的守恒形式方程开始，将其转换为适合特征线分析的非守恒、原始变量形式。\n\n原始变量是密度 $\\rho$ 和速度 $u$。压力 $p$ 通过等熵定律与 $\\rho$ 相关联。\n\n**1. 向原始变量转换**\n\n连续性方程为：\n$$ \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 $$\n使用乘积法则展开空间导数：\n$$ \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0 \\quad (1) $$\n\n动量方程为：\n$$ \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 0 $$\n展开导数：\n$$ u \\frac{\\partial \\rho}{\\partial t} + \\rho \\frac{\\partial u}{\\partial t} + u^2 \\frac{\\partial \\rho}{\\partial x} + 2\\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n我们可以分组：\n$$ u \\left( \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} \\right) + \\rho \\left( \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} \\right) + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n根据方程 $(1)$，我们知道 $\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} = -\\rho \\frac{\\partial u}{\\partial x}$。将其代入重新排列的动量方程：\n$$ u \\left( -\\rho \\frac{\\partial u}{\\partial x} \\right) + \\rho \\left( \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} \\right) + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n$$ -\\rho u \\frac{\\partial u}{\\partial x} + \\rho \\frac{\\partial u}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial x} + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n项 $-\\rho u \\frac{\\partial u}{\\partial x}$ 和 $+\\rho u \\frac{\\partial u}{\\partial x}$ 相消，剩下：\n$$ \\rho \\frac{\\partial u}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n除以 $\\rho$（因为 $\\rho > 0$）：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho} \\frac{\\partial p}{\\partial x} = 0 \\quad (2) $$\n\n**2. 消除压力**\n\n对于等熵过程，$p = K\\rho^\\gamma$，因此压力梯度可以与密度梯度相关联：\n$$ \\frac{\\partial p}{\\partial x} = \\frac{dp}{d\\rho} \\frac{\\partial \\rho}{\\partial x} $$\n导数 $\\frac{dp}{d\\rho}$ 为：\n$$ \\frac{dp}{d\\rho} = \\frac{d}{d\\rho}(K\\rho^\\gamma) = \\gamma K \\rho^{\\gamma-1} = \\gamma \\frac{K\\rho^\\gamma}{\\rho} = \\gamma \\frac{p}{\\rho} $$\n根据定义，声速的平方是 $a^2 = \\gamma \\frac{p}{\\rho}$。因此，$\\frac{dp}{d\\rho} = a^2$。\n将 $\\frac{\\partial p}{\\partial x} = a^2 \\frac{\\partial \\rho}{\\partial x}$ 代入动量方程 $(2)$：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{a^2}{\\rho} \\frac{\\partial \\rho}{\\partial x} = 0 \\quad (2') $$\n\n现在我们得到了一个关于变量 $\\rho$ 和 $u$ 的偏微分方程组：\n1.  $\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0$\n2.  $\\frac{\\partial u}{\\partial t} + \\frac{a^2}{\\rho} \\frac{\\partial \\rho}{\\partial x} + u \\frac{\\partial u}{\\partial x} = 0$\n\n**3. 特征线分析**\n\n我们将系统写成准线性矩阵形式 $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{0}$，状态向量为 $\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ u \\end{pmatrix}$：\n$$ \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial t} \\\\ \\frac{\\partial u}{\\partial t} \\end{pmatrix} + \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial x} \\\\ \\frac{\\partial u}{\\partial x} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\n雅可比矩阵是 $\\mathbf{A} = \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix}$。特征速度是 $\\mathbf{A}$ 的特征值 $\\lambda$，通过求解 $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$ 找到：\n$$ \\det \\begin{pmatrix} u-\\lambda  \\rho \\\\ a^2/\\rho  u-\\lambda \\end{pmatrix} = (u-\\lambda)^2 - \\rho(a^2/\\rho) = (u-\\lambda)^2 - a^2 = 0 $$\n这得出 $\\lambda - u = \\pm a$，因此特征值为 $\\lambda_{\\pm} = u \\pm a$。这些是扰动的传播速度，通过 $\\frac{dx}{dt} = u \\pm a$ 定义了 $(x,t)$ 平面上的特征曲线。\n\n为了找到相容性关系，我们确定 $\\mathbf{A}$ 的左特征向量 $\\mathbf{l} = [l_1, l_2]$，它满足 $\\mathbf{l} \\mathbf{A} = \\lambda \\mathbf{l}$：\n$$ [l_1, l_2] \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix} = \\lambda [l_1, l_2] $$\n这给出了方程组：\n1.  $l_1 u + l_2 (a^2/\\rho) = \\lambda l_1 \\implies l_2 (a^2/\\rho) = (\\lambda - u) l_1$\n2.  $l_1 \\rho + l_2 u = \\lambda l_2 \\implies l_1 \\rho = (\\lambda - u) l_2$\n\n代入 $\\lambda - u = \\pm a$，我们得到 $l_2 (a^2/\\rho) = (\\pm a) l_1$，简化为 $l_2 = \\pm \\frac{\\rho}{a} l_1$。\n因此，对应于 $\\lambda_{\\pm} = u \\pm a$ 的左特征向量与 $\\mathbf{l}^{\\pm} = [1, \\pm a/\\rho]$ 成比例。（我们选择缩放 $l_2 = 1$，这给出 $l_1 = \\pm a/\\rho$）。\n\n用特征向量 $\\mathbf{l}^{\\pm}$ 从左侧乘以原始矩阵系统 $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{0}$：\n$$ \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial t} + (\\mathbf{l}^{\\pm} \\mathbf{A}) \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial t} + \\lambda_{\\pm} \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial x} = 0 $$\n将其写出，我们得到：\n$$ [\\pm a/\\rho, 1] \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial t} \\\\ \\frac{\\partial u}{\\partial t} \\end{pmatrix} + (u \\pm a) [\\pm a/\\rho, 1] \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial x} \\\\ \\frac{\\partial u}{\\partial x} \\end{pmatrix} = 0 $$\n$$ \\pm \\frac{a}{\\rho} \\left( \\frac{\\partial \\rho}{\\partial t} + (u \\pm a) \\frac{\\partial \\rho}{\\partial x} \\right) + \\left( \\frac{\\partial u}{\\partial t} + (u \\pm a) \\frac{\\partial u}{\\partial x} \\right) = 0 $$\n这等价于沿特征曲线 $\\frac{dx}{dt} = u \\pm a$ 的全导数：\n$$ \\pm \\frac{a}{\\rho} \\frac{d\\rho}{dt} + \\frac{du}{dt} = 0 $$\n这些就是相容性关系。\n\n**4. Riemann 不变量**\n\n为了找到不变量，我们必须对相容性关系进行积分。项 $\\frac{a}{\\rho} d\\rho$ 需要表示为单个变量的微分。对于等熵流，$p = K\\rho^\\gamma$，且 $a^2 = \\gamma p/\\rho$，因此 $a = \\sqrt{\\gamma K \\rho^{\\gamma-1}} = \\sqrt{\\gamma K} \\rho^{(\\gamma-1)/2}$。\n积分为：\n$$ \\int \\frac{a}{\\rho} d\\rho = \\int \\sqrt{\\gamma K} \\rho^{(\\gamma-3)/2} d\\rho = \\sqrt{\\gamma K} \\frac{\\rho^{(\\gamma-1)/2}}{(\\gamma-1)/2} = \\frac{2}{\\gamma-1} \\left( \\sqrt{\\gamma K} \\rho^{(\\gamma-1)/2} \\right) = \\frac{2a}{\\gamma-1} $$\n所以，$d\\left(\\frac{2a}{\\gamma-1}\\right) = \\frac{a}{\\rho} d\\rho$。\n将此代入相容性关系：\n- 对于 $C^+$ 族（$\\frac{dx}{dt} = u+a$）：\n$$ \\frac{du}{dt} + \\frac{d}{dt}\\left(\\frac{2a}{\\gamma-1}\\right) = 0 \\implies \\frac{d}{dt}\\left(u + \\frac{2a}{\\gamma-1}\\right) = 0 $$\n这意味着量 $J^+ = u + \\frac{2a}{\\gamma-1}$ 沿 $C^+$ 特征线是常数。\n\n- 对于 $C^-$ 族（$\\frac{dx}{dt} = u-a$）：\n$$ \\frac{du}{dt} - \\frac{d}{dt}\\left(\\frac{2a}{\\gamma-1}\\right) = 0 \\implies \\frac{d}{dt}\\left(u - \\frac{2a}{\\gamma-1}\\right) = 0 $$\n这意味着量 $J^- = u - \\frac{2a}{\\gamma-1}$ 沿 $C^-$ 特征线是常数。\n\n量 $J^+$ 和 $J^-$ 是一维等熵流的 Riemann 不变量。\n\n### 算法设计\n\n任务是给定初始状态 $(\\rho_0, u_0, p_0)$ 和最终压力 $p_1$，计算最终速度 $u_1$，假设变化沿特定的特征族发生。\n设初始状态为 $(\\rho_0, u_0, p_0)$，最终状态为 $(\\rho_1, u_1, p_1)$。\n\n初始声速为 $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$。为了找到最终声速 $a_1$，我们使用等熵关系：\n$$ a = \\sqrt{\\gamma p/\\rho} \\quad \\text{和} \\quad p/\\rho^\\gamma = \\text{常数} \\implies p = C\\rho^\\gamma $$\n$$ a^2 = \\gamma p/\\rho = \\gamma (C\\rho^\\gamma)/\\rho = \\gamma C \\rho^{\\gamma-1} $$\n此外，$p^{1/\\gamma} = C^{1/\\gamma} \\rho \\implies \\rho = C^{-1/\\gamma} p^{1/\\gamma}$。\n将 $\\rho$ 代入 $a^2$ 的表达式中：\n$$ a^2 = \\gamma C (C^{-1/\\gamma} p^{1/\\gamma})^{\\gamma-1} = \\gamma C^{1- (\\gamma-1)/\\gamma} p^{(\\gamma-1)/\\gamma} = \\gamma C^{1/\\gamma} p^{(\\gamma-1)/\\gamma} $$\n这表明 $a \\propto p^{(\\gamma-1)/(2\\gamma)}$。因此，声速之比为：\n$$ \\frac{a_1}{a_0} = \\left(\\frac{p_1}{p_0}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\implies a_1 = a_0 \\left(\\frac{p_1}{p_0}\\right)^{\\frac{\\gamma-1}{2\\gamma}} $$\n这个关系允许我们从已知量计算 $a_1$，而无需找到 $K$ 或 $\\rho_1$。\n\n- 如果过程是沿 $C^+$ 特征线，不变量 $J^+$ 守恒：\n$$ u_0 + \\frac{2a_0}{\\gamma-1} = u_1 + \\frac{2a_1}{\\gamma-1} \\implies u_1 = u_0 + \\frac{2}{\\gamma-1}(a_0 - a_1) $$\n\n- 如果过程是沿 $C^-$ 特征线，不变量 $J^-$ 守恒：\n$$ u_0 - \\frac{2a_0}{\\gamma-1} = u_1 - \\frac{2a_1}{\\gamma-1} \\implies u_1 = u_0 - \\frac{2}{\\gamma-1}(a_0 - a_1) = u_0 + \\frac{2}{\\gamma-1}(a_1 - a_0) $$\n\n算法如下：\n1. 对于给定的测试用例 $(\\gamma, \\rho_0, u_0, p_0, \\text{family}, p_1)$：\n2. 计算初始声速，$a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$。处理 $u_0$ 以 $a_0$ 定义的情况。\n3. 计算最终声速，$a_1 = a_0 (p_1/p_0)^{(\\gamma-1)/(2\\gamma)}$。\n4. 如果 `family` 是 $C^+$，计算 $u_1 = u_0 + \\frac{2}{\\gamma-1}(a_0 - a_1)$。\n5. 如果 `family` 是 $C^-$，计算 $u_1 = u_0 + \\frac{2}{\\gamma-1}(a_1 - a_0)$。\n6. 将结果四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes final velocities for 1D isentropic flow problems using Riemann invariants.\n    \"\"\"\n    # The test suite as specified in the problem statement.\n    # Format: (gamma, rho_0, u_0_spec, p_0, family, p_1)\n    # u_0_spec can be a number or a string ('a_0' or '2*a_0')\n    test_cases = [\n        # 1. Happy path rarefaction along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 90000.0),\n        # 2. Gentle compression along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 105000.0),\n        # 3. Rarefaction along C-\n        (1.4, 1.0, 120.0, 100000.0, 'C-', 95000.0),\n        # 4. Near-sonic initial state along C-\n        (1.4, 1.2, 'a_0', 101325.0, 'C-', 100000.0),\n        # 5. Supersonic initial state along C+\n        (1.4, 1.0, '2*a_0', 100000.0, 'C+', 95000.0),\n        # 6. Edge case with extremely small pressure change along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 99999.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        gamma, rho_0, u_0_spec, p_0, family, p_1 = case\n        \n        # Step 1: Calculate initial speed of sound a_0\n        a_0 = np.sqrt(gamma * p_0 / rho_0)\n        \n        # Step 2: Determine initial velocity u_0\n        if isinstance(u_0_spec, str):\n            if u_0_spec == 'a_0':\n                u_0 = a_0\n            elif u_0_spec == '2*a_0':\n                u_0 = 2 * a_0\n        else:\n            u_0 = u_0_spec\n        \n        # Step 3: Calculate final speed of sound a_1\n        # Using the relation a1/a0 = (p1/p0)^((gamma-1)/(2*gamma))\n        exponent = (gamma - 1.0) / (2.0 * gamma)\n        a_1 = a_0 * np.power(p_1 / p_0, exponent)\n        \n        # Pre-compute the term 2/(gamma-1)\n        two_over_gamma_minus_1 = 2.0 / (gamma - 1.0)\n        \n        # Step 4: Calculate final velocity u_1 based on the characteristic family\n        u_1 = 0.0\n        if family == 'C+':\n            # Invariant: u + 2a/(gamma-1) = const\n            # u1 = u0 + 2/(gamma-1) * (a0 - a1)\n            u_1 = u_0 + two_over_gamma_minus_1 * (a_0 - a_1)\n        elif family == 'C-':\n            # Invariant: u - 2a/(gamma-1) = const\n            # u1 = u0 + 2/(gamma-1) * (a1 - a0)\n            u_1 = u_0 + two_over_gamma_minus_1 * (a_1 - a_0)\n        \n        # Step 5: Round the result to six decimal places and store\n        results.append(f\"{u_1:.6f}\") # Use format specifier for rounding half up\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了基础知识后，我们可以运用特征线分析来探讨更复杂的物理现象，并将其与计算方法的设计联系起来。这项练习将引导您应用稀疏波的性质来预测一种极限流动状态——真空的形成。更重要的是，该练习揭示了精确解理论与现代计算流体动力学中稳健数值格式（如 HLLE 格式）设计原则之间的深刻联系 ，展示了特征线分析为何对于开发可靠的 CFD 代码至关重要。",
            "id": "3441122",
            "problem": "考虑一个绝热指数为 $\\gamma$ 的多方理想气体的一维可压缩欧拉方程组，\n$$\n\\partial_{t}\n\\begin{pmatrix}\n\\rho \\\\\n\\rho u \\\\\nE\n\\end{pmatrix}\n+\n\\partial_{x}\n\\begin{pmatrix}\n\\rho u \\\\\n\\rho u^{2} + p \\\\\nu(E + p)\n\\end{pmatrix}\n= \\mathbf{0},\n$$\n其中 $\\rho$ 是质量密度，$u$ 是速度，$p$ 是压力，$E$ 是总能量，定义为 $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^{2}$。状态方程为 $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^{2}\\right)$，声速为 $a = \\sqrt{\\gamma p / \\rho}$。考虑具有以下初始数据的黎曼问题\n$$\n(\\rho, u, p)(x,0) = \n\\begin{cases}\n(\\rho_{L}, u_{L}, p_{L}), & x  0, \\\\\n(\\rho_{R}, u_{R}, p_{R}),  x > 0,\n\\end{cases}\n$$\n对于绝热指数为 $\\gamma = \\frac{7}{5}$ 的气体。设左右状态被无量纲化为\n$$\n\\rho_{L} = 1, \\quad u_{L} = 0, \\quad p_{L} = \\frac{1}{\\gamma}, \\qquad\n\\rho_{R} = 1, \\quad p_{R} = \\frac{4}{\\gamma},\n$$\n且 $u_{R}$ 待定。仅使用欧拉系统的守恒律结构和特征分析（包括从黎曼不变量导出的稀疏波性质），完成以下任务：\n\n1. 从第一性原理推导速度跳跃 $u_{R} - u_{L}$ 需满足的条件，在该条件下精确解包含一个真空态（即中间压力趋于 $0$，密度趋于 $0$）。\n2. 对于给定的左右状态，在这些无量纲变量中，计算保证精确解中形成真空的速度跳跃 $u_{R} - u_{L}$ 的精确最小正值。用无量纲单位表示您的最终速度阈值。\n3. 在精确解会形成真空的情况下，分析 Harten–Lax–van Leer (HLLE) 类型的保正性近似黎曼求解器所需的波速估计条件，以在 Courant–Friedrichs–Lewy (CFL) 数小于或等于 $1$ 的单个显式欧拉时间步中保持 $p \\ge 0$ 和 $\\rho \\ge 0$。您的分析必须基于从守恒律结构和特征速度推导出的不变区域和凸组合论证，而不调用任何预先打包的求解器特定公式。\n\n您的最终数值答案应为第 2 部分中获得的 $u_{R} - u_{L}$ 的精确阈值。无需四舍五入。",
            "solution": "用户提供了一个关于一维可压缩欧拉方程的三部分问题。在验证问题陈述后，我将依次解决每个部分。\n\n该问题在科学上是适定的，基于双曲守恒律的既定理论，并提供了一套完整且一致的数据和定义。所有给定参数在物理上和数学上都是合理的。因此，该问题有效，我将继续进行完整解答。\n\n该方程组由 $\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$ 给出，其中状态向量为 $\\mathbf{U} = (\\rho, \\rho u, E)^T$，通量向量为 $\\mathbf{F}(\\mathbf{U}) = (\\rho u, \\rho u^2+p, u(E+p))^T$。变量为密度 $\\rho$、速度 $u$、压力 $p$ 和单位体积总能量 $E$。多方理想气体的状态方程为 $p = (\\gamma-1)(E - \\frac{1}{2}\\rho u^2)$。声速为 $a = \\sqrt{\\gamma p / \\rho}$。\n\n黎曼问题由以下初始数据定义：\n$$\n(\\rho, u, p)(x,0) = \n\\begin{cases}\n(\\rho_{L}, u_{L}, p_{L}),  x  0, \\\\\n(\\rho_{R}, u_{R}, p_{R}),  x  0,\n\\end{cases}\n$$\n提供的具体值为 $\\gamma = \\frac{7}{5}$，以及无量纲化的状态：\n左状态：$\\rho_{L} = 1$, $u_{L} = 0$, $p_{L} = \\frac{1}{\\gamma} = \\frac{5}{7}$。\n右状态：$\\rho_{R} = 1$, $u_{R}$ 是变量, $p_{R} = \\frac{4}{\\gamma} = \\frac{20}{7}$。\n\n**第 1 部分：真空形成条件的推导**\n\n黎曼问题的解是自相似的，并依赖于变量 $\\xi = x/t$。解由被波（激波或稀疏波）和接触间断分开的常数状态组成。在左行波和右行波之间的中间状态由恒定的速度 $u_*$ 和压力 $p_*$ 表征。\n\n当中间压力和密度趋于零时，即 $p_* \\to 0$ 和 $\\rho_* \\to 0$ 时，出现真空态。当初始状态以足够大的速度相互分离，导致形成两个将流体拉开的稀疏波时，就会发生这种现象。\n\n我们使用黎曼不变量分析跨越稀疏波的速度变化。对于欧拉方程，与特征场 $\\lambda_1 = u-a$、$\\lambda_2 = u$ 和 $\\lambda_3 = u+a$ 相关联的黎曼不变量是：\n$R_1 = u - \\frac{2a}{\\gamma-1}$ 在 $2$-波和 $3$-波中是不变的。\n$R_2 = s = p/\\rho^\\gamma$（熵）在 $1$-波和 $3$-波中是不变的（对于像稀疏波这样的光滑解）。\n$R_3 = u + \\frac{2a}{\\gamma-1}$ 在 $1$-波和 $2$-波中是不变的。\n\n一个 1-稀疏波将左状态 $(\\rho_L, u_L, p_L)$ 连接到中间状态 $(\\rho_{*,L}, u_*, p_*)$。穿过此波时，$R_3$ 是常数：\n$$u_L + \\frac{2 a_L}{\\gamma-1} = u_* + \\frac{2 a_{*,L}}{\\gamma-1}$$\n其中 $a_L$ 是左状态的声速，$a_{*,L}$ 是左中间状态的声速。熵也是常数，$p_L/\\rho_L^\\gamma = p_*/\\rho_{*,L}^\\gamma$。声速 $a = \\sqrt{\\gamma p/\\rho}$ 与压力和密度的关系为 $a^2 = \\gamma p^{1-1/\\gamma} (p/\\rho^\\gamma)^{1/\\gamma}$。由于 $p/\\rho^\\gamma$ 在稀疏波中是常数，所以 $a \\propto p^{(\\gamma-1)/(2\\gamma)}$。因此，$a_{*,L} = a_L (p_*/p_L)^{(\\gamma-1)/(2\\gamma)}$。\n将此代入 $R_3$ 不变量方程，我们可以将 $u_*$ 表示为 $p_*$ 的函数：\n$$u_* = u_L + \\frac{2a_L}{\\gamma-1} - \\frac{2a_L}{\\gamma-1} \\left(\\frac{p_*}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} = u_L + \\frac{2a_L}{\\gamma-1} \\left[1 - \\left(\\frac{p_*}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}}\\right]$$\n\n一个 3-稀疏波将右状态 $(\\rho_R, u_R, p_R)$ 连接到中间状态 $(\\rho_{*,R}, u_*, p_*)$。穿过此波时，$R_1$ 是常数：\n$$u_R - \\frac{2 a_R}{\\gamma-1} = u_* - \\frac{2 a_{*,R}}{\\gamma-1}$$\n类似地，$a_{*,R} = a_R (p_*/p_R)^{(\\gamma-1)/(2\\gamma)}$。求解 $u_*$：\n$$u_* = u_R - \\frac{2a_R}{\\gamma-1} + \\frac{2a_R}{\\gamma-1} \\left(\\frac{p_*}{p_R}\\right)^{\\frac{\\gamma-1}{2\\gamma}} = u_R - \\frac{2a_R}{\\gamma-1} \\left[1 - \\left(\\frac{p_*}{p_R}\\right)^{\\frac{\\gamma-1}{2\\gamma}}\\right]$$\n\n如果两条关于 $u_*(p_*)$ 的稀疏曲线相交，则存在一个具有中间压力 $p_*  0$ 的解。当一个具有 $p_*0$ 的解不复存在时，真空形成就发生在阈值处。当初始状态被拉开得太快以至于中间的压力降到零时，就会发生这种情况。我们通过在速度表达式中取极限 $p_* \\to 0$ 来找到这个阈值。\n\n从 1-稀疏波来看，流体膨胀进入真空（$p_*\\to 0$）时达到的最大速度是：\n$$u_{*,L} = \\lim_{p_*\\to 0} u_*(p_*) = u_L + \\frac{2a_L}{\\gamma-1}$$\n这代表了从左侧展开的稀疏扇尾部的速度。\n\n从 3-稀疏波来看，流体膨胀进入真空的最小速度是：\n$$u_{*,R} = \\lim_{p_*\\to 0} u_*(p_*) = u_R - \\frac{2a_R}{\\gamma-1}$$\n这是从右侧展开的稀疏扇尾部的速度。\n\n如果真空区域右边缘的流体比左边缘的流体移动得快，即 $u_{*,R}  u_{*,L}$，则在两个状态之间会打开一个真空区域。真空形成的阈值是等式 $u_{*,R} = u_{*,L}$。\n$$u_R - \\frac{2a_R}{\\gamma-1} = u_L + \\frac{2a_L}{\\gamma-1}$$\n重新排列得到真空形成对速度跳跃 $u_R - u_L$ 的条件：\n$$u_R - u_L \\ge \\frac{2}{\\gamma-1}(a_L + a_R)$$\n最小速度跳跃发生在等式成立时。\n\n**第 2 部分：最小正速度跳跃的计算**\n\n我们使用第 1 部分推导的阈值条件，并代入给定的无量纲值。\n绝热指数为 $\\gamma = \\frac{7}{5}$，所以 $\\gamma - 1 = \\frac{2}{5}$。\n左侧的初始速度是 $u_L=0$。\n我们首先计算左右状态的声速。\n对于左状态：$\\rho_L = 1$, $p_L = \\frac{1}{\\gamma} = \\frac{5}{7}$。\n$$a_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{(7/5) \\cdot (5/7)}{1}} = \\sqrt{1} = 1$$\n对于右状态：$\\rho_R = 1$, $p_R = \\frac{4}{\\gamma} = \\frac{20}{7}$。\n$$a_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}} = \\sqrt{\\frac{(7/5) \\cdot (20/7)}{1}} = \\sqrt{4} = 2$$\n保证真空形成的最小速度跳跃 $u_R - u_L$ 是：\n$$(u_R - u_L)_{crit} = \\frac{2}{\\gamma-1}(a_L + a_R) = \\frac{2}{2/5}(1 + 2) = 5 \\times 3 = 15$$\n由于 $u_L=0$， $u_R$ 的最小正值为 $15$。所求的量是速度跳跃 $u_R - u_L$。\n\n**第 3 部分：HLLE 求解器保正性条件的分析**\n\nHarten–Lax–van Leer (HLLE) 近似黎曼求解器用一个单一的中间状态 $\\mathbf{U}^{HLL}$ 取代了状态 $\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 之间精确解的详细波结构，该中间状态被速度为 $s_L$ 和 $s_R$ 的两个波分开。单元平均值 $\\mathbf{U}_j^n$ 的有限体积法更新公式为：\n$$\\mathbf{U}_j^{n+1} = \\mathbf{U}_j^n - \\frac{\\Delta t}{\\Delta x}(\\mathbf{F}_{j+1/2} - \\mathbf{F}_{j-1/2})$$\n其中 $\\mathbf{F}_{j+1/2}$ 是界面 $x_{j+1/2}$ 处的数值通量。\n\n格式的保正性（保持 $\\rho \\ge 0$ 和 $p \\ge 0$）依赖于确保更新后的状态 $\\mathbf{U}_j^{n+1}$ 保持在物理状态的凸集 $G = \\{\\mathbf{U} | \\rho  0, p  0\\}$ 内。Godunov 型格式（HLLE 是其一个例子）通过在时间 $\\Delta t$ 时对单元 $[x_j-\\Delta x/2, x_j+\\Delta x/2]$ 上的近似解进行平均来构造新状态 $\\mathbf{U}_j^{n+1}$。在满足 Courant-Friedrichs-Lewy (CFL) 条件的情况下，这个平均过程可以表示为前一时间步状态的凸组合。具体来说，$\\mathbf{U}_j^{n+1}$ 是 $\\mathbf{U}_j^n$ 和来自单元边界黎曼问题的中间状态 $\\mathbf{U}_{j-1/2}^{HLL}$ 和 $\\mathbf{U}_{j+1/2}^{HLL}$ 的凸组合。\n\n由于 $G$ 是一个凸集，如果初始状态 $\\mathbf{U}_j^n$ 在 $G$ 中，那么只要中间的 HLLE 状态 $\\mathbf{U}^{HLL}$ 本身也在 $G$ 中，更新后的状态 $\\mathbf{U}_j^{n+1}$ 也将在 $G$ 中。因此，分析的核心是确定波速估计值 $s_L$ 和 $s_R$ 需满足的条件，以保证 $\\mathbf{U}^{HLL}$ 的物理可取性。\n\nHLLE 中间状态可以理解为精确自相似解 $\\mathbf{U}_{ex}(\\xi)$ 在由估计波速定义的区间上的积分平均值：\n$$ \\mathbf{U}^{HLL} = \\frac{1}{s_R - s_L} \\int_{s_L}^{s_R} \\mathbf{U}_{ex}(\\xi) d\\xi $$\n该公式直接来自于对守恒律 $\\xi \\frac{d\\mathbf{U}}{d\\xi} = \\frac{d\\mathbf{F}}{d\\xi}$ 在 $[s_L, s_R]$ 上积分。\n由于欧拉方程的精确解 $\\mathbf{U}_{ex}(\\xi)$ 总是位于物理集 $G$ 中（或在真空情况下位于其边界 $\\partial G$ 上），由于 $G$ 的凸性，只要平均区间 $[s_L, s_R]$ 包含了精确解的整个波结构，其积分平均值 $\\mathbf{U}^{HLL}$ 也将位于 $G$ 中。如果区间选择得太窄，平均值可能只取自解的一个不具代表性的部分，从而可能产生一个非物理状态。\n\n精确黎曼解的波结构支撑在自相似速度区间 $[\\lambda_{min}, \\lambda_{max}]$ 上，其中 $\\lambda_{min}$ 和 $\\lambda_{max}$ 是解中出现的最小和最大特征速度。对于欧拉方程，特征速度为 $u-a$、$u$ 和 $u+a$。整个波扇的最小速度由最左边波的波头决定，最大速度由最右边波的波头决定。这些都由初始状态 $\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 决定。\n- 左行波（1-波）波头的速度是 $\\lambda_1(\\mathbf{U}_L) = u_L - a_L$。\n- 右行波（3-波）波头的速度是 $\\lambda_3(\\mathbf{U}_R) = u_R + a_R$。\n\n因此，为了确保平均区间包含整个波扇，估计的波速必须满足：\n$$s_L \\le u_L - a_L \\quad \\text{且} \\quad s_R \\ge u_R + a_R$$\n这些不等式是 HLLE 求解器为保证保正性所需的波速估计条件。这对于任何解结构都成立，包括形成真空的情况。初始数据导致真空形成这一事实，并不会改变 HLLE 格式为保证其鲁棒性和保正性而必须满足的这一基本要求。",
            "answer": "$$\n\\boxed{15}\n$$"
        },
        {
            "introduction": "特征线分析在计算流体力学中最关键的实际应用之一是构建物理上正确的边界条件。这项动手实践将指导您设计一个复杂的“智能”出口边界条件，它能够通过正确解读传入和传出特征波所携带的信息，动态适应不同的流动区域（亚音速、超音速甚至逆流）。这项练习  旨在培养所有 CFD 从业者都必须具备的一项核心技能：将理论转化为能够确保数值模拟稳定性和准确性的实用工具。",
            "id": "3368282",
            "problem": "考虑可压缩欧拉方程在一维计算域出口处的特征线分析，该出口具有朝外的单位法向量。设域内邻近出口的原始变量状态为 $(\\rho, u_n, p)$，其中 $\\rho$ 为密度， $u_n$ 为垂直于出口的速度分量（指向域外为正），$p$ 为静压。假设气体为量热完全气体，比热比为 $\\gamma$，且局部闭合关系为沿特征线的理想气体等熵关系。设声速为 $a = \\sqrt{\\gamma p / \\rho}$，并定义法向马赫数 $M_n = u_n/a$。一维系统在法向上的特征波速为 $\\lambda_1 = u_n - a$、$\\lambda_2 = u_n$ 和 $\\lambda_3 = u_n + a$。传入特征线的数量等于符号为负的 $\\lambda_i$ 的个数。对于名义上的超音速出口，局部可能出现 $M_n$ 略小于 1 的小区域。这些区域会改变所需边界条件的集合。\n\n仅从这些基本原理出发，推导所需标量边界条件的数量作为 $\\lambda_i$ 符号的函数，并构建一个稳健的混合亚音速/超音速出口处理方法，该方法根据 $M_n$ 进行切换，具体如下：\n- 对于 $M_n \\ge M_{\\text{up}}$ 的出流（严格超音速），不对双曲部分施加任何条件，并从内部外推所有原始变量。\n- 对于 $M_n \\le M_{\\text{low}}$ 的出流（亚音速），通过将静压指定为给定的参考值 $p_{\\text{ref}}$ 来施加一个标量条件，并保持来自内部的熵。使用特征相容性计算边界速度。\n- 对于 $M_{\\text{low}}  M_n  M_{\\text{up}}$，使用一个切换函数 $s(M_n)$ 在这两个极限之间平滑地混合。\n- 此外，处理出口处的局部回流（通过出口流入）。对于亚音速入流，有两条特征线进入；通过强制使传入的特征线和熵与储气库状态匹配，同时从内部获取传出的特征线，从而从指定的储气库状态提供两个条件。对于超音速入流，有三条特征线进入；将边界状态设置为等于储气库状态。\n\n使用以下经过充分测试的公式和定义：\n- 等熵常数 $K = p/\\rho^\\gamma$。\n- 等熵流的黎曼不变量，$w^+ = u_n + \\dfrac{2a}{\\gamma-1}$ 沿 $\\dfrac{dx}{dt} = u_n + a$，$w^- = u_n - \\dfrac{2a}{\\gamma-1}$ 沿 $\\dfrac{dx}{dt} = u_n - a$。\n- 对于亚音速出流，从内部获取 $K$ 和 $w^+$，设置 $p = p_{\\text{ref}}$，并相容地恢复 $a$ 和 $u_n$。\n- 对于亚音速入流，从储气库获取 $K$ 和 $w^-$，从内部获取 $w^+$，然后相容地恢复 $a$、$u_n$、$\\rho$ 和 $p$。\n- 对于超音速入流，将 $(\\rho, u_n, p)$ 设置为等于储气库状态。\n\n您的程序必须使用一个在阈值 $M_{\\text{low}} = 1 - \\delta$ 和 $M_{\\text{up}} = 1 + \\delta$ 之间的线性切换函数，在近音速区域内实现这种平滑切换的混合处理，其中 $\\delta$ 是给定的。具体而言，对于出流定义\n$$\ns(M_n) = \n\\begin{cases}\n1,  M_n \\le M_{\\text{low}} \\\\[4pt]\n\\dfrac{M_{\\text{up}} - M_n}{M_{\\text{up}} - M_{\\text{low}}},  M_{\\text{low}}  M_n  M_{\\text{up}} \\\\[6pt]\n0,  M_n \\ge M_{\\text{up}}\n\\end{cases}\n$$\n然后通过以下方式计算出流的边界状态：\n$$\n\\begin{aligned}\n(\\rho, u_n, p)_{\\text{sup}} = (\\rho, u_n, p)_{\\text{int}},\\\\\n(\\rho, u_n, p)_{\\text{sub}}  \\quad p_{\\text{sub}} = p_{\\text{ref}}, \\quad K_{\\text{int}} = \\dfrac{p_{\\text{int}}}{\\rho_{\\text{int}}^\\gamma}, \\quad \\rho_{\\text{sub}} = \\left(\\dfrac{p_{\\text{sub}}}{K_{\\text{int}}}\\right)^{1/\\gamma}, \\\\\n\\qquad a_{\\text{sub}} = \\sqrt{\\dfrac{\\gamma p_{\\text{sub}}}{\\rho_{\\text{sub}}}}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1}, \\quad u_{n,\\text{sub}} = w^+_{\\text{int}} - \\dfrac{2 a_{\\text{sub}}}{\\gamma - 1},\\\\\n(\\rho, u_n, p)_{\\text{bc}} = (1-s)(\\rho, u_n, p)_{\\text{sup}} + s(\\rho, u_n, p)_{\\text{sub}}.\n\\end{aligned}\n$$\n对于通过出口的入流，使用储气库状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$：\n- 如果 $|M_n|  1$ 且 $u_n  0$（亚音速入流），计算\n$$\nK_\\infty = \\dfrac{p_\\infty}{\\rho_\\infty^\\gamma}, \\quad a_\\infty = \\sqrt{\\dfrac{\\gamma p_\\infty}{\\rho_\\infty}}, \\quad w^-_\\infty = u_{n,\\infty} - \\dfrac{2a_\\infty}{\\gamma - 1}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1},\n$$\n然后\n$$\na_{\\text{bc}} = \\dfrac{\\gamma - 1}{4}\\left(w^+_{\\text{int}} - w^-_\\infty\\right), \\quad u_{n,\\text{bc}} = \\dfrac{w^+_{\\text{int}} + w^-_\\infty}{2}, \\quad \n\\rho_{\\text{bc}} = \\left(\\dfrac{a_{\\text{bc}}^2}{\\gamma K_\\infty}\\right)^{\\!\\!1/(\\gamma - 1)}, \\quad p_{\\text{bc}} = K_\\infty \\rho_{\\text{bc}}^\\gamma.\n$$\n- 如果 $|M_n| \\ge 1$ 且 $u_n  0$（超音速入流），设置 $(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$。\n\n测试套件。在国际单位制（SI）中使用以下常数和状态：\n- $\\gamma = 1.4$，$\\delta = 0.05$，\n- 出口参考压力 $p_{\\text{ref}} = 101325\\,\\text{Pa}$，\n- 入流储气库状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty) = (1.2\\,\\text{kg/m}^3, -200\\,\\text{m/s}, 300000\\,\\text{Pa})$。\n\n定义六个测试用例，其内部状态为 $(\\rho_{\\text{int}}, u_{n,\\text{int}}, p_{\\text{int}})$：\n- 用例 A（严格超音速出流）：$(0.5\\,\\text{kg/m}^3, 600\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n- 用例 B（略微亚音速的出流区域）：$(0.5\\,\\text{kg/m}^3, 0.98\\,a_{\\text{int}}, 100000\\,\\text{Pa})$，其中 $a_{\\text{int}} = \\sqrt{\\gamma p_{\\text{int}}/\\rho_{\\text{int}}}$。\n- 用例 C（近音速出流, $M_n = 1.01$）：$(0.5\\,\\text{kg/m}^3, 1.01\\,a_{\\text{int}}, 100000\\,\\text{Pa})$。\n- 用例 D（近音速出流, $M_n = 0.99$）：$(0.5\\,\\text{kg/m}^3, 0.99\\,a_{\\text{int}}, 100000\\,\\text{Pa})$。\n- 用例 E（通过出口的亚音速入流）：$(0.5\\,\\text{kg/m}^3, -100\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n- 用例 F（通过出口的超音速入流）：$(0.5\\,\\text{kg/m}^3, -600\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n\n任务。对于每个测试用例，计算：\n- 传入特征线的整数数量 $n_{\\text{in}}$，即为负的 $\\lambda_i$ 的数量。\n- 法向马赫数 $M_n$。\n- 由上述混合处理方法产生的边界状态 $(\\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}})$。\n\n$\\rho_{\\text{bc}}$ 以 $\\text{kg/m}^3$ 表示， $u_{n,\\text{bc}}$ 以 $\\text{m/s}$ 表示， $p_{\\text{bc}}$ 以 $\\text{Pa}$ 表示。将所有浮点输出四舍五入到六位小数。\n\n最终输出格式。您的程序应生成一行输出，其中包含按 A、B、C、D、E、F 顺序连接的六个案例的结果，每个案例贡献一个五元组 $[n_{\\text{in}}, M_n, \\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}}]$。将它们聚合到一行的一个列表中，作为用方括号括起来的逗号分隔列表，例如 $[n_{\\text{in},A}, M_{n,A}, \\rho_{\\text{bc},A}, u_{n,\\text{bc},A}, p_{\\text{bc},A}, \\dots, n_{\\text{in},F}, M_{n,F}, \\rho_{\\text{bc},F}, u_{n,\\text{bc},F}, p_{\\text{bc},F}]$。",
            "solution": "该问题要求在计算流体动力学背景下，为一个一维出口实施一种混合亚音速/超音速边界条件处理方法。该分析基于可压缩欧拉方程的特征线理论。\n\n### 基于原理的设计：特征线分析\n\n双曲型偏微分方程（如欧拉方程）的基础是特征线法。对于一维欧拉方程，有三个特征波在流体中传播信息。在计算边界上，这种传播的方向决定了是需要来自域外的信息（边界条件），还是状态由域内流动决定。\n\n这些波相对于静止边界的传播速度由系统雅可比矩阵的特征值给出。对于一个具有朝外法向量的边界，流体属性为 $(\\rho, u_n, p)$，分别代表密度、法向速度和压力，这些特征值为：\n- $\\lambda_1 = u_n - a$\n- $\\lambda_2 = u_n$\n- $\\lambda_3 = u_n + a$\n\n这里，$u_n$ 是垂直于出口的速度分量（对于出流为正），$a = \\sqrt{\\gamma p / \\rho}$ 是当地声速。一个负的特征值（$\\lambda_i  0$）表示一个特征波传播到计算域内，因此需要提供一个边界条件。一个正的特征值（$\\lambda_i  0$）表示一个波从域中传播出去，携带来自内部的信息。因此，所需边界条件的数量 $n_{\\text{in}}$ 是负特征值的数量。\n\n出口处的流动状态由法向马赫数 $M_n = u_n/a$ 分类。我们为每种状态分析特征值的符号：\n\n1.  **超音速出流 ($u_n  0, M_n  1$)**：由于 $u_n  a$，所有三个特征值都为正：$\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，$\\lambda_3 = u_n + a  0$。所有信息都从域中传出。因此，$n_{\\text{in}} = 0$，不施加边界条件。边界上的状态完全由内部流动决定，通常通过外推得到。\n\n2.  **亚音速出流 ($u_n  0, 0  M_n  1$)**：由于 $0  u_n  a$，我们有 $\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，$\\lambda_3 = u_n + a  0$。一个特征线进入域中。因此，$n_{\\text{in}} = 1$，必须提供一个标量边界条件。对于亚音速出口，通常指定静压 $p_{\\text{bc}} = p_{\\text{ref}}$。\n\n3.  **亚音速入流 ($u_n  0, |M_n|  1$)**：由于 $-a  u_n  0$，我们有 $\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，$\\lambda_3 = u_n + a  0$。两个特征线进入域中。因此，$n_{\\text{in}} = 2$，需要两个标量条件。这些通常从远场或储气库状态提供。\n\n4.  **超音速入流 ($u_n  0, |M_n|  1$)**：由于 $u_n  -a$，所有三个特征值都为负：$\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，$\\lambda_3 = u_n + a  0$。所有信息都传播到域中。因此，$n_{\\text{in}} = 3$，必须从储气库中指定整个流动状态（$\\rho, u_n, p$）。\n\n### 基于特征线的算法实现\n\n问题提供了使用称为黎曼不变量（$w^+, w^-$）的特征变量和熵（通过等熵常数 $K = p/\\rho^\\gamma$）来实现这些条件的具体公式。\n\n**出流 ($u_n \\ge 0$)：**\n一个稳健的处理方法必须平滑地处理亚音速和超音速出流之间的过渡。问题定义了一种在跨音速区域 $M_{\\text{low}}  M_n  M_{\\text{up}}$ 中使用切换函数 $s(M_n)$ 的混合方法，其中 $M_{\\text{low}} = 1 - \\delta$ 且 $M_{\\text{up}} = 1 + \\delta$。\n边界状态 $(\\rho, u_n, p)_{\\text{bc}}$ 是一个加权平均值：\n$$(\\rho, u_n, p)_{\\text{bc}} = (1-s(M_n))(\\rho, u_n, p)_{\\text{sup}} + s(M_n)(\\rho, u_n, p)_{\\text{sub}}$$\n-   超音速状态 $(\\rho, u_n, p)_{\\text{sup}}$ 就是外推的内场状态 $(\\rho, u_n, p)_{\\text{int}}$，与 $n_{\\text{in}}=0$ 一致。\n-   亚音速状态 $(\\rho, u_n, p)_{\\text{sub}}$ 通过施加一个条件（$p_{\\text{sub}} = p_{\\text{ref}}$）并使用来自内部的两个传出特征线的信息来计算。这是通过从内场状态守恒黎曼不变量 $w^+ = u_n + \\frac{2a}{\\gamma-1}$ 和等熵常数 $K = p/\\rho^\\gamma$ 来实现的。已知 $p_{\\text{sub}}$ 和 $K_{\\text{int}}$ 后，可以求得 $\\rho_{\\text{sub}}$ 和 $a_{\\text{sub}}$。然后，从守恒的 $w^+_{\\text{int}}$ 求得 $u_{n,\\text{sub}}$。\n\n**入流 ($u_n  0$)：**\n-   **亚音速入流 ($|M_n|  1$, $n_{\\text{in}}=2$)**：需要两个条件。边界条件是通过从储气库状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$ 获取两个传入特征线的属性，并从内部获取一个传出特征线的属性来构建的。这意味着传入的黎曼不变量 $w^- = u_n - \\frac{2a}{\\gamma-1}$ 和熵（通过 $K$）被设置为它们的储气库值（$w^-_\\infty, K_\\infty$）。传出的黎曼不变量 $w^+$ 从内部获取（$w^+_{\\text{int}}$）。这提供了一个方程组来求解边界状态 $(\\rho, u_n, p)_{\\text{bc}}$。\n-   **超音速入流 ($|M_n| \\ge 1$, $n_{\\text{in}}=3$)**：所有信息都来自外部。边界状态简单地设置为储气库状态：$(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$。\n\n以下程序为指定的测试用例实现了这一逻辑。它首先计算内部马赫数 $M_n$ 和传入特征线的数量 $n_{\\text{in}}$。然后，它根据 $u_n$ 的符号和 $M_n$ 的值应用适当的逻辑来确定最终的边界状态。",
            "answer": "```python\nimport numpy as np\n\n# Global constants from the problem statement\nGAMMA = 1.4\nDELTA = 0.05\nP_REF = 101325.0\nRHO_INF = 1.2\nU_N_INF = -200.0\nP_INF = 300000.0\n\ndef solve():\n    \"\"\"\n    Solves the mixed supersonic/subsonic outlet boundary condition problem\n    for a series of test cases.\n    \"\"\"\n    \n    m_low = 1.0 - DELTA\n    m_up = 1.0 + DELTA\n\n    # Pre-calculate reservoir properties\n    a_inf = np.sqrt(GAMMA * P_INF / RHO_INF)\n    k_inf = P_INF / (RHO_INF**GAMMA)\n    w_minus_inf = U_N_INF - 2.0 * a_inf / (GAMMA - 1.0)\n    \n    # Define test cases. For cases with u_n defined relative to a_int,\n    # we first calculate a_int and then u_n.\n    p_base_int = 100000.0\n    rho_base_int = 0.5\n    a_base_int = np.sqrt(GAMMA * p_base_int / rho_base_int)\n\n    test_cases = [\n        # Case A (strict supersonic outflow)\n        (rho_base_int, 600.0, p_base_int),\n        # Case B (slightly subsonic outflow pocket)\n        (rho_base_int, 0.98 * a_base_int, p_base_int),\n        # Case C (near-sonic outflow, M_n = 1.01)\n        (rho_base_int, 1.01 * a_base_int, p_base_int),\n        # Case D (near-sonic outflow, M_n = 0.99)\n        (rho_base_int, 0.99 * a_base_int, p_base_int),\n        # Case E (subsonic inflow through the outlet)\n        (rho_base_int, -100.0, p_base_int),\n        # Case F (supersonic inflow through the outlet)\n        (rho_base_int, -600.0, p_base_int),\n    ]\n\n    final_results = []\n\n    for rho_int, u_n_int, p_int in test_cases:\n        a_int = np.sqrt(GAMMA * p_int / rho_int)\n        m_n_int = u_n_int / a_int if a_int != 0 else 0.0\n\n        # Task 1: Calculate the number of incoming characteristics\n        lambda1 = u_n_int - a_int\n        lambda2 = u_n_int\n        lambda3 = u_n_int + a_int\n        n_in = sum(1 for lam in [lambda1, lambda2, lambda3] if lam  0)\n\n        rho_bc, u_n_bc, p_bc = 0.0, 0.0, 0.0\n\n        # Task 3: Compute boundary state based on flow regime\n        if u_n_int >= 0:  # Outflow\n            # Supersonic limit state (extrapolation)\n            rho_sup, u_n_sup, p_sup = rho_int, u_n_int, p_int\n\n            # Subsonic limit state (pressure-based)\n            p_sub = P_REF\n            k_int = p_int / (rho_int**GAMMA)\n            rho_sub = (p_sub / k_int)**(1.0 / GAMMA)\n            a_sub = np.sqrt(GAMMA * p_sub / rho_sub)\n            w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n            u_n_sub = w_plus_int - 2.0 * a_sub / (GAMMA - 1.0)\n            \n            # Blending function s(M_n)\n            s = 0.0\n            if m_n_int = m_low:\n                s = 1.0\n            elif m_low  m_n_int  m_up:\n                s = (m_up - m_n_int) / (m_up - m_low)\n            \n            # Blended boundary state\n            rho_bc = (1.0 - s) * rho_sup + s * rho_sub\n            u_n_bc = (1.0 - s) * u_n_sup + s * u_n_sub\n            p_bc = (1.0 - s) * p_sup + s * p_sub\n            \n        else:  # Inflow (reversed flow)\n            if abs(m_n_int)  1.0: # Subsonic inflow\n                w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n                \n                a_bc = (GAMMA - 1.0) / 4.0 * (w_plus_int - w_minus_inf)\n                u_n_bc = 0.5 * (w_plus_int + w_minus_inf)\n                rho_bc = (a_bc**2 / (GAMMA * k_inf))**(1.0 / (GAMMA - 1.0))\n                p_bc = k_inf * rho_bc**GAMMA\n            else: # Supersonic inflow\n                rho_bc, u_n_bc, p_bc = RHO_INF, U_N_INF, P_INF\n\n        # Store results for this case, rounded to 6 decimal places\n        final_results.extend([\n            n_in,\n            round(m_n_int, 6),\n            round(rho_bc, 6),\n            round(u_n_bc, 6),\n            round(p_bc, 6)\n        ])\n\n    # Format the final output string as a comma-separated list in brackets\n    output_str = \"[\" + \",\".join(map(str, final_results)) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}