{
    "hands_on_practices": [
        {
            "introduction": "The elegance of the Roe solver lies in a specific mathematical property: its ability to represent the flux difference between two states, $F(U_R) - F(U_L)$, exactly using a single, constant-coefficient matrix $A(\\tilde{U})$ that acts on the state jump, $U_R - U_L$. This foundational \"Roe property,\" $A(\\tilde{U})(U_R - U_L) = F(U_R) - F(U_L)$, is the theoretical bedrock of the entire method. This first practice provides a concrete, hands-on verification of this identity, guiding you to manually compute all components—state vectors, flux vectors, and the Roe-averaged matrix—to confirm that the property holds exactly for a given set of states . This exercise builds a deep, intuitive understanding of why the specific form of Roe's averages is so powerful.",
            "id": "3992129",
            "problem": "Consider the one-dimensional compressible Euler equations for an ideal gas, as used in Computational Fluid Dynamics (CFD). Let the conserved variable vector be $U = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}}$, where $\\rho$ is the density, $u$ is the velocity, and $E$ is the total specific energy. The ideal-gas relation is $p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho u^{2}\\right)$, and the corresponding physical flux is $F(U) = (\\rho u,\\ \\rho u^{2} + p,\\ u(\\rho E + p))^{\\mathsf{T}}$. Define the total specific enthalpy $H = E + \\frac{p}{\\rho}$. For Roe’s linearization, the Roe-averaged velocity and enthalpy are defined by\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_{L}}\\,u_{L} + \\sqrt{\\rho_{R}}\\,u_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}}, \n\\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_{L}}\\,H_{L} + \\sqrt{\\rho_{R}}\\,H_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}},\n$$\nand the Roe-averaged sound speed satisfies $\\tilde{a}^{2} = (\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2}\\tilde{u}^{2}\\right)$.\n\nTake the following left and right states (all quantities are physically consistent and refer to the same ideal gas with ratio of specific heats $\\gamma = \\tfrac{7}{5}$):\n- Left state: $\\rho_{L} = 4$ kg/m$^{3}$, $u_{L} = 2$ m/s, $p_{L} = 10$ Pa.\n- Right state: $\\rho_{R} = 9$ kg/m$^{3}$, $u_{R} = 1$ m/s, $p_{R} = 20$ Pa.\n\nCompute $U_{L}$ and $U_{R}$ using $E = \\tfrac{p}{(\\gamma-1)\\rho} + \\tfrac{1}{2}u^{2}$, then compute $F(U_{L})$ and $F(U_{R})$. Using the Roe averages above, form the $3\\times 3$ flux Jacobian $A(\\tilde{U}) = \\frac{\\partial F}{\\partial U}\\big|_{\\tilde{U}}$ evaluated at the Roe-averaged state $\\tilde{U}$ (expressed in terms of $(\\tilde{u}, \\tilde{H}, \\gamma)$). Finally, evaluate the residual vector\n$$\nR \\equiv A(\\tilde{U})\\,(U_{R} - U_{L}) - \\big(F(U_{R}) - F(U_{L})\\big).\n$$\n\nCompute $R$ exactly and provide its three components as a single row vector. No rounding is required. Do not include units in your final numeric answer.",
            "solution": "The user wants to compute the residual vector $R \\equiv A(\\tilde{U})\\,(U_{R} - U_{L}) - \\big(F(U_{R}) - F(U_{L})\\big)$ for a specific set of left and right states in the context of the 1D Euler equations. The core of this problem is to verify that the Roe-averaged matrix satisfies the property $A(\\tilde{U})\\Delta U = \\Delta F$, which is a fundamental requirement for Roe's approximate Riemann solver. This implies that the residual vector $R$ should be the zero vector. We will perform the explicit calculation to verify this.\n\nThe ratio of specific heats is given as $\\gamma = \\frac{7}{5}$. Therefore, $\\gamma-1 = \\frac{2}{5}$.\n\n**Step 1: Compute State Vectors $U_{L}$ and $U_{R}$**\n\nThe total specific energy $E$ is given by $E = \\frac{p}{(\\gamma-1)\\rho} + \\frac{1}{2}u^{2}$.\n\nFor the left state $(L)$:\n$\\rho_{L} = 4$, $u_{L} = 2$, $p_{L} = 10$.\nThe total specific energy $E_{L}$ is:\n$$E_{L} = \\frac{p_{L}}{(\\gamma-1)\\rho_{L}} + \\frac{1}{2}u_{L}^{2} = \\frac{10}{(\\frac{2}{5})(4)} + \\frac{1}{2}(2)^{2} = \\frac{10}{\\frac{8}{5}} + \\frac{4}{2} = \\frac{50}{8} + 2 = \\frac{25}{4} + 2 = \\frac{33}{4}$$\nThe conserved variable vector $U_{L}$ is:\n$$U_{L} = \\begin{pmatrix} \\rho_{L} \\\\ \\rho_{L} u_{L} \\\\ \\rho_{L} E_{L} \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ 4(2) \\\\ 4(\\frac{33}{4}) \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ 8 \\\\ 33 \\end{pmatrix}$$\n\nFor the right state $(R)$:\n$\\rho_{R} = 9$, $u_{R} = 1$, $p_{R} = 20$.\nThe total specific energy $E_{R}$ is:\n$$E_{R} = \\frac{p_{R}}{(\\gamma-1)\\rho_{R}} + \\frac{1}{2}u_{R}^{2} = \\frac{20}{(\\frac{2}{5})(9)} + \\frac{1}{2}(1)^{2} = \\frac{20}{\\frac{18}{5}} + \\frac{1}{2} = \\frac{100}{18} + \\frac{1}{2} = \\frac{50}{9} + \\frac{1}{2} = \\frac{100+9}{18} = \\frac{109}{18}$$\nThe conserved variable vector $U_{R}$ is:\n$$U_{R} = \\begin{pmatrix} \\rho_{R} \\\\ \\rho_{R} u_{R} \\\\ \\rho_{R} E_{R} \\end{pmatrix} = \\begin{pmatrix} 9 \\\\ 9(1) \\\\ 9(\\frac{109}{18}) \\end{pmatrix} = \\begin{pmatrix} 9 \\\\ 9 \\\\ \\frac{109}{2} \\end{pmatrix}$$\n\n**Step 2: Compute Flux Vectors $F(U_{L})$ and $F(U_{R})$**\n\nThe flux vector $F(U)$ is given by $F(U) = (\\rho u, \\rho u^{2}+p, u(\\rho E + p))^{\\mathsf{T}}$.\n\nFor the left state $(L)$:\n$$F(U_{L}) = \\begin{pmatrix} \\rho_{L} u_{L} \\\\ \\rho_{L} u_{L}^{2} + p_{L} \\\\ u_{L}(\\rho_{L} E_{L} + p_{L}) \\end{pmatrix} = \\begin{pmatrix} 4(2) \\\\ 4(2)^{2} + 10 \\\\ 2(33 + 10) \\end{pmatrix} = \\begin{pmatrix} 8 \\\\ 16 + 10 \\\\ 2(43) \\end{pmatrix} = \\begin{pmatrix} 8 \\\\ 26 \\\\ 86 \\end{pmatrix}$$\n\nFor the right state $(R)$:\n$$F(U_{R}) = \\begin{pmatrix} \\rho_{R} u_{R} \\\\ \\rho_{R} u_{R}^{2} + p_{R} \\\\ u_{R}(\\rho_{R} E_{R} + p_{R}) \\end{pmatrix} = \\begin{pmatrix} 9(1) \\\\ 9(1)^{2} + 20 \\\\ 1(\\frac{109}{2} + 20) \\end{pmatrix} = \\begin{pmatrix} 9 \\\\ 9 + 20 \\\\ \\frac{109+40}{2} \\end{pmatrix} = \\begin{pmatrix} 9 \\\\ 29 \\\\ \\frac{149}{2} \\end{pmatrix}$$\n\n**Step 3: Compute Differences $\\Delta U$ and $\\Delta F$**\n\n$$\\Delta U = U_{R} - U_{L} = \\begin{pmatrix} 9 - 4 \\\\ 9 - 8 \\\\ \\frac{109}{2} - 33 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 1 \\\\ \\frac{109 - 66}{2} \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 1 \\\\ \\frac{43}{2} \\end{pmatrix}$$\n$$\\Delta F = F(U_{R}) - F(U_{L}) = \\begin{pmatrix} 9 - 8 \\\\ 29 - 26 \\\\ \\frac{149}{2} - 86 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 3 \\\\ \\frac{149 - 172}{2} \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 3 \\\\ -\\frac{23}{2} \\end{pmatrix}$$\n\n**Step 4: Compute Roe Averages $\\tilde{u}$ and $\\tilde{H}$**\n\nFirst, compute specific enthalpies $H_{L}$ and $H_{R}$ using $H = E + \\frac{p}{\\rho}$.\n$$H_{L} = E_{L} + \\frac{p_{L}}{\\rho_{L}} = \\frac{33}{4} + \\frac{10}{4} = \\frac{43}{4}$$\n$$H_{R} = E_{R} + \\frac{p_{R}}{\\rho_{R}} = \\frac{109}{18} + \\frac{20}{9} = \\frac{109 + 40}{18} = \\frac{149}{18}$$\nNow, compute the Roe averages. We have $\\sqrt{\\rho_{L}} = \\sqrt{4} = 2$ and $\\sqrt{\\rho_{R}} = \\sqrt{9} = 3$.\n$$\\tilde{u} = \\frac{\\sqrt{\\rho_{L}}\\,u_{L} + \\sqrt{\\rho_{R}}\\,u_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} = \\frac{2(2) + 3(1)}{2+3} = \\frac{4+3}{5} = \\frac{7}{5}$$\n$$\\tilde{H} = \\frac{\\sqrt{\\rho_{L}}\\,H_{L} + \\sqrt{\\rho_{R}}\\,H_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} = \\frac{2(\\frac{43}{4}) + 3(\\frac{149}{18})}{5} = \\frac{\\frac{43}{2} + \\frac{149}{6}}{5} = \\frac{\\frac{3(43)+149}{6}}{5} = \\frac{129+149}{30} = \\frac{278}{30} = \\frac{139}{15}$$\n\n**Step 5: Form the Roe Matrix $A(\\tilde{U})$**\n\nThe flux Jacobian matrix $A(U) = \\frac{\\partial F}{\\partial U}$ evaluated at a state with velocity $u$ and specific enthalpy $H$ is:\n$$A(u, H) = \\begin{pmatrix} 0  1  0 \\\\ \\frac{\\gamma-3}{2}u^2  (3-\\gamma)u  \\gamma-1 \\\\ u\\left(\\frac{\\gamma-1}{2}u^2-H\\right)  H - (\\gamma-1)u^2  \\gamma u \\end{pmatrix}$$\nWe evaluate this matrix at the Roe-averaged state $(\\tilde{u}, \\tilde{H})$. We have $\\gamma=\\frac{7}{5}$, so $\\gamma-1=\\frac{2}{5}$, $3-\\gamma=\\frac{8}{5}$, and $\\frac{\\gamma-3}{2}=-\\frac{4}{5}$.\nLet's compute the components of $A(\\tilde{U}) = A(\\tilde{u}, \\tilde{H})$:\n$A_{11} = 0$, $A_{12} = 1$, $A_{13} = 0$.\n$A_{21} = \\frac{\\gamma-3}{2}\\tilde{u}^{2} = -\\frac{4}{5}\\left(\\frac{7}{5}\\right)^{2} = -\\frac{4}{5}\\left(\\frac{49}{25}\\right) = -\\frac{196}{125}$.\n$A_{22} = (3-\\gamma)\\tilde{u} = \\frac{8}{5}\\left(\\frac{7}{5}\\right) = \\frac{56}{25}$.\n$A_{23} = \\gamma-1 = \\frac{2}{5}$.\n$A_{31} = \\tilde{u}\\left(\\frac{\\gamma-1}{2}\\tilde{u}^{2}-\\tilde{H}\\right) = \\frac{7}{5}\\left(\\frac{1}{2}\\left(\\frac{2}{5}\\right)\\left(\\frac{7}{5}\\right)^{2} - \\frac{139}{15}\\right) = \\frac{7}{5}\\left(\\frac{49}{125} - \\frac{139}{15}\\right) = \\frac{7}{5}\\left(\\frac{49 \\cdot 3 - 139 \\cdot 25}{375}\\right) = \\frac{7}{5}\\left(\\frac{147 - 3475}{375}\\right) = \\frac{7}{5}\\left(\\frac{-3328}{375}\\right) = -\\frac{23296}{1875}$.\n$A_{32} = \\tilde{H} - (\\gamma-1)\\tilde{u}^{2} = \\frac{139}{15} - \\frac{2}{5}\\left(\\frac{7}{5}\\right)^{2} = \\frac{139}{15} - \\frac{98}{125} = \\frac{139 \\cdot 25 - 98 \\cdot 3}{375} = \\frac{3475-294}{375} = \\frac{3181}{375}$.\n$A_{33} = \\gamma \\tilde{u} = \\frac{7}{5}\\left(\\frac{7}{5}\\right) = \\frac{49}{25}$.\n\nSo, the Roe matrix is:\n$$A(\\tilde{U}) = \\begin{pmatrix} 0  1  0 \\\\ -\\frac{196}{125}  \\frac{56}{25}  \\frac{2}{5} \\\\ -\\frac{23296}{1875}  \\frac{3181}{375}  \\frac{49}{25} \\end{pmatrix}$$\n\n**Step 6: Compute the Residual Vector $R$**\n\nWe compute the product $A(\\tilde{U})\\Delta U$ component by component.\nFirst component:\n$$(A(\\tilde{U})\\Delta U)_1 = (0)(5) + (1)(1) + (0)\\left(\\frac{43}{2}\\right) = 1$$\nSecond component:\n$$(A(\\tilde{U})\\Delta U)_2 = \\left(-\\frac{196}{125}\\right)(5) + \\left(\\frac{56}{25}\\right)(1) + \\left(\\frac{2}{5}\\right)\\left(\\frac{43}{2}\\right) = -\\frac{196}{25} + \\frac{56}{25} + \\frac{43}{5} = \\frac{-196+56}{25} + \\frac{215}{25} = \\frac{-140+215}{25} = \\frac{75}{25} = 3$$\nThird component:\n$$(A(\\tilde{U})\\Delta U)_3 = \\left(-\\frac{23296}{1875}\\right)(5) + \\left(\\frac{3181}{375}\\right)(1) + \\left(\\frac{49}{25}\\right)\\left(\\frac{43}{2}\\right) = -\\frac{23296}{375} + \\frac{3181}{375} + \\frac{2107}{50} = \\frac{-20115}{375} + \\frac{2107}{50}$$\nTo simplify the first term, we divide the numerator and denominator by common factors. $375 = 3 \\cdot 5^3 = 3 \\cdot 125$. $20115$ is divisible by $3$ and $5$. $20115/15 = 1341$ and $375/15=25$. So, $-\\frac{20115}{375} = -\\frac{1341}{25}$.\n$$(A(\\tilde{U})\\Delta U)_3 = -\\frac{1341}{25} + \\frac{2107}{50} = -\\frac{2682}{50} + \\frac{2107}{50} = \\frac{-575}{50} = -\\frac{115}{10} = -\\frac{23}{2}$$\nSo, we have:\n$$A(\\tilde{U})\\Delta U = \\begin{pmatrix} 1 \\\\ 3 \\\\ -\\frac{23}{2} \\end{pmatrix}$$\nNow we compute the residual vector $R$:\n$$R = A(\\tilde{U})\\Delta U - \\Delta F = \\begin{pmatrix} 1 \\\\ 3 \\\\ -\\frac{23}{2} \\end{pmatrix} - \\begin{pmatrix} 1 \\\\ 3 \\\\ -\\frac{23}{2} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\nThe calculation confirms that for the given states, the Roe matrix satisfies the required property, and the residual is the zero vector.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  0  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Moving from theoretical verification to practical application, this practice challenges you to implement a complete Roe solver from first principles. You will construct a program that computes the numerical flux based on its wave-decomposition form, $F^{\\text{Roe}} = \\frac{1}{2}(F_L + F_R) - \\frac{1}{2}\\sum_{k} |\\lambda_k|\\alpha_k r_k$. This exercise  is a core skill for any CFD developer, as it requires translating the theory of characteristic decomposition into a robust computational algorithm. By coding the solver yourself, you will reinforce the physical meaning of the Roe eigenvalues ($\\lambda_k$) as wave speeds and the eigenvectors ($r_k$) as the structure of these waves.",
            "id": "3992156",
            "problem": "You are to implement a program that computes the numerical flux for the one-dimensional compressible Euler equations using Roe’s approximate Riemann solver in its wave-decomposition form. The solver must be constructed from first principles using the governing conservation laws, ideal gas thermodynamics, and a linearization about the Roe-averaged state. The implementation must be purely algorithmic and must not rely on pre-derived shortcut formulas beyond the fundamental definitions.\n\nThe starting point is the one-dimensional Euler equations for a calorically perfect gas, expressed in conservation form for the vector of conserved variables $U=\\begin{bmatrix}\\rho \\\\ \\rho u \\\\ E\\end{bmatrix}$, where $\\rho$ is density in $\\mathrm{kg/m^3}$, $u$ is velocity in $\\mathrm{m/s}$, and $E$ is total energy per unit volume in $\\mathrm{J/m^3}$. The corresponding physical flux is $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$, where $p$ is the pressure in $\\mathrm{Pa}$. For an ideal gas, the equation of state is $p=(\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$, with $\\gamma$ the ratio of specific heats (dimensionless). The specific total enthalpy is defined as $H=\\tfrac{E+p}{\\rho}$.\n\nYour task is to:\n- Implement the Roe-averaged state for the left and right states $U_L$ and $U_R$, with the Roe averages defined using the standard square-root-of-density-weighted averages. From the Roe-averaged state, construct the wave speeds (eigenvalues) and the right eigenvectors of the flux Jacobian in conserved variables.\n- Compute the jump in conserved variables $\\Delta U = U_R - U_L$ and decompose it into the basis of right eigenvectors about the Roe-averaged state to obtain wave strengths.\n- Assemble the numerical flux using the wave-decomposition structure of Roe’s solver, ensuring that the dissipation term is built from the absolute values of the Roe eigenvalues multiplied by the corresponding wave strengths and eigenvectors.\n- Use the ideal gas law consistently to convert between primitive and conserved variables.\n\nImplementation details:\n- The input states are specified in primitive variables $(\\rho, u, p)$ for both left and right states and a given $\\gamma$. Your program must internally convert these to conserved variables.\n- All computations must be done in the International System of Units (SI): $\\rho$ in $\\mathrm{kg/m^3}$, $u$ in $\\mathrm{m/s}$, $p$ in $\\mathrm{Pa}$, and $E$ in $\\mathrm{J/m^3}$. The flux components must be computed and returned in consistent SI units: mass flux in $\\mathrm{kg/(m^2\\cdot s)}$, momentum flux in $\\mathrm{N/m^2}$ (which is $\\mathrm{Pa}$), and energy flux in $\\mathrm{W/m^2}$.\n- For the Euler system, use the eigenstructure evaluated at the Roe-averaged state. The Roe-averaged velocity $\\tilde{u}$, enthalpy $\\tilde{H}$, and sound speed $\\tilde{a}$ must be computed from $(U_L,U_R)$ using the ideal gas relation and the definition of $H$.\n\nTest suite:\nYou must compute the numerical flux for the following four test cases, each given as $(\\rho_L, u_L, p_L; \\rho_R, u_R, p_R; \\gamma)$:\n1. $U_L$: $\\rho_L=1.0$, $u_L=0.0$, $p_L=100000$; $U_R$: $\\rho_R=0.125$, $u_R=0.0$, $p_R=10000$; $\\gamma=1.4$.\n2. $U_L$: $\\rho_L=1.225$, $u_L=800.0$, $p_L=101325$; $U_R$: $\\rho_R=1.225$, $u_R=700.0$, $p_R=101325$; $\\gamma=1.4$.\n3. $U_L$: $\\rho_L=1.0$, $u_L=100.0$, $p_L=100000$; $U_R$: $\\rho_R=0.9$, $u_R=-50.0$, $p_R=95000$; $\\gamma=1.4$.\n4. $U_L$: $\\rho_L=1.0$, $u_L=400.0$, $p_L=100000$; $U_R$: $\\rho_R=1.0$, $u_R=350.0$, $p_R=100000$; $\\gamma=1.4$.\n\nRequired final output:\n- For each test case, compute the Roe numerical flux vector $F^{\\text{Roe}}=\\begin{bmatrix}f_1 \\\\ f_2 \\\\ f_3\\end{bmatrix}$ and output its three components in the order $f_1$ (mass flux), $f_2$ (momentum flux), $f_3$ (energy flux).\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the flux components for each test case concatenated in sequence. For example, the format must be $\\left[\\text{case1\\_f1},\\text{case1\\_f2},\\text{case1\\_f3},\\text{case2\\_f1},\\dots\\right]$.\n- Each entry in the output list must be a floating-point number in SI units as specified above.\n\nAssumptions:\n- The gas is calorically perfect with constant $\\gamma$.\n- All provided states are physically admissible, with $\\rho>0$ and $p>0$.",
            "solution": "The one-dimensional compressible Euler equations express conservation of mass, momentum, and energy for an inviscid fluid. The vector of conserved variables is $U=\\begin{bmatrix}\\rho \\\\ \\rho u \\\\ E\\end{bmatrix}$, and their corresponding flux is $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$. The thermodynamic closure for an ideal gas is $p=(\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$, and the specific total enthalpy is $H=\\tfrac{E+p}{\\rho}$. The goal is to construct Roe’s approximate Riemann solver, which uses a constant Jacobian matrix linearized about a suitably averaged state to mimic the exact Riemann solution’s wave structure while being computationally efficient.\n\nPrinciples and derivation:\n1. Governing laws and flux: The conservation laws are\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0,\n$$\nwith $U=\\begin{bmatrix}\\rho \\\\ \\rho u \\\\ E\\end{bmatrix}$ and $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$. The pressure satisfies $p=(\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$.\n\n2. Roe linearization: Roe’s method constructs a constant-coefficient approximation to the flux Jacobian between a left state $U_L$ and a right state $U_R$ by evaluating the eigenstructure at a Roe-averaged state. Define the primitive variables $(\\rho_L, u_L, p_L)$ and $(\\rho_R, u_R, p_R)$ and convert them to conserved variables via\n$$\nE_L = \\frac{p_L}{\\gamma - 1} + \\frac{1}{2}\\rho_L u_L^2, \\quad E_R = \\frac{p_R}{\\gamma - 1} + \\frac{1}{2}\\rho_R u_R^2,\n$$\n$$\nU_L=\\begin{bmatrix}\\rho_L \\\\ \\rho_L u_L \\\\ E_L\\end{bmatrix}, \\quad U_R=\\begin{bmatrix}\\rho_R \\\\ \\rho_R u_R \\\\ E_R\\end{bmatrix}.\n$$\nThe specific total enthalpy at left and right are\n$$\nH_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}.\n$$\nUsing Roe’s density-weighted averages with weights $\\sqrt{\\rho_L}$ and $\\sqrt{\\rho_R}$, the Roe-averaged velocity $\\tilde{u}$ and enthalpy $\\tilde{H}$ are\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}.\n$$\nThe Roe-averaged speed of sound $\\tilde{a}$ follows from the ideal gas relation:\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}(\\tilde{u})^2\\right)}.\n$$\n\n3. Eigenstructure of the flux Jacobian: For the one-dimensional Euler equations, the eigenvalues (wave speeds) at the Roe-averaged state are\n$$\n\\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a}.\n$$\nA consistent set of right eigenvectors in conserved variables evaluated at the Roe-averaged state is\n$$\nr_1 = \\begin{bmatrix}1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u} \\tilde{a}\\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix}1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}(\\tilde{u})^2\\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix}1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u} \\tilde{a}\\end{bmatrix}.\n$$\nThese vectors span the state space for admissible Roe-averaged states ($\\tilde{a} > 0$).\n\n4. Wave decomposition: The jump in conserved variables $\\Delta U = U_R - U_L$ can be decomposed in the eigenbasis via\n$$\n\\Delta U = \\alpha_1 r_1 + \\alpha_2 r_2 + \\alpha_3 r_3,\n$$\nwhere the wave strengths $\\alpha_k$ are obtained by solving the $3\\times 3$ linear system $R \\alpha = \\Delta U$ with\n$$\nR = \\begin{bmatrix} r_1  r_2  r_3 \\end{bmatrix}, \\quad \\alpha = \\begin{bmatrix}\\alpha_1 \\\\ \\alpha_2 \\\\ \\alpha_3\\end{bmatrix}.\n$$\nThis computation uses only the fundamental definitions of $r_k$ and avoids reliance on closed-form shortcut expressions for $\\alpha_k$.\n\n5. Roe numerical flux: The Roe flux at the interface is assembled as\n$$\nF^{\\text{Roe}} = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{k=1}^3 |\\lambda_k| \\alpha_k r_k,\n$$\nwhere $|\\lambda_k|$ are the absolute values of the Roe eigenvalues. The first term is the arithmetic average of physical fluxes, and the second term is a dissipation correction aligned with the characteristic structure.\n\n6. Algorithmic steps:\n- Convert $(\\rho,u,p)$ to $U$ using $E=\\tfrac{p}{\\gamma - 1} + \\tfrac{1}{2}\\rho u^2$.\n- Compute $F(U)$ using the definition $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$ with $p=(\\gamma-1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$.\n- Form Roe averages $\\tilde{u}$, $\\tilde{H}$, and $\\tilde{a}$ from $(U_L,U_R)$.\n- Build the eigenvalues $\\lambda_k$ and right eigenvectors $r_k$ at the Roe-averaged state, assemble $R$, and compute $\\alpha$ from $R\\alpha=\\Delta U$.\n- Compute $F^{\\text{Roe}}$ via the wave-decomposition formula above.\n- Repeat for each test case.\n\n7. Units and output:\nAll inputs and outputs use SI units. The final numerical flux components are, respectively, mass flux in $\\mathrm{kg/(m^2\\cdot s)}$, momentum flux in $\\mathrm{N/m^2}$, and energy flux in $\\mathrm{W/m^2}$. For the four test cases, output a single line with a comma-separated list enclosed in brackets containing the sequence\n$$\n\\left[f_{1}^{(1)}, f_{2}^{(1)}, f_{3}^{(1)}, f_{1}^{(2)}, f_{2}^{(2)}, f_{3}^{(2)}, f_{1}^{(3)}, f_{2}^{(3)}, f_{3}^{(3)}, f_{1}^{(4)}, f_{2}^{(4)}, f_{3}^{(4)}\\right].\n$$\n\nThis construction rests on the fundamental governing equations and thermodynamic relations, translates them into a linearized characteristic representation about the Roe-averaged state, and assembles a consistent approximate Riemann solver without recourse to undocumented or shortcut formulas.",
            "answer": "```python\nimport numpy as np\n\ndef primitive_to_conserved(rho, u, p, gamma):\n    \"\"\"\n    Convert primitive variables to conserved variables for 1D Euler.\n    rho: density [kg/m^3]\n    u: velocity [m/s]\n    p: pressure [Pa]\n    gamma: ratio of specific heats [-]\n    Returns U = [rho, rho*u, E] with E [J/m^3]\n    \"\"\"\n    E = p / (gamma - 1.0) + 0.5 * rho * u * u\n    return np.array([rho, rho * u, E], dtype=float)\n\ndef conserved_to_primitive(U, gamma):\n    \"\"\"\n    Convert conserved variables to primitive variables for 1D Euler.\n    U: [rho, rho*u, E]\n    Returns rho, u, p\n    \"\"\"\n    rho = U[0]\n    mom = U[1]\n    E = U[2]\n    u = mom / rho\n    p = (gamma - 1.0) * (E - 0.5 * rho * u * u)\n    return rho, u, p\n\ndef flux_euler(U, gamma):\n    \"\"\"\n    Physical flux for 1D Euler in conserved variables.\n    F(U) = [rho*u, rho*u^2 + p, u*(E + p)]\n    \"\"\"\n    rho, u, p = conserved_to_primitive(U, gamma)\n    E = U[2]\n    return np.array([rho * u, rho * u * u + p, u * (E + p)], dtype=float)\n\ndef roe_average(U_L, U_R, gamma):\n    \"\"\"\n    Compute Roe-averaged velocity, enthalpy, and sound speed between U_L and U_R.\n    \"\"\"\n    rho_L, u_L, p_L = conserved_to_primitive(U_L, gamma)\n    rho_R, u_R, p_R = conserved_to_primitive(U_R, gamma)\n    E_L = U_L[2]\n    E_R = U_R[2]\n    H_L = (E_L + p_L) / rho_L\n    H_R = (E_R + p_R) / rho_R\n\n    srL = np.sqrt(rho_L)\n    srR = np.sqrt(rho_R)\n    denom = srL + srR\n\n    u_tilde = (srL * u_L + srR * u_R) / denom\n    H_tilde = (srL * H_L + srR * H_R) / denom\n    a_tilde_sq = (gamma - 1.0) * (H_tilde - 0.5 * u_tilde * u_tilde)\n    # Guard against slight negative due to round-off; clamp minimum at small positive\n    a_tilde_sq = max(a_tilde_sq, 1e-12)\n    a_tilde = np.sqrt(a_tilde_sq)\n    return u_tilde, H_tilde, a_tilde\n\ndef roe_eigenstructure(u_tilde, H_tilde, a_tilde):\n    \"\"\"\n    Construct eigenvalues and right eigenvectors for Roe-averaged state.\n    \"\"\"\n    lam1 = u_tilde - a_tilde\n    lam2 = u_tilde\n    lam3 = u_tilde + a_tilde\n\n    r1 = np.array([1.0, u_tilde - a_tilde, H_tilde - u_tilde * a_tilde], dtype=float)\n    r2 = np.array([1.0, u_tilde, 0.5 * u_tilde * u_tilde], dtype=float)\n    r3 = np.array([1.0, u_tilde + a_tilde, H_tilde + u_tilde * a_tilde], dtype=float)\n\n    R = np.column_stack((r1, r2, r3))\n    lambdas = np.array([lam1, lam2, lam3], dtype=float)\n    return lambdas, R\n\ndef roe_flux(U_L, U_R, gamma):\n    \"\"\"\n    Compute Roe's approximate Riemann solver flux between left and right states.\n    \"\"\"\n    # Physical fluxes\n    F_L = flux_euler(U_L, gamma)\n    F_R = flux_euler(U_R, gamma)\n\n    # Roe averages and eigenstructure\n    u_tilde, H_tilde, a_tilde = roe_average(U_L, U_R, gamma)\n    lambdas, R = roe_eigenstructure(u_tilde, H_tilde, a_tilde)\n\n    # Wave strengths by solving R * alpha = delta_U\n    delta_U = U_R - U_L\n    # Solve linear system robustly\n    try:\n        alpha = np.linalg.solve(R, delta_U)\n    except np.linalg.LinAlgError:\n        # Fallback: use least-squares if singular (should be rare)\n        alpha = np.linalg.lstsq(R, delta_U, rcond=None)[0]\n\n    dissipation = R @ (np.abs(lambdas) * alpha)\n    F_roe = 0.5 * (F_L + F_R) - 0.5 * dissipation\n    return F_roe\n\ndef solve():\n    gamma = 1.4\n    # Define test cases: (rho_L, u_L, p_L, rho_R, u_R, p_R)\n    test_cases = [\n        (1.0, 0.0, 100000.0, 0.125, 0.0, 10000.0),      # Sod-like shock tube in SI\n        (1.225, 800.0, 101325.0, 1.225, 700.0, 101325.0),  # Supersonic contact-like variation\n        (1.0, 100.0, 100000.0, 0.9, -50.0, 95000.0),    # Transonic mixed states\n        (1.0, 400.0, 100000.0, 1.0, 350.0, 100000.0),   # Near-sonic Roe average\n    ]\n\n    results = []\n    for (rho_L, u_L, p_L, rho_R, u_R, p_R) in test_cases:\n        U_L = primitive_to_conserved(rho_L, u_L, p_L, gamma)\n        U_R = primitive_to_conserved(rho_R, u_R, p_R, gamma)\n        F = roe_flux(U_L, U_R, gamma)\n        # Append flux components in order: mass, momentum, energy\n        results.extend(F.tolist())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "No numerical scheme is perfect, and understanding a method's limitations is as important as knowing its strengths. The standard Roe solver can fail in specific situations, most famously in the case of a \"transonic rarefaction,\" where it may produce an unphysical, entropy-violating expansion shock. This practice  presents just such a stress test. You will be guided to diagnose the problem by observing a vanishing Roe eigenvalue ($\\lambda_k \\approx 0$) and then implement a standard \"entropy fix,\" such as Harten's, to add the necessary numerical dissipation and ensure the scheme correctly captures the physics.",
            "id": "3992160",
            "problem": "Consider the one-dimensional compressible Euler equations in the streamwise direction for an ideal gas, posed as a Riemann problem in Computational Fluid Dynamics (CFD). The gas has constant specific heat ratio $\\gamma = 1.4$. The left and right states are\n$\\rho_{L} = 1.0 \\,\\mathrm{kg/m^3}$, $u_{L} = 400 \\,\\mathrm{m/s}$, $p_{L} = \\dfrac{290000}{7} \\,\\mathrm{Pa}$, and\n$\\rho_{R} = 1.0 \\,\\mathrm{kg/m^3}$, $u_{R} = 100 \\,\\mathrm{m/s}$, $p_{R} = \\dfrac{290000}{7} \\,\\mathrm{Pa}$.\nAssume the ideal-gas relation, and use the standard Roe’s approximate Riemann solver linearization based on Roe averages. Treat this case as a transonic rarefaction across a sonic point in the Roe linearization.\n\nStarting from the definitions of the one-dimensional Euler equations, the ideal-gas enthalpy, and the Roe-averaged state, carry out the following steps:\n- Derive the Roe-averaged velocity $\\tilde{u}$ and Roe-averaged total specific enthalpy $\\tilde{H}$ from the given left and right states.\n- From these, derive the Roe-averaged speed of sound $\\tilde{a}$.\n- Using the Roe-averaged state, derive the three Roe eigenvalues of the flux Jacobian in the streamwise direction before any entropy correction.\n- Apply Harten’s entropy fix with threshold parameter $\\varepsilon = 120 \\,\\mathrm{m/s}$ to obtain the corrected absolute eigenvalues $|\\lambda_{k}|_{\\varepsilon}$, where for each characteristic speed $\\lambda$ the correction is defined by \n$|\\lambda|_{\\varepsilon} = \\dfrac{1}{2}\\!\\left(\\dfrac{\\lambda^{2}}{\\varepsilon} + \\varepsilon\\right)$ if $|\\lambda|  \\varepsilon$, and $|\\lambda|_{\\varepsilon} = |\\lambda|$ otherwise.\n- Evaluate the corrected total characteristic dissipation weight defined as $\\sum_{k=1}^{3} |\\lambda_{k}|_{\\varepsilon}$.\n\nProvide the final answer as a single row matrix containing, in order,\n$\\lambda_{1}$, $\\lambda_{2}$, $\\lambda_{3}$, $|\\lambda_{1}|_{\\varepsilon}$, $|\\lambda_{2}|_{\\varepsilon}$, $|\\lambda_{3}|_{\\varepsilon}$, and $\\sum_{k=1}^{3} |\\lambda_{k}|_{\\varepsilon}$.\nExpress all speed-like quantities in $\\mathrm{m/s}$. Use exact values; no rounding is required.",
            "solution": "The problem requires the analysis of a specific one-dimensional Riemann problem for the compressible Euler equations using Roe's approximate Riemann solver. The gas is ideal with a constant specific heat ratio $\\gamma = 1.4$.\n\nThe fundamental quantities for an ideal gas are the total specific enthalpy, $H$, and the speed of sound, $a$. The total specific enthalpy is defined as $H = E + \\frac{p}{\\rho}$, where $E = e + \\frac{1}{2}u^2$ is the total specific energy, $e$ is the specific internal energy, $p$ is the pressure, $\\rho$ is the density, and $u$ is the velocity. For an ideal gas, $e = \\frac{p}{\\rho(\\gamma-1)}$, so the enthalpy can be expressed as $H = \\frac{\\gamma p}{\\rho(\\gamma-1)} + \\frac{1}{2}u^2$. The speed of sound is given by $a^2 = \\frac{\\gamma p}{\\rho}$. Using this, the enthalpy can also be written as $H = \\frac{a^2}{\\gamma-1} + \\frac{1}{2}u^2$.\n\nThe given left ($L$) and right ($R$) states are:\n$\\rho_{L} = 1.0 \\,\\mathrm{kg/m^3}$, $u_{L} = 400 \\,\\mathrm{m/s}$, $p_{L} = \\frac{290000}{7} \\,\\mathrm{Pa}$.\n$\\rho_{R} = 1.0 \\,\\mathrm{kg/m^3}$, $u_{R} = 100 \\,\\mathrm{m/s}$, $p_{R} = \\frac{290000}{7} \\,\\mathrm{Pa}$.\nThe specific heat ratio is $\\gamma = 1.4 = \\frac{7}{5}$.\n\nFirst, we derive the Roe-averaged state variables. The Roe-averaged velocity, $\\tilde{u}$, is given by the formula:\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\nSubstituting the given values:\n$$\n\\tilde{u} = \\frac{\\sqrt{1.0} \\cdot 400 + \\sqrt{1.0} \\cdot 100}{\\sqrt{1.0} + \\sqrt{1.0}} = \\frac{400 + 100}{2} = 250 \\,\\mathrm{m/s}\n$$\nThe Roe-averaged total specific enthalpy, $\\tilde{H}$, is given by:\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\nTo calculate $\\tilde{H}$, we first need to determine the total specific enthalpies $H_L$ and $H_R$. We start by calculating the speed of sound squared for each state. Since $p_L=p_R$ and $\\rho_L=\\rho_R$, we have $a_L=a_R$.\n$$\na_L^2 = a_R^2 = \\frac{\\gamma p_L}{\\rho_L} = \\frac{1.4 \\cdot \\frac{290000}{7}}{1.0} = \\frac{\\frac{7}{5} \\cdot \\frac{290000}{7}}{1} = \\frac{290000}{5} = 58000 \\,(\\mathrm{m/s})^2\n$$\nNow we compute $H_L$ and $H_R$ using $\\gamma-1 = 1.4 - 1 = 0.4 = \\frac{2}{5}$:\n$$\nH_L = \\frac{a_L^2}{\\gamma-1} + \\frac{1}{2}u_L^2 = \\frac{58000}{0.4} + \\frac{1}{2}(400)^2 = 145000 + \\frac{160000}{2} = 145000 + 80000 = 225000 \\,\\mathrm{J/kg}\n$$\n$$\nH_R = \\frac{a_R^2}{\\gamma-1} + \\frac{1}{2}u_R^2 = \\frac{58000}{0.4} + \\frac{1}{2}(100)^2 = 145000 + \\frac{10000}{2} = 145000 + 5000 = 150000 \\,\\mathrm{J/kg}\n$$\nWith $H_L$ and $H_R$, we can compute $\\tilde{H}$:\n$$\n\\tilde{H} = \\frac{\\sqrt{1.0} \\cdot 225000 + \\sqrt{1.0} \\cdot 150000}{\\sqrt{1.0} + \\sqrt{1.0}} = \\frac{225000 + 150000}{2} = \\frac{375000}{2} = 187500 \\,\\mathrm{J/kg}\n$$\nNext, we derive the Roe-averaged speed of sound, $\\tilde{a}$, from $\\tilde{u}$ and $\\tilde{H}$:\n$$\n\\tilde{a}^2 = (\\gamma-1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)\n$$\nSubstituting the calculated values:\n$$\n\\tilde{a}^2 = (0.4)\\left(187500 - \\frac{1}{2}(250)^2\\right) = \\frac{2}{5}\\left(187500 - \\frac{62500}{2}\\right) = \\frac{2}{5}(187500 - 31250) = \\frac{2}{5}(156250) = 62500 \\,(\\mathrm{m/s})^2\n$$\n$$\n\\tilde{a} = \\sqrt{62500} = 250 \\,\\mathrm{m/s}\n$$\nThe eigenvalues of the Roe flux Jacobian matrix, $\\tilde{A}$, are given by $\\lambda_1 = \\tilde{u} - \\tilde{a}$, $\\lambda_2 = \\tilde{u}$, and $\\lambda_3 = \\tilde{u} + \\tilde{a}$.\n$$\n\\lambda_1 = 250 - 250 = 0 \\,\\mathrm{m/s}\n$$\n$$\n\\lambda_2 = 250 \\,\\mathrm{m/s}\n$$\n$$\n\\lambda_3 = 250 + 250 = 500 \\,\\mathrm{m/s}\n$$\nThe problem specifies that this is a case of a transonic rarefaction, which is confirmed by $\\lambda_1 = 0$. This vanishing eigenvalue requires an entropy correction to prevent non-physical solutions. We apply Harten's entropy fix with a threshold $\\varepsilon = 120 \\,\\mathrm{m/s}$. The rule for the corrected absolute eigenvalue $|\\lambda|_\\varepsilon$ is:\n$$\n|\\lambda|_{\\varepsilon} =\n\\begin{cases}\n\\frac{1}{2}\\left(\\frac{\\lambda^2}{\\varepsilon} + \\varepsilon\\right)  \\text{if } |\\lambda|  \\varepsilon \\\\\n|\\lambda|  \\text{if } |\\lambda| \\ge \\varepsilon\n\\end{cases}\n$$\nWe apply this correction to each eigenvalue:\nFor $\\lambda_1 = 0$:\n$|\\lambda_1| = 0$, which is less than $\\varepsilon = 120$.\n$$\n|\\lambda_1|_{\\varepsilon} = \\frac{1}{2}\\left(\\frac{0^2}{120} + 120\\right) = \\frac{1}{2}(120) = 60 \\,\\mathrm{m/s}\n$$\nFor $\\lambda_2 = 250$:\n$|\\lambda_2| = 250$, which is greater than $\\varepsilon = 120$.\n$$\n|\\lambda_2|_{\\varepsilon} = |\\lambda_2| = 250 \\,\\mathrm{m/s}\n$$\nFor $\\lambda_3 = 500$:\n$|\\lambda_3| = 500$, which is greater than $\\varepsilon = 120$.\n$$\n|\\lambda_3|_{\\varepsilon} = |\\lambda_3| = 500 \\,\\mathrm{m/s}\n$$\nFinally, we compute the corrected total characteristic dissipation weight, which is the sum of the corrected absolute eigenvalues:\n$$\n\\sum_{k=1}^{3} |\\lambda_{k}|_{\\varepsilon} = |\\lambda_{1}|_{\\varepsilon} + |\\lambda_{2}|_{\\varepsilon} + |\\lambda_{3}|_{\\varepsilon} = 60 + 250 + 500 = 810 \\,\\mathrm{m/s}\n$$\nThe required quantities are:\n$\\lambda_1 = 0 \\,\\mathrm{m/s}$\n$\\lambda_2 = 250 \\,\\mathrm{m/s}$\n$\\lambda_3 = 500 \\,\\mathrm{m/s}$\n$|\\lambda_1|_{\\varepsilon} = 60 \\,\\mathrm{m/s}$\n$|\\lambda_2|_{\\varepsilon} = 250 \\,\\mathrm{m/s}$\n$|\\lambda_3|_{\\varepsilon} = 500 \\,\\mathrm{m/s}$\n$\\sum_{k=1}^{3} |\\lambda_k|_{\\varepsilon} = 810 \\,\\mathrm{m/s}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  250  500  60  250  500  810 \\end{pmatrix}}\n$$"
        }
    ]
}