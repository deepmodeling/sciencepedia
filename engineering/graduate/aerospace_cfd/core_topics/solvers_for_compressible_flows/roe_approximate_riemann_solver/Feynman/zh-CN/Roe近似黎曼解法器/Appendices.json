{
    "hands_on_practices": [
        {
            "introduction": "深入理解 Roe 近似黎曼求解器的最佳方式，莫过于亲手从第一性原理出发将其构建出来。本练习旨在引导您完成这一过程，从一维欧拉方程和理想气体定律出发，通过实现 Roe 平均状态和特征结构，最终组装出完整的数值通量。通过这个实践 ，您将把理论知识转化为可运行的代码，为您后续更复杂的计算流体力学（CFD）应用打下坚实的基础。",
            "id": "3992156",
            "problem": "您需要实现一个程序，使用其波分解形式的 Roe 近似黎曼求解器来计算一维可压缩欧拉方程的数值通量。该求解器必须基于第一性原理构建，使用控制守恒律、理想气体热力学以及关于 Roe 平均态的线性化。实现必须是纯算法的，除了基本定义外，不得依赖任何预先推导的简化公式。\n\n起点是量热完全气体的一维欧拉方程，以守恒变量向量 $U=\\begin{bmatrix}\\rho \\\\ \\rho u \\\\ E\\end{bmatrix}$ 的守恒形式表示，其中 $\\rho$ 是密度（单位 $\\mathrm{kg/m^3}$），$u$ 是速度（单位 $\\mathrm{m/s}$），$E$ 是单位体积总能量（单位 $\\mathrm{J/m^3}$）。相应的物理通量为 $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$，其中 $p$ 是压力（单位 $\\mathrm{Pa}$）。对于理想气体，状态方程为 $p=(\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$，其中 $\\gamma$ 是比热比（无量纲）。比总焓定义为 $H=\\tfrac{E+p}{\\rho}$。\n\n您的任务是：\n- 为左、右状态 $U_L$ 和 $U_R$ 实现 Roe 平均态，其中 Roe 平均值使用密度加权的算术平均来定义。从 Roe 平均态出发，构建守恒变量下通量雅可比矩阵的波速（特征值）和右特征向量。\n- 计算守恒变量的跳跃量 $\\Delta U = U_R - U_L$，并将其分解到 Roe 平均态的右特征向量基上，以获得波强度。\n- 使用 Roe 求解器的波分解结构来组装数值通量，确保耗散项由 Roe 特征值的绝对值乘以相应的波强度和特征向量构建而成。\n- 一致地使用理想气体定律在原始变量和守恒变量之间进行转换。\n\n实现细节：\n- 对于左、右状态，输入状态均以原始变量 $(\\rho, u, p)$ 和给定的 $\\gamma$ 指定。您的程序必须在内部将这些变量转换为守恒变量。\n- 所有计算都必须在国际单位制 (SI) 中完成：$\\rho$ 单位为 $\\mathrm{kg/m^3}$，$u$ 单位为 $\\mathrm{m/s}$，$p$ 单位为 $\\mathrm{Pa}$，$E$ 单位为 $\\mathrm{J/m^3}$。通量分量必须以一致的 SI 单位计算和返回：质量通量单位为 $\\mathrm{kg/(m^2\\cdot s)}$，动量通量单位为 $\\mathrm{N/m^2}$ (即 $\\mathrm{Pa}$)，能量通量单位为 $\\mathrm{W/m^2}$。\n- 对于欧拉系统，使用在 Roe 平均态下求值的特征结构。Roe 平均速度 $u^\\sim$、焓 $H^\\sim$ 和声速 $a^\\sim$ 必须使用理想气体关系式和 $H$ 的定义从 $(U_L,U_R)$ 计算得出。\n\n测试套件：\n您必须为以下四个测试用例计算数值通量，每个用例均以 $(\\rho_L, u_L, p_L; \\rho_R, u_R, p_R; \\gamma)$ 的形式给出：\n1. $U_L$: $\\rho_L=1.0$, $u_L=0.0$, $p_L=100000$; $U_R$: $\\rho_R=0.125$, $u_R=0.0$, $p_R=10000$; $\\gamma=1.4$。\n2. $U_L$: $\\rho_L=1.225$, $u_L=800.0$, $p_L=101325$; $U_R$: $\\rho_R=1.225$, $u_R=700.0$, $p_R=101325$; $\\gamma=1.4$。\n3. $U_L$: $\\rho_L=1.0$, $u_L=100.0$, $p_L=100000$; $U_R$: $\\rho_R=0.9$, $u_R=-50.0$, $p_R=95000$; $\\gamma=1.4$。\n4. $U_L$: $\\rho_L=1.0$, $u_L=400.0$, $p_L=100000$; $U_R$: $\\rho_R=1.0$, $u_R=350.0$, $p_R=100000$; $\\gamma=1.4$。\n\n最终输出要求：\n- 对每个测试用例，计算 Roe 数值通量向量 $F^{\\text{Roe}}=\\begin{bmatrix}f_1 \\\\ f_2 \\\\ f_3\\end{bmatrix}$，并按顺序 $f_1$ (质量通量)、$f_2$ (动量通量)、$f_3$ (能量通量) 输出其三个分量。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内容为每个测试用例的通量分量依次串联的结果。例如，格式必须为 $\\left[\\text{case1\\_f1},\\text{case1\\_f2},\\text{case1\\_f3},\\text{case2\\_f1},\\dots\\right]$。\n- 输出列表中的每个条目都必须是如上所述的 SI 单位的浮点数。\n\n假设：\n- 气体是量热完全的，具有恒定的 $\\gamma$。\n- 所有提供的状态在物理上都是可接受的，即 $\\rho>0$ 且 $p>0$。",
            "solution": "一维可压缩欧拉方程描述了无粘性流体的质量、动量和能量守恒。守恒变量向量为 $U=\\begin{bmatrix}\\rho \\\\ \\rho u \\\\ E\\end{bmatrix}$，其对应的通量为 $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$。理想气体的热力学封闭关系为 $p=(\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$，比总焓为 $H=\\tfrac{E+p}{\\rho}$。目标是构建 Roe 近似黎曼求解器，它使用一个在适当平均状态下线性化的常系数雅可比矩阵来模拟精确黎曼解的波结构，同时保持较高的计算效率。\n\n原理与推导：\n1. 控制律与通量：守恒律为\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0,\n$$\n其中 $U=\\begin{bmatrix}\\rho \\\\ \\rho u \\\\ E\\end{bmatrix}$ 且 $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$。压力满足 $p=(\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$。\n\n2. Roe 线性化：Roe 方法通过在 Roe 平均态下计算特征结构，为左状态 $U_L$ 和右状态 $U_R$ 之间的通量雅可比矩阵构建一个常系数近似。定义原始变量 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，并通过以下方式将它们转换为守恒变量\n$$\nE_L = \\frac{p_L}{\\gamma - 1} + \\frac{1}{2}\\rho_L u_L^2, \\quad E_R = \\frac{p_R}{\\gamma - 1} + \\frac{1}{2}\\rho_R u_R^2,\n$$\n$$\nU_L=\\begin{bmatrix}\\rho_L \\\\ \\rho_L u_L \\\\ E_L\\end{bmatrix}, \\quad U_R=\\begin{bmatrix}\\rho_R \\\\ \\rho_R u_R \\\\ E_R\\end{bmatrix}.\n$$\n左、右状态的比总焓为\n$$\nH_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}.\n$$\n使用 Roe 的密度加权平均，权重为 $\\sqrt{\\rho_L}$ 和 $\\sqrt{\\rho_R}$，则 Roe 平均速度 $u^\\sim$ 和焓 $H^\\sim$ 为\n$$\nu^\\sim = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\nH^\\sim = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}.\n$$\nRoe 平均声速 $a^\\sim$ 可由理想气体关系式得出：\n$$\na^\\sim = \\sqrt{(\\gamma - 1)\\left(H^\\sim - \\frac{1}{2}(u^\\sim)^2\\right)}.\n$$\n\n3. 通量雅可比矩阵的特征结构：对于一维欧拉方程，在 Roe 平均态下的特征值（波速）为\n$$\n\\lambda_1 = u^\\sim - a^\\sim, \\quad \\lambda_2 = u^\\sim, \\quad \\lambda_3 = u^\\sim + a^\\sim.\n$$\n在 Roe 平均态下求值的一组一致的守恒变量右特征向量为\n$$\nr_1 = \\begin{bmatrix}1 \\\\ u^\\sim - a^\\sim \\\\ H^\\sim - u^\\sim a^\\sim\\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix}1 \\\\ u^\\sim \\\\ \\frac{1}{2}(u^\\sim)^2\\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix}1 \\\\ u^\\sim + a^\\sim \\\\ H^\\sim + u^\\sim a^\\sim\\end{bmatrix}.\n$$\n对于可接受的 Roe 平均态（$a^\\sim > 0$），这些向量张成状态空间。\n\n4. 波分解：守恒变量的跳跃量 $\\Delta U = U_R - U_L$ 可以在特征基上分解为\n$$\n\\Delta U = \\alpha_1 r_1 + \\alpha_2 r_2 + \\alpha_3 r_3,\n$$\n其中波强度 $\\alpha_k$ 通过求解 $3\\times 3$ 线性系统 $R \\alpha = \\Delta U$ 获得，其中\n$$\nR = \\begin{bmatrix} r_1 & r_2 & r_3 \\end{bmatrix}, \\quad \\alpha = \\begin{bmatrix}\\alpha_1 \\\\ \\alpha_2 \\\\ \\alpha_3\\end{bmatrix}.\n$$\n此计算仅使用 $r_k$ 的基本定义，避免了依赖于 $\\alpha_k$ 的闭式简化表达式。\n\n5. Roe 数值通量：界面处的 Roe 通量组装如下\n$$\nF^{\\text{Roe}} = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{k=1}^3 |\\lambda_k| \\alpha_k r_k,\n$$\n其中 $|\\lambda_k|$ 是 Roe 特征值的绝对值。第一项是物理通量的算术平均，第二项是与特征结构对齐的耗散修正项。\n\n6. 算法步骤：\n- 使用 $E=\\tfrac{p}{\\gamma - 1} + \\tfrac{1}{2}\\rho u^2$ 将 $(\\rho,u,p)$ 转换为 $U$。\n- 使用定义 $F(U)=\\begin{bmatrix}\\rho u \\\\ \\rho u^2 + p \\\\ u(E+p)\\end{bmatrix}$ 及 $p=(\\gamma-1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$ 计算 $F(U)$。\n- 从 $(U_L,U_R)$ 构建 Roe 平均值 $u^\\sim$、$H^\\sim$ 和 $a^\\sim$。\n- 在 Roe 平均态下构建特征值 $\\lambda_k$ 和右特征向量 $r_k$，组装 $R$，并从 $R\\alpha=\\Delta U$ 计算 $\\alpha$。\n- 通过上述波分解公式计算 $F^{\\text{Roe}}$。\n- 对每个测试用例重复以上步骤。\n\n7. 单位与输出：\n所有输入和输出均使用 SI 单位。最终的数值通量分量分别为：质量通量 $\\mathrm{kg/(m^2\\cdot s)}$、动量通量 $\\mathrm{N/m^2}$ 和能量通量 $\\mathrm{W/m^2}$。对于四个测试用例，输出一个单行，包含一个用方括号括起来的逗号分隔列表，其中包含序列\n$$\n\\left[f_{1}^{(1)}, f_{2}^{(1)}, f_{3}^{(1)}, f_{1}^{(2)}, f_{2}^{(2)}, f_{3}^{(2)}, f_{1}^{(3)}, f_{2}^{(3)}, f_{3}^{(3)}, f_{1}^{(4)}, f_{2}^{(4)}, f_{3}^{(4)}\\right].\n$$\n\n这种构造方法基于基本的控制方程和热力学关系，将其转换为关于 Roe 平均态的线性化特征表示，并组装出一个一致的近似黎曼求解器，而无需借助任何未记录或简化的公式。",
            "answer": "```python\nimport numpy as np\n\ndef primitive_to_conserved(rho, u, p, gamma):\n    \"\"\"\n    Convert primitive variables to conserved variables for 1D Euler.\n    rho: density [kg/m^3]\n    u: velocity [m/s]\n    p: pressure [Pa]\n    gamma: ratio of specific heats [-]\n    Returns U = [rho, rho*u, E] with E [J/m^3]\n    \"\"\"\n    E = p / (gamma - 1.0) + 0.5 * rho * u * u\n    return np.array([rho, rho * u, E], dtype=float)\n\ndef conserved_to_primitive(U, gamma):\n    \"\"\"\n    Convert conserved variables to primitive variables for 1D Euler.\n    U: [rho, rho*u, E]\n    Returns rho, u, p\n    \"\"\"\n    rho = U[0]\n    mom = U[1]\n    E = U[2]\n    u = mom / rho\n    p = (gamma - 1.0) * (E - 0.5 * rho * u * u)\n    return rho, u, p\n\ndef flux_euler(U, gamma):\n    \"\"\"\n    Physical flux for 1D Euler in conserved variables.\n    F(U) = [rho*u, rho*u^2 + p, u*(E + p)]\n    \"\"\"\n    rho, u, p = conserved_to_primitive(U, gamma)\n    E = U[2]\n    return np.array([rho * u, rho * u * u + p, u * (E + p)], dtype=float)\n\ndef roe_average(U_L, U_R, gamma):\n    \"\"\"\n    Compute Roe-averaged velocity, enthalpy, and sound speed between U_L and U_R.\n    \"\"\"\n    rho_L, u_L, p_L = conserved_to_primitive(U_L, gamma)\n    rho_R, u_R, p_R = conserved_to_primitive(U_R, gamma)\n    E_L = U_L[2]\n    E_R = U_R[2]\n    H_L = (E_L + p_L) / rho_L\n    H_R = (E_R + p_R) / rho_R\n\n    srL = np.sqrt(rho_L)\n    srR = np.sqrt(rho_R)\n    denom = srL + srR\n\n    u_tilde = (srL * u_L + srR * u_R) / denom\n    H_tilde = (srL * H_L + srR * H_R) / denom\n    a_tilde_sq = (gamma - 1.0) * (H_tilde - 0.5 * u_tilde * u_tilde)\n    # Guard against slight negative due to round-off; clamp minimum at small positive\n    a_tilde_sq = max(a_tilde_sq, 1e-12)\n    a_tilde = np.sqrt(a_tilde_sq)\n    return u_tilde, H_tilde, a_tilde\n\ndef roe_eigenstructure(u_tilde, H_tilde, a_tilde):\n    \"\"\"\n    Construct eigenvalues and right eigenvectors for Roe-averaged state.\n    \"\"\"\n    lam1 = u_tilde - a_tilde\n    lam2 = u_tilde\n    lam3 = u_tilde + a_tilde\n\n    r1 = np.array([1.0, u_tilde - a_tilde, H_tilde - u_tilde * a_tilde], dtype=float)\n    r2 = np.array([1.0, u_tilde, 0.5 * u_tilde * u_tilde], dtype=float)\n    r3 = np.array([1.0, u_tilde + a_tilde, H_tilde + u_tilde * a_tilde], dtype=float)\n\n    R = np.column_stack((r1, r2, r3))\n    lambdas = np.array([lam1, lam2, lam3], dtype=float)\n    return lambdas, R\n\ndef roe_flux(U_L, U_R, gamma):\n    \"\"\"\n    Compute Roe's approximate Riemann solver flux between left and right states.\n    \"\"\"\n    # Physical fluxes\n    F_L = flux_euler(U_L, gamma)\n    F_R = flux_euler(U_R, gamma)\n\n    # Roe averages and eigenstructure\n    u_tilde, H_tilde, a_tilde = roe_average(U_L, U_R, gamma)\n    lambdas, R = roe_eigenstructure(u_tilde, H_tilde, a_tilde)\n\n    # Wave strengths by solving R * alpha = delta_U\n    delta_U = U_R - U_L\n    # Solve linear system robustly\n    try:\n        alpha = np.linalg.solve(R, delta_U)\n    except np.linalg.LinAlgError:\n        # Fallback: use least-squares if singular (should be rare)\n        alpha = np.linalg.lstsq(R, delta_U, rcond=None)[0]\n\n    dissipation = R @ (np.abs(lambdas) * alpha)\n    F_roe = 0.5 * (F_L + F_R) - 0.5 * dissipation\n    return F_roe\n\ndef solve():\n    gamma = 1.4\n    # Define test cases: (rho_L, u_L, p_L, rho_R, u_R, p_R)\n    test_cases = [\n        (1.0, 0.0, 100000.0, 0.125, 0.0, 10000.0),      # Sod-like shock tube in SI\n        (1.225, 800.0, 101325.0, 1.225, 700.0, 101325.0),  # Supersonic contact-like variation\n        (1.0, 100.0, 100000.0, 0.9, -50.0, 95000.0),    # Transonic mixed states\n        (1.0, 400.0, 100000.0, 1.0, 350.0, 100000.0),   # Near-sonic Roe average\n    ]\n\n    results = []\n    for (rho_L, u_L, p_L, rho_R, u_R, p_R) in test_cases:\n        U_L = primitive_to_conserved(rho_L, u_L, p_L, gamma)\n        U_R = primitive_to_conserved(rho_R, u_R, p_R, gamma)\n        F = roe_flux(U_L, U_R, gamma)\n        # Append flux components in order: mass, momentum, energy\n        results.extend(F.tolist())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "标准的 Roe 求解器虽然高效，但在某些特定情况下，例如跨音速稀疏波中，可能会产生违反物理熵增原理的非物理解（如膨胀激波）。本练习  聚焦于这一关键问题，通过一个精心设计的算例，让您学会如何通过检查 Roe 矩阵的特征值来识别这种“熵违反”现象。更重要的是，您将亲手应用一种经典的熵修正方法，以确保数值解的物理正确性，从而提高求解器的鲁棒性。",
            "id": "3992160",
            "problem": "考虑一维理想气体在流向上的可压缩欧拉方程，该问题在计算流体力学（CFD）中被构建为一个黎曼问题。该气体的比热比为常数 $\\gamma = 1.4$。左、右状态分别为\n$\\rho_{L} = 1.0 \\,\\mathrm{kg/m^3}$，$u_{L} = 400 \\,\\mathrm{m/s}$，$p_{L} = \\dfrac{290000}{7} \\,\\mathrm{Pa}$，以及\n$\\rho_{R} = 1.0 \\,\\mathrm{kg/m^3}$，$u_{R} = 100 \\,\\mathrm{m/s}$，$p_{R} = \\dfrac{290000}{7} \\,\\mathrm{Pa}$。\n假设理想气体关系，并使用基于Roe平均的标准Roe近似黎曼求解器线性化方法。将此情况视为Roe线性化中跨越音速点的跨音速稀疏波。\n\n从一维欧拉方程、理想气体焓和Roe平均状态的定义出发，执行以下步骤：\n- 根据给定的左、右状态，推导Roe平均速度 $\\tilde{u}$ 和Roe平均总比焓 $\\tilde{H}$。\n- 由此，推导Roe平均声速 $\\tilde{a}$。\n- 使用Roe平均状态，推导通量雅可比矩阵在流向上的三个Roe特征值（未经任何熵修正）。\n- 应用Harten熵修正，阈值参数为 $\\varepsilon = 120 \\,\\mathrm{m/s}$，以获得修正后的绝对特征值 $|\\lambda_{k}|_{\\varepsilon}$。对于每个特征速度 $\\lambda$，其修正定义为\n$|\\lambda|_{\\varepsilon} = \\dfrac{1}{2}\\!\\left(\\dfrac{\\lambda^{2}}{\\varepsilon} + \\varepsilon\\right)$，如果 $|\\lambda| < \\varepsilon$；否则 $|\\lambda|_{\\varepsilon} = |\\lambda|$。\n- 计算修正后的总特征耗散权重，定义为 $\\sum_{k=1}^{3} |\\lambda_{k}|_{\\varepsilon}$。\n\n将最终答案以单行矩阵的形式给出，依次包含\n$\\lambda_{1}$、$\\lambda_{2}$、$\\lambda_{3}$、$|\\lambda_{1}|_{\\varepsilon}$、$|\\lambda_{2}|_{\\varepsilon}$、$|\\lambda_{3}|_{\\varepsilon}$ 和 $\\sum_{k=1}^{3} |\\lambda_{k}|_{\\varepsilon}$。\n所有类速度量均以 $\\mathrm{m/s}$ 为单位表示。使用精确值，无需四舍五入。",
            "solution": "该问题要求使用Roe近似黎曼求解器分析一个特定的可压缩欧拉方程一维黎曼问题。该气体为理想气体，其比热比为常数 $\\gamma = 1.4$。\n\n对于理想气体，基本物理量是总比焓 $H$ 和声速 $a$。总比焓定义为 $H = \\frac{E + p}{\\rho}$，其中 $E = e + \\frac{1}{2}u^2$ 是总比能，$e$ 是比内能，$p$ 是压力，$\\rho$ 是密度，$u$ 是速度。对于理想气体，$e = \\frac{p}{\\rho(\\gamma-1)}$，因此总比焓可以表示为 $H = \\frac{\\gamma p}{\\rho(\\gamma-1)} + \\frac{1}{2}u^2$。声速由 $a^2 = \\frac{\\gamma p}{\\rho}$ 给出。利用此关系，总比焓也可以写为 $H = \\frac{a^2}{\\gamma-1} + \\frac{1}{2}u^2$。\n\n给定的左（$L$）和右（$R$）状态为：\n$\\rho_{L} = 1.0 \\,\\mathrm{kg/m^3}$，$u_{L} = 400 \\,\\mathrm{m/s}$，$p_{L} = \\frac{290000}{7} \\,\\mathrm{Pa}$。\n$\\rho_{R} = 1.0 \\,\\mathrm{kg/m^3}$，$u_{R} = 100 \\,\\mathrm{m/s}$，$p_{R} = \\frac{290000}{7} \\,\\mathrm{Pa}$。\n比热比为 $\\gamma = 1.4 = \\frac{7}{5}$。\n\n首先，我们推导Roe平均状态变量。Roe平均速度 $\\tilde{u}$ 由以下公式给出：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n代入给定值：\n$$\n\\tilde{u} = \\frac{\\sqrt{1.0} \\cdot 400 + \\sqrt{1.0} \\cdot 100}{\\sqrt{1.0} + \\sqrt{1.0}} = \\frac{400 + 100}{2} = 250 \\,\\mathrm{m/s}\n$$\nRoe平均总比焓 $\\tilde{H}$ 由以下公式给出：\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n为了计算 $\\tilde{H}$，我们首先需要确定总比焓 $H_L$ 和 $H_R$。我们首先计算每个状态下声速的平方。由于 $p_L=p_R$ 和 $\\rho_L=\\rho_R$，我们有 $a_L=a_R$。\n$$\na_L^2 = a_R^2 = \\frac{\\gamma p_L}{\\rho_L} = \\frac{1.4 \\cdot \\frac{290000}{7}}{1.0} = \\frac{\\frac{7}{5} \\cdot \\frac{290000}{7}}{1} = \\frac{290000}{5} = 58000 \\,(\\mathrm{m/s})^2\n$$\n现在我们使用 $\\gamma-1 = 1.4 - 1 = 0.4 = \\frac{2}{5}$ 来计算 $H_L$ 和 $H_R$：\n$$\nH_L = \\frac{a_L^2}{\\gamma-1} + \\frac{1}{2}u_L^2 = \\frac{58000}{0.4} + \\frac{1}{2}(400)^2 = 145000 + \\frac{160000}{2} = 145000 + 80000 = 225000 \\,\\mathrm{J/kg}\n$$\n$$\nH_R = \\frac{a_R^2}{\\gamma-1} + \\frac{1}{2}u_R^2 = \\frac{58000}{0.4} + \\frac{1}{2}(100)^2 = 145000 + \\frac{10000}{2} = 145000 + 5000 = 150000 \\,\\mathrm{J/kg}\n$$\n利用 $H_L$ 和 $H_R$，我们可以计算 $\\tilde{H}$：\n$$\n\\tilde{H} = \\frac{\\sqrt{1.0} \\cdot 225000 + \\sqrt{1.0} \\cdot 150000}{\\sqrt{1.0} + \\sqrt{1.0}} = \\frac{225000 + 150000}{2} = \\frac{375000}{2} = 187500 \\,\\mathrm{J/kg}\n$$\n接下来，我们从 $\\tilde{u}$ 和 $\\tilde{H}$ 推导Roe平均声速 $\\tilde{a}$：\n$$\n\\tilde{a}^2 = (\\gamma-1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)\n$$\n代入计算出的值：\n$$\n\\tilde{a}^2 = (0.4)\\left(187500 - \\frac{1}{2}(250)^2\\right) = \\frac{2}{5}\\left(187500 - \\frac{62500}{2}\\right) = \\frac{2}{5}(187500 - 31250) = \\frac{2}{5}(156250) = 62500 \\,(\\mathrm{m/s})^2\n$$\n$$\n\\tilde{a} = \\sqrt{62500} = 250 \\,\\mathrm{m/s}\n$$\nRoe通量雅可比矩阵 $\\tilde{A}$ 的特征值为 $\\lambda_1 = \\tilde{u} - \\tilde{a}$、$\\lambda_2 = \\tilde{u}$ 和 $\\lambda_3 = \\tilde{u} + \\tilde{a}$。\n$$\n\\lambda_1 = 250 - 250 = 0 \\,\\mathrm{m/s}\n$$\n$$\n\\lambda_2 = 250 \\,\\mathrm{m/s}\n$$\n$$\n\\lambda_3 = 250 + 250 = 500 \\,\\mathrm{m/s}\n$$\n问题指明这是一个跨音速稀疏波的情况，这一点由 $\\lambda_1 = 0$ 证实。这个消失的特征值需要进行熵修正，以防止出现非物理的解。我们应用Harten熵修正，阈值为 $\\varepsilon = 120 \\,\\mathrm{m/s}$。修正后的绝对特征值 $|\\lambda|_\\varepsilon$ 的规则是：\n$$\n|\\lambda|_{\\varepsilon} =\n\\begin{cases}\n\\frac{1}{2}\\left(\\frac{\\lambda^2}{\\varepsilon} + \\varepsilon\\right) & \\text{如果 } |\\lambda| < \\varepsilon \\\\\n|\\lambda| & \\text{如果 } |\\lambda| \\ge \\varepsilon\n\\end{cases}\n$$\n我们将此修正应用于每个特征值：\n对于 $\\lambda_1 = 0$：\n$|\\lambda_1| = 0$，小于 $\\varepsilon = 120$。\n$$\n|\\lambda_1|_{\\varepsilon} = \\frac{1}{2}\\left(\\frac{0^2}{120} + 120\\right) = \\frac{1}{2}(120) = 60 \\,\\mathrm{m/s}\n$$\n对于 $\\lambda_2 = 250$：\n$|\\lambda_2| = 250$，大于 $\\varepsilon = 120$。\n$$\n|\\lambda_2|_{\\varepsilon} = |\\lambda_2| = 250 \\,\\mathrm{m/s}\n$$\n对于 $\\lambda_3 = 500$：\n$|\\lambda_3| = 500$，大于 $\\varepsilon = 120$。\n$$\n|\\lambda_3|_{\\varepsilon} = |\\lambda_3| = 500 \\,\\mathrm{m/s}\n$$\n最后，我们计算修正后的总特征耗散权重，即修正后绝对特征值的和：\n$$\n\\sum_{k=1}^{3} |\\lambda_{k}|_{\\varepsilon} = |\\lambda_{1}|_{\\varepsilon} + |\\lambda_{2}|_{\\varepsilon} + |\\lambda_{3}|_{\\varepsilon} = 60 + 250 + 500 = 810 \\,\\mathrm{m/s}\n$$\n所要求的量为：\n$\\lambda_1 = 0 \\,\\mathrm{m/s}$\n$\\lambda_2 = 250 \\,\\mathrm{m/s}$\n$\\lambda_3 = 500 \\,\\mathrm{m/s}$\n$|\\lambda_1|_{\\varepsilon} = 60 \\,\\mathrm{m/s}$\n$|\\lambda_2|_{\\varepsilon} = 250 \\,\\mathrm{m/s}$\n$|\\lambda_3|_{\\varepsilon} = 500 \\,\\mathrm{m/s}$\n$\\sum_{k=1}^{3} |\\lambda_k|_{\\varepsilon} = 810 \\,\\mathrm{m/s}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & 250 & 500 & 60 & 250 & 500 & 810 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "当我们将数值格式应用于包含源项（如重力）的控制方程时，一个重要且微妙的挑战便会出现。即便是精确的平衡态（如静水平衡），一个设计不当的格式也可能产生虚假的数值扰动，破坏其平衡状态。本练习  通过一个经典的静水平衡测试，让您亲身体验这一问题：通过量化一个未经特殊处理的 Roe 求解器产生的虚假速度，您将深刻理解“守恒格式”与“平衡格式”（well-balanced scheme）之间的区别，以及后者在模拟含源项物理问题时的重要性。",
            "id": "3992163",
            "problem": "考虑在 $x$ 轴正方向上作用有恒定重力加速度的一维可压缩欧拉方程。在有重力的情况下，质量、动量和能量守恒的控制方程为\n$$\n\\frac{\\partial}{\\partial t}\n\\begin{bmatrix}\n\\rho \\\\\n\\rho u \\\\\nE\n\\end{bmatrix}\n+ \\frac{\\partial}{\\partial x}\n\\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p \\\\\nu(E + p)\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n0 \\\\\n-\\rho g \\\\\n-\\rho g u\n\\end{bmatrix},\n$$\n其中 $\\rho$ 是密度，$u$ 是速度，$E$ 是单位体积的总能量，$p$ 是压力，$g$ 是恒定的重力加速度。假设为理想气体，其比热比为 $\\gamma$，特定气体常数为 $R$，因此热力学关系为 $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right)$ 和 $p = \\rho R T$（其中 $T$ 为温度）。\n\n静水平衡的特征是 $u(x) = 0$ 以及平衡条件 $\\frac{dp}{dx} = -\\rho g$。对于温度恒为 $T$ 的等温大气，其静水压力分布为\n$$\np(x) = p_0 \\exp\\left(-\\frac{x}{H}\\right), \\quad \\rho(x) = \\frac{p(x)}{R T}, \\quad u(x) = 0,\n$$\n其中标高 $H$ 由 $H = \\frac{R T}{g}$ 给出，$p_0$ 是 $x=0$ 处的压力。\n\n在一个长度为 $L$ 的计算域上，使用包含 $N$ 个单元的均匀网格进行有限体积离散化，单元宽度为 $\\Delta x = \\frac{L}{N}$，时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件选择。假设使用 Roe 近似黎曼求解器计算单元界面处的数值通量，并通过单个显式时间步推进解，但有意忽略重力源项（即，使用标准的 Roe 通量，不进行任何源项平衡）。这种忽略会破坏良态平衡（well-balanced）性质，并导致对静水状态的伪偏离。\n\n你的任务是实现一个程序，该程序能够：\n- 根据给定参数构建等温静水平衡初始条件。\n- 在均匀网格上，使用 Roe 近似黎曼求解器对一维欧拉方程进行单个显式有限体积时间步推进，其中幽灵单元（ghost cells）由初始剖面的静水延伸填充。\n- 在更新中不包含任何重力源项。\n- 计算此单步时间推进后物理单元上伪速度 $|u|$ 的最大值。\n\n使用以下物理和数值参数。所有量必须按其指定单位处理，答案必须以米/秒 (m/s) 表示，并四舍五入到六位小数：\n- 案例 1（一般情况）：$\\gamma = 1.4$，$R = 287$ $\\mathrm{J/(kg\\cdot K)}$，$T = 300$ $\\mathrm{K}$，$p_0 = 101325$ $\\mathrm{Pa}$，$g = 9.81$ $\\mathrm{m/s^2}$，$L = 1000$ $\\mathrm{m}$，$N = 100$，$\\mathrm{CFL} = 0.5$。\n- 案例 2（粗分辨率）：与案例 1 相同，但 $N = 20$。\n- 案例 3（强重力）：与案例 1 相同，但 $g = 50$ $\\mathrm{m/s^2}$。\n- 案例 4（低温度）：与案例 1 相同，但 $T = 150$ $\\mathrm{K}$。\n- 案例 5（细分辨率）：与案例 1 相同，但 $N = 400$。\n\n实现所需的定义：\n- 总能量为 $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2$。\n- 声速为 $c = \\sqrt{\\gamma \\frac{p}{\\rho}}$。\n- 时间步长选择为 $\\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{\\max_i(|u_i| + c_i)}$，其中最大值取自所有物理单元 $i$。\n- 每个界面处的数值通量必须是基于相邻单元左右状态的 Roe 通量。\n- 更新时使用一阶显式欧拉时间积分。\n\n测试套件和输出：\n- 使用上述五个参数集作为测试套件。\n- 对于每个案例，计算物理单元 $i$ 上单步最大伪速度 $\\max_i |u_i^{n+1}|$，单位为 $\\mathrm{m/s}$，四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按五个案例的顺序排列（例如 $[v_1,v_2,v_3,v_4,v_5]$），其中每个 $v_k$ 是案例 $k$ 的最大绝对速度，单位为 $\\mathrm{m/s}$。",
            "solution": "该问题是有效的。它提出了一个在计算流体动力学中定义明确的数值实验，该实验基于欧拉方程和有限体积法的既定原理。所有必需的物理常数、初始条件和数值参数都已提供，并且没有科学上的不一致、矛盾或模糊之处。任务是量化使用一个对于带源项的系统而言不是“良态平衡”的标准数值格式（Roe 求解器）所引入的误差，这是双曲守恒律数值方法发展中的一个常见且重要的话题。\n\n求解过程包括：离散化计算域，设置指定的初始条件，并使用带有 Roe 近似黎曼求解器计算通量的显式有限体积法执行单时间步更新。\n\n**1. 离散化与初始条件**\n\n长度为 $L$ 的空间域被离散为 $N$ 个均匀单元，索引为 $i = 1, \\dots, N$。每个单元的宽度为 $\\Delta x = L/N$。单元中心位于 $x_i = (i - 1/2)\\Delta x$，其中 $i=1, \\dots, N$。为了处理通量计算的边界条件，我们在计算域的两端各引入一个幽灵单元（单元 $0$ 和单元 $N+1$）。\n\n初始条件是等温大气的静水平衡，其特征是速度为零，压力分布与重力相平衡。每个单元中心 $x_i$（对于 $i = 0, \\dots, N+1$）的状态变量初始化如下：\n- 特定气体常数 $R$、重力加速度 $g$ 和恒定温度 $T$ 是给定的。\n- 大气标高为 $H = \\frac{R T}{g}$。\n- 压力为 $p(x) = p_0 \\exp\\left(-\\frac{x}{H}\\right)$，其中 $p_0$ 是 $x=0$ 处的压力。\n- 密度为 $\\rho(x) = \\frac{p(x)}{R T}$。\n- 速度为 $u(x) = 0$。\n\n守恒状态向量 $\\mathbf{U}$ 有三个分量：$\\mathbf{U} = [\\rho, \\rho u, E]^T$。对于每个单元 $i$，初始状态 $\\mathbf{U}_i^n$（在时间 $n=0$ 时）为：\n- $\\rho_i = \\rho(x_i)$\n- $(\\rho u)_i = \\rho_i u(x_i) = 0$\n- $E_i = \\frac{p(x_i)}{\\gamma - 1} + \\frac{1}{2}\\rho_i u(x_i)^2 = \\frac{p(x_i)}{\\gamma - 1}$\n\n**2. 时间步长计算**\n\n时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件确定，以确保数值稳定性：\n$$ \\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{\\max_i(|u_i| + c_i)} $$\n其中最大值取自所有物理单元。声速为 $c = \\sqrt{\\gamma p / \\rho}$。对于理想等温气体，这可以简化为：\n$$ c = \\sqrt{\\gamma \\frac{\\rho R T}{\\rho}} = \\sqrt{\\gamma R T} $$\n由于温度 $T$ 是恒定的，声速 $c$ 在整个计算域内也是恒定的。在初始时刻，$u_i = 0$ 对所有 $i$ 成立。因此，时间步长计算如下：\n$$ \\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{\\sqrt{\\gamma R T}} $$\n\n**3. 有限体积更新**\n\n问题指定使用一阶显式欧拉时间积分。单元 $i$ 中的守恒变量根据有限体积公式从时间 $n$ 更新到 $n+1$：\n$$ \\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathbf{F}_{i+1/2} - \\mathbf{F}_{i-1/2} \\right) $$\n此处，$\\mathbf{F}_{i+1/2}$ 和 $\\mathbf{F}_{i-1/2}$ 分别是单元 $i$ 左右界面处的数值通量。至关重要的是，重力源项已从此更新方程中忽略，这正是产生伪速度的来源。\n\n**4. Roe 近似黎曼求解器**\n\n单元 $i$（左状态，$\\mathbf{U}_L$）和单元 $i+1$（右状态，$\\mathbf{U}_R$）之间界面上的数值通量 $\\mathbf{F}_{i+1/2}$ 使用 Roe 近似黎曼求解器计算：\n$$ \\mathbf{F}_{i+1/2} = \\frac{1}{2} \\left( \\mathbf{F}(\\mathbf{U}_L) + \\mathbf{F}(\\mathbf{U}_R) \\right) - \\frac{1}{2} \\sum_{k=1}^{3} |\\tilde{\\lambda}_k| \\tilde{\\alpha}_k \\tilde{\\mathbf{r}}_k $$\n其中 $\\mathbf{F}(\\mathbf{U}) = [\\rho u, \\rho u^2 + p, u(E + p)]^T$ 是物理通量向量。第二项表示数值耗散。\n\n为了计算耗散项，我们首先根据左右状态定义 Roe 平均量：\n- $\\tilde{\\rho} = \\sqrt{\\rho_L \\rho_R}$\n- $\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}$\n- 比总焓：$H = (E+p)/\\rho$。Roe 平均总焓为 $\\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}$。\n- Roe 平均声速：$\\tilde{c} = \\sqrt{(\\gamma - 1)(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2)}$。\n\n耗散项求和中的各项为：\n- Roe 矩阵的特征值：$\\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{c}$，$\\tilde{\\lambda}_2 = \\tilde{u}$，$\\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{c}$。\n- Roe 矩阵的右特征向量：\n$$ \\tilde{\\mathbf{r}}_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u}-\\tilde{c} \\\\ \\tilde{H}-\\tilde{u}\\tilde{c} \\end{bmatrix}, \\quad \\tilde{\\mathbf{r}}_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad \\tilde{\\mathbf{r}}_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u}+\\tilde{c} \\\\ \\tilde{H}+\\tilde{u}\\tilde{c} \\end{bmatrix} $$\n- 波强度 $\\tilde{\\alpha}_k$ 是将状态跳跃 $\\Delta \\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$ 分解到右特征向量基上得到的系数。它们可以从原始变量的跳跃量 $\\Delta\\rho = \\rho_R - \\rho_L$，$\\Delta u = u_R - u_L$ 和 $\\Delta p = p_R - p_L$ 计算得出：\n$$ \\tilde{\\alpha}_1 = \\frac{1}{2\\tilde{c}^2} (\\Delta p - \\tilde{\\rho}\\tilde{c}\\Delta u) $$\n$$ \\tilde{\\alpha}_2 = \\Delta \\rho - \\frac{\\Delta p}{\\tilde{c}^2} $$\n$$ \\tilde{\\alpha}_3 = \\frac{1}{2\\tilde{c}^2} (\\Delta p + \\tilde{\\rho}\\tilde{c}\\Delta u) $$\n\n该过程涉及计算所有界面 $i = 0, \\dots, N$ 的通量 $\\mathbf{F}_{i+1/2}$。\n\n**5. 伪速度的提取**\n\n经过单时间步更新后，我们得到每个物理单元 $i=1, \\dots, N$ 的新状态向量 $\\mathbf{U}_i^{n+1}$。单元 $i$ 中的新密度和动量分别为 $\\rho_i^{n+1} = (\\mathbf{U}_i^{n+1})_1$ 和 $(\\rho u)_i^{n+1} = (\\mathbf{U}_i^{n+1})_2$。然后解码出新的速度：\n$$ u_i^{n+1} = \\frac{(\\rho u)_i^{n+1}}{\\rho_i^{n+1}} $$\n由于初始速度均匀为零，任何非零的 $u_i^{n+1}$ 都是由于数值格式未能用（被忽略的）重力源项平衡压力梯度而产生的伪速度。每个案例的最终结果是该伪速度在所有物理单元上的最大绝对值：\n$$ \\max_{i=1..N} |u_i^{n+1}| $$\n这个值量化了因缺乏良态平衡格式而在单步中引入的误差大小。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef roe_flux(U_L, U_R, gamma):\n    \"\"\"\n    Computes the Roe flux for the 1D Euler equations.\n    \"\"\"\n    # Decode left state\n    rho_L = U_L[0]\n    u_L = U_L[1] / rho_L\n    E_L = U_L[2]\n    p_L = (gamma - 1.0) * (E_L - 0.5 * rho_L * u_L**2)\n    h_L = (E_L + p_L) / rho_L\n    \n    # Decode right state\n    rho_R = U_R[0]\n    u_R = U_R[1] / rho_R\n    E_R = U_R[2]\n    p_R = (gamma - 1.0) * (E_R - 0.5 * rho_R * u_R**2)\n    h_R = (E_R + p_R) / rho_R\n    \n    # Physical fluxes\n    F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n    F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n    \n    # Roe averages\n    sqrt_rho_L = np.sqrt(rho_L)\n    sqrt_rho_R = np.sqrt(rho_R)\n    \n    rho_tilde = sqrt_rho_L * sqrt_rho_R\n    u_tilde = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    h_tilde = (sqrt_rho_L * h_L + sqrt_rho_R * h_R) / (sqrt_rho_L + sqrt_rho_R)\n    c_tilde_sq = (gamma - 1.0) * (h_tilde - 0.5 * u_tilde**2)\n    c_tilde = np.sqrt(max(c_tilde_sq, 1e-9)) # Guard against negative\n    \n    # Jumps in primitive variables\n    delta_rho = rho_R - rho_L\n    delta_u = u_R - u_L\n    delta_p = p_R - p_L\n    \n    # Eigenvalues\n    lambda_tilde = np.array([u_tilde - c_tilde, u_tilde, u_tilde + c_tilde])\n    \n    # Wave strengths (alpha_tilde)\n    alpha_2 = delta_rho - delta_p / c_tilde**2\n    alpha_1 = (delta_p - rho_tilde * c_tilde * delta_u) / (2.0 * c_tilde**2)\n    alpha_3 = (delta_p + rho_tilde * c_tilde * delta_u) / (2.0 * c_tilde**2)\n    alpha_tilde = np.array([alpha_1, alpha_2, alpha_3])\n    \n    # Right eigenvectors\n    r1 = np.array([1.0, u_tilde - c_tilde, h_tilde - u_tilde * c_tilde])\n    r2 = np.array([1.0, u_tilde, 0.5 * u_tilde**2])\n    r3 = np.array([1.0, u_tilde + c_tilde, h_tilde + u_tilde * c_tilde])\n    R_tilde = np.vstack([r1, r2, r3]).T\n\n    # Dissipation term: sum(|lambda_k|*alpha_k*r_k)\n    dissipation = R_tilde @ (np.abs(lambda_tilde) * alpha_tilde)\n\n    flux = 0.5 * (F_L + F_R) - 0.5 * dissipation\n    return flux\n\ndef solve():\n    test_cases = [\n        # Case 1 (general case)\n        {'gamma': 1.4, 'R': 287.0, 'T': 300.0, 'p0': 101325.0, 'g': 9.81, 'L': 1000.0, 'N': 100, 'CFL': 0.5},\n        # Case 2 (coarse resolution)\n        {'gamma': 1.4, 'R': 287.0, 'T': 300.0, 'p0': 101325.0, 'g': 9.81, 'L': 1000.0, 'N': 20, 'CFL': 0.5},\n        # Case 3 (strong gravity)\n        {'gamma': 1.4, 'R': 287.0, 'T': 300.0, 'p0': 101325.0, 'g': 50.0, 'L': 1000.0, 'N': 100, 'CFL': 0.5},\n        # Case 4 (low temperature)\n        {'gamma': 1.4, 'R': 287.0, 'T': 150.0, 'p0': 101325.0, 'g': 9.81, 'L': 1000.0, 'N': 100, 'CFL': 0.5},\n        # Case 5 (fine resolution)\n        {'gamma': 1.4, 'R': 287.0, 'T': 300.0, 'p0': 101325.0, 'g': 9.81, 'L': 1000.0, 'N': 400, 'CFL': 0.5},\n    ]\n\n    results = []\n    for params in test_cases:\n        gamma = params['gamma']\n        R = params['R']\n        T = params['T']\n        p0 = params['p0']\n        g = params['g']\n        L = params['L']\n        N = int(params['N'])\n        CFL = params['CFL']\n\n        # 1. Discretization and Grid\n        dx = L / N\n        # We need N+2 cells: N physical cells + 1 ghost cell on each side\n        # Cell centers for cells 0, 1, ..., N, N+1\n        # Physical cells 1..N have centers (0.5*dx) to ((N-0.5)*dx)\n        # We shift index by 0.5 to get centers right\n        x_centers = dx * (np.arange(N + 2) - 0.5)\n        \n        # 2. Initial Conditions\n        H = R * T / g  # Scale height\n        p = p0 * np.exp(-x_centers / H)\n        rho = p / (R * T)\n        u = np.zeros(N + 2)\n        E = p / (gamma - 1.0) # since u=0\n        \n        # State vector U = [rho, rho*u, E]\n        U = np.zeros((N + 2, 3))\n        U[:, 0] = rho\n        U[:, 1] = rho * u\n        U[:, 2] = E\n\n        # 3. Time Step Calculation\n        c = np.sqrt(gamma * R * T) # Constant sound speed\n        dt = CFL * dx / c # since u=0 initially\n        \n        # 4. Compute Fluxes at all Interfaces\n        fluxes = np.zeros((N + 1, 3))\n        for i in range(N + 1):\n            U_L = U[i]\n            U_R = U[i+1]\n            fluxes[i] = roe_flux(U_L, U_R, gamma)\n            \n        # 5. Finite Volume Update\n        U_new = np.copy(U)\n        # Update only physical cells (index 1 to N, inclusive)\n        for i in range(1, N + 1):\n            U_new[i, :] = U[i, :] - (dt / dx) * (fluxes[i] - fluxes[i - 1])\n            \n        # 6. Extract Spurious Velocity\n        # Extract physical cells from the updated state\n        physical_U_new = U_new[1:N+1, :]\n        rho_new = physical_U_new[:, 0]\n        rhou_new = physical_U_new[:, 1]\n        u_new = rhou_new / rho_new\n\n        max_spurious_velocity = np.max(np.abs(u_new))\n        results.append(round(max_spurious_velocity, 6))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}