{
    "hands_on_practices": [
        {
            "introduction": "戈杜诺夫型方法的核心在于求解单元界面上的黎曼问题，而其物理基础是跨间断的守恒律。本练习将引导你从一维欧拉方程的积分形式出发，推导出描述激波等间断的基本关系——兰金-雨果尼奥（Rankine-Hugoniot）条件 。通过亲手推导并应用这些条件来计算一个具体的激波速度，你将深刻理解这些守恒型数值方法背后的物理原理。",
            "id": "3963108",
            "problem": "在计算流体动力学 (CFD) 中，对于 Godunov 型有限体积法，单元间的通量是通过求解局部 Riemann 问题并根据守恒律传播间断来获得的。考虑一种量热完全气体的一维无粘可压缩流，其比热比 $\\gamma$ 为常数。一个平面间断将左态和右态分开，并以未知速度 $s$ 移动。从一维 Euler 方程的质量、动量和总能量的积分守恒律出发，并仅使用守恒变量和通量的基本定义，推导跨任意移动间断的通用 Rankine-Hugoniot 跳跃条件。\n\n然后，对于 $\\gamma = 1.4$ 的特定量热完全气体和以下左、右状态（在实验室坐标系中给出）：\n- 左态：$\\rho_{L} = 1.0$ $\\mathrm{kg/m^{3}}$，$u_{L} = 750$ $\\mathrm{m/s}$，$p_{L} = 1.0 \\times 10^{5}$ $\\mathrm{Pa}$，\n- 右态：$\\rho_{R} = 3.\\overline{3}$ $\\mathrm{kg/m^{3}}$，$u_{R} = 95.20995731456036$ $\\mathrm{m/s}$，$p_{R} = 7.125 \\times 10^{5}$ $\\mathrm{Pa}$，\n\n计算满足所推导的 Rankine-Hugoniot 条件的间断速度 $s$。将您的最终值 $s$ 四舍五入到四位有效数字，并以 $\\mathrm{m/s}$ 为单位表示。假设单位质量比总能为 $E = e + \\tfrac{1}{2} u^{2}$，内能为 $e = \\dfrac{p}{(\\gamma - 1)\\rho}$。",
            "solution": "该问题包括两部分。第一部分，从 Euler 方程的积分形式推导一维无粘可压缩流的 Rankine-Hugoniot 跳跃条件。第二部分，根据给定的左态和右态，计算特定间断的速度 $s$。\n\n### 步骤1：问题验证\n\n**1.1. 提取已知条件**\n- **系统**：一维无粘可压缩流。\n- **气体模型**：量热完全气体，具有恒定的比热比 $\\gamma$。\n- **间断**：一个平面间断，将左态 (L) 和右态 (R) 分开，以未知速度 $s$ 移动。\n- **控制方程**：一维 Euler 方程的质量、动量和总能量的积分形式。\n- **任务1**：推导通用的 Rankine-Hugoniot 跳跃条件。\n- **任务2**：为以下状态和气体性质计算间断速度 $s$：\n    - $\\gamma = 1.4$\n    - 左态：$\\rho_{L} = 1.0$ $\\mathrm{kg/m^{3}}$，$u_{L} = 750$ $\\mathrm{m/s}$，$p_{L} = 1.0 \\times 10^{5}$ $\\mathrm{Pa}$。\n    - 右态：$\\rho_{R} = 3.\\overline{3}$ $\\mathrm{kg/m^{3}}$，$u_{R} = 95.20995731456036$ $\\mathrm{m/s}$，$p_{R} = 7.125 \\times 10^{5}$ $\\mathrm{Pa}$。\n- **能量定义**：比总能 $E = e + \\frac{1}{2} u^{2}$，以及比内能 $e = \\frac{p}{(\\gamma - 1)\\rho}$。\n\n**1.2. 使用提取的已知条件进行验证**\n该问题具有科学依据，植根于流体动力学的基本原理（Euler 方程、守恒律、Rankine-Hugoniot 条件）。语言客观、精确。为解决该问题所提供的数据是完整的。右态的具体数值是经过精确选择的，以与左态和控制方程保持一致，使得问题是适定的。不存在科学谬误、矛盾或模糊之处。\n\n**1.3. 结论与行动**\n问题有效。将提供完整解答。\n\n### 步骤2：Rankine-Hugoniot 条件的推导\n\n一维 Euler 方程可以写成守恒律形式：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0\n$$\n其中 $\\mathbf{U}$ 是守恒变量矢量，$\\mathbf{F}(\\mathbf{U})$ 是对应的通量矢量：\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\rho E \\end{pmatrix}, \\quad \\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ (\\rho E + p)u \\end{pmatrix}\n$$\n这里，$\\rho$ 是流体密度，$u$ 是速度，$p$ 是压力，$E$ 是比总能。\n\n为推导跨间断的跳跃条件，我们考虑在一个随间断移动的控制体 $[x_a(t), x_b(t)]$ 上的积分形式守恒律。设间断的位置为 $x_s(t)$，其移动速度为 $s = \\frac{dx_s}{dt}$。我们选择控制体的边界包围间断，$x_a(t)  x_s(t)  x_b(t)$，并随之移动，因此 $\\frac{dx_a}{dt} = \\frac{dx_b}{dt} = s$。\n\n移动控制体的积分形式守恒律由 Reynolds 输运定理给出：\n$$\n\\frac{d}{dt} \\int_{x_a(t)}^{x_b(t)} \\mathbf{U} \\, dx = \\int_{x_a(t)}^{x_b(t)} \\frac{\\partial \\mathbf{U}}{\\partial t} \\, dx + \\mathbf{U}(x_b, t) \\frac{dx_b}{dt} - \\mathbf{U}(x_a, t) \\frac{dx_a}{dt}\n$$\n根据 Euler 方程的微分形式，$\\frac{\\partial \\mathbf{U}}{\\partial t} = -\\frac{\\partial \\mathbf{F}}{\\partial x}$。将此代入积分可得：\n$$\n\\int_{x_a(t)}^{x_b(t)} \\frac{\\partial \\mathbf{U}}{\\partial t} \\, dx = - \\int_{x_a(t)}^{x_b(t)} \\frac{\\partial \\mathbf{F}}{\\partial x} \\, dx = \\mathbf{F}(\\mathbf{U}(x_a, t)) - \\mathbf{F}(\\mathbf{U}(x_b, t))\n$$\n将此代回 Reynolds 输运定理的表达式中：\n$$\n\\frac{d}{dt} \\int_{x_a(t)}^{x_b(t)} \\mathbf{U} \\, dx = \\mathbf{F}(x_a, t) - \\mathbf{F}(x_b, t) + s \\mathbf{U}(x_b, t) - s \\mathbf{U}(x_a, t)\n$$\n现在，我们考虑当控制体在间断周围收缩至零宽度时的极限，即 $x_a \\to x_s^{-}$ 且 $x_b \\to x_s^{+}$。在此极限下，假设 $\\mathbf{U}$ 是有界的，积分项 $\\int_{x_a}^{x_b} \\mathbf{U} \\, dx$ 消失。等式左边变为零。状态 $\\mathbf{U}(x_a, t)$ 和 $\\mathbf{U}(x_b, t)$ 分别趋近于恒定的左态 $\\mathbf{U}_L$ 和右态 $\\mathbf{U}_R$。通量也是如此。这导出：\n$$\n0 = \\mathbf{F}_L - \\mathbf{F}_R + s \\mathbf{U}_R - s \\mathbf{U}_L\n$$\n重新整理此方程，得到 Rankine-Hugoniot 跳跃条件的通用形式：\n$$\ns(\\mathbf{U}_R - \\mathbf{U}_L) = \\mathbf{F}_R - \\mathbf{F}_L\n$$\n使用跳跃符号 $[[q]] = q_R - q_L$，可紧凑地写为 $s[[\\mathbf{U}]] = [[\\mathbf{F}]]$.\n\n写出质量、动量和能量守恒的分量，得到具体的跳跃条件：\n1.  **质量守恒**：\n    $$ s(\\rho_R - \\rho_L) = \\rho_R u_R - \\rho_L u_L $$\n2.  **动量守恒**：\n    $$ s(\\rho_R u_R - \\rho_L u_L) = (\\rho_R u_R^2 + p_R) - (\\rho_L u_L^2 + p_L) $$\n3.  **能量守恒**：\n    $$ s(\\rho_R E_R - \\rho_L E_L) = (\\rho_R E_R + p_R)u_R - (\\rho_L E_L + p_L)u_L $$\n其中 $E = \\frac{p}{(\\gamma-1)\\rho} + \\frac{1}{2}u^2$。这三个方程就是跨移动间断的通用 Rankine-Hugoniot 跳跃条件。\n\n### 步骤3：间断速度的计算\n\n题目给出了 $\\gamma=1.4$ 的量热完全气体的左态和右态。\n- 左态 (L)：$\\rho_{L} = 1.0$ $\\mathrm{kg/m^{3}}$，$u_{L} = 750$ $\\mathrm{m/s}$，$p_{L} = 1.0 \\times 10^{5}$ $\\mathrm{Pa}$。\n- 右态 (R)：$\\rho_{R} = 3.\\overline{3} = \\frac{10}{3}$ $\\mathrm{kg/m^{3}}$，$u_{R} = 95.20995731456036$ $\\mathrm{m/s}$，$p_{R} = 7.125 \\times 10^{5}$ $\\mathrm{Pa}$。\n\n我们可以使用质量守恒的 Rankine-Hugoniot 条件来计算间断速度 $s$。该方程为 $s$ 提供了一个直接的表达式：\n$$\ns = \\frac{\\rho_R u_R - \\rho_L u_L}{\\rho_R - \\rho_L}\n$$\n我们将给定的数值代入此表达式。首先，我们计算分子和分母。\n分子是：\n$$\n[[\\rho u]] = \\rho_R u_R - \\rho_L u_L = \\left(\\frac{10}{3} \\frac{\\mathrm{kg}}{\\mathrm{m^3}}\\right) \\left(95.20995731456036 \\frac{\\mathrm{m}}{\\mathrm{s}}\\right) - \\left(1.0 \\frac{\\mathrm{kg}}{\\mathrm{m^3}}\\right) \\left(750 \\frac{\\mathrm{m}}{\\mathrm{s}}\\right)\n$$\n$$\n[[\\rho u]] \\approx 317.3665243818679 \\frac{\\mathrm{kg}}{\\mathrm{m^2 s}} - 750 \\frac{\\mathrm{kg}}{\\mathrm{m^2 s}} = -432.6334756181321 \\frac{\\mathrm{kg}}{\\mathrm{m^2 s}}\n$$\n分母是：\n$$\n[[\\rho]] = \\rho_R - \\rho_L = \\frac{10}{3} \\frac{\\mathrm{kg}}{\\mathrm{m^3}} - 1.0 \\frac{\\mathrm{kg}}{\\mathrm{m^3}} = \\frac{7}{3} \\frac{\\mathrm{kg}}{\\mathrm{m^3}}\n$$\n现在，我们计算速度 $s$：\n$$\ns = \\frac{-432.6334756181321 \\frac{\\mathrm{kg}}{\\mathrm{m^2 s}}}{\\frac{7}{3} \\frac{\\mathrm{kg}}{\\mathrm{m^3}}} = -432.6334756181321 \\times \\frac{3}{7} \\frac{\\mathrm{m}}{\\mathrm{s}} \\approx -185.4143466934852 \\frac{\\mathrm{m}}{\\mathrm{s}}\n$$\n题目要求将 $s$ 的值四舍五入到四位有效数字。\n$$\ns \\approx -185.4 \\, \\mathrm{m/s}\n$$\n负号表示在实验室参考系中，该间断向左传播。给定的状态值在所有三个 Rankine-Hugoniot 方程中是相互一致的，这证实了该数值问题的适定性。",
            "answer": "$$\\boxed{-185.4}$$"
        },
        {
            "introduction": "精确黎曼求解器通常非常复杂，因此近似黎曼求解器在计算流体力学中扮演着核心角色，其中Roe格式尤为著名。本练习将带你深入Roe格式的数学构造，要求你推导出其核心组成部分——Roe平均雅可比矩阵 $\\tilde{A}$ 。通过这个实践，你将理解Roe格式如何巧妙地利用特定的Roe平均变量（如 $\\tilde{u}$）来线性化非线性的欧拉方程，同时精确满足任意间断的跳跃关系，这是其高效和精确的根源。",
            "id": "3963019",
            "problem": "考虑比热比为 $\\gamma$ 的量热完全气体的一维可压缩欧拉方程，其守恒形式的状态向量为 $q = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}}$，其中 $\\rho$ 是质量密度，$u$ 是速度，$E$ 是比总能。相应的通量函数 $f(q)$ 源于质量、动量和能量守恒以及理想气体闭合关系 $p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho u^{2}\\right)$，其中 $p$ 是压力。在计算流体力学（CFD）的Godunov型有限体积法背景下，Roe线性化旨在寻找一个常数矩阵 $\\tilde{A}$，使得 $f(q_R) - f(q_L) = \\tilde{A}\\,(q_R - q_L)$ 成立，其中 $q_L$ 和 $q_R$ 表示给定的左右状态。\n\n从守恒律公式和理想气体闭合关系出发，定义 $q_L$ 和 $q_R$ 之间的Roe平均变量，并构造相关的以守恒变量表示的常数线性化雅可比矩阵 $\\tilde{A}$，使其满足 $f(q_R) - f(q_L) = \\tilde{A}\\,(q_R - q_L)$。将 $\\tilde{A}$ 用Roe平均速度 $\\tilde{u}$、Roe平均总焓 $\\tilde{H}$ 和比热比 $\\gamma$ 显式地以闭合形式表示，不引入任何数值近似。最终答案必须是单一的闭合形式解析表达式。",
            "solution": "该问题要求为一维可压缩欧拉方程构造Roe平均雅可比矩阵 $\\tilde{A}$。该矩阵必须对任意两个状态 $q_L$ 和 $q_R$ 满足性质 $f(q_R) - f(q_L) = \\tilde{A}\\,(q_R - q_L)$。\n\n守恒变量的状态向量是 $q = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}} = (q_1, q_2, q_3)^{\\mathsf{T}}$。相应的通量向量 $f(q)$ 由质量、动量和能量守恒给出：\n$$\nf(q) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ (\\rho E + p)u \\end{pmatrix}\n$$\n使用守恒变量的定义，我们可以用 $q_1$、$q_2$ 和 $q_3$ 来表示原始变量 $u$ 和压力 $p$。速度为 $u = q_2/q_1$。量热完全气体的压力 $p$ 由状态方程给出：\n$$\np = (\\gamma - 1)\\left(\\rho E - \\frac{1}{2}\\rho u^2\\right) = (\\gamma - 1)\\left(q_3 - \\frac{1}{2}\\frac{q_2^2}{q_1}\\right)\n$$\n于是，通量向量可以显式地用 $q$ 的分量写成：\n$$\nf(q) = \\begin{pmatrix} q_2 \\\\ \\frac{q_2^2}{q_1} + (\\gamma - 1)\\left(q_3 - \\frac{1}{2}\\frac{q_2^2}{q_1}\\right) \\\\ \\left(q_3 + (\\gamma - 1)\\left(q_3 - \\frac{1}{2}\\frac{q_2^2}{q_1}\\right)\\right)\\frac{q_2}{q_1} \\end{pmatrix} = \\begin{pmatrix} q_2 \\\\ (\\frac{3-\\gamma}{2})\\frac{q_2^2}{q_1} + (\\gamma-1)q_3 \\\\ \\gamma\\frac{q_2 q_3}{q_1} - \\frac{\\gamma-1}{2}\\frac{q_2^3}{q_1^2} \\end{pmatrix}\n$$\nRoe矩阵 $\\tilde{A}$ 的构造方式是，它是在一个特别定义的平均状态 $\\tilde{q}$ 下求值的通量雅可比矩阵 $A(q) = \\frac{\\partial f}{\\partial q}$。为了找到该矩阵的形式，我们首先计算任意状态 $q$ 下的解析雅可比矩阵 $A(q)$。用原始变量 $u$ 和比总焓 $H = E + p/\\rho$ 来表示雅可比矩阵的元素会更方便。\n\n雅可比矩阵的分量 $A_{ij} = \\frac{\\partial f_i}{\\partial q_j}$ 如下：\n第1行：\n$$\nA_{11} = \\frac{\\partial q_2}{\\partial q_1} = 0, \\quad A_{12} = \\frac{\\partial q_2}{\\partial q_2} = 1, \\quad A_{13} = \\frac{\\partial q_2}{\\partial q_3} = 0\n$$\n第2行：\n$$\nA_{21} = \\frac{\\partial f_2}{\\partial q_1} = -(\\frac{3-\\gamma}{2})\\frac{q_2^2}{q_1^2} = -\\frac{3-\\gamma}{2}u^2 = \\frac{\\gamma-3}{2}u^2\n$$\n$$\nA_{22} = \\frac{\\partial f_2}{\\partial q_2} = (3-\\gamma)\\frac{q_2}{q_1} = (3-\\gamma)u\n$$\n$$\nA_{23} = \\frac{\\partial f_2}{\\partial q_3} = \\gamma-1\n$$\n第3行：为了计算 $f_3$ 的导数，我们使用形式 $f_3 = (\\rho E + p)u = \\rho u H = q_2 H$。我们需要用 $q_i$ 来表示 $H$。\n$H = E + p/\\rho = q_3/q_1 + (\\gamma-1)(q_3/q_1 - q_2^2/(2q_1^2)) = \\gamma q_3/q_1 - (\\gamma-1)q_2^2/(2q_1^2) = \\gamma E - \\frac{\\gamma-1}{2}u^2$。\n$$\nA_{31} = \\frac{\\partial f_3}{\\partial q_1} = \\frac{\\partial}{\\partial q_1}\\left(\\gamma\\frac{q_2 q_3}{q_1} - \\frac{\\gamma-1}{2}\\frac{q_2^3}{q_1^2}\\right) = -\\gamma\\frac{q_2 q_3}{q_1^2} + (\\gamma-1)\\frac{q_2^3}{q_1^3} = -\\gamma u E + (\\gamma-1)u^3 = u((\\gamma-1)u^2 - \\gamma E)\n$$\n使用 $H = \\gamma E - \\frac{\\gamma-1}{2}u^2$，我们可以写出 $\\gamma E = H + \\frac{\\gamma-1}{2}u^2$。\n所以，$A_{31} = u\\left((\\gamma-1)u^2 - (H + \\frac{\\gamma-1}{2}u^2)\\right) = u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)$。\n$$\nA_{32} = \\frac{\\partial f_3}{\\partial q_2} = \\frac{\\partial}{\\partial q_2}\\left(\\gamma\\frac{q_2 q_3}{q_1} - \\frac{\\gamma-1}{2}\\frac{q_2^3}{q_1^2}\\right) = \\gamma\\frac{q_3}{q_1} - \\frac{3(\\gamma-1)}{2}\\frac{q_2^2}{q_1^2} = \\gamma E - \\frac{3(\\gamma-1)}{2}u^2\n$$\n使用 $\\gamma E$ 的表达式，这变为 $A_{32} = H + \\frac{\\gamma-1}{2}u^2 - \\frac{3(\\gamma-1)}{2}u^2 = H - (\\gamma-1)u^2$。\n$$\nA_{33} = \\frac{\\partial f_3}{\\partial q_3} = \\frac{\\partial}{\\partial q_3}\\left(\\gamma\\frac{q_2 q_3}{q_1} - \\frac{\\gamma-1}{2}\\frac{q_2^3}{q_1^2}\\right) = \\gamma\\frac{q_2}{q_1} = \\gamma u\n$$\n综合这些项，解析通量雅可比矩阵是：\n$$\nA(q) = \\begin{pmatrix} 0  1  0 \\\\ \\frac{\\gamma-3}{2}u^2  (3-\\gamma)u  \\gamma-1 \\\\ u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)  H - (\\gamma-1)u^2  \\gamma u \\end{pmatrix}\n$$\n如果矩阵 $\\tilde{A}$ 是通过在特定平均状态下计算雅可比矩阵 $A(q)$ 构造的，那么Roe线性化条件 $f(q_R) - f(q_L) = \\tilde{A}\\,(q_R - q_L)$ 将被精确满足。这个状态由Roe平均变量定义。对于一维欧拉方程，速度和比总焓的这些平均值定义如下，其中下标 $L$ 和 $R$ 分别表示左右状态：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n这些特定平均值的一个显著特性是，它们确保了线性化条件对于非线性欧拉系统成立。因此，通过将这些Roe平均变量 $\\tilde{u}$ 和 $\\tilde{H}$ 代入解析雅可比矩阵 $A(q)$ 中，即可完成Roe矩阵 $\\tilde{A}$ 的构造。\n\n因此，Roe平均雅可比矩阵 $\\tilde{A}$ 为：\n$$\n\\tilde{A} = \\begin{pmatrix} 0  1  0 \\\\ \\frac{\\gamma-3}{2}\\tilde{u}^2  (3-\\gamma)\\tilde{u}  \\gamma-1 \\\\ \\tilde{u}\\left(\\frac{\\gamma-1}{2}\\tilde{u}^2 - \\tilde{H}\\right)  \\tilde{H} - (\\gamma-1)\\tilde{u}^2  \\gamma \\tilde{u} \\end{pmatrix}\n$$\n对于给定的左右状态 $q_L$ 和 $q_R$，该矩阵是常数，并且通过使用指定的Roe平均值进行构造，它精确地满足了所需性质 $f(q_R) - f(q_L) = \\tilde{A}\\,(q_R - q_L)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  1  0 \\\\ \\frac{\\gamma-3}{2}\\tilde{u}^2  (3-\\gamma)\\tilde{u}  \\gamma-1 \\\\ \\tilde{u}\\left(\\frac{\\gamma-1}{2}\\tilde{u}^2 - \\tilde{H}\\right)  \\tilde{H} - (\\gamma-1)\\tilde{u}^2  \\gamma \\tilde{u} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论上优雅的数值格式在实际应用中常会遇到“病态”情况，Roe格式的一个著名问题是在跨音速区域可能产生非物理的膨胀激波。本练习将引导你从理论走向实践，通过编程实现Harten-Hyman熵修正（entropy fix）来解决这一问题 。你将学习如何识别导致问题的跨音速条件，并通过修改数值耗散项 $|\\tilde{\\lambda}_k|$ 来保证解的物理正确性，最终量化该修正对数值通量的影响。",
            "id": "3963126",
            "problem": "你需要实现、分析和量化在一维可压缩欧拉方程的Godunov型有限体积法中，基于Roe近似黎曼求解器的波速耗散修正。从守恒律和Roe线性化出发，你必须通过适当修改声速点附近Roe线性化特征值的绝对值来实现Harten–Hyman熵修正。你的实现必须展示跨声速阈值参数的选择如何影响数值耗散，并必须在一组精心选择的小型测试套件上，量化有无熵修正时数值通量的差异。\n\n推导和实现的基本依据是：\n- 守恒形式的一维可压缩欧拉方程，表示质量、动量和总能量的守恒：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0,\n$$\n其中\n$$\n\\boldsymbol{U} = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad \\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u (E + p) \\end{bmatrix}.\n$$\n- 理想气体压力状态方程：\n$$\np = (\\gamma - 1) \\left(E - \\frac{1}{2} \\rho u^2 \\right),\n$$\n其中比热比$\\gamma$为常数。\n- Roe线性化及在Roe平均状态下计算的雅可比矩阵的相关特征结构。\n\n你的任务是编写一个完整的、独立的程序，该程序：\n1.  使用比热比$\\gamma = 1.4$的理想气体，为四个指定的左右原始状态，计算单个界面上的Roe数值通量。\n2.  对每种情况实现两次Roe通量计算：\n   - 一次不进行任何熵修正，对每个特征族$k \\in \\{1,2,3\\}$使用与$|\\tilde{\\lambda}_k|$成比例的耗散。\n   - 另一次使用Harten–Hyman熵修正，通过修改$|\\tilde{\\lambda}_k|$来平滑地增加声速点附近的耗散。跨声速检测必须基于每个族的左右特征速度，并且当符号不同时，阈值$\\delta_k$必须根据这些特征速度的差异计算，否则不进行修改。修正函数必须是平滑的，在远离声速区域时等于$|\\tilde{\\lambda}_k|$，在声速区域内严格为正，以避免膨胀激波。\n3.  对于每个测试案例，计算一个浮点数，等于使用熵修正计算的通量向量与未使用熵修正计算的通量向量之差的欧几里得范数。这些是无量纲量，必须以无单位形式表示。\n\n你必须在解决方案中证明你选择阈值参数$\\delta_k$的合理性，从欧拉方程和Roe线性化的性质出发，解释为什么在声速点附近需要进行修正，以及你的阈值如何与具有物理意义的跨声速性度量相关联。\n\n所有变量都是无量纲的。本问题不涉及角度。你的实现必须使用以下四个测试案例，每个案例由左右原始状态$(\\rho_L, u_L, p_L)$和$(\\rho_R, u_R, p_R)$指定：\n- 案例A（非跨声速“顺利路径”）：\n  - 左侧 $(\\rho_L, u_L, p_L) = (1.0, 3.0, 1.0)$\n  - 右侧 $(\\rho_R, u_R, p_R) = (1.0, 2.5, 1.0)$\n- 案例B（在$k=1$族中为跨声速）：\n  - 左侧 $(\\rho_L, u_L, p_L) = (1.0, 0.2, 1.0)$\n  - 右侧 $(\\rho_R, u_R, p_R) = (1.0, 1.4, 1.0)$\n- 案例C（在$k=2$族中接近声速）：\n  - 左侧 $(\\rho_L, u_L, p_L) = (1.0, -0.1, 1.0)$\n  - 右侧 $(\\rho_R, u_R, p_R) = (1.0, 0.1, 1.0)$\n- 案例D（在$k=3$族中为跨声速）：\n  - 左侧 $(\\rho_L, u_L, p_L) = (1.0, -1.0, 0.5)$\n  - 右侧 $(\\rho_R, u_R, p_R) = (1.0, 0.9, 0.5)$\n\n你的程序必须产生单行输出，其中包含四个测试案例的四个结果，格式为方括号括起来的逗号分隔列表（例如，$[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$）。每个案例的结果是如上所述的单个浮点数。不允许有其他输出。\n\n总结主要算法要求：\n- 使用Roe平均状态计算线性化特征结构，包括特征速度$\\tilde{\\lambda}_k$和右特征向量$\\tilde{\\boldsymbol{r}}_k$。\n- 使用从原始左右状态计算的左右特征速度$\\lambda_{L,k}$和$\\lambda_{R,k}$，对每个特征族进行跨声速检测。\n- 构造一个平滑的熵修正函数，该函数仅在$\\lambda_{L,k}$和$\\lambda_{R,k}$符号不同时作用于$|\\tilde{\\lambda}_k|$，其阈值$\\delta_k$由跨声速区间的幅度确定，否则不进行修改。\n- 计算有和没有熵修正的Roe通量，并输出每种情况下它们之间差值的范数。\n\n所有计算必须以双精度进行。由于所有量都是无量纲的，输出中不包含物理单位。",
            "solution": "该问题要求对应用于一维可压缩欧拉方程的Roe近似黎曼求解器，实现并分析一种Harten-Hyman熵修正。我们必须对一系列指定的测试案例，量化此修正引起的数值通量向量的变化。解决方案首先详细介绍底层的Roe格式，然后描述熵修正机制，最后概述计算所需量的算法。\n\n### 1. Roe近似黎曼求解器\n\n一维可压缩理想气体的欧拉方程是一个守恒律方程组：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0\n$$\n守恒变量向量$\\boldsymbol{U}$和通量向量$\\boldsymbol{F}(\\boldsymbol{U})$由下式给出：\n$$\n\\boldsymbol{U} = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad \\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u (E + p) \\end{bmatrix}\n$$\n这里，$\\rho$是密度， $u$是速度， $E$是单位体积的总能量， $p$是压力。该系统由理想气体状态方程闭合：\n$$\np = (\\gamma - 1) \\left(E - \\frac{1}{2}\\rho u^2\\right)\n$$\n其中$\\gamma$是比热比，给定为1.4。其他相关的热力学量是声速 $c = \\sqrt{\\gamma p / \\rho}$ 和比总焓 $H = (E+p)/\\rho$。\n\nGodunov型有限体积法在每个计算单元之间的界面上需要一个数值通量函数$ \\boldsymbol{F}_{i+1/2} $。Roe求解器提供了在左状态$\\boldsymbol{U}_L$和右状态$\\boldsymbol{U}_R$之间的界面处黎曼问题解的一个近似。这是通过求解一个线性化问题来实现的：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\tilde{A}(\\boldsymbol{U}_L, \\boldsymbol{U}_R) \\frac{\\partial \\boldsymbol{U}}{\\partial x} = 0\n$$\n其中$\\tilde{A}$是Roe矩阵，一个常数矩阵，满足几个关键性质，最重要的是$\\tilde{A}(\\boldsymbol{U}_L, \\boldsymbol{U}_R) (\\boldsymbol{U}_R - \\boldsymbol{U}_L) = \\boldsymbol{F}(\\boldsymbol{U}_R) - \\boldsymbol{F}(\\boldsymbol{U}_L)$。Roe矩阵是使用Roe平均状态构造的。\n\nRoe平均量定义如下：\n$$\n\\tilde{\\rho} = \\sqrt{\\rho_L \\rho_R}\n$$\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n由此，平均声速为$\\tilde{c} = \\sqrt{(\\gamma - 1)(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2)}$。\n\nRoe矩阵$\\tilde{A}$的特征结构至关重要。其特征值（特征速度）为：\n$$\n\\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{c}, \\quad \\tilde{\\lambda}_2 = \\tilde{u}, \\quad \\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{c}\n$$\n相应的右特征向量是：\n$$\n\\tilde{\\boldsymbol{r}}_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{c} \\\\ \\tilde{H} - \\tilde{u}\\tilde{c} \\end{bmatrix}, \\quad \\tilde{\\boldsymbol{r}}_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad \\tilde{\\boldsymbol{r}}_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{c} \\\\ \\tilde{H} + \\tilde{u}\\tilde{c} \\end{bmatrix}\n$$\n守恒变量的跳跃量$\\Delta\\boldsymbol{U} = \\boldsymbol{U}_R - \\boldsymbol{U}_L$可以投影到这个特征空间上：\n$$\n\\Delta\\boldsymbol{U} = \\sum_{k=1}^3 \\tilde{\\alpha}_k \\tilde{\\boldsymbol{r}}_k\n$$\n系数$\\tilde{\\alpha}_k$是波强度。它们可以从原始变量的跳跃量$\\Delta p = p_R - p_L$、$\\Delta \\rho = \\rho_R - \\rho_L$和$\\Delta u = u_R - u_L$计算得出：\n$$\n\\tilde{\\alpha}_1 = \\frac{\\Delta p - \\tilde{\\rho}\\tilde{c}\\Delta u}{2\\tilde{c}^2}\n$$\n$$\n\\tilde{\\alpha}_2 = \\Delta \\rho - \\frac{\\Delta p}{\\tilde{c}^2}\n$$\n$$\n\\tilde{\\alpha}_3 = \\frac{\\Delta p + \\tilde{\\rho}\\tilde{c}\\Delta u}{2\\tilde{c}^2}\n$$\n标准Roe通量则由下式给出：\n$$\n\\boldsymbol{F}_{Roe} = \\frac{1}{2} \\left[ \\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R) \\right] - \\frac{1}{2} \\sum_{k=1}^3 |\\tilde{\\lambda}_k| \\tilde{\\alpha}_k \\tilde{\\boldsymbol{r}}_k\n$$\n第二项表示数值耗散，与波速的绝对值成正比。\n\n### 2. Harten-Hyman熵修正\n\n当特征波穿过声速点时，标准Roe求解器可能会产生非物理解，例如膨胀激波。这发生在稀疏波内部的某个特征值$\\tilde{\\lambda}_k$接近于零时。例如，在跨声速稀疏波中，特征速度$\\lambda_k(x)$从一个负值平滑过渡到一个正值。Roe平均速度$\\tilde{\\lambda}_k$可能被计算为零或非常接近零，导致数值耗散不足。\n\nHarten-Hyman熵修正通过修改波速的绝对值来解决这个问题。修正后的波速$|\\tilde{\\lambda}_k|_{fixed}$在声速区域内必须严格为正。该修正仅在检测到跨声速条件时应用。根据问题陈述，此检测基于左右状态的特征速度：\n$$\n\\lambda_{k,L} = u_L - c_L \\:(k=1), \\: u_L \\:(k=2), \\: u_L + c_L \\:(k=3)\n$$\n$$\n\\lambda_{k,R} = u_R - c_R \\:(k=1), \\: u_R \\:(k=2), \\: u_R + c_R \\:(k=3)\n$$\n如果第$k$族的特征速度穿过零点，即$\\lambda_{k,L} \\cdot \\lambda_{k,R}  0$，则存在跨声速波。\n\n当满足此条件时，我们定义一个阈值$\\delta_k$。问题规定此阈值是根据特征速度的差异计算的。这里采用的一个具有物理动机的选择是，将阈值设置为跨越波的特征速度范围：\n$$\n\\delta_k = |\\lambda_{k,R} - \\lambda_{k,L}|\n$$\n该阈值代表了跨声速区域的“宽度”。然后，如果Roe平均速度落入此区域内，Harten-Hyman修正使用一个平滑函数（通常是抛物线混合）来修改波速：\n$$\n|\\tilde{\\lambda}_k|_{fixed} = \\begin{cases}\n                               |\\tilde{\\lambda}_k|  \\text{若 } |\\tilde{\\lambda}_k| \\ge \\delta_k \\\\\n                               \\frac{\\tilde{\\lambda}_k^2 + \\delta_k^2}{2\\delta_k}  \\text{若 } |\\tilde{\\lambda}_k|  \\delta_k\n                               \\end{cases}\n$$\n该函数确保耗散项保持为正，在声速区外平滑地匹配$|\\tilde{\\lambda}_k|$，并在过渡点$|\\tilde{\\lambda}_k| = \\delta_k$处提供连续的一阶导数。\n\n带熵修正的数值通量为：\n$$\n\\boldsymbol{F}_{fix} = \\frac{1}{2} \\left[ \\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R) \\right] - \\frac{1}{2} \\sum_{k=1}^3 |\\tilde{\\lambda}_k|_{fixed} \\tilde{\\alpha}_k \\tilde{\\boldsymbol{r}}_k\n$$\n\n### 3. 通量差的计算\n\n问题要求计算使用熵修正的通量向量与未使用熵修正的通量向量之差的欧几里得范数。这个差值$\\Delta\\boldsymbol{F} = \\boldsymbol{F}_{fix} - \\boldsymbol{F}_{Roe}$简化为：\n$$\n\\Delta\\boldsymbol{F} = \\frac{1}{2} \\sum_{k=1}^3 \\left( |\\tilde{\\lambda}_k| - |\\tilde{\\lambda}_k|_{fixed} \\right) \\tilde{\\alpha}_k \\tilde{\\boldsymbol{r}}_k\n$$\n该表达式仅在熵修正起作用的特征族$k$上非零，即当$\\lambda_{k,L} \\cdot \\lambda_{k,R}  0$且$|\\tilde{\\lambda}_k|  \\delta_k$时。每个测试案例的最终计算量是$\\|\\Delta\\boldsymbol{F}\\|_2$。\n\n### 4. 算法步骤\n\n对于每个测试案例$(\\rho_L, u_L, p_L)$和$(\\rho_R, u_R, p_R)$：\n1.  设置$\\gamma = 1.4$。\n2.  计算左右状态的属性：总能量$E$、总焓$H$和声速$c$。\n3.  计算Roe平均状态变量$\\tilde{\\rho}$、$\\tilde{u}$、$\\tilde{H}$和$\\tilde{c}$。\n4.  确定Roe矩阵的特征结构：特征值$\\tilde{\\lambda}_k$和右特征向量$\\tilde{\\boldsymbol{r}}_k$。\n5.  从原始变量的跳跃量计算波强度$\\tilde{\\alpha}_k$。\n6.  初始化通量差向量$\\Delta\\boldsymbol{F} = [0, 0, 0]^T$。\n7.  对于每个特征族$k \\in \\{1, 2, 3\\}$：\n    a. 计算特征速度$\\lambda_{k,L}$和$\\lambda_{k,R}$。\n    b. 检查跨声速条件：$\\lambda_{k,L} \\cdot \\lambda_{k,R}  0$。\n    c. 如果条件满足：\n        i.   计算阈值$\\delta_k = |\\lambda_{k,R} - \\lambda_{k,L}|$。\n        ii.  如果$|\\tilde{\\lambda}_k|  \\delta_k$，计算修正后的波速$|\\tilde{\\lambda}_k|_{fixed} = (\\tilde{\\lambda}_k^2 + \\delta_k^2) / (2\\delta_k)$。\n        iii. 否则，$|\\tilde{\\lambda}_k|_{fixed} = |\\tilde{\\lambda}_k|$。\n    d. 如果条件不满足，设置$|\\tilde{\\lambda}_k|_{fixed} = |\\tilde{\\lambda}_k|$。\n    e. 更新通量差向量：$\\Delta\\boldsymbol{F} \\leftarrow \\Delta\\boldsymbol{F} + \\frac{1}{2} (|\\tilde{\\lambda}_k| - |\\tilde{\\lambda}_k|_{fixed}) \\tilde{\\alpha}_k \\tilde{\\boldsymbol{r}}_k$。\n8.  计算并存储最终结果：欧几里得范数$\\|\\Delta\\boldsymbol{F}\\|_2$。\n9.  处理完所有案例后，将结果格式化为所需的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    It computes the Euclidean norm of the difference between the Roe flux with and\n    without a Harten-Hyman entropy fix for four specified Riemann problems.\n    \"\"\"\n\n    def calculate_flux_difference_norm(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma):\n        \"\"\"\n        Computes the norm of the flux difference for a single interface.\n\n        Args:\n            rho_L, u_L, p_L: Left primitive state (density, velocity, pressure).\n            rho_R, u_R, p_R: Right primitive state.\n            gamma: Ratio of specific heats.\n\n        Returns:\n            The Euclidean norm of the flux difference vector.\n        \"\"\"\n        # 1. Convert primitive to conservative variables and compute related quantities\n        # Left state\n        e_L = p_L / (gamma - 1.0)\n        E_L = e_L + 0.5 * rho_L * u_L**2\n        c_L = np.sqrt(gamma * p_L / rho_L)\n        H_L = (E_L + p_L) / rho_L\n        F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n\n        # Right state\n        e_R = p_R / (gamma - 1.0)\n        E_R = e_R + 0.5 * rho_R * u_R**2\n        c_R = np.sqrt(gamma * p_R / rho_R)\n        H_R = (E_R + p_R) / rho_R\n        F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n\n        # 2. Roe-averaged state\n        sqrt_rho_L = np.sqrt(rho_L)\n        sqrt_rho_R = np.sqrt(rho_R)\n        \n        roe_rho = sqrt_rho_L * sqrt_rho_R\n        roe_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n        roe_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n        roe_c_sq = (gamma - 1.0) * (roe_H - 0.5 * roe_u**2)\n        \n        # Handle case where roe_c_sq can become negative due to large jumps (pathological)\n        if roe_c_sq  0:\n            # Fallback to a simple average if Roe average fails\n            # This is a robustness measure, not expected for the given test cases.\n            roe_c = 0.5 * (c_L + c_R)\n        else:\n            roe_c = np.sqrt(roe_c_sq)\n\n        # 3. Eigenstructure of the Roe matrix\n        # Eigenvalues\n        roe_lambda = np.array([roe_u - roe_c, roe_u, roe_u + roe_c])\n\n        # Right eigenvectors\n        roe_r = np.zeros((3, 3))\n        roe_r[:, 0] = np.array([1.0, roe_u - roe_c, roe_H - roe_u * roe_c])\n        roe_r[:, 1] = np.array([1.0, roe_u, 0.5 * roe_u**2])\n        roe_r[:, 2] = np.array([1.0, roe_u + roe_c, roe_H + roe_u * roe_c])\n\n        # Wave strengths (alpha)\n        dp = p_R - p_L\n        drho = rho_R - rho_L\n        du = u_R - u_L\n        \n        alpha = np.zeros(3)\n        if np.isclose(roe_c, 0): # Avoid division by zero\n            # This case implies very low energy, not expected here\n            alpha[0], alpha[1], alpha[2] = 0.0, drho, 0.0\n        else:\n            alpha[1] = drho - dp / roe_c_sq\n            alpha[0] = (dp - roe_rho * roe_c * du) / (2.0 * roe_c_sq)\n            alpha[2] = (dp + roe_rho * roe_c * du) / (2.0 * roe_c_sq)\n\n        # 4. Harten-Hyman entropy fix\n        # Characteristic speeds at left and right states\n        lambda_L = np.array([u_L - c_L, u_L, u_L + c_L])\n        lambda_R = np.array([u_R - c_R, u_R, u_R + c_R])\n\n        abs_roe_lambda_fixed = np.abs(roe_lambda)\n\n        for k in range(3):\n            # Check for transonic condition (rarefaction crossing zero)\n            if lambda_L[k]  0.0 and lambda_R[k] > 0.0:\n                delta_k = lambda_R[k] - lambda_L[k]\n                if abs(roe_lambda[k])  delta_k:\n                    abs_roe_lambda_fixed[k] = (roe_lambda[k]**2 + delta_k**2) / (2.0 * delta_k)\n            # The problem focuses on the fundamental entropy failure in rarefactions.\n            # Shocks, where lambda_R[k]  0  lambda_L[k], generally satisfy the entropy condition\n            # with the Roe scheme, so no fix is applied here, following common practice.\n            # Symmetrically, we could check lambda_L[k] * lambda_R[k]  0.\n            # The current check is more targeted.\n\n        # 5. Compute the flux difference\n        # Delta F = 0.5 * sum_k ( |lambda_k| - |lambda_k|_fixed ) * alpha_k * r_k\n        flux_diff = np.zeros(3)\n        for k in range(3):\n            dissipation_diff = 0.5 * (np.abs(roe_lambda[k]) - abs_roe_lambda_fixed[k])\n            flux_diff += dissipation_diff * alpha[k] * roe_r[:, k]\n\n        # 6. Return the Euclidean norm of the difference vector\n        return np.linalg.norm(flux_diff)\n\n    # Define the test cases from the problem statement.\n    # Each case is ((rho_L, u_L, p_L), (rho_R, u_R, p_R))\n    test_cases = [\n        # Case A: Non-transonic\n        ((1.0, 3.0, 1.0), (1.0, 2.5, 1.0)),\n        # Case B: Transonic in k=1 family\n        ((1.0, 0.2, 1.0), (1.0, 1.4, 1.0)),\n        # Case C: Near-sonic in k=2 family\n        ((1.0, -0.1, 1.0), (1.0, 0.1, 1.0)),\n        # Case D: Transonic in k=3 family\n        ((1.0, -1.0, 0.5), (1.0, 0.9, 0.5)),\n    ]\n\n    gamma = 1.4\n    results = []\n\n    for case in test_cases:\n        (rho_L, u_L, p_L), (rho_R, u_R, p_R) = case\n        result = calculate_flux_difference_norm(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n        results.append(result)\n\n    # Format the final output as a comma-separated list in brackets.\n    output_str = \"[\" + \",\".join(f\"{res:.15f}\" for res in results) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}