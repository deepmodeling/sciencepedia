{
    "hands_on_practices": [
        {
            "introduction": "理论是实践的基础。在深入研究 Rhie-Chow 插值的实现细节之前，通过一个经典的思维实验来理解其必要性至关重要。这个练习将引导你分析一个简化的离散格式，并揭示为何在同位网格上简单的线性插值会导致压力-速度解耦问题 。",
            "id": "3991734",
            "problem": "考虑一个用于不可压缩流计算流体动力学（CFD）的二维、均匀笛卡尔、同位网格有限体积离散化。该离散化应用于一个由 $(i,j)$ 索引的内部单元，其均匀间距为 $\\Delta x$ 和 $\\Delta y$。连续性方程要求面法向速度的离散散度为零。面法向速度通过单元中心速度的线性插值得到。单元中心的动量方程使用中心差分格式来近似压力梯度进行离散化，并且离散动量算子的对角系数是一个正常数 $a$（对于两个速度分量相同）。假设对预测的单元中心速度的非压力贡献项为零，因此唯一的驱动项是压力梯度。\n\n设单元中心压力场为棋盘格分布，定义为 $p_{i,j} = p_{0} + \\alpha (-1)^{i+j}$，其中 $p_{0}$ 和 $\\alpha$ 是常数。\n\n仅使用这些前提，并将面法向速度取为相邻单元中心速度的算术平均值，推导在单元 $(i,j)$ 处的离散散度的精确解析表达式，该散度由下式给出\n$$\n\\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{\\Delta x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{\\Delta y},\n$$\n其中 $u$ 和 $v$ 分别是速度的 $x$ 和 $y$ 分量。然后，对于给定的棋盘格压力场，计算该离散散度的值。将最终值以单个实数或单个封闭形式表达式给出。如果最终结果为精确值，请勿四舍五入。从第一性原理出发，简要解释为什么对于所述的离散化和压力场，该结果成立。",
            "solution": "用户提供了一个有效的计算流体动力学（CFD）问题陈述。该问题要求分析标准同位网格有限体积离散化方法在受到棋盘格压力场作用时对不可压缩流的行为。这是一个经典的教学问题，用于演示压力-速度解耦现象，并说明为何需要专门的插值方案。\n\n根据要求，解答过程分三个阶段进行：\n1. 推导离散散度的一般解析表达式。\n2. 对指定的棋盘格压力场计算此表达式的值。\n3. 从第一性原理出发解释该结果。\n\n**1. 离散散度表达式的推导**\n\n问题陈述指出，对预测的单元中心速度的非压力贡献项为零。单元中心 $(i,j)$ 的离散动量方程仅由压力梯度驱动，该梯度通过中心差分格式近似。动量算子的对角系数是一个常数 $a$。\n\n因此，离散动量方程为：\n$$\na u_{i,j} = - \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\n$$\n$$\na v_{i,j} = - \\frac{p_{i,j+1} - p_{i,j-1}}{2\\Delta y}\n$$\n\n由此，我们可以直接用压力场表示单元中心的速度：\n$$\nu_{i,j} = - \\frac{1}{2a\\Delta x} (p_{i+1,j} - p_{i-1,j})\n$$\n$$\nv_{i,j} = - \\frac{1}{2a\\Delta y} (p_{i,j+1} - p_{i,j-1})\n$$\n\n面法向速度通过取相邻单元中心速度的算术平均值得到。对于围绕单元 $(i,j)$ 的控制体的面，这些速度为：\n$$\nu_{i+\\frac{1}{2},j} = \\frac{u_{i,j} + u_{i+1,j}}{2}\n$$\n$$\nu_{i-\\frac{1}{2},j} = \\frac{u_{i-1,j} + u_{i,j}}{2}\n$$\n$$\nv_{i,j+\\frac{1}{2}} = \\frac{v_{i,j} + v_{i,j+1}}{2}\n$$\n$$\nv_{i,j-\\frac{1}{2}} = \\frac{v_{i,j-1} + v_{i,j}}{2}\n$$\n\n现在，我们将单元中心速度的表达式代入面速度的定义中。对于 $x$ 方向的速度：\n$$\nu_{i+\\frac{1}{2},j} = \\frac{1}{2} \\left[ \\left(-\\frac{p_{i+1,j} - p_{i-1,j}}{2a\\Delta x}\\right) + \\left(-\\frac{p_{i+2,j} - p_{i,j}}{2a\\Delta x}\\right) \\right] = -\\frac{1}{4a\\Delta x} (p_{i+2,j} + p_{i+1,j} - p_{i,j} - p_{i-1,j})\n$$\n$$\nu_{i-\\frac{1}{2},j} = \\frac{1}{2} \\left[ \\left(-\\frac{p_{i,j} - p_{i-2,j}}{2a\\Delta x}\\right) + \\left(-\\frac{p_{i+1,j} - p_{i-1,j}}{2a\\Delta x}\\right) \\right] = -\\frac{1}{4a\\Delta x} (p_{i+1,j} + p_{i,j} - p_{i-1,j} - p_{i-2,j})\n$$\n\n穿过单元的 $x$ 方向速度之差为：\n$$\nu_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j} = -\\frac{1}{4a\\Delta x} \\left[ (p_{i+2,j} + p_{i+1,j} - p_{i,j} - p_{i-1,j}) - (p_{i+1,j} + p_{i,j} - p_{i-1,j} - p_{i-2,j}) \\right]\n$$\n$$\nu_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j} = -\\frac{1}{4a\\Delta x} (p_{i+2,j} - 2p_{i,j} + p_{i-2,j})\n$$\n\n同理，对于 $y$ 方向的速度：\n$$\nv_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}} = -\\frac{1}{4a\\Delta y} (p_{i,j+2} - 2p_{i,j} + p_{i,j-2})\n$$\n\n单元 $(i,j)$ 处的离散散度由 $D_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{\\Delta x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{\\Delta y}$ 给出。代入速度差的表达式，我们得到离散散度的一般表达式：\n$$\nD_{i,j} = \\frac{1}{\\Delta x} \\left( -\\frac{p_{i+2,j} - 2p_{i,j} + p_{i-2,j}}{4a\\Delta x} \\right) + \\frac{1}{\\Delta y} \\left( -\\frac{p_{i,j+2} - 2p_{i,j} + p_{i,j-2}}{4a\\Delta y} \\right)\n$$\n$$\nD_{i,j} = -\\frac{1}{4a} \\left[ \\frac{p_{i+2,j} - 2p_{i,j} + p_{i-2,j}}{(\\Delta x)^2} + \\frac{p_{i,j+2} - 2p_{i,j} + p_{i,j-2}}{(\\Delta y)^2} \\right]\n$$\n这就是所要求的以节点压力值表示的离散散度的解析表达式。\n\n**2. 对棋盘格压力场的求值**\n\n给定棋盘格压力场 $p_{i,j} = p_0 + \\alpha (-1)^{i+j}$。让我们计算散度表达式中的压力项：\n对于 $x$ 方向的项：\n$$\np_{i+2,j} = p_0 + \\alpha (-1)^{(i+2)+j} = p_0 + \\alpha (-1)^{i+j} (-1)^2 = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\n$$\np_{i-2,j} = p_0 + \\alpha (-1)^{(i-2)+j} = p_0 + \\alpha (-1)^{i+j} (-1)^{-2} = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\n散度表达式中第一项的分子变为：\n$$\np_{i+2,j} - 2p_{i,j} + p_{i-2,j} = p_{i,j} - 2p_{i,j} + p_{i,j} = 0\n$$\n\n对于 $y$ 方向的项：\n$$\np_{i,j+2} = p_0 + \\alpha (-1)^{i+(j+2)} = p_0 + \\alpha (-1)^{i+j} (-1)^2 = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\n$$\np_{i,j-2} = p_0 + \\alpha (-1)^{i+(j-2)} = p_0 + \\alpha (-1)^{i+j} (-1)^{-2} = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\n第二项的分子变为：\n$$\np_{i,j+2} - 2p_{i,j} + p_{i,j-2} = p_{i,j} - 2p_{i,j} + p_{i,j} = 0\n$$\n\n将这些结果代入 $D_{i,j}$ 的表达式中：\n$$\nD_{i,j} = -\\frac{1}{4a} \\left[ \\frac{0}{(\\Delta x)^2} + \\frac{0}{(\\Delta y)^2} \\right] = 0\n$$\n\n**3. 从第一性原理出发的解释**\n\n离散散度为零的结果是这种简单离散化方案在同位网格上产生压力-速度解耦的直接后果。解释如下：\n\n首先，考察用于计算单元中心速度的离散压力梯度算子，例如在 $x$ 方向：$\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}$。该算子在节点 $i-1$ 和 $i+1$ 处对压力场进行采样，完全跳过了正在计算速度的节点 $i$。\n\n对于棋盘格场 $p_{i,j} = p_0 + \\alpha (-1)^{i+j}$，在 $i-1$ 和 $i+1$ 处的值为：\n$$\np_{i+1,j} = p_0 + \\alpha (-1)^{i+1+j} = p_0 - \\alpha (-1)^{i+j}\n$$\n$$\np_{i-1,j} = p_0 + \\alpha (-1)^{i-1+j} = p_0 - \\alpha (-1)^{i+j}\n$$\n因此，$p_{i+1,j} - p_{i-1,j} = 0$。压力梯度的中心差分算子对棋盘格模式是“盲目”的，而这种模式代表了网格上可表示的最高频率模态。\n\n由于对于该压力场，离散压力梯度处处为零，并且假设速度仅由该梯度驱动，因此可以得出，计算出的单元中心速度处处为零：对于所有 $(i,j)$，$u_{i,j} = 0$ 且 $v_{i,j} = 0$。\n\n接下来，通过对相邻的（零）单元中心速度进行平均来计算面速度。这自然导致所有面速度也为零：$u_{i+\\frac{1}{2},j} = 0$，$u_{i-\\frac{1}{2},j} = 0$ 等。\n\n最后，离散散度由这些值为零的面速度的差值计算得出。结果必然为零。\n\n这说明了此特定数值方案的一个关键缺陷：一个高度振荡的、非恒定的压力场不产生任何速度，却完美地满足了离散连续性方程（$\\text{divergence} = 0$）。这意味着这种伪压力模态可以污染数值解，而不会在像 SIMPLE 这样的算法的压力修正步骤中被检测或校正。这就是最初引入交错网格的原因，也是现代同位网格方法必须采用更复杂的插值技术（例如 Rhie–Chow 插值）来防止这种解耦的原因。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "在分析了棋盘格压力场如何导致数值散度为零之后，下一步是通过编写代码来亲手验证这一现象，并展示 Rhie-Chow 插值如何解决这个问题。这个实践练习要求你构建一个数值测试，直观地对比传统插值与 Rhie-Chow 插值在面对高频压力振荡时的不同响应 。",
            "id": "3939869",
            "problem": "考虑一个均匀同位网格上的二维不可压定常流，其中速度分量和压力存储在单元中心。控制方程为连续性方程 $\\nabla \\cdot \\mathbf{u} = 0$ 和动量方程 $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$，其中密度 $\\rho$ 和动力粘度 $\\mu$ 为常数。在计算流体动力学 (CFD) 中，一个众所周知的问题是，除非应用像 Rhie–Chow 插值这样的稳定化方法，否则同位网格可能会表现出虚假的压力振荡（棋盘格现象）。您的任务是构建一个简单的离散测试，以演示即使在施加了精确的均匀边界条件时，压力振荡在没有 Rhie–Chow 插值的同位网格上是如何产生的。\n\n基本基准和离散设置：\n- 使用一个大小为 $N_x \\times N_y$ 的均匀笛卡尔网格，均匀间距 $\\Delta x = 1$ 和 $\\Delta y = 1$，并在两个方向上采用周期性边界条件。周期性边界代表了均匀解的精确延续。\n- 假设一个基准均匀速度场 $\\tilde{u} = U_0$ 和 $\\tilde{v} = 0$，以及一个基准压力 $p_0$（常数）。所有量都是无量纲的。\n- 引入一个振幅为 $\\varepsilon$ 的小的、无量纲的棋盘格压力扰动，叠加在 $p_0$ 上：\n$$\np_{i,j} = p_0 + \\varepsilon (-1)^{i+j},\n$$\n其中单元索引 $i \\in \\{0,1,\\dots,N_x-1\\}$ 和 $j \\in \\{0,1,\\dots,N_y-1\\}$。对于周期性边界和偶数的 $N_x, N_y$，此扰动是一致的，并且基准均匀解在边界上保持精确。\n\n离散梯度、速度更新和面插值：\n- 使用二阶中心差分（带周期性环绕）计算离散的单元中心压力梯度：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta y}.\n$$\n- 定义一个无量纲的动量对角系数 $a_m > 0$，它代表了隐式动量算子的强度（其倒数缩放压力梯度对速度的贡献）。由压力引起的单元中心速度更新如下：\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}.\n$$\n\n两种面插值策略：\n1. 不使用 Rhie–Chow 插值（朴素的同位插值）：\n   - 通过对相邻单元中心速度进行线性插值来计算面速度：\n   $$\n   u_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n   $$\n   $$\n   v_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n   $$\n   - 使用面通量差分计算每个单元的离散散度：\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = \\frac{u_{e,i,j} - u_{w,i,j}}{\\Delta x} + \\frac{v_{n,i,j} - v_{s,i,j}}{\\Delta y}.\n   $$\n2. 使用 Rhie–Chow 插值（稳定的同位插值）：\n   - 定义面动量系数 $a_f = a_m$。\n   - 用一个跨面的压差项来增强面速度：\n   $$\n   u_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad\n   u_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x},\n   $$\n   $$\n   v_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}, \\quad\n   v_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}.\n   $$\n   - 计算离散散度：\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y}.\n   $$\n\n定量度量：\n- 对于每种策略，计算散度的全局离散 $L^2$ 范数：\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2 = \\left( \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left[ (\\nabla \\cdot \\mathbf{u})_{i,j} \\right]^2 \\right)^{1/2}.\n$$\n- 证明对于棋盘格扰动和周期性边界，朴素的同位插值得出的 $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ 在数值上等于 $0$（或达到机器精度），而 Rhie–Chow 插值得出的 $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ 是一个与 $\\varepsilon$ 成正比的严格正值。\n\n测试套件：\n- 使用以下参数集 $(N_x,N_y,U_0,a_m,\\varepsilon)$，所有参数均为无量纲：\n  1. $(4,4,1.0,1.0,10^{-3})$\n  2. $(16,16,0.5,1.0,10^{-3})$\n  3. $(8,8,0.0,2.0,10^{-6})$\n  4. $(6,10,3.0,0.5,10^{-4})$\n\n程序要求：\n- 实现上述带有周期性边界条件和两种面插值策略的离散操作。\n- 对于每个测试用例，计算并记录一对浮点数 $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、由这些浮点数对组成的逗号分隔列表，例如 $[[a,b],[c,d],[e,f],[g,h]]$，其中每个字母都是一个浮点数。\n\n所有量都是无量纲的，因此输出中不需要物理单位。不出现角度。不使用百分比。",
            "solution": "我们从不可压连续性方程 $\\nabla \\cdot \\mathbf{u} = 0$ 和定常动量方程 $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$ 开始。在同位网格上，速度 $\\mathbf{u}$ 和压力 $p$ 存储在相同的位置（单元中心）。对于具有周期性边界的定常均匀流，一个精确解是 $\\mathbf{u} = (U_0, 0)$ 且压力 $p = p_0$ 为常数。我们考虑一个叠加的棋盘格压力扰动 $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$，以研究面插值格式的数值响应。\n\n离散化选择：\n- 我们采用一个均匀网格，其中 $\\Delta x = \\Delta y = 1$，具有周期性边界条件，并使用中心差分计算单元中心的压力梯度：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2}.\n$$\n对于棋盘格模式和偶数的 $N_x, N_y$，我们注意到 $p_{i+1,j}$ 实际上是 $p_0 + \\varepsilon (-1)^{i+1+j} = p_0 - \\varepsilon (-1)^{i+j}$，这意味着 $p_{i \\pm 1, j}$ 和 $p_{i, j \\pm 1}$ 相对于 $p_{i,j}$ 的振荡部分符号相反。因此，考虑中心差分时，振荡部分在分子中相加，而常数 $p_0$ 则相减抵消。\n$$\np_{i+1,j} - p_{i-1,j} = (p_0 + \\varepsilon (-1)^{i+1+j}) - (p_0 + \\varepsilon (-1)^{i-1+j}) = \\varepsilon ((-1)^{i+1+j} - (-1)^{i-1+j}) = \\varepsilon ((-1)^{i+1+j} - (-1)^{i+1+j}) = 0.\n$$\n同理，$p_{i,j+1} - p_{i,j-1} = 0$。因此\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = 0, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = 0.\n$$\n因此，由压力梯度更新的单元中心速度，\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j},\n$$\n在所有地方都简化为 $u_{i,j} = \\tilde{u} = U_0$ 和 $v_{i,j} = \\tilde{v} = 0$，尽管存在压力振荡。\n\n朴素的同位面插值：\n- 朴素策略将单元中心速度线性插值到面上：\n$$\nu_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n$$\n$$\nv_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n$$\n由于 $u_{i,j} = U_0$ 是常数且 $v_{i,j} = 0$ 是常数，我们有 $u_{e,i,j} = u_{w,i,j} = U_0$ 和 $v_{n,i,j} = v_{s,i,j} = 0$。因此，离散散度\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = (u_{e,i,j} - u_{w,i,j}) + (v_{n,i,j} - v_{s,i,j}) = 0,\n$$\n对所有单元成立。全局 $L^2$ 范数 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$ 恒等于 $0$。这揭示了解耦现象：棋盘格压力振荡不会在面上引起任何校正质量通量，因此连续性方程对其“视而不见”，从而允许虚假压力模式持续存在。\n\nRhie–Chow 插值：\n- Rhie–Chow 插值通过添加一个使用面心压力差分而非单元中心梯度的压差项来修正面速度：\n$$\nu_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} (p_{i+1,j} - p_{i,j}), \\quad\nu_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i-1,j}),\n$$\n$$\nv_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} (p_{i,j+1} - p_{i,j}), \\quad\nv_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i,j-1}).\n$$\n这里我们为简化起见设置 $a_f = a_m$。得到的离散散度为\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\left[ \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y} \\right].\n$$\n由于 $\\Delta x = \\Delta y = 1$ 且 $u_{i,j} = U_0, v_{i,j} = 0$，均匀部分相互抵消，只留下压力的贡献：\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[(p_{i+1,j} - p_{i,j}) - (p_{i,j} - p_{i-1,j}) + (p_{i,j+1} - p_{i,j}) - (p_{i,j} - p_{i,j-1})\\right].\n$$\n整理后，\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ p_{i+1,j} - 2 p_{i,j} + p_{i-1,j} + p_{i,j+1} - 2 p_{i,j} + p_{i,j-1} \\right].\n$$\n这是 $p$ 的离散 5 点拉普拉斯算子乘以 $-1/a_f$。对于棋盘格模式 $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$，相邻值的振荡部分符号相反。\n$$\np_{i+1,j} - p_{i,j} = (p_0 + \\varepsilon(-1)^{i+1+j}) - (p_0 + \\varepsilon(-1)^{i+j}) = \\varepsilon(-1)^{i+j}(-1-1) = -2\\varepsilon(-1)^{i+j}\n$$\n所以，\n$$\np_{i+1,j} - 2p_{i,j} + p_{i-1,j} = (p_{i+1,j} - p_{i,j}) + (p_{i-1,j} - p_{i,j}) = -2\\varepsilon(-1)^{i+j} -2\\varepsilon(-1)^{i+j} = -4\\varepsilon(-1)^{i+j}\n$$\n同理，$p_{i,j+1} - 2p_{i,j} + p_{i,j-1} = -4\\varepsilon(-1)^{i+j}$。因此\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ (-4\\varepsilon(-1)^{i+j}) + (-4\\varepsilon(-1)^{i+j}) \\right] = \\frac{8 \\varepsilon}{a_f} (-1)^{i+j}.\n$$\n设 $a_f = a_m$，则\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{8 \\varepsilon}{a_m} (-1)^{i+j}.\n$$\n全局 $L^2$ 范数为\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}} = \\left( \\sum_{i,j} \\left[ \\frac{8 \\varepsilon}{a_m} \\right]^2 \\right)^{1/2} = \\left( N_x N_y \\left( \\frac{8 \\varepsilon}{a_m} \\right)^2 \\right)^{1/2} = \\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}.\n$$\n这个非零范数定量地描述了 Rhie–Chow 插值将棋盘格压力振荡转换成面通量校正项的能力，这些校正项在离散连续性方程中不会消失，从而抑制了虚假模式。\n\n算法设计：\n- 为中心差分和面插值实现周期性索引。\n- 使用中心差分计算 $\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}$ 和 $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}$。\n- 使用 $a_m$ 更新 $u_{i,j}$ 和 $v_{i,j}$。\n- 计算朴素面速度和散度；计算 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$。\n- 计算 Rhie–Chow 面速度和散度；计算 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$。\n- 对于给定的测试套件 $(N_x,N_y,U_0,a_m,\\varepsilon)$，记录浮点数对 $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$。\n- 预期的定性结果是，对于所有情况，$\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}} \\approx 0$（达到机器精度），而 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$ 则按 $\\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}$ 比例缩放。\n\n该演示使用基本定律和标准的中心差分离散化方法，揭示了同位网格的解耦机制，并展示了 Rhie–Chow 插值如何恢复面上的压力和质量通量之间的耦合，从而消除了棋盘格零空间。",
            "answer": "```python\nimport numpy as np\n\ndef periodic_index(i, n):\n    # Return periodic index\n    return i % n\n\ndef compute_gradients(p):\n    nx, ny = p.shape\n    dpdx = np.zeros_like(p)\n    dpdy = np.zeros_like(p)\n    # Central differences with periodic wrap, dx = dy = 1\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            dpdx[i, j] = 0.5 * (p[ip, j] - p[im, j])\n            dpdy[i, j] = 0.5 * (p[i, jp] - p[i, jm])\n    return dpdx, dpdy\n\ndef interpolate_faces_naive(u, v):\n    nx, ny = u.shape\n    # Face velocities at cell i,j: east, west, north, south\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef interpolate_faces_rc(u, v, p, a_f):\n    nx, ny = u.shape\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            # dx = dy = 1\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j]) - (1.0 / a_f) * (p[ip, j] - p[i, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j]) - (1.0 / a_f) * (p[i, j] - p[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp]) - (1.0 / a_f) * (p[i, jp] - p[i, j])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm]) - (1.0 / a_f) * (p[i, j] - p[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef divergence_from_faces(u_e, u_w, v_n, v_s):\n    # dx = dy = 1\n    return (u_e - u_w) + (v_n - v_s)\n\ndef l2_norm(field):\n    return np.sqrt(np.sum(field**2))\n\ndef run_case(nx, ny, U0, a_m, eps):\n    # Construct checkerboard pressure with periodic consistency\n    i_idx = np.arange(nx).reshape(nx, 1)\n    j_idx = np.arange(ny).reshape(1, ny)\n    checker = (-1)**(i_idx + j_idx)\n    p0 = 0.0\n    p = p0 + eps * checker\n\n    # Base velocities\n    u_tilde = np.full((nx, ny), U0)\n    v_tilde = np.zeros((nx, ny))\n\n    # Cell-centered gradients\n    dpdx, dpdy = compute_gradients(p)\n\n    # Update cell-centered velocities\n    u = u_tilde - (1.0 / a_m) * dpdx\n    v = v_tilde - (1.0 / a_m) * dpdy\n\n    # Naive face interpolation and divergence\n    u_e, u_w, v_n, v_s = interpolate_faces_naive(u, v)\n    div_naive = divergence_from_faces(u_e, u_w, v_n, v_s)\n    norm_naive = l2_norm(div_naive)\n\n    # Rhie–Chow face interpolation and divergence\n    u_e_rc, u_w_rc, v_n_rc, v_s_rc = interpolate_faces_rc(u, v, p, a_m)\n    div_rc = divergence_from_faces(u_e_rc, u_w_rc, v_n_rc, v_s_rc)\n    norm_rc = l2_norm(div_rc)\n\n    return [float(norm_naive), float(norm_rc)]\n\ndef solve():\n    test_cases = [\n        (4, 4, 1.0, 1.0, 1e-3),\n        (16, 16, 0.5, 1.0, 1e-3),\n        (8, 8, 0.0, 2.0, 1e-6),\n        (6, 10, 3.0, 0.5, 1e-4),\n    ]\n\n    results = []\n    for nx, ny, U0, a_m, eps in test_cases:\n        results.append(run_case(nx, ny, U0, a_m, eps))\n\n    # Print nested list of [norm_naive, norm_rc] for each case\n    # Ensure single-line output format exactly as specified.\n    print(str(results).replace(\" \", \"\"))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "掌握了 Rhie-Chow 插值的基本原理和作用后，是时候将其应用于更实际的计算流体力学（CFD）场景了。这个练习聚焦于一个常见的边界条件处理问题——固定压力出口，要求你推导并计算在该边界上的质量通量 。",
            "id": "3991767",
            "problem": "考虑在计算流体力学 (CFD) 框架下，使用同位变量布置，研究恒定横截面积管道中的一维、定常、不可压缩流动。设与出口面相邻的最后一个内部控制体的单元中心为 $P$，出口边界面为 $f$。出口边界在该面上施加一个固定的压力 $p_f$。面法线指向 $x$ 轴正方向。网格是均匀的，间距为 $\\Delta x$，单元中心 $P$ 到出口面 $f$ 的距离为 $d_{Pf} = \\Delta x/2$。动量方程已求解，并为单元 $P$ 提供了单元中心速度 $u_P$ 及其对角动量系数 $a_P$。单元体积为 $V_P = A \\Delta x$，其中 $A$ 是管道的横截面积。密度 $\\rho$ 是常数。\n\n从单元中心 $P$ 处的离散动量平衡方程出发，其形式为\n$$\nu_P \\;=\\; \\tilde{u}_P \\;-\\; \\left(\\frac{V_P}{a_P}\\right) \\left.\\frac{\\partial p}{\\partial x}\\right|_{P},\n$$\n并使用 Rhie–Chow 插值在出口面 $f$ 处构建一个协调的面法向速度，推导出穿过 $f$ 面的、能避免压力-速度解耦的面法向质量通量 $\\dot{m}_f$ 的表达式。在您的推导中，对边界面上的压力梯度使用单边有限差分格式，即\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{f} \\;\\approx\\; \\frac{p_f - p_P}{d_{Pf}},\n$$\n并明确展示当面压力 $p_f$ 被指定（狄利克雷条件）时，Rhie–Chow 插值中的压力贡献项是如何简化的。然后，使用以下数据计算 $\\dot{m}_f$ 的数值：\n- $\\rho = 1.225 \\,\\text{kg m}^{-3}$,\n- $A = 0.015 \\,\\text{m}^2$,\n- $\\Delta x = 0.1 \\,\\text{m}$,\n- $a_P = 30 \\,\\text{kg s}^{-1}$,\n- $u_P = 8.0 \\,\\text{m s}^{-1}$,\n- $p_P = 102000 \\,\\text{Pa}$,\n- $p_f = 101000 \\,\\text{Pa}$.\n\n将质量通量 $\\dot{m}_f$ 的最终答案以 $\\text{kg s}^{-1}$ 为单位表示，并四舍五入到四位有效数字。",
            "solution": "该问题要求使用 Rhie-Chow 插值，针对同位网格布置，推导出出口面 $f$ 处的质量通量 $\\dot{m}_f$，然后计算其数值。流动是一维、定常、不可压缩的。\n\n首先，我们从 Rhie-Chow 插值的基本原理开始。该方法通过添加一个压力耗散项来构建一个防止压力-速度解耦的面法向速度。面速度不是通过直接插值单元中心速度来构建的，而是通过将动量方程的各项插值到面上来构建的。\n\n从 Rhie-Chow 插值推导出的面 $f$ 上的面速度 $u_f$ 的标准表达式为：\n$$\nu_f = \\overline{u}_f + \\overline{\\left(\\frac{V}{a}\\right)}_f \\left[ \\overline{\\left(\\frac{\\partial p}{\\partial x}\\right)}_f - \\left(\\frac{\\partial p}{\\partial x}\\right)_f \\right]\n$$\n其中上划线表示插值到面 $f$ 上的值，没有上划线的项则直接在面上求值。\n\n在此特定问题中，面 $f$ 是一个仅与以 $P$ 为中心的内部控制体相邻的出口边界面。因此，任何从内部到面 $f$ 的插值都是从单元 $P$ 的外插。这意味着：\n1.  插值速度为 $\\overline{u}_f = u_P$。\n2.  插值动量系数为 $\\overline{\\left(\\frac{V}{a}\\right)}_f = \\frac{V_P}{a_P}$。\n3.  插值的单元中心压力梯度为 $\\overline{\\left(\\frac{\\partial p}{\\partial x}\\right)}_f = \\left(\\frac{\\partial p}{\\partial x}\\right)_P$。\n\n将这些代入通用的 Rhie-Chow 公式，得到边界面 $f$ 上的速度表达式：\n$$\nu_f = u_P + \\left(\\frac{V_P}{a_P}\\right) \\left[ \\left(\\frac{\\partial p}{\\partial x}\\right)_P - \\left(\\frac{\\partial p}{\\partial x}\\right)_f \\right]\n$$\n\n问题为面 $f$ 上的压力梯度提供了一个单边有限差分近似，使用了已知的边界压力 $p_f$ 和相邻的单元中心压力 $p_P$：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_f \\approx \\frac{p_f - p_P}{d_{Pf}}\n$$\n\n项 $\\left(\\frac{\\partial p}{\\partial x}\\right)_P$ 表示在求解离散动量方程以获得 $u_P$ 时使用的单元中心 $P$ 处的压力梯度。问题陈述明确要求展示对于给定的压力边界，Rhie-Chow 插值如何简化。这种简化源于对边界相邻单元处压力梯度的处理。对于具有固定压力的出口，在动量预测步（该步骤产生 $u_P$）中应用的一个常见数值边界条件是假设压力为零梯度，即 $\\frac{\\partial p}{\\partial x} = 0$。在最后一个内部单元中心 $P$ 应用此条件意味着我们设定：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_P = 0\n$$\n这个假设是关键的简化。它将 $u_P$ 的动量预测与边界压力解耦，然后 Rhie–Chow 插值为连续性方程（或压力修正方程）重新建立了正确的压力-速度耦合。\n\n将此假设和给定的面压力梯度代入 $u_f$ 的表达式中：\n$$\nu_f = u_P + \\left(\\frac{V_P}{a_P}\\right) \\left[ 0 - \\left(\\frac{p_f - p_P}{d_{Pf}}\\right) \\right]\n$$\n$$\nu_f = u_P - \\left(\\frac{V_P}{a_P}\\right) \\left(\\frac{p_f - p_P}{d_{Pf}}\\right)\n$$\n这就是推导出的面速度表达式。穿过面 $f$ 的质量通量由 $\\dot{m}_f = \\rho A u_f$ 给出，其中 $\\rho$ 是密度， $A$ 是横截面积。\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\left(\\frac{V_P}{a_P}\\right) \\left(\\frac{p_f - p_P}{d_{Pf}}\\right) \\right]\n$$\n给定单元体积 $V_P = A \\Delta x$ 和距离 $d_{Pf} = \\frac{\\Delta x}{2}$。将这些代入 $\\dot{m}_f$ 的表达式：\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\left(\\frac{A \\Delta x}{a_P}\\right) \\left(\\frac{p_f - p_P}{\\frac{\\Delta x}{2}}\\right) \\right]\n$$\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\frac{2 A \\Delta x}{a_P \\Delta x} (p_f - p_P) \\right]\n$$\n网格间距 $\\Delta x$ 被消去，得到质量通量的最终符号表达式：\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\frac{2 A}{a_P} (p_f - p_P) \\right]\n$$\n现在，我们可以代入给定的数值：\n- $\\rho = 1.225 \\,\\text{kg m}^{-3}$\n- $A = 0.015 \\,\\text{m}^2$\n- $u_P = 8.0 \\,\\text{m s}^{-1}$\n- $a_P = 30 \\,\\text{kg s}^{-1}$\n- $p_f = 101000 \\,\\text{Pa}$\n- $p_P = 102000 \\,\\text{Pa}$\n\n首先，我们计算压差项：\n$$\np_f - p_P = 101000 - 102000 = -1000 \\,\\text{Pa}\n$$\n接下来，我们计算速度的修正项：\n$$\n-\\frac{2 A}{a_P} (p_f - p_P) = -\\frac{2 \\times 0.015}{30} (-1000) = -\\frac{0.03}{30} (-1000) = -0.001 \\times (-1000) = 1.0 \\,\\text{m s}^{-1}\n$$\n修正后的面速度 $u_f$ 为：\n$$\nu_f = u_P + 1.0 = 8.0 + 1.0 = 9.0 \\,\\text{m s}^{-1}\n$$\n最后，我们计算质量通量 $\\dot{m}_f$：\n$$\n\\dot{m}_f = \\rho A u_f = 1.225 \\times 0.015 \\times 9.0\n$$\n$$\n\\dot{m}_f = 0.018375 \\times 9.0 = 0.165375 \\,\\text{kg s}^{-1}\n$$\n将结果四舍五入到四位有效数字，得到：\n$$\n\\dot{m}_f \\approx 0.1654 \\,\\text{kg s}^{-1}\n$$",
            "answer": "$$\n\\boxed{0.1654}\n$$"
        }
    ]
}