{
    "hands_on_practices": [
        {
            "introduction": "This first exercise delves into the fundamental properties of the first-order upwind scheme, a cornerstone of robust numerical methods for convection. We will use Taylor series analysis to derive the \"modified equation,\" which is the partial differential equation that the discrete scheme effectively solves. This practice is invaluable because it reveals a hidden truth: the scheme's stability is not free but is achieved by introducing an artificial diffusion term, a phenomenon known as numerical viscosity .",
            "id": "3952213",
            "problem": "Consider the one-dimensional linear convection equation, a canonical model for convective transport in Aerospace Computational Fluid Dynamics (CFD),\n$$\nu_{t} + a\\,u_{x} = 0,\n$$\nwith constant advection speed $a \\in \\mathbb{R}$ on a uniform grid of spacing $\\Delta x  0$. Construct a semi-discrete first-order upwind discretization in space as follows: for $a0$, approximate $u_{x}$ at node $x_{i}$ by the backward difference $(u_{i}-u_{i-1})/\\Delta x$, and for $a0$, approximate it by the forward difference $(u_{i+1}-u_{i})/\\Delta x$. Assume $u$ is sufficiently smooth so that Taylor expansions are valid.\n\nStarting only from the definitions of Taylor series and the given semi-discrete upwind approximation, derive the leading-order modified partial differential equation that the semi-discrete scheme satisfies, retaining terms through $\\mathcal{O}(\\Delta x)$ beyond the original model. Match terms so that this modified equation is written in the form\n$$\nu_{t} + a\\,u_{x} = \\nu_{\\text{num}}\\,u_{xx} + \\text{higher-order terms},\n$$\nand determine the effective numerical kinematic viscosity $\\nu_{\\text{num}}$ in terms of $a$ and $\\Delta x$. Give your final answer as a closed-form analytic expression for $\\nu_{\\text{num}}$. Do not include units. No rounding is required.",
            "solution": "The problem requires the derivation of the effective numerical kinematic viscosity, $\\nu_{\\text{num}}$, for the first-order upwind semi-discretization of the one-dimensional linear convection equation, $u_{t} + a\\,u_{x} = 0$. The derivation proceeds by analyzing the truncation error of the spatial discretization using Taylor series expansions. This analysis reveals the modified partial differential equation that the numerical scheme actually solves.\n\nThe problem specifies two cases for the upwind scheme based on the sign of the advection speed, $a$. We will analyze each case separately.\n\nCase 1: $a > 0$\nFor this case, the problem states that the spatial derivative $u_x$ at node $x_i$ is approximated by the first-order backward difference. The resulting semi-discrete equation is:\n$$\n\\frac{du_i}{dt} + a \\left( \\frac{u_i - u_{i-1}}{\\Delta x} \\right) = 0\n$$\nTo analyze the truncation error, we interpret this discrete equation in a continuous setting. Let $u(x, t)$ be the exact solution, and let the discrete value $u_i(t)$ represent an approximation to $u(x_i, t)$. The semi-discrete equation at a point $x$ can be written as:\n$$\nu_t + a \\left( \\frac{u(x,t) - u(x-\\Delta x, t)}{\\Delta x} \\right) = 0\n$$\nWe perform a Taylor series expansion of the term $u(x-\\Delta x, t)$ around the point $(x, t)$. Assuming $u$ is sufficiently smooth, the expansion is:\n$$\nu(x-\\Delta x, t) = u(x,t) - \\Delta x \\frac{\\partial u}{\\partial x}(x,t) + \\frac{(\\Delta x)^2}{2!} \\frac{\\partial^2 u}{\\partial x^2}(x,t) - \\frac{(\\Delta x)^3}{3!} \\frac{\\partial^3 u}{\\partial x^3}(x,t) + \\dots\n$$\nFor brevity, we will use subscript notation for partial derivatives (e.g., $u_x = \\frac{\\partial u}{\\partial x}$).\n$$\nu(x-\\Delta x) = u - \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} - \\mathcal{O}((\\Delta x)^3)\n$$\nSubstituting this expansion into the discrete spatial derivative approximation:\n$$\n\\frac{u - u(x-\\Delta x)}{\\Delta x} = \\frac{u - \\left(u - \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} - \\mathcal{O}((\\Delta x)^3)\\right)}{\\Delta x}\n$$\n$$\n= \\frac{\\Delta x\\,u_x - \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)}{\\Delta x}\n$$\n$$\n= u_x - \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2)\n$$\nNow, we substitute this expression back into the semi-discrete equation:\n$$\nu_t + a \\left( u_x - \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2) \\right) = 0\n$$\nRearranging the terms gives:\n$$\nu_t + a\\,u_x = a \\frac{\\Delta x}{2}u_{xx} - a \\mathcal{O}((\\Delta x)^2)\n$$\nThis is the modified partial differential equation. Comparing this to the target form $u_t + a\\,u_x = \\nu_{\\text{num}}\\,u_{xx} + \\text{higher-order terms}$, we identify the numerical viscosity for $a0$ as:\n$$\n\\nu_{\\text{num}} = a \\frac{\\Delta x}{2}\n$$\n\nCase 2: $a  0$\nFor this case, the spatial derivative $u_x$ is approximated by the first-order forward difference. The semi-discrete equation is:\n$$\n\\frac{du_i}{dt} + a \\left( \\frac{u_{i+1} - u_i}{\\Delta x} \\right) = 0\n$$\nIn a continuous setting, this is:\n$$\nu_t + a \\left( \\frac{u(x+\\Delta x, t) - u(x, t)}{\\Delta x} \\right) = 0\n$$\nWe perform a Taylor series expansion of $u(x+\\Delta x, t)$ around $(x, t)$:\n$$\nu(x+\\Delta x, t) = u(x,t) + \\Delta x \\frac{\\partial u}{\\partial x}(x,t) + \\frac{(\\Delta x)^2}{2!} \\frac{\\partial^2 u}{\\partial x^2}(x,t) + \\frac{(\\Delta x)^3}{3!} \\frac{\\partial^3 u}{\\partial x^3}(x,t) + \\dots\n$$\nUsing subscript notation:\n$$\nu(x+\\Delta x) = u + \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)\n$$\nSubstituting this into the discrete spatial derivative approximation:\n$$\n\\frac{u(x+\\Delta x) - u}{\\Delta x} = \\frac{\\left(u + \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)\\right) - u}{\\Delta x}\n$$\n$$\n= \\frac{\\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)}{\\Delta x}\n$$\n$$\n= u_x + \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2)\n$$\nSubstituting this back into the semi-discrete equation:\n$$\nu_t + a \\left( u_x + \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2) \\right) = 0\n$$\nRearranging the terms:\n$$\nu_t + a\\,u_x = -a \\frac{\\Delta x}{2}u_{xx} - a \\mathcal{O}((\\Delta x)^2)\n$$\nComparing this to the target form $u_t + a\\,u_x = \\nu_{\\text{num}}\\,u_{xx} + \\text{higher-order terms}$, we identify the numerical viscosity for $a0$ as:\n$$\n\\nu_{\\text{num}} = -a \\frac{\\Delta x}{2}\n$$\n\nSummary and Final Expression\nWe have found the expressions for $\\nu_{\\text{num}}$ for both positive and negative $a$:\n- If $a  0$, then $\\nu_{\\text{num}} = a \\frac{\\Delta x}{2}$. Since $a  0$, this is equal to $|a| \\frac{\\Delta x}{2}$.\n- If $a  0$, then $\\nu_{\\text{num}} = -a \\frac{\\Delta x}{2}$. Since $a  0$, $-a$ is positive and equal to $|a|$. Thus, this is also equal to $|a| \\frac{\\Delta x}{2}$.\n\nBoth cases can be expressed by a single, unified formula using the absolute value of $a$. The leading-order error term in the upwind scheme acts as a diffusion term, with an effective numerical kinematic viscosity given by:\n$$\n\\nu_{\\text{num}} = \\frac{|a| \\Delta x}{2}\n$$\nThis term is always non-negative, signifying that the first-order upwind scheme introduces artificial dissipation or diffusion into the numerical solution, regardless of the sign of the advection speed $a$. This is a characteristic feature of the scheme.",
            "answer": "$$\\boxed{\\frac{|a|\\Delta x}{2}}$$"
        },
        {
            "introduction": "Beyond accuracy and stability, a critical property of any numerical scheme for a conservation law is its ability to conserve the transported quantity. This exercise explores the profound difference between discretizing the conservative form of the advection equation versus its non-conservative counterpart, especially when the advection velocity is not constant. By comparing a conservative flux-differencing scheme with a non-conservative central-differencing approach, you will analytically demonstrate how the latter can lead to an unphysical loss or gain of mass, highlighting the necessity of building schemes on a discrete conservation principle .",
            "id": "3952240",
            "problem": "Consider one-dimensional passive scalar transport on the periodic interval $[0, 2\\pi]$, with a spatially varying advecting velocity field. The physically conservative governing equation is the scalar advection in conservation form\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(a(x)\\,u(x,t)\\right) = 0,\n$$\nwhere $u(x,t)$ is a dimensionless scalar and $a(x)$ is a prescribed, dimensionless, strictly positive velocity field. Let $a(x)$ be given by $a(x) = 1 + \\beta \\cos(x)$ with $0  \\beta  1$ so that $a(x)  0$ for all $x \\in [0, 2\\pi]$.\n\nDefine a uniform grid with $N$ even, $N \\ge 4$, node locations $x_i = i \\,\\Delta x$ for $i = 0, 1, \\dots, N-1$, and grid spacing $\\Delta x = \\frac{2\\pi}{N}$. Let $u_i(t)$ denote a nodal approximation to $u(x_i,t)$. Consider two semi-discrete convective differencing schemes:\n\n- A conservative flux-differencing scheme constructed from the conservation law, using a first-order upwind flux for positive velocity,\n$$\n\\frac{d u_i}{d t} = -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x}, \\quad F_{i+\\frac{1}{2}} = a\\!\\left(x_{i+\\frac{1}{2}}\\right)\\,u_i,\n$$\nwhere $x_{i+\\frac{1}{2}} = x_i + \\frac{\\Delta x}{2}$.\n\n- A nonconservative central-differencing scheme applied to the nonconservative operator $a(x)\\,\\frac{\\partial u}{\\partial x}$,\n$$\n\\frac{d u_i}{d t} = - a(x_i)\\,\\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\n\nLet the initial condition be $u_i(0) = \\sin(x_i)$. Define the discrete approximation to the spatial integral of $u$ as $M(t) = \\Delta x \\sum_{i=0}^{N-1} u_i(t)$.\n\nStarting from the conservation form of the governing equation and the definitions above, analytically demonstrate which of the two schemes preserves $M(t)$ for periodic boundary conditions and which does not. Then, for the nonconservative central-differencing scheme, derive a closed-form analytic expression for the initial drift rate $\\frac{d M}{d t}\\big|_{t=0}$ as a function of $\\beta$ and $N$.\n\nYour final answer must be the single, simplified analytic expression for $\\frac{d M}{d t}\\big|_{t=0}$ under the nonconservative central-differencing scheme. No numerical approximation or rounding is required, and no physical units should be included in the final answer.",
            "solution": "The problem requires an analysis of two numerical schemes for the one-dimensional scalar advection equation in conservation form, $\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(a(x)\\,u(x,t)\\right) = 0$, on a periodic domain. We must determine which scheme conserves the total scalar mass and derive the initial rate of change of this mass for the non-conservative scheme.\n\nThe discrete approximation to the total scalar mass is defined as $M(t) = \\Delta x \\sum_{i=0}^{N-1} u_i(t)$. Its time derivative is given by\n$$\n\\frac{d M}{d t} = \\frac{d}{dt} \\left( \\Delta x \\sum_{i=0}^{N-1} u_i(t) \\right) = \\Delta x \\sum_{i=0}^{N-1} \\frac{d u_i}{d t}.\n$$\nA scheme is conservative if $\\frac{d M}{d t} = 0$. We will now analyze each scheme.\n\nFirst, consider the conservative flux-differencing upwind scheme. The semi-discrete equation for a node $i$ is\n$$\n\\frac{d u_i}{d t} = -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x},\n$$\nwhere $F_{i+\\frac{1}{2}}$ is the numerical flux at the interface between nodes $i$ and $i+1$. Substituting this into the expression for $\\frac{d M}{d t}$:\n$$\n\\frac{d M}{d t} = \\Delta x \\sum_{i=0}^{N-1} \\left( -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x} \\right) = - \\sum_{i=0}^{N-1} (F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}).\n$$\nThis sum is a telescoping series. Expanding the sum for $i = 0, 1, \\dots, N-1$:\n$$\n\\sum_{i=0}^{N-1} (F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}) = (F_{\\frac{1}{2}} - F_{-\\frac{1}{2}}) + (F_{\\frac{3}{2}} - F_{\\frac{1}{2}}) + \\dots + (F_{N-\\frac{1}{2}} - F_{N-\\frac{3}{2}}).\n$$\nDue to cancellations, the sum simplifies to $F_{N-\\frac{1}{2}} - F_{-\\frac{1}{2}}$. The problem specifies periodic boundary conditions. This implies that the grid wraps around, so that the interface to the left of node $0$ is the same as the interface to the right of node $N-1$. Mathematically, this means the flux is periodic, i.e., $F_{j+\\frac{1}{2}} = F_{j+N+\\frac{1}{2}}$ for any integer $j$. Therefore, $F_{-\\frac{1}{2}} = F_{N-\\frac{1}{2}}$. The sum is thus\n$$\nF_{N-\\frac{1}{2}} - F_{N-\\frac{1}{2}} = 0.\n$$\nHence, for the conservative upwind scheme, $\\frac{d M}{d t} = 0$. This scheme preserves the total scalar quantity $M(t)$, as expected from any scheme written in a discrete conservation-law (or flux-differencing) form.\n\nNext, consider the nonconservative central-differencing scheme. The semi-discrete equation is\n$$\n\\frac{d u_i}{d t} = - a(x_i)\\,\\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\nSubstituting this into the expression for $\\frac{d M}{d t}$:\n$$\n\\frac{d M}{d t} = \\Delta x \\sum_{i=0}^{N-1} \\left( - a(x_i)\\,\\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x} \\right) = -\\frac{1}{2} \\sum_{i=0}^{N-1} a_i(u_{i+1} - u_{i-1}),\n$$\nwhere we use the shorthand $a_i = a(x_i)$. We can split the sum and perform a change of index (a discrete summation by parts):\n$$\n\\sum_{i=0}^{N-1} a_i(u_{i+1} - u_{i-1}) = \\sum_{i=0}^{N-1} a_i u_{i+1} - \\sum_{i=0}^{N-1} a_i u_{i-1}.\n$$\nUsing periodicity for the indices (i.e., $u_N=u_0$, $u_{-1}=u_{N-1}$, $a_N=a_0$, $a_{-1}=a_{N-1}$), we re-index the sums so that both have a factor of $u_i$:\n$$\n\\sum_{i=0}^{N-1} a_i u_{i+1} = \\sum_{j=1}^{N} a_{j-1} u_j = \\sum_{j=0}^{N-1} a_{j-1} u_j.\n$$\n$$\n\\sum_{i=0}^{N-1} a_i u_{i-1} = \\sum_{k=-1}^{N-2} a_{k+1} u_k = \\sum_{k=0}^{N-1} a_{k+1} u_k.\n$$\nCombining these results,\n$$\n\\frac{d M}{d t} = -\\frac{1}{2} \\left( \\sum_{i=0}^{N-1} a_{i-1} u_i - \\sum_{i=0}^{N-1} a_{i+1} u_i \\right) = \\frac{1}{2} \\sum_{i=0}^{N-1} (a_{i+1} - a_{i-1}) u_i.\n$$\nFor this scheme to be conservative, $\\frac{d M}{d t}$ must be zero for any choice of $u_i(t)$. This would require $a_{i+1} - a_{i-1} = 0$ for all $i$, which implies $a(x)$ must be a constant. Since $a(x) = 1 + \\beta \\cos(x)$ with $\\beta  0$, the velocity field is not constant. Therefore, this central-differencing scheme is non-conservative and does not preserve $M(t)$.\n\nNow, we derive the expression for the initial drift rate $\\frac{d M}{d t}\\big|_{t=0}$ for this nonconservative scheme. The initial condition is $u_i(0) = \\sin(x_i)$.\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = \\frac{1}{2} \\sum_{i=0}^{N-1} (a_{i+1} - a_{i-1}) u_i(0) = \\frac{1}{2} \\sum_{i=0}^{N-1} (a(x_{i+1}) - a(x_{i-1})) \\sin(x_i).\n$$\nWith $a(x) = 1 + \\beta \\cos(x)$, the difference term is\n$$\na(x_{i+1}) - a(x_{i-1}) = (1 + \\beta \\cos(x_{i+1})) - (1 + \\beta \\cos(x_{i-1})) = \\beta (\\cos(x_{i+1}) - \\cos(x_{i-1})).\n$$\nUsing the trigonometric identity $\\cos(A) - \\cos(B) = -2 \\sin\\left(\\frac{A+B}{2}\\right) \\sin\\left(\\frac{A-B}{2}\\right)$, with $A=x_{i+1}=(i+1)\\Delta x$ and $B=x_{i-1}=(i-1)\\Delta x$:\n$$\n\\cos(x_{i+1}) - \\cos(x_{i-1}) = -2 \\sin\\left(\\frac{(i+1)\\Delta x + (i-1)\\Delta x}{2}\\right) \\sin\\left(\\frac{(i+1)\\Delta x - (i-1)\\Delta x}{2}\\right) = -2\\sin(i\\Delta x)\\sin(\\Delta x).\n$$\nSo, $a_{i+1} - a_{i-1} = -2\\beta\\sin(x_i)\\sin(\\Delta x)$.\nSubstituting this into the expression for the drift rate:\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = \\frac{1}{2} \\sum_{i=0}^{N-1} \\left( -2\\beta\\sin(x_i)\\sin(\\Delta x) \\right) \\sin(x_i) = -\\beta\\sin(\\Delta x) \\sum_{i=0}^{N-1} \\sin^2(x_i).\n$$\nWe must now evaluate the summation $\\sum_{i=0}^{N-1} \\sin^2(x_i)$. Using the identity $\\sin^2(\\theta) = \\frac{1 - \\cos(2\\theta)}{2}$:\n$$\n\\sum_{i=0}^{N-1} \\sin^2(x_i) = \\sum_{i=0}^{N-1} \\frac{1 - \\cos(2x_i)}{2} = \\frac{1}{2} \\sum_{i=0}^{N-1} 1 - \\frac{1}{2} \\sum_{i=0}^{N-1} \\cos(2x_i).\n$$\nThe first part of the sum is $\\frac{1}{2} \\sum_{i=0}^{N-1} 1 = \\frac{N}{2}$. The second part is a sum of cosines over a uniform discrete grid spanning the full period. With $x_i = i\\frac{2\\pi}{N}$, the sum is\n$$\n\\sum_{i=0}^{N-1} \\cos(2x_i) = \\sum_{i=0}^{N-1} \\cos\\left(i \\frac{4\\pi}{N}\\right).\n$$\nThis sum is the real part of a geometric series: $\\text{Re}\\left(\\sum_{i=0}^{N-1} (e^{j \\frac{4\\pi}{N}})^i\\right)$. The common ratio is $r = e^{j \\frac{4\\pi}{N}}$. Since $N \\ge 4$, $r \\neq 1$. The sum of the geometric series is $\\frac{1-r^N}{1-r}$. The numerator is $1 - (e^{j \\frac{4\\pi}{N}})^N = 1 - e^{j 4\\pi} = 1 - 1 = 0$. Thus, the sum is zero.\nTherefore,\n$$\n\\sum_{i=0}^{N-1} \\sin^2(x_i) = \\frac{N}{2} - 0 = \\frac{N}{2}.\n$$\nSubstituting this result back into the expression for the initial drift rate:\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = -\\beta\\sin(\\Delta x) \\left(\\frac{N}{2}\\right).\n$$\nFinally, substituting $\\Delta x = \\frac{2\\pi}{N}$, we obtain the closed-form expression:\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = -\\frac{N\\beta}{2} \\sin\\left(\\frac{2\\pi}{N}\\right).\n$$\nThis is the final analytical expression for the initial rate of change of the total scalar mass for the nonconservative scheme.",
            "answer": "$$\n\\boxed{-\\frac{N\\beta}{2}\\sin\\left(\\frac{2\\pi}{N}\\right)}\n$$"
        },
        {
            "introduction": "Theory comes to life through implementation. This practice transitions from analytical derivations to computational verification by tasking you with building and testing both a first-order upwind scheme and a higher-order MUSCL scheme for linear advection. By conducting a grid refinement study and measuring the convergence of the $L_2$ error norm against an exact solution, you will empirically validate the theoretical order of accuracy for each method. This exercise provides tangible insight into the practical benefits of high-order schemes and reinforces the standard validation practices used in CFD code development .",
            "id": "3952188",
            "problem": "Consider the one-dimensional, constant-coefficient linear advection equation on a periodic domain, expressed as $$\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,$$ where $u(x,t)$ is a scalar conserved quantity, $a$ is a constant advection speed, and the spatial domain is $$x \\in [0,L]$$ with periodic boundary conditions. The initial condition is a smooth Gaussian pulse centered at $$x_0$$ with standard deviation $$\\sigma,$$ given by $$u(x,0) = \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right).$$ The analytical solution for sufficiently small advection times that avoid crossing the periodic boundary (so that periodic wrapping is not invoked) is the shifted Gaussian $$u(x,t) = \\exp\\left(-\\frac{(x - (x_0 + a t))^2}{2\\sigma^2}\\right).$$\n\nStarting from the integral conservation form of the equation over a control volume, $$\\frac{d}{dt}\\bar{u}_i(t) = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}}(t) - F_{i-\\frac{1}{2}}(t)\\right),$$ where $$\\bar{u}_i$$ is the cell average over cell $$i$$ and $$F_{i+\\frac{1}{2}}$$ is the numerical convective flux at the interface between cells $$i$$ and $$i+1,$$ derive and implement two spatial differencing schemes for the convective flux:\n- A first-order upwind scheme that uses piecewise-constant reconstruction, appropriate for hyperbolic advection with direction determined by the sign of $$a$$.\n- A second-order Monotone Upstream-centered Schemes for Conservation Laws (MUSCL) reconstruction without Total Variation Diminishing (TVD) clipping and without limiters, using centered slopes to reconstruct left and right interface states. For $a0,$ use the left state, and for $a0,$ use the right state at each interface.\n\nUse the Method of Lines with Strong Stability Preserving (SSP) second-order Runge–Kutta time integration to advance the solution to a specified final time $$T$$. The time step $$\\Delta t$$ must satisfy a Courant–Friedrichs–Lewy (CFL) stability constraint $$\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{|a|}.$$ Compute the discrete $$L_2$$ error norm between the numerical cell averages and the exact cell-average solution at time $$T$$, where the exact cell average over a cell of width $$\\Delta x$$ centered at $$x_c$$ is given by the integral\n$$\\bar{u}_{\\text{exact}} = \\frac{1}{\\Delta x} \\int_{x_c - \\frac{\\Delta x}{2}}^{x_c + \\frac{\\Delta x}{2}} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)\\,dx,$$\nwith $$\\mu = x_0 + a T.$$ This integral must be evaluated exactly using the error function $$\\operatorname{erf}(\\cdot).$$ Define the discrete $$L_2$$ error norm as\n$$\\|e\\|_2 = \\left(\\Delta x \\sum_{i=1}^{N} \\left(\\bar{u}_i - \\bar{u}_{\\text{exact},i}\\right)^2\\right)^{1/2}.$$\n\nFor each scheme, compute the empirical order of accuracy by performing a grid refinement study over a set of cell counts $$N$$, measuring errors $$E(N)$$, and fitting a line to $$\\log(E)$$ versus $$\\log(\\Delta x)$$ to estimate the convergence rate. The expected result is that the first-order upwind scheme exhibits approximately first-order convergence, while the unlimited MUSCL scheme exhibits approximately second-order convergence, given the smooth initial condition and the absence of limiter-induced clipping.\n\nThe program must implement the following specifics:\n- Domain length $$L = 1,$$ center $$x_0 = 0.5,$$ standard deviation $$\\sigma = 0.05,$$ advection speeds $$a \\in \\{1.0, -1.0\\}$$, final time $$T = 0.2,$$ and Courant number $$\\text{CFL} = 0.4.$$\n- Finite volume cell averages as the primary discrete unknowns.\n- Periodic boundary conditions through index wrapping.\n- SSP second-order Runge–Kutta time stepping.\n- Exact cell-average integration using the error function to compute the analytical reference solution.\n\nYour program must run three test cases, each computing a single floating-point convergence rate:\n1. MUSCL without limiters for $$a=1.0$$ with grid sizes $$N \\in \\{50,100,200,400\\}.$$\n2. First-order upwind for $$a=1.0$$ with grid sizes $$N \\in \\{50,100,200,400\\}.$$\n3. MUSCL without limiters for $$a=-1.0$$ with grid sizes $$N \\in \\{64,128,256,512\\}.$$\n\nAll quantities are nondimensional, so no physical unit conversion is required. Your program should produce a single line of output containing the three convergence rates as a comma-separated list enclosed in square brackets (for example, $$[r_1,r_2,r_3]$$), where each $$r_k$$ is a floating-point number.",
            "solution": "The problem presented is a well-posed and standard numerical analysis task in computational fluid dynamics. It requires the implementation and verification of two common spatial discretization schemes for the linear advection equation. All parameters and conditions are provided, and the problem is scientifically sound. We may therefore proceed with a complete solution.\n\nThe governing equation is the one-dimensional linear advection equation:\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\nwhere $u(x,t)$ is a scalar quantity, $a$ is the constant advection speed, and the spatial domain is $x \\in [0,L]$ with periodic boundary conditions.\n\nWe employ the finite volume method. Integrating the governing equation over a control volume (cell) $i$, from $x_{i-1/2}$ to $x_{i+1/2}$ with width $\\Delta x = x_{i+1/2} - x_{i-1/2}$, yields the integral form of the conservation law:\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\, dx = - [a u(x_{i+1/2}, t) - a u(x_{i-1/2}, t)]\n$$\nDefining the cell average as $\\bar{u}_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\, dx$ and the flux as $F(u) = au$, we obtain the semi-discrete ordinary differential equation (ODE) for each cell average:\n$$\n\\frac{d\\bar{u}_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i \\pm 1/2}$ represents the numerical flux at the cell interfaces. The core of the task is to define this numerical flux based on different spatial reconstruction schemes.\n\n**1. Spatial Discretization Schemes**\n\n**a) First-Order Upwind Scheme**\nThis scheme is based on a piecewise-constant reconstruction of the data within each cell, i.e., $u(x) = \\bar{u}_i$ for $x \\in [x_{i-1/2}, x_{i+1/2}]$. At any given interface, say $x_{i+1/2}$, this reconstruction leads to a discontinuity between the value $\\bar{u}_i$ from the left and $\\bar{u}_{i+1}$ from the right. The upwind principle resolves this by selecting the value from the cell \"upwind\" of the interface, determined by the sign of the advection speed $a$.\n\n- If $a  0$, the flow is from left to right. The state at the interface $x_{i+1/2}$ is determined by the cell to its left, cell $i$. Thus, the flux is $F_{i+1/2} = a \\bar{u}_i$.\n- If $a  0$, the flow is from right to left. The state at the interface $x_{i+1/2}$ is determined by the cell to its right, cell $i+1$. Thus, the flux is $F_{i+1/2} = a \\bar{u}_{i+1}$.\n\nThese two cases can be combined into a single expression using the absolute value of $a$:\n$$\nF_{i+1/2} = \\frac{a}{2}(\\bar{u}_i + \\bar{u}_{i+1}) - \\frac{|a|}{2}(\\bar{u}_{i+1} - \\bar{u}_i)\n$$\nThis scheme is known to be first-order accurate in space and is highly dissipative, which tends to smear sharp features in the solution.\n\n**b) Second-Order MUSCL Scheme without Limiters**\nThe Monotone Upstream-centered Schemes for Conservation Laws (MUSCL) approach achieves higher-order accuracy by using a piecewise-linear reconstruction within each cell:\n$$\nu(x) = \\bar{u}_i + s_i (x - x_i), \\quad \\text{for } x \\in [x_{i-1/2}, x_{i+1/2}]\n$$\nwhere $s_i$ is the slope of the solution in cell $i$, and $x_i$ is the cell center. The problem specifies using a centered difference to approximate this slope from the cell averages:\n$$\ns_i = \\frac{\\bar{u}_{i+1} - \\bar{u}_{i-1}}{x_{i+1} - x_{i-1}} = \\frac{\\bar{u}_{i+1} - \\bar{u}_{i-1}}{2\\Delta x}\n$$\nWith this linear reconstruction, we can evaluate the solution at the left and right sides of the interface $x_{i+1/2}$:\n- Left state (from cell $i$): $u_{i+1/2}^L = \\bar{u}_i + s_i(x_{i+1/2} - x_i) = \\bar{u}_i + s_i \\frac{\\Delta x}{2} = \\bar{u}_i + \\frac{\\bar{u}_{i+1} - \\bar{u}_{i-1}}{4}$\n- Right state (from cell $i+1$): $u_{i+1/2}^R = \\bar{u}_{i+1} + s_{i+1}(x_{i+1/2} - x_{i+1}) = \\bar{u}_{i+1} - s_{i+1} \\frac{\\Delta x}{2} = \\bar{u}_{i+1} - \\frac{\\bar{u}_{i+2} - \\bar{u}_i}{4}$\n\nFollowing the upwind principle for the reconstructed states, the flux $F_{i+1/2} = a u_{i+1/2}$ is calculated as:\n- If $a  0$, we use the left state: $F_{i+1/2} = a u_{i+1/2}^L$.\n- If $a  0$, we use the right state: $F_{i+1/2} = a u_{i+1/2}^R$.\n\nSince no limiters are applied, this scheme achieves second-order accuracy for smooth solutions but can introduce oscillations (undershoots and overshoots) near sharp gradients or discontinuities.\n\n**2. Temporal Discretization: SSP-RK2**\n\nWe use the Method of Lines to solve the system of ODEs $\\frac{d\\vec{\\bar{u}}}{dt} = \\mathcal{L}(\\vec{\\bar{u}})$, where $\\mathcal{L}(\\vec{\\bar{u}})_i = -\\frac{1}{\\Delta x}(F_{i+1/2} - F_{i-1/2})$. The problem specifies the Strong Stability Preserving (SSP) second-order Runge-Kutta method (also known as Heun's method or the explicit trapezoidal rule). Given the solution $\\vec{\\bar{u}}^n$ at time $t_n$, the solution at $t_{n+1} = t_n + \\Delta t$ is computed in two stages:\n$$\n\\vec{\\bar{u}}^{(1)} = \\vec{\\bar{u}}^n + \\Delta t \\mathcal{L}(\\vec{\\bar{u}}^n)\n$$\n$$\n\\vec{\\bar{u}}^{n+1} = \\frac{1}{2} \\vec{\\bar{u}}^n + \\frac{1}{2} \\left( \\vec{\\bar{u}}^{(1)} + \\Delta t \\mathcal{L}(\\vec{\\bar{u}}^{(1)}) \\right)\n$$\nThe time step $\\Delta t$ is constrained by the Courant-Friedrichs-Lewy (CFL) condition for stability: $\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{|a|}$, with the Courant number $\\text{CFL} \\le 1$.\n\n**3. Error Analysis**\n\nTo assess the accuracy, we compare the numerical solution to the exact solution. The initial condition $u(x,0) = \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right)$ evolves into $u(x,T) = \\exp\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right)$ at the final time $T$, with $\\mu = x_0 + aT$.\n\nWe must compare cell averages. The exact cell average over cell $i$ (centered at $x_i$) is found by integrating the exact solution:\n$$\n\\bar{u}_{\\text{exact},i} = \\frac{1}{\\Delta x} \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right) \\, dx\n$$\nThis integral can be evaluated using the error function, $\\operatorname{erf}(z) = \\frac{2}{\\sqrt{\\pi}}\\int_0^z e^{-t^2} dt$. The indefinite integral of a Gaussian is related to $\\operatorname{erf}$, leading to the exact expression:\n$$\n\\bar{u}_{\\text{exact},i} = \\frac{\\sqrt{2\\pi}\\sigma}{2\\Delta x} \\left[ \\operatorname{erf}\\left(\\frac{x_i + \\Delta x/2 - \\mu}{\\sqrt{2}\\sigma}\\right) - \\operatorname{erf}\\left(\\frac{x_i - \\Delta x/2 - \\mu}{\\sqrt{2}\\sigma}\\right) \\right]\n$$\nThe comparison is quantified by the discrete $L_2$ error norm:\n$$\n\\|e\\|_2 = \\left(\\Delta x \\sum_{i=1}^{N} \\left(\\bar{u}_i(T) - \\bar{u}_{\\text{exact},i}\\right)^2\\right)^{1/2}\n$$\nThe empirical order of accuracy $p$ is determined by performing a grid refinement study. For a set of grid sizes $N$ with corresponding grid spacings $\\Delta x = L/N$ and computed errors $E(\\Delta x) = \\|e\\|_2$, we assume the error behaves as $E \\approx C(\\Delta x)^p$. Taking the logarithm gives $\\log(E) \\approx \\log(C) + p \\log(\\Delta x)$. The order $p$ is the slope of the line fitted to the data points $(\\log(\\Delta x), \\log(E))$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import erf\n\ndef exact_cell_avg(x_centers, dx, mu, sigma):\n    \"\"\"\n    Computes the exact cell average of a Gaussian function over cells.\n\n    Args:\n        x_centers (np.ndarray): Array of cell center coordinates.\n        dx (float): Cell width.\n        mu (float): Mean of the Gaussian.\n        sigma (float): Standard deviation of the Gaussian.\n\n    Returns:\n        np.ndarray: Array of exact cell averages.\n    \"\"\"\n    sqrt2_sigma = np.sqrt(2) * sigma\n    arg1 = (x_centers + dx / 2 - mu) / sqrt2_sigma\n    arg2 = (x_centers - dx / 2 - mu) / sqrt2_sigma\n    integral = (np.sqrt(np.pi) * sqrt2_sigma / 2) * (erf(arg1) - erf(arg2))\n    return integral / dx\n\ndef calculate_flux(u, scheme, a, dx):\n    \"\"\"\n    Calculates the numerical flux at cell interfaces i+1/2.\n    \"\"\"\n    if scheme == 'upwind':\n        # Piecewise-constant reconstruction with upwinding\n        if a > 0:\n            # Flux is a * u_i\n            flux = a * u\n        else:\n            # Flux is a * u_{i+1}\n            flux = a * np.roll(u, -1)\n    elif scheme == 'muscl':\n        # Piecewise-linear reconstruction (unlimited)\n        # Stencil for states at interface i+1/2 needs u_{i-1}, u_i, u_{i+1}, u_{i+2}\n        u_im1 = np.roll(u, 1)   # u_{i-1}\n        u_i = u                 # u_i\n        u_ip1 = np.roll(u, -1)  # u_{i+1}\n        u_ip2 = np.roll(u, -2)  # u_{i+2}\n        \n        # Reconstructed states at interface i+1/2\n        # u_L is reconstructed from cell i\n        # u_R is reconstructed from cell i+1\n        u_L = u_i + 0.25 * (u_ip1 - u_im1)\n        u_R = u_ip1 - 0.25 * (u_ip2 - u_i)\n        \n        if a > 0:\n            flux = a * u_L\n        else:\n            flux = a * u_R\n    else:\n        raise ValueError(\"Unknown scheme\")\n    return flux\n\ndef rhs(u, scheme, a, dx):\n    \"\"\"\n    Computes the right-hand side of the semi-discrete ODE system.\n    L(u)_i = -1/dx * (F_{i+1/2} - F_{i-1/2})\n    \"\"\"\n    # flux[i] corresponds to interface i+1/2\n    flux_ip12 = calculate_flux(u, scheme, a, dx)\n    # flux[i-1] corresponds to interface i-1/2\n    flux_im12 = np.roll(flux_ip12, 1)\n    \n    return -(flux_ip12 - flux_im12) / dx\n\n\ndef run_simulation(N, scheme, a, L, x0, sigma, T, CFL):\n    \"\"\"\n    Runs a single finite volume simulation.\n    \"\"\"\n    # Grid setup\n    dx = L / N\n    # Cell centers\n    x_centers = np.linspace(0, L, N, endpoint=False) + dx / 2\n\n    # Initial condition (exact cell averages of Gaussian)\n    u = exact_cell_avg(x_centers, dx, x0, sigma)\n\n    # Time stepping\n    t = 0.0\n    dt_cfl = CFL * dx / abs(a)\n    \n    while t  T:\n        dt = min(dt_cfl, T - t)\n        \n        # SSP-RK2 time integration\n        # Stage 1\n        u_stage1 = u + dt * rhs(u, scheme, a, dx)\n        # Stage 2\n        u = 0.5 * u + 0.5 * (u_stage1 + dt * rhs(u_stage1, scheme, a, dx))\n        \n        t += dt\n\n    # Compute L2 error at final time T\n    mu_final = x0 + a * T\n    u_exact = exact_cell_avg(x_centers, dx, mu_final, sigma)\n    error = np.sqrt(dx * np.sum((u - u_exact)**2))\n    \n    return error\n\ndef compute_convergence_rate(errors, N_list, L):\n    \"\"\"\n    Computes the convergence rate from a grid refinement study.\n    \"\"\"\n    dx_list = L / np.array(N_list)\n    log_errors = np.log(errors)\n    log_dx = np.log(dx_list)\n    \n    # Fit a line (degree 1 polynomial) to log(error) vs log(dx)\n    # The slope of this line is the order of convergence.\n    coeffs = np.polyfit(log_dx, log_errors, 1)\n    return coeffs[0]\n\ndef solve():\n    \"\"\"\n    Main driver function to run test cases and compute convergence rates.\n    \"\"\"\n    # Common parameters\n    L = 1.0\n    x0 = 0.5\n    sigma = 0.05\n    T = 0.2\n    CFL = 0.4\n\n    test_cases = [\n        {'scheme': 'muscl', 'a': 1.0, 'N_list': [50, 100, 200, 400]},\n        {'scheme': 'upwind', 'a': 1.0, 'N_list': [50, 100, 200, 400]},\n        {'scheme': 'muscl', 'a': -1.0, 'N_list': [64, 128, 256, 512]}\n    ]\n    \n    results = []\n\n    for case in test_cases:\n        errors = []\n        for N in case['N_list']:\n            error = run_simulation(N, case['scheme'], case['a'], L, x0, sigma, T, CFL)\n            errors.append(error)\n        \n        rate = compute_convergence_rate(errors, case['N_list'], L)\n        results.append(rate)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}