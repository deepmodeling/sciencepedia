{
    "hands_on_practices": [
        {
            "introduction": "数值方法很少能精确求解原始的偏微分方程。通过“修正方程”分析，我们可以揭示一个离散格式实际求解的等效方程，从而深入理解其数值特性。本练习将指导您使用泰勒级数展开，推导一阶迎风格式的修正方程，并揭示其固有的、被称为“数值黏性”的人工耗散项 。",
            "id": "3952213",
            "problem": "考虑一维线性对流方程，这是航空航天计算流体动力学（CFD）中对流输运的一个典范模型，\n$$\nu_{t} + a\\,u_{x} = 0,\n$$\n其中平流速度 $a \\in \\mathbb{R}$ 为常数，网格为均匀网格，间距为 $\\Delta x  0$。如下构造一个半离散一阶迎风空间离散格式：对于 $a0$，在节点 $x_{i}$ 处用后向差分 $(u_{i}-u_{i-1})/\\Delta x$ 来近似 $u_{x}$；对于 $a0$，用前向差分 $(u_{i+1}-u_{i})/\\Delta x$ 来近似它。假设 $u$ 足够光滑，使得泰勒展开有效。\n\n仅从泰勒级数的定义和给定的半离散迎风近似出发，推导该半离散格式所满足的主阶修正偏微分方程，保留超出原始模型的 $\\mathcal{O}(\\Delta x)$ 阶项。匹配各项，使得该修正方程写成如下形式\n$$\nu_{t} + a\\,u_{x} = \\nu_{\\text{num}}\\,u_{xx} + \\text{higher-order terms},\n$$\n并用 $a$ 和 $\\Delta x$ 来确定等效的数值运动粘性 $\\nu_{\\text{num}}$。给出 $\\nu_{\\text{num}}$ 的闭式解析表达式作为最终答案。不需包含单位。不需四舍五入。",
            "solution": "本题要求推导一维线性对流方程 $u_{t} + a\\,u_{x} = 0$ 的一阶迎风半离散格式的等效数值运动粘性 $\\nu_{\\text{num}}$。推导过程通过使用泰勒级数展开来分析空间离散的截断误差进行。此分析揭示了数值格式实际求解的修正偏微分方程。\n\n题目根据平流速度 $a$ 的符号为迎风格式指定了两种情况。我们将分别分析每种情况。\n\n情况1：$a  0$\n对于这种情况，题目指出在节点 $x_i$ 处的空间导数 $u_x$ 由一阶后向差分近似。得到的半离散方程为：\n$$\n\\frac{du_i}{dt} + a \\left( \\frac{u_i - u_{i-1}}{\\Delta x} \\right) = 0\n$$\n为了分析截断误差，我们在连续设定下解释这个离散方程。设 $u(x, t)$ 为精确解，离散值 $u_i(t)$ 代表对 $u(x_i, t)$ 的近似。在点 $x$ 处的半离散方程可以写为：\n$$\nu_t + a \\left( \\frac{u(x,t) - u(x-\\Delta x, t)}{\\Delta x} \\right) = 0\n$$\n我们对项 $u(x-\\Delta x, t)$ 在点 $(x, t)$ 周围进行泰勒级数展开。假设 $u$ 足够光滑，展开式为：\n$$\nu(x-\\Delta x, t) = u(x,t) - \\Delta x \\frac{\\partial u}{\\partial x}(x,t) + \\frac{(\\Delta x)^2}{2!} \\frac{\\partial^2 u}{\\partial x^2}(x,t) - \\frac{(\\Delta x)^3}{3!} \\frac{\\partial^3 u}{\\partial x^3}(x,t) + \\dots\n$$\n为简洁起见，我们将使用下标表示法来表示偏导数（例如，$u_x = \\frac{\\partial u}{\\partial x}$）。\n$$\nu(x-\\Delta x) = u - \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} - \\mathcal{O}((\\Delta x)^3)\n$$\n将此展开式代入离散空间导数近似中：\n$$\n\\frac{u - u(x-\\Delta x)}{\\Delta x} = \\frac{u - \\left(u - \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} - \\mathcal{O}((\\Delta x)^3)\\right)}{\\Delta x}\n$$\n$$\n= \\frac{\\Delta x\\,u_x - \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)}{\\Delta x}\n$$\n$$\n= u_x - \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2)\n$$\n现在，我们将此表达式代回半离散方程：\n$$\nu_t + a \\left( u_x - \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2) \\right) = 0\n$$\n整理各项可得：\n$$\nu_t + a\\,u_x = a \\frac{\\Delta x}{2}u_{xx} - a \\mathcal{O}((\\Delta x)^2)\n$$\n这就是修正偏微分方程。将其与目标形式 $u_t + a\\,u_x = \\nu_{\\text{num}}\\,u_{xx} + \\text{higher-order terms}$ 进行比较，我们确定当 $a0$ 时的数值粘性为：\n$$\n\\nu_{\\text{num}} = a \\frac{\\Delta x}{2}\n$$\n\n情况2：$a  0$\n对于这种情况，空间导数 $u_x$ 由一阶前向差分近似。半离散方程为：\n$$\n\\frac{du_i}{dt} + a \\left( \\frac{u_{i+1} - u_i}{\\Delta x} \\right) = 0\n$$\n在连续设定下，这表示为：\n$$\nu_t + a \\left( \\frac{u(x+\\Delta x, t) - u(x, t)}{\\Delta x} \\right) = 0\n$$\n我们对 $u(x+\\Delta x, t)$ 在 $(x, t)$ 周围进行泰勒级数展开：\n$$\nu(x+\\Delta x, t) = u(x,t) + \\Delta x \\frac{\\partial u}{\\partial x}(x,t) + \\frac{(\\Delta x)^2}{2!} \\frac{\\partial^2 u}{\\partial x^2}(x,t) + \\frac{(\\Delta x)^3}{3!} \\frac{\\partial^3 u}{\\partial x^3}(x,t) + \\dots\n$$\n使用下标表示法：\n$$\nu(x+\\Delta x) = u + \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)\n$$\n将此代入离散空间导数近似中：\n$$\n\\frac{u(x+\\Delta x) - u}{\\Delta x} = \\frac{\\left(u + \\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)\\right) - u}{\\Delta x}\n$$\n$$\n= \\frac{\\Delta x\\,u_x + \\frac{(\\Delta x)^2}{2}u_{xx} + \\mathcal{O}((\\Delta x)^3)}{\\Delta x}\n$$\n$$\n= u_x + \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2)\n$$\n将此代回半离散方程：\n$$\nu_t + a \\left( u_x + \\frac{\\Delta x}{2}u_{xx} + \\mathcal{O}((\\Delta x)^2) \\right) = 0\n$$\n整理各项：\n$$\nu_t + a\\,u_x = -a \\frac{\\Delta x}{2}u_{xx} - a \\mathcal{O}((\\Delta x)^2)\n$$\n将其与目标形式 $u_t + a\\,u_x = \\nu_{\\text{num}}\\,u_{xx} + \\text{higher-order terms}$ 进行比较，我们确定当 $a0$ 时的数值粘性为：\n$$\n\\nu_{\\text{num}} = -a \\frac{\\Delta x}{2}\n$$\n\n总结与最终表达式\n我们已经找到了当 $a$ 为正和为负时 $\\nu_{\\text{num}}$ 的表达式：\n- 如果 $a  0$，则 $\\nu_{\\text{num}} = a \\frac{\\Delta x}{2}$。因为 $a  0$，所以这等于 $|a| \\frac{\\Delta x}{2}$。\n- 如果 $a  0$，则 $\\nu_{\\text{num}} = -a \\frac{\\Delta x}{2}$。因为 $a  0$，所以 $-a$ 是正数且等于 $|a|$。因此，这也等于 $|a| \\frac{\\Delta x}{2}$。\n\n两种情况都可以使用 $a$ 的绝对值，用一个统一的公式来表示。迎风格式中的主阶误差项起到了一个扩散项的作用，其等效数值运动粘性由下式给出：\n$$\n\\nu_{\\text{num}} = \\frac{|a| \\Delta x}{2}\n$$\n该项始终为非负，这表明无论平流速度 $a$ 的符号如何，一阶迎风格式都会在数值解中引入人为耗散或扩散。这是该格式的一个典型特征。",
            "answer": "$$\\boxed{\\frac{|a|\\Delta x}{2}}$$"
        },
        {
            "introduction": "在计算流体力学中，守恒定律的离散化至关重要，尤其是在处理可变系数（如变化的流速）时。一个看似合理的离散格式如果未能保持守恒形式，可能会导致非物理的质量增益或损失。本练习通过对比一个守恒的通量差分格式与一个非守恒的中心差分格式，让您亲手量化非守恒性引入的误差，从而深刻理解为何离散守恒定律是构建可靠数值模型的基石 。",
            "id": "3952240",
            "problem": "考虑在周期区间 $[0, 2\\pi]$ 上的一维被动标量输运，其平流速度场随空间变化。其物理守恒的控制方程是守恒形式的标量平流方程\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(a(x)\\,u(x,t)\\right) = 0,\n$$\n其中 $u(x,t)$ 是一个无量纲标量，$a(x)$ 是一个给定的、无量纲的、严格为正的速度场。令 $a(x)$ 由 $a(x) = 1 + \\beta \\cos(x)$ 给出，其中 $0  \\beta  1$，因此对于所有 $x \\in [0, 2\\pi]$ 都有 $a(x)  0$。\n\n定义一个均匀网格，其中 $N$ 为偶数且 $N \\ge 4$，节点位置为 $x_i = i \\,\\Delta x$（$i = 0, 1, \\dots, N-1$），网格间距为 $\\Delta x = \\frac{2\\pi}{N}$。令 $u_i(t)$ 表示 $u(x_i,t)$ 的节点近似值。考虑两种半离散对流差分格式：\n\n- 一种基于守恒律构建的守恒通量差分格式，对正速度使用一阶迎风通量，\n$$\n\\frac{d u_i}{d t} = -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x}, \\quad F_{i+\\frac{1}{2}} = a\\!\\left(x_{i+\\frac{1}{2}}\\right)\\,u_i,\n$$\n其中 $x_{i+\\frac{1}{2}} = x_i + \\frac{\\Delta x}{2}$。\n\n- 一种应用于非守恒算子 $a(x)\\,\\frac{\\partial u}{\\partial x}$ 的非守恒中心差分格式，\n$$\n\\frac{d u_i}{d t} = - a(x_i)\\,\\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\n\n设初始条件为 $u_i(0) = \\sin(x_i)$。定义 $u$ 的空间积分的离散近似为 $M(t) = \\Delta x \\sum_{i=0}^{N-1} u_i(t)$。\n\n从控制方程的守恒形式和以上定义出发，解析地证明在周期性边界条件下，这两种格式中哪一种能够保持 $M(t)$ 守恒，哪一种不能。然后，对于非守恒中心差分格式，推导初始漂移率 $\\frac{d M}{d t}\\big|_{t=0}$ 作为 $\\beta$ 和 $N$ 的函数的封闭形式解析表达式。\n\n你的最终答案必须是在非守恒中心差分格式下，$\\frac{d M}{d t}\\big|_{t=0}$ 的单一、简化的解析表达式。不需要数值近似或四舍五入，最终答案中不应包含任何物理单位。",
            "solution": "该问题要求分析在周期性域上，针对守恒形式的一维标量平流方程 $\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(a(x)\\,u(x,t)\\right) = 0$ 的两种数值格式。我们必须确定哪种格式能守恒总标量质量，并为非守恒格式推导该质量的初始变化率。\n\n总标量质量的离散近似定义为 $M(t) = \\Delta x \\sum_{i=0}^{N-1} u_i(t)$。其时间导数由下式给出\n$$\n\\frac{d M}{d t} = \\frac{d}{dt} \\left( \\Delta x \\sum_{i=0}^{N-1} u_i(t) \\right) = \\Delta x \\sum_{i=0}^{N-1} \\frac{d u_i}{d t}.\n$$\n如果 $\\frac{d M}{d t} = 0$，则格式是守恒的。我们现在将分析每种格式。\n\n首先，考虑守恒的通量差分迎风格式。节点 $i$ 的半离散方程为\n$$\n\\frac{d u_i}{d t} = -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x},\n$$\n其中 $F_{i+\\frac{1}{2}}$ 是节点 $i$ 和 $i+1$ 之间界面上的数值通量。将此代入 $\\frac{d M}{d t}$ 的表达式中：\n$$\n\\frac{d M}{d t} = \\Delta x \\sum_{i=0}^{N-1} \\left( -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x} \\right) = - \\sum_{i=0}^{N-1} (F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}).\n$$\n这个和是一个伸缩级数。对 $i = 0, 1, \\dots, N-1$ 展开求和：\n$$\n\\sum_{i=0}^{N-1} (F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}) = (F_{\\frac{1}{2}} - F_{-\\frac{1}{2}}) + (F_{\\frac{3}{2}} - F_{\\frac{1}{2}}) + \\dots + (F_{N-\\frac{1}{2}} - F_{N-\\frac{3}{2}}).\n$$\n由于项的抵消，和简化为 $F_{N-\\frac{1}{2}} - F_{-\\frac{1}{2}}$。问题指定了周期性边界条件。这意味着网格是环绕的，因此节点 $0$ 左侧的界面与节点 $N-1$ 右侧的界面相同。在数学上，这意味着通量是周期的，即对于任何整数 $j$，$F_{j+\\frac{1}{2}} = F_{j+N+\\frac{1}{2}}$。因此，$F_{-\\frac{1}{2}} = F_{N-\\frac{1}{2}}$。因此，和为\n$$\nF_{N-\\frac{1}{2}} - F_{N-\\frac{1}{2}} = 0.\n$$\n因此，对于守恒的迎风格式，$\\frac{d M}{d t} = 0$。该格式保持总标量 $M(t)$ 守恒，这与任何以离散守恒律（或通量差分）形式编写的格式的预期一致。\n\n接下来，考虑非守恒中心差分格式。其半离散方程为\n$$\n\\frac{d u_i}{d t} = - a(x_i)\\,\\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\n将此代入 $\\frac{d M}{d t}$ 的表达式中：\n$$\n\\frac{d M}{d t} = \\Delta x \\sum_{i=0}^{N-1} \\left( - a(x_i)\\,\\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x} \\right) = -\\frac{1}{2} \\sum_{i=0}^{N-1} a_i(u_{i+1} - u_{i-1}),\n$$\n其中我们使用简写 $a_i = a(x_i)$。我们可以拆分这个和并进行变标（离散分部求和）：\n$$\n\\sum_{i=0}^{N-1} a_i(u_{i+1} - u_{i-1}) = \\sum_{i=0}^{N-1} a_i u_{i+1} - \\sum_{i=0}^{N-1} a_i u_{i-1}.\n$$\n利用指标的周期性（即 $u_N=u_0$, $u_{-1}=u_{N-1}$, $a_N=a_0$, $a_{-1}=a_{N-1}$），我们重新对和式进行变标，使它们都含有因子 $u_i$：\n$$\n\\sum_{i=0}^{N-1} a_i u_{i+1} = \\sum_{j=1}^{N} a_{j-1} u_j = \\sum_{j=0}^{N-1} a_{j-1} u_j.\n$$\n$$\n\\sum_{i=0}^{N-1} a_i u_{i-1} = \\sum_{k=-1}^{N-2} a_{k+1} u_k = \\sum_{k=0}^{N-1} a_{k+1} u_k.\n$$\n结合这些结果，\n$$\n\\frac{d M}{d t} = -\\frac{1}{2} \\left( \\sum_{i=0}^{N-1} a_{i-1} u_i - \\sum_{i=0}^{N-1} a_{i+1} u_i \\right) = \\frac{1}{2} \\sum_{i=0}^{N-1} (a_{i+1} - a_{i-1}) u_i.\n$$\n要使此格式守恒，对于 $u_i(t)$ 的任何选择，$\\frac{d M}{d t}$ 都必须为零。这将要求对所有 $i$ 都有 $a_{i+1} - a_{i-1} = 0$，这意味着 $a(x)$ 必须是一个常数。由于 $a(x) = 1 + \\beta \\cos(x)$ 且 $\\beta  0$，速度场不是恒定的。因此，这种中心差分格式是非守恒的，并且不保持 $M(t)$ 守恒。\n\n现在，我们为这种非守恒格式推导初始漂移率 $\\frac{d M}{d t}\\big|_{t=0}$ 的表达式。初始条件为 $u_i(0) = \\sin(x_i)$。\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = \\frac{1}{2} \\sum_{i=0}^{N-1} (a_{i+1} - a_{i-1}) u_i(0) = \\frac{1}{2} \\sum_{i=0}^{N-1} (a(x_{i+1}) - a(x_{i-1})) \\sin(x_i).\n$$\n当 $a(x) = 1 + \\beta \\cos(x)$ 时，差分项为\n$$\na(x_{i+1}) - a(x_{i-1}) = (1 + \\beta \\cos(x_{i+1})) - (1 + \\beta \\cos(x_{i-1})) = \\beta (\\cos(x_{i+1}) - \\cos(x_{i-1})).\n$$\n使用三角恒等式 $\\cos(A) - \\cos(B) = -2 \\sin\\left(\\frac{A+B}{2}\\right) \\sin\\left(\\frac{A-B}{2}\\right)$，其中 $A=x_{i+1}=(i+1)\\Delta x$ 且 $B=x_{i-1}=(i-1)\\Delta x$：\n$$\n\\cos(x_{i+1}) - \\cos(x_{i-1}) = -2 \\sin\\left(\\frac{(i+1)\\Delta x + (i-1)\\Delta x}{2}\\right) \\sin\\left(\\frac{(i+1)\\Delta x - (i-1)\\Delta x}{2}\\right) = -2\\sin(i\\Delta x)\\sin(\\Delta x).\n$$\n所以，$a_{i+1} - a_{i-1} = -2\\beta\\sin(x_i)\\sin(\\Delta x)$。\n将此代入漂移率的表达式中：\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = \\frac{1}{2} \\sum_{i=0}^{N-1} \\left( -2\\beta\\sin(x_i)\\sin(\\Delta x) \\right) \\sin(x_i) = -\\beta\\sin(\\Delta x) \\sum_{i=0}^{N-1} \\sin^2(x_i).\n$$\n我们现在必须计算求和 $\\sum_{i=0}^{N-1} \\sin^2(x_i)$。使用恒等式 $\\sin^2(\\theta) = \\frac{1 - \\cos(2\\theta)}{2}$：\n$$\n\\sum_{i=0}^{N-1} \\sin^2(x_i) = \\sum_{i=0}^{N-1} \\frac{1 - \\cos(2x_i)}{2} = \\frac{1}{2} \\sum_{i=0}^{N-1} 1 - \\frac{1}{2} \\sum_{i=0}^{N-1} \\cos(2x_i).\n$$\n和的第一部分是 $\\frac{1}{2} \\sum_{i=0}^{N-1} 1 = \\frac{N}{2}$。第二部分是余弦在跨越整个周期的均匀离散网格上的和。由于 $x_i = i\\frac{2\\pi}{N}$，该和为\n$$\n\\sum_{i=0}^{N-1} \\cos(2x_i) = \\sum_{i=0}^{N-1} \\cos\\left(i \\frac{4\\pi}{N}\\right).\n$$\n这个和是一个几何级数的实部：$\\text{Re}\\left(\\sum_{i=0}^{N-1} (e^{j \\frac{4\\pi}{N}})^i\\right)$。公比为 $r = e^{j \\frac{4\\pi}{N}}$。由于 $N \\ge 4$，所以 $r \\neq 1$。几何级数的和是 $\\frac{1-r^N}{1-r}$。分子是 $1 - (e^{j \\frac{4\\pi}{N}})^N = 1 - e^{j 4\\pi} = 1 - 1 = 0$。因此，和为零。\n因此，\n$$\n\\sum_{i=0}^{N-1} \\sin^2(x_i) = \\frac{N}{2} - 0 = \\frac{N}{2}.\n$$\n将此结果代回初始漂移率的表达式中：\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = -\\beta\\sin(\\Delta x) \\left(\\frac{N}{2}\\right).\n$$\n最后，代入 $\\Delta x = \\frac{2\\pi}{N}$，我们得到封闭形式的表达式：\n$$\n\\frac{d M}{d t}\\bigg|_{t=0} = -\\frac{N\\beta}{2} \\sin\\left(\\frac{2\\pi}{N}\\right).\n$$\n这就是非守恒格式下总标量质量初始变化率的最终解析表达式。",
            "answer": "$$\\boxed{-\\frac{N\\beta}{2}\\sin\\left(\\frac{2\\pi}{N}\\right)}$$"
        },
        {
            "introduction": "理论分析为我们预测了数值格式的精度，但最终的检验标准是其在计算实践中的表现。本练习是一个综合性的编程任务，要求您实现并对比一阶迎风格式和更高阶的MUSCL格式，并通过网格加密研究来实证检验它们的收敛阶。完成这项任务将让您掌握验证CFD求解器准确性的核心方法，将理论知识转化为可靠的计算工具 。",
            "id": "3952188",
            "problem": "考虑周期性域上的一维常系数线性平流方程，表示为\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\n$$\n其中 $u(x,t)$ 是一个标量守恒量，$a$ 是一个恒定的平流速度，空间域为 $x \\in [0,L]$，采用周期性边界条件。初始条件是一个光滑的高斯脉冲，中心位于 $x_0$，标准差为 $\\sigma$，由下式给出\n$$\nu(x,0) = \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right)。\n$$\n对于足够小以至于不会穿过周期性边界（因此不会触发周期性回绕）的平流时间，其解析解是平移后的高斯函数\n$$\nu(x,t) = \\exp\\left(-\\frac{(x - (x_0 + a t))^2}{2\\sigma^2}\\right)。\n$$\n\n从方程在控制体上的积分守恒形式出发，\n$$\n\\frac{d}{dt}\\bar{u}_i(t) = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}}(t) - F_{i-\\frac{1}{2}}(t)\\right),\n$$\n其中 $\\bar{u}_i$ 是单元 $i$ 上的单元平均值，$F_{i+\\frac{1}{2}}$ 是单元 $i$ 和 $i+1$ 之间界面上的数值对流通量，推导并实现两种用于对流通量的空间差分格式：\n- 一阶迎风格式，该格式使用分片常数重构，适用于方向由 $a$ 的符号决定的双曲平流问题。\n- 二阶Monotone Upstream-centered Schemes for Conservation Laws (MUSCL)重构，不使用总变差减小（TVD）剪裁和限制器，利用中心差分斜率重构左右界面状态。对于 $a0$，在每个界面处使用左侧状态；对于 $a0$，使用右侧状态。\n\n使用线方法（Method of Lines）结合强稳定性保持（SSP）二阶Runge–Kutta时间积分，将解推进到指定的最终时间 $T$。时间步长 $\\Delta t$ 必须满足Courant–Friedrichs–Lewy (CFL)稳定性约束\n$$\n\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{|a|}。\n$$\n计算在时间 $T$ 时，数值单元平均值与精确单元平均解之间的离散 $L_2$ 误差范数，其中在以 $x_c$ 为中心、宽度为 $\\Delta x$ 的单元上的精确单元平均值由以下积分给出\n$$\n\\bar{u}_{\\text{exact}} = \\frac{1}{\\Delta x} \\int_{x_c - \\frac{\\Delta x}{2}}^{x_c + \\frac{\\Delta x}{2}} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)\\,dx,\n$$\n其中\n$$\n\\mu = x_0 + a T。\n$$\n该积分必须使用误差函数 $\\operatorname{erf}(\\cdot)$ 精确计算。将离散 $L_2$ 误差范数定义为\n$$\n\\|e\\|_2 = \\left(\\Delta x \\sum_{i=1}^{N} \\left(\\bar{u}_i - \\bar{u}_{\\text{exact},i}\\right)^2\\right)^{1/2}。\n$$\n\n对于每种格式，通过在一系列单元数 $N$ 上进行网格加密研究，计算经验收敛阶。具体方法是测量误差 $E(N)$，并对 $\\log(E)$ 与 $\\log(\\Delta x)$ 的关系进行线性拟合，以估算收敛率。预期结果是，在光滑初始条件且不存在限制器引起的剪裁的情况下，一阶迎风格式表现出约一阶收敛，而无限制器的MUSCL格式表现出约二阶收敛。\n\n程序必须实现以下具体要求：\n- 域长度 $L = 1$，中心 $x_0 = 0.5$，标准差 $\\sigma = 0.05$，平流速度 $a \\in \\{1.0, -1.0\\}$，最终时间 $T = 0.2$，以及库朗数 $\\text{CFL} = 0.4$。\n- 有限体积单元平均值作为主要离散未知量。\n- 通过索引回绕实现周期性边界条件。\n- SSP二阶Runge–Kutta时间步进。\n- 使用误差函数进行精确的单元平均积分，以计算解析参考解。\n\n您的程序必须运行三个测试用例，每个用例计算一个浮点数收敛率：\n1. 对于 $a=1.0$，使用无限制器的MUSCL格式，网格规模为 $N \\in \\{50,100,200,400\\}$。\n2. 对于 $a=1.0$，使用一阶迎风格式，网格规模为 $N \\in \\{50,100,200,400\\}$。\n3. 对于 $a=-1.0$，使用无限制器的MUSCL格式，网格规模为 $N \\in \\{64,128,256,512\\}$。\n\n所有量都是无量纲的，因此不需要进行物理单位转换。您的程序应生成单行输出，其中包含三个收敛率，格式为方括号内以逗号分隔的列表（例如，$ [r_1,r_2,r_3] $），其中每个 $r_k$ 是一个浮点数。",
            "solution": "所提出的问题是计算流体力学中一个适定且标准的数值分析任务。它要求实现和验证两种用于线性平流方程的常见空间离散格式。所有参数和条件都已提供，问题在科学上是合理的。因此，我们可以着手提供一个完整的解法。\n\n控制方程是一维线性平流方程：\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\n其中 $u(x,t)$ 是一个标量， $a$ 是恒定的平流速度，空间域为 $x \\in [0,L]$，并采用周期性边界条件。\n\n我们采用有限体积法。将控制方程在一个控制体（单元） $i$ 上进行积分，该单元范围从 $x_{i-1/2}$ 到 $x_{i+1/2}$，宽度为 $\\Delta x = x_{i+1/2} - x_{i-1/2}$，得到守恒律的积分形式：\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\, dx = - [a u(x_{i+1/2}, t) - a u(x_{i-1/2}, t)]\n$$\n定义单元平均值为 $\\bar{u}_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\, dx$，通量为 $F(u) = au$，我们得到每个单元平均值的半离散常微分方程（ODE）：\n$$\n\\frac{d\\bar{u}_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\n其中 $F_{i \\pm 1/2}$ 代表单元界面处的数值通量。任务的核心是根据不同的空间重构格式来定义此数值通量。\n\n**1. 空间离散格式**\n\n**a) 一阶迎风格式**\n该格式基于每个单元内的分片常数重构，即对于 $x \\in [x_{i-1/2}, x_{i+1/2}]$ 有 $u(x) = \\bar{u}_i$。在任意给定的界面，例如 $x_{i+1/2}$，这种重构导致了来自左侧的值 $\\bar{u}_i$ 和来自右侧的值 $\\bar{u}_{i+1}$ 之间的间断。迎风原理通过选择界面“上游”单元的值来解决这个问题，其方向由平流速度 $a$ 的符号决定。\n\n- 如果 $a  0$，流动方向从左到右。界面 $x_{i+1/2}$ 处的状态由其左侧的单元 $i$ 决定。因此，通量为 $F_{i+1/2} = a \\bar{u}_i$。\n- 如果 $a  0$，流动方向从右到左。界面 $x_{i+1/2}$ 处的状态由其右侧的单元 $i+1$ 决定。因此，通量为 $F_{i+1/2} = a \\bar{u}_{i+1}$。\n\n这两种情况可以使用 $a$ 的绝对值合并为一个表达式：\n$$\nF_{i+1/2} = \\frac{a}{2}(\\bar{u}_i + \\bar{u}_{i+1}) - \\frac{|a|}{2}(\\bar{u}_{i+1} - \\bar{u}_i)\n$$\n众所周知，该格式在空间上具有一阶精度，并且具有高耗散性，这会倾向于抹平解中的尖锐特征。\n\n**b) 无限制器的二阶MUSCL格式**\nMonotone Upstream-centered Schemes for Conservation Laws (MUSCL)方法通过在每个单元内使用分片线性重构来实现更高阶的精度：\n$$\nu(x) = \\bar{u}_i + s_i (x - x_i), \\quad \\text{for } x \\in [x_{i-1/2}, x_{i+1/2}]\n$$\n其中 $s_i$ 是单元 $i$ 中解的斜率，$x_i$ 是单元中心。问题指定使用中心差分来根据单元平均值近似此斜率：\n$$\ns_i = \\frac{\\bar{u}_{i+1} - \\bar{u}_{i-1}}{x_{i+1} - x_{i-1}} = \\frac{\\bar{u}_{i+1} - \\bar{u}_{i-1}}{2\\Delta x}\n$$\n通过这种线性重构，我们可以计算出界面 $x_{i+1/2}$ 左右两侧的解：\n- 左侧状态（来自单元 $i$）：$u_{i+1/2}^L = \\bar{u}_i + s_i(x_{i+1/2} - x_i) = \\bar{u}_i + s_i \\frac{\\Delta x}{2} = \\bar{u}_i + \\frac{\\bar{u}_{i+1} - \\bar{u}_{i-1}}{4}$\n- 右侧状态（来自单元 $i+1$）：$u_{i+1/2}^R = \\bar{u}_{i+1} + s_{i+1}(x_{i+1/2} - x_{i+1}) = \\bar{u}_{i+1} - s_{i+1} \\frac{\\Delta x}{2} = \\bar{u}_{i+1} - \\frac{\\bar{u}_{i+2} - \\bar{u}_i}{4}$\n\n遵循重构状态的迎风原理，通量 $F_{i+1/2} = a u_{i+1/2}$ 计算如下：\n- 如果 $a  0$，我们使用左侧状态：$F_{i+1/2} = a u_{i+1/2}^L$。\n- 如果 $a  0$，我们使用右侧状态：$F_{i+1/2} = a u_{i+1/2}^R$。\n\n由于没有应用限制器，该格式对于光滑解可以达到二阶精度，但在尖锐梯度或间断附近可能会引入振荡（下冲和过冲）。\n\n**2. 时间离散：SSP-RK2**\n\n我们使用线方法（Method of Lines）求解ODE系统 $\\frac{d\\vec{\\bar{u}}}{dt} = \\mathcal{L}(\\vec{\\bar{u}})$，其中 $\\mathcal{L}(\\vec{\\bar{u}})_i = -\\frac{1}{\\Delta x}(F_{i+1/2} - F_{i-1/2})$。问题指定使用强稳定性保持（SSP）二阶Runge-Kutta方法（也称为Heun方法或显式梯形法则）。给定时间 $t_n$ 的解 $\\vec{\\bar{u}}^n$，在 $t_{n+1} = t_n + \\Delta t$ 的解通过两个阶段计算：\n$$\n\\vec{\\bar{u}}^{(1)} = \\vec{\\bar{u}}^n + \\Delta t \\mathcal{L}(\\vec{\\bar{u}}^n)\n$$\n$$\n\\vec{\\bar{u}}^{n+1} = \\frac{1}{2} \\vec{\\bar{u}}^n + \\frac{1}{2} \\left( \\vec{\\bar{u}}^{(1)} + \\Delta t \\mathcal{L}(\\vec{\\bar{u}}^{(1)}) \\right)\n$$\n时间步长 $\\Delta t$ 受Courant-Friedrichs-Lewy (CFL) 稳定性条件的约束：$\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{|a|}$，其中库朗数 $\\text{CFL} \\le 1$。\n\n**3. 误差分析**\n\n为了评估精度，我们将数值解与精确解进行比较。初始条件 $u(x,0) = \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right)$ 在最终时间 $T$ 演变为 $u(x,T) = \\exp\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right)$，其中 $\\mu = x_0 + aT$。\n\n我们必须比较单元平均值。单元 $i$（以 $x_i$ 为中心）上的精确单元平均值通过对精确解进行积分得到：\n$$\n\\bar{u}_{\\text{exact},i} = \\frac{1}{\\Delta x} \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right) \\, dx\n$$\n该积分可以使用误差函数 $\\operatorname{erf}(z) = \\frac{2}{\\sqrt{\\pi}}\\int_0^z e^{-t^2} dt$ 进行计算。高斯函数的不定积分与 $\\operatorname{erf}$ 相关，从而得出精确表达式：\n$$\n\\bar{u}_{\\text{exact},i} = \\frac{\\sqrt{2\\pi}\\sigma}{2\\Delta x} \\left[ \\operatorname{erf}\\left(\\frac{x_i + \\Delta x/2 - \\mu}{\\sqrt{2}\\sigma}\\right) - \\operatorname{erf}\\left(\\frac{x_i - \\Delta x/2 - \\mu}{\\sqrt{2}\\sigma}\\right) \\right]\n$$\n通过离散 $L_2$ 误差范数来量化比较结果：\n$$\n\\|e\\|_2 = \\left(\\Delta x \\sum_{i=1}^{N} \\left(\\bar{u}_i(T) - \\bar{u}_{\\text{exact},i}\\right)^2\\right)^{1/2}\n$$\n经验收敛阶 $p$ 是通过进行网格加密研究来确定的。对于一组网格规模 $N$ 及其对应的网格间距 $\\Delta x = L/N$ 和计算出的误差 $E(\\Delta x) = \\|e\\|_2$，我们假设误差行为符合 $E \\approx C(\\Delta x)^p$。取对数后得到 $\\log(E) \\approx \\log(C) + p \\log(\\Delta x)$。收敛阶 $p$ 是对数据点 $(\\log(\\Delta x), \\log(E))$ 进行线性拟合所得直线的斜率。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import erf\n\ndef exact_cell_avg(x_centers, dx, mu, sigma):\n    \"\"\"\n    Computes the exact cell average of a Gaussian function over cells.\n\n    Args:\n        x_centers (np.ndarray): Array of cell center coordinates.\n        dx (float): Cell width.\n        mu (float): Mean of the Gaussian.\n        sigma (float): Standard deviation of the Gaussian.\n\n    Returns:\n        np.ndarray: Array of exact cell averages.\n    \"\"\"\n    sqrt2_sigma = np.sqrt(2) * sigma\n    arg1 = (x_centers + dx / 2 - mu) / sqrt2_sigma\n    arg2 = (x_centers - dx / 2 - mu) / sqrt2_sigma\n    integral = (np.sqrt(np.pi) * sqrt2_sigma / 2) * (erf(arg1) - erf(arg2))\n    return integral / dx\n\ndef calculate_flux(u, scheme, a, dx):\n    \"\"\"\n    Calculates the numerical flux at cell interfaces i+1/2.\n    \"\"\"\n    if scheme == 'upwind':\n        # Piecewise-constant reconstruction with upwinding\n        if a > 0:\n            # Flux is a * u_i\n            flux = a * u\n        else:\n            # Flux is a * u_{i+1}\n            flux = a * np.roll(u, -1)\n    elif scheme == 'muscl':\n        # Piecewise-linear reconstruction (unlimited)\n        # Stencil for states at interface i+1/2 needs u_{i-1}, u_i, u_{i+1}, u_{i+2}\n        u_im1 = np.roll(u, 1)   # u_{i-1}\n        u_i = u                 # u_i\n        u_ip1 = np.roll(u, -1)  # u_{i+1}\n        u_ip2 = np.roll(u, -2)  # u_{i+2}\n        \n        # Reconstructed states at interface i+1/2\n        # u_L is reconstructed from cell i\n        # u_R is reconstructed from cell i+1\n        u_L = u_i + 0.25 * (u_ip1 - u_im1)\n        u_R = u_ip1 - 0.25 * (u_ip2 - u_i)\n        \n        if a > 0:\n            flux = a * u_L\n        else:\n            flux = a * u_R\n    else:\n        raise ValueError(\"Unknown scheme\")\n    return flux\n\ndef rhs(u, scheme, a, dx):\n    \"\"\"\n    Computes the right-hand side of the semi-discrete ODE system.\n    L(u)_i = -1/dx * (F_{i+1/2} - F_{i-1/2})\n    \"\"\"\n    # flux[i] corresponds to interface i+1/2\n    flux_ip12 = calculate_flux(u, scheme, a, dx)\n    # flux[i-1] corresponds to interface i-1/2\n    flux_im12 = np.roll(flux_ip12, 1)\n    \n    return -(flux_ip12 - flux_im12) / dx\n\n\ndef run_simulation(N, scheme, a, L, x0, sigma, T, CFL):\n    \"\"\"\n    Runs a single finite volume simulation.\n    \"\"\"\n    # Grid setup\n    dx = L / N\n    # Cell centers\n    x_centers = np.linspace(0, L, N, endpoint=False) + dx / 2\n\n    # Initial condition (exact cell averages of Gaussian)\n    u = exact_cell_avg(x_centers, dx, x0, sigma)\n\n    # Time stepping\n    t = 0.0\n    dt_cfl = CFL * dx / abs(a)\n    \n    while t  T:\n        dt = min(dt_cfl, T - t)\n        \n        # SSP-RK2 time integration\n        # Stage 1\n        u_stage1 = u + dt * rhs(u, scheme, a, dx)\n        # Stage 2\n        u = 0.5 * u + 0.5 * (u_stage1 + dt * rhs(u_stage1, scheme, a, dx))\n        \n        t += dt\n\n    # Compute L2 error at final time T\n    mu_final = x0 + a * T\n    u_exact = exact_cell_avg(x_centers, dx, mu_final, sigma)\n    error = np.sqrt(dx * np.sum((u - u_exact)**2))\n    \n    return error\n\ndef compute_convergence_rate(errors, N_list, L):\n    \"\"\"\n    Computes the convergence rate from a grid refinement study.\n    \"\"\"\n    dx_list = L / np.array(N_list)\n    log_errors = np.log(errors)\n    log_dx = np.log(dx_list)\n    \n    # Fit a line (degree 1 polynomial) to log(error) vs log(dx)\n    # The slope of this line is the order of convergence.\n    coeffs = np.polyfit(log_dx, log_errors, 1)\n    return coeffs[0]\n\ndef solve():\n    \"\"\"\n    Main driver function to run test cases and compute convergence rates.\n    \"\"\"\n    # Common parameters\n    L = 1.0\n    x0 = 0.5\n    sigma = 0.05\n    T = 0.2\n    CFL = 0.4\n\n    test_cases = [\n        {'scheme': 'muscl', 'a': 1.0, 'N_list': [50, 100, 200, 400]},\n        {'scheme': 'upwind', 'a': 1.0, 'N_list': [50, 100, 200, 400]},\n        {'scheme': 'muscl', 'a': -1.0, 'N_list': [64, 128, 256, 512]}\n    ]\n    \n    results = []\n\n    for case in test_cases:\n        errors = []\n        for N in case['N_list']:\n            error = run_simulation(N, case['scheme'], case['a'], L, x0, sigma, T, CFL)\n            errors.append(error)\n        \n        rate = compute_convergence_rate(errors, case['N_list'], L)\n        results.append(rate)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}