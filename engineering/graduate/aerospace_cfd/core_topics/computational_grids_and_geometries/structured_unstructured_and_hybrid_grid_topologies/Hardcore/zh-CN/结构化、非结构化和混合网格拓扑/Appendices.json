{
    "hands_on_practices": [
        {
            "introduction": "在计算流体动力学中，非结构化网格的灵活性使其能够处理复杂的几何形状，但其不规则性也给数据管理带来了挑战。为了高效地执行求解器操作（如梯度计算和通量组合），必须有一种快速查找任意给定单元相邻单元的方法。本练习将指导您为四面体网格构建压缩稀疏行（CSR）邻接关系，这是现代CFD求解器中使用的核心数据结构之一。通过此实践，您将掌握从基本的单元-顶点连接信息中提取高级拓扑关系的关键算法。",
            "id": "3998385",
            "problem": "给定多个非结构化四面体网格，每个网格纯粹由单元到顶点的连接关系定义。对于一个四面体网格，一个单元是由 $4$ 个不同顶点索引指定的四面体。当且仅当两个单元共享一个公共三角面时，即当且仅当它们恰好共享 $3$ 个顶点时，这两个单元是相邻的。你的任务是：\n- 为每个网格构建单元邻接图的压缩稀疏行 (CSR) 邻接表示。\n- 为每个网格计算平均模板大小，定义为每个单元的平均邻居数。\n\n使用的基本定义：\n- 一个四面体有 $4$ 个三角面，每个面是其 $4$ 个顶点中的 $3$ 个顶点组成的集合。\n- 通过将其 $3$ 个顶点索引按升序排序来定义面的规范形式。\n- 将单元邻接图定义为一个无向图 $G = (V, E)$，其中 $V$ 是单元索引的集合，当且仅当两个单元共享一个面时，它们之间存在一条无向边。\n- 对于一个大小为 $N \\times N$ 的矩阵的 CSR 格式，行指针数组的长度为 $N+1$，列索引数组的长度等于存储的非零条目的数量，非零值数组的长度与列索引数组相同。对于无权邻接，你可以将所有非零值取为 $1$。\n\n约束和约定：\n- 对于每个网格，单元的索引从 $0$ 到 $N-1$，其中 $N$ 是单元的数量。\n- 顶点索引是非负整数。\n- 不要引入自邻接；必须没有自环。\n- 如果超过两个单元共享同一个面（一种非流形配置），则将所有这些单元视为两两相互邻接，并确保移除重复的邻居条目。\n- 如果两个单元只共享一条边（即只有 $2$ 个公共顶点）或只共享一个顶点（即只有 $1$ 个公共顶点），则它们不相邻。\n- 要构建的 CSR 数组是：长度为 $N+1$ 的行指针数组 $p$，列索引数组 $j$，以及填充为 1 的值数组 $x$。尽管程序不会打印 CSR 数组，但必须在内部构建它们，以通过平均行长度来计算平均模板大小。\n- 对于一个有 $N$ 个单元的网格，平均模板大小为标量\n$$ \\bar{d} \\equiv \\frac{1}{N} \\sum_{i=0}^{N-1} d_i, $$\n其中 $d_i$ 是单元 $i$ 的邻居数量。\n\n测试套件：\n对于以下每个网格，计算平均模板大小。网格以单元列表的形式提供，其中每个单元由一个包含 4 个顶点索引的元组指定：\n- 测试 $1$ (单个孤立单元): $[(0,1,2,3)]$。预期定性行为：无邻接，平均模板大小等于 $0$。\n- 测试 $2$ (两个单元共享一个面): $[(0,1,2,3),(0,1,2,4)]$。预期定性行为：每个单元有一个邻接，平均模板大小等于 $1$。\n- 测试 $3$ (三个单元通过面形成链条): $[(0,1,2,3),(1,2,3,4),(1,3,4,5)]$。预期定性行为：度数为 $[1,2,1]$，平均模板大小等于 $4/3$。\n- 测试 $4$ (三个单元共享一个非流形面): $[(0,1,2,3),(0,1,2,4),(0,1,2,5)]$。预期定性行为：每个单元与其他两个单元相邻，平均模板大小等于 $2$。\n- 测试 $5$ (两个单元只共享一条边，而非一个面): $[(0,1,2,3),(0,1,4,5)]$。预期定性行为：无邻接，平均模板大小等于 $0$。\n\n你的程序必须：\n- 对于每个测试网格，根据上述说明构建 CSR 邻接表示，包括行指针数组 $p$、列索引数组 $j$ 和填充为 1 的值数组 $x$。\n- 使用 CSR 结构，按上述定义计算平均模板大小 $\\bar{d}$。\n- 生成单行输出，其中包含测试结果，格式为方括号内的逗号分隔列表，每个平均值四舍五入到六位小数（例如，$[0.000000,1.000000]$）。\n\n没有用户输入。程序必须按原样运行，并以指定格式精确打印一行。所有输出都是无单位的实数，四舍五入到六位小数。不涉及角度，也不需要百分比。最终输出必须是一个包含 5 个浮点数的列表，顺序与上述测试指定的一致。",
            "solution": "该问题要求为多个非结构化四面体网格计算平均模板大小。一个单元的模板大小是其相邻单元的数量，而平均值是在网格中所有单元上计算的。这项任务将通过首先为每个网格构建单元邻接图，然后计算平均单元度数来完成。\n\n建立邻接关系的基本原则是：两个不同的四面体单元当且仅当它们共享一个公共三角面时才是相邻的。一个面由一组 $3$ 个顶点定义。因此，问题简化为高效地识别共享一个面的所有单元对。\n\n一种暴力方法是比较一个包含 $N$ 个单元的网格中的每一对单元，其复杂度将达到 $O(N^2)$，这对于大型网格来说效率低下。一种更具可扩展性、基于原则的算法是建立一个从面到包含这些面的单元的映射。该方法如下：\n\n1.  **面到单元的映射**：我们处理网格以构建一个哈希映射，可表示为 $M_{face \\to cell}$。此映射的键是面的规范表示，值是包含每个面的单元索引列表。\n    - 我们遍历网格中的每个单元 $c_i$，其中单元索引 $i \\in \\{0, 1, \\dots, N-1\\}$。\n    - 对于每个由其 $4$ 个顶点索引 $\\{v_1, v_2, v_3, v_4\\}$ 定义的四面体，我们生成其 $4$ 个三角面。这些面是顶点集合 $\\{v_1, v_2, v_3\\}$、$\\{v_1, v_2, v_4\\}$、$\\{v_1, v_3, v_4\\}$ 和 $\\{v_2, v_3, v_4\\}$。\n    - 为了在不考虑顶点排序的情况下唯一地标识每个面，我们定义一个规范表示。一个具有顶点索引 $\\{u, v, w\\}$ 的面通过将其索引按升序排序来进行规范化，从而得到一个元组，例如 $(\\min(u,v,w), \\text{median}(u,v,w), \\max(u,v,w))$。\n    - 对于每个规范面 $f$，我们将当前单元索引 $i$ 附加到映射 $M_{face \\to cell}$ 中与键 $f$ 关联的列表中。\n\n2.  **邻接图构建**：在单次遍历所有单元后，$M_{face \\to cell}$ 映射就完全填充好了。然后我们遍历此映射的值来构建邻接图。\n    - 如果 $M_{face \\to cell}$ 中某个面对应的单元索引列表长度大于 $1$，则该面是共享的。假设对于共享面 $f_s$，这个列表为 $[i_1, i_2, \\dots, i_k]$。\n    - 如果 $k=2$，则单元 $c_{i_1}$ 和 $c_{i_2}$ 相邻。这是标准的流形情况。\n    - 如果 $k>2$，则该面是非流形的。问题规定，共享此面的所有单元都是相互邻接的。这意味着我们必须在列表 $[i_1, i_2, \\dots, i_k]$ 中的所有单元之间建立两两邻接关系。\n    - 我们构建一个邻接表，它是一个大小为 $N$ 的集合数组，不妨称之为 `adj`。对于发现的每一对不同的相邻单元索引 $(i_a, i_b)$，我们将 $i_b$ 添加到集合 `adj`$[i_a]$ 中，并将 $i_a$ 添加到集合 `adj`$[i_b]$ 中。使用集合可以自动处理潜在的重复邻接关系，无需额外逻辑。\n\n3.  **CSR 表示和平均模板大小计算**：一旦邻接表最终确定，我们就可以确定每个单元 $i$ 的度数 $d_i$ 为其邻接集合的大小，即 $d_i = |\\text{adj}[i]|$。\n    - 问题指导我们构建 $N \\times N$ 单元邻接矩阵的压缩稀疏行 (CSR) 表示。CSR 格式包括一个长度为 $N+1$ 的行指针数组 $p$，一个列索引数组 $j$，以及一个值数组 $x$。对于无权图， $x$ 中的所有条目都为 $1$。\n    - 行指针数组 $p$ 由以下递推关系定义：\n    $$ p[0] = 0 $$\n    $$ p[k] = p[k-1] + d_{k-1} \\quad \\text{for } k \\in \\{1, \\dots, N\\} $$\n    这意味着 $p[k] = \\sum_{l=0}^{k-1} d_l$。\n    - 邻接矩阵中的非零条目总数，记作 $\\text{NNZ}$，是所有单元度数的总和：$\\text{NNZ} = \\sum_{i=0}^{N-1} d_i$。根据 $p$ 数组的定义，这个总和恰好是 $p[N]$。\n    - 平均模板大小 $\\bar{d}$ 是平均单元度数，由以下公式给出：\n    $$ \\bar{d} = \\frac{1}{N} \\sum_{i=0}^{N-1} d_i $$\n    - 通过计算度数之和 $\\sum_{i=0}^{N-1} d_i$（这等同于计算 CSR 结构中的 $p[N]$ 值），我们直接得到计算平均模板大小的分子。然后，平均值就是 $\\frac{\\text{NNZ}}{N}$。为了找到这个平均值，不需要显式存储列索引数组 $j$ 和值数组 $x$。\n\n此算法正确地形式化了所提供的定义，处理了指定的边界情况（如非流形连接），并为计算每个网格所需的平均模板大小提供了一条清晰的路径。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom collections import defaultdict\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1 (single isolated cell)\n        [(0, 1, 2, 3)],\n        # Test 2 (two cells sharing a face)\n        [(0, 1, 2, 3), (0, 1, 2, 4)],\n        # Test 3 (three cells in a chain via faces)\n        [(0, 1, 2, 3), (1, 2, 3, 4), (1, 3, 4, 5)],\n        # Test 4 (non-manifold face shared by three cells)\n        [(0, 1, 2, 3), (0, 1, 2, 4), (0, 1, 2, 5)],\n        # Test 5 (two cells sharing only an edge)\n        [(0, 1, 2, 3), (0, 1, 4, 5)],\n    ]\n\n    results = []\n    for mesh_cells in test_cases:\n        avg_stencil_size = compute_average_stencil_size(mesh_cells)\n        # Format the result to six decimal places\n        results.append(f\"{avg_stencil_size:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef compute_average_stencil_size(cells):\n    \"\"\"\n    Computes the average stencil size for a given tetrahedral mesh.\n\n    The method involves:\n    1. Mapping each canonical face to the list of cells that contain it.\n    2. Building an adjacency graph based on shared faces.\n    3. Calculating cell degrees and their average.\n    \"\"\"\n    N = len(cells)\n    if N == 0:\n        return 0.0\n\n    # Step 1: Build a map from canonical faces to the cell indices that own them.\n    face_to_cells = defaultdict(list)\n    for i, cell_vertices in enumerate(cells):\n        # A tetrahedron has 4 faces, each being a combination of 3 vertices.\n        for face in combinations(cell_vertices, 3):\n            # A canonical representation is created by sorting vertex indices.\n            # This ensures that the face is identified uniquely, regardless of vertex order.\n            canonical_face = tuple(sorted(face))\n            face_to_cells[canonical_face].append(i)\n\n    # Step 2: Construct the adjacency list from the face-to-cell map.\n    # An adjacency list is represented as a list of sets.\n    adj = [set() for _ in range(N)]\n    for face, sharing_cells in face_to_cells.items():\n        # If more than one cell contains the face, they are adjacent.\n        if len(sharing_cells) > 1:\n            # Per the problem, all cells sharing a face are mutually adjacent.\n            # We generate all unique pairs of cells from the list.\n            for c1, c2 in combinations(sharing_cells, 2):\n                # Add edges to represent adjacency. Using sets handles duplicates automatically.\n                adj[c1].add(c2)\n                adj[c2].add(c1)\n\n    # Step 3: Compute the degrees of all cells. The degree of a cell is its stencil size.\n    degrees = np.array([len(neighbors) for neighbors in adj])\n    \n    # Step 4: Calculate the total number of adjacencies (NNZ in the adjacency matrix).\n    # This sum corresponds to the final entry p[N] of the CSR row pointer array.\n    nnz = np.sum(degrees)\n    \n    # Step 5: Compute the average stencil size.\n    if N > 0:\n        avg_size = nnz / N\n    else:\n        avg_size = 0.0\n        \n    return avg_size\n\nsolve()\n```"
        },
        {
            "introduction": "网格质量直接影响CFD求解的精度和稳定性，但这不仅仅是一个关于单元形状美观与否的模糊概念。本练习深入探讨了网格质量的数学核心，即局部点分布如何影响梯度计算的可靠性。您将使用最小二乘法梯度重构的条件数作为量化指标，来对比两种不同拓扑结构下（一种是类结构化的优质分布，另一种是近似共线的劣质分布）的误差放大效应。通过这个练习，您将深刻理解为什么网格生成中要极力避免高度倾斜或拉伸的单元。",
            "id": "3998372",
            "problem": "考虑一个二维、定常、无粘的标量场 $f(\\boldsymbol{x})$，该场足够光滑，可以在点 $\\boldsymbol{x}_{0}$ 附近进行一阶泰勒展开。在 $\\boldsymbol{x}_{0}$ 的邻域内，假设位于偏移量 $\\boldsymbol{r}_{i} = \\boldsymbol{x}_{i} - \\boldsymbol{x}_{0}$ 处的 $m$ 个邻近点上的值 $f_{i}$ 是已知的。最小二乘梯度重构通过最小化 $\\sum_{i=1}^{m} \\left( b_{i} - \\boldsymbol{g} \\cdot \\boldsymbol{r}_{i} \\right)^{2}$ 来求解 $\\boldsymbol{g} \\approx \\nabla f(\\boldsymbol{x}_{0})$，其中 $b_{i} = f_{i} - f_{0}$ 且 $f_{0} = f(\\boldsymbol{x}_{0})$。这是计算流体动力学（CFD）中在非结构化和混合网格上进行梯度估计的标准方法。\n\n定义 $m \\times 2$ 的设计矩阵 $A$，其第 $i$ 行为 $\\boldsymbol{r}_{i}^{\\top}$，并考虑使用 $2$-范数的无权最小二乘问题。其法方程为 $(A^{\\top} A)\\boldsymbol{g} = A^{\\top} \\boldsymbol{b}$，其中 $\\boldsymbol{b} = [b_{1}, \\dots, b_{m}]^{\\top}$。设 $A$ 的 $2$-范数条件数为 $\\kappa_{2}(A) = \\sigma_{\\max}(A)/\\sigma_{\\min}(A)$，其中 $\\sigma_{\\max}(A)$ 和 $\\sigma_{\\min}(A)$ 分别是 $A$ 的最大和最小奇异值。将 $\\kappa_{2}(A)$ 视为梯度重构的网格质量度量。\n\n从上述泰勒展开和最小二乘公式出发，推导一个范数界，说明 $\\boldsymbol{b}$ 中的扰动 $\\delta \\boldsymbol{b}$ 如何放大为 $\\boldsymbol{g}$ 中的重构误差 $\\delta \\boldsymbol{g}$，并明确证明较大的 $\\kappa_{2}(A)$ 会导致更大的最坏情况放大因子。然后，对于从不同网格拓扑中提取的、围绕 $\\boldsymbol{x}_{0}$ 的两种局部点分布：\n\n1. 一个分布良好、类似结构化网格的区域，其邻近点偏移量为\n$$\n\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{3} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}.\n$$\n\n2. 一个分布不佳、非结构化/混合网格的区域，其三个邻近点几乎共线，一个邻近点靠近坐标轴，偏移量为\n$$\n\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{3} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ \\varepsilon \\end{pmatrix},\n$$\n其中 $\\varepsilon = 0.2$。\n\n假设两个区域的测量噪声具有相同的相对水平 $||\\delta \\boldsymbol{b}||_{2}/||\\boldsymbol{b}||_{2}$，并忽略 $A$ 中的扰动，计算分布不佳区域的梯度重构误差的最坏情况范数界与分布良好区域的相应值之比。将最终答案表示为一个四舍五入到四位有效数字的实数。不需要单位。",
            "solution": "该问题要求我们首先为最小二乘梯度重构问题推导一个范数误差界，然后用它来比较在代表不同网格拓扑的两种不同点分布上重构的数值稳定性。\n\n首先，我们来推导误差界。问题是找到梯度 $\\boldsymbol{g} \\in \\mathbb{R}^2$ 以最小化残差平方和，这可以写成矩阵形式，即最小化 $\\|\\boldsymbol{b} - A\\boldsymbol{g}\\|_2^2$。这里，$A$ 是 $m \\times 2$ 的设计矩阵，其行向量为 $\\boldsymbol{r}_i^\\top$，而 $\\boldsymbol{b}$ 是函数值差 $f_i - f_0$ 构成的向量。这个最小二乘问题的解由法方程给出：\n$$ (A^\\top A)\\boldsymbol{g} = A^\\top \\boldsymbol{b} $$\n由于我们处理的是点的空间分布，为了能够重构出有意义的梯度，这些点不能共线。这意味着 $A$ 的列是线性无关的，并且 $2 \\times 2$ 矩阵 $A^\\top A$ 是可逆的。因此，梯度可以求得为：\n$$ \\boldsymbol{g} = (A^\\top A)^{-1} A^\\top \\boldsymbol{b} $$\n矩阵 $(A^\\top A)^{-1} A^\\top$ 是 $A$ 的 Moore-Penrose 伪逆，记为 $A^+$。\n\n现在，我们考虑测量向量 $\\boldsymbol{b}$ 中的扰动 $\\delta\\boldsymbol{b}$ 的影响。问题陈述中说明忽略 $A$ 中的扰动。受扰动的系统会产生一个新的梯度估计 $\\boldsymbol{g} + \\delta\\boldsymbol{g}$：\n$$ \\boldsymbol{g} + \\delta\\boldsymbol{g} = A^+ (\\boldsymbol{b} + \\delta\\boldsymbol{b}) $$\n从此方程中减去未受扰动的解 $\\boldsymbol{g} = A^+ \\boldsymbol{b}$，得到梯度误差 $\\delta\\boldsymbol{g}$：\n$$ \\delta\\boldsymbol{g} = A^+ \\delta\\boldsymbol{b} $$\n为了找到这个误差大小的界，我们对两边取向量 $2$-范数：\n$$ \\|\\delta\\boldsymbol{g}\\|_2 = \\|A^+ \\delta\\boldsymbol{b}\\|_2 $$\n利用诱导矩阵范数的性质，我们有：\n$$ \\|\\delta\\boldsymbol{g}\\|_2 \\le \\|A^+\\|_2 \\|\\delta\\boldsymbol{b}\\|_2 $$\n伪逆的 $2$-范数 $\\|A^+\\|_2$ 等于 $A$ 的最小奇异值 $\\sigma_{\\min}(A)$ 的倒数。因此，绝对误差界为：\n$$ \\|\\delta\\boldsymbol{g}\\|_2 \\le \\frac{1}{\\sigma_{\\min}(A)} \\|\\delta\\boldsymbol{b}\\|_2 $$\n为了找到相对误差界，我们需要从下方界定 $\\|\\boldsymbol{g}\\|_2$。最小二乘解 $\\boldsymbol{g}$ 将 $\\boldsymbol{b}$ 投影到 $A$ 的列空间上。也就是说，$A\\boldsymbol{g} = \\text{proj}_{\\text{col}(A)}(\\boldsymbol{b})$。由此可得 $\\|A\\boldsymbol{g}\\|_2 \\le \\|\\boldsymbol{b}\\|_2$。根据矩阵范数的定义，我们有 $\\|A\\boldsymbol{g}\\|_2 \\le \\|A\\|_2 \\|\\boldsymbol{g}\\|_2$。$A$ 的 $2$-范数 $\\|A\\|_2$ 是其最大奇异值 $\\sigma_{\\max}(A)$。所以，\n$$ \\|A\\boldsymbol{g}\\|_2 \\le \\sigma_{\\max}(A) \\|\\boldsymbol{g}\\|_2 \\implies \\|\\boldsymbol{g}\\|_2 \\ge \\frac{\\|A\\boldsymbol{g}\\|_2}{\\sigma_{\\max}(A)} $$\n结合 $\\|\\delta\\boldsymbol{g}\\|_2$ 和 $\\|\\boldsymbol{g}\\|_2$ 的界，我们得到相对误差界：\n$$ \\frac{\\|\\delta\\boldsymbol{g}\\|_2}{\\|\\boldsymbol{g}\\|_2} \\le \\frac{\\|\\delta\\boldsymbol{b}\\|_2 / \\sigma_{\\min}(A)}{\\|A\\boldsymbol{g}\\|_2 / \\sigma_{\\max}(A)} = \\frac{\\sigma_{\\max}(A)}{\\sigma_{\\min}(A)} \\frac{\\|\\delta\\boldsymbol{b}\\|_2}{\\|A\\boldsymbol{g}\\|_2} $$\n定义 $2$-范数条件数为 $\\kappa_2(A) = \\sigma_{\\max}(A) / \\sigma_{\\min}(A)$，该界为：\n$$ \\frac{\\|\\delta\\boldsymbol{g}\\|_2}{\\|\\boldsymbol{g}\\|_2} \\le \\kappa_2(A) \\frac{\\|\\delta\\boldsymbol{b}\\|_2}{\\|A\\boldsymbol{g}\\|_2} $$\n向量 $A\\boldsymbol{g}$ 是 $\\boldsymbol{b}$ 在 $A$ 的列空间中的分量。一阶泰勒展开给出 $b_i = f_i - f_0 \\approx \\nabla f(\\boldsymbol{x}_0) \\cdot \\boldsymbol{r}_i$。如果高阶项可以忽略不计，则 $\\boldsymbol{b} \\approx A\\boldsymbol{g}$，这意味着 $\\|A\\boldsymbol{g}\\|_2 \\approx \\|\\boldsymbol{b}\\|_2$。在这种情况下，该界简化为：\n$$ \\frac{\\|\\delta\\boldsymbol{g}\\|_2}{\\|\\boldsymbol{g}\\|_2} \\lesssim \\kappa_2(A) \\frac{\\|\\delta\\boldsymbol{b}\\|_2}{\\|\\boldsymbol{b}\\|_2} $$\n这表明 $\\kappa_2(A)$ 充当了 $\\boldsymbol{b}$ 中的相对误差传播到 $\\boldsymbol{g}$ 中相对误差的最坏情况放大因子。较大的 $\\kappa_2(A)$ 意味着一个更病态的问题，其中小的输入误差可能导致大的输出误差。因此，假设两个区域的相对噪声水平相同，其最坏情况界之比就是它们各自条件数之比。\n\n现在，我们为给定的两种情况计算这个比率。\n\n情况 1：分布良好、类似结构化网格的区域。\n邻近点偏移量为 $\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$, $\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix}$, $\\boldsymbol{r}_{3} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$, $\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$。\n设计矩阵 $A_1$ 为：\n$$ A_1 = \\begin{pmatrix} 1  0 \\\\ -1  0 \\\\ 0  1 \\\\ 0  -1 \\end{pmatrix} $$\n$A_1$ 的奇异值是 $A_1^\\top A_1$ 的特征值的平方根。\n$$ A_1^\\top A_1 = \\begin{pmatrix} 1  -1  0  0 \\\\ 0  0  1  -1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ -1  0 \\\\ 0  1 \\\\ 0  -1 \\end{pmatrix} = \\begin{pmatrix} 1^2 + (-1)^2  0 \\\\ 0  1^2 + (-1)^2 \\end{pmatrix} = \\begin{pmatrix} 2  0 \\\\ 0  2 \\end{pmatrix} $$\n$A_1^\\top A_1$ 的特征值为 $\\lambda_1 = 2$ 和 $\\lambda_2 = 2$。\n$A_1$ 的奇异值为 $\\sigma_{\\max}(A_1) = \\sqrt{2}$ 和 $\\sigma_{\\min}(A_1) = \\sqrt{2}$。\n分布良好区域的条件数为：\n$$ \\kappa_2(A_1) = \\frac{\\sigma_{\\max}(A_1)}{\\sigma_{\\min}(A_1)} = \\frac{\\sqrt{2}}{\\sqrt{2}} = 1 $$\n\n情况 2：分布不佳、非结构化/混合网格的区域。\n邻近点偏移量为 $\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$, $\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix}$, $\\boldsymbol{r}_{3} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix}$, $\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ \\varepsilon \\end{pmatrix}$，其中 $\\varepsilon = 0.2$。\n设计矩阵 $A_2$ 为：\n$$ A_2 = \\begin{pmatrix} 1  0 \\\\ -1  0 \\\\ 2  0 \\\\ 0  0.2 \\end{pmatrix} $$\n我们计算 $A_2^\\top A_2$：\n$$ A_2^\\top A_2 = \\begin{pmatrix} 1  -1  2  0 \\\\ 0  0  0  0.2 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ -1  0 \\\\ 2  0 \\\\ 0  0.2 \\end{pmatrix} = \\begin{pmatrix} 1^2 + (-1)^2 + 2^2  0 \\\\ 0  (0.2)^2 \\end{pmatrix} = \\begin{pmatrix} 1+1+4  0 \\\\ 0  0.04 \\end{pmatrix} = \\begin{pmatrix} 6  0 \\\\ 0  0.04 \\end{pmatrix} $$\n$A_2^\\top A_2$ 的特征值为 $\\lambda_1 = 6$ 和 $\\lambda_2 = 0.04$。\n$A_2$ 的奇异值为 $\\sigma_{\\max}(A_2) = \\sqrt{6}$ 和 $\\sigma_{\\min}(A_2) = \\sqrt{0.04} = 0.2$。\n分布不佳区域的条件数为：\n$$ \\kappa_2(A_2) = \\frac{\\sigma_{\\max}(A_2)}{\\sigma_{\\min}(A_2)} = \\frac{\\sqrt{6}}{0.2} $$\n\n最后，我们计算分布不佳区域的最坏情况范数界与分布良好区域的相应值之比。这个比值就是它们各自条件数的比值。\n$$ \\text{比率} = \\frac{\\kappa_2(A_2)}{\\kappa_2(A_1)} = \\frac{\\sqrt{6} / 0.2}{1} = \\frac{\\sqrt{6}}{0.2} $$\n现在我们计算数值：\n$$ \\text{比率} \\approx \\frac{2.44948974}{0.2} = 12.2474487 $$\n四舍五入到四位有效数字，该比率为 $12.25$。这个结果定量地表明，在分布不佳、几乎共线的点集上进行的梯度重构，对输入数据中噪声的敏感度，是分布良好、类似正交的点集上重构的 $12$ 倍以上。",
            "answer": "$$ \\boxed{12.25} $$"
        },
        {
            "introduction": "将理论知识应用于实际工程问题是CFD从业者的关键能力。本练习模拟了一个典型的航空航天应用场景：为翼型或机身周围的湍流边界层设计一个高效的混合网格。您需要综合运用经验公式、壁面单位（如$y^+$）以及几何约束（如最大单元展弦比），来确定解析边界层所需的棱柱层网格的具体参数。这个过程完美体现了如何将物理流动现象的解析要求转化为具体的网格生成策略，是连接物理、数值与几何的桥梁。",
            "id": "3998390",
            "problem": "需要为一个位于光滑平板上流向位置 $x = 1.0\\,\\mathrm{m}$ 处的不可压缩、零压力梯度湍流边界层（TBL）生成一个先进的计算流体动力学（CFD）混合网格。来流速度为 $U_{\\infty} = 100\\,\\mathrm{m/s}$，空气密度为 $\\rho = 1.2\\,\\mathrm{kg/m^3}$，动力粘度为 $\\mu = 1.8 \\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}$。近壁区域将使用堆叠的棱柱层进行网格划分，各层的壁面法向厚度遵循等比级数，相邻层之间的增长率为常数 $g$。壁面平行方向的离散化在棱柱层堆叠内采用均匀的流向间距，该间距等于壁面值。\n\n壁面单位的设计目标是 $\\,\\Delta y^{+} = 1.0\\,$ 和 $\\,\\Delta x^{+} = 40\\,$，可接受的最大网格纵横比（定义为壁面平行方向长度除以壁面法向厚度）为 $\\mathrm{AR}_{\\max} = 150$。棱柱层增长率受 $g \\leq g_{\\max}$ 约束，其中 $g_{\\max} = 1.20$。棱柱层堆叠的总高度必须覆盖给定 $x$ 处局部湍流边界层厚度 $\\,\\delta\\,$ 的 $f = 0.80$ 部分。\n\n对于高雷诺数下的零压力梯度湍流平板边界层，使用以下广泛接受的关联式：\n- 表面摩擦系数关联式：$C_{f}(x) = 0.026 \\, \\mathrm{Re}_{x}^{-1/7}$，其中 $\\mathrm{Re}_{x} = \\frac{\\rho U_{\\infty} x}{\\mu}$。\n- 边界层厚度关联式：$\\frac{\\delta}{x} = 0.37 \\, \\mathrm{Re}_{x}^{-1/5}$。\n\n使用壁面单位的标准定义：$y^{+} = \\frac{y \\, u_{\\tau}}{\\nu}$ 和 $x^{+} = \\frac{x \\, u_{\\tau}}{\\nu}$，其中 $u_{\\tau} = \\sqrt{\\tau_{w}/\\rho}$ 是摩擦速度，$\\nu = \\mu/\\rho$ 是运动粘度。通过 $C_{f} = \\frac{\\tau_{w}}{\\frac{1}{2} \\rho U_{\\infty}^{2}}$ 将 $u_{\\tau}$ 与 $C_{f}$ 联系起来。\n\n假设棱柱层堆叠内的最差纵横比出现在第一层（壁面法向厚度最小处），并使用 $g = g_{\\max}$ 以在满足增长率约束的同时最小化层数。计算棱柱层的最小整数层数 $N$，使得：\n- 从由 $\\,\\Delta y^{+}\\,$ 设定的第一层高度开始，对层厚的等比级数求和得到的总棱柱层高度 $H_{N}$ 至少为 $f \\, \\delta$。\n- 纵横比约束 $\\mathrm{AR} \\leq \\mathrm{AR}_{\\max}$ 得到满足。\n\n报告最小整数 $N$。不要四舍五入到任何有效数字位数；仅提供整数值。",
            "solution": "该问题要求找出在湍流边界层中用于计算流体动力学（CFD）网格的棱柱层的最小整数层数 $N$。求解过程包括计算边界层的物理属性，然后根据指定的约束条件，用这些属性来确定网格的几何属性。\n\n首先，我们确定在指定位置 $x=1.0\\,\\mathrm{m}$ 处流动的特征无量纲数，即雷诺数。运动粘度 $\\nu$ 是动力粘度 $\\mu$ 与密度 $\\rho$ 的比值。\n已知 $\\rho = 1.2\\,\\mathrm{kg/m^3}$ 和 $\\mu = 1.8 \\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}$：\n$$ \\nu = \\frac{\\mu}{\\rho} = \\frac{1.8 \\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}}{1.2\\,\\mathrm{kg/m^3}} = 1.5 \\times 10^{-5}\\,\\mathrm{m^2/s} $$\n使用来流速度 $U_{\\infty} = 100\\,\\mathrm{m/s}$ 计算 $x$ 处的雷诺数 $\\mathrm{Re}_x$：\n$$ \\mathrm{Re}_{x} = \\frac{U_{\\infty} x}{\\nu} = \\frac{(100\\,\\mathrm{m/s})(1.0\\,\\mathrm{m})}{1.5 \\times 10^{-5}\\,\\mathrm{m^2/s}} = \\frac{2}{3} \\times 10^7 \\approx 6.67 \\times 10^6 $$\n\n有了雷诺数，我们就可以使用提供的经验关联式来求得边界层的属性。\n表面摩擦系数 $C_f$ 为：\n$$ C_{f} = 0.026 \\, \\mathrm{Re}_{x}^{-1/7} = 0.026 \\left(\\frac{2}{3} \\times 10^7\\right)^{-1/7} \\approx 0.0027424 $$\n壁面剪切应力 $\\tau_w$ 通过其定义与 $C_f$ 相关：\n$$ \\tau_{w} = C_{f} \\cdot \\frac{1}{2} \\rho U_{\\infty}^{2} \\approx 0.0027424 \\times \\frac{1}{2} \\times (1.2\\,\\mathrm{kg/m^3}) \\times (100\\,\\mathrm{m/s})^2 \\approx 16.454\\,\\mathrm{Pa} $$\n从 $\\tau_w$ 我们计算出摩擦速度 $u_{\\tau}$：\n$$ u_{\\tau} = \\sqrt{\\frac{\\tau_{w}}{\\rho}} = \\sqrt{\\frac{16.454\\,\\mathrm{Pa}}{1.2\\,\\mathrm{kg/m^3}}} \\approx 3.703\\,\\mathrm{m/s} $$\n\n接下来，我们计算在 $x=1.0\\,\\mathrm{m}$ 处的边界层厚度 $\\delta$：\n$$ \\delta = 0.37 \\, x \\, \\mathrm{Re}_{x}^{-1/5} = 0.37 \\times (1.0\\,\\mathrm{m}) \\times \\left(\\frac{2}{3} \\times 10^7\\right)^{-1/5} \\approx 0.01597\\,\\mathrm{m} $$\n棱柱层堆叠的总高度 $H_{target}$ 必须覆盖该厚度的 $f=0.80$ 部分：\n$$ H_{target} = f \\cdot \\delta = 0.80 \\times 0.01597\\,\\mathrm{m} \\approx 0.01278\\,\\mathrm{m} $$\n\n现在，我们确定近壁第一个网格层的尺寸。第一层的壁面法向厚度 $\\Delta y_1$ 是根据其壁面单位高度 $\\Delta y^{+}$ 为 $1.0$ 的要求推导出来的：\n$$ \\Delta y^{+} = \\frac{\\Delta y_1 u_{\\tau}}{\\nu} = 1.0 $$\n$$ \\Delta y_1 = \\frac{1.0 \\cdot \\nu}{u_{\\tau}} = \\frac{1.5 \\times 10^{-5}\\,\\mathrm{m^2/s}}{3.703\\,\\mathrm{m/s}} \\approx 4.051 \\times 10^{-6}\\,\\mathrm{m} $$\n\n我们必须检查纵横比约束 $\\mathrm{AR} \\le \\mathrm{AR}_{\\max} = 150$。壁面平行方向的网格尺寸 $\\Delta x_{cell}$ 由要求 $\\Delta x^{+} = 40$ 设定：\n$$ \\Delta x^{+} = \\frac{\\Delta x_{cell} u_{\\tau}}{\\nu} = 40 $$\n$$ \\Delta x_{cell} = \\frac{40 \\cdot \\nu}{u_{\\tau}} = 40 \\cdot \\Delta y_1 $$\n假设为最大的第一层纵横比 $\\mathrm{AR}_1$ 是：\n$$ \\mathrm{AR}_1 = \\frac{\\Delta x_{cell}}{\\Delta y_1} = \\frac{40 \\cdot \\Delta y_1}{\\Delta y_1} = 40 $$\n由于 $40  150$，纵横比约束得到满足。\n\n最后，我们求最小层数 $N$。各层厚度遵循等比级数 $\\Delta y_k = \\Delta y_1 g^{k-1}$，增长率为 $g = 1.20$。$N$ 层的总高度 $H_N$ 是该级数的和：\n$$ H_N = \\sum_{k=1}^{N} \\Delta y_1 g^{k-1} = \\Delta y_1 \\frac{g^N - 1}{g - 1} $$\n我们必须满足条件 $H_N \\geq H_{target}$：\n$$ \\Delta y_1 \\frac{g^N - 1}{g - 1} \\geq f \\delta $$\n代入已计算出的数值：\n$$ (4.051 \\times 10^{-6}\\,\\mathrm{m}) \\frac{1.2^N - 1}{1.2 - 1} \\geq 0.01278\\,\\mathrm{m} $$\n$$ \\frac{1.2^N - 1}{0.2} \\geq \\frac{0.01278}{4.051 \\times 10^{-6}} \\approx 3155 $$\n$$ 1.2^N - 1 \\geq 0.2 \\times 3155 = 631 $$\n$$ 1.2^N \\geq 632 $$\n为求解 $N$，我们对不等式两边取自然对数：\n$$ N \\ln(1.2) \\geq \\ln(632) $$\n$$ N \\geq \\frac{\\ln(632)}{\\ln(1.2)} \\approx \\frac{6.4489}{0.18232} \\approx 35.37 $$\n由于层数 $N$ 必须是整数，我们取大于或等于 $35.37$ 的最小整数，即对结果向上取整。\n$$ N = \\lceil 35.37 \\rceil = 36 $$\n因此，至少需要 $36$ 个棱柱层才能满足指定的设计标准。",
            "answer": "$$\\boxed{36}$$"
        }
    ]
}