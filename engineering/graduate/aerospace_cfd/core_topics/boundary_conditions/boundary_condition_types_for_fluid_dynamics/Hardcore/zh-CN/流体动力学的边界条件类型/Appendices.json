{
    "hands_on_practices": [
        {
            "introduction": "在航空航天应用中，我们通常已知来流的总压 $p_{0}$ 和总温 $T_{0}$。然而，计算流体动力学（CFD）求解器在边界上需要的是当地的静态属性和守恒变量。本练习旨在弥合这一差距，通过引导您从基本的热力学和等熵流关系式出发，推导出总能量密度，这是正确设置入口边界条件的一项关键技能。",
            "id": "3945788",
            "problem": "考虑一个航空航天进气道的计算流体动力学(CFD)模拟，其可压缩入流边界上施加了滞止入口边界条件。入流气体是量热完全气体（比热比恒定）和理想气体，其比热比为 $\\gamma$，比气体常数为 $R$。在边界上给定滞止压力 $p_{0}$ 和滞止温度 $T_{0}$。边界面上的入流速度矢量 $\\mathbf{u}$ 从计算域外的流动解中已知；其大小记为 $|\\mathbf{u}|$。\n\n假设从滞止状态到边界静态状态的入流是绝热且可逆的（等熵过程），并忽略体积力和势能变化。求解器存储守恒总能量密度 $E$，并且必须在边界上设置该值，使其与给定的 $(p_{0}, T_{0})$ 和入流速度大小 $|\\mathbf{u}|$ 相一致。\n\n仅从基本热力学定义、理想气体定律和等熵关系式出发，推导边界处守恒总能量密度 $E$ 的闭式解析表达式，该表达式仅以 $p_{0}$、$T_{0}$、$\\gamma$、$R$ 和 $|\\mathbf{u}|$ 表示。请将 $E$ 的最终表达式作为这些量的解析函数给出。不要代入数值。在最终方框内的答案中不要包含任何单位。",
            "solution": "该问题被评估为有效，因为它科学地基于可压缩流体动力学和热力学的原理，是适定的（具有足够信息以获得唯一解），并使用客观、正式的语言陈述。因此，我们可以进行推导。\n\n目标是推导可压缩入流边界上守恒总能量密度 $E$ 的表达式。量 $E$ 定义为单位体积的总能量。它是单位体积的内能与单位体积的动能之和。\n$$\nE = \\rho e + \\frac{1}{2} \\rho |\\mathbf{u}|^2\n$$\n此处，$\\rho$ 是边界处气体的静密度，$e$ 是比内能（单位质量的内能），$|\\mathbf{u}|$ 是入流速度的大小。\n\n问题指出，该气体是理想且量热完全的。对于量热完全气体，比内能是静温 $T$ 的线性函数：\n$$\ne = c_v T\n$$\n其中 $c_v$ 是定容比热。对于理想气体，比热容 $c_p$（定压比热）和 $c_v$ 通过以下关系式与比气体常数 $R$ 和比热比 $\\gamma$ 相关联：\n$$\nc_p - c_v = R\n$$\n$$\n\\gamma = \\frac{c_p}{c_v}\n$$\n从这两个关系式中，我们可以用 $\\gamma$ 和 $R$ 求解 $c_v$：\n$c_p = \\gamma c_v \\implies \\gamma c_v - c_v = R \\implies c_v(\\gamma-1) = R$，得到\n$$\nc_v = \\frac{R}{\\gamma-1}\n$$\n将此式代入 $e$ 的表达式，我们得到：\n$$\ne = \\frac{R}{\\gamma-1} T\n$$\n现在，将 $e$ 的这个表达式代回 $E$ 的定义中：\n$$\nE = \\rho \\left( \\frac{R}{\\gamma-1} T \\right) + \\frac{1}{2} \\rho |\\mathbf{u}|^2\n$$\n使用理想气体定律 $p = \\rho R T$（其中 $p$ 是静压），第一项可以重写为：\n$$\nE = \\frac{p}{\\gamma-1} + \\frac{1}{2} \\rho |\\mathbf{u}|^2\n$$\n这个表达式将 $E$ 与局部静态性质 $p$ 和 $\\rho$ 联系起来。下一步是将这些静态性质与给定的滞止性质 ($p_0, T_0$) 和速度大小 $|\\mathbf{u}|$ 联系起来。\n\n问题指出，从滞止状态到边界的流动是等熵的（绝热且可逆的）。对于没有体积力或势能变化的绝热流动，总焓 $h_0$ 是守恒的。总焓定义为：\n$$\nh_0 = h + \\frac{1}{2} |\\mathbf{u}|^2\n$$\n其中 $h$ 是比静焓。滞止状态被定义为流体经等熵过程达到静止时所处的状态。因此，流场中任意点的总焓等于滞止条件下的静焓 $h_0$。对于量热完全气体，$h = c_p T$。因此：\n$$\nh_0 = c_p T_0\n$$\n结合这些，我们得到关联静温和滞止温度的能量守恒方程：\n$$\nc_p T_0 = c_p T + \\frac{1}{2} |\\mathbf{u}|^2\n$$\n我们可以用 $\\gamma$ 和 $R$ 来表示 $c_p$：$c_p = \\gamma c_v = \\frac{\\gamma R}{\\gamma-1}$。将此代入能量方程：\n$$\n\\frac{\\gamma R}{\\gamma-1} T_0 = \\frac{\\gamma R}{\\gamma-1} T + \\frac{1}{2} |\\mathbf{u}|^2\n$$\n求解静温 $T$：\n$$\nT = T_0 - \\frac{1}{2} \\frac{\\gamma-1}{\\gamma R} |\\mathbf{u}|^2 = T_0 \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right)\n$$\n由于过程是等熵的，静压 $p$ 和静密度 $\\rho$ 通过标准等熵关系式与其对应的滞止量 ($p_0, \\rho_0$) 相关联：\n$$\n\\frac{p}{p_0} = \\left(\\frac{T}{T_0}\\right)^{\\frac{\\gamma}{\\gamma-1}}\n$$\n$$\n\\frac{\\rho}{\\rho_0} = \\left(\\frac{T}{T_0}\\right)^{\\frac{1}{\\gamma-1}}\n$$\n其中 $\\rho_0 = \\frac{p_0}{RT_0}$ 来自滞止状态下的理想气体定律。\n\n将 $T/T_0$ 的表达式代入这些关系式，我们得到边界处的静压和静密度作为给定量的函数：\n$$\np = p_0 \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right)^{\\frac{\\gamma}{\\gamma-1}}\n$$\n$$\n\\rho = \\rho_0 \\left(\\frac{T}{T_0}\\right)^{\\frac{1}{\\gamma-1}} = \\frac{p_0}{R T_0} \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right)^{\\frac{1}{\\gamma-1}}\n$$\n现在我们将 $p$ 和 $\\rho$ 的这些表达式代入 $E$ 的方程中：\n$$\nE = \\frac{1}{\\gamma-1} \\left[ p_0 \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right)^{\\frac{\\gamma}{\\gamma-1}} \\right] + \\frac{1}{2} |\\mathbf{u}|^2 \\left[ \\frac{p_0}{R T_0} \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right)^{\\frac{1}{\\gamma-1}} \\right]\n$$\n为简化起见，我们提出公因子 $p_0 \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right)^{\\frac{1}{\\gamma-1}}$：\n$$\nE = p_0 \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right)^{\\frac{1}{\\gamma-1}} \\left[ \\frac{1}{\\gamma-1} \\left( 1 - \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 \\right) + \\frac{|\\mathbf{u}|^2}{2 R T_0} \\right]\n$$\n我们来简化方括号内的表达式：\n$$\n\\left[ \\frac{1}{\\gamma-1} - \\frac{1}{\\gamma-1} \\frac{\\gamma-1}{2\\gamma R T_0} |\\mathbf{u}|^2 + \\frac{|\\mathbf{u}|^2}{2 R T_0} \\right] = \\left[ \\frac{1}{\\gamma-1} - \\frac{|\\mathbf{u}|^2}{2\\gamma R T_0} + \\frac{|\\mathbf{u}|^2}{2 R T_0} \\right]\n$$\n合并包含 $|\\mathbf{u}|^2$ 的项：\n$$\n\\left[ \\frac{1}{\\gamma-1} + \\frac{|\\mathbf{u}|^2}{2 R T_0} \\left( 1 - \\frac{1}{\\gamma} \\right) \\right] = \\left[ \\frac{1}{\\gamma-1} + \\frac{|\\mathbf{u}|^2}{2 R T_0} \\left( \\frac{\\gamma-1}{\\gamma} \\right) \\right] = \\left( \\frac{1}{\\gamma-1} + \\frac{(\\gamma-1)|\\mathbf{u}|^2}{2\\gamma R T_0} \\right)\n$$\n将这个简化的方括号代回 $E$ 的表达式，我们得到最终的闭式表达式：\n$$\nE = p_{0} \\left( \\frac{1}{\\gamma-1} + \\frac{(\\gamma-1)|\\mathbf{u}|^2}{2\\gamma R T_0} \\right) \\left( 1 - \\frac{(\\gamma-1)|\\mathbf{u}|^2}{2\\gamma R T_0} \\right)^{\\frac{1}{\\gamma-1}}\n$$\n这个守恒总能量密度 $E$ 的表达式仅由给定的滞止性质 $p_0$ 和 $T_0$、气体性质 $\\gamma$ 和 $R$ 以及速度大小 $|\\mathbf{u}|$ 给出，符合要求。",
            "answer": "$$\n\\boxed{p_{0} \\left( \\frac{1}{\\gamma-1} + \\frac{(\\gamma-1)|\\mathbf{u}|^2}{2\\gamma R T_0} \\right) \\left( 1 - \\frac{(\\gamma-1)|\\mathbf{u}|^2}{2\\gamma R T_0} \\right)^{\\frac{1}{\\gamma-1}}}\n$$"
        },
        {
            "introduction": "从无粘理论转向复杂的湍流问题，直接解析壁面附近的整个边界层在计算上是极其昂贵的。本练习将介绍壁面函数这一标准的工业界技术，要求您从对数律壁面公式推导出壁面切应力 $\\tau_{w}$。这个练习展示了如何将经验模型转化为可计算的、用于动量方程的非线性边界条件。",
            "id": "3945767",
            "problem": "考虑在计算流体动力学 (CFD) 中为外部空气动力学构型建模的高雷诺数、不可压缩流动，其中包含一个在光滑等温壁面上方的稳定、完全发展的湍流、零压力梯度边界层。设在离壁面法向距离为 $y$ 处，第一个邻近壁面的控制体中心的平均切向速度为 $U(y)$，流体密度为 $\\rho$，运动粘度为 $\\nu$。假设经典的壁面律对数律在重叠区成立，并且摩擦速度 $u_{\\tau}$ 由 $\\tau_{w} = \\rho u_{\\tau}^{2}$ 定义，其中 $\\tau_{w}$ 是壁面剪切应力。壁面律由下式给出：\n$$\n\\frac{U(y)}{u_{\\tau}} = \\frac{1}{\\kappa}\\,\\ln\\!\\left(\\frac{y\\,u_{\\tau}}{\\nu}\\right) + B,\n$$\n其中 $\\kappa$ 是 von Kármán 常数，$B$ 是光滑壁面附加常数，两者均被视为已知的正常数。\n\n仅从壁面剪切应力的定义和给定的对数律出发，且不引入任何额外的近似，推导出一个用 $\\rho$、$U(y)$、$y$、$\\nu$、$\\kappa$ 和 $B$ 表示的 $\\tau_{w}$ 的闭式解析表达式。如有需要，你可以使用因反演超越关系而产生的标准特殊函数，但不得假设任何预先推导出的反演公式。\n\n然后，解释所得关系式如何为邻近壁面控制体的切向动量方程蕴含一个非线性的 Robin 型有效边界条件，其中壁面剪切应力是当地平均速度 $U(y)$ 的显式函数。\n\n将你的最终结果以用指定量表示的 $\\tau_{w}$ 的单个闭式解析表达式的形式给出。如果你之后选择对其进行数值计算，请以帕斯卡 (Pa) 为单位表示壁面剪切应力。本问题不要求进行数值计算，也没有舍入要求。",
            "solution": "我们从两个基本部分开始。首先，对于牛顿流体，摩擦速度 $u_{\\tau}$ 的定义将壁面剪切应力与壁面处的动量通量联系起来，\n$$\n\\tau_{w} = \\rho\\,u_{\\tau}^{2}.\n$$\n其次，对于光滑壁面上方重叠区内的平衡湍流边界层，平均切向速度满足对数律，\n$$\n\\frac{U(y)}{u_{\\tau}} = \\frac{1}{\\kappa}\\,\\ln\\!\\left(\\frac{y\\,u_{\\tau}}{\\nu}\\right) + B,\n$$\n其中 $\\kappa$ 和 $B$ 是用于高雷诺数壁面约束湍流的、经过经验校准但已广为接受的常数。我们的目标是求解这个关于 $u_{\\tau}$ 的隐式关系，用 $U(y)$、$y$ 和 $\\nu$ 来表示 $u_{\\tau}$，然后通过 $\\tau_{w}=\\rho u_{\\tau}^{2}$ 将其转换为 $\\tau_{w}$。\n\n为简洁起见，令 $x \\equiv u_{\\tau}$。对数律可以重排为\n$$\n\\frac{U(y)}{x} - B = \\frac{1}{\\kappa}\\,\\ln\\!\\left(\\frac{y\\,x}{\\nu}\\right).\n$$\n两边同乘以 $\\kappa$ 并取指数，\n$$\n\\ln\\!\\left(\\frac{y\\,x}{\\nu}\\right) = \\kappa\\left(\\frac{U(y)}{x} - B\\right)\n\\quad\\Longrightarrow\\quad\n\\frac{y\\,x}{\\nu} = \\exp\\!\\left(\\kappa\\frac{U(y)}{x}\\right)\\,\\exp(-\\kappa B).\n$$\n解出 $x$，\n$$\nx = \\frac{\\nu}{y}\\,\\exp\\!\\left(\\kappa\\frac{U(y)}{x}\\right)\\,\\exp(-\\kappa B).\n$$\n这是一个形如 $x\\,\\exp(-a/x)=c$ 的超越方程，其中 $a=\\kappa U(y)$ 且 $c=\\frac{\\nu}{y}\\exp(-\\kappa B)$。为了揭示 Lambert $W$ 函数的范式结构，定义\n$$\nt \\equiv -\\,\\frac{\\kappa\\,U(y)}{x}.\n$$\n于是 $x = -\\,\\frac{\\kappa\\,U(y)}{t}$，代入 $x\\,\\exp\\!\\left(-\\kappa\\frac{U(y)}{x}\\right)=\\frac{\\nu}{y}\\exp(-\\kappa B)$ 得到\n$$\n\\left(-\\,\\frac{\\kappa\\,U(y)}{t}\\right)\\exp(t) \\;=\\; \\frac{\\nu}{y}\\,\\exp(-\\kappa B).\n$$\n重新整理以分离出超越结构：\n$$\n\\frac{\\exp(t)}{t} \\;=\\; -\\,\\frac{\\nu}{\\kappa\\,U(y)\\,y}\\,\\exp(-\\kappa B),\n\\quad\\text{即}\\quad\nt\\,\\exp(-t) \\;=\\; -\\,\\frac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B).\n$$\n引入 $s \\equiv -t$ 以获得标准的 Lambert $W$ 函数形式：\n$$\n(-s)\\,\\exp(s) \\;=\\; -\\,\\frac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B)\n\\quad\\Longrightarrow\\quad\ns\\,\\exp(s) \\;=\\; \\frac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B).\n$$\n根据满足 $W(z)\\exp(W(z))=z$ 的 Lambert $W$ 函数的定义，我们有\n$$\ns \\;=\\; W\\!\\left(\\frac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B)\\right).\n$$\n撤销代换，$s=-t$ 和 $t=-\\kappa U(y)/x$ 意味着\n$$\n\\frac{\\kappa\\,U(y)}{x} \\;=\\; s \\;=\\; W\\!\\left(\\frac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B)\\right).\n$$\n因此，摩擦速度为\n$$\nx \\;=\\; u_{\\tau} \\;=\\; \\frac{\\kappa\\,U(y)}{W\\!\\left(\\dfrac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B)\\right)}.\n$$\n对于我们所关心的湍流重叠区，有 $U(y)0$、$y0$、$\\nu0$、$\\kappa0$，且对于光滑壁面，典型的 $B0$，因此 $W(\\cdot)$ 的自变量为正，物理上允许的分支是主分支，通常记为 $W_{0}$。使用 $\\tau_{w}=\\rho u_{\\tau}^{2}$ 则可得到所求的壁面剪切应力的闭式解，\n$$\n\\tau_{w} \\;=\\; \\rho\\left[\\frac{\\kappa\\,U(y)}{W\\!\\left(\\dfrac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B)\\right)}\\right]^{2}.\n$$\n\n最后，我们将其解释为切向动量方程中用于邻近壁面控制体的一个有效边界条件。在 Reynolds-Averaged Navier–Stokes (RANS) 方程的有限体积离散化中，进入第一个离壁单元的面平衡的壁面剪切应力必须由一个边界条件提供。上述关系式提供了一个非线性的 Robin 型条件，它将距离壁面 $y$ 处的当地平均速度映射到壁面上的剪切应力，\n$$\n\\tau_{w} \\;=\\; \\mathcal{G}\\!\\left(U(y)\\right)\n\\;=\\;\n\\rho\\left[\\frac{\\kappa\\,U(y)}{W\\!\\left(\\dfrac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B)\\right)}\\right]^{2},\n$$\n从而在不解析粘性子层的情况下封闭壁面处的动量平衡。该条件是 Robin 型的，因为它有效地将边界上的一个类通量（剪切应力）与场变量值 $U(y)$ 以一种预定的函数方式关联起来，而不是指定纯粹的 Dirichlet (速度) 或纯粹的 Neumann (剪切) 数据。",
            "answer": "$$\\boxed{\\rho\\left[\\dfrac{\\kappa\\,U(y)}{W\\!\\left(\\dfrac{\\kappa\\,U(y)\\,y}{\\nu}\\,\\exp(\\kappa B)\\right)}\\right]^{2}}$$"
        },
        {
            "introduction": "最后一步是将理论转化为可执行的代码。这个综合性练习将指导您实现可压缩流中最重要的一些边界条件，包括基于特征线的远场条件和无滑移壁面条件。通过实践波的分解和用于处理粘性项的“虚拟网格”方法，您将亲身体验让CFD求解器在区域边界正确工作的核心算法。",
            "id": "3945773",
            "problem": "考虑可压缩Navier–Stokes方程，并将其专门化，其中无粘（欧拉）子系统用于特征边界处理，粘性通量用于边界处一致的梯度处理。设守恒变量向量为 $U = [\\rho,\\rho u,\\rho E]^{\\top}$，其中 $\\rho$ 是密度，$u$ 是沿坐标 $x$ 的速度，$E$ 是比总能。$x$ 方向的无粘通量为 $F(U) = [\\rho u,\\rho u^2 + p, u(\\rho E + p)]^{\\top}$，对于比热比为 $\\gamma$ 的理想气体，压力 $p=(\\gamma-1)\\left(\\rho E - \\tfrac{1}{2}\\rho u^2\\right)$。对于一个外向单位法向量为 $n$ 的边界，法向无粘通量为 $F_n(U) = n F(U)$，其雅可比矩阵为 $A_n(U) = \\partial F_n / \\partial U = n \\, \\partial F / \\partial U$。对于一维流动，$A_n(U)$ 的特征值为 $n(u-a)$、$n u$ 和 $n(u+a)$，其中 $a = \\sqrt{\\gamma p/\\rho}$ 是声速，相应的右特征向量（特征向量矩阵 $R$ 的列）可以取为 $r_1 = [1, u-a, H - ua]^{\\top}$、$r_2 = [1, u, \\tfrac{1}{2}u^2]^{\\top}$ 和 $r_3 = [1, u+a, H + ua]^{\\top}$，其中总焓为 $H = \\gamma/(\\gamma-1)\\, p/\\rho + \\tfrac{1}{2}u^2$。\n\n您必须通过投影到 $A_n(U)$ 的特征向量上来实现特征边界条件，具体如下。给定一个邻近边界的内部状态 $U_i$ 和一个代表远场条件的外部目标状态 $U_e$，计算特征振幅 $\\alpha = R^{-1}(U_e - U_i)$。通过 $A_n(U_i)$ 的每个特征值的符号来识别入射特征：如果特征值 $\\lambda_k  0$，则为入射特征；如果 $\\lambda_k > 0$，则为出射特征（相对于外向法线方向）。通过将出射分量设为零，并将入射分量设为 $\\alpha$ 的相应分量，形成一个修正的振幅向量 $\\tilde{\\alpha}$。将边界约束的守恒状态重构为 $U_b = U_i + R \\tilde{\\alpha}$，然后将 $U_b$ 转换回原始变量 $(\\rho_b,u_b,p_b)$ 和温度 $T_b = p_b / (\\rho_b R_{\\text{gas}})$，其中 $R_{\\text{gas}}$ 是特定气体常数。\n\n对于粘性项，使用虚拟单元值来强制施加物理上一致的边界梯度。设 $\\Delta n$ 是从内部单元中心到虚拟单元中心沿法线方向的距离。法线方向上的剪切应力大小为 $\\tau_n = \\mu\\, \\partial u / \\partial n$，热通量为 $q_n = -k\\, \\partial T / \\partial n$，其中 $\\mu$ 是动力粘度，$k$ 是热导率。通过指定能够强制施加预期条件的虚拟值，在边界处使用二阶中心差分近似：\n- 对于等温无滑移壁面，在壁面处强制 $u=0$ 和 $T=T_w$。一个一致的二阶选择是 $u_g = -u_i$ 和 $T_g = 2 T_w - T_i$，其中 $p_g = p_b$ 且 $\\rho_g = p_g /(R_{\\text{gas}} T_g)$。然后近似计算 $\\partial u / \\partial n \\approx (u_i - u_g)/\\Delta n$ 和 $\\partial T / \\partial n \\approx (T_i - T_g)/\\Delta n$。\n- 对于绝热无滑移壁面，在壁面处强制 $u=0$ 和 $\\partial T/\\partial n = 0$。使用 $u_g = -u_i$ 和 $T_g = T_i$，其中 $p_g = p_b$ 且 $\\rho_g = p_g /(R_{\\text{gas}} T_g)$。\n- 对于特征远场边界（亚音速流入/流出和超音速流入/流出），采用零梯度粘性条件，通过将虚拟值设置为等于内部值，这意味着 $\\tau_n = 0$ 和 $q_n = 0$。\n\n仅从这些定义和定律出发，推导出以下算法：\n1.  计算 $R$、$R^{-1}$ 以及 $A_n(U_i)$ 的特征值。\n2.  将 $(U_e - U_i)$ 投影到特征上，将出射分量置零，并重构 $U_b$。\n3.  将 $U_b$ 转换为 $(\\rho_b,u_b,p_b,T_b)$。\n4.  根据指定的边界类型构建一致的虚拟值，并使用上面定义的二阶中心近似计算 $\\tau_n$ 和 $q_n$。\n\n您的实现必须使用一套单一的空气材料属性常量来处理以下测试套件：$\\gamma = 1.4$，$R_{\\text{gas}} = 287\\,\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$，$\\mu = 1.8\\times 10^{-5}\\,\\mathrm{Pa}\\cdot \\mathrm{s}$，$k = 2.5\\times 10^{-2}\\,\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$，以及 $\\Delta n = 1.0\\times 10^{-3}\\,\\mathrm{m}$。所有量和输出都必须采用国际标准（SI）单位。\n\n测试用例（右边界，外向法向量 $n=+1$）：\n- 用例 $1$（亚音速流出）：内部状态 $(\\rho_i,u_i,p_i) = (1.0,150.0,1.0\\times 10^{5})$，外部状态 $(\\rho_e,u_e,p_e) = (1.0,150.0,9.0\\times 10^{4})$。\n- 用例 $2$（亚音速流入）：内部状态 $(\\rho_i,u_i,p_i) = (1.2,-50.0,1.0\\times 10^{5})$，外部状态 $(\\rho_e,u_e,p_e) = (1.1,-60.0,1.05\\times 10^{5})$。\n- 用例 $3$（超音速流出）：内部状态 $(\\rho_i,u_i,p_i) = (1.0,500.0,1.0\\times 10^{5})$，外部状态 $(\\rho_e,u_e,p_e) = (0.9,520.0,0.95\\times 10^{5})$。\n- 用例 $4$（超音速流入）：内部状态 $(\\rho_i,u_i,p_i) = (1.0,-500.0,1.0\\times 10^{5})$，外部状态 $(\\rho_e,u_e,p_e) = (1.1,-520.0,1.05\\times 10^{5})$。\n- 用例 $5$（等温无滑移壁面）：内部状态 $(\\rho_i,u_i,p_i) = (1.2,20.0,1.0\\times 10^{5})$，壁面温度 $T_w = 300.0$；按所述使用等温壁面处理。对于此用例，通过强制 $u_b=0$、$T_b=T_w$、$p_b=p_i$ 和 $\\rho_b = p_b/(R_{\\text{gas}}T_b)$ 来设置 $(\\rho_b,u_b,p_b,T_b)$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表。每个测试用例的结果必须是 $[\\rho_b,u_b,p_b,T_b,\\tau_n,q_n]$ 形式的列表（所有浮点数，采用SI单位），并且总输出必须是针对五个用例按给定顺序排列的 $[[\\rho_b,u_b,p_b,T_b,\\tau_n,q_n],\\dots]$。",
            "solution": "该问题要求推导并实现一种算法，用于在可压缩Navier-Stokes方程的背景下应用边界条件，特别是针对一维流动的情况。这涉及两种主要类型的边界：特征远场边界和固壁边界。解决方案将系统地呈现，在最终形成计算算法之前，详细说明必要的理论公式。\n\n首先，我们建立原始变量 $(\\rho, u, p)$ 与守恒变量 $U=[\\rho, \\rho u, \\rho E]^{\\top}$ 之间的关系，其中 $\\rho$ 是密度，$u$ 是速度，$p$ 是压力，$E$ 是比总能。对于理想气体，压力与比内能 $e$ 通过 $p = (\\gamma-1)\\rho e$ 相关，其中 $\\gamma$ 是比热比。比总能是内能和动能之和，$E = e + \\frac{1}{2}u^2$。代入 $e$，我们得到 $E = \\frac{p}{(\\gamma-1)\\rho} + \\frac{1}{2}u^2$。\n\n转换如下：\n1.  **原始变量到守恒变量**：给定 $(\\rho, u, p)$，守恒变量向量 $U$ 计算如下：\n    $$ U_1 = \\rho $$\n    $$ U_2 = \\rho u $$\n    $$ U_3 = \\rho E = \\rho \\left( \\frac{p}{(\\gamma-1)\\rho} + \\frac{1}{2}u^2 \\right) = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2 $$\n2.  **守恒变量到原始变量**：给定 $U=[U_1, U_2, U_3]^{\\top}$，原始变量 $(\\rho, u, p)$ 恢复如下：\n    $$ \\rho = U_1 $$\n    $$ u = U_2 / U_1 $$\n    $$ p = (\\gamma-1)\\left( U_3 - \\frac{1}{2}\\rho u^2 \\right) = (\\gamma-1)\\left( U_3 - \\frac{1}{2}\\frac{U_2^2}{U_1} \\right) $$\n\n此外，我们需要温度 $T$、声速 $a$ 和比总焓 $H$ 的表达式：\n*   温度：$T = p / (\\rho R_{\\text{gas}})$，来自理想气体定律 $p=\\rho R_{\\text{gas}} T$，其中 $R_{\\text{gas}}$ 是特定气体常数。\n*   声速：$a = \\sqrt{\\gamma p / \\rho}$。\n*   比总焓：$H = E + p/\\rho$。代入 $E$ 的表达式，我们得到 $H = \\left(\\frac{p}{(\\gamma-1)\\rho} + \\frac{1}{2}u^2\\right) + \\frac{p}{\\rho} = \\frac{\\gamma p}{(\\gamma-1)\\rho} + \\frac{1}{2}u^2$。这等价于 $H = \\frac{a^2}{\\gamma-1} + \\frac{1}{2}u^2$。\n\n**第一部分：特征边界条件（用例1-4）**\n\n特征边界条件基于信息沿特征波的传播，由无粘通量雅可比矩阵 $A_n(U) = n \\, \\partial F / \\partial U$ 的特征值和特征向量描述。对于外法线为 $n$ 的一维流动，特征值为 $\\lambda_1 = n(u-a)$、$\\lambda_2 = nu$ 和 $\\lambda_3 = n(u+a)$。相应的右特征向量作为矩阵 $R$ 的列给出：\n$$ R = [r_1, r_2, r_3] = \\begin{pmatrix} 1  1  1 \\\\ u-a  u  u+a \\\\ H-ua  \\frac{1}{2}u^2  H+ua \\end{pmatrix} $$\n该算法要求将外部目标状态 $U_e$ 和内部状态 $U_i$ 之间的差值，即 $\\Delta U = U_e - U_i$，投影到特征场上。这通过计算特征振幅 $\\alpha = R_i^{-1} \\Delta U$ 来实现，其中 $R_i^{-1}$ 是在内部状态下评估的右特征向量矩阵的逆。必须推导出逆矩阵 $R^{-1}$。通过代数求逆可以证明：\n$$ R^{-1} = \\frac{\\gamma-1}{2a^2} \\begin{pmatrix}\n\\frac{u^2}{2} + \\frac{ua}{\\gamma-1}  -u - \\frac{a}{\\gamma-1}  1 \\\\\n\\frac{2a^2}{\\gamma-1} - u^2  2u  -2 \\\\\n\\frac{u^2}{2} - \\frac{ua}{\\gamma-1}  -u + \\frac{a}{\\gamma-1}  1\n\\end{pmatrix} $$\n特征值的符号（在内部状态 $U_i$ 处评估）决定了哪些特征是入射到计算域的（$\\lambda_k  0$），哪些是出射的（$\\lambda_k > 0$）。入射波的信息来自外部状态，而出射波的信息来自内部状态。这通过构建一个修正的振幅向量 $\\tilde{\\alpha}$ 来强制执行，其中对应于出射波的分量被置零：\n$$ \\tilde{\\alpha}_k = \\begin{cases} \\alpha_k  \\text{if } \\lambda_k  0 \\\\ 0  \\text{if } \\lambda_k \\ge 0 \\end{cases} $$\n边界处的状态 $U_b$ 随后通过将入射特征波的贡献加到内部状态上来重构：\n$$ U_b = U_i + R_i \\tilde{\\alpha} $$\n然后将该向量 $U_b$ 转换回原始变量 $(\\rho_b, u_b, p_b)$ 和温度 $T_b$。\n\n对于远场边界的粘性项，施加零梯度条件。这意味着虚拟单元的状态是内部状态的简单外推，即 $u_g = u_i$ 和 $T_g = T_i$。使用给定的中心差分公式，这导致零梯度，从而得到零粘性通量：\n$$ \\tau_n = \\mu \\frac{u_i - u_g}{\\Delta n} = \\mu \\frac{u_i - u_i}{\\Delta n} = 0 $$\n$$ q_n = -k \\frac{T_i - T_g}{\\Delta n} = -k \\frac{T_i - T_i}{\\Delta n} = 0 $$\n\n**第二部分：等温无滑移壁面边界条件（用例5）**\n\n对于固壁，边界状态不是由特征分析确定，而是由物理约束确定。问题为等温无滑移壁面指定了以下条件：\n*   边界速度：$u_b = 0$。\n*   边界温度：$T_b = T_w$，规定的壁面温度。\n*   边界压力：假设法向压力梯度为零，因此 $p_b = p_i$。\n*   边界密度：由理想气体定律推导得出，$\\rho_b = p_b / (R_{\\text{gas}} T_b)$。\n\n粘性通量，即剪切应力 $\\tau_n$ 和热通量 $q_n$，使用虚拟单元方法计算，以近似壁面处的梯度。构建虚拟单元值以二阶精度强制执行壁面条件。\n*   对于无滑移条件（壁面处 $u=0$）：$u_g = -u_i$。这确保了在壁面位置（内部和虚拟单元之间中点）插值的速度为零。\n*   对于等温条件（壁面处 $T=T_w$）：$T_g = 2T_w - T_i$。这确保了在壁面位置插值的温度为 $T_w$。\n\n然后使用指定的中心差分公式来近似梯度，这等效于从内部到壁面的二阶单边差分：\n$$ \\frac{\\partial u}{\\partial n} \\approx \\frac{u_i - u_g}{\\Delta n} = \\frac{u_i - (-u_i)}{\\Delta n} = \\frac{2u_i}{\\Delta n} $$\n$$ \\frac{\\partial T}{\\partial n} \\approx \\frac{T_i - T_g}{\\Delta n} = \\frac{T_i - (2T_w - T_i)}{\\Delta n} = \\frac{2(T_i - T_w)}{\\Delta n} $$\n剪切应力和热通量则为：\n$$ \\tau_n = \\mu \\left( \\frac{2u_i}{\\Delta n} \\right) $$\n$$ q_n = -k \\left( \\frac{2(T_i - T_w)}{\\Delta n} \\right) $$\n\n**算法摘要**\n\n最终的算法按如下方式处理每个测试用例：\n1.  读取用例参数：内部状态、外部状态（如果适用）、边界类型和法向量。\n2.  如果边界类型是特征边界（用例1-4）：\n    a.  将内部 $(\\rho_i, u_i, p_i)$ 和外部 $(\\rho_e, u_e, p_e)$ 的原始状态转换为守恒向量 $U_i$ 和 $U_e$。\n    b.  根据内部状态计算热力学性质（$a_i, H_i$）。\n    c.  构建特征向量矩阵 $R_i$ 和 $R_i^{-1}$。\n    d.  计算内部状态的特征值 $\\lambda_k$。\n    e.  计算 $\\Delta U = U_e - U_i$ 和特征振幅 $\\alpha = R_i^{-1} \\Delta U$。\n    f.  将 $\\alpha$ 中对应于出射波（$\\lambda_k \\ge 0$）的分量置零，形成 $\\tilde{\\alpha}$。\n    g.  重构边界状态 $U_b = U_i + R_i \\tilde{\\alpha}$。\n    h.  将 $U_b$ 转换为原始变量 $(\\rho_b, u_b, p_b)$ 和温度 $T_b$。\n    i.  对于远场粘性条件，设置 $\\tau_n = 0$ 和 $q_n = 0$。\n3.  如果边界类型是等温壁面（用例5）：\n    a.  直接从物理约束确定边界状态 $(\\rho_b, u_b, p_b, T_b)$：$u_b = 0$，$T_b=T_w$，$p_b=p_i$，$\\rho_b = p_b/(R_{\\text{gas}} T_b)$。\n    b.  从 $(\\rho_i, u_i, p_i)$ 计算内部温度 $T_i$。\n    c.  使用等温壁面的虚拟单元公式计算剪切应力 $\\tau_n$ 和热通量 $q_n$。\n4.  整合当前用例的六个输出量 $[\\rho_b, u_b, p_b, T_b, \\tau_n, q_n]$。\n5.  处理完所有用例后，将收集到的结果格式化为指定的单行输出。\n\n此过程在以下Python代码中实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for boundary state variables and viscous fluxes for a suite of CFD test cases.\n    \"\"\"\n    # Define physical constants for air\n    GAMMA = 1.4\n    R_GAS = 287.0\n    MU = 1.8e-5\n    K_THERMAL = 2.5e-2\n    DN = 1.0e-3\n    \n    # --- Helper Functions for State Conversions and Properties ---\n    \n    def prim_to_cons(rho, u, p):\n        \"\"\"Converts primitive variables (rho, u, p) to conserved variables U.\"\"\"\n        rho_u = rho * u\n        rho_E = p / (GAMMA - 1.0) + 0.5 * rho * u**2\n        return np.array([rho, rho_u, rho_E])\n\n    def cons_to_prim(U):\n        \"\"\"Converts conserved variables U to primitive (rho, u, p) and T.\"\"\"\n        rho = U[0]\n        u = U[1] / rho\n        p = (GAMMA - 1.0) * (U[2] - 0.5 * rho * u**2)\n        T = p / (rho * R_GAS)\n        return rho, u, p, T\n\n    def get_thermo_properties(rho, u, p):\n        \"\"\"Calculates speed of sound 'a' and total enthalpy 'H'.\"\"\"\n        a = np.sqrt(GAMMA * p / rho)\n        # E = p / ((GAMMA - 1.0) * rho) + 0.5 * u**2\n        # H = E + p / rho\n        H = a**2/(GAMMA-1.0) + 0.5 * u**2\n        return a, H\n\n    def get_eigenmatrices(u, a, H):\n        \"\"\"Constructs the right eigenvector matrix R and its inverse R_inv.\"\"\"\n        # Right eigenvector matrix R\n        R = np.array([\n            [1.0, 1.0, 1.0],\n            [u - a, u, u + a],\n            [H - u * a, 0.5 * u**2, H + u * a]\n        ])\n\n        # Inverse of R\n        inv_factor = (GAMMA - 1.0) / (2.0 * a**2)\n        \n        # Elements of B = R_inv / inv_factor\n        b11 = 0.5 * u**2 + (u * a) / (GAMMA - 1.0)\n        b12 = -u - a / (GAMMA - 1.0)\n        b13 = 1.0\n        \n        b21 = (2.0 * a**2) / (GAMMA - 1.0) - u**2\n        b22 = 2.0 * u\n        b23 = -2.0\n        \n        b31 = 0.5 * u**2 - (u * a) / (GAMMA - 1.0)\n        b32 = -u + a / (GAMMA - 1.0)\n        b33 = 1.0\n\n        R_inv = inv_factor * np.array([\n            [b11, b12, b13],\n            [b21, b22, b23],\n            [b31, b32, b33]\n        ])\n        \n        return R, R_inv\n\n    # --- Boundary Condition Handlers ---\n    \n    def handle_characteristic_bc(prim_i, prim_e, n):\n        \"\"\"Handles characteristic far-field boundary conditions.\"\"\"\n        rho_i, u_i, p_i = prim_i\n        rho_e, u_e, p_e = prim_e\n\n        # Interior state properties\n        U_i = prim_to_cons(rho_i, u_i, p_i)\n        a_i, H_i = get_thermo_properties(rho_i, u_i, p_i)\n        \n        # Eigen-system based on interior state\n        R_i, R_inv_i = get_eigenmatrices(u_i, a_i, H_i)\n        \n        # Eigenvalues\n        lambdas = n * np.array([u_i - a_i, u_i, u_i + a_i])\n        \n        # Characteristic projection\n        U_e = prim_to_cons(rho_e, u_e, p_e)\n        delta_U = U_e - U_i\n        alpha = R_inv_i @ delta_U\n        \n        # Filter outgoing characteristics\n        alpha_tilde = np.where(lambdas  0, alpha, 0.0)\n        \n        # Reconstruct boundary state\n        U_b = U_i + R_i @ alpha_tilde\n        rho_b, u_b, p_b, T_b = cons_to_prim(U_b)\n        \n        # Viscous fluxes for far-field (zero-gradient)\n        tau_n = 0.0\n        q_n = 0.0\n        \n        return [rho_b, u_b, p_b, T_b, tau_n, q_n]\n\n    def handle_isothermal_wall_bc(prim_i, T_w):\n        \"\"\"Handles isothermal no-slip wall boundary condition.\"\"\"\n        rho_i, u_i, p_i = prim_i\n\n        # Boundary state from physical constraints\n        u_b = 0.0\n        p_b = p_i\n        T_b = T_w\n        rho_b = p_b / (R_GAS * T_b)\n        \n        # Compute viscous fluxes using ghost-cell method\n        # Gradients are approximated as (val_i - val_g) / dn\n        \n        # Shear stress\n        # u_g = -u_i to enforce u_wall = (u_i+u_g)/2 = 0\n        dudn = (u_i - (-u_i)) / DN\n        tau_n = MU * dudn\n        \n        # Heat flux\n        # T_g = 2*T_w - T_i to enforce T_wall = (T_i+T_g)/2 = T_w\n        T_i = p_i / (rho_i * R_GAS)\n        dTdn = (T_i - (2 * T_w - T_i)) / DN\n        q_n = -K_THERMAL * dTdn\n        \n        return [rho_b, u_b, p_b, T_b, tau_n, q_n]\n\n    # --- Main Execution ---\n\n    test_cases = [\n        # Case 1 (subsonic outflow)\n        ( (1.0, 150.0, 1.0e5), (1.0, 150.0, 9.0e4), None, 'char' ),\n        # Case 2 (subsonic inflow)\n        ( (1.2, -50.0, 1.0e5), (1.1, -60.0, 1.05e5), None, 'char' ),\n        # Case 3 (supersonic outflow)\n        ( (1.0, 500.0, 1.0e5), (0.9, 520.0, 0.95e5), None, 'char' ),\n        # Case 4 (supersonic inflow)\n        ( (1.0, -500.0, 1.0e5), (1.1, -520.0, 1.05e5), None, 'char' ),\n        # Case 5 (isothermal no-slip wall)\n        ( (1.2, 20.0, 1.0e5), None, 300.0, 'wall' )\n    ]\n\n    results = []\n    n_normal = 1.0 # Outward normal for all cases\n\n    for prim_i, prim_e, T_w, bc_type in test_cases:\n        if bc_type == 'char':\n            result = handle_characteristic_bc(prim_i, prim_e, n_normal)\n        elif bc_type == 'wall':\n            result = handle_isothermal_wall_bc(prim_i, T_w)\n        \n        # Convert numpy array to list for standard string representation\n        results.append(result)\n\n    # Format the final output string\n    # map(str, results) converts each inner list to its string representation\n    # e.g., [1.0, 2.0] -> '[1.0, 2.0]'\n    formatted_results = \",\".join(map(str, results))\n    print(f\"[{formatted_results}]\")\n\nsolve()\n```"
        }
    ]
}