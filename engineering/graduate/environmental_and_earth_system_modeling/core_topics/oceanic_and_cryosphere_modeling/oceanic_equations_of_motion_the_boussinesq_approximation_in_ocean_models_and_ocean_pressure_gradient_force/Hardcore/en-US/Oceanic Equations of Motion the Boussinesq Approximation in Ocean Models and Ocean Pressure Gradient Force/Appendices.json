{
    "hands_on_practices": [
        {
            "introduction": "To begin, we translate the abstract theory of the pressure gradient force into a concrete analytical result. This exercise guides you through a first-principles derivation of the geostrophic flow resulting from a simple, prescribed density stratification. By completing this calculation, you will solidify your understanding of how horizontal density gradients are fundamentally linked to the vertical shear of ocean currents, a relationship known as the thermal wind balance .",
            "id": "3902109",
            "problem": "Consider an inviscid, steady, rotating ocean on an $f$-plane with constant Coriolis parameter $f0$, subject to the Boussinesq approximation (constant reference density in inertia and continuity, variable density only in the buoyancy term) and hydrostatic balance. Use a Cartesian coordinate system with horizontal coordinates $(x,y)$ and vertical coordinate $z$ positive upward, with the ocean surface at $z=0$ (rigid-lid and horizontally uniform surface pressure) and a flat bottom at $z=-H$, where $H0$ is constant. Gravity is $\\mathbf{g}=-g\\,\\hat{\\mathbf{z}}$ with $g0$. The density field is prescribed as\n$${\\rho}(x,y,z)=\\rho_{0}+A\\,y+B\\,z,$$\nwhere $\\rho_{0}0$ is a constant reference density and $A$ and $B$ are uniform constants.\n\nStarting from first principles (Newton’s second law, geostrophic balance for the horizontal momentum under steady conditions, and hydrostatic balance in the vertical), do the following:\n\n1) Derive the horizontal pressure gradient $\\nabla_{h}p(x,y,z)$ implied by hydrostatic balance and the given density field, assuming a horizontally uniform surface pressure at $z=0$.\n\n2) Define the baroclinic pressure gradient force (PGF) per unit mass as the depth-varying part of the horizontal pressure gradient force with zero depth-mean:\n$$\\mathbf{F}_{\\mathrm{bc}}(z)\\equiv -\\frac{1}{\\rho_{0}}\\left[\\nabla_{h}p(z)-\\frac{1}{H}\\int_{-H}^{0}\\nabla_{h}p(\\zeta)\\,d\\zeta\\right].$$\nCompute $\\mathbf{F}_{\\mathrm{bc}}(z)$ explicitly for the prescribed density field.\n\n3) Using geostrophic balance for the baroclinic component of the flow,\n$$f\\,\\hat{\\mathbf{z}}\\times \\mathbf{u}_{\\mathrm{bc}}(z)=\\mathbf{F}_{\\mathrm{bc}}(z),$$\ndetermine the horizontal baroclinic geostrophic velocity profile $\\mathbf{u}_{\\mathrm{bc}}(z)=(u_{\\mathrm{bc}}(z),v_{\\mathrm{bc}}(z))$ that has zero depth-mean over $[-H,0]$. Express your final answer as a single closed-form analytic expression for $\\mathbf{u}_{\\mathrm{bc}}(z)$ in terms of $A$, $B$, $f$, $g$, $\\rho_{0}$, $H$, and $z$. Use International System of Units (SI units) for all quantities.\n\nYour final answer must be the expression for $\\mathbf{u}_{\\mathrm{bc}}(z)$ only. No numerical evaluation is required.",
            "solution": "The user wants to derive the baroclinic geostrophic velocity profile for a given density field in an idealized ocean model. The problem is scientifically sound, well-posed, and contains all necessary information for a unique solution. The solution will be derived by following the three specified steps.\n\nThe problem is governed by the principles of hydrostatic and geostrophic balance under the Boussinesq approximation. The Cartesian coordinate system is defined with $(x,y)$ as horizontal coordinates and $z$ as the vertical coordinate, positive upward. The ocean surface is at $z=0$ and the flat bottom is at $z=-H$.\n\n**1) Derivation of the horizontal pressure gradient $\\nabla_{h}p(x,y,z)$**\n\nThe vertical momentum equation under hydrostatic balance is:\n$$ \\frac{\\partial p}{\\partial z} = -\\rho g $$\nThe density field is given as $\\rho(x,y,z) = \\rho_{0} + A\\,y + B\\,z$. Substituting this into the hydrostatic equation gives:\n$$ \\frac{\\partial p}{\\partial z} = -g(\\rho_{0} + A\\,y + B\\,z) $$\nTo find the pressure field $p(x,y,z)$, we integrate this equation with respect to $z$ from a generic depth $z$ to the surface at $z'=0$.\n$$ \\int_{z}^{0} \\frac{\\partial p}{\\partial z'} dz' = \\int_{z}^{0} -g(\\rho_{0} + A\\,y + B\\,z') dz' $$\n$$ p(x,y,0) - p(x,y,z) = -g \\left[ (\\rho_{0} + A\\,y)z' + \\frac{1}{2}Bz'^{2} \\right]_{z}^{0} $$\nThe problem states that the surface pressure is horizontally uniform. We can denote it as a constant, $p(x,y,0) = p_{s}$.\n$$ p_{s} - p(x,y,z) = -g \\left( 0 - \\left( (\\rho_{0} + A\\,y)z + \\frac{1}{2}Bz^{2} \\right) \\right) $$\n$$ p(x,y,z) = p_{s} - g \\left( (\\rho_{0} + A\\,y)z + \\frac{1}{2}Bz^{2} \\right) $$\nThe horizontal pressure gradient is $\\nabla_{h}p = \\hat{\\mathbf{x}}\\frac{\\partial p}{\\partial x} + \\hat{\\mathbf{y}}\\frac{\\partial p}{\\partial y}$. We compute the partial derivatives of $p(x,y,z)$ with respect to $x$ and $y$:\n$$ \\frac{\\partial p}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ p_{s} - g\\rho_{0}z - gAyz - \\frac{1}{2}gBz^{2} \\right] = 0 $$\n$$ \\frac{\\partial p}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ p_{s} - g\\rho_{0}z - gAyz - \\frac{1}{2}gBz^{2} \\right] = -gAz $$\nThus, the horizontal pressure gradient is a function of depth $z$ only:\n$$ \\nabla_{h}p(z) = -gAz\\,\\hat{\\mathbf{y}} $$\n\n**2) Computation of the baroclinic pressure gradient force $\\mathbf{F}_{\\mathrm{bc}}(z)$**\n\nThe baroclinic pressure gradient force per unit mass, $\\mathbf{F}_{\\mathrm{bc}}(z)$, is defined as the deviation of the horizontal PGF from its depth-mean (barotropic) value:\n$$ \\mathbf{F}_{\\mathrm{bc}}(z) \\equiv -\\frac{1}{\\rho_{0}}\\left[\\nabla_{h}p(z) - \\frac{1}{H}\\int_{-H}^{0}\\nabla_{h}p(\\zeta)\\,d\\zeta\\right] $$\nFirst, we compute the depth-averaged horizontal pressure gradient, which represents the barotropic component:\n$$ \\overline{\\nabla_{h}p} = \\frac{1}{H}\\int_{-H}^{0}\\nabla_{h}p(\\zeta)\\,d\\zeta = \\frac{1}{H}\\int_{-H}^{0} (-gA\\zeta\\,\\hat{\\mathbf{y}}) \\,d\\zeta $$\n$$ \\overline{\\nabla_{h}p} = -\\frac{gA\\hat{\\mathbf{y}}}{H} \\int_{-H}^{0} \\zeta\\,d\\zeta = -\\frac{gA\\hat{\\mathbf{y}}}{H} \\left[ \\frac{1}{2}\\zeta^{2} \\right]_{-H}^{0} = -\\frac{gA\\hat{\\mathbf{y}}}{H} \\left( 0 - \\frac{1}{2}(-H)^{2} \\right) = \\frac{gAH}{2}\\hat{\\mathbf{y}} $$\nNow, we substitute $\\nabla_{h}p(z)$ and $\\overline{\\nabla_{h}p}$ into the definition of $\\mathbf{F}_{\\mathrm{bc}}(z)$:\n$$ \\mathbf{F}_{\\mathrm{bc}}(z) = -\\frac{1}{\\rho_{0}} \\left[ -gAz\\,\\hat{\\mathbf{y}} - \\frac{gAH}{2}\\hat{\\mathbf{y}} \\right] $$\n$$ \\mathbf{F}_{\\mathrm{bc}}(z) = \\frac{gA}{\\rho_{0}} \\left( z + \\frac{H}{2} \\right) \\hat{\\mathbf{y}} $$\nThis expression gives the baroclinic PGF. Note that the constant $B$ from the density definition does not appear, as the geostrophic flow is driven by horizontal density gradients, not vertical ones.\n\n**3) Determination of the baroclinic geostrophic velocity $\\mathbf{u}_{\\mathrm{bc}}(z)$**\n\nThe baroclinic component of the geostrophic flow, $\\mathbf{u}_{\\mathrm{bc}}(z) = u_{\\mathrm{bc}}(z)\\hat{\\mathbf{x}} + v_{\\mathrm{bc}}(z)\\hat{\\mathbf{y}}$, is determined by the balance between the Coriolis force and the baroclinic PGF:\n$$ f\\,\\hat{\\mathbf{z}}\\times \\mathbf{u}_{\\mathrm{bc}}(z) = \\mathbf{F}_{\\mathrm{bc}}(z) $$\nwhere $f$ is the Coriolis parameter. The cross product is $f\\,\\hat{\\mathbf{z}}\\times (u_{\\mathrm{bc}}\\hat{\\mathbf{x}} + v_{\\mathrm{bc}}\\hat{\\mathbf{y}}) = f(u_{\\mathrm{bc}}\\hat{\\mathbf{y}} - v_{\\mathrm{bc}}\\hat{\\mathbf{x}})$.\nSubstituting the expression for $\\mathbf{F}_{\\mathrm{bc}}(z)$:\n$$ -f v_{\\mathrm{bc}}(z)\\,\\hat{\\mathbf{x}} + f u_{\\mathrm{bc}}(z)\\,\\hat{\\mathbf{y}} = \\frac{gA}{\\rho_{0}} \\left( z + \\frac{H}{2} \\right) \\hat{\\mathbf{y}} $$\nEquating the vector components:\nThe $\\hat{\\mathbf{x}}$ component gives:\n$$ -f v_{\\mathrm{bc}}(z) = 0 \\quad \\implies \\quad v_{\\mathrm{bc}}(z) = 0 $$\nThe $\\hat{\\mathbf{y}}$ component gives:\n$$ f u_{\\mathrm{bc}}(z) = \\frac{gA}{\\rho_{0}} \\left( z + \\frac{H}{2} \\right) \\quad \\implies \\quad u_{\\mathrm{bc}}(z) = \\frac{gA}{f\\rho_{0}} \\left( z + \\frac{H}{2} \\right) $$\nThe resulting baroclinic velocity profile is purely zonal (in the $x$-direction). The definition of $\\mathbf{F}_{\\mathrm{bc}}(z)$ ensures that it has zero depth-mean, and therefore $\\mathbf{u}_{\\mathrm{bc}}(z)$ also has zero depth-mean, as required.\n\nThe final expression for the baroclinic geostrophic velocity is:\n$$ \\mathbf{u}_{\\mathrm{bc}}(z) = \\frac{gA}{f\\rho_{0}} \\left( z + \\frac{H}{2} \\right) \\hat{\\mathbf{x}} $$\nRepresenting the horizontal velocity components $(u_{\\mathrm{bc}}, v_{\\mathrm{bc}})$ as a row matrix gives the final answer.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{gA}{f\\rho_{0}} \\left( z + \\frac{H}{2} \\right)  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from the continuous world of analytical equations to the discrete world of numerical models presents significant challenges. This practice exposes a critical and classic numerical artifact known as the spurious Pressure Gradient Force (PGF) error, which arises in models that use terrain-following (or sigma) coordinates. By simulating a resting, stratified ocean over a slope, you will quantify how an incorrect numerical formulation can generate artificial currents, providing a crucial lesson in the careful implementation of physical laws in computational models .",
            "id": "3902083",
            "problem": "Consider a one-dimensional slope in the horizontal coordinate $x$ with bottom depth $H(x)$ and a resting ocean with stable linear stratification under the Boussinesq approximation. Define the sigma-coordinate (also called terrain-following coordinate) by $z = \\sigma H(x)$ with $\\sigma \\in [-1,0]$, where $\\sigma = -1$ denotes the bottom and $\\sigma = 0$ denotes the surface, and assume a flat free surface $\\eta = 0$. The density profile is given by $\\rho(z) = \\rho_0 + \\gamma (-z)$, with $\\rho_0$ the reference density and $\\gamma  0$ a constant linear stratification parameter. The flow is hydrostatic, i.e., $\\partial p/\\partial z = -\\rho g$, where $p$ is pressure and $g$ is gravitational acceleration. Pressure Gradient Force (PGF) is the horizontal force per unit mass given by $-(1/\\rho_0)\\,\\partial p/\\partial x$ in the Boussinesq approximation.\n\nIn the continuous limit with $\\eta = 0$, a resting ocean with density depending only on the geometric vertical coordinate $z$ has zero horizontal PGF for any smooth bottom slope, provided all metric terms are treated exactly. However, in discrete sigma-coordinate ocean models, spurious PGF errors can arise when hydrostatic pressure is computed by integrating density along sigma layers in columns with different bottom depths and then differenced horizontally at constant $\\sigma$. These errors can induce artificial currents even in a theoretically resting state.\n\nStarting from first principles and the above definitions:\n- Use the hydrostatic relation and the sigma mapping to derive how discrete hydrostatic pressure at sigma interfaces is obtained by numerical quadrature in each column with $N$ uniformly spaced sigma layers of thickness $\\Delta \\sigma = 1/N$.\n- Show how the discrete horizontal PGF at a given depth arises when pressures at the same sigma level from adjacent columns are differenced and divided by the grid spacing $\\Delta x$.\n- Assume a linear drag with coefficient $r$ (in $\\mathrm{s^{-1}}$) in the horizontal momentum equation, so that the one-dimensional velocity response $u(t)$ to a constant spurious acceleration $a$ satisfies $\\mathrm{d}u/\\mathrm{d}t = a - r u$ with initial condition $u(0) = 0$. Use this to predict the spurious current magnitude after a finite time $T$.\n\nYour program must:\n1. Implement the discrete hydrostatic pressure in each column by summing over sigma layers:\n   - For a column of depth $H$, define layer midpoints at $\\sigma_k = -1 + (k + 1/2)\\Delta \\sigma$ for $k = 0,\\dots,N-1$, geometric mid-depths $z_k = \\sigma_k H$, and layer thickness in geometric coordinates $\\Delta z = H/N$.\n   - Approximate the pressure at sigma interfaces $p_j$ for $j = 0,\\dots,N$ by a downward cumulative sum of $g\\,\\rho(z_k)\\,\\Delta z$, i.e., $p_N = 0$ at the surface and $p_j = \\sum_{k=j}^{N-1} g\\,\\rho(z_k)\\,\\Delta z$.\n2. Quantify the spurious acceleration by horizontally differencing pressures at the same sigma interface between two adjacent columns of depths $H_L$ and $H_R = H_L + s\\,\\Delta x$, where $s$ is the prescribed bottom slope, and then interpolating the interface-based acceleration to layer midpoints. Compute the predicted spurious current magnitude in $\\mathrm{m/s}$ at time $T$ using the linear drag model $u(t) = (a/r)\\left(1 - e^{-r t}\\right)$, and report the depth-average of the absolute value $|u|$ as the spurious current magnitude.\n3. Propose and compute a diagnostic that can detect spurious PGF errors independent of the velocity calculation: evaluate the maximum difference of discretely integrated hydrostatic pressure at common geometric depths across the two columns. Specifically, for $M$ common geometric depths $z_i$ uniformly spaced in $[-H_{\\min}, 0]$, where $H_{\\min} = \\min(H_L,H_R)$, linearly interpolate each column’s interface pressures $p_j$ versus $z_j = \\sigma_j H$ to $p^{(L)}(z_i)$ and $p^{(R)}(z_i)$, then compute\n$$\n\\Delta p_{\\max} = \\max_i \\left| p^{(R)}(z_i) - p^{(L)}(z_i) \\right|.\n$$\nReport the dimensionless diagnostic\n$$\nD = \\frac{\\Delta p_{\\max}}{\\rho_0 g H_{\\mathrm{mean}}},\n$$\nwhere $H_{\\mathrm{mean}} = \\frac{H_L + H_R}{2}$.\n\nUse the following physically plausible constants and parameters, which must be explicitly adopted in all computations:\n- Gravitational acceleration $g = 9.81\\,\\mathrm{m/s^2}$.\n- Reference density $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$ unless specified otherwise.\n- Linear drag coefficient $r$ as given per test case.\n- Stratification parameter $\\gamma$ in $\\mathrm{kg\\,m^{-4}}$.\n- Grid spacing $\\Delta x$ in $\\mathrm{m}$.\n- Time $T$ in $\\mathrm{s}$.\n- Number of sigma layers $N$ as an integer.\n\nTest Suite. For each test case, compute and return two quantities:\n- Depth-averaged spurious current magnitude in $\\mathrm{m/s}$ rounded to six decimal places.\n- Dimensionless diagnostic $D$ rounded to six decimal places.\n\nUse the following test cases, each specified as the tuple $(H_L, s, \\Delta x, N, \\gamma, r, T, \\rho_0)$ with units:\n- Test 1 (happy path, no slope): $(1000\\,\\mathrm{m}, 0.0, 10000\\,\\mathrm{m}, 20, 0.0010\\,\\mathrm{kg\\,m^{-4}}, 1.0\\times 10^{-4}\\,\\mathrm{s^{-1}}, 3600\\,\\mathrm{s}, 1025\\,\\mathrm{kg/m^3})$.\n- Test 2 (coarse resolution, gentle slope): $(1000\\,\\mathrm{m}, 0.0010, 10000\\,\\mathrm{m}, 10, 0.0010\\,\\mathrm{kg\\,m^{-4}}, 1.0\\times 10^{-4}\\,\\mathrm{s^{-1}}, 3600\\,\\mathrm{s}, 1025\\,\\mathrm{kg/m^3})$.\n- Test 3 (finer resolution, same slope): $(1000\\,\\mathrm{m}, 0.0010, 10000\\,\\mathrm{m}, 40, 0.0010\\,\\mathrm{kg\\,m^{-4}}, 1.0\\times 10^{-4}\\,\\mathrm{s^{-1}}, 3600\\,\\mathrm{s}, 1025\\,\\mathrm{kg/m^3})$.\n- Test 4 (deep ocean, steeper slope, stronger stratification): $(3000\\,\\mathrm{m}, 0.0030, 10000\\,\\mathrm{m}, 20, 0.0015\\,\\mathrm{kg\\,m^{-4}}, 1.0\\times 10^{-4}\\,\\mathrm{s^{-1}}, 3600\\,\\mathrm{s}, 1025\\,\\mathrm{kg/m^3})$.\n- Test 5 (shallow shelf, steep slope): $(200\\,\\mathrm{m}, 0.0050, 5000\\,\\mathrm{m}, 10, 0.0005\\,\\mathrm{kg\\,m^{-4}}, 1.0\\times 10^{-4}\\,\\mathrm{s^{-1}}, 3600\\,\\mathrm{s}, 1025\\,\\mathrm{kg/m^3})$.\n\nFinal Output Format. Your program should produce a single line of output containing the results for all test cases as a comma-separated list of lists, with each inner list containing the two floats $[u_{\\mathrm{avg}}, D]$ rounded to six decimal places, enclosed in square brackets. For example, a valid output format is $[[0.000123,0.000456],[\\dots,\\dots],\\dots]$. All reported currents must be expressed in $\\mathrm{m/s}$ and all diagnostics are dimensionless.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of geophysical fluid dynamics, specifically concerning numerical artifacts in ocean models. It is well-posed, providing a clear, self-contained, and logically consistent set of instructions and parameters to compute a unique solution. The language is objective and precise.\n\nThe core of the problem is to quantify the spurious horizontal Pressure Gradient Force (PGF) that arises in terrain-following (sigma-coordinate) ocean models over variable topography, even when the ocean is physically at rest.\n\nFirst, we establish the continuous-case baseline. In a resting ocean with density $\\rho$ depending only on the geometric vertical coordinate $z$, $\\rho = \\rho(z)$, the hydrostatic pressure is given by integrating the hydrostatic balance equation $\\partial p/\\partial z = -\\rho g$. With the free surface at $z=0$ and setting the surface gauge pressure to $0$, the pressure at any depth $z$ is $p(z) = g \\int_z^0 \\rho(z') dz'$. The horizontal PGF, under the Boussinesq approximation, is defined as the pressure gradient at a constant depth $z$, normalized by the reference density $\\rho_0$: $PGF_x = -(1/\\rho_0) (\\partial p/\\partial x)|_z$. Since $p$ is a function of $z$ only, its partial derivative with respect to $x$ at constant $z$ is identically zero, i.e., $(\\partial p/\\partial x)|_z = 0$. Therefore, in an idealized, continuous, resting ocean, the horizontal PGF is zero everywhere, regardless of the bottom topography $H(x)$. No motion should be generated.\n\nNumerical models, however, can violate this principle. The provided problem describes a common discretization scheme based on a sigma-coordinate system, $z = \\sigma H(x)$, where $\\sigma \\in [-1, 0]$. Here, $\\sigma=0$ is always the sea surface and $\\sigma=-1$ is always the sea floor. The vertical column is divided into $N$ layers of uniform thickness $\\Delta\\sigma = 1/N$.\n\nThe hydrostatic pressure is computed numerically in each vertical column. For a column of total depth $H$, the vertical grid consists of layer midpoints at sigma levels $\\sigma_k = -1 + (k + 1/2)\\Delta\\sigma$ for $k=0, \\dots, N-1$. The corresponding geometric depths are $z_k = \\sigma_k H$. The specified numerical quadrature for pressure at a sigma interface $\\sigma_j$ (corresponding to geometric depth $z_j = \\sigma_j H$) is a simple rectangular rule, summing the weight of the water in the layers above. With layer thickness in physical units being $\\Delta z = H/N$, the pressure at interface $j$ is:\n$$ p_j = \\sum_{k=j}^{N-1} g\\,\\rho(z_k)\\,\\Delta z $$\nwhere $\\rho(z_k) = \\rho_0 - \\gamma z_k$ is the density evaluated at the layer midpoint. The sum runs from the layer just above interface $j$ up to the top layer (index $N-1$). At the surface ($j=N$), $p_N=0$.\n\nThe spurious PGF error arises when the horizontal pressure gradient is computed between two adjacent columns, say Left ($L$) and Right ($R$), with different bottom depths $H_L$ and $H_R$. The numerical PGF is calculated by differencing pressures at the *same sigma level* $j$ and dividing by the horizontal grid spacing $\\Delta x$:\n$$ PGF_j = -\\frac{1}{\\rho_0} \\frac{p_j^{(R)} - p_j^{(L)}}{\\Delta x} $$\nThe fundamental error is that, if $H_L \\neq H_R$, the interface $\\sigma_j$ corresponds to different geometric depths in the two columns: $z_j^{(L)} = \\sigma_j H_L \\neq \\sigma_j H_R = z_j^{(R)}$. Differencing pressures at these two distinct physical locations creates an artificial PGF.\n\nTo quantify the resulting motion, this interface-based PGF is interpolated to the layer midpoints. A simple average is used to find the acceleration $a_k$ in layer $k$: $a_k = (PGF_k + PGF_{k+1})/2$. Assuming a simple linear drag model, the horizontal velocity $u_k$ in layer $k$ evolves according to $\\mathrm{d}u/\\mathrm{d}t = a_k - r u$, where $r$ is a drag coefficient. With an initial condition of rest, $u_k(0)=0$, the solution is $u_k(T) = (a_k/r)(1 - e^{-rT})$. The overall magnitude of the spurious current is reported as the depth-averaged absolute velocity, $\\langle|u|\\rangle = (1/N) \\sum_{k=0}^{N-1} |u_k(T)|$.\n\nIn addition to the velocity, a velocity-independent diagnostic, $D$, is proposed to directly measure the pressure field inconsistency. This involves comparing the calculated pressure profiles from the two columns, $p^{(L)}(z)$ and $p^{(R)}(z)$, on a common, high-resolution vertical grid of geometric depths $\\{z_i\\}$ spanning the shared water column, i.e., $z_i \\in [-\\min(H_L, H_R), 0]$. The discrete pressure profiles, given as $(z_j^{(L)}, p_j^{(L)})$ and $(z_j^{(R)}, p_j^{(R)})$, are linearly interpolated to this common grid to obtain $p^{(L)}(z_i)$ and $p^{(R)}(z_i)$. The maximum absolute difference is then found:\n$$ \\Delta p_{\\max} = \\max_i | p^{(R)}(z_i) - p^{(L)}(z_i) | $$\nThis maximum pressure error is non-dimensionalized by a characteristic pressure scale, $\\rho_0 g H_{\\mathrm{mean}}$, where $H_{\\mathrm{mean}} = (H_L+H_R)/2$:\n$$ D = \\frac{\\Delta p_{\\max}}{\\rho_0 g H_{\\mathrm{mean}}} $$\nThis diagnostic $D$ provides a direct measure of the model's inability to maintain a state of rest. The implementation will proceed by systematically applying these definitions and formulae to the provided test cases. For the diagnostic calculation, a high-resolution common grid with $M=10000$ points is used to accurately approximate the maximum.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases and prints the final result.\n    \"\"\"\n\n    def calculate_spurious_effects(HL, s, dx, N, gamma, r, T, rho0):\n        \"\"\"\n        Calculates the spurious current magnitude and pressure error diagnostic\n        for a given set of parameters.\n        \n        Args:\n            HL (float): Water depth in the left column (m).\n            s (float): Bottom slope (dimensionless).\n            dx (float): Horizontal grid spacing (m).\n            N (int): Number of sigma layers.\n            gamma (float): Linear stratification parameter (kg/m^4).\n            r (float): Linear drag coefficient (1/s).\n            T (float): Total integration time (s).\n            rho0 (float): Reference density (kg/m^3).\n\n        Returns:\n            tuple: A tuple containing:\n                - u_avg (float): Depth-averaged spurious current magnitude (m/s).\n                - D (float): Dimensionless pressure error diagnostic.\n        \"\"\"\n        g = 9.81\n        HR = HL + s * dx\n\n        # --- Shared sigma-grid structure ---\n        delta_sigma = 1.0 / N\n        # Interfaces from bottom sigma=-1 (j=0) to surface sigma=0 (j=N)\n        sigma_interfaces = np.linspace(-1, 0, N + 1)\n        # Midpoints of layers, from bottom layer (k=0) to top layer (k=N-1)\n        sigma_midpoints = sigma_interfaces[:-1] + delta_sigma / 2.0\n\n        # --- Column L Calculations ---\n        z_mid_L = sigma_midpoints * HL\n        rho_mid_L = rho0 - gamma * z_mid_L\n        delta_z_L = HL / N\n        pressure_terms_L = g * rho_mid_L * delta_z_L\n        pressure_interfaces_L = np.zeros(N + 1)\n        pressure_interfaces_L[:-1] = np.cumsum(pressure_terms_L[::-1])[::-1]\n        z_interfaces_L = sigma_interfaces * HL\n\n        # --- Column R Calculations ---\n        z_mid_R = sigma_midpoints * HR\n        rho_mid_R = rho0 - gamma * z_mid_R\n        delta_z_R = HR / N\n        pressure_terms_R = g * rho_mid_R * delta_z_R\n        pressure_interfaces_R = np.zeros(N + 1)\n        pressure_interfaces_R[:-1] = np.cumsum(pressure_terms_R[::-1])[::-1]\n        z_interfaces_R = sigma_interfaces * HR\n\n        # --- Spurious Acceleration and Current ---\n        pressure_diff = pressure_interfaces_R - pressure_interfaces_L\n        pgf_interfaces = (-1.0 / rho0) * pressure_diff / dx\n        accel_midpoints = (pgf_interfaces[:-1] + pgf_interfaces[1:]) / 2.0\n        \n        if r == 0:\n            u_midpoints = accel_midpoints * T\n        else:\n            u_midpoints = (accel_midpoints / r) * (1 - np.exp(-r * T))\n        \n        u_avg = np.mean(np.abs(u_midpoints))\n\n        # --- Diagnostic D ---\n        H_min = min(HL, HR)\n        H_mean = (HL + HR) / 2.0\n        \n        # If the bottom is flat, the error is zero by construction.\n        if H_min == H_mean:\n            return u_avg, 0.0\n\n        # Create a high-resolution common grid in z for interpolation. M=10000.\n        M = 10000\n        z_common = np.linspace(-H_min, 0, M)\n\n        # Interpolate pressures onto the common z-grid.\n        # Note: z_interfaces are already sorted from -H to 0, i.e., increasing.\n        p_interp_L = np.interp(z_common, z_interfaces_L, pressure_interfaces_L)\n        p_interp_R = np.interp(z_common, z_interfaces_R, pressure_interfaces_R)\n\n        delta_p_max = np.max(np.abs(p_interp_R - p_interp_L))\n        D = delta_p_max / (rho0 * g * H_mean)\n\n        return u_avg, D\n\n    test_cases = [\n        # (HL, s, dx, N, gamma, r, T, rho0)\n        (1000.0, 0.0,    10000.0, 20, 0.0010, 1.0e-4, 3600.0, 1025.0),\n        (1000.0, 0.0010, 10000.0, 10, 0.0010, 1.0e-4, 3600.0, 1025.0),\n        (1000.0, 0.0010, 10000.0, 40, 0.0010, 1.0e-4, 3600.0, 1025.0),\n        (3000.0, 0.0030, 10000.0, 20, 0.0015, 1.0e-4, 3600.0, 1025.0),\n        (200.0,  0.0050, 5000.0,  10, 0.0005, 1.0e-4, 3600.0, 1025.0),\n    ]\n\n    # Calculate results for all test cases\n    results = []\n    for case in test_cases:\n        u_avg, D = calculate_spurious_effects(*case)\n        # Round the final values to six decimal places as required\n        results.append([round(u_avg, 6), round(D, 6)])\n\n    # Format the output string exactly as specified, without spaces\n    # Example: [[0.0,0.0],[0.000123,0.000456]]\n    output_parts = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output_string = \"[\" + \",\".join(output_parts) + \"]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "Having diagnosed the spurious PGF error in the previous exercise , we now focus on engineering a solution. This advanced practice requires you to derive and implement a mathematically robust scheme, the pressure Jacobian formulation, to accurately compute the PGF in a terrain-following coordinate system. Successfully completing this task demonstrates a higher-level ability to not only identify numerical problems but also to develop and validate sophisticated solutions essential for creating reliable ocean models .",
            "id": "3902101",
            "problem": "You are tasked with deriving and implementing a numerical pressure reconstruction scheme that minimizes horizontal pressure gradient force (PGF) errors in a terrain-following ocean model under the Boussinesq approximation. Use fundamental laws of motion and hydrostatic balance to construct a formulation that correctly evaluates the horizontal PGF at fixed geometric height, even when the actual computations are performed on terrain-following layers. Then quantify the spurious PGF (as an acceleration) produced by two schemes: a naive horizontal finite-difference of pressure on terrain-following layers and a reconstruction based on a pressure Jacobian formulation.\n\nAssume a two-dimensional, hydrostatic ocean with coordinates $x$ (horizontal) and $s$ (dimensionless terrain-following vertical coordinate), with $s \\in [0,1]$ where $s=0$ denotes the free surface and $s=1$ denotes the seafloor. Let the bottom depth be $h(x)$ and the geometric vertical coordinate be $z(x,s)$ defined by the linear mapping $z(x,s) = - s \\, h(x)$. The free surface is flat, $z(x,0) = 0$, and the reference density for the Boussinesq approximation is constant and equal to $\\rho_0$. The acceleration due to gravity is $g$. The in-situ density is a prescribed function of depth only, $\\rho(z) = \\rho_0 + \\alpha \\, (-z)$, where $\\alpha$ is a constant stratification parameter. Under hydrostatic balance, the pressure at geometric height $z$ is given by $p(z) = g \\int_{z}^{0} \\rho(z') \\, dz'$ with $p(0) = 0$.\n\nStarting from Newton’s second law and hydrostatic balance, derive a formulation that expresses the horizontal pressure gradient at fixed geometric height $z$ in terms of quantities discretized in $(x,s)$ space. Construct a pressure reconstruction scheme using a pressure Jacobian that eliminates the coordinate-transformation-induced spurious PGF appearing when taking horizontal differences of pressure along terrain-following layers. Your derivation must begin from:\n- Newton’s second law, $\\rho_0 \\, \\frac{D \\mathbf{u}}{D t} = - \\nabla p + \\rho \\, \\mathbf{g}$, with the Boussinesq approximation implying that the dynamical pressure-gradient term uses $\\rho_0$,\n- Hydrostatic balance, $\\frac{\\partial p}{\\partial z} = - g \\, \\rho(z)$,\n- The chain rule for coordinate transformations between $(x,z)$ and $(x,s)$.\n\nYour implementation must numerically approximate hydrostatic pressure $p(x,s)$ by vertical integration in each column, using the discrete terrain-following grid. Then evaluate the horizontal PGF at fixed $z$ via your reconstructed pressure Jacobian formulation and compare it to the naive computation of $-\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\\big|_{s}$ obtained by finite differences along terrain-following layers. Quantify the spurious PGF as the root-mean-square (RMS) of the computed horizontal accelerations over interior grid points. The RMS must be expressed in $\\mathrm{m/s^2}$.\n\nImplement the following numerical setup for each test case:\n- A horizontal domain of length $L$ discretized into $N_x$ points, with uniform spacing $\\Delta x = L / (N_x - 1)$.\n- A vertical terrain-following coordinate $s \\in [0,1]$ discretized into $N_s$ levels, with uniform spacing $\\Delta s = 1 / (N_s - 1)$.\n- Bottom depth $h(x) = H + m \\, x$, where $H$ is the depth at $x=0$, and $m$ is a constant bottom slope ($\\mathrm{m/m}$).\n- Geometric height $z(x,s) = - s \\, h(x)$ and density $\\rho(x,s) = \\rho(z(x,s)) = \\rho_0 + \\alpha \\, (-z(x,s))$.\n- Hydrostatic pressure $p(x,s)$ must be approximated by discrete vertical integration from the surface down to $s$ using a trapezoidal rule in each column:\n  $$p(x,s_k) \\approx \\sum_{j=1}^{k} g \\, \\frac{\\rho(x,s_{j-1}) + \\rho(x,s_{j})}{2} \\, \\left[z(x,s_{j-1}) - z(x,s_{j})\\right], \\quad p(x,s_0) = 0.$$\n- Horizontal and vertical derivatives must be computed by centered finite differences at interior points:\n  $$\\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k} \\approx \\frac{p(x_{i+1},s_k) - p(x_{i-1},s_k)}{2 \\, \\Delta x}, \\quad \\left.\\frac{\\partial p}{\\partial s}\\right|_{x_i} \\approx \\frac{p(x_i,s_{k+1}) - p(x_i,s_{k-1})}{2 \\, \\Delta s},$$\n  $$\\left.\\frac{\\partial z}{\\partial x}\\right|_{s_k} \\approx \\frac{z(x_{i+1},s_k) - z(x_{i-1},s_k)}{2 \\, \\Delta x}, \\quad \\left.\\frac{\\partial z}{\\partial s}\\right|_{x_i} \\approx \\frac{z(x_i,s_{k+1}) - z(x_i,s_{k-1})}{2 \\, \\Delta s}.$$\n- Compute the naive PGF as $a_{\\mathrm{naive}}(x_i,s_k) = - \\frac{1}{\\rho_0} \\left.\\frac{\\partial p}{\\partial x}\\right|_{s_k}$.\n- Compute your reconstructed PGF at fixed $z$ using the pressure Jacobian formulation you derive, and denote it $a_{\\mathrm{jac}}(x_i,s_k)$.\n- Report the RMS acceleration for each scheme over interior indices $i = 1,\\dots,N_x-2$ and $k = 1,\\dots,N_s-2$:\n  $$\\mathrm{RMS}_{\\mathrm{naive}} = \\sqrt{\\frac{1}{M} \\sum_{i,k} a_{\\mathrm{naive}}(x_i,s_k)^2}, \\quad \\mathrm{RMS}_{\\mathrm{jac}} = \\sqrt{\\frac{1}{M} \\sum_{i,k} a_{\\mathrm{jac}}(x_i,s_k)^2},$$\n  where $M = (N_x - 2)(N_s - 2)$ is the number of interior points.\n\nUse the following physical constants for all tests: $\\rho_0 = 1025$ (kilograms per cubic meter), $g = 9.81$ (meters per second squared). All lengths must be in meters, slopes in $\\mathrm{m/m}$, and accelerations in $\\mathrm{m/s^2}$.\n\nTest suite:\n- Test $1$: $H = 1000$, $L = 100000$, $m = 0.01$, $N_x = 101$, $N_s = 41$, $\\alpha = 5 \\times 10^{-4}$.\n- Test $2$: $H = 1000$, $L = 50000$, $m = 0$, $N_x = 101$, $N_s = 41$, $\\alpha = 5 \\times 10^{-4}$.\n- Test $3$: $H = 2000$, $L = 100000$, $m = 0.02$, $N_x = 51$, $N_s = 21$, $\\alpha = 5 \\times 10^{-4}$.\n- Test $4$: $H = 4000$, $L = 200000$, $m = 0.005$, $N_x = 101$, $N_s = 81$, $\\alpha = 10^{-3}$.\n\nYour program should produce a single line of output containing eight floating-point numbers in $\\mathrm{m/s^2}$: for each test, first the $\\mathrm{RMS}_{\\mathrm{naive}}$ followed by the $\\mathrm{RMS}_{\\mathrm{jac}}$, all concatenated into one comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4,r_5,r_6,r_7,r_8]$).",
            "solution": "The user has provided a valid problem statement.\n\n### Step 1: Extract Givens\n- **Coordinate System**: A 2D system with horizontal coordinate $x$ and a dimensionless terrain-following vertical coordinate $s \\in [0,1]$.\n- **Vertical Mapping**: The geometric vertical coordinate $z(x,s)$ is given by $z(x,s) = - s \\, h(x)$, where $h(x)$ is the bottom depth. The free surface is at $z(x,0) = 0$ (implying $s=0$ at the surface) and the bottom is at $z(x,1) = -h(x)$ (implying $s=1$ at the bottom).\n- **Physical Constants**: Reference density $\\rho_0$ and acceleration due to gravity $g$.\n- **Density Profile**: The in-situ density is a function of depth only: $\\rho(z) = \\rho_0 + \\alpha \\, (-z)$, where $\\alpha$ is a constant stratification parameter.\n- **Governing Equations**:\n    1. Newton’s second law with Boussinesq approximation: $\\rho_0 \\, \\frac{D \\mathbf{u}}{D t} = - \\nabla p + \\rho \\, \\mathbf{g}$.\n    2. Hydrostatic balance: $\\frac{\\partial p}{\\partial z} = - g \\, \\rho(z)$.\n- **Analytical Pressure**: The pressure at geometric height $z$ is $p(z) = g \\int_{z}^{0} \\rho(z') \\, dz'$ with $p(0) = 0$.\n- **Numerical Discretization**:\n    - Horizontal domain: length $L$, $N_x$ points, spacing $\\Delta x = L / (N_x - 1)$.\n    - Vertical domain: $s \\in [0,1]$, $N_s$ levels, spacing $\\Delta s = 1 / (N_s - 1)$.\n    - Bottom depth: $h(x) = H + m \\, x$.\n    - Density on the grid: $\\rho(x,s) = \\rho(z(x,s)) = \\rho_0 + \\alpha \\, (-z(x,s))$.\n- **Numerical Methods**:\n    - **Pressure Integration**: Trapezoidal rule for vertical integration from the surface down.\n      $p(x,s_k) \\approx \\sum_{j=1}^{k} g \\, \\frac{\\rho(x,s_{j-1}) + \\rho(x,s_{j})}{2} \\, \\left[z(x,s_{j-1}) - z(x,s_{j})\\right]$.\n    - **Derivatives**: Centered finite differences for interior points.\n- **Quantities to Compute**:\n    1. Naive PGF acceleration: $a_{\\mathrm{naive}}(x_i,s_k) = - \\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\\big|_{s_k}$.\n    2. Reconstructed PGF acceleration using a pressure Jacobian formulation: $a_{\\mathrm{jac}}(x_i,s_k)$.\n    3. Root-mean-square (RMS) of each acceleration over interior grid points.\n- **Physical Constants for Implementation**: $\\rho_0 = 1025 \\, \\mathrm{kg/m^3}$, $g = 9.81 \\, \\mathrm{m/s^2}$.\n- **Test Cases**:\n    - Test 1: $H = 1000$, $L = 100000$, $m = 0.01$, $N_x = 101$, $N_s = 41$, $\\alpha = 5 \\times 10^{-4}$.\n    - Test 2: $H = 1000$, $L = 50000$, $m = 0$, $N_x = 101$, $N_s = 41$, $\\alpha = 5 \\times 10^{-4}$.\n    - Test 3: $H = 2000$, $L = 100000$, $m = 0.02$, $N_x = 51$, $N_s = 21$, $\\alpha = 5 \\times 10^{-4}$.\n    - Test 4: $H = 4000$, $L = 200000$, $m = 0.005$, $N_x = 101$, $N_s = 81$, $\\alpha = 10^{-3}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on the fundamental equations of motion for geophysical fluids, specifically in the context of ocean modeling. The Boussinesq approximation, hydrostatic balance, and the terrain-following coordinate system are standard concepts in this field. The \"pressure gradient error\" is a well-documented numerical artifact that this problem addresses.\n- **Well-Posed**: The problem is clearly defined with all necessary equations, parameters, and numerical procedures specified. A unique solution exists for the quantities to be computed.\n- **Objective**: The problem is stated in precise, mathematical language, free of subjectivity.\n\nAll criteria for a valid problem are met.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Principle-Based Solution\n\nThe central task is to correctly compute the horizontal pressure gradient force (PGF) per unit mass, which is a term in the ocean momentum equations. In a Cartesian coordinate system $(x,z)$, with $z$ being the vertical coordinate (positive upwards), the horizontal component of the momentum equation under the Boussinesq approximation is:\n$$\n\\frac{Du}{Dt} = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x} \\bigg|_{z} + \\dots\n$$\nThe PGF acceleration term is $a_x = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x} \\big|_{z}$, where the derivative is taken along a surface of constant geometric height $z$.\n\nOcean models often use a terrain-following coordinate system $(x,s)$ to better represent bottom topography. Here, the vertical coordinate $s$ follows the bathymetry. The given transformation is $z(x,s) = -s \\, h(x)$. A naive computation of the PGF in this system would involve taking the horizontal pressure gradient along a constant $s$ surface, $-\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x} \\big|_s$. This is incorrect because surfaces of constant $s$ are generally not horizontal (i.e., not surfaces of constant $z$), leading to a spurious PGF.\n\n**Derivation of the Correct PGF Formulation**\n\nTo find the correct expression, we use the chain rule to relate derivatives between the $(x,z)$ and $(x,s)$ coordinate systems. For any function $f(x, z(x,s))$, its partial derivative with respect to $x$ at constant $s$ is:\n$$\n\\frac{\\partial f}{\\partial x}\\bigg|_s = \\frac{\\partial f}{\\partial x}\\bigg|_z \\frac{\\partial x}{\\partial x} + \\frac{\\partial f}{\\partial z}\\bigg|_x \\frac{\\partial z}{\\partial x}\\bigg|_s = \\frac{\\partial f}{\\partial x}\\bigg|_z + \\frac{\\partial f}{\\partial z}\\bigg|_x \\frac{\\partial z}{\\partial x}\\bigg|_s\n$$\nApplying this rule to the pressure field $p(x,z(x,s))$:\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_s = \\frac{\\partial p}{\\partial x}\\bigg|_z + \\frac{\\partial p}{\\partial z}\\bigg|_x \\frac{\\partial z}{\\partial x}\\bigg|_s\n$$\nWe seek the term $\\frac{\\partial p}{\\partial x}\\big|_z$. Rearranging the equation gives:\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_z = \\frac{\\partial p}{\\partial x}\\bigg|_s - \\frac{\\partial p}{\\partial z}\\bigg|_x \\frac{\\partial z}{\\partial x}\\bigg|_s\n$$\nThe problem specifies the ocean is in hydrostatic balance, $\\frac{\\partial p}{\\partial z} = -g\\rho(z)$. Substituting this into the equation yields:\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_z = \\frac{\\partial p}{\\partial x}\\bigg|_s - (-g\\rho) \\frac{\\partial z}{\\partial x}\\bigg|_s = \\frac{\\partial p}{\\partial x}\\bigg|_s + g\\rho \\frac{\\partial z}{\\partial x}\\bigg|_s\n$$\nThis form shows that the correct PGF is the sum of the gradient along the $s$-surface and a correction term related to the local density and the slope of the $s$-surface. While correct, this \"hydrostatic consistency\" form can suffer from numerical cancellation errors, as it involves the difference of two large terms.\n\nThe problem asks for a \"pressure Jacobian\" formulation, which is known to have better numerical properties. To derive this, we first express $\\frac{\\partial p}{\\partial z}$ in the $(x,s)$ system using the chain rule for the vertical derivative:\n$$\n\\frac{\\partial p}{\\partial s}\\bigg|_x = \\frac{\\partial p}{\\partial z}\\bigg|_x \\frac{\\partial z}{\\partial s}\\bigg|_x \\implies \\frac{\\partial p}{\\partial z}\\bigg|_x = \\frac{\\frac{\\partial p}{\\partial s}\\big|_x}{\\frac{\\partial z}{\\partial s}\\big|_x}\n$$\nSubstituting this into our expression for $\\frac{\\partial p}{\\partial x}\\big|_z$:\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_z = \\frac{\\partial p}{\\partial x}\\bigg|_s - \\frac{\\frac{\\partial p}{\\partial s}\\big|_x}{\\frac{\\partial z}{\\partial s}\\big|_x} \\frac{\\partial z}{\\partial x}\\bigg|_s\n$$\nCombining terms over a common denominator $\\frac{\\partial z}{\\partial s}\\big|_x$:\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_z = \\frac{1}{\\frac{\\partial z}{\\partial s}\\big|_x} \\left( \\frac{\\partial p}{\\partial x}\\bigg|_s \\frac{\\partial z}{\\partial s}\\bigg|_x - \\frac{\\partial p}{\\partial s}\\bigg|_x \\frac{\\partial z}{\\partial x}\\bigg|_s \\right)\n$$\nThe term in parentheses is the Jacobian determinant of the transformation $(x,s) \\to (p,z)$. The PGF accelerations for the two schemes are thus:\n1.  **Naive PGF**: $a_{\\mathrm{naive}} = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\\bigg|_s$\n2.  **Jacobian PGF**: $a_{\\mathrm{jac}} = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\\bigg|_z = -\\frac{1}{\\rho_0 \\frac{\\partial z}{\\partial s}} \\left( \\frac{\\partial p}{\\partial x} \\frac{\\partial z}{\\partial s} - \\frac{\\partial p}{\\partial s} \\frac{\\partial z}{\\partial x} \\right)$\n\n**Analytical PGF for the Test Case**\n\nThe specified density profile is $\\rho(z) = \\rho_0 + \\alpha(-z)$. The exact hydrostatic pressure is found by integration:\n$$\np(z) = g \\int_{z}^{0} \\rho(z') dz' = g \\int_{z}^{0} (\\rho_0 - \\alpha z') dz' = g \\left[ \\rho_0 z' - \\frac{1}{2}\\alpha(z')^2 \\right]_z^0\n$$\n$$\np(z) = g \\left( (0 - 0) - (\\rho_0 z - \\frac{1}{2}\\alpha z^2) \\right) = -g\\rho_0 z + \\frac{1}{2}g\\alpha z^2\n$$\nSince pressure $p$ is a function of geometric depth $z$ only, the true horizontal pressure gradient at any constant depth $z$ is identically zero:\n$$\n\\frac{\\partial p}{\\partial x} \\bigg|_z = 0\n$$\nTherefore, the true horizontal PGF acceleration, $a_x$, is zero everywhere. Any non-zero value calculated by a numerical scheme is a spurious, unphysical artifact. The RMS value of a perfect scheme should be zero. The RMS of $a_{\\mathrm{jac}}$ measures the discretization error of the Jacobian scheme, while the RMS of $a_{\\mathrm{naive}}$ quantifies the magnitude of the spurious force generated by the incorrect formulation.\n\n**Numerical Implementation Strategy**\n\nThe implementation will follow these steps for each test case:\n1.  Discretize the domain into a grid of $(N_s, N_x)$ points. Define the 1D coordinate arrays `x_vals` and `s_vals`.\n2.  Compute the 2D fields for bottom depth $h(x_i)$, geometric depth $z(x_i, s_k)$, and density $\\rho(x_i, s_k)$.\n3.  Numerically integrate vertically to find the pressure field $p(x_i, s_k)$ using the specified cumulative trapezoidal rule.\n4.  Compute the four required partial derivatives ($\\frac{\\partial p}{\\partial x}$, $\\frac{\\partial p}{\\partial s}$, $\\frac{\\partial z}{\\partial x}$, $\\frac{\\partial z}{\\partial s}$) on the grid using centered finite differences. These calculations will produce fields defined on subsets of the grid (e.g., shape $(N_s, N_x-2)$ or $(N_s-2, N_x)$).\n5.  Slice these derivative fields so they are all aligned on the common interior grid of size $(N_s-2) \\times (N_x-2)$.\n6.  Use the aligned derivative fields to compute the acceleration fields $a_{\\mathrm{naive}}$ and $a_{\\mathrm{jac}}$ on the interior grid.\n7.  Calculate the RMS value of each acceleration field over all interior points and store the results.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spurious PGF errors in a terrain-following ocean model\n    for two different numerical schemes.\n    \"\"\"\n    # Physical constants\n    rho0 = 1025.0  # kg/m^3\n    g = 9.81     # m/s^2\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (H, L, m, Nx, Ns, alpha)\n        (1000.0, 100000.0, 0.01, 101, 41, 5e-4),\n        (1000.0, 50000.0, 0.0, 101, 41, 5e-4),\n        (2000.0, 100000.0, 0.02, 51, 21, 5e-4),\n        (4000.0, 200000.0, 0.005, 101, 81, 1e-3),\n    ]\n\n    results = []\n    for params in test_cases:\n        H, L, m, Nx, Ns, alpha = params\n        \n        # 1. Grid setup\n        dx = L / (Nx - 1)\n        ds = 1.0 / (Ns - 1)\n        \n        x_vals = np.linspace(0, L, Nx)\n        s_vals = np.linspace(0, 1, Ns)\n        \n        # 2. Compute grid-based physical fields\n        # All 2D arrays will have shape (Ns, Nx)\n        h_1d = H + m * x_vals\n        \n        # z(x,s) = -s * h(x)\n        z = -s_vals[:, np.newaxis] * h_1d[np.newaxis, :]\n        \n        # rho(z) = rho_0 + alpha * (-z)\n        rho = rho0 + alpha * (-z)\n        \n        # 3. Compute hydrostatic pressure via vertical integration (trapezoidal rule)\n        p = np.zeros((Ns, Nx))\n        # p is zero at the surface (k=0) by definition\n        for k in range(1, Ns):\n            rho_mid = 0.5 * (rho[k - 1, :] + rho[k, :])\n            delta_z = z[k - 1, :] - z[k, :]\n            delta_p = g * rho_mid * delta_z\n            p[k, :] = p[k - 1, :] + delta_p\n            \n        # 4. Compute partial derivatives using centered finite differences\n        # Derivatives with respect to x (shape: (Ns, Nx-2))\n        dp_dx_s = (p[:, 2:] - p[:, :-2]) / (2 * dx)\n        dz_dx_s = (z[:, 2:] - z[:, :-2]) / (2 * dx)\n        \n        # Derivatives with respect to s (shape: (Ns-2, Nx))\n        dp_ds_x = (p[2:, :] - p[:-2, :]) / (2 * ds)\n        dz_ds_x = (z[2:, :] - z[:-2, :]) / (2 * ds)\n        \n        # 5. Align all derivatives on the common interior grid (shape: (Ns-2, Nx-2))\n        dp_dx_s_int = dp_dx_s[1:-1, :]\n        dz_dx_s_int = dz_dx_s[1:-1, :]\n        dp_ds_x_int = dp_ds_x[:, 1:-1]\n        dz_ds_x_int = dz_ds_x[:, 1:-1]\n        \n        # 6. Compute accelerations on the interior grid\n        # Naive PGF acceleration\n        a_naive = -(1.0 / rho0) * dp_dx_s_int\n        \n        # Jacobian PGF acceleration\n        # Numerator of the Jacobian formulation\n        # J = (dp/dx)|s * (dz/ds)|x - (dp/ds)|x * (dz/dx)|s\n        jacobian_num = dp_dx_s_int * dz_ds_x_int - dp_ds_x_int * dz_dx_s_int\n        \n        # Denominator is (dz/ds)|x\n        jacobian_den = dz_ds_x_int\n        \n        # The denominator dz/ds = -h(x) is never zero for h  0\n        a_jac = -(1.0 / rho0) * (jacobian_num / jacobian_den)\n\n        # 7. Calculate RMS over interior points\n        M = (Nx - 2) * (Ns - 2)\n        rms_naive = np.sqrt(np.sum(a_naive**2) / M)\n        rms_jac = np.sqrt(np.sum(a_jac**2) / M)\n        \n        results.extend([rms_naive, rms_jac])\n    \n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}