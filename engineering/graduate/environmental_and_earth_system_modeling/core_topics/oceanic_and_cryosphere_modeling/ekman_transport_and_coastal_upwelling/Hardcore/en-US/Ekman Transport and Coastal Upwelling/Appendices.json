{
    "hands_on_practices": [
        {
            "introduction": "This first practice focuses on the foundational relationship between wind stress and the net, or depth-integrated, movement of water in the surface layer. By integrating the simplified momentum equations, we can bypass the complexities of turbulent mixing to derive a powerful and elegant result for the Ekman transport. This exercise  demonstrates that the net transport is directed precisely 90 degrees to the right of the wind in the Northern Hemisphere, a cornerstone principle for understanding coastal upwelling and ocean circulation.",
            "id": "3877474",
            "problem": "Consider a horizontally homogeneous, rotating ocean of constant density subjected to a spatially uniform wind stress. Adopt an Earth-fixed Cartesian coordinate system with the $x$-axis pointing east, the $y$-axis pointing north, and the $z$-axis pointing vertically upward. Assume the Northern Hemisphere so that the Coriolis parameter $f$ is positive. Within the turbulent surface boundary layer (the Ekman layer), neglect horizontal pressure gradients and horizontal advection, and assume steady state. Let the vertical turbulent (Reynolds) stress at the sea surface be equal to the applied wind stress $\\boldsymbol{\\tau} = (\\tau_x,\\tau_y,0)$, and assume that the turbulent stress vanishes at the base of the Ekman layer. Define the depth-integrated Ekman transport vector $\\mathbf{M}_E = \\int_{-D_E}^{0} \\mathbf{u}\\,\\mathrm{d}z$, where $\\mathbf{u}=(u,v)$ is the horizontal velocity and $D_E$ is the Ekman layer depth.\n\nStarting from the steady horizontal momentum equations with Coriolis acceleration and vertical divergence of turbulent stress, derive the relationship between $\\mathbf{M}_E$ and $\\boldsymbol{\\tau}$ under the stated assumptions. Then, for $\\tau_x = 0.15\\ \\mathrm{N\\,m^{-2}}$, $\\tau_y = 0$, $\\rho = 1025\\ \\mathrm{kg\\,m^{-3}}$, and $f = 10^{-4}\\ \\mathrm{s^{-1}}$, compute the magnitude of $\\mathbf{M}_E$ in $\\mathrm{m^2\\,s^{-1}}$ and the direction of $\\mathbf{M}_E$ as an angle in degrees measured counterclockwise from the positive $x$-axis (east). Round both the magnitude and the angle to four significant figures. Your final answer should consist of two numbers: first the magnitude of $\\mathbf{M}_E$ in $\\mathrm{m^2\\,s^{-1}}$, then the direction in degrees.",
            "solution": "The starting point is the steady-state horizontal momentum equations for the Ekman layer, where the Coriolis force is balanced by the vertical divergence of turbulent stress. Horizontal pressure gradients and advection are neglected as per the problem statement.\nThe equations are:\n$$\n-f v = \\frac{1}{\\rho}\\frac{\\partial \\sigma_x}{\\partial z}\n$$\n$$\nf u = \\frac{1}{\\rho}\\frac{\\partial \\sigma_y}{\\partial z}\n$$\nHere, $\\mathbf{u} = (u,v)$ is the horizontal velocity, $f$ is the Coriolis parameter, $\\rho$ is the constant water density, and $\\boldsymbol{\\sigma} = (\\sigma_x, \\sigma_y)$ is the horizontal vector of vertical turbulent stress.\n\nThe Ekman transport vector $\\mathbf{M}_E$ is defined as the depth-integrated horizontal velocity over the Ekman layer, from its base at $z=-D_E$ to the surface at $z=0$:\n$$\n\\mathbf{M}_E = (M_{Ex}, M_{Ey}) = \\left(\\int_{-D_E}^{0} u\\,\\mathrm{d}z, \\int_{-D_E}^{0} v\\,\\mathrm{d}z\\right)\n$$\nTo find the components of $\\mathbf{M}_E$, we integrate the momentum equations with respect to $z$ from $-D_E$ to $0$.\n\nFor the $x$-component of momentum (which involves $v$):\n$$\n\\int_{-D_E}^{0} -f v \\, \\mathrm{d}z = \\frac{1}{\\rho} \\int_{-D_E}^{0} \\frac{\\partial \\sigma_x}{\\partial z} \\, \\mathrm{d}z\n$$\nSince $f$ and $\\rho$ are constants, we can write:\n$$\n-f \\int_{-D_E}^{0} v \\, \\mathrm{d}z = \\frac{1}{\\rho} \\left[ \\sigma_x(z) \\right]_{-D_E}^{0}\n$$\nSubstituting the definition of $M_{Ey}$ and evaluating the right-hand side using the Fundamental Theorem of Calculus gives:\n$$\n-f M_{Ey} = \\frac{1}{\\rho} \\left( \\sigma_x(0) - \\sigma_x(-D_E) \\right)\n$$\nFor the $y$-component of momentum (which involves $u$):\n$$\n\\int_{-D_E}^{0} f u \\, \\mathrm{d}z = \\frac{1}{\\rho} \\int_{-D_E}^{0} \\frac{\\partial \\sigma_y}{\\partial z} \\, \\mathrm{d}z\n$$\n$$\nf \\int_{-D_E}^{0} u \\, \\mathrm{d}z = \\frac{1}{\\rho} \\left[ \\sigma_y(z) \\right]_{-D_E}^{0}\n$$\n$$\nf M_{Ex} = \\frac{1}{\\rho} \\left( \\sigma_y(0) - \\sigma_y(-D_E) \\right)\n$$\nNow, we apply the boundary conditions for the stress. At the sea surface ($z=0$), the turbulent stress is equal to the wind stress, $\\boldsymbol{\\sigma}(0) = \\boldsymbol{\\tau} = (\\tau_x, \\tau_y)$. At the base of the Ekman layer ($z=-D_E$), the turbulent stress vanishes, $\\boldsymbol{\\sigma}(-D_E) = (0,0)$.\n\nSubstituting these boundary conditions into the integrated equations:\n$$\n-f M_{Ey} = \\frac{1}{\\rho} (\\tau_x - 0) = \\frac{\\tau_x}{\\rho} \\implies M_{Ey} = -\\frac{\\tau_x}{\\rho f}\n$$\n$$\nf M_{Ex} = \\frac{1}{\\rho} (\\tau_y - 0) = \\frac{\\tau_y}{\\rho} \\implies M_{Ex} = \\frac{\\tau_y}{\\rho f}\n$$\nThus, the Ekman transport vector is:\n$$\n\\mathbf{M}_E = (M_{Ex}, M_{Ey}) = \\left( \\frac{\\tau_y}{\\rho f}, -\\frac{\\tau_x}{\\rho f} \\right)\n$$\nThis is the derived relationship between the Ekman transport $\\mathbf{M}_E$ and the wind stress $\\boldsymbol{\\tau}$. This relation can be written compactly using the vertical unit vector $\\hat{\\mathbf{k}}=(0,0,1)$ as $\\mathbf{M}_E = \\frac{\\boldsymbol{\\tau} \\times \\hat{\\mathbf{k}}}{\\rho f}$.\n\nNext, we compute the numerical value of $\\mathbf{M}_E$ using the provided data:\n$\\tau_x = 0.15\\ \\mathrm{N\\,m^{-2}}$, $\\tau_y = 0\\ \\mathrm{N\\,m^{-2}}$, $\\rho = 1025\\ \\mathrm{kg\\,m^{-3}}$, and $f = 10^{-4}\\ \\mathrm{s^{-1}}$.\n\nThe components of the Ekman transport are:\n$$\nM_{Ex} = \\frac{\\tau_y}{\\rho f} = \\frac{0}{(1025)(10^{-4})} = 0\\ \\mathrm{m^2\\,s^{-1}}\n$$\n$$\nM_{Ey} = -\\frac{\\tau_x}{\\rho f} = -\\frac{0.15}{(1025)(10^{-4})} = -\\frac{0.15}{0.1025} \\approx -1.4634146\\ \\mathrm{m^2\\,s^{-1}}\n$$\nThe Ekman transport vector is $\\mathbf{M}_E \\approx (0, -1.4634)\\ \\mathrm{m^2\\,s^{-1}}$.\n\nThe magnitude of $\\mathbf{M}_E$ is:\n$$\n|\\mathbf{M}_E| = \\sqrt{M_{Ex}^2 + M_{Ey}^2} = \\sqrt{0^2 + (-1.4634146...)^2} = 1.4634146...\\ \\mathrm{m^2\\,s^{-1}}\n$$\nRounding to four significant figures, the magnitude is $1.463\\ \\mathrm{m^2\\,s^{-1}}$.\n\nThe direction of $\\mathbf{M}_E$ is the angle $\\theta$ measured counterclockwise from the positive $x$-axis (East). The vector $(0, -1.4634...)$ points directly along the negative $y$-axis (South). The wind stress vector $(0.15, 0)$ points along the positive $x$-axis (East). The transport is directed $90^\\circ$ to the right of the wind, which corresponds to South in the Northern Hemisphere. The angle from the positive $x$-axis counterclockwise to the negative $y$-axis is exactly $270^\\circ$.\nExpressed to four significant figures, the direction is $270.0^\\circ$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.463 & 270.0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Building on our understanding of wind-driven transport, we now turn to its profound physical consequences at a coastal boundary. When offshore Ekman transport creates a divergence of water at the coast, mass conservation requires that deeper, colder water must rise to the surface in a process known as upwelling. This practice  provides a quantitative look at this process, connecting the vertical upwelling velocity, $w$, to the uplift of the pycnocline and the subsequent cooling of the sea surface temperature.",
            "id": "3877505",
            "problem": "Consider an idealized eastern boundary upwelling event in which equatorward wind stress drives offshore Ekman transport, producing divergence near the coast and an associated upward vertical velocity. Assume the ocean is Boussinesq and incompressible so that the divergence of the three-dimensional velocity field is zero, and neglect diabatic processes so that tracers are advected materially. Let $z$ be a vertical coordinate that is positive upward with $z=0$ at the mean sea surface and $z<0$ beneath the surface. The pycnocline is initially at a depth $h=50\\ \\mathrm{m}$ below the surface. A diagnosed coastal vertical velocity $w=2\\times 10^{-5}\\ \\mathrm{m\\,s^{-1}}$ is sustained uniformly and steadily over a duration of $t=2\\ \\mathrm{days}$. In the upper $60\\ \\mathrm{m}$, assume the vertical temperature gradient is uniform and given by $\\frac{\\partial T}{\\partial z}=0.2\\ \\mathrm{K\\,m^{-1}}$ (warmer upward), and neglect horizontal advection. Using these assumptions and starting from fundamental kinematics and the advection equation, compute the vertical uplift of the pycnocline over the duration $t$ and the resulting change in the Sea Surface Temperature (SST) driven solely by vertical advection. Round your numerical results to four significant figures. Express the uplift in meters and the SST change in kelvins.",
            "solution": "We will address the two parts of the problem in sequence: the vertical uplift of the pycnocline and the change in Sea Surface Temperature (SST).\n\nFirst, we calculate the vertical uplift of the pycnocline. The problem states that tracers are advected materially, which means fluid parcels retain their properties (like density) as they move. The pycnocline, a surface of constant density, can therefore be treated as a material surface. The vertical motion of any fluid parcel on this surface is described by the kinematic equation:\n$$\n\\frac{dz_p}{dt} = w\n$$\nwhere $z_p(t)$ is the vertical position of a parcel on the pycnocline at time $t$, and $w$ is the vertical velocity.\n\nThe problem states that the vertical velocity $w$ is sustained uniformly and steadily. This means $w$ is constant in time. We can integrate the equation above with respect to time from $t=0$ to the final time $t$:\n$$\n\\int_{z_p(0)}^{z_p(t)} dz'_p = \\int_0^t w \\, dt'\n$$\nSince $w$ is a constant, the integration yields:\n$$\nz_p(t) - z_p(0) = w \\cdot t\n$$\nThe quantity $z_p(t) - z_p(0)$ is the total vertical displacement of the pycnocline, which we will denote as the uplift, $\\Delta z_p$.\n$$\n\\Delta z_p = w \\cdot t\n$$\nWe are given the values for $w$ and $t$:\n$w = 2 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}}$\n$t = 2\\ \\mathrm{days}$\n\nTo maintain consistent units, we must convert the duration $t$ from days to seconds:\n$$\nt = 2\\ \\mathrm{days} \\times \\frac{24\\ \\mathrm{hours}}{1\\ \\mathrm{day}} \\times \\frac{60\\ \\mathrm{minutes}}{1\\ \\mathrm{hour}} \\times \\frac{60\\ \\mathrm{seconds}}{1\\ \\mathrm{minute}} = 172800\\ \\mathrm{s}\n$$\nNow, we can compute the uplift:\n$$\n\\Delta z_p = (2 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}}) \\times (172800\\ \\mathrm{s}) = 3.456\\ \\mathrm{m}\n$$\nThe initial pycnocline depth was $h=50 \\text{ m}$ (i.e., at $z=-50 \\text{ m}$). After an uplift of $3.456 \\text{ m}$, its new position is $z = -50 \\text{ m} + 3.456 \\text{ m} = -46.544 \\text{ m}$. This is still within the upper $60 \\text{ m}$ of the ocean, where the temperature gradient is defined, so our assumptions are consistent. The uplift is a positive quantity, $3.456\\ \\mathrm{m}$.\n\nNext, we calculate the change in Sea Surface Temperature (SST). The governing equation for temperature $T$, assuming no diabatic processes (no heating or cooling by other means like radiation or mixing), is the advection equation, which states that the material derivative of temperature is zero:\n$$\n\\frac{DT}{Dt} = 0\n$$\nExpanding the material derivative gives:\n$$\n\\frac{\\partial T}{\\partial t} + \\mathbf{u} \\cdot \\nabla T = 0\n$$\nwhere $\\mathbf{u}$ is the three-dimensional velocity field $(u, v, w)$ and $\\nabla T$ is the temperature gradient. In Cartesian coordinates, this is:\n$$\n\\frac{\\partial T}{\\partial t} + u\\frac{\\partial T}{\\partial x} + v\\frac{\\partial T}{\\partial y} + w\\frac{\\partial T}{\\partial z} = 0\n$$\nThe problem states to neglect horizontal advection, which means the terms $u\\frac{\\partial T}{\\partial x}$ and $v\\frac{\\partial T}{\\partial y}$ are considered to be zero. The equation simplifies to:\n$$\n\\frac{\\partial T}{\\partial t} = -w \\frac{\\partial T}{\\partial z}\n$$\nThis equation gives the local rate of change of temperature at a fixed point in space due to vertical advection. We are interested in the SST, which is the temperature at the sea surface, $z=0$. Let $T_{SST}(t) = T(z=0, t)$. The rate of change of SST is given by:\n$$\n\\frac{dT_{SST}}{dt} = \\left( \\frac{\\partial T}{\\partial t} \\right)_{z=0} = -w \\left( \\frac{\\partial T}{\\partial z} \\right)_{z=0}\n$$\nWe are given that $w$ is constant and uniform ($w = 2 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}}$), and the vertical temperature gradient $\\frac{\\partial T}{\\partial z}$ is uniform in the upper $60\\ \\mathrm{m}$ ($ \\frac{\\partial T}{\\partial z} = 0.2\\ \\mathrm{K\\,m^{-1}}$). Since $z=0$ is within this layer, both values are constant at the surface. Therefore, the rate of change of SST is constant:\n$$\n\\frac{dT_{SST}}{dt} = -(2 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}}) \\times (0.2\\ \\mathrm{K\\,m^{-1}}) = -4 \\times 10^{-6}\\ \\mathrm{K\\,s^{-1}}\n$$\nThe total change in SST, $\\Delta T_{SST}$, over the duration $t$ is the integral of this rate from $t=0$ to $t$:\n$$\n\\Delta T_{SST} = \\int_{0}^{t} \\frac{dT_{SST}}{dt'} dt'\n$$\nSince the rate is constant, the integral is simply the rate multiplied by the duration:\n$$\n\\Delta T_{SST} = \\left(-w \\frac{\\partial T}{\\partial z}\\right) \\times t = (-4 \\times 10^{-6}\\ \\mathrm{K\\,s^{-1}}) \\times (172800\\ \\mathrm{s})\n$$\n$$\n\\Delta T_{SST} = -0.6912\\ \\mathrm{K}\n$$\nThe negative sign indicates a cooling of the sea surface, which is the expected physical result of upwelling bringing colder, deeper water to the surface.\n\nThe problem requires the numerical results to be rounded to four significant figures. Both of our results, $3.456 \\text{ m}$ for the uplift and $-0.6912 \\text{ K}$ for the SST change, are already expressed with four significant figures.\n\nThe pycnocline uplift is $3.456\\ \\mathrm{m}$.\nThe change in SST is $-0.6912\\ \\mathrm{K}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3.456 & -0.6912 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Theory provides the framework, but ocean science advances through observation. This final practice bridges the gap by simulating the analysis of oceanographic data from a current meter mooring. You will be tasked with processing velocity measurements to separate the wind-driven ageostrophic flow from the background geostrophic currents. This exercise  offers a hands-on experience in identifying the classic Ekman spiral—the progressive turning of current with depth—and in calculating the net Ekman transport from a discrete dataset.",
            "id": "3877450",
            "problem": "Consider a vertically moored current meter array providing horizontal current measurements at multiple depths. Let the eastward and northward total currents be $u(z)$ and $v(z)$, respectively, measured at discrete depths $z_1,\\dots,z_N$ (in meters, with $z$ increasing positively downward from the sea surface). Assume that the large-scale, steady, frictionless flow is in geostrophic balance, so that the geostrophic velocity $\\boldsymbol{u}_g = (u_g,v_g)$ satisfies $f\\,\\hat{\\boldsymbol{k}} \\times \\boldsymbol{u}_g = -g\\,\\nabla \\eta$, where $f$ is the Coriolis parameter (in s$^{-1}$), $g$ is gravitational acceleration (in m s$^{-2}$), and $\\eta$ is sea surface height (in meters), with horizontal gradients $\\partial \\eta/\\partial x$ and $\\partial \\eta/\\partial y$ (dimensionless slopes). This implies $u_g = -(g/f)\\,\\partial \\eta/\\partial y$ and $v_g = (g/f)\\,\\partial \\eta/\\partial x$. Define the ageostrophic currents by $\\boldsymbol{u}_a(z) = \\boldsymbol{u}(z) - \\boldsymbol{u}_g$, and define the Ekman transport vector per unit width by vertically integrating the ageostrophic currents across the measured Ekman layer thickness,\n$$\n\\boldsymbol{M} = \\left(M_x, M_y\\right) = \\left(\\int_{z_1}^{z_N} u_a(z)\\,\\mathrm{d}z,\\ \\int_{z_1}^{z_N} v_a(z)\\,\\mathrm{d}z\\right),\n$$\nwith units of m$^2$ s$^{-1}$.\n\nYour task is to implement a program that, for each provided test case, performs the following:\n\n1. Compute the geostrophic velocity $\\boldsymbol{u}_g$ from the provided sea surface height gradients, gravitational acceleration $g$, and Coriolis parameter $f$.\n2. Compute the depth-dependent ageostrophic currents $\\boldsymbol{u}_a(z_i)$ at each measurement depth $z_i$ by subtracting $\\boldsymbol{u}_g$ from the total measured currents $\\boldsymbol{u}(z_i)$.\n3. Identify Ekman veering by examining the rotation of the ageostrophic current direction with depth. Let $\\theta(z_i)$ be the direction angle of $\\boldsymbol{u}_a(z_i)$ defined by $\\theta(z_i) = \\mathrm{atan2}(v_a(z_i),u_a(z_i))$ (in degrees). Use an angle-unwrapping procedure that produces a continuous sequence of angles by removing artificial $360^\\circ$ jumps (always operate angles in degrees, and then convert to radians solely for unwrapping if a numerical routine requires radians). In the Northern Hemisphere ($f>0$), Ekman veering is expected to be clockwise with depth, i.e., $\\theta$ decreases with $z$; in the Southern Hemisphere ($f<0$), it is expected to be counterclockwise, i.e., $\\theta$ increases with $z$. Declare veering to be detected if:\n   - There are at least $3$ depth levels ($N \\ge 3$).\n   - The cumulative signed rotation between the shallowest and deepest angles, measured as the difference of the unwrapped angles, has the expected sign and magnitude of at least $10^\\circ$.\n   - At least $60\\%$ of the non-negligible adjacent angle differences (absolute value greater than $1^\\circ$) have the expected sign.\n   If $N < 3$, return a boolean value indicating veering is not detected.\n4. Compute the Ekman transport components $(M_x,M_y)$ by numerically integrating the ageostrophic currents using the trapezoidal rule over the given depths $z_i$. Report also the transport magnitude $|\\boldsymbol{M}| = \\sqrt{M_x^2+M_y^2}$.\n\nAll angles must be handled in degrees as specified above. The units of $u$, $v$, $u_g$, $v_g$, $u_a$, and $v_a$ are m s$^{-1}$, and the units of $M_x$, $M_y$, and $|\\boldsymbol{M}|$ are m$^2$ s$^{-1}$.\n\nTest Suite:\nProvide solutions for the following four test cases. In each case, use $g = 9.81$ m s$^{-2}$ and water density $\\rho = 1025$ kg m$^{-3}$ (the density is provided for completeness; it is not directly required for the computations defined above). For each case, the program input is embedded in the code; it consists of $f$, $(\\partial \\eta/\\partial x,\\partial \\eta/\\partial y)$, the depths $z_i$ (in meters), and the measured total currents $u(z_i)$ and $v(z_i)$ (in m s$^{-1}$).\n\n- Case A (Northern Hemisphere, clear veering):\n  - $f = +1.0\\times 10^{-4}$ s$^{-1}$,\n  - $\\partial \\eta/\\partial x = 1.0\\times 10^{-6}$, $\\partial \\eta/\\partial y = -1.0\\times 10^{-6}$,\n  - depths $z = [5,15,30,60]$ m,\n  - measured currents (eastward) $u(z) = [0.140526407,\\ 0.1481,\\ 0.126384271,\\ 0.0981]$ m s$^{-1}$,\n  - measured currents (northward) $v(z) = [0.140526407,\\ 0.0981,\\ 0.069815729,\\ 0.0681]$ m s$^{-1}$.\n\n- Case B (Northern Hemisphere, no veering):\n  - $f = +1.0\\times 10^{-4}$ s$^{-1}$,\n  - $\\partial \\eta/\\partial x = 0.0$, $\\partial \\eta/\\partial y = 0.0$,\n  - depths $z = [10,30,70]$ m,\n  - measured currents (eastward) $u(z) = [0.06,\\ 0.04,\\ 0.02]$ m s$^{-1}$,\n  - measured currents (northward) $v(z) = [0.0,\\ 0.0,\\ 0.0]$ m s$^{-1}$.\n\n- Case C (Southern Hemisphere, clear veering):\n  - $f = -1.0\\times 10^{-4}$ s$^{-1}$,\n  - $\\partial \\eta/\\partial x = 1.0\\times 10^{-6}$, $\\partial \\eta/\\partial y = 1.0\\times 10^{-6}$,\n  - depths $z = [5,20,40]$ m,\n  - measured currents (eastward) $u(z) = [0.140526407,\\ 0.0981,\\ 0.069815729]$ m s$^{-1}$,\n  - measured currents (northward) $v(z) = [-0.055673593,\\ -0.0481,\\ -0.069815729]$ m s$^{-1}$.\n\n- Case D (Northern Hemisphere, two-depth edge case):\n  - $f = +1.0\\times 10^{-4}$ s$^{-1}$,\n  - $\\partial \\eta/\\partial x = 0.0$, $\\partial \\eta/\\partial y = 0.0$,\n  - depths $z = [10,20]$ m,\n  - measured currents (eastward) $u(z) = [0.025980762,\\ 0.008191520]$ m s$^{-1}$,\n  - measured currents (northward) $v(z) = [0.015000000,\\ 0.005735764]$ m s$^{-1}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must be a list containing $4$ entries $[\\text{veering\\_detected}, M_x, M_y, |\\boldsymbol{M}|]$, where $\\text{veering\\_detected}$ is a boolean and the other entries are floats in m$^2$ s$^{-1}$. The final output must aggregate the four case results into a single top-level list, for example: $[[\\text{True}, M_x^{(A)}, M_y^{(A)}, |\\boldsymbol{M}^{(A)}|],[\\text{False}, \\dots],\\dots]$.",
            "solution": "The solution is implemented by following the four main tasks specified in the problem statement. The process for analyzing each test case is as follows:\n\n1.  **Computation of Geostrophic Velocity ($\\boldsymbol{u}_g$)**:\n    The large-scale, steady, frictionless flow is assumed to be in geostrophic balance. The geostrophic velocity components, eastward ($u_g$) and northward ($v_g$), are independent of depth ($z$) and are calculated from the given sea surface height gradients ($\\partial \\eta/\\partial x$, $\\partial \\eta/\\partial y$), Coriolis parameter ($f$), and gravitational acceleration ($g = 9.81 \\text{ m s}^{-2}$). The governing equations are:\n    $$u_g = -\\frac{g}{f}\\frac{\\partial \\eta}{\\partial y}$$\n    $$v_g = \\frac{g}{f}\\frac{\\partial \\eta}{\\partial x}$$\n    For each test case, these values are computed first and treated as constants for the subsequent steps.\n\n2.  **Computation of Ageostrophic Currents ($\\boldsymbol{u}_a(z)$)**:\n    The ageostrophic current, $\\boldsymbol{u}_a(z) = (u_a(z), v_a(z))$, represents the deviation from the large-scale geostrophic flow. It is often dominated by wind-driven currents in the upper ocean Ekman layer. The ageostrophic components are computed at each measurement depth $z_i$ by subtracting the constant geostrophic velocity from the measured total velocity $\\boldsymbol{u}(z_i) = (u(z_i), v(z_i))$:\n    $$u_a(z_i) = u(z_i) - u_g$$\n    $$v_a(z_i) = v(z_i) - v_g$$\n    These calculations are performed for all depths $z_1, \\dots, z_N$ to obtain a profile of the ageostrophic current.\n\n3.  **Identification of Ekman Veering**:\n    Ekman theory predicts that the ageostrophic current vector rotates with depth, a phenomenon known as Ekman veering. The direction of rotation depends on the hemisphere: clockwise with increasing depth in the Northern Hemisphere ($f > 0$) and counterclockwise in the Southern Hemisphere ($f < 0$). The direction of the ageostrophic current at depth $z_i$ is given by the angle $\\theta(z_i) = \\mathrm{atan2}(v_a(z_i), u_a(z_i))$, measured in degrees.\n    To accurately track the rotation, an angle unwrapping procedure is essential. This corrects for the artificial jumps of $\\pm 360^\\circ$ that occur when the angle crosses the branch cut of the arctangent function, producing a continuous angle sequence. This is achieved by converting the angles to radians, applying a standard unwrapping algorithm (like `numpy.unwrap`), and converting the result back to degrees.\n    Veering is formally detected if and only if three conditions are met:\n    - **Condition 1: Sufficient Data**: There must be at least $N=3$ measurement depths. For cases with $N < 3$, veering is not detected by definition.\n    - **Condition 2: Sufficient Cumulative Rotation**: The total rotation from the shallowest ($z_1$) to the deepest ($z_N$), given by the difference of the unwrapped angles $\\Delta\\theta = \\theta_{\\text{unwrapped}}(z_N) - \\theta_{\\text{unwrapped}}(z_1)$, must have the expected sign and a magnitude of at least $10^\\circ$. The expected sign of rotation is negative (clockwise) for $f > 0$ and positive (counterclockwise) for $f < 0$. This corresponds to the sign of $-f$.\n    - **Condition 3: Consistent Rotation Direction**: At least $60\\%$ of the adjacent angle differences, $\\theta_{\\text{unwrapped}}(z_{i+1}) - \\theta_{\\text{unwrapped}}(z_i)$, that are \"non-negligible\" (absolute value $> 1^\\circ$) must have the same expected sign as the cumulative rotation. This condition ensures the veering is a reasonably consistent trend, not a result of a single large turn between two points.\n\n4.  **Computation of Ekman Transport ($\\boldsymbol{M}$)**:\n    The Ekman transport per unit width, $\\boldsymbol{M} = (M_x, M_y)$, is the vertical integral of the ageostrophic current profile. It represents the net transport of water in the Ekman layer. The components are calculated by numerically integrating the ageostrophic current components from the shallowest ($z_1$) to the deepest ($z_N$) measurement depths using the trapezoidal rule:\n    $$M_x = \\int_{z_1}^{z_N} u_a(z)\\,\\mathrm{d}z \\approx \\sum_{i=1}^{N-1} \\frac{u_a(z_i) + u_a(z_{i+1})}{2} (z_{i+1} - z_i)$$\n    $$M_y = \\int_{z_1}^{z_N} v_a(z)\\,\\mathrm{d}z \\approx \\sum_{i=1}^{N-1} \\frac{v_a(z_i) + v_a(z_{i+1})}{2} (z_{i+1} - z_i)$$\n    The magnitude of the transport vector, $|\\boldsymbol{M}| = \\sqrt{M_x^2 + M_y^2}$, is also computed. The units of $M_x$, $M_y$, and $|\\boldsymbol{M}|$ are m$^2$ s$^{-1}$.\n\nThe implementation encapsulates this entire logic into a function that processes each test case and returns the required results: a boolean indicating if veering was detected, the two Ekman transport components, and the transport magnitude.",
            "answer": "```python\nimport numpy as np\n\ndef analyze_current_profile(f, grad_eta_x, grad_eta_y, z, u, v, g):\n    \"\"\"\n    Analyzes a current profile to determine Ekman veering and transport.\n\n    Args:\n        f (float): Coriolis parameter (s^-1).\n        grad_eta_x (float): Eastward sea surface height gradient (dimensionless).\n        grad_eta_y (float): Northward sea surface height gradient (dimensionless).\n        z (np.ndarray): Array of measurement depths (m), positive downward.\n        u (np.ndarray): Array of eastward total currents (m/s).\n        v (np.ndarray): Array of northward total currents (m/s).\n        g (float): Gravitational acceleration (m/s^2).\n\n    Returns:\n        list: A list containing [veering_detected, Mx, My, mag_M].\n    \"\"\"\n    # 1. Compute the geostrophic velocity (u_g, v_g)\n    u_g = -(g / f) * grad_eta_y\n    v_g = (g / f) * grad_eta_x\n\n    # 2. Compute the depth-dependent ageostrophic currents (u_a, v_a)\n    u_a = u - u_g\n    v_a = v - v_g\n\n    # 3. Identify Ekman veering\n    N = len(z)\n    veering_detected = False\n\n    # Condition 1: Must have at least 3 depth levels.\n    if N >= 3:\n        # Calculate angles in degrees using atan2(y, x)\n        theta_deg = np.rad2deg(np.arctan2(v_a, u_a))\n\n        # Unwrap angles to get a continuous sequence. np.unwrap requires radians.\n        unwrapped_theta_deg = np.rad2deg(np.unwrap(np.deg2rad(theta_deg)))\n\n        # Condition 2: Check cumulative rotation\n        cumulative_rotation = unwrapped_theta_deg[-1] - unwrapped_theta_deg[0]\n        # Expected sign of rotation: clockwise (negative) for f>0, counter-clockwise (positive) for f<0.\n        expected_sign = np.sign(-f)\n        \n        rotation_sign_correct = np.sign(cumulative_rotation) == expected_sign\n        rotation_magnitude_sufficient = np.abs(cumulative_rotation) >= 10.0\n        condition2_met = rotation_sign_correct and rotation_magnitude_sufficient\n\n        # Condition 3: Check consistency of rotation direction\n        adjacent_diffs = np.diff(unwrapped_theta_deg)\n        # Filter for non-negligible differences (abs > 1 degree)\n        non_negligible_diffs = adjacent_diffs[np.abs(adjacent_diffs) > 1.0]\n\n        condition3_met = False\n        if len(non_negligible_diffs) > 0:\n            correct_sign_count = np.sum(np.sign(non_negligible_diffs) == expected_sign)\n            percentage_correct = correct_sign_count / len(non_negligible_diffs)\n            if percentage_correct >= 0.6:\n                condition3_met = True\n        \n        if condition2_met and condition3_met:\n            veering_detected = True\n\n    # 4. Compute Ekman transport components (Mx, My) and magnitude |M|\n    # Use the trapezoidal rule for numerical integration.\n    Mx = np.trapz(u_a, z)\n    My = np.trapz(v_a, z)\n    mag_M = np.sqrt(Mx**2 + My**2)\n\n    return [veering_detected, Mx, My, mag_M]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    g = 9.81  # Gravitational acceleration in m s^-2\n\n    test_cases = [\n        # Case A (Northern Hemisphere, clear veering)\n        {\n            \"f\": +1.0e-4, \"grad_eta_x\": 1.0e-6, \"grad_eta_y\": -1.0e-6,\n            \"z\": np.array([5, 15, 30, 60]),\n            \"u\": np.array([0.140526407, 0.1481, 0.126384271, 0.0981]),\n            \"v\": np.array([0.140526407, 0.0981, 0.069815729, 0.0681]),\n        },\n        # Case B (Northern Hemisphere, no veering)\n        {\n            \"f\": +1.0e-4, \"grad_eta_x\": 0.0, \"grad_eta_y\": 0.0,\n            \"z\": np.array([10, 30, 70]),\n            \"u\": np.array([0.06, 0.04, 0.02]),\n            \"v\": np.array([0.0, 0.0, 0.0]),\n        },\n        # Case C (Southern Hemisphere, clear veering)\n        {\n            \"f\": -1.0e-4, \"grad_eta_x\": 1.0e-6, \"grad_eta_y\": 1.0e-6,\n            \"z\": np.array([5, 20, 40]),\n            \"u\": np.array([0.140526407, 0.0981, 0.069815729]),\n            \"v\": np.array([-0.055673593, -0.0481, -0.069815729]),\n        },\n        # Case D (Northern Hemisphere, two-depth edge case)\n        {\n            \"f\": +1.0e-4, \"grad_eta_x\": 0.0, \"grad_eta_y\": 0.0,\n            \"z\": np.array([10, 20]),\n            \"u\": np.array([0.025980762, 0.008191520]),\n            \"v\": np.array([0.015000000, 0.005735764]),\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = analyze_current_profile(\n            case[\"f\"], case[\"grad_eta_x\"], case[\"grad_eta_y\"],\n            case[\"z\"], case[\"u\"], case[\"v\"], g\n        )\n        all_results.append(result)\n\n    # Format the final output string precisely as required, without extra spaces.\n    inner_parts = []\n    for result in all_results:\n        # Convert each item in the inner list to a string\n        inner_str_parts = [str(item) for item in result]\n        # Join them with commas and wrap in brackets\n        inner_parts.append(f\"[{','.join(inner_str_parts)}]\")\n    \n    # Join the outer lists and wrap in brackets\n    final_output = f\"[{','.join(inner_parts)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}