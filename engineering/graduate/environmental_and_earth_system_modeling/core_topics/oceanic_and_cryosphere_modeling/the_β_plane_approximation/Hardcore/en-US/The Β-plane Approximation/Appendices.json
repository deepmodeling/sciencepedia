{
    "hands_on_practices": [
        {
            "introduction": "Before applying any scientific approximation, a crucial first step is to establish its domain of validity. This exercise  challenges you to quantify how the Coriolis parameter, $f$, changes across a typical synoptic scale. By calculating the dimensionless ratio $\\beta L / f_0$, you will develop a concrete intuition for the physical scales over which the $\\beta$-plane linearization provides a reasonable description of planetary rotation.",
            "id": "3926026",
            "problem": "A stably stratified ocean on a rotating spherical Earth exhibits large-scale motions that are influenced by the meridional variation of the Coriolis parameter. Consider an idealized midlatitude β-plane description centered at latitude $\\phi_0=45^{\\circ}$, where the Coriolis parameter is defined by $f(\\phi)=2\\,\\Omega\\,\\sin\\phi$ for a spherical Earth with mean radius $a$ and angular velocity $\\Omega$. Let $y$ denote the meridional arc-length coordinate measured along a great circle, and suppose the meridional extent of interest is $L=1000\\,\\mathrm{km}$. \n\nStarting from the fundamental definitions above and the geometric relation between $y$ and $\\phi$ on a sphere, derive the meridional gradient $\\beta=\\partial f/\\partial y$ evaluated at $\\phi_0$ and use a first-order Taylor approximation in $y$ to estimate the fractional change of the Coriolis parameter across $L$ as $\\beta\\,L/f_0$, where $f_0=f(\\phi_0)$. Using $a=6.371\\times 10^6\\,\\mathrm{m}$ and $\\Omega=7.2921159\\times 10^{-5}\\,\\mathrm{s}^{-1}$, compute the numerical value of $\\beta\\,L/f_0$ at $\\phi_0=45^{\\circ}$ with $L=1000\\,\\mathrm{km}$, rounding your answer to four significant figures. Express the final result as a dimensionless number (no units). In your derivation, specify the angle unit you use and justify the linearization step physically within the β-plane assumption context, but report only the requested calculation as your final answer.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the principles of geophysical fluid dynamics, well-posed with all necessary data provided, and objective in its phrasing. It represents a standard calculation in the study of the β-plane approximation.\n\nThe objective is to derive the meridional gradient of the Coriolis parameter, $\\beta$, and then use it to estimate the fractional change of the Coriolis parameter, $f$, over a meridional distance $L$.\n\nThe Coriolis parameter, $f$, is a function of latitude $\\phi$:\n$$f(\\phi) = 2 \\Omega \\sin\\phi$$\nwhere $\\Omega$ is the angular velocity of the Earth.\n\nThe problem defines the β-plane, a Cartesian approximation to the spherical geometry in the vicinity of a reference latitude $\\phi_0$. The coordinate $y$ represents the meridional distance northwards from the location where the latitude is $\\phi_0$. The relationship between the differential arc length $dy$ along a meridian and the differential change in latitude $d\\phi$ is given by:\n$$dy = a \\, d\\phi$$\nwhere $a$ is the mean radius of the Earth. It is crucial to note that this relationship requires the angle $\\phi$ to be measured in radians. Consequently, all calculations involving differentiation with respect to $\\phi$ or the use of this geometric relation must be performed with angles in radians.\n\nThe meridional gradient of the Coriolis parameter, denoted by $\\beta$, is defined as the rate of change of $f$ with respect to the meridional coordinate $y$:\n$$\\beta = \\frac{\\partial f}{\\partial y}$$\nSince $f$ is given as a function of $\\phi$, and $\\phi$ is a function of $y$, we use the chain rule for differentiation:\n$$\\beta = \\frac{\\partial f}{\\partial \\phi} \\frac{d\\phi}{dy}$$\n\nFirst, we calculate the derivative of $f$ with respect to $\\phi$. As established, $\\phi$ must be in radians for the standard derivative of the sine function to apply.\n$$\\frac{\\partial f}{\\partial \\phi} = \\frac{\\partial}{\\partial \\phi}(2 \\Omega \\sin\\phi) = 2 \\Omega \\cos\\phi$$\n\nSecond, we find the derivative of $\\phi$ with respect to $y$ from the geometric relationship $dy = a \\, d\\phi$:\n$$\\frac{d\\phi}{dy} = \\frac{1}{a}$$\n\nSubstituting these two results into the chain rule expression for $\\beta$ gives:\n$$\\beta(\\phi) = (2 \\Omega \\cos\\phi) \\left(\\frac{1}{a}\\right) = \\frac{2 \\Omega \\cos\\phi}{a}$$\n\nIn the β-plane approximation, $\\beta$ is treated as a constant, evaluated at the central latitude $\\phi_0$.\n$$\\beta = \\left. \\frac{\\partial f}{\\partial y} \\right|_{\\phi = \\phi_0} = \\frac{2 \\Omega \\cos\\phi_0}{a}$$\n\nThe β-plane approximation itself is a first-order Taylor series expansion of the Coriolis parameter $f$ around $y=0$ (which corresponds to $\\phi=\\phi_0$):\n$$f(y) \\approx f(y=0) + y \\left. \\frac{\\partial f}{\\partial y} \\right|_{y=0}$$\nSubstituting our definitions, this becomes:\n$$f(y) \\approx f_0 + \\beta y$$\nwhere $f_0 = f(\\phi_0) = 2 \\Omega \\sin\\phi_0$. This linearization is physically justified for fluid motions whose meridional extent $L$ is small compared to the radius of the Earth $a$. The quantity to be calculated, $\\beta L / f_0$, represents the fractional change in the Coriolis parameter over the distance $L$ according to this linear model. For the approximation to be valid, this fractional change should be much less than $1$.\n\nWe are asked to compute the numerical value of the dimensionless quantity $\\frac{\\beta L}{f_0}$. Substituting the expressions for $\\beta$ and $f_0$:\n$$\\frac{\\beta L}{f_0} = \\frac{\\left(\\frac{2 \\Omega \\cos\\phi_0}{a}\\right) L}{2 \\Omega \\sin\\phi_0}$$\nThe term $2 \\Omega$ cancels out, simplifying the expression significantly:\n$$\\frac{\\beta L}{f_0} = \\frac{L \\cos\\phi_0}{a \\sin\\phi_0} = \\frac{L}{a \\tan\\phi_0}$$\n\nNow, we substitute the given numerical values:\nReference latitude, $\\phi_0 = 45^{\\circ}$.\nMeridional extent, $L = 1000 \\, \\mathrm{km} = 1.0 \\times 10^6 \\, \\mathrm{m}$.\nEarth's mean radius, $a = 6.371 \\times 10^6 \\, \\mathrm{m}$.\n\nThe value of $\\tan\\phi_0$ is $\\tan(45^{\\circ}) = 1$.\nSubstituting these values into the simplified expression:\n$$\\frac{\\beta L}{f_0} = \\frac{1.0 \\times 10^6 \\, \\mathrm{m}}{(6.371 \\times 10^6 \\, \\mathrm{m}) \\times 1} = \\frac{1}{6.371}$$\n\nPerforming the division:\n$$\\frac{1}{6.371} \\approx 0.15696123057$$\nThe problem requires the answer to be rounded to four significant figures. The first four significant figures are $1$, $5$, $6$, and $9$. The fifth significant figure is $6$, so we round up the fourth digit ($9$) to $10$, which carries over. Thus, $0.1569$ becomes $0.1570$.\n\nThe fractional change is approximately $0.1570$, or $15.7\\%$. This value is small but not negligible, indicating that for a domain of size $1000 \\, \\mathrm{km}$, the β-plane approximation captures the primary effect of the changing Coriolis parameter but higher-order terms might be needed for high-precision models.",
            "answer": "$$\\boxed{0.1570}$$"
        },
        {
            "introduction": "The primary physical consequence of the meridional variation in the Coriolis parameter is the existence of large-scale planetary waves. This practice  moves from the static definition of $\\beta$ to its central role in geophysical wave dynamics. You will derive the classic dispersion relation for barotropic Rossby waves and use it to predict a fundamental wave property—its wavelength—from its period, directly linking the $\\beta$-effect to observable phenomena.",
            "id": "3926044",
            "problem": "Consider a nondivergent, barotropic flow on a rotating Earth, modeled under the $\\beta$-plane approximation near midlatitudes. Assume small-amplitude disturbances so that linearization about a state of rest is appropriate. Take the Coriolis parameter as $f(\\phi) = 2 \\Omega \\sin \\phi$, where $\\Omega$ is Earth's rotation rate and $\\phi$ is latitude, and approximate $f(\\phi)$ locally by $f(y) \\approx f_{0} + \\beta y$ with $\\beta = \\partial f / \\partial y$. For a meridionally uniform Rossby wave, assume no dependence on the meridional coordinate, i.e., the meridional wavenumber is $l = 0$.\n\nStarting from material conservation of absolute vorticity in a nondivergent barotropic fluid and the $\\beta$-plane approximation, derive the linear dispersion relationship that links the angular frequency $\\omega$ to the zonal wavenumber $k$ and $\\beta$. Then, impose a target period $T = 10\\,\\mathrm{days}$ and determine the required zonal wavelength $\\lambda_{x}$ for such a meridionally uniform Rossby wave at midlatitude $\\phi = 45^\\circ$.\n\nUse the following Earth parameters: Earth's rotation rate $\\Omega = 7.2921159 \\times 10^{-5}\\,\\mathrm{s}^{-1}$ and Earth's mean radius $a = 6.371 \\times 10^{6}\\,\\mathrm{m}$. Take $\\beta$ at latitude $\\phi$ as $\\beta = \\dfrac{2 \\Omega \\cos \\phi}{a}$, with $\\phi$ in degrees. Express your final $\\lambda_{x}$ in $\\mathrm{km}$ and round your answer to three significant figures.",
            "solution": "The appropriate fundamental base for large-scale, nondivergent barotropic motion on a rotating planet is material conservation of absolute vorticity. For horizontal, nondivergent flow with streamfunction $\\psi(x,y,t)$ such that $u = -\\partial \\psi / \\partial y$ and $v = \\partial \\psi / \\partial x$, the relative vorticity is $\\zeta = \\nabla^{2} \\psi$, and the absolute vorticity is $\\zeta + f$. Material conservation of absolute vorticity for inviscid, barotropic flow is\n$$\n\\frac{D}{Dt}(\\zeta + f) = 0,\n$$\nwhere $D/Dt = \\partial/\\partial t + \\mathbf{u} \\cdot \\nabla$ is the material derivative, and $f$ is the Coriolis parameter. Under the $\\beta$-plane approximation near a reference latitude, $f(y) \\approx f_{0} + \\beta y$ with $\\beta = \\partial f / \\partial y$ evaluated at the reference latitude. Using the Jacobian operator $J(a,b) = \\frac{\\partial a}{\\partial x}\\frac{\\partial b}{\\partial y} - \\frac{\\partial a}{\\partial y}\\frac{\\partial b}{\\partial x}$, the barotropic vorticity equation can be written as\n$$\n\\frac{\\partial}{\\partial t}(\\nabla^{2} \\psi) + J\\big(\\psi, \\nabla^{2} \\psi + f\\big) = 0.\n$$\nLinearizing about a state of rest (small-amplitude disturbances), the quadratic Jacobian $J(\\psi,\\nabla^{2}\\psi)$ is neglected, and only the interaction with the background planetary vorticity gradient is retained, yielding\n$$\n\\frac{\\partial}{\\partial t}(\\nabla^{2} \\psi) + \\beta \\frac{\\partial \\psi}{\\partial x} = 0.\n$$\nSeek plane-wave solutions of the form\n$$\n\\psi(x,y,t) = \\Re\\left\\{\\psi_{0} \\exp\\big[i(k x + l y - \\omega t)\\big]\\right\\},\n$$\nwhere $\\psi_{0}$ is a constant amplitude, $k$ is the zonal wavenumber, $l$ is the meridional wavenumber, and $\\omega$ is the angular frequency. Substitution into the linear equation gives\n$$\n\\frac{\\partial}{\\partial t}(\\nabla^{2} \\psi) \\rightarrow -i\\omega (-k^{2} - l^{2}) \\psi, \\quad \\beta \\frac{\\partial \\psi}{\\partial x} \\rightarrow i \\beta k \\psi,\n$$\nso the dispersion relationship is\n$$\n\\omega (k^{2} + l^{2}) = -\\beta k.\n$$\nFor a meridionally uniform wave, take $l = 0$, which simplifies the dispersion to\n$$\n\\omega = -\\frac{\\beta}{k}.\n$$\nThe period $T$ is related to the angular frequency by $|\\omega| = \\frac{2\\pi}{T}$. Using $|\\omega|$ and $k = \\frac{2\\pi}{\\lambda_{x}}$, we can solve for $\\lambda_{x}$:\n$$\n|\\omega| = \\frac{\\beta}{|k|} \\quad \\Longrightarrow \\quad |k| = \\frac{\\beta}{|\\omega|} = \\frac{\\beta T}{2\\pi},\n$$\nand hence\n$$\n\\lambda_{x} = \\frac{2\\pi}{|k|} = \\frac{2\\pi}{\\beta T/(2\\pi)} = \\frac{4\\pi^{2}}{\\beta T}.\n$$\n\nNext, evaluate $\\beta$ at midlatitude $\\phi = 45^\\circ$ using\n$$\n\\beta = \\frac{2 \\Omega \\cos \\phi}{a}.\n$$\nWith $\\Omega = 7.2921159 \\times 10^{-5}\\,\\mathrm{s}^{-1}$, $a = 6.371 \\times 10^{6}\\,\\mathrm{m}$, and $\\cos(45^\\circ) = \\frac{\\sqrt{2}}{2} \\approx 0.70710678$, we find\n$$\n\\beta = \\frac{2 \\times \\left(7.2921159 \\times 10^{-5}\\,\\mathrm{s}^{-1}\\right) \\times 0.70710678}{6.371 \\times 10^{6}\\,\\mathrm{m}} \\approx 1.62 \\times 10^{-11}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}.\n$$\nThe target period is $T = 10\\,\\mathrm{days} = 10 \\times 24 \\times 3600\\,\\mathrm{s} = 864000\\,\\mathrm{s}$. Therefore,\n$$\n\\lambda_{x} = \\frac{4\\pi^{2}}{\\beta T} \\approx \\frac{4 \\times \\pi^{2}}{\\left(1.62 \\times 10^{-11}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}\\right) \\times \\left(864000\\,\\mathrm{s}\\right)}.\n$$\nCompute the numerator $4\\pi^{2} \\approx 39.4784176$ and the denominator $\\beta T \\approx 1.62 \\times 10^{-11} \\times 864000 \\approx 1.39968 \\times 10^{-5}\\,\\mathrm{m}^{-1}$. Thus,\n$$\n\\lambda_{x} \\approx \\frac{39.4784176}{1.39968 \\times 10^{-5}}\\,\\mathrm{m} \\approx 2.82053 \\times 10^{6}\\,\\mathrm{m} = 2.82053 \\times 10^{3}\\,\\mathrm{km}.\n$$\nRounded to three significant figures and expressed in $\\mathrm{km}$, the required zonal wavelength is\n$$\n\\lambda_{x} \\approx 2.82 \\times 10^{3}\\,\\mathrm{km}.\n$$",
            "answer": "$$\\boxed{2.82 \\times 10^{3}}$$"
        },
        {
            "introduction": "The ultimate test of theoretical understanding is the ability to translate it into a working model and verify its predictions. This advanced computational exercise  guides you through the verification of the Rossby wave dispersion relation within a numerical framework. By implementing a simulation and comparing its output against the analytical theory, you will bridge the crucial gap between abstract equations and computational science, a core skill in modern geophysical fluid dynamics.",
            "id": "3788700",
            "problem": "You are to implement a numerical test for Rossby wave dispersion under the beta-plane approximation in computational oceanography. Begin from a valid fundamental base and derive the necessary analytical relation. Then, design and execute a numerical experiment on a discrete periodic grid to estimate the wave frequency and compare it to the analytical prediction. All mathematical symbols, variables, functions, operators, and numbers must be written in LaTeX.\n\nStart from the linear, inviscid, baroclinic Quasigeostrophic (QG) potential vorticity (PV) conservation on a beta-plane, which states that the material derivative of QG potential vorticity is zero. Under small-amplitude, linear wave assumptions on a plane with uniform stratification and without mean flow, the governing law reduces to the time evolution of streamfunction perturbations $\\psi(x,y,t)$ where the linearized QG PV is given by a linear operator acting on $\\psi$. Assume a constant meridional gradient of the Coriolis parameter $\\beta$ (with $\\beta = \\partial f / \\partial y$ evaluated at a reference latitude), periodic boundary conditions, and a finite baroclinic deformation radius $R_d$. Use the appropriate definitions for spatial derivatives and the Laplacian operator $\\nabla^2$. Construct the analytical Rossby wave dispersion relation $\\omega(k,l)$ from this base by considering a plane-wave solution $\\psi(x,y,t) = \\Re\\{\\hat{\\psi} \\exp[i(k x + l y - \\omega t)]\\}$, and derive the corresponding analytical expression for the frequency $\\omega$ in terms of the zonal and meridional wavenumbers $k$ and $l$, the meridional gradient $\\beta$, and the deformation radius $R_d$. Do not write down the target expression in the problem statement.\n\nNumerical task specification:\n- Implement a pseudospectral time integration on a discrete grid to evolve the linear QG streamfunction $\\psi(x,y,t)$ under the beta-plane approximation. Use a two-dimensional periodic domain of lengths $L_x$ and $L_y$ discretized into $N_x$ and $N_y$ points, respectively, with uniform spacings $\\Delta x = L_x / N_x$ and $\\Delta y = L_y / N_y$.\n- Initialize $\\psi(x,y,0)$ as a single monochromatic Fourier mode with wavenumbers $k = 2\\pi n_x / L_x$ and $l = 2\\pi n_y / L_y$, where $n_x$ and $n_y$ are integer mode indices.\n- Evolve the Fourier coefficients $\\hat{\\psi}(k,l,t)$ exactly in time for the linear system by solving the corresponding ordinary differential equation for each mode on the discrete Fourier grid, using the Fast Fourier Transform (FFT) to move between physical and spectral space if needed. The angle unit must be radians.\n- Estimate the numerical frequency $\\omega_{\\mathrm{num}}$ for the excited mode by computing the time series of the complex phase of its Fourier coefficient, unwrapping the phase, and performing a linear regression of phase versus time. The frequency should be extracted consistently with the plane-wave convention $\\exp[i(k x + l y - \\omega t)]$.\n- Compute the analytical frequency $\\omega_{\\mathrm{ana}}$ from your derived dispersion relation for the same $k$, $l$, $\\beta$, and $R_d$.\n- Report, for each test case, the relative error defined as $\\epsilon = |\\omega_{\\mathrm{num}} - \\omega_{\\mathrm{ana}}| / \\max(|\\omega_{\\mathrm{ana}}|, \\varepsilon)$, with $\\varepsilon$ a small positive number to avoid division by zero. The frequency $\\omega$ must be expressed in $\\mathrm{s}^{-1}$, and the relative error $\\epsilon$ must be a dimensionless float.\n\nTest suite:\nProvide four test cases with scientifically plausible and self-consistent parameters that cover general, boundary, and edge scenarios. For each case, the parameters are $(\\beta, R_d, L_x, L_y, N_x, N_y, n_x, n_y, \\Delta t, T)$ where $\\Delta t$ is the time step and $T$ is the total integration time, both in seconds. Use the following values:\n1. General baroclinic case: $\\beta = 1.6\\times 10^{-11} \\, \\mathrm{s}^{-1}\\mathrm{m}^{-1}$, $R_d = 3.0\\times 10^{4} \\, \\mathrm{m}$, $L_x = 1.0\\times 10^{6} \\, \\mathrm{m}$, $L_y = 1.0\\times 10^{6} \\, \\mathrm{m}$, $N_x = 128$, $N_y = 128$, $n_x = 3$, $n_y = 2$, $\\Delta t = 1.0\\times 10^{5} \\, \\mathrm{s}$, $T = 6.0\\times 10^{6} \\, \\mathrm{s}$.\n2. Barotropic limit with meridional mode zero: $\\beta = 1.6\\times 10^{-11} \\, \\mathrm{s}^{-1}\\mathrm{m}^{-1}$, $R_d = 1.0\\times 10^{9} \\, \\mathrm{m}$, $L_x = 2.0\\times 10^{6} \\, \\mathrm{m}$, $L_y = 1.0\\times 10^{6} \\, \\mathrm{m}$, $N_x = 96$, $N_y = 64$, $n_x = 4$, $n_y = 0$, $\\Delta t = 8.0\\times 10^{4} \\, \\mathrm{s}$, $T = 4.0\\times 10^{6} \\, \\mathrm{s}$.\n3. High-wavenumber near-Nyquist case: $\\beta = 2.0\\times 10^{-11} \\, \\mathrm{s}^{-1}\\mathrm{m}^{-1}$, $R_d = 2.5\\times 10^{4} \\, \\mathrm{m}$, $L_x = 5.0\\times 10^{5} \\, \\mathrm{m}$, $L_y = 5.0\\times 10^{5} \\, \\mathrm{m}$, $N_x = 64$, $N_y = 64$, $n_x = 31$, $n_y = 1$, $\\Delta t = 5.0\\times 10^{4} \\, \\mathrm{s}$, $T = 3.0\\times 10^{6} \\, \\mathrm{s}$.\n4. Small-$\\beta$ sensitivity case: $\\beta = 1.0\\times 10^{-12} \\, \\mathrm{s}^{-1}\\mathrm{m}^{-1}$, $R_d = 3.0\\times 10^{4} \\, \\mathrm{m}$, $L_x = 1.0\\times 10^{6} \\, \\mathrm{m}$, $L_y = 1.0\\times 10^{6} \\, \\mathrm{m}$, $N_x = 128$, $N_y = 128$, $n_x = 5$, $n_y = 5$, $\\Delta t = 1.0\\times 10^{5} \\, \\mathrm{s}$, $T = 1.0\\times 10^{6} \\, \\mathrm{s}$.\n\nFinal output format:\nYour program should produce a single line of output containing the relative errors for all four test cases as a comma-separated list enclosed in square brackets, for example $[r_1,r_2,r_3,r_4]$, where each $r_i$ is a float. Angles must be treated in radians, and the frequency must be in $\\mathrm{s}^{-1}$.",
            "solution": "The problem requires the derivation of the Rossby wave dispersion relation from the baroclinic Quasigeostrophic Potential Vorticity (QG PV) equation and the subsequent numerical verification of this relation. The validation of the problem statement has confirmed its scientific soundness, consistency, and completeness. We now proceed with the solution, which consists of an analytical derivation followed by the design of a numerical experiment.\n\nFirst, we establish the theoretical foundation. The governing equation is the conservation of QG PV, $q$, for an inviscid, unforced fluid on a $\\beta$-plane with no mean flow. This is expressed as the material derivative of $q$ with respect to the geostrophic velocity $\\mathbf{u}_g$ being zero:\n$$\n\\frac{D_g q}{Dt} = \\frac{\\partial q}{\\partial t} + \\mathbf{u}_g \\cdot \\nabla q = 0\n$$\nThe geostrophic velocity is related to the streamfunction $\\psi$ by $\\mathbf{u}_g = (-\\partial \\psi / \\partial y, \\partial \\psi / \\partial x)$. The QG PV, $q$, for a baroclinic fluid is defined as:\n$$\nq = \\nabla^2 \\psi - \\frac{1}{R_d^2}\\psi + f\n$$\nwhere $\\nabla^2 = \\partial^2/\\partial x^2 + \\partial^2/\\partial y^2$ is the horizontal Laplacian operator, $R_d$ is the first baroclinic Rossby radius of deformation, and $f$ is the Coriolis parameter. On a $\\beta$-plane, we approximate $f$ as a linear function of the meridional coordinate $y$: $f = f_0 + \\beta y$, where $f_0$ is the Coriolis parameter at a reference latitude and $\\beta = \\partial f / \\partial y$ is a constant.\n\nTo linearize the QG PV equation, we consider small perturbations of the streamfunction $\\psi$ on a state of rest. The PV is separated into a mean component, $\\bar{q} = f_0 + \\beta y$, and a perturbation component, $q' = \\nabla^2 \\psi - \\psi / R_d^2$. The linearized QG PV equation is obtained by considering the advection of the mean PV gradient by the perturbation velocity, which yields:\n$$\n\\frac{\\partial q'}{\\partial t} + v_g \\frac{\\partial \\bar{q}}{\\partial y} = 0\n$$\nSubstituting the expressions for $q'$, $\\bar{q}$, and the meridional geostrophic velocity $v_g = \\partial \\psi / \\partial x$, we arrive at the linearized baroclinic QG PV equation for the streamfunction perturbation $\\psi(x, y, t)$:\n$$\n\\frac{\\partial}{\\partial t} \\left( \\nabla^2 \\psi - \\frac{1}{R_d^2}\\psi \\right) + \\beta \\frac{\\partial \\psi}{\\partial x} = 0\n$$\n\nTo derive the dispersion relation, we seek a plane-wave solution of the form $\\psi(x,y,t) = \\Re\\{\\hat{\\psi} \\exp[i(k x + l y - \\omega t)]\\}$, where $\\hat{\\psi}$ is a constant complex amplitude, $k$ and $l$ are the zonal and meridional wavenumbers, respectively, and $\\omega$ is the wave frequency. Substituting this form into the governing equation requires evaluating the derivatives:\n- $\\partial/\\partial t \\rightarrow -i\\omega$\n- $\\partial/\\partial x \\rightarrow ik$\n- $\\nabla^2 \\rightarrow -(k^2 + l^2)$\n\nApplying these operational substitutions to the linearized QG PV equation yields an algebraic equation for the coefficients:\n$$\n(-i\\omega) \\left( -(k^2 + l^2) - \\frac{1}{R_d^2} \\right) \\hat{\\psi} + \\beta (ik) \\hat{\\psi} = 0\n$$\nAssuming a non-trivial solution ($\\hat{\\psi} \\neq 0$), we can divide by $\\hat{\\psi}$ and $i$:\n$$\n\\omega (k^2 + l^2 + R_d^{-2}) + \\beta k = 0\n$$\nSolving for $\\omega$ gives the analytical dispersion relation for baroclinic Rossby waves:\n$$\n\\omega_{\\mathrm{ana}}(k, l) = - \\frac{\\beta k}{k^2 + l^2 + R_d^{-2}}\n$$\nThis relation is central to our numerical test. It indicates that Rossby waves are dispersive (i.e., the frequency depends on the wavenumber) and have a negative zonal phase speed $c_x = \\omega/k  0$ (for $k \\neq 0$), meaning they propagate westward. The barotropic limit is recovered as $R_d \\rightarrow \\infty$, for which $R_d^{-2} \\rightarrow 0$.\n\nThe numerical portion of the task involves verifying this analytical result. We use a pseudospectral method on a doubly periodic domain of size $L_x \\times L_y$ with a discrete grid of $N_x \\times N_y$ points. In the spectral domain, the linearized QG PV equation transforms into a set of uncoupled ordinary differential equations (ODEs) for each Fourier coefficient $\\hat{\\psi}(k, l, t)$. For a specific wavenumber pair $(k,l)$, the ODE is:\n$$\n\\frac{d\\hat{\\psi}_{k,l}}{dt} = -i \\left( - \\frac{\\beta k}{k^2 + l^2 + R_d^{-2}} \\right) \\hat{\\psi}_{k,l} = -i \\omega_{\\mathrm{ana}}(k,l) \\hat{\\psi}_{k,l}\n$$\nThe problem specifies that we evolve the coefficients \"exactly in time\". The exact solution to this ODE is:\n$$\n\\hat{\\psi}_{k,l}(t) = \\hat{\\psi}_{k,l}(0) \\exp(-i \\omega_{\\mathrm{ana}}(k,l) t)\n$$\nOur numerical experiment will thus consist of the following steps for each test case:\n$1$. Determine the specific wavenumbers $k = 2\\pi n_x / L_x$ and $l = 2\\pi n_y / L_y$ from the given integer mode indices $(n_x, n_y)$ and domain lengths.\n$2$. Compute the analytical frequency $\\omega_{\\mathrm{ana}}$ using the derived dispersion relation.\n$3$. Generate a time series of a single Fourier coefficient $\\hat{\\psi}(t)$ for the specified mode $(k,l)$ over a total time $T$ with time step $\\Delta t$. We set its initial value $\\hat{\\psi}(0) = 1$ and compute its value at subsequent times $t_j = j \\Delta t$ using the exact solution $\\hat{\\psi}(t_j) = \\exp(-i \\omega_{\\mathrm{ana}} t_j)$.\n$4$. Estimate the \"numerical\" frequency $\\omega_{\\mathrm{num}}$ from this time series. The phase of the complex coefficient at time $t$ is $\\phi(t) = \\arg(\\hat{\\psi}(t)) = -\\omega_{\\mathrm{ana}} t$. We compute the phase at each time step, unwrap it to remove $2\\pi$ discontinuities, and perform a linear regression on the resulting points $(t_j, \\phi_{\\mathrm{unwrapped}}(t_j))$. The slope of the regression line provides an estimate for $-\\omega$, so $\\omega_{\\mathrm{num}} = -\\mathrm{slope}$.\n$5$. Finally, we compute the relative error $\\epsilon$ between the numerically estimated frequency and the analytical frequency:\n$$\n\\epsilon = \\frac{|\\omega_{\\mathrm{num}} - \\omega_{\\mathrm{ana}}|}{\\max(|\\omega_{\\mathrm{ana}}|, \\varepsilon)}\n$$\nwhere $\\varepsilon$ is a small positive constant (e.g., $10^{-16}$) to prevent division by zero in cases where $\\omega_{\\mathrm{ana}} = 0$ (i.e., when $k=0$). Since the time series is generated from the exact analytical solution, this procedure primarily tests the accuracy of the numerical phase estimation (unwrapping and linear regression) and the implementation's floating-point precision. The expected error should be very close to machine epsilon.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Rossby wave dispersion problem by comparing analytical\n    and numerically estimated wave frequencies.\n    \"\"\"\n    # Test cases: (beta, Rd, Lx, Ly, Nx, Ny, nx, ny, dt, T)\n    test_cases = [\n        (1.6e-11, 3.0e4, 1.0e6, 1.0e6, 128, 128, 3, 2, 1.0e5, 6.0e6),\n        (1.6e-11, 1.0e9, 2.0e6, 1.0e6, 96, 64, 4, 0, 8.0e4, 4.0e6),\n        (2.0e-11, 2.5e4, 5.0e5, 5.0e5, 64, 64, 31, 1, 5.0e4, 3.0e6),\n        (1.0e-12, 3.0e4, 1.0e6, 1.0e6, 128, 128, 5, 5, 1.0e5, 1.0e6)\n    ]\n\n    results = []\n    # Small constant to prevent division by zero in the relative error calculation.\n    epsilon_floor = 1e-16\n\n    for case in test_cases:\n        beta, Rd, Lx, Ly, Nx, Ny, nx, ny, dt, T = case\n\n        # 1. Calculate analytical frequency (omega_ana)\n        # Zonal and meridional wavenumbers\n        k = 2.0 * np.pi * nx / Lx\n        l = 2.0 * np.pi * ny / Ly\n\n        # The term R_d^-2 can also be written as 1/(Rd*Rd)\n        Rd_inv_sq = Rd**-2\n\n        # The analytical dispersion relation for baroclinic Rossby waves\n        denominator = k**2 + l**2 + Rd_inv_sq\n\n        # If k is zero, the frequency is zero and there is no propagation.\n        # This also avoids potential division by zero if the denominator is zero,\n        # though with Rd^-2  0, the denominator is always positive for real k, l.\n        if k == 0.0:\n            omega_ana = 0.0\n        else:\n            omega_ana = -beta * k / denominator\n\n        # 2. Generate time series data for numerical frequency estimation.\n        # The problem asks to evolve the Fourier coefficient exactly in time.\n        num_steps = int(T / dt)\n        if num_steps  1:\n            # If T  dt, there's not enough data for a time series.\n            # Set error to a value indicating failure or handle as per problem spec.\n            # The test cases provided do not have this issue.\n            # We proceed assuming T/dt >= 1.\n            results.append(1.0) # Placeholder for an invalid case\n            continue\n            \n        times = np.arange(num_steps + 1) * dt\n\n        # The exact solution for the Fourier coefficient's time evolution is\n        # psi_hat(t) = psi_hat(0) * exp(-i * omega * t)\n        # We can set psi_hat(0) = 1 + 0j without loss of generality.\n        psi_hat_t = np.exp(-1j * omega_ana * times)\n\n        # 3. Estimate numerical frequency (omega_num) from the time series\n        # The phase of the complex signal is phi(t) = -omega * t.\n        # We can find omega by finding the slope of the phase vs. time.\n        phases = np.angle(psi_hat_t)\n        \n        # Unwrap phases to correctly handle ancles crossing +/- pi\n        unwrapped_phases = np.unwrap(phases)\n\n        # Perform a linear regression on (times, unwrapped_phases) to find the slope.\n        # We use np.polyfit for this purpose. It returns [slope, intercept].\n        if len(times)  2:\n            # Need at least two points for a line fit\n            slope = 0.0\n        else:\n            slope, _ = np.polyfit(times, unwrapped_phases, 1)\n\n        # The numerical frequency is the negative of the slope.\n        omega_num = -slope\n\n        # 4. Calculate the relative error\n        # The denominator for the relative error is max(|omega_ana|, epsilon)\n        # to avoid division by zero when omega_ana is zero.\n        error_denominator = np.max([np.abs(omega_ana), epsilon_floor])\n        relative_error = np.abs(omega_num - omega_ana) / error_denominator\n        \n        results.append(relative_error)\n\n    # Format the final output as a comma-separated list in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}