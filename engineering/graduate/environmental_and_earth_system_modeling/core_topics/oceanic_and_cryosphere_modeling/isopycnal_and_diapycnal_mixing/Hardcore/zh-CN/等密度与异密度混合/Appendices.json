{
    "hands_on_practices": [
        {
            "introduction": "为了对等密度面混合进行建模，我们必须首先理解混合发生的表面的几何形状。这项练习从第一性原理出发，推导了等密度面的斜率，并将其与海洋的基本属性——水平密度梯度和垂向层结联系起来 。通过这个练习，你将建立起关于为何等密度面并非完全水平的核心直觉，并理解决定其倾斜程度的关键物理因素。",
            "id": "3886484",
            "problem": "考虑一个稳定分层的海洋内部，其原位密度场是水平位置和深度的平滑函数，记为 $\\rho(x,y,z)$，其中 $z$ 定义为从海面向下为正的深度。一个等密度面是所有 $\\rho(x,y,z)$ 等于一个固定常数 $\\rho^{\\ast}$ 的点的集合。等密度面混合是指示踪物沿着此类等密度面的优先扩散和搅拌。假设 Boussinesq 近似成立，因此密度变化与一个恒定的参考密度相比很小，并设分层是稳定的，即 $\\partial \\rho / \\partial z  0$。\n\n从等密度面 $\\rho(x,y,z)=\\rho^{\\ast}$ 的定义以及全微分 $d\\rho$ 在该面上为零的条件出发，推导局部等密度面斜率向量 $\\boldsymbol{s}$ 的表达式，其分量为方向斜率 $s_x=\\left(\\partial z/\\partial x\\right)_{\\rho^{\\ast}}$ 和 $s_y=\\left(\\partial z/\\partial y\\right)_{\\rho^{\\ast}}$，并用水平和垂直密度梯度表示。您的推导必须从第一性原理（链式法则和梯度作为等值面法向量的几何解释）开始，并且不应假设任何关于 $\\boldsymbol{s}$ 的既有公式。\n\n然后，对以下局部线性密度场评估等密度面斜率：\n$$\n\\rho(x,y,z) \\;=\\; \\rho_0 \\;+\\; a\\,x \\;+\\; b\\,y \\;+\\; c\\,z \\;+\\; d\\,x\\,z \\;+\\; e\\,y\\,z,\n$$\n其中 $x$ 和 $y$ 是以米为单位的水平距离，$z$ 是以米为单位的深度，系数为\n$$\na \\;=\\; 2.0 \\times 10^{-5}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}, \\quad\nb \\;=\\; -1.0 \\times 10^{-5}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}, \\quad\nc \\;=\\; 1.5 \\times 10^{-2}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4},\n$$\n$$\nd \\;=\\; 1.0 \\times 10^{-7}\\,\\mathrm{kg}\\,\\mathrm{m}^{-5}, \\quad\ne \\;=\\; -2.0 \\times 10^{-7}\\,\\mathrm{kg}\\,\\mathrm{m}^{-5}.\n$$\n在点 $(x_0,y_0,z_0)=(4.0\\times 10^{4}\\,\\mathrm{m},\\,3.0\\times 10^{4}\\,\\mathrm{m},\\,1.0\\times 10^{3}\\,\\mathrm{m})$ 处计算 $\\boldsymbol{s}$，并计算其大小 $|\\boldsymbol{s}|$。将最终的斜率分量和大小表示为四位有效数字的无量纲值。\n\n最后，从物理上解释水平密度梯度和垂直分层之间的比率如何决定等密度面混合的横向路径，将您推导的表达式与在指定点计算出的值明确联系起来。您的解释应基于推导的表达式和稳定性条件 $\\partial \\rho / \\partial z  0$，并且不应依赖任何外部参数化公式。",
            "solution": "所述问题具有科学依据，提法恰当，客观且内部一致。这是物理海洋学中一个基于微积分和流体动力学基本原理的标准练习。所有必要的数据均已提供，且其物理单位是一致的。稳定性条件 $\\frac{\\partial \\rho}{\\partial z}  0$ 对于指定的参数和位置成立，确保了该场景的物理真实性。因此，该问题是有效的，可以构建一个完整的解决方案。\n\n解答过程如问题所述分为三个部分：首先，推导等密度面斜率向量的一般表达式；其次，对给定密度场在特定点评估该向量及其大小；第三，对结果进行物理解释。\n\n等密度面被定义为密度函数的等值面，$\\rho(x,y,z) = \\rho^{\\ast}$，其中 $\\rho^{\\ast}$ 是一个常数。任何等值面的一个关键性质是，函数的梯度 $\\nabla \\rho$ 处处与该面垂直（正交）。对于一个完全位于等密度面内的微小位移 $d\\boldsymbol{r} = (dx, dy, dz)$，密度变化 $d\\rho$ 必须为零。根据链式法则，$\\rho$ 的全微分为：\n$$\nd\\rho = \\frac{\\partial \\rho}{\\partial x} dx + \\frac{\\partial \\rho}{\\partial y} dy + \\frac{\\partial \\rho}{\\partial z} dz\n$$\n令 $d\\rho = 0$ 得到在任意点 $(x,y,z)$ 处等密度面的切平面方程：\n$$\n\\frac{\\partial \\rho}{\\partial x} dx + \\frac{\\partial \\rho}{\\partial y} dy + \\frac{\\partial \\rho}{\\partial z} dz = 0\n$$\n问题将等密度面斜率向量 $\\boldsymbol{s}$ 的分量定义为 $s_x = \\left(\\frac{\\partial z}{\\partial x}\\right)_{\\rho^{\\ast}}$ 和 $s_y = \\left(\\frac{\\partial z}{\\partial y}\\right)_{\\rho^{\\ast}}$。这些偏导数表示在保持在特定等密度面 $\\rho = \\rho^{\\ast}$ 上的同时，深度 $z$ 相对于水平坐标 $x$ 和 $y$ 的变化率。\n\n为了求出 $s_x$，我们考虑沿该面的一个位移，其中 $y$ 保持不变，即 $dy = 0$。条件 $d\\rho=0$ 简化为：\n$$\n\\frac{\\partial \\rho}{\\partial x} dx + \\frac{\\partial \\rho}{\\partial z} dz = 0\n$$\n在保持 $y$ 和 $\\rho$ 不变的情况下，重新整理此方程以求出比率 $dz/dx$，得到 $s_x$ 的表达式：\n$$\ns_x = \\left(\\frac{\\partial z}{\\partial x}\\right)_{\\rho^{\\ast}} = -\\frac{\\partial \\rho / \\partial x}{\\partial \\rho / \\partial z}\n$$\n该推导在 $\\partial \\rho / \\partial z \\neq 0$ 的条件下有效。问题指出分层是稳定的，$\\partial \\rho / \\partial z  0$，从而满足了这个条件。\n\n类似地，为了求出 $s_y$，我们考虑沿该面的一个位移，其中 $x$ 保持不变，即 $dx = 0$。条件 $d\\rho=0$ 变为：\n$$\n\\frac{\\partial \\rho}{\\partial y} dy + \\frac{\\partial \\rho}{\\partial z} dz = 0\n$$\n在保持 $x$ 和 $\\rho$ 不变的情况下，重新整理以求出比率 $dz/dy$，得到 $s_y$ 的表达式：\n$$\ns_y = \\left(\\frac{\\partial z}{\\partial y}\\right)_{\\rho^{\\ast}} = -\\frac{\\partial \\rho / \\partial y}{\\partial \\rho / \\partial z}\n$$\n因此，等密度面斜率向量 $\\boldsymbol{s}$ 可以紧凑地用水平密度梯度 $\\nabla_h \\rho = \\frac{\\partial \\rho}{\\partial x} \\hat{\\boldsymbol{i}} + \\frac{\\partial \\rho}{\\partial y} \\hat{\\boldsymbol{j}}$ 和垂直密度梯度（分层）$\\frac{\\partial \\rho}{\\partial z}$ 来表示：\n$$\n\\boldsymbol{s} = s_x \\hat{\\boldsymbol{i}} + s_y \\hat{\\boldsymbol{j}} = -\\frac{\\nabla_h \\rho}{\\partial \\rho / \\partial z}\n$$\n这完成了问题的第一部分。\n\n接下来，我们为指定的密度场评估这个表达式：\n$$\n\\rho(x,y,z) = \\rho_0 + ax + by + cz + dxz + eyz\n$$\n首先，我们计算所需的偏导数：\n$$\n\\frac{\\partial \\rho}{\\partial x} = a + dz\n$$\n$$\n\\frac{\\partial \\rho}{\\partial y} = b + ez\n$$\n$$\n\\frac{\\partial \\rho}{\\partial z} = c + dx + ey\n$$\n现在，我们代入给定的系数和点的坐标 $(x_0, y_0, z_0) = (4.0 \\times 10^{4}\\,\\mathrm{m}, 3.0 \\times 10^{4}\\,\\mathrm{m}, 1.0 \\times 10^{3}\\,\\mathrm{m})$。\n系数为：\n$a = 2.0 \\times 10^{-5}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}$，$b = -1.0 \\times 10^{-5}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}$，$c = 1.5 \\times 10^{-2}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}$，$d = 1.0 \\times 10^{-7}\\,\\mathrm{kg}\\,\\mathrm{m}^{-5}$，以及 $e = -2.0 \\times 10^{-7}\\,\\mathrm{kg}\\,\\mathrm{m}^{-5}$。\n\n我们在 $(x_0, y_0, z_0)$ 处评估梯度：\n$$\n\\frac{\\partial \\rho}{\\partial x} \\bigg|_{(x_0,y_0,z_0)} = (2.0 \\times 10^{-5}) + (1.0 \\times 10^{-7})(1.0 \\times 10^{3}) = 2.0 \\times 10^{-5} + 1.0 \\times 10^{-4} = 1.2 \\times 10^{-4}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}\n$$\n$$\n\\frac{\\partial \\rho}{\\partial y} \\bigg|_{(x_0,y_0,z_0)} = (-1.0 \\times 10^{-5}) + (-2.0 \\times 10^{-7})(1.0 \\times 10^{3}) = -1.0 \\times 10^{-5} - 2.0 \\times 10^{-4} = -2.1 \\times 10^{-4}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}\n$$\n$$\n\\frac{\\partial \\rho}{\\partial z} \\bigg|_{(x_0,y_0,z_0)} = (1.5 \\times 10^{-2}) + (1.0 \\times 10^{-7})(4.0 \\times 10^{4}) + (-2.0 \\times 10^{-7})(3.0 \\times 10^{4})\n$$\n$$\n\\frac{\\partial \\rho}{\\partial z} \\bigg|_{(x_0,y_0,z_0)} = 1.5 \\times 10^{-2} + 4.0 \\times 10^{-3} - 6.0 \\times 10^{-3} = 1.5 \\times 10^{-2} - 2.0 \\times 10^{-3} = 0.015 - 0.002 = 0.013\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}\n$$\n由于 $0.013  0$，在该点满足稳定性条件。现在我们计算斜率分量，它们是无量纲的：\n$$\ns_x = -\\frac{1.2 \\times 10^{-4}}{0.013} \\approx -0.009230769...\n$$\n$$\ns_y = -\\frac{-2.1 \\times 10^{-4}}{0.013} \\approx 0.016153846...\n$$\n四舍五入到四位有效数字，我们得到 $s_x = -0.009231$ 和 $s_y = 0.01615$。\n斜率向量为 $\\boldsymbol{s} \\approx -0.009231\\,\\hat{\\boldsymbol{i}} + 0.01615\\,\\hat{\\boldsymbol{j}}$。\n\n斜率向量的大小为 $|\\boldsymbol{s}| = \\sqrt{s_x^2 + s_y^2}$：\n$$\n|\\boldsymbol{s}| = \\sqrt{(-0.009230769...)^2 + (0.016153846...)^2} = \\sqrt{8.5206... \\times 10^{-5} + 2.6094... \\times 10^{-4}}\n$$\n$$\n|\\boldsymbol{s}| = \\sqrt{3.4615... \\times 10^{-4}} \\approx 0.0186052...\n$$\n四舍五入到四位有效数字，大小为 $|\\boldsymbol{s}| = 0.01861$。\n\n最后，我们提供一个物理解释。推导出的表达式 $\\boldsymbol{s} = - \\frac{\\nabla_h \\rho}{\\partial\\rho / \\partial z}$ 表明，局部等密度面斜率由水平密度梯度与垂直分层之比决定。\n分子 $\\nabla_h \\rho$ 代表密度变化的水平强迫。分母 $\\partial\\rho/\\partial z  0$ 代表垂直分层，它由于浮力而抵抗垂直运动。一个较大的 $\\partial\\rho/\\partial z$ 值对应于一个更“刚性”分层的流体，使得垂直移动流体质点在能量上代价高昂。\n向量 $\\boldsymbol{s}$ 指向与水平密度梯度 $\\nabla_h \\rho$ 相反的方向。这意味着等密度面在水平密度减小的方向上向下倾斜。为了在移动到同一深度但密度较小的区域时保持在等密度面上，一个流体质点必须移动到更深处（即更大的 $z$ 值）。\n大小 $|\\boldsymbol{s}| = |\\nabla_h \\rho| / (\\partial\\rho/\\partial z)$ 量化了这种倾斜的陡峭程度。这个比率对于理解等密度面混合至关重要。由于混合优先沿着阻力最小的路径发生，它会沿着这些倾斜的等密度面进行。如果 $|\\boldsymbol{s}|$ 很大（相对于垂直分层，水平梯度很强），则等密度面很陡峭。沿着它们混合将具有显著的垂直分量，使得示踪物能在中等水平尺度上被输运很长的垂直距离。相反，如果 $|\\boldsymbol{s}|$ 很小（相对于强垂直分层，水平梯度很弱），则等密度面近似水平。此时混合主要是横向的，垂直输运非常少。\n在指定点，我们计算出 $|\\boldsymbol{s}| \\approx 0.01861$。这是一个很小的值，对于开阔海洋内部是典型的。它表示在最陡下降方向上，等密度面每水平移动100米，垂直方向上倾斜约1.861米。因此，等密度面混合的路径近似水平，这反映了垂直分层（$\\partial\\rho/\\partial z = 0.013\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}$）远强于水平密度强迫（$|\\nabla_h \\rho| \\approx 2.42 \\times 10^{-4}\\,\\mathrm{kg}\\,\\mathrm{m}^{-4}$）的事实。这种分层的主导作用严重抑制了垂直运动，从而将混合主要限制在缓坡的等密度面上。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.009231  0.01615  0.01861\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在了解了倾斜的等密度面之后，这项练习将探讨如何用数学方法来表示优先沿这些表面发生的混合过程。通过将简单的各向同性扩散模型与更复杂的旋转张量模型进行对比，本练习揭示了非对角张量项在正确模拟等密度面输运中的关键作用 。它清晰地展示了简化模型可能引入的谬误，并强调了使用与物理过程相符的数学工具的重要性。",
            "id": "3886488",
            "problem": "考虑一个二维稳定分层流体，位于坐标为 $(x,z)$ 的垂直平面内，其中 $z$ 轴向上递增。流体密度场定义了相对于水平面具有恒定斜率 $s$ 的局部直线等密（恒定密度）线。该域在 $x$ 和 $z$ 方向上是双周期的。假设没有平流，也没有源或汇，因此标量浓度 $C(x,z,t)$ 的演化纯粹由扩散决定，受偏微分方程(PDE) $\\partial C/\\partial t = \\nabla \\cdot (\\mathbf{K}\\,\\nabla C)$ 控制，其中扩散张量 $\\mathbf{K}$ 为常数。\n\n您将比较 $\\mathbf{K}$ 的两种闭合方案：\n\n1. 各向同性扩散率：$\\mathbf{K} = \\kappa\\,\\mathbf{I}$，其中 $\\kappa$ 为常数。\n\n2. 旋转的等密-跨密扩散率：将等密线的单位法向量定义为 $\\mathbf{n} = (-s,\\,1)/\\sqrt{1+s^{2}}$，到等密线上的投影算子定义为 $\\mathbf{P} = \\mathbf{I} - \\mathbf{n}\\mathbf{n}^{\\top}$。令 $K_{I}$ 表示沿等密线（等密）扩散率，$K_{D}$ 表示跨等密线（跨密）扩散率，二者均为常数。旋转张量定义为 $\\mathbf{K} = K_{I}\\,\\mathbf{P} + K_{D}\\,\\mathbf{n}\\mathbf{n}^{\\top}$。\n\n设 $t=0$ 时的示踪剂场为 $C(x,z,0) = \\hat{C}\\,\\cos(k x)\\cos(m z)$，其中 $\\hat{C}$ 是一个具有浓度物理单位的恒定振幅，$k$ 和 $m$ 是单位为 $\\mathrm{m^{-1}}$ 的正常数（波数）。仅考虑关于 $(x,z)$ 的二维散度和梯度。\n\n仅使用给定的定义和守恒定律，推导在点 $(x_{\\star},z_{\\star}) = \\left(\\frac{\\pi}{2k},\\,\\frac{\\pi}{2m}\\right)$ 处，两种闭合方案的瞬时扩散引起的倾向 $\\left.\\partial C/\\partial t\\right|_{t=0}$。然后计算该点上“旋转减去各向同性”的差值。将您的最终答案表示为仅含 $\\hat{C}$、$k$、$m$、$s$、$K_{I}$ 和 $K_{D}$ 的单个闭式解析表达式。\n\n在解释量纲一致性时，请使用以下单位约定：$K_{I}$、$K_{D}$ 和 $\\kappa$ 的单位为 $\\mathrm{m^{2}\\,s^{-1}}$，$k$ 和 $m$ 的单位为 $\\mathrm{m^{-1}}$，$\\hat{C}$ 的单位为 $\\mathrm{mol\\,m^{-3}}$。最终倾向的单位表示为 $\\mathrm{mol\\,m^{-3}\\,s^{-1}}$。请勿在最终的方框答案中包含单位。",
            "solution": "该问题经评估有效，因其具有科学依据、适定且客观。它基于二维域中的标准扩散方程，这是输运现象和地球物理流体动力学中的一个核心概念。各向同性扩散张量和旋转的各向异性扩散张量的定义在该领域是标准的。该问题是自洽的，并提供了推导唯一解而无歧义所需的所有信息。\n\n标量浓度 $C(x,z,t)$ 的演化由扩散方程控制：\n$$\n\\frac{\\partial C}{\\partial t} = \\nabla \\cdot (\\mathbf{K}\\,\\nabla C)\n$$\n坐标为 $(x,z)$。由于扩散张量 $\\mathbf{K}$ 给定为常数，其分量不随空间变化。该方程可以展开为：\n$$\n\\frac{\\partial C}{\\partial t} = \\sum_{i,j \\in \\{x,z\\}} \\partial_i (K_{ij} \\partial_j C) = \\sum_{i,j \\in \\{x,z\\}} K_{ij} \\frac{\\partial^2 C}{\\partial x_i \\partial x_j}\n$$\n其中 $x_x=x$ 且 $x_z=z$。对于对称张量 $\\mathbf{K}$ ($K_{xz} = K_{zx}$)，这是被动示踪剂物理上所要求的，并且对两种给定的闭合方案都成立，该方程变为：\n$$\n\\frac{\\partial C}{\\partial t} = K_{xx} \\frac{\\partial^2 C}{\\partial x^2} + 2 K_{xz} \\frac{\\partial^2 C}{\\partial x \\partial z} + K_{zz} \\frac{\\partial^2 C}{\\partial z^2}\n$$\n我们需要在时间 $t=0$ 和点 $(x_{\\star},z_{\\star}) = \\left(\\frac{\\pi}{2k},\\,\\frac{\\pi}{2m}\\right)$ 处计算该表达式的值。初始浓度场由 $C(x,z,0) = \\hat{C}\\,\\cos(k x)\\cos(m z)$ 给出。\n\n首先，我们计算 $C(x,z,0)$ 所需的二阶偏导数：\n$$\n\\frac{\\partial^2 C}{\\partial x^2}(x,z,0) = \\frac{\\partial}{\\partial x} \\left( -k \\hat{C} \\sin(kx) \\cos(mz) \\right) = -k^2 \\hat{C} \\cos(kx) \\cos(mz) = -k^2 C(x,z,0)\n$$\n$$\n\\frac{\\partial^2 C}{\\partial z^2}(x,z,0) = \\frac{\\partial}{\\partial z} \\left( -m \\hat{C} \\cos(kx) \\sin(mz) \\right) = -m^2 \\hat{C} \\cos(kx) \\cos(mz) = -m^2 C(x,z,0)\n$$\n$$\n\\frac{\\partial^2 C}{\\partial x \\partial z}(x,z,0) = \\frac{\\partial}{\\partial x} \\left( -m \\hat{C} \\cos(kx) \\sin(mz) \\right) = km \\hat{C} \\sin(kx) \\sin(mz)\n$$\n接下来，我们在指定点 $(x_{\\star},z_{\\star}) = \\left(\\frac{\\pi}{2k},\\,\\frac{\\pi}{2m}\\right)$ 计算这些导数的值：\n$$\nC(x_{\\star},z_{\\star},0) = \\hat{C}\\,\\cos\\left(k \\frac{\\pi}{2k}\\right)\\cos\\left(m \\frac{\\pi}{2m}\\right) = \\hat{C}\\,\\cos\\left(\\frac{\\pi}{2}\\right)\\cos\\left(\\frac{\\pi}{2}\\right) = \\hat{C} \\cdot 0 \\cdot 0 = 0\n$$\n因此，该点的非混合二阶偏导数为零：\n$$\n\\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{(x_{\\star},z_{\\star}), t=0} = -k^2 C(x_{\\star},z_{\\star},0) = 0\n$$\n$$\n\\left.\\frac{\\partial^2 C}{\\partial z^2}\\right|_{(x_{\\star},z_{\\star}), t=0} = -m^2 C(x_{\\star},z_{\\star},0) = 0\n$$\n混合二阶偏导数非零：\n$$\n\\left.\\frac{\\partial^2 C}{\\partial x \\partial z}\\right|_{(x_{\\star},z_{\\star}), t=0} = km \\hat{C} \\sin\\left(k \\frac{\\pi}{2k}\\right)\\sin\\left(m \\frac{\\pi}{2m}\\right) = km \\hat{C} \\sin\\left(\\frac{\\pi}{2}\\right)\\sin\\left(\\frac{\\pi}{2}\\right) = km \\hat{C} \\cdot 1 \\cdot 1 = km \\hat{C}\n$$\n将这些值代入展开的扩散方程，我们得到在指定点和时间的瞬时倾向：\n$$\n\\left.\\frac{\\partial C}{\\partial t}\\right|_{(x_{\\star},z_{\\star}), t=0} = K_{xx} \\cdot 0 + 2 K_{xz} (km \\hat{C}) + K_{zz} \\cdot 0 = 2 km \\hat{C} K_{xz}\n$$\n在这个特定点上的倾向仅取决于扩散张量的非对角分量 $K_{xz}$。我们现在为两种给定的闭合方案计算该值。\n\n情况1：各向同性扩散率\n扩散张量为 $\\mathbf{K}_{\\text{iso}} = \\kappa\\,\\mathbf{I}$，其中 $\\mathbf{I}$ 是单位矩阵。其分量形式为：\n$$\n\\mathbf{K}_{\\text{iso}} = \\begin{pmatrix} \\kappa  0 \\\\ 0  \\kappa \\end{pmatrix}\n$$\n非对角分量 $K_{xz} = 0$。因此，各向同性情况下的倾向为：\n$$\n\\left(\\frac{\\partial C}{\\partial t}\\right)_{\\text{iso}} = 2 km \\hat{C} \\cdot (0) = 0\n$$\n\n情况2：旋转的等密-跨密扩散率\n扩散张量由 $\\mathbf{K}_{\\text{rot}} = K_{I}\\,\\mathbf{P} + K_{D}\\,\\mathbf{n}\\mathbf{n}^{\\top}$ 给出。我们需要求出该张量的 $K_{xz}$ 分量。\n等密线的单位法向量为 $\\mathbf{n} = \\frac{1}{\\sqrt{1+s^2}}\\begin{pmatrix} -s \\\\ 1 \\end{pmatrix}$。\n外积 $\\mathbf{n}\\mathbf{n}^{\\top}$ 为：\n$$\n\\mathbf{n}\\mathbf{n}^{\\top} = \\frac{1}{1+s^2} \\begin{pmatrix} -s \\\\ 1 \\end{pmatrix} \\begin{pmatrix} -s  1 \\end{pmatrix} = \\frac{1}{1+s^2} \\begin{pmatrix} s^2  -s \\\\ -s  1 \\end{pmatrix}\n$$\n到等密线上的投影算子为 $\\mathbf{P} = \\mathbf{I} - \\mathbf{n}\\mathbf{n}^{\\top}$：\n$$\n\\mathbf{P} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\frac{1}{1+s^2} \\begin{pmatrix} s^2  -s \\\\ -s  1 \\end{pmatrix} = \\frac{1}{1+s^2} \\left[ \\begin{pmatrix} 1+s^2  0 \\\\ 0  1+s^2 \\end{pmatrix} - \\begin{pmatrix} s^2  -s \\\\ -s  1 \\end{pmatrix} \\right] = \\frac{1}{1+s^2} \\begin{pmatrix} 1  s \\\\ s  s^2 \\end{pmatrix}\n$$\n现在，我们构建 $\\mathbf{K}_{\\text{rot}}$：\n$$\n\\mathbf{K}_{\\text{rot}} = K_I \\left( \\frac{1}{1+s^2} \\begin{pmatrix} 1  s \\\\ s  s^2 \\end{pmatrix} \\right) + K_D \\left( \\frac{1}{1+s^2} \\begin{pmatrix} s^2  -s \\\\ -s  1 \\end{pmatrix} \\right)\n$$\n$$\n\\mathbf{K}_{\\text{rot}} = \\frac{1}{1+s^2} \\begin{pmatrix} K_I + s^2 K_D  s K_I - s K_D \\\\ s K_I - s K_D  s^2 K_I + K_D \\end{pmatrix} = \\frac{1}{1+s^2} \\begin{pmatrix} K_I + s^2 K_D  s(K_I - K_D) \\\\ s(K_I - K_D)  s^2 K_I + K_D \\end{pmatrix}\n$$\n非对角分量为 $K_{xz} = \\frac{s(K_I - K_D)}{1+s^2}$。\n旋转情况下的倾向为：\n$$\n\\left(\\frac{\\partial C}{\\partial t}\\right)_{\\text{rot}} = 2 km \\hat{C} K_{xz} = 2 km \\hat{C} \\left( \\frac{s(K_I - K_D)}{1+s^2} \\right) = \\frac{2km s \\hat{C}(K_I - K_D)}{1+s^2}\n$$\n\n最后，我们计算在指定点上“旋转减去各向同性”的差值：\n$$\n\\Delta\\left(\\frac{\\partial C}{\\partial t}\\right) = \\left(\\frac{\\partial C}{\\partial t}\\right)_{\\text{rot}} - \\left(\\frac{\\partial C}{\\partial t}\\right)_{\\text{iso}} = \\frac{2km s \\hat{C}(K_I - K_D)}{1+s^2} - 0\n$$\n差值的最终表达式为：\n$$\n\\frac{2km s \\hat{C}(K_I - K_D)}{1+s^2}\n$$\n该表达式仅取决于问题陈述中指定的参数。",
            "answer": "$$\n\\boxed{\\frac{2km s \\hat{C} (K_I - K_D)}{1+s^2}}\n$$"
        },
        {
            "introduction": "在探讨了等密度面混合之后，我们现在转向缓慢但至关重要的跨等密度面混合过程，它负责输运水体穿过密度界面。这项计算练习演示了一种海洋学中的关键参数化方法，该方法基于湍流能量耗散率（$\\epsilon$）与克服浮力所做功之间的能量平衡，来估算跨等密度面扩散率（$K_{\\rho}$）。这项实践将抽象的理论与根据观测数据估算混合率的实际应用联系起来。",
            "id": "3886524",
            "problem": "您的任务是推导并实现一种计算方法，用于评估在层状分层和分段常数浮力频率平方 $N^2(z)$ 条件下的稳定分层流体中，密度的跨等密度面扩散率 $K_{\\rho}(z)$ 的垂直剖面。计算基于给定的湍动能耗散率 $\\epsilon(z)$ 剖面和一个恒定的混合效率。该实现必须基于适用于环境和地球系统模拟的第一性原理，特别是分层流体中湍流混合的能量学观点。\n\n基本原理和定义：\n- 在稳定分层流体中，浮力频率（也称为 Brunt–Väisälä 频率）定义为 $N^2(z) = -\\frac{g}{\\rho_0} \\frac{\\partial \\rho}{\\partial z}$，其中 $g$ 是重力加速度，$\\rho_0$ 是参考密度。在本问题中，$N^2(z)$ 通过分层区间以分段常数函数的形式给出。\n- 湍流浮力通量 $B(z)$ 代表湍动能向势能的不可逆转换。在通量-梯度闭合假设下，稳定分层流体中浮力通量的大小与密度的跨等密度面扩散率的关系为 $|B(z)| = K_{\\rho}(z)\\,N^2(z)$。\n- 混合效率 $\\Gamma$ 定义为浮力通量的大小与湍动能耗散率之比，即 $\\Gamma = |B(z)|/\\epsilon(z)$，并被视为一个常数 $\\Gamma  0$。\n\n推导任务：\n- 从上述基本原理出发，推导一个联系 $K_{\\rho}(z)$、$\\epsilon(z)$、$N^2(z)$ 和常数 $\\Gamma$ 的 $K_{\\rho}(z)$ 表达式，并确保结果量纲一致。您的推导必须将通量-梯度闭合与混合效率的定义相协调。\n\n数值与算法要求：\n- 设垂直坐标为深度 $z$，单位为米 $\\mathrm{m}$，从表面（$z=0$）开始向下为正方向。\n- 函数 $N^2(z)$ 在指定的深度区间 $[z_{\\text{top}}, z_{\\text{bottom}})$ 上是分段常数，最后一个区间包含其底端点。对于一个查询深度 $z$，确定其对应的层及其恒定的 $N^2$ 值。\n- 函数 $\\epsilon(z)$ 以解析或分段形式给出。在指定的查询深度处计算 $\\epsilon(z)$。\n- 为避免在近中性分层中的数值爆炸，设置一个最小稳定阈值 $N_{\\min}^2  0$，并在计算 $K_{\\rho}(z)$ 时使用 $N_{\\text{eff}}^2(z) = \\max\\{N^2(z), N_{\\min}^2\\}$。\n- 使用您推导的表达式，在给定的查询深度处计算 $K_{\\rho}(z)$，单位为 $\\mathrm{m}^2/\\mathrm{s}$。将每个计算值以 $\\mathrm{m}^2/\\mathrm{s}$ 为单位，四舍五入到 $10$ 位小数。\n- 您的程序必须根据分层约定实现从 $z$ 到 $N^2(z)$ 的映射，在每个查询深度处计算 $\\epsilon(z)$，应用阈值 $N_{\\min}^2$，并生成所要求的输出。\n\n测试套件：\n实现您的程序以评估以下四个测试用例的 $K_{\\rho}(z)$。在所有情况下，均使用恒定的混合效率 $\\Gamma = 0.2$（无量纲）和阈值 $N_{\\min}^2 = 10^{-8}\\,\\mathrm{s}^{-2}$。\n\n1. 具有双层和指数衰减耗散的理想情况：\n   - $N^2(z)$ 的分层（单位 $\\mathrm{s}^{-2}$）：\n     - $[0\\,\\mathrm{m}, 50\\,\\mathrm{m})$: $N^2 = 5 \\times 10^{-4}$\n     - $[50\\,\\mathrm{m}, 200\\,\\mathrm{m}]$: $N^2 = 2 \\times 10^{-4}$\n   - 耗散剖面：$\\epsilon(z) = \\epsilon_0 \\exp(-z/H)$，其中 $\\epsilon_0 = 10^{-8}\\,\\mathrm{m}^2/\\mathrm{s}^3$, $H = 50\\,\\mathrm{m}$。\n   - 查询深度（单位 $\\mathrm{m}$）：$[0, 25, 50, 75, 150, 200]$。\n\n2. 上层分层极弱且耗散恒定的边缘情况：\n   - $N^2(z)$ 的分层（单位 $\\mathrm{s}^{-2}$）：\n     - $[0\\,\\mathrm{m}, 100\\,\\mathrm{m})$: $N^2 = 1 \\times 10^{-7}$\n     - $[100\\,\\mathrm{m}, 300\\,\\mathrm{m}]$: $N^2 = 3 \\times 10^{-4}$\n   - 耗散剖面：$\\epsilon(z) = 10^{-9}\\,\\mathrm{m}^2/\\mathrm{s}^3$（恒定）。\n   - 查询深度（单位 $\\mathrm{m}$）：$[0, 50, 100, 150, 250, 300]$。\n\n3. 具有高斯耗散峰值和背景值的三层分层：\n   - $N^2(z)$ 的分层（单位 $\\mathrm{s}^{-2}$）：\n     - $[0\\,\\mathrm{m}, 30\\,\\mathrm{m})$: $N^2 = 4 \\times 10^{-4}$\n     - $[30\\,\\mathrm{m}, 90\\,\\mathrm{m})$: $N^2 = 1.5 \\times 10^{-4}$\n     - $[90\\,\\mathrm{m}, 150\\,\\mathrm{m}]$: $N^2 = 3 \\times 10^{-4}$\n   - 耗散剖面：$\\epsilon(z) = \\epsilon_{\\text{bg}} + \\epsilon_0 \\exp\\!\\left(-\\tfrac{1}{2}\\left(\\frac{z - z_0}{\\sigma}\\right)^2\\right)$，其中 $\\epsilon_{\\text{bg}} = 10^{-10}\\,\\mathrm{m}^2/\\mathrm{s}^3$, $\\epsilon_0 = 5 \\times 10^{-8}\\,\\mathrm{m}^2/\\mathrm{s}^3$, $z_0 = 60\\,\\mathrm{m}$, $\\sigma = 20\\,\\mathrm{m}$。\n   - 查询深度（单位 $\\mathrm{m}$）：$[10, 30, 60, 90, 120, 150]$。\n\n4. 包含静止层（零耗散）和双层分层的分段耗散：\n   - $N^2(z)$ 的分层（单位 $\\mathrm{s}^{-2}$）：\n     - $[0\\,\\mathrm{m}, 100\\,\\mathrm{m})$: $N^2 = 3 \\times 10^{-4}$\n     - $[100\\,\\mathrm{m}, 200\\,\\mathrm{m}]$: $N^2 = 1 \\times 10^{-4}$\n   - 耗散剖面：\n     - 对于 $0 \\le z  50\\,\\mathrm{m}$: $\\epsilon(z) = 10^{-8}\\,\\mathrm{m}^2/\\mathrm{s}^3$,\n     - 对于 $50 \\le z  100\\,\\mathrm{m}$: $\\epsilon(z) = 0\\,\\mathrm{m}^2/\\mathrm{s}^3$,\n     - 对于 $100 \\le z \\le 200\\,\\mathrm{m}$: $\\epsilon(z) = 2 \\times 10^{-9}\\,\\mathrm{m}^2/\\mathrm{s}^3$。\n   - 查询深度（单位 $\\mathrm{m}$）：$[25, 75, 125, 175]$。\n\n答案规格与最终输出格式：\n- 对每个测试用例，返回一个列表，其中包含在给定查询深度处计算出的 $K_{\\rho}(z)$ 值（单位 $\\mathrm{m}^2/\\mathrm{s}$），每个值四舍五入到 $10$ 位小数。\n- 将四个用例的列表聚合为一个列表的列表。\n- 您的程序应生成单行输出，其中包含聚合结果，格式为用方括号括起来的逗号分隔列表，无空格。例如：\"[[x11,x12,...],[x21,x22,...],[x31,x32,...],[x41,x42,...]]\"，其中每个 $x_{ij}$ 是一个以 $\\mathrm{m}^2/\\mathrm{s}$ 为单位、格式化为 $10$ 位小数的浮点数。",
            "solution": "该问题是有效的，因为它科学上基于流体动力学的既定原理，在数学上和算法上是适定的，并且所有变量、常数和条件都得到了客观明确的定义。因此，我们可以进行推导和求解。\n\n**1. 跨等密度面扩散率表达式的推导**\n\n目标是利用给定的基本关系式，推导密度的跨等密度面扩散率 $K_{\\rho}(z)$ 的表达式。我们有两个关于湍流浮力通量大小 $|B(z)|$ 的独立表达式。\n\n首先，通量-梯度闭合将浮力通量与由浮力频率平方 $N^2(z)$ 表示的平均密度梯度联系起来。对于 $N^2(z)  0$ 的稳定分层流体，此关系为：\n$$\n|B(z)| = K_{\\rho}(z) N^2(z) \\quad (1)\n$$\n此处，$K_{\\rho}(z)$ 是跨等密度面扩散率，它参数化了湍涡在跨越等密度面（isopycnals）传输密度（从而传输浮力）的有效性。$K_{\\rho}(z)$ 的单位是 $\\mathrm{m}^2/\\mathrm{s}$，$N^2(z)$ 的单位是 $\\mathrm{s}^{-2}$，而 $|B(z)|$ 的单位是 $\\mathrm{m}^2/\\mathrm{s}^3$。注意，浮力定义为 $b = -g\\rho/\\rho_0$，因此浮力通量的单位是 $(\\mathrm{m}/\\mathrm{s}^2)(\\mathrm{kg}/\\mathrm{m}^3) / (\\mathrm{kg}/\\mathrm{m}^3) \\times (\\mathrm{m}/\\mathrm{s}) = \\mathrm{m}^2/\\mathrm{s}^3$，这与其作为单位质量势能变化率的作用是一致的。\n\n其次，Osborn-Cox 模型提供了一个能量学观点，将浮力通量与湍动能（TKE）耗散率 $\\epsilon(z)$ 联系起来。混合效率 $\\Gamma$ 定义为耗散的 TKE 中通过克服稳定分层做功而转化为势能的部分：\n$$\n\\Gamma = \\frac{|B(z)|}{\\epsilon(z)}\n$$\n这可以重排以表达浮力通量：\n$$\n|B(z)| = \\Gamma \\epsilon(z) \\quad (2)\n$$\n此处，$\\Gamma$ 是一个无量纲常数，而 $\\epsilon(z)$，即单位质量的 TKE 耗散率，单位为 $\\mathrm{m}^2/\\mathrm{s}^3$。\n\n通过将方程 $(1)$ 和 $(2)$ 中 $|B(z)|$ 的两个表达式相等，我们协调了通量-梯度和能量学的观点：\n$$\nK_{\\rho}(z) N^2(z) = \\Gamma \\epsilon(z)\n$$\n通过除以 $N^2(z)$（假设 $N^2(z) \\ne 0$）来求解 $K_{\\rho}(z)$，得到所需的表达式：\n$$\nK_{\\rho}(z) = \\frac{\\Gamma \\epsilon(z)}{N^2(z)}\n$$\n这个方程通常归功于 Osborn (1980)，是参数化分层流体中湍流混合的基石。\n\n我们进行量纲分析以确认其一致性。\n等式右边的单位是：\n$$\n\\frac{[\\Gamma][\\epsilon]}{[N^2]} = \\frac{(1) \\cdot (\\mathrm{m}^2/\\mathrm{s}^3)}{(\\mathrm{s}^{-2})} = \\frac{\\mathrm{m}^2}{\\mathrm{s}}\n$$\n这些是扩散率的单位（长度的平方每时间），与 $K_{\\rho}(z)$ 的单位相匹配。该表达式在量纲上是一致的。\n\n**2. 数值与算法实现**\n\n如果 $N^2(z)$ 非常小或为零，推导出的 $K_{\\rho}(z)$ 表达式可能导致数值不稳定或物理上不切实际的值。在近中性分层中，少量的湍流耗散可能产生任意大的、不符合物理的扩散率。为防止这种情况，我们引入一个浮力频率的最小阈值 $N_{\\min}^2$。在分母中使用有效浮力频率平方 $N_{\\text{eff}}^2(z)$：\n$$\nN_{\\text{eff}}^2(z) = \\max\\{N^2(z), N_{\\min}^2\\}\n$$\n因此，最终的计算公式为：\n$$\nK_{\\rho}(z) = \\frac{\\Gamma \\epsilon(z)}{N_{\\text{eff}}^2(z)}\n$$\n\n针对给定测试用例计算 $K_{\\rho}(z)$ 的算法如下：\n\n1.  **初始化常数**：设置全局常数 $\\Gamma = 0.2$ 和 $N_{\\min}^2 = 10^{-8}\\,\\mathrm{s}^{-2}$。\n\n2.  **定义剖面函数**：对每个测试用例，实现函数以返回任意给定深度 $z$ 处的 $N^2(z)$ 和 $\\epsilon(z)$ 的值。\n    *   **$N^2(z)$ 函数**：该函数将接收一个深度 $z$ 和一个分层定义的列表。它遍历这些层。对于定义在区间 $[z_{\\text{top}}, z_{\\text{bottom}})$ 上的给定层，它检查是否 $z_{\\text{top}} \\le z  z_{\\text{bottom}}$。问题规定最后一层的区间包含其底端点，因此对于最后一层，检查条件为 $z_{\\text{top}} \\le z \\le z_{\\text{bottom}}$。该函数返回匹配层的相应 $N^2$ 值。\n    *   **$\\epsilon(z)$ 函数**：该函数实现每个测试用例中为耗散提供的特定解析或分段公式。\n\n3.  **处理测试用例**：遍历四个测试用例中的每一个。\n    *   对每个测试用例，遍历指定的 `query_depths` 列表。\n    *   对每个 `query_depth` $z$：\n        a.  调用 $N^2(z)$ 函数以获取深度 $z$ 处的浮力频率平方。\n        b.  计算有效浮力频率平方：$N_{\\text{eff}}^2(z) = \\max\\{N^2(z), N_{\\min}^2\\}$。\n        c.  调用 $\\epsilon(z)$ 函数以获取深度 $z$ 处的耗散率。\n        d.  计算 $K_{\\rho}(z) = \\frac{\\Gamma \\epsilon(z)}{N_{\\text{eff}}^2(z)}$。\n        e.  存储计算出的 $K_{\\rho}(z)$ 值。\n\n4.  **格式化与输出**：收集每个测试用例的结果，即 $K_{\\rho}(z)$ 值的列表。每个数值都被格式化为 $10$ 位小数。最终输出是代表这些列表的列表的单个字符串，如问题陈述中所指定。\n\n这种系统化的方法确保了物理原理被正确地转化为一个稳健的数值算法，处理所有指定的条件，包括分层、边界条件和数值稳定性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements the calculation of diapycnal diffusivity K_rho(z)\n    for several test cases of stratified fluids.\n    \"\"\"\n\n    # --- Global Constants ---\n    GAMMA = 0.2  # Mixing efficiency\n    N_SQ_MIN = 1e-8  # Threshold for squared buoyancy frequency in s^-2\n\n    # --- Helper function for piecewise N^2(z) ---\n    def get_n_squared(z, n2_layers):\n        \"\"\"\n        Finds the value of N^2 at a given depth z from a list of layers.\n        Layers are defined as [( (z_top, z_bottom), value ), ...].\n        Intervals are [z_top, z_bottom), except for the last layer which is inclusive.\n        \"\"\"\n        num_layers = len(n2_layers)\n        for i, ((z_top, z_bottom), n2_val) in enumerate(n2_layers):\n            is_last_layer = (i == num_layers - 1)\n            if is_last_layer:\n                if z_top = z = z_bottom:\n                    return n2_val\n            else:\n                if z_top = z  z_bottom:\n                    return n2_val\n        # This part should not be reached for valid query depths\n        raise ValueError(f\"Depth z={z} is outside a valid layer.\")\n\n    # --- Epsilon function for Test Case 4 (piecewise) ---\n    def epsilon_case4(z):\n        if 0 = z  50:\n            return 1e-8\n        elif 50 = z  100:\n            return 0.0\n        elif 100 = z = 200:\n            return 2e-9\n        return 0.0 # Should not be reached\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        {\n            \"n2_layers\": [([0, 50], 5e-4), ([50, 200], 2e-4)],\n            \"epsilon_func\": lambda z: 1e-8 * np.exp(-z / 50.0),\n            \"query_depths\": [0, 25, 50, 75, 150, 200],\n        },\n        {\n            \"n2_layers\": [([0, 100], 1e-7), ([100, 300], 3e-4)],\n            \"epsilon_func\": lambda z: 1e-9,\n            \"query_depths\": [0, 50, 100, 150, 250, 300],\n        },\n        {\n            \"n2_layers\": [([0, 30], 4e-4), ([30, 90], 1.5e-4), ([90, 150], 3e-4)],\n            \"epsilon_func\": lambda z: 1e-10 + 5e-8 * np.exp(-0.5 * ((z - 60.0) / 20.0)**2),\n            \"query_depths\": [10, 30, 60, 90, 120, 150],\n        },\n        {\n            \"n2_layers\": [([0, 100], 3e-4), ([100, 200], 1e-4)],\n            \"epsilon_func\": epsilon_case4,\n            \"query_depths\": [25, 75, 125, 175],\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        case_results = []\n        n2_layers = case[\"n2_layers\"]\n        epsilon_func = case[\"epsilon_func\"]\n        query_depths = case[\"query_depths\"]\n\n        for z in query_depths:\n            # 1. Get N^2(z)\n            n_sq = get_n_squared(z, n2_layers)\n            \n            # 2. Apply threshold to get N_eff^2(z)\n            n_sq_eff = max(n_sq, N_SQ_MIN)\n            \n            # 3. Get epsilon(z)\n            epsilon = epsilon_func(z)\n            \n            # 4. Calculate K_rho(z)\n            k_rho = (GAMMA * epsilon) / n_sq_eff\n            \n            case_results.append(k_rho)\n            \n        all_results.append(case_results)\n\n    # --- Format the final output string ---\n    case_results_str = []\n    for res_list in all_results:\n        # Format each float to 10 decimal places\n        formatted_list = [f\"{x:.10f}\" for x in res_list]\n        case_results_str.append(f\"[{','.join(formatted_list)}]\")\n    \n    final_output = f\"[{','.join(case_results_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}