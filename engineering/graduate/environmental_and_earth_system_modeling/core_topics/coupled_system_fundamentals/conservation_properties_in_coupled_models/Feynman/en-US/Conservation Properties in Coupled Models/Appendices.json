{
    "hands_on_practices": [
        {
            "introduction": "To appreciate the importance of conservative methods, it is essential to first understand how seemingly reasonable approaches can fail. This foundational exercise guides you through a first-principles analysis of bilinear interpolation, a common and intuitive technique. By constructing a simple counterexample, you will demonstrate analytically why this method is not conservative, providing a clear, tangible grasp of how numerical remapping can inadvertently create or destroy a conserved quantity like mass .",
            "id": "3871283",
            "problem": "Consider a rectangular domain $\\Omega = [0,1] \\times [0,1]$ representing a portion of an Earth System Model (ESM) coupling interface where a scalar tracer field $q(x,y)$ is exchanged between component models. In a purely diagnostic grid-to-grid remapping, a conservative operator must preserve the global mass $M = \\int_{\\Omega} q(x,y)\\,dA$. A widely used non-conservative operator is bilinear interpolation, which constructs a polynomial $p(x,y)$ that matches given pointwise values of $q$ at grid nodes but does not, in general, preserve the area integral.\n\nStarting from first principles, do the following:\n\n1. Define the bilinear interpolant over $\\Omega$ in the form $p(x,y) = a + b x + c y + d x y$ that exactly matches the pointwise values of the source field $q(x,y)$ at the four corners $(0,0)$, $(1,0)$, $(0,1)$, and $(1,1)$.\n2. Derive the expression for the domain integral $\\int_{\\Omega} p(x,y)\\,dx\\,dy$ in terms of the coefficients $(a,b,c,d)$.\n3. Let the source field be $q(x,y) = x^{2}$ (a smooth non-bilinear field). Compute the coefficients $(a,b,c,d)$ of $p(x,y)$ that match $q$ at the four corners, and then evaluate $\\int_{\\Omega} p(x,y)\\,dx\\,dy$.\n4. Compute the true global mass $\\int_{\\Omega} q(x,y)\\,dx\\,dy$ and hence the change in global mass $\\Delta M = \\int_{\\Omega} p(x,y)\\,dx\\,dy - \\int_{\\Omega} q(x,y)\\,dx\\,dy$ caused by bilinear interpolation.\n\nProvide the final value of $\\Delta M$ as a single number. No units are required. If you choose to approximate any intermediate steps numerically, retain the exact final value.",
            "solution": "The conservation requirement for a passive tracer under grid-to-grid remapping is that the global mass $M = \\int_{\\Omega} q(x,y)\\,dA$ is invariant. A bilinear interpolant, defined from pointwise samples, does not generally preserve $M$ because it enforces pointwise agreement rather than area-weighted agreement.\n\nStep 1: Bilinear interpolant form and corner constraints.\n\nLet the bilinear interpolant be\n$$\np(x,y) = a + b x + c y + d x y.\n$$\nImposing pointwise agreement at the four corners of $\\Omega$ gives\n\n$$\np(0,0) = a = q(0,0), \\quad p(1,0) = a + b = q(1,0),\n$$\n\n\n$$\np(0,1) = a + c = q(0,1), \\quad p(1,1) = a + b + c + d = q(1,1).\n$$\n\nFrom these, the coefficients are\n\n$$\na = q(0,0), \\quad b = q(1,0) - q(0,0), \\quad c = q(0,1) - q(0,0), \\quad d = q(1,1) - q(1,0) - q(0,1) + q(0,0).\n$$\n\n\nStep 2: Domain integral of a bilinear polynomial.\n\nCompute the integral over $\\Omega$:\n\n$$\n\\int_{0}^{1}\\int_{0}^{1} p(x,y)\\,dx\\,dy = \\int_{0}^{1}\\int_{0}^{1} \\left(a + b x + c y + d x y\\right)\\,dx\\,dy.\n$$\n\nIntegrate term by term:\n\n$$\n\\int_{0}^{1}\\int_{0}^{1} a\\,dx\\,dy = a,\n$$\n\n\n$$\n\\int_{0}^{1}\\int_{0}^{1} b x\\,dx\\,dy = b \\left(\\int_{0}^{1} x\\,dx\\right)\\left(\\int_{0}^{1} dy\\right) = b \\cdot \\frac{1}{2} \\cdot 1 = \\frac{b}{2},\n$$\n\n\n$$\n\\int_{0}^{1}\\int_{0}^{1} c y\\,dx\\,dy = c \\left(\\int_{0}^{1} y\\,dy\\right)\\left(\\int_{0}^{1} dx\\right) = c \\cdot \\frac{1}{2} \\cdot 1 = \\frac{c}{2},\n$$\n\n\n$$\n\\int_{0}^{1}\\int_{0}^{1} d x y\\,dx\\,dy = d \\left(\\int_{0}^{1} x\\,dx\\right)\\left(\\int_{0}^{1} y\\,dy\\right) = d \\cdot \\frac{1}{2} \\cdot \\frac{1}{2} = \\frac{d}{4}.\n$$\n\nThus,\n\n$$\n\\int_{\\Omega} p(x,y)\\,dx\\,dy = a + \\frac{b}{2} + \\frac{c}{2} + \\frac{d}{4}.\n$$\n\nIf we substitute the corner-value expressions for $(a,b,c,d)$, this simplifies to one quarter of the sum of the corner values:\n\n$$\n\\int_{\\Omega} p(x,y)\\,dx\\,dy = \\frac{1}{4}\\left[q(0,0) + q(1,0) + q(0,1) + q(1,1)\\right].\n$$\n\nWe can verify this by substituting $a$, $b$, $c$, and $d$:\n\n$$\na + \\frac{b}{2} + \\frac{c}{2} + \\frac{d}{4} = q(0,0) + \\frac{q(1,0) - q(0,0)}{2} + \\frac{q(0,1) - q(0,0)}{2} + \\frac{q(1,1) - q(1,0) - q(0,1) + q(0,0)}{4},\n$$\n\nwhich reduces to\n\n$$\n\\frac{1}{4}\\left[q(0,0) + q(1,0) + q(0,1) + q(1,1)\\right].\n$$\n\n\nStep 3: Apply to $q(x,y) = x^{2}$.\n\nEvaluate the corner values:\n\n$$\nq(0,0) = 0^{2} = 0, \\quad q(1,0) = 1^{2} = 1,\n$$\n\n\n$$\nq(0,1) = 0^{2} = 0, \\quad q(1,1) = 1^{2} = 1.\n$$\n\nThus,\n\n$$\na = 0, \\quad b = 1 - 0 = 1, \\quad c = 0 - 0 = 0, \\quad d = 1 - 1 - 0 + 0 = 0,\n$$\n\nand the interpolant is\n\n$$\np(x,y) = 0 + 1 \\cdot x + 0 \\cdot y + 0 \\cdot x y = x.\n$$\n\nIts domain integral is\n\n$$\n\\int_{\\Omega} p(x,y)\\,dx\\,dy = \\int_{0}^{1}\\int_{0}^{1} x\\,dx\\,dy = \\left(\\int_{0}^{1} x\\,dx\\right)\\left(\\int_{0}^{1} dy\\right) = \\frac{1}{2} \\cdot 1 = \\frac{1}{2}.\n$$\n\n\nStep 4: True global mass and change caused by interpolation.\n\nCompute the true global mass:\n\n$$\n\\int_{\\Omega} q(x,y)\\,dx\\,dy = \\int_{0}^{1}\\int_{0}^{1} x^{2}\\,dx\\,dy = \\left(\\int_{0}^{1} x^{2}\\,dx\\right)\\left(\\int_{0}^{1} dy\\right) = \\frac{1}{3} \\cdot 1 = \\frac{1}{3}.\n$$\n\nTherefore, the change in global mass due to bilinear interpolation is\n\n$$\n\\Delta M = \\int_{\\Omega} p(x,y)\\,dx\\,dy - \\int_{\\Omega} q(x,y)\\,dx\\,dy = \\frac{1}{2} - \\frac{1}{3} = \\frac{1}{6}.\n$$\n\nThis explicit counterexample shows that bilinear interpolation is not conservative: it alters the global integral of the tracer field unless the field is itself bilinear over the cell (in which case the bilinear interpolant reproduces the field exactly and does not change the integral). For the non-bilinear choice $q(x,y)=x^{2}$, the mass increases by $\\Delta M = \\frac{1}{6}$ under bilinear interpolation from corner samples.",
            "answer": "$$\\boxed{\\frac{1}{6}}$$"
        },
        {
            "introduction": "Having established the need for conservation, we now explore the sophisticated mechanisms that achieve it within dynamic transport models. This practice delves into the core of modern finite-volume schemes, challenging you to distinguish between the structural properties that guarantee strict conservation and the separate role of slope limiters in maintaining monotonicity and accuracy. Answering these questions will provide a deeper conceptual understanding of how conservation laws are correctly discretized and implemented in advanced numerical models .",
            "id": "3871307",
            "problem": "A scalar tracer field $q(\\mathbf{x},t)$ with mass density $\\rho(\\mathbf{x},t)$ is transported by a velocity field $\\mathbf{u}(\\mathbf{x},t)$ on a control-volume mesh with cell volumes $V_i$. The governing conservation law in flux form is\n$$\n\\frac{\\partial}{\\partial t}\\left(\\rho q\\right) + \\nabla\\cdot\\left(\\rho q\\,\\mathbf{u}\\right) = 0,\n$$\ncoupled to the continuity equation\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla\\cdot\\left(\\rho\\,\\mathbf{u}\\right) = 0.\n$$\nConsider a finite-volume second-order Godunov-type scheme (for example, Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL)-Hancock) in which the extensive tracer mass $M_i \\equiv \\int_{V_i} \\rho q\\,dV$ is updated by face fluxes. Denote by $\\mathcal{F}_{m,f}$ the mass flux through face $f$ with area $A_f$ and by $\\mathcal{F}_{q,f}$ the tracer mass flux through the same face. A Riemann solver takes left and right states reconstructed by a slope limiter to produce a single numerical flux per face. The time integrator is explicit and satisfies the Strong Stability Preserving (SSP) property when fed with monotone spatial operators. The Courant–Friedrichs–Lewy (CFL) number is $C \\equiv \\max_f \\left(|\\mathbf{u}\\cdot\\mathbf{n}_f|\\,\\Delta t/\\Delta_\\perp\\right)$, where $\\mathbf{n}_f$ is the unit normal and $\\Delta_\\perp$ is the local normal mesh spacing.\n\nAssume the following implementation details:\n- The mass update uses $\\mathcal{F}_{m,f}$ computed once per face and applied with opposite signs to the two neighboring cells sharing face $f$.\n- The tracer update uses $\\mathcal{F}_{q,f} = \\mathcal{F}_{m,f}\\, q_f$, where $q_f$ is a face value reconstructed from neighboring cell averages using a slope limiter function $\\phi(r)$ applied to the local ratio of gradients $r$ in a standard Monotone Upstream-centered Scheme for Conservation Laws (MUSCL) construction.\n- Limiters under consideration include minmod, monotonized central, van Leer, Superbee, and the unlimited centered slope.\n- The mesh may be non-uniform, with variable face areas $A_f$ and cell volumes $V_i$.\n\nWhich of the following statements about the effect of limiter choices on strict conservation and monotonicity for the scalar tracer are correct?\n\nA. In a flux-form finite-volume scheme that computes a single interfacial numerical flux $\\mathcal{F}_{q,f}$ per face and applies it with opposite signs to neighboring cells, strict conservation of $\\sum_i M_i$ over a closed domain is independent of the limiter choice; the limiter changes $q_f$ (and thus dissipation) but not the antisymmetry of fluxes.\n\nB. If a post-reconstruction flux limiter is applied separately in each adjacent cell to clip $\\mathcal{F}_{q,f}$ after the Riemann solve (so that the two cells use different limited values at the same face), strict conservation can be violated because the face flux is no longer single-valued.\n\nC. In one spatial dimension, Total Variation Diminishing (TVD) limiters guarantee monotonicity of the cell averages of $q$ for linear advection when the CFL number satisfies $C \\leq 1$ for the second-order Godunov predictor–corrector; the unlimited centered-slope reconstruction does not guarantee monotonicity under the same condition.\n\nD. On a non-uniform grid with variable spacings and face areas, applying a standard TVD slope limiter that ignores grid non-uniformity still guarantees monotonicity of the intensive tracer $q$; TVD theory does not require accounting for mesh metrics.\n\nE. In compressible flow with variable $\\rho$, preserving a uniform tracer field $q(t=0)=q_0$ (tracer–mass consistency) requires that $\\mathcal{F}_{q,f}=\\mathcal{F}_{m,f}\\,q_f$ be formed with a single-valued $q_f$ consistent with the mass flux. Using different limiter choices or reconstructions for the mass and tracer fields can break this consistency and produce non-monotone $q$ even if both the mass and tracer equations are each discretely conservative.\n\nSelect all that apply. Provide your reasoning from the discrete conservation laws and the definitions of monotonicity and Total Variation Diminishing (TVD), starting from the finite-volume updates\n$$\nM_i^{n+1} = M_i^n - \\Delta t \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{q,f}, \\quad \\rho_i^{n+1} V_i = \\rho_i^n V_i - \\Delta t \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{m,f},\n$$\nwhere $s_{i,f}\\in\\{+1,-1\\}$ denotes the outward normal sign for cell $i$ on face $f$.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and internally consistent. It describes a standard problem in computational fluid dynamics concerning the numerical solution of coupled conservation laws. All technical terms are used appropriately, and the setup is sufficient to evaluate the provided statements. The problem is therefore valid.\n\nThe discrete finite-volume update for the extensive tracer mass $M_i = (\\rho q)_i V_i$ and the total mass in a cell $\\rho_i V_i$ are given as:\n$$\nM_i^{n+1} = M_i^n - \\Delta t \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{q,f}\n$$\n$$\n\\rho_i^{n+1} V_i = \\rho_i^n V_i - \\Delta t \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{m,f}\n$$\nwhere $s_{i,f} \\in \\{+1, -1\\}$ is a sign indicating whether the standard normal on face $f$ points outward ($+1$) or inward ($-1$) with respect to cell $V_i$. The total tracer mass in the domain is $M_{total} = \\sum_i M_i$.\n\n**A. In a flux-form finite-volume scheme that computes a single interfacial numerical flux $\\mathcal{F}_{q,f}$ per face and applies it with opposite signs to neighboring cells, strict conservation of $\\sum_i M_i$ over a closed domain is independent of the limiter choice; the limiter changes $q_f$ (and thus dissipation) but not the antisymmetry of fluxes.**\n\nTo assess the conservation of total tracer mass, we sum the update equation for $M_i$ over all cells $i$ in the domain:\n$$\n\\sum_i M_i^{n+1} = \\sum_i M_i^n - \\Delta t \\sum_i \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{q,f}\n$$\nThe change in total mass is $\\Delta M_{total} = M_{total}^{n+1} - M_{total}^{n} = - \\Delta t \\sum_i \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{q,f}$.\n\nThe double summation can be reordered as a sum over all faces in the mesh. For any *interior* face $f$, it is shared by two adjacent cells, let's call them $i$ and $j$. The face $f$ will appear twice in the summation: once as part of the boundary of cell $i$ ($\\partial V_i$) and once as part of the boundary of cell $j$ ($\\partial V_j$). By convention, the outward normal for one cell is the inward normal for the other, so their signs are opposite: $s_{i,f} = -s_{j,f}$.\n\nThe statement specifies that a *single* numerical flux $\\mathcal{F}_{q,f}$ is computed for the face. The contribution to the sum from this interior face $f$ is therefore:\n$$\ns_{i,f}\\,\\mathcal{F}_{q,f} + s_{j,f}\\,\\mathcal{F}_{q,f} = s_{i,f}\\,\\mathcal{F}_{q,f} - s_{i,f}\\,\\mathcal{F}_{q,f} = 0\n$$\nThis cancellation occurs for all interior faces, a property often called a telescoping sum. The total sum reduces to the sum of fluxes over the domain boundary faces only. For a closed domain, fluxes through the boundary are zero, so $\\Delta M_{total} = 0$.\n\nThe choice of slope limiter (e.g., minmod, van Leer) affects the reconstructed state $q_f$ and thus the value of the flux $\\mathcal{F}_{q,f} = \\mathcal{F}_{m,f}\\,q_f$. This changes the local truncation error and numerical dissipation of the scheme. However, it does not change the fundamental structure of the finite-volume method, which ensures that whatever the value of $\\mathcal{F}_{q,f}$ is, it is applied with opposite signs to the two cells sharing the face. This structural antisymmetry is the origin of discrete conservation. Therefore, strict conservation is guaranteed regardless of the specific (valid) limiter used.\n\n**Verdict:** **Correct**.\n\n**B. If a post-reconstruction flux limiter is applied separately in each adjacent cell to clip $\\mathcal{F}_{q,f}$ after the Riemann solve (so that the two cells use different limited values at the same face), strict conservation can be violated because the face flux is no longer single-valued.**\n\nThis statement describes an alternative limiting procedure, where the flux is modified *after* being calculated. Let the original single-valued flux be $\\mathcal{F}_{q,f}$. Cell $i$ uses a limited flux $\\mathcal{F}'_{q,f,i}$ and cell $j$ uses a limited flux $\\mathcal{F}'_{q,f,j}$. The updates for cells $i$ and $j$ involve these potentially different flux values.\n\nThe contribution to the change in total mass from the face $f$ between cells $i$ and $j$ is now:\n$$\ns_{i,f}\\,\\mathcal{F}'_{q,f,i} + s_{j,f}\\,\\mathcal{F}'_{q,f,j}\n$$\nUsing $s_{j,f} = -s_{i,f}$, this becomes:\n$$\ns_{i,f}\\,(\\mathcal{F}'_{q,f,i} - \\mathcal{F}'_{q,f,j})\n$$\nSince the limiting is applied \"separately in each adjacent cell,\" based on local conditions within each cell, there is no mechanism to ensure that $\\mathcal{F}'_{q,f,i} = \\mathcal{F}'_{q,f,j}$. In general, they will be different. Consequently, the term $(\\mathcal{F}'_{q,f,i} - \\mathcal{F}'_{q,f,j})$ will not be zero. The fluxes at interior faces no longer cancel, and the scheme introduces artificial sources or sinks of tracer mass, violating strict conservation. This is a well-known pitfall of such flux limiting strategies, contrasting with slope limiting (as in MUSCL), which modifies states *before* the single-valued flux calculation.\n\n**Verdict:** **Correct**.\n\n**C. In one spatial dimension, Total Variation Diminishing (TVD) limiters guarantee monotonicity of the cell averages of $q$ for linear advection when the CFL number satisfies $C \\leq 1$ for the second-order Godunov predictor–corrector; the unlimited centered-slope reconstruction does not guarantee monotonicity under the same condition.**\n\nThis statement concerns properties of MUSCL-type schemes for the 1D linear advection equation, $\\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} = 0$.\nA numerical scheme is monotonicity-preserving if, for a monotonic initial data set $q^n$ (e.g., $q_i^n \\ge q_{i-1}^n$ for all $i$), the updated solution $q^{n+1}$ is also monotonic. Total Variation Diminishing (TVD) is the property that the total variation, $TV(q) = \\sum_i |q_{i+1} - q_i|$, does not increase, i.e., $TV(q^{n+1}) \\le TV(q^n)$. TVD schemes are non-oscillatory and, by construction, preserve monotonicity.\n\nFor second-order Godunov-type schemes (like MUSCL-Hancock), it is a standard result that using a slope limiter whose function $\\phi(r)$ lies within the TVD region (e.g., minmod, van Leer, Superbee) makes the scheme TVD, provided a CFL condition is met. For many explicit predictor-corrector schemes, this condition is $C \\equiv |u| \\Delta t / \\Delta x \\le 1$. Therefore, these limiters ensure the resulting scheme is monotonicity-preserving under this condition.\n\nThe \"unlimited centered-slope\" reconstruction corresponds to the original second-order linear schemes like Lax-Wendroff. This is equivalent to choosing a limiter function $\\phi(r)=1$, which falls outside the TVD region defined for $r>0$. It is well-established that such unlimited schemes are not monotonicity-preserving and produce spurious oscillations (overshoots and undershoots) near sharp gradients or discontinuities.\n\n**Verdict:** **Correct**.\n\n**D. On a non-uniform grid with variable spacings and face areas, applying a standard TVD slope limiter that ignores grid non-uniformity still guarantees monotonicity of the intensive tracer $q$; TVD theory does not require accounting for mesh metrics.**\n\nThis statement is incorrect. The classical TVD theory and the derivation of the boundaries for limiter functions (the \"TVD region\") are performed assuming a uniform grid, i.e., constant cell size $\\Delta x$. On a non-uniform grid, the discrete finite-volume operator changes. The update for the cell average $q_i$ is $q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x_i} (\\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2})$, where $\\Delta x_i$ is the width of cell $i$. The flux $\\mathcal{F}$ depends on slopes, which themselves depend on grid spacings, e.g., slope in cell $i$ is approx. $(q_{i+1}-q_{i-1}) / (\\Delta x_i + (\\Delta x_{i+1}+\\Delta x_{i-1})/2)$.\n\nThe condition for a scheme to be TVD requires the updated value $q_i^{n+1}$ to be expressible as a convex combination of the values in neighboring cells at time $n$. The coefficients of this combination depend directly on the grid metrics ($\\Delta x_i$, $\\Delta x_{i+1}$, etc.). If a \"standard\" limiter (designed for a uniform grid) is used, which typically operates on the ratio of successive differences of $q$ values (e.g., $r = (q_i-q_{i-1})/(q_{i+1}-q_i)$) without accounting for the corresponding grid spacings, the conditions for the scheme to be TVD are generally violated. The scheme can lose its monotonicity-preserving property and even its second-order accuracy. Developing TVD schemes for non-uniform grids requires careful modification of the reconstruction and limiting procedures to properly incorporate the mesh geometry. The assertion that TVD theory does not require accounting for mesh metrics is false.\n\n**Verdict:** **Incorrect**.\n\n**E. In compressible flow with variable $\\rho$, preserving a uniform tracer field $q(t=0)=q_0$ (tracer–mass consistency) requires that $\\mathcal{F}_{q,f}=\\mathcal{F}_{m,f}\\,q_f$ be formed with a single-valued $q_f$ consistent with the mass flux. Using different limiter choices or reconstructions for the mass and tracer fields can break this consistency and produce non-monotone $q$ even if both the mass and tracer equations are each discretely conservative.**\n\nThis property, often called tracer-mass consistency or compatibility with the continuity equation, is crucial for coupled systems. We analyze the update for the intensive tracer $q_i = M_i / (\\rho_i V_i) = (\\rho q)_i / \\rho_i$.\n$$\nq_i^{n+1} = \\frac{M_i^{n+1}}{\\rho_i^{n+1} V_i} = \\frac{M_i^n - \\Delta t \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{q,f}}{\\rho_i^n V_i - \\Delta t \\sum_{f\\in \\partial V_i} s_{i,f}\\,\\mathcal{F}_{m,f}}\n$$\nLet's assume the initial condition is a uniform tracer field, $q(\\mathbf{x},t=0) = q_0$. This means $q_i^n = q_0$ for all cells $i$, and thus $M_i^n = (\\rho q)_i^n V_i = \\rho_i^n q_0 V_i$.\nThe problem states the tracer flux is constructed as $\\mathcal{F}_{q,f} = \\mathcal{F}_{m,f}\\,q_f$. If all cell-average values $q_i$ are equal to $q_0$, any reasonable reconstruction method (including MUSCL with any limiter) will produce a constant reconstruction. Thus, the value at any face will be $q_f = q_0$.\nSubstituting these into the update formula for $q_i^{n+1}$:\n$$\nq_i^{n+1} = \\frac{\\rho_i^n q_0 V_i - \\Delta t \\sum_{f} s_{i,f}\\,(\\mathcal{F}_{m,f}q_0)}{\\rho_i^n V_i - \\Delta t \\sum_{f} s_{i,f}\\,\\mathcal{F}_{m,f}} = \\frac{q_0 \\left(\\rho_i^n V_i - \\Delta t \\sum_{f} s_{i,f}\\,\\mathcal{F}_{m,f}\\right)}{\\rho_i^n V_i - \\Delta t \\sum_{f} s_{i,f}\\,\\mathcal{F}_{m,f}} = q_0\n$$\nThe uniform tracer field is preserved, which is the desired consistency property. This cancellation critically relies on using the *same* mass flux $\\mathcal{F}_{m,f}$ in the numerator and denominator and having a consistent value for $q_f=q_0$.\n\nIf one uses \"different limiter choices or reconstructions for the mass and tracer fields,\" this consistency can be broken. For example, the mass flux $\\mathcal{F}_{m,f}$ is calculated from a Riemann solver for the hydrodynamic equations, which uses reconstructed states for $(\\rho, \\mathbf{u}, p)$. The value of $q_f$ is determined by reconstructing $q$. If the reconstruction for $q$ is inconsistent with the reconstruction for the hydrodynamic variables (e.g., using a different limiter, or a different upwinding decision), then the simple relation $\\mathcal{F}_{q,f} \\approx \\mathcal{F}_{m,f} q_f$ may not hold in the way required for the cancellation. This would introduce spurious sources or sinks for the intensive quantity $q$, leading to non-physical oscillations and loss of monotonicity, even if the schemes for mass and tracer mass are individually conservative.\n\n**Verdict:** **Correct**.",
            "answer": "$$\\boxed{ABCE}$$"
        },
        {
            "introduction": "This final practice transitions from theory to a complete implementation and verification workflow, a crucial skill for any model developer. You will first derive a first-order conservative remapping algorithm from fundamental principles and then implement it in code. Subsequently, you will apply a professional-grade \"cycle test\" to diagnose and quantify the numerical drift that arises from finite-precision arithmetic, revealing that even theoretically perfect schemes require rigorous testing to ensure their robustness in real-world applications .",
            "id": "3871306",
            "problem": "A scalar quantity is exchanged between two components of an environmental system model through a coupling interface that remaps fields between distinct one-dimensional computational grids covering the closed interval $\\left[0,1\\right]$. Each grid $\\mathcal{G}$ is defined by a strictly increasing sequence of cell edges $\\left\\{x_0, x_1, \\dots, x_N\\right\\}$ with $x_0 = 0$ and $x_N = 1$, and represents the scalar by cell-averaged values $\\left\\{c_i\\right\\}_{i=0}^{N-1}$ that are piecewise constant over each cell $\\left[x_i, x_{i+1}\\right)$. The global integral of the scalar over the domain is the sum of cell integrals, which for grid $\\mathcal{G}$ is $\\sum_{i=0}^{N-1} c_i \\,\\Delta x_i$ with $\\Delta x_i = x_{i+1} - x_i$.\n\nThe coupling uses a remapping operation intended to be conservative: when remapping from a source grid $\\mathcal{G}_S$ with edges $\\left\\{x^S_i\\right\\}$ and cell-averages $\\left\\{c^S_i\\right\\}$ to a target grid $\\mathcal{G}_T$ with edges $\\left\\{x^T_j\\right\\}$, the target cell-averages $\\left\\{c^T_j\\right\\}$ must be constructed so that the global integral on $\\mathcal{G}_T$ equals the global integral on $\\mathcal{G}_S$. Starting from the conservation law for a passive scalar and the definition of a cell-average as an integral normalized by the cell width, derive from first principles a correct algorithmic procedure for building $\\left\\{c^T_j\\right\\}$ from $\\left\\{c^S_i\\right\\}$ and the grid geometries $\\left\\{x^S_i\\right\\}$ and $\\left\\{x^T_j\\right\\}$ without losing or creating mass over the domain. Your derivation must use only the following bases:\n- The integral of a piecewise constant function over an interval equals the constant value times the interval length.\n- Conservation across a partition: the integral over the whole domain equals the sum of integrals over any exact partition of the domain.\n- The definition of a cell-average: the average over a cell equals the integral of the field over the cell divided by the cell width.\n\nYou will then design and implement a cycle test that repeatedly remaps back and forth between two grids to quantify numerical drift in global integrals caused by finite-precision arithmetic. The cycle test starts with an initial grid $\\mathcal{G}_A$ and its cell-averages $\\left\\{c^A_i\\right\\}$, remaps to a second grid $\\mathcal{G}_B$ to get $\\left\\{c^B_j\\right\\}$, and then remaps back to $\\mathcal{G}_A$ to obtain a new set $\\left\\{c^{A,(1)}_i\\right\\}$. This back-and-forth sequence is repeated for $n$ cycles, producing $\\left\\{c^{A,(n)}_i\\right\\}$. Define the drift metric for the cycle test as the absolute difference between the global integral on $\\mathcal{G}_A$ after $n$ cycles and the initial global integral on $\\mathcal{G}_A$,\n$$\nD_n \\equiv \\left| \\sum_{i=0}^{N_A-1} c^{A,(n)}_i \\,\\Delta x^A_i \\;-\\; \\sum_{i=0}^{N_A-1} c^{A,(0)}_i \\,\\Delta x^A_i \\right|.\n$$\nYou must construct the initial cell-averages $\\left\\{c^{A,(0)}_i\\right\\}$ by exact analytic integration of a continuous scalar field $f(x)$ over each cell of $\\mathcal{G}_A$, divided by the cell width. Let\n$$\nf(x) \\;=\\; \\sin\\!\\left(2\\pi x\\right) \\;+\\; 0.3\\,\\cos\\!\\left(5\\pi x\\right) \\;+\\; 0.5\\,x,\n$$\nand use exact antiderivatives to compute cell-integrals. Express the final drift values as dimensionless decimals.\n\nImplement a complete, runnable program that:\n- Constructs grids from specified rules.\n- Computes initial cell-averages on $\\mathcal{G}_A$ by analytic integration of $f(x)$.\n- Performs conservative remapping between grids according to your derived procedure.\n- Executes the cycle test for each specified case and outputs the drift metric $D_n$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $\\left[\\text{result}_1,\\text{result}_2,\\dots\\right]$). Each result must be a decimal number.\n\nUse the following test suite of parameter values to exercise different facets of the algorithm, including a general case, resolution mismatch, nonuniform geometry, identical grids as a boundary case, and severe resolution disparity. For each case, define grids $\\mathcal{G}_A$ and $\\mathcal{G}_B$ over $\\left[0,1\\right]$ and the number of cycles:\n- Case $1$: $\\mathcal{G}_A$ uniform with $N_A = 8$ cells, $\\mathcal{G}_B$ uniform with $N_B = 8$ cells, number of cycles $n = 10$.\n- Case $2$: $\\mathcal{G}_A$ uniform with $N_A = 10$ cells, $\\mathcal{G}_B$ uniform with $N_B = 12$ cells, number of cycles $n = 20$.\n- Case $3$: $\\mathcal{G}_A$ stretched nonuniform with $N_A = 64$ cells and edges $x^A_i = \\left(i/N_A\\right)^{1.7}$ for $i = 0,\\dots,64$, $\\mathcal{G}_B$ uniform with $N_B = 64$ cells, number of cycles $n = 50$.\n- Case $4$: $\\mathcal{G}_A$ uniform with $N_A = 32$ cells, $\\mathcal{G}_B$ identical to $\\mathcal{G}_A$, number of cycles $n = 100$.\n- Case $5$: $\\mathcal{G}_A$ uniform with $N_A = 5$ cells, $\\mathcal{G}_B$ uniform with $N_B = 200$ cells, number of cycles $n = 5$.\n\nYour program must compute and output the list $\\left[D_{n}^{(1)}, D_{n}^{(2)}, D_{n}^{(3)}, D_{n}^{(4)}, D_{n}^{(5)}\\right]$ in the exact single-line format described above. No angles or physical units are involved; results are dimensionless decimals.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It is a standard problem in the field of numerical methods for conservation laws, specifically focusing on conservative remapping between different computational grids. The task involves deriving the algorithm from first principles, implementing it, and using a cycle test to quantify numerical drift. The problem is therefore deemed **valid**.\n\nThe solution is presented in two parts: first, a derivation of the conservative remapping algorithm from the specified first principles, and second, an outline of the implementation for the cycle test and drift metric calculation.\n\n**1. Derivation of the Conservative Remapping Algorithm**\n\nThe objective is to compute a set of cell-average values $\\left\\{c^T_j\\right\\}$ on a target grid $\\mathcal{G}_T$ from a set of cell-average values $\\left\\{c^S_i\\right\\}$ on a source grid $\\mathcal{G}_S$, such that the global integral of the scalar quantity is conserved. The source field is a piecewise constant function $\\phi_S(x)$ which takes the value $c^S_i$ on the $i$-th cell interval $\\left[x^S_i, x^S_{i+1}\\right)$. The target field $\\phi_T(x)$ is similarly defined by values $c^T_j$ on cells $\\left[x^T_j, x^T_{j+1}\\right)$.\n\nGlobal conservation requires that the total integral on the target grid equals the total integral on the source grid:\n$$\n\\sum_{j=0}^{N_T-1} c^T_j \\Delta x^T_j = \\sum_{i=0}^{N_S-1} c^S_i \\Delta x^S_i\n$$\nwhere $\\Delta x^T_j = x^T_{j+1} - x^T_j$ and $\\Delta x^S_i = x^S_{i+1} - x^S_i$ are the respective cell widths.\n\nWe derive the formula for an individual target cell-average, $c^T_j$, based on the provided principles.\nFirst, by the definition of a cell-average, the value $c^T_j$ is the total amount (integral) of the scalar in the cell $\\left[x^T_j, x^T_{j+1}\\right)$, which we denote as $M^T_j$, divided by the cell's width $\\Delta x^T_j$:\n$$\nc^T_j = \\frac{M^T_j}{\\Delta x^T_j} = \\frac{1}{\\Delta x^T_j} \\int_{x^T_j}^{x^T_{j+1}} \\phi_T(x) \\, dx\n$$\nThe core principle of conservative remapping is that the mass in a target cell is determined by integrating the *source* field $\\phi_S(x)$ over the target cell's spatial interval.\n$$\nM^T_j = \\int_{x^T_j}^{x^T_{j+1}} \\phi_S(x) \\, dx\n$$\nSince the source grid $\\mathcal{G}_S$ forms an exact partition of the domain $\\left[0,1\\right]$, we can decompose the integral over the target cell interval $\\left[x^T_j, x^T_{j+1}\\right)$ into a sum of integrals over the regions where it intersects with each source cell $\\left[x^S_i, x^S_{i+1}\\right)$.\n$$\nM^T_j = \\sum_{i=0}^{N_S-1} \\int_{\\left[x^T_j, x^T_{j+1}\\right) \\cap \\left[x^S_i, x^S_{i+1}\\right)} \\phi_S(x) \\, dx\n$$\nWithin any non-empty intersection interval, the source field $\\phi_S(x)$ is constant and equal to $c^S_i$. Based on the principle that the integral of a constant is the constant times the interval length, the integral over the intersection becomes:\n$$\n\\int_{\\left[x^T_j, x^T_{j+1}\\right) \\cap \\left[x^S_i, x^S_{i+1}\\right)} c^S_i \\, dx = c^S_i \\cdot \\text{length}\\left(\\left[x^T_j, x^T_{j+1}\\right) \\cap \\left[x^S_i, x^S_{i+1}\\right)\\right)\n$$\nLet $\\Delta x_{ij}^{\\text{overlap}}$ denote the length of the intersection of source cell $i$ and target cell $j$. This length is given by:\n$$\n\\Delta x_{ij}^{\\text{overlap}} = \\max\\left(0, \\min\\left(x^S_{i+1}, x^T_{j+1}\\right) - \\max\\left(x^S_i, x^T_j\\right)\\right)\n$$\nSubstituting this into the expression for $M^T_j$, we obtain the total mass in target cell $j$ as a weighted sum of source cell values, where the weights are the overlap lengths:\n$$\nM^T_j = \\sum_{i=0}^{N_S-1} c^S_i \\, \\Delta x_{ij}^{\\text{overlap}}\n$$\nFinally, we obtain the expression for the target cell-average $c^T_j$ by dividing by the target cell width $\\Delta x^T_j$:\n$$\nc^T_j = \\frac{1}{\\Delta x^T_j} \\sum_{i=0}^{N_S-1} c^S_i \\, \\max\\left(0, \\min\\left(x^S_{i+1}, x^T_{j+1}\\right) - \\max\\left(x^S_i, x^T_j\\right)\\right)\n$$\nThis is the derived first-order conservative remapping algorithm. It explicitly guarantees that the remapped field conserves the scalar quantity in exact arithmetic. Any deviation from conservation in a practical implementation arises from finite-precision floating-point arithmetic, which is the subject of the cycle test.\n\n**2. Algorithmic Design for the Cycle Test**\n\nThe cycle test is implemented as follows:\nFirst, for each test case, the source grid $\\mathcal{G}_A$ and target grid $\\mathcal{G}_B$ are constructed according to the specified rules (uniform or stretched).\n\nNext, the initial cell-averages on grid $\\mathcal{G}_A$, denoted $\\left\\{c^{A,(0)}_i\\right\\}$, are computed. This is done by analytically integrating the specified continuous scalar field $f(x)$ over each cell of $\\mathcal{G}_A$. The function is:\n$$\nf(x) = \\sin(2\\pi x) + 0.3\\,\\cos(5\\pi x) + 0.5\\,x\n$$\nIts exact antiderivative $F(x)$ is:\n$$\nF(x) = -\\frac{1}{2\\pi}\\cos(2\\pi x) + \\frac{0.3}{5\\pi}\\sin(5\\pi x) + \\frac{1}{4}x^2\n$$\nThe integral over a cell $\\left[x^A_i, x^A_{i+1}\\right)$ is $F(x^A_{i+1}) - F(x^A_i)$. The initial cell-average is therefore:\n$$\nc^{A,(0)}_i = \\frac{F(x^A_{i+1}) - F(x^A_i)}{x^A_{i+1} - x^A_i}\n$$\nThe initial global integral on $\\mathcal{G}_A$ is calculated as $I^{A,(0)} = \\sum_{i=0}^{N_A-1} c^{A,(0)}_i \\Delta x^A_i$.\n\nThe cycle test then proceeds for a specified number of cycles, $n$. In each cycle $k$ (from $0$ to $n-1$):\n1.  The field is remapped from $\\mathcal{G}_A$ to $\\mathcal{G}_B$: $\\left\\{c^B_j\\right\\} = \\text{Remap}\\left(\\left\\{c^{A,(k)}_i\\right\\}, \\mathcal{G}_A, \\mathcal{G}_B\\right)$.\n2.  The field is remapped back from $\\mathcal{G}_B$ to $\\mathcal{G}_A$: $\\left\\{c^{A,(k+1)}_i\\right\\} = \\text{Remap}\\left(\\left\\{c^B_j\\right\\}, \\mathcal{G}_B, \\mathcal{G}_A\\right)$.\nThe `Remap` function implements the formula derived in the previous section.\n\nAfter $n$ cycles, the final field $\\left\\{c^{A,(n)}_i\\right\\}$ is obtained. The final global integral is calculated as $I^{A,(n)} = \\sum_{i=0}^{N_A-1} c^{A,(n)}_i \\Delta x^A_i$.\n\nFinally, the drift metric $D_n$ is computed as the absolute difference between the final and initial global integrals:\n$$\nD_n = \\left| I^{A,(n)} - I^{A,(0)} \\right|\n$$\nThis process is repeated for each of the five test cases defined in the problem statement. The resulting values of $D_n$ are collected and presented in the required format. The implementation uses double-precision floating-point numbers (`float64`) for all calculations to minimize round-off errors, although the problem is designed to reveal their cumulative effect.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to derive, implement, and test a conservative remapping algorithm.\n    \"\"\"\n\n    def F(x: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Calculates the exact antiderivative of the function f(x).\n        f(x) = sin(2*pi*x) + 0.3*cos(5*pi*x) + 0.5*x\n        F(x) = -1/(2*pi)*cos(2*pi*x) + 0.3/(5*pi)*sin(5*pi*x) + 0.25*x**2\n        \"\"\"\n        term1 = -1.0 / (2.0 * np.pi) * np.cos(2.0 * np.pi * x)\n        term2 = 0.3 / (5.0 * np.pi) * np.sin(5.0 * np.pi * x)\n        term3 = 0.25 * x**2\n        return term1 + term2 + term3\n\n    def make_grid(N: int, grid_type: str = 'uniform', power: float = 1.0) -> np.ndarray:\n        \"\"\"\n        Constructs a grid with N cells on the interval [0, 1].\n        Returns an array of N+1 cell edges.\n        \"\"\"\n        if grid_type == 'uniform':\n            return np.linspace(0.0, 1.0, N + 1, dtype=np.float64)\n        elif grid_type == 'stretched':\n            base = np.arange(N + 1, dtype=np.float64) / N\n            return np.power(base, power)\n        else:\n            raise ValueError(f\"Unknown grid type: {grid_type}\")\n\n    def remap(c_source: np.ndarray, grid_source: np.ndarray, grid_target: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Performs first-order conservative remapping from a source to a target grid.\n        \n        Args:\n            c_source: Array of cell-average values on the source grid.\n            grid_source: Array of source grid cell edges.\n            grid_target: Array of target grid cell edges.\n        \n        Returns:\n            Array of cell-average values on the target grid.\n        \"\"\"\n        n_source_cells = len(c_source)\n        n_target_cells = len(grid_target) - 1\n        \n        c_target = np.zeros(n_target_cells, dtype=np.float64)\n        delta_x_target = np.diff(grid_target)\n\n        for j in range(n_target_cells):\n            target_cell_start = grid_target[j]\n            target_cell_end = grid_target[j+1]\n            \n            total_mass_in_target_cell = 0.0\n            \n            for i in range(n_source_cells):\n                source_cell_start = grid_source[i]\n                source_cell_end = grid_source[i+1]\n                \n                # Calculate the length of the intersection interval\n                overlap_length = max(0.0, min(source_cell_end, target_cell_end) - max(source_cell_start, target_cell_start))\n                \n                if overlap_length > 0.0:\n                    total_mass_in_target_cell += c_source[i] * overlap_length\n            \n            if delta_x_target[j] > 1e-15: # Avoid division by zero\n                c_target[j] = total_mass_in_target_cell / delta_x_target[j]\n        \n        return c_target\n\n    test_cases = [\n        {'NA': 8, 'grid_A_type': 'uniform', 'power_A': 1.0, 'NB': 8, 'grid_B_type': 'uniform', 'power_B': 1.0, 'n_cycles': 10},\n        {'NA': 10, 'grid_A_type': 'uniform', 'power_A': 1.0, 'NB': 12, 'grid_B_type': 'uniform', 'power_B': 1.0, 'n_cycles': 20},\n        {'NA': 64, 'grid_A_type': 'stretched', 'power_A': 1.7, 'NB': 64, 'grid_B_type': 'uniform', 'power_B': 1.0, 'n_cycles': 50},\n        {'NA': 32, 'grid_A_type': 'uniform', 'power_A': 1.0, 'NB': 32, 'grid_B_type': 'uniform', 'power_B': 1.0, 'n_cycles': 100},\n        {'NA': 5, 'grid_A_type': 'uniform', 'power_A': 1.0, 'NB': 200, 'grid_B_type': 'uniform', 'power_B': 1.0, 'n_cycles': 5},\n    ]\n\n    results = []\n    for case in test_cases:\n        # 1. Construct grids\n        grid_A = make_grid(case['NA'], case['grid_A_type'], case['power_A'])\n        grid_B = make_grid(case['NB'], case['grid_B_type'], case['power_B'])\n        \n        # 2. Compute initial cell-averages on grid A\n        delta_x_A = np.diff(grid_A)\n        cell_integrals_A_0 = F(grid_A[1:]) - F(grid_A[:-1])\n        c_A_0 = cell_integrals_A_0 / delta_x_A\n        \n        # 3. Calculate initial global integral\n        initial_global_integral = np.sum(c_A_0 * delta_x_A)\n        \n        # 4. Perform cycle test\n        c_A_current = c_A_0.copy()\n        for _ in range(case['n_cycles']):\n            c_B = remap(c_A_current, grid_A, grid_B)\n            c_A_current = remap(c_B, grid_B, grid_A)\n            \n        # 5. Calculate final global integral and drift metric\n        final_global_integral = np.sum(c_A_current * delta_x_A)\n        drift = abs(final_global_integral - initial_global_integral)\n        results.append(drift)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.17g}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}