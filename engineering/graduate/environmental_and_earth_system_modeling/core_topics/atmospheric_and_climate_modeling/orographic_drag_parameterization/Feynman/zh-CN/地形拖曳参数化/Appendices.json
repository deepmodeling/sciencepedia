{
    "hands_on_practices": [
        {
            "introduction": "任何参数化方案的理解都始于其背后的基本物理原理。本练习将引导你完成一个经典推导，计算理想化的山脉上空稳定气流所产生的动量通量。通过这个练习，你将巩固对静力重力波的核心概念的理解，并揭示大气属性（如$N$、$U$、$\\rho$）和地形特征（如$H$、$k$）如何共同决定地形拖曳的大小。",
            "id": "3904231",
            "problem": "考虑一个二维、定常、无粘、线性的Boussinesq流，其具有均匀的背景风速 $U$，流经一个孤立的山脊。假设地形为小振幅，以便线性理论适用，并对内重力波采用静水压近似。层结是均匀的，布伦特-维萨拉频率（BVF）为 $N$，背景密度为 $\\rho$。设山脊由单一单色傅里叶分量表示，其高度为 $h(x)=H\\cos(kx)$，其中 $H$ 是高度振幅，$k=2\\pi/\\lambda$ 是与波长 $\\lambda$ 相关的水平波数。在下边界 $z=0$ 处，施加运动学边界条件，即垂直速度等于背景流对地形的平流。\n\n仅从具有静水平衡、连续性和均匀层结的线性化、定常、无粘的Boussinesq方程组出发：\n- 连续性方程：$ik\\,u' + im\\,w' = 0$ 对于平面波解 $\\propto \\exp(i(kx+mz))$，\n- 静水平衡：$\\partial p'/\\partial z = \\rho\\,b'$，\n- 定常浮力方程：$U\\,\\partial b'/\\partial x + N^{2} w' = 0$，\n- 水平动量方程：$U\\,\\partial u'/\\partial x = -\\frac{1}{\\rho}\\,\\partial p'/\\partial x$，\n以及在 $z=0$ 处的地形边界条件：$w(x,0) = U\\,\\partial h/\\partial x$，\n\n推导由静水山地波携带的水平动量的相平均垂直通量 $\\rho\\,\\overline{u'w'}$，并证明其对基本参数和地形振幅的依赖性。然后，对于具体情况\n$\\rho = 0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，$U = 15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，$N = 0.012\\,\\mathrm{s}^{-1}$，$H = 300\\,\\mathrm{m}$，以及 $\\lambda = 20\\,\\mathrm{km}$，\n计算有符号的地面动量通量（一种应力），并以 $\\mathrm{N}\\,\\mathrm{m}^{-2}$ 为单位表示。将最终数值答案四舍五入至三位有效数字。",
            "solution": "用户要求我解决一个关于静水山地波的地球物理流体动力学问题。\n\n### 第一步：提取已知条件\n问题提供了以下信息和控制方程：\n- 流动是二维、定常、无粘、线性和Boussinesq流。\n- 背景风速是均匀的，$U$。\n- 层结是均匀的，布伦特-维萨拉频率为 $N$。\n- 背景密度为 $\\rho$。\n- 地形是单一单色山脊：$h(x) = H\\cos(kx)$，其中 $H$ 是高度振幅，$k=2\\pi/\\lambda$ 是水平波数。\n- 采用静水压近似。\n- 提供了线性化的控制方程（以微分和傅里叶空间形式混合给出）：\n    - 平面波的连续性方程：$ik\\,u' + im\\,w' = 0$。\n    - 静水平衡：$\\partial p'/\\partial z = \\rho\\,b'$。\n    - 定常态浮力方程：$U\\,\\partial b'/\\partial x + N^{2} w' = 0$。\n    - 水平动量方程：$U\\,\\partial u'/\\partial x = -\\frac{1}{\\rho}\\,\\partial p'/\\partial x$。\n- $z=0$ 处的下边界条件是运动学条件：$w(x,0) = U\\,\\partial h/\\partial x$。\n- 用于最终计算的具体数值：\n    - $\\rho = 0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n    - $U = 15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n    - $N = 0.012\\,\\mathrm{s}^{-1}$\n    - $H = 300\\,\\mathrm{m}$\n    - $\\lambda = 20\\,\\mathrm{km} = 2 \\times 10^4\\,\\mathrm{m}$\n\n### 第二步：使用提取的已知条件进行验证\n现在将对问题陈述进行验证。\n1.  **科学依据**：该问题是线性山地波理论的经典教科书示例，是大气动力学和环境流体力学中的一个基本课题。控制方程是静水压近似下的标准线性化Boussinesq方程组。物理设置是现实的，并作为理解地形拖曳的基础模型。该问题具有坚实的科学基础。\n2.  **适定性**：该问题是适定的。它提供了一套完整的控制方程和一个明确定义的边界条件。求解动量通量的要求是根据该系统求解得出的标准计算。为了获得唯一解，需要一个隐含的上边界条件（辐射条件），这是此类问题的标准做法，以确保波能从源（山脉）向高空传播。\n3.  **客观性**：语言精确、量化，没有任何主观性或偏见。\n4.  **完整性与一致性**：所提供的方程和条件是一致且足以推导出所要求的量。问题明确指出采用静水压近似，这解决了使用哪套方程的任何模糊性。数值对于地球大气层是物理上合理的。\n\n### 第三步：结论与行动\n问题是有效的。将提供完整的解答。\n\n### 动量通量的推导\n我们寻求水平动量的相平均垂直通量，$\\mathcal{F}_M = \\rho\\,\\overline{u'w'}$。上划线表示在一个水平波长上的空间平均。扰动量 $u'$（水平速度）和 $w'$（垂直速度）是给定线性系统的解。\n\n我们假设解的形式为 $f'(x,z) = \\Re\\{\\hat{f}(z)e^{ikx}\\}$，其中 $\\hat{f}(z)$ 是扰动变量 $f'$ 的复振幅。将此形式代入控制微分方程，得到一组关于复振幅的方程：\n1.  水平动量：$U(ik\\hat{u}) = -\\frac{1}{\\rho}(ik\\hat{p}) \\implies \\hat{p} = -\\rho U \\hat{u}$。\n2.  浮力：$U(ik\\hat{b}) + N^2\\hat{w} = 0 \\implies \\hat{b} = \\frac{iN^2}{Uk}\\hat{w}$。\n3.  静水平衡：$\\frac{d\\hat{p}}{dz} = \\rho \\hat{b}$。\n4.  连续性：$ik\\hat{u} + \\frac{d\\hat{w}}{dz} = 0$。\n\n我们组合这些方程以找到一个关于 $\\hat{w}(z)$ 的单一控制方程。对水平动量方程（1）对 $z$ 求导，得到 $\\frac{d\\hat{p}}{dz} = -\\rho U \\frac{d\\hat{u}}{dz}$。\n将此式和浮力关系（2）代入静水方程（3）中：\n$-\\rho U \\frac{d\\hat{u}}{dz} = \\rho \\left(\\frac{iN^2}{Uk}\\hat{w}\\right) \\implies \\frac{d\\hat{u}}{dz} = -\\frac{iN^2}{U^2k}\\hat{w}$。\n从连续性方程（4），我们有 $\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$。对此式对 $z$ 求导，得到 $\\frac{d\\hat{u}}{dz} = \\frac{i}{k}\\frac{d^2\\hat{w}}{dz^2}$。\n将两个 $\\frac{d\\hat{u}}{dz}$ 的表达式相等：\n$\\frac{i}{k}\\frac{d^2\\hat{w}}{dz^2} = -\\frac{iN^2}{U^2k}\\hat{w}$。\n乘以 $k/i$ 将其简化为静水流的泰勒-戈德斯坦方程：\n$$\n\\frac{d^2\\hat{w}}{dz^2} + \\frac{N^2}{U^2}\\hat{w} = 0\n$$\n这是一个常系数二阶常微分方程。令 $m^2 = (N/U)^2$。通解为 $\\hat{w}(z) = A e^{imz} + B e^{-imz}$。为了得到物理上有意义的解，波能必须向上（远离地形）传播。对于静止波（$U0$, $k0$），此辐射条件要求我们选择具有向上群速度的解，这对应于向下的相速度，意味着我们选择垂直波数的正根，$m = N/U$。因此，解为 $\\hat{w}(z) = A e^{imz}$。\n\n常数 $A$ 由 $z=0$ 处的下边界条件确定：$w(x,0) = U \\frac{\\partial h}{\\partial x}$。\n给定 $h(x)=H\\cos(kx)$，我们有 $\\frac{\\partial h}{\\partial x} = -Hk\\sin(kx)$。\n所以，$w(x,0) = -UHk\\sin(kx)$。\n我们可以用复数形式写出：$w(x,0) = \\Re\\{iUHke^{ikx}\\}$。\n同样，从我们假设的解形式，$w(x,0) = \\Re\\{\\hat{w}(0)e^{ikx}\\} = \\Re\\{Ae^{ikx}\\}$。\n比较这两个表达式，我们找到边界处的振幅：$A = \\hat{w}(0) = iUHk$。\n因此，垂直速度振幅的解是：\n$$\n\\hat{w}(z) = iUHk e^{imz}, \\quad \\text{其中 } m = \\frac{N}{U}\n$$\n接下来，我们使用连续性方程 $\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$ 来求水平速度振幅 $\\hat{u}(z)$：\n$\\frac{d\\hat{w}}{dz} = \\frac{d}{dz}(iUHk e^{imz}) = (iUHk)(im)e^{imz} = -UHkm e^{imz}$。\n代入 $m=N/U$：$\\frac{d\\hat{w}}{dz} = -UHk(N/U)e^{imz} = -NHk e^{imz}$。\n然后，$\\hat{u}(z) = \\frac{i}{k}(-NHk e^{imz}) = -iNH e^{imz}$。\n\n现在我们可以计算相平均动量通量。对于两个量 $a = \\Re\\{\\hat{a}e^{ikx}\\}$ 和 $b = \\Re\\{\\hat{b}e^{ikx}\\}$，它们乘积的相平均是 $\\overline{ab} = \\frac{1}{2}\\Re\\{\\hat{a}\\hat{b}^*\\}$，其中 $\\hat{b}^*$ 是 $\\hat{b}$ 的复共轭。\n我们有 $\\hat{u}(z) = -iNH e^{imz}$ 和 $\\hat{w}(z) = iUHk e^{imz}$。\n$\\hat{w}$ 的复共轭是 $\\hat{w}^*(z) = -iUHk e^{-imz}$。\n乘积是：\n$\\hat{u}\\hat{w}^* = (-iNH e^{imz})(-iUHk e^{-imz}) = i^2 (NH)(UHk) e^{imz-imz} = -NUH^2k$。\n平均乘积 $\\overline{u'w'}$ 是：\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\{-NUH^2k\\} = -\\frac{1}{2}NUH^2k\n$$\n这个量与高度 $z$ 无关，这与无粘、定常流是一致的。水平动量的垂直通量是：\n$$\n\\mathcal{F}_M = \\rho\\,\\overline{u'w'} = -\\frac{1}{2}\\rho N U k H^2\n$$\n负号表示正（向东）动量的向下通量，它对山脉施加一个拖曳力。\n\n### 数值计算\n我们被要求计算给定参数下的有符号的地面动量通量：\n- $\\rho = 0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $U = 15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- $N = 0.012\\,\\mathrm{s}^{-1}$\n- $H = 300\\,\\mathrm{m}$\n- $\\lambda = 20\\,\\mathrm{km} = 2 \\times 10^4\\,\\mathrm{m}$\n\n首先，我们计算水平波数 $k$：\n$$\nk = \\frac{2\\pi}{\\lambda} = \\frac{2\\pi}{2 \\times 10^4\\,\\mathrm{m}} = \\pi \\times 10^{-4}\\,\\mathrm{m}^{-1}\n$$\n现在，将这些值代入动量通量的表达式中：\n$$\n\\mathcal{F}_M = -\\frac{1}{2} (0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}) (0.012\\,\\mathrm{s}^{-1}) (15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) (\\pi \\times 10^{-4}\\,\\mathrm{m}^{-1}) (300\\,\\mathrm{m})^2\n$$\n$$\n\\mathcal{F}_M = - \\frac{1}{2} (0.9)(0.012)(15)(\\pi \\times 10^{-4})(9 \\times 10^4) \\,\\mathrm{N}\\,\\mathrm{m}^{-2}\n$$\n$10$的幂次相互抵消。我们剩下：\n$$\n\\mathcal{F}_M = - \\frac{1}{2} (0.9)(0.012)(15)(\\pi)(9)\n$$\n我们来计算数值乘积：\n$$\n0.5 \\times 0.9 \\times 0.012 \\times 15 \\times 9 = 0.729\n$$\n所以，动量通量是：\n$$\n\\mathcal{F}_M = -0.729\\pi \\,\\,\\mathrm{N}\\,\\mathrm{m}^{-2}\n$$\n使用 $\\pi \\approx 3.14159...$ 的值：\n$$\n\\mathcal{F}_M \\approx -0.729 \\times 3.14159 = -2.29022... \\,\\,\\mathrm{N}\\,\\mathrm{m}^{-2}\n$$\n四舍五入到三位有效数字，有符号的地面动量通量为 $-2.29\\,\\mathrm{N}\\,\\mathrm{m}^{-2}$。",
            "answer": "$$\\boxed{-2.29}$$"
        },
        {
            "introduction": "最后的这个练习是整个学习过程的点睛之笔，它将所有概念融会贯通。本练习将你从理论计算和概念性问题带入到构建一个简化的地形拖曳参数化方案的实际操作中。你将实现一个算法来垂直追踪重力波的传播并计算动量沉积廓线，该算法需要考虑临界层吸收和波破碎（饱和）等关键物理过程。",
            "id": "3904213",
            "problem": "考虑在线性 Boussinesq 近似下，垂直变化的大气中二维定常地形波的地形拖曳参数化问题。给定一个层结廓线 $N(z)$、一个与水平波数矢量对齐的背景风廓线 $U(z)$，以及一组由水平波数 $k$ 和地形振幅 $h_0$ 表征的离散地形谱分量。从包含 (i) Boussinesq 连续性方程和动量方程，(ii) 二维定常波的内重力波色散关系，以及 (iii) 缓变介质中波作用量守恒的基本原理出发，推导出计算垂直波数 $m(z)$、水平动量的垂直通量（也称为 Eliassen-Palm 通量）和饱和判据所需的表达式。使用这些表达式，实现一个算法，将每个谱分量从下边界开始，通过一个离散网格向上垂直传播，直到遇到波破碎（饱和）或临界层，并计算由此产生的动量沉积的垂直分布。\n\n算法要求如下：\n\n- 从基本定律和核心定义出发，推导地形强迫的定常内重力波垂直传播所需的控制关系式。不要使用未经基本原理推导的预封装或简化公式。\n- 假设参考密度 $\\rho_0$ 为常数，并使用适用于地形波的 Boussinesq 框架的二维、无旋转、静力平衡一致的极限。\n- 在一个从 $z=0$ 到 $z=10{,}000$ 米，间距为 $1{,}000$ 米的均匀网格 $z_i$ 上实现垂直传播。在每个高度层上，判断内重力波是否能够传播 ($m^2(z_i)  0$)，是否遇到转向层 ($m^2(z_i) \\le 0$)，是否根据具有物理动机的非线性阈值达到饱和，或者是否遇到临界层（定义为当 $|U(z_i)|$ 降至一个小阈值以下时，内在相速消失）。\n- 对于每个参数为 $k$ 和 $h_0$ 的谱分量，使用从基本原理推导出的关系式，在下边界初始化水平动量的向上传输的垂直通量。在没有破碎或临界层的情况下，假设为绝热传播，该通量随高度守恒。当发生饱和（基于推导出的非线性参数达到1），或遇到临界层（基于 $|U(z)|$ 的阈值），或达到转向层 ($m^2(z) \\le 0$) 时，将剩余的向上传输的通量在该高度层局部沉积。将所有谱分量的动量沉积贡献相加，得到净垂直廓线。\n- 所有动量沉积值以牛顿每平方米（$\\mathrm{N}\\,\\mathrm{m}^{-2}$）为单位表示。对于最终程序输出，将报告的每个浮点数四舍五入到六位小数。\n\n使用以下常数和测试套件。所有数学实体（符号、变量、函数和数字）都应根据其物理意义进行一致处理：\n\n- 参考密度：$\\rho_0 = 1.0 \\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n- 临界层阈值：$U_{\\mathrm{crit}} = 0.5 \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n\n垂直网格：\n- 高度层位于 $z_i = 0, 1000, 2000, \\dots, 10000$ 米。\n\n测试套件（三个案例），每个案例由 $N(z)$、$U(z)$ 和一组离散谱分量 $\\{(k,h_0)\\}$ 定义：\n\n- 案例 A（导致可能饱和的单调切变）：\n  - 层结：对于所有 $z$，$N(z) = 0.01 \\,\\mathrm{s}^{-1}$。\n  - 风：$U(z) = 10 + 1.2 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n  - 谱分量：$(k_1,h_{0,1}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$，$(k_2,h_{0,2}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$，$(k_3,h_{0,3}) = (8\\times 10^{-4}\\,\\mathrm{m}^{-1}, 100\\,\\mathrm{m})$。\n\n- 案例 B（因风随高度反转而产生的临界层）：\n  - 层结：对于所有 $z$，$N(z) = 0.01 \\,\\mathrm{s}^{-1}$。\n  - 风：$U(z) = 12 - 3 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n  - 谱分量：$(k_1,h_{0,1}) = (4\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$，$(k_2,h_{0,2}) = (6\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$，$(k_3,h_{0,3}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$。\n\n- 案例 C（因层结减弱而导致的转向层）：\n  - 层结：$N(z) = 0.014 - 0.0008 \\times (z/1000) \\,\\mathrm{s}^{-1}$。\n  - 风：对于所有 $z$，$U(z) = 15 \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n  - 谱分量：$(k_1,h_{0,1}) = (7\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$，$(k_2,h_{0,2}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 180\\,\\mathrm{m})$，$(k_3,h_{0,3}) = (9\\times 10^{-4}\\,\\mathrm{m}^{-1}, 80\\,\\mathrm{m})$。\n\n数值和物理处理指南：\n- 垂直波数 $m(z)$ 必须根据适用于具有水平对齐平均流的 Boussinesq 流体中二维定常内重力波的色散关系确定。\n- 必须使用极化关系将垂直速度振幅与水平速度扰动联系起来，并计算水平动量的垂直通量。\n- 在没有破碎或临界层的情况下，使用波作用量守恒来推断振幅如何随 $z$ 演变，从而能够计算非线性参数及其饱和阈值。\n- 当达到饱和、遇到临界层或到达转向层时，将剩余的向上传输的通量沉积在当前高度层，并停止该谱分量的传播。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个条目对应一个测试用例，其本身是一个包含 $11$ 个浮点数的列表，代表在 $11$ 个垂直高度层 $z_i$（从 $z=0$ 到 $z=10{,}000$ 米）上各自的净动量沉积，单位为 $\\mathrm{N}\\,\\mathrm{m}^{-2}$，并四舍五入到六位小数。例如：\"[[x_0,x_1,...,x_{10}],[y_0,y_1,...,y_{10}],[z_0,z_1,...,z_{10}]]\"。",
            "solution": "该问题要求推导一个地形重力波拖曳的模型并加以实现。推导将从指定近似下的流体动力学基本方程出发。\n\n**1. 基本方程与线性化**\n\n我们从分层流体的二维、定常、无旋转、无粘性 Boussinesq 方程组开始，围绕具有水平速度 $U(z)$ 和密度廓线 $\\bar{\\rho}(z)$ 的背景态进行线性化。扰动量为速度分量 $(u', w')$、压强 $p'$ 和密度 $\\rho'$。参考密度为常数 $\\rho_0$。\n\n线性化的动量方程为：\n$$ U \\frac{\\partial u'}{\\partial x} + w' \\frac{dU}{dz} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial x} \\quad (1) $$\n$$ U \\frac{\\partial w'}{\\partial x} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial z} - \\frac{\\rho' g}{\\rho_0} \\quad (2) $$\n连续性方程为：\n$$ \\frac{\\partial u'}{\\partial x} + \\frac{\\partial w'}{\\partial z} = 0 \\quad (3) $$\n代表流体质点密度守恒的热力学方程为：\n$$ U \\frac{\\partial \\rho'}{\\partial x} + w' \\frac{d\\bar{\\rho}}{dz} = 0 \\quad (4) $$\n我们通过 $N^2(z) = -\\frac{g}{\\rho_0}\\frac{d\\bar{\\rho}}{dz}$ 定义 Brunt-Väisälä 频率 $N$。使用此定义，方程 $(4)$ 变为：\n$$ U \\frac{\\partial}{\\partial x} \\left(-\\frac{\\rho' g}{\\rho_0}\\right) - w' N^2 = 0 \\quad (5) $$\n\n**2. Taylor-Goldstein 方程的推导**\n\n我们寻求形如 $\\psi'(x,z) = \\Re\\{\\hat{\\psi}(z) e^{ikx}\\}$ 的波状解，其中 $\\psi'$ 是任意扰动变量，$k$ 是水平波数。将此形式代入线性化方程组，得到关于复振幅 $\\hat{u}(z), \\hat{w}(z), \\hat{p}(z), \\hat{\\rho}(z)$ 的常微分方程（ODE）组：\n$$ ikU\\hat{u} + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\quad (6) $$\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0}\\frac{d\\hat{p}}{dz} - \\frac{\\hat{\\rho}g}{\\rho_0} \\quad (7) $$\n$$ ik\\hat{u} + \\frac{d\\hat{w}}{dz} = 0 \\quad (8) $$\n$$ ikU\\left(-\\frac{\\hat{\\rho}g}{\\rho_0}\\right) - \\hat{w} N^2 = 0 \\quad (9) $$\n\n从 $(8)$，我们用 $\\hat{w}$ 表示 $\\hat{u}$：$\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$。\n从 $(9)$，我们用 $\\hat{w}$ 表示浮力项：$-\\frac{\\hat{\\rho}g}{\\rho_0} = \\frac{N^2}{ikU}\\hat{w}$。\n\n将 $\\hat{u}$ 代入 $(6)$ 以求解 $\\hat{p}$：\n$$ ikU\\left(\\frac{i}{k}\\frac{d\\hat{w}}{dz}\\right) + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\implies \\hat{p} = \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) $$\n现在，对 $\\hat{p}$ 关于 $z$ 求导，并将其与浮力项的表达式一同代入 $(7)$：\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0} \\frac{d}{dz} \\left[ \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) \\right] + \\frac{N^2}{ikU}\\hat{w} $$\n展开导数并整理各项后，我们得到 Taylor-Goldstein 方程：\n$$ \\frac{d^2\\hat{w}}{dz^2} + \\left( \\frac{N^2}{U^2} - k^2 - \\frac{U_{zz}}{U} \\right) \\hat{w} = 0 $$\n其中 $U_{zz} = d^2U/dz^2$。\n\n**3. 垂直波数 $m(z)$**\n\n问题指定了对“缓变介质”的分析，这对应于 WKB 近似。在此极限下，与风廓线曲率相关的项 $U_{zz}/U$ 与其他项相比可以忽略不计。控制方程简化为：\n$$ \\frac{d^2\\hat{w}}{dz^2} + m^2(z)\\hat{w} = 0 $$\n这是一个具有空间变化频率的谐振子方程。局地垂直波数 $m(z)$ 定义为：\n$$ m^2(z) = \\frac{N(z)^2}{U(z)^2} - k^2 $$\n为了让波在垂直方向上传播，其解必须在 $z$ 方向上是振荡的，这要求 $m^2(z)  0$。如果 $m^2(z) \\le 0$，解是衰减的，波无法传播。这个条件 $m^2(z) \\le 0$ 定义了一个**转向层**。\n\n**4. 水平动量的垂直通量**\n\n单位面积的水平动量垂直通量由 $F_m = \\rho_0 \\overline{u'w'}$ 给出，其中上划线表示在一个波长上的水平平均。我们引入垂直质点位移 $\\eta'(x, z)$。对于小位移，垂直速度是位移的全导数：$w' = \\frac{D\\eta'}{Dt} = (\\frac{\\partial}{\\partial t} + U\\frac{\\partial}{\\partial x})\\eta'$。对于定常波（$\\partial/\\partial t = 0$），这简化为 $w' = U\\frac{\\partial \\eta'}{\\partial x}$。对于单个傅里叶模式 $\\eta'(x,z) = \\Re\\{\\hat{\\eta}(z) e^{ikx}\\}$，我们有 $\\hat{w}(z) = ikU(z)\\hat{\\eta}(z)$。\n\n运动学边界条件在地面（$z=0$）迫使气流跟随地形 $h(x)$。因此，$\\eta'(x,0) = h(x)$。对于谱分量 $h(x) = h_0 \\cos(kx)$，地面位移的复振幅为 $\\hat{\\eta}(0) = h_0$。\n\n为了求得动量通量，我们需要将 $u'$ 和 $\\eta'$ 联系起来。结合连续性方程 $(3)$ 和 $w'$ 与 $\\eta'$ 之间的关系：\n$$ \\frac{\\partial u'}{\\partial x} = -\\frac{\\partial w'}{\\partial z} = -\\frac{\\partial}{\\partial z}\\left(U\\frac{\\partial \\eta'}{\\partial x}\\right) = -U\\frac{\\partial^2 \\eta'}{\\partial x \\partial z} - \\frac{dU}{dz}\\frac{\\partial \\eta'}{\\partial x} $$\n对 $x$ 积分得到 $u' = -U\\frac{\\partial \\eta'}{\\partial z} - \\frac{dU}{dz}\\eta'$。对于能量向上传播的波，$\\eta'$ 的垂直结构与 $e^{imz}$ 成正比。在 WKB 近似下（$\\partial_z \\gg \\frac{1}{U}\\frac{dU}{dz}$ 等），我们有 $\\frac{\\partial \\eta'}{\\partial z} \\approx im\\eta'$，从而得到 $\\hat{u} \\approx -imU\\hat{\\eta}$。\n\n动量通量则为：\n$F_m = \\rho_0 \\overline{u'w'} = \\frac{1}{2}\\rho_0 \\Re\\{\\hat{u}(ikU\\hat{\\eta})^*\\} = \\frac{1}{2}\\rho_0 \\Re\\{(-imU\\hat{\\eta})(-ikU\\hat{\\eta}^*)\\} = \\frac{1}{2}\\rho_0 \\Re\\{-mkU^2|\\hat{\\eta}|^2\\}$。\n$$ F_m(z) = -\\frac{1}{2} \\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2 $$\n负号表示水平动量是向下传输的，这对应于对地表的拖曳力。对于从地面发起的向上传播的波，其在地表（$z=0$）的通量大小，记为 $J_0$，是：\n$$ J_0 = |F_m(0)| = \\frac{1}{2}\\rho_0 m_0 k U_0^2 h_0^2 $$\n其中 $U_0 = U(0)$，$N_0 = N(0)$，以及 $m_0 = \\sqrt{N_0^2/U_0^2 - k^2}$。\n对于定常、无耗散的波，水平动量的垂直通量随高度守恒，即 $F_m(z) = F_m(0)$。因此，其大小 $J(z) = J_0$ 保持不变，直到波遇到临界层、转向层或发生破碎。\n\n**5. 饱和判据**\n\n当波振幅变得过大，导致对流不稳定时，会发生波破碎（饱和）。这发生在总位温梯度 $\\partial\\theta/\\partial z$ 变为非正值时。这等价于浮力 $b = \\bar{b}(z)+b'(x,z)$ 满足条件 $\\partial b/\\partial z \\le 0$。起始判据为 $\\partial b'/\\partial z \\ge N^2$。\n\n从热力学方程 $(5)$，我们得到 $b' = -N^2\\eta'$。因此饱和判据为：\n$$ \\frac{\\partial}{\\partial z}(-N^2 \\eta') \\ge N^2 \\implies -N^2 \\frac{\\partial \\eta'}{\\partial z} \\ge N^2 \\implies \\frac{\\partial \\eta'}{\\partial z} \\le -1 $$\n位移垂直梯度的振幅为 $|\\frac{\\partial \\eta'}{\\partial z}| \\approx |im\\eta'| = m|\\hat{\\eta}|$。因此，当非线性参数 $S(z) = m(z)|\\hat{\\eta}(z)|$ 达到 1 的量级时，发生饱和。我们将阈值设为 $S(z) \\ge 1$。\n\n为了计算 $S(z)$，我们从动量通量大小守恒中求出 $|\\hat{\\eta}(z)|$：$J_0 = \\frac{1}{2}\\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2$。\n$$ |\\hat{\\eta}(z)|^2 = \\frac{2 J_0}{\\rho_0 k m(z) U(z)^2} $$\n将其代入 $S(z)$ 的表达式中：\n$$ S(z) = m(z) \\sqrt{\\frac{2 J_0}{\\rho_0 k m(z) U(z)^2}} = \\sqrt{\\frac{2 J_0 m(z)}{\\rho_0 k U(z)^2}} $$\n如果 $S(z_i) \\ge 1$，则认为波在高度层 $z_i$ 发生破碎。\n\n**6. 算法流程**\n\n计算动量沉积垂直廓线的算法如下。对每个大气廓线案例：\n1. 初始化一个总沉积数组 $D[z_i]$，在所有网格高度层 $z_i$ 上均设为零。\n2. 对于每个谱分量 $(k, h_0)$：\n   a. 计算背景态 $U_0=U(0)$, $N_0=N(0)$。\n   b. 计算地表垂直波数的平方：$m_0^2 = N_0^2/U_0^2 - k^2$。\n   c. 如果 $m_0^2 \\le 0$，则波在源区是衰减的。动量通量 $J_0$ 为零。处理下一个分量。\n   d. 否则，计算地表向上传输的动量通量的大小：$J_0 = \\frac{1}{2}\\rho_0 k U_0^2 h_0^2 \\sqrt{N_0^2/U_0^2 - k^2}$。\n   e. 将此通量垂直向上传播。从高度层 $i=1$ 迭代到顶层（$z_i = 1000, 2000, ..., 10000$ m）。\n      i. 在高度层 $z_i$，计算 $U_i=U(z_i)$ 和 $N_i=N(z_i)$。\n      ii. **临界层检查：** 如果 $|U_i|  U_{\\mathrm{crit}}$，波被吸收。将 $J_0$ 加到该高度层的沉积中，$D[z_i] += J_0$，并终止该分量的传播（跳出垂直循环）。\n      iii. **转向层检查：** 计算 $m_i^2 = N_i^2/U_i^2 - k^2$。如果 $m_i^2 \\le 0$，波被反射/捕获。向上传输的通量终止。将 $J_0$ 加到 $D[z_i]$ 并跳出循环。\n      iv. **饱和检查：** 如果波仍在传播，计算饱和参数 $S_i^2 = \\frac{2 J_0 m_i}{\\rho_0 k U_i^2}$，其中 $m_i=\\sqrt{m_i^2}$。如果 $S_i^2 \\ge 1$，波发生破碎。将 $J_0$ 加到 $D[z_i]$ 并跳出循环。\n   f. 如果循环完成而未中断，则波的动量通量逃逸出模式域顶部，不发生沉积。\n3. 最终数组 $D$ 代表该案例的总动量沉积廓线。\n对所有测试案例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes orographic gravity wave drag deposition profiles for given atmospheric conditions.\n    \"\"\"\n    # Define constants\n    rho_0 = 1.0  # kg/m^3\n    U_crit = 0.5  # m/s\n\n    # Define vertical grid\n    z_levels = np.linspace(0, 10000, 11)  # 0, 1000, ..., 10000 meters\n\n    # Define Test Suite\n    test_suite = {\n        \"A\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 10.0 + 1.2 * (z / 1000.0),\n            \"components\": [\n                (5e-4, 200.0),\n                (3e-4, 150.0),\n                (8e-4, 100.0),\n            ]\n        },\n        \"B\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 12.0 - 3.0 * (z / 1000.0),\n            \"components\": [\n                (4e-4, 150.0),\n                (6e-4, 120.0),\n                (3e-4, 200.0),\n            ]\n        },\n        \"C\": {\n            \"N_func\": lambda z: 0.014 - 0.0008 * (z / 1000.0),\n            \"U_func\": lambda z: 15.0,\n            \"components\": [\n                (7e-4, 120.0),\n                (5e-4, 180.0),\n                (9e-4, 80.0),\n            ]\n        }\n    }\n\n    all_results = []\n\n    for case_id in [\"A\", \"B\", \"C\"]:\n        case_data = test_suite[case_id]\n        N_func = case_data[\"N_func\"]\n        U_func = case_data[\"U_func\"]\n        components = case_data[\"components\"]\n\n        total_deposition = np.zeros(len(z_levels))\n\n        for k, h0 in components:\n            # 1. Initialization at the lower boundary (z=0)\n            z0 = z_levels[0]\n            U0 = U_func(z0)\n            N0 = N_func(z0)\n            \n            # Ensure U0 is not at a critical level for flux calculation\n            if abs(U0)  1e-9:\n                continue # No wave launched\n\n            m_squared_0 = (N0**2 / U0**2) - k**2\n\n            # Check if the wave is propagating at the surface\n            if m_squared_0 = 0:\n                # Evanescent wave, no upward flux\n                continue\n\n            m0 = np.sqrt(m_squared_0)\n            \n            # Calculate magnitude of momentum flux at the surface\n            J0 = 0.5 * rho_0 * k * m0 * (U0 * h0)**2\n            \n            # 2. Vertical Propagation\n            flux_deposited = False\n            for i in range(1, len(z_levels)):\n                zi = z_levels[i]\n                Ui = U_func(zi)\n                Ni = N_func(zi)\n                \n                # Check for critical level\n                if abs(Ui)  U_crit:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n\n                m_squared_i = (Ni**2 / Ui**2) - k**2\n\n                # Check for turning level\n                if m_squared_i = 0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n                \n                mi = np.sqrt(m_squared_i)\n\n                # Check for saturation (wave breaking)\n                # Saturation criterion S^2 = 1, where S^2 = (2 * J0 * m_i) / (rho_0 * k * U_i^2)\n                saturation_param_sq = (2.0 * J0 * mi) / (rho_0 * k * Ui**2)\n                if saturation_param_sq = 1.0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n            \n            # The problem implies that if a wave reaches the top without breaking,\n            # its momentum is not deposited in the specified domain.\n            \n        # Format results for the current case\n        case_results_rounded = [round(val, 6) for val in total_deposition]\n        all_results.append(case_results_rounded)\n    \n    # Format the final output string as specified\n    formatted_case_results = []\n    for res_list in all_results:\n        formatted_list = f\"[{','.join(f'{x:.6f}' for x in res_list)}]\"\n        formatted_case_results.append(formatted_list)\n    \n    final_output_string = f\"[{','.join(formatted_case_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}