{
    "hands_on_practices": [
        {
            "introduction": "在验证模型的物理真实性之前，我们必须首先确保其代码能够正确求解其所基于的数学方程，这一过程称为“代码验证”。本练习将指导您完成一个基础但至关重要的验证任务：通过网格加密研究来计算数值方案的“观测准确度阶数”。这项实践对于建立模型代码正确性的信心至关重要，是任何严格模型评估的先决条件。",
            "id": "3896009",
            "problem": "您需要设计并实现一个独立的计算研究，通过网格加密和理查森外推法来验证一维线性输运方程的空间离散化，并计算观测到的精度阶。从控制方程和核心定义开始。然后推导算法步骤，以计算多个网格间的差异并估计收敛率。\n\n考虑具有周期性边界条件的一维线性平流（输运）方程：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0,\n$$\n在空间域 $[0, L]$ 上，其中 $L = 1$（米），恒定平流速度 $c = 1$（米/秒）。使用初始条件\n$$\nu(x, 0) = \\sin(2\\pi x) + \\frac{1}{2}\\cos(4\\pi x),\n$$\n该初始条件在 $[0, L]$ 上是光滑且周期的。将解演化至最终时间 $T = 0.2$（秒）。精确解由下式给出\n$$\nu_{\\mathrm{exact}}(x, t) = u(x - ct \\bmod L, 0),\n$$\n这是由于在恒定平流下，形状在平移过程中保持不变。\n\n从基本原理出发：\n- 平流物理量的守恒意味着离散通量差是时间变化的驱动因素。\n- Courant–Friedrichs–Lewy (CFL) 条件确保了显式格式的稳定性；使用一个固定的 $ \\mathrm{CFL} $ 数，满足 $0 < \\mathrm{CFL} \\le 1$。\n- 在一个包含 $N$ 个点的均匀网格上，网格间距为 $h = L/N$，时间步长 $\\Delta t$ 的选择应满足 $c \\Delta t / h = \\nu$（一个选定的 $ \\mathrm{CFL} $ 数），构建相容的有限差分更新式。\n\n实现两种空间格式：\n1. 针对 $c > 0$ 的一阶迎风格式，时间上使用前向欧拉法，空间上使用迎风差分。\n2. 二阶 Lax–Wendroff 格式，时间上使用两项泰勒展开，空间上使用中心差分。\n\n定义一个在三层网格上进行的网格加密研究，网格大小为 $(N_1, N_2, N_3)$，使得加密因子 $r$ 满足 $N_2 = r N_1$ 和 $N_3 = r N_2$，其中 $r$ 是一个整数。对于每种格式，在这些网格上计算 $t = T$ 时的数值解 $u_{h_1}$、$u_{h_2}$ 和 $u_{h_3}$。通过每 $r$ 个点采样一次的方式，构建一个从细网格到粗网格的限制算子，以便在共享位置上进行离散比较。使用带物理加权的离散 $L^2$ 范数来度量差异；对于间距为 $h$ 的网格，向量 $v$ 的离散 $L^2$ 范数为\n$$\n\\| v \\|_{2,h} = \\sqrt{ h \\sum_{i=1}^{N} v_i^2 }.\n$$\n\n在误差缩放规律为 $\\| u_h - u_{\\mathrm{exact}} \\|_{2,h} \\approx C h^p$（其中 $C$ 为某个常数，$p$ 为观测阶）的渐近网格收敛条件下，理查森外推法表明，在适当限制的网格上计算出的连续解差之比通过加密因子 $r$ 直接与 $p$ 相关。对于每个测试用例，使用这种关系从三个网格中推导出观测阶 $p$，而无需使用精确解。所有计算必须使用双精度浮点数进行。\n\n使用 $L$（单位：米）、$c$（单位：米/秒）和 $T$（单位：秒）。最终答案中的任何物理量都不需要报告单位，因为观测精度阶 $p$ 是无量纲的。\n\n测试套件：\n- 案例 1：一阶迎风格式，$(N_1, N_2, N_3) = (64, 128, 256)$，$r = 2$，$L = 1$，$c = 1$，$T = 0.2$，$\\mathrm{CFL} = 0.5$。\n- 案例 2：二阶 Lax–Wendroff 格式，$(N_1, N_2, N_3) = (64, 128, 256)$，$r = 2$，$L = 1$，$c = 1$，$T = 0.2$，$\\mathrm{CFL} = 0.5$。\n- 案例 3：一阶迎风格式（较粗的网格，一个边界情况），$(N_1, N_2, N_3) = (16, 32, 64)$，$r = 2$，$L = 1$，$c = 1$，$T = 0.2$，$\\mathrm{CFL} = 0.5$。\n- 案例 4：二阶 Lax–Wendroff 格式（较细的网格，接近渐近区域），$(N_1, N_2, N_3) = (128, 256, 512)$，$r = 2$，$L = 1$，$c = 1$，$T = 0.2$，$\\mathrm{CFL} = 0.5$。\n\n您的程序必须：\n- 根据指定的格式和参数对问题进行离散化。\n- 使用选定的 $ \\mathrm{CFL} $ 数积分到时间 $T$。\n- 对于每个案例，如上所述，通过限制在共享网格上的差分，使用理查森外推法从多个网格上的三个解中计算观测阶 $p$。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[p_1, p_2, p_3, p_4]$）。每个 $p_i$ 都必须是浮点数。不得打印任何其他文本。\n\n最终输出没有物理单位，因为观测精度阶 $p$ 是无量纲的。角度（如有）应以弧度为单位，但本问题未使用。任何地方都不得使用百分比；所有比率必须以小数形式表示。输出必须是可复现的，无需外部输入或文件。",
            "solution": "本研究的目标是，通过计算来验证应用于一维线性平流方程的两种不同有限差分格式的理论精度阶 $p$。此验证通过网格加密研究来执行。观测精度阶是通过将理查森外推法应用于一组连续加密的三个网格上的数值解来计算的。该方法允许在不需要精确解析解的情况下估计 $p$。\n\n控制偏微分方程 (PDE) 是在空间域 $x \\in [0, L]$ 上的线性平流方程：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0\n$$\n此处，$u(x, t)$ 代表被平流的量，$c$ 是恒定的平流速度，系统满足周期性边界条件 $u(0, t) = u(L, t)$。问题指定的物理参数为 $L=1$ 米，$c=1$ 米/秒，最终积分时间为 $T=0.2$ 秒。仿真是从一个光滑、周期的初始条件开始的：\n$$\nu(x, 0) = \\sin(2\\pi x) + \\frac{1}{2}\\cos(4\\pi x)\n$$\n空间域被离散化为 $N$ 个宽度为 $h = L/N$ 的均匀单元，网格点位于 $x_i = i h$，其中 $i = 0, 1, \\dots, N-1$。在网格点 $i$ 和时间步长 $n$ 处的数值解记为 $u_i^n$，它近似于精确解 $u(x_i, n\\Delta t)$。时间步长 $\\Delta t$ 通过固定 Courant–Friedrichs–Lewy (CFL) 数 $\\nu = c \\Delta t / h$ 来确定。为保证所用显式格式的稳定性，必须满足 $\\nu \\le 1$。在本研究中，我们使用目标 CFL 数 $\\nu_{\\text{target}} = 0.5$。时间步数设置为 $N_t = \\lceil T/( \\nu_{\\text{target}} h / c) \\rceil$，然后将时间步长调整为 $\\Delta t = T/N_t$。此过程确保了能够精确达到最终时间 $T$，并且有效 CFL 数 $\\nu = c \\Delta t / h \\le \\nu_{\\text{target}}$。\n\n为空间离散化实现了两种数值格式。\n\n**1. 一阶迎风格式：**\n对于正的平流速度 $c > 0$，“迎风”方向对应于 $x$ 轴的负方向。空间导数使用一阶后向差分进行近似：\n$$\n\\left(\\frac{\\partial u}{\\partial x}\\right)_i^n \\approx \\frac{u_i^n - u_{i-1}^n}{h}\n$$\n使用前向欧拉法对时间导数 $\\frac{u_i^{n+1} - u_i^n}{\\Delta t} = -c \\left(\\frac{\\partial u}{\\partial x}\\right)_i^n$ 进行离散化，我们推导出更新公式：\n$$\nu_i^{n+1} = u_i^n - \\frac{c \\Delta t}{h} (u_i^n - u_{i-1}^n) = u_i^n - \\nu (u_i^n - u_{i-1}^n)\n$$\n周期性边界条件意味着对于 $i=0$，值 $u_{-1}^n$ 取为 $u_{N-1}^n$。该格式在空间和时间上理论上都是一阶精度的，因此我们期望 $p \\approx 1$。\n\n**2. 二阶 Lax–Wendroff 格式：**\n为了达到二阶精度，我们从时间的二阶泰勒级数展开开始：\n$$\nu(x, t+\\Delta t) = u(x,t) + \\Delta t \\frac{\\partial u}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 u}{\\partial t^2} + O((\\Delta t)^3)\n$$\n根据控制偏微分方程，我们可以用空间导数替换时间导数：$\\frac{\\partial u}{\\partial t} = -c \\frac{\\partial u}{\\partial x}$，并由此推得 $\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}$。这将泰勒展开式转换为：\n$$\nu(x, t+\\Delta t) = u(x,t) - c \\Delta t \\frac{\\partial u}{\\partial x} + \\frac{c^2 (\\Delta t)^2}{2} \\frac{\\partial^2 u}{\\partial x^2} + O((\\Delta t)^3)\n$$\n然后我们使用二阶中心差分近似来离散化空间导数：\n$$\n\\left(\\frac{\\partial u}{\\partial x}\\right)_i^n \\approx \\frac{u_{i+1}^n - u_{i-1}^n}{2h} \\quad \\text{和} \\quad \\left(\\frac{\\partial^2 u}{\\partial x^2}\\right)_i^n \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2}\n$$\n将这些近似值代入展开式，并使用定义 $\\nu = c \\Delta t/h$，我们得到 Lax-Wendroff 更新公式：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\nu}{2}(u_{i+1}^n - u_{i-1}^n) + \\frac{\\nu^2}{2}(u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n该格式在空间和时间上都是二阶精度的，因此我们期望 $p \\approx 2$。\n\n**通过理查森外推法进行验证：**\n为了确定观测精度阶 $p$，我们假设在间距为 $h$ 的网格上的数值解 $u_h$ 的误差渐近表现为 $\\| u_h - u_{\\mathrm{exact}} \\|_{2,h} \\approx K h^p$，其中 $K$ 为某个常数。\n\n我们使用三个网格上的解，其大小分别为 $N_1$、$N_2 = r N_1$ 和 $N_3 = r N_2 = r^2 N_1$，对应的网格间距为 $h_1 = L/N_1$、$h_2 = h_1/r$ 和 $h_3 = h_1/r^2$。设这些网格在时间 $T$ 的数值解分别为 $u_1$、$u_2$ 和 $u_3$。为了比较它们，我们通过采样将较细网格上的解限制到最粗的网格上（$N_1$ 个点）。令 $f_1 = u_1$，$f_2$ 是通过每 $r$ 个点取一个点而限制的解 $u_2$，$f_3$ 是通过每 $(r^2)$ 个点取一个点而限制的解 $u_3$。\n\n在公共粗网格上评估的每个解的误差近似为 $f_k(x) - u_{\\mathrm{exact}}(x) \\approx C(x) h_k^p$。那么，连续解之间的差值为：\n$$\nf_2(x) - f_1(x) \\approx C(x) (h_2^p - h_1^p) = C(x) h_1^p (r^{-p} - 1)\n$$\n$$\nf_3(x) - f_2(x) \\approx C(x) (h_3^p - h_2^p) = C(x) h_2^p (r^{-p} - 1) = C(x) (h_1/r)^p (r^{-p} - 1)\n$$\n我们在粗网格上计算这些差分向量的离散 $L^2$ 范数，定义为 $\\|v\\|_{2,h_1} = \\sqrt{h_1 \\sum_i v_i^2}$。令 $D_{21} = \\|f_2 - f_1\\|_{2,h_1}$ 且 $D_{32} = \\|f_3 - f_2\\|_{2,h_1}$。这些范数的比值为：\n$$\n\\frac{D_{21}}{D_{32}} \\approx \\frac{\\|C(x) h_1^p (r^{-p} - 1)\\|_{2,h_1}}{\\|C(x) (h_1/r)^p (r^{-p} - 1)\\|_{2,h_1}} = \\frac{h_1^p}{(h_1/r)^p} = r^p\n$$\n求解 $p$ 可得到观测精度阶的公式：\n$$\np = \\frac{\\log(D_{21} / D_{32})}{\\log(r)}\n$$\n该算法采用双精度浮点运算实现，用于计算问题陈述中指定的每个测试用例的 $p$ 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef u_initial(x, L):\n    \"\"\"\n    Computes the initial condition u(x, 0) for the advection equation.\n    \"\"\"\n    return np.sin(2 * np.pi * x / L) + 0.5 * np.cos(4 * np.pi * x / L)\n\ndef upwind_step(u, nu):\n    \"\"\"\n    Performs one time step of the first-order upwind scheme.\n    u_i^{n+1} = u_i^n - nu * (u_i^n - u_{i-1}^n)\n    \"\"\"\n    u_prev = np.roll(u, 1)  # Periodicity handled by np.roll\n    return u - nu * (u - u_prev)\n\ndef lax_wendroff_step(u, nu):\n    \"\"\"\n    Performs one time step of the second-order Lax-Wendroff scheme.\n    u_i^{n+1} = u_i^n - nu/2 * (u_{i+1}^n - u_{i-1}^n) + nu^2/2 * (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n    \"\"\"\n    u_prev = np.roll(u, 1)   # u_{i-1}\n    u_next = np.roll(u, -1)  # u_{i+1}\n    term1 = -0.5 * nu * (u_next - u_prev)\n    term2 = 0.5 * nu**2 * (u_next - 2 * u + u_prev)\n    return u + term1 + term2\n\ndef solve_pde(N, L, c, T, cfl, scheme_name):\n    \"\"\"\n    Solves the 1D linear advection equation until time T.\n    \n    Returns the numerical solution u at final time T.\n    \"\"\"\n    h = L / N\n    # Ideal dt to match the CFL target\n    dt_ideal = cfl * h / c\n    # Calculate number of steps to reach T, then adjust dt to hit T exactly.\n    n_steps = int(np.ceil(T / dt_ideal))\n    dt = T / n_steps\n    # The effective CFL number nu will be = the target cfl.\n    nu = c * dt / h\n    \n    # Define the grid, excluding the endpoint L due to periodicity\n    x = np.linspace(0, L, N, endpoint=False)\n    u = u_initial(x, L)\n\n    if scheme_name == 'upwind':\n        step_func = upwind_step\n    elif scheme_name == 'lax_wendroff':\n        step_func = lax_wendroff_step\n    else:\n        raise ValueError(f\"Unknown scheme: {scheme_name}\")\n\n    for _ in range(n_steps):\n        u = step_func(u, nu)\n    \n    return u\n\ndef l2_norm(v, h):\n    \"\"\"\n    Computes the discrete L2 norm: sqrt(h * sum(v_i^2)).\n    \"\"\"\n    return np.sqrt(h * np.sum(v**2))\n\ndef compute_order_of_accuracy(case):\n    \"\"\"\n    Computes the observed order of accuracy p from a grid refinement study.\n    \"\"\"\n    scheme, N_tuple, r, L, c, T, cfl = case\n    N1, N2, N3 = N_tuple\n\n    # 1. Solve the PDE on the three grids\n    u1 = solve_pde(N1, L, c, T, cfl, scheme)\n    u2 = solve_pde(N2, L, c, T, cfl, scheme)\n    u3 = solve_pde(N3, L, c, T, cfl, scheme)\n\n    # 2. Restrict solutions from fine grids to the coarsest grid\n    u2_on_1 = u2[::r]\n    u3_on_1 = u3[::(r*r)]\n    \n    # 3. Compute difference vectors on the coarse grid\n    diff_21 = u2_on_1 - u1\n    diff_32 = u3_on_1 - u2_on_1\n    \n    # 4. Compute L2 norms of the differences using the coarse grid spacing h1\n    h1 = L / N1\n    norm_21 = l2_norm(diff_21, h1)\n    norm_32 = l2_norm(diff_32, h1)\n    \n    # 5. Calculate the observed order of accuracy p\n    # Handle potential for norm_32 being zero to avoid division by zero or log(0)\n    if norm_32 == 0.0:\n        return np.nan  # p is undefined or infinite\n\n    ratio = norm_21 / norm_32\n    \n    # If ratio is non-positive, log is undefined. This can happen if not in\n    # the asymptotic regime or with oscillating convergence.\n    if ratio = 0:\n        return np.nan\n        \n    p = np.log(ratio) / np.log(r)\n    return p\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (scheme_name, (N1, N2, N3), refinement_factor r, L, c, T, CFL)\n    test_cases = [\n        ('upwind', (64, 128, 256), 2, 1.0, 1.0, 0.2, 0.5),\n        ('lax_wendroff', (64, 128, 256), 2, 1.0, 1.0, 0.2, 0.5),\n        ('upwind', (16, 32, 64), 2, 1.0, 1.0, 0.2, 0.5),\n        ('lax_wendroff', (128, 256, 512), 2, 1.0, 1.0, 0.2, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        p = compute_order_of_accuracy(case)\n        results.append(p)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在验证了模型的数值实现后，下一步是将其输出与观测数据进行比较。然而，模型残差（模型与观测之差）在时间上往往是相关的，这会误导我们对模型性能的评估。本练习探讨了如何处理时间自相关，通过推导“有效样本量”来修正我们对模型偏差等指标的置信区间。掌握这一技能可以防止对模型准确性得出过于乐观的结论。",
            "id": "3895941",
            "problem": "一个水文模型正在根据观测到的日径流进行验证。设残差序列 $\\{e_t\\}_{t=1}^{n}$ 表示模型值与观测值之差。一个关键的性能指标是平均偏差，其计算方式为样本均值 $\\bar{e} = \\frac{1}{n}\\sum_{t=1}^{n} e_t$。假设残差是弱平稳的，均值为零，并遵循一阶自回归 (AR) 结构：其滞后 $k$ 阶的自相关为 $\\rho_k$，且满足 $\\rho_k = \\phi^{k}$，其中 $|\\phi|1$。假设 $n$ 足够大，可以忽略端点效应。\n\n从弱平稳过程的方差、协方差和自协方差的定义出发，推导有效样本量 $n_{\\text{eff}}$ 的表达式，使得 $\\operatorname{Var}(\\bar{e}) \\approx \\sigma_{e}^{2}/n_{\\text{eff}}$，其中 $\\sigma_{e}^{2}$ 是 $e_t$ 的边际方差。然后，在正态近似下，考虑平均偏差的一个双侧 $0.95$ 置信区间 (CI)。将乘性膨胀因子 $F$ 定义为自相关残差下的置信区间半宽度与具有相同 $\\sigma_{e}^{2}$ 和 $n$ 的独立残差下的置信区间半宽度之比。\n\n给定 $n=730$ 和 $\\hat{\\phi}=0.6$，计算 $F$。将您的答案四舍五入至四位有效数字，并表示为一个纯数（无量纲）。",
            "solution": "主要目标是推导自相关时间序列的样本均值方差 $\\operatorname{Var}(\\bar{e})$。样本均值定义为 $\\bar{e} = \\frac{1}{n}\\sum_{t=1}^{n} e_t$。其方差为：\n$$\n\\operatorname{Var}(\\bar{e}) = \\operatorname{Var}\\left(\\frac{1}{n}\\sum_{t=1}^{n} e_t\\right) = \\frac{1}{n^2} \\operatorname{Var}\\left(\\sum_{t=1}^{n} e_t\\right)\n$$\n一组随机变量之和的方差是其协方差矩阵中所有项的总和：\n$$\n\\operatorname{Var}\\left(\\sum_{t=1}^{n} e_t\\right) = \\sum_{t=1}^{n} \\sum_{s=1}^{n} \\operatorname{Cov}(e_t, e_s)\n$$\n对于弱平稳过程，协方差 $\\operatorname{Cov}(e_t, e_s)$ 仅取决于时间滞后 $|t-s|$。我们将自协方差函数定义为 $\\gamma_k = \\operatorname{Cov}(e_t, e_{t-k})$，自相关函数定义为 $\\rho_k = \\gamma_k / \\gamma_0$。每个残差的方差为 $\\operatorname{Var}(e_t) = \\gamma_0 = \\sigma_e^2$。因此，$\\operatorname{Cov}(e_t, e_s) = \\gamma_{|t-s|} = \\sigma_e^2 \\rho_{|t-s|}$。\n\n将此代入方差表达式：\n$$\n\\operatorname{Var}\\left(\\sum_{t=1}^{n} e_t\\right) = \\sum_{t=1}^{n} \\sum_{s=1}^{n} \\sigma_e^2 \\rho_{|t-s|} = \\sigma_e^2 \\left( \\sum_{t=1}^{n} \\rho_{|t-t|} + \\sum_{t \\neq s} \\rho_{|t-s|} \\right)\n$$\n这个和可以按滞后 $k = |t-s|$ 进行重组。对于从 $1$ 到 $n-1$ 的每个滞后 $k$，和中有 $2(n-k)$ 个对 $(t,s)$。滞后 $k=0$ 出现 $n$ 次。\n$$\n\\operatorname{Var}\\left(\\sum_{t=1}^{n} e_t\\right) = \\sigma_e^2 \\left( n\\rho_0 + \\sum_{k=1}^{n-1} 2(n-k)\\rho_k \\right)\n$$\n由于 $\\rho_0=1$，我们有：\n$$\n\\operatorname{Var}(\\bar{e}) = \\frac{\\sigma_e^2}{n^2} \\left( n + 2\\sum_{k=1}^{n-1} (n-k)\\rho_k \\right) = \\frac{\\sigma_e^2}{n} \\left( 1 + 2\\sum_{k=1}^{n-1} \\left(1-\\frac{k}{n}\\right)\\rho_k \\right)\n$$\n问题陈述中提到 $n$ 很大。这使得对于 $\\rho_k$ 不可忽略的滞后 $k$，近似 $(1 - k/n) \\approx 1$ 是合理的。此外，对于衰减的自相关函数，我们可以用无穷级数来近似有限和：\n$$\n\\operatorname{Var}(\\bar{e}) \\approx \\frac{\\sigma_e^2}{n} \\left( 1 + 2\\sum_{k=1}^{\\infty} \\rho_k \\right)\n$$\n对于给定的一阶自回归 (AR(1)) 过程，$\\rho_k = \\phi^k$。该和是一个无穷几何级数：\n$$\n\\sum_{k=1}^{\\infty} \\phi^k = \\frac{\\phi}{1-\\phi} \\quad (\\text{对于 } |\\phi|1)\n$$\n将此代入方差表达式：\n$$\n\\operatorname{Var}(\\bar{e}) \\approx \\frac{\\sigma_e^2}{n} \\left( 1 + 2\\frac{\\phi}{1-\\phi} \\right) = \\frac{\\sigma_e^2}{n} \\left( \\frac{1-\\phi+2\\phi}{1-\\phi} \\right) = \\frac{\\sigma_e^2}{n} \\left( \\frac{1+\\phi}{1-\\phi} \\right)\n$$\n此表达式需与 $\\sigma_e^2 / n_{\\text{eff}}$ 相等：\n$$\n\\frac{\\sigma_e^2}{n_{\\text{eff}}} = \\frac{\\sigma_e^2}{n} \\left( \\frac{1+\\phi}{1-\\phi} \\right)\n$$\n解出 $n_{\\text{eff}}$，我们得到有效样本量：\n$$\nn_{\\text{eff}} = n \\left( \\frac{1-\\phi}{1+\\phi} \\right)\n$$\n接下来，我们定义膨胀因子 $F$。均值的双侧置信区间的半宽度与均值的标准误 $\\operatorname{SE}(\\bar{e}) = \\sqrt{\\operatorname{Var}(\\bar{e})}$ 成正比。一个 $0.95$ 置信区间的半宽度是 $H = z_{0.025} \\operatorname{SE}(\\bar{e})$。\n\n对于自相关情况：\n$$\nH_{\\text{auto}} = z_{0.025} \\sqrt{\\frac{\\sigma_e^2}{n} \\left( \\frac{1+\\phi}{1-\\phi} \\right)}\n$$\n对于独立残差的情况，当 $k \\ge 1$ 时，自相关 $\\rho_k = 0$，这等价于设置 $\\phi=0$。均值的方差简化为 $\\frac{\\sigma_e^2}{n}$。置信区间的半宽度为：\n$$\nH_{\\text{indep}} = z_{0.025} \\sqrt{\\frac{\\sigma_e^2}{n}}\n$$\n膨胀因子 $F$ 是这两个半宽度的比率：\n$$\nF = \\frac{H_{\\text{auto}}}{H_{\\text{indep}}} = \\frac{z_{0.025} \\sqrt{\\frac{\\sigma_e^2}{n} \\left( \\frac{1+\\phi}{1-\\phi} \\right)}}{z_{0.025} \\sqrt{\\frac{\\sigma_e^2}{n}}} = \\sqrt{\\frac{\\frac{\\sigma_e^2}{n} \\left( \\frac{1+\\phi}{1-\\phi} \\right)}{\\frac{\\sigma_e^2}{n}}}\n$$\n简化表达式，我们得到：\n$$\nF = \\sqrt{\\frac{1+\\phi}{1-\\phi}}\n$$\n我们已知估计参数 $\\hat{\\phi}=0.6$。$n=730$ 的值证实了大样本假设，但在 $F$ 的最终计算中并不需要。\n将 $\\phi = 0.6$ 代入 $F$ 的表达式中：\n$$\nF = \\sqrt{\\frac{1+0.6}{1-0.6}} = \\sqrt{\\frac{1.6}{0.4}} = \\sqrt{4} = 2\n$$\n题目要求答案四舍五入到四位有效数字。因此，$F=2.000$。",
            "answer": "$$\\boxed{2.000}$$"
        },
        {
            "introduction": "除了确定性预报，许多现代环境模型还提供概率预报，这需要更复杂的验证方法。本练习介绍了一种强大的概率预报评估工具——布莱尔分数及其墨菲分解。通过将总体技巧分解为可靠性、分辨率和不确定性三个部分，您可以诊断出预报系统的优势和劣势，从而获得比单一评分更深刻的见解。",
            "id": "3896013",
            "problem": "一个水文气象预报系统每日发布针对二元事件“区域平均降水量超过 $20$ 毫米”的概率预报。在一个季度内的 $N = 750$ 个预报-检验对中，该系统发布的概率取五个离散值，相应的观测结果按以下预报分箱进行汇总。对于发布概率为 $f_k$ 的分箱 $k$，设 $n_k$ 为该分箱中的预报数量，$e_k$ 为该分箱中事件发生的次数。数据如下：\n- 分箱 $1$：$f_1 = 0.05$，$n_1 = 120$，$e_1 = 6$。\n- 分箱 $2$：$f_2 = 0.15$，$n_2 = 150$，$e_2 = 30$。\n- 分箱 $3$：$f_3 = 0.35$，$n_3 = 200$，$e_3 = 70$。\n- 分箱 $4$：$f_4 = 0.55$，$n_4 = 180$，$e_4 = 99$。\n- 分箱 $5$：$f_5 = 0.75$，$n_5 = 100$，$e_5 = 80$。\n\n从二元结果概率预报的布莱尔分数（Brier Score, BS）定义 $BS \\equiv \\frac{1}{N}\\sum_{i=1}^{N} \\left( f_i - Y_i \\right)^2$ 出发（其中 $Y_i \\in \\{0,1\\}$ 是第 $i$ 个个例的检验结果指示符，$f_i \\in [0,1]$ 是发布的概率），推导墨菲分解，该分解将 BS 分解为与上述分箱方案相关联的三个可解释的分量。仅使用基本概率恒等式（如全期望定律和条件均值），并清楚地说明每个分量如何反映预报相对于观测结果的可靠性、分辨率和不确定性。\n\n然后，使用所提供的五个分箱，计算这三个分量的样本估计值。将分箱 $k$ 中的经验事件率定义为 $o_k \\equiv \\frac{e_k}{n_k}$，并将总体基准率定义为 $\\bar{o} \\equiv \\frac{1}{N}\\sum_{k=1}^{5} e_k$。将每个 $f_k$ 视为其分箱内的平均预报。将三个分量的值均四舍五入到四位有效数字，并表示为无量纲数。按可靠性、分辨率、不确定性的顺序报告你的最终答案。",
            "solution": "对于二元事件的概率预报，布莱尔分数 (BS) 定义为预报概率与二元检验结果之间的均方误差，即\n$$\nBS \\equiv \\frac{1}{N} \\sum_{i=1}^{N} \\left( f_i - Y_i \\right)^2,\n$$\n其中 $Y_i \\in \\{0,1\\}$ 且 $f_i \\in [0,1]$。为了将 BS 与可靠性、分辨率和不确定性联系起来，我们从两个基本工具开始：全期望定律和相对于将样本划分为预报分箱的条件均值。设样本被划分为 $K$ 个分箱，索引为 $k \\in \\{1,\\dots,K\\}$，其中分箱 $k$ 包含 $n_k$ 个个例，权重为 $w_k \\equiv \\frac{n_k}{N}$，发布概率为 $f_k$（假设在分箱内为常数），以及经验事件率\n$$\no_k \\equiv \\frac{1}{n_k} \\sum_{i \\in \\text{bin }k} Y_i.\n$$\n设 $\\bar{o} \\equiv \\frac{1}{N} \\sum_{i=1}^{N} Y_i$ 表示总体基准率（气候概率）。\n\n我们寻求将 BS 分解为三项。将分配到分箱 $k$ 的个例 $i$ 的平方误差写为\n$$\n\\left( f_k - Y_i \\right)^2 = \\left( f_k - o_k + o_k - \\bar{o} + \\bar{o} - Y_i \\right)^2.\n$$\n展开平方项，然后在分箱 $k$ 内求平均，接着在所有分箱间求平均，将会产生交叉项，由于 $o_k$ 和 $\\bar{o}$ 的定义，这些交叉项的分箱平均值为零。具体来说，在分箱 $k$ 内，\n$$\n\\frac{1}{n_k} \\sum_{i \\in \\text{bin }k} \\left( \\bar{o} - Y_i \\right) = \\bar{o} - o_k,\n$$\n并且\n$$\n\\frac{1}{n_k} \\sum_{i \\in \\text{bin }k} \\left( \\bar{o} - Y_i \\right)^2 = \\underbrace{o_k(1 - o_k)}_{\\text{分箱结果方差}} + \\left( o_k - \\bar{o} \\right)^2,\n$$\n此乃根据恒等式 $\\operatorname{Var}(Y \\mid \\text{bin }k) = o_k(1 - o_k)$ 和全方差定律。使用这些恒等式，在展开和重组后，分箱均方误差变为\n$$\n\\frac{1}{n_k} \\sum_{i \\in \\text{bin }k} \\left( f_k - Y_i \\right)^2\n= \\underbrace{\\left( f_k - o_k \\right)^2}_{\\text{可靠性贡献}}\n+ \\underbrace{\\left( o_k - \\bar{o} \\right)^2}_{\\text{分辨率贡献}}\n+ \\underbrace{o_k(1 - o_k)}_{\\text{不确定性贡献}}\n- \\underbrace{\\left( o_k - \\bar{o} \\right)^2}_{\\text{重组后抵消}},\n$$\n并且，在使用 $w_k = \\frac{n_k}{N}$ 和恒等式\n$$\n\\sum_{k=1}^{K} w_k \\, o_k(1 - o_k) = \\bar{o}(1 - \\bar{o}) - \\sum_{k=1}^{K} w_k \\left( o_k - \\bar{o} \\right)^2,\n$$\n仔细地组合各分箱的项之后，我们得到墨菲分解：\n$$\nBS = \\underbrace{\\sum_{k=1}^{K} w_k \\left( f_k - o_k \\right)^2}_{\\text{可靠性}}\n\\;-\\;\n\\underbrace{\\sum_{k=1}^{K} w_k \\left( o_k - \\bar{o} \\right)^2}_{\\text{分辨率}}\n\\;+\\;\n\\underbrace{\\bar{o}(1 - \\bar{o})}_{\\text{不确定性}}.\n$$\n解释：\n- 可靠性量化了发布的概率与经验频率之间的一致性；当所有分箱中都有 $f_k \\approx o_k$ 时，该值很小。\n- 分辨率量化了经验频率在不同分箱之间偏离气候基准率 $\\bar{o}$ 的程度；当分箱能够区分具有显著不同 $o_k$ 的个例时，该值很大。\n- 不确定性量化了二元结果的内在变率，并且等于成功概率为 $\\bar{o}$ 的伯努利随机变量的方差。\n\n我们现在使用所提供的数据计算每个分量。\n\n步骤 1：计算 $o_k$、$w_k$ 和 $\\bar{o}$。\n给定 $(n_k, e_k)$：\n- 分箱 $1$：$o_1 = \\frac{6}{120} = \\frac{1}{20} = 0.05$，$w_1 = \\frac{120}{750} = \\frac{4}{25}$。\n- 分箱 $2$：$o_2 = \\frac{30}{150} = \\frac{1}{5} = 0.2$，$w_2 = \\frac{150}{750} = \\frac{1}{5}$。\n- 分箱 $3$：$o_3 = \\frac{70}{200} = \\frac{7}{20} = 0.35$，$w_3 = \\frac{200}{750} = \\frac{4}{15}$。\n- 分箱 $4$：$o_4 = \\frac{99}{180} = \\frac{11}{20} = 0.55$，$w_4 = \\frac{180}{750} = \\frac{6}{25}$。\n- 分箱 $5$：$o_5 = \\frac{80}{100} = \\frac{4}{5} = 0.8$，$w_5 = \\frac{100}{750} = \\frac{2}{15}$。\n总体基准率：\n$$\n\\bar{o} = \\frac{e_1 + e_2 + e_3 + e_4 + e_5}{N} = \\frac{6 + 30 + 70 + 99 + 80}{750} = \\frac{285}{750} = \\frac{19}{50} = 0.38.\n$$\n\n步骤 2：可靠性分量，\n$$\n\\text{Reliability} = \\sum_{k=1}^{5} w_k \\left( f_k - o_k \\right)^2.\n$$\n逐个分箱的差异：\n- 分箱 $1$：$f_1 - o_1 = 0.05 - 0.05 = 0$，贡献为 $0$。\n- 分箱 $2$：$f_2 - o_2 = 0.15 - 0.2 = -0.05$，平方 $= 0.0025 = \\frac{1}{400}$，乘以权重 $w_2 = \\frac{1}{5}$ 得 $\\frac{1}{2000}$。\n- 分箱 $3$：$f_3 - o_3 = 0.35 - 0.35 = 0$，贡献为 $0$。\n- 分箱 $4$：$f_4 - o_4 = 0.55 - 0.55 = 0$，贡献为 $0$。\n- 分箱 $5$：$f_5 - o_5 = 0.75 - 0.8 = -0.05$，平方 $= 0.0025 = \\frac{1}{400}$，乘以权重 $w_5 = \\frac{2}{15}$ 得 $\\frac{1}{3000}$。\n求和，\n$$\n\\text{Reliability} = \\frac{1}{2000} + \\frac{1}{3000} = \\frac{1}{1200} \\approx 0.000833\\overline{3}.\n$$\n\n步骤 3：分辨率分量，\n$$\n\\text{Resolution} = \\sum_{k=1}^{5} w_k \\left( o_k - \\bar{o} \\right)^2.\n$$\n计算差异和平方：\n- 分箱 $1$：$o_1 - \\bar{o} = \\frac{1}{20} - \\frac{19}{50} = -\\frac{33}{100}$，平方 $= \\frac{1089}{10000}$，乘以权重 $w_1 = \\frac{4}{25}$ 得 $\\frac{1089}{62500}$。\n- 分箱 $2$：$o_2 - \\bar{o} = \\frac{1}{5} - \\frac{19}{50} = -\\frac{9}{50}$，平方 $= \\frac{81}{2500}$，乘以权重 $w_2 = \\frac{1}{5}$ 得 $\\frac{81}{12500}$。\n- 分箱 $3$：$o_3 - \\bar{o} = \\frac{7}{20} - \\frac{19}{50} = -\\frac{3}{100}$，平方 $= \\frac{9}{10000}$，乘以权重 $w_3 = \\frac{4}{15}$ 得 $\\frac{6}{25000}$。\n- 分箱 $4$：$o_4 - \\bar{o} = \\frac{11}{20} - \\frac{19}{50} = \\frac{17}{100}$，平方 $= \\frac{289}{10000}$，乘以权重 $w_4 = \\frac{6}{25}$ 得 $\\frac{867}{125000}$。\n- 分箱 $5$：$o_5 - \\bar{o} = \\frac{4}{5} - \\frac{19}{50} = \\frac{21}{50}$，平方 $= \\frac{441}{2500}$，乘以权重 $w_5 = \\frac{2}{15}$ 得 $\\frac{147}{6250}$。\n通分到公分母 $125000$ 后求和：\n$$\n\\text{Resolution} = \\frac{2178 + 810 + 30 + 867 + 2940}{125000} = \\frac{6825}{125000} = \\frac{273}{5000} = 0.0546.\n$$\n\n步骤 4：不确定性分量，\n$$\n\\text{Uncertainty} = \\bar{o} \\left( 1 - \\bar{o} \\right) = \\frac{19}{50} \\cdot \\frac{31}{50} = \\frac{589}{2500} = 0.2356.\n$$\n\n可选验证：该分解意味着 $BS = \\text{可靠性} - \\text{分辨率} + \\text{不确定性}$。使用精确分数，\n$$\nBS = \\frac{1}{1200} - \\frac{273}{5000} + \\frac{589}{2500} = \\frac{1091}{6000} \\approx 0.181833\\ldots,\n$$\n这与将样本按分箱分组后直接对 $\\left( f_i - Y_i \\right)^2$ 求平均的结果一致。\n\n最后，将每个分量四舍五入到四位有效数字并将值表示为无量纲数：\n- 可靠性：$0.0008333$ 四舍五入为 $8.333 \\times 10^{-4}$。\n- 分辨率：$0.0546$ 四舍五入为 $5.460 \\times 10^{-2}$。\n- 不确定性：$0.2356$ 四舍五入为 $2.356 \\times 10^{-1}$。\n\n按可靠性、分辨率、不确定性的顺序报告最终答案。",
            "answer": "$$\\boxed{\\begin{pmatrix}8.333 \\times 10^{-4}  5.460 \\times 10^{-2}  2.356 \\times 10^{-1}\\end{pmatrix}}$$"
        }
    ]
}