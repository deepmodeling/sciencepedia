{
    "hands_on_practices": [
        {
            "introduction": "Let's begin with a foundational exercise to solidify the core principles of local sensitivity analysis. In this problem, we will analyze a simple model of gene expression, a fundamental process in biology that serves as an excellent analog for many source-sink systems in environmental science. By calculating the unnormalized sensitivity of the final protein concentration, you will practice the essential workflow of finding a system's steady state and then quantifying how an output depends on a specific parameter through differentiation .",
            "id": "1442863",
            "problem": "A synthetic biologist is studying a simple gene expression module where a gene is constitutively expressed. The dynamics of this system can be described by a pair of coupled ordinary differential equations for the concentration of messenger RNA (mRNA), denoted as $[M]$, and the concentration of the protein product, denoted as $[P]$:\n\n$$ \\frac{d[M]}{dt} = k_{tx} - \\delta_M [M] $$\n$$ \\frac{d[P]}{dt} = k_{tl} [M] - \\delta_P [P] $$\n\nHere, $k_{tx}$ represents the constant rate of transcription, $\\delta_M$ is the first-order degradation rate constant for the mRNA, $k_{tl}$ is the first-order rate constant for translation (protein synthesis), and $\\delta_P$ is the first-order degradation rate constant for the protein. All parameters are positive real constants.\n\nTo understand how fluctuations in the cellular environment might affect the protein output, the biologist wants to quantify the system's sensitivity. Your task is to determine the unnormalized local sensitivity of the steady-state protein concentration with respect to the translation rate constant.\n\nFind an analytical expression for this sensitivity, which is defined as the partial derivative of the steady-state protein concentration, $[P]_{ss}$, with respect to the translation rate constant, $k_{tl}$. Express your answer in terms of the given model parameters: $k_{tx}$, $\\delta_M$, $k_{tl}$, and $\\delta_P$.",
            "solution": "At steady state, by definition of a steady state in dynamical systems, all time derivatives vanish. Therefore, set $\\frac{d[M]}{dt}=0$ and $\\frac{d[P]}{dt}=0$.\n\nFrom the mRNA equation,\n$$\n0 = k_{tx} - \\delta_M [M]_{ss}\n\\quad \\Rightarrow \\quad\n[M]_{ss} = \\frac{k_{tx}}{\\delta_M}.\n$$\n\nFrom the protein equation,\n$$\n0 = k_{tl} [M]_{ss} - \\delta_P [P]_{ss}\n\\quad \\Rightarrow \\quad\n[P]_{ss} = \\frac{k_{tl}}{\\delta_P}[M]_{ss}.\n$$\n\nSubstituting $[M]_{ss}$ into the expression for $[P]_{ss}$ gives\n$$\n[P]_{ss} = \\frac{k_{tl}}{\\delta_P} \\cdot \\frac{k_{tx}}{\\delta_M}\n= \\frac{k_{tx} k_{tl}}{\\delta_M \\delta_P}.\n$$\n\nThe unnormalized local sensitivity of $[P]_{ss}$ with respect to $k_{tl}$ is the partial derivative\n$$\n\\frac{\\partial [P]_{ss}}{\\partial k_{tl}}\n= \\frac{\\partial}{\\partial k_{tl}}\\left(\\frac{k_{tx} k_{tl}}{\\delta_M \\delta_P}\\right)\n= \\frac{k_{tx}}{\\delta_M \\delta_P},\n$$\ntreating $k_{tx}$, $\\delta_M$, and $\\delta_P$ as constants with respect to $k_{tl}$.",
            "answer": "$$\\boxed{\\frac{k_{tx}}{\\delta_M \\delta_P}}$$"
        },
        {
            "introduction": "Sensitivity analysis can reveal surprising, non-intuitive properties about a system's structure. This next practice explores a simple metabolic pathway to demonstrate how an output's sensitivity to a particular parameter can be exactly zero. This exercise  highlights that local sensitivity analysis is not just a numerical task, but a powerful diagnostic tool for identifying which parameters actually control a system's behavior at steady state, a crucial step in model simplification and analysis.",
            "id": "1442888",
            "problem": "Consider a simplified model of a two-step metabolic pathway within a cell. A substrate molecule, $S_1$, is converted into an intermediate product, $S_2$, by enzyme $E_1$. This intermediate, $S_2$, is then converted into a final product, $S_3$, by enzyme $E_2$.\n\nThe system's dynamics are described by the following set of ordinary differential equations (ODEs), based on mass-action kinetics:\n1.  An external source provides $S_1$ to the system at a constant influx rate, $v_{in}$.\n2.  $S_1$ is converted to $S_2$ with a first-order rate constant $k_1$. The rate of this reaction is $k_1 [S_1]$.\n3.  $S_2$ is converted to $S_3$ with a first-order rate constant $k_2$. The rate of this reaction is $k_2 [S_2]$.\n\nThe concentrations of $S_1$ and $S_2$, denoted as $[S_1]$ and $[S_2]$ respectively, evolve according to:\n$$\n\\frac{d[S_1]}{dt} = v_{in} - k_1 [S_1]\n$$\n$$\n\\frac{d[S_2]}{dt} = k_1 [S_1] - k_2 [S_2]\n$$\n\nThe system is allowed to reach a steady-state, where the concentrations of $S_1$ and $S_2$ no longer change over time. We are interested in the steady-state concentration of the intermediate product, $[\\bar{S_2}]$, which we define as the output of this pathway.\n\nIn systems biology, a local sensitivity analysis is often performed to quantify how a system's output is affected by small changes in its parameters. The scaled sensitivity coefficient of an output $y$ with respect to a parameter $p$, denoted as $C_p^y$, is defined as:\n$$\nC_p^y = \\frac{\\partial y}{\\partial p} \\frac{p}{y}\n$$\n\nFor which of the following parameters, $p$, is the scaled sensitivity coefficient of the steady-state output, $y = [\\bar{S_2}]$, exactly equal to zero?\n\nA. $v_{in}$\n\nB. $k_1$\n\nC. $k_2$\n\nD. All parameters have a non-zero sensitivity.\n\nE. The result depends on the initial concentrations $[S_1](0)$ and $[S_2](0)$.",
            "solution": "Set steady-state by equating time derivatives to zero. From\n$$\n\\frac{d[S_1]}{dt} = v_{in} - k_{1}[S_1],\n$$\nthe steady-state satisfies\n$$\n0 = v_{in} - k_{1}[\\bar{S_1}] \\quad \\Rightarrow \\quad [\\bar{S_1}] = \\frac{v_{in}}{k_{1}}.\n$$\nFrom\n$$\n\\frac{d[S_2]}{dt} = k_{1}[S_1] - k_{2}[S_2],\n$$\nthe steady-state satisfies\n$$\n0 = k_{1}[\\bar{S_1}] - k_{2}[\\bar{S_2}] \\quad \\Rightarrow \\quad [\\bar{S_2}] = \\frac{k_{1}}{k_{2}}[\\bar{S_1}] = \\frac{k_{1}}{k_{2}}\\frac{v_{in}}{k_{1}} = \\frac{v_{in}}{k_{2}}.\n$$\nDefine the output as $y = [\\bar{S_2}] = \\frac{v_{in}}{k_{2}}$. The scaled sensitivity coefficient is\n$$\nC_{p}^{y} = \\frac{\\partial y}{\\partial p}\\frac{p}{y}.\n$$\nCompute each:\n1) For $p = v_{in}$, $\\frac{\\partial y}{\\partial v_{in}} = \\frac{1}{k_{2}}$, so\n$$\nC_{v_{in}}^{y} = \\frac{1}{k_{2}}\\frac{v_{in}}{v_{in}/k_{2}} = 1.\n$$\n2) For $p = k_{1}$, $y$ does not depend on $k_{1}$, so\n$$\n\\frac{\\partial y}{\\partial k_{1}} = 0 \\quad \\Rightarrow \\quad C_{k_{1}}^{y} = 0.\n$$\n3) For $p = k_{2}$, $\\frac{\\partial y}{\\partial k_{2}} = -\\frac{v_{in}}{k_{2}^{2}}$, so\n$$\nC_{k_{2}}^{y} = \\left(-\\frac{v_{in}}{k_{2}^{2}}\\right)\\frac{k_{2}}{v_{in}/k_{2}} = -1.\n$$\nTherefore, the only parameter with zero scaled sensitivity of $[\\bar{S_2}]$ is $k_{1}$. Since $[\\bar{S_2}]$ at steady state depends only on $v_{in}$ and $k_{2}$, the result does not depend on initial conditions.",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "Real-world environmental models often contain nonlinearities and thresholds that pose challenges for standard calculus. This advanced practice confronts this reality by examining a common \"bucket\" model for soil moisture that includes a non-differentiable runoff function. You will learn how to regularize such a function and apply the implicit function theorem to derive sensitivities , providing you with essential techniques for analyzing the complex, implicitly-defined models prevalent in Earth system science.",
            "id": "3889139",
            "problem": "A soil column is represented by a single-reservoir “bucket” model based on mass conservation for storage. Let $S(t)$ denote soil moisture storage in $\\mathrm{mm}$. The mass balance is the ordinary differential equation (ODE) $\\,\\mathrm{d}S/\\mathrm{d}t = \\text{inputs} - \\text{outputs}\\,$, specifically\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} \\;=\\; P \\;-\\; E(S) \\;-\\; R(S;k),\n$$\nwhere $P$ is constant precipitation input in $\\mathrm{mm\\,day^{-1}}$, $E(S)$ is evapotranspiration in $\\mathrm{mm\\,day^{-1}}$, and $R(S;k)$ is runoff in $\\mathrm{mm\\,day^{-1}}$ governed by a threshold onset at a storage level $S^{*}$. Consider the commonly used threshold runoff closure\n$$\nR_{\\text{thr}}(S;k) \\;=\\; k\\,\\max\\!\\big(0,\\,S - S^{*}\\big),\n$$\nwith $k$ a rate parameter in $\\mathrm{day^{-1}}$ and $S^{*}$ in $\\mathrm{mm}$. Assume a linear evapotranspiration closure $E(S) = c\\,S$ with $c$ in $\\mathrm{day^{-1}}$.\n\n1. Diagnose the differentiability issue at the runoff onset $S = S^{*}$ for $R_{\\text{thr}}(S;k)$ and explain why this creates a problem for local (derivative-based) sensitivity analysis of model terms with respect to $S$ and parameters at $S = S^{*}$.\n\n2. To regularize the model near onset, adopt the smooth “softplus” approximation to the positive part:\n$$\n\\phi_{\\epsilon}(x) \\;=\\; \\epsilon\\,\\ln\\!\\big(1 + \\exp(x/\\epsilon)\\big),\n$$\nwith smoothing scale $\\epsilon$ in $\\mathrm{mm}$, and define the smoothed runoff\n$$\nR_{\\epsilon}(S;k) \\;=\\; k\\,\\phi_{\\epsilon}\\!\\big(S - S^{*}\\big).\n$$\nUnder constant forcing, steady state $S_{\\mathrm{ss}}$ satisfies\n$$\n0 \\;=\\; P \\;-\\; c\\,S_{\\mathrm{ss}} \\;-\\; k\\,\\phi_{\\epsilon}\\!\\big(S_{\\mathrm{ss}} - S^{*}\\big).\n$$\nUse the implicit function theorem to derive an analytic expression for the local steady-state sensitivity $\\mathrm{d}S_{\\mathrm{ss}}/\\mathrm{d}k$ in terms of $\\phi_{\\epsilon}$ and its derivative evaluated at $S_{\\mathrm{ss}}$.\n\n3. Let the parameters be $S^{*} = 100\\,\\mathrm{mm}$, $c = 0.010\\,\\mathrm{day^{-1}}$, $k = 0.10\\,\\mathrm{day^{-1}}$, and $\\epsilon = 5.0\\,\\mathrm{mm}$. Consider precipitation set such that the smoothed model equilibrates exactly at onset, $S_{\\mathrm{ss}} = S^{*}$. Evaluate your sensitivity expression at this steady state and parameter set. Express the final sensitivity in millimetre-days ($\\mathrm{mm\\cdot day}$) and round your answer to four significant figures.",
            "solution": "**Part 1: Differentiability of the Threshold Runoff Function**\n\nThe threshold runoff closure is given by the function\n$$\nR_{\\text{thr}}(S;k) = k\\,\\max(0, S - S^{*})\n$$\nwhere $S$ is the soil moisture storage, $S^{*}$ is the threshold storage, and $k$ is a rate parameter. To analyze its differentiability, we examine its derivative with respect to $S$, which we denote as $\\mathrm{d}R_{\\text{thr}}/\\mathrm{d}S$.\n\nThe function's behavior changes at the point $S = S^{*}$. We consider the two cases:\n1.  For $S < S^{*}$, the argument $S - S^{*}$ is negative, so $\\max(0, S - S^{*}) = 0$. The function is $R_{\\text{thr}}(S;k) = k \\cdot 0 = 0$. The derivative in this region is $\\mathrm{d}R_{\\text{thr}}/\\mathrm{d}S = 0$.\n2.  For $S > S^{*}$, the argument $S - S^{*}$ is positive, so $\\max(0, S - S^{*}) = S - S^{*}$. The function is $R_{\\text{thr}}(S;k) = k(S - S^{*})$. The derivative in this region is $\\mathrm{d}R_{\\text{thr}}/\\mathrm{d}S = k$.\n\nAt the point $S = S^{*}$, the left-hand limit of the derivative is\n$$\n\\lim_{S \\to {S^{*-}}} \\frac{\\mathrm{d}R_{\\text{thr}}}{\\mathrm{d}S} = 0\n$$\nand the right-hand limit of the derivative is\n$$\n\\lim_{S \\to {S^{*+}}} \\frac{\\mathrm{d}R_{\\text{thr}}}{\\mathrm{d}S} = k\n$$\nSince the parameter $k$ represents a positive runoff rate, $k > 0$, the left-hand and right-hand derivatives are not equal. Therefore, the function $R_{\\text{thr}}(S;k)$ is not differentiable at the point $S = S^{*}$. This point is a \"corner\" in the function's graph.\n\nLocal (derivative-based) sensitivity analysis requires computing derivatives of model outputs with respect to model parameters. For instance, the sensitivity of the steady-state storage $S_{\\mathrm{ss}}$ with respect to a parameter (like $k$) often involves the Jacobian of the model's right-hand side, $\\mathrm{d}(\\mathrm{d}S/\\mathrm{d}t)/\\mathrm{d}S$, evaluated at $S_{\\mathrm{ss}}$. In our model, this Jacobian is $\\mathrm{d}/\\mathrm{d}S [P - cS - R(S;k)] = -c - \\mathrm{d}R/\\mathrm{d}S$. Due to the non-differentiability of $R_{\\text{thr}}$ at $S = S^{*}$, this Jacobian is discontinuous at $S = S^{*}$. If the model happens to equilibrate at this point ($S_{\\mathrm{ss}} = S^{*}$), any sensitivity measures that rely on this Jacobian become ill-defined, as the derivative does not exist. This precludes the use of standard local sensitivity methods at the runoff onset threshold.\n\n**Part 2: Derivation of the Steady-State Sensitivity $\\mathrm{d}S_{\\mathrm{ss}}/\\mathrm{d}k$**\n\nThe smoothed model has a steady state $S_{\\mathrm{ss}}$ that satisfies the implicit equation:\n$$\nF(S_{\\mathrm{ss}}, k) = P - c\\,S_{\\mathrm{ss}} - k\\,\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*}) = 0\n$$\nHere, $S_{\\mathrm{ss}}$ is an implicit function of the parameters, including $k$. We can find the sensitivity $\\mathrm{d}S_{\\mathrm{ss}}/\\mathrm{d}k$ using the Implicit Function Theorem, which states that if $F(y, x) = 0$, then $\\mathrm{d}y/\\mathrm{d}x = -(\\partial F/\\partial x) / (\\partial F/\\partial y)$, provided $\\partial F/\\partial y \\neq 0$. In our context, $y = S_{\\mathrm{ss}}$ and $x = k$.\n\nWe compute the required partial derivatives of $F(S_{\\mathrm{ss}}, k)$:\n\nFirst, the partial derivative with respect to $k$:\n$$\n\\frac{\\partial F}{\\partial k} = \\frac{\\partial}{\\partial k} \\left[ P - c\\,S_{\\mathrm{ss}} - k\\,\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*}) \\right] = -\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})\n$$\n\nSecond, the partial derivative with respect to $S_{\\mathrm{ss}}$:\n$$\n\\frac{\\partial F}{\\partial S_{\\mathrm{ss}}} = \\frac{\\partial}{\\partial S_{\\mathrm{ss}}} \\left[ P - c\\,S_{\\mathrm{ss}} - k\\,\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*}) \\right] = -c - k\\,\\frac{\\mathrm{d}}{\\mathrm{d}S_{\\mathrm{ss}}}\\left[\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})\\right]\n$$\nTo evaluate this, we need the derivative of the softplus function $\\phi_{\\epsilon}(x) = \\epsilon\\,\\ln(1 + \\exp(x/\\epsilon))$. Let $\\phi'_{\\epsilon}(x) = \\mathrm{d}\\phi_{\\epsilon}/\\mathrm{d}x$.\n$$\n\\phi'_{\\epsilon}(x) = \\epsilon \\cdot \\frac{1}{1 + \\exp(x/\\epsilon)} \\cdot \\exp(x/\\epsilon) \\cdot \\frac{1}{\\epsilon} = \\frac{\\exp(x/\\epsilon)}{1 + \\exp(x/\\epsilon)} = \\frac{1}{1 + \\exp(-x/\\epsilon)}\n$$\nThis is the logistic sigmoid function. Using the chain rule, $\\frac{\\mathrm{d}}{\\mathrm{d}S_{\\mathrm{ss}}}\\left[\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})\\right] = \\phi'_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})$.\nThus,\n$$\n\\frac{\\partial F}{\\partial S_{\\mathrm{ss}}} = -c - k\\,\\phi'_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})\n$$\n\nApplying the Implicit Function Theorem:\n$$\n\\frac{\\mathrm{d}S_{\\mathrm{ss}}}{\\mathrm{d}k} = - \\frac{\\partial F/\\partial k}{\\partial F/\\partial S_{\\mathrm{ss}}} = - \\frac{-\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})}{-c - k\\,\\phi'_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})} = - \\frac{\\phi_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})}{c + k\\,\\phi'_{\\epsilon}(S_{\\mathrm{ss}} - S^{*})}\n$$\nThis is the desired analytic expression for the local steady-state sensitivity.\n\n**Part 3: Evaluation of the Sensitivity Expression**\n\nWe are asked to evaluate $\\mathrm{d}S_{\\mathrm{ss}}/\\mathrm{d}k$ under the condition $S_{\\mathrm{ss}} = S^{*}$, with parameters $S^{*} = 100\\,\\mathrm{mm}$, $c = 0.010\\,\\mathrm{day^{-1}}$, $k = 0.10\\,\\mathrm{day^{-1}}$, and $\\epsilon = 5.0\\,\\mathrm{mm}$.\n\nWhen $S_{\\mathrm{ss}} = S^{*}$, the argument of the softplus functions is $S_{\\mathrm{ss}} - S^{*} = 0$. We evaluate $\\phi_{\\epsilon}(0)$ and $\\phi'_{\\epsilon}(0)$:\n$$\n\\phi_{\\epsilon}(0) = \\epsilon\\,\\ln(1 + \\exp(0/\\epsilon)) = \\epsilon\\,\\ln(1 + 1) = \\epsilon\\,\\ln(2)\n$$\n$$\n\\phi'_{\\epsilon}(0) = \\frac{\\exp(0/\\epsilon)}{1 + \\exp(0/\\epsilon)} = \\frac{1}{1+1} = \\frac{1}{2}\n$$\nSubstituting these into the sensitivity expression:\n$$\n\\left. \\frac{\\mathrm{d}S_{\\mathrm{ss}}}{\\mathrm{d}k} \\right|_{S_{\\mathrm{ss}} = S^{*}} = - \\frac{\\epsilon\\,\\ln(2)}{c + k\\,(1/2)}\n$$\nNow, we substitute the given numerical values:\n$$\n\\left. \\frac{\\mathrm{d}S_{\\mathrm{ss}}}{\\mathrm{d}k} \\right|_{S_{\\mathrm{ss}} = S^{*}} = - \\frac{(5.0\\,\\mathrm{mm})\\,\\ln(2)}{0.010\\,\\mathrm{day^{-1}} + (0.10\\,\\mathrm{day^{-1}})/2}\n$$\n$$\n\\left. \\frac{\\mathrm{d}S_{\\mathrm{ss}}}{\\mathrm{d}k} \\right|_{S_{\\mathrm{ss}} = S^{*}} = - \\frac{5.0\\,\\ln(2)}{0.010 + 0.050} \\, \\frac{\\mathrm{mm}}{\\mathrm{day^{-1}}}\n$$\n$$\n\\left. \\frac{\\mathrm{d}S_{\\mathrm{ss}}}{\\mathrm{d}k} \\right|_{S_{\\mathrm{ss}} = S^{*}} = - \\frac{5.0\\,\\ln(2)}{0.060} \\, \\mathrm{mm \\cdot day}\n$$\nUsing the approximate value $\\ln(2) \\approx 0.693147$:\n$$\n\\left. \\frac{\\mathrm{d}S_{\\mathrm{ss}}}{\\mathrm{d}k} \\right|_{S_{\\mathrm{ss}} = S^{*}} \\approx - \\frac{5.0 \\times 0.693147}{0.060} \\, \\mathrm{mm \\cdot day} \\approx - \\frac{3.465735}{0.060} \\, \\mathrm{mm \\cdot day} \\approx -57.76225 \\, \\mathrm{mm \\cdot day}\n$$\nRounding the result to four significant figures, we get $-57.76\\,\\mathrm{mm \\cdot day}$.",
            "answer": "$$\n\\boxed{-57.76}\n$$"
        }
    ]
}