{
    "hands_on_practices": [
        {
            "introduction": "均方根误差（RMSE）和平均绝对误差（MAE）是评估模型性能最常用的两个指标。本练习将通过一个具体的校准场景，让您亲手计算这两个指标，并推导如何根据它们来优化模型参数。这个过程将清晰地揭示两者在处理误差，特别是异常值（outliers）时的根本差异，帮助您理解为何选择不同的目标函数会引导模型走向不同的校准结果。",
            "id": "3899972",
            "problem": "一个流域尺度的水文模型正在使用一个加性偏差参数对日降水量进行校准。设第 $i$ 天的原始模型降水量为 $P_{i}^{\\mathrm{raw}}$，观测降水量为 $P_{i}^{\\mathrm{obs}}$，带有加性偏差参数 $b$ 的模型为 $P_{i}^{\\mathrm{mod}}(b) = P_{i}^{\\mathrm{raw}} + b$。定义残差为 $e_{i}(b) = P_{i}^{\\mathrm{mod}}(b) - P_{i}^{\\mathrm{obs}}$。对于一个为期 $12$ 天的训练期，当 $b=0$ 时的残差（单位：毫米/天）由以下集合给出：\n$$\n\\{ -6.2,\\ 3.9,\\ -1.1,\\ 0.0,\\ 5.3,\\ -14.8,\\ 7.5,\\ 1.6,\\ -2.9,\\ 2.1,\\ -0.7,\\ 4.0 \\}.\n$$\n仅从均方根误差 (RMSE) 和平均绝对误差 (MAE) 的定义出发，完成以下任务：\n\n1) 使用所提供的 $b=0$ 时的残差，计算均方根误差 (RMSE) 和平均绝对误差 (MAE)。两者均以毫米/天为单位表示。\n\n2) 将加性偏差 $b$ 作为唯一的校准参数，写出分别对应于均方根误差 (RMSE) 和平均绝对误差 (MAE) 的目标函数 $J_{\\mathrm{RMSE}}(b)$ 和 $J_{\\mathrm{MAE}}(b)$，用残差 $e_{i}(b)$ 表示。根据基本定义，推导使每个目标函数最小化的 $b$ 值，并对所提供的数据计算这些最小化值的数值。\n\n3) 利用你的推导，定性讨论每种度量如何塑造 $b$ 的校准目标函数形态（例如，光滑性、曲率和对离群值的敏感性），并将这些性质与你求得的最小值点联系起来。\n\n为便于评分，请报告一个标量值，即在第1部分计算的 $b=0$ 时的 RMSE 与 MAE 之比。将报告的比率四舍五入到四位有效数字。报告的比率应为无单位的纯数。如果陈述了中间量，请以毫米/天为单位表示。",
            "solution": "该问题被评估为有效，因为它具有科学依据、提法明确且客观。它提出了一个环境建模中的标准校准任务，可以使用所提供的信息解决。\n\n训练期的数据点总数为 $N=12$。在偏差 $b=0$ 时的残差集合为 $E_0 = \\{ -6.2,\\ 3.9,\\ -1.1,\\ 0.0,\\ 5.3,\\ -14.8,\\ 7.5,\\ 1.6,\\ -2.9,\\ 2.1,\\ -0.7,\\ 4.0 \\}$。单位为毫米/天 (mm/day)。\n\n首先，我们计算加性偏差 $b=0$ 情况下的均方根误差 (RMSE) 和平均绝对误差 (MAE)。\n对于一组包含 $N$ 个残差 $e_i$ 的集合，RMSE的定义是：\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} e_{i}^{2}}\n$$\n对于给定的残差 $e_i(0)$，我们首先计算平方和：\n$$\n\\sum_{i=1}^{12} (e_{i}(0))^{2} = (-6.2)^2 + (3.9)^2 + (-1.1)^2 + (0.0)^2 + (5.3)^2 + (-14.8)^2 + (7.5)^2 + (1.6)^2 + (-2.9)^2 + (2.1)^2 + (-0.7)^2 + (4.0)^2\n$$\n$$\n\\sum_{i=1}^{12} (e_{i}(0))^{2} = 38.44 + 15.21 + 1.21 + 0.0 + 28.09 + 219.04 + 56.25 + 2.56 + 8.41 + 4.41 + 0.49 + 16.0 = 390.11\n$$\n因此，$b=0$ 时的 RMSE 为：\n$$\n\\mathrm{RMSE}(0) = \\sqrt{\\frac{390.11}{12}} \\approx 5.7017 \\text{ 毫米/天}\n$$\n对于一组包含 $N$ 个残差 $e_i$ 的集合，MAE的定义是：\n$$\n\\mathrm{MAE} = \\frac{1}{N} \\sum_{i=1}^{N} |e_i|\n$$\n对于给定的残差，我们计算绝对值之和：\n$$\n\\sum_{i=1}^{12} |e_{i}(0)| = |-6.2| + |3.9| + |-1.1| + |0.0| + |5.3| + |-14.8| + |7.5| + |1.6| + |-2.9| + |2.1| + |-0.7| + |4.0|\n$$\n$$\n\\sum_{i=1}^{12} |e_{i}(0)| = 6.2 + 3.9 + 1.1 + 0.0 + 5.3 + 14.8 + 7.5 + 1.6 + 2.9 + 2.1 + 0.7 + 4.0 = 50.1\n$$\n因此，$b=0$ 时的 MAE 为：\n$$\n\\mathrm{MAE}(0) = \\frac{50.1}{12} = 4.175 \\text{ 毫米/天}\n$$\n\n其次，我们确定使 RMSE 和 MAE 最小化的加性偏差参数 $b$ 的值。作为 $b$ 的函数的残差为 $e_i(b) = P_{i}^{\\mathrm{mod}}(b) - P_{i}^{\\mathrm{obs}} = (P_{i}^{\\mathrm{raw}} + b) - P_{i}^{\\mathrm{obs}} = (P_{i}^{\\mathrm{raw}} - P_{i}^{\\mathrm{obs}}) + b = e_{i}(0) + b$。\n\n为了最小化 RMSE，我们定义目标函数 $J_{\\mathrm{RMSE}}(b)$：\n$$\nJ_{\\mathrm{RMSE}}(b) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} (e_{i}(b))^{2}} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} (e_{i}(0) + b)^{2}}\n$$\n最小化 $J_{\\mathrm{RMSE}}(b)$ 等价于最小化其平方，即均方误差 (MSE)，我们记为 $L(b) = (J_{\\mathrm{RMSE}}(b))^2$。为了找到最小值，我们计算 $L(b)$ 关于 $b$ 的导数并将其设为 $0$：\n$$\n\\frac{dL}{db} = \\frac{d}{db} \\left[ \\frac{1}{N} \\sum_{i=1}^{N} (e_{i}(0) + b)^{2} \\right] = \\frac{1}{N} \\sum_{i=1}^{N} 2(e_{i}(0) + b) = \\frac{2}{N} \\left( \\sum_{i=1}^{N} e_{i}(0) + Nb \\right)\n$$\n将导数设为零可得：\n$$\n\\sum_{i=1}^{N} e_{i}(0) + Nb = 0 \\implies b = -\\frac{1}{N} \\sum_{i=1}^{N} e_{i}(0) = -\\overline{e(0)}\n$$\n最优偏差 $b_{\\mathrm{RMSE}}$ 是初始残差均值的负数。二阶导数 $\\frac{d^{2}L}{db^2} = 2 > 0$，证实了这是一个最小值点。\n我们计算初始残差的总和：\n$$\n\\sum_{i=1}^{12} e_{i}(0) = -6.2 + 3.9 - 1.1 + 0.0 + 5.3 - 14.8 + 7.5 + 1.6 - 2.9 + 2.1 - 0.7 + 4.0 = -1.3\n$$\n因此，针对 RMSE 的最优偏差是：\n$$\nb_{\\mathrm{RMSE}} = -\\frac{-1.3}{12} = \\frac{1.3}{12} \\approx 0.1083 \\text{ 毫米/天}\n$$\n\n为了最小化 MAE，我们定义目标函数 $J_{\\mathrm{MAE}}(b)$：\n$$\nJ_{\\mathrm{MAE}}(b) = \\frac{1}{N} \\sum_{i=1}^{N} |e_{i}(b)| = \\frac{1}{N} \\sum_{i=1}^{N} |e_{i}(0) + b|\n$$\n最小化 $J_{\\mathrm{MAE}}(b)$ 等价于最小化绝对偏差之和 $\\sum_{i=1}^{N} |e_{i}(0) - (-b)|$。根据统计学的基本原理，当点 $-b$ 是值集合 $\\{e_{i}(0)\\}$ 的中位数时，此和达到最小值。因此，最优偏差是 $b_{\\mathrm{MAE}} = -\\mathrm{median}\\{e_{i}(0)\\}$。\n为了找到中位数，我们将初始残差排序：\n$$\n\\{ -14.8, -6.2, -2.9, -1.1, -0.7, 0.0, 1.6, 2.1, 3.9, 4.0, 5.3, 7.5 \\}\n$$\n由于 $N=12$ 是一个偶数，中位数是中间两个值（即第 $6$ 和第 $7$ 个元素）的平均值：\n$$\n\\mathrm{median}\\{e_{i}(0)\\} = \\frac{0.0 + 1.6}{2} = 0.8\n$$\n因此，针对 MAE 的最优偏差是：\n$$\nb_{\\mathrm{MAE}} = -0.8 \\text{ 毫米/天}\n$$\n\n第三，我们对校准目标函数的形态进行定性讨论。\nRMSE 目标函数基于误差的平方，因此其关于 $b$ 的校准目标函数形态是一条光滑的凸抛物线。其目标函数 $L(b) = (J_{\\mathrm{RMSE}}(b))^2$ 是 $b$ 的二次函数，保证了存在一个唯一的、明确定义的最小值，该最小值可以通过解析方法找到。平方项的关键特性是它对离群值的敏感性。大的残差比小的残差具有重得多的权重。值 $b_{\\mathrm{RMSE}} \\approx 0.1083$ 是一个小的正偏差。它受到大的负离群值 $e_6(0) = -14.8$ 的显著影响。这一个大的误差将残差的均值拉低至 $\\overline{e(0)} \\approx -0.1083$，因此校准通过一个正偏差进行调整以抵消此影响。\n\nMAE 目标函数基于绝对误差，其校准目标函数形态也是凸的，但不光滑。它是分段线性的，在每个使得 $b = -e_i(0)$ 的 $b$ 值处存在不可微点（“尖点”）。其最小值点，即中位数，对离群值具有稳健性。极端残差的大小不影响中位数的位置，只影响其排序。对于我们的数据，残差的中位数是 $0.8$。这表明相对于这个值，模型有一半时间高估，一半时间低估。大的离群值 $-14.8$ 对中位数的影响并不比 $-6.2$ 的影响大。由此产生的最优偏差 $b_{\\mathrm{MAE}} = -0.8$ 表明校正是基于大部分数据的集中趋势，实际上忽略了极端离群值，并得出模型通常高估降水量的结论。$b_{\\mathrm{RMSE}} \\approx 0.1083$ 和 $b_{\\mathrm{MAE}} = -0.8$ 之间的显著差异是每种度量处理离群值方式的直接结果。\n\n最后，为了评分，我们报告 $b=0$ 时 RMSE 与 MAE 的比率。\n$$\n\\text{Ratio} = \\frac{\\mathrm{RMSE}(0)}{\\mathrm{MAE}(0)} = \\frac{\\sqrt{390.11/12}}{4.175} \\approx \\frac{5.70168}{4.175} \\approx 1.36567\n$$\n四舍五入到四位有效数字，该比率为 $1.366$。",
            "answer": "$$\n\\boxed{1.366}\n$$"
        },
        {
            "introduction": "在实践一中我们看到，RMSE对异常值敏感，而MAE则更为稳健但其导数不连续。那么，是否存在一种兼具两者优点的“混合”方案呢？Huber损失函数正是为此而生，它为小误差提供平滑的二次惩罚，为大误差（异常值）提供线性的、影响较小的惩罚。通过本练习，您将学习如何使用这种稳健的目标函数，并探索其可调阈值 $\\delta$ 如何让建模者能够灵活地控制模型对异常值的敏感度。",
            "id": "3899944",
            "problem": "在环境与地球系统建模中，一个简化的校准情景考虑在一个降水模型中调整一个标量加性偏差参数 $b$，以使模拟的日降水强度与观测值在一个短时期内对齐。设观测减去模拟的日降水残差为 $e_i = o_i - m_i$（$i = 1, \\dots, 7$），单位为 $\\mathrm{mm\\,day^{-1}}$。假设残差为\n$$\ne_1 = -4,\\quad e_2 = -1,\\quad e_3 = 0,\\quad e_4 = 1,\\quad e_5 = 2,\\quad e_6 = 3,\\quad e_7 = 8.\n$$\n校准参数 $b$ 对模型进行加性调整，产生残差 $r_i(b) = e_i - b$。稳健校准旨在通过对小残差进行二次惩罚、对大残差进行线性惩罚来减少离群值的不当影响，并使用一个可调阈值 $\\delta$ 来控制这两种机制之间的转换。Huber型目标函数 $J_{\\delta}(b)$ 是每日贡献的总和，即 $J_{\\delta}(b) = \\sum_{i=1}^{7} \\rho_{\\delta}\\big(r_i(b)\\big)$，其中当 $|r_i(b)|$ 低于阈值 $\\delta$ 时惩罚是二次的，而当 $|r_i(b)|$ 高于阈值时惩罚是线性的。\n\n从基于残差的失配最小化和在核心区域为二次、在尾部为线性的稳健惩罚设计原则出发，推导出Huber惩罚 $\\rho_{\\delta}(r)$ 及其一阶导数的显式数学形式。然后，使用凸目标函数的一阶最优性条件，分别针对 $\\delta = 2\\,\\mathrm{mm\\,day^{-1}}$ 和 $\\delta = 10\\,\\mathrm{mm\\,day^{-1}}$ 的情况，计算使 $J_{\\delta}(b)$ 最小化的偏差 $b^{\\star}$。对于每个 $\\delta$，也计算最小化的目标函数值 $J_{\\delta}\\big(b^{\\star}\\big)$。\n\n用 $\\mathrm{mm\\,day^{-1}}$ 表示最终校准的偏差值 $b^{\\star}$，用 $\\big(\\mathrm{mm\\,day^{-1}}\\big)^{2}$ 表示最小化的目标函数值 $J_{\\delta}\\big(b^{\\star}\\big)$。将所有报告的数值四舍五入到四位有效数字。你的最终答案必须是一个单行矩阵，按顺序包含 $\\delta=2$ 时的 $b^{\\star}$、$J_{2}\\big(b^{\\star}\\big)$、$\\delta=10$ 时的 $b^{\\star}$ 和 $J_{10}\\big(b^{\\star}\\big)$。",
            "solution": "用户的请求是一个有效的科学问题。\n\n### 步骤 1：Huber惩罚函数及其导数的推导\n\n问题描述了一个稳健的惩罚函数 $\\rho_{\\delta}(r)$，它对小残差（$|r| \\le \\delta$）是二次的，对大残差（$|r| > \\delta$）是线性的。为确保整个目标函数是凸且可微的，我们必须构造 $\\rho_{\\delta}(r)$ 使其处处连续可微（$C^1$）。\n\n对于二次区域，我们将惩罚定义为：\n$$\n\\rho_{\\delta}(r) = \\frac{1}{2} r^2 \\quad \\text{for } |r| \\le \\delta\n$$\n因子 $\\frac{1}{2}$ 是一个简化导数的标准约定。在这个区域内的导数是：\n$$\n\\rho'_{\\delta}(r) = r \\quad \\text{for } |r| \\le \\delta\n$$\n在转换点 $r = \\pm\\delta$ 处，函数值及其导数是：\n$$\n\\rho_{\\delta}(\\pm\\delta) = \\frac{1}{2}\\delta^2\n$$\n$$\n\\rho'_{\\delta}(\\pm\\delta) = \\pm\\delta\n$$\n对于线性区域 $|r| > \\delta$，函数必须与这些值和斜率相匹配。对于 $r > \\delta$，我们需要一条斜率为 $m = \\delta$ 且通过点 $(\\delta, \\frac{1}{2}\\delta^2)$ 的直线。使用点斜式 $y - y_1 = m(x-x_1)$：\n$$\n\\rho_{\\delta}(r) - \\frac{1}{2}\\delta^2 = \\delta(r - \\delta)\n$$\n$$\n\\rho_{\\delta}(r) = \\delta r - \\delta^2 + \\frac{1}{2}\\delta^2 = \\delta r - \\frac{1}{2}\\delta^2 \\quad \\text{for } r > \\delta\n$$\n由于惩罚必须是 $r$ 的偶函数（即 $\\rho_{\\delta}(r) = \\rho_{\\delta}(-r)$），通过将 $r$ 替换为 $|r|$ 可得到 $r  -\\delta$ 时的表达式：\n$$\n\\rho_{\\delta}(r) = \\delta|r| - \\frac{1}{2}\\delta^2 \\quad \\text{for } |r| > \\delta\n$$\n综合以上，Huber惩罚函数是：\n$$\n\\rho_{\\delta}(r) = \\begin{cases}\n\\frac{1}{2} r^2  \\text{if } |r| \\le \\delta \\\\\n\\delta |r| - \\frac{1}{2} \\delta^2  \\text{if } |r| > \\delta\n\\end{cases}\n$$\n导数 $\\rho'_{\\delta}(r)$ 通过对各部分求导得到：\n$$\n\\rho'_{\\delta}(r) = \\begin{cases}\n-\\delta  \\text{if } r  -\\delta \\\\\nr  \\text{if } -\\delta \\le r \\le \\delta \\\\\n\\delta  \\text{if } r > \\delta\n\\end{cases}\n$$\n这个导数是连续的，并且可以紧凑地写为 $\\rho'_{\\delta}(r) = \\text{median}(-\\delta, r, \\delta)$。\n\n### 步骤 2：一阶最优性条件\n\n要最小化的目标函数是 $J_{\\delta}(b) = \\sum_{i=1}^{7} \\rho_{\\delta}(r_i(b))$，其中 $r_i(b) = e_i - b$。Huber损失 $\\rho_{\\delta}$ 是一个凸函数。由于凸函数的和也是凸函数，所以 $J_{\\delta}(b)$ 也是凸的。一个凸且可微函数的最小值 $b^{\\star}$ 可以通过将其一阶导数设为零来找到（一阶最优性条件）。\n$$\n\\frac{dJ_{\\delta}}{db}(b) = \\sum_{i=1}^{7} \\frac{d}{db} \\rho_{\\delta}(e_i - b) = 0\n$$\n使用链式法则，$\\frac{d}{db}\\rho_{\\delta}(e_i - b) = \\rho'_{\\delta}(e_i - b) \\cdot (-1)$。该条件变为：\n$$\n\\sum_{i=1}^{7} \\left(-\\rho'_{\\delta}(e_i - b)\\right) = 0 \\implies \\sum_{i=1}^{7} \\rho'_{\\delta}(e_i - b) = 0\n$$\n我们需要针对给定的两个 $\\delta$ 值，求解这个关于 $b^{\\star}$ 的非线性方程。残差数据为 $e = \\{-4, -1, 0, 1, 2, 3, 8\\}$。\n\n### 步骤 3：对 $\\delta = 2\\,\\mathrm{mm\\,day^{-1}}$ 的计算\n\n对于 $\\delta=2$，最优性条件是：\n$$\n\\sum_{i=1}^{7} \\rho'_{2}(e_i - b) = \\sum_{i=1}^{7} \\text{median}(-2, e_i - b, 2) = 0\n$$\n我们寻找满足此方程的 $b$ 值。让我们测试一下中心数据点均值附近的整数 $b$ 值。考虑 $b^{\\star}=1$。调整后的残差 $r_i(1) = e_i - 1$ 是：\n$$\n\\{-4-1, -1-1, 0-1, 1-1, 2-1, 3-1, 8-1\\} = \\{-5, -2, -1, 0, 1, 2, 7\\}\n$$\n现在我们计算各项 $\\rho'_{2}(r_i(1))$：\n\\begin{itemize}\n    \\item $\\rho'_{2}(-5) = \\text{median}(-2, -5, 2) = -2$ (因为 $-5  -2$)\n    \\item $\\rho'_{2}(-2) = \\text{median}(-2, -2, 2) = -2$ (因为 $-2 \\le -2 \\le 2$)\n    \\item $\\rho'_{2}(-1) = \\text{median}(-2, -1, 2) = -1$ (因为 $-2 \\le -1 \\le 2$)\n    \\item $\\rho'_{2}(0) = \\text{median}(-2, 0, 2) = 0$ (因为 $-2 \\le 0 \\le 2$)\n    \\item $\\rho'_{2}(1) = \\text{median}(-2, 1, 2) = 1$ (因为 $-2 \\le 1 \\le 2$)\n    \\item $\\rho'_{2}(2) = \\text{median}(-2, 2, 2) = 2$ (因为 $-2 \\le 2 \\le 2$)\n    \\item $\\rho'_{2}(7) = \\text{median}(-2, 7, 2) = 2$ (因为 $7 > 2$)\n\\end{itemize}\n总和是 $\\sum_{i=1}^{7} \\rho'_{2}(e_i - 1) = -2 - 2 - 1 + 0 + 1 + 2 + 2 = 0$。\n条件得到满足，所以最优偏差是 $b^{\\star} = 1\\,\\mathrm{mm\\,day^{-1}}$。\n\n接下来，我们使用调整后的残差 $r_i = \\{-5, -2, -1, 0, 1, 2, 7\\}$ 来计算最小化的目标函数值 $J_{2}(b^{\\star})$。\n$$\n\\rho_{2}(r) = \\begin{cases}\n\\frac{1}{2} r^2  \\text{if } |r| \\le 2 \\\\\n2|r| - 2  \\text{if } |r| > 2\n\\end{cases}\n$$\n\\begin{itemize}\n    \\item $\\rho_{2}(-5) = 2|-5| - 2 = 10 - 2 = 8$\n    \\item $\\rho_{2}(-2) = \\frac{1}{2}(-2)^2 = 2$\n    \\item $\\rho_{2}(-1) = \\frac{1}{2}(-1)^2 = 0.5$\n    \\item $\\rho_{2}(0) = \\frac{1}{2}(0)^2 = 0$\n    \\item $\\rho_{2}(1) = \\frac{1}{2}(1)^2 = 0.5$\n    \\item $\\rho_{2}(2) = \\frac{1}{2}(2)^2 = 2$\n    \\item $\\rho_{2}(7) = 2|7| - 2 = 14 - 2 = 12$\n\\end{itemize}\n$J_{2}(b^{\\star}=1) = 8 + 2 + 0.5 + 0 + 0.5 + 2 + 12 = 25$。\n因此，$J_{2}(b^{\\star}) = 25\\,\\big(\\mathrm{mm\\,day^{-1}}\\big)^{2}$。\n\n### 步骤 4：对 $\\delta = 10\\,\\mathrm{mm\\,day^{-1}}$ 的计算\n\n对于 $\\delta=10$，最优性条件是 $\\sum_{i=1}^{7} \\rho'_{10}(e_i - b) = 0$。\n残差的均值是 $\\bar{e} = \\frac{1}{7}\\sum e_i = \\frac{-4-1+0+1+2+3+8}{7} = \\frac{9}{7}$。\n让我们检查一下如果使用这个均值作为偏差，是否所有残差都落在二次区域内（$|r_i| \\le \\delta$）。设 $b = 9/7$。与该偏差的最大偏差将出现在 $e_{min}=-4$ 或 $e_{max}=8$ 时。\n$e_{min} - b = -4 - \\frac{9}{7} = -\\frac{28}{7} - \\frac{9}{7} = -\\frac{37}{7} \\approx -5.29$。\n$e_{max} - b = 8 - \\frac{9}{7} = \\frac{56}{7} - \\frac{9}{7} = \\frac{47}{7} \\approx 6.71$。\n由于 $|-5.29|  10$ 且 $|6.71|  10$，所有调整后的残差 $|e_i - b|$ 都将小于 $\\delta=10$。\n因此，对于所有 $i$，我们都处于二次机制中，其中 $\\rho'_{10}(r) = r$。最优性条件简化为：\n$$\n\\sum_{i=1}^{7} (e_i - b) = 0\n$$\n这是标准的最小二乘问题，其解是残差的样本均值：\n$$\nb^{\\star} = \\frac{1}{7} \\sum_{i=1}^{7} e_i = \\frac{9}{7}\\,\\mathrm{mm\\,day^{-1}}\n$$\n接下来，我们计算最小化的目标函数 $J_{10}(b^{\\star})$。由于所有 $|r_i| \\le 10$，我们使用 $\\rho_{10}(r) = \\frac{1}{2}r^2$。\n$$\nJ_{10}(b^{\\star}) = \\sum_{i=1}^{7} \\frac{1}{2} (e_i - b^{\\star})^2 = \\frac{1}{2}\\sum_{i=1}^{7} (e_i - \\bar{e})^2\n$$\n残差平方和与样本方差有关。我们可以将其计算为 $\\sum e_i^2 - n(\\bar{e})^2$：\n$$\n\\sum_{i=1}^{7} e_i^2 = (-4)^2 + (-1)^2 + 0^2 + 1^2 + 2^2 + 3^2 + 8^2 = 16 + 1 + 0 + 1 + 4 + 9 + 64 = 95\n$$\n$$\nn(\\bar{e})^2 = 7 \\left(\\frac{9}{7}\\right)^2 = 7 \\frac{81}{49} = \\frac{81}{7}\n$$\n$$\n\\sum_{i=1}^{7} (e_i - \\bar{e})^2 = 95 - \\frac{81}{7} = \\frac{665 - 81}{7} = \\frac{584}{7}\n$$\n所以，目标函数值是：\n$$\nJ_{10}(b^{\\star}) = \\frac{1}{2} \\left(\\frac{584}{7}\\right) = \\frac{292}{7}\\,\\big(\\mathrm{mm\\,day^{-1}}\\big)^{2}\n$$\n\n### 步骤 5：最终数值\n\n问题要求将数值报告为四位有效数字。\n对于 $\\delta=2$：\n$b^{\\star} = 1.000\\,\\mathrm{mm\\,day^{-1}}$\n$J_{2}(b^{\\star}) = 25.00\\,\\big(\\mathrm{mm\\,day^{-1}}\\big)^{2}$\n\n对于 $\\delta=10$：\n$b^{\\star} = \\frac{9}{7} \\approx 1.285714...\\,\\mathrm{mm\\,day^{-1}}$，保留四位有效数字是 $1.286$。\n$J_{10}(b^{\\star}) = \\frac{292}{7} \\approx 41.714285...\\,\\big(\\mathrm{mm\\,day^{-1}}\\big)^{2}$，保留四位有效数字是 $41.71$。\n\n最终答案以一个行矩阵的形式呈现，按顺序包含这四个值。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.000  25.00  1.286  41.71 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在许多地球系统模型应用中，例如洪水预报，准确模拟平均状态和捕捉罕见的极端事件同样重要。然而，诸如RMSE之类的标准聚合指标，可能会因为极端事件的低概率而掩盖模型在这些关键时刻的糟糕表现，从而产生误导。本练习将引导您进行一个思想实验，证明这一潜在陷阱，并挑战您设计一个复合目标函数，该函数能明确地、可调地权衡模型在“常规”与“极端”两种情景下的性能。",
            "id": "3899989",
            "problem": "考虑一个环境水文模型，该模型预测第 $t$ 天的日径流量 $\\hat{Q}_t$，观测值为 $Q_t$。令预测误差为 $e_t = \\hat{Q}_t - Q_t$。定义均方根误差 (RMSE) 为 $\\mathrm{RMSE} = \\sqrt{\\mathbb{E}(e_t^2)}$，其中 $\\mathbb{E}(\\cdot)$ 表示对日分布的期望。假设我们对主体流量情景和高流量尾部情景都感兴趣。定义一个尾部指示符 $I_t = \\mathbf{1}\\{Q_t > T\\}$，其中 $T$ 是 $Q_t$ 的 $99.9\\%$ 经验分位数，因此尾部超标概率为 $p = \\mathbb{P}(I_t = 1) = 0.001$。考虑两个竞争模型 $\\mathcal{M}_1$ 和 $\\mathcal{M}_2$，其误差分布是条件高斯分布，均值为零，方差依赖于具体情景：\n- 主体情景 $(I_t = 0)$：在模型 $\\mathcal{M}_1$ 下，$e_t \\mid (I_t = 0) \\sim \\mathcal{N}(0, \\sigma_{b,1}^2)$，其中 $\\sigma_{b,1} = 0.5$；在模型 $\\mathcal{M}_2$ 下，$e_t \\mid (I_t = 0) \\sim \\mathcal{N}(0, \\sigma_{b,2}^2)$，其中 $\\sigma_{b,2} = 0.8$。\n- 尾部情景 $(I_t = 1)$：在模型 $\\mathcal{M}_1$ 下，$e_t \\mid (I_t = 1) \\sim \\mathcal{N}(0, \\sigma_{t,1}^2)$，其中 $\\sigma_{t,1} = 20$；在模型 $\\mathcal{M}_2$ 下，$e_t \\mid (I_t = 1) \\sim \\mathcal{N}(0, \\sigma_{t,2}^2)$，其中 $\\sigma_{t,2} = 5$。\n\n假设混合指示符 $(I_t)$ 和条件误差在时间 $t$ 上是独立同分布的，并且混合概率 $p$ 和条件方差是平稳的。\n\n您的任务是：\n1. 仅使用混合分布的期望基本定义和 RMSE 的定义，推导 $\\mathcal{M}_1$ 和 $\\mathcal{M}_2$ 的无条件 RMSE，以及两个模型的条件尾部 RMSE（仅限于 $I_t = 1$）。解释为何由于概率 $p$ 很小，无条件 RMSE 可能会偏好一个在尾部表现明显较差的模型。\n2. 对于一个带有参数 $\\theta$ 的通用模型，提出了一个数学上一致的复合目标函数 $J(\\theta)$，它明确地平衡了主体和尾部的拟合效果。该目标函数使用条件项来分离主体和尾部的性能，并包含一个可调权重，以反映决策者对极端事件的重视程度。该目标函数必须避免重复计算主体部分的贡献，并且在所述的混合结构下必须是良定义的。\n\n选择一个选项，该选项既正确地确定了 $\\mathcal{M}_1$ 与 $\\mathcal{M}_2$ 的 RMSE 和尾部 RMSE 的排序，又提出了一个满足任务2要求的有效复合目标函数。\n\nA. 无条件 RMSE 满足 $\\mathrm{RMSE}(\\mathcal{M}_1)  \\mathrm{RMSE}(\\mathcal{M}_2)$，而条件尾部 RMSE 满足 $\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_1) \\gg \\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_2)$。一个有效的复合目标函数是 $J(\\theta) = (1 - \\alpha)\\,\\mathrm{RMSE}_{\\mathrm{bulk}}(\\theta) + \\alpha\\,\\mathrm{RMSE}_{\\mathrm{tail}}(\\theta)$，其中 $\\mathrm{RMSE}_{\\mathrm{bulk}}(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 0)}$ 和 $\\mathrm{RMSE}_{\\mathrm{tail}}(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 1)}$，并且 $\\alpha \\in [0,1]$ 是用户选择的权重。\n\nB. 无条件 RMSE 满足 $\\mathrm{RMSE}(\\mathcal{M}_1) > \\mathrm{RMSE}(\\mathcal{M}_2)$。为了修正尾部问题，使用 $J(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2)} + \\alpha\\,\\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 1)}$，这在标准 RMSE 上增加了一个尾部惩罚项。\n\nC. 平方运算会放大罕见的极端值，因此可以保证 $\\mathrm{RMSE}(\\mathcal{M}_1) > \\mathrm{RMSE}(\\mathcal{M}_2)$。一个关注尾部的目标函数 $J(\\theta) = \\max_t |e_{\\theta,t}|$ 足以平衡主体和尾部的性能。\n\nD. 因为径流量是正值且偏态的，对数变换可以修正尾部拟合不足的问题；使用 $J(\\theta) = \\sqrt{\\mathbb{E}((\\log \\hat{Q}_\\theta - \\log Q)^2)}$ 代替 RMSE 来平衡主体和尾部性能，而无需单独的尾部项。",
            "solution": "用户希望对问题陈述进行严格验证，然后进行完整的推导并评估各个选项。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n-   模型预测：$\\hat{Q}_t$ (日径流量)\n-   观测值：$Q_t$\n-   预测误差：$e_t = \\hat{Q}_t - Q_t$\n-   均方根误差 (RMSE) 定义：$\\mathrm{RMSE} = \\sqrt{\\mathbb{E}(e_t^2)}$\n-   尾部指示符：$I_t = \\mathbf{1}\\{Q_t > T\\}$，其中 $T$ 是 $Q_t$ 的 $99.9\\%$ 经验分位数。\n-   尾部超标概率：$p = \\mathbb{P}(I_t = 1) = 0.001$。\n-   主体情景概率：$\\mathbb{P}(I_t = 0) = 1 - p = 0.999$。\n-   两个模型 $\\mathcal{M}_1$ 和 $\\mathcal{M}_2$，其误差为条件高斯分布，均值为零。\n-   模型 $\\mathcal{M}_1$：\n    -   主体情景 ($I_t = 0$)：$e_t \\mid (I_t = 0) \\sim \\mathcal{N}(0, \\sigma_{b,1}^2)$，其中 $\\sigma_{b,1} = 0.5$。\n    -   尾部情景 ($I_t = 1$)：$e_t \\mid (I_t = 1) \\sim \\mathcal{N}(0, \\sigma_{t,1}^2)$，其中 $\\sigma_{t,1} = 20$。\n-   模型 $\\mathcal{M}_2$：\n    -   主体情景 ($I_t = 0$)：$e_t \\mid (I_t = 0) \\sim \\mathcal{N}(0, \\sigma_{b,2}^2)$，其中 $\\sigma_{b,2} = 0.8$。\n    -   尾部情景 ($I_t = 1$)：$e_t \\mid (I_t = 1) \\sim \\mathcal{N}(0, \\sigma_{t,2}^2)$，其中 $\\sigma_{t,2} = 5$。\n-   假设：$I_t$ 和条件误差在时间 $t$ 上是独立同分布的；$p$ 和条件方差是平稳的。\n\n**第2步：使用提取的已知条件进行验证**\n\n问题陈述是一个定义明确的概率与统计练习，应用于环境模型评估这一常见且相关的领域。\n1.  **科学依据**：该问题基于标准的统计理论（混合模型、期望、方差、正态分布）及其在水文建模（环境科学的一个关键领域）中的应用。基于模型在不同流量情景（主体 vs. 尾部/极端）下的性能来评估模型的设定，是该领域中一个标准且关键的任务。所有概念都是真实的和主流的。\n2.  **良构性**：该问题是良构的。所有必要的参数（$p$ 值，两个模型和两种情景的 $\\sigma$ 值）都已提供，以执行所需的计算。任务陈述清晰，并为有效的复合目标函数规定了条件，从而可以进行结构化评估。RMSE 的计算存在唯一的数值答案。\n3.  **客观性**：语言正式、精确，没有任何主观或模棱两可的术语。\n4.  **无缺陷**：该问题没有违反任何无效性标准。它是完整的、一致的、现实的（作为一个简化的模型），并且需要对统计指标的属性进行实质性的推理。\n\n**第3步：结论与行动**\n\n此问题是**有效的**。将继续进行求解过程。\n\n### 推导与求解\n\n**任务1：RMSE计算与分析**\n\n无条件均方误差 (MSE) $\\mathbb{E}(e_t^2)$ 可以使用全期望定律，基于指示符 $I_t$ 定义的混合分布来计算。\n$$\n\\mathbb{E}(e_t^2) = \\mathbb{E}(e_t^2 \\mid I_t = 0) \\mathbb{P}(I_t = 0) + \\mathbb{E}(e_t^2 \\mid I_t = 1) \\mathbb{P}(I_t = 1)\n$$\n对于一个随机变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其二阶矩由 $\\mathbb{E}(X^2) = \\mathrm{Var}(X) + (\\mathbb{E}(X))^2$ 给出。在这个问题中，条件误差的均值为 $0$，所以 $\\mathbb{E}(e_t \\mid I_t) = 0$。因此，条件二阶矩等于条件方差：\n-   $\\mathbb{E}(e_t^2 \\mid I_t = 0) = \\sigma_b^2$ (主体情景)\n-   $\\mathbb{E}(e_t^2 \\mid I_t = 1) = \\sigma_t^2$ (尾部情景)\n\n因此，无条件 MSE 为：\n$$\n\\mathrm{MSE} = (1-p) \\sigma_b^2 + p \\sigma_t^2\n$$\nRMSE 是 MSE 的平方根。\n\n**对于模型 $\\mathcal{M}_1$：**\n-   已知：$\\sigma_{b,1} = 0.5$, $\\sigma_{t,1} = 20$, $p = 0.001$。\n-   $\\mathrm{MSE}(\\mathcal{M}_1) = (1 - 0.001) \\times (0.5)^2 + 0.001 \\times (20)^2$\n-   $\\mathrm{MSE}(\\mathcal{M}_1) = 0.999 \\times 0.25 + 0.001 \\times 400$\n-   $\\mathrm{MSE}(\\mathcal{M}_1) = 0.24975 + 0.4 = 0.64975$\n-   $\\mathrm{RMSE}(\\mathcal{M}_1) = \\sqrt{0.64975} \\approx 0.80607$\n\n**对于模型 $\\mathcal{M}_2$：**\n-   已知：$\\sigma_{b,2} = 0.8$, $\\sigma_{t,2} = 5$, $p = 0.001$。\n-   $\\mathrm{MSE}(\\mathcal{M}_2) = (1 - 0.001) \\times (0.8)^2 + 0.001 \\times (5)^2$\n-   $\\mathrm{MSE}(\\mathcal{M}_2) = 0.999 \\times 0.64 + 0.001 \\times 25$\n-   $\\mathrm{MSE}(\\mathcal{M}_2) = 0.63936 + 0.025 = 0.66436$\n-   $\\mathrm{RMSE}(\\mathcal{M}_2) = \\sqrt{0.66436} \\approx 0.81514$\n\n比较无条件 RMSE：$\\mathrm{RMSE}(\\mathcal{M}_1) \\approx 0.806  0.815 \\approx \\mathrm{RMSE}(\\mathcal{M}_2)$。因此，$\\mathrm{RMSE}(\\mathcal{M}_1)  \\mathrm{RMSE}(\\mathcal{M}_2)$。\n\n**条件尾部 RMSE：**\n条件尾部 RMSE 是仅针对尾部情景 ($I_t = 1$) 中的事件评估的 RMSE。\n$$\n\\mathrm{RMSE}_{\\mathrm{tail}} = \\sqrt{\\mathbb{E}(e_t^2 \\mid I_t = 1)}\n$$\n如前所述，$\\mathbb{E}(e_t^2 \\mid I_t = 1) = \\sigma_t^2$。因此，$\\mathrm{RMSE}_{\\mathrm{tail}} = \\sqrt{\\sigma_t^2} = \\sigma_t$。\n\n-   对于 $\\mathcal{M}_1$：$\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_1) = \\sigma_{t,1} = 20$。\n-   对于 $\\mathcal{M}_2$：$\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_2) = \\sigma_{t,2} = 5$。\n\n比较条件尾部 RMSE：$\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_1) = 20$ 且 $\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_2) = 5$。显然，$\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_1) > \\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_2)$。比率为 $4:1$，因此使用 $\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_1) \\gg \\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_2)$ 的表述是合理的。\n\n**对误导性无条件 RMSE 的解释：**\n无条件 RMSE 偏好模型 $\\mathcal{M}_1$，尽管它在高流量尾部情景中表现灾难性地差（误差标准差为 $20$，而 $\\mathcal{M}_2$ 为 $5$）。这是因为无条件 RMSE 是一个按概率加权的平均值。$\\mathcal{M}_1$ 表现出色的主体情景（$\\sigma_{b,1} = 0.5$ vs. $\\sigma_{b,2} = 0.8$）以 $0.999$ 的概率发生，而尾部情景以 $0.001$ 的概率发生。$\\mathcal{M}_1$ 在 $99.9\\%$ 的事件中的优越性能足以克服其在罕见的 $0.1\\%$ 事件中的极差性能，从而导致总体 RMSE 较低。对于尾部性能至关重要的应用（例如洪水预报），这凸显了仅依赖像 RMSE 这样的聚合指标的危险性。\n\n**任务2：提出复合目标函数**\n\n该任务要求一个数学上一致的目标函数 $J(\\theta)$，该函数：\n1.  明确地平衡主体和尾部的拟合。\n2.  使用条件项来分离主体和尾部的性能。\n3.  包含一个可调权重，以反映决策者的重视程度。\n4.  避免重复计算。\n\n构建这样一个目标函数的一个自然方法是为每个不相交的情景定义度量，并使用用户指定的权重将它们组合起来。条件 RMSE 非常适合此目的。令 $\\theta$ 代表一个通用模型的参数。\n-   主体性能度量：$\\mathrm{RMSE}_{\\mathrm{bulk}}(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 0)}$\n-   尾部性能度量：$\\mathrm{RMSE}_{\\mathrm{tail}}(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 1)}$\n\n一个复合目标函数可以是这两个度量的加权和。令 $\\alpha \\in [0,1]$ 为表示尾部性能相对重要性的可调权重。\n$$\nJ(\\theta) = (1 - \\alpha)\\,\\mathrm{RMSE}_{\\mathrm{bulk}}(\\theta) + \\alpha\\,\\mathrm{RMSE}_{\\mathrm{tail}}(\\theta)\n$$\n这种结构满足所有要求：\n1.  它通过权重 $\\alpha$ 平衡主体和尾部的拟合。如果 $\\alpha=0$，我们只考虑主体性能。如果 $\\alpha=1$，我们只考虑尾部性能。如果 $\\alpha=0.5$，我们给予它们同等的权重。\n2.  它使用条件 RMSE，根据定义，这些度量分离了两个情景中的性能。\n3.  $\\alpha$ 是一个可调权重。\n4.  由于事件 $I_t=0$ 和 $I_t=1$ 构成了事件空间的一个划分，度量 $\\mathrm{RMSE}_{\\mathrm{bulk}}$ 和 $\\mathrm{RMSE}_{\\mathrm{tail}}$ 是在不相交的数据集上计算的。将它们组合起来不构成重复计算。这是对两个分区重要性的重新加权，从“自然”权重（$p, 1-p$）变为用户定义的权重（$\\alpha, 1-\\alpha$）。\n\n### 逐项分析\n\n**A. 无条件 RMSE 满足 $\\mathrm{RMSE}(\\mathcal{M}_1)  \\mathrm{RMSE}(\\mathcal{M}_2)$，而条件尾部 RMSE 满足 $\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_1) \\gg \\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_2)$。一个有效的复合目标函数是 $J(\\theta) = (1 - \\alpha)\\,\\mathrm{RMSE}_{\\mathrm{bulk}}(\\theta) + \\alpha\\,\\mathrm{RMSE}_{\\mathrm{tail}}(\\theta)$，其中 $\\mathrm{RMSE}_{\\mathrm{bulk}}(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 0)}$ 和 $\\mathrm{RMSE}_{\\mathrm{tail}}(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 1)}$，并且 $\\alpha \\in [0,1]$ 是用户选择的权重。**\n\n-   陈述 $\\mathrm{RMSE}(\\mathcal{M}_1)  \\mathrm{RMSE}(\\mathcal{M}_2)$ 与我们的计算（$0.806  0.815$）一致。\n-   陈述 $\\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_1) \\gg \\mathrm{RMSE}_{\\mathrm{tail}}(\\mathcal{M}_2)$ 与我们的计算（$20 \\gg 5$）一致。\n-   所提出的目标函数 $J(\\theta)$ 正是上面推导出的有效形式，满足问题的所有标准。\n-   结论：**正确**\n\n**B. 无条件 RMSE 满足 $\\mathrm{RMSE}(\\mathcal{M}_1) > \\mathrm{RMSE}(\\mathcal{M}_2)$。为了修正尾部问题，使用 $J(\\theta) = \\sqrt{\\mathbb{E}(e_\\theta^2)} + \\alpha\\,\\sqrt{\\mathbb{E}(e_\\theta^2 \\mid I_t = 1)}$，这在标准 RMSE 上增加了一个尾部惩罚项。**\n\n-   陈述 $\\mathrm{RMSE}(\\mathcal{M}_1) > \\mathrm{RMSE}(\\mathcal{M}_2)$ 与我们的计算相矛盾。\n-   所提出的目标 $J(\\theta) = \\mathrm{RMSE}(\\theta) + \\alpha\\,\\mathrm{RMSE}_{\\mathrm{tail}}(\\theta)$ 没有分离主体和尾部性能，并且明确地重复计算了来自尾部事件的贡献。尾部误差是第一项 $\\mathrm{RMSE}(\\theta)$ 的一部分，然后在第二项中再次添加。这违反了问题对清晰分离和平衡的隐含要求。\n-   结论：**不正确**\n\n**C. 平方运算会放大罕见的极端值，因此可以保证 $\\mathrm{RMSE}(\\mathcal{M}_1) > \\mathrm{RMSE}(\\mathcal{M}_2)$。一个关注尾部的目标函数 $J(\\theta) = \\max_t |e_{\\theta,t}|$ 足以平衡主体和尾部的性能。**\n\n-   前提 $\\mathrm{RMSE}(\\mathcal{M}_1) > \\mathrm{RMSE}(\\mathcal{M}_2)$ 是错误的，如直接计算所示。虽然平方会放大大的误差，但它们对最终期望的贡献被它们发生的小概率所削弱。\n-   所提出的目标 $J(\\theta) = \\max_t |e_{\\theta,t}|$（$L_\\infty$ 误差）完全关注单个最差的预测，完全忽略了分布其余部分的性能。这是一个极端的目标，而不是一个按要求*平衡*主体和尾部性能的目标。\n-   结论：**不正确**\n\n**D. 因为径流量是正值且偏态的，对数变换可以修正尾部拟合不足的问题；使用 $J(\\theta) = \\sqrt{\\mathbb{E}((\\log \\hat{Q}_\\theta - \\log Q)^2)}$ 代替 RMSE 来平衡主体和尾部性能，而无需单独的尾部项。**\n\n-   虽然对数变换是水文学中的一种有效技术，但在这里它被提议作为显式、可调、复合目标的替代品。问题明确要求一个具有“分离主体和尾部性能的条件项和可调权重”的目标。这个提议，即对数均方根误差 (RMSLE)，是一个单一的、非复合的度量，并且没有任何可调权重来平衡显式的尾部与主体性能。它不满足任务2的要求。\n-   结论：**不正确**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}