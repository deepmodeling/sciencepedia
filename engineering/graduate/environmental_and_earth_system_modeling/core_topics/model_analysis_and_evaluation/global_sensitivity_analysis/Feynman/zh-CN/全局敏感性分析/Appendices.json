{
    "hands_on_practices": [
        {
            "introduction": "全局敏感性分析的真正威力在于其处理复杂非线性关系的能力，而简单的相关性方法在这些情况下可能会失效。本练习通过一个看似矛盾的场景，即一个参数具有高总效应Sobol指数（$S_{TX}$）但其偏秩相关系数（PRCC）却接近于零，来引出这一主题。通过为一个典型的非单调模型计算期望通量，您将能亲身体会为何基于方差的度量对于捕捉此类重要影响至关重要。",
            "id": "1436446",
            "problem": "一位系统生物学家正在分析一个代谢途径，其中的通量 $J$ 受一个外部信号分子浓度的控制，该浓度用参数 $X$ 表示。对该计算模型进行的一项全局敏感性分析得出了两个看似矛盾的结果：$X$ 的总效应 Sobol 指数很高（$S_{TX} \\approx 0.75$），而 $X$ 和 $J$ 之间的偏秩相关系数 (PRCC) 接近于零（$\\rho_{XJ} \\approx 0.01$）。\n\n这表明 $X$ 强烈影响通量 $J$，但不是以单调的方式。该生物学家假设了一个模型，其中关系是钟形的，代表了途径激活的最优浓度，并在较低和较高浓度下具有抑制效应。将通量 $J$ 与调节剂浓度 $X$ 联系起来的函数形式如下：\n$$J(X) = \\frac{J_{max}}{1 + \\left(\\frac{X - X_{opt}}{W}\\right)^2}$$\n此处，$J_{max}$ 是最大可能通量，$X_{opt}$ 是调节剂的最优浓度，而 $W$ 是一个决定峰宽的参数。这三个（$J_{max}$、$X_{opt}$、$W$）都是正常数。\n\n为进一步研究此模型的性质，请计算通量的期望值（均值）$E[J]$，假设调节剂浓度 $X$ 是一个从区间 $[X_{opt} - W, X_{opt} + W]$ 上的均匀分布中抽样得到的随机变量。将您的答案用 $J_{max}$ 和 $\\pi$ 表示为一个符号表达式。",
            "solution": "给定 $J(X) = \\dfrac{J_{max}}{1 + \\left(\\dfrac{X - X_{opt}}{W}\\right)^{2}}$ 且 $X \\sim \\text{Uniform}[X_{opt} - W, X_{opt} + W]$。$X$ 在此区间上的概率密度函数为 $f_{X}(x) = \\dfrac{1}{2W}$，在其他地方为零。期望值为\n$$\nE[J] = \\int_{X_{opt} - W}^{X_{opt} + W} J(x) f_{X}(x)\\,dx = \\frac{1}{2W} \\int_{X_{opt} - W}^{X_{opt} + W} \\frac{J_{max}}{1 + \\left(\\frac{x - X_{opt}}{W}\\right)^{2}}\\,dx.\n$$\n进行变量代换 $y = \\dfrac{x - X_{opt}}{W}$，因此 $dx = W\\,dy$，积分上下限变为 $y = -1$ 到 $y = 1$。则\n$$\nE[J] = \\frac{J_{max}}{2W} \\int_{X_{opt} - W}^{X_{opt} + W} \\frac{dx}{1 + \\left(\\frac{x - X_{opt}}{W}\\right)^{2}}\n= \\frac{J_{max}}{2W} \\int_{-1}^{1} \\frac{W\\,dy}{1 + y^{2}}\n= \\frac{J_{max}}{2} \\int_{-1}^{1} \\frac{dy}{1 + y^{2}}.\n$$\n使用 $\\int \\dfrac{dy}{1 + y^{2}} = \\arctan(y)$，计算\n$$\n\\int_{-1}^{1} \\frac{dy}{1 + y^{2}} = \\arctan(1) - \\arctan(-1) = \\frac{\\pi}{4} - \\left(-\\frac{\\pi}{4}\\right) = \\frac{\\pi}{2}.\n$$\n因此，\n$$\nE[J] = \\frac{J_{max}}{2} \\cdot \\frac{\\pi}{2} = \\frac{\\pi J_{max}}{4}.\n$$\n由于对称性和缩放，该均值与 $X_{opt}$ 和 $W$ 无关。",
            "answer": "$$\\boxed{\\frac{\\pi J_{max}}{4}}$$"
        },
        {
            "introduction": "在理解了为何需要全局敏感性分析之后，本练习将带您深入探究最核心的方差分解技术——Sobol指数的计算。这个问题提供了一个基础的乘法模型，其中输入之间存在交互效应，即一个输入的影响力取决于另一个输入的水平。通过解析计算一阶和总效应Sobol指数，您将直接看到模型输出总方差是如何被精确地分解为各输入的主效应和交互效应的。",
            "id": "4348293",
            "problem": "在一个简化的系统生物医学模型中，某表型由两个独立的通路活性调控，假设其输出被建模为乘积响应 $Y = X_{1} X_{2}$，其中 $X_{1}$ 和 $X_{2}$ 是独立同分布的，服从 $\\mathrm{Unif}(0,1)$ 分布。使用基于方差的全局敏感性分析对独立输入的基本原理定义，计算该模型的一阶 Sobol 指数 $S_{1}$ 和 $S_{2}$ 以及总效应 Sobol 指数 $T_{1}$ 和 $T_{2}$。然后，根据你的方差分解，说明由 $X_{1}$ 和 $X_{2}$ 之间的交互作用引起的方差是否超过任一主效应引起的方差。以精确值（无四舍五入）报告 $S_{1}$、$S_{2}$、$T_{1}$ 和 $T_{2}$，并按 $S_{1}$、$S_{2}$、$T_{1}$、$T_{2}$ 的顺序将最终答案表示为行向量。无需单位。",
            "solution": "我们从基于方差的全局敏感性分析对独立输入的基本定义出发，该定义源自 Hoeffding–Sobol 方差分析 (ANOVA) 分解。对于一个具有独立输入的平方可积模型输出 $Y=f(X_{1},X_{2})$，其方差正交分解为\n$$\n\\operatorname{Var}(Y) = V_{1} + V_{2} + V_{12},\n$$\n其中 $V_{i} = \\operatorname{Var}(\\mathbb{E}[Y \\mid X_{i}])$ 是一阶方差分量，$V_{12}$ 是二阶（交互作用）方差分量。一阶 Sobol 指数定义为\n$$\nS_{i} = \\frac{V_{i}}{\\operatorname{Var}(Y)},\n$$\n总效应指数定义为\n$$\nT_{i} = \\frac{\\mathbb{E}\\!\\left[\\operatorname{Var}(Y \\mid X_{-i})\\right]}{\\operatorname{Var}(Y)} = 1 - \\frac{\\operatorname{Var}(\\mathbb{E}[Y \\mid X_{-i}])}{\\operatorname{Var}(Y)},\n$$\n其中 $X_{-i}$ 表示除 $X_{i}$ 之外的所有输入。对于两个输入，$T_{1} = S_{1} + S_{12}$ 和 $T_{2} = S_{2} + S_{12}$，其中 $S_{12} = V_{12}/\\operatorname{Var}(Y)$。\n\n对于给定的模型 $Y = X_{1} X_{2}$，其中 $X_{1}, X_{2} \\stackrel{\\text{i.i.d.}}{\\sim} \\mathrm{Unif}(0,1)$ 且独立，计算所需的期望和方差。\n\n首先，计算 $\\mathbb{E}[Y]$ 和 $\\operatorname{Var}(Y)$：\n- 由于 $X_{1}$ 和 $X_{2}$ 独立同分布且 $\\mathbb{E}[X_{i}] = \\frac{1}{2}$，我们有\n$$\n\\mathbb{E}[Y] = \\mathbb{E}[X_{1} X_{2}] = \\mathbb{E}[X_{1}] \\, \\mathbb{E}[X_{2}] = \\frac{1}{4}.\n$$\n- 此外，$\\mathbb{E}[X_{i}^{2}] = \\frac{1}{3}$，因此\n$$\n\\mathbb{E}[Y^{2}] = \\mathbb{E}[X_{1}^{2} X_{2}^{2}] = \\mathbb{E}[X_{1}^{2}] \\, \\mathbb{E}[X_{2}^{2}] = \\frac{1}{9}.\n$$\n所以，\n$$\n\\operatorname{Var}(Y) = \\mathbb{E}[Y^{2}] - \\left(\\mathbb{E}[Y]\\right)^{2} = \\frac{1}{9} - \\left(\\frac{1}{4}\\right)^{2} = \\frac{1}{9} - \\frac{1}{16} = \\frac{16 - 9}{144} = \\frac{7}{144}.\n$$\n\n接下来，计算一阶方差分量 $V_{1}$ 和 $V_{2}$：\n- 计算条件期望\n$$\n\\mathbb{E}[Y \\mid X_{1}] = \\mathbb{E}[X_{1} X_{2} \\mid X_{1}] = X_{1} \\, \\mathbb{E}[X_{2}] = \\frac{X_{1}}{2}.\n$$\n因此\n$$\nV_{1} = \\operatorname{Var}(\\mathbb{E}[Y \\mid X_{1}]) = \\operatorname{Var}\\!\\left(\\frac{X_{1}}{2}\\right) = \\frac{1}{4} \\operatorname{Var}(X_{1}) = \\frac{1}{4} \\cdot \\frac{1}{12} = \\frac{1}{48}.\n$$\n根据对称性，$V_{2} = \\frac{1}{48}$。\n\n因此，一阶 Sobol 指数为\n$$\nS_{1} = \\frac{V_{1}}{\\operatorname{Var}(Y)} = \\frac{\\frac{1}{48}}{\\frac{7}{144}} = \\frac{1}{48} \\cdot \\frac{144}{7} = \\frac{3}{7},\n\\qquad\nS_{2} = \\frac{V_{2}}{\\operatorname{Var}(Y)} = \\frac{3}{7}.\n$$\n\n现在计算总效应指数。我们使用两种等价的途径来验证一致性。\n\n途径1（利用补集主效应的补）：\n- 由于 $\\mathbb{E}[Y \\mid X_{2}] = \\frac{X_{2}}{2}$，我们有\n$$\n\\operatorname{Var}(\\mathbb{E}[Y \\mid X_{2}]) = \\operatorname{Var}\\!\\left(\\frac{X_{2}}{2}\\right) = \\frac{1}{48}.\n$$\n从而\n$$\nT_{1} = 1 - \\frac{\\operatorname{Var}(\\mathbb{E}[Y \\mid X_{2}])}{\\operatorname{Var}(Y)} = 1 - \\frac{\\frac{1}{48}}{\\frac{7}{144}} = 1 - \\frac{3}{7} = \\frac{4}{7}.\n$$\n根据对称性，\n$$\nT_{2} = \\frac{4}{7}.\n$$\n\n途径2（条件方差的期望）：\n- 计算\n$$\n\\operatorname{Var}(Y \\mid X_{1}) = \\operatorname{Var}(X_{1} X_{2} \\mid X_{1}) = X_{1}^{2} \\operatorname{Var}(X_{2}) = X_{1}^{2} \\cdot \\frac{1}{12}.\n$$\n因此\n$$\n\\mathbb{E}[\\operatorname{Var}(Y \\mid X_{1})] = \\frac{1}{12} \\mathbb{E}[X_{1}^{2}] = \\frac{1}{12} \\cdot \\frac{1}{3} = \\frac{1}{36}.\n$$\n所以\n$$\nT_{2} = \\frac{\\mathbb{E}[\\operatorname{Var}(Y \\mid X_{1})]}{\\operatorname{Var}(Y)} = \\frac{\\frac{1}{36}}{\\frac{7}{144}} = \\frac{1}{36} \\cdot \\frac{144}{7} = \\frac{4}{7}.\n$$\n根据对称性，$T_1 = T_2 = 4/7$，与前一种途径一致。\n\n交互作用评估。交互作用方差占比为\n$$\nS_{12} = 1 - S_{1} - S_{2} = 1 - \\frac{3}{7} - \\frac{3}{7} = \\frac{1}{7}.\n$$\n因此，在该模型中，交互作用的贡献 $\\frac{1}{7}$ 不超过任一主效应的贡献 $\\frac{3}{7}$。每个主效应都主导交互作用，但交互作用本身不可忽略，这体现在每个输入的 $T_{i}$ 和 $S_{i}$ 之间存在 $\\frac{1}{7}$ 的差距。\n\n按 $S_{1}$、$S_{2}$、$T_{1}$、$T_{2}$ 的顺序收集所求指数，可得精确值为\n$$\n\\left(\\frac{3}{7}, \\frac{3}{7}, \\frac{4}{7}, \\frac{4}{7}\\right).\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{3}{7}  \\frac{3}{7}  \\frac{4}{7}  \\frac{4}{7}\\end{pmatrix}}$$"
        },
        {
            "introduction": "从解析理论转向实际应用，最后一个练习解决了一个任何真实世界建模任务都必须面对的关键问题：计算成本。对于无法解析求解的复杂模型，估算Sobol指数依赖于特定的蒙特卡洛采样方案，例如Saltelli方法。本练习要求您推导执行此方案所需的模型总运行次数，从而将敏感性分析的理论概念与计算预算的实际约束直接联系起来。",
            "id": "3883337",
            "problem": "考虑一个确定性环境模型，表示为 $Y = f(\\mathbf{X})$，其中 $\\mathbf{X} = (X_1, X_2, \\ldots, X_d)$ 是一个 $d$ 维独立输入因子向量，每个 $X_j$ 的支持区间为单位区间，$Y$ 是一个标量响应。基于方差的全局敏感性分析将输出方差分解，以归因于单个输入及其交互作用的贡献。因子 $X_j$ 的一阶 Sobol 指数定义为 $S_j = \\operatorname{Var}\\left(\\mathbb{E}[Y \\mid X_j]\\right) / \\operatorname{Var}(Y)$，而 $X_j$ 的总效应 Sobol 指数定义为 $T_j = 1 - \\operatorname{Var}\\left(\\mathbb{E}[Y \\mid \\mathbf{X}_{-j}]\\right) / \\operatorname{Var}(Y)$，其中 $\\mathbf{X}_{-j}$ 表示除 $X_j$ 之外的所有输入。这些定义源于在 $Y$ 独立且平方可积的假设下的方差分析 (ANOVA) 分解。\n\nSaltelli 提出的一种实用的蒙特卡洛或准蒙特卡洛 (QMC) 估计方案需要两个大小为 $N \\times d$ 的独立基础样本矩阵，记为 $A$ 和 $B$，通过在 $[0,1]$ 内独立抽样每一列来构建。对于每个输入因子 $j \\in \\{1, \\ldots, d\\}$，通过将 $A$ 的第 $j$ 列替换为 $B$ 的第 $j$ 列来构建一个混合矩阵 $A^{(j)}_B$。然后，对 $A$、$B$ 和每个 $A^{(j)}_B$ 的行进行模型评估，以同时提供所有一阶和总效应 Sobol 指数的一致估计量。\n\n任务：\n1. 仅从上述基于方差的定义和输入独立性出发，设计基于矩阵 $A$、$B$ 和 $A^{(j)}_B$ 的抽样计划，以实现对所有一阶和总效应 Sobol 指数的联合估计。清晰地说明对于给定的 $N$ 和 $d$ 需要构建的所有矩阵的数量和大小。\n2. 推导此计划所需的模型总运行次数，作为 $N$ 和 $d$ 的函数，确保该论证在模型和抽样假设下有效。仔细处理边界情况 $d = 0$，并提供逻辑上一致的计数。\n3. 实现一个程序，对于给定的输入对 $(N, d)$，返回你所推导的 Saltelli 方案所需的模型总运行次数。\n\n使用以下输入对 $(N, d)$ 的测试套件：\n- 情况 1：$N = 512$，$d = 6$。\n- 情况 2：$N = 1$，$d = 3$。\n- 情况 3：$N = 50$，$d = 0$。\n- 情况 4：$N = 137$，$d = 7$。\n- 情况 5：$N = 10000$，$d = 2$。\n- 情况 6：$N = 256$，$d = 1$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,\\ldots,r_6]$），其中每个 $r_i$ 是对应测试用例所需的模型总运行次数的整数。",
            "solution": "该问题要求分析 Saltelli 抽样方案用于全局敏感性分析的计算成本。模型评估的总次数由该过程中使用的样本矩阵的结构和维度决定。推导过程分三步进行：首先，形式化所描述的抽样计划；其次，推导模型运行次数作为基础样本大小 $N$ 和输入维度数 $d$ 的通用公式；第三，验证该公式对于 $d=0$ 的边界情况。\n\n用于估计所有一阶 $S_j$ 和总效应 $T_j$ Sobol 指数的抽样计划是使用三种类型的矩阵构建的。模型 $Y=f(\\mathbf{X})$ 必须对这些矩阵的每一行进行评估。\n\n1. **基础样本矩阵**：该计划始于两个独立的样本矩阵 $A$ 和 $B$。两者的大小均为 $N \\times d$，其中 $N$ 是基础样本大小，$d$ 是输入因子的数量。每个矩阵都是通过从输入因子的独立分布（例如，在 $[0,1]$ 上的均匀分布）中抽样 $N \\times d$ 个点生成的。\n- 矩阵 $A$ 有 $N$ 行。对 $A$ 的每一行评估模型需要 $N$ 次模型运行。\n- 矩阵 $B$ 也有 $N$ 行。对 $B$ 的每一行评估模型需要额外的 $N$ 次模型运行。\n\n2. **混合样本矩阵**：对于每个输入因子 $X_j$（其中 $j \\in \\{1, 2, \\ldots, d\\}$），构建一个“混合”矩阵 $A^{(j)}_B$。该矩阵与矩阵 $A$ 相同，只是其第 $j$ 列被替换为矩阵 $B$ 的第 $j$ 列。\n- 有 $d$ 个输入因子，因此构建 $d$ 个这样的矩阵：$A^{(1)}_B, A^{(2)}_B, \\ldots, A^{(d)}_B$。\n- 每个矩阵 $A^{(j)}_B$ 的大小为 $N \\times d$，因此有 $N$ 行。\n- 对所有这 $d$ 个矩阵的行评估模型需要 $d \\times N$ 次模型运行。\n\n模型总运行次数是为这些矩阵中的每一个所需的运行次数之和。假设所有构建矩阵的行都是唯一的（对于连续抽样分布，这以概率 $1$ 成立），所需的评估中没有重叠。\n\n总运行次数，我们记为 $N_{total}$，是矩阵 $A$、矩阵 $B$ 和 $d$ 个混合矩阵 $A^{(j)}_B$ 的运行次数之和。\n$$N_{total} = (A \\text{ 的运行次数}) + (B \\text{ 的运行次数}) + (\\text{所有 } A^{(j)}_B \\text{ 的运行次数})$$\n$$N_{total} = N + N + \\sum_{j=1}^{d} N$$\n$$N_{total} = 2N + dN$$\n$$N_{total} = N(d+2)$$\n此公式给出了当 $d \\geq 1$ 时模型执行的总次数。\n\n问题要求特别考虑 $d=0$ 的边界情况。在这种情况下，模型 $Y=f()$ 没有输入因子。让我们以算法方式应用所描述的抽样计划：\n- 基础矩阵 $A$ 和 $B$ 的大小为 $N \\times d$，即变为 $N \\times 0$。每个矩阵包含 $N$ 行，其中每一行都是一个空向量，代表零维输入空间中的一个点。对矩阵 $A$ 评估模型需要 $N$ 次运行，对矩阵 $B$ 需要另外 $N$ 次运行。\n- 混合矩阵 $A^{(j)}_B$ 的构建是为每个输入因子 $j \\in \\{1, \\ldots, d\\}$ 指定的。当 $d=0$ 时，这个索引集为空。因此，不构建任何混合矩阵。\n- 因此，对于 $d=0$ 的总运行次数是 $A$ 和 $B$ 的运行次数之和，即 $N + N = 2N$。\n\n必须检查我们的通用公式 $N_{total} = N(d+2)$ 是否与此结果一致。将 $d=0$ 代入公式中得出：\n$$N_{total} = N(0+2) = 2N$$\n该公式对于边界情况 $d=0$ 成立，为所有非负整数 $d$ 值提供了一个逻辑上一致的表达式。\n\n因此，对于给定的基础样本大小 $N$ 和输入因子数 $d$，Saltelli 方案所需的模型评估总次数为 $N(d+2)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the total number of model runs required by Saltelli's sampling\n    scheme for global sensitivity analysis based on a series of (N, d) pairs.\n    \"\"\"\n    \n    # Define the test cases from the problem statement as pairs of (N, d).\n    # N is the base sample size, d is the number of input dimensions.\n    test_cases = [\n        (512, 6),    # Case 1\n        (1, 3),      # Case 2\n        (50, 0),     # Case 3\n        (137, 7),    # Case 4\n        (10000, 2),  # Case 5\n        (256, 1),    # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        N, d = case\n        \n        # The Saltelli sampling scheme requires N evaluations for a base matrix A,\n        # N evaluations for a second base matrix B, and N evaluations for each\n        # of the d mixed matrices A_B^(j).\n        # Total model runs = N (for A) + N (for B) + d * N (for d mixed matrices)\n        # This simplifies to the formula N * (d + 2).\n        # This formula is also valid for the boundary case d=0, where it\n        # correctly yields 2*N (as no mixed matrices are generated).\n        total_runs = N * (d + 2)\n        results.append(total_runs)\n\n    # Final print statement in the exact required format: [r_1,r_2,...,r_6]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}