{
    "hands_on_practices": [
        {
            "introduction": "This first practice connects fundamental hydraulic parameters to the core behavior of different routing models. By calculating the Froude number, $Fr$, we can determine the flow regime and understand how this dictates the direction information can travel in the full dynamic wave model versus its simplified kinematic wave counterpart . This exercise highlights the crucial assumptions that differentiate these models and their suitability for various applications, such as modeling backwater effects.",
            "id": "3902848",
            "problem": "A straight prismatic open channel of rectangular cross-section conveys unsteady flow that is modeled by the one-dimensional shallow-water equations known as the Saint-Venant equations. The channel has width $b = 30\\,\\mathrm{m}$ and bed slope $S_{0} = 0.0015$. The bed roughness is characterized by Manning’s coefficient $n = 0.035$. At a particular cross-section, a measurement campaign yields cross-sectional area $A = 120\\,\\mathrm{m^{2}}$ and discharge $Q = 336\\,\\mathrm{m^{3}\\,s^{-1}}$. Take gravitational acceleration $g = 9.81\\,\\mathrm{m\\,s^{-2}}$.\n\nStarting from the mass and momentum balances for shallow free-surface flow and the hydrostatic pressure assumption that underlies the Saint-Venant equations, determine the mean velocity $U$ and the Froude number $\\mathrm{Fr}$ for the measured state. Then, using the characteristic structure of the Saint-Venant equations and the kinematic-wave approximation derived from a discharge–area rating, deduce the implications of your computed $\\mathrm{Fr}$ for long-wave celerity and for the direction of information propagation in routing models that use (i) the kinematic wave and (ii) the full dynamic wave formulations.\n\nReport $U$ in $\\mathrm{m\\,s^{-1}}$ and $\\mathrm{Fr}$ as dimensionless. Round both to four significant figures.",
            "solution": "The problem is validated as follows.\n\n### Step 1: Extract Givens\n-   Channel type: Straight prismatic open channel of rectangular cross-section.\n-   Channel width: $b = 30\\,\\mathrm{m}$.\n-   Bed slope: $S_{0} = 0.0015$.\n-   Manning’s coefficient: $n = 0.035$.\n-   Cross-sectional area: $A = 120\\,\\mathrm{m^{2}}$.\n-   Discharge: $Q = 336\\,\\mathrm{m^{3}\\,s^{-1}}$.\n-   Gravitational acceleration: $g = 9.81\\,\\mathrm{m\\,s^{-2}}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It is based on the well-established Saint-Venant equations for one-dimensional open-channel flow, a cornerstone of environmental and earth system modeling. All terms are standard in fluid dynamics and hydrology. The data provided are self-contained and consistent, allowing for the direct calculation of the requested quantities and a meaningful physical interpretation. The problem does not violate any fundamental principles, is not based on false premises, and contains no ambiguities.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution\n\nThe mean velocity $U$ is defined as the total discharge $Q$ passing through a cross-section divided by the cross-sectional area $A$.\n$$\nU = \\frac{Q}{A}\n$$\nSubstituting the given values:\n$$\nU = \\frac{336\\,\\mathrm{m^{3}\\,s^{-1}}}{120\\,\\mathrm{m^{2}}} = 2.8\\,\\mathrm{m\\,s^{-1}}\n$$\n\nFor a rectangular channel of width $b$, the cross-sectional area $A$ is related to the flow depth $y$ by $A = by$. We can therefore calculate the flow depth:\n$$\ny = \\frac{A}{b} = \\frac{120\\,\\mathrm{m^{2}}}{30\\,\\mathrm{m}} = 4.0\\,\\mathrm{m}\n$$\n\nThe Froude number, $\\mathrm{Fr}$, is a dimensionless parameter that characterizes the flow regime. For a rectangular channel, it is the ratio of the mean velocity $U$ to the celerity of a small gravity wave, $\\sqrt{gy}$.\n$$\n\\mathrm{Fr} = \\frac{U}{\\sqrt{gy}}\n$$\nSubstituting the calculated values of $U$ and $y$, and the given value of $g$:\n$$\n\\mathrm{Fr} = \\frac{2.8\\,\\mathrm{m\\,s^{-1}}}{\\sqrt{(9.81\\,\\mathrm{m\\,s^{-2}})(4.0\\,\\mathrm{m})}} = \\frac{2.8}{\\sqrt{39.24}} \\approx 0.44699\n$$\nRounding to four significant figures, we have $U = 2.800\\,\\mathrm{m\\,s^{-1}}$ and $\\mathrm{Fr} = 0.4470$.\n\nSince $\\mathrm{Fr}  1$, the flow is classified as subcritical. We now analyze the implications for information propagation in routing models.\n\nThe one-dimensional Saint-Venant equations for unsteady flow in an open channel are a system of two partial differential equations representing the conservation of mass and momentum:\n$$\n\\frac{\\partial A}{\\partial t} + \\frac{\\partial Q}{\\partial x} = 0 \\quad \\text{(Continuity)}\n$$\n$$\n\\frac{\\partial Q}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\beta \\frac{Q^2}{A}\\right) + gA\\frac{\\partial y}{\\partial x} = gA(S_0 - S_f) \\quad \\text{(Momentum)}\n$$\nwhere $x$ is the longitudinal coordinate, $t$ is time, $S_f$ is the friction slope, and $\\beta$ is the momentum correction factor (assumed to be $1$).\n\n**i) Implications for the Full Dynamic Wave Formulation**\n\nThe Saint-Venant equations form a hyperbolic system. Information in such systems propagates along characteristic curves in the $x$-$t$ plane. The speeds of propagation, or celerities, are given by the eigenvalues of the system's Jacobian matrix. For the Saint-Venant equations, these characteristic celerities are:\n$$\nc = U \\pm \\sqrt{g\\frac{A}{T}}\n$$\nwhere $T$ is the top width of the channel. For a rectangular channel, $T = b$, so the term $\\sqrt{gA/T}$ simplifies to $\\sqrt{gy}$, which is the celerity of a shallow water gravity wave. Thus, the two characteristic speeds are:\n$$\nc = U \\pm \\sqrt{gy}\n$$\nThe Froude number is $\\mathrm{Fr} = U / \\sqrt{gy}$.\nOur calculation yielded $\\mathrm{Fr} \\approx 0.4470  1$, which corresponds to subcritical flow. In this regime, the mean velocity $U$ is less than the gravity wave celerity $\\sqrt{gy}$.\nThe two characteristic speeds are:\n1.  $c_1 = U + \\sqrt{gy}  0$: This represents a wave propagating in the downstream direction.\n2.  $c_2 = U - \\sqrt{gy}  0$: Since $U  \\sqrt{gy}$, this represents a wave propagating in the upstream direction.\n\nTherefore, for the full dynamic wave model, the subcritical nature of the flow ($\\mathrm{Fr}  1$) implies that information (e.g., the effect of a change in water level) propagates in **both the upstream and downstream directions**. This is crucial for modeling phenomena such as backwater effects from downstream controls (e.g., dams, weirs, or tidal influences), where the downstream conditions affect the flow profile upstream.\n\n**ii) Implications for the Kinematic Wave Formulation**\n\nThe kinematic wave model is a simplification of the Saint-Venant equations where the momentum equation is reduced by neglecting the local acceleration, convective acceleration, and pressure terms. This leaves a balance between the friction slope and the bed slope, $S_f = S_0$. This assumption implies a unique, single-valued relationship between discharge and flow area (or depth), $Q=Q(A)$, known as the rating curve. For instance, using the Manning equation:\n$$\nQ = \\frac{1}{n} A R_h^{2/3} S_0^{1/2}\n$$\nwhere $R_h$ is the hydraulic radius.\n\nThe kinematic wave model consists of the continuity equation combined with this rating curve:\n$$\n\\frac{\\partial A}{\\partial t} + \\frac{\\partial Q(A)}{\\partial x} = 0\n$$\nUsing the chain rule, $\\frac{\\partial Q}{\\partial x} = \\frac{dQ}{dA} \\frac{\\partial A}{\\partial x}$, we get:\n$$\n\\frac{\\partial A}{\\partial t} + \\frac{dQ}{dA} \\frac{\\partial A}{\\partial x} = 0\n$$\nThis is a first-order wave equation describing the evolution of $A$. It has only one characteristic celerity, the kinematic wave celerity $c_k$:\n$$\nc_k = \\frac{dQ}{dA}\n$$\nSince both $Q$ and $A$ are positive for downstream flow, their relationship is monotonic, and thus the derivative $c_k = dQ/dA$ is always positive. This means that a kinematic wave can **only propagate in the downstream direction**.\n\nThe implication of our computed Froude number being less than $1$ is profound here. While the true physical system (described by the dynamic wave model) supports bidirectional information flow, the kinematic wave approximation inherently forbids any upstream propagation. Regardless of whether the flow is subcritical ($\\mathrm{Fr}  1$) or supercritical ($\\mathrm{Fr}  1$), the kinematic model always routes disturbances downstream. This makes the kinematic wave model unsuitable for the present case if capturing the influence of any downstream control is necessary, as it cannot represent the upstream-propagating characteristic $c_2 = U - \\sqrt{gy}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.800  0.4470 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A numerical model is only as reliable as its adherence to fundamental physical laws, with mass conservation being paramount. This practical coding exercise guides you through building a diagnostic tool to check for mass balance errors, a critical skill for any computational modeler . By simulating common sources of error, such as inconsistencies in time-stepping or boundary condition reporting, you will gain firsthand experience in how numerical implementation choices can impact a model's physical integrity.",
            "id": "3902839",
            "problem": "You are asked to design and implement a diagnostic for cumulative mass balance error in a one-dimensional open-channel routing simulation governed by the Saint-Venant equations. The focus is on the integrated continuity relation over a control volume representing a prismatic reach and on how discretization of source terms and boundary conditions affects mass conservation.\n\nStarting from first principles, consider the Saint-Venant continuity equation for one-dimensional open-channel flow,\n$$\n\\frac{\\partial A(x,t)}{\\partial t} + \\frac{\\partial Q(x,t)}{\\partial x} = q_\\ell(x,t),\n$$\nwhere $A(x,t)$ is the wetted cross-sectional area (in $\\mathrm{m^2}$), $Q(x,t)$ is the discharge (in $\\mathrm{m^3\\,s^{-1}}$), and $q_\\ell(x,t)$ is the lateral inflow per unit length (in $\\mathrm{m^2\\,s^{-1}}$). Integrate over a fixed control volume spanning $x \\in [0,L]$ to obtain the global continuity (volume balance) relation,\n$$\n\\frac{\\mathrm{d}V(t)}{\\mathrm{d}t} = Q_{\\mathrm{in}}(t) - Q_{\\mathrm{out}}(t) + Q_{\\ell,\\mathrm{tot}}(t),\n$$\nwhere $V(t)=\\int_0^L A(x,t)\\,\\mathrm{d}x$ is the control volume storage (in $\\mathrm{m^3}$), $Q_{\\mathrm{in}}(t)=Q(0,t)$ is the upstream discharge (in $\\mathrm{m^3\\,s^{-1}}$), $Q_{\\mathrm{out}}(t)=Q(L,t)$ is the downstream discharge (in $\\mathrm{m^3\\,s^{-1}}$), and $Q_{\\ell,\\mathrm{tot}}(t)=\\int_0^L q_\\ell(x,t)\\,\\mathrm{d}x$ is the total lateral inflow to the reach (in $\\mathrm{m^3\\,s^{-1}}$).\n\nDefine the cumulative volume discrepancy up to time $t_N$ as\n$$\n\\mathcal{E}(t_N) = V(t_N) - V(t_0) - \\int_{t_0}^{t_N}\\big(Q_{\\mathrm{in}}(t) - Q_{\\mathrm{out}}(t) + Q_{\\ell,\\mathrm{tot}}(t)\\big)\\,\\mathrm{d}t,\n$$\nwhich vanishes for exact satisfaction of the integrated continuity relation. In a numerical model, discretization errors in time for source terms $Q_{\\ell,\\mathrm{tot}}(t)$ and the imposition or reporting of boundary conditions $Q_{\\mathrm{out}}(t)$ cause $\\mathcal{E}(t_N)\\neq 0$.\n\nYou must implement a program that, given time series arrays for $V(t_n)$, $Q_{\\mathrm{in}}(t_n)$, $Q_{\\mathrm{out}}(t_n)$, and $Q_{\\ell,\\mathrm{tot}}(t_n)$ at discrete times $t_n=t_0+n\\,\\Delta t$, computes the cumulative volume discrepancy using a second-order accurate trapezoidal time integration of the flux term. Specifically, your program should compute\n$$\n\\widehat{\\mathcal{E}} = V(t_N) - V(t_0) - \\int_{t_0}^{t_N} \\widehat{F}(t)\\,\\mathrm{d}t,\\quad \\widehat{F}(t):=Q_{\\mathrm{in}}(t)-Q_{\\mathrm{out}}(t)+Q_{\\ell,\\mathrm{tot}}(t),\n$$\nwhere the integral is approximated by the trapezoidal rule using the given discrete samples.\n\nUse the following test suite, which specifies $N+1$ sample times $t_n=t_0+n\\,\\Delta t$ with $n\\in\\{0,1,\\dots,N\\}$ and provides three scenarios to probe different error sources:\n\n- Common temporal grid:\n  - $t_0 = 0\\,\\mathrm{s}$,\n  - $\\Delta t = 300\\,\\mathrm{s}$,\n  - $N = 24$,\n  - $t_N = N\\,\\Delta t = 7200\\,\\mathrm{s}$.\n\n- Common analytic definitions (used to generate input arrays):\n  - Upstream discharge:\n    $$\n    Q_{\\mathrm{in}}(t) = Q_0 + A\\,\\sin^2\\!\\Big(\\frac{\\pi t}{P}\\Big),\n    $$\n    with $Q_0=5\\,\\mathrm{m^3\\,s^{-1}}$, $A=3\\,\\mathrm{m^3\\,s^{-1}}$, and period $P=7200\\,\\mathrm{s}$.\n  - Total lateral inflow:\n    $$\n    Q_{\\ell,\\mathrm{tot}}(t) = B + C\\,\\cos\\!\\Big(\\frac{2\\pi t}{P}\\Big),\n    $$\n    with $B=1\\,\\mathrm{m^3\\,s^{-1}}$ and $C=0.5\\,\\mathrm{m^3\\,s^{-1}}$.\n  - Storage:\n    $$\n    V(t) = V_0 + S\\,\\sin\\!\\Big(\\frac{2\\pi t}{P}\\Big),\n    $$\n    with $V_0=10000\\,\\mathrm{m^3}$ and $S=500\\,\\mathrm{m^3}$.\n  - The downstream discharge is defined by exact global continuity:\n    $$\n    Q_{\\mathrm{out}}(t) = Q_{\\mathrm{in}}(t) + Q_{\\ell,\\mathrm{tot}}(t) - \\frac{\\mathrm{d}V(t)}{\\mathrm{d}t},\\quad \\frac{\\mathrm{d}V}{\\mathrm{d}t}=\\frac{2\\pi S}{P}\\cos\\!\\Big(\\frac{2\\pi t}{P}\\Big).\n    $$\n\n- Scenario A (reference dynamic solution consistent with exact continuity):\n  - Use the arrays $Q_{\\mathrm{in}}(t_n)$, $Q_{\\ell,\\mathrm{tot}}(t_n)$, $Q_{\\mathrm{out}}(t_n)$, and $V(t_n)$ sampled from the analytic definitions above without modification.\n\n- Scenario B (explicit-in-time source term and flux update mimicking a first-order scheme):\n  - Use the same $Q_{\\mathrm{in}}(t_n)$, $Q_{\\ell,\\mathrm{tot}}(t_n)$, and $Q_{\\mathrm{out}}(t_n)$ samples as above.\n  - Construct a model-reported storage sequence $\\widetilde{V}(t_n)$ by the explicit Euler update\n    $$\n    \\widetilde{V}(t_0)=V(t_0),\\quad \\widetilde{V}(t_n)=\\widetilde{V}(t_{n-1}) + \\Delta t\\,\\Big(Q_{\\mathrm{in}}(t_{n-1}) - Q_{\\mathrm{out}}(t_{n-1}) + Q_{\\ell,\\mathrm{tot}}(t_{n-1})\\Big)\\quad \\text{for } n\\in\\{1,\\dots,N\\}.\n    $$\n  - Compute the discrepancy using $\\widetilde{V}(t_n)$ together with the original flux arrays in the trapezoidal integral.\n\n- Scenario C (boundary-condition reporting inconsistency at the downstream boundary):\n  - Use the same $Q_{\\mathrm{in}}(t_n)$, $Q_{\\ell,\\mathrm{tot}}(t_n)$, and $V(t_n)$ as in Scenario A.\n  - Define a perturbed downstream discharge sequence $\\widehat{Q}_{\\mathrm{out}}(t_n)$ by introducing a single-step reporting error at the midpoint index $k=N/2$:\n    $$\n    \\widehat{Q}_{\\mathrm{out}}(t_n)=\n    \\begin{cases}\n    Q_{\\mathrm{out}}(t_n) - \\delta, \\text{if } n=k,\\\\\n    Q_{\\mathrm{out}}(t_n), \\text{otherwise},\n    \\end{cases}\n    $$\n    with $\\delta=0.5\\,\\mathrm{m^3\\,s^{-1}}$ and $k=12$.\n  - Compute the discrepancy using $V(t_n)$ together with $Q_{\\mathrm{in}}(t_n)$, $\\widehat{Q}_{\\mathrm{out}}(t_n)$, and $Q_{\\ell,\\mathrm{tot}}(t_n)$.\n\nYour program must:\n- Build the arrays for $t_n$, $Q_{\\mathrm{in}}(t_n)$, $Q_{\\ell,\\mathrm{tot}}(t_n)$, $Q_{\\mathrm{out}}(t_n)$, $V(t_n)$ according to the definitions above in International System of Units (SI).\n- For each scenario (A, B, C), compute the cumulative discrepancy $\\widehat{\\mathcal{E}}$ (in $\\mathrm{m^3}$) using the trapezoidal rule for the time integral of $\\widehat{F}(t)$.\n- Express the final answers in $\\mathrm{m^3}$, rounded to three decimals.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing the three discrepancy values for Scenarios A, B, and C, respectively, as a comma-separated list enclosed in square brackets (e.g., $[e_A,e_B,e_C]$), where each $e_\\cdot$ is a float in $\\mathrm{m^3}$ rounded to three decimals.\n\nThis test suite probes:\n- A general case with exact compliance (Scenario A),\n- A discretization-induced storage inconsistency due to explicit time stepping of source and boundary fluxes (Scenario B),\n- A boundary-condition reporting error localized at a single time level (Scenario C).\n\nYour results must be reproducible and self-contained without any external input. The output must strictly follow the specified single-line format.",
            "solution": "The problem presented is a valid exercise in numerical analysis as applied to environmental and earth system modeling, specifically open-channel hydraulics. It is scientifically grounded in the Saint-Venant equations, mathematically well-posed, and free of ambiguity or contradiction. All necessary data, equations, and numerical procedures are explicitly defined. We may therefore proceed with a complete solution.\n\nThe fundamental principle underlying this problem is the conservation of mass, or equivalently volume for an incompressible fluid like water, within a defined control volume. For one-dimensional open-channel flow in a reach of length $L$, the integral form of the continuity equation states that the rate of change of the volume of water stored in the reach, $V(t)$, must equal the net rate of inflow. This is expressed as:\n$$\n\\frac{\\mathrm{d}V(t)}{\\mathrm{d}t} = Q_{\\mathrm{in}}(t) - Q_{\\mathrm{out}}(t) + Q_{\\ell,\\mathrm{tot}}(t)\n$$\nHere, $Q_{\\mathrm{in}}(t)$ is the discharge at the upstream boundary ($x=0$), $Q_{\\mathrm{out}}(t)$ is the discharge at the downstream boundary ($x=L$), and $Q_{\\ell,\\mathrm{tot}}(t)$ is the total lateral inflow distributed along the reach. Let us define the net flux into the control volume as $\\widehat{F}(t) = Q_{\\mathrm{in}}(t) - Q_{\\mathrm{out}}(t) + Q_{\\ell,\\mathrm{tot}}(t)$. Then, the governing equation is simply $\\frac{\\mathrm{d}V(t)}{\\mathrm{d}t} = \\widehat{F}(t)$.\n\nIntegrating this relation over a time interval $[t_0, t_N]$ yields the exact cumulative change in storage:\n$$\n\\int_{t_0}^{t_N} \\frac{\\mathrm{d}V(t)}{\\mathrm{d}t} \\, \\mathrm{d}t = V(t_N) - V(t_0) = \\int_{t_0}^{t_N} \\widehat{F}(t) \\, \\mathrm{d}t\n$$\nIn a numerical simulation, the quantities $V(t)$ and $\\widehat{F}(t)$ are only known at discrete time steps $t_n = t_0 + n\\,\\Delta t$. The cumulative volume discrepancy, $\\widehat{\\mathcal{E}}$, is defined to measure the extent to which the numerical solution violates this integral balance:\n$$\n\\widehat{\\mathcal{E}}(t_N) = \\big(V(t_N) - V(t_0)\\big) - \\int_{t_0}^{t_N} \\widehat{F}(t) \\, \\mathrm{d}t\n$$\nA non-zero value of $\\widehat{\\mathcal{E}}$ indicates that the change in storage reported by the model is inconsistent with the time-integrated boundary and source fluxes it reports. Our task is to calculate this discrepancy for three scenarios. The integral term will be approximated numerically using the second-order accurate trapezoidal rule. For a function $\\widehat{F}(t)$ sampled at discrete times $t_n$ with constant step $\\Delta t$, the integral is approximated as:\n$$\n\\int_{t_0}^{t_N} \\widehat{F}(t) \\, \\mathrm{d}t \\approx \\sum_{n=1}^{N} \\frac{\\widehat{F}(t_{n-1}) + \\widehat{F}(t_n)}{2} \\Delta t = \\Delta t \\left( \\frac{\\widehat{F}(t_0)}{2} + \\sum_{n=1}^{N-1} \\widehat{F}(t_n) + \\frac{\\widehat{F}(t_N)}{2} \\right)\n$$\nWe shall now proceed step-by-step for each scenario.\n\nFirst, we generate the foundational time series data. We establish a time grid $t_n$ for $n \\in \\{0, 1, \\dots, 24\\}$ with $t_0=0\\,\\mathrm{s}$ and $\\Delta t = 300\\,\\mathrm{s}$. Using the provided analytical functions, we generate discrete arrays for the upstream inflow $Q_{\\mathrm{in}}(t_n)$, total lateral inflow $Q_{\\ell,\\mathrm{tot}}(t_n)$, storage volume $V(t_n)$, and its time derivative $\\frac{\\mathrm{d}V}{\\mathrm{d}t}(t_n)$. The downstream outflow $Q_{\\mathrm{out}}(t_n)$ is then constructed to satisfy the continuous volume balance equation at each discrete time point, ensuring that the net flux array, $\\widehat{F}(t_n) = Q_{\\mathrm{in}}(t_n) - Q_{\\mathrm{out}}(t_n) + Q_{\\ell,\\mathrm{tot}}(t_n)$, is pointwise identical to the array for $\\frac{\\mathrm{d}V}{\\mathrm{d}t}(t_n)$.\n\n**Scenario A: Reference Dynamic Solution**\nThis scenario serves as a baseline. The input data arrays for storage $V(t_n)$ and fluxes $Q_{\\mathrm{in}}(t_n)$, $Q_{\\mathrm{out}}(t_n)$, $Q_{\\ell,\\mathrm{tot}}(t_n)$ are all mutually consistent with the underlying continuous equations. The discrepancy is calculated as:\n$$\n\\widehat{\\mathcal{E}}_A = \\big(V(t_N) - V(t_0)\\big) - \\int_{t_0}^{t_N} \\widehat{F}(t) \\, \\mathrm{d}t\n$$\nFrom the analytical definition of $V(t)$, the storage change is $V(t_N) - V(t_0) = V(7200) - V(0) = (V_0 + S\\sin(2\\pi)) - (V_0+S\\sin(0)) = 0$. The exact integral $\\int_{t_0}^{t_N} \\widehat{F}(t) \\, \\mathrm{d}t = \\int_{0}^{P} \\frac{\\mathrm{d}V}{\\mathrm{d}t} \\, \\mathrm{d}t$ is also zero. The calculated discrepancy $\\widehat{\\mathcal{E}}_A$ will therefore be non-zero only due to the inherent error of the trapezoidal rule when applied to the function $\\widehat{F}(t)$. This value gauges the \"noise floor\" of our diagnostic tool.\n\n**Scenario B: Explicit-in-Time Source Term**\nThis scenario simulates a common source of mass balance error in numerical models: a mismatch between the time integration scheme used to update state variables and the scheme used to account for fluxes. Here, a new storage array $\\widetilde{V}(t_n)$ is generated using a first-order explicit Euler method:\n$$\n\\widetilde{V}(t_0)=V(t_0),\\quad \\widetilde{V}(t_n)=\\widetilde{V}(t_{n-1}) + \\Delta t\\,\\widehat{F}(t_{n-1})\\quad \\text{for } n\\in\\{1,\\dots,N\\}\n$$\nThe discrepancy is then computed using this new storage sequence, while the flux integral is still calculated with the second-order trapezoidal rule on the original flux data:\n$$\n\\widehat{\\mathcal{E}}_B = \\big(\\widetilde{V}(t_N) - \\widetilde{V}(t_0)\\big) - \\int_{t_0}^{t_N} \\widehat{F}(t) \\, \\mathrm{d}t\n$$\nThe change in storage is $\\widetilde{V}(t_N) - \\widetilde{V}(t_0) = \\Delta t \\sum_{n=0}^{N-1} \\widehat{F}(t_n)$, which is a rectangular (left-point) rule integration. The discrepancy $\\widehat{\\mathcal{E}}_B$ is the difference between this first-order integral approximation and the second-order trapezoidal approximation. A simple analysis shows this difference is $\\frac{\\Delta t}{2}(\\widehat{F}(t_0) - \\widehat{F}(t_N))$. Given that our problem spans exactly one period ($t_N=P$) of the periodic function $\\widehat{F}(t)$, we have $\\widehat{F}(t_0)=\\widehat{F}(t_N)$. Thus, we predict $\\widehat{\\mathcal{E}}_B$ to be exactly zero.\n\n**Scenario C: Boundary Condition Reporting Inconsistency**\nThis scenario tests the diagnostic's sensitivity to an isolated error in boundary condition data. The downstream discharge array is perturbed at a single time step $t_k=t_{12}$ by assuming the reported value is $\\widehat{Q}_{\\mathrm{out}}(t_k) = Q_{\\mathrm{out}}(t_k) - \\delta$, where $\\delta=0.5\\,\\mathrm{m^3\\,s^{-1}}$. This error might arise from a bug in model output or data assimilation. The discrepancy is calculated using the original storage array $V(t_n)$ but with a new net flux $\\widehat{F}_C(t)$ derived from the perturbed outflow $\\widehat{Q}_{\\mathrm{out}}(t_n)$.\n$$\n\\widehat{\\mathcal{E}}_C = \\big(V(t_N) - V(t_0)\\big) - \\int_{t_0}^{t_N} \\widehat{F}_C(t) \\, \\mathrm{d}t\n$$\nThe storage change $V(t_N) - V(t_0)$ remains zero. The perturbation in the flux array occurs only at index $k=12$. The trapezoidal rule sum is affected only over the two adjacent intervals, $[t_{11}, t_{12}]$ and $[t_{12}, t_{13}]$. The total change in the integrated flux is $\\frac{\\Delta t}{2}\\delta + \\frac{\\Delta t}{2}\\delta = \\delta\\Delta t$. Thus, the integral term is increased by $\\delta \\Delta t = 0.5 \\times 300 = 150\\,\\mathrm{m^3}$. The discrepancy is therefore predicted to be $\\widehat{\\mathcal{E}}_C = \\widehat{\\mathcal{E}}_A - \\delta\\Delta t$. This demonstrates how a localized flux reporting error leads to a significant, quantifiable cumulative mass balance error.\n\nThe implementation will follow these principles, using numerical libraries to perform the array manipulations and trapezoidal integration precisely as outlined.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the cumulative mass balance discrepancy for three scenarios\n    in an open-channel routing problem.\n    \"\"\"\n    # ----------------------------------------------------------------------\n    # Define common parameters and the temporal grid\n    # ----------------------------------------------------------------------\n    t0 = 0.0\n    dt = 300.0  # Time step in seconds\n    N = 24      # Number of time steps\n    t_N = N * dt\n\n    # Parameters for Q_in(t)\n    Q0 = 5.0\n    A_amp = 3.0\n    P = 7200.0  # Period in seconds\n\n    # Parameters for Q_ell_tot(t)\n    B = 1.0\n    C_amp = 0.5\n\n    # Parameters for V(t)\n    V0 = 10000.0\n    S = 500.0\n    \n    # Parameters for Scenario C\n    delta = 0.5  # Perturbation magnitude\n    k = N // 2   # Midpoint index for perturbation, N/2 = 12\n\n    # Create the time array (N+1 points from t_0 to t_N)\n    t = np.linspace(t0, t_N, N + 1)\n\n    # ----------------------------------------------------------------------\n    # Generate foundational time series data from analytic definitions\n    # ----------------------------------------------------------------------\n    # Upstream discharge: Q_in(t)\n    Q_in = Q0 + A_amp * np.sin(np.pi * t / P)**2\n\n    # Total lateral inflow: Q_ell_tot(t)\n    Q_lat_tot = B + C_amp * np.cos(2 * np.pi * t / P)\n\n    # Storage volume: V(t)\n    V = V0 + S * np.sin(2 * np.pi * t / P)\n\n    # Time derivative of storage: dV/dt\n    dVdt = (2 * np.pi * S / P) * np.cos(2 * np.pi * t / P)\n\n    # Downstream discharge: Q_out(t), defined by exact global continuity\n    Q_out = Q_in + Q_lat_tot - dVdt\n\n    # ----------------------------------------------------------------------\n    # Scenario A: Reference solution with exact continuity\n    # ----------------------------------------------------------------------\n    # The net flux F(t) is exactly dV/dt by construction.\n    F_A = Q_in - Q_out + Q_lat_tot\n    \n    # Integrate the net flux using the trapezoidal rule\n    integral_F_A = np.trapz(F_A, t)\n    \n    # Calculate the change in storage from the V array\n    delta_V_A = V[N] - V[0]\n    \n    # Compute the discrepancy for Scenario A\n    E_A = delta_V_A - integral_F_A\n\n    # ----------------------------------------------------------------------\n    # Scenario B: Discrepancy from explicit time-stepping for storage\n    # ----------------------------------------------------------------------\n    # The flux integral is the same as in Scenario A\n    integral_F_B = integral_F_A\n    \n    # Construct model-reported storage using explicit Euler update\n    V_tilde = np.zeros(N + 1)\n    V_tilde[0] = V[0]\n    for n in range(1, N + 1):\n        # Flux F is taken at the beginning of the interval (t_{n-1})\n        flux_at_prev_step = Q_in[n-1] - Q_out[n-1] + Q_lat_tot[n-1]\n        V_tilde[n] = V_tilde[n-1] + dt * flux_at_prev_step\n    \n    # Calculate storage change from the explicit Euler sequence\n    delta_V_B = V_tilde[N] - V_tilde[0]\n    \n    # Compute the discrepancy for Scenario B\n    E_B = delta_V_B - integral_F_B\n\n    # ----------------------------------------------------------------------\n    # Scenario C: Discrepancy from a boundary condition reporting error\n    # ----------------------------------------------------------------------\n    # The storage change is the same as in Scenario A\n    delta_V_C = delta_V_A\n    \n    # Create a perturbed downstream discharge array\n    Q_out_C = np.copy(Q_out)\n    Q_out_C[k] -= delta  # Apply perturbation at index k=12\n    \n    # Calculate the new net flux with the perturbed outflow\n    F_C = Q_in - Q_out_C + Q_lat_tot\n    \n    # Integrate the perturbed net flux\n    integral_F_C = np.trapz(F_C, t)\n    \n    # Compute the discrepancy for Scenario C\n    E_C = delta_V_C - integral_F_C\n\n    # ----------------------------------------------------------------------\n    # Format and print the final results\n    # ----------------------------------------------------------------------\n    results = [E_A, E_B, E_C]\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the solution\nsolve()\n\n```"
        },
        {
            "introduction": "Having explored model behavior and the importance of conservation, we now delve into the engine of a modern dynamic wave solver. This advanced exercise involves implementing the Harten-Lax-van Leer (HLL) approximate Riemann solver, a robust method for computing fluxes at cell interfaces in a finite volume scheme . This practice bridges the theoretical concept of characteristic wave speeds with the practical construction of a numerical flux function capable of handling the discontinuities, like bores or flood fronts, that are central to the Saint-Venant equations.",
            "id": "3902833",
            "problem": "You are tasked with implementing a numerical flux function for the one-dimensional shallow-water equations, derived from the Saint-Venant equations under the dynamic wave formulation for a flat bed. The problem concerns the Harten-Lax-van Leer (HLL) approximate Riemann solver and requires explanation and implementation of wave speed estimates at interfaces using characteristic speeds. The program must be self-contained and compute the HLL numerical flux for several carefully chosen test cases.\n\nFundamental base: The one-dimensional Saint-Venant equations (shallow-water equations) in conservative form for a flat bed are\n$$\n\\partial_t h + \\partial_x (h u) = 0,\n\\qquad\n\\partial_t (h u) + \\partial_x \\left(h u^2 + \\tfrac{1}{2} g h^2 \\right) = 0,\n$$\nwhere $h$ is the water depth in $\\mathrm{m}$, $u$ is the depth-averaged velocity in $\\mathrm{m/s}$, and $g$ is the gravitational acceleration in $\\mathrm{m/s^2}$. Defining the conservative state vector $U = (h, q)$ with $q = h u$ (discharge per unit width, in $\\mathrm{m^2/s}$), the corresponding flux vector $F(U)$ is\n$$\nF(U) = \\left(q, \\frac{q^2}{h} + \\frac{1}{2} g h^2 \\right),\n$$\nwith the convention that $\\frac{q^2}{h}$ is interpreted as $h u^2$ when $h  0$.\n\nAt an interface between a left state $U_L = (h_L, q_L)$ and a right state $U_R = (h_R, q_R)$, the HLL flux uses two wave speed estimates $s_L$ and $s_R$ computed from the local characteristic speeds $u \\pm \\sqrt{g h}$ of the shallow-water system. Specifically, the HLL wave speeds are chosen as\n$$\ns_L = \\min\\left( u_L - \\sqrt{g h_L},\\; u_R - \\sqrt{g h_R} \\right),\n\\qquad\ns_R = \\max\\left( u_L + \\sqrt{g h_L},\\; u_R + \\sqrt{g h_R} \\right).\n$$\nThe HLL numerical flux across the interface is defined piecewise as\n$$\nF_{\\mathrm{HLL}} =\n\\begin{cases}\nF(U_L),  \\text{if } s_L \\ge 0, \\\\\nF(U_R),  \\text{if } s_R \\le 0, \\\\\n\\dfrac{s_R F(U_L) - s_L F(U_R) + s_L s_R \\left(U_R - U_L\\right)}{s_R - s_L},  \\text{otherwise}.\n\\end{cases}\n$$\n\nYour program must implement the above HLL flux for the one-dimensional shallow-water equations and compute the numerical flux for the following test suite. Use $g = 9.81\\,\\mathrm{m/s^2}$. For each case, interpret the inputs as left and right physical states expressed by water depth and velocity, and convert them to conservative variables for computing fluxes. The required outputs are the mass flux component $f_h$ in $\\mathrm{m^2/s}$ and the momentum flux component $f_q$ in $\\mathrm{m^3/s^2}$. All outputs must be expressed in the specified units and rounded to six decimal places.\n\nTest suite:\n- Case $1$ (subcritical, mixed velocities): $h_L = 2.0\\,\\mathrm{m}$, $u_L = 1.0\\,\\mathrm{m/s}$, $h_R = 2.2\\,\\mathrm{m}$, $u_R = -0.5\\,\\mathrm{m/s}$.\n- Case $2$ (supercritical right-going, $s_L  0$): $h_L = 0.5\\,\\mathrm{m}$, $u_L = 4.0\\,\\mathrm{m/s}$, $h_R = 0.4\\,\\mathrm{m}$, $u_R = 3.0\\,\\mathrm{m/s}$.\n- Case $3$ (supercritical left-going, $s_R  0$): $h_L = 0.4\\,\\mathrm{m}$, $u_L = -3.0\\,\\mathrm{m/s}$, $h_R = 0.6\\,\\mathrm{m}$, $u_R = -4.0\\,\\mathrm{m/s}$.\n- Case $4$ (lake at rest, flat free surface): $h_L = 3.0\\,\\mathrm{m}$, $u_L = 0.0\\,\\mathrm{m/s}$, $h_R = 3.0\\,\\mathrm{m}$, $u_R = 0.0\\,\\mathrm{m/s}$.\n- Case $5$ (near-dry bed on the right): $h_L = 1.0\\,\\mathrm{m}$, $u_L = 0.0\\,\\mathrm{m/s}$, $h_R = 1.0 \\times 10^{-6}\\,\\mathrm{m}$, $u_R = 0.0\\,\\mathrm{m/s}$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a two-element list of the mass and momentum flux components for the corresponding test case, rounded to six decimal places. For example:\n$$\n\\text{[}[f_{h,1}, f_{q,1}], [f_{h,2}, f_{q,2}], \\ldots \\text{]}.\n$$\nNo spaces are permitted in the output string. The numerical values must be floats.\n\nAnswer units: Output $f_h$ in $\\mathrm{m^2/s}$ and $f_q$ in $\\mathrm{m^3/s^2}$, each rounded to six decimal places.",
            "solution": "The problem requires the implementation and application of the Harten-Lax-van Leer (HLL) approximate Riemann solver to calculate the numerical flux for the one-dimensional shallow-water equations. The shallow-water equations, derived from the Saint-Venant equations for a flat, frictionless channel bed, are a system of hyperbolic conservation laws.\n\nThe governing equations in conservative form are given by:\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\nwhere $t$ is time and $x$ is the spatial coordinate. The vector of conserved variables $U$ and the flux vector $F(U)$ are defined as:\n$$\nU = \\begin{pmatrix} h \\\\ h u \\end{pmatrix} = \\begin{pmatrix} h \\\\ q \\end{pmatrix}\n\\qquad\nF(U) = \\begin{pmatrix} h u \\\\ h u^2 + \\frac{1}{2} g h^2 \\end{pmatrix} = \\begin{pmatrix} q \\\\ \\frac{q^2}{h} + \\frac{1}{2} g h^2 \\end{pmatrix}\n$$\nHere, $h$ is the water depth, $u$ is the depth-averaged velocity, $q = hu$ is the discharge per unit width, and $g$ is the acceleration due to gravity, specified as $g = 9.81\\,\\mathrm{m/s^2}$. The term $\\frac{q^2}{h}$ is understood as $h u^2$ and is well-defined for $h  0$.\n\nThe HLL solver approximates the solution to the Riemann problem, which is an initial value problem with piecewise constant data defined by a left state $U_L$ and a right state $U_R$ at an interface. The HLL approximation assumes the solution consists of three constant states separated by two waves propagating with speeds $s_L$ and $s_R$. These speeds are estimates of the minimum and maximum characteristic speeds of the system. The characteristic speeds (eigenvalues of the flux Jacobian $\\frac{\\partial F}{\\partial U}$) for the shallow-water system are $\\lambda_{1,2} = u \\pm \\sqrt{g h}$.\n\nFollowing the problem statement, the wave speed estimates $s_L$ and $s_R$ are chosen as the minimum and maximum of the characteristic speeds computed from the left and right states:\n$$\ns_L = \\min( u_L - \\sqrt{g h_L},\\; u_R - \\sqrt{g h_R} )\n$$\n$$\ns_R = \\max( u_L + \\sqrt{g h_L},\\; u_R + \\sqrt{g h_R} )\n$$\nThe HLL numerical flux, denoted $F_{\\mathrm{HLL}}$, is then defined according to the propagation direction of these estimated waves relative to the interface (at $x=0$):\n\n1.  If $s_L \\ge 0$, both waves move to the right. The flux is determined entirely by the left state, as the entire wave structure is downstream of the interface.\n    $$\n    F_{\\mathrm{HLL}} = F(U_L)\n    $$\n2.  If $s_R \\le 0$, both waves move to the left. The flux is determined entirely by the right state, as the entire wave structure is upstream of the interface.\n    $$\n    F_{\\mathrm{HLL}} = F(U_R)\n    $$\n3.  If $s_L  0  s_R$, the waves move in opposite directions, creating a \"star\" region between them that spans the interface. The flux is a weighted average of the left and right fluxes, with an additional term accounting for the jump between $U_L$ and $U_R$. This formula is derived by integrating the conservation law over a control volume in the $x-t$ plane defined by the speeds $s_L$ and $s_R$.\n    $$\n    F_{\\mathrm{HLL}} = \\frac{s_R F(U_L) - s_L F(U_R) + s_L s_R (U_R - U_L)}{s_R - s_L}\n    $$\n\nThe computational procedure to calculate the HLL flux for each test case is as follows:\nFor each given test case with left state $(h_L, u_L)$ and right state $(h_R, u_R)$:\n\n1.  **Convert to Conservative Variables:**\n    Calculate the discharges $q_L = h_L u_L$ and $q_R = h_R u_R$.\n    Construct the state vectors $U_L = (h_L, q_L)$ and $U_R = (h_R, q_R)$.\n\n2.  **Estimate Wave Speeds:**\n    Compute the characteristic speeds for both left and right states: $u_L \\pm \\sqrt{g h_L}$ and $u_R \\pm \\sqrt{g h_R}$. The square root is well-defined as all given depths are non-negative.\n    Determine the HLL wave speeds $s_L$ and $s_R$ using the provided $\\min$ and $\\max$ formulas.\n\n3.  **Compute Physical Fluxes:**\n    Calculate the flux vectors $F(U_L)$ and $F(U_R)$ using the formula $F(U) = (q, q^2/h + \\frac{1}{2} g h^2)$. For the edge case of $h=0$, the flux would be $(0,0)$. The provided test cases avoid this by using a small positive depth for near-dry conditions ($h=10^{-6}\\,\\mathrm{m}$).\n\n4.  **Calculate HLL Flux:**\n    Apply the three-part piecewise formula for $F_{\\mathrm{HLL}}$ based on the signs of $s_L$ and $s_R$. The final output vector $F_{\\mathrm{HLL}} = (f_h, f_q)$ contains the numerical mass flux and momentum flux, respectively.\n\n5.  **Format Output:**\n    The components of the resulting flux vector $(f_h, f_q)$ are rounded to six decimal places for each test case.\n\nThis procedure will be applied to all five test cases to generate the final output. The use of vector arithmetic, as facilitated by a library like NumPy, simplifies the calculation of the central HLL flux formula, as it can be applied component-wise to the state and flux vectors.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the HLL numerical flux for the 1D shallow-water equations for a suite of test cases.\n    \"\"\"\n    # Gravitational acceleration\n    g = 9.81  # m/s^2\n\n    # Test suite: (h_L, u_L, h_R, u_R)\n    test_cases = [\n        (2.0, 1.0, 2.2, -0.5),      # Case 1: subcritical, mixed velocities\n        (0.5, 4.0, 0.4, 3.0),       # Case 2: supercritical right-going, s_L  0\n        (0.4, -3.0, 0.6, -4.0),     # Case 3: supercritical left-going, s_R  0\n        (3.0, 0.0, 3.0, 0.0),       # Case 4: lake at rest\n        (1.0, 0.0, 1.0e-6, 0.0),    # Case 5: near-dry bed on the right\n    ]\n\n    results = []\n\n    def compute_flux_vector(h, u, g_val):\n        \"\"\"Computes the physical flux vector F(U) from primitive variables (h, u).\"\"\"\n        if h = 0:\n            return np.array([0.0, 0.0])\n        q = h * u\n        return np.array([q, q**2 / h + 0.5 * g_val * h**2])\n\n    for case in test_cases:\n        h_L, u_L, h_R, u_R = case\n\n        # Step 1: Convert to conservative variables\n        q_L = h_L * u_L\n        q_R = h_R * u_R\n        \n        U_L = np.array([h_L, q_L])\n        U_R = np.array([h_R, q_R])\n\n        # Step 2: Estimate wave speeds\n        # Handle h=0 case, although not strictly necessary for given tests\n        c_L = np.sqrt(g * h_L) if h_L  0 else 0.0\n        c_R = np.sqrt(g * h_R) if h_R  0 else 0.0\n        \n        lambda_1_L = u_L - c_L\n        lambda_2_L = u_L + c_L\n        lambda_1_R = u_R - c_R\n        lambda_2_R = u_R + c_R\n        \n        s_L = min(lambda_1_L, lambda_1_R)\n        s_R = max(lambda_2_L, lambda_2_R)\n\n        # Step 3: Compute physical fluxes\n        F_L = compute_flux_vector(h_L, u_L, g)\n        F_R = compute_flux_vector(h_R, u_R, g)\n\n        # Step 4: Calculate HLL flux\n        if s_L = 0:\n            F_hll = F_L\n        elif s_R = 0:\n            F_hll = F_R\n        else: # s_L  0  s_R\n            # The denominator s_R - s_L is guaranteed to be non-zero here.\n            F_hll = (s_R * F_L - s_L * F_R + s_L * s_R * (U_R - U_L)) / (s_R - s_L)\n            \n        # Step 5: Round and store results\n        f_h = round(F_hll[0], 6)\n        f_q = round(F_hll[1], 6)\n        # Ensure -0.0 is represented as 0.0\n        if f_h == -0.0: f_h = 0.0\n        if f_q == -0.0: f_q = 0.0\n        results.append([f_h, f_q])\n    \n    # Final print statement in the exact required format.\n    # We construct the string manually to avoid spaces.\n    result_strings = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}