{
    "hands_on_practices": [
        {
            "introduction": "单位线理论的核心在于将流域响应视为一个线性时不变（LTI）系统。这个实践练习将理论付诸实践，要求您将一个复杂的多峰值有效降雨过程线分解为一系列简单的矩形脉冲。通过对每个脉冲产生的径流过程线进行缩放、时移和叠加，您将亲手构建出总的直接径流过程线，这正是离散卷积运算的直观体现。这个练习旨在通过编码实现单位线理论的基石——叠加原理，从而加深您对模型基本运作方式的理解。",
            "id": "3928620",
            "problem": "您的任务是开发一种计算方法，通过将多峰有效降雨雨型图分解为矩形脉冲并对相应的 $U_D(t)$ 响应进行求和，来预测洪水过程线。您需在降雨径流系统中，遵循单位线理论的原理进行操作。假设在所考虑的输入范围和历时内，流域的行为近似为一个线性时不变 (LTI) 系统，其非线性可忽略不计，并且质量守恒成立。历时为 $D$ 小时的单位线 (UH)，记作 $U_D(t)$，在此定义为单位深度响应函数：即在历时 $D$ 内均匀施加单位深度的有效降雨所产生的直接径流流量。因此，$U_D(t)$ 的单位为“立方米/秒/毫米”，这样将 $U_D(t)$ 乘以以毫米为单位的净雨深度，即可得到以立方米/秒为单位的流量。\n\n从以下基本依据出发：\n- 线性原理：如果深度为 $a$ 的有效降雨输入产生直接径流过程线 $a \\cdot U_D(t)$，深度为 $b$ 的输入产生 $b \\cdot U_D(t)$，那么深度为 $a+b$ 的输入将产生 $\\left(a+b\\right) \\cdot U_D(t)$。\n- 时不变性原理：如果将深度为 $p$ 的降雨作为一个历时为 $D$ 的矩形脉冲施加，那么将该脉冲平移时间 $\\tau$，其响应也会平移相同的时间 $\\tau$，而形状或量值不变。\n- 质量守恒：单位深度有效降雨产生的流量积分等于该深度降雨在汇水面积上产生的相应水量。\n\n利用这些原理，推导一个算法，对于一个表示为历时为 $D$ 的矩形脉冲有限序列的多峰雨型图，通过对按比例缩放并经时移的 $U_D(t)$ 响应求和，来预测相应的直接径流过程线。在一个程序中实现该算法，该程序在离散时间上运行，其步长等于脉冲历时 $D$。\n\n定义与计算要求：\n- 设 $D$ 为脉冲历时，单位为小时。\n- 设有效降雨雨型图由每个矩形脉冲 $k$ 的强度 $r_k$（单位：毫米/小时）给出。脉冲 $k$ 的深度（单位：毫米）为 $p_k = r_k \\times D$。\n- 设 $U_D[n]$ 为在离散时间 $t_n = nD$ 采样的单位深度单位线值，单位为“立方米/秒/毫米”。\n- 预测流量序列 $Q[n]$（单位：立方米/秒）通过对与每个脉冲深度 $p_k$ 对应的、经缩放和时移的 $U_D$ 响应求和得到。\n\n您的程序必须计算每个给定测试用例的 $Q[n]$。所有预测流量均以立方米/秒（$\\mathrm{m^3/s}$）表示，并四舍五入到三位小数。\n\n测试套件：\n- 用例 $1$（正常情况，多峰）：\n  - 脉冲历时 $D = 1$ 小时。\n  - 有效降雨强度 $r_k$（毫米/小时）：$[0, 6, 18, 0, 12, 6, 0]$。\n  - 单位深度单位线 $U_D[n]$（立方米/秒/毫米）：$[0, 40, 120, 80, 40, 0]$。\n- 用例 $2$（边界条件，含间歇性零值脉冲）：\n  - 脉冲历时 $D = 2$ 小时。\n  - 有效降雨强度 $r_k$（毫米/小时）：$[0, 8, 0, 12, 0]$。\n  - 单位深度单位线 $U_D[n]$（立方米/秒/毫米）：$[0, 25, 75, 50, 25, 0]$。\n- 用例 $3$（边缘情况，单位线非常短）：\n  - 脉冲历时 $D = 1$ 小时。\n  - 有效降雨强度 $r_k$（毫米/小时）：$[5, 0, 5, 0, 5]$。\n  - 单位深度单位线 $U_D[n]$（立方米/秒/毫米）：$[0, 30, 0]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应一个测试用例的预测过程线的浮点数内层列表。例如：$[[q_{1,0}, q_{1,1}, \\dots],[q_{2,0}, \\dots],[q_{3,0}, \\dots]]$。数值单位必须是 $\\mathrm{m^3/s}$，并四舍五入到三位小数。",
            "solution": "用户提供了一个问题陈述，要求基于单位线理论的原理，开发一种用于预测洪水过程线的计算方法。初始且最关键的步骤是验证问题的完整性。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n- **核心原理**：线性原理、时不变性原理、质量守恒。\n- **系统**：一个被建模为线性时不变 (LTI) 系统的降雨径流系统。\n- **定义**：\n    - $D$：脉冲历时，单位为小时。\n    - $U_D(t)$：历时为 $D$ 的单位深度单位线，定义为每单位深度有效降雨产生的直接径流流量。单位为立方米/秒/毫米 ($\\mathrm{m^3/s/mm}$)。\n    - $r_k$：矩形脉冲 $k$ 的有效降雨强度，单位为毫米/小时 ($\\mathrm{mm/hr}$)。\n    - $p_k$：脉冲 $k$ 的深度，计算公式为 $p_k = r_k \\times D$，单位为毫米 ($\\mathrm{mm}$)。\n    - $U_D[n]$：在离散时间 $t_n = nD$ 采样的单位深度单位线值。\n    - $Q[n]$：预测流量序列，单位为立方米/秒 ($\\mathrm{m^3/s}$)。\n- **计算要求**：通过对经缩放和时移的 $U_D$ 响应求和来计算 $Q[n]$，结果四舍五入到三位小数。\n- **测试用例 1**：\n    - $D = 1$ 小时。\n    - $r_k = [0, 6, 18, 0, 12, 6, 0]$ $\\mathrm{mm/hr}$。\n    - $U_D[n] = [0, 40, 120, 80, 40, 0]$ $\\mathrm{m^3/s/mm}$。\n- **测试用例 2**：\n    - $D = 2$ 小时。\n    - $r_k = [0, 8, 0, 12, 0]$ $\\mathrm{mm/hr}$。\n    - $U_D[n] = [0, 25, 75, 50, 25, 0]$ $\\mathrm{m^3/s/mm}$。\n- **测试用例 3**：\n    - $D = 1$ 小时。\n    - $r_k = [5, 0, 5, 0, 5]$ $\\mathrm{mm/hr}$。\n    - $U_D[n] = [0, 30, 0]$ $\\mathrm{m^3/s/mm}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n对问题进行严格验证：\n- **科学依据**：该问题从根本上基于单位线理论，这是工程水文学中模拟降雨径流过程的基石。LTI 系统假设，以及线性原理（叠加原理）和时不变性原理，是该理论的经典框架。该问题是这些原理的直接和标准应用。\n- **适定性**：该问题是适定的。给定输入信号（有效降雨雨型图）和系统的脉冲响应（单位线），求解输出信号（直接径流过程线）是一个明确定义的数学问题。对于给定的离散输入，存在唯一且稳定的解。\n- **客观性**：问题陈述使用了精确、量化且无歧义的术语。所有变量、单位和关系都得到了明确定义。\n- **缺陷分析**：\n    1.  **科学性不健全**：无。该模型是真实世界水文系统的一个标准（尽管是简化的）表示。\n    2.  **无法形式化/不相关**：无。该问题可直接形式化为一个数学算法。它完全与指定主题相关。\n    3.  **不完整/矛盾**：无。为每个测试用例提供了所有必要的数据（$D$, $r_k$, $U_D[n]$）。定义和单位在内部是一致的（例如，$(\\mathrm{mm/hr}) \\times (\\mathrm{hr}) = \\mathrm{mm}$; $(\\mathrm{mm}) \\times (\\mathrm{m^3/s/mm}) = \\mathrm{m^3/s}$）。\n    4.  **不切实际/不可行**：无。降雨和径流的数值在假想汇水区的合理范围内。\n    5.  **不适定**：无。问题结构通过标准算法导向唯一解。\n    6.  **伪深刻/琐碎**：无。该问题评估了在一个应用科学背景下对卷积原理的核心概念和计算理解。这是一个基础而非琐碎的练习。\n    7.  **外部可验证性**：无。结果是确定性的，并且可以通过计算进行验证。\n\n**步骤 3：结论与行动**\n\n此问题**有效**。它在科学上是健全的、适定的，并且内部一致。可以继续进行求解过程。\n\n### 基于原理的求解推导\n\n该问题要求计算由多峰有效降雨雨型图产生的直接径流过程线 $Q[n]$。此计算的基础在于线性和时不变性原理，这两个原理将流域定义为一个线性时不变 (LTI) 系统。\n\n**1. 离散时间内的系统表示**\n系统在大小为 $D$ 的离散时间步长上进行分析。\n- 输入是有效降雨雨型图，表示为深度序列 $P = \\{p_0, p_1, \\dots, p_{M-1}\\}$。每个深度 $p_k$ 是由给定的降雨强度 $r_k$ 在历时 $D$ 内得到的：\n$$ p_k = r_k \\cdot D $$\n其中 $k$ 是时间索引，使得时间 $t = kD$。\n- 系统的基本响应由单位深度单位线 $U_D[n]$ 表征，它是一个离散序列 $U = \\{u_0, u_1, \\dots, u_{N-1}\\}$，其中 $u_n = U_D[n]$。这表示由一个单位深度（1 毫米）和历时为 $D$ 的单一降雨脉冲产生的过程线。\n\n**2. 叠加原理与时不变性原理的应用**\n总径流是每个独立降雨脉冲响应的总和。\n\n- **对单个脉冲的响应**：考虑在时间索引 $k$ 发生的降雨脉冲 $p_k$。\n    - 根据**线性原理**，径流过程线的量值按降雨深度进行缩放。因此，对脉冲 $p_k$ 的响应是 $p_k \\cdot U$。\n    - 根据**时不变性原理**，在时间 $k$ 发生的脉冲所引起的响应，其形状与在时间 $0$ 发生的脉冲响应相同，但在时间上平移了 $k$ 个步长。\n\n- **响应的求和**：在任何时间索引 $n$ 的总流量，记作 $Q[n]$，是所有截至并包括时间 $n$ 已发生的降雨脉冲贡献的总和。在时间 $n$，由发生在时间 $k$（其中 $k \\le n$）的脉冲 $p_k$ 所作的贡献是 $p_k \\cdot u_{n-k}$。\n\n将所有过去和当前脉冲（$k=0, 1, \\dots, n$）的贡献相加，得到时间 $n$ 的总流量：\n$$ Q[n] = \\sum_{k=0}^{n} p_k \\cdot u_{n-k} $$\n这个表达式是输入序列 $P$ 和系统响应序列 $U$ 的**离散卷积**的定义。通常表示为：\n$$ Q = P * U $$\n\n**3. 算法实现**\n问题被简化为计算有效降雨深度序列和单位线纵坐标序列的离散卷积。\n\n- **步骤 A：预处理**：对于每个测试用例，必须首先根据给定的降雨强度 $r_k$ 和脉冲历时 $D$ 计算出有效降雨深度序列 $p_k$。\n- **步骤 B：卷积**：对序列 $P = \\{p_k\\}$ 和 $U = \\{u_n\\}$ 进行卷积，以产生直接径流过程线序列 $Q = \\{Q[n]\\}$。如果 $P$ 的长度为 $M$，$U$ 的长度为 $N$，则结果序列 $Q$ 的长度将为 $M+N-1$。\n- **步骤 C：后处理**：按要求将计算出的 $Q$ 中的流量值四舍五入到三位小数。\n\n此过程将为提供的三个测试用例中的每一个实施。Python 中的 `numpy` 库提供了一个高效的函数 `numpy.convolve`，它执行的正是这个操作。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes direct runoff hydrographs for given rainfall hyetographs and unit hydrographs\n    based on the principles of Linear Time-Invariant systems in hydrology.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"D\": 1,  # Pulse duration in hours\n            \"r\": [0, 6, 18, 0, 12, 6, 0],  # Effective rainfall intensities (mm/hr)\n            \"U\": [0, 40, 120, 80, 40, 0],  # Per-unit-depth Unit Hydrograph (m^3/s/mm)\n        },\n        {\n            \"D\": 2,\n            \"r\": [0, 8, 0, 12, 0],\n            \"U\": [0, 25, 75, 50, 25, 0],\n        },\n        {\n            \"D\": 1,\n            \"r\": [5, 0, 5, 0, 5],\n            \"U\": [0, 30, 0],\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Extract data for the current case\n        D = case[\"D\"]\n        r = np.array(case[\"r\"], dtype=float)\n        U = np.array(case[\"U\"], dtype=float)\n\n        # Step 1: Calculate the effective rainfall depth for each pulse.\n        # Depth (mm) = Intensity (mm/hr) * Duration (hr)\n        p = r * D\n\n        # Step 2: Compute the direct runoff hydrograph using discrete convolution.\n        # The output hydrograph Q is the convolution of the rainfall pulse depths p\n        # and the unit hydrograph U. This is the mathematical embodiment of the\n        # superposition of scaled and time-shifted responses.\n        Q = np.convolve(p, U)\n\n        # Step 3: Round the results to three decimal places as specified.\n        Q_rounded = np.round(Q, 3)\n\n        # Add the resulting list of floats to the main results list.\n        all_results.append(Q_rounded.tolist())\n\n    # Final print statement in the exact required format: [[...],[...],...]\n    # We construct the string manually to avoid extraneous spaces that `str(list)` might add.\n    inner_lists_as_strings = [str(res).replace(\" \", \"\") for res in all_results]\n    final_output_string = f\"[{','.join(inner_lists_as_strings)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了线性模型的基本构建之后，一个关键的进阶问题是：这个理想化的模型在多大程度上能反映真实世界？现实中的降雨径流过程并非完美线性，其中一个主要非线性来源是降雨损失过程。本练习引导您设计一个数值实验，通过比较不同强度风暴的响应，来检验和量化由降雨损失（如初损和稳定下渗）引入的非线性效应。您将使用 $L^2$ 范数这一严谨的数学工具来衡量实际响应与线性预测之间的偏差，从而深刻理解模型假设的适用边界及其对预测结果的影响。",
            "id": "3928688",
            "problem": "考虑一个由线性时不变系统表示的流域，该系统遵循单位线理论，其中直接径流过程线被建模为有效降雨过程线与单位线的卷积。此问题的基本依据包括以下经过充分检验的定义和建模假设：有效降雨是满足各种损失后对直接径流有贡献的那部分降雨；单位线是脉冲响应函数，其产生单位深度有效降雨下的流域流量。卷积算子用于将输入的有效降雨过程线映射为输出的流量过程线，这与线性系统的原理一致。该系统假设单位线在单位深度输入的适当意义下积分为单位1。您的任务是设计并实现一个线性度的数值检验，方法是比较两次不同强度风暴之间的过程线缩放，并且必须使用实际过程线与线性缩放过程线之差的相对平方积分范数（$L^2$范数）来量化偏差。\n\n使用以下要素来构建降雨和径流：\n\n1. 降雨过程线形状：在时间区间 $t \\in [0,T]$ 小时上定义一个无量纲三角形形状函数 $s(t)$，其峰值在 $t=T/2$，并经过归一化，使得 $\\int_{0}^{T} s(t)\\,dt = 1$ 小时。一个有效的选择是连续分段线性函数：\n$$\ns(t) = \n\\begin{cases}\n\\frac{4}{T^2}\\,t, & \\text{for } 0 \\le t \\le \\frac{T}{2} \\\\\n\\frac{4}{T^2}\\,(T - t), & \\text{for } \\frac{T}{2} < t \\le T \\\\\n0, & \\text{otherwise}\n\\end{cases}\n$$\n给定一个恒定的风暴强度 $R$（单位为 $\\mathrm{mm/hr}$），降雨过程线为 $R\\,s(t)$，单位为 $\\mathrm{mm/hr}$。\n\n2. 有效降雨的损失模型：假设存在初损 $I_a$（单位为 $\\mathrm{mm}$）和恒定损失率 $f_c$（单位为 $\\mathrm{mm/hr}$）。有效降雨率 $p_e(t)$（单位为 $\\mathrm{mm/hr}$）由一个阈值损失公式给出，该公式首先通过累积降雨深度满足初损，然后对剩余强度应用恒定损失。用 $D(t)=\\int_0^t R\\,s(\\tau)\\,d\\tau$（单位为 $\\mathrm{mm}$）表示累积降雨深度。那么对于离散时间算法，在每个时间步，如果 $D(t) \\le I_a$，则设置 $p_e(t)=0$；否则，设置 $p_e(t)=\\max\\{0, R\\,s(t) - f_c\\}$。\n\n3. 单位线：使用 Nash 汇流模型对单位线 $h(t)$ 进行建模，其形状参数为 $n$（无量纲），尺度参数为 $k$（单位为小时）：\n$$\nh(t) = \\frac{t^{n-1}\\,e^{-t/k}}{k^n\\,\\Gamma(n)},\n$$\n对于 $t \\ge 0$，其中 $\\Gamma(n)$ 是伽马函数。这个 $h(t)$ 的单位是 $\\mathrm{hr}^{-1}$，并满足 $\\int_0^\\infty h(t)\\,dt = 1$ 小时。\n\n4. 流量计算：直接径流流量过程线 $Q(t)$（单位为 $\\mathrm{m^3/s}$）通过将 $p_e(t)$ 与 $h(t)$ 进行卷积，并将深度率（在面积上）转换为体积流量来获得。使用流域面积 $A$（单位为 $\\mathrm{km^2}$），转换关系为 $1\\,\\mathrm{mm}$ 在 $1\\,\\mathrm{km^2}$ 上等于 $10^3\\,\\mathrm{m^3}$，且 $1\\,\\mathrm{hr} = 3600\\,\\mathrm{s}$。通过采用均匀时间步长 $\\Delta t$（单位为小时）的离散时间卷积来数值近似连续时间卷积积分，并通过包含 $\\Delta t$ 因子确保量纲一致性。\n\n5. 线性度检验：对于具有相同形状 $s(t)$ 和相同损失参数 $I_a$、$f_c$ 的两次风暴（强度分别为 $R_1$ 和 $R_2$），计算它们的流量过程线 $Q_1(t)$ 和 $Q_2(t)$。设强度比为 $c = R_2/R_1$。定义相对 $L^2$ 偏差度量\n$$\n\\mathcal{E} = \\frac{\\left\\|Q_2 - c\\,Q_1\\right\\|_{L^2}}{\\max\\left(\\left\\|c\\,Q_1\\right\\|_{L^2},\\,\\varepsilon\\right)},\n$$\n其中\n$$\n\\left\\|X\\right\\|_{L^2} = \\left( \\int_0^{T_\\mathrm{end}} X(t)^2\\,dt \\right)^{1/2},\n$$\n在离散时间中近似为 $\\left(\\sum_i X_i^2\\,\\Delta t_s\\right)^{1/2}$，其中 $\\Delta t_s = \\Delta t \\times 3600$ 秒，$T_\\mathrm{end}$ 的选择应能包含整个过程线的支撑集。使用一个小的正常数 $\\varepsilon$（在比率中无量纲）以避免在 $\\left\\|c\\,Q_1\\right\\|_{L^2}$ 为零时发生除以零的错误；设置 $\\varepsilon = 10^{-12}$。\n\n您的任务是实现一个程序，对于每个指定的测试用例，构建两次风暴，通过与 Nash 单位线的离散卷积计算 $Q_1(t)$ 和 $Q_2(t)$，并返回相对 $L^2$ 偏差 $\\mathcal{E}$ 作为浮点数。\n\n使用以下测试组，每个由 $(T, \\Delta t, A, n, k, I_a, f_c, R_1, R_2)$ 定义：\n\n- 案例 1（理想情况，由于损失为零，系统是完全线性的）：$(T=$ $6$ 小时, $\\Delta t=$ $0.1$ 小时, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ 小时, $I_a=$ $0$ $\\mathrm{mm}$, $f_c=$ $0$ $\\mathrm{mm/hr}$, $R_1=$ $10$ $\\mathrm{mm/hr}$, $R_2=$ $25$ $\\mathrm{mm/hr})$。\n- 案例 2（由恒定损失引起的非线性）：$(T=$ $6$ 小时, $\\Delta t=$ $0.1$ 小时, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ 小时, $I_a=$ $0$ $\\mathrm{mm}$, $f_c=$ $5$ $\\mathrm{mm/hr}$, $R_1=$ $10$ $\\mathrm{mm/hr}$, $R_2=$ $25$ $\\mathrm{mm/hr})$。\n- 案例 3（由初损引起的非线性）：$(T=$ $6$ 小时, $\\Delta t=$ $0.1$ 小时, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ 小时, $I_a=$ $10$ $\\mathrm{mm}$, $f_c=$ $0$ $\\mathrm{mm/hr}$, $R_1=$ $12$ $\\mathrm{mm/hr}$, $R_2=$ $24$ $\\mathrm{mm/hr})$。\n- 案例 4（边界情况：弱风暴低于恒定损失阈值）：$(T=$ $6$ 小时, $\\Delta t=$ $0.1$ 小时, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ 小时, $I_a=$ $0$ $\\mathrm{mm}$, $f_c=$ $8$ $\\mathrm{mm/hr}$, $R_1=$ $6$ $\\mathrm{mm/hr}$, $R_2=$ $12$ $\\mathrm{mm/hr})$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起的逗号分隔的结果列表（例如， $[$result1,result2,result3,result4$]$）。每个结果必须是对应案例的相对 $L^2$ 偏差 $\\mathcal{E}$，表示为一个无单位的十进制数。",
            "solution": "该问题为流域水文学中的一个数值实验提供了全面的框架，该实验基于单位线理论。任务是量化常见降雨损失模型引入的非线性。问题陈述在科学上是合理的、适定的且客观的。它基于将线性系统理论应用于水文学的既定原则，特别是有效降雨与单位线的卷积以产生直接径流过程线。降雨、损失和单位线的模型都是标准且明确定义的。数值模拟所需的所有参数均已提供。因此，该问题是有效的，并且可以构建解决方案。\n\n对于每个测试用例，解决方案按以下步骤进行：\n\n1.  **离散化时域**：建立一个具有恒定时间步长 $\\Delta t$ 的离散时间数组 $t_i$。总模拟时长 $T_{\\mathrm{end}}$ 必须足够长，以捕捉整个过程线响应。考虑到降雨持续时间 $T=6$ 小时以及单位线参数（$n=3$, $k=1$ 小时），选择模拟时间 $T_{\\mathrm{end}} = 50$ 小时，以确保过程线已完全退水。\n\n2.  **生成单位线 ($h(t)$)**：使用 Nash 汇流模型生成离散单位线纵坐标 $h_i = h(t_i)$。公式为：\n    $$h(t) = \\frac{t^{n-1}\\,e^{-t/k}}{k^n\\,\\Gamma(n)}$$\n    其中 $n$ 是形状参数， $k$ 是尺度参数（单位为小时），$\\Gamma(n)$ 是伽马函数。该单位线的单位为 $\\mathrm{hr}^{-1}$。在每个时间步 $t_i$ 对其进行求值，得到离散版本。\n\n3.  **生成有效降雨过程线 ($p_e(t)$)**：为两次风暴（降雨强度分别为 $R_1$ 和 $R_2$）中的每一次计算有效降雨过程线。\n    a. 首先，使用给定的三角形形状函数 $s(t)$ 和强度 $R$ 生成总降雨过程线 $p(t)$：$p(t) = R\\,s(t)$，单位为 $\\mathrm{mm/hr}$。\n    $$\n    s(t) = \n    \\begin{cases}\n    \\frac{4}{T^2}\\,t, & \\text{for } 0 \\le t \\le \\frac{T}{2} \\\\\n    \\frac{4}{T^2}\\,(T - t), & \\text{for } \\frac{T}{2} < t \\le T \\\\\n    0, & \\text{otherwise}\n    \\end{cases}\n    $$\n    b. 接下来，应用损失模型。计算到时间 $t$ 为止的累积降雨深度 $D(t) = \\int_0^t p(\\tau)d\\tau$，数值上作为累积和计算：$D_i = \\Delta t \\sum_{j=0}^{i} p_j$。\n    c. 根据规则确定有效降雨率 $p_e(t)$：如果 $D(t) \\le I_a$，则 $p_e(t)=0$；否则，$p_e(t) = \\max\\{0, p(t) - f_c\\}$。这里，$I_a$ 是初损（单位为 $\\mathrm{mm}$），$f_c$ 是恒定损失率（单位为 $\\mathrm{mm/hr}$）。这个规则引入了非线性。如果 $I_a=0$ 且 $f_c=0$，则 $p_e(t) = p(t)$，有效降雨的生成是对 $R$ 的线性缩放。\n\n4.  **计算流量过程线 ($Q(t)$)**：以深度率（$\\mathrm{mm/hr}$）表示的直接径流过程线是有效降雨 $p_e(t)$ 和单位线 $h(t)$ 的卷积：\n    $$Q_{\\text{depth}}(t) = \\int_0^t p_e(\\tau) h(t-\\tau) d\\tau$$\n    这通过离散卷积和来近似：$(Q_{\\text{depth}})_i = \\Delta t \\sum_{j=0}^i (p_e)_j h_{i-j}$。在数值上，这对应于 `np.convolve(pe, h) * dt`。然后，使用流域面积 $A$（单位为 $\\mathrm{km^2}$）和转换因子将得到的时间序列（单位为 $\\mathrm{mm/hr}$）转换为体积流量 $Q(t)$（单位为 $\\mathrm{m^3/s}$）：\n    $$Q[\\mathrm{m^3/s}] = Q_{\\text{depth}}[\\mathrm{mm/hr}] \\times A[\\mathrm{km^2}] \\times \\frac{1000}{3600}$$\n    此过程为两次风暴生成两条过程线 $Q_1(t)$ 和 $Q_2(t)$。\n\n5.  **量化非线性度 ($\\mathcal{E}$)**：与线性的偏差通过第二次风暴过程线 $Q_2(t)$ 与第一次风暴的线性缩放版本 $c\\,Q_1(t)$ 之差的相对 $L^2$ 范数来衡量，其中 $c = R_2/R_1$。\n    $L^2$ 范数的离散近似为 $\\left\\|X\\right\\|_{L^2} \\approx \\left(\\sum_i X_i^2\\,\\Delta t_s\\right)^{1/2}$，其中 $\\Delta t_s = \\Delta t \\times 3600$ 是以秒为单位的时间步长。\n    偏差度量 $\\mathcal{E}$ 计算如下：\n    $$\\mathcal{E} = \\frac{\\left\\|Q_2 - c\\,Q_1\\right\\|_{L^2}}{\\max\\left(\\left\\|c\\,Q_1\\right\\|_{L^2},\\,\\varepsilon\\right)}$$\n    小常数 $\\varepsilon = 10^{-12}$ 用于防止除以零。$\\mathcal{E} \\approx 0$ 的值表示线性行为，而 $\\mathcal{E} > 0$ 表示由损失模型引入的可量化的非线性程度。\n\n对四个提供的测试用例中的每一个都执行此完整过程，以计算它们各自的偏差度量。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import gamma\n\ndef calculate_hydrograph(R, T, dt, A, Ia, fc, t_arr, h_arr):\n    \"\"\"\n    Calculates the discharge hydrograph for a given storm and catchment properties.\n\n    Args:\n        R (float): Storm intensity (mm/hr).\n        T (float): Storm duration for the triangular shape (hr).\n        dt (float): Time step (hr).\n        A (float): Catchment area (km^2).\n        Ia (float): Initial abstraction (mm).\n        fc (float): Constant loss rate (mm/hr).\n        t_arr (np.ndarray): Time array (hr).\n        h_arr (np.ndarray): Unit hydrograph ordinates (1/hr).\n\n    Returns:\n        np.ndarray: Discharge hydrograph Q(t) in m^3/s.\n    \"\"\"\n    # 1. Rainfall hyetograph shape function s(t)\n    s = np.zeros_like(t_arr)\n    mask1 = (t_arr >= 0)  (t_arr = T / 2.0)\n    s[mask1] = (4.0 / T**2) * t_arr[mask1]\n    mask2 = (t_arr  T / 2.0)  (t_arr = T)\n    s[mask2] = (4.0 / T**2) * (T - t_arr[mask2])\n\n    # 2. Total rainfall hyetograph p(t)\n    p = R * s\n\n    # 3. Effective rainfall hyetograph pe(t)\n    pe = np.zeros_like(p)\n    # Avoid computation if rainfall is zero.\n    if R  0:\n        # Cumulative rainfall depth D(t)\n        D = np.cumsum(p) * dt\n        \n        # Apply loss model based on the problem statement\n        ia_satisfied_mask = D  Ia\n        p_potential = np.maximum(0, p - fc)\n        pe[ia_satisfied_mask] = p_potential[ia_satisfied_mask]\n\n    # 4. Convolution to get runoff depth rate\n    # The result of `convolve` has length len(pe) + len(h_arr) - 1.\n    # We truncate to the simulation time length.\n    q_depth_rate = np.convolve(pe, h_arr, mode='full')[:len(t_arr)] * dt\n\n    # 5. Unit conversion to m^3/s\n    # Conversion: A [km^2] * 10^6 [m^2/km^2] * q [mm/hr] * 10^-3 [m/mm] / 3600 [s/hr]\n    conversion_factor = (A * 1000.0) / 3600.0\n    Q_m3s = q_depth_rate * conversion_factor\n    \n    return Q_m3s\n\ndef compute_deviation(case):\n    \"\"\"\n    Computes the linearity deviation metric for a single test case.\n    \n    Args:\n        case (tuple): A tuple containing all parameters for the test case.\n        \n    Returns:\n        float: The relative L2 deviation metric E.\n    \"\"\"\n    T, dt, A, n, k, Ia, fc, R1, R2 = case\n    epsilon = 1e-12\n    dt_s = dt * 3600.0\n    \n    # Use a simulation time long enough to capture the full hydrograph response\n    t_end = 50.0 \n    t_arr = np.arange(0, t_end, dt)\n\n    # Generate Unit Hydrograph h(t) using the Nash cascade model\n    h_arr = np.zeros_like(t_arr)\n    if k  0:\n        # For t  0\n        idx_pos = t_arr  0\n        t_pos = t_arr[idx_pos]\n        # Using np.power for safe exponentiation\n        h_arr[idx_pos] = (np.power(t_pos, n - 1) * np.exp(-t_pos / k)) / (np.power(k, n) * gamma(n))\n        \n        # Handle t = 0 explicitly for robustness\n        if t_arr[0] == 0:\n            if n == 1:\n                h_arr[0] = 1.0 / k\n            # else h_arr[0] remains 0, which is correct for n  1\n\n    # Calculate discharge hydrographs for both storms\n    Q1 = calculate_hydrograph(R1, T, dt, A, Ia, fc, t_arr, h_arr)\n    Q2 = calculate_hydrograph(R2, T, dt, A, Ia, fc, t_arr, h_arr)\n    \n    # Calculate the linearity test metric\n    c = R2 / R1 if R1 != 0 else 0.0\n    \n    cQ1 = c * Q1\n    diff_Q = Q2 - cQ1\n\n    # Calculate L2 norms\n    norm_diff = np.sqrt(np.sum(diff_Q**2) * dt_s)\n    norm_cQ1 = np.sqrt(np.sum(cQ1**2) * dt_s)\n    \n    # Calculate the relative deviation E\n    E = norm_diff / max(norm_cQ1, epsilon)\n    \n    return E\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run simulations, and print results.\n    \"\"\"\n    # Test cases defined as (T, dt, A, n, k, Ia, fc, R1, R2)\n    test_cases = [\n        # Case 1 (happy path, perfectly linear system since losses are zero)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 0.0, 0.0, 10.0, 25.0),\n        # Case 2 (nonlinearity due to constant loss)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 0.0, 5.0, 10.0, 25.0),\n        # Case 3 (nonlinearity due to initial abstraction)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 10.0, 0.0, 12.0, 24.0),\n        # Case 4 (edge case: weak storm below constant loss threshold)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 0.0, 8.0, 6.0, 12.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        E = compute_deviation(case)\n        results.append(E)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "模型构建与验证中的一个深层次挑战是“异参同效”（Equifinality）现象，即不同的模型结构或参数组合可能产生非常相似的模拟结果。这个练习将引导您直面这一环境建模中的核心难题。您需要构建两个结构截然不同（一个单峰，一个双峰）的单位线，并检验它们在不同类型的降雨事件下所产生的径流输出。通过计算和比较归一化均方根误差（NRMSE），您将发现对于某些平滑的降雨输入，两个模型的表现可能惊人地相似，而对于脉冲式的输入则差异显著，这揭示了模型结构不确定性的本质及其对模型辨识和选择的深远启示。",
            "id": "3928742",
            "problem": "考虑一个基于单位线理论的线性时不变 (LTI) 汇水区模型，其中离散单位线 (DUH) $U_{D}[k]$ 描述了在第 $k$ 个离散时间间隔内，单位深度的有效降雨对直接径流流量的贡献比例。设时间步长为 $\\Delta t = 1$ 小时，DUH 长度为 $K = 48$ 步，汇水区面积为 $A = 200 \\times 10^{6}$ 平方米。假设有效降雨过程线 $P_{e}[n]$ 以毫米/小时为单位给出，并且已经扣除了损失。直接径流流量 $Q[n]$（单位为立方米/秒）通过 $P_{e}[n]$ 与 $U_{D}[k]$ 的离散卷积得到，如下所示：\n$$\nQ[n] = \\frac{A}{\\Delta t \\times 3600} \\sum_{k=0}^{K-1} U_{D}[k] \\cdot \\left(\\frac{P_{e}[n-k]}{1000}\\right),\n$$\n其中，当 $m  0$ 以及 $m$ 超出过程线长度时，$P_{e}[m] = 0$。\n\n您的任务是通过构建两种不同的 DUH 形状 $U_{D,1}[k]$ 和 $U_{D,2}[k]$ 来展示殊途同归性，这两种形状对给定的暴雨系列能产生相似的流量响应 $Q_{1}[n]$ 和 $Q_{2}[n]$。$U_{D,1}[k]$ 和 $U_{D,2}[k]$ 都必须满足 $\\sum_{k=0}^{K-1} U_{D,i}[k] = 1$，必须为非负，并且必须通过在整数小时对连续时间核进行采样并重新归一化，在支撑集 $k = 1,2,\\dots,K$ 上定义。构建：\n- 一个单峰的 $U_{D,1}[k]$，使用形状参数为 $k_{1} = 4$、尺度参数为 $\\theta_{1} = 1.5$ 小时的 Gamma 核。\n- 一个双峰的 $U_{D,2}[k]$，作为两个 Gamma 核的等权重混合，其均值分别为 $m_{1} = 4$ 小时和 $m_{2} = 8$ 小时，方差分别为 $v_{1} = 5$ 小时$^{2}$ 和 $v_{2} = 5$ 小时$^{2}$。对于每个分量，选择形状参数 $k_{i} = \\frac{m_{i}^{2}}{v_{i}}$ 和尺度参数 $\\theta_{i} = \\frac{v_{i}}{m_{i}}$，然后在离散支撑集上重新归一化之前，将它们以等权重混合。\n\n使用以下长度为 $L = 48$ 小时的有效降雨过程线 $P_{e}[n]$ 测试集：\n- 暴雨 $S_{1}$ (块状降雨)：对于 $n \\in \\{5,6,\\dots,16\\}$，$P_{e}[n] = 10$，否则 $P_{e}[n] = 0$。\n- 暴雨 $S_{2}$ (三角形长历时事件)：$P_{e}[n]$ 从 $n = 8$ 时的 $0$ 线性增加到 $n = 20$ 时的 $5$，然后线性减少到 $n = 32$ 时的 $0$；否则 $P_{e}[n] = 0$。\n- 暴雨 $S_{3}$ (双脉冲)：对于 $n \\in \\{3,4,5,6,7\\}$，$P_{e}[n] = 8$；对于 $n \\in \\{20,21,22,23,24,25\\}$，$P_{e}[n] = 6$；否则 $P_{e}[n] = 0$。\n- 暴雨 $S_{4}$ (类脉冲)：对于 $n = 12$，$P_{e}[n] = 25$，否则 $P_{e}[n] = 0$。\n- 暴雨 $S_{5}$ (零降雨边界情况)：对于所有 $n$，$P_{e}[n] = 0$。\n\n对于每场暴雨 $S_{j}$，计算两种流量响应 $Q_{1,j}[n]$ 和 $Q_{2,j}[n]$（单位为立方米/秒）。然后，按如下方式计算两种响应之间的归一化均方根误差 (NRMSE)：\n$$\n\\mathrm{NRMSE}(S_{j}) = \\frac{\\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} \\left(Q_{1,j}[n] - Q_{2,j}[n]\\right)^{2}}}{\\max\\left(\\max_{n} Q_{1,j}[n],\\ \\max_{n} Q_{2,j}[n],\\ \\varepsilon\\right)},\n$$\n其中 $N$ 是完整离散卷积输出的长度，$\\varepsilon = 10^{-12}$ 是一个很小的常数，用于处理流量完全为零的情况。所有流量均以立方米/秒表示，最终的归一化误差表示为无量纲浮点数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按 $[\\mathrm{NRMSE}(S_{1}), \\mathrm{NRMSE}(S_{2}), \\mathrm{NRMSE}(S_{3}), \\mathrm{NRMSE}(S_{4}), \\mathrm{NRMSE}(S_{5})]$ 的顺序排列。\n\n通过严格强制 $U_{D,i}[k]$ 的非负性、在离散支撑集上归一化为单位面积以及使用给定的物理单位来确保科学真实性。最终的浮点数应在输出行中四舍五入到六位小数。除了计算数值外，该问题还要求构造的 $U_{D,1}[k]$ 和 $U_{D,2}[k]$ 在形状上不同，但至少对于持续数小时的暴雨 $S_{1}$、$S_{2}$ 和 $S_{3}$，能产生相似的 $Q[n]$；类脉冲的 $S_{4}$ 和边界情况 $S_{5}$ 用作灵敏度和正确性的边缘情况测试。",
            "solution": "该问题是有效的，因为它科学地基于已建立的水文学原理，问题设定良好并提供了所有必要信息，且表述客观。任务是通过构建两个结构不同的单位线，来展示线性汇水区模型中的殊途同归性概念，这两个单位线对某些降雨事件会产生相似的径流响应。\n\n问题的核心在于直接径流的离散卷积模型，这是单位线理论的基本组成部分。直接径流流量 $Q[n]$ 被建模为线性时不变 (LTI) 系统的输出，其中有效降雨过程线 $P_e[n]$ 是输入信号，离散单位线 (DUH) $U_D[k]$ 是系统的脉冲响应。\n\n控制方程为：\n$$\nQ[n] = C \\cdot \\sum_{k=0}^{K-1} U_{D}[k] \\cdot P_{e}[n-k]\n$$\n这是一个离散卷积运算，通常表示为 $Q[n] = C \\cdot (U_D * P_e)[n]$。常数 $C$ 用于将卷积输出的单位（毫米/小时）转换为所需的目标流量单位立方米/秒 (m$^3$/s)。给定汇水区面积 $A = 200 \\times 10^6$ m$^2$，时间步长 $\\Delta t = 1$ 小时，并且需要将降雨量从毫米转换为米，常数 $C$ 的计算如下：\n$$\nC = \\frac{A \\text{ [m}^2\\text{]}}{1000 \\text{ [mm/m]} \\cdot \\Delta t \\text{ [hr]} \\cdot 3600 \\text{ [s/hr]}} = \\frac{200 \\times 10^6}{1000 \\cdot 1 \\cdot 3600} = \\frac{200 \\times 10^6}{3.6 \\times 10^6} = \\frac{500}{9} \\ \\frac{\\mathrm{m}^3/\\mathrm{s}}{\\mathrm{mm/hr}}\n$$\n\n该过程包括以下步骤：\n1.  构建两个不同的离散单位线 $U_{D,1}[k]$ 和 $U_{D,2}[k]$。\n2.  针对五种不同暴雨系列，生成径流过程线 $Q_1[n]$ 和 $Q_2[n]$。\n3.  使用归一化均方根误差 (NRMSE) 评估每场暴雨下 $Q_1[n]$ 和 $Q_2[n]$ 之间的相似性。\n\n**步骤 1：构建离散单位线**\n\n两个 DUH 的长度均为 $K=48$，通过在整数小时 $t \\in \\{1, 2, \\dots, K\\}$ 对连续时间核进行采样，然后对离散序列进行归一化以确保 $\\sum_{k=0}^{K-1} U_D[k] = 1$ 来得出。对于 $k=0, \\dots, K-1$，在 $t_k = k+1$ 处进行采样，将 DUH 数组的索引与标准的以 0 为基准的卷积和对齐，同时考虑到其底层的 Gamma 概率密度函数 (PDF) 是为 $t0$ 定义的。Gamma PDF 由 $f(t; \\alpha, \\theta) = \\frac{t^{\\alpha-1} e^{-t/\\theta}}{\\theta^\\alpha \\Gamma(\\alpha)}$ 给出，其中 $\\alpha$ 是形状参数，$\\theta$ 是尺度参数。\n\n- **单峰 DUH, $U_{D,1}[k]$**：该 DUH 基于形状参数为 $k_1 = 4$、尺度参数为 $\\theta_1 = 1.5$ 小时的单个 Gamma 分布。首先通过对 PDF 采样来计算原始未归一化的值 $u_{1,raw}[k]$：\n$$\nu_{1,raw}[k] = f(t=k+1; k_1=4, \\theta_1=1.5) \\quad \\text{for } k = 0, 1, \\dots, 47\n$$\n然后将这些值归一化以创建最终的 DUH：\n$$\nU_{D,1}[k] = \\frac{u_{1,raw}[k]}{\\sum_{j=0}^{K-1} u_{1,raw}[j]}\n$$\n\n- **双峰 DUH, $U_{D,2}[k]$**：该 DUH 是由两个 Gamma 分布的等权重混合构建而成。每个分量的参数是根据指定的均值 ($m$) 和方差 ($v$)，使用关系式 $\\alpha = m^2/v$ 和 $\\theta = v/m$ 推导出来的。\n\n  - **分量 1**：$m_1 = 4$ 小时, $v_1 = 5$ 小时$^2$。\n    - 形状：$\\alpha_{2,1} = m_1^2 / v_1 = 4^2 / 5 = 3.2$。\n    - 尺度：$\\theta_{2,1} = v_1 / m_1 = 5 / 4 = 1.25$ 小时。\n\n  - **分量 2**：$m_2 = 8$ 小时, $v_2 = 5$ 小时$^2$。\n    - 形状：$\\alpha_{2,2} = m_2^2 / v_2 = 8^2 / 5 = 12.8$。\n    - 尺度：$\\theta_{2,2} = v_2 / m_2 = 5 / 8 = 0.625$ 小时。\n\n原始未归一化的值 $u_{2,raw}[k]$ 是在 $t=k+1$ 处采样的两个分量 PDF 的等权重和：\n$$\nu_{2,raw}[k] = 0.5 \\cdot f(t=k+1; \\alpha_{2,1}, \\theta_{2,1}) + 0.5 \\cdot f(t=k+1; \\alpha_{2,2}, \\theta_{2,2})\n$$\n然后将这些值归一化以创建最终的 DUH：\n$$\nU_{D,2}[k] = \\frac{u_{2,raw}[k]}{\\sum_{j=0}^{K-1} u_{2,raw}[j]}\n$$\n\n**步骤 2：生成径流过程线**\n\n对于五个指定的暴雨过程线 $P_{e,j}[n]$（长度 $L=48$）中的每一个，计算两个直接径流过程线 $Q_{1,j}[n]$ 和 $Q_{2,j}[n]$。所得过程线的长度为 $N = L+K-1 = 48+48-1 = 95$。\n$$\nQ_{1,j}[n] = C \\cdot (U_{D,1} * P_{e,j})[n]\n$$\n$$\nQ_{2,j}[n] = C \\cdot (U_{D,2} * P_{e,j})[n]\n$$\n卷积通过数值方法执行。\n\n**步骤 3：响应相似性的量化**\n\n对于每场暴雨 $S_j$，两个径流过程线之间的差异使用归一化均方根误差 (NRMSE) 进行量化：\n$$\n\\mathrm{NRMSE}(S_{j}) = \\frac{\\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} \\left(Q_{1,j}[n] - Q_{2,j}[n]\\right)^{2}}}{\\max\\left(\\max_{n} Q_{1,j}[n],\\ \\max_{n} Q_{2,j}[n],\\ \\varepsilon\\right)}\n$$\n其中 $N=95$ 是过程线的长度，$\\varepsilon = 10^{-12}$ 是一个很小的常数，用于防止除以零，尤其与零降雨情况 ($S_5$) 相关。该指标提供了一个无量纲的度量，衡量两个过程线之间的平均差异，并按洪峰流量进行缩放。较低的 NRMSE 值表示更强的相似性，从而证明了殊途同归性原理。预计不同的暴雨结构将测试模型响应的灵敏度：更平滑、历时更长的暴雨 ($S_1, S_2, S_3$) 预计会产生比尖锐的类脉冲暴雨 ($S_4$) 更低的 NRMSE 值，因为卷积运算具有平滑效应，可以掩盖 DUH 中的差异。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import gamma\n\ndef solve():\n    \"\"\"\n    Solves the unit hydrograph equifinality problem.\n    \"\"\"\n    # Define physical and model constants from the problem statement\n    A = 200.0e6  # Catchment area in square meters\n    DELTA_T = 1.0  # Time step in hours\n    K = 48  # DUH length in steps\n    L = 48  # Rainfall hyetograph length in steps\n    EPSILON = 1e-12 # Small constant for NRMSE calculation\n\n    # Conversion constant from (mm/hr) to (m^3/s)\n    # C = A[m^2] / (1000[mm/m] * DELTA_T[hr] * 3600[s/hr])\n    C = A / (1000.0 * 3600.0 * DELTA_T)\n\n    # Time points for sampling the continuous kernels (t = 1, 2, ..., K)\n    t_sampling = np.arange(1, K + 1)\n\n    # --- Construct Unimodal DUH (U_D,1) ---\n    k1, theta1 = 4.0, 1.5\n    u1_raw = gamma.pdf(t_sampling, a=k1, scale=theta1)\n    u1_normalized = u1_raw / np.sum(u1_raw)\n\n    # --- Construct Bimodal DUH (U_D,2) ---\n    # Component 1\n    m1, v1 = 4.0, 5.0\n    k2_1, theta2_1 = m1**2 / v1, v1 / m1\n    # Component 2\n    m2, v2 = 8.0, 5.0\n    k2_2, theta2_2 = m2**2 / v2, v2 / m2\n\n    u2_comp1_raw = gamma.pdf(t_sampling, a=k2_1, scale=theta2_1)\n    u2_comp2_raw = gamma.pdf(t_sampling, a=k2_2, scale=theta2_2)\n\n    # Equal-weight mixture\n    u2_raw = 0.5 * u2_comp1_raw + 0.5 * u2_comp2_raw\n    u2_normalized = u2_raw / np.sum(u2_raw)\n\n    # Store the two DUHs\n    duhs = [u1_normalized, u2_normalized]\n\n    # --- Define Test Suite of Storms ---\n    # The problem defines 5 storms\n    storm_definitions = [\n        {'type': 'block', 'params': {'start': 5, 'end': 16, 'val': 10.0}},\n        {'type': 'triangular', 'params': {'p1': (8, 0.0), 'p2': (20, 5.0), 'p3': (32, 0.0)}},\n        {'type': 'two_pulses', 'params': [\n            {'start': 3, 'end': 7, 'val': 8.0},\n            {'start': 20, 'end': 25, 'val': 6.0}\n        ]},\n        {'type': 'impulse', 'params': {'loc': 12, 'val': 25.0}},\n        {'type': 'zero', 'params': {}},\n    ]\n\n    results = []\n    for storm_def in storm_definitions:\n        # Generate the effective rainfall hyetograph P_e[n]\n        pe = np.zeros(L)\n        if storm_def['type'] == 'block':\n            p = storm_def['params']\n            pe[p['start']:p['end']+1] = p['val']\n        elif storm_def['type'] == 'triangular':\n            p = storm_def['params']\n            xp = np.array([p['p1'][0], p['p2'][0], p['p3'][0]])\n            fp = np.array([p['p1'][1], p['p2'][1], p['p3'][1]])\n            pe_indices = np.arange(L)\n            pe = np.interp(pe_indices, xp, fp)\n            pe[pe  0] = 0 # Ensure non-negativity from interpolation\n        elif storm_def['type'] == 'two_pulses':\n            for pulse in storm_def['params']:\n                pe[pulse['start']:pulse['end']+1] = pulse['val']\n        elif storm_def['type'] == 'impulse':\n            p = storm_def['params']\n            pe[p['loc']] = p['val']\n        elif storm_def['type'] == 'zero':\n            pass # pe is already all zeros\n\n        # Compute discharge hydrographs Q1 and Q2\n        q1 = C * np.convolve(u1_normalized, pe)\n        q2 = C * np.convolve(u2_normalized, pe)\n\n        # Compute Normalized Root Mean Square Error (NRMSE)\n        diff_sq = (q1 - q2)**2\n        mse = np.mean(diff_sq)\n        rmse = np.sqrt(mse)\n        \n        q_max = np.max([np.max(q1), np.max(q2), EPSILON])\n        \n        nrmse = rmse / q_max\n        results.append(nrmse)\n\n    # Format the output as specified\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}