{
    "hands_on_practices": [
        {
            "introduction": "At the heart of environmental modeling lies the approximation of continuous physical laws, such as derivatives, using discrete numerical formulas. This fundamental step from the continuous to the discrete world inevitably introduces truncation error. This first exercise provides a concrete starting point by asking you to calculate this error directly for a simple finite difference scheme, reinforcing its core definition as the difference between the exact mathematical value and its numerical approximation .",
            "id": "2224228",
            "problem": "In numerical methods, the derivative of a function at a point can be estimated using finite difference formulas. The forward difference formula provides an approximation for the first derivative of a function $f(x)$ at a point $x$ using a small step size $h$, and is given by the expression:\n$$\nf'(x) \\approx \\frac{f(x+h) - f(x)}{h}\n$$\nThe truncation error is defined as the absolute difference between the true value of the derivative and the value obtained from the numerical approximation.\n\nConsider the function $f(x) = \\exp(2x)$. Your task is to calculate the truncation error when approximating the derivative $f'(x)$ at the point $x=0$, using the forward difference formula with a step size of $h=0.1$.\n\nRound your final answer to four significant figures.",
            "solution": "We are asked to compute the truncation error of the forward difference approximation for the derivative of $f(x)=\\exp(2x)$ at $x=0$ with step size $h=0.1$. The forward difference approximation is\n$$\nf'(x) \\approx \\frac{f(x+h)-f(x)}{h}.\n$$\nThe truncation error is the absolute difference between the true derivative and the approximation:\n$$\n\\text{TE}=\\left|f'(x)-\\frac{f(x+h)-f(x)}{h}\\right|.\n$$\nFor $f(x)=\\exp(2x)$, the exact derivative is\n$$\nf'(x)=2\\exp(2x),\n$$\nso at $x=0$,\n$$\nf'(0)=2\\exp(0)=2.\n$$\nThe forward difference approximation at $x=0$ with $h=0.1$ is\n$$\n\\frac{f(0.1)-f(0)}{0.1}=\\frac{\\exp(2\\cdot 0.1)-\\exp(0)}{0.1}=\\frac{\\exp(0.2)-1}{0.1}=10\\left(\\exp(0.2)-1\\right).\n$$\nTherefore, the truncation error is\n$$\n\\text{TE}=\\left|2-10\\left(\\exp(0.2)-1\\right)\\right|.\n$$\nEvaluating numerically,\n$$\n\\exp(0.2)\\approx 1.2214027581601699,\n$$\nso\n$$\n10\\left(\\exp(0.2)-1\\right)\\approx 10\\cdot 0.2214027581601699=2.214027581601699,\n$$\nand hence\n$$\n\\text{TE}\\approx |2-2.214027581601699|=0.214027581601699.\n$$\nRounding to four significant figures gives\n$$\n0.2140.\n$$",
            "answer": "$$\\boxed{0.2140}$$"
        },
        {
            "introduction": "In realistic modeling scenarios, we lack access to the exact continuum solution, making direct error calculation impossible. Instead, we must estimate the error from the numerical results themselves. This is achievable because the truncation error typically decreases in a predictable manner as the model's grid resolution, $\\Delta x$, is refined. This practice guides you through the derivation of Richardson Extrapolation, a powerful technique that uses solutions from multiple grids to not only estimate the truncation error but also to construct a higher-order, more accurate estimate of the true solution by canceling the leading error term .",
            "id": "3927311",
            "problem": "In a one-dimensional estuarine channel model governed by a steady advection–diffusion partial differential equation (PDE), a scalar diagnostic of interest, denoted by $J$, is computed from numerical solutions obtained with a second-order accurate spatial discretization on a uniform grid of spacing $\\Delta x$. Assume the method is consistent and that, in the asymptotic grid-refinement regime, the diagnostic satisfies an error expansion of the form $J(\\Delta x) = J^{\\ast} + \\text{TE}(\\Delta x)$, where $J^{\\ast}$ is the exact (continuum) diagnostic and the truncation error $\\text{TE}(\\Delta x)$ admits a smooth Taylor-like asymptotic series in even powers of $\\Delta x$ starting at order $\\Delta x^{2}$ due to second-order accuracy. Starting from the core definitions of consistency and order of accuracy, and using the asymptotic error expansion as a fundamental base, answer the following:\n1) Derive, by eliminating the leading-order truncation error term using two simulations at grid spacings $\\Delta x$ and $\\Delta x/2$, a closed-form expression for a Richardson-extrapolated estimator $J_{R}$ of $J^{\\ast}$ that achieves higher-order accuracy than the original second-order scheme.\n2) Show how the difference $J(\\Delta x/2) - J(\\Delta x)$ provides a leading-order estimator of the magnitude of the truncation error of the finer-grid diagnostic $J(\\Delta x/2)$, and derive the proportionality constant explicitly.\n3) A coastal ocean application yields the following numerically computed surface heat flux diagnostics (in watts per square meter) using the same second-order scheme at two grid spacings: $J(\\Delta x) = 1.372 \\times 10^{-3}$ and $J(\\Delta x/2) = 1.401 \\times 10^{-3}$. Using your derived formulas, compute the Richardson-extrapolated estimate $J_{R}$ and the leading-order absolute truncation error estimate for $J(\\Delta x/2)$. Round your final numeric values to four significant figures. Express the final answer in watts per square meter, and report it as a row vector $\\big[ J_{R}, \\widehat{E}_{\\Delta x/2} \\big]$.",
            "solution": "The problem statement has been critically validated and is deemed to be scientifically grounded, well-posed, and self-contained. It presents a standard and formalizable problem in numerical analysis, specifically pertaining to error estimation and convergence acceleration via Richardson extrapolation for discretized partial differential equations. All provided information is consistent and sufficient for deriving a unique solution.\n\nThe core of the problem rests on the given asymptotic error expansion for a numerically computed diagnostic, $J(\\Delta x)$, obtained with a second-order accurate scheme. The expansion is stated to be a series in even powers of the grid spacing $\\Delta x$:\n$$\nJ(\\Delta x) = J^{\\ast} + c_{2}(\\Delta x)^2 + c_{4}(\\Delta x)^4 + c_{6}(\\Delta x)^6 + \\dots\n$$\nHere, $J^{\\ast}$ represents the exact value of the diagnostic in the continuum limit ($\\Delta x \\to 0$), and $c_{2}, c_{4}, c_{6}, \\dots$ are constants that are independent of $\\Delta x$. The term $c_{2}(\\Delta x)^2$ is the leading-order truncation error, consistent with a second-order accurate method.\n\n1) Derivation of the Richardson-extrapolated estimator $J_{R}$\n\nWe are given two numerical solutions, one computed with grid spacing $\\Delta x$ and another with a refined grid spacing of $\\Delta x/2$. We write the error expansion for both:\n$$\nJ(\\Delta x) = J^{\\ast} + c_{2}(\\Delta x)^2 + c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) \\quad (1)\n$$\n$$\nJ(\\frac{\\Delta x}{2}) = J^{\\ast} + c_{2}\\left(\\frac{\\Delta x}{2}\\right)^2 + c_{4}\\left(\\frac{\\Delta x}{2}\\right)^4 + \\mathcal{O}((\\Delta x)^6) = J^{\\ast} + \\frac{1}{4}c_{2}(\\Delta x)^2 + \\frac{1}{16}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) \\quad (2)\n$$\nThe objective of Richardson extrapolation is to form a linear combination of $J(\\Delta x)$ and $J(\\Delta x/2)$ that eliminates the leading-order error term, $c_{2}(\\Delta x)^2$. To do this, we can multiply equation $(2)$ by $4$ to match the coefficient of the leading error term in equation $(1)$:\n$$\n4 J(\\frac{\\Delta x}{2}) = 4J^{\\ast} + c_{2}(\\Delta x)^2 + \\frac{4}{16}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) = 4J^{\\ast} + c_{2}(\\Delta x)^2 + \\frac{1}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) \\quad (3)\n$$\nNow, we subtract equation $(1)$ from equation $(3)$:\n$$\n4 J(\\frac{\\Delta x}{2}) - J(\\Delta x) = (4J^{\\ast} - J^{\\ast}) + (c_{2}(\\Delta x)^2 - c_{2}(\\Delta x)^2) + (\\frac{1}{4}c_{4}(\\Delta x)^4 - c_{4}(\\Delta x)^4) + \\mathcal{O}((\\Delta x)^6)\n$$\n$$\n4 J(\\frac{\\Delta x}{2}) - J(\\Delta x) = 3J^{\\ast} - \\frac{3}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6)\n$$\nSolving this algebraic equation for $J^{\\ast}$ gives:\n$$\nJ^{\\ast} = \\frac{4 J(\\frac{\\Delta x}{2}) - J(\\Delta x)}{3} + \\frac{1}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6)\n$$\nThe Richardson-extrapolated estimator, $J_{R}$, is defined as the leading term of this expression, which provides a higher-order estimate of $J^{\\ast}$:\n$$\nJ_{R} = \\frac{4 J(\\frac{\\Delta x}{2}) - J(\\Delta x)}{3}\n$$\nThe error of this new estimator is $J_{R} - J^{\\ast} = -\\frac{1}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6)$. Since the error is now proportional to $(\\Delta x)^4$, the estimator $J_{R}$ is fourth-order accurate, an improvement over the original second-order scheme.\n\n2) Derivation of the truncation error estimator for $J(\\Delta x/2)$\n\nThe goal is to estimate the truncation error of the finer-grid solution, $E_{\\Delta x/2} = J(\\Delta x/2) - J^{\\ast}$. The leading-order term of this error is $E_{\\Delta x/2} \\approx \\frac{1}{4}c_{2}(\\Delta x)^2$. We need to find an expression for this quantity using the observable difference between the two numerical solutions, $J(\\Delta x/2) - J(\\Delta x)$.\n\nLet us subtract equation $(2)$ from equation $(1)$, keeping only the leading-order error terms:\n$$\nJ(\\Delta x) - J(\\frac{\\Delta x}{2}) \\approx (J^{\\ast} + c_{2}(\\Delta x)^2) - (J^{\\ast} + \\frac{1}{4}c_{2}(\\Delta x)^2)\n$$\n$$\nJ(\\Delta x) - J(\\frac{\\Delta x}{2}) \\approx \\frac{3}{4}c_{2}(\\Delta x)^2\n$$\nThis allows us to estimate the unknown term $c_{2}(\\Delta x)^2$ from the computed values:\n$$\nc_{2}(\\Delta x)^2 \\approx \\frac{4}{3}\\left(J(\\Delta x) - J(\\frac{\\Delta x}{2})\\right)\n$$\nThe leading-order truncation error for the finer-grid diagnostic, $J(\\Delta x/2)$, is $E_{\\Delta x/2} \\approx \\frac{1}{4}c_{2}(\\Delta x)^2$. Substituting our estimate for $c_{2}(\\Delta x)^2$:\n$$\nE_{\\Delta x/2} \\approx \\frac{1}{4} \\left[ \\frac{4}{3}\\left(J(\\Delta x) - J(\\frac{\\Delta x}{2})\\right) \\right] = \\frac{1}{3}\\left(J(\\Delta x) - J(\\frac{\\Delta x}{2})\\right)\n$$\nThis expression provides a leading-order estimate for the signed truncation error of $J(\\Delta x/2)$. The problem asks for an estimator based on the difference $J(\\Delta x/2) - J(\\Delta x)$, which gives:\n$$\nE_{\\Delta x/2} \\approx -\\frac{1}{3}\\left(J(\\frac{\\Delta x}{2}) - J(\\Delta x)\\right)\n$$\nThe magnitude of the truncation error is therefore estimated as:\n$$\n|E_{\\Delta x/2}| \\approx \\frac{1}{3}\\left|J(\\frac{\\Delta x}{2}) - J(\\Delta x)\\right|\n$$\nThis shows that the difference $J(\\Delta x/2) - J(\\Delta x)$ is indeed a proxy for the truncation error of the fine-grid solution, and the proportionality constant relating its magnitude to the error magnitude is $1/3$.\n\n3) Numerical computation\n\nWe are given the following numerical values for the surface heat flux diagnostic:\n$$\nJ(\\Delta x) = 1.372 \\times 10^{-3} \\, \\text{W m}^{-2}\n$$\n$$\nJ(\\frac{\\Delta x}{2}) = 1.401 \\times 10^{-3} \\, \\text{W m}^{-2}\n$$\nFirst, we compute the Richardson-extrapolated estimate $J_{R}$ using the formula from part $(1)$:\n$$\nJ_{R} = \\frac{4 J(\\frac{\\Delta x}{2}) - J(\\Delta x)}{3} = \\frac{4(1.401 \\times 10^{-3}) - 1.372 \\times 10^{-3}}{3}\n$$\n$$\nJ_{R} = \\frac{(5.604 - 1.372) \\times 10^{-3}}{3} = \\frac{4.232 \\times 10^{-3}}{3} \\approx 1.410666... \\times 10^{-3}\n$$\nRounding to four significant figures, we get $J_{R} = 1.411 \\times 10^{-3}$.\n\nNext, we compute the leading-order absolute truncation error estimate for $J(\\Delta x/2)$, which we denote $\\widehat{E}_{\\Delta x/2}$, using the formula from part $(2)$:\n$$\n\\widehat{E}_{\\Delta x/2} = \\frac{\\left|J(\\frac{\\Delta x}{2}) - J(\\Delta x)\\right|}{3} = \\frac{\\left| (1.401 \\times 10^{-3}) - (1.372 \\times 10^{-3}) \\right|}{3}\n$$\n$$\n\\widehat{E}_{\\Delta x/2} = \\frac{|0.029 \\times 10^{-3}|}{3} = \\frac{0.029 \\times 10^{-3}}{3} \\approx 0.009666... \\times 10^{-3} = 9.666... \\times 10^{-6}\n$$\nRounding to four significant figures, we get $\\widehat{E}_{\\Delta x/2} = 9.667 \\times 10^{-6}$.\n\nThe final requested quantities, expressed in watts per square meter, are $J_R \\approx 1.411 \\times 10^{-3}$ and $\\widehat{E}_{\\Delta x/2} \\approx 9.667 \\times 10^{-6}$.",
            "answer": "$$\n\\boxed{\\begin{bmatrix} 1.411 \\times 10^{-3} & 9.667 \\times 10^{-6} \\end{bmatrix}}\n$$"
        },
        {
            "introduction": "Building on error estimation, it is crucial for modelers to adopt standardized methods for quantifying and reporting the numerical uncertainty of their results. The Grid Convergence Index (GCI) is a widely accepted framework for this purpose, rooted in the same principles of asymptotic error analysis used in Richardson Extrapolation. A critical component of this procedure is to first calculate the *observed* order of accuracy, $p$, from the simulation outputs to verify that the model's code is performing as theoretically expected. This final, implementation-focused exercise  challenges you to conduct a formal grid convergence study, a capstone skill for model verification and validation.",
            "id": "3927276",
            "problem": "You are modeling an inert tracer concentration in a transport-diffusion simulation representative of environmental and earth system modeling. Consider a sequence of nested, structured grids with spacings $h_1$, $h_2$, $h_3$ ($h_1 < h_2 < h_3$) on which a scalar quantity $Q(h)$ is computed, where $Q(h)$ is a physically meaningful diagnostic such as the domain-mean tracer concentration expressed in kilograms per cubic meter ($\\mathrm{kg}\\,\\mathrm{m}^{-3}$). Assume the numerical method is in the asymptotic range so that the truncation error scales with grid spacing according to a power law: $$Q(h) = Q^\\ast + C\\,h^p + \\mathcal{O}\\!\\left(h^{p+1}\\right),$$ where $Q^\\ast$ is the grid-independent solution, $C$ is a constant depending on the method and solution regularity, and $p$ is the observed order of accuracy.\n\nFrom first principles, use the above scaling to:\n- Derive the observed order $p$ from three-grid data $(h_1,h_2,h_3)$ and $(Q_1,Q_2,Q_3)$, where $Q_i = Q(h_i)$, by eliminating the unknown constant $C$ and the unknown grid-independent value $Q^\\ast$.\n- Using the same scaling and a fixed safety factor $F_s = 1.25$ appropriate for three-grid, monotonic convergence studies, compute the Grid Convergence Index (GCI) for the fine–medium pair and the medium–coarse pair. The GCI should be reported as a dimensionless decimal (not a percentage) quantifying the estimated fractional uncertainty of the reported solution on the finer grid of the pair. Your program must treat the GCI for the fine–medium pair as $$\\mathrm{GCI}_{21} = F_s \\,\\frac{\\left|Q_2 - Q_1\\right|}{\\left|Q_1\\right|\\left(r_{21}^p - 1\\right)},$$ and similarly for the medium–coarse pair $$\\mathrm{GCI}_{32} = F_s \\,\\frac{\\left|Q_3 - Q_2\\right|}{\\left|Q_2\\right|\\left(r_{32}^p - 1\\right)},$$ where $r_{21} = h_2/h_1$ and $r_{32} = h_3/h_2$.\n\nYour program must implement a principled procedure to infer $p$ from the truncation error scaling using three-grid data. It must be robust to both positive and negative differences of $Q_i$ and must use absolute differences where appropriate to avoid sign ambiguity in the observed order. If $r_{21} \\neq r_{32}$, your program should solve the nonlinear equation implied by the scaling relationship rather than assuming a common refinement ratio.\n\nPhysical units and output requirements:\n- The inputs $Q_i$ must be interpreted as tracer concentrations in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$, and grid spacings $h_i$ must be in meters ($\\mathrm{m}$).\n- The outputs $p$, $\\mathrm{GCI}_{21}$, and $\\mathrm{GCI}_{32}$ are dimensionless. Report $\\mathrm{GCI}_{21}$ and $\\mathrm{GCI}_{32}$ as decimal fractions (not percentages).\n\nTest suite:\nUse the following five test cases, each defined by $(h_1,h_2,h_3)$ in meters and $(Q_1,Q_2,Q_3)$ in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$:\n1. Case $1$ (common refinement ratio $r=2$, monotonic convergence, quadratic truncation error): $h_1 = 0.01$, $h_2 = 0.02$, $h_3 = 0.04$; $Q_1 = 1.00005$, $Q_2 = 1.0002$, $Q_3 = 1.0008$.\n2. Case $2$ (common refinement ratio $r=2$, monotonic convergence, non-integer order): $h_1 = 0.02$, $h_2 = 0.04$, $h_3 = 0.08$; $Q_1 = 1.9994343146$, $Q_2 = 1.9984$, $Q_3 = 1.9954745166$.\n3. Case $3$ (common refinement ratio $r=2$, near-asymptotic with small higher-order contamination): $h_1 = 0.01$, $h_2 = 0.02$, $h_3 = 0.04$; $Q_1 = 0.80003005$, $Q_2 = 0.8001204$, $Q_3 = 0.8004832$.\n4. Case $4$ (common refinement ratio $r=2$, very small differences testing numerical robustness): $h_1 = 0.001$, $h_2 = 0.002$, $h_3 = 0.004$; $Q_1 = 1.5000001$, $Q_2 = 1.5000004$, $Q_3 = 1.5000016$.\n5. Case $5$ (unequal refinement ratios, monotonic convergence): $h_1 = 0.01$, $h_2 = 0.015$, $h_3 = 0.027$; $Q_1 = 0.7500159247$, $Q_2 = 0.7500388040$, $Q_3 = 0.7501413000$.\n\nFinal output format:\nYour program should produce a single line of output containing a comma-separated list of five inner lists, each inner list holding three floating-point numbers $[p,\\mathrm{GCI}_{21},\\mathrm{GCI}_{32}]$ for the corresponding test case. The overall format must be exactly:\n$$\\text{[}[p_1,\\mathrm{GCI}_{21,1},\\mathrm{GCI}_{32,1}], [p_2,\\mathrm{GCI}_{21,2},\\mathrm{GCI}_{32,2}], [p_3,\\mathrm{GCI}_{21,3},\\mathrm{GCI}_{32,3}], [p_4,\\mathrm{GCI}_{21,4},\\mathrm{GCI}_{32,4}], [p_5,\\mathrm{GCI}_{21,5},\\mathrm{GCI}_{32,5}]\\text{]}.$$\nAll numerical values must be printed as standard Python floating-point literals. No additional text should be printed.",
            "solution": "The user-provided problem statement has been analyzed and found to be valid. It is scientifically grounded in the principles of numerical analysis and verification and validation, specifically concerning grid convergence studies. The problem is well-posed, objective, and contains all necessary information to derive and compute the requested quantities.\n\nThe solution proceeds in two stages: first, a principled derivation of the formulas for the observed order of accuracy ($p$) and the Grid Convergence Index (GCI), and second, the implementation of these formulas in a Python script to solve the given test cases.\n\n### Derivation of the Observed Order of Accuracy ($p$)\n\nThe starting point is the assumed power-law scaling of the truncation error for a computed scalar quantity $Q(h)$ as a function of grid spacing $h$:\n$$Q(h) = Q^\\ast + C\\,h^p + \\mathcal{O}\\!\\left(h^{p+1}\\right)$$\nHere, $Q^\\ast$ is the exact, grid-independent solution, $C$ is a constant, and $p$ is the order of accuracy of the numerical method. Given three solutions $Q_1$, $Q_2$, and $Q_3$ computed on three grids with spacings $h_1$, $h_2$, and $h_3$ (where $h_1 < h_2 < h_3$), we can write a system of three equations by neglecting the higher-order terms $\\mathcal{O}(h^{p+1})$. This is a valid approximation when the grid is sufficiently refined to be in the asymptotic range.\n\n$$Q_1 \\approx Q^\\ast + C h_1^p \\quad (1)$$\n$$Q_2 \\approx Q^\\ast + C h_2^p \\quad (2)$$\n$$Q_3 \\approx Q^\\ast + C h_3^p \\quad (3)$$\n\nOur objective is to determine $p$ by eliminating the unknowns $Q^\\ast$ and $C$. First, we eliminate $Q^\\ast$ by subtracting consecutive equations:\n$$Q_2 - Q_1 = C (h_2^p - h_1^p) \\quad (4)$$\n$$Q_3 - Q_2 = C (h_3^p - h_2^p) \\quad (5)$$\n\nNext, we eliminate the constant $C$ by taking the ratio of equation ($5$) to equation ($4$). To ensure the ratio is well-defined and positive, particularly for monotonic convergence where the differences $(Q_2 - Q_1)$ and $(Q_3 - Q_2)$ have the same sign, we use absolute values as specified in the problem:\n$$\\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|} = \\frac{|C (h_3^p - h_2^p)|}{|C (h_2^p - h_1^p)|} = \\frac{|h_3^p - h_2^p|}{|h_2^p - h_1^p|}$$\nSince $h_1 < h_2 < h_3$ and $p > 0$ for a converging method, the terms $(h_2^p - h_1^p)$ and $(h_3^p - h_2^p)$ are both positive. Thus, the absolute value signs on the right-hand side can be removed.\nLet's define the grid refinement ratios $r_{21} = h_2/h_1$ and $r_{32} = h_3/h_2$. The equation becomes:\n$$\\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|} = \\frac{h_2^p(r_{32}^p - 1)}{h_1^p(r_{21}^p - 1)} = \\left(\\frac{h_2}{h_1}\\right)^p \\frac{r_{32}^p - 1}{r_{21}^p - 1} = r_{21}^p \\frac{r_{32}^p - 1}{r_{21}^p - 1}$$\n\nThis is the general equation for the observed order of accuracy $p$.\n\n**Special Case: Constant Refinement Ratio**\nIn many practical studies, the grid is refined by a constant factor, i.e., $r_{21} = r_{32} = r$. In this special case, the general equation simplifies significantly. Let $R = \\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|}$.\n$$R = r^p \\frac{r^p - 1}{r^p - 1} = r^p$$\nWe can solve for $p$ by taking the natural logarithm of both sides:\n$$\\ln(R) = \\ln(r^p) = p \\ln(r)$$\n$$p = \\frac{\\ln(R)}{\\ln(r)} = \\frac{\\ln\\left(\\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|}\\right)}{\\ln(r)}$$\n\n**General Case: Unequal Refinement Ratios**\nWhen $r_{21} \\neq r_{32}$, we must solve the general nonlinear equation for $p$:\n$$R = r_{21}^p \\frac{r_{32}^p - 1}{r_{21}^p - 1}$$\nThis equation is not analytically solvable for $p$ in a simple closed form. It must be solved numerically. We can rearrange it into a root-finding problem, $f(p) = 0$:\n$$f(p) = r_{21}^p (r_{32}^p - 1) - R (r_{21}^p - 1) = 0$$\nUsing $h_3 = r_{32}h_2 = r_{32}r_{21}h_1$, we can rewrite the terms with a common base:\n$$f(p) = (r_{21}r_{32})^p - r_{21}^p - R(r_{21}^p - 1) = \\left(\\frac{h_3}{h_1}\\right)^p - (1+R)\\left(\\frac{h_2}{h_1}\\right)^p + R = 0$$\nA numerical root-finding algorithm, such as Brent's method, can be applied to this function to find the value of $p$. A suitable search interval for $p$ (e.g., $[0.1, 8]$) is typically used, as common numerical methods have orders of accuracy in this range.\n\n### Calculation of the Grid Convergence Index (GCI)\n\nThe GCI is an estimate of the fractional numerical uncertainty in the solution. The problem provides the formulas to be used, which are standard in the field. With a fixed safety factor $F_s = 1.25$, the GCIs for the fine-medium grid pair ($1,2$) and the medium-coarse grid pair ($2,3$) are:\n$$\\mathrm{GCI}_{21} = F_s \\,\\frac{\\left|Q_2 - Q_1\\right|}{\\left|Q_1\\right|\\left(r_{21}^p - 1\\right)}$$\n$$\\mathrm{GCI}_{32} = F_s \\,\\frac{\\left|Q_3 - Q_2\\right|}{\\left|Q_2\\right|\\left(r_{32}^p - 1\\right)}$$\nOnce the order of accuracy $p$ is determined from the three-grid data, these indices can be calculated directly. The values are dimensionless and reported as decimal fractions.\n\n### Algorithmic Procedure\n\nThe computational procedure for each test case is as follows:\n1.  Given $(h_1, h_2, h_3)$ and $(Q_1, Q_2, Q_3)$, compute the grid refinement ratios $r_{21} = h_2/h_1$ and $r_{32} = h_3/h_2$.\n2.  Compute the ratio of the solution differences, $R = |Q_3 - Q_2|/|Q_2 - Q_1|$.\n3.  Compare $r_{21}$ and $r_{32}$.\n    - If they are equal (within a small numerical tolerance), calculate $p$ using the simplified logarithmic formula: $p = \\ln(R) / \\ln(r_{21})$.\n    - If they are unequal, solve the nonlinear equation $f(p) = (h_3/h_1)^p - (1+R)(h_2/h_1)^p + R = 0$ for $p$ using a numerical root-finding algorithm.\n4.  Using the computed value of $p$, calculate $\\mathrm{GCI}_{21}$ and $\\mathrm{GCI}_{32}$ using their respective formulas.\n5.  Return the triplet $[p, \\mathrm{GCI}_{21}, \\mathrm{GCI}_{32}]$.\nThis procedure is implemented for each of the five test cases provided.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Solves the grid convergence problem for all test cases.\n    \"\"\"\n    \n    # Safety factor for GCI calculation\n    F_s = 1.25\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1: r=2, p=2\n        {'h': (0.01, 0.02, 0.04), 'Q': (1.00005, 1.0002, 1.0008)},\n        # Case 2: r=2, non-integer p\n        {'h': (0.02, 0.04, 0.08), 'Q': (1.9994343146, 1.9984, 1.9954745166)},\n        # Case 3: r=2, near-asymptotic\n        {'h': (0.01, 0.02, 0.04), 'Q': (0.80003005, 0.8001204, 0.8004832)},\n        # Case 4: r=2, small differences\n        {'h': (0.001, 0.002, 0.004), 'Q': (1.5000001, 1.5000004, 1.5000016)},\n        # Case 5: unequal refinement ratios\n        {'h': (0.01, 0.015, 0.027), 'Q': (0.7500159247, 0.7500388040, 0.7501413000)},\n    ]\n\n    def process_case(h_vals, Q_vals):\n        \"\"\"\n        Calculates p, GCI_21, and GCI_32 for a single case.\n        \n        Args:\n            h_vals (tuple): Grid spacings (h1, h2, h3).\n            Q_vals (tuple): Scalar solutions (Q1, Q2, Q3).\n            \n        Returns:\n            list: A list containing [p, GCI_21, GCI_32].\n        \"\"\"\n        h1, h2, h3 = h_vals\n        q1, q2, q3 = Q_vals\n\n        # Calculate refinement ratios\n        r21 = h2 / h1\n        r32 = h3 / h2\n\n        # Calculate differences in solutions\n        # A small epsilon is added to the denominator to prevent division by zero,\n        # though not strictly necessary for the given test cases.\n        dq21 = q2 - q1\n        dq32 = q3 - q2\n        \n        if np.isclose(dq21, 0):\n            # This case indicates either perfect solution or insufficient precision.\n            # p cannot be determined. This is an invalid state for this problem's context.\n            # Returning NaNs or raising an error would be appropriate.\n            # For this problem, we assume dq21 is never zero.\n            pass\n            \n        R = abs(dq32 / dq21)\n\n        # Determine the order of accuracy, p\n        if np.isclose(r21, r32):\n            # Special case: constant refinement ratio\n            # p = ln(|(Q3-Q2)/(Q2-Q1)|) / ln(r)\n            p = np.log(R) / np.log(r21)\n        else:\n            # General case: unequal refinement ratios\n            # Solve the nonlinear equation for p:\n            # (h3/h1)^p - (1+R)*(h2/h1)^p + R = 0\n            \n            r31 = h3 / h1 # This is also r21 * r32\n            \n            # The function to find the root of\n            def p_equation(p_var):\n                return r31**p_var - (1.0 + R) * r21**p_var + R\n\n            # Find the root for p > 0.\n            # We use a bracket that avoids the trivial p=0 root.\n            try:\n                sol = root_scalar(p_equation, bracket=[0.1, 8.0], method='brentq')\n                p = sol.root\n            except ValueError:\n                # If no root is found in the bracket, something is wrong.\n                # This may happen with non-monotonic convergence.\n                p = np.nan\n\n        # Calculate Grid Convergence Indices (GCI)\n        if (r21**p - 1.0) == 0.0:\n            gci21 = np.inf\n        else:\n            gci21 = F_s * abs(dq21) / (abs(q1) * (r21**p - 1.0))\n        \n        if (r32**p - 1.0) == 0.0:\n            gci32 = np.inf\n        else:\n            gci32 = F_s * abs(dq32) / (abs(q2) * (r32**p - 1.0))\n\n        return [p, gci21, gci32]\n\n    all_results = []\n    for case in test_cases:\n        result = process_case(case['h'], case['Q'])\n        all_results.append(result)\n\n    # Format the output string to be a compact representation of a list of lists,\n    # with no spaces, as suggested by the problem's output format example.\n    output_str = repr(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}