{
    "hands_on_practices": [
        {
            "introduction": "环境模型的核心是求解偏微分方程，而数值方法通常通过离散化来近似导数。这项练习  让您亲手计算一个简单的前向差分公式所产生的截断误差。通过这个具体的例子，您将直观地理解离散化误差的来源，这是理解和分析复杂模型中数值误差的基础。",
            "id": "2224228",
            "problem": "在数值方法中，函数在某一点的导数可以使用有限差分公式来估计。向前差分公式使用一个小的步长 $h$，为函数 $f(x)$ 在点 $x$ 处的一阶导数提供了一个近似值，其表达式为：\n$$\nf'(x) \\approx \\frac{f(x+h) - f(x)}{h}\n$$\n截断误差定义为导数的真实值与通过数值近似得到的值之间的绝对差。\n\n考虑函数 $f(x) = \\exp(2x)$。您的任务是，当使用步长为 $h=0.1$ 的向前差分公式来近似导数 $f'(x)$ 在点 $x=0$ 处的值时，计算其截断误差。\n\n将您的最终答案四舍五入到四位有效数字。",
            "solution": "我们需要计算函数 $f(x)=\\exp(2x)$ 在 $x=0$ 处，使用步长 $h=0.1$ 的向前差分近似其导数时产生的截断误差。向前差分近似为\n$$\nf'(x) \\approx \\frac{f(x+h)-f(x)}{h}.\n$$\n截断误差是真实导数与近似值之间的绝对差：\n$$\n\\text{TE}=\\left|f'(x)-\\frac{f(x+h)-f(x)}{h}\\right|.\n$$\n对于 $f(x)=\\exp(2x)$，其精确导数为\n$$\nf'(x)=2\\exp(2x),\n$$\n因此在 $x=0$ 处，\n$$\nf'(0)=2\\exp(0)=2.\n$$\n在 $x=0$ 处，步长 $h=0.1$ 的向前差分近似为\n$$\n\\frac{f(0.1)-f(0)}{0.1}=\\frac{\\exp(2\\cdot 0.1)-\\exp(0)}{0.1}=\\frac{\\exp(0.2)-1}{0.1}=10\\left(\\exp(0.2)-1\\right).\n$$\n因此，截断误差为\n$$\n\\text{TE}=\\left|2-10\\left(\\exp(0.2)-1\\right)\\right|.\n$$\n进行数值计算，\n$$\n\\exp(0.2)\\approx 1.2214027581601699,\n$$\n所以\n$$\n10\\left(\\exp(0.2)-1\\right)\\approx 10\\cdot 0.2214027581601699=2.214027581601699,\n$$\n因此\n$$\n\\text{TE}\\approx |2-2.214027581601699|=0.214027581601699.\n$$\n四舍五入到四位有效数字，得到\n$$\n0.2140.\n$$",
            "answer": "$$\\boxed{0.2140}$$"
        },
        {
            "introduction": "在认识到截断误差的存在后，下一步便是学习如何估计并减小它。这项实践  将引导您推导并应用理查森外推法（Richardson Extrapolation）。这是一种强大的技术，它利用来自不同分辨率网格的模拟结果，不仅能够估计截断误差，还能计算出更高精度的解，是提升模型预测准确性的关键工具。",
            "id": "3927311",
            "problem": "在一个由稳态平流-扩散偏微分方程（PDE）控制的一维河口通道模型中，一个我们感兴趣的标量诊断量（记为 $J$）是通过在间距为 $\\Delta x$ 的均匀网格上进行二阶精度空间离散化得到的数值解来计算的。假设该方法是一致的，并且在渐进网格加密区域，该诊断量满足误差展开式 $J(\\Delta x) = J^{\\ast} + \\text{TE}(\\Delta x)$，其中 $J^{\\ast}$ 是精确（连续统）的诊断量，而截断误差 $\\text{TE}(\\Delta x)$ 由于二阶精度，具有一个以 $\\Delta x$ 的偶数次幂展开、从 $\\Delta x^{2}$ 阶开始的光滑类泰勒渐进级数。从一致性和精度阶的核心定义出发，并使用渐进误差展开式作为基本依据，回答以下问题：\n1) 使用在网格间距 $\\Delta x$ 和 $\\Delta x/2$ 下的两次模拟，通过消除主阶截断误差项，推导一个 $J^{\\ast}$ 的理查森外推估计量 $J_{R}$ 的闭式表达式，该估计量比原始的二阶格式具有更高的精度阶。\n2) 证明差值 $J(\\Delta x/2) - J(\\Delta x)$ 如何为更精细网格诊断量 $J(\\Delta x/2)$ 的截断误差大小提供一个主阶估计量，并明确推导比例常数。\n3) 一个近岸海洋应用使用相同的二阶格式在两个网格间距下，得到了以下数值计算的地表热通量诊断量（单位为瓦特/平方米）：$J(\\Delta x) = 1.372 \\times 10^{-3}$ 和 $J(\\Delta x/2) = 1.401 \\times 10^{-3}$。使用你推导的公式，计算理查森外推估计值 $J_{R}$ 和 $J(\\Delta x/2)$ 的主阶绝对截断误差估计值。将最终数值结果四舍五入至四位有效数字。以瓦特/平方米为单位表示最终答案，并将其报告为行向量 $\\big[ J_{R}, \\widehat{E}_{\\Delta x/2} \\big]$。",
            "solution": "问题陈述已经过严格验证，并被认为是科学上可靠、适定且自洽的。它提出了一个数值分析中的标准且可形式化的问题，特别是关于离散化偏微分方程的误差估计和通过理查森外推法加速收敛。所有提供的信息都是一致且足以推导出唯一解的。\n\n问题的核心在于给定的数值计算诊断量 $J(\\Delta x)$ 的渐进误差展开式，该诊断量由一个二阶精度格式获得。该展开式被表述为网格间距 $\\Delta x$ 的偶数次幂级数：\n$$\nJ(\\Delta x) = J^{\\ast} + c_{2}(\\Delta x)^2 + c_{4}(\\Delta x)^4 + c_{6}(\\Delta x)^6 + \\dots\n$$\n此处，$J^{\\ast}$ 代表在连续统极限 ($\\Delta x \\to 0$) 下诊断量的精确值，$c_{2}, c_{4}, c_{6}, \\dots$ 是与 $\\Delta x$ 无关的常数。项 $c_{2}(\\Delta x)^2$ 是主阶截断误差，与二阶精度方法一致。\n\n1) 理查森外推估计量 $J_{R}$ 的推导\n\n给定两个数值解，一个使用网格间距 $\\Delta x$ 计算，另一个使用加密的网格间距 $\\Delta x/2$ 计算。我们为两者写出误差展开式：\n$$\nJ(\\Delta x) = J^{\\ast} + c_{2}(\\Delta x)^2 + c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) \\quad (1)\n$$\n$$\nJ(\\frac{\\Delta x}{2}) = J^{\\ast} + c_{2}\\left(\\frac{\\Delta x}{2}\\right)^2 + c_{4}\\left(\\frac{\\Delta x}{2}\\right)^4 + \\mathcal{O}((\\Delta x)^6) = J^{\\ast} + \\frac{1}{4}c_{2}(\\Delta x)^2 + \\frac{1}{16}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) \\quad (2)\n$$\n理查森外推的目标是构造 $J(\\Delta x)$ 和 $J(\\Delta x/2)$ 的一个线性组合，以消除主阶误差项 $c_{2}(\\Delta x)^2$。为此，我们可以将方程(2)乘以4，使其主阶误差项的系数与方程(1)中的相匹配：\n$$\n4 J(\\frac{\\Delta x}{2}) = 4J^{\\ast} + c_{2}(\\Delta x)^2 + \\frac{4}{16}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) = 4J^{\\ast} + c_{2}(\\Delta x)^2 + \\frac{1}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6) \\quad (3)\n$$\n现在，我们从方程(3)中减去方程(1)：\n$$\n4 J(\\frac{\\Delta x}{2}) - J(\\Delta x) = (4J^{\\ast} - J^{\\ast}) + (c_{2}(\\Delta x)^2 - c_{2}(\\Delta x)^2) + (\\frac{1}{4}c_{4}(\\Delta x)^4 - c_{4}(\\Delta x)^4) + \\mathcal{O}((\\Delta x)^6)\n$$\n$$\n4 J(\\frac{\\Delta x}{2}) - J(\\Delta x) = 3J^{\\ast} - \\frac{3}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6)\n$$\n解此代数方程得到 $J^{\\ast}$：\n$$\nJ^{\\ast} = \\frac{4 J(\\frac{\\Delta x}{2}) - J(\\Delta x)}{3} + \\frac{1}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6)\n$$\n理查森外推估计量 $J_{R}$ 定义为此表达式的主项，它提供了 $J^{\\ast}$ 的一个更高阶的估计：\n$$\nJ_{R} = \\frac{4 J(\\frac{\\Delta x}{2}) - J(\\Delta x)}{3}\n$$\n这个新估计量的误差是 $J_{R} - J^{\\ast} = -\\frac{1}{4}c_{4}(\\Delta x)^4 + \\mathcal{O}((\\Delta x)^6)$。由于误差现在与 $(\\Delta x)^4$ 成正比，估计量 $J_{R}$ 是四阶精度的，相较于原始的二阶格式有所改进。\n\n2) $J(\\Delta x/2)$ 的截断误差估计量的推导\n\n目标是估计更精细网格解的截断误差 $E_{\\Delta x/2} = J(\\Delta x/2) - J^{\\ast}$。该误差的主阶项为 $E_{\\Delta x/2} \\approx \\frac{1}{4}c_{2}(\\Delta x)^2$。我们需要使用两个数值解之间的可观测差异 $J(\\Delta x/2) - J(\\Delta x)$ 为此量找到一个表达式。\n\n让我们从方程(1)中减去方程(2)，只保留主阶误差项：\n$$\nJ(\\Delta x) - J(\\frac{\\Delta x}{2}) \\approx (J^{\\ast} + c_{2}(\\Delta x)^2) - (J^{\\ast} + \\frac{1}{4}c_{2}(\\Delta x)^2)\n$$\n$$\nJ(\\Delta x) - J(\\frac{\\Delta x}{2}) \\approx \\frac{3}{4}c_{2}(\\Delta x)^2\n$$\n这使我们能够根据计算值估计未知项 $c_{2}(\\Delta x)^2$：\n$$\nc_{2}(\\Delta x)^2 \\approx \\frac{4}{3}\\left(J(\\Delta x) - J(\\frac{\\Delta x}{2})\\right)\n$$\n更精细网格诊断量 $J(\\Delta x/2)$ 的主阶截断误差是 $E_{\\Delta x/2} \\approx \\frac{1}{4}c_{2}(\\Delta x)^2$。代入我们对 $c_{2}(\\Delta x)^2$ 的估计：\n$$\nE_{\\Delta x/2} \\approx \\frac{1}{4} \\left[ \\frac{4}{3}\\left(J(\\Delta x) - J(\\frac{\\Delta x}{2})\\right) \\right] = \\frac{1}{3}\\left(J(\\Delta x) - J(\\frac{\\Delta x}{2})\\right)\n$$\n这个表达式提供了 $J(\\Delta x/2)$ 的带符号截断误差的主阶估计。题目要求一个基于差值 $J(\\Delta x/2) - J(\\Delta x)$ 的估计量，这得到：\n$$\nE_{\\Delta x/2} \\approx -\\frac{1}{3}\\left(J(\\frac{\\Delta x}{2}) - J(\\Delta x)\\right)\n$$\n因此，截断误差的大小估计为：\n$$\n|E_{\\Delta x/2}| \\approx \\frac{1}{3}\\left|J(\\frac{\\Delta x}{2}) - J(\\Delta x)\\right|\n$$\n这表明差值 $J(\\Delta x/2) - J(\\Delta x)$ 确实可以作为精细网格解截断误差的一个代理，并且将其大小与误差大小关联的比例常数为 $1/3$。\n\n3) 数值计算\n\n我们得到了地表热通量诊断量的以下数值：\n$$\nJ(\\Delta x) = 1.372 \\times 10^{-3} \\, \\text{W m}^{-2}\n$$\n$$\nJ(\\frac{\\Delta x}{2}) = 1.401 \\times 10^{-3} \\, \\text{W m}^{-2}\n$$\n首先，我们使用第(1)部分的公式计算理查森外推估计值 $J_{R}$：\n$$\nJ_{R} = \\frac{4 J(\\frac{\\Delta x}{2}) - J(\\Delta x)}{3} = \\frac{4(1.401 \\times 10^{-3}) - 1.372 \\times 10^{-3}}{3}\n$$\n$$\nJ_{R} = \\frac{(5.604 - 1.372) \\times 10^{-3}}{3} = \\frac{4.232 \\times 10^{-3}}{3} \\approx 1.410666... \\times 10^{-3}\n$$\n四舍五入到四位有效数字，我们得到 $J_{R} = 1.411 \\times 10^{-3}$。\n\n接下来，我们计算 $J(\\Delta x/2)$ 的主阶绝对截断误差估计值，我们将其记为 $\\widehat{E}_{\\Delta x/2}$，使用第(2)部分的公式：\n$$\n\\widehat{E}_{\\Delta x/2} = \\frac{\\left|J(\\frac{\\Delta x}{2}) - J(\\Delta x)\\right|}{3} = \\frac{\\left| (1.401 \\times 10^{-3}) - (1.372 \\times 10^{-3}) \\right|}{3}\n$$\n$$\n\\widehat{E}_{\\Delta x/2} = \\frac{|0.029 \\times 10^{-3}|}{3} = \\frac{0.029 \\times 10^{-3}}{3} \\approx 0.009666... \\times 10^{-3} = 9.666... \\times 10^{-6}\n$$\n四舍五入到四位有效数字，我们得到 $\\widehat{E}_{\\Delta x/2} = 9.667 \\times 10^{-6}$。\n\n最终所求的量，以瓦特/平方米为单位表示，是 $J_R \\approx 1.411 \\times 10^{-3}$ 和 $\\widehat{E}_{\\Delta x/2} \\approx 9.667 \\times 10^{-6}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.411 \\times 10^{-3}  9.667 \\times 10^{-6} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在误差估计的基础上，这项最终实践  将您带入模型验证的标准化流程——计算网格收敛指数（Grid Convergence Index, GCI）。GCI 是一个用于量化由网格分辨率引起的数值不确定性的严谨指标。掌握 GCI 的计算和解读，对于进行可靠的模型验证、增强模拟结果的可信度至关重要，是计算科学家必备的核心技能。",
            "id": "3927276",
            "problem": "您正在一个代表环境和地球系统建模的输运-扩散模拟中，对惰性示踪剂浓度进行建模。考虑一系列间距为 $h_1$、$h_2$、$h_3$ ($h_1  h_2  h_3$) 的嵌套结构化网格，在这些网格上计算一个标量 $Q(h)$。其中，$Q(h)$ 是一个具有物理意义的诊断量，例如以千克/立方米 ($\\mathrm{kg}\\,\\mathrm{m}^{-3}$) 表示的全域平均示踪剂浓度。假设数值方法处于渐近区，因此截断误差随网格间距按幂律缩放：$$Q(h) = Q^\\ast + C\\,h^p + \\mathcal{O}\\!\\left(h^{p+1}\\right),$$ 其中 $Q^\\ast$ 是网格无关解，$C$ 是一个取决于方法和解的正则性的常数，$p$ 是观测到的精度阶数。\n\n从第一性原理出发，使用上述缩放关系来：\n- 从三套网格数据 $(h_1,h_2,h_3)$ 和 $(Q_1,Q_2,Q_3)$（其中 $Q_i = Q(h_i)$）中推导出观测阶数 $p$，方法是消去未知常数 $C$ 和未知的网格无关值 $Q^\\ast$。\n- 使用相同的缩放关系和一个固定的安全因子 $F_s = 1.25$（适用于三套网格的单调收敛研究），计算密-中网格对和中-粗网格对的网格收敛指数 (GCI)。GCI 应报告为无量纲小数（而非百分比），用于量化所报告解在网格对中较密网格上的估算相对不确定度。您的程序必须将密-中网格对的 GCI 处理为 $$\\mathrm{GCI}_{21} = F_s \\,\\frac{\\left|Q_2 - Q_1\\right|}{\\left|Q_1\\right|\\left(r_{21}^p - 1\\right)},$$ 对中-粗网格对也类似 $$\\mathrm{GCI}_{32} = F_s \\,\\frac{\\left|Q_3 - Q_2\\right|}{\\left|Q_2\\right|\\left(r_{32}^p - 1\\right)},$$ 其中 $r_{21} = h_2/h_1$ 且 $r_{32} = h_3/h_2$。\n\n您的程序必须实现一个有原则的流程，利用三套网格数据从截断误差缩放关系中推断 $p$。该流程必须对 $Q_i$ 的正负差异都具有鲁棒性，并在适当之处使用绝对差值以避免观测阶数中的符号模糊性。如果 $r_{21} \\neq r_{32}$，您的程序应求解缩放关系所隐含的非线性方程，而不是假设一个公共的加密比。\n\n物理单位和输出要求：\n- 输入 $Q_i$ 必须解释为单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$ 的示踪剂浓度，网格间距 $h_i$ 的单位必须是米 ($\\mathrm{m}$)。\n- 输出 $p$、$\\mathrm{GCI}_{21}$ 和 $\\mathrm{GCI}_{32}$ 是无量纲的。将 $\\mathrm{GCI}_{21}$ 和 $\\mathrm{GCI}_{32}$ 报告为小数（而非百分比）。\n\n测试套件：\n使用以下五个测试用例，每个用例由单位为米 (m) 的 $(h_1,h_2,h_3)$ 和单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$ 的 $(Q_1,Q_2,Q_3)$ 定义：\n1. 用例 $1$ (公共加密比 $r=2$，单调收敛，二次截断误差): $h_1 = 0.01$, $h_2 = 0.02$, $h_3 = 0.04$; $Q_1 = 1.00005$, $Q_2 = 1.0002$, $Q_3 = 1.0008$.\n2. 用例 $2$ (公共加密比 $r=2$，单调收敛，非整数阶): $h_1 = 0.02$, $h_2 = 0.04$, $h_3 = 0.08$; $Q_1 = 1.9994343146$, $Q_2 = 1.9984$, $Q_3 = 1.9954745166$.\n3. 用例 $3$ (公共加密比 $r=2$，接近渐近，有小的高阶项污染): $h_1 = 0.01$, $h_2 = 0.02$, $h_3 = 0.04$; $Q_1 = 0.80003005$, $Q_2 = 0.8001204$, $Q_3 = 0.8004832$.\n4. 用例 $4$ (公共加密比 $r=2$，极小差异，测试数值鲁棒性): $h_1 = 0.001$, $h_2 = 0.002$, $h_3 = 0.004$; $Q_1 = 1.5000001$, $Q_2 = 1.5000004$, $Q_3 = 1.5000016$.\n5. 用例 $5$ (不等加密比，单调收敛): $h_1 = 0.01$, $h_2 = 0.015$, $h_3 = 0.027$; $Q_1 = 0.7500159247$, $Q_2 = 0.7500388040$, $Q_3 = 0.7501413000$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由逗号分隔的列表，该列表包含五个内部列表，每个内部列表为相应测试用例包含三个浮点数 $[p,\\mathrm{GCI}_{21},\\mathrm{GCI}_{32}]$。总体格式必须严格如下：\n$$\\text{[}[p_1,\\mathrm{GCI}_{21,1},\\mathrm{GCI}_{32,1}], [p_2,\\mathrm{GCI}_{21,2},\\mathrm{GCI}_{32,2}], [p_3,\\mathrm{GCI}_{21,3},\\mathrm{GCI}_{32,3}], [p_4,\\mathrm{GCI}_{21,4},\\mathrm{GCI}_{32,4}], [p_5,\\mathrm{GCI}_{21,5},\\mathrm{GCI}_{32,5}]\\text{]}.$$\n所有数值必须打印为标准的 Python 浮点字面量。不应打印任何额外文本。",
            "solution": "用户提供的问题陈述已经过分析并被认为是有效的。它在科学上基于数值分析以及验证与确认的原理，特别是关于网格收敛性的研究。该问题是适定的、客观的，并包含了推导和计算所要求量所需的所有必要信息。\n\n解决方案分两个阶段进行：首先，有原则地推导观测精度阶数 ($p$) 和网格收敛指数 (GCI) 的公式；其次，在 Python 脚本中实现这些公式以解决给定的测试用例。\n\n### 观测精度阶数 ($p$) 的推导\n\n出发点是假设计算出的标量 $Q(h)$ 的截断误差随网格间距 $h$ 按幂律缩放：\n$$Q(h) = Q^\\ast + C\\,h^p + \\mathcal{O}\\!\\left(h^{p+1}\\right)$$\n此处，$Q^\\ast$ 是精确的网格无关解，$C$ 是一个常数，$p$ 是数值方法的精度阶数。给定在三套间距分别为 $h_1$、$h_2$ 和 $h_3$（其中 $h_1  h_2  h_3$）的网格上计算出的三个解 $Q_1$、$Q_2$ 和 $Q_3$，我们可以通过忽略高阶项 $\\mathcal{O}(h^{p+1})$ 来写出一个包含三个方程的方程组。当网格足够细化以进入渐近区时，这是一种有效的近似。\n\n$$Q_1 \\approx Q^\\ast + C h_1^p \\quad (1)$$\n$$Q_2 \\approx Q^\\ast + C h_2^p \\quad (2)$$\n$$Q_3 \\approx Q^\\ast + C h_3^p \\quad (3)$$\n\n我们的目标是通过消去未知数 $Q^\\ast$ 和 $C$ 来确定 $p$。首先，我们通过连续方程相减来消去 $Q^\\ast$：\n$$Q_2 - Q_1 = C (h_2^p - h_1^p) \\quad (4)$$\n$$Q_3 - Q_2 = C (h_3^p - h_2^p) \\quad (5)$$\n\n接下来，我们通过将方程 ($5$) 与方程 ($4$) 相除来消去常数 $C$。为确保该比值是良定义且为正，特别是在单调收敛的情况下（此时差值 $(Q_2 - Q_1)$ 和 $(Q_3 - Q_2)$ 符号相同），我们按照问题中的规定使用绝对值：\n$$\\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|} = \\frac{|C (h_3^p - h_2^p)|}{|C (h_2^p - h_1^p)|} = \\frac{|h_3^p - h_2^p|}{|h_2^p - h_1^p|}$$\n由于对于一个收敛方法而言 $h_1  h_2  h_3$ 且 $p  0$，因此项 $(h_2^p - h_1^p)$ 和 $(h_3^p - h_2^p)$ 均为正值。因此，右侧的绝对值符号可以去掉。\n我们定义网格加密比 $r_{21} = h_2/h_1$ 和 $r_{32} = h_3/h_2$。方程变为：\n$$\\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|} = \\frac{h_2^p(r_{32}^p - 1)}{h_1^p(r_{21}^p - 1)} = \\left(\\frac{h_2}{h_1}\\right)^p \\frac{r_{32}^p - 1}{r_{21}^p - 1} = r_{21}^p \\frac{r_{32}^p - 1}{r_{21}^p - 1}$$\n\n这就是观测精度阶数 $p$ 的通用方程。\n\n**特殊情况：常数加密比**\n在许多实际研究中，网格以一个常数因子进行加密，即 $r_{21} = r_{32} = r$。在这种特殊情况下，通用方程得到显著简化。令 $R = \\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|}$。\n$$R = r^p \\frac{r^p - 1}{r^p - 1} = r^p$$\n我们可以通过对两边取自然对数来求解 $p$：\n$$\\ln(R) = \\ln(r^p) = p \\ln(r)$$\n$$p = \\frac{\\ln(R)}{\\ln(r)} = \\frac{\\ln\\left(\\frac{|Q_3 - Q_2|}{|Q_2 - Q_1|}\\right)}{\\ln(r)}$$\n\n**一般情况：不等加密比**\n当 $r_{21} \\neq r_{32}$ 时，我们必须求解关于 $p$ 的通用非线性方程：\n$$R = r_{21}^p \\frac{r_{32}^p - 1}{r_{21}^p - 1}$$\n这个方程对于 $p$ 没有简单的闭式解析解。它必须通过数值方法求解。我们可以将其重新排列为一个求根问题，$f(p) = 0$：\n$$f(p) = r_{21}^p (r_{32}^p - 1) - R (r_{21}^p - 1) = 0$$\n使用 $h_3 = r_{32}h_2 = r_{32}r_{21}h_1$，我们可以用一个公共基底重写这些项：\n$$f(p) = (r_{21}r_{32})^p - r_{21}^p - R(r_{21}^p - 1) = \\left(\\frac{h_3}{h_1}\\right)^p - (1+R)\\left(\\frac{h_2}{h_1}\\right)^p + R = 0$$\n可以应用诸如 Brent 方法之类的数值求根算法来求解该函数，以找到 $p$ 的值。通常使用一个合适的 $p$ 的搜索区间（例如 $[0.1, 8]$），因为常见的数值方法的精度阶数都在这个范围内。\n\n### 网格收敛指数 (GCI) 的计算\n\nGCI 是解的相对数值不确定度的一个估计。问题中提供了要使用的公式，这些公式是该领域的标准。对于固定的安全因子 $F_s = 1.25$，密-中网格对 ($1,2$) 和中-粗网格对 ($2,3$) 的 GCI 分别为：\n$$\\mathrm{GCI}_{21} = F_s \\,\\frac{\\left|Q_2 - Q_1\\right|}{\\left|Q_1\\right|\\left(r_{21}^p - 1\\right)}$$\n$$\\mathrm{GCI}_{32} = F_s \\,\\frac{\\left|Q_3 - Q_2\\right|}{\\left|Q_2\\right|\\left(r_{32}^p - 1\\right)}$$\n一旦从三套网格数据中确定了精度阶数 $p$，就可以直接计算这些指数。这些值是无量纲的，并以小数形式报告。\n\n### 算法流程\n\n每个测试用例的计算流程如下：\n1.  给定 $(h_1, h_2, h_3)$ 和 $(Q_1, Q_2, Q_3)$，计算网格加密比 $r_{21} = h_2/h_1$ 和 $r_{32} = h_3/h_2$。\n2.  计算解的差值之比，$R = |Q_3 - Q_2|/|Q_2 - Q_1|$。\n3.  比较 $r_{21}$ 和 $r_{32}$。\n    - 如果它们相等（在小的数值容差范围内），使用简化的对数公式计算 $p$：$p = \\ln(R) / \\ln(r_{21})$。\n    - 如果它们不相等，则使用数值求根算法求解非线性方程 $f(p) = (h_3/h_1)^p - (1+R)(h_2/h_1)^p + R = 0$ 来得到 $p$。\n4.  使用计算出的 $p$ 值，根据各自的公式计算 $\\mathrm{GCI}_{21}$ 和 $\\mathrm{GCI}_{32}$。\n5.  返回三元组 $[p, \\mathrm{GCI}_{21}, \\mathrm{GCI}_{32}]$。\n对所提供的五个测试用例中的每一个都执行此流程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Solves the grid convergence problem for all test cases.\n    \"\"\"\n    \n    # Safety factor for GCI calculation\n    F_s = 1.25\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1: r=2, p=2\n        {'h': (0.01, 0.02, 0.04), 'Q': (1.00005, 1.0002, 1.0008)},\n        # Case 2: r=2, non-integer p\n        {'h': (0.02, 0.04, 0.08), 'Q': (1.9994343146, 1.9984, 1.9954745166)},\n        # Case 3: r=2, near-asymptotic\n        {'h': (0.01, 0.02, 0.04), 'Q': (0.80003005, 0.8001204, 0.8004832)},\n        # Case 4: r=2, small differences\n        {'h': (0.001, 0.002, 0.004), 'Q': (1.5000001, 1.5000004, 1.5000016)},\n        # Case 5: unequal refinement ratios\n        {'h': (0.01, 0.015, 0.027), 'Q': (0.7500159247, 0.7500388040, 0.7501413000)},\n    ]\n\n    def process_case(h_vals, Q_vals):\n        \"\"\"\n        Calculates p, GCI_21, and GCI_32 for a single case.\n        \n        Args:\n            h_vals (tuple): Grid spacings (h1, h2, h3).\n            Q_vals (tuple): Scalar solutions (Q1, Q2, Q3).\n            \n        Returns:\n            list: A list containing [p, GCI_21, GCI_32].\n        \"\"\"\n        h1, h2, h3 = h_vals\n        q1, q2, q3 = Q_vals\n\n        # Calculate refinement ratios\n        r21 = h2 / h1\n        r32 = h3 / h2\n\n        # Calculate differences in solutions\n        # A small epsilon is added to the denominator to prevent division by zero,\n        # though not strictly necessary for the given test cases.\n        dq21 = q2 - q1\n        dq32 = q3 - q2\n        \n        if np.isclose(dq21, 0):\n            # This case indicates either perfect solution or insufficient precision.\n            # p cannot be determined. This is an invalid state for this problem's context.\n            # Returning NaNs or raising an error would be appropriate.\n            # For this problem, we assume dq21 is never zero.\n            pass\n            \n        R = abs(dq32 / dq21)\n\n        # Determine the order of accuracy, p\n        if np.isclose(r21, r32):\n            # Special case: constant refinement ratio\n            # p = ln(|(Q3-Q2)/(Q2-Q1)|) / ln(r)\n            p = np.log(R) / np.log(r21)\n        else:\n            # General case: unequal refinement ratios\n            # Solve the nonlinear equation for p:\n            # (h3/h1)^p - (1+R)*(h2/h1)^p + R = 0\n            \n            r31 = h3 / h1 # This is also r21 * r32\n            \n            # The function to find the root of\n            def p_equation(p_var):\n                return r31**p_var - (1.0 + R) * r21**p_var + R\n\n            # Find the root for p  0.\n            # We use a bracket that avoids the trivial p=0 root.\n            try:\n                sol = root_scalar(p_equation, bracket=[0.1, 8.0], method='brentq')\n                p = sol.root\n            except ValueError:\n                # If no root is found in the bracket, something is wrong.\n                # This may happen with non-monotonic convergence.\n                p = np.nan\n\n        # Calculate Grid Convergence Indices (GCI)\n        if (r21**p - 1.0) == 0.0:\n            gci21 = np.inf\n        else:\n            gci21 = F_s * abs(dq21) / (abs(q1) * (r21**p - 1.0))\n        \n        if (r32**p - 1.0) == 0.0:\n            gci32 = np.inf\n        else:\n            gci32 = F_s * abs(dq32) / (abs(q2) * (r32**p - 1.0))\n\n        return [p, gci21, gci32]\n\n    all_results = []\n    for case in test_cases:\n        result = process_case(case['h'], case['Q'])\n        all_results.append(result)\n\n    # Format the output string to be a compact representation of a list of lists,\n    # with no spaces, as suggested by the problem's output format example.\n    output_str = repr(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}