{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导你逐步完成最著名的龙格-库塔方法 (RK4) 的计算。通过将其应用于一个基本的一阶衰减模型——这在环境科学中常用于模拟被动示踪剂的去除过程——你将具体理解其四个阶段如何协同工作以实现高精度。这个基础性的计算练习是掌握更复杂数值方案的第一步。",
            "id": "3909607",
            "problem": "考虑一个用于经历一阶去除的被动示踪物的均匀混合零维大气箱式模型。根据质量守恒，如果 $M(t)$ 是示踪物质量，且去除速率与 $M(t)$ 成正比，比例系数为常数，则其控制方程为 $dM/dt=-\\lambda M$，其中 $\\lambda>0$ 是去除速率。定义无量纲浓度 $y(t)=M(t)/M(0)$，并使用特征时间尺度 $1/\\lambda$ 对时间进行无量纲化，则演化方程变为 $y'(t)=-y(t)$，初始条件为 $y(0)=1$。从 $t=0$ 到 $t=h$ 应用经典四阶龙格－库塔（RK4）方法的单个显式时间步，步长 $h=1$。使用RK4各阶段的定义和初值问题的积分形式作为起点，通过精确计算四个RK4阶段来计算 $y(h)$。将你的最终答案表示为一个精确值（不进行四舍五入，不带单位）。",
            "solution": "该问题已经过验证，被认为是一个应用于环境科学标准模型的、适定的、有科学依据且自洽的数值分析问题。所有必要信息均已提供，不存在矛盾或含糊之处。\n\n该问题是求解由以下常微分方程（ODE）给出的初值问题（IVP）：\n$$\ny'(t) = -y(t)\n$$\n其初始条件为：\n$$\ny(0) = 1\n$$\n我们被要求应用经典四阶龙格－库塔（RK4）方法的单步来近似求解在时间 $t=h$ 处的解，其中步长为 $h=1$。定义该ODE的函数是 $f(t,y) = -y$。数值积分的起始点是 $(t_0, y_0) = (0, 1)$。\n\nRK4方法单步计算的通用公式，用于将解从时间 $t_n$ 处的 $y_n$推进到时间 $t_{n+1} = t_n + h$ 处的 $y_{n+1}$，其形式如下：\n$$\ny_{n+1} = y_n + \\frac{h}{6} (k_1 + 2k_2 + 2k_3 + k_4)\n$$\n四个阶段 $k_1, k_2, k_3$ 和 $k_4$ 的定义如下：\n$$\n\\begin{aligned}\nk_1 = f(t_n, y_n) \\\\\nk_2 = f\\left(t_n + \\frac{h}{2}, y_n + \\frac{h}{2}k_1\\right) \\\\\nk_3 = f\\left(t_n + \\frac{h}{2}, y_n + \\frac{h}{2}k_2\\right) \\\\\nk_4 = f(t_n + h, y_n + hk_3)\n\\end{aligned}\n$$\n问题要求计算 $y(h)$，这在数值格式中对应于 $y_1$。现在我们对这第一步也是唯一的一步计算四个阶段的值，其中 $n=0$, $t_0=0$, $y_0=1$, 且 $h=1$。\n\n阶段 1:\n$$\nk_1 = f(t_0, y_0) = f(0, 1) = -y_0 = -1\n$$\n\n阶段 2:\n函数的自变量为 $t_0 + \\frac{h}{2} = 0 + \\frac{1}{2} = \\frac{1}{2}$ 和 $y_0 + \\frac{h}{2}k_1 = 1 + \\frac{1}{2}(-1) = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n$$\nk_2 = f\\left(\\frac{1}{2}, \\frac{1}{2}\\right) = -\\frac{1}{2}\n$$\n\n阶段 3:\n自变量为 $t_0 + \\frac{h}{2} = \\frac{1}{2}$ 和 $y_0 + \\frac{h}{2}k_2 = 1 + \\frac{1}{2}\\left(-\\frac{1}{2}\\right) = 1 - \\frac{1}{4} = \\frac{3}{4}$。\n$$\nk_3 = f\\left(\\frac{1}{2}, \\frac{3}{4}\\right) = -\\frac{3}{4}\n$$\n\n阶段 4:\n自变量为 $t_0 + h = 0 + 1 = 1$ 和 $y_0 + hk_3 = 1 + 1\\left(-\\frac{3}{4}\\right) = 1 - \\frac{3}{4} = \\frac{1}{4}$。\n$$\nk_4 = f\\left(1, \\frac{1}{4}\\right) = -\\frac{1}{4}\n$$\n\n现在，我们将这些值代入RK4公式中来计算 $y_1$，它即为我们对 $y(h) = y(1)$ 的近似值。\n$$\ny_1 = y_0 + \\frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\n代入 $y_0=1$，$h=1$ 和已计算出的各阶段的值：\n$$\ny_1 = 1 + \\frac{1}{6}\\left[(-1) + 2\\left(-\\frac{1}{2}\\right) + 2\\left(-\\frac{3}{4}\\right) + \\left(-\\frac{1}{4}\\right)\\right]\n$$\n我们简化方括号内的表达式：\n$$\ny_1 = 1 + \\frac{1}{6}\\left[-1 - 1 - \\frac{3}{2} - \\frac{1}{4}\\right]\n$$\n$$\ny_1 = 1 + \\frac{1}{6}\\left[-2 - \\frac{3}{2} - \\frac{1}{4}\\right]\n$$\n为了合并这些项，我们找到一个公分母，即 $4$：\n$$\ny_1 = 1 + \\frac{1}{6}\\left[-\\frac{8}{4} - \\frac{6}{4} - \\frac{1}{4}\\right]\n$$\n$$\ny_1 = 1 + \\frac{1}{6}\\left[\\frac{-8 - 6 - 1}{4}\\right]\n$$\n$$\ny_1 = 1 + \\frac{1}{6}\\left[-\\frac{15}{4}\\right]\n$$\n$$\ny_1 = 1 - \\frac{15}{24}\n$$\n分数 $\\frac{15}{24}$ 可以通过分子分母同除以它们的最大公约数 $3$ 来进行化简：\n$$\ny_1 = 1 - \\frac{5}{8}\n$$\n$$\ny_1 = \\frac{8}{8} - \\frac{5}{8}\n$$\n$$\ny_1 = \\frac{3}{8}\n$$\n因此，经过一步RK4方法后，在 $t=1$ 处的数值解的精确值为 $\\frac{3}{8}$。",
            "answer": "$$\n\\boxed{\\frac{3}{8}}\n$$"
        },
        {
            "introduction": "许多环境系统，例如大气化学反应，涉及以截然不同的速率发生的过程，这导致了对标准显式方法构成挑战的“刚性”（stiff）方程。本练习介绍了一种强大的技术——隐式-显式 (IMEX) 方法，它对快速（刚性）部分进行隐式处理，对慢速（非刚性）部分进行显式处理。通过对一个可逆化学反应模型应用 IMEX 格式，你将亲手实践如何分离系统的不同部分，并了解这种混合方法如何在保持稳定性的同时有效管理计算成本。",
            "id": "3909517",
            "problem": "考虑一个在恒温恒压下建模的充分混合大气包裹中的可逆化学反应，其中物种 $A$ 转化为物种 $B$ 并可逆，写作 $A \\rightleftharpoons B$。根据质量作用定律，并假设总浓度 $C_{\\mathrm{tot}}$ 守恒，物种 $A$ 的浓度 $A(t)$ 满足常微分方程 $dA/dt = -k_f A + k_b (C_{\\mathrm{tot}} - A)$，其中 $k_f$ 是正向反应速率常数，$k_b$ 是逆向反应速率常数。在一个隐式-显式（IMEX）龙格-库塔（RK）时间积分中，将刚性正向反应项视为隐式分量 $f(A) = -k_f A$，非刚性逆向反应项视为显式分量 $g(A) = k_b (C_{\\mathrm{tot}} - A)$。\n\n使用一个两阶段、二阶的对角隐式龙格-库塔 IMEX 格式，其系数如下：\n- 隐式系数 $\\tilde{A} = \\begin{pmatrix} \\tfrac{1}{2}  0 \\\\ \\tfrac{1}{2}  \\tfrac{1}{2} \\end{pmatrix}$，$\\tilde{b} = \\begin{pmatrix} \\tfrac{1}{2}  \\tfrac{1}{2} \\end{pmatrix}$，$\\tilde{c} = \\begin{pmatrix} \\tfrac{1}{2}  1 \\end{pmatrix}$，\n- 显式系数 $A = \\begin{pmatrix} 0  0 \\\\ \\tfrac{1}{2}  0 \\end{pmatrix}$，$b = \\begin{pmatrix} \\tfrac{1}{2}  \\tfrac{1}{2} \\end{pmatrix}$，$c = \\begin{pmatrix} 0  \\tfrac{1}{2} \\end{pmatrix}$，\n\n从时间 $t^n$ 时的已知浓度 $A^n$ 开始，在单个时间步长 $\\Delta t$ 内计算 $A(t)$ 的一个 IMEX RK 步骤。该步骤包含两个阶段，其隐式和显式计算由这些系数定义。取参数\n$A^n = 1.5 \\times 10^{-6}$，$C_{\\mathrm{tot}} = 2.0 \\times 10^{-6}$，$k_f = 3.0 \\times 10^{3}$，$k_b = 5.0$，以及 $\\Delta t = 1.0 \\times 10^{-2}$，其中所有浓度单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$，时间单位为 $\\mathrm{s}$。\n\n从第一性原理推导该格式定义和质量作用动力学所蕴含的阶段方程，求解隐式阶段以获得阶段浓度，评估显式部分的贡献，并组合最终更新以得到 $A^{n+1}$。用 $\\mathrm{mol \\cdot m^{-3}}$ 单位表示你对 $A^{n+1}$ 的最终数值答案，并将其四舍五入到六位有效数字。",
            "solution": "问题陈述被认定为有效。其科学基础是质量作用动力学和刚性常微分方程（ODE）的数值分析，这是环境建模中的一个标准课题。该问题是适定的，提供了一套完整且一致的数据、方程和数值方法规范，足以计算出唯一解。其语言客观且无歧义。未检测到任何缺陷。\n\n问题要求对由以下常微分方程支配的物种 $A$ 的浓度，计算一个隐式-显式（IMEX）龙格-库塔（RK）方法的单步时间积分：\n$$\n\\frac{dA}{dt} = -k_f A + k_b (C_{\\mathrm{tot}} - A)\n$$\n方程右边被分解为一个隐式部分 $f(A) = -k_f A$ 和一个显式部分 $g(A) = k_b (C_{\\mathrm{tot}} - A)$。\n\n该 IMEX RK 格式是一个由给定的布卓表（Butcher tableaux）定义的两阶段方法。对于一个系统 $y' = f(y) + g(y)$，这类可加性龙格-库塔（ARK）方法的一般阶段方程为：\n$$\nK_i = A^n + \\Delta t \\sum_{j=1}^{i-1} a_{ij} g(K_j) + \\Delta t \\sum_{j=1}^{i} \\tilde{a}_{ij} f(K_j)\n$$\n最终更新为：\n$$\nA^{n+1} = A^n + \\Delta t \\sum_{i=1}^{s} b_i g(K_i) + \\Delta t \\sum_{i=1}^{s} \\tilde{b}_i f(K_i)\n$$\n此处，$s=2$ 是阶段数。系数 $a_{ij}$ 来自显式表 $A$，系数 $\\tilde{a}_{ij}$ 来自隐式表 $\\tilde{A}$。\n\n给定的系数为：\n隐式：$\\tilde{A} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix}$，$\\tilde{b} = \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix}^T$\n显式：$A = \\begin{pmatrix} 0  0 \\\\ \\frac{1}{2}  0 \\end{pmatrix}$，$b = \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix}^T$\n\n参数值为：\n$A^n = 1.5 \\times 10^{-6} \\, \\mathrm{mol \\cdot m^{-3}}$\n$C_{\\mathrm{tot}} = 2.0 \\times 10^{-6} \\, \\mathrm{mol \\cdot m^{-3}}$\n$k_f = 3.0 \\times 10^{3} \\, \\mathrm{s}^{-1}$\n$k_b = 5.0 \\, \\mathrm{s}^{-1}$\n$\\Delta t = 1.0 \\times 10^{-2} \\, \\mathrm{s}$\n\n我们现在推导并求解阶段方程。\n\n**阶段 1 ($i=1$):**\n第一阶段 $K_1$ 的方程为：\n$$\nK_1 = A^n + \\Delta t \\sum_{j=1}^{0} a_{1j} g(K_j) + \\Delta t \\sum_{j=1}^{1} \\tilde{a}_{1j} f(K_j)\n$$\n第一个求和为空。从表中可知，$\\tilde{a}_{11} = \\frac{1}{2}$。\n$$\nK_1 = A^n + \\Delta t \\tilde{a}_{11} f(K_1) = A^n + \\frac{\\Delta t}{2} f(K_1)\n$$\n代入 $f(K_1) = -k_f K_1$：\n$$\nK_1 = A^n - \\frac{\\Delta t k_f}{2} K_1\n$$\n这是一个关于 $K_1$ 的隐式方程，我们用代数方法求解：\n$$\nK_1 \\left(1 + \\frac{\\Delta t k_f}{2}\\right) = A^n \\implies K_1 = \\frac{A^n}{1 + \\frac{\\Delta t k_f}{2}}\n$$\n我们计算分母的值：\n$$\n1 + \\frac{\\Delta t k_f}{2} = 1 + \\frac{(1.0 \\times 10^{-2}) \\cdot (3.0 \\times 10^{3})}{2} = 1 + \\frac{30}{2} = 1 + 15 = 16\n$$\n现在，我们计算 $K_1$：\n$$\nK_1 = \\frac{1.5 \\times 10^{-6}}{16} = 0.09375 \\times 10^{-6} = 9.375 \\times 10^{-8} \\, \\mathrm{mol \\cdot m^{-3}}\n$$\n\n**阶段 2 ($i=2$):**\n第二阶段 $K_2$ 的方程为：\n$$\nK_2 = A^n + \\Delta t \\sum_{j=1}^{1} a_{2j} g(K_j) + \\Delta t \\sum_{j=1}^{2} \\tilde{a}_{2j} f(K_j)\n$$\n从表中可知，$a_{21} = \\frac{1}{2}$，$\\tilde{a}_{21} = \\frac{1}{2}$，以及 $\\tilde{a}_{22} = \\frac{1}{2}$。\n$$\nK_2 = A^n + \\Delta t \\, a_{21} g(K_1) + \\Delta t (\\tilde{a}_{21} f(K_1) + \\tilde{a}_{22} f(K_2))\n$$\n$$\nK_2 = A^n + \\frac{\\Delta t}{2} g(K_1) + \\frac{\\Delta t}{2} f(K_1) + \\frac{\\Delta t}{2} f(K_2)\n$$\n代入 $f(K_2) = -k_f K_2$：\n$$\nK_2 = A^n + \\frac{\\Delta t}{2} (g(K_1) + f(K_1)) - \\frac{\\Delta t k_f}{2} K_2\n$$\n求解 $K_2$：\n$$\nK_2 \\left(1 + \\frac{\\Delta t k_f}{2}\\right) = A^n + \\frac{\\Delta t}{2} (g(K_1) + f(K_1))\n$$\n$$\nK_2 = \\frac{A^n + \\frac{\\Delta t}{2} (g(K_1) + f(K_1))}{1 + \\frac{\\Delta t k_f}{2}}\n$$\n我们需要计算 $f(K_1)$ 和 $g(K_1)$：\n$$\nf(K_1) = -k_f K_1 = -(3.0 \\times 10^{3}) \\cdot (9.375 \\times 10^{-8}) = -2.8125 \\times 10^{-4}\n$$\n$$\ng(K_1) = k_b (C_{\\mathrm{tot}} - K_1) = 5.0 \\cdot (2.0 \\times 10^{-6} - 9.375 \\times 10^{-8}) = 5.0 \\cdot (1.90625 \\times 10^{-6}) = 9.53125 \\times 10^{-6}\n$$\n现在计算 $K_2$ 的分子：\n$$\n\\frac{\\Delta t}{2} (g(K_1) + f(K_1)) = \\frac{1.0 \\times 10^{-2}}{2} (9.53125 \\times 10^{-6} - 2.8125 \\times 10^{-4}) \\\\\n= (5.0 \\times 10^{-3}) (9.53125 \\times 10^{-6} - 281.25 \\times 10^{-6}) \\\\\n= (5.0 \\times 10^{-3}) (-271.71875 \\times 10^{-6}) = -1.35859375 \\times 10^{-6}\n$$\n$$\nA^n + \\frac{\\Delta t}{2} (g(K_1) + f(K_1)) = 1.5 \\times 10^{-6} - 1.35859375 \\times 10^{-6} = 0.14140625 \\times 10^{-6}\n$$\n分母是 $16$。所以，我们求得 $K_2$：\n$$\nK_2 = \\frac{0.14140625 \\times 10^{-6}}{16} = 0.008837890625 \\times 10^{-6} = 8.837890625 \\times 10^{-9} \\, \\mathrm{mol \\cdot m^{-3}}\n$$\n\n**最终更新：**\n最终浓度 $A^{n+1}$ 由下式给出：\n$$\nA^{n+1} = A^n + \\Delta t \\sum_{i=1}^{2} b_i g(K_i) + \\Delta t \\sum_{i=1}^{2} \\tilde{b}_i f(K_i)\n$$\n当 $b_1=b_2=\\frac{1}{2}$ 且 $\\tilde{b}_1=\\tilde{b}_2=\\frac{1}{2}$ 时：\n$$\nA^{n+1} = A^n + \\frac{\\Delta t}{2} (g(K_1) + g(K_2)) + \\frac{\\Delta t}{2} (f(K_1) + f(K_2))\n$$\n我们已有 $f(K_1)$ 和 $g(K_1)$。我们需要计算 $f(K_2)$ 和 $g(K_2)$：\n$$\nf(K_2) = -k_f K_2 = -(3.0 \\times 10^{3}) \\cdot (8.837890625 \\times 10^{-9}) = -2.6513671875 \\times 10^{-5}\n$$\n$$\ng(K_2) = k_b(C_{\\mathrm{tot}} - K_2) = 5.0 \\cdot (2.0 \\times 10^{-6} - 8.837890625 \\times 10^{-9}) \\\\\n= 5.0 \\cdot (1.991162109375 \\times 10^{-6}) = 9.955810546875 \\times 10^{-6}\n$$\n现在，组合最终的更新。\n$$\nA^{n+1} = A^n + \\frac{\\Delta t}{2} \\left[ (g(K_1)+f(K_1)) + (g(K_2)+f(K_2)) \\right]\n$$\n显式项之和：\n$$\n\\frac{\\Delta t}{2} (g(K_1) + g(K_2)) = (5.0 \\times 10^{-3}) (9.53125 \\times 10^{-6} + 9.955810546875 \\times 10^{-6}) \\\\\n= (5.0 \\times 10^{-3}) (19.487060546875 \\times 10^{-6}) = 0.097435302734375 \\times 10^{-6}\n$$\n隐式项之和：\n$$\n\\frac{\\Delta t}{2} (f(K_1) + f(K_2)) = (5.0 \\times 10^{-3}) (-2.8125 \\times 10^{-4} - 2.6513671875 \\times 10^{-5}) \\\\\n= (5.0 \\times 10^{-3}) (-28.125 \\times 10^{-5} - 2.6513671875 \\times 10^{-5}) \\\\\n= (5.0 \\times 10^{-3}) (-30.7763671875 \\times 10^{-5}) = -1.538818359375 \\times 10^{-6}\n$$\n最后，将所有部分组合起来得到 $A^{n+1}$：\n$$\nA^{n+1} = 1.5 \\times 10^{-6} + 0.097435302734375 \\times 10^{-6} - 1.538818359375 \\times 10^{-6} \\\\\nA^{n+1} = (1.5 + 0.097435302734375 - 1.538818359375) \\times 10^{-6} \\\\\nA^{n+1} = 0.058616943359375 \\times 10^{-6} = 5.8616943359375 \\times 10^{-8}\n$$\n问题要求答案四舍五入到六位有效数字。\n$$\nA^{n+1} \\approx 5.86169 \\times 10^{-8} \\, \\mathrm{mol \\cdot m^{-3}}\n$$",
            "answer": "$$\n\\boxed{5.86169 \\times 10^{-8}}\n$$"
        },
        {
            "introduction": "现代常微分方程（ODE）求解器如何同时实现效率和准确性？答案通常在于自适应步长控制。本练习将让你通过实现 Dormand-Prince 5(4) 方法的单步计算，深入了解自适应求解器的核心引擎。你将使用一个嵌入式龙格-库塔对来计算两个不同阶的解，从而估计局部截断误差，并基于设定的容差决定是接受还是拒绝该时间步。这个过程模拟了复杂建模工具中实现高效和可靠积分的关键逻辑。",
            "id": "3909540",
            "problem": "考虑一个无量纲标量状态的显式初值问题，其灵感来源于环境和地球系统建模中的一个充分混合箱式模型，其中浓度由于双分子反应而呈二次衰减：求解满足 $y'(t) = -y(t)^2$ 且 $y(0) = 1$ 的 $y(t)$。你的任务是，从 $t=0$ 和 $y(0)=1$ 开始，在大小为 $h$ 的单个步长上，实现 Dormand–Prince $5(4)$ 阶嵌入式显式 Runge–Kutta 方法的一个自适应步长。该步长必须计算两个数值近似解：一个 5 阶的高阶估计值 $y_5$ 和一个 4 阶的低阶估计值 $y_4$，使用标准的 Dormand–Prince $5(4)$ 系数。然后，构建标量误差估计 $\\Delta = y_5 - y_4$，并用它来计算缩放误差范数\n$$\n\\varepsilon = \\frac{|\\Delta|}{a_{\\mathrm{tol}} + r_{\\mathrm{tol}} \\max\\{|y(0)|, |y_5|\\}},\n$$\n其中 $a_{\\mathrm{tol}}$ 是绝对容差，$r_{\\mathrm{tol}}$ 是相对容差。当且仅当 $\\varepsilon \\le 1$ 时接受该步长；否则，拒绝该步长。所有量都是无量纲的，因此不需要物理单位。\n\n从初值问题 $y'(t) = f(t,y)$ 的基本定义和带有嵌入对的显式 Runge–Kutta 方法的概念开始（不提供快捷公式）。Dormand–Prince $5(4)$ 系数被广泛使用，并构成了一个经过充分测试的数值方案；你必须使用该对的标准系数从各阶段计算 $y_5$ 和 $y_4$。此处的函数 $f(t,y)$ 是 $f(t,y) = -y^2$。\n\n实现一个完整、可运行的程序，该程序：\n- 对于每个测试用例，计算单步估计值 $y_5$、$y_4$、误差估计 $\\Delta$、缩放误差范数 $\\varepsilon$ 以及基于 $\\varepsilon \\le 1$ 的接受决策。\n- 生成单行输出，将所有测试用例的结果聚合为一个用方括号括起来的逗号分隔列表，其中每个测试用例的结果是列表 $[\\Delta,\\varepsilon,\\mathrm{accept}]$，其中 $\\Delta$ 和 $\\varepsilon$ 是浮点数，$\\mathrm{accept}$ 是布尔值。\n\n使用以下测试套件，它涵盖了一个典型情况、一个严格容差情况、一个仅绝对容差情况，以及一个大步长的宽松容差情况：\n- 情况 A：$h = 0.05$，$a_{\\mathrm{tol}} = 10^{-9}$，$r_{\\mathrm{tol}} = 10^{-7}$。\n- 情况 B：$h = 1.0$，$a_{\\mathrm{tol}} = 10^{-6}$，$r_{\\mathrm{tol}} = 10^{-3}$。\n- 情况 C（仅绝对容差缩放）：$h = 0.5$，$a_{\\mathrm{tol}} = 10^{-6}$，$r_{\\mathrm{tol}} = 0$。\n- 情况 D（宽松容差，大步长）：$h = 2.5$，$a_{\\mathrm{tol}} = 10^{-2}$，$r_{\\mathrm{tol}} = 10^{-1}$。\n\n你的程序应生成单行输出，包含四个情况的结果，格式如下\n$$\n[[\\Delta_A,\\varepsilon_A,\\mathrm{accept}_A],[\\Delta_B,\\varepsilon_B,\\mathrm{accept}_B],[\\Delta_C,\\varepsilon_C,\\mathrm{accept}_C],[\\Delta_D,\\varepsilon_D,\\mathrm{accept}_D]],\n$$\n其中每个符号对应于相应的情况，并且所有数学条目都由程序输出中的数值表示。",
            "solution": "该问题是适定的且科学上合理的，其基础是常微分方程（ODE）数值分析的基本原理。我们将进行形式化的求解。\n\n该任务是为由以下常微分方程给出的显式初值问题（IVP）执行一个自适应步长：\n$$\ny'(t) = -y(t)^2, \\quad y(0) = 1\n$$\n该方程具有一般形式 $y'(t) = f(t, y(t))$，其中 $f(t,y) = -y^2$。初始条件为 $(t_0, y_0) = (0, 1)$。我们将采用一种嵌入式显式 Runge-Kutta 方法，特别是 Dormand-Prince $5(4)$ 对，来计算解的估计值，并根据计算出的误差范数决定是否接受该步长。\n\n对于一个自治常微分方程 $y' = f(y)$，一个具有 $s$ 个阶段的显式 Runge-Kutta (ERK) 方法使用以下计算序列将解从时间 $t_n$ 的 $y_n$ 推进到时间 $t_{n+1} = t_n + h$ 的 $y_{n+1}$：\n$$\nk_1 = f(y_n) \\\\\nk_2 = f(y_n + h a_{21} k_1) \\\\\n\\vdots \\\\\nk_s = f\\left(y_n + h \\sum_{j=1}^{s-1} a_{sj} k_j\\right)\n$$\n然后，新的解估计值由这些阶段导数的加权平均形成：\n$$\ny_{n+1} = y_n + h \\sum_{i=1}^s b_i k_i\n$$\n非自治情况 $y' = f(t,y)$ 是一个直接的扩展。系数 $c_i = \\sum_{j=1}^{i-1} a_{ij}$、$a_{ij}$ 和 $b_i$ 定义了具体的方法，并且通常被组织在 Butcher tableau 中。\n\n一个嵌入式 ERK 方法，或称 Runge-Kutta 对，使用同一组阶段值 $k_i$ 来计算两个不同阶的近似值，$p$ 和 $\\hat{p}  p$。\n$$\ny_{n+1} = y_n + h \\sum_{i=1}^s b_i k_i \\quad (\\text{阶为 } p) \\\\\n\\hat{y}_{n+1} = y_n + h \\sum_{i=1}^s \\hat{b}_i k_i \\quad (\\text{阶为 } \\hat{p})\n$$\n这两个估计值之间的差提供了一种计算成本低廉的方法来估计低阶方法的局部截断误差：\n$$\n\\Delta = y_{n+1} - \\hat{y}_{n+1} = h \\sum_{i=1}^s (b_i - \\hat{b}_i) k_i = h \\sum_{i=1}^s e_i k_i\n$$\n其中 $e_i = b_i - \\hat{b}_i$ 是误差系数。\n\n问题指定了 Dormand-Prince $5(4)$ 方法，这是一个著名的 $s=7$ 阶嵌入对，它提供了一个 5 阶精度的解 $y_5$ 和一个 4 阶精度的解 $y_4$。标准系数如下：\n节点 $c_i$ 是：\n$$\nc = [0, 1/5, 3/10, 4/5, 8/9, 1, 1]^T\n$$\n5 阶解 $y_5$ 的权重是：\n$$\nb = [35/384, 0, 500/1113, 125/192, -2187/6784, 11/84, 0]^T\n$$\n$\\Delta = y_5-y_4$ 的误差系数是：\n$$\ne = b - \\hat{b} = [71/57600, 0, -71/16695, 71/1920, -17253/339200, 22/525, -1/40]^T\n$$\n系数 $a_{ij}$ 的矩阵 $A$ 是一个下三角的 $7 \\times 7$ 矩阵：\n$$\nA = \\begin{pmatrix}\n0  0  0  0  0  0  0 \\\\\n1/5  0  0  0  0  0  0 \\\\\n3/40  9/40  0  0  0  0  0 \\\\\n44/45  -56/15  32/9  0  0  0  0 \\\\\n19372/6561  -25360/2187  64448/6561  -212/729  0  0  0 \\\\\n9017/3168  -355/33  46732/5247  49/176  -5103/18656  0  0 \\\\\n35/384  0  500/1113  125/192  -2187/6784  11/84  0\n\\end{pmatrix}\n$$\n对于给定的步长 $h$、绝对容差 $a_{\\text{tol}}$ 和相对容差 $r_{\\text{tol}}$，单步过程如下：\n1.  用 $(t_0, y_0) = (0, 1)$ 进行初始化。\n2.  计算七个阶段的导数 $k_1, \\dots, k_7$，$i = 1, \\dots, 7$：\n    $$\n    k_i = f\\left(t_0 + c_i h, y_0 + h \\sum_{j=1}^{i-1} a_{ij} k_j\\right) = -\\left(y_0 + h \\sum_{j=1}^{i-1} a_{ij} k_j\\right)^2\n    $$\n3.  计算高阶解 $y_5$：\n    $$\n    y_5 = y_0 + h \\sum_{i=1}^7 b_i k_i\n    $$\n4.  计算误差估计 $\\Delta$。这可以直接通过误差系数完成：\n    $$\n    \\Delta = h \\sum_{i=1}^7 e_i k_i\n    $$\n5.  可选地，低阶解为 $y_4 = y_5 - \\Delta$。\n6.  计算缩放误差范数 $\\varepsilon$：\n    $$\n    \\varepsilon = \\frac{|\\Delta|}{a_{\\text{tol}} + r_{\\text{tol}} \\max\\{|y_0|, |y_5|\\}}\n    $$\n7.  决定接受或拒绝该步长。当且仅当 $\\varepsilon \\le 1$ 时，该步长被接受。\n\n该过程将被实现并应用于提供的四个测试用例中的每一个。每个用例的结果 $[\\Delta, \\varepsilon, \\text{accept}]$ 将被收集并格式化为指定的输出结构。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Applies one step of the Dormand-Prince 5(4) method to a given IVP\n    for a suite of test cases and determines step acceptance.\n    \"\"\"\n    \n    # Define the Dormand-Prince 5(4) Butcher tableau coefficients\n    # c: nodes, A: matrix, b: 5th-order weights, e: error weights (b-b_hat)\n    c = np.array([0, 1/5, 3/10, 4/5, 8/9, 1, 1], dtype=np.float64)\n    \n    A = np.array([\n        [0, 0, 0, 0, 0, 0, 0],\n        [1/5, 0, 0, 0, 0, 0, 0],\n        [3/40, 9/40, 0, 0, 0, 0, 0],\n        [44/45, -56/15, 32/9, 0, 0, 0, 0],\n        [19372/6561, -25360/2187, 64448/6561, -212/729, 0, 0, 0],\n        [9017/3168, -355/33, 46732/5247, 49/176, -5103/18656, 0, 0],\n        [35/384, 0, 500/1113, 125/192, -2187/6784, 11/84, 0]\n    ], dtype=np.float64)\n\n    b = np.array([35/384, 0, 500/1113, 125/192, -2187/6784, 11/84, 0], dtype=np.float64)\n    \n    # e = b - b_hat (error coefficients for Delta = y5 - y4)\n    e = np.array([\n        71/57600, 0, -71/16695, 71/1920, -17253/339200, 22/525, -1/40\n    ], dtype=np.float64)\n\n    def f(t, y):\n        \"\"\"The ODE function: y' = -y^2.\"\"\"\n        return -y**2\n\n    # Define the initial conditions from the problem statement.\n    t0 = 0.0\n    y0 = 1.0\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h, atol, rtol)\n        (0.05, 1e-9, 1e-7),      # Case A\n        (1.0, 1e-6, 1e-3),       # Case B\n        (0.5, 1e-6, 0.0),        # Case C\n        (2.5, 1e-2, 1e-1),       # Case D\n    ]\n\n    results = []\n    for h, atol, rtol in test_cases:\n        # Array to store the stage derivatives k_i\n        k = np.zeros(7, dtype=np.float64)\n\n        # Calculate the 7 stages\n        for i in range(7):\n            y_stage_arg = y0 + h * np.dot(A[i, :], k)\n            t_stage_arg = t0 + c[i] * h\n            k[i] = f(t_stage_arg, y_stage_arg)\n        \n        # Compute the 5th order solution y5\n        y5 = y0 + h * np.dot(b, k)\n        \n        # Compute the error estimate Delta = y5 - y4\n        delta = h * np.dot(e, k)\n\n        # Compute the scaled error norm epsilon\n        # The scale must be non-negative.\n        scale = atol + rtol * max(abs(y0), abs(y5))\n        if scale == 0.0:\n            # This case occurs if atol=0, rtol=0, y0=0, and y5=0.\n            # The error is considered acceptable if Delta is also zero.\n            epsilon = 0.0 if delta == 0.0 else float('inf')\n        else:\n            epsilon = abs(delta) / scale\n\n        # Decide whether to accept the step\n        accept = epsilon = 1.0\n\n        results.append([delta, epsilon, accept])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists matches the required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}