{
    "hands_on_practices": [
        {
            "introduction": "将连续的物理定律转化为离散的数值模型时，边界条件的处理是一个决定模型准确性和稳定性的关键步骤。本练习  旨在通过一个一维平流扩散问题，让您亲手实践并对比两种主流的数值方法——有限差分法 (Finite Difference) 和有限体积法 (Finite Volume)——在计算边界通量时的差异。通过从第一性原理出发推导和计算，您将深刻理解不同离散策略（如节点中心与单元中心）如何影响边界通量的表示，以及这对模型整体行为的潜在影响。",
            "id": "3866398",
            "problem": "考虑一个长度为 $L$ 的一维、均匀、棱柱形通道，其横截面积 $A$ 为常数。浓度为 $c(x,t)$ 的被动示踪剂通过速度为 $u$（假设空间均匀）的平流输运，并以恒定的分子扩散系数 $K$（假设空间均匀）进行扩散。其控制守恒定律为平流扩散偏微分方程 (PDE)\n$$\n\\frac{\\partial (A\\,c)}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0,\n$$\n其中总通量 $F(x,t)$ 结合了平流和扩散的贡献，\n$$\nF(x,t) = A\\big(u\\,c(x,t) - K\\,\\frac{\\partial c}{\\partial x}(x,t)\\big).\n$$\n假设在时间 $t=0$ 时的初始条件为闭区间 $x\\in[0,L]$ 上的线性浓度分布 $c(x,0) = c_0 + \\alpha\\,x$，并带有与该线性分布一致的狄利克雷边界条件 $c(0,t)=c_L$ 和 $c(L,t)=c_R$，即 $c_L = c_0$ 和 $c_R = c_0 + \\alpha\\,L$。在本问题中，始终取 $A$ 为常数，等于 $A=1\\,\\text{m}^2$。\n\n您的任务是使用两种离散化方法，推导、实现并评估在 $t=0$ 时的边界通量 $F(0,t)$ 和 $F(L,t)$：\n\n1.  有限差分 (FD)：使用基于节点的网格，其间距 $\\Delta x$ 均匀，节点位于 $x_j=j\\,\\Delta x$，其中 $j\\in\\{0,1,\\dots,N\\}$ 且 $N\\,\\Delta x=L$。在每个边界上，仅使用边界节点及其最近的内部邻居节点的值，通过二阶单侧差分来近似空间梯度 $\\frac{\\partial c}{\\partial x}$。在平流贡献中使用 $c(0)$ 和 $c(L)$ 的狄利克雷边界值。通过泰勒级数展开从第一性原理出发，推导在 $x=0$ 和 $x=L$ 处计算 $\\frac{\\partial c}{\\partial x}$ 的二阶单侧差分公式，并用这些公式来近似 $t=0$ 时的 $F(0)$ 和 $F(L)$。\n\n2.  有限体积 (FV)：使用以单元为中心的网格，包含 $N$ 个宽度为 $\\Delta x=L/N$ 的均匀单元，其中心位于 $x_i=(i+\\tfrac{1}{2})\\,\\Delta x$，其中 $i\\in\\{0,1,\\dots,N-1\\}$。使用以下方法评估边界面的通量：\n    -   在边界面处对平流通量使用迎风重构：\n        -   在 $x=0$ 处，如果 $u>0$，则在面上使用边界入流值 $c_L$；如果 $u0$，则使用相邻的内部单元中心值 $c_0$。\n        -   在 $x=L$ 处，如果 $u>0$，则使用相邻的内部单元中心值 $c_{N-1}$；如果 $u0$，则使用边界入流值 $c_R$。\n    -   在边界面处对扩散通量梯度使用基于狄利克雷边界值和相邻内部单元中心值的线性重构，并与菲克定律保持一致。使用边界和最近单元中心之间呈线性分布的假设，推导在 $x=0$ 和 $x=L$ 处的面梯度表达式。\n\n从上述守恒定律和定义出发，针对有限差分和有限体积两种方法，推导在 $t=0$ 时域内由边界通量引起的净质量变化率的表达式，\n$$\n\\dot{M}_{\\text{boundary}} = F(0) - F(L),\n$$\n从第一性原理出发解释和证明所有近似。\n\n实现要求：\n- 根据每种方法，使用相同数量的子区间 $N$ 和长度 $L$ 对域进行离散化。\n- 根据 $c(x,0)=c_0+\\alpha\\,x$ 构建初始浓度场，并强制 $c_L=c_0$ 和 $c_R=c_0+\\alpha\\,L$。\n- 对两种方法，计算 $t=0$ 时的 $F(0)$ 和 $F(L)$，然后如上定义计算 $\\dot{M}_{\\text{boundary}}$。\n- 以 $\\text{kg/s}$ 为单位表示每个最终结果。\n\n测试套件：\n对于下面的每个测试用例，使用指定的参数并计算两个结果：有限差分净边界质量速率 $\\dot{M}_{\\text{FD}}$ 和有限体积净边界质量速率 $\\dot{M}_{\\text{FV}}$，两者均在 $t=0$ 时。在所有情况下均使用 $A=1\\,\\text{m}^2$。\n\n- 情况 1（基准线性分布，正向平流，非零扩散）：\n  - $N=100$, $L=10\\,\\text{m}$, $u=0.5\\,\\text{m/s}$, $K=0.1\\,\\text{m}^2/\\text{s}$, $c_0=1.0\\,\\text{kg/m}^3$, $\\alpha=0.05\\,\\text{kg/m}^4$。\n\n- 情况 2（纯平流，负线性斜率）：\n  - $N=50$, $L=20\\,\\text{m}$, $u=1.2\\,\\text{m/s}$, $K=0.0\\,\\text{m}^2/\\text{s}$, $c_0=0.8\\,\\text{kg/m}^3$, $\\alpha=-0.02\\,\\text{kg/m}^4$。\n\n- 情况 3（负向平流，正向扩散）：\n  - $N=80$, $L=8\\,\\text{m}$, $u=-0.4\\,\\text{m/s}$, $K=0.05\\,\\text{m}^2/\\text{s}$, $c_0=2.0\\,\\text{kg/m}^3$, $\\alpha=0.1\\,\\text{kg/m}^4$。\n\n- 情况 4（退化情况，零平流和零斜率）：\n  - $N=2$, $L=1\\,\\text{m}$, $u=0.0\\,\\text{m/s}$, $K=0.2\\,\\text{m}^2/\\text{s}$, $c_0=1.0\\,\\text{kg/m}^3$, $\\alpha=0.0\\,\\text{kg/m}^4$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，八个值按以下顺序排列，并以 $\\text{kg/s}$ 表示：\n$$\n[\\dot{M}_{\\text{FD},1},\\dot{M}_{\\text{FV},1},\\dot{M}_{\\text{FD},2},\\dot{M}_{\\text{FV},2},\\dot{M}_{\\text{FD},3},\\dot{M}_{\\text{FV},3},\\dot{M}_{\\text{FD},4},\\dot{M}_{\\text{FV},4}]\n$$\n其中下标表示测试用例编号。数值结果必须是浮点数。",
            "solution": "该问题要求推导和计算在一维平流扩散过程中，由边界通量引起的净质量变化率 $\\dot{M}_{\\text{boundary}} = F(0,t) - F(L,t)$（在时间 $t=0$ 时）。初始浓度是线性分布，$c(x,0) = c_0 + \\alpha x$。面积 $A$ 是常数，等于 $1\\,\\text{m}^2$。通量由 $F(x,t) = A\\big(u\\,c(x,t) - K\\,\\frac{\\partial c}{\\partial x}(x,t)\\big)$ 给出。我们将分析两种数值离散化方法：有限差分 (FD) 和有限体积 (FV)。\n\n首先，我们确定在 $t=0$ 时的精确解析值。初始浓度分布为 $c(x,0) = c_0 + \\alpha x$。在 $t=0$ 时，精确的空间梯度在整个域内是恒定的：$\\frac{\\partial c}{\\partial x}(x,0) = \\alpha$。\n在 $t=0$ 时的精确边界通量为：\n$F(0,0) = A(u\\,c(0,0) - K\\,\\frac{\\partial c}{\\partial x}|_{x=0}) = A(u\\,c_0 - K\\,\\alpha)$。\n$F(L,0) = A(u\\,c(L,0) - K\\,\\frac{\\partial c}{\\partial x}|_{x=L}) = A(u\\,(c_0 + \\alpha L) - K\\,\\alpha)$。\n由边界通量引起的精确净质量变化率为：\n$\\dot{M}_{\\text{exact}} = F(0,0) - F(L,0) = A(u\\,c_0 - K\\,\\alpha) - A(u\\,(c_0+\\alpha L) - K\\,\\alpha) = A(u c_0 - K\\alpha - u c_0 - u\\alpha L + K\\alpha) = -A u \\alpha L$。\n\n**1. 有限差分 (FD) 方法**\n\nFD 方法使用基于节点的网格，包含 $N+1$ 个节点 $x_j = j\\,\\Delta x$，其中 $j \\in \\{0, 1, \\dots, N\\}$，$\\Delta x = L/N$。在 $t=0$ 时的节点浓度为 $c_j = c(x_j,0) = c_0 + \\alpha x_j = c_0 + \\alpha j \\Delta x$。边界值为 $c_0 = c_L$ 和 $c_N = c_R$。\n\n我们必须推导在边界处计算梯度 $\\frac{\\partial c}{\\partial x}$ 的二阶单侧有限差分公式。\n\n在左边界 $x=x_0=0$ 处，我们使用节点 $x_0$、$x_1$ 和 $x_2$。$c(x)$ 在 $x_0$ 附近的泰勒级数展开为：\n$c(x_1) = c(x_0+\\Delta x) = c_0 + \\Delta x \\left(\\frac{\\partial c}{\\partial x}\\right)_0 + \\frac{\\Delta x^2}{2} \\left(\\frac{\\partial^2 c}{\\partial x^2}\\right)_0 + O(\\Delta x^3)$\n$c(x_2) = c(x_0+2\\Delta x) = c_0 + 2\\Delta x \\left(\\frac{\\partial c}{\\partial x}\\right)_0 + \\frac{(2\\Delta x)^2}{2} \\left(\\frac{\\partial^2 c}{\\partial x^2}\\right)_0 + O(\\Delta x^3)$\n为了消除二阶导数项，我们计算 $4c(x_1) - c(x_2)$：\n$4c(x_1) - c(x_2) = (4c_0 + 4\\Delta x (\\frac{\\partial c}{\\partial x})_0 + 2\\Delta x^2 (\\frac{\\partial^2 c}{\\partial x^2})_0) - (c_0 + 2\\Delta x (\\frac{\\partial c}{\\partial x})_0 + 2\\Delta x^2 (\\frac{\\partial^2 c}{\\partial x^2})_0) + O(\\Delta x^3)$\n$4c(x_1) - c(x_2) = 3c_0 + 2\\Delta x \\left(\\frac{\\partial c}{\\partial x}\\right)_0 + O(\\Delta x^3)$\n求解梯度得到二阶向前差分公式：\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FD}} = \\frac{-3c(x_0,0) + 4c(x_1,0) - c(x_2,0)}{2\\Delta x} + O(\\Delta x^2)$。\n\n在右边界 $x=x_N=L$ 处，我们使用节点 $x_N$、$x_{N-1}$ 和 $x_{N-2}$。通过在 $x_N$ 附近进行类似的泰勒展开，我们推导出二阶向后差分公式：\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FD}} = \\frac{3c(x_N,0) - 4c(x_{N-1},0) + c(x_{N-2},0)}{2\\Delta x} + O(\\Delta x^2)$。\n\n对于初始线性分布 $c(x,0) = c_0 + \\alpha x$，我们来评估这些梯度近似：\n在 $x=0$ 处：$c(x_0,0)=c_0$, $c(x_1,0)=c_0+\\alpha\\Delta x$, $c(x_2,0)=c_0+2\\alpha\\Delta x$。\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FD}} = \\frac{-3c_0 + 4(c_0+\\alpha\\Delta x) - (c_0+2\\alpha\\Delta x)}{2\\Delta x} = \\frac{(-3+4-1)c_0 + (4\\alpha-2\\alpha)\\Delta x}{2\\Delta x} = \\frac{2\\alpha\\Delta x}{2\\Delta x} = \\alpha$。\n该近似是精确的，因为二阶公式对于次数最高为2的多项式是精确的。\n\n在 $x=L$ 处：$c(x_N,0)=c_0+\\alpha L$, $c(x_{N-1},0)=c_0+\\alpha(L-\\Delta x)$, $c(x_{N-2},0)=c_0+\\alpha(L-2\\Delta x)$。\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FD}} = \\frac{3(c_0+\\alpha L) - 4(c_0+\\alpha(L-\\Delta x)) + (c_0+\\alpha(L-2\\Delta x))}{2\\Delta x} = \\frac{(3-4+1)(c_0+\\alpha L) + (4\\alpha-2\\alpha)\\Delta x}{2\\Delta x} = \\frac{2\\alpha\\Delta x}{2\\Delta x} = \\alpha$。\n该近似同样是精确的。\n\nFD 方法在 $t=0$ 时的边界通量为：\n$F_{\\text{FD}}(0,0) = A(u\\,c(0,0) - K\\,\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FD}}) = A(u\\,c_0 - K\\,\\alpha)$。\n$F_{\\text{FD}}(L,0) = A(u\\,c(L,0) - K\\,\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FD}}) = A(u\\,(c_0+\\alpha L) - K\\,\\alpha)$。\n净质量变化率为：\n$\\dot{M}_{\\text{FD}} = F_{\\text{FD}}(0,0) - F_{\\text{FD}}(L,0) = A(u\\,c_0-K\\alpha) - A(u(c_0+\\alpha L)-K\\alpha) = -A u \\alpha L$。\n这与解析结果相同。\n\n**2. 有限体积 (FV) 方法**\n\nFV 方法使用包含 $N$ 个单元的单元中心网格，其中单元 $i$ 的宽度为 $\\Delta x = L/N$，中心位于 $x_i = (i+1/2)\\Delta x$，其中 $i \\in \\{0, \\dots, N-1\\}$。域边界是位于 $x=0$ 和 $x=L$ 的单元面。在 $t=0$ 时，单元 $i$ 的单元平均浓度为：\n$c_i = \\frac{1}{\\Delta x}\\int_{i\\Delta x}^{(i+1)\\Delta x} (c_0+\\alpha x)dx = c_0 + \\alpha (i+1/2)\\Delta x = c(x_i, 0)$。\n对于线性分布，单元平均值等于单元中心处的值。\n\n面上的总通量是平流通量和扩散通量的和，$F = F_{adv} + F_{diff}$。我们在边界面 $x=0$ 和 $x=L$ 处评估这些值。\n\n扩散通量 $F_{diff} = -A K \\frac{\\partial c}{\\partial x}$ 需要在面上进行梯度近似。问题指定在边界和最近的单元中心之间进行线性重构。\n在左面 $x=0$ 处，梯度使用边界值 $c_L=c_0$（在 $x=0$ 处）和单元中心值 $c_{cell,0}$（在 $x_{cell,0}=\\Delta x/2$ 处）进行近似。\n$c_{cell,0} = c_0 + \\alpha (\\Delta x/2)$。\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FV}} = \\frac{c_{cell,0} - c_L}{x_{cell,0} - 0} = \\frac{(c_0+\\alpha\\Delta x/2) - c_0}{\\Delta x/2} = \\alpha$。\n在右面 $x=L$ 处，梯度使用边界值 $c_R=c_0+\\alpha L$（在 $x=L$ 处）和单元中心值 $c_{cell,N-1}$（在 $x_{cell,N-1}=L-\\Delta x/2$ 处）。\n$c_{cell,N-1} = c_0 + \\alpha(L-\\Delta x/2)$。\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FV}} = \\frac{c_R - c_{cell,N-1}}{L - x_{cell,N-1}} = \\frac{(c_0+\\alpha L) - (c_0+\\alpha(L-\\Delta x/2))}{\\Delta x/2} = \\alpha$。\n对于初始线性分布，FV 方法的扩散通量梯度近似是精确的。\n\n平流通量 $F_{adv} = A u c_{face}$ 对面上的浓度 $c_{face}$ 使用迎风格式。\n在左面 $x=0$ 处：\n如果 $u \\ge 0$（从边界流入），$c_{face,0} = c_L = c_0$。\n如果 $u  0$（从域内流出），$c_{face,0} = c_{cell,0} = c_0 + \\alpha \\Delta x/2$。\n在右面 $x=L$ 处：\n如果 $u > 0$（从域内流出），$c_{face,L} = c_{cell,N-1} = c_0 + \\alpha(L - \\Delta x/2)$。\n如果 $u \\le 0$（从边界流入），$c_{face,L} = c_R = c_0 + \\alpha L$。\n\nFV 方法在 $t=0$ 时的总边界通量为：\n$F_{\\text{FV}}(0,0) = A(u\\,c_{face,0} - K\\,\\alpha)$。\n$F_{\\text{FV}}(L,0) = A(u\\,c_{face,L} - K\\,\\alpha)$。\n净质量变化率为：\n$\\dot{M}_{\\text{FV}} = F_{\\text{FV}}(0,0) - F_{\\text{FV}}(L,0) = A u (c_{face,0} - c_{face,L})$。\n\n我们根据 $u$ 的符号来分析这个：\n情况 $u > 0$：$\\dot{M}_{\\text{FV}} = A u (c_L - c_{cell,N-1}) = A u (c_0 - (c_0 + \\alpha(L - \\Delta x/2))) = -A u \\alpha(L - \\Delta x/2)$。\n情况 $u  0$：$\\dot{M}_{\\text{FV}} = A u (c_{cell,0} - c_R) = A u ((c_0 + \\alpha \\Delta x/2) - (c_0 + \\alpha L)) = A u \\alpha(\\Delta x/2 - L) = -A u \\alpha(L - \\Delta x/2)$。\n情况 $u = 0$：$\\dot{M}_{\\text{FV}} = 0$。\n\n所有情况都可以用一个公式来描述，代入 $\\Delta x = L/N$：\n$\\dot{M}_{\\text{FV}} = -A u \\alpha (L - \\frac{\\Delta x}{2}) = -A u \\alpha L (1 - \\frac{1}{2N})$。\n由于平流通量项的一阶迎风近似，此结果与精确解不同。误差与 $1/N$ 成正比，并且当 $N \\to \\infty$ 时消失。\n\n**用于实现的公式摘要**\n给定 $A=1\\,\\text{m}^2$。\n对于有限差分方法：\n$\\dot{M}_{\\text{FD}} = -u \\alpha L$\n对于有限体积方法：\n$\\dot{M}_{\\text{FV}} = -u \\alpha L (1 - \\frac{1}{2N})$\n\n这些公式将用于计算给定测试用例的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the net rate of mass change due to boundary fluxes at t=0\n    for an advection-diffusion problem using Finite Difference and Finite Volume methods.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (N, L, u, K, c0, alpha)\n    test_cases = [\n        # Case 1 (baseline linear profile, positive advection, nonzero diffusion)\n        (100, 10.0, 0.5, 0.1, 1.0, 0.05),\n        # Case 2 (pure advection, negative linear slope)\n        (50, 20.0, 1.2, 0.0, 0.8, -0.02),\n        # Case 3 (negative advection, positive diffusion)\n        (80, 8.0, -0.4, 0.05, 2.0, 0.1),\n        # Case 4 (degenerate case, zero advection and zero slope)\n        (2, 1.0, 0.0, 0.2, 1.0, 0.0),\n    ]\n\n    # Area A is constant and equal to 1 m^2.\n    A = 1.0\n\n    results = []\n    for N, L, u, K, c0, alpha in test_cases:\n        # --- Finite Difference (FD) Calculation ---\n        # The net rate of mass change due to boundary fluxes is M_dot = F(0) - F(L).\n        # For the FD method with second-order one-sided differences, the gradient\n        # approximation for a linear profile is exact. The resulting formula is:\n        # M_dot_FD = -A * u * alpha * L\n        M_dot_FD = -A * u * alpha * L\n\n        # --- Finite Volume (FV) Calculation ---\n        # For the FV method with upwinding for advection and linear reconstruction\n        # for the diffusive gradient, the formula is:\n        # M_dot_FV = -A * u * alpha * L * (1 - 1/(2*N))\n        # This formula holds for u > 0, u  0, and u = 0.\n        if N > 0:\n            M_dot_FV = -A * u * alpha * L * (1.0 - 1.0 / (2.0 * N))\n        else:\n            # This case should not be reached with the given test data,\n            # but as a fallback, we can consider the limit N -> infinity,\n            # though an N of 0 is physically meaningless here.\n            M_dot_FV = -A * u * alpha * L\n\n        results.append(M_dot_FD)\n        results.append(M_dot_FV)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了边界条件的数值实现细节后，我们转向分析的视角，以获得更深刻的物理直觉。本练习  探讨了一个环境科学中的经典问题：周期性的潮汐波动如何影响沿海含水层的水头分布。通过从质量守恒和达西定律等基本物理原理出发，推导并求解一个受周期性边界强迫的扩散方程，您将能够解析地描述波在介质中传播时的振幅衰减和相位延迟现象。这种分析方法是理解动态边界如何驱动系统内部响应的强大工具。",
            "id": "3866406",
            "problem": "一个承压海岸含水层被理想化为一个占据 $x \\ge 0$ 的半无限一维区域。水头 $h(x,t)$ 在小扰动下遵循质量守恒和 Darcy 定律。设含水层的导水系数为 $T$，储水系数为 $S$，两者在空间和时间上均为均匀常数。在 $x=0$ 处的临海边界受到周期性的潮汐水头强迫，由 $h(0,t) = H_{1} \\cos(\\omega t)$ 给出，其中 $H_{1}  0$ 和 $\\omega  0$ 是常数。远场条件为当 $x \\to \\infty$ 时水头扰动保持有界，初始条件为对于 $x  0$，有 $h(x,0) = 0$。\n\n仅从承压含水层的质量守恒基本定律和 Darcy 定律出发，推导单位宽度达西体积通量 $q(x,t)$ 的长时间周期性响应，并获得在一个固定内部位置 $x=L$ 处 $q(x,t)$ 振幅的闭合形式解析表达式，该表达式用 $H_{1}$、$T$、$S$、$\\omega$ 和 $L$ 表示。单位宽度的达西体积通量定义为 $q(x,t) = -T \\,\\partial h/\\partial x$。\n\n将最终振幅以 $\\mathrm{m^{2}\\,s^{-1}}$ 为单位表示。你的最终答案必须是一个单一的闭合形式解析表达式。",
            "solution": "问题是要求解在一个半无限承压含水层中，位于 $x=L$ 处单位宽度达西体积通量 $q(x,t)$ 的长时间周期性响应的振幅。推导必须从基本原理出发。\n\n首先，我们建立水头 $h(x,t)$ 的控制性偏微分方程。提供的两个基本定律是承压含水层的质量守恒和 Darcy 定律。在一维情况下，质量守恒表示为：\n$$\n-\\frac{\\partial q(x,t)}{\\partial x} = S \\frac{\\partial h(x,t)}{\\partial t}\n$$\n其中 $q(x,t)$ 是单位宽度的达西体积通量，$S$ 是储水系数。该方程表明，流入控制体的净流体速率等于该体积内储存流体的变化率。\n\n正如问题陈述中所给出的，Darcy 定律将通量与水头梯度联系起来：\n$$\nq(x,t) = -T \\frac{\\partial h(x,t)}{\\partial x}\n$$\n其中 $T$ 是含水层的导水系数。\n\n为了得到关于 $h(x,t)$ 的单一方程，我们将 Darcy 定律代入质量守恒方程。\n$$\n-\\frac{\\partial}{\\partial x} \\left(-T \\frac{\\partial h}{\\partial x}\\right) = S \\frac{\\partial h}{\\partial t}\n$$\n鉴于导水系数 $T$ 是均匀和恒定的，它可以移到空间导数之外：\n$$\nT \\frac{\\partial^2 h}{\\partial x^2} = S \\frac{\\partial h}{\\partial t}\n$$\n重新整理得到水头的一维扩散方程：\n$$\n\\frac{\\partial h}{\\partial t} = D \\frac{\\partial^2 h}{\\partial x^2}\n$$\n其中 $D = T/S$ 是水力扩散系数。\n\n问题要求解对边界 $x=0$ 处的潮汐强迫 $h(0,t) = H_{1} \\cos(\\omega t)$ 的长时间周期性响应。经过足够长的时间后，初始条件 $h(x,0)=0$ 的影响会衰减，系统以与强迫相同的频率 $\\omega$ 振荡。因此，我们可以寻求一个稳态周期解。\n\n使用复变量来解决这个问题很方便。我们将边界条件表示为一个复指数的实部：$h(0,t) = \\text{Re}\\{H_{1} e^{i\\omega t}\\}$。然后我们寻求一个形式为 $h(x,t) = \\text{Re}\\{\\hat{h}(x) e^{i\\omega t}\\}$ 的解，其中 $\\hat{h}(x)$ 是一个代表水头振荡的空间振幅和相位的复值函数。\n\n将此形式代入扩散方程：\n$$\n\\frac{\\partial}{\\partial t} \\left(\\hat{h}(x) e^{i\\omega t}\\right) = D \\frac{\\partial^2}{\\partial x^2} \\left(\\hat{h}(x) e^{i\\omega t}\\right)\n$$\n$$\ni\\omega \\hat{h}(x) e^{i\\omega t} = D \\frac{d^2\\hat{h}(x)}{dx^2} e^{i\\omega t}\n$$\n这简化为关于 $\\hat{h}(x)$ 的一个常微分方程：\n$$\n\\frac{d^2\\hat{h}}{dx^2} - \\frac{i\\omega}{D} \\hat{h} = 0\n$$\n我们定义一个复波数 $k^2 = i\\omega/D$。这个二阶常微分方程的通解是：\n$$\n\\hat{h}(x) = C_1 e^{k x} + C_2 e^{-k x}\n$$\n我们必须确定常数 $k$。我们有 $k = \\sqrt{i\\omega/D}$。使用虚数单位 $i=e^{i\\pi/2}$ 的极坐标形式，我们发现 $\\sqrt{i} = e^{i\\pi/4} = \\cos(\\pi/4) + i\\sin(\\pi/4) = \\frac{1}{\\sqrt{2}}(1+i)$。因此：\n$$\nk = \\sqrt{\\frac{\\omega}{D}} \\sqrt{i} = \\sqrt{\\frac{\\omega}{D}} \\frac{1+i}{\\sqrt{2}} = \\sqrt{\\frac{\\omega}{2D}}(1+i)\n$$\n令 $\\alpha = \\sqrt{\\frac{\\omega}{2D}} = \\sqrt{\\frac{\\omega S}{2T}}$。那么 $k = \\alpha(1+i)$。$k$ 的实部为正。\n\n现在我们应用边界条件来求解系数 $C_1$ 和 $C_2$。\n1.  远场条件表明当 $x \\to \\infty$ 时水头扰动保持有界。项 $e^{kx} = e^{\\alpha(1+i)x} = e^{\\alpha x}e^{i\\alpha x}$ 的模为 $|e^{\\alpha x}| = e^{\\alpha x}$，由于 $\\alpha0$，当 $x \\to \\infty$ 时，该模呈指数增长。为了保持解有界，我们必须将其系数 $C_1 = 0$。\n2.  现在的解是 $\\hat{h}(x) = C_2 e^{-kx}$。在临海边界 $x=0$ 处，我们有 $h(0,t) = \\text{Re}\\{\\hat{h}(0)e^{i\\omega t}\\} = \\text{Re}\\{C_2 e^{i\\omega t}\\}$。这必须与给定条件 $h(0,t) = H_1 \\cos(\\omega t) = \\text{Re}\\{H_1 e^{i\\omega t}\\}$ 匹配。比较这些，我们发现 $C_2 = H_1$。\n\n因此，水头的复振幅为：\n$$\n\\hat{h}(x) = H_1 e^{-kx} = H_1 e^{-\\alpha(1+i)x}\n$$\n对应的水头长时间解为 $h(x,t) = \\text{Re}\\{H_1 e^{-\\alpha x} e^{-i\\alpha x} e^{i\\omega t}\\} = H_1 e^{-\\alpha x} \\cos(\\omega t - \\alpha x)$。\n\n接下来，我们推导单位宽度的达西体积通量 $q(x,t) = -T \\frac{\\partial h}{\\partial x}$。我们可以使用复数表示法。通量的复振幅 $\\hat{q}(x)$ 由下式给出：\n$$\n\\hat{q}(x) = -T \\frac{d\\hat{h}(x)}{dx}\n$$\n将 $\\hat{h}(x)$ 对 $x$ 求导：\n$$\n\\frac{d\\hat{h}}{dx} = \\frac{d}{dx} (H_1 e^{-kx}) = -k H_1 e^{-kx}\n$$\n将此代入 $\\hat{q}(x)$ 的表达式中：\n$$\n\\hat{q}(x) = -T(-k H_1 e^{-kx}) = T k H_1 e^{-kx}\n$$\n实值的、随时间变化的通量是 $q(x,t) = \\text{Re}\\{\\hat{q}(x)e^{i\\omega t}\\}$。这个函数的振幅，我们记为 $A_q(x)$，是复振幅 $\\hat{q}(x)$ 的模：\n$$\nA_q(x) = |\\hat{q}(x)| = |T k H_1 e^{-kx}| = T H_1 |k| |e^{-kx}|\n$$\n我们计算复数项的模：\n- $|k| = |\\sqrt{i\\omega/D}| = \\sqrt{|i\\omega/D|} = \\sqrt{\\omega/D} = \\sqrt{\\omega S/T}$。\n- $|e^{-kx}| = |e^{-\\alpha(1+i)x}| = |e^{-\\alpha x} e^{-i\\alpha x}| = |e^{-\\alpha x}| |e^{-i\\alpha x}| = e^{-\\alpha x} \\cdot 1 = e^{-\\alpha x}$，因为 $\\alpha > 0$ 且 $x \\ge 0$。\n\n将这些代回振幅表达式中：\n$$\nA_q(x) = T H_1 \\sqrt{\\frac{\\omega S}{T}} e^{-\\alpha x} = H_1 \\sqrt{T^2 \\frac{\\omega S}{T}} e^{-\\alpha x} = H_1 \\sqrt{T \\omega S} e^{-\\alpha x}\n$$\n问题要求在固定内部位置 $x = L$ 处的振幅。我们代入 $x = L$ 和 $\\alpha = \\sqrt{\\frac{\\omega S}{2T}}$ 的表达式：\n$$\nA_q(L) = H_1 \\sqrt{T \\omega S} \\exp\\left(-L\\alpha\\right) = H_1 \\sqrt{T \\omega S} \\exp\\left(-L\\sqrt{\\frac{\\omega S}{2T}}\\right)\n$$\n这是在 $x=L$ 处单位宽度达西体积通量振幅的闭合形式解析表达式。单位为 $[L][(L^2 T^{-1})(T^{-1})]^{1/2} = [L][L^2 T^{-2}]^{1/2} = [L][L T^{-1}] = [L^2 T^{-1}]$，这与所要求的 $\\mathrm{m^2\\,s^{-1}}$ 相对应。",
            "answer": "$$\\boxed{H_{1} \\sqrt{T \\omega S} \\exp\\left(-L \\sqrt{\\frac{\\omega S}{2T}}\\right)}$$"
        },
        {
            "introduction": "理论模型与现实世界的应用之间往往存在一道鸿沟，其中一个重要原因就是边界条件的参数通常是未知的。本练习  将引导您进入高级建模实践的核心领域：模型校准。在这里，我们不再假定边界条件是完全给定的，而是将其视为需要通过内部观测数据来确定的未知参数。您将通过求解一个稳态对流-扩散-反应方程，并结合最小二乘法优化，来反演上游浓度和下游交换系数。这项技能对于开发具有实际预测能力的地球系统模型至关重要。",
            "id": "3866378",
            "problem": "考虑在区间 $x \\in [0,L]$ 上建模的一维、稳态、守恒反应示踪剂，其处于均匀明渠流段中。控制方程由质量守恒和带有一阶衰减的菲克色散推导得出。在平流速度 $u$、色散系数 $D$ 和一阶衰减率 $\\lambda$ 均为常数的假设下，稳态浓度 $C(x)$ 满足\n$$\nD \\frac{d^2 C}{dx^2} - u \\frac{d C}{dx} - \\lambda C = 0.\n$$\n在上游边界 $x=0$ 处，浓度由狄利克雷边界条件 $C(0)=C_0$ 给出，其中 $C_0$ 是未知且必须被校准的。在下游边界 $x=L$ 处，与浓度为 $C_{\\mathrm{ext}}$ 的外部储库的交换施加了一个罗宾边界条件\n$$\n- D \\frac{dC}{dx}(L) = k \\left( C(L) - C_{\\mathrm{ext}} \\right),\n$$\n其中 $k$ 是一个非负的边界交换系数（单位为米/秒），该系数是未知且必须被校准的。\n\n基本原理：从受平流、扩散和一阶衰减影响的一维明渠流中的标量示踪剂的质量守恒出发，结合标准的狄利克雷和罗宾边界条件，对于常系数情况，解 $C(x)$ 呈指数形式。与该线性常微分方程相关的特征方程产生两个实特征率 $r_1$ 和 $r_2$（或在退化情况下为重根率 $r$），由此可以构建通解。边界条件确定了积分常数。校准问题被设定为一个最小二乘最小化问题，通过调整未知的边界参数来最佳地重现内部浓度观测值。\n\n任务：推导解析解的结构，展示边界条件如何确定积分常数，并实现一个计算程序，通过最小化模型预测值与所提供的内部观测值之间的残差平方和来校准参数对 $(C_0, k)$。校准必须遵守具有物理意义的界限：$C_0 \\ge 0$ 和 $k \\ge 0$。\n\n解析结构（不要将此作为捷径；您必须从控制方程和边界条件推导出它）：对于不同的特征率 $r_1$ 和 $r_2$，解的形式为 $C(x) = A e^{r_1 x} + B e^{r_2 x}$，其中常数 $A$ 和 $B$ 由边界条件确定。对于重复的特征率 $r$，解的形式为 $C(x) = (A + B x) e^{r x}$。\n\n校准目标：给定特定位置的观测值 $\\{ (x_i, y_i ) \\}$，定义最小二乘目标\n$$\nJ(C_0, k) = \\sum_{i} \\left[ C_{\\text{model}}(x_i; C_0, k) - y_i \\right]^2,\n$$\n并计算在 $C_0 \\ge 0$ 和 $k \\ge 0$ 约束下使其最小化的 $(C_0, k)$。\n\n单位：所有距离单位必须为米，时间单位为秒，速度单位为 $\\mathrm{m/s}$，色散单位为 $\\mathrm{m^2/s}$，衰减率单位为 $\\mathrm{s^{-1}}$，交换系数单位为 $\\mathrm{m/s}$，浓度单位为 $\\mathrm{mg/L}$。您的程序必须返回以 $\\mathrm{mg/L}$ 为单位的 $C_0$ 和以 $\\mathrm{m/s}$ 为单位的 $k$。不涉及角度。不涉及百分比。\n\n测试套件：使用以下三个具有不同机制的科学上合理的案例来测试不同方面（理想情况、弱交换边界情况、强交换边界情况）。对于每个案例，观测值都是合成的，并与正演模型一致。\n\n- 案例A（理想情况，中等平流和色散，非零下游交换）：\n  - $u = 0.1$ $\\mathrm{m/s}$，$D = 10$ $\\mathrm{m^2/s}$，$\\lambda = 1\\times 10^{-4}$ $\\mathrm{s^{-1}}$，$L = 1000$ $\\mathrm{m}$，$C_{\\mathrm{ext}} = 0$ $\\mathrm{mg/L}$。\n  - 观测位置 $x$ 为 $[200, 500, 800]$ $\\mathrm{m}$。\n  - 观测浓度 $y$ 为 $[4.1630, 3.1630, 2.4171]$ $\\mathrm{mg/L}$。\n  - 校准的物理合理界限为 $0 \\le C_0 \\le 10$ 和 $0 \\le k \\le 0.01$。\n\n- 案例B（零下游交换的边缘情况，即由于 $k=0$ 导致的下游端纯零通量诺伊曼边界）：\n  - $u = 0.05$ $\\mathrm{m/s}$，$D = 5$ $\\mathrm{m^2/s}$，$\\lambda = 2\\times 10^{-4}$ $\\mathrm{s^{-1}}$，$L = 200$ $\\mathrm{m}$，$C_{\\mathrm{ext}} = 0$ $\\mathrm{mg/L}$。\n  - 观测位置 $x$ 为 $[50, 120, 180]$ $\\mathrm{m}$。\n  - 观测浓度 $y$ 为 $[2.6045, 2.1921, 2.0047]$ $\\mathrm{mg/L}$。\n  - 校准的物理合理界限为 $0 \\le C_0 \\le 5$ 和 $0 \\le k \\le 0.01$。\n\n- 案例C（强下游交换，罗宾边界近似于朝向外部储库的狄利克雷条件）：\n  - $u = 0.05$ $\\mathrm{m/s}$，$D = 1$ $\\mathrm{m^2/s}$，$\\lambda = 1\\times 10^{-3}$ $\\mathrm{s^{-1}}$，$L = 80$ $\\mathrm{m}$，$C_{\\mathrm{ext}} = 1$ $\\mathrm{mg/L}$。\n  - 观测位置 $x$ 为 $[10, 40, 80]$ $\\mathrm{m}$。\n  - 观测浓度 $y$ 为 $[0.4291, 0.2788, 0.2550]$ $\\mathrm{mg/L}$。\n  - 校准的物理合理界限为 $0 \\le C_0 \\le 2$ 和 $0 \\le k \\le 0.1$。\n\n您的程序应使用从上述控制方程和边界条件推导出的正演模型，通过最小化 $J(C_0, k)$ 来为每个案例校准 $(C_0, k)$。仅使用提供的观测值和声明的参数界限。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素是代表一个案例校准后参数对的双元素列表 $[C_0, k]$。例如，输出格式必须为 $[[C_{0,A},k_A],[C_{0,B},k_B],[C_{0,C},k_C]]$。所有返回的 $C_0$ 值单位必须是 $\\mathrm{mg/L}$，所有返回的 $k$ 值单位必须是 $\\mathrm{m/s}$。",
            "solution": "我们从一维明渠流中受平流、扩散和一阶衰减影响的标量示踪剂的基本质量守恒定律开始。在区间 $x \\in [0,L]$ 上的稳态平衡为\n$$\n\\frac{d}{dx} \\left( - D \\frac{d C}{dx} + u C \\right) - \\lambda C = 0,\n$$\n对于恒定的 $u$、$D$ 和 $\\lambda$，该方程简化为线性常微分方程\n$$\nD \\frac{d^2 C}{dx^2} - u \\frac{d C}{dx} - \\lambda C = 0.\n$$\n我们寻求形如 $C(x) = e^{r x}$ 乘以一个常数的指数解；代入可得特征方程\n$$\nD r^2 - u r - \\lambda = 0.\n$$\n判别式为 $\\Delta = u^2 + 4 D \\lambda \\ge 0$，因此有两个不同的实根\n$$\nr_1 = \\frac{u + \\sqrt{u^2 + 4 D \\lambda}}{2D}, \\quad r_2 = \\frac{u - \\sqrt{u^2 + 4 D \\lambda}}{2D},\n$$\n除非 $\\Delta = 0$，此时 $r_1 = r_2 = r = \\frac{u}{2D}$ 是一个重根。对于不同根的一般情况，解为\n$$\nC(x) = A e^{r_1 x} + B e^{r_2 x},\n$$\n其中常数 $A$ 和 $B$ 由边界条件确定。上游狄利克雷条件 $C(0)=C_0$ 给出\n$$\nA + B = C_0.\n$$\n下游罗宾条件 $- D C'(L) = k \\left( C(L) - C_{\\mathrm{ext}} \\right)$ 给出\n$$\n- D \\left( A r_1 e^{r_1 L} + B r_2 e^{r_2 L} \\right) = k \\left( A e^{r_1 L} + B e^{r_2 L} - C_{\\mathrm{ext}} \\right).\n$$\n合并各项，得到一个关于 $(A,B)$ 的 $2\\times 2$ 线性系统：\n$$\n\\begin{bmatrix}\n1  1 \\\\\n- e^{r_1 L} \\left( D r_1 + k \\right)  - e^{r_2 L} \\left( D r_2 + k \\right)\n\\end{bmatrix}\n\\begin{bmatrix}\nA \\\\ B\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nC_0 \\\\ - k C_{\\mathrm{ext}}\n\\end{bmatrix}.\n$$\n对于退化的重根情况（$r_1 = r_2 = r$），通解为\n$$\nC(x) = (A + B x) e^{r x},\n$$\n其中根据上游狄利克雷边界条件有 $A = C_0$。下游罗宾边界条件得出\n$$\n- D \\left( B + r (A + B L) \\right) e^{r L} = k \\left( (A + B L) e^{r L} - C_{\\mathrm{ext}} \\right).\n$$\n两边同除以 $e^{r L}$ 并代入 $A = C_0$，得到一个关于 $B$ 的线性方程：\n$$\n- D \\left( B + r C_0 + r B L \\right) = k \\left( C_0 + B L - C_{\\mathrm{ext}} e^{- r L} \\right),\n$$\n其可以显式求解为\n$$\nB = \\frac{k \\left( C_0 - C_{\\mathrm{ext}} e^{- r L} \\right) + D r C_0}{- D (1 + r L) - k L}.\n$$\n\n在 $(A,B)$ 确定后，正演模型将 $(C_0,k)$ 映射到内部浓度。对于不同根：\n$$\nC_{\\text{model}}(x; C_0, k) = A(C_0,k) e^{r_1 x} + B(C_0,k) e^{r_2 x}.\n$$\n对于重根：\n$$\nC_{\\text{model}}(x; C_0, k) = \\left( C_0 + B(C_0,k) x \\right) e^{r x}.\n$$\n\n校准问题：给定观测值 $\\{ (x_i, y_i) \\}$，定义最小二乘目标\n$$\nJ(C_0, k) = \\sum_{i} \\left[ C_{\\text{model}}(x_i; C_0, k) - y_i \\right]^2,\n$$\n并计算\n$$\n(C_0^\\star, k^\\star) = \\arg \\min_{C_0 \\ge 0,\\, k \\ge 0} J(C_0, k),\n$$\n计算需受限于反映物理合理性的特定案例界限。\n\n算法设计：\n- 对每个案例，根据 $u$、$D$ 和 $\\lambda$ 计算 $r_1$ 和 $r_2$。如果 $|r_1 - r_2|$ 小于某个数值容差，则视为重根情况；否则，使用不同根的情况。\n- 给定一个试验的 $(C_0, k)$，在不同根的情况下，建立并求解关于 $(A,B)$ 的 $2\\times 2$ 线性系统；或在重根情况下直接计算 $B$。\n- 计算 $C_{\\text{model}}(x_i; C_0, k)$ 并组合残差 $r_i = C_{\\text{model}}(x_i; C_0, k) - y_i$。\n- 使用适用于带界限约束的非线性最小二乘问题的信赖域反射法，在界限约束下最小化 $J(C_0,k) = \\sum_i r_i^2$。\n- 使用初始猜测值：$C_0$ 等于最大观测浓度，$k$ 等于一个小的正值。对 $C_0$ 和 $k$ 应用特定案例的界限。\n\n科学真实性与可识别性考量：\n- 指数解结构严格源自常系数线性常微分方程，并与平流-扩散-反应物理学原理一致。\n- 所选案例检验了不同机制：中等平流和色散（案例A）、导致诺伊曼边界的零下游交换（案例B）以及近似于朝向外部储库的狄利克雷边界的强下游交换（案例C）。\n- 每个案例至少有三个内部观测位置，为两个边界参数提供了一个超定系统，从而保证了稳定的最小二乘校准。\n\n输出：\n- 返回单行，其中包含一个校准后参数对的列表，格式为 $[[C_{0,A},k_A],[C_{0,B},k_B],[C_{0,C},k_C]]$，其中 $C_0$ 的单位为 $\\mathrm{mg/L}$，$k$ 的单位为 $\\mathrm{m/s}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef characteristic_rates(u, D, lam):\n    # Compute characteristic rates r1, r2 for the ODE: D r^2 - u r - lam = 0\n    disc = u*u + 4.0*D*lam\n    sqrt_disc = np.sqrt(disc)\n    r1 = (u + sqrt_disc) / (2.0*D)\n    r2 = (u - sqrt_disc) / (2.0*D)\n    return r1, r2\n\ndef forward_profile_distinct_roots(u, D, lam, L, Cext, C0, k, xs):\n    # Distinct roots case: C(x) = A e^{r1 x} + B e^{r2 x}\n    r1, r2 = characteristic_rates(u, D, lam)\n    # If roots are nearly equal, delegate to repeated root handler\n    if abs(r1 - r2)  1e-12:\n        return forward_profile_repeated_root(u, D, lam, L, Cext, C0, k, xs)\n    E1L = np.exp(r1 * L)\n    E2L = np.exp(r2 * L)\n    # Construct and solve for A, B from boundary conditions\n    # Row1: A + B = C0\n    # Row2: -D * (A*r1*e^{r1 L} + B*r2*e^{r2 L}) = k * (A*e^{r1 L} + B*e^{r2 L} - Cext)\n    M = np.array([\n        [1.0, 1.0],\n        [-E1L * (D * r1 + k), -E2L * (D * r2 + k)]\n    ])\n    rhs = np.array([C0, -k * Cext])\n    # Solve linear system robustly\n    try:\n        AB = np.linalg.solve(M, rhs)\n    except np.linalg.LinAlgError:\n        # Fallback to least-squares solve if singular\n        AB, *_ = np.linalg.lstsq(M, rhs, rcond=None)\n    A, B = AB[0], AB[1]\n    xs = np.asarray(xs)\n    Cx = A * np.exp(r1 * xs) + B * np.exp(r2 * xs)\n    return Cx\n\ndef forward_profile_repeated_root(u, D, lam, L, Cext, C0, k, xs):\n    # Repeated root case: r1 == r2 == r, solution C(x) = (A + B x) e^{r x}, with A = C0\n    r1, r2 = characteristic_rates(u, D, lam)\n    r = 0.5 * (r1 + r2)\n    A = C0\n    e_rL = np.exp(r * L)\n    denom = -D * (1.0 + r * L) - k * L\n    # To avoid division by zero, perturb denominator slightly if nearly zero\n    if abs(denom)  1e-18:\n        denom = np.sign(denom) * 1e-18 if denom != 0 else 1e-18\n    B = (k * (C0 - Cext * np.exp(-r * L)) + D * r * C0) / denom\n    xs = np.asarray(xs)\n    Cx = (A + B * xs) * np.exp(r * xs)\n    return Cx\n\ndef forward_model(u, D, lam, L, Cext, C0, k, xs):\n    r1, r2 = characteristic_rates(u, D, lam)\n    if abs(r1 - r2)  1e-12:\n        return forward_profile_repeated_root(u, D, lam, L, Cext, C0, k, xs)\n    else:\n        return forward_profile_distinct_roots(u, D, lam, L, Cext, C0, k, xs)\n\ndef calibrate_case(u, D, lam, L, Cext, xs, ys, bounds_C0, bounds_k):\n    xs = np.asarray(xs, dtype=float)\n    ys = np.asarray(ys, dtype=float)\n\n    # Initial guess: C0 ~ max observed concentration, k ~ small positive\n    C0_init = max(float(np.max(ys)), bounds_C0[0])\n    C0_init = min(C0_init, bounds_C0[1])\n    k_init = max(1e-3, bounds_k[0])\n    k_init = min(k_init, bounds_k[1])\n\n    def residuals(params):\n        C0, k = params\n        Cpred = forward_model(u, D, lam, L, Cext, C0, k, xs)\n        return Cpred - ys\n\n    # Bounds for least_squares\n    lower_bounds = [bounds_C0[0], bounds_k[0]]\n    upper_bounds = [bounds_C0[1], bounds_k[1]]\n\n    res = least_squares(\n        residuals,\n        x0=np.array([C0_init, k_init]),\n        bounds=(lower_bounds, upper_bounds),\n        method='trf',\n        ftol=1e-12,\n        xtol=1e-12,\n        gtol=1e-12,\n        max_nfev=10000\n    )\n    C0_hat, k_hat = float(res.x[0]), float(res.x[1])\n    return C0_hat, k_hat\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: Moderate advection/dispersion, nonzero downstream exchange\n        {\n            \"u\": 0.1, \"D\": 10.0, \"lam\": 1e-4, \"L\": 1000.0, \"Cext\": 0.0,\n            \"xs\": [200.0, 500.0, 800.0],\n            \"ys\": [4.1630, 3.1630, 2.4171],\n            \"bounds_C0\": (0.0, 10.0),\n            \"bounds_k\": (0.0, 0.01),\n        },\n        # Case B: Zero downstream exchange (Neumann zero-flux at downstream)\n        {\n            \"u\": 0.05, \"D\": 5.0, \"lam\": 2e-4, \"L\": 200.0, \"Cext\": 0.0,\n            \"xs\": [50.0, 120.0, 180.0],\n            \"ys\": [2.6045, 2.1921, 2.0047],\n            \"bounds_C0\": (0.0, 5.0),\n            \"bounds_k\": (0.0, 0.01),\n        },\n        # Case C: Strong downstream exchange (Robin close to Dirichlet at downstream)\n        {\n            \"u\": 0.05, \"D\": 1.0, \"lam\": 1e-3, \"L\": 80.0, \"Cext\": 1.0,\n            \"xs\": [10.0, 40.0, 80.0],\n            \"ys\": [0.4291, 0.2788, 0.2550],\n            \"bounds_C0\": (0.0, 2.0),\n            \"bounds_k\": (0.0, 0.1),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        C0_hat, k_hat = calibrate_case(\n            u=case[\"u\"], D=case[\"D\"], lam=case[\"lam\"], L=case[\"L\"], Cext=case[\"Cext\"],\n            xs=case[\"xs\"], ys=case[\"ys\"],\n            bounds_C0=case[\"bounds_C0\"], bounds_k=case[\"bounds_k\"]\n        )\n        # Round results to a reasonable number of decimals for clean output\n        C0_hat_r = round(C0_hat, 6)\n        k_hat_r = round(k_hat, 6)\n        results.append([C0_hat_r, k_hat_r])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}