{
    "hands_on_practices": [
        {
            "introduction": "This exercise provides fundamental practice in implementing boundary conditions for transport equations, the bedrock of many environmental models. You will compare the Finite Difference and Finite Volume methods for calculating boundary fluxes, gaining insight into how these common discretization strategies handle the interplay of advection and diffusion at the domain's edge. Mastering this skill is essential for ensuring that numerical models are both accurate and physically consistent. ",
            "id": "3866398",
            "problem": "Consider a one-dimensional, uniform, prismatic channel of length $L$ with constant cross-sectional area $A$. A passive tracer with concentration $c(x,t)$ is transported by advection with constant velocity $u$ (assumed spatially uniform) and diffuses with constant molecular diffusivity $K$ (assumed spatially uniform). The governing conservation law is the advection-diffusion Partial Differential Equation (PDE)\n$$\n\\frac{\\partial (A\\,c)}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0,\n$$\nwhere the total flux $F(x,t)$ combines advective and diffusive contributions,\n$$\nF(x,t) = A\\big(u\\,c(x,t) - K\\,\\frac{\\partial c}{\\partial x}(x,t)\\big).\n$$\nAssume that the initial condition at time $t=0$ is a linear concentration profile $c(x,0) = c_0 + \\alpha\\,x$ on the closed interval $x\\in[0,L]$, with Dirichlet boundary conditions $c(0,t)=c_L$ and $c(L,t)=c_R$ that are consistent with the linear profile, namely $c_L = c_0$ and $c_R = c_0 + \\alpha\\,L$. Throughout this problem take $A$ as constant and equal to $A=1\\,\\text{m}^2$.\n\nYour task is to derive, implement, and evaluate the boundary fluxes $F(0,t)$ and $F(L,t)$ at $t=0$ using two discretization approaches:\n\n1. Finite Difference (FD): Use a node-based grid with uniform spacing $\\Delta x$ and nodes at $x_j=j\\,\\Delta x$ for $j\\in\\{0,1,\\dots,N\\}$ where $N\\,\\Delta x=L$. At each boundary, approximate the spatial gradient $\\frac{\\partial c}{\\partial x}$ using a second-order one-sided difference based only on values at the boundary node and its nearest interior neighbors. Use the Dirichlet boundary values for $c(0)$ and $c(L)$ in the advective contribution. From first principles via Taylor series expansion, derive the second-order one-sided difference formulas for $\\frac{\\partial c}{\\partial x}$ at $x=0$ and $x=L$, and use these to approximate $F(0)$ and $F(L)$ at $t=0$.\n\n2. Finite Volume (FV): Use a cell-centered grid with $N$ uniform cells of width $\\Delta x=L/N$ and centers at $x_i=(i+\\frac{1}{2})\\,\\Delta x$ for $i\\in\\{0,1,\\dots,N-1\\}$. Evaluate the boundary face fluxes using:\n   - An upwind reconstruction for the advective flux at the boundary face:\n     - At $x=0$, if $u>0$ use the boundary inflow value $c_L$ at the face; if $u<0$ use the adjacent interior cell-center value $c_0$.\n     - At $x=L$, if $u>0$ use the adjacent interior cell-center value $c_{N-1}$; if $u<0$ use the boundary inflow value $c_R$.\n   - A linear reconstruction for the diffusive flux gradient at the boundary face based on the Dirichlet boundary value and the adjacent interior cell-center value, consistent with Fick's law. Derive the face gradient expressions at $x=0$ and $x=L$ using the assumption of a linear profile between the boundary and the nearest cell center.\n\nStarting from the conservation law and the definitions above, derive expressions for the net rate of mass change inside the domain due to boundary fluxes at $t=0$,\n$$\n\\dot{M}_{\\text{boundary}} = F(0) - F(L),\n$$\nfor both the Finite Difference and Finite Volume methods. Explain and justify all approximations from first principles.\n\nImplementation requirements:\n- Discretize the domain according to each method with the same number of subdivisions $N$ and length $L$.\n- Construct the initial concentration field from $c(x,0)=c_0+\\alpha\\,x$ and enforce $c_L=c_0$ and $c_R=c_0+\\alpha\\,L$.\n- Compute $F(0)$ and $F(L)$ at $t=0$ for both methods and then compute $\\dot{M}_{\\text{boundary}}$ as defined above.\n- Express each final result in $\\text{kg/s}$.\n\nTest suite:\nFor each test case below, use the specified parameters and compute two results: the Finite Difference net boundary mass rate $\\dot{M}_{\\text{FD}}$ and the Finite Volume net boundary mass rate $\\dot{M}_{\\text{FV}}$, both at $t=0$. Use $A=1\\,\\text{m}^2$ in all cases.\n\n- Case $1$ (baseline linear profile, positive advection, nonzero diffusion):\n  - $N=100$, $L=10\\,\\text{m}$, $u=0.5\\,\\text{m/s}$, $K=0.1\\,\\text{m}^2/\\text{s}$, $c_0=1.0\\,\\text{kg/m}^3$, $\\alpha=0.05\\,\\text{kg/m}^4$.\n\n- Case $2$ (pure advection, negative linear slope):\n  - $N=50$, $L=20\\,\\text{m}$, $u=1.2\\,\\text{m/s}$, $K=0.0\\,\\text{m}^2/\\text{s}$, $c_0=0.8\\,\\text{kg/m}^3$, $\\alpha=-0.02\\,\\text{kg/m}^4$.\n\n- Case $3$ (negative advection, positive diffusion):\n  - $N=80$, $L=8\\,\\text{m}$, $u=-0.4\\,\\text{m/s}$, $K=0.05\\,\\text{m}^2/\\text{s}$, $c_0=2.0\\,\\text{kg/m}^3$, $\\alpha=0.1\\,\\text{kg/m}^4$.\n\n- Case $4$ (degenerate case, zero advection and zero slope):\n  - $N=2$, $L=1\\,\\text{m}$, $u=0.0\\,\\text{m/s}$, $K=0.2\\,\\text{m}^2/\\text{s}$, $c_0=1.0\\,\\text{kg/m}^3$, $\\alpha=0.0\\,\\text{kg/m}^4$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the eight values in the following order and expressed in $\\text{kg/s}$:\n$$\n[\\dot{M}_{\\text{FD},1},\\dot{M}_{\\text{FV},1},\\dot{M}_{\\text{FD},2},\\dot{M}_{\\text{FV},2},\\dot{M}_{\\text{FD},3},\\dot{M}_{\\text{FV},3},\\dot{M}_{\\text{FD},4},\\dot{M}_{\\text{FV},4}]\n$$\nwhere the subscript indicates the test case number. The numerical results must be floats.",
            "solution": "The problem requires the derivation and calculation of the net rate of mass change due to boundary fluxes, $\\dot{M}_{\\text{boundary}} = F(0,t) - F(L,t)$, at time $t=0$ for a one-dimensional advection-diffusion process. The initial concentration is a linear profile, $c(x,0) = c_0 + \\alpha x$. The area $A$ is constant and equal to $1\\,\\text{m}^2$. The flux is given by $F(x,t) = A\\big(u\\,c(x,t) - K\\,\\frac{\\partial c}{\\partial x}(x,t)\\big)$. We will analyze two numerical discretization methods: Finite Difference (FD) and Finite Volume (FV).\n\nFirst, let us establish the exact analytical value at $t=0$. The initial concentration profile is $c(x,0) = c_0 + \\alpha x$. The exact spatial gradient at $t=0$ is constant throughout the domain: $\\frac{\\partial c}{\\partial x}(x,0) = \\alpha$.\nThe exact boundary fluxes at $t=0$ are:\n$F(0,0) = A(u\\,c(0,0) - K\\,\\frac{\\partial c}{\\partial x}|_{x=0}) = A(u\\,c_0 - K\\,\\alpha)$.\n$F(L,0) = A(u\\,c(L,0) - K\\,\\frac{\\partial c}{\\partial x}|_{x=L}) = A(u\\,(c_0 + \\alpha L) - K\\,\\alpha)$.\nThe exact net rate of mass change due to boundary fluxes is:\n$\\dot{M}_{\\text{exact}} = F(0,0) - F(L,0) = A(u\\,c_0 - K\\,\\alpha) - A(u\\,(c_0+\\alpha L) - K\\,\\alpha) = A(u c_0 - K\\alpha - u c_0 - u\\alpha L + K\\alpha) = -A u \\alpha L$.\n\n**1. Finite Difference (FD) Method**\n\nThe FD method uses a node-based grid with $N+1$ nodes $x_j = j\\,\\Delta x$ for $j \\in \\{0, 1, \\dots, N\\}$, where $\\Delta x = L/N$. The nodal concentrations at $t=0$ are $c_j = c(x_j,0) = c_0 + \\alpha x_j = c_0 + \\alpha j \\Delta x$. The boundary values are $c_0 = c_L$ and $c_N = c_R$.\n\nWe must derive second-order one-sided finite difference formulas for the gradient $\\frac{\\partial c}{\\partial x}$ at the boundaries.\n\nAt the left boundary, $x=x_0=0$, we use the nodes $x_0$, $x_1$, and $x_2$. The Taylor series expansions of $c(x)$ around $x_0$ are:\n$c(x_1) = c(x_0+\\Delta x) = c_0 + \\Delta x \\left(\\frac{\\partial c}{\\partial x}\\right)_0 + \\frac{\\Delta x^2}{2} \\left(\\frac{\\partial^2 c}{\\partial x^2}\\right)_0 + O(\\Delta x^3)$\n$c(x_2) = c(x_0+2\\Delta x) = c_0 + 2\\Delta x \\left(\\frac{\\partial c}{\\partial x}\\right)_0 + \\frac{(2\\Delta x)^2}{2} \\left(\\frac{\\partial^2 c}{\\partial x^2}\\right)_0 + O(\\Delta x^3)$\nTo eliminate the second derivative term, we compute $4c(x_1) - c(x_2)$:\n$4c(x_1) - c(x_2) = (4c_0 + 4\\Delta x (\\frac{\\partial c}{\\partial x})_0 + 2\\Delta x^2 (\\frac{\\partial^2 c}{\\partial x^2})_0) - (c_0 + 2\\Delta x (\\frac{\\partial c}{\\partial x})_0 + 2\\Delta x^2 (\\frac{\\partial^2 c}{\\partial x^2})_0) + O(\\Delta x^3)$\n$4c(x_1) - c(x_2) = 3c_0 + 2\\Delta x \\left(\\frac{\\partial c}{\\partial x}\\right)_0 + O(\\Delta x^3)$\nSolving for the gradient gives the second-order forward difference formula:\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FD}} = \\frac{-3c(x_0,0) + 4c(x_1,0) - c(x_2,0)}{2\\Delta x} + O(\\Delta x^2)$.\n\nAt the right boundary, $x=x_N=L$, we use nodes $x_N$, $x_{N-1}$, and $x_{N-2}$. By a similar Taylor expansion around $x_N$, we derive the second-order backward difference formula:\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FD}} = \\frac{3c(x_N,0) - 4c(x_{N-1},0) + c(x_{N-2},0)}{2\\Delta x} + O(\\Delta x^2)$.\n\nFor the initial linear profile $c(x,0) = c_0 + \\alpha x$, let's evaluate these gradient approximations:\nAt $x=0$: $c(x_0,0)=c_0$, $c(x_1,0)=c_0+\\alpha\\Delta x$, $c(x_2,0)=c_0+2\\alpha\\Delta x$.\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FD}} = \\frac{-3c_0 + 4(c_0+\\alpha\\Delta x) - (c_0+2\\alpha\\Delta x)}{2\\Delta x} = \\frac{(-3+4-1)c_0 + (4\\alpha-2\\alpha)\\Delta x}{2\\Delta x} = \\frac{2\\alpha\\Delta x}{2\\Delta x} = \\alpha$.\nThe approximation is exact because a second-order formula is exact for polynomials of degree up to $2$.\n\nAt $x=L$: $c(x_N,0)=c_0+\\alpha L$, $c(x_{N-1},0)=c_0+\\alpha(L-\\Delta x)$, $c(x_{N-2},0)=c_0+\\alpha(L-2\\Delta x)$.\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FD}} = \\frac{3(c_0+\\alpha L) - 4(c_0+\\alpha(L-\\Delta x)) + (c_0+\\alpha(L-2\\Delta x))}{2\\Delta x} = \\frac{(3-4+1)(c_0+\\alpha L) + (4\\alpha-2\\alpha)\\Delta x}{2\\Delta x} = \\frac{2\\alpha\\Delta x}{2\\Delta x} = \\alpha$.\nThe approximation is again exact.\n\nThe boundary fluxes at $t=0$ for the FD method are:\n$F_{\\text{FD}}(0,0) = A(u\\,c(0,0) - K\\,\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FD}}) = A(u\\,c_0 - K\\,\\alpha)$.\n$F_{\\text{FD}}(L,0) = A(u\\,c(L,0) - K\\,\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FD}}) = A(u\\,(c_0+\\alpha L) - K\\,\\alpha)$.\nThe net rate of mass change is:\n$\\dot{M}_{\\text{FD}} = F_{\\text{FD}}(0,0) - F_{\\text{FD}}(L,0) = A(u\\,c_0-K\\alpha) - A(u(c_0+\\alpha L)-K\\alpha) = -A u \\alpha L$.\nThis is identical to the analytical result.\n\n**2. Finite Volume (FV) Method**\n\nThe FV method uses a cell-centered grid of $N$ cells, where cell $i$ has width $\\Delta x = L/N$ and center $x_i = (i+\\frac{1}{2})\\Delta x$ for $i \\in \\{0, \\dots, N-1\\}$. The domain boundaries are cell faces at $x=0$ and $x=L$. The cell-averaged concentration at $t=0$ for cell $i$ is:\n$c_i = \\frac{1}{\\Delta x}\\int_{i\\Delta x}^{(i+1)\\Delta x} (c_0+\\alpha x)dx = c_0 + \\alpha (i+\\frac{1}{2})\\Delta x = c(x_i, 0)$.\nThe cell-averaged value is equal to the value at the cell center for a linear profile.\n\nThe total flux at a face is the sum of advective and diffusive fluxes, $F = F_{adv} + F_{diff}$. We evaluate these at the boundary faces $x=0$ and $x=L$.\n\nThe diffusive flux $F_{diff} = -A K \\frac{\\partial c}{\\partial x}$ requires a gradient approximation at the faces. The problem specifies a linear reconstruction between the boundary and the nearest cell center.\nAt the left face $x=0$, the gradient is approximated using the boundary value $c_L=c_0$ at $x=0$ and the cell-center value $c_{cell,0}$ at $x_{cell,0}=\\Delta x/2$.\n$c_{cell,0} = c_0 + \\alpha (\\Delta x/2)$.\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=0, \\text{FV}} = \\frac{c_{cell,0} - c_L}{x_{cell,0} - 0} = \\frac{(c_0+\\alpha\\Delta x/2) - c_0}{\\Delta x/2} = \\alpha$.\nAt the right face $x=L$, the gradient uses the boundary value $c_R=c_0+\\alpha L$ at $x=L$ and the cell-center value $c_{cell,N-1}$ at $x_{cell,N-1}=L-\\Delta x/2$.\n$c_{cell,N-1} = c_0 + \\alpha(L-\\Delta x/2)$.\n$\\left(\\frac{\\partial c}{\\partial x}\\right)_{x=L, \\text{FV}} = \\frac{c_R - c_{cell,N-1}}{L - x_{cell,N-1}} = \\frac{(c_0+\\alpha L) - (c_0+\\alpha(L-\\Delta x/2))}{\\Delta x/2} = \\alpha$.\nFor the linear initial profile, the diffusive flux gradient approximation is exact for the FV method.\n\nThe advective flux $F_{adv} = A u c_{face}$ uses an upwind scheme for the concentration $c_{face}$ at the face.\nAt the left face $x=0$:\nIf $u \\ge 0$ (inflow from boundary), $c_{face,0} = c_L = c_0$.\nIf $u < 0$ (outflow from domain), $c_{face,0} = c_{cell,0} = c_0 + \\alpha \\Delta x/2$.\nAt the right face $x=L$:\nIf $u > 0$ (outflow from domain), $c_{face,L} = c_{cell,N-1} = c_0 + \\alpha(L - \\Delta x/2)$.\nIf $u \\le 0$ (inflow from boundary), $c_{face,L} = c_R = c_0 + \\alpha L$.\n\nThe total boundary fluxes at $t=0$ for the FV method are:\n$F_{\\text{FV}}(0,0) = A(u\\,c_{face,0} - K\\,\\alpha)$.\n$F_{\\text{FV}}(L,0) = A(u\\,c_{face,L} - K\\,\\alpha)$.\nThe net rate of mass change is:\n$\\dot{M}_{\\text{FV}} = F_{\\text{FV}}(0,0) - F_{\\text{FV}}(L,0) = A u (c_{face,0} - c_{face,L})$.\n\nWe analyze this based on the sign of $u$:\nCase $u > 0$: $\\dot{M}_{\\text{FV}} = A u (c_L - c_{cell,N-1}) = A u (c_0 - (c_0 + \\alpha(L - \\Delta x/2))) = -A u \\alpha(L - \\Delta x/2)$.\nCase $u < 0$: $\\dot{M}_{\\text{FV}} = A u (c_{cell,0} - c_R) = A u ((c_0 + \\alpha \\Delta x/2) - (c_0 + \\alpha L)) = A u \\alpha(\\Delta x/2 - L) = -A u \\alpha(L - \\Delta x/2)$.\nCase $u = 0$: $\\dot{M}_{\\text{FV}} = 0$.\n\nAll cases are described by the single formula, substituting $\\Delta x = L/N$:\n$\\dot{M}_{\\text{FV}} = -A u \\alpha (L - \\frac{\\Delta x}{2}) = -A u \\alpha L (1 - \\frac{1}{2N})$.\nThis result differs from the exact solution due to the first-order upwind approximation for the advective flux term. The error is proportional to $1/N$ and vanishes as $N \\to \\infty$.\n\n**Summary of Formulas for Implementation**\nGiven $A=1\\,\\text{m}^2$.\nFor the Finite Difference method:\n$\\dot{M}_{\\text{FD}} = -u \\alpha L$\nFor the Finite Volume method:\n$\\dot{M}_{\\text{FV}} = -u \\alpha L (1 - \\frac{1}{2N})$\n\nThese formulas will be used to compute the results for the given test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the net rate of mass change due to boundary fluxes at t=0\n    for an advection-diffusion problem using Finite Difference and Finite Volume methods.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (N, L, u, K, c0, alpha)\n    test_cases = [\n        # Case 1 (baseline linear profile, positive advection, nonzero diffusion)\n        (100, 10.0, 0.5, 0.1, 1.0, 0.05),\n        # Case 2 (pure advection, negative linear slope)\n        (50, 20.0, 1.2, 0.0, 0.8, -0.02),\n        # Case 3 (negative advection, positive diffusion)\n        (80, 8.0, -0.4, 0.05, 2.0, 0.1),\n        # Case 4 (degenerate case, zero advection and zero slope)\n        (2, 1.0, 0.0, 0.2, 1.0, 0.0),\n    ]\n\n    # Area A is constant and equal to 1 m^2.\n    A = 1.0\n\n    results = []\n    for N, L, u, K, c0, alpha in test_cases:\n        # --- Finite Difference (FD) Calculation ---\n        # The net rate of mass change due to boundary fluxes is M_dot = F(0) - F(L).\n        # For the FD method with second-order one-sided differences, the gradient\n        # approximation for a linear profile is exact. The resulting formula is:\n        # M_dot_FD = -A * u * alpha * L\n        M_dot_FD = -A * u * alpha * L\n\n        # --- Finite Volume (FV) Calculation ---\n        # For the FV method with upwinding for advection and linear reconstruction\n        # for the diffusive gradient, the formula is:\n        # M_dot_FV = -A * u * alpha * L * (1 - 1/(2*N))\n        # This formula holds for u > 0, u < 0, and u = 0.\n        if N > 0:\n            M_dot_FV = -A * u * alpha * L * (1.0 - 1.0 / (2.0 * N))\n        else:\n            # This case should not be reached with the given test data,\n            # but as a fallback, we can consider the limit N -> infinity,\n            # though an N of 0 is physically meaningless here.\n            M_dot_FV = -A * u * alpha * L\n\n        results.append(M_dot_FD)\n        results.append(M_dot_FV)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving beyond fixed domains, this problem tackles the classic Stefan problem of a moving phase-change boundary, such as the formation of ice on a lake. You will derive the similarity solution that governs the ice growth, connecting the temperature gradient to the interface velocity through the fundamental principle of energy conservation at the boundary. This practice is crucial for modeling a wide range of Earth system processes involving phase transitions, from melting glaciers to permafrost thaw. ",
            "id": "3866373",
            "problem": "Consider a one-dimensional semi-infinite domain $x \\ge 0$ representing a water body undergoing freezing into ice from the surface at $x=0$. Let $x = s(t)$ denote the moving solid-liquid interface at time $t \\ge 0$. Assume a one-phase Stefan formulation in which the nascent solid (ice) occupies $0 \\le x \\le s(t)$ and the remaining region $x > s(t)$ is liquid at the melting temperature $T_m$. The temperature field $T(x,t)$ in the solid satisfies the heat conduction Partial Differential Equation (PDE)\n$$\n\\frac{\\partial T}{\\partial t} = \\alpha \\frac{\\partial^2 T}{\\partial x^2},\n$$\nwhere $\\alpha$ is the thermal diffusivity of the solid, and $\\alpha = \\frac{k}{\\rho c}$ with $k$ the thermal conductivity, $\\rho$ the density, and $c$ the specific heat capacity of the solid. The surface boundary condition at $x=0$ is a constant temperature $T(0,t)=T_s$ for all $t>0$, where $T_s < T_m$. The interface is at the melting temperature $T(s(t),t)=T_m$. The Stefan condition at $x=s(t)$ enforces energy conservation at the moving boundary. Neglect heat conduction in the liquid, and assume the initial condition $T(x,0)=T_m$ for $x>0$, and $s(0)=0$.\n\nStarting only from the fundamental laws of energy conservation and Fourier's law of heat conduction, together with the stated boundary and initial conditions, perform the following:\n\n1. Derive a self-similar representation for the solution and show that the temperature field in the solid can be written in terms of a dimensionless similarity variable $\\eta = \\frac{x}{2\\sqrt{\\alpha t}}$ and a function $\\theta(\\eta) = \\frac{T(x,t)-T_s}{T_m - T_s}$ that satisfies a second-order Ordinary Differential Equation (ODE) derived from the PDE, along with appropriate boundary conditions at $\\eta=0$ and $\\eta=\\lambda$, where $\\lambda = \\frac{s(t)}{2\\sqrt{\\alpha t}}$.\n\n2. Using the Stefan condition at the interface and the similarity solution structure, derive a nonlinear equation for the similarity parameter $\\lambda$ in terms of the Stefan number $\\mathrm{Ste} = \\frac{c (T_m - T_s)}{L}$, where $L$ is the latent heat of fusion per unit mass. Your derivation must be demonstrably consistent with the energy balance at the moving boundary. Do not assume or quote any pre-existing formula for $\\lambda$; instead, arrive at the equation systematically from the governing principles.\n\n3. From the derived similarity solution, determine formulas for the interface position $s(t)$ and interface speed $v(t) = \\frac{ds}{dt}$, expressed in terms of the material properties and the similarity parameter $\\lambda$. Ensure that your expressions are dimensionally consistent.\n\n4. Implement a complete program that, given parameters $(\\rho, c, k, L, T_m, T_s)$ and a specified set of times $t$, computes $\\lambda$ by numerically solving the derived nonlinear equation, then computes $s(t)$ and $v(t)$ at the largest time in the set. The numerical outputs must be expressed in the following units:\n   - Interface position $s(t)$ in meters (m).\n   - Interface speed $v(t)$ in meters per second (m/s).\n   Round each computed quantity to six decimal places.\n\nThe program must solve the problem for the following test suite. Each test case consists of $(\\rho, c, k, L, T_m, T_s)$ and a list of times in seconds.\n\n- Test Case A (temperate lake ice formation):\n  - $\\rho = 917 \\, \\mathrm{kg/m^3}$, $c = 2100 \\, \\mathrm{J/(kg\\,K)}$, $k = 2.22 \\, \\mathrm{W/(m\\,K)}$, $L = 334000 \\, \\mathrm{J/kg}$, $T_m = 273.15 \\, \\mathrm{K}$, $T_s = 268.15 \\, \\mathrm{K}$.\n  - Times $t = [3600, 21600, 86400]$.\n\n- Test Case B (brine-influenced sea-ice formation):\n  - $\\rho = 920 \\, \\mathrm{kg/m^3}$, $c = 1900 \\, \\mathrm{J/(kg\\,K)}$, $k = 1.60 \\, \\mathrm{W/(m\\,K)}$, $L = 300000 \\, \\mathrm{J/kg}$, $T_m = 271.15 \\, \\mathrm{K}$, $T_s = 260.15 \\, \\mathrm{K}$.\n  - Times $t = [7200, 43200, 172800]$.\n\n- Test Case C (freezing in cryotic soil with depressed melting point):\n  - $\\rho = 1600 \\, \\mathrm{kg/m^3}$, $c = 1500 \\, \\mathrm{J/(kg\\,K)}$, $k = 1.50 \\, \\mathrm{W/(m\\,K)}$, $L = 250000 \\, \\mathrm{J/kg}$, $T_m = 268.15 \\, \\mathrm{K}$, $T_s = 258.15 \\, \\mathrm{K}$.\n  - Times $t = [3600, 43200, 259200]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output in order the three interface positions $s(t)$ (in meters) corresponding to the given times (in ascending order), followed by the interface speed $v(t)$ (in meters per second) evaluated at the largest time in that test case. Aggregate the outputs for Test Case A, then B, then C, in that sequence, yielding a single flat list. For example, the output format must be exactly of the form\n$$\n[\\text{sA1},\\text{sA2},\\text{sA3},\\text{vA3},\\text{sB1},\\text{sB2},\\text{sB3},\\text{vB3},\\text{sC1},\\text{sC2},\\text{sC3},\\text{vC3}],\n$$\nwhere every entry is a float rounded to six decimal places and represents meters for $s$ and meters per second for $v$.",
            "solution": "The problem is a one-dimensional, one-phase Stefan problem, which describes the growth of a solid phase (ice) into a liquid phase (water) at its melting temperature. We will first derive the similarity solution and the governing equation for the interface position, then implement a numerical solution.\n\n### Part 1: Derivation of the Similarity Solution and Governing ODE\n\nThe temperature distribution $T(x,t)$ in the solid phase ($0 \\le x \\le s(t)$) is governed by the one-dimensional heat conduction equation:\n$$\n\\frac{\\partial T}{\\partial t} = \\alpha \\frac{\\partial^2 T}{\\partial x^2}\n$$\nwhere $\\alpha = k/(\\rho c)$ is the thermal diffusivity. The boundary and initial conditions are:\n1.  Constant temperature at the surface: $T(0,t) = T_s$ for $t > 0$.\n2.  Melting temperature at the interface: $T(s(t),t) = T_m$ for $t > 0$.\n3.  Initial condition: $s(0)=0$.\n\nThis problem lacks a characteristic length scale, which suggests a self-similar solution. We introduce the dimensionless similarity variable $\\eta$:\n$$\n\\eta = \\frac{x}{2\\sqrt{\\alpha t}}\n$$\nWe also introduce a dimensionless temperature $\\theta(\\eta)$:\n$$\n\\theta(\\eta) = \\frac{T(x,t)-T_s}{T_m - T_s}\n$$\nThe original temperature field is thus $T(x,t) = T_s + (T_m-T_s)\\theta(\\eta)$.\n\nWe transform the partial derivatives of $T$ with respect to $x$ and $t$ into derivatives of $\\theta$ with respect to $\\eta$ using the chain rule.\nThe derivative with respect to time $t$ is:\n$$\n\\frac{\\partial T}{\\partial t} = (T_m - T_s) \\frac{d\\theta}{d\\eta} \\frac{\\partial \\eta}{\\partial t} = (T_m - T_s) \\frac{d\\theta}{d\\eta} \\left( \\frac{x}{2\\sqrt{\\alpha}} \\left(-\\frac{1}{2}\\right) t^{-3/2} \\right) = -(T_m - T_s) \\frac{d\\theta}{d\\eta} \\frac{x}{4\\sqrt{\\alpha}t^{3/2}} = -(T_m - T_s) \\frac{d\\theta}{d\\eta} \\frac{\\eta}{2t}\n$$\nThe partial derivatives with respect to space $x$ are:\n$$\n\\frac{\\partial T}{\\partial x} = (T_m - T_s) \\frac{d\\theta}{d\\eta} \\frac{\\partial \\eta}{\\partial x} = (T_m - T_s) \\frac{d\\theta}{d\\eta} \\left( \\frac{1}{2\\sqrt{\\alpha t}} \\right)\n$$\n$$\n\\frac{\\partial^2 T}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left( (T_m - T_s) \\frac{d\\theta}{d\\eta} \\frac{1}{2\\sqrt{\\alpha t}} \\right) = (T_m - T_s) \\frac{d^2\\theta}{d\\eta^2} \\left( \\frac{\\partial \\eta}{\\partial x} \\right) \\frac{1}{2\\sqrt{\\alpha t}} = (T_m - T_s) \\frac{d^2\\theta}{d\\eta^2} \\frac{1}{4\\alpha t}\n$$\nSubstituting these expressions into the heat equation:\n$$\n-(T_m - T_s) \\frac{d\\theta}{d\\eta} \\frac{\\eta}{2t} = \\alpha \\left( (T_m - T_s) \\frac{d^2\\theta}{d\\eta^2} \\frac{1}{4\\alpha t} \\right)\n$$\nAfter simplification by canceling common factors $(T_m-T_s)$ and $t$, we obtain the ordinary differential equation (ODE) for $\\theta(\\eta)$:\n$$\n-2\\eta \\frac{d\\theta}{d\\eta} = \\frac{d^2\\theta}{d\\eta^2} \\quad \\implies \\quad \\frac{d^2\\theta}{d\\eta^2} + 2\\eta \\frac{d\\theta}{d\\eta} = 0\n$$\nFor the similarity solution to be valid, the moving boundary $x = s(t)$ must correspond to a constant value of $\\eta$. Let this constant be $\\lambda$. Thus,\n$$\n\\lambda = \\frac{s(t)}{2\\sqrt{\\alpha t}} \\quad \\implies \\quad s(t) = 2\\lambda\\sqrt{\\alpha t}\n$$\nThis form is consistent with the initial condition $s(0)=0$.\n\nNow, we transform the boundary conditions for $T(x,t)$ into boundary conditions for $\\theta(\\eta)$:\n-   At the surface $x=0$, the similarity variable is $\\eta=0$. The boundary condition $T(0,t)=T_s$ becomes:\n    $$\n    \\theta(0) = \\frac{T(0,t)-T_s}{T_m-T_s} = \\frac{T_s-T_s}{T_m-T_s} = 0\n    $$\n-   At the interface $x=s(t)$, the similarity variable is $\\eta=\\lambda$. The boundary condition $T(s(t),t)=T_m$ becomes:\n    $$\n    \\theta(\\lambda) = \\frac{T(s(t),t)-T_s}{T_m-T_s} = \\frac{T_m-T_s}{T_m-T_s} = 1\n    $$\nSo, the dimensionless temperature $\\theta(\\eta)$ satisfies the ODE $\\theta'' + 2\\eta\\theta' = 0$ with boundary conditions $\\theta(0)=0$ and $\\theta(\\lambda)=1$.\n\n### Part 2: Derivation of the Nonlinear Equation for $\\lambda$\n\nThe Stefan condition at the interface $x=s(t)$ represents an energy balance. The latent heat released by the solidification of a thin layer of liquid must be conducted away into the solid. The rate of heat release per unit area due to phase change is $\\rho L \\frac{ds}{dt}$. The rate of heat conduction away from the interface into the solid is given by Fourier's law, $q = -k \\frac{\\partial T}{\\partial x}$. Since heat flows from the warmer interface ($T_m$) into the colder solid (where $T < T_m$), the temperature gradient $\\frac{\\partial T}{\\partial x}$ at the interface is positive, and the heat flux into the solid is in the negative $x$-direction. The magnitude of this heat flux is $k \\left. \\frac{\\partial T}{\\partial x} \\right|_{x=s(t)}$. The energy balance is therefore:\n$$\n\\rho L \\frac{ds}{dt} = k \\left. \\frac{\\partial T}{\\partial x} \\right|_{x=s(t)}\n$$\nTo use this equation, we first need to find the solution for $\\theta(\\eta)$ and then the expressions for $\\frac{ds}{dt}$ and $\\frac{\\partial T}{\\partial x}$.\nLet $u(\\eta) = \\frac{d\\theta}{d\\eta}$. The ODE for $\\theta$ becomes $u' + 2\\eta u = 0$, which is a separable first-order ODE.\n$$\n\\frac{du}{u} = -2\\eta d\\eta \\quad \\implies \\quad \\ln(u) = -\\eta^2 + C_0 \\quad \\implies \\quad u = C_1 e^{-\\eta^2}\n$$\nIntegrating $u(\\eta) = \\frac{d\\theta}{d\\eta}$ with respect to $\\eta$:\n$$\n\\theta(\\eta) = \\int_0^{\\eta} C_1 e^{-\\xi^2} d\\xi + C_2\n$$\nApplying the boundary condition $\\theta(0)=0$:\n$$\n\\theta(0) = \\int_0^{0} C_1 e^{-\\xi^2} d\\xi + C_2 = 0 + C_2 \\quad \\implies \\quad C_2 = 0\n$$\nApplying the boundary condition $\\theta(\\lambda)=1$:\n$$\n\\theta(\\lambda) = C_1 \\int_0^{\\lambda} e^{-\\xi^2} d\\xi = 1\n$$\nThe integral is related to the error function, $\\text{erf}(z) = \\frac{2}{\\sqrt{\\pi}}\\int_0^z e^{-t^2} dt$. So, $\\int_0^{\\lambda} e^{-\\xi^2} d\\xi = \\frac{\\sqrt{\\pi}}{2}\\text{erf}(\\lambda)$.\n$$\nC_1 \\frac{\\sqrt{\\pi}}{2}\\text{erf}(\\lambda) = 1 \\quad \\implies \\quad C_1 = \\frac{2}{\\sqrt{\\pi}\\text{erf}(\\lambda)}\n$$\nThe solution for $\\theta(\\eta)$ and its derivative are:\n$$\n\\theta(\\eta) = \\frac{\\text{erf}(\\eta)}{\\text{erf}(\\lambda)}, \\quad \\text{and} \\quad \\frac{d\\theta}{d\\eta} = \\frac{2}{\\sqrt{\\pi}\\text{erf}(\\lambda)}e^{-\\eta^2}\n$$\nNow we evaluate the terms in the Stefan condition. The interface velocity is:\n$$\n\\frac{ds}{dt} = \\frac{d}{dt}(2\\lambda\\sqrt{\\alpha t}) = 2\\lambda\\sqrt{\\alpha} \\left(\\frac{1}{2}t^{-1/2}\\right) = \\lambda\\sqrt{\\frac{\\alpha}{t}}\n$$\nThe temperature gradient at the interface is:\n$$\n\\left. \\frac{\\partial T}{\\partial x} \\right|_{x=s(t)} = (T_m - T_s) \\left. \\frac{d\\theta}{d\\eta} \\right|_{\\eta=\\lambda} \\left. \\frac{\\partial \\eta}{\\partial x} \\right|_{x=s(t)} = (T_m-T_s) \\left( \\frac{2 e^{-\\lambda^2}}{\\sqrt{\\pi}\\text{erf}(\\lambda)} \\right) \\left( \\frac{1}{2\\sqrt{\\alpha t}} \\right)\n$$\nSubstituting these into the Stefan condition $\\rho L \\frac{ds}{dt} = k \\left. \\frac{\\partial T}{\\partial x} \\right|_{x=s(t)}$:\n$$\n\\rho L \\left( \\lambda\\sqrt{\\frac{\\alpha}{t}} \\right) = k (T_m-T_s) \\left( \\frac{2 e^{-\\lambda^2}}{\\sqrt{\\pi}\\text{erf}(\\lambda)} \\right) \\left( \\frac{1}{2\\sqrt{\\alpha t}} \\right)\n$$\nThe terms $\\sqrt{t}$ cancel, as expected for a similarity solution.\n$$\n\\rho L \\lambda \\sqrt{\\alpha} = \\frac{k(T_m-T_s) e^{-\\lambda^2}}{\\sqrt{\\pi \\alpha} \\text{erf}(\\lambda)}\n$$\nMultiplying by $\\sqrt{\\alpha}$ and reorganizing:\n$$\n\\lambda e^{\\lambda^2} \\text{erf}(\\lambda) = \\frac{k(T_m-T_s)}{\\rho L \\alpha} \\frac{1}{\\sqrt{\\pi}}\n$$\nSubstituting $\\alpha = k/(\\rho c)$:\n$$\n\\lambda e^{\\lambda^2} \\text{erf}(\\lambda) = \\frac{k(T_m-T_s)}{\\rho L (k/\\rho c)} \\frac{1}{\\sqrt{\\pi}} = \\frac{c(T_m-T_s)}{L} \\frac{1}{\\sqrt{\\pi}}\n$$\nRecognizing the Stefan number $\\mathrm{Ste} = \\frac{c(T_m-T_s)}{L}$, we arrive at the final nonlinear (transcendental) equation for the similarity parameter $\\lambda$:\n$$\n\\lambda e^{\\lambda^2} \\text{erf}(\\lambda) = \\frac{\\mathrm{Ste}}{\\sqrt{\\pi}}\n$$\n\n### Part 3: Formulas for Interface Position and Speed\n\nFrom the definition of the similarity solution, we have directly obtained the formulas for the interface position $s(t)$ and speed $v(t) = \\frac{ds}{dt}$:\n-   Interface position:\n    $$\n    s(t) = 2\\lambda\\sqrt{\\alpha t} = 2\\lambda\\sqrt{\\frac{k}{\\rho c}t}\n    $$\n-   Interface speed:\n    $$\n    v(t) = \\lambda\\sqrt{\\frac{\\alpha}{t}} = \\lambda\\sqrt{\\frac{k}{\\rho c t}}\n    $$\nThese expressions are dimensionally consistent. The units of $\\alpha$ are $\\text{m}^2/\\text{s}$, so the units of $s(t)$ are $\\sqrt{(\\text{m}^2/\\text{s}) \\cdot \\text{s}} = \\text{m}$, and the units of $v(t)$ are $\\sqrt{(\\text{m}^2/\\text{s}) / \\text{s}} = \\text{m/s}$.\n\n### Part 4: Numerical Implementation\n\nThe program will execute the following steps for each test case:\n1.  Calculate thermal diffusivity $\\alpha = k/(\\rho c)$.\n2.  Calculate the Stefan number $\\mathrm{Ste} = c(T_m - T_s)/L$.\n3.  Numerically solve the equation $f(\\lambda) = \\lambda e^{\\lambda^2} \\text{erf}(\\lambda) - \\frac{\\mathrm{Ste}}{\\sqrt{\\pi}} = 0$ for $\\lambda > 0$ using a root-finding algorithm.\n4.  Use the obtained value of $\\lambda$ to calculate $s(t)$ for each given time $t$ and $v(t)$ for the largest time.\n5.  Format the results as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\nfrom scipy.special import erf\n\ndef solve():\n    \"\"\"\n    Solves the one-phase Stefan problem for given test cases.\n\n    The solution involves:\n    1. Calculating the Stefan number (Ste) and thermal diffusivity (alpha).\n    2. Numerically solving the transcendental equation for the similarity parameter lambda:\n       lambda * exp(lambda^2) * erf(lambda) = Ste / sqrt(pi)\n    3. Calculating the interface position s(t) and speed v(t) using the derived formulas:\n       s(t) = 2 * lambda * sqrt(alpha * t)\n       v(t) = lambda * sqrt(alpha / t)\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case A (temperate lake ice formation)\n        {\n            \"params\": (917, 2100, 2.22, 334000, 273.15, 268.15),  # (rho, c, k, L, Tm, Ts)\n            \"times\": [3600, 21600, 86400]\n        },\n        # Test Case B (brine-influenced sea-ice formation)\n        {\n            \"params\": (920, 1900, 1.60, 300000, 271.15, 260.15),\n            \"times\": [7200, 43200, 172800]\n        },\n        # Test Case C (freezing in cryotic soil)\n        {\n            \"params\": (1600, 1500, 1.50, 250000, 268.15, 258.15),\n            \"times\": [3600, 43200, 259200]\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        rho, c, k, L, Tm, Ts = case[\"params\"]\n        times = case[\"times\"]\n\n        # 1. Calculate physical parameters\n        alpha = k / (rho * c)  # Thermal diffusivity\n        delta_T = Tm - Ts\n        stefan_number = (c * delta_T) / L\n\n        # 2. Define and solve the equation for lambda\n        # The function whose root we want to find is f(lam) = 0\n        target = stefan_number / np.sqrt(np.pi)\n        \n        def f(lam):\n            if lam <= 0: # The physical solution requires lam > 0\n                return -target \n            return lam * np.exp(lam**2) * erf(lam) - target\n\n        # The function g(lam) = lam * exp(lam^2) * erf(lam) is monotonically increasing for lam > 0.\n        # A bracketing root-finder like brentq is robust.\n        # We can choose a reasonable bracket, e.g., [1e-9, 5.0], as Ste is usually O(1) or smaller,\n        # leading to lambda values that are not excessively large.\n        sol = root_scalar(f, bracket=[1e-9, 5.0], method='brentq')\n        lambda_val = sol.root\n\n        # 3. Calculate interface position and speed\n        case_results = []\n        for t in times:\n            s_t = 2 * lambda_val * np.sqrt(alpha * t)\n            case_results.append(round(s_t, 6))\n\n        t_max = max(times)\n        v_t_max = lambda_val * np.sqrt(alpha / t_max)\n        case_results.append(round(v_t_max, 6))\n\n        all_results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "This practice bridges the gap between theoretical models and real-world applications by demonstrating how to calibrate unknown boundary parameters like upstream concentration $C_0$ and exchange coefficient $k$ from observational data. You will combine an analytical solution of a transport equation with numerical optimization, a core workflow in operational environmental modeling and forecasting. This exercise highlights how to constrain model uncertainty and improve predictive skill by leveraging available measurements. ",
            "id": "3866378",
            "problem": "Consider a one-dimensional, steady-state, conservative-reactive tracer in a uniform open-channel flow segment modeled on the interval $x \\in [0,L]$. The governing equation is derived from conservation of mass and Fickian dispersion with a first-order decay. Under the assumptions of constant advective velocity $u$, constant dispersion coefficient $D$, and constant first-order decay rate $\\lambda$, the steady-state concentration $C(x)$ satisfies\n$$\nD \\frac{d^2 C}{dx^2} - u \\frac{d C}{dx} - \\lambda C = 0.\n$$\nAt the upstream boundary $x=0$, the concentration is prescribed by a Dirichlet boundary condition $C(0)=C_0$, where $C_0$ is unknown and must be calibrated. At the downstream boundary $x=L$, exchange with an external reservoir of concentration $C_{\\mathrm{ext}}$ imposes a Robin boundary condition\n$$\n- D \\frac{dC}{dx}(L) = k \\left( C(L) - C_{\\mathrm{ext}} \\right),\n$$\nwhere $k$ is a nonnegative boundary exchange coefficient (with units of meters per second) that is unknown and must be calibrated.\n\nFundamental base: Starting with the conservation of mass for a scalar tracer in one-dimensional open-channel flow subject to advection, diffusion, and first-order decay, along with standard Dirichlet and Robin boundary conditions, the solution $C(x)$ is of exponential form for constant coefficients. The characteristic equation associated with the linear ordinary differential equation yields two real characteristic rates $r_1$ and $r_2$ (or a repeated rate $r$ in the degenerate case), from which the general solution can be constructed. The boundary conditions determine the integration constants. Calibration is posed as a least-squares minimization problem that tunes the unknown boundary parameters to best reproduce interior concentration observations.\n\nTask: Derive the analytical solution structure, show how boundary conditions determine the integration constants, and implement a computational procedure to calibrate the pair $(C_0, k)$ by minimizing the sum of squared misfits between model predictions and provided interior observations. The calibration must respect physically meaningful bounds: $C_0 \\ge 0$ and $k \\ge 0$.\n\nAnalytical structure (do not use this as a shortcut; you must derive it from the governing equation and boundary conditions): For distinct characteristic rates $r_1$ and $r_2$, the solution takes the form $C(x) = A e^{r_1 x} + B e^{r_2 x}$ for constants $A$ and $B$ determined by the boundary conditions. For a repeated characteristic rate $r$, the solution takes the form $C(x) = (A + B x) e^{r x}$.\n\nCalibration objective: Given location-specific observations $\\{ (x_i, y_i ) \\}$, define the least-squares objective\n$$\nJ(C_0, k) = \\sum_{i} \\left[ C_{\\text{model}}(x_i; C_0, k) - y_i \\right]^2,\n$$\nand compute the minimizing $(C_0, k)$ subject to $C_0 \\ge 0$ and $k \\ge 0$.\n\nUnits: All distances must be in meters, time in seconds, velocity in meters per second, dispersion in square meters per second, decay rate in inverse seconds, exchange coefficient in meters per second, and concentration in milligrams per liter. Your program must return $C_0$ in milligrams per liter and $k$ in meters per second. No angles are involved. No percentages are involved.\n\nTest suite: Use the following three scientifically plausible cases with different regimes to test distinct aspects (happy path, weak-exchange boundary case, strong-exchange boundary case). For each case, the observations are synthetic and consistent with the forward model.\n\n- Case A (happy path, moderate advection and dispersion, nonzero downstream exchange):\n  - $u = 0.1 \\, \\mathrm{m/s}$, $D = 10 \\, \\mathrm{m^2/s}$, $\\lambda = 1\\times 10^{-4} \\, \\mathrm{s^{-1}}$, $L = 1000 \\, \\mathrm{m}$, $C_{\\mathrm{ext}} = 0 \\, \\mathrm{mg/L}$.\n  - Observation locations $x$ are $[200, 500, 800]\\, \\mathrm{m}$.\n  - Observed concentrations $y$ are $[4.1630, 3.1630, 2.4171]\\, \\mathrm{mg/L}$.\n  - The physically reasonable bounds for calibration are $0 \\le C_0 \\le 10$ and $0 \\le k \\le 0.01$.\n\n- Case B (edge case with zero downstream exchange, i.e., pure zero-flux Neumann boundary at the downstream end due to $k=0$):\n  - $u = 0.05 \\, \\mathrm{m/s}$, $D = 5 \\, \\mathrm{m^2/s}$, $\\lambda = 2\\times 10^{-4} \\, \\mathrm{s^{-1}}$, $L = 200 \\, \\mathrm{m}$, $C_{\\mathrm{ext}} = 0 \\, \\mathrm{mg/L}$.\n  - Observation locations $x$ are $[50, 120, 180]\\, \\mathrm{m}$.\n  - Observed concentrations $y$ are $[2.6045, 2.1921, 2.0047]\\, \\mathrm{mg/L}$.\n  - The physically reasonable bounds for calibration are $0 \\le C_0 \\le 5$ and $0 \\le k \\le 0.01$.\n\n- Case C (strong downstream exchange, Robin boundary closely approximates a Dirichlet condition toward the external reservoir):\n  - $u = 0.05 \\, \\mathrm{m/s}$, $D = 1 \\, \\mathrm{m^2/s}$, $\\lambda = 1\\times 10^{-3} \\, \\mathrm{s^{-1}}$, $L = 80 \\, \\mathrm{m}$, $C_{\\mathrm{ext}} = 1 \\, \\mathrm{mg/L}$.\n  - Observation locations $x$ are $[10, 40, 80]\\, \\mathrm{m}$.\n  - Observed concentrations $y$ are $[0.4291, 0.2788, 0.2550]\\, \\mathrm{mg/L}$.\n  - The physically reasonable bounds for calibration are $0 \\le C_0 \\le 2$ and $0 \\le k \\le 0.1$.\n\nYour program should calibrate $(C_0, k)$ for each case by minimizing $J(C_0, k)$ using the forward model derived from the governing equation and boundary conditions above. Use only the provided observations and the stated parameter bounds. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the calibrated parameter pair for a case represented as a two-element list $[C_0, k]$. For example, the output format must be of the form $[[C_{0,A},k_A],[C_{0,B},k_B],[C_{0,C},k_C]]$. All returned $C_0$ values must be in $\\mathrm{mg/L}$ and all returned $k$ values must be in $\\mathrm{m/s}$.",
            "solution": "We begin from the fundamental conservation of mass for a scalar tracer in a one-dimensional open-channel flow with advection, diffusion, and first-order decay. The steady-state balance on the interval $x \\in [0,L]$ is\n$$\n\\frac{d}{dx} \\left( - D \\frac{d C}{dx} + u C \\right) - \\lambda C = 0,\n$$\nwhich, for constant $u$, $D$, and $\\lambda$, reduces to the linear ordinary differential equation\n$$\nD \\frac{d^2 C}{dx^2} - u \\frac{d C}{dx} - \\lambda C = 0.\n$$\nWe seek a solution of the exponential form $C(x) = e^{r x}$ times a constant; substitution yields the characteristic equation\n$$\nD r^2 - u r - \\lambda = 0.\n$$\nThe discriminant is $\\Delta = u^2 + 4 D \\lambda \\ge 0$, so there are two distinct real roots\n$$\nr_1 = \\frac{u + \\sqrt{u^2 + 4 D \\lambda}}{2D}, \\quad r_2 = \\frac{u - \\sqrt{u^2 + 4 D \\lambda}}{2D},\n$$\nunless $\\Delta = 0$, in which case $r_1 = r_2 = r = \\frac{u}{2D}$ is a repeated root. For the generic case of distinct roots, the solution is\n$$\nC(x) = A e^{r_1 x} + B e^{r_2 x},\n$$\nfor constants $A$ and $B$ determined by the boundary conditions. The upstream Dirichlet condition $C(0)=C_0$ specifies\n$$\nA + B = C_0.\n$$\nThe downstream Robin condition $- D C'(L) = k \\left( C(L) - C_{\\mathrm{ext}} \\right)$ gives\n$$\n- D \\left( A r_1 e^{r_1 L} + B r_2 e^{r_2 L} \\right) = k \\left( A e^{r_1 L} + B e^{r_2 L} - C_{\\mathrm{ext}} \\right).\n$$\nCollecting terms yields a $2\\times 2$ linear system for $(A,B)$:\n$$\n\\begin{bmatrix}\n1 & 1 \\\\\n- e^{r_1 L} \\left( D r_1 + k \\right) & - e^{r_2 L} \\left( D r_2 + k \\right)\n\\end{bmatrix}\n\\begin{bmatrix}\nA \\\\ B\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nC_0 \\\\ - k C_{\\mathrm{ext}}\n\\end{bmatrix}.\n$$\nFor the degenerate repeated-root case ($r_1 = r_2 = r$), the general solution is\n$$\nC(x) = (A + B x) e^{r x},\n$$\nwith $A = C_0$ from the upstream Dirichlet boundary condition. The downstream Robin boundary yields\n$$\n- D \\left( B + r (A + B L) \\right) e^{r L} = k \\left( (A + B L) e^{r L} - C_{\\mathrm{ext}} \\right).\n$$\nDividing by $e^{r L}$ and substituting $A = C_0$ gives a linear equation for $B$:\n$$\n- D \\left( B + r C_0 + r B L \\right) = k \\left( C_0 + B L - C_{\\mathrm{ext}} e^{- r L} \\right),\n$$\nwhich can be solved explicitly as\n$$\nB = \\frac{k \\left( C_0 - C_{\\mathrm{ext}} e^{- r L} \\right) + D r C_0}{- D (1 + r L) - k L}.\n$$\n\nWith $(A,B)$ determined, the forward model maps $(C_0,k)$ to interior concentrations. For distinct roots:\n$$\nC_{\\text{model}}(x; C_0, k) = A(C_0,k) e^{r_1 x} + B(C_0,k) e^{r_2 x}.\n$$\nFor repeated root:\n$$\nC_{\\text{model}}(x; C_0, k) = \\left( C_0 + B(C_0,k) x \\right) e^{r x}.\n$$\n\nCalibration problem: Given observations $\\{ (x_i, y_i) \\}$, define the least-squares objective\n$$\nJ(C_0, k) = \\sum_{i} \\left[ C_{\\text{model}}(x_i; C_0, k) - y_i \\right]^2,\n$$\nand compute\n$$\n(C_0^\\star, k^\\star) = \\arg \\min_{C_0 \\ge 0,\\, k \\ge 0} J(C_0, k),\n$$\nsubject to case-specific bounds that reflect physical plausibility.\n\nAlgorithmic design:\n- For each case, compute $r_1$ and $r_2$ from $u$, $D$, and $\\lambda$. If $|r_1 - r_2|$ is smaller than a numerical tolerance, treat it as the repeated-root case; otherwise, use distinct roots.\n- Given a trial $(C_0, k)$, form and solve the $2\\times 2$ linear system for $(A,B)$ in the distinct-roots case, or compute $B$ directly in the repeated-root case.\n- Evaluate $C_{\\text{model}}(x_i; C_0, k)$ and assemble residuals $r_i = C_{\\text{model}}(x_i; C_0, k) - y_i$.\n- Minimize $J(C_0,k) = \\sum_i r_i^2$ with bound constraints using a trust-region reflective method suitable for bound-constrained nonlinear least squares.\n- Use an initial guess of $C_0$ equal to the maximum observed concentration and $k$ equal to a small positive value. Apply case-specific bounds for $C_0$ and $k$.\n\nScientific realism and identifiability considerations:\n- The exponential solution structure derives strictly from the constant-coefficient linear ordinary differential equation and is consistent with advection-diffusion-reaction physics.\n- The chosen cases exercise regimes with moderate advection and dispersion (Case A), zero downstream exchange leading to a Neumann boundary (Case B), and strong downstream exchange approximating a Dirichlet boundary toward the external reservoir (Case C).\n- At least three interior observation locations per case yield an overdetermined system for two boundary parameters, providing a stable least-squares calibration.\n\nOutput:\n- Return a single line containing a list of the calibrated parameter pairs in the format $[[C_{0,A},k_A],[C_{0,B},k_B],[C_{0,C},k_C]]$, with $C_0$ in $\\mathrm{mg/L}$ and $k$ in $\\mathrm{m/s}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef characteristic_rates(u, D, lam):\n    # Compute characteristic rates r1, r2 for the ODE: D r^2 - u r - lam = 0\n    disc = u*u + 4.0*D*lam\n    sqrt_disc = np.sqrt(disc)\n    r1 = (u + sqrt_disc) / (2.0*D)\n    r2 = (u - sqrt_disc) / (2.0*D)\n    return r1, r2\n\ndef forward_profile_distinct_roots(u, D, lam, L, Cext, C0, k, xs):\n    # Distinct roots case: C(x) = A e^{r1 x} + B e^{r2 x}\n    r1, r2 = characteristic_rates(u, D, lam)\n    # If roots are nearly equal, delegate to repeated root handler\n    if abs(r1 - r2) < 1e-12:\n        return forward_profile_repeated_root(u, D, lam, L, Cext, C0, k, xs)\n    E1L = np.exp(r1 * L)\n    E2L = np.exp(r2 * L)\n    # Construct and solve for A, B from boundary conditions\n    # Row1: A + B = C0\n    # Row2: -D * (A*r1*e^{r1 L} + B*r2*e^{r2 L}) = k * (A*e^{r1 L} + B*e^{r2 L} - Cext)\n    M = np.array([\n        [1.0, 1.0],\n        [-E1L * (D * r1 + k), -E2L * (D * r2 + k)]\n    ])\n    rhs = np.array([C0, -k * Cext])\n    # Solve linear system robustly\n    try:\n        AB = np.linalg.solve(M, rhs)\n    except np.linalg.LinAlgError:\n        # Fallback to least-squares solve if singular\n        AB, *_ = np.linalg.lstsq(M, rhs, rcond=None)\n    A, B = AB[0], AB[1]\n    xs = np.asarray(xs)\n    Cx = A * np.exp(r1 * xs) + B * np.exp(r2 * xs)\n    return Cx\n\ndef forward_profile_repeated_root(u, D, lam, L, Cext, C0, k, xs):\n    # Repeated root case: r1 == r2 == r, solution C(x) = (A + B x) e^{r x}, with A = C0\n    r1, r2 = characteristic_rates(u, D, lam)\n    r = 0.5 * (r1 + r2)\n    A = C0\n    e_rL = np.exp(r * L)\n    denom = -D * (1.0 + r * L) - k * L\n    # To avoid division by zero, perturb denominator slightly if nearly zero\n    if abs(denom) < 1e-18:\n        denom = np.sign(denom) * 1e-18 if denom != 0 else 1e-18\n    B = (k * (C0 - Cext * np.exp(-r * L)) + D * r * C0) / denom\n    xs = np.asarray(xs)\n    Cx = (A + B * xs) * np.exp(r * xs)\n    return Cx\n\ndef forward_model(u, D, lam, L, Cext, C0, k, xs):\n    r1, r2 = characteristic_rates(u, D, lam)\n    if abs(r1 - r2) < 1e-12:\n        return forward_profile_repeated_root(u, D, lam, L, Cext, C0, k, xs)\n    else:\n        return forward_profile_distinct_roots(u, D, lam, L, Cext, C0, k, xs)\n\ndef calibrate_case(u, D, lam, L, Cext, xs, ys, bounds_C0, bounds_k):\n    xs = np.asarray(xs, dtype=float)\n    ys = np.asarray(ys, dtype=float)\n\n    # Initial guess: C0 ~ max observed concentration, k ~ small positive\n    C0_init = max(float(np.max(ys)), bounds_C0[0])\n    C0_init = min(C0_init, bounds_C0[1])\n    k_init = max(1e-3, bounds_k[0])\n    k_init = min(k_init, bounds_k[1])\n\n    def residuals(params):\n        C0, k = params\n        Cpred = forward_model(u, D, lam, L, Cext, C0, k, xs)\n        return Cpred - ys\n\n    # Bounds for least_squares\n    lower_bounds = [bounds_C0[0], bounds_k[0]]\n    upper_bounds = [bounds_C0[1], bounds_k[1]]\n\n    res = least_squares(\n        residuals,\n        x0=np.array([C0_init, k_init]),\n        bounds=(lower_bounds, upper_bounds),\n        method='trf',\n        ftol=1e-12,\n        xtol=1e-12,\n        gtol=1e-12,\n        max_nfev=10000\n    )\n    C0_hat, k_hat = float(res.x[0]), float(res.x[1])\n    return C0_hat, k_hat\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: Moderate advection/dispersion, nonzero downstream exchange\n        {\n            \"u\": 0.1, \"D\": 10.0, \"lam\": 1e-4, \"L\": 1000.0, \"Cext\": 0.0,\n            \"xs\": [200.0, 500.0, 800.0],\n            \"ys\": [4.1630, 3.1630, 2.4171],\n            \"bounds_C0\": (0.0, 10.0),\n            \"bounds_k\": (0.0, 0.01),\n        },\n        # Case B: Zero downstream exchange (Neumann zero-flux at downstream)\n        {\n            \"u\": 0.05, \"D\": 5.0, \"lam\": 2e-4, \"L\": 200.0, \"Cext\": 0.0,\n            \"xs\": [50.0, 120.0, 180.0],\n            \"ys\": [2.6045, 2.1921, 2.0047],\n            \"bounds_C0\": (0.0, 5.0),\n            \"bounds_k\": (0.0, 0.01),\n        },\n        # Case C: Strong downstream exchange (Robin close to Dirichlet at downstream)\n        {\n            \"u\": 0.05, \"D\": 1.0, \"lam\": 1e-3, \"L\": 80.0, \"Cext\": 1.0,\n            \"xs\": [10.0, 40.0, 80.0],\n            \"ys\": [0.4291, 0.2788, 0.2550],\n            \"bounds_C0\": (0.0, 2.0),\n            \"bounds_k\": (0.0, 0.1),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        C0_hat, k_hat = calibrate_case(\n            u=case[\"u\"], D=case[\"D\"], lam=case[\"lam\"], L=case[\"L\"], Cext=case[\"Cext\"],\n            xs=case[\"xs\"], ys=case[\"ys\"],\n            bounds_C0=case[\"bounds_C0\"], bounds_k=case[\"bounds_k\"]\n        )\n        # Round results to a reasonable number of decimals for clean output\n        C0_hat_r = round(C0_hat, 6)\n        k_hat_r = round(k_hat, 6)\n        results.append([C0_hat_r, k_hat_r])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}