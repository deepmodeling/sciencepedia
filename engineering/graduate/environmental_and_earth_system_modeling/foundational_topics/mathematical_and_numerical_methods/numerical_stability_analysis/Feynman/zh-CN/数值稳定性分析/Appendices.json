{
    "hands_on_practices": [
        {
            "introduction": "冯·诺伊曼(von Neumann)稳定性分析是研究数值方法的基石，它使我们能够从理论上预测一个数值格式是否会因为误差的累积增长而失效。本练习将此分析方法应用于热传导（或扩散）方程，这是一个在环境模型中描述污染物扩散、土壤热量输运等过程的基本方程。通过这个练习，你将亲手推导出连接时间步长 $\\Delta t$ 和空间网格尺寸 $\\Delta x$ 的著名稳定性条件，深刻理解显式格式在实践中所受到的严格限制。",
            "id": "4047668",
            "problem": "在计算聚变科学与工程中，托卡马克内沿磁力线的平行电子热传导，在主导阶上，通常可以用一维热方程来建模。考虑描述电子温度 $u(x,t)$ 的偏微分方程 $u_{t} = \\kappa \\, u_{xx}$，其中热扩散系数 $\\kappa > 0$ 为常数，定义在周期性域 $x \\in [0,L]$ 上。在均匀网格 $x_{j} = j \\,\\Delta x$ 上对空间进行离散化，其中 $j$ 为整数索引，$\\Delta x = L/N$，$N \\in \\mathbb{N}$ 足够大；并将时间离散化为 $t^{n} = n \\,\\Delta t$，其中 $n$ 为整数索引，$\\Delta t > 0$。考虑在周期性边界条件下，使用显式向前时间中心空间（FTCS）格式，\n$$\nu_{j}^{n+1} \\;=\\; u_{j}^{n} \\;+\\; \\frac{\\kappa \\,\\Delta t}{\\Delta x^{2}} \\left(u_{j+1}^{n} \\;-\\; 2\\,u_{j}^{n} \\;+\\; u_{j-1}^{n}\\right),\n$$\n使用适用于数值稳定性分析的第一性原理，包括导出热方程的能量守恒、一致的有限差分近似以及周期性网格上的离散傅里叶（冯·诺依曼）模态分析，来分析此格式对于网格上可分辨的任意扰动的线性稳定性。确定能保证所有离散傅里叶模态都稳定的最大时间步长。将你的最终答案表示为最大允许时间步长 $\\Delta t_{\\max}$ 关于 $\\kappa$ 和 $\\Delta x$ 的单个闭式符号表达式。最终表达式无需四舍五入，也不应包含单位。你可以在概念上引用 Courant–Friedrichs–Lewy (CFL) 条件，但必须从放大因子出发推导出稳定性限制，不得直接引用任何现成的结论。",
            "solution": "该问题要求推导应用于周期性域上一维热方程 $u_{t} = \\kappa \\, u_{xx}$ 的向前时间中心空间（FTCS）格式的稳定性条件。将使用离散傅里叶（冯·诺依曼）方法进行稳定性分析，以确定最大允许时间步长 $\\Delta t_{\\max}$。\n\n给定的FTCS数值格式为：\n$$\nu_{j}^{n+1} = u_{j}^{n} + \\frac{\\kappa \\,\\Delta t}{\\Delta x^{2}} \\left(u_{j+1}^{n} - 2\\,u_{j}^{n} + u_{j-1}^{n}\\right)\n$$\n其中 $u_j^n$ 是温度 $u(x_j, t^n)$ 的近似值，$\\Delta t$ 是时间步长，$\\Delta x$ 是空间网格间距。\n\n冯·诺依曼稳定性分析假设初始误差分布可以分解为傅里叶级数。由于有限差分格式是线性的，我们可以分析单个傅里叶模态的行为。在网格点 $x_j = j \\Delta x$ 和时间层 $t^n = n \\Delta t$ 的数值解的任意模态可以表示为：\n$$\nu_j^n = \\hat{u}^n(k) e^{i k x_j} = \\hat{u}^n(k) e^{i k j \\Delta x}\n$$\n其中 $k$ 是波数，$i$ 是虚数单位，$\\hat{u}^n(k)$ 是时间层 $n$ 上该模态的振幅。为使格式稳定，每个模态的振幅都不能随时间增长。这可以通过放大因子 $G(k)$ 来量化，其定义关系为：\n$$\n\\hat{u}^{n+1}(k) = G(k) \\hat{u}^n(k)\n$$\n稳定性要求对于网格能分辨的所有可能的波数 $k$，放大因子的模长都小于或等于1，即 $|G(k)| \\le 1$。\n\n为了求得 $G(k)$，我们将傅里叶模态的表示形式代入FTCS格式。\n格式中的各项变为：\n- $u_{j}^{n+1} = \\hat{u}^{n+1}(k) e^{i k j \\Delta x} = G(k) \\hat{u}^{n}(k) e^{i k j \\Delta x}$\n- $u_{j}^{n} = \\hat{u}^{n}(k) e^{i k j \\Delta x}$\n- $u_{j+1}^{n} = \\hat{u}^{n}(k) e^{i k (j+1) \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{i k \\Delta x}$\n- $u_{j-1}^{n} = \\hat{u}^{n}(k) e^{i k (j-1) \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{-i k \\Delta x}$\n\n将这些代入FTCS方程：\n$$\nG(k) \\hat{u}^{n}(k) e^{i k j \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{i k \\Delta x} - 2\\hat{u}^{n}(k) e^{i k j \\Delta x} + \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{-i k \\Delta x} \\right)\n$$\n我们可以将整个方程除以公因子 $\\hat{u}^{n}(k) e^{i k j \\Delta x}$（假设存在非平凡解）：\n$$\nG(k) = 1 + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( e^{i k \\Delta x} - 2 + e^{-i k \\Delta x} \\right)\n$$\n使用欧拉恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$，我们可以简化括号中的表达式：\n$$\nG(k) = 1 + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( 2\\cos(k \\Delta x) - 2 \\right) = 1 - \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\left( 1 - \\cos(k \\Delta x) \\right)\n$$\n为了进一步简化，我们使用三角半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$：\n$$\nG(k) = 1 - \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\left( 2\\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\right) = 1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n放大因子 $G(k)$ 是一个实数。稳定性条件 $|G(k)| \\le 1$ 变为 $-1 \\le G(k) \\le 1$。\n\n让我们分析这两个不等式：\n1.  $G(k) \\le 1$:\n    $$\n    1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1\n    $$\n    $$\n    -\\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 0\n    $$\n    由于 $\\kappa > 0$, $\\Delta t > 0$, $\\Delta x^2 > 0$ 且 $\\sin^2(\\cdot) \\ge 0$，这个不等式总是成立的。\n\n2.  $G(k) \\ge -1$:\n    $$\n    1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\ge -1\n    $$\n    $$\n    2 \\ge \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n    $$\n    两边除以 $2$:\n    $$\n    1 \\ge \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n    $$\n这个不等式必须对网格上能表示的所有波数 $k$ 都成立。无量纲波数的范围是 $k \\Delta x \\in [-\\pi, \\pi]$。为了找到对 $\\Delta t$ 最严格的限制条件，我们必须找到项 $\\sin^2(k \\Delta x / 2)$ 的最大值。$\\sin^2(\\theta)$ 的最大值是 $1$，当 $\\theta = \\pi/2 + m\\pi$ (其中 $m$ 为任意整数)时取到。对于 $k \\Delta x = \\pi$（这对应于网格可以分辨的最高频率，或最短波长 $\\lambda=2\\Delta x$），我们有：\n$$\n\\sin^2\\left(\\frac{\\pi}{2}\\right) = 1\n$$\n这代表了稳定性的“最坏情况”。将这个最大值代入不等式，得到必须满足的稳定性条件：\n$$\n1 \\ge \\frac{2\\kappa \\Delta t}{\\Delta x^2} (1)\n$$\n$$\n\\frac{2\\kappa \\Delta t}{\\Delta x^2} \\le 1\n$$\nFTCS格式要保持稳定，就必须满足此条件。当等号成立时，我们得到最大允许时间步长 $\\Delta t_{\\max}$：\n$$\n\\frac{2\\kappa \\Delta t_{\\max}}{\\Delta x^2} = 1\n$$\n解出 $\\Delta t_{\\max}$：\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x^2}{2\\kappa}\n$$\n这就是一维热方程的显式FTCS方法著名的稳定性约束条件。它表明，为了保持数值稳定性，时间步长必须随着空间网格间距的减小而呈二次方关系减小。",
            "answer": "$$\\boxed{\\frac{\\Delta x^{2}}{2\\kappa}}$$"
        },
        {
            "introduction": "在掌握了扩散方程的稳定性分析之后，我们转向另一个核心物理过程：平流。我们将对同一个前向时间中心空间(FTCS)格式进行分析，但这次是应用于线性平流方程，你将会发现其稳定性表现截然不同。这个练习旨在揭示一个关键概念：一个数值格式的稳定性并非普适属性，它深刻地依赖于其所求解的偏微分方程的内在物理特性，这对于为复杂的地球系统模型选择合适的数值算法至关重要。",
            "id": "3804249",
            "problem": "在计算海洋学中，考虑一个一维纬向通道，其中，一个被动示踪剂场 $c(x,t)$ 被速度为 $U>0$ 的均匀流平流输送。其控制方程是在周期性域上的线性平流方程 $c_{t} + U c_{x} = 0$。设空间网格是均匀的，格距为 $\\Delta x$，时间步长为 $\\Delta t$。考虑将前向时间中心空间（FTCS）有限差分格式应用于此网格上的该平流方程。通过假设一个离散傅里叶模 $c_{j}^{n} = \\hat{c}^{n} \\exp\\!\\left(i j \\theta\\right)$ 来进行冯·诺依曼（傅里葉）稳定性分析，其中 $j$ 是空间索引，$n$ 是时间层，$i$ 是虚数单位，$\\theta$ 是以弧度为单位的无量纲波数。推导由 $\\hat{c}^{n+1} = G(\\theta)\\,\\hat{c}^{n}$ 定义的相应放大因子 $G(\\theta)$，计算其模 $|G(\\theta)|$，并证明对于任意选择的 $\\Delta t$ 和 $\\Delta x$（其中 $U\\neq 0$），都存在一个 $\\theta$ 值使得 $|G(\\theta)|>1$。具体来说，计算在 $\\theta = \\pi/2$ 时的 $|G(\\theta)|$，并提供所得表达式作为最终答案。最终答案必须是单一的闭式解析表达式，不带单位。角度必须以弧度处理。不需要四舍五入。",
            "solution": "所述问题是有效且适定的。它是在计算流体动力学和数值分析中的一个基础课题——线性平流方程有限差分格式的冯·诺依曼稳定性分析中的一个标准练习。所有必要的信息都已提供，术语精确，目标明确。因此，我们可以进行推导。\n\n控制偏微分方程是一维线性平流方程：\n$$\nc_{t} + U c_{x} = 0\n$$\n其中 $c(x,t)$ 是示踪剂浓度，$U$ 是一个正常数速度，$t$ 是时间，$x$ 是空间坐标。\n\n问题指定了前向时间中心空间（FTCS）有限差分格式。我们在时间层 $n$ 和空间位置 $j$ 使用前向差分来离散化时间导数 $c_t$：\n$$\nc_{t} \\approx \\frac{c_{j}^{n+1} - c_{j}^{n}}{\\Delta t}\n$$\n并且我们在相同的时间层 $n$ 和空间位置 $j$ 使用中心差分来离散化空间导数 $c_x$：\n$$\nc_{x} \\approx \\frac{c_{j+1}^{n} - c_{j-1}^{n}}{2\\Delta x}\n$$\n这里，$c_{j}^{n} = c(j\\Delta x, n\\Delta t)$，$\\Delta t$ 是时间步长，$\\Delta x$ 是网格间距。\n\n将这些近似代入控制方程，得到 FTCS 格式：\n$$\n\\frac{c_{j}^{n+1} - c_{j}^{n}}{\\Delta t} + U \\frac{c_{j+1}^{n} - c_{j-1}^{n}}{2\\Delta x} = 0\n$$\n为了进行冯·诺依曼稳定性分析，我们假设解具有单个离散傅里葉模的形式：\n$$\nc_{j}^{n} = \\hat{c}^{n} \\exp(i j \\theta)\n$$\n其中 $\\hat{c}^{n}$ 是在时间层 $n$ 的模的复振幅，$j$ 是空间网格索引，$i$ 是虚数单位，$\\theta = k \\Delta x$ 是无量纲波数，其中 $k$ 是物理波数。\n\n我们将此模态形式代入有限差分格式中。格式中的各项变为：\n$$\nc_{j}^{n+1} = \\hat{c}^{n+1} \\exp(i j \\theta)\n$$\n$$\nc_{j}^{n} = \\hat{c}^{n} \\exp(i j \\theta)\n$$\n$$\nc_{j+1}^{n} = \\hat{c}^{n} \\exp(i (j+1) \\theta) = \\hat{c}^{n} \\exp(i j \\theta) \\exp(i \\theta)\n$$\n$$\nc_{j-1}^{n} = \\hat{c}^{n} \\exp(i (j-1) \\theta) = \\hat{c}^{n} \\exp(i j \\theta) \\exp(-i \\theta)\n$$\n将这些表达式代入 FTCS 方程，得到：\n$$\n\\frac{\\hat{c}^{n+1} \\exp(i j \\theta) - \\hat{c}^{n} \\exp(i j \\theta)}{\\Delta t} + U \\frac{\\hat{c}^{n} \\exp(i j \\theta) \\exp(i \\theta) - \\hat{c}^{n} \\exp(i j \\theta) \\exp(-i \\theta)}{2\\Delta x} = 0\n$$\n假设 $\\hat{c}^{n} \\neq 0$，我们可以将整个方程除以公因子 $\\hat{c}^{n} \\exp(i j \\theta)$：\n$$\n\\frac{\\frac{\\hat{c}^{n+1}}{\\hat{c}^{n}} - 1}{\\Delta t} + U \\frac{\\exp(i \\theta) - \\exp(-i \\theta)}{2\\Delta x} = 0\n$$\n放大因子 $G(\\theta)$ 由关系式 $\\hat{c}^{n+1} = G(\\theta)\\,\\hat{c}^{n}$ 定义。代入此定义：\n$$\n\\frac{G(\\theta) - 1}{\\Delta t} + U \\frac{\\exp(i \\theta) - \\exp(-i \\theta)}{2\\Delta x} = 0\n$$\n使用欧拉恒等式 $\\sin(\\theta) = \\frac{\\exp(i \\theta) - \\exp(-i \\theta)}{2i}$，第二项可以简化为：\n$$\n\\frac{G(\\theta) - 1}{\\Delta t} + U \\frac{2i\\sin(\\theta)}{2\\Delta x} = 0\n$$\n$$\n\\frac{G(\\theta) - 1}{\\Delta t} = -i \\frac{U}{\\Delta x} \\sin(\\theta)\n$$\n求解 $G(\\theta)$：\n$$\nG(\\theta) - 1 = -i \\frac{U \\Delta t}{\\Delta x} \\sin(\\theta)\n$$\n$$\nG(\\theta) = 1 - i \\frac{U \\Delta t}{\\Delta x} \\sin(\\theta)\n$$\n放大因子是一个复数。为使格式稳定，放大因子的模必须对所有可能的 $\\theta$ 值满足 $|G(\\theta)| \\le 1$。我们现在计算这个模。对于一个复数 $z = a + ib$，其模为 $|z| = \\sqrt{a^2 + b^2}$。这里，$a=1$ 且 $b = -\\frac{U\\Delta t}{\\Delta x} \\sin(\\theta)$。\n$$\n|G(\\theta)| = \\sqrt{(1)^2 + \\left(-\\frac{U \\Delta t}{\\Delta x} \\sin(\\theta)\\right)^2}\n$$\n$$\n|G(\\theta)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2(\\theta)}\n$$\n由于 $U$、$\\Delta t$ 和 $\\Delta x$ 是正物理量，项 $\\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2$ 是严格为正的。项 $\\sin^2(\\theta)$ 是非负的。对于任何 $\\sin(\\theta) \\neq 0$ 的 $\\theta$（即 $\\theta$ 不是 $\\pi$ 的整数倍），项 $\\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2(\\theta)$ 是严格为正的。因此，被开方数 $1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2(\\theta)$ 严格大于 $1$，其平方根 $|G(\\theta)|$ 也将严格大于 $1$。这证明了对于任何非零的 $U$、$\\Delta t$ 和 $\\Delta x$，FTCS 格式对于线性平流方程是无条件不稳定的。\n\n问题特别要求计算在 $\\theta = \\frac{\\pi}{2}$ 时的 $|G(\\theta)|$。在这个无量纲波数值下，我们有 $\\sin(\\frac{\\pi}{2}) = 1$。将此代入我们关于 $|G(\\theta)|$ 的表达式中：\n$$\n|G(\\pi/2)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2\\left(\\frac{\\pi}{2}\\right)}\n$$\n$$\n|G(\\pi/2)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 (1)^2}\n$$\n$$\n|G(\\pi/2)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2}\n$$\n这是无量纲波数为 $\\theta=\\frac{\\pi}{2}$ 的模的放大因子模的最终表达式。",
            "answer": "$$\n\\boxed{\\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^{2}}}\n$$"
        },
        {
            "introduction": "现实世界中的环境系统很少是均匀的，这使得纯粹的理论分析变得异常困难。本练习将我们从理想化的解析问题带入更贴近实际的场景，即处理具有空间变化的扩散系数和反应速率的反应扩散过程。在这种情况下，简单的冯·诺伊曼分析不再适用，我们将采用一种强大的半离散化计算方法——“线方法”(Method of Lines)，将稳定性分析与离散算子矩阵的谱特性（即最大特征值）直接联系起来，这是处理复杂非均匀介质问题的标准现代方法。",
            "id": "3899693",
            "problem": "考虑一个通用被动标量在一维环境柱中的输运，其扩散系数 $\\kappa(x)$ 和一阶反应速率 $\\alpha(x)$ 在空间上非均匀。其连续控制定律是质量守恒与菲克扩散和线性反应的结合：标量浓度 $u(x,t)$ 满足以下偏微分方程 (PDE)\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\!\\left(\\kappa(x)\\,\\frac{\\partial u}{\\partial x}\\right) - \\alpha(x)\\,u,\n$$\n作用于域 $x \\in [0,L]$ 上，并具有齐次狄利克雷边界条件 $u(0,t) = 0$ 和 $u(L,t) = 0$。假设对于所有 $x$，都有 $\\kappa(x) \\ge 0$ 和 $\\alpha(x) \\ge 0$。\n\n使用具有 $N$ 个内部点、间距为 $\\Delta x = L/(N+1)$ 的均匀网格对空间算子进行离散化，内部节点位置为 $x_i = i\\,\\Delta x$（对于 $i = 1,\\dots,N$），面位置为 $x_{j+\\frac{1}{2}} = (j+\\tfrac{1}{2})\\,\\Delta x$（对于 $j = 0,\\dots,N$）。在面上计算扩散系数 $\\kappa_{j+\\frac{1}{2}} = \\kappa(x_{j+\\frac{1}{2}})$，在节点上计算反应速率 $\\alpha_i = \\alpha(x_i)$。组装与半离散系统 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}\\,\\mathbf{u}$ 对应的线性离散算子 $\\mathbf{L} \\in \\mathbb{R}^{N \\times N}$，采用具有狄利克雷边界条件的二阶守恒通量形式：\n- 对于 $i = 1,\\dots,N$，\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\frac{1}{\\Delta x}\\left[\\kappa_{i+\\frac{1}{2}}\\,\\frac{u_{i+1}-u_i}{\\Delta x} - \\kappa_{i-\\frac{1}{2}}\\,\\frac{u_i-u_{i-1}}{\\Delta x}\\right] - \\alpha_i\\,u_i,\n$$\n并约定 $u_0 = 0$ 和 $u_{N+1} = 0$。\n\n考虑对半离散系统采用显式前向欧拉时间步进，$ \\mathbf{u}^{n+1} = \\mathbf{u}^{n} + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^{n}$。将稳定性极限定义为最大时间步长 $\\Delta t_{\\max}$（单位为秒），在此步长下，前向欧拉方法对离散算子 $\\mathbf{L}$ 的所有模式保持线性稳定。\n\n任务：\n1. 根据上述规范为每个测试案例组装矩阵 $\\mathbf{L}$。\n2. 通过使用适用于对称正定矩阵的迭代方法计算 $-\\mathbf{L}$ 的最大特征值，来估计所组装矩阵的谱半径 $\\rho(\\mathbf{L})$。\n3. 根据估计的谱半径，计算最大允许的前向欧拉时间步长 $\\Delta t_{\\max}$（单位为秒）。报告所有 $\\Delta t_{\\max}$ 值，四舍五入到 $6$ 位小数。\n4. 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[r_1,r_2,r_3]$）。\n\n单位与约定：\n- 域长度 $L$ 必须以米（$\\mathrm{m}$）为单位指定。\n- 扩散系数 $\\kappa(x)$ 必须以平方米每秒（$\\mathrm{m}^2/\\mathrm{s}$）为单位指定。\n- 反应速率 $\\alpha(x)$ 必须以秒的倒数（$\\mathrm{s}^{-1}$）为单位指定。\n- 最终时间步长 $\\Delta t_{\\max}$ 必须以秒（$\\mathrm{s}$）表示。\n\n测试套件（四个案例，旨在检验不同的非均匀模式和边界条件）：\n\n- 案例 A（平滑非均匀性）：\n    - $L = 100\\,\\mathrm{m}$，$N = 50$，\n    - $\\kappa(x) = 10^{-2}\\,\\big(1 + 0.5 \\sin(2\\pi x / L)\\big)$，\n    - $\\alpha(x) = 10^{-3}\\,\\big(1 + 0.25 \\cos(2\\pi x / L)\\big)$。\n\n- 案例 B（双层介质，无反应）：\n    - $L = 100\\,\\mathrm{m}$，$N = 100$，\n    - $\\kappa(x) = \\begin{cases}\n        5 \\times 10^{-3},  x  40\\,\\mathrm{m},\\\\\n        2 \\times 10^{-2},  x \\ge 40\\,\\mathrm{m},\n      \\end{cases}$\n    - $\\alpha(x) \\equiv 0$。\n\n- 案例 C（线性变化的扩散与强局部反应）：\n    - $L = 100\\,\\mathrm{m}$，$N = 80$，\n    - $\\kappa(x) = 1.5 \\times 10^{-2}\\,\\big(1 + 0.9\\,x/L\\big)$，\n    - $\\alpha(x) = \\begin{cases}\n        2 \\times 10^{-2},  30\\,\\mathrm{m} \\le x \\le 70\\,\\mathrm{m},\\\\\n        10^{-3},  \\text{其他情况},\n      \\end{cases}$。\n\n- 案例 D（边界增强扩散，弱反应）：\n    - $L = 10\\,\\mathrm{m}$，$N = 50$，\n    - $\\kappa(x) = 10^{-2}\\,\\Big(1 + 4\\,e^{-(x/1)^2} + 4\\,e^{-((x - L)/1)^2}\\Big)$，\n    - $\\alpha(x) \\equiv 10^{-5}$。\n\n输出规范：\n- 计算每个案例的 $\\Delta t_{\\max}$，以秒为单位的浮点数。\n- 您的程序应生成单行输出，其中包含四个结果，按 A、B、C、D 的顺序排列，以逗号分隔的列表形式用方括号括起来，并四舍五入到 $6$ 位小数，例如 $[a,b,c,d]$。",
            "solution": "确定应用于一维反应扩散方程的前向欧拉格式的最大稳定时间步长问题，是一个在数值分析领域中定义明确且具有科学依据的练习。所提供的控制方程、离散化格式和边界条件在计算物理和工程领域都是标准的。每个测试案例的所有参数和函数都已明确定义，使得该问题自洽且无歧义。验证证实了该问题是合理的，并且可以推导出严谨的解。\n\n求解过程分为三个主要步骤：首先，我们将离散线性算子表达为矩阵；其次，我们分析前向欧拉方法的稳定性，以推导出最大时间步长 $\\Delta t_{\\max}$ 的表达式；最后，我们设计一种计算策略来为给定的测试案例计算该值。\n\n**1. 离散化与矩阵表示**\n\n控制偏微分方程为：\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\!\\left(\\kappa(x)\\,\\frac{\\partial u}{\\partial x}\\right) - \\alpha(x)\\,u\n$$\n空间域 $x \\in [0, L]$ 被离散化为 $N$ 个宽度为 $\\Delta x = L/(N+1)$ 的内部单元。浓度 $u(x,t)$ 由一个向量 $\\mathbf{u}(t) \\in \\mathbb{R}^N$ 表示，其中 $(\\mathbf{u})_i = u_i(t) \\approx u(x_i, t)$。半离散系统为 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}\\mathbf{u}$，其中 $\\mathbf{L}$ 是一个 $N \\times N$ 的矩阵。\n\n$\\mathbf{L}\\mathbf{u}$ 的第 $i$ 个分量由指定的二阶守恒有限差分/体积公式给出：\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\frac{1}{\\Delta x}\\left[\\kappa_{i+\\frac{1}{2}}\\,\\frac{u_{i+1}-u_i}{\\Delta x} - \\kappa_{i-\\frac{1}{2}}\\,\\frac{u_i-u_{i-1}}{\\Delta x}\\right] - \\alpha_i\\,u_i\n$$\n通过收集乘以 $u_{i-1}$、$u_i$ 和 $u_{i+1}$ 的项，我们可以确定矩阵 $\\mathbf{L}$ 的元素。\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\left(\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}\\right) u_{i-1} + \\left(-\\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} - \\alpha_i\\right) u_i + \\left(\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}\\right) u_{i+1}\n$$\n这个结构定义了一个三对角矩阵 $\\mathbf{L}$。齐次狄利克雷边界条件 $u(0,t)=0$ 和 $u(L,t)=0$ 通过在 $i=1$ 和 $i=N$ 的方程中分别设置 $u_0=0$ 和 $u_{N+1}=0$ 来引入。对于 $i,j \\in \\{1,\\dots,N\\}$，$\\mathbf{L}$ 的元素为：\n$$\nL_{ij} = \\begin{cases}\n\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}  \\text{若 } j=i-1 \\\\\n-\\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} - \\alpha_i  \\text{若 } j=i \\\\\n\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}  \\text{若 } j=i+1 \\\\\n0  \\text{其他情况}\n\\end{cases}\n$$\n由于 $\\kappa(x)$ 在 $L_{i,i-1}$ 和 $L_{i-1,i}$ 中都是在同一个面位置 $x_{i-1/2}$ 处计算的，所以矩阵 $\\mathbf{L}$ 是对称的。\n\n**2. 前向欧拉方法的稳定性分析**\n\n前向欧拉时间步进格式为：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{n} + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^{n} = (\\mathbf{I} + \\Delta t\\,\\mathbf{L})\\mathbf{u}^{n}\n$$\n其中 $\\mathbf{I}$ 是单位矩阵。为使该方法稳定，放大矩阵 $\\mathbf{G} = \\mathbf{I} + \\Delta t\\,\\mathbf{L}$ 的谱半径不得超过 $1$。即 $\\rho(\\mathbf{G}) \\le 1$。\n\n$\\mathbf{G}$ 的特征值为 $\\mu_j = 1 + \\Delta t\\,\\lambda_j$，其中 $\\{\\lambda_j\\}$ 是 $\\mathbf{L}$ 的特征值。稳定性条件是对于所有 $j$ 都有 $|\\mu_j| \\le 1$。\n\n矩阵 $\\mathbf{L}$ 是对称的，因此其特征值 $\\lambda_j$ 是实数。此外，$\\mathbf{L}$ 是负定的。这可以通过考虑二次型 $\\mathbf{v}^T \\mathbf{L} \\mathbf{v}$ 来证明。$\\mathbf{L}$ 的扩散部分对应一个离散负拉普拉斯算子，在狄利克雷条件下是负定的；而反应部分 $-\\text{diag}(\\alpha_i)$ 是半负定的（因为 $\\alpha_i \\ge 0$）。因此，所有特征值 $\\lambda_j$ 都是实数且为负。\n\n对于 $\\lambda_j  0$，稳定性条件 $|1 + \\Delta t\\,\\lambda_j| \\le 1$ 简化为：\n$$\n-1 \\le 1 + \\Delta t\\,\\lambda_j \\le 1\n$$\n右侧不等式总是满足的，因为 $\\Delta t > 0$ 且 $\\lambda_j  0$。左侧不等式决定了稳定性极限：\n$$\n-2 \\le \\Delta t\\,\\lambda_j \\implies \\Delta t \\le \\frac{-2}{\\lambda_j} = \\frac{2}{-\\lambda_j} = \\frac{2}{|\\lambda_j|}\n$$\n这个条件必须对所有特征值都成立。最严格的约束是由模最大的特征值施加的，即最负的特征值 $\\lambda_{\\min} = \\min_j(\\lambda_j)$。因此，最大稳定时间步长为：\n$$\n\\Delta t_{\\max} = \\frac{2}{|\\lambda_{\\min}|} = \\frac{2}{\\max_j |\\lambda_j|} = \\frac{2}{\\rho(\\mathbf{L})}\n$$\n其中 $\\rho(\\mathbf{L})$ 是 $\\mathbf{L}$ 的谱半径。\n\n**3. 计算策略**\n\n任务简化为计算 $\\mathbf{L}$ 的谱半径。问题引导我们计算矩阵 $\\mathbf{M} = -\\mathbf{L}$ 的最大特征值。$\\mathbf{M}$ 的特征值为 $-\\lambda_j$。由于 $\\lambda_j  0$，$\\mathbf{M}$ 的特征值都是正的。$\\mathbf{M}$ 的最大特征值 $\\lambda_{\\max}(\\mathbf{M})$ 为：\n$$\n\\lambda_{\\max}(\\mathbf{M}) = \\max_j(-\\lambda_j) = -\\min_j(\\lambda_j) = -\\lambda_{\\min} = |\\lambda_{\\min}| = \\rho(\\mathbf{L})\n$$\n矩阵 $\\mathbf{M} = -\\mathbf{L}$ 是对称正定的 (SPD)。问题正确地建议使用适用于 SPD 矩阵的迭代方法。在 `scipy.sparse.linalg.eigsh` 中实现的 Lanczos 算法是寻找大型对称矩阵最大特征值的有效且稳健的选择，并且它满足“迭代方法”的要求。\n\n每个测试案例的算法如下：\n1.  定义参数 $L$ 和 $N$，以及函数 $\\kappa(x)$ 和 $\\alpha(x)$。\n2.  构建网格：空间步长 $\\Delta x = L/(N+1)$，节点位置 $x_i$，以及面位置 $x_{j+1/2}$。\n3.  在面网格上计算 $\\kappa(x)$，在节点网格上计算 $\\alpha(x)$。\n4.  组装 $N \\times N$ 矩阵 $\\mathbf{M} = -\\mathbf{L}$，其元素为：\n    $$\n    M_{ij} = \\begin{cases}\n    -\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}  \\text{若 } j=i-1 \\\\\n    \\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} + \\alpha_i  \\text{若 } j=i \\\\\n    -\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}  \\text{若 } j=i+1 \\\\\n    0  \\text{其他情况}\n    \\end{cases}\n    $$\n5.  使用 `scipy.sparse.linalg.eigsh` 计算 $\\mathbf{M}$ 的最大特征值，该值等于 $\\rho(\\mathbf{L})$。\n6.  计算 $\\Delta t_{\\max} = 2 / \\rho(\\mathbf{L})$。\n7.  最终结果四舍五入到 $6$ 位小数，并按要求格式呈现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse.linalg import eigsh\n\ndef calculate_dt_max(L, N, kappa_func, alpha_func):\n    \"\"\"\n    Assembles the discrete operator matrix and computes the max stable time step.\n\n    Args:\n        L (float): Domain length in meters.\n        N (int): Number of interior grid points.\n        kappa_func (callable): Function for diffusion coefficient kappa(x).\n        alpha_func (callable): Function for reaction rate alpha(x).\n\n    Returns:\n        float: The maximum stable time step (dt_max) in seconds.\n    \"\"\"\n    # 1. Construct the grid\n    dx = L / (N + 1)\n    # Node locations x_i for i=1,...,N\n    x_nodes = np.arange(1, N + 1) * dx\n    # Face locations x_{j+1/2} for j=0,...,N\n    x_faces = (np.arange(0, N + 1) + 0.5) * dx\n\n    # 2. Evaluate kappa at faces and alpha at nodes\n    kappa_at_faces = kappa_func(x_faces)\n    alpha_at_nodes = alpha_func(x_nodes)\n\n    # 3. Assemble the matrix M = -L\n    # M is an N x N symmetric positive definite matrix.\n    # Python array indices k are from 0 to N-1.\n    # The PDE node index i corresponds to array index k=i-1.\n    # kappa_{i-1/2} corresponds to kappa_at_faces[k]\n    # kappa_{i+1/2} corresponds to kappa_at_faces[k+1]\n    \n    M = np.zeros((N, N))\n    \n    # Diagonal entries\n    # M_kk = (kappa_{k+1/2} + kappa_{k-1/2}) / dx^2 + alpha_k\n    diag_terms = (kappa_at_faces[1:] + kappa_at_faces[:-1]) / dx**2 + alpha_at_nodes\n    np.fill_diagonal(M, diag_terms)\n\n    # Off-diagonal entries\n    # M_{k,k+1} = -kappa_{k+1/2} / dx^2\n    off_diag_terms = -kappa_at_faces[1:-1] / dx**2\n    np.fill_diagonal(M[0:, 1:], off_diag_terms)\n    np.fill_diagonal(M[1:, 0:], off_diag_terms) # Symmetric matrix\n\n    # 4. Compute the largest eigenvalue of M\n    # M is SPD, so its largest magnitude eigenvalue is its largest eigenvalue.\n    # eigsh uses an iterative method (Lanczos) suitable for large symmetric matrices.\n    # k=1 asks for only one eigenvalue, which='LM' specifies the largest magnitude.\n    # Since M is dense but N is small, this is efficient enough.\n    spectral_radius_L = eigsh(M, k=1, which='LM', return_eigenvectors=False)[0]\n\n    # 5. Compute the maximum stable time step\n    dt_max = 2.0 / spectral_radius_L\n    \n    return dt_max\n\ndef solve():\n    # Define kappa and alpha functions for each test case\n    # Case A\n    def kappa_A(x):\n        L_A = 100.0\n        return 1e-2 * (1.0 + 0.5 * np.sin(2.0 * np.pi * x / L_A))\n    def alpha_A(x):\n        L_A = 100.0\n        return 1e-3 * (1.0 + 0.25 * np.cos(2.0 * np.pi * x / L_A))\n\n    # Case B\n    def kappa_B(x):\n        return np.where(x  40.0, 5e-3, 2e-2)\n    def alpha_B(x):\n        return np.zeros_like(x)\n\n    # Case C\n    def kappa_C(x):\n        L_C = 100.0\n        return 1.5e-2 * (1.0 + 0.9 * x / L_C)\n    def alpha_C(x):\n        return np.where((x = 30.0)  (x = 70.0), 2e-2, 1e-3)\n\n    # Case D\n    def kappa_D(x):\n        L_D = 10.0\n        return 1e-2 * (1 + 4 * np.exp(-(x**2)) + 4 * np.exp(-((x - L_D)**2)))\n    def alpha_D(x):\n        return np.full_like(x, 1e-5)\n\n    test_cases = [\n        {'L': 100.0, 'N': 50, 'kappa_func': kappa_A, 'alpha_func': alpha_A},\n        {'L': 100.0, 'N': 100, 'kappa_func': kappa_B, 'alpha_func': alpha_B},\n        {'L': 100.0, 'N': 80, 'kappa_func': kappa_C, 'alpha_func': alpha_C},\n        {'L': 10.0, 'N': 50, 'kappa_func': kappa_D, 'alpha_func': alpha_D}\n    ]\n\n    results = []\n    for case in test_cases:\n        dt = calculate_dt_max(case['L'], case['N'], case['kappa_func'], case['alpha_func'])\n        results.append(dt)\n\n    # Format results to 6 decimal places and print in the specified format\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}