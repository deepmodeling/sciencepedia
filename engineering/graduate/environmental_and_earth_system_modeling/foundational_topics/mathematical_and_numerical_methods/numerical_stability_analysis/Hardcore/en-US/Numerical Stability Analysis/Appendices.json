{
    "hands_on_practices": [
        {
            "introduction": "We begin with a cornerstone of stability analysis: the von Neumann method. This exercise  applies the Forward-Time Central-Space (FTCS) scheme to the heat equation, a fundamental model for diffusive processes in environmental systems. By deriving the stability condition from first principles, you will gain a deep understanding of how discretization choices for time step $\\Delta t$ and grid spacing $\\Delta x$ are fundamentally linked to ensure a stable simulation.",
            "id": "4047668",
            "problem": "In computational fusion science and engineering, parallel electron heat conduction along magnetic field lines in a tokamak can often be modeled, at leading order, by the one-dimensional heat equation. Consider the partial differential equation $u_{t} = \\kappa \\, u_{xx}$ for the electron temperature $u(x,t)$, with constant thermal diffusivity $\\kappa  0$, on a periodic domain $x \\in [0,L]$. Discretize space on a uniform grid $x_{j} = j \\,\\Delta x$ for integer indices $j$ with $\\Delta x = L/N$ and $N \\in \\mathbb{N}$ sufficiently large, and discretize time as $t^{n} = n \\,\\Delta t$ for integer indices $n$ with $\\Delta t  0$. Consider the explicit Forward-Time Central-Space (FTCS) scheme,\n$$\nu_{j}^{n+1} \\;=\\; u_{j}^{n} \\;+\\; \\frac{\\kappa \\,\\Delta t}{\\Delta x^{2}} \\left(u_{j+1}^{n} \\;-\\; 2\\,u_{j}^{n} \\;+\\; u_{j-1}^{n}\\right),\n$$\nsubject to periodic boundary conditions. Using first principles appropriate for numerical stability analysis, including conservation of energy leading to the heat equation, consistent finite-difference approximations, and discrete Fourier (von Neumann) mode analysis on a periodic grid, analyze the linear stability of this scheme with respect to arbitrary perturbations resolved on the grid. Determine the largest time-step that guarantees stability for all discrete Fourier modes. Express your final answer as a single closed-form symbolic expression for the maximum allowable time-step $\\Delta t_{\\max}$ in terms of $\\kappa$ and $\\Delta x$. No rounding is required, and no units should be reported in the final expression. You may reference the Courant–Friedrichs–Lewy (CFL) condition conceptually, but you must derive the stability restriction from the amplification factor without invoking any pre-compiled results.",
            "solution": "The problem requires the derivation of the stability condition for the Forward-Time Central-Space (FTCS) scheme applied to the one-dimensional heat equation, $u_{t} = \\kappa \\, u_{xx}$, on a periodic domain. The stability analysis will be performed using the discrete Fourier (von Neumann) method to determine the maximum allowable time-step, $\\Delta t_{\\max}$.\n\nThe given FTCS numerical scheme is:\n$$\nu_{j}^{n+1} = u_{j}^{n} + \\frac{\\kappa \\,\\Delta t}{\\Delta x^{2}} \\left(u_{j+1}^{n} - 2\\,u_{j}^{n} + u_{j-1}^{n}\\right)\n$$\nwhere $u_j^n$ approximates the temperature $u(x_j, t^n)$, $\\Delta t$ is the time step, and $\\Delta x$ is the spatial grid spacing.\n\nThe von Neumann stability analysis assumes that the initial error distribution can be decomposed into a Fourier series. Since the finite-difference scheme is linear, we can analyze the behavior of a single Fourier mode. An arbitrary mode of the numerical solution at grid point $x_j = j \\Delta x$ and time level $t^n = n \\Delta t$ can be represented as:\n$$\nu_j^n = \\hat{u}^n(k) e^{i k x_j} = \\hat{u}^n(k) e^{i k j \\Delta x}\n$$\nwhere $k$ is the wavenumber, $i$ is the imaginary unit, and $\\hat{u}^n(k)$ is the amplitude of the mode at time level $n$. For the scheme to be stable, the amplitude of every mode must not grow in time. This is quantified by the amplification factor, $G(k)$, defined by the relation:\n$$\n\\hat{u}^{n+1}(k) = G(k) \\hat{u}^n(k)\n$$\nStability requires that the magnitude of the amplification factor be less than or equal to one for all possible wavenumbers $k$ resolved by the grid, i.e., $|G(k)| \\le 1$.\n\nTo find $G(k)$, we substitute the Fourier mode representation into the FTCS scheme.\nThe terms in the scheme become:\n- $u_{j}^{n+1} = \\hat{u}^{n+1}(k) e^{i k j \\Delta x} = G(k) \\hat{u}^{n}(k) e^{i k j \\Delta x}$\n- $u_{j}^{n} = \\hat{u}^{n}(k) e^{i k j \\Delta x}$\n- $u_{j+1}^{n} = \\hat{u}^{n}(k) e^{i k (j+1) \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{i k \\Delta x}$\n- $u_{j-1}^{n} = \\hat{u}^{n}(k) e^{i k (j-1) \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{-i k \\Delta x}$\n\nSubstituting these into the FTCS equation:\n$$\nG(k) \\hat{u}^{n}(k) e^{i k j \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{i k \\Delta x} - 2\\hat{u}^{n}(k) e^{i k j \\Delta x} + \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{-i k \\Delta x} \\right)\n$$\nWe can divide the entire equation by the common factor $\\hat{u}^{n}(k) e^{i k j \\Delta x}$ (assuming a non-trivial solution):\n$$\nG(k) = 1 + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( e^{i k \\Delta x} - 2 + e^{-i k \\Delta x} \\right)\n$$\nUsing Euler's identity, $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$, we can simplify the expression in the parenthesis:\n$$\nG(k) = 1 + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( 2\\cos(k \\Delta x) - 2 \\right) = 1 - \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\left( 1 - \\cos(k \\Delta x) \\right)\n$$\nTo further simplify, we use the trigonometric half-angle identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$:\n$$\nG(k) = 1 - \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\left( 2\\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\right) = 1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\nThe amplification factor $G(k)$ is a real number. The stability condition $|G(k)| \\le 1$ becomes $-1 \\le G(k) \\le 1$.\n\nLet's analyze the two inequalities:\n1.  $G(k) \\le 1$:\n    $$\n    1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1\n    $$\n    $$\n    -\\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 0\n    $$\n    Since $\\kappa > 0$, $\\Delta t > 0$, $\\Delta x^2 > 0$, and $\\sin^2(\\cdot) \\ge 0$, this inequality is always satisfied.\n\n2.  $G(k) \\ge -1$:\n    $$\n    1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\ge -1\n    $$\n    $$\n    2 \\ge \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n    $$\n    Dividing by $2$:\n    $$\n    1 \\ge \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n    $$\nThis inequality must hold for all wavenumbers $k$ that can be represented on the grid. The range of the dimensionless wavenumber is $k \\Delta x \\in [-\\pi, \\pi]$. To find the most restrictive condition on $\\Delta t$, we must find the maximum value of the term $\\sin^2(k \\Delta x / 2)$. The maximum value of $\\sin^2(\\theta)$ is $1$, which occurs when $\\theta = \\pi/2 + m\\pi$ for any integer $m$. For $k \\Delta x = \\pi$ (which corresponds to the highest frequency, or shortest wavelength $\\lambda=2\\Delta x$, that the grid can resolve), we have:\n$$\n\\sin^2\\left(\\frac{\\pi}{2}\\right) = 1\n$$\nThis represents the \"worst-case\" scenario for stability. Substituting this maximum value into the inequality gives the stability condition that must be met:\n$$\n1 \\ge \\frac{2\\kappa \\Delta t}{\\Delta x^2} (1)\n$$\n$$\n\\frac{2\\kappa \\Delta t}{\\Delta x^2} \\le 1\n$$\nThis condition must be satisfied for the FTCS scheme to be stable. The maximum allowable time-step, $\\Delta t_{\\max}$, is obtained when the equality holds:\n$$\n\\frac{2\\kappa \\Delta t_{\\max}}{\\Delta x^2} = 1\n$$\nSolving for $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x^2}{2\\kappa}\n$$\nThis is the well-known stability constraint for the explicit FTCS method for the one-dimensional heat equation. It indicates that the time step must decrease quadratically with the spatial grid spacing to maintain numerical stability.",
            "answer": "$$\\boxed{\\frac{\\Delta x^{2}}{2\\kappa}}$$"
        },
        {
            "introduction": "Not all simple schemes are universally applicable. This practice  demonstrates a critical failure case by applying the same FTCS scheme to the linear advection equation, a model vital for transport phenomena like pollutant dispersal. You will discover through analysis that this seemingly reasonable scheme is unconditionally unstable for advection, a classic result that highlights the importance of tailoring numerical methods to the underlying physics of the problem.",
            "id": "3804249",
            "problem": "Consider a one-dimensional zonal channel in computational oceanography where a passive tracer field $c(x,t)$ is advected by a uniform current of speed $U0$. The governing equation is the linear advection equation $c_{t} + U c_{x} = 0$ on a periodic domain. Let the spatial grid be uniform with spacing $\\Delta x$ and the time step be $\\Delta t$. Consider the Forward Time Centered Space (FTCS) finite difference scheme applied to this advection equation on this grid. Perform a Von Neumann (Fourier) stability analysis by assuming a discrete Fourier mode $c_{j}^{n} = \\hat{c}^{n} \\exp\\!\\left(i j \\theta\\right)$, where $j$ is the spatial index, $n$ is the time level, $i$ is the imaginary unit, and $\\theta$ is the nondimensional wavenumber in radians. Derive the corresponding amplification factor $G(\\theta)$ defined by $\\hat{c}^{n+1} = G(\\theta)\\,\\hat{c}^{n}$, compute its magnitude $|G(\\theta)|$, and show there exists a value of $\\theta$ for which $|G(\\theta)|1$ for any choice of $\\Delta t$ and $\\Delta x$ with $U\\neq 0$. Specifically, evaluate $|G(\\theta)|$ at $\\theta = \\pi/2$ and provide the resulting expression as your final answer. The final answer must be a single closed-form analytic expression without units. Angles must be treated in radians. No rounding is required.",
            "solution": "The governing partial differential equation is the one-dimensional linear advection equation:\n$$\nc_{t} + U c_{x} = 0\n$$\nwhere $c(x,t)$ is the tracer concentration, $U$ is a constant positive velocity, $t$ is time, and $x$ is the spatial coordinate.\n\nThe problem specifies the Forward Time Centered Space (FTCS) finite difference scheme. We discretize the time derivative $c_t$ using a forward difference at time level $n$ and spatial position $j$:\n$$\nc_{t} \\approx \\frac{c_{j}^{n+1} - c_{j}^{n}}{\\Delta t}\n$$\nAnd we discretize the spatial derivative $c_x$ using a centered difference at the same time level $n$ and spatial position $j$:\n$$\nc_{x} \\approx \\frac{c_{j+1}^{n} - c_{j-1}^{n}}{2\\Delta x}\n$$\nHere, $c_{j}^{n} = c(j\\Delta x, n\\Delta t)$, $\\Delta t$ is the time step, and $\\Delta x$ is the grid spacing.\n\nSubstituting these approximations into the governing equation yields the FTCS scheme:\n$$\n\\frac{c_{j}^{n+1} - c_{j}^{n}}{\\Delta t} + U \\frac{c_{j+1}^{n} - c_{j-1}^{n}}{2\\Delta x} = 0\n$$\nTo perform the Von Neumann stability analysis, we assume a solution in the form of a single discrete Fourier mode:\n$$\nc_{j}^{n} = \\hat{c}^{n} \\exp(i j \\theta)\n$$\nwhere $\\hat{c}^{n}$ is the complex amplitude of the mode at time level $n$, $j$ is the spatial grid index, $i$ is the imaginary unit, and $\\theta = k \\Delta x$ is the nondimensional wavenumber, with $k$ being the physical wavenumber.\n\nWe substitute this modal form into the finite difference scheme. The terms in the scheme become:\n$$\nc_{j}^{n+1} = \\hat{c}^{n+1} \\exp(i j \\theta)\n$$\n$$\nc_{j}^{n} = \\hat{c}^{n} \\exp(i j \\theta)\n$$\n$$\nc_{j+1}^{n} = \\hat{c}^{n} \\exp(i (j+1) \\theta) = \\hat{c}^{n} \\exp(i j \\theta) \\exp(i \\theta)\n$$\n$$\nc_{j-1}^{n} = \\hat{c}^{n} \\exp(i (j-1) \\theta) = \\hat{c}^{n} \\exp(i j \\theta) \\exp(-i \\theta)\n$$\nSubstituting these expressions into the FTCS equation gives:\n$$\n\\frac{\\hat{c}^{n+1} \\exp(i j \\theta) - \\hat{c}^{n} \\exp(i j \\theta)}{\\Delta t} + U \\frac{\\hat{c}^{n} \\exp(i j \\theta) \\exp(i \\theta) - \\hat{c}^{n} \\exp(i j \\theta) \\exp(-i \\theta)}{2\\Delta x} = 0\n$$\nWe can divide the entire equation by the common factor $\\hat{c}^{n} \\exp(i j \\theta)$, assuming $\\hat{c}^{n} \\neq 0$:\n$$\n\\frac{\\frac{\\hat{c}^{n+1}}{\\hat{c}^{n}} - 1}{\\Delta t} + U \\frac{\\exp(i \\theta) - \\exp(-i \\theta)}{2\\Delta x} = 0\n$$\nThe amplification factor $G(\\theta)$ is defined by the relation $\\hat{c}^{n+1} = G(\\theta)\\,\\hat{c}^{n}$. Substituting this definition:\n$$\n\\frac{G(\\theta) - 1}{\\Delta t} + U \\frac{\\exp(i \\theta) - \\exp(-i \\theta)}{2\\Delta x} = 0\n$$\nUsing Euler's identity, $\\sin(\\theta) = \\frac{\\exp(i \\theta) - \\exp(-i \\theta)}{2i}$, the second term can be simplified:\n$$\n\\frac{G(\\theta) - 1}{\\Delta t} + U \\frac{2i\\sin(\\theta)}{2\\Delta x} = 0\n$$\n$$\n\\frac{G(\\theta) - 1}{\\Delta t} = -i \\frac{U}{\\Delta x} \\sin(\\theta)\n$$\nSolving for $G(\\theta)$:\n$$\nG(\\theta) - 1 = -i \\frac{U \\Delta t}{\\Delta x} \\sin(\\theta)\n$$\n$$\nG(\\theta) = 1 - i \\frac{U \\Delta t}{\\Delta x} \\sin(\\theta)\n$$\nThe amplification factor is a complex number. For the scheme to be stable, the magnitude of the amplification factor must satisfy $|G(\\theta)| \\le 1$ for all possible values of $\\theta$. We now compute this magnitude. For a complex number $z = a + ib$, its magnitude is $|z| = \\sqrt{a^2 + b^2}$. Here, $a=1$ and $b = -\\frac{U\\Delta t}{\\Delta x} \\sin(\\theta)$.\n$$\n|G(\\theta)| = \\sqrt{(1)^2 + \\left(-\\frac{U \\Delta t}{\\Delta x} \\sin(\\theta)\\right)^2}\n$$\n$$\n|G(\\theta)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2(\\theta)}\n$$\nSince $U$, $\\Delta t$, and $\\Delta x$ are positive physical quantities, the term $\\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2$ is strictly positive. The term $\\sin^2(\\theta)$ is non-negative. For any $\\theta$ where $\\sin(\\theta) \\neq 0$ (i.e., $\\theta$ is not an integer multiple of $\\pi$), the term $\\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2(\\theta)$ is strictly positive. Consequently, the radicand $1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2(\\theta)$ is strictly greater than $1$, and its square root $|G(\\theta)|$ will also be strictly greater than $1$. This demonstrates that the FTCS scheme is unconditionally unstable for the linear advection equation for any non-zero $U$, $\\Delta t$, and $\\Delta x$.\n\nThe problem asks specifically for the evaluation of $|G(\\theta)|$ at $\\theta = \\frac{\\pi}{2}$. At this value of the nondimensional wavenumber, we have $\\sin(\\frac{\\pi}{2}) = 1$. Substituting this into our expression for $|G(\\theta)|$:\n$$\n|G(\\pi/2)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 \\sin^2\\left(\\frac{\\pi}{2}\\right)}\n$$\n$$\n|G(\\pi/2)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2 (1)^2}\n$$\n$$\n|G(\\pi/2)| = \\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^2}\n$$\nThis is the final expression for the magnitude of the amplification factor for the mode with nondimensional wavenumber $\\theta=\\frac{\\pi}{2}$.",
            "answer": "$$\\boxed{\\sqrt{1 + \\left(\\frac{U \\Delta t}{\\Delta x}\\right)^{2}}}$$"
        },
        {
            "introduction": "Real-world environmental systems are rarely uniform, rendering methods like von Neumann analysis inapplicable in their standard form. This practice  moves beyond idealized scenarios to a reaction-diffusion equation with spatially varying coefficients, a common situation in earth system models. You will learn to assemble the system's discrete operator matrix and computationally estimate its spectral radius to determine the stability limit, a powerful technique essential for analyzing complex, operational models.",
            "id": "3899693",
            "problem": "Consider the one-dimensional transport of a generic passive scalar in an environmental column with spatially heterogeneous diffusion coefficient $\\kappa(x)$ and first-order reaction rate $\\alpha(x)$. The continuous governing law is conservation of mass combined with Fickian diffusion and linear reaction: the scalar concentration $u(x,t)$ satisfies the partial differential equation (PDE)\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\!\\left(\\kappa(x)\\,\\frac{\\partial u}{\\partial x}\\right) - \\alpha(x)\\,u,\n$$\non the domain $x \\in [0,L]$ with homogeneous Dirichlet boundary conditions $u(0,t) = 0$ and $u(L,t) = 0$. Assume $\\kappa(x) \\ge 0$ and $\\alpha(x) \\ge 0$ for all $x$.\n\nDiscretize the spatial operator using a uniform grid with $N$ interior points, spacing $\\Delta x = L/(N+1)$, interior node locations $x_i = i\\,\\Delta x$ for $i = 1,\\dots,N$, and face locations $x_{j+\\frac{1}{2}} = (j+\\tfrac{1}{2})\\,\\Delta x$ for $j = 0,\\dots,N$. Evaluate the diffusion coefficient at faces $\\kappa_{j+\\frac{1}{2}} = \\kappa(x_{j+\\frac{1}{2}})$, and the reaction rate at nodes $\\alpha_i = \\alpha(x_i)$. Assemble the linear discrete operator $\\mathbf{L} \\in \\mathbb{R}^{N \\times N}$ corresponding to the semi-discrete system $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}\\,\\mathbf{u}$ using the second-order conservative flux form with Dirichlet boundary conditions:\n- For $i = 1,\\dots,N$,\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\frac{1}{\\Delta x}\\left[\\kappa_{i+\\frac{1}{2}}\\,\\frac{u_{i+1}-u_i}{\\Delta x} - \\kappa_{i-\\frac{1}{2}}\\,\\frac{u_i-u_{i-1}}{\\Delta x}\\right] - \\alpha_i\\,u_i,\n$$\nwith the conventions $u_0 = 0$ and $u_{N+1} = 0$.\n\nConsider an explicit Forward Euler time stepping for the semi-discrete system, $ \\mathbf{u}^{n+1} = \\mathbf{u}^{n} + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^{n}$. Define the stability limit as the largest time step $\\Delta t_{\\max}$ (in seconds) such that the Forward Euler method remains linearly stable for all modes of the discrete operator $\\mathbf{L}$.\n\nTasks:\n1. Assemble the matrix $\\mathbf{L}$ according to the above specifications for each test case.\n2. Estimate the spectral radius $\\rho(\\mathbf{L})$ of the assembled matrix by computing the largest eigenvalue of $-\\mathbf{L}$ using an iterative method suitable for symmetric positive definite matrices.\n3. From the estimated spectral radius, compute the maximum admissible Forward Euler time step $\\Delta t_{\\max}$ (in seconds). Report all $\\Delta t_{\\max}$ values rounded to $6$ decimal places.\n4. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3]$).\n\nUnits and conventions:\n- Domain length $L$ must be specified in meters ($\\mathrm{m}$).\n- Diffusion coefficient $\\kappa(x)$ must be specified in square meters per second ($\\mathrm{m}^2/\\mathrm{s}$).\n- Reaction rate $\\alpha(x)$ must be specified in inverse seconds ($\\mathrm{s}^{-1}$).\n- The final time step $\\Delta t_{\\max}$ must be expressed in seconds ($\\mathrm{s}$).\n\nTest suite (four cases designed to exercise different heterogeneity patterns and edge conditions):\n\n- Case A (smooth heterogeneity):\n    - $L = 100\\,\\mathrm{m}$, $N = 50$,\n    - $\\kappa(x) = 10^{-2}\\,\\big(1 + 0.5 \\sin(2\\pi x / L)\\big)$,\n    - $\\alpha(x) = 10^{-3}\\,\\big(1 + 0.25 \\cos(2\\pi x / L)\\big)$.\n\n- Case B (two-layer medium, no reaction):\n    - $L = 100\\,\\mathrm{m}$, $N = 100$,\n    - $$\\kappa(x) = \\begin{cases} 5 \\times 10^{-3},  x  40\\,\\mathrm{m},\\\\ 2 \\times 10^{-2},  x \\ge 40\\,\\mathrm{m}, \\end{cases}$$\n    - $\\alpha(x) \\equiv 0$.\n\n- Case C (linearly varying diffusion with strong localized reaction):\n    - $L = 100\\,\\mathrm{m}$, $N = 80$,\n    - $\\kappa(x) = 1.5 \\times 10^{-2}\\,\\big(1 + 0.9\\,x/L\\big)$,\n    - $$\\alpha(x) = \\begin{cases} 2 \\times 10^{-2},  30\\,\\mathrm{m} \\le x \\le 70\\,\\mathrm{m},\\\\ 10^{-3},  \\text{otherwise}, \\end{cases}$$\n\n- Case D (boundary-intensified diffusion, weak reaction):\n    - $L = 10\\,\\mathrm{m}$, $N = 50$,\n    - $\\kappa(x) = 10^{-2}\\,\\Big(1 + 4\\,e^{-(x/1)^2} + 4\\,e^{-((x - L)/1)^2}\\Big)$,\n    - $\\alpha(x) \\equiv 10^{-5}$.\n\nOutput specification:\n- Compute $\\Delta t_{\\max}$ for each case as a float in seconds.\n- Your program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets, in the order A, B, C, D, rounded to $6$ decimal places, for example $[a,b,c,d]$.",
            "solution": "The problem of determining the maximum stable time step for a Forward Euler scheme applied to a one-dimensional reaction-diffusion equation is a well-posed and scientifically grounded exercise in numerical analysis. The provided governing equation, discretization scheme, and boundary conditions are standard in computational physics and engineering. All parameters and functions are clearly defined for each test case, rendering the problem self-contained and unambiguous. The validation confirms that the problem is sound and a rigorous solution can be derived.\n\nThe solution proceeds in three main steps: first, we formulate the discrete linear operator as a matrix; second, we analyze the stability of the Forward Euler method to derive an expression for the maximum time step, $\\Delta t_{\\max}$; and third, we devise a computational strategy to calculate this value for the given test cases.\n\n**1. Discretization and Matrix Formulation**\n\nThe governing partial differential equation is:\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\!\\left(\\kappa(x)\\,\\frac{\\partial u}{\\partial x}\\right) - \\alpha(x)\\,u\n$$\nThe spatial domain $x \\in [0, L]$ is discretized into $N$ interior cells of width $\\Delta x = L/(N+1)$. The concentration $u(x,t)$ is represented by a vector $\\mathbf{u}(t) \\in \\mathbb{R}^N$, where $(\\mathbf{u})_i = u_i(t) \\approx u(x_i, t)$. The semi-discrete system is $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}\\mathbf{u}$, where $\\mathbf{L}$ is an $N \\times N$ matrix.\n\nThe $i$-th component of $\\mathbf{L}\\mathbf{u}$ is given by the specified second-order conservative finite difference/volume formula:\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\frac{1}{\\Delta x}\\left[\\kappa_{i+\\frac{1}{2}}\\,\\frac{u_{i+1}-u_i}{\\Delta x} - \\kappa_{i-\\frac{1}{2}}\\,\\frac{u_i-u_{i-1}}{\\Delta x}\\right] - \\alpha_i\\,u_i\n$$\nBy collecting terms multiplying $u_{i-1}$, $u_i$, and $u_{i+1}$, we can identify the entries of the matrix $\\mathbf{L}$.\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\left(\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}\\right) u_{i-1} + \\left(-\\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} - \\alpha_i\\right) u_i + \\left(\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}\\right) u_{i+1}\n$$\nThis structure defines a tridiagonal matrix $\\mathbf{L}$. The homogeneous Dirichlet boundary conditions $u(0,t)=0$ and $u(L,t)=0$ are incorporated by setting $u_0=0$ and $u_{N+1}=0$ in the equations for $i=1$ and $i=N$, respectively. The entries of $\\mathbf{L}$ for $i,j \\in \\{1,\\dots,N\\}$ are:\n$$\nL_{ij} = \\begin{cases}\n\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}  \\text{if } j=i-1 \\\\\n-\\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} - \\alpha_i  \\text{if } j=i \\\\\n\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}  \\text{if } j=i+1 \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\nSince $\\kappa(x)$ is evaluated at the same face location $x_{i-1/2}$ for both $L_{i,i-1}$ and $L_{i-1,i}$, the matrix $\\mathbf{L}$ is symmetric.\n\n**2. Stability Analysis of the Forward Euler Method**\n\nThe Forward Euler time-stepping scheme is:\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{n} + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^{n} = (\\mathbf{I} + \\Delta t\\,\\mathbf{L})\\mathbf{u}^{n}\n$$\nwhere $\\mathbf{I}$ is the identity matrix. For the method to be stable, the spectral radius of the amplification matrix $\\mathbf{G} = \\mathbf{I} + \\Delta t\\,\\mathbf{L}$ must not exceed $1$. That is, $\\rho(\\mathbf{G}) \\le 1$.\n\nThe eigenvalues of $\\mathbf{G}$ are $\\mu_j = 1 + \\Delta t\\,\\lambda_j$, where $\\{\\lambda_j\\}$ are the eigenvalues of $\\mathbf{L}$. The stability condition is $|\\mu_j| \\le 1$ for all $j$.\n\nThe matrix $\\mathbf{L}$ is symmetric, so its eigenvalues $\\lambda_j$ are real. Furthermore, $\\mathbf{L}$ is negative definite. This can be shown by considering the quadratic form $\\mathbf{v}^T \\mathbf{L} \\mathbf{v}$. The diffusion part of $\\mathbf{L}$ corresponds to a discrete negative Laplacian, which is negative definite under Dirichlet conditions, and the reaction part $-\\text{diag}(\\alpha_i)$ is negative semi-definite (since $\\alpha_i \\ge 0$). Thus, all eigenvalues $\\lambda_j$ are real and negative.\n\nThe stability condition $|1 + \\Delta t\\,\\lambda_j| \\le 1$ with $\\lambda_j  0$ simplifies to:\n$$\n-1 \\le 1 + \\Delta t\\,\\lambda_j \\le 1\n$$\nThe right inequality is always satisfied since $\\Delta t  0$ and $\\lambda_j  0$. The left inequality dictates the stability limit:\n$$\n-2 \\le \\Delta t\\,\\lambda_j \\implies \\Delta t \\le \\frac{-2}{\\lambda_j} = \\frac{2}{-\\lambda_j} = \\frac{2}{|\\lambda_j|}\n$$\nThis must hold for all eigenvalues. The most restrictive constraint is imposed by the eigenvalue with the largest magnitude, which is the most negative eigenvalue, $\\lambda_{\\min} = \\min_j(\\lambda_j)$. Therefore, the maximum stable time step is:\n$$\n\\Delta t_{\\max} = \\frac{2}{|\\lambda_{\\min}|} = \\frac{2}{\\max_j |\\lambda_j|} = \\frac{2}{\\rho(\\mathbf{L})}\n$$\nwhere $\\rho(\\mathbf{L})$ is the spectral radius of $\\mathbf{L}$.\n\n**3. Computational Strategy**\n\nThe task reduces to computing the spectral radius of $\\mathbf{L}$. The problem directs us to compute the largest eigenvalue of the matrix $\\mathbf{M} = -\\mathbf{L}$. The eigenvalues of $\\mathbf{M}$ are $-\\lambda_j$. Since $\\lambda_j  0$, the eigenvalues of $\\mathbf{M}$ are all positive. The largest eigenvalue of $\\mathbf{M}$, $\\lambda_{\\max}(\\mathbf{M})$, is:\n$$\n\\lambda_{\\max}(\\mathbf{M}) = \\max_j(-\\lambda_j) = -\\min_j(\\lambda_j) = -\\lambda_{\\min} = |\\lambda_{\\min}| = \\rho(\\mathbf{L})\n$$\nThe matrix $\\mathbf{M} = -\\mathbf{L}$ is symmetric and positive definite (SPD). The problem correctly suggests using an iterative method suitable for SPD matrices. The Lanczos algorithm, as implemented in `scipy.sparse.linalg.eigsh`, is an efficient and robust choice for finding the largest eigenvalue of a large symmetric matrix, and it satisfies the \"iterative method\" requirement.\n\nThe algorithm for each test case is:\n1.  Define the parameters $L$ and $N$, and the functions $\\kappa(x)$ and $\\alpha(x)$.\n2.  Construct the grid: spatial step $\\Delta x = L/(N+1)$, node locations $x_i$, and face locations $x_{j+1/2}$.\n3.  Evaluate $\\kappa(x)$ on the face grid and $\\alpha(x)$ on the node grid.\n4.  Assemble the $N \\times N$ matrix $\\mathbf{M} = -\\mathbf{L}$ with entries:\n    $$\n    M_{ij} = \\begin{cases}\n    -\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}  \\text{if } j=i-1 \\\\\n    \\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} + \\alpha_i  \\text{if } j=i \\\\\n    -\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}  \\text{if } j=i+1 \\\\\n    0  \\text{otherwise}\n    \\end{cases}\n    $$\n5.  Use `scipy.sparse.linalg.eigsh` to compute the largest eigenvalue of $\\mathbf{M}$, which equals $\\rho(\\mathbf{L})$.\n6.  Calculate $\\Delta t_{\\max} = 2 / \\rho(\\mathbf{L})$.\n7.  The final results are rounded to $6$ decimal places and presented in the required format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse.linalg import eigsh\n\ndef calculate_dt_max(L, N, kappa_func, alpha_func):\n    \"\"\"\n    Assembles the discrete operator matrix and computes the max stable time step.\n\n    Args:\n        L (float): Domain length in meters.\n        N (int): Number of interior grid points.\n        kappa_func (callable): Function for diffusion coefficient kappa(x).\n        alpha_func (callable): Function for reaction rate alpha(x).\n\n    Returns:\n        float: The maximum stable time step (dt_max) in seconds.\n    \"\"\"\n    # 1. Construct the grid\n    dx = L / (N + 1)\n    # Node locations x_i for i=1,...,N\n    x_nodes = np.arange(1, N + 1) * dx\n    # Face locations x_{j+1/2} for j=0,...,N\n    x_faces = (np.arange(0, N + 1) + 0.5) * dx\n\n    # 2. Evaluate kappa at faces and alpha at nodes\n    kappa_at_faces = kappa_func(x_faces)\n    alpha_at_nodes = alpha_func(x_nodes)\n\n    # 3. Assemble the matrix M = -L\n    # M is an N x N symmetric positive definite matrix.\n    # Python array indices k are from 0 to N-1.\n    # The PDE node index i corresponds to array index k=i-1.\n    # kappa_{i-1/2} corresponds to kappa_at_faces[k]\n    # kappa_{i+1/2} corresponds to kappa_at_faces[k+1]\n    \n    M = np.zeros((N, N))\n    \n    # Diagonal entries\n    # M_kk = (kappa_{k+1/2} + kappa_{k-1/2}) / dx^2 + alpha_k\n    diag_terms = (kappa_at_faces[1:] + kappa_at_faces[:-1]) / dx**2 + alpha_at_nodes\n    np.fill_diagonal(M, diag_terms)\n\n    # Off-diagonal entries\n    # M_{k,k+1} = -kappa_{k+1/2} / dx^2\n    off_diag_terms = -kappa_at_faces[1:-1] / dx**2\n    np.fill_diagonal(M[0:, 1:], off_diag_terms)\n    np.fill_diagonal(M[1:, 0:], off_diag_terms) # Symmetric matrix\n\n    # 4. Compute the largest eigenvalue of M\n    # M is SPD, so its largest magnitude eigenvalue is its largest eigenvalue.\n    # eigsh uses an iterative method (Lanczos) suitable for large symmetric matrices.\n    # k=1 asks for only one eigenvalue, which='LM' specifies the largest magnitude.\n    # Since M is dense but N is small, this is efficient enough.\n    spectral_radius_L = eigsh(M, k=1, which='LM', return_eigenvectors=False)[0]\n\n    # 5. Compute the maximum stable time step\n    dt_max = 2.0 / spectral_radius_L\n    \n    return dt_max\n\ndef solve():\n    # Define kappa and alpha functions for each test case\n    # Case A\n    def kappa_A(x):\n        L_A = 100.0\n        return 1e-2 * (1.0 + 0.5 * np.sin(2.0 * np.pi * x / L_A))\n    def alpha_A(x):\n        L_A = 100.0\n        return 1e-3 * (1.0 + 0.25 * np.cos(2.0 * np.pi * x / L_A))\n\n    # Case B\n    def kappa_B(x):\n        return np.where(x  40.0, 5e-3, 2e-2)\n    def alpha_B(x):\n        return np.zeros_like(x)\n\n    # Case C\n    def kappa_C(x):\n        L_C = 100.0\n        return 1.5e-2 * (1.0 + 0.9 * x / L_C)\n    def alpha_C(x):\n        return np.where((x >= 30.0)  (x = 70.0), 2e-2, 1e-3)\n\n    # Case D\n    def kappa_D(x):\n        L_D = 10.0\n        return 1e-2 * (1 + 4 * np.exp(-(x**2)) + 4 * np.exp(-((x - L_D)**2)))\n    def alpha_D(x):\n        return np.full_like(x, 1e-5)\n\n    test_cases = [\n        {'L': 100.0, 'N': 50, 'kappa_func': kappa_A, 'alpha_func': alpha_A},\n        {'L': 100.0, 'N': 100, 'kappa_func': kappa_B, 'alpha_func': alpha_B},\n        {'L': 100.0, 'N': 80, 'kappa_func': kappa_C, 'alpha_func': alpha_C},\n        {'L': 10.0, 'N': 50, 'kappa_func': kappa_D, 'alpha_func': alpha_D}\n    ]\n\n    results = []\n    for case in test_cases:\n        dt = calculate_dt_max(case['L'], case['N'], case['kappa_func'], case['alpha_func'])\n        results.append(dt)\n\n    # Format results to 6 decimal places and print in the specified format\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}