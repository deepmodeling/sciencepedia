{
    "hands_on_practices": [
        {
            "introduction": "A key advantage of the Arakawa C-grid is its natural fit with the finite-volume method for enforcing conservation laws. This practice guides you through the implementation of the discrete divergence operator, a fundamental tool for ensuring mass conservation in fluid models. By working through several test cases, you will gain hands-on experience with C-grid indexing, applying physical boundary conditions like impermeable walls, and verifying the operator's behavior. ",
            "id": "3863000",
            "problem": "Consider a rectangular domain with dimensions $L_x$ and $L_y$ discretized into $N_x$ cells in the $x$ direction and $N_y$ cells in the $y$ direction, using the Arakawa C-grid staggering convention. On an Arakawa C-grid, the horizontal velocity component $u$ is located at the centers of the vertical cell faces, and the vertical velocity component $v$ is located at the centers of the horizontal cell faces, while scalars (e.g., mass or pressure) are located at cell centers. Let the uniform grid spacings be $\\Delta x = L_x / N_x$ and $\\Delta y = L_y / N_y$.\n\nThe conservation of mass for an incompressible flow is given by the divergence-free condition $\\nabla \\cdot \\mathbf{u} = 0$. In finite-volume form for a single rectangular cell with area $A = \\Delta x \\Delta y$, the integral statement is\n$$\n\\int_V \\nabla \\cdot \\mathbf{u} \\, dV = \\oint_{\\partial V} \\mathbf{u} \\cdot \\mathbf{n} \\, dS,\n$$\nand for a uniform Cartesian grid this yields the discrete divergence at each cell center $(i+\\tfrac{1}{2}, j+\\tfrac{1}{2})$\n$$\n(\\nabla \\cdot \\mathbf{u})_{i+\\frac{1}{2}, j+\\frac{1}{2}} = \\frac{u_{i+1, j} - u_{i, j}}{\\Delta x} + \\frac{v_{i, j+1} - v_{i, j}}{\\Delta y},\n$$\nwhere $u_{i,j}$ denotes the value of $u$ at the vertical face located at $x = i \\Delta x$, $y = \\left(j + \\tfrac{1}{2}\\right) \\Delta y$, for $i = 0, 1, \\dots, N_x$ and $j = 0, 1, \\dots, N_y - 1$, and $v_{i,j}$ denotes the value of $v$ at the horizontal face located at $x = \\left(i + \\tfrac{1}{2}\\right) \\Delta x$, $y = j \\Delta y$, for $i = 0, 1, \\dots, N_x - 1$ and $j = 0, 1, \\dots, N_y$.\n\nImpose the following physical boundary conditions on all four domain edges:\n- No-normal-flow (impermeable walls): $\\mathbf{u} \\cdot \\mathbf{n} = 0$ at boundaries, which implies $u = 0$ at the western and eastern domain faces ($i = 0$ and $i = N_x$), and $v = 0$ at the southern and northern domain faces ($j = 0$ and $j = N_y$).\n\nYour task is to implement the discrete divergence on the Arakawa C-grid for the following test suite, enforcing impermeable walls via the no-normal-flow condition as specified above. For each test case, construct the staggered velocity fields $(u, v)$ from given analytic definitions sampled at the appropriate staggered locations, apply the no-normal-flow boundary conditions to $u$ and $v$ on the domain boundary faces, and compute the maximum absolute value of the discrete divergence over all cell centers:\n$$\nD_{\\max} = \\max_{i=0,\\dots,N_x-1 \\atop j=0,\\dots,N_y-1} \\left| \\frac{u_{i+1, j} - u_{i, j}}{\\Delta x} + \\frac{v_{i, j+1} - v_{i, j}}{\\Delta y} \\right|.\n$$\nReport $D_{\\max}$ in inverse seconds (s$^{-1}$) as a floating-point number for each test case.\n\nAnalytic velocity field definitions to be sampled at staggered locations:\n- Case A (vortex-type incompressible flow via streamfunction): Let the streamfunction be $\\psi(x,y) = \\sin\\left(\\pi x / L_x\\right) \\sin\\left(\\pi y / L_y\\right)$. Define\n$$\nu(x,y) = \\frac{\\partial \\psi}{\\partial y} = \\frac{\\pi}{L_y} \\cos\\left(\\pi y / L_y\\right) \\sin\\left(\\pi x / L_x\\right), \\quad v(x,y) = -\\frac{\\partial \\psi}{\\partial x} = -\\frac{\\pi}{L_x} \\cos\\left(\\pi x / L_x\\right) \\sin\\left(\\pi y / L_y\\right).\n$$\n- Case B (uniform flow that violates no-normal-flow at vertical boundaries before enforcement): Define\n$$\nu(x,y) = U_0, \\quad v(x,y) = 0,\n$$\nwith constant speed $U_0$.\n- Case C (single-cell domain with the same streamfunction-based definition as Case A), to test boundary handling in the minimal grid.\n\nTest suite parameter sets:\n- Case A: $L_x = 1$ m, $L_y = 1$ m, $N_x = 16$, $N_y = 12$.\n- Case B: $L_x = 3$ m, $L_y = 2$ m, $N_x = 9$, $N_y = 6$, $U_0 = 0.5$ m/s.\n- Case C: $L_x = 1$ m, $L_y = 1$ m, $N_x = 1$, $N_y = 1$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result_A, result_B, result_C]\"), where each result is the floating-point value of $D_{\\max}$ for the corresponding case, expressed in s$^{-1}$.",
            "solution": "The problem requires the implementation of a discrete divergence operator on an Arakawa C-grid and its application to three test cases. The core of the task is to correctly represent the staggered velocity fields, apply the specified boundary conditions, and compute the maximum absolute divergence over the computational domain.\n\n**1. Arakawa C-Grid and Discrete Divergence**\n\nThe Arakawa C-grid is a staggered grid arrangement commonly used in computational fluid dynamics, particularly for geophysical flows. Its key feature is the spatial offset of different physical variables. In this problem, scalar quantities (like pressure or, in this case, the divergence itself) are located at the center of a grid cell $(i+\\tfrac{1}{2}, j+\\tfrac{1}{2})$, while vector components are located at the cell faces.\n- The horizontal velocity component, $u$, is defined at the center of vertical faces. Its locations are given by coordinates $(x_i, y_{j+1/2}) = (i\\Delta x, (j+\\tfrac{1}{2})\\Delta y)$ for $i \\in \\{0, 1, \\dots, N_x\\}$ and $j \\in \\{0, 1, \\dots, N_y-1\\}$. This can be represented by a 2D array of size $(N_x+1) \\times N_y$.\n- The vertical velocity component, $v$, is defined at the center of horizontal faces. Its locations are given by coordinates $(x_{i+1/2}, y_j) = ((i+\\tfrac{1}{2})\\Delta x, j\\Delta y)$ for $i \\in \\{0, 1, \\dots, N_x-1\\}$ and $j \\in \\{0, 1, \\dots, N_y\\}$. This can be represented by a 2D array of size $N_x \\times (N_y+1)$.\n\nThe conservation of mass for an incompressible fluid is $\\nabla \\cdot \\mathbf{u} = 0$. The finite-volume discretization on the C-grid for the cell $(i, j)$ (centered at $(x_{i+1/2}, y_{j+1/2})$) is given by:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i+\\frac{1}{2}, j+\\frac{1}{2}} = \\frac{u_{i+1, j} - u_{i, j}}{\\Delta x} + \\frac{v_{i, j+1} - v_{i, j}}{\\Delta y}\n$$\nHere, $u_{i+1, j} - u_{i, j}$ represents the net flux of the $u$-velocity component out of the cell in the $x$-direction, and $v_{i, j+1} - v_{i, j}$ represents the net flux of the $v$-velocity component in the $y$-direction. The indices correspond to the array locations of the velocity components on the cell faces. The divergence itself is computed for each of the $N_x \\times N_y$ cells.\n\n**2. Boundary Conditions**\n\nThe problem specifies impermeable wall (no-normal-flow) boundary conditions, $\\mathbf{u} \\cdot \\mathbf{n} = 0$, on all four domain boundaries. On the C-grid, this condition is enforced directly on the velocity components normal to the boundary.\n- Western boundary ($x=0$, $i=0$): The normal velocity is $u$. The condition is $u_{0, j} = 0$ for all $j \\in \\{0, \\dots, N_y-1\\}$.\n- Eastern boundary ($x=L_x$, $i=N_x$): The normal velocity is $u$. The condition is $u_{N_x, j} = 0$ for all $j \\in \\{0, \\dots, N_y-1\\}$.\n- Southern boundary ($y=0$, $j=0$): The normal velocity is $v$. The condition is $v_{i, 0} = 0$ for all $i \\in \\{0, \\dots, N_x-1\\}$.\n- Northern boundary ($y=L_y$, $j=N_y$): The normal velocity is $v$. The condition is $v_{i, N_y} = 0$ for all $i \\in \\{0, \\dots, N_x-1\\}$.\n\n**3. Test Case Analysis**\n\nFor each case, we first define the grid parameters, then create the velocity fields by sampling the given analytic functions at the appropriate staggered grid locations, enforce the no-normal-flow boundary conditions, compute the divergence field, and finally find the maximum absolute value $D_{\\max}$.\n\n**Case A: Vortex-Type Flow**\n- Parameters: $L_x = 1$ m, $L_y = 1$ m, $N_x = 16$, $N_y = 12$.\n- Velocity fields are derived from the streamfunction $\\psi(x,y) = \\sin(\\pi x / L_x) \\sin(\\pi y / L_y)$.\n- The $u$ and $v$ fields are populated by sampling $u(x,y) = \\frac{\\pi}{L_y} \\cos(\\pi y / L_y) \\sin(\\pi x / L_x)$ and $v(x,y) = -\\frac{\\pi}{L_x} \\cos(\\pi x / L_x) \\sin(\\pi y / L_y)$ at their respective staggered grid points.\n- Crucially, this analytic velocity field already satisfies the no-normal-flow conditions. For instance, at the western boundary $x=0$, $u(0,y) \\propto \\sin(0) = 0$. At the northern boundary $y=L_y$, $v(x,L_y) \\propto \\sin(\\pi L_y / L_y) = \\sin(\\pi) = 0$. The same holds for the other boundaries. Therefore, no explicit modification of the boundary velocities is needed after sampling.\n- The continuous analytical divergence is exactly zero. The computed discrete divergence will be a small, non-zero value representing the truncation error of the second-order finite-difference scheme.\n\n**Case B: Uniform Flow**\n- Parameters: $L_x = 3$ m, $L_y = 2$ m, $N_x = 9$, $N_y = 6$, $U_0 = 0.5$ m/s.\n- The initial velocity field is $u(x,y) = U_0$ and $v(x,y) = 0$. We initialize the $u$-array with $U_0$ and the $v$-array with $0$.\n- This initial field violates the no-normal-flow condition at the western and eastern boundaries. We must enforce the conditions by setting the first and last columns of the $u$-array to $0$: $u_{0,j} = 0$ and $u_{N_x, j} = 0$. The $v$-field already satisfies the conditions at the southern and northern boundaries.\n- The divergence is then computed. It will be non-zero only in the cells adjacent to the western and eastern boundaries.\n- For a cell in the westernmost column ($i=0$), the divergence is $\\frac{u_{1, j} - u_{0, j}}{\\Delta x} = \\frac{U_0 - 0}{\\Delta x}$.\n- For a cell in the easternmost column ($i=N_x-1$), the divergence is $\\frac{u_{N_x, j} - u_{N_x-1, j}}{\\Delta x} = \\frac{0 - U_0}{\\Delta x}$.\n- For all interior cells, the divergence is $0$.\n- Thus, $D_{\\max} = \\left| \\frac{U_0}{\\Delta x} \\right| = \\frac{0.5}{3/9} = \\frac{0.5}{1/3} = 1.5$ s$^{-1}$.\n\n**Case C: Single-Cell Vortex**\n- Parameters: $L_x = 1$ m, $L_y = 1$ m, $N_x = 1$, $N_y = 1$.\n- The velocity field is the same as in Case A, but sampled on a minimal $1 \\times 1$ grid.\n- The grid consists of one cell. We need to compute $u_{0,0}$, $u_{1,0}$, $v_{0,0}$, and $v_{0,1}$.\n- Grid locations for velocity components:\n  - $u_{0,0}$ is at $(x,y) = (0, 0.5)$. $u(0, 0.5) \\propto \\sin(0) = 0$.\n  - $u_{1,0}$ is at $(x,y) = (1, 0.5)$. $u(1, 0.5) \\propto \\sin(\\pi) = 0$.\n  - $v_{0,0}$ is at $(x,y) = (0.5, 0)$. $v(0.5, 0) \\propto \\sin(0) = 0$.\n  - $v_{0,1}$ is at $(x,y) = (0.5, 1)$. $v(0.5, 1) \\propto \\sin(\\pi) = 0$.\n- All relevant velocity components are exactly zero due to the specific sampling locations falling on the zeros of the trigonometric functions.\n- The discrete divergence is $\\frac{u_{1,0} - u_{0,0}}{\\Delta x} + \\frac{v_{0,1} - v_{0,0}}{\\Delta y} = \\frac{0-0}{1} + \\frac{0-0}{1} = 0$.\n- Therefore, $D_{\\max} = 0$.\n\nThe implementation will proceed by constructing a function that takes the case parameters, builds the grids, populates and corrects the velocity fields, computes the divergence, and returns the maximum absolute value.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_dmax(params: dict) -> float:\n    \"\"\"\n    Calculates the maximum absolute divergence on an Arakawa C-grid.\n\n    Args:\n        params: A dictionary containing the parameters for the simulation case.\n                Keys include 'case', 'Lx', 'Ly', 'Nx', 'Ny', and 'U0' if applicable.\n\n    Returns:\n        The maximum absolute value of the discrete divergence (D_max).\n    \"\"\"\n    case = params['case']\n    Lx, Ly = params['Lx'], params['Ly']\n    Nx, Ny = int(params['Nx']), int(params['Ny'])\n\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    u_shape = (Nx + 1, Ny)\n    v_shape = (Nx, Ny + 1)\n    \n    if case in ['A', 'C']:\n        # Case A and C: Vortex-type incompressible flow via streamfunction\n        \n        # Create coordinate grids for u and v velocity components.\n        # u is located at (i*dx, (j+0.5)*dy)\n        u_x_coords = np.linspace(0.0, Lx, Nx + 1)\n        u_y_coords = np.linspace(0.5 * dy, Ly - 0.5 * dy, Ny)\n        u_xx, u_yy = np.meshgrid(u_x_coords, u_y_coords, indexing='ij')\n\n        # v is located at ((i+0.5)*dx, j*dy)\n        v_x_coords = np.linspace(0.5 * dx, Lx - 0.5 * dx, Nx)\n        v_y_coords = np.linspace(0.0, Ly, Ny + 1)\n        v_xx, v_yy = np.meshgrid(v_x_coords, v_y_coords, indexing='ij')\n\n        # Populate velocity fields using the analytic functions.\n        # The analytic functions naturally satisfy the no-normal-flow boundary conditions.\n        u = (np.pi / Ly) * np.cos(np.pi * u_yy / Ly) * np.sin(np.pi * u_xx / Lx)\n        v = -(np.pi / Lx) * np.cos(np.pi * v_xx / Lx) * np.sin(np.pi * v_yy / Ly)\n        \n    elif case == 'B':\n        # Case B: Uniform flow that violates no-normal-flow initially\n        U0 = params['U0']\n        \n        # Initialize uniform velocity fields.\n        u = np.full(u_shape, U0)\n        v = np.zeros(v_shape)\n\n        # Enforce no-normal-flow boundary conditions (impermeable walls).\n        # Set u=0 at western (i=0) and eastern (i=Nx) boundaries.\n        u[0, :] = 0.0\n        u[-1, :] = 0.0\n        \n        # Set v=0 at southern (j=0) and northern (j=Ny) boundaries.\n        # The v field is already initialized to zeros, so this is satisfied.\n        v[:, 0] = 0.0\n        v[:, -1] = 0.0\n\n    else:\n        raise ValueError(f\"Unknown case: {case}\")\n\n    # Calculate the discrete divergence at each cell center.\n    # The divergence field has dimensions (Nx, Ny).\n    # du_dx corresponds to (u_{i+1,j} - u_{i,j}) / dx\n    # dv_dy corresponds to (v_{i,j+1} - v_{i,j}) / dy\n    \n    du_dx = (u[1:, :] - u[:-1, :]) / dx\n    dv_dy = (v[:, 1:] - v[:, :-1]) / dy\n\n    divergence = du_dx + dv_dy\n    \n    # Compute the maximum absolute value of the divergence.\n    d_max = np.max(np.abs(divergence))\n    \n    return d_max\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'case': 'A', 'Lx': 1.0, 'Ly': 1.0, 'Nx': 16, 'Ny': 12},\n        {'case': 'B', 'Lx': 3.0, 'Ly': 2.0, 'Nx': 9, 'Ny': 6, 'U0': 0.5},\n        {'case': 'C', 'Lx': 1.0, 'Ly': 1.0, 'Nx': 1, 'Ny': 1},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = calculate_dmax(params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Building on the concept of discrete operators, this exercise applies them to a core algorithm in computational fluid dynamics: the projection method for incompressible flows. You will implement the full projection step, which involves solving a discrete Poisson equation to enforce the divergence-free condition $\\nabla \\cdot \\mathbf{u} = 0$. This practice not only demonstrates a powerful numerical technique but also critically compares the performance of the staggered C-grid against a collocated A-grid, revealing the C-grid's superior properties in preventing numerical artifacts. ",
            "id": "3862986",
            "problem": "Consider the incompressible momentum equations under the Boussinesq approximation with constant density, where the velocity field is constrained by the divergence-free condition. The core constraint is that the velocity field $\\mathbf{u} = (u, v)$ must satisfy $\\nabla \\cdot \\mathbf{u} = 0$. In projection methods for incompressible flow, one computes an intermediate velocity $\\mathbf{u}^{\\ast}$ that does not necessarily satisfy the divergence-free constraint, and then projects it onto the space of divergence-free fields using a scalar pressure field $p$ such that the corrected velocity $\\mathbf{u}^{n+1}$ is divergence-free. The projection step enforces $\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\Delta t \\nabla p$ together with $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$, implying the discrete Poisson equation for the pressure,\n$$\n\\nabla^2 p = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast},\n$$\nwith periodic boundary conditions. In Arakawa grid staggering, there are two canonical layouts: the Arakawa A-grid (all prognostic variables at cell centers) and the Arakawa C-grid (pressure at cell centers, the $u$-velocity at vertical cell faces, and the $v$-velocity at horizontal cell faces). For a uniform, two-dimensional, periodic rectangular domain with $N_x \\times N_y$ cells, spacings $\\Delta x$ and $\\Delta y$, and time step $\\Delta t$, implement the projection method on both the Arakawa A-grid and the Arakawa C-grid using discrete operators that respect the layout of each grid:\n- On the Arakawa C-grid, define the discrete divergence at cell centers as differences of face-normal fluxes, and define the discrete gradient as face-normal differences of cell-centered pressure consistent with the divergence operator.\n- On the Arakawa A-grid, define the discrete divergence and gradient at cell centers using second-order central differences consistent with periodic boundary conditions.\n\nUse a periodic discrete Poisson solver to obtain the pressure $p$ at cell centers. The solver must handle the discrete Poisson equation under periodic boundary conditions, including the null space associated with constant modes. Your program must compute, for each test case, the ratio\n$$\nR = \\frac{\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_2}{\\|\\nabla \\cdot \\mathbf{u}^{\\ast}\\|_2},\n$$\nwhere $\\|\\cdot\\|_2$ denotes the discrete $\\ell^2$ norm over the set of cell centers. If the denominator is zero, define $R = 0$.\n\nConstruct the intermediate velocities $\\mathbf{u}^{\\ast}$ deterministically and in a way that respects periodicity based on the grid type. For each test, use the following manufactured fields:\n- Arakawa C-grid: $u^{\\ast}$ defined on vertical faces indexed by $(i,j)$ with $i = 0, \\ldots, N_x$ and $j = 0, \\ldots, N_y-1$, and $v^{\\ast}$ defined on horizontal faces indexed by $(i,j)$ with $i = 0, \\ldots, N_x-1$ and $j = 0, \\ldots, N_y$, as\n$$\nu^{\\ast}_{i,j} = \\sin\\left( \\frac{2\\pi i}{N_x} \\right) + 0.3 \\cos\\left( \\frac{2\\pi j}{N_y} \\right), \\quad v^{\\ast}_{i,j} = 0.7 \\cos\\left( \\frac{2\\pi i}{N_x} \\right) - \\sin\\left( \\frac{2\\pi j}{N_y} \\right).\n$$\n- Arakawa A-grid: $u^{\\ast}$ and $v^{\\ast}$ defined at cell centers indexed by $(i,j)$ with $i = 0, \\ldots, N_x-1$ and $j = 0, \\ldots, N_y-1$, as\n$$\nu^{\\ast}_{i,j} = \\sin\\left( \\frac{2\\pi i}{N_x} \\right) + 0.3 \\cos\\left( \\frac{2\\pi j}{N_y} \\right), \\quad v^{\\ast}_{i,j} = 0.7 \\cos\\left( \\frac{2\\pi i}{N_x} \\right) - \\sin\\left( \\frac{2\\pi j}{N_y} \\right).\n$$\nThese definitions ensure periodicity. The discrete operators and the projection step must be formulated in a manner that they are adjoint-consistent on the chosen grid, so that $\\nabla^2$ is the divergence of the gradient.\n\nImplement a periodic discrete Poisson solver for cell-centered $p$ using the Fast Fourier Transform (FFT) approach. The solver must explicitly handle the zero wavenumber by choosing the pressure mean to be zero.\n\nTest Suite:\nProvide results for the following four parameter sets. Each test case is a tuple $(\\text{grid\\_type}, N_x, N_y, \\Delta x, \\Delta y, \\Delta t)$ where $\\text{grid\\_type} \\in \\{\\text{\"C\"}, \\text{\"A\"}\\}$:\n1. $(\\text{\"C\"}, 16, 12, 1.0, 2.0, 0.2)$\n2. $(\\text{\"A\"}, 16, 12, 1.0, 2.0, 0.15)$\n3. $(\\text{\"C\"}, 3, 3, 1.3, 0.9, 0.25)$\n4. $(\\text{\"A\"}, 8, 2, 0.8, 1.2, 0.05)$\n\nFinal Output Format:\nYour program should produce a single line of output containing the values of $R$ for the four test cases, as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3,r4]\"). No physical units are required; all quantities are dimensionless. All angles, where present in trigonometric functions, are in radians by construction of the discrete operators. The output values must be floating-point numbers.",
            "solution": "The problem requires the implementation of a projection method to enforce the incompressibility constraint on a velocity field in a two-dimensional, periodic domain. This is a fundamental technique in computational fluid dynamics for simulating incompressible flows. The method's efficacy is to be evaluated on two different grid staggering arrangements: the Arakawa A-grid (collocated) and the Arakawa C-grid (staggered). The performance metric is the ratio $R$ of the $\\ell^2$ norm of the velocity divergence after the projection to its norm before the projection.\n\nThe projection method is a fractional step algorithm. Given an intermediate velocity field $\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})$ at a time step, which is not necessarily divergence-free, the goal is to find a correction involving a scalar pressure field $p$ such that the final velocity field $\\mathbf{u}^{n+1}$ is divergence-free. This is achieved by projecting $\\mathbf{u}^{\\ast}$ onto the space of divergence-free vector fields. The projection is defined by two conditions:\n$1$. The velocity is updated via a pressure gradient:\n$$ \\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\Delta t \\nabla p $$\nwhere $\\Delta t$ is the time step.\n$2$. The final velocity field must be divergence-free:\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = 0 $$\nTaking the divergence of the first equation and substituting the second gives:\n$$ \\nabla \\cdot (\\mathbf{u}^{\\ast} - \\Delta t \\nabla p) = 0 $$\n$$ \\nabla \\cdot \\mathbf{u}^{\\ast} - \\Delta t \\nabla^2 p = 0 $$\nThis yields a Poisson equation for the pressure field $p$:\n$$ \\nabla^2 p = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\nThe solution of this equation provides the pressure required to project the velocity field onto the divergence-free subspace. The problem specifies periodic boundary conditions for a rectangular domain of size $N_x \\times N_y$ cells with grid spacings $\\Delta x$ and $\\Delta y$.\n\nThe discretization of the divergence ($\\nabla \\cdot$), gradient ($\\nabla$), and Laplacian ($\\nabla^2$) operators depends on the grid layout.\n\nOn the Arakawa A-grid, all variables ($u, v, p$) are collocated at the cell centers, indexed by $(i,j)$ for $i=0, \\dots, N_x-1$ and $j=0, \\dots, N_y-1$. We use second-order central finite differences for the operators:\nThe divergence of a velocity field $\\mathbf{u}=(u,v)$ at cell $(i,j)$ is:\n$$ (\\nabla \\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2 \\Delta x} + \\frac{v_{i,j+1} - v_{i,j-1}}{2 \\Delta y} $$\nThe gradient of a scalar pressure field $p$ at cell $(i,j)$ is:\n$$ (\\nabla p)_{x, i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad (\\nabla p)_{y, i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta y} $$\nAll indices are handled periodically (e.g., $u_{N_x, j} = u_{0, j}$, $u_{-1, j} = u_{N_x-1, j}$).\n\nOn the Arakawa C-grid, variables are staggered. Pressure $p$ is at cell centers $(i,j)$. The horizontal velocity component $u$ is on vertical cell faces, indexed here such that $u_{i,j}$ is at the face between cells $(i-1,j)$ and $(i,j)$. The vertical velocity component $v$ is on horizontal cell faces, where $v_{i,j}$ is at the face between cells $(i,j-1)$ and $(i,j)$.\nThe discrete divergence at cell center $(i,j)$ is defined as the net flux from the cell:\n$$ (\\nabla \\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1,j} - u_{i,j}}{\\Delta x} + \\frac{v_{i,j+1} - v_{i,j}}{\\Delta y} $$\nThe discrete gradient of the cell-centered pressure $p$ produces components on the cell faces, consistent with the velocity locations:\n$$ (\\nabla p)_{x, i,j} = \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x}, \\quad (\\nabla p)_{y, i,j} = \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y} $$\nAn important property of the C-grid staggering is that the discrete Laplacian, formed by composing the divergence and gradient operators ($\\nabla^2 = \\nabla \\cdot \\nabla$), results in the standard five-point stencil, identical to the A-grid's second-order centered Laplacian:\n$$ (\\nabla^2 p)_{i,j} = \\frac{p_{i+1,j} - 2 p_{i,j} + p_{i-1,j}}{(\\Delta x)^2} + \\frac{p_{i,j+1} - 2 p_{i,j} + p_{i,j-1}}{(\\Delta y)^2} $$\nThis adjoint consistency is a key advantage of the C-grid.\n\nFor both grids, the intermediate velocity field $\\mathbf{u}^{\\ast}$ is given by a manufactured solution. The locations for these fields are specified by the problem:\nFor the A-grid, $u^{\\ast}$ and $v^{\\ast}$ are defined at cell centers $(i,j)$:\n$$ u^{\\ast}_{i,j} = \\sin\\left( \\frac{2\\pi i}{N_x} \\right) + 0.3 \\cos\\left( \\frac{2\\pi j}{N_y} \\right), \\quad v^{\\ast}_{i,j} = 0.7 \\cos\\left( \\frac{2\\pi i}{N_x} \\right) - \\sin\\left( \\frac{2\\pi j}{N_y} \\right) $$\nFor the C-grid, $u^{\\ast}$ is defined on vertical faces and $v^{\\ast}$ on horizontal faces, using the same functional forms but on their respective staggered grid coordinates.\n\nThe discrete Poisson equation, $\\hat{L}p = f$ where $\\hat{L}$ is the discrete Laplacian and $f = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast}$, is solved efficiently using the Fast Fourier Transform (FFT). Applying a 2D discrete Fourier transform to the equation converts the spatial convolution of the Laplacian into a simple multiplication in Fourier space:\n$$ \\tilde{L}_{m,n} \\tilde{p}_{m,n} = \\tilde{f}_{m,n} $$\nwhere $\\tilde_.$ denotes the Fourier transform and $(m, n)$ are the integer wavenumber indices. The Fourier symbol $\\tilde{L}_{m,n}$ of the five-point Laplacian is:\n$$ \\tilde{L}_{m,n} = -\\frac{4}{(\\Delta x)^2} \\sin^2\\left(\\frac{\\pi m}{N_x}\\right) - \\frac{4}{(\\Delta y)^2} \\sin^2\\left(\\frac{\\pi n}{N_y}\\right) $$\nFor the zero-wavenumber mode $(m,n)=(0,0)$, $\\tilde{L}_{0,0} = 0$. This reflects the fact that the pressure solution is unique only up to an arbitrary constant. The problem specifies resolving this ambiguity by enforcing a zero-mean pressure, which corresponds to setting the zero-wavenumber component of its Fourier transform to zero: $\\tilde{p}_{0,0} = 0$. For all other modes $(m,n) \\neq (0,0)$, the pressure in Fourier space is $\\tilde{p}_{m,n} = \\tilde{f}_{m,n} / \\tilde{L}_{m,n}$. The pressure field $p$ is then recovered by applying an inverse 2D FFT.\n\nThe overall algorithm for each test case is as follows:\n$1$. Construct the intermediate velocity fields $u^{\\ast}$ and $v^{\\ast}$ on the appropriate grid (A or C).\n$2$. Compute the initial divergence field $D^{\\ast} = \\nabla \\cdot \\mathbf{u}^{\\ast}$ using the grid-appropriate discrete divergence operator.\n$3$. Calculate the denominator of the ratio: $\\|\\nabla \\cdot \\mathbf{u}^{\\ast}\\|_2 = \\|D^{\\ast}\\|_2$. If this norm is zero, $R=0$.\n$4$. Solve the discrete Poisson equation $\\nabla^2 p = \\frac{1}{\\Delta t} D^{\\ast}$ for $p$ using the FFT-based solver.\n$5$. Compute the pressure gradient $\\nabla p$ using the grid-appropriate discrete gradient operator.\n$6$. Calculate the projected velocity field: $\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\Delta t \\nabla p$.\n$7$. Compute the final divergence field $D^{n+1} = \\nabla \\cdot \\mathbf{u}^{n+1}$.\n$8$. Calculate the numerator of the ratio: $\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_2 = \\|D^{n+1}\\|_2$.\n$9$. Compute the final ratio $R = \\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_2 / \\|\\nabla \\cdot \\mathbf{u}^{\\ast}\\|_2$. This ratio should be close to floating-point zero, indicating a successful projection.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that iterates through test cases and prints the results.\n    \"\"\"\n    test_cases = [\n        (\"C\", 16, 12, 1.0, 2.0, 0.2),\n        (\"A\", 16, 12, 1.0, 2.0, 0.15),\n        (\"C\", 3, 3, 1.3, 0.9, 0.25),\n        (\"A\", 8, 2, 0.8, 1.2, 0.05),\n    ]\n\n    results = []\n    for case in test_cases:\n        grid_type, Nx, Ny, dx, dy, dt = case\n        \n        # --- 1. Construct intermediate velocity fields u* ---\n        if grid_type == \"A\":\n            # Collocated grid: u*, v*, p are at cell centers (Nx, Ny)\n            i_coords, j_coords = np.mgrid[0:Nx, 0:Ny]\n            u_star = np.sin(2 * np.pi * i_coords / Nx) + 0.3 * np.cos(2 * np.pi * j_coords / Ny)\n            v_star = 0.7 * np.cos(2 * np.pi * i_coords / Nx) - np.sin(2 * np.pi * j_coords / Ny)\n        elif grid_type == \"C\":\n            # Staggered grid: p at centers, u on vertical faces, v on horizontal faces\n            # u* on vertical faces: (Nx+1, Ny) with u[0,:]=u[Nx,:]\n            i_u, j_u = np.mgrid[0:Nx + 1, 0:Ny]\n            u_star = np.sin(2 * np.pi * i_u / Nx) + 0.3 * np.cos(2 * np.pi * j_u / Ny)\n            # v* on horizontal faces: (Nx, Ny+1) with v[:,0]=v[:,Ny]\n            i_v, j_v = np.mgrid[0:Nx, 0:Ny + 1]\n            v_star = 0.7 * np.cos(2 * np.pi * i_v / Nx) - np.sin(2 * np.pi * j_v / Ny)\n\n        # --- 2. Compute initial divergence div(u*) ---\n        if grid_type == \"A\":\n            du_dx = (np.roll(u_star, -1, axis=0) - np.roll(u_star, 1, axis=0)) / (2 * dx)\n            dv_dy = (np.roll(v_star, -1, axis=1) - np.roll(v_star, 1, axis=1)) / (2 * dy)\n            div_u_star = du_dx + dv_dy\n        elif grid_type == \"C\":\n            du_dx = (u_star[1:, :] - u_star[:-1, :]) / dx\n            dv_dy = (v_star[:, 1:] - v_star[:, :-1]) / dy\n            div_u_star = du_dx + dv_dy\n\n        # --- 3. Compute L2 norm of initial divergence ---\n        norm_div_u_star = np.linalg.norm(div_u_star)\n        if norm_div_u_star == 0.0:\n            results.append(0.0)\n            continue\n            \n        # --- 4. Solve Poisson equation for pressure p ---\n        # Right-hand side of the Poisson equation\n        rhs = div_u_star / dt\n        \n        # FFT of the RHS\n        rhs_tilde = np.fft.fft2(rhs)\n        \n        # Wavenumbers for the FFT\n        m = np.fft.fftfreq(Nx) * Nx\n        n = np.fft.fftfreq(Ny) * Ny\n        mm, nn = np.meshgrid(m, n, indexing='ij')\n\n        # Fourier symbol of the Laplacian operator\n        laplacian_tilde = (-4 / (dx**2)) * np.sin(np.pi * mm / Nx)**2 \\\n                        + (-4 / (dy**2)) * np.sin(np.pi * nn / Ny)**2\n        \n        # Avoid division by zero for the zero-wavenumber mode\n        laplacian_tilde[0, 0] = 1.0\n        \n        # Solve for p in Fourier space\n        p_tilde = rhs_tilde / laplacian_tilde\n        \n        # Enforce zero mean pressure\n        p_tilde[0, 0] = 0.0\n        \n        # Inverse FFT to get pressure in physical space\n        p = np.fft.ifft2(p_tilde).real\n\n        # --- 5. Compute pressure gradient grad(p) ---\n        if grid_type == \"A\":\n            grad_p_x = (np.roll(p, -1, axis=0) - np.roll(p, 1, axis=0)) / (2 * dx)\n            grad_p_y = (np.roll(p, -1, axis=1) - np.roll(p, 1, axis=1)) / (2 * dy)\n        elif grid_type == \"C\":\n            # Gradient on x-faces\n            grad_p_x = (p - np.roll(p, 1, axis=0)) / dx\n            # Extend to be periodic with shape (Nx+1, Ny)\n            grad_p_x = np.concatenate((grad_p_x, grad_p_x[0:1, :]), axis=0)\n\n            # Gradient on y-faces\n            grad_p_y = (p - np.roll(p, 1, axis=1)) / dy\n            # Extend to be periodic with shape (Nx, Ny+1)\n            grad_p_y = np.concatenate((grad_p_y, grad_p_y[:, 0:1]), axis=1)\n\n        # --- 6. Update velocity to be u_new = u_star - dt*grad(p) ---\n        u_new = u_star - dt * grad_p_x\n        v_new = v_star - dt * grad_p_y\n\n        # --- 7. Compute final divergence div(u_new) ---\n        if grid_type == \"A\":\n            du_dx_new = (np.roll(u_new, -1, axis=0) - np.roll(u_new, 1, axis=0)) / (2 * dx)\n            dv_dy_new = (np.roll(v_new, -1, axis=1) - np.roll(v_new, 1, axis=1)) / (2 * dy)\n            div_u_new = du_dx_new + dv_dy_new\n        elif grid_type == \"C\":\n            du_dx_new = (u_new[1:, :] - u_new[:-1, :]) / dx\n            dv_dy_new = (v_new[:, 1:] - v_new[:, :-1]) / dy\n            div_u_new = du_dx_new + dv_dy_new\n\n        # --- 8. Compute L2 norm of final divergence ---\n        norm_div_u_new = np.linalg.norm(div_u_new)\n\n        # --- 9. Compute the ratio R ---\n        ratio = norm_div_u_new / norm_div_u_star\n        results.append(ratio)\n        \n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The excellent performance of the Arakawa C-grid is not accidental; it stems from its desirable mathematical properties. This exercise moves from implementation to theoretical analysis, tasking you with deriving the spectral representation of the discrete Laplacian operator using Fourier analysis. By determining the operator's eigenvalues, you will gain insight into how the C-grid represents waves of different scales and why it is robust against the numerical errors that can plague simpler grid arrangements. ",
            "id": "4052174",
            "problem": "Consider a doubly periodic horizontal domain with lengths $L_{x}$ and $L_{y}$, discretized by a uniform rectilinear grid with $N_{x}$ and $N_{y}$ points, so that the grid spacings are $h_{x} = L_{x}/N_{x}$ and $h_{y} = L_{y}/N_{y}$. In the Arakawa C-grid staggering, a scalar field $p$ (e.g., pressure) is stored at cell centers $(i,j)$, the $x$-component of velocity $u$ at east-west face centers $(i+\\tfrac{1}{2},j)$, and the $y$-component of velocity $v$ at north-south face centers $(i,j+\\tfrac{1}{2})$, for integer indices $i \\in \\{0,\\dots,N_{x}-1\\}$ and $j \\in \\{0,\\dots,N_{y}-1\\}$. Define the standard second-order centered discrete gradient mapping cell-centered $p$ to face-centered components as\n$$\nG_{x} p\\big|_{i+\\tfrac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{h_{x}}, \\qquad\nG_{y} p\\big|_{i,j+\\tfrac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{h_{y}},\n$$\nand the standard second-order centered discrete divergence mapping face-centered $(u,v)$ to cell centers as\n$$\nD_{x} u\\big|_{i,j} = \\frac{u_{i+\\tfrac{1}{2},j} - u_{i-\\tfrac{1}{2},j}}{h_{x}}, \\qquad\nD_{y} v\\big|_{i,j} = \\frac{v_{i,j+\\tfrac{1}{2}} - v_{i,j-\\tfrac{1}{2}}}{h_{y}}.\n$$\nThe C-grid discrete Laplacian acting on $p$ is defined by composing divergence with gradient,\n$$\n\\Delta_{C} p\\big|_{i,j} = D_{x}\\!\\left(G_{x} p\\right)\\big|_{i,j} + D_{y}\\!\\left(G_{y} p\\right)\\big|_{i,j},\n$$\nand the associated discrete Helmholtz operator acting on $p$ is\n$$\nH p\\big|_{i,j} = p_{i,j} - \\lambda\\, \\Delta_{C} p\\big|_{i,j},\n$$\nwhere $\\lambda > 0$ is a constant parameter. Assume periodic boundary conditions in both directions, and consider the discrete Fourier modes\n$$\np_{i,j} = \\exp\\!\\big( \\mathrm{i} (k_{x}\\, i\\, h_{x} + k_{y}\\, j\\, h_{y}) \\big),\n$$\nwith wavenumbers $k_{x}$ and $k_{y}$ drawn from the discrete set consistent with periodicity. Using only the fundamental base of discrete shift operators and discrete Fourier analysis, derive the discrete Fourier symbol of $\\Delta_{C}$ and hence of $H$, and determine the condition number of $H$ (defined as the ratio of the largest to the smallest eigenvalue over all discrete wavenumbers admitted by the grid).\n\nProvide the final condition number as a single closed-form analytic expression in terms of $\\lambda$, $h_{x}$, and $h_{y}$. No numerical evaluation is required. The domain is suited to Numerical Weather Prediction (NWP) and climate modeling; ensure all steps are scientifically consistent with the C-grid staggering described above. The final answer must be a single expression and must not include any units.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the field of numerical methods for geophysical fluid dynamics, well-posed, objective, and internally consistent. We may proceed with the solution.\n\nThe core of the task is to determine the eigenvalues of the discrete Helmholtz operator $H$ through Fourier analysis, and then find the ratio of the maximum to the minimum eigenvalue.\n\nFirst, we write the explicit form of the Arakawa C-grid discrete Laplacian, $\\Delta_C$, acting on a scalar field $p$ defined at cell centers $(i,j)$. The operator is defined as the composition of the discrete divergence $D = (D_x, D_y)$ and the discrete gradient $G = (G_x, G_y)$:\n$$\n\\Delta_{C} p\\big|_{i,j} = D_{x}\\!\\left(G_{x} p\\right)\\big|_{i,j} + D_{y}\\!\\left(G_{y} p\\right)\\big|_{i,j}\n$$\nWe expand each term using the provided definitions. The $x$-component is:\n$$\nD_{x}\\!\\left(G_{x} p\\right)\\big|_{i,j} = \\frac{(G_x p)\\big|_{i+\\tfrac{1}{2},j} - (G_x p)\\big|_{i-\\tfrac{1}{2},j}}{h_{x}}\n$$\nSubstituting the definition of the discrete gradient $G_x$:\n$$\n(G_x p)\\big|_{i+\\tfrac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{h_{x}} \\quad \\text{and} \\quad (G_x p)\\big|_{i-\\tfrac{1}{2},j} = \\frac{p_{i,j} - p_{i-1,j}}{h_{x}}\n$$\nCombining these gives:\n$$\nD_{x}\\!\\left(G_{x} p\\right)\\big|_{i,j} = \\frac{1}{h_{x}} \\left( \\frac{p_{i+1,j} - p_{i,j}}{h_{x}} - \\frac{p_{i,j} - p_{i-1,j}}{h_{x}} \\right) = \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h_{x}^2}\n$$\nBy an identical derivation, the $y$-component is:\n$$\nD_{y}\\!\\left(G_{y} p\\right)\\big|_{i,j} = \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h_{y}^2}\n$$\nThus, the discrete Laplacian is given by the standard five-point stencil:\n$$\n\\Delta_{C} p\\big|_{i,j} = \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h_{x}^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h_{y}^2}\n$$\n\nNext, we perform a discrete Fourier analysis by applying this operator to a single Fourier mode, $p_{i,j} = \\exp\\!\\big( \\mathrm{i} (k_{x}\\, i\\, h_{x} + k_{y}\\, j\\, h_{y}) \\big)$. The action of the grid shift operators on this mode is multiplicative:\n$$\np_{i\\pm 1, j} = \\exp(\\pm \\mathrm{i} k_x h_x) p_{i,j}\n$$\n$$\np_{i, j\\pm 1} = \\exp(\\pm \\mathrm{i} k_y h_y) p_{i,j}\n$$\nSubstituting these into the expression for $\\Delta_C p_{i,j}$:\n$$\n\\Delta_C p_{i,j} = \\left( \\frac{\\exp(\\mathrm{i} k_x h_x) - 2 + \\exp(-\\mathrm{i} k_x h_x)}{h_x^2} + \\frac{\\exp(\\mathrm{i} k_y h_y) - 2 + \\exp(-\\mathrm{i} k_y h_y)}{h_y^2} \\right) p_{i,j}\n$$\nUsing the identity $2\\cos(\\theta) = \\exp(\\mathrm{i}\\theta) + \\exp(-\\mathrm{i}\\theta)$, the expression in the parenthesis simplifies:\n$$\n\\frac{2\\cos(k_x h_x) - 2}{h_x^2} + \\frac{2\\cos(k_y h_y) - 2}{h_y^2}\n$$\nUsing the half-angle identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$, this becomes:\n$$\n-\\frac{4\\sin^2(k_x h_x/2)}{h_x^2} - \\frac{4\\sin^2(k_y h_y/2)}{h_y^2}\n$$\nThis expression is the discrete Fourier symbol of the operator $\\Delta_C$, which we denote $\\widehat{\\Delta_C}(k_x, k_y)$. It is the eigenvalue corresponding to the eigenmode $(k_x, k_y)$.\n$$\n\\widehat{\\Delta_C}(k_x, k_y) = -\\frac{4}{h_x^2}\\sin^2\\left(\\frac{k_x h_x}{2}\\right) - \\frac{4}{h_y^2}\\sin^2\\left(\\frac{k_y h_y}{2}\\right)\n$$\nThe discrete Helmholtz operator is $H = I - \\lambda \\Delta_C$, where $I$ is the identity operator. Its action on the Fourier mode $p_{i,j}$ yields:\n$$\nH p_{i,j} = (I - \\lambda \\Delta_C) p_{i,j} = p_{i,j} - \\lambda \\widehat{\\Delta_C}(k_x, k_y) p_{i,j} = \\left(1 - \\lambda \\widehat{\\Delta_C}(k_x, k_y)\\right) p_{i,j}\n$$\nThe eigenvalues $\\mu(k_x, k_y)$ of $H$ are therefore given by its Fourier symbol $\\widehat{H}(k_x, k_y)$:\n$$\n\\mu(k_x, k_y) = 1 - \\lambda \\widehat{\\Delta_C}(k_x, k_y) = 1 + \\frac{4\\lambda}{h_x^2}\\sin^2\\left(\\frac{k_x h_x}{2}\\right) + \\frac{4\\lambda}{h_y^2}\\sin^2\\left(\\frac{k_y h_y}{2}\\right)\n$$\nThe condition number, $\\kappa(H)$, of the operator (or its matrix representation) is the ratio of its largest eigenvalue to its smallest eigenvalue over all admissible wavenumbers:\n$$\n\\kappa(H) = \\frac{\\mu_{max}}{\\mu_{min}}\n$$\nThe admissible wavenumbers on the periodic grid are $k_x = 2\\pi m/L_x = 2\\pi m/(N_x h_x)$ and $k_y = 2\\pi n/L_y = 2\\pi n/(N_y h_y)$ for integers $m, n$.\n\nTo find the minimum eigenvalue, $\\mu_{min}$, we must minimize $\\mu(k_x, k_y)$. Since $\\lambda>0$, the minimum is achieved when both $\\sin^2$ terms are zero. This occurs for the zero-wavenumber mode $(k_x, k_y) = (0,0)$, which corresponds to $(m,n)=(0,0)$ and is always an admissible mode.\n$$\n\\mu_{min} = \\mu(0,0) = 1 + \\frac{4\\lambda}{h_x^2}\\sin^2(0) + \\frac{4\\lambda}{h_y^2}\\sin^2(0) = 1\n$$\nTo find the maximum eigenvalue, $\\mu_{max}$, we must maximize $\\mu(k_x, k_y)$. This occurs when the $\\sin^2$ terms are maximized. The arguments of the sine functions are $\\frac{k_x h_x}{2} = \\frac{\\pi m}{N_x}$ and $\\frac{k_y h_y}{2} = \\frac{\\pi n}{N_y}$. The maximum value of $\\sin^2(\\theta)$ is $1$, achieved at $\\theta=\\pi/2$. This corresponds to the Nyquist frequency, where the wavelength is twice the grid spacing. While the exact maximum on the discrete grid depends on the parity of $N_x$ and $N_y$, the problem asks for an expression in terms of only $\\lambda, h_x, h_y$. This implies we should find the supremum of the eigenvalue expression over the continuum of wavenumbers that the grid can resolve, i.e., $k_x \\in [-\\pi/h_x, \\pi/h_x]$ and $k_y \\in [-\\pi/h_y, \\pi/h_y]$. The supremum of $\\sin^2(k_x h_x/2)$ in this range is $1$, achieved at $k_x = \\pm \\pi/h_x$. Similarly, the supremum for the $y$-term is $1$.\n$$\n\\mu_{max} = \\sup_{k_x, k_y} \\mu(k_x, k_y) = 1 + \\frac{4\\lambda}{h_x^2}\\sup\\left[\\sin^2\\left(\\frac{k_x h_x}{2}\\right)\\right] + \\frac{4\\lambda}{h_y^2}\\sup\\left[\\sin^2\\left(\\frac{k_y h_y}{2}\\right)\\right]\n$$\n$$\n\\mu_{max} = 1 + \\frac{4\\lambda}{h_x^2}(1) + \\frac{4\\lambda}{h_y^2}(1) = 1 + \\frac{4\\lambda}{h_x^2} + \\frac{4\\lambda}{h_y^2}\n$$\nThe condition number is then the ratio:\n$$\n\\kappa(H) = \\frac{\\mu_{max}}{\\mu_{min}} = \\frac{1 + \\frac{4\\lambda}{h_x^2} + \\frac{4\\lambda}{h_y^2}}{1} = 1 + 4\\lambda\\left(\\frac{1}{h_x^2} + \\frac{1}{h_y^2}\\right)\n$$\nThis expression gives the condition number in terms of the required parameters.",
            "answer": "$$\\boxed{1 + 4\\lambda\\left(\\frac{1}{h_x^2} + \\frac{1}{h_y^2}\\right)}$$"
        }
    ]
}