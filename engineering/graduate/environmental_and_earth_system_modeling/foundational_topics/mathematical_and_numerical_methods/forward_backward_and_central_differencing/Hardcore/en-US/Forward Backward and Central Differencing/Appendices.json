{
    "hands_on_practices": [
        {
            "introduction": "In the idealized world of calculus, we can make our step size $h$ arbitrarily small to achieve perfect accuracy. However, in the world of computation, we are limited by finite-precision arithmetic. This practice explores the fundamental trade-off between truncation error, which shrinks as $h$ decreases, and round-off error, which is amplified by small $h$. By deriving the optimal step size that balances these two competing error sources, you will gain a crucial understanding of the practical limits of numerical differentiation and why \"smaller\" is not always better. ",
            "id": "3124976",
            "problem": "Consider approximating the derivative $u'(x)$ for the function $u(x)=\\exp(x)$ using three finite difference schemes: the forward difference, the backward difference, and the central difference. Let the step size be $h0$, and assume arithmetic is performed in finite precision with machine epsilon $\\epsilon_{\\mathrm{mach}}$ defined as the smallest positive number such that $1+\\epsilon_{\\mathrm{mach}}1$ in the floating-point system under rounding to nearest.\n\nStarting from foundational facts and definitions, construct a leading-order model for the total absolute error (sum of truncation and round-off errors) of each scheme as a function of $h$, based on the following scientific bases:\n- Taylor’s Theorem for smooth functions to capture truncation error in each scheme.\n- The standard floating-point rounding model that each arithmetic result incurs a relative error of order $\\epsilon_{\\mathrm{mach}}$, and subtraction of nearly equal numbers leads to an absolute error proportional to the sum of magnitudes of the subtracted quantities. Treat $h$ as small and use small-$h$ expansions when justified.\n\nDerive, for each scheme, the step size $h$ that minimizes the leading-order total error, expressed as a function of $\\epsilon_{\\mathrm{mach}}$. Your derivations must explicitly show how truncation and round-off contributions balance to produce an optimal $h$.\n\nExpress your final answer as a single row matrix using the $\\mathrm{pmatrix}$ environment, listing the optimal $h$ in the order: forward difference, backward difference, central difference. Provide the expressions symbolically in terms of $\\epsilon_{\\mathrm{mach}}$. No numerical rounding is required.",
            "solution": "The task is to derive the optimal step size $h$ that minimizes the total error when approximating the derivative of the function $u(x)=\\exp(x)$ using three finite difference schemes: forward, backward, and central difference. The total error is the sum of the truncation error and the round-off error. We will model these two error sources based on the provided scientific bases.\n\nLet $E_{\\text{total}}(h)$ be the total absolute error as a function of the step size $h$. The leading-order model for this error is the sum of the magnitudes of the leading-order truncation error and the leading-order round-off error:\n$$E_{\\text{total}}(h) \\approx |E_{\\text{trunc}}(h)| + |E_{\\text{round}}(h)|$$\nThe function is $u(x) = \\exp(x)$. A key property of this function is that $u^{(n)}(x) = \\exp(x)$ for all integers $n \\geq 0$.\n\nThe truncation error, $E_{\\text{trunc}}$, arises from approximating the true derivative with a finite difference formula. It can be quantified using Taylor's Theorem.\n\nThe round-off error, $E_{\\text{round}}$, arises from the finite precision of computer arithmetic. The problem specifies a model where the evaluation of a function $f(z)$ in floating-point arithmetic yields a value $\\tilde{f}(z)$ with a relative error on the order of the machine epsilon, $\\epsilon_{\\mathrm{mach}}$. That is, $\\tilde{f}(z) = f(z)(1+\\delta)$, where $|\\delta| \\leq \\epsilon_{\\mathrm{mach}}$. The absolute error is $|\\tilde{f}(z)-f(z)| \\leq |f(z)|\\epsilon_{\\mathrm{mach}}$. When subtracting two nearly equal quantities, such as $u(x+h)$ and $u(x)$ for small $h$, the round-off error in the numerator of the difference quotient, e.g., $\\tilde{u}(x+h)-\\tilde{u}(x)$, is dominated by the initial representation errors of the function values. The absolute error of this subtraction is bounded by the sum of the individual absolute errors: $|\\text{err}_{\\text{num}}| \\leq |u(x+h)|\\epsilon_{\\mathrm{mach}} + |u(x)|\\epsilon_{\\mathrm{mach}}$. For small $h$, this is approximately $2|u(x)|\\epsilon_{\\mathrm{mach}}$. This is consistent with the problem's statement that the error is \"proportional to the sum of magnitudes of the subtracted quantities.\" We will use this model to derive the round-off error for each scheme.\n\nWe will now analyze each scheme separately.\n\n**1. Forward Difference Scheme**\n\nThe forward difference approximation is $D_+u(x) = \\frac{u(x+h) - u(x)}{h}$.\n\n*   **Truncation Error:** We expand $u(x+h)$ using Taylor's Theorem around $x$:\n    $$u(x+h) = u(x) + h u'(x) + \\frac{h^2}{2} u''(x) + O(h^3)$$\n    Substituting this into the formula for $D_+u(x)$:\n    $$D_+u(x) = \\frac{(u(x) + h u'(x) + \\frac{h^2}{2} u''(x) + O(h^3)) - u(x)}{h} = u'(x) + \\frac{h}{2} u''(x) + O(h^2)$$\n    The leading-order truncation error is $E_{\\text{trunc, fwd}} = D_+u(x) - u'(x) \\approx \\frac{h}{2} u''(x)$. The magnitude is:\n    $$|E_{\\text{trunc, fwd}}(h)| \\approx \\frac{h}{2} |u''(x)|$$\n    For $u(x) = \\exp(x)$, we have $u''(x)=\\exp(x)$, so $|E_{\\text{trunc, fwd}}(h)| \\approx \\frac{h}{2} \\exp(x)$.\n\n*   **Round-off Error:** The round-off error in computing the numerator, $u(x+h) - u(x)$, has a magnitude bounded by $|u(x+h)|\\epsilon_{\\mathrm{mach}} + |u(x)|\\epsilon_{\\mathrm{mach}}$. For small $h$, this is approximately $2|u(x)|\\epsilon_{\\mathrm{mach}}$. This error is then divided by $h$.\n    $$|E_{\\text{round, fwd}}(h)| \\approx \\frac{2|u(x)|\\epsilon_{\\mathrm{mach}}}{h}$$\n    For $u(x) = \\exp(x)$, we have $|u(x)|=\\exp(x)$, so $|E_{\\text{round, fwd}}(h)| \\approx \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$.\n\n*   **Total Error and Minimization:** The total error is:\n    $$E_{\\text{total, fwd}}(h) \\approx \\frac{h}{2} \\exp(x) + \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$$\n    To find the step size $h$ that minimizes this error, we differentiate with respect to $h$ and set the result to zero:\n    $$\\frac{dE_{\\text{total, fwd}}}{dh} = \\frac{1}{2} \\exp(x) - \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} = 0$$\n    $$\\frac{1}{2} \\exp(x) = \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} \\implies h^2 = \\frac{2 \\cdot 2\\exp(x)\\epsilon_{\\mathrm{mach}}}{\\exp(x)} = 4\\epsilon_{\\mathrm{mach}}$$\n    The optimal step size is therefore:\n    $$h_{\\text{opt, fwd}} = \\sqrt{4\\epsilon_{\\mathrm{mach}}} = 2\\sqrt{\\epsilon_{\\mathrm{mach}}}$$\n\n**2. Backward Difference Scheme**\n\nThe backward difference approximation is $D_-u(x) = \\frac{u(x) - u(x-h)}{h}$.\n\n*   **Truncation Error:** We expand $u(x-h)$ using Taylor's Theorem:\n    $$u(x-h) = u(x) - h u'(x) + \\frac{h^2}{2} u''(x) - O(h^3)$$\n    Substituting into the formula for $D_-u(x)$:\n    $$D_-u(x) = \\frac{u(x) - (u(x) - h u'(x) + \\frac{h^2}{2} u''(x) - O(h^3))}{h} = u'(x) - \\frac{h}{2} u''(x) + O(h^2)$$\n    The leading-order truncation error is $E_{\\text{trunc, bwd}} \\approx -\\frac{h}{2} u''(x)$. The magnitude is:\n    $$|E_{\\text{trunc, bwd}}(h)| \\approx \\frac{h}{2} |u''(x)|$$\n    This is identical to the forward difference case. For $u(x) = \\exp(x)$, $|E_{\\text{trunc, bwd}}(h)| \\approx \\frac{h}{2} \\exp(x)$.\n\n*   **Round-off Error:** The analysis is a direct parallel to the forward difference case. The numerator involves subtracting two nearly equal numbers, $u(x)$ and $u(x-h)$. The round-off error has magnitude:\n    $$|E_{\\text{round, bwd}}(h)| \\approx \\frac{|u(x)| + |u(x-h)|}{h} \\epsilon_{\\mathrm{mach}} \\approx \\frac{2|u(x)|\\epsilon_{\\mathrm{mach}}}{h}$$\n    For $u(x) = \\exp(x)$, this is $\\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$.\n\n*   **Total Error and Minimization:** The total error function for the backward difference scheme is identical to that of the forward difference scheme.\n    $$E_{\\text{total, bwd}}(h) \\approx \\frac{h}{2} \\exp(x) + \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$$\n    Consequently, the optimal step size is the same:\n    $$h_{\\text{opt, bwd}} = 2\\sqrt{\\epsilon_{\\mathrm{mach}}}$$\n\n**3. Central Difference Scheme**\n\nThe central difference approximation is $D_0u(x) = \\frac{u(x+h) - u(x-h)}{2h}$.\n\n*   **Truncation Error:** We use Taylor expansions for both $u(x+h)$ and $u(x-h)$:\n    $$u(x+h) = u(x) + h u'(x) + \\frac{h^2}{2} u''(x) + \\frac{h^3}{6} u'''(x) + O(h^4)$$\n    $$u(x-h) = u(x) - h u'(x) + \\frac{h^2}{2} u''(x) - \\frac{h^3}{6} u'''(x) + O(h^4)$$\n    Subtracting the second from the first:\n    $$u(x+h) - u(x-h) = 2h u'(x) + \\frac{h^3}{3} u'''(x) + O(h^5)$$\n    Dividing by $2h$:\n    $$D_0u(x) = \\frac{u(x+h) - u(x-h)}{2h} = u'(x) + \\frac{h^2}{6} u'''(x) + O(h^4)$$\n    The leading-order truncation error is $E_{\\text{trunc, cent}} \\approx \\frac{h^2}{6} u'''(x)$. The magnitude is:\n    $$|E_{\\text{trunc, cent}}(h)| \\approx \\frac{h^2}{6} |u'''(x)|$$\n    For $u(x) = \\exp(x)$, we have $u'''(x)=\\exp(x)$, so $|E_{\\text{trunc, cent}}(h)| \\approx \\frac{h^2}{6} \\exp(x)$.\n\n*   **Round-off Error:** The numerator is $u(x+h) - u(x-h)$. The magnitude of its round-off error is approximately $|u(x+h)|\\epsilon_{\\mathrm{mach}} + |u(x-h)|\\epsilon_{\\mathrm{mach}} \\approx 2|u(x)|\\epsilon_{\\mathrm{mach}}$. This error is divided by $2h$.\n    $$|E_{\\text{round, cent}}(h)| \\approx \\frac{2|u(x)|\\epsilon_{\\mathrm{mach}}}{2h} = \\frac{|u(x)|\\epsilon_{\\mathrm{mach}}}{h}$$\n    For $u(x) = \\exp(x)$, this is $\\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$.\n\n*   **Total Error and Minimization:** The total error is the sum of the truncation and round-off error magnitudes:\n    $$E_{\\text{total, cent}}(h) \\approx \\frac{h^2}{6} \\exp(x) + \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$$\n    To find the minimum, we differentiate and set to zero:\n    $$\\frac{dE_{\\text{total, cent}}}{dh} = \\frac{2h}{6} \\exp(x) - \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} = \\frac{h}{3} \\exp(x) - \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} = 0$$\n    $$\\frac{h}{3} \\exp(x) = \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} \\implies h^3 = 3\\epsilon_{\\mathrm{mach}}$$\n    The optimal step size is:\n    $$h_{\\text{opt, cent}} = (3\\epsilon_{\\mathrm{mach}})^{\\frac{1}{3}}$$\n\nIn summary, for each scheme, we have derived the optimal step size by balancing the truncation error, which decreases with $h$, and the round-off error, which increases as $h$ decreases. The function $u(x)=\\exp(x)$ has the property that its derivatives are all equal to the function itself, which causes the dependence on $x$ to cancel out in the final expressions for the optimal $h$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2\\sqrt{\\epsilon_{\\mathrm{mach}}}  2\\sqrt{\\epsilon_{\\mathrm{mach}}}  (3\\epsilon_{\\mathrm{mach}})^{\\frac{1}{3}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A numerical scheme is not just an approximation; it is often an unintentional model of new physical processes. Through a powerful technique called modified equation analysis, we can uncover the partial differential equation that a scheme *actually* solves, including its error terms. This exercise demonstrates how the common upwind differencing scheme, when applied to an advection problem, introduces an error term that behaves exactly like physical diffusion. By quantifying this \"artificial diffusion\" and its effect on a pollutant front, you will see firsthand how a choice of discretization can profoundly alter the physical behavior of an environmental model. ",
            "id": "3882086",
            "problem": "Consider one-dimensional, constant-velocity transport of a conservative pollutant concentration field in a straight river reach, modeled by the advection partial differential equation (PDE) $ \\partial_{t} c + u\\,\\partial_{x} c = 0 $ with constant velocity $u0$. The leading edge of a pollutant pulse at time $t=0$ is idealized as a unit step front $c(x,0) = H(x)$, where $H(x)$ is the Heaviside function and $c$ is nondimensionalized to vary between $0$ (clean water) and $1$ (polluted water). The spatial domain is discretized on a uniform mesh of spacing $\\Delta x$ and the spatial derivative $ \\partial_{x} c $ is approximated using an upwind scheme appropriate for $u0$, specifically the backward difference $ \\left(c_{i}-c_{i-1}\\right)/\\Delta x $. Time is treated as continuous (method-of-lines), and the qualitative behavior of forward and central differencing is known from numerical analysis: forward/backward (upwind) differencing introduces artificial diffusion, whereas central differencing introduces leading-order dispersion.\n\nUsing the modified equation analysis for this upwind discretization, treat the scheme as a continuous PDE that augments physical advection with a leading-order artificial process. From this representation, estimate the front broadening after the pulse has advected a downstream distance $L$ by quantifying the $10$–$90$ rise distance, defined as the spatial separation between the locations where $c=0.1$ and $c=0.9$ along the moving front. Assume the only front-widening mechanism is the artificial process predicted by the modified equation (i.e., neglect physical diffusion and dispersion), and work in the limit where the leading-order term of the modified equation dominates the truncation error.\n\nGiven the parameters $u = 1\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\Delta x = 50\\,\\mathrm{m}$, and $L = 10\\,\\mathrm{km}$, compute the numerical value of the $10$–$90$ front thickness in meters. Round your answer to four significant figures and express the final thickness in meters.",
            "solution": "The user wants to solve a problem.\n\nThe problem is considered valid and the calculation process is described below.\nThe governing one-dimensional advection partial differential equation (PDE) is given by:\n$$\n\\partial_{t} c + u\\,\\partial_{x} c = 0\n$$\nwhere $c(x,t)$ is the pollutant concentration, $u  0$ is the constant advection velocity, $t$ is time, and $x$ is the spatial coordinate. The spatial domain is discretized with a uniform mesh spacing $\\Delta x$. The spatial derivative $\\partial_{x} c$ is approximated using a backward difference (upwind) scheme, appropriate for $u0$. Using the method-of-lines, we treat time as continuous, resulting in a system of ordinary differential equations for the concentration at each grid point $x_i$:\n$$\n\\frac{d c_i}{d t} + u \\frac{c_i - c_{i-1}}{\\Delta x} = 0\n$$\nTo perform the modified equation analysis, we interpret the discrete values $c_i(t)$ and $c_{i-1}(t)$ as evaluations of a continuous function $c(x,t)$ at points $x_i$ and $x_{i-1} = x_i - \\Delta x$. We expand $c_{i-1}$ in a Taylor series around $x_i$:\n$$\nc_{i-1} = c(x_i - \\Delta x, t) = c(x_i, t) - \\Delta x \\, \\partial_{x} c + \\frac{(\\Delta x)^2}{2!} \\, \\partial_{xx} c - \\frac{(\\Delta x)^3}{3!} \\, \\partial_{xxx} c + \\mathcal{O}((\\Delta x)^4)\n$$\nSubstituting this expansion into the semi-discretized equation, and replacing $c_i$ with $c$ and $\\frac{d}{dt}$ with $\\partial_t$, we obtain the PDE that the numerical scheme is actually solving:\n$$\n\\partial_{t} c + \\frac{u}{\\Delta x} \\left( c - \\left[ c - \\Delta x \\, \\partial_{x} c + \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx} c - \\frac{(\\Delta x)^3}{6} \\, \\partial_{xxx} c + \\dots \\right] \\right) = 0\n$$\nSimplifying the expression inside the parentheses gives:\n$$\n\\partial_{t} c + \\frac{u}{\\Delta x} \\left( \\Delta x \\, \\partial_{x} c - \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx} c + \\frac{(\\Delta x)^3}{6} \\, \\partial_{xxx} c - \\dots \\right) = 0\n$$\n$$\n\\partial_{t} c + u \\, \\partial_{x} c - \\frac{u \\Delta x}{2} \\, \\partial_{xx} c + \\frac{u (\\Delta x)^2}{6} \\, \\partial_{xxx} c - \\dots = 0\n$$\nThis is the modified equation. The original PDE is $\\partial_{t} c + u \\, \\partial_{x} c = 0$. The difference between the modified equation and the original PDE is the truncation error. The problem states to consider only the leading-order artificial process. The leading-order truncation error term is the one with the lowest-order derivative, which is $-\\frac{u \\Delta x}{2} \\, \\partial_{xx} c$.\nRearranging the modified equation to keep the leading-order error term gives:\n$$\n\\partial_{t} c + u \\, \\partial_{x} c = \\frac{u \\Delta x}{2} \\, \\partial_{xx} c\n$$\nThis is an advection-diffusion equation. The term on the right-hand side represents artificial diffusion introduced by the upwind scheme. The coefficient of artificial diffusion, $K_{art}$, is:\n$$\nK_{art} = \\frac{u \\Delta x}{2}\n$$\nThe problem is to find the evolution of an initial step front, $c(x,0) = H(x)$, governed by this advection-diffusion equation. The analytical solution for this initial value problem is given in terms of the complementary error function, $\\mathrm{erfc}$, or the error function, $\\mathrm{erf}$:\n$$\nc(x, t) = \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x - ut}{\\sqrt{4 K_{art} t}}\\right) \\right]\n$$\nThe front broadening is defined as the $10$–$90$ rise distance, which is the spatial separation $\\delta = x_{0.9} - x_{0.1}$ between the points where the concentration is $c=0.9$ and $c=0.1$.\nFor $c = 0.9$:\n$$\n0.9 = \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}}\\right) \\right]\n$$\n$$\n1.8 = 1 + \\mathrm{erf}\\left(\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}}\\right) \\implies \\mathrm{erf}\\left(\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}}\\right) = 0.8\n$$\nFor $c = 0.1$:\n$$\n0.1 = \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}}\\right) \\right]\n$$\n$$\n0.2 = 1 + \\mathrm{erf}\\left(\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}}\\right) \\implies \\mathrm{erf}\\left(\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}}\\right) = -0.8\n$$\nLet $\\beta = \\mathrm{erf}^{-1}(0.8)$. From the properties of the error function, $\\mathrm{erf}(-z) = -\\mathrm{erf}(z)$, so $\\mathrm{erf}^{-1}(-0.8) = -\\beta$. We can now write expressions for $x_{0.9}$ and $x_{0.1}$:\n$$\n\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}} = \\beta \\implies x_{0.9} = ut + \\beta \\sqrt{4 K_{art} t}\n$$\n$$\n\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}} = -\\beta \\implies x_{0.1} = ut - \\beta \\sqrt{4 K_{art} t}\n$$\nThe rise distance $\\delta$ is the difference between these two positions:\n$$\n\\delta = x_{0.9} - x_{0.1} = \\left( ut + \\beta \\sqrt{4 K_{art} t} \\right) - \\left( ut - \\beta \\sqrt{4 K_{art} t} \\right) = 2 \\beta \\sqrt{4 K_{art} t} = 4 \\beta \\sqrt{K_{art} t}\n$$\nThe front has advected a distance $L$ at velocity $u$, so the time elapsed is $t = L/u$. Substituting this and the expression for $K_{art}$:\n$$\n\\delta = 4 \\beta \\sqrt{\\left(\\frac{u \\Delta x}{2}\\right) \\left(\\frac{L}{u}\\right)} = 4 \\beta \\sqrt{\\frac{\\Delta x L}{2}}\n$$\nThe problem provides the following numerical values:\n$u = 1\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ (this value is not needed for the final calculation of $\\delta$, as it cancels out)\n$\\Delta x = 50\\,\\mathrm{m}$\n$L = 10\\,\\mathrm{km} = 10 \\times 10^3\\,\\mathrm{m} = 10000\\,\\mathrm{m}$\n\nThe value of $\\beta=\\mathrm{erf}^{-1}(0.8)$ is approximately $0.9061938$.\nNow, we can compute the numerical value of $\\delta$:\n$$\n\\delta = 4 \\times 0.9061938 \\times \\sqrt{\\frac{(50\\,\\mathrm{m}) \\times (10000\\,\\mathrm{m})}{2}}\n$$\n$$\n\\delta = 4 \\times 0.9061938 \\times \\sqrt{\\frac{500000}{2}\\,\\mathrm{m}^2} = 4 \\times 0.9061938 \\times \\sqrt{250000}\\,\\mathrm{m}\n$$\n$$\n\\delta = 4 \\times 0.9061938 \\times 500\\,\\mathrm{m} = 2000 \\times 0.9061938\\,\\mathrm{m} = 1812.3876\\,\\mathrm{m}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\delta \\approx 1812\\,\\mathrm{m}\n$$",
            "answer": "$$\n\\boxed{1812}\n$$"
        },
        {
            "introduction": "Applying numerical methods to real-world earth systems requires moving from simple Cartesian grids to complex geometries like the sphere. This transition introduces new challenges, including grid metrics and coordinate singularities that can dramatically impact numerical accuracy. This practice challenges you to compute the horizontal pressure gradient on a latitude-longitude grid, a core task in atmospheric modeling. You will confront the famous \"pole problem,\" where the convergence of meridians causes the metric term $1/(R \\cos(\\phi))$ to amplify numerical errors, providing a vivid lesson in the interplay between geometry, physics, and numerical stability in geophysical models. ",
            "id": "3882093",
            "problem": "Consider a spherical Earth of radius $R$ with a latitude–longitude grid where latitude $\\phi$ and longitude $\\lambda$ are angular coordinates. The local horizontal distances along the eastward and northward directions are, by spherical geometry, $R \\cos(\\phi) \\,\\mathrm{d}\\lambda$ and $R \\,\\mathrm{d}\\phi$, respectively. The horizontal pressure gradient vector has components equal to the rate of change of pressure per unit physical distance along these two locally orthogonal directions.\n\nLet the pressure field be analytically defined by\n$$\nP(\\phi,\\lambda) = P_0 + A \\cos(\\lambda) + B \\sin(\\phi) + C \\cos(\\phi)\\cos(2\\lambda),\n$$\nwhere $P_0$ is a baseline pressure in Pascals (Pa), and $A$, $B$, $C$ are amplitudes in Pascals (Pa). The physical eastward component of the horizontal pressure gradient is the longitudinal partial derivative scaled by the local metric, and the physical northward component is the latitudinal partial derivative scaled by the corresponding local metric. All outputs related to the gradient must be expressed in Pascals per meter (Pa/m).\n\nYou must implement central differencing to approximate the longitudinal partial derivative of $P$ on a latitude–longitude grid with periodic boundary conditions in longitude and fixed boundary conditions in latitude. The central differencing must be applied along $\\lambda$ to approximate $\\partial P/\\partial \\lambda$, and the physical eastward pressure gradient must be computed by scaling with the local metric factor. The latitude grid should include the poleward-most row in the Northern Hemisphere, and the error in the eastward component near that row must be quantified. The angle unit for $\\phi$ and $\\lambda$ is degrees for grid specification. Your computational implementation must convert the angular spacings to radians for metric scaling and differencing.\n\nAs a fundamental base, use the following definitions:\n\n1. The physical eastward component of the horizontal pressure gradient is\n$$\nG_{\\lambda}(\\phi,\\lambda) = \\frac{1}{R \\cos(\\phi)} \\frac{\\partial P}{\\partial \\lambda}(\\phi,\\lambda),\n$$\nand the physical northward component is\n$$\nG_{\\phi}(\\phi,\\lambda) = \\frac{1}{R} \\frac{\\partial P}{\\partial \\phi}(\\phi,\\lambda).\n$$\n\n2. The central differencing approximation for the longitudinal derivative at grid point $(\\phi_i,\\lambda_j)$ with uniform spacing $\\Delta \\lambda$ is based on Taylor expansion:\n$$\n\\frac{\\partial P}{\\partial \\lambda}(\\phi_i,\\lambda_j) \\approx \\frac{P(\\phi_i,\\lambda_{j+1}) - P(\\phi_i,\\lambda_{j-1})}{2 \\Delta \\lambda},\n$$\nwith a truncation error whose leading term is proportional to the third longitudinal derivative:\n$$\n\\text{error} \\approx \\frac{\\Delta \\lambda^2}{6} \\frac{\\partial^3 P}{\\partial \\lambda^3}(\\phi_i,\\lambda_j).\n$$\nWhen scaled by the metric to produce the physical eastward gradient, the leading error becomes\n$$\nE_{\\lambda}(\\phi_i,\\lambda_j) \\approx \\frac{1}{R \\cos(\\phi_i)} \\cdot \\frac{\\Delta \\lambda^2}{6} \\cdot \\frac{\\partial^3 P}{\\partial \\lambda^3}(\\phi_i,\\lambda_j).\n$$\n\nYour program must:\n- Construct the pressure field $P(\\phi,\\lambda)$ on each test grid.\n- Compute the numerical approximation of $G_{\\lambda}$ on the poleward-most latitude row using central differencing in longitude with periodic boundary conditions.\n- Compute the exact $G_{\\lambda}$ analytically from $\\partial P/\\partial \\lambda$ on the same row.\n- Compute the observed maximum absolute error on that row:\n$$\n\\max_{\\lambda} \\left| G_{\\lambda}^{\\text{num}} - G_{\\lambda}^{\\text{exact}} \\right|,\n$$\nexpressed in Pascals per meter (Pa/m).\n- Compute the estimated maximum leading-order truncation error on that row using the formula for $E_{\\lambda}$, by evaluating the exact third longitudinal derivative $\\partial^3 P/\\partial \\lambda^3$ and taking the maximum absolute value over longitude, also expressed in Pascals per meter (Pa/m).\n\nUse the following fixed parameter values:\n- $R = 6{,}371{,}000$ meters.\n- $P_0 = 100{,}000$ Pascals.\n- $A = 10{,}000$ Pascals.\n- $B = 5{,}000$ Pascals.\n- $C = 2{,}000$ Pascals.\n\nAngle units for grid specification are degrees; your numerical method must convert longitude spacing $\\Delta \\lambda$ from degrees to radians for differencing and metric scaling. Pressure gradients must be reported in Pascals per meter (Pa/m).\n\nTest suite:\n- Case $1$: latitude extent from $-\\!60^\\circ$ to $+\\!60^\\circ$ with latitude spacing $\\Delta \\phi = 1^\\circ$; longitude spacing $\\Delta \\lambda = 1^\\circ$ with longitudes covering $[0^\\circ, 360^\\circ)$ periodically.\n- Case $2$: latitude extent from $-\\!85^\\circ$ to $+\\!85^\\circ$ with latitude spacing $\\Delta \\phi = 1^\\circ$; longitude spacing $\\Delta \\lambda = 1^\\circ$ with longitudes covering $[0^\\circ, 360^\\circ)$ periodically.\n- Case $3$: latitude extent from $-\\!89^\\circ$ to $+\\!89^\\circ$ with latitude spacing $\\Delta \\phi = 1^\\circ$; longitude spacing $\\Delta \\lambda = 1^\\circ$ with longitudes covering $[0^\\circ, 360^\\circ)$ periodically.\n- Case $4$: latitude extent from $-\\!89.5^\\circ$ to $+\\!89.5^\\circ$ with latitude spacing $\\Delta \\phi = 0.5^\\circ$; longitude spacing $\\Delta \\lambda = 1^\\circ$ with longitudes covering $[0^\\circ, 360^\\circ)$ periodically.\n\nFor each case, compute two floats:\n- the observed maximum absolute error on the poleward-most row in Pascals per meter (Pa/m), and\n- the estimated maximum leading-order truncation error on the same row in Pascals per meter (Pa/m).\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets and with no spaces, where each case is represented by a pair in the format $[e_{\\text{obs}},e_{\\text{est}}]$. For the four test cases, the output format must be\n$$\n\\left[\\,[e_{\\text{obs},1},e_{\\text{est},1}],[e_{\\text{obs},2},e_{\\text{est},2}],[e_{\\text{obs},3},e_{\\text{est},3}],[e_{\\text{obs},4},e_{\\text{est},4}]\\,\\right].\n$$",
            "solution": "The user-provided problem is valid. It is scientifically grounded in the principles of geophysical fluid dynamics and numerical analysis, well-posed with all necessary parameters and equations, and objective in its formulation. The task is to compute the error of a central differencing scheme for a pressure gradient on a spherical grid, which is a standard and relevant problem in earth system modeling. The problem is free of contradictions, ambiguities, and factual unsoundness.\n\nThe solution proceeds by first deriving the analytical expressions for the quantities of interest, then outlining the numerical procedure to approximate them and compute the errors.\n\nThe pressure field is given by the analytical function:\n$$\nP(\\phi,\\lambda) = P_0 + A \\cos(\\lambda) + B \\sin(\\phi) + C \\cos(\\phi)\\cos(2\\lambda)\n$$\nwhere $\\phi$ is latitude and $\\lambda$ is longitude. For all calculations, these angles must be in radians. The constants are provided as $R = 6,371,000 \\, \\text{m}$, $P_0 = 100,000 \\, \\text{Pa}$, $A = 10,000 \\, \\text{Pa}$, $B = 5,000 \\, \\text{Pa}$, and $C = 2,000 \\, \\text{Pa}$.\n\nThe physical eastward component of the pressure gradient is defined as:\n$$\nG_{\\lambda}(\\phi,\\lambda) = \\frac{1}{R \\cos(\\phi)} \\frac{\\partial P}{\\partial \\lambda}(\\phi,\\lambda)\n$$\n\nTo find the exact expression for $G_{\\lambda}$, we first compute the partial derivative of $P$ with respect to $\\lambda$:\n$$\n\\frac{\\partial P}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left( P_0 + A \\cos(\\lambda) + B \\sin(\\phi) + C \\cos(\\phi)\\cos(2\\lambda) \\right) = -A \\sin(\\lambda) - 2C \\cos(\\phi) \\sin(2\\lambda)\n$$\nSubstituting this into the definition of $G_{\\lambda}$ yields the exact eastward gradient:\n$$\nG_{\\lambda}^{\\text{exact}}(\\phi, \\lambda) = \\frac{1}{R \\cos(\\phi)} \\left[ -A \\sin(\\lambda) - 2C \\cos(\\phi) \\sin(2\\lambda) \\right] = -\\frac{A \\sin(\\lambda)}{R \\cos(\\phi)} - \\frac{2C \\sin(2\\lambda)}{R}\n$$\n\nThe numerical approximation of the gradient is based on the second-order central differencing scheme for the partial derivative:\n$$\n\\frac{\\partial P}{\\partial \\lambda}\\bigg|_{(\\phi_i, \\lambda_j)} \\approx \\frac{P(\\phi_i, \\lambda_{j+1}) - P(\\phi_i, \\lambda_{j-1})}{2 \\Delta \\lambda}\n$$\nwhere $\\lambda_{j+1} = \\lambda_j + \\Delta \\lambda$ and $\\lambda_{j-1} = \\lambda_j - \\Delta \\lambda$. The angular spacing $\\Delta \\lambda$ must be in radians. The numerical approximation for the eastward gradient, $G_{\\lambda}^{\\text{num}}$, is then:\n$$\nG_{\\lambda}^{\\text{num}}(\\phi_i, \\lambda_j) = \\frac{1}{R \\cos(\\phi_i)} \\left( \\frac{P(\\phi_i, \\lambda_{j+1}) - P(\\phi_i, \\lambda_{j-1})}{2 \\Delta \\lambda} \\right)\n$$\nThe problem requires this to be computed on a full circle of longitude with periodic boundary conditions. This means for a grid of $N$ points indexed $j=0, \\dots, N-1$, the neighbors of point $j=0$ are $j=1$ and $j=N-1$, and the neighbors of $j=N-1$ are $j=0$ and $j=N-2$.\n\nThe primary goal is to compare the numerical approximation to the exact solution. The observed error is defined as the maximum absolute difference on the poleward-most latitude row of the grid, $\\phi_{\\text{pole}}$:\n$$\ne_{\\text{obs}} = \\max_{\\lambda_j} \\left| G_{\\lambda}^{\\text{num}}(\\phi_{\\text{pole}}, \\lambda_j) - G_{\\lambda}^{\\text{exact}}(\\phi_{\\text{pole}}, \\lambda_j) \\right|\n$$\n\nThe second goal is to estimate this error using the leading-order term of the Taylor series truncation error. The leading error of the central difference approximation for the physical gradient is:\n$$\nE_{\\lambda}(\\phi,\\lambda) \\approx \\frac{1}{R \\cos(\\phi)} \\cdot \\frac{\\Delta \\lambda^2}{6} \\cdot \\frac{\\partial^3 P}{\\partial \\lambda^3}(\\phi,\\lambda)\n$$\nTo evaluate this, we need the third partial derivative of $P$ with respect to $\\lambda$:\n$$\n\\frac{\\partial^2 P}{\\partial \\lambda^2} = \\frac{\\partial}{\\partial \\lambda} \\left( -A \\sin(\\lambda) - 2C \\cos(\\phi) \\sin(2\\lambda) \\right) = -A \\cos(\\lambda) - 4C \\cos(\\phi) \\cos(2\\lambda)\n$$\n$$\n\\frac{\\partial^3 P}{\\partial \\lambda^3} = \\frac{\\partial}{\\partial \\lambda} \\left( -A \\cos(\\lambda) - 4C \\cos(\\phi) \\cos(2\\lambda) \\right) = A \\sin(\\lambda) + 8C \\cos(\\phi) \\sin(2\\lambda)\n$$\nSubstituting this into the error formula gives:\n$$\nE_{\\lambda}(\\phi, \\lambda) \\approx \\frac{\\Delta \\lambda^2}{6 R \\cos(\\phi)} \\left[ A \\sin(\\lambda) + 8C \\cos(\\phi) \\sin(2\\lambda) \\right] = \\frac{\\Delta \\lambda^2}{6} \\left[ \\frac{A \\sin(\\lambda)}{R \\cos(\\phi)} + \\frac{8C \\sin(2\\lambda)}{R} \\right]\n$$\nThe estimated maximum error is the maximum absolute value of this expression on the poleward-most latitude row:\n$$\ne_{\\text{est}} = \\max_{\\lambda_j} \\left| E_{\\lambda}(\\phi_{\\text{pole}}, \\lambda_j) \\right|\n$$\n\nThe computational procedure for each test case is as follows:\n1.  Define the grid parameters: poleward latitude $\\phi_{\\text{pole}}$ and longitude spacing $\\Delta \\lambda_{\\text{deg}}$.\n2.  Convert angles to radians: $\\phi_{\\text{pole, rad}} = \\phi_{\\text{pole}} \\cdot \\pi/180$ and $\\Delta \\lambda_{\\text{rad}} = \\Delta \\lambda_{\\text{deg}} \\cdot \\pi/180$.\n3.  Create the longitude grid $\\lambda_j$ for $j=0, \\dots, N-1$, where $N = 360 / \\Delta \\lambda_{\\text{deg}}$.\n4.  At the latitude $\\phi_{\\text{pole, rad}}$, calculate the pressure $P(\\phi_{\\text{pole, rad}}, \\lambda_j)$ for all $\\lambda_j$ on the grid.\n5.  Use periodic indexing (e.g., using `numpy.roll`) to get $P(\\phi_{\\text{pole, rad}}, \\lambda_{j+1})$ and $P(\\phi_{\\text{pole, rad}}, \\lambda_{j-1})$ for each point.\n6.  Compute $G_{\\lambda}^{\\text{num}}$ for all $\\lambda_j$ using the central difference formula.\n7.  Compute $G_{\\lambda}^{\\text{exact}}$ for all $\\lambda_j$ using the analytical formula.\n8.  Compute the observed maximum absolute error, $e_{\\text{obs}}$.\n9.  Compute the estimated leading-order error $E_{\\lambda}$ for all $\\lambda_j$ using its analytical formula.\n10. Compute the estimated maximum absolute error, $e_{\\text{est}}$.\n11. Store the pair $[e_{\\text{obs}}, e_{\\text{est}}]$ for the test case.\nThis procedure is repeated for all four test cases, and the results are aggregated into the final specified format. As latitude $\\phi$ approaches $\\pm 90^\\circ$, the term $\\cos(\\phi)$ approaches $0$, causing the $G_{\\lambda}$ gradient and its associated errors to increase significantly. This behavior is a key aspect of the \"pole problem\" in global climate models and is expected to be reflected in the results.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes observed and estimated numerical errors for the eastward pressure gradient\n    on a spherical grid for a series of test cases.\n    \"\"\"\n\n    # --- Fixed Parameters ---\n    R = 6371000.0  # Earth radius in meters\n    P0 = 100000.0  # Baseline pressure in Pascals\n    A = 10000.0    # Amplitude in Pascals\n    B = 5000.0     # Amplitude in Pascals\n    C = 2000.0     # Amplitude in Pascals\n\n    # --- Test Cases ---\n    # Each case is (poleward_latitude_deg, longitude_spacing_deg)\n    # The latitude extent and dphi define the poleward row.\n    test_cases = [\n        (60.0, 1.0),   # Case 1: phi_max = 60 deg, d_lambda = 1 deg\n        (85.0, 1.0),   # Case 2: phi_max = 85 deg, d_lambda = 1 deg\n        (89.0, 1.0),   # Case 3: phi_max = 89 deg, d_lambda = 1 deg\n        (89.5, 1.0),   # Case 4: phi_max = 89.5 deg, d_lambda = 1 deg\n    ]\n\n    # --- Analytical Functions ---\n    def pressure(phi_rad, lam_rad, p0, a, b, c):\n        \"\"\"Analytical pressure field P(phi, lambda).\"\"\"\n        return p0 + a * np.cos(lam_rad) + b * np.sin(phi_rad) + c * np.cos(phi_rad) * np.cos(2 * lam_rad)\n\n    def exact_eastward_gradient(phi_rad, lam_rad, r, a, c):\n        \"\"\"Analytical eastward pressure gradient G_lambda(phi, lambda).\"\"\"\n        # G_lambda = (1 / (R * cos(phi))) * dP/dlambda\n        # dP/dlambda = -A*sin(lambda) - 2*C*cos(phi)*sin(2*lambda)\n        term1 = -a * np.sin(lam_rad) / (r * np.cos(phi_rad))\n        term2 = -2 * c * np.sin(2 * lam_rad) / r\n        return term1 + term2\n\n    def estimated_leading_error(phi_rad, lam_rad, d_lam_rad, r, a, c):\n        \"\"\"Analytical leading-order truncation error E_lambda(phi, lambda).\"\"\"\n        # E_lambda = (d_lambda^2 / 6) * (1 / (R * cos(phi))) * d^3P/dlambda^3\n        # d^3P/dlambda^3 = A*sin(lambda) + 8*C*cos(phi)*sin(2*lambda)\n        d3p_dlam3_term = a * np.sin(lam_rad) + 8 * c * np.cos(phi_rad) * np.sin(2 * lam_rad)\n        error = (d_lam_rad**2 / 6.0) * (1.0 / (r * np.cos(phi_rad))) * d3p_dlam3_term\n        return error\n\n    results = []\n\n    for phi_pole_deg, d_lambda_deg in test_cases:\n        # --- Grid Setup ---\n        # Convert angles to radians for calculation\n        phi_pole_rad = np.radians(phi_pole_deg)\n        d_lambda_rad = np.radians(d_lambda_deg)\n\n        # Create longitude grid [0, 360)\n        n_lambda = int(360.0 / d_lambda_deg)\n        lambda_grid_deg = np.arange(0, 360.0, d_lambda_deg)\n        lambda_grid_rad = np.radians(lambda_grid_deg)\n\n        # --- Numerical Calculation ---\n        # 1. Evaluate pressure P on the latitude circle\n        p_values = pressure(phi_pole_rad, lambda_grid_rad, P0, A, B, C)\n\n        # 2. Get values at j+1 and j-1 using periodic boundaries\n        p_jp1 = np.roll(p_values, -1)\n        p_jm1 = np.roll(p_values, 1)\n\n        # 3. Compute numerical derivative dP/dlambda\n        dp_dlambda_num = (p_jp1 - p_jm1) / (2.0 * d_lambda_rad)\n\n        # 4. Compute numerical gradient G_lambda^num\n        g_lambda_num = dp_dlambda_num / (R * np.cos(phi_pole_rad))\n\n        # --- Error Calculation ---\n        # 1. Compute exact gradient G_lambda^exact\n        g_lambda_exact = exact_eastward_gradient(phi_pole_rad, lambda_grid_rad, R, A, C)\n\n        # 2. Compute observed maximum absolute error\n        observed_error = np.max(np.abs(g_lambda_num - g_lambda_exact))\n\n        # 3. Compute estimated maximum leading-order error\n        est_error_values = estimated_leading_error(phi_pole_rad, lambda_grid_rad, d_lambda_rad, R, A, C)\n        estimated_error = np.max(np.abs(est_error_values))\n\n        results.append((observed_error, estimated_error))\n\n    # --- Final Output Formatting ---\n    # Format: [[e_obs,1,e_est,1],[e_obs,2,e_est,2],...] with no spaces\n    output_str = \",\".join([f\"[{o},{e}]\" for o, e in results])\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}