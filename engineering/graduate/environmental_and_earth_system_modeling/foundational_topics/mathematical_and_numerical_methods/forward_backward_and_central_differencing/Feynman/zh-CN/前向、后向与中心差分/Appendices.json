{
    "hands_on_practices": [
        {
            "introduction": "在数值计算中，我们总是面临着两种误差来源的权衡：由数学近似产生的截断误差和由有限精度算术产生的舍入误差。当步长 $h$ 减小时，截断误差减小，但舍入误差却会因为对两个相近的数进行相减而增大。本练习将引导你通过理论分析，推导出最小化总误差的最优步长，这是在任何实际数值实现中都至关重要的一步 。",
            "id": "3124976",
            "problem": "考虑使用三种有限差分格式：前向差分、后向差分和中心差分，来近似函数 $u(x)=\\exp(x)$ 的导数 $u'(x)$。设步长为 $h0$，并假设运算在有限精度下进行，机器ε $\\epsilon_{\\mathrm{mach}}$ 定义为在就近舍入的浮点系统中，满足 $1+\\epsilon_{\\mathrm{mach}}1$ 的最小正数。\n\n从基本事实和定义出发，基于以下科学依据，为每种格式构建总绝对误差（截断误差与舍入误差之和）关于 $h$ 的主阶模型：\n- 使用光滑函数的泰勒定理来捕捉每种格式的截断误差。\n- 标准的浮点舍入模型，即每次算术运算结果会产生一个量级为 $\\epsilon_{\\mathrm{mach}}$ 的相对误差，并且两个相近数的相减会导致一个与被减数和减数的绝对值之和成正比的绝对误差。将 $h$ 视为小量，并在合理的情况下使用关于 $h$ 的小量展开。\n\n对于每种格式，推导出最小化主阶总误差的步长 $h$，并表示为 $\\epsilon_{\\mathrm{mach}}$ 的函数。您的推导过程必须明确展示截断误差和舍入误差的贡献如何平衡以产生最优的 $h$。\n\n使用 $\\mathrm{pmatrix}$ 环境将您的最终答案表示为单行矩阵，按前向差分、后向差分、中心差分的顺序列出最优的 $h$。以 $\\epsilon_{\\mathrm{mach}}$ 的符号形式提供表达式。无需进行数值舍入。",
            "solution": "本任务是推导在使用前向、后向和中心差分这三种有限差分格式来近似函数 $u(x)=\\exp(x)$ 的导数时，能够使总误差最小化的最优步长 $h$。总误差是截断误差和舍入误差之和。我们将根据所提供的科学依据对这两个误差来源进行建模。\n\n设 $E_{\\text{total}}(h)$ 是作为步长 $h$ 的函数的总绝对误差。该误差的主阶模型是主阶截断误差和主阶舍入误差的绝对值之和：\n$$E_{\\text{total}}(h) \\approx |E_{\\text{trunc}}(h)| + |E_{\\text{round}}(h)|$$\n函数为 $u(x) = \\exp(x)$。该函数的一个关键性质是，对于所有整数 $n \\geq 0$，都有 $u^{(n)}(x) = \\exp(x)$。\n\n截断误差 $E_{\\text{trunc}}$ 是由于用有限差分公式近似真实导数而产生的。它可以用泰勒定理来量化。\n\n舍入误差 $E_{\\text{round}}$ 源于计算机算术的有限精度。问题指定了一个模型，其中在浮点算术中计算函数 $f(z)$ 会得到一个值 $\\tilde{f}(z)$，其相对误差量级为机器ε $\\epsilon_{\\mathrm{mach}}$。即 $\\tilde{f}(z) = f(z)(1+\\delta)$，其中 $|\\delta| \\leq \\epsilon_{\\mathrm{mach}}$。绝对误差为 $|\\tilde{f}(z)-f(z)| \\leq |f(z)|\\epsilon_{\\mathrm{mach}}$。当减去两个相近的量，例如对于小 $h$ 时的 $u(x+h)$ 和 $u(x)$，差商分子中的舍入误差，例如 $\\tilde{u}(x+h)-\\tilde{u}(x)$，主要由函数值的初始表示误差决定。该减法运算的绝对误差的界是各个绝对误差之和：$|\\text{err}_{\\text{num}}| \\leq |u(x+h)|\\epsilon_{\\mathrm{mach}} + |u(x)|\\epsilon_{\\mathrm{mach}}$。对于小 $h$，这大约是 $2|u(x)|\\epsilon_{\\mathrm{mach}}$。这与问题陈述中“误差与被减量和减量的绝对值之和成正比”的说法一致。我们将使用此模型来推导每种格式的舍入误差。\n\n我们现在将分别分析每种格式。\n\n**1. 前向差分格式**\n\n前向差分近似为 $D_+u(x) = \\frac{u(x+h) - u(x)}{h}$。\n\n*   **截断误差：** 我们使用泰勒定理在 $x$ 点展开 $u(x+h)$：\n    $$u(x+h) = u(x) + h u'(x) + \\frac{h^2}{2} u''(x) + O(h^3)$$\n    将此代入 $D_+u(x)$ 的公式中：\n    $$D_+u(x) = \\frac{(u(x) + h u'(x) + \\frac{h^2}{2} u''(x) + O(h^3)) - u(x)}{h} = u'(x) + \\frac{h}{2} u''(x) + O(h^2)$$\n    主阶截断误差为 $E_{\\text{trunc, fwd}} = D_+u(x) - u'(x) \\approx \\frac{h}{2} u''(x)$。其绝对值为：\n    $$|E_{\\text{trunc, fwd}}(h)| \\approx \\frac{h}{2} |u''(x)|$$\n    对于 $u(x) = \\exp(x)$，我们有 $u''(x)=\\exp(x)$，因此 $|E_{\\text{trunc, fwd}}(h)| \\approx \\frac{h}{2} \\exp(x)$。\n\n*   **舍入误差：** 计算分子 $u(x+h) - u(x)$ 时的舍入误差，其绝对值的界为 $|u(x+h)|\\epsilon_{\\mathrm{mach}} + |u(x)|\\epsilon_{\\mathrm{mach}}$。对于小 $h$，这大约是 $2|u(x)|\\epsilon_{\\mathrm{mach}}$。然后将此误差除以 $h$。\n    $$|E_{\\text{round, fwd}}(h)| \\approx \\frac{2|u(x)|\\epsilon_{\\mathrm{mach}}}{h}$$\n    对于 $u(x) = \\exp(x)$，我们有 $|u(x)|=\\exp(x)$，因此 $|E_{\\text{round, fwd}}(h)| \\approx \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$。\n\n*   **总误差与最小化：** 总误差为：\n    $$E_{\\text{total, fwd}}(h) \\approx \\frac{h}{2} \\exp(x) + \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$$\n    为了找到使该误差最小化的步长 $h$，我们对 $h$ 求导并令其结果为零：\n    $$\\frac{dE_{\\text{total, fwd}}}{dh} = \\frac{1}{2} \\exp(x) - \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} = 0$$\n    $$\\frac{1}{2} \\exp(x) = \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} \\implies h^2 = \\frac{2 \\cdot 2\\exp(x)\\epsilon_{\\mathrm{mach}}}{\\exp(x)} = 4\\epsilon_{\\mathrm{mach}}$$\n    因此，最优步长为：\n    $$h_{\\text{opt, fwd}} = \\sqrt{4\\epsilon_{\\mathrm{mach}}} = 2\\sqrt{\\epsilon_{\\mathrm{mach}}}$$\n\n**2. 后向差分格式**\n\n后向差分近似为 $D_-u(x) = \\frac{u(x) - u(x-h)}{h}$。\n\n*   **截断误差：** 我们使用泰勒定理展开 $u(x-h)$：\n    $$u(x-h) = u(x) - h u'(x) + \\frac{h^2}{2} u''(x) - O(h^3)$$\n    代入 $D_-u(x)$ 的公式中：\n    $$D_-u(x) = \\frac{u(x) - (u(x) - h u'(x) + \\frac{h^2}{2} u''(x) - O(h^3))}{h} = u'(x) - \\frac{h}{2} u''(x) + O(h^2)$$\n    主阶截断误差为 $E_{\\text{trunc, bwd}} \\approx -\\frac{h}{2} u''(x)$。其绝对值为：\n    $$|E_{\\text{trunc, bwd}}(h)| \\approx \\frac{h}{2} |u''(x)|$$\n    这与前向差分的情况相同。对于 $u(x) = \\exp(x)$，有 $|E_{\\text{trunc, bwd}}(h)| \\approx \\frac{h}{2} \\exp(x)$。\n\n*   **舍入误差：** 该分析与前向差分的情况完全类似。分子涉及两个相近数 $u(x)$ 和 $u(x-h)$ 的相减。舍入误差的绝对值为：\n    $$|E_{\\text{round, bwd}}(h)| \\approx \\frac{|u(x)| + |u(x-h)|}{h} \\epsilon_{\\mathrm{mach}} \\approx \\frac{2|u(x)|\\epsilon_{\\mathrm{mach}}}{h}$$\n    对于 $u(x) = \\exp(x)$，该值为 $\\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$。\n\n*   **总误差与最小化：** 后向差分格式的总误差函数与前向差分格式的相同。\n    $$E_{\\text{total, bwd}}(h) \\approx \\frac{h}{2} \\exp(x) + \\frac{2\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$$\n    因此，最优步长是相同的：\n    $$h_{\\text{opt, bwd}} = 2\\sqrt{\\epsilon_{\\mathrm{mach}}}$$\n\n**3. 中心差分格式**\n\n中心差分近似为 $D_0u(x) = \\frac{u(x+h) - u(x-h)}{2h}$。\n\n*   **截断误差：** 我们对 $u(x+h)$ 和 $u(x-h)$ 使用泰勒展开：\n    $$u(x+h) = u(x) + h u'(x) + \\frac{h^2}{2} u''(x) + \\frac{h^3}{6} u'''(x) + O(h^4)$$\n    $$u(x-h) = u(x) - h u'(x) + \\frac{h^2}{2} u''(x) - \\frac{h^3}{6} u'''(x) + O(h^4)$$\n    用第一个式子减去第二个式子：\n    $$u(x+h) - u(x-h) = 2h u'(x) + \\frac{h^3}{3} u'''(x) + O(h^5)$$\n    除以 $2h$：\n    $$D_0u(x) = \\frac{u(x+h) - u(x-h)}{2h} = u'(x) + \\frac{h^2}{6} u'''(x) + O(h^4)$$\n    主阶截断误差为 $E_{\\text{trunc, cent}} \\approx \\frac{h^2}{6} u'''(x)$。其绝对值为：\n    $$|E_{\\text{trunc, cent}}(h)| \\approx \\frac{h^2}{6} |u'''(x)|$$\n    对于 $u(x) = \\exp(x)$，我们有 $u'''(x)=\\exp(x)$，因此 $|E_{\\text{trunc, cent}}(h)| \\approx \\frac{h^2}{6} \\exp(x)$。\n\n*   **舍入误差：** 分子是 $u(x+h) - u(x-h)$。其舍入误差的绝对值约为 $|u(x+h)|\\epsilon_{\\mathrm{mach}} + |u(x-h)|\\epsilon_{\\mathrm{mach}} \\approx 2|u(x)|\\epsilon_{\\mathrm{mach}}$。然后将此误差除以 $2h$。\n    $$|E_{\\text{round, cent}}(h)| \\approx \\frac{2|u(x)|\\epsilon_{\\mathrm{mach}}}{2h} = \\frac{|u(x)|\\epsilon_{\\mathrm{mach}}}{h}$$\n    对于 $u(x) = \\exp(x)$，该值为 $\\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$。\n\n*   **总误差与最小化：** 总误差是截断误差和舍入误差的绝对值之和：\n    $$E_{\\text{total, cent}}(h) \\approx \\frac{h^2}{6} \\exp(x) + \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h}$$\n    为了求最小值，我们求导并令其为零：\n    $$\\frac{dE_{\\text{total, cent}}}{dh} = \\frac{2h}{6} \\exp(x) - \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} = \\frac{h}{3} \\exp(x) - \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} = 0$$\n    $$\\frac{h}{3} \\exp(x) = \\frac{\\exp(x)\\epsilon_{\\mathrm{mach}}}{h^2} \\implies h^3 = 3\\epsilon_{\\mathrm{mach}}$$\n    最优步长为：\n    $$h_{\\text{opt, cent}} = (3\\epsilon_{\\mathrm{mach}})^{\\frac{1}{3}}$$\n\n总结来说，对于每种格式，我们通过平衡截断误差（随 $h$ 减小而减小）和舍入误差（随 $h$ 减小而增大），推导出了最优步长。函数 $u(x)=\\exp(x)$ 的性质是其各阶导数都等于函数本身，这导致了在最优 $h$ 的最终表达式中，对 $x$ 的依赖性被消除了。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2\\sqrt{\\epsilon_{\\mathrm{mach}}}  2\\sqrt{\\epsilon_{\\mathrm{mach}}}  (3\\epsilon_{\\mathrm{mach}})^{\\frac{1}{3}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "数值格式不仅是对偏微分方程的近似，它本身也可能引入新的、“人为”的物理效应。本练习将从抽象的误差分析转向其在物理世界中的具体后果，通过对平流方程的迎风格式进行修正方程分析。你将发现，该格式的主导误差项在形式上与物理扩散项完全相同，这一现象被称为“人工扩散”或“数值粘性”，是理解和评估环境流动模型行为的关键 。",
            "id": "3882086",
            "problem": "考虑在一条笔直河段中，一个保守污染物浓度场的一维、等速输运，其模型为平流偏微分方程 (PDE) $ \\partial_{t} c + u\\,\\partial_{x} c = 0 $，其中速度 $u0$ 为常数。在时间 $t=0$ 时，污染物脉冲的前缘被理想化为一个单位阶跃前沿 $c(x,0) = H(x)$，其中 $H(x)$ 是亥维赛函数，$c$ 是无量纲化的浓度，其值在 $0$（清水）和 $1$（污水）之间变化。空间域在间距为 $\\Delta x$ 的均匀网格上进行离散，空间导数 $ \\partial_{x} c $ 使用适合 $u0$ 的迎风格式进行近似，具体为后向差分 $ \\left(c_{i}-c_{i-1}\\right)/\\Delta x $。时间被视为连续的（线方法），从数值分析中我们知道前向和中心差分的定性行为：前向/后向（迎风）差分会引入人工扩散，而中心差分会引入主阶色散。\n\n使用修正方程分析法对此迎风离散格式进行分析，将该格式视为一个连续的偏微分方程，它在物理平流的基础上增加了一个主阶人工过程。基于此表示，通过量化 $10$–$90$ 上升距离来估计脉冲向下游平流了距离 $L$ 后的前沿展宽。$10$–$90$ 上升距离定义为移动前沿上 $c=0.1$ 和 $c=0.9$ 位置之间的空间间隔。假设唯一的前沿展宽机制是修正方程所预测的人工过程（即，忽略物理扩散和色散），并在修正方程的主阶项主导截断误差的极限情况下进行计算。\n\n给定参数 $u = 1\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，$\\Delta x = 50\\,\\mathrm{m}$ 和 $L = 10\\,\\mathrm{km}$，计算 $10$–$90$ 前沿厚度的数值（单位为米）。将您的答案四舍五入到四位有效数字，并以米为单位表示最终厚度。",
            "solution": "用户想要解决一个问题。\n\n该问题被认为是有效的，计算过程如下所述。\n控制方程为一维平流偏微分方程 (PDE)，如下所示：\n$$\n\\partial_{t} c + u\\,\\partial_{x} c = 0\n$$\n其中 $c(x,t)$ 是污染物浓度，$u  0$ 是恒定的平流速度，$t$ 是时间，$x$ 是空间坐标。空间域在间距为 $\\Delta x$ 的均匀网格上离散。空间导数 $\\partial_{x} c$ 使用适合 $u0$ 的后向差分（迎风）格式进行近似。使用线方法，我们将时间视为连续的，从而得到每个网格点 $x_i$ 处浓度的常微分方程组：\n$$\n\\frac{d c_i}{d t} + u \\frac{c_i - c_{i-1}}{\\Delta x} = 0\n$$\n为了进行修正方程分析，我们将离散值 $c_i(t)$ 和 $c_{i-1}(t)$ 解释为连续函数 $c(x,t)$ 在点 $x_i$ 和 $x_{i-1} = x_i - \\Delta x$ 处的求值。我们将 $c_{i-1}$ 在 $x_i$ 附近展开为泰勒级数：\n$$\nc_{i-1} = c(x_i - \\Delta x, t) = c(x_i, t) - \\Delta x \\, \\partial_{x} c + \\frac{(\\Delta x)^2}{2!} \\, \\partial_{xx} c - \\frac{(\\Delta x)^3}{3!} \\, \\partial_{xxx} c + \\mathcal{O}((\\Delta x)^4)\n$$\n将此展开式代入半离散方程，并将 $c_i$ 替换为 $c$，$\\frac{d}{dt}$ 替换为 $\\partial_t$，我们得到数值格式实际求解的偏微分方程：\n$$\n\\partial_{t} c + \\frac{u}{\\Delta x} \\left( c - \\left[ c - \\Delta x \\, \\partial_{x} c + \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx} c - \\frac{(\\Delta x)^3}{6} \\, \\partial_{xxx} c + \\dots \\right] \\right) = 0\n$$\n简化括号内的表达式得到：\n$$\n\\partial_{t} c + \\frac{u}{\\Delta x} \\left( \\Delta x \\, \\partial_{x} c - \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx} c + \\frac{(\\Delta x)^3}{6} \\, \\partial_{xxx} c - \\dots \\right) = 0\n$$\n$$\n\\partial_{t} c + u \\, \\partial_{x} c - \\frac{u \\Delta x}{2} \\, \\partial_{xx} c + \\frac{u (\\Delta x)^2}{6} \\, \\partial_{xxx} c - \\dots = 0\n$$\n这就是修正方程。原始偏微分方程是 $\\partial_{t} c + u \\, \\partial_{x} c = 0$。修正方程与原始偏微分方程之差是截断误差。题目要求只考虑主阶人工过程。主阶截断误差项是具有最低阶导数的项，即 $-\\frac{u \\Delta x}{2} \\, \\partial_{xx} c$。\n重新整理修正方程，保留主阶误差项，得到：\n$$\n\\partial_{t} c + u \\, \\partial_{x} c = \\frac{u \\Delta x}{2} \\, \\partial_{xx} c\n$$\n这是一个平流-扩散方程。右侧的项代表了由迎风格式引入的人工扩散。人工扩散系数 $K_{art}$ 为：\n$$\nK_{art} = \\frac{u \\Delta x}{2}\n$$\n问题是求解由该平流-扩散方程控制的初始阶跃前沿 $c(x,0) = H(x)$ 的演化。该初值问题的解析解由互补误差函数 $\\mathrm{erfc}$ 或误差函数 $\\mathrm{erf}$ 给出：\n$$\nc(x, t) = \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x - ut}{\\sqrt{4 K_{art} t}}\\right) \\right]\n$$\n前沿展宽定义为 $10$–$90$ 上升距离，即浓度为 $c=0.9$ 和 $c=0.1$ 的点之间的空间间隔 $\\delta = x_{0.9} - x_{0.1}$。\n对于 $c = 0.9$：\n$$\n0.9 = \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}}\\right) \\right]\n$$\n$$\n1.8 = 1 + \\mathrm{erf}\\left(\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}}\\right) \\implies \\mathrm{erf}\\left(\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}}\\right) = 0.8\n$$\n对于 $c = 0.1$：\n$$\n0.1 = \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}}\\right) \\right]\n$$\n$$\n0.2 = 1 + \\mathrm{erf}\\left(\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}}\\right) \\implies \\mathrm{erf}\\left(\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}}\\right) = -0.8\n$$\n设 $\\beta = \\mathrm{erf}^{-1}(0.8)$。根据误差函数的性质，$\\mathrm{erf}(-z) = -\\mathrm{erf}(z)$，所以 $\\mathrm{erf}^{-1}(-0.8) = -\\beta$。我们现在可以写出 $x_{0.9}$ 和 $x_{0.1}$ 的表达式：\n$$\n\\frac{x_{0.9} - ut}{\\sqrt{4 K_{art} t}} = \\beta \\implies x_{0.9} = ut + \\beta \\sqrt{4 K_{art} t}\n$$\n$$\n\\frac{x_{0.1} - ut}{\\sqrt{4 K_{art} t}} = -\\beta \\implies x_{0.1} = ut - \\beta \\sqrt{4 K_{art} t}\n$$\n上升距离 $\\delta$ 是这两个位置之差：\n$$\n\\delta = x_{0.9} - x_{0.1} = \\left( ut + \\beta \\sqrt{4 K_{art} t} \\right) - \\left( ut - \\beta \\sqrt{4 K_{art} t} \\right) = 2 \\beta \\sqrt{4 K_{art} t} = 4 \\beta \\sqrt{K_{art} t}\n$$\n前沿以速度 $u$ 平流了距离 $L$，所以经过的时间是 $t = L/u$。代入这个以及 $K_{art}$ 的表达式：\n$$\n\\delta = 4 \\beta \\sqrt{\\left(\\frac{u \\Delta x}{2}\\right) \\left(\\frac{L}{u}\\right)} = 4 \\beta \\sqrt{\\frac{\\Delta x L}{2}}\n$$\n题目提供了以下数值：\n$u = 1\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ （这个值在 $\\delta$ 的最终计算中不需要，因为它被消掉了）\n$\\Delta x = 50\\,\\mathrm{m}$\n$L = 10\\,\\mathrm{km} = 10 \\times 10^3\\,\\mathrm{m} = 10000\\,\\mathrm{m}$\n\n$\\beta=\\mathrm{erf}^{-1}(0.8)$ 的值约为 $0.9061938$。\n现在，我们可以计算 $\\delta$ 的数值：\n$$\n\\delta = 4 \\times 0.9061938 \\times \\sqrt{\\frac{(50\\,\\mathrm{m}) \\times (10000\\,\\mathrm{m})}{2}}\n$$\n$$\n\\delta = 4 \\times 0.9061938 \\times \\sqrt{\\frac{500000}{2}\\,\\mathrm{m}^2} = 4 \\times 0.9061938 \\times \\sqrt{250000}\\,\\mathrm{m}\n$$\n$$\n\\delta = 4 \\times 0.9061938 \\times 500\\,\\mathrm{m} = 2000 \\times 0.9061938\\,\\mathrm{m} = 1812.3876\\,\\mathrm{m}\n$$\n题目要求答案四舍五入到四位有效数字。\n$$\n\\delta \\approx 1812\\,\\mathrm{m}\n$$",
            "answer": "$$\n\\boxed{1812}\n$$"
        },
        {
            "introduction": "为了将理论应用到真实的地球系统模型中，我们必须从理想化的一维问题过渡到全球尺度的复杂性。在球坐标网格上应用有限差分时，必须考虑坐标系的度量项，这会带来新的挑战。本练习将探讨如何在经纬度网格上计算压力梯度，并直接面对“极点问题”——在接近极点时，度量项 $1/\\cos(\\phi)$ 会急剧放大误差，这是全球气候模型开发中的一个核心难题 。",
            "id": "3882093",
            "problem": "考虑一个半径为 $R$ 的球形地球，其上有一个纬度-经度网格，其中纬度 $\\phi$ 和经度 $\\lambda$ 是角度坐标。根据球面几何，沿东向和北向的局部水平距离分别为 $R \\cos(\\phi) \\,\\mathrm{d}\\lambda$ 和 $R \\,\\mathrm{d}\\phi$。水平气压梯度矢量的分量等于气压沿这两个局部正交方向单位物理距离的变化率。\n\n设气压场由以下解析式定义\n$$\nP(\\phi,\\lambda) = P_0 + A \\cos(\\lambda) + B \\sin(\\phi) + C \\cos(\\phi)\\cos(2\\lambda),\n$$\n其中 $P_0$ 是基准气压，单位为帕斯卡 (Pa)，$A$、$B$、$C$ 是振幅，单位为帕斯卡 (Pa)。水平气压梯度的物理东向分量是经向偏导数乘以局部度规，物理北向分量是纬向偏导数乘以相应的局部度规。所有与梯度相关的输出必须以帕斯卡/米 (Pa/m) 为单位表示。\n\n您必须在一个经度方向为周期性边界条件、纬度方向为固定边界条件的纬度-经度网格上，使用中心差分来近似 $P$ 的经向偏导数。必须沿 $\\lambda$ 应用中心差分来近似 $\\partial P/\\partial \\lambda$，并且必须通过乘以局部度规因子来计算物理东向气压梯度。纬度网格应包括北半球最靠极点的行，并且必须量化该行附近东向分量的误差。网格规范中 $\\phi$ 和 $\\lambda$ 的角度单位是度。您的计算实现必须将角度间距转换为弧度，以便进行度规缩放和差分计算。\n\n作为基本依据，使用以下定义：\n\n1. 水平气压梯度的物理东向分量是\n$$\nG_{\\lambda}(\\phi,\\lambda) = \\frac{1}{R \\cos(\\phi)} \\frac{\\partial P}{\\partial \\lambda}(\\phi,\\lambda),\n$$\n物理北向分量是\n$$\nG_{\\phi}(\\phi,\\lambda) = \\frac{1}{R} \\frac{\\partial P}{\\partial \\phi}(\\phi,\\lambda).\n$$\n\n2. 在具有均匀间距 $\\Delta \\lambda$ 的网格点 $(\\phi_i,\\lambda_j)$ 处，经向导数的中心差分近似基于泰勒展开 (Taylor expansion)：\n$$\n\\frac{\\partial P}{\\partial \\lambda}(\\phi_i,\\lambda_j) \\approx \\frac{P(\\phi_i,\\lambda_{j+1}) - P(\\phi_i,\\lambda_{j-1})}{2 \\Delta \\lambda},\n$$\n其截断误差的主导项与三阶经向导数成正比：\n$$\n\\text{error} \\approx \\frac{\\Delta \\lambda^2}{6} \\frac{\\partial^3 P}{\\partial \\lambda^3}(\\phi_i,\\lambda_j).\n$$\n当乘以度规以产生物理东向梯度时，主导误差变为\n$$\nE_{\\lambda}(\\phi_i,\\lambda_j) \\approx \\frac{1}{R \\cos(\\phi_i)} \\cdot \\frac{\\Delta \\lambda^2}{6} \\cdot \\frac{\\partial^3 P}{\\partial \\lambda^3}(\\phi_i,\\lambda_j).\n$$\n\n您的程序必须：\n- 在每个测试网格上构建气压场 $P(\\phi,\\lambda)$。\n- 使用经度方向的中心差分和周期性边界条件，计算最靠极点纬度行上 $G_{\\lambda}$ 的数值近似。\n- 在同一行上，通过 $\\partial P/\\partial \\lambda$ 解析计算精确的 $G_{\\lambda}$。\n- 计算该行上观测到的最大绝对误差：\n$$\n\\max_{\\lambda} \\left| G_{\\lambda}^{\\text{num}} - G_{\\lambda}^{\\text{exact}} \\right|,\n$$\n以帕斯卡/米 (Pa/m) 为单位表示。\n- 使用 $E_{\\lambda}$ 的公式，通过计算精确的三阶经向导数 $\\partial^3 P/\\partial \\lambda^3$ 并在经度上取最大绝对值，来计算该行上估计的最大主阶截断误差，同样以帕斯卡/米 (Pa/m) 为单位表示。\n\n使用以下固定参数值：\n- $R = 6{,}371{,}000$ 米。\n- $P_0 = 100{,}000$ 帕斯卡。\n- $A = 10{,}000$ 帕斯卡。\n- $B = 5{,}000$ 帕斯卡。\n- $C = 2{,}000$ 帕斯卡。\n\n网格规范的角度单位是度；您的数值方法必须将经度间距 $\\Delta \\lambda$ 从度转换为弧度，以便进行差分和度规缩放。气压梯度必须以帕斯卡/米 (Pa/m) 为单位报告。\n\n测试套件：\n- 情况 1：纬度范围从 $-\\!60^\\circ$ 到 $+\\!60^\\circ$，纬度间距 $\\Delta \\phi = 1^\\circ$；经度间距 $\\Delta \\lambda = 1^\\circ$，经度周期性覆盖 $[0^\\circ, 360^\\circ)$。\n- 情况 2：纬度范围从 $-\\!85^\\circ$ 到 $+\\!85^\\circ$，纬度间距 $\\Delta \\phi = 1^\\circ$；经度间距 $\\Delta \\lambda = 1^\\circ$，经度周期性覆盖 $[0^\\circ, 360^\\circ)$。\n- 情况 3：纬度范围从 $-\\!89^\\circ$ 到 $+\\!89^\\circ$，纬度间距 $\\Delta \\phi = 1^\\circ$；经度间距 $\\Delta \\lambda = 1^\\circ$，经度周期性覆盖 $[0^\\circ, 360^\\circ)$。\n- 情况 4：纬度范围从 $-\\!89.5^\\circ$ 到 $+\\!89.5^\\circ$，纬度间距 $\\Delta \\phi = 0.5^\\circ$；经度间距 $\\Delta \\lambda = 1^\\circ$，经度周期性覆盖 $[0^\\circ, 360^\\circ)$。\n\n对于每种情况，计算两个浮点数：\n- 最靠极点行上的观测最大绝对误差，单位为帕斯卡/米 (Pa/m)，以及\n- 同一行上估计的最大主阶截断误差，单位为帕斯卡/米 (Pa/m)。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，没有空格，其中每种情况都以 $[e_{\\text{obs}},e_{\\text{est}}]$ 的格式表示。对于这四个测试用例，输出格式必须为\n$$\n\\left[\\,[e_{\\text{obs},1},e_{\\text{est},1}],[e_{\\text{obs},2},e_{\\text{est},2}],[e_{\\text{obs},3},e_{\\text{est},3}],[e_{\\text{obs},4},e_{\\text{est},4}]\\,\\right].\n$$",
            "solution": "用户提供的问题是有效的。它在科学上基于地球物理流体动力学和数值分析的原理，问题陈述清晰，包含了所有必要的参数和方程，并且表述客观。任务是计算球形网格上气压梯度中心差分方案的误差，这是地球系统建模中一个标准且相关的问题。该问题没有矛盾、歧义和事实错误。\n\n解决方案首先推导了目标量的解析表达式，然后概述了近似这些量并计算误差的数值程序。\n\n气压场由以下解析函数给出：\n$$\nP(\\phi,\\lambda) = P_0 + A \\cos(\\lambda) + B \\sin(\\phi) + C \\cos(\\phi)\\cos(2\\lambda)\n$$\n其中 $\\phi$ 是纬度，$\\lambda$ 是经度。在所有计算中，这些角度必须使用弧度单位。提供的常数为 $R = 6,371,000 \\, \\text{m}$，$P_0 = 100,000 \\, \\text{Pa}$，$A = 10,000 \\, \\text{Pa}$，$B = 5,000 \\, \\text{Pa}$ 和 $C = 2,000 \\, \\text{Pa}$。\n\n气压梯度的物理东向分量定义为：\n$$\nG_{\\lambda}(\\phi,\\lambda) = \\frac{1}{R \\cos(\\phi)} \\frac{\\partial P}{\\partial \\lambda}(\\phi,\\lambda)\n$$\n\n为了找到 $G_{\\lambda}$ 的精确表达式，我们首先计算 $P$ 关于 $\\lambda$ 的偏导数：\n$$\n\\frac{\\partial P}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left( P_0 + A \\cos(\\lambda) + B \\sin(\\phi) + C \\cos(\\phi)\\cos(2\\lambda) \\right) = -A \\sin(\\lambda) - 2C \\cos(\\phi) \\sin(2\\lambda)\n$$\n将此代入 $G_{\\lambda}$ 的定义，得到精确的东向梯度：\n$$\nG_{\\lambda}^{\\text{exact}}(\\phi, \\lambda) = \\frac{1}{R \\cos(\\phi)} \\left[ -A \\sin(\\lambda) - 2C \\cos(\\phi) \\sin(2\\lambda) \\right] = -\\frac{A \\sin(\\lambda)}{R \\cos(\\phi)} - \\frac{2C \\sin(2\\lambda)}{R}\n$$\n\n梯度的数值近似基于偏导数的二阶中心差分格式：\n$$\n\\frac{\\partial P}{\\partial \\lambda}\\bigg|_{(\\phi_i, \\lambda_j)} \\approx \\frac{P(\\phi_i, \\lambda_{j+1}) - P(\\phi_i, \\lambda_{j-1})}{2 \\Delta \\lambda}\n$$\n其中 $\\lambda_{j+1} = \\lambda_j + \\Delta \\lambda$ 且 $\\lambda_{j-1} = \\lambda_j - \\Delta \\lambda$。角度间距 $\\Delta \\lambda$ 必须以弧度为单位。那么，东向梯度 $G_{\\lambda}^{\\text{num}}$ 的数值近似为：\n$$\nG_{\\lambda}^{\\text{num}}(\\phi_i, \\lambda_j) = \\frac{1}{R \\cos(\\phi_i)} \\left( \\frac{P(\\phi_i, \\lambda_{j+1}) - P(\\phi_i, \\lambda_{j-1})}{2 \\Delta \\lambda} \\right)\n$$\n问题要求在具有周期性边界条件的整个经度圈上计算此值。这意味着对于一个索引为 $j=0, \\dots, N-1$ 的 $N$ 点网格，点 $j=0$ 的邻居是 $j=1$ 和 $j=N-1$，而点 $j=N-1$ 的邻居是 $j=0$ 和 $j=N-2$。\n\n主要目标是将数值近似与精确解进行比较。观测误差定义为网格最靠极点纬度行 $\\phi_{\\text{pole}}$ 上的最大绝对差：\n$$\ne_{\\text{obs}} = \\max_{\\lambda_j} \\left| G_{\\lambda}^{\\text{num}}(\\phi_{\\text{pole}}, \\lambda_j) - G_{\\lambda}^{\\text{exact}}(\\phi_{\\text{pole}}, \\lambda_j) \\right|\n$$\n\n第二个目标是使用泰勒级数截断误差的主导项来估计此误差。物理梯度的中心差分近似的主导误差是：\n$$\nE_{\\lambda}(\\phi,\\lambda) \\approx \\frac{1}{R \\cos(\\phi)} \\cdot \\frac{\\Delta \\lambda^2}{6} \\cdot \\frac{\\partial^3 P}{\\partial \\lambda^3}(\\phi,\\lambda)\n$$\n为了计算这个值，我们需要 $P$ 关于 $\\lambda$ 的三阶偏导数：\n$$\n\\frac{\\partial^2 P}{\\partial \\lambda^2} = \\frac{\\partial}{\\partial \\lambda} \\left( -A \\sin(\\lambda) - 2C \\cos(\\phi) \\sin(2\\lambda) \\right) = -A \\cos(\\lambda) - 4C \\cos(\\phi) \\cos(2\\lambda)\n$$\n$$\n\\frac{\\partial^3 P}{\\partial \\lambda^3} = \\frac{\\partial}{\\partial \\lambda} \\left( -A \\cos(\\lambda) - 4C \\cos(\\phi) \\cos(2\\lambda) \\right) = A \\sin(\\lambda) + 8C \\cos(\\phi) \\sin(2\\lambda)\n$$\n将此代入误差公式可得：\n$$\nE_{\\lambda}(\\phi, \\lambda) \\approx \\frac{\\Delta \\lambda^2}{6 R \\cos(\\phi)} \\left[ A \\sin(\\lambda) + 8C \\cos(\\phi) \\sin(2\\lambda) \\right] = \\frac{\\Delta \\lambda^2}{6} \\left[ \\frac{A \\sin(\\lambda)}{R \\cos(\\phi)} + \\frac{8C \\sin(2\\lambda)}{R} \\right]\n$$\n估计的最大误差是该表达式在最靠极点纬度行上的最大绝对值：\n$$\ne_{\\text{est}} = \\max_{\\lambda_j} \\left| E_{\\lambda}(\\phi_{\\text{pole}}, \\lambda_j) \\right|\n$$\n\n每个测试用例的计算过程如下：\n1.  定义网格参数：极点纬度 $\\phi_{\\text{pole}}$ 和经度间距 $\\Delta \\lambda_{\\text{deg}}$。\n2.  将角度转换为弧度：$\\phi_{\\text{pole, rad}} = \\phi_{\\text{pole}} \\cdot \\pi/180$ 和 $\\Delta \\lambda_{\\text{rad}} = \\Delta \\lambda_{\\text{deg}} \\cdot \\pi/180$。\n3.  创建经度网格 $\\lambda_j$，其中 $j=0, \\dots, N-1$ 且 $N = 360 / \\Delta \\lambda_{\\text{deg}}$。\n4.  在纬度 $\\phi_{\\text{pole, rad}}$ 处，计算网格上所有 $\\lambda_j$ 对应的气压 $P(\\phi_{\\text{pole, rad}}, \\lambda_j)$。\n5.  使用周期性索引（例如，使用 `numpy.roll`）来获得每个点的 $P(\\phi_{\\text{pole, rad}}, \\lambda_{j+1})$ 和 $P(\\phi_{\\text{pole, rad}}, \\lambda_{j-1})$。\n6.  使用中心差分公式计算所有 $\\lambda_j$ 的 $G_{\\lambda}^{\\text{num}}$。\n7.  使用解析公式计算所有 $\\lambda_j$ 的 $G_{\\lambda}^{\\text{exact}}$。\n8.  计算观测到的最大绝对误差 $e_{\\text{obs}}$。\n9.  使用其解析公式计算所有 $\\lambda_j$ 的估计主阶误差 $E_{\\lambda}$。\n10. 计算估计的最大绝对误差 $e_{\\text{est}}$。\n11. 存储该测试用例的结果对 $[e_{\\text{obs}}, e_{\\text{est}}]$。\n对所有四个测试用例重复此过程，并将结果汇总为最终指定的格式。当纬度 $\\phi$ 接近 $\\pm 90^\\circ$ 时，项 $\\cos(\\phi)$ 趋近于 $0$，导致 $G_{\\lambda}$ 梯度及其相关误差显著增大。这种行为是全球气候模型中“极点问题”的一个关键方面，预计会反映在结果中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes observed and estimated numerical errors for the eastward pressure gradient\n    on a spherical grid for a series of test cases.\n    \"\"\"\n\n    # --- Fixed Parameters ---\n    R = 6371000.0  # Earth radius in meters\n    P0 = 100000.0  # Baseline pressure in Pascals\n    A = 10000.0    # Amplitude in Pascals\n    B = 5000.0     # Amplitude in Pascals\n    C = 2000.0     # Amplitude in Pascals\n\n    # --- Test Cases ---\n    # Each case is (poleward_latitude_deg, longitude_spacing_deg)\n    # The latitude extent and dphi define the poleward row.\n    test_cases = [\n        (60.0, 1.0),   # Case 1: phi_max = 60 deg, d_lambda = 1 deg\n        (85.0, 1.0),   # Case 2: phi_max = 85 deg, d_lambda = 1 deg\n        (89.0, 1.0),   # Case 3: phi_max = 89 deg, d_lambda = 1 deg\n        (89.5, 1.0),   # Case 4: phi_max = 89.5 deg, d_lambda = 1 deg\n    ]\n\n    # --- Analytical Functions ---\n    def pressure(phi_rad, lam_rad, p0, a, b, c):\n        \"\"\"Analytical pressure field P(phi, lambda).\"\"\"\n        return p0 + a * np.cos(lam_rad) + b * np.sin(phi_rad) + c * np.cos(phi_rad) * np.cos(2 * lam_rad)\n\n    def exact_eastward_gradient(phi_rad, lam_rad, r, a, c):\n        \"\"\"Analytical eastward pressure gradient G_lambda(phi, lambda).\"\"\"\n        # G_lambda = (1 / (R * cos(phi))) * dP/dlambda\n        # dP/dlambda = -A*sin(lambda) - 2*C*cos(phi)*sin(2*lambda)\n        term1 = -a * np.sin(lam_rad) / (r * np.cos(phi_rad))\n        term2 = -2 * c * np.sin(2 * lam_rad) / r\n        return term1 + term2\n\n    def estimated_leading_error(phi_rad, lam_rad, d_lam_rad, r, a, c):\n        \"\"\"Analytical leading-order truncation error E_lambda(phi, lambda).\"\"\"\n        # E_lambda = (d_lambda^2 / 6) * (1 / (R * cos(phi))) * d^3P/dlambda^3\n        # d^3P/dlambda^3 = A*sin(lambda) + 8*C*cos(phi)*sin(2*lambda)\n        d3p_dlam3_term = a * np.sin(lam_rad) + 8 * c * np.cos(phi_rad) * np.sin(2 * lam_rad)\n        error = (d_lam_rad**2 / 6.0) * (1.0 / (r * np.cos(phi_rad))) * d3p_dlam3_term\n        return error\n\n    results = []\n\n    for phi_pole_deg, d_lambda_deg in test_cases:\n        # --- Grid Setup ---\n        # Convert angles to radians for calculation\n        phi_pole_rad = np.radians(phi_pole_deg)\n        d_lambda_rad = np.radians(d_lambda_deg)\n\n        # Create longitude grid [0, 360)\n        n_lambda = int(360.0 / d_lambda_deg)\n        lambda_grid_deg = np.arange(0, 360.0, d_lambda_deg)\n        lambda_grid_rad = np.radians(lambda_grid_deg)\n\n        # --- Numerical Calculation ---\n        # 1. Evaluate pressure P on the latitude circle\n        p_values = pressure(phi_pole_rad, lambda_grid_rad, P0, A, B, C)\n\n        # 2. Get values at j+1 and j-1 using periodic boundaries\n        p_jp1 = np.roll(p_values, -1)\n        p_jm1 = np.roll(p_values, 1)\n\n        # 3. Compute numerical derivative dP/dlambda\n        dp_dlambda_num = (p_jp1 - p_jm1) / (2.0 * d_lambda_rad)\n\n        # 4. Compute numerical gradient G_lambda^num\n        g_lambda_num = dp_dlambda_num / (R * np.cos(phi_pole_rad))\n\n        # --- Error Calculation ---\n        # 1. Compute exact gradient G_lambda^exact\n        g_lambda_exact = exact_eastward_gradient(phi_pole_rad, lambda_grid_rad, R, A, C)\n\n        # 2. Compute observed maximum absolute error\n        observed_error = np.max(np.abs(g_lambda_num - g_lambda_exact))\n\n        # 3. Compute estimated maximum leading-order error\n        est_error_values = estimated_leading_error(phi_pole_rad, lambda_grid_rad, d_lambda_rad, R, A, C)\n        estimated_error = np.max(np.abs(est_error_values))\n\n        results.append((observed_error, estimated_error))\n\n    # --- Final Output Formatting ---\n    # Format: [[e_obs,1,e_est,1],[e_obs,2,e_est,2],...] with no spaces\n    output_str = \",\".join([f\"[{o},{e}]\" for o, e in results])\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}