{
    "hands_on_practices": [
        {
            "introduction": "分析数值格式的特性通常始于将其应用于标量检验方程 $y'(t) = \\lambda y(t)$。这个简单的常微分方程是理解数值方法在更复杂系统中行为的基石。本练习  将通过一个刚性问题，让您亲手计算并体会后向欧拉法在保证数值稳定性的同时，可能会牺牲局部精度的基本权衡。",
            "id": "3885112",
            "problem": "考虑一个单箱环境系统中示踪剂浓度的无量纲线性衰减模型，其理想化形式为常微分方程 (ODE) $y'(t)=\\lambda y(t)$，初始条件为 $y(0)=y_{0}$。该常微分方程源于质量守恒定律，其中包含一个与 $y(t)$ 成正比的线性化汇项，$\\lambda0$ 代表一个恒定的衰减率。设 $\\lambda=-1000$， $y_{0}=1$，时间步长为 $\\Delta t=0.1$。使用从单个时间步长上的常微分方程积分形式导出的隐式时间积分格式，应用后向欧拉法计算单步数值近似值 $y_{1}\\approx y(\\Delta t)$。\n\n另外，通过分离变量法推导该常微分方程的精确解 $y(t)$，并在 $t=\\Delta t$ 处求值。将绝对单步误差定义为 $E=\\left|y_{1}-y(\\Delta t)\\right|$。将 $E$ 以单个数字的形式报告，并四舍五入到四位有效数字。答案以无量纲量的形式表示。此计算的目的是将后向欧拉法的结果与精确解进行比较，以说明在环境与地球系统建模中，刚性问题的绝对稳定性（A-稳定性）与准确性之间的权衡。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、是适定的且客观的。\n\n### 第1步：提取已知条件\n- 常微分方程 (ODE)：$y'(t)=\\lambda\\,y(t)$\n- 初始条件：$y(0)=y_{0}$\n- 衰减率常数：$\\lambda=-1000$\n- 初始值：$y_{0}=1$\n- 时间步长：$\\Delta t=0.1$\n- 数值方法：后向欧拉法\n- 待计算量：单步数值近似值 $y_{1}\\approx y(\\Delta t)$\n- 精确解：待推导的 $y(t)$。\n- 误差定义：绝对单步误差 $E=\\left|y_{1}-y(\\Delta t)\\right|$\n- 最终输出要求：报告 $E$，四舍五入至四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题描述了一个一阶线性齐次常微分方程的标准初值问题 (IVP)，这是科学与工程领域中指数衰减过程的一个基本模型。所提供的参数（$\\lambda=-1000$，$\\Delta t=0.1$）定义了一个数值刚性问题，这是测试和说明像后向欧拉法这类隐式时间积分格式性质的一个常见且有意义的场景。该问题是自洽的，提供了所有必要的数据。语言精确客观。没有科学或事实上的不健全之处、矛盾或歧义。\n\n### 第3步：结论与行动\n问题有效。将提供完整的解法。\n\n### 使用后向欧拉法推导数值解\n给定的常微分方程是 $y'(t) = \\lambda y(t)$。后向欧拉法是求解常微分方程的一种隐式单步数值方法。对于形如 $y'(t) = f(t,y)$ 的常微分方程，将解从时间 $t_n$ 推进到 $t_{n+1} = t_n + \\Delta t$ 的通用公式为：\n$$y_{n+1} = y_n + \\Delta t \\, f(t_{n+1}, y_{n+1})$$\n在本题中，函数 $f(t,y)$ 由 $f(t,y) = \\lambda y(t)$ 给出。将此代入后向欧拉法公式，得到：\n$$y_{n+1} = y_n + \\Delta t (\\lambda y_{n+1})$$\n由于这是一种隐式方法，我们必须求解未知数 $y_{n+1}$：\n$$y_{n+1} - \\lambda \\Delta t y_{n+1} = y_n$$\n$$y_{n+1} (1 - \\lambda \\Delta t) = y_n$$\n$$y_{n+1} = \\frac{y_n}{1 - \\lambda \\Delta t}$$\n题目要求我们从 $t_0=0$ 时的初始条件 $y_0$ 开始，计算第一步 $y_1$。设 $n=0$：\n$$y_1 = \\frac{y_0}{1 - \\lambda \\Delta t}$$\n题目提供了值 $y_0=1$、$\\lambda=-1000$ 和 $\\Delta t=0.1$。将这些值代入 $y_1$ 的方程中：\n$$y_1 = \\frac{1}{1 - (-1000)(0.1)} = \\frac{1}{1 - (-100)} = \\frac{1}{1+100} = \\frac{1}{101}$$\n\n### 推导精确解\n常微分方程 $y'(t) = \\lambda y(t)$ 可以写成 $\\frac{dy}{dt} = \\lambda y$。这是一个可分离变量的微分方程。我们可以分离变量 $y$ 和 $t$：\n$$\\frac{dy}{y} = \\lambda \\, dt$$\n对该方程两边积分：\n$$\\int \\frac{1}{y} \\, dy = \\int \\lambda \\, dt$$\n$$\\ln|y| = \\lambda t + C$$\n其中 $C$ 是积分常数。为了解出 $y$，我们对两边取指数：\n$$|y| = \\exp(\\lambda t + C) = \\exp(C) \\exp(\\lambda t)$$\n令 $A = \\pm\\exp(C)$，我们得到通解：\n$$y(t) = A \\exp(\\lambda t)$$\n为了求得特解，我们应用初始条件 $y(0)=y_0$：\n$$y(0) = A \\exp(\\lambda \\cdot 0) = A \\exp(0) = A \\cdot 1 = A$$\n因此，积分常数为 $A=y_0$。该初值问题的精确解是：\n$$y(t) = y_0 \\exp(\\lambda t)$$\n代入给定值 $y_0=1$ 和 $\\lambda=-1000$：\n$$y(t) = 1 \\cdot \\exp(-1000t) = \\exp(-1000t)$$\n我们需要在时间 $t=\\Delta t=0.1$ 处计算此精确解的值：\n$$y(\\Delta t) = y(0.1) = \\exp(-1000 \\cdot 0.1) = \\exp(-100)$$\n\n### 绝对误差的计算\n绝对单步误差 $E$ 定义为 $E = |y_1 - y(\\Delta t)|$。代入我们求得的数值解和精确解：\n$$E = \\left| \\frac{1}{101} - \\exp(-100) \\right|$$\n现在，我们来计算具体数值。\n$y_1 = \\frac{1}{101} \\approx 0.009900990099...$\n$y(\\Delta t) = \\exp(-100)$ 的值是一个极小的正数。使用计算器可得 $\\exp(-100) \\approx 3.72 \\times 10^{-44}$。\n误差为：\n$$E \\approx |0.009900990099 - 3.72 \\times 10^{-44}|$$\n项 $\\exp(-100)$ 比 $\\frac{1}{101}$ 小很多个数量级，对于所要求的精度，它对误差的贡献可以忽略不计。因此，误差实际上等于 $y_1$：\n$$E \\approx \\frac{1}{101} \\approx 0.009900990099...$$\n题目要求结果四舍五入到四位有效数字。\n$E$ 的第一个非零数字是千分位上的 $9$。前四位有效数字是 $9$、$9$、$0$、$0$。第五位有效数字是 $9$。由于 $9 \\ge 5$，我们将第四位有效数字进一位。\n所以，数值 $0.00990099...$ 四舍五入到四位有效数字是 $0.009901$。",
            "answer": "$$\\boxed{0.009901}$$"
        },
        {
            "introduction": "除了后向欧拉法，Crank-Nicolson 法是另一种广泛应用的二阶精度隐式格式。然而，精度并非选择时间积分方案的唯一标准。本练习  旨在通过比较这两种格式在刚性极限下的放大因子，来探讨“数值阻尼”这一重要概念，它揭示了不同格式在处理高频扰动时的本质差异。",
            "id": "3885086",
            "problem": "在环境和地球系统建模的大气化学中，一个常见的子网格化学过程是物质浓度向平衡值的线性弛豫。考虑代表化学弛豫的自治常微分方程（ODE），\n$$\n\\frac{d y}{d t} \\;=\\; -\\alpha \\big(y - y^{\\ast}\\big),\n$$\n其中 $\\alpha  0$ 是一个恒定的弛豫速率，$y^{\\ast}$ 是一个恒定的化学平衡值。令 $\\Delta t  0$ 为一个恒定的时间步长。定义偏差变量 $u(t) = y(t) - y^{\\ast}$，使ODE变为\n$$\n\\frac{d u}{d t} \\;=\\; -\\alpha u.\n$$\n在刚性过程算子中广泛使用的两种标准隐式单步时间积分格式是后向欧拉（BE）法和克兰克–尼科尔森（CN）法。将这些方法应用于偏差方程，推导形如 $u_{n+1} = R(z)\\,u_{n}$ 的单步更新，其中 $z = -\\alpha \\Delta t$，并计算每种格式的放大（稳定性）函数 $|R(-\\alpha \\Delta t)|$ 的模。然后，在刚性极限 $\\alpha \\Delta t \\gg 1$ 下，确定这些模的渐近值。将你的最终答案表示为一个行矩阵，按 $\\big($后向欧拉，克兰克–尼科尔森$\\big)$ 的顺序包含这两个渐近模，并且不包括单位。无需四舍五入。",
            "solution": "该问题要求分析两种用于线性弛豫常微分方程（ODE）的隐式时间积分格式：后向欧拉（BE）法和克兰克-尼科尔森（CN）法。目标是求出在刚性极限下（即弛豫速率 $\\alpha$ 和时间步长 $\\Delta t$ 的乘积很大时），每种格式的放大函数的渐近模。\n\n偏差变量 $u(t) = y(t) - y^{\\ast}$ 的控制ODE由下式给出：\n$$\n\\frac{d u}{d t} = -\\alpha u\n$$\n这是一个标准线性测试方程，形式为 $\\frac{du}{dt} = \\lambda u$，其中 $\\lambda = -\\alpha$。我们需要求出形如 $u_{n+1} = R(-\\alpha \\Delta t) u_n$ 的单步更新，其中 $R$ 是放大或稳定性函数。\n\n首先，我们分析后向欧拉（BE）格式。BE法是一种单步隐式格式，定义为：\n$$\nu_{n+1} = u_n + \\Delta t \\left( \\frac{d u}{d t} \\right)_{n+1}\n$$\n代入给定的ODE $\\frac{du}{dt} = -\\alpha u$，在未来时间步 $n+1$ 处求值：\n$$\nu_{n+1} = u_n + \\Delta t (-\\alpha u_{n+1})\n$$\n我们现在必须解这个关于 $u_{n+1}$ 的方程来确定放大因子。\n$$\nu_{n+1} + \\alpha \\Delta t u_{n+1} = u_n\n$$\n$$\nu_{n+1} (1 + \\alpha \\Delta t) = u_n\n$$\n$$\nu_{n+1} = \\frac{1}{1 + \\alpha \\Delta t} u_n\n$$\n从此表达式中，我们可以确定BE格式的放大函数 $R_{BE}(-\\alpha \\Delta t)$ 为：\n$$\nR_{BE}(-\\alpha \\Delta t) = \\frac{1}{1 + \\alpha \\Delta t}\n$$\n问题要求这个函数的模。由于 $\\alpha  0$ 且 $\\Delta t  0$，乘积 $\\alpha \\Delta t$ 是一个正实数。因此，分母 $1 + \\alpha \\Delta t$ 总是大于 $1$。因此，其模为：\n$$\n|R_{BE}(-\\alpha \\Delta t)| = \\left| \\frac{1}{1 + \\alpha \\Delta t} \\right| = \\frac{1}{1 + \\alpha \\Delta t}\n$$\n在刚性极限 $\\alpha \\Delta t \\gg 1$ 下，我们计算当 $\\alpha \\Delta t \\to \\infty$ 时这个模的极限：\n$$\n\\lim_{\\alpha \\Delta t \\to \\infty} |R_{BE}(-\\alpha \\Delta t)| = \\lim_{\\alpha \\Delta t \\to \\infty} \\frac{1}{1 + \\alpha \\Delta t} = 0\n$$\n后向欧拉格式的渐近模为 $0$。\n\n接下来，我们分析克兰克-尼科尔森（CN）格式。CN法是一种单步隐式格式，它对当前和未来时间步的导数进行平均：\n$$\nu_{n+1} = u_n + \\frac{\\Delta t}{2} \\left[ \\left( \\frac{d u}{d t} \\right)_{n} + \\left( \\frac{d u}{d t} \\right)_{n+1} \\right]\n$$\n代入ODE $\\frac{du}{dt} = -\\alpha u$：\n$$\nu_{n+1} = u_n + \\frac{\\Delta t}{2} [ (-\\alpha u_n) + (-\\alpha u_{n+1}) ]\n$$\n现在，我们求解 $u_{n+1}$：\n$$\nu_{n+1} = u_n - \\frac{\\alpha \\Delta t}{2} u_n - \\frac{\\alpha \\Delta t}{2} u_{n+1}\n$$\n$$\nu_{n+1} + \\frac{\\alpha \\Delta t}{2} u_{n+1} = u_n - \\frac{\\alpha \\Delta t}{2} u_n\n$$\n$$\nu_{n+1} \\left( 1 + \\frac{\\alpha \\Delta t}{2} \\right) = u_n \\left( 1 - \\frac{\\alpha \\Delta t}{2} \\right)\n$$\n$$\nu_{n+1} = \\frac{1 - \\frac{\\alpha \\Delta t}{2}}{1 + \\frac{\\alpha \\Delta t}{2}} u_n\n$$\nCN格式的放大函数 $R_{CN}(-\\alpha \\Delta t)$ 是：\n$$\nR_{CN}(-\\alpha \\Delta t) = \\frac{1 - \\frac{\\alpha \\Delta t}{2}}{1 + \\frac{\\alpha \\Delta t}{2}}\n$$\n这个函数的模是：\n$$\n|R_{CN}(-\\alpha \\Delta t)| = \\left| \\frac{1 - \\frac{\\alpha \\Delta t}{2}}{1 + \\frac{\\alpha \\Delta t}{2}} \\right|\n$$\n同样，由于 $\\alpha \\Delta t  0$，分母 $1 + \\frac{\\alpha \\Delta t}{2}$ 总是正的。模由比值的绝对值决定。在刚性极限 $\\alpha \\Delta t \\gg 1$ 下，我们计算当 $\\alpha \\Delta t \\to \\infty$ 时这个模的极限。为了计算这个极限，我们可以将分子和分母同除以 $\\alpha \\Delta t$：\n$$\n\\lim_{\\alpha \\Delta t \\to \\infty} |R_{CN}(-\\alpha \\Delta t)| = \\lim_{\\alpha \\Delta t \\to \\infty} \\left| \\frac{\\frac{2}{\\alpha \\Delta t} - 1}{\\frac{2}{\\alpha \\Delta t} + 1} \\right|\n$$\n当 $\\alpha \\Delta t \\to \\infty$ 时，项 $\\frac{2}{\\alpha \\Delta t} \\to 0$。因此，极限变为：\n$$\n\\left| \\frac{0 - 1}{0 + 1} \\right| = |-1| = 1\n$$\n克兰克-尼科尔森格式的渐近模为 $1$。\n\n最终答案是一个行矩阵，按顺序包含后向欧拉格式和克兰克-尼科尔森格式的渐近模。这两个值分别为 $0$ 和 $1$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "真实的环境模型通常涉及偏微分方程（PDEs），而不仅仅是孤立的常微分方程（ODEs）。本练习  将理论与实践相结合，要求您将后向欧拉法应用于海洋或大气科学中的一个基本过程——一维垂直扩散。您将构建每个时间步所需解的线性方程组，从而深入理解隐式格式在实际建模中的应用。",
            "id": "3885094",
            "problem": "您的任务是设计并实现一个采用隐式时间积分方案的一维海洋水柱扩散步骤。考虑一个标量示踪剂场 $C(z,t)$，在没有平流和源项的情况下，其垂直扩散遵循菲克输运定律。区域为 $z \\in [0,H]$，其中 $z$ 向下递增。质量守恒定律与菲克扩散定律相结合，得到控制方程\n$$\n\\frac{\\partial C}{\\partial t} = \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right),\n$$\n其中 $D(z)$ 是垂直扩散系数，单位为 $\\mathrm{m^2/s}$。边界条件是在表面和底部的物理一致的无通量条件，\n$$\nD(0)\\,\\frac{\\partial C}{\\partial z}(0,t)=0, \\quad D(H)\\,\\frac{\\partial C}{\\partial z}(H,t)=0.\n$$\n时间离散化采用后向欧拉隐式时间积分方案，空间离散化采用均匀节点网格上的二阶守恒有限体积法。设存在 $N$ 个节点，位于 $z_i = i\\,\\Delta z$ 处，其中 $i \\in \\{0,1,\\dots,N-1\\}$，$\\Delta z = H/(N-1)$，单位为 $\\mathrm{m}$。用上标 $n$ 和 $n+1$ 表示时间层，对应于时间 $t^n$ 和 $t^{n+1}=t^n+\\Delta t$，其中 $\\Delta t$ 的单位为 $\\mathrm{s}$。跨越界面 $z_{i+1/2} = z_i + \\Delta z/2$ 的离散通量应使用界面扩散系数 $D_{i+1/2}$ 计算，该系数由相邻单元中心值 $D_i = D(z_i)$ 和 $D_{i+1} = D(z_{i+1})$ 的调和平均得到，即\n$$\nD_{i+1/2} = \\frac{2}{\\frac{1}{D_i} + \\frac{1}{D_{i+1}}}\n$$\n约定如果 $D_i=D_{i+1}=0$ 则 $D_{i+1/2}=0$。无通量边界条件意味着在 $z_{-1/2}$ 和 $z_{N-1/2}$ 处的通量为零，并且边界处的离散散度必须相应地进行调整。\n\n您的目标是：\n- 从守恒定律和后向欧拉离散化出发，推导每个时间步长中针对未知向量 $\\mathbf{C}^{n+1} = \\left(C_0^{n+1},C_1^{n+1},\\dots,C_{N-1}^{n+1}\\right)^\\top$ 所得到的三对角线性系统。将该系统表示为以下形式\n$$\na_i\\,C_{i-1}^{n+1} + b_i\\,C_i^{n+1} + c_i\\,C_{i+1}^{n+1} = d_i,\n$$\n对于 $i \\in \\{0,1,\\dots,N-1\\}$，由于无通量边界条件，在 $i=0$ 和 $i=N-1$ 处需要进行适当的修改。这里，$a_i$，$b_i$，$c_i$ 分别是下对角线、主对角线和上对角线的系数，而 $d_i$ 是右侧项。\n- 实现一个完整的、可运行的程序，该程序在给定 $N$、$H$、$\\Delta t$、扩散系数函数 $D(z)$ 和初始示踪剂剖面函数 $C(z,t^n)$ 的情况下，计算并返回隐式步骤的系数数组 $\\{a_i\\}$、$\\{b_i\\}$、$\\{c_i\\}$ 和右侧项 $\\{d_i\\}$。您的网格必须使用 $z_i = i\\,\\Delta z$，其中 $\\Delta z = H/(N-1)$。\n- 按规定使用调和平均计算 $D_{i+1/2}$。通过将边界通量 $z_{-1/2}$ 和 $z_{N-1/2}$ 设置为零来处理无通量边界条件。\n\n物理单位和格式要求：\n- $H$ 必须以 $\\mathrm{m}$ 为单位指定，$\\Delta z$ 以 $\\mathrm{m}$ 为单位计算，$\\Delta t$ 以 $\\mathrm{s}$ 为单位指定，$D$ 以 $\\mathrm{m^2/s}$ 为单位指定。在本问题中，示踪剂 $C$ 是无量纲的。\n- 如果使用任何三角函数，角度必须以弧度为单位。\n- 您的程序必须只输出一行，其中包含所有测试用例的汇总结果，格式如下文所述。\n\n测试套件和最终输出规范：\n- 实现以下三个测试用例。对于每个用例，计算并按顺序返回分别对应于 $\\{a_i\\}$、$\\{b_i\\}$、$\\{c_i\\}$ 和 $\\{d_i\\}$ 的四个列表。\n\n1. 测试用例 1（$D$ 平滑变化的一般情况）：\n   - $N=5$, $H=10\\,\\mathrm{m}$, $\\Delta t=60\\,\\mathrm{s}$。\n   - $D(z) = D_0\\left(1+\\alpha\\,\\frac{z}{H}\\right)$，其中 $D_0=10^{-4}\\,\\mathrm{m^2/s}$ 且 $\\alpha=0.5$。\n   - $C(z,t^n) = \\exp\\left(-\\frac{z}{H}\\right)$。\n\n2. 测试用例 2（小网格，边界主导行为）：\n   - $N=2$, $H=10\\,\\mathrm{m}$, $\\Delta t=300\\,\\mathrm{s}$。\n   - $D(z) = D_0$，其中 $D_0=10^{-4}\\,\\mathrm{m^2/s}$。\n   - $C(z,t^n) = \\sin\\left(\\pi\\,\\frac{z}{H}\\right)$，角度以弧度为单位。\n\n3. 测试用例 3（$D$ 存在强间断）：\n   - $N=6$, $H=60\\,\\mathrm{m}$, $\\Delta t=3600\\,\\mathrm{s}$。\n   - $D(z) = \\begin{cases} D_1,  z  20\\,\\mathrm{m} \\\\ D_2,  z \\ge 20\\,\\mathrm{m} \\end{cases}$，其中 $D_1=10^{-5}\\,\\mathrm{m^2/s}$ 且 $D_2=10^{-3}\\,\\mathrm{m^2/s}$。\n   - $C(z,t^n) \\equiv 1$。\n\n- 最终输出格式：您的程序应生成单行输出，其中包含三个测试用例的结果，形式为方括号内以逗号分隔的列表。每个测试用例的结果本身必须是按 $[a,b,c,d]$ 顺序排列的四个列表的列表，其中 $a$、$b$、$c$ 和 $d$ 是该用例的系数列表。例如，整体结构必须如下所示\n$$\n\\big[\\,[a^{(1)},b^{(1)},c^{(1)},d^{(1)}],\\,[a^{(2)},b^{(2)},c^{(2)},d^{(2)}],\\,[a^{(3)},b^{(3)},c^{(3)},d^{(3)}]\\,\\big],\n$$\n所有数值均表示为标准十进制浮点数。程序必须精确打印此单行结构，不得包含任何额外文本。",
            "solution": "该问题要求推导并实现一个三对角线性系统的系数，该系统源于一维垂直扩散方程的隐式有限体积离散化。\n\n标量示踪剂浓度 $C(z, t)$ 的控制方程由下式给出：\n$$\n\\frac{\\partial C}{\\partial t} = \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right)\n$$\n此方程表示示踪剂的守恒，其中浓度的随时间变化率等于扩散通量的散度。通量 $F$ 由菲克定律定义为 $F = -D(z)\\,\\frac{\\partial C}{\\partial z}$。\n\n我们采用有限体积法，在均匀网格上进行计算，该网格有 $N$ 个节点，位于 $z_i = i\\,\\Delta z$ 处，其中 $i \\in \\{0, 1, \\dots, N-1\\}$，$\\Delta z = H/(N-1)$。对于内部节点 $i$，其控制体积（或单元）$\\Omega_i$ 以 $z_i$ 为中心，跨越区间 $[z_{i-1/2}, z_{i+1/2}]$，其中 $z_{i \\pm 1/2} = z_i \\pm \\Delta z/2$。此单元的体积（长度）为 $\\Delta z$。\n\n我们将控制方程在控制体积 $\\Omega_i$ 上积分：\n$$\n\\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial C}{\\partial t} \\, dz = \\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right) \\, dz\n$$\n假设单元内的平均浓度为 $C_i$，则左侧可以近似为：\n$$\n\\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial C}{\\partial t} \\, dz \\approx \\frac{dC_i}{dt} \\Delta z\n$$\n对右侧应用微积分基本定理，得到进入单元的净通量：\n$$\n\\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right) \\, dz = \\left[D(z)\\,\\frac{\\partial C}{\\partial z}\\right]_{z_{i-1/2}}^{z_{i+1/2}} = F_{diff}(z_{i+1/2}) - F_{diff}(z_{i-1/2})\n$$\n其中 $F_{diff}(z) = D(z)\\,\\frac{\\partial C}{\\partial z}$ 是扩散通量。该问题基于菲克定律 $F = -F_{diff}$ 来定义通量，因此我们可以用流出单元的通量来写方程：$F_{i+1/2} - F_{i-1/2}$。\n\n在单元界面 $z_{i+1/2}$ 处的离散通量使用二阶中心差分近似：\n$$\nF_{i+1/2} \\approx -D_{i+1/2} \\frac{C_{i+1} - C_i}{\\Delta z}\n$$\n这里，$D_{i+1/2}$ 是界面处的扩散系数，按规定使用节点扩散系数 $D_i = D(z_i)$ 和 $D_{i+1} = D(z_{i+1})$ 的调和平均计算：\n$$\nD_{i+1/2} = \\frac{2}{\\frac{1}{D_i} + \\frac{1}{D_{i+1}}} = \\frac{2 D_i D_{i+1}}{D_i + D_{i+1}}\n$$\n这种公式确保了通量的连续性，并且对于不连续的扩散系数剖面具有鲁棒性。\n\n综合这些元素，对于内部节点 $i \\in \\{1, \\dots, N-2\\}$ 的半离散方程变为：\n$$\n\\frac{dC_i}{dt} \\Delta z = \\left(D_{i+1/2} \\frac{C_{i+1} - C_i}{\\Delta z}\\right) - \\left(D_{i-1/2} \\frac{C_i - C_{i-1}}{\\Delta z}\\right)\n$$\n$$\n\\frac{dC_i}{dt} = \\frac{1}{(\\Delta z)^2} \\left( D_{i-1/2}C_{i-1} - (D_{i-1/2} + D_{i+1/2})C_i + D_{i+1/2}C_{i+1} \\right)\n$$\n对于时间积分，我们使用后向欧拉格式，这是一种隐式且无条件稳定的格式。时间导数近似为 $\\frac{dC_i}{dt} \\approx \\frac{C_i^{n+1} - C_i^n}{\\Delta t}$，且右侧项在未来的时间层 $n+1$ 上进行计算：\n$$\n\\frac{C_i^{n+1} - C_i^n}{\\Delta t} = \\frac{1}{(\\Delta z)^2} \\left( D_{i-1/2}C_{i-1}^{n+1} - (D_{i-1/2} + D_{i+1/2})C_i^{n+1} + D_{i+1/2}C_{i+1}^{n+1} \\right)\n$$\n为了得到所需的线性系统形式 $a_i C_{i-1}^{n+1} + b_i C_i^{n+1} + c_i C_{i+1}^{n+1} = d_i$，我们重新整理各项。我们定义一个无量纲参数 $\\kappa = \\frac{\\Delta t}{(\\Delta z)^2}$。方程变为：\n$$\nC_i^{n+1} - C_i^n = \\kappa D_{i-1/2}C_{i-1}^{n+1} - \\kappa(D_{i-1/2} + D_{i+1/2})C_i^{n+1} + \\kappa D_{i+1/2}C_{i+1}^{n+1}\n$$\n将所有在时间 $n+1$ 的项移到左侧：\n$$\n(-\\kappa D_{i-1/2})C_{i-1}^{n+1} + (1 + \\kappa(D_{i-1/2} + D_{i+1/2}))C_i^{n+1} + (-\\kappa D_{i+1/2})C_{i+1}^{n+1} = C_i^n\n$$\n由此，我们确定内部节点 $i \\in \\{1, \\dots, N-2\\}$ 的系数：\n- $a_i = -\\kappa D_{i-1/2}$\n- $b_i = 1 + \\kappa (D_{i-1/2} + D_{i+1/2})$\n- $c_i = -\\kappa D_{i+1/2}$\n- $d_i = C_i^n$\n\n接下来，我们应用无通量条件，推导边界节点的方程。\n对于顶部边界节点 $i=0$，守恒定律在控制体积 $[z_{-1/2}, z_{1/2}]$ 上积分。问题指出，物理边界处的通量为零，在此模板中对应于界面 $z_{-1/2}$。因此，$F_{-1/2}=0$。离散方程为：\n$$\n\\frac{dC_0}{dt} \\Delta z = F_{1/2} - F_{-1/2} = F_{1/2} = D_{1/2} \\frac{C_1-C_0}{\\Delta z}\n$$\n$$\n\\frac{dC_0}{dt} = \\frac{D_{1/2}}{(\\Delta z)^2} (C_1-C_0)\n$$\n应用后向欧拉格式：\n$$\n\\frac{C_0^{n+1} - C_0^n}{\\Delta t} = \\frac{D_{1/2}}{(\\Delta z)^2} (C_1^{n+1}-C_0^{n+1})\n$$\n$$\nC_0^{n+1} - C_0^n = \\kappa D_{1/2} (C_1^{n+1}-C_0^{n+1})\n$$\n重新整理得到：\n$$\n(1 + \\kappa D_{1/2})C_0^{n+1} + (-\\kappa D_{1/2})C_1^{n+1} = C_0^n\n$$\n$i=0$ 的系数为：\n- $a_0 = 0$\n- $b_0 = 1 + \\kappa D_{1/2}$\n- $c_0 = -\\kappa D_{1/2}$\n- $d_0 = C_0^n$\n\n对于底部边界节点 $i=N-1$，外部界面 $z_{N-1/2}$ 处的通量为零，即 $F_{N-1/2}=0$。守恒定律变为：\n$$\n\\frac{dC_{N-1}}{dt} \\Delta z = F_{N-1/2} - F_{N-3/2} = -F_{N-3/2} = D_{N-3/2} \\frac{C_{N-1}-C_{N-2}}{\\Delta z}\n$$\n$$\n\\frac{dC_{N-1}}{dt} = \\frac{-D_{N-3/2}}{(\\Delta z)^2} (C_{N-1}-C_{N-2})\n$$\n应用后向欧拉格式：\n$$\n\\frac{C_{N-1}^{n+1} - C_{N-1}^n}{\\Delta t} = \\frac{D_{N-3/2}}{(\\Delta z)^2} (C_{N-2}^{n+1}-C_{N-1}^{n+1})\n$$\n$$\nC_{N-1}^{n+1} - C_{N-1}^n = \\kappa D_{N-3/2} (C_{N-2}^{n+1}-C_{N-1}^{n+1})\n$$\n重新整理得到：\n$$\n(-\\kappa D_{N-3/2}) C_{N-2}^{n+1} + (1 + \\kappa D_{N-3/2})C_{N-1}^{n+1} = C_{N-1}^n\n$$\n$i=N-1$ 的系数为：\n- $a_{N-1} = -\\kappa D_{N-3/2}$\n- $b_{N-1} = 1 + \\kappa D_{N-3/2}$\n- $c_{N-1} = 0$\n- $d_{N-1} = C_{N-1}^n$\n\n这些方程定义了未知示踪剂浓度向量 $\\mathbf{C}^{n+1}$ 的三对角系统。程序实现将为给定的测试用例计算这些系数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_coefficients(N, H, dt, D_func, C_func_n):\n    \"\"\"\n    Computes the tridiagonal system coefficients (a, b, c) and right-hand side (d)\n    for the 1D diffusion equation using a backward Euler implicit scheme.\n    \"\"\"\n    if N  2:\n        # For a single point, diffusion is not well-defined.\n        # Returning trivial system for completeness, though not tested.\n        if N == 1:\n            z = np.array([0.0])\n            d = C_func_n(z).tolist()\n            return [[0.0], [1.0], [0.0], d]\n        return [[], [], [], []]\n\n    # 1. Grid and parameters\n    dz = H / (N - 1)\n    z = np.linspace(0, H, N)\n    kappa = dt / (dz**2)\n\n    # 2. Evaluate D and C at grid nodes\n    D_vals = D_func(z)\n    d = C_func_n(z).tolist()  # The RHS d_i is just C_i^n\n\n    # 3. Calculate interface diffusivities D_{i+1/2} using harmonic mean\n    D_interface = np.zeros(N - 1)\n    for i in range(N - 1):\n        D_i = D_vals[i]\n        D_i_plus_1 = D_vals[i+1]\n        sum_D = D_i + D_i_plus_1\n        # The problem states D_{i+1/2}=0 if D_i=D_{i+1}=0.\n        # This is handled by checking if sum_D > 0, since D is non-negative.\n        if sum_D > 0:\n            D_interface[i] = 2.0 * D_i * D_i_plus_1 / sum_D\n        else:\n            D_interface[i] = 0.0\n\n    # 4. Initialize coefficient arrays\n    a = np.zeros(N)\n    b = np.zeros(N)\n    c = np.zeros(N)\n\n    # 5. Assemble coefficients based on derived formulas\n\n    # Top boundary (i=0)\n    gamma_1_2 = kappa * D_interface[0]\n    a[0] = 0.0\n    b[0] = 1.0 + gamma_1_2\n    c[0] = -gamma_1_2\n\n    # Interior nodes (i=1 to N-2)\n    for i in range(1, N - 1):\n        gamma_i_minus_1_2 = kappa * D_interface[i - 1]\n        gamma_i_plus_1_2 = kappa * D_interface[i]\n        a[i] = -gamma_i_minus_1_2\n        b[i] = 1.0 + gamma_i_minus_1_2 + gamma_i_plus_1_2\n        c[i] = -gamma_i_plus_1_2\n\n    # Bottom boundary (i=N-1)\n    # This check is technically not needed for N>=2 but good practice\n    if N > 1:\n        gamma_N_minus_3_2 = kappa * D_interface[N - 2]\n        a[N-1] = -gamma_N_minus_3_2\n        b[N-1] = 1.0 + gamma_N_minus_3_2\n        c[N-1] = 0.0\n\n    return [a.tolist(), b.tolist(), c.tolist(), d]\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results in the specified format.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: General smoothly varying D\n        {\n            \"N\": 5, \"H\": 10.0, \"dt\": 60.0,\n            \"D_func\": lambda z: 1e-4 * (1.0 + 0.5 * z / 10.0),\n            \"C_func_n\": lambda z: np.exp(-z / 10.0)\n        },\n        # Test Case 2: Small grid, boundary-dominated behavior\n        {\n            \"N\": 2, \"H\": 10.0, \"dt\": 300.0,\n            \"D_func\": lambda z: 1e-4 * np.ones_like(z),\n            \"C_func_n\": lambda z: np.sin(np.pi * z / 10.0)\n        },\n        # Test Case 3: Strong discontinuity in D\n        {\n            \"N\": 6, \"H\": 60.0, \"dt\": 3600.0,\n            \"D_func\": lambda z: np.where(z  20.0, 1e-5, 1e-3),\n            \"C_func_n\": lambda z: np.ones_like(z)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        case_result = compute_coefficients(\n            case[\"N\"], case[\"H\"], case[\"dt\"], case[\"D_func\"], case[\"C_func_n\"]\n        )\n        results.append(case_result)\n\n    # Format the output string exactly as required\n    final_results_str = []\n    for r in results:\n        # Convert each inner list of floats to a string representation\n        a_str = f\"[{','.join(map(str, r[0]))}]\"\n        b_str = f\"[{','.join(map(str, r[1]))}]\"\n        c_str = f\"[{','.join(map(str, r[2]))}]\"\n        d_str = f\"[{','.join(map(str, r[3]))}]\"\n        case_str = f\"[{a_str},{b_str},{c_str},{d_str}]\"\n        final_results_str.append(case_str)\n    \n    print(f\"[{','.join(final_results_str)}]\")\n\nsolve()\n```"
        }
    ]
}