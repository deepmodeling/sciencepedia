{
    "hands_on_practices": [
        {
            "introduction": "在环境和地球系统模型中，许多过程（如快速的化学反应）的特征时间尺度差异巨大，这导致了所谓的“刚性”问题。本练习将通过一个理想化的线性衰减模型，帮助你直观地理解数值刚性以及隐式格式为何是解决此类问题的关键 。通过对一个极其刚性的常微分方程 $y'=\\lambda y$ 应用后向欧拉法，你将亲手验证即便在使用远超显式格式稳定极限的时间步长时，隐式格式依然能保持稳定，并体会其在稳定性和精度之间的权衡。",
            "id": "3885112",
            "problem": "考虑一个单箱环境系统中示踪剂浓度的无量纲线性衰减模型，其理想化形式为常微分方程(ODE) $y'(t)=\\lambda\\,y(t)$，初始条件为 $y(0)=y_{0}$。该ODE源于质量守恒定律，其中包含一个与 $y(t)$ 成正比的线性化汇，$\\lambda  0$ 代表一个恒定的衰减率。设 $\\lambda=-1000$，$y_{0}=1$，时间步长为 $\\Delta t=0.1$。使用一个从单个时间步长上的ODE积分形式推导出的隐式时间积分格式，应用后向欧拉法计算单步数值近似值 $y_{1}\\approx y(\\Delta t)$。\n\n另外，通过变量分离法推导该ODE的精确解 $y(t)$，并计算其在 $t=\\Delta t$ 处的值。定义绝对单步误差为 $E=\\left|y_{1}-y(\\Delta t)\\right|$。将 $E$ 作为一个数值报告，四舍五入到四位有效数字。将答案表示为无量纲量。此计算的目的是将后向欧拉法的结果与精确解进行比较，以说明在环境与地球系统模拟中，刚性问题的绝对稳定性(A-稳定性)与准确性之间的权衡。",
            "solution": "首先对问题进行验证，以确保其科学依据充分、适定且客观。\n\n### 步骤1：提取已知条件\n- 常微分方程 (ODE): $y'(t)=\\lambda\\,y(t)$\n- 初始条件: $y(0)=y_{0}$\n- 衰减率常数: $\\lambda=-1000$\n- 初始值: $y_{0}=1$\n- 时间步长: $\\Delta t=0.1$\n- 数值方法: 后向欧拉法\n- 待计算量: 单步数值近似 $y_{1}\\approx y(\\Delta t)$\n- 精确解: 待推导的 $y(t)$。\n- 误差定义: 绝对单步误差 $E=\\left|y_{1}-y(\\Delta t)\\right|$\n- 最终输出要求: 报告 $E$，四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题描述了一个标准的一阶线性齐次常微分方程初值问题(IVP)，这是科学与工程领域中指数衰减过程的一个基本模型。所提供的参数($\\lambda=-1000$, $\\Delta t=0.1$)定义了一个数值刚性问题，这是测试和说明像后向欧拉法这类隐式时间积分格式性质的常见且有意义的场景。该问题是自洽的，提供了所有必要的数据。语言精确、客观。没有科学或事实上的不健全、矛盾或歧义。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 使用后向欧拉法推导数值解\n给定的ODE为 $y'(t) = \\lambda y(t)$。后向欧拉法是一种求解ODE的隐式单步数值方法。对于形式为 $y'(t) = f(t,y)$ 的ODE，将解从时间 $t_n$ 推进到 $t_{n+1} = t_n + \\Delta t$ 的通用公式为：\n$$y_{n+1} = y_n + \\Delta t \\, f(t_{n+1}, y_{n+1})$$\n在此问题中，函数 $f(t,y)$ 由 $f(t,y) = \\lambda y(t)$ 给出。将其代入后向欧拉公式可得：\n$$y_{n+1} = y_n + \\Delta t (\\lambda y_{n+1})$$\n由于这是一种隐式方法，我们必须求解未知数 $y_{n+1}$：\n$$y_{n+1} - \\lambda \\Delta t y_{n+1} = y_n$$\n$$y_{n+1} (1 - \\lambda \\Delta t) = y_n$$\n$$y_{n+1} = \\frac{y_n}{1 - \\lambda \\Delta t}$$\n我们需要从 $t_0=0$ 处的初始条件 $y_0$ 开始，计算第一步 $y_1$。令 $n=0$：\n$$y_1 = \\frac{y_0}{1 - \\lambda \\Delta t}$$\n问题提供了值 $y_0=1$，$\\lambda=-1000$ 和 $\\Delta t=0.1$。将这些值代入 $y_1$ 的方程：\n$$y_1 = \\frac{1}{1 - (-1000)(0.1)} = \\frac{1}{1 - (-100)} = \\frac{1}{1+100} = \\frac{1}{101}$$\n\n### 推导精确解\nODE $y'(t) = \\lambda y(t)$ 可以写成 $\\frac{dy}{dt} = \\lambda y$。这是一个可分离的微分方程。我们可以分离变量 $y$ 和 $t$：\n$$\\frac{dy}{y} = \\lambda \\, dt$$\n对该方程两边积分：\n$$\\int \\frac{1}{y} \\, dy = \\int \\lambda \\, dt$$\n$$\\ln|y| = \\lambda t + C$$\n其中 $C$ 是积分常数。为了解出 $y$，我们对两边取指数：\n$$|y| = \\exp(\\lambda t + C) = \\exp(C) \\exp(\\lambda t)$$\n令 $A = \\pm\\exp(C)$，我们得到通解：\n$$y(t) = A \\exp(\\lambda t)$$\n为了求特解，我们应用初始条件 $y(0)=y_0$：\n$$y(0) = A \\exp(\\lambda \\cdot 0) = A \\exp(0) = A \\cdot 1 = A$$\n因此，积分常数是 $A=y_0$。该初值问题的精确解是：\n$$y(t) = y_0 \\exp(\\lambda t)$$\n代入给定的值 $y_0=1$ 和 $\\lambda=-1000$：\n$$y(t) = 1 \\cdot \\exp(-1000t) = \\exp(-1000t)$$\n我们需要计算这个精确解在时间 $t=\\Delta t=0.1$ 处的值：\n$$y(\\Delta t) = y(0.1) = \\exp(-1000 \\cdot 0.1) = \\exp(-100)$$\n\n### 计算绝对误差\n绝对单步误差 $E$ 定义为 $E = |y_1 - y(\\Delta t)|$。代入我们求得的数值解和精确解：\n$$E = \\left| \\frac{1}{101} - \\exp(-100) \\right|$$\n现在，我们计算数值。\n$y_1 = \\frac{1}{101} \\approx 0.009900990099...$\n$y(\\Delta t) = \\exp(-100)$ 的值是一个极小的正数。使用计算器可得 $\\exp(-100) \\approx 3.72 \\times 10^{-44}$。\n误差为：\n$$E \\approx |0.009900990099 - 3.72 \\times 10^{-44}|$$\n项 $\\exp(-100)$ 比 $\\frac{1}{101}$ 小很多个数量级，其对误差的贡献对于所要求的精度来说可以忽略不计。因此，误差实际上等于 $y_1$：\n$$E \\approx \\frac{1}{101} \\approx 0.009900990099...$$\n问题要求将结果四舍五入到四位有效数字。\n$E$ 的第一个非零数字是千分位的 $9$。前四位有效数字是 $9$、$9$、$0$、$0$。第五位有效数字是 $9$。由于 $9 \\ge 5$，我们将第四位有效数字向上取整。\n所以，将数值 $0.00990099...$ 四舍五入到四位有效数字得到 $0.009901$。",
            "answer": "$$\\boxed{0.009901}$$"
        },
        {
            "introduction": "理解了隐式格式的稳定性后，下一个关键问题是如何在不同的隐式格式之间进行选择。本练习将引导你比较两种广泛使用的格式——后向欧拉（Backward Euler, BE）法和 Crank–Nicolson（CN）法——在处理刚性问题时的数值阻尼特性 。通过分析它们在刚性极限 $\\alpha \\Delta t \\gg 1$ 下的放大因子，你将发现并非所有稳定格式都具有相同的性质，这对模型的长期积分和能量保持行为有着深远影响。",
            "id": "3885086",
            "problem": "在环境和地球系统模拟中的大气化学领域，一个常见的次网格化学过程是物种浓度向平衡值的线性弛豫。考虑表示化学弛豫的自治常微分方程 (ODE)，\n$$\n\\frac{d y}{d t} \\;=\\; -\\alpha \\big(y - y^{\\ast}\\big),\n$$\n其中 $\\alpha  0$ 是一个恒定的弛豫率，$y^{\\ast}$ 是一个恒定的化学平衡值。设 $\\Delta t  0$ 为一个恒定的时间步长。定义偏差变量 $u(t) = y(t) - y^{\\ast}$，使该 ODE 变为\n$$\n\\frac{d u}{d t} \\;=\\; -\\alpha u.\n$$\n在刚性过程算子中广泛使用的两种标准隐式单步时间积分格式是向后欧拉 (BE) 方法和克兰克-尼科尔森 (CN) 方法。将这些方法应用于偏差方程，推导形如 $u_{n+1} = R(z)\\,u_{n}$ 的单步更新，其中 $z = -\\alpha \\Delta t$，并计算每种格式的放大（稳定性）函数 $|R(-\\alpha \\Delta t)|$ 的模。然后，在刚性极限 $\\alpha \\Delta t \\gg 1$ 下，确定这些模的渐近值。将你的最终答案表示为一个行矩阵，其中包含按 $\\big($向后欧拉, 克兰克-尼科尔森$\\big)$ 顺序排列的两个渐近模，并且不包含单位。无需四舍五入。",
            "solution": "该问题要求分析用于线性弛豫常微分方程 (ODE) 的两种隐式时间积分格式：向后欧拉 (BE) 法和克兰克-尼科尔森 (CN) 法。目标是在刚性极限下（即弛豫率 $\\alpha$ 和时间步长 $\\Delta t$ 的乘积很大时）求出每种格式的放大函数的渐近模。\n\n偏差变量 $u(t) = y(t) - y^{\\ast}$ 的控制 ODE 由下式给出：\n$$\n\\frac{d u}{d t} = -\\alpha u\n$$\n这是一个标准线性测试方程，形式为 $\\frac{du}{dt} = \\lambda u$，其中 $\\lambda = -\\alpha$。我们需要找到形如 $u_{n+1} = R(-\\alpha \\Delta t) u_n$ 的单步更新，其中 $R$ 是放大或稳定性函数。\n\n首先，我们来分析向后欧拉 (BE) 格式。BE 方法是一种单步隐式格式，定义如下：\n$$\nu_{n+1} = u_n + \\Delta t \\left( \\frac{d u}{d t} \\right)_{n+1}\n$$\n代入在未来时间步 $n+1$ 处求值的给定 ODE $\\frac{du}{dt} = -\\alpha u$：\n$$\nu_{n+1} = u_n + \\Delta t (-\\alpha u_{n+1})\n$$\n现在我们必须解此方程求出 $u_{n+1}$，以确定放大因子。\n$$\nu_{n+1} + \\alpha \\Delta t u_{n+1} = u_n\n$$\n$$\nu_{n+1} (1 + \\alpha \\Delta t) = u_n\n$$\n$$\nu_{n+1} = \\frac{1}{1 + \\alpha \\Delta t} u_n\n$$\n从这个表达式中，我们可以识别出 BE 格式的放大函数 $R_{BE}(-\\alpha \\Delta t)$ 为：\n$$\nR_{BE}(-\\alpha \\Delta t) = \\frac{1}{1 + \\alpha \\Delta t}\n$$\n问题要求此函数的模。由于 $\\alpha  0$ 且 $\\Delta t  0$，乘积 $\\alpha \\Delta t$ 是一个正实数。因此，分母 $1 + \\alpha \\Delta t$ 总是大于 $1$。所以其模为：\n$$\n|R_{BE}(-\\alpha \\Delta t)| = \\left| \\frac{1}{1 + \\alpha \\Delta t} \\right| = \\frac{1}{1 + \\alpha \\Delta t}\n$$\n在刚性极限 $\\alpha \\Delta t \\gg 1$ 下，我们计算当 $\\alpha \\Delta t \\to \\infty$ 时此模的极限：\n$$\n\\lim_{\\alpha \\Delta t \\to \\infty} |R_{BE}(-\\alpha \\Delta t)| = \\lim_{\\alpha \\Delta t \\to \\infty} \\frac{1}{1 + \\alpha \\Delta t} = 0\n$$\n向后欧拉格式的渐近模为 $0$。\n\n接下来，我们分析克兰克-尼科尔森 (CN) 格式。CN 方法是一种单步隐式格式，它对当前和未来时间步的导数进行平均：\n$$\nu_{n+1} = u_n + \\frac{\\Delta t}{2} \\left[ \\left( \\frac{d u}{d t} \\right)_{n} + \\left( \\frac{d u}{d t} \\right)_{n+1} \\right]\n$$\n代入 ODE $\\frac{du}{dt} = -\\alpha u$：\n$$\nu_{n+1} = u_n + \\frac{\\Delta t}{2} [ (-\\alpha u_n) + (-\\alpha u_{n+1}) ]\n$$\n现在，我们求解 $u_{n+1}$：\n$$\nu_{n+1} = u_n - \\frac{\\alpha \\Delta t}{2} u_n - \\frac{\\alpha \\Delta t}{2} u_{n+1}\n$$\n$$\nu_{n+1} + \\frac{\\alpha \\Delta t}{2} u_{n+1} = u_n - \\frac{\\alpha \\Delta t}{2} u_n\n$$\n$$\nu_{n+1} \\left( 1 + \\frac{\\alpha \\Delta t}{2} \\right) = u_n \\left( 1 - \\frac{\\alpha \\Delta t}{2} \\right)\n$$\n$$\nu_{n+1} = \\frac{1 - \\frac{\\alpha \\Delta t}{2}}{1 + \\frac{\\alpha \\Delta t}{2}} u_n\n$$\nCN 格式的放大函数 $R_{CN}(-\\alpha \\Delta t)$ 是：\n$$\nR_{CN}(-\\alpha \\Delta t) = \\frac{1 - \\frac{\\alpha \\Delta t}{2}}{1 + \\frac{\\alpha \\Delta t}{2}}\n$$\n此函数的模为：\n$$\n|R_{CN}(-\\alpha \\Delta t)| = \\left| \\frac{1 - \\frac{\\alpha \\Delta t}{2}}{1 + \\frac{\\alpha \\Delta t}{2}} \\right|\n$$\n同样，由于 $\\alpha \\Delta t  0$，分母 $1 + \\frac{\\alpha \\Delta t}{2}$ 总是正的。其模由比值的绝对值确定。在刚性极限 $\\alpha \\Delta t \\gg 1$ 下，我们计算当 $\\alpha \\Delta t \\to \\infty$ 时此模的极限。为了计算这个极限，我们可以将分子和分母同除以 $\\alpha \\Delta t$：\n$$\n\\lim_{\\alpha \\Delta t \\to \\infty} |R_{CN}(-\\alpha \\Delta t)| = \\lim_{\\alpha \\Delta t \\to \\infty} \\left| \\frac{\\frac{2}{\\alpha \\Delta t} - 1}{\\frac{2}{\\alpha \\Delta t} + 1} \\right|\n$$\n当 $\\alpha \\Delta t \\to \\infty$ 时，项 $\\frac{2}{\\alpha \\Delta t} \\to 0$。因此，极限变为：\n$$\n\\left| \\frac{0 - 1}{0 + 1} \\right| = |-1| = 1\n$$\n克兰克-尼科尔森格式的渐近模为 $1$。\n\n最终答案是一个行矩阵，按顺序包含向后欧拉和克兰克-尼科尔森格式的渐近模。这两个值分别为 $0$ 和 $1$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "前面的练习集中于单个常微分方程，但在实际的地球系统模型中，我们通常处理的是偏微分方程（Partial Differential Equation, PDE）。当对 PDE 的空间维度进行离散化后，我们得到一个大型的耦合常微分方程组。本练习将带你从理论走向实践，为一个典型的一维海洋垂向扩散问题构建隐式求解器的核心部分 。你将学习如何处理变化的扩散系数和无通量边界条件，并最终组装求解所需的线性方程组，这是将隐式积分方案应用于真实空间模型的关键一步。",
            "id": "3885094",
            "problem": "你的任务是设计并实现一个采用隐式时间积分方案的一维海洋柱扩散步骤。考虑一个标量示踪剂场 $C(z,t)$，在没有平流和源项的情况下，其受 Fickian 输运下的垂直扩散控制。域为 $z \\in [0,H]$，其中 $z$ 向下递增。质量守恒定律与 Fickian 扩散相结合，得到控制方程\n$$\n\\frac{\\partial C}{\\partial t} = \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right),\n$$\n其中 $D(z)$ 是垂直扩散系数，单位为 $\\mathrm{m^2/s}$。边界条件是物理上一致的表面和底部零通量条件，\n$$\nD(0)\\,\\frac{\\partial C}{\\partial z}(0,t)=0, \\quad D(H)\\,\\frac{\\partial C}{\\partial z}(H,t)=0.\n$$\n时间离散化使用后向欧拉隐式时间积分方案，空间离散化在均匀节点网格上使用二阶守恒有限体积法。设有 $N$ 个节点，位于 $z_i = i\\,\\Delta z$ 处，其中 $i \\in \\{0,1,\\dots,N-1\\}$，$\\Delta z = H/(N-1)$，单位为 $\\mathrm{m}$。用上标 $n$ 和 $n+1$ 表示时间层，对应于时间 $t^n$ 和 $t^{n+1}=t^n+\\Delta t$，其中 $\\Delta t$ 的单位为 $\\mathrm{s}$。穿过界面 $z_{i+1/2} = z_i + \\Delta z/2$ 的离散通量应使用界面扩散系数 $D_{i+1/2}$ 计算，该系数通过相邻单元中心值 $D_i = D(z_i)$ 和 $D_{i+1} = D(z_{i+1})$ 的调和平均得到，即\n$$\nD_{i+1/2} = \\frac{2}{\\frac{1}{D_i} + \\frac{1}{D_{i+1}}}\n$$\n并约定如果 $D_i=D_{i+1}=0$，则 $D_{i+1/2}=0$。零通量边界条件意味着在 $z_{-1/2}$ 和 $z_{N-1/2}$ 处的通量为零，并且边界处的离散散度必须进行相应调整。\n\n你的目标是：\n- 从守恒定律和后向欧拉离散化出发，推导出在每个时间步为未知向量 $\\mathbf{C}^{n+1} = \\left(C_0^{n+1},C_1^{n+1},\\dots,C_{N-1}^{n+1}\\right)^\\top$ 所获得的三对角线性系统。将该系统表示为以下形式\n$$\na_i\\,C_{i-1}^{n+1} + b_i\\,C_i^{n+1} + c_i\\,C_{i+1}^{n+1} = d_i,\n$$\n对于 $i \\in \\{0,1,\\dots,N-1\\}$，由于零通量边界条件，在 $i=0$ 和 $i=N-1$ 处需进行适当修改。这里，$a_i$、$b_i$、$c_i$ 分别是下对角线、主对角线和上对角线系数，$d_i$ 是右端项。\n- 实现一个完整的、可运行的程序，给定 $N$、$H$、$\\Delta t$、扩散系数函数 $D(z)$ 和初始示踪剂剖面函数 $C(z,t^n)$，计算并返回隐式步骤的系数数组 $\\{a_i\\}$、$\\{b_i\\}$、$\\{c_i\\}$ 和右端项 $\\{d_i\\}$。你的网格必须使用 $z_i = i\\,\\Delta z$ 和 $\\Delta z = H/(N-1)$。\n- 按规定对 $D_{i+1/2}$ 使用调和平均。通过将边界通量 $z_{-1/2}$ 和 $z_{N-1/2}$ 处的值设为零来处理零通量边界条件。\n\n物理单位和格式要求：\n- $H$ 必须以 $\\mathrm{m}$ 为单位指定，$\\Delta z$ 以 $\\mathrm{m}$ 为单位计算，$\\Delta t$ 以 $\\mathrm{s}$ 为单位指定，$D$ 以 $\\mathrm{m^2/s}$ 为单位。在本问题中，示踪剂 $C$ 是无量纲的。\n- 如果使用任何三角函数，角度必须以弧度为单位。\n- 你的程序必须仅输出一行，其中包含所有测试用例的汇总结果，格式如下所述。\n\n测试套件和最终输出规范：\n- 实现以下三个测试用例。对于每个用例，按顺序计算并返回与 $\\{a_i\\}$、$\\{b_i\\}$、$\\{c_i\\}$ 和 $\\{d_i\\}$ 对应的四个列表。\n\n1. 测试用例 $1$（一般平滑变化的 $D$）：\n   - $N=5$，$H=10\\,\\mathrm{m}$，$\\Delta t=60\\,\\mathrm{s}$。\n   - $D(z) = D_0\\left(1+\\alpha\\,\\frac{z}{H}\\right)$，其中 $D_0=10^{-4}\\,\\mathrm{m^2/s}$，$\\alpha=0.5$。\n   - $C(z,t^n) = \\exp\\left(-\\frac{z}{H}\\right)$。\n\n2. 测试用例 $2$（小网格，边界主导行为）：\n   - $N=2$，$H=10\\,\\mathrm{m}$，$\\Delta t=300\\,\\mathrm{s}$。\n   - $D(z) = D_0$，其中 $D_0=10^{-4}\\,\\mathrm{m^2/s}$。\n   - $C(z,t^n) = \\sin\\left(\\pi\\,\\frac{z}{H}\\right)$，角度以弧度为单位。\n\n3. 测试用例 $3$（$D$ 中的强不连续性）：\n   - $N=6$，$H=60\\,\\mathrm{m}$，$\\Delta t=3600\\,\\mathrm{s}$。\n   - $D(z) = \\begin{cases}D_1,  z  20\\,\\mathrm{m} \\\\ D_2,  z \\ge 20\\,\\mathrm{m}\\end{cases}$，其中 $D_1=10^{-5}\\,\\mathrm{m^2/s}$，$D_2=10^{-3}\\,\\mathrm{m^2/s}$。\n   - $C(z,t^n) \\equiv 1$。\n\n- 最终输出格式：你的程序应生成单行输出，其中包含三个测试用例的结果，形式为用方括号括起来的逗号分隔列表。每个测试用例的结果本身必须是四个列表的列表，顺序为 $[a,b,c,d]$，其中 $a$、$b$、$c$ 和 $d$ 是该用例的系数列表。例如，总体结构必须是以下形式\n$$\n\\big[\\,[a^{(1)},b^{(1)},c^{(1)},d^{(1)}],\\,[a^{(2)},b^{(2)},c^{(2)},d^{(2)}],\\,[a^{(3)},b^{(3)},c^{(3)},d^{(3)}]\\,\\big],\n$$\n所有数值均表示为标准十进制浮点数。程序必须精确打印此单行结构，不得包含任何附加文本。",
            "solution": "该问题要求推导和实现由一维垂直扩散方程的隐式有限体积离散化所产生的三对角线性系统的系数。\n\n标量示踪剂 $C(z, t)$ 浓度的控制方程由下式给出：\n$$\n\\frac{\\partial C}{\\partial t} = \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right)\n$$\n该方程表示示踪剂的守恒，其中浓度的时间变化率等于扩散通量的散度。通量 $F$ 由 Fick 定律定义为 $F = -D(z)\\,\\frac{\\partial C}{\\partial z}$。\n\n我们在均匀网格上采用有限体积法，该网格有 $N$ 个节点，位于 $z_i = i\\,\\Delta z$ 处，其中 $i \\in \\{0, 1, \\dots, N-1\\}$，$\\Delta z = H/(N-1)$。对于内部节点 $i$，其控制体积（或单元）$\\Omega_i$ 以 $z_i$ 为中心，跨越区间 $[z_{i-1/2}, z_{i+1/2}]$，其中 $z_{i \\pm 1/2} = z_i \\pm \\Delta z/2$。该单元的体积（长度）为 $\\Delta z$。\n\n我们将控制方程在控制体积 $\\Omega_i$ 上积分：\n$$\n\\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial C}{\\partial t} \\, dz = \\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right) \\, dz\n$$\n假设单元内的平均浓度为 $C_i$，则左侧可近似为：\n$$\n\\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial C}{\\partial t} \\, dz \\approx \\frac{dC_i}{dt} \\Delta z\n$$\n对右侧应用微积分基本定理，得到进入单元的净通量：\n$$\n\\int_{z_{i-1/2}}^{z_{i+1/2}} \\frac{\\partial}{\\partial z}\\left(D(z)\\,\\frac{\\partial C}{\\partial z}\\right) \\, dz = \\left[D(z)\\,\\frac{\\partial C}{\\partial z}\\right]_{z_{i-1/2}}^{z_{i+1/2}} = F_{diff}(z_{i+1/2}) - F_{diff}(z_{i-1/2})\n$$\n其中 $F_{diff}(z) = D(z)\\,\\frac{\\partial C}{\\partial z}$ 是扩散通量。问题根据 Fick 定律 $F = -F_{diff}$ 定义通量，因此我们可以用流出单元的通量来表示方程：$F_{i+1/2} - F_{i-1/2}$。\n\n单元界面 $z_{i+1/2}$ 处的离散通量使用二阶中心差分近似为：\n$$\nF_{i+1/2} \\approx -D_{i+1/2} \\frac{C_{i+1} - C_i}{\\Delta z}\n$$\n此处，$D_{i+1/2}$ 是界面处的扩散系数，按规定通过节点扩散系数 $D_i = D(z_i)$ 和 $D_{i+1} = D(z_{i+1})$ 的调和平均计算：\n$$\nD_{i+1/2} = \\frac{2}{\\frac{1}{D_i} + \\frac{1}{D_{i+1}}} = \\frac{2 D_i D_{i+1}}{D_i + D_{i+1}}\n$$\n这种公式确保了通量连续性，并且对于不连续的扩散系数剖面是稳健的。\n\n结合这些要素，对于内部节点 $i \\in \\{1, \\dots, N-2\\}$ 的半离散方程变为：\n$$\n\\frac{dC_i}{dt} \\Delta z = \\left(D_{i+1/2} \\frac{C_{i+1} - C_i}{\\Delta z}\\right) - \\left(D_{i-1/2} \\frac{C_i - C_{i-1}}{\\Delta z}\\right)\n$$\n$$\n\\frac{dC_i}{dt} = \\frac{1}{(\\Delta z)^2} \\left( D_{i-1/2}C_{i-1} - (D_{i-1/2} + D_{i+1/2})C_i + D_{i+1/2}C_{i+1} \\right)\n$$\n对于时间积分，我们使用后向欧拉方案，该方案是隐式的且无条件稳定。时间导数近似为 $\\frac{dC_i}{dt} \\approx \\frac{C_i^{n+1} - C_i^n}{\\Delta t}$，右端项在未来的时间层 $n+1$ 上进行计算：\n$$\n\\frac{C_i^{n+1} - C_i^n}{\\Delta t} = \\frac{1}{(\\Delta z)^2} \\left( D_{i-1/2}C_{i-1}^{n+1} - (D_{i-1/2} + D_{i+1/2})C_i^{n+1} + D_{i+1/2}C_{i+1}^{n+1} \\right)\n$$\n为了得到所需的线性系统形式 $a_i C_{i-1}^{n+1} + b_i C_i^{n+1} + c_i C_{i+1}^{n+1} = d_i$，我们重新整理各项。我们定义一个无量纲参数 $\\kappa = \\frac{\\Delta t}{(\\Delta z)^2}$。方程变为：\n$$\nC_i^{n+1} - C_i^n = \\kappa D_{i-1/2}C_{i-1}^{n+1} - \\kappa(D_{i-1/2} + D_{i+1/2})C_i^{n+1} + \\kappa D_{i+1/2}C_{i+1}^{n+1}\n$$\n将时间 $n+1$ 的所有项移到左侧：\n$$\n(-\\kappa D_{i-1/2})C_{i-1}^{n+1} + (1 + \\kappa(D_{i-1/2} + D_{i+1/2}))C_i^{n+1} + (-\\kappa D_{i+1/2})C_{i+1}^{n+1} = C_i^n\n$$\n由此，我们确定内部节点 $i \\in \\{1, \\dots, N-2\\}$ 的系数：\n- $a_i = -\\kappa D_{i-1/2}$\n- $b_i = 1 + \\kappa (D_{i-1/2} + D_{i+1/2})$\n- $c_i = -\\kappa D_{i+1/2}$\n- $d_i = C_i^n$\n\n接下来，我们应用零通量条件，推导边界节点的方程。\n对于顶部边界节点 $i=0$，守恒定律在控制体积 $[z_{-1/2}, z_{1/2}]$ 上积分。问题指出，物理边界处的通量为零，在此模板中对应于界面 $z_{-1/2}$。因此，$F_{-1/2}=0$。离散方程为：\n$$\n\\frac{dC_0}{dt} \\Delta z = F_{1/2} - F_{-1/2} = F_{1/2} = D_{1/2} \\frac{C_1-C_0}{\\Delta z}\n$$\n$$\n\\frac{dC_0}{dt} = \\frac{D_{1/2}}{(\\Delta z)^2} (C_1-C_0)\n$$\n应用后向欧拉方案：\n$$\n\\frac{C_0^{n+1} - C_0^n}{\\Delta t} = \\frac{D_{1/2}}{(\\Delta z)^2} (C_1^{n+1}-C_0^{n+1})\n$$\n$$\nC_0^{n+1} - C_0^n = \\kappa D_{1/2} (C_1^{n+1}-C_0^{n+1})\n$$\n重新整理得到：\n$$\n(1 + \\kappa D_{1/2})C_0^{n+1} + (-\\kappa D_{1/2})C_1^{n+1} = C_0^n\n$$\n$i=0$ 的系数为：\n- $a_0 = 0$\n- $b_0 = 1 + \\kappa D_{1/2}$\n- $c_0 = -\\kappa D_{1/2}$\n- $d_0 = C_0^n$\n\n对于底部边界节点 $i=N-1$，外部界面 $z_{N-1/2}$ 处的通量为零，即 $F_{N-1/2}=0$。守恒定律变为：\n$$\n\\frac{dC_{N-1}}{dt} \\Delta z = F_{N-1/2} - F_{N-3/2} = -F_{N-3/2} = D_{N-3/2} \\frac{C_{N-1}-C_{N-2}}{\\Delta z}\n$$\n$$\n\\frac{dC_{N-1}}{dt} = \\frac{-D_{N-3/2}}{(\\Delta z)^2} (C_{N-1}-C_{N-2})\n$$\n应用后向欧拉方案：\n$$\n\\frac{C_{N-1}^{n+1} - C_{N-1}^n}{\\Delta t} = \\frac{D_{N-3/2}}{(\\Delta z)^2} (C_{N-2}^{n+1}-C_{N-1}^{n+1})\n$$\n$$\nC_{N-1}^{n+1} - C_{N-1}^n = \\kappa D_{N-3/2} (C_{N-2}^{n+1}-C_{N-1}^{n+1})\n$$\n重新整理得到：\n$$\n(-\\kappa D_{N-3/2}) C_{N-2}^{n+1} + (1 + \\kappa D_{N-3/2})C_{N-1}^{n+1} = C_{N-1}^n\n$$\n$i=N-1$ 的系数为：\n- $a_{N-1} = -\\kappa D_{N-3/2}$\n- $b_{N-1} = 1 + \\kappa D_{N-3/2}$\n- $c_{N-1} = 0$\n- $d_{N-1} = C_{N-1}^n$\n\n这些方程为未知的示踪剂浓度向量 $\\mathbf{C}^{n+1}$ 定义了三对角系统。实现部分将为给定的测试用例计算这些系数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_coefficients(N, H, dt, D_func, C_func_n):\n    \"\"\"\n    Computes the tridiagonal system coefficients (a, b, c) and right-hand side (d)\n    for the 1D diffusion equation using a backward Euler implicit scheme.\n    \"\"\"\n    if N  2:\n        # For a single point, diffusion is not well-defined.\n        # Returning trivial system for completeness, though not tested.\n        if N == 1:\n            z = np.array([0.0])\n            d = C_func_n(z).tolist()\n            return [[0.0], [1.0], [0.0], d]\n        return [[], [], [], []]\n\n    # 1. Grid and parameters\n    dz = H / (N - 1)\n    z = np.linspace(0, H, N)\n    kappa = dt / (dz**2)\n\n    # 2. Evaluate D and C at grid nodes\n    D_vals = D_func(z)\n    d = C_func_n(z).tolist()  # The RHS d_i is just C_i^n\n\n    # 3. Calculate interface diffusivities D_{i+1/2} using harmonic mean\n    D_interface = np.zeros(N - 1)\n    for i in range(N - 1):\n        D_i = D_vals[i]\n        D_i_plus_1 = D_vals[i+1]\n        sum_D = D_i + D_i_plus_1\n        # The problem states D_{i+1/2}=0 if D_i=D_{i+1}=0.\n        # This is handled by checking if sum_D > 0, since D is non-negative.\n        if sum_D > 0:\n            D_interface[i] = 2.0 * D_i * D_i_plus_1 / sum_D\n        else:\n            D_interface[i] = 0.0\n\n    # 4. Initialize coefficient arrays\n    a = np.zeros(N)\n    b = np.zeros(N)\n    c = np.zeros(N)\n\n    # 5. Assemble coefficients based on derived formulas\n\n    # Top boundary (i=0)\n    gamma_1_2 = kappa * D_interface[0]\n    a[0] = 0.0\n    b[0] = 1.0 + gamma_1_2\n    c[0] = -gamma_1_2\n\n    # Interior nodes (i=1 to N-2)\n    for i in range(1, N - 1):\n        gamma_i_minus_1_2 = kappa * D_interface[i - 1]\n        gamma_i_plus_1_2 = kappa * D_interface[i]\n        a[i] = -gamma_i_minus_1_2\n        b[i] = 1.0 + gamma_i_minus_1_2 + gamma_i_plus_1_2\n        c[i] = -gamma_i_plus_1_2\n\n    # Bottom boundary (i=N-1)\n    # This check is technically not needed for N>=2 but good practice\n    if N > 1:\n        gamma_N_minus_3_2 = kappa * D_interface[N - 2]\n        a[N-1] = -gamma_N_minus_3_2\n        b[N-1] = 1.0 + gamma_N_minus_3_2\n        c[N-1] = 0.0\n\n    return [a.tolist(), b.tolist(), c.tolist(), d]\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results in the specified format.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: General smoothly varying D\n        {\n            \"N\": 5, \"H\": 10.0, \"dt\": 60.0,\n            \"D_func\": lambda z: 1e-4 * (1.0 + 0.5 * z / 10.0),\n            \"C_func_n\": lambda z: np.exp(-z / 10.0)\n        },\n        # Test Case 2: Small grid, boundary-dominated behavior\n        {\n            \"N\": 2, \"H\": 10.0, \"dt\": 300.0,\n            \"D_func\": lambda z: 1e-4 * np.ones_like(z),\n            \"C_func_n\": lambda z: np.sin(np.pi * z / 10.0)\n        },\n        # Test Case 3: Strong discontinuity in D\n        {\n            \"N\": 6, \"H\": 60.0, \"dt\": 3600.0,\n            \"D_func\": lambda z: np.where(z  20.0, 1e-5, 1e-3),\n            \"C_func_n\": lambda z: np.ones_like(z)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        case_result = compute_coefficients(\n            case[\"N\"], case[\"H\"], case[\"dt\"], case[\"D_func\"], case[\"C_func_n\"]\n        )\n        results.append(case_result)\n\n    # Format the output string exactly as required\n    results_str = ', '.join([str(r) for r in results])\n    # The str() on a list of lists already produces the inner bracket structure.\n    # The replacement is to ensure no newlines and conform to the problem's example style.\n    results_str_oneline = results_str.replace('\\n', '').replace(' ', '')\n    final_output = f\"[{results_str_oneline}]\".replace(\"],[\", \"],[\")\n    \n    # Final print statement must produce single-line output\n    # An alternative, more direct construction:\n    final_results_str = []\n    for r in results:\n        # Convert each inner list of floats to a string representation\n        a_str = f\"[{','.join(map(str, r[0]))}]\"\n        b_str = f\"[{','.join(map(str, r[1]))}]\"\n        c_str = f\"[{','.join(map(str, r[2]))}]\"\n        d_str = f\"[{','.join(map(str, r[3]))}]\"\n        case_str = f\"[{a_str},{b_str},{c_str},{d_str}]\"\n        final_results_str.append(case_str)\n    \n    print(f\"[{','.join(final_results_str)}]\")\n\nsolve()\n```"
        }
    ]
}