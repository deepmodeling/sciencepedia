{
    "hands_on_practices": [
        {
            "introduction": "The linear advection equation is a cornerstone for modeling the transport of tracers, heat, and momentum in the atmosphere and oceans. To solve it numerically, we must ensure our chosen scheme is stable, preventing the growth of unphysical errors. This exercise guides you through a von Neumann stability analysis, a powerful Fourier-based technique to derive the precise conditions under which an explicit scheme, like the first-order upwind method, will remain stable.",
            "id": "3950212",
            "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ with constant advection speed $a  0$, which serves as a canonical transport model in Computational Fluid Dynamics (CFD). The domain is taken to be either periodic or infinite, and the spatial grid is uniform with nodes $x_{j} = j\\,\\Delta x$ for integer $j$ and time levels $t^{n} = n\\,\\Delta t$ for integer $n$. Define the Courant–Friedrichs–Lewy (CFL) number $\\nu = a\\,\\Delta t/\\Delta x$. Discretize the equation with a first-order upwind spatial difference (appropriate for $a0$) and a forward-Euler time integration, forming the explicit scheme that updates $u_{j}^{n}$ to $u_{j}^{n+1}$. Starting from the linear advection model and the definitions of the forward difference in time and the upwind difference in space, perform a von Neumann (Fourier) stability analysis by substituting a single Fourier mode $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$, where $i = \\sqrt{-1}$ and $\\theta$ is the nondimensional wavenumber. Derive the amplification factor $G(\\theta)$ defined by $\\hat{u}^{n+1} = G(\\theta)\\,\\hat{u}^{n}$, and determine the largest admissible value of the CFL number $\\nu$ such that the scheme is stable for all $\\theta$. Your final answer must consist of the closed-form expression for $G(\\theta)$ and the single number giving the largest admissible $\\nu$, in that order. No rounding is required.",
            "solution": "The problem statement is evaluated and found to be valid. It is a scientifically grounded, well-posed, and objective problem from the field of computational fluid dynamics, specifically concerning the stability analysis of a numerical scheme. All necessary information is provided, and there are no contradictions or ambiguities.\n\nThe given partial differential equation (PDE) is the one-dimensional linear advection equation:\n$$u_{t} + a\\,u_{x} = 0$$\nwhere the advection speed $a$ is a positive constant ($a  0$).\n\nThe specified numerical scheme uses a forward-Euler method for time integration and a first-order upwind method for spatial discretization.\n\nThe time derivative term, $u_t$, is approximated by a first-order forward difference:\n$$\\frac{\\partial u}{\\partial t} \\approx \\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t}$$\nwhere $u_j^n$ represents the numerical solution at spatial node $x_j = j\\,\\Delta x$ and time level $t^n = n\\,\\Delta t$.\n\nThe spatial derivative term, $u_x$, is approximated by a first-order upwind difference. Since $a  0$, the \"upwind\" direction is from the left (i.e., information propagates from smaller $x$ to larger $x$). This corresponds to a first-order backward difference:\n$$\\frac{\\partial u}{\\partial x} \\approx \\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x}$$\nSubstituting these discrete approximations into the PDE yields the fully discretized equation:\n$$\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + a \\left(\\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x}\\right) = 0$$\nTo obtain the explicit update scheme for $u_{j}^{n+1}$, we rearrange the terms:\n$$u_{j}^{n+1} - u_{j}^{n} = -a \\frac{\\Delta t}{\\Delta x} \\left(u_{j}^{n} - u_{j-1}^{n}\\right)$$\nWe introduce the Courant–Friedrichs–Lewy (CFL) number, defined as $\\nu = \\frac{a\\,\\Delta t}{\\Delta x}$. Substituting $\\nu$ into the equation gives:\n$$u_{j}^{n+1} = u_{j}^{n} - \\nu \\left(u_{j}^{n} - u_{j-1}^{n}\\right)$$\n$$u_{j}^{n+1} = (1 - \\nu)u_{j}^{n} + \\nu u_{j-1}^{n}$$\nThis is the finite difference scheme for which we must perform a von Neumann stability analysis. The analysis proceeds by substituting a single Fourier mode, $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$, into the scheme. Here, $\\hat{u}^{n}$ is the amplitude of the mode at time step $n$, $i=\\sqrt{-1}$, and $\\theta = k_x \\Delta x$ is the nondimensional wavenumber, with $k_x$ being the wavenumber.\n\nThe terms in the scheme become:\n$$u_{j}^{n+1} = \\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta)$$\n$$u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$$\n$$u_{j-1}^{n} = \\hat{u}^{n}\\,\\exp(i\\,(j-1)\\,\\theta) = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)\\,\\exp(-i\\,\\theta)$$\nSubstituting these into the discrete equation:\n$$\\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta) = (1 - \\nu)\\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta) + \\nu \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)\\,\\exp(-i\\,\\theta)$$\nWe can divide the entire equation by the common factor $\\exp(i\\,j\\,\\theta)$, which is non-zero:\n$$\\hat{u}^{n+1} = (1 - \\nu)\\hat{u}^{n} + \\nu \\hat{u}^{n}\\,\\exp(-i\\,\\theta)$$\nFactoring out $\\hat{u}^n$ on the right-hand side gives:\n$$\\hat{u}^{n+1} = [1 - \\nu + \\nu \\exp(-i\\,\\theta)]\\,\\hat{u}^{n}$$\nThe amplification factor, $G(\\theta)$, is defined by the relation $\\hat{u}^{n+1} = G(\\theta)\\,\\hat{u}^{n}$. By comparison, we find the expression for $G(\\theta)$:\n$$G(\\theta) = 1 - \\nu + \\nu \\exp(-i\\,\\theta)$$\nThis is the first part of the required answer.\n\nFor the scheme to be stable, the modulus of the amplification factor must not exceed unity for any value of the nondimensional wavenumber $\\theta$. The von Neumann stability condition is:\n$$|G(\\theta)| \\le 1 \\quad \\forall \\theta \\in [-\\pi, \\pi]$$\nTo analyze this condition, we compute the modulus squared, $|G(\\theta)|^2$. Using Euler's formula, $\\exp(-i\\,\\theta) = \\cos(\\theta) - i\\,\\sin(\\theta)$, we can write $G(\\theta)$ in terms of its real and imaginary parts:\n$$G(\\theta) = (1 - \\nu + \\nu \\cos(\\theta)) - i\\,(\\nu \\sin(\\theta))$$\nThe modulus squared is the sum of the squares of the real and imaginary parts:\n$$|G(\\theta)|^2 = (1 - \\nu + \\nu \\cos(\\theta))^2 + (-\\nu \\sin(\\theta))^2$$\n$$|G(\\theta)|^2 = (1 - \\nu(1 - \\cos(\\theta)))^2 + \\nu^2 \\sin^2(\\theta)$$\nExpanding the squared terms:\n$$|G(\\theta)|^2 = 1 - 2\\nu(1 - \\cos(\\theta)) + \\nu^2(1 - \\cos(\\theta))^2 + \\nu^2 \\sin^2(\\theta)$$\n$$|G(\\theta)|^2 = 1 - 2\\nu(1 - \\cos(\\theta)) + \\nu^2(1 - 2\\cos(\\theta) + \\cos^2(\\theta)) + \\nu^2 \\sin^2(\\theta)$$\n$$|G(\\theta)|^2 = 1 - 2\\nu(1 - \\cos(\\theta)) + \\nu^2(1 - 2\\cos(\\theta) + \\cos^2(\\theta) + \\sin^2(\\theta))$$\nUsing the identity $\\cos^2(\\theta) + \\sin^2(\\theta) = 1$:\n$$|G(\\theta)|^2 = 1 - 2\\nu(1 - \\cos(\\theta)) + \\nu^2(1 - 2\\cos(\\theta) + 1)$$\n$$|G(\\theta)|^2 = 1 - 2\\nu(1 - \\cos(\\theta)) + \\nu^2(2 - 2\\cos(\\theta))$$\n$$|G(\\theta)|^2 = 1 - 2\\nu(1 - \\cos(\\theta)) + 2\\nu^2(1 - \\cos(\\theta))$$\n$$|G(\\theta)|^2 = 1 + (2\\nu^2 - 2\\nu)(1 - \\cos(\\theta))$$\n$$|G(\\theta)|^2 = 1 + 2\\nu(\\nu - 1)(1 - \\cos(\\theta))$$\nThe stability condition $|G(\\theta)|^2 \\le 1$ becomes:\n$$1 + 2\\nu(\\nu - 1)(1 - \\cos(\\theta)) \\le 1$$\n$$2\\nu(\\nu - 1)(1 - \\cos(\\theta)) \\le 0$$\nWe analyze the factors in this inequality:\n1.  The CFL number $\\nu = a\\,\\Delta t / \\Delta x$ is positive since $a  0$, $\\Delta t  0$, and $\\Delta x  0$. Thus, $\\nu  0$.\n2.  The term $(1 - \\cos(\\theta))$ is always non-negative for any real $\\theta$, as $-1 \\le \\cos(\\theta) \\le 1$. It ranges from $0$ to $2$.\nSince $2\\nu  0$ and $(1 - \\cos(\\theta)) \\ge 0$, the inequality can only be satisfied for all $\\theta$ if the remaining factor $(\\nu-1)$ is non-positive.\n$$\\nu - 1 \\le 0 \\implies \\nu \\le 1$$\nCombining this with $\\nu  0$, the stability condition for the scheme is $0  \\nu \\le 1$.\nThe question asks for the largest admissible value of the CFL number $\\nu$ for which the scheme is stable. This corresponds to the upper bound of the stability range.\n$$\\nu_{\\text{max}} = 1$$\nThis is the second part of the required answer.",
            "answer": "$$\\boxed{\\begin{pmatrix} 1 - \\nu + \\nu \\exp(-i\\theta)  1 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Many processes in Earth systems, from planetary waves to inertial oscillations, are fundamentally oscillatory and should ideally conserve energy. However, not all numerical methods are suited for long-term integration of such systems, even if they are formally accurate. This practice explores the concept of weak instability, where a method's amplification factor has a modulus slightly greater than one, leading to a slow but persistent artificial growth in energy. By analyzing the explicit midpoint method and implementing it for a simple harmonic oscillator, you will see firsthand why analyzing long-term stability is critical for developing trustworthy climate and Earth system models.",
            "id": "3217024",
            "problem": "Consider the explicit midpoint method for solving an Ordinary Differential Equation (ODE). The method defines a one-step update using the midpoint of the velocity field. Analyze its behavior on oscillatory problems from first principles of numerical stability and then demonstrate the observed behavior computationally.\n\nYou must start from the following fundamental bases:\n- The linear test equation for stability analysis: $y'(t) = \\lambda y(t)$, where $\\lambda \\in \\mathbb{C}$.\n- The simple harmonic oscillator model: $x''(t) + \\omega^2 x(t) = 0$ with angular frequency $\\omega  0$.\n- The energy of the simple harmonic oscillator with unit mass: $E(t) = \\tfrac{1}{2}\\left(v(t)^2 + \\omega^2 x(t)^2\\right)$, where $v(t) = x'(t)$.\n\nTasks:\n1. Derive, from the definition of the explicit midpoint method and the linear test equation $y'(t) = \\lambda y(t)$, the one-step amplification factor $R(z)$ as a function of $z = h\\lambda$, where $h  0$ is the time step. Specialize to the purely imaginary case $\\lambda = i\\omega$ with $\\omega  0$. Show that the modulus $\\lvert R(i\\omega h)\\rvert$ exceeds $1$ for any nonzero step size $h$, and explain why this implies weak instability for oscillatory dynamics, even though the method is consistent and convergent on finite intervals.\n2. Implement a program that integrates the simple harmonic oscillator $x''(t) + \\omega^2 x(t) = 0$ by rewriting it as a first-order system $y'(t) = f(y(t))$ with $y(t) = \\begin{bmatrix}x(t) \\\\ v(t)\\end{bmatrix}$ and $f(y) = \\begin{bmatrix}v \\\\ -\\omega^2 x\\end{bmatrix}$. Use the explicit midpoint method to update the state:\n   - Compute $k_1 = f(y_n)$,\n   - Compute the midpoint state $y_{n+\\frac{1}{2}} = y_n + \\tfrac{h}{2}k_1$,\n   - Compute $k_2 = f(y_{n+\\frac{1}{2}})$,\n   - Update $y_{n+1} = y_n + h k_2$.\n3. For each simulation, use initial conditions $x(0) = 1$ and $v(0) = 0$. Let one period be $T_p = \\tfrac{2\\pi}{\\omega}$. For a given number of periods $M$, integrate for a total time $T = M T_p$ using an integer number of steps $N = \\left\\lfloor \\tfrac{T}{h} \\right\\rfloor$ with fixed step size $h$. Compute and return the energy ratio $r = \\tfrac{E_N}{E_0}$, where $E_0 = \\tfrac{1}{2}(\\omega^2 x(0)^2 + v(0)^2)$ and $E_N$ is the energy after $N$ steps. All quantities are dimensionless; no physical units are required.\n\nTest suite:\n- Case $1$: $\\omega = 1$, $h = 0.5$, $M = 50$.\n- Case $2$: $\\omega = 1$, $h = 0.1$, $M = 200$.\n- Case $3$: $\\omega = 1$, $h = 0.01$, $M = 200$.\n- Case $4$: $\\omega = 2$, $h = 0.05$, $M = 200$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4]$), where each $r_j$ is the energy ratio for the corresponding test case in the order provided above.",
            "solution": "The problem statement is critically validated before a solution is attempted.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Method**: Explicit midpoint method for ODEs.\n- **Update Steps**:\n  1. $k_1 = f(y_n)$\n  2. $y_{n+\\frac{1}{2}} = y_n + \\tfrac{h}{2}k_1$\n  3. $k_2 = f(y_{n+\\frac{1}{2}})$\n  4. $y_{n+1} = y_n + h k_2$\n- **Linear Test Equation**: $y'(t) = \\lambda y(t)$, where $\\lambda \\in \\mathbb{C}$.\n- **Simple Harmonic Oscillator (SHO)**: $x''(t) + \\omega^2 x(t) = 0$, with angular frequency $\\omega  0$.\n- **SHO Energy**: $E(t) = \\tfrac{1}{2}\\left(v(t)^2 + \\omega^2 x(t)^2\\right)$, where $v(t) = x'(t)$ and mass is unity.\n- **Task 1**: Derive the amplification factor $R(z)$ for $z = h\\lambda$, show that for $\\lambda = i\\omega$, the modulus $\\lvert R(i\\omega h)\\rvert  1$ for $h  0$, and explain the implication of weak instability.\n- **Task 2**: Implement the method for the SHO as a first-order system $y'(t) = f(y(t))$ with $y(t) = \\begin{bmatrix}x(t) \\\\ v(t)\\end{bmatrix}$ and $f(y) = \\begin{bmatrix}v \\\\ -\\omega^2 x\\end{bmatrix}$.\n- **Task 3**: Run simulations with initial conditions $x(0) = 1$, $v(0) = 0$. Integrate over $M$ periods, $T = M T_p = M \\frac{2\\pi}{\\omega}$, using $N = \\left\\lfloor \\tfrac{T}{h} \\right\\rfloor$ steps of size $h$. Compute the energy ratio $r = E_N / E_0$.\n- **Test Suite**:\n  - Case 1: $\\omega = 1$, $h = 0.5$, $M = 50$.\n  - Case 2: $\\omega = 1$, $h = 0.1$, $M = 200$.\n  - Case 3: $\\omega = 1$, $h = 0.01$, $M = 200$.\n  - Case 4: $\\omega = 2$, $h = 0.05$, $M = 200$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed against the required criteria:\n- **Scientifically Grounded**: The problem is fundamentally sound. It involves the stability analysis of a standard explicit Runge-Kutta method (the explicit midpoint method, RK2) applied to the canonical linear test equation and the simple harmonic oscillator. These are cornerstone topics in the field of numerical ordinary differential equations.\n- **Well-Posed**: The problem is well-posed. It provides a complete algorithmic description, a set of specific initial conditions and parameters, and a clear objective for both the analytical derivation and the computational experiment. The tasks are unambiguous and lead to a unique, verifiable solution.\n- **Objective**: The problem is stated in objective, formal language, free of any subjectivity or bias. All terms are standard within mathematics and scientific computing.\n- **Flaw Checklist**: The problem does not exhibit any of the invalidating flaws. It is not scientifically unsound, incomplete, contradictory, unrealistic, or ill-posed.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. A complete solution will be provided.\n\n### Solution\n\nThis problem requires a two-part analysis of the explicit midpoint method: a theoretical stability analysis using the linear test equation, and a computational demonstration of its behavior on the simple harmonic oscillator, a system whose dynamics are purely oscillatory.\n\n**1. Stability Analysis and Amplification Factor**\n\nWe begin by analyzing the method's behavior on the linear test equation, $y'(t) = \\lambda y(t)$. The numerical solution at step $n$, denoted $y_n$, should ideally follow the behavior of the exact solution, $y(t_n)$. The explicit midpoint method is applied as follows:\n\nLet $f(y) = \\lambda y$. The steps to advance from $y_n$ to $y_{n+1}$ are:\n1.  Compute the first stage slope: $k_1 = f(y_n) = \\lambda y_n$.\n2.  Compute the state at the midpoint in time, using the slope $k_1$: $y_{n+\\frac{1}{2}} = y_n + \\frac{h}{2}k_1 = y_n + \\frac{h}{2}(\\lambda y_n) = (1 + \\frac{h\\lambda}{2})y_n$.\n3.  Compute the slope at the midpoint state: $k_2 = f(y_{n+\\frac{1}{2}}) = \\lambda y_{n+\\frac{1}{2}} = \\lambda(1 + \\frac{h\\lambda}{2})y_n$.\n4.  Update the state using the midpoint slope $k_2$: $y_{n+1} = y_n + h k_2 = y_n + h \\left[\\lambda(1 + \\frac{h\\lambda}{2})y_n\\right]$.\n\nFactoring out $y_n$ from the final expression gives the one-step update rule:\n$$y_{n+1} = \\left(1 + h\\lambda + \\frac{(h\\lambda)^2}{2}\\right) y_n$$\n\nThe term in parentheses is the amplification factor, $R(z)$, which determines how the numerical solution is scaled at each step. It is a polynomial function of $z = h\\lambda$.\n$$R(z) = 1 + z + \\frac{z^2}{2}$$\nThis is recognized as the second-order Taylor series expansion of $e^z$, which is consistent with the method's second-order accuracy.\n\nFor oscillatory problems, the eigenvalues of the system Jacobian lie on the imaginary axis. We model this by setting $\\lambda = i\\omega$, where $\\omega  0$ is a real frequency. Consequently, $z = i\\omega h$. We substitute this into the amplification factor:\n$$R(i\\omega h) = 1 + (i\\omega h) + \\frac{(i\\omega h)^2}{2} = 1 + i\\omega h - \\frac{(\\omega h)^2}{2}$$\nThis complex number can be written in terms of its real and imaginary parts:\n$$R(i\\omega h) = \\left(1 - \\frac{(\\omega h)^2}{2}\\right) + i(\\omega h)$$\n\nThe stability of the method for oscillatory problems depends on the modulus of this amplification factor. If $\\lvert R(i\\omega h) \\rvert \\le 1$, the method is stable; otherwise, the amplitude of the numerical solution will grow artificially. We compute the modulus squared:\n$$\\lvert R(i\\omega h) \\rvert^2 = \\left(\\text{Re}[R(i\\omega h)]\\right)^2 + \\left(\\text{Im}[R(i\\omega h)]\\right)^2$$\n$$\\lvert R(i\\omega h) \\rvert^2 = \\left(1 - \\frac{(\\omega h)^2}{2}\\right)^2 + (\\omega h)^2$$\nExpanding the squared term:\n$$\\lvert R(i\\omega h) \\rvert^2 = \\left(1 - 2 \\cdot \\frac{(\\omega h)^2}{2} + \\frac{(\\omega h)^4}{4}\\right) + (\\omega h)^2$$\n$$\\lvert R(i\\omega h) \\rvert^2 = 1 - (\\omega h)^2 + \\frac{(\\omega h)^4}{4} + (\\omega h)^2$$\n$$\\lvert R(i\\omega h) \\rvert^2 = 1 + \\frac{(\\omega h)^4}{4}$$\nThus, the modulus is:\n$$\\lvert R(i\\omega h) \\rvert = \\sqrt{1 + \\frac{(\\omega h)^4}{4}}$$\nFor any non-zero step size $h  0$ and frequency $\\omega  0$, the term $(\\omega h)^4$ is strictly positive. Therefore, $\\frac{(\\omega h)^4}{4}  0$, which implies $1 + \\frac{(\\omega h)^4}{4}  1$, and consequently, $\\lvert R(i\\omega h) \\rvert  1$.\n\nThis result proves that the explicit midpoint method is unconditionally unstable on the imaginary axis. The amplitude of the numerical solution is amplified by a factor greater than $1$ at every step. This leads to an exponential growth in the solution's norm over long integration times, a phenomenon known as weak instability. While the method is consistent (local error is $\\mathcal{O}(h^3)$) and therefore convergent on any finite time interval $[0, T]$, the error constant grows exponentially with $T$, making the method unsuitable for long-term simulations of conservative systems like the simple harmonic oscillator, where energy should be conserved. The numerical energy will systematically increase, as will be demonstrated computationally.\n\n**2. Computational Implementation and Energy Analysis**\n\nThe second-order SHO equation $x''(t) + \\omega^2 x(t) = 0$ is converted into a first-order system by defining the state vector $y(t) = \\begin{bmatrix} x(t) \\\\ v(t) \\end{bmatrix}$, where $v(t) = x'(t)$. The system dynamics are given by:\n$$y'(t) = \\begin{bmatrix} x'(t) \\\\ v'(t) \\end{bmatrix} = \\begin{bmatrix} v(t) \\\\ -\\omega^2 x(t) \\end{bmatrix} = f(y(t))$$\nWe will integrate this system using the explicit midpoint method with the specified test case parameters. At each step from $y_n = \\begin{bmatrix} x_n \\\\ v_n \\end{bmatrix}$ to $y_{n+1}$:\n1.  $k_1 = \\begin{bmatrix} k_{1,x} \\\\ k_{1,v} \\end{bmatrix} = \\begin{bmatrix} v_n \\\\ -\\omega^2 x_n \\end{bmatrix}$.\n2.  $y_{n+\\frac{1}{2}} = \\begin{bmatrix} x_n \\\\ v_n \\end{bmatrix} + \\frac{h}{2} \\begin{bmatrix} v_n \\\\ -\\omega^2 x_n \\end{bmatrix} = \\begin{bmatrix} x_n + \\frac{h}{2}v_n \\\\ v_n - \\frac{h}{2}\\omega^2 x_n \\end{bmatrix}$.\n3.  $k_2 = \\begin{bmatrix} k_{2,x} \\\\ k_{2,v} \\end{bmatrix} = f(y_{n+\\frac{1}{2}}) = \\begin{bmatrix} v_n - \\frac{h}{2}\\omega^2 x_n \\\\ -\\omega^2(x_n + \\frac{h}{2}v_n) \\end{bmatrix}$.\n4.  $y_{n+1} = \\begin{bmatrix} x_{n+1} \\\\ v_{n+1} \\end{bmatrix} = \\begin{bmatrix} x_n \\\\ v_n \\end{bmatrix} + h k_2 = \\begin{bmatrix} x_n + h(v_n - \\frac{h}{2}\\omega^2 x_n) \\\\ v_n - h\\omega^2(x_n + \\frac{h}{2}v_n) \\end{bmatrix}$.\n\nThe initial state is $y_0 = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$. The initial energy is $E_0 = \\frac{1}{2}(v(0)^2 + \\omega^2 x(0)^2) = \\frac{1}{2}(0^2 + \\omega^2 \\cdot 1^2) = \\frac{\\omega^2}{2}$.\nAfter $N$ steps, the final state is $y_N = \\begin{bmatrix} x_N \\\\ v_N \\end{bmatrix}$. The final energy is $E_N = \\frac{1}{2}(v_N^2 + \\omega^2 x_N^2)$. The program will compute the ratio $r = E_N/E_0$ for each test case. This ratio quantifies the numerical energy drift predicted by the stability analysis.\nThe growth in energy is expected to be more pronounced for larger values of the dimensionless product $\\omega h$ and for a larger number of integration steps $N$.\nSpecifically, the energy ratio $r_N = E_N/E_0$ is expected to grow approximately as $(1 + \\frac{(\\omega h)^4}{4})^N$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the explicit midpoint method on the simple harmonic oscillator.\n\n    This function implements the explicit midpoint method to solve the\n    simple harmonic oscillator equation system for four different test cases.\n    It calculates the ratio of the final numerical energy to the initial\n    analytical energy, demonstrating the method's weak instability for\n    oscillatory problems.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (omega, h, M)\n    test_cases = [\n        (1.0, 0.5, 50),\n        (1.0, 0.1, 200),\n        (1.0, 0.01, 200),\n        (2.0, 0.05, 200),\n    ]\n\n    results = []\n    for omega, h, M in test_cases:\n        # Initial conditions\n        x0 = 1.0\n        v0 = 0.0\n        y = np.array([x0, v0], dtype=np.float64)\n\n        # System definition f(y) = [v, -omega^2 * x]\n        def f(state_vec, omega_val):\n            x, v = state_vec\n            return np.array([v, -omega_val**2 * x], dtype=np.float64)\n\n        # Simulation time parameters\n        # T_p is one period\n        T_p = 2.0 * np.pi / omega\n        # T is total integration time\n        T = M * T_p\n        # N is the total number of integer steps\n        N = int(np.floor(T / h))\n\n        # Calculate initial energy E_0\n        # E(t) = 0.5 * (v(t)^2 + omega^2 * x(t)^2)\n        E0 = 0.5 * (y[1]**2 + omega**2 * y[0]**2)\n\n        # Integration loop using explicit midpoint method\n        for _ in range(N):\n            # k1 = f(y_n)\n            k1 = f(y, omega)\n            \n            # y_mid = y_n + (h/2) * k1\n            y_mid = y + (h / 2.0) * k1\n            \n            # k2 = f(y_mid)\n            k2 = f(y_mid, omega)\n            \n            # y_{n+1} = y_n + h * k2\n            y = y + h * k2\n\n        # Calculate final energy E_N\n        EN = 0.5 * (y[1]**2 + omega**2 * y[0]**2)\n        \n        # Avoid division by zero if initial energy is zero, though not possible\n        # with the given ICs.\n        if E0 == 0:\n            energy_ratio = np.inf\n        else:\n            energy_ratio = EN / E0\n        \n        results.append(energy_ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Developing and debugging complex numerical models for Earth systems requires a rigorous verification process to ensure the code correctly solves the intended equations. The Method of Manufactured Solutions (MMS) is the gold standard for this task, allowing for the precise measurement of a code's accuracy and convergence rate. This practice challenges you to identify the correct and complete MMS procedure for a canonical advection-diffusion problem, a core process in environmental model development. Mastering this methodology is essential for establishing confidence in the numerical foundation of any simulation software.",
            "id": "3871435",
            "problem": "Consider the one-dimensional linear advection–diffusion equation for a passive tracer in an environmental flow,\n$$u_t + c\\,u_x = \\kappa\\,u_{xx},$$\nposed on the spatial interval $[0,1]$ with time $t \\in [0,T]$, where $c0$ and $\\kappa0$ are constants. You intend to use the Method of Manufactured Solutions (MMS) to verify a newly implemented linear finite difference time-stepping method with spatial step $h$ and time step $\\Delta t$. Your goals are to (i) construct a smooth manufactured solution and the associated source term and boundary/initial conditions, and (ii) design diagnostics that rigorously verify consistency of the discrete operator and quantify observed convergence rates under grid refinement pertinent to environmental and Earth system modeling practice.\n\nWhich option most correctly and rigorously specifies the MMS procedure and the verification diagnostics for consistency and observed convergence rates?\n\nA. Select a smooth, spatially periodic manufactured solution $u(x,t)$, for example with wavenumber $m \\in \\mathbb{N}$, and define a source term by substituting $u$ into the continuous advection–diffusion operator to obtain\n$$f(x,t) = u_t(x,t) + c\\,u_x(x,t) - \\kappa\\,u_{xx}(x,t).$$\nImpose boundary and initial conditions directly from $u$, for example periodic boundary conditions $u(0,t)=u(1,t)$ and $u(x,0)=u(x,0)$ as given by the manufactured $u$. Run the code for the forced problem\n$$u_t + c\\,u_x = \\kappa\\,u_{xx} + f(x,t)$$\nwith those boundary and initial data. To verify consistency, evaluate the discrete residual by injecting the exact $u$ onto the grid and computing\n$$R_h^{\\Delta t}(x_i,t^n) = L_h^{\\Delta t}[u](x_i,t^n) - f(x_i,t^n),$$\nwhere $L_h^{\\Delta t}$ is the fully discrete operator corresponding to the scheme, and verify that $\\|R_h^{\\Delta t}\\|$ over the space–time grid scales like $\\mathcal{O}(h^p)+\\mathcal{O}((\\Delta t)^q)$ as $h,\\Delta t \\to 0$ for some orders $p,q$. To measure observed convergence, compute the numerical solution $u_h^{\\Delta t}$ of the forced problem and form the error by comparison with the manufactured $u$ projected onto the grid, $e_h^{\\Delta t} = I_h u - u_h^{\\Delta t}$. Perform systematic grid refinement with, for example, a fixed Courant–Friedrichs–Lewy (CFL) number $\\lambda = c\\,\\Delta t/h$, and estimate observed orders via\n$$p_{\\mathrm{obs}} = \\frac{\\log\\left(\\|e_h^{\\Delta t}\\|/\\|e_{h/2}^{\\Delta t/2}\\|\\right)}{\\log(2)},$$\nin a suitable norm (e.g., $L^2$ or $L^\\infty$), confirming asymptotic rates consistent with design.\n\nB. Choose a manufactured solution $u(x,t)$ that is piecewise constant with a jump at $x = 1/2$, take $f(x,t) \\equiv 0$, and enforce homogeneous Dirichlet boundary conditions $u(0,t)=u(1,t)=0$. Declare the scheme consistent if the numerical solution does not exhibit visible oscillations and the maximum time step allowed by a stability condition decreases linearly with $h$. Measure convergence by tracking the peak value of $u_h^{\\Delta t}$ at a single interior point as $h$ is halved while keeping $\\Delta t$ fixed.\n\nC. Pick a smooth $u(x,t)$ and define the source term by\n$$f(x,t) = -\\,u_t(x,t) - c\\,u_x(x,t) + \\kappa\\,u_{xx}(x,t),$$\nthen impose boundary conditions independent of the manufactured $u$ (e.g., homogeneous Neumann). Verify consistency by computing the residual\n$$\\widetilde{R}_h^{\\Delta t}(x_i,t^n) = L_h^{\\Delta t}[u_h^{\\Delta t}](x_i,t^n) - f(x_i,t^n),$$\nwhere $u_h^{\\Delta t}$ is the numerical solution, and declare consistency if $\\|\\widetilde{R}_h^{\\Delta t}\\|$ decreases under refinement. Measure convergence by comparing $u_h^{\\Delta t}$ to $u_{h/2}^{\\Delta t}$ without reference to $u$.\n\nD. Manufacture a solution $u(x,t)$ and set $f(x,t)$ so that the unforced advection–diffusion equation holds, but test consistency by proving the discrete maximum principle and estimating the largest stable time step. Measure “observed convergence” by varying only $\\Delta t$ at fixed $h$ and computing the slope of $\\log\\|u_h^{\\Delta t}\\|$ versus $\\log(\\Delta t)$, without comparing to the manufactured $u$ or adjusting $\\Delta t$ relative to $h$.",
            "solution": "The user-provided problem statement is valid. It presents a standard problem in the verification of numerical methods for partial differential equations (PDEs) and asks for the correct procedure for applying the Method of Manufactured Solutions (MMS). The problem is scientifically grounded, well-posed, objective, and contains all necessary information to evaluate the options.\n\nThe Method of Manufactured Solutions is a rigorous procedure for verifying the correctness of the implementation of a numerical solver for a given differential equation. The core idea is to manufacture a problem for which the exact solution is known *a priori*. This allows for the unambiguous and quantitative evaluation of the numerical error. Let the governing PDE be written in operator form as $L[u] = 0$. For the given advection-diffusion equation, the linear differential operator $L$ is $L[u] \\equiv u_t + c\\,u_x - \\kappa\\,u_{xx}$. The MMS procedure is as follows:\n\n1.  **Manufacture a Solution**: An analytical function, $u_m(x,t)$, is chosen. This manufactured solution must be sufficiently smooth (i.e., possess enough continuous derivatives) so that it can be substituted into the differential operator $L$. It should also be non-trivial and designed to exercise all terms in the equation. For the operator $L[u] = u_t + c\\,u_x - \\kappa\\,u_{xx}$, the manufactured solution $u_m(x,t)$ must be at least $C^1$ in time and $C^2$ in space.\n\n2.  **Derive a Source Term**: Since the chosen $u_m(x,t)$ is unlikely to be a solution to the original homogeneous equation ($L[u_m] \\neq 0$), a source term, $f(x,t)$, is defined by applying the operator to $u_m$:\n    $$f(x,t) := L[u_m(x,t)] = \\frac{\\partial u_m}{\\partial t} + c\\,\\frac{\\partial u_m}{\\partial x} - \\kappa\\,\\frac{\\partial^2 u_m}{\\partial x^2}$$\n    By this construction, $u_m(x,t)$ is the exact, analytical solution to the forced (or inhomogeneous) PDE, $L[u] = f(x,t)$.\n\n3.  **Impose Consistent Conditions**: The initial and boundary conditions for the numerical problem must be derived from the manufactured solution $u_m(x,t)$.\n    - Initial Condition: $u(x,0) = u_m(x,0)$ for $x \\in [0,1]$.\n    - Boundary Conditions: At $x=0$ and $x=1$, the conditions are set to match $u_m$. For example, for Dirichlet boundary conditions, $u(0,t) = u_m(0,t)$ and $u(1,t) = u_m(1,t)$.\n\n4.  **Solve and Verify**: The numerical code is used to solve the forced problem $L_h^{\\Delta t}[u_h^{\\Delta t}] = f$, where $L_h^{\\Delta t}$ is the discrete approximation to $L$ and $u_h^{\\Delta t}$ is the numerical solution on a grid with spacing $h$ and $\\Delta t$. Two key diagnostics are then performed:\n    - **Consistency Verification**: Consistency ensures that the discrete operator $L_h^{\\Delta t}$ approaches the continuous operator $L$ as the grid is refined. This is verified by computing the truncation error, $\\tau_h^{\\Delta t}$, which is the residual obtained when the exact manufactured solution $u_m$ is substituted into the discrete equations:\n      $$\\tau_h^{\\Delta t} = L_h^{\\Delta t}[u_m] - f$$\n      If the scheme is of order $p$ in space and $q$ in time, the norm of the truncation error must scale as $\\|\\tau_h^{\\Delta t}\\| = \\mathcal{O}(h^p) + \\mathcal{O}((\\Delta t)^q)$. This test isolates the correctness of the operator discretization from the solution error.\n    - **Convergence Verification**: Convergence ensures that the numerical solution $u_h^{\\Delta t}$ approaches the exact solution $u_m$ as the grid is refined. The error is defined as $e_h^{\\Delta t} = u_h^{\\Delta t} - u_m$ (evaluated on the grid). A series of simulations are run on successively refined grids. By the Lax Equivalence Theorem (for a consistent, linear scheme), stability implies convergence. The rate of convergence is expected to match the order of the scheme. If the grid is refined such that $h' = h/r$ and $\\Delta t'$ is also reduced appropriately (e.g., fixed Courant number), the observed order of convergence $p_{\\mathrm{obs}}$ can be calculated from the ratio of errors:\n      $$p_{\\mathrm{obs}} = \\frac{\\log\\left(\\|e_h^{\\Delta t}\\|/\\|e_{h'}^{\\Delta t'}\\|\\right)}{\\log(r)}$$\n      For refinement by a factor of $2$, $r=2$. The value of $p_{\\mathrm{obs}}$ should asymptotically approach the theoretical order of the scheme.\n\nWe now evaluate each option against these principles.\n\n**A. Select a smooth, spatially periodic manufactured solution $u(x,t)$, for example with wavenumber $m \\in \\mathbb{N}$, and define a source term by substituting $u$ into the continuous advection–diffusion operator to obtain...**\n- **Procedure**: This option correctly specifies selecting a smooth solution $u(x,t)$, defining the source term as $f(x,t) = u_t + c\\,u_x - \\kappa\\,u_{xx}$, and imposing boundary/initial conditions from $u$. This is the correct formulation of the MMS problem.\n- **Consistency Check**: It correctly defines the consistency check by computing the residual of the *exact* solution in the discrete equations, $R_h^{\\Delta t} = L_h^{\\Delta t}[u] - f(x_i,t^n)$, and verifying that it scales with the theoretical orders of accuracy, $\\mathcal{O}(h^p)+\\mathcal{O}((\\Delta t)^q)$. This is the definition of the truncation error.\n- **Convergence Check**: It correctly defines the error as the difference between the numerical solution and the manufactured solution, $e_h^{\\Delta t} = I_h u - u_h^{\\Delta t}$. It correctly describes the process of systematic grid refinement (e.g., with fixed CFL number $\\lambda = c\\,\\Delta t/h$) and the formula for calculating the observed order of convergence, $p_{\\mathrm{obs}} = \\log(\\|e_h^{\\Delta t}\\|/\\|e_{h/2}^{\\Delta t/2}\\|)/\\log(2)$.\n- **Verdict**: **Correct**. This option provides a complete, rigorous, and accurate description of the MMS procedure for verification of consistency and convergence.\n\n**B. Choose a manufactured solution $u(x,t)$ that is piecewise constant with a jump at $x = 1/2$, take $f(x,t) \\equiv 0$, and enforce homogeneous Dirichlet boundary conditions $u(0,t)=u(1,t)=0$.**\n- **Procedure**: This is incorrect. A piecewise constant function is not smooth enough; its second derivative $u_{xx}$ is not a regular function, involving a derivative of a Dirac delta function. Standard finite difference methods cannot be applied. Furthermore, setting $f(x,t) \\equiv 0$ and imposing arbitrary homogeneous boundary conditions violates the fundamental tenets of MMS. The source term and boundary conditions must be derived from a chosen smooth manufactured solution.\n- **Consistency Check**: The proposed check, \"consistent if the numerical solution does not exhibit visible oscillations\" and the scaling of the stability limit, is incorrect. Consistency is about the discrete operator approximating the continuous one, not about oscillations (which relate to stability) or stability limits.\n- **Convergence Check**: The proposed check, tracking a single point value while only refining $h$, is not a valid measure of convergence. Convergence must be measured in a norm over the whole domain, and temporal and spatial refinements must be coordinated to observe the correct asymptotic behavior.\n- **Verdict**: **Incorrect**. This option is flawed in every aspect.\n\n**C. Pick a smooth $u(x,t)$ and define the source term by $f(x,t) = -\\,u_t(x,t) - c\\,u_x(x,t) + \\kappa\\,u_{xx}(x,t)$, then impose boundary conditions independent of the manufactured $u$ (e.g., homogeneous Neumann).**\n- **Procedure**: The definition of the source term is incorrect. It has the wrong sign, $f = -L[u_m]$ instead of $f = +L[u_m]$. Imposing boundary conditions independent of $u_m$ is also a fundamental error.\n- **Consistency Check**: The proposed check, computing the residual of the *numerical solution* $\\widetilde{R}_h^{\\Delta t} = L_h^{\\Delta t}[u_h^{\\Delta t}] - f$, is meaningless. By definition of a numerical solver, $L_h^{\\Delta t}[u_h^{\\Delta t}]$ is designed to be equal to $f$, so this residual will be near machine zero, providing no information about consistency. The check must use the *exact* solution.\n- **Convergence Check**: Measuring convergence by comparing two numerical solutions, $u_h^{\\Delta t}$ and $u_{h/2}^{\\Delta t}$, is a method for estimating convergence order when the exact solution is unknown. While a valid technique, it is not the primary purpose of MMS, which is to enable direct comparison with a known exact solution. Hence, this misses the main strength of the method.\n- **Verdict**: **Incorrect**. This option demonstrates a misunderstanding of how the source term, boundary conditions, and verification diagnostics are formulated in MMS.\n\n**D. Manufacture a solution $u(x,t)$ and set $f(x,t)$ so that the unforced advection–diffusion equation holds, but test consistency by proving the discrete maximum principle and estimating the largest stable time step. **\n- **Procedure**: The statement \"set $f(x,t)$ so that the unforced advection–diffusion equation holds\" is a contradiction. The unforced equation has $f(x,t)=0$. This would mean that $u(x,t)$ is a true solution to the original PDE, which is a special case (method of exact solutions), not the general MMS procedure.\n- **Consistency Check**: It conflates consistency with stability. Proving a discrete maximum principle and estimating the stable time step are both related to numerical *stability*, not *consistency*. Consistency is a check on the local truncation error.\n- **Convergence Check**: The proposed check, varying only $\\Delta t$ at a fixed $h$ and not comparing to the manufactured solution, is deeply flawed. It only examines temporal error and does not measure the true error, as there is no comparison to the exact solution $u_m$.\n- **Verdict**: **Incorrect**. This option confuses the distinct concepts of consistency and stability and proposes invalid diagnostic procedures.\n\nIn summary, Option A is the only one that correctly outlines the rigorous application of the Method of Manufactured Solutions for code verification.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}