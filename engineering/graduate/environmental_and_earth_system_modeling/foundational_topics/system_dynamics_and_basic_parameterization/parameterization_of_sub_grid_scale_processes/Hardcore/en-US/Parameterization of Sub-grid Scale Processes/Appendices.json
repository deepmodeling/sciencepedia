{
    "hands_on_practices": [
        {
            "introduction": "Turbulent eddies in the atmospheric surface layer are a classic example of a process occurring at scales too small to be resolved by weather and climate models. This practice introduces Monin-Obukhov Similarity Theory (MOST), a cornerstone parameterization that connects sub-grid turbulent fluxes of momentum and heat to resolved, grid-scale mean variables like wind speed and temperature gradients. By working through this calculation, you will gain hands-on experience with the sophisticated empirical functions that form the basis of surface layer parameterizations in virtually all modern atmospheric models .",
            "id": "3905619",
            "problem": "Consider a horizontally homogeneous, stationary atmospheric surface layer over low vegetation, where the sub-grid scale turbulent momentum and heat fluxes are represented using first-order closure and Monin–Obukhov Similarity Theory (MOST). Let the height be $z=10~\\mathrm{m}$, the Obukhov length be $L=-50~\\mathrm{m}$ (unstable stratification), the surface roughness length be $z_0=0.10~\\mathrm{m}$, and the zero-plane displacement be $d=0~\\mathrm{m}$. The von Kármán constant is $\\kappa=0.40$. The measured mean wind speed at $z=10~\\mathrm{m}$ is $U(z)=7.0~\\mathrm{m~s^{-1}}$.\n\nUnder MOST, use the following widely employed empirical stability functions for unstable conditions, where $\\zeta=z/L0$ and angles are in radians:\n- Gradient functions: $\\phi_m(\\zeta)=\\left(1-16\\zeta\\right)^{-1/4}$ and $\\phi_h(\\zeta)=\\left(1-16\\zeta\\right)^{-1/2}$.\n- Integrated (profile) correction functions:\n\n$$\n\\psi_m(\\zeta)=2\\ln\\!\\left(\\frac{1+x}{2}\\right)+\\ln\\!\\left(\\frac{1+x^2}{2}\\right)-2\\arctan(x)+\\frac{\\pi}{2},\\quad\n\\psi_h(\\zeta)=2\\ln\\!\\left(\\frac{1+x^2}{2}\\right),\n$$\n\nwhere $x=\\left(1-16\\zeta\\right)^{1/4}$.\n\nStarting from fundamental flux–gradient relationships and the constant-stress layer assumption, derive and compute the turbulent eddy viscosity $K_m$ and turbulent eddy diffusivity for heat $K_h$ at $z=10~\\mathrm{m}$, using the logarithmic profile framework with stability corrections to diagnose the friction velocity $u_*$. Express your final numerical answers for $K_m$ and $K_h$ in $\\mathrm{m^2~s^{-1}}$, and round to three significant figures. Your final answer must be a single row matrix containing $K_m$ and $K_h$ in that order.",
            "solution": "The user-provided problem statement is validated as scientifically sound, well-posed, objective, and complete. It represents a standard application of Monin-Obukhov Similarity Theory (MOST) in atmospheric boundary layer physics. All necessary parameters and empirical functions are provided, and the requested calculations are feasible and well-defined. Therefore, a reasoned solution will be provided.\n\nThe problem asks for the calculation of the turbulent eddy viscosity for momentum, $K_m$, and the turbulent eddy diffusivity for heat, $K_h$, at a specific height in the atmospheric surface layer under unstable conditions.\n\nThe foundation of this problem lies in the flux-gradient relationships within the framework of MOST. The vertical gradient of the mean horizontal wind speed, $U$, is related to the friction velocity, $u_*$, by:\n$$\n\\frac{\\partial U}{\\partial z} = \\frac{u_*}{\\kappa (z-d)} \\phi_m(\\zeta)\n$$\nwhere $\\kappa$ is the von Kármán constant, $z$ is the height above the ground, $d$ is the zero-plane displacement, $\\phi_m(\\zeta)$ is the dimensionless stability function for momentum, and $\\zeta = \\frac{z-d}{L}$ is the stability parameter, with $L$ being the Obukhov length. Given that $d=0$ m, the equation simplifies to:\n$$\n\\frac{\\partial U}{\\partial z} = \\frac{u_*}{\\kappa z} \\phi_m(\\zeta), \\quad \\text{with } \\zeta = \\frac{z}{L}\n$$\nIntegrating this expression from the roughness length $z_0$ (where wind speed is assumed to be zero) to a height $z$ yields the wind profile equation:\n$$\nU(z) = \\frac{u_*}{\\kappa} \\left[ \\ln\\left(\\frac{z}{z_0}\\right) - \\psi_m\\left(\\zeta\\right) + \\psi_m\\left(\\zeta_0\\right) \\right]\n$$\nwhere $\\psi_m(\\zeta)$ is the integrated stability correction function and $\\zeta_0 = z_0/L$. Given $z_0 = 0.10~\\mathrm{m}$ and $L = -50~\\mathrm{m}$, $\\zeta_0 = -0.002$. Since $|\\zeta_0| \\ll 1$, the term $\\psi_m(\\zeta_0)$ is approximately $\\psi_m(0)$, which is zero based on the provided definition of $\\psi_m$. Thus, the wind profile is given by:\n$$\nU(z) = \\frac{u_*}{\\kappa} \\left[ \\ln\\left(\\frac{z}{z_0}\\right) - \\psi_m(\\zeta) \\right]\n$$\nThis equation can be rearranged to solve for the friction velocity $u_*$, as all other quantities are known.\n\nThe turbulent eddy coefficients are defined by the first-order closure (K-theory) relations for momentum and heat fluxes:\n$$\nu_*^2 \\equiv -\\overline{u'w'} = K_m \\frac{\\partial U}{\\partial z} \\quad \\text{and} \\quad -\\overline{w'\\theta'} = K_h \\frac{\\partial \\Theta}{\\partial z}\n$$\nBy substituting the flux-gradient relationships from MOST, we can derive expressions for $K_m$ and $K_h$:\nFor momentum:\n$$\nK_m = \\frac{u_*^2}{\\partial U / \\partial z} = \\frac{u_*^2}{ (u_* / (\\kappa z)) \\phi_m(\\zeta) } = \\frac{\\kappa z u_*}{\\phi_m(\\zeta)}\n$$\nFor heat, analogously:\n$$\nK_h = \\frac{-\\overline{w'\\theta'}}{\\partial \\Theta / \\partial z} = \\frac{-\\overline{w'\\theta'}}{(\\theta_* / (\\kappa z)) \\phi_h(\\zeta)} = \\frac{u_* \\theta_*}{(\\theta_* / (\\kappa z)) \\phi_h(\\zeta)} = \\frac{\\kappa z u_*}{\\phi_h(\\zeta)}\n$$\nwhere $\\theta_* = -\\overline{w'\\theta'}/u_*$ is the characteristic temperature scale and $\\phi_h(\\zeta)$ is the dimensionless stability function for heat.\n\nThe calculation proceeds in the following steps:\n\n1.  **Calculate the stability parameter $\\zeta$ at $z=10~\\mathrm{m}$**:\n    The given values are $z = 10~\\mathrm{m}$ and $L = -50~\\mathrm{m}$.\n    $$\n    \\zeta = \\frac{z}{L} = \\frac{10}{-50} = -0.2\n    $$\n\n2.  **Calculate the integrated stability function $\\psi_m(\\zeta)$**:\n    First, the intermediate variable $x$ is computed:\n    $$\n    x = (1-16\\zeta)^{1/4} = (1 - 16(-0.2))^{1/4} = (1 + 3.2)^{1/4} = (4.2)^{1/4} \\approx 1.43165\n    $$\n    Now, $\\psi_m(\\zeta)$ is calculated using the provided formula:\n    $$\n    \\psi_m(-0.2) = 2\\ln\\!\\left(\\frac{1+x}{2}\\right)+\\ln\\!\\left(\\frac{1+x^2}{2}\\right)-2\\arctan(x)+\\frac{\\pi}{2}\n    $$\n    Substituting the value of $x$:\n    $$\n    \\psi_m(-0.2) = 2\\ln\\!\\left(\\frac{1+1.43165}{2}\\right)+\\ln\\!\\left(\\frac{1+(1.43165)^2}{2}\\right)-2\\arctan(1.43165)+\\frac{\\pi}{2}\n    $$\n    $$\n    \\psi_m(-0.2) \\approx 2\\ln(1.21583) + \\ln(1.52482) - 2(0.96136) + 1.57080\n    $$\n    $$\n    \\psi_m(-0.2) \\approx 2(0.19543) + 0.42188 - 1.92272 + 1.57080 \\approx 0.46078\n    $$\n\n3.  **Calculate the friction velocity $u_*$**:\n    We rearrange the wind profile equation to solve for $u_*$:\n    $$\n    u_* = \\frac{\\kappa U(z)}{\\ln\\left(\\frac{z}{z_0}\\right) - \\psi_m(\\zeta)}\n    $$\n    The values are $\\kappa = 0.40$, $U(10~\\mathrm{m})=7.0~\\mathrm{m~s^{-1}}$, $z=10~\\mathrm{m}$, $z_0=0.10~\\mathrm{m}$, and $\\psi_m(-0.2) \\approx 0.46078$.\n    $$\n    \\ln\\left(\\frac{z}{z_0}\\right) = \\ln\\left(\\frac{10}{0.10}\\right) = \\ln(100) \\approx 4.60517\n    $$\n    $$\n    u_* = \\frac{0.40 \\times 7.0}{4.60517 - 0.46078} = \\frac{2.8}{4.14439} \\approx 0.67558~\\mathrm{m~s^{-1}}\n    $$\n\n4.  **Calculate the gradient stability functions $\\phi_m(\\zeta)$ and $\\phi_h(\\zeta)$**:\n    Using the provided formulae with $\\zeta = -0.2$:\n    $$\n    \\phi_m(\\zeta) = (1-16\\zeta)^{-1/4} = (1 - 16(-0.2))^{-1/4} = (4.2)^{-1/4} \\approx \\frac{1}{1.43165} \\approx 0.69849\n    $$\n    $$\n    \\phi_h(\\zeta) = (1-16\\zeta)^{-1/2} = (1 - 16(-0.2))^{-1/2} = (4.2)^{-1/2} \\approx \\frac{1}{\\sqrt{4.2}} \\approx 0.48795\n    $$\n    Note that for these specific empirical forms, $\\phi_h(\\zeta) = (\\phi_m(\\zeta))^2$.\n\n5.  **Calculate the eddy coefficients $K_m$ and $K_h$**:\n    Using the derived expressions and the calculated values:\n    $$\n    K_m = \\frac{\\kappa z u_*}{\\phi_m(\\zeta)} = \\frac{0.40 \\times 10 \\times 0.67558}{0.69849} \\approx \\frac{2.70232}{0.69849} \\approx 3.8688~\\mathrm{m^2~s^{-1}}\n    $$\n    $$\n    K_h = \\frac{\\kappa z u_*}{\\phi_h(\\zeta)} = \\frac{0.40 \\times 10 \\times 0.67558}{0.48795} \\approx \\frac{2.70232}{0.48795} \\approx 5.5381~\\mathrm{m^2~s^{-1}}\n    $$\n\n6.  **Final Answer Formulation**:\n    The problem requests the final numerical answers rounded to three significant figures.\n    $$\n    K_m \\approx 3.87~\\mathrm{m^2~s^{-1}}\n    $$\n    $$\n    K_h \\approx 5.54~\\mathrm{m^2~s^{-1}}\n    $$\n    These are presented as a single row matrix as requested.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3.87  5.54 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A fundamental reason why sub-grid parameterization is necessary is that many physical laws are nonlinear. This practice explores the mathematical consequences of this fact, often termed \"nonlinear aggregation effects.\" Using the Stefan-Boltzmann law of radiation ($F \\propto T^4$) as a canonical example, you will analytically derive the systematic error, or \"aggregation bias,\" that arises when applying this law to a grid-mean temperature instead of properly averaging the flux from sub-grid temperature variations. This exercise vividly illustrates the principle of Jensen's inequality and reveals the mathematical necessity for parameterizations that account for sub-grid statistical distributions .",
            "id": "3905583",
            "problem": "Consider a single horizontal grid cell in a General Circulation Model (GCM), where the unresolved sub-grid variability in surface temperature is represented by a set of categories indexed by $i$, each occupying a fraction $w_i$ of the cell area, with $\\sum_i w_i = 1$. The surface longwave radiative flux from each category follows the Stefan–Boltzmann law, $F_i = \\epsilon \\sigma_{\\mathrm{SB}} T_i^{4}$, where $\\epsilon$ is the emissivity (dimensionless), $\\sigma_{\\mathrm{SB}}$ is the Stefan–Boltzmann constant, and $T_i$ is the absolute temperature in kelvins. Starting from the definition of a weighted average and the Stefan–Boltzmann law, derive the grid-cell aggregated flux and compare it to the flux computed using the grid-mean temperature. Using only the definitions of weighted averages, expectations, and the convexity of the function $x^{4}$, show how nonlinear aggregation effects arise and explain why Jensen’s inequality applies in this context.\n\nThen, assume the sub-grid temperature field $T$ can be treated as a continuous random variable that is approximately Gaussian with mean $\\mu_T$ and variance $\\sigma_T^{2}$, and that the probability of non-physical negative values is negligible because $\\mu_T \\gg \\sigma_T$. Using the properties of the normal distribution and the Stefan–Boltzmann law, derive an exact closed-form expression for the systematic aggregation bias $B$ defined by $B = F_{\\mathrm{true}} - F_{\\mathrm{mean}}$, where $F_{\\mathrm{true}}$ is the true sub-grid weighted flux and $F_{\\mathrm{mean}}$ is the flux computed from the grid-mean temperature. Express your final answer for $B$ in watts per square meter. No numerical values are to be substituted; leave all constants and parameters symbolic. The final answer must be a single analytic expression.",
            "solution": "The goal is to start from fundamental definitions and laws to derive the true aggregated flux, compare it with the flux computed at the mean state, and then quantify the bias introduced by neglecting sub-grid variability for a specific nonlinear flux law.\n\nThe Stefan–Boltzmann law states that the longwave radiative flux for a surface at absolute temperature $T$ is $F = \\epsilon \\sigma_{\\mathrm{SB}} T^{4}$, where $\\epsilon$ is the emissivity and $\\sigma_{\\mathrm{SB}}$ is the Stefan–Boltzmann constant. A grid cell with sub-grid categories indexed by $i$ has temperatures $T_i$ and area fractions $w_i$ satisfying $\\sum_i w_i = 1$.\n\nBy the definition of a weighted average, the true, area-weighted grid-cell flux, denoted $F_{\\mathrm{true}}$, is\n$$\nF_{\\mathrm{true}} = \\sum_i w_i F_i = \\sum_i w_i \\left( \\epsilon \\sigma_{\\mathrm{SB}} T_i^{4} \\right) = \\epsilon \\sigma_{\\mathrm{SB}} \\sum_i w_i T_i^{4}.\n$$\nDefine the grid-mean temperature as\n$$\nT_{\\mathrm{mean}} = \\sum_i w_i T_i.\n$$\nA mean-state parameterization computes the flux as if the entire grid cell were at the mean temperature, yielding\n$$\nF_{\\mathrm{mean}} = \\epsilon \\sigma_{\\mathrm{SB}} \\left( T_{\\mathrm{mean}} \\right)^{4} = \\epsilon \\sigma_{\\mathrm{SB}} \\left( \\sum_i w_i T_i \\right)^{4}.\n$$\n\nTo compare $F_{\\mathrm{true}}$ and $F_{\\mathrm{mean}}$, we appeal to convexity and Jensen’s inequality. The function $x^{4}$ is convex on the positive real line because its second derivative $12 x^{2}$ is nonnegative for all $x$. Jensen’s inequality for a convex function $f$ states that $f\\left( \\sum_i w_i x_i \\right) \\leq \\sum_i w_i f(x_i)$. Applying this with $f(x) = x^{4}$ and $x_i = T_i$ gives\n$$\n\\left( \\sum_i w_i T_i \\right)^{4} \\leq \\sum_i w_i T_i^{4}.\n$$\nMultiplying both sides by $\\epsilon \\sigma_{\\mathrm{SB}}$ shows\n$$\nF_{\\mathrm{mean}} \\leq F_{\\mathrm{true}}.\n$$\nThus, the systematic bias due to using the mean-state parameterization is\n$$\nB = F_{\\mathrm{true}} - F_{\\mathrm{mean}} = \\epsilon \\sigma_{\\mathrm{SB}} \\left( \\sum_i w_i T_i^{4} - \\left( \\sum_i w_i T_i \\right)^{4} \\right) \\geq 0,\n$$\nwith nonnegativity guaranteed by Jensen’s inequality. This is the discrete, category-based statement of nonlinear aggregation effects.\n\nTo obtain an exact closed-form expression for $B$ under a statistical description of sub-grid variability, model $T$ as a continuous random variable with probability distribution and treat the area weights as probabilities. Then the true flux is\n$$\nF_{\\mathrm{true}} = \\epsilon \\sigma_{\\mathrm{SB}} \\mathbb{E}\\!\\left[ T^{4} \\right],\n$$\nand the mean-state flux is\n$$\nF_{\\mathrm{mean}} = \\epsilon \\sigma_{\\mathrm{SB}} \\left( \\mathbb{E}\\!\\left[ T \\right] \\right)^{4}.\n$$\nThe bias becomes\n$$\nB = \\epsilon \\sigma_{\\mathrm{SB}} \\left( \\mathbb{E}\\!\\left[ T^{4} \\right] - \\left( \\mathbb{E}\\!\\left[ T \\right] \\right)^{4} \\right).\n$$\n\nAssume $T$ is approximately Gaussian, $T \\sim \\mathcal{N}\\!\\left( \\mu_T, \\sigma_T^{2} \\right)$, with $\\mu_T \\gg \\sigma_T$ so that the probability of negative values is negligible. Using standard properties of the normal distribution, write $T = \\mu_T + Y$, where $Y \\sim \\mathcal{N}\\!\\left( 0, \\sigma_T^{2} \\right)$. Expand $T^{4}$:\n$$\nT^{4} = \\left( \\mu_T + Y \\right)^{4} = \\mu_T^{4} + 4 \\mu_T^{3} Y + 6 \\mu_T^{2} Y^{2} + 4 \\mu_T Y^{3} + Y^{4}.\n$$\nTake expectations term by term. For a zero-mean normal random variable $Y$, the moments satisfy $\\mathbb{E}\\!\\left[ Y \\right] = 0$, $\\mathbb{E}\\!\\left[ Y^{2} \\right] = \\sigma_T^{2}$, $\\mathbb{E}\\!\\left[ Y^{3} \\right] = 0$, and $\\mathbb{E}\\!\\left[ Y^{4} \\right] = 3 \\sigma_T^{4}$ (the fourth central moment of a normal distribution is $3 \\sigma_T^{4}$). Therefore,\n$$\n\\mathbb{E}\\!\\left[ T^{4} \\right] = \\mu_T^{4} + 6 \\mu_T^{2} \\sigma_T^{2} + 3 \\sigma_T^{4}.\n$$\nSince $\\mathbb{E}\\!\\left[ T \\right] = \\mu_T$, it follows that\n$$\nB = \\epsilon \\sigma_{\\mathrm{SB}} \\left( \\left[ \\mu_T^{4} + 6 \\mu_T^{2} \\sigma_T^{2} + 3 \\sigma_T^{4} \\right] - \\mu_T^{4} \\right) = \\epsilon \\sigma_{\\mathrm{SB}} \\left( 6 \\mu_T^{2} \\sigma_T^{2} + 3 \\sigma_T^{4} \\right).\n$$\n\nThis exact expression under Gaussian sub-grid variability quantifies the nonlinear aggregation bias that arises when applying the Stefan–Boltzmann law to a mean state, thereby illustrating the implications of Jensen’s inequality for parameterizing sub-grid scale processes. The bias is nonnegative and grows with both $\\mu_T^{2} \\sigma_T^{2}$ and $\\sigma_T^{4}$, highlighting the importance of variance and higher-order moments in nonlinear flux aggregation. The result is to be expressed in watts per square meter, consistent with the units of $\\epsilon \\sigma_{\\mathrm{SB}} T^{4}$.",
            "answer": "$$\\boxed{\\epsilon\\,\\sigma_{\\mathrm{SB}}\\left(6\\,\\mu_T^{2}\\,\\sigma_T^{2}+3\\,\\sigma_T^{4}\\right)}$$"
        },
        {
            "introduction": "Earth system models must often represent a landscape of diverse components, such as forests, crops, and water bodies, all coexisting within a single grid cell. The \"tiled\" or \"mosaic\" approach is a powerful parameterization strategy for handling this type of sub-grid heterogeneity. In this computational exercise, you will implement a simple tiled water balance model to explore how a localized process—irrigation on one land tile—affects the water balance of the entire grid cell. This practice provides direct insight into how structural parameterizations are implemented and how they enable models to capture the large-scale impacts of fine-scale processes .",
            "id": "3905581",
            "problem": "Consider a single model grid cell partitioned into $N$ subgrid tiles with fixed area fractions $\\{f_i\\}_{i=1}^N$ that satisfy $\\sum_{i=1}^N f_i = 1$. Each tile $i$ contains a single soil bucket with moisture storage $S_i(t)$ (in $\\mathrm{mm}$ of water) at discrete daily times $t = 0,1,\\dots,T$. The daily water balance for each tile is governed by conservation of mass: inputs minus outputs equal the change in storage. The physically relevant processes are precipitation $P(t)$ (in $\\mathrm{mm/day}$), irrigation $I_i(t)$ (in $\\mathrm{mm/day}$), Evapotranspiration (ET) $E_i(t)$ (in $\\mathrm{mm/day}$), gravitational drainage $D_i(t)$ (in $\\mathrm{mm/day}$), and overflow (surface runoff due to capacity exceedance) $R_i(t)$ (in $\\mathrm{mm/day}$). The soil bucket has three characteristic water contents: wilting point $S_{\\mathrm{wp},i}$, field capacity $S_{\\mathrm{fc},i}$, and maximum storage $S_{\\max,i}$, all in $\\mathrm{mm}$, with $0 \\le S_{\\mathrm{wp},i} \\le S_{\\mathrm{fc},i} \\le S_{\\max,i}$. Let Potential Evapotranspiration (PET) be $E_0(t)$ (in $\\mathrm{mm/day}$), common to all tiles, and let $K_{c,i}$ be a dimensionless crop coefficient for tile $i$. The ET parameterization is given by a soil moisture stress factor $\\alpha_i(S)$ defined as\n$$\n\\alpha_i(S) = \n\\begin{cases}\n0,  S \\le S_{\\mathrm{wp},i}, \\\\\n\\dfrac{S - S_{\\mathrm{wp},i}}{S_{\\mathrm{fc},i} - S_{\\mathrm{wp},i}},  S_{\\mathrm{wp},i}  S  S_{\\mathrm{fc},i}, \\\\\n1,  S \\ge S_{\\mathrm{fc},i}.\n\\end{cases}\n$$\nThus, tile ET is\n$$\nE_i(t) = K_{c,i} \\, E_0(t) \\, \\alpha_i\\!\\big(S_i(t)\\big).\n$$\nGravitational drainage is parameterized as\n$$\nD_i(t) = k_{d,i} \\, \\max\\!\\big( S_i'(t) - S_{\\mathrm{fc},i}, \\, 0 \\big),\n$$\nwhere $k_{d,i}$ (in $\\mathrm{day}^{-1}$) is a drainage coefficient and $S_i'(t)$ is the intermediate storage after inputs and ET but before drainage and overflow. Overflow $R_i(t)$ removes any storage beyond $S_{\\max,i}$ to enforce $S_i(t) \\le S_{\\max,i}$ at the end of the day. The daily update is applied in the following order for each tile $i$ and day $t$:\n1. Compute $E_i(t)$ from $S_i(t)$.\n2. Compute the intermediate storage $S_i'(t) = S_i(t) + P(t) + I_i(t) - E_i(t)$.\n3. Compute $D_i(t) = k_{d,i} \\max\\!\\big(S_i'(t) - S_{\\mathrm{fc},i},0\\big)$ and set $S_i''(t) = S_i'(t) - D_i(t)$.\n4. Enforce capacity and non-negativity by setting\n$$\nS_i(t+1) = \\min\\!\\big(S_{\\max,i}, \\, \\max\\!\\big(S_i''(t), \\, 0\\big)\\big),\n$$\nwith overflow $R_i(t) = \\max\\!\\big(S_i''(t) - S_{\\max,i}, \\, 0\\big)$ implicitly removed.\n\nDefine the area-weighted grid-mean ET on day $t$ as\n$$\n\\overline{E}(t) = \\sum_{i=1}^N f_i \\, E_i(t),\n$$\nand the final grid-mean soil moisture at day $T$ as\n$$\n\\overline{S}(T) = \\sum_{i=1}^N f_i \\, S_i(T).\n$$\n\nYour task is to incorporate irrigation as a tile-specific subgrid water addition $I_i(t)$ under specified schedules and compute, for each test case below, the total grid-mean ET over the $T$-day period,\n$$\nE_{\\mathrm{tot}} = \\sum_{t=0}^{T-1} \\overline{E}(t),\n$$\nand the final grid-mean soil moisture $\\overline{S}(T)$. All inputs and outputs must be expressed in $\\mathrm{mm}$; time is in days. Angles are not involved. For each test case, return two floats: $E_{\\mathrm{tot}}$ (in $\\mathrm{mm}$) and $\\overline{S}(T)$ (in $\\mathrm{mm}$), each rounded to three decimals. Your program should produce a single line of output containing the results for all test cases, flattened into a single comma-separated list in square brackets, in the exact order of the test cases. For example, if there are $M$ test cases, the output should be a single list with $2M$ entries: $[E_{\\mathrm{tot}}^{(1)},\\overline{S}^{(1)}(T),E_{\\mathrm{tot}}^{(2)},\\overline{S}^{(2)}(T),\\dots]$.\n\nUse the following five-test-case suite, each with $N=2$ tiles and $T=5$ days. The shared ordering is tile $1$ then tile $2$ throughout.\n\nTest Case 1 (happy path, irrigation on tile $1$):\n- Area fractions: $f_1 = 0.4$, $f_2 = 0.6$.\n- Soil parameters: $S_{\\max,1} = 200$, $S_{\\mathrm{fc},1} = 120$, $S_{\\mathrm{wp},1} = 40$; $S_{\\max,2} = 150$, $S_{\\mathrm{fc},2} = 100$, $S_{\\mathrm{wp},2} = 30$.\n- Drainage coefficients: $k_{d,1} = 0.10$, $k_{d,2} = 0.08$ (in $\\mathrm{day}^{-1}$).\n- Crop coefficients: $K_{c,1} = 1.05$, $K_{c,2} = 0.70$.\n- Initial soil moisture: $S_1(0) = 100$, $S_2(0) = 90$ (in $\\mathrm{mm}$).\n- Potential ET: $E_0(t) = [4, 5, 4, 3, 4]$ (in $\\mathrm{mm/day}$).\n- Precipitation: $P(t) = [0, 0, 2, 0, 0]$ (in $\\mathrm{mm/day}$).\n- Irrigation schedules: $I_1(t) = [0, 20, 0, 20, 0]$, $I_2(t) = [0, 0, 0, 0, 0]$ (in $\\mathrm{mm/day}$).\n\nTest Case 2 (no irrigation baseline):\n- Same parameters as Test Case 1, except irrigation schedules: $I_1(t) = [0, 0, 0, 0, 0]$, $I_2(t) = [0, 0, 0, 0, 0]$.\n\nTest Case 3 (intense irrigation causing capacity exceedance and drainage):\n- Area fractions: $f_1 = 0.4$, $f_2 = 0.6$.\n- Soil parameters: same as Test Case 1.\n- Drainage coefficients: $k_{d,1} = 0.10$, $k_{d,2} = 0.08$ (in $\\mathrm{day}^{-1}$).\n- Crop coefficients: $K_{c,1} = 1.05$, $K_{c,2} = 0.70$.\n- Initial soil moisture: $S_1(0) = 100$, $S_2(0) = 90$ (in $\\mathrm{mm}$).\n- Potential ET: $E_0(t) = [5, 5, 5, 5, 5]$ (in $\\mathrm{mm/day}$).\n- Precipitation: $P(t) = [0, 0, 0, 0, 0]$ (in $\\mathrm{mm/day}$).\n- Irrigation schedules: $I_1(t) = [60, 0, 0, 0, 0]$, $I_2(t) = [0, 30, 0, 0, 0]$ (in $\\mathrm{mm/day}$).\n\nTest Case 4 (dry initial conditions below wilting point, no irrigation):\n- Area fractions: $f_1 = 0.4$, $f_2 = 0.6$.\n- Soil parameters: same as Test Case 1.\n- Drainage coefficients: $k_{d,1} = 0.10$, $k_{d,2} = 0.08$ (in $\\mathrm{day}^{-1}$).\n- Crop coefficients: $K_{c,1} = 1.05$, $K_{c,2} = 0.70$.\n- Initial soil moisture: $S_1(0) = 30$, $S_2(0) = 25$ (in $\\mathrm{mm}$).\n- Potential ET: $E_0(t) = [4, 4, 4, 4, 4]$ (in $\\mathrm{mm/day}$).\n- Precipitation: $P(t) = [0, 0, 0, 0, 0]$ (in $\\mathrm{mm/day}$).\n- Irrigation schedules: $I_1(t) = [0, 0, 0, 0, 0]$, $I_2(t) = [0, 0, 0, 0, 0]$ (in $\\mathrm{mm/day}$).\n\nTest Case 5 (small irrigated fraction, irrigation only on tile $1$):\n- Area fractions: $f_1 = 0.1$, $f_2 = 0.9$.\n- Soil parameters: same as Test Case 1.\n- Drainage coefficients: $k_{d,1} = 0.10$, $k_{d,2} = 0.08$ (in $\\mathrm{day}^{-1}$).\n- Crop coefficients: $K_{c,1} = 1.05$, $K_{c,2} = 0.70$.\n- Initial soil moisture: $S_1(0) = 110$, $S_2(0) = 95$ (in $\\mathrm{mm}$).\n- Potential ET: $E_0(t) = [4, 5, 4, 3, 4]$ (in $\\mathrm{mm/day}$).\n- Precipitation: $P(t) = [0, 1, 0, 0, 0]$ (in $\\mathrm{mm/day}$).\n- Irrigation schedules: $I_1(t) = [0, 25, 0, 0, 0]$, $I_2(t) = [0, 0, 0, 0, 0]$ (in $\\mathrm{mm/day}$).\n\nYour program must implement the above parameterization and produce a single line of output containing the flattened list of $10$ floats (two per test case) rounded to three decimals, enclosed in square brackets, with no additional text.",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\nThe problem provides a complete set of equations, parameters, and initial conditions to simulate the daily soil moisture balance for a set of subgrid tiles.\n\n**Model Equations:**\n- Area fractions: $\\{f_i\\}_{i=1}^N$ with $\\sum_{i=1}^N f_i = 1$.\n- State variable: Soil moisture storage $S_i(t)$ in $\\mathrm{mm}$.\n- Forcing data: Precipitation $P(t)$, Potential Evapotranspiration $E_0(t)$, and tile-specific Irrigation $I_i(t)$, all in $\\mathrm{mm/day}$.\n- Soil parameters: Wilting point $S_{\\mathrm{wp},i}$, field capacity $S_{\\mathrm{fc},i}$, and maximum storage $S_{\\max,i}$, all in $\\mathrm{mm}$.\n- Process parameters: Crop coefficient $K_{c,i}$ (dimensionless) and drainage coefficient $k_{d,i}$ ($\\mathrm{day}^{-1}$).\n- Soil moisture stress factor $\\alpha_i(S)$:\n$$\n\\alpha_i(S) = \n\\begin{cases}\n0,  S \\le S_{\\mathrm{wp},i}, \\\\\n\\dfrac{S - S_{\\mathrm{wp},i}}{S_{\\mathrm{fc},i} - S_{\\mathrm{wp},i}},  S_{\\mathrm{wp},i}  S  S_{\\mathrm{fc},i}, \\\\\n1,  S \\ge S_{\\mathrm{fc},i}.\n\\end{cases}\n$$\n- Tile Evapotranspiration (ET) $E_i(t)$:\n$$\nE_i(t) = K_{c,i} \\, E_0(t) \\, \\alpha_i\\!\\big(S_i(t)\\big).\n$$\n- Gravitational drainage $D_i(t)$:\n$$\nD_i(t) = k_{d,i} \\, \\max\\!\\big( S_i'(t) - S_{\\mathrm{fc},i}, \\, 0 \\big).\n$$\n- Daily update sequence for $t=0, \\dots, T-1$:\n  1. $E_i(t)$ is computed from $S_i(t)$.\n  2. Intermediate storage $S_i'(t) = S_i(t) + P(t) + I_i(t) - E_i(t)$.\n  3. Drainage $D_i(t)$ is computed from $S_i'(t)$, and $S_i''(t) = S_i'(t) - D_i(t)$.\n  4. Next day's storage $S_i(t+1) = \\min\\!\\big(S_{\\max,i}, \\, \\max\\!\\big(S_i''(t), \\, 0\\big)\\big)$.\n- Output Metrics:\n  - Total grid-mean ET: $E_{\\mathrm{tot}} = \\sum_{t=0}^{T-1} \\overline{E}(t)$, where $\\overline{E}(t) = \\sum_{i=1}^N f_i \\, E_i(t)$.\n  - Final grid-mean soil moisture: $\\overline{S}(T) = \\sum_{i=1}^N f_i \\, S_i(T)$.\n\n**Test Cases:**\n- Five test cases are provided, each with $N=2$ tiles and a simulation period of $T=5$ days.\n- For each test case, the following are specified: $\\{f_i\\}$, $\\{S_{\\max,i}, S_{\\mathrm{fc},i}, S_{\\mathrm{wp},i}\\}$, $\\{k_{d,i}\\}$, $\\{K_{c,i}\\}$, $\\{S_i(0)\\}$, $E_0(t)$ for $t \\in [0,4]$, $P(t)$ for $t \\in [0,4]$, and $\\{I_i(t)\\}$ for $t \\in [0,4]$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem describes a tiled \"soil bucket\" water balance model. This is a standard, albeit simplified, approach used in land surface modeling, which is a sub-field of earth system modeling. The concepts of wilting point, field capacity, potential ET, soil moisture stress, and drainage are fundamental principles in soil physics and hydrology. The conservation of mass principle is correctly applied. The model is scientifically sound.\n- **Well-Posed**: The problem specifies a discrete-time iterative process. For a given set of initial conditions $S_i(0)$ and forcing data, the state $S_i(t+1)$ is uniquely determined by $S_i(t)$ through a sequence of well-defined algebraic operations. The parameters for all test cases are fully specified. A unique, stable, and meaningful solution exists.\n- **Objective**: The problem is stated in precise, mathematical language. It contains no subjective or opinion-based statements.\n- **Completeness and Consistency**: The problem provides all necessary numerical values for parameters, initial conditions, and forcing data for each of the five test cases. The units ($\\mathrm{mm}$, $\\mathrm{mm/day}$, $\\mathrm{day}^{-1}$) are consistent. The physical constraints $0 \\le S_{\\mathrm{wp},i} \\le S_{\\mathrm{fc},i} \\le S_{\\max,i}$ and $\\sum f_i = 1$ are satisfied by the given data. There are no contradictions.\n- **Relevance**: The task of modeling subgrid heterogeneity (different soil types/crop types represented by tiles) is a core topic in the parameterization of sub-grid scale processes in environmental and earth system modeling.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, complete, and consistent. It represents a valid and standard computational task in environmental modeling. Therefore, I will proceed with the solution.\n\n## Solution\n\nThe task is to implement a time-stepping simulation of a tiled soil moisture model for $N=2$ tiles over a period of $T=5$ days. The model updates the soil moisture storage $S_i(t)$ for each tile $i$ at each daily time step $t$ based on a sequence of physical processes: evapotranspiration, water inputs (precipitation and irrigation), drainage, and overflow. The goal is to compute the total grid-mean evapotranspiration $E_{\\mathrm{tot}}$ over the simulation period and the final grid-mean soil moisture $\\overline{S}(T)$.\n\nThe simulation proceeds by iterating from day $t=0$ to $t=T-1$. At each day $t$, and for each tile $i=1, \\dots, N$:\n\n1.  **Calculate Evapotranspiration ($E_i(t)$)**:\n    First, the soil moisture stress factor, $\\alpha_i$, is determined based on the current soil moisture $S_i(t)$ relative to the tile's wilting point $S_{\\mathrm{wp},i}$ and field capacity $S_{\\mathrm{fc},i}$.\n    $$\n    \\alpha_i(S_i(t)) = \n    \\begin{cases}\n    0,  S_i(t) \\le S_{\\mathrm{wp},i} \\\\\n    \\frac{S_i(t) - S_{\\mathrm{wp},i}}{S_{\\mathrm{fc},i} - S_{\\mathrm{wp},i}},  S_{\\mathrm{wp},i}  S_i(t)  S_{\\mathrm{fc},i} \\\\\n    1,  S_i(t) \\ge S_{\\mathrm{fc},i}\n    \\end{cases}\n    $$\n    The actual evapotranspiration $E_i(t)$ is then calculated by modulating the potential evapotranspiration $E_0(t)$ with the crop coefficient $K_{c,i}$ and the stress factor $\\alpha_i$.\n    $$\n    E_i(t) = K_{c,i} \\, E_0(t) \\, \\alpha_i(S_i(t))\n    $$\n\n2.  **Calculate Intermediate Storage ($S_i'(t)$)**:\n    An intermediate storage value, $S_i'(t)$, is computed by applying the water balance for the day, accounting for inputs and the ET calculated in the previous step.\n    $$\n    S_i'(t) = S_i(t) + P(t) + I_i(t) - E_i(t)\n    $$\n\n3.  **Calculate Drainage ($D_i(t)$) and Update Storage**:\n    Gravitational drainage $D_i(t)$ occurs only when the intermediate storage $S_i'(t)$ exceeds the field capacity $S_{\\mathrm{fc},i}$. The amount of drainage is proportional to this excess water, governed by the drainage coefficient $k_{d,i}$.\n    $$\n    D_i(t) = k_{d,i} \\, \\max(0, S_i'(t) - S_{\\mathrm{fc},i})\n    $$\n    This drainage is then removed from the intermediate storage to yield a second intermediate value, $S_i''(t)$.\n    $$\n    S_i''(t) = S_i'(t) - D_i(t)\n    $$\n\n4.  **Enforce Physical Limits and Determine Final Storage ($S_i(t+1)$)**:\n    The final step is to ensure the soil moisture for the next day, $S_i(t+1)$, respects the physical boundaries of the soil bucket. The storage cannot be negative, and it cannot exceed the maximum capacity $S_{\\max,i}$.\n    $$\n    S_i(t+1) = \\min(S_{\\max,i}, \\max(0, S_i''(t)))\n    $$\n    Any water in $S_i''(t)$ that exceeds $S_{\\max,i}$ is considered overflow runoff and is implicitly removed by the $\\min$ function.\n\n5.  **Aggregate Outputs**:\n    During each day $t$ of the simulation, the grid-mean evapotranspiration $\\overline{E}(t)$ is calculated by taking the area-weighted average of the tile-specific ET values.\n    $$\n    \\overline{E}(t) = \\sum_{i=1}^N f_i \\, E_i(t)\n    $$\n    This daily value is accumulated over the simulation period to find the total, $E_{\\mathrm{tot}}$.\n    $$\n    E_{\\mathrm{tot}} = \\sum_{t=0}^{T-1} \\overline{E}(t)\n    $$\n    After the final time step ($t=T-1$), the final soil moisture values $S_i(T)$ are used to compute the final grid-mean soil moisture $\\overline{S}(T)$.\n    $$\n    \\overline{S}(T) = \\sum_{i=1}^N f_i \\, S_i(T)\n    $$\n\nThis entire procedure is implemented for each of the five test cases provided. The parameters $\\{f_i, S_{\\max,i}, S_{\\mathrm{fc},i}, S_{\\mathrm{wp},i}, k_{d,i}, K_{c,i}\\}$ and initial conditions $S_i(0)$, along with the time series for $E_0(t)$, $P(t)$, and $I_i(t)$, are used as inputs to the simulation for each case. The final computed values of $E_{\\mathrm{tot}}$ and $\\overline{S}(T)$ for each case are rounded to three decimal places.",
            "answer": "[14.654,98.665,12.004,89.593,20.088,111.900,0.000,27.000,16.536,92.651]"
        }
    ]
}