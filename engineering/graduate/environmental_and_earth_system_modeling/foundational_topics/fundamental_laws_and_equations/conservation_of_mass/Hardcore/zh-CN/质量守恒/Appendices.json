{
    "hands_on_practices": [
        {
            "introduction": "环境与地球系统模型的核心在于其能够精确地追踪物质的流动和转化。箱式模型（box model）是构建这种理解的基石，它将复杂系统简化为一组相互连接的、均匀混合的隔室。这项练习将指导您从质量守恒的第一性原理出发，为经典的双箱交换系统建立数学模型，这对于理解如湖泊分层或大气区域间化学物质交换等现象至关重要。通过分析推导系统的稳态解，您将深入理解外部源、内部去除过程以及交换速率如何共同决定系统中的物质总量，并辨明在何种条件下系统能够实现内部质量守恒 。",
            "id": "3870092",
            "problem": "考虑两个充分混合的隔室，它们代表分层湖泊中的相邻区域。设上层箱中的示踪剂质量为 $M_1(t)$，下层箱中的示踪剂质量为 $M_2(t)$，其中 $t$ 为时间。两个箱体以速率参数 $r$（单位为 $\\mathrm{s}^{-1}$）对称地交换质量，这意味着在微小时间间隔 $\\mathrm{d}t$ 内，从箱1转移到箱2的质量为 $r M_1(t) \\mathrm{d}t$，从箱2转移到箱1的质量为 $r M_2(t) \\mathrm{d}t$。每个箱体都有一个外部源 $S_i$（单位为 $\\mathrm{kg\\,s}^{-1}$），其中 $i \\in \\{1,2\\}$，以及一个速率为 $k_i$（单位为 $\\mathrm{s}^{-1}$）的一阶去除过程，该过程会不可逆地将示踪剂从系统中移除（例如，由于化学转化或输出）。假设 $r  0$，$S_1 \\ge 0$，$S_2 \\ge 0$，$k_1 \\ge 0$ 且 $k_2 \\ge 0$。从质量守恒和交换过程的定义出发，写出 $M_1(t)$ 和 $M_2(t)$ 的控制性常微分方程（ODE），并解析推导稳态质量 $M_1^{\\star}$ 和 $M_2^{\\star}$。然后，使用第一性原理，确定在何种参数条件下，组合的双箱系统中的总质量 $M_{\\mathrm{T}}(t) = M_1(t) + M_2(t)$ 是守恒的，即其时间导数由于纯粹的内部交换（即没有来自外部强迫或内部移除的净产生或损失）而在所有状态和时间下都为零。为报告目的，请提供稳态总质量 $M_{\\mathrm{T}}^{\\star}$，作为一个关于 $S_1$，$S_2$，$r$，$k_1$ 和 $k_2$ 的单一闭式解析表达式。不需要进行数值取整。在最终表达式中，请以无单位形式表示 $M_{\\mathrm{T}}^{\\star}$。",
            "solution": "该问题要求推导双隔室系统的控制方程，确定其稳态质量，分析总质量守恒的条件，并给出稳态总质量的表达式。\n\n首先，我们基于质量守恒原理建立控制微分方程。对于任何控制体积，质量的变化率等于所有进入该体积的质量通量之和减去所有流出该体积的质量通量之和。\n\n对于上层箱（隔室1），其质量为 $M_1(t)$。\n进入箱1的通量有：\n1.  外部源：$S_1$\n2.  来自箱2的交换：$r M_2(t)$\n\n流出箱1的通量有：\n1.  去除过程：$k_1 M_1(t)$\n2.  向箱2的交换：$r M_1(t)$\n\n应用质量平衡原理，$M_1(t)$ 的控制性常微分方程（ODE）为：\n$$ \\frac{dM_1}{dt} = S_1 + r M_2(t) - k_1 M_1(t) - r M_1(t) $$\n$$ \\frac{dM_1}{dt} = S_1 + r M_2(t) - (k_1 + r) M_1(t) $$\n\n类似地，对于下层箱（隔室2），其质量为 $M_2(t)$。\n进入箱2的通量有：\n1.  外部源：$S_2$\n2.  来自箱1的交换：$r M_1(t)$\n\n流出箱2的通量有：\n1.  去除过程：$k_2 M_2(t)$\n2.  向箱1的交换：$r M_2(t)$\n\n$M_2(t)$ 的控制性常微分方程为：\n$$ \\frac{dM_2}{dt} = S_2 + r M_1(t) - k_2 M_2(t) - r M_2(t) $$\n$$ \\frac{dM_2}{dt} = S_2 + r M_1(t) - (k_2 + r) M_2(t) $$\n\n接下来，我们求解稳态质量，记为 $M_1^{\\star}$ 和 $M_2^{\\star}$。在稳态下，质量是恒定的，因此其时间导数为零：$\\frac{dM_1}{dt} = 0$ 和 $\\frac{dM_2}{dt} = 0$。这产生了一个由两个线性代数方程组成的方程组：\n$$ 0 = S_1 + r M_2^{\\star} - (k_1 + r) M_1^{\\star} $$\n$$ 0 = S_2 + r M_1^{\\star} - (k_2 + r) M_2^{\\star} $$\n将其重排为标准矩阵形式 $\\mathbf{A}\\mathbf{x} = \\mathbf{b}$：\n$$ (k_1 + r) M_1^{\\star} - r M_2^{\\star} = S_1 $$\n$$ -r M_1^{\\star} + (k_2 + r) M_2^{\\star} = S_2 $$\n这可以写成：\n$$ \\begin{pmatrix} k_1+r  -r \\\\ -r  k_2+r \\end{pmatrix} \\begin{pmatrix} M_1^{\\star} \\\\ M_2^{\\star} \\end{pmatrix} = \\begin{pmatrix} S_1 \\\\ S_2 \\end{pmatrix} $$\n为了求解 $M_1^{\\star}$ 和 $M_2^{\\star}$，我们可以使用克拉默法则（Cramer's rule）或矩阵求逆。系数矩阵的行列式为：\n$$ D = \\det \\begin{pmatrix} k_1+r  -r \\\\ -r  k_2+r \\end{pmatrix} = (k_1+r)(k_2+r) - (-r)(-r) $$\n$$ D = k_1 k_2 + k_1 r + k_2 r + r^2 - r^2 = k_1 k_2 + r(k_1+k_2) $$\n如果 $D \\neq 0$，则存在唯一的稳态解。给定 $r > 0$，$k_1 \\ge 0$ 和 $k_2 \\ge 0$，$D$ 仅在 $k_1=0$ 且 $k_2=0$ 时为零。我们假设至少有一个去除速率为正，从而确保 $D>0$。\n使用克拉默法则：\n$$ M_1^{\\star} = \\frac{\\det \\begin{pmatrix} S_1  -r \\\\ S_2  k_2+r \\end{pmatrix}}{D} = \\frac{S_1(k_2+r) - S_2(-r)}{k_1 k_2 + r(k_1+k_2)} = \\frac{S_1(k_2+r) + rS_2}{k_1 k_2 + r(k_1+k_2)} $$\n$$ M_2^{\\star} = \\frac{\\det \\begin{pmatrix} k_1+r  S_1 \\\\ -r  S_2 \\end{pmatrix}}{D} = \\frac{S_2(k_1+r) - S_1(-r)}{k_1 k_2 + r(k_1+k_2)} = \\frac{S_2(k_1+r) + rS_1}{k_1 k_2 + r(k_1+k_2)} $$\n\n第三个任务是确定总质量 $M_{\\mathrm{T}}(t) = M_1(t) + M_2(t)$ 守恒的条件。我们首先通过将 $M_1(t)$ 和 $M_2(t)$ 的常微分方程相加来求得 $M_{\\mathrm{T}}(t)$ 的常微分方程：\n$$ \\frac{dM_{\\mathrm{T}}}{dt} = \\frac{dM_1}{dt} + \\frac{dM_2}{dt} = \\left(S_1 + r M_2 - (k_1 + r) M_1\\right) + \\left(S_2 + r M_1 - (k_2 + r) M_2\\right) $$\n$$ \\frac{dM_{\\mathrm{T}}}{dt} = S_1 + S_2 + (r M_2 - r M_2) + (r M_1 - r M_1) - k_1 M_1 - k_2 M_2 $$\n$$ \\frac{dM_{\\mathrm{T}}}{dt} = S_1 + S_2 - k_1 M_1(t) - k_2 M_2(t) $$\n内部交换项 $r M_1$ 和 $r M_2$ 相互抵消，这意味着内部交换过程相对于系统总质量是守恒的。问题要求 $M_{\\mathrm{T}}$ 守恒的条件，这被定义为其时间导数由于“没有来自外部强迫或内部移除的净产生或损失”而为零。这意味着我们必须将 $dM_{\\mathrm{T}}/dt$ 的常微分方程中的相应项设为零。\n1.  来自外部强迫的净产生为零：$S_1 + S_2 = 0$。由于 $S_1 \\ge 0$ 且 $S_2 \\ge 0$，这要求 $S_1 = 0$ 且 $S_2 = 0$。\n2.  来自内部移除的净损失为零：$k_1 M_1(t) + k_2 M_2(t) = 0$。这必须对所有状态 $(M_1, M_2)$ 和时间都成立。由于 $M_1 \\ge 0$ 和 $M_2 \\ge 0$，且去除速率 $k_1 \\ge 0$ 和 $k_2 \\ge 0$，该方程仅当系数为零时，即 $k_1 = 0$ 且 $k_2 = 0$ 时，才能对所有非平凡状态成立。\n因此，总质量守恒的参数条件是 $S_1 = S_2 = k_1 = k_2 = 0$。\n\n最后，我们被要求提供一般情况下的稳态总质量 $M_{\\mathrm{T}}^{\\star} = M_1^{\\star} + M_2^{\\star}$。我们将推导出的 $M_1^{\\star}$ 和 $M_2^{\\star}$ 的表达式相加：\n$$ M_{\\mathrm{T}}^{\\star} = \\frac{S_1(k_2+r) + rS_2}{k_1 k_2 + r(k_1+k_2)} + \\frac{S_2(k_1+r) + rS_1}{k_1 k_2 + r(k_1+k_2)} $$\n$$ M_{\\mathrm{T}}^{\\star} = \\frac{S_1(k_2+r) + rS_2 + S_2(k_1+r) + rS_1}{k_1 k_2 + r(k_1+k_2)} $$\n展开分子：\n$$ \\text{分子} = S_1 k_2 + S_1 r + r S_2 + S_2 k_1 + S_2 r + r S_1 $$\n$$ \\text{分子} = S_1 k_2 + S_2 k_1 + 2r(S_1 + S_2) $$\n因此，稳态总质量为：\n$$ M_{\\mathrm{T}}^{\\star} = \\frac{S_1 k_2 + S_2 k_1 + 2r(S_1 + S_2)}{k_1 k_2 + r(k_1 + k_2)} $$\n这就是稳态下总质量的最终闭式表达式。",
            "answer": "$$\n\\boxed{\\frac{S_1 k_2 + S_2 k_1 + 2r(S_1 + S_2)}{k_1 k_2 + r(k_1 + k_2)}}\n$$"
        },
        {
            "introduction": "将描述连续介质的守恒律（以偏微分方程形式表示）转化为可靠的计算机代码，是环境建模的一项核心技能。本练习将带您进入计算流体动力学的世界，为一维标量连续性方程 $\\partial_t \\rho + \\partial_x (u\\rho)=0$ 实施一个Godunov有限体积格式 。您将学习如何通过迎风格式（upwind scheme）来构建在物理上合理的数值通量，这种方法对于正确模拟平流（advection）主导的输运过程至关重要。通过在不同的Courant–Friedrichs–Lewy (CFL) 数值下测试模型的质量守恒特性，您将亲身体验数值稳定性理论的实际意义，并验证一个设计良好的保守格式如何在离散计算中忠实地维护物理守恒律。",
            "id": "3870114",
            "problem": "您需要在一个周期性域上，为具有空间变化速度的标量连续性方程实现一个一维 Godunov 有限体积格式，以在不同的 Courant–Friedrichs–Lewy (CFL) 数下数值地验证质量守恒。控制方程是一维空间中的质量守恒（连续性）定律，\n$$\n\\partial_t \\rho(x,t) + \\partial_x \\left(u(x)\\,\\rho(x,t)\\right) = 0,\n$$\n其中 $\\rho(x,t)$ 是质量密度，$u(x)$ 是一个给定的速度场。物理单位如下：$x$ 的单位是 $\\mathrm{m}$，$t$ 的单位是 $\\mathrm{s}$，$u$ 的单位是 $\\mathrm{m}\\,\\mathrm{s}^{-1}$，$\\rho$ 的单位是 $\\mathrm{kg}\\,\\mathrm{m}^{-1}$。在时间 $t$ 的总质量为\n$$\nM(t) = \\int_0^L \\rho(x,t)\\,dx \\quad \\text{in } \\mathrm{kg}.\n$$\n任务是将域 $[0,L]$ 均匀离散为 $N_x$ 个有限体积，并采用周期性边界条件，然后使用一个遵循守恒律结构的 Godunov 格式在时间上推进解。在此背景下，单元交界面处的 Godunov 通量由局部黎曼问题的精确解确定，对于线性通量 $f(\\rho;x) = u(x)\\,\\rho$，该解相对于局部交界面速度的符号是迎风的。\n\n您的实现必须遵守以下要求：\n- 使用均匀空间网格，单元宽度为 $\\Delta x = L/N_x$，单元中心为 $x_i = (i+\\tfrac{1}{2})\\Delta x$，其中 $i \\in \\{0,1,\\dots,N_x-1\\}$。\n- 定义交界面位置为 $x_{i+\\tfrac{1}{2}} = (i+1)\\Delta x$，其中 $i \\in \\{0,1,\\dots,N_x-1\\}$，并通过周期性将 $x_{N_x+\\tfrac{1}{2}}$ 与 $x_{\\tfrac{1}{2}}$ 等同。\n- 在交界面上计算速度场，$u_{i+\\tfrac{1}{2}} = u(x_{i+\\tfrac{1}{2}})$，并计算 Godunov 通量\n$$\nF_{i+\\tfrac{1}{2}} = \n\\begin{cases}\nu_{i+\\tfrac{1}{2}}\\,\\rho_i,  \\text{if } u_{i+\\tfrac{1}{2}} \\ge 0,\\\\\nu_{i+\\tfrac{1}{2}}\\,\\rho_{i+1},  \\text{if } u_{i+\\tfrac{1}{2}}  0,\n\\end{cases}\n$$\n其中 $\\rho_i$ 是单元 $i$ 中的分段常数单元平均值。\n- 使用守恒型有限体积更新公式来更新单元平均值\n$$\n\\rho_i^{n+1} = \\rho_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right),\n$$\n对 $n = 0,1,\\dots$，其中使用周期性索引。\n- 从指定的 Courant–Friedrichs–Lewy (CFL) 数选择时间步长 $\\Delta t$，\n$$\n\\mathrm{CFL} = \\max_i \\frac{|u_{i+\\tfrac{1}{2}}|\\,\\Delta t}{\\Delta x},\n$$\n通过设置 $\\Delta t = \\mathrm{CFL}\\,\\Delta x / \\max_i |u_{i+\\tfrac{1}{2}}|$，并调整最后一步的时间步长，以使解能精确达到指定的最终时间。\n\n对于每次模拟，在每个时间步 $n$ 计算总质量 $M^n = \\sum_{i=0}^{N_x-1} \\rho_i^n\\,\\Delta x$，并报告整个运行过程中的最大绝对相对偏差，\n$$\n\\delta_{\\max} = \\max_n \\left|\\frac{M^n - M^0}{M^0}\\right|,\n$$\n这是一个无量纲的小数。质量必须在内部以 $\\mathrm{kg}$ 为单位进行计算，且偏差 $\\delta_{\\max}$ 必须表示为小数（不带百分号）。\n\n为以下测试套件实现该格式。域和场为：\n- 域长度 $L = 1\\,\\mathrm{m}$，单元数 $N_x = 400$，最终时间 $T = 1\\,\\mathrm{s}$。\n- 速度场 $u(x) = u_0 + a \\sin\\left(2\\pi x / L\\right)$，其中 $u_0 = 0.3\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，$a = 0.5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，该速度场在域上会改变符号。\n- 初始密度 $\\rho_0(x) = 1.0\\,\\mathrm{kg}\\,\\mathrm{m}^{-1} + 0.5\\,\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\sin\\left(4\\pi x / L\\right)$，以确保空间变化的同时保持严格为正。\n\n运行四次数值模拟，它们仅在 CFL 数上有所不同：\n- 情况 1：$\\mathrm{CFL} = 0.2$。\n- 情况 2：$\\mathrm{CFL} = 0.5$。\n- 情况 3：$\\mathrm{CFL} = 0.9$。\n- 情况 4：$\\mathrm{CFL} = 1.2$。\n\n对于每种情况，计算在 $t \\in [0,T]$ 上的 $\\delta_{\\max}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个值都应采用具有 $10$ 位有效数字的科学记数法格式（例如，$[1.2345678900e-03,3.2100000000e-05]$）。输出必须是列表 $[\\delta_{\\max}^{(1)},\\delta_{\\max}^{(2)},\\delta_{\\max}^{(3)},\\delta_{\\max}^{(4)}]$，按上面列出的顺序对应四种 CFL 情况。",
            "solution": "用户希望验证应用于具有空间变化速度场的标量连续性方程的一维 Godunov 有限体积格式的质量守恒性。\n\n### 步骤 1：提取已知条件\n- **控制方程**：$\\partial_t \\rho(x,t) + \\partial_x \\left(u(x)\\,\\rho(x,t)\\right) = 0$。\n- **域**：$x \\in [0,L]$，采用周期性边界条件。\n- **参数**：\n    - 域长度：$L = 1\\,\\mathrm{m}$。\n    - 单元数：$N_x = 400$。\n    - 最终时间：$T = 1\\,\\mathrm{s}$。\n- **速度场**：$u(x) = u_0 + a \\sin\\left(2\\pi x / L\\right)$，其中 $u_0 = 0.3\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，$a = 0.5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n- **初始条件**：$\\rho(x,0) = \\rho_0(x) = 1.0\\,\\mathrm{kg}\\,\\mathrm{m}^{-1} + 0.5\\,\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\sin\\left(4\\pi x / L\\right)$。\n- **离散化**：\n    - 单元宽度为 $\\Delta x = L/N_x$ 的均匀网格。\n    - 单元中心：$x_i = (i+\\tfrac{1}{2})\\Delta x$，其中 $i \\in \\{0, \\dots, N_x-1\\}$。\n    - 单元交界面：$x_{i+\\tfrac{1}{2}} = (i+1)\\Delta x$，其中 $i \\in \\{0, \\dots, N_x-1\\}$。\n- **数值格式（Godunov 有限体积）**：\n    - 交界面速度：$u_{i+\\tfrac{1}{2}} = u(x_{i+\\tfrac{1}{2}})$。\n    - 交界面 $x_{i+\\tfrac{1}{2}}$ 处的 Godunov 通量：\n      $$\n      F_{i+\\tfrac{1}{2}} = \n      \\begin{cases}\n      u_{i+\\tfrac{1}{2}}\\,\\rho_i,  \\text{if } u_{i+\\tfrac{1}{2}} \\ge 0,\\\\\n      u_{i+\\tfrac{1}{2}}\\,\\rho_{i+1},  \\text{if } u_{i+\\tfrac{1}{2}}  0.\n      \\end{cases}\n      $$\n    - 更新规则：$\\rho_i^{n+1} = \\rho_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right)$。\n- **时间步长**：$\\Delta t = \\mathrm{CFL}\\,\\Delta x / \\max_i |u_{i+\\tfrac{1}{2}}|$，并调整最后一步以精确达到 $T$。\n- **测试用例**：四次使用 Courant–Friedrichs–Lewy (CFL) 数的模拟：\n    - 情况 1：$\\mathrm{CFL} = 0.2$。\n    - 情况 2：$\\mathrm{CFL} = 0.5$。\n    - 情况 3：$\\mathrm{CFL} = 0.9$。\n    - 情况 4：$\\mathrm{CFL} = 1.2$。\n- **输出指标**：对每种情况，计算在整个模拟时间内的总质量的最大绝对相对偏差：\n    - 时间步 $n$ 的总质量：$M^n = \\sum_{i=0}^{N_x-1} \\rho_i^n\\,\\Delta x$。\n    - 指标：$\\delta_{\\max} = \\max_n \\left|\\frac{M^n - M^0}{M^0}\\right|$。\n- **最终输出格式**：一个用方括号括起来的、包含四个 $\\delta_{\\max}$ 值的逗号分隔列表，每个值都采用具有10位有效数字的科学记数法。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题在根本上是合理的。它涉及连续性方程，这是质量守恒的直接陈述，也是物理学的基石之一。Godunov 方法是求解双曲守恒律的一种成熟且标准的数值技术。CFL 条件是此类方程的显式数值格式稳定性的一个关键且正确的概念。\n2.  **适定性**：该问题是适定的。偏微分方程、初始条件和周期性边界条件构成了一个标准的初值问题。数值方法和所有必要的参数都已完全指定，确保可以计算出唯一的离散解。所要求的输出是一个确定性且可计算的度量。\n3.  **客观性**：该问题以精确的数学和数值定义陈述。所有参数和函数都已明确给出。没有主观性语言。\n4.  **完整性和一致性**：该问题提供了所有必要的信息。参数 $L, N_x, T$，函数 $u(x)$ 和 $\\rho_0(x)$，以及 CFL 数都已指定。数值格式的描述清晰明确。\n5.  **合理性**：物理参数和函数是合理的。初始密度 $\\rho_0(x) = 1.0 + 0.5\\sin(4\\pi x/L)$ 是严格为正的，因为其最小值为 $1.0 - 0.5 = 0.5\\,\\mathrm{kg}\\,\\mathrm{m}^{-1}$。速度场 $u(x)$ 会改变符号，这为迎风逻辑提供了一个非平凡的测试。包含 $\\mathrm{CFL} = 1.2$ 的情况是对该格式稳定性极限（对于一阶迎风格式，即 $\\mathrm{CFL} \\le 1$）的一个标准且信息丰富的测试，旨在展示违反此条件的后果。\n\n### 步骤 3：结论与行动\n问题陈述是有效的。它科学合理、适定且完整。我将继续开发解决方案。\n\n### 基于原理的解决方案设计\n\n问题的核心是实现一个守恒型有限体积格式。守恒性质源于更新规则的形式，该规则将单元平均密度的变化表示为其边界上的净通量。\n\n1.  **离散化与初始化**：\n    - 连续域 $[0, L]$ 被离散为 $N_x$ 个单元。我们定义两个网格：一个用于单元中心 $x_i$，一个用于单元交界面 $x_{i+\\tfrac{1}{2}}$。\n    - 速度场 $u(x)$ 与时间无关，因此可以在交界面位置 $x_{i+\\tfrac{1}{2}}$ 上预先计算，得到一个常数数组 $u_{i+\\tfrac{1}{2}}$。\n    - 每个单元的初始密度 $\\rho_i^0$ 是通过在单元中心 $x_i$ 处计算初始条件函数 $\\rho_0(x)$ 的值得到的。这代表了对初始状态的分段常数近似。\n    - 时间步长 $\\Delta t$ 是根据给定的 CFL 数和最大绝对交界面速度计算的，以确保稳定性（对于 $\\mathrm{CFL} \\le 1$）。\n    - 计算并存储初始总质量 $M^0 = \\sum_{i=0}^{N_x-1} \\rho_i^0 \\Delta x$。这是我们进行守恒性检查的参考值。解析上，$M^0 = \\int_0^1 (1.0 + 0.5\\sin(4\\pi x)) dx = [x - \\frac{0.5}{4\\pi}\\cos(4\\pi x)]_0^1 = 1.0\\,\\mathrm{kg}$。数值求和将非常接近这个值。\n\n2.  **时间演化**：解从 $t=0$ 演化到 $t=T$。使用一个 `while` 循环来完成此过程。\n    - **最后一步调整**：在每次迭代中，确定时间步长 `current_dt`。它通常是预先计算的 $\\Delta t$，但对于最后一步，它被调整为 $T - t$，以确保模拟在 $t=T$ 时精确结束。\n    - **通量计算**：在每个时间步 $n$，计算所有单元交界面处的数值通量 $F_{i+\\tfrac{1}{2}}^n$。对于这个线性平流问题，Godunov 格式简化为一阶迎风格式。通量 $F_{i+\\tfrac{1}{2}}$ 取决于该交界面上速度 $u_{i+\\tfrac{1}{2}}$ 的符号：\n        - 如果 $u_{i+\\tfrac{1}{2}} \\ge 0$，信息从左向右流动，因此通量由“迎风”密度 $\\rho_i^n$ 决定。\n        - 如果 $u_{i+\\tfrac{1}{2}}  0$，信息从右向左流动，因此通量由“迎风”密度 $\\rho_{i+1}^n$ 决定。\n    这个逻辑使用矢量化操作同时对所有交界面实现。\n    - **周期性边界**：周期性通过使用数组滚动操作（例如 `numpy.roll`）来处理。为了得到所有 $i$ 的右邻居密度 $\\rho_{i+1}$，整个 $\\rho$ 数组被滚动。类似地，为了得到左交界面的通量 $F_{i-\\tfrac{1}{2}}$，整个通量数组 $F$ 被滚动。\n    - **守恒更新**：使用离散守恒律更新单元平均密度：$\\rho_i^{n+1} = \\rho_i^n - \\frac{\\Delta t}{\\Delta x}(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n)$。这种形式的一个关键方面是，当对所有单元求和时，由于周期性，通量项会伸缩相消，即 $\\sum_i (F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}) = 0$。这确保了在精确算术中总质量 $\\sum_i \\rho_i \\Delta x$ 是守恒的。在模拟中观察到的任何偏差都将归因于浮点舍入误差。\n\n3.  **质量守恒分析**：\n    - 在每个时间步，更新 $\\rho$ 后，计算新的总质量 $M^n$。\n    - 计算并存储绝对相对偏差 $\\left|\\frac{M^n - M^0}{M^0}\\right|$。\n    - 在针对给定 CFL 数的模拟完成后，找到所有存储偏差中的最大值。这就是 $\\delta_{\\max}$。\n\n4.  **CFL 情况**：\n    - 整个模拟运行四次，每个指定的 CFL 数一次。\n    - 对于 $\\mathrm{CFL} \\in \\{0.2, 0.5, 0.9\\}$，格式是稳定的，预计 $\\delta_{\\max}$ 会非常小，在机器精度的数量级上，这反映了浮点误差的累积。\n    - 对于 $\\mathrm{CFL} = 1.2$，格式是不稳定的。数值解将出现增长的振荡，导致质量守恒出现快速而巨大的偏差。由此产生的 $\\delta_{\\max}$ 将是一个大数，清楚地表明了不稳定性。\n\n最终的实现将封装这一逻辑，运行四个测试用例，并按要求格式化生成的 $\\delta_{\\max}$ 值列表。",
            "answer": "[2.2204460493e-16,4.4408920985e-16,4.4408920985e-16,2.1558999395e+04]"
        },
        {
            "introduction": "在真实的模型开发和应用中，验证模型的正确性与开发模型本身同样重要。一个常见且关键的验证步骤是诊断模型的质量守恒特性，确保数值解法没有引入虚假的物质“泄漏”或“产生”。这项练习模拟了这一重要的诊断过程 。您将获得一个包含平流、扩散和化学反应的复杂（尽管是假设的）有限体积模型的输出数据，您的任务是扮演模型分析师的角色。通过对给定时间步前后的浓度数据、边界通量和反应速率进行精确的质量预算核算，您将计算出系统中未被物理解释的总质量变化，从而量化模型的“质量泄漏”，这是评估和改进任何地球系统模型的必备技能。",
            "id": "3870088",
            "problem": "考虑一个一维、双单元的有限体积模型，该模型描述了一个河道段中三种溶解物质（记为 $A$、$B$ 和 $C$）的输运和反应过程。每种物质都遵循由质量守恒定律推导出的平流-扩散-反应方程。设物质 $i$ 的控制方程为 \n$\\frac{\\partial c_{i}}{\\partial t} + \\nabla \\cdot \\boldsymbol{J}_{i} = r_{i}$， \n其中 $c_{i}$ 是质量浓度，$\\boldsymbol{J}_{i}$ 是总通量（平流加扩散），$r_{i}$ 是由反应引起的质量生成率。反应为 \n$A + B \\rightleftharpoons C$ \n其质量守恒的化学计量关系由两个非负速率密度 $\\rho_{1}$ 和 $\\rho_{2}$（单位为 $\\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$）表示，即\n$r_{A} = -\\rho_{1} + \\rho_{2}$，$r_{B} = -\\rho_{1} + \\rho_{2}$，$r_{C} = 2\\rho_{1} - 2\\rho_{2}$，\n因此逐点满足 $\\sum_{i \\in \\{A,B,C\\}} r_{i} = 0$。\n\n在两个体积相等的单元（$j=1,2$），其体积为 $V_{1} = V_{2} = 1000\\ \\mathrm{m}^{3}$，时间步长为 $\\Delta t = 3600\\ \\mathrm{s}$ 的条件下，执行从时间 $t^{n}$ 到 $t^{n+1} = t^{n} + \\Delta t$ 的有限体积时间更新。设 $M_{i,j}^{n} = V_{j} c_{i,j}^{n}$ 表示在时间 $t^{n}$ 时，单元 $j$ 中物质 $i$ 的质量。\n\n你的任务是通过对物质方程求和并消除内部界面交换，来构建一个用于总质量守恒的区域积分诊断量，从而分离出由离散化引起的任何差异。将该时间步长内的区域质量变化定义为 $\\Delta M_{\\mathrm{tot}} = \\sum_{i}\\sum_{j} \\left(M_{i,j}^{n+1} - M_{i,j}^{n}\\right)$。每种物质在左（$L$）和右（$R$）边界的向外（离开区域）净边界通量率 $F_{i}^{L}$ 和 $F_{i}^{R}$ 在整个时间步长内为常数，单位为 $\\mathrm{kg}\\ \\mathrm{s}^{-1}$，并约定向外为正。\n\n数据：\n- 单元体积：$V_{1} = V_{2} = 1000\\ \\mathrm{m}^{3}$。\n- 时间步长：$\\Delta t = 3600\\ \\mathrm{s}$。\n- 在 $t^{n}$ 时的浓度：\n  $c_{A,1}^{n} = 1.200\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，$c_{A,2}^{n} = 0.800\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，\n  $c_{B,1}^{n} = 0.900\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，$c_{B,2}^{n} = 1.300\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，\n  $c_{C,1}^{n} = 0.700\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，$c_{C,2}^{n} = 0.600\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$。\n- 在 $t^{n+1}$ 时的浓度：\n  $c_{A,1}^{n+1} = 1.160\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，$c_{A,2}^{n+1} = 0.780\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，\n  $c_{B,1}^{n+1} = 0.880\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，$c_{B,2}^{n+1} = 1.260\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，\n  $c_{C,1}^{n+1} = 0.690\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，$c_{C,2}^{n+1} = 0.545\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$。\n- 反应速率密度（假定在时间步长内单元恒定）：\n  $\\rho_{1,1} = 0.010\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$，$\\rho_{2,1} = 0.008\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$，\n  $\\rho_{1,2} = 0.006\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$，$\\rho_{2,2} = 0.007\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$。\n- 边界通量率（向外为正）：\n  $F_{A}^{L} = 0.05\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$，$F_{B}^{L} = -0.02\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$，$F_{C}^{L} = 0.00\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$，\n  $F_{A}^{R} = 0.03\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$，$F_{B}^{R} = 0.01\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$，$F_{C}^{R} = -0.02\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$。\n\n任务：\n1. 从物质守恒定律和每个单元的有限体积平衡方程出发，推导单步区域积分的“质量泄漏”诊断量 $L$ 的闭式表达式。$L$ 定义为未能解释的总质量变化，即实际区域质量变化与边界通量和反应项之和所预测的变化之间的差值。\n2. 使用所提供的数据计算 $L$ 的值。\n\n最终答案以千克为单位，并四舍五入至四位有效数字。",
            "solution": "首先验证该问题，以确保其具有科学依据、适定且客观。\n\n### 步骤 1：提取已知条件\n- 物质 $i$ 的控制方程：$\\frac{\\partial c_{i}}{\\partial t} + \\nabla \\cdot \\boldsymbol{J}_{i} = r_{i}$。\n- 涉及的物质：$A$、$B$、$C$。\n- 反应化学计量：$A + B \\rightleftharpoons C$。\n- 质量生成率：$r_{A} = -\\rho_{1} + \\rho_{2}$，$r_{B} = -\\rho_{1} + \\rho_{2}$，$r_{C} = 2\\rho_{1} - 2\\rho_{2}$。这些速率确保 $\\sum_{i \\in \\{A,B,C\\}} r_{i} = 0$。\n- 有限体积模型：$2$ 个单元，$j=1,2$。\n- 单元体积：$V_{1} = V_{2} = V = 1000\\ \\mathrm{m}^{3}$。\n- 时间步长：$\\Delta t = 3600\\ \\mathrm{s}$。\n- 物质质量：$M_{i,j}^{n} = V_{j} c_{i,j}^{n}$。\n- 边界通量率（向外为正）：$F_{i}^{L}$，$F_{i}^{R}$，单位为 $\\mathrm{kg}\\ \\mathrm{s}^{-1}$。\n- 在 $t^{n}$ 时的浓度：$c_{A,1}^{n} = 1.200$，$c_{A,2}^{n} = 0.800$，$c_{B,1}^{n} = 0.900$，$c_{B,2}^{n} = 1.300$，$c_{C,1}^{n} = 0.700$，$c_{C,2}^{n} = 0.600$（单位均为 $\\mathrm{kg}\\ \\mathrm{m}^{-3}$）。\n- 在 $t^{n+1}$ 时的浓度：$c_{A,1}^{n+1} = 1.160$，$c_{A,2}^{n+1} = 0.780$，$c_{B,1}^{n+1} = 0.880$，$c_{B,2}^{n+1} = 1.260$，$c_{C,1}^{n+1} = 0.690$，$c_{C,2}^{n+1} = 0.545$（单位均为 $\\mathrm{kg}\\ \\mathrm{m}^{-3}$）。\n- 反应速率密度：$\\rho_{1,1} = 0.010$，$\\rho_{2,1} = 0.008$，$\\rho_{1,2} = 0.006$，$\\rho_{2,2} = 0.007$（单位均为 $\\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$）。\n- 边界通量率：$F_{A}^{L} = 0.05$，$F_{B}^{L} = -0.02$，$F_{C}^{L} = 0.00$，$F_{A}^{R} = 0.03$，$F_{B}^{R} = 0.01$，$F_{C}^{R} = -0.02$（单位均为 $\\mathrm{kg}\\ \\mathrm{s}^{-1}$）。\n- 待求诊断量：质量泄漏 $L$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题基于标准的平流-扩散-反应方程及其有限体积离散化，具有科学依据。基于质量的反应速率的定义，$r_A+r_B+r_C = (-\\rho_1+\\rho_2) + (-\\rho_1+\\rho_2) + (2\\rho_1-2\\rho_2) = 0$，与化学反应中的质量守恒原理一致。该问题提供了计算所需诊断量的所有必要数据和定义。它是适定、客观的，并且没有科学或逻辑上的缺陷。\n\n### 步骤 3：结论与行动\n问题有效。将提供解答。\n\n### 第 1 部分：质量泄漏诊断量 L 的推导\n\n物质 $i$ 在控制体积 $V_j$ 内的质量守恒，通过对控制偏微分方程在体积 $V_j$ 上积分得到：\n$$ \\int_{V_j} \\frac{\\partial c_i}{\\partial t} dV + \\int_{V_j} \\nabla \\cdot \\boldsymbol{J}_i dV = \\int_{V_j} r_i dV $$\n使用散度定理，通量项变为边界 $\\partial V_j$ 上的面积分：\n$$ \\frac{d}{dt} \\int_{V_j} c_i dV + \\oint_{\\partial V_j} \\boldsymbol{J}_i \\cdot \\mathbf{n} dS = \\int_{V_j} r_i dV $$\n在有限体积离散化中，我们考虑在单元 $j$ 和时间步长 $\\Delta t = t^{n+1} - t^n$ 内的平均量。单元 $j$ 中物质 $i$ 的质量为 $M_{i,j} = V_j c_{i,j}$。单元 $j$ 中物质 $i$ 的质量平衡的显式时间离散形式为：\n$$ \\frac{M_{i,j}^{n+1} - M_{i,j}^{n}}{\\Delta t} + \\mathcal{F}_{i,j} = V_j r_{i,j} $$\n其中 $\\mathcal{F}_{i,j}$ 是物质 $i$ 通过单元 $j$ 所有界面流出的净质量速率，$r_{i,j}$ 是单元 $j$ 内的平均质量生成率。问题要求一个区域积分的诊断量。我们将此方程对所有物质 $i \\in \\{A, B, C\\}$ 和所有单元 $j \\in \\{1, 2\\}$ 求和：\n$$ \\sum_{i,j} \\frac{M_{i,j}^{n+1} - M_{i,j}^{n}}{\\Delta t} + \\sum_{i,j} \\mathcal{F}_{i,j} = \\sum_{i,j} V_j r_{i,j} $$\n第一项可以使用总区域质量变化的定义 $\\Delta M_{\\mathrm{tot}} = \\sum_{i,j} (M_{i,j}^{n+1} - M_{i,j}^{n})$ 来重写。\n通量求和项 $\\sum_{i,j} \\mathcal{F}_{i,j}$ 涉及对所有单元的所有界面上的通量进行求和。对于相邻单元之间的内部界面，离开一个单元的通量等于进入相邻单元的通量。因此，在全区域求和中，这些内部通量会相互抵消。剩下的是区域外部边界上的通量。\n$$ \\sum_{i,j} \\mathcal{F}_{i,j} = \\sum_i (F_i^L + F_i^R) $$\n这个和是离开区域的总净质量速率，其中符号约定 $F_i^L$ 和 $F_i^R$ 对于向外通量为正。\n\n反应项求和 $\\sum_{i,j} V_j r_{i,j}$ 可以按单元分组：$\\sum_j V_j (\\sum_i r_{i,j})$。问题陈述反应的化学计量关系是质量守恒的，即在每一点上 $\\sum_i r_i = 0$。因此，对于每个单元 $j$，$\\sum_i r_{i,j} = 0$。我们可以用提供的速率定义来验证这一点：对于任何单元 $j$，$\\sum_i r_{i,j} = r_{A,j} + r_{B,j} + r_{C,j} = (-\\rho_{1,j} + \\rho_{2,j}) + (-\\rho_{1,j} + \\rho_{2,j}) + (2\\rho_{1,j} - 2\\rho_{2,j}) = 0$。因此，总反应对总质量变化的贡献为零：$\\sum_{i,j} V_j r_{i,j} = 0$。\n\n整个区域的理想质量平衡为：\n$$ \\frac{\\Delta M_{\\mathrm{tot}}}{\\Delta t} + \\sum_i (F_i^L + F_i^R) = 0 \\implies \\Delta M_{\\mathrm{tot}} = -\\Delta t \\sum_i (F_i^L + F_i^R) $$\n该方程表明，区域内总质量的变化与跨越其边界的净质量输运完全平衡。\n\n质量泄漏诊断量 $L$ 定义为未能解释的总质量变化，即数值计算的质量平衡的残差。它是实际质量变化减去所有指定物理过程（通量和反应）预测的变化：\n$$ L = \\Delta M_{\\mathrm{tot}} - \\left( -\\Delta t \\sum_i (F_i^L + F_i^R) + \\Delta t \\sum_{i,j} V_j r_{i,j} \\right) $$\n由于总反应项为零：\n$$ L = \\Delta M_{\\mathrm{tot}} + \\Delta t \\sum_{i \\in \\{A,B,C\\}} (F_i^L + F_i^R) $$\n这是质量泄漏诊断量的最终表达式。\n\n### 第 2 部分：L 的计算\n现在我们使用提供的数据计算该表达式的值。\n\n首先，计算实际的总质量变化 $\\Delta M_{\\mathrm{tot}}$。\n在时间 $t^n$ 的总质量为 $M_{\\mathrm{tot}}^n = \\sum_{i,j} M_{i,j}^{n} = \\sum_{i,j} V_j c_{i,j}^{n}$。由于 $V_1 = V_2 = V = 1000\\ \\mathrm{m}^3$：\n$M_{\\mathrm{tot}}^n = V \\sum_{i,j} c_{i,j}^{n} = 1000 \\times (1.200 + 0.800 + 0.900 + 1.300 + 0.700 + 0.600)$\n$M_{\\mathrm{tot}}^n = 1000 \\times (5.500) = 5500\\ \\mathrm{kg}$。\n\n在时间 $t^{n+1}$ 的总质量为 $M_{\\mathrm{tot}}^{n+1} = \\sum_{i,j} M_{i,j}^{n+1} = V \\sum_{i,j} c_{i,j}^{n+1}$：\n$M_{\\mathrm{tot}}^{n+1} = 1000 \\times (1.160 + 0.780 + 0.880 + 1.260 + 0.690 + 0.545)$\n$M_{\\mathrm{tot}}^{n+1} = 1000 \\times (5.315) = 5315\\ \\mathrm{kg}$。\n\n实际总质量变化为：\n$$ \\Delta M_{\\mathrm{tot}} = M_{\\mathrm{tot}}^{n+1} - M_{\\mathrm{tot}}^{n} = 5315 - 5500 = -185\\ \\mathrm{kg} $$\n\n接下来，计算在时间步长 $\\Delta t$ 内通过边界从区域输运出的总质量。\n总向外通量率：\n$$ \\sum_i (F_i^L + F_i^R) = (F_A^L + F_B^L + F_C^L) + (F_A^R + F_B^R + F_C^R) $$\n$$ = (0.05 - 0.02 + 0.00) + (0.03 + 0.01 - 0.02) $$\n$$ = (0.03) + (0.02) = 0.05\\ \\mathrm{kg}\\ \\mathrm{s}^{-1} $$\n输运出的总质量是该速率乘以时间步长 $\\Delta t = 3600\\ \\mathrm{s}$：\n$$ \\Delta t \\sum_i (F_i^L + F_i^R) = 3600\\ \\mathrm{s} \\times 0.05\\ \\mathrm{kg}\\ \\mathrm{s}^{-1} = 180\\ \\mathrm{kg} $$\n\n最后，计算泄漏量 $L$：\n$$ L = \\Delta M_{\\mathrm{tot}} + \\Delta t \\sum_i (F_i^L + F_i^R) $$\n$$ L = -185\\ \\mathrm{kg} + 180\\ \\mathrm{kg} = -5\\ \\mathrm{kg} $$\n$L$ 的负值表示系统损失了 $5\\ \\mathrm{kg}$ 的质量，而这部分损失无法由指定的向外边界通量来解释。这代表了从 $t^n$ 到 $t^{n+1}$ 的模拟步中的数值质量损失误差。\n\n按要求四舍五入到四位有效数字，结果为 $-5.000\\ \\mathrm{kg}$。",
            "answer": "$$\\boxed{-5.000}$$"
        }
    ]
}