{
    "hands_on_practices": [
        {
            "introduction": "Understanding the chemical form, or speciation, of a dissolved substance is fundamental to predicting its transport, toxicity, and reactivity in the environment. This first practice focuses on the equilibrium of a polyprotic acid, a common model for substances like phosphoric or carbonic acid. You will derive the species distribution functions from first principles and then apply them to a hypothetical groundwater scenario, accounting for the non-ideal effects of ionic strength to build a more realistic model of aqueous chemistry. ",
            "id": "3867376",
            "problem": "A groundwater sample in a phosphate-impacted aquifer is approximated as a uniform aqueous solution at $25\\,^{\\circ}\\mathrm{C}$ with ionic strength $I = 0.10\\,\\mathrm{mol\\,L^{-1}}$. Phosphoric acid, denoted generically as a triprotic acid $H_{3}A$, undergoes stepwise deprotonations $H_{3}A \\rightleftharpoons H_{2}A^{-} + H^{+}$, $H_{2}A^{-} \\rightleftharpoons HA^{2-} + H^{+}$, and $HA^{2-} \\rightleftharpoons A^{3-} + H^{+}$. The thermodynamic (activity-based) acid dissociation constants at infinite dilution are given by $pK_{a1}^{\\mathrm{a}} = 2.148$, $pK_{a2}^{\\mathrm{a}} = 7.198$, and $pK_{a3}^{\\mathrm{a}} = 12.375$ at $25\\,^{\\circ}\\mathrm{C}$. The measured $\\mathrm{pH}$ of the sample is $7.50$ (defined by $\\mathrm{pH} = -\\log_{10} a_{H^{+}}$ where $a_{H^{+}}$ is the hydrogen ion activity).\n\nStarting from the law of mass action, the definition of activity, and mass balance for a polyprotic acid, derive the distribution of species fractions $\\alpha_{j}(\\mathrm{pH})$ for $j = 0,1,2,3$, where $\\alpha_{j}$ is the fraction of total acid present as $H_{3-j}A^{j-}$. Then, accounting for nonideality at the stated ionic strength using the Davies extension of the Debye–Hückel equation, compute the fraction $\\alpha_{3}$ present as $A^{3-}$ at $\\mathrm{pH} = 7.50$ and $I = 0.10\\,\\mathrm{mol\\,L^{-1}}$.\n\nUse the Davies equation for the activity coefficient $\\gamma_{i}$ of ion $i$ of charge $z_{i}$ at $25\\,^{\\circ}\\mathrm{C}$,\n$$\n-\\log_{10}\\gamma_{i} \\;=\\; A z_{i}^{2}\\!\\left(\\frac{\\sqrt{I}}{1+\\sqrt{I}} - 0.3\\,I\\right),\n$$\nwith $A = 0.51$, and assume $\\gamma$ for neutral species is $1$. Treat the reported $\\mathrm{pH}$ as activity-based, $a_{H^{+}} = 10^{-\\mathrm{pH}}$, and convert to the free proton concentration $[H^{+}]$ using $a_{H^{+}} = \\gamma_{H^{+}}[H^{+}]$. Neglect complexation other than the acid-base reactions shown and ignore specific ion pairing beyond what is captured by the activity coefficients. Round your final numerical answer for $\\alpha_{3}$ to four significant figures. The fraction is dimensionless and must be reported as a decimal number (not a percentage).",
            "solution": "The problem requires the derivation of the species distribution for a triprotic acid and the calculation of the fraction of the fully deprotonated species, $A^{3-}$, under specified conditions of $\\mathrm{pH}$ and ionic strength. The solution must account for non-ideal behavior using the Davies equation.\n\nFirst, we derive the general expressions for the species fractions, $\\alpha_j$. The stepwise deprotonation of phosphoric acid, $H_3A$, is described by three equilibria:\n$$H_{3}A \\rightleftharpoons H_{2}A^{-} + H^{+} \\quad K_{a1}^{\\mathrm{a}} = \\frac{a_{H_{2}A^{-}} a_{H^{+}}}{a_{H_{3}A}}$$\n$$H_{2}A^{-} \\rightleftharpoons HA^{2-} + H^{+} \\quad K_{a2}^{\\mathrm{a}} = \\frac{a_{HA^{2-}} a_{H^{+}}}{a_{H_{2}A^{-}}}$$\n$$HA^{2-} \\rightleftharpoons A^{3-} + H^{+} \\quad K_{a3}^{\\mathrm{a}} = \\frac{a_{A^{3-}} a_{H^{+}}}{a_{HA^{2-}}}$$\nHere, $K_{aj}^{\\mathrm{a}}$ are the thermodynamic (activity-based) acid dissociation constants and $a_i$ represents the activity of species $i$.\n\nThe activity of an ion $i$ is related to its molar concentration $[i]$ by $a_i = \\gamma_i [i]$, where $\\gamma_i$ is the activity coefficient. For a neutral species like $H_3A$, we are given $\\gamma_{H_3A} = 1$. The total concentration of all phosphate species, $C_T$, is the sum of the concentrations of the individual species:\n$$C_T = [H_3A] + [H_2A^-] + [HA^{2-}] + [A^{3-}]$$\nThe fraction of each species, $\\alpha_j$, is defined as the concentration of that species divided by the total concentration, $C_T$. For example, $\\alpha_3 = [A^{3-}]/C_T$.\n\nTo find the expressions for $\\alpha_j$, we express the concentration of each species relative to a chosen reference species. Since the given $\\mathrm{pH}$ of $7.50$ is closest to the given $pK_{a2}^{\\mathrm{a}}$ of $7.198$, the species $H_2A^-$ and $HA^{2-}$ will be dominant. We choose $HA^{2-}$ as the reference species.\n\nFrom the equilibrium expressions, we can write the concentration ratios. Let $\\gamma_0, \\gamma_1, \\gamma_2, \\gamma_3$ be the activity coefficients for $H_3A, H_2A^-, HA^{2-}, A^{3-}$, respectively.\n$$\\frac{[H_2A^-]}{[HA^{2-}]} = \\frac{a_{H_2A^-}/\\gamma_1}{a_{HA^{2-}}/\\gamma_2} = \\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1}$$\n$$\\frac{[H_3A]}{[H_2A^-]} = \\frac{a_{H_3A}/\\gamma_0}{a_{H_2A^-}/\\gamma_1} = \\frac{a_{H^+}}{K_{a1}^{\\mathrm{a}}} \\frac{\\gamma_1}{\\gamma_0}$$\n$$\\frac{[A^{3-}]}{[HA^{2-}]} = \\frac{a_{A^{3-}}/\\gamma_3}{a_{HA^{2-}}/\\gamma_2} = \\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3}$$\nCombining these, we express all concentrations in terms of $[HA^{2-}]$:\n$$[H_2A^-] = [HA^{2-}] \\left( \\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1} \\right)$$\n$$[H_3A] = [H_2A^-] \\left( \\frac{a_{H^+}}{K_{a1}^{\\mathrm{a}}} \\frac{\\gamma_1}{\\gamma_0} \\right) = [HA^{2-}] \\left( \\frac{(a_{H^+})^2}{K_{a1}^{\\mathrm{a}} K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_0} \\right)$$\n$$[A^{3-}] = [HA^{2-}] \\left( \\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3} \\right)$$\nThe total concentration is:\n$$C_T = [HA^{2-}] \\left( \\frac{(a_{H^+})^2}{K_{a1}^{\\mathrm{a}} K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_0} + \\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1} + 1 + \\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3} \\right)$$\nThe general expression for a species fraction $\\alpha_j$ is the term corresponding to that species in the sum, divided by the entire sum. Let the denominator (the term in parentheses) be $D$. Then the distribution of species fractions is:\n$$\\alpha_0 = \\frac{1}{D} \\left(\\frac{(a_{H^+})^2}{K_{a1}^{\\mathrm{a}} K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_0}\\right), \\quad \\alpha_1 = \\frac{1}{D} \\left(\\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1}\\right), \\quad \\alpha_2 = \\frac{1}{D}, \\quad \\alpha_3 = \\frac{1}{D} \\left(\\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3}\\right)$$\nThis completes the requested derivation of the species fraction distribution $\\alpha_j(\\mathrm{pH})$.\n\nNow, we compute the numerical value of $\\alpha_3$. The given parameters are:\n$\\mathrm{pH} = 7.50 \\implies a_{H^+} = 10^{-7.50}$\n$I = 0.10\\,\\mathrm{mol\\,L^{-1}}$\n$A = 0.51$\n$pK_{a1}^{\\mathrm{a}} = 2.148 \\implies K_{a1}^{\\mathrm{a}} = 10^{-2.148}$\n$pK_{a2}^{\\mathrm{a}} = 7.198 \\implies K_{a2}^{\\mathrm{a}} = 10^{-7.198}$\n$pK_{a3}^{\\mathrm{a}} = 12.375 \\implies K_{a3}^{\\mathrm{a}} = 10^{-12.375}$\n\nFirst, we calculate the activity coefficients $\\gamma_i$ using the Davies equation for each ion of charge $z_i$:\n$$-\\log_{10}\\gamma_{i} = A z_{i}^{2} \\left(\\frac{\\sqrt{I}}{1+\\sqrt{I}} - 0.3 I\\right)$$\nThe term in parentheses is a constant for this problem:\n$$\\frac{\\sqrt{0.10}}{1+\\sqrt{0.10}} - 0.3(0.10) \\approx \\frac{0.316228}{1.316228} - 0.03 \\approx 0.240253 - 0.03 = 0.210253$$\nSo, $-\\log_{10}\\gamma_i = 0.51 z_i^2 (0.210253) = 0.107229 z_i^2$. This gives $\\log_{10}\\gamma_i = -0.107229 z_i^2$.\n\nThe charges of the phosphate species are $z_0 = 0$ for $H_3A$, $z_1 = -1$ for $H_2A^-$, $z_2 = -2$ for $HA^{2-}$, and $z_3 = -3$ for $A^{3-}$.\n$\\gamma_0 = \\gamma_{H_3A} = 1$ (since $z_0=0$).\n$\\log_{10}\\gamma_1 = -0.107229(-1)^2 = -0.107229 \\implies \\gamma_1 = 10^{-0.107229} \\approx 0.78121$\n$\\log_{10}\\gamma_2 = -0.107229(-2)^2 = -0.428916 \\implies \\gamma_2 = 10^{-0.428916} \\approx 0.37246$\n$\\log_{10}\\gamma_3 = -0.107229(-3)^2 = -0.965061 \\implies \\gamma_3 = 10^{-0.965061} \\approx 0.10838$\n\nNext, we calculate the terms in the denominator $D$:\nLet $T_0=\\frac{[H_3A]}{[HA^{2-}]}$, $T_1=\\frac{[H_2A^-]}{[HA^{2-}]}$, $T_2=1$, $T_3=\\frac{[A^{3-}]}{[HA^{2-}]}$.\n\n$T_0 = \\frac{(10^{-7.50})^2}{10^{-2.148} \\cdot 10^{-7.198}} \\frac{0.37246}{1} = \\frac{10^{-15.00}}{10^{-9.346}} (0.37246) = 10^{-5.654} (0.37246) \\approx 8.26 \\times 10^{-7}$\n$T_1 = \\frac{10^{-7.50}}{10^{-7.198}} \\frac{0.37246}{0.78121} = 10^{-0.302} (0.47677) \\approx 0.49888 \\times 0.47677 \\approx 0.23787$\n$T_2 = 1$\n$T_3 = \\frac{10^{-12.375}}{10^{-7.50}} \\frac{0.37246}{0.10838} = 10^{-4.875} (3.4367) \\approx (1.3335 \\times 10^{-5}) \\times 3.4367 \\approx 4.583 \\times 10^{-5}$\n\nThe denominator is the sum of these terms:\n$D = T_0 + T_1 + T_2 + T_3 \\approx (8.26 \\times 10^{-7}) + 0.23787 + 1 + (4.583 \\times 10^{-5}) \\approx 1.23792$\n\nThe fraction $\\alpha_3$ is the ratio of term $T_3$ to the total sum $D$:\n$$\\alpha_3 = \\frac{T_3}{D} = \\frac{4.583 \\times 10^{-5}}{1.23792} \\approx 3.7021 \\times 10^{-5}$$\nRounding to four significant figures, we get $3.702 \\times 10^{-5}$. Converting to a decimal number as requested:\n$$\\alpha_3 = 0.00003702$$\nThis reflects the fact that at $\\mathrm{pH}=7.50$, which is significantly below the effective third dissociation constant ($pK_{a3}' \\approx 11.8$), the fraction of the fully deprotonated species $A^{3-}$ is expected to be very small.",
            "answer": "$$\\boxed{0.00003702}$$"
        },
        {
            "introduction": "Natural waters are rarely simple solutions; they are complex mixtures of multiple acid-base systems. Building on the principles of single-system equilibrium, this exercise demonstrates how to find the pH of a complex aqueous solution containing carbonate, borate, and ammonia species. The key principle is electroneutrality, which provides a master equation coupling all equilibria, and the hands-on task involves using the powerful Newton-Raphson numerical method to solve it, a core technique in modern geochemical modeling software. ",
            "id": "3867365",
            "problem": "Consider a closed, well-mixed aqueous system at temperature $25\\,^{\\circ}\\mathrm{C}$ in which proton transfer reactions are governed by the law of chemical mass action, the self-ionization of water, and conservation of mass for each element. The system contains water, dissolved inorganic carbon, boron, and total ammonia, along with nonreactive strong ions that act as fixed background cations and anions. The unknown to be determined is the acidity measured as $\\mathrm{pH}$, defined by $\\mathrm{pH} = -\\log_{10}([\\mathrm{H}^{+}])$ where $[\\mathrm{H}^{+}]$ is the molar concentration of hydrogen ion in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$.\n\nThe fundamental bases are:\n- Electroneutrality (charge balance): the sum of positive charges equals the sum of negative charges in a closed aqueous solution.\n- Law of chemical mass action for acid-base equilibria under dilute solution conditions.\n- Self-ionization of water at $25\\,^{\\circ}\\mathrm{C}$.\n- Conservation of mass for each conserved total (for example, total inorganic carbon).\n\nAssume the following equilibria and definitions hold at $25\\,^{\\circ}\\mathrm{C}$:\n- Water self-ionization: $K_w = [\\mathrm{H}^{+}][\\mathrm{OH}^{-}]$ with $K_w = 10^{-14}$.\n- Carbonate system: $\\mathrm{H}_2\\mathrm{CO}_3 \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{HCO}_3^{-}$ with $K_1 = 10^{-6.3}$ and $\\mathrm{HCO}_3^{-} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{CO}_3^{2-}$ with $K_2 = 10^{-10.3}$; define the total dissolved inorganic carbon $C_T = [\\mathrm{H}_2\\mathrm{CO}_3] + [\\mathrm{HCO}_3^{-}] + [\\mathrm{CO}_3^{2-}]$.\n- Boron system: $\\mathrm{B(OH)}_3 + \\mathrm{H}_2\\mathrm{O} \\rightleftharpoons \\mathrm{B(OH)}_4^{-} + \\mathrm{H}^{+}$ with $K_B = 10^{-9.24}$; define total boron $B_T = [\\mathrm{B(OH)}_3] + [\\mathrm{B(OH)}_4^{-}]$.\n- Ammonia/ammonium system: $\\mathrm{NH}_4^{+} \\rightleftharpoons \\mathrm{NH}_3 + \\mathrm{H}^{+}$ with acidity constant $K_{a,\\mathrm{NH}_4} = 10^{-9.25}$; define total ammonia $N_T = [\\mathrm{NH}_3] + [\\mathrm{NH}_4^{+}]$.\n- Fixed strong monovalent cation concentration $S_c$ (for example, sodium) and fixed strong monovalent anion concentration $S_a$ (for example, chloride) that do not participate in acid-base equilibria.\n\nFor a given $[\\mathrm{H}^{+}] = H$, the species concentrations are determined by equilibrium constraints and total concentrations:\n- $[\\mathrm{OH}^{-}] = K_w / H$.\n- Carbonate speciation fractions derived from the law of mass action and conservation of $C_T$, with denominator $D(H) = H^2 + K_1 H + K_1 K_2$. Then $[\\mathrm{HCO}_3^{-}] = C_T \\,\\alpha_1(H)$ and $[\\mathrm{CO}_3^{2-}] = C_T \\,\\alpha_2(H)$, where $\\alpha_1(H) = \\dfrac{K_1 H}{D(H)}$ and $\\alpha_2(H) = \\dfrac{K_1 K_2}{D(H)}$.\n- Boron: $[\\mathrm{B(OH)}_4^{-}] = B_T \\,\\dfrac{K_B}{H + K_B}$.\n- Ammonia/ammonium: $[\\mathrm{NH}_4^{+}] = N_T \\,\\dfrac{H}{H + K_{a,\\mathrm{NH}_4}}$.\n\nElectroneutrality imposes the scalar equation that couples all equilibria,\n$$\nf(H) \\equiv \\underbrace{H}_{[\\mathrm{H}^{+}]} + \\underbrace{S_c}_{\\text{fixed cations}} + \\underbrace{N_T \\,\\frac{H}{H + K_{a,\\mathrm{NH}_4}}}_{[\\mathrm{NH}_4^{+}]} \\;-\\; \\underbrace{\\frac{K_w}{H}}_{[\\mathrm{OH}^{-}]} \\;-\\; \\underbrace{S_a}_{\\text{fixed anions}} \\;-\\; \\underbrace{C_T \\,\\alpha_1(H)}_{[\\mathrm{HCO}_3^{-}]} \\;-\\; \\underbrace{2\\,C_T \\,\\alpha_2(H)}_{2[\\mathrm{CO}_3^{2-}]} \\;-\\; \\underbrace{B_T \\,\\frac{K_B}{H + K_B}}_{[\\mathrm{B(OH)}_4^{-}]} \\;=\\; 0.\n$$\n\nYour task is to compute $\\mathrm{pH}$ by solving $f(H) = 0$ using the Newton–Raphson method for root finding on the variable $H$. Derive the Newton–Raphson iteration update $H_{n+1} = H_n - f(H_n)/f'(H_n)$ by differentiating $f(H)$ with respect to $H$, and implement a robust algorithm that ensures $H$ remains within physically meaningful bounds $H \\in [10^{-14}, 10^{0}]$ corresponding to $\\mathrm{pH} \\in [14, 0]$. If the Newton–Raphson method fails to converge from a neutral initial guess, implement a fallback bracketing search over $\\log_{10}(H)$ to locate a sign change and then use bisection to converge to the root.\n\nAll concentrations must be treated in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$, and the final answer must be expressed as $\\mathrm{pH}$ values. Your program must produce $\\mathrm{pH}$ as a float rounded to four decimal places for each test case. The required final output format is a single line containing a comma-separated list of the $\\mathrm{pH}$ values enclosed in square brackets, for example, $[\\mathrm{pH}_1,\\mathrm{pH}_2,\\mathrm{pH}_3]$.\n\nUse the following test suite of parameter values $(C_T,B_T,N_T,S_c,S_a)$ in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$:\n1. Case $1$ (baseline pure water): $(0, 0, 0, 0, 0)$.\n2. Case $2$ (closed carbonate-boron system without fixed strong ions): $(2\\times 10^{-3}, 4\\times 10^{-4}, 0, 0, 0)$.\n3. Case $3$ (alkaline tendency with excess fixed cations and mixed weak acids/bases): $(1\\times 10^{-3}, 4\\times 10^{-4}, 1\\times 10^{-5}, 1\\times 10^{-3}, 2\\times 10^{-4})$.\n4. Case $4$ (acidic tendency with excess fixed anions and ammonia present): $(1\\times 10^{-4}, 0, 1\\times 10^{-4}, 2\\times 10^{-4}, 1\\times 10^{-3})$.\n5. Case $5$ (ammonia-dominated, no carbonate or boron, no fixed strong ions): $(0, 0, 3\\times 10^{-3}, 0, 0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[x_1,x_2,x_3,x_4,x_5]$), where each $x_i$ is the $\\mathrm{pH}$ of case $i$ rounded to four decimal places.",
            "solution": "The core of the problem is to find the hydrogen ion concentration, denoted as $H \\equiv [\\mathrm{H}^{+}]$, for a complex aqueous solution by solving a single nonlinear algebraic equation derived from the principle of electroneutrality. The pH is then calculated from its definition, $\\mathrm{pH} = -\\log_{10}(H)$.\n\nThe charge balance, or electroneutrality, equation requires that the sum of molar concentrations of all positive charges equals the sum of molar concentrations of all negative charges. The charged species in the system are:\n- Cations: $\\mathrm{H}^{+}$, $\\mathrm{NH}_4^{+}$, and fixed strong cations with total concentration $S_c$.\n- Anions: $\\mathrm{OH}^{-}$, $\\mathrm{HCO}_3^{-}$, $\\mathrm{CO}_3^{2-}$, $\\mathrm{B(OH)}_4^{-}$, and fixed strong anions with total concentration $S_a$.\n\nThe electroneutrality condition is thus:\n$$[\\mathrm{H}^{+}] + [\\mathrm{NH}_4^{+}] + S_c = [\\mathrm{OH}^{-}] + [\\mathrm{HCO}_3^{-}] + 2[\\mathrm{CO}_3^{2-}] + [\\mathrm{B(OH)}_4^{-}] + S_a$$\nThe factor of $2$ for $[\\mathrm{CO}_3^{2-}]$ accounts for its double negative charge.\n\nThe problem provides expressions for the concentration of each weak acid/base species as a function of $H$ and the total concentrations ($C_T$, $B_T$, $N_T$). These expressions are derived from the law of mass action and mass conservation laws for each element group. Substituting these into the electroneutrality equation and rearranging gives the root-finding problem $f(H) = 0$, where:\n$$\nf(H) = H + S_c + N_T \\frac{H}{H + K_{a,\\mathrm{NH}_4}} - \\frac{K_w}{H} - S_a - C_T \\left( \\frac{K_1 H}{H^2 + K_1 H + K_1 K_2} + \\frac{2 K_1 K_2}{H^2 + K_1 H + K_1 K_2} \\right) - B_T \\frac{K_B}{H + K_B}\n$$\nThis can be written more compactly as:\n$$\nf(H) = H + S_c + N_T \\frac{H}{H + K_{a,\\mathrm{NH}_4}} - \\frac{K_w}{H} - S_a - C_T \\frac{K_1 H + 2 K_1 K_2}{H^2 + K_1 H + K_1 K_2} - B_T \\frac{K_B}{H + K_B}\n$$\n\nTo solve $f(H) = 0$ using the Newton-Raphson method, we require the derivative of $f(H)$ with respect to $H$, denoted $f'(H)$. The iteration is then given by $H_{n+1} = H_n - f(H_n)/f'(H_n)$. We derive $f'(H)$ by differentiating each term of $f(H)$:\n- $\\frac{d}{dH}(H) = 1$\n- $\\frac{d}{dH}(S_c) = 0$\n- $\\frac{d}{dH}\\left(N_T \\frac{H}{H + K_{a,\\mathrm{NH}_4}}\\right) = N_T \\frac{(1)(H + K_{a,\\mathrm{NH}_4}) - H(1)}{(H + K_{a,\\mathrm{NH}_4})^2} = N_T \\frac{K_{a,\\mathrm{NH}_4}}{(H + K_{a,\\mathrm{NH}_4})^2}$\n- $\\frac{d}{dH}\\left(-\\frac{K_w}{H}\\right) = \\frac{K_w}{H^2}$\n- $\\frac{d}{dH}(-S_a) = 0$\n- For the carbonate term, let $N(H) = K_1 H + 2K_1 K_2$ and $D(H) = H^2 + K_1 H + K_1 K_2$. Then $N'(H) = K_1$ and $D'(H) = 2H + K_1$. Using the quotient rule:\n  $\\frac{d}{dH}\\left(\\frac{N(H)}{D(H)}\\right) = \\frac{N'(H)D(H) - N(H)D'(H)}{D(H)^2} = \\frac{K_1(H^2+K_1H+K_1K_2) - (K_1H+2K_1K_2)(2H+K_1)}{D(H)^2}$\n  The numerator simplifies to $-K_1 H^2 - 4K_1 K_2 H - K_1^2 K_2 = -K_1(H^2 + 4K_2 H + K_1 K_2)$.\n  Thus, the derivative of the full carbonate term is $-C_T \\left( \\frac{-K_1(H^2 + 4K_2 H + K_1 K_2)}{D(H)^2} \\right) = C_T \\frac{K_1(H^2 + 4K_2 H + K_1 K_2)}{(H^2 + K_1 H + K_1 K_2)^2}$.\n- $\\frac{d}{dH}\\left(-B_T \\frac{K_B}{H + K_B}\\right) = -B_T K_B \\frac{-1}{(H+K_B)^2} = B_T \\frac{K_B}{(H + K_B)^2}$\n\nCombining all terms, the complete derivative is:\n$$\nf'(H) = 1 + \\frac{K_w}{H^2} + N_T \\frac{K_{a,\\mathrm{NH}_4}}{(H + K_{a,\\mathrm{NH}_4})^2} + C_T \\frac{K_1(H^2 + 4K_2H + K_1K_2)}{(H^2 + K_1H + K_1K_2)^2} + B_T \\frac{K_B}{(H + K_B)^2}\n$$\nFor physically meaningful concentrations ($H>0$), all constants ($K_i$) and total concentrations ($C_T, B_T, N_T$) are non-negative. All terms in the expression for $f'(H)$ are therefore non-negative, and the first two terms ($1 + K_w/H^2$) are strictly positive. Consequently, $f'(H) > 0$ for all $H>0$. This proves that $f(H)$ is a strictly monotonic increasing function of $H$, which guarantees that there is at most one root. Because $f(H) \\to -\\infty$ as $H \\to 0^+$ (due to the $-K_w/H$ term) and $f(H) \\to +\\infty$ as $H \\to \\infty$ (due to the $H$ term), a unique positive root for $H$ must exist.\n\nThe numerical algorithm is implemented as follows:\n1.  Initialize constants and parameters for a given test case.\n2.  Attempt to find the root using the Newton-Raphson method, starting from a neutral guess of $H_0 = 10^{-7} \\, \\mathrm{mol}\\,\\mathrm{L}^{-1}$.\n3.  The iteration proceeds as $H_{n+1} = H_n - f(H_n)/f'(H_n)$. Iteration stops when the change in $H$ is smaller than a prescribed tolerance (e.g., $10^{-15}$). The number of iterations is limited (e.g., to $50$) to detect non-convergence.\n4.  A crucial robustness check is performed at each step: if the next iterate $H_{n+1}$ falls outside the physically plausible bounds of $H \\in [10^{-14}, 1]$, the Newton-Raphson method is considered to have failed.\n5.  If the Newton-Raphson method fails (either by exceeding the iteration limit or by producing an out-of-bounds estimate), a more robust fallback method is engaged.\n6.  The fallback method is the bisection algorithm. Since $f(H)$ is monotonic and we know $f(10^{-14}) < 0$ and $f(1) > 0$ for typical chemical concentrations, the interval $[10^{-14}, 1]$ provides a guaranteed bracket for the root. Bisection repeatedly halves this interval while ensuring the root remains bracketed, converging reliably, albeit more slowly, to the solution. The bisection continues until the interval width is smaller than a set tolerance.\n7.  Once the root $H$ is found, the pH is calculated as $\\mathrm{pH} = -\\log_{10}(H)$ and rounded to four decimal places as required.\n\nThis two-stage strategy combines the rapid convergence of the Newton-Raphson method with the guaranteed stability of the bisection method, providing a robust solver for this type of chemical equilibrium problem.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the pH for several aqueous chemical equilibrium scenarios.\n    \n    The problem is solved by finding the root of the electroneutrality equation f(H) = 0,\n    where H is the hydrogen ion concentration. A Newton-Raphson method is used with a\n    fallback to a bisection method for robustness.\n    \"\"\"\n\n    # --- Constants at 25 degrees C ---\n    K_W = 10**-14.0\n    K1 = 10**-6.3\n    K2 = 10**-10.3\n    K_B = 10**-9.24\n    K_A_NH4 = 10**-9.25\n\n    def f(H, Ct, Bt, Nt, Sc, Sa):\n        \"\"\"Electroneutrality function f(H).\"\"\"\n        if H <= 0:\n            return -np.inf\n\n        # Carbonate terms\n        D_H = H**2 + K1 * H + K1 * K2\n        hco3_term = Ct * K1 * H / D_H\n        co3_term = 2 * Ct * K1 * K2 / D_H\n\n        # Boron term\n        boh4_term = Bt * K_B / (H + K_B)\n        \n        # Ammonia term\n        nh4_term = Nt * H / (H + K_A_NH4)\n\n        # Charge balance: Cations - Anions\n        val = (H + Sc + nh4_term) - (K_W / H + Sa + hco3_term + co3_term + boh4_term)\n        return val\n\n    def f_prime(H, Ct, Bt, Nt):\n        \"\"\"Derivative of the electroneutrality function, f'(H).\"\"\"\n        if H <= 0:\n            return np.inf\n\n        # Derivative of carbonate terms\n        D_H = H**2 + K1 * H + K1 * K2\n        d_carb_term = Ct * K1 * (H**2 + 4 * K2 * H + K1 * K2) / (D_H**2)\n\n        # Derivative of boron term\n        d_boron_term = Bt * K_B / (H + K_B)**2\n        \n        # Derivative of ammonia term\n        d_ammonia_term = Nt * K_A_NH4 / (H + K_A_NH4)**2\n\n        # Sum of derivatives of all terms\n        val = 1 + K_W / H**2 + d_ammonia_term + d_carb_term + d_boron_term\n        return val\n\n    def solve_for_ph(params):\n        \"\"\"\n        Solves for pH using Newton-Raphson with bisection fallback.\n        \"\"\"\n        Ct, Bt, Nt, Sc, Sa = params\n        \n        # Physical bounds for H = [H+]\n        H_min, H_max = 1e-14, 1.0\n\n        # --- Newton-Raphson Method ---\n        H = 1e-7  # Initial guess (neutral pH)\n        max_iter_newton = 50\n        tolerance_newton = 1e-15\n        \n        for _ in range(max_iter_newton):\n            f_val = f(H, Ct, Bt, Nt, Sc, Sa)\n            fp_val = f_prime(H, Ct, Bt, Nt)\n            \n            if abs(fp_val) < 1e-20:  # Avoid division by zero/small number\n                break\n            \n            H_next = H - f_val / fp_val\n\n            if not (H_min <= H_next <= H_max):\n                break  # Step is out of bounds, fail Newton and proceed to bisection\n\n            if abs(H_next - H) < tolerance_newton:\n                return -np.log10(H_next) # Converged\n            \n            H = H_next\n        \n        # --- Bisection Method (Fallback) ---\n        low_H, high_H = H_min, H_max\n        max_iter_bisection = 100\n        tolerance_bisection = 1e-15\n\n        f_low = f(low_H, Ct, Bt, Nt, Sc, Sa)\n        \n        for _ in range(max_iter_bisection):\n            mid_H = (low_H + high_H) / 2\n            f_mid = f(mid_H, Ct, Bt, Nt, Sc, Sa)\n            \n            if (high_H - low_H) / 2 < tolerance_bisection:\n                return -np.log10(mid_H)\n\n            if f_low * f_mid < 0:\n                high_H = mid_H\n            else:\n                low_H = mid_H\n                f_low = f_mid # Update f_low to f(new_low_H)\n        \n        # Return the last best guess if bisection maxes out\n        return -np.log10((low_H + high_H) / 2)\n\n\n    # Test cases in mol/L for (C_T, B_T, N_T, S_c, S_a)\n    test_cases = [\n        (0.0, 0.0, 0.0, 0.0, 0.0),                                       # Case 1\n        (2e-3, 4e-4, 0.0, 0.0, 0.0),                                     # Case 2\n        (1e-3, 4e-4, 1e-5, 1e-3, 2e-4),                                  # Case 3\n        (1e-4, 0.0, 1e-4, 2e-4, 1e-3),                                   # Case 4\n        (0.0, 0.0, 3e-3, 0.0, 0.0),                                      # Case 5\n    ]\n    \n    results = []\n    for case in test_cases:\n        ph_val = solve_for_ph(case)\n        results.append(f\"{ph_val:.4f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having explored how to determine the state of a system at equilibrium, we now turn to the dynamics of how that state changes over time. This practice addresses the numerical integration of a nonlinear kinetic rate law—the Monod equation—which is ubiquitous in models of microbial processes. You will implement the backward Euler method, a robust technique for solving the \"stiff\" ordinary differential equations typical of chemical kinetics, and use the Newton-Raphson method to solve the resulting implicit algebraic system at each time step, providing a foundational skill for building dynamic environmental models. ",
            "id": "3867366",
            "problem": "A dissolved organic substrate in a well-mixed aquatic control volume is biodegraded by a microbial consortium according to a saturation (Monod) rate law. Let $C(t)$ denote the substrate concentration in $\\mathrm{mol\\, m^{-3}}$. The mass balance, neglecting transport and assuming constant volume, is\n$$\\frac{dC}{dt} \\;=\\; -r(C),$$\nwhere the volumetric reaction rate $r(C)$ follows the Monod form\n$$r(C) \\;=\\; V_{\\max}\\,\\frac{C}{K + C},$$\nwith $V_{\\max}$ the maximum volumetric consumption rate and $K$ the half-saturation constant. Consider a single implicit time step from $t_n$ to $t_{n+1}=t_n+\\Delta t$ using backward Euler time integration. Starting from the given ordinary differential equation (ODE), derive the backward Euler discrete update for $C_{n+1}$ and the corresponding nonlinear residual function that must be solved. Then, formulate the Newton–Raphson iteration, including the explicit scalar Jacobian, to solve the implicit step. Adopt the following convergence criteria: terminate Newton–Raphson when either the absolute residual satisfies $|F(C_{n+1}^{(k)})| \\le \\tau_F$ or the relative change satisfies $\\left|\\Delta C^{(k)}\\right|/\\left|C_{n+1}^{(k)}\\right| \\le \\tau_x$, where $F$ is the residual, $\\Delta C^{(k)}$ is the Newton correction at iteration $k$, and $(\\tau_F,\\tau_x)$ are prescribed tolerances.\n\nUsing the parameter values\n$$V_{\\max} \\;=\\; 1.5 \\times 10^{-7},\\quad K \\;=\\; 1.0 \\times 10^{-4},\\quad C_n \\;=\\; 5.0 \\times 10^{-4},\\quad \\Delta t \\;=\\; 900,$$\nwith all quantities in coherent $\\mathrm{SI}$ units so that $C$ is in $\\mathrm{mol\\, m^{-3}}$ and time in $\\mathrm{s}$, and tolerances\n$$\\tau_F \\;=\\; 1.0 \\times 10^{-8} \\quad \\text{and} \\quad \\tau_x \\;=\\; 1.0 \\times 10^{-8},$$\ncarry out Newton–Raphson starting from the initial guess $C_{n+1}^{(0)}=C_n$, and compute the updated concentration $C_{n+1}$ that meets the stated convergence criteria. Round your final numerical answer to four significant figures. Express the final concentration in $\\mathrm{mol\\, m^{-3}}$.",
            "solution": "### Solution Derivation\n\n**1. Backward Euler Discretization and Residual Function**\n\nThe governing ODE is:\n$$\n\\frac{dC}{dt} = -V_{\\max}\\,\\frac{C}{K + C}\n$$\nApplying the backward Euler method, we approximate the time derivative at time $t_{n+1}$ and evaluate the right-hand side at $t_{n+1}$:\n$$\n\\frac{C_{n+1} - C_n}{\\Delta t} = -V_{\\max}\\,\\frac{C_{n+1}}{K + C_{n+1}}\n$$\nThis is the implicit discrete update equation for $C_{n+1}$. To solve for $C_{n+1}$, we define a residual function, $F(C_{n+1})$, by rearranging the equation so that it equals zero:\n$$\nF(C_{n+1}) = C_{n+1} - C_n + \\Delta t \\, V_{\\max} \\, \\frac{C_{n+1}}{K + C_{n+1}} = 0\n$$\nThis is the nonlinear algebraic equation that must be solved for $C_{n+1}$.\n\n**2. Newton–Raphson Formulation**\n\nThe Newton–Raphson method is an iterative root-finding algorithm. For a scalar function $F(x)$, the iteration is given by:\n$$\nx^{(k+1)} = x^{(k)} - \\frac{F(x^{(k)})}{F'(x^{(k)})}\n$$\nIn our case, $x$ corresponds to $C_{n+1}$. The iteration for $C_{n+1}$ is:\n$$\nC_{n+1}^{(k+1)} = C_{n+1}^{(k)} - \\frac{F(C_{n+1}^{(k)})}{J(C_{n+1}^{(k)})}\n$$\nwhere $k$ is the iteration index and $J(C_{n+1})$ is the scalar Jacobian, which is the derivative of the residual function with respect to $C_{n+1}$, i.e., $J(C) = F'(C)$.\n\nLet's compute the Jacobian $J(C)$:\n$$\nJ(C) = \\frac{d}{dC} F(C) = \\frac{d}{dC} \\left( C - C_n + \\Delta t \\, V_{\\max} \\, \\frac{C}{K + C} \\right)\n$$\nThe derivative of the first term, $C$, is $1$. The second term, $-C_n$, is a constant with respect to $C$, so its derivative is $0$. For the third term, we use the quotient rule for differentiation, $\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u'v - uv'}{v^2}$:\n$$\n\\frac{d}{dC}\\left(\\frac{C}{K + C}\\right) = \\frac{(1)(K + C) - (C)(1)}{(K + C)^2} = \\frac{K}{(K + C)^2}\n$$\nCombining these results, the Jacobian is:\n$$\nJ(C) = 1 + \\Delta t \\, V_{\\max} \\, \\frac{K}{(K + C)^2}\n$$\nThe Newton correction at iteration $k$ is $\\Delta C^{(k)} = -F(C_{n+1}^{(k)})/J(C_{n+1}^{(k)})$, and the update is $C_{n+1}^{(k+1)} = C_{n+1}^{(k)} + \\Delta C^{(k)}$.\n\n**3. Numerical Calculation**\n\nWe are given the following values:\n$V_{\\max} = 1.5 \\times 10^{-7}$, $K = 1.0 \\times 10^{-4}$, $C_n = 5.0 \\times 10^{-4}$, $\\Delta t = 900$.\nThe constants for the functions are:\n$\\Delta t \\, V_{\\max} = 900 \\times (1.5 \\times 10^{-7}) = 1.35 \\times 10^{-4}$.\n$\\Delta t \\, V_{\\max} \\, K = (1.35 \\times 10^{-4}) \\times (1.0 \\times 10^{-4}) = 1.35 \\times 10^{-8}$.\n\nThe functions for the iteration are:\n$$\nF(C) = C - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{C}{1.0 \\times 10^{-4} + C}\n$$\n$$\nJ(C) = 1 + \\frac{1.35 \\times 10^{-8}}{(1.0 \\times 10^{-4} + C)^2}\n$$\nThe tolerances are $\\tau_F = 1.0 \\times 10^{-8}$ and $\\tau_x = 1.0 \\times 10^{-8}$. The initial guess is $C_{n+1}^{(0)} = C_n = 5.0 \\times 10^{-4}$.\n\n**Iteration $k=0$**:\n$C_{n+1}^{(0)} = 5.0 \\times 10^{-4}$.\n$F(C_{n+1}^{(0)}) = 5.0 \\times 10^{-4} - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{5.0 \\times 10^{-4}}{1.0 \\times 10^{-4} + 5.0 \\times 10^{-4}} = (1.35 \\times 10^{-4}) \\frac{5}{6} = 1.125 \\times 10^{-4}$.\n$|F(C_{n+1}^{(0)})| = 1.125 \\times 10^{-4} > \\tau_F$.\n$J(C_{n+1}^{(0)}) = 1 + \\frac{1.35 \\times 10^{-8}}{(1.0 \\times 10^{-4} + 5.0 \\times 10^{-4})^2} = 1 + \\frac{1.35 \\times 10^{-8}}{(6.0 \\times 10^{-4})^2} = 1 + \\frac{1.35 \\times 10^{-8}}{36.0 \\times 10^{-8}} = 1 + 0.0375 = 1.0375$.\n$\\Delta C^{(0)} = -\\frac{F(C_{n+1}^{(0)})}{J(C_{n+1}^{(0)})} = -\\frac{1.125 \\times 10^{-4}}{1.0375} \\approx -1.0843373 \\times 10^{-4}$.\n$C_{n+1}^{(1)} = C_{n+1}^{(0)} + \\Delta C^{(0)} = 5.0 \\times 10^{-4} - 1.0843373 \\times 10^{-4} = 3.9156627 \\times 10^{-4}$.\nRelative change: $|\\Delta C^{(0)}|/|C_{n+1}^{(1)}| \\approx |-1.084 \\times 10^{-4}|/|3.916 \\times 10^{-4}| \\approx 0.277 > \\tau_x$.\n\n**Iteration $k=1$**:\n$C_{n+1}^{(1)} = 3.9156627 \\times 10^{-4}$.\n$F(C_{n+1}^{(1)}) = 3.9156627 \\times 10^{-4} - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{3.9156627 \\times 10^{-4}}{1.0 \\times 10^{-4} + 3.9156627 \\times 10^{-4}} \\approx -1.0843373 \\times 10^{-4} + 1.0753575 \\times 10^{-4} \\approx -8.9798 \\times 10^{-7}$.\n$|F(C_{n+1}^{(1)})| \\approx 8.98 \\times 10^{-7} > \\tau_F$.\n$J(C_{n+1}^{(1)}) = 1 + \\frac{1.35 \\times 10^{-8}}{(1.0 \\times 10^{-4} + 3.9156627 \\times 10^{-4})^2} = 1 + \\frac{1.35 \\times 10^{-8}}{(4.9156627 \\times 10^{-4})^2} \\approx 1 + \\frac{1.35 \\times 10^{-8}}{2.41637 \\times 10^{-7}} \\approx 1 + 0.055869 = 1.055869$.\n$\\Delta C^{(1)} = -\\frac{-8.9798 \\times 10^{-7}}{1.055869} \\approx 8.50468 \\times 10^{-7}$.\n$C_{n+1}^{(2)} = C_{n+1}^{(1)} + \\Delta C^{(1)} = 3.9156627 \\times 10^{-4} + 8.50468 \\times 10^{-7} = 3.9241674 \\times 10^{-4}$.\nRelative change: $|\\Delta C^{(1)}|/|C_{n+1}^{(2)}| \\approx |8.505 \\times 10^{-7}|/|3.924 \\times 10^{-4}| \\approx 0.00217 > \\tau_x$.\n\n**Iteration $k=2$**:\n$C_{n+1}^{(2)} = 3.9241674 \\times 10^{-4}$.\n$F(C_{n+1}^{(2)}) = 3.9241674 \\times 10^{-4} - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{3.9241674 \\times 10^{-4}}{1.0 \\times 10^{-4} + 3.9241674 \\times 10^{-4}} \\approx -1.0758326 \\times 10^{-4} + 1.0758401 \\times 10^{-4} \\approx 7.5 \\times 10^{-10}$.\n$|F(C_{n+1}^{(2)})| \\approx 7.5 \\times 10^{-10}$.\nWe check the convergence criterion on the absolute residual:\n$|F(C_{n+1}^{(2)})| \\approx 7.5 \\times 10^{-10} \\le \\tau_F = 1.0 \\times 10^{-8}$.\nThe criterion is met. The iteration terminates.\n\nThe converged value for the concentration at time $t_{n+1}$ is $C_{n+1} \\approx 3.9241674 \\times 10^{-4} \\, \\mathrm{mol\\, m^{-3}}$.\nRounding the result to four significant figures as requested:\n$C_{n+1} \\approx 3.924 \\times 10^{-4} \\, \\mathrm{mol\\, m^{-3}}$.",
            "answer": "$$\\boxed{3.924 \\times 10^{-4}}$$"
        }
    ]
}