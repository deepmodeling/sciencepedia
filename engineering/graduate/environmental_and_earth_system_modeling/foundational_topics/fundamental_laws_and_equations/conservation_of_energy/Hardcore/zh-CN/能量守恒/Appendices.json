{
    "hands_on_practices": [
        {
            "introduction": "能量守恒是地球系统建模的基石。这个练习将这一基本原理应用于一个理想化的大气柱控制体。通过对给定的地表能量通量、辐射通量和机械功进行积分，您将计算出大气柱总能量随时间的变化。这个练习旨在强化对能量收支方程的理解，并介绍能量收支不闭合项或“残差”的概念，这是评估和调试地球系统模型中能量循环的关键诊断工具 。",
            "id": "3869764",
            "problem": "考虑一个理想化的大气柱，其水平面积为 $A$，侧向均匀，垂直方向上以地球表面 $z=0$ 和气柱顶部 $z=H$ 为界。将该气柱视为一个固定的控制体积。单位水平面积上的气柱积分总能量 $E(t)$ 定义为内能、重力势能和动能之和的垂直积分。假设没有总能量的侧向平流通量穿过气柱的侧面。设正通量为向气柱增加能量。\n\n给定在一天（$t \\in [0,\\,86400]$ 秒）内以下随时间变化的边界项和源项，均以单位水平面积表示：\n- 进入大气的净地表焓通量（感热加潜热）$F_{\\mathrm{sfc}}(t)$，其表达式为\n$$F_{\\mathrm{sfc}}(t) = 30 + 90 \\cos\\!\\left( \\frac{2\\pi}{86400}\\,(t - 43200) \\right)\\ \\mathrm{W\\,m^{-2}}.$$\n- 气柱辐射通量辐合（气柱的净辐射加热）$Q_{\\mathrm{rad}}(t)$，其表达式为\n$$Q_{\\mathrm{rad}}(t) = 15 + 25 \\sin\\!\\left( \\frac{2\\pi}{86400}\\,t \\right)\\ \\mathrm{W\\,m^{-2}}.$$\n- 作用于气柱的净机械功率（压力功加粘性/湍流应力功）$W_{\\mathrm{mech}}(t)$，其表达式为\n$$W_{\\mathrm{mech}}(t) = 5 + 2 \\cos\\!\\left( \\frac{2\\pi}{43200}\\,t \\right)\\ \\mathrm{W\\,m^{-2}}.$$\n\n基于对气柱状态（积分的湿静力能加动能）的独立分析得出的一个诊断量表明，在同一天内总能量的实际变化为\n$$\\Delta E_{\\mathrm{actual}} = 4.295\\ \\mathrm{MJ\\,m^{-2}}.$$\n\n从固定控制体积的热力学第一定律和 $E(t)$ 的定义出发，推导气柱积分的能量收支，并计算由收支所隐含的一天内总能量的变化，\n$$\\Delta E_{\\mathrm{budget}} = \\int_{0}^{86400} \\big(F_{\\mathrm{sfc}}(t) + Q_{\\mathrm{rad}}(t) + W_{\\mathrm{mech}}(t)\\big)\\,dt,$$\n然后通过计算残差来评估能量收支的闭合情况\n$$R = \\Delta E_{\\mathrm{budget}} - \\Delta E_{\\mathrm{actual}}.$$\n\n将 $R$ 以 $\\mathrm{MJ\\,m^{-2}}$ 为单位表示，并将最终数值答案四舍五入至四位有效数字。",
            "solution": "该问题要求计算大气能量收支的残差。为此，首先需要计算由随时间积分的能量通量和功率之和所预测的总能量变化，然后将该值与给定的、独立推导的能量变化进行比较。\n\n对于被视为固定控制体积的大气柱，其能量所遵循的基本原理是热力学第一定律。对于一个没有侧向能量平流的系统，单位水平面积上的气柱积分总能量 $E(t)$ 的时间变化率等于所有净垂直通量和源/汇项的总和。问题中给出了这些项，即净地表焓通量（$F_{\\mathrm{sfc}}(t)$）、气柱辐射通量辐合（$Q_{\\mathrm{rad}}(t)$）和净机械功率（$W_{\\mathrm{mech}}(t)$）。因此，控制微分方程为：\n$$ \\frac{dE(t)}{dt} = F_{\\mathrm{sfc}}(t) + Q_{\\mathrm{rad}}(t) + W_{\\mathrm{mech}}(t) $$\n在从 $t=0$ 到最终时间 $T$ 的时间间隔内，总能量的变化可以通过在该区间上对此方程进行积分得到。这就得到了由收支所隐含的总能量变化 $\\Delta E_{\\mathrm{budget}}$：\n$$ \\Delta E_{\\mathrm{budget}} = E(T) - E(0) = \\int_{0}^{T} \\frac{dE(t)}{dt} dt = \\int_{0}^{T} \\big(F_{\\mathrm{sfc}}(t) + Q_{\\mathrm{rad}}(t) + W_{\\mathrm{mech}}(t)\\big)\\,dt $$\n问题指定的时间周期为一天，所以 $T = 86400 \\ \\mathrm{s}$。我们可以分别计算每一项的积分。\n\n1.  **地表焓通量 $F_{\\mathrm{sfc}}(t)$ 的积分**：\n    来自地表通量的贡献是 $F_{\\mathrm{sfc}}(t) = 30 + 90 \\cos\\left( \\frac{2\\pi}{86400}\\,(t - 43200) \\right)$ 的积分。\n    设 $T_0 = 86400$。表达式为 $F_{\\mathrm{sfc}}(t) = 30 + 90 \\cos\\left( \\frac{2\\pi}{T_0}\\,(t - T_0/2) \\right)$。\n    $$ \\int_{0}^{T_0} F_{\\mathrm{sfc}}(t)\\,dt = \\int_{0}^{T_0} \\left[ 30 + 90 \\cos\\left( \\frac{2\\pi}{T_0}\\,(t - \\frac{T_0}{2}) \\right) \\right] dt $$\n    $$ = \\int_{0}^{T_0} 30\\,dt + 90 \\int_{0}^{T_0} \\cos\\left( \\frac{2\\pi}{T_0}t - \\pi \\right) dt $$\n    常数项的积分是 $[30t]_{0}^{T_0} = 30T_0$。第二项是一个余弦函数在一个完整周期（$2\\pi$ 相位变化）上的积分，其值为零。\n    $$ \\int_{0}^{T_0} \\cos\\left( \\frac{2\\pi}{T_0}t - \\pi \\right) dt = \\left[ \\frac{T_0}{2\\pi} \\sin\\left( \\frac{2\\pi}{T_0}t - \\pi \\right) \\right]_{0}^{T_0} = \\frac{T_0}{2\\pi} (\\sin(\\pi) - \\sin(-\\pi)) = 0 $$\n    因此，总贡献为 $30 \\times 86400 \\ \\mathrm{J\\,m^{-2}} = 2,592,000 \\ \\mathrm{J\\,m^{-2}}$。\n\n2.  **辐射通量辐合 $Q_{\\mathrm{rad}}(t)$ 的积分**：\n    来自辐射的贡献是 $Q_{\\mathrm{rad}}(t) = 15 + 25 \\sin\\left( \\frac{2\\pi}{86400}\\,t \\right)$ 的积分。同样，设 $T_0 = 86400$。\n    $$ \\int_{0}^{T_0} Q_{\\mathrm{rad}}(t)\\,dt = \\int_{0}^{T_0} \\left[ 15 + 25 \\sin\\left( \\frac{2\\pi}{T_0}\\,t \\right) \\right] dt $$\n    $$ = \\int_{0}^{T_0} 15\\,dt + 25 \\int_{0}^{T_0} \\sin\\left( \\frac{2\\pi}{T_0}\\,t \\right) dt $$\n    常数项的积分是 $[15t]_{0}^{T_0} = 15T_0$。第二项是一个正弦函数在一个完整周期上的积分，其值也为零。\n    $$ \\int_{0}^{T_0} \\sin\\left( \\frac{2\\pi}{T_0}\\,t \\right) dt = \\left[ -\\frac{T_0}{2\\pi} \\cos\\left( \\frac{2\\pi}{T_0}\\,t \\right) \\right]_{0}^{T_0} = -\\frac{T_0}{2\\pi} (\\cos(2\\pi) - \\cos(0)) = 0 $$\n    因此，总贡献为 $15 \\times 86400 \\ \\mathrm{J\\,m^{-2}} = 1,296,000 \\ \\mathrm{J\\,m^{-2}}$。\n\n3.  **净机械功率 $W_{\\mathrm{mech}}(t)$ 的积分**：\n    来自机械功的贡献是 $W_{\\mathrm{mech}}(t) = 5 + 2 \\cos\\left( \\frac{2\\pi}{43200}\\,t \\right)$ 的积分。设 $T_0 = 86400$。余弦项的周期是 $T_0/2 = 43200$。\n    $$ \\int_{0}^{T_0} W_{\\mathrm{mech}}(t)\\,dt = \\int_{0}^{T_0} \\left[ 5 + 2 \\cos\\left( \\frac{4\\pi}{T_0}\\,t \\right) \\right] dt $$\n    $$ = \\int_{0}^{T_0} 5\\,dt + 2 \\int_{0}^{T_0} \\cos\\left( \\frac{4\\pi}{T_0}\\,t \\right) dt $$\n    常数项的积分是 $[5t]_{0}^{T_0} = 5T_0$。第二项是一个余弦函数在区间 $[0, T_0]$ 内的两个完整周期上的积分，其值为零。\n    $$ \\int_{0}^{T_0} \\cos\\left( \\frac{4\\pi}{T_0}\\,t \\right) dt = \\left[ \\frac{T_0}{4\\pi} \\sin\\left( \\frac{4\\pi}{T_0}\\,t \\right) \\right]_{0}^{T_0} = \\frac{T_0}{4\\pi} (\\sin(4\\pi) - \\sin(0)) = 0 $$\n    因此，总贡献为 $5 \\times 86400 \\ \\mathrm{J\\,m^{-2}} = 432,000 \\ \\mathrm{J\\,m^{-2}}$。\n\n现在，我们将这些贡献相加，得到 $\\Delta E_{\\mathrm{budget}}$：\n$$ \\Delta E_{\\mathrm{budget}} = (2,592,000 + 1,296,000 + 432,000) \\ \\mathrm{J\\,m^{-2}} = 4,320,000 \\ \\mathrm{J\\,m^{-2}} $$\n为了将其以 $\\mathrm{MJ\\,m^{-2}}$ 为单位表示，我们除以 $10^6$：\n$$ \\Delta E_{\\mathrm{budget}} = 4.320 \\ \\mathrm{MJ\\,m^{-2}} $$\n\n最后，我们计算收支残差 $R$，其定义为由收支所隐含的变化与实际变化之差，$R = \\Delta E_{\\mathrm{budget}} - \\Delta E_{\\mathrm{actual}}$。\n已知 $\\Delta E_{\\mathrm{actual}} = 4.295\\ \\mathrm{MJ\\,m^{-2}}$：\n$$ R = 4.320 \\ \\mathrm{MJ\\,m^{-2}} - 4.295 \\ \\mathrm{MJ\\,m^{-2}} = 0.025 \\ \\mathrm{MJ\\,m^{-2}} $$\n问题要求最终答案四舍五入到四位有效数字。数字 $0.025$ 有两位有效数字。为了用四位有效数字表示它，我们写作 $0.02500$。用标准科学记数法表示，这是 $2.500 \\times 10^{-2}$。",
            "answer": "$$\\boxed{2.500 \\times 10^{-2}}$$"
        },
        {
            "introduction": "在理论计算之后，我们将能量守恒原理应用于真实世界的观测数据。本练习模拟了一个典型的微气象学野外实验场景，您需要综合利用来自通量塔、辐射计和土壤传感器的多源数据来计算地表能量平衡 。此任务不仅要求您量化所有主要的能量交换路径，包括湍流通量、地表热通量以及植被和空气中的能量储存，还促使您思考观测中常见的能量不闭合问题，这对于理解实验测量的不确定性和模型的局限性至关重要。",
            "id": "3869719",
            "problem": "在一个时长为 $\\Delta t = 1800$ $\\text{s}$ (半小时) 的正午时段，对一个混交落叶林场进行了仪器测量。一台四分量净辐射计报告了半小时平均净辐射为 $R_{n} = 540$ $\\text{W m}^{-2}$。一套涡度相关 (EC) 系统报告了半小时平均湍流感热通量 $H = 170$ $\\text{W m}^{-2}$ 和潜热通量 $\\text{LE} = 320$ $\\text{W m}^{-2}$。位于深度 $z = 0.05$ $\\text{m}$ 的两个土壤热通量板报告了板平均地表热通量为 $G_{\\text{plate}} = 15$ $\\text{W m}^{-2}$。延伸至 EC 测量高度 $h = 30$ $\\text{m}$ 的冠层气柱在半小时内升温了 $\\Delta T_{\\text{air}} = 0.15$ $\\text{K}$。热通量板上方的近地表土壤层升温了 $\\Delta T_{\\text{soil}} = 0.20$ $\\text{K}$。地上生物量升温了 $\\Delta T_{b} = 0.10$ $\\text{K}$。已知以下材料特性：空气密度 $\\rho = 1.2$ $\\text{kg m}^{-3}$，干空气定压比热 $c_{p} = 1005$ $\\text{J kg}^{-1} \\text{K}^{-1}$，土壤体积热容 $C_{s} = 2.5 \\times 10^{6}$ $\\text{J m}^{-3} \\text{K}^{-1}$，地上生物量单位面积质量 $m_{b} = 12$ $\\text{kg m}^{-2}$，生物量比热 $c_{b} = 2500$ $\\text{J kg}^{-1} \\text{K}^{-1}$。报告的二氧化碳净生态系统交换量 (NEE) 为 $\\text{NEE} = -8$ $\\mu\\text{mol CO}_{2}$ $\\text{m}^{-2}$ $\\text{s}^{-1}$ (负值表示净吸收)，光合作用中每固定一摩尔二氧化碳的吉布斯自由能变化为 $\\Delta G_{\\text{ph}} = 4.70 \\times 10^{5}$ $\\text{J mol}^{-1}$。\n\n从陆地-大气控制体积的能量守恒出发，计算半小时能量平衡闭合率 $C$，其定义为测量的和诊断性估算的非辐射能量交换路径之和与测量的净辐射输入的比值。需要包含的非辐射路径有：湍流通量（$H$ 和 $\\text{LE}$）、校正后的地表热通量（热通量板通量加上方土壤层的储热）、冠层空气储热、生物量储热以及与净碳吸收相关的化学能储存。将最终的闭合率表示为一个无量纲小数值，并将其四舍五入到四位有效数字。\n\n此外，使用基于物理原理的论证来评估观测中任何剩余非闭合项的可能原因，讨论至少两种机制及其在此半小时内对能量平衡的潜在数量级影响。（此评估不影响所需的数值答案，但必须基于基本原理和经过充分检验的事实。）",
            "solution": "控制该问题的基本原理是能量守恒，适用于一个包含森林生态系统的控制体积，该体积从土壤中深度 $z$ 延伸到大气中涡度相关测量高度 $h$。地表能量平衡方程指出，净辐射能量输入 $R_n$ 被感热($H$)和潜热($\\text{LE}$)的湍流通量、地表热通量($G$)以及控制体积内的能量储存率之和所平衡。储能项包括冠层气柱中的热量储存($S_a$)、地上生物量中的热量储存($S_b$)以及通过光合作用转化为化学势能的能量($S_{ph}$)。\n\n控制方程可写为：\n$$R_n = H + \\text{LE} + G + S_a + S_b + S_{ph}$$\n所有项都以 $\\text{W m}^{-2}$ 为单位表示为能量通量密度。问题要求计算能量平衡闭合率 $C$，其定义为：\n$$C = \\frac{H + \\text{LE} + G + S_a + S_b + S_{ph}}{R_n}$$\n我们将根据所提供的数据计算每个非辐射项。湍流通量是直接给出的：\n$H = 170 \\text{ W m}^{-2}$\n$\\text{LE} = 320 \\text{ W m}^{-2}$\n\n地表热通量 $G$ 是深度 $z$ 处由热通量板测量的通量 $G_{\\text{plate}}$ 与板上方土壤层的储热率 $S_s$ 之和。\n$$G = G_{\\text{plate}} + S_s$$\n储热率 $S_s$ 根据时间间隔 $\\Delta t$ 内土壤层的热含量变化计算得出：\n$$S_s = \\frac{C_s \\cdot z \\cdot \\Delta T_{\\text{soil}}}{\\Delta t}$$\n代入给定值：\n$$S_s = \\frac{(2.5 \\times 10^{6} \\text{ J m}^{-3} \\text{ K}^{-1}) \\cdot (0.05 \\text{ m}) \\cdot (0.20 \\text{ K})}{1800 \\text{ s}} = \\frac{25000 \\text{ J m}^{-2}}{1800 \\text{ s}} = \\frac{125}{9} \\text{ W m}^{-2}$$\n因此，地表总热通量为：\n$$G = 15 \\text{ W m}^{-2} + \\frac{125}{9} \\text{ W m}^{-2} = \\frac{135}{9} \\text{ W m}^{-2} + \\frac{125}{9} \\text{ W m}^{-2} = \\frac{260}{9} \\text{ W m}^{-2}$$\n\n冠层气柱的储热率 $S_a$ 根据加热高度为 $h$ 的气柱所需的能量计算得出：\n$$S_a = \\frac{\\rho \\cdot c_p \\cdot h \\cdot \\Delta T_{\\text{air}}}{\\Delta t}$$\n代入给定值：\n$$S_a = \\frac{(1.2 \\text{ kg m}^{-3}) \\cdot (1005 \\text{ J kg}^{-1} \\text{K}^{-1}) \\cdot (30 \\text{ m}) \\cdot (0.15 \\text{ K})}{1800 \\text{ s}} = \\frac{5427 \\text{ J m}^{-2}}{1800 \\text{ s}} = 3.015 \\text{ W m}^{-2}$$\n\n地上生物量的储热率 $S_b$ 根据加热生物量所需的能量计算得出：\n$$S_b = \\frac{m_b \\cdot c_b \\cdot \\Delta T_b}{\\Delta t}$$\n代入给定值：\n$$S_b = \\frac{(12 \\text{ kg m}^{-2}) \\cdot (2500 \\text{ J kg}^{-1} \\text{K}^{-1}) \\cdot (0.10 \\text{ K})}{1800 \\text{ s}} = \\frac{3000 \\text{ J m}^{-2}}{1800 \\text{ s}} = \\frac{5}{3} \\text{ W m}^{-2}$$\n\n通过光合作用的能量储存率 $S_{ph}$ 是 $\\text{CO}_2$ 净生态系统交换量绝对值与每摩尔固定的 $\\text{CO}_2$ 的吉布斯自由能变化的乘积。给定的 $\\text{NEE}$ 是负值，表示生态系统的吸收，这代表了辐射能向化学能的转化。\n首先，我们将 $\\text{NEE}$ 转换为标准单位：\n$$\\text{NEE} = -8 \\text{ } \\mu\\text{mol m}^{-2} \\text{s}^{-1} = -8 \\times 10^{-6} \\text{ mol m}^{-2} \\text{s}^{-1}$$\n那么能量储存率为：\n$$S_{ph} = |\\text{NEE}| \\cdot \\Delta G_{\\text{ph}} = (8 \\times 10^{-6} \\text{ mol m}^{-2} \\text{s}^{-1}) \\cdot (4.70 \\times 10^{5} \\text{ J mol}^{-1}) = 3.76 \\text{ W m}^{-2}$$\n\n现在，我们将所有非辐射能量通量项相加：\n$$\\text{Sum} = H + \\text{LE} + G + S_a + S_b + S_{ph}$$\n$$\\text{Sum} = 170 + 320 + \\frac{260}{9} + 3.015 + \\frac{5}{3} + 3.76 \\text{ W m}^{-2}$$\n为了精确计算，我们在适当的地方使用分数：$\\frac{5}{3} = \\frac{15}{9}$。\n$$\\text{Sum} = 490 + \\frac{260}{9} + 3.015 + \\frac{15}{9} + 3.76 = 490 + \\frac{275}{9} + 6.775$$\n$$\\text{Sum} = 496.775 + \\frac{275}{9} \\approx 496.775 + 30.555... = 527.330555... \\text{ W m}^{-2}$$\n\n最后，我们使用给定的净辐射 $R_n = 540 \\text{ W m}^{-2}$ 计算闭合率 $C$：\n$$C = \\frac{\\text{Sum}}{R_n} = \\frac{527.330555... \\text{ W m}^{-2}}{540 \\text{ W m}^{-2}} \\approx 0.976538...$$\n四舍五入到四位有效数字，闭合率为 $0.9765$。\n\n能量不平衡，或称非闭合项，为 $R_n - \\text{Sum} = 540 - 527.33 \\approx 12.67 \\text{ W m}^{-2}$。这个约占可用能量 $2.3\\%$ 的剩余差额是微气象学研究中的一个共同特征。这个剩余非闭合项的可能原因包括：\n\n1.  **涡度相关 (EC) 的系统性低估**：EC 技术依赖于捕捉垂直风速脉动与标量（如 $H$ 的温度和 $\\text{LE}$ 的水汽）脉动之间的协方差。有充分的文献记载，标准的 EC 数据处理，特别是使用 $30$ 分钟的平均时间，可能无法捕捉到湍流输送的全谱。低频、大尺度的涡旋（次级环流）可以对垂直输送做出显著贡献，但在平均时段内可能被当作“平均流”而被滤除。这导致对 $H$ 和 $\\text{LE}$ 的系统性低估。对真实湍流通量的低估仅需达到 $(12.67 / 490) \\times 100\\% \\approx 2.6\\%$ 就足以弥补观测到的差额。这样的误差完全在文献报道的 $10-30\\%$ 的典型低估范围内，这使其成为能量平衡差额最可能的贡献者。\n\n2.  **被忽略的能量储存项**：我们的计算包括了主要的储能项，但其他更小的项常常被忽略。一个重要的项是冠层空气体积中储存的潜热变化。当空气变暖时，其容纳水蒸气的能力增加。如果相对湿度大致保持不变，比湿 $q$ 将会上升。潜热储存率 $S_q$ 由 $S_q = \\rho L_v h (\\Delta q / \\Delta t)$ 给出，其中 $L_v$ 是汽化潜热（$\\approx 2.5 \\times 10^6 \\text{ J kg}^{-1}$）。在给定条件下（例如，在 $T=25^\\circ\\text{C}$ 时），$\\Delta T_{\\text{air}} = 0.15 \\text{ K}$ 的温度上升可能导致在半小时内比湿增加约 $\\Delta q \\approx 0.2 \\text{ g kg}^{-1}$。相应的储能项数量级约为 $S_q \\approx (1.2 \\cdot 2.5 \\times 10^6 \\cdot 30 \\cdot 0.0002) / 1800 \\approx 10 \\text{ W m}^{-2}$。这个量级与观测到的不平衡量 $12.67 \\text{ W m}^{-2}$ 相当，表明忽略此项可能是一个重要的误差来源，并可以解释大部分的剩余项。",
            "answer": "$$\\boxed{0.9765}$$"
        },
        {
            "introduction": "物理定律的离散化是地球系统模型的核心，而数值方案本身必须能够精确地维持这些定律。本练习将带您进入计算建模领域，要求您为能量守恒方程实现一个有限体积数值方案 。您的目标是证明在周期性边界条件下，所设计的方案能够在机器精度内保持系统总能量守恒。这项实践对于理解构建稳定且物理上可靠的气候和地球系统模型的数值基础至关重要。",
            "id": "3869737",
            "problem": "考虑一个用于环境和地球系统建模中水平均质层的二维周期性域，该域被离散为 $N_x \\times N_y$ 个控制体积（单元）。设单元中心总能量为 $E_{i,j}$，单位为焦耳（$\\mathrm{J}$），离散能量通量场定义在交错网格上，使得垂直面上的通量 $x$ 分量为 $F_x$，其值为 $F_x\\left(i+\\tfrac{1}{2},j\\right)$，水平面上的通量 $y$ 分量为 $F_y$，其值为 $F_y\\left(i,j+\\tfrac{1}{2}\\right)$，单位均为焦耳/秒（$\\mathrm{J}/\\mathrm{s}$）。假设在两个方向上都采用严格的周期性边界条件，即对于所有有效的 $i$ 和 $j$，均有 $F_x\\left(N_x+\\tfrac{1}{2},j\\right)=F_x\\left(\\tfrac{1}{2},j\\right)$ 和 $F_y\\left(i,N_y+\\tfrac{1}{2}\\right)=F_y\\left(i,\\tfrac{1}{2}\\right)$。此问题的基本依据是通过守恒定律 $\\partial_t E + \\nabla \\cdot \\mathbf{F} = 0$ 表达的局部能量守恒，其中 $\\mathbf{F} = (F_x, F_y)$ 是能量通量矢量。\n\n你的任务是：\n- 使用有限体积法 (FVM)，从守恒定律和散度定理推导出一个通量散度的离散表达式，该表达式用于在大小为 $\\Delta t$ 秒（$\\mathrm{s}$）的单个显式欧拉时间步长上更新单元中心总能量 $E_{i,j}$。不要假设单元内有任何源项或汇项。\n- 在交错网格上实现此离散更新，以使该更新在周期性边界下是守恒的，达到机器精度；也就是说，域积分能量 $\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1} E_{i,j}$ 在浮点舍入误差范围内保持不变。\n\n程序要求：\n- 对于每个测试用例，用严格正值初始化 $E_{i,j}$（单位：焦耳，$\\mathrm{J}$）。将周期性交错通量场 $(F_x,F_y)$ 初始化为随机周期场或平滑周期场，并显式强制执行周期性包裹条件 $F_x\\left(N_x+\\tfrac{1}{2},j\\right)=F_x\\left(\\tfrac{1}{2},j\\right)$ 和 $F_y\\left(i,N_y+\\tfrac{1}{2}\\right)=F_y\\left(i,\\tfrac{1}{2}\\right)$。\n- 使用你推导的离散散度，在单个显式欧拉步长上更新 $E_{i,j}$。\n- 计算域积分能量的相对变化，定义为浮点数\n$$r = \\frac{\\left|\\sum_{i,j} E_{i,j}^{\\,\\text{new}} - \\sum_{i,j} E_{i,j}^{\\,\\text{old}}\\right|}{\\left|\\sum_{i,j} E_{i,j}^{\\,\\text{old}}\\right|},$$\n该值是无量纲的。此 $r$ 值用于量化守恒性至机器精度。\n\n角度单位不适用。所有物理量都应使用指定的单位：能量单位为焦耳（$\\mathrm{J}$），通量单位为焦耳/秒（$\\mathrm{J}/\\mathrm{s}$）。时间步长 $\\Delta t$ 必须以秒（$\\mathrm{s}$）为单位。最终输出应为如上定义的浮点数（小数）。\n\n测试套件：\n- 用例 $1$（一般情况）：$N_x=10$，$N_y=8$，$\\Delta t=0.5$，使用由均匀分布构成的随机周期通量场；使用随机种子 $0$ 和通量振幅 $A=10.0$。\n- 用例 $2$（退化的最小网格）：$N_x=1$，$N_y=1$，$\\Delta t=1.0$，使用随机周期通量场；使用随机种子 $42$ 和通量振幅 $A=100.0$。\n- 用例 $3$（平滑周期通量，各向异性尺寸）：$N_x=64$，$N_y=16$，$\\Delta t=0.001$，使用平滑周期通量场\n$$F_x\\left(i+\\tfrac{1}{2},j\\right) = A \\sin\\!\\left(2\\pi \\frac{i}{N_x}\\right)\\cos\\!\\left(2\\pi \\frac{j}{N_y}\\right), \\quad\nF_y\\left(i,j+\\tfrac{1}{2}\\right) = A \\cos\\!\\left(2\\pi \\frac{i}{N_x}\\right)\\sin\\!\\left(2\\pi \\frac{j}{N_y}\\right),$$\n使用振幅 $A=5.0$，并显式强制执行周期性包裹 $F_x\\left(N_x+\\tfrac{1}{2},j\\right)=F_x\\left(\\tfrac{1}{2},j\\right)$ 和 $F_y\\left(i,N_y+\\tfrac{1}{2}\\right)=F_y\\left(i,\\tfrac{1}{2}\\right)$。\n- 用例 $4$（大时间步长压力测试）：$N_x=20$，$N_y=20$，$\\Delta t=10000.0$，使用随机周期通量场；使用随机种子 $12345$ 和通量振幅 $A=1000.0$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按测试用例的顺序排列 $[r_1,r_2,r_3,r_4]$，其中每个 $r_k$ 是为测试用例 $k$ 定义的浮点数。",
            "solution": "该问题要求使用有限体积法 (FVM) 在周期性域上推导并实现一个用于二维能量守恒定律的守恒数值格式。\n\n### 1. 离散更新方程的推导\n\n出发点是能量守恒定律的微分形式，它指出能量密度的时间变化率加上能量通量的散度为零：\n$$\n\\partial_t \\mathcal{E} + \\nabla \\cdot \\mathbf{F} = 0\n$$\n此处，$\\mathcal{E}$ 是单位面积的能量（单位：$\\mathrm{J}/\\mathrm{m}^2$），$\\mathbf{F} = (F_{\\text{density}, x}, F_{\\text{density}, y})$ 是能量通量矢量（单位：$\\mathrm{W}/\\mathrm{m}$ 或 $\\mathrm{J}/\\mathrm{s} \\cdot \\mathrm{m}$）。\n\n有限体积法涉及将此守恒定律在一个控制体积上进行积分，在本例中，该控制体积是面积为 $A_{i,j}$、索引为 $(i,j)$ 的单个网格单元。\n$$\n\\int_{A_{i,j}} \\partial_t \\mathcal{E} \\,dA + \\int_{A_{i,j}} \\nabla \\cdot \\mathbf{F} \\,dA = 0\n$$\n令 $E_{i,j} = \\int_{A_{i,j}} \\mathcal{E} \\,dA$ 为单元 $(i,j)$ 中的总能量，单位为焦耳（$\\mathrm{J}$）。第一项变为该单元总能量的时间导数，即 $\\frac{dE_{i,j}}{dt}$。\n\n对于第二项，我们应用散度定理，它将散度的面积分转换为沿单元边界 $\\partial A_{i,j}$ 的通量线积分：\n$$\n\\int_{A_{i,j}} \\nabla \\cdot \\mathbf{F} \\,dA = \\oint_{\\partial A_{i,j}} \\mathbf{F} \\cdot \\mathbf{n} \\,ds\n$$\n其中 $\\mathbf{n}$ 是向外的法向量。线积分是穿过单元四个面（东、西、北、南）的通量之和。\n\n问题将离散通量 $F_x$ 和 $F_y$ 定义为穿过一个单元面的总功率，单位为 $\\mathrm{J}/\\mathrm{s}$。这意味着它们已经沿面的长度进行了积分。我们采用交错网格记法，其中 $F_x(i+\\tfrac{1}{2}, j)$ 是单元 $(i,j)$ 和 $(i+1,j)$ 之间面上的通量，$F_y(i, j+\\tfrac{1}{2})$ 是单元 $(i,j)$ 和 $(i,j+1)$之间面上的通量。那么，从单元 $(i,j)$ 流出的向外通量为：\n$$\n\\oint_{\\partial A_{i,j}} \\mathbf{F} \\cdot \\mathbf{n} \\,ds = F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j) + F_y(i, j+\\tfrac{1}{2}) - F_y(i, j-\\tfrac{1}{2})\n$$\n其中正值对应于正坐标方向的通量。$F_x(i+\\tfrac{1}{2}, j)$ 是从东面流出的通量，而 $-F_x(i-\\tfrac{1}{2}, j)$ 是从西面流出的通量（即流入量为 $F_x(i-\\tfrac{1}{2}, j)$）。\n\n将这些项代回到积分形式的守恒定律中，得到单元 $(i,j)$ 中能量的半离散方程：\n$$\n\\frac{dE_{i,j}}{dt} + \\left[ \\left( F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j) \\right) + \\left( F_y(i, j+\\tfrac{1}{2}) - F_y(i, j-\\tfrac{1}{2}) \\right) \\right] = 0\n$$\n方括号中的项表示从单元 $(i,j)$ 流出的通量的离散散度。\n\n为了获得一个全离散格式，我们使用大小为 $\\Delta t$ 的显式欧拉前向步来离散化时间导数：\n$$\n\\frac{E_{i,j}^{\\text{new}} - E_{i,j}^{\\text{old}}}{\\Delta t} = - \\left[ \\left( F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j) \\right) + \\left( F_y(i, j+\\tfrac{1}{2}) - F_y(i, j-\\tfrac{1}{2}) \\right) \\right]\n$$\n对更新后的能量 $E_{i,j}^{\\text{new}}$ 进行整理，我们得到最终的更新方程：\n$$\nE_{i,j}^{\\text{new}} = E_{i,j}^{\\text{old}} - \\Delta t \\left[ \\left( F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j) \\right) + \\left( F_y(i, j+\\tfrac{1}{2}) - F_y(i, j-\\tfrac{1}{2}) \\right) \\right]\n$$\n\n### 2. 周期性域上守恒性的证明\n\n如果在整个域上积分的总能量 $\\sum_{j=0}^{N_y-1} \\sum_{i=0}^{N_x-1} E_{i,j}$ 随时间保持不变，则该格式是守恒的。让我们对所有单元的更新方程进行求和：\n$$\n\\sum_{j=0}^{N_y-1} \\sum_{i=0}^{N_x-1} E_{i,j}^{\\text{new}} = \\sum_{j=0}^{N_y-1} \\sum_{i=0}^{N_x-1} E_{i,j}^{\\text{old}} - \\Delta t \\sum_{j=0}^{N_y-1} \\sum_{i=0}^{N_x-1} \\left[ \\left( F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j) \\right) + \\left( F_y(i, j+\\tfrac{1}{2}) - F_y(i, j-\\tfrac{1}{2}) \\right) \\right]\n$$\n为了证明守恒性，我们必须证明最后一项，即所有离散散度之和为零。首先让我们分析 $x$ 方向通量差之和：\n$$\n\\sum_{j=0}^{N_y-1} \\sum_{i=0}^{N_x-1} \\left( F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j) \\right)\n$$\n对于每一行 $j$，对 $i$ 的内层求和是一个伸缩级数：\n$$\n\\sum_{i=0}^{N_x-1} \\left( F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j) \\right) = \\left( F_x(\\tfrac{3}{2},j) - F_x(\\tfrac{1}{2},j) \\right) + \\dots + \\left( F_x(N_x+\\tfrac{1}{2},j) - F_x(N_x-\\tfrac{1}{2},j) \\right)\n$$\n此和化简为 $F_x(N_x+\\tfrac{1}{2}, j) - F_x(\\tfrac{1}{2}, j)$。问题指定了周期性边界条件，$F_x(N_x+\\tfrac{1}{2}, j) = F_x(\\tfrac{1}{2}, j)$。因此，对于每个 $j$，该和为零。所以，对所有 $j$ 的总和也为零。\n\n类似地，对于 $y$ 方向通量差：\n$$\n\\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left( F_y(i, j+\\tfrac{1}{2}) - F_y(i, j-\\tfrac{1}{2}) \\right)\n$$\n对于每一列 $i$，对 $j$ 的内层求和是一个伸缩级数，化简为 $F_y(i, N_y+\\tfrac{1}{2}) - F_y(i, \\tfrac{1}{2})$。周期性边界条件 $F_y(i, N_y+\\tfrac{1}{2}) = F_y(i, \\tfrac{1}{2})$ 使得对于每个 $i$ 该和为零。因此，对所有 $i$ 的总和也为零。\n\n由于两个通量差之和均为零，域积分能量的总变化为零：\n$$\n\\sum_{i,j} E_{i,j}^{\\text{new}} = \\sum_{i,j} E_{i,j}^{\\text{old}} - \\Delta t \\cdot (0 + 0) = \\sum_{i,j} E_{i,j}^{\\text{old}}\n$$\n这证明了该数值格式是精确守恒的。在浮点实现中，守恒性将在机器精度范围内成立。\n\n### 3. 实现策略\n\n我们将使用 `numpy` 进行高效的数组操作。\n- 单元中心能量 $E_{i,j}$ 将存储在形状为 `(Ny, Nx)` 的 `numpy` 数组 `E` 中。\n- 交错通量 $F_x(i+\\tfrac{1}{2}, j)$ 和 $F_y(i, j+\\tfrac{1}{2})$ 将存储在形状均为 `(Ny, Nx)` 的数组 `Fx` 和 `Fy` 中。在这里，`Fx[j, i]` 对应于 $F_x(i+\\tfrac{1}{2}, j)$（单元 $(i,j)$ 右侧面上的通量），而 `Fy[j, i]` 对应于 $F_y(i, j+\\tfrac{1}{2})$（单元 $(i,j)$ 顶面上的通量）。\n- 诸如 $F_x(i+\\tfrac{1}{2}, j) - F_x(i-\\tfrac{1}{2}, j)$ 之类的通量差项可以使用矢量化为所有单元同时计算。单元 $(i,j)$ 左侧面上的通量 $F_x(i-\\tfrac{1}{2}, j)$ 与单元 $(i-1,j)$ 右侧面上的通量相同。由于周期性，对于单元 $(0,j)$，其左侧面通量是单元 $(N_x-1, j)$ 的右侧面通量。此操作对应于循环移位。\n- `numpy.roll()` 函数非常适合此操作。对于所有 `i` 的项 $F_x(i-\\tfrac{1}{2}, j)$ 可由 `np.roll(Fx, 1, axis=1)` 表示。类似地，$F_y(i, j-\\tfrac{1}{2})$ 可由 `np.roll(Fy, 1, axis=0)` 表示。\n- 因此，所有单元的离散散度可以通过单个矢量化表达式计算：`div_F = (Fx - np.roll(Fx, 1, axis=1)) + (Fy - np.roll(Fy, 1, axis=0))`。\n- 那么所有单元的能量更新为 `E_new = E_old - dt * div_F`。\n- 计算总能量的相对变化量 $r$，以验证数值守恒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: General case\n        {'Nx': 10, 'Ny': 8, 'dt': 0.5, 'flux_type': 'random', 'A': 10.0, 'seed': 0},\n        # Case 2: Degenerate minimal grid\n        {'Nx': 1, 'Ny': 1, 'dt': 1.0, 'flux_type': 'random', 'A': 100.0, 'seed': 42},\n        # Case 3: Smooth periodic flux, anisotropic size\n        {'Nx': 64, 'Ny': 16, 'dt': 0.001, 'flux_type': 'smooth', 'A': 5.0, 'seed': None},\n        # Case 4: Large time step stress test\n        {'Nx': 20, 'Ny': 20, 'dt': 10000.0, 'flux_type': 'random', 'A': 1000.0, 'seed': 12345},\n    ]\n\n    results = []\n    for case in test_cases:\n        r = compute_conservation_error(**case)\n        results.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_conservation_error(Nx, Ny, dt, flux_type, A, seed):\n    \"\"\"\n    Computes the relative change in domain-integrated energy for one test case.\n\n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        dt (float): Time step size in seconds.\n        flux_type (str): Type of flux field ('random' or 'smooth').\n        A (float): Amplitude of the flux field.\n        seed (int or None): Seed for the random number generator.\n\n    Returns:\n        float: The relative change in domain-integrated energy, r.\n    \"\"\"\n    \n    # Initialize cell-centered energy E with strictly positive values.\n    # Using np.ones is simple and sufficient.\n    E_old = np.ones((Ny, Nx), dtype=np.float64)\n    \n    # Generate the periodic staggered flux fields Fx and Fy.\n    # Fx[j, i] corresponds to F_x(i+1/2, j)\n    # Fy[j, i] corresponds to F_y(i, j+1/2)\n    if flux_type == 'random':\n        rng = np.random.default_rng(seed)\n        # Uniform distribution in [-A, A]\n        Fx = A * (2 * rng.random((Ny, Nx), dtype=np.float64) - 1)\n        Fy = A * (2 * rng.random((Ny, Nx), dtype=np.float64) - 1)\n    elif flux_type == 'smooth':\n        i = np.arange(Nx, dtype=np.float64)\n        j = np.arange(Ny, dtype=np.float64)\n        ii, jj = np.meshgrid(i, j)\n        \n        Fx = A * np.sin(2 * np.pi * ii / Nx) * np.cos(2 * np.pi * jj / Ny)\n        Fy = A * np.cos(2 * np.pi * ii / Nx) * np.sin(2 * np.pi * jj / Ny)\n        \n    else:\n        raise ValueError(f\"Unknown flux_type: {flux_type}\")\n\n    # Calculate the discrete divergence of the flux field.\n    # The term Fx(i-1/2, j) for cell (i,j) corresponds to the flux at the\n    # right face of cell (i-1,j), which is Fx[j, i-1] in our array.\n    # np.roll handles the periodicity correctly.\n    Fx_left = np.roll(Fx, 1, axis=1)\n    Fy_bottom = np.roll(Fy, 1, axis=0)\n    \n    div_F = (Fx - Fx_left) + (Fy - Fy_bottom)\n    \n    # Update the energy field using one explicit Euler step.\n    E_new = E_old - dt * div_F\n    \n    # Compute the total domain-integrated energy before and after the update.\n    E_total_old = np.sum(E_old)\n    E_total_new = np.sum(E_new)\n    \n    # Calculate the relative change in total energy.\n    # The denominator should be non-zero as E is initialized with positive values.\n    if E_total_old == 0:\n        if E_total_new == 0:\n            return 0.0\n        else:\n            return np.inf\n\n    r = np.abs(E_total_new - E_total_old) / np.abs(E_total_old)\n    \n    return r\n\nsolve()\n```"
        }
    ]
}