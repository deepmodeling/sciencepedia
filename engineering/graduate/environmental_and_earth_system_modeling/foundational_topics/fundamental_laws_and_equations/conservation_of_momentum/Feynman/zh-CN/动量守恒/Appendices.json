{
    "hands_on_practices": [
        {
            "introduction": "动量方程的积分形式是流体动力学的基石，它使我们能够分析确定“控制体”内流体的整体行为，而无需了解每个点的详细流动情况。这项练习提供了应用这一强大概念的动手经验。通过平衡进出河段的动量与作用于其上的外力（如河床摩擦力），您将掌握一项对模拟和理解大规模环境流动至关重要的基本技能。",
            "id": "3870460",
            "problem": "考虑一个沿水流方向坐标 $x \\in [0,L]$ 的直河段，其横截面为宽度恒为 $b$ 的棱柱形矩形。设控制体为某一瞬时该河段内的水体。假设无侧向入流，风应力可忽略不计，并且在 $x=0$ 和 $x=L$ 处的自由水面高程瞬时相等，因此两端截面上的净水流方向静水压力为 $0$。取下游方向为 $x$ 轴正方向。在上游 ($x=0$) 和下游 ($x=L$) 控制面上的瞬时截面积分的水流方向动量通量已知，并分别记为 $\\mathcal{F}_{\\text{in}}$ 和 $\\mathcal{F}_{\\text{out}}$，两者均定义下游方向为正。床面剪应力的空间分布由下式给出：\n$$\n\\tau_b(x)=\\tau_0 \\left[1+\\alpha \\sin\\!\\left(\\frac{\\pi x}{L}\\right)\\right],\n$$\n其中 $|\\alpha|  1$，其作用方向与下游方向相反。与床面剪应力相比，边壁剪应力可忽略不计。\n\n仅使用基本守恒定律，推导河段内水体的总水流方向动量 $M(t)$ 的瞬时变化率的表达式，其中\n$$\nM(t)=\\int_{0}^{L}\\int_{A(x)} \\rho\\, u(x,\\mathbf{r}_\\perp,t)\\, \\mathrm{d}A\\, \\mathrm{d}x,\n$$\n$\\rho$ 是水的密度，$u$ 是局部水流方向速度，$A(x)$ 是位置 $x$ 处的湿横截面积。将最终答案表示为由 $\\mathcal{F}_{\\text{in}}$、$\\mathcal{F}_{\\text{out}}$、$\\tau_0$、$\\alpha$、$b$ 和 $L$ 构成的单个闭式解析表达式。无需进行数值计算或四舍五入，最终表达式中也无需报告单位。",
            "solution": "该问题被认为是有效的，因为它在科学上基于流体力学原理，内部一致且适定。总水流方向动量的瞬时变化率 $\\frac{dM(t)}{dt}$ 的推导是基于应用于指定控制体的线性动量守恒积分形式，通常称为雷诺输运定理 (Reynolds Transport Theorem)。\n\n应用于水流方向 ($x$) 的空间固定控制体 (CV) 的积分动量方程为：\n$$\n\\frac{d}{dt} \\int_{\\text{CV}} \\rho u \\, dV = \\sum F_x + \\iint_{\\text{CS}_{\\text{in}}} \\rho u (\\mathbf{v} \\cdot \\mathbf{n}) \\, dCS - \\iint_{\\text{CS}_{\\text{out}}} \\rho u (\\mathbf{v} \\cdot \\mathbf{n}) \\, dCS\n$$\n其中 $\\rho$ 是流体密度，$u$ 是水流方向的速度分量，$dV$ 是体积微元，$\\sum F_x$ 是作用在控制体内流体上所有外力在 $x$ 方向上的总和，面积分项代表穿过控制面 (CS) 的净动量通量率，其中 $\\mathbf{v}$ 是速度矢量，$\\mathbf{n}$ 是指向外的法向矢量。\n\n让我们在问题陈述的背景下分析每一项。\n\n左侧项是控制体内储存的总动量的时间变化率。问题将总水流方向动量定义为 $M(t) = \\int_{0}^{L}\\int_{A(x)} \\rho\\, u(x,\\mathbf{r}_\\perp,t)\\, \\mathrm{d}A\\, \\mathrm{d}x$。该积分遍及整个控制体，因此动量方程的左侧正是我们所求的量 $\\frac{dM(t)}{dt}$。\n\n动量通量项表示动量穿过控制体边界的输运速率。\n- 在上游边界 ($x=0$)，截面积分的水流方向动量通量给出为 $\\mathcal{F}_{\\text{in}}$。这对应于进入控制体的动量。\n- 在下游边界 ($x=L$)，截面积分的水流方向动量通量给出为 $\\mathcal{F}_{\\text{out}}$。这对应于离开控制体的动量。\n问题陈述中说明没有侧向入流，因此通过侧面边界的动量通量为零。自由水面上的风应力可忽略不计，且河床是不可渗透的，因此通过这些表面的动量通量也为零。因此，净动量通量率为 $\\mathcal{F}_{\\text{in}} - \\mathcal{F}_{\\text{out}}$。\n\n$\\sum F_x$ 项代表作用在控制体内流体上的水流方向外力总和。我们必须考虑压力、重力和摩擦力。\n- **压力 ($F_P$)**：问题陈述“两端截面上的净水流方向静水压力为 $0$”。因此，在入口 ($x=0$) 和出口 ($x=L$) 处的压力对动量平衡的贡献为零。\n- **重力 ($F_g$)**：重力在水流方向上的分量取决于河床坡度。问题提供了两条关键信息：(1) “在 $x=0$ 和 $x=L$ 处的自由水面高程瞬时相等”，以及 (2) 由此产生的“两端截面上的净水流方向静水压力为 $0$”。设 $z_s$ 为自由水面高程，$z_b$ 为河床高程，$h$ 为水深，使得 $z_s = z_b + h$。在宽度为 $b$ 的矩形横截面上的静水压力为 $F_P = \\frac{1}{2}\\rho g b h^2$。条件 (2) 意味着 $F_P(0) = F_P(L)$，这要求水深相等，$h(0) = h(L)$。条件 (1) 指出 $z_s(0) = z_s(L)$。代入 $z_s = z_b + h$，我们得到 $z_b(0) + h(0) = z_b(L) + h(L)$。由于 $h(0)=h(L)$，必然得出 $z_b(0) = z_b(L)$。这意味着在指定的河段内河床是水平的。因此，重力在水流方向上的分量为零。\n- **摩擦力 ($F_\\tau$)**：这是河床对水体施加的拖曳力。床面剪应力 $\\tau_b(x)$ 作用于流体，方向与水流方向相反（即 $x$ 轴负方向）。作用在河床面积微元 $b \\, dx$ 上的力微元 $dF_\\tau$ 为 $dF_\\tau = -\\tau_b(x) b \\, dx$。为求得总摩擦力，我们必须将此表达式沿整个河床长度从 $x=0$ 到 $x=L$ 进行积分。\n$$\nF_\\tau = \\int_0^L -\\tau_b(x) b \\, dx = -b \\int_0^L \\tau_b(x) \\, dx\n$$\n代入给定的 $\\tau_b(x)$ 表达式：\n$$\nF_\\tau = -b \\int_0^L \\tau_0 \\left[1+\\alpha \\sin\\left(\\frac{\\pi x}{L}\\right)\\right] \\, dx\n$$\n我们可以计算这个积分：\n$$\nF_\\tau = -b \\tau_0 \\left[ \\int_0^L 1 \\, dx + \\alpha \\int_0^L \\sin\\left(\\frac{\\pi x}{L}\\right) \\, dx \\right]\n$$\n第一个积分是 $\\int_0^L 1 \\, dx = [x]_0^L = L$。\n第二个积分是 $\\int_0^L \\sin\\left(\\frac{\\pi x}{L}\\right) \\, dx = \\left[-\\frac{L}{\\pi} \\cos\\left(\\frac{\\pi x}{L}\\right)\\right]_0^L = -\\frac{L}{\\pi} (\\cos(\\pi) - \\cos(0)) = -\\frac{L}{\\pi} (-1 - 1) = \\frac{2L}{\\pi}$。\n将这些结果代回 $F_\\tau$ 的表达式中：\n$$\nF_\\tau = -b \\tau_0 \\left(L + \\alpha \\frac{2L}{\\pi}\\right) = -bL\\tau_0 \\left(1 + \\frac{2\\alpha}{\\pi}\\right)\n$$\n\n将所有项组合到动量平衡方程中：\n$$\n\\frac{dM(t)}{dt} = (\\mathcal{F}_{\\text{in}} - \\mathcal{F}_{\\text{out}}) + F_P + F_g + F_\\tau\n$$\n根据上面的确定，$F_P=0$ 和 $F_g=0$，方程简化为：\n$$\n\\frac{dM(t)}{dt} = \\mathcal{F}_{\\text{in}} - \\mathcal{F}_{\\text{out}} + F_\\tau\n$$\n代入推导出的摩擦力 $F_\\tau$ 的表达式：\n$$\n\\frac{dM(t)}{dt} = \\mathcal{F}_{\\text{in}} - \\mathcal{F}_{\\text{out}} - bL\\tau_0 \\left(1 + \\frac{2\\alpha}{\\pi}\\right)\n$$\n这就是河段内水体的总水流方向动量瞬时变化率的最终闭式解析表达式，用给定参数表示。",
            "answer": "$$\n\\boxed{\\mathcal{F}_{\\text{in}} - \\mathcal{F}_{\\text{out}} - bL\\tau_0\\left(1 + \\frac{2\\alpha}{\\pi}\\right)}\n$$"
        },
        {
            "introduction": "在大规模大气和海洋系统中，地转平衡为流动提供了一个有用的初步近似。然而，真实世界更为复杂，正是与这种理想平衡的偏差揭示了有趣的动力学过程，例如加速度和摩擦力。本练习让您扮演数据分析师的角色，使用观测到的大气数据来诊断作用中的力。您将计算“地转残差”以量化真实风与理想平衡的偏差程度，然后利用此信息推断摩擦力的大小，这是天气和气候模型中的一个关键过程。",
            "id": "3870446",
            "problem": "一个位于陆地上空 $850\\ \\mathrm{hPa}$ 等压面上、以北纬 $\\phi = 45^{\\circ}\\ \\mathrm{N}$ 为中心的中纬度天气尺度系统正在被分析。考虑水平均匀的平均风 $u$（纬向，向东）和 $v$（经向，向北），其水平梯度虽小但有限。基本依据是在旋转地球上、Boussinesq 近似下，等压面上的水平动量守恒。其中，纬向动量趋势由科里奥利力、水平气压梯度力、水平动量通量辐合以及摩擦应力共同决定。\n\n假设如下：\n- 流动是准定常的，因此 $\\partial u/\\partial t \\approx 0$，且在该高度上垂直平流可以忽略不计。\n- 位势为 $\\Phi = g Z$，其中 $g$ 是重力加速度，$Z$ 是位势高度；单位质量的水平气压梯度力为 $-\\nabla \\Phi$。\n- 科里奥利参数为 $f = 2 \\Omega \\sin\\phi$，其中 $\\Omega$ 是地球自转角速度。\n- 行星边界层（PBL）中的摩擦应力被参数化为线性拖曳 $F_u = - r\\, u$，其中 $r$ 是一个待诊断的未知整体拖曳系数。\n- 对地转平衡的偏离由纬向残差 $R_x \\equiv - f v + \\partial \\Phi/\\partial x$ 捕捉，在所述假设下，该残差必须与动量通量辐合和摩擦效应相平衡。\n\n在分析区域内，观测给出：\n- $u = 12\\ \\mathrm{m\\ s^{-1}}$ 和 $v = 6\\ \\mathrm{m\\ s^{-1}}$，\n- $\\partial u/\\partial x = -5.0 \\times 10^{-6}\\ \\mathrm{s^{-1}}$ 和 $\\partial u/\\partial y = -5.0 \\times 10^{-6}\\ \\mathrm{s^{-1}}$，\n- $\\partial Z/\\partial x = 6.0 \\times 10^{-5}$，\n- $g = 9.81\\ \\mathrm{m\\ s^{-2}}$，\n- 为便于数值计算，取 $f = 1.03 \\times 10^{-4}\\ \\mathrm{s^{-1}}$。\n\n从水平动量守恒定律和所述假设出发，推导将地转残差 $R_x$ 与水平动量通量辐合及摩擦联系起来的纬向平衡关系。利用此关系诊断出使得该高度上纬向动量收支闭合的整体拖曳系数 $r$。将纬向动量的平流加速度处理为 $u\\,\\partial u/\\partial x + v\\,\\partial u/\\partial y$。\n\n计算并报告 $r$ 的值。将答案四舍五入到三位有效数字。以 $\\mathrm{s^{-1}}$ 为单位表示 $r$。",
            "solution": "该问题要求从等压面上的纬向动量收支中诊断出整体拖曳系数 $r$。验证过程确认了该问题在科学上是合理的、提法是适定的，并包含足够、一致的信息以获得唯一解。我们从水平动量守恒的基本原理开始。\n\n在旋转地球的P坐标系中，纬向风分量 $u$ 的水平动量方程由下式给出：\n$$\n\\frac{Du}{Dt} = fv - \\frac{\\partial \\Phi}{\\partial x} + F_x\n$$\n其中 $\\frac{Du}{Dt}$ 是纬向风的物质导数，$f$ 是科里奥利参数，$v$ 是经向风，$\\Phi$ 是位势，$F_x$ 代表单位质量的纬向摩擦力分量。\n\n物质导数可以展开为：\n$$\n\\frac{Du}{Dt} = \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y} + \\omega \\frac{\\partial u}{\\partial p}\n$$\n问题指定了几个假设：\n1.  流动是准定常的，因此局地时间倾向为零：$\\frac{\\partial u}{\\partial t} \\approx 0$。\n2.  垂直平流可以忽略，因此项 $\\omega \\frac{\\partial u}{\\partial p}$ 被忽略。\n3.  平流加速度由 $u\\,\\partial u/\\partial x + v\\,\\partial u/\\partial y$ 给出。\n4.  摩擦应力被参数化为线性拖曳：$F_x = F_u = -r u$。\n5.  位势为 $\\Phi = gZ$，其中 $g$ 是重力加速度，$Z$ 是位势高度。因此，气压梯度力项为 $\\frac{\\partial \\Phi}{\\partial x} = g \\frac{\\partial Z}{\\partial x}$。\n\n将这些代入动量方程，得到稳态纬向动量平衡：\n$$\nu \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y} = fv - g \\frac{\\partial Z}{\\partial x} - r u\n$$\n该方程表示了平流加速度（左侧）与科里奥利力、气压梯度力和摩擦力（右侧）之间的平衡。\n\n问题陈述定义了纬向残差 $R_x \\equiv -fv + \\partial\\Phi/\\partial x$。该残差由动量通量辐合和摩擦平衡的说法对应于我们推导出的方程的重新排列。让我们重新排列方程以分离各项：\n$$\n\\underbrace{g \\frac{\\partial Z}{\\partial x} - fv}_{R_x} \\ + \\ \\underbrace{u \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y}}_{\\text{Advection}} \\ + \\ \\underbrace{r u}_{\\text{Friction}} = 0\n$$\n这证实了残差力、平流加速度和摩擦拖曳之和为零，表示了所要求的闭合收支。\n\n我们的目标是求解未知的拖曳系数 $r$。我们重新排列稳态动量方程以分离出 $r$：\n$$\nr u = fv - g \\frac{\\partial Z}{\\partial x} - \\left(u \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y}\\right)\n$$\n$$\nr = \\frac{1}{u} \\left[ fv - g \\frac{\\partial Z}{\\partial x} - \\left(u \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y}\\right) \\right]\n$$\n现在，我们将给定的数值代入此表达式中。提供的数据是：\n- $u = 12\\ \\mathrm{m\\ s^{-1}}$\n- $v = 6\\ \\mathrm{m\\ s^{-1}}$\n- $\\partial u/\\partial x = -5.0 \\times 10^{-6}\\ \\mathrm{s^{-1}}$\n- $\\partial u/\\partial y = -5.0 \\times 10^{-6}\\ \\mathrm{s^{-1}}$\n- $\\partial Z/\\partial x = 6.0 \\times 10^{-5}$\n- $g = 9.81\\ \\mathrm{m\\ s^{-2}}$\n- $f = 1.03 \\times 10^{-4}\\ \\mathrm{s^{-1}}$\n\n我们计算方括号中的每一项：\n1.  科里奥利项：$fv$\n    $fv = (1.03 \\times 10^{-4}\\ \\mathrm{s^{-1}}) \\times (6\\ \\mathrm{m\\ s^{-1}}) = 6.18 \\times 10^{-4}\\ \\mathrm{m\\ s^{-2}}$\n2.  气压梯度力项：$g (\\partial Z/\\partial x)$\n    $g \\frac{\\partial Z}{\\partial x} = (9.81\\ \\mathrm{m\\ s^{-2}}) \\times (6.0 \\times 10^{-5}) = 5.886 \\times 10^{-4}\\ \\mathrm{m\\ s^{-2}}$\n3.  平流项：$u (\\partial u/\\partial x) + v (\\partial u/\\partial y)$\n    $u \\frac{\\partial u}{\\partial x} = (12\\ \\mathrm{m\\ s^{-1}}) \\times (-5.0 \\times 10^{-6}\\ \\mathrm{s^{-1}}) = -6.0 \\times 10^{-5}\\ \\mathrm{m\\ s^{-2}}$\n    $v \\frac{\\partial u}{\\partial y} = (6\\ \\mathrm{m\\ s^{-1}}) \\times (-5.0 \\times 10^{-6}\\ \\mathrm{s^{-1}}) = -3.0 \\times 10^{-5}\\ \\mathrm{m\\ s^{-2}}$\n    总平流加速度为 $(-6.0 \\times 10^{-5}) + (-3.0 \\times 10^{-5}) = -9.0 \\times 10^{-5}\\ \\mathrm{m\\ s^{-2}}$。\n\n现在，我们将这些分量代回 $r$ 的方程中：\n$$\nr = \\frac{1}{12\\ \\mathrm{m\\ s^{-1}}} \\left[ (6.18 \\times 10^{-4}\\ \\mathrm{m\\ s^{-2}}) - (5.886 \\times 10^{-4}\\ \\mathrm{m\\ s^{-2}}) - (-9.0 \\times 10^{-5}\\ \\mathrm{m\\ s^{-2}}) \\right]\n$$\n$$\nr = \\frac{1}{12} \\left[ (6.18 - 5.886) \\times 10^{-4} + 9.0 \\times 10^{-5} \\right] \\ \\mathrm{s^{-1}}\n$$\n$$\nr = \\frac{1}{12} \\left[ 0.294 \\times 10^{-4} + 0.9 \\times 10^{-4} \\right] \\ \\mathrm{s^{-1}}\n$$\n$$\nr = \\frac{1}{12} \\left[ (0.294 + 0.9) \\times 10^{-4} \\right] \\ \\mathrm{s^{-1}}\n$$\n$$\nr = \\frac{1.194 \\times 10^{-4}}{12} \\ \\mathrm{s^{-1}}\n$$\n$$\nr = 0.0995 \\times 10^{-4}\\ \\mathrm{s^{-1}}\n$$\n$$\nr = 9.95 \\times 10^{-6}\\ \\mathrm{s^{-1}}\n$$\n问题要求将答案四舍五入到三位有效数字。我们的结果已经是这种形式。诊断出的整体拖曳系数 $r$ 为 $9.95 \\times 10^{-6}\\ \\mathrm{s^{-1}}$。",
            "answer": "$$\\boxed{9.95 \\times 10^{-6}}$$"
        },
        {
            "introduction": "地球系统模型将像动量守恒这样的连续物理定律转化为计算机可以求解的离散规则集。对这些模型的一个关键要求是，它们必须在数值上遵守这些守恒原理，以避免动量的人为源或汇。这项练习将带您从理论走向实践，任务是构建一个简单的动量输运数值模型。您将实现一个“守恒的有限体积格式”，并验证通过设计，您模拟系统中的总动量随时间是守恒的，从而为如何构建稳健的数值模型提供基础性理解。",
            "id": "3870554",
            "problem": "考虑一个用于环境和地球系统建模的一维周期性区域，以表示动量密度场的演化。设动量密度由 $m(x,t)$ 表示，定义在一个长度为 $L$ 的环上，其中 $x \\in [0,L)$ 并具有周期性边界条件。平流速度为 $u$，扩散系数为 $\\nu$。从动量守恒定律出发，$m(x,t)$ 的演化由一个通量-散度形式控制，使得 $m$ 的变化率等于动量通量空间散度的负值。目标是实现一个在周期性边界条件下遵循守恒原理的简单数值离散化方法，并计算总动量在指定的模拟时间内是否发生变化。\n\n您必须从基本守恒原理出发，构建一个能同时表示平流和扩散的空间守恒离散格式。时间推进必须是显式的，且边界条件必须是周期性的。测试要求评估离散总动量（定义为 $m(x,t)$ 在整个区域上的空间积分）在指定条件下是否在严格的数值容差内保持不变。\n\n所有变量均为无量纲。不需要物理单位。\n\n您的程序必须：\n1. 将区域表示为在 $[0,L)$ 上的 $N$ 个均匀间隔的控制体积，并采用周期性边界条件。\n2. 使用显式时间步进方法将 $m$ 推进指定的步数。\n3. 以守恒通量形式构建空间算子，使得每个控制体积的更新量为其相邻面通量之差除以网格间距。\n4. 根据 $u$ 的符号为平流通量选择迎风格式，并为与离散梯度成比例的扩散通量选择中心格式。实现必须通过通量差的伸缩求和来确保空间守恒性。\n5. 使用 Courant–Friedrichs–Lewy (CFL) 数来选择时间步长 $\\Delta t$，以满足平流和扩散的显式稳定性约束。设平流 CFL 数为 $0.9$，扩散 CFL 数为 $0.4$。当网格间距为 $\\Delta x = L/N$ 时，若 $|u|  0$，使用 $\\Delta t_{\\text{adv}} = 0.9 \\, \\Delta x / |u|$，否则将 $\\Delta t_{\\text{adv}}$ 设为一个非常大的值；若 $\\nu  0$，使用 $\\Delta t_{\\text{diff}} = 0.4 \\, \\Delta x^2 / \\nu$，否则将 $\\Delta t_{\\text{diff}}$ 设为一个非常大的值。实际使用的时间步长为 $\\Delta t = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{diff}})$。\n6. 计算初始时刻以及将解推进 $n_{\\text{steps}}$ 步后的离散总动量 $M^n = \\sum_{i=0}^{N-1} m_i^n \\, \\Delta x$。报告在容差 $\\epsilon = 10^{-12}$ 的条件下，是否有 $|M^{n_{\\text{steps}}} - M^0| \\le \\epsilon$。每个测试用例的结果必须是一个布尔值。\n\n$m(x,0)$ 的初始条件必须是在均匀的单元中心 $x_i = (i + 0.5)\\Delta x$（$i=0,\\dots,N-1$）上对以下函数进行求值：\n- 情况 A：$m(x,0) = \\sin(2\\pi x / L)$。\n- 情况 B：$m(x,0) = 1$ 对于 $x \\in [0, L/2)$ 且 $m(x,0) = 0$ 对于 $x \\in [L/2, L)$。\n- 情况 C：$m(x,0) = \\cos(4\\pi x / L)$。\n- 情况 D：$m(x,0) = 3$（均匀场）。\n- 情况 E：$m(x,0) = 1 + 0.5 \\sin(2\\pi x / L) + 0.25 \\sin(6\\pi x / L)$。\n\n需使用的测试套件参数：\n- 情况 A：$L = 1$, $N = 128$, $u = 0.7$, $\\nu = 0.01$, $n_{\\text{steps}} = 300$。\n- 情况 B：$L = 1$, $N = 64$, $u = 0.0$, $\\nu = 0.05$, $n_{\\text{steps}} = 400$。\n- 情况 C：$L = 1$, $N = 256$, $u = 1.0$, $\\nu = 0.0$, $n_{\\text{steps}} = 250$。\n- 情况 D：$L = 1$, $N = 4$, $u = 0.3$, $\\nu = 0.01$, $n_{\\text{steps}} = 200$。\n- 情况 E：$L = 1$, $N = 96$, $u = -0.2$, $\\nu = 0.02$, $n_{\\text{steps}} = 350$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result\\_A,result\\_B,result\\_C,result\\_D,result\\_E]$），其中每个条目都是一个布尔值，指示在相应情况下，总动量在指定步数后是否在容差范围内守恒。",
            "solution": "问题陈述被解析并验证为一个在计算物理学领域科学上合理、适定的问题，具体涉及一维平流-扩散方程的数值解以及守恒数值格式的验证。所有必需的参数、初始条件和边界条件均已提供，使得该问题自洽且可解。\n\n基本原理是动量守恒。对于一维系统，动量密度 $m(x,t)$ 根据以通量-散度形式表示的守恒定律演化：\n$$\n\\frac{\\partial m}{\\partial t} + \\frac{\\partial J}{\\partial x} = 0\n$$\n此处，$J(x,t)$ 是动量通量。问题指明该通量由一个平流分量和一个扩散分量组成：\n$$\nJ = J_{\\text{adv}} + J_{\\text{diff}} = um - \\nu \\frac{\\partial m}{\\partial x}\n$$\n其中 $u$ 是平流速度，$\\nu$ 是扩散系数。\n\n为了在数值上求解此方程同时遵循守恒原理，我们采用有限体积法。长度为 $L$ 的一维区域被离散化为 $N$ 个连续的控制体积（或称单元），每个单元的宽度均匀，为 $\\Delta x = L/N$。离散动量密度 $m_i^n$ 表示在时间步 $n$ 时 $m(x,t)$ 在单元 $i$ 上的平均值。单元 $i$ 覆盖区间 $[x_{i-1/2}, x_{i+1/2}]$，其中 $x_{i-1/2}$ 和 $x_{i+1/2}$ 是单元面。\n\n将守恒定律在单元 $i$ 上积分得到：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial m}{\\partial t} \\,dx = - \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial J}{\\partial x} \\,dx\n$$\n根据微积分基本定理，并用单元平均值 $m_i$ 来近似 $m$ 的积分，我们得到半离散形式：\n$$\n\\frac{d}{dt} (m_i \\Delta x) = -(J_{i+1/2} - J_{i-1/2})\n$$\n其中 $J_{i \\pm 1/2}$ 表示在相应单元面上计算的通量。整理后为：\n$$\n\\frac{d m_i}{dt} = - \\frac{J_{i+1/2} - J_{i-1/2}}{\\Delta x}\n$$\n这个公式是内在守恒的：一个单元内动量的变化完全由跨越其边界的净通量决定。要使该格式在周期性区域上全局守恒，整个网格上所有通量差之和必须为零。我们来考察所有 $N$ 个单元上时间导数的总和：\n$$\n\\frac{d}{dt} \\sum_{i=0}^{N-1} m_i = - \\frac{1}{\\Delta x} \\sum_{i=0}^{N-1} (J_{i+1/2} - J_{i-1/2})\n$$\n右侧的和是一个伸缩求和。让我们将单元 $i$ 右侧面上的通量表示为 $F_{i+1} = J_{i+1/2}$。那么单元 $i$ 左侧面上的通量就是 $F_i = J_{i-1/2}$。该和变为 $\\sum_{i=0}^{N-1} (F_{i+1} - F_i) = (F_1 - F_0) + (F_2 - F_1) + \\dots + (F_N - F_{N-1}) = F_N - F_0$。由于周期性边界条件，面 $N$ 与面 $0$ 相同，因此 $F_N = F_0$。所以，这个和为零。这意味着总动量 $M = \\sum_{i=0}^{N-1} m_i \\Delta x$ 的变化率为零，即总动量是守恒的。\n\n数值实现必须正确地离散化通量 $J_{i+1/2}$ 和时间导数。\n对于时间导数，使用显式向前欧拉格式：\n$$\nm_i^{n+1} = m_i^n - \\frac{\\Delta t}{\\Delta x} (J_{i+1/2}^n - J_{i-1/2}^n)\n$$\n在时间步 $n$，单元 $i$ 和单元 $i+1$ 之间的面（面 $i+1/2$）上的通量计算如下：\n1.  平流通量，$J^{\\text{adv}}_{i+1/2}$：指定使用一阶迎风格式。面上的值取自迎风单元。\n    - 如果 $u > 0$，$J^{\\text{adv}}_{i+1/2} = u m_i^n$。\n    - 如果 $u \\le 0$，$J^{\\text{adv}}_{i+1/2} = u m_{i+1}^n$。\n2.  扩散通量，$J^{\\text{diff}}_{i+1/2}$：梯度使用中心差分。\n    - $J^{\\text{diff}}_{i+1/2} = -\\nu \\frac{m_{i+1}^n - m_i^n}{\\Delta x}$。\n\n总通量为 $J_{i+1/2}^n = J^{\\text{adv}}_{i+1/2} + J^{\\text{diff}}_{i+1/2}$。\n\n时间步长 $\\Delta t$ 的选择基于显式格式的 Courant–Friedrichs–Lewy (CFL) 穩定性條件。平流和扩散的时间步长约束为：\n$$\n\\Delta t_{\\text{adv}} = C_{\\text{adv}} \\frac{\\Delta x}{|u|} \\quad \\text{and} \\quad \\Delta t_{\\text{diff}} = C_{\\text{diff}} \\frac{\\Delta x^2}{\\nu}\n$$\n给定 CFL 数 $C_{\\text{adv}} = 0.9$ 和 $C_{\\text{diff}} = 0.4$，实际使用的时间步长为 $\\Delta t = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{diff}})$。如果 $u=0$ 或 $\\nu=0$，相应的时间步长限制变为无穷大。\n\n每个测试用例的算法流程如下：\n1.  定义网格参数 $L$、$N$，并计算 $\\Delta x = L/N$。\n2.  设置 $N$ 个单元中心的网格：$x_i = (i + 0.5)\\Delta x$，其中 $i=0, \\dots, N-1$。\n3.  在网格上评估指定的初始条件函数以获得 $m^0$。\n4.  计算初始总动量 $M^0 = \\sum_{i=0}^{N-1} m_i^0 \\Delta x$。\n5.  根据给定参数确定稳定的时间步长 $\\Delta t$。\n6.  迭代 $n_{\\text{steps}}$ 次：\n    a. 使用迎风/中心离散格式和周期性边界条件（例如，通过 `numpy.roll`）计算单元面上的 $N$ 个总通量 $J_{i+1/2}^n$。\n    b. 使用守恒通量差分公式将动量密度场更新至 $m^{n+1}$。\n7.  循环结束后，计算最终总动量 $M^{n_{\\text{steps}}} = \\sum_{i=0}^{N-1} m_i^{n_{\\text{steps}}} \\Delta x$。\n8.  验证绝对差 $|M^{n_{\\text{steps}}} - M^0|$ 是否在容差 $\\epsilon = 10^{-12}$ 之内。结果是一个布尔值。\n\n此过程若正确实现，将证明离散总动量在浮点精度范围内是守恒的，这由数值格式的守恒结构所保证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(L, N, u, nu, n_steps, m0_func):\n    \"\"\"\n    Runs a 1D advection-diffusion simulation and checks for momentum conservation.\n\n    Args:\n        L (float): Domain length.\n        N (int): Number of control volumes.\n        u (float): Advection velocity.\n        nu (float): Diffusive coefficient.\n        n_steps (int): Number of time steps to simulate.\n        m0_func (callable): Function to generate the initial momentum density field.\n\n    Returns:\n        bool: True if total momentum is conserved within tolerance, False otherwise.\n    \"\"\"\n    # 1. Grid setup\n    dx = L / N\n    x = (np.arange(N) + 0.5) * dx\n\n    # 2. Initial condition\n    m = m0_func(x, L, N)\n\n    # 3. Calculate initial total momentum\n    M0 = np.sum(m) * dx\n\n    # 4. Determine stable time step (CFL conditions)\n    if abs(u) > 1e-15:  # Handle u very close to zero\n        dt_adv = 0.9 * dx / abs(u)\n    else:\n        dt_adv = np.inf\n\n    if nu > 1e-15:  # Handle nu very close to zero\n        dt_diff = 0.4 * dx**2 / nu\n    else:\n        dt_diff = np.inf\n\n    dt = min(dt_adv, dt_diff)\n\n    # 5. Time-stepping loop\n    for _ in range(n_steps):\n        # periodic boundary conditions are handled by np.roll\n        m_right = np.roll(m, -1)  # m_{i+1} for all i\n\n        # Calculate advective flux at faces i+1/2 using first-order upwinding\n        if u > 0:\n            J_adv = u * m\n        else:  # u = 0\n            J_adv = u * m_right\n\n        # Calculate diffusive flux at faces i+1/2 using centered differences\n        J_diff = -nu * (m_right - m) / dx\n        \n        # Total flux at faces i+1/2 (flux leaving cell i to the right)\n        J_total = J_adv + J_diff\n        \n        # Flux at faces i-1/2 (flux entering cell i from the left)\n        J_total_left = np.roll(J_total, 1)\n\n        # Update m using the conservative flux-difference form\n        m = m - (dt / dx) * (J_total - J_total_left)\n\n    # 6. Calculate final total momentum\n    M_final = np.sum(m) * dx\n\n    # 7. Check for conservation within tolerance\n    epsilon = 1e-12\n    return abs(M_final - M0) = epsilon\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, N, u, nu, n_steps, ic_name)\n        {'L': 1.0, 'N': 128, 'u': 0.7, 'nu': 0.01, 'n_steps': 300, 'ic': 'A'},\n        {'L': 1.0, 'N': 64,  'u': 0.0, 'nu': 0.05, 'n_steps': 400, 'ic': 'B'},\n        {'L': 1.0, 'N': 256, 'u': 1.0, 'nu': 0.0,  'n_steps': 250, 'ic': 'C'},\n        {'L': 1.0, 'N': 4,   'u': 0.3, 'nu': 0.01, 'n_steps': 200, 'ic': 'D'},\n        {'L': 1.0, 'N': 96,  'u':-0.2, 'nu': 0.02, 'n_steps': 350, 'ic': 'E'},\n    ]\n\n    # Initial condition functions\n    def ic_A(x, L, N): return np.sin(2.0 * np.pi * x / L)\n    def ic_B(x, L, N): \n        m = np.zeros(N)\n        m[0:N//2] = 1.0\n        return m\n    def ic_C(x, L, N): return np.cos(4.0 * np.pi * x / L)\n    def ic_D(x, L, N): return np.full(N, 3.0)\n    def ic_E(x, L, N): return 1.0 + 0.5 * np.sin(2.0 * np.pi * x / L) + 0.25 * np.sin(6.0 * np.pi * x / L)\n    \n    ic_map = {'A': ic_A, 'B': ic_B, 'C': ic_C, 'D': ic_D, 'E': ic_E}\n\n    results = []\n    for case in test_cases:\n        m0_func = ic_map[case['ic']]\n        is_conserved = run_simulation(\n            case['L'], case['N'], case['u'], case['nu'], case['n_steps'], m0_func\n        )\n        results.append(is_conserved)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}