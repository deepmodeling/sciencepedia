{
    "hands_on_practices": [
        {
            "introduction": "这个练习构成了任何源归因研究的基础。为了从观测中推断未知源，我们必须首先在它们之间建立定量的联系。本练习将指导您推导并实现一个标准大气输运模型的格林函数，以构建这种联系，即源-受体灵敏度矩阵$H$。",
            "id": "3886147",
            "problem": "考虑一个由典范常系数偏微分方程（PDE）控制的标量浓度沿水平坐标的一维线性输运。标量浓度用 $c(x,t)$ 表示，风速用 $u$ 表示（单位为 $\\mathrm{m/s}$），扩散率用 $K$ 表示（单位为 $\\mathrm{m^2/s}$），一阶衰减率用 $\\lambda$ 表示（单位为 $\\mathrm{s^{-1}}$）。一个源项 $s(x,t)$ 在指定的坐标和时间瞬时注入质量。假设该线在横向和纵向上是积分的，使得浓度 $c(x,t)$ 的单位为 $\\mathrm{kg/m}$。\n\n您的任务是推导、实现并使用该 PDE 的格林函数（GF）来构建一个受体-源敏感性矩阵 $H$（通常称为足迹矩阵）。矩阵 $H$ 通过线性叠加，将一组位于指定源位置和排放时间的离散单位脉冲排放（每个质量单位为 $\\mathrm{kg}$）映射到指定受体位置和受体时间的浓度。具体来说：\n\n1. 从带有源项的线性平流-扩散-衰减 PDE 开始，\n   $$\n   \\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = K \\frac{\\partial^2 c}{\\partial x^2} - \\lambda c + s(x,t),\n   $$\n   其中所有变量和参数如上定义。您必须以此 PDE 为基础，推导在位置 $x_s$ 和时间 $\\tau$ 释放的瞬时单位质量脉冲的格林函数 $G(\\xi,\\tau)$，然后使用线性叠加将受体浓度表示为 $H$ 和排放向量 $q$ 的形式。\n\n2. 构建足迹矩阵 $H$，其条目 $H_{ij}$ 等于受体 $i$ 对单位脉冲排放 $j$ 的浓度响应。每次排放 $j$ 由其源位置 $x_{s_j}$ 和排放时间 $\\tau_j$ 表征，每个受体 $i$ 由其位置 $x_{r_i}$ 和测量时间 $t_{r_i}$ 表征。必须强制执行因果关系，因此对于 $t_{r_i} \\le \\tau_j$，$H_{ij} = 0$。\n\n3. 使用推导出的表达式数值计算 $H$，然后通过以下公式从排放质量向量 $q$ 计算受体浓度向量 $y$：\n   $$\n   y = H q,\n   $$\n   单位为 $\\mathrm{kg/m}$。\n\n数值和物理设置：\n- 风速：$u = 1.0$ $\\mathrm{m/s}$。\n- 扩散率：$K = 50.0$ $\\mathrm{m^2/s}$。\n- 一阶衰减率：$\\lambda = 1.0 \\times 10^{-3}$ $\\mathrm{s^{-1}}$。\n- 源位置：$x_s \\in \\{0.0, 500.0, 1000.0\\}$ $\\mathrm{m}$。\n- 排放时间：$\\tau \\in \\{0.0, 100.0\\}$ $\\mathrm{s}$。\n- 受体：$(x_r,t_r) \\in \\{(1500.0, 600.0), (2000.0, 1200.0), (300.0, 300.0)\\}$，其中 $x_r$ 单位为 $\\mathrm{m}$，$t_r$ 单位为 $\\mathrm{s}$。\n- 由 $3$ 个源位置和 $2$ 个排放时间的笛卡尔积形成 $6$ 个单位排放脉冲，按源位置然后按时间进行字典序排序。\n\n测试套件：\n- 测试用例 A（一般情况）：$q_A = [2.0, 0.5, 1.0, 0.0, 3.0, 0.1]$，单位为 $\\mathrm{kg}$。\n- 测试用例 B（零排放）：$q_B = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]$，单位为 $\\mathrm{kg}$。\n- 测试用例 C（单个早期脉冲）：$q_C = [0.0, 1.0, 0.0, 0.0, 0.0, 0.0]$，单位为 $\\mathrm{kg}$。\n- 测试用例 D（单个较晚的上游源脉冲）：$q_D = [0.0, 0.0, 0.0, 4.0, 0.0, 0.0]$，单位为 $\\mathrm{kg}$。\n- 测试用例 E（单个较晚的远源脉冲）：$q_E = [0.0, 0.0, 0.0, 0.0, 0.0, 5.0]$，单位为 $\\mathrm{kg}$。\n- 测试用例 F（叠加检验）：评估基于叠加的 $H q_A$ 是否在 $10^{-12}$ 的公差范围内等于 $q_A$ 的格林函数响应的直接求和；输出应为布尔值。\n\n所需输出和单位：\n- 对于测试用例 A-E，以浮点数形式输出得到的受体浓度向量 $y$，单位为 $\\mathrm{kg/m}$。\n- 对于测试用例 F，输出一个布尔值，指示两种计算是否在规定公差内一致。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试结果，形式为逗号分隔的列表，并用方括号括起来。按 $[y_A, y_B, y_C, y_D, y_E, \\text{bool}_F]$ 的顺序排列结果，其中每个 $y_\\cdot$ 扩展为其三个受体条目，顺序与上面给出的受体顺序相同。例如，输出应具有以下形式：\n  $$\n  [y_{A,1}, y_{A,2}, y_{A,3}, y_{B,1}, y_{B,2}, y_{B,3}, y_{C,1}, y_{C,2}, y_{C,3}, y_{D,1}, y_{D,2}, y_{D,3}, y_{E,1}, y_{E,2}, y_{E,3}, \\text{bool}_F],\n  $$\n  其中每个 $y_{\\cdot,i}$ 是一个单位为 $\\mathrm{kg/m}$ 的浮点数，$\\text{bool}_F$ 是一个布尔值。角度不会出现；如果内部使用任何三角函数，角度必须以弧度为单位。不应打印百分比。",
            "solution": "该问题是有效的，因为它在科学上基于输运物理学原理，是良态的、客观的和自洽的。所有必要的参数和条件都已提供，并且没有内部矛盾。\n\n解决方案首先推导控制偏微分方程（PDE）的格林函数，然后使用该函数构建源-受体敏感性矩阵 $H$，最后应用此矩阵计算各种排放情景下的受体浓度。\n\n控制性的一维线性平流-扩散-衰减 PDE 由下式给出：\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = K \\frac{\\partial^2 c}{\\partial x^2} - \\lambda c + s(x,t)\n$$\n其中 $c(x,t)$ 是浓度（单位为 $\\mathrm{kg/m}$），$u$ 是恒定风速， $K$ 是恒定扩散率，$\\lambda$ 是一阶衰减率，$s(x,t)$ 是源项。\n\n格林函数 $G(x,t; x_s, \\tau)$ 表示由瞬时单位质量点源产生的浓度场，即 $s(x,t) = \\delta(x-x_s)\\delta(t-\\tau)$，其中 $\\delta(\\cdot)$ 是狄拉克δ函数。因此，$G$ 是以下方程的解：\n$$\n\\frac{\\partial G}{\\partial t} + u \\frac{\\partial G}{\\partial x} = K \\frac{\\partial^2 G}{\\partial x^2} - \\lambda G + \\delta(x-x_s)\\delta(t-\\tau)\n$$\n初始条件为 $t < \\tau$ 时，$G(x, t; x_s, \\tau) = 0$。\n\n为了求解这个 PDE，我们采用一系列变换。\n\n首先，为了处理衰减项，我们引入一个新变量 $c'(x,t)$，通过变换 $c(x,t) = c'(x,t) e^{-\\lambda t}$ 定义。将此代入 PDE 的齐次版本中，可以发现如果 $c'$ 满足平流-扩散方程，衰减项就会被消除。对于格林函数，一个更直接的方法是，过程从时间 $\\tau$ 开始，衰减作用于经过的时间 $\\Delta t = t-\\tau$。因此，解可以写成平流-扩散方程的解乘以一个衰减因子 $e^{-\\lambda(t-\\tau)}$。\n\n平流-扩散方程为：\n$$\n\\frac{\\partial c'}{\\partial t} + u \\frac{\\partial c'}{\\partial x} = K \\frac{\\partial^2 c'}{\\partial x^2}\n$$\n该方程的解可以通过变换到随平均流移动的坐标系来找到。令 $x' = x - u(t-\\tau)$ 为一个以速度 $u$ 移动的坐标系中的坐标，该坐标系在时间 $\\tau$ 时的原点位于源位置 $x_s$。在此坐标系中，对于在 $x' = 0$ 处释放的物质，PDE 简化为纯扩散（或热）方程：\n$$\n\\frac{\\partial c'}{\\partial t} = K \\frac{\\partial^2 c'}{( \\partial x')^2}\n$$\n对于在时间 $\\tau$ 于 $x'=0$ 处释放的单位质量，在 $t > \\tau$ 时，移动坐标系中的解是一个高斯分布：\n$$\nc'(x', t) = \\frac{1}{\\sqrt{4 \\pi K (t-\\tau)}} \\exp\\left(-\\frac{(x')^2}{4 K (t-\\tau)}\\right)\n$$\n通过代入 $x' = x - x_s - u(t-\\tau)$，变换回原始空间坐标 $x$：\n$$\nG_{AD}(x,t; x_s, \\tau) = \\frac{1}{\\sqrt{4 \\pi K (t-\\tau)}} \\exp\\left(-\\frac{(x - x_s - u(t-\\tau))^2}{4 K (t-\\tau)}\\right)\n$$\n这是平流-扩散方程的格林函数。\n\n最后，重新引入衰减因子 $e^{-\\lambda(t-\\tau)}$，得到原始 PDE 的完整格林函数。因果关系要求在排放前的任何时间浓度都为零，因此我们定义：\n$$\nG(x, t; x_s, \\tau) =\n\\begin{cases}\n    \\frac{1}{\\sqrt{4 \\pi K (t-\\tau)}} \\exp\\left(-\\frac{(x - x_s - u(t-\\tau))^2}{4 K (t-\\tau)}\\right) e^{-\\lambda(t-\\tau)}  & \\text{若 } t > \\tau \\\\\n    0  & \\text{若 } t \\le \\tau\n\\end{cases}\n$$\n\n足迹矩阵 $H$ 的构造使其元素 $H_{ij}$ 是受体 $i$（位于位置 $x_{r_i}$ 和时间 $t_{r_i}$）处，因源 $j$（位于位置 $x_{s_j}$ 和时间 $\\tau_j$）的单位脉冲排放所产生的浓度。根据定义，这由格林函数给出：\n$$\nH_{ij} = G(x_{r_i}, t_{r_i}; x_{s_j}, \\tau_j)\n$$\n令 $\\Delta t_{ij} = t_{r_i} - \\tau_j$ 和 $\\Delta x_{ij} = x_{r_i} - x_{s_j}$，则 $H_{ij}$ 的表达式（对于 $\\Delta t_{ij} > 0$）为：\n$$\nH_{ij} = \\frac{1}{\\sqrt{4 \\pi K \\Delta t_{ij}}} \\exp\\left(-\\frac{(\\Delta x_{ij} - u \\Delta t_{ij})^2}{4 K \\Delta t_{ij}}\\right) e^{-\\lambda \\Delta t_{ij}}\n$$\n问题指定了 $3$ 个受体和 $6$ 个源事件，从而得到一个 $3 \\times 6$ 的矩阵 $H$。源事件是位置 $\\{0.0, 500.0, 1000.0\\}$ $\\mathrm{m}$ 和时间 $\\{0.0, 100.0\\}$ $\\mathrm{s}$ 的笛卡尔积，按字典序排序。受体按给定顺序排列。\n\n一旦计算出 $H$，对于任意排放质量向量 $q$，受体浓度向量 $y$ 通过线性叠加获得，这表示为矩阵-向量乘积：\n$$\ny = Hq\n$$\n向量 $y$ 的每个元素 $y_i$ 是受体 $i$ 处的总浓度，计算公式为 $y_i = \\sum_j H_{ij} q_j$。\n\n对于测试用例 F，问题要求检查这种基于矩阵的计算（$Hq_A$）是否与各个源贡献的直接求和（对每个受体 $i$ 求和 $\\sum_j q_{A,j} G(x_{r_i}, t_{r_i}; x_{s_j}, \\tau_j)$）等效。这可以作为所实现的线性原理的数值验证。\n\n数值实现首先通过对每个受体-源对应用推导出的公式来填充矩阵 $H$。然后，对于每个测试用例，将相应的排放向量 $q$ 与 $H$ 相乘以求得结果浓度向量 $y$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef green_function(xr, tr, xs, tau, u, K, lambd):\n    \"\"\"\n    Computes the Green's function for the 1D advection-diffusion-decay equation.\n    This gives the concentration at (xr, tr) from a unit impulse at (xs, tau).\n    \"\"\"\n    delta_t = tr - tau\n    \n    # Enforce causality\n    if delta_t = 0:\n        return 0.0\n\n    delta_x = xr - xs\n    \n    # Denominator of the argument of the exponential\n    denom_exp = 4.0 * K * delta_t\n    \n    # Argument of the exponential\n    arg_exp = -((delta_x - u * delta_t)**2) / denom_exp\n    \n    # Pre-factor (1 / sqrt(4*pi*K*t))\n    prefactor_denom = np.sqrt(4.0 * np.pi * K * delta_t)\n    prefactor = 1.0 / prefactor_denom\n    \n    # Decay factor\n    decay_factor = np.exp(-lambd * delta_t)\n    \n    return prefactor * np.exp(arg_exp) * decay_factor\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem as described.\n    \"\"\"\n    # Numerical and physical setup\n    u = 1.0  # m/s\n    K = 50.0  # m^2/s\n    lambd = 1.0e-3  # s^-1\n\n    # Source positions and emission times\n    source_positions = [0.0, 500.0, 1000.0]  # m\n    emission_times = [0.0, 100.0]  # s\n    \n    # Generate the list of 6 sources, ordered lexicographically\n    sources = []\n    for xs in source_positions:\n        for tau in emission_times:\n            sources.append((xs, tau))\n\n    # Receptor positions and measurement times\n    receptors = [\n        (1500.0, 600.0),   # (m, s)\n        (2000.0, 1200.0),  # (m, s)\n        (300.0, 300.0)     # (m, s)\n    ]\n    \n    num_receptors = len(receptors)\n    num_sources = len(sources)\n    \n    # Construct the footprint matrix H\n    H = np.zeros((num_receptors, num_sources))\n    for i in range(num_receptors):\n        for j in range(num_sources):\n            xr_i, tr_i = receptors[i]\n            xs_j, tau_j = sources[j]\n            H[i, j] = green_function(xr_i, tr_i, xs_j, tau_j, u, K, lambd)\n\n    # Test suite emission vectors\n    q_A = np.array([2.0, 0.5, 1.0, 0.0, 3.0, 0.1])\n    q_B = np.array([0.0, 0.0, 0.0, 0.0, 0.0, 0.0])\n    q_C = np.array([0.0, 1.0, 0.0, 0.0, 0.0, 0.0])\n    q_D = np.array([0.0, 0.0, 0.0, 4.0, 0.0, 0.0])\n    q_E = np.array([0.0, 0.0, 0.0, 0.0, 0.0, 5.0])\n    \n    # Calculate receptor concentration vectors y = Hq\n    y_A = H @ q_A\n    y_B = H @ q_B\n    y_C = H @ q_C\n    y_D = H @ q_D\n    y_E = H @ q_E\n    \n    # Test Case F: Superposition check\n    # Calculate y_A again via direct summation\n    y_A_direct = np.zeros(num_receptors)\n    for i in range(num_receptors):\n        conc_sum = 0.0\n        xr_i, tr_i = receptors[i]\n        for j in range(num_sources):\n            xs_j, tau_j = sources[j]\n            conc_sum += q_A[j] * green_function(xr_i, tr_i, xs_j, tau_j, u, K, lambd)\n        y_A_direct[i] = conc_sum\n        \n    tolerance = 1e-12\n    bool_F = np.allclose(y_A, y_A_direct, rtol=0, atol=tolerance)\n\n    # Compile results into a single list for output\n    final_results = []\n    final_results.extend(list(y_A))\n    final_results.extend(list(y_B))\n    final_results.extend(list(y_C))\n    final_results.extend(list(y_D))\n    final_results.extend(list(y_E))\n    final_results.append(bool_F)\n\n    # Format the final output string as per requirements\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "建立前向模型后，下一步是“反演”本身——从观测中估计源。本练习解决了一个核心挑战：在遵守物理定律的同时解决一个不适定问题。您将通过应用Karush-Kuhn-Tucker (KKT) 条件，推导出一个正则化反演的解析解，该解强制执行了排放的非负性，这是源归因中的一个基本约束。",
            "id": "3886219",
            "problem": "位于源区下风处的单个受体在准稳态下测量污染物浓度。基于质量守恒与输运导出的一阶线性响应，测得的浓度增量被建模为 $y = a x + \\varepsilon$。其中，$y$ 是观测到的受体浓度增量，$x$ 是待推断的未知源排放率，$a  0$ 是由输运和化学过程决定的受体灵敏度，$\\varepsilon$ 是代表未解析过程的零均值随机误差。为了稳定反演过程并在缺少强有力证据时倾向于选择较小的排放量，采用吉洪诺夫（岭）正则化惩罚项。施加具有物理动机的非负约束 $x \\ge 0$，以反映排放量不能为负的物理事实。\n\n请构建此带约束的正则化反演问题：通过最小化一个二次损失函数来估计 $x$，该损失函数包含平方数据失配项和平方正则化项，并受非负约束的限制。从不等式约束凸优化的卡罗需-库恩-塔克（KKT）条件（平稳性、原始可行性、对偶可行性和互补松弛性）的定义出发，推导该问题的KKT最优性条件，并对其进行解析求解，以获得以 $a$、$y$ 和正则化权重 $\\lambda  0$ 表示的唯一最优排放估计值 $x^{\\star}$。请将您的最终答案表示为 $x^{\\star}$ 的单个闭式解析表达式。无需进行数值计算或四舍五入。",
            "solution": "该问题要求通过求解一个带约束的正则化反演问题，来推导源排放率 $x$ 的最优估计。必须通过应用卡罗需-库恩-塔克（KKT）条件来解析地找到解。\n\n首先，我们构建优化问题。目标是基于观测值 $y$ 来估计未知的源排放率 $x$。其关系由线性模型 $y = a x + \\varepsilon$ 给出。我们寻求最小化一个成本函数 $J(x)$，该函数在数据保真度与倾向于较小排放值之间取得平衡，并受物理约束的限制。\n\n成本函数由两项组成：\n$1$. 数据失配项，即观测值 $y$ 与模型预测值 $ax$ 之间差的平方。该项为 $(y - ax)^2$。\n$2$. 吉洪诺夫正则化项，它惩罚解的量级。对于标量变量 $x$，该项为 $x$ 的平方乘以一个正则化权重 $\\lambda  0$。该项为 $\\lambda x^2$。\n\n需要最小化的总成本函数是这两项之和：\n$$J(x) = (y - ax)^2 + \\lambda x^2$$\n\n此外，问题施加了非负约束 $x \\ge 0$，这在物理上是必要的，因为排放率不能为负。\n\n因此，完整的带约束优化问题是：\n$$\\text{minimize} \\quad J(x) = (y - ax)^2 + \\lambda x^2$$\n$$\\text{subject to} \\quad x \\ge 0$$\n\n这是一个凸优化问题，因为目标函数 $J(x)$ 是两个二次函数（因此是凸函数）的和，这使得它在 $a^2+\\lambda  0$ 时是严格凸的，而由于 $\\lambda  0$，这一条件是保证成立的。约束集 $x \\ge 0$ 是一个凸集。因此，存在唯一的全局最小值。\n\n为了解决这个问题，我们使用KKT条件。首先，我们将不等式约束重写为标准形式 $g(x) \\le 0$：\n$$g(x) = -x \\le 0$$\n通过将约束乘以一个拉格朗日乘子（或KKT乘子）$\\mu$ 并加到目标函数中，来构造拉格朗日函数 $\\mathcal{L}(x, \\mu)$：\n$$\\mathcal{L}(x, \\mu) = J(x) + \\mu g(x) = (y - ax)^2 + \\lambda x^2 - \\mu x$$\n\n在点 $x^{\\star}$ 处的最优性KKT条件是：\n$1$. **平稳性**：拉格朗日函数关于 $x$ 的梯度在最优点 $x^{\\star}$ 处必须为零。\n$$\\nabla_x \\mathcal{L}(x^{\\star}, \\mu) = \\frac{d}{dx} \\left[ (y - ax)^2 + \\lambda x^2 - \\mu x \\right] \\bigg|_{x=x^{\\star}} = 0$$\n$2$. **原始可行性**：解 $x^{\\star}$ 必须满足原始约束。\n$$x^{\\star} \\ge 0$$\n$3$. **对偶可行性**：拉格朗日乘子 $\\mu$ 必须是非负的。\n$$\\mu \\ge 0$$\n$4$. **互补松弛性**：在解处，拉格朗日乘子与约束函数的乘积必须为零。\n$$\\mu x^{\\star} = 0$$\n\n我们现在求解这个条件系统。首先，我们为平稳性条件计算导数：\n$$\\frac{d\\mathcal{L}}{dx} = 2(y - ax)(-a) + 2\\lambda x - \\mu = 2(a^2 + \\lambda)x - 2ay - \\mu$$\n将导数设为零，得到平稳性方程：\n$$2(a^2 + \\lambda)x^{\\star} - 2ay - \\mu = 0$$\n$$x^{\\star} = \\frac{2ay + \\mu}{2(a^2 + \\lambda)} = \\frac{ay + \\mu/2}{a^2 + \\lambda}$$\n\n互补松弛性条件 $\\mu x^{\\star} = 0$ 意味着要么 $\\mu = 0$ 要么 $x^{\\star} = 0$。这为分情况讨论提供了基础。\n\n**情况1：约束非激活 ($x^{\\star}  0$)。**\n如果 $x^{\\star}  0$，互补松弛性条件要求 $\\mu = 0$。我们将 $\\mu = 0$ 代入 $x^{\\star}$ 的平稳性方程中：\n$$x^{\\star} = \\frac{ay}{a^2 + \\lambda}$$\n为使该解有效，它必须与本情况的假设一致，即 $x^{\\star}  0$。因为给定 $a  0$ 和 $\\lambda  0$，分母 $a^2 + \\lambda$ 总是正的。因此，$x^{\\star}$ 的符号由 $y$ 的符号决定。当且仅当 $ay  0$ 时，$x^{\\star}  0$ 的条件成立，这可简化为 $y  0$。对偶可行性条件 $\\mu \\ge 0$ 也得到满足，因为 $\\mu = 0$。\n因此，如果 $y  0$，最优解是 $x^{\\star} = \\frac{ay}{a^2 + \\lambda}$。\n\n**情况2：约束激活 ($x^{\\star} = 0$)。**\n如果最优解是 $x^{\\star}=0$，则原始可行性条件 $x^{\\star} \\ge 0$ 得到满足。我们现在必须检查是否存在一个拉格朗日乘子 $\\mu \\ge 0$（对偶可行性），它能满足平稳性和互补松弛性条件。\n将 $x^{\\star} = 0$ 代入平稳性方程：\n$$2(a^2 + \\lambda)(0) - 2ay - \\mu = 0$$\n$$\\mu = -2ay$$\n对偶可行性条件要求 $\\mu \\ge 0$。因此，我们必须有：\n$$-2ay \\ge 0$$\n由于 $a  0$，这个不等式简化为 $-y \\ge 0$，即 $y \\le 0$。\n因此，如果 $y \\le 0$，最优解是 $x^{\\star} = 0$，并且该解是KKT最优的，其有效的拉格朗日乘子为 $\\mu = -2ay \\ge 0$。\n\n结合两种情况的结果，我们可以将最优解 $x^{\\star}$ 表示为关于 $y$ 的分段函数：\n$$x^{\\star} = \\begin{cases} \\frac{ay}{a^2+\\lambda}   \\text{if } y  0 \\\\ 0   \\text{if } y \\le 0 \\end{cases}$$\n\n这个分段表达式可以使用最大值函数更紧凑地写出。注意到，如果 $y  0$，则 $\\frac{ay}{a^2+\\lambda}  0$；如果 $y \\le 0$，则 $\\frac{ay}{a^2+\\lambda} \\le 0$。因此，解是无约束解 $\\frac{ay}{a^2+\\lambda}$ 的正部。\n这等价于：\n$$x^{\\star} = \\max\\left(0, \\frac{ay}{a^2+\\lambda}\\right)$$\n这个单一的闭式表达式代表了从带约束的正则化反演中推导出的唯一的、最优的、非负的排放估计值。",
            "answer": "$$\\boxed{\\max\\left(0, \\frac{ay}{a^2+\\lambda}\\right)}$$"
        },
        {
            "introduction": "一次成功的反演不仅需要估计源，还需要真实地量化其不确定性，这取决于对所有误差源的正确表征。本练习处理了“代表性误差”这个微妙但至关重要的概念，该误差源于粗糙模型未能捕捉到精细尺度的现实。您将学习如何推导和量化这种误差，这是构建稳健且可信的观测误差协方差矩阵的关键一步。",
            "id": "3886202",
            "problem": "在环境与地球系统建模中的反演建模和源归因问题中，考虑一个单一的原位接收器，它测量对示踪剂次网格排放的线性响应。该域由一个模型网格单元组成，该单元被细分为 $N = 4$ 个次网格斑块，由 $i \\in \\{1,2,3,4\\}$ 索引。设次网格排放场由随机向量 $\\mathbf{x} = (x_1, x_2, x_3, x_4)^{\\top}$ 表示，该向量在次网格尺度上相对于网格单元均值具有零均值异常。接收器的测量值由线性映射 $y = \\sum_{i=1}^{N} w_i x_i + \\epsilon$ 建模，其中 $\\mathbf{w} = (w_1, w_2, w_3, w_4)^{\\top}$ 是固定的传输权重（一个足迹），$\\epsilon$ 是一个方差为 $R$ 的零均值仪器误差。大气模型通过其网格平均状态 $\\bar{x} = \\frac{1}{N} \\sum_{i=1}^{N} x_i$ 来表示该网格单元，并将其映射到一个模拟观测值 $\\hat{y} = \\left(\\sum_{i=1}^{N} w_i\\right) \\bar{x}$，从而忽略了次网格变率。\n\n仅从线性观测映射、网格平均和线性组合方差的定义出发，完成以下任务：\n1) 解释在此情景下代表性误差如何由次网格变率产生，并将代表性误差 $\\delta$ 定义为应用于 $\\mathbf{x}$ 的真实观测算子与模型的网格平均映射之间的不匹配。\n2) 根据次网格协方差矩阵 $\\Sigma = \\mathrm{Cov}(\\mathbf{x})$ 和权重 $\\mathbf{w}$，推导代表性误差方差 $R_{\\mathrm{rep}}$ 的公式。利用该公式得到增广观测误差协方差 $R' = R + R_{\\mathrm{rep}}$。\n3) 考虑一个科学上合理的情况，取 $\\mathbf{w} = (0.4, 0.3, 0.2, 0.1)^{\\top}$，仪器误差方差 $R = 2.25$，以及一个平稳的次网格协方差结构 $\\Sigma_{ij} = \\sigma^2 \\rho^{|i-j|}$，其中 $\\sigma^2 = 25$ 且 $\\rho = 0.5$。计算增广观测误差方差 $R'$ 的精确数值。将最终的 $R'$ 以 $(\\mathrm{ppb})^2$ 为单位表示。不要对最终数字进行四舍五入。",
            "solution": "该问题被验证为具有科学依据、适定且自洽。它阐述了环境数据同化中的一个基本概念，即代表性误差。我们可以开始解答。\n\n解答按照问题陈述的要求分为三个部分。\n\n1) **代表性误差的定义与解释**\n\n在环境建模的背景下，代表性误差源于物理现实的空间或时间分辨率与计算模型的分辨率之间的差异。在这里，“真实”状态由次网格排放场 $\\mathbf{x} = (x_1, x_2, x_3, x_4)^{\\top}$ 描述，它在单个模型网格单元内具有变率。真实观测算子将高分辨率状态映射到一个无噪声的测量值，它是一个由下式给出的线性组合：\n$$ H(\\mathbf{x}) = \\sum_{i=1}^{N} w_i x_i = \\mathbf{w}^{\\top}\\mathbf{x} $$\n其中 $\\mathbf{w}$ 是传输权重向量，也称为足迹。\n\n然而，大气模型的分辨率太粗，无法分辨这种次网格变率。它作用于网格平均状态 $\\bar{x}$，定义为：\n$$ \\bar{x} = \\frac{1}{N} \\sum_{i=1}^{N} x_i $$\n模型的观测算子 $\\hat{H}$ 将这个粗糙的网格平均状态映射到一个模拟观测值。问题陈述该映射为 $\\hat{y} = \\left(\\sum_{i=1}^{N} w_i\\right) \\bar{x}$。因此，应用于真实状态 $\\mathbf{x}$ 的模型观测算子包括首先对 $\\mathbf{x}$ 求平均得到 $\\bar{x}$，然后应用粗糙映射：\n$$ \\hat{H}(\\mathbf{x}) = \\left(\\sum_{j=1}^{N} w_j\\right) \\left(\\frac{1}{N} \\sum_{k=1}^{N} x_k\\right) $$\n代表性误差 $\\delta$ 定义为当真实观测算子和模型的网格平均映射都应用于真实的次网格状态 $\\mathbf{x}$ 时，两者之间的不匹配：\n$$ \\delta \\equiv H(\\mathbf{x}) - \\hat{H}(\\mathbf{x}) = \\sum_{i=1}^{N} w_i x_i - \\left(\\sum_{j=1}^{N} w_j\\right) \\left(\\frac{1}{N} \\sum_{k=1}^{N} x_k\\right) $$\n这个误差 $\\delta$ 量化了由排放 $\\mathbf{x}$ 和传输权重 $\\mathbf{w}$ 之间的次网格尺度相关性所产生的那部分观测信号，当模型对排放进行预先平均时，这部分信号会丢失。\n\n2) **代表性误差方差和增广误差协方差的推导**\n\n为了推导代表性误差方差 $R_{\\mathrm{rep}} = \\mathrm{Var}(\\delta)$，我们首先计算 $\\delta$ 的期望。排放场 $\\mathbf{x}$ 被给定为零均值异常，所以其期望为 $\\mathrm{E}[\\mathbf{x}] = \\mathbf{0}$。\n$$ \\mathrm{E}[\\delta] = \\mathrm{E}\\left[ \\sum_{i=1}^{N} w_i x_i - \\left(\\sum_{j=1}^{N} w_j\\right) \\left(\\frac{1}{N} \\sum_{k=1}^{N} x_k\\right) \\right] $$\n根据期望的线性性质：\n$$ \\mathrm{E}[\\delta] = \\sum_{i=1}^{N} w_i \\mathrm{E}[x_i] - \\left(\\frac{1}{N} \\sum_{j=1}^{N} w_j\\right) \\left(\\sum_{k=1}^{N} \\mathrm{E}[x_k]\\right) = 0 - 0 = 0 $$\n由于 $\\delta$ 的均值为零，其方差是其平方的期望，即 $R_{\\mathrm{rep}} = \\mathrm{E}[\\delta^2]$。我们可以使用向量表示法更紧凑地表示 $\\delta$。设 $\\mathbf{1}$ 是一个包含 $N$ 个 1 的列向量。那么 $\\bar{x} = \\frac{1}{N}\\mathbf{1}^{\\top}\\mathbf{x}$ 且 $\\sum_i w_i = \\mathbf{w}^{\\top}\\mathbf{1}$。\n$$ \\delta = \\mathbf{w}^{\\top}\\mathbf{x} - (\\mathbf{w}^{\\top}\\mathbf{1})\\left(\\frac{1}{N}\\mathbf{1}^{\\top}\\mathbf{x}\\right) = \\left(\\mathbf{w}^{\\top} - \\frac{\\mathbf{w}^{\\top}\\mathbf{1}}{N}\\mathbf{1}^{\\top}\\right)\\mathbf{x} $$\n我们定义一个调整后的权重向量 $\\mathbf{w}'^{\\top} = \\mathbf{w}^{\\top} - \\frac{\\mathbf{w}^{\\top}\\mathbf{1}}{N}\\mathbf{1}^{\\top}$。那么 $\\delta = \\mathbf{w}'^{\\top}\\mathbf{x}$。其方差为：\n$$ R_{\\mathrm{rep}} = \\mathrm{Var}(\\delta) = \\mathrm{Var}(\\mathbf{w}'^{\\top}\\mathbf{x}) = \\mathrm{E}[(\\mathbf{w}'^{\\top}\\mathbf{x})(\\mathbf{w}'^{\\top}\\mathbf{x})^{\\top}] $$\n使用标量 $s$ 具有 $s = s^{\\top}$ 的性质：\n$$ R_{\\mathrm{rep}} = \\mathrm{E}[(\\mathbf{w}'^{\\top}\\mathbf{x})(\\mathbf{x}^{\\top}\\mathbf{w}')] = \\mathbf{w}'^{\\top}\\mathrm{E}[\\mathbf{x}\\mathbf{x}^{\\top}]\\mathbf{w}' $$\n由于 $\\mathrm{E}[\\mathbf{x}] = \\mathbf{0}$，$\\mathbf{x}$ 的协方差矩阵为 $\\Sigma = \\mathrm{E}[\\mathbf{x}\\mathbf{x}^{\\top}]$。因此，代表性误差方差为：\n$$ R_{\\mathrm{rep}} = \\mathbf{w}'^{\\top} \\Sigma \\mathbf{w}' = \\left(\\mathbf{w} - \\frac{\\mathbf{w}^{\\top}\\mathbf{1}}{N}\\mathbf{1}\\right)^{\\top} \\Sigma \\left(\\mathbf{w} - \\frac{\\mathbf{w}^{\\top}\\mathbf{1}}{N}\\mathbf{1}\\right) $$\n观测同化系统中的总误差是实际测量值 $y$ 与模拟预测值 $\\hat{y}$ 之间的差异。这个总误差为：\n$$ y - \\hat{y} = (\\mathbf{w}^{\\top}\\mathbf{x} + \\epsilon) - (\\mathbf{w}^{\\top}\\mathbf{1})\\bar{x} = (\\mathbf{w}^{\\top}\\mathbf{x} - (\\mathbf{w}^{\\top}\\mathbf{1})\\bar{x}) + \\epsilon = \\delta + \\epsilon $$\n这个总误差的方差就是增广观测误差方差 $R'$。假设仪器误差 $\\epsilon$ 与状态 $\\mathbf{x}$（因此也与 $\\delta$）不相关，那么和的方差等于方差的和：\n$$ R' = \\mathrm{Var}(\\delta + \\epsilon) = \\mathrm{Var}(\\delta) + \\mathrm{Var}(\\epsilon) = R_{\\mathrm{rep}} + R $$\n这就得到了增广观测误差方差 $R' = R + R_{\\mathrm{rep}}$。\n\n3) **增广观测误差方差的数值计算**\n\n给定以下数值：$N=4$，$R = 2.25$，$\\mathbf{w} = (0.4, 0.3, 0.2, 0.1)^{\\top}$，以及 $\\Sigma_{ij} = \\sigma^2 \\rho^{|i-j|}$，其中 $\\sigma^2 = 25$ 且 $\\rho = 0.5$。\n\n首先，我们计算调整后的权重向量 $\\mathbf{w}'$。我们需要权重的总和：\n$$ \\sum_{i=1}^{4} w_i = 0.4 + 0.3 + 0.2 + 0.1 = 1.0 $$\n权重的平均值为 $\\frac{1}{N}\\sum_i w_i = \\frac{1.0}{4} = 0.25$。\n$$ \\mathbf{w}' = \\mathbf{w} - 0.25 \\cdot \\mathbf{1} = \\begin{pmatrix} 0.4 \\\\ 0.3 \\\\ 0.2 \\\\ 0.1 \\end{pmatrix} - \\begin{pmatrix} 0.25 \\\\ 0.25 \\\\ 0.25 \\\\ 0.25 \\end{pmatrix} = \\begin{pmatrix} 0.15 \\\\ 0.05 \\\\ -0.05 \\\\ -0.15 \\end{pmatrix} $$\n接下来，我们构造次网格协方差矩阵 $\\Sigma$，其元素为 $\\Sigma_{ij} = 25 \\cdot (0.5)^{|i-j|}$:\n$$ \\Sigma = 25 \\begin{pmatrix}\n(0.5)^0   (0.5)^1   (0.5)^2   (0.5)^3 \\\\\n(0.5)^1   (0.5)^0   (0.5)^1   (0.5)^2 \\\\\n(0.5)^2   (0.5)^1   (0.5)^0   (0.5)^1 \\\\\n(0.5)^3   (0.5)^2   (0.5)^1   (0.5)^0\n\\end{pmatrix} = \\begin{pmatrix}\n25.0   12.5   6.25   3.125 \\\\\n12.5   25.0   12.5   6.25 \\\\\n6.25   12.5   25.0   12.5 \\\\\n3.125   6.25   12.5   25.0\n\\end{pmatrix} $$\n现在我们计算代表性误差方差 $R_{\\mathrm{rep}} = \\mathbf{w}'^{\\top} \\Sigma \\mathbf{w}'$。首先，我们计算向量-矩阵乘积 $\\mathbf{v}^{\\top} = \\mathbf{w}'^{\\top} \\Sigma$：\n$$ \\mathbf{w}'^{\\top} \\Sigma = \\begin{pmatrix} 0.15   0.05   -0.05   -0.15 \\end{pmatrix} \\begin{pmatrix}\n25.0   12.5   6.25   3.125 \\\\\n12.5   25.0   12.5   6.25 \\\\\n6.25   12.5   25.0   12.5 \\\\\n3.125   6.25   12.5   25.0\n\\end{pmatrix} $$\n得到的行向量为 $\\mathbf{v}^{\\top} = (v_1, v_2, v_3, v_4)$：\n$v_1 = 0.15(25) + 0.05(12.5) - 0.05(6.25) - 0.15(3.125) = 3.75 + 0.625 - 0.3125 - 0.46875 = 3.59375$\n$v_2 = 0.15(12.5) + 0.05(25) - 0.05(12.5) - 0.15(6.25) = 1.875 + 1.25 - 0.625 - 0.9375 = 1.5625$\n$v_3 = 0.15(6.25) + 0.05(12.5) - 0.05(25) - 0.15(12.5) = 0.9375 + 0.625 - 1.25 - 1.875 = -1.5625$\n$v_4 = 0.15(3.125) + 0.05(6.25) - 0.05(12.5) - 0.15(25) = 0.46875 + 0.3125 - 0.625 - 3.75 = -3.59375$\n所以，$\\mathbf{v}^{\\top} = \\begin{pmatrix} 3.59375   1.5625   -1.5625   -3.59375 \\end{pmatrix}$。\n现在我们计算最终的点积 $R_{\\mathrm{rep}} = \\mathbf{v}^{\\top} \\mathbf{w}'$:\n$$ R_{\\mathrm{rep}} = 3.59375(0.15) + 1.5625(0.05) + (-1.5625)(-0.05) + (-3.59375)(-0.15) $$\n$$ R_{\\mathrm{rep}} = 0.5390625 + 0.078125 + 0.078125 + 0.5390625 = 2 \\times (0.5390625 + 0.078125) = 2 \\times 0.6171875 = 1.234375 $$\n最后，我们计算增广观测误差方差 $R'$：\n$$ R' = R + R_{\\mathrm{rep}} = 2.25 + 1.234375 = 3.484375 $$\n方差的单位是测量量单位的平方。由于最终答案要求以 $(\\mathrm{ppb})^2$ 为单位，所以数值为 $3.484375$。",
            "answer": "$$ \\boxed{3.484375} $$"
        }
    ]
}