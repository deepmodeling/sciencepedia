{
    "hands_on_practices": [
        {
            "introduction": "在我们从观测数据反演排放源之前，我们必须首先理解正向问题：排放物如何转化为可测量的浓度？本练习将指导您从头开始构建源-受体关系，即“足迹”矩阵，从大气传输的基本物理原理出发。通过推导和实现一个传输方程的格林函数，您将了解到复杂的动态过程如何被提炼成一个线性算子，而这正是反演建模的基石。",
            "id": "3886147",
            "problem": "考虑一个由典范常系数偏微分方程 (PDE) 控制的沿水平坐标的一维标量浓度线性输运问题。标量浓度表示为 $c(x,t)$，风速为 $u$ (单位 $\\mathrm{m/s}$)，扩散系数为 $K$ (单位 $\\mathrm{m^2/s}$)，一阶衰减率为 $\\lambda$ (单位 $\\mathrm{s^{-1}}$)。一个源项 $s(x,t)$ 在指定的坐标和时间瞬时注入质量。假设该线在横向和纵向上是积分的，使得浓度 $c(x,t)$ 的单位为 $\\mathrm{kg/m}$。\n\n您的任务是推导、实现并使用该 PDE 的格林函数 (GF) 来构建一个受体-源敏感性矩阵 $H$（通常称为足迹矩阵）。矩阵 $H$ 通过线性叠加，将一组位于指定源位置和排放时间的离散单位脉冲排放（每个质量单位为 $\\mathrm{kg}$）映射到指定受体位置和受体时间的浓度。具体来说：\n\n1. 从带有源项的线性平流-扩散-衰减 PDE 出发，\n   $$\n   \\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = K \\frac{\\partial^2 c}{\\partial x^2} - \\lambda c + s(x,t),\n   $$\n   其中所有变量和参数的定义如上所述。您必须使用此 PDE 作为基本基础，推导在位置 $x_s$ 和时间 $\\tau$ 释放的瞬时单位质量脉冲的格林函数 $G(\\xi,\\tau)$，然后使用线性叠加将受体浓度表示为 $H$ 和排放向量 $q$ 的形式。\n\n2. 构建足迹矩阵 $H$，其元素 $H_{ij}$ 等于由单位脉冲排放 $j$ 引起的受体 $i$ 处的浓度响应。每次排放 $j$ 由其源位置 $x_{s_j}$ 和排放时间 $\\tau_j$ 表征，每个受体 $i$ 由其位置 $x_{r_i}$ 和测量时间 $t_{r_i}$ 表征。必须强制执行因果关系，使得对于 $t_{r_i} \\le \\tau_j$，有 $H_{ij} = 0$。\n\n3. 使用推导出的表达式数值计算 $H$，然后通过\n   $$\n   y = H q,\n   $$\n   计算排放质量向量 $q$ 对应的受体浓度向量 $y$，单位为 $\\mathrm{kg/m}$。\n\n数值和物理设置：\n- 风速：$u = 1.0$ $\\mathrm{m/s}$。\n- 扩散系数：$K = 50.0$ $\\mathrm{m^2/s}$。\n- 一阶衰减率：$\\lambda = 1.0 \\times 10^{-3}$ $\\mathrm{s^{-1}}$。\n- 源位置：$x_s \\in \\{0.0, 500.0, 1000.0\\}$ $\\mathrm{m}$。\n- 排放时间：$\\tau \\in \\{0.0, 100.0\\}$ $\\mathrm{s}$。\n- 受体：$(x_r,t_r) \\in \\{(1500.0, 600.0), (2000.0, 1200.0), (300.0, 300.0)\\}$，其中 $x_r$ 单位为 $\\mathrm{m}$，$t_r$ 单位为 $\\mathrm{s}$。\n- 通过对 $3$ 个源位置和 $2$ 个排放时间进行笛卡尔积，形成 $6$ 个单位排放脉冲，按源位置然后按时间进行字典排序。\n\n测试套件：\n- 测试用例 A（一般情况）：$q_A = [2.0, 0.5, 1.0, 0.0, 3.0, 0.1]$，单位 $\\mathrm{kg}$。\n- 测试用例 B（零排放）：$q_B = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]$，单位 $\\mathrm{kg}$。\n- 测试用例 C（单个早期脉冲）：$q_C = [0.0, 1.0, 0.0, 0.0, 0.0, 0.0]$，单位 $\\mathrm{kg}$。\n- 测试用例 D（上游源的单个较晚脉冲）：$q_D = [0.0, 0.0, 0.0, 4.0, 0.0, 0.0]$，单位 $\\mathrm{kg}$。\n- 测试用例 E（远处源的单个较晚脉冲）：$q_E = [0.0, 0.0, 0.0, 0.0, 0.0, 5.0]$，单位 $\\mathrm{kg}$。\n- 测试用例 F（叠加检验）：评估基于叠加的 $H q_A$ 是否在 $10^{-12}$ 的容差内等于 $q_A$ 的格林函数响应的直接求和；输出应为布尔值。\n\n要求的输出和单位：\n- 对于测试用例 A-E，以浮点数形式输出最终的受体浓度向量 $y$，单位为 $\\mathrm{kg/m}$。\n- 对于测试用例 F，输出一个布尔值，指示两次计算是否在规定容差内一致。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试结果，形式为方括号括起来的逗号分隔列表。按 $[y_A, y_B, y_C, y_D, y_E, \\text{bool}_F]$ 的顺序排列结果，其中每个 $y_\\cdot$ 展开为其三个受体条目（按上述受体顺序）。例如，输出应具有以下形式\n  $$\n  [y_{A,1}, y_{A,2}, y_{A,3}, y_{B,1}, y_{B,2}, y_{B,3}, y_{C,1}, y_{C,2}, y_{C,3}, y_{D,1}, y_{D,2}, y_{D,3}, y_{E,1}, y_{E,2}, y_{E,3}, \\text{bool}_F],\n  $$\n  其中每个 $y_{\\cdot,i}$ 是一个单位为 $\\mathrm{kg/m}$ 的浮点数，$\\text{bool}_F$ 是一个布尔值。角度不会出现；如果内部使用任何三角函数，角度必须以弧度为单位。不应打印百分比。",
            "solution": "该问题是有效的，因为它在科学上基于输运物理学原理，是良定的、客观且自洽的。所有必要的参数和条件都已提供，并且没有内部矛盾。\n\n解题过程首先推导控制性偏微分方程 (PDE) 的格林函数，然后使用此函数构建源-受体敏感性矩阵 $H$，最后应用此矩阵计算各种排放情景下的受体浓度。\n\n控制性一维线性平流-扩散-衰减 PDE 由下式给出：\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = K \\frac{\\partial^2 c}{\\partial x^2} - \\lambda c + s(x,t)\n$$\n其中 $c(x,t)$ 是浓度 (单位 $\\mathrm{kg/m}$)，$u$ 是恒定风速，$K$ 是恒定扩散系数，$\\lambda$ 是一阶衰减率，$s(x,t)$ 是源项。\n\n格林函数 $G(x,t; x_s, \\tau)$ 代表由单位质量的瞬时点源产生的浓度场，即 $s(x,t) = \\delta(x-x_s)\\delta(t-\\tau)$，其中 $\\delta(\\cdot)$ 是狄拉克δ函数。因此，$G$ 是以下方程的解：\n$$\n\\frac{\\partial G}{\\partial t} + u \\frac{\\partial G}{\\partial x} = K \\frac{\\partial^2 G}{\\partial x^2} - \\lambda G + \\delta(x-x_s)\\delta(t-\\tau)\n$$\n初始条件为 $G(x, t; x_s, \\tau) = 0$ (当 $t \\le \\tau$)。\n\n为求解此 PDE，我们采用一系列变换。\n\n首先，为处理衰减项，我们引入一个新变量 $c'(x,t)$，通过变换 $c(x,t) = c'(x,t) e^{-\\lambda t}$ 定义。将其代入 PDE 的齐次版本中，可以发现如果 $c'$ 满足平流-扩散方程，则衰减项被消除。对于格林函数，一个更直接的方法是意识到衰减作用于过程开始于时间 $\\tau$ 后的持续时间 $\\Delta t = t-\\tau$。因此，解可以写成平流-扩散方程的解乘以一个衰减因子 $e^{-\\lambda(t-\\tau)}$。\n\n平流-扩散方程为：\n$$\n\\frac{\\partial c'}{\\partial t} + u \\frac{\\partial c'}{\\partial x} = K \\frac{\\partial^2 c'}{\\partial x^2}\n$$\n该方程的解是通过变换到随平均流移动的坐标系来找到的。令 $x' = x - u(t-\\tau)$ 为一个以速度 $u$ 移动的参考系中的坐标，该参考系在时间 $\\tau$ 时其原点位于源位置 $x_s$。在此参考系中，对于在 $x' = 0$ 处释放的物质，PDE 简化为纯扩散（或热）方程：\n$$\n\\frac{\\partial c'}{\\partial t} = K \\frac{\\partial^2 c'}{( \\partial x')^2}\n$$\n对于在时间 $\\tau$ 于 $x'=0$ 处释放的单位质量，在 $t > \\tau$ 时移动参考系中的解是一个高斯分布：\n$$\nc'(x', t) = \\frac{1}{\\sqrt{4 \\pi K (t-\\tau)}} \\exp\\left(-\\frac{(x')^2}{4 K (t-\\tau)}\\right)\n$$\n通过代入 $x' = x - x_s - u(t-\\tau)$，变换回原始空间坐标 $x$：\n$$\nG_{AD}(x,t; x_s, \\tau) = \\frac{1}{\\sqrt{4 \\pi K (t-\\tau)}} \\exp\\left(-\\frac{(x - x_s - u(t-\\tau))^2}{4 K (t-\\tau)}\\right)\n$$\n这是平流-扩散方程的格林函数。\n\n最后，重新引入衰减因子 $e^{-\\lambda(t-\\tau)}$，得到原始 PDE 的完整格林函数。因果关系要求在排放前的任何时间浓度都为零，因此我们定义：\n$$\nG(x, t; x_s, \\tau) =\n\\begin{cases}\n    \\frac{1}{\\sqrt{4 \\pi K (t-\\tau)}} \\exp\\left(-\\frac{(x - x_s - u(t-\\tau))^2}{4 K (t-\\tau)}\\right) e^{-\\lambda(t-\\tau)}  \\text{如果 } t > \\tau \\\\\n    0  \\text{如果 } t \\le \\tau\n\\end{cases}\n$$\n\n足迹矩阵 $H$ 的构建方式使其元素 $H_{ij}$ 是受体 $i$ （在位置 $x_{r_i}$ 和时间 $t_{r_i}$）处由源 $j$ （在位置 $x_{s_j}$ 和时间 $\\tau_j$）的单位脉冲排放引起的浓度。根据定义，这由格林函数给出：\n$$\nH_{ij} = G(x_{r_i}, t_{r_i}; x_{s_j}, \\tau_j)\n$$\n令 $\\Delta t_{ij} = t_{r_i} - \\tau_j$ 和 $\\Delta x_{ij} = x_{r_i} - x_{s_j}$，则 $H_{ij}$ 的表达式（对于 $\\Delta t_{ij} > 0$）为：\n$$\nH_{ij} = \\frac{1}{\\sqrt{4 \\pi K \\Delta t_{ij}}} \\exp\\left(-\\frac{(\\Delta x_{ij} - u \\Delta t_{ij})^2}{4 K \\Delta t_{ij}}\\right) e^{-\\lambda \\Delta t_{ij}}\n$$\n问题指定了3个受体和6个源事件，从而得到一个 $3 \\times 6$ 的矩阵 $H$。源事件是位置 $\\{0.0, 500.0, 1000.0\\}$ $\\mathrm{m}$ 和时间 $\\{0.0, 100.0\\}$ $\\mathrm{s}$ 的笛卡尔积，按字典序排列。受体按给定顺序排列。\n\n一旦计算出 $H$，对于任意排放质量向量 $q$，受体浓度向量 $y$ 可通过线性叠加获得，这表示为矩阵-向量乘积：\n$$\ny = Hq\n$$\n向量 $y$ 的每个元素 $y_i$ 是受体 $i$ 处的总浓度，计算公式为 $y_i = \\sum_j H_{ij} q_j$。\n\n对于测试用例 F，问题要求检验这种基于矩阵的计算 ($Hq_A$) 与各个源贡献的直接求和（即对每个受体 $i$ 计算 $\\sum_j q_{A,j} G(x_{r_i}, t_{r_i}; x_{s_j}, \\tau_j)$）是否等效。这可以作为对已实现线性原理的数值验证。\n\n数值实现首先包括通过对每个受体-源对应用推导出的公式来填充矩阵 $H$。然后，对于每个测试用例，将相应的排放向量 $q$ 与 $H$ 相乘，以找到最终的浓度向量 $y$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef green_function(xr, tr, xs, tau, u, K, lambd):\n    \"\"\"\n    Computes the Green's function for the 1D advection-diffusion-decay equation.\n    This gives the concentration at (xr, tr) from a unit impulse at (xs, tau).\n    \"\"\"\n    delta_t = tr - tau\n    \n    # Enforce causality\n    if delta_t = 0:\n        return 0.0\n\n    delta_x = xr - xs\n    \n    # Denominator of the argument of the exponential\n    denom_exp = 4.0 * K * delta_t\n    \n    # Argument of the exponential\n    arg_exp = -((delta_x - u * delta_t)**2) / denom_exp\n    \n    # Pre-factor (1 / sqrt(4*pi*K*t))\n    prefactor_denom = np.sqrt(4.0 * np.pi * K * delta_t)\n    prefactor = 1.0 / prefactor_denom\n    \n    # Decay factor\n    decay_factor = np.exp(-lambd * delta_t)\n    \n    return prefactor * np.exp(arg_exp) * decay_factor\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem as described.\n    \"\"\"\n    # Numerical and physical setup\n    u = 1.0  # m/s\n    K = 50.0  # m^2/s\n    lambd = 1.0e-3  # s^-1\n\n    # Source positions and emission times\n    source_positions = [0.0, 500.0, 1000.0]  # m\n    emission_times = [0.0, 100.0]  # s\n    \n    # Generate the list of 6 sources, ordered lexicographically\n    sources = []\n    for xs in source_positions:\n        for tau in emission_times:\n            sources.append((xs, tau))\n\n    # Receptor positions and measurement times\n    receptors = [\n        (1500.0, 600.0),   # (m, s)\n        (2000.0, 1200.0),  # (m, s)\n        (300.0, 300.0)     # (m, s)\n    ]\n    \n    num_receptors = len(receptors)\n    num_sources = len(sources)\n    \n    # Construct the footprint matrix H\n    H = np.zeros((num_receptors, num_sources))\n    for i in range(num_receptors):\n        for j in range(num_sources):\n            xr_i, tr_i = receptors[i]\n            xs_j, tau_j = sources[j]\n            H[i, j] = green_function(xr_i, tr_i, xs_j, tau_j, u, K, lambd)\n\n    # Test suite emission vectors\n    q_A = np.array([2.0, 0.5, 1.0, 0.0, 3.0, 0.1])\n    q_B = np.array([0.0, 0.0, 0.0, 0.0, 0.0, 0.0])\n    q_C = np.array([0.0, 1.0, 0.0, 0.0, 0.0, 0.0])\n    q_D = np.array([0.0, 0.0, 0.0, 4.0, 0.0, 0.0])\n    q_E = np.array([0.0, 0.0, 0.0, 0.0, 0.0, 5.0])\n    \n    # Calculate receptor concentration vectors y = Hq\n    y_A = H @ q_A\n    y_B = H @ q_B\n    y_C = H @ q_C\n    y_D = H @ q_D\n    y_E = H @ q_E\n    \n    # Test Case F: Superposition check\n    # Calculate y_A again via direct summation\n    y_A_direct = np.zeros(num_receptors)\n    for i in range(num_receptors):\n        conc_sum = 0.0\n        xr_i, tr_i = receptors[i]\n        for j in range(num_sources):\n            xs_j, tau_j = sources[j]\n            conc_sum += q_A[j] * green_function(xr_i, tr_i, xs_j, tau_j, u, K, lambd)\n        y_A_direct[i] = conc_sum\n        \n    tolerance = 1e-12\n    bool_F = np.allclose(y_A, y_A_direct, rtol=0, atol=tolerance)\n\n    # Compile results into a single list for output\n    final_results = []\n    final_results.extend(list(y_A))\n    final_results.extend(list(y_B))\n    final_results.extend(list(y_C))\n    final_results.extend(list(y_D))\n    final_results.extend(list(y_E))\n    final_results.append(bool_F)\n\n    # Format the final output string as per requirements\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "建立了正向模型之后，我们现在转向反演问题，即估算排放源。现实世界的反演问题通常是“不适定”的，需要通过正则化来找到稳定解，并且必须遵守物理定律，例如排放的非负性。本实践将演示如何使用强大的Karush-Kuhn-Tucker (KKT) 条件来构建并求解一个带约束的反演问题，从而得到一个物理上真实且数学上严谨的排放估算值。",
            "id": "3886219",
            "problem": "位于源区下风向的单个受体在准稳态下测量污染物浓度。基于质量守恒和输运导出的一阶线性响应，测得的浓度增量被建模为 $y = a x + \\varepsilon$。其中，$y$ 是观测到的受体浓度增量，$x$ 是待推断的未知源排放率，$a  0$ 是由输运和化学过程决定的受体灵敏度，$\\varepsilon$ 是代表未解析过程的零均值随机误差。为了稳定反演过程，并在缺乏强有力证据时倾向于选择较小的排放量，我们采用 Tikhonov（岭）正则化惩罚项。施加具有物理意义的非负约束 $x \\ge 0$，以反映排放量不能为负的物理事实。\n\n构建一个带约束的正则化反演问题，通过最小化一个包含平方数据失配项和平方正则化项的二次损失函数来估计 $x$，并受非负约束条件的限制。从不等式约束凸优化的 Karush–Kuhn–Tucker (KKT) 条件（平稳性、原始可行性、对偶可行性和互补松弛性）的定义出发，推导此问题的 KKT 最优性条件，并对其进行解析求解，以获得以 $a$、$y$ 和正则化权重 $\\lambda  0$ 表示的唯一最优排放估计值 $x^{\\star}$。将最终答案表示为 $x^{\\star}$ 的单个闭式解析表达式。不需要进行数值计算或取整。",
            "solution": "该问题要求通过求解一个带约束的正则化反演问题，来推导源排放率 $x$ 的最优估计。必须通过应用 Karush–Kuhn–Tucker (KKT) 条件来解析地找到解。\n\n首先，我们构建优化问题。目标是基于观测值 $y$ 来估计未知的源排放率 $x$。它们之间的关系由线性模型 $y = a x + \\varepsilon$ 给出。我们寻求最小化一个成本函数 $J(x)$，该函数在数据保真度与偏好较小排放值之间取得平衡，并受物理约束的限制。\n\n成本函数包括两项：\n1.  数据失配项，即观测值 $y$ 与模型预测值 $ax$ 之间的平方差。该项为 $(y - ax)^2$。\n2.  Tikhonov 正则化项，用于惩罚解的量级。对于标量变量 $x$，这是 $x$ 的平方值乘以正则化权重 $\\lambda  0$。该项为 $\\lambda x^2$。\n\n需要最小化的总成本函数是这两项之和：\n$$J(x) = (y - ax)^2 + \\lambda x^2$$\n\n此外，问题施加了非负约束 $x \\ge 0$，这在物理上是必要的，因为排放率不能为负。\n\n因此，完整的带约束优化问题是：\n$$\\text{minimize} \\quad J(x) = (y - ax)^2 + \\lambda x^2$$\n$$\\text{subject to} \\quad x \\ge 0$$\n\n这是一个凸优化问题，因为目标函数 $J(x)$ 是两个二次函数（因此是凸函数）的和，这使得它在 $a^2+\\lambda  0$ 时是严格凸的，而由于 $\\lambda  0$，这一点得到了保证。约束集 $x \\ge 0$ 是一个凸集。因此，存在唯一的全局最小值。\n\n为了解决这个问题，我们使用 KKT 条件。首先，我们将不等式约束重写为标准形式 $g(x) \\le 0$：\n$$g(x) = -x \\le 0$$\n通过将约束乘以一个拉格朗日乘子（或 KKT 乘子）$\\mu$ 并加到目标函数上，构建拉格朗日函数 $\\mathcal{L}(x, \\mu)$：\n$$\\mathcal{L}(x, \\mu) = J(x) + \\mu g(x) = (y - ax)^2 + \\lambda x^2 - \\mu x$$\n\n在点 $x^{\\star}$ 处的最优性 KKT 条件是：\n1.  **平稳性 (Stationarity)**：拉格朗日函数关于 $x$ 的梯度在最优点 $x^{\\star}$ 必须为零。\n$$\\nabla_x \\mathcal{L}(x^{\\star}, \\mu) = \\frac{d}{dx} \\left[ (y - ax)^2 + \\lambda x^2 - \\mu x \\right] \\bigg|_{x=x^{\\star}} = 0$$\n2.  **原始可行性 (Primal Feasibility)**：解 $x^{\\star}$ 必须满足原始约束。\n$$x^{\\star} \\ge 0$$\n3.  **对偶可行性 (Dual Feasibility)**：拉格朗日乘子 $\\mu$ 必须为非负。\n$$\\mu \\ge 0$$\n4.  **互补松弛性 (Complementary Slackness)**：拉格朗日乘子与约束函数在解处的值的乘积必须为零。\n$$\\mu x^{\\star} = 0$$\n\n我们现在求解这个条件系统。首先，我们为平稳性条件计算导数：\n$$\\frac{d\\mathcal{L}}{dx} = 2(y - ax)(-a) + 2\\lambda x - \\mu = 2(a^2 + \\lambda)x - 2ay - \\mu$$\n将导数设为零，得到平稳性方程：\n$$2(a^2 + \\lambda)x^{\\star} - 2ay - \\mu = 0$$\n$$x^{\\star} = \\frac{2ay + \\mu}{2(a^2 + \\lambda)} = \\frac{ay + \\mu/2}{a^2 + \\lambda}$$\n\n互补松弛性条件 $\\mu x^{\\star} = 0$ 意味着要么 $\\mu = 0$，要么 $x^{\\star} = 0$。这为分情况讨论提供了基础。\n\n**情况 1：约束未激活 ($x^{\\star}  0$)。**\n如果 $x^{\\star}  0$，互补松弛性条件要求 $\\mu = 0$。我们将 $\\mu = 0$ 代入 $x^{\\star}$ 的平稳性方程：\n$$x^{\\star} = \\frac{ay}{a^2 + \\lambda}$$\n为了使该解有效，它必须与本情况的假设（即 $x^{\\star}  0$）相符。由于给定 $a  0$ 和 $\\lambda  0$，分母 $a^2 + \\lambda$ 总是正的。因此，$x^{\\star}$ 的符号由 $y$ 的符号决定。$x^{\\star}  0$ 的条件成立当且仅当 $ay  0$，这可以简化为 $y  0$。对偶可行性条件 $\\mu \\ge 0$ 也得到满足，因为 $\\mu = 0$。\n因此，如果 $y  0$，最优解为 $x^{\\star} = \\frac{ay}{a^2 + \\lambda}$。\n\n**情况 2：约束被激活 ($x^{\\star} = 0$)。**\n如果最优解是 $x^{\\star}=0$，原始可行性条件 $x^{\\star} \\ge 0$ 得到满足。我们现在必须检查是否存在一个拉格朗日乘子 $\\mu \\ge 0$（对偶可行性）满足平稳性和互补松弛性条件。\n将 $x^{\\star} = 0$ 代入平稳性方程：\n$$2(a^2 + \\lambda)(0) - 2ay - \\mu = 0$$\n$$\\mu = -2ay$$\n对偶可行性条件要求 $\\mu \\ge 0$。因此，我们必须有：\n$$-2ay \\ge 0$$\n由于 $a  0$，这个不等式简化为 $-y \\ge 0$，即 $y \\le 0$。\n因此，如果 $y \\le 0$，最优解为 $x^{\\star} = 0$，并且该解对于有效的拉格朗日乘子 $\\mu = -2ay \\ge 0$ 是 KKT 最优的。\n\n结合两种情况的结果，我们可以将最优解 $x^{\\star}$ 表示为关于 $y$ 的分段函数：\n$$x^{\\star} = \\begin{cases} \\frac{ay}{a^2+\\lambda}  \\text{if } y  0 \\\\ 0  \\text{if } y \\le 0 \\end{cases}$$\n\n这个分段表达式可以用最大值函数更紧凑地写出。注意，如果 $y  0$，则 $\\frac{ay}{a^2+\\lambda}  0$；如果 $y \\le 0$，则 $\\frac{ay}{a^2+\\lambda} \\le 0$。因此，解是无约束解 $\\frac{ay}{a^2+\\lambda}$ 的正部。\n这等价于：\n$$x^{\\star} = \\max\\left(0, \\frac{ay}{a^2+\\lambda}\\right)$$\n这个单一的闭式表达式代表了从带约束的正则化反演中推导出的唯一的、最优的、非负的排放估计值。",
            "answer": "$$\\boxed{\\max\\left(0, \\frac{ay}{a^2+\\lambda}\\right)}$$"
        },
        {
            "introduction": "如果没有对不确定性的相应估算，那么排放估算就是不完整的。后验协方差矩阵是贝叶斯或正则化反演的一个关键输出，它编码了这种不确定性，包括不同源估算误差之间的关系。本练习将教您如何使用后验协方差矩阵，将不确定性从单个源分量传播到一个我们感兴趣的聚合量上，例如一个大区域的总排放量。",
            "id": "3886210",
            "problem": "为追溯一种温室气体在四个子区域的来源，进行了一次区域性的自上而下大气反演。子区域排放的状态向量被建模为一个随机向量 $x \\in \\mathbb{R}^{4}$，其后验均值为 $\\hat{x}$，后验协方差矩阵为 $A = \\mathrm{Cov}(x)$。区域总排放量定义为线性泛函 $E = \\mathbf{1}^{T} x$，其中 $\\mathbf{1} = (1, 1, 1, 1)^{T}$。假设后验 $x$ 是高斯分布且无偏的，并且 $A$ 是对称正定的，其元素单位为 $(\\mathrm{Mt}\\ \\mathrm{yr}^{-1})^{2}$：\n$$\nA = \\begin{pmatrix}\n0.25  0.05  0.02  0.01 \\\\\n0.05  0.36  0.04  0.00 \\\\\n0.02  0.04  0.16  0.03 \\\\\n0.01  0.00  0.03  0.09\n\\end{pmatrix}.\n$$\n仅使用期望、方差和协方差的核心定义以及线性算子的性质，首先推导 $E$ 的方差关于 $A$ 和 $\\mathbf{1}$ 的表达式。然后使用给定的 $A$ 计算其数值。将最终数值四舍五入到四位有效数字。以 $(\\mathrm{Mt}\\ \\mathrm{yr}^{-1})^{2}$ 为单位表示最终方差。",
            "solution": "用户提供了一个有效的问题陈述。\n\n问题要求做两件事：首先，根据后验协方差矩阵 $A$ 和向量 $\\mathbf{1}$ 推导区域总排放量 $E$ 的方差的通用表达式；其次，使用给定的矩阵 $A$ 计算该方差的数值。\n\n**第一部分：方差表达式的推导**\n\n区域总排放量 $E$ 被定义为子区域排放状态向量 $x \\in \\mathbb{R}^{4}$ 的一个线性泛函。其关系由下式给出：\n$$E = \\mathbf{1}^{T} x$$\n其中 $\\mathbf{1} = (1, 1, 1, 1)^{T}$ 且 $x = (x_1, x_2, x_3, x_4)^T$。这意味着 $E = \\sum_{i=1}^{4} x_i$。\n\n标量随机变量 $Y$ 的方差定义为 $\\mathrm{Var}(Y) = \\mathbb{E}[(Y - \\mathbb{E}[Y])^2]$。在本例中，随机变量是 $E$。\n\n首先，我们求 $E$ 的期望。由于期望算子 $\\mathbb{E}[\\cdot]$ 是线性的，我们有：\n$$\\mathbb{E}[E] = \\mathbb{E}[\\mathbf{1}^{T} x] = \\mathbf{1}^{T} \\mathbb{E}[x]$$\n\n现在，我们可以表示 $E$ 与其均值的偏差：\n$$E - \\mathbb{E}[E] = \\mathbf{1}^{T} x - \\mathbf{1}^{T} \\mathbb{E}[x] = \\mathbf{1}^{T} (x - \\mathbb{E}[x])$$\n\n令向量 $x$ 与其均值的偏差表示为 $\\delta_x = x - \\mathbb{E}[x]$。$E$ 的偏差表达式变为：\n$$E - \\mathbb{E}[E] = \\mathbf{1}^{T} \\delta_x$$\n由于 $E - \\mathbb{E}[E]$ 是一个标量（$1 \\times 1$ 矩阵），它的平方由其自身与其转置的乘积给出。$\\mathbf{1}^{T} \\delta_x$ 的转置是 $(\\mathbf{1}^{T} \\delta_x)^T = \\delta_x^{T} \\mathbf{1}$。因此：\n$$(E - \\mathbb{E}[E])^2 = (\\mathbf{1}^{T} \\delta_x) (\\mathbf{1}^{T} \\delta_x)^T = (\\mathbf{1}^{T} \\delta_x) (\\delta_x^{T} \\mathbf{1})$$\n重新排列各项，我们得到：\n$$(E - \\mathbb{E}[E])^2 = \\mathbf{1}^{T} (\\delta_x \\delta_x^{T}) \\mathbf{1}$$\n\n现在，我们可以通过取该平方偏差的期望来写出 $E$ 的方差：\n$$\\mathrm{Var}(E) = \\mathbb{E}[(E - \\mathbb{E}[E])^2] = \\mathbb{E}[\\mathbf{1}^{T} (\\delta_x \\delta_x^{T}) \\mathbf{1}]$$\n由于 $\\mathbf{1}$ 是一个常数向量，我们可以将其移到期望算子之外：\n$$\\mathrm{Var}(E) = \\mathbf{1}^{T} \\mathbb{E}[\\delta_x \\delta_x^{T}] \\mathbf{1}$$\n将 $\\delta_x = x - \\mathbb{E}[x]$ 代回：\n$$\\mathrm{Var}(E) = \\mathbf{1}^{T} \\mathbb{E}[(x - \\mathbb{E}[x]) (x - \\mathbb{E}[x])^T] \\mathbf{1}$$\n\n期望内的项 $\\mathbb{E}[(x - \\mathbb{E}[x]) (x - \\mathbb{E}[x])^T]$ 是随机向量 $x$ 的协方差矩阵的定义，记为 $A = \\mathrm{Cov}(x)$。\n\n因此，推导出的 $E$ 的方差表达式为：\n$$\\mathrm{Var}(E) = \\mathbf{1}^{T} A \\mathbf{1}$$\n\n这个表达式表示矩阵 $A$ 与向量 $\\mathbf{1}$ 的二次型。它等价于对矩阵 $A$ 的所有元素求和，因为 $\\mathbf{1}^T A \\mathbf{1} = \\sum_{i=1}^{4} \\sum_{j=1}^{4} A_{ij}$。\n\n**第二部分：数值计算**\n\n我们已知后验协方差矩阵 $A$：\n$$\nA = \\begin{pmatrix}\n0.25  0.05  0.02  0.01 \\\\\n0.05  0.36  0.04  0.00 \\\\\n0.02  0.04  0.16  0.03 \\\\\n0.01  0.00  0.03  0.09\n\\end{pmatrix}\n$$\n$A$ 中元素的单位是 $(\\mathrm{Mt}\\ \\mathrm{yr}^{-1})^{2}$。为了求出 $\\mathrm{Var}(E)$，我们将该矩阵的所有 16 个元素相加。\n\n每行元素的总和：\n- 第 1 行：$0.25 + 0.05 + 0.02 + 0.01 = 0.33$\n- 第 2 行：$0.05 + 0.36 + 0.04 + 0.00 = 0.45$\n- 第 3 行：$0.02 + 0.04 + 0.16 + 0.03 = 0.25$\n- 第 4 行：$0.01 + 0.00 + 0.03 + 0.09 = 0.13$\n\n总和：\n$$\\mathrm{Var}(E) = 0.33 + 0.45 + 0.25 + 0.13 = 1.16$$\n\n计算出的方差为 $1.16\\ (\\mathrm{Mt}\\ \\mathrm{yr}^{-1})^{2}$。问题要求最终数值保留四位有效数字。为了用四位有效数字表示 $1.16$，我们将其写为 $1.160$。",
            "answer": "$$\n\\boxed{1.160}\n$$"
        }
    ]
}