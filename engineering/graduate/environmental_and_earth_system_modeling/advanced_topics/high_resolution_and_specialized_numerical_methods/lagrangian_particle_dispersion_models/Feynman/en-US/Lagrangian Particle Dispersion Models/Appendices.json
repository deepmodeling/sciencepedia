{
    "hands_on_practices": [
        {
            "introduction": "A core challenge in Lagrangian modeling is to correctly represent concentration fields in environments with non-uniform turbulence. This practice explores the \"well-mixed condition,\" a crucial concept that arises when linking the stochastic motion of individual particles to the Eulerian concentration field. By deriving the necessary drift term for a given diffusivity profile , you will uncover why a simple random walk is insufficient and how LPDMs are formulated to prevent the unphysical accumulation of particles in regions of low diffusivity.",
            "id": "3886893",
            "problem": "Consider a one-dimensional vertical coordinate $z$ in a Lagrangian particle dispersion model for the atmospheric boundary layer. A passive scalar is represented by an ensemble of particles whose vertical position $Z(t)$ evolves according to an Itō stochastic differential equation (SDE),\n$$\n\\mathrm{d}Z(t) = a(Z(t))\\,\\mathrm{d}t + \\sqrt{2\\,K(Z(t))}\\,\\mathrm{d}W(t),\n$$\nwhere $a(z)$ is the deterministic drift, $K(z)$ is the eddy diffusivity, and $W(t)$ is a standard Wiener process. Let the corresponding Eulerian concentration $C(z,t)$ denote the particle number density. Assume there are no sources or sinks and that the domain is large enough that boundary effects can be neglected in the interior.\n\nStarting from conservation of probability mass and the relationship between the Itō SDE and the Fokker–Planck equation for $C(z,t)$, derive the condition on the drift $a(z)$ required for a stationary, spatially uniform equilibrium concentration $C_{\\infty}(z)=C_{0}$, where $C_{0}$ is a constant. Then, for the specific eddy diffusivity profile $K(z)=K_{0}\\,(1+\\alpha z)$ with $K_{0}>0$ and $\\alpha$ a constant (with dimension of inverse length), compute the explicit expression for $a(z)$ that maintains the uniform equilibrium $C_{\\infty}(z)=C_{0}$.\n\nExpress your final answer as a single closed-form symbolic expression for $a(z)$. The physical unit of the drift $a(z)$ is meters per second, but do not include units in your boxed answer.",
            "solution": "The user wants to find the drift term `a(z)` for a Lagrangian particle dispersion model that results in a stationary, spatially uniform concentration.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n\n-   The vertical position of a particle, $Z(t)$, is governed by the Itō stochastic differential equation (SDE):\n    $$\n    \\mathrm{d}Z(t) = a(Z(t))\\,\\mathrm{d}t + \\sqrt{2\\,K(Z(t))}\\,\\mathrm{d}W(t)\n    $$\n-   $a(z)$ is the deterministic drift.\n-   $K(z)$ is the eddy diffusivity.\n-   $W(t)$ is a standard Wiener process.\n-   The Eulerian concentration is $C(z,t)$.\n-   The system has no sources or sinks.\n-   Boundary effects are negligible.\n-   The desired equilibrium state is a stationary, spatially uniform concentration: $C_{\\infty}(z) = C_{0}$, where $C_{0}$ is a constant.\n-   A specific eddy diffusivity profile is given: $K(z) = K_{0}\\,(1+\\alpha z)$, with $K_{0} > 0$ and $\\alpha$ being a constant.\n\n**1.2. Validate Using Extracted Givens**\n\nThe problem is examined against the validation criteria.\n\n-   **Scientifically Grounded**: The problem describes the relationship between a Lagrangian stochastic model (an Itō SDE) for particle trajectories and the corresponding Eulerian concentration field described by the Fokker–Planck equation. This is a standard and fundamental concept in statistical physics and fluid dynamics, particularly in modeling turbulent dispersion. The setup is scientifically and mathematically sound.\n-   **Well-Posed**: The problem is well-defined. It provides a governing equation, specifies a desired state (stationary, uniform concentration), and gives a functional form for one of the model's coefficients ($K(z)$). It then asks to derive the other coefficient ($a(z)$) that satisfies this condition. This forms a clear and solvable mathematical problem.\n-   **Objective**: The problem statement is precise, quantitative, and free of subjective or ambiguous language. All terms like \"stationary,\" \"spatially uniform,\" and the aformentioned SDE are formally defined within physics and mathematics.\n-   **Completeness and Consistency**: The problem provides all necessary information. The relationship between the Itō SDE and the Fokker–Planck equation is a standard result that does not need to be re-derived from first principles, but is invoked. The conditions on the domain (large, no sources/sinks) are sufficient to determine the constant of integration (the flux). There are no contradictions.\n-   **Realism and Feasibility**: The SDE is a common model for turbulent diffusion. Spatially varying diffusivity profiles, like the linear form $K(z) = K_{0}\\,(1+\\alpha z)$, are used as simplified yet plausible representations in contexts like the atmospheric boundary layer. The question is physically and mathematically feasible to answer.\n\n**1.3. Verdict and Action**\n\nThe problem is **valid**. It is a standard exercise in the field of stochastic processes applied to transport phenomena. The solution process can proceed.\n\n### Step 2: Derivation of the Drift Condition\n\nThe evolution of the particle number density, or concentration $C(z,t)$, corresponding to the given Itō SDE is described by the Fokker–Planck equation. For a one-dimensional process with drift $a(z)$ and diffusion coefficient $D(z)$, the general form of the Fokker–Planck equation is:\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{\\partial}{\\partial z}\\left[a(z)C\\right] + \\frac{\\partial^2}{\\partial z^2}\\left[D(z)C\\right]\n$$\nIn the context of the SDE $\\mathrm{d}Z = a(Z)\\,\\mathrm{d}t + \\sigma(Z)\\,\\mathrm{d}W(t)$, the diffusion coefficient $D(z)$ in the Fokker-Planck equation is related to the stochastic term $\\sigma(z)$ by $D(z) = \\frac{1}{2}\\sigma^2(z)$. From the given SDE, we have $\\sigma(z) = \\sqrt{2K(z)}$, so the diffusion coefficient is:\n$$\nD(z) = \\frac{1}{2}\\left(\\sqrt{2K(z)}\\right)^2 = \\frac{1}{2}(2K(z)) = K(z)\n$$\nThus, the governing equation for the concentration $C(z,t)$ is:\n$$\n\\frac{\\partial C(z,t)}{\\partial t} = -\\frac{\\partial}{\\partial z}\\left[a(z)C(z,t)\\right] + \\frac{\\partial^2}{\\partial z^2}\\left[K(z)C(z,t)\\right]\n$$\nThis equation can be written in the form of a continuity equation, $\\frac{\\partial C}{\\partial t} = -\\frac{\\partial J}{\\partial z}$, where $J(z,t)$ is the particle flux:\n$$\nJ(z,t) = a(z)C(z,t) - \\frac{\\partial}{\\partial z}\\left[K(z)C(z,t)\\right]\n$$\nThe problem requires a stationary equilibrium solution, which means the concentration does not change with time, $\\frac{\\partial C}{\\partial t} = 0$. In this case, the continuity equation reduces to $\\frac{\\partial J}{\\partial z} = 0$. This implies that the stationary flux, $J(z)$, must be a constant with respect to the spatial coordinate $z$.\n\nThe problem states that boundary effects are negligible and there are no sources or sinks. For a stationary state to exist in such an unbounded or large domain, the net flux of particles must be zero everywhere. If the flux were a non-zero constant, it would imply a continuous transport of particles from one end of the domain to the other, leading to depletion in one region and accumulation in another, which contradicts the premise of a stationary equilibrium. Therefore, we must set the constant flux to zero: $J(z) = 0$.\n\nThe condition for stationary equilibrium is thus:\n$$\na(z)C(z) - \\frac{\\partial}{\\partial z}\\left[K(z)C(z)\\right] = 0\n$$\nWe are given that the stationary equilibrium concentration is spatially uniform, i.e., $C(z) = C_{\\infty}(z) = C_{0}$, where $C_{0}$ is a non-zero constant. Substituting this into the zero-flux condition:\n$$\na(z)C_{0} - \\frac{\\mathrm{d}}{\\mathrm{d}z}\\left[K(z)C_{0}\\right] = 0\n$$\nSince $C_{0}$ is a constant, it can be factored out of the derivative:\n$$\na(z)C_{0} - C_{0}\\frac{\\mathrm{d}K(z)}{\\mathrm{d}z} = 0\n$$\nAssuming a non-trivial concentration ($C_{0} \\neq 0$), we can divide the entire equation by $C_{0}$ to obtain the general condition on the drift $a(z)$ required to maintain a uniform concentration:\n$$\na(z) = \\frac{\\mathrm{d}K(z)}{\\mathrm{d}z}\n$$\nThis result is known as the \"well-mixed\" condition. It dictates that an artificial drift, equal to the gradient of the diffusivity, must be added to counteract the tendency of particles to accumulate in regions of lower diffusivity.\n\n### Step 3: Calculation of the Specific Drift `a(z)`\n\nNow we apply this general condition to the specific eddy diffusivity profile provided in the problem statement:\n$$\nK(z) = K_{0}\\,(1+\\alpha z)\n$$\nwhere $K_{0}$ and $\\alpha$ are constants.\n\nWe compute the derivative of $K(z)$ with respect to $z$:\n$$\n\\frac{\\mathrm{d}K(z)}{\\mathrm{d}z} = \\frac{\\mathrm{d}}{\\mathrm{d}z} \\left[ K_{0}\\,(1+\\alpha z) \\right]\n$$\nUsing the rules of differentiation:\n$$\n\\frac{\\mathrm{d}K(z)}{\\mathrm{d}z} = K_{0} \\frac{\\mathrm{d}}{\\mathrm{d}z} (1+\\alpha z) = K_{0} \\left(\\frac{\\mathrm{d}}{\\mathrm{d}z}(1) + \\frac{\\mathrm{d}}{\\mathrm{d}z}(\\alpha z)\\right)\n$$\n$$\n\\frac{\\mathrm{d}K(z)}{\\mathrm{d}z} = K_{0} (0 + \\alpha) = \\alpha K_{0}\n$$\nTherefore, the drift $a(z)$ that maintains the uniform equilibrium concentration is a constant:\n$$\na(z) = \\alpha K_{0}\n$$",
            "answer": "$$\n\\boxed{\\alpha K_{0}}\n$$"
        },
        {
            "introduction": "The predictive power of LPDMs comes from their ability to simulate the transport of various substances. This exercise  moves from theory to application by using the analytical Gaussian puff model to perform forward simulations of plume dispersion. By implementing and comparing the downwind concentrations of passive, settling, and decaying particles, you will gain hands-on experience in how distinct physical processes are represented within the Lagrangian framework and how they quantitatively impact model predictions.",
            "id": "3886848",
            "problem": "Consider a canonical Lagrangian particle dispersion setup in an unbounded, homogeneous atmosphere. A point source instantaneously releases a pollutant of total mass $M$ at position $(x,y,z)=(0,0,H)$ at time $t=0$. The mean wind is uniform with speed $U$ directed along $+x$, and the turbulent diffusivity is isotropic and constant with coefficient $K$ in all directions. Three particle classes are considered: passive (no settling, no decay), settling-only (constant downward settling speed), and decaying-only (first-order decay in mass with time). Your task is to compute how downwind centerline concentrations at a fixed receptor height differ among these classes.\n\nUse the following physically plausible and self-consistent parameter values, with units explicitly specified:\n- Mean wind speed: $U=2\\,\\mathrm{m\\,s^{-1}}$.\n- Turbulent diffusivity: $K=5\\,\\mathrm{m^2\\,s^{-1}}$.\n- Source height: $H=50\\,\\mathrm{m}$.\n- Released mass: $M=1\\times 10^{-3}\\,\\mathrm{kg}$.\n- Receptor height: $z_r=1.5\\,\\mathrm{m}$.\n- Settling speed (applied only to settling-only particles): $w_s=0.05\\,\\mathrm{m\\,s^{-1}}$.\n- First-order decay rate (applied only to decaying-only particles): $\\lambda=0.001\\,\\mathrm{s^{-1}}$.\n\nFundamental base assumptions and definitions you must use:\n- The pollutant concentration field evolves consistently with the advection–diffusion equation with constant coefficients. In the Lagrangian description, particle positions follow stochastic dynamics whose drift is given by the mean wind and any constant settling velocity, and whose fluctuations are driven by turbulent diffusion. First-order decay reduces particle mass exponentially in time. No reflective or absorbing boundary is present (free space), and no additional forces act on the particles.\n- The downwind centerline concentration for a distance $x_i$ is to be evaluated at time $t_i$, defined by the kinematic flight time $t_i=x_i/U$ (this is a definitional kinematic relation for mean advection).\n\nDefine three particle classes:\n- Passive: $w_s=0$ and $\\lambda=0$.\n- Settling-only: $w_s=0.05\\,\\mathrm{m\\,s^{-1}}$ and $\\lambda=0$.\n- Decaying-only: $w_s=0$ and $\\lambda=0.001\\,\\mathrm{s^{-1}}$.\n\nCompute the instantaneous point concentration at $(x_i,0,z_r)$ at the corresponding $t_i$ for each class, using the Lagrangian framework that is consistent with the above assumptions. Then compute the differences in concentration relative to the passive case, defined by\n- $\\Delta C_{\\text{settling}}(x_i) = C_{\\text{passive}}(x_i) - C_{\\text{settling}}(x_i)$,\n- $\\Delta C_{\\text{decay}}(x_i) = C_{\\text{passive}}(x_i) - C_{\\text{decay}}(x_i)$,\nwhere $C_{\\cdot}(x_i)$ denotes the concentration at $(x_i,0,z_r)$ at time $t_i$ for the corresponding class. Express all concentrations and concentration differences in $\\mathrm{kg}\\,\\mathrm{m^{-3}}$ as floating-point values.\n\nTest suite:\nEvaluate the above quantities for the following downwind distances:\n- $x_1=100\\,\\mathrm{m}$ (near field),\n- $x_2=500\\,\\mathrm{m}$ (intermediate),\n- $x_3=1000\\,\\mathrm{m}$ (far field).\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the six numbers in the following order:\n$[\\Delta C_{\\text{settling}}(x_1),\\Delta C_{\\text{decay}}(x_1),\\Delta C_{\\text{settling}}(x_2),\\Delta C_{\\text{decay}}(x_2),\\Delta C_{\\text{settling}}(x_3),\\Delta C_{\\text{decay}}(x_3)]$.\nAll values must be in $\\mathrm{kg}\\,\\mathrm{m^{-3}}$.",
            "solution": "The problem is scientifically well-posed and provides a complete set of consistent parameters and definitions to arrive at a unique, meaningful solution. It is a standard problem in atmospheric dispersion modeling, grounded in the physics of advection and diffusion. We shall proceed with the solution.\n\nThe fundamental principle governing the concentration $C(x,y,z,t)$ of a pollutant in a fluid is the advection-diffusion equation. For a system with a constant mean velocity field $\\vec{v}$, constant and isotropic turbulent diffusivity $K$, and a first-order decay process with rate $\\lambda$, the equation is:\n$$\n\\frac{\\partial C}{\\partial t} + \\vec{v} \\cdot \\nabla C = K \\nabla^2 C - \\lambda C\n$$\nIn this problem, the mean velocity field includes uniform wind along the $+x$ axis with speed $U$ and a constant downward settling speed $w_s$ along the $z$ axis. Thus, $\\vec{v} = (U, 0, -w_s)$. The equation becomes:\n$$\n\\frac{\\partial C}{\\partial t} + U \\frac{\\partial C}{\\partial x} - w_s \\frac{\\partial C}{\\partial z} = K \\left( \\frac{\\partial^2 C}{\\partial x^2} + \\frac{\\partial^2 C}{\\partial y^2} + \\frac{\\partial^2 C}{\\partial z^2} \\right) - \\lambda C\n$$\nThe problem specifies an instantaneous release of a pollutant mass $M$ at time $t=0$ from a point source at $(0, 0, H)$. This corresponds to the initial condition:\n$$\nC(x,y,z,0) = M \\delta(x) \\delta(y) \\delta(z-H)\n$$\nwhere $\\delta(\\cdot)$ is the Dirac delta function.\n\nThe analytical solution to this partial differential equation in an unbounded domain is a three-dimensional Gaussian distribution (a \"puff\") whose center advects with the mean flow, whose variance grows due to diffusion, and whose total mass may decrease due to decay. The general solution for the concentration at position $(x,y,z)$ and time $t$ is:\n$$\nC(x, y, z, t) = \\frac{M_{\\text{eff}}(t)}{(2\\pi)^{3/2} \\sigma_x \\sigma_y \\sigma_z} \\exp\\left[ -\\frac{(x-x_c)^2}{2\\sigma_x^2} - \\frac{(y-y_c)^2}{2\\sigma_y^2} - \\frac{(z-z_c)^2}{2\\sigma_z^2} \\right]\n$$\nThe parameters of this solution are determined by the physics of the problem:\n1.  **Puff Center Position**: The center of the puff, $(x_c, y_c, z_c)$, moves with the mean velocity.\n    - $x_c(t) = U t$\n    - $y_c(t) = 0$\n    - $z_c(t) = H - w_s t$\n2.  **Puff Spread (Dispersion)**: For constant isotropic diffusivity $K$, the variance $\\sigma^2$ in each direction is given by $\\sigma_x^2 = \\sigma_y^2 = \\sigma_z^2 = 2Kt$.\n3.  **Effective Mass**: For a first-order decay process with rate $\\lambda$, the total mass in the puff decays exponentially from its initial value $M$, so $M_{\\text{eff}}(t) = M e^{-\\lambda t}$.\n\nSubstituting these into the general Gaussian solution, we obtain the specific model for this problem:\n$$\nC(x, y, z, t) = \\frac{M e^{-\\lambda t}}{(4\\pi K t)^{3/2}} \\exp\\left[ -\\frac{(x - Ut)^2 + y^2 + (z - (H - w_s t))^2}{4Kt} \\right]\n$$\nWe are tasked to evaluate this concentration at a specific downwind centerline receptor $(x_i, 0, z_r)$ at the kinematic flight time $t_i = x_i/U$. Substituting $x=x_i$, $y=0$, $z=z_r$, and $t=t_i$ into the equation gives a significant simplification, as the term $(x_i - Ut_i)^2 = (x_i - U(x_i/U))^2 = 0$. The concentration at the specified receptor point and time is therefore:\n$$\nC(x_i, 0, z_r, t_i) = \\frac{M e^{-\\lambda t_i}}{(4\\pi K t_i)^{3/2}} \\exp\\left[ -\\frac{(z_r - (H - w_s t_i))^2}{4Kt_i} \\right]\n$$\nNow, we apply this formula to the three specified particle classes.\n\n**Class 1: Passive** ($w_s=0\\,\\mathrm{m\\,s^{-1}}$, $\\lambda=0\\,\\mathrm{s^{-1}}$)\n$$\nC_{\\text{passive}}(x_i) = \\frac{M}{(4\\pi K t_i)^{3/2}} \\exp\\left[ -\\frac{(z_r - H)^2}{4Kt_i} \\right]\n$$\n\n**Class 2: Settling-only** ($w_s=0.05\\,\\mathrm{m\\,s^{-1}}$, $\\lambda=0\\,\\mathrm{s^{-1}}$)\n$$\nC_{\\text{settling}}(x_i) = \\frac{M}{(4\\pi K t_i)^{3/2}} \\exp\\left[ -\\frac{(z_r - H + w_s t_i)^2}{4Kt_i} \\right]\n$$\nPhysically, since the source height $H$ is above the receptor height $z_r$, settling ($w_s>0$) brings the puff's vertical centerline closer to the receptor, which is expected to increase the concentration at $(x_i, 0, z_r)$ compared to the passive case, making the difference $\\Delta C_{\\text{settling}}$ negative.\n\n**Class 3: Decaying-only** ($w_s=0\\,\\mathrm{m\\,s^{-1}}$, $\\lambda=0.001\\,\\mathrm{s^{-1}}$)\n$$\nC_{\\text{decay}}(x_i) = \\frac{M e^{-\\lambda t_i}}{(4\\pi K t_i)^{3/2}} \\exp\\left[ -\\frac{(z_r - H)^2}{4Kt_i} \\right] = C_{\\text{passive}}(x_i) \\cdot e^{-\\lambda t_i}\n$$\nDecay reduces the total pollutant mass, which will always result in a lower concentration compared to the passive case, making $\\Delta C_{\\text{decay}}$ positive.\n\nThe final step is to compute the requested differences.\n\n**Concentration Difference for Settling**:\n$$\n\\Delta C_{\\text{settling}}(x_i) = C_{\\text{passive}}(x_i) - C_{\\text{settling}}(x_i)\n$$\n$$\n\\Delta C_{\\text{settling}}(x_i) = \\frac{M}{(4\\pi K t_i)^{3/2}} \\left( \\exp\\left[ -\\frac{(z_r - H)^2}{4Kt_i} \\right] - \\exp\\left[ -\\frac{(z_r - H + w_s t_i)^2}{4Kt_i} \\right] \\right)\n$$\n\n**Concentration Difference for Decay**:\n$$\n\\Delta C_{\\text{decay}}(x_i) = C_{\\text{passive}}(x_i) - C_{\\text{decay}}(x_i) = C_{\\text{passive}}(x_i) - C_{\\text{passive}}(x_i) e^{-\\lambda t_i}\n$$\n$$\n\\Delta C_{\\text{decay}}(x_i) = C_{\\text{passive}}(x_i) (1 - e^{-\\lambda t_i}) = \\frac{M (1 - e^{-\\lambda t_i})}{(4\\pi K t_i)^{3/2}} \\exp\\left[ -\\frac{(z_r - H)^2}{4Kt_i} \\right]\n$$\nThese formulae are implemented using the provided numerical parameters ($U=2\\,\\mathrm{m\\,s^{-1}}$, $K=5\\,\\mathrm{m^2\\,s^{-1}}$, $H=50\\,\\mathrm{m}$, $M=1\\times 10^{-3}\\,\\mathrm{kg}$, $z_r=1.5\\,\\mathrm{m}$, $w_s=0.05\\,\\mathrm{m\\,s^{-1}}$, $\\lambda=0.001\\,\\mathrm{s^{-1}}$) for the test suite distances $x_i \\in \\{100, 500, 1000\\}\\,\\mathrm{m}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes differences in downwind centerline concentrations for different\n    particle classes (passive, settling, decaying) based on the analytical\n    solution to the advection-diffusion equation.\n    \"\"\"\n\n    # Define the parameter values from the problem statement.\n    # Mean wind speed in m/s\n    U = 2.0\n    # Turbulent diffusivity in m^2/s\n    K = 5.0\n    # Source height in m\n    H = 50.0\n    # Released mass in kg\n    M = 1.0e-3\n    # Receptor height in m\n    z_r = 1.5\n    # Settling speed in m/s\n    w_s = 0.05\n    # First-order decay rate in 1/s\n    lam = 0.001\n\n    # Define the test cases from the problem statement.\n    # Downwind distances in m\n    x_distances = [100.0, 500.0, 1000.0]\n\n    results = []\n    \n    for x_i in x_distances:\n        # Calculate kinematic flight time\n        t_i = x_i / U\n\n        # Common pre-factor in the concentration formula\n        # This is M / (4*pi*K*t)^(3/2)\n        pre_factor = M / (4.0 * np.pi * K * t_i)**(1.5)\n\n        # 1. Calculate concentration for the passive case (w_s=0, lam=0)\n        exp_arg_passive = -((z_r - H)**2) / (4.0 * K * t_i)\n        C_passive = pre_factor * np.exp(exp_arg_passive)\n\n        # 2. Calculate concentration for the settling-only case (lam=0)\n        # The center of the puff is at z_c = H - w_s * t_i\n        exp_arg_settling = -((z_r - (H - w_s * t_i))**2) / (4.0 * K * t_i)\n        C_settling = pre_factor * np.exp(exp_arg_settling)\n\n        # 3. Calculate concentration for the decaying-only case (w_s=0)\n        # C_decay = C_passive * exp(-lambda * t)\n        C_decay = C_passive * np.exp(-lam * t_i)\n\n        # 4. Compute the required differences in concentration\n        delta_C_settling = C_passive - C_settling\n        delta_C_decay = C_passive - C_decay\n\n        results.append(delta_C_settling)\n        results.append(delta_C_decay)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond forward prediction, a powerful application of LPDMs is in inverse modeling: using observed concentrations to infer unknown emission sources. This practice  introduces this concept by framing it as a statistical estimation problem. You will use pre-computed source-receptor relationships from an LPDM to derive and implement a maximum likelihood estimator, allowing you to deduce a source's emission rate from noisy measurements and, crucially, to quantify the uncertainty of your estimate.",
            "id": "3886854",
            "problem": "Consider a single, steady point emission of a passive tracer with constant emission rate $Q$ (in $\\mathrm{kg} \\, \\mathrm{s}^{-1}$). A Lagrangian Particle Dispersion Model (LPDM) precomputes receptor-specific source-receptor transfer coefficients (footprints) so that the time-averaged concentration at receptor $i$ is linearly related to $Q$ via $y_i = G_i \\, Q + \\epsilon_i$, where $G_i$ (in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$ per $\\mathrm{kg} \\, \\mathrm{s}^{-1}$) is the footprint for receptor $i$ and $\\epsilon_i$ is measurement error. Assume the errors $\\epsilon_i$ are independent and identically distributed Gaussian random variables with zero mean and known standard deviations $\\sigma_i$ (in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$), and measurements $y_i$ are reported in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$. Using the independence and Gaussianity of $\\epsilon_i$ and the linearity of the LPDM mapping $Q \\mapsto y_i$, derive from first principles the maximum likelihood estimator for $Q$ and an uncertainty quantification for that estimate under the same Gaussian assumptions.\n\nYour program must:\n- Implement the derived estimator and the associated uncertainty quantification using the general case of $N$ receptors with possibly heterogeneous $\\sigma_i$.\n- For each test case, return four quantities:\n    1. The point estimate of $Q$ (in $\\mathrm{kg} \\, \\mathrm{s}^{-1}$).\n    2. The posterior standard deviation of $Q$ (in $\\mathrm{kg} \\, \\mathrm{s}^{-1}$) assuming a flat prior, which under Gaussian errors equals the estimator’s standard deviation derived from the likelihood curvature.\n    3. The lower endpoint of a two-sided $0.95$ credible interval for $Q$ (in $\\mathrm{kg} \\, \\mathrm{s}^{-1}$) under the Gaussian posterior.\n    4. The upper endpoint of the same credible interval (in $\\mathrm{kg} \\, \\mathrm{s}^{-1}$).\n- Use the standard normal quantile $z_{0.975}$ to form the two-sided $0.95$ interval.\n- Express all results in $\\mathrm{kg} \\, \\mathrm{s}^{-1}$.\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, flattened across test cases in the order described above. For example, for three test cases, the output should be of the form $[q_1,\\mathrm{sd}_1,\\mathrm{low}_1,\\mathrm{high}_1,q_2,\\mathrm{sd}_2,\\mathrm{low}_2,\\mathrm{high}_2,q_3,\\mathrm{sd}_3,\\mathrm{low}_3,\\mathrm{high}_3]$.\n\nTest suite:\n- Case A (happy path, moderate signals and equal uncertainties):\n    - $G = [0.80, 1.10, 0.95]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$ per $\\mathrm{kg} \\, \\mathrm{s}^{-1}$,\n    - $y = [0.88, 1.12, 0.97]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$,\n    - $\\sigma = [0.05, 0.05, 0.05]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$.\n- Case B (boundary-leaning case with very small footprints and equal uncertainties):\n    - $G = [0.010, 0.020, 0.015]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$ per $\\mathrm{kg} \\, \\mathrm{s}^{-1}$,\n    - $y = [0.008, 0.023, 0.012]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$,\n    - $\\sigma = [0.005, 0.005, 0.005]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$.\n- Case C (edge case with heterogeneous uncertainties and one negative measurement due to noise):\n    - $G = [0.30, 0.20, 0.40, 0.50]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$ per $\\mathrm{kg} \\, \\mathrm{s}^{-1}$,\n    - $y = [-0.01, 0.08, 0.15, 0.24]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$,\n    - $\\sigma = [0.05, 0.04, 0.06, 0.05]$ in $\\mathrm{mg} \\, \\mathrm{m}^{-3}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[q_A,\\mathrm{sd}_A,\\mathrm{low}_A,\\mathrm{high}_A,q_B,\\mathrm{sd}_B,\\mathrm{low}_B,\\mathrm{high}_B,q_C,\\mathrm{sd}_C,\\mathrm{low}_C,\\mathrm{high}_C]$, where subscripts indicate the case. All numbers must be in $\\mathrm{kg} \\, \\mathrm{s}^{-1}$.",
            "solution": "The problem statement is evaluated as valid, and a solution will be provided. The problem is scientifically grounded, well-posed, and objective. It contains a minor inconsistency in its description of the error distribution: it specifies the errors $\\epsilon_i$ as \"independent and identically distributed Gaussian random variables with zero mean and known standard deviations $\\sigma_i$.\" If the standard deviations $\\sigma_i$ can vary between observations, as implied by the notation and confirmed in Test Case C, then the random variables are independent but not identically distributed. The clear intent of the problem is to address heterogeneous uncertainties. Therefore, the derivation will proceed under the corrected assumption that the errors $\\epsilon_i$ are independent, with each following a Gaussian distribution $\\mathcal{N}(0, \\sigma_i^2)$.\n\nThe task is to derive the maximum likelihood estimator for the emission rate $Q$ and to quantify its uncertainty, based on a set of $N$ measurements. The model relating a measurement $y_i$ to the emission rate $Q$ is given by the linear equation:\n$$ y_i = G_i Q + \\epsilon_i $$\nwhere $y_i$ is the measured concentration, $G_i$ is the known source-receptor transfer coefficient (footprint), $Q$ is the unknown emission rate, and $\\epsilon_i$ is the measurement error. For each receptor $i=1, \\dots, N$, the error $\\epsilon_i$ is an independent random variable drawn from a Gaussian distribution with mean $0$ and known standard deviation $\\sigma_i$, i.e., $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma_i^2)$.\n\nFrom this, it follows that the measurement $y_i$ is also a Gaussian random variable with mean $G_i Q$ and variance $\\sigma_i^2$:\n$$ y_i \\sim \\mathcal{N}(G_i Q, \\sigma_i^2) $$\nThe probability density function (PDF) of a single observation $y_i$ given $Q$ is:\n$$ p(y_i | Q) = \\frac{1}{\\sqrt{2\\pi\\sigma_i^2}} \\exp\\left(-\\frac{(y_i - G_i Q)^2}{2\\sigma_i^2}\\right) $$\n\n**1. Derivation of the Maximum Likelihood Estimator (MLE)**\n\nThe likelihood function, $L(Q)$, is the joint probability of observing the entire set of measurements $\\{y_i\\}_{i=1}^N$. Since the measurements are independent, the likelihood is the product of the individual PDFs:\n$$ L(Q) = \\prod_{i=1}^{N} p(y_i | Q) = \\prod_{i=1}^{N} \\frac{1}{\\sqrt{2\\pi\\sigma_i^2}} \\exp\\left(-\\frac{(y_i - G_i Q)^2}{2\\sigma_i^2}\\right) $$\nTo find the value of $Q$ that maximizes $L(Q)$, it is computationally simpler to maximize the log-likelihood function, $\\mathcal{L}(Q) = \\ln(L(Q))$:\n$$ \\mathcal{L}(Q) = \\ln\\left( \\prod_{i=1}^{N} \\frac{1}{\\sqrt{2\\pi\\sigma_i^2}} \\exp\\left(-\\frac{(y_i - G_i Q)^2}{2\\sigma_i^2}\\right) \\right) $$\n$$ \\mathcal{L}(Q) = \\sum_{i=1}^{N} \\left[ \\ln\\left(\\frac{1}{\\sqrt{2\\pi\\sigma_i^2}}\\right) - \\frac{(y_i - G_i Q)^2}{2\\sigma_i^2} \\right] $$\n$$ \\mathcal{L}(Q) = C - \\frac{1}{2} \\sum_{i=1}^{N} \\frac{(y_i - G_i Q)^2}{\\sigma_i^2} $$\nwhere $C$ is a constant that does not depend on $Q$. Maximizing $\\mathcal{L}(Q)$ is equivalent to minimizing the weighted sum of squared residuals, $\\chi^2(Q) = \\sum_{i=1}^{N} \\frac{(y_i - G_i Q)^2}{\\sigma_i^2}$, where the weights are $w_i = 1/\\sigma_i^2$.\n\nTo find the maximum, we compute the derivative of $\\mathcal{L}(Q)$ with respect to $Q$ and set it to $0$:\n$$ \\frac{d\\mathcal{L}(Q)}{dQ} = \\frac{d}{dQ} \\left( C - \\frac{1}{2} \\sum_{i=1}^{N} \\frac{(y_i - G_i Q)^2}{\\sigma_i^2} \\right) = -\\frac{1}{2} \\sum_{i=1}^{N} \\frac{1}{\\sigma_i^2} \\cdot 2(y_i - G_i Q) \\cdot (-G_i) $$\n$$ \\frac{d\\mathcal{L}(Q)}{dQ} = \\sum_{i=1}^{N} \\frac{G_i(y_i - G_i Q)}{\\sigma_i^2} $$\nSetting the derivative to zero to find the estimator $\\hat{Q}$:\n$$ \\sum_{i=1}^{N} \\frac{G_i(y_i - G_i \\hat{Q})}{\\sigma_i^2} = 0 $$\n$$ \\sum_{i=1}^{N} \\frac{G_i y_i}{\\sigma_i^2} = \\hat{Q} \\sum_{i=1}^{N} \\frac{G_i^2}{\\sigma_i^2} $$\nSolving for $\\hat{Q}$ yields the maximum likelihood estimator:\n$$ \\hat{Q} = \\frac{\\sum_{i=1}^{N} (G_i y_i / \\sigma_i^2)}{\\sum_{i=1}^{N} (G_i^2 / \\sigma_i^2)} $$\nThis estimator is a weighted average of the individual estimates $y_i/G_i$, where each estimate is weighted by its precision relative to the model, $(G_i/\\sigma_i)^2$.\n\n**2. Uncertainty Quantification**\n\nThe problem asks for the posterior standard deviation of $Q$ under a flat prior, $p(Q) \\propto 1$. In this case, the posterior distribution is proportional to the likelihood function, $p(Q|\\{y_i\\}) \\propto L(Q)$. Since the log-likelihood $\\mathcal{L}(Q)$ is a quadratic function of $Q$, the posterior distribution for $Q$ is Gaussian. The mean of this posterior is the MLE, $\\hat{Q}$.\n\nThe variance of the posterior, $\\sigma_Q^2$, can be found from the curvature of the log-likelihood function at its maximum. The variance is the negative reciprocal of the second derivative of the log-likelihood:\n$$ \\sigma_Q^2 = \\left( - \\frac{d^2\\mathcal{L}(Q)}{dQ^2} \\right)^{-1} $$\nLet's compute the second derivative:\n$$ \\frac{d^2\\mathcal{L}(Q)}{dQ^2} = \\frac{d}{dQ} \\left( \\sum_{i=1}^{N} \\frac{G_i y_i}{\\sigma_i^2} - \\sum_{i=1}^{N} \\frac{G_i^2 Q}{\\sigma_i^2} \\right) = - \\sum_{i=1}^{N} \\frac{G_i^2}{\\sigma_i^2} $$\nThe second derivative is negative and constant, confirming that $\\hat{Q}$ corresponds to a maximum and the posterior is indeed Gaussian. The variance is:\n$$ \\sigma_Q^2 = \\left( - \\left( - \\sum_{i=1}^{N} \\frac{G_i^2}{\\sigma_i^2} \\right) \\right)^{-1} = \\left( \\sum_{i=1}^{N} \\frac{G_i^2}{\\sigma_i^2} \\right)^{-1} $$\nThe posterior standard deviation, $\\sigma_Q$, is the square root of the variance:\n$$ \\sigma_Q = \\left( \\sum_{i=1}^{N} \\frac{G_i^2}{\\sigma_i^2} \\right)^{-1/2} $$\n\n**3. Credible Interval**\n\nWith the posterior distribution for $Q$ established as Gaussian, $Q|\\{y_i\\} \\sim \\mathcal{N}(\\hat{Q}, \\sigma_Q^2)$, a two-sided $0.95$ credible interval for $Q$ can be constructed. This interval is centered at the mean $\\hat{Q}$ and extends by a multiple of the standard deviation $\\sigma_Q$. The multiple is given by the standard normal quantile $z_{\\alpha/2}$, where $1-\\alpha = 0.95$, so $\\alpha/2 = 0.025$. We need $z_{0.025}$, or equivalently, the upper quantile $z_{1-0.025} = z_{0.975}$.\n\nThe credible interval is given by:\n$$ [ \\hat{Q} - z_{0.975} \\cdot \\sigma_Q, \\quad \\hat{Q} + z_{0.975} \\cdot \\sigma_Q ] $$\nwhere $z_{0.975} \\approx 1.96$ is the $97.5$-th percentile of the standard normal distribution $\\mathcal{N}(0, 1)$.\n\nThe computational procedure for each test case is as follows:\n1.  Given arrays of $G_i$, $y_i$, and $\\sigma_i$, compute the weights $w_i = 1/\\sigma_i^2$.\n2.  Calculate the MLE point estimate $\\hat{Q} = (\\sum w_i G_i y_i) / (\\sum w_i G_i^2)$.\n3.  Calculate the posterior standard deviation $\\sigma_Q = (\\sum w_i G_i^2)^{-1/2}$.\n4.  Determine the quantile $z_{0.975}$ from a standard normal distribution.\n5.  Compute the lower bound of the $0.95$ credible interval as $\\hat{Q} - z_{0.975} \\cdot \\sigma_Q$.\n6.  Compute the upper bound of the $0.95$ credible interval as $\\hat{Q} + z_{0.975} \\cdot \\sigma_Q$.\nThese four quantities will be calculated for each provided test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Derives the maximum likelihood estimate for a single emission source Q,\n    its uncertainty, and credible interval, based on a linear receptor model.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (G_values, y_values, sigma_values)\n    test_cases = [\n        # Case A (happy path, moderate signals and equal uncertainties)\n        ([0.80, 1.10, 0.95], [0.88, 1.12, 0.97], [0.05, 0.05, 0.05]),\n        # Case B (boundary-leaning case with very small footprints and equal uncertainties)\n        ([0.010, 0.020, 0.015], [0.008, 0.023, 0.012], [0.005, 0.005, 0.005]),\n        # Case C (edge case with heterogeneous uncertainties and one negative measurement)\n        ([0.30, 0.20, 0.40, 0.50], [-0.01, 0.08, 0.15, 0.24], [0.05, 0.04, 0.06, 0.05]),\n    ]\n\n    all_results = []\n    \n    # Pre-calculate the standard normal quantile for a two-sided 95% interval.\n    # This corresponds to the 97.5th percentile.\n    z_0975 = norm.ppf(0.975)\n\n    for G_vals, y_vals, sigma_vals in test_cases:\n        # Convert lists to NumPy arrays for vectorized operations.\n        G = np.array(G_vals)\n        y = np.array(y_vals)\n        sigma = np.array(sigma_vals)\n\n        # The weights for the weighted least squares are the inverse variances.\n        weights = 1.0 / sigma**2\n\n        # Calculate the terms for the MLE of Q.\n        # This is equivalent to Q_hat = (G' W y) / (G' W G) in matrix notation,\n        # where W is the weight matrix.\n        numerator = np.sum(weights * G * y)\n        denominator = np.sum(weights * G**2)\n\n        # 1. Point estimate of Q (kg/s)\n        q_hat = numerator / denominator\n\n        # The denominator is also the Fisher Information, or the inverse variance of Q.\n        # 2. Posterior standard deviation of Q (kg/s)\n        var_q = 1.0 / denominator\n        std_q = np.sqrt(var_q)\n\n        # Calculate the half-width of the credible interval.\n        interval_half_width = z_0975 * std_q\n\n        # 3. Lower endpoint of the 95% credible interval for Q (kg/s)\n        q_lower = q_hat - interval_half_width\n        \n        # 4. Upper endpoint of the 95% credible interval for Q (kg/s)\n        q_upper = q_hat + interval_half_width\n        \n        # Append the four required quantities for this case to the final list.\n        all_results.extend([q_hat, std_q, q_lower, q_upper])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}