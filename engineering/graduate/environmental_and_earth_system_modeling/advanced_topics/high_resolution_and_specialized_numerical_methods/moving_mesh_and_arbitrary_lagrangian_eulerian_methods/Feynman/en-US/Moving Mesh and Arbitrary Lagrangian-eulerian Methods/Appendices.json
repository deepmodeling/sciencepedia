{
    "hands_on_practices": [
        {
            "introduction": "At the heart of any reliable finite-volume method is the strict conservation of physical quantities. When a computational mesh moves, ensuring this property requires special care. This practice introduces the Geometric Conservation Law (GCL), a fundamental constraint ensuring that a numerical scheme on a moving grid correctly handles even the simplest case of a uniform flow field. Through this coding exercise , you will computationally verify that only a GCL-compliant scheme can preserve a constant state, gaining a deep, practical understanding of why this law is indispensable for preventing spurious sources and sinks in Arbitrary Lagrangian-Eulerian (ALE) simulations.",
            "id": "3897514",
            "problem": "You are tasked with demonstrating the geometric conservation property in a one-dimensional Arbitrary Lagrangian-Eulerian (ALE) finite-volume scheme for a passive scalar field. Consider a one-dimensional periodic domain of length $L$ (in meters) partitioned into $N$ cells with moving mesh interfaces. Let $q(x,t)$ denote a passive scalar and $u$ (in meters per second) a spatially uniform physical advection velocity. The mesh moves with a prescribed interface velocity $w(x,t)$ (in meters per second). The goal is to construct a computational test showing that a spatially constant $q$ remains strictly constant after one explicit time step of a first-order upwind ALE finite-volume update when the discrete Geometric Conservation Law (GCL) holds.\n\nFundamental base and definitions to be used:\n- Conservation of $q$ in Eulerian form: $\\partial_t q + \\partial_x \\left( u q \\right) = 0$ on a periodic domain.\n- Arbitrary Lagrangian-Eulerian (ALE) flux definition: the flux through a moving interface uses the relative speed $(u - w)$.\n- Geometric Conservation Law (GCL): for a moving mesh, the evolution of the cell size must be consistent with interface motion.\n- Finite-volume principle: evolve cell averages using interface fluxes and the cell metric (size).\n\nRequirements:\n1. Derive and implement a one-step explicit finite-volume update on a moving mesh for cell averages $q_i$ over cells with size $J_i$ using an ALE flux with relative speed $(u - w)$ and a first-order upwind numerical flux. The update must honor the discrete GCL.\n2. Use periodic boundary conditions.\n3. Initialize $q_i$ to a spatially constant value $q_0$ (dimensionless). Demonstrate that after one update, $q_i$ remains equal to $q_0$ when the discrete GCL holds and $u$ is spatially uniform.\n4. Implement a contrasting case where the discrete GCL is intentionally violated to show that the constant field is not preserved.\n5. Use a mesh interface velocity defined at faces $x_{j+1/2}$ as $w(x_{j+1/2}) = A \\,\\sin\\!\\left( 2\\pi m \\, x_{j+1/2}/L \\right)$, where $A$ (in meters per second) is an amplitude and $m$ is an integer wavenumber controlling spatial oscillations of the mesh speed. The initial face locations are uniformly spaced: $x_{j+1/2} = j \\, L/N$ for integer face index $j \\in \\{0,1,\\dots,N\\}$.\n6. Perform exactly one forward-Euler time step of size $\\Delta t$ (in seconds). The update must be conservative and must use the ALE relative speed $(u - w)$ at faces with periodic indexing. The first-order upwind choice is based on the sign of $(u - w)$ at each face.\n7. Quantify the result by computing, for each test case, the maximum absolute deviation from the initial constant value $q_0$ after the update: $\\max_i \\left| q_i^{n+1} - q_0 \\right|$. Then compare this deviation to a tolerance of $\\varepsilon = 10^{-12}$ (dimensionless) and produce a boolean result: return $\\,\\text{True}\\,$ if the deviation is less than or equal to $\\varepsilon$, and $\\,\\text{False}\\,$ otherwise.\n\nTest Suite:\nProvide and evaluate the following five test cases, each specified as a tuple $(N, L, u, A, m, \\Delta t, q_0, \\text{gcl})$, where $\\text{gcl}$ is a boolean indicating whether to enforce the discrete GCL in the update ($\\text{True}$) or to intentionally violate it ($\\text{False}$):\n- Case 1 (nontrivial moving mesh, ALE happy path): $(128, 1.0, 0.7, 0.3, 3, 0.001, 2.0, \\text{True})$.\n- Case 2 (pure mesh motion, zero physical advection): $(64, 1.0, 0.0, 0.5, 1, 0.002, 1.0, \\text{True})$.\n- Case 3 (strong mesh oscillation, sign changes in relative speed): $(100, 1.0, 0.1, 0.9, 5, 0.0005, -3.0, \\text{True})$.\n- Case 4 (static mesh, Eulerian limit): $(80, 1.0, 0.4, 0.0, 0, 0.005, 0.37, \\text{True})$.\n- Case 5 (intentional GCL violation): $(128, 1.0, 0.3, 0.4, 2, 0.001, 1.0, \\text{False})$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the five test cases in the order listed above. Each entry must be a boolean obtained by testing whether the maximum absolute deviation is less than or equal to $\\varepsilon = 10^{-12}$. For example, the output must look like \"[True,True,True,True,False]\". No units are required in the output because the results are dimensionless booleans.",
            "solution": "The user-provided problem is assessed as valid. It is scientifically grounded in the principles of computational fluid dynamics, specifically concerning finite-volume methods on moving meshes. The problem is well-posed, with all necessary parameters, equations, and boundary conditions provided to construct a unique and meaningful numerical experiment. The objective is clear and formalizable.\n\nThe core of the problem lies in demonstrating the Geometric Conservation Law (GCL) for an Arbitrary Lagrangian-Eulerian (ALE) finite-volume scheme. We begin by deriving the numerical update equations.\n\nThe one-dimensional conservation law for a passive scalar $q(x,t)$ with a physical advection velocity $u$ is given in Eulerian form as:\n$$\n\\partial_t q + \\partial_x (u q) = 0\n$$\nWe consider a finite-volume discretization of a one-dimensional periodic domain of length $L$. The domain is partitioned into $N$ cells, indexed by $i \\in \\{0, 1, \\dots, N-1\\}$. Cell $i$ is defined by the moving interval $[x_i(t), x_{i+1}(t)]$, where $x_i(t)$ and $x_{i+1}(t)$ are the positions of the cell's left and right faces, respectively. The size of cell $i$ is $J_i(t) = x_{i+1}(t) - x_i(t)$. The cell-averaged quantity $q_i(t)$ is defined as:\n$$\nq_i(t) = \\frac{1}{J_i(t)} \\int_{x_i(t)}^{x_{i+1}(t)} q(x,t) \\, dx\n$$\nIntegrating the conservation law over the moving cell $i$ and applying the Leibniz integral rule yields the exact evolution equation for the total amount of scalar in the cell, $J_i q_i$:\n$$\n\\frac{d}{dt}(J_i q_i) = - \\left( (u-w)q \\right)_{i+1} + \\left( (u-w)q \\right)_{i}\n$$\nHere, $w(x,t) = dx/dt$ is the mesh velocity, so $w_j(t)$ is the velocity of face $j$. The term $F_{ALE} = (u-w)q$ is the ALE flux, which represents the flux of $q$ relative to the moving cell boundary.\n\nWe discretize this semi-discrete equation in time using a first-order explicit (forward Euler) scheme with a time step $\\Delta t$:\n$$\n\\frac{J_i^{n+1} q_i^{n+1} - J_i^n q_i^n}{\\Delta t} = - \\left( \\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n \\right)\n$$\nwhere the superscript $n$ denotes the time level $t^n$, and $\\mathcal{F}_j^n$ is the numerical approximation to the ALE flux at face $j$ at time $t^n$. This can be rearranged to form the update equation for the conserved quantity $J_i q_i$:\n$$\nJ_i^{n+1} q_i^{n+1} = J_i^n q_i^n - \\Delta t \\left( \\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n \\right)\n$$\nThe problem specifies a first-order upwind flux. The relative velocity at face $j$ is $v_{rel,j} = u - w_j$, where $u$ is constant. The upwind flux at face $j$ (between cell $j-1$ on the left and cell $j$ on the right) is determined by the sign of $v_{rel,j}$:\n$$\n\\mathcal{F}_j^n = v_{rel,j}^n q_{j, \\text{upwind}}^n = \\begin{cases} v_{rel,j}^n q_{j-1}^n & \\text{if } v_{rel,j}^n \\ge 0 \\\\ v_{rel,j}^n q_j^n & \\text{if } v_{rel,j}^n < 0 \\end{cases}\n$$\nThe evolution of the cell size $J_i$ must also be handled correctly. The time derivative of the cell size is $\\frac{dJ_i}{dt} = \\frac{dx_{i+1}}{dt} - \\frac{dx_i}{dt} = w_{i+1} - w_i$. Discretizing this with forward Euler gives the discrete Geometric Conservation Law (GCL):\n$$\n\\frac{J_i^{n+1} - J_i^n}{\\Delta t} = w_{i+1}^n - w_i^n \\quad \\implies \\quad J_i^{n+1} = J_i^n + \\Delta t (w_{i+1}^n - w_i^n)\n$$\nTo obtain the updated cell average $q_i^{n+1}$, we divide the updated conserved quantity by the updated cell size:\n$$\nq_i^{n+1} = \\frac{J_i^n q_i^n - \\Delta t (\\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n)}{J_i^{n+1}}\n$$\nCrucially, for the GCL to hold, $J_i^{n+1}$ in the denominator must be computed using its own evolution equation, as derived above.\n\nNow, we test the scheme's ability to preserve a constant state, a \"freestream preservation\" property. Let the initial state be spatially constant: $q_i^n = q_0$ for all $i$. For any face $j$, the states in the adjacent cells are identical, $q_{j-1}^n = q_j^n = q_0$. Therefore, the upwind state is always $q_0$, regardless of the sign of the relative velocity $v_{rel,j}$. The numerical flux simplifies to:\n$$\n\\mathcal{F}_j^n = v_{rel,j}^n q_0 = (u - w_j^n) q_0\n$$\nSubstituting this into the update for the conserved quantity:\n$$\nJ_i^{n+1} q_i^{n+1} = J_i^n q_0 - \\Delta t \\left( (u - w_{i+1}^n)q_0 - (u - w_i^n)q_0 \\right)\n$$\nFactoring out $q_0$ and simplifying the flux difference:\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n - \\Delta t \\left( u - w_{i+1}^n - u + w_i^n \\right) \\right]\n$$\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n - \\Delta t \\left( - (w_{i+1}^n - w_i^n) \\right) \\right]\n$$\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n + \\Delta t (w_{i+1}^n - w_i^n) \\right]\n$$\nThe term in the square brackets is precisely the expression for the new cell size $J_i^{n+1}$ according to the discrete GCL. Therefore, if the GCL is enforced:\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 J_i^{n+1}\n$$\nThis leads to $q_i^{n+1} = q_0$ (assuming $J_i^{n+1} \\neq 0$), demonstrating that the constant state is perfectly preserved.\n\nIn contrast, if the GCL is violated, for instance by incorrectly assuming the cell sizes are static ($J_i^{n+1} = J_i^n$), the update becomes:\n$$\nq_i^{n+1} = \\frac{q_0 \\left[ J_i^n + \\Delta t (w_{i+1}^n - w_i^n) \\right]}{J_i^n} = q_0 \\left( 1 + \\frac{\\Delta t}{J_i^n} (w_{i+1}^n - w_i^n) \\right)\n$$\nSince the mesh velocity $w$ is not uniform (for $A \\neq 0$ and $m \\neq 0$), the term $w_{i+1}^n - w_i^n$ is generally non-zero, leading to $q_i^{n+1} \\neq q_0$. This generates spurious sources or sinks of the scalar quantity, violating conservation.\n\nThe implementation will simulate one time step for each test case.\n1. Initialize a uniform grid with $N$ cells and $N+1$ faces over a periodic domain of length $L$. The initial cell size is $J_i^n = L/N$.\n2. Initialize the scalar field $q_i^n = q_0$ for all cells.\n3. Calculate the mesh velocities $w_j^n = A \\sin(2\\pi m x_j/L)$ at each of the $N+1$ face locations $x_j$.\n4. Compute the upwind ALE numerical fluxes $\\mathcal{F}_j^n$ at all faces, handling periodic boundaries correctly.\n5. Compute the new cell size $J_i^{n+1}$. If the `gcl` flag is `True`, use the GCL update $J_i^{n+1} = J_i^n + \\Delta t (w_{i+1}^n - w_i^n)$. If `False`, set $J_i^{n+1} = J_i^n$.\n6. Compute the new cell average $q_i^{n+1}$ using the main update formula.\n7. Calculate the maximum absolute deviation $\\max_i |q_i^{n+1} - q_0|$ and compare it against the tolerance $\\varepsilon = 10^{-12}$.\nThe results of this comparison for the specified test cases will be provided.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(N, L, u, A, m, dt, q0, enforce_gcl):\n    \"\"\"\n    Performs one time step of an ALE finite-volume scheme and checks for GCL property.\n\n    Args:\n        N (int): Number of cells.\n        L (float): Domain length.\n        u (float): Spatially uniform physical advection velocity.\n        A (float): Amplitude of mesh interface velocity.\n        m (int): Wavenumber of mesh interface velocity.\n        dt (float): Time step size.\n        q0 (float): Initial spatially constant scalar value.\n        enforce_gcl (bool): If True, enforces the discrete GCL. If False, violates it.\n\n    Returns:\n        float: The maximum absolute deviation from the initial constant value q0.\n    \"\"\"\n    # 1. Initialize grid and scalar field\n    # N+1 faces from j=0 to N. Face j is at position x_faces[j].\n    x_faces = np.linspace(0.0, L, N + 1)\n    \n    # N cells. Cell i is between face i and face i+1.\n    # Initial cell sizes J (metric) are uniform.\n    J_old = np.full(N, L / N)\n    \n    # Initial scalar field q is constant at q0.\n    q_old = np.full(N, q0)\n\n    # 2. Calculate mesh velocities at faces\n    # w_faces[j] is the velocity of face j.\n    w_faces = A * np.sin(2 * np.pi * m * x_faces / L)\n\n    # 3. Compute ALA first-order upwind numerical fluxes\n    # Relative velocity at faces\n    v_rel_faces = u - w_faces\n    \n    # To compute fluxes at N+1 faces, we need the states from the left and right cells.\n    # We use periodic boundary conditions.\n    # For face j, the left state is q[j-1] and the right state is q[j].\n    # q_left_vals[j] = q[j-1], q_right_vals[j] = q[j] (with periodic wrap-around)\n    q_left_vals = np.concatenate(([q_old[-1]], q_old))\n    q_right_vals = np.concatenate((q_old, [q_old[0]]))\n    \n    # Compute upwind flux at each of the N+1 faces\n    # F(j) = v_rel(j) * q_upwind(j)\n    F_faces = np.where(\n        v_rel_faces >= 0,\n        v_rel_faces * q_left_vals,\n        v_rel_faces * q_right_vals\n    )\n\n    # 4. Update cell sizes (metric)\n    if enforce_gcl:\n        # GCL holds: update cell sizes based on face velocities\n        # w_diff[i] = w[i+1] - w[i]\n        w_diff = w_faces[1:] - w_faces[:-1]\n        J_new = J_old + dt * w_diff\n    else:\n        # GCL is violated: cell sizes are assumed to be static\n        J_new = J_old.copy()\n        \n    # Check for mesh tangling, though not expected for these parameters.\n    # If any J_new is non-positive, the result is invalid.\n    if np.any(J_new = 0):\n        # Return a large error to indicate failure if this unlikely event occurs.\n        return np.inf\n\n    # 5. Update the scalar field\n    # The change in the conserved quantity J*q in cell i is due to flux difference\n    # flux_diff[i] = F[i+1] - F[i]\n    flux_diff = F_faces[1:] - F_faces[:-1]\n    \n    # Update the conserved quantity J*q\n    qJ_new = J_old * q_old - dt * flux_diff\n    \n    # Get the new cell-averaged scalar value\n    q_new = qJ_new / J_new\n\n    # 6. Calculate the maximum deviation\n    max_deviation = np.max(np.abs(q_new - q0))\n    \n    return max_deviation\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N, L, u, A, m, dt, q0, gcl)\n        (128, 1.0, 0.7, 0.3, 3, 0.001, 2.0, True),\n        (64, 1.0, 0.0, 0.5, 1, 0.002, 1.0, True),\n        (100, 1.0, 0.1, 0.9, 5, 0.0005, -3.0, True),\n        (80, 1.0, 0.4, 0.0, 0, 0.005, 0.37, True),\n        (128, 1.0, 0.3, 0.4, 2, 0.001, 1.0, False),\n    ]\n\n    epsilon = 1e-12\n    results = []\n    \n    for case in test_cases:\n        N, L, u, A, m, dt, q0, gcl = case\n        deviation = run_simulation(N, L, u, A, m, dt, q0, gcl)\n        results.append(deviation = epsilon)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Once a numerical scheme is conservative, the next practical hurdle is ensuring its stability. For explicit time-stepping schemes, the time step $\\Delta t$ is limited by the Courant-Friedrichs-Lewy (CFL) condition, which dictates that information cannot travel more than one cell per step. In an ALE framework, the crucial velocity is not the fluid velocity $\\boldsymbol{u}$ alone, but the fluid velocity relative to the moving mesh, $\\boldsymbol{u} - \\boldsymbol{w}$. This hands-on calculation  challenges you to derive the stability constraint from first principles, combining the advective limit with a geometric constraint on mesh motion to determine the maximum permissible time step for a simulation.",
            "id": "3897512",
            "problem": "Consider a two-dimensional, depth-averaged estuarine transport model discretized by an explicit Finite-Volume Method (FVM) on an unstructured planar mesh whose nodes are advanced by an Arbitrary Lagrangian-Eulerian (ALE) mesh motion. The prognostic conserved scalar satisfies a local conservation law over each moving control volume. The advective flux across a face depends on the fluid velocity relative to the face motion. Let the fluid velocity field be denoted by $\\boldsymbol{u}(\\boldsymbol{x},t)$ and the mesh velocity field by $\\boldsymbol{w}(\\boldsymbol{x},t)$, and let faces be characterized by unit outward normals $\\boldsymbol{n}$ and edge lengths.\n\nYou are given scientifically plausible bounds and geometric minima sufficient to determine a conservative explicit time-step stability constraint for this ALE FVM:\n- A uniform bound on the fluid speed magnitude: $\\|\\boldsymbol{u}\\| \\leq 1.5 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$.\n- A uniform bound on the mesh speed magnitude: $\\|\\boldsymbol{w}\\| \\leq 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$.\n- A global minimal edge length across all faces in the mesh: $L_{\\min} = 25 \\ \\mathrm{m}$.\n\nAssume the explicit FVM uses a second-order monotone flux limiting in space and time such that its domain-of-dependence requirement is enforced by a Courant-type constant $C_{\\mathrm{adv}} = 0.5$, and that the mesh motion is restricted to avoid face crossing and to satisfy a discrete geometric conservation constraint by limiting nodal displacements per step with $C_{\\mathrm{mesh}} = 0.3$.\n\nStarting from first principles of local conservation and the domain-of-dependence argument, derive conservative constraints on the time step $\\Delta t$ that ensure stability of the explicit ALE fluxes over all faces when only the given bounds and $L_{\\min}$ are available, and then compute the maximum stable time step $\\Delta t_{\\max}$ implied by the combination of these constraints.\n\nExpress your final answer in seconds. Round your numerical answer to three significant figures.",
            "solution": "The problem requires the derivation of a maximum stable time step, $\\Delta t_{\\max}$, for an explicit Arbitrary Lagrangian-Eulerian (ALE) Finite-Volume Method (FVM). The stability of such a scheme is governed by two primary constraints: one related to the numerical stability of the advection operator (the CFL condition), and another related to maintaining the geometric integrity of the moving mesh. We must derive the mathematical form of each constraint from first principles and then combine them to find the most restrictive limit.\n\nLet the conserved scalar quantity be denoted by $c$. The integral form of the conservation law in an ALE framework for a time-varying control volume $V_i(t)$ is given by the Reynolds transport theorem:\n$$\n\\frac{d}{dt} \\int_{V_i(t)} c \\, dV = - \\oint_{\\partial V_i(t)} \\boldsymbol{F}_{\\text{adv}} \\cdot \\boldsymbol{n} \\, dA\n$$\nwhere source/sink terms are neglected as they do not typically affect the time-step constraint for explicit advection. The advective flux vector $\\boldsymbol{F}_{\\text{adv}}$ is given by $\\boldsymbol{F}_{\\text{adv}} = c(\\boldsymbol{u} - \\boldsymbol{w})$, where $\\boldsymbol{u}$ is the fluid velocity, $\\boldsymbol{w}$ is the mesh velocity, and $\\boldsymbol{n}$ is the unit outward normal on the boundary $\\partial V_i(t)$. The term $\\boldsymbol{u} - \\boldsymbol{w}$ is the relative velocity of the fluid with respect to the moving cell boundary.\n\n**1. Advective Stability Constraint (CFL Condition)**\nAn explicit time-stepping scheme is stable only if the numerical domain of dependence for a grid cell contains the physical domain of dependence. This is the Courant-Friedrichs-Lewy (CFL) condition. For an advection problem, it means that in a time step $\\Delta t$, a particle of the fluid should not travel a distance greater than the characteristic size of a mesh cell. The characteristic speed of information propagation is determined by the fluid velocity relative to the mesh.\n\nThe speed of advection normal to a cell face is given by $|(\\boldsymbol{u} - \\boldsymbol{w}) \\cdot \\boldsymbol{n}|$. To derive a conservative, globally applicable time-step limit, we must consider the maximum possible value of this speed across the entire computational domain and for all time.\nLet $v_{\\text{char}} = |(\\boldsymbol{u} - \\boldsymbol{w}) \\cdot \\boldsymbol{n}|$. Using the Cauchy-Schwarz inequality and the fact that $\\boldsymbol{n}$ is a unit vector ($\\|\\boldsymbol{n}\\| = 1$):\n$$\nv_{\\text{char}} \\le \\|\\boldsymbol{u} - \\boldsymbol{w}\\| \\|\\boldsymbol{n}\\| = \\|\\boldsymbol{u} - \\boldsymbol{w}\\|\n$$\nNext, applying the triangle inequality to $\\|\\boldsymbol{u} - \\boldsymbol{w}\\|$:\n$$\n\\|\\boldsymbol{u} - \\boldsymbol{w}\\| \\le \\|\\boldsymbol{u}\\| + \\|-\\boldsymbol{w}\\| = \\|\\boldsymbol{u}\\| + \\|\\boldsymbol{w}\\|\n$$\nThe maximum characteristic speed, $v_{\\text{char, max}}$, is therefore bounded by the sum of the maximum fluid speed, $U_{\\max} = \\sup \\|\\boldsymbol{u}\\|$, and the maximum mesh speed, $W_{\\max} = \\sup \\|\\boldsymbol{w}\\|$. This worst-case scenario occurs when the fluid and mesh velocities are at their maxima and directed oppositely.\n$$\nv_{\\text{char, max}} \\le U_{\\max} + W_{\\max}\n$$\nThe CFL condition states that the distance traveled by a wave or particle in one time step, $v_{\\text{char, max}} \\Delta t$, must be less than or equal to a fraction of the characteristic grid size, $L_{\\text{char}}$. This fraction is the Courant number, $C_{\\text{adv}}$.\n$$\n(U_{\\max} + W_{\\max}) \\Delta t \\le C_{\\text{adv}} L_{\\text{char}}\n$$\nFor a conservative global time step on an unstructured mesh, the characteristic length $L_{\\text{char}}$ is taken as the smallest length scale, which is the given global minimal edge length, $L_{\\min}$. This yields the first constraint on $\\Delta t$:\n$$\n\\Delta t \\le \\Delta t_{\\text{adv}} = \\frac{C_{\\text{adv}} L_{\\min}}{U_{\\max} + W_{\\max}}\n$$\nSubstituting the given values: $C_{\\text{adv}} = 0.5$, $L_{\\min} = 25 \\ \\mathrm{m}$, $U_{\\max} = 1.5 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$, and $W_{\\max} = 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$:\n$$\n\\Delta t_{\\text{adv}} = \\frac{0.5 \\times 25}{1.5 + 0.4} = \\frac{12.5}{1.9} \\ \\mathrm{s} \\approx 6.5789 \\ \\mathrm{s}\n$$\n\n**2. Mesh Geometric Integrity Constraint**\nIn an ALE simulation, the mesh vertices move. If they move too far in a single time step, cells can become inverted (volume becomes negative) or severely distorted, causing the simulation to fail. To prevent this, the displacement of any node in one time step must be limited to a fraction of the size of the smallest adjacent element.\nThe maximum displacement of a node during a time step $\\Delta t$ is bounded by $W_{\\max} \\Delta t$. The problem specifies that this displacement is limited by a constant $C_{\\text{mesh}}$ relative to a characteristic length. To maintain mesh quality globally, this length must again be the most restrictive one, $L_{\\min}$.\nThe constraint is therefore:\n$$\nW_{\\max} \\Delta t \\le C_{\\text{mesh}} L_{\\min}\n$$\nThis gives the second constraint on $\\Delta t$:\n$$\n\\Delta t \\le \\Delta t_{\\text{mesh}} = \\frac{C_{\\text{mesh}} L_{\\min}}{W_{\\max}}\n$$\nSubstituting the given values: $C_{\\text{mesh}} = 0.3$, $L_{\\min} = 25 \\ \\mathrm{m}$, and $W_{\\max} = 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$:\n$$\n\\Delta t_{\\text{mesh}} = \\frac{0.3 \\times 25}{0.4} = \\frac{7.5}{0.4} = 18.75 \\ \\mathrm{s}\n$$\n\n**3. Maximum Stable Time Step**\nThe overall time step $\\Delta t$ for the simulation must satisfy both the advective stability and the mesh geometry constraints to be valid. Therefore, the maximum stable time step, $\\Delta t_{\\max}$, is the minimum of the two derived upper bounds:\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{mesh}})\n$$\n$$\n\\Delta t_{\\max} = \\min \\left( \\frac{12.5}{1.9}, 18.75 \\right) \\ \\mathrm{s}\n$$\nNumerically, $\\Delta t_{\\text{adv}} \\approx 6.5789 \\ \\mathrm{s}$ and $\\Delta t_{\\text{mesh}} = 18.75 \\ \\mathrm{s}$. The more restrictive constraint is the advective CFL condition.\n$$\n\\Delta t_{\\max} = \\frac{12.5}{1.9} \\ \\mathrm{s} \\approx 6.578947... \\ \\mathrm{s}\n$$\nThe problem asks for the numerical answer rounded to three significant figures.\n$$\n\\Delta t_{\\max} \\approx 6.58 \\ \\mathrm{s}\n$$",
            "answer": "$$\\boxed{6.58}$$"
        },
        {
            "introduction": "A conservative and stable ALE simulation can still fail catastrophically if the mesh itself becomes overly distorted, leading to tangled or inverted elements with non-positive volume. Therefore, actively monitoring and maintaining mesh quality is a critical component of any robust moving mesh application. This practice  provides a tangible exercise in quantifying mesh health by computing a standard quality metric from the Jacobian determinant $J$ of the element mapping. By working through this example, you will develop a concrete understanding of how geometric deformation is measured and why such metrics are essential for triggering local mesh smoothing or r-adaptive strategies.",
            "id": "3897538",
            "problem": "A coastal estuary channel is modeled on the rectangular domain with coordinates $(x,y) \\in [0,2] \\times [0,1]$. An Arbitrary Lagrangian-Eulerian (ALE) mesh is used to evolve the computational grid with a prescribed horizontal deformation motivated by tidally driven shear. The mesh at initial time has two four-node bilinear quadrilateral elements with nodal ordering $(1,2,3,4)$ corresponding to bottom-left, bottom-right, top-right, and top-left. The initial (undeformed) nodal coordinates are:\n- Element $E_1$: $(x_1,y_1)=(0,0)$, $(x_2,y_2)=(1,0)$, $(x_3,y_3)=(1,1)$, $(x_4,y_4)=(0,1)$.\n- Element $E_2$: $(x_1,y_1)=(1,0)$, $(x_2,y_2)=(2,0)$, $(x_3,y_3)=(2,1)$, $(x_4,y_4)=(1,1)$.\n\nThe ALE mesh moves with the prescribed deformation field\n$$\nx'(t) \\;=\\; x \\;+\\; \\gamma\\, t\\, y \\,\\bigl(1 + \\alpha\\, x\\bigr), \n\\qquad\ny'(t) \\;=\\; y,\n$$\nwhere $\\gamma t = g = 1.2$ and $\\alpha = 0.5$. At this time, the physical nodal coordinates of each element are obtained by applying $(x',y')$ to the initial nodal coordinates.\n\nUsing the standard bilinear reference-to-physical mapping for each quadrilateral, evaluate the Jacobian matrix $J$ at the element center $(\\xi,\\eta)=(0,0)$ and compute the isotropy quality metric\n$$\nq \\;=\\; \\frac{2\\,\\det(J)}{\\mathrm{tr}\\!\\bigl(J^{\\top} J\\bigr)}.\n$$\nAn element is flagged for $r$-adaptive repositioning if its computed $q$ is strictly less than the threshold $\\tau = 0.4$.\n\nStarting from fundamental definitions of the ALE mapping and the bilinear isoparametric element, derive the necessary expressions to compute $q$ at the center of each element and determine how many elements require $r$-adaptive repositioning. Express your final answer as a unitless integer. No rounding is required.",
            "solution": "We begin from the Arbitrary Lagrangian-Eulerian (ALE) mapping and the standard bilinear isoparametric quadrilateral element. For each quadrilateral with nodes $i=1,2,3,4$ and physical nodal coordinates $(x_i,y_i)$, the bilinear mapping from the reference square $(\\xi,\\eta)\\in[-1,1]^2$ to the physical element is\n$$\nx(\\xi,\\eta) \\;=\\; \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\, x_i,\n\\qquad\ny(\\xi,\\eta) \\;=\\; \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\, y_i,\n$$\nwhere the four bilinear shape functions are\n$$\nN_1(\\xi,\\eta) \\;=\\; \\frac{(1-\\xi)(1-\\eta)}{4},\\quad\nN_2(\\xi,\\eta) \\;=\\; \\frac{(1+\\xi)(1-\\eta)}{4},\\quad\nN_3(\\xi,\\eta) \\;=\\; \\frac{(1+\\xi)(1+\\eta)}{4},\\quad\nN_4(\\xi,\\eta) \\;=\\; \\frac{(1-\\xi)(1+\\eta)}{4}.\n$$\nThe Jacobian matrix $J$ at $(\\xi,\\eta)$ is\n$$\nJ(\\xi,\\eta) \\;=\\; \n\\begin{pmatrix}\nx_{\\xi}  x_{\\eta} \\\\\ny_{\\xi}  y_{\\eta}\n\\end{pmatrix},\n\\qquad\nx_{\\xi} \\;=\\; \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} x_i,\\quad\nx_{\\eta} \\;=\\; \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} x_i,\n$$\nwith analogous expressions for $y_{\\xi}$ and $y_{\\eta}$. At the element center $(\\xi,\\eta)=(0,0)$, the derivatives of the shape functions are\n$$\n\\frac{\\partial N_1}{\\partial \\xi} = -\\frac{1}{4},\\quad\n\\frac{\\partial N_2}{\\partial \\xi} = \\frac{1}{4},\\quad\n\\frac{\\partial N_3}{\\partial \\xi} = \\frac{1}{4},\\quad\n\\frac{\\partial N_4}{\\partial \\xi} = -\\frac{1}{4},\n$$\n$$\n\\frac{\\partial N_1}{\\partial \\eta} = -\\frac{1}{4},\\quad\n\\frac{\\partial N_2}{\\partial \\eta} = -\\frac{1}{4},\\quad\n\\frac{\\partial N_3}{\\partial \\eta} = \\frac{1}{4},\\quad\n\\frac{\\partial N_4}{\\partial \\eta} = \\frac{1}{4}.\n$$\nThus, at the center,\n$$\nx_{\\xi} \\;=\\; \\frac{-x_1 + x_2 + x_3 - x_4}{4},\\quad\nx_{\\eta} \\;=\\; \\frac{-x_1 - x_2 + x_3 + x_4}{4},\n$$\n$$\ny_{\\xi} \\;=\\; \\frac{-y_1 + y_2 + y_3 - y_4}{4},\\quad\ny_{\\eta} \\;=\\; \\frac{-y_1 - y_2 + y_3 + y_4}{4}.\n$$\n\nThe ALE deformation field is\n$$\nx' \\;=\\; x + g\\, y \\,\\bigl(1 + \\alpha\\, x\\bigr),\\qquad y' \\;=\\; y,\n$$\nwith $g=1.2$ and $\\alpha=0.5$. We apply this to the initial nodal coordinates.\n\nFor element $E_1$, the initial nodes are\n$$\n(x_1,y_1)=(0,0),\\quad (x_2,y_2)=(1,0),\\quad (x_3,y_3)=(1,1),\\quad (x_4,y_4)=(0,1).\n$$\nAfter deformation,\n\\begin{align*}\nx_1' = 0 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 0) \\;=\\; 0,  y_1' = 0,\\\\\nx_2' = 1 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1,  y_2' = 0,\\\\\nx_3' = 1 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1 + g(1+\\alpha),  y_3' = 1,\\\\\nx_4' = 0 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 0) \\;=\\; g,  y_4' = 1.\n\\end{align*}\nIn symbolic form, with $a=\\alpha$,\n$$\nx_1'=0,\\quad x_2'=1,\\quad x_3' = 1 + g(1+a),\\quad x_4' = g,\n\\qquad\ny_1'=0,\\; y_2'=0,\\; y_3'=1,\\; y_4'=1.\n$$\nCompute the center derivatives:\n\\begin{align*}\nx_{\\xi}^{(E_1)} = \\frac{-x_1' + x_2' + x_3' - x_4'}{4}\n= \\frac{-0 + 1 + \\bigl(1 + g(1+a)\\bigr) - g}{4}\n= \\frac{2 + g a}{4},\\\\[4pt]\nx_{\\eta}^{(E_1)} = \\frac{-x_1' - x_2' + x_3' + x_4'}{4}\n= \\frac{-0 - 1 + \\bigl(1 + g(1+a)\\bigr) + g}{4}\n= \\frac{g(2+a)}{4},\\\\[4pt]\ny_{\\xi}^{(E_1)} = \\frac{-y_1' + y_2' + y_3' - y_4'}{4} = \\frac{-0 + 0 + 1 - 1}{4} = 0,\\\\[4pt]\ny_{\\eta}^{(E_1)} = \\frac{-y_1' - y_2' + y_3' + y_4'}{4} = \\frac{-0 - 0 + 1 + 1}{4} = \\frac{1}{2}.\n\\end{align*}\nTherefore,\n$$\nJ_{E_1} \\;=\\; \n\\begin{pmatrix}\n\\dfrac{2 + g a}{4}  \\dfrac{g(2+a)}{4} \\\\\n0  \\dfrac{1}{2}\n\\end{pmatrix}.\n$$\n\nFor element $E_2$, the initial nodes are\n$$\n(x_1,y_1)=(1,0),\\quad (x_2,y_2)=(2,0),\\quad (x_3,y_3)=(2,1),\\quad (x_4,y_4)=(1,1).\n$$\nAfter deformation,\n\\begin{align*}\nx_1' = 1 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1,  y_1' = 0,\\\\\nx_2' = 2 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 2) \\;=\\; 2,  y_2' = 0,\\\\\nx_3' = 2 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 2) \\;=\\; 2 + g(1+2a),  y_3' = 1,\\\\\nx_4' = 1 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1 + g(1+a),  y_4' = 1.\n\\end{align*}\nCompute the center derivatives:\n\\begin{align*}\nx_{\\xi}^{(E_2)} = \\frac{-x_1' + x_2' + x_3' - x_4'}{4}\n= \\frac{-1 + 2 + \\bigl(2 + g(1+2a)\\bigr) - \\bigl(1 + g(1+a)\\bigr)}{4}\n= \\frac{2 + g a}{4},\\\\[4pt]\nx_{\\eta}^{(E_2)} = \\frac{-x_1' - x_2' + x_3' + x_4'}{4}\n= \\frac{-1 - 2 + \\bigl(2 + g(1+2a)\\bigr) + \\bigl(1 + g(1+a)\\bigr)}{4}\n= \\frac{g(2+3a)}{4},\\\\[4pt]\ny_{\\xi}^{(E_2)} = \\frac{-y_1' + y_2' + y_3' - y_4'}{4} = \\frac{-0 + 0 + 1 - 1}{4} = 0,\\\\[4pt]\ny_{\\eta}^{(E_2)} = \\frac{-y_1' - y_2' + y_3' + y_4'}{4} = \\frac{-0 - 0 + 1 + 1}{4} = \\frac{1}{2}.\n\\end{align*}\nTherefore,\n$$\nJ_{E_2} \\;=\\;\n\\begin{pmatrix}\n\\dfrac{2 + g a}{4}  \\dfrac{g(2+3a)}{4} \\\\\n0  \\dfrac{1}{2}\n\\end{pmatrix}.\n$$\n\nWe now compute the isotropy quality metric\n$$\nq \\;=\\; \\frac{2\\,\\det(J)}{\\mathrm{tr}\\!\\bigl(J^{\\top} J\\bigr)}.\n$$\nFor a general matrix of the form\n$$\nJ \\;=\\;\n\\begin{pmatrix}\nA  B \\\\\n0  D\n\\end{pmatrix},\n$$\nwe have $\\det(J) = A D$, and $\\mathrm{tr}(J^{\\top} J) = A^2 + B^2 + 0^2 + D^2 = A^2 + B^2 + D^2$.\n\nApplying this to $E_1$, with $A = \\dfrac{2 + g a}{4}$, $B = \\dfrac{g(2+a)}{4}$, and $D = \\dfrac{1}{2}$,\n\\begin{align*}\n\\det(J_{E_1}) = \\frac{2 + g a}{4}\\cdot \\frac{1}{2} \\;=\\; \\frac{2 + g a}{8},\\\\\n\\mathrm{tr}\\!\\bigl(J_{E_1}^{\\top} J_{E_1}\\bigr) = \\left(\\frac{2 + g a}{4}\\right)^{2} + \\left(\\frac{g(2+a)}{4}\\right)^{2} + \\left(\\frac{1}{2}\\right)^{2} \\\\\n= \\frac{(2 + g a)^{2}}{16} + \\frac{g^{2}(2+a)^{2}}{16} + \\frac{1}{4}.\n\\end{align*}\nTherefore,\n\\begin{align*}\nq_{E_1} = \\frac{2\\,\\det(J_{E_1})}{\\mathrm{tr}\\!\\bigl(J_{E_1}^{\\top} J_{E_1}\\bigr)}\n= \\frac{2 \\cdot \\dfrac{2 + g a}{8}}{\\dfrac{(2 + g a)^{2}}{16} + \\dfrac{g^{2}(2+a)^{2}}{16} + \\dfrac{1}{4}} \\\\\n= \\frac{\\dfrac{2 + g a}{4}}{\\dfrac{(2 + g a)^{2} + g^{2}(2+a)^{2} + 4}{16}}\n= \\frac{4(2 + g a)}{(2 + g a)^{2} + g^{2}(2+a)^{2} + 4}.\n\\end{align*}\n\nSimilarly, for $E_2$ with $A = \\dfrac{2 + g a}{4}$, $B = \\dfrac{g(2+3a)}{4}$, and $D = \\dfrac{1}{2}$,\n\\begin{align*}\nq_{E_2}\n= \\frac{4(2 + g a)}{(2 + g a)^{2} + g^{2}(2+3a)^{2} + 4}.\n\\end{align*}\n\nWe now substitute the given parameters $g = 1.2$ and $a = \\alpha = 0.5$:\n\\begin{align*}\n2 + g a = 2 + (1.2)(0.5) \\;=\\; 2 + 0.6 \\;=\\; 2.6,\\\\\n(2 + g a)^{2} = (2.6)^{2} \\;=\\; 6.76,\\\\\ng^{2} = (1.2)^{2} \\;=\\; 1.44,\\\\\n2 + a = 2 + 0.5 \\;=\\; 2.5,\\qquad (2 + a)^{2} \\;=\\; (2.5)^{2} \\;=\\; 6.25,\\\\\ng^{2}(2+a)^{2} = 1.44 \\cdot 6.25 \\;=\\; 9.00,\\\\\n2 + 3a = 2 + 1.5 \\;=\\; 3.5,\\qquad (2 + 3a)^{2} \\;=\\; (3.5)^{2} \\;=\\; 12.25,\\\\\ng^{2}(2+3a)^{2} = 1.44 \\cdot 12.25 \\;=\\; 17.64.\n\\end{align*}\nCompute $q_{E_1}$:\n\\begin{align*}\nq_{E_1} = \\frac{4(2 + g a)}{(2 + g a)^{2} + g^{2}(2+a)^{2} + 4}\n= \\frac{4 \\cdot 2.6}{6.76 + 9.00 + 4} \n= \\frac{10.4}{19.76}\n\\approx 0.526.\n\\end{align*}\nCompute $q_{E_2}$:\n\\begin{align*}\nq_{E_2} = \\frac{4(2 + g a)}{(2 + g a)^{2} + g^{2}(2+3a)^{2} + 4}\n= \\frac{10.4}{6.76 + 17.64 + 4}\n= \\frac{10.4}{28.4}\n\\approx 0.3662.\n\\end{align*}\n\nThe threshold is $\\tau = 0.4$. We compare:\n- For $E_1$, $q_{E_1} \\approx 0.526 > 0.4$; $E_1$ is not flagged.\n- For $E_2$, $q_{E_2} \\approx 0.3662  0.4$; $E_2$ is flagged.\n\nTherefore, exactly one element requires $r$-adaptive repositioning. The requested final answer is the number of elements flagged, which is $1$.",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}