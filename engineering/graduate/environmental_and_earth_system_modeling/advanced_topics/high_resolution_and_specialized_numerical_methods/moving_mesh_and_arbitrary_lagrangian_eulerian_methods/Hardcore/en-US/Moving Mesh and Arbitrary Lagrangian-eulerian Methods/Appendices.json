{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of any valid Arbitrary Lagrangian-Eulerian (ALE) scheme is the satisfaction of the Geometric Conservation Law (GCL). This principle ensures that the numerical method does not spuriously create or destroy a conserved quantity as a result of mesh motion alone. This hands-on exercise demonstrates this fundamental requirement by tasking you with verifying that a uniform scalar field remains perfectly constant in a moving-mesh simulation if, and only if, the discrete GCL is correctly implemented .",
            "id": "3897514",
            "problem": "You are tasked with demonstrating the geometric conservation property in a one-dimensional Arbitrary Lagrangian-Eulerian (ALE) finite-volume scheme for a passive scalar field. Consider a one-dimensional periodic domain of length $L$ (in meters) partitioned into $N$ cells with moving mesh interfaces. Let $q(x,t)$ denote a passive scalar and $u$ (in meters per second) a spatially uniform physical advection velocity. The mesh moves with a prescribed interface velocity $w(x,t)$ (in meters per second). The goal is to construct a computational test showing that a spatially constant $q$ remains strictly constant after one explicit time step of a first-order upwind ALE finite-volume update when the discrete Geometric Conservation Law (GCL) holds.\n\nFundamental base and definitions to be used:\n- Conservation of $q$ in Eulerian form: $\\partial_t q + \\partial_x \\left( u q \\right) = 0$ on a periodic domain.\n- Arbitrary Lagrangian-Eulerian (ALE) flux definition: the flux through a moving interface uses the relative speed $(u - w)$.\n- Geometric Conservation Law (GCL): for a moving mesh, the evolution of the cell size must be consistent with interface motion.\n- Finite-volume principle: evolve cell averages using interface fluxes and the cell metric (size).\n\nRequirements:\n1. Derive and implement a one-step explicit finite-volume update on a moving mesh for cell averages $q_i$ over cells with size $J_i$ using an ALE flux with relative speed $(u - w)$ and a first-order upwind numerical flux. The update must honor the discrete GCL.\n2. Use periodic boundary conditions.\n3. Initialize $q_i$ to a spatially constant value $q_0$ (dimensionless). Demonstrate that after one update, $q_i$ remains equal to $q_0$ when the discrete GCL holds and $u$ is spatially uniform.\n4. Implement a contrasting case where the discrete GCL is intentionally violated to show that the constant field is not preserved.\n5. Use a mesh interface velocity defined at faces $x_{j+1/2}$ as $w(x_{j+1/2}) = A \\,\\sin\\!\\left( 2\\pi m \\, x_{j+1/2}/L \\right)$, where $A$ (in meters per second) is an amplitude and $m$ is an integer wavenumber controlling spatial oscillations of the mesh speed. The initial face locations are uniformly spaced: $x_{j+1/2} = j \\, L/N$ for integer face index $j \\in \\{0,1,\\dots,N\\}$.\n6. Perform exactly one forward-Euler time step of size $\\Delta t$ (in seconds). The update must be conservative and must use the ALE relative speed $(u - w)$ at faces with periodic indexing. The first-order upwind choice is based on the sign of $(u - w)$ at each face.\n7. Quantify the result by computing, for each test case, the maximum absolute deviation from the initial constant value $q_0$ after the update: $\\max_i \\left| q_i^{n+1} - q_0 \\right|$. Then compare this deviation to a tolerance of $\\varepsilon = 10^{-12}$ (dimensionless) and produce a boolean result: return $\\,\\text{True}\\,$ if the deviation is less than or equal to $\\varepsilon$, and $\\,\\text{False}\\,$ otherwise.\n\nTest Suite:\nProvide and evaluate the following five test cases, each specified as a tuple $(N, L, u, A, m, \\Delta t, q_0, \\text{gcl})$, where $\\text{gcl}$ is a boolean indicating whether to enforce the discrete GCL in the update ($\\text{True}$) or to intentionally violate it ($\\text{False}$):\n- Case 1 (nontrivial moving mesh, ALE happy path): $(128, 1.0, 0.7, 0.3, 3, 0.001, 2.0, \\text{True})$.\n- Case 2 (pure mesh motion, zero physical advection): $(64, 1.0, 0.0, 0.5, 1, 0.002, 1.0, \\text{True})$.\n- Case 3 (strong mesh oscillation, sign changes in relative speed): $(100, 1.0, 0.1, 0.9, 5, 0.0005, -3.0, \\text{True})$.\n- Case 4 (static mesh, Eulerian limit): $(80, 1.0, 0.4, 0.0, 0, 0.005, 0.37, \\text{True})$.\n- Case 5 (intentional GCL violation): $(128, 1.0, 0.3, 0.4, 2, 0.001, 1.0, \\text{False})$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the five test cases in the order listed above. Each entry must be a boolean obtained by testing whether the maximum absolute deviation is less than or equal to $\\varepsilon = 10^{-12}$. For example, the output must look like \"[True,True,True,True,False]\". No units are required in the output because the results are dimensionless booleans.",
            "solution": "The user-provided problem is assessed as valid. It is scientifically grounded in the principles of computational fluid dynamics, specifically concerning finite-volume methods on moving meshes. The problem is well-posed, with all necessary parameters, equations, and boundary conditions provided to construct a unique and meaningful numerical experiment. The objective is clear and formalizable.\n\nThe core of the problem lies in demonstrating the Geometric Conservation Law (GCL) for an Arbitrary Lagrangian-Eulerian (ALE) finite-volume scheme. We begin by deriving the numerical update equations.\n\nThe one-dimensional conservation law for a passive scalar $q(x,t)$ with a physical advection velocity $u$ is given in Eulerian form as:\n$$\n\\partial_t q + \\partial_x (u q) = 0\n$$\nWe consider a finite-volume discretization of a one-dimensional periodic domain of length $L$. The domain is partitioned into $N$ cells, indexed by $i \\in \\{0, 1, \\dots, N-1\\}$. Cell $i$ is defined by the moving interval $[x_i(t), x_{i+1}(t)]$, where $x_i(t)$ and $x_{i+1}(t)$ are the positions of the cell's left and right faces, respectively. The size of cell $i$ is $J_i(t) = x_{i+1}(t) - x_i(t)$. The cell-averaged quantity $q_i(t)$ is defined as:\n$$\nq_i(t) = \\frac{1}{J_i(t)} \\int_{x_i(t)}^{x_{i+1}(t)} q(x,t) \\, dx\n$$\nIntegrating the conservation law over the moving cell $i$ and applying the Leibniz integral rule yields the exact evolution equation for the total amount of scalar in the cell, $J_i q_i$:\n$$\n\\frac{d}{dt}(J_i q_i) = - \\left( (u-w)q \\right)_{i+1} + \\left( (u-w)q \\right)_{i}\n$$\nHere, $w(x,t) = dx/dt$ is the mesh velocity, so $w_j(t)$ is the velocity of face $j$. The term $F_{ALE} = (u-w)q$ is the ALE flux, which represents the flux of $q$ relative to the moving cell boundary.\n\nWe discretize this semi-discrete equation in time using a first-order explicit (forward Euler) scheme with a time step $\\Delta t$:\n$$\n\\frac{J_i^{n+1} q_i^{n+1} - J_i^n q_i^n}{\\Delta t} = - \\left( \\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n \\right)\n$$\nwhere the superscript $n$ denotes the time level $t^n$, and $\\mathcal{F}_j^n$ is the numerical approximation to the ALE flux at face $j$ at time $t^n$. This can be rearranged to form the update equation for the conserved quantity $J_i q_i$:\n$$\nJ_i^{n+1} q_i^{n+1} = J_i^n q_i^n - \\Delta t \\left( \\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n \\right)\n$$\nThe problem specifies a first-order upwind flux. The relative velocity at face $j$ is $v_{rel,j} = u - w_j$, where $u$ is constant. The upwind flux at face $j$ (between cell $j-1$ on the left and cell $j$ on the right) is determined by the sign of $v_{rel,j}$:\n$$\n\\mathcal{F}_j^n = v_{rel,j}^n q_{j, \\text{upwind}}^n = \\begin{cases} v_{rel,j}^n q_{j-1}^n & \\text{if } v_{rel,j}^n \\ge 0 \\\\ v_{rel,j}^n q_j^n & \\text{if } v_{rel,j}^n < 0 \\end{cases}\n$$\nThe evolution of the cell size $J_i$ must also be handled correctly. The time derivative of the cell size is $\\frac{dJ_i}{dt} = \\frac{dx_{i+1}}{dt} - \\frac{dx_i}{dt} = w_{i+1} - w_i$. Discretizing this with forward Euler gives the discrete Geometric Conservation Law (GCL):\n$$\n\\frac{J_i^{n+1} - J_i^n}{\\Delta t} = w_{i+1}^n - w_i^n \\quad \\implies \\quad J_i^{n+1} = J_i^n + \\Delta t (w_{i+1}^n - w_i^n)\n$$\nTo obtain the updated cell average $q_i^{n+1}$, we divide the updated conserved quantity by the updated cell size:\n$$\nq_i^{n+1} = \\frac{J_i^n q_i^n - \\Delta t (\\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n)}{J_i^{n+1}}\n$$\nCrucially, for the GCL to hold, $J_i^{n+1}$ in the denominator must be computed using its own evolution equation, as derived above.\n\nNow, we test the scheme's ability to preserve a constant state, a \"freestream preservation\" property. Let the initial state be spatially constant: $q_i^n = q_0$ for all $i$. For any face $j$, the states in the adjacent cells are identical, $q_{j-1}^n = q_j^n = q_0$. Therefore, the upwind state is always $q_0$, regardless of the sign of the relative velocity $v_{rel,j}$. The numerical flux simplifies to:\n$$\n\\mathcal{F}_j^n = v_{rel,j}^n q_0 = (u - w_j^n) q_0\n$$\nSubstituting this into the update for the conserved quantity:\n$$\nJ_i^{n+1} q_i^{n+1} = J_i^n q_0 - \\Delta t \\left( (u - w_{i+1}^n)q_0 - (u - w_i^n)q_0 \\right)\n$$\nFactoring out $q_0$ and simplifying the flux difference:\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n - \\Delta t \\left( u - w_{i+1}^n - u + w_i^n \\right) \\right]\n$$\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n - \\Delta t \\left( - (w_{i+1}^n - w_i^n) \\right) \\right]\n$$\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n + \\Delta t (w_{i+1}^n - w_i^n) \\right]\n$$\nThe term in the square brackets is precisely the expression for the new cell size $J_i^{n+1}$ according to the discrete GCL. Therefore, if the GCL is enforced:\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 J_i^{n+1}\n$$\nThis leads to $q_i^{n+1} = q_0$ (assuming $J_i^{n+1} \\neq 0$), demonstrating that the constant state is perfectly preserved.\n\nIn contrast, if the GCL is violated, for instance by incorrectly assuming the cell sizes are static ($J_i^{n+1} = J_i^n$), the update becomes:\n$$\nq_i^{n+1} = \\frac{q_0 \\left[ J_i^n + \\Delta t (w_{i+1}^n - w_i^n) \\right]}{J_i^n} = q_0 \\left( 1 + \\frac{\\Delta t}{J_i^n} (w_{i+1}^n - w_i^n) \\right)\n$$\nSince the mesh velocity $w$ is not uniform (for $A \\neq 0$ and $m \\neq 0$), the term $w_{i+1}^n - w_i^n$ is generally non-zero, leading to $q_i^{n+1} \\neq q_0$. This generates spurious sources or sinks of the scalar quantity, violating conservation.\n\nThe implementation will simulate one time step for each test case.\n1. Initialize a uniform grid with $N$ cells and $N+1$ faces over a periodic domain of length $L$. The initial cell size is $J_i^n = L/N$.\n2. Initialize the scalar field $q_i^n = q_0$ for all cells.\n3. Calculate the mesh velocities $w_j^n = A \\sin(2\\pi m x_j/L)$ at each of the $N+1$ face locations $x_j$.\n4. Compute the upwind ALE numerical fluxes $\\mathcal{F}_j^n$ at all faces, handling periodic boundaries correctly.\n5. Compute the new cell size $J_i^{n+1}$. If the `gcl` flag is `True`, use the GCL update $J_i^{n+1} = J_i^n + \\Delta t (w_{i+1}^n - w_i^n)$. If `False`, set $J_i^{n+1} = J_i^n$.\n6. Compute the new cell average $q_i^{n+1}$ using the main update formula.\n7. Calculate the maximum absolute deviation $\\max_i |q_i^{n+1} - q_0|$ and compare it against the tolerance $\\varepsilon = 10^{-12}$.\nThe results of this comparison for the specified test cases will be provided.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(N, L, u, A, m, dt, q0, enforce_gcl):\n    \"\"\"\n    Performs one time step of an ALE finite-volume scheme and checks for GCL property.\n\n    Args:\n        N (int): Number of cells.\n        L (float): Domain length.\n        u (float): Spatially uniform physical advection velocity.\n        A (float): Amplitude of mesh interface velocity.\n        m (int): Wavenumber of mesh interface velocity.\n        dt (float): Time step size.\n        q0 (float): Initial spatially constant scalar value.\n        enforce_gcl (bool): If True, enforces the discrete GCL. If False, violates it.\n\n    Returns:\n        float: The maximum absolute deviation from the initial constant value q0.\n    \"\"\"\n    # 1. Initialize grid and scalar field\n    # N+1 faces from j=0 to N. Face j is at position x_faces[j].\n    x_faces = np.linspace(0.0, L, N + 1)\n    \n    # N cells. Cell i is between face i and face i+1.\n    # Initial cell sizes J (metric) are uniform.\n    J_old = np.full(N, L / N)\n    \n    # Initial scalar field q is constant at q0.\n    q_old = np.full(N, q0)\n\n    # 2. Calculate mesh velocities at faces\n    # w_faces[j] is the velocity of face j.\n    w_faces = A * np.sin(2 * np.pi * m * x_faces / L)\n\n    # 3. Compute ALE first-order upwind numerical fluxes\n    # Relative velocity at faces\n    v_rel_faces = u - w_faces\n    \n    # To compute fluxes at N+1 faces, we need the states from the left and right cells.\n    # We use periodic boundary conditions.\n    # For face j, the left state is q[j-1] and the right state is q[j].\n    # q_left_vals[j] = q[j-1], q_right_vals[j] = q[j] (with periodic wrap-around)\n    q_left_vals = np.concatenate(([q_old[-1]], q_old[:-1]))\n    q_right_vals = q_old\n    \n    # Compute upwind flux at each of the N+1 faces\n    # F(j) = v_rel(j) * q_upwind(j)\n    # The upwind state for face j is q_left_vals[j] if v_rel >= 0, and q_right_vals[j-1] if v_rel  0\n    # due to indexing. A simpler way is to use np.where.\n    # For face j, between cells j-1 and j:\n    q_at_faces = np.where(v_rel_faces >= 0, np.roll(q_old, 1), q_old)\n    # This construction has an off-by-one issue with periodic boundaries. Let's be explicit.\n    # For face j (index j), left cell is j-1, right cell is j.\n    q_upwind_at_faces = np.zeros(N+1)\n    for j in range(N+1):\n        if v_rel_faces[j] >= 0:\n            # upwind is from the left cell (index j-1)\n            q_upwind_at_faces[j] = q_old[(j-1+N)%N]\n        else:\n            # upwind is from the right cell (index j)\n            q_upwind_at_faces[j] = q_old[j%N]\n\n    F_faces = v_rel_faces * q_upwind_at_faces\n    \n    # 4. Update cell sizes (metric)\n    if enforce_gcl:\n        # GCL holds: update cell sizes based on face velocities\n        # w_diff[i] = w[i+1] - w[i]\n        w_diff = w_faces[1:] - w_faces[:-1]\n        J_new = J_old + dt * w_diff\n    else:\n        # GCL is violated: cell sizes are assumed to be static\n        J_new = J_old.copy()\n        \n    # Check for mesh tangling, though not expected for these parameters.\n    # If any J_new is non-positive, the result is invalid.\n    if np.any(J_new = 0):\n        # Return a large error to indicate failure if this unlikely event occurs.\n        return np.inf\n\n    # 5. Update the scalar field\n    # The change in the conserved quantity J*q in cell i is due to flux difference\n    # flux_diff[i] = F[i+1] - F[i]\n    flux_diff = F_faces[1:] - F_faces[:-1]\n    \n    # Update the conserved quantity J*q\n    qJ_new = J_old * q_old - dt * flux_diff\n    \n    # Get the new cell-averaged scalar value\n    q_new = qJ_new / J_new\n\n    # 6. Calculate the maximum deviation\n    max_deviation = np.max(np.abs(q_new - q0))\n    \n    return max_deviation\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N, L, u, A, m, dt, q0, gcl)\n        (128, 1.0, 0.7, 0.3, 3, 0.001, 2.0, True),\n        (64, 1.0, 0.0, 0.5, 1, 0.002, 1.0, True),\n        (100, 1.0, 0.1, 0.9, 5, 0.0005, -3.0, True),\n        (80, 1.0, 0.4, 0.0, 0, 0.005, 0.37, True),\n        (128, 1.0, 0.3, 0.4, 2, 0.001, 1.0, False),\n    ]\n\n    epsilon = 1e-12\n    results = []\n    \n    for case in test_cases:\n        N, L, u, A, m, dt, q0, gcl = case\n        deviation = run_simulation(N, L, u, A, m, dt, q0, gcl)\n        results.append(deviation = epsilon)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Once a scheme is designed to be consistent by satisfying the GCL, its practical application depends on numerical stability. For explicit time-stepping methods, this is governed by the Courant-Friedrichs-Lewy (CFL) condition, which must be extended in the ALE context to account for the relative velocity between the fluid and the moving mesh. This practice provides essential experience in deriving the maximum stable time step by combining the advective CFL constraint with a separate constraint for maintaining mesh geometric integrity .",
            "id": "3897512",
            "problem": "Consider a two-dimensional, depth-averaged estuarine transport model discretized by an explicit Finite-Volume Method (FVM) on an unstructured planar mesh whose nodes are advanced by an Arbitrary Lagrangian-Eulerian (ALE) mesh motion. The prognostic conserved scalar satisfies a local conservation law over each moving control volume. The advective flux across a face depends on the fluid velocity relative to the face motion. Let the fluid velocity field be denoted by $\\boldsymbol{u}(\\boldsymbol{x},t)$ and the mesh velocity field by $\\boldsymbol{w}(\\boldsymbol{x},t)$, and let faces be characterized by unit outward normals $\\boldsymbol{n}$ and edge lengths.\n\nYou are given scientifically plausible bounds and geometric minima sufficient to determine a conservative explicit time-step stability constraint for this ALE FVM:\n- A uniform bound on the fluid speed magnitude: $\\|\\boldsymbol{u}\\| \\leq 1.5 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$.\n- A uniform bound on the mesh speed magnitude: $\\|\\boldsymbol{w}\\| \\leq 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$.\n- A global minimal edge length across all faces in the mesh: $L_{\\min} = 25 \\ \\mathrm{m}$.\n\nAssume the explicit FVM uses a second-order monotone flux limiting in space and time such that its domain-of-dependence requirement is enforced by a Courant-type constant $C_{\\mathrm{adv}} = 0.5$, and that the mesh motion is restricted to avoid face crossing and to satisfy a discrete geometric conservation constraint by limiting nodal displacements per step with $C_{\\mathrm{mesh}} = 0.3$.\n\nStarting from first principles of local conservation and the domain-of-dependence argument, derive conservative constraints on the time step $\\Delta t$ that ensure stability of the explicit ALE fluxes over all faces when only the given bounds and $L_{\\min}$ are available, and then compute the maximum stable time step $\\Delta t_{\\max}$ implied by the combination of these constraints.\n\nExpress your final answer in seconds. Round your numerical answer to three significant figures.",
            "solution": "The problem requires the derivation of a maximum stable time step, $\\Delta t_{\\max}$, for an explicit Arbitrary Lagrangian-Eulerian (ALE) Finite-Volume Method (FVM). The stability of such a scheme is governed by two primary constraints: one related to the numerical stability of the advection operator (the CFL condition), and another related to maintaining the geometric integrity of the moving mesh. We must derive the mathematical form of each constraint from first principles and then combine them to find the most restrictive limit.\n\nLet the conserved scalar quantity be denoted by $c$. The integral form of the conservation law in an ALE framework for a time-varying control volume $V_i(t)$ is given by the Reynolds transport theorem:\n$$\n\\frac{d}{dt} \\int_{V_i(t)} c \\, dV = - \\oint_{\\partial V_i(t)} \\boldsymbol{F}_{\\text{adv}} \\cdot \\boldsymbol{n} \\, dA\n$$\nwhere source/sink terms are neglected as they do not typically affect the time-step constraint for explicit advection. The advective flux vector $\\boldsymbol{F}_{\\text{adv}}$ is given by $\\boldsymbol{F}_{\\text{adv}} = c(\\boldsymbol{u} - \\boldsymbol{w})$, where $\\boldsymbol{u}$ is the fluid velocity, $\\boldsymbol{w}$ is the mesh velocity, and $\\boldsymbol{n}$ is the unit outward normal on the boundary $\\partial V_i(t)$. The term $\\boldsymbol{u} - \\boldsymbol{w}$ is the relative velocity of the fluid with respect to the moving cell boundary.\n\n**1. Advective Stability Constraint (CFL Condition)**\nAn explicit time-stepping scheme is stable only if the numerical domain of dependence for a grid cell contains the physical domain of dependence. This is the Courant-Friedrichs-Lewy (CFL) condition. For an advection problem, it means that in a time step $\\Delta t$, a particle of the fluid should not travel a distance greater than the characteristic size of a mesh cell. The characteristic speed of information propagation is determined by the fluid velocity relative to the mesh.\n\nThe speed of advection normal to a cell face is given by $|(\\boldsymbol{u} - \\boldsymbol{w}) \\cdot \\boldsymbol{n}|$. To derive a conservative, globally applicable time-step limit, we must consider the maximum possible value of this speed across the entire computational domain and for all time.\nLet $v_{\\text{char}} = |(\\boldsymbol{u} - \\boldsymbol{w}) \\cdot \\boldsymbol{n}|$. Using the Cauchy-Schwarz inequality and the fact that $\\boldsymbol{n}$ is a unit vector ($\\|\\boldsymbol{n}\\| = 1$):\n$$\nv_{\\text{char}} \\le \\|\\boldsymbol{u} - \\boldsymbol{w}\\| \\|\\boldsymbol{n}\\| = \\|\\boldsymbol{u} - \\boldsymbol{w}\\|\n$$\nNext, applying the triangle inequality to $\\|\\boldsymbol{u} - \\boldsymbol{w}\\|$:\n$$\n\\|\\boldsymbol{u} - \\boldsymbol{w}\\| \\le \\|\\boldsymbol{u}\\| + \\|-\\boldsymbol{w}\\| = \\|\\boldsymbol{u}\\| + \\|\\boldsymbol{w}\\|\n$$\nThe maximum characteristic speed, $v_{\\text{char, max}}$, is therefore bounded by the sum of the maximum fluid speed, $U_{\\max} = \\sup \\|\\boldsymbol{u}\\|$, and the maximum mesh speed, $W_{\\max} = \\sup \\|\\boldsymbol{w}\\|$. This worst-case scenario occurs when the fluid and mesh velocities are at their maxima and directed oppositely.\n$$\nv_{\\text{char, max}} \\le U_{\\max} + W_{\\max}\n$$\nThe CFL condition states that the distance traveled by a wave or particle in one time step, $v_{\\text{char, max}} \\Delta t$, must be less than or equal to a fraction of the characteristic grid size, $L_{\\text{char}}$. This fraction is the Courant number, $C_{\\text{adv}}$.\n$$\n(U_{\\max} + W_{\\max}) \\Delta t \\le C_{\\text{adv}} L_{\\text{char}}\n$$\nFor a conservative global time step on an unstructured mesh, the characteristic length $L_{\\text{char}}$ is taken as the smallest length scale, which is the given global minimal edge length, $L_{\\min}$. This yields the first constraint on $\\Delta t$:\n$$\n\\Delta t \\le \\Delta t_{\\text{adv}} = \\frac{C_{\\text{adv}} L_{\\min}}{U_{\\max} + W_{\\max}}\n$$\nSubstituting the given values: $C_{\\text{adv}} = 0.5$, $L_{\\min} = 25 \\ \\mathrm{m}$, $U_{\\max} = 1.5 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$, and $W_{\\max} = 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$:\n$$\n\\Delta t_{\\text{adv}} = \\frac{0.5 \\times 25}{1.5 + 0.4} = \\frac{12.5}{1.9} \\ \\mathrm{s} \\approx 6.5789 \\ \\mathrm{s}\n$$\n\n**2. Mesh Geometric Integrity Constraint**\nIn an ALE simulation, the mesh vertices move. If they move too far in a single time step, cells can become inverted (volume becomes negative) or severely distorted, causing the simulation to fail. To prevent this, the displacement of any node in one time step must be limited to a fraction of the size of the smallest adjacent element.\nThe maximum displacement of a node during a time step $\\Delta t$ is bounded by $W_{\\max} \\Delta t$. The problem specifies that this displacement is limited by a constant $C_{\\text{mesh}}$ relative to a characteristic length. To maintain mesh quality globally, this length must again be the most restrictive one, $L_{\\min}$.\nThe constraint is therefore:\n$$\nW_{\\max} \\Delta t \\le C_{\\text{mesh}} L_{\\min}\n$$\nThis gives the second constraint on $\\Delta t$:\n$$\n\\Delta t \\le \\Delta t_{\\text{mesh}} = \\frac{C_{\\text{mesh}} L_{\\min}}{W_{\\max}}\n$$\nSubstituting the given values: $C_{\\text{mesh}} = 0.3$, $L_{\\min} = 25 \\ \\mathrm{m}$, and $W_{\\max} = 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$:\n$$\n\\Delta t_{\\text{mesh}} = \\frac{0.3 \\times 25}{0.4} = \\frac{7.5}{0.4} = 18.75 \\ \\mathrm{s}\n$$\n\n**3. Maximum Stable Time Step**\nThe overall time step $\\Delta t$ for the simulation must satisfy both the advective stability and the mesh geometry constraints to be valid. Therefore, the maximum stable time step, $\\Delta t_{\\max}$, is the minimum of the two derived upper bounds:\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{mesh}})\n$$\n$$\n\\Delta t_{\\max} = \\min \\left( \\frac{12.5}{1.9}, 18.75 \\right) \\ \\mathrm{s}\n$$\nNumerically, $\\Delta t_{\\text{adv}} \\approx 6.5789 \\ \\mathrm{s}$ and $\\Delta t_{\\text{mesh}} = 18.75 \\ \\mathrm{s}$. The more restrictive constraint is the advective CFL condition.\n$$\n\\Delta t_{\\max} = \\frac{12.5}{1.9} \\ \\mathrm{s} \\approx 6.578947... \\ \\mathrm{s}\n$$\nThe problem asks for the numerical answer rounded to three significant figures.\n$$\n\\Delta t_{\\max} \\approx 6.58 \\ \\mathrm{s}\n$$",
            "answer": "$$\\boxed{6.58}$$"
        },
        {
            "introduction": "The ultimate test of a numerical model is its ability to reproduce known solutions, which serves to validate the underlying implementation. For environmental systems with moving boundaries, such as coastal inundation, analytical benchmarks are invaluable for verifying that an ALE framework correctly handles domain evolution and conserves mass. This final practice guides you through the creation of a classic moving shoreline benchmark, from deriving the analytical solution for geometric quantities to defining metrics that rigorously test a model's GCL compliance and conservation fidelity .",
            "id": "3897623",
            "problem": "Consider a one-dimensional cross-shore transect with a straight, planar beach. Let the bed elevation be defined by $z_b(x) = \\alpha x$ in meters, where $x \\ge 0$ is the offshore coordinate normal to the shoreline and $\\alpha  0$ is the constant bed slope (meters per meter). The free surface elevation is a prescribed analytic function\n$$\n\\eta(t) = \\eta_0 + A \\sin(\\omega t + \\phi),\n$$\nwith $\\eta_0$ in meters, $A$ in meters, $\\omega$ in radians per second, and $\\phi$ in radians. The instantaneous wetted cross-shore domain is the interval $x \\in [0, x_s(t)]$ where the shoreline position $x_s(t)$ is determined by the condition $h(x_s(t), t) = \\eta(t) - z_b(x_s(t)) = 0$. The water depth is $h(x,t) = \\eta(t) - \\alpha x$ for $x \\in [0, x_s(t)]$ and $h(x,t) = 0$ otherwise. Assume lateral uniformity (unit width), no horizontal currents, and that the only motion arises from the time-varying free surface.\n\nAn Arbitrary Lagrangian-Eulerian (ALE) mapping is defined from a fixed computational coordinate $\\xi \\in [0,1]$ to physical space by $x(\\xi,t) = x_s(t)\\,\\xi$. The mesh velocity is $w(x,t)$ and the Jacobian of the mapping is $J(\\xi,t) = \\partial x/\\partial \\xi$. The Geometric Conservation Law (GCL) in one spatial dimension is given by\n$$\n\\frac{\\partial J}{\\partial t} = J \\, \\frac{\\partial w}{\\partial x}.\n$$\n\nStarting from the fundamental kinematic definitions ($v = dx/dt$), calculus identities for variable integration limits (Leibniz integral rule), and the ALE geometric mapping definitions, do the following:\n\n1. Derive the analytic expressions for the shoreline position $x_s(t)$, its time derivative $dx_s/dt$, the wetted area per unit width $A_w(t) = \\int_{0}^{x_s(t)} h(x,t) \\, dx$ in square meters, and its time derivative $dA_w/dt$ in square meters per second, in terms of $\\eta(t)$, $d\\eta/dt$, and $\\alpha$. Treat the physically dry state rigorously: if $\\eta(t) \\le 0$, then the shoreline is at $x_s(t) = 0$, $A_w(t) = 0$, and $dA_w/dt = 0$.\n\n2. For the ALE mapping $x(\\xi,t)=x_s(t)\\,\\xi$, express the mesh velocity $w(x,t)$ in terms of $x_s(t)$ and $dx_s/dt$, and use it to compute the GCL residual\n$$\nr(t) = \\frac{\\partial J}{\\partial t} - J \\, \\frac{\\partial w}{\\partial x}.\n$$\nProvide the expression for $r(t)$ and explain its expected value for the given mapping, including the dry state $x_s(t) = 0$.\n\n3. Define a uniform passive tracer with constant concentration $q_0 = 1$ (dimensionless per unit volume), so that the tracer mass per unit width is $M_q(t) = q_0 \\, A_w(t)$ in square meters (interpretable as volume per unit width). Show how conservation under mesh motion implies that the expected mass change over any interval $[0,T]$ must satisfy\n$$\nM_q(T) - M_q(0) = \\int_{0}^{T} q_0 \\, \\frac{dA_w}{dt}(t)\\, dt,\n$$\nand specify the expected residual for exact GCL compliance.\n\n4. For the following test suite, implement a program that evaluates these quantities on a uniform time grid with $N$ steps on the interval $[0,T]$. For each test case, compute and report the following metrics:\n   - The total area change $\\Delta A_w = A_w(T) - A_w(0)$ in square meters.\n   - The maximum GCL residual $R_{\\mathrm{GCL}} = \\max_{k=0,\\dots,N} |r(t_k)|$ (dimensionless in this formulation).\n   - The periodicity residual $R_{\\mathrm{per}} = |A_w(T) - A_w(0)|$ in square meters when $T$ is an integer number of free-surface periods.\n   - The uniform tracer mass consistency residual $R_{\\mathrm{mass}} = \\left|M_q(T) - M_q(0) - \\int_0^T q_0 \\, \\frac{dA_w}{dt}(t)\\, dt\\right|$ in square meters, using the trapezoidal rule for the integral.\n\nPhysical units must be used explicitly: lengths in meters, times in seconds, angles in radians, and areas in square meters. Express all outputs in square meters for area-based quantities and as decimal floats without percentage signs. The angle unit is radians. Use the following test suite:\n   - Case 1 (nominal, two periods): $\\alpha = 1\\times 10^{-3}\\ \\mathrm{m/m}$, $\\eta_0 = 1.2\\ \\mathrm{m}$, $A = 0.3\\ \\mathrm{m}$, $\\omega = 2\\pi/3600\\ \\mathrm{rad/s}$, $\\phi = 0\\ \\mathrm{rad}$, $T = 2 \\times (2\\pi/\\omega)\\ \\mathrm{s}$, $N = 1000$.\n   - Case 2 (boundary dryness, one period): $\\alpha = 2\\times 10^{-3}\\ \\mathrm{m/m}$, $\\eta_0 = 0.05\\ \\mathrm{m}$, $A = 0.05\\ \\mathrm{m}$, $\\omega = 2\\pi/600\\ \\mathrm{rad/s}$, $\\phi = 0\\ \\mathrm{rad}$, $T = 2\\pi/\\omega\\ \\mathrm{s}$, $N = 600$.\n   - Case 3 (high frequency, small amplitude, ten periods): $\\alpha = 1\\times 10^{-3}\\ \\mathrm{m/m}$, $\\eta_0 = 0.5\\ \\mathrm{m}$, $A = 1\\times 10^{-3}\\ \\mathrm{m}$, $\\omega = 2\\pi/1\\ \\mathrm{rad/s}$, $\\phi = 0\\ \\mathrm{rad}$, $T = 10 \\times (2\\pi/\\omega)\\ \\mathrm{s}$, $N = 10000$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one sublist per test case in the order above. Each sublist must contain the four floats $[\\Delta A_w, R_{\\mathrm{GCL}}, R_{\\mathrm{per}}, R_{\\mathrm{mass}}]$ in that order. For example: \"[[delta1,gcl1,per1,mass1],[delta2,gcl2,per2,mass2],[delta3,gcl3,per3,mass3]]\".",
            "solution": "The user-provided problem statement has been critically validated and found to be self-contained, scientifically grounded, and well-posed. It presents a standard problem in computational fluid dynamics related to moving boundaries, specifically the Arbitrary Lagrangian-Eulerian (ALE) method and the associated Geometric Conservation Law (GCL). The problem is solvable through rigorous mathematical derivation and subsequent numerical implementation.\n\n### Part 1: Derivations of Kinematic and Geometric Quantities\n\nThe problem defines a one-dimensional domain with bed elevation $z_b(x) = \\alpha x$ and free surface elevation $\\eta(t) = \\eta_0 + A \\sin(\\omega t + \\phi)$. The water depth is $h(x,t) = \\eta(t) - z_b(x)$.\n\n**Shoreline Position, $x_s(t)$**\nThe shoreline position $x_s(t)$ is defined by the zero-depth condition, $h(x_s(t), t) = 0$. This gives $\\eta(t) - \\alpha x_s(t) = 0$. This equation is valid only when the domain is wet, which requires the free surface to be above the lowest point of the domain ($z_b(0)=0$), i.e., $\\eta(t)  0$. Solving for $x_s(t)$ yields $x_s(t) = \\eta(t) / \\alpha$. The problem provides a rigorous definition for the dry state: if $\\eta(t) \\le 0$, then $x_s(t)=0$. Combining these two conditions, the shoreline position can be expressed for all time as:\n$$\nx_s(t) = \\frac{\\max(0, \\eta(t))}{\\alpha}\n$$\n\n**Shoreline Velocity, $dx_s/dt$**\nThe time derivative of the shoreline position is found by differentiating the expression for $x_s(t)$. This must be handled piecewise due to the $\\max$ function.\nIf $\\eta(t)  0$, then $x_s(t) = \\eta(t)/\\alpha$, and its derivative is $\\frac{dx_s}{dt} = \\frac{1}{\\alpha}\\frac{d\\eta}{dt}$.\nIf $\\eta(t) \\le 0$, then $x_s(t) = 0$, and its derivative is $\\frac{dx_s}{dt} = 0$.\nThe time derivative of the free surface elevation is $\\frac{d\\eta}{dt} = A\\omega\\cos(\\omega t + \\phi)$.\nThe complete expression for the shoreline velocity is:\n$$\n\\frac{dx_s}{dt}(t) = \\begin{cases} \\frac{1}{\\alpha}\\frac{d\\eta}{dt}  \\text{if } \\eta(t)  0 \\\\ 0  \\text{if } \\eta(t) \\le 0 \\end{cases}\n$$\n\n**Wetted Area per Unit Width, $A_w(t)$**\nThe wetted area per unit width, $A_w(t)$, is the integral of the water depth over the wetted domain $[0, x_s(t)]$.\n$$\nA_w(t) = \\int_{0}^{x_s(t)} h(x,t) \\, dx = \\int_{0}^{x_s(t)} (\\eta(t) - \\alpha x) \\, dx\n$$\nFor a wetted state ($\\eta(t)  0$), we evaluate the integral:\n$$\nA_w(t) = \\left[ \\eta(t)x - \\frac{1}{2}\\alpha x^2 \\right]_{0}^{x_s(t)} = \\eta(t)x_s(t) - \\frac{1}{2}\\alpha (x_s(t))^2\n$$\nSubstituting $x_s(t) = \\eta(t)/\\alpha$:\n$$\nA_w(t) = \\eta(t)\\left(\\frac{\\eta(t)}{\\alpha}\\right) - \\frac{1}{2}\\alpha\\left(\\frac{\\eta(t)}{\\alpha}\\right)^2 = \\frac{(\\eta(t))^2}{\\alpha} - \\frac{(\\eta(t))^2}{2\\alpha} = \\frac{(\\eta(t))^2}{2\\alpha}\n$$\nFor the dry state ($\\eta(t) \\le 0$), the problem states $A_w(t) = 0$. This gives the complete expression:\n$$\nA_w(t) = \\frac{(\\max(0, \\eta(t)))^2}{2\\alpha}\n$$\n\n**Rate of Change of Wetted Area, $dA_w/dt$**\nThe rate of change of the wetted area can be found using the Leibniz integral rule on the definition of $A_w(t)$:\n$$\n\\frac{dA_w}{dt} = \\frac{d}{dt} \\int_{0}^{x_s(t)} h(x,t) \\, dx = h(x_s(t),t) \\frac{dx_s}{dt} + \\int_{0}^{x_s(t)} \\frac{\\partial h}{\\partial t}(x,t) \\, dx\n$$\nBy definition, the depth at the shoreline is zero, $h(x_s(t),t)=0$, so the first term vanishes. The partial derivative of the depth is $\\frac{\\partial h}{\\partial t} = \\frac{\\partial}{\\partial t}(\\eta(t) - \\alpha x) = \\frac{d\\eta}{dt}$. Thus:\n$$\n\\frac{dA_w}{dt} = \\int_{0}^{x_s(t)} \\frac{d\\eta}{dt} \\, dx = \\frac{d\\eta}{dt} \\int_{0}^{x_s(t)} dx = x_s(t) \\frac{d\\eta}{dt}\n$$\nThis expression holds for all cases. If $\\eta(t) \\le 0$, then $x_s(t) = 0$, which correctly yields $dA_w/dt = 0$, consistent with the problem statement. When $\\eta(t)0$, it becomes $\\frac{dA_w}{dt} = \\frac{\\eta(t)}{\\alpha}\\frac{d\\eta}{dt}$.\n\n### Part 2: Arbitrary Lagrangian-Eulerian (ALE) Formulation and GCL\n\n**Mesh Velocity, $w(x,t)$**\nThe ALE mapping is given by $x(\\xi,t) = x_s(t)\\,\\xi$ for a fixed computational coordinate $\\xi \\in [0,1]$. The mesh velocity is the velocity of a point of constant $\\xi$:\n$$\nw(\\xi, t) = \\left. \\frac{\\partial x}{\\partial t} \\right|_{\\xi} = \\frac{\\partial}{\\partial t} (x_s(t)\\,\\xi) = \\frac{dx_s}{dt} \\xi\n$$\nTo express this in physical coordinates $(x,t)$, we invert the mapping: $\\xi = x/x_s(t)$ (for $x_s(t)0$). Substituting this gives:\n$$\nw(x,t) = \\frac{dx_s}{dt} \\frac{x}{x_s(t)}\n$$\nThis mapping describes a mesh that linearly stretches or compresses to follow the shoreline motion.\n\n**Geometric Conservation Law (GCL) Residual, $r(t)$**\nThe GCL is given as $\\frac{\\partial J}{\\partial t} = J \\frac{\\partial w}{\\partial x}$. The residual is $r(t) = \\frac{\\partial J}{\\partial t} - J \\frac{\\partial w}{\\partial x}$.\nFirst, we find the Jacobian of the mapping, $J(\\xi,t)$:\n$$\nJ(\\xi,t) = \\frac{\\partial x}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} (x_s(t)\\,\\xi) = x_s(t)\n$$\nThe Jacobian $J$ is a function of time only. Its time derivative is $\\frac{\\partial J}{\\partial t} = \\frac{dx_s}{dt}$.\nNext, we find the spatial gradient of the mesh velocity, $\\frac{\\partial w}{\\partial x}$:\n$$\n\\frac{\\partial w}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( x \\frac{dx_s/dt}{x_s(t)} \\right) = \\frac{dx_s/dt}{x_s(t)}\n$$\nThis is valid for $x_s(t)  0$. Now we compute the residual:\n$$\nr(t) = \\frac{dx_s}{dt} - x_s(t) \\left( \\frac{dx_s/dt}{x_s(t)} \\right) = \\frac{dx_s}{dt} - \\frac{dx_s}{dt} = 0\n$$\nFor the dry state ($x_s(t)=0$), we have $J=0$ and $dx_s/dt=0$, so the GCL becomes $0=0$, and the residual is again $r(t)=0$.\nTherefore, the GCL is satisfied exactly (analytically) for all times $t$. The expected value of the residual is $r(t)=0$. This is a crucial property, as numerical schemes that satisfy a discrete version of the GCL exactly conserve mass on moving meshes.\n\n### Part 3: Tracer Mass Conservation\n\nA uniform passive tracer has concentration $q_0=1$. The total tracer mass per unit width, $M_q(t)$, is the integral of the concentration over the wetted volume, which is $M_q(t) = q_0 A_w(t)$. As $q_0 = 1$, $M_q(t) = A_w(t)$.\nThe problem asks to show that $M_q(T) - M_q(0) = \\int_{0}^{T} q_0 \\frac{dA_w}{dt}(t)\\, dt$.\nSubstituting $M_q(t) = q_0 A_w(t)$, this equation becomes:\n$$\nq_0 A_w(T) - q_0 A_w(0) = \\int_{0}^{T} q_0 \\frac{dA_w}{dt}(t)\\, dt\n$$\nDividing by the constant $q_0$, we get:\n$$\nA_w(T) - A_w(0) = \\int_{0}^{T} \\frac{dA_w}{dt}(t)\\, dt\n$$\nThis is a direct statement of the Fundamental Theorem of Calculus for the function $A_w(t)$. The physical interpretation is that the net change in mass over an interval is equal to the time integral of the net rate of change of mass. For a purely kinematic problem with no advective or diffusive fluxes, the only way mass can change is by the expansion or contraction of the domain volume, a rate captured by $dA_w/dt$.\nThe mass consistency residual, $R_{\\mathrm{mass}} = \\left|M_q(T) - M_q(0) - \\int_0^T q_0 \\, \\frac{dA_w}{dt}(t)\\, dt\\right|$, measures the discrepancy between the change in state $(M_q(T) - M_q(0))$ and the time-integrated rate of change. Since the underlying identity is exact, any non-zero residual arises purely from the numerical error of the integration method used (here, the trapezoidal rule).\n\n### Part 4: Numerical Implementation and Metric Interpretation\n\nThe derived analytical expressions are implemented on a discrete time grid.\n- $\\Delta A_w = A_w(T) - A_w(0)$: The net change in wetted area. For all test cases, $T$ is an integer multiple of the period of $\\eta(t)$, so we expect $A_w(T) = A_w(0)$. Therefore, $\\Delta A_w$ should be zero, up to floating-point precision.\n- $R_{\\mathrm{GCL}} = \\max_{k} |r(t_k)|$: The maximum GCL residual. As derived, $r(t)=0$ analytically. Consequently, $R_{\\mathrm{GCL}}$ must be exactly $0$. This serves as a check on the correctness of the theoretical derivation.\n- $R_{\\mathrm{per}} = |A_w(T) - A_w(0)|$: The periodicity residual. This is simply the absolute value of $\\Delta A_w$. For the given periodic test cases, this should also be zero up to floating-point error.\n- $R_{\\mathrm{mass}}$: The mass consistency residual. The exact integral $\\int_0^T (dA_w/dt) dt$ is equal to $A_w(T) - A_w(0)$. Thus, $R_{\\mathrm{mass}}$ quantifies the error of the trapezoidal rule in approximating this integral. Since the true value of the integral over an integer number of periods is zero for the given forcing, $R_{\\mathrm{mass}}$ will be the absolute value of the numerical integral, which represents the trapezoidal rule's approximation error. This error is expected to be small and to decrease with a finer time grid (i.e., larger $N$).",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the moving shoreline problem using an Arbitrary Lagrangian-Eulerian (ALE)\n    framework, computes analytical quantities, and evaluates specified metrics for\n    a suite of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (nominal, two periods)\n        {'alpha': 1e-3, 'eta0': 1.2, 'A': 0.3, 'omega': 2 * np.pi / 3600, 'phi': 0.0, 'T': 2 * 3600.0, 'N': 1000},\n        # Case 2 (boundary dryness, one period)\n        {'alpha': 2e-3, 'eta0': 0.05, 'A': 0.05, 'omega': 2 * np.pi / 600, 'phi': 0.0, 'T': 600.0, 'N': 600},\n        # Case 3 (high frequency, small amplitude, ten periods)\n        {'alpha': 1e-3, 'eta0': 0.5, 'A': 1e-3, 'omega': 2 * np.pi / 1, 'phi': 0.0, 'T': 10.0, 'N': 10000},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Extract parameters for the current case\n        alpha = case['alpha']\n        eta0 = case['eta0']\n        A = case['A']\n        omega = case['omega']\n        phi = case['phi']\n        T = case['T']\n        N = case['N']\n        q0 = 1.0\n\n        # Create a uniform time grid from t=0 to t=T with N steps (N+1 points)\n        t = np.linspace(0, T, N + 1)\n        dt = T / N\n\n        # Evaluate the prescribed free surface elevation eta(t) and its time derivative\n        eta = eta0 + A * np.sin(omega * t + phi)\n        deta_dt = A * omega * np.cos(omega * t + phi)\n\n        # Apply the rigorous condition for the dry state using vectorized numpy operations\n        # eta_pos is eta(t) where it's positive, and 0 otherwise.\n        eta_pos = np.maximum(0, eta)\n\n        # Calculate shoreline position xs(t)\n        xs = eta_pos / alpha\n        \n        # Calculate wetted area Aw(t)\n        Aw = (eta_pos**2) / (2 * alpha)\n\n        # Calculate the rate of change of wetted area dAw/dt\n        # The formula dAw/dt = xs * deta_dt is valid for both wet and dry states.\n        # If the domain is dry, xs=0, so dAw/dt=0.\n        dAw_dt = xs * deta_dt\n\n        # --- Compute the required metrics ---\n\n        # 1. Total area change: Delta_Aw = Aw(T) - Aw(0)\n        delta_Aw = Aw[-1] - Aw[0]\n        \n        # 2. Maximum GCL residual: R_GCL = max|r(t_k)|\n        # As derived in the solution, the GCL residual r(t) is analytically zero\n        # for the given mapping x(xi,t) = xs(t)*xi.\n        R_gcl = 0.0\n\n        # 3. Periodicity residual: R_per = |Aw(T) - Aw(0)|\n        # Since T is an integer number of periods, Aw(T) should equal Aw(0).\n        # This residual measures the effect of floating-point precision errors.\n        R_per = np.abs(Aw[-1] - Aw[0])\n\n        # 4. Uniform tracer mass consistency residual: R_mass\n        # This residual measures the difference between the change in total mass\n        # and the time-integrated rate of mass change. It quantifies the error\n        # of the numerical integration (trapezoidal rule).\n        # Mq(t) = q0 * Aw(t)\n        # Left-hand side: Mq(T) - Mq(0)\n        mass_change_state = q0 * (Aw[-1] - Aw[0])\n        \n        # Right-hand side: integral from 0 to T of q0 * dAw/dt dt\n        # Use the trapezoidal rule as specified.\n        mass_change_integrated = np.trapz(q0 * dAw_dt, dx=dt)\n        \n        R_mass = np.abs(mass_change_state - mass_change_integrated)\n\n        # Store the results for the current case\n        results = [delta_Aw, R_gcl, R_per, R_mass]\n        all_results.append(results)\n\n    # Format the final output string according to the problem specification.\n    # e.g., \"[[delta1,gcl1,per1,mass1],[delta2,gcl2,per2,mass2],[delta3,gcl3,per3,mass3]]\"\n    result_strings = []\n    for res in all_results:\n        result_strings.append(f\"[{','.join(map(str, res))}]\")\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}