{
    "hands_on_practices": [
        {
            "introduction": "本节将引导您实现大涡模拟中最基础的Smagorinsky模型。该模型将不可解的湍流涡旋效应近似为一种增大的有效粘性，通过这个练习，您将深入理解涡粘性（$\\nu_t$）和亚格子尺度耗散（$\\varepsilon_{\\mathrm{sgs}}$）的概念，以及它们如何依赖于网格尺寸和已解流场的应变率。",
            "id": "4058479",
            "problem": "您的任务是实现一个计算模块，它以一个完整且可运行的程序形式表达，该模块在与数值天气预报和气候模拟相关的剪切驱动流的大涡模拟 (LES) 中应用 Smagorinsky 亚格子尺度闭合。\n\n从不可压缩流的滤波动量方程和解析应变率的定义出发，根据第一性原理推导出计算离散采样点上湍流涡粘性和单位质量亚格子尺度耗散所需的表达式。程序必须将这些表达式应用于一个明确定义的测试套件，并以指定的确切格式生成输出。\n\n使用以下基本依据和定义：\n- 从滤波的不可压缩 Navier–Stokes 方程和亚格子尺度 (SGS) 应力张量的定义开始。滤波动量方程引入了一个 SGS 应力 $ \\tau_{ij} $，代表未解析尺度对解析尺度的影响。\n- 解析的对称应变率张量定义为 $ S_{ij} = \\tfrac{1}{2}\\left( \\partial u_i / \\partial x_j + \\partial u_j / \\partial x_i \\right) $，其第二不变量为 $ S_{ij} S_{ij} $。\n- 对于各向异性网格，有效滤波宽度为 $ \\Delta = (\\Delta_x \\Delta_y \\Delta_z)^{1/3} $，单位为米，这是一个广泛使用的几何平均值，与大涡模拟 (LES) 中的三维顶帽滤波器一致。\n\n您的程序应实现以下任务：\n1. 根据第一性原理，基于与 Smagorinsky 模型一致的混合长度理论，推导出一个计算湍流涡粘性 $ \\nu_t $ 的算法，该算法用常数 Smagorinsky 系数 $ C_s $、有效滤波宽度 $ \\Delta $ 和解析应变率张量 $ S_{ij} $ 的不变量大小来表示。不要假设任何快捷公式；推导必须遵循量纲分析和亚格子尺度 (SGS) 应力偏量部分的涡粘性闭合。\n2. 从推导出的闭合中，获得单位质量亚格子尺度耗散 $ \\varepsilon_{\\mathrm{sgs}} $ 的表达式（定义为 $ -\\tau_{ij} S_{ij} $），确保在所选闭合下耗散特性得以保持，并正确处理各向同性部分的贡献。\n\n单位和输出要求：\n- 所有给定和计算的量必须统一使用国际单位制 (SI)。应变率分量 $ S_{ij} $ 的单位是 $ \\mathrm{s}^{-1} $，网格间距 $ \\Delta_x $、$ \\Delta_y $、$ \\Delta_z $ 的单位是 $ \\mathrm{m} $，Smagorinsky 系数 $ C_s $ 是无量纲的，涡粘性 $ \\nu_t $ 必须以 $ \\mathrm{m}^2\\,\\mathrm{s}^{-1} $ 表示，单位质量耗散 $ \\varepsilon_{\\mathrm{sgs}} $ 必须以 $ \\mathrm{m}^2\\,\\mathrm{s}^{-3} $ 表示。\n- 本问题不涉及角度。\n- 您的最终数值输出必须四舍五入到六位小数。\n\n测试套件：\n为以下五个独立案例中的每一个计算 $ \\nu_t $ 和 $ \\varepsilon_{\\mathrm{sgs}} $。每个案例提供一个采样点上的对称解析应变率张量 $ S_{ij} $ 和网格间距，以及 Smagorinsky 系数 $ C_s $：\n- 案例 $A$（一般剪切，各向异性网格）：\n  - $ \\Delta_x = 10\\,\\mathrm{m} $, $ \\Delta_y = 10\\,\\mathrm{m} $, $ \\Delta_z = 5\\,\\mathrm{m} $, $ C_s = 0.17 $.\n  - $ S_{ij} $ 分量，单位 $ \\mathrm{s}^{-1} $：$ S_{11} = 0 $, $ S_{22} = 0 $, $ S_{33} = 0 $, $ S_{12} = S_{21} = 0.5 $, $ S_{23} = S_{32} = 0.2 $, $ S_{13} = S_{31} = 0 $.\n- 案例 $B$（零应变边缘情况）：\n  - $ \\Delta_x = 20\\,\\mathrm{m} $, $ \\Delta_y = 20\\,\\mathrm{m} $, $ \\Delta_z = 20\\,\\mathrm{m} $, $ C_s = 0.17 $.\n  - $ S_{ij} $ 分量：所有条目均为 $ 0\\,\\mathrm{s}^{-1} $。\n- 案例 $C$（强各向异性和更强剪切）：\n  - $ \\Delta_x = 50\\,\\mathrm{m} $, $ \\Delta_y = 50\\,\\mathrm{m} $, $ \\Delta_z = 5\\,\\mathrm{m} $, $ C_s = 0.17 $.\n  - $ S_{ij} $ 分量：$ S_{11} = 0 $, $ S_{22} = 0 $, $ S_{33} = 0 $, $ S_{12} = S_{21} = 1.0 $, $ S_{23} = S_{32} = -0.5 $, $ S_{13} = S_{31} = 0.3 $.\n- 案例 $D$（精细化的各向同性网格与中等剪切）：\n  - $ \\Delta_x = 1\\,\\mathrm{m} $, $ \\Delta_y = 1\\,\\mathrm{m} $, $ \\Delta_z = 1\\,\\mathrm{m} $, $ C_s = 0.17 $.\n  - $ S_{ij} $ 分量：$ S_{11} = 0 $, $ S_{22} = 0 $, $ S_{33} = 0 $, $ S_{12} = S_{21} = 0.4 $, $ S_{23} = S_{32} = 0.1 $, $ S_{13} = S_{31} = 0 $.\n- 案例 $E$（Smagorinsky 系数变化和混合剪切）：\n  - $ \\Delta_x = 10\\,\\mathrm{m} $, $ \\Delta_y = 15\\,\\mathrm{m} $, $ \\Delta_z = 7.5\\,\\mathrm{m} $, $ C_s = 0.23 $.\n  - $ S_{ij} $ 分量：$ S_{11} = 0 $, $ S_{22} = 0 $, $ S_{33} = 0 $, $ S_{12} = S_{21} = 0.6 $, $ S_{23} = S_{32} = 0.3 $, $ S_{13} = S_{31} = 0.2 $.\n\n程序输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个元素对应一个案例，并且必须是一个双元素列表 $ [\\nu_t, \\varepsilon_{\\mathrm{sgs}}] $，两个值都四舍五入到六位小数，单位为 SI 单位，例如：$ [[\\nu_{t,A},\\varepsilon_{\\mathrm{sgs},A}],[\\nu_{t,B},\\varepsilon_{\\mathrm{sgs},B}],\\dots] $。",
            "solution": "我们从适用于大涡模拟 (LES) 的滤波不可压缩 Navier–Stokes 方程开始。对动量方程进行滤波会产生一个涉及亚格子尺度 (SGS) 应力张量 $ \\tau_{ij} = \\overline{u_i u_j} - \\overline{u}_i \\, \\overline{u}_j $ 的项，其中上划线表示滤波。解析速度 $ \\overline{u}_i $ 的滤波方程包含 $ \\partial_j \\tau_{ij} $ 项，需要闭合。\n\n解析的对称应变率张量定义为\n$$\nS_{ij} = \\frac{1}{2}\\left( \\frac{\\partial \\overline{u}_i}{\\partial x_j} + \\frac{\\partial \\overline{u}_j}{\\partial x_i} \\right),\n$$\n单位为 $ \\mathrm{s}^{-1} $。一个物理上一致的涡粘性闭合将 SGS 应力张量的偏量部分建模为与解析应变率成正比：\n$$\n\\tau_{ij} - \\frac{1}{3}\\tau_{kk}\\delta_{ij} = -2 \\nu_t S_{ij},\n$$\n其中 $ \\nu_t $ 是涡粘性。该闭合强制了对称性，并确保 $ \\tau_{ij} $ 与 $ S_{ij} $ 对齐，这与未解析的运动对解析场起到有效粘性作用的观点一致。\n\n量纲分析和混合长度理论为 Smagorinsky 形式的涡粘性提供了理论基础。混合长度 $ \\ell_s $ 被认为与滤波宽度成比例，即 $ \\ell_s = C_s \\Delta $，其中 $ C_s $ 是一个无量纲的 Smagorinsky 系数，$ \\Delta $ 是有效滤波宽度。对于各向异性网格，一个与三维顶帽滤波器一致且被广泛使用的 $ \\Delta $ 选择是\n$$\n\\Delta = (\\Delta_x \\Delta_y \\Delta_z)^{1/3}.\n$$\n涡粘性的单位必须是 $ \\mathrm{m}^2\\,\\mathrm{s}^{-1} $，将长度尺度 $ \\ell_s $ 与从 $ S_{ij} $ 导出的速度梯度尺度相结合，得到\n$$\n\\nu_t \\propto \\ell_s^2 \\, \\left| S \\right|.\n$$\n为了从张量 $ S_{ij} $ 构造一个标量大小，我们使用基于应变率第二张量不变量的不变量：\n$$\n\\left| S \\right| = \\sqrt{2 S_{ij} S_{ij}},\n$$\n其中 $ S_{ij} S_{ij} = \\sum_{i=1}^{3}\\sum_{j=1}^{3} S_{ij}^2 $ 是双点积，因子 $ 2 $ 是常规做法，以便在简单剪切中 $ \\left| S \\right| $ 简化为绝对剪切率，并保持旋转不变性。因此，Smagorinsky 涡粘性变为\n$$\n\\nu_t = (C_s \\Delta)^2 \\, \\sqrt{2 S_{ij} S_{ij}}.\n$$\n\n接下来，我们考虑单位质量的亚格子尺度耗散。解析动能方程包含 SGS 耗散项\n$$\n\\varepsilon_{\\mathrm{sgs}} = -\\tau_{ij} S_{ij}.\n$$\n代入偏量闭合，并注意到各向同性部分 $ \\tfrac{1}{3}\\tau_{kk}\\delta_{ij} $ 对 $ -\\tau_{ij} S_{ij} $ 没有贡献（因为对于不可压缩的解析流，$ \\delta_{ij} S_{ij} = S_{kk} = 0 $），我们得到\n$$\n\\varepsilon_{\\mathrm{sgs}} = -\\left( -2 \\nu_t S_{ij} \\right) S_{ij} = 2 \\nu_t S_{ij} S_{ij}.\n$$\n此表达式是严格非负的，因为 $ \\nu_t \\ge 0 $ 且 $ S_{ij} S_{ij} \\ge 0 $，从而强制了 SGS 闭合的耗散性质。\n\n每个测试案例的算法步骤：\n1. 使用提供的网格间距 $ \\Delta_x $、$ \\Delta_y $、$ \\Delta_z $ 计算有效滤波宽度 $ \\Delta = (\\Delta_x \\Delta_y \\Delta_z)^{1/3} $。\n2. 从给定的对称 $ S_{ij} $ 计算不变量 $ S_{ij} S_{ij} = \\sum_{i=1}^{3}\\sum_{j=1}^{3} S_{ij}^2 $。\n3. 计算 $ \\left| S \\right| = \\sqrt{2 S_{ij} S_{ij}} $。\n4. 计算涡粘性 $ \\nu_t = (C_s \\Delta)^2 \\left| S \\right| $，单位为 $ \\mathrm{m}^2\\,\\mathrm{s}^{-1} $。\n5. 计算单位质量的亚格子尺度耗散 $ \\varepsilon_{\\mathrm{sgs}} = 2 \\nu_t S_{ij} S_{ij} $，单位为 $ \\mathrm{m}^2\\,\\mathrm{s}^{-3} $。\n6. 将 $ \\nu_t $ 和 $ \\varepsilon_{\\mathrm{sgs}} $ 都四舍五入到六位小数以供输出。\n\n科学真实性和边缘情况行为：\n- 在案例 $B$ 中，$ S_{ij} = 0 $ 意味着 $ \\nu_t = 0 $ 和 $ \\varepsilon_{\\mathrm{sgs}} = 0 $，这与在没有剪切的情况下预期的一致。\n- 在案例 $C$ 中，具有较大 $ \\Delta_x $ 和 $ \\Delta_y $ 及较小 $ \\Delta_z $ 的强各向异性增大了 $ \\Delta $，在强剪切下增加了 $ \\nu_t $ 和 $ \\varepsilon_{\\mathrm{sgs}} $。\n- 在案例 $D$ 中，精细化网格减小了 $ \\Delta $，对于相同的解析应变，减小了 $ \\nu_t $ 和 $ \\varepsilon_{\\mathrm{sgs}} $，反映了分辨率的提高和 SGS 活动的减弱。\n- 在案例 $E$ 中，较大的 $ C_s $ 增加了混合长度 $ \\ell_s $，从而同时增加了 $ \\nu_t $ 和 $ \\varepsilon_{\\mathrm{sgs}} $，说明了参数的敏感性。\n\n程序为五个指定的案例实施了这些步骤，并打印单行输出，其中包含一个包含五个双元素列表 $ [\\nu_t, \\varepsilon_{\\mathrm{sgs}}] $ 的列表，每个值都按要求四舍五入到六位小数，单位默认为 SI 单位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_nu_t_and_epsilon(S, dx, dy, dz, Cs):\n    \"\"\"\n    Compute eddy viscosity nu_t and SGS dissipation epsilon_sgs\n    for a given symmetric strain-rate tensor S, grid spacings, and Smagorinsky coefficient.\n\n    Parameters:\n    - S: 3x3 numpy array for S_ij components [1/s]\n    - dx, dy, dz: grid spacings [m]\n    - Cs: Smagorinsky coefficient (dimensionless)\n\n    Returns:\n    - nu_t [m^2/s]\n    - epsilon_sgs [m^2/s^3]\n    \"\"\"\n    # Effective filter width using geometric mean for anisotropic grid\n    Delta = (dx * dy * dz) ** (1.0 / 3.0)\n\n    # Invariant S_ij S_ij = sum_{i,j} S_ij^2\n    s2 = float(np.sum(S**2))\n\n    # |S| = sqrt(2 * S_ij S_ij)\n    S_mag = np.sqrt(2.0 * s2)\n\n    # Eddy viscosity nu_t = (Cs * Delta)^2 * |S|\n    mixing_length_sq = (Cs * Delta) ** 2\n    nu_t = mixing_length_sq * S_mag\n\n    # Subgrid-scale dissipation per unit mass: epsilon_sgs = 2 * nu_t * (S_ij S_ij)\n    epsilon_sgs = 2.0 * nu_t * s2\n\n    return nu_t, epsilon_sgs\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (S matrix, dx, dy, dz, Cs)\n    test_cases = [\n        # Case A: general shear, anisotropic grid\n        (\n            np.array([\n                [0.0, 0.5, 0.0],\n                [0.5, 0.0, 0.2],\n                [0.0, 0.2, 0.0]\n            ], dtype=float),\n            10.0, 10.0, 5.0, 0.17\n        ),\n        # Case B: zero strain edge case\n        (\n            np.zeros((3,3), dtype=float),\n            20.0, 20.0, 20.0, 0.17\n        ),\n        # Case C: strong anisotropy and stronger shear\n        (\n            np.array([\n                [0.0,  1.0,  0.3],\n                [1.0,  0.0, -0.5],\n                [0.3, -0.5,  0.0]\n            ], dtype=float),\n            50.0, 50.0, 5.0, 0.17\n        ),\n        # Case D: refined isotropic grid with moderate shear\n        (\n            np.array([\n                [0.0, 0.4, 0.0],\n                [0.4, 0.0, 0.1],\n                [0.0, 0.1, 0.0]\n            ], dtype=float),\n            1.0, 1.0, 1.0, 0.17\n        ),\n        # Case E: variation in C_s and mixed shear\n        (\n            np.array([\n                [0.0, 0.6, 0.2],\n                [0.6, 0.0, 0.3],\n                [0.2, 0.3, 0.0]\n            ], dtype=float),\n            10.0, 15.0, 7.5, 0.23\n        ),\n    ]\n\n    results_str = []\n\n    for S, dx, dy, dz, Cs in test_cases:\n        nu_t, epsilon_sgs = compute_nu_t_and_epsilon(S, dx, dy, dz, Cs)\n        # Round to six decimal places and format without spaces\n        nu_t_str = f\"{nu_t:.6f}\"\n        epsilon_str = f\"{epsilon_sgs:.6f}\"\n        results_str.append(f\"[{nu_t_str},{epsilon_str}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "标准Smagorinsky模型的一个关键局限是其模型系数$C_s$是一个常数，需要用户根据经验指定。本节将介绍功能强大的动态程序，它通过比较两个不同尺度上的滤波信息来实时计算模型系数。我们将实现一个最小二乘法来确定最优系数，从而深入了解LES模型如何自适应不同的流态。",
            "id": "3888513",
            "problem": "考虑一个用于环境和地球系统建模中不可压缩湍流的动态大涡模拟（LES）框架。滤波后的动量方程意味着存在一个必须被建模的残余亚格子应力。在 Smagorinsky 闭合模型中，亚格子涡粘性被建模为 $\\nu_t = C_s^2 \\Delta^2 |S|$，其中 $C_s^2$ 是一个无量纲的模型系数，$\\Delta$ 是以 $\\mathrm{m}$ 为单位的网格滤波宽度，而 $|S|$ 表示已解析应变率张量 $S_{ij}$ 的大小，其中 $S_{ij}$ 由已解析的滤波速度场 $\\bar{u}_i$ 定义为 $S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_i}{\\partial x_j} + \\frac{\\partial \\bar{u}_j}{\\partial x_i}\\right)$，单位为 $\\mathrm{s}^{-1}$，且 $|S| = \\sqrt{2 S_{ij} S_{ij}}$，单位为 $\\mathrm{s}^{-1}$。\n\n使用宽度为 $\\tilde{\\Delta}$（单位：$\\mathrm{m}$）的测试滤波器，Germano 恒等式提供了一个已解析的 Leonard 应力 $L_{ij}$，在网格和测试滤波器两个层面上均采用 Smagorinsky 类的闭合模型时，得出以下关系：\n$$\nL_{ij} = 2\\left(C_s \\Delta\\right)^2 |S|\\, S_{ij} - 2\\left(C_s \\tilde{\\Delta}\\right)^2 |\\tilde{S}|\\, \\tilde{S}_{ij},\n$$\n其中 $\\tilde{S}_{ij}$ 是测试滤波器层面上的应变率张量，且 $|\\tilde{S}| = \\sqrt{2 \\tilde{S}_{ij} \\tilde{S}_{ij}}$。定义 $M_{ij} = 2\\left(\\Delta^2 |S|\\, S_{ij} - \\tilde{\\Delta}^2 |\\tilde{S}|\\, \\tilde{S}_{ij}\\right)$，单位为 $\\mathrm{m}^2 \\mathrm{s}^{-2}$。那么任务就是通过最小化建模的 Leonard 应力与已解析的 Leonard 应力之间的最小二乘不匹配来计算 $C_s^2$，即确定使下式最小化的 $C_s^2$ 值：\n$$\nJ(C_s^2) = \\sum_{i=1}^{3}\\sum_{j=1}^{3} \\left(L_{ij} - C_s^2 M_{ij}\\right)^2.\n$$\n\n你的程序必须：\n- 从给定的 $S_{ij}$ 和 $\\tilde{S}_{ij}$ 实现对 $|S|$ 和 $|\\tilde{S}|$ 的计算。\n- 从 $\\Delta$、$\\tilde{\\Delta}$、 $|S|$、 $|\\tilde{S}|$、$S_{ij}$ 和 $\\tilde{S}_{ij}$ 构建 $M_{ij}$。\n- 对于给定的 $L_{ij}$、$S_{ij}$ 和 $\\tilde{S}_{ij}$，计算作为使 $J(C_s^2)$ 最小化的值的最小二乘最小化子 $C_s^2$。\n- 处理 $\\sum_{i,j} M_{ij}^2$ 为零或低于一个小的容差的退化情况，此时应返回 $C_s^2 = 0$。\n\n所有输入和输出都必须遵守物理单位。具体来说，$S_{ij}$ 和 $\\tilde{S}_{ij}$ 的单位是 $\\mathrm{s}^{-1}$，$\\Delta$ 和 $\\tilde{\\Delta}$ 的单位是 $\\mathrm{m}$，$L_{ij}$ 和 $M_{ij}$ 的单位是 $\\mathrm{m}^2 \\mathrm{s}^{-2}$。计算出的 $C_s^2$ 必须作为一个无量纲的浮点数报告。\n\n测试套件：\n使用以下四个测试用例，它们共同涵盖了一般情况、有噪声的情况、退化情况和符号不定的情况。\n\n- 案例 $1$ (一般“顺利”路径)：\n  - $\\Delta = 10\\,\\mathrm{m}$，$\\tilde{\\Delta} = 20\\,\\mathrm{m}$。\n  - $S = \\begin{pmatrix} 0.06  0.02  -0.01 \\\\ 0.02  -0.03  0.03 \\\\ -0.01  0.03  -0.03 \\end{pmatrix}\\,\\mathrm{s}^{-1}$。\n  - $\\tilde{S} = \\begin{pmatrix} 0.054  0.018  -0.008 \\\\ 0.018  -0.028  0.025 \\\\ -0.008  0.025  -0.026 \\end{pmatrix}\\,\\mathrm{s}^{-1}$。\n  - 使用名义系数 $C_s^2 = 0.09$ 和给定的关系，从上述数据构建 $L_{ij}$。\n- 案例 $2$ (带噪声的 Leonard 应力)：\n  - $\\Delta$、$\\tilde{\\Delta}$、$S$ 和 $\\tilde{S}$ 与案例 $1$ 相同。\n  - 像案例 $1$ 中一样，使用 $C_s^2 = 0.09$ 构建 $L_{ij}$，然后加上一个固定的噪声矩阵 $E$（单位：$\\mathrm{m}^2 \\mathrm{s}^{-2}$），定义如下：\n    $E = \\begin{pmatrix} 1\\times 10^{-3}  -2\\times 10^{-4}  3\\times 10^{-4} \\\\ -2\\times 10^{-4}  5\\times 10^{-4}  -1\\times 10^{-4} \\\\ 3\\times 10^{-4}  -1\\times 10^{-4}  -6\\times 10^{-4} \\end{pmatrix}$，\n    使得 $L_{ij} \\leftarrow L_{ij} + E_{ij}$。\n- 案例 $3$ (退化的 $M_{ij}$):\n  - $\\Delta = 10\\,\\mathrm{m}$, $\\tilde{\\Delta} = 20\\,\\mathrm{m}$。\n  - $S = \\begin{pmatrix} 0.02  0.01  0.00 \\\\ 0.01  -0.015  0.005 \\\\ 0.00  0.005  -0.005 \\end{pmatrix}\\,\\mathrm{s}^{-1}$。\n  - $\\tilde{S} = 0.5 S$（也就是说，$\\tilde{S}$ 的每个分量等于 $S$ 相应分量的 $0.5$ 倍）。\n  - 设置 $L_{ij} = 0$（零矩阵），这在给定的构造下与 $M_{ij} = 0$ 一致。\n- 案例 $4$ (符号不定的“反向散射”)：\n  - $\\Delta = 10\\,\\mathrm{m}$, $\\tilde{\\Delta} = 20\\,\\mathrm{m}$。\n  - $S$ 和 $\\tilde{S}$ 与案例 $1$ 相同。\n  - 使用名义系数 $C_s^2 = -0.04$ 构建 $L_{ij}$，以测试负的最小二乘最小化子。\n\n你的程序应该产生单行输出，其中包含用方括号括起来的、按案例 $1$ 到 $4$ 顺序排列的、以逗号分隔的结果列表，即 $[C_{s,1}^2,C_{s,2}^2,C_{s,3}^2,C_{s,4}^2]$。每个条目必须是代表相应案例计算出的 $C_s^2$（无量纲）的浮点数。",
            "solution": "该问题已经过验证，被认为是有效的。它在科学上基于大涡模拟（LES）的湍流建模原理，特别是动态 Smagorinsky 模型。该问题是适定的、数学上一致的，并且所有需要的数据和定义都已提供。\n\n目标是找到无量纲模型系数 $C_s^2$，以最小化已解析的 Leonard 应力 $L_{ij}$ 与其模型 $C_s^2 M_{ij}$ 之间的最小二乘误差。需要最小化的量由下式给出：\n$$\nJ(C_s^2) = \\sum_{i=1}^{3}\\sum_{j=1}^{3} \\left(L_{ij} - C_s^2 M_{ij}\\right)^2\n$$\n为了找到使这个平方和最小化的 $C_s^2$ 值，我们必须求出 $J$ 对 $C_s^2$ 的导数的根。为方便起见，令 $c = C_s^2$。目标函数为 $J(c) = \\sum_{i,j} (L_{ij} - c M_{ij})^2$。我们对 $J(c)$ 关于 $c$ 求导，并令结果为零：\n$$\n\\frac{dJ}{dc} = \\sum_{i=1}^{3}\\sum_{j=1}^{3} \\frac{d}{dc} \\left(L_{ij} - c M_{ij}\\right)^2 = 0\n$$\n应用链式法则：\n$$\n\\sum_{i,j} 2 \\left(L_{ij} - c M_{ij}\\right) \\cdot (-M_{ij}) = 0\n$$\n展开各项：\n$$\n-2 \\sum_{i,j} L_{ij} M_{ij} + 2c \\sum_{i,j} M_{ij}^2 = 0\n$$\n解出 $c$：\n$$\nc \\sum_{i,j} M_{ij}^2 = \\sum_{i,j} L_{ij} M_{ij}\n$$\n在 $\\sum_{i,j} M_{ij}^2 \\neq 0$ 的条件下，我们可以将解写为：\n$$\nc = C_s^2 = \\frac{\\sum_{i,j} L_{ij} M_{ij}}{\\sum_{i,j} M_{ij}^2}\n$$\n该表达式是线性最小二乘问题的经典解。在矩阵运算方面，分子 $\\sum_{i,j} L_{ij} M_{ij}$ 是张量 $L$ 和 $M$ 的 Frobenius 内积，记为 $\\langle L, M \\rangle_F$。分母 $\\sum_{i,j} M_{ij}^2$ 是张量 $M$ 的 Frobenius 范数的平方，记为 $||M||_F^2$。因此，解可以紧凑地写为：\n$$\nC_s^2 = \\frac{\\langle L, M \\rangle_F}{||M||_F^2}\n$$\n每个测试用例的计算过程如下：\n1.  给定网格滤波宽度 $\\Delta$、测试滤波器宽度 $\\tilde{\\Delta}$、已解析应变率张量 $S_{ij}$ 和测试滤波后的应变率张量 $\\tilde{S}_{ij}$。\n2.  计算应变率张量的大小。大小 $|S|$ 定义为 $|S| = \\sqrt{2S_{ij}S_{ij}}$，其中隐含了对重复指标的求和。这对应于 $|S| = \\sqrt{2 \\sum_{i,j} S_{ij}^2}$。类似地， $|\\tilde{S}| = \\sqrt{2 \\sum_{i,j} \\tilde{S}_{ij}^2}$。\n3.  使用其定义构建张量 $M_{ij}$：\n    $$\n    M_{ij} = 2\\left(\\Delta^2 |S|\\, S_{ij} - \\tilde{\\Delta}^2 |\\tilde{S}|\\, \\tilde{S}_{ij}\\right)\n    $$\n    此计算的所有输入，$\\Delta$、$\\tilde{\\Delta}$、$S_{ij}$ 和 $\\tilde{S}_{ij}$，均已为每个测试用例提供。\n4.  对于每个测试用例，Leonard 应力张量 $L_{ij}$ 也被指定，其值要么通过名义 $C_s^2$ 构建，要么直接给出。\n5.  计算分母项 $D = \\sum_{i,j} M_{ij}^2$。问题规定，如果 $D$ 为零或低于一个小的数值容差，则该情况为退化情况，结果应为 $C_s^2 = 0$。\n6.  如果 $D$ 大于容差，则计算分子项 $N = \\sum_{i,j} L_{ij} M_{ij}$。\n7.  该测试用例的最终结果是 $C_s^2 = N/D$。\n\n将此算法应用于问题陈述中指定的四个测试用例中的每一个。这些案例旨在测试一般功能（案例 $1$）、对噪声的鲁棒性（案例 $2$）、退化条件的处理（案例 $3$）以及负系数（反向散射）的可能性（案例 $4$）。案例 $3$ 的构造使得 $M_{ij}$ 为零张量，从而触发退化条件处理器。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the Smagorinsky coefficient C_s^2 for four test cases\n    based on the dynamic LES procedure.\n    \"\"\"\n\n    def calculate_cs_squared(delta, delta_tilde, S, S_tilde, L, tol=1e-20):\n        \"\"\"\n        Calculates the Smagorinsky coefficient C_s^2 using a least-squares minimization.\n        \"\"\"\n        # Calculate magnitudes of the strain-rate tensors, |T| = sqrt(2 * T_ij * T_ij).\n        S_mag = np.sqrt(2 * np.sum(S**2))\n        S_tilde_mag = np.sqrt(2 * np.sum(S_tilde**2))\n\n        # Construct the tensor M_ij.\n        M = 2 * (delta**2 * S_mag * S - delta_tilde**2 * S_tilde_mag * S_tilde)\n\n        # The least-squares solution for C_s^2 is the inner product of L and M\n        # divided by the squared Frobenius norm of M.\n        denominator = np.sum(M**2)\n\n        if denominator  tol:\n            return 0.0\n\n        numerator = np.sum(L * M)\n        cs_squared = numerator / denominator\n        \n        return cs_squared\n\n    results = []\n\n    # --- Case 1  common data setup ---\n    delta = 10.0\n    delta_tilde = 20.0\n    S1 = np.array([[0.06, 0.02, -0.01], [0.02, -0.03, 0.03], [-0.01, 0.03, -0.03]])\n    S_tilde1 = np.array([[0.054, 0.018, -0.008], [0.018, -0.028, 0.025], [-0.008, 0.025, -0.026]])\n    \n    S1_mag = np.sqrt(2 * np.sum(S1**2))\n    S_tilde1_mag = np.sqrt(2 * np.sum(S_tilde1**2))\n    M1 = 2 * (delta**2 * S1_mag * S1 - delta_tilde**2 * S_tilde1_mag * S_tilde1)\n    \n    nominal_cs_squared_1 = 0.09\n    L1 = nominal_cs_squared_1 * M1\n    \n    results.append(calculate_cs_squared(delta, delta_tilde, S1, S_tilde1, L1))\n\n    # --- Case 2: Noisy Leonard stress ---\n    E = np.array([[1e-3, -2e-4, 3e-4], [-2e-4, 5e-4, -1e-4], [3e-4, -1e-4, -6e-4]])\n    L2 = L1 + E\n    results.append(calculate_cs_squared(delta, delta_tilde, S1, S_tilde1, L2))\n\n    # --- Case 3: Degenerate M_ij ---\n    delta_3 = 10.0\n    delta_tilde_3 = 20.0\n    S3 = np.array([[0.02, 0.01, 0.00], [0.01, -0.015, 0.005], [0.00, 0.005, -0.005]])\n    S_tilde3 = 0.5 * S3\n    L3 = np.zeros((3, 3))\n    results.append(calculate_cs_squared(delta_3, delta_tilde_3, S3, S_tilde3, L3))\n    \n    # --- Case 4: Negative \"backscatter\" ---\n    nominal_cs_squared_4 = -0.04\n    L4 = nominal_cs_squared_4 * M1\n    results.append(calculate_cs_squared(delta, delta_tilde, S1, S_tilde1, L4))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了动量，大涡模拟在模拟热量、水汽等标量的输运中也至关重要。本节将涡粘性概念推广到涡扩散性，用以计算地表的感热和潜热通量。这个练习将LES亚格子模型与天气和气候系统中的关键物理量预报直接联系起来，展示了其在实际问题中的应用。",
            "id": "4058418",
            "problem": "考虑一个使用大涡模拟（LES）模拟的晴天、白天的对流大气边界层。该大涡模拟采用基于涡扩散模型的标量亚格子闭合方案，其中一个模拟的湍流涡扩散系数 $\\kappa_{t}$ 用于所有标量，并且湍流普朗特数和施密特数被设为1，因此相同的 $\\kappa_{t}$ 适用于热量和水汽。在第一个离地网格点处测得的解析近地表垂直梯度为：位温 $\\theta$ 的梯度 $\\partial \\theta / \\partial z = -0.10$ K m$^{-1}$，比湿 $q_{v}$ 的梯度 $\\partial q_{v} / \\partial z = -3.10 \\times 10^{-5}$ kg kg$^{-1}$ m$^{-1}$。该高度上模拟的标量涡扩散系数为 $\\kappa_{t} = 2.0$ m$^{2}$ s$^{-1}$。假设空气密度 $\\rho = 1.2$ kg m$^{-3}$，空气定压比热 $c_{p} = 1004$ J kg$^{-1}$ K$^{-1}$，汽化潜热 $L_{v} = 2.5 \\times 10^{6}$ J kg$^{-1}$。采用向上通量为正的符号约定。应用标量亚格子闭合方案，利用这些解析梯度和模型参数计算地表感热通量 $H$ 和潜热通量 $LE$。将两种通量均以 W m$^{-2}$ 为单位表示，并将您的答案四舍五入到三位有效数字。以单行的形式提供最终答案，依次包含 $H$ 和 $LE$。",
            "solution": "目标是基于解析的近地表梯度和模拟的湍流涡扩散系数，在一次大涡模拟（LES）中使用标量亚格子闭合方案来计算地表感热通量 $H$ 和潜热通量 $LE$。合适的出发点是通用标量 $\\phi$（例如位温 $\\theta$ 或比湿 $q_{v}$）的守恒方程，该方程是在对适用于大气边界层的Navier–Stokes方程和标量输运方程进行空间滤波后得到的。在非弹性或Boussinesq近似下，滤波后的标量输运方程可以写为\n$$\n\\frac{\\partial \\phi}{\\partial t} + \\bar{u}_{i} \\frac{\\partial \\phi}{\\partial x_{i}} = - \\frac{\\partial}{\\partial x_{i}} \\left( \\overline{u'_{i} \\phi'} \\right) + S_{\\phi},\n$$\n其中 $\\bar{u}_{i}$ 是解析速度，$\\overline{u'_{i} \\phi'}$ 是 $\\phi$ 的亚格子尺度通量，而 $S_{\\phi}$ 代表解析的源和汇（例如对于 $\\theta$ 的辐射加热项，对于 $q_{v}$ 的微物理源等，但在晴天白天的近地表，这些对于通量计算通常可以忽略）。\n\n在标量的涡扩散闭合方案中，亚格子尺度通量被建模为与局地解析梯度成正比，\n$$\n\\overline{u'_{i} \\phi'} \\approx - \\kappa_{t} \\frac{\\partial \\phi}{\\partial x_{i}},\n$$\n其中 $\\kappa_{t}$ 是标量的湍流涡扩散系数。由于湍流普朗特数和施密特数被设为1，相同的 $\\kappa_{t}$ 适用于热量（由 $\\theta$ 表示）和水汽（由 $q_{v}$ 表示）。亚格子标量通量的垂直分量则变为\n$$\n\\overline{w' \\phi'} \\approx - \\kappa_{t} \\frac{\\partial \\phi}{\\partial z}.\n$$\n相应的地表感热通量和潜热通量的物理表达式包含适当的热力学转换因子。根据向上通量为正的约定，并利用第一个离地网格点的梯度来评估地表通量（这是一种常见的大涡模拟壁面边界处理方法），感热通量 $H$ 和潜热通量 $LE$ 由下式给出\n$$\nH = \\rho c_{p} \\left( - \\kappa_{t} \\frac{\\partial \\theta}{\\partial z} \\right), \\qquad LE = \\rho L_{v} \\left( - \\kappa_{t} \\frac{\\partial q_{v}}{\\partial z} \\right).\n$$\n\n我们现在代入所提供的值，在最终数值计算前保留符号：\n- 空气密度 $\\rho = 1.2$ kg m$^{-3}$。\n- 定压比热 $c_{p} = 1004$ J kg$^{-1}$ K$^{-1}$。\n- 汽化潜热 $L_{v} = 2.5 \\times 10^{6}$ J kg$^{-1}$。\n- 湍流涡扩散系数 $\\kappa_{t} = 2.0$ m$^{2}$ s$^{-1}$。\n- 解析的垂直梯度 $\\frac{\\partial \\theta}{\\partial z} = -0.10$ K m$^{-1}$ 和 $\\frac{\\partial q_{v}}{\\partial z} = -3.10 \\times 10^{-5}$ kg kg$^{-1}$ m$^{-1}$。\n\n计算感热通量：\n$$\nH = \\rho c_{p} \\left( - \\kappa_{t} \\frac{\\partial \\theta}{\\partial z} \\right)\n= (1.2)(1004) \\left( - (2.0)(-0.10) \\right)\n= (1.2)(1004)(0.20)\n= (1.2)(200.8)\n= 240.96 \\text{ W m}^{-2}.\n$$\n\n计算潜热通量：\n$$\nLE = \\rho L_{v} \\left( - \\kappa_{t} \\frac{\\partial q_{v}}{\\partial z} \\right)\n= (1.2)\\left(2.5 \\times 10^{6}\\right) \\left( - (2.0)\\left(-3.10 \\times 10^{-5}\\right) \\right)\n= (1.2)\\left(2.5 \\times 10^{6}\\right)\\left(6.20 \\times 10^{-5}\\right)\n= (1.2)(155.0)\n= 186.0 \\text{ W m}^{-2}.\n$$\n\n根据要求四舍五入到三位有效数字，并以 W m$^{-2}$ 为单位表示答案，我们得到\n$$\nH \\approx 241 \\text{ W m}^{-2}, \\qquad LE \\approx 186 \\text{ W m}^{-2}.\n$$\n\n最终答案按 $(H, LE)$ 的顺序列为单行报告。",
            "answer": "$$\\boxed{\\begin{pmatrix}241  186\\end{pmatrix}}$$"
        }
    ]
}