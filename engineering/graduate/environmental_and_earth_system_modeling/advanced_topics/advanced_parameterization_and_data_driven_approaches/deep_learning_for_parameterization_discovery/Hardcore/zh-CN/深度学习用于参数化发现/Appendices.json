{
    "hands_on_practices": [
        {
            "introduction": "数值模型的分辨率有限，这导致了次网格尺度误差，这是参数化方案试图解决的核心问题。本练习将通过一个经典的一维平流问题，直觀地展示一个被称为“混叠”的关键误差来源，并说明数据驱动的闭合项如何通过学习一个有效的物理参数来补偿这种误差。",
            "id": "3873742",
            "problem": "考虑一个长度为 $L$ 的周期性域上的一维线性平流方程，\n$$\n\\partial_t u(x,t) + c\\,\\partial_x u(x,t) = 0,\n$$\n其相速度 $c$ 为常数，初始条件由单个傅里叶模式给出\n$$\nu(x,0) = A \\cos\\!\\left(k_{\\mathrm{true}} x\\right), \\quad k_{\\mathrm{true}} = \\frac{2\\pi n}{L},\n$$\n其中 $A$ 是振幅，$n$ 是一个整数模态指数。其精确解为\n$$\nu(x,t) = A \\cos\\!\\left(k_{\\mathrm{true}} x - c\\,k_{\\mathrm{true}} t\\right).\n$$\n现在假设该场在包含 $N$ 个点的网格上进行均匀采样，网格间距为 $\\Delta x = L/N$，网格点位置为 $x_i = i \\Delta x$，其中 $i \\in \\{0,1,\\dots,N-1\\}$。由于有限分辨率采样，可分辨的波数位于区间 $\\left[-k_{\\mathrm{N}}, k_{\\mathrm{N}}\\right)$ 内，其中奈奎斯特波数为 $k_{\\mathrm{N}} = \\pi/\\Delta x$。离散采样将真实模态指数 $n$ 混叠为一个整数指数 $n_{\\mathrm{alias}} \\in \\{-\\lfloor N/2 \\rfloor, \\dots, \\lfloor N/2 \\rfloor - 1\\}$，其定义为\n$$\nn_{\\mathrm{alias}} = \\left[ \\left( n + \\left\\lfloor \\frac{N}{2} \\right\\rfloor \\right) \\bmod N \\right] - \\left\\lfloor \\frac{N}{2} \\right\\rfloor,\n$$\n对应的混叠波数为 $k_{\\mathrm{alias}} = \\frac{2\\pi n_{\\mathrm{alias}}}{L}$。注意，对于偶数 $N$，$\\left\\lfloor \\frac{N}{2} \\right\\rfloor = \\frac{N}{2}$。\n\n定义在单个时间步长 $\\Delta t$ 上的两个时间推进模型：\n- 在时间 $\\Delta t$ 的真实采样场：\n$$\nu_{\\mathrm{true}}(x_i,\\Delta t) = A \\cos\\!\\left(k_{\\mathrm{true}} x_i - c\\,k_{\\mathrm{true}} \\Delta t\\right).\n$$\n- 一个低分辨率的仅可分辨模型，该模型使用物理相速度 $c$ 来演化混叠模态：\n$$\nu_{\\mathrm{model}}(x_i,\\Delta t) = A \\cos\\!\\left(k_{\\mathrm{alias}} x_i - c\\,k_{\\mathrm{alias}} \\Delta t\\right).\n$$\n\n将一步之后的均方根相对误差定义为\n$$\nE = \\frac{\\left\\| u_{\\mathrm{model}}(\\cdot,\\Delta t) - u_{\\mathrm{true}}(\\cdot,\\Delta t) \\right\\|_{2}}{\\left\\| u_{\\mathrm{true}}(\\cdot,\\Delta t) \\right\\|_{2}},\n$$\n其中\n$$\n\\| f \\|_2 = \\left( \\frac{1}{N} \\sum_{i=0}^{N-1} f(x_i)^2 \\right)^{1/2}.\n$$\n角度以弧度为单位。输出 $E$ 是无量纲的，并且必须以小数形式报告。\n\n数据驱动的闭包可以被看作是学习一个有效的相速度 $c_{\\mathrm{eff}}$ 来调整可分辨模态的趋势，从而得到\n$$\nu_{\\mathrm{closure}}(x_i,\\Delta t) = A \\cos\\!\\left(k_{\\mathrm{alias}} x_i - c_{\\mathrm{eff}}\\,k_{\\mathrm{alias}} \\Delta t\\right).\n$$\n将此分辨率下可能最好的学习闭包定义为：选择能够使相对误差泛函（其中 $u_{\\mathrm{model}}$ 被 $u_{\\mathrm{closure}}$ 替代）最小化的 $c_{\\mathrm{eff}}$。\n\n您的任务是：\n- 实现采样和混叠映射。\n- 使用 $u_{\\mathrm{model}}$ 计算 $E_{\\mathrm{no\\_closure}}$，并使用能在一个时间步长 $\\Delta t$ 内最小化相对误差的最优 $c_{\\mathrm{eff}}$ 计算 $E_{\\mathrm{closure}}$。\n- 使用以下科学上合理的测试套件，所有物理量均采用国际单位制 (SI)。域长度为 $L = 1 \\, \\mathrm{m}$（即 $L$ 以 $\\mathrm{m}$ 为单位），相速度 $c$ 以 $\\mathrm{m/s}$ 为单位，时间步长 $\\Delta t$ 以 $\\mathrm{s}$ 为单位，振幅 $A$ 是无量纲的：\n    - 测试 $1$：$A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 20$, $\\Delta t = 0.4$。\n    - 测试 $2$：$A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 16$, $\\Delta t = 0.4$。\n    - 测试 $3$：$A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 32$, $\\Delta t = 0.4$。\n    - 测试 $4$：$A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 8$, $\\Delta t = 0.4$。\n\n对于每个测试，计算并返回一个包含两个浮点数的列表 $[E_{\\mathrm{no\\_closure}}, E_{\\mathrm{closure}}]$，每个浮点数四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含结果，格式为以上述顺序排列的各测试列表的逗号分隔列表，并用方括号括起来。例如：“[[e1no,e1cl],[e2no,e2cl],[e3no,e3cl],[e4no,e4cl]]”。输出中不应打印任何单位；只需要四舍五入后的小数值。",
            "solution": "用户提供了一个问题陈述，在尝试解决之前需要对其进行验证。\n\n### 步骤 1：提取已知条件\n- **控制方程**：长度为 $L$ 的周期性域上的一维线性平流方程 $\\partial_t u(x,t) + c\\,\\partial_x u(x,t) = 0$。\n- **初始条件**：$u(x,0) = A \\cos(k_{\\mathrm{true}} x)$，其中 $k_{\\mathrm{true}} = \\frac{2\\pi n}{L}$。\n- **精确解**：$u(x,t) = A \\cos(k_{\\mathrm{true}} x - c\\,k_{\\mathrm{true}} t)$。\n- **离散化**：具有 $N$ 个点的均匀网格，间距为 $\\Delta x = L/N$，位置为 $x_i = i \\Delta x$，其中 $i \\in \\{0, 1, \\dots, N-1\\}$。\n- **混叠映射**：真实模态指数 $n$ 被混叠为 $n_{\\mathrm{alias}} = \\left[ \\left( n + \\left\\lfloor \\frac{N}{2} \\right\\rfloor \\right) \\bmod N \\right] - \\left\\lfloor \\frac{N}{2} \\right\\rfloor$。\n- **混叠波数**：$k_{\\mathrm{alias}} = \\frac{2\\pi n_{\\mathrm{alias}}}{L}$。\n- **真实采样场**：$u_{\\mathrm{true}}(x_i,\\Delta t) = A \\cos(k_{\\mathrm{true}} x_i - c\\,k_{\\mathrm{true}} \\Delta t)$。\n- **模型场**：$u_{\\mathrm{model}}(x_i,\\Delta t) = A \\cos(k_{\\mathrm{alias}} x_i - c\\,k_{\\mathrm{alias}} \\Delta t)$。\n- **闭包场**：$u_{\\mathrm{closure}}(x_i,\\Delta t) = A \\cos(k_{\\mathrm{alias}} x_i - c_{\\mathrm{eff}}\\,k_{\\mathrm{alias}} \\Delta t)$。\n- **误差度量**：均方根相对误差 $E = \\frac{\\| u_{\\mathrm{comp}}(\\cdot,\\Delta t) - u_{\\mathrm{true}}(\\cdot,\\Delta t) \\|_{2}}{\\| u_{\\mathrm{true}}(\\cdot,\\Delta t) \\|_{2}}$，其中 $u_{\\mathrm{comp}}$ 是 $u_{\\mathrm{model}}$ 或 $u_{\\mathrm{closure}}$。\n- **离散范数**：$\\| f \\|_2 = \\left( \\frac{1}{N} \\sum_{i=0}^{N-1} f(x_i)^2 \\right)^{1/2}$。\n- **最优闭包**：当 $u_{\\mathrm{comp}} = u_{\\mathrm{closure}}$ 时，使 $E$ 最小化的 $c_{\\mathrm{eff}}$ 值。\n- **任务**：计算 $E_{\\mathrm{no\\_closure}}$（使用 $u_{\\mathrm{model}}$）和 $E_{\\mathrm{closure}}$（使用最优的 $u_{\\mathrm{closure}}$）。\n- **测试用例**：\n    1.  $A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 20$, $\\Delta t = 0.4$。\n    2.  $A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 16$, $\\Delta t = 0.4$。\n    3.  $A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 32$, $\\Delta t = 0.4$。\n    4.  $A = 1$, $L = 1$, $c = 0.3$, $N = 32$, $n = 8$, $\\Delta t = 0.4$。\n\n### 步骤 2：使用提取的已知条件进行验证\n问题陈述是科学上合理、适定且客观的。\n1.  **科学或事实不合理**：无。该问题是偏微分方程数值分析中的一个标准练习，特别关注基于傅里叶方法中的混叠概念。所有方程和定义都是标准且正确的。\n2.  **非形式化或不相关**：无。问题在数学上被严格定义。它正确地将数据驱动闭包的概念识别为学习一个有效参数 ($c_{\\mathrm{eff}}$)，这是现代环境建模中的一个常见观点。\n3.  **不完整或矛盾的设置**：无。为每个测试用例提供了唯一解所需的所有必要参数和定义。\n4.  **不切实际或不可行**：无。所有参数在物理上都是合理的。\n5.  **不适定或结构不良**：无。存在唯一的最小误差，并且可以找到实现该误差的参数。\n6.  **伪深刻、琐碎或同义反复**：无。该问题需要仔细应用离散傅里叶分析原理，并揭示了非平凡的行为，例如某些模态的完美解析和其他模态的不可约误差。\n7.  **超出科学可验证性**：无。结果在数学上是可推导和可验证的。\n\n### 步骤 3：结论和行动\n问题是**有效的**。继续进行求解。\n\n### 求解\n目标是计算两个误差度量，$E_{\\mathrm{no\\_closure}}$ 和 $E_{\\mathrm{closure}}$，它们依赖于离散采样和混叠的属性。\n\n在均匀网格上进行离散采样的一个关键特性是，相差 $2\\pi/\\Delta x = 2\\pi N/L$ 整数倍的波数是无法区分的。给定的混叠映射 $n \\to n_{\\mathrm{alias}}$ 确保 $n-n_{\\mathrm{alias}}$ 是 $N$ 的整数倍。设 $n-n_{\\mathrm{alias}} = mN$，其中 $m$ 为某个整数。那么，波数的差为 $k_{\\mathrm{true}} - k_{\\mathrm{alias}} = \\frac{2\\pi n}{L} - \\frac{2\\pi n_{\\mathrm{alias}}}{L} = \\frac{2\\pi (n-n_{\\mathrm{alias}})}{L} = \\frac{2\\pi m N}{L}$。\n在网格点 $x_i = i \\Delta x = i L/N$ 处，复指数的关系如下：\n$$\ne^{i k_{\\mathrm{true}} x_i} = e^{i (k_{\\mathrm{alias}} + 2\\pi m N/L) x_i} = e^{i k_{\\mathrm{alias}} x_i} e^{i (2\\pi m N/L) (i L/N)} = e^{i k_{\\mathrm{alias}} x_i} e^{i 2\\pi m i} = e^{i k_{\\mathrm{alias}} x_i}.\n$$\n这个混叠恒等式，$e^{i k_{\\mathrm{true}} x_i} = e^{i k_{\\mathrm{alias}} x_i}$，是本问题的基础。它意味着在网格上，$\\cos(k_{\\mathrm{true}}x_i) = \\cos(k_{\\mathrm{alias}}x_i)$ 且 $\\sin(k_{\\mathrm{true}}x_i) = \\sin(k_{\\mathrm{alias}}x_i)$。\n\n让我们分析误差的分子，$\\| u_{\\mathrm{comp}} - u_{\\mathrm{true}} \\|_2^2 = \\frac{1}{N}\\sum_{i=0}^{N-1} (u_{\\mathrm{comp}}(x_i, \\Delta t) - u_{\\mathrm{true}}(x_i, \\Delta t))^2$。\n设 $\\phi_{\\mathrm{true}} = c k_{\\mathrm{true}} \\Delta t$。\n$u_{\\mathrm{true}}(x_i, \\Delta t) = A \\cos(k_{\\mathrm{true}}x_i - \\phi_{\\mathrm{true}}) = A(\\cos(k_{\\mathrm{true}}x_i)\\cos(\\phi_{\\mathrm{true}}) + \\sin(k_{\\mathrm{true}}x_i)\\sin(\\phi_{\\mathrm{true}}))$。\n使用混叠恒等式，这变为：\n$u_{\\mathrm{true}}(x_i, \\Delta t) = A(\\cos(k_{\\mathrm{alias}}x_i)\\cos(\\phi_{\\mathrm{true}}) + \\sin(k_{\\mathrm{alias}}x_i)\\sin(\\phi_{\\mathrm{true}}))$。\n\n对于无闭包模型，设 $\\phi_{\\mathrm{model}} = c k_{\\mathrm{alias}} \\Delta t$。\n$u_{\\mathrm{model}}(x_i, \\Delta t) = A \\cos(k_{\\mathrm{alias}}x_i - \\phi_{\\mathrm{model}}) = A(\\cos(k_{\\mathrm{alias}}x_i)\\cos(\\phi_{\\mathrm{model}}) + \\sin(k_{\\mathrm{alias}}x_i)\\sin(\\phi_{\\mathrm{model}}))$。\n差值为：\n$u_{\\mathrm{model}} - u_{\\mathrm{true}} = A\\cos(k_{\\mathrm{alias}}x_i)(\\cos\\phi_{\\mathrm{model}}-\\cos\\phi_{\\mathrm{true}}) + A\\sin(k_{\\mathrm{alias}}x_i)(\\sin\\phi_{\\mathrm{model}}-\\sin\\phi_{\\mathrm{true}})$。\n设 $\\Delta_C = \\cos\\phi_{\\mathrm{model}}-\\cos\\phi_{\\mathrm{true}}$ 和 $\\Delta_S = \\sin\\phi_{\\mathrm{model}}-\\sin\\phi_{\\mathrm{true}}$。\n误差的平方范数为：\n$\\|u_{\\mathrm{model}} - u_{\\mathrm{true}}\\|_2^2 = \\frac{A^2}{N} \\sum_{i=0}^{N-1} (\\cos(k_{\\mathrm{alias}}x_i)\\Delta_C + \\sin(k_{\\mathrm{alias}}x_i)\\Delta_S)^2$。\n这需要计算三角函数的离散和。和 $\\frac{1}{N}\\sum_{i=0}^{N-1}\\cos^2(k_{\\mathrm{alias}}x_i)$、$\\frac{1}{N}\\sum_{i=0}^{N-1}\\sin^2(k_{\\mathrm{alias}}x_i)$ 和 $\\frac{1}{N}\\sum_{i=0}^{N-1}\\cos(k_{\\mathrm{alias}}x_i)\\sin(k_{\\mathrm{alias}}x_i)$ 取决于 $2n_{\\mathrm{alias}}$ 是否是 $N$ 的倍数。\n\n**一般情况：** $2n_{\\mathrm{alias}} \\not\\equiv 0 \\pmod N$。这在 $n_{\\mathrm{alias}}$ 不是 $0$ 或 $\\pm N/2$ 时发生。在这种情况下，离散模态 $\\cos(k_{\\mathrm{alias}}x_i)$ 和 $\\sin(k_{\\mathrm{alias}}x_i)$ 是正交的，它们的平方范数都是 $1/2$。\n$\\|u_{\\mathrm{model}} - u_{\\mathrm{true}}\\|_2^2 = A^2(\\frac{1}{2}\\Delta_C^2 + \\frac{1}{2}\\Delta_S^2) = \\frac{A^2}{2}((\\cos\\phi_{\\mathrm{model}}-\\cos\\phi_{\\mathrm{true}})^2 + (\\sin\\phi_{\\mathrm{model}}-\\sin\\phi_{\\mathrm{true}})^2) = \\frac{A^2}{2}(2 - 2\\cos(\\phi_{\\mathrm{model}}-\\phi_{\\mathrm{true}})) = A^2(1 - \\cos(c(k_{\\mathrm{alias}}-k_{\\mathrm{true}})\\Delta t))$。\n分母 $\\|u_{\\mathrm{true}}\\|_2^2$ 也基于 $2n_{\\mathrm{true}} \\pmod N$ 属于一般或特殊情况。如果是一般情况，$\\|u_{\\mathrm{true}}\\|_2^2 = A^2/2$。\n因此，$E_{\\mathrm{no\\_closure}}^2 = \\frac{A^2(1 - \\cos(c(k_{\\mathrm{alias}}-k_{\\mathrm{true}})\\Delta t))}{A^2/2} = 2(1 - \\cos(c(k_{\\mathrm{alias}}-k_{\\mathrm{true}})\\Delta t)) = 4\\sin^2(c(k_{\\mathrm{alias}}-k_{\\mathrm{true}})\\Delta t/2)$。\n$E_{\\mathrm{no\\_closure}} = |2\\sin(c(k_{\\mathrm{alias}}-k_{\\mathrm{true}})\\Delta t/2)|$。\n\n**最优闭包**：我们通过选择 $c_{\\mathrm{eff}}$ 来最小化 $\\|u_{\\mathrm{closure}}-u_{\\mathrm{true}}\\|_2^2$。这等同于选择 $\\phi_{\\mathrm{eff}} = c_{\\mathrm{eff}}k_{\\mathrm{alias}}\\Delta t$。对于一般情况，这意味着最小化 $A^2(1-\\cos(\\phi_{\\mathrm{eff}}-\\phi_{\\mathrm{true}}))$。最小值为 $0$，在 $\\phi_{\\mathrm{eff}} = \\phi_{\\mathrm{true}} + 2p\\pi$（$p$为任意整数）时达到。如果 $k_{\\mathrm{alias}}\\neq 0$，我们可以选择 $c_{\\mathrm{eff}}$ 来满足此条件，例如，$c_{\\mathrm{eff}} = c \\frac{k_{\\mathrm{true}}}{k_{\\mathrm{alias}}}$。这导致 $E_{\\mathrm{closure}}=0$。\n\n**特殊情况 1：混叠至奈奎斯特模态 ($n_{\\mathrm{alias}} = \\pm N/2$)**。\n这里 $2n_{\\mathrm{alias}} = \\pm N$，所以 $2n_{\\mathrm{alias}} \\equiv 0 \\pmod N$。\n$\\frac{1}{N}\\sum \\cos^2(k_{\\mathrm{alias}}x_i) = 1$，$\\frac{1}{N}\\sum \\sin^2(k_{\\mathrm{alias}}x_i) = 0$。\n误差分子变为 $\\|u_{\\mathrm{model}} - u_{\\mathrm{true}}\\|_2^2 = A^2\\Delta_C^2 = A^2(\\cos\\phi_{\\mathrm{model}}-\\cos\\phi_{\\mathrm{true}})^2$。\n分母 $\\|u_{\\mathrm{true}}\\|_2^2$ 也对应一个特殊情况 ($2n_{\\mathrm{true}} \\equiv 0 \\pmod N$)，给出 $\\|u_{\\mathrm{true}}\\|_2^2 = A^2\\cos^2(\\phi_{\\mathrm{true}})$。\n$E_{\\mathrm{no\\_closure}}^2 = \\frac{A^2(\\cos\\phi_{\\mathrm{model}}-\\cos\\phi_{\\mathrm{true}})^2}{A^2\\cos^2(\\phi_{\\mathrm{true}})} = (\\frac{\\cos\\phi_{\\mathrm{model}}}{\\cos\\phi_{\\mathrm{true}}}-1)^2$。\n最优闭包设置 $\\cos\\phi_{\\mathrm{eff}} = \\cos\\phi_{\\mathrm{true}}$，使误差为 $0$。所以 $E_{\\mathrm{closure}}=0$。\n\n**特殊情况 2：混叠至零模态 ($n_{\\mathrm{alias}} = 0$)**。\n这里 $k_{\\mathrm{alias}}=0$。模型变为 $u_{\\mathrm{model}}(x_i, \\Delta t) = A$。闭包模型 $u_{\\mathrm{closure}}(x_i, \\Delta t) = A\\cos(0 - c_{\\mathrm{eff}} \\cdot 0) = A$ 与 $c_{\\mathrm{eff}}$ 无关。误差无法进一步最小化。因此，$E_{\\mathrm{closure}} = E_{\\mathrm{no\\_closure}}$。\n这里 $u_{\\mathrm{model}} - u_{\\mathrm{true}} = A - A\\cos(k_{\\mathrm{true}}x_i - \\phi_{\\mathrm{true}})$。分析得出 $E_{\\mathrm{no\\_closure}} = |\\sec(ck_{\\mathrm{true}}\\Delta t)-1|$。\n\n现在我们将这些公式应用于测试用例。($L=1$, $c=0.3$, $N=32$, $\\Delta t=0.4$)\n\n- **测试 1**：$n = 20$。\n  $n_{\\mathrm{alias}} = ((20 + 16) \\bmod 32) - 16 = 4 - 16 = -12$。这是一般情况。\n  $k_{\\mathrm{true}} = 2\\pi(20) = 40\\pi$, $k_{\\mathrm{alias}} = 2\\pi(-12) = -24\\pi$。\n  $c(k_{\\mathrm{alias}}-k_{\\mathrm{true}})\\Delta t/2 = 0.3(-24\\pi-40\\pi)(0.4)/2 = 0.3(-64\\pi)(0.2) = -3.84\\pi$。\n  $E_{\\mathrm{no\\_closure}} = |2\\sin(-3.84\\pi)| = |2\\sin(0.16\\pi)| \\approx 0.963507$。\n  $E_{\\mathrm{closure}} = 0$ 因为 $k_{\\mathrm{alias}} \\neq 0$。\n\n- **测试 2**：$n = 16$。\n  $n_{\\mathrm{alias}} = ((16 + 16) \\bmod 32) - 16 = 0 - 16 = -16$。这是奈奎斯特情况。\n  $k_{\\mathrm{true}} = 2\\pi(16) = 32\\pi$, $k_{\\mathrm{alias}} = 2\\pi(-16) = -32\\pi$。所以 $k_{\\mathrm{alias}}=-k_{\\mathrm{true}}$。\n  $\\phi_{\\mathrm{model}} = c k_{\\mathrm{alias}}\\Delta t = -c k_{\\mathrm{true}}\\Delta t = -\\phi_{\\mathrm{true}}$。\n  $\\cos(\\phi_{\\mathrm{model}})=\\cos(-\\phi_{\\mathrm{true}})=\\cos(\\phi_{\\mathrm{true}})$。\n  无闭包情况的误差分子为 $0$。\n  $E_{\\mathrm{no\\_closure}} = 0$。\n  $E_{\\mathrm{closure}} = 0$。\n\n- **测试 3**：$n = 32$。\n  $n_{\\mathrm{alias}} = ((32 + 16) \\bmod 32) - 16 = 16 - 16 = 0$。这是零模态情况。\n  $k_{\\mathrm{alias}} = 0$。\n  $k_{\\mathrm{true}} = 2\\pi(32) = 64\\pi$。\n  secant 的参数为 $ck_{\\mathrm{true}}\\Delta t = 0.3(64\\pi)(0.4) = 7.68\\pi$。\n  $E_{\\mathrm{no\\_closure}} = |\\sec(7.68\\pi) - 1| = |\\sec(0.32\\pi) - 1| \\approx 0.866261$。\n  $E_{\\mathrm{closure}} = E_{\\mathrm{no\\_closure}}$ 因为闭包参数 $c_{\\mathrm{eff}}$ 没有影响。\n\n- **测试 4**：$n = 8$。\n  $n_{\\mathrm{alias}} = ((8 + 16) \\bmod 32) - 16 = 24 - 16 = 8$。\n  这里 $n_{\\mathrm{alias}}=n$，所以 $k_{\\mathrm{alias}}=k_{\\mathrm{true}}$。模态被完美解析，没有发生混叠。\n  $u_{\\mathrm{model}}(x_i, \\Delta t) = u_{\\mathrm{true}}(x_i, \\Delta t)$。误差为 $0$。\n  $E_{\\mathrm{no\\_closure}} = 0$。\n  $E_{\\mathrm{closure}} = 0$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the modeling error for a discretized 1D advection equation\n    with and without a data-driven closure for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {'A': 1, 'L': 1, 'c': 0.3, 'N': 32, 'n': 20, 'dt': 0.4},\n        {'A': 1, 'L': 1, 'c': 0.3, 'N': 32, 'n': 16, 'dt': 0.4},\n        {'A': 1, 'L': 1, 'c': 0.3, 'N': 32, 'n': 32, 'dt': 0.4},\n        {'A': 1, 'L': 1, 'c': 0.3, 'N': 32, 'n': 8, 'dt': 0.4},\n    ]\n\n    results = []\n    for case in test_cases:\n        A = case['A']\n        L = case['L']\n        c = case['c']\n        N = case['N']\n        n = case['n']\n        dt = case['dt']\n\n        # Determine the aliased mode index and wavenumber\n        n_alias = (((n + N // 2) % N) - N // 2)\n        k_true = 2 * np.pi * n / L\n        k_alias = 2 * np.pi * n_alias / L\n\n        e_no_closure = 0.0\n        e_closure = 0.0\n\n        if k_alias == 0:\n            # Special case: aliased to the zero-wavenumber mode (constant field).\n            # The model is static, so c_eff has no effect on the evolution.\n            # Thus, the closure error equals the no-closure error.\n            arg = c * k_true * dt\n            # Avoid division by zero if cos(arg) is zero. For the given test\n            # cases, this does not occur.\n            if np.isclose(np.cos(arg), 0):\n                e_no_closure = np.inf\n            else:\n                e_no_closure = abs(1 / np.cos(arg) - 1)\n            e_closure = e_no_closure\n        else:\n            # General case: k_alias is non-zero.\n            # The optimal closure can exactly match the phase of the true field\n            # by selecting the right c_eff, resulting in zero error.\n            e_closure = 0.0\n            \n            # Check for special case where n_alias = -n (Nyquist aliasing)\n            # or n_alias = n (well-resolved mode).\n            if n_alias == -n or n_alias == n:\n                # In these cases, the model without closure already produces\n                # zero error for this particular advection problem.\n                e_no_closure = 0.0\n            else:\n                # General aliasing case.\n                delta_k = k_alias - k_true\n                arg = c * delta_k * dt / 2\n                e_no_closure = abs(2 * np.sin(arg))\n        \n        results.append([round(e_no_closure, 6), round(e_closure, 6)])\n\n    # Format output to be a single string list of lists, with no spaces.\n    # e.g., [[e1no,e1cl],[e2no,e2cl]]\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "发现物理上一致的参数化方案，关键在于设计一个能够体现底层物理定律的训练目标。本练习将指导您构建一个复合损失函数，它不仅惩罚局部趋势的预测误差，还强制模型遵守能量和涡度守恒等基本物理约束，并匹配观测到的能谱斜率。",
            "id": "3873751",
            "problem": "考虑一个定义在双周期域 $\\Omega \\subset \\mathbb{R}^{2}$ (面积为 $|\\Omega|$) 上的正压准地转 (QG) 闭合项，其中正压涡度为 $\\zeta = \\nabla^{2} \\psi$，$\\psi$ 是流函数，雅可比算子为 $J(\\psi,\\zeta) = \\partial_{x} \\psi \\, \\partial_{y} \\zeta - \\partial_{y} \\psi \\, \\partial_{x} \\zeta$。带有参数化次网格闭合项 $\\mathcal{C}_{\\boldsymbol{\\theta}}$ 的粗粒化正压涡度方程为\n$$\n\\partial_{t} \\zeta + J(\\psi,\\zeta) = f + d + \\mathcal{C}_{\\boldsymbol{\\theta}}(q),\n$$\n其中 $f$ 和 $d$ 分别是已解析的大尺度强迫和耗散，$q$ 表示输入闭合项的粗粒化变量。给定一个包含 $N$ 个样本的训练集 $\\{(q^{(n)},\\psi^{(n)},T^{\\mathrm{ref}(n)},P_{E}^{*(n)},P_{Z}^{*(n)},E_{k}^{\\mathrm{obs}(n)}(\\kappa))\\}_{n=1}^{N}$，其中 $T^{\\mathrm{ref}(n)}$ 是从高分辨率真值推导出的粗粒化“参考”次网格倾向，$P_{E}^{*(n)}$ 和 $P_{Z}^{*(n)}$ 是闭合项需要匹配的目标能量和拟涡能产生率，$E_{k}^{\\mathrm{obs}(n)}(\\kappa)$ 是用于定义惯性区坡度目标的观测各向同性动能谱。假设以下基本依据和定义：\n\n- 域积分动能密度为 $E = \\frac{1}{2|\\Omega|} \\int_{\\Omega} |\\nabla \\psi|^{2} \\, \\mathrm{d}\\mathbf{x}$，拟涡能密度为 $Z = \\frac{1}{2|\\Omega|} \\int_{\\Omega} \\zeta^{2} \\, \\mathrm{d}\\mathbf{x}$。\n\n- 根据 QG 能量学和周期性边界条件，在给定样本 $n$ 处，闭合项对能量和拟涡能产生率的贡献定义为\n$$\nP_{E}^{(n)}(\\boldsymbol{\\theta}) = -\\frac{1}{|\\Omega|} \\int_{\\Omega} \\psi^{(n)}(\\mathbf{x}) \\, \\mathcal{C}_{\\boldsymbol{\\theta}}(q^{(n)})(\\mathbf{x}) \\, \\mathrm{d}\\mathbf{x}, \\quad\nP_{Z}^{(n)}(\\boldsymbol{\\theta}) = \\frac{1}{|\\Omega|} \\int_{\\Omega} \\zeta^{(n)}(\\mathbf{x}) \\, \\mathcal{C}_{\\boldsymbol{\\theta}}(q^{(n)})(\\mathbf{x}) \\, \\mathrm{d}\\mathbf{x}.\n$$\n\n- 令 $\\kappa$ 表示各向同性波数大小。在惯性子区 $[\\kappa_{1},\\kappa_{2}]$ 内，一个物理一致的动能谱遵循幂律 $E_{k}(\\kappa) \\propto \\kappa^{s^{*}}$，其目标坡度 $s^{*}$ 由观测到的 $E_{k}^{\\mathrm{obs}(n)}(\\kappa)$ 给出；谱坡度的准确性将通过对数-对数导数 $\\frac{\\mathrm{d}\\ln E_{k}}{\\mathrm{d}\\ln \\kappa}$ 与 $s^{*}$ 的偏差进行惩罚。\n\n您的任务是为基于深度学习的参数化发现寻找一个无量纲复合训练损失函数，该函数同时惩罚：(i) 局部倾向误差，(ii) 守恒预算残差，和 (iii) 谱坡度不准确性。假设每个残差都独立服从高斯分布，其尺度参数（分别为 $\\sigma_{\\mathrm{t}}$、$\\sigma_{\\mathrm{E}}$、$\\sigma_{\\mathrm{Z}}$ 和 $\\sigma_{\\mathrm{s}}$）未知。各分量定义如下：\n\n- 在数据集上平均的局部倾向误差为\n$$\n\\mathcal{E}_{\\mathrm{tend}}(\\boldsymbol{\\theta}) = \\frac{1}{N} \\sum_{n=1}^{N} \\frac{1}{|\\Omega|} \\int_{\\Omega} \\left( \\mathcal{C}_{\\boldsymbol{\\theta}}(q^{(n)})(\\mathbf{x}) - T^{\\mathrm{ref}(n)}(\\mathbf{x}) \\right)^{2} \\, \\mathrm{d}\\mathbf{x}.\n$$\n\n- 在数据集上平均的能量和拟涡能预算残差为\n$$\n\\mathcal{E}_{\\mathrm{bud,E}}(\\boldsymbol{\\theta}) = \\frac{1}{N} \\sum_{n=1}^{N} \\left( P_{E}^{(n)}(\\boldsymbol{\\theta}) - P_{E}^{*(n)} \\right)^{2}, \\quad\n\\mathcal{E}_{\\mathrm{bud,Z}}(\\boldsymbol{\\theta}) = \\frac{1}{N} \\sum_{n=1}^{N} \\left( P_{Z}^{(n)}(\\boldsymbol{\\theta}) - P_{Z}^{*(n)} \\right)^{2}.\n$$\n\n- 在数据集上平均的谱坡度不准确性为\n$$\n\\mathcal{E}_{\\mathrm{spec}}(\\boldsymbol{\\theta}) = \\frac{1}{N} \\sum_{n=1}^{N} \\int_{\\ln \\kappa_{1}}^{\\ln \\kappa_{2}} W(\\kappa) \\left( \\frac{\\mathrm{d}}{\\mathrm{d}\\ln \\kappa} \\ln E_{k}^{(n)}(\\kappa;\\boldsymbol{\\theta}) - s^{*} \\right)^{2} \\, \\mathrm{d}(\\ln \\kappa),\n$$\n其中 $W(\\kappa)$ 是一个非负权重，经过归一化以满足 $\\int_{\\ln \\kappa_{1}}^{\\ln \\kappa_{2}} W(\\kappa) \\, \\mathrm{d}(\\ln \\kappa) = 1$，从而确保惩罚项是无量纲的；$E_{k}^{(n)}(\\kappa;\\boldsymbol{\\theta})$ 表示与样本 $n$ 的粗粒化状态和闭合项相关的各向同性动能谱。\n\n请从第一性原理和高斯残差模型出发，构建一个单一闭式解析表达式，用于表示结合了上述三个分量的无量纲复合负对数似然损失 $L(\\boldsymbol{\\theta},\\sigma_{\\mathrm{t}},\\sigma_{\\mathrm{E}},\\sigma_{\\mathrm{Z}},\\sigma_{\\mathrm{s}})$。最终答案必须是一个单一的闭式解析表达式。最终答案中不需要单位。不要四舍五入；需要一个精确的符号表达式。",
            "solution": "该问题要求为准地转模型中基于深度学习的参数化构建一个无量纲复合负对数似然损失函数，记为 $L(\\boldsymbol{\\theta},\\sigma_{\\mathrm{t}},\\sigma_{\\mathrm{E}},\\sigma_{\\mathrm{Z}},\\sigma_{\\mathrm{s}})$。此过程始于对问题陈述的验证。\n\n### 第一步：提取已知条件\n-",
            "answer": "$$\n\\boxed{\\frac{1}{2\\sigma_{\\mathrm{t}}^2 N} \\sum_{n=1}^{N} \\frac{1}{|\\Omega|} \\int_{\\Omega} \\! \\left( \\mathcal{C}_{\\boldsymbol{\\theta}}(q^{(n)})(\\mathbf{x}) - T^{\\mathrm{ref}(n)}(\\mathbf{x}) \\right)^{2} \\mathrm{d}\\mathbf{x} + \\frac{1}{2\\sigma_{\\mathrm{E}}^2 N} \\sum_{n=1}^{N} \\left( P_{E}^{(n)}(\\boldsymbol{\\theta}) - P_{E}^{*(n)} \\right)^{2} + \\frac{1}{2\\sigma_{\\mathrm{Z}}^2 N} \\sum_{n=1}^{N} \\left( P_{Z}^{(n)}(\\boldsymbol{\\theta}) - P_{Z}^{*(n)} \\right)^{2} + \\frac{1}{2\\sigma_{\\mathrm{s}}^2 N} \\sum_{n=1}^{N} \\int_{\\ln \\kappa_{1}}^{\\ln \\kappa_{2}} \\! W(\\kappa) \\left( \\frac{\\mathrm{d}}{\\mathrm{d}\\ln \\kappa} \\ln E_{k}^{(n)}(\\kappa;\\boldsymbol{\\theta}) - s^{*} \\right)^{2} \\mathrm{d}(\\ln \\kappa) + \\ln(\\sigma_{\\mathrm{t}}) + \\ln(\\sigma_{\\mathrm{E}}) + \\ln(\\sigma_{\\mathrm{Z}}) + \\ln(\\sigma_{\\mathrm{s}})}\n$$"
        },
        {
            "introduction": "训练好的参数化方案必须经过严格的物理一致性检验，其中最重要的一项是验证其是否遵守能量守恒定律。本练习模拟了一个评估过程，您将计算一个深度学习对流闭合方案在一个简化的湿静力能量收支模型中引入的能量收支不平衡，并评估该不平衡的统计显著性。",
            "id": "3873646",
            "problem": "考虑一个大气柱的单柱湿静力能量收支，其中柱积分湿静力能量定义为 $h = c_p T + L_v q + g z$，柱积分为 $H = \\int_0^{z_t} \\rho h \\, dz$。这里，$c_p$ 是空气的定压比热，$T$ 是温度，$L_v$ 是蒸发潜热，$q$ 是比湿，$g$ 是重力加速度，$\\rho$ 是空气密度，$z_t$ 是柱顶高度。在柱尺度上，$H$ 的能量守恒遵循以下收支方程\n$$\n\\frac{\\partial H}{\\partial t} = R + S + A + C + \\varepsilon,\n$$\n其中 $R$ 是进入气柱的净辐射加热，$S$ 是进入气柱的净地表焓通量，$A$ 是湿静力能量的净水平平流输入，$C$ 是次网格对流湿静力能量趋势项，而 $\\varepsilon$ 是由诊断、离散化或参数化误差引起的残差不平衡。所有通量项 $R$、$S$、$A$ 和 $C$ 以及 $\\partial_t H$ 都应被视为单位为 $\\mathrm{W\\,m^{-2}}$ 的柱积分趋势项。\n\n给定一个由深度学习参数化发现模型生成的对流闭合方案 $C_\\theta(t)$。该闭合方案近似为可用解析尺度气柱诊断量的非线性映射，\n$$\nC_\\theta(t) = \\alpha_0 + \\alpha_1 \\tanh\\!\\Big(\\beta_1 \\frac{S(t) - S_0}{S_{\\mathrm{amp}}}\\Big) + \\alpha_2 \\tanh\\!\\Big(\\beta_2 \\frac{R(t) - R_0}{R_{\\mathrm{amp}}}\\Big) + \\alpha_3 \\tanh\\!\\Big(\\beta_3 \\frac{A(t) - A_0}{A_{\\mathrm{amp}}}\\Big) - \\chi \\big(R(t) + S(t) + A(t)\\big),\n$$\n其中 $\\alpha_0$、$\\alpha_1$、$\\alpha_2$、$\\alpha_3$、$\\beta_1$、$\\beta_2$、$\\beta_3$ 和 $\\chi$ 是闭合参数。你必须计算该闭合方案所蕴含的 $\\varepsilon(t)$，并在明确的测量和模型不确定性下评估其统计显著性。\n\n为本问题之目的，解析尺度诊断量遵循对于日循环而言科学上合理的确定性周期轨迹。对于给定的时间步数 $N$ 和角频率 $\\omega = 2\\pi/N$（单位为弧度），定义 $t = 0, 1, \\dots, N-1$ 时，\n- $R(t) = R_0 + R_{\\mathrm{amp}} \\sin(\\omega t)$,\n- $S(t) = S_0 + S_{\\mathrm{amp}} \\cos(\\omega t)$,\n- $A(t) = A_0 + A_{\\mathrm{amp}} \\sin(2\\omega t)$.\n\n为得到一个与通量相比很小的气柱储存项，我们构建一个物理上一致的参考对流趋势项，以模拟一个具有温和变率的近稳态气柱：\n$$\nC_{\\mathrm{true}}(t) = -\\big(R(t) + S(t) + A(t)\\big) + D_0 + D_{\\mathrm{amp}} \\sin\\!\\big(\\omega t + \\phi\\big),\n$$\n其中 $\\phi$ 是一个指定的相移（单位为弧度）。诊断出的储存趋势项则为\n$$\n\\frac{\\partial H}{\\partial t}(t) = R(t) + S(t) + A(t) + C_{\\mathrm{true}}(t).\n$$\n\n给定各诊断量 $R$、$S$、$A$、$\\partial_t H$ 和闭合项 $C_\\theta$ 的不确定性 $\\sigma_R$、$\\sigma_S$、$\\sigma_A$、$\\sigma_{\\partial H}$ 和 $\\sigma_C$（单位均为 $\\mathrm{W\\,m^{-2}}$），假设在时间和各项上误差是独立的、零均值的高斯误差。在这些假设下，时间平均不平衡量 $\\bar{\\varepsilon} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\varepsilon(t)$ 的标准误为\n$$\n\\mathrm{SE}(\\bar{\\varepsilon}) = \\sqrt{\\frac{\\sigma_R^2 + \\sigma_S^2 + \\sigma_A^2 + \\sigma_{\\partial H}^2 + \\sigma_C^2}{N}}.\n$$\n定义 $z$-分数 $z = |\\bar{\\varepsilon}| / \\mathrm{SE}(\\bar{\\varepsilon})$，并使用高斯临界值 $z_{0.95} = 1.96$ 在双边 95% 置信水平上评估统计显著性。报告 $z > 1.96$ 是否成立。\n\n你的任务是实现一个程序，对每个测试用例，计算时间序列 $\\varepsilon(t) = \\frac{\\partial H}{\\partial t}(t) - \\big(R(t) + S(t) + A(t) + C_\\theta(t)\\big)$、其时间平均值 $\\bar{\\varepsilon}$、标准误 $\\mathrm{SE}(\\bar{\\varepsilon})$，并确定显著性布尔值 $z > 1.96$。将平均残差不平衡量 $\\bar{\\varepsilon}$ 以 $\\mathrm{W\\,m^{-2}}$ 为单位表示，并四舍五入到三位小数。角度（相位 $\\phi$ 和三角函数参数）必须以弧度处理。\n\n测试套件：\n为以下四个参数集提供结果。对于每种情况，程序必须完全按照给定的值进行计算。\n\n- 情况 1（一般日变化，中等不确定性）：\n  - $N = 24$, $R_0 = -50$, $R_{\\mathrm{amp}} = 15$, $S_0 = 100$, $S_{\\mathrm{amp}} = 25$, $A_0 = 10$, $A_{\\mathrm{amp}} = 8$, $D_0 = 3$, $D_{\\mathrm{amp}} = 2$, $\\phi = \\pi/6$, 闭合参数: $\\alpha_0 = 0$, $\\alpha_1 = 8$, $\\beta_1 = 1.0$, $\\alpha_2 = -5$, $\\beta_2 = 1.2$, $\\alpha_3 = 2$, $\\beta_3 = 0.8$, $\\chi = 0.92$, 不确定性: $\\sigma_R = 3.0$, $\\sigma_S = 5.0$, $\\sigma_A = 2.0$, $\\sigma_{\\partial H} = 1.0$, $\\sigma_C = 4.0$.\n- 情况 2（大不确定性，近平衡闭合）：\n  - $N = 12$, $R_0 = -30$, $R_{\\mathrm{amp}} = 12$, $S_0 = 80$, $S_{\\mathrm{amp}} = 20$, $A_0 = 5$, $A_{\\mathrm{amp}} = 4$, $D_0 = 0.5$, $D_{\\mathrm{amp}} = 1.0$, $\\phi = \\pi/3$, 闭合参数: $\\alpha_0 = 0$, $\\alpha_1 = 5$, $\\beta_1 = 0.7$, $\\alpha_2 = -3$, $\\beta_2 = 1.1$, $\\alpha_3 = 1$, $\\beta_3 = 0.5$, $\\chi = 0.99$, 不确定性: $\\sigma_R = 10.0$, $\\sigma_S = 12.0$, $\\sigma_A = 6.0$, $\\sigma_{\\partial H} = 8.0$, $\\sigma_C = 10.0$.\n- 情况 3（强闭合偏差，小不确定性）：\n  - $N = 60$, $R_0 = -40$, $R_{\\mathrm{amp}} = 20$, $S_0 = 120$, $S_{\\mathrm{amp}} = 30$, $A_0 = 15$, $A_{\\mathrm{amp}} = 10$, $D_0 = 2$, $D_{\\mathrm{amp}} = 3$, $\\phi = \\pi/4$, 闭合参数: $\\alpha_0 = 10$, $\\alpha_1 = -2$, $\\beta_1 = 1.5$, $\\alpha_2 = 4$, $\\beta_2 = 0.9$, $\\alpha_3 = -1$, $\\beta_3 = 1.2$, $\\chi = 0.75$, 不确定性: $\\sigma_R = 2.0$, $\\sigma_S = 3.0$, $\\sigma_A = 2.0$, $\\sigma_{\\partial H} = 1.0$, $\\sigma_C = 2.0$.\n- 情况 4（小样本，中等不确定性）：\n  - $N = 10$, $R_0 = -35$, $R_{\\mathrm{amp}} = 10$, $S_0 = 90$, $S_{\\mathrm{amp}} = 15$, $A_0 = 8$, $A_{\\mathrm{amp}} = 6$, $D_0 = 1$, $D_{\\mathrm{amp}} = 1.5$, $\\phi = \\pi/8$, 闭合参数: $\\alpha_0 = 0$, $\\alpha_1 = 1$, $\\beta_1 = 1.0$, $\\alpha_2 = 1, \\beta_2 = 1.0$, $\\alpha_3 = 1, \\beta_3 = 1.0$, $\\chi = 0.98$, 不确定性: $\\sigma_R = 4.0$, $\\sigma_S = 6.0$, $\\sigma_A = 3.0$, $\\sigma_{\\partial H} = 2.0$, $\\sigma_C = 5.0$.\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，输出配对 $[\\bar{\\varepsilon}, \\text{is\\_significant}]$，其中 $\\bar{\\varepsilon}$ 是以 $\\mathrm{W\\,m^{-2}}$ 为单位、四舍五入到三位小数的平均残差不平衡量，而 $\\text{is\\_significant}$ 是一个指示 $z > 1.96$ 是否成立的布尔值。最终输出必须如下所示\n$$\n\\big[[\\bar{\\varepsilon}_1,\\text{is\\_significant}_1],[\\bar{\\varepsilon}_2,\\text{is\\_significant}_2],[\\bar{\\varepsilon}_3,\\text{is\\_significant}_3],[\\bar{\\varepsilon}_4,\\text{is\\_significant}_4]\\big].\n$$",
            "solution": "用户提供了一个问题，要求在一个简化的大气湿静力能量收支框架内，评估一个基于深度学习的对流参数化方案。核心任务是计算时间平均残差能量不平衡量 $\\bar{\\varepsilon}$，并在测量和模型不确定性下评估其统计显著性。\n\n### 步骤 1：提取已知条件\n\n**方程与定义：**\n- 柱积分湿静力能量收支：$\\frac{\\partial H}{\\partial t} = R + S + A + C + \\varepsilon$\n- 提出的对流闭合项 ($C_\\theta$)：$C_\\theta(t) = \\alpha_0 + \\alpha_1 \\tanh\\!\\Big(\\beta_1 \\frac{S(t) - S_0}{S_{\\mathrm{amp}}}\\Big) + \\alpha_2 \\tanh\\!\\Big(\\beta_2 \\frac{R(t) - R_0}{R_{\\mathrm{amp}}}\\Big) + \\alpha_3 \\tanh\\!\\Big(\\beta_3 \\frac{A(t) - A_0}{A_{\\mathrm{amp}}}\\Big) - \\chi \\big(R(t) + S(t) + A(t)\\big)$\n- 对于 $t = 0, 1, \\dots, N-1$ 且 $\\omega = 2\\pi/N$ 的解析尺度诊断量轨迹：\n  - $R(t) = R_0 + R_{\\mathrm{amp}} \\sin(\\omega t)$\n  - $S(t) = S_0 + S_{\\mathrm{amp}} \\cos(\\omega t)$\n  - $A(t) = A_0 + A_{\\mathrm{amp}} \\sin(2\\omega t)$\n- 物理上一致的参考对流趋势项 ($C_{\\mathrm{true}}$)：$C_{\\mathrm{true}}(t) = -\\big(R(t) + S(t) + A(t)\\big) + D_0 + D_{\\mathrm{amp}} \\sin\\!\\big(\\omega t + \\phi\\big)$\n- 诊断出的储存趋势项：$\\frac{\\partial H}{\\partial t}(t) = R(t) + S(t) + A(t) + C_{\\mathrm{true}}(t)$\n- 残差不平衡：$\\varepsilon(t) = \\frac{\\partial H}{\\partial t}(t) - \\big(R(t) + S(t) + A(t) + C_\\theta(t)\\big)$\n- 时间平均不平衡量：$\\bar{\\varepsilon} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\varepsilon(t)$\n- 平均不平衡量的标准误：$\\mathrm{SE}(\\bar{\\varepsilon}) = \\sqrt{\\frac{\\sigma_R^2 + \\sigma_S^2 + \\sigma_A^2 + \\sigma_{\\partial H}^2 + \\sigma_C^2}{N}}$\n- $z$-分数：$z = |\\bar{\\varepsilon}| / \\mathrm{SE}(\\bar{\\varepsilon})$\n- 显著性判据：$z > 1.96$（双边 95% 置信水平）\n\n**测试用例：**\n- **情况 1**：$N = 24$, $R_0 = -50$, $R_{\\mathrm{amp}} = 15$, $S_0 = 100$, $S_{\\mathrm{amp}} = 25$, $A_0 = 10$, $A_{\\mathrm{amp}} = 8$, $D_0 = 3$, $D_{\\mathrm{amp}} = 2$, $\\phi = \\pi/6$, $\\alpha_0 = 0$, $\\alpha_1 = 8$, $\\beta_1 = 1.0$, $\\alpha_2 = -5$, $\\beta_2 = 1.2$, $\\alpha_3 = 2$, $\\beta_3 = 0.8$, $\\chi = 0.92$, $\\sigma_R = 3.0$, $\\sigma_S = 5.0$, $\\sigma_A = 2.0$, $\\sigma_{\\partial H} = 1.0$, $\\sigma_C = 4.0$.\n- **情况 2**：$N = 12$, $R_0 = -30$, $R_{\\mathrm{amp}} = 12$, $S_0 = 80$, $S_{\\mathrm{amp}} = 20$, $A_0 = 5$, $A_{\\mathrm{amp}} = 4$, $D_0 = 0.5$, $D_{\\mathrm{amp}} = 1.0$, $\\phi = \\pi/3$, $\\alpha_0 = 0$, $\\alpha_1 = 5$, $\\beta_1 = 0.7$, $\\alpha_2 = -3$, $\\beta_2 = 1.1$, $\\alpha_3 = 1$, $\\beta_3 = 0.5$, $\\chi = 0.99$, $\\sigma_R = 10.0$, $\\sigma_S = 12.0$, $\\sigma_A = 6.0$, $\\sigma_{\\partial H} = 8.0$, $\\sigma_C = 10.0$.\n- **情况 3**：$N = 60$, $R_0 = -40$, $R_{\\mathrm{amp}} = 20$, $S_0 = 120$, $S_{\\mathrm{amp}} = 30$, $A_0 = 15$, $A_{\\mathrm{amp}} = 10$, $D_0 = 2$, $D_{\\mathrm{amp}} = 3$, $\\phi = \\pi/4$, $\\alpha_0 = 10$, $\\alpha_1 = -2$, $\\beta_1 = 1.5$, $\\alpha_2 = 4$, $\\beta_2 = 0.9$, $\\alpha_3 = -1$, $\\beta_3 = 1.2$, $\\chi = 0.75$, $\\sigma_R = 2.0$, $\\sigma_S = 3.0$, $\\sigma_A = 2.0$, $\\sigma_{\\partial H} = 1.0$, $\\sigma_C = 2.0$.\n- **情况 4**：$N = 10$, $R_0 = -35$, $R_{\\mathrm{amp}} = 10$, $S_0 = 90$, $S_{\\mathrm{amp}} = 15$, $A_0 = 8$, $A_{\\mathrm{amp}} = 6$, $D_0 = 1$, $D_{\\mathrm{amp}} = 1.5$, $\\phi = \\pi/8$, $\\alpha_0 = 0$, $\\alpha_1 = 1$, $\\beta_1 = 1.0$, $\\alpha_2 = 1, \\beta_2 = 1.0$, $\\alpha_3 = 1, \\beta_3 = 1.0$, $\\chi = 0.98$, $\\sigma_R = 4.0$, $\\sigma_S = 6.0$, $\\sigma_A = 3.0$, $\\sigma_{\\partial H} = 2.0$, $\\sigma_C = 5.0$.\n\n### 步骤 2：使用提取的已知条件进行验证\n\n该问题具有科学依据、是良定的且客观的。\n1.  **科学合理性**：该问题使用了一个简化但概念上有效的大气柱能量收支模型。这类简化在理论气象学和测试数值方案中是标准做法。参数化和强迫项的函数形式对于建模练习来说是合理的表示。在此模型背景下，所有方程在数学上和物理上都是一致的。\n2.  **良定性**：为每个测试用例提供了所有必要的定义、方程和数值参数。问题是自洽的，没有矛盾。计算任务定义清晰，每个用例都有唯一的解。\n3.  **客观性**：问题以精确的数学和科学语言陈述。它不包含主观论断或歧义。\n\n### 步骤 3：结论与行动\n\n问题陈述是**有效的**。将提供一个解法。\n\n### 解法推导\n\n主要目标是计算时间平均残差 $\\bar{\\varepsilon}$ 并确定其是否具有统计显著性。该过程对每个测试用例都涉及几个计算步骤。\n\n**1. 残差计算的简化**\n\n残差不平衡 $\\varepsilon(t)$ 定义为诊断出的储存趋势项 $\\frac{\\partial H}{\\partial t}$ 与所有参数化的和解析尺度的通量趋势项之和的差：\n$$\n\\varepsilon(t) = \\frac{\\partial H}{\\partial t}(t) - \\big(R(t) + S(t) + A(t) + C_\\theta(t)\\big)\n$$\n问题为“真实”或诊断出的储存趋势项提供了一个表达式，该表达式基于参考对流趋势项 $C_{\\mathrm{true}}(t)$：\n$$\n\\frac{\\partial H}{\\partial t}(t) = R(t) + S(t) + A(t) + C_{\\mathrm{true}}(t)\n$$\n将此表达式代入 $\\varepsilon(t)$ 的方程中，可以得到一个关键的简化：\n$$\n\\varepsilon(t) = \\big(R(t) + S(t) + A(t) + C_{\\mathrm{true}}(t)\\big) - \\big(R(t) + S(t) + A(t) + C_\\theta(t)\\big)\n$$\n$R(t)$、$S(t)$ 和 $A(t)$ 项相互抵消，剩下：\n$$\n\\varepsilon(t) = C_{\\mathrm{true}}(t) - C_\\theta(t)\n$$\n此结果表明，残差不平衡就是真实对流趋势项与深度学习闭合方案预测值之间的差。这极大地简化了计算。\n\n**2. 算法步骤**\n\n对于每个测试用例，执行以下步骤：\n\n- **生成时间序列**：对于给定的时间步数 $N$，为 $t = 0, 1, \\dots, N-1$ 定义一个时间向量。角频率为 $\\omega = 2\\pi/N$。\n\n- **计算强迫项**：使用给定的正弦函数和特定于用例的参数，计算解析尺度诊断量 $R(t)$、$S(t)$ 和 $A(t)$ 的时间序列：\n  - $R(t) = R_0 + R_{\\mathrm{amp}} \\sin(\\omega t)$\n  - $S(t) = S_0 + S_{\\mathrm{amp}} \\cos(\\omega t)$\n  - $A(t) = A_0 + A_{\\mathrm{amp}} \\sin(2\\omega t)$\n\n- **计算真实对流趋势项**：使用计算出的强迫项来求得真实对流趋势项 $C_{\\mathrm{true}}(t)$：\n  $$\n  C_{\\mathrm{true}}(t) = -\\big(R(t) + S(t) + A(t)\\big) + D_0 + D_{\\mathrm{amp}} \\sin\\!\\big(\\omega t + \\phi\\big)\n  $$\n\n- **计算参数化对流趋势项**：使用其定义计算所提出闭合方案的预测值 $C_\\theta(t)$：\n  $$\n  C_\\theta(t) = \\alpha_0 + \\alpha_1 \\tanh\\!\\Big(\\beta_1 \\frac{S(t) - S_0}{S_{\\mathrm{amp}}}\\Big) + \\alpha_2 \\tanh\\!\\Big(\\beta_2 \\frac{R(t) - R_0}{R_{\\mathrm{amp}}}\\Big) + \\alpha_3 \\tanh\\!\\Big(\\beta_3 \\frac{A(t) - A_0}{A_{\\mathrm{amp}}}\\Big) - \\chi \\big(R(t) + S(t) + A(t)\\big)\n  $$\n  注意，$\\tanh$ 函数的参数可以简化。例如，$\\frac{S(t) - S_0}{S_{\\mathrm{amp}}} = \\frac{(S_0 + S_{\\mathrm{amp}} \\cos(\\omega t)) - S_0}{S_{\\mathrm{amp}}} = \\cos(\\omega t)$。$C_\\theta(t)$ 的完整表达式变为：\n  $$\n  C_\\theta(t) = \\alpha_0 + \\alpha_1 \\tanh(\\beta_1 \\cos(\\omega t)) + \\alpha_2 \\tanh(\\beta_2 \\sin(\\omega t)) + \\alpha_3 \\tanh(\\beta_3 \\sin(2\\omega t)) - \\chi \\big(R(t) + S(t) + A(t)\\big)\n  $$\n\n- **计算残差**：计算残差的时间序列 $\\varepsilon(t) = C_{\\mathrm{true}}(t) - C_\\theta(t)$。\n\n- **计算平均残差**：计算残差序列的时间平均值：\n  $$\n  \\bar{\\varepsilon} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\varepsilon(t)\n  $$\n  该值将四舍五入到三位小数。\n\n- **计算统计显著性**：\n  1.  使用给定的公式和不确定性值（$\\sigma_R, \\sigma_S, \\sigma_A, \\sigma_{\\partial H}, \\sigma_C$）计算平均值的标准误 $\\mathrm{SE}(\\bar{\\varepsilon})$：\n      $$\n      \\mathrm{SE}(\\bar{\\varepsilon}) = \\sqrt{\\frac{\\sigma_R^2 + \\sigma_S^2 + \\sigma_A^2 + \\sigma_{\\partial H}^2 + \\sigma_C^2}{N}}\n      $$\n  2.  计算 $z$-分数：\n      $$\n      z = \\frac{|\\bar{\\varepsilon}|}{\\mathrm{SE}(\\bar{\\varepsilon})}\n      $$\n  3.  通过将 $z$-分数与双边 95% 置信区间的临界值 $z_{0.95} = 1.96$ 进行比较，来确定结果是否具有统计显著性：\n      $$\n      \\text{is\\_significant} = (z > 1.96)\n      $$\n\n此过程将应用于问题陈述中指定的四个测试用例中的每一个，以生成最终结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the residual energy imbalance and its statistical significance\n    for a proposed convective parameterization across multiple test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general diurnal variability, moderate uncertainties)\n        {\n            \"N\": 24, \"R_0\": -50, \"R_amp\": 15, \"S_0\": 100, \"S_amp\": 25, \"A_0\": 10, \"A_amp\": 8,\n            \"D_0\": 3, \"D_amp\": 2, \"phi\": np.pi/6,\n            \"params\": {\"alpha_0\": 0, \"alpha_1\": 8, \"beta_1\": 1.0, \"alpha_2\": -5, \"beta_2\": 1.2,\n                       \"alpha_3\": 2, \"beta_3\": 0.8, \"chi\": 0.92},\n            \"sigmas\": {\"R\": 3.0, \"S\": 5.0, \"A\": 2.0, \"dH\": 1.0, \"C\": 4.0}\n        },\n        # Case 2 (large uncertainties, near-balanced closure)\n        {\n            \"N\": 12, \"R_0\": -30, \"R_amp\": 12, \"S_0\": 80, \"S_amp\": 20, \"A_0\": 5, \"A_amp\": 4,\n            \"D_0\": 0.5, \"D_amp\": 1.0, \"phi\": np.pi/3,\n            \"params\": {\"alpha_0\": 0, \"alpha_1\": 5, \"beta_1\": 0.7, \"alpha_2\": -3, \"beta_2\": 1.1,\n                       \"alpha_3\": 1, \"beta_3\": 0.5, \"chi\": 0.99},\n            \"sigmas\": {\"R\": 10.0, \"S\": 12.0, \"A\": 6.0, \"dH\": 8.0, \"C\": 10.0}\n        },\n        # Case 3 (strong closure bias, small uncertainties)\n        {\n            \"N\": 60, \"R_0\": -40, \"R_amp\": 20, \"S_0\": 120, \"S_amp\": 30, \"A_0\": 15, \"A_amp\": 10,\n            \"D_0\": 2, \"D_amp\": 3, \"phi\": np.pi/4,\n            \"params\": {\"alpha_0\": 10, \"alpha_1\": -2, \"beta_1\": 1.5, \"alpha_2\": 4, \"beta_2\": 0.9,\n                       \"alpha_3\": -1, \"beta_3\": 1.2, \"chi\": 0.75},\n            \"sigmas\": {\"R\": 2.0, \"S\": 3.0, \"A\": 2.0, \"dH\": 1.0, \"C\": 2.0}\n        },\n        # Case 4 (small sample, moderate uncertainties)\n        {\n            \"N\": 10, \"R_0\": -35, \"R_amp\": 10, \"S_0\": 90, \"S_amp\": 15, \"A_0\": 8, \"A_amp\": 6,\n            \"D_0\": 1, \"D_amp\": 1.5, \"phi\": np.pi/8,\n            \"params\": {\"alpha_0\": 0, \"alpha_1\": 1, \"beta_1\": 1.0, \"alpha_2\": 1, \"beta_2\": 1.0,\n                       \"alpha_3\": 1, \"beta_3\": 1.0, \"chi\": 0.98},\n            \"sigmas\": {\"R\": 4.0, \"S\": 6.0, \"A\": 3.0, \"dH\": 2.0, \"C\": 5.0}\n        }\n    ]\n\n    results = []\n    z_critical = 1.96\n\n    for case in test_cases:\n        # Unpack parameters\n        N = case[\"N\"]\n        R_0, R_amp = case[\"R_0\"], case[\"R_amp\"]\n        S_0, S_amp = case[\"S_0\"], case[\"S_amp\"]\n        A_0, A_amp = case[\"A_0\"], case[\"A_amp\"]\n        D_0, D_amp, phi = case[\"D_0\"], case[\"D_amp\"], case[\"phi\"]\n        \n        p = case[\"params\"]\n        alpha_0, alpha_1, beta_1 = p[\"alpha_0\"], p[\"alpha_1\"], p[\"beta_1\"]\n        alpha_2, beta_2 = p[\"alpha_2\"], p[\"beta_2\"]\n        alpha_3, beta_3 = p[\"alpha_3\"], p[\"beta_3\"]\n        chi = p[\"chi\"]\n        \n        s = case[\"sigmas\"]\n        sigma_R, sigma_S, sigma_A, sigma_dH, sigma_C = s[\"R\"], s[\"S\"], s[\"A\"], s[\"dH\"], s[\"C\"]\n\n        # Time vector and angular frequency\n        t = np.arange(N)\n        omega = 2 * np.pi / N\n\n        # 1. Generate forcing time series\n        R_t = R_0 + R_amp * np.sin(omega * t)\n        S_t = S_0 + S_amp * np.cos(omega * t)\n        A_t = A_0 + A_amp * np.sin(2 * omega * t)\n        \n        # 2. Compute C_true(t)\n        total_forcing = R_t + S_t + A_t\n        C_true_t = -total_forcing + D_0 + D_amp * np.sin(omega * t + phi)\n\n        # 3. Compute C_theta(t)\n        # Arguments for tanh simplify based on definitions of R(t), S(t), A(t)\n        term_S = alpha_1 * np.tanh(beta_1 * np.cos(omega * t))\n        term_R = alpha_2 * np.tanh(beta_2 * np.sin(omega * t))\n        term_A = alpha_3 * np.tanh(beta_3 * np.sin(2 * omega * t))\n        \n        C_theta_t = alpha_0 + term_S + term_R + term_A - chi * total_forcing\n        \n        # 4. Compute residual epsilon(t) and its mean\n        epsilon_t = C_true_t - C_theta_t\n        epsilon_bar = np.mean(epsilon_t)\n\n        # 5. Calculate statistical significance\n        # Sum of variances\n        variance_sum = sigma_R**2 + sigma_S**2 + sigma_A**2 + sigma_dH**2 + sigma_C**2\n        # Standard error of the mean\n        se_epsilon_bar = np.sqrt(variance_sum / N)\n        \n        # z-score\n        if se_epsilon_bar > 0:\n            z_score = np.abs(epsilon_bar) / se_epsilon_bar\n        else: # Avoid division by zero, though unlikely with given inputs\n            z_score = np.inf if np.abs(epsilon_bar) > 0 else 0\n            \n        # Significance check\n        is_significant = z_score > z_critical\n\n        # Append formatted result\n        results.append([round(epsilon_bar, 3), is_significant])\n        \n    # Format final output string\n    print(str(results).replace(\" \", \"\").replace(\"'\", \"\"))\n\nsolve()\n```"
        }
    ]
}