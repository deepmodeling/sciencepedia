{
    "hands_on_practices": [
        {
            "introduction": "理论学习的最终目的是应用于实践。在处理大气模型中的灰区问题时，第一步是准确判断哪些尺度上的现象是模型可以直接解析的，哪些是需要参数化的。本练习通过一个具体的计算任务，引导您评估一个对流单体的“可分辨性”，这不仅能帮助您理解网格分辨率和有效分辨率之间的差异，也为确定何时以及为何需要次网格参数化方案提供了量化依据。",
            "id": "3918979",
            "problem": "考虑一个在所谓的深对流灰色地带运行的大气模型，其中一些对流结构部分由解析动力学表示，部分由次网格参数化表示。水平网格间距为 $\\,\\Delta = 2\\,\\mathrm{km}\\,$，模型的数值计算表明有效分辨率因子为 $\\,6\\,$，这意味着由于数值扩散和频散，要可靠、能量一致地表示特征，需要一个至少为几个网格单元宽度的特征水平尺度。一个对流上升气流近似轴对称，半径为 $\\,r_{u} = 1\\,\\mathrm{km}\\,$。\n\n从网格间距的定义以及有效分辨率作为最小物理可信解析尺度的概念出发，按如下步骤进行：\n- 使用有效分辨率因子确定最小可解析水平长度尺度 $\\,\\lambda_{\\min}\\,$。\n- 将上升气流的特征水平尺度定义为其直径 $\\,D = 2 r_{u}\\,$。\n- 将可解析性比率 $\\,R\\,$ 定义为上升气流直径与最小可解析尺度的比值。\n- 基于关于接近 $\\,\\lambda_{\\min}\\,$ 尺度的谱内容和数值耗散的物理推理，使用 $\\,R\\,$ 将上升气流分类为显式解析、临界解析或未解析，并论证在灰色地带中为何需要或不需要次网格参数化。\n\n计算并报告可解析性比率 $\\,R\\,$。将最终数值答案表示为无量纲的小数值，并将答案四舍五入至四位有效数字。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 第1步：提取已知条件\n- 水平网格间距：$\\Delta = 2\\,\\mathrm{km}$\n- 有效分辨率因子：$6$\n- 上升气流半径：$r_{u} = 1\\,\\mathrm{km}$\n- 最小可解析水平长度尺度的定义：$\\lambda_{\\min}$ 由有效分辨率因子和网格间距确定。问题陈述指出，可靠的表示需要一个至少为此尺寸的特征尺度，即“几个网格单元的宽度”。\n- 上升气流特征水平尺度的定义：$D = 2 r_{u}$\n- 可解析性比率的定义：$R = \\frac{D}{\\lambda_{\\min}}$\n- 任务要求：计算 $R$，对上升气流的可解析性进行分类，并论证次网格参数化的必要性。$R$ 的最终值必须是四舍五入到四位有效数字的小数。\n\n### 第2步：使用提取的已知条件进行验证\n根据所需标准对问题进行评估。\n- **科学依据：** 该问题牢固地基于数值大气模拟的基本概念，特别是网格间距($\\Delta$)、有效分辨率($\\lambda_{\\min}$)与物理现象表示之间的关系。“灰色地带”这一概念，其中现象被部分解析和部分参数化，是现代天气和气候模拟的核心课题。提供的网格间距和上升气流尺寸的值在物理上是现实的。\n- **适定性：** 计算可解析性比率 $R$ 所需的所有必要信息和定义都已明确提供。问题结构逻辑清晰，引导用户从中间计算走向最终结论。存在唯一且有意义的解。\n- **客观性：** 问题以精确的技术语言表述，没有主观或模糊的术语。\n- **完整性与一致性：** 问题自洽且无矛盾。$\\lambda_{\\min}$、$D$ 和 $R$ 的定义彼此一致。\n\n### 第3步：结论与行动\n该问题被认为是有效的，因为其科学上合理、适定、客观且自洽。将提供完整解答。\n\n解题过程遵循问题陈述中概述的步骤。\n\n首先，我们确定最小可解析水平长度尺度 $\\lambda_{\\min}$。该尺度代表了数值模型能够以物理和能量上一致的方式表示的最小特征。它被定义为水平网格间距 $\\Delta$ 和有效分辨率因子的乘积。\n已知：\n- 水平网格间距, $\\Delta = 2\\,\\mathrm{km}$\n- 有效分辨率因子 = $6$\n\n最小可解析尺度的计算如下：\n$$\n\\lambda_{\\min} = 6 \\times \\Delta\n$$\n代入 $\\Delta$ 的值：\n$$\n\\lambda_{\\min} = 6 \\times 2\\,\\mathrm{km} = 12\\,\\mathrm{km}\n$$\n\n接下来，我们确定上升气流的特征水平尺度 $D$。它被定义为近似轴对称上升气流的直径。\n已知：\n- 上升气流半径, $r_{u} = 1\\,\\mathrm{km}$\n\n直径的计算如下：\n$$\nD = 2 r_{u}\n$$\n代入 $r_{u}$ 的值：\n$$\nD = 2 \\times 1\\,\\mathrm{km} = 2\\,\\mathrm{km}\n$$\n\n现在，我们计算可解析性比率 $R$，它被定义为上升气流直径与最小可解析尺度的比值。\n$$\nR = \\frac{D}{\\lambda_{\\min}}\n$$\n代入 $D$ 和 $\\lambda_{\\min}$ 的计算值：\n$$\nR = \\frac{2\\,\\mathrm{km}}{12\\,\\mathrm{km}} = \\frac{1}{6}\n$$\n为将其表示为小数值，我们进行除法运算：\n$$\nR = 0.16666...\n$$\n问题要求将答案四舍五入到四位有效数字。\n$$\nR \\approx 0.1667\n$$\n\n最后，我们根据 $R$ 的值对上升气流进行分类，并论证参数化的必要性。\n- **分类：** 可解析性比率 $R \\approx 0.1667$ 意味着上升气流的特征尺度（$D=2\\,\\mathrm{km}$）仅为模型能忠实解析的最小尺度（$\\lambda_{\\min}=12\\,\\mathrm{km}$）的约 $16.7\\%$。由于 $R \\ll 1$，该上升气流明确是**未解析**的。它太小了，无法被模型的解析动力学捕捉到。当 $R \\gg 1$ 时，特征被认为是“已解析的”，当 $R \\approx 1$ 时，则被认为是“临界解析的”（在灰色地带中）。\n\n- **参数化的理由：** 因为该上升气流是未解析的，其动力学、结构以及相关的热量、水汽和动量输送无法在模式网格上被显式表示。在模型解中，任何出现在该尺度上的特征都将是数值伪影，并受到数值扩散的严重阻尼。对流上升气流对大尺度环境的物理效应将在模拟中缺失。因此，为了解释这些关键的次网格尺度过程，**次网格参数化方案是必不可少的**。该方案必须代表这类未解析上升气流的集体统计效应，从而将其影响纳入到解析尺度的大气状态中。这种情况是一个经典的例子，说明了为什么即使模型分辨率提高并进入“灰色地带”，参数化仍然是必需的。",
            "answer": "$$\n\\boxed{0.1667}\n$$"
        },
        {
            "introduction": "当模型分辨率进入灰区，参数化方案不能再简单地“一刀切”，而必须能够感知尺度变化并作出调整。本练习将指导您从几个基本的物理公理出发，推导出一个关键的“尺度感知节流函数”。这个函数能够根据模型网格与对流特征尺度之比，平滑地调节参数化方案的强度，是构建能在不同分辨率下稳定运行的现代化参数化方案的核心思想之一。",
            "id": "3918999",
            "problem": "考虑一个在大气模拟的所谓“灰色地带”中运行的尺度感知对流参数化方案，其中水平网格间距 $\\Delta$ 与特征对流长度尺度 $L_c$相当。将参数化的对流趋势表示为 $\\mathcal{C}_p$，并定义一个节流系数 $B(\\Delta/L_c;\\alpha,\\beta)$，使得模型中应用的有效参数化趋势为 $B\\,\\mathcal{C}_p$。系数 $B$ 必须满足以下公理，这些公理源于对已解析和未解析对流活动的物理动机划分：\n- $B$ 是无量纲的，并且仅取决于尺度比 $x=\\Delta/L_c$。\n- $B$ 对 $x$ 是单调递增的，其极限行为为：当 $x\\to 0$ 时（细网格，对流大部分被解析），$B(x)\\to 0$；当 $x\\to \\infty$ 时（粗网格，对流大部分未被解析），$B(x)\\to 1$。\n- 假设已解析和参数化对流活动之间的划分遵循尺度分离幂律：已解析活动与参数化活动之比按 $x^{-\\alpha}$ 比例缩放，其中 $\\alpha>0$ 表征了分辨率将活动从参数化分量转移到已解析分量的速度。\n- 从该划分到应用于趋势的节流的映射允许为非线性，由指数 $\\beta>0$ 表示，该指数捕捉了节流相对于活动划分的凹性。\n\n从这些公理出发，不使用任何其他特定公式，推导与所述行为和假设一致的最小平滑饱和函数 $B(x;\\alpha,\\beta)$。然后，使用您推导出的 $B$，计算当 $\\alpha=6$ 和 $\\beta=1$ 时，在 $x=\\Delta/L_c\\in\\{0.5,1,2\\}$ 处的数值。清晰地陈述这三个尺度比下 $B$ 的数值。\n\n将 $B$ 的最终值表示为无量纲小数。将您的答案四舍五入到四位有效数字。",
            "solution": "问题陈述已经过评估并被确定为有效。它在科学上基于大气模拟的原理，在其公理的标准物理解释下是适定的，并且没有内部矛盾或歧义。\n\n任务是基于一组物理公理推导出一个尺度感知节流系数函数 $B(x;\\alpha,\\beta)$，然后为一组特定参数计算其值。令尺度比为 $x = \\Delta/L_c$，其中 $\\Delta$ 是网格间距，$L_c$ 是特征对流长度尺度。\n\n核心物理概念是将总对流活动 $A_{total}$ 划分为一个已解析分量 $A_r$ 和一个未解析（参数化）分量 $A_p$。因此，$A_{total} = A_r + A_p$。节流系数 $B$ 表示由参数化处理的总活动的分数。因此，$B$ 的一个逻辑定义是参数化活动与总活动之比：\n$$\nB \\propto \\frac{A_p}{A_{total}} = \\frac{A_p}{A_r + A_p}\n$$\n这可以改写为已解析活动与参数化活动之比的形式：\n$$\n\\frac{A_p}{A_r + A_p} = \\frac{1}{\\frac{A_r}{A_p} + 1}\n$$\n公理3指出，已解析活动与参数化活动之比遵循尺度分离幂律：$\\frac{A_r}{A_p}$ 按 $x^{-\\alpha}$ 比例缩放。我们可以将其写成一个带有比例常数 $k$ 的方程：\n$$\n\\frac{A_r}{A_p} = k x^{-\\alpha}\n$$\n其中 $\\alpha > 0$。常数 $k$ 必须为正。将此代入我们关于活动划分的表达式中，得到一个初步的函数形式：\n$$\nP(x) = \\frac{1}{k x^{-\\alpha} + 1} = \\frac{x^{\\alpha}}{x^{\\alpha} + k}\n$$\n这里，$P(x)$ 代表了活动的基本划分。问题要求“最小”函数 $B(x; \\alpha, \\beta)$，这意味着 $\\alpha$ 和 $\\beta$ 是仅有的自由参数。这需要我们确定 $k$。一个标准且具有物理意义的选择是假设在特征尺度本身，即当 $\\Delta = L_c$（对应于 $x=1$）时，已解析对流和参数化对流的贡献相等（$A_r = A_p$）。应用此条件：\n$$\n\\frac{A_r}{A_p} = 1 \\quad \\text{在} \\quad x=1\n$$\n$$\nk (1)^{-\\alpha} = 1 \\implies k=1\n$$\n选择 $k=1$ 使模型最小化且有物理基础。因此，划分函数 $P(x)$ 为：\n$$\nP(x) = \\frac{x^{\\alpha}}{x^{\\alpha} + 1}\n$$\n\n公理4引入了一个从该活动划分到最终节流系数 $B$ 的非线性映射，由指数 $\\beta > 0$ 控制。该公理指出 $\\beta$ “捕捉了节流相对于活动划分的凹性”。这种映射最直接的数学解释是幂律关系：\n$$\nB(x; \\alpha, \\beta) = [P(x)]^\\beta\n$$\n结合这些结果，得到节流系数的最终推导函数：\n$$\nB(x; \\alpha, \\beta) = \\left( \\frac{x^{\\alpha}}{x^{\\alpha} + 1} \\right)^{\\beta}\n$$\n让我们根据公理验证这个函数：\n1.  **无量纲且取决于 $x$**：比率 $x = \\Delta/L_c$ 是无量纲的。函数 $B$ 是量的幂的比值，因此也是无量纲的。此项满足。\n2.  **单调性与极限**：\n    - 当 $x \\to 0$ 时，$x^{\\alpha} \\to 0$（因为 $\\alpha>0$），所以 $B(x) \\to \\left(\\frac{0}{0+1}\\right)^\\beta = 0$。\n    - 当 $x \\to \\infty$ 时，$x^{\\alpha} \\to \\infty$。我们可以将括号内的分子和分母同时除以 $x^\\alpha$：$B(x) = \\left( \\frac{1}{1 + x^{-\\alpha}} \\right)^{\\beta}$。当 $x \\to \\infty$ 时，$x^{-\\alpha} \\to 0$，所以 $B(x) \\to \\left(\\frac{1}{1+0}\\right)^\\beta = 1$。两个极限都满足。\n    - 为检查单调性，我们计算关于 $x$ 的导数。令 $f(x) = \\frac{x^{\\alpha}}{x^{\\alpha} + 1}$。其导数为 $f'(x) = \\frac{\\alpha x^{\\alpha-1}(x^\\alpha+1) - x^\\alpha(\\alpha x^{\\alpha-1})}{(x^\\alpha+1)^2} = \\frac{\\alpha x^{\\alpha-1}}{(x^\\alpha+1)^2}$。对于 $x > 0$ 和 $\\alpha > 0$，$f'(x) > 0$。$B(x) = [f(x)]^\\beta$ 的导数是 $B'(x) = \\beta[f(x)]^{\\beta-1} f'(x)$。因为 $\\beta>0$，$f(x) \\ge 0$，且 $f'(x) > 0$，所以 $B'(x) \\ge 0$。该函数是单调递增的。\n\n所有公理都由推导出的函数 $B(x; \\alpha, \\beta) = \\left( \\frac{x^{\\alpha}}{x^{\\alpha} + 1} \\right)^{\\beta}$ 满足。这就是“最小平滑饱和函数”。\n\n现在，我们必须计算 $\\alpha=6$ 和 $\\beta=1$ 的特定情况下的数值。函数简化为：\n$$\nB(x; 6, 1) = \\frac{x^{6}}{x^{6} + 1}\n$$\n我们在给定的尺度比 $x \\in \\{0.5, 1, 2\\}$ 处计算该函数的值。\n\n对于 $x=0.5$：\n$$\nB(0.5) = \\frac{(0.5)^{6}}{(0.5)^{6} + 1} = \\frac{1/64}{1/64 + 1} = \\frac{1/64}{65/64} = \\frac{1}{65}\n$$\n作为小数，$\\frac{1}{65} \\approx 0.0153846...$。四舍五入到四位有效数字，结果是 $0.01538$。\n\n对于 $x=1$：\n$$\nB(1) = \\frac{1^{6}}{1^{6} + 1} = \\frac{1}{1 + 1} = \\frac{1}{2}\n$$\n作为小数，这正好是 $0.5$。对于四位有效数字，这是 $0.5000$。\n\n对于 $x=2$：\n$$\nB(2) = \\frac{2^{6}}{2^{6} + 1} = \\frac{64}{64 + 1} = \\frac{64}{65}\n$$\n作为小数，$\\frac{64}{65} \\approx 0.9846153...$。四舍五入到四位有效数字，结果是 $0.9846$。\n\n所要求的三个节流系数 $B$ 的值是 $0.01538$、$0.5000$ 和 $0.9846$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.01538 & 0.5000 & 0.9846\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "参数化方案的理论设计最终必须在动态的数值模型中得到检验。本练习是一个完整的计算实验，您将通过一个简化的耦合模型，探索数值积分策略（如时间步长 $\\Delta t$ 和参数化子步 $n_{\\text{sub}}$）如何影响解析尺度运动与次网格对流之间的能量交换。这个实践直观地揭示了在灰区中，物理过程与数值方法之间的复杂相互作用，以及实现稳定、合理的能量分配所面临的挑战。",
            "id": "3918997",
            "problem": "你需要设计并实现一个时间积分实验，以量化调整模型时间步长和子步长如何改变“灰色地带”中对流有效位能（CAPE）的消耗和解析的垂直运动，在灰色地带中，显式解析和次网格对流都有贡献。该实验必须以单柱模型的形式构建，使用一组简化但有科学依据的常微分方程，耦合解析的垂直速度和CAPE。\n\n使用以下基础和闭合方案：\n1. 垂直速度 $w$ 的 Boussinesq 垂直动量方程模型为\n$$\n\\frac{d w}{d t} = b - c_d w,\n$$\n其中 $b$ 是垂直浮力（加速度），$c_d$ 是线性拖曳系数，$t$ 是时间。\n2. 对流有效位能（CAPE），记为 $A$，定义为浮力的垂直积分：\n$$\nA = \\int_{z_0}^{z_T} b \\, dz,\n$$\n因此 $A$ 的单位是 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$（相当于 $\\mathrm{J}\\,\\mathrm{kg}^{-1}$）。\n3. 在适用于灰色地带的整体单柱闭合方案中，浮力近似为\n$$\nb \\approx \\frac{A}{L},\n$$\n其中 $L$ 是不稳定层的代表性深度（单位为 $\\mathrm{m}$），因此 $b$ 的单位是 $\\mathrm{m}\\,\\mathrm{s}^{-2}$。\n4. CAPE 收支包括两个汇项：一个与解析抬升相关的解析清除项，以及一个次网格对流参数化汇项：\n$$\n\\frac{d A}{d t} = - \\underbrace{\\kappa_r \\frac{|w| A}{L}}_{\\text{resolved removal}} - \\underbrace{\\kappa_c A}_{\\text{convective parameterization}}.\n$$\n这里，$\\kappa_r$ 是一个无量纲效率，$\\kappa_c$ 是一个速率（单位为 $\\mathrm{s}^{-1}$）。解析清除项与垂直运动 $|w|$ 和在深度 $L$ 上的可用能量 $A$ 成比例。\n\n您必须在一个固定的时间范围 $T$ 内模拟 $w(t)$ 和 $A(t)$ 的耦合演变，比较在外部模型时间步长 $\\Delta t$ 和在每个 $\\Delta t$ 内应用对流参数化的子步数 $n_{\\text{sub}}$ 的多种选择下的结果。在每个大小为 $\\Delta t$ 的外层步长内，应用以下算子分裂法：\n- 首先，对对流参数化趋势项 $-\\kappa_c A$ 应用 $n_{\\text{sub}}$ 个显式欧拉子步，每个子步的内部步长为 $\\Delta t_c = \\Delta t / n_{\\text{sub}}$。\n- 然后，使用根据对流后的 $A$ 计算出的浮力，通过显式欧拉法在整个 $\\Delta t$ 上更新 $w$：\n$$\nw \\leftarrow w + \\Delta t \\left( \\frac{A}{L} - c_d w \\right).\n$$\n- 最后，通过显式欧拉法在整个 $\\Delta t$ 上应用 CAPE 的解析清除：\n$$\nA \\leftarrow A - \\Delta t \\, \\kappa_r \\frac{|w| A}{L}.\n$$\n\n正性约束和核算：\n- 如果任何更新会导致 $A$ 变为负值，则将 $A$ 截断为 0，并将仅物理上可实现的部分归入相应的汇项。\n- 在整个模拟时间内，分别追踪非负积分 $C_{\\text{tot}}$ 和 $R_{\\text{tot}}$，它们分别定义为被对流参数化和解析清除消耗的总 CAPE（$\\mathrm{J}\\,\\mathrm{kg}^{-1}$）。\n\n单位和输出：\n- 垂直速度 $w$ 以 $\\mathrm{m}\\,\\mathrm{s}^{-1}$ 表示，CAPE 消耗以 $\\mathrm{J}\\,\\mathrm{kg}^{-1}$ 表示。\n- 对于每个测试用例，您的程序必须输出一个包含三个浮点数的列表 $[w_T, C_{\\text{tot}}, R_{\\text{tot}}]$，其中 $w_T$ 是在时间 $T$ 时的最终解析垂直速度，$C_{\\text{tot}}$ 是被对流参数化消耗的总 CAPE，$R_{\\text{tot}}$ 是被解析清除消耗的总 CAPE。\n\n所有情况下使用的模型常数：\n- 深度 $L = 1000\\,\\mathrm{m}$。\n- 拖曳系数 $c_d = 0.02\\,\\mathrm{s}^{-1}$。\n- 解析清除效率 $\\kappa_r = 0.5$（无量纲）。\n- 对流参数化速率 $\\kappa_c = 0.005\\,\\mathrm{s}^{-1}$。\n- 模拟时间范围 $T = 600\\,\\mathrm{s}$。\n\n初始条件：\n- 除非另有说明，否则使用 $A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$ 和 $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n\n时间积分细节：\n- 完全按照上述方式使用显式欧拉更新。\n- 使用 $N = \\lfloor T / \\Delta t \\rfloor$ 个外层步；忽略任何余下的时间。\n\n测试套件：\n运行以下参数集的模拟，以探究不同行为（正常路径、粗时间步长、强子步长和边缘情况）：\n1. 情况 1（参考细步长）：$\\Delta t = 1\\,\\mathrm{s}$，$n_{\\text{sub}} = 1$，$A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$，$w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n2. 情况 2（较粗步长，无子步长）：$\\Delta t = 30\\,\\mathrm{s}$，$n_{\\text{sub}} = 1$，$A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$，$w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n3. 情况 3（较粗步长，有子步长）：$\\Delta t = 30\\,\\mathrm{s}$，$n_{\\text{sub}} = 5$，$A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$，$w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n4. 情况 4（非常粗的步长，无子步长）：$\\Delta t = 120\\,\\mathrm{s}$，$n_{\\text{sub}} = 1$，$A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$，$w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n5. 情况 5（非常粗的步长，有子步长）：$\\Delta t = 120\\,\\mathrm{s}$，$n_{\\text{sub}} = 8$，$A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$，$w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n6. 情况 6（低初始 CAPE 边缘情况）：$\\Delta t = 30\\,\\mathrm{s}$，$n_{\\text{sub}} = 4$，$A_0 = 100\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$，$w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表形式的结果。此列表的每个元素对应一个测试用例，并且本身必须是包含三个浮点数 $[w_T, C_{\\text{tot}}, R_{\\text{tot}}]$ 的列表，单位如指定。例如，程序必须在单行上打印类似 $[[w_1,C_1,R_1],[w_2,C_2,R_2],\\dots]$ 的内容，不含任何额外文本。",
            "solution": "该问题提出了一个有效、适定且有科学依据的任务，旨在研究简化大气模型的数值行为。所有必要的参数、常数、初始条件和数值程序都已提供。该模型本身虽然经过简化，但基于已确立的浮力、拖曳和能量守恒物理原理，使其适用于次网格参数化背景下的计算实验。探索不同的时间步进策略（$\\Delta t$ 和 $n_{\\text{sub}}$）如何影响模型的演变，是计算科学中一个标准而有意义的问题。因此，该问题是有效的，可以构建一个解决方案。\n\n任务是使用一个耦合常微分方程组来模拟解析垂直速度 $w$ 和对流有效位能（CAPE）$A$ 的演变。该系统由以下方程给出：\n$$\n\\frac{d w}{d t} = \\frac{A}{L} - c_d w\n$$\n$$\n\\frac{d A}{d t} = - \\kappa_r \\frac{|w| A}{L} - \\kappa_c A\n$$\n其中 $L$ 是特征深度，$c_d$ 是拖曳系数，$\\kappa_r$ 是解析清除效率，$\\kappa_c$ 是对流参数化速率。\n\n解是通过使用算子分裂法和显式欧拉方案的数值时间积分得到的。总模拟时间范围为 $T = 600\\,\\mathrm{s}$。对于给定的外部时间步长 $\\Delta t$，积分步数为 $N = \\lfloor T / \\Delta t \\rfloor$。从时间 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 的每一步都包含三个顺序操作：\n\n1.  **对流参数化更新**：首先应用次网格对流项 $-\\kappa_c A$ 的影响。这是通过取 $n_{\\text{sub}}$ 个较小的时间步长来实现的，每个步长为 $\\Delta t_c = \\Delta t / n_{\\text{sub}}$。设 $A_n$ 是外层步长开始时的 CAPE。我们通过应用更新 $n_{\\text{sub}}$ 次来计算一个中间值 $A'_{n}$。对于从 $1$ 到 $n_{\\text{sub}}$ 的每个子步 $j$：\n    $$\n    A^{(j)} = A^{(j-1)} - \\Delta t_c \\cdot \\kappa_c \\cdot A^{(j-1)}\n    $$\n    其中 $A^{(0)} = A_n$。该参数化消耗的总 CAPE，$C_{\\text{tot}}$，被累加起来。在每一步，都会强制执行正性约束：如果更新会导致 $A  0$，则将 $A$ 设置为 0，并且只将实际移除的 CAPE 量添加到累加器中。设 $A'_{n}$ 为这 $n_{\\text{sub}}$ 个子步后 CAPE 的值。\n\n2.  **垂直速度更新**：然后使用显式欧拉法在整个时间步长 $\\Delta t$ 上更新垂直速度 $w$。浮力项使用对流后的 CAPE，$A'_{n}$。区间开始时的 $w$ 值为 $w_n$。\n    $$\n    w_{n+1} = w_n + \\Delta t \\left( \\frac{A'_{n}}{L} - c_d w_n \\right)\n    $$\n\n3.  **解析清除更新**：最后，由于解析清除项 $- \\kappa_r \\frac{|w| A}{L}$，CAPE 被更新。此更新也应用于整个时间步长 $\\Delta t$。遵循算子分裂的顺序性，此步骤使用对流后的 CAPE，$A'_{n}$，和新计算的速度 $w_{n+1}$。\n    $$\n    A_{n+1} = A'_{n} - \\Delta t \\cdot \\kappa_r \\frac{|w_{n+1}| A'_{n}}{L}\n    $$\n    由解析运动消耗的总 CAPE，$R_{\\text{tot}}$，被累加起来。同样，强制执行正性约束：$A_{n+1}$ 不能为负。\n\n这个三步过程重复 $N$ 个时间步。算法从初始条件 $A_0$ 和 $w_0$ 开始。模型常数在所有模拟中都是固定的：$L = 1000\\,\\mathrm{m}$，$c_d = 0.02\\,\\mathrm{s}^{-1}$，$\\kappa_r = 0.5$ 和 $\\kappa_c = 0.005\\,\\mathrm{s}^{-1}$。\n\n实现将包括一个主循环，该循环遍历所提供的测试用例。对于每个用例，一个模拟函数执行上述的时间步进循环。状态变量（$A$，$w$）和累加器（$C_{\\text{tot}}$，$R_{\\text{tot}}$）被初始化。模拟的核心是一个运行 $N$ 步的循环。在此循环内部，使用临时变量来正确管理算子分裂方案中的信息流，确保一个步骤的输出成为下一个步骤的输入，如上述逻辑中所详述。模拟完成后，收集最终的垂直速度 $w_T$ 和总消耗的 CAPE，$C_{\\text{tot}}$ 和 $R_{\\text{tot}}$。然后将所有测试用例的结果格式化为所需的单个列表的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a time integration experiment for a simplified\n    single-column atmospheric model to quantify CAPE consumption and vertical motion\n    under different time-stepping strategies.\n    \"\"\"\n\n    # --- Model Constants ---\n    L = 1000.0  # Representative depth of the unstable layer [m]\n    c_d = 0.02  # Linear drag coefficient [s^-1]\n    kappa_r = 0.5  # Resolved removal efficiency [dimensionless]\n    kappa_c = 0.005 # Convective parameterization rate [s^-1]\n    T = 600.0   # Simulation horizon [s]\n    \n    # --- Test Suite ---\n    # Each tuple represents a test case: (delta_t, n_sub, A0, w0)\n    test_cases = [\n        (1.0, 1, 1500.0, 0.0),    # Case 1: Reference fine step\n        (30.0, 1, 1500.0, 0.0),   # Case 2: Coarser step, no substepping\n        (30.0, 5, 1500.0, 0.0),   # Case 3: Coarser step with substepping\n        (120.0, 1, 1500.0, 0.0),  # Case 4: Very coarse step, no substepping\n        (120.0, 8, 1500.0, 0.0),  # Case 5: Very coarse step with substepping\n        (30.0, 4, 100.0, 0.0),    # Case 6: Low initial CAPE edge case\n    ]\n\n    all_results = []\n\n    for params in test_cases:\n        delta_t, n_sub, A0, w0 = params\n\n        # --- State Variables ---\n        A = A0  # Convective Available Potential Energy [J/kg or m^2/s^2]\n        w = w0  # Resolved vertical velocity [m/s]\n\n        # --- Accumulators for Total Consumption ---\n        C_tot = 0.0  # CAPE consumed by convective parameterization [J/kg]\n        R_tot = 0.0  # CAPE consumed by resolved removal [J/kg]\n\n        # --- Time Integration Parameters ---\n        num_steps = int(np.floor(T / delta_t))\n        delta_tc = delta_t / n_sub if n_sub  0 else 0.0\n\n        # --- Time-Stepping Loop ---\n        for _ in range(num_steps):\n            \n            # --- 1. Convective Parameterization Update (with substeps) ---\n            A_post_conv = A\n            for _ in range(n_sub):\n                # Calculate potential removal for this substep\n                potential_removal_conv = delta_tc * kappa_c * A_post_conv\n                \n                # Enforce positivity: actual removal cannot exceed available CAPE\n                actual_removal_conv = min(potential_removal_conv, A_post_conv)\n                \n                # Update CAPE and accumulator\n                A_post_conv -= actual_removal_conv\n                C_tot += actual_removal_conv\n\n            # --- 2. Vertical Velocity Update ---\n            # Update w using post-convective A and w from the start of the step\n            buoyancy = A_post_conv / L\n            w_new = w + delta_t * (buoyancy - c_d * w)\n\n            # --- 3. Resolved Removal Update ---\n            # Update A using post-convective A and the newly computed w\n            \n            # Calculate potential removal for this step\n            potential_removal_res = delta_t * kappa_r * abs(w_new) * A_post_conv / L\n            \n            # Enforce positivity\n            actual_removal_res = min(potential_removal_res, A_post_conv)\n            \n            # Update CAPE and accumulator\n            A_new = A_post_conv - actual_removal_res\n            R_tot += actual_removal_res\n            \n            # --- Update state for the next full time step ---\n            A = A_new\n            w = w_new\n\n        # Store the final state [w_T, C_tot, R_tot] for this case\n        all_results.append([w, C_tot, R_tot])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}