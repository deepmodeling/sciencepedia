{
    "hands_on_practices": [
        {
            "introduction": "在构建混合物理数据模型时，一个强大但常被忽视的步骤是利用物理原理来简化问题本身。量纲分析，特别是白金汉 $\\Pi$ 定理，是一种基本的前置处理技术，它能将一组有量纲的物理变量转换为一组无量纲的参数。这个练习将指导你如何通过量纲分析来减少模型需要学习的假设空间的维度，从而提高模型的泛化能力和鲁棒性，这是将物理洞察力融入机器学习流程的第一步。",
            "id": "3884451",
            "problem": "我们正在构建一个混合物理-数据模型，以学习明渠流中糙糙床面上悬移质的输沙定律。该学习到的映射将从有量纲的预测变量 $(\\rho,\\nu,U,D,g)$ 构建，其中 $\\rho$ 是流体密度，$\\nu$ 是运动黏度，$U$ 是特征平均流速，$D$ 是特征泥沙粒径，$g$ 是重力加速度。该模型随后将在覆盖大范围 $U$、$D$、$\\nu$ 和 $g$ 值的实验室和现场数据集上进行训练。为了改善外推能力并减小假设空间，学习组件的输入必须是无量纲的。\n\n仅使用量纲齐次性基本原理和 Buckingham Π 定理，推导出一组可以由 $(\\rho,\\nu,U,D,g)$ 形成的最小独立无量纲输入组 $\\Pi_i$。通过求解使每个 $\\Pi_i$ 无量纲化的指数来明确构建这些组，并论证 $\\rho$ 是否可以进入由给定集合形成的任何无量纲输入中。然后，在不援引任何经验性泥沙输运公式的情况下，解释为什么用推导出的 $\\Pi_i$ 替换 $(\\rho,\\nu,U,D,g)$ 会降低混合物理-数据模型中的假设复杂度，并通过比较原始有量纲输入中的通用全次数为 $p$ 的多项式模型与 $\\Pi_i$ 中的通用全次数为 $p$ 的多项式模型的自由系数数量来量化这种降低。\n\n以单行矩阵形式给出独立 $\\Pi_i$ 的明确解析表达式作为最终答案。不需要进行数值计算，也无需四舍五入。最终答案中不要包含单位。",
            "solution": "经评估，问题陈述是有效的，因为它基于量纲分析的科学原理，是适定的、客观且内部一致的。它展示了Buckingham Π定理在一个相关的环境建模问题上的标准而严谨的应用。\n\n任务是从与悬沙输运相关的 $n=5$ 个物理变量中推导出一组最小的独立无量纲组：流体密度 $\\rho$、运动黏度 $\\nu$、平均流速 $U$、泥沙粒径 $D$ 和重力加速度 $g$。涉及的基本量纲是质量 ($M$)、长度 ($L$) 和时间 ($T$)。\n\n首先，我们列出这些变量及其对应的量纲：\n1. 流体密度, $\\rho$: $[\\rho] = M L^{-3}$\n2. 运动黏度, $\\nu$: $[\\nu] = L^2 T^{-1}$\n3. 流速, $U$: $[U] = L T^{-1}$\n4. 颗粒粒径, $D$: $[D] = L$\n5. 重力加速度, $g$: $[g] = L T^{-2}$\n\nBuckingham Π定理指出， $n$ 个变量之间一个具有物理意义的关系可以表示为 $n-k$ 个独立无量纲组之间的关系，其中 $k$ 是描述这些变量所需的基本量纲数量（即量纲矩阵的秩）。\n\n我们来构建量纲矩阵，其中行对应基本量纲 ($M, L, T$)，列对应变量 ($\\rho, \\nu, U, D, g$)：\n$$\n\\begin{pmatrix}\n  \\rho  \\nu  U  D  g \\\\\nM  1  0  0  0  0 \\\\\nL  -3  2  1  1  1 \\\\\nT  0  -1  -1  0  -2\n\\end{pmatrix}\n$$\n该矩阵的秩 $k$ 是线性无关的行（或列）的数量。对应于质量 ($M$) 的第一行显然与其他行无关。对于量纲 $L, T$ 和变量 $\\nu, U$ 的子矩阵是 $\\begin{pmatrix} 2  1 \\\\ -1  -1 \\end{pmatrix}$，其行列式为 $(2)(-1) - (1)(-1) = -1 \\neq 0$。因此，后两行也是线性无关的。该矩阵的秩为 $k=3$。\n\n根据Buckingham Π定理，独立无量纲组的数量是 $n - k = 5 - 3 = 2$。我们将它们表示为 $\\Pi_1$ 和 $\\Pi_2$。\n\n问题询问流体密度 $\\rho$ 是否能成为由给定变量集合形成的任何无量纲组的组成部分。假设一个通用的无量纲组 $\\Pi$ 由各变量的幂次乘积形成：\n$$ \\Pi = \\rho^{e_1} \\nu^{e_2} U^{e_3} D^{e_4} g^{e_5} $$\n要使 $\\Pi$ 无量纲，其总量纲必须是 $M^0 L^0 T^0$。我们可以写出量纲方程：\n$$ [\\Pi] = (M L^{-3})^{e_1} (L^2 T^{-1})^{e_2} (L T^{-1})^{e_3} (L)^{e_4} (L T^{-2})^{e_5} = M^{e_1} L^{-3e_1+2e_2+e_3+e_4+e_5} T^{-e_2-e_3-2e_5} $$\n为了使其无量纲，每个基本量纲的指数必须为零。对于质量量纲 ($M$)，我们有：\n$$ e_1 = 0 $$\n这个结果证明，在由这组变量形成的任何无量纲组中，$\\rho$ 的指数必须为零。因此，$\\rho$ 不能进入任何无量纲输入中。这是因为 $\\rho$ 是集合中唯一带有质量量纲的变量，没有其他变量可以抵消它，这是一个直接的后果。\n\n由于排除了 $\\rho$，问题简化为从剩下的4个变量($\\nu, U, D, g$)中找出2个无量纲组，这些变量由2个基本量纲($L, T$)描述。我们从此集合中选择 $k=2$ 个重复变量。一个有效的选择必须同时包含 $L$ 和 $T$ 并且量纲上是独立的。我们选择 $U$ 和 $D$。\n- $[U] = L T^{-1}$\n- $[D] = L$\n$\\{U, D\\}$ 的量纲矩阵是 $\\begin{pmatrix} 1  1 \\\\ -1  0 \\end{pmatrix}$，其行列式为 $1 \\neq 0$，这证实了它们是一个有效的选择。\n\n我们现在使用剩下的变量 $\\nu$ 和 $g$ 来构成两个 $\\Pi$ 组。\n\n首先，我们用 $\\nu$ 构成 $\\Pi_1$：\n$$ \\Pi_1 = U^a D^b \\nu^1 $$\n量纲方程是：\n$$ [\\Pi_1] = (L T^{-1})^a (L)^b (L^2 T^{-1})^1 = L^{a+b+2} T^{-a-1} = L^0 T^0 $$\n令指数相等：\n- 对于 $T$: $-a-1 = 0 \\implies a = -1$\n- 对于 $L$: $a+b+2 = 0 \\implies -1+b+2 = 0 \\implies b = -1$\n这得到 $\\Pi_1 = U^{-1} D^{-1} \\nu = \\frac{\\nu}{UD}$。按照惯例，我们使用它的倒数，即颗粒雷诺数：\n$$ \\Pi_1 = \\frac{UD}{\\nu} $$\n其次，我们用 $g$ 构成 $\\Pi_2$：\n$$ \\Pi_2 = U^a D^b g^1 $$\n量纲方程是：\n$$ [\\Pi_2] = (L T^{-1})^a (L)^b (L T^{-2})^1 = L^{a+b+1} T^{-a-2} = L^0 T^0 $$\n令指数相等：\n- 对于 $T$: $-a-2 = 0 \\implies a = -2$\n- 对于 $L$: $a+b+1 = 0 \\implies -2+b+1 = 0 \\implies b = 1$\n这得到 $\\Pi_2 = U^{-2} D^{1} g = \\frac{gD}{U^2}$。按照惯例，我们使用它的倒数，即颗粒弗劳德数的平方：\n$$ \\Pi_2 = \\frac{U^2}{gD} $$\n因此，一组最小的独立无量纲输入组是 $\\{\\frac{UD}{\\nu}, \\frac{U^2}{gD}\\}$。\n\n用推导出的 $\\Pi_i$ 组替换原始有量纲输入 $(\\rho, \\nu, U, D, g)$ 会降低混合物理-数据模型中的假设复杂度，原因有几个。核心原理是量纲分析将物理定律（量纲齐次性原理）嵌入到问题的结构中。\n1.  **降维**：未知函数关系的搜索空间从一个5维的输入空间 $(\\rho, \\nu, U, D, g)$ 减少到一个2维的输入空间 $(\\Pi_1, \\Pi_2)$。这是一种显著的简化。在低维空间中工作的数据驱动模型不易受到“维度灾难”的影响，需要更少的数据来进行稳健的训练，并且计算效率更高。\n2.  **施加物理约束**：通过用无量纲组重新表述问题，我们强制学习模型遵守量纲齐次性原理。任何关于 $\\Pi_1$ 和 $\\Pi_2$ 的函数都将自动产生一个量纲正确的结果。这通过消除所有物理上不可能的函数形式来剪枝假设空间，而一个在有量纲输入上操作的朴素模型则必须学会避免这些形式。\n3.  **增强泛化能力（相似性）**：无量纲组代表了物理效应的比率（例如，$Re$ 是惯性力与粘性力的比率）。动力相似性原理指出，两个具有不同有量纲参数（$\\nu$, $U$, $D$ 等）的系统，如果它们对应的无量纲组相同，其行为将完全相同。一个在 $(\\Pi_1, \\Pi_2)$ 上训练的模型内在地学习了这个原理。它可以根据来自小尺度实验室水槽的数据，准确预测大规模河流的行为，只要它们共享相同的 $(\\Pi_1, \\Pi_2)$ 值，即使各自的有量纲变量差异巨大。一个在原始有量纲变量上训练的模型会把这些视为完全不同的数据点，并且不能保证正确泛化。\n\n为了量化这种复杂性的降低，我们比较一个通用全次数为 $p$ 的多项式模型中的自由系数数量。这样一个在 $d$ 个变量中的模型的系数数量 $N$ 由带重复的组合公式给出：$N(d, p) = \\binom{p+d}{d}$。\n- 对于原始有量纲输入的模型，我们有 $d_1 = 5$ 个变量 $(\\rho, \\nu, U, D, g)$。系数数量为：\n  $$ N_1 = \\binom{p+5}{5} = \\frac{(p+5)(p+4)(p+3)(p+2)(p+1)}{120} $$\n  这个模型在物理上是朴素的，因为它没有在其项之间强制执行量纲一致性，但它代表了纯数据驱动模型将面临的复杂性。\n- 对于无量纲输入的模型，我们有 $d_2 = 2$ 个变量 $(\\Pi_1, \\Pi_2)$。系数数量为：\n  $$ N_2 = \\binom{p+2}{2} = \\frac{(p+2)(p+1)}{2} $$\n在有量纲的情况下，系数数量以 $O(p^5)$ 的速度增长，而在无量纲的情况下则以 $O(p^2)$ 的速度增长。例如，对于一个二次模型($p=2$)，有量纲模型有 $N_1 = \\binom{7}{5} = 21$ 个系数，而无量纲模型只有 $N_2 = \\binom{4}{2} = 6$ 个系数。这种自由参数数量的急剧减少使得模型规范起来简单得多，更容易用可用数据进行约束，且更不容易过拟合。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{UD}{\\nu}  \\frac{U^2}{gD}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "许多物理量，如浓度、密度或能量，其本质决定了它们必须是非负的。直接用神经网络预测这些量可能会产生非物理的负值。本练习探讨了一种通过模型架构设计来强制执行这种“正定性”约束的优雅方法：使用链接函数（如此处的指数函数），确保模型输出始终为正。通过这个练习，你将分析这种架构选择如何影响训练过程，特别是对梯度和优化稳定性的影响，从而深刻理解模型设计与物理约束之间的相互作用。",
            "id": "3884463",
            "problem": "考虑一个无源示踪剂浓度场 $c(x,t)$，它在一个一维周期性通道 $x \\in [0,2\\pi]$ 中根据菲克扩散定律演化，扩散系数 $\\kappa>0$ 为常数，且无源无汇。主导的质量守恒定律和菲克定律结合，得到偏微分方程 (PDE) $\\partial_t c - \\kappa \\,\\partial_{xx} c = 0$。为了在混合物理-数据参数化中强制正定性，使用连接函数 $c(x,t) = \\exp\\!\\big(g_{\\phi}(x,t)\\big)$，其中 $g_{\\phi}$ 是一个数据驱动模型，$\\phi$ 表示可训练参数。\n\n对于本问题，将 $g_{\\phi}$ 限制为单个标量参数 $a \\in \\mathbb{R}$ 与一个固定基函数 $\\psi(x,t)$ 的乘积，即 $g_{\\phi}(x,t) = a\\,\\psi(x,t)$，其中 $\\psi(x,t) = \\sin(kx)\\cos(\\omega t)$，$k \\in \\mathbb{N}$ 和 $\\omega>0$ 是固定值。将物理信息训练目标定义为在一个时空周期内，偏微分方程残差平方的时空积分，\n$$\nL(a) = \\frac{1}{2}\\int_{0}^{2\\pi}\\!\\int_{0}^{\\frac{2\\pi}{\\omega}}\\!\\left(\\partial_t c(x,t) - \\kappa\\,\\partial_{xx} c(x,t)\\right)^{2}\\, dt\\, dx,\n$$\n其中 $c(x,t) = \\exp\\!\\big(a\\,\\psi(x,t)\\big)$。\n\n任务：\n- 从 PDE 和 $L(a)$ 的定义出发，使用链式法则推导出梯度 $\\frac{dL}{da}$ 关于 $\\psi$、其导数和 $a$ 的精确表达式。\n- 在 $a=0$ 附近线性化梯度流，并明确展示正定性连接函数 $c=\\exp(g_{\\phi})$ 如何缩放梯度。计算海森矩阵 $\\frac{d^{2}L}{da^{2}}\\big|_{a=0}$，结果表示为关于 $\\kappa$、$k$ 和 $\\omega$ 的闭式积分。\n- 考虑对 $a$ 进行梯度下降，学习率 $\\eta$ 为常数，更新规则为 $a_{n+1} = a_n - \\eta\\,\\frac{dL}{da}(a_n)$。利用 $a=0$ 附近的线性化动力学，确定能保证训练迭代线性稳定性的最大学习率 $\\eta_{\\max}$。请用关于 $\\kappa$、$k$ 和 $\\omega$ 的单个解析表达式给出最终答案。无需进行数值代入或四舍五入，最终答案也无需单位。",
            "solution": "首先根据给定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取给定条件**\n-   示踪剂浓度场：$c(x,t)$。\n-   域：$x \\in [0, 2\\pi]$，一维周期性通道。\n-   主导PDE：$\\partial_t c - \\kappa \\partial_{xx} c = 0$，扩散系数 $\\kappa>0$ 为常数。\n-   强制正定性连接函数：$c(x,t) = \\exp(g_{\\phi}(x,t))$。\n-   参数化模型：$g_{\\phi}(x,t) = a\\,\\psi(x,t)$，其中 $a \\in \\mathbb{R}$ 是可训练参数。\n-   固定基函数：$\\psi(x,t) = \\sin(kx)\\cos(\\omega t)$，其中 $k \\in \\mathbb{N}$ 且 $\\omega>0$。\n-   物理信息损失函数：$L(a) = \\frac{1}{2}\\int_{0}^{2\\pi}\\int_{0}^{\\frac{2\\pi}{\\omega}}\\!\\left(\\partial_t c(x,t) - \\kappa\\,\\partial_{xx} c(x,t)\\right)^{2}\\, dt\\, dx$。\n-   梯度下降更新规则：$a_{n+1} = a_n - \\eta\\,\\frac{dL}{da}(a_n)$。\n\n**步骤2：使用提取的给定条件进行验证**\n-   **科学基础**：该问题牢固地基于扩散的基本原理（菲克定律，质量守恒）和科学机器学习中的既定方法（物理信息学习）。使用基于PDE残差的损失函数是一种标准技术。指数连接函数是施加正定性约束的常用方法。\n-   **适定性**：该问题在数学上是适定的。它提供了执行所要求的推导和计算所需的所有函数、参数和积分域。任务具体，并能导出一个唯一的解析解。\n-   **客观性**：该问题使用精确、客观的数学语言陈述，没有歧义或主观论断。\n\n**步骤3：结论与行动**\n问题被认为是有效的，因为它科学合理、适定、客观且完整。我们可以继续进行求解。\n\n### 推导\n\n**任务1：推导梯度 $\\frac{dL}{da}$**\n\n损失函数由下式给出\n$$L(a) = \\frac{1}{2}\\int_{0}^{2\\pi}\\int_{0}^{2\\pi/\\omega} R(a, x, t)^2 \\, dt \\, dx$$\n其中残差 $R(a, x, t)$ 定义为\n$$R = \\partial_t c - \\kappa \\partial_{xx} c$$\n其中 $c(x,t) = \\exp(a\\psi(x,t))$。\n\n为求梯度 $\\frac{dL}{da}$，我们将 $L(a)$ 对 $a$ 求导。使用链式法则和在积分号下求导的莱布尼茨法则，我们得到：\n$$\\frac{dL}{da} = \\frac{d}{da} \\left( \\frac{1}{2}\\int\\int R^2 \\,dt\\,dx \\right) = \\int\\int R \\frac{\\partial R}{\\partial a} \\,dt\\,dx$$\n让我们定义线性微分算子 $\\mathcal{L} = \\partial_t - \\kappa \\partial_{xx}$。残差为 $R = \\mathcal{L}c$。\n残差对 $a$ 的偏导数为：\n$$\\frac{\\partial R}{\\partial a} = \\frac{\\partial}{\\partial a} (\\mathcal{L}c) = \\mathcal{L}\\left(\\frac{\\partial c}{\\partial a}\\right)$$\n我们计算 $\\frac{\\partial c}{\\partial a}$：\n$$\\frac{\\partial c}{\\partial a} = \\frac{\\partial}{\\partial a} \\exp(a\\psi) = \\psi \\exp(a\\psi) = \\psi c$$\n将此代入 $\\frac{\\partial R}{\\partial a}$ 的表达式中：\n$$\\frac{\\partial R}{\\partial a} = \\mathcal{L}(\\psi c) = (\\partial_t - \\kappa \\partial_{xx})(\\psi c)$$\n我们展开这些项：\n$$\\partial_t(\\psi c) = (\\partial_t \\psi)c + \\psi(\\partial_t c)$$\n$$\\partial_x(\\psi c) = (\\partial_x \\psi)c + \\psi(\\partial_x c)$$\n$$\\partial_{xx}(\\psi c) = \\partial_x((\\partial_x \\psi)c + \\psi(\\partial_x c)) = (\\partial_{xx}\\psi)c + (\\partial_x \\psi)(\\partial_x c) + (\\partial_x \\psi)(\\partial_x c) + \\psi(\\partial_{xx}c)$$\n$$\\partial_{xx}(\\psi c) = (\\partial_{xx}\\psi)c + 2(\\partial_x \\psi)(\\partial_x c) + \\psi(\\partial_{xx}c)$$\n将这些结合起来得到：\n$$\\mathcal{L}(\\psi c) = [(\\partial_t \\psi)c + \\psi(\\partial_t c)] - \\kappa[(\\partial_{xx}\\psi)c + 2(\\partial_x \\psi)(\\partial_x c) + \\psi(\\partial_{xx}c)]$$\n重新整理各项，按 $\\psi$ 和 $c$ 分组：\n$$\\mathcal{L}(\\psi c) = \\psi(\\partial_t c - \\kappa \\partial_{xx}c) + c(\\partial_t \\psi - \\kappa \\partial_{xx}\\psi) - 2\\kappa(\\partial_x c)(\\partial_x \\psi)$$\n认识到 $R = \\partial_t c - \\kappa \\partial_{xx}c$ 和 $\\mathcal{L}\\psi = \\partial_t\\psi - \\kappa\\partial_{xx}\\psi$，我们有：\n$$\\frac{\\partial R}{\\partial a} = \\psi R + c(\\mathcal{L}\\psi) - 2\\kappa(\\partial_x c)(\\partial_x \\psi)$$\n最后，梯度 $\\frac{dL}{da}$ 的表达式为：\n$$\\frac{dL}{da} = \\int\\int R \\left( \\psi R + c(\\mathcal{L}\\psi) - 2\\kappa(\\partial_x c)(\\partial_x \\psi) \\right) \\,dt\\,dx$$\n其中 $c = \\exp(a\\psi)$，$R = \\mathcal{L}c$，且 $\\partial_x c = a(\\partial_x \\psi)c$。这是梯度的精确表达式。\n\n**任务2：线性化梯度流并计算在 $a=0$ 处的海森矩阵**\n\n梯度流由 $\\frac{da}{d\\tau} = -\\frac{dL}{da}(a)$ 给出，其中 $\\tau$ 是连续的“训练时间”。为了在 $a=0$ 附近线性化此流，我们需要 $\\frac{dL}{da}(a)$ 在 $a=0$ 附近的一阶泰勒展开：\n$$\\frac{dL}{da}(a) \\approx \\frac{dL}{da}\\bigg|_{a=0} + a \\left(\\frac{d^2L}{da^2}\\bigg|_{a=0}\\right)$$\n首先，我们计算在 $a=0$ 处的梯度。在 $a=0$ 时，我们有 $c(x,t) = \\exp(0) = 1$。残差为：\n$$R(a=0) = \\partial_t(1) - \\kappa\\partial_{xx}(1) = 0 - 0 = 0$$\n由于 $R(a=0) = 0$，梯度也为零：\n$$\\frac{dL}{da}\\bigg|_{a=0} = \\int\\int R(0) \\frac{\\partial R}{\\partial a}\\bigg|_{a=0} \\,dt\\,dx = 0$$\n这证实了 $a=0$ 是损失函数的一个临界点。因此，线性化梯度为：\n$$\\frac{dL}{da}(a) \\approx a \\left(\\frac{d^2L}{da^2}\\bigg|_{a=0}\\right)$$\n项 $\\frac{d^2L}{da^2}|_{a=0}$ 是损失函数在 $a=0$ 处的海森矩阵 $H$。\n使用连接函数 $c=\\exp(a\\psi)$ 会导致一个非二次的损失景观。然而，对于小的 $a$，$c \\approx 1+a\\psi$。残差变为 $R=\\mathcal{L}c \\approx \\mathcal{L}(1+a\\psi) = a\\mathcal{L}\\psi$。损失为 $L(a) \\approx \\frac{1}{2}\\int\\int (a\\mathcal{L}\\psi)^2 dtdx$，使得梯度 $\\frac{dL}{da} \\approx a \\int\\int (\\mathcal{L}\\psi)^2 dtdx$。非线性连接函数的作用是，这种线性梯度缩放是一个近似值，而对于一个简单的线性模型 $c=a\\psi$，它将是精确的。\n\n为计算海森矩阵 $H$，我们对梯度表达式求导：\n$$\\frac{d^2L}{da^2} = \\frac{d}{da} \\int\\int R \\frac{\\partial R}{\\partial a} \\,dt\\,dx = \\int\\int \\left( \\left(\\frac{\\partial R}{\\partial a}\\right)^2 + R \\frac{\\partial^2 R}{\\partial a^2} \\right) \\,dt\\,dx$$\n在 $a=0$ 处求值，由于 $R(0)=0$，第二项消失：\n$$H = \\frac{d^2L}{da^2}\\bigg|_{a=0} = \\int\\int \\left(\\frac{\\partial R}{\\partial a}\\bigg|_{a=0}\\right)^2 \\,dt\\,dx$$\n我们需要 $a=0$ 处的 $\\frac{\\partial R}{\\partial a}$。我们已求得 $\\frac{\\partial R}{\\partial a} = \\mathcal{L}(\\frac{\\partial c}{\\partial a})$。\n在 $a=0$ 处：\n$$\\frac{\\partial c}{\\partial a}\\bigg|_{a=0} = (\\psi\\exp(a\\psi))\\big|_{a=0} = \\psi \\exp(0) = \\psi$$\n因此，\n$$\\frac{\\partial R}{\\partial a}\\bigg|_{a=0} = \\mathcal{L}(\\psi) = \\partial_t\\psi - \\kappa \\partial_{xx}\\psi$$\n海森矩阵是该项平方的积分：\n$$H = \\int_{0}^{2\\pi}\\int_{0}^{\\frac{2\\pi}{\\omega}} (\\partial_t\\psi - \\kappa \\partial_{xx}\\psi)^2 \\,dt\\,dx$$\n现在，我们代入 $\\psi(x,t) = \\sin(kx)\\cos(\\omega t)$：\n$$\\partial_t \\psi = -\\omega \\sin(kx)\\sin(\\omega t)$$\n$$\\partial_x \\psi = k \\cos(kx)\\cos(\\omega t) \\quad \\implies \\quad \\partial_{xx} \\psi = -k^2 \\sin(kx)\\cos(\\omega t)$$\n所以，\n$$\\mathcal{L}\\psi = -\\omega \\sin(kx)\\sin(\\omega t) - \\kappa(-k^2 \\sin(kx)\\cos(\\omega t)) = \\sin(kx) \\left( \\kappa k^2 \\cos(\\omega t) - \\omega \\sin(\\omega t) \\right)$$\n被积函数是：\n$$(\\mathcal{L}\\psi)^2 = \\sin^2(kx) \\left( \\kappa k^2 \\cos(\\omega t) - \\omega \\sin(\\omega t) \\right)^2$$\n$H$ 的积分是可分离的：\n$$H = \\left(\\int_{0}^{2\\pi} \\sin^2(kx) \\,dx\\right) \\left(\\int_{0}^{\\frac{2\\pi}{\\omega}} \\left( \\kappa k^2 \\cos(\\omega t) - \\omega \\sin(\\omega t) \\right)^2 \\,dt\\right)$$\n让我们计算积分。由于 $k \\in \\mathbb{N}$：\n$$\\int_{0}^{2\\pi} \\sin^2(kx) \\,dx = \\int_{0}^{2\\pi} \\frac{1 - \\cos(2kx)}{2} \\,dx = \\left[\\frac{x}{2} - \\frac{\\sin(2kx)}{4k}\\right]_{0}^{2\\pi} = \\pi$$\n对于时间积分，我们展开平方项：\n$$(\\dots)^2 = \\kappa^2 k^4 \\cos^2(\\omega t) - 2\\kappa k^2 \\omega \\cos(\\omega t)\\sin(\\omega t) + \\omega^2 \\sin^2(\\omega t)$$\n在一个周期 $T = \\frac{2\\pi}{\\omega}$ 上积分：\n$\\int_0^T \\cos^2(\\omega t) \\,dt = \\frac{T}{2} = \\frac{\\pi}{\\omega}$\n$\\int_0^T \\sin^2(\\omega t) \\,dt = \\frac{T}{2} = \\frac{\\pi}{\\omega}$\n$\\int_0^T \\cos(\\omega t)\\sin(\\omega t) \\,dt = \\frac{1}{2}\\int_0^T \\sin(2\\omega t) \\,dt = 0$\n所以，时间积分的计算结果为：\n$$\\kappa^2 k^4 \\left(\\frac{\\pi}{\\omega}\\right) - 0 + \\omega^2 \\left(\\frac{\\pi}{\\omega}\\right) = \\frac{\\pi}{\\omega}(\\kappa^2 k^4 + \\omega^2)$$\n将空间和时间积分相乘得到海森矩阵：\n$$H = \\pi \\cdot \\frac{\\pi}{\\omega}(\\kappa^2 k^4 + \\omega^2) = \\frac{\\pi^2}{\\omega}(\\kappa^2 k^4 + \\omega^2)$$\n\n**任务3：确定最大学习率 $\\eta_{\\max}$**\n\n梯度下降更新为 $a_{n+1} = a_n - \\eta \\frac{dL}{da}(a_n)$。在最小值 $a=0$ 附近，我们使用线性化梯度 $\\frac{dL}{da}(a_n) \\approx H a_n$。线性化更新规则变为：\n$$a_{n+1} \\approx a_n - \\eta H a_n = (1 - \\eta H) a_n$$\n这是一个线性迭代映射。为使迭代序列 $a_n$ 收敛到 $0$，放大因子的绝对值必须小于 $1$：\n$$|1 - \\eta H|  1$$\n这个不等式等价于 $-1  1 - \\eta H  1$。\n右边，$1 - \\eta H  1$，意味着 $-\\eta H  0$。由于学习率 $\\eta  0$ 且海森矩阵 $H = \\frac{\\pi^2}{\\omega}(\\kappa^2 k^4 + \\omega^2)$ 是严格正的（给定 $\\kappa0, \\omega0, k\\in\\mathbb{N}$），此条件总是满足。\n左边，$-1  1 - \\eta H$，意味着 $\\eta H  2$。\n这给出了学习率的稳定性条件：\n$$\\eta  \\frac{2}{H}$$\n因此，保证稳定性的最大学习率 $\\eta_{\\max}$ 是此区间的上界。\n$$\\eta_{\\max} = \\frac{2}{H}$$\n代入 $H$ 的表达式：\n$$\\eta_{\\max} = \\frac{2}{\\frac{\\pi^2}{\\omega}(\\kappa^2 k^4 + \\omega^2)}$$\n简化表达式得到最终答案：\n$$\\eta_{\\max} = \\frac{2\\omega}{\\pi^2(\\kappa^2 k^4 + \\omega^2)}$$",
            "answer": "$$\\boxed{\\frac{2\\omega}{\\pi^2(\\kappa^2 k^4 + \\omega^2)}}$$"
        },
        {
            "introduction": "混合模型的一个核心优势是能够遵守基本的守恒定律，例如质量守恒、动量守恒和能量守恒。本练习将引导你实践一种在模型训练中强制执行全局积分守恒定律的先进技术。你将学习如何从一个积分形式的守恒方程出发，构建其离散化后的残差，并探索两种强制该残差为零的策略：通过增广拉格朗日方法施加“硬约束”，以及一种实用的后处理校正方法。这个练习对于开发在预测长期演化时仍能保持物理一致性的可靠模型至关重要。",
            "id": "3884400",
            "problem": "考虑一个被动示踪剂场 $c(\\mathbf{x},t)$，它在一个有界 Lipschitz 域 $\\Omega \\subset \\mathbb{R}^{d}$ 上被一个已知的速度场 $\\mathbf{u}(\\mathbf{x},t)$ 输运，并带有一个体积源项 $S(\\mathbf{x},t)$。该域的边界 $\\partial\\Omega$ 上的向外单位法向量为 $\\mathbf{n}$。控制该示踪剂的全局守恒律是：$\\Omega$ 内总质量的变化率加上穿过边界 $\\partial\\Omega$ 的净向外通量等于 $\\Omega$ 内部的总产量。这可以表示为积分平衡式\n$$\n\\partial_{t}\\int_{\\Omega} c\\,d\\mathbf{x} \\;+\\; \\int_{\\partial\\Omega} c\\,\\mathbf{u}\\cdot\\mathbf{n}\\,ds \\;=\\; \\int_{\\Omega} S\\,d\\mathbf{x}.\n$$\n一个混合物理-数据模型使用一个参数化的代理模型 $c_{\\theta}(\\mathbf{x},t)$ 来预测该示踪剂，并且在训练期间必须将上述守恒律作为硬约束来强制执行。\n\n给定离散时间层 $t_{k}$ 和 $t_{k+1}$，时间步长是均匀的 $\\Delta t = t_{k+1}-t_{k}$。在每个时间点 $t_{k}$ 和 $t_{k+1}$，域积分通过使用内部点 $\\{\\mathbf{x}_{i}\\}_{i=1}^{N}$ 和正权重 $\\{w_{i}\\}_{i=1}^{N}$ 的求积法来近似；在 $t_{k+1}$ 时刻的边界积分通过使用边界求积点 $\\{\\mathbf{x}^{b}_{j}\\}_{j=1}^{M}$ 和正权重 $\\{w^{b}_{j}\\}_{j=1}^{M}$ 来近似。记 $u_{n,j} \\equiv \\mathbf{u}(\\mathbf{x}^{b}_{j},t_{k+1})\\cdot\\mathbf{n}(\\mathbf{x}^{b}_{j})$。定义在 $t_{k+1}$ 时刻计算的域内总质量和边界通量的前向欧拉时间离散化。\n\n任务：\n- 从上述全局守恒陈述出发，使用给定的求积法则和对 $\\partial_{t}\\int_{\\Omega} c\\,d\\mathbf{x}$ 的前向欧拉近似，推导出一个离散残差 $g_{k+1}(\\theta)$，该残差用于度量在时间 $t_{k+1}$ 全局守恒律被违反的程度。\n- 构建一个训练目标函数 $\\mathcal{J}(\\theta,\\lambda)$，它除了一个通用的数据保真项 $\\mathcal{L}_{\\text{data}}(\\theta)$ 和一个可选的正则化项 $\\mathcal{R}(\\theta)$ 之外，通过一个拉格朗日乘子 $\\lambda$ 和一个系数为 $\\rho0$ 的增广惩罚项，将约束 $g_{k+1}(\\theta)=0$ 作为硬约束强制执行。\n- 讨论一种在随机设置下（求积点可能被子采样）于训练期间强制执行该硬约束的数值稳定策略，阐述如何更新拉格朗日乘子和惩罚参数，以及如何减轻由子采样带来的偏差。\n- 为了在 $t_{k+1}$ 时刻精确满足守恒律而不改变该步的 $\\theta$，假设你仅对 $t_{k+1}$ 时刻的代理模型预测值施加一个加性的、空间均匀的修正项 $\\beta_{k+1}$，使得修正后的场为 $c(\\mathbf{x},t_{k+1}) = c_{\\theta}(\\mathbf{x},t_{k+1}) + \\beta_{k+1}$，而在前一时刻 $t_{k}$ 没有修正，即 $c(\\mathbf{x},t_{k}) = c_{\\theta}(\\mathbf{x},t_{k})$。\n  \n  引入以下简写\n  $$\n  \\tilde{M}_{k} \\equiv \\sum_{i=1}^{N} w_{i}\\,c_{\\theta}(\\mathbf{x}_{i},t_{k}),\\quad\n  \\tilde{M}_{k+1} \\equiv \\sum_{i=1}^{N} w_{i}\\,c_{\\theta}(\\mathbf{x}_{i},t_{k+1}),\\quad\n  \\tilde{F}_{k+1} \\equiv \\sum_{j=1}^{M} w^{b}_{j}\\,c_{\\theta}(\\mathbf{x}^{b}_{j},t_{k+1})\\,u_{n,j},\\quad\n  Q_{k+1} \\equiv \\sum_{i=1}^{N} w_{i}\\,S(\\mathbf{x}_{i},t_{k+1}),\n  $$\n  以及聚合求积因子\n  $$\n  W \\equiv \\sum_{i=1}^{N} w_{i},\\qquad B \\equiv \\sum_{j=1}^{M} w^{b}_{j}\\,u_{n,j}.\n  $$\n  使用这些简写，写出修正后的残差 $g_{k+1}^{\\text{corr}}(\\beta_{k+1})$，并在 $W/\\Delta t + B \\neq 0$ 的条件下，确定能强制 $g_{k+1}^{\\text{corr}}(\\beta_{k+1}) = 0$ 的唯一值 $\\beta_{k+1}$。请将你的最终结果以 $\\tilde{M}_{k}$、$\\tilde{M}_{k+1}$、$\\tilde{F}_{k+1}$、$Q_{k+1}$、$W$、$B$ 和 $\\Delta t$ 的单一、简化的符号表达式形式给出。不要进行数值计算，并且最终表达式中不要包含单位。",
            "solution": "该问题陈述是在混合物理-数据模型中应用数值方法和约束优化的一个有效练习。它在科学上是合理的、适定的和客观的。我们将按照给出的顺序处理每个任务。\n\n该问题的基础是被动示踪剂 $c(\\mathbf{x}, t)$ 在域 $\\Omega$ 中守恒律的积分形式：\n$$\n\\partial_{t}\\int_{\\Omega} c\\,d\\mathbf{x} \\;+\\; \\int_{\\partial\\Omega} c\\,\\mathbf{u}\\cdot\\mathbf{n}\\,ds \\;=\\; \\int_{\\Omega} S\\,d\\mathbf{x}\n$$\n该方程表明，$\\Omega$ 中示踪剂总质量的变化率，加上从边界 $\\partial\\Omega$ 净流出的质量通量，等于 $\\Omega$ 内源 $S$ 的总质量生产率。\n\n首先，我们推导离散残差 $g_{k+1}(\\theta)$。我们首先使用在时间 $t_{k+1}$ 处的前向欧拉近似来离散化时间导数项：\n$$\n\\partial_{t}\\int_{\\Omega} c(\\mathbf{x}, t)\\,d\\mathbf{x} \\bigg|_{t=t_{k+1}} \\approx \\frac{1}{\\Delta t} \\left( \\int_{\\Omega} c(\\mathbf{x}, t_{k+1})\\,d\\mathbf{x} - \\int_{\\Omega} c(\\mathbf{x}, t_{k})\\,d\\mathbf{x} \\right)\n$$\n将此代入守恒律，并在 $t_{k+1}$ 处计算所有其他项，我们得到半离散方程：\n$$\n\\frac{1}{\\Delta t} \\left( \\int_{\\Omega} c(\\mathbf{x}, t_{k+1})\\,d\\mathbf{x} - \\int_{\\Omega} c(\\mathbf{x}, t_{k})\\,d\\mathbf{x} \\right) + \\int_{\\partial\\Omega} c(\\mathbf{x},t_{k+1})\\,\\mathbf{u}(\\mathbf{x},t_{k+1})\\cdot\\mathbf{n}\\,ds = \\int_{\\Omega} S(\\mathbf{x},t_{k+1})\\,d\\mathbf{x}\n$$\n接下来，我们引入参数化的代理模型 $c_{\\theta}(\\mathbf{x}, t)$，并应用指定的求积法则来近似积分。在 $\\Omega$ 上的域积分使用内部点 $\\{\\mathbf{x}_{i}\\}_{i=1}^{N}$ 和权重 $\\{w_{i}\\}_{i=1}^{N}$，在 $\\partial\\Omega$ 上的边界积分使用边界点 $\\{\\mathbf{x}^{b}_{j}\\}_{j=1}^{M}$ 和权重 $\\{w^{b}_{j}\\}_{j=1}^{M}$。这得到了全离散方程：\n$$\n\\frac{1}{\\Delta t} \\left( \\sum_{i=1}^{N} w_{i}c_{\\theta}(\\mathbf{x}_{i}, t_{k+1}) - \\sum_{i=1}^{N} w_{i}c_{\\theta}(\\mathbf{x}_{i}, t_{k}) \\right) + \\sum_{j=1}^{M} w^{b}_{j}c_{\\theta}(\\mathbf{x}^{b}_{j}, t_{k+1})u_{n,j} = \\sum_{i=1}^{N} w_{i}S(\\mathbf{x}_{i}, t_{k+1})\n$$\n离散残差 $g_{k+1}(\\theta)$ 被定义为该方程被违反的量。我们通过将所有项移到一边来得到它：\n$$\ng_{k+1}(\\theta) \\equiv \\frac{1}{\\Delta t} \\left( \\sum_{i=1}^{N} w_{i}c_{\\theta}(\\mathbf{x}_{i}, t_{k+1}) - \\sum_{i=1}^{N} w_{i}c_{\\theta}(\\mathbf{x}_{i}, t_{k}) \\right) + \\sum_{j=1}^{M} w^{b}_{j}c_{\\theta}(\\mathbf{x}^{b}_{j}, t_{k+1})u_{n,j} - \\sum_{i=1}^{N} w_{i}S(\\mathbf{x}_{i}, t_{k+1})\n$$\n目标是强制执行约束 $g_{k+1}(\\theta)=0$。\n\n其次，我们使用增广拉格朗日方法构建训练目标函数 $\\mathcal{J}(\\theta,\\lambda)$。此方法结合了一个用于强制约束的拉格朗日乘子项和一个用于提高数值稳定性的二次惩罚项。目标函数是数据保真度损失 $\\mathcal{L}_{\\text{data}}(\\theta)$、一个可选的正则化项 $\\mathcal{R}(\\theta)$ 以及针对约束 $g_{k+1}(\\theta)=0$ 的增广拉格朗日项之和。完整的目标函数是：\n$$\n\\mathcal{J}(\\theta,\\lambda) = \\mathcal{L}_{\\text{data}}(\\theta) + \\mathcal{R}(\\theta) + \\lambda \\, g_{k+1}(\\theta) + \\frac{\\rho}{2} [g_{k+1}(\\theta)]^{2}\n$$\n这里，$\\lambda$ 是与守恒约束相关联的拉格朗日乘子，$\\rho  0$ 是惩罚参数。通过关于 $\\theta$ 最小化此目标函数，同时适当地更新 $\\lambda$ 和 $\\rho$，可以驱动残差 $g_{k+1}(\\theta)$ 趋向于零。\n\n第三，我们讨论在随机训练设置中强制执行此硬约束的数值稳定策略。对求积点 $\\{\\mathbf{x}_i\\}$ 和 $\\{\\mathbf{x}_j^b\\}$ 进行子采样以形成小批量来估计数据损失 $\\mathcal{L}_{\\text{data}}(\\theta)$ 是标准做法。然而，使用相同的小批量来估计全局残差 $g_{k+1}(\\theta)$ 会带来显著的挑战。残差的小批量估计将是真实全局残差的一个有噪声、有偏的估计量。强制小批量残差为零并不能保证全局守恒律得到满足。为了减轻这一点，一个鲁棒的策略是解耦数据损失和约束残差的评估。数据损失 $\\mathcal{L}_{\\text{data}}(\\theta)$ 及其梯度可以在小批量上进行随机估计。然而，守恒残差 $g_{k+1}(\\theta)$ 是一个计算成本不高的全局和，应该在每个训练步骤中或以较低的频率使用完整的 $N$ 个和 $M$ 个求积点来计算。这确保了被强制执行的约束是真实的、无偏的全局守恒律。\n优化通过乘子法进行。在使用目标函数 $\\mathcal{J}(\\theta, \\lambda_m, \\rho_m)$ 对 $\\theta$ 进行一定数量的优化步骤后，更新拉格朗日乘子 $\\lambda$ 和惩罚参数 $\\rho$。标准的更新规则是：\n1. 更新拉格朗日乘子：$\\lambda_{m+1} \\leftarrow \\lambda_m + \\rho_m \\, g_{k+1}(\\theta)$，其中 $\\theta$ 是内部优化步骤后的参数。这是对拉格朗日量的对偶上升步。\n2. 更新惩罚参数：如果收敛缓慢，则自适应地增加 $\\rho$ 以更强地强制约束。例如，如果约束违反量 $|g_{k+1}(\\theta)|$ 没有按目标因子减少，则增加 $\\rho$：$\\rho_{m+1} \\leftarrow \\alpha \\rho_m$，其中因子 $\\alpha  1$。否则，$\\rho_{m+1} \\leftarrow \\rho_m$。这可以改善问题的条件数并加速收敛到可行解。\n\n第四，我们推导在时间 $t_{k+1}$ 精确执行离散守恒律的精确的、加性的、空间均匀的修正项 $\\beta_{k+1}$。在 $t_{k+1}$ 时刻修正后的示踪剂场为 $c(\\mathbf{x}, t_{k+1}) = c_{\\theta}(\\mathbf{x}, t_{k+1}) + \\beta_{k+1}$，而在 $t_k$ 时刻的场保持为 $c(\\mathbf{x}, t_{k}) = c_{\\theta}(\\mathbf{x}, t_k)$。我们必须找到 $\\beta_{k+1}$，使得修正后的残差 $g_{k+1}^{\\text{corr}}(\\beta_{k+1})$ 精确为零。\n\n未修正的残差可以使用提供的简写来表示：\n$$\ng_{k+1}(\\theta) = \\frac{\\tilde{M}_{k+1} - \\tilde{M}_{k}}{\\Delta t} + \\tilde{F}_{k+1} - Q_{k+1}\n$$\n现在，我们计算修正后残差的各项。\n在 $t_{k+1}$ 时刻修正后的总质量为：\n$$\n\\sum_{i=1}^{N} w_{i} (c_{\\theta}(\\mathbf{x}_{i},t_{k+1}) + \\beta_{k+1}) = \\left(\\sum_{i=1}^{N} w_{i} c_{\\theta}(\\mathbf{x}_{i},t_{k+1})\\right) + \\beta_{k+1} \\left(\\sum_{i=1}^{N} w_{i}\\right) = \\tilde{M}_{k+1} + \\beta_{k+1}W\n$$\n在 $t_k$ 时刻的总质量不变：$\\tilde{M}_{k}$。\n在 $t_{k+1}$ 时刻修正后的总通量为：\n$$\n\\sum_{j=1}^{M} w^{b}_{j} (c_{\\theta}(\\mathbf{x}^{b}_{j},t_{k+1})+\\beta_{k+1}) u_{n,j} = \\left(\\sum_{j=1}^{M} w^{b}_{j}c_{\\theta}(\\mathbf{x}^{b}_{j},t_{k+1})u_{n,j}\\right) + \\beta_{k+1}\\left(\\sum_{j=1}^{M} w^{b}_{j}u_{n,j}\\right) = \\tilde{F}_{k+1} + \\beta_{k+1}B\n$$\n总源项 $Q_{k+1}$ 与 $c$ 无关，因此保持不变。\n因此，修正后的残差为：\n$$\ng_{k+1}^{\\text{corr}}(\\beta_{k+1}) = \\frac{(\\tilde{M}_{k+1} + \\beta_{k+1}W) - \\tilde{M}_{k}}{\\Delta t} + (\\tilde{F}_{k+1} + \\beta_{k+1}B) - Q_{k+1}\n$$\n我们强制 $g_{k+1}^{\\text{corr}}(\\beta_{k+1}) = 0$ 并求解 $\\beta_{k+1}$：\n$$\n\\frac{\\tilde{M}_{k+1} - \\tilde{M}_{k}}{\\Delta t} + \\frac{\\beta_{k+1}W}{\\Delta t} + \\tilde{F}_{k+1} + \\beta_{k+1}B - Q_{k+1} = 0\n$$\n将含有 $\\beta_{k+1}$ 的项组合在一起：\n$$\n\\beta_{k+1} \\left( \\frac{W}{\\Delta t} + B \\right) = - \\left( \\frac{\\tilde{M}_{k+1} - \\tilde{M}_{k}}{\\Delta t} + \\tilde{F}_{k+1} - Q_{k+1} \\right)\n$$\n右侧括号中的表达式是未修正的残差 $g_{k+1}(\\theta)$。\n$$\n\\beta_{k+1} \\left( \\frac{W + \\Delta t B}{\\Delta t} \\right) = - \\left( \\frac{(\\tilde{M}_{k+1} - \\tilde{M}_{k}) + \\Delta t \\tilde{F}_{k+1} - \\Delta t Q_{k+1}}{\\Delta t} \\right)\n$$\n假设 $\\Delta t \\neq 0$，我们可以简化：\n$$\n\\beta_{k+1} (W + \\Delta t B) = - ((\\tilde{M}_{k+1} - \\tilde{M}_{k}) + \\Delta t \\tilde{F}_{k+1} - \\Delta t Q_{k+1})\n$$\n在分母非零的条件下，如条件 $W/\\Delta t + B \\neq 0$ 所述，这意味着 $W + \\Delta t B \\neq 0$，我们可以分离出 $\\beta_{k+1}$：\n$$\n\\beta_{k+1} = - \\frac{(\\tilde{M}_{k+1} - \\tilde{M}_{k}) + \\Delta t \\tilde{F}_{k+1} - \\Delta t Q_{k+1}}{W + \\Delta t B}\n$$\n为得到最终表达式，重新整理分子：\n$$\n\\beta_{k+1} = \\frac{\\tilde{M}_{k} - \\tilde{M}_{k+1} - \\Delta t \\tilde{F}_{k+1} + \\Delta t Q_{k+1}}{W + \\Delta t B}\n$$\n该表达式提供了必须在时间 $t_{k+1}$ 添加到代理模型预测中的唯一的、空间均匀的修正项，以精确满足离散全局守恒律。",
            "answer": "$$\n\\boxed{\\frac{\\tilde{M}_{k} - \\tilde{M}_{k+1} - \\Delta t \\tilde{F}_{k+1} + \\Delta t Q_{k+1}}{W + \\Delta t B}}\n$$"
        }
    ]
}