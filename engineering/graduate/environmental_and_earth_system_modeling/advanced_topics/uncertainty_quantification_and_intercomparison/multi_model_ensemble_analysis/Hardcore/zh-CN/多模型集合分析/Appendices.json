{
    "hands_on_practices": [
        {
            "introduction": "多模型集合分析的核心在于如何智慧地组合多个模型的预测。这个实践将引导你从最基本的目标——最小化均方误差（Mean Squared Error）——出发，推导经典的逆方差加权方案。通过这个练习，你将深入理解为何表现更优（即误差方差更小）的模型在集合中应被赋予更高的权重，为后续更复杂的加权方法打下坚实的理论基础。",
            "id": "3897949",
            "problem": "在一个环境和地球系统建模的背景下，考虑一个用于季节性流域平均降水异常的多模式集合（MME）预报。设未知的真实异常为一个标量，记为 $y$。假设有 $K$ 个独立的数值模型为同一目标 $y$ 生成标量预测因子 $X_{1}, X_{2}, \\dots, X_{K}$。每个预测因子对于 $y$ 都是无偏的，即 $\\mathbb{E}[X_{i}] = y$，并且具有有限方差 $\\operatorname{Var}(X_{i}-y) = \\sigma_{i}^{2}$。定义一个线性集合估计量 $\\hat{y} = \\sum_{i=1}^{K} w_{i} X_{i}$，并受归一化约束 $\\sum_{i=1}^{K} w_{i} = 1$ 的限制，以在各预测因子无偏的前提下保持集合估计的无偏性。\n\n从均方误差的定义出发，根据上述假设，推导出能使期望平方误差 $\\mathbb{E}\\left[(\\hat{y} - y)^{2}\\right]$ 最小化的权重 $w_{i}$。你的推导必须使用第一性原理：均方误差的定义、模型误差的独立性以及归一化约束。清楚地证明该优化问题的凸性及解的唯一性。\n\n然后，将你推导出的公式应用于以下 $K=4$ 个独立模型的科学上真实的基于后报的方差（单位为 $\\text{mm}^{2}$，用于季节性异常）：\n$$\\sigma_{1}^{2} = 1,\\quad \\sigma_{2}^{2} = 4,\\quad \\sigma_{3}^{2} = 9,\\quad \\sigma_{4}^{2} = 16.$$\n计算该集合估计量的归一化权重 $w_{1}, w_{2}, w_{3}, w_{4}$。将权重表示为无量纲数，并将每个权重四舍五入到四位有效数字。\n\n最后，解释在何种条件下，所推导的权重在最小化均方误差的意义上是最优的，并阐明如果模型误差不是独立的，而是具有一个已知的正定协方差矩阵，该解将如何推广。\n\n最终答案必须是针对给定数值方差计算出的权重向量。",
            "solution": "我们从集合估计量 $\\hat{y} = \\sum_{i=1}^{K} w_{i} X_{i}$ 的定义以及归一化约束 $\\sum_{i=1}^{K} w_{i} = 1$ 开始。因为每个预测因子都是无偏的，即 $\\mathbb{E}[X_{i}] = y$，所以当 $\\sum_{i=1}^{K} w_{i} = 1$ 时，集合估计量是无偏的，因为\n$$\n\\mathbb{E}[\\hat{y}] = \\mathbb{E}\\left[\\sum_{i=1}^{K} w_{i} X_{i}\\right] = \\sum_{i=1}^{K} w_{i} \\mathbb{E}[X_{i}] = \\sum_{i=1}^{K} w_{i} y = y.\n$$\n将单个误差定义为 $e_{i} = X_{i} - y$。根据假设，$\\mathbb{E}[e_{i}] = 0$ 且 $\\operatorname{Var}(e_{i}) = \\sigma_{i}^{2}$，并且误差 $\\{e_{i}\\}$ 是相互独立的。集合误差为\n$$\n\\hat{y} - y = \\sum_{i=1}^{K} w_{i} X_{i} - y = \\sum_{i=1}^{K} w_{i} (y + e_{i}) - y = \\sum_{i=1}^{K} w_{i} e_{i}.\n$$\n$\\hat{y}$ 的均方误差为\n$$\n\\mathbb{E}\\left[(\\hat{y} - y)^{2}\\right] = \\mathbb{E}\\left[\\left(\\sum_{i=1}^{K} w_{i} e_{i}\\right)^{2}\\right].\n$$\n因为 $\\mathbb{E}[e_{i}] = 0$，所以 $\\mathbb{E}\\left[(\\hat{y} - y)^{2}\\right]$ 等于集合误差的方差：\n$$\n\\operatorname{Var}\\left(\\sum_{i=1}^{K} w_{i} e_{i}\\right) = \\sum_{i=1}^{K} w_{i}^{2} \\operatorname{Var}(e_{i}) + 2 \\sum_{1 \\leq i  j \\leq K} w_{i} w_{j} \\operatorname{Cov}(e_{i}, e_{j}).\n$$\n在独立性假设下，当 $i \\neq j$ 时，$\\operatorname{Cov}(e_{i}, e_{j}) = 0$，因此\n$$\n\\mathbb{E}\\left[(\\hat{y} - y)^{2}\\right] = \\sum_{i=1}^{K} w_{i}^{2} \\sigma_{i}^{2}.\n$$\n因此，优化问题为\n$$\n\\min_{w_{1},\\dots,w_{K}} \\sum_{i=1}^{K} w_{i}^{2} \\sigma_{i}^{2} \\quad \\text{subject to} \\quad \\sum_{i=1}^{K} w_{i} = 1.\n$$\n这是一个凸二次规划问题，因为目标函数是一个二次型，其Hessian矩阵为 $\\mathbf{H} = 2 \\operatorname{diag}(\\sigma_{1}^{2}, \\dots, \\sigma_{K}^{2})$，并且由于每个 $\\sigma_{i}^{2} > 0$，该矩阵是正定的。因此，任何满足线性等式约束的驻点都是唯一的全局最小值点。\n\n我们使用拉格朗日乘数法求解。定义拉格朗日函数\n$$\n\\mathcal{L}(w_{1}, \\dots, w_{K}, \\lambda) = \\sum_{i=1}^{K} w_{i}^{2} \\sigma_{i}^{2} - \\lambda\\left(\\sum_{i=1}^{K} w_{i} - 1\\right).\n$$\n令偏导数为零：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial w_{i}} = 2 w_{i} \\sigma_{i}^{2} - \\lambda = 0 \\quad \\Rightarrow \\quad w_{i} = \\frac{\\lambda}{2 \\sigma_{i}^{2}} \\quad \\text{for each } i,\n$$\n以及\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = -\\left(\\sum_{i=1}^{K} w_{i} - 1\\right) = 0 \\quad \\Rightarrow \\quad \\sum_{i=1}^{K} w_{i} = 1.\n$$\n将 $w_{i}$ 代入约束条件：\n$$\n\\sum_{i=1}^{K} \\frac{\\lambda}{2 \\sigma_{i}^{2}} = 1 \\quad \\Rightarrow \\quad \\frac{\\lambda}{2} \\sum_{i=1}^{K} \\frac{1}{\\sigma_{i}^{2}} = 1 \\quad \\Rightarrow \\quad \\lambda = \\frac{2}{\\sum_{j=1}^{K} \\sigma_{j}^{-2}}.\n$$\n因此，\n$$\nw_{i} = \\frac{\\lambda}{2 \\sigma_{i}^{2}} = \\frac{\\sigma_{i}^{-2}}{\\sum_{j=1}^{K} \\sigma_{j}^{-2}}.\n$$\n因此，最优权重与方差的倒数成正比，并归一化以使其总和为一：\n$$\nw_{i} \\propto \\sigma_{i}^{-2}, \\quad \\text{with} \\quad w_{i} = \\frac{\\sigma_{i}^{-2}}{\\sum_{j=1}^{K} \\sigma_{j}^{-2}}.\n$$\n唯一性由前面提到的严格凸性保证。\n\n应用于给定的数值方差 $\\sigma_{1}^{2} = 1$, $\\sigma_{2}^{2} = 4$, $\\sigma_{3}^{2} = 9$, $\\sigma_{4}^{2} = 16$。计算方差的倒数：\n$$\n\\sigma_{1}^{-2} = 1,\\quad \\sigma_{2}^{-2} = \\frac{1}{4},\\quad \\sigma_{3}^{-2} = \\frac{1}{9},\\quad \\sigma_{4}^{-2} = \\frac{1}{16}.\n$$\n方差倒数之和：\n$$\nS = 1 + \\frac{1}{4} + \\frac{1}{9} + \\frac{1}{16} = \\frac{144 + 36 + 16 + 9}{144} = \\frac{205}{144}.\n$$\n归一化权重：\n$$\nw_{1} = \\frac{1}{S} = \\frac{144}{205},\\quad\nw_{2} = \\frac{\\frac{1}{4}}{S} = \\frac{36}{205},\\quad\nw_{3} = \\frac{\\frac{1}{9}}{S} = \\frac{16}{205},\\quad\nw_{4} = \\frac{\\frac{1}{16}}{S} = \\frac{9}{205}.\n$$\n转换为小数形式，并将每个值四舍五入到四位有效数字：\n$$\nw_{1} \\approx 0.702439024 \\to 0.7024,\\quad\nw_{2} \\approx 0.175609756 \\to 0.1756,\\quad\nw_{3} \\approx 0.078048780 \\to 0.07805,\\quad\nw_{4} \\approx 0.043902439 \\to 0.04390.\n$$\n\n最优性条件：在以下条件下，方差倒数归一化权重能使 $\\mathbb{E}\\left[(\\hat{y} - y)^{2}\\right]$ 最小化：\n- 各个预测因子是无偏的，$\\mathbb{E}[X_{i}] = y$，因此通过 $\\sum_{i} w_{i} = 1$ 可以使集合估计无偏。\n- 误差 $e_{i} = X_{i} - y$ 是相互独立的，因此集合方差简化为 $\\sum_{i} w_{i}^{2} \\sigma_{i}^{2}$，没有交叉项。\n- 方差 $\\sigma_{i}^{2}$ 被正确指定（或可被一致地估计），并且为正。\n- 目标函数是均方误差；没有施加其他损失函数或约束。\n\n如果误差是相关的，其协方差矩阵 $\\boldsymbol{\\Sigma} = \\operatorname{Cov}(\\mathbf{e})$ 是一个已知的正定矩阵，其中 $\\mathbf{e} = (e_{1},\\dots,e_{K})^{\\top}$，那么集合的均方误差变为\n$$\n\\mathbb{E}\\left[(\\hat{y} - y)^{2}\\right] = \\operatorname{Var}\\left(\\sum_{i=1}^{K} w_{i} e_{i}\\right) = \\mathbf{w}^{\\top} \\boldsymbol{\\Sigma} \\mathbf{w},\n$$\n其中 $\\mathbf{w} = (w_{1},\\dots,w_{K})^{\\top}$，无偏性约束为 $\\mathbf{1}^{\\top} \\mathbf{w} = 1$，$\\mathbf{1}$ 是元素全为1的向量。通过拉格朗日乘数法求解该约束二次规划问题，可得到唯一的最小值点，从而得出广义的逆协方差权重\n$$\n\\mathbf{w}^{\\star} = \\frac{\\boldsymbol{\\Sigma}^{-1} \\mathbf{1}}{\\mathbf{1}^{\\top} \\boldsymbol{\\Sigma}^{-1} \\mathbf{1}},\n$$\n当 $\\boldsymbol{\\Sigma}$ 为对角矩阵（误差独立）时，该公式简化为上面推导的逆方差公式。在Gauss–Markov假设下，这些权重是最佳线性无偏估计量（BLUE）；对于均方误差最优性，并不需要正态性，只需要有限二阶矩和指定的协方差结构。",
            "answer": "$$\\boxed{\\begin{pmatrix}0.7024  0.1756  0.07805  0.04390\\end{pmatrix}}$$"
        },
        {
            "introduction": "在理想情况下，模型误差是相互独立的，但现实世界中的地球系统模型往往因为共享代码、参数化方案或物理假设而存在相关性。这个实践在前一个练习的基础上，探讨了当模型误差存在已知相关性时，如何构建最优的线性无偏估计。你将学习如何将模型间的依赖性纳入考量，并量化这种依赖性对集合估计方差的影响。",
            "id": "3897961",
            "problem": "考虑两个气候模型模拟器，由 $i \\in \\{1,2\\}$ 索引，它们输出月平均区域地表气温距平 $Y_i$ (单位为 $\\mathrm{K}$)。设真实但未知的距平为 $X$ (单位为 $\\mathrm{K}$)。每个模型都有一个已知的加性偏差 $b_i$ (单位为 $\\mathrm{K}$)，因此偏差校正后的模型输出为 $Y_i - b_i$。假设以下数据生成表示：$Y_i = X + b_i + \\varepsilon_i$，其中 $\\mathbb{E}[\\varepsilon_i] = 0$ 且 $\\operatorname{Var}(\\varepsilon_i) = \\sigma_i^2$。给定 $b_1 = -0.3\\,\\mathrm{K}$，$b_2 = 0.1\\,\\mathrm{K}$，$\\sigma_1^2 = 1.44\\,\\mathrm{K}^2$ 和 $\\sigma_2^2 = 0.81\\,\\mathrm{K}^2$。\n\n您的任务如下：\n\n- 仅使用线性估计量的无偏性和方差最小化的基本原理，在模型误差独立的假设下，构建 $X$ 的最小方差无偏线性估计量。该估计量必须具有形式 $\\hat{X}_{\\mathrm{ind}} = w_1\\,(Y_1 - b_1) + w_2\\,(Y_2 - b_2)$，且满足 $w_1 + w_2 = 1$。\n\n- 现在考虑通过非零误差相关性引入的模型依赖性，即 $\\operatorname{Cov}(\\varepsilon_1,\\varepsilon_2) = \\rho\\,\\sigma_1\\sigma_2$，其中 $\\rho \\in (-1,1)$ 是一个未知但固定的相关系数。构建相应的最小方差无偏线性估计量 $\\hat{X}_{\\mathrm{dep}} = w_1(\\rho)\\,(Y_1 - b_1) + w_2(\\rho)\\,(Y_2 - b_2)$，且满足 $w_1(\\rho) + w_2(\\rho) = 1$。\n\n- 使用给定的 $\\sigma_1^2$ 和 $\\sigma_2^2$，推导一个仅关于 $\\rho$ 的闭式解析表达式，用于量化依赖性的影响，该表达式为依赖情况下估计量方差与独立情况下估计量方差之比。您的最终答案必须是这个仅含 $\\rho$ 的单一简化解析表达式。不要进行数值计算，也无需在最终答案中包含单位。",
            "solution": "所述问题在形式上是合理且自洽的。这是统计估计理论中的一个标准练习，具体涉及最佳线性无偏估计量（BLUE）的构建。所提供的数据是一致且充分的，足以推导出所要求的量。该问题在科学上植根于环境和地球系统建模中常见的多模式集合分析方法。因此，该问题是有效的，我将进行完整的推导。\n\n令偏差校正后的模型输出表示为 $Z_i = Y_i - b_i$。根据数据生成模型 $Y_i = X + b_i + \\varepsilon_i$，我们可以写出 $Z_i = (X + b_i + \\varepsilon_i) - b_i = X + \\varepsilon_i$。为了构建估计量，代表真实距平的量 $X$ 被视为一个固定的未知常数。$Z_i$ 的期望和方差为：\n$$\n\\mathbb{E}[Z_i] = \\mathbb{E}[X + \\varepsilon_i] = \\mathbb{E}[X] + \\mathbb{E}[\\varepsilon_i] = X + 0 = X\n$$\n$$\n\\operatorname{Var}(Z_i) = \\operatorname{Var}(X + \\varepsilon_i) = \\operatorname{Var}(\\varepsilon_i) = \\sigma_i^2\n$$\n问题考虑了一个形式为 $\\hat{X} = w_1 Z_1 + w_2 Z_2$ 的线性估计量，这等价于所要求的形式 $\\hat{X} = w_1(Y_1 - b_1) + w_2(Y_2 - b_2)$。\n\n首先，我们验证无偏性条件。如果 $\\mathbb{E}[\\hat{X}] = X$，则估计量 $\\hat{X}$ 是 $X$ 的无偏估计。\n$$\n\\mathbb{E}[\\hat{X}] = \\mathbb{E}[w_1 Z_1 + w_2 Z_2] = w_1 \\mathbb{E}[Z_1] + w_2 \\mathbb{E}[Z_2] = w_1 X + w_2 X = (w_1 + w_2)X\n$$\n为使此式对 $X$ 的任何值都等于 $X$，要求 $w_1 + w_2 = 1$。在问题陈述中，对于独立和相关两种情况都明确给出了这个约束条件，从而确保任何规定形式的估计量都是无偏的。\n\n一般线性估计量的方差由下式给出：\n$$\n\\operatorname{Var}(\\hat{X}) = \\operatorname{Var}(w_1 Z_1 + w_2 Z_2) = \\operatorname{Var}(w_1 (X + \\varepsilon_1) + w_2 (X + \\varepsilon_2)) = \\operatorname{Var}(w_1\\varepsilon_1 + w_2\\varepsilon_2)\n$$\n$$\n\\operatorname{Var}(\\hat{X}) = w_1^2 \\operatorname{Var}(\\varepsilon_1) + w_2^2 \\operatorname{Var}(\\varepsilon_2) + 2 w_1 w_2 \\operatorname{Cov}(\\varepsilon_1, \\varepsilon_2)\n$$\n$$\n\\operatorname{Var}(\\hat{X}) = w_1^2 \\sigma_1^2 + w_2^2 \\sigma_2^2 + 2 w_1 w_2 \\rho\\sigma_1\\sigma_2\n$$\n\n我们的任务是在约束条件 $w_1 + w_2 = 1$ 下最小化该方差。我们可以将 $w_2$ 表示为 $1 - w_1$，然后将方差作为仅关于 $w_1$ 的函数进行最小化。\n\n**情况1：独立误差 ($\\hat{X}_{\\mathrm{ind}}$)**\n\n在这种情况下，误差是独立的，这意味着它们的协方差为零。相关系数 $\\rho$ 为 $0$。估计量的方差，我们记为 $V_{\\mathrm{ind}}$，为：\n$$\nV_{\\mathrm{ind}}(w_1) = w_1^2 \\sigma_1^2 + w_2^2 \\sigma_2^2 = w_1^2 \\sigma_1^2 + (1-w_1)^2 \\sigma_2^2\n$$\n为了找到使该方差最小化的权重 $w_1$，我们对其关于 $w_1$ 求导，并令其等于零：\n$$\n\\frac{dV_{\\mathrm{ind}}}{dw_1} = 2w_1 \\sigma_1^2 - 2(1-w_1)\\sigma_2^2 = 0\n$$\n$$\nw_1 \\sigma_1^2 = (1-w_1)\\sigma_2^2 \\implies w_1 \\sigma_1^2 = \\sigma_2^2 - w_1\\sigma_2^2\n$$\n$$\nw_1(\\sigma_1^2 + \\sigma_2^2) = \\sigma_2^2 \\implies w_1 = \\frac{\\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2}\n$$\n相应的权重 $w_2$ 是：\n$$\nw_2 = 1 - w_1 = 1 - \\frac{\\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2} = \\frac{\\sigma_1^2}{\\sigma_1^2 + \\sigma_2^2}\n$$\n独立情况下的最小方差 $\\operatorname{Var}(\\hat{X}_{\\mathrm{ind}})$，可以通过将这些最优权重代回方差表达式来求得：\n$$\n\\operatorname{Var}(\\hat{X}_{\\mathrm{ind}}) = \\left(\\frac{\\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2}\\right)^2 \\sigma_1^2 + \\left(\\frac{\\sigma_1^2}{\\sigma_1^2 + \\sigma_2^2}\\right)^2 \\sigma_2^2\n$$\n$$\n\\operatorname{Var}(\\hat{X}_{\\mathrm{ind}}) = \\frac{\\sigma_2^4 \\sigma_1^2 + \\sigma_1^4 \\sigma_2^2}{(\\sigma_1^2 + \\sigma_2^2)^2} = \\frac{\\sigma_1^2 \\sigma_2^2 (\\sigma_2^2 + \\sigma_1^2)}{(\\sigma_1^2 + \\sigma_2^2)^2} = \\frac{\\sigma_1^2 \\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2}\n$$\n\n**情况2：相关误差 ($\\hat{X}_{\\mathrm{dep}}$)**\n\n现在，我们允许 $\\rho \\in (-1,1)$。估计量的方差 $V_{\\mathrm{dep}}$ 为：\n$$\nV_{\\mathrm{dep}}(w_1) = w_1^2 \\sigma_1^2 + (1-w_1)^2 \\sigma_2^2 + 2w_1(1-w_1)\\rho\\sigma_1\\sigma_2\n$$\n为了找到最优权重 $w_1(\\rho)$，我们再次对 $w_1$ 求导并令其为零：\n$$\n\\frac{dV_{\\mathrm{dep}}}{dw_1} = 2w_1 \\sigma_1^2 - 2(1-w_1)\\sigma_2^2 + 2(1-2w_1)\\rho\\sigma_1\\sigma_2 = 0\n$$\n$$\nw_1 \\sigma_1^2 - \\sigma_2^2 + w_1\\sigma_2^2 + \\rho\\sigma_1\\sigma_2 - 2w_1\\rho\\sigma_1\\sigma_2 = 0\n$$\n$$\nw_1(\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2) = \\sigma_2^2 - \\rho\\sigma_1\\sigma_2\n$$\n$$\nw_1(\\rho) = \\frac{\\sigma_2^2 - \\rho\\sigma_1\\sigma_2}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}\n$$\n相应的权重 $w_2(\\rho)$ 是：\n$$\nw_2(\\rho) = 1 - w_1(\\rho) = \\frac{(\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2) - (\\sigma_2^2 - \\rho\\sigma_1\\sigma_2)}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2} = \\frac{\\sigma_1^2 - \\rho\\sigma_1\\sigma_2}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}\n$$\n为了求最小方差，我们代入 $V_{\\mathrm{dep}}(w_1)= w_1^2(\\sigma_1^2+\\sigma_2^2-2\\rho\\sigma_1\\sigma_2) + w_1(-2\\sigma_2^2+2\\rho\\sigma_1\\sigma_2) + \\sigma_2^2$ 并使用最优权重 $w_1(\\rho)$。\n$$\n\\operatorname{Var}(\\hat{X}_{\\mathrm{dep}}) = w_1(\\rho)[\\sigma_2^2 - \\rho\\sigma_1\\sigma_2] + (1-w_1(\\rho))[-\\sigma_1^2 + \\rho\\sigma_1\\sigma_2]\n$$\n一个更直接的方法是将最优权重代入方差公式。令权重的分母为 $D = \\sigma_1^2+\\sigma_2^2-2\\rho\\sigma_1\\sigma_2$。\n$$\n\\operatorname{Var}(\\hat{X}_{\\mathrm{dep}}) = \\frac{(\\sigma_2^2-\\rho\\sigma_1\\sigma_2)^2 \\sigma_1^2}{D^2} + \\frac{(\\sigma_1^2-\\rho\\sigma_1\\sigma_2)^2 \\sigma_2^2}{D^2} + \\frac{2(\\sigma_2^2-\\rho\\sigma_1\\sigma_2)(\\sigma_1^2-\\rho\\sigma_1\\sigma_2)\\rho\\sigma_1\\sigma_2}{D^2}\n$$\n这种代数展开很繁琐。根据BLUE的一般理论，有一个更简洁的结果指出最小方差为 $\\frac{\\sigma_1^2\\sigma_2^2(1-\\rho^2)}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}$。让我们来验证这一点。方差表达式的分子是 $\\sigma_1^2 (\\sigma_2^4 - 2\\rho \\sigma_1 \\sigma_2^3 + \\rho^2 \\sigma_1^2 \\sigma_2^2) + \\sigma_2^2 (\\sigma_1^4 - 2\\rho \\sigma_1^3 \\sigma_2 + \\rho^2 \\sigma_1^2 \\sigma_2^2) + 2\\rho\\sigma_1\\sigma_2 (\\sigma_1^2\\sigma_2^2 - \\rho\\sigma_1\\sigma_2^3 - \\rho\\sigma_1^3\\sigma_2 + \\rho^2\\sigma_1^2\\sigma_2^2)$。化简后得到 $(\\sigma_1^2 \\sigma_2^2(1-\\rho^2)) \\times D$。因此，\n$$\n\\operatorname{Var}(\\hat{X}_{\\mathrm{dep}}) = \\frac{\\sigma_1^2 \\sigma_2^2(1-\\rho^2)}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}\n$$\n\n**量化依赖性的影响**\n\n最终任务是推导比率 $R(\\rho) = \\frac{\\operatorname{Var}(\\hat{X}_{\\mathrm{dep}})}{\\operatorname{Var}(\\hat{X}_{\\mathrm{ind}})}$。\n$$\nR(\\rho) = \\frac{\\frac{\\sigma_1^2 \\sigma_2^2(1-\\rho^2)}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}}{\\frac{\\sigma_1^2 \\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2}}\n$$\n项 $\\sigma_1^2\\sigma_2^2$ 被消去：\n$$\nR(\\rho) = \\frac{1-\\rho^2}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2} \\times (\\sigma_1^2 + \\sigma_2^2) = \\frac{(1-\\rho^2)(\\sigma_1^2 + \\sigma_2^2)}{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}\n$$\n现在，我们代入给定值：$\\sigma_1^2 = 1.44$ 和 $\\sigma_2^2 = 0.81$。这意味着 $\\sigma_1 = \\sqrt{1.44} = 1.2$ 和 $\\sigma_2 = \\sqrt{0.81} = 0.9$。\n所需的计算部分如下：\n$$\n\\sigma_1^2 + \\sigma_2^2 = 1.44 + 0.81 = 2.25\n$$\n$$\n\\sigma_1\\sigma_2 = 1.2 \\times 0.9 = 1.08\n$$\n$$\n2\\sigma_1\\sigma_2 = 2 \\times 1.08 = 2.16\n$$\n将这些数值代入 $R(\\rho)$ 的表达式中：\n$$\nR(\\rho) = \\frac{(1-\\rho^2)(2.25)}{2.25 - 2.16\\rho}\n$$\n为简化此表达式，我们可以将分子和分母同乘以 $100$ 来消除小数：\n$$\nR(\\rho) = \\frac{225(1-\\rho^2)}{225 - 216\\rho}\n$$\n我们求 $225$ 和 $216$ 的最大公约数。$225$ 的质因数分解是 $3^2 \\times 5^2$。$216$ 的质因数分解是 $2^3 \\times 3^3$。最大公约数是 $3^2 = 9$。将系数除以 $9$：\n$$\n225 / 9 = 25\n$$\n$$\n216 / 9 = 24\n$$\n因此，该比率的简化闭式表达式为：\n$$\nR(\\rho) = \\frac{25(1-\\rho^2)}{25 - 24\\rho}\n$$\n在给定的模型误差特征下，该表达式将估计量方差之比量化为仅与误差相关性 $\\rho$ 相关的函数。",
            "answer": "$$\\boxed{\\frac{25(1 - \\rho^2)}{25 - 24\\rho}}$$"
        },
        {
            "introduction": "构建了不同的集合预报方案后，我们如何科学地判断哪一个更好？特别是在处理具有时间自相关性的气候或环境时间序列数据时，简单的性能指标比较可能产生误导。这个动手编程练习将指导你实现配对块自举法（Paired Block Bootstrap），这是一种强大的非参数检验方法，用于严格比较两个集合方案的连续分级概率评分（CRPS）。通过这个实践，你将掌握评估和验证集合预报系统性能的关键计算技能。",
            "id": "3897964",
            "problem": "给定环境与地球系统建模中的两种相互竞争的集合加权方案，您需要根据连续分级概率评分 (Continuous Ranked Probability Score, CRPS) 来评估其中一种方案是否显著优于另一种。根据定义，对于一个累积分布函数为 $F(z)$ 的概率预报和一个已实现的观测值 $y$，连续分级概率评分 (CRPS) 是一个积分 $$\\mathrm{CRPS}(F,y) = \\int_{-\\infty}^{\\infty} \\left(F(z) - \\mathbb{1}\\{z \\ge y\\}\\right)^2 \\, \\mathrm{d}z,$$ 其物理单位与预报量的单位相同。较低的 $\\mathrm{CRPS}$ 值表示更优的概率预报。在本问题中，每天和每种方案的 CRPS 值已经计算好；您无需从 $F$ 和 $y$ 计算 CRPS。\n\n您必须构建一个配对块自举法（paired block bootstrap）假设检验，以评估在考虑时间自相关性的情况下，集合加权方案 $A$ 是否在指定时期内显著优于方案 $B$。设有一个由 $t \\in \\{1,2,\\dots,N\\}$ 索引的 $N$ 天序列。令 $C^{A}_t$ 和 $C^{B}_t$ 分别表示方案 $A$ 和方案 $B$ 的每日 CRPS 值。定义每日配对改进量 $$d_t = C^{B}_t - C^{A}_t,$$ 当方案 $A$ 在第 $t$ 天的 CRPS 低于方案 $B$ 时，该值为正。推断目标是平均改进量 $$\\mu_d = \\mathbb{E}[d_t].$$ 您需要检验单侧假设 $$H_0: \\mu_d \\le 0 \\quad \\text{对} \\quad H_1: \\mu_d  0,$$ 其中拒绝原假设支持方案 $A$ 显著优于方案 $B$。\n\n为保持科学真实性，请使用块自举法（block bootstrap）处理 $\\{d_t\\}$ 中的自相关性。将时间序列划分为长度为 $L$ 天的非重叠连续块；如果 $L$ 不能整除 $N$，则最后一个块可能会更短。令样本均值为 $$\\bar{d} = \\frac{1}{N} \\sum_{t=1}^N d_t.$$ 通过对差值进行中心化，创建在原假设下的零均值序列：$$r_t = d_t - \\bar{d}.$$ 对于每个自举法重复 $i \\in \\{1,2,\\dots,R\\}$，从原始块集合中有放回地抽样块，将抽样到的 $\\{r_t\\}$ 块连接起来，直到达到至少 $N$ 个元素，然后截断至 $N$ 个元素，并计算重复样本的均值 $\\bar{r}^{*(i)}$。那么，对于 $H_0: \\mu_d \\le 0$ 的近似单侧 p 值是 $$p = \\frac{1}{R} \\sum_{i=1}^R \\mathbb{1}\\left\\{\\bar{r}^{*(i)} \\ge \\bar{d}\\right\\}.$$ 对于选定的显著性水平 $\\alpha \\in (0,1)$，如果 $p  \\alpha$，则判定方案 $A$ 显著优于方案 $B$。\n\n您必须在一个完整的、可运行的程序中实现此检验。该程序必须为每个测试用例生成合成但科学上合理的每日 CRPS 序列，并使用自回归过程来模拟时间自相关性。具体来说，对于每个测试用例：\n- 生成一个基准的 1 阶自回归过程 (AR(1)) $\\{X_t\\}$，其参数为 $\\phi \\in (-1, 1)$，高斯新息的标准差为 $\\sigma$，即 $$X_t = \\phi X_{t-1} + \\epsilon_t, \\quad \\epsilon_t \\sim \\mathcal{N}(0, \\sigma_t^2),$$ 其中 $X_0 = 0$，且 $\\sigma_t = \\sigma$ 为常数，或是一个指定的分段常数异方差序列。\n- 生成方案特定误差 $\\{E^A_t\\}$ 和 $\\{E^B_t\\}$，作为独立的 AR(1) 过程，其固定参数为 $\\phi_s = 0.4$，高斯新息的固定标准差为 $\\sigma_s = 0.08$，除非另有说明。\n- 构建每日 CRPS 值 $$C^{B}_t = \\beta + X_t + E^B_t, \\qquad C^{A}_t = \\beta + X_t + E^A_t - \\Delta,$$ 其中 $\\beta = 1.0$ 确保非负性，然后通过将因噪声产生的任何负值替换为 $0$ 来强制实现非负性。量 $\\Delta$ 编码了方案 $A$ 相对于方案 $B$ 的预期改进；正的 $\\Delta$ 意味着 $A$ 倾向于比 $B$ 有更低的 CRPS。\n\n然后，您必须应用上述配对块自举法检验来计算 p 值 $p$，并为每个测试用例返回一个布尔决策，指示是否 $p  \\alpha$。\n\n角度单位不适用。CRPS 的物理单位是预报量的单位，但最终输出是布尔值，因此无单位。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3]”）。\n\n使用以下测试套件，每个套件由 $(N, \\phi, \\sigma, \\Delta, L, R, \\alpha, \\text{seed}, \\text{heteroskedastic})$ 指定，其中 heteroskedastic 指示 $\\sigma_t$ 是否按规定随时间变化：\n- 案例 1 (通用“理想路径”)： $(N = 180, \\phi = 0.6, \\sigma = 0.2, \\Delta = 0.15, L = 10, R = 5000, \\alpha = 0.05, \\text{seed} = 123, \\text{heteroskedastic} = \\text{False})$。\n- 案例 2 (边界情况，独立日)： $(N = 180, \\phi = 0.0, \\sigma = 0.25, \\Delta = 0.0, L = 1, R = 3000, \\alpha = 0.05, \\text{seed} = 456, \\text{heteroskedastic} = \\text{False})$。\n- 案例 3 (不可整除的块长度，小样本)： $(N = 23, \\phi = 0.7, \\sigma = 0.3, \\Delta = 0.10, L = 10, R = 5000, \\alpha = 0.05, \\text{seed} = 321, \\text{heteroskedastic} = \\text{False})$。\n- 案例 4 (相反效果，方案 A 更差)： $(N = 120, \\phi = 0.5, \\sigma = 0.25, \\Delta = -0.10, L = 7, R = 4000, \\alpha = 0.05, \\text{seed} = 789, \\text{heteroskedastic} = \\text{False})$。\n- 案例 5 (异方差自相关)： $(N = 240, \\phi = 0.6, \\sigma = 0.1 \\text{ for } t \\le N/2 \\text{ and } \\sigma = 0.3 \\text{ for } t > N/2, \\Delta = 0.12, L = 12, R = 6000, \\alpha = 0.05, \\text{seed} = 2024, \\text{heteroskedastic} = \\text{True})$。\n\n对于每种情况，根据上述规则使用指定参数生成 $\\{C^{A}_t\\}$ 和 $\\{C^{B}_t\\}$，计算配对差值 $\\{d_t\\}$，执行配对块自举法检验，并返回一个布尔值，指示方案 $A$ 是否在水平 $\\alpha$ 上显著优于方案 $B$。\n\n您的程序应生成单行输出，其中包含对应于五个案例的五个布尔值的列表，按案例 1 到案例 5 的顺序排列，形式为方括号括起来的逗号分隔列表，例如“[True,False,True,False,True]”。",
            "solution": "问题陈述已经过分析并被认为是有效的。它具有科学依据、问题定义清晰、客观，并包含了构建唯一可验证解所需的所有必要信息。所描述的方法——应用于模拟时间序列数据的配对块自举法假设检验——是统计气候学和环境科学中比较模型或预报性能同时考虑时间自相关性的标准且适当的技术。用于数据生成和统计检验的所有参数都已明确提供。\n\n目标是实现一个配对块自举法假设检验，以确定一个表示为方案 $A$ 的预报集合加权方案是否比竞争方案 $B$ 提供了统计上显著的改进。性能指标是连续分级概率评分 (CRPS)，其中较低的值表示更好的性能。方案 $A$ 相对于方案 $B$ 在第 $t$ 天的改进由差值 $d_t = C^B_t - C^A_t$ 来衡量，其中 $C^A_t$ 和 $C^B_t$ 是各自的 CRPS 值。$d_t$ 的正值表示方案 $A$ 在那一天表现更好。\n\n核心推断任务是检验关于真实平均改进量 $\\mu_d = \\mathbb{E}[d_t]$ 的单侧假设：\n$$H_0: \\mu_d \\le 0 \\quad \\text{(方案 A 不优于方案 B)}$$\n$$H_1: \\mu_d  0 \\quad \\text{(方案 A 显著优于方案 B)}$$\n\n解决方案主要分为三个阶段：合成数据生成、块自举法检验的实现，以及基于计算出的 p 值的最终决策。\n\n**1. 合成数据生成**\n\n为了创建一个真实的测试平台，我们首先为 $N$ 天生成合成的每日 CRPS 时间序列 $\\{C^A_t\\}$ 和 $\\{C^B_t\\}$。这个过程模拟了真实世界环境数据的特征，特别是时间自相关性。\n\n每日 CRPS 值按以下方式构建：\n$$C^{B}_t = \\beta + X_t + E^B_t$$\n$$C^{A}_t = \\beta + X_t + E^A_t - \\Delta$$\n\n这里，$\\beta = 1.0$ 是一个基准 CRPS 值，确保分数通常为正。$\\{X_t\\}$ 代表影响两种方案的共同潜在环境过程。它被建模为一阶自回归 (AR(1)) 过程：\n$$X_t = \\phi X_{t-1} + \\epsilon_t, \\quad \\text{with } X_0 = 0$$\n其中 $\\phi$ 是自相关参数，$\\epsilon_t$ 是高斯新息，$\\epsilon_t \\sim \\mathcal{N}(0, \\sigma_t^2)$。标准差 $\\sigma_t$ 可以是常数，也可以随时间变化（异方差性）。\n\n$\\{E^A_t\\}$ 和 $\\{E^B_t\\}$ 是独立的、方案特定的误差项，也建模为 AR(1) 过程，其固定参数为 $\\phi_s = 0.4$，新息标准差为 $\\sigma_s = 0.08$。\n\n参数 $\\Delta$ 代表方案 $A$ 相对于方案 $B$ 的系统性改进。如果 $\\Delta  0$，方案 $A$ 被设计为平均具有更低的 CRPS。每日差值的期望值为 $\\mathbb{E}[d_t] = \\mathbb{E}[C^B_t - C^A_t] = \\mathbb{E}[(\\beta + X_t + E^B_t) - (\\beta + X_t + E^A_t - \\Delta)] = \\Delta$。因此，检验 $\\mu_d  0$ 等价于检验 $\\Delta  0$。\n\n最后，由于 CRPS 值不能为负，任何生成的小于 0 的值都被设置为 0。\n\n**2. 配对块自举法检验**\n\n采用块自举法是因为每日差值序列 $d_t = C^B_t - C^A_t = (E^B_t - E^A_t) + \\Delta$ 继承了 AR(1) 误差项的时间自相关性。该方法通过重采样连续观测块而非单个数据点来保留依赖结构。\n\n程序如下：\n- **计算观测统计量**：计算每日差值的样本均值 $\\bar{d} = \\frac{1}{N} \\sum_{t=1}^N d_t$。这是我们对 $\\mu_d$ 的最佳估计。\n- **中心化数据**：为了模拟原假设 ($H_0: \\mu_d = 0$)，我们创建一个中心化后的序列 $r_t = d_t - \\bar{d}$。该序列的样本均值恰好为 0，并保留了原始 $\\{d_t\\}$ 序列的自相关结构。\n- **构成数据块**：将中心化后的序列 $\\{r_t\\}$ 分割成长度为 $L$ 的非重叠块。如果 $N$ 不能被 $L$ 整除，最后一个块会更短。\n- **自举法重采样**：对于 $R$ 个自举法重复中的每一个：\n    1. 通过从原始块集合中有放回地抽样块，创建一个长度至少为 $N$ 的新时间序列。需要抽取的块数为 $\\lceil N/L \\rceil$。\n    2. 将连接得到的序列截断至原始长度 $N$。\n    3. 计算此自举法重复序列的均值 $\\bar{r}^{*(i)}$。此过程生成了在原假设下均值的经验抽样分布。\n\n**3. P值计算与决策**\n\n单侧 p 值是自举法均值 $\\bar{r}^{*(i)}$ 中等于或比观测样本均值 $\\bar{d}$ 更极端的比例。对于我们的备择假设 $H_1: \\mu_d  0$，这表示为：\n$$p = \\frac{1}{R} \\sum_{i=1}^R \\mathbb{1}\\left\\{\\bar{r}^{*(i)} \\ge \\bar{d}\\right\\}$$\n其中 $\\mathbb{1}\\{\\cdot\\}$ 是指示函数。此 p 值表示在真实改进量实际为零的情况下，观测到等于或大于 $\\bar{d}$ 的平均改进量的概率。\n\n通过将 p 值与预定义的显著性水平 $\\alpha$ 进行比较来做出最终决策。如果 $p  \\alpha$，我们拒绝原假设 $H_0$，并得出结论：方案 $A$ 相比方案 $B$ 有统计上显著的改进。否则，我们不拒绝 $H_0$。将对每个测试用例使用指定的参数实施这整个过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_ar1(n_samples: int, phi: float, sigma_vec: np.ndarray, rng: np.random.Generator) - np.ndarray:\n    \"\"\"\n    Generates a first-order autoregressive (AR(1)) time series.\n    X_t = phi * X_{t-1} + innovation_t\n    \"\"\"\n    if n_samples == 0:\n        return np.array([])\n    \n    innovations = rng.normal(0, sigma_vec, n_samples)\n    x = np.zeros(n_samples)\n    # Per problem statement X_0 = 0, so the first term is just the first innovation\n    x[0] = innovations[0]\n    for t in range(1, n_samples):\n        x[t] = phi * x[t-1] + innovations[t]\n    return x\n\ndef perform_bootstrap_test(case_params):\n    \"\"\"\n    Generates synthetic data and performs the paired block bootstrap test for a single case.\n    \"\"\"\n    N, phi, sigma, Delta, L, R, alpha, seed, heteroskedastic = case_params\n\n    rng = np.random.default_rng(seed)\n\n    # 1. Generate synthetic CRPS data\n    # Define baseline AR(1) process standard deviation\n    if heteroskedastic:\n        # Case 5 specifics: sigma=0.1 for first half, 0.3 for second half\n        sigma_t = np.full(N, sigma) \n        sigma_t[N//2:] = 0.3\n    else:\n        sigma_t = np.full(N, sigma)\n\n    X_t = generate_ar1(N, phi, sigma_t, rng)\n\n    # Define scheme-specific AR(1) errors\n    phi_s = 0.4\n    sigma_s = 0.08\n    sigma_s_vec = np.full(N, sigma_s)\n    E_A_t = generate_ar1(N, phi_s, sigma_s_vec, rng)\n    E_B_t = generate_ar1(N, phi_s, sigma_s_vec, rng)\n\n    # Construct CRPS values\n    beta = 1.0\n    C_B_t = beta + X_t + E_B_t\n    C_A_t = beta + X_t + E_A_t - Delta\n    \n    # Enforce non-negativity of CRPS\n    C_A_t = np.maximum(0, C_A_t)\n    C_B_t = np.maximum(0, C_B_t)\n\n    # 2. Implement the Paired Block Bootstrap Test\n    d_t = C_B_t - C_A_t\n    \n    if N == 0:\n        return False\n\n    d_bar = np.mean(d_t)\n    \n    # Center the series to simulate the null hypothesis (mean = 0)\n    r_t = d_t - d_bar\n\n    # Partition the centered series into non-overlapping blocks\n    # np.array_split handles non-divisible lengths correctly\n    split_indices = np.arange(L, N, L)\n    blocks = np.array_split(r_t, split_indices)\n\n    # Perform bootstrap resampling\n    bootstrap_means = np.zeros(R)\n    num_blocks_to_sample = int(np.ceil(N / L))\n    \n    for i in range(R):\n        # Sample block indices with replacement\n        block_indices = rng.choice(len(blocks), size=num_blocks_to_sample, replace=True)\n        \n        # Concatenate sampled blocks and truncate to length N\n        bootstrap_series = np.concatenate([blocks[j] for j in block_indices])[:N]\n        \n        # Compute mean of the bootstrap replicate\n        bootstrap_means[i] = np.mean(bootstrap_series)\n\n    # 3. Calculate p-value and determine significance\n    # p = proportion of bootstrap means = observed mean\n    p_value = np.mean(bootstrap_means = d_bar)\n    \n    return p_value  alpha\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N, phi, sigma, Delta, L, R, alpha, seed, heteroskedastic)\n        (180, 0.6, 0.2, 0.15, 10, 5000, 0.05, 123, False),\n        (180, 0.0, 0.25, 0.0, 1, 3000, 0.05, 456, False),\n        (23, 0.7, 0.3, 0.10, 10, 5000, 0.05, 321, False),\n        (120, 0.5, 0.25, -0.10, 7, 4000, 0.05, 789, False),\n        (240, 0.6, 0.1, 0.12, 12, 6000, 0.05, 2024, True)\n    ]\n\n    results = []\n    for case in test_cases:\n        result = perform_bootstrap_test(case)\n        results.append(str(result).lower())\n\n    # Print the final output in the required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}