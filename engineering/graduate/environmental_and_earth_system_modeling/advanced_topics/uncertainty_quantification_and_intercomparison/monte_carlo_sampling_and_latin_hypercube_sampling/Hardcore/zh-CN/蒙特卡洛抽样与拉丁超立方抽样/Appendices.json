{
    "hands_on_practices": [
        {
            "introduction": "理解任何采样方法的第一步都是亲手构建它。本练习旨在通过引导您逐步构建一个小型样本，来揭开拉丁超立方采样 (LHS) 的神秘面纱。这个实践将让您直观地掌握 LHS 的核心原则——保证样本在每个输入维度上的边缘分层特性，从而为更复杂的应用打下坚实的基础。",
            "id": "3897076",
            "problem": "考虑一个三参数环境模型，其中三个不确定性输入被建模为单位区间上的独立标准均匀随机变量：降水比例因子 $p \\sim \\mathrm{Uniform}(0,1)$，土壤导水率比例因子 $k \\sim \\mathrm{Uniform}(0,1)$，以及地表反照率比例因子 $a \\sim \\mathrm{Uniform}(0,1)$。作为蒙特卡洛抽样 (MCS) 设计的一部分，您需要构建一个大小为 $n=5$、维度为 $d=3$ 的拉丁超立方抽样 (LHS)，使用基于独立随机置换和等概率层内独立均匀抖动的标准构造方法。\n\n对这三个维度，使用以下 $\\{1,2,3,4,5\\}$ 的独立置换，\n$$\n\\sigma_{p} = (3,\\,1,\\,5,\\,2,\\,4),\\quad\n\\sigma_{k} = (5,\\,2,\\,4,\\,1,\\,3),\\quad\n\\sigma_{a} = (2,\\,3,\\,1,\\,5,\\,4),\n$$\n以及以下独立的抖动值 $u_{i,j} \\in (0,1)$，其中 $i \\in \\{1,2,3,4,5\\}$ 为样本索引，$j \\in \\{p,k,a\\}$ 为维度索引，\n$$\n\\begin{aligned}\nu_{1,p}=0.37,\\quad u_{1,k}=0.82,\\quad u_{1,a}=0.15,\\\\\nu_{2,p}=0.58,\\quad u_{2,k}=0.29,\\quad u_{2,a}=0.64,\\\\\nu_{3,p}=0.09,\\quad u_{3,k}=0.53,\\quad u_{3,a}=0.41,\\\\\nu_{4,p}=0.76,\\quad u_{4,k}=0.12,\\quad u_{4,a}=0.87,\\\\\nu_{5,p}=0.24,\\quad u_{5,k}=0.67,\\quad u_{5,a}=0.33.\n\\end{aligned}\n$$\n使用标准的 LHS 映射构造显式 LHS 样本矩阵 $X \\in [0,1]^{5 \\times 3}$\n$$\nx_{i,j} \\;=\\; \\frac{\\sigma_{j}(i) - u_{i,j}}{n},\n$$\n对于每个样本索引 $i \\in \\{1,2,3,4,5\\}$ 和每个维度 $j \\in \\{p,k,a\\}$。然后，对于每个边缘维度 $j$，将 $[0,1]$ 划分为 $n=5$ 个等宽的区间\n$$\nB_{k} \\;=\\; \\left(\\frac{k-1}{5},\\,\\frac{k}{5}\\right),\\quad k=1,2,3,4,5,\n$$\n并计算边缘区间计数 $c_{j,k}$，定义为维度 $j$ 中落入区间 $B_k$ 的样本 $x_{i,j}$ 的数量。最后，定义分层偏差度量\n$$\nD_{\\max} \\;=\\; \\max_{j \\in \\{p,k,a\\}} \\;\\max_{k \\in \\{1,2,3,4,5\\}} \\; \\left|\\,c_{j,k} - 1\\,\\right|.\n$$\n\n从拉丁超立方抽样作为在每个边缘上使用独立置换和抖动的分层抽样的基本定义出发，构建 $X$，计算所有区间计数 $c_{j,k}$，并评估 $D_{\\max}$。将最终答案表示为精确实数。无需四舍五入，$D_{\\max}$ 不带物理单位。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤1：提取已知条件\n- **模型参数**：三个独立输入 $p$、$k$、$a$，被建模为 $\\mathrm{Uniform}(0,1)$ 随机变量。\n- **抽样方法**：拉丁超立方抽样 (LHS)。\n- **样本大小**：$n=5$。\n- **维度**：$d=3$。\n- **置换**：\n  - $\\sigma_{p} = (3, 1, 5, 2, 4)$\n  - $\\sigma_{k} = (5, 2, 4, 1, 3)$\n  - $\\sigma_{a} = (2, 3, 1, 5, 4)$\n- **抖动值**：$u_{i,j} \\in (0,1)$，以 $5 \\times 3$ 表格形式提供。\n  - $u_{1,p}=0.37$, $u_{1,k}=0.82$, $u_{1,a}=0.15$\n  - $u_{2,p}=0.58$, $u_{2,k}=0.29$, $u_{2,a}=0.64$\n  - $u_{3,p}=0.09$, $u_{3,k}=0.53$, $u_{3,a}=0.41$\n  - $u_{4,p}=0.76$, $u_{4,k}=0.12$, $u_{4,a}=0.87$\n  - $u_{5,p}=0.24$, $u_{5,k}=0.67$, $u_{5,a}=0.33$\n- **LHS 映射公式**：$x_{i,j} = \\frac{\\sigma_{j}(i) - u_{i,j}}{n}$，对于 $i \\in \\{1,2,3,4,5\\}$ 和 $j \\in \\{p,k,a\\}$。\n- **区间**：$B_{k} = \\left(\\frac{k-1}{5}, \\frac{k}{5}\\right)$，对于 $k=1,2,3,4,5$。\n- **区间计数**：$c_{j,k}$ 是维度 $j$ 中落入区间 $B_k$ 的样本 $x_{i,j}$ 的数量。\n- **度量**：$D_{\\max} = \\max_{j \\in \\{p,k,a\\}} \\max_{k \\in \\{1,2,3,4,5\\}} |c_{j,k} - 1|$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题描述了一个标准的、尽管是特定的生成拉丁超立方样本的程序。均匀分布、置换、分层和抖动这些概念是计算科学和统计学中蒙特卡洛方法的基础。所提供的 LHS 映射公式 $x_{i,j} = \\frac{\\sigma_{j}(i) - u_{i,j}}{n}$ 是一种有效（尽管不如 $x_{i,j} = \\frac{\\sigma_{j}(i) - 1 + u_{i,j}}{n}$ 常见）的构造方法。它保证了 LHS 的关键分层特性，即每个边缘轴被划分为 $n$ 个等概率区间，并且每个区间恰好包含一个样本点。问题是自包含的，提供了所有必要的数据和公式。它具有科学依据，问题陈述清晰，客观，并且不违反任何无效标准。该问题要求显式构造并验证一个理论上已知的属性，这是一个有效的教学练习。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将构建一个完整的解答。\n\n问题的核心是构建一个特定的拉丁超立方样本，然后使用给定的度量 $D_{\\max}$ 来验证其分层属性。一个大小为 $n$ 的 LHS 的定义特征是，对于每个维度（或参数），$n$ 个样本的放置方式使得 $n$ 个等概率的边缘层中每层都恰好有一个样本。在这种情况下，由于输入来自 $\\mathrm{Uniform}(0,1)$，这些层就是区间 $B_k$。\n\n规定的映射是 $x_{i,j} = \\frac{\\sigma_{j}(i) - u_{i,j}}{n}$。这里 $n=5$，对于每个维度 $j$，$\\sigma_j$ 是 $\\{1, 2, 3, 4, 5\\}$ 的一个置换。抖动 $u_{i,j}$ 在区间 $(0,1)$ 内。对于给定的样本 $i$ 和维度 $j$，让我们确定值 $x_{i,j}$ 落入哪个区间 $B_k$。如果 $\\frac{k-1}{n}  x  \\frac{k}{n}$，则值 $x$ 在区间 $B_k = \\left(\\frac{k-1}{n}, \\frac{k}{n}\\right)$ 内。\n代入 $x_{i,j}$ 的公式：\n$$\n\\frac{k-1}{n}  \\frac{\\sigma_{j}(i) - u_{i,j}}{n}  \\frac{k}{n}\n$$\n两边乘以 $n$ 得：\n$$\nk-1  \\sigma_{j}(i) - u_{i,j}  k\n$$\n因为 $u_{i,j} \\in (0,1)$，我们知道 $0  u_{i,j}  1$。这意味着：\n$$\n\\sigma_{j}(i) - 1  \\sigma_{j}(i) - u_{i,j}  \\sigma_{j}(i)\n$$\n通过比较这两个不等式，我们发现它们当且仅当 $k-1 = \\sigma_{j}(i) - 1$ 和 $k = \\sigma_{j}(i)$ 时成立。这意味着 $k = \\sigma_{j}(i)$。\n这个理论结果表明，样本 $x_{i,j}$ 将始终落入由置换值 $\\sigma_{j}(i)$ 索引的区间中。\n对于任何给定的维度 $j$，$i=1, \\dots, 5$ 的置换值集合是 $\\{\\sigma_j(1), \\sigma_j(2), \\sigma_j(3), \\sigma_j(4), \\sigma_j(5)\\}$。由于 $\\sigma_j$ 是 $\\{1, 2, 3, 4, 5\\}$ 的一个置换，这组值只是 $\\{1, 2, 3, 4, 5\\}$ 以不同的顺序排列。因此，对于每个维度 $j$，五个样本将分别落入区间 $\\{1, 2, 3, 4, 5\\}$，每个区间恰好被一个样本占据。因此，对于所有的 $j \\in \\{p,k,a\\}$ 和 $k \\in \\{1,2,3,4,5\\}$，区间计数 $c_{j,k}$ 必须为 $1$。这直接意味着 $D_{\\max}=0$。\n\n尽管最终结果由 LHS 的定义所确定，但问题要求显式构造样本矩阵 $X$ 并计算区间计数。我们继续进行这些计算以验证理论结果。\n\n**1. 构造样本矩阵 $X$**\n矩阵 $X$ 的元素为 $x_{i,j} = \\frac{\\sigma_{j}(i) - u_{i,j}}{5}$。列对应于 $j \\in \\{p,k,a\\}$，行对应于 $i \\in \\{1,2,3,4,5\\}$。\n\n对于 $i=1$：\n$x_{1,p} = \\frac{\\sigma_p(1) - u_{1,p}}{5} = \\frac{3 - 0.37}{5} = \\frac{2.63}{5} = 0.526$\n$x_{1,k} = \\frac{\\sigma_k(1) - u_{1,k}}{5} = \\frac{5 - 0.82}{5} = \\frac{4.18}{5} = 0.836$\n$x_{1,a} = \\frac{\\sigma_a(1) - u_{1,a}}{5} = \\frac{2 - 0.15}{5} = \\frac{1.85}{5} = 0.370$\n\n对于 $i=2$：\n$x_{2,p} = \\frac{\\sigma_p(2) - u_{2,p}}{5} = \\frac{1 - 0.58}{5} = \\frac{0.42}{5} = 0.084$\n$x_{2,k} = \\frac{\\sigma_k(2) - u_{2,k}}{5} = \\frac{2 - 0.29}{5} = \\frac{1.71}{5} = 0.342$\n$x_{2,a} = \\frac{\\sigma_a(2) - u_{2,a}}{5} = \\frac{3 - 0.64}{5} = \\frac{2.36}{5} = 0.472$\n\n对于 $i=3$：\n$x_{3,p} = \\frac{\\sigma_p(3) - u_{3,p}}{5} = \\frac{5 - 0.09}{5} = \\frac{4.91}{5} = 0.982$\n$x_{3,k} = \\frac{\\sigma_k(3) - u_{3,k}}{5} = \\frac{4 - 0.53}{5} = \\frac{3.47}{5} = 0.694$\n$x_{3,a} = \\frac{\\sigma_a(3) - u_{3,a}}{5} = \\frac{1 - 0.41}{5} = \\frac{0.59}{5} = 0.118$\n\n对于 $i=4$：\n$x_{4,p} = \\frac{\\sigma_p(4) - u_{4,p}}{5} = \\frac{2 - 0.76}{5} = \\frac{1.24}{5} = 0.248$\n$x_{4,k} = \\frac{\\sigma_k(4) - u_{4,k}}{5} = \\frac{1 - 0.12}{5} = \\frac{0.88}{5} = 0.176$\n$x_{4,a} = \\frac{\\sigma_a(4) - u_{4,a}}{5} = \\frac{5 - 0.87}{5} = \\frac{4.13}{5} = 0.826$\n\n对于 $i=5$：\n$x_{5,p} = \\frac{\\sigma_p(5) - u_{5,p}}{5} = \\frac{4 - 0.24}{5} = \\frac{3.76}{5} = 0.752$\n$x_{5,k} = \\frac{\\sigma_k(5) - u_{5,k}}{5} = \\frac{3 - 0.67}{5} = \\frac{2.33}{5} = 0.466$\n$x_{5,a} = \\frac{\\sigma_a(5) - u_{5,a}}{5} = \\frac{4 - 0.33}{5} = \\frac{3.67}{5} = 0.734$\n\n完整的样本矩阵是：\n$$\nX = \\begin{pmatrix}\n0.526  0.836  0.370 \\\\\n0.084  0.342  0.472 \\\\\n0.982  0.694  0.118 \\\\\n0.248  0.176  0.826 \\\\\n0.752  0.466  0.734\n\\end{pmatrix}\n$$\n\n**2. 计算区间计数 $c_{j,k}$**\n区间为 $B_1=(0.0, 0.2)$、$B_2=(0.2, 0.4)$、$B_3=(0.4, 0.6)$、$B_4=(0.6, 0.8)$、$B_5=(0.8, 1.0)$。\n\n维度 $p$：$\\{0.526, 0.084, 0.982, 0.248, 0.752\\}$\n- $x_{1,p}=0.526 \\in B_3$ ($\\sigma_p(1)=3$)\n- $x_{2,p}=0.084 \\in B_1$ ($\\sigma_p(2)=1$)\n- $x_{3,p}=0.982 \\in B_5$ ($\\sigma_p(3)=5$)\n- $x_{4,p}=0.248 \\in B_2$ ($\\sigma_p(4)=2$)\n- $x_{5,p}=0.752 \\in B_4$ ($\\sigma_p(5)=4$)\n计数为：$c_{p,1}=1$, $c_{p,2}=1$, $c_{p,3}=1$, $c_{p,4}=1$, $c_{p,5}=1$。\n\n维度 $k$：$\\{0.836, 0.342, 0.694, 0.176, 0.466\\}$\n- $x_{1,k}=0.836 \\in B_5$ ($\\sigma_k(1)=5$)\n- $x_{2,k}=0.342 \\in B_2$ ($\\sigma_k(2)=2$)\n- $x_{3,k}=0.694 \\in B_4$ ($\\sigma_k(3)=4$)\n- $x_{4,k}=0.176 \\in B_1$ ($\\sigma_k(4)=1$)\n- $x_{5,k}=0.466 \\in B_3$ ($\\sigma_k(5)=3$)\n计数为：$c_{k,1}=1$, $c_{k,2}=1$, $c_{k,3}=1$, $c_{k,4}=1$, $c_{k,5}=1$。\n\n维度 $a$：$\\{0.370, 0.472, 0.118, 0.826, 0.734\\}$\n- $x_{1,a}=0.370 \\in B_2$ ($\\sigma_a(1)=2$)\n- $x_{2,a}=0.472 \\in B_3$ ($\\sigma_a(2)=3$)\n- $x_{3,a}=0.118 \\in B_1$ ($\\sigma_a(3)=1$)\n- $x_{4,a}=0.826 \\in B_5$ ($\\sigma_a(4)=5$)\n- $x_{5,a}=0.734 \\in B_4$ ($\\sigma_a(5)=4$)\n计数为：$c_{a,1}=1$, $c_{a,2}=1$, $c_{a,3}=1$, $c_{a,4}=1$, $c_{a,5}=1$。\n\n显式计算证实，对于所有的 $j \\in \\{p,k,a\\}$ 和 $k \\in \\{1,2,3,4,5\\}$，区间计数 $c_{j,k}=1$。\n\n**3. 评估 $D_{\\max}$**\n分层偏差度量由以下公式给出：\n$$\nD_{\\max} = \\max_{j \\in \\{p,k,a\\}} \\max_{k \\in \\{1,2,3,4,5\\}} |c_{j,k} - 1|\n$$\n由于每个计数 $c_{j,k}$ 都等于 $1$，绝对值内的项对于所有 $j$ 和 $k$ 都是 $|1-1|=0$。一组零的最大值是零。\n$$\nD_{\\max} = \\max_{j,k} |1 - 1| = \\max_{j,k} 0 = 0\n$$\n该结果通过构造展示了拉丁超立方抽样的完美边缘分层属性。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "在真实的环境与地球系统模型中，不确定性参数的分布很少是简单的均匀分布。本练习旨在弥合单位超立方体中理论性的 LHS 与其实际应用之间的鸿沟。您将通过编程实践，实现一个至关重要的方法：利用逆变换采样将均匀分布的 LHS 样本点映射到任意指定的物理参数分布（如正态分布、对数正态分布等），这是在科学建模中应用 LHS 的关键一步。",
            "id": "3897056",
            "problem": "一项高级研究生水平的环境与地球系统建模研究，需要对具有指定边缘分布的环境参数进行采样，同时保留拉丁超立方采样（LHS）固有的每维分层特性。拉丁超立方采样（LHS）被定义为在单位超立方体 $[0,1]^d$ 中对 $N$ 个样本进行的一种分层采样设计，使得对于每个维度 $j \\in \\{1,\\dots,d\\}$，在 $N$ 个等宽分层 $[k/N,(k+1)/N)$（其中 $k \\in \\{0,\\dots,N-1\\}$）的每一层中都恰好落入一个样本。累积分布函数（CDF）是一个函数 $F(x)$，它将一个实值变量 $x$ 映射到 $[0,1]$ 区间内的一个概率值，而概率密度函数（PDF）是其导数（如果存在）。概率积分变换指出，如果 $U$ 在 $[0,1]$ 上服从均匀分布，那么 $X = F^{-1}(U)$ 的累积分布函数为 $F$。目标是设计一种方法，通过逐维应用逆累积分布函数，将 $[0,1]^d$ 中的 LHS 样本转换为物理参数分布，然后在概率空间中验证其分层特性是否被保留。\n\n您必须仅依赖第一性原理和经过充分检验的事实来实现以下内容：\n- 在 $[0,1]^d$ 中生成一个 $N \\times d$ 的拉丁超立方样本，每个维度使用独立的随机排列来分配层，并在层内添加独立的均匀抖动。\n- 对于每个维度 $j$，通过应用逆累积分布函数 $F_j^{-1}$，将均匀样本 $U_{ij} \\in [0,1]$ 转换为物理参数 $X_{ij}$，其中 $F_j$ 是为维度 $j$ 指定的边缘累积分布函数。此转换必须逐维独立进行。\n- 通过检查来验证分层特性的保留：对于每个维度 $j$，当通过 $P_{ij} = F_j(X_{ij})$ 变换回概率空间时，集合 $\\{P_{ij}\\}_{i=1}^N$ 在每个分层 $[k/N,(k+1)/N)$（对所有 $k \\in \\{0,\\dots,N-1\\}$）中恰好包含一个点。此检查必须为每个测试用例返回一个布尔值，当且仅当所有维度都满足“每层一个”的属性时，该布尔值为 $true$。\n\n您的程序必须实现该方法，并对以下参数值和分布的测试套件进行验证。该测试套件的选择旨在代表典型的环境与地球系统建模中的边缘分布，同时确保科学真实性：\n\n- 测试用例1（一般情况）：$N=50$, $d=3$。各维度边缘分布：\n  - 维度1：均值为 $0$、标准差为 $1$ 的标准正态分布。\n  - 维度2：对数正态分布，其对应的正态分布均值为 $0$，标准差为 $0.6$。\n  - 维度3：形状参数为 $2$ 和 $5$ 的贝塔分布。\n\n- 测试用例2（偏态边缘分布，小 $N$）：$N=10$, $d=1$。边缘分布：\n  - 维度1：形状参数为 $0.5$、尺度参数为 $2$ 的伽马分布。\n\n- 测试用例3（边界情况 $N=1$）：$N=1$, $d=5$。各维度边缘分布：\n  - 维度1：均值为 $5$、标准差为 $2$ 的正态分布。\n  - 维度2：对数正态分布，其对应的正态分布均值为 $0$，标准差为 $1$。\n  - 维度3：形状参数为 $3$ 和 $3$ 的贝塔分布。\n  - 维度4：形状参数为 $2$、尺度参数为 $1.5$ 的伽马分布。\n  - 维度5：形状参数为 $1.5$、尺度参数为 $2$ 的威布尔分布。\n\n- 测试用例4（异构边缘分布，大 $N$）：$N=100$, $d=4$。各维度边缘分布：\n  - 维度1：截断正态分布，下界为 $-1$，上界为 $2$，基础分布的均值为 $0$，标准差为 $1$。\n  - 维度2：形状参数为 $0.8$ 和 $0.8$ 的贝塔分布。\n  - 维度3：形状参数为 $1.5$、尺度参数为 $2$ 的威布尔分布。\n  - 维度4：广义极值分布，形状参数为 $0.2$，位置参数为 $0$，尺度参数为 $1$。\n\n所有随机化过程必须通过使用固定种子来保证可复现性。由于验证是纯概率性的，输出中无需包含物理单位。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[true,false,true,false]”），列表中的每个元素按顺序对应四个测试用例中每个的布尔验证结果。",
            "solution": "该问题要求实现并验证环境与地球系统建模中的一项标准技术：生成遵循指定边缘分布的参数样本，同时保留拉丁超立方采样（LHS）的逐维分层特性。此过程涉及三个主要阶段：在单位超立方体中生成LHS样本，使用逆变换法将这些均匀样本转换到物理参数空间，以及验证分层属性在概率域中得以保留。\n\n**1. 理论基础**\n\n**拉丁超立方采样 (LHS)**: LHS 是一种分层采样方法，用于在 $d$ 维空间（特别是单位超立方体 $[0,1]^d$）中生成 $N$ 个样本点。其定义性属性是，对于每个维度 $j \\in \\{1, \\dots, d\\}$，$N$ 个样本的边缘投影是分层的。这意味着，如果我们将范围 $[0,1]$ 分为 $N$ 个等宽的非重叠区间 $[k/N, (k+1)/N)$（其中 $k \\in \\{0, \\dots, N-1\\}$），则沿着该维度，每个区间恰好包含一个样本点。\n\n**逆变换采样**: 该方法基于概率积分变换，这是概率论中的一个基本结果。它指出，如果随机变量 $U$ 在 $[0,1]$ 上均匀分布，则随机变量 $X = F^{-1}(U)$ 的累积分布函数（CDF）为 $F(x)$。函数 $F^{-1}$ 是逆累积分布函数，也称为分位数函数或百分点函数（PPF）。\n\n**组合方法**: 通过将逆变换法应用于LHS样本，我们可以生成一组具有所需边缘分布的参数向量。如果 $U$ 是一个表示LHS的 $N \\times d$ 矩阵，则变换后的矩阵 $X$（其中每个元素由 $X_{ij} = F_j^{-1}(U_{ij})$ 给出）构成一个样本，其中第 $j$ 列向量 $\\{X_{ij}\\}_{i=1}^N$ 是来自累积分布函数为 $F_j$ 的分布的样本。其关键优势在于，此方法在每个边缘分布的概率空间中保留了原始LHS的有益分层特性。\n\n**2. 算法设计与验证**\n\n该解决方案分为三个计算步骤，其后是一个验证检查。\n\n**步骤 A: 生成拉丁超立方样本**\n生成一个 $N \\times d$ 矩阵 $U$，代表 $[0,1]^d$ 中的 $N$ 个点。算法流程如下：\n1. 对于每个维度 $j \\in \\{0, \\dots, d-1\\}$：\n2. 创建整数 $\\{0, \\dots, N-1\\}$ 的一个随机排列 $\\pi_j$。这将为维度 $j$ 的 $N$ 个样本中的每一个分配一个唯一的分层索引。\n3. 从均匀分布 $U(0,1)$ 中抽取一个包含 $N$ 个随机“抖动”值 $\\Delta_j$ 的向量。\n4. 维度 $j$ 的样本构造为 $U_{ij} = \\frac{\\pi_j(i) + \\Delta_{ij}}{N}$，其中 $i \\in \\{0, \\dots, N-1\\}$。\n根据构造，对于任何给定的维度 $j$，集合 $\\{U_{ij}\\}_{i=1}^N$ 在每个概率分层 $[k/N, (k+1)/N)$ 中恰好包含一个点。\n\n**步骤 B: 变换到物理参数空间**\n对于每个维度 $j$，使用指定的逆累积分布函数 $F_j^{-1}$ 变换LHS矩阵 $U$ 的相应列。这会产生物理参数矩阵 $X$：\n$$ X_{ij} = F_j^{-1}(U_{ij}) $$\n函数 $F_j^{-1}$ 对应于 `scipy.stats` 库提供的分布对象的 `.ppf` 方法。\n\n**步骤 C: 验证分层特性的保留情况**\n核心任务是验证变换后分层特性在概率空间中是否被保留。这通过使用各自的累积分布函数 $F_j$ 将物理参数 $X_{ij}$ 变换回单位概率空间来完成：\n$$ P_{ij} = F_j(X_{ij}) $$\n对于连续分布和完美的数值精度，恒等式 $F_j(F_j^{-1}(u)) = u$ 成立。因此，我们期望得到的概率矩阵 $P$ 与原始LHS矩阵 $U$ 相同，即 $P_{ij} = U_{ij}$。验证步骤以计算方式检查原始 $U$ 矩阵的分层属性是否在计算出的 $P$ 矩阵中得以保留。\n\n验证检查对每个维度 $j$ 进行：\n1. 对于第 $j$ 维中的每个点 $P_{ij}$，其分层索引 $s_{ij}$ 计算为 $s_{ij} = \\lfloor N \\cdot P_{ij} \\rfloor$。由于输入的均匀样本 $U_{ij}$ 严格小于 $1$，变换后的值 $P_{ij}$ 也应小于 $1$，因此 $s_{ij}$ 的范围将是 $0$ 到 $N-1$。\n2. 然后验证计算出的分层索引集合 $\\{s_{ij}\\}_{i=1}^N$ 是否是 $0$ 到 $N-1$ 的整数的完整集合。执行此检查的一种稳健方法是对索引数组进行排序，并将其与包含 $0$ 到 $N-1$ 整数的数组进行相等性比较。\n3. 当且仅当此属性对所有 $d$ 个维度都成立时，一个测试用例才被认为是有效的（返回 `true`）。`scipy` 中的高质量数值例程应能以足够的精度保持此恒等性，因此所有测试用例都应通过验证。$N=1$ 的情况是一个平凡的边界条件；只有一个分层 $[0,1)$，单个样本必须落入其中，从而保证结果为 `true`。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm, lognorm, beta, gamma, weibull_min, truncnorm, genextreme\n\ndef generate_lhs(n, d, rng):\n    \"\"\"\n    Generates a Latin Hypercube Sample of size n x d.\n\n    Args:\n        n (int): The number of samples.\n        d (int): The number of dimensions (parameters).\n        rng (numpy.random.Generator): The random number generator for reproducibility.\n\n    Returns:\n        numpy.ndarray: An n x d array representing the LHS in [0,1]^d.\n    \"\"\"\n    lhs_samples = np.zeros((n, d))\n    for j in range(d):\n        permutation = rng.permutation(n)\n        jitter = rng.uniform(0, 1, size=n)\n        lhs_samples[:, j] = (permutation + jitter) / n\n    return lhs_samples\n\ndef verify_stratification_for_case(n, d, distributions, rng):\n    \"\"\"\n    Generates an LHS, transforms it to physical parameters, transforms it back to\n    probability space, and verifies if the stratification is preserved.\n\n    Args:\n        n (int): The number of samples.\n        d (int): The number of dimensions.\n        distributions (list): A list of scipy.stats frozen distribution objects.\n        rng (numpy.random.Generator): The random number generator.\n\n    Returns:\n        bool: True if stratification is preserved for all dimensions, False otherwise.\n    \"\"\"\n    if n == 0:\n        return True # Vacuously true\n\n    # Step 1: Generate an N x d Latin hypercube sample in [0,1]^d\n    u_samples = generate_lhs(n, d, rng)\n\n    # Step 2: Transform to physical parameters using inverse CDFs (ppf)\n    x_samples = np.zeros_like(u_samples)\n    for j in range(d):\n        x_samples[:, j] = distributions[j].ppf(u_samples[:, j])\n\n    # Step 3: Transform back to probability space using CDFs\n    p_samples = np.zeros_like(x_samples)\n    for j in range(d):\n        p_samples[:, j] = distributions[j].cdf(x_samples[:, j])\n\n    # Step 4: Verify that for each dimension, there is exactly one sample per stratum\n    for j in range(d):\n        p_column = p_samples[:, j]\n        \n        # Calculate the stratum index for each point in the current dimension.\n        # The strata are [k/n, (k+1)/n), so the index is floor(p * n).\n        stratum_indices = np.floor(p_column * n).astype(int)\n\n        # Handle the edge case where a value due to floating point arithmetic\n        # becomes exactly 1.0, which would map to stratum index n.\n        # This point belongs to the last stratum, n-1.\n        stratum_indices[stratum_indices == n] = n - 1\n\n        # The set of stratum indices must be a permutation of {0, 1, ..., n-1}.\n        # A robust check is to sort the indices and compare to a reference range.\n        if not np.array_equal(np.sort(stratum_indices), np.arange(n)):\n            return False  # Stratification failed for this dimension\n\n    return True  # Stratification holds for all dimensions\n\ndef solve():\n    \"\"\"\n    Main function to run the verification for all test cases.\n    \"\"\"\n    # Fixed seed for reproducibility of the entire run\n    rng = np.random.default_rng(seed=42)\n\n    # Define the test suite\n    test_cases = [\n        # Test case 1: general case\n        {\n            \"n\": 50, \"d\": 3,\n            \"dists\": [\n                norm(loc=0, scale=1),\n                lognorm(s=0.6, scale=np.exp(0)),\n                beta(a=2, b=5)\n            ]\n        },\n        # Test case 2: skewed marginal, small N\n        {\n            \"n\": 10, \"d\": 1,\n            \"dists\": [\n                gamma(a=0.5, scale=2)\n            ]\n        },\n        # Test case 3: boundary case N=1\n        {\n            \"n\": 1, \"d\": 5,\n            \"dists\": [\n                norm(loc=5, scale=2),\n                lognorm(s=1, scale=np.exp(0)),\n                beta(a=3, b=3),\n                gamma(a=2, scale=1.5),\n                weibull_min(c=1.5, scale=2)\n            ]\n        },\n        # Test case 4: heterogeneous marginals, larger N\n        {\n            \"n\": 100, \"d\": 4,\n            \"dists\": [\n                truncnorm(a=(-1-0)/1, b=(2-0)/1, loc=0, scale=1),\n                beta(a=0.8, b=0.8),\n                weibull_min(c=1.5, scale=2),\n                genextreme(c=0.2, loc=0, scale=1)\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        is_valid = verify_stratification_for_case(\n            case[\"n\"], case[\"d\"], case[\"dists\"], rng\n        )\n        results.append(str(is_valid).lower())\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "选择更复杂的采样方法（如 LHS）而非简单的蒙特卡洛 (MC) 方法，其最终目的是为了提高效率。本练习将量化展示 LHS 相较于 MC 的优势所在。通过计算达到相同预测精度所需的样本量，您将深刻理解为何在计算成本高昂的模型不确定性分析中，LHS 通常是更受青睐的选择，因为它能以更少的模型运行次数获得更可靠的结果。",
            "id": "3897042",
            "problem": "考虑一个环境汇水区模型，其中年度驱动随机向量 $X$ 包括流域平均降水量 $P$、潜在蒸散发 $E_{p}$ 和土壤导水率 $K_{s}$。设年流域平均径流量为 $Y = g(X)$，其中 $g$ 是一个将输入映射到输出的确定性水文模型。您的任务是使用基于采样的估计器，在 $X$ 的联合分布下估计期望 $\\mathbb{E}[Y]$。\n\n您将考虑基于 $n$ 次模型评估的两种 $\\mathbb{E}[Y]$ 估计器：\n- 一个简单的蒙特卡洛（MC）估计器，从 $X$ 的联合分布律中独立同分布地抽取 $X_{1},\\dots,X_{n}$，并计算样本均值 $\\bar{Y}_{n} = \\frac{1}{n}\\sum_{i=1}^{n} g(X_{i})$。\n- 一个拉丁超立方采样（LHS）估计器，它使用分层一维边缘抽取 $X_{1},\\dots,X_{n}$，其联合边缘分布与MC相同，并且也计算模型输出的样本均值。\n\n假设：\n- $Y$ 具有有限均值 $\\mu = \\mathbb{E}[Y]$ 和有限方差 $\\sigma^{2} = \\mathrm{Var}(Y)$。\n- 对于MC，中心极限定理（CLT）适用：当 $n \\to \\infty$ 时，$\\sqrt{n}\\,(\\bar{Y}_{n} - \\mu) \\Rightarrow \\mathcal{N}(0,\\sigma^{2})$。\n- 对于LHS，样本均值是无偏的，并接受一个渐近正态近似，其方差不超过MC的方差；您已获得用于规划样本量的预实验方差估计值。\n\n请从第一性原理出发，基于正态近似推导 $\\mu$ 的渐近 $(1-\\alpha)$ 置信区间，并得出半宽随样本量 $n$ 的缩放关系。然后，使用推导出的缩放关系，为以下设计规格计算所需的最小整数样本量：\n- 置信水平 $(1-\\alpha) = 0.95$。\n- 目标半宽 $h^{\\star} = 3$，单位与 $Y$ 相同。\n- 来自 $n_{\\mathrm{pilot}}$ 次运行的输出标准差的预实验估计值：\n  - MC预实验标准差 $s_{\\mathrm{MC}} = 60$。\n  - LHS预实验标准差 $s_{\\mathrm{LHS}} = 40$。\n\n在规划中，将 $s_{\\mathrm{MC}}$ 和 $s_{\\mathrm{LHS}}$ 视为每种采样方案下 $\\sigma$ 的代理值。在计算中使用与 $(1-\\alpha)=0.95$ 相关的标准正态分位数 $z_{\\alpha/2}$。计算最小整数样本量 $n_{\\mathrm{MC}}$ 和 $n_{\\mathrm{LHS}}$，使得每种方案的渐近半宽最多为 $h^{\\star}$，然后计算比率 $r = \\frac{n_{\\mathrm{LHS}}}{n_{\\mathrm{MC}}}$。将您的最终答案 $r$ 四舍五入到四位有效数字。$r$ 不需要物理单位。",
            "solution": "该问题要求我们确定蒙特卡洛（MC）和拉丁超立方采样（LHS）估计器的样本量，以使模型输出 $Y$ 的均值达到特定的置信区间半宽。我们已知两种采样方案下标准差的预实验估计值。\n\n### 1. 置信区间与样本量公式的推导\n\n中心极限定理（CLT）指出，对于来自均值为 $\\mu$、方差为 $\\sigma^2$ 的总体的样本均值 $\\bar{Y}_n$，当 $n$ 较大时，标准化均值的分布近似为标准正态分布：\n$$ Z = \\frac{\\bar{Y}_n - \\mu}{\\sigma/\\sqrt{n}} \\sim \\mathcal{N}(0, 1) $$\n$\\mu$ 的 $(1-\\alpha)$ 置信区间是通过寻找一个以概率 $(1-\\alpha)$ 包含 $\\mu$ 的范围来构建的。\n$$ P(-z_{\\alpha/2} \\le Z \\le z_{\\alpha/2}) = 1-\\alpha $$\n其中 $z_{\\alpha/2}$ 是标准正态分布的上 $\\alpha/2$ 分位数。\n代入 $Z$ 的表达式：\n$$ P\\left(-z_{\\alpha/2} \\le \\frac{\\bar{Y}_n - \\mu}{\\sigma/\\sqrt{n}} \\le z_{\\alpha/2}\\right) = 1-\\alpha $$\n对 $\\mu$ 进行整理可得：\n$$ P\\left(\\bar{Y}_n - z_{\\alpha/2} \\frac{\\sigma}{\\sqrt{n}} \\le \\mu \\le \\bar{Y}_n + z_{\\alpha/2} \\frac{\\sigma}{\\sqrt{n}}\\right) = 1-\\alpha $$\n$\\mu$ 的渐近 $(1-\\alpha)$ 置信区间为：\n$$ \\left[ \\bar{Y}_n - z_{\\alpha/2} \\frac{\\sigma}{\\sqrt{n}}, \\bar{Y}_n + z_{\\alpha/2} \\frac{\\sigma}{\\sqrt{n}} \\right] $$\n该置信区间的半宽 ($h$) 为：\n$$ h = z_{\\alpha/2} \\frac{\\sigma}{\\sqrt{n}} $$\n这表明半宽 $h$ 随样本量 $n$ 的变化关系为 $h \\propto 1/\\sqrt{n}$。\n为了求出达到目标半宽 $h^{\\star}$ 所需的样本量 $n$，我们求解 $n$：\n$$ n = \\left( \\frac{z_{\\alpha/2} \\sigma}{h^{\\star}} \\right)^2 $$\n由于 $n$ 必须是整数，我们对结果取上取整：\n$$ n = \\left\\lceil \\left( \\frac{z_{\\alpha/2} \\sigma}{h^{\\star}} \\right)^2 \\right\\rceil $$\n\n### 2. 样本量的计算\n\n首先，我们根据给定的置信水平确定 $z_{\\alpha/2}$ 的值。\n置信水平 $(1-\\alpha) = 0.95$，所以 $\\alpha = 0.05$，$\\alpha/2 = 0.025$。\n值 $z_{0.025}$ 是累积概率为 $1-0.025=0.975$ 的分位数。从标准正态分布表或计算器中，我们得到：\n$$ z_{0.025} \\approx 1.96 $$\n现在，我们可以使用 MC 和 LHS 方案各自的预实验标准差作为 $\\sigma$ 的代理值来计算它们的样本量。\n目标半宽：$h^{\\star} = 3$。\n\n**对于蒙特卡洛（MC）：**\n使用预实验标准差 $s_{\\mathrm{MC}} = 60$：\n$$ n_{\\mathrm{MC}} = \\left\\lceil \\left( \\frac{1.96 \\times 60}{3} \\right)^2 \\right\\rceil $$\n$$ n_{\\mathrm{MC}} = \\left\\lceil (1.96 \\times 20)^2 \\right\\rceil = \\lceil (39.2)^2 \\rceil = \\lceil 1536.64 \\rceil = 1537 $$\n所以，MC 所需的最小整数样本量是 $1537$。\n\n**对于拉丁超立方采样（LHS）：**\n使用预实验标准差 $s_{\\mathrm{LHS}} = 40$：\n$$ n_{\\mathrm{LHS}} = \\left\\lceil \\left( \\frac{1.96 \\times 40}{3} \\right)^2 \\right\\rceil $$\n$$ n_{\\mathrm{LHS}} = \\left\\lceil (1.96 \\times 13.333...)^2 \\right\\rceil = \\lceil (26.133...)^2 \\rceil = \\lceil 682.95... \\rceil = 683 $$\n所以，LHS 所需的最小整数样本量是 $683$。\n正如预期的，由于 LHS 的方差较小（它是一种方差缩减技术），它需要的样本量也更小。\n\n### 3. 比率的计算\n\n最后，我们计算所需样本量的比率 $r$：\n$$ r = \\frac{n_{\\mathrm{LHS}}}{n_{\\mathrm{MC}}} = \\frac{683}{1537} $$\n$$ r \\approx 0.44437215... $$\n四舍五入到四位有效数字：\n$$ r \\approx 0.4444 $$",
            "answer": "$$\\boxed{0.4444}$$"
        }
    ]
}