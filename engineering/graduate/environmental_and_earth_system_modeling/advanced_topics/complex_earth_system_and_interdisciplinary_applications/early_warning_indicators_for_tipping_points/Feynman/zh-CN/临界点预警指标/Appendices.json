{
    "hands_on_practices": [
        {
            "introduction": "在将预警指标应用于复杂数据之前，理解其理论来源至关重要。本练习将深入探讨临界点的典型数学模型——鞍结分岔——从第一性原理出发，揭示“临界慢化”现象如何表现为系统恢复速率的减慢，并在随机扰动下直接导致自相关的增加。通过分析这个基础模型 ()，您将为实际应用中的统计指标建立坚实的理论基础。",
            "id": "3876409",
            "problem": "考虑动力系统理论中应用于环境临界点模型的典型鞍-结（折叠）范式，\n$$\\frac{dx}{dt}=\\mu - x^{2},$$\n其中$x$是一个标量系统状态，$\\mu$是一个缓慢变化的控制参数，代表外部强迫。这个一维确定性系统被广泛用作地球系统组成部分在参数变化下稳态消失时发生突变的原型。\n\n(a) 使用基本的线性稳定性分析，找出该确定性系统的所有平衡点（作为$\\mu$的函数），并确定它们的稳定性。\n\n(b) 假设由于外部强迫，$\\mu(t)$随时间缓慢单调变化，$\\mu(t)=\\mu_{0}-\\varepsilon t$，其中$\\mu_{0}>0$且$0  \\varepsilon \\ll 1$为一个小的斜坡速率。从$t\\ll 0$时的稳定平衡点出发，根据第一性原理，解释为什么当$\\mu(t)$经过$0$时会发生类似滞后的稳定性延迟丧失（动态分岔延迟），以及为什么这与环境和地球系统建模中的预警指标相关。\n\n(c) 为了与预警指标联系起来，引入弱环境噪声并考虑随机微分方程（SDE）\n$$dx=\\left(\\mu - x^{2}\\right)dt+\\sigma\\,dW_{t},$$\n其中$\\sigma0$是噪声振幅，$W_{t}$是一个标准维纳过程（布朗运动），因此$dW_{t}$代表具有独立平稳增量的高斯白噪声。对于固定的$\\mu0$，围绕稳定平衡点$x^{\\star}(\\mu)$对该SDE进行线性化，并求出涨落的平稳滞后$\\Delta t$自相关，其定义为\n$$\\rho(\\Delta t)=\\frac{\\mathbb{E}\\left[(x(t)-\\mathbb{E}x(t))\\,(x(t+\\Delta t)-\\mathbb{E}x(t))\\right]}{\\operatorname{Var}(x(t))},$$\n在线性化动力学下。将最终答案表示为包含$\\mu$和$\\Delta t$的精确解析表达式。无需四舍五入。自相关是无量纲的；不要包含单位。",
            "solution": "该问题具有科学依据，提法恰当，并提供了所有必要信息。它代表了对一个典型的临界点模型的标准分析。因此，该问题被认为是有效的。\n\n(a) 为了找出系统 $\\frac{dx}{dt}=\\mu - x^{2}$ 的平衡点，我们将变化率设为零：\n$$\n\\frac{dx}{dt} = 0 \\implies \\mu - x^{2} = 0\n$$\n这得到 $x^{2} = \\mu$。令平衡点由 $x^{\\star}$ 表示。\n\n-   如果 $\\mu > 0$，存在两个不同的实数平衡点：$x^{\\star}_{1} = \\sqrt{\\mu}$ 和 $x^{\\star}_{2} = -\\sqrt{\\mu}$。\n-   如果 $\\mu = 0$，在 $x^{\\star} = 0$ 处存在一个单一平衡点。\n-   如果 $\\mu  0$，不存在实数平衡点，因为对于实数 $x$，$x^{2}$ 不能为负。\n\n为了确定这些平衡点的稳定性，我们使用线性稳定性分析。令 $f(x) = \\mu - x^{2}$。稳定性由在平衡点 $x^{\\star}$ 处求得的特征值 $\\lambda = \\frac{df}{dx}$ 的符号确定。其导数为：\n$$\n\\frac{df}{dx} = -2x\n$$\n我们在 $\\mu0$ 的情况下对每个平衡点求值：\n\n-   对于平衡点 $x^{\\star}_{1} = \\sqrt{\\mu}$：\n    $$\n    \\lambda_{1} = \\left.\\frac{df}{dx}\\right|_{x=\\sqrt{\\mu}} = -2\\sqrt{\\mu}\n    $$\n    由于 $\\mu  0$，$\\sqrt{\\mu}$ 是正实数，所以 $\\lambda_{1}  0$。具有负实特征值的平衡点是稳定的。因此，$x^{\\star}_{1} = \\sqrt{\\mu}$ 是一个稳定平衡点。\n\n-   对于平衡点 $x^{\\star}_{2} = -\\sqrt{\\mu}$：\n    $$\n    \\lambda_{2} = \\left.\\frac{df}{dx}\\right|_{x=-\\sqrt{\\mu}} = -2(-\\sqrt{\\mu}) = 2\\sqrt{\\mu}\n    $$\n    由于 $\\mu  0$，所以 $\\lambda_{2}  0$。具有正实特征值的平衡点是不稳定的。因此，$x^{\\star}_{2} = -\\sqrt{\\mu}$ 是一个不稳定平衡点。\n\n在 $\\mu=0$ 时，两个平衡点合并。此时，$\\lambda = -2(0) = 0$。这是一个非双曲平衡点，线性稳定性分析无法得出结论。该点 $\\mu=0$ 是一个鞍-结（或折叠）分岔的位置，在此处稳定和不稳定平衡点碰撞并湮灭。\n\n(b) 当控制参数以有限速率通过分岔点时，会发生类似滞后的稳定性延迟丧失，也称为动态分岔延迟。\n\n考虑系统在 $t \\ll 0$ 时从稳定平衡点 $x(t) = \\sqrt{\\mu(t)} = \\sqrt{\\mu_{0}-\\varepsilon t}$（对于 $\\mu(t)0$）开始。随着时间 $t$ 增加，参数 $\\mu(t)$ 缓慢减小。在 $t_{c} = \\mu_{0}/\\varepsilon$ 时，参数 $\\mu$ 穿过零。就在这一刻，静态分岔发生：位于 $x^{\\star}=0$ 的稳定平衡点不复存在。对于任何 $t  t_{c}$，$\\mu(t)$ 变为负数。在此区域内，控制方程为 $\\frac{dx}{dt} = \\mu(t) - x^{2}$。由于 $\\mu(t)  0$ 且 $-x^{2} \\le 0$，方程右侧对所有 $x$ 严格为负。这意味着 $\\frac{dx}{dt}  0$，状态 $x(t)$ 必须无限减小（在这个简单模型中，趋向于 $-\\infty$）。\n\n延迟的产生是因为变化率不是瞬时的。在 $t_{c}$ 发生分岔后不久，状态 $x(t)$ 接近于 $0$，而 $\\mu(t)$ 是一个小的负数。例如，在时间 $t = t_{c} + \\delta t$（其中 $\\delta t$ 是一个小的正数），$\\mu(t) = -\\varepsilon \\delta t$。运动方程为 $\\frac{dx}{dt} = -\\varepsilon\\delta t - x^{2}$。由于 $x$ 接近 $0$，$\\frac{dx}{dt}$ 是一个小的负数。因此，状态 $x(t)$ 开始非常缓慢地偏离 $x=0$。它不会“跳”到一个新的状态。轨迹在现已消失的平衡点的“幽灵”附近的这种徘徊就是动态分岔延迟。系统的状态滞后于其潜在稳定性景观的变化。斜坡速率 $\\varepsilon$ 越小，漂移越慢，延迟时间越长。\n\n这一现象与预警指标（EWS）密切相关。EWS，例如方差或自相关的上升，是基于“临界慢化”——即系统从扰动中恢复的速率在接近分岔点时会减慢。恢复速率由 $|\\lambda_{1}| = 2\\sqrt{\\mu}$ 给出，当 $\\mu \\to 0^{+}$ 时，该速率趋近于 $0$。动态分岔延迟是这种临界慢化的直接后果。系统变得如此迟缓，以至于无法跟上变化的环境（变化的 $\\mu$）。这揭示的危险在于，实际的临界点（$\\mu=0$）可能在系统状态发生任何剧烈的、可观测到的变化之前就被越过了。观察者可能认为系统仍处于安全区域，而实际上潜在的稳定性已经丧失，一个巨大的、不可逆的转变只是被延迟了，但此刻已不可避免。\n\n(c) 给定随机微分方程（SDE）：\n$$\ndx = (\\mu - x^{2})dt + \\sigma dW_{t}\n$$\n对于固定的 $\\mu  0$，稳定平衡点是 $x^{\\star} = \\sqrt{\\mu}$。我们通过考虑小涨落 $y(t) = x(t) - x^{\\star}$ 来围绕此平衡点对系统进行线性化。这也意味着 $dx = dy$。漂移项 $f(x) = \\mu - x^{2}$ 在 $x^{\\star}$ 附近通过一阶泰勒展开进行近似：\n$$\nf(x) \\approx f(x^{\\star}) + f'(x^{\\star})(x - x^{\\star})\n$$\n我们知道 $f(x^{\\star}) = \\mu - (x^{\\star})^{2} = \\mu - \\mu = 0$。导数为 $f'(x) = -2x$，所以 $f'(x^{\\star}) = -2x^{\\star} = -2\\sqrt{\\mu}$。将这些代入展开式得到：\n$$\nf(x) \\approx 0 + (-2\\sqrt{\\mu})y(t) = -2\\sqrt{\\mu}y(t)\n$$\n因此，涨落 $y(t)$ 的线性化SDE为：\n$$\ndy = -2\\sqrt{\\mu} y dt + \\sigma dW_{t}\n$$\n这是一个奥恩斯坦-乌伦贝克（OU）过程的方程，其一般形式为 $dy = -\\theta y dt + \\sigma dW_{t}$，弛豫率为 $\\theta = 2\\sqrt{\\mu}$。\n\nOU过程的平稳解是一个均值为零的高斯过程，$\\mathbb{E}[y(t)]=0$。这意味着 $\\mathbb{E}[x(t)] = x^{\\star}$。涨落定义为与均值的偏差，因此 $x(t) - \\mathbb{E}[x(t)] = x(t) - x^{\\star} = y(t)$。\n\n平稳滞后$\\Delta t$自相关函数 $\\rho(\\Delta t)$ 定义为：\n$$\n\\rho(\\Delta t) = \\frac{\\mathbb{E}\\left[(x(t)-\\mathbb{E}x(t))\\,(x(t+\\Delta t)-\\mathbb{E}x(t))\\right]}{\\operatorname{Var}(x(t))} = \\frac{\\mathbb{E}[y(t)y(t+\\Delta t)]}{\\operatorname{Var}(y(t))}\n$$\n分子是 $y(t)$ 的自协方差。对于平稳OU过程，自协方差函数由 $\\operatorname{Cov}(y(t), y(t+\\Delta t)) = \\operatorname{Var}(y(t))\\exp(-\\theta |\\Delta t|)$ 给出。假设 $\\Delta t \\ge 0$，则为 $\\operatorname{Var}(y(t))\\exp(-\\theta \\Delta t)$。\n\n将此代入 $\\rho(\\Delta t)$ 的表达式：\n$$\n\\rho(\\Delta t) = \\frac{\\operatorname{Var}(y(t))\\exp(-\\theta \\Delta t)}{\\operatorname{Var}(y(t))} = \\exp(-\\theta \\Delta t)\n$$\n最后，我们将 $\\theta = 2\\sqrt{\\mu}$ 的值代回表达式中：\n$$\n\\rho(\\Delta t) = \\exp(-2\\sqrt{\\mu} \\Delta t)\n$$\n该表达式表明，当系统接近临界点（$\\mu \\to 0^{+}$）时，指数趋近于 $0$，对于任何固定的滞后 $\\Delta t$，自相关 $\\rho(\\Delta t)$ 趋近于 $1$。这种自相关的增加是一个关键的预警信号。",
            "answer": "$$\\boxed{\\exp(-2\\sqrt{\\mu}\\Delta t)}$$"
        },
        {
            "introduction": "临界慢化的理论可以转化为时间序列分析的实用工具。本练习将指导您实现检测预警信号最常用的一种方法：在移动窗口内计算统计指标。您将编写代码来计算一阶自相关和方差的趋势，这是一系统接近分岔点的关键特征。这项动手编程任务 () 将使您掌握从真实数据中提取预警信号的核心技能。",
            "id": "3876395",
            "problem": "给定一个去趋势的标量时间序列数据，该数据被假设正在接近一个由分岔引起的范式转移。一个早期预警指标是滞后-$1$自相关和方差的逐渐增加，这可以通过对一阶自回归模型进行移动窗口拟合以及对指标趋势进行推断来评估。从自回归（AR）模型的定义出发，考虑由 $x_t = \\phi x_{t-1} + \\epsilon_t$ 定义的一阶自回归（AR）过程，其中 $t \\in \\{1,2,\\ldots,N-1\\}$，$x_t$ 是去趋势的标量状态，$\\phi$ 是AR系数，$\\epsilon_t$ 是一个零均值噪声序列。假设噪声是独立同分布的，并且时间序列在去趋势后均值为零。使用普通最小二乘法（OLS）作为参数估计的原则，并使用每个窗口内的无偏样本方差作为变异性的度量，您的任务是实现一个完整的程序，该程序能够：\n\n- 将序列分割成固定长度的重叠窗口，按固定步长前进，并对每个窗口进行如下操作：\n  - 通过最小化窗口分段上的单步预测误差平方和来计算一阶自回归系数 $\\phi$。\n  - 计算窗口分段内的无偏样本方差。\n- 将窗口时间坐标定义为每个窗口的中心索引，并使用最小二乘拟合计算窗口化的 $\\phi$ 估计值相对于窗口中心时间的线性趋势斜率，以及窗口化的方差相对于窗口中心时间的线性趋势斜率。\n- 对于每个测试用例，返回一个包含两个浮点数的列表：$\\phi$ 的斜率和方差在窗口中心上的斜率。\n\n基本依据和假设：\n- 自回归（AR）定义：对于一个零截距的去趋势序列，$x_t = \\phi x_{t-1} + \\epsilon_t$，其中 $\\epsilon_t$ 是零均值噪声。\n- 普通最小二乘法（OLS）：参数估计值在窗口上最小化 $\\sum_t (x_t - \\phi x_{t-1})^2$。\n- 无偏样本方差：对于长度为 $W$ 的窗口，$\\mathrm{Var}(x) = \\frac{1}{W-1} \\sum_{i=1}^W (x_i - \\bar{x})^2$。\n- 线性趋势斜率：对于配对数据 $(t_i, y_i)$，OLS斜率是最佳线性拟合 $y = a + b t$ 中 $t$ 的系数，等价于 $b = \\frac{\\sum_i (t_i - \\bar{t})(y_i - \\bar{y})}{\\sum_i (t_i - \\bar{t})^2}$。\n\n要求：\n- 完全按照描述实现该过程。\n- 使用线性斜率作为 $\\phi$ 和方差趋势的量化指标。\n- 如果某个窗口产生退化的AR拟合（例如，如果窗口内 $\\sum x_{t-1}^2 = 0$），则将该窗口的 $\\phi$ 估计值定义为 $0$。\n- 输入时间序列由程序内部使用指定种子的可复现伪随机噪声生成。\n- 不涉及物理单位；所有输出均为无量纲的实数。\n- 不使用角度。\n- 将所有输出表示为原始浮点数，除了标准的双精度浮点数外，没有舍入要求。\n\n测试套件：\n使用以下参数实现四个测试用例。在所有情况下，将初始状态设置为 $x_0 = 0$，并使用标准差为 $\\sigma$ 的独立高斯噪声 $\\epsilon_t \\sim \\mathcal{N}(0, \\sigma^2)$。当 $\\phi$ 随时间变化时，对于 $t \\in \\{0,1,\\ldots,N-1\\}$，设置 $\\phi_t = \\phi_{\\mathrm{start}} + (\\phi_{\\mathrm{end}} - \\phi_{\\mathrm{start}})\\cdot \\frac{t}{N-1}$，并模拟 $x_t = \\phi_t x_{t-1} + \\epsilon_t$。\n\n- 案例1（稳定基线）：\n  - 序列长度 $N = 500$\n  - 恒定 $\\phi = 0.2$\n  - 噪声标准差 $\\sigma = 1.0$\n  - 窗口长度 $W = 50$\n  - 步长 $S = 10$\n  - 随机种子 $s = 42$\n- 案例2（持续性增加并接近临界点）：\n  - 序列长度 $N = 500$\n  - $\\phi$ 从 $\\phi_{\\mathrm{start}} = 0.2$ 线性增加到 $\\phi_{\\mathrm{end}} = 0.95$\n  - 噪声标准差 $\\sigma = 1.0$\n  - 窗口长度 $W = 50$\n  - 步长 $S = 10$\n  - 随机种子 $s = 43$\n- 案例3（窗口较少的边界条件）：\n  - 序列长度 $N = 60$\n  - $\\phi$ 从 $\\phi_{\\mathrm{start}} = 0.5$ 线性增加到 $\\phi_{\\mathrm{end}} = 0.9$\n  - 噪声标准差 $\\sigma = 1.0$\n  - 窗口长度 $W = 50$\n  - 步长 $S = 5$\n  - 随机种子 $s = 44$\n- 案例4（近白噪声）：\n  - 序列长度 $N = 500$\n  - 恒定 $\\phi = 0.0$\n  - 噪声标准差 $\\sigma = 1.0$\n  - 窗口长度 $W = 50$\n  - 步长 $S = 10$\n  - 随机种子 $s = 45$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个元素对应一个测试用例，并且本身必须是包含两个浮点数的列表，顺序为 $[\\phi \\text{ 的斜率}, \\text{方差的斜率}]$。例如，输出格式必须与 $[[a_1,b_1],[a_2,b_2],[a_3,b_3],[a_4,b_4]]$ 完全相同，其中每个 $a_i$ 和 $b_i$ 都是浮点数。",
            "solution": "该问题定义明确，具有科学依据，并为获得唯一、可验证的解提供了所有必要信息。我们将逐步推导并实现指定的过程。目标是通过分析移动窗口内滞后-$1$自相关系数和方差的行为，来计算标量时间序列中潜在的分岔引起的状态转换的趋势指标。\n\n分析的核心是一阶自回归模型（$\\text{AR}(1)$）。对于一个去趋势、零均值的时间序列 $x_t$，模型定义如下：\n$$x_t = \\phi x_{t-1} + \\epsilon_t$$\n其中 $t \\in \\{1, 2, \\ldots, N-1\\}$ 是时间索引，$\\phi$ 是滞后-$1$自回归系数，$\\epsilon_t$ 是一系列独立同分布的零均值噪声项。\n\n分析包括三个主要阶段：将时间序列分割成窗口；在每个窗口内估计 $\\phi$ 和方差；以及量化这些估计值的时间趋势。\n\n**1. 时间序列分割与加窗**\n\n给定的总长度为 $N$ 的时间序列被分割成固定长度 $W$ 的重叠窗口。窗口以固定的步长 $S$ 沿序列前进。第一个窗口的起始索引是 $0$。后续窗口的起始索引为 $S, 2S, 3S, \\ldots$。只要窗口能完全容纳在序列内，这个过程就会继续。因此，任何窗口的起始索引 $i$ 都必须满足条件 $i + W \\le N$。因此，起始索引的序列是 $i_k = k \\cdot S$，其中 $k = 0, 1, 2, \\ldots$ 且 $kS \\le N - W$。对于每个窗口，我们将计算两个统计量：$\\text{AR}(1)$ 系数和无偏样本方差。\n\n**2. 各窗口内的参数估计**\n\n让我们考虑一个由数据点 $\\{x_i, x_{i+1}, \\ldots, x_{i+W-1}\\}$ 组成的单一窗口。\n\n**2.1. AR(1)系数($\\phi$)估计**\n\n系数 $\\phi$ 使用普通最小二乘法（OLS）原理进行估计。我们寻求使窗口内单步预测的残差平方和 $L(\\phi)$ 最小化的 $\\phi$ 值。在此窗口内用于拟合模型 $x_t = \\phi x_{t-1} + \\epsilon_t$ 的可用数据由 $W-1$ 对形式为 $(x_{t-1}, x_t)$ 的数据组成，其中 $t$ 的范围从 $i+1$ 到 $i+W-1$。\n\n残差平方和为：\n$$L(\\phi) = \\sum_{t=i+1}^{i+W-1} (x_t - \\phi x_{t-1})^2$$\n为了找到最小值，我们计算 $L(\\phi)$ 对 $\\phi$ 的导数并将其设为零：\n$$\\frac{d L}{d \\phi} = \\frac{d}{d \\phi} \\sum_{t=i+1}^{i+W-1} (x_t^2 - 2\\phi x_t x_{t-1} + \\phi^2 x_{t-1}^2) = \\sum_{t=i+1}^{i+W-1} (-2 x_t x_{t-1} + 2\\phi x_{t-1}^2) = 0$$\n求解 $\\phi$：\n$$2 \\phi \\sum_{t=i+1}^{i+W-1} x_{t-1}^2 = 2 \\sum_{t=i+1}^{i+W-1} x_t x_{t-1}$$\n这就得到了该窗口的OLS估计值 $\\hat{\\phi}$：\n$$\\hat{\\phi} = \\frac{\\sum_{t=i+1}^{i+W-1} x_t x_{t-1}}{\\sum_{t=i+1}^{i+W-1} x_{t-1}^2}$$\n按照规定，如果分母 $\\sum x_{t-1}^2$ 为零，这表明用于拟合的窗口分段内的回归量没有变化，则估计值 $\\hat{\\phi}$ 被定义为 $0$。\n\n**2.2. 无偏样本方差估计**\n\n计算窗口内数据点 $\\{x_i, x_{i+1}, \\ldots, x_{i+W-1}\\}$ 的无偏样本方差。首先，计算 $W$ 个数据点的样本均值 $\\bar{x}_{\\text{win}}$：\n$$\\bar{x}_{\\text{win}} = \\frac{1}{W} \\sum_{j=i}^{i+W-1} x_j$$\n然后，无偏样本方差 $\\widehat{\\mathrm{Var}}(x)$ 由下式给出：\n$$\\widehat{\\mathrm{Var}}(x) = \\frac{1}{W-1} \\sum_{j=i}^{i+W-1} (x_j - \\bar{x}_{\\text{win}})^2$$\n分母 $W-1$ 体现了从样本中对总体方差进行无偏估计的Bessel校正。\n\n**3. 指标时间序列的趋势分析**\n\n处理完所有窗口后，我们得到两个新的时间序列：一个是 $\\phi$ 的估计值序列，另一个是方差的估计值序列。为了分析它们的趋势，我们首先为每个估计值分配一个时间坐标。问题指定使用窗口的中心索引作为其时间坐标。对于从索引 $i$ 开始、长度为 $W$ 的窗口，时间坐标 $t_{\\text{center}}$ 是：\n$$t_{\\text{center}} = i + \\frac{W-1}{2}$$\n设窗口时间中心的序列为 $\\{t_1, t_2, \\ldots, t_M\\}$，相应的指标估计值（$\\hat{\\phi}$ 或 $\\widehat{\\mathrm{Var}}$）为 $\\{y_1, y_2, \\ldots, y_M\\}$，其中 $M$ 是窗口的总数。\n\n为了量化趋势，我们对指标 $y$ 关于时间 $t$ 进行线性回归，拟合模型 $y_k = a + b t_k$。斜率 $b$ 代表线性趋势。根据OLS，斜率的公式为：\n$$b = \\frac{\\sum_{k=1}^M (t_k - \\bar{t})(y_k - \\bar{y})}{\\sum_{k=1}^M (t_k - \\bar{t})^2}$$\n其中 $\\bar{t} = \\frac{1}{M}\\sum_{k=1}^M t_k$ 和 $\\bar{y} = \\frac{1}{M}\\sum_{k=1}^M y_k$ 分别是时间坐标和指标值的样本均值。这个公式等价于 $t$ 和 $y$ 的样本协方差与 $t$ 的样本方差之比。这个斜率 $b$ 会对 $\\hat{\\phi}$ 序列和 $\\widehat{\\mathrm{Var}}(x)$ 序列分别计算。\n\n这个完整的过程为每个测试用例提供了两个所需的输出：滞后-$1$自相关系数的斜率和方差的斜率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_slope(t, y):\n    \"\"\"\n    Computes the slope of a linear regression of y on t using OLS.\n    \"\"\"\n    n = len(t)\n    if n  2:\n        return 0.0\n    \n    t_mean = np.mean(t)\n    y_mean = np.mean(y)\n    \n    numerator = np.sum((t - t_mean) * (y - y_mean))\n    denominator = np.sum((t - t_mean)**2)\n    \n    if denominator == 0:\n        return 0.0\n        \n    return numerator / denominator\n\ndef analyze_time_series(N, phi_params, sigma, W, S, seed):\n    \"\"\"\n    Generates an AR(1) time series and computes the slopes of EWI trends.\n    \n    Args:\n        N (int): Series length.\n        phi_params (float or tuple): Constant phi or (start, end) for varying phi.\n        sigma (float): Noise standard deviation.\n        W (int): Window length.\n        S (int): Step size.\n        seed (int): Random seed.\n\n    Returns:\n        list: A list containing [slope_phi, slope_var].\n    \"\"\"\n    # 1. Generate the time series\n    rng = np.random.default_rng(seed)\n    x = np.zeros(N)\n    noise = rng.normal(loc=0.0, scale=sigma, size=N)\n    \n    if isinstance(phi_params, tuple):\n        phi_start, phi_end = phi_params\n        # phi_t is used to evolve x from t-1 to t\n        phi_vec = np.linspace(phi_start, phi_end, N)\n    else:\n        phi_vec = np.full(N, phi_params)\n\n    # Initial state x_0 = 0 is set by np.zeros\n    for t in range(1, N):\n        x[t] = phi_vec[t] * x[t-1] + noise[t]\n\n    # 2. Compute windowed statistics\n    t_centers = []\n    phi_estimates = []\n    var_estimates = []\n\n    for i in range(0, N - W + 1, S):\n        window = x[i : i + W]\n        \n        # Estimate phi using OLS for x_t = phi * x_{t-1}\n        # The regressors are x_0, ..., x_{W-2} and responses x_1, ..., x_{W-1}\n        # within the window.\n        X_reg = window[:-1]\n        y_reg = window[1:]\n        \n        sum_X_sq = np.dot(X_reg, X_reg)\n        if sum_X_sq == 0:\n            phi_hat = 0.0\n        else:\n            phi_hat = np.dot(X_reg, y_reg) / sum_X_sq\n        \n        # Estimate unbiased sample variance for the entire window\n        var_hat = np.var(window, ddof=1)\n        \n        # Define window time coordinate as the center index\n        t_center = i + (W - 1) / 2.0\n        \n        phi_estimates.append(phi_hat)\n        var_estimates.append(var_hat)\n        t_centers.append(t_center)\n\n    # 3. Calculate trend slopes\n    t_centers_arr = np.array(t_centers)\n    phi_estimates_arr = np.array(phi_estimates)\n    var_estimates_arr = np.array(var_estimates)\n\n    slope_phi = calculate_slope(t_centers_arr, phi_estimates_arr)\n    slope_var = calculate_slope(t_centers_arr, var_estimates_arr)\n    \n    return [slope_phi, slope_var]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (stable baseline)\n        {'N': 500, 'phi_params': 0.2, 'sigma': 1.0, 'W': 50, 'S': 10, 'seed': 42},\n        # Case 2 (approaching tipping)\n        {'N': 500, 'phi_params': (0.2, 0.95), 'sigma': 1.0, 'W': 50, 'S': 10, 'seed': 43},\n        # Case 3 (boundary condition)\n        {'N': 60, 'phi_params': (0.5, 0.9), 'sigma': 1.0, 'W': 50, 'S': 5, 'seed': 44},\n        # Case 4 (near white noise)\n        {'N': 500, 'phi_params': 0.0, 'sigma': 1.0, 'W': 50, 'S': 10, 'seed': 45},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_time_series(\n            N=case['N'],\n            phi_params=case['phi_params'],\n            sigma=case['sigma'],\n            W=case['W'],\n            S=case['S'],\n            seed=case['seed']\n        )\n        results.append(result)\n\n    # Format the output string exactly as required\n    inner_parts = [f\"[{r[0]},{r[1]}]\" for r in results]\n    final_output = f\"[{','.join(inner_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "移动窗口方法的有效性取决于一个关键参数的选择：窗口大小。过短的窗口会产生噪声过大的估计，而过长的窗口则可能模糊信号或因潜在趋势而产生偏差。这项高级练习 () 直接探讨了这一权衡，指导您推导出一个最优的窗口长度。通过最小化均方误差——在数据非平稳性带来的偏差与统计估计量的方差之间取得平衡——您将对稳健的预警指标分析所需的方法论严谨性有更深刻的理解。",
            "id": "3876413",
            "problem": "在单位时间间隔观测一个环境时间序列，该序列被建模为一个缓慢漂移的均值与一个接近临界点且表现出临界慢化的弱平稳噪声过程之和。具体而言，设观测值为 $X_{t} = \\mu(t) + Y_{t}$，其中均值以 $\\mu(t) = \\mu_{0} + \\gamma t$ 的形式线性漂移，漂移速率 $\\gamma$ 为常数；噪声是一个零均值高斯一阶自回归过程 (AR(1))，满足 $Y_{t} = \\phi Y_{t-1} + \\varepsilon_{t}$，其中 $|\\phi|  1$ 且新息 $\\varepsilon_{t} \\sim \\mathcal{N}(0,\\sigma_{\\varepsilon}^{2})$ 随时间独立同分布。令 $\\sigma_{Y}^{2} = \\operatorname{Var}(Y_{t}) = \\sigma_{\\varepsilon}^{2}/(1-\\phi^{2})$ 表示 $Y_{t}$ 的平稳方差。\n\n一个常见的临界点早期预警指标是滑动窗口方差估计量。在给定的时间指数 $\\tau$，定义围绕其窗口内均值计算的窗口方差估计量为\n$$\nW_{w}(\\tau) \\equiv \\frac{1}{w} \\sum_{j=1}^{w} \\left( X_{\\tau-j+1} - \\bar{X}_{w}(\\tau) \\right)^{2}, \\quad \\bar{X}_{w}(\\tau) \\equiv \\frac{1}{w} \\sum_{j=1}^{w} X_{\\tau-j+1}.\n$$\n假设 $w \\ll \\tau$，因此边缘效应可以忽略，且 AR(1) 过程处于其平稳状态。您可以将 $w$ 视为一个大整数，并在适当时用其无限对应项来近似求和。\n\n仅使用偏差、方差的基本定义以及高斯 AR(1) 过程的性质，完成以下任务：\n\n1. 推导由线性漂移 $\\mu(t) = \\mu_{0} + \\gamma t$ 引起，$W_{w}(\\tau)$ 相对于目标平稳方差 $\\sigma_{Y}^{2}$ 的确定性偏差，将该偏差表示为 $w$ 和 $\\gamma$ 的显式函数。请清楚说明您在窗口内采用的任何索引约定。\n\n2. 推导 $\\operatorname{Var}\\!\\left[ W_{w}(\\tau) \\right]$ 的一个渐近有效（大 $w$）的主阶表达式，用 $\\phi$ 和 $\\sigma_{\\varepsilon}^{2}$ 表示。您的推导应基于平方高斯 AR(1) 过程的协方差结构和窗口平均方差的标准渐近理论，并将最终结果表示为 $c(\\phi,\\sigma_{\\varepsilon})/w$ 的形式，其中 $c(\\cdot)$ 是一个显式函数。\n\n3. 结合您的结果，写出大 $w$ 下的均方误差 $\\operatorname{MSE}(w) \\approx \\operatorname{Bias}(w)^{2} + \\operatorname{Var}\\!\\left[ W_{w}(\\tau) \\right]$，并通过将 $w  0$ 视为连续变量来最小化此近似，以获得渐近最优窗口长度 $w^{\\star}$ 的闭式解析表达式。\n\n以 $\\phi$、$\\sigma_{\\varepsilon}$ 和 $\\gamma$ 表示的 $w^{\\star}$ 的单个闭式符号表达式的形式提供您的最终答案。不需要进行数值评估，最终答案中也不报告单位。",
            "solution": "首先验证问题，以确保其具有科学依据、适定性和客观性。\n\n### 步骤 1：提取已知条件\n-   时间序列模型：$X_{t} = \\mu(t) + Y_{t}$\n-   均值漂移：$\\mu(t) = \\mu_{0} + \\gamma t$，其中 $\\gamma$ 是一个常数。\n-   噪声过程：$Y_{t}$ 是一个零均值高斯一阶自回归 (AR(1)) 过程。\n-   AR(1) 定义：$Y_{t} = \\phi Y_{t-1} + \\varepsilon_{t}$，其中 $|\\phi|  1$。\n-   新息：$\\varepsilon_{t} \\sim \\mathcal{N}(0,\\sigma_{\\varepsilon}^{2})$ 且为独立同分布 (i.i.d.)。\n-   $Y_{t}$ 的平稳方差：$\\sigma_{Y}^{2} = \\operatorname{Var}(Y_{t}) = \\sigma_{\\varepsilon}^{2}/(1-\\phi^{2})$。\n-   滑动窗口方差估计量：$W_{w}(\\tau) \\equiv \\frac{1}{w} \\sum_{j=1}^{w} \\left( X_{\\tau-j+1} - \\bar{X}_{w}(\\tau) \\right)^{2}$。\n-   滑动窗口均值：$\\bar{X}_{w}(\\tau) \\equiv \\frac{1}{w} \\sum_{j=1}^{w} X_{\\tau-j+1}$。\n-   假设：$w \\ll \\tau$ (窗口内平稳，边缘效应可忽略)，$w$ 是一个大整数。允许对大 $w$ 进行近似（例如，使用无限和）。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据：** 该问题基于标准的时间序列分析，特别是 AR(1) 过程的研究，这是随机动力学建模的基石。使用方差等统计指标来检测临界点附近的“临界慢化”（即自相关性增加，$\\phi \\to 1$，以及方差增大）是气候科学、生态学和复杂系统理论中的一个主要课题。所有原理都是公认的。\n-   **适定性：** 问题提供了一套完整的定义，并要求推导特定的、可导出的量（偏差、方差）以及随后的优化（均方误差最小化）。关于大 $w$ 的假设指导了必要的近似，确保可以找到一个唯一的、有意义的解。\n-   **客观性：** 问题使用形式化的数学语言和定义陈述，没有歧义或主观论断。\n\n### 步骤 3：结论与行动\n问题是一致的、科学上合理的且适定的，因此是有效的。可以开始求解过程。\n\n---\n\n根据要求，解答分为三个部分推导。\n\n### 1. 确定性偏差的推导\n滑动窗口方差估计量为 $W_{w}(\\tau)$。我们求其期望 $E[W_{w}(\\tau)]$. 设观测指数的窗口为 $t \\in \\{\\tau-w+1, \\dots, \\tau\\}$。\n$$\nX_{t} - \\bar{X}_{w}(\\tau) = \\left(\\mu(t) + Y_{t}\\right) - \\left(\\bar{\\mu}_{w}(\\tau) + \\bar{Y}_{w}(\\tau)\\right) = \\left(\\mu(t) - \\bar{\\mu}_{w}(\\tau)\\right) + \\left(Y_{t} - \\bar{Y}_{w}(\\tau)\\right)\n$$\n其中 $\\bar{\\mu}_{w}(\\tau)$ 和 $\\bar{Y}_{w}(\\tau)$ 分别是均值和噪声分量的窗口平均值。将此表达式平方并取期望：\n$$\nE\\left[\\left(X_{t} - \\bar{X}_{w}(\\tau)\\right)^2\\right] = E\\left[\\left(\\mu(t) - \\bar{\\mu}_{w}(\\tau)\\right)^2 + 2\\left(\\mu(t) - \\bar{\\mu}_{w}(\\tau)\\right)\\left(Y_{t} - \\bar{Y}_{w}(\\tau)\\right) + \\left(Y_{t} - \\bar{Y}_{w}(\\tau)\\right)^2\\right]\n$$\n由于 $\\mu(t)$ 是确定性的，而 $Y_t$ 是一个零均值过程（$E[Y_t] = 0$，因此 $E[\\bar{Y}_{w}(\\tau)]=0$），交叉项的期望为零。\n$$\nE\\left[\\left(X_{t} - \\bar{X}_{w}(\\tau)\\right)^2\\right] = \\left(\\mu(t) - \\bar{\\mu}_{w}(\\tau)\\right)^2 + E\\left[\\left(Y_{t} - \\bar{Y}_{w}(\\tau)\\right)^2\\right]\n$$\n估计量的期望是该量在窗口上的平均值：\n$$\nE[W_{w}(\\tau)] = \\frac{1}{w}\\sum_{t=\\tau-w+1}^{\\tau} E\\left[\\left(X_{t} - \\bar{X}_{w}(\\tau)\\right)^2\\right] = \\frac{1}{w}\\sum_{t=\\tau-w+1}^{\\tau} \\left(\\mu(t) - \\bar{\\mu}_{w}(\\tau)\\right)^2 + E\\left[\\frac{1}{w}\\sum_{t=\\tau-w+1}^{\\tau}\\left(Y_{t} - \\bar{Y}_{w}(\\tau)\\right)^2\\right]\n$$\n问题要求由线性漂移引起的确定性偏差。这对应于第一项，即窗口内确定性均值分量的样本方差。我们来计算这一项。我们将窗口的索引重新标记为从 $k=1$ 到 $w$，其中 $t_k = \\tau - w + k$。\n窗口内的均值为 $\\mu(t_k) = \\mu_0 + \\gamma(\\tau-w+k)$。\n平均均值为 $\\bar{\\mu}_{w}(\\tau) = \\frac{1}{w}\\sum_{k=1}^{w} \\mu(t_k) = \\mu_0 + \\frac{\\gamma}{w}\\sum_{k=1}^{w}(\\tau-w+k) = \\mu_0 + \\gamma(\\tau-w) + \\frac{\\gamma}{w}\\frac{w(w+1)}{2} = \\mu_0 + \\gamma(\\tau - \\frac{w-1}{2})$。\n与平均均值的偏差为 $\\mu(t_k) - \\bar{\\mu}_{w} = \\gamma(\\tau-w+k) - \\gamma(\\tau - \\frac{w-1}{2}) = \\gamma(k - w + \\frac{w-1}{2}) = \\gamma(k - \\frac{w+1}{2})$。\n这些偏差的平方和是：\n$$\n\\sum_{k=1}^{w} \\left(\\mu(t_k) - \\bar{\\mu}_{w}\\right)^2 = \\sum_{k=1}^{w} \\gamma^2 \\left(k - \\frac{w+1}{2}\\right)^2 = \\gamma^2 \\sum_{k=1}^{w} \\left(k - \\bar{k}\\right)^2\n$$\n其中 $\\bar{k} = (w+1)/2$ 是索引 $1, ..., w$ 的均值。前 $w$ 个整数与均值之差的平方和是一个标准结果：$\\sum_{k=1}^{w} (k - \\bar{k})^2 = \\frac{w(w^2-1)}{12}$。\n因此，由漂移引起的偏差是：\n$$\n\\operatorname{Bias}_{\\text{drift}}(w) = \\frac{1}{w} \\sum_{k=1}^{w} \\left(\\mu(t_k) - \\bar{\\mu}_{w}\\right)^2 = \\frac{1}{w} \\gamma^2 \\frac{w(w^2-1)}{12} = \\frac{\\gamma^2 (w^2-1)}{12}\n$$\n对于大 $w$，该偏差可由其主阶项近似：\n$$\n\\operatorname{Bias}_{\\text{drift}}(w) \\approx \\frac{\\gamma^2 w^2}{12}\n$$\n\n### 2. 估计量方差的推导\n我们需要找到 $\\operatorname{Var}[W_{w}(\\tau)]$。对于大 $w$，估计量的方差主要由噪声项 $Y_t$ 的波动决定。趋势项 $\\mu(t)$ 的贡献是确定性的，主要增加偏差，而不是方差。此外，对于大 $w$，样本均值 $\\bar{Y}_w(\\tau)$ 收敛于真实均值 $E[Y_t]=0$，因此我们可以通过在方差计算中忽略均值减法来近似估计量：\n$$\nW_{w}(\\tau) \\approx \\frac{1}{w} \\sum_{t} Y_t^2\n$$\n方差由平方过程 $Z_t = Y_t^2$ 的样本均值的方差给出。对于一个平稳过程，在一个大窗口 $w$ 上的样本均值的方差渐近地为：\n$$\n\\operatorname{Var}\\left[\\frac{1}{w}\\sum_{t=1}^{w} Z_t\\right] \\approx \\frac{1}{w} \\sum_{k=-\\infty}^{\\infty} \\operatorname{Cov}(Z_t, Z_{t+k})\n$$\n我们需要平方高斯过程的自协方差 $\\operatorname{Cov}(Y_t^2, Y_{t+k}^2)$。由于 $Y_t$ 是一个零均值高斯过程，我们使用 Isserlis 定理来计算四阶矩：\n$$\nE[Y_t^2 Y_{t+k}^2] = E[Y_t Y_t Y_{t+k} Y_{t+k}] = E[Y_t^2]E[Y_{t+k}^2] + 2 \\left(E[Y_t Y_{t+k}]\\right)^2\n$$\n那么协方差为：\n$$\n\\operatorname{Cov}(Y_t^2, Y_{t+k}^2) = E[Y_t^2 Y_{t+k}^2] - E[Y_t^2]E[Y_{t+k}^2] = 2 \\left(E[Y_t Y_{t+k}]\\right)^2 = 2 \\left(\\operatorname{Cov}(Y_t, Y_{t+k})\\right)^2\n$$\n对于一个平稳 AR(1) 过程，自协方差为 $\\operatorname{Cov}(Y_t, Y_{t+k}) = \\sigma_Y^2 \\phi^{|k|}$。\n因此，$\\operatorname{Cov}(Y_t^2, Y_{t+k}^2) = 2 (\\sigma_Y^2 \\phi^{|k|})^2 = 2 \\sigma_Y^4 \\phi^{2|k|}$。\n现在，我们对所有整数滞后 $k$ 求和：\n$$\n\\sum_{k=-\\infty}^{\\infty} \\operatorname{Cov}(Y_t^2, Y_{t+k}^2) = \\sum_{k=-\\infty}^{\\infty} 2 \\sigma_Y^4 \\phi^{2|k|} = 2 \\sigma_Y^4 \\left(1 + 2\\sum_{k=1}^{\\infty} (\\phi^2)^k\\right)\n$$\n几何级数的和为 $\\sum_{k=1}^{\\infty} (\\phi^2)^k = \\frac{\\phi^2}{1-\\phi^2}$，因为 $|\\phi|1 \\implies \\phi^21$。\n$$\n\\sum_{k=-\\infty}^{\\infty} \\operatorname{Cov}(Y_t^2, Y_{t+k}^2) = 2 \\sigma_Y^4 \\left(1 + \\frac{2\\phi^2}{1-\\phi^2}\\right) = 2 \\sigma_Y^4 \\left(\\frac{1-\\phi^2+2\\phi^2}{1-\\phi^2}\\right) = 2 \\sigma_Y^4 \\frac{1+\\phi^2}{1-\\phi^2}\n$$\n那么估计量的方差是：\n$$\n\\operatorname{Var}[W_w(\\tau)] \\approx \\frac{1}{w} \\left(2 \\sigma_Y^4 \\frac{1+\\phi^2}{1-\\phi^2}\\right)\n$$\n最后，我们代入 $\\sigma_Y^2 = \\frac{\\sigma_\\varepsilon^2}{1-\\phi^2}$：\n$$\n\\operatorname{Var}[W_w(\\tau)] \\approx \\frac{2}{w} \\left(\\frac{\\sigma_\\varepsilon^2}{1-\\phi^2}\\right)^2 \\frac{1+\\phi^2}{1-\\phi^2} = \\frac{1}{w} \\frac{2 \\sigma_\\varepsilon^4 (1+\\phi^2)}{(1-\\phi^2)^3}\n$$\n\n### 3. 均方误差最小化\n均方误差 (MSE) 是方差和偏差平方的和。使用这两项的大 $w$ 近似：\n$$\n\\operatorname{MSE}(w) \\approx \\operatorname{Bias}(w)^2 + \\operatorname{Var}[W_w(\\tau)] \\approx \\left(\\frac{\\gamma^2 w^2}{12}\\right)^2 + \\frac{1}{w} \\frac{2 \\sigma_\\varepsilon^4 (1+\\phi^2)}{(1-\\phi^2)^3}\n$$\n令\n$$\n\\operatorname{MSE}(w) \\approx \\frac{\\gamma^4}{144} w^4 + \\frac{C}{w}\n$$\n其中 $C = \\frac{2 \\sigma_\\varepsilon^4 (1+\\phi^2)}{(1-\\phi^2)^3}$ 是一个关于 $w$ 的常数。为了找到最小化 MSE 的最优窗口长度 $w^\\star$，我们对 $w$ 求导并将结果设为零。在此优化中，我们将 $w$ 视为一个连续变量。\n$$\n\\frac{d}{dw}\\operatorname{MSE}(w) = \\frac{\\gamma^4}{144} (4 w^3) - \\frac{C}{w^2} = \\frac{\\gamma^4}{36} w^3 - \\frac{C}{w^2}\n$$\n将导数设为零：\n$$\n\\frac{\\gamma^4}{36} (w^\\star)^3 = \\frac{C}{(w^\\star)^2} \\implies (w^\\star)^5 = \\frac{36 C}{\\gamma^4}\n$$\n代入 $C$ 的表达式：\n$$\n(w^\\star)^5 = \\frac{36}{\\gamma^4} \\left(\\frac{2 \\sigma_\\varepsilon^4 (1+\\phi^2)}{(1-\\phi^2)^3}\\right) = \\frac{72 \\sigma_\\varepsilon^4 (1+\\phi^2)}{\\gamma^4 (1-\\phi^2)^3}\n$$\n通过取 5 次方根求解 $w^\\star$ 得到渐近最优窗口长度：\n$$\nw^\\star = \\left(\\frac{72 \\sigma_\\varepsilon^4 (1+\\phi^2)}{\\gamma^4 (1-\\phi^2)^3}\\right)^{1/5}\n$$\n这个表达式可以重新整理为：\n$$\nw^\\star = \\left(\\frac{72(1+\\phi^2)}{(1-\\phi^2)^3}\\right)^{1/5} \\left(\\frac{\\sigma_\\varepsilon}{\\gamma}\\right)^{4/5}\n$$\ngamma 项以 $\\gamma^4$ 的形式出现，因此其符号不影响结果。",
            "answer": "$$\\boxed{\\left(\\frac{72 \\sigma_{\\varepsilon}^4 (1+\\phi^2)}{\\gamma^4 (1-\\phi^2)^3}\\right)^{\\frac{1}{5}}}$$"
        }
    ]
}