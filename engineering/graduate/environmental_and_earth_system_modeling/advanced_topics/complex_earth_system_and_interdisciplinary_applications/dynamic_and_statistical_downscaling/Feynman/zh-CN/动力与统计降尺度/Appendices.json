{
    "hands_on_practices": [
        {
            "introduction": "在进行动态降尺度时，运行区域气候模式需要仔细选择数值参数，以确保模拟结果的稳定性。本练习  将带你深入探讨 Courant-Friedrichs-Lewy (CFL) 条件，这是控制模式时间步长的基本原则。通过计算最大稳定时间步长 $\\Delta t_{\\max}$，你将亲身体会到在计算效率和模式稳定性与保真度之间的权衡。",
            "id": "3875707",
            "problem": "一个对大气环流模式 (GCM) 的边界强迫进行动力降尺度的区域气候模式，在一个均匀网格上推进一个由一维线性平流方程控制的被动示踪物。该模式使用与迎风信息传播一致的显式单步、单调空间离散化方法。其控制偏微分方程为线性平流方程，风速恒定且与网格对齐。降尺度后的场随后将用于统计降尺度和偏差校正，因此方差和极端值的保留与方法选择相关。模式的网格间距为 $\\Delta x = 3$ km，风速为 $u = 20$ m s$^{-1}$。使用 Courant–Friedrichs–Lewy (CFL) 条件以及数值依赖域必须包含物理依赖域的要求，推导该显式平流更新的最大稳定时间步长 $\\Delta t_{\\max}$。提供 $\\Delta t_{\\max}$ 的最终数值，单位为秒。将答案四舍五入至四位有效数字。最终时间步长以秒为单位表示。\n\n此外，简要阐述在动力降尺度为统计降尺度提供输入的背景下，选择接近稳定性极限的时间步长所产生的阻尼权衡，重点讨论显式扩散或滤波选择如何与稳定性和保真度相互作用。您的讨论不影响 $\\Delta t_{\\max}$ 的计算值。",
            "solution": "基本原理是被动示踪物 $\\phi(x,t)$ 的一维线性平流方程，\n$$\n\\frac{\\partial \\phi}{\\partial t} + u \\frac{\\partial \\phi}{\\partial x} = 0,\n$$\n其中速度 $u$ 为常数。此双曲型方程的物理依赖域遵循特征线 $x - u t = \\text{constant}$，这意味着信息以速度 $u$ 沿流动方向传播。\n\n对于在间距为 $\\Delta x$ 的均匀网格上进行的显式时间步进，一个必要的稳定性要求由 Courant–Friedrichs–Lewy (CFL) 条件给出，该条件规定数值依赖域必须包含物理依赖域。对于与特征传播方向一致的单调迎风类格式，此要求可转化为对平流 Courant 数的限制，\n$$\nC \\equiv \\frac{u \\Delta t}{\\Delta x}.\n$$\n为了从第一性原理理解这一点，考虑一个与 $u$ 的符号对齐的保守一阶迎风半离散格式。von Neumann 稳定性分析将一个模态 $\\phi_j^n = \\hat{\\phi}^n \\exp(i k j \\Delta x)$ 展开，其在一个时间步长 $\\Delta t$ 内的放大因子为 $G(k)$。对于显式前向欧拉时间离散和迎风空间通量，当 $u>0$ 时，离散更新可以写为\n$$\n\\phi_j^{n+1} = \\phi_j^n - C \\left(\\phi_j^n - \\phi_{j-1}^n\\right),\n$$\n这得到\n$$\nG(k) = 1 - C \\left(1 - \\exp(- i k \\Delta x)\\right).\n$$\n$G(k)$ 的大小受以下公式限制：\n$$\n|G(k)|^{2} = \\left[1 - C (1 - \\cos(k \\Delta x))\\right]^2 + \\left[C \\sin(k \\Delta x)\\right]^2 = 1 - 2C(1-\\cos(k \\Delta x)) + C^{2} \\left[2 - 2\\cos(k \\Delta x)\\right].\n$$\n最严格的情况发生在最高波数 $k \\Delta x = \\pi$ 时，此时 $\\cos(k \\Delta x) = -1$。代入得：\n$$\n|G|^{2} = 1 - 2C(1 - (-1)) + C^{2} (2 - 2(-1)) = 1 - 4C + 4 C^{2} = (1 - 2C)^{2}.\n$$\n为避免无界增长，放大因子必须对所有允许的 $k$ 满足 $|G| \\le 1$。单调性和正定性约束进一步要求 $0 \\le C \\le 1$。因此，显式迎风平流的 CFL 稳定性判据为\n$$\n0 \\le \\frac{u \\Delta t}{\\Delta x} \\le 1,\n$$\n从而得出最大稳定时间步长为\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x}{|u|}.\n$$\n\n现在我们用给定的参数计算 $\\Delta t_{\\max}$。网格间距为 $\\Delta x = 3$ km，即 $\\Delta x = 3000$ m，风速为 $u = 20$ m s$^{-1}$。因此，\n$$\n\\Delta t_{\\max} = \\frac{3000}{20} = 150 \\text{ s}.\n$$\n四舍五入到四位有效数字，得到\n$$\n\\Delta t_{\\max} = 150.0 \\text{ s}.\n$$\n\n关于阻尼权衡的讨论：在动力降尺度中，选择接近 $\\Delta t_{\\max}$ 的 $\\Delta t$ 可以最大化计算效率，但会增加对显式平流方案固有的色散和扩散数值误差的敏感性。一阶迎风格式引入了数值扩散，其有效扩散率的尺度关系为\n$$\n\\nu_{\\text{num}} \\sim \\frac{1}{2} u \\Delta x (1 - C),\n$$\n因此，当 $C \\to 1$ 时，数值扩散减小，从而能更好地保留方差和极端值，这对于后续的统计降尺度非常重要。然而，在非常接近 $C=1$ 的条件下运行，几乎没有余地来应对 $|u|$ 的局部增加（例如，阵风或模式变率），这有违反 CFL 界限并导致不稳定的风险。相反，减小 $\\Delta t$（即减小 $C$）会增加数值阻尼，这能稳定高波数内容并抑制网格尺度的噪音，但代价是衰减峰值和改变时间自相关结构。如果添加了显式扩散（例如，系数为 $\\nu$ 的拉普拉斯算子）或时间滤波器（如 Robert–Asselin 滤波器），则会产生额外的稳定性约束，例如，对于显式扩散有\n$$\n\\Delta t \\le \\frac{\\Delta x^{2}}{2 \\nu}\n$$\n，并且由滤波器引起的阻尼与滤波器参数成比例。这些机制可以在较大的 $\\Delta t$ 下提供可接受的稳定性裕度，但它们可能会降低统计降尺度旨在校正的极端值和跨尺度方差的保真度。因此，选择 $\\Delta t$ 涉及在稳定性、数值阻尼以及保留将用于统计后处理的物理上有意义的变率之间进行权衡。",
            "answer": "$$\\boxed{150.0}$$"
        },
        {
            "introduction": "气候模式的原始输出通常包含系统性偏差，这限制了其在影响评估中的直接应用。本练习  聚焦于一种强大的统计降尺度技术——分位数映射（Quantile Mapping），它被广泛用于偏差校正。通过推导一个严格单调递增的变换函数 $g$ 如何影响重现期，你将从根本上理解该方法如何重塑变量的整个概率分布，并直接改变如极端事件重现水平 $z_{Y}(N)$ 这样的关键影响指标。",
            "id": "3875621",
            "problem": "考虑一个环境和地球系统建模中的统计降尺度问题，其中使用分位数映射进行偏差校正。设 $X$ 表示由区域气候模型模拟的日降水量。假设 $X$ 具有连续分布，其累积分布函数（CDF）为 $F_{X}$，严格递增的分位数函数为 $Q_{X}(p)$，定义为 $Q_{X}(p) = \\inf\\{x : F_{X}(x) \\geq p\\}$，其中 $p \\in (0,1)$。与重现水平 $z$ 相关联的重现期 $N$（以天为单位）由超限概率 $p_{N} = 1/N$ 定义，因此对于独立的日实现，$z$ 满足 $1 - F_{X}(z) = p_{N}$，从而 $z = Q_{X}(1 - p_{N}) = Q_{X}(1 - 1/N)$。\n\n假设通过一个严格单调递增函数 $g$ 应用偏差校正变换，生成降尺度序列 $Y = g(X)$。特别地，对于分位数映射（QM），$g$ 的构造为 $g(x) = F_{o}^{-1}(F_{m}(x))$，其中 $F_{m}$ 是模型CDF（即 $X$ 的CDF），$F_{o}$ 是观测参考CDF。设观测参考分位数函数为 $Q_{o}(p) = F_{o}^{-1}(p)$。\n\n1. 从累积分布函数和分位数函数的基本定义，以及重现期 $N = 1/p_{N}$（其中 $p_{N}$ 为每日超限概率）的定义出发，推导与重现期 $N$ 关联的变换后重现水平 $z_{Y}(N)$ 的表达式，用 $g$ 和 $Q_{X}$ 表示。\n\n2. 将问题特化为分位数映射，其中 $g(x) = F_{o}^{-1}(F_{m}(x))$，并展示 $z_{Y}(N)$ 如何与 $Q_{o}(p)$ 相关联。然后，假设 $X$（模型）和观测参考值均服从对数正态分布：$\\ln X \\sim \\mathcal{N}(\\mu_{m}, \\sigma_{m}^{2})$ 和 $\\ln Y_{\\mathrm{ref}} \\sim \\mathcal{N}(\\mu_{o}, \\sigma_{o}^{2})$。使用标准正态累积分布函数 $\\Phi$ 及其反函数 $\\Phi^{-1}$，以闭合形式表示 $z_{X}(N)$ 和 $z_{Y}(N)$，并推导比率\n$$\nR(N) = \\frac{z_{Y}(N)}{z_{X}(N)}\n$$\n作为 $\\mu_{m}$、$\\sigma_{m}$、$\\mu_{o}$、$\\sigma_{o}$ 和 $N$ 的闭合形式函数。\n\n3. 对于参数 $\\mu_{m} = 2.5$、$\\sigma_{m} = 0.7$、$\\mu_{o} = 2.6$ 和 $\\sigma_{o} = 0.6$，计算 $N = 100$ 天时 $R(N)$ 的数值。将该比率表示为一个无单位小数，并将答案四舍五入到四位有效数字。",
            "solution": "问题陈述经验证具有科学依据、提法恰当且客观。它包含足够的信息以获得唯一解，并且没有矛盾或谬误。我们可以开始求解。\n\n问题分为三个部分。我们将按顺序解决它们。\n\n***第1部分：推导变换后的重现水平 $z_{Y}(N)$***\n\n随机变量的重现水平 $z$ 由其超限概率定义。对于一个 $N$ 天的重现期，超限概率为 $p_{N} = 1/N$。变换后变量 $Y$ 的重现水平 $z_{Y}(N)$ 是预期平均每 $N$ 天被超过一次的值。在数学上，这表示为：\n$$\nP(Y > z_{Y}(N)) = p_{N} = \\frac{1}{N}\n$$\n设 $F_{Y}$ 是 $Y$ 的累积分布函数（CDF）。超限概率为 $1 - F_{Y}(z_{Y}(N))$。因此：\n$$\n1 - F_{Y}(z_{Y}(N)) = \\frac{1}{N} \\implies F_{Y}(z_{Y}(N)) = 1 - \\frac{1}{N}\n$$\n根据分位数函数的定义 $Q_{Y}(p) = \\inf\\{y : F_{Y}(y) \\geq p\\}$，我们可以将重现水平表示为：\n$$\nz_{Y}(N) = Q_{Y}\\left(1 - \\frac{1}{N}\\right)\n$$\n我们需要将 $Q_{Y}$ 与原始变量 $X$ 的性质和变换 $g$ 联系起来。变量 $Y$ 定义为 $Y = g(X)$，其中 $g$ 是一个严格单调递增的函数。我们来求 $Y$ 的CDF：\n$$\nF_{Y}(y) = P(Y \\leq y) = P(g(X) \\leq y)\n$$\n由于 $g$ 是严格递增的，其反函数 $g^{-1}$ 存在且也是严格递增的。将 $g^{-1}$ 应用于不等式两边，方向保持不变：\n$$\nF_{Y}(y) = P(X \\leq g^{-1}(y))\n$$\n根据 $X$ 的CDF（即 $F_{X}$）的定义，我们有：\n$$\nF_{Y}(y) = F_{X}(g^{-1}(y))\n$$\n为了找到分位数函数 $Q_{Y}(p)$，我们令 $F_{Y}(y) = p$ 并解出 $y$：\n$$\np = F_{X}(g^{-1}(y))\n$$\n将 $X$ 的分位数函数 $Q_{X}$ 应用于两边：\n$$\nQ_{X}(p) = g^{-1}(y)\n$$\n解出 $y$ 得到 $Y$ 的分位数函数的表达式：\n$$\ny = g(Q_{X}(p)) \\implies Q_{Y}(p) = g(Q_{X}(p))\n$$\n现在我们可以将这个表达式代入重现水平 $z_{Y}(N)$ 的方程中：\n$$\nz_{Y}(N) = g\\left(Q_{X}\\left(1 - \\frac{1}{N}\\right)\\right)\n$$\n这就是我们所求的变换后重现水平 $z_{Y}(N)$ 用 $g$ 和 $Q_{X}$ 表示的表达式。\n\n***第2部分：针对分位数映射和对数正态分布的特例***\n\n对于分位数映射（QM），变换函数由 $g(x) = F_{o}^{-1}(F_{m}(x))$ 给出，其中 $F_{m}$ 是模型CDF（即 $F_{X}$），$F_{o}$ 是观测参考CDF。\n变换后变量 $Y$ 的分位数函数是 $Q_{Y}(p) = g(Q_{X}(p))$。代入QM的特定形式的 $g$：\n$$\nQ_{Y}(p) = F_{o}^{-1}(F_{m}(Q_{X}(p)))\n$$\n根据定义，$Q_{X}$ 是 $F_{X}$（即 $F_{m}$）的反函数，所以 $F_{m}(Q_{X}(p)) = p$。因此：\n$$\nQ_{Y}(p) = F_{o}^{-1}(p) = Q_{o}(p)\n$$\n这表明偏差校正后的变量 $Y$ 的分位数函数与观测值的分位数函数相同。因此，重现水平 $z_{Y}(N)$ 由在非超限概率处求值的观测分位数函数给出：\n$$\nz_{Y}(N) = Q_{Y}\\left(1 - \\frac{1}{N}\\right) = Q_{o}\\left(1 - \\frac{1}{N}\\right)\n$$\n接下来，我们假设模型和观测数据都服从对数正态分布。\n- 模型：$\\ln X \\sim \\mathcal{N}(\\mu_{m}, \\sigma_{m}^{2})$。\n- 观测：$\\ln Y_{\\mathrm{ref}} \\sim \\mathcal{N}(\\mu_{o}, \\sigma_{o}^{2})$。\n\n对于一个对数正态变量，其对数的均值为 $\\mu$、标准差为 $\\sigma$，其分位数函数为 $Q(p) = \\exp(\\mu + \\sigma \\Phi^{-1}(p))$，其中 $\\Phi$ 是标准正态CDF，$\\Phi^{-1}$ 是其反函数（概率单位函数）。\n\n对于模型变量 $X$，分位数函数是 $Q_{X}(p) = \\exp(\\mu_{m} + \\sigma_{m} \\Phi^{-1}(p))$。模型重现水平 $z_{X}(N)$ 是：\n$$\nz_{X}(N) = Q_{X}\\left(1 - \\frac{1}{N}\\right) = \\exp\\left(\\mu_{m} + \\sigma_{m} \\Phi^{-1}\\left(1 - \\frac{1}{N}\\right)\\right)\n$$\n对于观测参考，分位数函数是 $Q_{o}(p) = \\exp(\\mu_{o} + \\sigma_{o} \\Phi^{-1}(p))$。如上所示，$z_{Y}(N) = Q_{o}(1 - 1/N)$，所以变换后的重现水平 $z_{Y}(N)$ 是：\n$$\nz_{Y}(N) = Q_{o}\\left(1 - \\frac{1}{N}\\right) = \\exp\\left(\\mu_{o} + \\sigma_{o} \\Phi^{-1}\\left(1 - \\frac{1}{N}\\right)\\right)\n$$\n比率 $R(N) = z_{Y}(N) / z_{X}(N)$ 则是：\n$$\nR(N) = \\frac{\\exp\\left(\\mu_{o} + \\sigma_{o} \\Phi^{-1}\\left(1 - \\frac{1}{N}\\right)\\right)}{\\exp\\left(\\mu_{m} + \\sigma_{m} \\Phi^{-1}\\left(1 - \\frac{1}{N}\\right)\\right)}\n$$\n使用性质 $\\exp(a)/\\exp(b) = \\exp(a-b)$，我们得到闭合形式的表达式：\n$$\nR(N) = \\exp\\left[ \\left(\\mu_{o} - \\mu_{m}\\right) + \\left(\\sigma_{o} - \\sigma_{m}\\right) \\Phi^{-1}\\left(1 - \\frac{1}{N}\\right) \\right]\n$$\n\n***第3部分：数值计算***\n\n给定参数 $\\mu_{m} = 2.5$、$\\sigma_{m} = 0.7$、$\\mu_{o} = 2.6$ 和 $\\sigma_{o} = 0.6$。我们需要计算 $N = 100$ 时的 $R(N)$。\n\n首先，我们计算参数的差异：\n$$\n\\mu_{o} - \\mu_{m} = 2.6 - 2.5 = 0.1\n$$\n$$\n\\sigma_{o} - \\sigma_{m} = 0.6 - 0.7 = -0.1\n$$\n接下来，我们评估 $N=100$ 时的非超限概率：\n$$\n1 - \\frac{1}{N} = 1 - \\frac{1}{100} = 0.99\n$$\n我们需要标准正态CDF在 $0.99$ 处的反函数值：\n$$\n\\Phi^{-1}(0.99) \\approx 2.32634787\n$$\n现在，我们将这些值代入 $R(100)$ 的表达式中：\n$$\nR(100) = \\exp\\left[ 0.1 + (-0.1) \\times \\Phi^{-1}(0.99) \\right]\n$$\n$$\nR(100) \\approx \\exp[0.1 - (0.1 \\times 2.32634787)]\n$$\n$$\nR(100) \\approx \\exp[0.1 - 0.232634787]\n$$\n$$\nR(100) \\approx \\exp[-0.132634787]\n$$\n$$\nR(100) \\approx 0.8757870\n$$\n将结果四舍五入到四位有效数字，得到 $0.8758$。",
            "answer": "$$\\boxed{0.8758}$$"
        },
        {
            "introduction": "降尺度的最终目的通常是为影响模型提供驱动数据，从而将宏观的气候信息转化为具体的、可操作的见解。这项综合性练习  模拟了一个完整的真实世界工作流程：评估风能潜力。你将整合代表动态降尺度（平均值和方差的变化）和统计降尺度（使用广义帕累托分布 GPD 进行尾部拟合）的概念，来估算风力涡轮机的期望功率输出，从而连接气候模式数据与实际应用之间的鸿沟。",
            "id": "3875597",
            "problem": "一位风能分析师旨在量化风速场的动态和统计降尺度如何改变单台水平轴风力涡轮机的期望功率输出。该涡轮机的特性由一条简化的分段功率曲线描述，并在一个由两步降尺度过程生成的特定场点风速分布下运行。分析师必须实现一个程序，该程序针对一组指定的参数组合，计算期望功率输出，即涡轮机功率在降尺度后的风速概率密度函数下的数学期望。\n\n所使用的基本原理是数学期望的定义、作为风速模型的对数正态分布的定义，以及在超阈值峰值框架中用于上尾部的广义帕累托分布（GPD）。分析师必须利用以下经过充分检验的定义：\n\n1. 一个非负可测函数 $P(u)$ 关于风速概率密度函数 $f(u)$ 的期望为\n$$\n\\mathbb{E}[P] = \\int_{0}^{\\infty} P(u) f(u) \\, du.\n$$\n\n2. 建模为参数为 $(\\mu, \\sigma)$ 的对数正态分布的风速 $U$ 具有概率密度函数\n$$\nf_{\\mathrm{LN}}(u; \\mu, \\sigma) = \\frac{1}{u \\sigma \\sqrt{2\\pi}} \\exp\\left( - \\frac{(\\ln u - \\mu)^2}{2 \\sigma^2} \\right), \\quad u > 0,\n$$\n和累积分布函数\n$$\nF_{\\mathrm{LN}}(u; \\mu, \\sigma) = \\Phi\\left( \\frac{\\ln u - \\mu}{\\sigma} \\right),\n$$\n其中 $\\Phi$ 是标准正态累积分布函数。如果粗网格风速 $U_c$ 的均值为 $\\bar{u}_c$，方差为 $\\mathrm{Var}_c$，那么 $U_c$ 在对数空间中的对数正态表示具有参数\n$$\n\\sigma_c^2 = \\ln\\left(1 + \\frac{\\mathrm{Var}_c}{\\bar{u}_c^2}\\right), \\quad \\mu_c = \\ln(\\bar{u}_c) - \\frac{1}{2}\\sigma_c^2.\n$$\n\n3. 动态降尺度表示为一个具有物理动机的变换，它由于局部加速效应而增加了子网格变率并调整了平均风速。在对数空间中，这被建模为\n$$\n\\mu_{\\ell} = \\ln(k) + \\mu_c, \\quad \\sigma_{\\ell} = s \\, \\sigma_c,\n$$\n其中 $k > 0$ 是一个乘性平均加速因子，$s > 0$ 是一个变率膨胀因子。因此，基准局地分布为 $U_{\\ell} \\sim \\mathrm{Lognormal}(\\mu_{\\ell}, \\sigma_{\\ell})$。\n\n4. 针对尾部行为的统计降尺度是通过使用广义帕累托分布（GPD）的超阈值峰值方法，替换超过阈值 $u_t > 0$ 的上尾部来实现的。对于超出量 $Y = U - u_t$ ($U \\ge u_t$)，具有形状参数 $\\xi$ 和尺度参数 $\\beta > 0$ 的广义帕累托分布（GPD）的累积分布函数为\n$$\nH(y; \\xi, \\beta) =\n\\begin{cases}\n1 - \\left(1 + \\dfrac{\\xi y}{\\beta}\\right)^{-1/\\xi},  \\xi \\ne 0, \\\\\n1 - \\exp\\left(-\\dfrac{y}{\\beta}\\right),  \\xi = 0,\n\\end{cases}\n$$\n其支撑集为 $y \\ge 0$ 且 $1 + \\dfrac{\\xi y}{\\beta} > 0$，概率密度函数为\n$$\nh(y; \\xi, \\beta) =\n\\begin{cases}\n\\dfrac{1}{\\beta}\\left(1 + \\dfrac{\\xi y}{\\beta}\\right)^{-1/\\xi - 1},  \\xi \\ne 0, \\\\\n\\dfrac{1}{\\beta}\\exp\\left(-\\dfrac{y}{\\beta}\\right),  \\xi = 0.\n\\end{cases}\n$$\n定义基准超出概率\n$$\np_t = 1 - F_{\\mathrm{LN}}(u_t; \\mu_{\\ell}, \\sigma_{\\ell}).\n$$\n通过拼接尾部来构建复合局地累积分布函数 $F(u)$ 和概率密度函数 $f(u)$：\n$$\nF(u) =\n\\begin{cases}\nF_{\\mathrm{LN}}(u; \\mu_{\\ell}, \\sigma_{\\ell}),  0  u  u_t, \\\\\nF_{\\mathrm{LN}}(u_t; \\mu_{\\ell}, \\sigma_{\\ell}) + p_t \\, H(u - u_t; \\xi, \\beta),  u \\ge u_t,\n\\end{cases}\n$$\n$$\nf(u) =\n\\begin{cases}\nf_{\\mathrm{LN}}(u; \\mu_{\\ell}, \\sigma_{\\ell}),  0  u  u_t, \\\\\np_t \\, h(u - u_t; \\xi, \\beta),  u \\ge u_t,\n\\end{cases}\n$$\n当 $\\xi  0$ 时，对于 $u \\ge u_t$，通过 $u \\le u_{\\max}$ 来强制执行 GPD 支撑集约束，其中\n$$\nu_{\\max} = u_t - \\frac{\\beta}{\\xi}.\n$$\n如果不应用尾部替换，则对于所有 $u > 0$，将复合分布设置为基准对数正态分布。\n\n5. 涡轮机功率曲线 $P(u)$ 由一个达到额定功率的三次方斜坡和一个平台区表示，其中切入风速 $v_{\\mathrm{ci}} > 0$，额定风速 $v_r > v_{\\mathrm{ci}}$，切出风速 $v_{\\mathrm{co}} > v_r$，额定功率 $P_r > 0$：\n$$\nP(u) =\n\\begin{cases}\n0,  u  v_{\\mathrm{ci}}, \\\\\nP_r \\left( \\dfrac{u - v_{\\mathrm{ci}}}{v_r - v_{\\mathrm{ci}}} \\right)^3,  v_{\\mathrm{ci}} \\le u  v_r, \\\\\nP_r,  v_r \\le u  v_{\\mathrm{co}}, \\\\\n0,  u \\ge v_{\\mathrm{co}}.\n\\end{cases}\n$$\n\n分析师必须实现一种数值积分方法，该方法遵循 $P(u)$ 和复合 $f(u)$ 的分段定义，包括当 $\\xi  0$ 时的尾部支撑集约束。由于当 $u \\ge v_{\\mathrm{co}}$ 时 $P(u) = 0$，积分必须在 $u \\in [0, v_{\\mathrm{co}}]$ 上计算。可以使用任何稳健的求积方法，并且在适用时必须注意在相关断点 $u \\in \\{ v_{\\mathrm{ci}}, v_r, v_{\\mathrm{co}}, u_t, u_{\\max} \\}$ 处拆分积分。\n\n必须遵守物理单位：风速单位为米/秒 (m/s)，功率必须以瓦特 (W) 为单位返回。将每个测试用例的最终期望功率以 W 为单位表示，并四舍五入到最接近的整数。\n\n实现程序以计算以下测试套件的期望功率。每个测试用例提供粗网格风速统计数据、降尺度参数和涡轮机特性：\n\n- 测试用例1（通用正常路径）：\n  - 粗网格平均风速 $\\bar{u}_c = 7.0$ m/s，粗网格方差 $\\mathrm{Var}_c = 8.0$ $(\\mathrm{m/s})^2$。\n  - 动态降尺度：变率膨胀 $s = 1.3$，加速因子 $k = 1.1$。\n  - 统计尾部替换：阈值 $u_t = 15.0$ m/s，形状 $\\xi = 0.1$，尺度 $\\beta = 2.0$ m/s。\n  - 涡轮机：$v_{\\mathrm{ci}} = 3.0$ m/s, $v_r = 12.0$ m/s, $v_{\\mathrm{co}} = 25.0$ m/s, $P_r = 3000000.0$ W。\n\n- 测试用例2（更强的变率和更重的尾部）：\n  - 粗网格平均风速 $\\bar{u}_c = 7.0$ m/s，粗网格方差 $\\mathrm{Var}_c = 8.0$ $(\\mathrm{m/s})^2$。\n  - 动态降尺度：变率膨胀 $s = 1.5$，加速因子 $k = 1.0$。\n  - 统计尾部替换：阈值 $u_t = 10.0$ m/s，形状 $\\xi = 0.35$，尺度 $\\beta = 3.0$ m/s。\n  - 涡轮机：$v_{\\mathrm{ci}} = 3.0$ m/s, $v_r = 12.0$ m/s, $v_{\\mathrm{co}} = 25.0$ m/s, $P_r = 3000000.0$ W。\n\n- 测试用例3（有界薄尾，均值降低）：\n  - 粗网格平均风速 $\\bar{u}_c = 8.0$ m/s，粗网格方差 $\\mathrm{Var}_c = 6.0$ $(\\mathrm{m/s})^2$。\n  - 动态降尺度：变率膨胀 $s = 1.0$，加速因子 $k = 0.9$。\n  - 统计尾部替换：阈值 $u_t = 13.0$ m/s，形状 $\\xi = -0.1$，尺度 $\\beta = 5.0$ m/s。\n  - 涡轮机：$v_{\\mathrm{ci}} = 3.0$ m/s, $v_r = 12.0$ m/s, $v_{\\mathrm{co}} = 25.0$ m/s, $P_r = 3000000.0$ W。\n\n- 测试用例4（基准情况，无尾部替换）：\n  - 粗网格平均风速 $\\bar{u}_c = 6.0$ m/s，粗网格方差 $\\mathrm{Var}_c = 5.0$ $(\\mathrm{m/s})^2$。\n  - 动态降尺度：变率膨胀 $s = 1.2$，加速因子 $k = 1.05$。\n  - 统计尾部替换：无（仅使用对数正态分布）。\n  - 涡轮机：$v_{\\mathrm{ci}} = 3.0$ m/s, $v_r = 12.0$ m/s, $v_{\\mathrm{co}} = 25.0$ m/s, $P_r = 3000000.0$ W。\n\n- 测试用例5（较低的切出风速，改变的涡轮机，阈值高于额定风速）：\n  - 粗网格平均风速 $\\bar{u}_c = 5.0$ m/s，粗网格方差 $\\mathrm{Var}_c = 4.0$ $(\\mathrm{m/s})^2$。\n  - 动态降尺度：变率膨胀 $s = 1.1$，加速因子 $k = 1.2$。\n  - 统计尾部替换：阈值 $u_t = 18.0$ m/s，形状 $\\xi = 0.2$，尺度 $\\beta = 2.5$ m/s。\n  - 涡轮机：$v_{\\mathrm{ci}} = 5.0$ m/s, $v_r = 11.0$ m/s, $v_{\\mathrm{co}} = 20.0$ m/s, $P_r = 2000000.0$ W。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[result1,result2,result3]$）。每个结果必须是一个整数，代表以瓦特（W）为单位的期望功率，四舍五入到最接近的整数，并按测试用例1到5的顺序排列。",
            "solution": "该问题要求计算风力涡轮机在降尺度后的风速状况下的期望功率输出 $\\mathbb{E}[P]$。解决方案涉及为风速分布和涡轮机功率曲线定义数学模型，然后对期望积分进行数值评估。\n\n期望功率 $\\mathbb{E}[P]$ 由功率曲线 $P(u)$ 乘以风速概率密度函数（PDF）$f(u)$ 进行加权后的积分给出：\n$$\n\\mathbb{E}[P] = \\int_{0}^{\\infty} P(u) f(u) \\, du\n$$\n函数 $P(u)$ 和 $f(u)$ 是分段函数，这要求对积分采用谨慎的分段方法。\n\n首先，我们定义复合风速PDF $f(u)$，它是通过一个两步降尺度过程构建的。\n\n**步骤1：基于粗网格数据和动态降尺度的基准对数正态分布**\n\n粗网格风速 $U_c$ 由其均值 $\\bar{u}_c$ 和方差 $\\mathrm{Var}_c$ 来表征。这些值用于参数化一个对数正态分布。在对数空间中，其底层正态分布的参数 $\\mu_c$ 和 $\\sigma_c$ 使用矩量法求得：\n$$\n\\sigma_c^2 = \\ln\\left(1 + \\frac{\\mathrm{Var}_c}{\\bar{u}_c^2}\\right)\n$$\n$$\n\\mu_c = \\ln(\\bar{u}_c) - \\frac{1}{2}\\sigma_c^2\n$$\n动态降尺度调整这些参数以反映局地地形效应。一个加速因子 $k$ 修改均值，一个变率膨胀因子 $s$ 修改对数空间中的标准差。得到的局地对数正态分布参数 $\\mu_{\\ell}$ 和 $\\sigma_{\\ell}$ 为：\n$$\n\\mu_{\\ell} = \\ln(k) + \\mu_c\n$$\n$$\n\\sigma_{\\ell} = s \\sqrt{\\sigma_c^2}\n$$\n因此，基准局地风速分布是对数正态分布，$U_{\\ell} \\sim \\mathrm{Lognormal}(\\mu_{\\ell}, \\sigma_{\\ell})$，其PDF为：\n$$\nf_{\\mathrm{LN}}(u; \\mu_{\\ell}, \\sigma_{\\ell}) = \\frac{1}{u \\sigma_{\\ell} \\sqrt{2\\pi}} \\exp\\left( - \\frac{(\\ln u - \\mu_{\\ell})^2}{2 \\sigma_{\\ell}^2} \\right), \\quad u > 0\n$$\n\n**步骤2：采用统计尾部替换的复合PDF**\n\n对于涉及统计降尺度的情况，基准对数正态分布的上尾部在超过某个阈值 $u_t$ 后被一个广义帕累托分布（GPD）替换。这是一个超阈值峰值（POT）模型。\n\n在基准分布下超过阈值 $u_t$ 的概率是：\n$$\np_t = 1 - F_{\\mathrm{LN}}(u_t; \\mu_{\\ell}, \\sigma_{\\ell}) = 1 - \\Phi\\left( \\frac{\\ln u_t - \\mu_{\\ell}}{\\sigma_{\\ell}} \\right)\n$$\n其中 $F_{\\mathrm{LN}}$ 是对数正态分布的累积分布函数（CDF），而 $\\Phi$ 是标准正态CDF。\n\n对于 $U \\ge u_t$，超出量 $Y = U - u_t$ 的分布由具有形状参数 $\\xi$ 和尺度参数 $\\beta$ 的GPD建模。GPD的PDF由下式给出：\n$$\nh(y; \\xi, \\beta) =\n\\begin{cases}\n\\dfrac{1}{\\beta}\\left(1 + \\dfrac{\\xi y}{\\beta}\\right)^{-1/\\xi - 1}  \\text{for } \\xi \\ne 0 \\\\\n\\dfrac{1}{\\beta}\\exp\\left(-\\dfrac{y}{\\beta}\\right)  \\text{for } \\xi = 0\n\\end{cases}\n$$\n该公式在 $y \\ge 0$ 时有效，并且如果 $\\xi  0$，则在 $y \\le -\\beta/\\xi$ 时有效。\n\n最终的复合PDF $f(u)$ 是通过在阈值 $u_t$ 处拼接对数正态PDF和缩放后的GPD PDF而形成的：\n$$\nf(u) =\n\\begin{cases}\nf_{\\mathrm{LN}}(u; \\mu_{\\ell}, \\sigma_{\\ell}),  0  u  u_t \\\\\np_t \\, h(u - u_t; \\xi, \\beta),  u \\ge u_t\n\\end{cases}\n$$\n如果 $\\xi  0$，GPD尾部是有界的，且对于 $u > u_{\\max} = u_t - \\beta/\\xi$，$f(u) = 0$。如果不应用尾部替换，则对于所有 $u > 0$，$f(u) = f_{\\mathrm{LN}}(u; \\mu_{\\ell}, \\sigma_{\\ell})$。\n\n**涡轮机功率曲线**\n\n涡轮机的功率输出 $P(u)$ 被定义为风速 $u$ 的分段函数：\n$$\nP(u) =\n\\begin{cases}\n0,  u  v_{\\mathrm{ci}} \\text{ or } u \\ge v_{\\mathrm{co}} \\\\\nP_r \\left( \\dfrac{u - v_{\\mathrm{ci}}}{v_r - v_{\\mathrm{ci}}} \\right)^3,  v_{\\mathrm{ci}} \\le u  v_r \\\\\nP_r,  v_r \\le u  v_{\\mathrm{co}}\n\\end{cases}\n$$\n其中 $v_{\\mathrm{ci}}$、$v_r$ 和 $v_{\\mathrm{co}}$ 分别是切入风速、额定风速和切出风速，$P_r$ 是额定功率。由于当 $u \\ge v_{\\mathrm{co}}$ 时 $P(u)=0$，期望积分仅在区间 $[0, v_{\\mathrm{co}}]$ 上非零。\n\n**数值积分策略**\n\n被积函数 $P(u)f(u)$ 是一个分段函数。其函数形式发生变化的点源自 $P(u)$ 和 $f(u)$ 的定义。这些断点是 $\\{0, v_{\\mathrm{ci}}, v_r, v_{\\mathrm{co}}\\}$，以及在适用情况下的尾部阈值 $u_t$。如果GPD尾部有界（$\\xi  0$），其上限 $u_{\\max}$ 也是一个潜在的断点。\n\n为了计算总期望值，将积分拆分为在这些断点定义的子区间上的积分之和。\n$$\n\\mathbb{E}[P] = \\int_{0}^{v_{\\mathrm{co}}} P(u) f(u) \\, du = \\sum_{i=0}^{N-1} \\int_{z_i}^{z_{i+1}} P(u) f(u) \\, du\n$$\n其中 $\\{z_0, z_1, \\dots, z_N\\}$ 是在 $[0, v_{\\mathrm{co}}]$ 范围内的排序后的唯一断点集合。在每个子区间 $(z_i, z_{i+1})$ 上，被积函数具有单一、连续的解析形式，这允许使用标准求积方法（如 `scipy.integrate.quad`）进行精确的数值评估。\n\n每个测试用例的总体算法如下：\n1.  根据粗网格统计数据和降尺度因子计算局地对数正态参数 $\\mu_{\\ell}$ 和 $\\sigma_{\\ell}$。\n2.  为对数正态PDF $f_{\\mathrm{LN}}(u)$、GPD PDF $h(y)$ 和功率曲线 $P(u)$ 定义函数。\n3.  构建复合PDF $f(u)$，如果尾部替换被激活，则包括计算超出概率 $p_t$。\n4.  通过合并 $\\{0, v_{\\mathrm{ci}}, v_r, v_{\\mathrm{co}}\\}$ 以及在适用情况下的 $\\{u_t, u_{\\max}\\}$，确定唯一、排序的积分断点集，仅考虑 $[0, v_{\\mathrm{co}}]$ 范围内的点。\n5.  遍历相邻的断点对，定义积分区间。对于每个区间，使用数值求积计算 $\\int P(u)f(u) \\, du$。\n6.  将所有区间的结果相加，得到总的期望功率 $\\mathbb{E}[P]$。\n7.  按要求将最终值四舍五入到最接近的整数。\n\n这种结构化的方法确保了模型的所有分段组件都得到正确处理，从而为期望功率输出得出一个准确的值。",
            "answer": "[855018,1036034,449742,431189,425515]"
        }
    ]
}