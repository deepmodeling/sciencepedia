{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of probabilistic event attribution is quantifying how the likelihood of an extreme event has changed between the world as it is (factual) and a world that might have been without anthropogenic climate change (counterfactual). This is most commonly done using the Risk Ratio ($RR$). This first exercise  provides a foundational, hands-on calculation of the $RR$ and its statistical uncertainty directly from the output of large climate model ensembles. Mastering this core skill is essential for interpreting and producing attribution statements.",
            "id": "4041785",
            "problem": "A global coupled General Circulation Model (GCM) is used to perform a large-ensemble event attribution analysis for a heatwave threshold defined by daily maximum temperature exceeding a high quantile calibrated from a long control simulation. Two sets of atmosphere-only simulations are generated with distinct external forcings but identical model physics and comparable sample sizes: a \"factual\" world with present-day forcings and a \"counterfactual\" world approximating preindustrial forcings. Let $N_1$ and $N_0$ denote the total numbers of independent daily samples pooled across all ensemble members and relevant seasons for the factual and counterfactual sets, respectively, and let $n_1$ and $n_0$ denote the corresponding numbers of exceedances of the threshold. Assume that within each world, exceedances arise as independent Bernoulli trials with constant probability.\n\nIn a particular analysis, the model produced $N_1 = 50{,}000$ daily samples in the factual world with $n_1 = 2{,}100$ exceedances, and $N_0 = 50{,}000$ daily samples in the counterfactual world with $n_0 = 200$ exceedances.\n\nUsing only core definitions and large-sample properties of binomial sampling, do the following:\n\n- Define the Risk Ratio (RR) for the event as the ratio of the exceedance probability in the factual world to that in the counterfactual world, and compute its maximum likelihood estimator based on the given counts.\n- Starting from the binomial model and the large-sample Gaussian approximation for the sample proportions, derive the asymptotic standard error of the natural logarithm of the estimated Risk Ratio, and then evaluate it numerically using the given counts.\n\nRound both the estimated Risk Ratio and the asymptotic standard error of its natural logarithm to four significant figures. Report dimensionless quantities (do not express any result as a percentage).",
            "solution": "The problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution. We may proceed with the analysis.\n\nLet $p_1$ be the true probability of a daily maximum temperature exceedance in the factual world and $p_0$ be the true probability of an exceedance in the counterfactual world. The problem states that within each world, the occurrences of exceedances are modeled as independent Bernoulli trials.\nThe number of exceedances $n_1$ in the factual world, from a total of $N_1$ samples, is thus a realization of a random variable following a binomial distribution, $n_1 \\sim \\text{Bin}(N_1, p_1)$.\nSimilarly, the number of exceedances $n_0$ in the counterfactual world follows $n_0 \\sim \\text{Bin}(N_0, p_0)$.\n\nThe maximum likelihood estimator (MLE) for the probability parameter $p$ of a binomial distribution is the sample proportion $\\hat{p} = \\frac{n}{N}$.\nTherefore, the MLEs for $p_1$ and $p_0$ are:\n$$ \\hat{p}_1 = \\frac{n_1}{N_1} $$\n$$ \\hat{p}_0 = \\frac{n_0}{N_0} $$\n\nThe first task is to define the Risk Ratio ($RR$) and compute its MLE.\nThe $RR$ is defined as the ratio of the exceedance probability in the factual world to that in the counterfactual world:\n$$ RR = \\frac{p_1}{p_0} $$\n\nBy the invariance property of maximum likelihood estimators, the MLE of a function of parameters is that same function applied to the MLEs of the parameters. Thus, the MLE of the Risk Ratio, denoted $\\widehat{RR}$, is:\n$$ \\widehat{RR} = \\frac{\\hat{p}_1}{\\hat{p}_0} = \\frac{n_1/N_1}{n_0/N_0} $$\n\nUsing the provided data, $N_1 = 50,000$, $n_1 = 2,100$, $N_0 = 50,000$, and $n_0 = 200$:\n$$ \\hat{p}_1 = \\frac{2,100}{50,000} = 0.042 $$\n$$ \\hat{p}_0 = \\frac{200}{50,000} = 0.004 $$\n$$ \\widehat{RR} = \\frac{0.042}{0.004} = 10.5 $$\nRounding to four significant figures, we get $\\widehat{RR} = 10.50$.\n\nThe second task is to derive the asymptotic standard error of the natural logarithm of the estimated Risk Ratio, $\\text{SE}(\\ln(\\widehat{RR}))$.\nLet $g(p_1, p_0) = \\ln(RR) = \\ln(\\frac{p_1}{p_0}) = \\ln(p_1) - \\ln(p_0)$. We are interested in the standard error of $g(\\hat{p}_1, \\hat{p}_0) = \\ln(\\widehat{RR})$.\n\nAccording to the central limit theorem, for large sample sizes, the distributions of the sample proportions $\\hat{p}_1$ and $\\hat{p}_0$ are approximately Gaussian:\n$$ \\hat{p}_1 \\approx \\mathcal{N}\\left(p_1, \\frac{p_1(1-p_1)}{N_1}\\right) $$\n$$ \\hat{p}_0 \\approx \\mathcal{N}\\left(p_0, \\frac{p_0(1-p_0)}{N_0}\\right) $$\nThe variances are $\\text{Var}(\\hat{p}_1) = \\frac{p_1(1-p_1)}{N_1}$ and $\\text{Var}(\\hat{p}_0) = \\frac{p_0(1-p_0)}{N_0}$. Since the factual and counterfactual simulations are independent, $\\text{Cov}(\\hat{p}_1, \\hat{p}_0) = 0$.\n\nWe use the multivariate Delta method to find the asymptotic variance of $\\ln(\\widehat{RR})$. For a function $g(\\hat{\\theta}_1, \\hat{\\theta}_2)$ of two independent estimators, the variance is approximated by:\n$$ \\text{Var}(g(\\hat{\\theta}_1, \\hat{\\theta}_2)) \\approx \\left(\\frac{\\partial g}{\\partial \\theta_1}\\right)^2 \\text{Var}(\\hat{\\theta}_1) + \\left(\\frac{\\partial g}{\\partial \\theta_2}\\right)^2 \\text{Var}(\\hat{\\theta}_2) $$\nwhere the partial derivatives are evaluated at the true parameter values $(\\theta_1, \\theta_2)$.\n\nIn our case, $\\theta_1 = p_1$, $\\theta_2 = p_0$, and $g(p_1, p_0) = \\ln(p_1) - \\ln(p_0)$. The partial derivatives are:\n$$ \\frac{\\partial g}{\\partial p_1} = \\frac{1}{p_1} $$\n$$ \\frac{\\partial g}{\\partial p_0} = -\\frac{1}{p_0} $$\n\nSubstituting these into the Delta method formula:\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\left(\\frac{1}{p_1}\\right)^2 \\text{Var}(\\hat{p}_1) + \\left(-\\frac{1}{p_0}\\right)^2 \\text{Var}(\\hat{p}_0) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1}{p_1^2} \\left( \\frac{p_1(1-p_1)}{N_1} \\right) + \\frac{1}{p_0^2} \\left( \\frac{p_0(1-p_0)}{N_0} \\right) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1-p_1}{p_1 N_1} + \\frac{1-p_0}{p_0 N_0} $$\nThis is the asymptotic variance. To obtain an estimated variance, we substitute the MLEs $\\hat{p}_1$ and $\\hat{p}_0$ for the true parameters $p_1$ and $p_0$:\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1-\\hat{p}_1}{\\hat{p}_1 N_1} + \\frac{1-\\hat{p}_0}{\\hat{p}_0 N_0} $$\nSubstituting $\\hat{p}_1 = n_1/N_1$ and $\\hat{p}_0 = n_0/N_0$:\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1 - n_1/N_1}{ (n_1/N_1) N_1} + \\frac{1 - n_0/N_0}{ (n_0/N_0) N_0} = \\frac{(N_1 - n_1)/N_1}{n_1} + \\frac{(N_0 - n_0)/N_0}{n_0} $$\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{N_1 - n_1}{n_1 N_1} + \\frac{N_0 - n_0}{n_0 N_0} $$\nThis expression can be rewritten as:\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\left(\\frac{1}{n_1} - \\frac{1}{N_1}\\right) + \\left(\\frac{1}{n_0} - \\frac{1}{N_0}\\right) $$\nThe asymptotic standard error is the square root of this estimated variance:\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{n_1} - \\frac{1}{N_1} + \\frac{1}{n_0} - \\frac{1}{N_0}} $$\n\nNow, we evaluate this numerically with the given counts:\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} - \\frac{1}{50,000} + \\frac{1}{200} - \\frac{1}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} + \\frac{1}{200} - \\frac{2}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.000476190... + 0.005 - 0.00004} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.005436190...} \\approx 0.07373052... $$\nRounding to four significant figures, we get $\\text{SE}(\\ln(\\widehat{RR})) = 0.07373$.\n\nThe two required quantities are the estimated Risk Ratio, $\\widehat{RR}$, and the asymptotic standard error of its logarithm, $\\text{SE}(\\ln(\\widehat{RR}))$.\n- Estimated Risk Ratio: $10.50$\n- Asymptotic standard error of the log-Risk Ratio: $0.07373$",
            "answer": "$$\\boxed{\\begin{pmatrix} 10.50 & 0.07373 \\end{pmatrix}}$$"
        },
        {
            "introduction": "While the Risk Ratio provides a single number, its value can be highly sensitive to the precise definition of the extreme event. In this computational practice , you will implement a routine to explore this sensitivity by calculating the $RR$ across a sweep of different event thresholds. This exercise highlights the importance of robust analysis and introduces methods for handling a common challenge: what to conclude when an event is observed in the factual world but is so rare it does not occur in the counterfactual model simulations.",
            "id": "3864390",
            "problem": "A region-scale event attribution study considers heavy precipitation exceeding a fixed daily threshold as the event of interest. You are given two finite ensembles of daily precipitation realizations in millimeters per day (mm/day): one representing the factual climate ($F$) with all observed forcings, and another representing the counterfactual climate ($C$) with anthropogenic forcings removed. The goal is to compute the risk ratio across a sweep of thresholds and examine sensitivity to threshold choice.\n\nStarting from the fundamental definition of probability as the expectation of an indicator function, the probability of an event $E$ under climate state $S \\in \\{F, C\\}$ can be defined as $P_S(E) = \\mathbb{E}_S[\\mathbb{I}(X \\in E)]$, where $X$ is a daily precipitation random variable and $\\mathbb{I}(\\cdot)$ is the indicator function. For a threshold $\\tau$ (in mm/day), define the heavy-precipitation event $E_{\\tau} = \\{x \\in \\mathbb{R} : x \\ge \\tau\\}$. Given a finite ensemble $x_{1:S}, x_{2:S}, \\ldots, x_{n_S:S}$, the empirical probability of exceedance is the sample mean of the indicator values. The risk ratio is then the ratio of the factual exceedance probability to the counterfactual exceedance probability for the same threshold, and the sensitivity is assessed by sweeping over multiple thresholds.\n\nYou must implement a program that, for each provided test case, performs the following steps:\n- Compute the empirical exceedance probability under the factual ensemble $F$ at each threshold $\\tau$ as the fraction of entries greater than or equal to $\\tau$.\n- Compute the empirical exceedance probability under the counterfactual ensemble $C$ at each threshold $\\tau$ as the fraction of entries greater than or equal to $\\tau$.\n- Compute the risk ratio $RR(\\tau)$ as the factual exceedance probability divided by the counterfactual exceedance probability at the same threshold.\n- Edge-case handling must follow these rules:\n  - If the counterfactual exceedance probability is zero and the factual exceedance probability is strictly positive, return $+\\infty$ for $RR(\\tau)$.\n  - If both the factual and counterfactual exceedance probabilities are zero, return Not a Number ($\\mathrm{NaN}$) for $RR(\\tau)$.\n  - If the factual exceedance probability is zero and the counterfactual exceedance probability is strictly positive, return $0$ for $RR(\\tau)$.\n\nAll thresholds must be treated as mm/day. The risk ratio is dimensionless and should be returned as floating-point numbers.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test caseâ€™s risk ratios across thresholds appear as a comma-separated list enclosed in its own square brackets, all concatenated into the final top-level list. For example, the output format must be like $[[r_{1,1}, r_{1,2}], [r_{2,1}, r_{2,2}]]$, but with the actual computed values.\n\nUse the following test suite, which covers a general case, equality of probabilities, and edge cases including zero exceedance probabilities. All precipitation values are in mm/day, and all thresholds are in mm/day:\n\n- Test Case $1$ (general case with higher factual extremes):\n  - Factual ensemble $F_1$: $[0, 5, 12, 35, 60, 85, 110, 20, 0, 40, 95, 10]$\n  - Counterfactual ensemble $C_1$: $[0, 3, 8, 25, 40, 55, 70, 15, 0, 30, 60, 8]$\n  - Threshold sweep $\\Tau_1$: $[20, 50, 80, 100]$\n\n- Test Case $2$ (near equality across climates):\n  - Factual ensemble $F_2$: $[2, 7, 15, 18, 22, 30, 45, 50, 5, 12]$\n  - Counterfactual ensemble $C_2$: $[3, 6, 16, 17, 21, 28, 47, 52, 4, 13]$\n  - Threshold sweep $\\Tau_2$: $[5, 25, 60]$\n\n- Test Case $3$ (factual exhibits heavier tail leading to infinite ratios at higher thresholds):\n  - Factual ensemble $F_3$: $[0, 20, 45, 70, 95, 130, 5, 35]$\n  - Counterfactual ensemble $C_3$: $[0, 10, 25, 40, 55, 70, 5, 20]$\n  - Threshold sweep $\\Tau_3$: $[40, 90, 130]$\n\n- Test Case $4$ (both climates largely dry, edge-case with both probabilities zero):\n  - Factual ensemble $F_4$: $[0, 0, 0, 1, 2]$\n  - Counterfactual ensemble $C_4$: $[0, 0, 0, 1, 2]$\n  - Threshold sweep $\\Tau_4$: $[1, 5]$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each inner list contains the risk ratios for its test case in the same order as the thresholds. The required final output format is $[[r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}], [r_{2,1}, r_{2,2}, r_{2,3}], [r_{3,1}, r_{3,2}, r_{3,3}], [r_{4,1}, r_{4,2}]]$ with $r_{i,j}$ being floating-point numbers (including possible $+\\infty$ and $\\mathrm{NaN}$ where applicable).",
            "solution": "The problem is valid. It is scientifically grounded in the principles of climate science and statistics, specifically in the domain of extreme event attribution. The problem is well-posed, providing all necessary data, clear definitions, and an unambiguous computational procedure, including the handling of edge cases. The definitions of empirical probability and risk ratio are standard in the field.\n\nThe objective is to compute the risk ratio, $RR(\\tau)$, for heavy precipitation events across a series of thresholds, $\\tau$. This ratio quantifies the change in the probability of an extreme event between a factual climate (with anthropogenic forcings) and a counterfactual climate (without them).\n\nThe fundamental definition of probability for an event $E$ under a climate state $S$ is given by the expectation of an indicator function: $P_S(E) = \\mathbb{E}_S[\\mathbb{I}(X \\in E)]$, where $X$ is the random variable of interest (daily precipitation) and $\\mathbb{I}(\\cdot)$ is the indicator function, which is $1$ if its argument is true and $0$ otherwise. The event of interest is daily precipitation exceeding a threshold $\\tau$, denoted $E_{\\tau} = \\{x \\in \\mathbb{R} : x \\ge \\tau\\}$.\n\nGiven a finite ensemble of $n_S$ realizations from a climate state $S$, $\\{x_{1,S}, x_{2,S}, \\ldots, x_{n_S,S}\\}$, the expectation is estimated by the sample mean. The empirical probability of exceedance is therefore the fraction of ensemble members that meet or exceed the threshold:\n$$\nP_S(X \\ge \\tau) = \\frac{1}{n_S} \\sum_{i=1}^{n_S} \\mathbb{I}(x_{i,S} \\ge \\tau) = \\frac{\\text{count of } x_i \\text{ such that } x_i \\ge \\tau}{n_S}\n$$\nLet $P_F(\\tau)$ be the exceedance probability for the factual ensemble $F$ and $P_C(\\tau)$ be the exceedance probability for the counterfactual ensemble $C$. The risk ratio at threshold $\\tau$ is defined as:\n$$\nRR(\\tau) = \\frac{P_F(\\tau)}{P_C(\\tau)}\n$$\nThe computational procedure for a given test case, consisting of a factual ensemble $F$, a counterfactual ensemble $C$, and a set of thresholds $\\Tau$, is as follows. For each threshold $\\tau \\in \\Tau$:\n$1$. Calculate the number of values in $F$ that are greater than or equal to $\\tau$, let this be $N_F(\\tau)$.\n$2$. Calculate the factual probability $P_F(\\tau) = \\frac{N_F(\\tau)}{n_F}$, where $n_F$ is the total number of members in ensemble $F$.\n$3$. Calculate the number of values in $C$ that are greater than or equal to $\\tau$, let this be $N_C(\\tau)$.\n$4$. Calculate the counterfactual probability $P_C(\\tau) = \\frac{N_C(\\tau)}{n_C}$, where $n_C$ is the total number of members in ensemble $C$.\n$5$. Compute the risk ratio $RR(\\tau)$ based on the values of $P_F(\\tau)$ and $P_C(\\tau)$ by applying the specified rules for division and edge cases:\n    - If $P_C(\\tau) > 0$, then $RR(\\tau) = \\frac{P_F(\\tau)}{P_C(\\tau)}$. This case covers both $P_F(\\tau) > 0$ and $P_F(\\tau) = 0$ (which yields $RR(\\tau)=0$).\n    - If $P_C(\\tau) = 0$ and $P_F(\\tau) > 0$, the event is impossible in the counterfactual but possible in the factual climate. This implies an infinitely large increase in risk, so $RR(\\tau) = +\\infty$.\n    - If $P_C(\\tau) = 0$ and $P_F(\\tau) = 0$, the event is not observed in either finite ensemble. The ratio $\\frac{0}{0}$ is indeterminate, signifying that there is insufficient data to quantify the change in risk. Thus, $RR(\\tau) = \\mathrm{NaN}$ (Not a Number).\n\nLet us walk through Test Case $1$ as an example:\n- Factual ensemble $F_1 = [0, 5, 12, 35, 60, 85, 110, 20, 0, 40, 95, 10]$. The size is $n_F = 12$.\n- Counterfactual ensemble $C_1 = [0, 3, 8, 25, 40, 55, 70, 15, 0, 30, 60, 8]$. The size is $n_C = 12$.\n- Thresholds $\\Tau_1 = [20, 50, 80, 100]$.\n\nFor $\\tau = 20$:\n- Exceedances in $F_1$: $\\{35, 60, 85, 110, 20, 40, 95\\}$. Count $N_F(20) = 7$. $P_F(20) = \\frac{7}{12}$.\n- Exceedances in $C_1$: $\\{25, 40, 55, 70, 30, 60\\}$. Count $N_C(20) = 6$. $P_C(20) = \\frac{6}{12}$.\n- $RR(20) = \\frac{7/12}{6/12} = \\frac{7}{6} \\approx 1.167$.\n\nFor $\\tau = 50$:\n- Exceedances in $F_1$: $\\{60, 85, 110, 95\\}$. Count $N_F(50) = 4$. $P_F(50) = \\frac{4}{12}$.\n- Exceedances in $C_1$: $\\{55, 70, 60\\}$. Count $N_C(50) = 3$. $P_C(50) = \\frac{3}{12}$.\n- $RR(50) = \\frac{4/12}{3/12} = \\frac{4}{3} \\approx 1.333$.\n\nFor $\\tau = 80$:\n- Exceedances in $F_1$: $\\{85, 110, 95\\}$. Count $N_F(80) = 3$. $P_F(80) = \\frac{3}{12}$.\n- Exceedances in $C_1$: None. Count $N_C(80) = 0$. $P_C(80) = \\frac{0}{12} = 0$.\n- Since $P_F(80) > 0$ and $P_C(80) = 0$, $RR(80) = +\\infty$.\n\nFor $\\tau = 100$:\n- Exceedances in $F_1$: $\\{110\\}$. Count $N_F(100) = 1$. $P_F(100) = \\frac{1}{12}$.\n- Exceedances in $C_1$: None. Count $N_C(100) = 0$. $P_C(100) = \\frac{0}{12} = 0$.\n- Since $P_F(100) > 0$ and $P_C(100) = 0$, $RR(100) = +\\infty$.\n\nThe final list of risk ratios for Test Case $1$ is $[\\frac{7}{6}, \\frac{4}{3}, +\\infty, +\\infty]$. The implementation will use floating-point representations for these values. The same procedure is applied to all other test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the risk ratio for heavy precipitation events across multiple thresholds\n    for a series of test cases, each with a factual and a counterfactual climate ensemble.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each test case is a tuple: (Factual_Ensemble, Counterfactual_Ensemble, Threshold_Sweep)\n    test_cases = [\n        # Test Case 1 (general case with higher factual extremes)\n        ([0, 5, 12, 35, 60, 85, 110, 20, 0, 40, 95, 10],\n         [0, 3, 8, 25, 40, 55, 70, 15, 0, 30, 60, 8],\n         [20, 50, 80, 100]),\n        \n        # Test Case 2 (near equality across climates)\n        ([2, 7, 15, 18, 22, 30, 45, 50, 5, 12],\n         [3, 6, 16, 17, 21, 28, 47, 52, 4, 13],\n         [5, 25, 60]),\n         \n        # Test Case 3 (factual exhibits heavier tail leading to infinite ratios)\n        ([0, 20, 45, 70, 95, 130, 5, 35],\n         [0, 10, 25, 40, 55, 70, 5, 20],\n         [40, 90, 130]),\n         \n        # Test Case 4 (both climates largely dry, edge-case with both probabilities zero)\n        ([0, 0, 0, 1, 2],\n         [0, 0, 0, 1, 2],\n         [1, 5])\n    ]\n\n    all_results = []\n    for f_ensemble, c_ensemble, thresholds in test_cases:\n        # Convert lists to NumPy arrays for efficient vectorized operations\n        f_array = np.array(f_ensemble, dtype=float)\n        c_array = np.array(c_ensemble, dtype=float)\n        \n        n_f = len(f_array)\n        n_c = len(c_array)\n        \n        case_results = []\n        for tau in thresholds:\n            # Compute the number of exceedances for the factual ensemble\n            n_exceed_f = np.sum(f_array >= tau)\n            # Compute the empirical exceedance probability for the factual ensemble\n            p_f = n_exceed_f / n_f\n            \n            # Compute the number of exceedances for the counterfactual ensemble\n            n_exceed_c = np.sum(c_array >= tau)\n            # Compute the empirical exceedance probability for the counterfactual ensemble\n            p_c = n_exceed_c / n_c\n            \n            # Compute the risk ratio (RR) with specified edge-case handling\n            if p_c == 0.0:\n                if p_f > 0.0:\n                    # Counterfactual prob = 0, Factual prob > 0 -> infinite risk\n                    rr = np.inf\n                else: # p_f is also 0.0\n                    # Both probabilities are 0 -> Indeterminate (0/0)\n                    rr = np.nan\n            else:\n                # Standard case, including when p_f is 0 and p_c > 0 (results in 0.0)\n                rr = p_f / p_c\n                \n            case_results.append(rr)\n        \n        all_results.append(case_results)\n\n    # Format the final output string as a list of lists.\n    # This involves creating a string representation for each inner list\n    # and then joining them together.\n    inner_list_strings = []\n    for result_list in all_results:\n        # Convert each number (including inf/nan) to its string representation\n        str_results = [str(r) for r in result_list]\n        # Join them with commas and enclose in brackets\n        inner_list_strings.append(f\"[{','.join(str_results)}]\")\n    \n    # Join the inner list strings with commas and enclose in top-level brackets\n    final_output_string = f\"[{','.join(inner_list_strings)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "To move beyond simple event counting, we can use statistical models to describe the behavior of extremes. Extreme Value Theory (EVT) provides a powerful framework for this, often using the Generalized Extreme Value (GEV) distribution. This practice  challenges you to derive the analytical link between a systematic climate shift (modeled as a change in the GEV location parameter $\\Delta\\mu$) and the resulting change in an event's return period. This derivation beautifully illustrates how a seemingly small change in the average climate can lead to dramatic changes in the frequency of rare events.",
            "id": "4041693",
            "problem": "Consider a sequence of annual block maxima $\\{X_{1}, X_{2}, \\dots, X_{n}\\}$ for a climate variable (e.g., annual maximum daily precipitation), modeled as independent and identically distributed draws from the Generalized Extreme Value (GEV) distribution with location parameter $\\mu$, scale parameter $\\sigma>0$, and shape parameter $\\xi \\neq 0$. The cumulative distribution function of the GEV for a value $x$ is given by\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\ndefined for values of $x$ such that $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$. Let $z$ be the baseline return level such that the one-year exceedance probability under the baseline climate is $P(X > z) = \\frac{1}{T_{b}}$, where $T_{b} > 1$ is the baseline return period in years.\n\nSuppose that under a perturbed climate state attributable to a systematic forcing, the location parameter shifts to $\\mu' = \\mu + \\Delta\\mu$, while $\\sigma$ and $\\xi$ remain unchanged. Assume that years remain independent and that the threshold $z$ is fixed at its baseline value. Using only the definition of the expected value and the GEV cumulative distribution function, derive an exact expression for:\n- the expected number of exceedances above $z$ in the next $n$ years under the perturbed climate, and\n- the perturbed return period $T'$ (in years) associated with threshold $z$ under the perturbed climate.\n\nExpress your final answer in a single closed-form expression in terms of $n$, $T_{b}$, $\\sigma$, $\\xi$, and $\\Delta\\mu$. You must state and use any domain conditions required for validity (e.g., positivity constraints for the GEV support), but your final boxed answer must not include these conditions. No numerical approximation or rounding is required, and no physical units should be included in the final boxed expression.",
            "solution": "The Generalized Extreme Value (GEV) distribution describes block maxima with cumulative distribution function\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\ndefined on the support where $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$. For a fixed threshold $z$, the per-year exceedance probability under parameters $(\\mu, \\sigma, \\xi)$ is\n$$\np(\\mu) \\equiv P(X > z) \\;=\\; 1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\nagain with the domain restriction $1 + \\xi\\,\\frac{z-\\mu}{\\sigma} > 0$.\n\nBy the definition of the return period, the baseline condition $P(X > z) = 1/T_{b}$ implies\n$$\n1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; \\frac{1}{T_{b}}\n\\;\\;\\Longrightarrow\\;\\;\nG(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\frac{1}{T_{b}}.\n$$\nUsing the GEV cumulative distribution function, we have\n$$\n\\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\n\\;=\\;\n1 - \\frac{1}{T_{b}}.\n$$\nTaking the natural logarithm on both sides yields\n$$\n-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right),\n$$\nso\n$$\n\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right).\n$$\nDefine the positive quantity (for $T_{b} > 1$)\n$$\nA \\;\\equiv\\; -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right) \\;>\\; 0.\n$$\nThen\n$$\n1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi},\n$$\nand consequently\n$$\nz - \\mu\n\\;=\\;\n\\frac{\\sigma}{\\xi}\\,\\Big(A^{-\\xi} - 1\\Big).\n$$\n\nUnder the perturbed climate with location parameter $\\mu' = \\mu + \\Delta\\mu$ (and unchanged $\\sigma$ and $\\xi$), the per-year exceedance probability for the same threshold $z$ becomes\n$$\np' \\;\\equiv\\; P(X > z \\,|\\, \\mu') \\;=\\; 1 - G\\big(z; \\mu + \\Delta\\mu, \\sigma, \\xi\\big)\n\\;=\\;\n1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\nwith the perturbed support condition\n$$\n1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma} \\;>\\; 0.\n$$\nUsing the expression for $z - \\mu$ found above,\n$$\n1 + \\xi\\,\\frac{z - (\\mu + \\Delta\\mu)}{\\sigma}\n\\;=\\;\n1 + \\xi\\,\\frac{(z-\\mu) - \\Delta\\mu}{\\sigma}\n\\;=\\;\n\\left(1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right) - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}.\n$$\nTherefore,\n$$\np' \\;=\\; 1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\nvalid when $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$ (to keep the perturbed threshold within the GEV support).\n\nThe expected number of exceedances over $n$ independent years under the perturbed climate is, by linearity of expectation and independence,\n$$\nE' \\;=\\; n\\,p' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}.\n$$\n\nThe perturbed return period $T'$ for threshold $z$ is defined as the reciprocal of the per-year exceedance probability,\n$$\nT' \\;=\\; \\frac{1}{p'}\n\\;=\\;\n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1}.\n$$\n\nSummarizing, with $A = -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)$, the exact expressions are\n$$\nE' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\},\n\\qquad\nT' \\;=\\; \\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1},\n$$\nsubject to the domain condition $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$ ensuring that the threshold $z$ lies within the support under the perturbed climate. These formulas explicitly connect a location shift $\\Delta\\mu$ to changes in the expected exceedance count over $n$ years and the corresponding return period under the GEV framework.",
            "answer": "$$\\boxed{\\begin{pmatrix}\nn\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right] &\n\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right]^{-1}\n\\end{pmatrix}}$$"
        }
    ]
}