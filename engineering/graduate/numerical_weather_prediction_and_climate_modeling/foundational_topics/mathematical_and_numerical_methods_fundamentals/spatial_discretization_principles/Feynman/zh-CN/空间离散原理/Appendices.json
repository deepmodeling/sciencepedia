{
    "hands_on_practices": [
        {
            "introduction": "在球坐标系（如经纬度网格）上进行离散化与在笛卡尔坐标系上有着本质的不同。在球面上，坐标线之间的物理距离会随位置（特别是纬度）变化。本练习将引导你推导一个基本算子——梯度——的离散形式，并正确地考虑进球面几何带来的度量因子，这是正确离散更复杂的动力学方程的关键第一步。",
            "id": "4091166",
            "problem": "考虑在数值天气预报和气候模拟中使用的球形地球的全球经纬度离散化，其中地球的平均半径用 $a$ 表示。计算网格定义在角坐标 $(\\lambda,\\phi)$ 上，其中 $\\lambda$ 是经度，$\\phi$ 是纬度，两者均以弧度为单位。该网格是均匀间隔的，经度方向的角度步长为 $\\Delta \\lambda$，纬度方向的角度步长为 $\\Delta \\phi$。假设一个标量场 $q(\\lambda,\\phi)$ 在网格点 $(\\lambda_i,\\phi_j)$ 上被采样，其离散值记为 $q_{i,j} = q(\\lambda_i,\\phi_j)$。假设 $(\\lambda_i,\\phi_j)$ 是一个不位于极点的内部点（因此 $\\cos\\phi_j \\neq 0$）。\n\n从地球的球面几何形状以及正交曲线坐标系中梯度的定义出发，推导在 $(\\lambda_i,\\phi_j)$ 点处 $q$ 的水平梯度的二阶精确离散近似，该近似应正确考虑球面度规。你的推导应基于球面上的线元，\n$$\n\\mathrm{d}\\ell^{2} = a^{2}\\cos^{2}\\phi\\,\\mathrm{d}\\lambda^{2} + a^{2}\\,\\mathrm{d}\\phi^{2},\n$$\n以及根据沿正交坐标线的方向导数所定义的梯度。使用中心差分来近似 $(\\lambda_i,\\phi_j)$ 点处 $q$ 的必要偏导数。\n\n将你的最终答案表示为一个二分量行向量，分别给出 $(\\lambda_i,\\phi_j)$ 点处离散梯度的东向（沿 $\\lambda$ 增大的方向）和北向（沿 $\\phi$ 增大的方向）分量，仅用 $a$、$\\phi_j$、$\\Delta \\lambda$、$\\Delta \\phi$ 以及 $q$ 的相邻网格值来表示。角度量使用弧度， $a$ 使用米，这样梯度的分量单位就是标量/米。最终答案必须是如上所述的单个闭式解析表达式。不需要四舍五入。",
            "solution": "该问题是有效的。它在微分几何和数值分析方面有科学依据，信息充分，表述客观。我们将着手推导解答。\n\n曲面上标量场 $q$ 的水平梯度是一个矢量场，其指向 $q$ 增长率最大的方向，其大小等于该变化率。对于一个正交曲线坐标系 $(u_1, u_2)$，梯度由下式给出：\n$$\n\\nabla q = \\frac{1}{h_1} \\frac{\\partial q}{\\partial u_1} \\hat{\\mathbf{e}}_1 + \\frac{1}{h_2} \\frac{\\partial q}{\\partial u_2} \\hat{\\mathbf{e}}_2\n$$\n其中 $\\hat{\\mathbf{e}}_1$ 和 $\\hat{\\mathbf{e}}_2$ 分别是沿 $u_1$ 和 $u_2$ 增加方向的单位矢量，而 $h_1$ 和 $h_2$ 是度规尺度因子。尺度因子由微分线元 $\\mathrm{d}\\ell$ 定义，使得两个无穷小近点之间的距离平方为 $\\mathrm{d}\\ell^2 = (h_1 \\mathrm{d}u_1)^2 + (h_2 \\mathrm{d}u_2)^2$。\n\n问题给出了半径为 $a$ 的球面上使用经度 $\\lambda$ 和纬度 $\\phi$ 作为坐标的线元：\n$$\n\\mathrm{d}\\ell^2 = a^2 \\cos^2\\phi \\, \\mathrm{d}\\lambda^2 + a^2 \\, \\mathrm{d}\\phi^2\n$$\n在这里，我们的坐标是 $u_1 = \\lambda$ 和 $u_2 = \\phi$。通过将其与线元的一般形式进行比较，我们可以确定尺度因子。东向对应于 $\\lambda$ 的增加，北向对应于 $\\phi$ 的增加。\n\n对应于经向位移的项是 $(h_\\lambda \\mathrm{d}\\lambda)^2 = a^2 \\cos^2\\phi \\, \\mathrm{d}\\lambda^2$。这给出了经度坐标的尺度因子为：\n$$\nh_\\lambda = a \\cos\\phi\n$$\n对应于纬向位移的项是 $(h_\\phi \\mathrm{d}\\phi)^2 = a^2 \\, \\mathrm{d}\\phi^2$。这给出了纬度坐标的尺度因子为：\n$$\nh_\\phi = a\n$$\n这些尺度因子将角坐标的变化 $(\\mathrm{d}\\lambda, \\mathrm{d}\\phi)$ 与球体表面上的物理距离联系起来。东向的微分位移是 $\\mathrm{d}x = h_\\lambda \\mathrm{d}\\lambda = a \\cos\\phi \\, \\mathrm{d}\\lambda$，北向的微分位移是 $\\mathrm{d}y = h_\\phi \\mathrm{d}\\phi = a \\, \\mathrm{d}\\phi$。\n\n将这些坐标和尺度因子代入梯度的一般公式，我们得到球面上水平梯度的表达式：\n$$\n\\nabla q = \\frac{1}{h_\\lambda} \\frac{\\partial q}{\\partial \\lambda} \\hat{\\mathbf{e}}_\\lambda + \\frac{1}{h_\\phi} \\frac{\\partial q}{\\partial \\phi} \\hat{\\mathbf{e}}_\\phi = \\frac{1}{a \\cos\\phi} \\frac{\\partial q}{\\partial \\lambda} \\hat{\\mathbf{e}}_\\lambda + \\frac{1}{a} \\frac{\\partial q}{\\partial \\phi} \\hat{\\mathbf{e}}_\\phi\n$$\n其中 $\\hat{\\mathbf{e}}_\\lambda$ 是指向东方的单位矢量，$\\hat{\\mathbf{e}}_\\phi$ 是指向北方的单位矢量。梯度矢量的两个分量是东向分量 $(\\nabla q)_\\lambda$ 和北向分量 $(\\nabla q)_\\phi$：\n$$\n(\\nabla q)_\\lambda = \\frac{1}{a \\cos\\phi} \\frac{\\partial q}{\\partial \\lambda}\n$$\n$$\n(\\nabla q)_\\phi = \\frac{1}{a} \\frac{\\partial q}{\\partial \\phi}\n$$\n这些分量的单位是标量 $q$ 每单位距离（米），符合要求。\n\n下一步是在网格点 $(\\lambda_i, \\phi_j)$ 处，使用二阶精确的有限差分格式来近似偏导数 $\\frac{\\partial q}{\\partial \\lambda}$ 和 $\\frac{\\partial q}{\\partial \\phi}$。问题指定使用中心差分。函数 $f(x)$ 在 $x_i$ 处的一阶导数的中心差分近似由 $\\frac{f(x_i+\\Delta x) - f(x_i-\\Delta x)}{2\\Delta x}$ 给出，该近似对于 $\\Delta x$ 是二阶精确的。\n\n对于在 $(\\lambda_i, \\phi_j)$ 点处关于经度 $\\lambda$ 的偏导数，我们使用东西方向上相邻网格点 $(\\lambda_{i+1}, \\phi_j)$ 和 $(\\lambda_{i-1}, \\phi_j)$ 处的 $q$ 值。这里，$\\lambda_{i+1} = \\lambda_i + \\Delta\\lambda$ 且 $\\lambda_{i-1} = \\lambda_i - \\Delta\\lambda$。离散值为 $q_{i+1,j}$ 和 $q_{i-1,j}$。中心差分近似为：\n$$\n\\frac{\\partial q}{\\partial \\lambda}\\bigg|_{i,j} \\approx \\frac{q(\\lambda_i+\\Delta\\lambda, \\phi_j) - q(\\lambda_i-\\Delta\\lambda, \\phi_j)}{2\\Delta\\lambda} = \\frac{q_{i+1,j} - q_{i-1,j}}{2\\Delta\\lambda}\n$$\n类似地，对于在 $(\\lambda_i, \\phi_j)$ 点处关于纬度 $\\phi$ 的偏导数，我们使用南北方向上相邻网格点 $(\\lambda_i, \\phi_{j+1})$ 和 $(\\lambda_i, \\phi_{j-1})$ 处的 $q$ 值。这里，$\\phi_{j+1} = \\phi_j + \\Delta\\phi$ 且 $\\phi_{j-1} = \\phi_j - \\Delta\\phi$。离散值为 $q_{i,j+1}$ 和 $q_{i,j-1}$。中心差分近似为：\n$$\n\\frac{\\partial q}{\\partial \\phi}\\bigg|_{i,j} \\approx \\frac{q(\\lambda_i, \\phi_j+\\Delta\\phi) - q(\\lambda_i, \\phi_j-\\Delta\\phi)}{2\\Delta\\phi} = \\frac{q_{i,j+1} - q_{i,j-1}}{2\\Delta\\phi}\n$$\n现在，我们将这些离散近似代入梯度分量的表达式中，并在纬度 $\\phi_j$ 处计算尺度因子。问题指出 $\\cos\\phi_j \\neq 0$，这确保了经向尺度因子是良定义的。\n\n在 $(\\lambda_i, \\phi_j)$ 点处离散梯度的东向分量是：\n$$\n(\\nabla_h q)_{i,j, \\lambda} = \\frac{1}{a \\cos\\phi_j} \\left( \\frac{q_{i+1,j} - q_{i-1,j}}{2\\Delta\\lambda} \\right) = \\frac{q_{i+1,j} - q_{i-1,j}}{2a \\Delta\\lambda \\cos\\phi_j}\n$$\n在 $(\\lambda_i, \\phi_j)$ 点处离散梯度的北向分量是：\n$$\n(\\nabla_h q)_{i,j, \\phi} = \\frac{1}{a} \\left( \\frac{q_{i,j+1} - q_{i,j-1}}{2\\Delta\\phi} \\right) = \\frac{q_{i,j+1} - q_{i,j-1}}{2a \\Delta\\phi}\n$$\n问题要求将结果表示为一个代表离散水平梯度 $(\\nabla_h q)_{i,j}$ 的二分量行向量。结合这两个分量即可得到最终表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{q_{i+1,j} - q_{i-1,j}}{2a \\Delta\\lambda \\cos\\phi_j}  \\frac{q_{i,j+1} - q_{i,j-1}}{2a \\Delta\\phi}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "上一个练习阐明了如何正确地包含度量因子，但如果我们忽略它们会发生什么呢？这个编程实践将通过一个实际例子，展示为何在离散化过程中必须严格遵守几何原理。你将量化一个忽略了度量因子的“简化”格式如何导致其违反基本的质量守恒定律，从而突显出为何这对于构建稳定且物理真实的长期气候模拟是不可或缺的。",
            "id": "4091097",
            "problem": "考虑球形地球上的一个二维水平无辐散流，以及一个地表质量密度场在平流作用下的演变。背景为数值天气预报 (NWP) 和气候模拟，其中球面几何需要度量项来确保离散守恒。您将评估在球面离散化中忽略度量项的后果，并量化在单个显式时间步后，由此产生的全球质量守恒误差。\n\n基本原理：\n- 封闭曲面上的质量守恒定律指出，在平流作用下总质量是守恒的。设地球半径为 $a$（单位：米），经度为 $\\lambda$（单位：弧度），纬度为 $\\phi$（单位：弧度），地表质量密度为 $\\rho(\\lambda,\\phi)$（单位：千克/平方米），水平速度为 $\\mathbf{u}(\\lambda,\\phi) = (u_\\lambda(\\lambda,\\phi),u_\\phi(\\lambda,\\phi))$（单位：米/秒）。球面上的通量形式连续性方程为\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{1}{a\\cos\\phi}\\left[\\frac{\\partial}{\\partial \\lambda}\\left(\\rho\\,u_\\lambda\\right) + \\frac{\\partial}{\\partial \\phi}\\left(\\rho\\,u_\\phi\\,\\cos\\phi\\right)\\right] = 0.\n$$\n- 全球总质量为\n$$\nM = \\int_{-\\pi}^{\\pi}\\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} \\rho(\\lambda,\\phi)\\, a^2 \\cos\\phi \\, d\\phi \\, d\\lambda.\n$$\n\n离散化原则：\n- 在经纬度网格上使用有限体积离散化。网格中心位于 $(\\lambda_i,\\phi_j)$，具有均匀的间距 $\\Delta\\lambda$ 和 $\\Delta\\phi$（单位：弧度）。物理网格面积为\n$$\nA_{j} = a^2 \\cos\\phi_j \\, \\Delta\\lambda \\, \\Delta\\phi.\n$$\n- 网格单元的边长为：\n  - 经向边（$\\lambda_i$ 和 $\\lambda_{i+1}$ 之间）的长度为\n  $$L_{\\lambda} = a\\,\\Delta\\phi.$$\n  - 纬向边（$\\phi_j$ 和 $\\phi_{j+1}$ 之间）的长度为\n  $$L_{\\phi}^{\\text{metric}}(\\phi_{j+\\frac{1}{2}}) = a\\,\\cos(\\phi_{j+\\frac{1}{2}})\\,\\Delta\\lambda.$$\n- 对于忽略度量项的错误格式，使用\n$$\nA_{j}^{\\text{wrong}} = a^2\\,\\Delta\\lambda\\,\\Delta\\phi,\\qquad L_{\\phi}^{\\text{wrong}} = a\\,\\Delta\\lambda,\n$$\n并保持 $L_{\\lambda}$ 不变。这模拟了一个常见的错误，即省略了 $\\cos\\phi$。\n\n速度设定：\n- 使用流函数 $\\psi(\\lambda,\\phi)$（单位：平方米/秒）构建一个水平无辐散流：\n$$\n\\psi(\\lambda,\\phi) = \\Psi_0 \\,\\sin(\\lambda)\\,\\cos^2\\phi,\n$$\n其中 $\\Psi_0$ 是一个常数振幅。相应的速度分量为\n$$\nu_\\lambda(\\lambda,\\phi) = -\\frac{1}{a\\cos\\phi}\\frac{\\partial \\psi}{\\partial \\phi} = \\frac{2\\Psi_0}{a}\\,\\sin\\phi\\,\\sin\\lambda,\\qquad\nu_\\phi(\\lambda,\\phi) = \\frac{1}{a}\\frac{\\partial \\psi}{\\partial \\lambda} = \\frac{\\Psi_0}{a}\\,\\cos\\lambda\\,\\cos^2\\phi.\n$$\n\n初始质量密度：\n- 使用一个物理上合理、空间上变化的场\n$$\n\\rho(\\lambda,\\phi) = \\rho_0 \\left[ 1 + \\beta \\,\\sin\\phi + \\gamma \\,\\cos(2\\lambda)\\,\\cos^2\\phi \\right],\n$$\n其中 $\\rho_0$（单位：千克/平方米）是一个恒定的参考地表质量密度，$\\beta$ 和 $\\gamma$ 是无量纲振幅。\n\n离散通量与更新：\n- 使用中心平均定义边心通量。在网格单元 $i$ 和 $i+1$ 之间的经向边上，取\n$$\n(\\rho u_\\lambda)_{i+\\frac{1}{2},j} = \\frac{1}{2}\\left(\\rho_{i,j}\\,u_{\\lambda,i,j} + \\rho_{i+1,j}\\,u_{\\lambda,i+1,j}\\right),\n$$\n穿过该边的积分通量为\n$$\nF_{\\lambda,i+\\frac{1}{2},j} = (\\rho u_\\lambda)_{i+\\frac{1}{2},j}\\, L_{\\lambda}.\n$$\n- 在网格单元 $j$ 和 $j+1$ 之间的纬向边上，取\n$$\n(\\rho u_\\phi)_{i,j+\\frac{1}{2}} = \\frac{1}{2}\\left(\\rho_{i,j}\\,u_{\\phi,i,j} + \\rho_{i,j+1}\\,u_{\\phi,i,j+1}\\right),\n$$\n对于正确的度量项格式，穿过该边的积分通量为\n$$\nF_{\\phi,i,j+\\frac{1}{2}}^{\\text{metric}} = (\\rho u_\\phi)_{i,j+\\frac{1}{2}}\\, L_{\\phi}^{\\text{metric}}(\\phi_{j+\\frac{1}{2}}),\n$$\n而对于忽略度量项的错误格式，使用\n$$\nF_{\\phi,i,j+\\frac{1}{2}}^{\\text{wrong}} = (\\rho u_\\phi)_{i,j+\\frac{1}{2}}\\, L_{\\phi}^{\\text{wrong}}.\n$$\n- 使用前向欧拉步在时间步长 $\\Delta t$（单位：秒）上更新 $\\rho$。对于正确的度量项格式：\n$$\n\\rho_{i,j}^{n+1} = \\rho_{i,j}^{n} - \\frac{\\Delta t}{A_{j}}\\left[ F_{\\lambda,i+\\frac{1}{2},j} - F_{\\lambda,i-\\frac{1}{2},j} + F_{\\phi,i,j+\\frac{1}{2}}^{\\text{metric}} - F_{\\phi,i,j-\\frac{1}{2}}^{\\text{metric}} \\right].\n$$\n对于错误的格式：\n$$\n\\rho_{i,j}^{n+1,\\text{wrong}} = \\rho_{i,j}^{n} - \\frac{\\Delta t}{A_{j}^{\\text{wrong}}}\\left[ F_{\\lambda,i+\\frac{1}{2},j} - F_{\\lambda,i-\\frac{1}{2},j} + F_{\\phi,i,j+\\frac{1}{2}}^{\\text{wrong}} - F_{\\phi,i,j-\\frac{1}{2}}^{\\text{wrong}} \\right].\n$$\n\n全球质量与误差度量：\n- 对于两种格式，使用正确的物理面积权重 $A_j$ 计算时间层 $n$ 和 $n+1$ 的物理全球总质量：\n$$\nM^{n} = \\sum_{i,j} \\rho_{i,j}^{n}\\, A_j,\\qquad M^{n+1,\\text{metric}} = \\sum_{i,j} \\rho_{i,j}^{n+1}\\, A_j,\\qquad M^{n+1,\\text{wrong}} = \\sum_{i,j} \\rho_{i,j}^{n+1,\\text{wrong}}\\, A_j.\n$$\n- 将忽略度量项所导致的全球质量守恒误差量化为一步之后的绝对相对变化（一个无量纲小数）：\n$$\nE = \\left| \\frac{M^{n+1,\\text{wrong}} - M^{n}}{M^{n}} \\right|.\n$$\n\n角度单位说明：\n- 所有角度必须以弧度为单位处理。\n\n所有测试用例中使用的物理常数与参数：\n- 地球半径 $a = 6.371\\times 10^{6}$ 米，参考地表质量密度 $\\rho_0 = 1.0\\times 10^{4}$ 千克/平方米，流函数振幅 $\\Psi_0 = 1.0\\times 10^{6}$ 平方米/秒。\n\n测试套件：\n- 提供以下元组形式的测试用例 $(N_\\lambda, N_\\phi, \\Delta t, \\beta, \\gamma)$:\n  1. $N_\\lambda = 72$, $N_\\phi = 36$, $\\Delta t = 600$ 秒, $\\beta = 0.3$, $\\gamma = 0.5$ （一般情况）。\n  2. $N_\\lambda = 12$, $N_\\phi = 6$, $\\Delta t = 600$ 秒, $\\beta = 0.3$, $\\gamma = 0.5$ （粗网格）。\n  3. $N_\\lambda = 72$, $N_\\phi = 36$, $\\Delta t = 3600$ 秒, $\\beta = 0.3$, $\\gamma = 0.5$ （更长的时间步）。\n  4. $N_\\lambda = 72$, $N_\\phi = 36$, $\\Delta t = 600$ 秒, $\\beta = 0.0$, $\\gamma = 0.0$ （均匀密度边界情况）。\n\n您的任务：\n- 按照规定，为正确的度量项格式和错误的格式实现有限体积更新，从相同的初始条件为每个测试用例执行一个前向欧拉步，计算每个用例的 $E$ 值，并返回与测试套件相对应的 $E$ 值列表。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[e_1,e_2,e_3,e_4]$），其中每个 $e_k$ 是测试用例 $k$ 的绝对相对质量变化 $E$（一个小数），按默认浮点表示法四舍五入。",
            "solution": "我们从球面上的质量守恒开始。对于一个没有外部边界通量的封闭球面，无辐散水平流的平流作用会保持全球总质量守恒。球面上的通量形式连续性方程包含由球面几何产生的度量项，特别是在散度算子和物理面积元中都存在 $\\cos\\phi$ 因子。\n\n有限体积法在每个网格单元上对连续性方程进行积分，并应用散度定理，将散度的面积分转换为穿过网格单元边的通量线积分。在球面上，边的长度通过 $\\cos\\phi$ 取决于纬度。物理网格面积为 $A_j = a^2 \\cos\\phi_j\\,\\Delta\\lambda\\,\\Delta\\phi$。经向边的长度为 $L_\\lambda = a\\,\\Delta\\phi$，而纬向边的长度为 $L_\\phi^{\\text{metric}}(\\phi_{j+\\frac{1}{2}}) = a\\,\\cos(\\phi_{j+\\frac{1}{2}})\\,\\Delta\\lambda$。使用中心平均来获取边心质量通量，可确保穿过任何共享边的通量对于两个相邻网格单元来说大小相同，但在其更新中符号相反，当使用正确的度量权重时，这会在全球质量平衡中导致精确抵消。因此，将所有网格单元的局部更新乘以 $A_j$ 后求和，会使内部通量相互抵消为零，只剩下外部边界的贡献。在一个完整的球面上，由于 $\\cos(\\pm \\frac{\\pi}{2}) = 0$，纬向边界的边长在两极处消失，而经度上的周期性边界意味着没有净边界通量。因此，对于单个步骤，正确的度量项格式能够精确地守恒全球质量，误差仅限于舍入误差。\n\n如果忽略度量项，一个常见的不正确做法是像处理笛卡尔网格一样处理该网格：使用与纬度无关的面积 $A_j^{\\text{wrong}} = a^2\\,\\Delta\\lambda\\,\\Delta\\phi$ 和与纬度无关的纬向边长 $L_\\phi^{\\text{wrong}} = a\\,\\Delta\\lambda$，同时保持 $L_\\lambda$ 不变。然后，局部更新将使用这些不正确的几何因子。即使由于中心平均，共享边两侧的边心通量值相等，物理质量变化的全球总和仍使用真实的面积权重 $A_j = a^2 \\cos\\phi_j\\,\\Delta\\lambda\\,\\Delta\\phi$。因子 $A_j/A_j^{\\text{wrong}} = \\cos\\phi_j$ 在跨越纬向边的相邻网格单元之间是不同的。结果，内部通量的贡献在全球总和中不会抵消，从而产生虚假的质量源或汇。这直接体现了忽略球面度量项会破坏局部更新与全球守恒之间的离散一致性。\n\n为了量化这一点，我们使用流函数 $\\psi(\\lambda,\\phi) = \\Psi_0 \\sin\\lambda \\cos^2\\phi$ 构建一个无辐散速度场，其速度分量为 $u_\\lambda = \\frac{2\\Psi_0}{a}\\sin\\phi\\sin\\lambda$ 和 $u_\\phi = \\frac{\\Psi_0}{a}\\cos\\lambda\\cos^2\\phi$。根据设计，该流是水平无辐散的。对于空间变化的密度 $\\rho(\\lambda,\\phi) = \\rho_0\\left[1 + \\beta\\sin\\phi + \\gamma\\cos(2\\lambda)\\cos^2\\phi\\right]$，平流会重新分布质量，但应保持全球积分守恒。正确的度量项格式通过精确的通量抵消实现全球守恒，而错误的格式则产生非零的全球质量变化。\n\n算法步骤：\n1. 定义具有 $N_\\lambda$ 个经度和 $N_\\phi$ 个纬度的网格。网格中心为 $\\lambda_i = -\\pi + (i+\\frac{1}{2})\\Delta\\lambda$（$i=0,\\dots,N_\\lambda-1$）和 $\\phi_j = -\\frac{\\pi}{2} + (j+\\frac{1}{2})\\Delta\\phi$（$j=0,\\dots,N_\\phi-1$）。边所在的纬度为 $\\phi_{j+\\frac{1}{2}} = -\\frac{\\pi}{2} + (j)\\Delta\\phi$（$j=0,\\dots,N_\\phi$）。\n2. 根据给定公式计算网格中心的 $\\rho$、 $u_\\lambda$ 和 $u_\\phi$。\n3. 通过中心平均构建边心质量通量：\n   - 经向边：$(\\rho u_\\lambda)_{i+\\frac{1}{2},j} = \\frac{1}{2}(\\rho u_\\lambda)_{i,j} + \\frac{1}{2}(\\rho u_\\lambda)_{i+1,j}$，具有经向周期性。\n   - 纬向边：$(\\rho u_\\phi)_{i,j+\\frac{1}{2}} = \\frac{1}{2}(\\rho u_\\phi)_{i,j} + \\frac{1}{2}(\\rho u_\\phi)_{i,j+1}$。\n4. 构建积分边通量：\n   - 正确格式：$F_{\\lambda,i+\\frac{1}{2},j} = (\\rho u_\\lambda)_{i+\\frac{1}{2},j}\\, a\\,\\Delta\\phi$, $F_{\\phi,i,j+\\frac{1}{2}}^{\\text{metric}} = (\\rho u_\\phi)_{i,j+\\frac{1}{2}}\\, a\\,\\cos(\\phi_{j+\\frac{1}{2}})\\,\\Delta\\lambda$。\n   - 错误格式：$F_{\\lambda,i+\\frac{1}{2},j}^{\\text{wrong}} = (\\rho u_\\lambda)_{i+\\frac{1}{2},j}\\, a\\,\\Delta\\phi$, $F_{\\phi,i,j+\\frac{1}{2}}^{\\text{wrong}} = (\\rho u_\\phi)_{i,j+\\frac{1}{2}}\\, a\\,\\Delta\\lambda$。\n5. 在一个时间步长 $\\Delta t$ 内更新密度：\n   - 正确格式：$\\rho_{i,j}^{n+1} = \\rho_{i,j}^{n} - \\frac{\\Delta t}{A_j}\\left[F_{\\lambda,i+\\frac{1}{2},j} - F_{\\lambda,i-\\frac{1}{2},j} + F_{\\phi,i,j+\\frac{1}{2}}^{\\text{metric}} - F_{\\phi,i,j-\\frac{1}{2}}^{\\text{metric}}\\right]$。\n   - 错误格式：$\\rho_{i,j}^{n+1,\\text{wrong}} = \\rho_{i,j}^{n} - \\frac{\\Delta t}{A_j^{\\text{wrong}}}\\left[F_{\\lambda,i+\\frac{1}{2},j}^{\\text{wrong}} - F_{\\lambda,i-\\frac{1}{2},j}^{\\text{wrong}} + F_{\\phi,i,j+\\frac{1}{2}}^{\\text{wrong}} - F_{\\phi,i,j-\\frac{1}{2}}^{\\text{wrong}}\\right]$。\n6. 使用 $A_j$ 计算物理全球总质量 $M^n$、 $M^{n+1,\\text{metric}}$ 和 $M^{n+1,\\text{wrong}}$，然后计算错误格式的绝对相对质量变化：\n$$\nE = \\left|\\frac{M^{n+1,\\text{wrong}} - M^{n}}{M^{n}}\\right|.\n$$\n\n测试套件的预期行为：\n- 对于一般情况，错误格式会产生一个虽小但非零的 $E$，表明存在虚假的全球质量变化；正确格式则能在舍入误差范围内保持质量守恒。\n- 粗网格会放大几何不一致性，通常会增加 $E$。\n- 更长的时间步会因输运量更大而放大单步误差，从而增加 $E$。\n- 当密度均匀时（$\\beta = 0$, $\\gamma = 0$），两种格式都会产生 $E \\approx 0$，因为无辐散流平流一个常数场，中心通量差在每个网格单元内抵消，不产生更新。\n\n该程序实现了这些步骤，并输出与四个测试用例相对应的列表 $[E_1,E_2,E_3,E_4]$，其中角度使用弧度，并采用指定的物理单位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_mass_error(Nlam, Nphi, dt, beta, gamma):\n    # Physical constants\n    a = 6.371e6  # Earth radius [m]\n    rho0 = 1.0e4  # reference surface mass density [kg/m^2]\n    Psi0 = 1.0e6  # streamfunction amplitude [m^2/s]\n\n    # Grid setup in radians\n    lam_min, lam_max = -np.pi, np.pi\n    phi_min, phi_max = -np.pi/2, np.pi/2\n\n    dlam = (lam_max - lam_min) / Nlam\n    dphi = (phi_max - phi_min) / Nphi\n\n    # Cell centers\n    lam = lam_min + (np.arange(Nlam) + 0.5) * dlam  # shape (Nlam,)\n    phi = phi_min + (np.arange(Nphi) + 0.5) * dphi  # shape (Nphi,)\n\n    # 2D mesh\n    LAM, PHI = np.meshgrid(lam, phi, indexing='ij')  # shape (Nlam, Nphi)\n\n    # Initial density field rho(lam, phi)\n    rho = rho0 * (1.0 + beta * np.sin(PHI) + gamma * np.cos(2.0 * LAM) * (np.cos(PHI) ** 2))\n\n    # Streamfunction and velocity field (non-divergent)\n    # u_lambda = (2*Psi0/a) * sin(phi) * sin(lam)\n    # u_phi    = (Psi0/a) * cos(lam) * cos^2(phi)\n    ulam = (2.0 * Psi0 / a) * np.sin(PHI) * np.sin(LAM)\n    uphi = (Psi0 / a) * np.cos(LAM) * (np.cos(PHI) ** 2)\n\n    # Physical cell area weights A_j = a^2 cos(phi_j) dlam dphi\n    A_phys = (a ** 2) * np.cos(phi) * dlam * dphi  # shape (Nphi,)\n    # Broadcast to cell grid\n    A_phys_ij = np.broadcast_to(A_phys, (Nlam, Nphi))\n\n    # Incorrect area weights (neglect metric)\n    A_wrong = (a ** 2) * dlam * dphi  # scalar\n\n    # Face lengths\n    L_lambda = a * dphi  # longitudinal face length (constant)\n    # Latitudinal face locations\n    phi_faces = phi_min + np.arange(Nphi + 1) * dphi  # shape (Nphi+1,)\n    # Correct metric latitudinal face lengths\n    L_phi_metric = a * np.cos(phi_faces) * dlam  # shape (Nphi+1,)\n    # Wrong latitudinal face lengths (neglect cosphi)\n    L_phi_wrong = a * dlam  # scalar\n\n    # Build face-centered mass fluxes with centered averages\n\n    # Longitudinal faces: between i and i+1, periodic in longitude\n    # Compute at all faces i+1/2 for i=0..Nlam-1\n    # Average rho*ulam across adjacent cells\n    massflux_lam_cell = rho * ulam  # shape (Nlam, Nphi)\n    massflux_lam_face = 0.5 * (massflux_lam_cell + np.roll(massflux_lam_cell, shift=-1, axis=0))  # shape (Nlam, Nphi)\n    # Integrated flux across longitudinal faces (same for correct and wrong, length has no cosphi)\n    F_lambda = massflux_lam_face * L_lambda  # shape (Nlam, Nphi)\n\n    # Latitudinal faces: between j and j+1\n    # Average rho*uphi across adjacent cells in latitude\n    massflux_phi_cell = rho * uphi  # shape (Nlam, Nphi)\n    # Create array for faces: j from 0..Nphi (Nphi+1 faces)\n    # For interior faces j=1..Nphi-1, average adjacent cells; for boundaries, duplicate nearest cell (flux length will be zero at poles)\n    massflux_phi_face = np.zeros((Nlam, Nphi + 1))\n    # interior faces\n    massflux_phi_face[:, 1:Nphi] = 0.5 * (massflux_phi_cell[:, 0:Nphi-1] + massflux_phi_cell[:, 1:Nphi])\n    # boundary faces (optional, not used because lengths are zero at poles)\n    massflux_phi_face[:, 0] = massflux_phi_cell[:, 0]\n    massflux_phi_face[:, -1] = massflux_phi_cell[:, -1]\n\n    # Integrated latitudinal fluxes for correct and wrong schemes\n    # Broadcast L_phi_metric over longitude dimension\n    F_phi_metric = massflux_phi_face * (L_phi_metric[np.newaxis, :])  # shape (Nlam, Nphi+1)\n    F_phi_wrong = massflux_phi_face * L_phi_wrong  # shape (Nlam, Nphi+1)\n\n    # Perform one forward Euler step for both schemes\n\n    # Correct scheme update\n    # Flux differences across faces: for each cell (i,j),\n    # dF_lambda = F_lambda[i, j] - F_lambda[i-1, j]   (note sign convention: out - in)\n    # dF_phi    = F_phi_metric[i, j+1] - F_phi_metric[i, j]\n    dF_lambda = F_lambda - np.roll(F_lambda, shift=1, axis=0)  # shape (Nlam, Nphi)\n    dF_phi_metric = F_phi_metric[:, 1:] - F_phi_metric[:, 0:-1]  # shape (Nlam, Nphi)\n\n    rho_next_metric = rho - (dt / A_phys_ij) * (dF_lambda + dF_phi_metric)\n\n    # Wrong scheme update (neglect metric terms in area and lat face length)\n    dF_phi_wrong = F_phi_wrong[:, 1:] - F_phi_wrong[:, 0:-1]  # shape (Nlam, Nphi)\n    rho_next_wrong = rho - (dt / A_wrong) * (dF_lambda + dF_phi_wrong)\n\n    # Compute global masses using physical area weights\n    M0 = np.sum(rho * A_phys_ij)\n    M1_metric = np.sum(rho_next_metric * A_phys_ij)\n    M1_wrong = np.sum(rho_next_wrong * A_phys_ij)\n\n    # Absolute fractional mass change for the wrong scheme\n    E = abs((M1_wrong - M0) / M0)\n\n    return E\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (Nlam, Nphi, dt [s], beta, gamma)\n    test_cases = [\n        (72, 36, 600.0, 0.3, 0.5),   # General case\n        (12, 6, 600.0, 0.3, 0.5),    # Coarse grid\n        (72, 36, 3600.0, 0.3, 0.5),  # Longer time step\n        (72, 36, 600.0, 0.0, 0.0),   # Uniform density edge case\n    ]\n\n    results = []\n    for case in test_cases:\n        Nlam, Nphi, dt, beta, gamma = case\n        err = compute_mass_error(Nlam, Nphi, dt, beta, gamma)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "掌握了球面几何的基本原理后，我们将探讨一个更高级也更微妙的挑战。在实际的大气模型中，为了处理复杂地形，我们常常使用地形追随坐标系（如 $\\sigma$ 坐标）。然而，即使我们正确理解了几何结构，坐标系的选择与离散格式的简单组合也可能引入严重的数值误差。本练习将研究臭名昭著的“气压梯度力计算误差”问题，让你亲手计算出一个看似合理的离散格式如何在山脉上产生虚假的力，而这正是数值天气预报中的一个关键难题。",
            "id": "4091154",
            "problem": "考虑一个干燥、静力、等温的大气，其中地形高度在水平方向上线性变化。设重力加速度为 $g$，干空气的比气体常数为 $R$，绝对温度为 $T$。在理想气体定律下的静力平衡中，气压作为几何高度的函数满足 $dp/dz = -\\rho g$ 和 $\\rho = p/(R T)$，这导致了指数形式的基态气压廓线 $p(z) = p_0 \\exp(-z/H)$，其中 $H = R T / g$，$p_0$ 是 $z=0$ 处的气压。\n\n设地形高度为 $h(x) = h_0 + s x$，其中 $s$ 是一个恒定的斜率（单位为 $\\mathrm{m\\,m^{-1}}$）。那么地表气压为 $p_s(x) = p_0 \\exp(-h(x)/H)$，顶部气压为一个常数 $p_{\\mathrm{top}}$。定义垂直坐标 $\\sigma$ (sigma) 为 $\\sigma = (p - p_{\\mathrm{top}})/(p_s(x) - p_{\\mathrm{top}})$，因此 $p(\\sigma, x) = p_{\\mathrm{top}} + \\sigma \\big(p_s(x) - p_{\\mathrm{top}}\\big)$。\n\n在一个物理上正确的表述中，恒定几何高度 $z$ 处的水平气压梯度力为 $-(1/\\rho)\\,\\partial p/\\partial x \\vert_z$。对于上述水平均匀的基态，$\\partial p/\\partial x \\vert_z = 0$，产生零水平加速度。然而，使用最近邻有限差分在恒定 $\\sigma$ 上计算水平气压梯度的简单离散化方法，在倾斜地形上会产生非零加速度，相对于物理上正确的零结果，这些加速度是伪加速度。\n\n您将以 $x=0$ 为中心的气柱实施以下离散诊断：\n- 使用位于 $x=-\\Delta x$、$x=0$ 和 $x=+\\Delta x$ 的三个气柱。\n- 对于给定的垂直层数 $N$，定义层中 sigma 能级 $\\sigma_k = (k - 0.5)/N$，其中 $k = 1, 2, \\ldots, N$。\n- 对于每个 $\\sigma_k$，使用 $p(\\sigma, x) = p_{\\mathrm{top}} + \\sigma \\big(p_s(x) - p_{\\mathrm{top}}\\big)$，其中 $p_s(x) = p_0 \\exp\\!\\big(-h(x)/H\\big)$ 和 $h(x) = h_0 + s x$，计算在 $x=-\\Delta x$ 和 $x=+\\Delta x$ 处的 $p(\\sigma_k, x)$。\n- 通过中心差分来近似恒定 $\\sigma_k$ 处的水平气压梯度\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right\\vert_{\\sigma_k} \\approx \\frac{p(\\sigma_k, +\\Delta x) - p(\\sigma_k, -\\Delta x)}{2\\,\\Delta x}.\n$$\n- 将中心气柱中每个 $\\sigma_k$ 处的密度计算为 $\\rho_k = p(\\sigma_k, 0)/(R T)$。\n- 将每个层中的伪水平加速度计算为\n$$\na_k = -\\frac{1}{\\rho_k}\\,\\left.\\frac{\\partial p}{\\partial x}\\right\\vert_{\\sigma_k}.\n$$\n\n您的任务是为每个测试案例计算所有层上伪加速度的均方根，\n$$\na_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N}\\sum_{k=1}^{N} a_k^2},\n$$\n并以 $\\mathrm{m\\,s^{-2}}$ 为单位报告 $a_{\\mathrm{rms}}$。\n\n使用以下常量：\n- $g = 9.81\\,\\mathrm{m\\,s^{-2}}$，\n- $R = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，\n- $T = 280\\,\\mathrm{K}$，\n- $p_0 = 100000\\,\\mathrm{Pa}$，\n- $p_{\\mathrm{top}} = 10000\\,\\mathrm{Pa}$，\n- $h_0 = 1500\\,\\mathrm{m}$。\n\n测试套件（每个案例指定了网格间距 $\\Delta x$（单位为 $\\mathrm{m}$）、斜率 $s$（单位为 $\\mathrm{m\\,m^{-1}}$）和垂直层数 $N$（整数））：\n- 案例 1：$\\Delta x = 1000\\,\\mathrm{m}$，$s = 0.05\\,\\mathrm{m\\,m^{-1}}$，$N = 30$。\n- 案例 2：$\\Delta x = 5000\\,\\mathrm{m}$，$s = 0.02\\,\\mathrm{m\\,m^{-1}}$，$N = 30$。\n- 案例 3：$\\Delta x = 250\\,\\mathrm{m}$，$s = 0.10\\,\\mathrm{m\\,m^{-1}}$，$N = 60$。\n- 案例 4：$\\Delta x = 1000\\,\\mathrm{m}$，$s = 0.10\\,\\mathrm{m\\,m^{-1}}$，$N = 10$。\n- 案例 5（边界）：$\\Delta x = 1000\\,\\mathrm{m}$，$s = 0.00\\,\\mathrm{m\\,m^{-1}}$，$N = 30$。\n\n物理单位要求：以 $\\mathrm{m\\,s^{-2}}$ 为单位表示每个报告的 $a_{\\mathrm{rms}}$。\n\n最终输出格式：您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,r_3,r_4,r_5]$），其中 $r_i$ 是按上述顺序列出的案例 $i$ 的 $a_{\\mathrm{rms}}$ 值（单位为 $\\mathrm{m\\,s^{-2}}$）。",
            "solution": "这个问题是有效的，因为它基于大气动力学原理，具有科学依据，其表述客观且适定，并有清晰的确定性计算步骤。它解决了一个数值模拟中与地形跟随坐标系中气压梯度力计算相关的著名问题。\n\n目标是计算在地形跟随 sigma ($\\sigma$) 坐标系上，因对水平气压梯度进行简单的有限差分近似而产生的伪水平加速度的均方根 ($a_{\\mathrm{rms}}$)。物理背景是一个静止的干燥、静力、等温大气，其中真实的水平加速度应为零。非零结果是一个数值假象。\n\n计算过程通过为每个测试案例实施问题陈述中概述的离散诊断程序来进行。\n\n首先，我们确定物理常数和派生参数。干空气的比气体常数为 $R = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，绝对温度为 $T = 280\\,\\mathrm{K}$，重力加速度为 $g = 9.81\\,\\mathrm{m\\,s^{-2}}$。大气标高 $H$ 表征了气压随高度的指数衰减，其计算公式为：\n$$\nH = \\frac{R T}{g}\n$$\n海平面（$z=0$）的基态气压为 $p_0 = 100000\\,\\mathrm{Pa}$，模式顶部的气压是一个常数 $p_{\\mathrm{top}} = 10000\\,\\mathrm{Pa}$。\n\n地形高度 $h(x)$ 随水平坐标 $x$ 线性变化：\n$$\nh(x) = h_0 + s x\n$$\n其中 $h_0 = 1500\\,\\mathrm{m}$ 是 $x=0$ 处的地形高度，$s$ 是斜率。地表气压 $p_s(x)$ 是在地形表面 $z=h(x)$ 处评估的基态廓线的气压：\n$$\np_s(x) = p_0 \\exp\\left(-\\frac{h(x)}{H}\\right)\n$$\n\n垂直坐标是地形跟随 sigma 坐标，定义为：\n$$\n\\sigma = \\frac{p - p_{\\mathrm{top}}}{p_s(x) - p_{\\mathrm{top}}}\n$$\n这将每个气柱中的气压进行归一化，使得在模式顶部（$p=p_{\\mathrm{top}}$）$\\sigma=0$，在地表（$p=p_s(x)$）$\\sigma=1$。我们可以将气压 $p$ 表示为 $\\sigma$ 和 $x$ 的函数：\n$$\np(\\sigma, x) = p_{\\mathrm{top}} + \\sigma \\big(p_s(x) - p_{\\mathrm{top}}\\big)\n$$\n\n数值网格由位于水平位置 $x = -\\Delta x$、$x=0$ 和 $x = +\\Delta x$ 的三个气柱组成。垂直网格有 $N$ 层，我们在层中 sigma 能级 $\\sigma_k$ 处进行计算：\n$$\n\\sigma_k = \\frac{k - 0.5}{N} \\quad \\text{for } k = 1, 2, \\ldots, N\n$$\n\n问题的核心是计算中心气柱（$x=0$）中每个能级 $\\sigma_k$ 上的伪加速度 $a_k$。当存在地形坡度（$s \\neq 0$）时，恒定的 $\\sigma_k$ 能级不对应于恒定的几何高度 $z$，对该能级上的水平气压梯度进行近似便会产生这种加速度。\n\n每个能级 $\\sigma_k$ 上的水平气压梯度使用二阶中心有限差分进行近似：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right\\vert_{\\sigma_k} \\approx \\frac{p(\\sigma_k, +\\Delta x) - p(\\sigma_k, -\\Delta x)}{2\\,\\Delta x}\n$$\n代入 $p(\\sigma, x)$ 的表达式，得到：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right\\vert_{\\sigma_k} \\approx \\frac{\\left(p_{\\mathrm{top}} + \\sigma_k (p_s(+\\Delta x) - p_{\\mathrm{top}})\\right) - \\left(p_{\\mathrm{top}} + \\sigma_k (p_s(-\\Delta x) - p_{\\mathrm{top}})\\right)}{2\\,\\Delta x} = \\sigma_k \\frac{p_s(+\\Delta x) - p_s(-\\Delta x)}{2\\,\\Delta x}\n$$\n\n中心气柱中每个能级 $\\sigma_k$ 上的密度 $\\rho_k$ 由理想气体定律 $\\rho = p/(RT)$ 确定：\n$$\n\\rho_k = \\frac{p(\\sigma_k, 0)}{R T}\n$$\n\n然后，从水平气压梯度力项计算伪水平加速度 $a_k$：\n$$\na_k = -\\frac{1}{\\rho_k}\\,\\left.\\frac{\\partial p}{\\partial x}\\right\\vert_{\\sigma_k}\n$$\n\n最后，对于每个测试案例，我们计算所有 $N$ 层上这些伪加速度的均方根，以获得数值误差的单一指标：\n$$\na_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N}\\sum_{k=1}^{N} a_k^2}\n$$\n\n此程序被系统地应用于由参数（$\\Delta x$、$s$、$N$）指定的每个测试案例。对于 $s=0$ 的情况，地形是平坦的，因此 $h(x)$ 以及 $p_s(x)$ 是恒定的。这使得气压梯度项的分子为零，导致所有 $k$ 的 $a_k = 0$，因此 $a_{\\mathrm{rms}} = 0$，这与物理和数值上的预期相符。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the root-mean-square of spurious horizontal accelerations\n    arising from a finite-difference pressure gradient calculation on a\n    sigma-coordinate grid over sloping terrain.\n    \"\"\"\n\n    # Define the physical constants.\n    g = 9.81  # Gravitational acceleration in m/s^2\n    R = 287.0  # Specific gas constant for dry air in J/(kg*K)\n    T = 280.0  # Isothermal temperature in K\n    p0 = 100000.0  # Pressure at z=0 in Pa\n    p_top = 10000.0  # Pressure at the model top in Pa\n    h0 = 1500.0  # Terrain height at x=0 in m\n\n    # Define the test cases.\n    # Each case is a tuple: (delta_x in m, slope s in m/m, N layers)\n    test_cases = [\n        (1000.0, 0.05, 30),\n        (5000.0, 0.02, 30),\n        (250.0, 0.10, 60),\n        (1000.0, 0.10, 10),\n        (1000.0, 0.00, 30),\n    ]\n\n    results = []\n\n    # Calculate constant parameters\n    H = R * T / g  # Scale height in m\n    RT = R * T\n\n    for dx, s, N in test_cases:\n        # For the s=0 case, the result is analytically 0.\n        if s == 0.0:\n            results.append(0.0)\n            continue\n\n        # 1. Define grid and coordinates\n        x_L, x_C, x_R = -dx, 0.0, dx\n        \n        # Mid-layer sigma levels\n        sigma_k = (np.arange(1, N + 1) - 0.5) / N\n\n        # 2. Compute terrain height and surface pressures\n        h_L = h0 + s * x_L\n        h_C = h0 + s * x_C\n        h_R = h0 + s * x_R\n\n        ps_L = p0 * np.exp(-h_L / H)\n        ps_C = p0 * np.exp(-h_C / H)\n        ps_R = p0 * np.exp(-h_R / H)\n\n        # 3. Compute pressure at all levels and locations\n        # Using numpy broadcasting for efficiency\n        p_L_k = p_top + sigma_k * (ps_L - p_top)\n        p_C_k = p_top + sigma_k * (ps_C - p_top)\n        p_R_k = p_top + sigma_k * (ps_R - p_top)\n        \n        # 4. Approximate horizontal pressure gradient at constant sigma\n        dp_dx_k = (p_R_k - p_L_k) / (2 * dx)\n\n        # 5. Compute density at the center column for each level\n        rho_k = p_C_k / RT\n\n        # 6. Compute the spurious horizontal acceleration at each level\n        a_k = - (1 / rho_k) * dp_dx_k\n\n        # 7. Compute the root-mean-square of the spurious accelerations\n        a_rms = np.sqrt(np.mean(a_k**2))\n        \n        results.append(a_rms)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}