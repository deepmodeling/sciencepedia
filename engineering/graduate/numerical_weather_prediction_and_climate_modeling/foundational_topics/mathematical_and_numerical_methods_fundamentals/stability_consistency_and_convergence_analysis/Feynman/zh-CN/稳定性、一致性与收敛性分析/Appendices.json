{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在通过一个基础但至关重要的问题来巩固 von Neumann 稳定性分析的核心技能。我们将从线性平流方程入手，这是流体动力学中最基本的双曲型偏微分方程，并为其经典的迎风格式推导稳定性约束。通过这项实践，您将亲手推导出著名的 Courant-Friedrichs-Lewy (CFL) 条件，深刻理解物理波速$c$、时间步长$\\Delta t$和空间步长$\\Delta x$之间为保证数值解稳定而必须满足的内在关系。",
            "id": "4092885",
            "problem": "考虑线性平流偏微分方程 (PDE) $u_{t} + c\\,u_{x} = 0$，该方程描述了长度为 $L$ 的纬向一维周期性通道中被动示踪剂的运动，其中 $c$ 是一个空间均匀的波速，代表了数值天气预报 (NWP) 或气候模拟背景下的平均纬向流。该区域在均匀网格上进行离散化，网格间距为 $\\Delta x$，时间步长为 $\\Delta t$。离散解在网格点 $x_{i} = i\\,\\Delta x$ 和时间 $t^{n} = n\\,\\Delta t$ 处表示为 $u_{i}^{n} \\approx u(x_{i}, t^{n})$。迎风格式是基于均匀网格上的守恒通量形式 $u_{t} + \\partial_{x} (c\\,u) = 0$ 构建的，通过对线性通量函数 $f(u) = c\\,u$ 使用单调 Godunov 数值通量：\n- 如果 $c > 0$，取 $F_{i+1/2}^{n} = c\\,u_{i}^{n}$ 和 $F_{i-1/2}^{n} = c\\,u_{i-1}^{n}$。\n- 如果 $c  0$，取 $F_{i+1/2}^{n} = c\\,u_{i+1}^{n}$ 和 $F_{i-1/2}^{n} = c\\,u_{i}^{n}$。\n\n定义无量纲 Courant 数 $\\nu = c\\,\\Delta t / \\Delta x$。使用傅里叶 (von Neumann) 稳定性分析和周期性边界条件，推导迎风格式稳定性的 Courant–Friedrichs–Lewy (CFL) 约束对 $\\nu$ 的要求。明确描述 $\\nu$ 的允许范围和模板方向如何依赖于 $c$ 的符号。然后，使用您推导出的稳定性约束，给出最大稳定时间步长 $\\Delta t_{\\max}$ 作为 $\\Delta x$ 和 $c$ 的函数的闭式表达式。您必须从 PDE、守恒通量形式和 Godunov 通量选择出发，逻辑地推导出放大因子和由此产生的稳定区域；不要假设或引用任何关于迎风格式的目标稳定性结果。\n\n将最终的最大稳定时间步长表示为符号解析表达式。无需四舍五入。最终答案在答案框内必须是无单位的。",
            "solution": "出发点是常数 $c$ 的线性平流偏微分方程 (PDE) $u_{t} + c\\,u_{x} = 0$。其守恒通量形式为 $u_{t} + \\partial_{x}(f(u)) = 0$，其中 $f(u) = c\\,u$。\n\n在网格间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上，单元平均的有限体积更新（或与之密切相关的均匀网格上点值的有限差分更新）可以写为\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^{n} - F_{i-1/2}^{n}\\right),\n$$\n其中 $F_{i\\pm 1/2}^{n}$ 是与 $f(u) = c\\,u$ 相容且为保证稳定性而单调的数值通量。对于具有恒定输运速度 $c$ 的线性通量，Godunov 通量简化为取决于 $c$ 符号的迎风选择：\n- 如果 $c  0$，特征线向右移动，因此使用迎风（左）状态：$F_{i+1/2}^{n} = c\\,u_{i}^{n}$ 和 $F_{i-1/2}^{n} = c\\,u_{i-1}^{n}$。\n- 如果 $c  0$，特征线向左移动，因此使用迎风（右）状态：$F_{i+1/2}^{n} = c\\,u_{i+1}^{n}$ 和 $F_{i-1/2}^{n} = c\\,u_{i}^{n}$。\n\n将这些代入更新公式，得到标准的迎风格式，根据 $c$ 的符号分为两种情况。定义无量纲 Courant 数 $\\nu = c\\,\\Delta t / \\Delta x$。\n\n情况 $c  0$：\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(c\\,u_{i}^{n} - c\\,u_{i-1}^{n}\\right)\n= u_{i}^{n} - \\nu\\left(u_{i}^{n} - u_{i-1}^{n}\\right)\n= (1 - \\nu)u_{i}^{n} + \\nu\\,u_{i-1}^{n}.\n$$\n\n情况 $c  0$：\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(c\\,u_{i+1}^{n} - c\\,u_{i}^{n}\\right)\n= u_{i}^{n} - \\nu\\left(u_{i+1}^{n} - u_{i}^{n}\\right)\n= (1 + \\nu)u_{i}^{n} - \\nu\\,u_{i+1}^{n}.\n$$\n注意，在这种情况下 $\\nu  0$，因此方便定义 $\\mu = -\\nu = |c|\\,\\Delta t / \\Delta x \\ge 0$，得到\n$$\nu_{i}^{n+1} = (1 - \\mu)u_{i}^{n} + \\mu\\,u_{i+1}^{n}.\n$$\n\n我们假设周期性边界条件，进行 von Neumann 稳定性分析。设离散解分解为傅里叶模式，\n$$\nu_{i}^{n} = \\hat{u}^{n}\\,\\exp\\!\\left(\\mathrm{i}\\,k\\,x_{i}\\right) = \\hat{u}^{n}\\,\\exp\\!\\left(\\mathrm{i}\\,k\\,i\\,\\Delta x\\right),\n$$\n其中 $k$ 是波数，$\\mathrm{i}$ 是虚数单位。每个模式的更新定义了一个放大因子 $G(k)$，使得 $\\hat{u}^{n+1} = G(k)\\,\\hat{u}^{n}$。傅里叶模式有界增长意义下的稳定性要求对所有允许的 $k$ 都有 $|G(k)| \\le 1$。\n\n情况 $c  0$：\n使用 $u_{i-1}^{n} = u_{i}^{n}\\,\\exp\\!\\left(-\\mathrm{i}\\,k\\,\\Delta x\\right)$，\n$$\nG(k) = (1 - \\nu) + \\nu\\,\\exp\\!\\left(-\\mathrm{i}\\,k\\,\\Delta x\\right).\n$$\n令 $\\theta = k\\,\\Delta x$。则\n$$\nG(\\theta) = 1 - \\nu\\left(1 - \\exp(-\\mathrm{i}\\,\\theta)\\right).\n$$\n计算其模：\n\\begin{align*}\n1 - \\exp(-\\mathrm{i}\\,\\theta) = 1 - \\cos\\theta + \\mathrm{i}\\,\\sin\\theta, \\\\\nG(\\theta) = 1 - \\nu(1 - \\cos\\theta) - \\mathrm{i}\\,\\nu\\,\\sin\\theta, \\\\\n|G(\\theta)|^{2} = \\left[1 - \\nu(1 - \\cos\\theta)\\right]^{2} + \\left[\\nu\\,\\sin\\theta\\right]^{2} \\\\\n= 1 - 2\\,\\nu(1 - \\cos\\theta) + \\nu^{2}\\left[(1 - \\cos\\theta)^{2} + \\sin^{2}\\theta\\right].\n\\end{align*}\n使用三角恒等式 $(1 - \\cos\\theta)^{2} + \\sin^{2}\\theta = 2(1 - \\cos\\theta)$ 进行简化：\n$$\n|G(\\theta)|^{2} = 1 - 2\\,\\nu(1 - \\cos\\theta) + 2\\,\\nu^{2}(1 - \\cos\\theta) = 1 - 2(1 - \\cos\\theta)\\,\\nu(1 - \\nu).\n$$\n由于对所有 $\\theta$ 都有 $1 - \\cos\\theta \\ge 0$，最坏情况下的界对应于 $1 - \\cos\\theta$ 的最大值，即在 $\\theta = \\pi$ 时的 $2$。因子 $\\nu(1 - \\nu)$ 是非负的当且仅当 $0 \\le \\nu \\le 1$。对于 $0 \\le \\nu \\le 1$，我们对所有 $\\theta$ 都有 $|G(\\theta)|^{2} \\le 1$。如果 $\\nu  0$ 或 $\\nu > 1$，则 $\\nu(1 - \\nu)  0$，对于足够大的 $1 - \\cos\\theta$，有 $|G(\\theta)|^{2} > 1$，这意味着不稳定。因此，对于 $c > 0$，CFL 稳定范围是\n$$\n0 \\le \\nu \\le 1,\n$$\n此时格式使用左迎风模板 $u_{i-1}^{n}$。\n\n情况 $c  0$：\n使用 $\\mu = -\\nu \\ge 0$ 和 $u_{i+1}^{n} = u_{i}^{n}\\,\\exp\\!\\left(\\mathrm{i}\\,k\\,\\Delta x\\right)$，\n$$\nG(k) = (1 - \\mu) + \\mu\\,\\exp\\!\\left(\\mathrm{i}\\,k\\,\\Delta x\\right).\n$$\n令 $\\theta = k\\,\\Delta x$。则\n$$\nG(\\theta) = 1 + \\mu\\left(\\exp(\\mathrm{i}\\,\\theta) - 1\\right) = 1 - \\mu(1 - \\cos\\theta) + \\mathrm{i}\\,\\mu\\,\\sin\\theta.\n$$\n模的平方为\n\\begin{align*}\n|G(\\theta)|^{2} = \\left[1 - \\mu(1 - \\cos\\theta)\\right]^{2} + \\left[\\mu\\,\\sin\\theta\\right]^{2} \\\\\n= 1 - 2\\,\\mu(1 - \\cos\\theta) + 2\\,\\mu^{2}(1 - \\cos\\theta) \\\\\n= 1 - 2(1 - \\cos\\theta)\\,\\mu(1 - \\mu).\n\\end{align*}\n根据相同的推理，稳定性要求 $0 \\le \\mu \\le 1$，用 $\\nu$ 表示即为 $-1 \\le \\nu \\le 0$。对于 $c  0$，格式使用右迎风模板 $u_{i+1}^{n}$。\n\n因此，迎风格式的 Courant–Friedrichs–Lewy (CFL) 稳定性条件是\n$$\n\\text{if } c  0,\\quad 0 \\le \\nu \\le 1;\\qquad \\text{if } c  0,\\quad -1 \\le \\nu \\le 0.\n$$\n等价地，在两种情况下，都必须满足模约束 $|\\nu| \\le 1$，其中 $\\nu$ 的符号由 $c$ 的符号决定，并相应地选择模板（$c  0$ 时为左迎风，$c  0$ 时为右迎风）。\n\n为了将最大稳定时间步长 $\\Delta t_{\\max}$ 表示为 $\\Delta x$ 和 $c$ 的函数，注意到 $|\\nu| \\le 1$ 意味着\n$$\n\\left|\\frac{c\\,\\Delta t}{\\Delta x}\\right| \\le 1 \\quad \\Longrightarrow \\quad \\Delta t \\le \\frac{\\Delta x}{|c|}.\n$$\n因此，\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x}{|c|}.\n$$\n\n最后，为了将其与数值天气预报 (NWP) 和气候模拟背景下的相容性和收敛性联系起来，我们注意到迎风格式是 $u_{t} + c\\,u_{x} = 0$ 的一阶精度离散化，其局部截断误差的量级为 $\\mathcal{O}(\\Delta t) + \\mathcal{O}(\\Delta x)$（相容性）。根据关于均匀网格上线性初值问题的 Lax 等价定理，稳定性（如上述 CFL 条件所保证）与相容性一起，意味着当 $\\Delta t \\to 0$ 和 $\\Delta x \\to 0$ 时，在周期性边界条件下，该格式收敛到真实解。$c$ 的符号改变了迎风方向和 $\\nu$ 的允许符号，但最大稳定时间步长仅取决于模 $|c|$，这是 CFL 约束中物理上相关的平流速度。",
            "answer": "$$\\boxed{\\frac{\\Delta x}{|c|}}$$"
        },
        {
            "introduction": "在掌握了基础的稳定性分析之后，本练习将探讨在更复杂的离散化方法（如有限元法）中，不同的实现选择如何影响模型的性能。我们将针对声波方程，比较两种常用的质量矩阵构造方式——一致质量矩阵和集总质量矩阵。这项实践不仅要求您推导各自的稳定性限制，还将引导您分析由“集总”近似引入的数值色散误差，从而量化这种简化操作在计算效率和解的保真度之间的权衡。",
            "id": "4092931",
            "problem": "考虑一维空间中的标量声波方程，\n$$\n\\frac{\\partial^{2} q}{\\partial t^{2}} \\;=\\; c^{2}\\,\\frac{\\partial^{2} q}{\\partial x^{2}},\n$$\n该方程设定在长度为 $L$ 的周期性域上，其中 $c$ 是恒定的声速。使用 $N$ 个节点和网格间距 $h=L/N$ 对空间域进行均匀离散化，并在此网格上使用连续分段线性有限元来近似 $q(x,t)$。\n\n令 $M$ 和 $K$ 分别表示由标准伽辽金方法和节点（帽函数）基产生的全局质量矩阵和刚度矩阵。对质量矩阵使用两种典型的选择：\n- 一致质量矩阵 $M$，其元素为 $M_{ii}=2h/3$，$M_{i,i\\pm 1}=h/6$，所有其他元素为零；以及\n- 行和集中质量矩阵 $M_{\\ell}$，它是通过将 $M$ 替换为一个对角矩阵得到的，该对角矩阵的对角元素是 $M$ 的行和，即 $(M_{\\ell})_{ii} = h$。\n\n对得到的半离散系统进行时间积分\n$$\nM\\,\\ddot{\\boldsymbol{q}}(t) \\;+\\; c^{2}\\,K\\,\\boldsymbol{q}(t) \\;=\\; \\boldsymbol{0}\n$$\n使用显式二阶精度的中心差分（蛙跳）法，\n$$\n\\boldsymbol{q}^{n+1} \\;=\\; 2\\,\\boldsymbol{q}^{n} \\;-\\; \\boldsymbol{q}^{n-1} \\;-\\; \\Delta t^{2}\\, M^{-1}\\,c^{2}\\,K\\,\\boldsymbol{q}^{n},\n$$\n其中空间上采用周期性边界条件，$\\boldsymbol{q}^{n}$ 表示在时间层 $t^{n}=n\\,\\Delta t$ 的节点值向量。\n\n在空间周期性设置下，使用傅里叶（von Neumann）分析法，采用形式为 $v_{j}=\\exp(\\mathrm{i}\\,j\\,\\theta)$ 的离散傅里叶模，其中 $j$ 是节点索引，$\\theta\\in[0,\\pi]$ 是无量纲波数。用 $\\mu(\\theta)$ 表示矩阵对 $(K,M)$ 的广义特征值，即对于一个傅里叶模 $\\boldsymbol{v}$ 满足 $K\\,\\boldsymbol{v}=\\mu(\\theta)\\,M\\,\\boldsymbol{v}$ 的量；用 $\\mu_{\\ell}(\\theta)$ 表示 $(K,M_{\\ell})$ 的类似广义特征值。\n\n仅使用标准线性有限元基和周期性托普利茨算子的基本性质，完成以下任务：\n\n- 对于每种质量矩阵的选择，推导中心差分法的最大稳定时间步长 $\\Delta t_{\\max}$（用最大广义特征值表示）。然后确定比率\n$$\nr \\;=\\; \\frac{\\Delta t_{\\max}^{(\\text{lumped})}}{\\Delta t_{\\max}^{(\\text{consistent})}}.\n$$\n\n- 通过推导集中质量半离散系统的相速度的小波数展开，来量化由质量集中引入的主阶色散误差。具体来说，对于 $\\theta\\to 0$，将离散相速度 $c_{p,\\ell}(\\theta)$ 写成以下形式\n$$\n\\frac{c_{p,\\ell}(\\theta)}{c} \\;=\\; 1 \\;+\\; \\beta\\,\\theta^{2} \\;+\\; \\mathcal{O}(\\theta^{4}),\n$$\n并计算系数 $\\beta$。\n\n以行矩阵的形式给出你的最终答案，该矩阵依次包含 $r$ 的精确表达式和 $\\beta$ 的精确值。不需要单位。不需要四舍五入；请提供精确值。",
            "solution": "该问题要求计算两个量：集中质量矩阵与一致质量矩阵的最大稳定时间步长之比，以及集中质量格式的主阶色散误差系数。这两项任务都需要对半离散系统进行傅里叶分析。\n\n首先，我们分析中心差分（蛙跳）时间积分格式的稳定性。半离散系统由下式给出\n$$\nM\\,\\ddot{\\boldsymbol{q}}(t) \\;+\\; c^{2}\\,K\\,\\boldsymbol{q}(t) \\;=\\; \\boldsymbol{0},\n$$\n其中 $\\boldsymbol{q}(t)$ 是节点值的向量，$M$ 是质量矩阵（一致或集中），$K$ 是刚度矩阵，$c$ 是恒定声速。蛙跳格式根据下式更新解\n$$\n\\boldsymbol{q}^{n+1} \\;=\\; 2\\,\\boldsymbol{q}^{n} \\;-\\; \\boldsymbol{q}^{n-1} \\;-\\; (\\Delta t)^{2}\\, c^{2}\\,M^{-1}\\,K\\,\\boldsymbol{q}^{n}.\n$$\n我们通过将离散傅里叶模 $\\boldsymbol{q}^n_j = \\hat{q}(\\omega) \\exp(\\mathrm{i} n \\Delta t \\omega) \\exp(\\mathrm{i} j \\theta)$ 代入该格式来进行 von Neumann 稳定性分析。一个更简单、等效的方法是认识到蛙跳法的稳定性取决于算子 $c^2 M^{-1}K$ 的特征值。令 $\\mu(\\theta)$ 为与无量纲波数 $\\theta$ 的傅里叶模对应的矩阵对 $(K,M)$ 的一个广义特征值。该模态的半离散方程的行为类似于简谐振子 $\\ddot{y} = -\\omega_{\\text{num}}^2 y$，其中数值频率 $\\omega_{\\text{num}}$ 由 $\\omega_{\\text{num}}^2 = c^2 \\mu(\\theta)$ 给出。蛙跳法对于此振子是稳定的，当且仅当满足 Courant-Friedrichs-Lewy (CFL) 条件 $|\\omega_{\\text{num}} \\Delta t| \\leq 2$。为了确保对所有可能的模态都稳定，该条件必须对最大可能的数值频率成立：\n$$\n\\Delta t \\,\\max_{\\theta} |\\omega_{\\text{num}}(\\theta)| \\;\\leq\\; 2 \\quad\\implies\\quad \\Delta t \\, c \\, \\sqrt{\\max_{\\theta} \\mu(\\theta)} \\;\\leq\\; 2.\n$$\n因此，最大稳定时间步长为\n$$\n\\Delta t_{\\max} \\;=\\; \\frac{2}{c\\,\\sqrt{\\max_{\\theta} \\mu(\\theta)}}.\n$$\n为了求得 $\\mu(\\theta)$，我们必须找到周期性托普利茨矩阵 $M$ 和 $K$ 作用于分量为 $v_j = \\exp(\\mathrm{i} j \\theta)$ 的傅里叶模 $\\boldsymbol{v}$ 时的符号（特征值）。对于一个具有模板 $\\{a_{-p}, \\dots, a_0, \\dots, a_p\\}$ 的矩阵，其符号为 $\\hat{A}(\\theta) = \\sum_{k=-p}^{p} a_k \\exp(\\mathrm{i} k \\theta)$。\n\n使用线性有限元时，算子 $-\\partial^2/\\partial x^2$ 的刚度矩阵 $K$ 是从 $K_{ij} = \\int_{0}^{L} \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} dx$ 推导出来的，其中 $\\phi_j$ 是标准线性“帽函数”基函数。对于一个内部节点 $j$，这会产生模板 $\\{-\\frac{1}{h}, \\frac{2}{h}, -\\frac{1}{h}\\}$。$K$ 的符号是：\n$$\n\\hat{K}(\\theta) \\;=\\; -\\frac{1}{h}\\exp(-\\mathrm{i}\\theta) \\;+\\; \\frac{2}{h} \\;-\\; \\frac{1}{h}\\exp(\\mathrm{i}\\theta) \\;=\\; \\frac{2}{h}(1 - \\cos(\\theta)).\n$$\n一致质量矩阵 $M$ 由模板 $\\{\\frac{h}{6}, \\frac{2h}{3}, \\frac{h}{6}\\}$ 给出。其符号是：\n$$\n\\hat{M}(\\theta) \\;=\\; \\frac{h}{6}\\exp(-\\mathrm{i}\\theta) \\;+\\; \\frac{2h}{3} \\;+\\; \\frac{h}{6}\\exp(\\mathrm{i}\\theta) \\;=\\; \\frac{2h}{3} + \\frac{h}{3}\\cos(\\theta) \\;=\\; \\frac{h}{3}(2 + \\cos(\\theta)).\n$$\n行和集中质量矩阵 $M_{\\ell}$ 是对角矩阵，其元素为 $(M_{\\ell})_{ii}=h$，所以其模板是 $\\{0,h,0\\}$。其符号很简单：\n$$\n\\hat{M}_{\\ell}(\\theta) \\;=\\; h.\n$$\n广义特征值 $\\mu(\\theta)$ 是符号之比，即 $\\mu(\\theta) = \\hat{K}(\\theta) / \\hat{M}(\\theta)$。\n\n对于一致质量矩阵的情况：\n$$\n\\mu(\\theta) \\;=\\; \\frac{\\hat{K}(\\theta)}{\\hat{M}(\\theta)} \\;=\\; \\frac{\\frac{2}{h}(1 - \\cos(\\theta))}{\\frac{h}{3}(2 + \\cos(\\theta))} \\;=\\; \\frac{6}{h^2} \\frac{1 - \\cos(\\theta)}{2 + \\cos(\\theta)}.\n$$\n为了找到最大值，我们注意到对于 $\\theta \\in [0, \\pi]$，函数 $f(\\theta) = \\frac{1 - \\cos(\\theta)}{2 + \\cos(\\theta)}$ 是单调递增的。因此，其最大值出现在最高波数 $\\theta = \\pi$ 处：\n$$\n\\max_{\\theta} \\mu(\\theta) \\;=\\; \\mu(\\pi) \\;=\\; \\frac{6}{h^2} \\frac{1 - (-1)}{2 + (-1)} \\;=\\; \\frac{6}{h^2} \\frac{2}{1} \\;=\\; \\frac{12}{h^2}.\n$$\n一致质量格式的最大稳定时间步长为：\n$$\n\\Delta t_{\\max}^{(\\text{consistent})} \\;=\\; \\frac{2}{c \\sqrt{12/h^2}} \\;=\\; \\frac{2h}{c \\sqrt{12}} \\;=\\; \\frac{2h}{2c\\sqrt{3}} \\;=\\; \\frac{h}{c\\sqrt{3}}.\n$$\n对于集中质量矩阵的情况：\n$$\n\\mu_{\\ell}(\\theta) \\;=\\; \\frac{\\hat{K}(\\theta)}{\\hat{M}_{\\ell}(\\theta)} \\;=\\; \\frac{\\frac{2}{h}(1 - \\cos(\\theta))}{h} \\;=\\; \\frac{2}{h^2}(1 - \\cos(\\theta)).\n$$\n对于 $\\theta \\in [0, \\pi]$，这个函数也是单调递增的。最大值在 $\\theta = \\pi$ 处取得：\n$$\n\\max_{\\theta} \\mu_{\\ell}(\\theta) \\;=\\; \\mu_{\\ell}(\\pi) \\;=\\; \\frac{2}{h^2}(1 - (-1)) \\;=\\; \\frac{4}{h^2}.\n$$\n集中质量格式的最大稳定时间步长为：\n$$\n\\Delta t_{\\max}^{(\\text{lumped})} \\;=\\; \\frac{2}{c \\sqrt{4/h^2}} \\;=\\; \\frac{2h}{c \\cdot 2} \\;=\\; \\frac{h}{c}.\n$$\n那么比率 $r$ 是：\n$$\nr \\;=\\; \\frac{\\Delta t_{\\max}^{(\\text{lumped})}}{\\Delta t_{\\max}^{(\\text{consistent})}} \\;=\\; \\frac{h/c}{h/(c\\sqrt{3})} \\;=\\; \\sqrt{3}.\n$$\n\n接下来，我们分析集中质量系统的色散误差。数值相速度 $c_{p,\\ell}(\\theta)$ 由关系式 $c_{p,\\ell}(\\theta) = \\omega_{\\text{num}}(\\theta) / k$ 给出，其中 $k = \\theta/h$ 是物理波数。\n$$\nc_{p,\\ell}(\\theta) \\;=\\; \\frac{\\omega_{\\text{num},\\ell}(\\theta)}{k} \\;=\\; \\frac{c \\sqrt{\\mu_{\\ell}(\\theta)}}{\\theta/h} \\;=\\; ch \\frac{\\sqrt{\\frac{2}{h^2}(1 - \\cos(\\theta))}}{\\theta} \\;=\\; c \\frac{\\sqrt{2(1 - \\cos(\\theta))}}{\\theta}.\n$$\n为了找到主阶误差，我们对该表达式在小波数下进行展开，即当 $\\theta \\to 0$ 时。我们使用 $\\cos(\\theta)$ 在 $\\theta=0$ 附近的泰勒级数展开：\n$$\n\\cos(\\theta) \\;=\\; 1 - \\frac{\\theta^2}{2!} + \\frac{\\theta^4}{4!} - \\mathcal{O}(\\theta^6).\n$$\n将此代入相速度比的表达式中：\n$$\n\\frac{c_{p,\\ell}(\\theta)}{c} \\;=\\; \\frac{\\sqrt{2\\left(1 - \\left(1 - \\frac{\\theta^2}{2} + \\frac{\\theta^4}{24} - \\dots\\right)\\right)}}{\\theta} \\;=\\; \\frac{\\sqrt{2\\left(\\frac{\\theta^2}{2} - \\frac{\\theta^4}{24} + \\dots\\right)}}{\\theta} \\;=\\; \\frac{\\sqrt{\\theta^2 - \\frac{\\theta^4}{12} + \\dots}}{\\theta}.\n$$\n从平方根中提出因子 $\\theta$：\n$$\n\\frac{c_{p,\\ell}(\\theta)}{c} \\;=\\; \\frac{\\theta \\sqrt{1 - \\frac{\\theta^2}{12} + \\mathcal{O}(\\theta^4)}}{\\theta} \\;=\\; \\sqrt{1 - \\frac{\\theta^2}{12} + \\mathcal{O}(\\theta^4)}.\n$$\n使用二项式展开 $\\sqrt{1+x} = 1 + \\frac{x}{2} + \\mathcal{O}(x^2)$，并令 $x = -\\frac{\\theta^2}{12}$：\n$$\n\\frac{c_{p,\\ell}(\\theta)}{c} \\;=\\; 1 + \\frac{1}{2}\\left(-\\frac{\\theta^2}{12}\\right) + \\mathcal{O}(\\theta^4) \\;=\\; 1 - \\frac{\\theta^2}{24} + \\mathcal{O}(\\theta^4).\n$$\n将此与所要求的形式 $\\frac{c_{p,\\ell}(\\theta)}{c} = 1 + \\beta\\,\\theta^{2} + \\mathcal{O}(\\theta^{4})$ 进行比较，我们确定系数 $\\beta$ 为：\n$$\n\\beta \\;=\\; -\\frac{1}{24}.\n$$\n负号表示数值波落后于真实波（相位误差）。\n\n所要求的两个量是 $r=\\sqrt{3}$ 和 $\\beta = -1/24$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sqrt{3}  -\\frac{1}{24} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "最后的这个实践练习将理论分析与数值天气预报（NWP）模型开发的实际考量相结合。我们将关注时间积分方案的选择，并评估不同阶数的 Runge-Kutta (RK) 方法在计算效率上的优劣。这项练习要求您在一个给定的误差容限下，综合考虑方法的稳定性边界和精度要求来确定最优时间步长，并最终计算出达到目标所需的总计算成本。通过比较一个二阶和一个四阶方法的成本效益，您将深刻体会到在实际应用中，高阶精度带来的优势是如何与更大的计算开销（例如更多的阶段数）和不同的稳定性限制相平衡的。",
            "id": "4092970",
            "problem": "考虑一个代表数值天气预报 (NWP) 模型的线性平流方程的一维、周期性、半离散核心，其中预报变量 $u(x,t)$ 在恒定平流速度 $c$ 下遵循方程 $\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0$ 进行演变。在一个包含 $n$ 个点、解析长度为 $L$（单位：米）的区域的均匀网格上，使用二阶中心空间差分，该半离散系统可以写成 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L} \\mathbf{u}$ 的形式，其中离散算子 $\\mathbf{L}$ 的特征值为纯虚数，其幅值上限为 $\\omega_{\\max} = \\frac{c}{h}$，而 $h = \\frac{L}{n}$ 是网格间距。时间推进采用显式 Runge–Kutta (RK) 方法，时间积分器的稳定性、相容性和收敛性决定了在给定的最终时间 $T$（单位：秒）下允许的时间步长和由此产生的误差。\n\n定义一个方法 $m$，其阶数为 $p_m$（整数）、阶段数为 $s_m$（整数）、虚轴稳定性半径为 $R_m$（正实数），使得稳定性要求时间步长 $\\Delta t \\le \\frac{R_m}{\\omega_{\\max}}$。假设解是光滑的，在时间 $T$ 的全局误差界形式为 $E_m \\le C_m (\\Delta t)^{p_m}$，其中 $C_m$ 是一个与方法和解相关的误差系数，建模为 $C_m = \\gamma_m \\, \\omega_{\\max}^{p_m}$。这里 $\\gamma_m$ 是作为输入提供的无量纲常数。对于目标误差容限 $\\varepsilon$（无量纲），相容性和收敛性要求强制时间步长 $\\Delta t \\le \\left(\\frac{\\varepsilon}{C_m}\\right)^{1/p_m}$。因此，方法 $m$ 的可操作时间步长为\n$$\n\\Delta t_m = \\min\\left( \\frac{R_m}{\\omega_{\\max}}, \\left( \\frac{\\varepsilon}{\\gamma_m \\, \\omega_{\\max}^{p_m}} \\right)^{1/p_m} \\right).\n$$\n达到最终时间 $T$ 所需的总时间步数为 $N_m = \\left\\lceil \\frac{T}{\\Delta t_m} \\right\\rceil$，计算成本（以阶段计算为单位）为 $\\text{cost}_m = s_m \\, N_m$。\n\n你的任务是，对于每个提供的测试用例，计算经典的四阶 Runge–Kutta 方法 (RK4) 相对于二阶显式 Runge–Kutta 方法 (RK2) 的成本效益，在预设的目标误差下，权衡其更大的稳定时间步长和增加的阶段数。经典的四阶方法建模为 $p_{4} = 4$, $s_{4} = 4$, $R_{4} = 2.8$；二阶方法建模为 $p_{2} = 2$, $s_{2} = 2$, $R_{2} = 2.0$。使用成本比率\n$$\n\\text{ratio} = \\frac{\\text{cost}_{\\text{RK4}}}{\\text{cost}_{\\text{RK2}}}.\n$$\n\n所有物理量必须使用以下单位表示：\n- $L$ 的单位是米。\n- $c$ 的单位是米每秒。\n- $T$ 的单位是秒。\n- $\\varepsilon$ 是无量纲的。\n\n本问题不涉及角度。\n\n你的程序必须精确实现上述定义，并为每个测试用例生成定义的单个标量浮点数 $\\text{ratio}$，不带任何百分号。最终的程序输出必须是单行，包含一个用方括号括起来的逗号分隔列表，例如 $[\\text{result}_1,\\text{result}_2,\\ldots]$。\n\n使用以下包含四个案例的测试套件，这些案例探究了稳定性与精度控制的不同机制：\n\n测试用例 1（一般误差受限机制，典型中尺度）：\n- $L = 2.0\\times 10^{6}$,\n- $n = 800$,\n- $c = 40$,\n- $T = 10800$,\n- $\\varepsilon = 10^{-3}$,\n- $\\gamma_{4} = 1.0$,\n- $\\gamma_{2} = 1.0$.\n\n测试用例 2（细网格上宽松容限的稳定性受限机制）：\n- $L = 2.0\\times 10^{6}$,\n- $n = 4000$,\n- $c = 40$,\n- $T = 10800$,\n- $\\varepsilon = 10$,\n- $\\gamma_{4} = 1.0$,\n- $\\gamma_{2} = 1.0$.\n\n测试用例 3（粗网格上的严格精度机制）：\n- $L = 2.0\\times 10^{6}$,\n- $n = 200$,\n- $c = 40$,\n- $T = 10800$,\n- $\\varepsilon = 10^{-5}$,\n- $\\gamma_{4} = 1.0$,\n- $\\gamma_{2} = 1.0$.\n\n测试用例 4（RK4的临界条件，此时 RK4 的精度和稳定性限制达到平衡）：\n- $L = 2.0\\times 10^{6}$,\n- $n = 800$,\n- $c = 40$,\n- $T = 10800$,\n- $\\varepsilon = \\gamma_{4} R_{4}^{4}$，其中 $\\gamma_{4} = 0.01$（因此使用 $\\varepsilon = 0.01 \\times 2.8^{4}$），\n- $\\gamma_{2} = 0.01$.\n\n你的程序应生成一行输出，其中包含测试用例 1-4 的四个比率，格式为方括号括起来的逗号分隔列表（例如，$[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4]$）。计算结果必须是浮点数。不需要四舍五入；请打印由 Python 生成的完整精度。",
            "solution": "目标是计算经典的四阶 Runge–Kutta (RK4) 方法和二阶 Runge–Kutta (RK2) 方法在积分半离散化线性平流方程时的成本效益比。每种方法的成本是通过平衡两个相互竞争的因素来确定的：在给定误差容限 $\\varepsilon$ 下的数值稳定性和准确性。\n\n首先，我们确定半离散系统的最大频率，它决定了问题的刚性。给定区域长度 $L$、网格点数 $n$ 和平流速度 $c$，网格间距为 $h = \\frac{L}{n}$。最大频率由 $\\omega_{\\max} = \\frac{c}{h}$ 给出。这个值是确定时间步长稳定性和准确性约束的关键参数。\n\n对于一个通用的显式 Runge-Kutta 方法（用下标 $m$ 表示），其阶数为 $p_m$，阶段数为 $s_m$，稳定性半径为 $R_m$，可操作的时间步长 $\\Delta t_m$ 是以下两个限制中更严格的一个：\n\n1.  稳定性限制 $\\Delta t_{\\text{stab}, m}$，源于数值解不应出现伪增长的要求。对于特征值为纯虚数的问题，该限制由下式给出：\n    $$\n    \\Delta t_{\\text{stab}, m} = \\frac{R_m}{\\omega_{\\max}}\n    $$\n\n2.  准确性限制 $\\Delta t_{\\text{accu}, m}$，确保在最终时间 $T$ 时，数值解保持在预设的误差容限 $\\varepsilon$ 之内。问题提供了一个误差模型 $E_m \\le C_m (\\Delta t)^{p_m}$，误差系数为 $C_m = \\gamma_m \\omega_{\\max}^{p_m}$。为满足 $E_m \\le \\varepsilon$，时间步长必须受以下约束：\n    $$\n    \\Delta t_{\\text{accu}, m} = \\left( \\frac{\\varepsilon}{C_m} \\right)^{1/p_m} = \\left( \\frac{\\varepsilon}{\\gamma_m \\, \\omega_{\\max}^{p_m}} \\right)^{1/p_m}\n    $$\n    这可以重写为 $\\Delta t_{\\text{accu}, m} = \\frac{1}{\\omega_{\\max}} \\left(\\frac{\\varepsilon}{\\gamma_m}\\right)^{1/p_m}$。\n\n同时满足这两个条件的最大可能时间步长是这两个值的最小值：\n$$\n\\Delta t_m = \\min(\\Delta t_{\\text{stab}, m}, \\Delta t_{\\text{accu}, m}) = \\min\\left( \\frac{R_m}{\\omega_{\\max}}, \\frac{1}{\\omega_{\\max}} \\left(\\frac{\\varepsilon}{\\gamma_m}\\right)^{1/p_m} \\right)\n$$\n\n一旦确定了可操作的时间步长 $\\Delta t_m$，积分到最终时间 $T$ 所需的总步数通过将 $T$ 除以 $\\Delta t_m$ 并向上取整来计算，因为必须采用整数步数：\n$$\nN_m = \\left\\lceil \\frac{T}{\\Delta t_m} \\right\\rceil\n$$\n\n总计算成本，以阶段计算为单位度量，是每步的阶段数 $s_m$ 与总步数 $N_m$ 的乘积：\n$$\n\\text{cost}_m = s_m N_m\n$$\n\n该过程适用于 RK4 和 RK2 两种方法。问题为每种方法提供了具体参数：\n-   对于 RK4: $p_{4} = 4$, $s_{4} = 4$, $R_{4} = 2.8$.\n-   对于 RK2: $p_{2} = 2$, $s_{2} = 2$, $R_{2} = 2.0$.\n\n为每个测试用例计算出 $\\text{cost}_{\\text{RK4}}$ 和 $\\text{cost}_{\\text{RK2}}$ 后，最终的度量标准是它们的比率：\n$$\n\\text{ratio} = \\frac{\\text{cost}_{\\text{RK4}}}{\\text{cost}_{\\text{RK2}}}\n$$\n比率小于 1 表示 RK4 更高效，而比率大于 1 则意味着对于给定的问题参数和误差容限，RK2 更高效。实现将为提供的每个测试用例系统地执行这些计算。\n\n对于测试用例 4，误差容限 $\\varepsilon$ 由表达式 $\\varepsilon = \\gamma_{4} R_{4}^{4}$ 定义。将此代入 RK4 的准确性限制时间步长公式，可得：\n$$\n\\Delta t_{\\text{accu}, 4} = \\left( \\frac{\\gamma_{4} R_{4}^{4}}{\\gamma_{4} \\, \\omega_{\\max}^{4}} \\right)^{1/4} = \\left( \\frac{R_{4}^{4}}{\\omega_{\\max}^{4}} \\right)^{1/4} = \\frac{R_{4}}{\\omega_{\\max}} = \\Delta t_{\\text{stab}, 4}\n$$\n这表明，对于 RK4，$\\varepsilon$ 的这个特定选择使得稳定性和准确性限制相等，正如问题陈述中所描述的那样。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the cost ratio of RK4 to RK2 for a series of test cases\n    in numerical weather prediction modeling.\n    \"\"\"\n\n    # Define the parameters for the RK methods.\n    # (order, stages, stability_radius)\n    rk4_params = (4, 4, 2.8)\n    rk2_params = (2, 2, 2.0)\n\n    # Define the test cases from the problem statement.\n    # (L, n, c, T, epsilon, gamma_4, gamma_2)\n    test_cases = [\n        # Test Case 1\n        (2.0e6, 800, 40, 10800, 1e-3, 1.0, 1.0),\n        # Test Case 2\n        (2.0e6, 4000, 40, 10800, 10, 1.0, 1.0),\n        # Test Case 3\n        (2.0e6, 200, 40, 10800, 1e-5, 1.0, 1.0),\n        # Test Case 4\n        (2.0e6, 800, 40, 10800, 0.01 * (2.8**4), 0.01, 0.01)\n    ]\n\n    results = []\n\n    for case in test_cases:\n        L, n, c, T, epsilon, gamma_4, gamma_2 = case\n\n        # Calculate common physical and numerical parameters\n        h = L / n\n        omega_max = c / h\n\n        # --- Calculate cost for RK4 ---\n        p4, s4, R4 = rk4_params\n\n        # Stability-limited time step for RK4\n        dt_stab_4 = R4 / omega_max\n\n        # Accuracy-limited time step for RK4\n        C4 = gamma_4 * (omega_max ** p4)\n        dt_accu_4 = (epsilon / C4) ** (1.0 / p4)\n\n        # The operable time step is the minimum of the two\n        dt_4 = min(dt_stab_4, dt_accu_4)\n\n        # Number of steps and total cost for RK4\n        N_4 = np.ceil(T / dt_4)\n        cost_4 = s4 * N_4\n\n        # --- Calculate cost for RK2 ---\n        p2, s2, R2 = rk2_params\n\n        # Stability-limited time step for RK2\n        dt_stab_2 = R2 / omega_max\n\n        # Accuracy-limited time step for RK2\n        C2 = gamma_2 * (omega_max ** p2)\n        dt_accu_2 = (epsilon / C2) ** (1.0 / p2)\n\n        # The operable time step is the minimum of the two\n        dt_2 = min(dt_stab_2, dt_accu_2)\n\n        # Number of steps and total cost for RK2\n        N_2 = np.ceil(T / dt_2)\n        cost_2 = s2 * N_2\n\n        # --- Compute the cost ratio ---\n        if cost_2 == 0:\n            # Avoid division by zero, though unlikely with the given problem setup\n            ratio = float('inf') if cost_4 > 0 else 1.0\n        else:\n            ratio = cost_4 / cost_2\n\n        results.append(ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}