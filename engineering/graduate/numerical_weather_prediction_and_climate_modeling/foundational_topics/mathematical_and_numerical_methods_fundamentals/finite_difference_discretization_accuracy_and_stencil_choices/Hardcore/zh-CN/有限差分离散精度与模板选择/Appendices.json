{
    "hands_on_practices": [
        {
            "introduction": "模型的数值精度直接取决于其有限差分格式的阶数。本练习将引导你通过泰勒级数展开，从第一性原理出发推导一个高阶精度差分格式。此外，你还将学习使用傅里叶分析这一强大工具，来揭示离散算子在不同空间尺度上的行为特性，这是理解和评估数值格式稳定性和色散性的基础。",
            "id": "4042504",
            "problem": "考虑一个长度为 $L$ 的一维周期性纬向通道，该通道在数值天气预报（NWP）和气候模拟中用于表示水平均匀的动力学过程。设网格由 $N$ 个等距点组成，网格间距为 $h = L/N$，点的位置为 $x_{j} = j h$，其中 $j$ 为整数。一维连续拉普拉斯算子为 $\\nabla^{2} u = \\frac{d^{2} u}{d x^{2}}$。要求您为此网格上的 $\\nabla^{2}$ 构建一个四阶精度的有限差分格式，并利用傅里叶模态在周期性边界条件下确定其离散特征值。\n\n从基本原理出发，使用关于 $x_{j}$ 的泰勒展开，推导一个如下形式的对称五点模板\n$$\n\\mathcal{L}_{h} u_{j} \\equiv \\frac{a\\,u_{j-2} + b\\,u_{j-1} + c\\,u_{j} + b\\,u_{j+1} + a\\,u_{j+2}}{h^{2}},\n$$\n其中 $a$、$b$ 和 $c$ 是待定常数，使得对于光滑函数 $u(x)$，$\\mathcal{L}_{h} u_{j}$ 是在 $x_{j}$ 处逼近 $\\frac{d^{2}u}{dx^{2}}$ 的四阶精度格式。\n\n然后，使用傅里叶模态拟设 $u_{j} = \\exp(i k x_{j})$（其中波数 $k = \\frac{2 \\pi m}{L}$，$m$ 为整数）和周期性边界条件，确定由 $\\mathcal{L}_{h} u_{j} = \\lambda(k)\\, u_{j}$ 定义的离散特征值 $\\lambda(k)$。\n\n您的最终答案必须是关于波数 $k$ 和网格间距 $h$ 的 $\\lambda(k)$ 的单个闭式解析表达式。不需要进行数值计算。最终答案中请勿提供中间公式。如果引入任何缩写词，请在首次使用时写出全称。如果讨论到单位，请注意拉普拉斯算子的特征值单位是长度的平方的倒数，但不要在最终的方框答案中包含单位。",
            "solution": "用户要求推导一维拉普拉斯算子的四阶精度有限差分模板，并随后确定其在周期性边界条件下的离散特征值。\n\n首先，我将验证问题陈述。\n\n### 步骤1：提取已知条件\n- 域：长度为 $L$ 的一维周期性通道。\n- 网格：$N$ 个等距点，间距为 $h = L/N$，位置为 $x_{j} = j h$。\n- 连续算子：$\\nabla^{2} u = \\frac{d^{2} u}{d x^{2}}$。\n- 离散算子形式：$\\mathcal{L}_{h} u_{j} \\equiv \\frac{a\\,u_{j-2} + b\\,u_{j-1} + c\\,u_{j} + b\\,u_{j+1} + a\\,u_{j+2}}{h^{2}}$。\n- 精度要求：四阶，意味着截断误差为 $O(h^{4})$。\n- 分析工具：傅里叶模态拟设 $u_{j} = \\exp(i k x_{j})$，波数 $k = \\frac{2 \\pi m}{L}$，$m$ 为整数。\n- 特征值的定义：$\\mathcal{L}_{h} u_{j} = \\lambda(k)\\, u_{j}$。\n- 最终答案要求：关于 $k$ 和 $h$ 的 $\\lambda(k)$ 的单个闭式解析表达式。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它是数值分析领域的标准和基础练习，特别是用于流体动力学和地球物理模拟学科（如数值天气预报（NWP））的方法。该问题是适定的，具有明确的目标和足够的约束来确定唯一解。语言客观且数学上精确。该问题没有任何说明中列出的导致无效的缺陷。这是一个完整、一致且可形式化的理论问题。\n\n### 步骤3：结论与行动\n问题有效。我将继续进行详细解答。\n\n解答过程分为两部分：首先，确定模板系数 $a$、$b$ 和 $c$；其次，计算离散特征值 $\\lambda(k)$。\n\n第1部分：模板系数的推导\n\n我们的目标是找到常数 $a$、$b$ 和 $c$，使得离散算子 $\\mathcal{L}_{h} u_{j}$ 在点 $x_j$ 处逼近连续二阶导数 $\\frac{d^{2}u}{dx^{2}}$，且截断误差为 $h^4$ 阶。我们通过对 $u(x)$ 在点 $x_j$ 周围进行 Taylor 级数展开来实现这一目标。设 $u_j = u(x_j)$ 且 $u^{(n)}|_j = \\frac{d^n u}{dx^n}|_{x_j}$。\n\n模板中各项的 Taylor 展开为：\n$$u_{j \\pm p} = u(x_j \\pm ph) = u_j \\pm (ph) u'|_j + \\frac{(ph)^2}{2!} u''|_j \\pm \\frac{(ph)^3}{3!} u'''|_j + \\frac{(ph)^4}{4!} u^{(4)}|_j + \\frac{(ph)^5}{5!} u^{(5)}|_j + \\frac{(ph)^6}{6!} u^{(6)}|_j + O(h^7)$$\n由于模板的对称性（$u_{j-p}$ 和 $u_{j+p}$ 具有相同的系数），在求和时，奇数阶导数项会相互抵消。我们计算相关的对称和：\n$$u_{j-1} + u_{j+1} = 2u_j + h^2 u''|_j + \\frac{h^4}{12} u^{(4)}|_j + \\frac{h^6}{360} u^{(6)}|_j + O(h^8)$$\n$$u_{j-2} + u_{j+2} = 2u_j + 4h^2 u''|_j + \\frac{16h^4}{12} u^{(4)}|_j + \\frac{64h^6}{360} u^{(6)}|_j + O(h^8)$$\n将这些代入算子 $\\mathcal{L}_h u_j$ 的表达式中：\n$$h^2 \\mathcal{L}_h u_j = a(u_{j-2} + u_{j+2}) + b(u_{j-1} + u_{j+1}) + c u_j$$\n$$h^2 \\mathcal{L}_h u_j = a\\left(2u_j + 4h^2 u''|_j + \\frac{4h^4}{3} u^{(4)}|_j + \\dots\\right) + b\\left(2u_j + h^2 u''|_j + \\frac{h^4}{12} u^{(4)}|_j + \\dots\\right) + c u_j$$\n我们按 $u$ 的导数阶次整理各项：\n$$h^2 \\mathcal{L}_h u_j = (2a+2b+c)u_j + (4a+b)h^2 u''|_j + \\left(\\frac{4a}{3} + \\frac{b}{12}\\right)h^4 u^{(4)}|_j + O(h^6)$$\n为了使 $\\mathcal{L}_h u_j$ 成为 $u''|_j$ 的一致逼近，我们要求右侧 $h^2 u''|_j$ 的系数为 1，且低阶项（即 $u_j$）的系数为零。为了使逼近达到四阶精度， $h^4 u^{(4)}|_j$ 项的系数也必须为零。这给了我们一个关于 $a$、$b$ 和 $c$ 的三元线性方程组：\n1. $u_j$ 的系数：$2a + 2b + c = 0$\n2. $h^2 u''|_j$ 的系数：$4a + b = 1$\n3. $h^4 u^{(4)}|_j$ 的系数：$\\frac{4a}{3} + \\frac{b}{12} = 0$，化简为 $16a + b = 0$。\n\n由方程（3），我们得到 $b = -16a$。将其代入方程（2）得到 $4a - 16a = 1$，得出 $-12a = 1$，所以 $a = -\\frac{1}{12}$。\n因此，$b = -16(-\\frac{1}{12}) = \\frac{16}{12} = \\frac{4}{3}$。\n最后，由方程（1），我们得到 $c = -2a - 2b = -2(-\\frac{1}{12}) - 2(\\frac{4}{3}) = \\frac{1}{6} - \\frac{8}{3} = \\frac{1}{6} - \\frac{16}{6} = -\\frac{15}{6} = -\\frac{5}{2}$。\n这些系数为 $a = -\\frac{1}{12}$，$b = \\frac{4}{3}$，$c = -\\frac{5}{2}$。\n\n第2部分：离散特征值 $\\lambda(k)$ 的确定\n\n我们现在分析所推导的离散算子对单个傅里叶模态 $u_j = \\exp(ikx_j) = \\exp(ikjh)$ 的作用。相邻网格点上的值通过相移相关联：\n$$u_{j\\pm p} = \\exp(ik(j\\pm p)h) = \\exp(ikjh) \\exp(\\pm ikph) = u_j \\exp(\\pm ikph)$$\n我们将此代入离散算子表达式：\n$$\\mathcal{L}_{h} u_{j} = \\frac{1}{h^{2}} \\left( a u_{j-2} + b u_{j-1} + c u_j + b u_{j+1} + a u_{j+2} \\right)$$\n$$\\mathcal{L}_{h} u_{j} = \\frac{u_j}{h^{2}} \\left( a e^{-i2kh} + b e^{-ikh} + c + b e^{ikh} + a e^{i2kh} \\right)$$\n根据定义，$\\mathcal{L}_{h} u_{j} = \\lambda(k) u_j$，因此特征值 $\\lambda(k)$ 是乘以 $u_j$ 的项：\n$$\\lambda(k) = \\frac{1}{h^{2}} \\left( c + b(e^{ikh} + e^{-ikh}) + a(e^{i2kh} + e^{-i2kh}) \\right)$$\n使用 Euler 恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$，我们得到：\n$$\\lambda(k) = \\frac{1}{h^{2}} \\left( c + 2b \\cos(kh) + 2a \\cos(2kh) \\right)$$\n现在，我们代入 $a$、$b$ 和 $c$ 的值：\n$$\\lambda(k) = \\frac{1}{h^{2}} \\left( -\\frac{5}{2} + 2\\left(\\frac{4}{3}\\right) \\cos(kh) + 2\\left(-\\frac{1}{12}\\right) \\cos(2kh) \\right)$$\n$$\\lambda(k) = \\frac{1}{h^2} \\left( -\\frac{5}{2} + \\frac{8}{3} \\cos(kh) - \\frac{1}{6} \\cos(2kh) \\right)$$\n为了简化此表达式，我们将所有项通分，分母为 $6$：\n$$\\lambda(k) = \\frac{1}{6h^2} \\left( -15 + 16\\cos(kh) - \\cos(2kh) \\right)$$\n我们使用二倍角恒等式 $\\cos(2\\theta) = 2\\cos^2(\\theta) - 1$：\n$$\\lambda(k) = \\frac{1}{6h^2} \\left( -15 + 16\\cos(kh) - (2\\cos^2(kh) - 1) \\right)$$\n$$\\lambda(k) = \\frac{1}{6h^2} \\left( -14 + 16\\cos(kh) - 2\\cos^2(kh) \\right)$$\n提出因子 $-2$：\n$$\\lambda(k) = \\frac{-2}{6h^2} \\left( \\cos^2(kh) - 8\\cos(kh) + 7 \\right)$$\n$$\\lambda(k) = -\\frac{1}{3h^2} \\left( \\cos^2(kh) - 8\\cos(kh) + 7 \\right)$$\n关于 $\\cos(kh)$ 的二次多项式可以因式分解为 $(\\cos(kh)-1)(\\cos(kh)-7)$。\n$$\\lambda(k) = -\\frac{1}{3h^2} (\\cos(kh) - 1)(\\cos(kh) - 7)$$\n此表达式可以使用半角恒等式 $\\cos(\\theta) - 1 = -2\\sin^2(\\frac{\\theta}{2})$ 进一步简化：\n$$\\lambda(k) = -\\frac{1}{3h^2} \\left(-2\\sin^2\\left(\\frac{kh}{2}\\right)\\right) \\left(\\cos(kh) - 7\\right)$$\n$$\\lambda(k) = \\frac{2}{3h^2} \\sin^2\\left(\\frac{kh}{2}\\right) \\left(\\cos(kh) - 7\\right)$$\n最后，使用 $\\cos(\\theta) = 1 - 2\\sin^2(\\frac{\\theta}{2})$ 将 $\\cos(kh)$ 表示为 $\\sin^2(\\frac{kh}{2})$ 的形式：\n$$\\lambda(k) = \\frac{2}{3h^2} \\sin^2\\left(\\frac{kh}{2}\\right) \\left( \\left(1 - 2\\sin^2\\left(\\frac{kh}{2}\\right)\\right) - 7 \\right)$$\n$$\\lambda(k) = \\frac{2}{3h^2} \\sin^2\\left(\\frac{kh}{2}\\right) \\left( -6 - 2\\sin^2\\left(\\frac{kh}{2}\\right) \\right)$$\n$$\\lambda(k) = -\\frac{4}{3h^2} \\sin^2\\left(\\frac{kh}{2}\\right) \\left( 3 + \\sin^2\\left(\\frac{kh}{2}\\right) \\right)$$\n这个最终形式特别具有启发性。相应的二阶精度模板的特征值是 $-\\frac{4}{h^2}\\sin^2(\\frac{kh}{2})$。我们的四阶特征值是对这个值的修正，缩放因子为 $\\frac{1}{3}(3+\\sin^2(\\frac{kh}{2}))$。当 $kh \\to 0$ 时，该因子趋近于 1，通过 Taylor 展开可以验证该格式的四阶精度。",
            "answer": "$$\\boxed{-\\frac{4}{3h^{2}} \\sin^{2}\\left(\\frac{kh}{2}\\right) \\left(3 + \\sin^{2}\\left(\\frac{kh}{2}\\right)\\right)}$$"
        },
        {
            "introduction": "在掌握了如何构建差分格式后，理解看似合理的选择可能带来的陷阱至关重要。本练习将探讨在Arakawa A-网格上使用中心差分所产生的问题，即出现一种非物理的“计算模态”。这个例子鲜明地说明了为什么离散格式与网格结构的选择紧密相关，并且对于保证模型的物理真实性至关重要。",
            "id": "4042432",
            "problem": "考虑一个一维无粘性浅水层，其平均深度为 $H$，重力加速度为 $g$。该水层位于一个长度为 $L$ 的 $x$ 方向周期性区域上，区域内有 $N$ 个均匀分布的网格点，网格间距为 $h = L/N$。该水层初始静止，并带有小扰动。针对小扰动的线性化浅水方程由动量守恒和质量守恒导出：动量方程为 $\\frac{\\partial u}{\\partial t} = - g \\, \\frac{\\partial \\eta}{\\partial x}$，质量连续性方程为 $\\frac{\\partial \\eta}{\\partial t} = - H \\, \\frac{\\partial u}{\\partial x}$，其中 $u(x,t)$ 是纬向速度，$\\eta(x,t)$ 是自由面位移。\n\n在阿拉川 A-网格（A-grid）上，$u$ 和 $\\eta$ 都配置在相同的网格点 $x_i = i h$（其中 $i$ 为整数）上。使用 A-网格上的二阶中心有限差分，构建线性化浅水方程的半离散形式（时间上连续，空间上离散），其中离散气压梯度算子作用于每个网格点上的 $\\eta$。假设采用周期性边界条件，因此指标对 $N$ 取模。\n\n将该半离散系统视为在离散平移下不变，考虑形如 $u_i(t) = U \\, \\exp\\!\\big(i (k x_i - \\omega t)\\big)$ 和 $\\eta_i(t) = \\Eta \\, \\exp\\!\\big(i (k x_i - \\omega t)\\big)$ 的离散正规模，其中 $k$ 为实数波数，$\\omega$ 为角频率。使用此拟设（ansatz），推导由半离散方程蕴含的离散色散关系 $\\omega(k)$，并严格证明波长为 $2h$ 的伪计算模态的出现，该模态通过离散气压梯度算子与速度解耦。\n\n最后，计算对应于波数 $k = \\pi/h$ 的 $2h$ 模态的角频率 $\\omega$，并报告其值。将最终的角频率以 $\\mathrm{s}^{-1}$ 为单位表示。无需四舍五入。",
            "solution": "基本依据是围绕静止状态和恒定深度线性化的浅水流的动量和质量守恒。一维空间中的线性化浅水方程为\n$$\n\\frac{\\partial u}{\\partial t} = - g \\, \\frac{\\partial \\eta}{\\partial x}, \\qquad\n\\frac{\\partial \\eta}{\\partial t} = - H \\, \\frac{\\partial u}{\\partial x}.\n$$\n在阿拉川 A-网格（A-grid）上，变量 $u$ 和 $\\eta$ 定义在相同的网格点 $x_i = i h$（其中 $i$ 为整数）上。我们用二阶中心有限差分来离散化空间导数。作用在网格点 $i$ 的离散自由面位移 $\\eta_i$ 上的离散气压梯度算子 $G$ 为\n$$\n(G \\eta)_i = \\frac{\\eta_{i+1} - \\eta_{i-1}}{2 h}.\n$$\n类似地，作用在 $u_i$ 上的离散散度算子 $D$ 为\n$$\n(D u)_i = \\frac{u_{i+1} - u_{i-1}}{2 h}.\n$$\n使用这些算子和周期性边界条件（指标对 $N$ 取模），半离散的线性化浅水方程为\n$$\n\\frac{d u_i}{d t} = - g \\, (G \\eta)_i = - g \\, \\frac{\\eta_{i+1} - \\eta_{i-1}}{2 h}, \\qquad\n\\frac{d \\eta_i}{d t} = - H \\, (D u)_i = - H \\, \\frac{u_{i+1} - u_{i-1}}{2 h}.\n$$\n为了分析模态结构，我们使用离散正规模拟设（ansatz）\n$$\nu_i(t) = U \\, \\exp\\!\\big(i (k x_i - \\omega t)\\big), \\qquad\n\\eta_i(t) = \\Eta \\, \\exp\\!\\big(i (k x_i - \\omega t)\\big),\n$$\n其中 $k$ 为实数，$\\omega$ 为复数（为了一般性）。在此拟设下，平面波的中心有限差分计算如下：\n$$\n\\frac{\\eta_{i+1} - \\eta_{i-1}}{2 h}\n= \\frac{\\Eta \\exp\\!\\big(i(k x_{i+1} - \\omega t)\\big) - \\Eta \\exp\\!\\big(i(k x_{i-1} - \\omega t)\\big)}{2 h}\n= \\frac{\\Eta \\exp\\!\\big(i(k x_i - \\omega t)\\big)\\big(\\exp(i k h) - \\exp(- i k h)\\big)}{2 h}\n= \\Eta \\exp\\!\\big(i(k x_i - \\omega t)\\big) \\cdot \\frac{i \\, \\sin(k h)}{h}.\n$$\n因此，作用在平面波上的离散梯度算子产生原波乘以 $i D(k)$，其中我们定义实数符号\n$$\nD(k) \\equiv \\frac{\\sin(k h)}{h}.\n$$\n作用在 $u_i$ 上的离散散度也同样成立，即\n$$\n\\frac{u_{i+1} - u_{i-1}}{2 h} = U \\exp\\!\\big(i(k x_i - \\omega t)\\big) \\cdot \\frac{i \\, \\sin(k h)}{h} = i D(k) \\, U \\exp\\!\\big(i(k x_i - \\omega t)\\big).\n$$\n将这些代入半离散方程，并消去公因子 $\\exp\\!\\big(i(k x_i - \\omega t)\\big)$，得到代数系统\n$$\n- i \\omega \\, U = - g \\, i D(k) \\, \\Eta \\quad \\Longrightarrow \\quad \\omega \\, U = g \\, D(k) \\, \\Eta,\n$$\n$$\n- i \\omega \\, \\Eta = - H \\, i D(k) \\, U \\quad \\Longrightarrow \\quad \\omega \\, \\Eta = H \\, D(k) \\, U.\n$$\n消去 $U$ 和 $\\Eta$ 得到离散色散关系。将第一个方程乘以 $\\omega$ 并代入第二个方程：\n$$\n\\omega^{2} \\, U = g \\, D(k) \\, \\omega \\, \\Eta = g \\, D(k) \\, \\big(H \\, D(k) \\, U\\big) \\quad \\Longrightarrow \\quad \\omega^{2} = g H \\, D(k)^{2}.\n$$\n用显式表示，\n$$\n\\omega^{2}(k) = g H \\left(\\frac{\\sin(k h)}{h}\\right)^{2}.\n$$\n这个关系式表明，离散空间差分通过将 $k$ 替换为离散波数函数 $\\sin(k h)/h$ 来修正连续色散关系 $\\omega^{2} = g H k^{2}$。\n\n我们现在来证明波长为 $2h$ 的伪计算模态。波长 $\\lambda$ 对应于波数 $k = 2 \\pi / \\lambda$。对于 $\\lambda = 2h$，波数为\n$$\nk = \\frac{2 \\pi}{2 h} = \\frac{\\pi}{h}.\n$$\n将离散波数函数在 $k = \\pi/h$ 处求值得到\n$$\nD\\!\\left(\\frac{\\pi}{h}\\right) = \\frac{\\sin\\!\\big((\\pi/h) h\\big)}{h} = \\frac{\\sin(\\pi)}{h} = 0.\n$$\n因此，离散气压梯度和散度算子会使 $2h$ 模态为零：\n$$\n(G \\eta)_i = \\frac{\\eta_{i+1} - \\eta_{i-1}}{2 h} = 0, \\qquad (D u)_i = \\frac{u_{i+1} - u_{i-1}}{2 h} = 0,\n$$\n对于任何交替的棋盘格模式 $\\eta_i \\propto (-1)^i$ 和 $u_i \\propto (-1)^i$。从物理上讲，对于这种网格尺度的模态，离散气压梯度为零，因此速度不受 $\\eta$ 的强迫作用；反之，散度为零，因此 $\\eta$ 不受 $u$ 的趋势影响。在模态分析中，这种解耦表现为\n$$\n\\omega^{2}\\!\\left(\\frac{\\pi}{h}\\right) = g H \\left(\\frac{\\sin(\\pi)}{h}\\right)^{2} = 0 \\quad \\Longrightarrow \\quad \\omega\\!\\left(\\frac{\\pi}{h}\\right) = 0.\n$$\n因此，$2h$ 模态是一个静止的伪计算模态，它由于 A-网格上的离散气压梯度算子而与动力学解耦。所要求的对应于 $k = \\pi/h$ 的角频率，以 $\\mathrm{s}^{-1}$ 为单位表示，其值为零。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "线性高阶格式在处理急剧梯度时，常会引入虚假的数值振荡，这是模拟物质输运过程中的一个主要障碍。本练习将介绍通量限制器的概念，用于构建总变差递减（TVD）格式。通过这项实践，你将超越线性格式的范畴，学习设计非线性的自适应方法，它既能在平滑区域保持高阶精度，又能有效抑制非物理振荡，这是现代计算流体力学的基石之一。",
            "id": "4042492",
            "problem": "考虑在数值天气预报和气候模拟中代表平流输运的一维线性守恒律，\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\big(c\\,u\\big) = 0,\n$$\n其中 $u=u(x,t)$ 是一个预报标量，$c0$ 是一个恒定的平流速度。设 $x_i = i\\,\\Delta x$ 为均匀网格，$t^n = n\\,\\Delta t$ 为均匀时间层，库朗数 $\\nu = c\\,\\Delta t/\\Delta x \\in (0,1)$。考虑一个守恒显式更新\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\Big(F_{i+1/2}^n - F_{i-1/2}^n\\Big),\n$$\n其中单元界面 $x_{i+1/2}$ 处的数值通量是通过一个非线性通量限制器，混合一阶迎风格式通量和二阶高阶通量来构造的，\n$$\nF_{i+1/2}^n = F^{\\mathrm{up}}_{i+1/2} + \\phi\\!\\big(r_{i+1/2}^n\\big)\\,\\Big(F^{\\mathrm{ho}}_{i+1/2} - F^{\\mathrm{up}}_{i+1/2}\\Big),\n$$\n其中 $F^{\\mathrm{up}}_{i+1/2} = c\\,u_i^n$，$F^{\\mathrm{ho}}_{i+1/2} = c\\,u_i^n + \\tfrac{c}{2}\\,(1-\\nu)\\,\\big(u_{i+1}^n - u_i^n\\big)$，并且对于 $c0$ 的梯度比定义为\n$$\nr_{i+1/2}^n = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n},\n$$\n约定当分母为零时 $r_{i+1/2}^n = 0$。限制器 $\\phi(r)$ 是一个局部作用于 $r$ 的标量函数。\n\n任务：\n- 从守恒律和上述定义出发，构造用 $u_{i-1}^n$、$u_i^n$、$u_{i+1}^n$ 以及限制器值 $\\phi\\!\\big(r_{i-1/2}^n\\big)$ 和 $\\phi\\!\\big(r_{i+1/2}^n\\big)$ 表示的 $u_i^{n+1}$ 的显式有限差分更新式。\n- 使用离散总变差 $\\mathrm{TV}(u^n) = \\sum_i \\big|u_{i+1}^n - u_i^n\\big|$ 和适用于显式迎风偏置格式的单调性论证，推导限制器 $\\phi(r)$ 需满足的充分条件，以使该格式对于所有 $\\nu \\in (0,1)$ 都是总变差递减 (TVD) 的。你的推导必须从守恒更新式出发，并强制要求当局部数据单调时，不产生新的局部极值。\n- 在满足你所推导的 TVD 约束并在光滑无极值区域（特别是确保 $\\phi(1)=1$）能达到二阶精度的限制器中，选择一个在约束允许范围内尽可能具有压缩性，并且相对于迎风和顺风界限是对称的限制器。将你的最终选择表示为仅使用代数运算以及作用于 $r$ 和常数的 $\\min(\\cdot,\\cdot)$ 和 $\\max(\\cdot,\\cdot)$ 函数的单一闭式解析表达式。\n\n答案规格：\n- 最终答案只提供你所选择的解析表达式 $\\phi(r)$。不需要单位。最终答案中不要包含任何额外文本。",
            "solution": "用户希望我解决一个关于偏微分方程数值方法的问题，具体是针对线性守恒律的总变差递减(TVD)格式。该问题分为三个部分：\n1.  构造显式有限差分更新公式。\n2.  推导通量限制器函数 $\\phi(r)$ 使格式成为TVD格式的充分条件。\n3.  选择一个二阶精度、具有压缩性且对称的特定TVD限制器。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n-   **守恒律**: $\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\big(c\\,u\\big) = 0$，其中 $c0$ 为常数。\n-   **离散化**: 均匀网格 $x_i = i\\,\\Delta x$，均匀时间层 $t^n = n\\,\\Delta t$。\n-   **库朗数**: $\\nu = c\\,\\Delta t/\\Delta x \\in (0,1)$。\n-   **守恒更新**: $u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\Big(F_{i+1/2}^n - F_{i-1/2}^n\\Big)$。\n-   **数值通量**: $F_{i+1/2}^n = F^{\\mathrm{up}}_{i+1/2} + \\phi\\!\\big(r_{i+1/2}^n\\big)\\,\\Big(F^{\\mathrm{ho}}_{i+1/2} - F^{\\mathrm{up}}_{i+1/2}\\Big)$。\n-   **一阶迎风通量**: $F^{\\mathrm{up}}_{i+1/2} = c\\,u_i^n$。\n-   **二阶高阶通量**: $F^{\\mathrm{ho}}_{i+1/2} = c\\,u_i^n + \\tfrac{c}{2}\\,(1-\\nu)\\,\\big(u_{i+1}^n - u_i^n\\big)$。\n-   **梯度比**: $r_{i+1/2}^n = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n}$，如果分母为零，则 $r_{i+1/2}^n = 0$。\n-   **限制器函数**: $\\phi(r)$ 是一个标量函数。\n\n**步骤2：使用提取的已知条件进行验证**\n\n该问题具有科学依据、适定且客观。它是计算流体力学和双曲守恒律数值分析领域的标准问题。所有定义（通量、库朗数、梯度比、通量限制器结构）都是标准的且自洽的。推导格式、寻找TVD条件以及选择特定限制器的任务定义明确，是该主题的核心。没有违反科学原理、缺失数据或主观论断的情况。\n\n**步骤3：结论与行动**\n\n问题有效。我将继续进行求解。\n\n### 第一部分：构造显式有限差分更新式\n\n我们从守恒更新公式开始：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\Big(F_{i+1/2}^n - F_{i-1/2}^n\\Big)\n$$\n数值通量 $F_{i+1/2}^n$ 由下式给出\n$$\nF_{i+1/2}^n = F^{\\mathrm{up}}_{i+1/2} + \\phi\\!\\big(r_{i+1/2}^n\\big)\\,\\Big(F^{\\mathrm{ho}}_{i+1/2} - F^{\\mathrm{up}}_{i+1/2}\\Big)\n$$\n首先，我们计算高阶通量和迎风通量之间的差值：\n$$\nF^{\\mathrm{ho}}_{i+1/2} - F^{\\mathrm{up}}_{i+1/2} = \\left(c\\,u_i^n + \\tfrac{c}{2}\\,(1-\\nu)\\,\\big(u_{i+1}^n - u_i^n\\big)\\right) - c\\,u_i^n = \\frac{c}{2}(1-\\nu)(u_{i+1}^n - u_i^n)\n$$\n将此代入 $F_{i+1/2}^n$ 的表达式中：\n$$\nF_{i+1/2}^n = c\\,u_i^n + \\phi\\big(r_{i+1/2}^n\\big) \\frac{c}{2}(1-\\nu)(u_{i+1}^n - u_i^n)\n$$\n界面 $x_{i-1/2}$ 处的通量通过将索引 $i$ 移至 $i-1$ 得到：\n$$\nF_{i-1/2}^n = c\\,u_{i-1}^n + \\phi\\big(r_{i-1/2}^n\\big) \\frac{c}{2}(1-\\nu)(u_i^n - u_{i-1}^n)\n$$\n现在，我们将这些通量表达式代入守恒更新公式。回想一下 $\\nu = c\\,\\Delta t/\\Delta x$：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\nu}{c} \\left[ \\left( c\\,u_i^n + \\phi\\big(r_{i+1/2}^n\\big) \\frac{c}{2}(1-\\nu)(u_{i+1}^n - u_i^n) \\right) - \\left( c\\,u_{i-1}^n + \\phi\\big(r_{i-1/2}^n\\big) \\frac{c}{2}(1-\\nu)(u_i^n - u_{i-1}^n) \\right) \\right]\n$$\n简化此表达式：\n$$\nu_i^{n+1} = u_i^n - \\nu \\left[ (u_i^n - u_{i-1}^n) + \\frac{1-\\nu}{2} \\left( \\phi\\big(r_{i+1/2}^n\\big)(u_{i+1}^n - u_i^n) - \\phi\\big(r_{i-1/2}^n\\big)(u_i^n - u_{i-1}^n) \\right) \\right]\n$$\n这可以重新排列以突出对一阶迎风格式的修正：\n$$\nu_i^{n+1} = u_i^n - \\nu(u_i^n - u_{i-1}^n) - \\frac{\\nu(1-\\nu)}{2} \\left[ \\phi\\big(r_{i+1/2}^n\\big)(u_{i+1}^n - u_i^n) - \\phi\\big(r_{i-1/2}^n\\big)(u_i^n - u_{i-1}^n) \\right]\n$$\n这就是 $u_i^{n+1}$ 的显式有限差分更新式。\n\n### 第二部分：推导充分的TVD条件\n\n如果离散解的总变差不随时间增加，即 $\\mathrm{TV}(u^{n+1}) \\le \\mathrm{TV}(u^n)$，其中 $\\mathrm{TV}(u^n) = \\sum_i |u_{i+1}^n - u_i^n|$，则该格式是总变差递减（TVD）的。一个格式成为TVD格式的充分条件是它不产生新的局部极值。对于一个 $c0$ 的迎风偏置格式，这可以通过确保当解是局部单调时（例如 $u_{i-1}^n \\le u_i^n \\le u_{i+1}^n$），新值 $u_i^{n+1}$ 保持在上一时间步的迎风邻居之间（即 $u_{i-1}^n \\le u_i^{n+1} \\le u_i^n$）来实现。\n\n为了分析这一点，我们将格式重写为增量形式 $u_i^{n+1} = u_i^n - C_i (u_i^n - u_{i-1}^n)$。对于单调数据，如果不产生新极值的条件得以满足，则系数 $C_i$ 需满足 $0 \\le C_i \\le 1$ 的界限。让我们将我们的格式表示成这种形式。设 $\\Delta u_{j-1/2}^n = u_j^n - u_{j-1}^n$。梯度比为 $r_{i+1/2}^n = \\Delta u_{i-1/2}^n / \\Delta u_{i+1/2}^n$。这使我们可以写出 $\\Delta u_{i+1/2}^n = \\Delta u_{i-1/2}^n / r_{i+1/2}^n$。将此代入更新公式中：\n$$\nu_i^{n+1} = u_i^n - \\nu \\Delta u_{i-1/2}^n - \\frac{\\nu(1-\\nu)}{2} \\left[ \\phi\\big(r_{i+1/2}^n\\big) \\frac{\\Delta u_{i-1/2}^n}{r_{i+1/2}^n} - \\phi\\big(r_{i-1/2}^n\\big)\\Delta u_{i-1/2}^n \\right]\n$$\n提出因子 $\\Delta u_{i-1/2}^n$：\n$$\nu_i^{n+1} = u_i^n - \\left[ \\nu + \\frac{\\nu(1-\\nu)}{2} \\left( \\frac{\\phi(r_{i+1/2}^n)}{r_{i+1/2}^n} - \\phi(r_{i-1/2}^n) \\right) \\right] (u_i^n - u_{i-1}^n)\n$$\n这是 $u_i^{n+1} = u_i^n - C_i (u_i^n - u_{i-1}^n)$ 的形式，其中系数 $C_i$ 为：\n$$\nC_i = \\nu + \\frac{\\nu(1-\\nu)}{2} \\left( \\frac{\\phi(r_{i+1/2}^n)}{r_{i+1/2}^n} - \\phi(r_{i-1/2}^n) \\right)\n$$\n条件 $0 \\le C_i \\le 1$ 必须对任何局部单调数据成立，这意味着对任何一对非负梯度比 $r_{i+1/2}^n$ 和 $r_{i-1/2}^n$ 以及任何 $\\nu \\in (0,1)$ 都成立。设 $r_1 = r_{i+1/2}^n$ 和 $r_2 = r_{i-1/2}^n$。设 $\\psi(r) = \\phi(r)/r$。条件是：\n$$\n0 \\le \\nu + \\frac{\\nu(1-\\nu)}{2} \\left( \\psi(r_1) - \\phi(r_2) \\right) \\le 1\n$$\n为了获得独立于 $\\nu$ 和特定数据（即独立于 $r_1$ 和 $r_2$）的关于 $\\phi(r)$ 的充分条件，我们可以对 $\\phi(r)$ 和 $\\psi(r)$ 施加更严格的局部界限。让我们根据物理推理假设，在极值点（其中 $r \\le 0$），格式应退化为具有耗散性的一阶格式，这要求对于 $r \\le 0$ 有 $\\phi(r) = 0$。对于单调区域 ($r0$)，我们假设 $\\phi(r) \\ge 0$。\n\n从右侧不等式 $C_i \\le 1$ 可得：\n$$ \\nu + \\frac{\\nu(1-\\nu)}{2} (\\psi(r_1) - \\phi(r_2)) \\le 1 \\implies \\frac{\\nu(1-\\nu)}{2} (\\psi(r_1) - \\phi(r_2)) \\le 1-\\nu $$\n对于 $\\nu  1$，我们可以除以 $1-\\nu$：$\\frac{\\nu}{2}(\\psi(r_1) - \\phi(r_2)) \\le 1 \\implies \\psi(r_1) - \\phi(r_2) \\le \\frac{2}{\\nu}$。\n这必须对所有的 $r_1, r_2  0$ 和所有的 $\\nu \\in (0,1)$ 成立。最坏的情况（限制最强）是当 $\\nu \\to 1$ 时，得到 $\\psi(r_1) - \\phi(r_2) \\le 2$。为了对任意 $r_1, r_2$ 满足此条件，我们可以对 $r_1$ 取上确界，对 $r_2$ 取下确界。假设 $\\phi(r) \\ge 0$，则 $\\inf_{r_20} \\phi(r_2) = 0$。这给出 $\\sup_{r_10} \\psi(r_1) \\le 2$。因此，一个充分条件是对于所有 $r0$ 有 $\\phi(r)/r \\le 2$。\n\n从左侧不等式 $C_i \\ge 0$ 可得：\n$$ \\nu + \\frac{\\nu(1-\\nu)}{2} (\\psi(r_1) - \\phi(r_2)) \\ge 0 $$\n除以 $\\nu  0$：$1 + \\frac{1-\\nu}{2} (\\psi(r_1) - \\phi(r_2)) \\ge 0 \\implies \\phi(r_2) - \\psi(r_1) \\le \\frac{2}{1-\\nu}$。\n为了对任意 $r_1, r_2  0$ 和任意 $\\nu \\in (0,1)$ 满足此条件，我们必须对左侧进行限定。对 $r_2$ 取上确界，对 $r_1$ 取下确界：$\\sup_{r_20} \\phi(r_2) - \\inf_{r_10} \\psi(r_1) \\le \\frac{2}{1-\\nu}$。假设 $\\psi(r)=\\phi(r)/r \\ge 0$，其下确界为 0。这剩下 $\\sup_{r0} \\phi(r) \\le \\frac{2}{1-\\nu}$。为了对所有 $\\nu \\in (0,1)$ 满足此条件，我们需要一个统一的界限。强制执行此条件的一个简单方法是要求 $\\phi(r) \\le 2$，这对任何 $\\nu \\in (0,1)$ 都满足不等式。\n\n因此，对于所有 $\\nu \\in (0,1)$，该格式成为 TVD 格式的充分条件是：\n1.  对于 $r \\le 0$，$\\phi(r) = 0$。\n2.  对于 $r  0$：$\\phi(r) \\le 2$ 且 $\\phi(r) \\le 2r$。\n对于 $r0$ 的这两个条件可以合并为 $0 \\le \\phi(r) \\le \\min(2, 2r)$。这定义了通量限制器的所谓“TVD区域”。\n\n### 第三部分：选择一个特定的限制器\n\n我们需要一个满足以下条件的限制器：\n1.  是 TVD 的，即位于上述推导的区域内。\n2.  在光滑区域达到二阶精度。在光滑、非极值区域，$u_{i+1}^n - u_i^n \\approx u_i^n - u_{i-1}^n \\ne 0$，所以 $r \\approx 1$。为了恢复二阶格式，混合因子 $\\phi(r_{i+1/2}^n)$ 必须为 $1$。因此，我们要求 $\\phi(1)=1$。在 $r=1$ 处的 TVD 区域是 $0 \\le \\phi(1) \\le \\min(2,2) = 2$，所以 $\\phi(1)=1$ 是一个有效的选择。\n3.  尽可能具有压缩性。压缩性限制器具有较大的 $\\phi(r)$ 值，倾向于遵循 TVD 区域的上边界。这有助于锐化间断。\n4.  是对称的。如果一个限制器满足条件 $\\phi(r)/r = \\phi(1/r)$，则称其为对称的。此属性确保了迎风和顺风梯度以对称的方式加权。\n\n我们正在寻找一个满足所有这些标准的限制器。Minmod 限制器 $\\phi(r)=\\max(0, \\min(1, r))$ 是 TVD 和对称的，但它是压缩性最弱（耗散性最强）的对称选择。Van Leer 限制器 $\\phi(r) = \\frac{2r}{1+r}$ (对于 $r0$) 是一个光滑、对称且更具压缩性的选择。\n\n问题要求选择一个在对称的同时“尽可能具有压缩性”的限制器。这指向了 Superbee 限制器。它的定义是位于对称 TVD 限制器所允许的子区域的上边界上。其解析形式为：\n$$\n\\phi(r) = \\max\\Big(0, \\min(1, 2r), \\min(r, 2)\\Big)\n$$\n让我们验证它的属性：\n-   **TVD**：对于 $r0$，$\\phi(r) = \\max(0, \\min(1, 2r), \\min(r, 2))$。\n    -   如果 $0  r \\le 1/2$，$\\phi(r) = \\max(0, 2r, r) = 2r$。这满足 $\\phi \\le 2r$ 和 $\\phi \\le 2$ （因为 $2r \\le 1$）。\n    -   如果 $1/2  r \\le 1$，$\\phi(r) = \\max(0, 1, r) = 1$。这满足 $\\phi=1 \\le 2r$ (因为 $r > 1/2$) 和 $\\phi=1 \\le 2$。\n    -   如果 $1  r \\le 2$，$\\phi(r) = \\max(0, 1, r) = r$。这满足 $\\phi=r \\le 2r$ 和 $\\phi=r \\le 2$。\n    -   如果 $r  2$，$\\phi(r) = \\max(0, 1, 2) = 2$。这满足 $\\phi=2 \\le 2r$ (因为 $r > 1$) 和 $\\phi=2 \\le 2$。\n    在所有 $r0$ 的情况下，$\\phi(r)$ 均位于 TVD 区域内。对于 $r \\le 0$，$\\phi(r)=0$。\n-   **二阶精度**：对于 $r=1$，$\\phi(1)=\\max(0, \\min(1,2), \\min(1,2)) = 1$。\n-   **对称性**：我们检查是否 $\\phi(r)/r = \\phi(1/r)$。对于 $r=4$，$\\phi(4)=2$，所以 $\\phi(4)/4 = 1/2$。对于 $1/r=1/4$，$\\phi(1/4)=2(1/4)=1/2$。条件成立。这可以对所有 $r0$ 进行验证。\n-   **压缩性**：Superbee 是已知的常见对称 TVD 限制器中压缩性最强的。\n\nSuperbee 限制器满足所有指定要求。最终答案是其解析表达式。",
            "answer": "$$\n\\boxed{\\max\\Big(0, \\min(1, 2r), \\min(r, 2)\\Big)}\n$$"
        }
    ]
}