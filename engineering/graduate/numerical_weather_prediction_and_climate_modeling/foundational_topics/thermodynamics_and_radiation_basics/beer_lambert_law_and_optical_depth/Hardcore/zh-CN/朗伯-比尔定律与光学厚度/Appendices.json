{
    "hands_on_practices": [
        {
            "introduction": "精确计算大气吸收需要确定光线穿行路径的长度。本练习将引导你超越简单的平面平行大气假设，为更真实的球层大气推导大气质量因子（Air Mass Factor, AMF）。通过运用渐近分析，你将掌握一项将复杂物理问题简化为气候模型中实用形式的关键技能。",
            "id": "4016471",
            "problem": "考虑一个用于数值天气预报和气候模型的晴朗、水平均匀大气。假设大气处于静力平衡、等温状态，并且可以用理想气体定律很好地描述，因此质量密度随几何高度呈指数下降，$\\rho(h) = \\rho_{0} \\exp(-h/H)$，其中 $H$ 是密度标高，$\\rho_{0}$ 是海平面密度。假设在一个光谱窄带中，质量消光系数 $\\kappa$ 不随高度变化。忽略进入大气的水平传播太阳光束；而是考虑在海平面（$h=0$）沿一条与天顶角成 $\\theta$（与当地垂直方向的夹角）的直线视线进行的地面向上辐射测量，并忽略大气折射。\n\n从第一性原理出发，即比尔-朗伯定律 $dI/ds = -\\kappa \\rho(s)\\, I(s)$ 以及射线路径与半径为 $R_{\\mathrm{e}}$ 的球形地球之间的几何关系，推导斜程光学厚度 $\\tau(\\theta)$ 和大气质量因子（AMF）的前导渐近表达式 $M(\\theta) = \\tau(\\theta)/\\tau(0)$，该表达式在 $H/R_{\\mathrm{e}}$ 较小时有效。你的推导必须只使用上述假设、静力平衡所暗示的指数密度剖面以及球形大气中的直线几何。将 $H/R_{\\mathrm{e}}$ 视为小参数，并保留至 $H/R_{\\mathrm{e}}$ 的一阶项。\n\n然后，对于 $H = 7.5~\\mathrm{km}$ 和 $R_{\\mathrm{e}} = 6371~\\mathrm{km}$，计算所得 $M(\\theta)$ 在 $\\theta = 80^\\circ$ 时的值。将 $M(80^\\circ)$ 的最终数值表示为一个纯数，并将答案四舍五入到四位有效数字。整个过程中角度使用度数。",
            "solution": "用户希望在球形等温大气中推导大气质量因子（AMF）的渐近表达式，然后针对一个特定情况进行求值。\n\n### 第1步：问题验证\n\n**1.1. 提取已知条件**\n- 大气模型：晴朗、水平均匀、静力平衡、等温、理想气体定律。\n- 质量密度剖面：$\\rho(h) = \\rho_{0} \\exp(-h/H)$，其中 $h$ 是几何高度，$\\rho_{0}$ 是海平面密度，$H$ 是密度标高。\n- 质量消光系数：$\\kappa$，随高度恒定。\n- 辐射传输定律：比尔-朗伯定律，$dI/ds = -\\kappa \\rho(s) I(s)$。\n- 几何：半径为 $R_{\\mathrm{e}}$ 的球形地球。视线是从海平面（$h=0$）出发，天顶角为 $\\theta$ 的直线。忽略折射。\n- 渐近展开参数：$H/R_{\\mathrm{e}}$ 很小。保留到 $H/R_{\\mathrm{e}}$ 的一阶项。\n- 大气质量因子（AMF）的定义：$M(\\theta) = \\tau(\\theta)/\\tau(0)$，其中 $\\tau(\\theta)$ 是斜程光学厚度。\n- 用于计算的数值：\n  - 天顶角：$\\theta = 80^\\circ$\n  - 密度标高：$H = 7.5~\\mathrm{km}$\n  - 地球半径：$R_{\\mathrm{e}} = 6371~\\mathrm{km}$\n- 要求输出：\n  1. 推导 $\\tau(\\theta)$ 和 $M(\\theta)$ 的前导渐近表达式。\n  2. 将 $M(80^\\circ)$ 的数值四舍五入到四位有效数字。\n\n**1.2. 使用提取的已知条件进行验证**\n- **科学依据：**该问题使用了一个标准的、简化的大气模型（等温、指数密度），这是大气物理学中常见且有效的一阶近似。比尔-朗伯定律是辐射传输的基本原理。几何结构是一个标准的球壳模型。该问题在科学上是合理的。\n- **适定性：**问题清楚地指明了出发原理、假设、要求的推导（渐近展开）和最终计算。可以根据给定信息确定唯一解。\n- **客观性：**语言技术性强且精确，没有主观或模糊的陈述。\n- **完整性和一致性：**提供了推导和计算所需的所有必要信息。各项假设内部一致（静力+等温意味着指数密度）。\n- **可行性：**条件和数值对于地球大气层是物理上现实的。\n\n**1.3. 结论与行动**\n问题有效。我将继续进行推导和求解。\n\n### 第2步：推导与求解\n\n光学厚度 $\\tau$ 由微分关系 $d\\tau = \\kappa \\rho ds$ 定义，其中 $ds$ 是微分路径长度。从地面（$s=0$）到大气层顶部（$s \\to \\infty$）的总斜程光学厚度由以下积分给出：\n$$ \\tau(\\theta) = \\int_{0}^{\\infty} \\kappa \\rho(s) ds $$\n质量消光系数 $\\kappa$ 是常数。密度 $\\rho$ 取决于高度 $h$。我们必须利用球形地球的几何关系来关联路径长度 $s$ 和高度 $h$。\n\n设观测者位于地球表面（半径为 $R_{\\mathrm{e}}$）上的 $O$ 点。地球中心为 $C$ 点。光线直线路径上的 $P$ 点距离观测者为 $s$，海拔高度为 $h$。$O$ 点的当地垂直方向与光线路径之间的夹角是天顶角 $\\theta$。对三角形 $\\triangle COP$ 应用余弦定理，其边长为 $CO = R_{\\mathrm{e}}$，$CP = R_{\\mathrm{e}} + h$ 和 $OP = s$，且 $O$ 点的角为 $180^{\\circ} - \\theta$：\n$$ (R_{\\mathrm{e}} + h)^2 = R_{\\mathrm{e}}^2 + s^2 - 2 R_{\\mathrm{e}} s \\cos(180^{\\circ} - \\theta) $$\n$$ (R_{\\mathrm{e}} + h)^2 = R_{\\mathrm{e}}^2 + s^2 + 2 R_{\\mathrm{e}} s \\cos(\\theta) $$\n为了将路径元 $ds$ 与高度增量 $dh$ 联系起来，我们对该方程关于 $s$ 求导：\n$$ 2(R_{\\mathrm{e}} + h) \\frac{dh}{ds} = 2s + 2 R_{\\mathrm{e}} \\cos(\\theta) $$\n$$ \\frac{dh}{ds} = \\frac{s + R_{\\mathrm{e}} \\cos(\\theta)}{R_{\\mathrm{e}} + h} $$\n我们可以解这个关于 $s$ 的二次方程得到 $s = -R_{\\mathrm{e}}\\cos(\\theta) + \\sqrt{(R_{\\mathrm{e}}+h)^2 - R_{\\mathrm{e}}^2 \\sin^2(\\theta)}$。将此代入 $dh/ds$ 的表达式中：\n$$ \\frac{dh}{ds} = \\frac{\\sqrt{(R_{\\mathrm{e}}+h)^2 - R_{\\mathrm{e}}^2 \\sin^2(\\theta)}}{R_{\\mathrm{e}} + h} = \\sqrt{1 - \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 \\sin^2(\\theta)} $$\n这给出了关联 $ds$ 和 $dh$ 的几何因子：\n$$ ds = \\frac{dh}{\\sqrt{1 - \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 \\sin^2(\\theta)}} $$\n斜程光学厚度的积分变为：\n$$ \\tau(\\theta) = \\int_{0}^{\\infty} \\kappa \\rho_{0} \\exp(-h/H) \\left[1 - \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 \\sin^2(\\theta)\\right]^{-\\frac{1}{2}} dh $$\n问题要求对小的 $H/R_{\\mathrm{e}}$ 进行渐近展开。项 $\\exp(-h/H)$ 确保了积分的主要贡献来自高度 $h$ 在标高 $H$ 量级的范围内。因此，我们可以对小的 $h/R_{\\mathrm{e}}$ 展开几何因子。令 $x = h/R_{\\mathrm{e}}$。\n$$ \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 = (1 + x)^{-2} \\approx 1 - 2x + O(x^2) $$\n将此代入平方根内的项：\n$$ 1 - (1 - 2x)\\sin^2(\\theta) = 1 - \\sin^2(\\theta) + 2x\\sin^2(\\theta) = \\cos^2(\\theta) + 2\\frac{h}{R_{\\mathrm{e}}}\\sin^2(\\theta) $$\n几何因子变为：\n$$ \\left(\\cos^2(\\theta) + 2\\frac{h}{R_{\\mathrm{e}}}\\sin^2(\\theta)\\right)^{-\\frac{1}{2}} = \\frac{1}{\\cos(\\theta)} \\left(1 + \\frac{2h}{R_{\\mathrm{e}}} \\frac{\\sin^2(\\theta)}{\\cos^2(\\theta)}\\right)^{-\\frac{1}{2}} = \\sec(\\theta) \\left(1 + \\frac{2h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right)^{-\\frac{1}{2}} $$\n对小的 $u$ 使用二项式近似 $(1+u)^{-\\frac{1}{2}} \\approx 1 - \\frac{1}{2}u$：\n$$ \\sec(\\theta) \\left(1 - \\frac{1}{2} \\frac{2h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) = \\sec(\\theta) \\left(1 - \\frac{h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) $$\n这个表达式是几何因子的一阶近似。我们将其代入 $\\tau(\\theta)$ 的积分中：\n$$ \\tau(\\theta) \\approx \\kappa \\rho_0 \\int_{0}^{\\infty} \\exp(-h/H) \\sec(\\theta) \\left(1 - \\frac{h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) dh $$\n$$ \\tau(\\theta) \\approx \\kappa \\rho_0 \\sec(\\theta) \\left[ \\int_{0}^{\\infty} \\exp(-h/H) dh - \\frac{\\tan^2(\\theta)}{R_{\\mathrm{e}}} \\int_{0}^{\\infty} h \\exp(-h/H) dh \\right] $$\n我们现在计算这两个积分：\n第一个积分是：\n$$ \\int_{0}^{\\infty} \\exp(-h/H) dh = \\left[-H \\exp(-h/H)\\right]_{0}^{\\infty} = 0 - (-H) = H $$\n第二个积分可以使用分部积分法求解，或者将其识别为伽玛函数。令 $u=h/H$，则 $h=uH$ 且 $dh=Hdu$：\n$$ \\int_{0}^{\\infty} h \\exp(-h/H) dh = \\int_{0}^{\\infty} uH \\exp(-u) Hdu = H^2 \\int_{0}^{\\infty} u \\exp(-u) du = H^2 \\Gamma(2) = H^2(1!) = H^2 $$\n将这些结果代回 $\\tau(\\theta)$ 的表达式中：\n$$ \\tau(\\theta) \\approx \\kappa \\rho_0 H \\sec(\\theta) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) $$\n这就是所要求的斜程光学厚度 $\\tau(\\theta)$ 的前导渐近表达式。\n\n接下来，我们求垂直光学厚度 $\\tau(0)$，它对应于 $\\theta=0$。在这种情况下，$ds = dh$。\n$$ \\tau(0) = \\int_{0}^{\\infty} \\kappa \\rho(h) dh = \\kappa \\rho_0 \\int_{0}^{\\infty} \\exp(-h/H) dh = \\kappa \\rho_0 H $$\n大气质量因子（AMF）定义为 $M(\\theta) = \\tau(\\theta)/\\tau(0)$。\n$$ M(\\theta) \\approx \\frac{\\kappa \\rho_0 H \\sec(\\theta) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right)}{\\kappa \\rho_0 H} $$\n$$ M(\\theta) \\approx \\sec(\\theta) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) $$\n这就是所要求的 AMF 的渐近表达式，在 $H/R_{\\mathrm{e}}$ 的一阶范围内有效。\n\n最后，我们用给定值计算此表达式：$\\theta = 80^\\circ$，$H = 7.5~\\mathrm{km}$，以及 $R_{\\mathrm{e}} = 6371~\\mathrm{km}$。\n比率 $H/R_{\\mathrm{e}}$ 是：\n$$ \\frac{H}{R_{\\mathrm{e}}} = \\frac{7.5}{6371} \\approx 0.00117718 $$\n所需的三角函数是：\n$$ \\sec(80^\\circ) = \\frac{1}{\\cos(80^\\circ)} \\approx 5.758770 $$\n$$ \\tan(80^\\circ) \\approx 5.671282 $$\n$$ \\tan^2(80^\\circ) \\approx (5.671282)^2 \\approx 32.163334 $$\n现在，我们计算 $M(80^\\circ)$：\n$$ M(80^\\circ) \\approx \\sec(80^\\circ) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(80^\\circ)\\right) $$\n$$ M(80^\\circ) \\approx 5.758770 \\left(1 - (0.00117718) \\times (32.163334)\\right) $$\n$$ M(80^\\circ) \\approx 5.758770 \\left(1 - 0.037861\\right) $$\n$$ M(80^\\circ) \\approx 5.758770 \\times 0.962139 $$\n$$ M(80^\\circ) \\approx 5.54078 $$\n将结果四舍五入到四位有效数字，得到 $5.541$。",
            "answer": "$$\\boxed{5.541}$$"
        },
        {
            "introduction": "比尔-朗伯定律不仅关乎能量收支，它还决定了由太阳光驱动的化学反应速率。本练习将辐射传输与大气化学直接联系起来，要求你计算一种关键痕量气体的光解速率。你将看到太阳辐射的衰减如何决定局地光化通量，这是任何化学-气候模型中的一个关键输入参数。",
            "id": "4016472",
            "problem": "一个平行平面大气被固定太阳天顶角的太阳所照射。考虑一个从 $335~\\mathrm{nm}$ 到 $345~\\mathrm{nm}$ 的狭窄紫外波段，在此波段内光子通量被视为光谱上恒定。忽略所有散射以及除臭氧外的任何其他吸收体。在参考高度 $z=0$（取为对流层顶）以上的大气中，含有臭氧，其数密度廓线呈指数衰减，对于 $z\\geq 0$ 为 $n_{\\text{O}_3}(z)=n_{0}\\exp(-z/H)$，其中 $n_{0}$ 是 $z=0$ 处的臭氧数密度，而 $H$ 是臭氧标高。太阳的方向余弦为 $\\mu=\\cos(\\mathrm{SZA})$，其中太阳天顶角（SZA）是当地天顶与太阳之间的夹角。在大气层顶（TOA），在 $335$–$345~\\mathrm{nm}$ 波段上积分的光化光子通量为 $F_{\\mathrm{TOA}}$，并且在此波段内，臭氧的吸收截面为 $\\sigma_{\\text{O}_3}$（假定在整个波段和空间上为常数）。存在于 $z=0$ 处的痕量物种 $\\text{NO}_2$ 在此波段发生光解，其吸收截面为 $\\sigma_{\\text{NO}_2}$（假定在整个波段上为常数），量子产率为 $\\phi_{\\text{NO}_2}$。\n\n从纯吸收介质中沿太阳直射光束的一维辐射传输定律以及平行平面大气中斜程的适当几何关系出发，推导在 $z=0$ 处波段积分的光化光子通量的解析表达式，该表达式是 $F_{\\mathrm{TOA}}$、$\\sigma_{\\text{O}_3}$、$n_{0}$、$H$ 和 $\\mu$ 的函数。然后，使用该表达式，计算在 $335$–$345~\\mathrm{nm}$ 波段内 $z=0$ 处的光解速率系数 $J_{\\text{NO}_2}$，假定由 $\\text{NO}_2$ 引起的衰减与臭氧相比可以忽略不计。使用以下参数值\n- $F_{\\mathrm{TOA}}=8.0\\times 10^{18}~\\mathrm{photons\\,m}^{-2}\\mathrm{\\,s}^{-1}$，\n- $\\sigma_{\\text{O}_3}=2.0\\times 10^{-23}~\\mathrm{m}^{2}$，\n- $n_{0}=1.2\\times 10^{19}~\\mathrm{m}^{-3}$，\n- $H=7.0\\times 10^{3}~\\mathrm{m}$，\n- $\\mu=0.65$，\n- $\\sigma_{\\text{NO}_2}=1.0\\times 10^{-23}~\\mathrm{m}^{2}$，\n- $\\phi_{\\text{NO}_2}=1.0$。\n\n将 $J_{\\text{NO}_2}$ 的最终数值四舍五入到三位有效数字。以 $\\mathrm{s}^{-1}$ 为单位表示最终的光解速率。",
            "solution": "用户提供了一个问题，在尝试解决之前需要进行验证。\n\n### 第 1 步：提取已知条件\n-   大气：平行平面\n-   太阳照射：固定的太阳天顶角 (SZA)\n-   波段：$335~\\mathrm{nm}$ 至 $345~\\mathrm{nm}$\n-   波段内光子通量：被视为光谱上恒定\n-   散射：忽略\n-   吸收体：仅考虑臭氧（$\\text{O}_3$）引起的衰减\n-   参考高度：$z=0$（对流层顶）\n-   $z \\ge 0$ 时的臭氧数密度廓线：$n_{\\text{O}_3}(z)=n_{0}\\exp(-z/H)$\n-   $n_{0}$：$z=0$ 处的臭氧数密度\n-   $H$：臭氧标高\n-   太阳的方向余弦：$\\mu=\\cos(\\mathrm{SZA})$\n-   大气层顶的波段积分光化光子通量：$F_{\\mathrm{TOA}} = 8.0\\times 10^{18}~\\mathrm{photons\\,m}^{-2}\\mathrm{\\,s}^{-1}$\n-   臭氧吸收截面（常数）：$\\sigma_{\\text{O}_3} = 2.0\\times 10^{-23}~\\mathrm{m}^{2}$\n-   $z=0$ 处的痕量物种：$\\text{NO}_2$\n-   $\\text{NO}_2$ 吸收截面（常数）：$\\sigma_{\\text{NO}_2} = 1.0\\times 10^{-23}~\\mathrm{m}^{2}$\n-   $\\text{NO}_2$ 量子产率（常数）：$\\phi_{\\text{NO}_2} = 1.0$\n-   假设：与臭氧相比，$\\text{NO}_2$ 的衰减可以忽略不计。\n-   要求计算：$z=0$ 处的光解速率系数 $J_{\\text{NO}_2}$。\n-   要求精度：将最终数值四舍五入到三位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n-   **科学依据**：该问题基于辐射传输（比尔-朗伯定律）、大气成分（指数密度廓线）和光化学（光解速率计算）的基本原理。这些是大气科学中的标准概念。所有方面都具有科学合理性。\n-   **适定性**：该问题提供了所有必要的参数和简化假设（平行平面几何、无散射、恒定截面），以推导唯一的解析表达式并计算数值答案。问题陈述清晰，结构合理。\n-   **客观性**：该问题使用精确、定量和客观的语言表述，没有任何主观或基于意见的陈述。\n-   所有其他无效性检查（例如，矛盾、不切实际的数据等）均已通过。给定的物理常数在指定的大气背景下具有合理的数量级。\n\n### 第 3 步：结论与行动\n该问题被判定为**有效**。将提供完整的解答。\n\n解答过程分为两个主要部分。首先，我们推导在 $z=0$ 高度处波段积分的光化光子通量的表达式。其次，我们使用这个结果计算在 $z=0$ 处的光解速率系数 $J_{\\text{NO}_2}$。\n\n对于一个纯吸收的平行平面大气，只考虑太阳直射光束，其辐射传输方程由比尔-朗伯定律给出。单色光化通量 $F(\\lambda)$ 沿斜程 $s$ 的变化为：\n$$\ndF(\\lambda) = - F(\\lambda) k_{\\text{abs}}(\\lambda, z) ds\n$$\n其中 $k_{\\text{abs}}(\\lambda, z)$ 是波长为 $\\lambda$、高度为 $z$ 处的吸收系数。对于臭氧吸收，该系数由 $k_{\\text{abs}}(\\lambda, z) = n_{\\text{O}_3}(z) \\sigma_{\\text{O}_3}(\\lambda)$ 给出。斜程路径元 $ds$ 与垂直路径元 $dz$ 的关系为 $ds = -dz/\\mu$，其中 $\\mu$ 是太阳天顶角的余弦。负号是因为辐射从大气层顶向下传播（$z$ 减小）。将这些代入方程得到：\n$$\n\\frac{dF(\\lambda)}{F(\\lambda)} = - n_{\\text{O}_3}(z) \\sigma_{\\text{O}_3}(\\lambda) \\left(-\\frac{dz}{\\mu}\\right) = \\frac{n_{\\text{O}_3}(z) \\sigma_{\\text{O}_3}(\\lambda)}{\\mu} dz\n$$\n为了求出在高度 $z$ 处的通量，我们从大气层顶（TOA，此处 $z \\to \\infty$ 且通量为 $F_{\\mathrm{TOA}}(\\lambda)$）向下积分到 $z$：\n$$\n\\int_{F_{\\mathrm{TOA}}(\\lambda)}^{F(\\lambda, z)} \\frac{dF'(\\lambda)}{F'(\\lambda)} = \\int_{\\infty}^{z} \\frac{n_{\\text{O}_3}(z') \\sigma_{\\text{O}_3}(\\lambda)}{\\mu} dz'\n$$\n$$\n\\ln\\left(\\frac{F(\\lambda, z)}{F_{\\mathrm{TOA}}(\\lambda)}\\right) = -\\frac{1}{\\mu} \\int_{z}^{\\infty} n_{\\text{O}_3}(z') \\sigma_{\\text{O}_3}(\\lambda) dz'\n$$\n右边的积分是从高度 $z$ 到大气层顶的臭氧垂直光学厚度 $\\tau_{\\text{O}_3}(\\lambda, z)$。\n$$\n\\tau_{\\text{O}_3}(\\lambda, z) = \\int_{z}^{\\infty} n_{\\text{O}_3}(z') \\sigma_{\\text{O}_3}(\\lambda) dz'\n$$\n因此，在高度 $z$ 处的单色通量为：\n$$\nF(\\lambda, z) = F_{\\mathrm{TOA}}(\\lambda) \\exp\\left(-\\frac{\\tau_{\\text{O}_3}(\\lambda, z)}{\\mu}\\right)\n$$\n我们已知臭氧数密度廓线为 $n_{\\text{O}_3}(z) = n_{0}\\exp(-z/H)$，并且吸收截面 $\\sigma_{\\text{O}_3}$ 在整个波段上为常数。我们可以计算 $z=0$ 以上的垂直光学厚度：\n$$\n\\tau_{\\text{O}_3}(0) = \\int_{0}^{\\infty} n_{0}\\exp(-z'/H) \\sigma_{\\text{O}_3} dz' = n_{0} \\sigma_{\\text{O}_3} \\int_{0}^{\\infty} \\exp(-z'/H) dz'\n$$\n$$\n\\tau_{\\text{O}_3}(0) = n_{0} \\sigma_{\\text{O}_3} [-H \\exp(-z'/H)]_{0}^{\\infty} = n_{0} \\sigma_{\\text{O}_3} [-H(0 - 1)] = n_{0} \\sigma_{\\text{O}_3} H\n$$\n由于 $\\sigma_{\\text{O}_3}$ 在整个波段上是常数，所以光学厚度也是常数。在 $z=0$ 处的波段积分光化通量，记为 $\\mathcal{F}(0)$，可以通过将 $F(\\lambda, 0)$ 在波长范围从 $\\lambda_1 = 335~\\mathrm{nm}$ 到 $\\lambda_2 = 345~\\mathrm{nm}$ 上积分得到：\n$$\n\\mathcal{F}(0) = \\int_{\\lambda_1}^{\\lambda_2} F(\\lambda, 0) d\\lambda = \\int_{\\lambda_1}^{\\lambda_2} F_{\\mathrm{TOA}}(\\lambda) \\exp\\left(-\\frac{n_{0} \\sigma_{\\text{O}_3} H}{\\mu}\\right) d\\lambda\n$$\n由于指数项不依赖于波长，可以将其从积分中提出：\n$$\n\\mathcal{F}(0) = \\exp\\left(-\\frac{n_{0} \\sigma_{\\text{O}_3} H}{\\mu}\\right) \\int_{\\lambda_1}^{\\lambda_2} F_{\\mathrm{TOA}}(\\lambda) d\\lambda\n$$\n该积分是给定的在大气层顶（TOA）的波段积分光化通量 $F_{\\mathrm{TOA}}$。因此，在 $z=0$ 处的波段积分光化通量为：\n$$\n\\mathcal{F}(0) = F_{\\mathrm{TOA}} \\exp\\left(-\\frac{n_{0} \\sigma_{\\text{O}_3} H}{\\mu}\\right)\n$$\n接下来，我们计算在 $z=0$ 处 $\\text{NO}_2$ 的光解速率系数，记为 $J_{\\text{NO}_2}$。其通用定义为：\n$$\nJ_{\\text{NO}_2} = \\int_{\\lambda_1}^{\\lambda_2} \\sigma_{\\text{NO}_2}(\\lambda) \\phi_{\\text{NO}_2}(\\lambda) F(\\lambda, 0) d\\lambda\n$$\n问题陈述 $\\sigma_{\\text{NO}_2}$ 和 $\\phi_{\\text{NO}_2}$ 在整个波段上是常数。因此，它们可以被移到积分号外：\n$$\nJ_{\\text{NO}_2} = \\sigma_{\\text{NO}_2} \\phi_{\\text{NO}_2} \\int_{\\lambda_1}^{\\lambda_2} F(\\lambda, 0) d\\lambda\n$$\n剩下的积分就是我们在 $z=0$ 处波段积分的光化通量，我们已推导出其为 $\\mathcal{F}(0)$。代入此结果，得到光解速率系数的最终解析表达式：\n$$\nJ_{\\text{NO}_2} = \\sigma_{\\text{NO}_2} \\phi_{\\text{NO}_2} F_{\\mathrm{TOA}} \\exp\\left(-\\frac{n_{0} \\sigma_{\\text{O}_3} H}{\\mu}\\right)\n$$\n现在，我们将数值代入此表达式。首先，我们计算指数的参数，即斜程光学厚度：\n$$\n\\frac{n_{0} \\sigma_{\\text{O}_3} H}{\\mu} = \\frac{(1.2\\times 10^{19}~\\mathrm{m}^{-3}) (2.0\\times 10^{-23}~\\mathrm{m}^{2}) (7.0\\times 10^{3}~\\mathrm{m})}{0.65}\n$$\n垂直光学厚度为 $\\tau_{\\text{O}_3}(0) = n_{0} \\sigma_{\\text{O}_3} H = 1.2 \\times 2.0 \\times 7.0 \\times 10^{19-23+3} = 16.8 \\times 10^{-1} = 1.68$。\n斜程光学厚度为 $\\tau_{\\text{O}_3}(0)/\\mu = 1.68 / 0.65$。\n\n现在，我们计算 $J_{\\text{NO}_2}$：\n$$\nJ_{\\text{NO}_2} = (1.0\\times 10^{-23}~\\mathrm{m}^{2}) \\times (1.0) \\times (8.0\\times 10^{18}~\\mathrm{m}^{-2}\\mathrm{s}^{-1}) \\times \\exp\\left(-\\frac{1.68}{0.65}\\right)\n$$\n我们来计算各项的值：\n$$\nJ_{\\text{NO}_2} = (8.0 \\times 10^{-5}~\\mathrm{s}^{-1}) \\times \\exp(-2.58461538...)\n$$\n$$\n\\exp(-2.58461538...) \\approx 0.075422\n$$\n$$\nJ_{\\text{NO}_2} \\approx (8.0 \\times 10^{-5}~\\mathrm{s}^{-1}) \\times 0.075422\n$$\n$$\nJ_{\\text{NO}_2} \\approx 6.03376 \\times 10^{-6}~\\mathrm{s}^{-1}\n$$\n四舍五入到三位有效数字，结果是 $6.03 \\times 10^{-6}~\\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{6.03 \\times 10^{-6}}\n$$"
        },
        {
            "introduction": "从理论到代码，本练习旨在让你构建现代辐射模型的一个基础模块。你将实现一个数值方案，使用光谱求积法计算通过离散分层大气的直接太阳束透过率。这项动手实践将巩固你对辐射传输在模型中如何计算的理解，并让你直面大天顶角下的数值稳定性等关键技术挑战。",
            "id": "4016475",
            "problem": "考虑一个用于数值天气预报和气候模拟的平行平面大气柱，其中单一物种的吸收是主导过程。该大气柱被划分为离散的水平层，索引为 $i = 1, 2, \\dots, N$，每层具有已知的层厚度 $\\Delta z_i$（单位：米）和吸收物质量密度 $\\rho_i$（单位：千克/立方米）。一束直接短波射线以太阳天顶角 $\\theta$（单位：度）从大气柱顶部射入。辐射传输仅考虑吸收；散射和发射被忽略。目标是使用光谱变化吸收的离散求积表示，计算从大气柱顶部到底部的波段平均直接辐射透过率。\n\n此问题的基本原理：\n- 沿路径的纯吸收辐射传输方程为 $dI/ds = -\\kappa_{\\text{ext}} \\rho \\, I$，其中 $I$ 是比辐射强度，$\\kappa_{\\text{ext}}$ 是吸收（或消光）系数（单位：平方米/千克），$\\rho$ 是吸收物密度（单位：千克/立方米），$s$ 是路径长度（单位：米）。\n- 沿路径的光学厚度定义为 $\\tau = \\int \\kappa_{\\text{ext}} \\rho \\, ds$。\n- 在平行平面大气中，天顶角为 $\\theta$ 的光束的斜路径元满足 $ds = dz / \\mu$，其中 $\\mu = \\cos(\\theta)$，当 $\\theta$ 用于三角函数内部时，应解释为弧度。\n\n谱带处理：\n- 跨波段的光谱变化吸收由一组 $M$ 个求积节点表示，索引为 $j = 1, 2, \\dots, M$，其权重 $w_j$ 满足 $\\sum_{j=1}^M w_j = 1$，以及依赖于层的吸收系数节点 $\\kappa_{i,j}$（单位：平方米/千克）。节点 $\\kappa_{i,j}$ 在各层之间保持一致的排序（即，相同的索引 $j$ 对所有层代表波段上相同的累积概率位置）。\n\n任务：\n1. 从上述基本原理出发，推导整个大气柱的波段平均直接辐射透过率的离散计算方案，用 $N$、$M$、$\\Delta z_i$、$\\rho_i$、$\\theta$、$w_j$ 和 $\\kappa_{i,j}$ 表示。您的推导必须：\n   - 从纯吸收辐射传输方程和光学厚度的定义开始。\n   - 使用适当的平行平面几何，其中 $\\mu = \\cos(\\theta)$。\n   - 论证分层和谱带求积如何结合以产生波段平均透过率。\n   - 展示一种数值稳定的方法，用于在多个层上组合透过率并在求积节点上进行组合，该方法在光学厚度极大或极小时能避免上溢/下溢。\n2. 在一个完整、可运行的程序中实现所推导的方案，该程序仅使用下面提供的数据。程序必须：\n   - 将 $\\theta$ 解释为度，并在需要时在内部转换为弧度。\n   - 使用单位为米的 $\\Delta z_i$、单位为千克/立方米的 $\\rho_i$、单位为平方米/千克的 $\\kappa_{i,j}$，并产生无量纲的透过率。\n   - 稳健地处理 $\\mu \\rightarrow 0$ 的情况，通过确保数值稳定性来避免除以零。\n   - 生成单行输出，其中包含结果，格式为方括号内以逗号分隔的列表（例如 $[r_1,r_2,\\dots]$），其中每个 $r_k$ 是测试用例 $k$ 的波段平均透过率。\n   - 将每个结果表示为浮点数，四舍五入到八位小数，不含额外文本或空白。\n\n测试套件：\n- 使用 $M = 4$ 个求积节点，权重为 $w = [\\,0.25,\\,0.35,\\,0.20,\\,0.20\\,]$，因此 $w_1 = 0.25$，$w_2 = 0.35$，$w_3 = 0.20$，$w_4 = 0.20$ 并且 $\\sum_{j=1}^4 w_j = 1$。\n\n定义五个测试用例，每个用例由元组 $\\left( \\{\\Delta z_i\\}_{i=1}^N, \\{\\rho_i\\}_{i=1}^N, \\theta, \\{\\kappa_{i,j}\\}_{i=1,j=1}^{N,M}, \\{w_j\\}_{j=1}^M \\right)$ 完全指定：\n\n1. 用例 1 (正常路径，中等吸收，中等天顶角):\n   - $N = 4$\n   - $\\Delta z = [\\,1000,\\,1500,\\,800,\\,1200\\,]$ 米\n   - $\\rho = [\\,1.5\\times 10^{-5},\\,1.0\\times 10^{-5},\\,8.0\\times 10^{-6},\\,6.0\\times 10^{-6}\\,]$ 千克/立方米\n   - $\\theta = 60$ 度\n   - $\\kappa_{i,j}$ 按层 $i$ 和节点 $j$ 分布，单位：平方米/千克：\n     - 层 1: $[\\,2.0,\\,20.0,\\,0.2,\\,5.0\\,]$\n     - 层 2: $[\\,1.5,\\,15.0,\\,0.15,\\,4.0\\,]$\n     - 层 3: $[\\,3.0,\\,30.0,\\,0.3,\\,6.0\\,]$\n     - 层 4: $[\\,1.0,\\,10.0,\\,0.1,\\,3.0\\,]$\n\n2. 用例 2 (光学薄，近天底):\n   - $N = 3$\n   - $\\Delta z = [\\,1000,\\,1000,\\,1000\\,]$ 米\n   - $\\rho = [\\,2.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.5\\times 10^{-7}\\,]$ 千克/立方米\n   - $\\theta = 0$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1: $[\\,2.0,\\,20.0,\\,0.2,\\,5.0\\,]$\n     - 层 2: $[\\,1.5,\\,15.0,\\,0.15,\\,4.0\\,]$\n     - 层 3: $[\\,3.0,\\,30.0,\\,0.3,\\,6.0\\,]$\n\n3. 用例 3 (极光学厚，强吸收，斜路径):\n   - $N = 3$\n   - $\\Delta z = [\\,2000,\\,3000,\\,1500\\,]$ 米\n   - $\\rho = [\\,2.0\\times 10^{-4},\\,1.5\\times 10^{-4},\\,1.0\\times 10^{-4}\\,]$ 千克/立方米\n   - $\\theta = 78.463$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1: $[\\,30.0,\\,300.0,\\,3.0,\\,100.0\\,]$\n     - 层 2: $[\\,25.0,\\,250.0,\\,2.5,\\,80.0\\,]$\n     - 层 3: $[\\,20.0,\\,200.0,\\,2.0,\\,60.0\\,]$\n\n4. 用例 4 (掠射角，光学属性与用例 1 相同但近地平线):\n   - $N = 4$\n   - $\\Delta z = [\\,1000,\\,1500,\\,800,\\,1200\\,]$ 米\n   - $\\rho = [\\,1.5\\times 10^{-5},\\,1.0\\times 10^{-5},\\,8.0\\times 10^{-6},\\,6.0\\times 10^{-6}\\,]$ 千克/立方米\n   - $\\theta = 87$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1: $[\\,2.0,\\,20.0,\\,0.2,\\,5.0\\,]$\n     - 层 2: $[\\,1.5,\\,15.0,\\,0.15,\\,4.0\\,]$\n     - 层 3: $[\\,3.0,\\,30.0,\\,0.3,\\,6.0\\,]$\n     - 层 4: $[\\,1.0,\\,10.0,\\,0.1,\\,3.0\\,]$\n\n5. 用例 5 (零吸收健全性检查):\n   - $N = 2$\n   - $\\Delta z = [\\,1000,\\,500\\,]$ 米\n   - $\\rho = [\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-3}\\,]$ 千克/立方米\n   - $\\theta = 45$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1: $[\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,]$\n     - 层 2: $[\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,]$\n\n要求输出：\n- 您的程序应生成单行输出，包含五个测试用例的波段平均透过率，格式为方括号内以逗号分隔的列表，每个浮点数四舍五入到八位小数，例如 $[t_1,t_2,t_3,t_4,t_5]$。",
            "solution": "此问题是有效的。它在科学上基于辐射传输原理，问题设定良好，数据充分且一致，并要求推导和实现一种大气建模中使用的标准算法。\n\n波段平均直接辐射透过率的计算方案推导过程如下，从所提供的基本原理开始。\n\n1. **辐射传输方程的积分**\n\n控制纯吸收辐射传输的基本方程如下：\n$$ \\frac{dI}{ds} = -\\kappa_{\\text{ext}} \\rho \\, I $$\n其中 $I$ 是比辐射强度，$\\kappa_{\\text{ext}}$ 是质量吸收系数（单位：m$^2$/kg），$\\rho$ 是吸收物密度（单位：kg/m$^3$），$s$ 是路径长度（单位：米）。对于单色光束（在单一波长或频率下），其中 $\\kappa_{\\text{ext}}$ 在短路径段上是恒定的，这是一个一阶线性常微分方程。我们可以分离变量并将其从起点 $s_1$ 积分到终点 $s_2$：\n$$ \\int_{I(s_1)}^{I(s_2)} \\frac{dI'}{I'} = -\\int_{s_1}^{s_2} \\kappa_{\\text{ext}} \\rho \\, ds' $$\n$$ \\ln\\left(\\frac{I(s_2)}{I(s_1)}\\right) = -\\int_{s_1}^{s_2} \\kappa_{\\text{ext}} \\rho \\, ds' $$\n右侧的积分定义为从 $s_1$ 到 $s_2$ 沿路径的光学厚度 $\\tau$。\n$$ \\tau(s_1, s_2) = \\int_{s_1}^{s_2} \\kappa_{\\text{ext}} \\rho \\, ds' $$\n对两边取指数得到比尔-朗伯定律，它将最终强度 $I(s_2)$ 与初始强度 $I(s_1)$ 联系起来：\n$$ I(s_2) = I(s_1) e^{-\\tau(s_1, s_2)} $$\n透过率 $T$ 是穿过介质的辐射分数，定义为 $T = I(s_2) / I(s_1)$。因此，单色透过率为：\n$$ T = e^{-\\tau} $$\n\n2. **平行平面大气几何**\n\n在平行平面大气中，几何形状被简化。一束直接辐射以太阳天顶角 $\\theta$ 进入大气层顶部。斜路径长度元 $ds$ 与相应的垂直距离元 $dz$ 之间的关系由 $ds = dz/\\mu$ 给出，其中 $\\mu = \\cos(\\theta)$ 且 $\\theta$ 以弧度表示。项 $1/\\mu$ 是大气质量因子。\n\n光学厚度积分可以重写为垂直坐标 $z$ 的函数。假设辐射路径穿过垂直距离 $\\Delta z$，则斜路径光学厚度 $\\Delta \\tau$ 为：\n$$ \\Delta \\tau = \\int_{\\text{path}} \\kappa_{\\text{ext}} \\rho \\, ds = \\int_{\\text{vertical}} \\kappa_{\\text{ext}} \\rho \\frac{dz}{\\mu} = \\frac{1}{\\mu} \\int_{\\text{vertical}} \\kappa_{\\text{ext}} \\rho \\, dz $$\n积分 $\\int \\kappa_{\\text{ext}} \\rho \\, dz$ 是垂直光学厚度。\n\n3. **大气层的离散化**\n\n大气柱从上到下被划分为 $N$ 个离散层，索引为 $i=1, \\dots, N$。在每层 $i$ 内部，厚度 $\\Delta z_i$、吸收物密度 $\\rho_i$ 和吸收系数 $\\kappa_{\\text{ext}, i}$ 被假定为常数。因此，单层 $i$ 的垂直光学厚度，记为 $\\Delta \\delta_i$，为：\n$$ \\Delta \\delta_i = \\kappa_{\\text{ext}, i} \\rho_i \\Delta z_i $$\n该层的斜路径光学厚度为：\n$$ \\Delta \\tau_i = \\frac{\\Delta \\delta_i}{\\mu} = \\frac{\\kappa_{\\text{ext}, i} \\rho_i \\Delta z_i}{\\mu} $$\n光学厚度是可加的。整个大气柱的总斜路径光学厚度 $\\tau_{\\text{total}}$ 是各层光学厚度的总和：\n$$ \\tau_{\\text{total}} = \\sum_{i=1}^N \\Delta \\tau_i = \\frac{1}{\\mu} \\sum_{i=1}^N \\kappa_{\\text{ext}, i} \\rho_i \\Delta z_i $$\n相应地，总透过率是各层透过率的乘积。这为证明数值稳定性提供了一条途径。总透过率 $T_{\\text{total}}$ 为：\n$$ T_{\\text{total}} = \\prod_{i=1}^N T_i = \\prod_{i=1}^N e^{-\\Delta \\tau_i} = \\exp\\left(-\\sum_{i=1}^N \\Delta \\tau_i\\right) = e^{-\\tau_{\\text{total}}} $$\n先求和光学厚度再进行单次指数计算，如 $e^{-\\tau_{\\text{total}}}$，比乘以许多小的透过率值在数值上更稳定，后者可能导致过早的下溢。\n\n4. **使用求积法进行光谱积分**\n\n吸收系数 $\\kappa_{\\text{ext}}$ 随波长变化。问题指定了一种求积方案来计算波段平均透过率。谱带由 $M$ 个求积节点表示，索引为 $j=1, \\dots, M$。每个节点都有一个相关的权重 $w_j$（满足 $\\sum_{j=1}^M w_j = 1$）和一组依赖于层的吸收系数 $\\kappa_{i,j}$。每个索引 $j$ 代表一个“伪单色”计算。\n\n波段平均透过率 $T_{\\text{band}}$ 是每个求积节点上透过率的加权平均值：\n$$ T_{\\text{band}} = \\sum_{j=1}^M w_j T_j $$\n其中 $T_j$ 是第 $j$ 个求积节点的总大气柱透过率。\n\n5. **最终计算方案**\n\n结合以上步骤，我们首先为每个求积节点 $j$ 计算总斜路径光学厚度：\n$$ \\tau_j = \\frac{1}{\\mu} \\sum_{i=1}^N \\kappa_{i,j} \\rho_i \\Delta z_i $$\n然后，我们计算每个节点的透过率：\n$$ T_j = e^{-\\tau_j} $$\n最后，我们计算波段平均透过率：\n$$ T_{\\text{band}} = \\sum_{j=1}^M w_j T_j = \\sum_{j=1}^M w_j \\exp\\left(-\\frac{1}{\\mu} \\sum_{i=1}^N \\kappa_{i,j} \\rho_i \\Delta z_i \\right) $$\n这就是要实现的离散计算公式。\n\n6. **数值稳定性考虑**\n\n该公式需要具有鲁棒性，特别是在掠射角情况下，即 $\\theta \\to 90^\\circ$ 从而 $\\mu = \\cos(\\theta) \\to 0$。\n- 如果 $\\mu \\to 0$ 且总垂直光学厚度 $\\delta_j = \\sum_{i=1}^N \\kappa_{i,j} \\rho_i \\Delta z_i > 0$，则斜路径光学厚度 $\\tau_j = \\delta_j / \\mu \\to \\infty$。物理上，这对应于无限长的路径，透过率 $T_j = e^{-\\tau_j}$ 必须为 $0$。\n- 如果总垂直光学厚度 $\\delta_j = 0$（即此光谱节点无吸收），则无论 $\\mu$ 为何值，$\\tau_j = 0$，透过率 $T_j = e^0 = 1$。\n- 在实现时，我们首先计算总垂直光学厚度向量 $\\{\\delta_j\\}_{j=1}^M$。如果 $\\theta \\ge 90^\\circ$，我们检查每个 $\\delta_j$：如果 $\\delta_j > 0$，则设 $T_j=0$；否则，设 $T_j=1$。如果 $\\theta  90^\\circ$，我们计算 $\\mu = \\cos(\\theta_{\\text{rad}})$ 并继续进行 $\\tau_j$ 和 $T_j$ 的完整计算。这种方法避免了除以零，并确保了在地平线处的物理行为正确性。使用 NumPy 的向量化操作可以高效、简洁地实现这一逻辑。`np.exp(-large_number)` 的计算会正确地下溢到 $0.0$，满足了对极大光学厚度稳定性的要求。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes direct-beam band-mean transmittance for multiple atmospheric test cases.\n\n    The function implements a discrete radiative transfer model for an absorption-only,\n    plane-parallel atmosphere. The model uses a quadrature scheme (k-distribution)\n    to handle spectrally varying absorption.\n\n    The calculation follows these steps:\n    1. For each quadrature node j, calculate the total vertical optical depth (VOD) by\n       summing the layer VODs over all N layers: delta_j = sum_{i=1 to N} (kappa_{i,j} * rho_i * delta_z_i).\n    2. Calculate the cosine of the solar zenith angle, mu = cos(theta).\n    3. Calculate the slant optical depth for each node: tau_j = delta_j / mu. A special\n       case is handled for grazing angles (theta = 90 deg) to avoid division by zero\n       and ensure physical correctness.\n    4. Compute the transmittance for each node: T_j = exp(-tau_j).\n    5. The final band-mean transmittance is the weighted sum over all quadrature\n       nodes: T_band = sum_{j=1 to M} (w_j * T_j).\n    \"\"\"\n\n    # Define the fixed quadrature weights for all test cases.\n    weights = np.array([0.25, 0.35, 0.20, 0.20])\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path, moderate absorption, mid-zenith)\n        {\n            \"N\": 4,\n            \"delta_z\": np.array([1000.0, 1500.0, 800.0, 1200.0]),\n            \"rho\": np.array([1.5e-5, 1.0e-5, 8.0e-6, 6.0e-6]),\n            \"theta_deg\": 60.0,\n            \"kappa\": np.array([\n                [2.0, 20.0, 0.2, 5.0],\n                [1.5, 15.0, 0.15, 4.0],\n                [3.0, 30.0, 0.3, 6.0],\n                [1.0, 10.0, 0.1, 3.0]\n            ])\n        },\n        # Case 2 (optically thin, near-nadir)\n        {\n            \"N\": 3,\n            \"delta_z\": np.array([1000.0, 1000.0, 1000.0]),\n            \"rho\": np.array([2.0e-7, 1.0e-7, 1.5e-7]),\n            \"theta_deg\": 0.0,\n            \"kappa\": np.array([\n                [2.0, 20.0, 0.2, 5.0],\n                [1.5, 15.0, 0.15, 4.0],\n                [3.0, 30.0, 0.3, 6.0]\n            ])\n        },\n        # Case 3 (extremely optically thick, strong absorption, slanted path)\n        {\n            \"N\": 3,\n            \"delta_z\": np.array([2000.0, 3000.0, 1500.0]),\n            \"rho\": np.array([2.0e-4, 1.5e-4, 1.0e-4]),\n            \"theta_deg\": 78.463,\n            \"kappa\": np.array([\n                [30.0, 300.0, 3.0, 100.0],\n                [25.0, 250.0, 2.5, 80.0],\n                [20.0, 200.0, 2.0, 60.0]\n            ])\n        },\n        # Case 4 (grazing angle, same as Case 1 but near-horizon)\n        {\n            \"N\": 4,\n            \"delta_z\": np.array([1000.0, 1500.0, 800.0, 1200.0]),\n            \"rho\": np.array([1.5e-5, 1.0e-5, 8.0e-6, 6.0e-6]),\n            \"theta_deg\": 87.0,\n            \"kappa\": np.array([\n                [2.0, 20.0, 0.2, 5.0],\n                [1.5, 15.0, 0.15, 4.0],\n                [3.0, 30.0, 0.3, 6.0],\n                [1.0, 10.0, 0.1, 3.0]\n            ])\n        },\n        # Case 5 (zero absorption sanity check)\n        {\n            \"N\": 2,\n            \"delta_z\": np.array([1000.0, 500.0]),\n            \"rho\": np.array([1.0e-3, 1.0e-3]),\n            \"theta_deg\": 45.0,\n            \"kappa\": np.array([\n                [0.0, 0.0, 0.0, 0.0],\n                [0.0, 0.0, 0.0, 0.0]\n            ])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case[\"N\"]\n        delta_z = case[\"delta_z\"]\n        rho = case[\"rho\"]\n        theta_deg = case[\"theta_deg\"]\n        kappa = case[\"kappa\"]\n\n        # Reshape rho and delta_z for broadcasting with kappa (N, M) matrix.\n        # This creates (N, 1) arrays that broadcast to (N, M).\n        rho_col = rho[:, np.newaxis]\n        delta_z_col = delta_z[:, np.newaxis]\n        \n        # Calculate vertical optical depth for each layer and each spectral node.\n        # Resulting shape is (N, M).\n        layer_vods = kappa * rho_col * delta_z_col\n        \n        # Sum over layers (axis=0) to get total vertical optical depth for each node.\n        # Resulting shape is (M,).\n        total_vod_j = layer_vods.sum(axis=0)\n        \n        # Handle grazing angle for numerical stability and physical correctness.\n        if theta_deg = 90.0:\n            # For grazing or upward paths in plane-parallel model, path is infinite.\n            # Transmittance is 0 unless VOD is 0.\n            transmittance_j = np.where(total_vod_j  0, 0.0, 1.0)\n        else:\n            # Convert angle to radians and compute cosine.\n            theta_rad = np.deg2rad(theta_deg)\n            mu = np.cos(theta_rad)\n            \n            # Calculate slant optical depth for each spectral node.\n            slant_tau_j = total_vod_j / mu\n            \n            # Calculate transmittance at each spectral node.\n            transmittance_j = np.exp(-slant_tau_j)\n            \n        # Compute band-mean transmittance as the weighted sum (dot product).\n        band_transmittance = np.dot(weights, transmittance_j)\n        \n        results.append(f\"{band_transmittance:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}