{
    "hands_on_practices": [
        {
            "introduction": "在数值天气预报和气候模拟中，许多关键物理量是通过间接计算得出的，这使得它们对输入数据的误差很敏感。本练习将探讨一个常见的实际问题：温度传感器的系统性偏差如何影响相对湿度（$RH$）的计算结果。通过运用克劳修斯-克拉佩龙（Clausius-Clapeyron）关系的微分形式，您将推导出一个一阶近似公式，来量化由温度测量误差引入的 $RH$ 偏差，从而深刻理解该关系在敏感性分析中的重要作用 。",
            "id": "4085060",
            "problem": "一个数值天气预报和气候模拟系统中的数据同化模块通过将无偏差的水汽反演结果与同一位置的空气温度观测值相结合来计算相对湿度（RH）。相对湿度（RH）定义为水汽分压 $e$ 与相同温度 $T$ 下的饱和水汽压 $e_{s}(T)$之比，即 $RH = e / e_{s}(T)$。考虑一个典型的对流层低层场景，其中真实空气温度为 $T = 285\\ \\mathrm{K}$，真实相对湿度为 $RH_{\\text{true}} = 0.60$。假设该系统使用的温度传感器存在 $\\Delta T = +0.50\\ \\mathrm{K}$ 的暖偏差，而水汽分压 $e$ 的测量没有偏差。仅使用第一性原理——即核心热力学定义和克劳修斯-克拉佩龙关系——推导出由温度偏差引起的、关于 $\\Delta T$ 的一阶预期相对湿度偏差 $RH_{\\text{meas}} - RH_{\\text{true}}$。取汽化潜热为 $L_{v} = 2.5 \\times 10^{6}\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}$，水汽的气体常数为 $R_{v} = 461\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$，并假设 $L_{v}$ 在所关心的温度范围内与温度无关。将最终的相对湿度偏差表示为无单位小数（无百分号），并四舍五入到四位有效数字。",
            "solution": "该问题要求推导由已知的空气温度测量偏差所引起的相对湿度（$RH$）测量偏差。推导必须基于第一性原理，特别是相对湿度的定义和克劳修斯-克拉佩龙关系，并且在温度偏差 $\\Delta T$ 上精确到一阶。\n\n相对湿度 $RH$ 定义为在给定气温 $T$ 下，水汽分压 $e$ 与饱和水汽压 $e_s(T)$ 的比值。\n$$RH = \\frac{e}{e_s(T)}$$\n\n设 $T$ 和 $RH_{\\text{true}}$ 分别为真实空气温度和真实相对湿度。设 $T_{\\text{meas}}$ 为测量的空气温度，其包含一个偏差 $\\Delta T$。\n$$T_{\\text{meas}} = T + \\Delta T$$\n题目说明水汽分压 $e$ 的测量没有偏差。因此，$e$ 的测量值等于其真实值。我们可以用真实相对湿度和真实饱和水汽压来表示真实分压 $e$：\n$$e = RH_{\\text{true}} \\cdot e_s(T)$$\n\n测量的相对湿度 $RH_{\\text{meas}}$ 是使用测量的（无偏差的）分压 $e$ 和与测量的（有偏差的）温度 $T_{\\text{meas}}$ 相对应的饱和水汽压来计算的。\n$$RH_{\\text{meas}} = \\frac{e}{e_s(T_{\\text{meas}})} = \\frac{e}{e_s(T + \\Delta T)}$$\n\n将真实条件下的 $e$ 的表达式代入 $RH_{\\text{meas}}$ 的方程，我们得到：\n$$RH_{\\text{meas}} = \\frac{RH_{\\text{true}} \\cdot e_s(T)}{e_s(T + \\Delta T)}$$\n\n为了继续推导，我们需要将 $e_s(T + \\Delta T)$ 与 $e_s(T)$ 联系起来。克劳修斯-克拉佩龙关系描述了饱和水汽压对温度的依赖性。对于液态水和水蒸气之间的相变，假设水蒸气表现为理想气体，且液体的比容与蒸汽相比可以忽略不计，该关系式为：\n$$\\frac{de_s}{dT} = \\frac{L_v e_s}{R_v T^2}$$\n其中 $L_v$ 是比汽化潜热，$R_v$ 是水汽的比气体常数。\n\n问题要求一个关于 $\\Delta T$ 的一阶近似。我们可以通过对函数 $e_s(T_{\\text{meas}}) = e_s(T + \\Delta T)$ 在真实温度 $T$ 附近进行一阶泰勒级数展开来得到：\n$$e_s(T + \\Delta T) \\approx e_s(T) + \\left. \\frac{de_s}{dT} \\right|_T \\Delta T$$\n将克劳修斯-克拉佩龙关系代入导数项，得到：\n$$e_s(T + \\Delta T) \\approx e_s(T) + \\left( \\frac{L_v e_s(T)}{R_v T^2} \\right) \\Delta T$$\n提出因子 $e_s(T)$，我们得到：\n$$e_s(T + \\Delta T) \\approx e_s(T) \\left( 1 + \\frac{L_v \\Delta T}{R_v T^2} \\right)$$\n\n现在，我们将这个近似值代回到 $RH_{\\text{meas}}$ 的表达式中：\n$$RH_{\\text{meas}} \\approx \\frac{RH_{\\text{true}} \\cdot e_s(T)}{e_s(T) \\left( 1 + \\frac{L_v \\Delta T}{R_v T^2} \\right)} = RH_{\\text{true}} \\left( 1 + \\frac{L_v \\Delta T}{R_v T^2} \\right)^{-1}$$\n\n为了保持对 $\\Delta T$ 的一阶近似，我们使用二项式近似 $(1 + x)^n \\approx 1 + nx$（对于小的 $x$）。这里，$n = -1$ 且 $x = \\frac{L_v \\Delta T}{R_v T^2}$，由于 $\\Delta T$ 很小，所以它是一个小量。\n$$RH_{\\text{meas}} \\approx RH_{\\text{true}} \\left( 1 - \\frac{L_v \\Delta T}{R_v T^2} \\right)$$\n\n相对湿度偏差，我们可以表示为 $\\Delta RH$，是测量相对湿度与真实相对湿度之差，即 $RH_{\\text{meas}} - RH_{\\text{true}}$。\n$$\\Delta RH = RH_{\\text{meas}} - RH_{\\text{true}} \\approx RH_{\\text{true}} \\left( 1 - \\frac{L_v \\Delta T}{R_v T^2} \\right) - RH_{\\text{true}}$$\n$$\\Delta RH \\approx RH_{\\text{true}} - RH_{\\text{true}} \\frac{L_v \\Delta T}{R_v T^2} - RH_{\\text{true}}$$\n$$\\Delta RH \\approx - RH_{\\text{true}} \\frac{L_v \\Delta T}{R_v T^2}$$\n\n这就是相对湿度偏差的一阶表达式。我们现在可以代入给定的数值：\n- 真实相对湿度：$RH_{\\text{true}} = 0.60$\n- 真实空气温度：$T = 285\\ \\mathrm{K}$\n- 温度偏差：$\\Delta T = +0.50\\ \\mathrm{K}$\n- 汽化潜热：$L_v = 2.5 \\times 10^{6}\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}$\n- 水汽的气体常数：$R_v = 461\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$\n\n将这些值代入 $\\Delta RH$ 的表达式中：\n$$\\Delta RH \\approx - (0.60) \\frac{(2.5 \\times 10^6\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}) (0.50\\ \\mathrm{K})}{(461\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}) (285\\ \\mathrm{K})^2}$$\n$$\\Delta RH \\approx - (0.60) \\frac{1.25 \\times 10^6}{461 \\times 81225}$$\n$$\\Delta RH \\approx - (0.60) \\frac{1.25 \\times 10^6}{37444725}$$\n$$\\Delta RH \\approx - (0.60) \\times 0.03338169...$$\n$$\\Delta RH \\approx -0.02002901...$$\n\n问题要求答案四舍五入到四位有效数字。\n$$\\Delta RH \\approx -0.02003$$\n负号表示温度测量的暖偏差导致了相对湿度的低估，这在物理上是一致的，因为 $e_s(T)$ 随 $T$ 的增加而增加。",
            "answer": "$$\\boxed{-0.02003}$$"
        },
        {
            "introduction": "在前一个练习的基础上，我们现在将利用克劳修斯-克拉佩龙关系来解决一个逆问题：从已知的气温（$T$）和相对湿度（$RH$）反演出未直接测量的露点温度（$T_d$）。这个任务是数据同化中的一个基本环节，对于初始化湿度场至关重要。此练习不仅要求您推导出 $T_d$ 的解析解，还要求您评估该反演过程对输入测量值变化的敏感性，从而引入条件数的概念来量化解的稳定性和不确定性 。",
            "id": "4085126",
            "problem": "一个数值天气预报 (NWP) 系统内的数据同化模块需要从气温 $T$ 和相对湿度 (RH) 的测量值中反演露点温度 $T_{d}$，并评估此反演问题的条件，以便对观测算子进行不确定性量化。在以下物理上标准的假设下进行推导：液态水上的饱和水汽压 $e_{s}(T)$ 服从微分形式的 Clausius-Clapeyron 关系，其中汽化潜热 $L_{v}$ 与温度无关，且水汽的比气体常数 $R_{v}$ 为常数；实际水汽压 $e$ 满足热力学定义 $e = \\mathrm{RH} \\, e_{s}(T)$ 和 $e = e_{s}(T_{d})$。使用一个已知的参考状态 $(T_{0}, e_{s0})$，在该状态下 $e_{s}(T_{0}) = e_{s0}$，而不使用任何经验性的饱和公式。\n\n任务：\n- 从微分形式的 Clausius-Clapeyron 关系（使用上述常数）出发，推导参照于 $(T_{0}, e_{s0})$ 的 $e_{s}(T)$ 的解析表达式。\n- 使用热力学定义，构建并执行对 $T_{d}$ 的精确反演，将其表示为测量值 $T$ 和 $\\mathrm{RH}$ 的闭式函数。\n- 推导反演问题的相对条件数（敏感度）$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$，其定义为\n$$\n\\kappa_{x} = \\lim_{\\delta \\to 0} \\sup \\left| \\frac{\\delta T_{d}/T_{d}}{\\delta x/x} \\right| \\quad \\text{for } x \\in \\{\\mathrm{RH}, T\\},\n$$\n并纯粹用 $T$、$T_{d}$、$L_{v}$ 和 $R_{v}$ 来表示。\n- 对于 $T = 296.15$ 和 $\\mathrm{RH} = 0.6$ 的情况，使用 $L_{v} = 2.5 \\times 10^{6}$ 和 $R_{v} = 461.5$ 计算 $T_{d}$、$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$，其中 $T$ 和 $T_{d}$ 的单位是开尔文，$L_{v}$ 和 $R_{v}$ 的单位分别是焦耳/千克和焦耳/(千克·开尔文)。将 $T_{d}$ 以开尔文为单位表示，并四舍五入到四位有效数字。将 $\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$ 表示为纯小数，并四舍五入到三位有效数字。\n\n你的最终答案必须是单个实数或单个闭式解析表达式；如果提供多个所要求的数值量，请将它们写成单个行矩阵。",
            "solution": "此问题被评估为有效，因为它在科学上基于经典热力学，问题设定良好且目标明确，并提供了一套完整且一致的数据和定义。所做的假设，例如恒定的汽化潜热，是在此背景下的标准近似。\n\n第一个任务是推导饱和水汽压 $e_{s}(T)$ 的表达式。我们从 Clausius-Clapeyron 关系开始，在给定假设（水汽适用理想气体定律，且忽略液态水的比容与水汽相比）下，该关系为：\n$$\n\\frac{de_{s}}{dT} = \\frac{L_{v} e_{s}}{R_{v} T^{2}}\n$$\n其中 $L_{v}$ 是恒定的汽化潜热，$R_{v}$ 是水汽的比气体常数。这是一个可分离的一阶常微分方程。我们分离变量：\n$$\n\\frac{de_{s}}{e_{s}} = \\frac{L_{v}}{R_{v}} \\frac{dT}{T^{2}}\n$$\n我们将两边从已知的参考状态 $(T_{0}, e_{s0})$ 积分到一个任意状态 $(T, e_{s}(T))$：\n$$\n\\int_{e_{s0}}^{e_{s}(T)} \\frac{1}{p} dp = \\int_{T_{0}}^{T} \\frac{L_{v}}{R_{v}} \\frac{1}{\\tau^{2}} d\\tau\n$$\n$$\n[\\ln(p)]_{e_{s0}}^{e_{s}(T)} = \\frac{L_{v}}{R_{v}} \\left[-\\frac{1}{\\tau}\\right]_{T_{0}}^{T}\n$$\n$$\n\\ln(e_{s}(T)) - \\ln(e_{s0}) = \\frac{L_{v}}{R_{v}} \\left(-\\frac{1}{T} + \\frac{1}{T_{0}}\\right)\n$$\n$$\n\\ln\\left(\\frac{e_{s}(T)}{e_{s0}}\\right) = \\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\n$$\n对两边取指数，得到 $e_{s}(T)$ 的表达式：\n$$\ne_{s}(T) = e_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\\right]\n$$\n\n第二个任务是求露点温度 $T_{d}$ 作为气温 $T$ 和相对湿度 $\\mathrm{RH}$ 的函数。题目给出了实际水汽压 $e$ 的两个定义：\n$1.$ $e = \\mathrm{RH} \\cdot e_{s}(T)$\n$2.$ $e = e_{s}(T_{d})$\n令二者相等得到：\n$$\ne_{s}(T_{d}) = \\mathrm{RH} \\cdot e_{s}(T)\n$$\n我们将推导出的 $e_{s}$ 表达式代入该方程，分别用于 $T_{d}$ 和 $T$：\n$$\ne_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T_{d}}\\right)\\right] = \\mathrm{RH} \\cdot e_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\\right]\n$$\n参考压力 $e_{s0}$ 被消去。对两边取自然对数：\n$$\n\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T_{d}}\\right) = \\ln(\\mathrm{RH}) + \\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\n$$\n包含参考温度的项 $\\frac{L_{v}}{R_{v} T_{0}}$ 从两边消去，剩下：\n$$\n-\\frac{L_{v}}{R_{v} T_{d}} = \\ln(\\mathrm{RH}) - \\frac{L_{v}}{R_{v} T}\n$$\n我们求解 $\\frac{1}{T_{d}}$：\n$$\n\\frac{1}{T_{d}} = \\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\n$$\n对此表达式求逆，得到 $T_{d}$ 的闭式解：\n$$\nT_{d}(T, \\mathrm{RH}) = \\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)^{-1}\n$$\n\n第三个任务是推导相对条件数（敏感度）$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$。通用定义为 $\\kappa_{x} = \\left| \\frac{x}{y} \\frac{\\partial y}{\\partial x} \\right|$。这里，$y = T_{d}$。\n\n对于 $\\kappa_{\\mathrm{RH}}$，我们需要求 $\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}}$。我们对 $T_{d} = \\left(f(\\mathrm{RH})\\right)^{-1}$ 使用链式法则：\n$$\n\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}} = -\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)^{-2} \\cdot \\frac{\\partial}{\\partial \\mathrm{RH}}\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)\n$$\n$$\n\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}} = -T_{d}^{2} \\left(-\\frac{R_{v}}{L_{v}} \\frac{1}{\\mathrm{RH}}\\right) = \\frac{R_{v} T_{d}^{2}}{L_{v} \\mathrm{RH}}\n$$\n于是条件数为：\n$$\n\\kappa_{\\mathrm{RH}} = \\left|\\frac{\\mathrm{RH}}{T_{d}} \\frac{\\partial T_{d}}{\\partial \\mathrm{RH}}\\right| = \\left|\\frac{\\mathrm{RH}}{T_{d}} \\cdot \\frac{R_{v} T_{d}^{2}}{L_{v} \\mathrm{RH}}\\right| = \\left|\\frac{R_{v} T_{d}}{L_{v}}\\right|\n$$\n由于 $R_{v}$、$L_{v}$ 和 $T_{d}$（以开尔文为单位）都是正数，绝对值是多余的。\n$$\n\\kappa_{\\mathrm{RH}} = \\frac{R_{v} T_{d}}{L_{v}}\n$$\n\n对于 $\\kappa_{T}$，我们需要求 $\\frac{\\partial T_{d}}{\\partial T}$。对关于 $\\frac{1}{T_{d}}$ 的方程进行关于 $T$ 的隐式微分更直接：\n$$\n\\frac{\\partial}{\\partial T}\\left(\\frac{1}{T_{d}}\\right) = \\frac{\\partial}{\\partial T}\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)\n$$\n$$\n-\\frac{1}{T_{d}^{2}} \\frac{\\partial T_{d}}{\\partial T} = -\\frac{1}{T^{2}}\n$$\n$$\n\\frac{\\partial T_{d}}{\\partial T} = \\frac{T_{d}^{2}}{T^{2}}\n$$\n于是条件数为：\n$$\n\\kappa_{T} = \\left|\\frac{T}{T_{d}} \\frac{\\partial T_{d}}{\\partial T}\\right| = \\left|\\frac{T}{T_{d}} \\cdot \\frac{T_{d}^{2}}{T^{2}}\\right| = \\left|\\frac{T_{d}}{T}\\right|\n$$\n由于两个温度都以开尔文为单位，它们都是正数。\n$$\n\\kappa_{T} = \\frac{T_{d}}{T}\n$$\n\n第四个任务是针对给定值计算 $T_{d}$、$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$：$T = 296.15$ K, $\\mathrm{RH} = 0.6$, $L_{v} = 2.5 \\times 10^{6}$ J/kg, 以及 $R_{v} = 461.5$ J/(kg·K)。\n\n首先，我们计算 $T_{d}$：\n$$\n\\frac{1}{T_{d}} = \\frac{1}{296.15} - \\frac{461.5}{2.5 \\times 10^{6}} \\ln(0.6)\n$$\n$$\n\\frac{1}{T_{d}} \\approx 0.0033766706 - (1.846 \\times 10^{-4})(-0.51082562)\n$$\n$$\n\\frac{1}{T_{d}} \\approx 0.0033766706 + 0.00009430048 \\approx 0.0034709711 \\text{ K}^{-1}\n$$\n$$\nT_{d} = \\frac{1}{0.0034709711} \\approx 288.104 \\text{ K}\n$$\n四舍五入到四位有效数字，$T_{d} = 288.1$ K。\n\n接下来，我们使用推导出的表达式和计算出的 $T_{d}$ 来计算条件数：\n$$\n\\kappa_{\\mathrm{RH}} = \\frac{R_{v} T_{d}}{L_{v}} = \\frac{461.5 \\times 288.104}{2.5 \\times 10^{6}} \\approx 0.053204\n$$\n四舍五入到三位有效数字，$\\kappa_{\\mathrm{RH}} = 0.0532$。\n$$\n\\kappa_{T} = \\frac{T_{d}}{T} = \\frac{288.104}{296.15} \\approx 0.972833\n$$\n四舍五入到三位有效数字，$\\kappa_{T} = 0.973$。\n\n最终的数值结果是 $T_{d} \\approx 288.1$ K, $\\kappa_{\\mathrm{RH}} \\approx 0.0532$, 以及 $\\kappa_{T} \\approx 0.973$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 288.1  0.0532  0.973 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "将热力学原理转化为计算算法是现代大气科学的核心。本练习旨在搭建从解析推导到数值实践的桥梁，要求您为一个饱和调整方案开发一个稳健的数值求解器。饱和调整是天气和气候模型中云与降水物理过程参数化的关键组成部分。您将构建一个基于牛顿法的迭代方案，并利用克劳修斯-克拉佩龙关系推导出其雅可比矩阵，以高效地求解平衡态温度，从而亲身体验物理定律如何指导数值模型的构建 。",
            "id": "4085045",
            "problem": "考虑一个一维饱和调整问题，其中在固定压强 $p$ 下的调整温度 $T_{\\text{adj}}$ 必须满足诊断一致性条件 $q_v = q_s(T_{\\text{adj}}, p)$，其中 $q_v$ 是给定的水汽比湿，$q_s(T,p)$ 是温度为 $T$、压强为 $p$ 时的饱和比湿。为 $T_{\\text{adj}}$ 构建一个求根问题，并推导出一个 Newton 迭代法，其 Jacobian 使用从 Clausius-Clapeyron 关系式得到的温度导数 $\\partial q_s / \\partial T$。您的推导必须从以下基本依据出发：\n- 在蒸发潜热 $L_v$ 和水汽气体常数 $R_v$ 恒定的假设下，饱和水汽压 $e_s(T)$ 的微分形式的 Clausius-Clapeyron 关系式：$\\mathrm{d} e_s / \\mathrm{d} T = L_v \\, e_s / (R_v T^2)$。\n- 将总压强为 $p$ 时的饱和水汽压 $e_s(T)$ 与饱和混合比 $w_s(T,p)$ 和饱和比湿 $q_s(T,p)$ 联系起来的基于理想气体的定义：\n  - $w_s(T,p) = \\varepsilon \\, e_s(T) / (p - e_s(T))$，其中 $\\varepsilon = R_d / R_v$，干空气气体常数为 $R_d$，\n  - $q_s(T,p) = w_s(T,p) / \\left(1 + w_s(T,p)\\right)$。\n假设材料参数和参考值恒定：$L_v = 2.5 \\times 10^6$ J kg$^{-1}$，$R_v = 461.5$ J kg$^{-1}$ K$^{-1}$，$R_d = 287.04$ J kg$^{-1}$ K$^{-1}$，$\\varepsilon = R_d / R_v$，参考温度 $T_0 = 273.15$ K，以及在 $T_0$ 时的参考饱和水汽压 $e_{s0} = 611.2$ Pa。\n\n任务：\n- 仅从所述基础出发，将问题表述为求解标量函数 $f(T)$ 的根，并为此问题推导出一个 Newton 迭代 $T_{n+1} = T_n - f(T_n)/f'(T_n)$。使用链式法则和 Clausius-Clapeyron 关系式，推导出 Jacobian $f'(T)$ 的显式表达式，不得引入除已声明假设之外的任何其他假设。\n- 设计一个鲁棒的算法，强制执行一个物理上合理的温度搜索区间 $T \\in [T_{\\min}, T_{\\max}]$，其中 $T_{\\min} = 180$ K，$T_{\\max} = 330$ K。如果一个 Newton 步骤提出的温度超出此区间，则执行简单的回溯线搜索以使迭代值保持在区间内，并确保对所有提供的测试用例收敛。\n- 对步长和残差分别使用绝对收敛容差 $\\delta_T = 10^{-8}$ K 和 $\\delta_q = 10^{-12}$。当 $|T_{n+1} - T_n| \\le \\delta_T$ 和 $|f(T_{n+1})| \\le \\delta_q$ 同时满足时，或在最多 $N_{\\max} = 100$ 次迭代后停止。如果目标 $q_v$ 超出可达范围 $[q_s(T_{\\min},p), q_s(T_{\\max},p)]$，则返回最近的边界温度。\n- 将您的算法实现为一个完整、可运行的程序，为以下测试套件计算 $T_{\\text{adj}}$。每个测试用例是一对 $(p, q_v)$，其中压强单位为帕斯卡，比湿单位为千克/千克：\n  1. $(p, q_v) = (100000, q_s(273.15, 100000))$,\n  2. $(p, q_v) = (100000, 0.010)$,\n  3. $(p, q_v) = (70000, 0.002)$,\n  4. $(p, q_v) = (95000, 0.022)$,\n  5. $(p, q_v) = (80000, 0.040)$.\n- 您的程序必须根据所述基础在内部计算 $q_s(273.15, 100000)$ 以构建测试用例 1。\n\n输出要求：\n- 对每个测试用例，计算调整温度 $T_{\\text{adj}}$（单位为开尔文），并将其四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含测试套件的结果，格式为方括号内以逗号分隔的浮点数列表，顺序与测试套件相同，例如 $[T_1, T_2, T_3, T_4, T_5]$，其中每个 $T_i$ 四舍五入到六位小数并以 K 为单位表示。",
            "solution": "该问题要求构建并求解一个求根问题，以确定一个调整温度 $T_{\\text{adj}}$，该温度在给定的比湿 $q_v$ 和压强 $p$ 下满足饱和条件 $q_v = q_s(T_{\\text{adj}}, p)$。解必须使用 Newton 迭代法求得，其 Jacobian 必须从基本热力学原理推导出来。\n\n首先，我们将问题形式化。我们寻求标量函数 $f(T)$ 的根：\n$$f(T) = q_s(T, p) - q_v = 0$$\nNewton-Raphson 方法提供了一个迭代方案来寻找根 $T_{\\text{adj}}$：\n$$T_{n+1} = T_n - \\frac{f(T_n)}{f'(T_n)}$$\n其中 $T_n$ 是第 $n$ 次迭代时的温度，$f'(T_n)$ 是 $f(T)$ 在 $T_n$ 处的导数。根据 $f(T)$ 的定义，其关于温度的导数为：\n$$f'(T) = \\frac{\\mathrm{d}}{\\mathrm{d}T} \\left( q_s(T, p) - q_v \\right) = \\frac{\\partial q_s}{\\partial T}$$\n因为对于给定的问题实例，$p$ 和 $q_v$ 是常数。我们的主要任务是推导 Jacobian $\\partial q_s / \\partial T$ 的显式表达式。\n\n推导从给定的饱和比湿 $q_s$、饱和混合比 $w_s$ 和饱和水汽压 $e_s$ 之间的关系开始。我们应用链式法则：\n$$\\frac{\\partial q_s}{\\partial T} = \\frac{\\mathrm{d} q_s}{\\mathrm{d} w_s} \\frac{\\partial w_s}{\\partial e_s} \\frac{\\mathrm{d} e_s}{\\mathrm{d} T}$$\n我们将推导这个乘积中的每一项。\n\n1.  **$q_s$ 对 $w_s$ 的导数**：\n    给定 $q_s = w_s / (1 + w_s)$，其导数为：\n    $$\\frac{\\mathrm{d} q_s}{\\mathrm{d} w_s} = \\frac{\\mathrm{d}}{\\mathrm{d} w_s} \\left( \\frac{w_s}{1+w_s} \\right) = \\frac{1 \\cdot (1+w_s) - w_s \\cdot 1}{(1+w_s)^2} = \\frac{1}{(1+w_s)^2}$$\n\n2.  **$w_s$ 对 $e_s$ 的导数**：\n    给定 $w_s = \\varepsilon e_s / (p - e_s)$，其中 $\\varepsilon = R_d/R_v$，关于 $e_s$ 的偏导数（保持 $p$ 恒定）为：\n    $$\\frac{\\partial w_s}{\\partial e_s} = \\frac{\\partial}{\\partial e_s} \\left( \\frac{\\varepsilon e_s}{p - e_s} \\right) = \\frac{\\varepsilon (p - e_s) - \\varepsilon e_s (-1)}{(p - e_s)^2} = \\frac{\\varepsilon p - \\varepsilon e_s + \\varepsilon e_s}{(p - e_s)^2} = \\frac{\\varepsilon p}{(p-e_s)^2}$$\n\n3.  **$e_s$ 对 $T$ 的导数**：\n    这由 Clausius-Clapeyron 关系式直接给出：\n    $$\\frac{\\mathrm{d} e_s}{\\mathrm{d} T} = \\frac{L_v e_s}{R_v T^2}$$\n\n将这三部分结合起来，我们得到 $\\partial q_s / \\partial T$ 的表达式：\n$$\\frac{\\partial q_s}{\\partial T} = \\frac{1}{(1+w_s)^2} \\cdot \\frac{\\varepsilon p}{(p-e_s)^2} \\cdot \\frac{L_v e_s}{R_v T^2}$$\n为便于实现，我们可以用 $p$ 和 $e_s$ 来表示项 $(1+w_s)^2$：\n$$1+w_s = 1 + \\frac{\\varepsilon e_s}{p - e_s} = \\frac{p - e_s + \\varepsilon e_s}{p-e_s} = \\frac{p + (\\varepsilon-1)e_s}{p-e_s}$$\n将其代回导数表达式：\n$$\\frac{\\partial q_s}{\\partial T} = \\left( \\frac{p-e_s}{p + (\\varepsilon-1)e_s} \\right)^2 \\cdot \\frac{\\varepsilon p}{(p-e_s)^2} \\cdot \\frac{L_v e_s}{R_v T^2}$$\n$(p-e_s)^2$ 项相互抵消，从而得到更紧凑的 Jacobian 形式：\n$$f'(T) = \\frac{\\partial q_s}{\\partial T} = \\frac{\\varepsilon p}{(p + (\\varepsilon-1)e_s)^2} \\frac{L_v e_s}{R_v T^2}$$\n要在给定温度 $T$ 下计算 $f(T)$ 和 $f'(T)$，我们需要饱和水汽压函数 $e_s(T)$。这可以通过对 Clausius-Clapeyron 关系式的微分形式进行积分得到，假设 $L_v$ 和 $R_v$ 恒定，从参考状态 $(T_0, e_{s0})$ 积分到 $(T, e_s)$：\n$$\\int_{e_{s0}}^{e_s} \\frac{\\mathrm{d}e'_s}{e'_s} = \\int_{T_0}^T \\frac{L_v}{R_v T'^2} \\mathrm{d}T'$$\n$$\\ln\\left(\\frac{e_s}{e_{s0}}\\right) = \\frac{L_v}{R_v} \\left[-\\frac{1}{T'}\\right]_{T_0}^T = \\frac{L_v}{R_v} \\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)$$\n这得出了 $e_s(T)$ 的显式公式：\n$$e_s(T) = e_{s0} \\exp\\left[\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right]$$\n给定的常数为 $L_v = 2.5 \\times 10^6$ J kg$^{-1}$，$R_v = 461.5$ J kg$^{-1}$ K$^{-1}$，$R_d = 287.04$ J kg$^{-1}$ K$^{-1}$，$T_0 = 273.15$ K，以及 $e_{s0} = 611.2$ Pa。气体常数之比为 $\\varepsilon = R_d/R_v$。\n\n对于给定的 $(p, q_v)$ 对，寻找 $T_{\\text{adj}}$ 的算法如下：\n\n1.  **初始化**：定义所有物理常数和算法参数（$T_{\\min} = 180$ K，$T_{\\max} = 330$ K，$\\delta_T = 10^{-8}$ K，$\\delta_q = 10^{-12}$，$N_{\\max} = 100$）。\n2.  **边界检查**：计算 $q_{s, \\min} = q_s(T_{\\min}, p)$ 和 $q_{s, \\max} = q_s(T_{\\max}, p)$。如果 $q_v \\le q_{s, \\min}$，则解为 $T_{\\min}$。如果 $q_v \\ge q_{s, \\max}$，则解为 $T_{\\max}$。\n3.  **初始猜测**：如果 $q_v$ 在边界内，则以一个初始猜测值开始 Newton 迭代，例如 $T_0 = 273.15$ K。\n4.  **迭代循环**：对于 $n = 0, 1, ..., N_{\\max}-1$：\n    a. 使用积分形式的 Clausius-Clapeyron 方程计算 $e_s(T_n)$。\n    b. 计算 $w_s(T_n, p) = \\varepsilon e_s(T_n) / (p - e_s(T_n))$，然后计算 $q_s(T_n, p) = w_s / (1+w_s)$。\n    c. 计算残差：$f(T_n) = q_s(T_n, p) - q_v$。\n    d. 计算 Jacobian：$f'(T_n) = \\frac{\\varepsilon p}{(p + (\\varepsilon-1)e_s(T_n))^2} \\frac{L_v e_s(T_n)}{R_v T_n^2}$。\n    e. 计算 Newton 步长：$\\Delta T = -f(T_n) / f'(T_n)$。\n    f. **回溯线搜索**：提出一个新温度 $T_{\\text{prop}} = T_n + \\Delta T$。如果 $T_{\\text{prop}}$ 超出区间 $[T_{\\min}, T_{\\max}]$，则通过一个因子减小步长，直到新的迭代值在边界内。使用一个简单的步长因子 $\\alpha$（初始为 1）的二分法：$T_{n+1} = T_n + \\alpha \\Delta T$。\n    g. **收敛检查**：计算新点的残差 $f(T_{n+1}) = q_s(T_{n+1},p) - q_v$。如果 $|\\alpha \\Delta T| \\le \\delta_T$ 和 $|f(T_{n+1})| \\le \\delta_q$ 同时满足，则迭代收敛。此时，终止并返回 $T_{n+1}$。\n    h. 更新温度：$T_n \\leftarrow T_{n+1}$。\n5.  **终止**：如果循环完成而未收敛（超过 $N_{\\max}$），则算法失败。鉴于该函数的良态性质，对于给定的测试用例，预计不会发生这种情况。每个测试用例的最终结果四舍五入到六位小数。\n第一个测试用例需要内部计算 $q_s(273.15, 100000)$ 来确定目标 $q_v$。对于这种情况，解恰好是 $T_{\\text{adj}} = 273.15$ K，这可作为对实现方案的验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the adjusted temperature using a Newton-Raphson method\n    based on the Clausius-Clapeyron relation.\n    \"\"\"\n\n    # --- Constants and Reference Values ---\n    L_V = 2.5e6        # J kg^-1\n    R_V = 461.5        # J kg^-1 K^-1\n    R_D = 287.04       # J kg^-1 K^-1\n    EPSILON = R_D / R_V  # Ratio of gas constants\n    T0 = 273.15        # K\n    E_S0 = 611.2       # Pa\n\n    # --- Algorithmic Parameters ---\n    T_MIN = 180.0      # K\n    T_MAX = 330.0      # K\n    TOL_T = 1e-8       # K\n    TOL_Q = 1e-12      # kg kg^-1\n    MAX_ITER = 100\n\n    # --- Helper functions for thermodynamic calculations ---\n    \n    def e_s(T):\n        \"\"\"Saturation vapor pressure (Pa) at temperature T (K).\"\"\"\n        # Ensure T is a float to avoid potential integer division issues, although unlikely here.\n        T = float(T)\n        # Avoid division by zero if T is 0, though outside our domain [180, 330]\n        if T == 0:\n            return 0.0\n        return E_S0 * np.exp((L_V / R_V) * (1.0 / T0 - 1.0 / T))\n\n    def w_s(T, p):\n        \"\"\"Saturation mixing ratio (kg/kg) at T (K) and p (Pa).\"\"\"\n        es = e_s(T)\n        # The denominator p - es is always positive for T = 330 K and p >= 70000 Pa.\n        return EPSILON * es / (p - es)\n\n    def q_s(T, p):\n        \"\"\"Saturation specific humidity (kg/kg) at T (K) and p (Pa).\"\"\"\n        ws = w_s(T, p)\n        return ws / (1.0 + ws)\n\n    def dq_s_dT(T, p):\n        \"\"\"\n        Derivative of saturation specific humidity w.r.t. temperature (K^-1).\n        This is the Jacobian f'(T) for the Newton method.\n        \"\"\"\n        es = e_s(T)\n        T = float(T)\n        if T == 0:\n            return 0.0\n            \n        # The Jacobian derived in the solution text\n        # f'(T) = (epsilon * p / (p + (epsilon - 1)*es)**2) * (L_v * es / (R_v * T**2))\n        term1 = (EPSILON * p) / (p + (EPSILON - 1.0) * es)**2\n        term2 = (L_V * es) / (R_V * T**2)\n        return term1 * term2\n\n    def find_adjusted_temperature(p, q_v):\n        \"\"\"\n        Finds T_adj for a given p (Pa) and q_v (kg/kg).\n        \"\"\"\n        # --- Boundary Check ---\n        q_s_min = q_s(T_MIN, p)\n        if q_v = q_s_min:\n            return T_MIN\n\n        q_s_max = q_s(T_MAX, p)\n        if q_v >= q_s_max:\n            return T_MAX\n\n        # --- Newton-Raphson Iteration ---\n        T_n = T0  # Initial guess\n        \n        for _ in range(MAX_ITER):\n            # Calculate residual and Jacobian at the current iterate T_n\n            f_Tn = q_s(T_n, p) - q_v\n            fp_Tn = dq_s_dT(T_n, p)\n\n            if abs(fp_Tn)  1e-15: # Avoid division by zero if derivative is flat\n                break\n\n            # Newton step\n            delta_T = -f_Tn / fp_Tn\n            \n            # Backtracking line search to stay within [T_MIN, T_MAX]\n            alpha = 1.0\n            while not (T_MIN = T_n + alpha * delta_T = T_MAX):\n                alpha /= 2.0\n                if alpha  1e-8: # Step size became too small\n                    # This case suggests we are stuck at a boundary, which should be handled by the initial check.\n                    # As a safeguard, return the closest boundary.\n                    return T_MIN if T_n + alpha * delta_T  T_MIN else T_MAX\n\n            T_n_plus_1 = T_n + alpha * delta_T\n            \n            # Check for convergence\n            step_size = abs(T_n_plus_1 - T_n)\n            f_Tn_plus_1 = q_s(T_n_plus_1, p) - q_v\n            \n            if step_size = TOL_T and abs(f_Tn_plus_1) = TOL_Q:\n                return T_n_plus_1\n\n            T_n = T_n_plus_1\n        \n        # If loop finishes, return the last computed temperature (convergence failure)\n        # This should not happen with the given test cases.\n        return T_n\n\n\n    # --- Test Suite ---\n    test_cases = [\n        # (p, q_v)\n        (100000.0, q_s(273.15, 100000.0)),\n        (100000.0, 0.010),\n        (70000.0, 0.002),\n        (95000.0, 0.022),\n        (80000.0, 0.040),\n    ]\n\n    results = []\n    for p_val, qv_val in test_cases:\n        T_adj = find_adjusted_temperature(p_val, qv_val)\n        results.append(f\"{T_adj:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}