{
    "hands_on_practices": [
        {
            "introduction": "在气象学中，我们常常需要从易于测量的物理量（如温度 $T$ 和相对湿度 $\\mathrm{RH}$）推导出其他关键的大气状态变量（如露点温度 $T_d$）。这个练习将指导您从第一性原理出发，利用克劳修斯-克拉佩龙关系构建一个精确的反演模型 。更进一步，通过分析该反演的敏感性，您将学会如何量化测量误差对最终结果的影响，这是数据同化和不确定性量化中的一项基本功。",
            "id": "4085126",
            "problem": "一个数值天气预报（NWP）系统中的数据同化模块需要根据气温 $T$ 和相对湿度（RH）的测量值来反演露点温度 $T_{d}$，并评估该反演的条件性，以用于观测算子的不确定性量化。在以下物理上标准的假设下进行：液态水上的饱和水汽压 $e_{s}(T)$ 服从微分形式的克劳修斯-克拉佩龙关系，其中汽化潜热 $L_{v}$ 与温度无关，水蒸气的比气体常数 $R_{v}$ 为常数；实际水汽压 $e$ 满足热力学定义 $e = \\mathrm{RH} \\, e_{s}(T)$ 和 $e = e_{s}(T_{d})$。使用一个已知的参考状态 $(T_{0}, e_{s0})$（其中 $e_{s}(T_{0}) = e_{s0}$），不使用任何经验性的饱和度公式。\n\n任务：\n- 从微分形式的克劳修斯-克拉佩龙关系出发（使用上述常数），推导一个以 $(T_{0}, e_{s0})$ 为参考的 $e_{s}(T)$ 的解析表达式。\n- 使用热力学定义，构建并执行对 $T_{d}$ 的精确反演，将其表示为测量值 $T$ 和 $\\mathrm{RH}$ 的闭式函数。\n- 推导该反演的相对条件数（敏感度）$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$，其定义为\n$$\n\\kappa_{x} = \\lim_{\\delta \\to 0} \\sup \\left| \\frac{\\delta T_{d}/T_{d}}{\\delta x/x} \\right| \\quad \\text{for } x \\in \\{\\mathrm{RH}, T\\},\n$$\n并纯粹用 $T$、$T_{d}$、$L_{v}$ 和 $R_{v}$ 来表示。\n- 对于 $T = 296.15$ 和 $\\mathrm{RH} = 0.6$ 的情况，使用 $L_{v} = 2.5 \\times 10^{6}$ 和 $R_{v} = 461.5$ 计算 $T_{d}$、$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$ 的值，其中 $T$ 和 $T_{d}$ 的单位是开尔文，$L_{v}$ 和 $R_{v}$ 的单位分别是焦耳/千克和焦耳/（千克·开尔文）。将 $T_{d}$ 以开尔文表示，并四舍五入到四位有效数字。将 $\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$ 表示为纯小数，并四舍五入到三位有效数字。\n\n你的最终答案必须是单个实数或单个闭式解析表达式；如果你提供多个要求的数值，请将它们写成一个单行矩阵。",
            "solution": "该问题被评估为有效，因为它基于经典热力学，问题设定良好且目标明确，并提供了一套完整且一致的数据和定义。所做的假设，例如汽化潜热为常数，是在此背景下的标准近似。\n\n第一个任务是推导饱和水汽压 $e_{s}(T)$ 的表达式。我们从克劳修斯-克拉佩龙关系开始，在给定假设（水蒸气适用理想气体定律，且与蒸汽相比，液态水的比容可忽略不计）下，该关系为：\n$$\n\\frac{de_{s}}{dT} = \\frac{L_{v} e_{s}}{R_{v} T^{2}}\n$$\n其中 $L_{v}$ 是恒定的汽化潜热，$R_{v}$ 是水蒸气的比气体常数。这是一个可分离的一阶常微分方程。我们分离变量：\n$$\n\\frac{de_{s}}{e_{s}} = \\frac{L_{v}}{R_{v}} \\frac{dT}{T^{2}}\n$$\n我们对两边进行积分，从已知的参考状态 $(T_{0}, e_{s0})$ 到任意状态 $(T, e_{s}(T))$：\n$$\n\\int_{e_{s0}}^{e_{s}(T)} \\frac{1}{p} dp = \\int_{T_{0}}^{T} \\frac{L_{v}}{R_{v}} \\frac{1}{\\tau^{2}} d\\tau\n$$\n$$\n[\\ln(p)]_{e_{s0}}^{e_{s}(T)} = \\frac{L_{v}}{R_{v}} \\left[-\\frac{1}{\\tau}\\right]_{T_{0}}^{T}\n$$\n$$\n\\ln(e_{s}(T)) - \\ln(e_{s0}) = \\frac{L_{v}}{R_{v}} \\left(-\\frac{1}{T} + \\frac{1}{T_{0}}\\right)\n$$\n$$\n\\ln\\left(\\frac{e_{s}(T)}{e_{s0}}\\right) = \\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\n$$\n对两边取指数，得到 $e_{s}(T)$ 的表达式：\n$$\ne_{s}(T) = e_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\\right]\n$$\n\n第二个任务是求露点温度 $T_{d}$ 作为气温 $T$ 和相对湿度 $\\mathrm{RH}$ 的函数。题目给出了实际水汽压 $e$ 的两个定义：\n1. $e = \\mathrm{RH} \\cdot e_{s}(T)$\n2. $e = e_{s}(T_{d})$\n令二者相等，得到：\n$$\ne_{s}(T_{d}) = \\mathrm{RH} \\cdot e_{s}(T)\n$$\n我们将推导出的 $e_{s}$ 表达式代入此方程，分别用于 $T_{d}$ 和 $T$：\n$$\ne_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T_{d}}\\right)\\right] = \\mathrm{RH} \\cdot e_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\\right]\n$$\n参考压力 $e_{s0}$ 被消去。对两边取自然对数：\n$$\n\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T_{d}}\\right) = \\ln(\\mathrm{RH}) + \\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\n$$\n包含参考温度的项 $\\frac{L_{v}}{R_{v} T_{0}}$ 从两边消去，剩下：\n$$\n-\\frac{L_{v}}{R_{v} T_{d}} = \\ln(\\mathrm{RH}) - \\frac{L_{v}}{R_{v} T}\n$$\n我们求解 $\\frac{1}{T_{d}}$：\n$$\n\\frac{1}{T_{d}} = \\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\n$$\n对此表达式求逆，得到 $T_{d}$ 的闭式解：\n$$\nT_{d}(T, \\mathrm{RH}) = \\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)^{-1}\n$$\n\n第三个任务是推导相对条件数（敏感度）$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$。通用定义为 $\\kappa_{x} = \\left| \\frac{x}{y} \\frac{\\partial y}{\\partial x} \\right|$。这里，$y = T_{d}$。\n\n对于 $\\kappa_{\\mathrm{RH}}$，我们需要求 $\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}}$。我们对 $T_{d} = \\left(f(\\mathrm{RH})\\right)^{-1}$ 使用链式法则：\n$$\n\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}} = -\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)^{-2} \\cdot \\frac{\\partial}{\\partial \\mathrm{RH}}\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)\n$$\n$$\n\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}} = -T_{d}^{2} \\left(-\\frac{R_{v}}{L_{v}} \\frac{1}{\\mathrm{RH}}\\right) = \\frac{R_{v} T_{d}^{2}}{L_{v} \\mathrm{RH}}\n$$\n于是条件数为：\n$$\n\\kappa_{\\mathrm{RH}} = \\left|\\frac{\\mathrm{RH}}{T_{d}} \\frac{\\partial T_{d}}{\\partial \\mathrm{RH}}\\right| = \\left|\\frac{\\mathrm{RH}}{T_{d}} \\cdot \\frac{R_{v} T_{d}^{2}}{L_{v} \\mathrm{RH}}\\right| = \\left|\\frac{R_{v} T_{d}}{L_{v}}\\right|\n$$\n由于 $R_{v}$、$L_{v}$ 和 $T_{d}$（以开尔文为单位）都是正值，绝对值是多余的。\n$$\n\\kappa_{\\mathrm{RH}} = \\frac{R_{v} T_{d}}{L_{v}}\n$$\n\n对于 $\\kappa_{T}$，我们需要求 $\\frac{\\partial T_{d}}{\\partial T}$。对关于 $\\frac{1}{T_{d}}$ 的方程相对于 $T$ 进行隐式微分更直接：\n$$\n\\frac{\\partial}{\\partial T}\\left(\\frac{1}{T_{d}}\\right) = \\frac{\\partial}{\\partial T}\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)\n$$\n$$\n-\\frac{1}{T_{d}^{2}} \\frac{\\partial T_{d}}{\\partial T} = -\\frac{1}{T^{2}}\n$$\n$$\n\\frac{\\partial T_{d}}{\\partial T} = \\frac{T_{d}^{2}}{T^{2}}\n$$\n于是条件数为：\n$$\n\\kappa_{T} = \\left|\\frac{T}{T_{d}} \\frac{\\partial T_{d}}{\\partial T}\\right| = \\left|\\frac{T}{T_{d}} \\cdot \\frac{T_{d}^{2}}{T^{2}}\\right| = \\left|\\frac{T_{d}}{T}\\right|\n$$\n由于两个温度都以开尔文为单位，它们都是正值。\n$$\n\\kappa_{T} = \\frac{T_{d}}{T}\n$$\n\n第四个任务是计算给定值下的 $T_{d}$、$\\kappa_{\\mathrm{RH}}$ 和 $\\kappa_{T}$：$T = 296.15$ K，$\\mathrm{RH} = 0.6$，$L_{v} = 2.5 \\times 10^{6}$ J/kg，以及 $R_{v} = 461.5$ J/(kg·K)。\n\n首先，我们计算 $T_{d}$：\n$$\n\\frac{1}{T_{d}} = \\frac{1}{296.15} - \\frac{461.5}{2.5 \\times 10^{6}} \\ln(0.6)\n$$\n$$\n\\frac{1}{T_{d}} \\approx 0.0033766706 - (1.846 \\times 10^{-4})(-0.51082562)\n$$\n$$\n\\frac{1}{T_{d}} \\approx 0.0033766706 + 0.00009430048 \\approx 0.0034709711 \\text{ K}^{-1}\n$$\n$$\nT_{d} = \\frac{1}{0.0034709711} \\approx 288.104 \\text{ K}\n$$\n四舍五入到四位有效数字，$T_{d} = 288.1$ K。\n\n接下来，我们使用推导出的表达式和计算出的 $T_{d}$ 来计算条件数：\n$$\n\\kappa_{\\mathrm{RH}} = \\frac{R_{v} T_{d}}{L_{v}} = \\frac{461.5 \\times 288.104}{2.5 \\times 10^{6}} \\approx 0.053204\n$$\n四舍五入到三位有效数字，$\\kappa_{\\mathrm{RH}} = 0.0532$。\n$$\n\\kappa_{T} = \\frac{T_{d}}{T} = \\frac{288.104}{296.15} \\approx 0.972833\n$$\n四舍五入到三位有效数字，$\\kappa_{T} = 0.973$。\n\n最终的数值结果是 $T_{d} \\approx 288.1$ K, $\\kappa_{\\mathrm{RH}} \\approx 0.0532$, 以及 $\\kappa_{T} \\approx 0.973$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 288.1  0.0532  0.973 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "饱和调整是云和降水物理过程参数化方案的核心，它描述了当水汽过饱和时，大气如何通过凝结恢复到饱和状态。这个问题提出了一个涉及相变和热量交换的复杂场景，但其答案却惊人地简洁 。解决此问题的关键在于识别出在特定约束（等压、绝热）下一个基本的守恒定律，这能锻炼您在复杂物理情境中抓住问题本质、避免陷入不必要细节的能力。",
            "id": "4085166",
            "problem": "在数值天气预报模式中，一个单位质量的气块在总水比湿 $q_t$ 恒定的情况下经历一次等压饱和调整，所有凝结物都保留在气块内。该调整是绝热的：没有辐射加热，没有微物理热源或热汇，没有扩散通量，也没有与环境的质量交换。气块初始时温度为 $T_0$，压强为 $p$，同时存在液相和汽相。最终状态在相同的压强 $p$ 和总水比湿 $q_t$ 下达到饱和，其温度为 $T_f$，水汽比湿为 $q_v(T_f)$，并受热力学平衡约束。\n\n从封闭系统的热力学第一定律、多组分混合物的比焓 $h$ 的定义，以及由克劳修斯-克拉佩龙关系决定的水汽平衡饱和约束出发，确定气块从初始状态 $(T_0, p, q_t)$ 到最终饱和状态 $(T_f, p, q_t)$ 之间的湿焓变化 $\\Delta h = h_f - h_0$。\n\n假设干空气和水汽都遵循理想气体行为，只存在单一的液态水相，冰相可忽略不计，动能和势能的变化也忽略不计。你可以将汽化潜热 $L_v(T)$ 以及比热 $c_{pd}$、$c_{pv}$ 和 $c_{pl}$ 视为温度 $T$ 的平滑函数，无需指定它们对温度的详细依赖关系。平衡饱和水汽压 $e_s(T)$ 满足克劳修斯-克拉佩龙关系，而饱和比湿 $q^{\\star}(T,p)$ 在固定压强 $p$ 下通过理想气体关系与 $e_s(T)$ 相关联。\n\n提供单位质量湿空气的 $\\Delta h$ 的最终数值。答案以 $\\mathrm{kJ\\,kg^{-1}}$ 为单位表示，并四舍五入到三位有效数字。为确定起见，你可以取 $T_0 = 289\\,\\mathrm{K}$，$p = 8.50 \\times 10^{4}\\,\\mathrm{Pa}$，以及 $q_t = 0.014\\,\\mathrm{kg\\,kg^{-1}}$，尽管在所述假设下，你的结果不应依赖于这些特定值。",
            "solution": "我们考虑一个封闭的（单位质量）气块，它经历一次等压饱和调整，过程中所有凝结物都被保留，且没有外部热量输入。相关的基本关系式是：\n\n1.  封闭系统的热力学第一定律，写成单位质量的形式：\n$$\n\\mathrm{d}u = \\delta q - p\\,\\mathrm{d}\\alpha,\n$$\n其中 $u$ 是比内能，$\\delta q$ 是单位质量增加的热量增量，$p$ 是压强，$\\alpha$ 是比容。\n\n2.  比焓 $h$ 的定义：\n$$\nh = u + p\\,\\alpha,\n$$\n其微分形式为\n$$\n\\mathrm{d}h = \\mathrm{d}u + p\\,\\mathrm{d}\\alpha + \\alpha\\,\\mathrm{d}p.\n$$\n\n将热力学第一定律代入焓的微分式，得到\n$$\n\\mathrm{d}h = \\delta q + \\alpha\\,\\mathrm{d}p.\n$$\n\n在所述过程约束下：\n- 调整是绝热的，所以 $\\delta q = 0$。\n- 调整是等压的，所以 $\\mathrm{d}p = 0$。\n\n因此，\n$$\n\\mathrm{d}h = 0 \\quad \\Rightarrow \\quad h_f - h_0 = \\Delta h = 0.\n$$\n\n这个结论是普适的，不依赖于相间的具体分配，也不依赖于潜热或比热对温度的显式依赖关系，只要该过程是封闭的（无质量交换）、绝热的（无外部热量）和等压的（压强恒定）。\n\n为了与饱和热力学和克劳修斯-克拉佩龙关系联系起来，我们注意到最终饱和状态必须满足平衡约束 $q_v(T_f) = q^{\\star}(T_f,p)$，其中 $q^{\\star}(T,p)$ 在固定压强 $p$ 下由饱和水汽压 $e_s(T)$ 通过理想气体关系确定。克劳修斯-克拉佩龙关系给出了 $e_s(T)$ 对 $T$ 的热力学依赖关系：\n$$\n\\frac{\\mathrm{d}\\ln e_s}{\\mathrm{d}T} = \\frac{L_v(T)}{R_v T^{2}},\n$$\n其中 $R_v$ 是水汽的气体常数，$L_v(T)$ 是汽化潜热。这个关系式约束了 $q^{\\star}(T,p)$ 如何沿饱和曲线随温度变化。在饱和调整过程中，与相变相关的潜热加热或冷却会改变 $T$ 和 $q_v$，从而使气块达到一个状态，在该状态下 $q_v(T_f)$ 等于 $q^{\\star}(T_f,p)$，且凝结物保留在气块内。然而，由于气块是封闭、绝热和等压的，因此在整个调整过程中焓保持不变，如上所证。\n\n最后，所求的单位质量湿空气的湿焓变化为\n$$\n\\Delta h = 0.\n$$\n\n以 $\\mathrm{kJ\\,kg^{-1}}$ 为单位表示，并四舍五入到三位有效数字，结果仍然是\n$$\n\\Delta h = 0.\n$$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "理论公式的生命力在于其应用，克劳修斯-克拉佩龙关系正是构成现代数值天气预报模型算法骨架的基石之一。本练习将引导您将热力学理论转化为实际代码，为饱和调整过程开发一个高效的数值求解器 。您需要从克劳修斯-克拉佩龙关系出发，推导求解过程中牛顿迭代法所必需的雅可比矩阵，亲身体验理论如何精确地指导数值算法的设计。",
            "id": "4085045",
            "problem": "考虑一个一维饱和调整问题，其中在固定气压 $p$ 下，一个调整后的温度 $T_{\\text{adj}}$ 必须满足诊断一致性条件 $q_v = q_s(T_{\\text{adj}}, p)$。这里，$q_v$ 是给定的水汽比湿，$q_s(T,p)$ 是在温度 $T$ 和气压 $p$ 下的饱和比湿。为 $T_{\\text{adj}}$ 构建一个求根问题，并推导一个牛顿迭代法，其雅可比矩阵（在此为导数）使用从克劳修斯-克拉佩龙关系式得到的温度导数 $\\partial q_s / \\partial T$。您的推导必须从以下基本依据出发：\n- 在汽化潜热 $L_v$ 和水汽气体常数 $R_v$ 恒定的假设下，关于饱和水汽压 $e_s(T)$ 的克劳修斯-克拉佩龙关系式的微分形式：$\\mathrm{d} e_s / \\mathrm{d} T = L_v \\, e_s / (R_v T^2)$。\n- 在总气压为 $p$ 时，将饱和水汽压 $e_s(T)$ 与饱和混合比 $w_s(T,p)$ 和饱和比湿 $q_s(T,p)$ 联系起来的基于理想气体定律的定义：\n  - $w_s(T,p) = \\varepsilon \\, e_s(T) / (p - e_s(T))$，其中 $\\varepsilon = R_d / R_v$，干空气气体常数为 $R_d$，\n  - $q_s(T,p) = w_s(T,p) / \\left(1 + w_s(T,p)\\right)$。\n假设材料参数和参考值为常数：$L_v = 2.5 \\times 10^6$ J kg$^{-1}$，$R_v = 461.5$ J kg$^{-1}$ K$^{-1}$，$R_d = 287.04$ J kg$^{-1}$ K$^{-1}$，$\\varepsilon = R_d / R_v$，参考温度 $T_0 = 273.15$ K，以及在 $T_0$ 时的参考饱和水汽压 $e_{s0} = 611.2$ Pa。\n\n任务：\n- 仅从上述基本依据出发，将问题表述为求解一个标量函数 $f(T)$ 的根，并为此问题推导牛顿迭代式 $T_{n+1} = T_n - f(T_n)/f'(T_n)$。使用链式法则和克劳修斯-克拉佩龙关系式，推导出雅可比（导数）$f'(T)$ 的显式表达式，且不引入任何额外的假设。\n- 设计一个鲁棒算法，强制温度在物理上合理的搜索区间 $T \\in [T_{\\min}, T_{\\max}]$ 内，其中 $T_{\\min} = 180$ K，$T_{\\max} = 330$ K。如果某次牛顿迭代步长计算出的温度超出了此区间，则执行简单的回溯线搜索，以确保迭代点保持在区间内，并保证所有提供的测试用例都能收敛。\n- 对步长和残差分别使用绝对收敛容差 $\\delta_T = 10^{-8}$ K 和 $\\delta_q = 10^{-12}$。当 $|T_{n+1} - T_n| \\le \\delta_T$ 和 $|f(T_{n+1})| \\le \\delta_q$ 同时满足时，或在达到最大迭代次数 $N_{\\max} = 100$ 后停止。如果目标 $q_v$ 超出可达范围 $[q_s(T_{\\min},p), q_s(T_{\\max},p)]$，则返回最接近的边界温度。\n- 将您的算法实现为一个完整的、可运行的程序，为以下测试套件计算 $T_{\\text{adj}}$。每个测试用例是一个对 $(p, q_v)$，其中气压单位为帕斯卡（pascals），比湿单位为千克每千克（kilograms per kilogram）：\n  1. $(p, q_v) = (100000, q_s(273.15, 100000))$,\n  2. $(p, q_v) = (100000, 0.010)$,\n  3. $(p, q_v) = (70000, 0.002)$,\n  4. $(p, q_v) = (95000, 0.022)$,\n  5. $(p, q_v) = (80000, 0.040)$.\n- 您的程序必须根据所述基本依据在内部计算 $q_s(273.15, 100000)$，以构建测试用例1。\n\n输出要求：\n- 对每个测试用例，计算调整后的温度 $T_{\\text{adj}}$（单位：开尔文），并四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含测试套件的结果，格式为一个用方括号括起来的逗号分隔的浮点数列表，顺序与测试套件相同，例如 $[T_1, T_2, T_3, T_4, T_5]$，其中每个 $T_i$ 都四舍五入到六位小数，单位为 K。",
            "solution": "该问题要求构建并求解一个求根问题，以确定调整后的温度 $T_{\\text{adj}}$。该温度需在给定的比湿 $q_v$ 和气压 $p$ 下满足饱和条件 $q_v = q_s(T_{\\text{adj}}, p)$。解必须使用牛顿迭代法求得，其雅可比（导数）必须从基本热力学原理推导出来。\n\n首先，我们将问题形式化。我们寻求标量函数 $f(T)$ 的根：\n$$f(T) = q_s(T, p) - q_v = 0$$\n牛顿-拉夫逊方法提供了一个寻找根 $T_{\\text{adj}}$ 的迭代格式：\n$$T_{n+1} = T_n - \\frac{f(T_n)}{f'(T_n)}$$\n其中 $T_n$ 是第 $n$ 次迭代的温度，$f'(T_n)$ 是 $f(T)$ 在 $T_n$ 处的导数。根据 $f(T)$ 的定义，其关于温度的导数为：\n$$f'(T) = \\frac{\\mathrm{d}}{\\mathrm{d}T} \\left( q_s(T, p) - q_v \\right) = \\frac{\\partial q_s}{\\partial T}$$\n因为对于给定的问题实例，$p$ 和 $q_v$ 是常数。我们的主要任务是推导出雅可比（导数）$\\partial q_s / \\partial T$ 的显式表达式。\n\n推导从已知的饱和比湿 $q_s$、饱和混合比 $w_s$ 和饱和水汽压 $e_s$ 之间的关系开始。我们应用链式法则：\n$$\\frac{\\partial q_s}{\\partial T} = \\frac{\\mathrm{d} q_s}{\\mathrm{d} w_s} \\frac{\\partial w_s}{\\partial e_s} \\frac{\\mathrm{d} e_s}{\\mathrm{d} T}$$\n我们将推导此乘积中的每一项。\n\n1.  **$q_s$ 关于 $w_s$ 的导数**：\n    给定 $q_s = w_s / (1 + w_s)$，其导数为：\n    $$\\frac{\\mathrm{d} q_s}{\\mathrm{d} w_s} = \\frac{\\mathrm{d}}{\\mathrm{d} w_s} \\left( \\frac{w_s}{1+w_s} \\right) = \\frac{1 \\cdot (1+w_s) - w_s \\cdot 1}{(1+w_s)^2} = \\frac{1}{(1+w_s)^2}$$\n\n2.  **$w_s$ 关于 $e_s$ 的导数**：\n    给定 $w_s = \\varepsilon e_s / (p - e_s)$，其中 $\\varepsilon = R_d/R_v$，在保持 $p$ 不变的情况下，关于 $e_s$ 的偏导数为：\n    $$\\frac{\\partial w_s}{\\partial e_s} = \\frac{\\partial}{\\partial e_s} \\left( \\frac{\\varepsilon e_s}{p - e_s} \\right) = \\frac{\\varepsilon (p - e_s) - \\varepsilon e_s (-1)}{(p - e_s)^2} = \\frac{\\varepsilon p - \\varepsilon e_s + \\varepsilon e_s}{(p - e_s)^2} = \\frac{\\varepsilon p}{(p-e_s)^2}$$\n\n3.  **$e_s$ 关于 $T$ 的导数**：\n    这由克劳修斯-克拉佩龙关系式直接给出：\n    $$\\frac{\\mathrm{d} e_s}{\\mathrm{d} T} = \\frac{L_v e_s}{R_v T^2}$$\n\n结合这三部分，我们得到 $\\partial q_s / \\partial T$ 的表达式：\n$$\\frac{\\partial q_s}{\\partial T} = \\frac{1}{(1+w_s)^2} \\cdot \\frac{\\varepsilon p}{(p-e_s)^2} \\cdot \\frac{L_v e_s}{R_v T^2}$$\n为了便于实现，我们可以用 $p$ 和 $e_s$ 来表示 $(1+w_s)^2$ 这一项：\n$$1+w_s = 1 + \\frac{\\varepsilon e_s}{p - e_s} = \\frac{p - e_s + \\varepsilon e_s}{p-e_s} = \\frac{p + (\\varepsilon-1)e_s}{p-e_s}$$\n将此代入导数表达式：\n$$\\frac{\\partial q_s}{\\partial T} = \\left( \\frac{p-e_s}{p + (\\varepsilon-1)e_s} \\right)^2 \\cdot \\frac{\\varepsilon p}{(p-e_s)^2} \\cdot \\frac{L_v e_s}{R_v T^2}$$\n$(p-e_s)^2$ 项相互抵消，从而得到雅可比（导数）更紧凑的形式：\n$$f'(T) = \\frac{\\partial q_s}{\\partial T} = \\frac{\\varepsilon p}{(p + (\\varepsilon-1)e_s)^2} \\frac{L_v e_s}{R_v T^2}$$\n为了在给定温度 $T$ 下计算 $f(T)$ 和 $f'(T)$，我们需要饱和水汽压函数 $e_s(T)$。通过对克劳修斯-克拉佩龙关系式的微分形式进行积分可以得到该函数，积分区间从参考状态 $(T_0, e_{s0})$ 到 $(T, e_s)$，并假设 $L_v$ 和 $R_v$ 为常数：\n$$\\int_{e_{s0}}^{e_s} \\frac{\\mathrm{d}e'_s}{e'_s} = \\int_{T_0}^T \\frac{L_v}{R_v T'^2} \\mathrm{d}T'$$\n$$\\ln\\left(\\frac{e_s}{e_{s0}}\\right) = \\frac{L_v}{R_v} \\left[-\\frac{1}{T'}\\right]_{T_0}^T = \\frac{L_v}{R_v} \\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)$$\n这就得出了 $e_s(T)$ 的显式公式：\n$$e_s(T) = e_{s0} \\exp\\left[\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right]$$\n给定的常数为 $L_v = 2.5 \\times 10^6$ J kg$^{-1}$，$R_v = 461.5$ J kg$^{-1}$ K$^{-1}$，$R_d = 287.04$ J kg$^{-1}$ K$^{-1}$，$T_0 = 273.15$ K，以及 $e_{s0} = 611.2$ Pa。气体常数之比为 $\\varepsilon = R_d/R_v$。\n\n针对给定的一对 $(p, q_v)$ 寻找 $T_{\\text{adj}}$ 的算法如下：\n\n1.  **初始化**：定义所有物理常数和算法参数（$T_{\\min} = 180$ K, $T_{\\max} = 330$ K, $\\delta_T = 10^{-8}$ K, $\\delta_q = 10^{-12}$, $N_{\\max} = 100$）。\n2.  **边界检查**：计算 $q_{s, \\min} = q_s(T_{\\min}, p)$ 和 $q_{s, \\max} = q_s(T_{\\max}, p)$。如果 $q_v \\le q_{s, \\min}$，解为 $T_{\\min}$。如果 $q_v \\ge q_{s, \\max}$，解为 $T_{\\max}$。\n3.  **初始猜测**：如果 $q_v$ 在边界范围内，则以一个初始猜测值（例如 $T_0 = 273.15$ K）开始牛顿迭代。\n4.  **迭代循环**：对于 $n = 0, 1, ..., N_{\\max}-1$：\n    a. 使用积分形式的克劳修斯-克拉佩龙方程计算 $e_s(T_n)$。\n    b. 计算 $w_s(T_n, p) = \\varepsilon e_s(T_n) / (p - e_s(T_n))$，然后计算 $q_s(T_n, p) = w_s / (1+w_s)$。\n    c. 计算残差：$f(T_n) = q_s(T_n, p) - q_v$。\n    d. 计算雅可比（导数）：$f'(T_n) = \\frac{\\varepsilon p}{(p + (\\varepsilon-1)e_s(T_n))^2} \\frac{L_v e_s(T_n)}{R_v T_n^2}$。\n    e. 计算牛顿步长：$\\Delta T = -f(T_n) / f'(T_n)$。\n    f. **回溯线搜索**：提出一个新温度 $T_{\\text{prop}} = T_n + \\Delta T$。如果 $T_{\\text{prop}}$ 超出区间 $[T_{\\min}, T_{\\max}]$，则通过一个因子减小步长，直到新的迭代点位于边界内。这里使用对步长因子 $\\alpha$（初始为1）进行简单的二分法：$T_{n+1} = T_n + \\alpha \\Delta T$。\n    g. **收敛性检查**：计算新点的残差 $f(T_{n+1}) = q_s(T_{n+1},p) - q_v$。如果 $|\\alpha \\Delta T| \\le \\delta_T$ 和 $|f(T_{n+1})| \\le \\delta_q$ 同时满足，则迭代收敛。此时终止迭代并返回 $T_{n+1}$。\n    h. 更新温度：$T_n \\leftarrow T_{n+1}$。\n5.  **终止**：如果循环完成而未收敛（超过 $N_{\\max}$），则算法失败。鉴于该函数的良态性质，对于给定的测试用例，这种情况预计不会发生。每个测试用例的最终结果四舍五入到六位小数。\n第一个测试用例需要内部计算 $q_s(273.15, 100000)$ 来确定目标 $q_v$。对于这种情况，解恰好是 $T_{\\text{adj}} = 273.15$ K，这可作为对实现正确性的验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the adjusted temperature using a Newton-Raphson method\n    based on the Clausius-Clapeyron relation.\n    \"\"\"\n\n    # --- Constants and Reference Values ---\n    L_V = 2.5e6        # J kg^-1\n    R_V = 461.5        # J kg^-1 K^-1\n    R_D = 287.04       # J kg^-1 K^-1\n    EPSILON = R_D / R_V  # Ratio of gas constants\n    T0 = 273.15        # K\n    E_S0 = 611.2       # Pa\n\n    # --- Algorithmic Parameters ---\n    T_MIN = 180.0      # K\n    T_MAX = 330.0      # K\n    TOL_T = 1e-8       # K\n    TOL_Q = 1e-12      # kg kg^-1\n    MAX_ITER = 100\n\n    # --- Helper functions for thermodynamic calculations ---\n    \n    def e_s(T):\n        \"\"\"Saturation vapor pressure (Pa) at temperature T (K).\"\"\"\n        # Ensure T is a float to avoid potential integer division issues, although unlikely here.\n        T = float(T)\n        # Avoid division by zero if T is 0, though outside our domain [180, 330]\n        if T == 0:\n            return 0.0\n        return E_S0 * np.exp((L_V / R_V) * (1.0 / T0 - 1.0 / T))\n\n    def w_s(T, p):\n        \"\"\"Saturation mixing ratio (kg/kg) at T (K) and p (Pa).\"\"\"\n        es = e_s(T)\n        # The denominator p - es is always positive for T = 330 K and p >= 70000 Pa.\n        return EPSILON * es / (p - es)\n\n    def q_s(T, p):\n        \"\"\"Saturation specific humidity (kg/kg) at T (K) and p (Pa).\"\"\"\n        ws = w_s(T, p)\n        return ws / (1.0 + ws)\n\n    def dq_s_dT(T, p):\n        \"\"\"\n        Derivative of saturation specific humidity w.r.t. temperature (K^-1).\n        This is the Jacobian f'(T) for the Newton method.\n        \"\"\"\n        es = e_s(T)\n        T = float(T)\n        if T == 0:\n            return 0.0\n            \n        # The Jacobian derived in the solution text\n        # f'(T) = (epsilon * p / (p + (epsilon - 1)*es)**2) * (L_v * es / (R_v * T**2))\n        term1 = (EPSILON * p) / (p + (EPSILON - 1.0) * es)**2\n        term2 = (L_V * es) / (R_V * T**2)\n        return term1 * term2\n\n    def find_adjusted_temperature(p, q_v):\n        \"\"\"\n        Finds T_adj for a given p (Pa) and q_v (kg/kg).\n        \"\"\"\n        # --- Boundary Check ---\n        q_s_min = q_s(T_MIN, p)\n        if q_v = q_s_min:\n            return T_MIN\n\n        q_s_max = q_s(T_MAX, p)\n        if q_v >= q_s_max:\n            return T_MAX\n\n        # --- Newton-Raphson Iteration ---\n        T_n = T0  # Initial guess\n        \n        for _ in range(MAX_ITER):\n            # Calculate residual and Jacobian at the current iterate T_n\n            f_Tn = q_s(T_n, p) - q_v\n            fp_Tn = dq_s_dT(T_n, p)\n\n            if abs(fp_Tn)  1e-15: # Avoid division by zero if derivative is flat\n                break\n\n            # Newton step\n            delta_T = -f_Tn / fp_Tn\n            \n            # Backtracking line search to stay within [T_MIN, T_MAX]\n            alpha = 1.0\n            T_n_plus_1_prop = T_n + alpha * delta_T\n            while not (T_MIN = T_n_plus_1_prop = T_MAX):\n                alpha /= 2.0\n                T_n_plus_1_prop = T_n + alpha * delta_T\n                if alpha  1e-8: # Step size became too small\n                    # This case suggests we are stuck at a boundary, which should be handled by the initial check.\n                    # As a safeguard, return the closest boundary.\n                    return T_MIN if T_n + alpha * delta_T  T_MIN else T_MAX\n\n            T_n_plus_1 = T_n_plus_1_prop\n            \n            # Check for convergence\n            step_size = abs(T_n_plus_1 - T_n)\n            f_Tn_plus_1 = q_s(T_n_plus_1, p) - q_v\n            \n            if step_size = TOL_T and abs(f_Tn_plus_1) = TOL_Q:\n                return T_n_plus_1\n\n            T_n = T_n_plus_1\n        \n        # If loop finishes, return the last computed temperature (convergence failure)\n        # This should not happen with the given test cases.\n        return T_n\n\n\n    # --- Test Suite ---\n    test_cases = [\n        # (p, q_v)\n        (100000.0, q_s(273.15, 100000.0)),\n        (100000.0, 0.010),\n        (70000.0, 0.002),\n        (95000.0, 0.022),\n        (80000.0, 0.040),\n    ]\n\n    results = []\n    for p_val, qv_val in test_cases:\n        T_adj = find_adjusted_temperature(p_val, qv_val)\n        results.append(f\"{T_adj:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}