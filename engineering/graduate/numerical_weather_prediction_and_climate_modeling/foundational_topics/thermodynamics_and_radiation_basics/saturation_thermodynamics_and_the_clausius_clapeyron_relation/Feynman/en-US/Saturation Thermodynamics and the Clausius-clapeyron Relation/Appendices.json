{
    "hands_on_practices": [
        {
            "introduction": "In atmospheric science, we constantly work with derived quantities, and understanding how measurement errors propagate is crucial for data quality and interpretation. The Clausius-Clapeyron relation establishes a strong, non-linear dependence of saturation vapor pressure on temperature, which means that even small inaccuracies in a temperature sensor can lead to significant biases in calculated relative humidity. This exercise provides hands-on practice with error propagation analysis, using a first-order approximation to quantify how a common instrument bias impacts this critical meteorological variable .",
            "id": "4085060",
            "problem": "A data assimilation module in a numerical weather prediction and climate modeling system computes relative humidity (RH) by combining an unbiased water vapor retrieval with a co-located air temperature observation. Relative humidity (RH) is defined as the ratio of the water vapor partial pressure $e$ to the saturation vapor pressure $e_{s}(T)$ at the same temperature $T$, i.e., $RH = e / e_{s}(T)$. Consider a typical lower-tropospheric scene where the true air temperature is $T = 285\\ \\mathrm{K}$ and the true relative humidity is $RH_{\\text{true}} = 0.60$. Suppose the temperature sensor used by the system has a warm bias of $\\Delta T = +0.50\\ \\mathrm{K}$, while the water vapor partial pressure $e$ is measured without bias. Using only first principles—core thermodynamic definitions and the Clausius-Clapeyron relation—derive, to first order in $\\Delta T$, the expected RH bias $RH_{\\text{meas}} - RH_{\\text{true}}$ arising solely from the temperature bias. Take the latent heat of vaporization to be $L_{v} = 2.5 \\times 10^{6}\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}$ and the gas constant for water vapor to be $R_{v} = 461\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$, and assume $L_{v}$ is temperature-independent over the range of interest. Express your final RH bias as a unitless decimal (no percent sign), rounded to four significant figures.",
            "solution": "The problem requires the derivation of the bias in a relative humidity ($RH$) measurement that arises from a known bias in an air temperature measurement. The derivation must be based on first principles, specifically the definition of relative humidity and the Clausius-Clapeyron relation, and be accurate to the first order in the temperature bias, $\\Delta T$.\n\nThe relative humidity, $RH$, is defined as the ratio of the partial pressure of water vapor, $e$, to the saturation vapor pressure, $e_s(T)$, at a given air temperature, $T$.\n$$RH = \\frac{e}{e_s(T)}$$\n\nLet $T$ and $RH_{\\text{true}}$ be the true air temperature and true relative humidity, respectively. Let $T_{\\text{meas}}$ be the measured air temperature, which includes a bias $\\Delta T$.\n$$T_{\\text{meas}} = T + \\Delta T$$\nThe problem states that the water vapor partial pressure, $e$, is measured without bias. Thus, the measured value of $e$ is equal to its true value. We can express the true partial pressure $e$ using the true relative humidity and true saturation vapor pressure:\n$$e = RH_{\\text{true}} \\cdot e_s(T)$$\n\nThe measured relative humidity, $RH_{\\text{meas}}$, is computed using the measured (unbiased) partial pressure $e$ and the saturation vapor pressure corresponding to the measured (biased) temperature, $T_{\\text{meas}}$.\n$$RH_{\\text{meas}} = \\frac{e}{e_s(T_{\\text{meas}})} = \\frac{e}{e_s(T + \\Delta T)}$$\n\nSubstituting the expression for $e$ from the true conditions into the equation for $RH_{\\text{meas}}$, we get:\n$$RH_{\\text{meas}} = \\frac{RH_{\\text{true}} \\cdot e_s(T)}{e_s(T + \\Delta T)}$$\n\nTo proceed, we need to relate $e_s(T + \\Delta T)$ to $e_s(T)$. The Clausius-Clapeyron relation describes the temperature dependence of the saturation vapor pressure. For the transition between liquid water and water vapor, assuming the vapor behaves as an ideal gas and the specific volume of the liquid is negligible compared to that of the vapor, the relation is:\n$$\\frac{de_s}{dT} = \\frac{L_v e_s}{R_v T^2}$$\nwhere $L_v$ is the specific latent heat of vaporization and $R_v$ is the specific gas constant for water vapor.\n\nThe problem asks for a first-order approximation in $\\Delta T$. We can obtain this by performing a first-order Taylor series expansion of the function $e_s(T_{\\text{meas}}) = e_s(T + \\Delta T)$ around the true temperature $T$:\n$$e_s(T + \\Delta T) \\approx e_s(T) + \\left. \\frac{de_s}{dT} \\right|_T \\Delta T$$\nSubstituting the Clausius-Clapeyron relation for the derivative term gives:\n$$e_s(T + \\Delta T) \\approx e_s(T) + \\left( \\frac{L_v e_s(T)}{R_v T^2} \\right) \\Delta T$$\nFactoring out $e_s(T)$, we have:\n$$e_s(T + \\Delta T) \\approx e_s(T) \\left( 1 + \\frac{L_v \\Delta T}{R_v T^2} \\right)$$\n\nNow, we substitute this approximation back into the expression for $RH_{\\text{meas}}$:\n$$RH_{\\text{meas}} \\approx \\frac{RH_{\\text{true}} \\cdot e_s(T)}{e_s(T) \\left( 1 + \\frac{L_v \\Delta T}{R_v T^2} \\right)} = RH_{\\text{true}} \\left( 1 + \\frac{L_v \\Delta T}{R_v T^2} \\right)^{-1}$$\n\nTo maintain a first-order approximation in $\\Delta T$, we use the binomial approximation $(1 + x)^n \\approx 1 + nx$ for small $x$. Here, $n = -1$ and $x = \\frac{L_v \\Delta T}{R_v T^2}$, which is a small quantity since $\\Delta T$ is small.\n$$RH_{\\text{meas}} \\approx RH_{\\text{true}} \\left( 1 - \\frac{L_v \\Delta T}{R_v T^2} \\right)$$\n\nThe RH bias, which we can denote as $\\Delta RH$, is the difference between the measured and true relative humidity, $RH_{\\text{meas}} - RH_{\\text{true}}$.\n$$\\Delta RH = RH_{\\text{meas}} - RH_{\\text{true}} \\approx RH_{\\text{true}} \\left( 1 - \\frac{L_v \\Delta T}{R_v T^2} \\right) - RH_{\\text{true}}$$\n$$\\Delta RH \\approx RH_{\\text{true}} - RH_{\\text{true}} \\frac{L_v \\Delta T}{R_v T^2} - RH_{\\text{true}}$$\n$$\\Delta RH \\approx - RH_{\\text{true}} \\frac{L_v \\Delta T}{R_v T^2}$$\n\nThis is the first-order expression for the RH bias. We can now substitute the given numerical values:\n- True relative humidity: $RH_{\\text{true}} = 0.60$\n- True air temperature: $T = 285\\ \\mathrm{K}$\n- Temperature bias: $\\Delta T = +0.50\\ \\mathrm{K}$\n- Latent heat of vaporization: $L_v = 2.5 \\times 10^{6}\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}$\n- Gas constant for water vapor: $R_v = 461\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$\n\nPlugging these values into the expression for $\\Delta RH$:\n$$\\Delta RH \\approx - (0.60) \\frac{(2.5 \\times 10^6\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}) (0.50\\ \\mathrm{K})}{(461\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}) (285\\ \\mathrm{K})^2}$$\n$$\\Delta RH \\approx - (0.60) \\frac{1.25 \\times 10^6}{461 \\times 81225}$$\n$$\\Delta RH \\approx - (0.60) \\frac{1.25 \\times 10^6}{37444725}$$\n$$\\Delta RH \\approx - (0.60) \\times 0.03338169...$$\n$$\\Delta RH \\approx -0.02002901...$$\n\nThe problem requires the answer to be rounded to four significant figures.\n$$\\Delta RH \\approx -0.02003$$\nThe negative sign indicates that a warm bias in temperature measurement leads to an underestimation of the relative humidity, which is physically consistent since $e_s(T)$ increases with $T$.",
            "answer": "$$\\boxed{-0.02003}$$"
        },
        {
            "introduction": "Building on the concept of temperature sensitivity, we now tackle a full inversion problem, a core task in data assimilation where unmeasured state variables are inferred from observations. The integrated form of the Clausius-Clapeyron relation provides the explicit thermodynamic link between air temperature, relative humidity, and dew point temperature. This practice challenges you to derive this relationship from first principles to retrieve the dew point, and then to assess the stability of this inversion by deriving its condition numbers, a key concept for quantifying uncertainty in remote sensing and numerical modeling .",
            "id": "4085126",
            "problem": "A data assimilation module within a Numerical Weather Prediction (NWP) system requires retrieving the dew point temperature $T_{d}$ from measurements of air temperature $T$ and Relative Humidity (RH), and assessing the conditioning of this inversion for uncertainty quantification in the observation operator. Work under the following physically standard assumptions: the saturation vapor pressure $e_{s}(T)$ over liquid water obeys the differential Clausius-Clapeyron relation with temperature-independent latent heat of vaporization $L_{v}$ and a constant specific gas constant for water vapor $R_{v}$; the actual vapor pressure $e$ satisfies the thermodynamic definitions $e = \\mathrm{RH} \\, e_{s}(T)$ and $e = e_{s}(T_{d})$. Use a reference state $(T_{0}, e_{s0})$ at which $e_{s}(T_{0}) = e_{s0}$ is known, without invoking any empirical saturation formulas.\n\nTasks:\n- Starting from the differential Clausius-Clapeyron relation (with the above constants), derive an analytic expression for $e_{s}(T)$ referenced to $(T_{0}, e_{s0})$.\n- Use the thermodynamic definitions to formulate and perform the exact inversion for $T_{d}$ as a closed-form function of the measured $T$ and $\\mathrm{RH}$.\n- Derive the relative condition numbers (sensitivities) $\\kappa_{\\mathrm{RH}}$ and $\\kappa_{T}$ of the inversion, defined by\n$$\n\\kappa_{x} = \\lim_{\\delta \\to 0} \\sup \\left| \\frac{\\delta T_{d}/T_{d}}{\\delta x/x} \\right| \\quad \\text{for } x \\in \\{\\mathrm{RH}, T\\},\n$$\nexpressed purely in terms of $T$, $T_{d}$, $L_{v}$, and $R_{v}$.\n- Evaluate $T_{d}$, $\\kappa_{\\mathrm{RH}}$, and $\\kappa_{T}$ for the case $T = 296.15$ and $\\mathrm{RH} = 0.6$ using $L_{v} = 2.5 \\times 10^{6}$ and $R_{v} = 461.5$, where $T$ and $T_{d}$ are in Kelvin and $L_{v}$ and $R_{v}$ are in Joules per kilogram and Joules per kilogram per Kelvin, respectively. Express $T_{d}$ in Kelvin and round it to four significant figures. Express $\\kappa_{\\mathrm{RH}}$ and $\\kappa_{T}$ as pure decimal numbers rounded to three significant figures.\n\nYour final answer must be either a single real number or a single closed-form analytic expression; if you provide multiple requested numerical quantities, write them as a single row matrix.",
            "solution": "The first task is to derive an expression for the saturation vapor pressure $e_{s}(T)$. We start with the Clausius-Clapeyron relation, which under the given assumptions (ideal gas law for water vapor and neglecting the specific volume of liquid water compared to vapor) is:\n$$\n\\frac{de_{s}}{dT} = \\frac{L_{v} e_{s}}{R_{v} T^{2}}\n$$\nwhere $L_{v}$ is the constant latent heat of vaporization and $R_{v}$ is the specific gas constant for water vapor. This is a separable first-order ordinary differential equation. We separate variables:\n$$\n\\frac{de_{s}}{e_{s}} = \\frac{L_{v}}{R_{v}} \\frac{dT}{T^{2}}\n$$\nWe integrate both sides from a known reference state $(T_{0}, e_{s0})$ to an arbitrary state $(T, e_{s}(T))$:\n$$\n\\int_{e_{s0}}^{e_{s}(T)} \\frac{1}{p} dp = \\int_{T_{0}}^{T} \\frac{L_{v}}{R_{v}} \\frac{1}{\\tau^{2}} d\\tau\n$$\n$$\n[\\ln(p)]_{e_{s0}}^{e_{s}(T)} = \\frac{L_{v}}{R_{v}} \\left[-\\frac{1}{\\tau}\\right]_{T_{0}}^{T}\n$$\n$$\n\\ln(e_{s}(T)) - \\ln(e_{s0}) = \\frac{L_{v}}{R_{v}} \\left(-\\frac{1}{T} + \\frac{1}{T_{0}}\\right)\n$$\n$$\n\\ln\\left(\\frac{e_{s}(T)}{e_{s0}}\\right) = \\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\n$$\nExponentiating both sides yields the expression for $e_{s}(T)$:\n$$\ne_{s}(T) = e_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\\right]\n$$\n\nThe second task is to find the dew point temperature $T_{d}$ as a function of air temperature $T$ and relative humidity $\\mathrm{RH}$. The problem provides two definitions for the actual vapor pressure, $e$:\n$1.$ $e = \\mathrm{RH} \\cdot e_{s}(T)$\n$2.$ $e = e_{s}(T_{d})$\nEquating these gives:\n$$\ne_{s}(T_{d}) = \\mathrm{RH} \\cdot e_{s}(T)\n$$\nWe substitute the derived expression for $e_{s}$ into this equation for both $T_{d}$ and $T$:\n$$\ne_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T_{d}}\\right)\\right] = \\mathrm{RH} \\cdot e_{s0} \\exp\\left[\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\\right]\n$$\nThe reference pressure $e_{s0}$ cancels. Taking the natural logarithm of both sides:\n$$\n\\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T_{d}}\\right) = \\ln(\\mathrm{RH}) + \\frac{L_{v}}{R_{v}} \\left(\\frac{1}{T_{0}} - \\frac{1}{T}\\right)\n$$\nThe term involving the reference temperature, $\\frac{L_{v}}{R_{v} T_{0}}$, cancels from both sides, leaving:\n$$\n-\\frac{L_{v}}{R_{v} T_{d}} = \\ln(\\mathrm{RH}) - \\frac{L_{v}}{R_{v} T}\n$$\nWe solve for $\\frac{1}{T_{d}}$:\n$$\n\\frac{1}{T_{d}} = \\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\n$$\nInverting this expression gives the closed-form solution for $T_{d}$:\n$$\nT_{d}(T, \\mathrm{RH}) = \\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)^{-1}\n$$\n\nThe third task is to derive the relative condition numbers (sensitivities) $\\kappa_{\\mathrm{RH}}$ and $\\kappa_{T}$. The general definition is $\\kappa_{x} = \\left| \\frac{x}{y} \\frac{\\partial y}{\\partial x} \\right|$. Here, $y = T_{d}$.\n\nFor $\\kappa_{\\mathrm{RH}}$, we need $\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}}$. We use the chain rule on $T_{d} = \\left(f(\\mathrm{RH})\\right)^{-1}$:\n$$\n\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}} = -\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)^{-2} \\cdot \\frac{\\partial}{\\partial \\mathrm{RH}}\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)\n$$\n$$\n\\frac{\\partial T_{d}}{\\partial \\mathrm{RH}} = -T_{d}^{2} \\left(-\\frac{R_{v}}{L_{v}} \\frac{1}{\\mathrm{RH}}\\right) = \\frac{R_{v} T_{d}^{2}}{L_{v} \\mathrm{RH}}\n$$\nThe condition number is then:\n$$\n\\kappa_{\\mathrm{RH}} = \\left|\\frac{\\mathrm{RH}}{T_{d}} \\frac{\\partial T_{d}}{\\partial \\mathrm{RH}}\\right| = \\left|\\frac{\\mathrm{RH}}{T_{d}} \\cdot \\frac{R_{v} T_{d}^{2}}{L_{v} \\mathrm{RH}}\\right| = \\left|\\frac{R_{v} T_{d}}{L_{v}}\\right|\n$$\nSince $R_{v}$, $L_{v}$, and $T_{d}$ (in Kelvin) are positive, the absolute value is redundant.\n$$\n\\kappa_{\\mathrm{RH}} = \\frac{R_{v} T_{d}}{L_{v}}\n$$\n\nFor $\\kappa_{T}$, we need $\\frac{\\partial T_{d}}{\\partial T}$. Differentiating the equation for $\\frac{1}{T_{d}}$ implicitly with respect to $T$ is more direct:\n$$\n\\frac{\\partial}{\\partial T}\\left(\\frac{1}{T_{d}}\\right) = \\frac{\\partial}{\\partial T}\\left(\\frac{1}{T} - \\frac{R_{v}}{L_{v}} \\ln(\\mathrm{RH})\\right)\n$$\n$$\n-\\frac{1}{T_{d}^{2}} \\frac{\\partial T_{d}}{\\partial T} = -\\frac{1}{T^{2}}\n$$\n$$\n\\frac{\\partial T_{d}}{\\partial T} = \\frac{T_{d}^{2}}{T^{2}}\n$$\nThe condition number is then:\n$$\n\\kappa_{T} = \\left|\\frac{T}{T_{d}} \\frac{\\partial T_{d}}{\\partial T}\\right| = \\left|\\frac{T}{T_{d}} \\cdot \\frac{T_{d}^{2}}{T^{2}}\\right| = \\left|\\frac{T_{d}}{T}\\right|\n$$\nSince both temperatures are in Kelvin, they are positive.\n$$\n\\kappa_{T} = \\frac{T_{d}}{T}\n$$\n\nThe fourth task is to evaluate $T_{d}$, $\\kappa_{\\mathrm{RH}}$, and $\\kappa_{T}$ for the given values: $T = 296.15$ K, $\\mathrm{RH} = 0.6$, $L_{v} = 2.5 \\times 10^{6}$ J/kg, and $R_{v} = 461.5$ J/(kg·K).\n\nFirst, we calculate $T_{d}$:\n$$\n\\frac{1}{T_{d}} = \\frac{1}{296.15} - \\frac{461.5}{2.5 \\times 10^{6}} \\ln(0.6)\n$$\n$$\n\\frac{1}{T_{d}} \\approx 0.0033766706 - (1.846 \\times 10^{-4})(-0.51082562)\n$$\n$$\n\\frac{1}{T_{d}} \\approx 0.0033766706 + 0.00009430048 \\approx 0.0034709711 \\text{ K}^{-1}\n$$\n$$\nT_{d} = \\frac{1}{0.0034709711} \\approx 288.104 \\text{ K}\n$$\nRounding to four significant figures, $T_{d} = 288.1$ K.\n\nNext, we calculate the condition numbers using the derived expressions and the calculated $T_{d}$:\n$$\n\\kappa_{\\mathrm{RH}} = \\frac{R_{v} T_{d}}{L_{v}} = \\frac{461.5 \\times 288.104}{2.5 \\times 10^{6}} \\approx 0.053204\n$$\nRounding to three significant figures, $\\kappa_{\\mathrm{RH}} = 0.0532$.\n$$\n\\kappa_{T} = \\frac{T_{d}}{T} = \\frac{288.104}{296.15} \\approx 0.972833\n$$\nRounding to three significant figures, $\\kappa_{T} = 0.973$.\n\nThe final numerical results are $T_{d} \\approx 288.1$ K, $\\kappa_{\\mathrm{RH}} \\approx 0.0532$, and $\\kappa_{T} \\approx 0.973$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 288.1  0.0532  0.973 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While analytical solutions are powerful, many real-world problems in numerical modeling require iterative numerical methods. A prime example is \"saturation adjustment,\" a fundamental process in weather and climate model parameterizations that ensures thermodynamic consistency when condensation occurs. In this final practice, you will bridge theory and computation by developing a Newton-Raphson solver to find the equilibrium temperature of an air parcel, a task that involves deriving the necessary Jacobian from the Clausius-Clapeyron relation and implementing a robust algorithm from scratch .",
            "id": "4085045",
            "problem": "Consider a one-dimensional saturation adjustment in which an adjusted temperature $T_{\\text{adj}}$ at fixed pressure $p$ must satisfy the diagnostic consistency condition $q_v = q_s(T_{\\text{adj}}, p)$, where $q_v$ is a given water vapor specific humidity and $q_s(T,p)$ is the saturation specific humidity at temperature $T$ and pressure $p$. Formulate a root-finding problem for $T_{\\text{adj}}$ and derive a Newton iteration whose Jacobian uses the temperature derivative $\\partial q_s / \\partial T$ obtained from the Clausius-Clapeyron relation. Your derivation must start from the following fundamental base:\n- The Clausius-Clapeyron relation in differential form for saturation vapor pressure $e_s(T)$ under the assumption of constant latent heat of vaporization $L_v$ and constant water vapor gas constant $R_v$: $\\mathrm{d} e_s / \\mathrm{d} T = L_v \\, e_s / (R_v T^2)$.\n- The ideal-gas based definitions that relate saturation vapor pressure $e_s(T)$ at total pressure $p$ to the saturation mixing ratio $w_s(T,p)$ and saturation specific humidity $q_s(T,p)$:\n  - $w_s(T,p) = \\varepsilon \\, e_s(T) / (p - e_s(T))$ with $\\varepsilon = R_d / R_v$ and dry-air gas constant $R_d$,\n  - $q_s(T,p) = w_s(T,p) / \\left(1 + w_s(T,p)\\right)$.\nAssume constant material parameters and reference values: $L_v = 2.5 \\times 10^6$ J kg$^{-1}$, $R_v = 461.5$ J kg$^{-1}$ K$^{-1}$, $R_d = 287.04$ J kg$^{-1}$ K$^{-1}$, $\\varepsilon = R_d / R_v$, reference temperature $T_0 = 273.15$ K, and reference saturation vapor pressure $e_{s0} = 611.2$ Pa at $T_0$.\n\nTask:\n- Starting from the stated base only, express the problem as finding the root of a scalar function $f(T)$ and derive a Newton iteration $T_{n+1} = T_n - f(T_n)/f'(T_n)$ for this problem. Derive an explicit expression for the Jacobian $f'(T)$ using the chain rule and the Clausius-Clapeyron relation, without introducing any additional assumptions beyond those stated.\n- Design a robust algorithm that enforces a physically reasonable temperature search interval $T \\in [T_{\\min}, T_{\\max}]$ with $T_{\\min} = 180$ K and $T_{\\max} = 330$ K. If a Newton step proposes a temperature outside this interval, perform a simple backtracking line search to keep the iterate in the interval and ensure convergence for all provided test cases.\n- Use absolute convergence tolerances $\\delta_T = 10^{-8}$ K and $\\delta_q = 10^{-12}$ for the step size and residual, respectively. Stop when both $|T_{n+1} - T_n| \\le \\delta_T$ and $|f(T_{n+1})| \\le \\delta_q$, or after a maximum of $N_{\\max} = 100$ iterations. If the target $q_v$ is outside the attainable range $[q_s(T_{\\min},p), q_s(T_{\\max},p)]$, return the nearest bound temperature.\n- Implement your algorithm as a complete, runnable program that computes $T_{\\text{adj}}$ for the following test suite. Each test case is a pair $(p, q_v)$ with pressure in pascals and specific humidity in kilograms per kilogram:\n  1. $(p, q_v) = (100000, q_s(273.15, 100000))$,\n  2. $(p, q_v) = (100000, 0.010)$,\n  3. $(p, q_v) = (70000, 0.002)$,\n  4. $(p, q_v) = (95000, 0.022)$,\n  5. $(p, q_v) = (80000, 0.040)$.\n- Your program must compute $q_s(273.15, 100000)$ internally from the stated base to construct test case $1$.\n\nOutput requirement:\n- For each test case, compute the adjusted temperature $T_{\\text{adj}}$ in kelvin and round it to six decimal places.\n- Your program should produce a single line of output containing the results for the test suite as a comma-separated list of floats enclosed in square brackets, in the same order as the test suite, for example, $[T_1, T_2, T_3, T_4, T_5]$ with each $T_i$ rounded to six decimal places and expressed in K.",
            "solution": "The problem requires the formulation and solution of a root-finding problem to determine an adjusted temperature, $T_{\\text{adj}}$, that satisfies the saturation condition $q_v = q_s(T_{\\text{adj}}, p)$ for a given specific humidity $q_v$ and pressure $p$. The solution must be found using a Newton iteration, for which the Jacobian must be derived from fundamental thermodynamic principles.\n\nFirst, we formalize the problem. We seek the root of the scalar function $f(T)$:\n$$f(T) = q_s(T, p) - q_v = 0$$\nThe Newton-Raphson method provides an iterative scheme to find the root $T_{\\text{adj}}$:\n$$T_{n+1} = T_n - \\frac{f(T_n)}{f'(T_n)}$$\nwhere $T_n$ is the temperature at iteration $n$, and $f'(T_n)$ is the derivative of $f(T)$ evaluated at $T_n$. Given the definition of $f(T)$, its derivative with respect to temperature is:\n$$f'(T) = \\frac{\\mathrm{d}}{\\mathrm{d}T} \\left( q_s(T, p) - q_v \\right) = \\frac{\\partial q_s}{\\partial T}$$\nsince $p$ and $q_v$ are constant for a given problem instance. Our primary task is to derive an explicit expression for the Jacobian, $\\partial q_s / \\partial T$.\n\nThe derivation begins with the provided relationships between saturation specific humidity $q_s$, saturation mixing ratio $w_s$, and saturation vapor pressure $e_s$. We apply the chain rule:\n$$\\frac{\\partial q_s}{\\partial T} = \\frac{\\mathrm{d} q_s}{\\mathrm{d} w_s} \\frac{\\partial w_s}{\\partial e_s} \\frac{\\mathrm{d} e_s}{\\mathrm{d} T}$$\nWe will derive each term in this product.\n\n1.  **Derivative of $q_s$ with respect to $w_s$**:\n    Given $q_s = w_s / (1 + w_s)$, the derivative is:\n    $$\\frac{\\mathrm{d} q_s}{\\mathrm{d} w_s} = \\frac{\\mathrm{d}}{\\mathrm{d} w_s} \\left( \\frac{w_s}{1+w_s} \\right) = \\frac{1 \\cdot (1+w_s) - w_s \\cdot 1}{(1+w_s)^2} = \\frac{1}{(1+w_s)^2}$$\n\n2.  **Derivative of $w_s$ with respect to $e_s$**:\n    Given $w_s = \\varepsilon e_s / (p - e_s)$, where $\\varepsilon = R_d/R_v$, the partial derivative with respect to $e_s$ (holding $p$ constant) is:\n    $$\\frac{\\partial w_s}{\\partial e_s} = \\frac{\\partial}{\\partial e_s} \\left( \\frac{\\varepsilon e_s}{p - e_s} \\right) = \\frac{\\varepsilon (p - e_s) - \\varepsilon e_s (-1)}{(p - e_s)^2} = \\frac{\\varepsilon p - \\varepsilon e_s + \\varepsilon e_s}{(p - e_s)^2} = \\frac{\\varepsilon p}{(p-e_s)^2}$$\n\n3.  **Derivative of $e_s$ with respect to $T$**:\n    This is given directly by the Clausius-Clapeyron relation:\n    $$\\frac{\\mathrm{d} e_s}{\\mathrm{d} T} = \\frac{L_v e_s}{R_v T^2}$$\n\nCombining these three parts, we obtain the expression for $\\partial q_s / \\partial T$:\n$$\\frac{\\partial q_s}{\\partial T} = \\frac{1}{(1+w_s)^2} \\cdot \\frac{\\varepsilon p}{(p-e_s)^2} \\cdot \\frac{L_v e_s}{R_v T^2}$$\nTo simplify this for implementation, we can express the term $(1+w_s)^2$ in terms of $p$ and $e_s$:\n$$1+w_s = 1 + \\frac{\\varepsilon e_s}{p - e_s} = \\frac{p - e_s + \\varepsilon e_s}{p-e_s} = \\frac{p + (\\varepsilon-1)e_s}{p-e_s}$$\nSubstituting this back into the derivative expression:\n$$\\frac{\\partial q_s}{\\partial T} = \\left( \\frac{p-e_s}{p + (\\varepsilon-1)e_s} \\right)^2 \\cdot \\frac{\\varepsilon p}{(p-e_s)^2} \\cdot \\frac{L_v e_s}{R_v T^2}$$\nThe $(p-e_s)^2$ terms cancel, yielding a more compact form for the Jacobian:\n$$f'(T) = \\frac{\\partial q_s}{\\partial T} = \\frac{\\varepsilon p}{(p + (\\varepsilon-1)e_s)^2} \\frac{L_v e_s}{R_v T^2}$$\nTo evaluate $f(T)$ and $f'(T)$ at a given temperature $T$, we need the function for saturation vapor pressure, $e_s(T)$. This is found by integrating the differential form of the Clausius-Clapeyron relation, assuming constant $L_v$ and $R_v$, from a reference state $(T_0, e_{s0})$ to $(T, e_s)$:\n$$\\int_{e_{s0}}^{e_s} \\frac{\\mathrm{d}e'_s}{e'_s} = \\int_{T_0}^T \\frac{L_v}{R_v T'^2} \\mathrm{d}T'$$\n$$\\ln\\left(\\frac{e_s}{e_{s0}}\\right) = \\frac{L_v}{R_v} \\left[-\\frac{1}{T'}\\right]_{T_0}^T = \\frac{L_v}{R_v} \\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)$$\nThis yields the explicit formula for $e_s(T)$:\n$$e_s(T) = e_{s0} \\exp\\left[\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right]$$\nThe constants are given as $L_v = 2.5 \\times 10^6$ J kg$^{-1}$, $R_v = 461.5$ J kg$^{-1}$ K$^{-1}$, $R_d = 287.04$ J kg$^{-1}$ K$^{-1}$, $T_0 = 273.15$ K, and $e_{s0} = 611.2$ Pa. The ratio of gas constants is $\\varepsilon = R_d/R_v$.\n\nThe algorithm for finding $T_{\\text{adj}}$ for a given pair $(p, q_v)$ is as follows:\n\n1.  **Initialization**: Define all physical constants and algorithmic parameters ($T_{\\min} = 180$ K, $T_{\\max} = 330$ K, $\\delta_T = 10^{-8}$ K, $\\delta_q = 10^{-12}$, $N_{\\max} = 100$).\n2.  **Boundary Check**: Compute $q_{s, \\min} = q_s(T_{\\min}, p)$ and $q_{s, \\max} = q_s(T_{\\max}, p)$. If $q_v \\le q_{s, \\min}$, the solution is $T_{\\min}$. If $q_v \\ge q_{s, \\max}$, the solution is $T_{\\max}$.\n3.  **Initial Guess**: If $q_v$ is within the bounds, start the Newton iteration with an initial guess, for instance $T_0 = 273.15$ K.\n4.  **Iteration Loop**: For $n = 0, 1, ..., N_{\\max}-1$:\n    a. Calculate $e_s(T_n)$ using the integrated Clausius-Clapeyron equation.\n    b. Calculate $w_s(T_n, p) = \\varepsilon e_s(T_n) / (p - e_s(T_n))$ and then $q_s(T_n, p) = w_s / (1+w_s)$.\n    c. Compute the residual: $f(T_n) = q_s(T_n, p) - q_v$.\n    d. Compute the Jacobian: $f'(T_n) = \\frac{\\varepsilon p}{(p + (\\varepsilon-1)e_s(T_n))^2} \\frac{L_v e_s(T_n)}{R_v T_n^2}$.\n    e. Calculate the Newton step: $\\Delta T = -f(T_n) / f'(T_n)$.\n    f. **Backtracking Line Search**: Propose a new temperature $T_{\\text{prop}} = T_n + \\Delta T$. If $T_{\\text{prop}}$ is outside the interval $[T_{\\min}, T_{\\max}]$, reduce the step size by a factor until the new iterate is within the bounds. A simple bisection of the step factor $\\alpha$ (initially $1$) is used: $T_{n+1} = T_n + \\alpha \\Delta T$.\n    g. **Convergence Check**: Calculate the residual at the new point, $f(T_{n+1}) = q_s(T_{n+1},p) - q_v$. The iteration has converged if both $|\\alpha \\Delta T| \\le \\delta_T$ and $|f(T_{n+1})| \\le \\delta_q$. If so, terminate and return $T_{n+1}$.\n    h. Update the temperature: $T_n \\leftarrow T_{n+1}$.\n5.  **Termination**: If the loop completes without convergence (exceeds $N_{\\max}$), the algorithm fails. Given the well-behaved nature of the function, this is not expected for the given test cases. The final result for each test case is rounded to six decimal places.\nThe first test case requires computing $q_s(273.15, 100000)$ internally to establish the target $q_v$. For this case, the solution is exactly $T_{\\text{adj}} = 273.15$ K, which serves as a validation of the implementation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the adjusted temperature using a Newton-Raphson method\n    based on the Clausius-Clapeyron relation.\n    \"\"\"\n\n    # --- Constants and Reference Values ---\n    L_V = 2.5e6        # J kg^-1\n    R_V = 461.5        # J kg^-1 K^-1\n    R_D = 287.04       # J kg^-1 K^-1\n    EPSILON = R_D / R_V  # Ratio of gas constants\n    T0 = 273.15        # K\n    E_S0 = 611.2       # Pa\n\n    # --- Algorithmic Parameters ---\n    T_MIN = 180.0      # K\n    T_MAX = 330.0      # K\n    TOL_T = 1e-8       # K\n    TOL_Q = 1e-12      # kg kg^-1\n    MAX_ITER = 100\n\n    # --- Helper functions for thermodynamic calculations ---\n    \n    def e_s(T):\n        \"\"\"Saturation vapor pressure (Pa) at temperature T (K).\"\"\"\n        # Ensure T is a float to avoid potential integer division issues, although unlikely here.\n        T = float(T)\n        # Avoid division by zero if T is 0, though outside our domain [180, 330]\n        if T = 0:\n            return 0.0\n        return E_S0 * np.exp((L_V / R_V) * (1.0 / T0 - 1.0 / T))\n\n    def w_s(T, p):\n        \"\"\"Saturation mixing ratio (kg/kg) at T (K) and p (Pa).\"\"\"\n        es = e_s(T)\n        # The denominator p - es is always positive for T = 330 K and p = 70000 Pa.\n        return EPSILON * es / (p - es)\n\n    def q_s(T, p):\n        \"\"\"Saturation specific humidity (kg/kg) at T (K) and p (Pa).\"\"\"\n        ws = w_s(T, p)\n        return ws / (1.0 + ws)\n\n    def dq_s_dT(T, p):\n        \"\"\"\n        Derivative of saturation specific humidity w.r.t. temperature (K^-1).\n        This is the Jacobian f'(T) for the Newton method.\n        \"\"\"\n        es = e_s(T)\n        T = float(T)\n        if T == 0:\n            return 0.0\n            \n        # The Jacobian derived in the solution text\n        # f'(T) = (epsilon * p / (p + (epsilon - 1)*es)**2) * (L_v * es / (R_v * T**2))\n        term1 = (EPSILON * p) / (p + (EPSILON - 1.0) * es)**2\n        term2 = (L_V * es) / (R_V * T**2)\n        return term1 * term2\n\n    def find_adjusted_temperature(p, q_v):\n        \"\"\"\n        Finds T_adj for a given p (Pa) and q_v (kg/kg).\n        \"\"\"\n        # --- Boundary Check ---\n        q_s_min = q_s(T_MIN, p)\n        if q_v = q_s_min:\n            return T_MIN\n\n        q_s_max = q_s(T_MAX, p)\n        if q_v = q_s_max:\n            return T_MAX\n\n        # --- Newton-Raphson Iteration ---\n        T_n = T0  # Initial guess\n        \n        for _ in range(MAX_ITER):\n            # Calculate residual and Jacobian at the current iterate T_n\n            f_Tn = q_s(T_n, p) - q_v\n            fp_Tn = dq_s_dT(T_n, p)\n\n            if abs(fp_Tn)  1e-15: # Avoid division by zero if derivative is flat\n                break\n\n            # Newton step\n            delta_T = -f_Tn / fp_Tn\n            \n            # Backtracking line search to stay within [T_MIN, T_MAX]\n            alpha = 1.0\n            while not (T_MIN = T_n + alpha * delta_T = T_MAX):\n                alpha /= 2.0\n                if alpha  1e-8: # Step size became too small\n                    # This case suggests we are stuck at a boundary, which should be handled by the initial check.\n                    # As a safeguard, return the closest boundary.\n                    return T_MIN if T_n + alpha * delta_T  T_MIN else T_MAX\n\n            T_n_plus_1 = T_n + alpha * delta_T\n            \n            # Check for convergence\n            step_size = abs(T_n_plus_1 - T_n)\n            f_Tn_plus_1 = q_s(T_n_plus_1, p) - q_v\n            \n            if step_size = TOL_T and abs(f_Tn_plus_1) = TOL_Q:\n                return T_n_plus_1\n\n            T_n = T_n_plus_1\n        \n        # If loop finishes, return the last computed temperature (convergence failure)\n        # This should not happen with the given test cases.\n        return T_n\n\n\n    # --- Test Suite ---\n    test_cases = [\n        # (p, q_v)\n        (100000.0, q_s(273.15, 100000.0)),\n        (100000.0, 0.010),\n        (70000.0, 0.002),\n        (95000.0, 0.022),\n        (80000.0, 0.040),\n    ]\n\n    results = []\n    for p_val, qv_val in test_cases:\n        T_adj = find_adjusted_temperature(p_val, qv_val)\n        results.append(f\"{T_adj:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}