{
    "hands_on_practices": [
        {
            "introduction": "Bulk microphysics schemes form the foundation of cloud representation in most weather and climate models, tracking the evolution of condensate by parameterizing the key processes that convert water between different categories. This first exercise focuses on the fundamental warm-rain processes of autoconversion and accretion, where cloud droplets grow into raindrops. By solving a simplified system of ordinary differential equations, you will model the exchange of mass between the cloud water ($q_{c}$) and rainwater ($q_{r}$) mixing ratios, gaining direct insight into the source and sink terms that drive precipitation formation in a model. ",
            "id": "4023353",
            "problem": "Consider an idealized, horizontally homogeneous atmospheric column represented by a single-moment bulk warm-cloud microphysics scheme in a numerical weather prediction model. The prognostic condensate variables are the cloud water mixing ratio $q_{c}$ and rain water mixing ratio $q_{r}$, both expressed in $\\mathrm{g\\,kg^{-1}}$. Assume the only active microphysical processes over a short interval are autoconversion (transfer of $q_{c}$ to $q_{r}$ via self-collection of cloud droplets) and accretion (collection of cloud droplets by raindrops), and neglect evaporation, sedimentation, and sources from condensation during the interval. The thermodynamic state (e.g., temperature and supersaturation) is held fixed so that the rate coefficients remain constant.\n\nAdopt a first-order closure in which the autoconversion mass transfer rate is proportional to $q_{c}$ with coefficient $C$ and the accretion mass transfer rate is proportional to $q_{c}$ with an effective coefficient $k$, both measured in $\\mathrm{s^{-1}}$, representing subgrid-mean collision-induced transfer linearized about the given hydrometeor field. The local condensate mass budget then consists of internal exchange between $q_{c}$ and $q_{r}$ due to these processes.\n\nAt time $t=0$, let $q_{c}(0)=0.8\\ \\mathrm{g\\,kg^{-1}}$ and $q_{r}(0)=0.2\\ \\mathrm{g\\,kg^{-1}}$. Take $C=1\\times 10^{-3}$ $\\mathrm{s^{-1}}$ and $k=2\\times 10^{-3}$ $\\mathrm{s^{-1}}$. Over a duration $\\Delta t=300$ $\\mathrm{s}$, derive from first principles the governing tendencies implied by mass conservation and the stated closures, and compute the net changes in $q_{r}$ and $q_{c}$ attributable solely to autoconversion and accretion over this interval.\n\nExpress your final numeric answers for the net changes $\\Delta q_{r}$ and $\\Delta q_{c}$ in $\\mathrm{g\\,kg^{-1}}$, rounded to four significant figures, and report them as a two-entry row vector in the order $\\Delta q_{r}$, $\\Delta q_{c}$.",
            "solution": "The problem asks for the net changes in cloud water mixing ratio, $q_c$, and rain water mixing ratio, $q_r$, over a time interval $\\Delta t$, considering only the microphysical processes of autoconversion and accretion as described by a simplified first-order closure scheme.\n\nFirst, we validate the problem statement.\n**Step 1: Extract Givens**\n- Prognostic variables: cloud water mixing ratio $q_{c}(t)$ and rain water mixing ratio $q_{r}(t)$, both in $\\mathrm{g\\,kg^{-1}}$.\n- Active processes: Autoconversion and accretion.\n- Neglected processes: Evaporation, sedimentation, sources from condensation.\n- Autoconversion rate from $q_c$ to $q_r$: proportional to $q_c$ with coefficient $C$.\n- Accretion rate from $q_c$ to $q_r$: proportional to $q_c$ with an effective coefficient $k$.\n- Initial conditions at $t=0$: $q_{c}(0)=0.8$ $\\mathrm{g\\,kg^{-1}}$ and $q_{r}(0)=0.2$ $\\mathrm{g\\,kg^{-1}}$.\n- Rate coefficients: $C=1\\times 10^{-3}$ $\\mathrm{s^{-1}}$ and $k=2\\times 10^{-3}$ $\\mathrm{s^{-1}}$.\n- Time interval: $\\Delta t=300$ $\\mathrm{s}$.\n- Required output: Net changes $\\Delta q_{r}$ and $\\Delta q_{c}$ in $\\mathrm{g\\,kg^{-1}}$, rounded to four significant figures, as a two-entry row vector.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem uses a simplified model of warm-cloud microphysics, a standard topic in atmospheric science. The parameterizations for autoconversion and accretion as first-order processes, though idealized, are valid simplifications for educational or specific modeling contexts.\n- **Well-Posed:** The problem is a well-defined initial value problem for a system of linear ordinary differential equations with constant coefficients. All necessary parameters and initial conditions are provided, ensuring a unique and stable solution exists.\n- **Objective:** The problem is stated using clear, quantitative, and unambiguous language common to physics and engineering.\n- **Verdict:** The problem is valid. It is self-contained, scientifically sound within its stated idealizations, and mathematically well-posed.\n\nNow, we proceed to the solution.\n\nThe problem states that autoconversion and accretion are mass transfer processes from the cloud water reservoir ($q_c$) to the rain water reservoir ($q_r$). The rates for these transfers are given as $C q_c$ for autoconversion and $k q_c$ for accretion. We can formulate the governing ordinary differential equations (ODEs) for the time evolution of $q_c$ and $q_r$.\n\nThe rate of change of the cloud water mixing ratio, $\\frac{dq_c}{dt}$, is the sum of the sinks due to both processes:\n$$\n\\frac{dq_c}{dt} = -(\\text{Autoconversion}) - (\\text{Accretion})\n$$\n$$\n\\frac{dq_c}{dt} = -C q_c - k q_c = -(C+k)q_c\n$$\nThe rate of change of the rain water mixing ratio, $\\frac{dq_r}{dt}$, is the sum of the sources from both processes:\n$$\n\\frac{dq_r}{dt} = +(\\text{Autoconversion}) + (\\text{Accretion})\n$$\n$$\n\\frac{dq_r}{dt} = +C q_c + k q_c = (C+k)q_c\n$$\nThe problem neglects all other sources and sinks, implying that the total water condensate mass is conserved. We can verify this by summing the two tendencies:\n$$\n\\frac{d(q_c + q_r)}{dt} = \\frac{dq_c}{dt} + \\frac{dq_r}{dt} = -(C+k)q_c + (C+k)q_c = 0\n$$\nThis confirms that $q_c(t) + q_r(t)$ is a constant, equal to its initial value $q_c(0) + q_r(0)$.\n\nThe ODE for $q_c$ is a first-order, linear, homogeneous differential equation.\n$$\n\\frac{dq_c}{q_c} = -(C+k)dt\n$$\nIntegrating from time $t=0$ to a general time $t$ yields:\n$$\n\\int_{q_c(0)}^{q_c(t)} \\frac{1}{q_c'} dq_c' = \\int_0^t -(C+k) dt'\n$$\n$$\n\\ln\\left(\\frac{q_c(t)}{q_c(0)}\\right) = -(C+k)t\n$$\n$$\nq_c(t) = q_c(0) \\exp(-(C+k)t)\n$$\nThe problem asks for the net change over an interval $\\Delta t = 300$ $\\mathrm{s}$. So we evaluate $q_c(t)$ at $t=\\Delta t$:\n$$\nq_c(\\Delta t) = q_c(0) \\exp(-(C+k)\\Delta t)\n$$\nThe net change in cloud water, $\\Delta q_c$, is defined as $q_c(\\Delta t) - q_c(0)$:\n$$\n\\Delta q_c = q_c(0) \\exp(-(C+k)\\Delta t) - q_c(0) = q_c(0) \\left[ \\exp(-(C+k)\\Delta t) - 1 \\right]\n$$\nFrom the conservation of total condensate, $q_c(\\Delta t) + q_r(\\Delta t) = q_c(0) + q_r(0)$, which implies that the net changes must balance:\n$$\nq_r(\\Delta t) - q_r(0) = -(q_c(\\Delta t) - q_c(0))\n$$\n$$\n\\Delta q_r = -\\Delta q_c\n$$\nSubstituting the expression for $\\Delta q_c$:\n$$\n\\Delta q_r = -q_c(0) \\left[ \\exp(-(C+k)\\Delta t) - 1 \\right] = q_c(0) \\left[ 1 - \\exp(-(C+k)\\Delta t) \\right]\n$$\nNow we substitute the numerical values provided:\n$q_c(0) = 0.8$ $\\mathrm{g\\,kg^{-1}}$\n$C = 1 \\times 10^{-3}$ $\\mathrm{s^{-1}}$\n$k = 2 \\times 10^{-3}$ $\\mathrm{s^{-1}}$\n$\\Delta t = 300$ $\\mathrm{s}$\n\nFirst, we calculate the argument of the exponential function:\n$$\n(C+k)\\Delta t = (1 \\times 10^{-3} \\, \\mathrm{s^{-1}} + 2 \\times 10^{-3} \\, \\mathrm{s^{-1}}) \\times 300 \\, \\mathrm{s} = (3 \\times 10^{-3} \\, \\mathrm{s^{-1}}) \\times (300 \\, \\mathrm{s}) = 0.9\n$$\nNow, we compute $\\Delta q_c$:\n$$\n\\Delta q_c = 0.8 \\left[ \\exp(-0.9) - 1 \\right]\n$$\nUsing a calculator, $\\exp(-0.9) \\approx 0.406569659...$.\n$$\n\\Delta q_c \\approx 0.8 \\times (0.406569659 - 1) = 0.8 \\times (-0.593430341) \\approx -0.474744273\n$$\nThe net change in rain water is $\\Delta q_r = -\\Delta q_c$:\n$$\n\\Delta q_r \\approx -(-0.474744273) = 0.474744273\n$$\nRounding these results to four significant figures as requested:\n$$\n\\Delta q_r \\approx 0.4747 \\, \\mathrm{g\\,kg^{-1}}\n$$\n$$\n\\Delta q_c \\approx -0.4747 \\, \\mathrm{g\\,kg^{-1}}\n$$\nThe final answer is to be presented as a two-entry row vector in the order $\\Delta q_r$, $\\Delta q_c$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.4747  -0.4747\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Once rainwater is formed, its vertical transport due to gravity—a process known as sedimentation—becomes a critical component of the precipitation budget. This practice moves from the 'in-place' microphysical conversions to the spatial redistribution of condensate within the model's vertical grid. You will derive and apply a finite-difference approximation to the rainwater conservation law, using a first-order upwind scheme to calculate the flux of rain between model layers. This exercise provides essential hands-on experience with the numerical methods used to represent hydrometeor transport, a core component of any numerical weather prediction model. ",
            "id": "4023415",
            "problem": "A one-dimensional vertical column of a Numerical Weather Prediction (NWP) model is considered in which only rainwater sedimentation acts on the rainwater mixing ratio $q_{r}$. The vertical coordinate $z$ is positive upward. Let the rain mass be conserved locally relative to the air, so that the governing conservation law in a fixed Eulerian frame for the rainwater mixing ratio is derived from the scalar conservation equation for a constituent with relative velocity. Assume the air density $\\rho$ is constant within the layer of interest and there is no vertical air motion. The terminal fall speed of rain $V_{r}(q_{r})$ is prescribed as a function of $q_{r}$ by\n$$\nV_{r}(q_{r}) \\;=\\; V_{\\ast} \\left(\\frac{q_{r}}{q_{\\ast}}\\right)^{\\beta},\n$$\nwith $V_{\\ast} = 5 \\ \\mathrm{m \\ s^{-1}}$, $q_{\\ast} = 1.0 \\times 10^{-4} \\ \\mathrm{kg \\ kg^{-1}}$, and $\\beta = \\frac{1}{8}$. Consider a model layer $k$ of thickness $\\Delta z = 500 \\ \\mathrm{m}$, bounded above by interface $z_{k-1/2}$ and below by interface $z_{k+1/2}$. The layer-centered rainwater mixing ratios at the adjacent model levels are\n$$\nq_{r,k-1} \\;=\\; 1.0 \\times 10^{-4} \\ \\mathrm{kg \\ kg^{-1}}, \\qquad q_{r,k} \\;=\\; 1.5 \\times 10^{-4} \\ \\mathrm{kg \\ kg^{-1}}.\n$$\nAssume a first-order upwind flux approximation consistent with the sign of the rain relative vertical velocity, i.e., since rain falls downward, the upwind state at an interface is taken from the level immediately above that interface. Starting from the appropriate conservation law, derive a flux-form, layer-mean sedimentation tendency for $q_{r}$ in layer $k$, evaluate it using the given data, and compute the change\n$$\n\\Delta q_{r,k} \\;=\\; \\left(\\frac{\\partial q_{r,k}}{\\partial t}\\right) \\Delta t\n$$\nover a time step $\\Delta t = 30 \\ \\mathrm{s}$. Express the final change in $\\mathrm{kg \\ kg^{-1}}$ and round your answer to four significant figures.",
            "solution": "The problem requires the calculation of the change in rainwater mixing ratio in a model layer due to sedimentation. We begin by establishing the governing conservation law and then discretizing it according to the specified numerical scheme.\n\nLet $q_r$ be the rainwater mixing ratio, defined as the mass of rainwater per unit mass of air. The problem states that the air density $\\rho$ is constant and there is no vertical air motion. Rainwater falls with a terminal velocity $V_r$ relative to the air. The vertical coordinate $z$ is positive upward. Therefore, the absolute vertical velocity of rainwater is $w_r = -V_r$.\n\nThe conservation of rainwater mass in a fixed Eulerian frame is expressed by the continuity equation for the rainwater partial density, $\\rho_r = \\rho q_r$:\n$$\n\\frac{\\partial (\\rho q_r)}{\\partial t} + \\frac{\\partial (\\rho q_r w_r)}{\\partial z} = 0\n$$\nGiven that the air density $\\rho$ is constant, it can be factored out and cancelled from the equation, yielding the conservation law for the mixing ratio $q_r$:\n$$\n\\frac{\\partial q_r}{\\partial t} + \\frac{\\partial (q_r w_r)}{\\partial z} = 0\n$$\nSubstituting $w_r = -V_r(q_r)$, we obtain:\n$$\n\\frac{\\partial q_r}{\\partial t} + \\frac{\\partial (-q_r V_r(q_r))}{\\partial z} = 0\n$$\n$$\n\\frac{\\partial q_r}{\\partial t} = \\frac{\\partial}{\\partial z} \\left( q_r V_r(q_r) \\right)\n$$\nLet us define the kinematic sedimentation flux as $F(q_r) = q_r V_r(q_r)$. This flux represents the volume of rain (as a mixing ratio) passing through a unit horizontal area per unit time, and it is directed downward. The conservation law becomes:\n$$\n\\frac{\\partial q_r}{\\partial t} = \\frac{\\partial F(q_r)}{\\partial z}\n$$\nTo find the layer-mean tendency for model layer $k$, we integrate this equation over the vertical extent of the layer, from its lower boundary at $z_{k+1/2}$ to its upper boundary at $z_{k-1/2}$. The thickness of the layer is $\\Delta z = z_{k-1/2} - z_{k+1/2}$.\n$$\n\\int_{z_{k+1/2}}^{z_{k-1/2}} \\frac{\\partial q_r}{\\partial t} dz = \\int_{z_{k+1/2}}^{z_{k-1/2}} \\frac{\\partial F(q_r)}{\\partial z} dz\n$$\nAssuming the layer-mean mixing ratio is $q_{r,k} \\approx \\frac{1}{\\Delta z} \\int_{z_{k+1/2}}^{z_{k-1/2}} q_r dz$, the left-hand side becomes:\n$$\n\\frac{\\partial}{\\partial t} \\left( \\int_{z_{k+1/2}}^{z_{k-1/2}} q_r dz \\right) = \\frac{\\partial}{\\partial t} (q_{r,k} \\Delta z) = \\Delta z \\frac{\\partial q_{r,k}}{\\partial t}\n$$\nApplying the fundamental theorem of calculus to the right-hand side yields:\n$$\n\\int_{z_{k+1/2}}^{z_{k-1/2}} \\frac{\\partial F(q_r)}{\\partial z} dz = F(z_{k-1/2}) - F(z_{k+1/2}) = F_{k-1/2} - F_{k+1/2}\n$$\nwhere $F_{k-1/2}$ and $F_{k+1/2}$ are the fluxes at the top and bottom interfaces of layer $k$, respectively. Combining these results gives the flux-form, layer-mean tendency for $q_{r,k}$:\n$$\n\\frac{\\partial q_{r,k}}{\\partial t} = \\frac{F_{k-1/2} - F_{k+1/2}}{\\Delta z}\n$$\nThe problem specifies a first-order upwind flux approximation. Since rain falls downward, the motion is unidirectional in the negative $z$ direction. The \"upwind\" value at any interface is therefore the value from the model layer situated immediately above that interface.\nThe flux at the top interface of layer $k$, $F_{k-1/2}$, is determined by the mixing ratio in the layer above, which is layer $k-1$. Thus, $F_{k-1/2} = F(q_{r,k-1})$.\nThe flux at the bottom interface of layer $k$, $F_{k+1/2}$, is determined by the mixing ratio in the layer above this interface, which is layer $k$ itself. Thus, $F_{k+1/2} = F(q_{r,k})$.\n\nSubstituting these into the tendency equation:\n$$\n\\frac{\\partial q_{r,k}}{\\partial t} = \\frac{F(q_{r,k-1}) - F(q_{r,k})}{\\Delta z} = \\frac{q_{r,k-1} V_r(q_{r,k-1}) - q_{r,k} V_r(q_{r,k})}{\\Delta z}\n$$\nWe are given the terminal fall speed relation $V_r(q_r) = V_{\\ast} \\left(\\frac{q_r}{q_{\\ast}}\\right)^{\\beta}$. The flux can be expressed as $F(q_r) = q_r V_{\\ast} \\left(\\frac{q_r}{q_{\\ast}}\\right)^{\\beta} = V_{\\ast} q_{\\ast} \\left(\\frac{q_r}{q_{\\ast}}\\right)^{1+\\beta}$.\nThe given values are:\n$V_{\\ast} = 5 \\ \\mathrm{m \\ s^{-1}}$\n$q_{\\ast} = 1.0 \\times 10^{-4} \\ \\mathrm{kg \\ kg^{-1}}$\n$\\beta = \\frac{1}{8}$\n$\\Delta z = 500 \\ \\mathrm{m}$\n$q_{r,k-1} = 1.0 \\times 10^{-4} \\ \\mathrm{kg \\ kg^{-1}}$\n$q_{r,k} = 1.5 \\times 10^{-4} \\ \\mathrm{kg \\ kg^{-1}}$\n$\\Delta t = 30 \\ \\mathrm{s}$\n\nFirst, we calculate the flux into layer $k$ from above, $F_{k-1/2}$:\nSince $q_{r,k-1} = q_{\\ast}$, the ratio $\\frac{q_{r,k-1}}{q_{\\ast}} = 1$.\n$V_r(q_{r,k-1}) = V_{\\ast} (1)^{\\beta} = V_{\\ast} = 5 \\ \\mathrm{m \\ s^{-1}}$.\n$F_{k-1/2} = q_{r,k-1} V_r(q_{r,k-1}) = (1.0 \\times 10^{-4}) \\times 5 = 5.0 \\times 10^{-4} \\ \\mathrm{m \\ s^{-1}}$.\n\nNext, we calculate the flux out of layer $k$ at the bottom, $F_{k+1/2}$:\nThe ratio $\\frac{q_{r,k}}{q_{\\ast}} = \\frac{1.5 \\times 10^{-4}}{1.0 \\times 10^{-4}} = 1.5$.\n$V_r(q_{r,k}) = V_{\\ast} (1.5)^{\\beta} = 5 \\times (1.5)^{1/8} \\ \\mathrm{m \\ s^{-1}}$.\n$F_{k+1/2} = q_{r,k} V_r(q_{r,k}) = (1.5 \\times 10^{-4}) \\times \\left(5 \\times (1.5)^{1/8}\\right) = 7.5 \\times 10^{-4} \\times (1.5)^{1/8} \\ \\mathrm{m \\ s^{-1}}$.\nThis can be written as $F_{k+1/2} = (5 \\times 1.0 \\times 10^{-4}) \\times (1.5)^{1+1/8} = 5.0 \\times 10^{-4} \\times (1.5)^{9/8} \\ \\mathrm{m \\ s^{-1}}$.\nNumerically, $(1.5)^{9/8} \\approx 1.57799475$.\n$F_{k+1/2} \\approx 5.0 \\times 10^{-4} \\times 1.57799475 = 7.88997375 \\times 10^{-4} \\ \\mathrm{m \\ s^{-1}}$.\n\nNow, we evaluate the tendency:\n$$\n\\frac{\\partial q_{r,k}}{\\partial t} = \\frac{5.0 \\times 10^{-4} - 7.88997375 \\times 10^{-4}}{500} \\ \\mathrm{s^{-1}}\n$$\n$$\n\\frac{\\partial q_{r,k}}{\\partial t} = \\frac{-2.88997375 \\times 10^{-4}}{500} \\ \\mathrm{s^{-1}} = -5.7799475 \\times 10^{-7} \\ \\mathrm{s^{-1}}\n$$\nThe tendency is negative, indicating a net loss of rainwater from layer $k$ because the outflow at the bottom interface is greater than the inflow from the top interface.\n\nFinally, we compute the change in the mixing ratio, $\\Delta q_{r,k}$, over a time step $\\Delta t = 30 \\ \\mathrm{s}$ using a forward Euler approximation:\n$$\n\\Delta q_{r,k} = \\left(\\frac{\\partial q_{r,k}}{\\partial t}\\right) \\Delta t\n$$\n$$\n\\Delta q_{r,k} = (-5.7799475 \\times 10^{-7} \\ \\mathrm{s^{-1}}) \\times (30 \\ \\mathrm{s})\n$$\n$$\n\\Delta q_{r,k} = -1.73398425 \\times 10^{-5} \\ \\mathrm{kg \\ kg^{-1}}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\Delta q_{r,k} \\approx -1.734 \\times 10^{-5} \\ \\mathrm{kg \\ kg^{-1}}\n$$",
            "answer": "$$\n\\boxed{-1.734 \\times 10^{-5}}\n$$"
        },
        {
            "introduction": "Grid cells in weather and climate models are large, and conditions within them are not uniform, yet condensation is highly sensitive to these unresolved fluctuations in temperature and humidity. This advanced exercise introduces a statistical approach to parameterize condensation that explicitly accounts for this subgrid-scale variability. By implementing a Monte Carlo simulation based on a joint probability density function (PDF), you will compute a more realistic grid-mean condensation rate, moving beyond simple grid-average assumptions and into the realm of advanced physical parameterizations. ",
            "id": "4023440",
            "problem": "Design and implement a program that computes the grid-mean condensation rate arising from subgrid variability of water vapor mixing ratio and temperature in an isobaric atmospheric grid cell by performing a saturation adjustment on Monte Carlo samples drawn from a prescribed joint probability density function. The program must construct a bivariate normal probability density function for water vapor mixing ratio and temperature, draw subgrid samples, apply an isobaric saturation adjustment conserving moist enthalpy on each sample, and report the grid-mean condensation rate as a single scalar for each test case.\n\nAll symbols, units, and constants must be used exactly as specified below.\n\nFundamental base:\n- Ideal gas mixture and definitions: Let water vapor specific humidity be denoted by $q_v$ in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$, temperature by $T$ in $\\mathrm{K}$, and pressure by $p$ in $\\mathrm{Pa}$. Let $R_d$ and $R_v$ be the gas constants for dry air and water vapor, respectively, with $R_d = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ and $R_v = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$. Define $\\varepsilon = R_d/R_v$ (dimensionless).\n- Saturation vapor pressure over liquid water: Use the Bolton formulation for saturation vapor pressure,\n$$\ne_s(T) = e_0 \\exp\\!\\left(\\frac{a\\,T_c}{T_c + b}\\right),\n$$\nwith $e_0 = 611.2\\,\\mathrm{Pa}$, $a = 17.67$, $b = 243.5\\,\\mathrm{^\\circ C}$, and $T_c = T - 273.15\\,\\mathrm{^\\circ C}$.\n- Saturation specific humidity at pressure $p$: Under the ideal mixture approximation,\n$$\nq_s(T,p) = \\frac{\\varepsilon\\,e_s(T)}{p - \\left(1 - \\varepsilon\\right)e_s(T)}.\n$$\n- Isobaric saturation adjustment with moist enthalpy conservation: Assume constant-pressure adjustment and neglect the enthalpy of condensate removal during the microphysical time step. Let $c_p = 1004\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ be the specific heat at constant pressure and $L_v = 2.5\\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$ be the latent heat of vaporization (assumed constant). For an initially unsaturated or supersaturated parcel with initial $(q_v, T)$ at pressure $p$, define condensation $0 \\le \\Delta \\le q_v$ such that the final state satisfies\n$$\nT_f = T + \\frac{L_v}{c_p}\\,\\Delta,\\quad q_{v,f} = q_v - \\Delta,\\quad q_{v,f} = q_s(T_f,p).\n$$\nIf $q_v \\le q_s(T,p)$, then $\\Delta = 0$.\n\nStatistical subgrid model:\n- Prescribe a joint bivariate normal distribution for the subgrid $(q_v, T)$,\n$$\n\\begin{bmatrix} q_v \\\\ T \\end{bmatrix} \\sim \\mathcal{N}\\!\\left(\n\\begin{bmatrix} \\mu_{q_v} \\\\ \\mu_{T} \\end{bmatrix},\\;\n\\begin{bmatrix}\n\\sigma_{q_v}^2  \\rho\\,\\sigma_{q_v}\\sigma_T \\\\\n\\rho\\,\\sigma_{q_v}\\sigma_T  \\sigma_T^2\n\\end{bmatrix}\n\\right),\n$$\nwith parameters $(\\mu_{q_v}, \\sigma_{q_v}, \\mu_T, \\sigma_T, \\rho)$ given per test case. If $\\sigma_{q_v} = 0$ or $\\sigma_T = 0$, interpret the corresponding variable as deterministic at its mean.\n- Draw $N$ independent samples from this distribution with a fixed seed per test case for reproducibility. Any sampled $q_v  0$ must be clipped to a small positive floor $q_{\\min} = 10^{-10}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}$ to ensure physical non-negativity.\n\nNumerical task:\n- For each Monte Carlo sample, perform the isobaric saturation adjustment by solving for $\\Delta$ in the nonlinear equation\n$$\nf(\\Delta) = q_v - \\Delta - q_s\\!\\left(T + \\frac{L_v}{c_p}\\Delta,\\;p\\right) = 0,\n$$\nsubject to $0 \\le \\Delta \\le q_v$. Use a robust root-finding method that guarantees convergence for a monotone function (e.g., bisection). For samples with $q_v \\le q_s(T,p)$, set $\\Delta = 0$ without root-finding.\n- Compute the grid-mean condensation rate as\n$$\n\\overline{C} = \\frac{1}{N}\\sum_{i=1}^N \\frac{\\Delta_i}{\\Delta t},\n$$\nin units of $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$, where $\\Delta t$ is the microphysical time step (in $\\mathrm{s}$).\n\nImplementation constraints and output format:\n- Use the constants and formulas exactly as specified above.\n- Angles are not involved.\n- Units: $T$ in $\\mathrm{K}$, $p$ in $\\mathrm{Pa}$, $q_v$ in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$, and $\\Delta t$ in $\\mathrm{s}$. Express each reported condensation rate in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$.\n- Your program must compute results for all test cases below and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3,\\dots]$. Each $r_i$ must be a floating-point number.\n\nTest suite:\nProvide results for the following five cases. For each case, the parameters are $(\\mu_{q_v}, \\sigma_{q_v}, \\mu_T, \\sigma_T, \\rho, p, \\Delta t, N, \\text{seed})$ in the stated units:\n- Case $1$: $(0.012, 0.002, 288.0, 1.0, 0.5, 85000.0, 60.0, 8000, 1)$.\n- Case $2$: $(0.004, 0.0005, 285.0, 0.5, 0.0, 90000.0, 60.0, 8000, 2)$.\n- Case $3$: $(0.014, 0.0, 290.0, 0.0, 0.0, 100000.0, 60.0, 1000, 3)$.\n- Case $4$: $(0.016, 0.004, 292.0, 2.0, -0.6, 95000.0, 30.0, 8000, 4)$.\n- Case $5$: $(0.025, 0.003, 300.0, 1.5, 0.3, 100000.0, 120.0, 8000, 5)$.\n\nThe result for each case is the grid-mean condensation rate $\\overline{C}$ in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$. Your program should produce the single-line output string $[\\overline{C}_1,\\overline{C}_2,\\overline{C}_3,\\overline{C}_4,\\overline{C}_5]$ with the five floats in order.",
            "solution": "The problem requires the computation of a grid-mean condensation rate, $\\overline{C}$, which arises from subgrid-scale statistical fluctuations of temperature, $T$, and water vapor specific humidity, $q_v$. The method prescribed is a Monte Carlo simulation based on a bivariate normal probability density function (PDF) for these variables, followed by a physically-based saturation adjustment for each stochastic sample. The solution is executed for several test cases, each defined by a unique set of statistical parameters and thermodynamic conditions.\n\nThe solution proceeds in three principal stages: first, defining the physical and mathematical framework; second, generating stochastic subgrid samples; and third, applying the numerical algorithm to compute the condensation rate.\n\n**1. Physical and Mathematical Framework**\n\nThe core of the problem lies in the thermodynamics of phase change for water in the atmosphere. The key quantities and relationships are as follows:\n\n- **Saturation State**: The saturation vapor pressure over liquid water, $e_s(T)$, is the partial pressure of water vapor in equilibrium with a plane surface of pure liquid water at temperature $T$. We use the Bolton formulation, an accurate empirical approximation:\n$$\ne_s(T) = e_0 \\exp\\left(\\frac{a(T - T_0)}{T - T_0 + b}\\right)\n$$\nwhere $T_0 = 273.15\\,\\mathrm{K}$ is the freezing point of water, and the constants are given as $e_0 = 611.2\\,\\mathrm{Pa}$, $a = 17.67$, and $b = 243.5\\,\\mathrm{^\\circ C}$. Note that the problem statement uses $T_c$ for temperature in Celsius, which is equivalent to $T-T_0$.\n\n- **Saturation Specific Humidity**: From $e_s(T)$, we determine the saturation specific humidity, $q_s(T, p)$, which is the mass of water vapor per unit mass of moist air in a saturated parcel at temperature $T$ and total pressure $p$. Under the ideal gas mixture approximation, it is given by:\n$$\nq_s(T,p) = \\frac{\\varepsilon\\,e_s(T)}{p - (1 - \\varepsilon)e_s(T)}\n$$\nwhere $\\varepsilon = R_d/R_v \\approx 0.622$ is the ratio of the specific gas constants for dry air ($R_d = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$) and water vapor ($R_v = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$).\n\n- **Isobaric Saturation Adjustment**: When a parcel of air becomes supersaturated, i.e., $q_v > q_s(T, p)$, condensation occurs, releasing latent heat and warming the parcel. This process continues until the parcel state reaches saturation. We assume this adjustment happens at constant pressure $p$, conserving moist enthalpy. If an amount of water $\\Delta$ (in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$) condenses, the specific humidity decreases and the temperature increases according to:\n$$\nq_{v,f} = q_v - \\Delta \\quad \\text{and} \\quad T_f = T + \\frac{L_v}{c_p}\\Delta\n$$\nwhere $L_v = 2.5 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$ is the latent heat of vaporization and $c_p = 1004\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ is the specific heat of dry air at constant pressure. The final state must be exactly saturated, $q_{v,f} = q_s(T_f, p)$. Substituting the expressions for $q_{v,f}$ and $T_f$ yields a nonlinear equation for the unknown $\\Delta$:\n$$\nq_v - \\Delta = q_s\\left(T + \\frac{L_v}{c_p}\\Delta, p\\right)\n$$\nThis is a root-finding problem for the function $f(\\Delta) = q_v - \\Delta - q_s(T + \\frac{L_v}{c_p}\\Delta, p) = 0$, subject to the physical constraint $0 \\le \\Delta \\le q_v$. Analysis of $f(\\Delta)$ reveals it is strictly monotonically decreasing, as its derivative $f'(\\Delta) = -1 - \\frac{dq_s}{dT_f}\\frac{L_v}{c_p}$ is always negative (since $\\frac{dq_s}{dT_f} > 0$). Furthermore, for an initially supersaturated parcel ($q_v > q_s(T, p)$), we have $f(0) = q_v - q_s(T, p) > 0$ and $f(q_v) = -q_s(T + \\frac{L_v}{c_p}q_v, p) \\le 0$. These conditions guarantee a unique root for $\\Delta$ in the interval $[0, q_v]$. If the parcel is initially unsaturated or saturated ($q_v \\le q_s(T,p)$), no condensation occurs, and $\\Delta=0$.\n\n**2. Statistical Subgrid Model and Monte Carlo Sampling**\n\nThe subgrid variability is modeled by treating $(q_v, T)$ as random variables following a joint bivariate normal distribution:\n$$\n\\begin{bmatrix} q_v \\\\ T \\end{bmatrix} \\sim \\mathcal{N}\\left(\n\\begin{bmatrix} \\mu_{q_v} \\\\ \\mu_{T} \\end{bmatrix},\n\\begin{bmatrix}\n\\sigma_{q_v}^2  \\rho\\,\\sigma_{q_v}\\sigma_T \\\\\n\\rho\\,\\sigma_{q_v}\\sigma_T  \\sigma_T^2\n\\end{bmatrix}\n\\right)\n$$\nFor each test case, the parameters $(\\mu_{q_v}, \\sigma_{q_v}, \\mu_T, \\sigma_T, \\rho)$ are specified. A Monte Carlo approach is used to solve the problem:\n1. For each test case, a set of $N$ random samples $(q_{v,i}, T_i)$ for $i=1, \\dots, N$ is drawn from this distribution. A fixed seed is used for the random number generator to ensure reproducibility.\n2. Any sampled value $q_{v,i}  0$ is physically unrealistic and is clipped to a small positive floor, $q_{\\min} = 10^{-10}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}$.\nIn the special case where a standard deviation is zero (e.g., $\\sigma_{q_v}=0$), that variable is deterministic, and all $N$ samples will have its value fixed at the mean.\n\n**3. Computational Algorithm**\n\nThe overall algorithm combines these elements to compute the grid-mean condensation rate $\\overline{C}$.\n\nFor each test case with parameters $(\\mu_{q_v}, \\sigma_{q_v}, \\mu_T, \\sigma_T, \\rho, p, \\Delta t, N, \\text{seed})$:\n1.  **Generate Samples**: Construct the mean vector $\\boldsymbol{\\mu} = [\\mu_{q_v}, \\mu_T]^T$ and the covariance matrix $\\mathbf{\\Sigma}$. Generate $N$ samples $(q_{v,i}, T_i)$ from $\\mathcal{N}(\\boldsymbol{\\mu}, \\mathbf{\\Sigma})$. Clip any $q_{v,i}  0$.\n2.  **Process Samples**: For each sample $i=1, \\dots, N$:\n    a. Calculate the initial saturation specific humidity $q_{s,i} = q_s(T_i, p)$.\n    b. Check for supersaturation. If $q_{v,i}  q_{s,i}$:\n        i. Solve the nonlinear equation $f(\\Delta_i) = q_{v,i} - \\Delta_i - q_s(T_i + \\frac{L_v}{c_p}\\Delta_i, p) = 0$ for $\\Delta_i$ on the interval $[0, q_{v,i}]$. A robust numerical root-finder, such as the Brent-Dekker algorithm, is employed for this task.\n    c. If $q_{v,i} \\le q_{s,i}$, set $\\Delta_i = 0$.\n3.  **Compute Mean Rate**: After processing all $N$ samples, calculate the ensemble average of the condensed water:\n    $$\n    \\overline{\\Delta} = \\frac{1}{N}\\sum_{i=1}^N \\Delta_i\n    $$\n    Finally, convert this mean condensed amount into a rate by dividing by the specified microphysical time step, $\\Delta t$:\n    $$\n    \\overline{C} = \\frac{\\overline{\\Delta}}{\\Delta t}\n    $$\nThis value $\\overline{C}$, in units of $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$, is the result for the test case. The procedure is repeated for all five cases, and the results are aggregated into the final output format.",
            "answer": "[5.767425114138e-06,2.146603507960e-07,1.036083658252e-05,1.092780652516e-05,1.701198425121e-05]"
        }
    ]
}