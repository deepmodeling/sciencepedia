{
    "hands_on_practices": [
        {
            "introduction": "理解大气浮力的第一步是准确描述一个气块的状态。本练习将理论与应用联系起来，指导您从基本的大气参数出发，计算虚温（$T_v$）、位温（$\\theta$）和虚位温（$\\theta_v$）。通过比较这些值，您将具体地理解水汽是如何让湿空气在相同温度和压力下比干空气更轻、更具浮力的。",
            "id": "4039109",
            "problem": "一个与数值天气预报和气候模拟相关的均匀湿空气块，其特征为：气压 $p=900\\,\\mathrm{hPa}$，热力学温度 $T=295\\,\\mathrm{K}$，水汽比湿 $q_{v}=0.015$（水汽质量与单位湿空气质量之比），液态水比湿 $q_{l}=0$。从各组分的理想气体定律、混合物密度组成关系以及理想气体的可逆绝热热力学出发，推导出计算该气块虚温 $T_{v}$、（干）位温 $\\theta$ 和虚位温 $\\theta_{v}$ 所需的表达式。然后对这三个温度进行数值计算。\n\n假设干空气气体常数 $R_{d}=287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，水汽气体常数 $R_{v}=461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，干空气定压比热 $c_{pd}=1004.67\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，参考气压 $p_{0}=1000\\,\\mathrm{hPa}$。由于 $q_{l}=0$，忽略凝结水的体积贡献。将计算出的每个温度四舍五入至四位有效数字，并以 $\\mathrm{K}$ 为单位表示。\n\n最后，通过比较 $T_{v}$ 和 $\\theta_{v}$ 与在相同 $p$ 和 $T$ 条件下其他方面均相同的干空气块的 $T$ 和 $\\theta$ 的关系，解释计算结果的浮力意义。\n\n提供三个数值 $T_{v}$、$\\theta$ 和 $\\theta_{v}$ 作为最终答案。",
            "solution": "该问题陈述已经过验证，被认为是合理、完整且表述清晰的。它提出了一个大气热力学中的标准问题，具有物理上现实的参数和明确的目标。我们可以开始求解。\n\n任务是为一个湿空气块推导并计算三个量：虚温 $T_v$、位温 $\\theta$ 和虚位温 $\\theta_v$。我们还需要解释其浮力意义。\n\n给定的参数是：\n- 气压：$p=900\\,\\mathrm{hPa} = 9 \\times 10^{4}\\,\\mathrm{Pa}$\n- 温度：$T=295\\,\\mathrm{K}$\n- 水汽比湿：$q_{v}=0.015$\n- 液态水比湿：$q_{l}=0$\n- 干空气气体常数：$R_{d}=287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- 水汽气体常数：$R_{v}=461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- 干空气定压比热：$c_{pd}=1004.67\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- 参考气压：$p_{0}=1000\\,\\mathrm{hPa} = 1 \\times 10^{5}\\,\\mathrm{Pa}$\n\n首先，我们推导虚温 $T_v$ 的表达式。虚温是指一个假想的干空气块在与湿空气块相同气压下，要具有相同密度时所需要达到的温度。\n湿空气的状态方程可以写成 $p = \\rho R_m T$，其中 $\\rho$ 是总密度，$R_m$ 是湿空气混合物的比气体常数。虚温 $T_v$ 的定义允许我们对湿空气混合物使用干空气气体常数 $R_d$：$p = \\rho R_d T_v$。\n令这两个表达式相等，得到 $\\rho R_m T = \\rho R_d T_v$，可简化为 $T_v = T \\frac{R_m}{R_d}$。\n\n混合物的比气体常数 $R_m$ 是干空气（$R_d$）和水汽（$R_v$）比气体常数的质量加权平均值。干空气的质量分数为 $(1-q_v)$，水汽的质量分数为 $q_v$。因此，\n$$R_m = (1-q_v)R_d + q_v R_v$$\n将其代入 $T_v$ 的表达式中：\n$$T_v = T \\frac{(1-q_v)R_d + q_v R_v}{R_d} = T \\left(1-q_v + q_v \\frac{R_v}{R_d}\\right)$$\n这可以改写为：\n$$T_v = T \\left[1 + q_v\\left(\\frac{R_v}{R_d} - 1\\right)\\right]$$\n这就是所求的虚温表达式。\n\n接下来，我们推导位温 $\\theta$ 的表达式。位温定义为将一个气块从其初始状态 $(T, p)$ 可逆绝热地带到标准参考气压 $p_0$ 时所达到的温度。题目指明是“（干）位温”，这意味着在此计算中我们使用干空气的常数。\n对于理想气体的可逆绝热过程，热力学第一定律 $c_p dT - \\alpha dp = 0$（其中 $\\alpha=1/\\rho$ 是比容）可以与理想气体定律 $p\\alpha = RT$ 结合，得到泊松方程。\n对于干空气，我们有 $c_{pd}dT = \\frac{R_d T}{p}dp$。整理并从 $(T, p)$ 积分到 $(\\theta, p_0)$：\n$$\\int_{T}^{\\theta} c_{pd} \\frac{dT'}{T'} = \\int_{p}^{p_0} R_d \\frac{dp'}{p'}$$\n$$c_{pd} \\ln\\left(\\frac{\\theta}{T}\\right) = R_d \\ln\\left(\\frac{p_0}{p}\\right)$$\n$$\\ln\\left(\\frac{\\theta}{T}\\right) = \\frac{R_d}{c_{pd}} \\ln\\left(\\frac{p_0}{p}\\right) = \\ln\\left[\\left(\\frac{p_0}{p}\\right)^{R_d/c_{pd}}\\right]$$\n对两边取指数，得到位温的表达式：\n$$\\theta = T \\left(\\frac{p_0}{p}\\right)^{\\kappa}$$\n其中指数 $\\kappa = R_d/c_{pd}$。\n\n最后，我们考虑虚位温 $\\theta_v$。对于一个未饱和气块，这个量最方便的定义是使用虚温 $T_v$ 而非热力学温度 $T$ 计算出的位温。这个定义很有用，因为对于一个比湿恒定的气块，在干绝热过程中 $\\theta_v$ 是守恒的。\n使用 $\\theta$ 的定义，并用 $T_v$ 替换 $T$：\n$$\\theta_v = T_v \\left(\\frac{p_0}{p}\\right)^{\\kappa}$$\n我们也可以通过代入 $T_v$ 的表达式，将其与 $\\theta$ 直接联系起来：\n$$\\theta_v = T \\left[1 + q_v\\left(\\frac{R_v}{R_d} - 1\\right)\\right] \\left(\\frac{p_0}{p}\\right)^{\\kappa} = \\theta \\left[1 + q_v\\left(\\frac{R_v}{R_d} - 1\\right)\\right]$$\n\n现在我们进行数值计算。\n首先，我们计算必要的参数比率：\n气体常数之比：$\\frac{R_v}{R_d} = \\frac{461.5}{287.05} \\approx 1.60773$\n虚温修正项：$\\frac{R_v}{R_d} - 1 \\approx 0.60773$\n位温指数：$\\kappa = \\frac{R_d}{c_{pd}} = \\frac{287.05}{1004.67} \\approx 0.28574$\n气压比：$\\frac{p_0}{p} = \\frac{1000}{900} = \\frac{10}{9}$\n\n1.  虚温 $T_v$ 的计算：\n    $$T_v = 295\\,\\mathrm{K} \\times \\left[1 + 0.015 \\times \\left(\\frac{461.5}{287.05} - 1\\right)\\right]$$\n    $$T_v = 295 \\times [1 + 0.015 \\times 0.60773...] = 295 \\times [1.009116...] = 297.6892... \\,\\mathrm{K}$$\n    四舍五入至四位有效数字，$T_v = 297.7\\,\\mathrm{K}$。\n\n2.  位温 $\\theta$ 的计算：\n    $$\\theta = 295\\,\\mathrm{K} \\times \\left(\\frac{1000}{900}\\right)^{287.05/1004.67}$$\n    $$\\theta = 295 \\times \\left(\\frac{10}{9}\\right)^{0.28574...} = 295 \\times 1.030568... = 304.0175... \\,\\mathrm{K}$$\n    四舍五入至四位有效数字，$\\theta = 304.0\\,\\mathrm{K}$。\n\n3.  虚位温 $\\theta_v$ 的计算：\n    $$\\theta_v = T_v \\left(\\frac{p_0}{p}\\right)^{\\kappa} = 297.6892... \\,\\mathrm{K} \\times \\left(\\frac{10}{9}\\right)^{0.28574...}$$\n    $$\\theta_v = 297.6892... \\times 1.030568... = 306.7909... \\,\\mathrm{K}$$\n    四舍五入至四位有效数字，$\\theta_v = 306.8\\,\\mathrm{K}$。\n\n浮力意义解释：\n我们将给定的湿空气块与一个在相同气压 $p=900\\,\\mathrm{hPa}$ 和温度 $T=295\\,\\mathrm{K}$ 下其他方面均相同的干空气块进行比较。\n对于湿空气块，我们计算出 $T_v = 297.7\\,\\mathrm{K}$。对于干空气块，$q_v=0$，因此其虚温就是其热力学温度，$T_{v,\\mathrm{dry}} = T = 295\\,\\mathrm{K}$。\n根据用虚温表示的理想气体定律 $p = \\rho R_d T_v$，在恒定气压下，密度 $\\rho$ 与 $T_v$ 成反比。由于 $T_v > T_{v,\\mathrm{dry}}$，湿空气块的密度低于干空气块（$\\rho  \\rho_{\\mathrm{dry}}$）。这意味着在相同的 $p$ 和 $T$ 条件下，湿空气块比干空气块更具浮力。物理原因是水汽分子（$M_w \\approx 18.015\\,\\mathrm{g\\,mol^{-1}}$）比干空气中的平均分子（$M_d \\approx 28.97\\,\\mathrm{g\\,mol^{-1}}$）更轻。\n虚位温 $\\theta_v$ 是一个在未饱和气块绝热垂直运动中守恒的量，并且是在比较不同气压层上的气块时浮力的决定性度量。对于湿空气块，我们计算出 $\\theta_v = 306.8\\,\\mathrm{K}$。对于等效的干空气块，其虚位温等于其位温，$\\theta_{v,\\mathrm{dry}} = \\theta = 304.0\\,\\mathrm{K}$。\n由于 $\\theta_v > \\theta_{v,\\mathrm{dry}}$，湿空气块具有更高的浮力势。如果将湿空气块和干空气块都绝热地移动到任何其他气压层，湿空气块将始终比干空气块更暖、密度更小，因此相对于其周围环境会受到更大的向上浮力（或更小的向下作用力）。",
            "answer": "$$\\boxed{\\begin{pmatrix} 297.7  304.0  306.8 \\end{pmatrix}}$$"
        },
        {
            "introduction": "大气模型对初始条件，特别是湿度，高度敏感。本练习超越了静态计算，通过确定虚温（$T_v$）和虚位温（$\\theta_v$）对水汽比湿（$q_v$）变化的敏感度，来探索大气的动态响应。这项实践对于理解微小的水汽波动如何引发显著的浮力扰动，从而驱动湿对流等过程至关重要。",
            "id": "4110104",
            "problem": "在数值天气预报和气候模拟中，一个静力学模式气柱由干空气和水汽的混合物组成，其凝结相可忽略不计。考虑混合物组分的理想气体定律，其中总压 $p$ 等于气体成分的分压之和。设总质量密度为 $\\rho$，干空气、水汽、液态水和冰的质量分数分别为 $q_{d}$、$q_{v}$、$q_{l}$ 和 $q_{i}$，且有 $q_{d} + q_{v} + q_{l} + q_{i} = 1$。该混合物的理想气体定律可以写作 $p = \\rho T \\left(q_{d} R_{d} + q_{v} R_{v}\\right)$，其中 $T$ 是绝对温度，$R_{d}$ 是干空气的比气体常数，$R_{v}$ 是水汽的比气体常数。虚温 $T_{v}$ 由 $p = \\rho R_{d} T_{v}$ 定义，因此，一个温度为 $T$、混合物组成为 $\\left(q_{d}, q_{v}, q_{l}, q_{i}\\right)$ 的湿空气块，与一个温度为 $T_{v}$、压力相同的干空气块具有相同的密度。\n\n位温 $\\theta$ 定义为 $\\theta = T \\left(\\frac{p_{0}}{p}\\right)^{\\kappa_{d}}$，其中 $p_{0}$ 是一个固定的参考气压，$\\kappa_{d} = \\frac{R_{d}}{c_{pd}}$，$c_{pd}$ 是干空气的定压比热。虚位温 $\\theta_{v}$ 在相同的干空气热力学常数下定义为 $\\theta_{v} = T_{v} \\left(\\frac{p_{0}}{p}\\right)^{\\kappa_{d}}$。\n\n从这些定义和混合物的理想气体定律出发，推导在 $T$、$p$、$q_{l}$ 和 $q_{i}$ 固定的条件下，敏感性 $\\frac{\\partial T_{v}}{\\partial q_{v}}$ 和 $\\frac{\\partial \\theta_{v}}{\\partial q_{v}}$ 的表达式。然后，对于典型的对流层低层条件：温度 $T = 300\\,\\mathrm{K}$，气压 $p = 900\\,\\mathrm{hPa}$，凝结相可忽略不计 $q_{l} = 0$ 且 $q_{i} = 0$，使用常数 $R_{d} = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$、$R_{v} = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$、$c_{pd} = 1004\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ 和 $p_{0} = 1000\\,\\mathrm{hPa}$，对这些敏感性进行数值计算。简要地根据微小水汽波动引起的湿浮力扰动来解释所得数值的大小。\n\n将两个数值敏感性四舍五入到四位有效数字。最终敏感性以 $\\mathrm{K}$ / $\\left(\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\right)$ 为单位表示。最终报告的答案必须只包含这两个敏感性。",
            "solution": "我们从干空气和水汽混合物的理想气体定律开始，其中质量包括凝结相，但凝结相不对气压产生贡献。总压满足\n$$\np = \\rho T \\left(q_{d} R_{d} + q_{v} R_{v}\\right),\n$$\n其中 $q_{d} = 1 - q_{v} - q_{l} - q_{i}$。将 $q_{d}$ 代入状态方程，得到\n$$\np = \\rho T \\left[\\left(1 - q_{v} - q_{l} - q_{i}\\right) R_{d} + q_{v} R_{v}\\right] = \\rho R_{d} T \\left[1 - q_{l} - q_{i} + q_{v} \\left(\\frac{R_{v}}{R_{d}} - 1\\right)\\right].\n$$\n虚温 $T_{v}$ 由 $p = \\rho R_{d} T_{v}$ 定义，因此通过令 $p$ 的表达式相等，可以得到\n$$\nT_{v} = T \\left[1 - q_{l} - q_{i} + q_{v} \\left(\\frac{R_{v}}{R_{d}} - 1\\right)\\right].\n$$\n保持 $T$、$q_{l}$ 和 $q_{i}$ 不变， $T_{v}$ 对 $q_{v}$ 的敏感性为\n$$\n\\frac{\\partial T_{v}}{\\partial q_{v}} = T \\left(\\frac{R_{v}}{R_{d}} - 1\\right).\n$$\n\n在干空气常数下的位温为\n$$\n\\theta = T \\left(\\frac{p_{0}}{p}\\right)^{\\kappa_{d}}, \\quad \\kappa_{d} = \\frac{R_{d}}{c_{pd}}.\n$$\n虚位温一致地定义为\n$$\n\\theta_{v} = T_{v} \\left(\\frac{p_{0}}{p}\\right)^{\\kappa_{d}}.\n$$\n使用上面求得的 $T_{v}$ 表达式，\n$$\n\\theta_{v} = T \\left(\\frac{p_{0}}{p}\\right)^{\\kappa_{d}} \\left[1 - q_{l} - q_{i} + q_{v} \\left(\\frac{R_{v}}{R_{d}} - 1\\right)\\right] = \\theta \\left[1 - q_{l} - q_{i} + q_{v} \\left(\\frac{R_{v}}{R_{d}} - 1\\right)\\right].\n$$\n因此，在 $\\theta$、$q_{l}$ 和 $q_{i}$ 固定的条件下，\n$$\n\\frac{\\partial \\theta_{v}}{\\partial q_{v}} = \\theta \\left(\\frac{R_{v}}{R_{d}} - 1\\right).\n$$\n\n现在我们针对指定的对流层状态计算这些敏感性。首先计算 $\\kappa_{d}$：\n$$\n\\kappa_{d} = \\frac{R_{d}}{c_{pd}} = \\frac{287}{1004} \\approx 0.285857.\n$$\n计算艾克斯纳函数 $\\Pi$ 和位温 $\\theta$：\n$$\n\\Pi = \\left(\\frac{p_{0}}{p}\\right)^{\\kappa_{d}} = \\left(\\frac{1000}{900}\\right)^{0.285857}, \\quad \\theta = T \\Pi.\n$$\n使用 $\\frac{1000}{900} = \\frac{10}{9} \\approx 1.111\\overline{1}$，我们得到\n$$\n\\ln \\Pi = \\kappa_{d} \\ln\\left(\\frac{10}{9}\\right) \\approx 0.285857 \\times 0.1053605 \\approx 0.030118,\n$$\n所以\n$$\n\\Pi \\approx \\exp(0.030118) \\approx 1.03058, \\quad \\theta \\approx 300 \\times 1.03058 \\approx 309.17.\n$$\n接下来计算气体常数比率之差\n$$\n\\delta \\equiv \\frac{R_{v}}{R_{d}} - 1 = \\frac{461}{287} - 1 = \\frac{174}{287} \\approx 0.606271777.\n$$\n因此，\n$$\n\\frac{\\partial T_{v}}{\\partial q_{v}} = T \\delta \\approx 300 \\times 0.606271777 \\approx 181.881533,\n$$\n以及\n$$\n\\frac{\\partial \\theta_{v}}{\\partial q_{v}} = \\theta \\delta \\approx 309.17 \\times 0.606271777 \\approx 187.45.\n$$\n将两者四舍五入到四位有效数字，并以 $\\mathrm{K}$ / $\\left(\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\right)$ 为单位表示，即得到所求的敏感性。\n\n关于浮力扰动的解释：对于该状态下微小的水汽波动 $\\delta q_{v}$，虚位温扰动为 $\\delta \\theta_{v} \\approx \\left(\\frac{\\partial \\theta_{v}}{\\partial q_{v}}\\right) \\delta q_{v}$。在Boussinesq近似下，一个气块的浮力加速度为 $B \\approx g \\frac{\\delta \\theta_{v}}{\\theta_{v,ref}}$，其中 $g$ 是重力加速度，$\\theta_{v,ref}$ 是一个参考虚位温。取 $\\delta q_{v} = 0.001$（即 $1\\,\\mathrm{g}\\,\\mathrm{kg}^{-1}$），$g \\approx 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$，且基态的参考虚位温可近似为位温 $\\theta$，我们发现\n$$\nB \\approx g \\frac{187.45 \\times 0.001}{309.17} \\approx 9.81 \\times 6.06 \\times 10^{-4} \\approx 5.94 \\times 10^{-3}\\ \\mathrm{m}\\,\\mathrm{s}^{-2}.\n$$\n因此，水汽比湿增加 $1\\,\\mathrm{g}\\,\\mathrm{kg}^{-1}$ 会产生量级为 $0.19\\,\\mathrm{K}$ 的虚位温增量和量级为 $6 \\times 10^{-3}\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$ 的浮力加速度。这表明，即使温度变化相对较小，湿度扰动也能实质性地影响浮力加速度，并因此影响湿对流的发展。对于 $q_{v}$，符号为正（增强浮力），而对于凝结相 $q_{l}$ 或 $q_{i}$，符号为负（减小浮力），这与它们通过虚温因子对密度的影响是一致的。",
            "answer": "$$\\boxed{\\begin{pmatrix}181.9  187.5\\end{pmatrix}}$$"
        },
        {
            "introduction": "观测数据的质量对于准确的天气预报和气候模拟至关重要。这个综合性练习要求您将包括温变率和饱和度在内的热力学知识，整合成一个用于无线电探空数据质量控制的实用算法。通过编写程序来检测热力学上不一致的廓线，您将亲身体验基础物理学如何转化为现代气象学中使用的自动化实用工具。",
            "id": "4110055",
            "problem": "设计并实现一个完整的、可运行的程序，该程序使用热力学约束来评估无线电探空廓线，以标记因传感器湿润或结冰而导致的、不一致的虚位温廓线。您的程序必须从适用于数值天气预报和气候模拟的基本定律和核心定义中推导并使用所需的物理量，并应用科学上合理的约束。\n\n从以下基础出发：\n- 湿空气混合物的理想气体定律，以虚温表示，通过 $p=\\rho R_d T_v$ 将气压 $p$、密度 $\\rho$ 和虚温 $T_v$ 联系起来，其中 $R_d$ 为干空气气体常数。\n- 适用于绝热过程和静力平衡的热力学第一定律，将环境温度随高度的变化与经过充分检验的递减率联系起来。在没有相变的情况下，干绝热递减率为 $g/c_p$，其中 $g$ 是重力加速度，$c_p$ 是干空气的定压比热。在有潜热加热的饱和上升过程中，湿绝热递减率 $\\Gamma_m$ 可由相同的原理结合克劳修斯-克拉佩龙关系推导得出。\n- 克劳修斯-克拉佩龙方程使用一个经过充分检验的指数关系，将液态水上的饱和水汽压 $e_s(T)$ 与温度 $T$ 联系起来。\n\n基于以上几点，您必须推导出：\n- 从第一性原理出发，推导湿空气的虚温 $T_v$ 和位温 $\\theta$ 的表达式，然后推导作为这两个量组合的虚位温 $\\theta_v$。\n- 从相对湿度和饱和水汽压推导混合比 $q$ 的表达式，以及饱和混合比 $q_s$ 的表达式。\n- 适用于环境温度随高度变化的干绝热递减率和湿绝热递减率 $\\Gamma_m$。\n\n要实现的质量控制逻辑：\n- 对于相邻层级之间的每一层，通过将端点的相对湿度与饱和阈值进行比较，来确定其是未饱和还是饱和。在未饱和层中（两个端点的相对湿度均小于 $0.95$），环境递减率 $\\Gamma$ 的大小不得超过干绝热递减率 $g/c_p$ 加上一个小的容差。在饱和层中（任一端点的相对湿度大于或等于 $0.95$），$\\Gamma$ 的大小不得超过湿绝热递减率 $\\Gamma_m$ 加上一个小的容差。\n- 应标记指示湿润的持续性过饱和：如果相对湿度在两个或更多连续层级上超过 $1.05$，则该廓线不一致。\n- 如果廓线中任何地方违反了这些约束中的任何一个，则该廓线被标记为不一致。\n\n所有物理变量必须采用以下单位和约定：\n- 气压 $p$ 以帕斯卡 ($\\mathrm{Pa}$) 为单位。\n- 温度 $T$ 以开尔文 ($\\mathrm{K}$) 为单位。\n- 高度 $z$ 以米 ($\\mathrm{m}$) 为单位。\n- 相对湿度 $h$ 为 $0$ 到 $1$ 之间的小数，对于错误的测量可能超过 $1$ (例如, $1.08$)。\n- 重力加速度 $g$ 以 $\\mathrm{m}\\,\\mathrm{s}^{-2}$ 为单位，比热 $c_p$ 以 $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ 为单位，气体常数 $R_d$ 和 $R_v$ 以 $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ 为单位，汽化潜热 $L_v$ 以 $\\mathrm{J}\\,\\mathrm{kg}^{-1}$ 为单位。\n\n容差和阈值：\n- 使用 $\\delta_\\Gamma = 0.001$ $\\mathrm{K}\\,\\mathrm{m}^{-1}$ 的递减率容差。\n- 相对湿度使用 $1.05$ 的过饱和阈值，如果它出现在至少 $2$ 个连续层级上，则认为其是持续性的。\n- 对层分类使用 $0.95$ 的饱和判定阈值。\n\n测试套件：\n提供四个廓线，每个廓线都包含等长的 $z$、$p$、$T$ 和 $h$ 数组：\n- 廓线 $1$ (通用正常对流层廓线)：\n  - 高度 $z$: $\\{0,500,1000,1500,2000,2500,3000\\}$，单位 $\\mathrm{m}$。\n  - 气压 $p$: $\\{100000,93940,88250,82900,77880,73160,68730\\}$，单位 $\\mathrm{Pa}$。\n  - 温度 $T$: $\\{288,285,282,279,276,273,270\\}$，单位 $\\mathrm{K}$。\n  - 相对湿度 $h$: $\\{0.50,0.55,0.60,0.70,0.85,0.90,0.80\\}$，小数形式。\n- 廓线 $2$ (传感器湿润，伴有过饱和和急剧降温)：\n  - 高度 $z$: $\\{0,500,1000,1500,2000,2500,3000\\}$，单位 $\\mathrm{m}$。\n  - 气压 $p$: $\\{100000,93940,88250,82900,77880,73160,68730\\}$，单位 $\\mathrm{Pa}$。\n  - 温度 $T$: $\\{288,285,281,276,273,270,268\\}$，单位 $\\mathrm{K}$。\n  - 相对湿度 $h$: $\\{0.60,0.70,1.10,1.08,0.95,0.90,0.85\\}$，小数形式。\n- 廓线 $3$ (类似传感器结冰的未饱和陡峭递减率)：\n  - 高度 $z$: $\\{0,500,1000,1500,2000,2500,3000\\}$，单位 $\\mathrm{m}$。\n  - 气压 $p$: $\\{100000,93940,88250,82900,77880,73160,68730\\}$，单位 $\\mathrm{Pa}$。\n  - 温度 $T$: $\\{290,284,277,269,260,252,245\\}$，单位 $\\mathrm{K}$。\n  - 相对湿度 $h$: $\\{0.40,0.35,0.30,0.25,0.20,0.20,0.20\\}$，小数形式。\n- 廓线 $4$ (稳定逆温边界情况)：\n  - 高度 $z$: $\\{0,500,1000,1500,2000,2500,3000\\}$，单位 $\\mathrm{m}$。\n  - 气压 $p$: $\\{100000,93940,88250,82900,77880,73160,68730\\}$，单位 $\\mathrm{Pa}$。\n  - 温度 $T$: $\\{285,286,287,287,286,284,282\\}$，单位 $\\mathrm{K}$。\n  - 相对湿度 $h$: $\\{0.80,0.75,0.70,0.65,0.60,0.55,0.50\\}$，小数形式。\n\n您的程序必须：\n- 通过克劳修斯-克拉佩龙关系和理想气体定律框架，使用提供的 $p$、$T$ 和 $h$ 计算混合比 $q$ 和饱和混合比 $q_s$。\n- 通过结合虚温和位温，从其基本定义计算虚位温 $\\theta_v$。\n- 使用指定的容差，对照干绝热和湿绝热约束评估每一层，并标记持续性过饱和。\n- 生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的布尔标志列表，每个廓线一个标志 (例如, $\\left[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{False}\\right]$)。布尔文字量的大小写必须完全一致。\n\n不允许用户输入。使用的所有常量都必须是物理上合理的。程序逻辑必须完全自包含，并适用于提供的测试套件。最终答案是每个廓线的布尔值：如果廓线因约束被标记为不一致，则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。",
            "solution": "我们通过推导必要的热力学量，然后将其转化为系统性地执行约束的算法来展示解决方案。\n\n首先，我们陈述所需的常数和定义。令 $g$ 表示重力加速度，单位为 $\\mathrm{m}\\,\\mathrm{s}^{-2}$；$c_p$ 表示干空气的定压比热，单位为 $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$；$R_d$ 和 $R_v$ 表示干空气和水汽的气体常数，单位为 $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$；$L_v$ 表示汽化潜热，单位为 $\\mathrm{J}\\,\\mathrm{kg}^{-1}$。令 $\\varepsilon = R_d/R_v$，$p_0$ 为参考气压，单位为 $\\mathrm{Pa}$。\n\n我们从使用虚温写出的湿空气混合物理想气体定律开始。如果用虚温代替温度，湿空气密度 $\\rho$ 可以通过干空气气体常数与气压 $p$ 和温度相关联：\n$$\np = \\rho R_d T_v.\n$$\n虚温 $T_v$ 的定义使得使用 $R_d$ 的状态方程对湿空气成立；它修正了温度 $T$ 以计入水汽的浮力效应。使用水汽的质量混合比 $q$（水汽质量与湿空气质量之比），我们得到虚温因子的一阶标准表达式\n$$\nT_v = T \\left(1+\\left(\\frac{1}{\\varepsilon}-1\\right) q \\right),\n$$\n该式可由混合物的总比气体常数用 $q$ 表示，并对 $q$ 进行一阶展开得到（对于典型的大气值 $q \\ll 1$）。因子 $\\left(\\frac{1}{\\varepsilon}-1\\right)$ 约等于 $0.607$，因为 $\\varepsilon \\approx 0.622$。\n\n干空气的位温 $\\theta$ 是指一个气块在绝热且可逆地被带到参考气压 $p_0$ 时所具有的温度。从绝热和静力平衡条件下的热力学第一定律出发，温度、气压和熵之间的关系导出了众所周知的关系式\n$$\n\\theta = T \\left(\\frac{p_0}{p}\\right)^{\\kappa},\n$$\n其中 $\\kappa = R_d/c_p$。此关系可通过沿等熵路径积分 $c_p dT - \\frac{R_d T}{p} dp = 0$ 推导得出，得到 $T p^{-\\kappa} = \\text{常数}$，因此得到所述的 $\\theta$。\n\n虚位温 $\\theta_v$ 结合了这两者，作为一种基于状态方程的湿空气稳定性变量：\n$$\n\\theta_v = \\theta \\left(1+\\left(\\frac{1}{\\varepsilon}-1\\right) q \\right).\n$$\n这个定义是一致的，因为在虚温因子中用 $\\theta$ 代替 $T$ 会得到在绝热映射到 $p_0$ 时密度的正确缩放关系。\n\n为了从相对湿度 $h$ 获得混合比 $q$，我们使用克劳修斯-克拉佩龙方程计算饱和水汽压 $e_s(T)$。对于液态水上的温度，一种常用的、有物理基础的形式是\n$$\ne_s(T) = e_0 \\exp\\!\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right),\n$$\n其中 $e_0$ 是参考温度 $T_0$ 下的饱和水汽压。对于相对湿度 $h$（以小数表示），实际水汽压为 $e = h \\, e_s(T)$。然后，水汽混合比 $q$ 可由应用于分压的道尔顿定律和组分的理想气体定律得出：\n$$\nq = \\frac{\\varepsilon \\, e}{p - e}.\n$$\n类似地，饱和混合比 $q_s$ 可通过用 $e_s(T)$ 代替 $e$ 得到：\n$$\nq_s = \\frac{\\varepsilon \\, e_s(T)}{p - e_s(T)}.\n$$\n\n接下来，我们考虑递减率。对于未饱和层（无凝结），干绝热递减率是热力学第一定律应用于绝热气块的直接结果：\n$$\n\\Gamma_d = \\frac{g}{c_p},\n$$\n其中 $\\Gamma_d$ 是环境温度每单位高度下降的幅度，单位为 $\\mathrm{K}\\,\\mathrm{m}^{-1}$。\n\n对于饱和层，湿绝热递减率 $\\Gamma_m$ 是根据热力学第一定律和克劳修斯-克拉佩龙关系，将绝热上升与潜热释放耦合起来的结果。一个物理上标准的表达式是\n$$\n\\Gamma_m = \\frac{g \\left(1 + \\frac{L_v q_s}{R_d T}\\right)}{c_p + \\frac{L_v^2 q_s \\varepsilon}{R_d T^2}},\n$$\n该式考虑了由于凝结释放潜热而导致的冷却率降低。此表达式的推导过程是：将湿气块的熵变设为零，用做功项和潜热释放 $L_v dq_s$ 来平衡感热变化 $c_p dT$，其中 $dq_s$ 通过克劳修斯-克拉佩龙关系获得。\n\n我们将厚度为 $\\Delta z$ 的气层内的环境递减率定义为\n$$\n\\Gamma = \\frac{T(z) - T(z+\\Delta z)}{\\Delta z},\n$$\n因此 $\\Gamma > 0$ 对应于温度随高度降低。\n\n现在指定质量控制检查：\n- 未饱和约束：如果一个层的两个端点都满足 $h  0.95$，则要求 $\\Gamma \\le \\Gamma_d + \\delta_\\Gamma$，其中 $\\delta_\\Gamma$ 是一个单位为 $\\mathrm{K}\\,\\mathrm{m}^{-1}$ 的容差，以适应测量噪声和离散化。\n- 饱和约束：如果一个层的任一端点满足 $h \\ge 0.95$，则要求 $\\Gamma \\le \\Gamma_m + \\delta_\\Gamma$，其中 $\\Gamma_m$ 是在该层的平均状态下，使用该层的 $T$ 和 $p$ 以及该状态下的 $q_s$ 计算的。\n- 过饱和持续性：如果在两个或更多连续层级上 $h > 1.05$，则标记该廓线。\n\n我们将常数和阈值赋予定为物理上合理的值：\n- $g = 9.81$ in $\\mathrm{m}\\,\\mathrm{s}^{-2}$,\n- $c_p = 1004.0$ in $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $R_d = 287.0$ in $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $R_v = 461.5$ in $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $\\varepsilon = R_d/R_v \\approx 0.622$,\n- $L_v = 2.5 \\times 10^6$ in $\\mathrm{J}\\,\\mathrm{kg}^{-1}$,\n- $e_0 = 611.2$ in $\\mathrm{Pa}$ at $T_0 = 273.15$ in $\\mathrm{K}$,\n- $p_0 = 100000.0$ in $\\mathrm{Pa}$,\n- $\\delta_\\Gamma = 0.001$ in $\\mathrm{K}\\,\\mathrm{m}^{-1}$.\n\n每个廓线的算法步骤：\n1. 对于每个层级 $i$，通过克劳修斯-克拉佩龙关系计算 $e_s(T_i)$，然后计算 $e_i = h_i e_s(T_i)$ 和 $q_i = \\varepsilon e_i/(p_i - e_i)$。计算 $\\theta_i = T_i (p_0/p_i)^{R_d/c_p}$ 和 $T_{v,i} = T_i (1 + (1/\\varepsilon - 1) q_i)$，然后计算 $\\theta_{v,i} = \\theta_i (1 + (1/\\varepsilon - 1) q_i)$。\n2. 对于每对相邻层级 $(i,i+1)$，计算 $\\Delta z = z_{i+1} - z_i$ 和环境递减率 $\\Gamma_i = (T_i - T_{i+1})/\\Delta z$。\n3. 如果 $h_i  0.95$ 且 $h_{i+1}  0.95$，则将该层分类为未饱和，否则为饱和。对于未饱和层，检查 $\\Gamma_i \\le \\Gamma_d + \\delta_\\Gamma$；对于饱和层，计算层平均值 $T_m = (T_i + T_{i+1})/2$，$p_m = (p_i + p_{i+1})/2$，由 $T_m$ 和 $p_m$ 计算 $q_{s,m}$，并检查 $\\Gamma_i \\le \\Gamma_m(T_m,p_m,q_{s,m}) + \\delta_\\Gamma$。\n4. 扫描廓线以查找持续性过饱和：找到任何两个或更多 $h > 1.05$ 的连续层级。\n5. 如果任何检查失败，则将廓线标记为不一致 ($\\mathrm{True}$)。否则，将其标记为一致 ($\\mathrm{False}$)。\n\n应用于测试套件：\n- 廓线 $1$ 的特点是，在未饱和层中递减率适中，远低于 $g/c_p$，且无过饱和；不应被标记。\n- 廓线 $2$ 表现出 $h > 1.05$ 的连续层级，并且在饱和层中温度急剧下降，超过了湿绝热界限；应该被标记。\n- 廓线 $3$ 在多个层中表现出超过 $g/c_p$ 的未饱和递减率；应该被标记。\n- 廓线 $4$ 表现出稳定的逆温，无过饱和，且递减率未违反界限；不应被标记。\n\n程序按廓线 $1$ 到 $4$ 的顺序输出一行，包含四个布尔结果，用方括号括起来，并以逗号分隔，例如 $[\\mathrm{False},\\mathrm{True},\\mathrm{True},\\mathrm{False}]$。",
            "answer": "```python\n# Python 3.12\n# Libraries: numpy 1.23.5 (used), scipy 1.11.4 (not used)\nimport numpy as np\n\n# Physical constants\ng = 9.81  # m s^-2\ncp = 1004.0  # J kg^-1 K^-1\nRd = 287.0  # J kg^-1 K^-1\nRv = 461.5  # J kg^-1 K^-1\nepsilon = Rd / Rv  # ~0.622\nLv = 2.5e6  # J kg^-1\ne0 = 611.2  # Pa\nT0 = 273.15  # K\np0 = 100000.0  # Pa\n\n# Thresholds\ndelta_gamma = 0.001  # K m^-1\nsat_layer_rh_threshold = 0.95\nsupersat_threshold = 1.05\nsupersat_consecutive_levels = 2  # consecutive levels required to flag\n\ndef saturation_vapor_pressure(T):\n    \"\"\"\n    Clausius-Clapeyron over liquid water:\n    e_s(T) = e0 * exp(Lv/Rv * (1/T0 - 1/T))\n    \"\"\"\n    return e0 * np.exp(Lv / Rv * (1.0 / T0 - 1.0 / T))\n\ndef mixing_ratio(p, T, rh):\n    \"\"\"\n    Mixing ratio q = epsilon * e / (p - e), where e = rh * e_s(T).\n    \"\"\"\n    es = saturation_vapor_pressure(T)\n    e = rh * es\n    # Prevent pathological division if e = p by capping e just below p\n    e = np.minimum(e, 0.999 * p)\n    q = epsilon * e / (p - e)\n    return q\n\ndef saturation_mixing_ratio(p, T):\n    \"\"\"\n    Saturation mixing ratio q_s computed with e_s(T).\n    \"\"\"\n    es = saturation_vapor_pressure(T)\n    es = np.minimum(es, 0.999 * p)\n    qs = epsilon * es / (p - es)\n    return qs\n\ndef exner_function(p):\n    kappa = Rd / cp\n    return (p / p0) ** kappa\n\ndef potential_temperature(T, p):\n    kappa = Rd / cp\n    return T * (p0 / p) ** kappa\n\ndef virtual_temperature(T, q):\n    factor = (1.0 / epsilon) - 1.0\n    return T * (1.0 + factor * q)\n\ndef virtual_potential_temperature(T, p, q):\n    theta = potential_temperature(T, p)\n    factor = (1.0 / epsilon) - 1.0\n    return theta * (1.0 + factor * q)\n\ndef dry_adiabatic_lapse_rate():\n    return g / cp  # K/m\n\ndef moist_adiabatic_lapse_rate(T, p):\n    \"\"\"\n    Compute Gamma_m at given T (K) and p (Pa) using saturation mixing ratio qs(T,p):\n    Gamma_m = g * (1 + (Lv * qs)/(Rd * T)) / (cp + (Lv^2 * qs * epsilon)/(Rd * T^2))\n    \"\"\"\n    qs = saturation_mixing_ratio(p, T)\n    numerator = g * (1.0 + (Lv * qs) / (Rd * T))\n    denominator = cp + (Lv * Lv * qs * epsilon) / (Rd * T * T)\n    return numerator / denominator\n\ndef profile_flag(z, p, T, rh):\n    \"\"\"\n    Apply QC rules to a single profile.\n    Returns True if profile is inconsistent, False otherwise.\n    \"\"\"\n    n = len(z)\n    # Compute variables at levels\n    q = mixing_ratio(p, T, rh)\n    theta_v = virtual_potential_temperature(T, p, q)\n\n    # Supersaturation persistence check\n    supersat_mask = rh  supersat_threshold\n    # Count maximum run length of consecutive supersaturation\n    if n  0:\n        # Using simple loop to detect at least 'supersat_consecutive_levels' consecutive True\n        consec = 0\n        persistent_supersat = False\n        for i in range(n):\n            if supersat_mask[i]:\n                consec += 1\n                if consec = supersat_consecutive_levels:\n                    persistent_supersat = True\n                    break\n            else:\n                consec = 0\n        if persistent_supersat:\n            return True\n\n    # Layer checks\n    gamma_d = dry_adiabatic_lapse_rate()\n    for i in range(n - 1):\n        dz = z[i+1] - z[i]\n        if dz = 0:\n            # Non-increasing height is physically inconsistent; flag\n            return True\n        gamma_env = (T[i] - T[i+1]) / dz  # K/m\n        # Classify saturation for the layer\n        unsat_layer = (rh[i]  sat_layer_rh_threshold) and (rh[i+1]  sat_layer_rh_threshold)\n        if unsat_layer:\n            # Unsaturated constraint\n            if gamma_env  (gamma_d + delta_gamma):\n                return True\n        else:\n            # Saturated constraint: compute Gamma_m at layer-mean state\n            Tm = 0.5 * (T[i] + T[i+1])\n            pm = 0.5 * (p[i] + p[i+1])\n            gamma_m = moist_adiabatic_lapse_rate(Tm, pm)\n            if gamma_env  (gamma_m + delta_gamma):\n                return True\n\n    # If all checks pass, profile is consistent\n    return False\n\ndef solve():\n    # Define the test cases from the problem statement.\n\n    # Profile 1\n    z1 = np.array([0, 500, 1000, 1500, 2000, 2500, 3000], dtype=float)\n    p1 = np.array([100000, 93940, 88250, 82900, 77880, 73160, 68730], dtype=float)\n    T1 = np.array([288, 285, 282, 279, 276, 273, 270], dtype=float)\n    rh1 = np.array([0.50, 0.55, 0.60, 0.70, 0.85, 0.90, 0.80], dtype=float)\n\n    # Profile 2\n    z2 = np.array([0, 500, 1000, 1500, 2000, 2500, 3000], dtype=float)\n    p2 = np.array([100000, 93940, 88250, 82900, 77880, 73160, 68730], dtype=float)\n    T2 = np.array([288, 285, 281, 276, 273, 270, 268], dtype=float)\n    rh2 = np.array([0.60, 0.70, 1.10, 1.08, 0.95, 0.90, 0.85], dtype=float)\n\n    # Profile 3\n    z3 = np.array([0, 500, 1000, 1500, 2000, 2500, 3000], dtype=float)\n    p3 = np.array([100000, 93940, 88250, 82900, 77880, 73160, 68730], dtype=float)\n    T3 = np.array([290, 284, 277, 269, 260, 252, 245], dtype=float)\n    rh3 = np.array([0.40, 0.35, 0.30, 0.25, 0.20, 0.20, 0.20], dtype=float)\n\n    # Profile 4\n    z4 = np.array([0, 500, 1000, 1500, 2000, 2500, 3000], dtype=float)\n    p4 = np.array([100000, 93940, 88250, 82900, 77880, 73160, 68730], dtype=float)\n    T4 = np.array([285, 286, 287, 287, 286, 284, 282], dtype=float)\n    rh4 = np.array([0.80, 0.75, 0.70, 0.65, 0.60, 0.55, 0.50], dtype=float)\n\n    test_cases = [\n        (z1, p1, T1, rh1),\n        (z2, p2, T2, rh2),\n        (z3, p3, T3, rh3),\n        (z4, p4, T4, rh4),\n    ]\n\n    results = []\n    for z, p, T, rh in test_cases:\n        flag = profile_flag(z, p, T, rh)\n        results.append(flag)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}