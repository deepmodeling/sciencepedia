{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex numerical solutions, a crucial first step in analyzing any physical system is to understand the relative importance of its governing forces. Scale analysis is a powerful back-of-the-envelope technique that provides profound physical insight by comparing the magnitudes of different terms in the equations of motion. This practice will guide you through a scale analysis of the rotating shallow water equations to derive the Rossby number, a fundamental dimensionless parameter in geophysical fluid dynamics, and reveal why large-scale atmospheric and oceanic flows are often in a state of near-geostrophic balance. ",
            "id": "4103362",
            "problem": "Consider the rotating Shallow Water Equations (SWE) on an $f$-plane as a prototype for synoptic-scale atmospheric dynamics. The momentum equation for the horizontal velocity field $\\boldsymbol{u}(x,y,t)$ in a single-layer shallow fluid with free-surface displacement $\\eta(x,y,t)$ and mean depth $H$ can be written, by invoking Newtonâ€™s second law for a fluid parcel and the hydrostatic balance, as\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} + f\\,\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u} = -g\\,\\nabla \\eta,\n$$\nwhere $f$ is the Coriolis parameter, $g$ is the gravitational acceleration, and $\\hat{\\boldsymbol{k}}$ is the unit vector in the vertical direction. Using a scale analysis grounded in the above dynamical equation and the synoptic-scale midlatitude values $U\\sim 10\\,{\\rm m\\,s^{-1}}$, $L\\sim 10^{6}\\,{\\rm m}$, $f\\sim 10^{-4}\\,{\\rm s^{-1}}$, and $H\\sim 10^{4}\\,{\\rm m}$, derive from first principles the leading-order dimensionless ratio of the nonlinear advective acceleration $(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$ to the Coriolis acceleration $f\\,\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u}$. Express your final answer as a single dimensionless number. No rounding is required.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. All necessary information for the specified task is provided, the physical context is correct, and the question is unambiguous. The shallow water equations are a valid and fundamental model in geophysical fluid dynamics, and scale analysis is a standard technique for understanding the relative importance of different physical effects. The given characteristic scales are representative of synoptic-scale atmospheric phenomena in the midlatitudes.\n\nThe problem asks for the leading-order dimensionless ratio of the nonlinear advective acceleration to the Coriolis acceleration. These terms are found in the provided momentum equation for the rotating shallow water system:\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} + f\\,\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u} = -g\\,\\nabla \\eta\n$$\nThe two terms of interest are:\n1.  The nonlinear advective acceleration: $(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$\n2.  The Coriolis acceleration: $f\\,\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u}$\n\nWe perform a scale analysis to estimate the characteristic magnitude of each term. The problem provides the following synoptic scales:\n-   Characteristic horizontal velocity, $U \\sim 10\\,{\\rm m\\,s^{-1}}$\n-   Characteristic horizontal length scale, $L \\sim 10^{6}\\,{\\rm m}$\n-   Characteristic Coriolis parameter, $f \\sim 10^{-4}\\,{\\rm s^{-1}}$\n\nThe scale of a differential operator like the gradient, $\\nabla$, is determined by the length scale over which the fields it acts upon vary significantly. In this context, that scale is $L$. Therefore, the magnitude of the gradient operator is of the order of $L^{-1}$.\n$$\n|\\nabla| \\sim \\frac{1}{L}\n$$\nSimilarly, the horizontal velocity field $\\boldsymbol{u}$ has a characteristic magnitude of $U$.\n$$\n|\\boldsymbol{u}| \\sim U\n$$\nNow, let's estimate the magnitude of the nonlinear advective acceleration term, $(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$. This term represents the acceleration of a fluid parcel due to its movement through a spatially varying velocity field. Its magnitude can be scaled by the product of the scales of its constituent parts:\n$$\n|(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}| \\sim |\\boldsymbol{u}| \\cdot |\\nabla| \\cdot |\\boldsymbol{u}| \\sim U \\cdot \\frac{1}{L} \\cdot U = \\frac{U^2}{L}\n$$\nNext, we estimate the magnitude of the Coriolis acceleration term, $f\\,\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u}$. This term represents the apparent acceleration due to the rotation of the reference frame. The vector $\\hat{\\boldsymbol{k}}$ is a unit vector, and the cross product $\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u}$ results in a horizontal vector with magnitude $|\\boldsymbol{u}|\\sin\\theta$, where $\\theta$ is the angle between $\\hat{\\boldsymbol{k}}$ and $\\boldsymbol{u}$. Since $\\boldsymbol{u}$ is in the horizontal plane, it is perpendicular to the vertical vector $\\hat{\\boldsymbol{k}}$, so $\\theta = \\pi/2$ and $\\sin\\theta = 1$. Thus, the magnitude of the cross product is simply $|\\boldsymbol{u}|$. The magnitude of the entire term is:\n$$\n|f\\,\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u}| \\sim f \\cdot |\\boldsymbol{u}| \\sim fU\n$$\nThe dimensionless ratio of the nonlinear advective acceleration to the Coriolis acceleration is the ratio of their characteristic magnitudes. This specific ratio is known in fluid dynamics as the Rossby number, denoted $Ro$.\n$$\nRo \\equiv \\frac{\\text{Magnitude of advective acceleration}}{\\text{Magnitude of Coriolis acceleration}} \\sim \\frac{|(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}|}{|f\\,\\hat{\\boldsymbol{k}}\\times \\boldsymbol{u}|} \\sim \\frac{U^2/L}{fU}\n$$\nSimplifying the expression for the Rossby number yields:\n$$\nRo \\sim \\frac{U}{fL}\n$$\nThe problem requires this ratio to be calculated using the provided values. We substitute the given scales into the expression for the Rossby number:\n-   $U = 10\\,{\\rm m\\,s^{-1}}$\n-   $f = 10^{-4}\\,{\\rm s^{-1}}$\n-   $L = 10^{6}\\,{\\rm m}$\n\nThe calculation is as follows:\n$$\nRo \\sim \\frac{10\\,{\\rm m\\,s^{-1}}}{(10^{-4}\\,{\\rm s^{-1}})(10^{6}\\,{\\rm m})} = \\frac{10}{10^{-4} \\cdot 10^{6}} = \\frac{10}{10^{2}} = \\frac{1}{10} = 0.1\n$$\nThe units cancel out, as expected for a dimensionless number: $({\\rm m\\,s^{-1}}) \\cdot ({\\rm s}) \\cdot ({\\rm m^{-1}}) = 1$. The value $0.1$ indicates that for synoptic-scale motions, the Coriolis acceleration is an order of magnitude larger than the advective acceleration, which is the basis for geostrophic balance. The other provided data, $H\\sim 10^{4}\\,{\\rm m}$, are not required for this specific calculation.",
            "answer": "$$\n\\boxed{0.1}\n$$"
        },
        {
            "introduction": "Translating the continuous laws of physics into a discrete numerical algorithm is the core of computational modeling, but this process introduces unique challenges. Chief among them is numerical stability: an improperly designed scheme can cause small errors to grow exponentially, leading to a useless, divergent solution. This exercise introduces the rigorous method of von Neumann stability analysis to explore how a numerical scheme propagates waves and errors. By deriving the famous Courant-Friedrichs-Lewy (CFL) condition, you will establish the essential link between the physical advection speed, the grid spacing $\\Delta x$, and the maximum allowable time step $\\Delta t$ for a stable simulation. ",
            "id": "4103368",
            "problem": "Consider the one-dimensional transport of the free-surface height in the Shallow Water Equations, modeled as linear advection arising from the continuity equation under a spatially uniform, steady velocity. Starting from the conservation of mass for a shallow layer, the continuity equation is $$\\frac{\\partial h}{\\partial t} + \\frac{\\partial (h u)}{\\partial x} = 0,$$ where $h$ is the layer thickness and $u$ is the horizontal velocity. In a regime with a prescribed spatially uniform mean velocity $U$ and small departures in $h$ that are passively transported, this reduces to the linear advection equation $$\\frac{\\partial h}{\\partial t} + U \\frac{\\partial h}{\\partial x} = 0,$$ on a periodic domain. Discretize this equation on a uniform grid $x_j = j\\,\\Delta x$ with explicit forward Euler time stepping $t^n = n\\,\\Delta t$ and a first-order upwind spatial discretization consistent with the sign of $U$. That is, for $U0$, use $$h^{n+1}_j = h^n_j - C\\left(h^n_j - h^n_{j-1}\\right),$$ and for $U0$, use $$h^{n+1}_j = h^n_j - C\\left(h^n_{j+1} - h^n_j\\right),$$ where $C = \\frac{U\\,\\Delta t}{\\Delta x}$ is the Courant number. Assume periodic boundary conditions and perform a von Neumann analysis (Fourier mode analysis) to determine the discrete Lebesgue square-integrable (L$^2$) stability condition, defined here as the requirement that the discrete L$^2$ norm of $h$ does not grow in time for arbitrary initial data.\n\nDerive this stability condition by computing the amplification factor and imposing its modulus to be less than or equal to $1$ for all wavenumbers. Then, report the largest allowable time step, denoted $\\Delta t_{\\max}$, that guarantees discrete L$^2$ stability on this uniform grid. Express your final answer as a single closed-form symbolic expression in terms of $\\Delta x$ and $|U|$. You should not substitute numerical values. If you later evaluate a numerical value, express the time in seconds. No rounding is required in this problem.",
            "solution": "The problem requires the derivation of the discrete L$^2$ stability condition for a first-order upwind discretization of the linear advection equation, using von Neumann analysis. From this condition, the largest allowable time step, $\\Delta t_{\\max}$, must be determined.\n\nThe governing partial differential equation is the linear advection equation:\n$$\n\\frac{\\partial h}{\\partial t} + U \\frac{\\partial h}{\\partial x} = 0\n$$\nwhere $h$ is the fluid depth, $t$ is time, $x$ is the spatial coordinate, and $U$ is a constant, uniform velocity.\n\nThe equation is discretized on a uniform grid $x_j = j\\,\\Delta x$ and $t^n = n\\,\\Delta t$. The numerical scheme is the forward-in-time, first-order upwind-in-space method. The specific form of the scheme depends on the sign of the velocity $U$. The Courant number is defined as $C = \\frac{U\\,\\Delta t}{\\Delta x}$.\n\nTo perform a von Neumann stability analysis, we consider a single Fourier mode of the solution at a given time level $n$:\n$$\nh^n_j = \\hat{h}^n(k) e^{i k x_j} = \\hat{h}^n(k) e^{i k j \\Delta x}\n$$\nwhere $k$ is the wavenumber and $i$ is the imaginary unit. The numerical scheme propagates this mode in time according to:\n$$\nh^{n+1}_j = G(k) h^n_j\n$$\nwhere $G(k)$ is the amplification factor, which depends on the wavenumber $k$ and the discretization parameters. The scheme is stable in the L$^2$ sense if and only if the modulus of the amplification factor is less than or equal to one for all possible wavenumbers:\n$$\n|G(k)| \\le 1 \\quad \\forall k\n$$\n\nWe must analyze the two cases for the sign of $U$.\n\nCase 1: $U > 0$\nFor a positive velocity, the upwind direction is from $j-1$ to $j$. The discretization is given by:\n$$\nh^{n+1}_j = h^n_j - C\\left(h^n_j - h^n_{j-1}\\right)\n$$\nIn this case, since $U > 0$, the Courant number $C = \\frac{U\\,\\Delta t}{\\Delta x}$ is also positive.\nSubstituting the Fourier mode into the scheme gives:\n$$\nG(k) \\hat{h}^n(k) e^{i k j \\Delta x} = \\hat{h}^n(k) e^{i k j \\Delta x} - C \\left( \\hat{h}^n(k) e^{i k j \\Delta x} - \\hat{h}^n(k) e^{i k (j-1) \\Delta x} \\right)\n$$\nDividing by $\\hat{h}^n(k) e^{i k j \\Delta x}$ (which is non-zero) yields the amplification factor:\n$$\nG(k) = 1 - C \\left( 1 - e^{-i k \\Delta x} \\right)\n$$\nLet $\\theta = k \\Delta x$ be the dimensionless wavenumber. Then:\n$$\nG(\\theta) = 1 - C(1 - e^{-i\\theta}) = 1 - C(1 - (\\cos\\theta - i\\sin\\theta))\n$$\n$$\nG(\\theta) = (1 - C + C\\cos\\theta) + i(C\\sin\\theta)\n$$\nThe squared modulus of the amplification factor is:\n$$\n|G(\\theta)|^2 = (1 - C + C\\cos\\theta)^2 + (C\\sin\\theta)^2\n$$\n$$\n|G(\\theta)|^2 = (1-C)^2 + 2C(1-C)\\cos\\theta + C^2\\cos^2\\theta + C^2\\sin^2\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C + C^2 + 2C(1-C)\\cos\\theta + C^2 = 1 - 2C + 2C^2 + 2C(1-C)\\cos\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1-C) + 2C(1-C)\\cos\\theta = 1 - 2C(1-C)(1-\\cos\\theta)\n$$\nThe stability condition $|G(\\theta)|^2 \\le 1$ requires:\n$$\n-2C(1-C)(1-\\cos\\theta) \\le 0\n$$\nSince $1 - \\cos\\theta \\ge 0$ for all real $\\theta$, the inequality simplifies to:\n$$\nC(1-C) \\ge 0\n$$\nAs $U>0$, we have $C > 0$. Therefore, for the product to be non-negative, we must have $1-C \\ge 0$, which implies $C \\le 1$. The stability condition for $U>0$ is $0  C \\le 1$.\n\nCase 2: $U  0$\nFor a negative velocity, the upwind direction is from $j+1$ to $j$. The discretization is given by:\n$$\nh^{n+1}_j = h^n_j - C\\left(h^n_{j+1} - h^n_j\\right)\n$$\nIn this case, since $U  0$, the Courant number $C = \\frac{U\\,\\Delta t}{\\Delta x}$ is negative.\nSubstituting the Fourier mode into the scheme gives:\n$$\nG(k) \\hat{h}^n(k) e^{i k j \\Delta x} = \\hat{h}^n(k) e^{i k j \\Delta x} - C \\left( \\hat{h}^n(k) e^{i k (j+1) \\Delta x} - \\hat{h}^n(k) e^{i k j \\Delta x} \\right)\n$$\nDividing by $\\hat{h}^n(k) e^{i k j \\Delta x}$ yields the amplification factor:\n$$\nG(k) = 1 - C \\left( e^{i k \\Delta x} - 1 \\right)\n$$\nAgain, let $\\theta = k \\Delta x$:\n$$\nG(\\theta) = 1 - C(e^{i\\theta} - 1) = 1 - C((\\cos\\theta - 1) + i\\sin\\theta)\n$$\n$$\nG(\\theta) = (1 - C(\\cos\\theta - 1)) - i(C\\sin\\theta)\n$$\nThe squared modulus of the amplification factor is:\n$$\n|G(\\theta)|^2 = (1 + C - C\\cos\\theta)^2 + (-C\\sin\\theta)^2\n$$\n$$\n|G(\\theta)|^2 = (1+C)^2 - 2C(1+C)\\cos\\theta + C^2\\cos^2\\theta + C^2\\sin^2\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 + 2C + C^2 - 2C(1+C)\\cos\\theta + C^2 = 1 + 2C + 2C^2 - 2C(1+C)\\cos\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 + 2C(1+C) - 2C(1+C)\\cos\\theta = 1 + 2C(1+C)(1-\\cos\\theta)\n$$\nThe stability condition $|G(\\theta)|^2 \\le 1$ requires:\n$$\n2C(1+C)(1-\\cos\\theta) \\le 0\n$$\nSince $1 - \\cos\\theta \\ge 0$, the inequality simplifies to:\n$$\nC(1+C) \\le 0\n$$\nAs $U  0$, we have $C  0$. Therefore, for the product to be non-positive, we must have $1+C \\ge 0$, which implies $C \\ge -1$. The stability condition for $U  0$ is $-1 \\le C  0$.\n\nCombining both cases:\n- For $U > 0$, we have $0  C \\le 1$, which is $0  \\frac{U \\Delta t}{\\Delta x} \\le 1$. Since $U = |U|$, this is $\\frac{|U| \\Delta t}{\\Delta x} \\le 1$.\n- For $U  0$, we have $-1 \\le C  0$, which is $-1 \\le \\frac{U \\Delta t}{\\Delta x}  0$. Since $U = -|U|$, this is $-1 \\le \\frac{-|U| \\Delta t}{\\Delta x}  0$. Multiplying by $-1$ reverses the inequalities, yielding $1 \\ge \\frac{|U| \\Delta t}{\\Delta x} > 0$.\n\nBoth cases lead to the identical stability criterion, known as the Courant-Friedrichs-Lewy (CFL) condition for this scheme:\n$$\n\\frac{|U| \\Delta t}{\\Delta x} \\le 1\n$$\nThis condition guarantees that the L$^2$ norm of the numerical solution does not grow in time.\n\nTo find the largest allowable time step, $\\Delta t_{\\max}$, we take the equality in the stability condition:\n$$\n\\frac{|U| \\Delta t_{\\max}}{\\Delta x} = 1\n$$\nSolving for $\\Delta t_{\\max}$ yields:\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x}{|U|}\n$$\nThis expression assumes $U \\neq 0$, which is implicit in the context of an advection problem.",
            "answer": "$$\n\\boxed{\\frac{\\Delta x}{|U|}}\n$$"
        },
        {
            "introduction": "Once a stable numerical model is established, we can use it to explore deeper questions about the system's behavior, such as its predictability. In weather forecasting, not all initial errors are created equal; certain \"sensitive\" patterns can grow extremely rapidly, representing a fundamental limit to forecast skill. This advanced practice delves into singular vector analysis, a powerful technique used to identify the initial perturbations that experience the most significant growth over a finite time. By formulating and computationally solving a generalized eigenvalue problem, you will identify these optimal structures, gaining a hands-on introduction to the methods at the heart of modern ensemble forecasting. ",
            "id": "4103321",
            "problem": "Consider the one-dimensional, linearized Shallow Water Equations (SWE) on a periodic domain as a prototype for Numerical Weather Prediction (NWP) and climate modeling. Start from the fundamental conservation laws of mass and momentum for a shallow layer of fluid of constant mean depth, and derive the linearized system around a uniform mean zonal flow. Then, discretize the spatial derivatives on a uniform grid and formulate the propagator for the semi-discrete linear system. Use this to derive and compute optimal initial perturbations (singular vectors) that maximize final-time energy measured in a specified verification norm relative to the initial energy norm.\n\nFundamental base: assume a one-dimensional, periodic domain of length $L$ with a uniform grid of $N$ points, uniform mean depth $H$ (in meters), and uniform mean zonal flow $U$ (in meters per second). Let $g$ denote gravitational acceleration (in meters per second squared). Introduce small linear Rayleigh damping rates $r_u$ and $r_h$ (in per second) for velocity and height, respectively. The linearized SWE for perturbations $u(x,t)$ (zonal velocity, in meters per second) and $h(x,t)$ (free surface height anomaly, in meters) about the uniform mean flow are, in continuous space and time,\n$$\n\\frac{\\partial u}{\\partial t} = -U \\frac{\\partial u}{\\partial x} - g \\frac{\\partial h}{\\partial x} - r_u u, \\quad\n\\frac{\\partial h}{\\partial t} = -U \\frac{\\partial h}{\\partial x} - H \\frac{\\partial u}{\\partial x} - r_h h.\n$$\nDefine the energy density of the linearized SWE as\n$$\n\\mathcal{E}(x,t) = \\frac{1}{2} H \\, u(x,t)^2 + \\frac{1}{2} g \\, h(x,t)^2 \\quad \\text{(in joules per square meter)}.\n$$\nDiscretize the domain into $N$ equally spaced points with spacing $\\Delta x = L/N$ and periodic boundary conditions. Approximate spatial derivatives by the centered difference operator, yielding the semi-discrete system\n$$\n\\frac{d}{dt}\n\\begin{bmatrix}\n\\mathbf{u}(t) \\\\ \\mathbf{h}(t)\n\\end{bmatrix}\n= \\mathbf{L}\n\\begin{bmatrix}\n\\mathbf{u}(t) \\\\ \\mathbf{h}(t)\n\\end{bmatrix},\n$$\nwhere $\\mathbf{u}(t), \\mathbf{h}(t) \\in \\mathbb{R}^N$, and the $2N \\times 2N$ linear operator $\\mathbf{L}$ has block form\n$$\n\\mathbf{L} =\n\\begin{bmatrix}\n- U \\mathbf{D} - r_u \\mathbf{I}_N  - g \\mathbf{D} \\\\\n- H \\mathbf{D}  - U \\mathbf{D} - r_h \\mathbf{I}_N\n\\end{bmatrix},\n$$\nwith $\\mathbf{I}_N$ the $N \\times N$ identity and $\\mathbf{D}$ the $N \\times N$ periodic centered-difference matrix\n$$\n\\mathbf{D}_{i,j} = \\frac{1}{2 \\Delta x} \\left( \\delta_{j,(i+1) \\,\\mathrm{mod}\\, N} - \\delta_{j,(i-1) \\,\\mathrm{mod}\\, N} \\right).\n$$\nLet $\\mathbf{x}(t) = [\\mathbf{u}(t);\\mathbf{h}(t)] \\in \\mathbb{R}^{2N}$. The semi-discrete propagator for final time $T$ is the matrix exponential\n$$\n\\mathbf{A}(T) = e^{\\mathbf{L} T}, \\quad \\mathbf{x}(T) = \\mathbf{A}(T) \\mathbf{x}(0).\n$$\nDefine the initial energy norm and a localized verification energy norm via inner products with symmetric positive-definite weight matrices. The initial total energy norm is\n$$\n\\|\\mathbf{x}\\|_{i}^2 = \\mathbf{x}^\\top \\mathbf{W}_i \\mathbf{x}, \\quad\n\\mathbf{W}_i = \\begin{bmatrix} H \\Delta x \\, \\mathbf{I}_N  \\mathbf{0} \\\\ \\mathbf{0}  g \\Delta x \\, \\mathbf{I}_N \\end{bmatrix}.\n$$\nDefine a verification region by a center $x_c$ (in meters) and a half-width $w$ (in meters) on the periodic domain, and let $\\mathbf{M}$ be the diagonal $N \\times N$ mask with entries $M_{ii} = 1$ if the gridpoint $x_i$ lies within the region (by minimal periodic distance) and $M_{ii} = 0$ otherwise. Introduce a height-amplification factor $\\alpha  1$ to emphasize height anomalies at verification. The final-time verification norm is\n$$\n\\|\\mathbf{x}\\|_{f}^2 = \\mathbf{x}^\\top \\mathbf{W}_f \\mathbf{x}, \\quad\n\\mathbf{W}_f = \\begin{bmatrix} H \\Delta x \\, \\mathbf{M}  \\mathbf{0} \\\\ \\mathbf{0}  \\alpha g \\Delta x \\, \\mathbf{M} \\end{bmatrix}.\n$$\nThe optimal growth ratio for an initial perturbation $\\mathbf{x}_0$ is defined by\n$$\nJ(\\mathbf{x}_0) = \\frac{\\|\\mathbf{x}(T)\\|_{f}^2}{\\|\\mathbf{x}_0\\|_{i}^2}\n= \\frac{\\mathbf{x}_0^\\top \\mathbf{A}(T)^\\top \\mathbf{W}_f \\mathbf{A}(T) \\mathbf{x}_0}{\\mathbf{x}_0^\\top \\mathbf{W}_i \\mathbf{x}_0}.\n$$\nShow that maximizing $J(\\mathbf{x}_0)$ over nonzero $\\mathbf{x}_0$ reduces to the generalized symmetric eigenvalue problem\n$$\n\\left( \\mathbf{A}(T)^\\top \\mathbf{W}_f \\mathbf{A}(T) \\right) \\mathbf{v} = \\lambda \\, \\mathbf{W}_i \\mathbf{v},\n$$\nand that the largest eigenvalue $\\lambda_{\\max}$ is the maximal growth ratio, with the corresponding eigenvector $\\mathbf{v}$ an optimal initial perturbation (singular vector) in the initial energy norm. Explain how the spatial structure of $\\mathbf{v}$ identifies sensitive structures that the flow dynamically maps into the verification region with large height anomalies at time $T$.\n\nImplement a program that:\n- Builds $\\mathbf{D}$, $\\mathbf{L}$, and computes $\\mathbf{A}(T)$ via the matrix exponential.\n- Constructs $\\mathbf{W}_i$ and $\\mathbf{W}_f$ for the given parameters and region.\n- Solves the generalized eigenvalue problem for the pair $\\left( \\mathbf{A}(T)^\\top \\mathbf{W}_f \\mathbf{A}(T), \\mathbf{W}_i \\right)$ and returns the largest real eigenvalue as the optimal growth ratio.\n\nAll physical quantities must be handled in International System of Units (SI): distances in meters (m), time in seconds (s), and acceleration in meters per second squared (m/s^2). The final outputs are dimensionless ratios. Angles do not appear in this problem and are not required. The program must compute results for the following test suite, each specified by the tuple $(N, L, H, g, U, T, r_u, r_h, \\alpha, x_c, w)$:\n\n1. General case focusing height anomalies with modest advection and small damping: $(64, 1.0\\times 10^6, 1000.0, 9.81, 20.0, 10000.0, 1.0\\times 10^{-5}, 1.5\\times 10^{-5}, 3.0, 4.0\\times 10^5, 1.5\\times 10^5)$.\n2. Near-zero forecast horizon without damping to test the limiting behavior: $(64, 1.0\\times 10^6, 1000.0, 9.81, 0.0, 1.0, 0.0, 0.0, 2.0, 2.0\\times 10^5, 1.0\\times 10^5)$.\n3. Longer horizon with stronger damping and larger domain: $(64, 2.0\\times 10^6, 800.0, 9.81, 30.0, 20000.0, 5.0\\times 10^{-5}, 5.0\\times 10^{-5}, 4.0, 1.2\\times 10^6, 2.0\\times 10^5)$.\n4. Opposite advection direction with smaller domain and moderate damping: $(32, 5.0\\times 10^5, 500.0, 9.81, -10.0, 5000.0, 1.0\\times 10^{-5}, 2.0\\times 10^{-5}, 3.0, 3.0\\times 10^5, 1.0\\times 10^5)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), where each result is the largest generalized eigenvalue $\\lambda_{\\max}$ for the corresponding test case. The outputs must be dimensionless floats.",
            "solution": "The problem presented is a valid and well-posed exercise in the field of geophysical fluid dynamics and numerical analysis, specifically pertaining to the study of predictability and error growth in simplified models of atmospheric and oceanic flows. It is scientifically grounded in the established theory of the shallow water equations and singular value analysis, and all necessary parameters and definitions are provided for a unique solution. We shall therefore proceed with the derivation and construction of the solution.\n\nThe primary objective is to determine the initial perturbation, represented by the state vector $\\mathbf{x}_0 = [\\mathbf{u}(0); \\mathbf{h}(0)]$, that exhibits the maximum possible amplification in a specified energy norm by a final time $T$. This amplification is quantified by the ratio $J(\\mathbf{x}_0)$:\n$$\nJ(\\mathbf{x}_0) = \\frac{\\|\\mathbf{x}(T)\\|_{f}^2}{\\|\\mathbf{x}_0\\|_{i}^2}\n$$\nwhere $\\|\\cdot\\|_{i}^2$ is the total energy norm at the initial time $t=0$ and $\\|\\cdot\\|_{f}^2$ is a targeted, localized energy norm at the final time $t=T$.\n\nThe evolution of the state vector from the initial time to the final time is governed by the linear propagator $\\mathbf{A}(T) = e^{\\mathbf{L} T}$, such that $\\mathbf{x}(T) = \\mathbf{A}(T) \\mathbf{x}(0)$. Substituting this relationship and the definitions of the norms, which are quadratic forms defined by the weight matrices $\\mathbf{W}_i$ and $\\mathbf{W}_f$, into the expression for $J$, we obtain:\n$$\nJ(\\mathbf{x}_0) = \\frac{(\\mathbf{A}(T)\\mathbf{x}_0)^\\top \\mathbf{W}_f (\\mathbf{A}(T)\\mathbf{x}_0)}{\\mathbf{x}_0^\\top \\mathbf{W}_i \\mathbf{x}_0} = \\frac{\\mathbf{x}_0^\\top \\mathbf{A}(T)^\\top \\mathbf{W}_f \\mathbf{A}(T) \\mathbf{x}_0}{\\mathbf{x}_0^\\top \\mathbf{W}_i \\mathbf{x}_0}\n$$\nThis expression is a Rayleigh quotient for the matrices $\\mathbf{B} = \\mathbf{A}(T)^\\top \\mathbf{W}_f \\mathbf{A}(T)$ and $\\mathbf{W}_i$. The fundamental theorem of Rayleigh quotients states that the maximum value of this ratio is equal to the largest eigenvalue, $\\lambda_{\\max}$, of the generalized eigenvalue problem:\n$$\n\\mathbf{B} \\mathbf{v} = \\lambda \\mathbf{W}_i \\mathbf{v} \\quad \\text{or} \\quad \\left( \\mathbf{A}(T)^\\top \\mathbf{W}_f \\mathbf{A}(T) \\right) \\mathbf{v} = \\lambda \\mathbf{W}_i \\mathbf{v}\n$$\nThe eigenvector $\\mathbf{v}$ corresponding to this largest eigenvalue $\\lambda_{\\max}$ is the optimal initial perturbation, also known as the leading singular vector, that maximizes the energy growth $J$. The spatial structure of this eigenvector $\\mathbf{v}$ reveals the precise initial configuration of velocity and height perturbations that the system's dynamics will most efficiently organize and amplify into a large-energy structure within the specified verification region at time $T$. The emphasis on height anomalies in the final norm, via the factor $\\alpha$, means the optimal structures will be those that the dynamics efficiently convert into significant height disturbances.\n\nThe computational procedure to find $\\lambda_{\\max}$ involves the following steps, implemented in the provided Python code:\n1.  **Define Grid and Parameters**: For a given set of parameters $(N, L, H, g, U, T, r_u, r_h, \\alpha, x_c, w)$, establish the grid spacing $\\Delta x = L/N$ and the grid points $x_i = i \\Delta x$ for $i \\in \\{0, 1, \\dots, N-1\\}$.\n\n2.  **Construct Matrices**:\n    a.  The $N \\times N$ centered-difference operator $\\mathbf{D}$ for periodic boundary conditions is constructed.\n    b.  The $2N \\times 2N$ linear dynamics operator $\\mathbf{L}$ is assembled in block form.\n    c.  The diagonal initial energy weight matrix $\\mathbf{W}_i$ is formed.\n    d.  The final energy weight matrix $\\mathbf{W}_f$ is constructed using a mask $\\mathbf{M}$ that isolates the verification region.\n\n3.  **Compute the Propagator**: The propagator matrix $\\mathbf{A}(T)$ is computed as the matrix exponential of $\\mathbf{L} T$.\n\n4.  **Solve the Generalized Eigenvalue Problem**:\n    a.  Form the symmetric, positive semi-definite matrix $\\mathbf{B} = \\mathbf{A}(T)^\\top \\mathbf{W}_f \\mathbf{A}(T)$.\n    b.  Solve the generalized symmetric eigenvalue problem $\\mathbf{B} \\mathbf{v} = \\lambda \\mathbf{W}_i \\mathbf{v}$ for its eigenvalues $\\lambda$.\n    c.  The solution is the largest of these real eigenvalues, $\\lambda_{\\max}$.\n\nThis algorithm is implemented for each test case as follows:\n```python\nimport numpy as np\nfrom scipy.linalg import expm, eigh\n\ndef compute_optimal_growth(N, L, H, g, U, T, r_u, r_h, alpha, xc, w):\n    \"\"\"\n    Computes the optimal growth ratio for the linearized shallow water equations.\n    \"\"\"\n    # Step 1: Define Grid and Parameters\n    dx = L / N\n    grid_points = np.arange(N) * dx\n\n    # Step 2a: Construct the centered-difference operator D\n    I_N = np.eye(N)\n    D_op = (np.roll(I_N, -1, axis=1) - np.roll(I_N, 1, axis=1)) / (2 * dx)\n\n    # Step 2b: Construct the linear dynamics operator L\n    I_N_full = np.eye(N)\n    L_op = np.block([\n        [-U * D_op - r_u * I_N_full, -g * D_op],\n        [-H * D_op, -U * D_op - r_h * I_N_full]\n    ])\n\n    # Step 3: Compute the propagator A(T)\n    A_prop = expm(L_op * T)\n\n    # Step 2c: Construct the initial energy weight matrix W_i\n    W_i_u_diag = H * dx * np.ones(N)\n    W_i_h_diag = g * dx * np.ones(N)\n    W_i = np.diag(np.concatenate([W_i_u_diag, W_i_h_diag]))\n\n    # Step 2d: Construct the final energy weight matrix W_f\n    dist = np.abs(grid_points - xc)\n    periodic_dist = np.minimum(dist, L - dist)\n    mask_diag = (periodic_dist = w).astype(float)\n    \n    W_f_u_diag = H * dx * mask_diag\n    W_f_h_diag = alpha * g * dx * mask_diag\n    W_f = np.diag(np.concatenate([W_f_u_diag, W_f_h_diag]))\n\n    # Step 4a: Form the matrix B for the generalized eigenvalue problem\n    B_matrix = A_prop.T @ W_f @ A_prop\n\n    # Step 4b: Solve the generalized eigenvalue problem Bv = lambda * Wi * v\n    eigenvalues = eigh(B_matrix, b=W_i, eigvals_only=True)\n\n    # Step 4c: The result is the largest eigenvalue\n    lambda_max = eigenvalues[-1]\n\n    return lambda_max\n```",
            "answer": "[4.84650529,1.99999999,3.61917757,2.83151859]"
        }
    ]
}