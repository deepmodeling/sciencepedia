{
    "hands_on_practices": [
        {
            "introduction": "Internal gravity waves can only propagate in a fluid that is stably stratified, meaning that a vertically displaced fluid parcel will oscillate around its equilibrium level. The fundamental frequency of this oscillation, known as the Brunt–Väisälä frequency $N$, quantifies the atmosphere's static stability and sets the upper frequency limit for vertically propagating internal waves. This exercise grounds the abstract concept of wave propagation in fundamental atmospheric thermodynamics, challenging you to derive and calculate $N$ from a realistic temperature profile and explore the direct implications for wave dynamics .",
            "id": "4054699",
            "problem": "A dry, hydrostatic, compressible atmosphere on a rotating planet is modeled as an ideal gas with constant gravitational acceleration $g$, constant specific heat at constant pressure $c_p$, and constant gas constant for dry air $R_d$. The potential temperature $\\theta$ is defined by $\\theta = T \\left( \\frac{p_0}{p} \\right)^{\\kappa}$, where $\\kappa = \\frac{R_d}{c_p}$, $T$ is absolute temperature, $p$ is pressure, and $p_0$ is a fixed reference pressure. The Brunt–Väisälä frequency (also called buoyancy frequency) $N$ is defined by $N^2 = \\frac{g}{\\theta} \\frac{d\\theta}{dz}$. Assume hydrostatic balance $\\frac{dp}{dz} = -\\rho g$ and the ideal gas law $p = \\rho R_d T$. Consider a vertically varying temperature profile $T(z) = T_0 - \\Gamma z$ with $T_0 = 290\\,\\mathrm{K}$ and $\\Gamma = 6.5\\,\\mathrm{K\\,km^{-1}}$. At altitude $z = 5\\,\\mathrm{km}$, evaluate $N$ under the additional assumption that over a thin layer about this level the pressure scale height $H$ can be treated as constant and equal to its local value. Use $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $R_d = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$, and $c_p = 1004\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$.\n\nTasks:\n- Starting only from the given definitions and balances, derive an expression for $N$ at $z = 5\\,\\mathrm{km}$ in terms of $g$, $T$, $\\Gamma$, and $c_p$, making explicit where the constant pressure scale height assumption enters.\n- Compute the numerical value of $N$ at $z = 5\\,\\mathrm{km}$ for the given profile and constants. Express the final answer in $\\mathrm{s^{-1}}$ and round to four significant figures.\n- Briefly state, based on the computed $N$, what the result implies for the ability of internal gravity waves to propagate vertically in this environment, in relation to their intrinsic frequency.\n\nYour final numeric answer must be only the value of $N$ as specified above.",
            "solution": "The problem statement is evaluated to be scientifically grounded, well-posed, objective, and internally consistent. It is based on fundamental principles of atmospheric thermodynamics and dynamics, with all necessary data and definitions provided for a unique solution. The problem is therefore deemed **valid**.\n\nThe derivation and calculation will proceed as requested.\n\nThe Brunt–Väisälä frequency, $N$, is defined by the relation:\n$$N^2 = \\frac{g}{\\theta} \\frac{d\\theta}{dz}$$\nwhere $g$ is the acceleration due to gravity, $z$ is the vertical coordinate, and $\\theta$ is the potential temperature. The potential temperature $\\theta$ is given by:\n$$\\theta = T \\left( \\frac{p_0}{p} \\right)^{\\kappa}$$\nHere, $T$ is the absolute temperature, $p$ is the pressure, $p_0$ is a constant reference pressure, and $\\kappa = \\frac{R_d}{c_p}$, where $R_d$ is the specific gas constant for dry air and $c_p$ is the specific heat at constant pressure.\n\nTo find an expression for $N^2$, we must first evaluate the term $\\frac{1}{\\theta}\\frac{d\\theta}{dz}$. This is most conveniently done by first taking the natural logarithm of the expression for $\\theta$:\n$$\\ln(\\theta) = \\ln(T) + \\kappa \\ln(p_0) - \\kappa \\ln(p)$$\nDifferentiating with respect to $z$ yields:\n$$\\frac{1}{\\theta}\\frac{d\\theta}{dz} = \\frac{1}{T}\\frac{dT}{dz} - \\frac{\\kappa}{p}\\frac{dp}{dz}$$\nThis expression relates the vertical gradient of potential temperature to the vertical gradients of temperature and pressure.\n\nNext, we use the provided physical laws to substitute for the pressure gradient, $\\frac{dp}{dz}$. The atmosphere is assumed to be in hydrostatic balance:\n$$\\frac{dp}{dz} = -\\rho g$$\nwhere $\\rho$ is the density. The atmosphere is also modeled as an ideal gas:\n$$p = \\rho R_d T$$\nSolving the ideal gas law for density gives $\\rho = \\frac{p}{R_d T}$. Substituting this into the hydrostatic balance equation gives:\n$$\\frac{dp}{dz} = -\\frac{p g}{R_d T}$$\nThis equation can be rearranged to define the pressure scale height, $H$:\n$$\\frac{1}{p}\\frac{dp}{dz} = -\\frac{g}{R_d T} = -\\frac{1}{H(z)}$$\nwhere $H(z) = \\frac{R_d T(z)}{g}$. The pressure scale height $H(z)$ is generally a function of altitude because temperature $T$ is.\n\nThe problem asks to make explicit where the assumption of a locally constant scale height enters. This assumption allows us to treat the relationship $\\frac{1}{p}\\frac{dp}{dz} = -\\frac{1}{H}$ as being evaluated with a constant $H$ value, that of the specific altitude of interest ($z = 5\\,\\mathrm{km}$). Substituting this relation for the pressure gradient into our expression for the potential temperature gradient gives:\n$$\\frac{1}{\\theta}\\frac{d\\theta}{dz} = \\frac{1}{T}\\frac{dT}{dz} - \\kappa \\left(-\\frac{1}{H}\\right) = \\frac{1}{T}\\frac{dT}{dz} + \\frac{\\kappa}{H}$$\nThis step explicitly uses the local scale height $H$ to describe the local pressure variation, embodying the requested assumption.\n\nNow, we substitute this back into the definition for $N^2$:\n$$N^2 = g \\left( \\frac{1}{\\theta}\\frac{d\\theta}{dz} \\right) = g \\left( \\frac{1}{T}\\frac{dT}{dz} + \\frac{\\kappa}{H} \\right)$$\nTo obtain the expression in the desired terms ($g$, $T$, $\\Gamma$, and $c_p$), we substitute the definitions of $\\kappa$ and $H$:\n$$N^2 = g \\left( \\frac{1}{T}\\frac{dT}{dz} + \\frac{R_d/c_p}{R_d T / g} \\right) = g \\left( \\frac{1}{T}\\frac{dT}{dz} + \\frac{g}{c_p T} \\right)$$\nFactoring out $\\frac{1}{T}$:\n$$N^2 = \\frac{g}{T} \\left( \\frac{dT}{dz} + \\frac{g}{c_p} \\right)$$\nThe temperature profile is given as $T(z) = T_0 - \\Gamma z$. The environmental temperature lapse rate is therefore $\\frac{dT}{dz} = -\\Gamma$. Substituting this into the equation gives the final derived expression:\n$$N^2 = \\frac{g}{T(z)} \\left( \\frac{g}{c_p} - \\Gamma \\right)$$\nThis expression relates $N^2$ to the temperature $T$ at altitude $z$, the gravitational acceleration $g$, the specific heat $c_p$, and the environmental lapse rate $\\Gamma$. The term $\\frac{g}{c_p}$ is recognized as the dry adiabatic lapse rate, $\\Gamma_d$.\n\nNext, we compute the numerical value of $N$ at $z = 5\\,\\mathrm{km}$.\nThe given constants are:\n-   $g = 9.81\\,\\mathrm{m\\,s^{-2}}$\n-   $c_p = 1004\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n-   $T_0 = 290\\,\\mathrm{K}$\n-   $\\Gamma = 6.5\\,\\mathrm{K\\,km^{-1}} = 0.0065\\,\\mathrm{K\\,m^{-1}}$\n-   $z = 5\\,\\mathrm{km} = 5000\\,\\mathrm{m}$\n\nFirst, we calculate the temperature at $z = 5\\,\\mathrm{km}$:\n$$T(5000\\,\\mathrm{m}) = T_0 - \\Gamma z = 290\\,\\mathrm{K} - (0.0065\\,\\mathrm{K\\,m^{-1}})(5000\\,\\mathrm{m}) = 290\\,\\mathrm{K} - 32.5\\,\\mathrm{K} = 257.5\\,\\mathrm{K}$$\nNext, we calculate the dry adiabatic lapse rate, $\\Gamma_d$:\n$$\\Gamma_d = \\frac{g}{c_p} = \\frac{9.81\\,\\mathrm{m\\,s^{-2}}}{1004\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}} \\approx 0.0097709\\,\\mathrm{K\\,m^{-1}}$$\nNow, we can compute $N^2$:\n$$N^2 = \\frac{9.81\\,\\mathrm{m\\,s^{-2}}}{257.5\\,\\mathrm{K}} \\left( 0.0097709\\,\\mathrm{K\\,m^{-1}} - 0.0065\\,\\mathrm{K\\,m^{-1}} \\right)$$\n$$N^2 = \\frac{9.81}{257.5} (0.0032709)\\,\\mathrm{s^{-2}} \\approx (0.038097)(0.0032709)\\,\\mathrm{s^{-2}} \\approx 0.00012461\\,\\mathrm{s^{-2}}$$\nFinally, we take the square root to find $N$:\n$$N = \\sqrt{0.00012461\\,\\mathrm{s^{-2}}} \\approx 0.0111630\\,\\mathrm{s^{-1}}$$\nRounding to four significant figures, we get $N = 0.01116\\,\\mathrm{s^{-1}}$.\n\nRegarding the implication for internal gravity wave propagation:\nThe result $N^2  0$ indicates that the atmosphere is statically stable at this altitude, which is a necessary condition for internal gravity waves to exist. The Brunt–Väisälä frequency $N$ represents the high-frequency limit for vertically propagating internal gravity waves. For a wave with intrinsic frequency $\\omega$, the condition for vertical propagation is $f  \\omega  N$, where $f$ is the Coriolis frequency (for inertia-gravity waves) or $0  \\omega  N$ if rotation is neglected. Therefore, the calculated value $N \\approx 0.01116\\,\\mathrm{s^{-1}}$ implies that only internal gravity waves with an intrinsic frequency lower than this value can propagate vertically. Waves with frequencies $\\omega  N$ are evanescent; they cannot propagate vertically and their energy is confined to a layer near their source. This frequency corresponds to a minimum buoyancy period of $T_{min} = 2\\pi/N \\approx 563\\,\\mathrm{s}$ (about $9.4$ minutes), meaning waves with shorter periods cannot propagate vertically.",
            "answer": "$$\\boxed{0.01116}$$"
        },
        {
            "introduction": "Once we establish that an atmospheric layer is stable enough to support waves, we must understand their intrinsic properties. The behavior of any wave is fully captured by its dispersion relation, which connects its frequency $\\omega$ to its spatial properties, defined by the wavenumber vector $\\mathbf{k}$. This essential theoretical practice guides you through the derivation of the complete dispersion relation for inertia-gravity waves from the linearized governing equations, providing deep insight into how buoyancy (via $N$) and rotation (via the Coriolis parameter $f$) act as restoring forces to govern wave propagation .",
            "id": "4054689",
            "problem": "Consider a stably stratified, inviscid, rotating Boussinesq fluid on an $f$-plane representative of a midlatitude atmospheric column used in numerical weather prediction and climate modeling. The background has constant reference density $\\rho_{0}$ and constant buoyancy frequency $N$. Let $(u,v,w)$ be the perturbation velocity components, $p$ the perturbation pressure, and $b$ the buoyancy. The linearized equations are the momentum equations\n$$\\frac{\\partial u}{\\partial t} - f\\,v = -\\frac{1}{\\rho_{0}}\\,\\frac{\\partial p}{\\partial x}, \\qquad \\frac{\\partial v}{\\partial t} + f\\,u = -\\frac{1}{\\rho_{0}}\\,\\frac{\\partial p}{\\partial y}, \\qquad \\frac{\\partial w}{\\partial t} = -\\frac{1}{\\rho_{0}}\\,\\frac{\\partial p}{\\partial z} + b,$$\nthe buoyancy equation\n$$\\frac{\\partial b}{\\partial t} + N^{2}\\,w = 0,$$\nand the continuity equation\n$$\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0.$$\nAssume plane-wave solutions of the form $\\exp\\!\\big(i(k x + l y + m z - \\omega t)\\big)$ with real horizontal wavenumbers $k$ and $l$, vertical wavenumber $m$, and angular frequency $\\omega$. Define the horizontal wavenumber magnitude $k_{h} \\equiv \\sqrt{k^{2} + l^{2}}$. Starting from the above equations, derive the dispersion relation for inertia-gravity waves that links $\\omega$ to $(k_{h}, m)$ for fixed $N$ and $f$, and use it to analyze how $\\omega$ varies with $m$ when $k_{h}$ is held constant. Then determine the hydrostatic limit of $\\omega$ by taking $m^{2} \\gg k_{h}^{2}$ and simplifying the dispersion relation accordingly. Express the final angular-frequency expressions in radians per second. Your final answer must be a single closed-form expression or a pair of closed-form expressions. If you provide two expressions (the full dispersion relation and its hydrostatic-limit form), write them together as a row matrix. No numerical evaluation or rounding is required.",
            "solution": "We begin with the linearized rotating Boussinesq system on an $f$-plane, with constant buoyancy frequency $N$. Under the plane-wave ansatz $\\exp\\!\\big(i(k x + l y + m z - \\omega t)\\big)$, all spatial derivatives act as multiplication by $i$ times the corresponding wavenumber, and the time derivative acts as multiplication by $-i \\omega$. For algebraic convenience, define $\\phi \\equiv p/\\rho_{0}$. The transformed equations become\n$$-i \\omega\\,u - f\\,v = -i k\\,\\phi, \\qquad -i \\omega\\,v + f\\,u = -i l\\,\\phi,$$\n$$-i \\omega\\,w = -i m\\,\\phi + b,$$\n$$-i \\omega\\,b + N^{2}\\,w = 0,$$\n$$i k\\,u + i l\\,v + i m\\,w = 0.$$\nFrom the buoyancy equation, we solve for $b$ in terms of $w$:\n$$-i \\omega\\,b + N^{2}\\,w = 0 \\quad \\Longrightarrow \\quad b = \\frac{N^{2}}{i \\omega}\\,w = -i\\,\\frac{N^{2}}{\\omega}\\,w.$$\nSubstitute $b$ into the vertical momentum equation to eliminate $b$:\n$$-i \\omega\\,w = -i m\\,\\phi - i\\,\\frac{N^{2}}{\\omega}\\,w.$$\nMultiply both sides by $i$ to obtain a real-algebraic relation,\n$$\\omega\\,w = m\\,\\phi + \\frac{N^{2}}{\\omega}\\,w,$$\nand rearrange to express $\\phi$ in terms of $w$:\n$$m\\,\\phi = \\frac{\\omega^{2} - N^{2}}{\\omega}\\,w \\quad \\Longrightarrow \\quad \\phi = \\frac{\\omega^{2} - N^{2}}{\\omega\\,m}\\,w.$$\nNext, use the horizontal momentum equations to relate the horizontal flow to the pressure field, and then employ continuity to connect horizontal and vertical motions. The horizontal momentum system can be written in matrix form\n$$\\begin{pmatrix} -i \\omega  -f \\\\ f  -i \\omega \\end{pmatrix} \\begin{pmatrix} u \\\\ v \\end{pmatrix} = -i \\begin{pmatrix} k \\\\ l \\end{pmatrix} \\phi.$$\nInvert the $2 \\times 2$ matrix. Its determinant is $(-i \\omega)^{2} + f^{2} = -\\omega^{2} + f^{2}$. The inverse is\n$$\\frac{1}{-\\omega^{2} + f^{2}} \\begin{pmatrix} -i \\omega  f \\\\ -f  -i \\omega \\end{pmatrix}.$$\nMultiply to obtain $u$ and $v$,\n$$u = \\frac{(-i \\omega)(-i k \\phi) + f(-i l \\phi)}{-\\omega^{2} + f^{2}} = \\frac{-\\omega\\,k\\,\\phi - i f\\,l\\,\\phi}{-\\omega^{2} + f^{2}},$$\n$$v = \\frac{-f(-i k \\phi) + (-i \\omega)(-i l \\phi)}{-\\omega^{2} + f^{2}} = \\frac{i f\\,k\\,\\phi - \\omega\\,l\\,\\phi}{-\\omega^{2} + f^{2}}.$$\nForm the continuity combination $k u + l v$, which simplifies due to cancellation of the imaginary cross terms:\n$$k u + l v = \\frac{-\\omega (k^{2} + l^{2}) \\phi}{-\\omega^{2} + f^{2}} = \\frac{\\omega\\,k_{h}^{2}\\,\\phi}{\\omega^{2} - f^{2}}.$$\nContinuity requires $k u + l v + m w = 0$, hence\n$$k u + l v = -m\\,w.$$\nCombine the last two results to relate $\\phi$ and $w$ through $k_{h}$ and $m$:\n$$-m\\,w = \\frac{\\omega\\,k_{h}^{2}\\,\\phi}{\\omega^{2} - f^{2}} \\quad \\Longrightarrow \\quad \\phi = -\\frac{(\\omega^{2} - f^{2})\\,m}{\\omega\\,k_{h}^{2}}\\,w.$$\nWe now have two expressions for $\\phi$ in terms of $w$, namely\n$$\\phi = \\frac{\\omega^{2} - N^{2}}{\\omega\\,m}\\,w, \\qquad \\phi = -\\frac{(\\omega^{2} - f^{2})\\,m}{\\omega\\,k_{h}^{2}}\\,w.$$\nEquate them and cancel the common factors $\\omega$ and $w$:\n$$\\frac{\\omega^{2} - N^{2}}{m} = -\\frac{(\\omega^{2} - f^{2})\\,m}{k_{h}^{2}}.$$\nMultiply through by $m\\,k_{h}^{2}$ to obtain an algebraic relation in $\\omega^{2}$,\n$$(\\omega^{2} - N^{2})\\,k_{h}^{2} + (\\omega^{2} - f^{2})\\,m^{2} = 0.$$\nGroup terms in $\\omega^{2}$ and solve for $\\omega^{2}$,\n$$\\omega^{2}\\,(k_{h}^{2} + m^{2}) - \\big(N^{2}\\,k_{h}^{2} + f^{2}\\,m^{2}\\big) = 0 \\quad \\Longrightarrow \\quad \\omega^{2} = \\frac{N^{2}\\,k_{h}^{2} + f^{2}\\,m^{2}}{k_{h}^{2} + m^{2}}.$$\nThus, the full inertia-gravity wave dispersion relation is\n$$\\omega(k_{h},m) = \\sqrt{\\frac{N^{2}\\,k_{h}^{2} + f^{2}\\,m^{2}}{k_{h}^{2} + m^{2}}}.$$\nTo analyze the variation of $\\omega$ with $m$ for fixed $k_{h}$, rewrite\n$$\\omega^{2} = f^{2} + \\frac{(N^{2} - f^{2})\\,k_{h}^{2}}{k_{h}^{2} + m^{2}}.$$\nFor fixed $N$, $f$, and $k_{h}$, the second term decreases monotonically with increasing $m^{2}$, so $\\omega$ decreases as $m$ increases. The limiting values are $\\omega \\to N$ as $m \\to 0$ and $\\omega \\to f$ as $m \\to \\infty$. In the hydrostatic limit $m^{2} \\gg k_{h}^{2}$, the denominator $k_{h}^{2} + m^{2}$ can be approximated by $m^{2}$, yielding\n$$\\omega^{2} \\approx \\frac{N^{2}\\,k_{h}^{2} + f^{2}\\,m^{2}}{m^{2}} = f^{2} + N^{2}\\,\\frac{k_{h}^{2}}{m^{2}},$$\nand thus\n$$\\omega_{\\text{hyd}}(k_{h},m) \\approx \\sqrt{f^{2} + N^{2}\\,\\frac{k_{h}^{2}}{m^{2}}}.$$\nBoth expressions are angular frequencies and are to be interpreted in radians per second.",
            "answer": "$$\\boxed{\\begin{pmatrix}\\sqrt{\\dfrac{N^{2}\\,k_{h}^{2} + f^{2}\\,m^{2}}{k_{h}^{2} + m^{2}}}  \\sqrt{f^{2} + N^{2}\\,\\dfrac{k_{h}^{2}}{m^{2}}}\\end{pmatrix}}$$"
        },
        {
            "introduction": "In numerical weather and climate models, the true significance of internal waves lies in their role as carriers of momentum and energy from the lower to the upper atmosphere. As waves propagate vertically into less dense air, their amplitudes grow until they become unstable and break, a process called saturation, which deposits their momentum and alters the large-scale circulation. This capstone computational exercise bridges theory with practical application by tasking you with building a simplified model of a gravity wave drag parameterization, simulating the entire life cycle of a wave from propagation and saturation to momentum deposition—a critical sub-grid scale process in modern atmospheric models .",
            "id": "4054710",
            "problem": "Consider a vertically varying, hydrostatic, stably stratified atmosphere and the vertical propagation of internal gravity waves relevant to numerical weather prediction and climate modeling. Starting from first principles, derive a computational model that begins with a specified discrete source spectrum of waves described in terms of horizontal wavenumber and vertical wavenumber at a source level, and integrates the vertical propagation using Wentzel–Kramers–Brillouin (WKB) theory until saturation. Then compute the resulting profile of vertical deposition of horizontal momentum flux due to wave breaking.\n\nAssumptions and setup:\n- Use the linearized Boussinesq equations in two spatial dimensions for a compressible base state with slowly varying reference density, and neglect Coriolis effects for simplicity.\n- Assume a horizontally homogeneous background with constant Brunt–Väisälä frequency $N$ and an anelastic reference density profile $\\rho(z) = \\rho_{\\mathrm{ref}} \\exp(-z/H)$, where $\\rho_{\\mathrm{ref}}$ is the reference density at $z=0$ and $H$ is the density scale height.\n- Consider plane waves of the form $\\exp(i(k_h x + m z - \\omega t))$, where $k_h$ is the horizontal wavenumber, $m$ is the vertical wavenumber, and $\\omega$ is the intrinsic frequency as determined by the linear dispersion relation and the given $N$, $k_h$, and $m$.\n\nFundamental bases that must be used:\n- The linearized Boussinesq momentum, buoyancy, and continuity equations.\n- The plane-wave ansatz and the resulting dispersion relation linking $\\omega$, $N$, $k_h$, and $m$ for internal gravity waves.\n- Polarization relations between horizontal and vertical velocity perturbations for internal gravity waves.\n- Wave action conservation and WKB amplitude scaling in a slowly varying medium without dissipation.\n- A physically based saturation criterion for overturning defined by the vertical displacement amplitude $\\xi$ satisfying $m |\\xi| = 1$, which corresponds to the convective instability threshold.\n\nComputational modeling requirements:\n1. From the linearized Boussinesq equations and the plane-wave ansatz, derive the internal gravity wave dispersion relation that links $\\omega$, $N$, $k_h$, and $m$ in the non-rotating limit, and the polarization relation connecting horizontal and vertical velocity amplitudes.\n2. Derive an expression for the time-mean vertical flux of horizontal momentum (i.e., the stress) in terms of the background density, $k_h$, $m$, and the amplitude of vertical velocity perturbations at the source level $z_0$. This stress must be conserved with height in the absence of dissipation under WKB propagation with constant $N$.\n3. Using wave action conservation under Wentzel–Kramers–Brillouin (WKB) theory, derive how the vertical velocity amplitude $|w|(z)$ scales with the background density $\\rho(z)$ for upward propagation. Express the vertical displacement amplitude $|\\xi|(z)$ in terms of $|w|(z)$ and $\\omega$.\n4. Implement a saturation criterion: determine the saturation height $z_s$ at which $m |\\xi|(z_s) = 1$ is first met when propagating upward from $z_0$. If the criterion is already met at $z_0$, set $z_s = z_0$. If it is never met within the modeled domain, then there is no deposition in that domain.\n5. Compute the vertical deposition profile of the horizontal momentum flux by depositing the conserved wave stress at the saturation height. For numerical output, approximate the deposition as a piecewise-constant profile over altitude bins: each bin receives the wave stress divided by the bin thickness if the saturation height falls within that bin. If saturation occurs below the first bin, deposit into the first bin. If saturation occurs above the last bin, deposit nothing within the domain.\n6. The model must aggregate contributions over a discrete source spectrum $S$ composed of components with $(k_h, m)$ and source-level vertical velocity amplitude $|w|$ at $z_0$. For each component, compute its frequency $\\omega$, the conserved stress at $z_0$, and its saturation height, and then accumulate its deposition into the corresponding altitude bin.\n\nUnits and output specifications:\n- Express the final deposition values in units of Newton per cubic meter (N/m^3). Use radians for any angles, if applicable; however, angles are not explicitly involved in this problem.\n- Your program must output the deposition profiles for the specified test suite as a single line containing a comma-separated list enclosed in square brackets. Each element of the list corresponds to one test case and must itself be a list of floats representing the deposition per altitude bin in N/m^3. For example: \"[[bin1_case1,bin2_case1,...],[bin1_case2,bin2_case2,...],...]\". Numerical values may be in standard or scientific notation.\n\nTest suite:\n- Common parameters for all test cases:\n  - Source level $z_0 = 10000$ m.\n  - Top of the domain $z_{\\mathrm{top}} = 40000$ m.\n  - Altitude bin thickness $\\Delta z = 5000$ m, resulting in bins $[10000,15000)$, $[15000,20000)$, $[20000,25000)$, $[25000,30000)$, $[30000,35000)$, $[35000,40000)$.\n  - Reference density at $z=0$: $\\rho_{\\mathrm{ref}} = 1.225$ kg/m^3.\n  - Density scale height: $H = 7000$ m.\n- Test case 1 (general case with interior and lower-bound saturation):\n  - Brunt–Väisälä frequency: $N = 0.01$ s$^{-1}$.\n  - Source spectrum $S_1$ at $z_0$ given as three components, each specified by $(k_h, m, |w|)$ in SI units:\n    - Component A: $k_h = 2 \\times 10^{-5}$ m$^{-1}$, $m = 1.2 \\times 10^{-3}$ m$^{-1}$, $|w| = 0.05$ m/s.\n    - Component B: $k_h = 1 \\times 10^{-5}$ m$^{-1}$, $m = 8 \\times 10^{-4}$ m$^{-1}$, $|w| = 0.02$ m/s.\n    - Component C: $k_h = 3 \\times 10^{-5}$ m$^{-1}$, $m = 2 \\times 10^{-3}$ m$^{-1}$, $|w| = 0.08$ m/s.\n- Test case 2 (unsaturated within domain):\n  - Brunt–Väisälä frequency: $N = 0.01$ s$^{-1}$.\n  - Source spectrum $S_2$ at $z_0$:\n    - Component D: $k_h = 2 \\times 10^{-5}$ m$^{-1}$, $m = 1 \\times 10^{-3}$ m$^{-1}$, $|w| = 0.005$ m/s.\n    - Component E: $k_h = 1.5 \\times 10^{-5}$ m$^{-1}$, $m = 5 \\times 10^{-4}$ m$^{-1}$, $|w| = 0.01$ m/s.\n- Test case 3 (mixture of lower-bound saturation and interior saturation):\n  - Brunt–Väisälä frequency: $N = 0.01$ s$^{-1}$.\n  - Source spectrum $S_3$ at $z_0$:\n    - Component F: $k_h = 4 \\times 10^{-5}$ m$^{-1}$, $m = 1 \\times 10^{-3}$ m$^{-1}$, $|w| = 0.06$ m/s.\n    - Component G: $k_h = 6 \\times 10^{-5}$ m$^{-1}$, $m = 2.5 \\times 10^{-3}$ m$^{-1}$, $|w| = 0.1$ m/s.\n    - Component H: $k_h = 1 \\times 10^{-5}$ m$^{-1}$, $m = 5 \\times 10^{-4}$ m$^{-1}$, $|w| = 0.015$ m/s.\n\nYour program must implement the derivation-based algorithm meeting the above requirements and produce a single line of output in the specified format. Each deposition value must be expressed in N/m^3. No external input is allowed and no additional text should be printed other than the single-line final results.",
            "solution": "The problem statement is evaluated as scientifically grounded, well-posed, objective, and internally consistent. It provides all necessary information and is based on established principles of atmospheric fluid dynamics, specifically the theory of internal gravity waves. The problem is therefore deemed valid and a solution is presented below.\n\nThe solution is developed by following the six computational modeling requirements outlined in the problem statement.\n\n### 1. Dispersion and Polarization Relations\nWe begin with the two-dimensional linearized Boussinesq equations for a non-rotating, inviscid fluid with a constant Brunt–Väisälä frequency $N$ and zero mean flow. The equations for the perturbations of horizontal velocity ($u'$), vertical velocity ($w'$), and buoyancy ($b' = -g\\rho'/\\rho_0$) are:\n$$\n\\frac{\\partial u'}{\\partial t} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial x} \\quad (1)\n$$\n$$\n\\frac{\\partial w'}{\\partial t} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial z} + b' \\quad (2)\n$$\n$$\n\\frac{\\partial b'}{\\partial t} = -N^2 w' \\quad (3)\n$$\n$$\n\\frac{\\partial u'}{\\partial x} + \\frac{\\partial w'}{\\partial z} = 0 \\quad (4)\n$$\nWe seek plane-wave solutions of the form $\\phi'(x,z,t) = \\hat{\\phi} \\exp(i(k_h x + m z - \\omega t))$, where $\\hat{\\phi}$ is the complex amplitude, $k_h$ is the horizontal wavenumber, $m$ is the vertical wavenumber, and $\\omega$ is the intrinsic frequency. Substituting this ansatz into equations $(1)$-$(4)$ yields a system of algebraic equations for the amplitudes:\n$$\n-i\\omega \\hat{u} = -ik_h \\frac{\\hat{p}}{\\rho_0} \\quad (5)\n$$\n$$\n-i\\omega \\hat{w} = -im \\frac{\\hat{p}}{\\rho_0} + \\hat{b} \\quad (6)\n$$\n$$\n-i\\omega \\hat{b} = -N^2 \\hat{w} \\quad (7)\n$$\n$$\nik_h \\hat{u} + im \\hat{w} = 0 \\quad (8)\n$$\nFrom $(7)$, we express the buoyancy amplitude in terms of the vertical velocity amplitude: $\\hat{b} = \\frac{N^2}{i\\omega}\\hat{w}$.\nFrom the continuity equation $(8)$, we find the polarization relation between the horizontal and vertical velocity components:\n$$\n\\hat{u} = -\\frac{m}{k_h} \\hat{w} \\quad (9)\n$$\nThis relation indicates that the fluid particle motions are transverse to the total wavenumber vector $\\mathbf{k} = (k_h, m)$. The ratio of the velocity amplitudes is $|\\hat{u}|/|\\hat{w}| = |m/k_h|$.\n\nTo derive the dispersion relation, we eliminate $\\hat{p}$, $\\hat{u}$, and $\\hat{b}$ from the system. From $(5)$, $\\hat{p} = \\rho_0 \\frac{\\omega}{k_h} \\hat{u}$. Substituting $(9)$ into this gives $\\hat{p} = -\\rho_0 \\frac{\\omega m}{k_h^2} \\hat{w}$. Now, we substitute the expressions for $\\hat{p}$ and $\\hat{b}$ into the vertical momentum equation $(6)$:\n$$\n-i\\omega \\hat{w} = -im \\frac{1}{\\rho_0} \\left(-\\rho_0 \\frac{\\omega m}{k_h^2} \\hat{w}\\right) + \\frac{N^2}{i\\omega}\\hat{w}\n$$\nDividing by $\\hat{w}$ (assuming non-trivial solutions) and by $i$:\n$$\n-\\omega = \\frac{\\omega m^2}{k_h^2} - \\frac{N^2}{\\omega}\n$$\nMultiplying by $\\omega$ and rearranging gives:\n$$\n\\omega^2\\left(1 + \\frac{m^2}{k_h^2}\\right) = N^2 \\implies \\omega^2\\left(\\frac{k_h^2 + m^2}{k_h^2}\\right) = N^2\n$$\nThis gives the dispersion relation for internal gravity waves:\n$$\n\\omega^2 = N^2 \\frac{k_h^2}{k_h^2 + m^2} \\quad (10)\n$$\nThis relation correctly shows that $\\omega  N$. For the purpose of computation, we solve for $\\omega$ using the given positive values of $N$, $k_h$, and $m$: $\\omega = N k_h / \\sqrt{k_h^2 + m^2}$.\n\n### 2. Vertical Flux of Horizontal Momentum\nThe time-mean vertical flux of horizontal momentum per unit area, also known as the Reynolds stress, is given by $F_p(z) = \\langle \\rho_0(z) u' w' \\rangle$, where $\\langle \\cdot \\rangle$ denotes a time average over one wave period. For plane waves, this average is calculated as $\\frac{1}{2} \\Re(\\hat{u} \\hat{w}^*)$, where $*$ denotes the complex conjugate.\nLet $\\hat{w} = |w|$ be a real amplitude (by choice of phase). From the polarization relation $(9)$, $\\hat{u} = -\\frac{m}{k_h}|w|$. This is also real. The momentum flux is then:\n$$\n\\langle u' w' \\rangle = \\frac{1}{2} \\Re\\left( \\left(-\\frac{m}{k_h}|w|\\right) |w|^* \\right) = -\\frac{1}{2} \\frac{m}{k_h} |w|^2\n$$\nThe vertical group velocity is $c_{gz} = \\frac{\\partial \\omega}{\\partial m} = -N k_h m (k_h^2 + m^2)^{-3/2}$. For upward energy propagation ($c_{gz}  0$), we require $m  0$ (assuming $k_h, N  0$). The problem provides positive values for $m$, which we interpret as the magnitude of the vertical wavenumber, $|m|$. Thus, for upward-propagating waves, the physical vertical wavenumber is $-|m|$. The momentum flux is then:\n$$\nF_p(z) = \\rho_0(z) \\langle u' w' \\rangle = \\rho_0(z) \\frac{1}{2} \\frac{|m|}{k_h} |w(z)|^2\n$$\nIn the absence of dissipation, this flux is conserved with height below the saturation level. We evaluate it at the source level $z_0$:\n$$\nF_{p,0} = \\frac{1}{2} \\rho_0(z_0) \\frac{|m|}{k_h} |w(z_0)|^2 \\quad (11)\n$$\nwhere $|m|$ and $k_h$ are the wavenumber magnitudes given at the source.\n\n### 3. WKB Amplitude Scaling\nUnder the WKB approximation for a slowly varying medium, with constant $N$, $k_h$, and $\\omega$ (for horizontally homogeneous background), the vertical wavenumber $m$ is also constant. The conservation of wave action flux requires $\\rho_0(z)|w(z)|^2 = \\text{constant}$. This can be derived from considering the wave energy flux, which must be constant. So, for a wave propagating from $z_0$ to $z$:\n$$\n\\rho_0(z_0)|w(z_0)|^2 = \\rho_0(z)|w(z)|^2\n$$\nThis gives the scaling of the vertical velocity amplitude with height:\n$$\n|w(z)| = |w(z_0)| \\sqrt{\\frac{\\rho_0(z_0)}{\\rho_0(z)}}\n$$\nUsing the specified anelastic density profile $\\rho_0(z) = \\rho_{\\mathrm{ref}} \\exp(-z/H)$, we get:\n$$\n|w(z)| = |w(z_0)| \\sqrt{\\frac{\\exp(-z_0/H)}{\\exp(-z/H)}} = |w(z_0)| \\exp\\left(\\frac{z-z_0}{2H}\\right) \\quad (12)\n$$\nThe vertical displacement amplitude $|\\xi|$ is related to the vertical velocity amplitude $|w|$ by $w' = d\\xi'/dt$. For a monochromatic wave with no background flow, this implies $\\hat{w} = -i\\omega\\hat{\\xi}$, so their amplitudes are related by:\n$$\n|\\xi(z)| = \\frac{|w(z)|}{\\omega} \\quad (13)\n$$\n\n### 4. Saturation Criterion and Height\nThe wave is assumed to break or saturate when it becomes convectively unstable. This occurs when the total potential temperature gradient becomes zero or negative. For a small-amplitude wave, this threshold is approximated by the condition that the wave-induced vertical parcel displacement makes a fluid parcel from one level arrive at another level with the same buoyancy, which corresponds to the wave steepness reaching unity. The condition is given by $|m||\\xi(z)| = 1$. The height $z_s$ at which this occurs is the saturation height.\n$$\n|m| |\\xi(z_s)| = 1 \\implies |m| \\frac{|w(z_s)|}{\\omega} = 1\n$$\nSubstituting the WKB scaling for $|w(z_s)|$ from $(12)$:\n$$\n|m| \\frac{|w(z_0)| \\exp\\left(\\frac{z_s-z_0}{2H}\\right)}{\\omega} = 1\n$$\nWe can now solve for $z_s$. If the wave is not saturated at the source level, i.e., $|m||\\xi(z_0)|  1$, we can take the logarithm:\n$$\n\\exp\\left(\\frac{z_s-z_0}{2H}\\right) = \\frac{\\omega}{|m||w(z_0)|}\n$$\n$$\nz_s = z_0 + 2H \\ln\\left(\\frac{\\omega}{|m||w(z_0)|}\\right) \\quad (14)\n$$\nIf the wave is already saturated at the source (i.e., $|m||w(z_0)|/\\omega \\geq 1$), the argument of the logarithm is less than or equal to $1$, yielding $z_s \\leq z_0$. In this case, as per the problem specification, we set the saturation height to be the source height, $z_s = z_0$.\n\n### 5. Momentum Deposition Profile\nThe wave propagates upward conserving its momentum flux $F_{p,0}$ until it reaches the saturation height $z_s$, at which point it is assumed to break and deposit its entire momentum flux. The rate of change of momentum flux, representing the force per unit area, is $-\\nabla \\cdot \\mathbf{F}_p$. For our model, this is approximated by a localized deposition at $z_s$. The deposition per unit volume, $D$ (in N/m$^3$), is the flux $F_{p,0}$ (in N/m$^2$) divided by the thickness of the altitude bin where deposition occurs, $\\Delta z$.\n- The domain is from $z_0 = 10000$ m to $z_{\\mathrm{top}} = 40000$ m, divided into bins of thickness $\\Delta z = 5000$ m.\n- For each wave component, we compute $z_s$.\n- If $z_s \\ge z_{\\mathrm{top}}$, the wave does not saturate within the domain, and its deposition is zero.\n- If $z_0 \\le z_s  z_{\\mathrm{top}}$, we find the bin index $i = \\lfloor(z_s - z_0) / \\Delta z\\rfloor$. The momentum flux $F_{p,0}$ of this wave is added to the total flux to be deposited in bin $i$. The problem states that if saturation occurs below the first bin, it's deposited in the first bin. Our formulation with $z_s = z_0$ for pre-saturated waves handles this, as $z_s = z_0$ falls in the first bin.\n- The total deposition in bin $i$ is $D_i = (\\sum_j F_{p,0}^{(j)}) / \\Delta z$, where the sum is over all waves $j$ that saturate in bin $i$.\n\n### 6. Aggregation over the Source Spectrum\nThe final deposition profile is the sum of contributions from all components in the discrete source spectrum $S$. The algorithm is as follows:\n1. Initialize an array of zeros, `deposition_fluxes`,Dimensioned by the number of altitude bins.\n2. For each wave component $(k_h, m, |w(z_0)|)$ in the source spectrum $S$:\n    a. Calculate the frequency $\\omega$ using the dispersion relation $(10)$.\n    b. Calculate the conserved momentum flux $F_{p,0}$ at the source level $z_0$ using $(11)$, with $\\rho_0(z_0) = \\rho_{\\mathrm{ref}} \\exp(-z_0/H)$. The problem gives positive $m$, which we interpret as $|m|$.\n    c. Calculate the saturation height $z_s$ using $(14)$, with the condition that $z_s = z_0$ if the wave is saturated at the source.\n    d. If $z_0 \\le z_s  z_{\\mathrm{top}}$, determine the index of the altitude bin containing $z_s$. Add $F_{p,0}$ to the corresponding element in the `deposition_fluxes` array.\n3. After iterating through all wave components, obtain the final deposition profile $D$ by dividing the `deposition_fluxes` array by the bin thickness $\\Delta z$.\nThis procedure is repeated for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the vertical deposition profile of horizontal momentum flux from a spectrum of internal gravity waves.\n    \"\"\"\n\n    # Common parameters from the problem statement\n    Z0 = 10000.0  # Source level (m)\n    Z_TOP = 40000.0  # Top of the domain (m)\n    DZ = 5000.0  # Altitude bin thickness (m)\n    RHO_REF = 1.225  # Reference density at z=0 (kg/m^3)\n    H = 7000.0  # Density scale height (m)\n\n    # Test suite\n    test_cases = [\n        {\n            \"N\": 0.01,  # Brunt–Väisälä frequency (s^-1)\n            \"spectrum\": [\n                # (kh, m, |w|) in SI units\n                (2e-5, 1.2e-3, 0.05),  # Component A\n                (1e-5, 8e-4, 0.02),    # Component B\n                (3e-5, 2e-3, 0.08),    # Component C\n            ],\n        },\n        {\n            \"N\": 0.01,\n            \"spectrum\": [\n                (2e-5, 1e-3, 0.005),   # Component D\n                (1.5e-5, 5e-4, 0.01),  # Component E\n            ],\n        },\n        {\n            \"N\": 0.01,\n            \"spectrum\": [\n                (4e-5, 1e-3, 0.06),    # Component F\n                (6e-5, 2.5e-3, 0.1),   # Component G\n                (1e-5, 5e-4, 0.015),   # Component H\n            ],\n        },\n    ]\n\n    all_results = []\n\n    num_bins = int((Z_TOP - Z0) / DZ)\n\n    for case in test_cases:\n        N = case[\"N\"]\n        spectrum = case[\"spectrum\"]\n        \n        # Array to store the sum of momentum fluxes for each bin\n        deposition_fluxes = np.zeros(num_bins)\n        \n        # Density at the source level\n        rho_z0 = RHO_REF * np.exp(-Z0 / H)\n\n        for kh, m, w0 in spectrum:\n            # 1. Calculate intrinsic frequency omega\n            # omega^2 = N^2 * kh^2 / (kh^2 + m^2)\n            omega = N * kh / np.sqrt(kh**2 + m**2)\n\n            # 2. Calculate conserved vertical flux of horizontal momentum (stress)\n            # F_p = 0.5 * rho_0(z0) * (|m|/kh) * |w(z0)|^2\n            # Here m is given as a positive value, so it is |m|.\n            stress = 0.5 * rho_z0 * (m / kh) * w0**2\n\n            # 3. Determine saturation height zs\n            # Saturation condition: m * |xi(z)| = 1 = m * |w(z)| / omega = 1\n            # Check for initial saturation\n            initial_saturation_param = m * w0 / omega\n            \n            if initial_saturation_param = 1.0:\n                # Wave is saturated at or below the source level\n                zs = Z0\n            else:\n                # Calculate saturation height using WKB amplitude growth\n                # zs = z0 + 2H * ln(omega / (m * |w(z0)|))\n                zs = Z0 + 2 * H * np.log(omega / (m * w0))\n\n            # 4. Bin the deposition\n            if Z0 = zs  Z_TOP:\n                bin_index = int((zs - Z0) / DZ)\n                if bin_index  num_bins:\n                    deposition_fluxes[bin_index] += stress\n        \n        # 5. Compute deposition per unit volume (N/m^3)\n        deposition_profile = deposition_fluxes / DZ\n        all_results.append(deposition_profile.tolist())\n\n    # Format output as specified\n    case_strings = []\n    for res in all_results:\n        # Format each list of floats without spaces\n        case_strings.append(f\"[{','.join(f'{v:.6e}' for v in res)}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}