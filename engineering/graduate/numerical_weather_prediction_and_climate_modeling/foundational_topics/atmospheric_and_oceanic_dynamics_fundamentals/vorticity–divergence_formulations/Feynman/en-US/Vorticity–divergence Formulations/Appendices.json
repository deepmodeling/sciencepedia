{
    "hands_on_practices": [
        {
            "introduction": "This practice connects the kinematic quantity of divergence to a fundamental dynamic variable: surface pressure tendency. It illustrates how the vertical structure of divergence, governed by the mass continuity equation, directly controls the evolution of weather systems at the surface. This exercise  builds a crucial bridge between the abstract mathematical formulation and tangible meteorological phenomena.",
            "id": "4110689",
            "problem": "Consider a global spectral Numerical Weather Prediction (NWP) model formulated in pressure coordinates that advances prognostic variables using the vorticity–divergence representation, where the horizontal wind $\\mathbf{v}(p)$ is decomposed into a nondivergent component and an irrotational component, and the horizontal divergence is $\\delta(p) \\equiv \\nabla \\cdot \\mathbf{v}(p)$. Assume hydrostatic balance and use the pressure-coordinate mass continuity equation together with a physically realistic top boundary condition. At a particular location and time, the model diagnoses a vertically varying horizontal divergence given by $\\delta(p) = \\delta_{0}\\left(\\frac{p}{p_{s}}\\right)^{2}$ for $0 \\leq p \\leq p_{s}$, where $p_{s}$ is the surface pressure. Let the top-of-model boundary be at $p=0$ with $\\omega(0)=0$, where $\\omega \\equiv \\mathrm{D}p/\\mathrm{D}t$ is the material (Lagrangian) pressure tendency. The local surface wind is $\\mathbf{v}_{s} = (u_{s}, v_{s})$ and the local horizontal gradient of surface pressure is $\\nabla p_{s} = \\left(\\frac{\\partial p_{s}}{\\partial x}, \\frac{\\partial p_{s}}{\\partial y}\\right)$.\n\nStarting from first principles, derive an expression for the instantaneous local surface pressure tendency $\\frac{\\partial p_{s}}{\\partial t}$ in terms of a vertical integral of $\\delta(p)$ and $\\mathbf{v}_{s} \\cdot \\nabla p_{s}$. Then evaluate this tendency for the following values: $\\delta_{0} = 2.0 \\times 10^{-7}\\ \\mathrm{s}^{-1}$, $p_{s} = 9.92 \\times 10^{4}\\ \\mathrm{Pa}$, $\\mathbf{v}_{s} = (12\\ \\mathrm{m}\\ \\mathrm{s}^{-1},\\ -5\\ \\mathrm{m}\\ \\mathrm{s}^{-1})$, and $\\nabla p_{s} = \\left(-2.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1},\\ 0.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1}\\right)$.\n\nRound your final numerical result to three significant figures. Express your answer in $\\mathrm{Pa}\\ \\mathrm{s}^{-1}$. Provide only the single calculated value as your final answer.",
            "solution": "The user wants me to solve a problem in numerical weather prediction concerning the surface pressure tendency. The problem is deemed valid as it is scientifically grounded, well-posed, and objective, with all necessary data provided and physically consistent. I will proceed with the solution, which involves two main parts: first, a derivation of the surface pressure tendency equation from first principles, and second, an evaluation of this tendency using the given numerical values.\n\n**Part 1: Derivation of the Surface Pressure Tendency Equation**\n\nThe derivation begins with the mass continuity equation in pressure coordinates $(x, y, p)$. On a constant pressure surface, this equation is given by:\n$$\n\\nabla_{p} \\cdot \\mathbf{v} + \\frac{\\partial \\omega}{\\partial p} = 0\n$$\nwhere $\\mathbf{v}(p)$ is the horizontal wind vector, $\\nabla_{p} \\cdot \\mathbf{v} \\equiv \\delta(p)$ is the horizontal divergence, and $\\omega \\equiv \\mathrm{D}p/\\mathrm{D}t$ is the material (Lagrangian) pressure tendency. The equation can be rewritten as:\n$$\n\\frac{\\partial \\omega}{\\partial p} = -\\delta(p)\n$$\nTo find the value of $\\omega$ at a given pressure level, we integrate this equation vertically with respect to pressure. We integrate from the top of the model, specified as $p = 0$, to an arbitrary pressure level $p'$:\n$$\n\\int_{0}^{p'} \\frac{\\partial \\omega}{\\partial p''} dp'' = - \\int_{0}^{p'} \\delta(p'') dp''\n$$\nApplying the fundamental theorem of calculus, we get:\n$$\n\\omega(p') - \\omega(0) = - \\int_{0}^{p'} \\delta(p'') dp''\n$$\nThe problem states a physically realistic top boundary condition, $\\omega(0) = 0$. This condition signifies that there is no mass flux through the top of the atmosphere. Substituting this condition gives the expression for $\\omega$ at any pressure level $p'$:\n$$\n\\omega(p') = - \\int_{0}^{p'} \\delta(p'') dp''\n$$\nWe are interested in the conditions at the surface, where the pressure is $p_s$. Evaluating the above expression at $p' = p_s$ gives the vertical velocity in pressure coordinates at the surface, $\\omega_s$:\n$$\n\\omega_s = \\omega(p_s) = - \\int_{0}^{p_s} \\delta(p) dp\n$$\nNote that the integration variable has been renamed from $p''$ to $p$ for notational convenience.\n\nNext, we need to relate $\\omega_s$ to the local surface pressure tendency, $\\frac{\\partial p_s}{\\partial t}$. The surface pressure $p_s(x,y,t)$ is a field defined on a two-dimensional horizontal plane. The material derivative of pressure for a fluid parcel located at the surface is, by definition, $\\omega_s$. It relates to the local (Eulerian) time derivative and the advection of the pressure field by the surface wind $\\mathbf{v}_s$ as follows:\n$$\n\\omega_s = \\frac{\\mathrm{D}p}{\\mathrm{D}t}\\bigg|_{s} = \\frac{\\partial p_s}{\\partial t} + \\mathbf{v}_s \\cdot \\nabla p_s\n$$\nThis relationship assumes a flat lower boundary, which is implicit as no topography is mentioned. Rearranging this equation to solve for the local surface pressure tendency yields:\n$$\n\\frac{\\partial p_s}{\\partial t} = \\omega_s - \\mathbf{v}_s \\cdot \\nabla p_s\n$$\nFinally, we substitute the integral expression for $\\omega_s$ into this equation to obtain the desired expression for the instantaneous local surface pressure tendency in terms of the vertical integral of divergence and the surface advection term:\n$$\n\\frac{\\partial p_s}{\\partial t} = - \\int_{0}^{p_s} \\delta(p) dp - \\mathbf{v}_s \\cdot \\nabla p_s\n$$\nThis completes the derivation required by the first part of the problem.\n\n**Part 2: Evaluation of the Surface Pressure Tendency**\n\nNow we evaluate this expression using the given functional form for divergence and the specified numerical values.\n\nThe divergence profile is given as $\\delta(p) = \\delta_{0}\\left(\\frac{p}{p_{s}}\\right)^{2}$. First, we evaluate the integral term:\n$$\n\\int_{0}^{p_s} \\delta(p) dp = \\int_{0}^{p_s} \\delta_{0}\\left(\\frac{p}{p_{s}}\\right)^{2} dp = \\frac{\\delta_0}{p_s^2} \\int_{0}^{p_s} p^2 dp\n$$\n$$\n= \\frac{\\delta_0}{p_s^2} \\left[ \\frac{p^3}{3} \\right]_0^{p_s} = \\frac{\\delta_0}{p_s^2} \\left( \\frac{p_s^3}{3} - 0 \\right) = \\frac{\\delta_0 p_s}{3}\n$$\nSo, the surface pressure tendency equation becomes:\n$$\n\\frac{\\partial p_s}{\\partial t} = - \\frac{\\delta_0 p_s}{3} - \\mathbf{v}_s \\cdot \\nabla p_s\n$$\nNext, we calculate the two terms on the right-hand side using the provided values:\n$\\delta_{0} = 2.0 \\times 10^{-7}\\ \\mathrm{s}^{-1}$\n$p_{s} = 9.92 \\times 10^{4}\\ \\mathrm{Pa}$\n$\\mathbf{v}_{s} = (12\\ \\mathrm{m}\\ \\mathrm{s}^{-1},\\ -5\\ \\mathrm{m}\\ \\mathrm{s}^{-1})$\n$\\nabla p_{s} = \\left(-2.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1},\\ 0.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1}\\right)$\n\n1.  **Divergence term contribution**: The first term on the right-hand side is:\n    $$\n    - \\frac{\\delta_0 p_s}{3} = - \\frac{(2.0 \\times 10^{-7}\\ \\mathrm{s}^{-1}) (9.92 \\times 10^{4}\\ \\mathrm{Pa})}{3} = - \\frac{1.984 \\times 10^{-2}}{3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} \\approx -6.6133 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n    $$\n2.  **Advection term contribution**: The second term on the right-hand side involves the dot product $\\mathbf{v}_s \\cdot \\nabla p_s$:\n    $$\n    \\mathbf{v}_s \\cdot \\nabla p_s = (12\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(-2.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1}) + (-5\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(0.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1})\n    $$\n    $$\n    = -24.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} - 2.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} = -26.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} = -2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n    $$\n    The contribution to the tendency is $-(\\mathbf{v}_s \\cdot \\nabla p_s)$, which is $-(-2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}) = 2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}$.\n\nFinally, we sum the two contributions to find the total local surface pressure tendency:\n$$\n\\frac{\\partial p_s}{\\partial t} = \\left(- \\frac{\\delta_0 p_s}{3}\\right) - (\\mathbf{v}_s \\cdot \\nabla p_s) = (-6.6133\\dots \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}) - (-2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1})\n$$\n$$\n\\frac{\\partial p_s}{\\partial t} = -6.6133\\dots \\times 10^{-3} + 2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} = -3.9633\\dots \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n$$\nThe problem requires the result to be rounded to three significant figures.\n$$\n\\frac{\\partial p_s}{\\partial t} \\approx -3.96 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n$$",
            "answer": "$$\\boxed{-3.96 \\times 10^{-3}}$$"
        },
        {
            "introduction": "Moving from continuous equations to a computational model requires careful spatial discretization. This exercise provides hands-on experience with the Arakawa C-grid, a widely used staggering arrangement that has favorable properties for simulating wave propagation. By implementing discrete versions of key operators , you will investigate the consistency between the velocity potential, streamfunction, divergence, and vorticity, a fundamental verification step in model development.",
            "id": "4110685",
            "problem": "Consider a two-dimensional horizontal flow discretized on an Arakawa C-grid used in numerical weather prediction and climate modeling. Let the domain be doubly periodic with side lengths $L_x$ and $L_y$, discretized into $N_x$ and $N_y$ cells, respectively, with uniform spacings $d_x$ and $d_y$ satisfying $L_x = N_x d_x$ and $L_y = N_y d_y$. Cell-center coordinates are $x_i = (i + 0.5) d_x$ and $y_j = (j + 0.5) d_y$ for integer indices $i \\in \\{0,\\dots,N_x-1\\}$ and $j \\in \\{0,\\dots,N_y-1\\}$. The Arakawa C-grid staggering places the zonal wind component at cell faces normal to the $x$-direction and the meridional wind component at cell faces normal to the $y$-direction. Specifically, $u$ is located at positions $(i+0.5,j)$ and $v$ is located at positions $(i,j+0.5)$, where indices refer to the adjacent cell centers.\n\nStarting from the vorticity–divergence formulation of the velocity field using scalar potentials at cell centers, define the discrete velocity components by\n$$\nu_{i+\\frac{1}{2},j} = \\frac{\\phi_{i+1,j} - \\phi_{i,j}}{d_x} - \\frac{\\psi_{i,j+1} - \\psi_{i,j}}{d_y},\n\\quad\nv_{i,j+\\frac{1}{2}} = \\frac{\\phi_{i,j+1} - \\phi_{i,j}}{d_y} + \\frac{\\psi_{i+1,j} - \\psi_{i,j}}{d_x},\n$$\nwhere $\\phi_{i,j}$ and $\\psi_{i,j}$ are scalar fields defined at cell centers and all indices are treated periodically (for example, $\\phi_{N_x,j} \\equiv \\phi_{0,j}$ and $\\phi_{i,N_y} \\equiv \\phi_{i,0}$).\n\nDefine the discrete divergence at cell centers by the finite-volume balance\n$$\n\\mathcal{D}_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{d_x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{d_y},\n$$\nand define the discrete vertical vorticity at cell centers by the discrete curl of face-normal velocities\n$$\n\\zeta_{i,j} = \\frac{v_{i+1,j+\\frac{1}{2}} - v_{i,j+\\frac{1}{2}}}{d_x} - \\frac{u_{i+\\frac{1}{2},j+1} - u_{i+\\frac{1}{2},j}}{d_y}.\n$$\nLet the discrete Laplacian at cell centers act componentwise via second-order central differences,\n$$\n(\\nabla^2 \\phi)_{i,j} = \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{d_x^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{d_y^2},\n$$\nand similarly for $(\\nabla^2 \\psi)_{i,j}$.\n\nYour task is to implement these discrete operators on a periodic Arakawa C-grid and evaluate their consistency for a set of analytic test fields. For each test, construct $\\phi_{i,j}$ and $\\psi_{i,j}$ by sampling smooth trigonometric functions at cell centers with integer wavenumbers to ensure exact periodicity. Specifically, for given integers $k_x^\\phi$, $k_y^\\phi$, $k_x^\\psi$, and $k_y^\\psi$, define\n$$\n\\phi_{i,j} = \\sin\\!\\left(2\\pi \\frac{k_x^\\phi x_i}{L_x}\\right) \\cos\\!\\left(2\\pi \\frac{k_y^\\phi y_j}{L_y}\\right),\n\\quad\n\\psi_{i,j} = \\cos\\!\\left(2\\pi \\frac{k_x^\\psi x_i}{L_x}\\right) \\sin\\!\\left(2\\pi \\frac{k_y^\\psi y_j}{L_y}\\right),\n$$\nwith angles in radians.\n\nImplement periodic indexing using wrap-around (for example, via circular shifts) so that all difference operators are computed consistently at the boundaries. For each test case, compute:\n- The maximum absolute discrepancy between the discrete divergence $\\mathcal{D}_{i,j}$ and the discrete Laplacian $(\\nabla^2 \\phi)_{i,j}$ over all cell centers, reported as a float.\n- The maximum absolute discrepancy between the discrete vorticity $\\zeta_{i,j}$ and the discrete Laplacian $(\\nabla^2 \\psi)_{i,j}$ over all cell centers, reported as a float.\n\nDesign your program to evaluate the following test suite, which covers a general case, anisotropy in grid spacing, and a small-grid edge case. All lengths are in meters, and angles in the trigonometric functions are in radians.\n\nTest suite:\n1. $N_x = 16$, $N_y = 12$, $d_x = 1.0$, $d_y = 1.0$, $k_x^\\phi = 1$, $k_y^\\phi = 2$, $k_x^\\psi = 3$, $k_y^\\psi = 1$.\n2. $N_x = 12$, $N_y = 8$, $d_x = 1.0$, $d_y = 2.0$, $k_x^\\phi = 3$, $k_y^\\phi = 2$, $k_x^\\psi = 2$, $k_y^\\psi = 3$.\n3. $N_x = 4$, $N_y = 4$, $d_x = 1.5$, $d_y = 1.0$, $k_x^\\phi = 1$, $k_y^\\phi = 1$, $k_x^\\psi = 1$, $k_y^\\psi = 1$.\n\nYour program should produce a single line of output containing the six float results in the order $(\\text{divergence error}, \\text{vorticity error})$ for each test case $1$, $2$, and $3$, aggregated as a comma-separated list enclosed in square brackets (for example, $[e_{11},e_{12},e_{21},e_{22},e_{31},e_{32}]$). All outputs must be floats with no units.",
            "solution": "The problem requires us to validate the consistency of certain discrete operators on a two-dimensional, doubly periodic Arakawa C-grid. Specifically, we are asked to compare the discrete divergence $\\mathcal{D}$ of a velocity field with the discrete Laplacian of the velocity potential $\\phi$, and the discrete vorticity $\\zeta$ with the discrete Laplacian of the stream function $\\psi$. The velocity field components, $u$ and $v$, are themselves derived from $\\phi$ and $\\psi$ using specified finite difference formulas.\n\nFirst, let's establish the mathematical and computational framework. The domain has dimensions $L_x \\times L_y$ and is discretized into $N_x \\times N_y$ cells of size $d_x \\times d_y$, where $L_x = N_x d_x$ and $L_y = N_y d_y$. The scalar fields, such as the velocity potential $\\phi$ and the stream function $\\psi$, are defined at cell centers with coordinates $(x_i, y_j) = ((i + 0.5)d_x, (j + 0.5)d_y)$ for $i \\in \\{0, \\dots, N_x-1\\}$ and $j \\in \\{0, \\dots, N_y-1\\}$.\n\nThe Arakawa C-grid staggers the velocity components. The zonal velocity $u$ is located at the vertical faces of the cells, at positions $(i+0.5, j)$ in a continuous coordinate sense, but computationally it's convenient to associate it with the cell index $(i,j)$ representing the velocity on the face between cells $(i,j)$ and $(i+1,j)$, which we denote $u_{i+1/2,j}$. Similarly, the meridional velocity $v$ is at horizontal faces, $v_{i,j+1/2}$.\n\nThe problem defines the velocity components in terms of the potentials as:\n$$\nu_{i+\\frac{1}{2},j} = \\frac{\\phi_{i+1,j} - \\phi_{i,j}}{d_x} - \\frac{\\psi_{i,j+1} - \\psi_{i,j}}{d_y}\n$$\n$$\nv_{i,j+\\frac{1}{2}} = \\frac{\\phi_{i,j+1} - \\phi_{i,j}}{d_y} + \\frac{\\psi_{i+1,j} - \\psi_{i,j}}{d_x}\n$$\nThese definitions use simple, one-sided differences for the cross-derivatives (e.g., the $\\psi$ term in the $u$ equation), which is a specific, though not the most accurate, discretization choice. It is crucial to adhere strictly to these definitions.\n\nThe discrete divergence $\\mathcal{D}$ and vorticity $\\zeta$ are defined at cell centers $(i,j)$:\n$$\n\\mathcal{D}_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{d_x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{d_y}\n$$\n$$\n\\zeta_{i,j} = \\frac{v_{i+1,j+\\frac{1}{2}} - v_{i,j+\\frac{1}{2}}}{d_x} - \\frac{u_{i+\\frac{1}{2},j+1} - u_{i+\\frac{1}{2},j}}{d_y}\n$$\nThe definition of $\\zeta_{i,j}$ is noteworthy. The finite differences on the right-hand side are naturally centered at the grid point $(i+1/2, j+1/2)$, the corner of the cell $(i,j)$. The problem defines the cell-centered vorticity $\\zeta_{i,j}$ to be equal to this corner value.\n\nFinally, the discrete Laplacian operator $\\nabla^2$ is given by the standard five-point stencil for a Cartesian grid:\n$$\n(\\nabla^2 \\phi)_{i,j} = \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{d_x^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{d_y^2}\n$$\n\nThe core of the task is to compute the maximum absolute discrepancy between $\\mathcal{D}_{i,j}$ and $(\\nabla^2 \\phi)_{i,j}$, and between $\\zeta_{i,j}$ and $(\\nabla^2 \\psi)_{i,j}$. In the continuous case, the divergence of the gradient of $\\phi$ is $\\nabla^2 \\phi$, and the curl of the rotational part of the velocity field yields $\\nabla^2 \\psi$. The problem tests how these identities hold up under the given specific discretizations. Algebraic substitution, as performed during validation, shows that the discrepancies are not identically zero due to the stencil choices. Our implementation must calculate these non-zero errors.\n\nThe implementation will proceed as follows for each test case:\n1.  Construct the 2D grid of cell-center coordinates $(x_{i,j}, y_{i,j})$.\n2.  Evaluate the scalar potential fields $\\phi_{i,j}$ and $\\psi_{i,j}$ using the provided trigonometric functions. The integer wavenumbers ensure perfect periodicity on the discrete grid.\n3.  Compute the discrete Laplacian fields, $(\\nabla^2 \\phi)_{i,j}$ and $(\\nabla^2 \\psi)_{i,j}$. All periodic indexing is handled using circular shifts, for which `numpy.roll` is perfectly suited. For instance, $\\phi_{i+1,j}$ is implemented as `numpy.roll(phi, -1, axis=0)` on a matrix where the first dimension corresponds to the $i$ index.\n4.  Compute the staggered velocity fields $u_{i+1/2,j}$ and $v_{i,j+1/2}$ from $\\phi$ and $\\psi$ according to their definitions, again using `numpy.roll` for shifted field values.\n5.  Compute the cell-centered divergence $\\mathcal{D}_{i,j}$ and vorticity $\\zeta_{i,j}$ from the velocity fields.\n6.  Calculate the discrepancies by finding the maximum absolute difference over the entire grid: $E_\\mathcal{D} = \\max_{i,j} |\\mathcal{D}_{i,j} - (\\nabla^2 \\phi)_{i,j}|$ and $E_\\zeta = \\max_{i,j} |\\zeta_{i,j} - (\\nabla^2 \\psi)_{i,j}|$. These two float values are the required outputs for each test case.\n\nThis procedure will be encapsulated in a function and applied to each parameter set from the test suite. The results will be aggregated and formatted into the specified output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_discrepancies(Nx, Ny, dx, dy, kx_phi, ky_phi, kx_psi, ky_psi):\n    \"\"\"\n    Computes operator discrepancies on a periodic Arakawa C-grid for a given test case.\n    \n    Args:\n        Nx, Ny (int): Grid dimensions.\n        dx, dy (float): Grid spacings.\n        kx_phi, ky_phi (int): Wavenumbers for the phi field.\n        kx_psi, ky_psi (int): Wavenumbers for the psi field.\n\n    Returns:\n        tuple[float, float]: A tuple containing the divergence discrepancy and the\n                             vorticity discrepancy.\n    \"\"\"\n    # 1. Grid and coordinate setup\n    Lx = Nx * dx\n    Ly = Ny * dy\n    i_indices = np.arange(Nx)\n    j_indices = np.arange(Ny)\n    ii, jj = np.meshgrid(i_indices, j_indices, indexing='ij')\n\n    x = (ii + 0.5) * dx\n    y = (jj + 0.5) * dy\n\n    # 2. Construct potential fields phi and psi at cell centers\n    phi = np.sin(2 * np.pi * kx_phi * x / Lx) * np.cos(2 * np.pi * ky_phi * y / Ly)\n    psi = np.cos(2 * np.pi * kx_psi * x / Lx) * np.sin(2 * np.pi * ky_psi * y / Ly)\n\n    # 3. Compute discrete Laplacians of phi and psi\n    # Helper for periodic shifts\n    def laplacian(field, dx, dy):\n        f_ip1 = np.roll(field, -1, axis=0)\n        f_im1 = np.roll(field, 1, axis=0)\n        f_jp1 = np.roll(field, -1, axis=1)\n        f_jm1 = np.roll(field, 1, axis=1)\n        lap_x = (f_ip1 - 2 * field + f_im1) / (dx**2)\n        lap_y = (f_jp1 - 2 * field + f_jm1) / (dy**2)\n        return lap_x + lap_y\n\n    lap_phi = laplacian(phi, dx, dy)\n    lap_psi = laplacian(psi, dx, dy)\n\n    # 4. Compute velocity components u and v\n    # These are computed on staggered locations but stored in cell-centered arrays.\n    # u[i,j] corresponds to u_{i+1/2, j}\n    # v[i,j] corresponds to v_{i, j+1/2}\n    phi_ip1 = np.roll(phi, -1, axis=0)\n    psi_ip1 = np.roll(psi, -1, axis=0)\n    phi_jp1 = np.roll(phi, -1, axis=1)\n    psi_jp1 = np.roll(psi, -1, axis=1)\n    \n    u = (phi_ip1 - phi) / dx - (psi_jp1 - psi) / dy\n    v = (phi_jp1 - phi) / dy + (psi_ip1 - psi) / dx\n\n    # 5. Compute discrete divergence D at cell centers\n    u_im1 = np.roll(u, 1, axis=0)\n    v_jm1 = np.roll(v, 1, axis=1)\n    div_D = (u - u_im1) / dx + (v - v_jm1) / dy\n\n    # 6. Compute discrete vorticity zeta at cell centers\n    # According to the problem, zeta_{i,j} is defined using values that\n    # are naturally centered at (i+1/2, j+1/2).\n    v_ip1 = np.roll(v, -1, axis=0)\n    u_jp1 = np.roll(u, -1, axis=1)\n    zeta = (v_ip1 - v) / dx - (u_jp1 - u) / dy\n\n    # 7. Compute maximum absolute discrepancies\n    div_error = np.max(np.abs(div_D - lap_phi))\n    vort_error = np.max(np.abs(zeta - lap_psi))\n\n    return div_error, vort_error\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, dx, dy, kx_phi, ky_phi, kx_psi, ky_psi)\n        (16, 12, 1.0, 1.0, 1, 2, 3, 1),\n        (12, 8, 1.0, 2.0, 3, 2, 2, 3),\n        (4, 4, 1.5, 1.0, 1, 1, 1, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        div_discrepancy, vort_discrepancy = calculate_discrepancies(*case)\n        results.append(div_discrepancy)\n        results.append(vort_discrepancy)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A spatially discretized model must also be integrated forward in time, and the choice of time-stepping scheme is critical for stability. This practice delves into the stability of the leapfrog scheme, a common choice in atmospheric models, and its well-known computational mode. By deriving and analyzing the scheme's amplification matrix , you will gain insight into how numerical artifacts arise and are controlled, in this case by the Robert–Asselin time filter.",
            "id": "4110695",
            "problem": "Consider the linearized nondivergent-free shallow-water system on a constant Coriolis parameter plane (an $f$-plane) in the vorticity–divergence formulation. Let $x$ and $y$ denote horizontal Cartesian coordinates, and let $t$ denote time. Define the vertical component of relative vorticity $\\zeta$, the horizontal divergence $\\delta$, and the geopotential $\\phi \\equiv g h$, where $g$ is gravitational acceleration and $h$ is the free-surface height anomaly. Assume a constant mean depth $H$, so that the phase speed satisfies $c \\equiv \\sqrt{g H}$. Linearizing around a state of rest and ignoring nonlinear advection, the governing equations in physical space are\n$$\n\\frac{\\partial \\zeta}{\\partial t} = - f_0 \\, \\delta,\n\\qquad\n\\frac{\\partial \\delta}{\\partial t} = f_0 \\, \\zeta - \\nabla^2 \\phi,\n\\qquad\n\\frac{\\partial \\phi}{\\partial t} = - c^2 \\, \\delta,\n$$\nwhere $f_0$ is the constant Coriolis parameter and $\\nabla^2$ is the horizontal Laplacian operator. For a single two-dimensional Fourier mode with horizontal wavenumber vector $\\boldsymbol{k} = (k_x,k_y)$ and magnitude $K \\equiv \\sqrt{k_x^2 + k_y^2}$, one has $\\nabla^2 \\phi = - K^2 \\phi$. Introducing the state vector $\\boldsymbol{X}(t) \\equiv [\\zeta(t), \\delta(t), \\phi(t)]^{\\top}$, the system can be written as a linear ordinary differential equation\n$$\n\\frac{d \\boldsymbol{X}}{dt} = \\mathbf{A} \\, \\boldsymbol{X},\n$$\nwith the $3 \\times 3$ matrix\n$$\n\\mathbf{A}(K,f_0,c) = \n\\begin{bmatrix}\n0 & -f_0 & 0 \\\\\nf_0 & 0 & K^2 \\\\\n0 & -c^2 & 0\n\\end{bmatrix}.\n$$\n\nYou will analyze the numerical stability, computational modes, and dissipation of the time discretization when the above linear system is advanced using the leapfrog scheme. The leapfrog time-stepping for time step $\\Delta t$ updates the state via\n$$\n\\boldsymbol{X}^{n+1} = \\boldsymbol{X}^{n-1} + 2 \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}.\n$$\nThe leapfrog scheme is known to admit an alternating-in-time parasitic solution called the computational mode. To control this, practitioners often apply the Robert–Asselin (RA) time filter after each leapfrog step, which modifies the middle time level according to\n$$\n\\boldsymbol{X}^{n} \\leftarrow \\boldsymbol{X}^{n} + \\varepsilon \\left( \\boldsymbol{X}^{n-1} - 2 \\boldsymbol{X}^{n} + \\boldsymbol{X}^{n+1} \\right),\n$$\nwhere $\\varepsilon \\in [0, 0.1]$ is the RA filter coefficient. For the purposes of this problem, one step of the filtered leapfrog map takes the augmented state $[\\boldsymbol{X}^{n}, \\boldsymbol{X}^{n-1}]^{\\top}$ to $[\\boldsymbol{X}^{n+1}, \\boldsymbol{X}^{n}]^{\\top}$, where $\\boldsymbol{X}^{n+1}$ is first computed by leapfrog and then the RA filter is applied to the middle time level $\\boldsymbol{X}^{n}$ as above.\n\nStarting from the continuous linear system and the definitions given, derive the discrete-time one-step amplification map for the augmented state, expressed as a $6 \\times 6$ matrix that depends on $\\Delta t$, $\\varepsilon$, and the physical parameters $(K,f_0,c)$. Using that amplification matrix, define:\n- The spectral radius $\\rho$, which is the maximum modulus among the eigenvalues of the amplification matrix, and which indicates linear stability for the one-step map if and only if $\\rho \\leq 1$.\n- The computational mode magnitude $m_{\\text{comp}}$, defined to be the modulus of the eigenvalue whose complex argument (angle) is closest to $\\pi$ (i.e., most nearly $-1$ on the real axis). This quantity measures the per-step damping of the alternating-in-time computational mode; values strictly less than $1$ indicate damping and values equal to $1$ indicate no damping.\n\nYour program must:\n1. Construct the $3 \\times 3$ matrix $\\mathbf{A}(K,f_0,c)$ from the given physical parameters for each test case.\n2. Construct the corresponding $6 \\times 6$ one-step amplification matrix for the filtered leapfrog discretization.\n3. Compute its eigenvalues, then compute the spectral radius $\\rho$ and the computational mode magnitude $m_{\\text{comp}}$ as defined above.\n4. Produce a single-line output that aggregates the results across all test cases, where for each test case you output the two floats $\\rho$ and $m_{\\text{comp}}$, in that order, rounded to six decimal places. The final output must be a single comma-separated list enclosed in square brackets and flattened across test cases as $[\\rho_1, m_{\\text{comp},1}, \\rho_2, m_{\\text{comp},2}, \\dots]$. Since both $\\rho$ and $m_{\\text{comp}}$ are dimensionless, no physical units are required in the output.\n\nUse the following scientifically realistic parameters for the test suite:\n- Gravitational acceleration $g = 9.81 \\, \\mathrm{m} \\, \\mathrm{s}^{-2}$, mean depth $H = 10^{4} \\, \\mathrm{m}$, so that $c \\equiv \\sqrt{g H}$.\n- Constant Coriolis parameter $f_0 = 10^{-4} \\, \\mathrm{s}^{-1}$.\n- Test cases specified by $(K, \\Delta t, \\varepsilon)$ as follows:\n    1. $(K = 10^{-6} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 600 \\, \\mathrm{s}, \\ \\varepsilon = 0.0)$\n    2. $(K = 10^{-5} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 300 \\, \\mathrm{s}, \\ \\varepsilon = 0.0)$\n    3. $(K = 10^{-5} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 400 \\, \\mathrm{s}, \\ \\varepsilon = 0.0)$\n    4. $(K = 0 \\, \\mathrm{m}^{-1}, \\ \\Delta t = 6000 \\, \\mathrm{s}, \\ \\varepsilon = 0.05)$\n    5. $(K = 10^{-5} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 300 \\, \\mathrm{s}, \\ \\varepsilon = 0.05)$\n\nYour program should produce a single line of output containing all $10$ rounded floats for the above five test cases, as a comma-separated list enclosed in square brackets (for example, $[\\rho_1,m_{\\text{comp},1},\\rho_2,m_{\\text{comp},2},\\dots]$).",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the well-established theory of geophysical fluid dynamics and numerical methods for partial differential equations. The problem is well-posed, objective, self-contained, and requires a non-trivial derivation and numerical computation, making it a suitable task for analysis.\n\nThe core of the problem is to derive the one-step amplification matrix for the filtered leapfrog scheme and use it to analyze the stability and damping properties of the numerical method. The state of the system is advanced using a two-level time scheme, which necessitates an augmented state vector for the one-step map analysis. Let the state at time step $n$ be represented by the augmented vector $\\boldsymbol{Y}^n = [\\boldsymbol{X}^n, \\boldsymbol{X}^{n-1}]^{\\top}$, where $\\boldsymbol{X}(t) \\equiv [\\zeta(t), \\delta(t), \\phi(t)]^{\\top}$ is the $3 \\times 1$ vector of physical variables. The goal is to find the $6 \\times 6$ amplification matrix $\\mathbf{G}$ such that $\\boldsymbol{Y}^{n+1} = \\mathbf{G} \\boldsymbol{Y}^n$.\n\nThe update from $\\boldsymbol{Y}^n$ to $\\boldsymbol{Y}^{n+1}$ is a two-stage process for each time step: a leapfrog update followed by a Robert–Asselin (RA) filter application.\n\n1.  **Leapfrog Step**: The state at time level $n+1$ is computed using the leapfrog scheme with time step $\\Delta t$ and the system matrix $\\mathbf{A}$:\n    $$\n    \\boldsymbol{X}^{n+1} = \\boldsymbol{X}^{n-1} + 2 \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}\n    $$\n    This equation gives the first component of the new state vector $\\boldsymbol{Y}^{n+1} = [\\boldsymbol{X}^{n+1}, \\boldsymbol{X}^{n}_{\\text{new}}]^{\\top}$. We can express this in terms of the components of $\\boldsymbol{Y}^n$:\n    $$\n    \\boldsymbol{X}^{n+1} = (2 \\Delta t \\, \\mathbf{A}) \\boldsymbol{X}^{n} + \\mathbf{I} \\, \\boldsymbol{X}^{n-1}\n    $$\n    where $\\mathbf{I}$ is the $3 \\times 3$ identity matrix.\n\n2.  **Robert–Asselin Filter Step**: After computing $\\boldsymbol{X}^{n+1}$, the RA filter is applied to update the state at the middle time level, $\\boldsymbol{X}^n$. The original state $\\boldsymbol{X}^n$ is replaced by a filtered version, which we denote $\\boldsymbol{X}^n_{\\text{new}}$:\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = \\boldsymbol{X}^{n} + \\varepsilon \\left( \\boldsymbol{X}^{n-1} - 2 \\boldsymbol{X}^{n} + \\boldsymbol{X}^{n+1} \\right)\n    $$\n    where $\\varepsilon$ is the filter coefficient. To express $\\boldsymbol{X}^n_{\\text{new}}$ in terms of the components of $\\boldsymbol{Y}^n$ only, we substitute the expression for $\\boldsymbol{X}^{n+1}$ from the leapfrog step into the filter equation:\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = \\boldsymbol{X}^{n} + \\varepsilon \\left( \\boldsymbol{X}^{n-1} - 2 \\boldsymbol{X}^{n} + (\\boldsymbol{X}^{n-1} + 2 \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}) \\right)\n    $$\n    Combining terms that multiply $\\boldsymbol{X}^n$ and $\\boldsymbol{X}^{n-1}$:\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = (\\boldsymbol{X}^{n} - 2\\varepsilon \\boldsymbol{X}^{n} + 2\\varepsilon \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}) + (\\varepsilon \\boldsymbol{X}^{n-1} + \\varepsilon \\boldsymbol{X}^{n-1})\n    $$\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = (\\mathbf{I} - 2\\varepsilon\\mathbf{I} + 2\\varepsilon \\Delta t \\, \\mathbf{A}) \\boldsymbol{X}^{n} + (2\\varepsilon\\mathbf{I}) \\boldsymbol{X}^{n-1}\n    $$\n    This is the second component of the new state vector $\\boldsymbol{Y}^{n+1}$.\n\nNow, we assemble the complete one-step map $\\boldsymbol{Y}^{n+1} = \\mathbf{G} \\boldsymbol{Y}^n$:\n$$\n\\begin{pmatrix} \\boldsymbol{X}^{n+1} \\\\ \\boldsymbol{X}^{n}_{\\text{new}} \\end{pmatrix}\n=\n\\mathbf{G}\n\\begin{pmatrix} \\boldsymbol{X}^{n} \\\\ \\boldsymbol{X}^{n-1} \\end{pmatrix}\n$$\nUsing the expressions derived above, we can write the $6 \\times 6$ amplification matrix $\\mathbf{G}$ in block matrix form:\n$$\n\\mathbf{G} = \\begin{pmatrix}\n2 \\Delta t \\, \\mathbf{A} & \\mathbf{I} \\\\\n(1 - 2\\varepsilon) \\mathbf{I} + 2\\varepsilon \\Delta t \\, \\mathbf{A} & 2\\varepsilon \\mathbf{I}\n\\end{pmatrix}\n$$\nwhere each block is a $3 \\times 3$ matrix.\n\nTo analyze the numerical properties of the scheme, we compute the eigenvalues, $\\lambda_j$ for $j=1, \\dots, 6$, of the amplification matrix $\\mathbf{G}$. These eigenvalues, also known as amplification factors, determine how different modes of the solution evolve over one time step.\n\n-   The **spectral radius** $\\rho$ is the maximum modulus among all eigenvalues:\n    $$\n    \\rho = \\max_{j} |\\lambda_j|\n    $$\n    The scheme is linearly stable if and only if $\\rho \\leq 1$. If $\\rho > 1$, at least one mode will grow exponentially, leading to numerical instability.\n\n-   The **computational mode magnitude** $m_{\\text{comp}}$ is defined as the modulus of the eigenvalue whose complex argument (angle) is closest to $\\pi$. The leapfrog scheme inherently introduces spurious computational modes that often oscillate with a period of $2\\Delta t$. In the complex plane, the amplification factor for such a mode is close to $-1$ (which has an argument of $\\pi$). The RA filter is designed to damp these modes, which corresponds to reducing the modulus of these specific eigenvalues to be less than $1$. Therefore, we identify the eigenvalue $\\lambda_k$ such that its argument $\\arg(\\lambda_k)$ minimizes $|\\arg(\\lambda) - \\pi|$ over all eigenvalues $\\lambda_j$, and define:\n    $$\n    m_{\\text{comp}} = |\\lambda_k|\n    $$\nA value of $m_{\\text{comp}} < 1$ indicates damping of the most prominent computational mode, while $m_{\\text{comp}} = 1$ indicates it is not damped.\n\nThe program will implement this procedure. For each test case, it constructs the physical matrix $\\mathbf{A}(K,f_0,c)$ and then the amplification matrix $\\mathbf{G}(\\Delta t, \\varepsilon, \\mathbf{A})$. It then computes the eigenvalues of $\\mathbf{G}$ and from them calculates $\\rho$ and $m_{\\text{comp}}$ according to their definitions.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the stability of the filtered leapfrog scheme for the linearized\n    shallow-water equations.\n    \"\"\"\n    # Define physical constants\n    g = 9.81  # Gravitational acceleration in m/s^2\n    H = 1e4   # Mean fluid depth in m\n    c = np.sqrt(g * H)  # Phase speed of gravity waves\n    f0 = 1e-4  # Constant Coriolis parameter in 1/s\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (K, dt, eps)\n    # K: Wavenumber magnitude (1/m)\n    # dt: Time step (s)\n    # eps: Robert-Asselin filter coefficient\n    test_cases = [\n        (1e-6, 600.0, 0.0),\n        (1e-5, 300.0, 0.0),\n        (1e-5, 400.0, 0.0),\n        (0.0, 6000.0, 0.05),\n        (1e-5, 300.0, 0.05),\n    ]\n\n    results = []\n    for K, dt, eps in test_cases:\n        # 1. Construct the 3x3 matrix A(K, f0, c)\n        A = np.array([\n            [0.0, -f0, 0.0],\n            [f0, 0.0, K**2],\n            [0.0, -c**2, 0.0]\n        ], dtype=float)\n\n        # 2. Construct the 6x6 one-step amplification matrix G\n        I3 = np.identity(3)\n        \n        # Define the four 3x3 blocks of G\n        G11 = 2.0 * dt * A\n        G12 = I3\n        G21 = (1.0 - 2.0 * eps) * I3 + 2.0 * eps * dt * A\n        G22 = 2.0 * eps * I3\n        \n        # Assemble G from its blocks\n        G = np.block([\n            [G11, G12],\n            [G21, G22]\n        ])\n\n        # 3. Compute eigenvalues of G\n        eigenvalues = np.linalg.eigvals(G)\n\n        # 4. Compute the spectral radius rho\n        rho = np.max(np.abs(eigenvalues))\n\n        # 5. Compute the computational mode magnitude m_comp\n        # This is the modulus of the eigenvalue whose angle is closest to pi.\n        angles = np.angle(eigenvalues)\n        pi = np.pi\n        \n        # Find the index of the eigenvalue with angle closest to pi\n        closest_idx = np.argmin(np.abs(angles - pi))\n        m_comp = np.abs(eigenvalues[closest_idx])\n        \n        results.append(rho)\n        results.append(m_comp)\n\n    # Final print statement in the exact required format.\n    # The output must be a single line with floats rounded to six decimal places.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}