{
    "hands_on_practices": [
        {
            "introduction": "本练习将散度这一抽象概念与一个具体且至关重要的气象变量——地面气压趋势——联系起来。通过从p坐标系下的基本质量连续性方程出发，您将推导出地面气压的预报方程。该实践旨在强化对散度的物理理解，即将其视为大气柱内质量辐合或辐散的度量，这是天气预报的基石之一。",
            "id": "4110689",
            "problem": "考虑一个在气压坐标系下建立的全球谱数值天气预报（NWP）模式，该模式使用涡度-散度表示法来推进预报变量，其中水平风 $\\mathbf{v}(p)$ 被分解为一个无辐散分量和一个无旋分量，水平散度为 $\\delta(p) \\equiv \\nabla \\cdot \\mathbf{v}(p)$。假设静力平衡，并使用气压坐标系下的质量连续性方程以及一个物理上现实的顶部边界条件。在某一特定位置和时间，模式诊断出一个垂直变化的水平散度，由 $\\delta(p) = \\delta_{0}\\left(\\frac{p}{p_{s}}\\right)^{2}$ 给出（$0 \\leq p \\leq p_{s}$），其中 $p_{s}$ 是地面气压。设模式顶边界位于 $p=0$ 处，且 $\\omega(0)=0$，其中 $\\omega \\equiv \\mathrm{D}p/\\mathrm{D}t$ 是物质（拉格朗日）气压趋势。局地地面风为 $\\mathbf{v}_{s} = (u_{s}, v_{s})$，局地地面气压的水平梯度为 $\\nabla p_{s} = \\left(\\frac{\\partial p_{s}}{\\partial x}, \\frac{\\partial p_{s}}{\\partial y}\\right)$。\n\n从第一性原理出发，推导一个关于瞬时局地地面气压趋势 $\\frac{\\partial p_{s}}{\\partial t}$ 的表达式，该表达式用 $\\delta(p)$ 的垂直积分和 $\\mathbf{v}_{s} \\cdot \\nabla p_{s}$ 来表示。然后使用以下数值计算这个趋势：$\\delta_{0} = 2.0 \\times 10^{-7}\\ \\mathrm{s}^{-1}$，$p_{s} = 9.92 \\times 10^{4}\\ \\mathrm{Pa}$，$\\mathbf{v}_{s} = (12\\ \\mathrm{m}\\ \\mathrm{s}^{-1},\\ -5\\ \\mathrm{m}\\ \\mathrm{s}^{-1})$，以及 $\\nabla p_{s} = \\left(-2.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1},\\ 0.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1}\\right)$。\n\n将您的最终数值结果四舍五入至三位有效数字。以 $\\mathrm{Pa}\\ \\mathrm{s}^{-1}$ 为单位表示您的答案。最终答案只提供计算出的单个数值。",
            "solution": "用户要求我解决一个关于数值天气预报中地面气压趋势的问题。该问题被认为是有效的，因为它具有科学依据、提法明确且客观，提供了所有必要数据且物理上一致。我将开始解答，解答过程包括两个主要部分：首先，从第一性原理推导地面气压趋势方程；其次，使用给定数值计算该趋势。\n\n**第一部分：地面气压趋势方程的推导**\n\n推导始于气压坐标系 $(x, y, p)$ 中的质量连续性方程。在等压面上，该方程为：\n$$\n\\nabla_{p} \\cdot \\mathbf{v} + \\frac{\\partial \\omega}{\\partial p} = 0\n$$\n其中 $\\mathbf{v}(p)$ 是水平风矢量，$\\nabla_{p} \\cdot \\mathbf{v} \\equiv \\delta(p)$ 是水平散度，$\\omega \\equiv \\mathrm{D}p/\\mathrm{D}t$ 是物质（拉格朗日）气压趋势。该方程可改写为：\n$$\n\\frac{\\partial \\omega}{\\partial p} = -\\delta(p)\n$$\n为了求出在给定气压层上的 $\\omega$ 值，我们对该方程沿气压进行垂直积分。我们从模式顶部（指定为 $p = 0$）积分到任意气压层 $p'$：\n$$\n\\int_{0}^{p'} \\frac{\\partial \\omega}{\\partial p''} dp'' = - \\int_{0}^{p'} \\delta(p'') dp''\n$$\n应用微积分基本定理，我们得到：\n$$\n\\omega(p') - \\omega(0) = - \\int_{0}^{p'} \\delta(p'') dp''\n$$\n问题陈述了一个物理上现实的顶部边界条件，$\\omega(0) = 0$。该条件表示没有质量通量穿过大气层顶部。代入此条件，得到任意气压层 $p'$ 处的 $\\omega$ 表达式：\n$$\n\\omega(p') = - \\int_{0}^{p'} \\delta(p'') dp''\n$$\n我们关心的是地面的情况，那里的气压是 $p_s$。将上述表达式在 $p' = p_s$ 处求值，得到地面的气压坐标系垂直速度 $\\omega_s$：\n$$\n\\omega_s = \\omega(p_s) = - \\int_{0}^{p_s} \\delta(p) dp\n$$\n请注意，为了记法方便，积分变量已从 $p''$ 重命名为 $p$。\n\n接下来，我们需要将 $\\omega_s$ 与局地地面气压趋势 $\\frac{\\partial p_s}{\\partial t}$ 联系起来。地面气压 $p_s(x,y,t)$ 是一个定义在二维水平面上的场。根据定义，位于地面的流体质点的物质导数是 $\\omega_s$。它与局地（欧拉）时间导数以及地面风 $\\mathbf{v}_s$ 对气压场的平流关系如下：\n$$\n\\omega_s = \\frac{\\mathrm{D}p}{\\mathrm{D}t}\\bigg|_{s} = \\frac{\\partial p_s}{\\partial t} + \\mathbf{v}_s \\cdot \\nabla p_s\n$$\n这个关系假设了一个平坦的下边界，这是隐含的，因为没有提到地形。重排此方程求解局地地面气压趋势，得到：\n$$\n\\frac{\\partial p_s}{\\partial t} = \\omega_s - \\mathbf{v}_s \\cdot \\nabla p_s\n$$\n最后，我们将 $\\omega_s$ 的积分表达式代入此方程，以获得用散度的垂直积分和地面平流项表示的瞬时局地地面气压趋势的所需表达式：\n$$\n\\frac{\\partial p_s}{\\partial t} = - \\int_{0}^{p_s} \\delta(p) dp - \\mathbf{v}_s \\cdot \\nabla p_s\n$$\n这就完成了问题第一部分要求的推导。\n\n**第二部分：地面气压趋势的计算**\n\n现在我们使用给定的散度函数形式和指定的数值来计算这个表达式。\n\n散度廓线由 $\\delta(p) = \\delta_{0}\\left(\\frac{p}{p_{s}}\\right)^{2}$ 给出。首先，我们计算积分项：\n$$\n\\int_{0}^{p_s} \\delta(p) dp = \\int_{0}^{p_s} \\delta_{0}\\left(\\frac{p}{p_{s}}\\right)^{2} dp = \\frac{\\delta_0}{p_s^2} \\int_{0}^{p_s} p^2 dp\n$$\n$$\n= \\frac{\\delta_0}{p_s^2} \\left[ \\frac{p^3}{3} \\right]_0^{p_s} = \\frac{\\delta_0}{p_s^2} \\left( \\frac{p_s^3}{3} - 0 \\right) = \\frac{\\delta_0 p_s}{3}\n$$\n所以，地面气压趋势方程变为：\n$$\n\\frac{\\partial p_s}{\\partial t} = - \\frac{\\delta_0 p_s}{3} - \\mathbf{v}_s \\cdot \\nabla p_s\n$$\n接下来，我们使用所提供的数值计算右侧的两项：\n$\\delta_{0} = 2.0 \\times 10^{-7}\\ \\mathrm{s}^{-1}$\n$p_{s} = 9.92 \\times 10^{4}\\ \\mathrm{Pa}$\n$\\mathbf{v}_{s} = (12\\ \\mathrm{m}\\ \\mathrm{s}^{-1},\\ -5\\ \\mathrm{m}\\ \\mathrm{s}^{-1})$\n$\\nabla p_{s} = \\left(-2.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1},\\ 0.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1}\\right)$\n\n1.  **散度项贡献**：\n    $$\n    - \\frac{\\delta_0 p_s}{3} = - \\frac{(2.0 \\times 10^{-7}\\ \\mathrm{s}^{-1}) (9.92 \\times 10^{4}\\ \\mathrm{Pa})}{3} = - \\frac{1.984 \\times 10^{-2}}{3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} \\approx -6.6133 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n    $$\n2.  **平流项贡献**：我们首先计算点积 $\\mathbf{v}_s \\cdot \\nabla p_s$：\n    $$\n    \\mathbf{v}_s \\cdot \\nabla p_s = (12\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(-2.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1}) + (-5\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(0.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{m}^{-1})\n    $$\n    $$\n    = -24.0 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} - 2.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} = -26.5 \\times 10^{-4}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} = -2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n    $$\n    对趋势的贡献是 $-(\\mathbf{v}_s \\cdot \\nabla p_s)$，即 $-(-2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}) = 2.65 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}$。\n\n最后，我们将这两项贡献相加，求得总的局地地面气压趋势：\n$$\n\\frac{\\partial p_s}{\\partial t} = (-6.6133\\dots \\times 10^{-3}) - (-2.65 \\times 10^{-3})\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n$$\n$$\n\\frac{\\partial p_s}{\\partial t} = (-6.6133\\dots + 2.65) \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1} = -3.9633\\dots \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n$$\n问题要求结果四舍五入到三位有效数字。\n$$\n\\frac{\\partial p_s}{\\partial t} \\approx -3.96 \\times 10^{-3}\\ \\mathrm{Pa}\\ \\mathrm{s}^{-1}\n$$",
            "answer": "$$\\boxed{-3.96 \\times 10^{-3}}$$"
        },
        {
            "introduction": "数值模型在离散网格上对连续的微分方程进行近似，而离散化的选择会显著影响其准确性。本问题聚焦于广泛使用的交错网格——Arakawa C-网格，并要求您实现关键的离散算子。通过这项编码练习，您将获得关于速度势和流函数如何在离散框架中与速度分量、散度和涡度相关联的实践经验，从而揭示在不同数值算子之间保持一致性的精妙之处。",
            "id": "4110685",
            "problem": "考虑一个在Arakawa C-网格上离散化的二维水平流，该网格用于数值天气预报和气候模拟。设区域为双周期性，边长分别为 $L_x$ 和 $L_y$，并分别离散为 $N_x$ 和 $N_y$ 个网格单元，均匀间距为 $d_x$ 和 $d_y$，满足 $L_x = N_x d_x$ 和 $L_y = N_y d_y$。网格中心坐标为 $x_i = (i + 0.5) d_x$ 和 $y_j = (j + 0.5) d_y$，其中整数索引 $i \\in \\{0,\\dots,N_x-1\\}$ 和 $j \\in \\{0,\\dots,N_y-1\\}$。Arakawa C-网格的交错布局将纬向风分量放置在垂直于 $x$ 方向的网格面上，将经向风分量放置在垂直于 $y$ 方向的网格面上。具体来说，$u$ 位于位置 $(i+0.5,j)$，$v$ 位于位置 $(i,j+0.5)$，其中索引指的是相邻的网格中心。\n\n从使用网格中心标量势的速度场涡度-散度公式出发，离散速度分量定义如下\n$$\nu_{i+\\frac{1}{2},j} = \\frac{\\phi_{i+1,j} - \\phi_{i,j}}{d_x} - \\frac{\\psi_{i,j+1} - \\psi_{i,j}}{d_y},\n\\quad\nv_{i,j+\\frac{1}{2}} = \\frac{\\phi_{i,j+1} - \\phi_{i,j}}{d_y} + \\frac{\\psi_{i+1,j} - \\psi_{i,j}}{d_x},\n$$\n其中 $\\phi_{i,j}$ 和 $\\psi_{i,j}$ 是定义在网格中心的标量场，所有索引都进行周期性处理（例如，$\\phi_{N_x,j} \\equiv \\phi_{0,j}$ 且 $\\phi_{i,N_y} \\equiv \\phi_{i,0}$）。\n\n通过有限体积平衡在网格中心定义离散散度\n$$\n\\mathcal{D}_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{d_x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{d_y},\n$$\n并通过面法向速度的离散旋度在网格中心定义离散垂直涡度\n$$\n\\zeta_{i,j} = \\frac{v_{i+1,j+\\frac{1}{2}} - v_{i,j+\\frac{1}{2}}}{d_x} - \\frac{u_{i+\\frac{1}{2},j+1} - u_{i+\\frac{1}{2},j}}{d_y}.\n$$\n设网格中心的离散拉普拉斯算子通过二阶中心差分逐分量作用，\n$$\n(\\nabla^2 \\phi)_{i,j} = \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{d_x^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{d_y^2},\n$$\n$(\\nabla^2 \\psi)_{i,j}$ 也类似。\n\n您的任务是在周期性Arakawa C-网格上实现这些离散算子，并为一组解析测试场评估其一致性。对于每个测试，通过在网格中心采样具有整数波数的光滑三角函数来构造 $\\phi_{i,j}$ 和 $\\psi_{i,j}$，以确保精确的周期性。具体来说，对于给定的整数 $k_x^\\phi$、$k_y^\\phi$、$k_x^\\psi$ 和 $k_y^\\psi$，定义\n$$\n\\phi_{i,j} = \\sin\\!\\left(2\\pi \\frac{k_x^\\phi x_i}{L_x}\\right) \\cos\\!\\left(2\\pi \\frac{k_y^\\phi y_j}{L_y}\\right),\n\\quad\n\\psi_{i,j} = \\cos\\!\\left(2\\pi \\frac{k_x^\\psi x_i}{L_x}\\right) \\sin\\!\\left(2\\pi \\frac{k_y^\\psi y_j}{L_y}\\right),\n$$\n其中角度以弧度为单位。\n\n使用环绕方式（例如，通过循环移位）实现周期性索引，以便所有差分算子在边界上都能一致地计算。对于每个测试用例，计算：\n- 所有网格中心上离散散度 $\\mathcal{D}_{i,j}$ 和离散拉普拉斯算子 $(\\nabla^2 \\phi)_{i,j}$ 之间的最大绝对偏差，以浮点数形式报告。\n- 所有网格中心上离散涡度 $\\zeta_{i,j}$ 和离散拉普拉斯算子 $(\\nabla^2 \\psi)_{i,j}$ 之间的最大绝对偏差，以浮点数形式报告。\n\n设计您的程序以评估以下测试套件，该套件涵盖了一般情况、网格间距的各向异性以及小网格边缘情况。所有长度单位为米，三角函数中的角度单位为弧度。\n\n测试套件：\n1. $N_x = 16$, $N_y = 12$, $d_x = 1.0$, $d_y = 1.0$, $k_x^\\phi = 1$, $k_y^\\phi = 2$, $k_x^\\psi = 3$, $k_y^\\psi = 1$。\n2. $N_x = 12$, $N_y = 8$, $d_x = 1.0$, $d_y = 2.0$, $k_x^\\phi = 3$, $k_y^\\phi = 2$, $k_x^\\psi = 2$, $k_y^\\psi = 3$。\n3. $N_x = 4$, $N_y = 4$, $d_x = 1.5$, $d_y = 1.0$, $k_x^\\phi = 1$, $k_y^\\phi = 1$, $k_x^\\psi = 1$, $k_y^\\psi = 1$。\n\n您的程序应生成一行输出，其中包含六个浮点数结果，顺序为测试用例1、2和3的（散度误差，涡度误差），并聚合成一个用方括号括起来的逗号分隔列表（例如，$[e_{11},e_{12},e_{21},e_{22},e_{31},e_{32}]$）。所有输出必须是无单位的浮点数。",
            "solution": "该问题要求我们在一个二维、双周期的Arakawa C-网格上验证特定离散算子的一致性。具体而言，我们需要比较速度场的离散散度 $\\mathcal{D}$ 与速度势 $\\phi$ 的离散拉普拉斯算子，以及离散涡度 $\\zeta$ 与流函数 $\\psi$ 的离散拉普拉斯算子。速度场分量 $u$ 和 $v$ 本身是根据指定的有限差分公式由 $\\phi$ 和 $\\psi$ 推导出来的。\n\n首先，让我们建立数学和计算框架。区域维度为 $L_x \\times L_y$，并被离散化为 $N_x \\times N_y$ 个大小为 $d_x \\times d_y$ 的网格单元，其中 $L_x = N_x d_x$ 且 $L_y = N_y d_y$。标量场，如速度势 $\\phi$ 和流函数 $\\psi$，定义在网格中心，坐标为 $(x_i, y_j) = ((i + 0.5)d_x, (j + 0.5)d_y)$，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 且 $j \\in \\{0, \\dots, N_y-1\\}$。\n\nArakawa C-网格对速度分量进行了交错布局。纬向速度 $u$ 位于网格单元的垂直面上，在连续坐标意义上处于位置 $(i+0.5, j)$，但在计算上，我们方便地将其与网格索引 $(i,j)$ 相关联，表示单元 $(i,j)$ 和 $(i+1,j)$ 之间面上的速度，我们记作 $u_{i+1/2,j}$。类似地，经向速度 $v$ 位于水平面上，记作 $v_{i,j+1/2}$。\n\n问题将速度分量定义为势的函数：\n$$\nu_{i+\\frac{1}{2},j} = \\frac{\\phi_{i+1,j} - \\phi_{i,j}}{d_x} - \\frac{\\psi_{i,j+1} - \\psi_{i,j}}{d_y}\n$$\n$$\nv_{i,j+\\frac{1}{2}} = \\frac{\\phi_{i,j+1} - \\phi_{i,j}}{d_y} + \\frac{\\psi_{i+1,j} - \\psi_{i,j}}{d_x}\n$$\n严格遵守这些定义至关重要。\n\n离散散度 $\\mathcal{D}$ 和涡度 $\\zeta$ 定义在网格中心 $(i,j)$：\n$$\n\\mathcal{D}_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{d_x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{d_y}\n$$\n$$\n\\zeta_{i,j} = \\frac{v_{i+1,j+\\frac{1}{2}} - v_{i,j+\\frac{1}{2}}}{d_x} - \\frac{u_{i+\\frac{1}{2},j+1} - u_{i+\\frac{1}{2},j}}{d_y}\n$$\n$\\zeta_{i,j}$ 的定义值得注意。右侧的有限差分天然地中心化在网格点 $(i+1/2, j+1/2)$，即网格单元 $(i,j)$ 的角点。问题将网格中心的涡度 $\\zeta_{i,j}$ 定义为等于此角点值。\n\n最后，离散拉普拉斯算子 $\\nabla^2$ 由笛卡尔网格的标准五点模板给出：\n$$\n(\\nabla^2 \\phi)_{i,j} = \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{d_x^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{d_y^2}\n$$\n\n任务的核心是计算 $\\mathcal{D}_{i,j}$ 与 $(\\nabla^2 \\phi)_{i,j}$ 之间，以及 $\\zeta_{i,j}$ 与 $(\\nabla^2 \\psi)_{i,j}$ 之间的最大绝对偏差。在连续情况下，$\\phi$ 的梯度的散度是 $\\nabla^2 \\phi$，速度场旋转部分的旋度产生 $\\nabla^2 \\psi$。该问题测试了这些恒等式在给定的特定离散化下的保持情况。仔细的代数替换表明，对于给定的特定离散算子，这些恒等式是精确保持的。因此，我们的实现必须计算这些偏差，其数量级应在机器精度之内。\n\n对于每个测试用例，实现将按以下步骤进行：\n1.  构建网格中心坐标 $(x_{i,j}, y_{i,j})$ 的二维网格。\n2.  使用提供的三角函数评估标量势场 $\\phi_{i,j}$ 和 $\\psi_{i,j}$。整数波数确保了在离散网格上的完美周期性。\n3.  计算离散拉普拉斯场 $(\\nabla^2 \\phi)_{i,j}$ 和 $(\\nabla^2 \\psi)_{i,j}$。所有周期性索引都通过循环移位处理，`numpy.roll` 非常适合此目的。例如，在一个第一维对应于 $i$ 索引的矩阵上，$\\phi_{i+1,j}$ 可通过 `numpy.roll(phi, -1, axis=0)` 实现。\n4.  根据定义，从 $\\phi$ 和 $\\psi$ 计算交错速度场 $u_{i+1/2,j}$ 和 $v_{i,j+1/2}$，同样使用 `numpy.roll` 获取移位后的场值。\n5.  从速度场计算网格中心的散度 $\\mathcal{D}_{i,j}$ 和涡度 $\\zeta_{i,j}$。\n6.  通过计算整个网格上的最大绝对差来计算偏差：$E_\\mathcal{D} = \\max_{i,j} |\\mathcal{D}_{i,j} - (\\nabla^2 \\phi)_{i,j}|$ 和 $E_\\zeta = \\max_{i,j} |\\zeta_{i,j} - (\\nabla^2 \\psi)_{i,j}|$。这两个浮点数值是每个测试用例所需的输出。\n\n此过程将被封装在一个函数中，并应用于测试套件中的每组参数。结果将被聚合并格式化为指定的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_discrepancies(Nx, Ny, dx, dy, kx_phi, ky_phi, kx_psi, ky_psi):\n    \"\"\"\n    Computes operator discrepancies on a periodic Arakawa C-grid for a given test case.\n    \n    Args:\n        Nx, Ny (int): Grid dimensions.\n        dx, dy (float): Grid spacings.\n        kx_phi, ky_phi (int): Wavenumbers for the phi field.\n        kx_psi, ky_psi (int): Wavenumbers for the psi field.\n\n    Returns:\n        tuple[float, float]: A tuple containing the divergence discrepancy and the\n                             vorticity discrepancy.\n    \"\"\"\n    # 1. Grid and coordinate setup\n    Lx = Nx * dx\n    Ly = Ny * dy\n    i_indices = np.arange(Nx)\n    j_indices = np.arange(Ny)\n    ii, jj = np.meshgrid(i_indices, j_indices, indexing='ij')\n\n    x = (ii + 0.5) * dx\n    y = (jj + 0.5) * dy\n\n    # 2. Construct potential fields phi and psi at cell centers\n    phi = np.sin(2 * np.pi * kx_phi * x / Lx) * np.cos(2 * np.pi * ky_phi * y / Ly)\n    psi = np.cos(2 * np.pi * kx_psi * x / Lx) * np.sin(2 * np.pi * ky_psi * y / Ly)\n\n    # 3. Compute discrete Laplacians of phi and psi\n    # Helper for periodic shifts\n    def laplacian(field, dx, dy):\n        f_ip1 = np.roll(field, -1, axis=0)\n        f_im1 = np.roll(field, 1, axis=0)\n        f_jp1 = np.roll(field, -1, axis=1)\n        f_jm1 = np.roll(field, 1, axis=1)\n        lap_x = (f_ip1 - 2 * field + f_im1) / (dx**2)\n        lap_y = (f_jp1 - 2 * field + f_jm1) / (dy**2)\n        return lap_x + lap_y\n\n    lap_phi = laplacian(phi, dx, dy)\n    lap_psi = laplacian(psi, dx, dy)\n\n    # 4. Compute velocity components u and v\n    # These are computed on staggered locations but stored in cell-centered arrays.\n    # u[i,j] corresponds to u_{i+1/2, j}\n    # v[i,j] corresponds to v_{i, j+1/2}\n    phi_ip1 = np.roll(phi, -1, axis=0)\n    psi_ip1 = np.roll(psi, -1, axis=0)\n    phi_jp1 = np.roll(phi, -1, axis=1)\n    psi_jp1 = np.roll(psi, -1, axis=1)\n    \n    u = (phi_ip1 - phi) / dx - (psi_jp1 - psi) / dy\n    v = (phi_jp1 - phi) / dy + (psi_ip1 - psi) / dx\n\n    # 5. Compute discrete divergence D at cell centers\n    u_im1 = np.roll(u, 1, axis=0)\n    v_jm1 = np.roll(v, 1, axis=1)\n    div_D = (u - u_im1) / dx + (v - v_jm1) / dy\n\n    # 6. Compute discrete vorticity zeta at cell centers\n    # According to the problem, zeta_{i,j} is defined using values that\n    # are naturally centered at (i+1/2, j+1/2).\n    v_ip1 = np.roll(v, -1, axis=0)\n    u_jp1 = np.roll(u, -1, axis=1)\n    zeta = (v_ip1 - v) / dx - (u_jp1 - u) / dy\n\n    # 7. Compute maximum absolute discrepancies\n    div_error = np.max(np.abs(div_D - lap_phi))\n    vort_error = np.max(np.abs(zeta - lap_psi))\n\n    return div_error, vort_error\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, dx, dy, kx_phi, ky_phi, kx_psi, ky_psi)\n        (16, 12, 1.0, 1.0, 1, 2, 3, 1),\n        (12, 8, 1.0, 2.0, 3, 2, 2, 3),\n        (4, 4, 1.5, 1.0, 1, 1, 1, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        div_discrepancy, vort_discrepancy = calculate_discrepancies(*case)\n        results.append(div_discrepancy)\n        results.append(vort_discrepancy)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "时间积分方案的稳定性对于大气模型的长期模拟至关重要。这项高级实践将引导您对蛙跳格式进行稳定性分析，该方法以其准确性而闻名，但也因引入非物理的计算模而著称。通过推导结合了Robert–Asselin滤波器的积分格式的放大矩阵，您将学会如何定量评估一个方案的稳定性及其对虚假振荡的阻尼效果，这是模型开发和诊断的一项关键技能。",
            "id": "4110695",
            "problem": "考虑在恒定科里奥利参数平面（一个 $f$ 平面）上，以涡度-散度形式表示的线性化浅水系统。令 $x$ 和 $y$ 表示水平笛卡尔坐标，$t$ 表示时间。定义相对涡度的垂直分量 $\\zeta$、水平散度 $\\delta$ 和位势 $\\phi \\equiv g h$，其中 $g$ 是重力加速度，$h$ 是自由表面高度异常。假设平均深度 $H$ 为常数，因此相速度满足 $c \\equiv \\sqrt{g H}$。围绕静止状态进行线性化并忽略非线性平流，物理空间中的控制方程为\n$$\n\\frac{\\partial \\zeta}{\\partial t} = - f_0 \\, \\delta,\n\\qquad\n\\frac{\\partial \\delta}{\\partial t} = f_0 \\, \\zeta - \\nabla^2 \\phi,\n\\qquad\n\\frac{\\partial \\phi}{\\partial t} = - c^2 \\, \\delta,\n$$\n其中 $f_0$ 是恒定的科里奥利参数，$\\nabla^2$ 是水平拉普拉斯算子。对于具有水平波数矢量 $\\boldsymbol{k} = (k_x,k_y)$ 和大小 $K \\equiv \\sqrt{k_x^2 + k_y^2}$ 的单个二维傅里叶模，我们有 $\\nabla^2 \\phi = - K^2 \\phi$。引入状态向量 $\\boldsymbol{X}(t) \\equiv [\\zeta(t), \\delta(t), \\phi(t)]^{\\top}$，该系统可以写成一个线性常微分方程\n$$\n\\frac{d \\boldsymbol{X}}{dt} = \\mathbf{A} \\, \\boldsymbol{X},\n$$\n其中 $3 \\times 3$ 矩阵为\n$$\n\\mathbf{A}(K,f_0,c) = \n\\begin{bmatrix}\n0 & -f_0 & 0 \\\\\nf_0 & 0 & K^2 \\\\\n0 & -c^2 & 0\n\\end{bmatrix}.\n$$\n\n您将分析当上述线性系统使用蛙跳格式进行时间推进时，该时间离散化方案的数值稳定性、计算模和耗散。对于时间步长 $\\Delta t$，蛙跳时间步进通过以下方式更新状态：\n$$\n\\boldsymbol{X}^{n+1} = \\boldsymbol{X}^{n-1} + 2 \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}.\n$$\n已知蛙跳格式会产生一种随时间交替出现的寄生解，称为计算模。为控制此问题，实践中常在每个蛙跳步之后应用 Robert–Asselin (RA) 时间滤波器，该滤波器根据以下公式修改中间时间层的状态：\n$$\n\\boldsymbol{X}^{n} \\leftarrow \\boldsymbol{X}^{n} + \\varepsilon \\left( \\boldsymbol{X}^{n-1} - 2 \\boldsymbol{X}^{n} + \\boldsymbol{X}^{n+1} \\right),\n$$\n其中 $\\varepsilon \\in [0, 0.1]$ 是 RA 滤波器系数。在本问题中，滤波蛙跳映射的一个步骤将增广状态 $[\\boldsymbol{X}^{n}, \\boldsymbol{X}^{n-1}]^{\\top}$ 变换为 $[\\boldsymbol{X}^{n+1}, \\boldsymbol{X}^{n}]^{\\top}$，其中 $\\boldsymbol{X}^{n+1}$ 首先通过蛙跳格式计算，然后如上所述将 RA 滤波器应用于中间时间层 $\\boldsymbol{X}^{n}$。\n\n从给定的连续线性系统和定义出发，推导增广状态的离散时间单步放大映射，并将其表示为一个依赖于 $\\Delta t$、$\\varepsilon$ 及物理参数 $(K,f_0,c)$ 的 $6 \\times 6$ 矩阵。使用该放大矩阵，定义：\n- 谱半径 $\\rho$，即放大矩阵所有特征值中的最大模，当且仅当 $\\rho \\leq 1$ 时，它表示单步映射是线性稳定的。\n- 计算模大小 $m_{\\text{comp}}$，定义为复宗量（角）最接近 $\\pi$（即在实轴上最接近 $-1$）的特征值的模。该量度量了随时间交替的计算模的每步阻尼；值严格小于 $1$ 表示有阻尼，等于 $1$ 表示无阻尼。\n\n您的程序必须：\n1. 对于每个测试用例，根据给定的物理参数构建 $3 \\times 3$ 矩阵 $\\mathbf{A}(K,f_0,c)$。\n2. 为滤波蛙跳离散化构建相应的 $6 \\times 6$ 单步放大矩阵。\n3. 计算其特征值，然后按照上述定义计算谱半径 $\\rho$ 和计算模大小 $m_{\\text{comp}}$。\n4. 生成单行输出，汇总所有测试用例的结果。对于每个测试用例，按顺序输出两个浮点数 $\\rho$ 和 $m_{\\text{comp}}$，并四舍五入到六位小数。最终输出必须是一个用方括号括起来的、跨测试用例展平的逗号分隔列表，格式为 $[\\rho_1, m_{\\text{comp},1}, \\rho_2, m_{\\text{comp},2}, \\dots]$。由于 $\\rho$ 和 $m_{\\text{comp}}$ 均为无量纲量，输出中无需包含物理单位。\n\n为测试套件使用以下科学上符合实际的参数：\n- 重力加速度 $g = 9.81 \\, \\mathrm{m} \\, \\mathrm{s}^{-2}$，平均深度 $H = 10^{4} \\, \\mathrm{m}$，因此 $c \\equiv \\sqrt{g H}$。\n- 恒定科里奥利参数 $f_0 = 10^{-4} \\, \\mathrm{s}^{-1}$。\n- 由 $(K, \\Delta t, \\varepsilon)$ 指定的测试用例如下：\n    1. $(K = 10^{-6} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 600 \\, \\mathrm{s}, \\ \\varepsilon = 0.0)$\n    2. $(K = 10^{-5} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 300 \\, \\mathrm{s}, \\ \\varepsilon = 0.0)$\n    3. $(K = 10^{-5} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 400 \\, \\mathrm{s}, \\ \\varepsilon = 0.0)$\n    4. $(K = 0 \\, \\mathrm{m}^{-1}, \\ \\Delta t = 6000 \\, \\mathrm{s}, \\ \\varepsilon = 0.05)$\n    5. $(K = 10^{-5} \\, \\mathrm{m}^{-1}, \\ \\Delta t = 300 \\, \\mathrm{s}, \\ \\varepsilon = 0.05)$\n\n您的程序应为上述五个测试用例生成一行输出，其中包含所有 10 个四舍五入后的浮点数，格式为用方括号括起来的逗号分隔列表（例如，$[\\rho_1,m_{\\text{comp},1},\\rho_2,m_{\\text{comp},2},\\dots]$）。",
            "solution": "此问题经评估有效。它基于地球物理流体动力学和偏微分方程数值方法的成熟理论，具有科学依据。该问题是适定的、客观的、内容完整的，并且需要进行不平凡的推导和数值计算，使其成为一项适合分析的任务。\n\n问题的核心是推导滤波蛙跳格式的单步放大矩阵，并用其分析该数值方法的稳定性和阻尼特性。系统状态使用两层时间格式进行推进，这需要使用增广状态向量进行单步映射分析。设时间步 $n$ 的状态由增广向量 $\\boldsymbol{Y}^n = [\\boldsymbol{X}^n, \\boldsymbol{X}^{n-1}]^{\\top}$ 表示，其中 $\\boldsymbol{X}(t) \\equiv [\\zeta(t), \\delta(t), \\phi(t)]^{\\top}$ 是物理变量的 $3 \\times 1$ 向量。目标是找到一个 $6 \\times 6$ 的放大矩阵 $\\mathbf{G}$，使得 $\\boldsymbol{Y}^{n+1} = \\mathbf{G} \\boldsymbol{Y}^n$。\n\n对于每个时间步，从 $\\boldsymbol{Y}^n$ 到 $\\boldsymbol{Y}^{n+1}$ 的更新是一个两阶段过程：先进行蛙跳更新，然后应用 Robert–Asselin (RA) 滤波器。\n\n1.  **蛙跳步**：时间层 $n+1$ 的状态使用蛙跳格式、时间步长 $\\Delta t$ 和系统矩阵 $\\mathbf{A}$ 计算：\n    $$\n    \\boldsymbol{X}^{n+1} = \\boldsymbol{X}^{n-1} + 2 \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}\n    $$\n    此方程给出了新状态向量 $\\boldsymbol{Y}^{n+1} = [\\boldsymbol{X}^{n+1}, \\boldsymbol{X}^{n}_{\\text{new}}]^{\\top}$ 的第一个分量。我们可以用 $\\boldsymbol{Y}^n$ 的分量来表示它：\n    $$\n    \\boldsymbol{X}^{n+1} = (2 \\Delta t \\, \\mathbf{A}) \\boldsymbol{X}^{n} + \\mathbf{I} \\, \\boldsymbol{X}^{n-1}\n    $$\n    其中 $\\mathbf{I}$ 是 $3 \\times 3$ 单位矩阵。\n\n2.  **Robert–Asselin 滤波器步**：计算出 $\\boldsymbol{X}^{n+1}$ 后，应用 RA 滤波器来更新中间时间层 $\\boldsymbol{X}^n$ 的状态。原始状态 $\\boldsymbol{X}^n$ 被一个滤波后的版本替代，我们将其表示为 $\\boldsymbol{X}^n_{\\text{new}}$：\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = \\boldsymbol{X}^{n} + \\varepsilon \\left( \\boldsymbol{X}^{n-1} - 2 \\boldsymbol{X}^{n} + \\boldsymbol{X}^{n+1} \\right)\n    $$\n    其中 $\\varepsilon$ 是滤波器系数。为了仅用 $\\boldsymbol{Y}^n$ 的分量表示 $\\boldsymbol{X}^n_{\\text{new}}$，我们将蛙跳步得到的 $\\boldsymbol{X}^{n+1}$ 表达式代入滤波方程：\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = \\boldsymbol{X}^{n} + \\varepsilon \\left( \\boldsymbol{X}^{n-1} - 2 \\boldsymbol{X}^{n} + (\\boldsymbol{X}^{n-1} + 2 \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}) \\right)\n    $$\n    合并乘以 $\\boldsymbol{X}^n$ 和 $\\boldsymbol{X}^{n-1}$ 的项：\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = (\\boldsymbol{X}^{n} - 2\\varepsilon \\boldsymbol{X}^{n} + 2\\varepsilon \\Delta t \\, \\mathbf{A} \\, \\boldsymbol{X}^{n}) + (\\varepsilon \\boldsymbol{X}^{n-1} + \\varepsilon \\boldsymbol{X}^{n-1})\n    $$\n    $$\n    \\boldsymbol{X}^n_{\\text{new}} = (\\mathbf{I} - 2\\varepsilon\\mathbf{I} + 2\\varepsilon \\Delta t \\, \\mathbf{A}) \\boldsymbol{X}^{n} + (2\\varepsilon\\mathbf{I}) \\boldsymbol{X}^{n-1}\n    $$\n    这是新状态向量 $\\boldsymbol{Y}^{n+1}$ 的第二个分量。\n\n现在，我们组装完整的单步映射 $\\boldsymbol{Y}^{n+1} = \\mathbf{G} \\boldsymbol{Y}^n$：\n$$\n\\begin{pmatrix} \\boldsymbol{X}^{n+1} \\\\ \\boldsymbol{X}^{n}_{\\text{new}} \\end{pmatrix}\n=\n\\mathbf{G}\n\\begin{pmatrix} \\boldsymbol{X}^{n} \\\\ \\boldsymbol{X}^{n-1} \\end{pmatrix}\n$$\n使用上面推导的表达式，我们可以将 $6 \\times 6$ 的放大矩阵 $\\mathbf{G}$ 写成分块矩阵的形式：\n$$\n\\mathbf{G} = \\begin{pmatrix}\n2 \\Delta t \\, \\mathbf{A} & \\mathbf{I} \\\\\n(1 - 2\\varepsilon) \\mathbf{I} + 2\\varepsilon \\Delta t \\, \\mathbf{A} & 2\\varepsilon \\mathbf{I}\n\\end{pmatrix}\n$$\n其中每个分块都是一个 $3 \\times 3$ 矩阵。\n\n为了分析该格式的数值特性，我们计算放大矩阵 $\\mathbf{G}$ 的特征值 $\\lambda_j$（$j=1, \\dots, 6$）。这些特征值，也称为放大因子，决定了解决方案的不同模态在单个时间步内的演化方式。\n\n-   **谱半径** $\\rho$ 是所有特征值中的最大模：\n    $$\n    \\rho = \\max_{j} |\\lambda_j|\n    $$\n    当且仅当 $\\rho \\leq 1$ 时，该格式是线性稳定的。如果 $\\rho > 1$，至少会有一个模态呈指数增长，导致数值不稳定性。\n\n-   **计算模大小** $m_{\\text{comp}}$ 定义为复宗量（角）最接近 $\\pi$ 的特征值的模。蛙跳格式内在地会引入虚假的计算模，这些计算模通常以 $2\\Delta t$ 的周期振荡。在复平面上，这种模态的放大因子接近 $-1$（其宗量为 $\\pi$）。RA 滤波器的设计目的就是为了阻尼这些模态，这对应于将这些特定特征值的模减小到小于 $1$。因此，我们找出特征值 $\\lambda_k$，使其宗量 $\\arg(\\lambda_k)$ 在所有特征值 $\\lambda_j$ 中最小化 $|\\arg(\\lambda) - \\pi|$，并定义：\n    $$\n    m_{\\text{comp}} = |\\lambda_k|\n    $$\n$m_{\\text{comp}}  1$ 的值表示最显著的计算模被阻尼，而 $m_{\\text{comp}} = 1$ 表示它未被阻尼。\n\n程序将实现此过程。对于每个测试用例，它会构建物理矩阵 $\\mathbf{A}(K,f_0,c)$，然后构建放大矩阵 $\\mathbf{G}(\\Delta t, \\varepsilon, \\mathbf{A})$。接着，它计算 $\\mathbf{G}$ 的特征值，并根据其定义计算 $\\rho$ 和 $m_{\\text{comp}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the stability of the filtered leapfrog scheme for the linearized\n    shallow-water equations.\n    \"\"\"\n    # Define physical constants\n    g = 9.81  # Gravitational acceleration in m/s^2\n    H = 1e4   # Mean fluid depth in m\n    c = np.sqrt(g * H)  # Phase speed of gravity waves\n    f0 = 1e-4  # Constant Coriolis parameter in 1/s\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (K, dt, eps)\n    # K: Wavenumber magnitude (1/m)\n    # dt: Time step (s)\n    # eps: Robert-Asselin filter coefficient\n    test_cases = [\n        (1e-6, 600.0, 0.0),\n        (1e-5, 300.0, 0.0),\n        (1e-5, 400.0, 0.0),\n        (0.0, 6000.0, 0.05),\n        (1e-5, 300.0, 0.05),\n    ]\n\n    results = []\n    for K, dt, eps in test_cases:\n        # 1. Construct the 3x3 matrix A(K, f0, c)\n        A = np.array([\n            [0.0, -f0, 0.0],\n            [f0, 0.0, K**2],\n            [0.0, -c**2, 0.0]\n        ], dtype=float)\n\n        # 2. Construct the 6x6 one-step amplification matrix G\n        I3 = np.identity(3)\n        \n        # Define the four 3x3 blocks of G\n        G11 = 2.0 * dt * A\n        G12 = I3\n        G21 = (1.0 - 2.0 * eps) * I3 + 2.0 * eps * dt * A\n        G22 = 2.0 * eps * I3\n        \n        # Assemble G from its blocks\n        G = np.block([\n            [G11, G12],\n            [G21, G22]\n        ])\n\n        # 3. Compute eigenvalues of G\n        eigenvalues = np.linalg.eigvals(G)\n\n        # 4. Compute the spectral radius rho\n        rho = np.max(np.abs(eigenvalues))\n\n        # 5. Compute the computational mode magnitude m_comp\n        # This is the modulus of the eigenvalue whose angle is closest to pi.\n        angles = np.angle(eigenvalues)\n        pi = np.pi\n        \n        # Find the index of the eigenvalue with angle closest to pi\n        closest_idx = np.argmin(np.abs(angles - pi))\n        m_comp = np.abs(eigenvalues[closest_idx])\n        \n        results.append(rho)\n        results.append(m_comp)\n\n    # Final print statement in the exact required format.\n    # The output must be a single line with floats rounded to six decimal places.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}