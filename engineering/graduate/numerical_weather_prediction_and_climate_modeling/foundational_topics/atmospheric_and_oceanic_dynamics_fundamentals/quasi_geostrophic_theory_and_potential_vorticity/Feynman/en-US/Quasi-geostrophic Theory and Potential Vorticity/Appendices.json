{
    "hands_on_practices": [
        {
            "introduction": "We begin with the cornerstone of Quasi-Geostrophic (QG) theory: geostrophic balance, the leading-order equilibrium between the Coriolis force and the pressure gradient force. This practice guides you through deriving the geostrophic wind, $\\mathbf{u}_g$, from first principles, providing a direct link between the pressure field and the large-scale flow. By applying this balance to a hypothetical scenario , you will solidify your understanding of the primary force balance governing the large-scale atmosphere.",
            "id": "4080239",
            "problem": "Consider large-scale midlatitude flow described by the horizontal momentum equations in a uniformly rotating frame with constant Coriolis parameter, and assume a hydrostatic, Boussinesq, and frictionless regime consistent with Quasi-Geostrophic (QG) scaling. Starting from the rotating-frame horizontal momentum equations and using a small Rossby number asymptotic argument to identify the leading-order balance appropriate to QG, derive the expression for the geostrophic wind vector in terms of the horizontal pressure gradient, the Coriolis parameter, and the density. Then, use your derived expression to compute two quantities: (i) the geostrophic wind speed magnitude, and (ii) the angle, in radians, between the geostrophic wind vector and the local isobar tangent at the same point. For definiteness, take the Coriolis parameter to be positive (Northern Hemisphere).\n\nGiven data:\n- $f = 10^{-4}\\,\\mathrm{s^{-1}}$,\n- $\\|\\nabla_h p\\| = 1\\,\\mathrm{Pa\\,m^{-1}}$,\n- $\\rho = 1\\,\\mathrm{kg\\,m^{-3}}$.\n\nInstructions:\n- Express the speed in $\\mathrm{m\\, s^{-1}}$ and round it to three significant figures.\n- Express the angle in radians and report its exact value.\n- Use the convention that the “angle between the geostrophic wind vector and the local isobar tangent” is the smallest nonnegative angle in $[0,\\pi]$ between the wind direction and a unit tangent vector to the isobar passing through the point. Your final answer must be given as a two-entry row matrix containing first the speed and then the angle.",
            "solution": "The problem requires the derivation of the geostrophic wind vector from first principles under the quasi-geostrophic (QG) approximation, followed by the calculation of its magnitude and its orientation relative to an isobar.\n\nFirst, we validate the problem statement.\n\n### Step 1: Extract Givens\n- Flow regime: Large-scale midlatitude flow, uniformly rotating frame, hydrostatic, Boussinesq, frictionless.\n- Scaling: Quasi-Geostrophic (QG) scaling, implying a small Rossby number.\n- Governing equations: Rotating-frame horizontal momentum equations.\n- Derivation task: Derive the expression for the geostrophic wind vector $\\mathbf{u}_g$ in terms of the horizontal pressure gradient $\\nabla_h p$, the Coriolis parameter $f$, and the density $\\rho$.\n- Calculation task: Compute (i) the geostrophic wind speed magnitude $V_g = \\|\\mathbf{u}_g\\|$ and (ii) the angle between $\\mathbf{u}_g$ and the local isobar tangent.\n- Conditions: Coriolis parameter is positive (Northern Hemisphere), $f > 0$.\n- Constants and Data:\n  - $f = 10^{-4}\\,\\mathrm{s^{-1}}$\n  - $\\|\\nabla_{h} p\\| = 1\\,\\mathrm{Pa\\, m^{-1}}$\n  - $\\rho = 1\\,\\mathrm{kg\\, m^{-3}}$\n- Output requirements:\n  - Speed in $\\mathrm{m\\, s^{-1}}$, rounded to three significant figures.\n  - Angle in radians, exact value.\n  - The angle is defined as the smallest nonnegative angle in $[0,\\pi]$ between the wind vector and a unit tangent to the isobar.\n  - The final answer is a two-entry row matrix.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded. It presents a standard derivation and application problem in geophysical fluid dynamics. The QG framework, geostrophic balance, and the concepts of isobars and pressure gradients are fundamental to meteorology and oceanography. The given physical constants, while leading to a high wind speed due to the large pressure gradient, are not physically impossible or inconsistent. Specifically, a pressure gradient of $1\\,\\mathrm{Pa\\,m^{-1}}$ is very large for synoptic scale weather but is a valid parameter for a formal problem. The problem is well-posed, with a clear objective and sufficient information to arrive at a unique solution. The language is precise and objective. All terms are standard within the field. Therefore, the problem is deemed valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. We proceed with the solution.\n\nThe horizontal momentum equation in a frame rotating with angular velocity $\\mathbf{\\Omega}$ can be written for a fluid parcel as:\n$$\n\\frac{D\\mathbf{u}}{Dt} + 2\\mathbf{\\Omega} \\times \\mathbf{u} = -\\frac{1}{\\rho}\\nabla p + \\mathbf{g} + \\mathbf{F}_r\n$$\nwhere $\\mathbf{u}$ is the velocity vector in the rotating frame, $D/Dt$ is the material derivative, $\\rho$ is the density, $p$ is the pressure, $\\mathbf{g}$ is the true gravitational acceleration, and $\\mathbf{F}_r$ represents frictional forces.\n\nIn the context of large-scale atmospheric dynamics, we use a local Cartesian coordinate system on a tangential plane, with $x$ eastward, $y$ northward, and $z$ upward. The vector $\\mathbf{k}$ is the local vertical unit vector. The Coriolis parameter is $f = 2\\Omega\\sin\\phi$, where $\\phi$ is the latitude. The horizontal component of the momentum equation is:\n$$\n\\frac{D\\mathbf{u}_h}{Dt} + f\\mathbf{k} \\times \\mathbf{u}_h + \\text{other Coriolis terms} = -\\frac{1}{\\rho}\\nabla_h p + \\mathbf{F}_{r,h}\n$$\nwhere $\\mathbf{u}_h = u\\mathbf{i} + v\\mathbf{j}$ is the horizontal velocity, and $\\nabla_h = \\mathbf{i}\\frac{\\partial}{\\partial x} + \\mathbf{j}\\frac{\\partial}{\\partial y}$ is the horizontal gradient operator. The \"other Coriolis terms\" involving the vertical velocity are neglected under the shallow-fluid approximation, which is consistent with QG theory.\n\nThe problem specifies a frictionless regime, so $\\mathbf{F}_{r,h} = \\mathbf{0}$. The Boussinesq approximation allows us to treat $\\rho$ as a constant (equal to a reference density $\\rho_0$) in the momentum equation, except where it is coupled with gravity in the buoyancy term. For the horizontal momentum equations, $\\rho$ is taken as a constant.\n\nThe fundamental assumption of QG theory is that the Rossby number $Ro = U/(fL)$ is small, where $U$ and $L$ are characteristic velocity and length scales. This implies that the advective term $\\mathbf{u}_h \\cdot \\nabla_h \\mathbf{u}_h$ is much smaller than the Coriolis term $f\\mathbf{k} \\times \\mathbf{u}_h$. For large-scale, slowly evolving flows, the local time derivative $\\partial \\mathbf{u}_h / \\partial t$ is also small. Thus, the material derivative term $D\\mathbf{u}_h/Dt$ is negligible compared to the Coriolis and pressure gradient terms.\n\nThis \"small Rossby number asymptotic argument\" leads to the leading-order balance, known as the geostrophic balance, where the Coriolis force exactly balances the pressure gradient force. Denoting the wind in this balance as the geostrophic wind, $\\mathbf{u}_g$, we have:\n$$\nf\\mathbf{k} \\times \\mathbf{u}_g = -\\frac{1}{\\rho}\\nabla_h p\n$$\nTo solve for the geostrophic wind vector $\\mathbf{u}_g$, we can take the cross product of this equation with the vertical unit vector $\\mathbf{k}$:\n$$\n\\mathbf{k} \\times (f\\mathbf{k} \\times \\mathbf{u}_g) = \\mathbf{k} \\times \\left(-\\frac{1}{\\rho}\\nabla_h p\\right)\n$$\nUsing the vector triple product identity $\\mathbf{a} \\times (\\mathbf{b} \\times \\mathbf{c}) = \\mathbf{b}(\\mathbf{a} \\cdot \\mathbf{c}) - \\mathbf{c}(\\mathbf{a} \\cdot \\mathbf{b})$, with $\\mathbf{a}=\\mathbf{k}$, $\\mathbf{b}=f\\mathbf{k}$, and $\\mathbf{c}=\\mathbf{u}_g$:\n$$\nf[\\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{u}_g) - \\mathbf{u}_g(\\mathbf{k} \\cdot \\mathbf{k})] = -\\frac{1}{\\rho}(\\mathbf{k} \\times \\nabla_h p)\n$$\nSince $\\mathbf{u}_g$ is a horizontal wind, it is perpendicular to the vertical vector $\\mathbf{k}$, so their dot product is zero: $\\mathbf{k} \\cdot \\mathbf{u}_g = 0$. Also, since $\\mathbf{k}$ is a unit vector, $\\mathbf{k} \\cdot \\mathbf{k} = 1$. Substituting these into the equation yields:\n$$\nf[ \\mathbf{k}(0) - \\mathbf{u}_g(1) ] = -\\frac{1}{\\rho}(\\mathbf{k} \\times \\nabla_h p)\n$$\n$$\n-f\\mathbf{u}_g = -\\frac{1}{\\rho}(\\mathbf{k} \\times \\nabla_h p)\n$$\nSolving for $\\mathbf{u}_g$, we obtain the expression for the geostrophic wind vector:\n$$\n\\mathbf{u}_g = \\frac{1}{\\rho f}(\\mathbf{k} \\times \\nabla_h p)\n$$\nThis completes the derivation.\n\nNext, we compute the two required quantities.\n\n**(i) Geostrophic wind speed magnitude**\n\nThe speed $V_g$ is the magnitude of the vector $\\mathbf{u}_g$:\n$$\nV_g = \\|\\mathbf{u}_g\\| = \\left\\| \\frac{1}{\\rho f}(\\mathbf{k} \\times \\nabla_h p) \\right\\| = \\frac{1}{|\\rho f|} \\|\\mathbf{k} \\times \\nabla_h p\\|\n$$\nThe problem states $f0$ (Northern Hemisphere) and density $\\rho$ is inherently positive, so $|\\rho f| = \\rho f$. The magnitude of the cross product of two vectors is the product of their magnitudes times the sine of the angle between them. The vector $\\mathbf{k}$ is vertical, and the vector $\\nabla_h p$ is horizontal. Therefore, they are perpendicular, and the angle between them is $\\frac{\\pi}{2}$.\n$$\n\\|\\mathbf{k} \\times \\nabla_h p\\| = \\|\\mathbf{k}\\| \\|\\nabla_h p\\| \\sin\\left(\\frac{\\pi}{2}\\right) = (1) \\cdot \\|\\nabla_h p\\| \\cdot (1) = \\|\\nabla_h p\\|\n$$\nThus, the geostrophic wind speed is given by:\n$$\nV_g = \\frac{\\|\\nabla_h p\\|}{\\rho f}\n$$\nSubstituting the given numerical values:\n- $\\|\\nabla_h p\\| = 1\\,\\mathrm{Pa\\, m^{-1}}$\n- $\\rho = 1\\,\\mathrm{kg\\, m^{-3}}$\n- $f = 10^{-4}\\,\\mathrm{s^{-1}}$\n$$\nV_g = \\frac{1\\,\\mathrm{Pa\\, m^{-1}}}{(1\\,\\mathrm{kg\\, m^{-3}})(10^{-4}\\,\\mathrm{s^{-1}})} = \\frac{1}{10^{-4}} \\,\\mathrm{m\\,s^{-1}} = 10000\\,\\mathrm{m\\,s^{-1}}\n$$\nWe are instructed to round this to three significant figures. In scientific notation, this is $1.00 \\times 10^4\\,\\mathrm{m\\,s^{-1}}$. It is noted that this speed is physically extreme, a direct consequence of the large magnitude specified for the pressure gradient.\n\n**(ii) Angle between the geostrophic wind and the isobar tangent**\n\nAn isobar is a line of constant pressure, $p(x,y) = C$. The gradient vector $\\nabla_h p$ is, by definition, normal (perpendicular) to the level sets of the function $p$, which are the isobars. Let $\\mathbf{t}$ be a unit vector tangent to the isobar at a given point. By geometric definition, the tangent to a level curve is perpendicular to the gradient at that point. Thus, $\\mathbf{t} \\cdot \\nabla_h p = 0$.\n\nFrom the derived expression for the geostrophic wind, $\\mathbf{u}_g = \\frac{1}{\\rho f}(\\mathbf{k} \\times \\nabla_h p)$, we can examine its relationship with the pressure gradient $\\nabla_h p$. The vector $\\mathbf{k} \\times \\nabla_h p$ is, by the properties of the cross product, perpendicular to both $\\mathbf{k}$ and $\\nabla_h p$. Therefore, $\\mathbf{u}_g$ is perpendicular to $\\nabla_h p$. We can verify this with the dot product:\n$$\n\\mathbf{u}_g \\cdot \\nabla_h p = \\left( \\frac{1}{\\rho f}(\\mathbf{k} \\times \\nabla_h p) \\right) \\cdot \\nabla_h p = 0\n$$\nSince both the isobar tangent vector $\\mathbf{t}$ and the geostrophic wind vector $\\mathbf{u}_g$ lie in the horizontal plane and are both perpendicular to the same non-zero vector $\\nabla_h p$, they must be collinear (i.e., they lie along the same line). This means the angle between $\\mathbf{u}_g$ and $\\mathbf{t}$ is either $0$ or $\\pi$ radians.\n\nThe problem asks for the \"smallest nonnegative angle in $[0, \\pi]$\". Since geostrophic wind is parallel to the isobars, we can always choose a tangent vector direction that aligns with the wind direction. The angle between the wind vector and this choice of tangent vector is $0$. The angle with the opposite tangent vector would be $\\pi$. The smallest of these is $0$. Therefore, the required angle is $0$ radians. This is a fundamental property of geostrophic flow: it blows parallel to the isobars.\n\nThe final answer consists of the speed rounded to three significant figures and the exact angle in radians, presented as a two-entry row matrix.\nSpeed: $1.00 \\times 10^4\\,\\mathrm{m\\,s^{-1}}$\nAngle: $0$ rad",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.00 \\times 10^4  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Building upon geostrophic balance, we now explore how the flow varies in the vertical, connecting dynamics to thermodynamics. This exercise involves deriving the thermal wind equation, which links the vertical wind shear, $\\frac{\\partial \\mathbf{u}_g}{\\partial z}$, to the horizontal gradient of potential temperature, $\\nabla_h \\theta$. This practice  is crucial for understanding the baroclinic structure of mid-latitude weather systems.",
            "id": "4080212",
            "problem": "Consider a midlatitude flow that satisfies the quasi-geostrophic (QG) approximations on an $f$-plane, with constant Coriolis parameter $f_0$. Assume the atmosphere is in geostrophic balance and hydrostatic balance, and obeys the ideal gas law. The potential temperature $\\theta$ is defined by $\\theta = T \\left( \\frac{p_0}{p} \\right)^{R/c_p}$, where $T$ is temperature, $p$ is pressure, $p_0$ is a fixed reference pressure, $R$ is the specific gas constant for dry air, and $c_p$ is the specific heat at constant pressure. The horizontal gradient operator is $\\nabla_h$, and $\\mathbf{k}$ is the vertical unit vector.\n\nStarting from the fundamental balances and definitions stated above, derive the relationship that links the vertical shear of the geostrophic wind, $\\frac{\\partial \\mathbf{u}_g}{\\partial z}$, to the horizontal gradient of potential temperature, $\\nabla_h \\theta$, at a constant pressure level. Then, use this relationship to estimate the magnitude of the horizontal gradient of potential temperature, $\\|\\nabla_h \\theta\\|$, given the following values:\n- $f_0 = 10^{-4}\\,\\mathrm{s^{-1}}$,\n- $\\left\\|\\frac{\\partial \\mathbf{u}_g}{\\partial z}\\right\\| = 1.0 \\times 10^{-2}\\,\\mathrm{s^{-1}}$,\n- $\\theta_0 = 300\\,\\mathrm{K}$,\n- $g = 9.81\\,\\mathrm{m\\,s^{-2}}$,\n\nwhere $\\theta_0$ is a representative mean potential temperature for the layer of interest, and you may approximate $\\theta \\approx \\theta_0$ for the purpose of estimating the magnitude. Express your final answer for $\\|\\nabla_h \\theta\\|$ in $\\mathrm{K\\,m^{-1}}$ and round your result to four significant figures.",
            "solution": "The problem requires the derivation of the thermal wind relationship in terms of potential temperature and its subsequent application to estimate a horizontal potential temperature gradient. This derivation will be based on the fundamental principles of geostrophic balance, hydrostatic balance, the ideal gas law, and the definition of potential temperature, all given in the problem statement.\n\nFirst, the fundamental equations are stated in a convenient coordinate system. Since the derivation involves gradients on constant pressure surfaces, it is most natural to work in pressure coordinates $(x, y, p)$.\n\nThe geostrophic wind, $\\mathbf{u}_g$, is defined by the balance between the Coriolis force and the pressure gradient force. In pressure coordinates, this relationship is expressed in terms of the geopotential, $\\Phi = gz$, where $g$ is the acceleration due to gravity and $z$ is the geopotential height:\n$$ f_0 \\mathbf{k} \\times \\mathbf{u}_g = -\\nabla_p \\Phi $$\nHere, $f_0$ is the constant Coriolis parameter, $\\mathbf{k}$ is the vertical unit vector, and $\\nabla_p$ is the horizontal gradient operator on a constant pressure surface.\n\nThe hydrostatic balance equation is $\\frac{\\partial p}{\\partial z} = -\\rho g$, where $\\rho$ is the density. In pressure coordinates, this is more conveniently expressed by relating the change in geopotential to the change in pressure:\n$$ \\frac{\\partial \\Phi}{\\partial p} = \\frac{\\partial(gz)}{\\partial p} = g \\frac{\\partial z}{\\partial p} = g \\left( \\frac{\\partial p}{\\partial z} \\right)^{-1} = g \\left( -\\rho g \\right)^{-1} = -\\frac{1}{\\rho} $$\n\nThe ideal gas law is given by $p = \\rho R T$, where $R$ is the specific gas constant and $T$ is the temperature. This can be written as $\\frac{1}{\\rho} = \\frac{RT}{p}$. Substituting this into the hydrostatic equation yields:\n$$ \\frac{\\partial \\Phi}{\\partial p} = -\\frac{RT}{p} $$\n\nTo find the vertical shear of the geostrophic wind, we differentiate the geostrophic balance equation with respect to pressure $p$:\n$$ \\frac{\\partial}{\\partial p} (f_0 \\mathbf{k} \\times \\mathbf{u}_g) = -\\frac{\\partial}{\\partial p}(\\nabla_p \\Phi) $$\nSince $f_0$ is constant and the differential operators commute, this becomes:\n$$ f_0 \\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial p} = -\\nabla_p \\left( \\frac{\\partial \\Phi}{\\partial p} \\right) $$\nSubstituting the hydrostatic relation for $\\frac{\\partial \\Phi}{\\partial p}$:\n$$ f_0 \\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial p} = -\\nabla_p \\left( -\\frac{RT}{p} \\right) = \\nabla_p \\left( \\frac{RT}{p} \\right) $$\nOn a constant pressure surface, $p$ is constant with respect to the horizontal gradient operator $\\nabla_p$, so:\n$$ f_0 \\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial p} = \\frac{R}{p} \\nabla_p T $$\nThis is the thermal wind equation in terms of temperature $T$. The problem requires it in terms of potential temperature $\\theta$.\n\nThe potential temperature $\\theta$ is defined as $\\theta = T \\left( \\frac{p_0}{p} \\right)^{\\kappa}$, where $\\kappa = R/c_p$. Taking the natural logarithm gives $\\ln \\theta = \\ln T - \\kappa \\ln p + \\kappa \\ln p_0$. Applying the $\\nabla_p$ operator to this expression:\n$$ \\nabla_p(\\ln \\theta) = \\nabla_p(\\ln T) - \\nabla_p(\\kappa \\ln p) + \\nabla_p(\\kappa \\ln p_0) $$\nSince $p$ and $p_0$ are constant with respect to $\\nabla_p$, their gradients are zero. Thus, we find the useful relation:\n$$ \\frac{1}{\\theta} \\nabla_p \\theta = \\frac{1}{T} \\nabla_p T \\quad \\implies \\quad \\nabla_p T = \\frac{T}{\\theta} \\nabla_p \\theta $$\nSubstituting this into the thermal wind equation for $T$:\n$$ f_0 \\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial p} = \\frac{R}{p} \\left( \\frac{T}{\\theta} \\nabla_p \\theta \\right) = \\frac{RT}{p\\theta} \\nabla_p \\theta $$\nUsing the ideal gas law, $p = \\rho R T \\implies \\frac{RT}{p} = \\frac{1}{\\rho}$, we can simplify the expression:\n$$ f_0 \\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial p} = \\frac{1}{\\rho \\theta} \\nabla_p \\theta $$\nThe problem asks for the vertical wind shear with respect to height $z$, $\\frac{\\partial \\mathbf{u}_g}{\\partial z}$. We convert the vertical derivative from $p$ to $z$ using the chain rule and the hydrostatic equation:\n$$ \\frac{\\partial \\mathbf{u}_g}{\\partial p} = \\frac{\\partial \\mathbf{u}_g}{\\partial z} \\frac{\\partial z}{\\partial p} = \\frac{\\partial \\mathbf{u}_g}{\\partial z} \\left( -\\frac{1}{\\rho g} \\right) $$\nSubstituting this into our equation:\n$$ f_0 \\mathbf{k} \\times \\left( -\\frac{1}{\\rho g} \\frac{\\partial \\mathbf{u}_g}{\\partial z} \\right) = \\frac{1}{\\rho \\theta} \\nabla_p \\theta $$\nThe density $\\rho$ cancels from both sides:\n$$ -\\frac{f_0}{g} \\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial z} = \\frac{1}{\\theta} \\nabla_p \\theta $$\nThe gradient $\\nabla_p \\theta$ is the horizontal gradient on a constant pressure surface, which is denoted as $\\nabla_h \\theta$ in the problem statement. To solve for $\\frac{\\partial \\mathbf{u}_g}{\\partial z}$, we first multiply by $-\\frac{g}{f_0}$:\n$$ \\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial z} = -\\frac{g}{f_0 \\theta} \\nabla_h \\theta $$\nApplying the cross product with $\\mathbf{k}$ to both sides and using the vector identity $\\mathbf{k} \\times (\\mathbf{k} \\times \\mathbf{A}) = -\\mathbf{A}$ for any horizontal vector $\\mathbf{A}$ (which $\\frac{\\partial \\mathbf{u}_g}{\\partial z}$ is):\n$$ \\mathbf{k} \\times \\left(\\mathbf{k} \\times \\frac{\\partial \\mathbf{u}_g}{\\partial z}\\right) = -\\frac{g}{f_0 \\theta} (\\mathbf{k} \\times \\nabla_h \\theta) $$\n$$ -\\frac{\\partial \\mathbf{u}_g}{\\partial z} = -\\frac{g}{f_0 \\theta} \\mathbf{k} \\times \\nabla_h \\theta $$\nThis yields the final derived relationship, the thermal wind equation in terms of potential temperature:\n$$ \\frac{\\partial \\mathbf{u}_g}{\\partial z} = \\frac{g}{f_0 \\theta} \\mathbf{k} \\times \\nabla_h \\theta $$\n\nFor the second part of the problem, we must estimate the magnitude of the horizontal potential temperature gradient, $\\|\\nabla_h \\theta\\|$. We take the magnitude of both sides of the derived vector equation:\n$$ \\left\\| \\frac{\\partial \\mathbf{u}_g}{\\partial z} \\right\\| = \\left\\| \\frac{g}{f_0 \\theta} \\mathbf{k} \\times \\nabla_h \\theta \\right\\| $$\nSince $g$, $f_0$, and $\\theta$ are positive scalars:\n$$ \\left\\| \\frac{\\partial \\mathbf{u}_g}{\\partial z} \\right\\| = \\frac{g}{f_0 \\theta} \\| \\mathbf{k} \\times \\nabla_h \\theta \\| $$\nThe magnitude of the cross product of the vertical unit vector $\\mathbf{k}$ and the horizontal gradient vector $\\nabla_h \\theta$ is $\\|\\mathbf{k}\\| \\|\\nabla_h \\theta\\| \\sin(\\frac{\\pi}{2}) = \\|\\nabla_h \\theta\\|$, as they are orthogonal. So, the equation becomes:\n$$ \\left\\| \\frac{\\partial \\mathbf{u}_g}{\\partial z} \\right\\| = \\frac{g}{f_0 \\theta} \\| \\nabla_h \\theta \\| $$\nWe are asked to use the approximation $\\theta \\approx \\theta_0$. Rearranging to solve for $\\|\\nabla_h \\theta\\|$:\n$$ \\| \\nabla_h \\theta \\| \\approx \\frac{f_0 \\theta_0}{g} \\left\\| \\frac{\\partial \\mathbf{u}_g}{\\partial z} \\right\\| $$\nSubstituting the given numerical values: $f_0 = 10^{-4}\\,\\mathrm{s^{-1}}$, $\\|\\frac{\\partial \\mathbf{u}_g}{\\partial z}\\| = 1.0 \\times 10^{-2}\\,\\mathrm{s^{-1}}$, $\\theta_0 = 300\\,\\mathrm{K}$, and $g = 9.81\\,\\mathrm{m\\,s^{-2}}$.\n$$ \\| \\nabla_h \\theta \\| \\approx \\frac{(10^{-4}) (300)}{9.81} (1.0 \\times 10^{-2}) $$\n$$ \\| \\nabla_h \\theta \\| \\approx \\frac{3 \\times 10^{-2}}{9.81} \\times 10^{-2} = \\frac{3}{9.81} \\times 10^{-4} $$\n$$ \\| \\nabla_h \\theta \\| \\approx 0.305810397... \\times 10^{-4} \\approx 3.05810397... \\times 10^{-5} $$\nThe units are $\\frac{(\\mathrm{s^{-1}})(\\mathrm{K})}{(\\mathrm{m\\,s^{-2}})} (\\mathrm{s^{-1}}) = \\mathrm{K\\,m^{-1}}$, as required.\nRounding the result to four significant figures gives $3.058 \\times 10^{-5}$.",
            "answer": "$$ \\boxed{3.058 \\times 10^{-5}} $$"
        },
        {
            "introduction": "The full power of QG theory is realized through potential vorticity, $q$, which acts as a master variable from which the entire balanced flow can be determined. This capstone practice challenges you to implement the PV inversion algorithm, solving the elliptic equation $\\nabla^2 \\psi - \\frac{1}{L_D^2}\\psi = q$ to recover the streamfunction $\\psi$ from a given PV distribution. By developing both spectral and finite-difference solvers , you will gain practical, hands-on experience with the computational techniques at the heart of atmospheric modeling.",
            "id": "4080242",
            "problem": "Consider a one-layer barotropic Quasi-Geostrophic (QG) model on a midlatitude beta-plane and its associated Potential Vorticity (PV) inversion problem. Let the geostrophic velocity be defined by the streamfunction $\\psi(x,y)$ through $u_g(x,y) = -\\frac{\\partial \\psi}{\\partial y}$ and $v_g(x,y) = \\frac{\\partial \\psi}{\\partial x}$. The relative vorticity is defined by $\\zeta(x,y) = \\frac{\\partial v_g}{\\partial x} - \\frac{\\partial u_g}{\\partial y}$. The quasi-geostrophic potential vorticity anomaly is related to the flow through the combination of relative vorticity and a baroclinic contribution parameterized by the barotropic deformation radius $L_D$ (in meters). Starting from these base definitions together with the hydrostatic balance and conservation of mass, derive the linear elliptic PV inversion relation that connects a given PV anomaly field $q(x,y)$ to the streamfunction $\\psi(x,y)$.\n\nThen, implement two numerical inversions for this PV inversion relation:\n\n1. A spectral inversion using the Fast Fourier Transform (FFT) on a doubly periodic domain, with periodic boundary conditions in both $x$ and $y$, and using Fourier wavenumbers appropriate for a domain of lengths $L_x$ and $L_y$ (in meters).\n2. A finite-difference inversion on a bounded rectangular domain with homogeneous Dirichlet boundary conditions $\\psi=0$ on all boundaries, using a standard five-point stencil discretization of the Laplacian on a uniform grid with spacings $\\Delta x$ and $\\Delta y$.\n\nFor all tests below, you must construct analytic “truth” fields $\\psi_{\\text{true}}(x,y)$ in units of $\\mathrm{m^2/s}$, compute the corresponding PV anomaly $q(x,y)$ in units of $\\mathrm{s^{-1}}$ using the derived inversion relation, perform the numerical inversion to obtain $\\psi_{\\text{num}}(x,y)$, and report the root-mean-square error (RMSE) $E = \\sqrt{\\langle(\\psi_{\\text{num}} - \\psi_{\\text{true}})^2\\rangle}$ in units of $\\mathrm{m^2/s}$, where $\\langle \\cdot \\rangle$ denotes the arithmetic mean over all grid points. For the spectral inversion on a periodic domain, use Fourier representations consistent with the domain lengths and ensure treatment of the zero-wavenumber mode is physically consistent. For the finite-difference inversion on a bounded domain, assemble and solve the discrete linear system for interior points under homogeneous Dirichlet boundary conditions using scientifically appropriate numerical linear algebra methods.\n\nYour program must execute the following test suite without user input and produce the specified outputs:\n\nTest case $\\mathrm{T1}$ (spectral, periodic Helmholtz):\n- Domain: $L_x = 10^6\\,\\mathrm{m}$, $L_y = 10^6\\,\\mathrm{m}$.\n- Grid: $N_x = 128$, $N_y = 128$ uniformly spaced points.\n- Deformation radius: $L_D = 2 \\times 10^5\\,\\mathrm{m}$.\n- Truth field: $\\psi_{\\text{true}}(x,y) = A \\cos\\left( \\frac{2\\pi n x}{L_x} \\right) \\cos\\left( \\frac{2\\pi m y}{L_y} \\right)$ with $A = 10^5\\,\\mathrm{m^2/s}$, $n = 3$, $m = 5$.\n- Compute $q(x,y)$ analytically from the derived PV inversion relation and invert spectrally to obtain $\\psi_{\\text{num}}$. Report the RMSE $E_1$ in $\\mathrm{m^2/s}$.\n\nTest case $\\mathrm{T2}$ (spectral, periodic Poisson limit):\n- Domain: $L_x = 10^6\\,\\mathrm{m}$, $L_y = 10^6\\,\\mathrm{m}$.\n- Grid: $N_x = 64$, $N_y = 64$ uniformly spaced points.\n- Deformation radius: $L_D \\rightarrow \\infty$ (i.e., the inverse square term is negligible).\n- Truth field: $\\psi_{\\text{true}}(x,y) = A \\cos\\left( \\frac{2\\pi n x}{L_x} \\right) \\cos\\left( \\frac{2\\pi m y}{L_y} \\right)$ with $A = 2 \\times 10^5\\,\\mathrm{m^2/s}$, $n = 1$, $m = 2$.\n- Compute $q(x,y)$ analytically in the Poisson limit and invert spectrally to obtain $\\psi_{\\text{num}}$. Report the RMSE $E_2$ in $\\mathrm{m^2/s}$.\n\nTest case $\\mathrm{T3}$ (finite difference, bounded Helmholtz):\n- Domain: $L_x = 10^6\\,\\mathrm{m}$, $L_y = 10^6\\,\\mathrm{m}$.\n- Grid: $N_x = 65$, $N_y = 65$ uniformly spaced points (including boundaries).\n- Deformation radius: $L_D = 2 \\times 10^5\\,\\mathrm{m}$.\n- Boundary conditions: homogeneous Dirichlet $\\psi=0$ on all boundaries.\n- Truth field: $\\psi_{\\text{true}}(x,y) = A \\sin\\left( \\frac{\\pi x}{L_x} \\right) \\sin\\left( \\frac{\\pi y}{L_y} \\right)$ with $A = 10^5\\,\\mathrm{m^2/s}$.\n- Compute $q(x,y)$ analytically from the derived PV inversion relation and invert using a five-point stencil to obtain $\\psi_{\\text{num}}$. Report the RMSE $E_3$ in $\\mathrm{m^2/s}$.\n\nTest case $\\mathrm{T4}$ (finite difference, bounded Poisson limit):\n- Domain: $L_x = 10^6\\,\\mathrm{m}$, $L_y = 10^6\\,\\mathrm{m}$.\n- Grid: $N_x = 65$, $N_y = 65$ uniformly spaced points (including boundaries).\n- Deformation radius: $L_D \\rightarrow \\infty$ (i.e., the inverse square term is negligible).\n- Boundary conditions: homogeneous Dirichlet $\\psi=0$ on all boundaries.\n- Truth field: $\\psi_{\\text{true}}(x,y) = A \\sin\\left( \\frac{\\pi x}{L_x} \\right) \\sin\\left( \\frac{\\pi y}{L_y} \\right)$ with $A = 10^5\\,\\mathrm{m^2/s}$.\n- Compute $q(x,y)$ analytically in the Poisson limit and invert using a five-point stencil to obtain $\\psi_{\\text{num}}$. Report the RMSE $E_4$ in $\\mathrm{m^2/s}$.\n\nTest case $\\mathrm{T5}$ (comparative periodic-and-bounded Helmholtz on a function compatible with both boundary types):\n- Domain: $L_x = 10^6\\,\\mathrm{m}$, $L_y = 10^6\\,\\mathrm{m}$.\n- Spectral grid: $N_x^{(s)} = 128$, $N_y^{(s)} = 128$ uniformly spaced points, periodic.\n- Finite-difference grid: $N_x^{(f)} = 129$, $N_y^{(f)} = 129$ uniformly spaced points (including boundaries), bounded with homogeneous Dirichlet conditions.\n- Deformation radius: $L_D = 3 \\times 10^5\\,\\mathrm{m}$.\n- Truth field: $\\psi_{\\text{true}}(x,y) = A \\sin\\left( \\frac{2\\pi x}{L_x} \\right) \\sin\\left( \\frac{2\\pi y}{L_y} \\right)$ with $A = 10^5\\,\\mathrm{m^2/s}$.\n- Compute $q(x,y)$ analytically, invert with both methods on their respective grids, compare RMSEs $E_s$ (spectral) and $E_f$ (finite difference), and report the ratio $R = E_s / E_f$ as a dimensionless float.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[E_1, E_2, E_3, E_4, R]$, with all entries as decimal floats. All RMSE values must be expressed in $\\mathrm{m^2/s}$ and the ratio $R$ must be dimensionless. Angles within trigonometric functions are in radians. No additional text should be printed.",
            "solution": "The problem requires the derivation of the quasi-geostrophic potential vorticity (PV) inversion relation and the implementation of two numerical methods to solve it, validated against a suite of test cases.\n\n### Part 1: Derivation of the PV Inversion Relation\n\nThe problem defines the geostrophic velocity components $(u_g, v_g)$ in terms of a streamfunction $\\psi(x,y)$:\n$$u_g(x,y) = -\\frac{\\partial \\psi}{\\partial y}$$\n$$v_g(x,y) = \\frac{\\partial \\psi}{\\partial x}$$\nThe relative vorticity, $\\zeta$, is the vertical component of the curl of the velocity field:\n$$\\zeta(x,y) = \\frac{\\partial v_g}{\\partial x} - \\frac{\\partial u_g}{\\partial y}$$\nSubstituting the definitions of $u_g$ and $v_g$ yields a direct relationship between relative vorticity and the streamfunction:\n$$\\zeta = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\psi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\psi}{\\partial y}\\right) = \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial y^2} = \\nabla^2 \\psi$$\nwhere $\\nabla^2$ is the horizontal Laplacian operator.\n\nThe quasi-geostrophic potential vorticity (QG PV) anomaly, $q$, for a one-layer (or reduced gravity, barotropic) model is defined as the sum of the relative vorticity anomaly and a vortex stretching term. The stretching term is proportional to the deviation of the fluid surface from its mean height, which, under the geostrophic and hydrostatic approximations, is proportional to the streamfunction $\\psi$. This relationship is parameterized by the barotropic Rossby radius of deformation, $L_D$. The standard definition is:\n$$q(x,y) = \\zeta(x,y) - \\frac{1}{L_D^2} \\psi(x,y)$$\nCombining the two expressions, we substitute $\\zeta = \\nabla^2 \\psi$ into the definition of $q$:\n$$q(x,y) = \\nabla^2 \\psi(x,y) - \\frac{1}{L_D^2} \\psi(x,y)$$\nThis is the linear elliptic partial differential equation that relates the PV anomaly field $q$ to the streamfunction $\\psi$. It is a Helmholtz equation. The process of finding $\\psi$ for a given $q$ is known as PV inversion.\n\nIn the limit where the deformation radius is very large, $L_D \\rightarrow \\infty$, the stretching term vanishes. This limit corresponds to a purely two-dimensional, non-divergent flow. The equation simplifies to the Poisson equation:\n$$q(x,y) = \\nabla^2 \\psi(x,y) \\quad (\\text{for } L_D \\rightarrow \\infty)$$\n\n### Part 2: Numerical Inversion Methods\n\nThe derived PV inversion relation is solved numerically using two distinct methods dictated by the boundary conditions.\n\n#### Method 1: Spectral Inversion on a Doubly Periodic Domain\n\nFor a domain that is periodic in both the $x$ and $y$ directions with lengths $L_x$ and $L_y$, Fourier methods are exceptionally efficient and accurate. We represent the fields $\\psi(x,y)$ and $q(x,y)$ by their discrete Fourier series:\n$$\\psi(x_j, y_k) = \\sum_{m,n} \\hat{\\psi}_{m,n} e^{i(k_m x_j + k_n y_k)}$$\n$$q(x_j, y_k) = \\sum_{m,n} \\hat{q}_{m,n} e^{i(k_m x_j + k_n y_k)}$$\nwhere $k_m = 2\\pi m / L_x$ and $k_n = 2\\pi n / L_y$ are the discrete wavenumbers. The key property of Fourier series is that differentiation becomes multiplication in spectral space. Specifically, the Laplacian operator $\\nabla^2$ transforms to multiplication by $-(k_m^2 + k_n^2)$.\n\nApplying the Fourier transform to the PV inversion equation gives:\n$$\\hat{q}_{m,n} = -(k_m^2 + k_n^2) \\hat{\\psi}_{m,n} - \\frac{1}{L_D^2} \\hat{\\psi}_{m,n} = -\\left(k_m^2 + k_n^2 + \\frac{1}{L_D^2}\\right) \\hat{\\psi}_{m,n}$$\nWe can solve for the spectral coefficients of the streamfunction, $\\hat{\\psi}_{m,n}$:\n$$\\hat{\\psi}_{m,n} = -\\frac{\\hat{q}_{m,n}}{k_m^2 + k_n^2 + 1/L_D^2}$$\nFor the zero-wavenumber mode ($m=0, n=0$), the physical streamfunction is arbitrary (it corresponds to a spatially constant pressure field which generates no flow). We can set $\\hat{\\psi}_{0,0} = 0$. This requires that the domain-averaged PV anomaly must also be zero, $\\hat{q}_{0,0}=0$, for the Poisson case ($L_D \\rightarrow \\infty$) to have a solution. The provided test cases with periodic functions have zero mean, satisfying this condition.\n\nThe numerical algorithm is as follows:\n1.  Compute the 2D Fast Fourier Transform (FFT) of the gridded PV anomaly field $q$ to obtain $\\hat{q}$.\n2.  On a grid of wavenumbers $(k_m, k_n)$, calculate the spectral coefficients $\\hat{\\psi}$ using the algebraic relation above. A division-by-zero for the $(0,0)$ wavenumber in the Poisson case is avoided by setting $\\hat{\\psi}_{0,0}=0$.\n3.  Compute the 2D inverse FFT of $\\hat{\\psi}$ to recover the gridded streamfunction field $\\psi_{\\text{num}}$.\n\n#### Method 2: Finite-Difference Inversion on a Bounded Domain\n\nFor a rectangular domain $[0, L_x] \\times [0, L_y]$ with specified boundary conditions, we use a finite-difference method. The domain is discretized into a uniform grid with $N_x \\times N_y$ points, with grid spacings $\\Delta x = L_x / (N_x-1)$ and $\\Delta y = L_y / (N_y-1)$. Let $\\psi_{i,j}$ denote the value of $\\psi$ at grid point $(x_i, y_j)$.\n\nThe Laplacian operator is approximated using a second-order accurate five-point stencil:\n$$\\nabla^2\\psi \\bigg|_{(i,j)} \\approx \\frac{\\psi_{i+1,j} - 2\\psi_{i,j} + \\psi_{i-1,j}}{(\\Delta x)^2} + \\frac{\\psi_{i,j+1} - 2\\psi_{i,j} + \\psi_{i,j-1}}{(\\Delta y)^2}$$\nSubstituting this into the PV inversion equation for each interior grid point ($1 \\le i \\le N_x-2$, $1 \\le j \\le N_y-2$) gives a system of linear algebraic equations:\n$$\\frac{\\psi_{i+1,j} + \\psi_{i-1,j}}{(\\Delta x)^2} + \\frac{\\psi_{i,j+1} + \\psi_{i,j-1}}{(\\Delta y)^2} - \\left(\\frac{2}{(\\Delta x)^2} + \\frac{2}{(\\Delta y)^2} + \\frac{1}{L_D^2}\\right)\\psi_{i,j} = q_{i,j}$$\nThe problem specifies homogeneous Dirichlet boundary conditions, $\\psi=0$ on all boundaries. This means $\\psi_{i,j}=0$ if $i=0, i=N_x-1, j=0,$ or $j=N_y-1$. These known values are incorporated into the equations for the interior points adjacent to the boundary.\n\nThis system of $(N_x-2) \\times (N_y-2)$ equations can be written in the matrix form $A\\mathbf{x} = \\mathbf{b}$, where:\n- $\\mathbf{x}$ is a vector of the unknown interior values $\\psi_{i,j}$, flattened into a 1D array of length $(N_x-2)(N_y-2)$.\n- $\\mathbf{b}$ is a vector of the known interior values $q_{i,j}$, similarly flattened.\n- $A$ is a large, sparse, block-tridiagonal matrix representing the discretized Helmholtz operator.\n\nThe numerical algorithm is:\n1.  Construct the sparse matrix $A$ representing the finite-difference operator for the interior grid points.\n2.  Construct the right-hand-side vector $\\mathbf{b}$ from the interior values of the $q$ field.\n3.  Solve the linear system $A\\mathbf{x} = \\mathbf{b}$ for $\\mathbf{x}$ using an efficient sparse linear algebra solver.\n4.  Reshape the solution vector $\\mathbf{x}$ back into a 2D array of interior $\\psi$ values and embed it within a larger grid with the zero-valued boundaries to form the full field $\\psi_{\\text{num}}$.\n\n### Part 3: Verification and Test Cases\n\nThe numerical solvers are validated using the Method of Manufactured Solutions. For each test case, an analytical \"truth\" field, $\\psi_{\\text{true}}$, is defined. The corresponding PV anomaly field, $q_{\\text{true}}$, is computed analytically by applying the continuous operator $q = (\\nabla^2 - 1/L_D^2)\\psi$. This $q_{\\text{true}}$ field is then used as input to the numerical inverter to produce $\\psi_{\\text{num}}$. The accuracy of the numerical method is quantified by the Root-Mean-Square Error (RMSE), $E = \\sqrt{\\langle(\\psi_{\\text{num}} - \\psi_{\\text{true}})^2\\rangle}$, where the average $\\langle\\cdot\\rangle$ is taken over all grid points. This procedure isolates the numerical error of the inversion process itself. The chosen $\\psi_{\\text{true}}$ functions are eigenfunctions of the respective operators and boundary conditions, providing ideal test scenarios.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to execute all test cases for the QG PV inversion problem.\n    \"\"\"\n\n    def solve_spectral(q, Lx, Ly, LD):\n        \"\"\"\n        Solves the Helmholtz/Poisson equation on a doubly periodic domain\n        using the FFT-based spectral method.\n        \n        q = grad^2(psi) - (1/LD^2)*psi\n        \n        Args:\n            q (np.ndarray): 2D array of potential vorticity anomaly.\n            Lx (float): Domain size in x-direction.\n            Ly (float): Domain size in y-direction.\n            LD (float): Deformation radius. Use np.inf for the Poisson limit.\n            \n        Returns:\n            np.ndarray: 2D array of the solved streamfunction.\n        \"\"\"\n        Ny, Nx = q.shape\n        \n        # Wavenumbers\n        kx = 2 * np.pi * np.fft.fftfreq(Nx, d=Lx / Nx)\n        ky = 2 * np.pi * np.fft.fftfreq(Ny, d=Ly / Ny)\n        Kx, Ky = np.meshgrid(kx, ky, indexing='ij')\n        \n        K2 = Kx**2 + Ky**2\n        \n        # Fourier transform of PV\n        q_hat = np.fft.fft2(q)\n        \n        # Construct the denominator of the spectral operator\n        if np.isinf(LD):\n            denom = -K2\n        else:\n            denom = -(K2 + 1 / LD**2)\n        \n        # Solve for streamfunction in spectral space\n        psi_hat = np.zeros_like(q_hat, dtype=complex)\n        \n        # Avoid division by zero for the k=0 mode\n        # The mean streamfunction is arbitrary and set to 0.\n        non_zero_denom = denom != 0\n        psi_hat[non_zero_denom] = q_hat[non_zero_denom] / denom[non_zero_denom]\n        \n        # Inverse transform to get streamfunction in physical space\n        psi_num = np.fft.ifft2(psi_hat)\n        \n        return np.real(psi_num)\n\n    def solve_fd(q, Lx, Ly, LD):\n        \"\"\"\n        Solves the Helmholtz/Poisson equation on a bounded domain with\n        homogeneous Dirichlet boundary conditions using a 5-point\n        finite-difference stencil.\n\n        Args:\n            q (np.ndarray): 2D array of potential vorticity anomaly.\n            Lx (float): Domain size in x-direction.\n            Ly (float): Domain size in y-direction.\n            LD (float): Deformation radius. Use np.inf for the Poisson limit.\n\n        Returns:\n            np.ndarray: 2D array of the solved streamfunction.\n        \"\"\"\n        Ny, Nx = q.shape\n        dx = Lx / (Nx - 1)\n        dy = Ly / (Ny - 1)\n\n        # Number of interior points\n        Nx_int, Ny_int = Nx - 2, Ny - 2\n        N_int = Nx_int * Ny_int\n        \n        # Get the interior q values and flatten\n        q_interior = q[1:-1, 1:-1]\n        b = q_interior.flatten()\n        \n        # Construct the sparse matrix A for the linear system A*psi = b\n        # Main diagonal\n        if np.isinf(LD):\n            main_diag = -2 / dx**2 - 2 / dy**2\n        else:\n            main_diag = -2 / dx**2 - 2 / dy**2 - 1 / LD**2\n        \n        diagonals = [np.full(N_int, 1 / dy**2), \n                     np.full(N_int, 1 / dx**2), \n                     np.full(N_int, main_diag),\n                     np.full(N_int, 1 / dx**2),\n                     np.full(N_int, 1 / dy**2)]\n        \n        offsets = [-Nx_int, -1, 0, 1, Nx_int]\n        \n        A = sparse.diags(diagonals, offsets, shape=(N_int, N_int), format='csr')\n\n        # The term from dx^2 can wrap around blocks, so we need to zero it out\n        # for points at the right edge of each row in the flattened grid.\n        for i in range(1, Ny_int):\n            A[i * Nx_int - 1, i * Nx_int] = 0\n            A[i * Nx_int, i * Nx_int - 1] = 0\n\n        # Solve the sparse linear system\n        psi_flat = spsolve(A, b)\n        \n        # Reshape solution and place into a grid with zero boundaries\n        psi_num = np.zeros((Ny, Nx))\n        psi_num[1:-1, 1:-1] = psi_flat.reshape((Ny_int, Nx_int))\n        \n        return psi_num\n\n    def compute_rmse(psi_num, psi_true):\n        \"\"\"Calculates the Root-Mean-Square-Error.\"\"\"\n        return np.sqrt(np.mean((psi_num - psi_true)**2))\n\n    results = []\n\n    # Test Case T1: Spectral, periodic Helmholtz\n    Lx1, Ly1 = 1e6, 1e6\n    Nx1, Ny1 = 128, 128\n    LD1 = 2e5\n    A1, n1, m1 = 1e5, 3, 5\n    x1 = np.linspace(0, Lx1, Nx1, endpoint=False)\n    y1 = np.linspace(0, Ly1, Ny1, endpoint=False)\n    X1, Y1 = np.meshgrid(x1, y1, indexing='ij')\n    kx1, ky1 = 2 * np.pi * n1 / Lx1, 2 * np.pi * m1 / Ly1\n    psi_true1 = A1 * np.cos(kx1 * X1) * np.cos(ky1 * Y1)\n    q_true1 = -(kx1**2 + ky1**2 + 1/LD1**2) * psi_true1\n    psi_num1 = solve_spectral(q_true1, Lx1, Ly1, LD1)\n    E1 = compute_rmse(psi_num1, psi_true1)\n    results.append(E1)\n\n    # Test Case T2: Spectral, periodic Poisson limit\n    Lx2, Ly2 = 1e6, 1e6\n    Nx2, Ny2 = 64, 64\n    LD2 = np.inf\n    A2, n2, m2 = 2e5, 1, 2\n    x2 = np.linspace(0, Lx2, Nx2, endpoint=False)\n    y2 = np.linspace(0, Ly2, Ny2, endpoint=False)\n    X2, Y2 = np.meshgrid(x2, y2, indexing='ij')\n    kx2, ky2 = 2 * np.pi * n2 / Lx2, 2 * np.pi * m2 / Ly2\n    psi_true2 = A2 * np.cos(kx2 * X2) * np.cos(ky2 * Y2)\n    q_true2 = -(kx2**2 + ky2**2) * psi_true2\n    psi_num2 = solve_spectral(q_true2, Lx2, Ly2, LD2)\n    E2 = compute_rmse(psi_num2, psi_true2)\n    results.append(E2)\n\n    # Test Case T3: Finite difference, bounded Helmholtz\n    Lx3, Ly3 = 1e6, 1e6\n    Nx3, Ny3 = 65, 65\n    LD3 = 2e5\n    A3 = 1e5\n    x3 = np.linspace(0, Lx3, Nx3)\n    y3 = np.linspace(0, Ly3, Ny3)\n    X3, Y3 = np.meshgrid(x3, y3, indexing='ij')\n    kx3, ky3 = np.pi / Lx3, np.pi / Ly3\n    psi_true3 = A3 * np.sin(kx3 * X3) * np.sin(ky3 * Y3)\n    q_true3 = -(kx3**2 + ky3**2 + 1/LD3**2) * psi_true3\n    psi_num3 = solve_fd(q_true3, Lx3, Ly3, LD3)\n    E3 = compute_rmse(psi_num3, psi_true3)\n    results.append(E3)\n\n    # Test Case T4: Finite difference, bounded Poisson limit\n    Lx4, Ly4 = 1e6, 1e6\n    Nx4, Ny4 = 65, 65\n    LD4 = np.inf\n    A4 = 1e5\n    x4 = np.linspace(0, Lx4, Nx4)\n    y4 = np.linspace(0, Ly4, Ny4)\n    X4, Y4 = np.meshgrid(x4, y4, indexing='ij')\n    kx4, ky4 = np.pi / Lx4, np.pi / Ly4\n    psi_true4 = A4 * np.sin(kx4 * X4) * np.sin(ky4 * Y4)\n    q_true4 = -(kx4**2 + ky4**2) * psi_true4\n    psi_num4 = solve_fd(q_true4, Lx4, Ly4, LD4)\n    E4 = compute_rmse(psi_num4, psi_true4)\n    results.append(E4)\n\n    # Test Case T5: Comparative periodic-and-bounded Helmholtz\n    Lx5, Ly5 = 1e6, 1e6\n    LD5 = 3e5\n    A5 = 1e5\n    kx5, ky5 = 2 * np.pi / Lx5, 2 * np.pi / Ly5\n    \n    # Spectral part\n    Nxs, Nys = 128, 128\n    xs = np.linspace(0, Lx5, Nxs, endpoint=False)\n    ys = np.linspace(0, Ly5, Nys, endpoint=False)\n    Xs, Ys = np.meshgrid(xs, ys, indexing='ij')\n    psi_true_s = A5 * np.sin(kx5 * Xs) * np.sin(ky5 * Ys)\n    q_true_s = -(kx5**2 + ky5**2 + 1/LD5**2) * psi_true_s\n    psi_num_s = solve_spectral(q_true_s, Lx5, Ly5, LD5)\n    Es = compute_rmse(psi_num_s, psi_true_s)\n\n    # Finite-difference part\n    Nxf, Nyf = 129, 129\n    xf = np.linspace(0, Lx5, Nxf)\n    yf = np.linspace(0, Ly5, Nyf)\n    Xf, Yf = np.meshgrid(xf, yf, indexing='ij')\n    psi_true_f = A5 * np.sin(kx5 * Xf) * np.sin(ky5 * Yf)\n    q_true_f = -(kx5**2 + ky5**2 + 1/LD5**2) * psi_true_f\n    psi_num_f = solve_fd(q_true_f, Lx5, Ly5, LD5)\n    Ef = compute_rmse(psi_num_f, psi_true_f)\n    \n    # The ratio R. Handle potential division by zero if Ef is also zero.\n    R = Es / Ef if Ef != 0 else 0.0\n    results.append(R)\n\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}