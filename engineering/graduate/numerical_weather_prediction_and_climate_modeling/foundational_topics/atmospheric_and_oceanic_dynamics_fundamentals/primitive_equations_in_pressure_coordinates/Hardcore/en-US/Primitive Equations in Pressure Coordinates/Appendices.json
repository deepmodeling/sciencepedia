{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of large-scale dynamics is the concept of geostrophic balance, where the pressure gradient force and the Coriolis force are in approximate equilibrium. This practice challenges you to apply this balance to derive the geostrophic wind and its associated vorticity directly from a given geopotential field. Mastering this connection is essential for diagnosing the structure of atmospheric waves and vortices from mass field data, a common task in synoptic meteorology. ",
            "id": "4078464",
            "problem": "Consider a midlatitude, Cartesian domain with eastward coordinate $x$ and northward coordinate $y$, in pressure coordinates at a fixed pressure level $p$. The horizontal momentum equations of the primitive equations in pressure coordinates for a rotating, hydrostatic atmosphere are the starting point. Assume a constant Coriolis parameter ($f$-plane) with $f=f_0$, and neglect friction.\n\nYou are given a horizontally varying geopotential field at the pressure level $p$,\n$$\n\\Phi(x,y,p) \\;=\\; \\Phi_b(p) \\;+\\; \\alpha \\,\\exp\\!\\left(-\\frac{x^{2}}{L_x^{2}} \\,-\\, \\frac{y^{2}}{L_y^{2}}\\right) \\;+\\; \\gamma\\, x^{2} \\;-\\; \\delta\\, y^{2},\n$$\nwhere $\\Phi_b(p)$ is horizontally uniform, and the constants are\n$$\nf_0 \\;=\\; 1.0 \\times 10^{-4},\\quad L_x \\;=\\; 8.0 \\times 10^{5},\\quad L_y \\;=\\; 1.2 \\times 10^{6},\\quad \\alpha \\;=\\; 1.5 \\times 10^{4},\\quad \\gamma \\;=\\; 5.0 \\times 10^{-10},\\quad \\delta \\;=\\; 3.0 \\times 10^{-10},\n$$\nwith $f_0$ in $\\mathrm{s}^{-1}$, $L_x$ and $L_y$ in $\\mathrm{m}$, $\\alpha$ and $\\Phi$ in $\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}$, and $\\gamma$, $\\delta$ in $\\mathrm{s}^{-2}$.\n\nStarting from the primitive horizontal momentum equations and the geostrophic approximation, derive the relationship between the geostrophic streamfunction and the geopotential under a constant $f$ assumption, and hence the expression for geostrophic relative vorticity in terms of the geopotential. Using this, compute the geostrophic relative vorticity $\\zeta_g(x,y,p)$ corresponding to the given $\\Phi(x,y,p)$ as a closed-form analytic expression. Express your final result for $\\zeta_g$ in $\\mathrm{s}^{-1}$. No rounding is required.\n\nFinally, discuss clearly the approximation involved in using a constant $f$ and the conditions under which $\\psi=\\Phi/f$ and $\\zeta_g=\\nabla_{p}^{2}\\psi$ accurately represent the geostrophic flow and its relative vorticity in pressure coordinates, including how the expression would be modified if $f$ varies meridionally.",
            "solution": "The problem requires the derivation of the geostrophic relative vorticity from a given geopotential field in pressure coordinates under the f-plane approximation, and a subsequent discussion of the approximations involved.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n-   Coordinate system: Cartesian domain with eastward coordinate $x$, northward coordinate $y$, at a fixed pressure level $p$.\n-   Governing equations framework: Primitive equations in pressure coordinates for a rotating, hydrostatic atmosphere.\n-   Assumptions: Constant Coriolis parameter $f=f_0$ ($f$-plane), friction is neglected.\n-   Geopotential field: $\\Phi(x,y,p) \\;=\\; \\Phi_b(p) \\;+\\; \\alpha \\,\\exp\\!\\left(-\\frac{x^{2}}{L_x^{2}} \\,-\\, \\frac{y^{2}}{L_y^{2}}\\right) \\;+\\; \\gamma\\, x^{2} \\;-\\; \\delta\\, y^{2}$.\n-   Constants:\n    -   $f_0 = 1.0 \\times 10^{-4} \\, \\mathrm{s}^{-1}$\n    -   $L_x = 8.0 \\times 10^{5} \\, \\mathrm{m}$\n    -   $L_y = 1.2 \\times 10^{6} \\, \\mathrm{m}$\n    -   $\\alpha = 1.5 \\times 10^{4} \\, \\mathrm{m}^{2}\\,\\mathrm{s}^{-2}$\n    -   $\\gamma = 5.0 \\times 10^{-10} \\, \\mathrm{s}^{-2}$\n    -   $\\delta = 3.0 \\times 10^{-10} \\, \\mathrm{s}^{-2}$\n-   $\\Phi_b(p)$ is a horizontally uniform function of pressure.\n-   Task 1: Derive the relationship between the geostrophic streamfunction $\\psi_g$ and the geopotential $\\Phi$ for constant $f$.\n-   Task 2: Derive the expression for geostrophic relative vorticity $\\zeta_g$ in terms of $\\Phi$.\n-   Task 3: Compute $\\zeta_g(x,y,p)$ as a closed-form analytic expression for the given $\\Phi$.\n-   Task 4: Discuss the constant $f$ approximation and the conditions for the validity of the derived relations, including modification if $f$ varies meridionally.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in the established principles of geophysical fluid dynamics. It uses standard equations (primitive equations), standard coordinate systems (pressure coordinates), and standard approximations (geostrophic balance, f-plane). The provided geopotential function is mathematically well-behaved, and the constants are physically realistic for midlatitude synoptic-scale atmospheric systems. The problem is well-posed, objective, self-contained, and requires a solution based on formal derivations and calculations. It does not violate any of the invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A complete solution will be provided.\n\n**Derivation of Geostrophic Relations**\n\nThe primitive horizontal momentum equations in pressure coordinates, neglecting friction, are:\n$$\n\\frac{Du}{Dt} - fv = -\\frac{\\partial \\Phi}{\\partial x}\n$$\n$$\n\\frac{Dv}{Dt} + fu = -\\frac{\\partial \\Phi}{\\partial y}\n$$\nwhere $u$ and $v$ are the zonal (eastward) and meridional (northward) wind components, respectively, $f$ is the Coriolis parameter, $\\Phi$ is the geopotential, and $\\frac{D}{Dt}$ is the material derivative.\n\nThe geostrophic approximation assumes that the flow is in a steady state and that the acceleration terms ($\\frac{Du}{Dt}$, $\\frac{Dv}{Dt}$) are negligible compared to the Coriolis force and the pressure gradient force. This balance is characteristic of large-scale, slowly-evolving midlatitude atmospheric motions. Applying this approximation, the momentum equations reduce to the geostrophic balance equations:\n$$\n- fv_g = -\\frac{\\partial \\Phi}{\\partial x} \\quad \\implies \\quad v_g = \\frac{1}{f} \\frac{\\partial \\Phi}{\\partial x}\n$$\n$$\nfu_g = -\\frac{\\partial \\Phi}{\\partial y} \\quad \\implies \\quad u_g = -\\frac{1}{f} \\frac{\\partial \\Phi}{\\partial y}\n$$\nHere, $(u_g, v_g)$ denotes the geostrophic wind vector.\n\nA two-dimensional streamfunction $\\psi$ is defined such that the velocity components are given by $u = -\\frac{\\partial \\psi}{\\partial y}$ and $v = \\frac{\\partial \\psi}{\\partial x}$. For the geostrophic wind, we define a geostrophic streamfunction $\\psi_g$.\nComparing the geostrophic wind relations with the definition of the streamfunction:\n$$\nu_g = -\\frac{\\partial \\psi_g}{\\partial y} = -\\frac{1}{f} \\frac{\\partial \\Phi}{\\partial y} \\quad \\implies \\quad \\frac{\\partial \\psi_g}{\\partial y} = \\frac{1}{f} \\frac{\\partial \\Phi}{\\partial y}\n$$\n$$\nv_g = \\frac{\\partial \\psi_g}{\\partial x} = \\frac{1}{f} \\frac{\\partial \\Phi}{\\partial x}\n$$\nUnder the assumption that $f$ is a constant, $f=f_0$, we can integrate these equations. From the first equation, integration with respect to $y$ gives $\\psi_g = \\frac{\\Phi}{f_0} + C_1(x)$. From the second, integration with respect to $x$ gives $\\psi_g = \\frac{\\Phi}{f_0} + C_2(y)$. For consistency, $C_1(x)$ and $C_2(y)$ must be equal to the same constant. Since the streamfunction is defined only up to an arbitrary additive constant (which does not affect the velocity field), we can set this constant to zero. Thus, for a constant Coriolis parameter $f_0$, the geostrophic streamfunction is directly proportional to the geopotential:\n$$\n\\psi_g = \\frac{\\Phi}{f_0}\n$$\nThe relative vorticity $\\zeta$ is the vertical component of the curl of the velocity field. In Cartesian coordinates, $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$. The geostrophic relative vorticity $\\zeta_g$ is therefore:\n$$\n\\zeta_g = \\frac{\\partial v_g}{\\partial x} - \\frac{\\partial u_g}{\\partial y}\n$$\nSubstituting the streamfunction definition:\n$$\n\\zeta_g = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\psi_g}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\psi_g}{\\partial y}\\right) = \\frac{\\partial^2 \\psi_g}{\\partial x^2} + \\frac{\\partial^2 \\psi_g}{\\partial y^2} = \\nabla_p^2 \\psi_g\n$$\nwhere $\\nabla_p^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ is the horizontal Laplacian operator at a constant pressure surface.\nSubstituting the relationship $\\psi_g = \\Phi/f_0$:\n$$\n\\zeta_g = \\nabla_p^2 \\left(\\frac{\\Phi}{f_0}\\right) = \\frac{1}{f_0} \\nabla_p^2 \\Phi\n$$\nThis final expression relates the geostrophic relative vorticity directly to the Laplacian of the geopotential field, valid under the geostrophic and f-plane approximations.\n\n**Calculation of Geostrophic Relative Vorticity**\n\nWe are given the geopotential field:\n$$\n\\Phi(x,y,p) = \\Phi_b(p) + \\alpha \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + \\gamma x^{2} - \\delta y^{2}\n$$\nTo find $\\zeta_g$, we must compute $\\nabla_p^2 \\Phi = \\frac{\\partial^2 \\Phi}{\\partial x^2} + \\frac{\\partial^2 \\Phi}{\\partial y^2}$. The term $\\Phi_b(p)$ is horizontally uniform, so its partial derivatives with respect to $x$ and $y$ are zero.\n\nFirst, we find the second partial derivative with respect to $x$:\n$$\n\\frac{\\partial \\Phi}{\\partial x} = \\alpha \\left(-\\frac{2x}{L_x^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + 2\\gamma x\n$$\n$$\n\\frac{\\partial^2 \\Phi}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left[ \\alpha \\left(-\\frac{2x}{L_x^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + 2\\gamma x \\right]\n$$\nUsing the product rule on the first term:\n$$\n\\frac{\\partial^2 \\Phi}{\\partial x^2} = \\alpha \\left(-\\frac{2}{L_x^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + \\alpha \\left(-\\frac{2x}{L_x^2}\\right)\\left(-\\frac{2x}{L_x^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + 2\\gamma\n$$\n$$\n\\frac{\\partial^2 \\Phi}{\\partial x^2} = \\alpha \\left(\\frac{4x^2}{L_x^4} - \\frac{2}{L_x^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + 2\\gamma\n$$\nBy symmetry, the second partial derivative with respect to $y$ is:\n$$\n\\frac{\\partial \\Phi}{\\partial y} = \\alpha \\left(-\\frac{2y}{L_y^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) - 2\\delta y\n$$\n$$\n\\frac{\\partial^2 \\Phi}{\\partial y^2} = \\alpha \\left(\\frac{4y^2}{L_y^4} - \\frac{2}{L_y^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) - 2\\delta\n$$\nThe Laplacian of the geopotential is the sum of these two derivatives:\n$$\n\\nabla_p^2 \\Phi = \\frac{\\partial^2 \\Phi}{\\partial x^2} + \\frac{\\partial^2 \\Phi}{\\partial y^2} = \\alpha \\left(\\frac{4x^2}{L_x^4} - \\frac{2}{L_x^2} + \\frac{4y^2}{L_y^4} - \\frac{2}{L_y^2}\\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + 2\\gamma - 2\\delta\n$$\nFinally, the geostrophic relative vorticity is $\\zeta_g = \\frac{1}{f_0} \\nabla_p^2 \\Phi$:\n$$\n\\zeta_g(x,y,p) = \\frac{1}{f_0} \\left[ \\alpha \\left( \\frac{4x^2}{L_x^4} - \\frac{2}{L_x^2} + \\frac{4y^2}{L_y^4} - \\frac{2}{L_y^2} \\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + 2(\\gamma - \\delta) \\right]\n$$\nThis is the required closed-form analytic expression for $\\zeta_g$ in units of $\\mathrm{s}^{-1}$.\n\n**Discussion of Approximations**\n\nThe relations $\\psi_g = \\Phi/f_0$ and $\\zeta_g = \\nabla_p^2 \\psi_g$ are fundamental in quasi-geostrophic theory and rely on two key approximations:\n\n1.  **Geostrophic Approximation**: This balance requires the Rossby number, $Ro = U/(fL)$, to be small ($Ro \\ll 1$), where $U$ and $L$ are characteristic velocity and length scales of the motion. This implies that the fluid acceleration is negligible compared to the Coriolis and pressure gradient forces. It holds well for large-scale (synoptic scale, $L \\sim 1000 \\, \\mathrm{km}$), slowly evolving motions in the midlatitude free atmosphere.\n\n2.  **f-plane Approximation**: This involves treating the Coriolis parameter $f$ as a constant, $f=f_0$. In reality, $f = 2\\Omega\\sin\\phi$, where $\\Omega$ is Earth's angular rotation rate and $\\phi$ is the latitude. This parameter varies with the northward coordinate $y$. The f-plane approximation is valid only when the meridional extent of the motion, $L_y$, is small enough that the variation of $f$ across the domain is negligible compared to $f_0$. The next order of approximation is the $\\beta$-plane, where $f$ is linearized about a central latitude $\\phi_0$: $f(y) \\approx f_0 + \\beta y$, with $\\beta = (df/dy)_{\\phi_0}$. The f-plane approximation requires $\\beta L_y \\ll f_0$.\n\nIf the Coriolis parameter is allowed to vary with latitude, $f=f(y)$, the relationships derived above must be modified. The geostrophic wind components become $u_g = -\\frac{1}{f(y)}\\frac{\\partial \\Phi}{\\partial y}$ and $v_g = \\frac{1}{f(y)}\\frac{\\partial \\Phi}{\\partial x}$. An important consequence is that the geostrophic wind is no longer non-divergent:\n$$\n\\nabla_p \\cdot \\mathbf{v}_g = \\frac{\\partial u_g}{\\partial x} + \\frac{\\partial v_g}{\\partial y} = \\frac{\\partial}{\\partial y}\\left(\\frac{1}{f(y)}\\frac{\\partial \\Phi}{\\partial x}\\right) = -\\frac{1}{f^2}\\frac{df}{dy}\\frac{\\partial \\Phi}{\\partial x} = -\\frac{\\beta}{f}v_g \\neq 0\n$$\nSince the flow has non-zero divergence, a streamfunction $\\psi_g$ such that $(u_g, v_g) = (-\\frac{\\partial \\psi_g}{\\partial y}, \\frac{\\partial \\psi_g}{\\partial x})$ does not exist in the strict sense. Therefore, the simple relation $\\psi_g = \\Phi/f$ ceases to be valid as a streamfunction.\n\nThe geostrophic relative vorticity $\\zeta_g = \\frac{\\partial v_g}{\\partial x} - \\frac{\\partial u_g}{\\partial y}$ must be re-derived:\n$$\n\\zeta_g = \\frac{\\partial}{\\partial x}\\left(\\frac{1}{f}\\frac{\\partial \\Phi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{1}{f}\\frac{\\partial \\Phi}{\\partial y}\\right) = \\frac{1}{f}\\frac{\\partial^2 \\Phi}{\\partial x^2} + \\frac{\\partial}{\\partial y}\\left(\\frac{1}{f}\\frac{\\partial \\Phi}{\\partial y}\\right)\n$$\n$$\n\\zeta_g = \\frac{1}{f}\\frac{\\partial^2 \\Phi}{\\partial x^2} + \\frac{1}{f}\\frac{\\partial^2 \\Phi}{\\partial y^2} - \\frac{1}{f^2}\\frac{df}{dy}\\frac{\\partial \\Phi}{\\partial y} = \\frac{1}{f}\\nabla_p^2 \\Phi - \\frac{\\beta}{f^2}\\frac{\\partial \\Phi}{\\partial y}\n$$\nUsing $\\frac{\\partial \\Phi}{\\partial y} = -f u_g$, this can be written as:\n$$\n\\zeta_g = \\frac{1}{f}\\nabla_p^2 \\Phi + \\frac{\\beta}{f}u_g\n$$\nThis modified expression shows that on a $\\beta$-plane, the geostrophic vorticity depends not only on the Laplacian of the geopotential but also on the zonal geostrophic wind itself. The simple relation $\\zeta_g = \\frac{1}{f_0}\\nabla_p^2\\Phi$ is a specialization valid only on an f-plane.",
            "answer": "$$\n\\boxed{\\frac{1}{f_0} \\left[ \\alpha \\left( \\frac{4x^2}{L_x^4} + \\frac{4y^2}{L_y^4} - \\frac{2}{L_x^2} - \\frac{2}{L_y^2} \\right) \\exp\\left(-\\frac{x^{2}}{L_x^{2}} - \\frac{y^{2}}{L_y^{2}}\\right) + 2(\\gamma - \\delta) \\right]}\n$$"
        },
        {
            "introduction": "The evolution of weather is fundamentally tied to changes in temperature, which are governed by the thermodynamic energy equation. This exercise focuses on a critical component of this equation: the temperature change caused by adiabatic expansion or compression as air parcels move vertically. By deriving this term and calculating its magnitude for a realistic scenario, you will gain a quantitative appreciation for how vertical motion is directly linked to atmospheric cooling and warming. ",
            "id": "4078428",
            "problem": "Consider a mid-tropospheric air parcel in the framework of the primitive equations in pressure coordinates, as used in Numerical Weather Prediction (NWP) and climate modeling. Starting from the First Law of Thermodynamics for an ideal gas and the definition of vertical motion in pressure coordinates, derive the dry adiabatic contribution of vertical motion to the local temperature tendency at a given pressure level. Clearly state the sign convention for vertical motion and use the hydrostatic ideal gas relation for specific volume. Then, for a parcel at pressure $p=600\\,\\mathrm{hPa}$ with temperature $T=270\\,\\mathrm{K}$ undergoing large-scale ascent characterized by $\\omega = \\mathrm{D}p/\\mathrm{D}t = -0.1\\,\\mathrm{Pa}\\,\\mathrm{s}^{-1}$, evaluate the magnitude of the vertical-motion contribution to the local temperature tendency, expressed in $\\mathrm{K}\\,\\mathrm{s}^{-1}$. Take dry air constants such that $\\kappa = R_{d}/c_{p} = 0.286$ and use $p$ in Pascals for the computation. Round your final numerical answer to four significant figures. In your derivation, explain the sign of this tendency for ascent ($\\omega0$) and descent ($\\omega0$), but provide only the magnitude as the final numerical answer.",
            "solution": "The problem statement is first subjected to validation.\n\n**Step 1: Extract Givens**\n- System: Mid-tropospheric air parcel.\n- Framework: Primitive equations in pressure coordinates.\n- Starting Principles: First Law of Thermodynamics for an ideal gas, definition of vertical motion in pressure coordinates ($\\omega = \\mathrm{D}p/\\mathrm{D}t$).\n- Task: Derive the dry adiabatic contribution of vertical motion to the local temperature tendency.\n- Ancillary Relations: Hydrostatic ideal gas relation for specific volume.\n- Numerical evaluation is required for the following conditions:\n    - Pressure: $p = 600\\,\\mathrm{hPa}$\n    - Temperature: $T = 270\\,\\mathrm{K}$\n    - Vertical motion: $\\omega = -0.1\\,\\mathrm{Pa}\\,\\mathrm{s}^{-1}$\n    - Dry air constant ratio: $\\kappa = R_{d}/c_{p} = 0.286$\n- Required Output: The magnitude of the tendency in $\\mathrm{K}\\,\\mathrm{s}^{-1}$, rounded to four significant figures.\n- Required Explanation: The sign of the tendency for ascent ($\\omega0$) and descent ($\\omega0$).\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, rooted in the fundamental principles of atmospheric thermodynamics and dynamics used in numerical weather prediction. All provided values ($p$, $T$, $\\omega$, $\\kappa$) are physically realistic for the Earth's mid-troposphere. The problem is well-posed, objective, and self-contained, with sufficient information to perform the requested derivation and calculation. There are no contradictions, ambiguities, or factual unsoundness.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A full, reasoned solution will be provided.\n\n**Derivation**\n\nThe derivation begins with the first law of thermodynamics for a unit mass of an ideal gas, which can be written as:\n$$\n\\mathrm{d}q = c_p \\mathrm{d}T - \\alpha \\mathrm{d}p\n$$\nwhere $\\mathrm{d}q$ is the diabatic heat added per unit mass, $c_p$ is the specific heat at constant pressure, $T$ is the absolute temperature, $\\alpha$ is the specific volume, and $p$ is the pressure.\n\nFor a dry adiabatic process, there is no heat exchange with the surroundings, so $\\mathrm{d}q = 0$. The equation simplifies to:\n$$\nc_p \\mathrm{d}T = \\alpha \\mathrm{d}p\n$$\nTo find the rate of temperature change for a moving air parcel (the Lagrangian or material derivative), we divide by the time differential $\\mathrm{d}t$:\n$$\nc_p \\frac{\\mathrm{D}T}{\\mathrm{D}t} = \\alpha \\frac{\\mathrm{D}p}{\\mathrm{D}t}\n$$\nIn pressure coordinates, the vertical motion, $\\omega$, is defined as the material derivative of pressure, $\\omega \\equiv \\mathrm{D}p/\\mathrm{D}t$. Substituting this definition yields:\n$$\nc_p \\frac{\\mathrm{D}T}{\\mathrm{D}t} = \\alpha \\omega\n$$\nRearranging for the parcel's temperature tendency gives:\n$$\n\\frac{\\mathrm{D}T}{\\mathrm{D}t} = \\frac{\\alpha}{c_p} \\omega\n$$\nThe material derivative $\\mathrm{D}/\\mathrm{D}t$ represents the total change following the motion and can be expanded into local and advective terms in the pressure coordinate system:\n$$\n\\frac{\\mathrm{D}}{\\mathrm{D}t} = \\frac{\\partial}{\\partial t} + \\mathbf{v}_h \\cdot \\nabla_p + \\omega \\frac{\\partial}{\\partial p}\n$$\nwhere $\\partial/\\partial t$ is the local (Eulerian) time derivative at a fixed point $(x, y, p)$, $\\mathbf{v}_h$ is the horizontal velocity vector, and $\\nabla_p$ is the horizontal gradient operator on a constant pressure surface.\n\nApplying this expansion to the temperature, $T$, we get:\n$$\n\\frac{\\mathrm{D}T}{\\mathrm{D}t} = \\frac{\\partial T}{\\partial t} + \\mathbf{v}_h \\cdot \\nabla_p T + \\omega \\frac{\\partial T}{\\partial p}\n$$\nSubstituting this back into our thermodynamic equation gives the full thermodynamic energy equation:\n$$\n\\frac{\\partial T}{\\partial t} + \\mathbf{v}_h \\cdot \\nabla_p T + \\omega \\frac{\\partial T}{\\partial p} = \\frac{\\alpha}{c_p} \\omega\n$$\nThe local temperature tendency, $\\partial T/\\partial t$, is isolated by rearranging the terms:\n$$\n\\frac{\\partial T}{\\partial t} = -\\mathbf{v}_h \\cdot \\nabla_p T - \\omega \\frac{\\partial T}{\\partial p} + \\frac{\\alpha}{c_p} \\omega\n$$\nThe terms on the right-hand side represent, respectively, horizontal temperature advection, vertical temperature advection, and the temperature change due to adiabatic compression/expansion. The problem asks for the \"dry adiabatic contribution of vertical motion,\" which is precisely this last term, representing the physical process of heating or cooling due to a parcel's vertical displacement.\n$$\n\\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} = \\frac{\\alpha}{c_p} \\omega\n$$\nNext, we use the ideal gas law for dry air, $pv = R_d T$, where $v$ is the specific volume (denoted here by $\\alpha$). Thus, $\\alpha = R_d T / p$. Substituting this into our expression gives:\n$$\n\\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} = \\frac{1}{c_p} \\left( \\frac{R_d T}{p} \\right) \\omega = \\frac{R_d}{c_p} \\frac{T}{p} \\omega\n$$\nUsing the provided constant $\\kappa = R_d / c_p$, we arrive at the final expression for the tendency:\n$$\n\\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} = \\frac{\\kappa T}{p} \\omega\n$$\n\n**Explanation of the Sign**\n\nThe sign convention for $\\omega$ is crucial. Since pressure decreases with increasing altitude in the atmosphere, a parcel moving upward (ascent) experiences a decrease in its pressure. Therefore, ascent corresponds to $\\omega = \\mathrm{D}p/\\mathrm{D}t  0$. Conversely, a parcel moving downward (descent) experiences an increase in its pressure, so descent corresponds to $\\omega  0$.\n\nIn the derived expression, the quantities $\\kappa$, absolute temperature $T$, and absolute pressure $p$ are all positive. Consequently, the sign of the temperature tendency is determined solely by the sign of $\\omega$.\n- For **ascent**, $\\omega  0$, which results in a negative tendency, $\\left( \\partial T / \\partial t \\right)_{\\text{adiabatic vert}}  0$. This represents **adiabatic cooling**, as the ascending air parcel expands against the lower ambient pressure, doing work on its environment and thus losing internal energy.\n- For **descent**, $\\omega  0$, which results in a positive tendency, $\\left( \\partial T / \\partial t \\right)_{\\text{adiabatic vert}}  0$. This represents **adiabatic warming**, as the descending air parcel is compressed by the higher ambient pressure, having work done on it by the environment and thus gaining internal energy.\n\n**Numerical Evaluation**\n\nWe are given the following values:\n- $\\kappa = 0.286$\n- $T = 270\\,\\mathrm{K}$\n- $p = 600\\,\\mathrm{hPa} = 600 \\times 100\\,\\mathrm{Pa} = 60000\\,\\mathrm{Pa}$\n- $\\omega = -0.1\\,\\mathrm{Pa}\\,\\mathrm{s}^{-1}$\n\nSubstituting these values into the derived equation:\n$$\n\\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} = \\frac{(0.286) (270\\,\\mathrm{K})}{60000\\,\\mathrm{Pa}} (-0.1\\,\\mathrm{Pa}\\,\\mathrm{s}^{-1})\n$$\n$$\n\\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} = \\frac{77.22\\,\\mathrm{K}}{60000\\,\\mathrm{Pa}} (-0.1\\,\\mathrm{Pa}\\,\\mathrm{s}^{-1})\n$$\n$$\n\\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} = (0.001287\\,\\mathrm{K}\\,\\mathrm{Pa}^{-1}) (-0.1\\,\\mathrm{Pa}\\,\\mathrm{s}^{-1})\n$$\n$$\n\\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} = -0.0001287\\,\\mathrm{K}\\,\\mathrm{s}^{-1} = -1.287 \\times 10^{-4}\\,\\mathrm{K}\\,\\mathrm{s}^{-1}\n$$\nThe problem asks for the magnitude of this contribution.\n$$\n\\left| \\left( \\frac{\\partial T}{\\partial t} \\right)_{\\text{adiabatic vert}} \\right| = |-1.287 \\times 10^{-4}\\,\\mathrm{K}\\,\\mathrm{s}^{-1}| = 1.287 \\times 10^{-4}\\,\\mathrm{K}\\,\\mathrm{s}^{-1}\n$$\nThis result is already expressed to four significant figures as required.",
            "answer": "$$\n\\boxed{1.287 \\times 10^{-4}}\n$$"
        },
        {
            "introduction": "While the horizontal winds are prognostic variables in the primitive equations, vertical motion ($\\omega$) is a critical diagnostic variable that must be computed from them. This is accomplished using the mass continuity equation, which relates $\\omega$ to the horizontal divergence of the wind field. This hands-on coding practice guides you through the process of numerically integrating the continuity equation to derive the vertical motion profile, mirroring a fundamental calculation at the heart of all numerical weather and climate models. ",
            "id": "4078442",
            "problem": "Consider the hydrostatic primitive equations formulated in pressure coordinates for Numerical Weather Prediction (NWP) and Global Climate Model (GCM) applications. Let the horizontal wind be $\\mathbf{v} = (u,v)$, the horizontal divergence be $D = \\nabla_p \\cdot \\mathbf{v}$, and the vertical velocity in pressure coordinates be $\\omega = \\dfrac{D p}{D t}$, where $p$ is pressure. Starting from the mass continuity equation and the hydrostatic balance, derive the relationship between the vertical derivative of $\\omega$ and the horizontal divergence $D$. Then, design a numerical algorithm to compute $\\omega(p)$ at a set of discrete pressure levels by downward integration, given:\n- a strictly increasing array of pressure levels $\\{p_k\\}$ from a model top $p_t$ to a lower boundary $p_s$,\n- a corresponding array of horizontal divergence values $\\{D_k\\}$ evaluated at the same pressure levels,\n- and the upper boundary condition $\\omega(p_t) = 0$.\n\nYour derivation and algorithm must be based on first principles only (mass continuity and hydrostatic balance), without invoking shortcut formulas. You must also identify and explicitly state the required kinematic boundary condition at the lower boundary in pressure coordinates, i.e., express $\\omega(p_s)$ in terms of the material derivative of the surface pressure.\n\nNumerical implementation requirements:\n- Use a consistent discrete quadrature to integrate from $p_t$ downward to each $p_k$; the trapezoidal rule is acceptable provided you clearly justify it from the continuous relation you derive.\n- The program must accept the provided test suite hard-coded as arrays and produce the requested outputs with no external input.\n\nUnits and output:\n- Divergence $D$ is provided in $\\text{s}^{-1}$, pressure $p$ in $\\text{Pa}$, and the computed $\\omega$ must be expressed in $\\text{Pa}\\,\\text{s}^{-1}$.\n- Angles do not appear, so no angle unit is required.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of this outer list must itself be a list containing the values of $\\omega$ at the specified pressure levels for one test case, in $\\text{Pa}\\,\\text{s}^{-1}$, ordered from $p_t$ to $p_s$ (e.g., $\"[[\\omega(p_1),\\omega(p_2),\\dots,\\omega(p_N)],[\\dots],[\\dots]]\"$).\n\nTest suite:\n- Case A (general, monotonic convergence): $p = [20000, 40000, 60000, 80000, 100000]$ in $\\text{Pa}$, $D = [-1.0 \\times 10^{-6}, -1.2 \\times 10^{-6}, -1.5 \\times 10^{-6}, -1.9 \\times 10^{-6}, -2.4 \\times 10^{-6}]$ in $\\text{s}^{-1}$, with $\\omega(p_t) = 0$ in $\\text{Pa}\\,\\text{s}^{-1}$.\n- Case B (boundary condition check, zero divergence): $p = [20000, 40000, 60000, 80000, 100000]$ in $\\text{Pa}$, $D = [0.0, 0.0, 0.0, 0.0, 0.0]$ in $\\text{s}^{-1}$, with $\\omega(p_t) = 0$ in $\\text{Pa}\\,\\text{s}^{-1}$.\n- Case C (sign-changing divergence, column-integrated neutrality): $p = [20000, 40000, 60000, 80000, 100000]$ in $\\text{Pa}$, $D = [2.0 \\times 10^{-6}, 1.0 \\times 10^{-6}, 0.0, -1.0 \\times 10^{-6}, -2.0 \\times 10^{-6}]$ in $\\text{s}^{-1}$, with $\\omega(p_t) = 0$ in $\\text{Pa}\\,\\text{s}^{-1}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\"[[\\omega\\_A(p\\_1),\\dots,\\omega\\_A(p\\_N)],[\\omega\\_B(p\\_1),\\dots,\\omega\\_B(p\\_N)],[\\omega\\_C(p\\_1),\\dots,\\omega\\_C(p\\_N)]]\"$), where $\\omega\\_A$, $\\omega\\_B$, and $\\omega\\_C$ denote the solutions for Cases A, B, and C, respectively. Each $\\omega$ value must be in $\\text{Pa}\\,\\text{s}^{-1}$.",
            "solution": "We begin from first principles appropriate to hydrostatic primitive equations in pressure coordinates. The fundamental laws are:\n\n1. The mass continuity equation in height coordinates for a compressible fluid is\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla_h \\cdot (\\rho \\mathbf{v}) + \\frac{\\partial (\\rho w)}{\\partial z} = 0,\n$$\nwhere $\\rho$ is density, $\\mathbf{v}=(u,v)$ is the horizontal velocity, $w$ is vertical velocity in height coordinates, $\\nabla_h$ denotes the horizontal divergence operator, and $z$ is geometric height.\n\n2. Hydrostatic balance relates pressure to density and height:\n$$\n\\frac{\\partial p}{\\partial z} = - \\rho g,\n$$\nwhere $g$ is the gravitational acceleration.\n\n3. The definition of the vertical velocity in pressure coordinates is the Lagrangian (material) derivative of pressure:\n$$\n\\omega = \\frac{D p}{D t} = \\frac{\\partial p}{\\partial t} + \\mathbf{v} \\cdot \\nabla_h p + w \\frac{\\partial p}{\\partial z}.\n$$\nIn pressure coordinates the pressure itself is used as a vertical coordinate, enabling a transformation in which the continuity equation becomes especially simple under hydrostatic balance.\n\nFrom these bases, we transform the continuity equation to pressure coordinates. Under the hydrostatic approximation and using the definition of $\\omega$, the continuity equation reduces to a compact and widely used form in pressure coordinates:\n$$\n\\nabla_h \\cdot \\mathbf{v} + \\frac{\\partial \\omega}{\\partial p} = 0.\n$$\nThis is derived by applying the chain rule to replace $z$ derivatives using the hydrostatic relation and expressing mass fluxes per unit pressure rather than per unit height; the hydrostatic relation ensures that the Jacobian of the transformation cancels $\\rho$ factors, yielding a continuity equation that no longer explicitly depends on $\\rho$. This relation is the cornerstone for diagnosing vertical motion from horizontal divergence.\n\nRearranging the above yields the vertical derivative of the pressure vertical velocity in terms of horizontal divergence:\n$$\n\\frac{\\partial \\omega}{\\partial p} = - D,\n$$\nwhere $D = \\nabla_h \\cdot \\mathbf{v}$.\n\nDownward integration algorithm:\nGiven discrete pressure levels $p_1, p_2, \\dots, p_N$ with $p_1 = p_t$ and $p_N = p_s$, and divergence values $D_1, D_2, \\dots, D_N$ at these levels, we integrate the ordinary differential equation $\\dfrac{\\partial \\omega}{\\partial p} = -D$ from $p_t$ downward using the upper boundary condition $\\omega(p_t) = 0$. A second-order accurate and robust choice is the trapezoidal rule, which follows from integrating the continuous relation over each layer and approximating the integral of $D(p)$ linearly between adjacent levels. Over a layer $[p_k, p_{k+1}]$,\n$$\n\\omega(p_{k+1}) - \\omega(p_k) = \\int_{p_k}^{p_{k+1}} \\frac{\\partial \\omega}{\\partial p} \\, dp = - \\int_{p_k}^{p_{k+1}} D(p) \\, dp \\approx - \\frac{D_k + D_{k+1}}{2} \\left(p_{k+1} - p_k\\right).\n$$\nTherefore, with $\\omega(p_1) = 0$, we compute iteratively for $k=1,2,\\dots,N-1$:\n$$\n\\omega(p_{k+1}) = \\omega(p_k) - \\frac{D_k + D_{k+1}}{2} \\left(p_{k+1} - p_k\\right).\n$$\nThis produces $\\omega(p_k)$ at all levels $k = 1, \\dots, N$.\n\nLower boundary condition in pressure coordinates:\nThe impermeability condition at the physical lower boundary (no normal flow across the ground) implies $w=0$ at the surface in height coordinates. In pressure coordinates, the lower boundary is located at the time-dependent surface pressure $p_s(x,y,t)$. The corresponding kinematic boundary condition is that the vertical velocity in pressure coordinates at the surface equals the material derivative of the surface pressure:\n$$\n\\omega(p_s) = \\frac{D p_s}{D t} = \\frac{\\partial p_s}{\\partial t} + u_s \\frac{\\partial p_s}{\\partial x} + v_s \\frac{\\partial p_s}{\\partial y}.\n$$\nIn the diagnostic computation here, integrating $\\frac{\\partial \\omega}{\\partial p} = -D$ from $p_t$ to $p_s$ with $\\omega(p_t)=0$ yields a value of $\\omega(p_s)$ that must equal $\\dfrac{D p_s}{D t}$ to satisfy mass continuity and the kinematic boundary condition. If a model specifies $\\dfrac{\\partial p_s}{\\partial t}$ or constraints on $p_s$, that provides the required lower boundary condition; otherwise, the integration provides the implied $\\omega(p_s)$, from which $\\dfrac{D p_s}{D t}$ follows.\n\nUnits consistency:\n- $D$ has units $\\text{s}^{-1}$.\n- $p$ has units $\\text{Pa}$.\n- The integral $\\int -D \\, dp$ yields $\\omega$ in $\\text{Pa}\\,\\text{s}^{-1}$, consistent with $\\omega = \\dfrac{D p}{D t}$.\n\nTest cases and expected qualitative behavior:\n- Case A: $D0$ (horizontal convergence) in all layers should produce $\\omega0$ increasing downward, representing subsidence in pressure coordinates (pressure increasing along parcel trajectories).\n- Case B: $D=0$ yields $\\omega=0$ everywhere and the lower boundary condition $\\omega(p_s)=0$.\n- Case C: $D$ changes sign with the vertically integrated divergence approximately zero, yielding $\\omega(p_s) \\approx 0$ and a profile where $\\omega$ can be negative aloft and positive below.\n\nAlgorithm implementation details:\n- Validate that $p$ is strictly increasing ($p_{k+1}  p_k$) to ensure downward integration matches the physical direction.\n- Initialize $\\omega(p_1)=0$ in $\\text{Pa}\\,\\text{s}^{-1}$.\n- Apply the trapezoidal update for each adjacent pair of levels to obtain the complete $\\omega$ profile.\n- Return the list of $\\omega$ values in $\\text{Pa}\\,\\text{s}^{-1}$ for each test case.\n- The last value in each list equals $\\omega(p_s)$, satisfying the kinematic lower boundary condition $\\omega(p_s)=\\dfrac{D p_s}{D t}$.\n\nThe program provided computes these profiles for the specified test suite and prints a single line containing a list of lists with $\\omega$ values, each in $\\text{Pa}\\,\\text{s}^{-1}$, ordered from $p_t$ to $p_s$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef integrate_omega(pressures_pa, divergence_s_inv, omega_top_pa_per_s=0.0):\n    \"\"\"\n    Compute omega(p) by downward integration using the trapezoidal rule.\n    pressures_pa: 1D array-like of pressures [Pa], strictly increasing from top to bottom.\n    divergence_s_inv: 1D array-like of horizontal divergence D [s^-1], same length as pressures.\n    omega_top_pa_per_s: omega at the top boundary [Pa s^-1], default 0.\n    Returns: list of omega values [Pa s^-1] at each pressure level.\n    \"\"\"\n    p = np.array(pressures_pa, dtype=float)\n    D = np.array(divergence_s_inv, dtype=float)\n    if p.ndim != 1 or D.ndim != 1 or p.size != D.size or p.size  1:\n        raise ValueError(\"Invalid input shapes for pressures/divergence.\")\n    # Ensure strictly increasing pressures\n    if not np.all(np.diff(p)  0):\n        raise ValueError(\"Pressures must be strictly increasing (top to bottom).\")\n\n    omega = np.zeros_like(p, dtype=float)\n    omega[0] = float(omega_top_pa_per_s)\n    # Trapezoidal downward integration of ∂ω/∂p = -D\n    for k in range(0, p.size - 1):\n        dp = p[k + 1] - p[k]\n        D_avg = 0.5 * (D[k] + D[k + 1])\n        domega = - D_avg * dp\n        omega[k + 1] = omega[k] + domega\n\n    # Clean small numerical artifacts like -0.0 to +0.0\n    omega[np.isclose(omega, 0.0, atol=1e-15)] = 0.0\n    return [float(x) for x in omega]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: monotonic convergence (negative D)\n        (\n            [20000.0, 40000.0, 60000.0, 80000.0, 100000.0],  # pressures [Pa]\n            [-1.0e-6, -1.2e-6, -1.5e-6, -1.9e-6, -2.4e-6],   # divergence [s^-1]\n            0.0                                              # omega at top [Pa s^-1]\n        ),\n        # Case B: zero divergence\n        (\n            [20000.0, 40000.0, 60000.0, 80000.0, 100000.0],\n            [0.0, 0.0, 0.0, 0.0, 0.0],\n            0.0\n        ),\n        # Case C: sign-changing divergence, column-integrated neutrality\n        (\n            [20000.0, 40000.0, 60000.0, 80000.0, 100000.0],\n            [2.0e-6, 1.0e-6, 0.0, -1.0e-6, -2.0e-6],\n            0.0\n        ),\n    ]\n\n    results = []\n    for pressures, divergences, omega_top in test_cases:\n        omega_profile = integrate_omega(pressures, divergences, omega_top)\n        results.append(omega_profile)\n\n    # Final print statement in the exact required format.\n    # Print as a single line: list of lists of floats.\n    def format_list(lst):\n        return \"[\" + \",\".join(f\"{x:.12g}\" for x in lst) + \"]\"\n    print(\"[\" + \",\".join(format_list(r) for r in results) + \"]\")\n\nsolve()\n```"
        }
    ]
}