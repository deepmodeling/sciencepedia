{
    "hands_on_practices": [
        {
            "introduction": "这项练习旨在建立一个核心的统计指标与系统物理属性之间的基本联系。您将应用一阶自相关系数（$\\rho_1$）与 e-折恢复时间（$\\tau$）之间的数学关系，来量化临界慢化的具体效应。这项实践将帮助您直观地理解，当系统接近临界过渡点时，其恢复到平衡状态的速度是如何急剧变慢的。",
            "id": "4033204",
            "problem": "一个接近稳定平衡的气候子系统，在数值天气预报（NWP）和气候建模中，可以被局部近似为具有随机强迫的线性弛豫动力学过程。在连续时间中，这被建模为一个Ornstein–Uhlenbeck（OU）过程。在此近似下，e折恢复时间$\\tau$表征了扰动衰减回平衡状态的速率。对于以时间间隔$\\Delta t$离散采样的时间序列，其对应的滞后一阶自相关系数$\\rho_1$与连续时间衰减之间的关系由恒等式$\\rho_1 = \\exp(-\\Delta t/\\tau)$给出，这意味着$\\tau = -\\Delta t/\\ln \\rho_1$。在转型预警信号分析中，$\\rho_1$的增加表明临界减速和$\\tau$的增长。\n\n考虑一个日分辨率的气候指数时间序列（$\\Delta t = 1$天），其估计的滞后一阶自相关系数$\\rho_1(t)$由于缓慢的外部强迫而随时间近似线性增加：$\\rho_1(t) \\approx \\rho_{1,0} + s t$，其中$t$的单位是年，$\\rho_{1,0} = 0.95$，趋势$s = 0.004\\,\\text{year}^{-1}$在$T = 10$年的时间里持续均匀。假设在整个区间内$0  \\rho_1(t)  1$，这与一个平稳的一阶自回归（AR(1)）模型一致。\n\n使用关系式$\\tau = -\\Delta t/\\ln \\rho_1$，计算在$T=10$年内的e折恢复时间的预期变化量$\\Delta \\tau = \\tau(T) - \\tau(0)$。请用天数表示您的最终答案，并四舍五入到四位有效数字。",
            "solution": "问题陈述经过验证。\n\n步骤1：提取给定条件\n- e折恢复时间$τ$、滞后一阶自相关系数$ρ_1$和采样间隔$Δt$之间的关系由$ρ_1 = \\exp(-\\Delta t/\\tau)$给出，这意味着$τ = -\\Delta t/\\ln ρ_1$。\n- 时间序列是日分辨率的，所以采样间隔为$Δt = 1$天。\n- 滞后一阶自相关系数$ρ_1$随时间$t$（单位为年）根据线性模型$ρ_1(t) \\approx ρ_{1,0} + s t$变化。\n- 在$t=0$时的初始自相关为$ρ_{1,0} = 0.95$。\n- 自相关的趋势为$s = 0.004\\,\\text{year}^{-1}$。\n- 计算变化的总时长为$T = 10$年。\n- 提供了一个假设：在分析期间$0  ρ_1(t)  1$。\n- 目标是计算e折恢复时间的变化量$Δτ = τ(T) - τ(0)$，并以天为单位表示结果，四舍五入到四位有效数字。\n\n步骤2：使用提取的给定条件进行验证\n- **科学依据**：该问题基于临界转型预警信号的既定理论，特别是临界减速的概念。Ornstein-Uhlenbeck过程是随机强迫线性系统的典型模型，其连续时间衰减率与离散时间自相关之间的关系是标准且正确的。应用于气候建模是适当且现实的。\n- **适定性**：该问题提供了所有必要的参数和一个明确的目标。可以通过直接计算确定唯一解。\n- **客观性**：该问题使用精确、定量和无偏见的语言陈述。\n- **完整性与一致性**：该问题是自洽的。单位是一致的：$ρ_1(t)$是无量纲的，因为$ρ_{1,0}$是无量纲的，并且乘积$st$的单位是$(\\text{year}^{-1}) \\times (\\text{year})$，也是无量纲的。$τ$的公式将产生以$Δt$（天）为单位的结果，这与最终答案的要求相符。假设$0  ρ_1(t)  1$得到检验：在$t=0$时，$ρ_1(0) = 0.95$；在$t=T=10$时，$ρ_1(10) = 0.95 + 0.004 \\times 10 = 0.99$。由于$ρ_1(t)$是$t$的线性函数，它在$[0, 10]$内的所有$t$值下都保持在区间$(0, 1)$内。\n- **其他缺陷**：该问题并非不切实际、不适定、微不足道或无法验证。\n\n步骤3：结论与行动\n该问题有效。将推导解答。\n\ne折恢复时间$τ$作为滞后一阶自相关系数$ρ_1$的函数给出：\n$$ \\tau(\\rho_1) = -\\frac{\\Delta t}{\\ln \\rho_1} $$\n滞后一阶自相关系数$ρ_1$本身是时间$t$的函数：\n$$ \\rho_1(t) = \\rho_{1,0} + s t $$\n因此，恢复时间$τ$作为时间$t$的函数可以写成：\n$$ \\tau(t) = -\\frac{\\Delta t}{\\ln(\\rho_{1,0} + s t)} $$\n目标是计算从$t=0$到$t=T$的时间区间内恢复时间的变化量$Δτ$。\n$$ \\Delta\\tau = \\tau(T) - \\tau(0) $$\n\n首先，我们计算初始时间$t=0$时的恢复时间。\n在$t=0$时的自相关为：\n$$ \\rho_1(0) = \\rho_{1,0} + s(0) = \\rho_{1,0} = 0.95 $$\n对应的恢复时间是：\n$$ \\tau(0) = -\\frac{\\Delta t}{\\ln(\\rho_1(0))} = -\\frac{\\Delta t}{\\ln(0.95)} $$\n\n接下来，我们计算最终时间$t=T=10$年时的恢复时间。\n在$t=10$时的自相关为：\n$$ \\rho_1(10) = \\rho_{1,0} + sT = 0.95 + (0.004 \\,\\text{year}^{-1})(10 \\,\\text{years}) = 0.95 + 0.04 = 0.99 $$\n对应的恢复时间是：\n$$ \\tau(10) = -\\frac{\\Delta t}{\\ln(\\rho_1(10))} = -\\frac{\\Delta t}{\\ln(0.99)} $$\n\n现在，我们计算变化量$Δτ$：\n$$ \\Delta\\tau = \\tau(10) - \\tau(0) = \\left(-\\frac{\\Delta t}{\\ln(0.99)}\\right) - \\left(-\\frac{\\Delta t}{\\ln(0.95)}\\right) $$\n$$ \\Delta\\tau = \\Delta t \\left( \\frac{1}{\\ln(0.95)} - \\frac{1}{\\ln(0.99)} \\right) $$\n给定采样间隔为$Δt = 1$天。代入这个值：\n$$ \\Delta\\tau = (1 \\text{ day}) \\left( \\frac{1}{\\ln(0.95)} - \\frac{1}{\\ln(0.99)} \\right) $$\n为了获得数值，我们使用参数的自然对数：\n$$ \\ln(0.95) \\approx -0.05129329438 $$\n$$ \\ln(0.99) \\approx -0.01005033585 $$\n让我们先计算各自的恢复时间，因为这能说明“减速”的物理意义。\n$$ \\tau(0) = -\\frac{1}{\\ln(0.95)} \\approx -\\frac{1}{-0.05129329} \\approx 19.49576 \\text{ 天} $$\n$$ \\tau(10) = -\\frac{1}{\\ln(0.99)} \\approx -\\frac{1}{-0.01005034} \\approx 99.49916 \\text{ 天} $$\n变化量$Δτ$是这两个值之间的差：\n$$ \\Delta\\tau = \\tau(10) - \\tau(0) \\approx 99.49916 - 19.49576 \\approx 80.0034 \\text{ 天} $$\n题目要求最终答案四舍五入到四位有效数字。数值$80.0034$多于四位有效数字。前四位是$8$、$0$、$0$和$0$。第五位数字是$3$，小于$5$，所以我们向下舍入。\n$$ \\Delta\\tau \\approx 80.00 \\text{ 天} $$\n在$10$年期间，e折恢复时间的预期变化为$80.00$天。",
            "answer": "$$\n\\boxed{80.00}\n$$"
        },
        {
            "introduction": "真实世界的气候数据很少是平稳的，往往包含由外部强迫驱动的趋势。本练习将带您直面一个关键的实际挑战：一个潜在的趋势如何人为地夸大自相关性，从而产生虚假的预警信号。通过解析推导出估计量的偏差，您将从根本上理解为什么在进行可靠的早期预警信号分析之前，去趋势化是一个必不可少的步骤。",
            "id": "4033195",
            "problem": "考虑一个用于数值天气预报和气候模型的强迫气候时间序列，其中可观测量（例如全球平均地表温度异常）是确定性强迫响应和内部变率之和。设可观测量被建模为 $y_{t} = \\mu_{0} + \\beta t + x_{t}$，其中 $t = 1, 2, \\dots, N$，$\\mu_{0}$ 是一个常数，$\\beta$ 是由外部强迫引起的恒定线性趋势，而 $x_{t}$ 是一个满足 $x_{t} = \\phi x_{t-1} + \\varepsilon_{t}$ 的零均值平稳一阶自回归过程 $\\mathrm{AR}(1)$，其中 $|\\phi|  1$ 且 $\\varepsilon_{t}$ 是方差为 $\\sigma_{\\varepsilon}^{2}$ 的独立同分布高斯噪声。用 $\\sigma_{x}^{2}$ 表示 $x_{t}$ 的平稳方差。\n\n用于临界转换的预警信号（EWS）通常监测滞后-$1$ 阶自相关（此处记为 $\\rho_{1}$）的变化。在实际操作中，$\\rho_{1}$ 的一个常用估计量是根据去均值但未去趋势的序列计算的：\n$$\n\\hat{\\rho}_{1} \\equiv \\frac{\\sum_{t=2}^{N} \\left(y_{t} - \\bar{y}\\right)\\left(y_{t-1} - \\bar{y}\\right)}{\\sum_{t=1}^{N} \\left(y_{t} - \\bar{y}\\right)^{2}},\n$$\n其中 $\\bar{y} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} y_{t}$ 是样本均值。假设 $x_{t}$ 独立于确定性趋势分量，且 $N \\geq 4$。\n\n从上述定义以及 $\\mathrm{AR}(1)$ 过程和确定性序列时间平均的标准性质出发，推导当线性趋势被忽略时，$\\hat{\\rho}_{1}$ 的大样本期望偏差的闭式解析表达式。该偏差定义为 $\\mathrm{Bias} \\equiv \\mathbb{E}[\\hat{\\rho}_{1}] - \\phi$，并用 $N$、$\\beta$、$\\phi$ 和 $\\sigma_{x}^{2}$ 表示。在您的推导中，使用大样本 $N$ 的主阶近似 $\\mathbb{E}\\!\\left[\\sum_{t=1}^{N} \\left(x_{t} - \\bar{x}\\right)^{2}\\right] \\approx N \\sigma_{x}^{2}$ 和 $\\mathbb{E}\\!\\left[\\sum_{t=2}^{N} \\left(x_{t} - \\bar{x}\\right)\\left(x_{t-1} - \\bar{x}\\right)\\right] \\approx (N-1)\\phi \\sigma_{x}^{2}$，其中 $\\bar{x} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} x_{t}$。此外，对线性确定性分量使用精确的闭式求和。\n\n基于您的推导，简要解释为什么在强迫气候系统中，去趋势对于预警信号（EWS）检测至关重要。将最终偏差表示为单个闭式解析表达式。无需四舍五入，最终答案中也不需要单位。",
            "solution": "可观测量为 $y_{t} = m_{t} + x_{t}$，其中确定性均值为 $m_{t} \\equiv \\mu_{0} + \\beta t$，随机变率为 $x_{t}$。滞后-$1$ 阶自相关的估计量为\n$$\n\\hat{\\rho}_{1} = \\frac{\\sum_{t=2}^{N} \\left[(m_{t}-\\bar{m}) + (x_{t}-\\bar{x})\\right]\\left[(m_{t-1}-\\bar{m}) + (x_{t-1}-\\bar{x})\\right]}{\\sum_{t=1}^{N} \\left[(m_{t}-\\bar{m}) + (x_{t}-\\bar{x})\\right]^{2}},\n$$\n其中 $\\bar{m} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} m_{t}$ 且 $\\bar{x} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} x_{t}$。因为 $m_{t}$ 是确定性的且独立于 $x_{t}$，对随机分量取期望会消除形如 $(m_{t}-\\bar{m})(x_{t-1}-\\bar{x})$ 和 $(x_{t}-\\bar{x})(m_{t-1}-\\bar{m})$ 的交叉项，得到\n$$\n\\mathbb{E}\\!\\left[\\sum_{t=2}^{N} (y_{t}-\\bar{y})(y_{t-1}-\\bar{y})\\right] = \\sum_{t=2}^{N} (m_{t}-\\bar{m})(m_{t-1}-\\bar{m}) + \\mathbb{E}\\!\\left[\\sum_{t=2}^{N} (x_{t}-\\bar{x})(x_{t-1}-\\bar{x})\\right],\n$$\n和\n$$\n\\mathbb{E}\\!\\left[\\sum_{t=1}^{N} (y_{t}-\\bar{y})^{2}\\right] = \\sum_{t=1}^{N} (m_{t}-\\bar{m})^{2} + \\mathbb{E}\\!\\left[\\sum_{t=1}^{N} (x_{t}-\\bar{x})^{2}\\right].\n$$\n\n我们精确计算确定性部分的和。线性序列 $m_{t} = \\mu_{0} + \\beta t$ 的样本均值为 $\\bar{m} = \\mu_{0} + \\beta \\frac{N+1}{2}$。定义中心化的确定性序列\n$$\nd_{t} \\equiv m_{t} - \\bar{m} = \\beta\\left(t - \\frac{N+1}{2}\\right).\n$$\n则\n$$\n\\sum_{t=1}^{N} d_{t}^{2} = \\beta^{2} \\sum_{t=1}^{N} \\left(t - \\frac{N+1}{2}\\right)^{2} = \\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12},\n$$\n这是整数 $1,\\dots,N$ 绕其均值的平方和的标准结果。\n\n对于滞后-$1$ 阶确定性协方差和，注意到\n$$\nd_{t}\\,d_{t-1} = \\beta^{2}\\left(t-\\frac{N+1}{2}\\right)\\left[(t-1)-\\frac{N+1}{2}\\right] = \\beta^{2}\\left[\\left(t-\\frac{N+1}{2}\\right)^{2} - \\left(t-\\frac{N+1}{2}\\right)\\right].\n$$\n因此，\n\\begin{align*}\n\\sum_{t=2}^{N} d_{t}\\,d_{t-1}\n= \\beta^{2}\\left[\\sum_{t=2}^{N} \\left(t-\\frac{N+1}{2}\\right)^{2} - \\sum_{t=2}^{N} \\left(t-\\frac{N+1}{2}\\right)\\right] \\\\\n= \\beta^{2}\\left[\\sum_{t=1}^{N} \\left(t-\\frac{N+1}{2}\\right)^{2} - \\left(1-\\frac{N+1}{2}\\right)^{2} - \\left(\\sum_{t=1}^{N} \\left(t-\\frac{N+1}{2}\\right) - \\left(1-\\frac{N+1}{2}\\right)\\right)\\right].\n\\end{align*}\n由于 $\\sum_{t=1}^{N} \\left(t-\\frac{N+1}{2}\\right) = 0$，第二个括号简化为 $+\\left(1-\\frac{N+1}{2}\\right)$。使用 $\\left(1-\\frac{N+1}{2}\\right) = -\\frac{N-1}{2}$ 和 $\\left(1-\\frac{N+1}{2}\\right)^{2} = \\frac{(N-1)^{2}}{4}$，我们得到\n\\begin{align*}\n\\sum_{t=2}^{N} d_{t}\\,d_{t-1}\n= \\beta^{2}\\left[\\frac{N\\left(N^{2}-1\\right)}{12} - \\frac{(N-1)^{2}}{4} - \\frac{N-1}{2}\\right] \\\\\n= \\beta^{2}\\left[\\frac{N\\left(N^{2}-1\\right)}{12} - \\frac{N^{2}-1}{4}\\right] \\\\\n= \\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12}.\n\\end{align*}\n\n接下来，我们对随机部分的和使用大样本 $N$ 的期望。对于一个滞后-$1$ 阶自相关为 $\\phi$、平稳方差为 $\\sigma_{x}^{2}$ 的 $\\mathrm{AR}(1)$ 过程，主阶近似为\n$$\n\\mathbb{E}\\!\\left[\\sum_{t=1}^{N} (x_{t}-\\bar{x})^{2}\\right] \\approx N\\,\\sigma_{x}^{2}, \\qquad \\mathbb{E}\\!\\left[\\sum_{t=2}^{N} (x_{t}-\\bar{x})(x_{t-1}-\\bar{x})\\right] \\approx (N-1)\\,\\phi\\,\\sigma_{x}^{2}.\n$$\n\n结合确定性贡献和随机性贡献，$\\hat{\\rho}_{1}$ 的期望分子和分母分别为\n\\begin{align*}\n\\mathbb{E}[\\text{num}] = \\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2}, \\\\\n\\mathbb{E}[\\text{den}] = \\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}.\n\\end{align*}\n因此，\n$$\n\\mathbb{E}[\\hat{\\rho}_{1}] \\approx \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2}}{\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}}.\n$$\n相对于真实滞后-$1$ 阶自相关 $\\phi$ 的偏差为\n\\begin{align*}\n\\mathrm{Bias} \\equiv \\mathbb{E}[\\hat{\\rho}_{1}] - \\phi\n= \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2}}{\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}} - \\phi \\\\\n= \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} - \\phi\\,\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2} - \\phi\\,N\\,\\sigma_{x}^{2}}{\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}} \\\\\n= \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)}{12}\\left[(N-3) - \\phi N\\right] - \\phi\\,\\sigma_{x}^{2}}{N\\left(\\beta^{2}\\,\\frac{(N^{2}-1)}{12} + \\sigma_{x}^{2}\\right)}.\n\\end{align*}\n\n这个表达式清楚地说明了为什么在强迫气候系统中，去趋势对于预警信号检测至关重要。随着 $|\\beta|$ 增大或 $N$ 增长，确定性趋势对分子和分母的贡献都变得很强。在确定性趋势主导方差的极限下（即 $\\beta^{2}\\,\\frac{(N^{2}-1)}{12} \\gg \\sigma_{x}^{2}$），该估计量的期望值趋近于确定性比率 $\\frac{(N-3)}{N}$，对于大 $N$ 而言，该值接近于 $1$，即使真实的 $\\phi$ 值不大，这也会错误地发出临界慢化的信号。去趋势移除了确定性贡献，恢复了仅由内部变率引起的 $\\rho_{1}$ 的无偏估计，从而防止了由外部强迫而非临近动力学转换驱动的虚假预警信号检测。",
            "answer": "$$\\boxed{\\frac{\\beta^{2}\\,\\frac{(N^{2}-1)}{12}\\left[(N-3) - \\phi N\\right] - \\phi\\,\\sigma_{x}^{2}}{N\\left(\\beta^{2}\\,\\frac{(N^{2}-1)}{12} + \\sigma_{x}^{2}\\right)}}$$"
        },
        {
            "introduction": "在观测到预警指标的趋势后，我们如何确定它不是由自相关过程中的随机波动偶然产生的？这项计算练习将指导您构建一个完整的假设检验工作流程。您将学习并实践使用相位随机化代理数据来构建一个可靠的零分布，这是一种在时间序列分析中评估趋势显著性并控制假阳性率的强大技术。",
            "id": "4033207",
            "problem": "您的任务是实现一个数值实验，在平稳有色噪声的原假设下，量化检测滞后1阶自相关中递增趋势的假阳性率。滞后1阶自相关是气候建模和数值天气预报中常用的一种预警信号。检测过程必须使用通过相位随机化生成的替代数据，为趋势统计量构建一个非参数零分布。\n\n您的工作应基于以下经过充分检验的定义和事实：\n- 一个平稳的一阶自回归过程 (AR(1)) 由 $x_t = \\phi x_{t-1} + \\epsilon_t$ 给出，其中 $|\\phi|  1$ 确保平稳性，$\\epsilon_t$ 是均值为零的独立同分布高斯新息。\n- 离散傅里叶变换将一个实值序列分解为振幅和相位。在保持振幅和强制执行厄米对称性的同时随机化相位，会产生一个具有相同功率谱但相位随机化的实值替代序列，这是在平稳过程原假设下生成替代数据的标准方法。\n- 在大小为 $w$ 的窗口中的样本滞后1阶自相关的定义为 $r_1 = \\frac{\\sum_{i=1}^{w-1} (x_i - \\bar{x})(x_{i+1} - \\bar{x})}{\\sum_{i=1}^{w} (x_i - \\bar{x})^2}$，其中 $\\bar{x}$ 是窗口内的样本均值。\n- 两个等长序列之间的 Kendall 等级相关系数 (Kendall $\\tau$) 衡量单调关联的强度，其定义基于一致对和不一致对计数之差，并归一化到 $[-1,1]$ 区间内。\n\n对于每个测试用例，您的程序必须执行以下操作：\n$1.$ 生成 $R$ 个独立的、长度为 $N$、参数为 $\\phi$、单位方差高斯新息的平稳 AR(1) 过程实现。在分析之前，将每个实现标准化为零均值和单位方差。\n$2.$ 对于每个实现，使用长度为 $w$ 的窗口，以固定步长 $\\Delta$（记为 “step”）前进，计算一个滚动窗口滞后1阶自相关序列。设共有 $M$ 个窗口，并设 $a_j$ 表示在窗口 $j$ 中计算的滞后1阶自相关，其中 $j = 1, 2, \\dots, M$。计算索引序列 $\\{1, 2, \\dots, M\\}$ 与序列 $\\{a_j\\}_{j=1}^M$ 之间的 Kendall $\\tau$，记为 $\\tau_{\\mathrm{obs}}$。\n$3.$ 对于同一个实现，通过相位随机化生成 $S$ 个替代序列：\n- 使用实数到复数的变换计算实值离散傅里叶变换，保留振幅谱，为所有正频率从 $[0, 2\\pi)$ 中均匀抽取独立相位，将零频率和奈奎斯特分量（如果存在）的相位设置为零，然后进行逆变换以获得一个实值替代序列。将每个替代序列标准化为零均值和单位方差。\n- 对于每个替代序列，以与原始序列相同的方式计算滚动窗口滞后1阶自相关序列及其 Kendall $\\tau$，得到 $\\{\\tau_s^{(k)}\\}_{k=1}^S$。\n$4.$ 通过将 $\\tau_{\\mathrm{obs}}$ 与替代分布 $\\{\\tau_s^{(k)}\\}_{k=1}^S$ 的经验 $(1 - \\alpha)$ 分位数进行比较，执行单边检验以检测递增趋势。如果 $\\tau_{\\mathrm{obs}}$ 严格大于此分位数，则声明检测到信号。\n$5.$ 计算假阳性率，即被声明为检测到信号的实现所占的比例，该比例估计了原假设下出现虚假检测的概率。将此结果报告为一个在 $[0,1]$ 区间内的实数。\n\n不涉及角度单位。没有需要报告的物理单位。所有概率必须以小数表示。\n\n测试套件：\n对于以下每个参数集 $(\\phi, N, w, \\Delta, R, S, \\alpha)$，按上述规定计算假阳性率。使用固定的随机种子以确保结果是可复现的。\n- 案例 $1$：$(0, 512, 64, 4, 30, 100, 0.1)$。\n- 案例 $2$：$(0.5, 512, 64, 4, 30, 100, 0.1)$。\n- 案例 $3$：$(0.9, 512, 64, 4, 30, 100, 0.1)$。\n- 案例 $4$：$(0.5, 256, 128, 16, 20, 80, 0.05)$。\n\n实现约束：\n- 在计算滚动自相关之前，对每个时间序列（原始序列和替代序列）进行标准化。\n- 如果 Kendall $\\tau$ 因退化（例如，常数序列）而未定义，则在测试中将其视为零。\n- 对所有随机数生成使用固定的随机种子 $2025$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的浮点数列表，该列表用方括号括起，浮点数四舍五入到三位小数，分别对应案例 $1$ 到 $4$ 的结果（例如，“[$0.103,0.087,0.112,0.054$]”）。",
            "solution": "用户提供了一个科学上合理且定义明确的问题。该请求是实现一个数值实验，以估计一种统计检验的假阳性率，该检验用于检测滞后1阶自相关中的递增趋势，这是一种常见的临界转变预警信号。该检验在平稳过程（具体为一阶自回归(AR(1))模型）的原假设下进行。该方法论涉及通过相位随机化生成替代数据，以构建一个非参数零分布。\n\n该问题是有效的，因为它基于时间序列分析和统计假设检验的标准原理，提供了一套完整且明确的指令和参数，并且在计算上是可行的。所有术语都有明确定义，且过程在逻辑上是一致的。\n\n解决方案将通过系统地实现所述步骤来构建。\n\n**1. 原假设数据的生成**\n\n原假设是观测到的时间序列是一个平稳、线性随机过程的实现。我们对 $R$ 个实现中的每一个都使用一个平稳的一阶自回归(AR(1))过程来对此进行建模。AR(1)过程由以下方程定义：\n$$x_t = \\phi x_{t-1} + \\epsilon_t$$\n其中 $t$ 是时间索引，$\\phi$ 是自回归系数（对于平稳性，$|\\phi|  1$），$\\epsilon_t$ 是从标准正态分布 $\\mathcal{N}(0, 1)$ 中抽取的独立同分布(i.i.d.)随机变量序列。对于每个长度为 $N$ 的实现，我们生成时间序列，然后将其标准化，使其均值为 $0$，标准差为 $1$。这种标准化是确保后续统计量不受原始实现的任意均值或方差影响的关键步骤。\n\n**2. 观测趋势统计量 $\\tau_{\\mathrm{obs}}$ 的计算**\n\n对于每个标准化的实现，我们分析其滞后1阶自相关的趋势。这是通过滚动窗口方法完成的。\n首先，我们将一个固定大小 $w$ 的窗口在时间序列上滑动，步长为 $\\Delta$。窗口数量 $M$ 由 $M = \\lfloor (N - w) / \\Delta \\rfloor + 1$ 给出。\n在每个窗口 $j = 1, \\dots, M$ 中，我们计算样本滞后1阶自相关 $a_j$。根据规定，公式为：\n$$r_1 = \\frac{\\sum_{i=1}^{w-1} (x_i - \\bar{x})(x_{i+1} - \\bar{x})}{\\sum_{i=1}^{w} (x_i - \\bar{x})^2}$$\n其中 $\\bar{x}$ 是该特定窗口内数据点的均值。该计算产生一个新的自相关值时间序列 $\\{a_j\\}_{j=1}^M$。\n\n接下来，我们量化这个自相关序列 $\\{a_j\\}$ 的单调趋势。我们使用 Kendall 等级相关系数 $\\tau$，它衡量窗口索引 $\\{1, 2, \\dots, M\\}$ 与相应自相关值 $\\{a_j\\}_{j=1}^M$ 之间的序数关联。正的 $\\tau$ 表示递增趋势。该值是我们的观测检验统计量 $\\tau_{\\mathrm{obs}}$。如果自相关序列是常数，导致退化情况，$\\tau$ 被视为 0。\n\n**3. 替代零分布的生成**\n\n为了评估 $\\tau_{\\mathrm{obs}}$ 的统计显著性，我们将其与原假设下预期的 $\\tau$ 值分布进行比较。这个零分布是使用替代数据凭经验生成的。对于 $R$ 个原始实现中的每一个，我们生成 $S$ 个替代时间序列。\n\n替代序列是使用相位随机化技术创建的。该方法保留了原始序列的功率谱（以及因此的自相关结构），同时通过在频域中随机化相位信息来破坏任何非线性或非平稳特征。过程如下：\na. 对标准化的时间序列进行实数到复数的离散傅里叶变换(DFT)。这将产生一组复系数，每个系数都有振幅和相位。\nb. 振幅保持不变。\nc. 从 $[0, 2\\pi)$ 上的均匀分布中独立抽取新的相位。\nd. 为确保逆变换得到的序列是实值的，将零频率（直流）分量的相位设置为 0。如果序列长度 $N$ 是偶数，奈奎斯特频率的相位也设置为 0。\ne. 从原始振幅和一组新的随机相位构建新的复傅里叶系数。\nf. 对这些新系数应用逆 DFT 以获得一个实值替代序列。\ng. 将得到的 $S$ 个替代序列中的每一个都标准化，使其均值为零，方差为一。\n\n对于每个替代序列，我们重复步骤 2 的过程：计算滚动窗口滞后1阶自相关序列及其 Kendall $\\tau$ 统计量，记为 $\\tau_s^{(k)}$，其中 $k=1, \\dots, S$。\n\n**4. 假设检验**\n\n替代统计量的集合 $\\{\\tau_s^{(k)}\\}_{k=1}^S$ 构成了趋势统计量的经验零分布。我们执行单边假设检验，以确定观测到的趋势 $\\tau_{\\mathrm{obs}}$ 是否显著为正。我们从替代分布中找到临界值，即其 $(1-\\alpha)$ 分位数，其中 $\\alpha$ 是期望的显著性水平。如果 $\\tau_{\\mathrm{obs}}$ 严格大于此临界值，则声明检测到信号（即拒绝原假设）。\n\n**5. 假阳性率计算**\n\n对 $R$ 个独立的 AR(1) 过程实现重复整个过程（步骤 1 到 4）。由于所有这些实现根据构造都来自平稳的零模型，任何声明的检测都是假阳性（第一类错误）。假阳性率 (FPR) 估计为检测总数除以实现总数 $R$。\n$$\\text{FPR} = \\frac{\\text{检测次数}}{R}$$\n理论上，这个值应该接近所选的显著性水平 $\\alpha$。算法将为每个给定的参数集计算此 FPR。为保证可复现性，所有随机数生成都将从单个固定种子初始化。",
            "answer": "```python\nimport numpy as np\nimport scipy.stats\nimport scipy.fft\n\ndef solve():\n    \"\"\"\n    Main function to run the numerical experiment for all test cases.\n    \"\"\"\n\n    def generate_ar1(phi, N, rng):\n        \"\"\"\n        Generates a single realization of a stationary AR(1) process.\n        x_t = phi * x_{t-1} + epsilon_t\n        \"\"\"\n        epsilon = rng.normal(loc=0.0, scale=1.0, size=N)\n        x = np.zeros(N)\n        # No burn-in specified, start with x[0] = epsilon[0]\n        x[0] = epsilon[0]\n        for t in range(1, N):\n            x[t] = phi * x[t - 1] + epsilon[t]\n        return x\n\n    def standardize(series):\n        \"\"\"\n        Standardizes a time series to have zero mean and unit variance.\n        \"\"\"\n        s_std = np.std(series)\n        if s_std == 0:\n            # For a constant series, return a zero series.\n            return series - np.mean(series)\n        return (series - np.mean(series)) / s_std\n\n    def rolling_autocorr(series, w, delta):\n        \"\"\"\n        Computes rolling-window lag-1 autocorrelation based on the problem's formula.\n        \"\"\"\n        N = len(series)\n        autocorrs = []\n        # Iterate over the starting index of each window\n        for i in range(0, N - w + 1, delta):\n            window = series[i : i + w]\n            \n            # Use specified formula for lag-1 autocorrelation\n            mean_w = np.mean(window)\n            var_w = np.sum((window - mean_w)**2)\n\n            if var_w == 0:\n                autocorrs.append(0.0)\n                continue\n\n            # Numerator: sum_{i=1 to w-1} (x_i - x_bar)(x_{i+1} - x_bar)\n            x_lagged = window[:-1]\n            x_shifted = window[1:]\n            numerator = np.sum((x_lagged - mean_w) * (x_shifted - mean_w))\n            \n            autocorrs.append(numerator / var_w)\n            \n        return np.array(autocorrs)\n\n    def calculate_tau(series, w, delta):\n        \"\"\"\n        Calculates Kendall's tau for the trend in a rolling autocorrelation sequence.\n        \"\"\"\n        autocorrs = rolling_autocorr(series, w, delta)\n        M = len(autocorrs)\n        \n        # Tau is not well-defined for fewer than 2 points.\n        if M  2:\n            return 0.0\n        \n        # Calculate Kendall's tau against the window index sequence.\n        tau, _ = scipy.stats.kendalltau(np.arange(M), autocorrs)\n        \n        # Per problem spec, treat degenerate cases (which result in NaN) as zero.\n        if np.isnan(tau):\n            return 0.0\n        \n        return tau\n\n    def generate_surrogate(series, rng):\n        \"\"\"\n        Generates a surrogate time series using phase randomization.\n        \"\"\"\n        N = len(series)\n        \n        # 1. Compute DFT\n        fft_coeffs = scipy.fft.rfft(series)\n        amplitudes = np.abs(fft_coeffs)\n        \n        # 2. Randomize phases\n        num_freqs = len(fft_coeffs)\n        random_phases = rng.uniform(0, 2 * np.pi, size=num_freqs)\n        \n        # 3. Enforce real-valued constraints\n        # DC component (f=0) must have phase 0\n        random_phases[0] = 0\n        # Nyquist frequency (if N is even) must have phase 0\n        if N % 2 == 0:\n            random_phases[-1] = 0\n            \n        # 4. Create new complex coefficients\n        new_fft_coeffs = amplitudes * np.exp(1j * random_phases)\n        \n        # 5. Inverse DFT to get real-valued surrogate\n        surrogate = scipy.fft.irfft(new_fft_coeffs, n=N)\n        \n        return surrogate\n\n    # Per problem spec, use a fixed seed for all random number generation.\n    rng = np.random.default_rng(2025)\n\n    test_cases = [\n        # (phi, N, w, delta, R, S, alpha)\n        (0.0, 512, 64, 4, 30, 100, 0.1),\n        (0.5, 512, 64, 4, 30, 100, 0.1),\n        (0.9, 512, 64, 4, 30, 100, 0.1),\n        (0.5, 256, 128, 16, 20, 80, 0.05),\n    ]\n\n    final_results = []\n\n    for phi, N, w, delta, R, S, alpha in test_cases:\n        detection_count = 0\n        for _ in range(R):\n            # 1. Generate and standardize the original time series\n            original_series = generate_ar1(phi, N, rng)\n            std_original_series = standardize(original_series)\n\n            # 2. Compute the observed trend statistic\n            tau_obs = calculate_tau(std_original_series, w, delta)\n\n            # 3. Generate surrogate distribution of tau\n            tau_surrogates = np.empty(S)\n            for k in range(S):\n                surrogate_series = generate_surrogate(std_original_series, rng)\n                std_surrogate = standardize(surrogate_series)\n                tau_surrogates[k] = calculate_tau(std_surrogate, w, delta)\n\n            # 4. Perform the one-sided hypothesis test\n            # np.quantile interpolation='higher' is equivalent to the (1-alpha) empirical quantile\n            critical_value = np.quantile(tau_surrogates, 1 - alpha, interpolation='higher')\n            if tau_obs > critical_value:\n                detection_count += 1\n        \n        # 5. Compute the false positive rate\n        fpr = detection_count / R\n        final_results.append(fpr)\n\n    # Format the final output as specified.\n    print(f\"[{','.join(f'{r:.3f}' for r in final_results)}]\")\n\nsolve()\n```"
        }
    ]
}