{
    "hands_on_practices": [
        {
            "introduction": "To understand climate feedbacks, we must first master the fundamental components of the Earth's energy budget. This exercise grounds our study in one of the most critical surface properties: albedo, which governs how much solar energy is absorbed versus reflected. By deriving the expression for absorbed shortwave radiation and applying it to a realistic scenario, you will solidify your understanding of the direct role surface characteristics play in the planet's radiative balance .",
            "id": "4111686",
            "problem": "In a single-column surface energy balance used in numerical weather prediction (NWP) and climate modeling, the downwelling shortwave (SW) irradiance at the surface is denoted by $S$ and the surface albedo is denoted by $\\alpha$. The albedo is defined as the fraction of incident SW radiation reflected by the surface, and it is a key parameter in surface albedo feedbacks that couple with water vapor and lapse rate feedbacks in the climate system.\n\nStarting from the definition of surface albedo as the ratio of upwelling reflected SW flux to downwelling SW flux at the surface, and using conservation of radiative energy at the surface for the SW band, derive an expression for the absorbed SW flux at the surface, written in terms of $\\alpha$ and $S$ only.\n\nThen evaluate this absorbed SW flux for a snow-covered surface with $\\alpha = 0.60$ and incident downwelling SW $S = 300\\,\\mathrm{W\\,m^{-2}}$. Express the final absorbed SW flux in $\\mathrm{W\\,m^{-2}}$ and round your answer to three significant figures.",
            "solution": "The solution begins by defining the relevant radiative fluxes at the surface and applying the principle of energy conservation. Let the incident downwelling shortwave (SW) flux be $S$, the reflected upwelling SW flux be $S_{\\text{up}}$, and the absorbed SW flux be $S_{\\text{abs}}$.\n\nThe definition of surface albedo, $\\alpha$, is the ratio of reflected flux to incident flux:\n$$ \\alpha = \\frac{S_{\\text{up}}}{S} $$\nThis allows us to express the reflected flux as:\n$$ S_{\\text{up}} = \\alpha S $$\n\nThe principle of energy conservation for the SW band at the surface states that the incident flux must be either reflected or absorbed. This can be written as an energy balance equation:\n$$ S = S_{\\text{up}} + S_{\\text{abs}} $$\nTo derive the expression for the absorbed flux, $S_{\\text{abs}}$, we substitute the expression for $S_{\\text{up}}$ from the albedo definition into the energy balance equation:\n$$ S = (\\alpha S) + S_{\\text{abs}} $$\nRearranging the terms to solve for $S_{\\text{abs}}$ gives:\n$$ S_{\\text{abs}} = S - \\alpha S $$\nFactoring out the incident flux $S$ yields the final expression for the absorbed SW flux in terms of $\\alpha$ and $S$:\n$$ S_{\\text{abs}} = S(1 - \\alpha) $$\n\nNext, we evaluate this expression for the given values: a snow-covered surface with albedo $\\alpha = 0.60$ and an incident downwelling SW flux $S = 300\\,\\mathrm{W\\,m^{-2}}$.\n$$ S_{\\text{abs}} = 300 \\times (1 - 0.60) $$\n$$ S_{\\text{abs}} = 300 \\times 0.40 = 120 $$\nThe absorbed flux is $120\\,\\mathrm{W\\,m^{-2}}$.\n\nThe problem requires the answer to be rounded to three significant figures. The calculated value is exactly 120. To express this with three significant figures, it can be written in scientific notation:\n$$ 1.20 \\times 10^2 $$\nThus, the absorbed SW flux is $1.20 \\times 10^2\\,\\mathrm{W\\,m^{-2}}$.",
            "answer": "$$\\boxed{1.20 \\times 10^2}$$"
        },
        {
            "introduction": "The strength of water vapor feedback is intricately linked to the thermodynamics of phase changes, a process that becomes particularly complex in cold regions where surface albedo feedbacks are strongest. This practice moves beyond simple saturation to explore the crucial distinction between saturation vapor pressure over supercooled liquid water and over ice, a difference driven by their respective latent heats. By deriving and calculating this difference using the Clausius-Clapeyron relation, you will gain insight into a key microphysical process that modulates atmospheric water vapor content and radiative properties in polar climates .",
            "id": "4111697",
            "problem": "A central distinction in thermodynamics relevant to Numerical Weather Prediction (NWP) and climate modeling is that the saturation vapor pressure with respect to liquid water versus with respect to ice arises from different phase-change energetics: condensation involves the latent heat of vaporization, while deposition involves the latent heat of sublimation. In cold regions, this distinction modulates water vapor concentrations and thus the strength of water vapor and lapse rate feedbacks coupled to surface albedo changes. Starting from the equality of Gibbs free energies at phase equilibrium and the Clausius–Clapeyron differential relation for a pure substance, assume water vapor behaves as an ideal gas and the condensed phases (liquid and ice) are incompressible. Use a reference temperature $T_{0}=273.15\\,\\mathrm{K}$ and a common reference saturation vapor pressure $e_{s,0}=611.2\\,\\mathrm{Pa}$ at $T_{0}$ for both liquid and ice, and assume constant latent heats over the interval $[260\\,\\mathrm{K},\\,273.15\\,\\mathrm{K}]$. Take the specific gas constant for water vapor $R_{v}=461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$, the latent heat of vaporization at $T_{0}$ as $L_{v}=2.500\\times 10^{6}\\,\\mathrm{J\\,kg^{-1}}$, and the latent heat of fusion near $T_{0}$ as $L_{f}=3.337\\times 10^{5}\\,\\mathrm{J\\,kg^{-1}}$ so that the latent heat of sublimation is $L_{s}=L_{v}+L_{f}$. Derive expressions for $e_{s,\\mathrm{liq}}(T)$ and $e_{s,\\mathrm{ice}}(T)$ via integration of the Clausius–Clapeyron relation, and evaluate them at $T=260\\,\\mathrm{K}$, expressing intermediate saturation vapor pressures in pascals. Then, report as your final answer the unitless ratio $e_{s,\\mathrm{ice}}(260\\,\\mathrm{K})/e_{s,\\mathrm{liq}}(260\\,\\mathrm{K})$. Round your final ratio to four significant figures and express it as a decimal.",
            "solution": "The solution starts from the Clausius–Clapeyron relation, which describes the temperature dependence of saturation vapor pressure. Under the assumptions that water vapor behaves as an ideal gas and the specific volume of the condensed phase is negligible, the relation is:\n$$ \\frac{de_s}{e_s} = \\frac{L}{R_v} \\frac{dT}{T^2} $$\nwhere $e_s$ is saturation vapor pressure, $T$ is temperature, $L$ is the specific latent heat of the phase change, and $R_v$ is the specific gas constant for water vapor.\n\nAssuming $L$ is constant, we integrate this equation from a reference state $(T_0, e_{s,0})$ to a state $(T, e_s(T))$:\n$$ \\int_{e_{s,0}}^{e_s(T)} \\frac{de'_s}{e'_s} = \\frac{L}{R_v} \\int_{T_0}^{T} \\frac{dT'}{T'^2} $$\n$$ \\ln\\left(\\frac{e_s(T)}{e_{s,0}}\\right) = \\frac{L}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{T} \\right) $$\nExponentiating gives the general solution:\n$$ e_s(T) = e_{s,0} \\exp\\left[ \\frac{L}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{T} \\right) \\right] $$\nThis expression is used for both saturation over supercooled liquid water ($e_{s,\\mathrm{liq}}$), where $L = L_v$, and saturation over ice ($e_{s,\\mathrm{ice}}$), where $L = L_s = L_v + L_f$.\n\nThe problem asks for the ratio $e_{s,\\mathrm{ice}}(T)/e_{s,\\mathrm{liq}}(T)$. Using the derived expression:\n$$ \\frac{e_{s,\\mathrm{ice}}(T)}{e_{s,\\mathrm{liq}}(T)} = \\frac{e_{s,0} \\exp\\left[ \\frac{L_s}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{T} \\right) \\right]}{e_{s,0} \\exp\\left[ \\frac{L_v}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{T} \\right) \\right]} = \\exp\\left[ \\frac{L_s - L_v}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{T} \\right) \\right] $$\nSince $L_s - L_v = L_f$ (the latent heat of fusion), the ratio simplifies to:\n$$ \\frac{e_{s,\\mathrm{ice}}(T)}{e_{s,\\mathrm{liq}}(T)} = \\exp\\left[ \\frac{L_f}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{T} \\right) \\right] $$\nNow we substitute the given numerical values to find the ratio at $T=260\\,\\mathrm{K}$:\n- $L_f = 3.337 \\times 10^5\\,\\mathrm{J\\,kg^{-1}}$\n- $R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- $T_0 = 273.15\\,\\mathrm{K}$\n- $T = 260\\,\\mathrm{K}$\n\nFirst, calculate the constant terms:\n$$ \\frac{L_f}{R_v} = \\frac{3.337 \\times 10^5}{461.5} \\approx 723.0878\\,\\mathrm{K} $$\n$$ \\frac{1}{T_0} - \\frac{1}{T} = \\frac{1}{273.15} - \\frac{1}{260} \\approx -1.85152 \\times 10^{-4}\\,\\mathrm{K}^{-1} $$\nNow, compute the exponent:\n$$ \\text{Exponent} = (723.0878) \\times (-1.85152 \\times 10^{-4}) \\approx -0.133883 $$\nFinally, calculate the ratio:\n$$ \\frac{e_{s,\\mathrm{ice}}(260\\,\\mathrm{K})}{e_{s,\\mathrm{liq}}(260\\,\\mathrm{K})} = \\exp(-0.133883) \\approx 0.874697 $$\nRounding the result to four significant figures gives $0.8747$.",
            "answer": "$$\\boxed{0.8747}$$"
        },
        {
            "introduction": "Climate feedbacks are not static; their magnitudes can depend profoundly on the background climate state and the timing of perturbations. This capstone exercise challenges you to synthesize your knowledge by building a simple numerical model that captures the dynamic and non-linear nature of the snow-albedo feedback. By implementing a physically plausible parameterization that includes hysteresis—the memory of past melt-freeze cycles in the snowpack—you will investigate how the feedback strength, $\\lambda_{\\alpha}$, varies with the seasonal timing of a warming event, providing a hands-on perspective on advanced topics in climate modeling .",
            "id": "4111728",
            "problem": "You are to design and implement a complete, runnable program that constructs a physically plausible surface albedo parameterization for snow with hysteresis due to melt–refreeze cycles and uses it within a simple energy balance framework to quantify how the seasonal timing of warming alters the surface albedo feedback parameter. The task must be solved from first principles appropriate to numerical weather prediction and climate modeling, using conservation of energy and standard definitions of radiative fluxes at the Top of the Atmosphere (TOA) and basic thermodynamic thresholds for snow.\n\nBegin from the following foundations:\n- Conservation of energy at the Top of the Atmosphere (TOA): the net downward radiative flux is the difference between absorbed shortwave radiation and outgoing longwave radiation. You will isolate the contribution of surface albedo changes to the absorbed shortwave radiation.\n- Definition of surface albedo: the fraction of incident shortwave radiation reflected by the surface. The contribution of surface albedo to TOA absorbed shortwave radiation is the incident shortwave radiation multiplied by one minus the albedo.\n- Seasonal cycles of insolation and temperature are represented by smooth functions over the year.\n- Hysteresis in snow albedo due to melt–refreeze cycles: once snow has undergone a spring melt episode, subsequent refreezing does not fully restore the high albedo of fresh snow until the next cold season’s fresh snowfall, and the albedo remains lower in the refrozen state until a seasonal reset.\n\nYou must implement the following model components and calculations:\n\n1. Seasonal insolation at the TOA. Let time $t$ span one year as a nondimensional variable in the interval $[0,1)$ with daily resolution. Define the TOA insolation as\n$$\nS(t) = S_0 + S_1 \\cos\\left(2\\pi\\left(t - t_S\\right)\\right),\n$$\nwhere $S_0 = 340\\,\\mathrm{W\\,m^{-2}}$, $S_1 = 120\\,\\mathrm{W\\,m^{-2}}$, and $t_S = 0.5$ (peak insolation at mid-summer).\n\n2. Baseline near-surface air temperature seasonal cycle. Define\n$$\nT_{\\mathrm{base}}(t) = T_{\\mathrm{mean}} + T_{\\mathrm{amp}} \\cos\\left(2\\pi\\left(t - t_T\\right)\\right),\n$$\nwhere $T_{\\mathrm{mean}} = 270\\,\\mathrm{K}$, $T_{\\mathrm{amp}} = 18\\,\\mathrm{K}$, and $t_T = 0.0$.\n\n3. Seasonally timed warming perturbation. Superimpose an additive Gaussian-shaped anomaly,\n$$\nG(t; t_{\\mathrm{warm}}, \\sigma) = \\exp\\left(-\\frac{d(t,t_{\\mathrm{warm}})^2}{2\\sigma^2}\\right),\n$$\nwhere $d(t,t_{\\mathrm{warm}})$ is the shortest periodic distance on the unit circle between $t$ and $t_{\\mathrm{warm}}$, and $\\sigma$ controls the width. The perturbed temperature is\n$$\nT_{\\mathrm{pert}}(t) = T_{\\mathrm{base}}(t) + \\Delta T_{\\mathrm{amp}}\\,G(t; t_{\\mathrm{warm}}, \\sigma),\n$$\nwith $\\Delta T_{\\mathrm{amp}} = 2\\,\\mathrm{K}$ and $\\sigma = 0.08$ (i.e., approximately one month in fractional-year units). The baseline corresponds to $\\Delta T_{\\mathrm{amp}} = 0\\,\\mathrm{K}$.\n\n4. Snow cover fraction parameterization. Define the snow-covered fraction as a logistic function of temperature,\n$$\nF_s\\!\\left(T(t)\\right) = \\frac{1}{1 + \\exp\\left(\\frac{T(t) - T_s}{k_T}\\right)},\n$$\nwith $T_s = 273.15\\,\\mathrm{K}$ and $k_T = 2\\,\\mathrm{K}$.\n\n5. Snow albedo hysteresis. Let the snow albedo take one of two values depending on a state variable that encodes hysteresis:\n- Fresh snow albedo $ \\alpha_{\\mathrm{fresh}} = 0.85$.\n- Refrozen/old snow albedo $ \\alpha_{\\mathrm{old}} = 0.65$.\n- Ground albedo (no snow) $ \\alpha_{\\mathrm{ground}} = 0.20$.\n\nLet a binary state $h(t) \\in \\{0,1\\}$ represent whether the snow is fresh ($h=1$) or refrozen/old ($h=0$). Initialize $h$ at $t=0$ by $h(0) = 1$ if $T_{\\mathrm{series}}(0) \\le T_m - 5\\,\\mathrm{K}$ and $h(0) = 0$ otherwise, where $T_m = 273.15\\,\\mathrm{K}$. Update $h(t)$ daily using the following hysteresis rules applied to the temperature series being considered ($T_{\\mathrm{series}}$ denotes either the baseline or perturbed temperature time series):\n- Melt transition: if there is any contiguous run of $d_m = 5$ or more days for which $T_{\\mathrm{series}}(t)  T_m$, then set $h(t') = 0$ for all subsequent times $t'$ until a seasonal reset occurs.\n- Seasonal reset (fresh snow): if after $t  0.75$ there is any contiguous run of $d_f = 5$ or more days for which $T_{\\mathrm{series}}(t)  T_f$, where $T_f = 268.15\\,\\mathrm{K}$, then set $h(t') = 1$ for all subsequent times $t'$ until the next melt transition occurs.\n\nGiven $h(t)$, define the instantaneous snow albedo as\n$$\n\\alpha_{\\mathrm{snow}}(t) = h(t)\\,\\alpha_{\\mathrm{fresh}} + \\left(1 - h(t)\\right)\\,\\alpha_{\\mathrm{old}},\n$$\nand the effective surface albedo as\n$$\n\\alpha(t) = F_s\\!\\left(T(t)\\right)\\,\\alpha_{\\mathrm{snow}}(t) + \\left(1 - F_s\\!\\left(T(t)\\right)\\right)\\,\\alpha_{\\mathrm{ground}}.\n$$\n\n6. Albedo feedback parameter. Define the contribution of surface albedo to the absorbed shortwave at the TOA as\n$$\nR_\\alpha(t) = \\frac{S(t)}{4}\\left(1 - \\alpha(t)\\right).\n$$\nFor the baseline and perturbed cases, compute the annual-mean change in the net downward TOA flux due solely to albedo,\n$$\n\\Delta \\overline{R}_\\alpha = \\left\\langle \\frac{S(t)}{4}\\left(\\alpha_{\\mathrm{base}}(t) - \\alpha_{\\mathrm{pert}}(t)\\right) \\right\\rangle_t,\n$$\nand the annual-mean temperature change\n$$\n\\Delta \\overline{T} = \\left\\langle T_{\\mathrm{pert}}(t) - T_{\\mathrm{base}}(t) \\right\\rangle_t.\n$$\nThen the surface albedo feedback parameter is\n$$\n\\lambda_\\alpha = \\frac{\\Delta \\overline{R}_\\alpha}{\\Delta \\overline{T}},\n$$\nwhich must be expressed in $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\nImplementation requirements:\n- Use daily resolution over one year with $N = 365$ uniformly spaced points in $t \\in [0,1)$.\n- Apply the hysteresis rules separately to the baseline and perturbed temperature series to obtain $\\alpha_{\\mathrm{base}}(t)$ and $\\alpha_{\\mathrm{pert}}(t)$.\n- Compute $\\lambda_\\alpha$ as specified above for each test case.\n\nTest suite:\nEvaluate the following four parameter sets, each specified by the warming phase $t_{\\mathrm{warm}}$:\n- Case $1$: $t_{\\mathrm{warm}} = 0.33$ (warming peaked in mid-spring).\n- Case $2$: $t_{\\mathrm{warm}} = 0.00$ (warming peaked in deep winter).\n- Case $3$: $t_{\\mathrm{warm}} = 0.50$ (warming peaked in mid-summer).\n- Case $4$: $t_{\\mathrm{warm}} = 0.75$ (warming peaked in late autumn).\n\nAll other parameters are as specified above. For each case, compute $\\lambda_\\alpha$ in $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\nFinal output format:\nYour program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets, with each value rounded to three decimal places, for example, $[\\lambda_{\\alpha, 1}, \\lambda_{\\alpha, 2}, \\lambda_{\\alpha, 3}, \\lambda_{\\alpha, 4}]$, in units of $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.",
            "solution": "The problem requires the implementation of a numerical model to calculate the surface albedo feedback parameter, $\\lambda_\\alpha$, under different seasonal warming scenarios. The solution involves discretizing a one-year period into daily time steps and calculating all physical quantities for both a baseline and a perturbed climate.\n\nThe model is built upon prescribed seasonal cycles for top-of-atmosphere (TOA) insolation, $S(t)$, and baseline surface temperature, $T_{\\mathrm{base}}(t)$. A Gaussian temperature perturbation, centered at time $t_{\\mathrm{warm}}$, is added to the baseline to create the perturbed temperature series, $T_{\\mathrm{pert}}(t)$.\n\nA key component of the model is the surface albedo, which depends on both the snow cover fraction, $F_s$, and the intrinsic albedo of the snow itself, $\\alpha_{\\mathrm{snow}}$. The snow cover fraction is parameterized as a logistic function of temperature, smoothly transitioning from 1 (full cover) to 0 (no cover) around the melting point.\n\nThe intrinsic snow albedo incorporates hysteresis, a memory effect, to represent the difference between fresh, high-albedo snow and older, refrozen, low-albedo snow. A state variable, $h(t)$, tracks whether the snow is \"fresh\" ($h=1$) or \"old\" ($h=0$). The state transitions are governed by rules based on the temperature history: a prolonged period of melting switches the snow to the \"old\" state, while a prolonged cold period in late autumn/winter resets it to the \"fresh\" state. This logic is implemented as a state machine that evolves over the annual cycle.\n\nThe effective surface albedo, $\\alpha(t)$, is then the area-weighted average of the snow albedo and the bare ground albedo, using the snow cover fraction as the weight. This entire calculation is performed independently for both the baseline and perturbed temperature series, yielding $\\alpha_{\\mathrm{base}}(t)$ and $\\alpha_{\\mathrm{pert}}(t)$.\n\nFinally, the surface albedo feedback parameter, $\\lambda_\\alpha$, is computed. It is defined as the change in the annual-mean TOA net shortwave radiation due to the albedo change, divided by the annual-mean temperature change. The radiative change, $\\Delta \\overline{R}_\\alpha$, is calculated by differencing the absorbed shortwave radiation between the baseline and perturbed runs. The temperature change, $\\Delta \\overline{T}$, is the average difference between $T_{\\mathrm{pert}}(t)$ and $T_{\\mathrm{base}}(t)$. The ratio of these two quantities gives the feedback parameter in $\\mathrm{W\\,m^{-2}\\,K^{-1}}$. The provided Python code implements this logic for the four specified test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the surface albedo feedback parameter for seasonally timed warming\n    scenarios within a simple energy balance model with snow albedo hysteresis.\n    \"\"\"\n    \n    # Model parameters\n    params = {\n        'N': 365,               # Number of days in a year\n        'S0': 340.0,            # W m^-2, Mean TOA insolation\n        'S1': 120.0,            # W m^-2, Amplitude of seasonal insolation\n        't_S': 0.5,             # Fractional year, Peak insolation time (summer solstice)\n        'T_mean': 270.0,        # K, Mean annual temperature\n        'T_amp': 18.0,          # K, Amplitude of seasonal temperature cycle\n        't_T': 0.0,             # Fractional year, Peak temperature time (offset from winter solstice)\n        'Delta_T_amp': 2.0,     # K, Amplitude of warming perturbation\n        'sigma': 0.08,          # Fractional year, Width of warming perturbation\n        'T_s': 273.15,          # K, Snow/melt threshold for snow cover fraction\n        'k_T': 2.0,             # K, Width of snow cover transition\n        'alpha_fresh': 0.85,    # Albedo of fresh snow\n        'alpha_old': 0.65,      # Albedo of old/refrozen snow\n        'alpha_ground': 0.20,   # Albedo of snow-free ground\n        'T_m': 273.15,          # K, Temperature threshold for melt transition\n        'T_f': 268.15,          # K, Temperature threshold for fresh snow reset\n        'd_m': 5,               # days, Duration for melt transition\n        'd_f': 5,               # days, Duration for seasonal reset\n        'reset_t_start': 0.75   # Fractional year, Start of season for reset\n    }\n\n    # Time grid\n    t = np.linspace(0, 1, params['N'], endpoint=False)\n\n    # --- Helper Functions ---\n    def get_insolation(t_arr):\n        return params['S0'] + params['S1'] * np.cos(2 * np.pi * (t_arr - params['t_S']))\n\n    def get_temp_base(t_arr):\n        return params['T_mean'] + params['T_amp'] * np.cos(2 * np.pi * (t_arr - params['t_T']))\n\n    def get_temp_pert(t_arr, T_base_arr, t_warm):\n        diff = np.abs(t_arr - t_warm)\n        periodic_dist = np.minimum(diff, 1.0 - diff)\n        G = np.exp(-periodic_dist**2 / (2 * params['sigma']**2))\n        return T_base_arr + params['Delta_T_amp'] * G\n\n    def get_snow_cover_fraction(T_arr):\n        return 1.0 / (1.0 + np.exp((T_arr - params['T_s']) / params['k_T']))\n    \n    def process_hysteresis_state(T_series, t_series):\n        N = len(T_series)\n        h = np.zeros(N)\n        \n        # Initial state at t=0\n        if T_series[0] = params['T_m'] - 5.0:\n            h[0] = 1\n        else:\n            h[0] = 0\n            \n        is_old = h[0] == 0\n        for i in range(1, N):\n            h[i] = h[i-1] # Persist state by default\n            \n            # Check for melt transition condition (Fresh -> Old)\n            if not is_old:\n                if i >= params['d_m'] - 1:\n                    window = T_series[i - params['d_m'] + 1 : i + 1]\n                    if np.all(window > params['T_m']):\n                        is_old = True\n            \n            # Check for seasonal reset condition (Old -> Fresh)\n            if is_old:\n                if t_series[i] > params['reset_t_start']:\n                    if i >= params['d_f'] - 1:\n                        window = T_series[i - params['d_f'] + 1 : i + 1]\n                        if np.all(window  params['T_f']):\n                            is_old = False\n\n            h[i] = 0 if is_old else 1\n\n        # Propagate the melt transition backward for the first few days\n        # if it was triggered within the first d_m days\n        for i in range(1, N):\n            if h[i-1] == 1 and h[i] == 0: # Fresh -> Old transition occurred\n                if i  params['d_m']:\n                    # if a melt was triggered, all prior states must have led to it\n                    # this simplified logic just sets prior states to old\n                    h[:i] = 0\n                break # only care about the first transition\n        \n        # A more robust state propagation:\n        # A state can only be 'fresh' if it follows a 'reset' event.\n        # A state becomes 'old' after a 'melt' event and stays that way until a 'reset'.\n        h_final = np.zeros(N)\n        state_is_fresh = True\n        if T_series[0] > params['T_m'] - 5.0:\n            state_is_fresh = False\n\n        for i in range(N):\n            # Check melt condition\n            if i >= params['d_m'] - 1 and np.all(T_series[i - params['d_m'] + 1 : i + 1] > params['T_m']):\n                state_is_fresh = False\n            \n            # Check reset condition\n            if t_series[i] > params['reset_t_start'] and i >= params['d_f']-1 and np.all(T_series[i - params['d_f'] + 1 : i + 1]  params['T_f']):\n                state_is_fresh = True\n\n            if state_is_fresh:\n                h_final[i] = 1\n        \n        return h_final\n\n    def get_surface_albedo(T_arr, h_arr):\n        Fs = get_snow_cover_fraction(T_arr)\n        alpha_snow = h_arr * params['alpha_fresh'] + (1 - h_arr) * params['alpha_old']\n        return Fs * alpha_snow + (1 - Fs) * params['alpha_ground']\n\n    # --- Main Calculation Loop ---\n    test_cases = [0.33, 0.00, 0.50, 0.75]\n    results = []\n\n    # Pre-calculate time-series that are independent of the test case\n    S_t = get_insolation(t)\n    T_base_t = get_temp_base(t)\n    h_base_t = process_hysteresis_state(T_base_t, t)\n    alpha_base_t = get_surface_albedo(T_base_t, h_base_t)\n\n    for t_warm in test_cases:\n        # Calculate perturbed temperature series\n        T_pert_t = get_temp_pert(t, T_base_t, t_warm)\n\n        # Calculate hysteresis and albedo for the perturbed case\n        h_pert_t = process_hysteresis_state(T_pert_t, t)\n        alpha_pert_t = get_surface_albedo(T_pert_t, h_pert_t)\n        \n        # Calculate annual-mean changes\n        delta_R_alpha = np.mean((S_t / 4.0) * (alpha_base_t - alpha_pert_t))\n        delta_T = np.mean(T_pert_t - T_base_t)\n        \n        # Calculate feedback parameter\n        lambda_alpha = delta_R_alpha / delta_T if delta_T != 0 else 0.0\n        results.append(lambda_alpha)\n\n    # Format and print the final output\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}