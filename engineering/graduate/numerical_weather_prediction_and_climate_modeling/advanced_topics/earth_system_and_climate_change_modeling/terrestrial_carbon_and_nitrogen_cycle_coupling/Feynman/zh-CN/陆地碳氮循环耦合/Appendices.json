{
    "hands_on_practices": [
        {
            "introduction": "盒模型 (Box model) 是理解生态系统复杂动态的有力工具。通过分析模型在稳态（即输入等于输出）下的行为，我们可以揭示其长期的平衡特性和内部调控机制。该练习引导你应用质量守恒和化学计量学的核心原理，为一个简化的土壤生物地球化学系统求解稳态解，这是所有生态系统建模的基础技能 ()。",
            "id": "4099193",
            "problem": "一个与大气数值天气预报（NWP）系统和地球系统模型耦合的陆地表面生物地球化学模块，利用质量守恒和一级动力学原理来表征微生物对植物凋落物和矿质氮的处理过程。考虑一个具有以下库和通量的土壤柱：\n\n- 微生物生物量碳 $M_C$ 和微生物生物量氮 $M_N$，受设定的微生物碳氮比（C:N）$R_m$ 约束，使得在任何时候都满足 $M_N = M_C / R_m$。\n- 矿质（无机）氮 $N_{\\mathrm{min}}$，会发生淋溶，该过程表示为一级损失。\n\n植物凋落物以恒定的碳输入速率 $I_C$ 提供碳，其凋落物碳氮比（C:N）为 $R_\\ell$，因此凋落物氮的输入速率为 $I_N = I_C / R_\\ell$。微生物以碳同化效率 $y_C$ 同化一部分凋落物输入的碳，产生同化通量 $A_C = y_C I_C$，而剩余的凋落物碳则立即通过呼吸作用以二氧化碳的形式释放。微生物生物量以一级速率常数 $k_M$ 进行周转，将其含有的氮释放到矿质氮库中。微生物生物量的合成需要氮，其与碳的比例为微生物自身的比率 $R_m$；微生物首先使用与同化的凋落物碳共同提供的氮来满足这一需求，如有必要，再吸收矿质氮。矿质氮也通过大气沉降以恒定速率 $D_N$ 供应，并以一级速率常数 $k_L$ 通过淋溶作用从土壤柱中流失。\n\n假设系统已达到稳态。利用质量守恒和化学计量耦合的基本原理，在以下符合科学实际的参数值下，计算稳态库的大小 $M_C$、$M_N$ 和 $N_{\\mathrm{min}}$：\n- $I_C = 400$ g C m$^{-2}$ yr$^{-1}$，\n- $R_\\ell = 40$，\n- $y_C = 0.30$，\n- $k_M = 4$ yr$^{-1}$，\n- $R_m = 8$，\n- $D_N = 1.0$ g N m$^{-2}$ yr$^{-1}$，\n- $k_L = 4$ yr$^{-1}$。\n\n此外，请验证您计算的稳态解是否满足碳（输入等于输出）和氮（净外部输入等于净外部输出）的质量平衡，并清楚地标明相关的通量。\n\n将每个库的大小四舍五入至四位有效数字。$M_C$ 的单位为 g C m$^{-2}$，$M_N$ 和 $N_{\\mathrm{min}}$ 的单位为 g N m$^{-2}$。",
            "solution": "经评估，该问题是有效的，因为它在科学上基于生物地球化学建模的既定原则，问题阐述清晰，参数集完整且一致，并以客观、正式的语言表述。因此，我们可以着手求解。\n\n解答是根据三个状态变量（库）——微生物生物量碳（$M_C$）、微生物生物量氮（$M_N$）和矿质氮（$N_{\\mathrm{min}}$）——中每一个的质量守恒原理推导出来的。系统被假设处于稳态，这意味着对于每个库，所有输入通量之和等于所有输出通量之和。\n\n首先，我们为微生物碳库 $M_C$ 建立描述其变化率的常微分方程：\n$$\n\\frac{dM_C}{dt} = (\\text{Inputs}) - (\\text{Outputs})\n$$\n微生物碳的唯一输入是来自植物凋落物的碳同化。凋落物碳输入速率为 $I_C$，微生物同化的比例是碳同化效率 $y_C$。因此，碳同化通量为 $A_C = y_C I_C$。\n微生物碳库的输出是由于生物量周转（死亡和呼吸），该过程被建模为一级过程，速率常数为 $k_M$。因此，周转通量为 $k_M M_C$。\n$M_C$ 的质量平衡方程为：\n$$\n\\frac{dM_C}{dt} = y_C I_C - k_M M_C\n$$\n在稳态下，$\\frac{dM_C}{dt} = 0$。求解稳态微生物碳库大小，记为 $M_C^*$：\n$$\ny_C I_C - k_M M_C^* = 0 \\implies M_C^* = \\frac{y_C I_C}{k_M}\n$$\n接下来，我们确定稳态微生物氮库 $M_N^*$。问题陈述了一个严格的化学计量约束：$M_N = M_C / R_m$，其中 $R_m$ 是微生物的碳氮比。这一关系在任何时候（包括稳态时）都必须成立。\n$$\nM_N^* = \\frac{M_C^*}{R_m} = \\frac{1}{R_m} \\left( \\frac{y_C I_C}{k_M} \\right) = \\frac{y_C I_C}{k_M R_m}\n$$\n最后，我们为矿质氮库 $N_{\\mathrm{min}}$ 建立质量平衡方程。\n$$\n\\frac{dN_{\\mathrm{min}}}{dt} = (\\text{Inputs}) - (\\text{Outputs})\n$$\n矿质氮库的输入包括：\n1. 大气沉降，以恒定速率 $D_N$ 给出。\n2. 微生物周转产生的矿化。微生物碳周转通量为 $k_M M_C^*$。该生物量中的氮含量被释放到矿质库中，因此该通量为 $(k_M M_C^*) / R_m = k_M M_N^*$。\n3. 来自凋落物处理过程的净矿化或固持。微生物需要 $(y_C I_C) / R_m$ 的氮通量来支持其碳同化。凋落物本身提供的氮通量为 $I_N = I_C / R_\\ell$。凋落物供应的氮与生长所需的氮之间的平衡，决定了是向矿质库净释放氮（矿化），还是从矿质库净吸收氮（固持）。这个净通量 $F_{N, \\text{process}}$ 为：\n$$\nF_{N, \\text{process}} = (\\text{N supplied in litter}) - (\\text{N demanded for growth}) = \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m}\n$$\n如果 $F_{N, \\text{process}} > 0$，这是对 $N_{\\mathrm{min}}$ 的净输入。如果 $F_{N, \\text{process}} < 0$，其绝对值表示从 $N_{\\mathrm{min}}$ 的净输出（吸收）。\n\n矿质氮库的输出包括：\n1. 淋溶，一个速率常数为 $k_L$ 的一级损失，产生的通量为 $k_L N_{\\mathrm{min}}$。\n2. 固持作用，如果需要的话。如上所述，当 $F_{N, \\text{process}} < 0$ 时会发生这种情况。吸收通量则为 $U_{\\text{immob}} = -F_{N, \\text{process}} = \\frac{y_C I_C}{R_m} - \\frac{I_C}{R_\\ell}$。\n\n综合 $N_{\\mathrm{min}}$ 库的所有通量：\n$$\n\\frac{dN_{\\mathrm{min}}}{dt} = D_N + k_M M_N^* + \\left( \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m} \\right) - k_L N_{\\mathrm{min}}\n$$\n这里假设括号中的项代表净通量。如果它为负，则正确地从输入中减去。在稳态下，$\\frac{dN_{\\mathrm{min}}}{dt} = 0$，并代入 $M_N^* = \\frac{y_C I_C}{k_M R_m}$：\n$$\n0 = D_N + k_M \\left( \\frac{y_C I_C}{k_M R_m} \\right) + \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m} - k_L N_{\\mathrm{min}}^*\n$$\n简化表达式后发现，与微生物氮需求和周转矿化相关的项相互抵消：\n$$\n0 = D_N + \\frac{y_C I_C}{R_m} + \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m} - k_L N_{\\mathrm{min}}^*\n$$\n$$\n0 = D_N + \\frac{I_C}{R_\\ell} - k_L N_{\\mathrm{min}}^*\n$$\n这个简化后的方程代表了整个土壤系统（微生物库和矿质库的总和）在稳态下的氮平衡：总外部输入（$D_N + I_C/R_\\ell$）必须等于总外部输出（$k_L N_{\\mathrm{min}}^*$）。求解稳态矿质氮库 $N_{\\mathrm{min}}^*$：\n$$\nN_{\\mathrm{min}}^* = \\frac{D_N + I_C/R_\\ell}{k_L}\n$$\n现在，我们代入给定的参数值来计算数值结果。\n给定值：\n$I_C = 400$ g C m$^{-2}$ yr$^{-1}$\n$R_\\ell = 40$\n$y_C = 0.30$\n$k_M = 4$ yr$^{-1}$\n$R_m = 8$\n$D_N = 1.0$ g N m$^{-2}$ yr$^{-1}$\n$k_L = 4$ yr$^{-1}$\n\n计算 $M_C^*$：\n$$\nM_C^* = \\frac{y_C I_C}{k_M} = \\frac{0.30 \\times 400 \\text{ g C m}^{-2} \\text{ yr}^{-1}}{4 \\text{ yr}^{-1}} = \\frac{120}{4} \\text{ g C m}^{-2} = 30 \\text{ g C m}^{-2}\n$$\n四舍五入到四位有效数字，$M_C^* = 30.00$ g C m$^{-2}$。\n\n计算 $M_N^*$：\n$$\nM_N^* = \\frac{M_C^*}{R_m} = \\frac{30 \\text{ g C m}^{-2}}{8} = 3.75 \\text{ g N m}^{-2}\n$$\n四舍五入到四位有效数字，$M_N^* = 3.750$ g N m$^{-2}$。\n\n计算 $N_{\\mathrm{min}}^*$：\n$$\nN_{\\mathrm{min}}^* = \\frac{D_N + I_C/R_\\ell}{k_L} = \\frac{1.0 \\text{ g N m}^{-2} \\text{ yr}^{-1} + (400 / 40) \\text{ g N m}^{-2} \\text{ yr}^{-1}}{4 \\text{ yr}^{-1}} = \\frac{1.0 + 10}{4} \\text{ g N m}^{-2} = \\frac{11}{4} \\text{ g N m}^{-2} = 2.75 \\text{ g N m}^{-2}\n$$\n四舍五入到四位有效数字，$N_{\\mathrm{min}}^* = 2.750$ g N m$^{-2}$。\n\n最后，我们验证稳态下的碳和氮的质量平衡。\n\n碳质量平衡验证：\n- 总碳输入通量 = $I_C = 400$ g C m$^{-2}$ yr$^{-1}$。\n- 总碳输出通量 = 凋落物处理过程中的呼吸 + 微生物周转过程中的呼吸。\n  - 凋落物处理过程中的呼吸 = $(1 - y_C) I_C = (1 - 0.30) \\times 400 = 0.70 \\times 400 = 280$ g C m$^{-2}$ yr$^{-1}$。\n  - 微生物周转过程中的呼吸 = $k_M M_C^* = 4 \\text{ yr}^{-1} \\times 30 \\text{ g C m}^{-2} = 120$ g C m$^{-2}$ yr$^{-1}$。\n- 总碳输出 = $280 + 120 = 400$ g C m$^{-2}$ yr$^{-1}$。\n总输入（400）等于总输出（400），因此碳循环是平衡的。\n\n氮质量平衡验证：\n- 总外部氮输入通量 = 凋落物氮输入 + 大气沉降。\n  - 凋落物氮输入 = $I_N = I_C / R_\\ell = 400 / 40 = 10$ g N m$^{-2}$ yr$^{-1}$。\n  - 大气沉降 = $D_N = 1.0$ g N m$^{-2}$ yr$^{-1}$。\n- 总外部氮输入 = $10 + 1.0 = 11.0$ g N m$^{-2}$ yr$^{-1}$。\n- 总外部氮输出通量 = 淋溶损失。\n  - 淋溶损失 = $k_L N_{\\mathrm{min}}^* = 4 \\text{ yr}^{-1} \\times 2.750 \\text{ g N m}^{-2} = 11.0$ g N m$^{-2}$ yr$^{-1}$。\n总外部输入（11.0）等于总外部输出（11.0），因此氮循环是平衡的。该解是内部一致的，并满足守恒定律。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 30.00 & 3.750 & 2.750 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "与理想化的稳态模型不同，真实的生态系统模型是动态演变的，并且通常用常微分方程组 (ODEs) 来描述。在开发和验证这些复杂的数值模型时，确保质量守恒是至关重要的一步。本练习要求你通过数值方法求解一个动态C-N耦合模型，并验证总元素质量随时间的变化是否精确等于外部源与汇的净积分，从而掌握检验模型保真度的核心计算技能 ()。",
            "id": "4099145",
            "problem": "要求您在一个简化的耦合陆地生物地球化学模型中，验证碳和氮的质量守恒。该模型常用于数值天气预报和气候模拟。该模型追踪碳和氮的土壤有机质和植物生物量，以及一个矿物氮库，其分解、矿化、植物吸收、死亡和淋溶等过程均按化学计量耦合。您必须通过对控制性常微分方程（ordinary differential equation, ODE）进行数值积分，并独立地对模型规定的外部源和汇进行数值积分，来计算在指定时间间隔内的质量平衡残差。对于每个测试用例，您的程序必须返回一个单行列表，其中包含一个非负浮点数，该数等于碳和氮残差绝对值中的最大值，单位为千克/平方米。\n\n基本原理：每种元素的质量守恒定律指出，所追踪的库中总质量的时间变化率等于外部源的总和减去外部汇的总和。对于任意元素，其在所追踪库中的总质量为 $M(t)$，外部源速率为 $S_{\\text{in}}(t)$，外部汇速率为 $S_{\\text{out}}(t)$，则在时间区间 $[0,T]$ 上的积分形式为\n$$\nM(T) - M(0) = \\int_{0}^{T} \\left(S_{\\text{in}}(t) - S_{\\text{out}}(t)\\right)\\, dt.\n$$\n质量平衡残差定义为\n$$\n\\mathcal{R} = \\left(M(T) - M(0)\\right) - \\int_{0}^{T} \\left(S_{\\text{in}}(t) - S_{\\text{out}}(t)\\right)\\, dt,\n$$\n对于一个正确且一致的模型，在精确计算中该值应为 $0$；非零值仅由数值近似产生。\n\n模型结构和单位：\n- 状态变量（单位均为千克/平方米）：土壤有机碳 $C_s$、土壤有机氮 $N_s$、矿物氮 $N_m$、植物碳 $C_p$、植物氮 $N_p$。\n- 时间 $t$ 单位为天。\n- 每个测试用例的参数在下面指定，单位一致。\n\n过程：\n- 分解和矿化：土壤有机质以速率 $k_d$（每天）进行一阶衰减，从土壤有机库中移除的碳和氮量与其当前存量成正比。从 $C_s$ 损失的碳以二氧化碳形式排放（外部汇）。从 $N_s$ 损失的氮进入 $N_m$（内部转移）。\n- 植物对矿物氮的吸收：采用 Michaelis–Menten 形式，最大速率为 $V_{\\max}$（千克氮/平方米/天），半饱和常数为 $K$（千克氮/平方米），\n$$\nU_N(N_m) = V_{\\max}\\,\\frac{N_m}{K + N_m}.\n$$\n吸收过程将氮从 $N_m$ 转移到 $N_p$（内部），同时大气中的光合作用固碳按化学计量比例供应植物生长，该比例与氮吸收量成正比，并具有恒定的植物碳氮比 $y_p$（千克碳/千克氮）。此光合作用输入是一个外部碳源，速率为 $y_p\\,U_N$。\n- 植物死亡：以速率 $m$（每天）的一阶损失将植物碳和氮转移回土壤有机库（内部转移）。\n- 矿物氮淋溶：以速率 $\\ell$（每天）的一阶损失将 $N_m$ 从系统中移除（外部汇）。\n- 凋落物输入：对 $C_s$ 的恒定外部输入 $L_C$（千克碳/平方米/天）和对 $N_s$ 的恒定外部输入 $L_N$（千克氮/平方米/天）。\n- 大气氮沉降：对 $N_m$ 的恒定外部输入 $D_N$（千克氮/平方米/天）。\n\n控制性常微分方程：\n$$\n\\frac{dC_s}{dt} = L_C + m\\,C_p - k_d\\,C_s,\n\\quad\n\\frac{dN_s}{dt} = L_N + m\\,N_p - k_d\\,N_s,\n$$\n$$\n\\frac{dN_m}{dt} = k_d\\,N_s - U_N(N_m) - \\ell\\,N_m + D_N,\n\\quad\n\\frac{dC_p}{dt} = y_p\\,U_N(N_m) - m\\,C_p,\n\\quad\n\\frac{dN_p}{dt} = U_N(N_m) - m\\,N_p.\n$$\n\n用于残差计算的质量核算：\n- 追踪的总碳为 $C_{\\text{tot}}(t) = C_s(t) + C_p(t)$。\n- 追踪的总氮为 $N_{\\text{tot}}(t) = N_s(t) + N_m(t) + N_p(t)$。\n- 外部碳源 $S^{C}_{\\text{in}}(t) = L_C + y_p\\,U_N(N_m(t))$。\n- 外部碳汇 $S^{C}_{\\text{out}}(t) = k_d\\,C_s(t)$。\n- 外部氮源 $S^{N}_{\\text{in}}(t) = L_N + D_N$。\n- 外部氮汇 $S^{N}_{\\text{out}}(t) = \\ell\\,N_m(t)$。\n\n您的任务：\n- 对于下方的每个测试用例，在区间 $[0,T]$ 上对常微分方程进行积分，并使用上述积分定义及指定的外部源和汇速率，计算碳和氮的质量平衡残差。对源项和汇项的时间积分使用一致的数值积分方法。对于每个测试用例，返回一个非负浮点数，该数等于碳残差和氮残差绝对值中的最大值：\n$$\nr = \\max\\left(\\left|\\mathcal{R}_C\\right|,\\left|\\mathcal{R}_N\\right|\\right).\n$$\n- 将每个输出 $r$ 以千克/平方米为单位，表示为浮点数。\n\n数值细节和要求：\n- 所有物理单位中，质量单位为千克/平方米，时间单位为天。\n- 本问题不使用角度。\n- 程序必须数值求解常微分方程。您可以选择任何适当的稳定方法，但需确保严格的容差，以使残差仅反映数值误差。\n- 对常微分方程求解和外部源项、汇项的数值积分使用相同的时间离散点，以避免混叠误差。\n- 最终程序输出必须为单行，包含一个 Python 风格的列表，其中每个测试用例对应一个浮点数，按所列顺序排列，输出文本中不含单位。这些浮点数代表千克/平方米。\n\n测试套件：\n- 情况 A（一般情况）：\n  - $T = 1.0$ 天。\n  - 初始条件：$C_s(0) = 10.0$，$N_s(0) = 0.5$，$N_m(0) = 0.1$，$C_p(0) = 2.0$，$N_p(0) = 0.08$。\n  - 参数：$k_d = 0.02$，$V_{\\max} = 0.2$，$K = 0.05$，$m = 0.01$，$\\ell = 0.05$，$y_p = 25.0$，$L_C = 0.05$，$L_N = 0.0025$，$D_N = 0.0$。\n- 情况 B（无矿化）：\n  - $T = 1.0$ 天。\n  - 初始条件：$C_s(0) = 10.0$，$N_s(0) = 0.5$，$N_m(0) = 0.1$，$C_p(0) = 2.0$，$N_p(0) = 0.08$。\n  - 参数：$k_d = 0.0$，$V_{\\max} = 0.2$，$K = 0.05$，$m = 0.01$，$\\ell = 0.05$，$y_p = 25.0$，$L_C = 0.05$，$L_N = 0.0025$，$D_N = 0.0$。\n- 情况 C（无吸收）：\n  - $T = 2.0$ 天。\n  - 初始条件：$C_s(0) = 10.0$，$N_s(0) = 0.5$，$N_m(0) = 0.1$，$C_p(0) = 2.0$，$N_p(0) = 0.08$。\n  - 参数：$k_d = 0.02$，$V_{\\max} = 0.0$，$K = 0.05$，$m = 0.01$，$\\ell = 0.05$，$y_p = 25.0$，$L_C = 0.05$，$L_N = 0.0025$，$D_N = 0.0$。\n- 情况 D（强淋溶与沉降）：\n  - $T = 0.5$ 天。\n  - 初始条件：$C_s(0) = 10.0$，$N_s(0) = 0.5$，$N_m(0) = 0.1$，$C_p(0) = 2.0$，$N_p(0) = 0.08$。\n  - 参数：$k_d = 0.02$，$V_{\\max} = 0.2$，$K = 0.05$，$m = 0.01$，$\\ell = 1.0$，$y_p = 25.0$，$L_C = 0.05$，$L_N = 0.0025$，$D_N = 0.01$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 [情况 A, 情况 B, 情况 C, 情况 D]。例如：“[x_A,x_B,x_C,x_D]”。\n- 每个条目必须是一个浮点数，代表该情况下以千克/平方米为单位的最大绝对质量平衡残差。",
            "solution": "用户提供了一个定义明确的计算生物地球化学问题，要求为一个耦合常微分方程（ODE）系统验证质量守恒。该问题在科学上是合理的，数学上是一致的，并且在计算上是可行的。所有需要的数据和定义均已提供。因此，该问题被认定为有效，并将构建一个解决方案。\n\n问题的核心是计算在指定时间区间 $[0, T]$ 内碳（$C$）和氮（$N$）的质量平衡残差。对于一个总追踪质量为 $M(t)$ 的元素，其残差由以下公式给出：\n$$\n\\mathcal{R} = \\left(M(T) - M(0)\\right) - \\int_{0}^{T} \\left(S_{\\text{in}}(t) - S_{\\text{out}}(t)\\right)\\, dt\n$$\n从解析上讲，由于质量守恒原理（这已体现在控制性常微分方程的结构中），该残差为零。然而，在数值上，由于常微分方程积分和通量项积分中的近似误差，会产生一个小的非零残差。任务就是计算这个数值残差。\n\n解决方案将按以下步骤实施：\n1.  **定义常微分方程系统**：将创建一个函数来表示五个耦合常微分方程的系统，这些方程描述了状态变量：土壤有机碳（$C_s$）、土壤有机氮（$N_s$）、矿物氮（$N_m$）、植物碳（$C_p$）和植物氮（$N_p$）。设状态向量为 $\\mathbf{y}(t) = [C_s(t), N_s(t), N_m(t), C_p(t), N_p(t)]^T$。该函数将计算时间导数 $\\frac{d\\mathbf{y}}{dt} = f(t, \\mathbf{y}, \\mathbf{p})$，其中 $\\mathbf{p}$ 是模型参数的向量。\n\n2.  **常微分方程的数值积分**：将使用高精度求解器对常微分方程系统进行数值求解。`scipy.integrate.solve_ivp` 函数非常适合此目的。我们将采用一个变步长求解器（例如默认的 `RK45`，一种 Dormand-Prince 方法），并设置非常严格的相对和绝对误差容限（例如 $10^{-13}$），以最小化常微分方程求解器带来的误差。问题要求通量的积分使用与常微分方程解相同的时间步长。因此，将指示 `solve_ivp` 在区间 $[0, T]$ 上的一个精细、均匀的时间点网格 $t_i$ 上输出解。将使用每天至少 $10000$ 个点的高密度网格，以确保后续通量数值积分的准确性。\n\n3.  **质量变化计算**：追踪的碳总质量为 $C_{\\text{tot}}(t) = C_s(t) + C_p(t)$，氮总质量为 $N_{\\text{tot}}(t) = N_s(t) + N_m(t) + N_p(t)$。\n    - 初始质量 $C_{\\text{tot}}(0)$ 和 $N_{\\text{tot}}(0)$ 直接根据给定的初始条件计算。\n    - 最终质量 $C_{\\text{tot}}(T)$ 和 $N_{\\text{tot}}(T)$ 从常微分方程在最终时间步 $T$ 的数值解中获取。\n    - 然后，每种元素的总质量变化为 $\\Delta M = M(T) - M(0)$。\n\n4.  **通量的数值积分**：外部源项和汇项是状态变量的函数，而这些状态变量在每个时间点 $t_i$ 的值已通过常微分方程的解得知。\n    - 碳的净外部通量为 $S^C_{\\text{net}}(t) = S^C_{\\text{in}}(t) - S^C_{\\text{out}}(t) = (L_C + y_p\\,U_N(N_m(t))) - k_d\\,C_s(t)$。\n    - 氮的净外部通量为 $S^N_{\\text{net}}(t) = S^N_{\\text{in}}(t) - S^N_{\\text{out}}(t) = (L_N + D_N) - \\ell\\,N_m(t)$。\n    - 我们将在每个时间点 $t_i$ 评估这些净通量表达式，以生成通量值数组。\n    - 这些通量的时间积分 $\\int_0^T S_{\\text{net}}(t) dt$ 将使用梯形法则进行数值计算，具体实现为 `numpy.trapz`。鉴于数据点间距很小，此方法是合适的。\n\n5.  **残差计算**：在计算出质量变化（$\\Delta M$）和积分后的净通量（$\\int S_{\\text{net}} dt$）后，通过求两者之差即可得到碳（$\\mathcal{R}_C$）和氮（$\\mathcal{R}_N$）的残差。\n\n6.  **最终结果**：对于每个测试用例，最终报告的值是两个残差绝对值中的最大值：$r = \\max(|\\mathcal{R}_C|, |\\mathcal{R}_N|)$。将对问题陈述中提供的所有四个测试用例重复此过程。结果将被汇总到一个列表中，并以指定格式打印。最终结果的单位将是千克/平方米（kg/m²），与状态变量的单位一致。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the biogeochemistry mass-balance problem for all test cases.\n    \"\"\"\n\n    def model_odes(t, y, params):\n        \"\"\"\n        Defines the system of ordinary differential equations for the model.\n        \n        Args:\n            t (float): Current time (not used in this autonomous system, but required by solver).\n            y (np.ndarray): Array of state variables [Cs, Ns, Nm, Cp, Np].\n            params (dict): Dictionary of model parameters.\n        \n        Returns:\n            np.ndarray: Array of the derivatives of the state variables.\n        \"\"\"\n        Cs, Ns, Nm, Cp, Np = y\n        \n        # Unpack parameters\n        kd = params['kd']\n        Vmax = params['Vmax']\n        K = params['K']\n        m = params['m']\n        l_rate = params['l_rate']\n        yp = params['yp']\n        LC = params['LC']\n        LN = params['LN']\n        DN = params['DN']\n\n        # Ensure non-negativity of state variables for physical realism\n        Cs = max(0, Cs)\n        Ns = max(0, Ns)\n        Nm = max(0, Nm)\n        Cp = max(0, Cp)\n        Np = max(0, Np)\n\n        # Process rates\n        U_N = Vmax * Nm / (K + Nm)\n        \n        # Derivatives\n        dCs_dt = LC + m * Cp - kd * Cs\n        dNs_dt = LN + m * Np - kd * Ns\n        dNm_dt = kd * Ns - U_N - l_rate * Nm + DN\n        dCp_dt = yp * U_N - m * Cp\n        dNp_dt = U_N - m * Np\n        \n        return np.array([dCs_dt, dNs_dt, dNm_dt, dCp_dt, dNp_dt])\n\n    def calculate_residual(case):\n        \"\"\"\n        Calculates the maximum absolute mass-balance residual for a single test case.\n        \n        Args:\n            case (dict): A dictionary containing all parameters and initial conditions for the case.\n            \n        Returns:\n            float: The maximum absolute residual between carbon and nitrogen.\n        \"\"\"\n        y0 = case['initial_conditions']\n        params = case['parameters']\n        T = case['T']\n\n        # Set up a fine time grid for integration and quadrature\n        # Use a high number of points to ensure accurate quadrature\n        num_points = int(10000 * T) + 1\n        t_eval = np.linspace(0, T, num_points)\n\n        # Solve the ODE system with tight tolerances\n        sol = solve_ivp(\n            model_odes, \n            [0, T], \n            y0, \n            args=(params,), \n            t_eval=t_eval, \n            rtol=1e-13, \n            atol=1e-13,\n            method='RK45'\n        )\n        \n        if not sol.success:\n            raise RuntimeError(f\"ODE solver failed for case.\")\n\n        # Extract solution trajectories\n        solution_y = sol.y\n        solution_t = sol.t\n        Cs_t, Ns_t, Nm_t, Cp_t, Np_t = solution_y\n\n        # 1. Calculate change in total mass from initial to final state\n        # Initial mass\n        C_tot_0 = y0[0] + y0[3] # Cs(0) + Cp(0)\n        N_tot_0 = y0[1] + y0[2] + y0[4] # Ns(0) + Nm(0) + Np(0)\n        \n        # Final mass\n        C_tot_T = solution_y[0, -1] + solution_y[3, -1] # Cs(T) + Cp(T)\n        N_tot_T = solution_y[1, -1] + solution_y[2, -1] + solution_y[4, -1] # Ns(T) + Nm(T) + Np(T)\n\n        delta_C_tot = C_tot_T - C_tot_0\n        delta_N_tot = N_tot_T - N_tot_0\n\n        # 2. Integrate net external fluxes over the time interval\n        # Unpack parameters needed for flux calculation\n        kd, Vmax, K, l_rate, yp, LC, LN, DN = [params[k] for k in \n            ('kd', 'Vmax', 'K', 'l_rate', 'yp', 'LC', 'LN', 'DN')]\n\n        # Calculate flux rates at each time step\n        U_N_t = Vmax * Nm_t / (K + Nm_t)\n        \n        # Net Carbon Flux: S_in - S_out = (L_C + y_p*U_N) - (k_d*C_s)\n        net_flux_C_t = (LC + yp * U_N_t) - (kd * Cs_t)\n        \n        # Net Nitrogen Flux: S_in - S_out = (L_N + D_N) - (l*N_m)\n        net_flux_N_t = (LN + DN) - (l_rate * Nm_t)\n\n        # Integrate fluxes using the trapezoidal rule\n        integral_net_flux_C = np.trapz(net_flux_C_t, x=solution_t)\n        integral_net_flux_N = np.trapz(net_flux_N_t, x=solution_t)\n        \n        # 3. Calculate residuals\n        residual_C = delta_C_tot - integral_net_flux_C\n        residual_N = delta_N_tot - integral_net_flux_N\n        \n        # 4. Return the maximum absolute residual\n        return max(abs(residual_C), abs(residual_N))\n\n    # Test suite definition\n    test_cases = [\n        { # Case A: general case\n            'T': 1.0,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.02, 'Vmax': 0.2, 'K': 0.05, 'm': 0.01, 'l_rate': 0.05, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.0}\n        },\n        { # Case B: no mineralization\n            'T': 1.0,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.0, 'Vmax': 0.2, 'K': 0.05, 'm': 0.01, 'l_rate': 0.05, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.0}\n        },\n        { # Case C: no uptake\n            'T': 2.0,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.02, 'Vmax': 0.0, 'K': 0.05, 'm': 0.01, 'l_rate': 0.05, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.0}\n        },\n        { # Case D: strong leaching with deposition\n            'T': 0.5,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.02, 'Vmax': 0.2, 'K': 0.05, 'm': 0.01, 'l_rate': 1.0, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.01}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_residual(case)\n        results.append(result)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在构建并验证了一个模型之后，理解其预测对输入参数不确定性的响应变得至关重要。敏感性分析是量化这种响应的关键工具，它能帮助我们识别模型行为的主要驱动因子。本练习将引导你使用基于方差的Sobol敏感性分析框架，为一个简化的净生态系统生产 (NEP) 模型分析推导出其对关键氮循环输入的一阶敏感性指数 ()。这不仅能加深你对模型结构的理解，也是评估和改进复杂地球系统模型的核心技能。",
            "id": "4099185",
            "problem": "考虑一个简化的、有科学依据的陆地生态系统碳平衡表示，该表示在固定气候强迫下，适用于数值天气预报和气候建​​模。假设净生态系统生产量（NEP）由碳质量平衡关系定义，即净生态系统生产量等于净初级生产量减去异养呼吸，其中气候保持恒定，因此异养呼吸被视为一个恒定的基线。具体来说，设净生态系统生产量模型为\n$$\nf(D,F,L) \\equiv \\alpha\\,L\\,(D+F) - R,\n$$\n其中 $D$ 是氮沉降，$F$ 是生物固氮，$L$ 是一个集总的叶片氮参数，用于衡量净初级生产量的氮限制，$\\alpha$ 是一个由化学计量和固定气候强迫决定的固定碳氮转换因子，$R$ 是在固定气候强迫下的基线异养呼吸。变量 $D$、$F$ 和 $L$ 是独立的随机输入，反映了在固定气候强迫下氮循环驱动因素和叶片氮性状的不确定性。设 $D$、$F$ 和 $L$ 的概率分布具有有限的一阶矩和二阶矩，其均值和方差表示为\n$$\nm_D=\\mathbb{E}[D],\\quad v_D=\\operatorname{Var}(D),\\quad m_F=\\mathbb{E}[F],\\quad v_F=\\operatorname{Var}(F),\\quad m_L=\\mathbb{E}[L],\\quad v_L=\\operatorname{Var}(L),\n$$\n并假设 $\\alpha$ 和 $R$ 是确定性常数。\n\n使用基于方差的 Sobol 灵敏度分析框架，推导净生态系统生产量 $f(D,F,L)$ 相对于三个独立输入 $D$、$F$ 和 $L$ 的一阶 Sobol 灵敏度指数。输入 $X$ 的一阶 Sobol 指数 $S_X$ 定义为\n$$\nS_X=\\frac{\\operatorname{Var}\\big(\\mathbb{E}[f\\,|\\,X]\\big)}{\\operatorname{Var}(f)}.\n$$\n将三个一阶指数 $S_D$、$S_F$ 和 $S_L$ 表示为由 $\\alpha$、$m_D$、$v_D$、$m_F$、$v_F$、$m_L$ 和 $v_L$ 构成的闭式解析表达式。将您的最终结果表述为三个无量纲数。无需四舍五入。按 $S_D$、$S_F$、$S_L$ 的顺序，以单行矩阵的形式提供您的最终答案。",
            "solution": "问题陈述已经过验证，被认为是合理的。它具有科学依据，提法明确，客观，并包含了获得唯一解所需的所有必要信息。因此，我们可以继续进行推导。\n\n目标是为净生态系统生产量模型 $f(D,F,L) = \\alpha L (D+F) - R$ 推导出一阶 Sobol 灵敏度指数 $S_D$、$S_F$ 和 $S_L$。输入 $D$、$F$ 和 $L$ 是独立的随机变量。\n\n输入 $X$ 的一阶 Sobol 指数定义为：\n$$\nS_X = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid X]\\big)}{\\operatorname{Var}(f)}\n$$\n计算需要两个主要部分：输出的总方差 $\\operatorname{Var}(f)$，即分母；以及每个输入 $X \\in \\{D, F, L\\}$ 的部分方差 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid X]\\big)$，它们构成分子。\n\n首先，我们计算总方差 $\\operatorname{Var}(f)$。\n$$\n\\operatorname{Var}(f) = \\operatorname{Var}\\big(\\alpha L(D+F) - R\\big)\n$$\n由于 $R$ 是一个确定性常数，其方差为 $0$，它对 $f$ 的方差没有贡献。使用性质 $\\operatorname{Var}(aX+b) = a^2\\operatorname{Var}(X)$，我们有：\n$$\n\\operatorname{Var}(f) = \\operatorname{Var}\\big(\\alpha L(D+F)\\big) = \\alpha^2 \\operatorname{Var}\\big(L(D+F)\\big)\n$$\n为了计算 $\\operatorname{Var}\\big(L(D+F)\\big)$，我们可以使用全方差公式或定义 $\\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2$。对于两个独立随机变量（例如 $X_1$ 和 $X_2$）乘积的方差，一个更直接的公式是 $\\operatorname{Var}(X_1 X_2) = \\operatorname{Var}(X_1)\\operatorname{Var}(X_2) + \\operatorname{Var}(X_1)(\\mathbb{E}[X_2])^2 + \\operatorname{Var}(X_2)(\\mathbb{E}[X_1])^2$。\n我们定义两个中间随机变量：$X_1 = L$ 和 $X_2 = D+F$。由于 $L$ 独立于 $D$ 和 $F$，因此 $X_1$ 和 $X_2$ 是独立的。\n$X_1$ 和 $X_2$ 所需的矩为：\n$$\n\\mathbb{E}[X_1] = \\mathbb{E}[L] = m_L\n$$\n$$\n\\operatorname{Var}(X_1) = \\operatorname{Var}(L) = v_L\n$$\n$$\n\\mathbb{E}[X_2] = \\mathbb{E}[D+F] = \\mathbb{E}[D] + \\mathbb{E}[F] = m_D + m_F\n$$\n由于 $D$ 和 $F$ 是独立的，它们之和的方差等于它们方差之和：\n$$\n\\operatorname{Var}(X_2) = \\operatorname{Var}(D+F) = \\operatorname{Var}(D) + \\operatorname{Var}(F) = v_D + v_F\n$$\n现在，将这些代入乘积 $X_1 X_2 = L(D+F)$ 的方差公式中：\n$$\n\\operatorname{Var}\\big(L(D+F)\\big) = v_L (v_D+v_F) + v_L (m_D+m_F)^2 + (v_D+v_F) m_L^2\n$$\n通过提出公因子 $v_L$ 和 $m_L^2$ 来重新整理各项：\n$$\n\\operatorname{Var}\\big(L(D+F)\\big) = v_L \\big((v_D+v_F) + (m_D+m_F)^2\\big) + m_L^2 (v_D+v_F)\n$$\n因此，$f$ 的总方差为：\n$$\n\\operatorname{Var}(f) = \\alpha^2 \\Big[ v_L \\big(v_D+v_F + (m_D+m_F)^2\\big) + m_L^2 (v_D+v_F) \\Big]\n$$\n这个表达式构成了所有三个 Sobol 指数的分母。\n\n接下来，我们计算分子，从 $S_D$ 开始。这需要计算 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big)$。\n首先，求条件期望 $\\mathbb{E}[f \\mid D]$：\n$$\n\\mathbb{E}[f \\mid D] = \\mathbb{E}[\\alpha L(D+F) - R \\mid D]\n$$\n利用期望的线性性质，并在条件期望中将作为 $D$ 函数的项视为常数：\n$$\n\\mathbb{E}[f \\mid D] = \\alpha \\mathbb{E}[L(D+F) \\mid D] - \\mathbb{E}[R \\mid D]\n$$\n由于 $L$ 和 $F$ 独立于 $D$，$\\mathbb{E}[L \\mid D] = \\mathbb{E}[L] = m_L$ 且 $\\mathbb{E}[F \\mid D] = \\mathbb{E}[F] = m_F$。常数 $R$ 也独立于 $D$。\n$$\n\\mathbb{E}[f \\mid D] = \\alpha \\big( \\mathbb{E}[LD \\mid D] + \\mathbb{E}[LF \\mid D] \\big) - R = \\alpha \\big( D \\mathbb{E}[L \\mid D] + \\mathbb{E}[L \\mid D]\\mathbb{E}[F \\mid D] \\big) - R\n$$\n$$\n\\mathbb{E}[f \\mid D] = \\alpha (D m_L + m_L m_F) - R = \\alpha m_L (D+m_F) - R\n$$\n现在，我们对这个表达式求关于 $D$ 的随机性的方差：\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big) = \\operatorname{Var}\\big(\\alpha m_L (D+m_F) - R\\big)\n$$\n项 $\\alpha m_L m_F$ 和 $R$ 是常数，因此它们不影响方差。\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big) = \\operatorname{Var}(\\alpha m_L D) = (\\alpha m_L)^2 \\operatorname{Var}(D) = \\alpha^2 m_L^2 v_D\n$$\n\n现在，我们计算 $S_F$ 的分子，即 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid F]\\big)$。其过程与 $D$ 的情况对称。\n$$\n\\mathbb{E}[f \\mid F] = \\mathbb{E}[\\alpha L(D+F) - R \\mid F] = \\alpha \\mathbb{E}[L(D+F) \\mid F] - R\n$$\n$$\n\\mathbb{E}[f \\mid F] = \\alpha \\big( \\mathbb{E}[LD \\mid F] + \\mathbb{E}[LF \\mid F] \\big) - R = \\alpha \\big( \\mathbb{E}[L]\\mathbb{E}[D] + F \\mathbb{E}[L] \\big) - R\n$$\n$$\n\\mathbb{E}[f \\mid F] = \\alpha(m_L m_D + F m_L) - R = \\alpha m_L (m_D+F) - R\n$$\n求关于 $F$ 的随机性的方差：\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid F]\\big) = \\operatorname{Var}\\big(\\alpha m_L (m_D+F) - R\\big) = \\operatorname{Var}(\\alpha m_L F) = (\\alpha m_L)^2 \\operatorname{Var}(F) = \\alpha^2 m_L^2 v_F\n$$\n\n最后，我们计算 $S_L$ 的分子，即 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big)$。\n$$\n\\mathbb{E}[f \\mid L] = \\mathbb{E}[\\alpha L(D+F) - R \\mid L]\n$$\n在期望中将 $L$ 视为常数：\n$$\n\\mathbb{E}[f \\mid L] = \\alpha L \\mathbb{E}[D+F \\mid L] - R\n$$\n由于 $D$ 和 $F$ 独立于 $L$，$\\mathbb{E}[D+F \\mid L] = \\mathbb{E}[D+F] = m_D+m_F$。\n$$\n\\mathbb{E}[f \\mid L] = \\alpha L (m_D+m_F) - R\n$$\n求关于 $L$ 的随机性的方差：\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big) = \\operatorname{Var}\\big(\\alpha (m_D+m_F) L - R\\big) = \\operatorname{Var}\\big(\\alpha (m_D+m_F) L\\big)\n$$\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big) = (\\alpha (m_D+m_F))^2 \\operatorname{Var}(L) = \\alpha^2 (m_D+m_F)^2 v_L\n$$\n\n现在我们通过构造比率来组合 Sobol 指数。令 $V_{tot} = v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)$。\n$$\nS_D = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big)}{\\operatorname{Var}(f)} = \\frac{\\alpha^2 m_L^2 v_D}{\\alpha^2 V_{tot}} = \\frac{m_L^2 v_D}{v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)}\n$$\n$$\nS_F = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid F]\\big)}{\\operatorname{Var}(f)} = \\frac{\\alpha^2 m_L^2 v_F}{\\alpha^2 V_{tot}} = \\frac{m_L^2 v_F}{v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)}\n$$\n$$\nS_L = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big)}{\\operatorname{Var}(f)} = \\frac{\\alpha^2 (m_D+m_F)^2 v_L}{\\alpha^2 V_{tot}} = \\frac{(m_D+m_F)^2 v_L}{v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)}\n$$\n这些就是三个一阶 Sobol 指数的最终闭式解析表达式。正如预期的那样，它们是无量纲量。问题陈述中提到的“无量纲数”被解释为要求提供这些符号表达式，因为没有提供参数的数值。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{m_L^2 v_D}{v_L(v_D + v_F + (m_D + m_F)^2) + m_L^2(v_D + v_F)} & \\frac{m_L^2 v_F}{v_L(v_D + v_F + (m_D + m_F)^2) + m_L^2(v_D + v_F)} & \\frac{(m_D + m_F)^2 v_L}{v_L(v_D + v_F + (m_D + m_F)^2) + m_L^2(v_D + v_F)} \\end{pmatrix}}\n$$"
        }
    ]
}