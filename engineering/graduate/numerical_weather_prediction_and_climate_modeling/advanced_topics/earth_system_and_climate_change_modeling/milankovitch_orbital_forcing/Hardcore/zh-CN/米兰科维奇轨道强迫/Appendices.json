{
    "hands_on_practices": [
        {
            "introduction": "在模拟气候对轨道变化的响应之前，我们必须首先能将入射的太阳辐射精确地表达为时间的函数。本练习将演示一项基本技能：使用一阶微扰理论推导瞬时日照的解析近似。掌握这项推导  对于理解偏心率如何调节整个轨道的太阳通量至关重要，其最终得到的关于平近点角 $M$ 的表达式 $S(M) \\approx S_0(1 + 2e \\cos M)$ 是更复杂日照计算的基石。",
            "id": "4063335",
            "problem": "考虑一颗行星，其半长轴为 $a$，轨道偏心率 $e$ 很小，它环绕一颗光度足够恒定的恒星运行，使得在距离 $a$ 处的平均大气层顶（TOA）辐照度可被视为一个常数 $S_0$（即所谓的在 $a$ 处的太阳常数）。许多数值天气预报和气候模型通过恒星辐照度的 $1/r^2$ 变化来纳入米兰科维奇轨道驱动的影响，其中 $r$ 是沿开普勒椭圆的瞬时恒星-行星距离。设从近日点测量的平近点角为 $M$（以弧度为单位），偏近点角为 $E$，真近点角为 $\\nu$。假设在所关心的时间区间内，动力学是纯粹的开普勒动力学。使用对偏心率 $e$ 的一阶微扰理论，推导以下两个量的闭合形式一阶近似：\n- $r^{-2}$，用 $a$、$e$ 和 $M$ 表示，\n- 垂直于光束的瞬时大气层顶辐照度，$S(M) \\equiv S_0 \\left(a^2/r^2\\right)$，用 $S_0$、$e$ 和 $M$ 表示。\n从经过充分检验的开普勒关系式开始，并应用在 $\\mathcal{O}(e)$ 阶截断的、关于 $e$ 的一致展开。不要进行任何时间平均。所有角度必须以弧度为单位。以 $a$、$e$、$M$ 和 $S_0$ 表示的两个符号表达式的形式报告你的最终结果，这些表达式应适合在气候模型驱动程序中直接使用。你的最终答案应以一个单行矩阵的形式给出，其第一个条目是 $r^{-2}$ 的近似值，第二个条目是 $S(M)$ 的近似值。",
            "solution": "目标是推导 $r^{-2}$ 和瞬时辐照度 $S(M)$ 作为平近点角 $M$ 的函数的一阶近似。推导将通过偏近点角 $E$ 将轨道位置与平近点角联系起来。所有展开都将在小偏心率 $e$ 的一阶上进行一致截断。\n\n径向距离 $r$ 与偏近点角 $E$ 之间的关系由精确的开普勒公式给出：\n$$\nr = a(1 - e \\cos E)\n$$\n其中 $a$ 是半长轴。\n\n由此，我们可以将 $r^{-2}$ 表示为：\n$$\nr^{-2} = \\frac{1}{a^2 (1 - e \\cos E)^2} = a^{-2} (1 - e \\cos E)^{-2}\n$$\n鉴于偏心率 $e$ 很小，我们可以对小的 $x$ 使用二项式展开 $(1-x)^{-n} \\approx 1 + nx$。这里，$x = e \\cos E$ 且 $n=2$。该展开在 $e$ 的一阶上有效。\n$$\nr^{-2} \\approx a^{-2} (1 + 2(e \\cos E)) = a^{-2}(1 + 2e \\cos E)\n$$\n这个表达式给出了用偏近点角 $E$ 表示的 $r^{-2}$。问题要求结果用平近点角 $M$ 表示。为实现这一点，我们必须将 $E$ 与 $M$ 联系起来。\n\n平近点角 $M$ 和偏近点角 $E$ 之间的关系由开普勒方程给出：\n$$\nM = E - e \\sin E\n$$\n由于 $e$ 很小，$E$ 必定接近 $M$。我们可以将 $E$ 表示为 $M$ 周围的一个微扰：\n$$\nE = M + \\delta\n$$\n其中 $\\delta$ 是一个量级为 $\\mathcal{O}(e)$ 的小修正。将此代入开普勒方程：\n$$\nM = (M + \\delta) - e \\sin(M + \\delta)\n$$\n$$\n\\delta = e \\sin(M + \\delta)\n$$\n为了找到 $\\delta$ 的一阶近似，我们可以将右侧正弦函数的参数近似到零阶，即 $\\sin(M + \\delta) \\approx \\sin M$，因为 $\\delta$ 本身已经是 $\\mathcal{O}(e)$ 量级。\n$$\n\\delta \\approx e \\sin M\n$$\n因此，$E$ 和 $M$ 之间的一阶关系是：\n$$\nE \\approx M + e \\sin M\n$$\n现在我们将 $E$ 的这个近似值代入我们 $r^{-2}$ 的表达式中。我们需要找到 $\\cos E$ 的适当阶数。\n$$\n\\cos E \\approx \\cos(M + e \\sin M)\n$$\n使用余弦的和角公式 $\\cos(A+B) = \\cos A \\cos B - \\sin A \\sin B$：\n$$\n\\cos E \\approx \\cos M \\cos(e \\sin M) - \\sin M \\sin(e \\sin M)\n$$\n对于小参数 $x$，余弦和正弦的泰勒级数分别为 $\\cos x \\approx 1 - \\frac{x^2}{2} + \\dots$ 和 $\\sin x \\approx x - \\frac{x^3}{6} + \\dots$。在这里，参数是 $x = e \\sin M$，其量级为 $\\mathcal{O}(e)$。\n为了得到 $\\cos E$ 的一阶结果，我们需要保留到 $\\mathcal{O}(e)$ 的项：\n$$\n\\cos(e \\sin M) \\approx 1\n$$\n$$\n\\sin(e \\sin M) \\approx e \\sin M\n$$\n将这些代入 $\\cos E$ 的展开式中：\n$$\n\\cos E \\approx \\cos M (1) - \\sin M (e \\sin M) = \\cos M - e \\sin^2 M\n$$\n这是 $\\cos E$ 展开到 $e$ 的一阶的表达式。现在，我们将其代回 $r^{-2}$ 的近似式中：\n$$\nr^{-2} \\approx a^{-2}(1 + 2e \\cos E) \\approx a^{-2} \\left[1 + 2e \\left(\\cos M - e \\sin^2 M\\right)\\right]\n$$\n$$\nr^{-2} \\approx a^{-2} (1 + 2e \\cos M - 2e^2 \\sin^2 M)\n$$\n由于问题要求结果在 $e$ 的一阶截断，我们舍去与 $e^2$ 成正比的项。这就得出了 $r^{-2}$ 的最终近似：\n$$\nr^{-2} \\approx a^{-2}(1 + 2e \\cos M)\n$$\n这是第一个要求的量。\n\n接下来，我们推导瞬时大气层顶辐照度 $S(M)$ 的表达式。问题将其定义为：\n$$\nS(M) \\equiv S_0 \\left(\\frac{a^2}{r^2}\\right) = S_0 a^2 r^{-2}\n$$\n其中 $S_0$ 是在半长轴距离 $a$ 处的平均辐照度。\n代入我们对 $r^{-2}$ 的一阶近似：\n$$\nS(M) \\approx S_0 a^2 \\left[a^{-2}(1 + 2e \\cos M)\\right]\n$$\n$a^2$ 因子被消去，得到瞬时辐照度的最终表达式：\n$$\nS(M) \\approx S_0(1 + 2e \\cos M)\n$$\n这是第二个要求的量。\n\n$r^{-2}$ 和 $S(M)$ 的两个结果与物理预期一致，即行星在近日点（$M=0$，$\\cos M=1$）时离恒星最近（辐照度最大），在远日点（$M=\\pi$，$\\cos M=-1$）时最远（辐照度最小）。\n\n最终结果按要求以行矩阵形式呈现。",
            "answer": "$$\\boxed{\\begin{pmatrix} a^{-2}(1 + 2e\\cos M) & S_0(1 + 2e\\cos M) \\end{pmatrix}}$$"
        },
        {
            "introduction": "虽然瞬时日照的解析公式很有用，但气候模型在离散的时间步长和空间网格上运行，需要为每个网格单元计算日平均日照。本实践解决了一个关键的数值挑战：标准日照公式在高纬度地区的失效问题。这个问题  将指导你推导出一个能正确处理极昼和极夜情况的稳健算法，从而防止数值错误，这对于任何希望精确模拟气候系统（尤其是敏感的极地地区）的建模者来说都是必不可少的。",
            "id": "4063324",
            "problem": "在数值天气预报和气候模拟中，必须在所有纬度和季节（包括高纬度条件）下稳健地评估大气层顶（TOA）的日平均日射量。考虑一个具有转轴倾角和椭圆轨道的行星，并定义以下量：地理纬度 $\\phi$、太阳赤纬 $\\delta$、以当地太阳正午为起点计量的时角 $H$（单位为弧度）、太阳天顶角 $\\theta_{z}$、地日距离 $r$ 以及等于一个天文单位（AU）的固定参考距离 $\\bar{r}$。设 $1$ AU 处的太阳常数为 $S_{0}$。水平面上的瞬时大气层顶通量模型为 $I(H) = S_{0}\\left(\\frac{\\bar{r}}{r}\\right)^{2}\\max\\!\\left(0,\\cos\\theta_{z}\\right)$，日平均日射量定义为 $I(H)$ 在一个行星自转周期（时角 $2\\pi$）内的平均值。\n\n从球面天文学恒等式 $\\cos\\theta_{z} = \\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\cos H$ 以及日出/日落的定义（太阳高度角等于 $0$ 的条件，等效于 $\\cos\\theta_{z} = 0$）出发，推导存在真实日出/日落时角的条件，并解释为何在 $|\\tan\\phi\\,\\tan\\delta| > 1$ 时，日平均公式中的直接代入 $H_{0} = \\arccos(\\cdot)$ 会变得无定义。然后，确定在针对所有 $(\\phi,\\delta)$ 的数值稳定的日平均大气层顶日射量公式中处理极昼和极夜的正确方法。\n\n以下哪个关于日平均日射量 $Q(\\phi,\\delta,r)$ 的表达式在所有纬度和季节都正确？选择所有适用项。\n\nA. $Q(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\Big[H_{0}\\,\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}\\Big]$，其中 $H_{0} = \\arccos\\!\\big(-\\tan\\phi\\,\\tan\\delta\\big)$ 对所有 $(\\phi,\\delta)$ 成立。\n\nB. \n$$\nQ(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\times\n\\begin{cases}\nH_{0}\\,\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}, & \\text{如果 } |\\tan\\phi\\,\\tan\\delta|\\leq 1,\\ H_{0}=\\arccos\\!\\big(-\\tan\\phi\\,\\tan\\delta\\big), \\\\\n\\pi\\,\\sin\\phi\\,\\sin\\delta, & \\text{如果 } \\tan\\phi\\,\\tan\\delta>1\\ \\text{(极昼)}, \\\\\n0, & \\text{如果 } \\tan\\phi\\,\\tan\\delta < -1\\ \\text{(极夜)}.\n\\end{cases}\n$$\n\nC.\n$$\nQ(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\times\n\\begin{cases}\nH_{0}\\,\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}, & \\text{如果 } |\\tan\\phi\\,\\tan\\delta|\\leq 1,\\ H_{0}=\\arccos\\!\\big(-\\tan\\phi\\,\\tan\\delta\\big), \\\\\n0, & \\text{如果 } \\tan\\phi\\,\\tan\\delta>1\\ \\text{(极昼)}, \\\\\n\\pi\\,\\sin\\phi\\,\\sin\\delta, & \\text{如果 } \\tan\\phi\\,\\tan\\delta < -1\\ \\text{(极夜)}.\n\\end{cases}\n$$\n\nD.\n$$\nQ(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\Big[H_{0}\\,\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}\\Big],\\quad H_{0}=\\arccos\\!\\Big(\\mathrm{clip}\\big(-\\tan\\phi\\,\\tan\\delta,\\,-1,\\,1\\big)\\Big),\n$$\n其中 $\\mathrm{clip}(x,-1,1)\\equiv \\min\\!\\big(1,\\max\\!(-1,x)\\big)$。\n\nE.\n$$\nQ(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\Big[H_{0}\\,\\sin\\phi\\,\\sin\\delta - \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}\\Big],\\quad H_{0}=\\arccos\\!\\big(-\\tan\\phi\\,\\tan\\delta\\big),\n$$\n其中 $H_{0}$ 用于所有 $(\\phi,\\delta)$，无特殊情况。",
            "solution": "### 日平均日射量的推导\n\n日平均日射量 $Q$ 定义为瞬时通量 $I(H)$ 在一个完整日循环（从 $H=-\\pi$ 到 $H=\\pi$）内的积分，再除以该周期的长度（$2\\pi$）：\n$$Q = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} I(H) \\, dH$$\n代入给定的 $I(H)$ 表达式：\n$$Q = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} S_{0}\\left(\\frac{\\bar{r}}{r}\\right)^{2}\\max\\!\\left(0,\\cos\\theta_{z}\\right) \\, dH$$\n项 $S_0(\\bar{r}/r)^2$ 在单日自转过程中是常数，因此可以移到积分之外：\n$$Q = \\frac{S_{0}}{2\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\int_{-\\pi}^{\\pi} \\max\\!\\left(0, \\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\cos H\\right) \\, dH$$\n被积函数仅在太阳位于地平线以上时非零，即 $\\cos\\theta_{z} > 0$。积分的上下限由日出和日落决定，此时 $\\cos\\theta_{z} = 0$。设 $H_{0}$ 为日落时角（$H_0 > 0$）。由于关于正午（$H=0$）的对称性，日出发生在 $-H_{0}$。条件 $\\cos\\theta_{z} = 0$ 给出：\n$$0 = \\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\cos H_{0}$$\n$$\\cos H_{0} = -\\frac{\\sin\\phi\\,\\sin\\delta}{\\cos\\phi\\,\\cos\\delta} = -\\tan\\phi\\,\\tan\\delta$$\n只有当反余弦函数的参数在其定义域 $[-1, 1]$ 内时，$H_{0}$ 才存在实数解。这导致条件 $|\\tan\\phi\\,\\tan\\delta| \\leq 1$。此不等式定义了每天都有一次日出和一次日落的“正常”情况。当 $|\\tan\\phi\\,\\tan\\delta| > 1$ 时，`arccos` 函数无定义，这表示极昼或极夜的特殊情况。\n\n**情况 1：正常日 ($|\\tan\\phi\\,\\tan\\delta| \\leq 1$)**\n在这种情况下，存在一个真实的日落时角 $H_{0} = \\arccos(-\\tan\\phi\\,\\tan\\delta)$，其中 $H_0 \\in [0, \\pi]$。太阳在地平线以上的时间为 $H \\in [-H_{0}, H_{0}]$。积分变为：\n$$Q = \\frac{S_{0}}{2\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\int_{-H_{0}}^{H_{0}} (\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\cos H) \\, dH$$\n被积函数是 $H$ 的偶函数，所以我们可以简化积分为：\n$$Q = \\frac{S_{0}}{\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\int_{0}^{H_{0}} (\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\cos H) \\, dH$$\n计算积分：\n$$Q = \\frac{S_{0}}{\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\left[ H\\sin\\phi\\,\\sin\\delta + \\sin H\\cos\\phi\\,\\cos\\delta \\right]_{0}^{H_{0}}$$\n$$Q = \\frac{S_{0}}{\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\left( H_{0}\\sin\\phi\\,\\sin\\delta + \\sin H_{0}\\cos\\phi\\,\\cos\\delta \\right)$$\n\n**情况 2：极昼 ($\\tan\\phi\\,\\tan\\delta > 1$)**\n此条件意味着 $\\phi$ 和 $\\delta$ 符号相同（例如，北半球的夏季）。项 $-\\tan\\phi\\,\\tan\\delta$ 小于 $-1$。我们来考察 $\\cos\\theta_{z}$：\n$$\\cos\\theta_{z} = \\cos\\phi\\cos\\delta(\\tan\\phi\\tan\\delta + \\cos H)$$\n由于 $|\\phi| < \\pi/2$ 且 $|\\delta| < \\pi/2$（对于地球， $|\\delta| \\le 23.45^\\circ$），所以 $\\cos\\phi > 0$ 且 $\\cos\\delta > 0$。$\\cos\\theta_{z}$ 的符号由 $(\\tan\\phi\\tan\\delta + \\cos H)$ 决定。因为 $\\tan\\phi\\tan\\delta > 1$ 且 $\\cos H$ 的最小值为 $-1$，所以项 $(\\tan\\phi\\tan\\delta + \\cos H)$ 总是正的。因此，对于所有 $H$，$\\cos\\theta_z > 0$。太阳永不落下。\n积分范围是整个周期，从 $-\\pi$到$\\pi$：\n$$Q = \\frac{S_{0}}{2\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\int_{-\\pi}^{\\pi} (\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\cos H) \\, dH$$\n$$Q = \\frac{S_{0}}{2\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\left[ (H\\sin\\phi\\,\\sin\\delta)\\Big|_{-\\pi}^{\\pi} + (\\sin H\\cos\\phi\\,\\cos\\delta)\\Big|_{-\\pi}^{\\pi} \\right]$$\n带有 $\\sin H$ 的项在两个极限处的值都为 $0$。第一项变为：\n$$Q = \\frac{S_{0}}{2\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\left[ (\\pi - (-\\pi))\\sin\\phi\\,\\sin\\delta \\right] = \\frac{S_{0}}{2\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} [2\\pi\\sin\\phi\\,\\sin\\delta]$$\n$$Q = S_{0}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\sin\\phi\\,\\sin\\delta$$\n为了与选项中的形式匹配，我们可以将其写为 $\\frac{S_{0}}{\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} (\\pi\\sin\\phi\\,\\sin\\delta)$。\n\n**情况 3：极夜 ($\\tan\\phi\\,\\tan\\delta  -1$)**\n此条件意味着 $\\phi$ 和 $\\delta$ 符号相反（例如，北半球的冬季）。项 $-\\tan\\phi\\,\\tan\\delta$ 大于 $1$。我们再次考察 $\\cos\\theta_{z} = \\cos\\phi\\cos\\delta(\\tan\\phi\\tan\\delta + \\cos H)$。因为 $\\tan\\phi\\tan\\delta  -1$ 且 $\\cos H$ 的最大值为 $1$，所以项 $(\\tan\\phi\\tan\\delta + \\cos H)$ 总是负的。因此，对于所有 $H$，$\\cos\\theta_z  0$。太阳永不升起。\n在这种情况下，对于所有 $H$，$\\max(0, \\cos\\theta_z) = 0$。积分结果为零：\n$$Q = \\frac{S_{0}}{2\\pi}\\left(\\frac{\\bar{r}}{r}\\right)^{2} \\int_{-\\pi}^{\\pi} 0 \\, dH = 0$$\n\n_结果总结：_\n一个完整的公式是一个分段函数：\n$$\nQ(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2} \\times \\begin{cases} H_{0}\\sin\\phi\\sin\\delta + \\sin H_{0}\\cos\\phi\\cos\\delta,  \\text{如果 } |\\tan\\phi\\tan\\delta|\\leq 1 \\\\ \\pi\\sin\\phi\\sin\\delta,  \\text{如果 } \\tan\\phi\\tan\\delta  1 \\\\ 0,  \\text{如果 } \\tan\\phi\\tan\\delta  -1 \\end{cases}\n$$\n其中在第一种情况下，$H_0 = \\arccos(-\\tan\\phi\\tan\\delta)$。\n\n### 逐项分析\n\n**A. $Q(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\Big[H_{0}\\,\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}\\Big]$，其中 $H_{0} = \\arccos\\!\\big(-\\tan\\phi\\,\\tan\\delta\\big)$ 对所有 $(\\phi,\\delta)$ 成立。**\n该表达式仅在 $|\\tan\\phi\\tan\\delta| \\leq 1$ 的“正常日”情况下有效。对于极昼或极夜，$\\arccos$ 函数的参数超出了定义域 $[-1, 1]$，使得 $H_0$ 未定义。此公式不完整，在数值上会失效。\n结论：**错误**。\n\n**B.** 这个分段函数正确地表示了上面推导出的三种不同的物理情景。每种情况都与推导出的公式完全匹配。\n结论：**正确**。\n\n**C.** 该选项错误地交换了极昼和极夜的表达式。对于极昼（$\\tan\\phi\\tan\\delta  1$），日射量必须为正，而不是 $0$。对于极夜（$\\tan\\phi\\tan\\delta  -1$），日射量必须为 $0$，但这里给出的是 $\\pi\\sin\\phi\\sin\\delta$。在这种情况下，$\\phi$ 和 $\\delta$ 符号相反，所以 $\\sin\\phi\\sin\\delta  0$，导致了不符合物理意义的负日射量。\n结论：**错误**。\n\n**D. $Q(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\Big[H_{0}\\,\\sin\\phi\\,\\sin\\delta + \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}\\Big],\\quad H_{0}=\\arccos\\!\\Big(\\mathrm{clip}\\big(-\\tan\\phi\\,\\tan\\delta,\\,-1,\\,1\\big)\\Big)$**\n此选项提供了一个数值稳定的单行公式。`clip(x, -1, 1)` 函数将 $x = -\\tan\\phi\\tan\\delta$ 的值限制在 $[-1, 1]$ 范围内。\n- 如果 $|\\tan\\phi\\tan\\delta|\\leq 1$，`clip` 函数不起作用，我们得到正常日的情况。\n- 如果 $\\tan\\phi\\tan\\delta  1$（极昼），那么 $-\\tan\\phi\\tan\\delta  -1$。`clip` 函数返回 $-1$，所以 $H_0 = \\arccos(-1) = \\pi$。将 $H_0 = \\pi$ 代入主表达式得到： $Q = \\frac{S_{0}}{\\pi}(\\frac{\\bar{r}}{r})^{2} [\\pi\\sin\\phi\\sin\\delta + (\\sin\\pi)\\cos\\phi\\cos\\delta] = S_0(\\frac{\\bar{r}}{r})^{2}\\sin\\phi\\sin\\delta$。这与极昼的结果相匹配。\n- 如果 $\\tan\\phi\\tan\\delta  -1$（极夜），那么 $-\\tan\\phi\\tan\\delta  1$。`clip` 函数返回 $1$，所以 $H_0 = \\arccos(1) = 0$。将 $H_0 = 0$ 代入主表达式得到： $Q = \\frac{S_{0}}{\\pi}(\\frac{\\bar{r}}{r})^{2} [0\\cdot\\sin\\phi\\sin\\delta + (\\sin 0)\\cos\\phi\\cos\\delta] = 0$。这与极夜的结果相匹配。\n此公式在数学上等价于 B 中的分段函数，并且因其数值稳健性而常被优先选用。\n结论：**正确**。\n\n**E. $Q(\\phi,\\delta,r) = \\dfrac{S_{0}}{\\pi}\\left(\\dfrac{\\bar{r}}{r}\\right)^{2}\\Big[H_{0}\\,\\sin\\phi\\,\\sin\\delta - \\cos\\phi\\,\\cos\\delta\\,\\sin H_{0}\\Big],\\quad H_{0}=\\arccos\\!\\big(-\\tan\\phi\\,\\tan\\delta\\big)$**\n此表达式在方括号内的第二项有一个符号错误；它应该是一个加号，这是从 $\\cos H$ 的积分推导出来的。它也存在与选项 A 相同的数值不稳定性问题。\n结论：**错误**。",
            "answer": "$$\\boxed{BD}$$"
        },
        {
            "introduction": "研究米兰科维奇旋回的最终目的是理解其对地球气候的影响，特别是冰盖的消长。最后的这个实践将从计算强迫转向模拟响应。通过实现和分析一个简化的气候-冰盖模型 ，你将探索周期性的日照强迫如何触发非线性响应和气候状态的突变。这个编程练习介绍了稳定性分析和分岔等概念，为洞察驱动冰期-间冰期旋回的机制提供了宝贵视角。",
            "id": "4063291",
            "problem": "考虑一个旨在捕捉 Milankovitch 轨道强迫对冰盖覆盖影响本质的极简气候-冰盖模型。设状态变量为无量纲冰盖覆盖分数 $x(t) \\in [0,1]$，其演化受到累积和融化的共同影响。累积被建模为具有内禀增长率 $r$ 和环境承载力 $1$ 的逻辑斯蒂增长，而融化则由超过临界阈值的太阳辐射驱动，并且融化速率与超出阈值的部分呈非线性关系。强迫是一个代表太阳辐射轨道调制的正弦函数。时间单位为千年 (ka)，太阳辐射单位为瓦/平方米 ($\\mathrm{W}\\,\\mathrm{m}^{-2}$)，角度单位为弧度。\n\n太阳辐射由下式给出\n$$\nI(t) = \\bar{I} + S \\cos(\\omega t),\n$$\n其中 $\\bar{I}$ 是平均太阳辐射（单位：$\\mathrm{W}\\,\\mathrm{m}^{-2}$），$S$ 是振幅（单位：$\\mathrm{W}\\,\\mathrm{m}^{-2}$），$\\omega = \\frac{2\\pi}{P}$，其中 $P$ 是周期（单位：$\\mathrm{ka}$），$t$ 的单位为 $\\mathrm{ka}$。单位覆盖率的非线性阈值融化速率为\n$$\nM(I) = \\beta\\,\\Theta\\!\\big(I - I_c\\big)\\,\\big(I - I_c\\big)^\\gamma,\n$$\n其中 $\\Theta(\\cdot)$ 是 Heaviside 阶跃函数，定义为当 $y0$ 时 $\\Theta(y)=1$，当 $y \\le 0$ 时 $\\Theta(y)=0$；$\\beta$ 是融化系数（单位：$\\mathrm{ka}^{-1}\\,(\\mathrm{W}\\,\\mathrm{m}^{-2})^{-\\gamma}$）；$I_c$ 是临界太阳辐射（单位：$\\mathrm{W}\\,\\mathrm{m}^{-2}$）；$\\gamma1$ 是非线性指数。\n\n由此得到的关于 $x(t)$ 的常微分方程 (ODE) 是\n$$\n\\frac{dx}{dt} = r\\,x(1-x) - x\\,M\\!\\big(I(t)\\big),\n$$\n其中 $t$ 的单位为 $\\mathrm{ka}$，$r$ 的单位为 $\\mathrm{ka}^{-1}$。定义在 $x=0$ 附近的周期平均 Floquet 指数为\n$$\n\\bar{\\lambda} = r - \\beta\\,\\frac{1}{T}\\int_0^T \\Theta\\!\\big(I(t) - I_c\\big)\\,\\big(I(t) - I_c\\big)^\\gamma\\,dt,\n$$\n其中 $T=P$ 是周期（单位：$\\mathrm{ka}$）。$\\bar{\\lambda}$ 的符号指示了无冰状态 $x=0$ 稳定性的分岔：如果 $\\bar{\\lambda}0$，则小的 $x$ 平均而言会增长；如果 $\\bar{\\lambda}0$，则小的 $x$ 平均而言会衰减。\n\n您的任务是实现该模型，通过在一个轨道周期上进行积分来数值计算 $\\bar{\\lambda}$，并在多个周期上对 ODE 进行积分以估算其长时间行为。对于每个测试用例，计算两个输出：\n- 周期平均 Floquet 指数 $\\bar{\\lambda}$（单位：$\\mathrm{ka}^{-1}$），以浮点数形式表示。\n- 最后一个周期内的平均覆盖率 $\\langle x \\rangle$，为无量纲浮点数。\n\n对 ODE 使用显式前向 Euler 时间步进法，并采用足够小以解析强迫的固定时间步长。在整个积分过程中，将 $x(t)$ 截断使其保持在 $[0,1]$ 区间内。使用 Heaviside 定义：当 $y0$ 时 $\\Theta(y)=1$，当 $y\\le 0$ 时 $\\Theta(y)=0$。\n\n实现程序以处理以下参数集测试套件，每个参数集以 $(r,\\beta,\\gamma,\\bar{I},S,I_c,P)$ 的形式给出：\n\n- 测试 1（正常路径，弱强迫和高阈值）：$(0.05,\\;3\\times10^{-5},\\;2,\\;430,\\;20,\\;440,\\;23)$。\n- 测试 2（强强迫，低阈值，预期崩塌）：$(0.05,\\;3\\times10^{-5},\\;2,\\;430,\\;120,\\;420,\\;23)$。\n- 测试 3（边界情况，波峰触及阈值，无融化）：$(0.05,\\;3\\times10^{-5},\\;2,\\;430,\\;20,\\;450,\\;23)$。\n- 测试 4（非线性增加，中等强迫，预期崩塌）：$(0.05,\\;3\\times10^{-5},\\;3,\\;430,\\;60,\\;440,\\;23)$。\n\n所有太阳辐射量的单位均为 $\\mathrm{W}\\,\\mathrm{m}^{-2}$，所有速率的单位均为 $\\mathrm{ka}^{-1}$，时间的单位为 $\\mathrm{ka}$，角度的单位为弧度。对于 ODE 积分，使用初始条件 $x(0)=0.01$，积分 $N$ 个周期（$N\\ge 100$），每个周期至少使用 $500$ 个时间步。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的输出是一个包含两个浮点数 $[\\bar{\\lambda},\\langle x \\rangle]$ 的列表。例如：$[[\\bar{\\lambda}_1,\\langle x \\rangle_1],[\\bar{\\lambda}_2,\\langle x \\rangle_2],[\\bar{\\lambda}_3,\\langle x \\rangle_3],[\\bar{\\lambda}_4,\\langle x \\rangle_4]]$。",
            "solution": "任务是分析一个简化的气候-冰盖模型，该模型由一个受周期性强迫的一阶非线性常微分方程（ODE）描述。对于几组参数集，我们必须计算两个量：与无冰状态（$x=0$）稳定性相关的周期平均 Floquet 指数 $\\bar{\\lambda}$，以及长期的周期平均冰盖覆盖率 $\\langle x \\rangle$。\n\n该模型由以下 ODE 给出：\n$$\n\\frac{dx}{dt} = r\\,x(1-x) - x\\,M\\!\\big(I(t)\\big)\n$$\n其中 $x(t) \\in [0,1]$ 是冰盖覆盖率，$r$ 是逻辑斯蒂增长率，$M(I(t))$ 是融化速率，它依赖于正弦的太阳辐射强迫 $I(t)$。太阳辐射为 $I(t) = \\bar{I} + S \\cos(\\omega t)$，周期为 $P=2\\pi/\\omega$。融化速率由一个非线性阈值函数定义：\n$$\nM(I) = \\beta\\,\\Theta\\!\\big(I - I_c\\big)\\,\\big(I - I_c\\big)^\\gamma\n$$\n这里，$\\Theta(\\cdot)$ 是 Heaviside 阶跃函数，仅当太阳辐射 $I(t)$ 超过临界阈值 $I_c$ 时，它才会激活融化过程。\n\n对于每个参数集，求解过程涉及一个两部分的数值实现。\n\n### 第 1 部分：计算 Floquet 指数 $\\bar{\\lambda}$\n\n周期平均 Floquet 指数 $\\bar{\\lambda}$ 决定了无冰状态 $x=0$ 的线性稳定性。它通过对小 $x$ 的 ODE 进行线性化得到，结果为 $\\frac{dx}{dt} \\approx (r - M(I(t)))x$。周期 $T=P$ 内一个周期上的平均增长率由下式给出：\n$$\n\\bar{\\lambda} = r - \\frac{1}{P}\\int_0^P M(I(t))\\,dt = r - \\frac{\\beta}{P}\\int_0^P \\Theta\\!\\big(I(t) - I_c\\big)\\,\\big(I(t) - I_c\\big)^\\gamma\\,dt\n$$\n正的 $\\bar{\\lambda}$ 表示无冰状态不稳定，微小扰动（初生的冰盖）将趋于增长。负的 $\\bar{\\lambda}$ 表示稳定，微小的冰盖将会融化消失。\n\n为计算 $\\bar{\\lambda}$，我们将对积分项在一个周期 $P$ 上进行数值积分。梯形法则对于此任务是一种合适且稳健的方法。步骤如下：\n1.  将时间区间 $[0, P]$ 离散化为一个由点 $t_i$ 组成的精细网格。为保证精度，选择 $1000$ 个步长（1001 个点）的分辨率。\n2.  在每个点 $t_i$，计算太阳辐射 $I(t_i) = \\bar{I} + S \\cos(\\omega t_i)$。\n3.  计算被积函数的值，如果 $I(t_i) > I_c$，则 $\\text{integrand}_i = \\beta (I(t_i)-I_c)^\\gamma$，否则为 $0$。这直接实现了 Heaviside 函数 $\\Theta(I(t_i) - I_c)$。\n4.  使用梯形法则 (`numpy.trapz`) 在时间网格上近似计算被积函数值的定积分。\n5.  将积分结果除以周期 $P$ 得到平均融化速率，然后从 $r$ 中减去此值，即可获得 $\\bar{\\lambda}$。\n\n### 第 2 部分：ODE 积分与平均覆盖率 $\\langle x \\rangle$ 的计算\n\n冰盖覆盖率 $x(t)$ 的长期行为，可通过在足够多的强迫周期上对完整的非线性 ODE 进行积分来求得，以使系统接近其吸引子（例如，一个稳定的不动点或极限环）。\n\n我们将按照指定，使用显式前向 Euler 方法。对于一个时间步长 $dt$，更新规则为：\n$$\nx(t+dt) = x(t) + dt \\cdot \\left[ r\\,x(t)(1-x(t)) - x(t)\\,M\\!\\big(I(t)\\big) \\right]\n$$\n状态变量 $x$ 必须被约束在具有物理意义的区间 $[0, 1]$ 内。这通过在每个时间步后截断 $x$ 的值来实现。\n\n过程如下：\n1.  设置初始条件 $x(0) = 0.01$。\n2.  选择一个足够小的时间步长 $dt$ 以解析强迫动力学并确保数值稳定性。我们选择每个周期 $1000$ 个步长，因此 $dt = P/1000$。\n3.  在大量周期（$N=100$）上对 ODE 进行积分，以确保系统已稳定到其长期吸引子上。总积分时间为 $100 \\times P$。\n4.  在每个时间步中，计算 $I(t)$、相应的融化速率 $M(I(t))$ 以及导数 $dx/dt$。然后，使用 Euler 公式更新 $x$ 并应用截断。\n5.  在完成全部积分后，计算最后一个周期内的平均覆盖率 $\\langle x \\rangle$。这通过计算在最后一个（第 100 个）周期中记录的 $x(t)$ 存储值的算术平均值来实现。该平均值反映了系统在吸引子上的行为。\n\n对提供的四个测试用例中的每一个都执行这两部分操作，为每个用例生成一对值 $[\\bar{\\lambda}, \\langle x \\rangle]$。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the climate-ice model problem for a suite of test cases.\n    \"\"\"\n\n    def run_case(r, beta, gamma, I_bar, S, I_c, P):\n        \"\"\"\n        Computes the Floquet exponent and long-term mean ice coverage for one parameter set.\n\n        Args:\n            r (float): Intrinsic growth rate (ka^-1).\n            beta (float): Melt coefficient (ka^-1 * (W m^-2)^-gamma).\n            gamma (float): Nonlinearity exponent.\n            I_bar (float): Mean insolation (W m^-2).\n            S (float): Insolation amplitude (W m^-2).\n            I_c (float): Critical insolation for melting (W m^-2).\n            P (float): Period of orbital forcing (ka).\n\n        Returns:\n            list: A list containing the calculated [lambda_bar, avg_x].\n        \"\"\"\n        # --- Model and Numerical Parameters ---\n        omega = 2.0 * math.pi / P\n        n_cycles_ode = 100\n        steps_per_cycle = 1000\n        \n        # --- Part 1: Calculate the cycle-averaged Floquet exponent lambda_bar ---\n        \n        # Create a time grid for one cycle for numerical integration\n        num_integral_points = steps_per_cycle + 1\n        t_one_cycle = np.linspace(0, P, num_integral_points)\n        \n        # Calculate insolation and the melt integrand over one cycle\n        I_one_cycle = I_bar + S * np.cos(omega * t_one_cycle)\n        I_diff = I_one_cycle - I_c\n        \n        # Apply Heaviside function: integrand is non-zero only if I > I_c\n        melt_integrand = np.where(I_diff > 0, beta * np.power(I_diff, gamma), 0.0)\n        \n        # Numerically integrate using the trapezoidal rule\n        melt_integral = np.trapz(melt_integrand, t_one_cycle)\n        \n        # Calculate the final Floquet exponent\n        avg_melt_rate = melt_integral / P\n        lambda_bar = r - avg_melt_rate\n\n        # --- Part 2: Integrate ODE to find long-term behavior ---\n        \n        total_steps = n_cycles_ode * steps_per_cycle\n        dt = P / steps_per_cycle\n        \n        # Initialize array to store ice coverage history\n        x = np.zeros(total_steps + 1)\n        x[0] = 0.01  # Initial condition\n\n        # Perform explicit forward Euler time-stepping\n        for i in range(total_steps):\n            t_i = i * dt\n            x_i = x[i]\n            \n            # Calculate instantaneous insolation and melt rate\n            I_i = I_bar + S * np.cos(omega * t_i)\n            \n            m_i = 0.0\n            if I_i > I_c:\n                m_i = beta * ((I_i - I_c) ** gamma)\n            \n            # Calculate derivative dx/dt\n            dxdt = r * x_i * (1.0 - x_i) - x_i * m_i\n            \n            # Update state with Euler step and clip to [0, 1]\n            x_next = x_i + dt * dxdt\n            x[i+1] = np.clip(x_next, 0.0, 1.0)\n            \n        # --- Part 3: Calculate mean coverage over the last cycle ---\n        \n        # Extract the solution over the final cycle\n        x_last_cycle = x[-steps_per_cycle-1:]\n        avg_x = np.mean(x_last_cycle)\n        \n        return [lambda_bar, avg_x]\n\n    # --- Test Suite ---\n    test_cases = [\n        # (r, beta, gamma, I_bar, S, I_c, P)\n        (0.05, 3e-5, 2, 430, 20, 440, 23),\n        (0.05, 3e-5, 2, 430, 120, 420, 23),\n        (0.05, 3e-5, 2, 430, 20, 450, 23),\n        (0.05, 3e-5, 3, 430, 60, 440, 23),\n    ]\n\n    results = []\n    for case in test_cases:\n        result_pair = run_case(*case)\n        results.append(result_pair)\n    \n    # --- Format and Print Output ---\n    # Construct the output string exactly as specified.\n    formatted_pairs = [f\"[{res[0]},{res[1]}]\" for res in results]\n    output_str = f\"[{','.join(formatted_pairs)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}