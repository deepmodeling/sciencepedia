{
    "hands_on_practices": [
        {
            "introduction": "这项练习直击大气河诊断的核心。你将实现一个算法，计算两个基本输送指标：积分水汽输送（$IVT$）和湿静力能量（$MSE$）输送。通过从静力平衡等第一性原理出发推导这些计算过程，你将更深入地理解定义大气河强度及其在向极地能量输送中作用的物理机制。",
            "id": "4014352",
            "problem": "您的任务是设计并实现一个数值算法，用以计算大气河（AR）横截面上的轴向湿静能（MSE）输送，并将此输送与积分水汽输送（IVT）进行比较。该算法必须从适用于数值天气预报和气候建模的基本原理出发，不使用简化公式。具体来说，您必须从静力平衡和单位质量湿静能的定义开始。您将在气压坐标系中处理大气，并使用科学上合理的离散化方法计算输送的垂直积分。\n\n使用的基本原理：\n- 静力平衡：$dp = -\\rho g \\, dz$，其中 $p$ 是气压，$\\rho$ 是空气密度，$g$ 是重力加速度，$z$ 是几何高度。\n- 测高关系：通过虚温将高度与气压联系起来。使用由温度 $T$ 和比湿 $q$ 通过一个带常数因子的一阶近似定义的 $T_v$，并与静力学基础一致地积分厚度。\n- 单位质量湿静能是比焓、潜能和重力势能之和。使用这些项的核心定义来推导输送表达式。\n- 单位宽度的轴向输送必须从气压坐标中相应物理量的质量通量加权积分推导出来。\n\n使用的常数（所有量均以国际单位制表示）：\n- 干空气定压比热 $c_p = 1004.0 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n- 水的汽化潜热 $L_v = 2.5 \\times 10^{6} \\ \\mathrm{J\\,kg^{-1}}$。\n- 重力加速度 $g = 9.81 \\ \\mathrm{m\\,s^{-2}}$。\n- 干空气气体常数 $R_d = 287.0 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n- 虚温因子 $\\epsilon = 0.61$，用于 $T_v = T (1 + \\epsilon q)$。\n\n程序要求：\n- 使用上述基本原理，推导、实现并计算垂直积分的单位宽度轴向MSE输送，并将其分解为与比焓、潜能和重力势能相关的分量，然后计算总MSE输送作为它们的和。\n- 在气压坐标系中使用相同的基础，推导、实现并计算积分水汽输送（IVT）。\n- 对所有垂直积分使用气压坐标下的梯形离散化方法。\n- 使用带有虚温的测高关系计算作为气压函数的几何高度。将最低层的高度设为 $z = 0$。\n- 将输送视为沿指定轴向风向的有符号量；在评估焓和潜能分量的主导地位时，通过绝对值比较它们的大小。\n\n单位和输出：\n- 单位宽度的MSE输送以瓦特每米（$\\mathrm{W\\,m^{-1}}$）表示。\n- 积分水汽输送以千克每米每秒（$\\mathrm{kg\\,m^{-1}\\,s^{-1}}$）表示。\n- 对于每个测试案例，按此确切顺序输出六个值：总MSE输送、潜能输送分量、焓输送分量、重力势能输送分量、IVT，以及一个布尔值，指示潜能输送分量的大小是否超过焓输送分量的大小。所有浮点输出必须使用上述单位。布尔值必须根据两个能量分量的绝对值计算。\n\n测试套件：\n为以下四个科学上合理的大气河横截面提供计算。每个案例包含帕斯卡（pascals）为单位的气压层 $p$、米每秒（meters per second）为单位的轴向风速 $u$、开尔文（kelvin）为单位的温度 $T$ 和千克每千克（kilograms per kilogram）为单位的比湿 $q$ 的数组。在每个案例中，气压层从近地面向高空排序。\n\n- 案例 $1$（暖、湿、低层风强）：\n  - $p = [100000, 92500, 85000, 70000] \\ \\mathrm{Pa}$\n  - $u = [25, 30, 28, 20] \\ \\mathrm{m\\,s^{-1}}$\n  - $T = [290, 285, 280, 270] \\ \\mathrm{K}$\n  - $q = [0.015, 0.012, 0.009, 0.006] \\ \\mathrm{kg\\,kg^{-1}}$\n- 案例 $2$（冷、干、风随高度减弱）：\n  - $p = [100000, 90000, 80000, 70000] \\ \\mathrm{Pa}$\n  - $u = [20, 18, 15, 12] \\ \\mathrm{m\\,s^{-1}}$\n  - $T = [275, 270, 265, 260] \\ \\mathrm{K}$\n  - $q = [0.006, 0.004, 0.003, 0.002] \\ \\mathrm{kg\\,kg^{-1}}$\n- 案例 $3$（中低层风非常强，湿度中等）：\n  - $p = [100000, 95000, 90000, 85000] \\ \\mathrm{Pa}$\n  - $u = [35, 40, 45, 50] \\ \\mathrm{m\\,s^{-1}}$\n  - $T = [288, 286, 284, 282] \\ \\mathrm{K}$\n  - $q = [0.010, 0.009, 0.008, 0.007] \\ \\mathrm{kg\\,kg^{-1}}$\n- 案例 $4$（高空逆风减少净输送）：\n  - $p = [100000, 92500, 85000, 80000] \\ \\mathrm{Pa}$\n  - $u = [2, 1, 0, -1] \\ \\mathrm{m\\,s^{-1}}$\n  - $T = [285, 282, 279, 276] \\ \\mathrm{K}$\n  - $q = [0.012, 0.010, 0.008, 0.005] \\ \\mathrm{kg\\,kg^{-1}}$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。该列表必须按顺序连接案例1的六个输出，然后是案例2、案例3和案例4的输出。例如，输出必须类似于 $[x_1,x_2,x_3,x_4,x_5,x_6,y_1,y_2,\\dots]$，其中每个 $x_i$ 和 $y_i$ 是如上所述的浮点数或布尔值。",
            "solution": "问题是计算大气河横截面上垂直积分的轴向湿静能（MSE）输送和积分水汽输送（IVT）。计算必须从基本原理推导，特别是静力平衡和相关物理量的定义。解决方案分四部分展开：通用输送积分的推导、在IVT和MSE上的应用、位势高度的计算以及数值实现。\n\n沿风分量为 $u$ 的轴线，单位宽度的通用内含性质 $\\phi$（单位质量的量）的水平输送的基本表达式是质量通量（$\\rho u$）乘以 $\\phi$ 的垂直积分。在几何高度（$z$）坐标系中，表达式为：\n$$ T_{\\phi} = \\int_{z_{sfc}}^{z_{top}} \\rho u \\phi \\, dz $$\n其中 $\\rho$ 是空气密度，$z_{sfc}$ 是地表高度，$z_{top}$ 是所考虑大气柱的顶部高度。\n\n在大气计算中，通常使用气压（$p$）作为垂直坐标。坐标变换基于静力平衡方程：\n$$ dp = -\\rho g \\, dz $$\n其中 $g$ 是重力加速度。因此，单位面积的质量元 $dm = \\rho dz$ 可以表示为 $dm = -dp/g$。将此代入输送积分，我们将其变换到气压坐标系中：\n$$ T_{\\phi} = \\int_{p(z_{sfc})}^{p(z_{top})} u \\phi \\left(-\\frac{dp}{g}\\right) = \\frac{1}{g} \\int_{p_{top}}^{p_{sfc}} u \\phi \\, dp $$\n此处，$p_{sfc}$ 和 $p_{top}$ 分别是积分域底部和顶部的气压。这个通用公式是所有后续计算的基础。\n\n**1. 积分水汽输送 (IVT)**\n积分水汽输送是水汽输送的垂直积分。在此背景下，比定量 $\\phi$ 是比湿 $q$。将 $\\phi = q$ 代入通用输送公式，得到IVT的表达式：\n$$ IVT = \\frac{1}{g} \\int_{p_{top}}^{p_{sfc}} u q \\, dp $$\nIVT的单位由各分量导出：$[g]^{-1} [u] [q] [p]$，在国际单位制下是 $(\\mathrm{m\\,s^{-2}})^{-1} (\\mathrm{m\\,s^{-1}}) (1) (\\mathrm{Pa}) = (\\mathrm{s^2\\,m^{-1}})(\\mathrm{m\\,s^{-1}})(\\mathrm{N\\,m^{-2}}) = \\mathrm{s\\,N\\,m^{-2}} = \\mathrm{s\\,(kg\\,m\\,s^{-2})\\,m^{-2}} = \\mathrm{kg\\,m^{-1}\\,s^{-1}}$。这与要求的单位相符。\n\n**2. 湿静能 (MSE) 输送**\n单位质量的湿静能 $m$ 是比焓（$h$）、潜能（$L_v q$）和重力势能（$gz$）的总和：\n$$ m = h + L_v q + gz $$\n对于湿空气，比焓可以很好地近似为 $h \\approx c_p T$，其中 $c_p$ 是干空气的定压比热，$T$ 是温度。因此，MSE为：\n$$ m = c_p T + L_v q + gz $$\n将 $\\phi=m$ 代入通用公式，得到总的垂直积分MSE输送 $T_m$：\n$$ T_m = \\frac{1}{g} \\int_{p_{top}}^{p_{sfc}} u (c_p T + L_v q + gz) \\, dp $$\nMSE输送的单位是 $(\\mathrm{kg\\,m^{-1}\\,s^{-1}}) \\times (\\mathrm{J\\,kg^{-1}}) = \\mathrm{J\\,m^{-1}\\,s^{-1}} = \\mathrm{W\\,m^{-1}}$，符合要求。根据积分的线性性质，这个总输送可以分解为三个分量：\n- 焓输送 ($T_h$):\n    $$ T_h = \\frac{1}{g} \\int_{p_{top}}^{p_{sfc}} u (c_p T) \\, dp $$\n- 潜能输送 ($T_L$):\n    $$ T_L = \\frac{1}{g} \\int_{p_{top}}^{p_{sfc}} u (L_v q) \\, dp $$\n- 重力势能输送 ($T_z$):\n    $$ T_z = \\frac{1}{g} \\int_{p_{top}}^{p_{sfc}} u (gz) \\, dp = \\int_{p_{top}}^{p_{sfc}} u z \\, dp $$\n\n**3. 几何高度 ($z$) 的计算**\n势能输送分量 $T_z$ 需要几何高度 $z$ 作为气压 $p$ 的函数。该关系由静力平衡方程和湿空气的理想气体定律 $p = \\rho R_d T_v$ 推导得出，其中 $R_d$ 是干空气的气体常数，$T_v$ 是虚温。虚温由一阶近似 $T_v = T(1 + \\epsilon q)$ 给出，其中 $\\epsilon = 0.61$。\n根据静力平衡方程，$dz = -dp/(\\rho g)$。代入 $\\rho = p/(R_d T_v)$ 得到测高方程的微分形式：\n$$ dz = -\\frac{R_d T_v}{g} \\frac{dp}{p} $$\n为了求出气压层 $p_i$ 相对于较低气压层 $p_{i-1}$（其中 $p_{i-1} > p_i$）的高度 $z_i$，我们对此表达式进行积分。气层厚度 $\\Delta z = z_i - z_{i-1}$ 为：\n$$ \\Delta z = \\int_{p_{i-1}}^{p_i} -\\frac{R_d T_v}{g} \\frac{dp}{p} = \\frac{R_d}{g} \\int_{p_i}^{p_{i-1}} \\frac{T_v}{p} dp $$\n假设层平均虚温 $\\bar{T}_{v,i} = \\frac{1}{2}(T_{v,i} + T_{v,i-1})$ 为常数，积分得到：\n$$ \\Delta z = \\frac{R_d \\bar{T}_{v,i}}{g} \\ln\\left(\\frac{p_{i-1}}{p_i}\\right) $$\n问题指定最低气压层（最高气压，索引 $i=0$）位于 $z_0=0$。所有其他层的高度通过迭代计算：$z_i = z_{i-1} + \\Delta z$。\n\n**4. 数值离散化与算法**\n推导出的积分使用梯形法则进行数值计算。输入数据是在离散气压层 $p_0, p_1, \\dots, p_{N-1}$ 上给出的，从近地面到高空排序（$p_0 > p_1 > \\dots > p_{N-1}$）。函数 $F(p)$ 从 $p_{top}=p_{N-1}$ 到 $p_{sfc}=p_0$ 的积分近似为：\n$$ \\int_{p_{N-1}}^{p_0} F(p) \\, dp \\approx \\sum_{i=1}^{N-1} \\frac{F(p_i) + F(p_{i-1})}{2} (p_{i-1} - p_i) $$\n这个和可以高效计算。对于函数值数组 `F` 和坐标数组 `p`（其中 `p` 是递减的），积分 $\\int_{p_0}^{p_{N-1}} F(p) dp$ 由 `numpy.trapz(F, x=p)` 计算。由于我们的积分方向相反，是从 $p_{N-1}$ 到 $p_0$，因此需要对该结果取反。\n\n每个测试案例的完整算法如下：\n1.  建立常数：$c_p = 1004.0 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，$L_v = 2.5 \\times 10^6 \\ \\mathrm{J\\,kg^{-1}}$，$g = 9.81 \\ \\mathrm{m\\,s^{-2}}$，$R_d = 287.0 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，以及 $\\epsilon = 0.61$。\n2.  对于给定的 $p, u, T, q$ 数组，首先计算每个气压层上的几何高度 $z$。\n    a. 在每个层上计算虚温 $T_v$：$T_{v,i} = T_i (1 + \\epsilon q_i)$。\n    b. 初始化 $z_0=0$。\n    c. 对于 $i$ 从 $1$ 到 $N-1$，计算层厚度 $\\Delta z_i = \\frac{R_d}{g} \\frac{T_{v,i}+T_{v,i-1}}{2} \\ln(p_{i-1}/p_i)$ 并设置 $z_i = z_{i-1} + \\Delta z_i$。\n3.  在每个气压层上定义每个输送计算的被积函数：\n    - IVT 被积函数：$F_{IVT} = uq$\n    - 焓输送被积函数：$F_h = u c_p T$\n    - 潜能输送被积函数：$F_L = u L_v q$\n    - 势能输送被积函数：$F_{z_g} = u g z$\n4.  使用梯形法则计算每个垂直积分输送：\n    -   $IVT = \\frac_1{g} \\left( -\\int_{p_0}^{p_{N-1}} F_{IVT} \\,dp \\right)$\n    -   $T_h = \\frac_1{g} \\left( -\\int_{p_0}^{p_{N-1}} F_{h} \\,dp \\right)$\n    -   $T_L = \\frac_1{g} \\left( -\\int_{p_0}^{p_{N-1}} F_L \\,dp \\right)$\n    -   $T_z = \\frac_1{g} \\left( -\\int_{p_0}^{p_{N-1}} F_{z_g} \\,dp \\right)$\n5.  计算总MSE输送：$T_m = T_h + T_L + T_z$。\n6.  判断潜能输送的大小是否超过焓输送的大小：$|T_L| > |T_h|$。\n7.  按顺序收集六个所需的输出值：$T_m, T_L, T_h, T_z, IVT$ 和布尔结果。\n该过程适用于所有提供的测试案例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes axis-parallel transport of Moist Static Energy (MSE) and\n    Integrated Vapor Transport (IVT) for given atmospheric profiles.\n    \"\"\"\n\n    # Define physical constants in SI units\n    c_p = 1004.0  # Specific heat at constant pressure for dry air (J/kg/K)\n    L_v = 2.5e6   # Latent heat of vaporization of water (J/kg)\n    g = 9.81      # Gravitational acceleration (m/s^2)\n    R_d = 287.0   # Gas constant for dry air (J/kg/K)\n    epsilon = 0.61  # Factor for virtual temperature calculation\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Case 1 (warm, moist, strong low-level winds)\n        (\n            [100000, 92500, 85000, 70000],  # p (Pa)\n            [25, 30, 28, 20],  # u (m/s)\n            [290, 285, 280, 270],  # T (K)\n            [0.015, 0.012, 0.009, 0.006]  # q (kg/kg)\n        ),\n        # Case 2 (cool, drier, weakening winds with height)\n        (\n            [100000, 90000, 80000, 70000],  # p (Pa)\n            [20, 18, 15, 12],  # u (m/s)\n            [275, 270, 265, 260],  # T (K)\n            [0.006, 0.004, 0.003, 0.002]  # q (kg/kg)\n        ),\n        # Case 3 (very strong low- to mid-level winds, moderate humidity)\n        (\n            [100000, 95000, 90000, 85000],  # p (Pa)\n            [35, 40, 45, 50],  # u (m/s)\n            [288, 286, 284, 282],  # T (K)\n            [0.010, 0.009, 0.008, 0.007]  # q (kg/kg)\n        ),\n        # Case 4 (counterflow aloft reducing net transport)\n        (\n            [100000, 92500, 85000, 80000],  # p (Pa)\n            [2, 1, 0, -1],  # u (m/s)\n            [285, 282, 279, 276],  # T (K)\n            [0.012, 0.010, 0.008, 0.005]  # q (kg/kg)\n        )\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        p_list, u_list, T_list, q_list = case\n        p = np.array(p_list, dtype=float)\n        u = np.array(u_list, dtype=float)\n        T = np.array(T_list, dtype=float)\n        q = np.array(q_list, dtype=float)\n\n        # 1. Calculate geometric height z(p) using the hypsometric equation.\n        # The arrays are ordered from surface to top, so p is decreasing.\n        # z=0 at the first level (highest pressure).\n        N = len(p)\n        z = np.zeros_like(p)\n        T_v = T * (1 + epsilon * q)\n\n        for i in range(1, N):\n            # Layer is between levels i-1 and i\n            T_v_mean = (T_v[i-1] + T_v[i]) / 2.0\n            # Hypsometric formula for layer thickness\n            delta_z = (R_d * T_v_mean / g) * np.log(p[i-1] / p[i])\n            z[i] = z[i-1] + delta_z\n\n        # 2. Define integrands for transport calculations\n        integrand_ivt = u * q\n        integrand_h = u * c_p * T\n        integrand_L = u * L_v * q\n        integrand_z = u * g * z\n\n        # 3. Perform vertical integration using the trapezoidal rule\n        # The integral is (1/g) * Integral[F(p) dp] from p_top to p_sfc.\n        # np.trapz(F, x=p) integrates from p_sfc to p_top (as p is decreasing)\n        # so we must negate the result to get the desired integral direction.\n        \n        ivt = (1.0 / g) * (-np.trapz(integrand_ivt, x=p))\n        \n        transport_h = (1.0 / g) * (-np.trapz(integrand_h, x=p))\n        transport_L = (1.0 / g) * (-np.trapz(integrand_L, x=p))\n        transport_z = (1.0 / g) * (-np.trapz(integrand_z, x=p))\n\n        # 4. Calculate total MSE transport and the boolean comparison\n        total_mse_transport = transport_h + transport_L + transport_z\n        is_latent_dominant = np.abs(transport_L) > np.abs(transport_h)\n\n        # 5. Append the six results for this case\n        all_results.extend([\n            total_mse_transport,\n            transport_L,\n            transport_h,\n            transport_z,\n            ivt,\n            is_latent_dominant\n        ])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在气候科学中，建立可靠的大气河目录是一项至关重要的任务，但其他天气系统可能会模仿大气河的特征，使这项任务变得复杂。本练习旨在挑战你设计一个分类算法，以区分真正的大气河与热带气旋、静止锋等现象。通过结合水汽输送、涡度、锋生动力学等指标，你将开发出一个用于稳健气候特征识别的实用工具。",
            "id": "4014390",
            "problem": "您的任务是为大气长河（AR）目录形式化一个排除算法，该算法通过结合积分水汽输送（IVT）与涡度、锋生和移动速度过滤器，移除与热带气旋和静止锋相关的特征。您的程序必须使用公认的动力学定义，从第一性原理实现决策逻辑，并为每个测试用例生成一个布尔决策：是保留在 AR 目录中还是排除。该问题以纯数学术语表述，所有输入均以候选对象的预计算特征标量形式提供。\n\n基本原理：\n- 将垂直积分水汽输送矢量 $\\mathbf{I}$ 定义为静力积分\n$$\n\\mathbf{I} = \\frac{1}{g} \\int_{p_t}^{p_s} q(p) \\, \\mathbf{v}(p) \\, \\mathrm{d}p,\n$$\n其大小为 $I = \\|\\mathbf{I}\\|$，其中 $g$ 是重力加速度，$p_s$ 是地面气压，$p_t$ 是顶层气压，$q$ 是比湿，$\\mathbf{v}$ 是水平风矢量。在实践中，$I$ 以 $\\mathrm{kg \\, m^{-1} \\, s^{-1}}$ 为单位的标量大小形式提供。\n- 将笛卡尔坐标系中的水平相对涡度 $\\zeta$ 定义为\n$$\n\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y},\n$$\n单位为 $\\mathrm{s^{-1}}$，其中 $u$ 和 $v$ 分别是纬向和经向风分量。\n- 将锋生 $F$ 定义为位温梯度大小的物质变化率，\n$$\nF = \\frac{D}{Dt} \\left\\| \\nabla \\theta \\right\\|,\n$$\n当锋面增强时，该值为正。此处，$F$ 以 $\\mathrm{K \\, m^{-1} \\, s^{-1}}$ 为单位的标量形式提供。\n- 将对象质心的移动速度 $U_t$ 定义为\n$$\nU_t = \\frac{\\left\\| \\Delta \\mathbf{x} \\right\\|}{\\Delta t},\n$$\n单位为 $\\mathrm{m \\, s^{-1}}$。\n- 将从闭合 $\\zeta$ 等值线导出的无量纲涡核紧凑度 $\\chi \\in [0,1]$ 定义为\n$$\n\\chi = \\frac{4 \\pi A}{P^2},\n$$\n其中 $A$ 是围成的面积，$P$ 是其周长。接近 $1$ 的值表示紧凑的圆形核心，而接近 $0$ 的值表示拉长或丝状的结构。\n\n设计要求：\n- 一个候选 AR 对象必须首先满足基于拉长廊道定义的 IVT 和几何形状筛选：大的 $I$ 值、大的纵横比和足够的长度。使用阈值 $I_0$、$A_0$ 和 $L_0$。\n- 当存在紧凑、强烈的气旋核心时，排除热带气旋污染。对相对涡度和涡核紧凑度使用同步阈值。\n- 使用对锋生和低移动速度的同步阈值来排除静止锋。\n\n为每个由元组 $\\left(I_k, A_k, L_k, \\zeta_k, \\chi_k, F_k, U_{t,k}\\right)$ 描述的候选对象 $k$ 实现以下逻辑算法：\n- 候选 AR 筛选：\n  - 如果 $I_k \\ge I_0$，$A_k \\ge A_0$ 且 $L_k \\ge L_0$，则接受为候选对象。\n- 热带气旋排除：\n  - 如果 $\\zeta_k \\ge \\zeta_0$ 且 $\\chi_k \\ge \\chi_0$，则排除。\n- 静止锋排除：\n  - 如果 $F_k \\ge F_0$ 且 $U_{t,k} \\le U_0$，则排除。\n- 最终保留决策：\n  - 当且仅当候选对象筛选通过且两个排除条件均不适用时，才保留在 AR 目录中。\n\n使用以下以国际单位制（SI）表示的物理上合理的阈值：\n- $I_0 = 250 \\, \\mathrm{kg \\, m^{-1} \\, s^{-1}}$,\n- $A_0 = 2.0$,\n- $L_0 = 1.5 \\times 10^{6} \\, \\mathrm{m}$,\n- $\\zeta_0 = 7.0 \\times 10^{-4} \\, \\mathrm{s^{-1}}$,\n- $\\chi_0 = 0.6$,\n- $F_0 = 1.8 \\times 10^{-9} \\, \\mathrm{K \\, m^{-1} \\, s^{-1}}$,\n- $U_0 = 2.0 \\, \\mathrm{m \\, s^{-1}}$.\n\n程序输入：\n- 将以下测试套件以 SI 单位硬编码为元组 $(I, A, L, \\zeta, \\chi, F, U_t)$ 的列表：\n  - 测试 $1$：$(500.0, 4.0, 3.0 \\times 10^{6}, 2.0 \\times 10^{-4}, 0.2, 5.0 \\times 10^{-10}, 10.0)$。\n  - 测试 $2$：$(600.0, 3.0, 2.0 \\times 10^{6}, 1.1 \\times 10^{-3}, 0.8, 1.0 \\times 10^{-9}, 6.0)$。\n  - 测试 $3$：$(400.0, 4.0, 2.5 \\times 10^{6}, 3.0 \\times 10^{-4}, 0.3, 2.2 \\times 10^{-9}, 0.5)$。\n  - 测试 $4$：$(250.0, 2.0, 1.5 \\times 10^{6}, 6.5 \\times 10^{-4}, 0.7, 1.6 \\times 10^{-9}, 3.0)$。\n  - 测试 $5$：$(550.0, 3.5, 2.0 \\times 10^{6}, 8.0 \\times 10^{-4}, 0.4, 1.0 \\times 10^{-9}, 8.0)$。\n  - 测试 $6$：$(200.0, 2.5, 2.0 \\times 10^{6}, 2.0 \\times 10^{-4}, 0.3, 1.0 \\times 10^{-9}, 5.0)$。\n  - 测试 $7$：$(450.0, 2.1, 1.6 \\times 10^{6}, 2.0 \\times 10^{-4}, 0.5, 1.8 \\times 10^{-9}, 2.0)$。\n  - 测试 $8$：$(520.0, 3.2, 2.2 \\times 10^{6}, 3.0 \\times 10^{-4}, 0.35, 2.5 \\times 10^{-9}, 2.1)$。\n\n输出规范：\n- 对于每个测试用例，根据上述算法计算一个布尔保留决策，其中 true 值表示“保留在 AR 目录中”，false 值表示“排除”。\n- 您的程序应生成单行输出，其中包含用方括号括起来、以逗号分隔且不含空格的结果列表，例如 $[{\\mathrm{True}},{\\mathrm{False}},\\dots]$。\n\n物理和数值单位：\n- 所有输入均使用指定的 SI 单位。\n- 输出不涉及角度或百分比。\n- 输出是一个布尔值列表，因此无单位。\n\n交付成果：\n- 提供一个完整、可运行的程序，该程序实现此逻辑并完全按照规定为测试套件打印单行输出。",
            "solution": "该问题是有效的。它提出了一个清晰、独立且有科学依据的任务，即实现一个用于大气现象的分类算法。所提供的物理定义、逻辑规则和数值数据是一致且充分的，足以对每个测试用例推导出唯一解。\n\n目标是创建一个算法，以决定是从大气长河（AR）目录中保留还是排除给定的大气特征。AR 是一条狭长的集中水汽输送廊道。该算法必须过滤掉那些虽然可能具有高水汽含量，但在动力学上有所不同（特别是热带气旋（TC）和静止锋（SF））的特征。对每个由标量属性元组 $(I_k, A_k, L_k, \\zeta_k, \\chi_k, F_k, U_{t,k})$ 描述的候选特征 $k$ 的决策过程，被构建为一个三阶段的逻辑过程。\n\n首先，候选特征必须通过筛选，以确定其是否满足 AR 的基本定义。此筛选基于垂直积分水汽输送大小（$I_k$）、纵横比（$A_k$）和长度（$L_k$）。AR 的特点是强水汽输送（$I_k$）、拉长的形状（高纵横比 $A_k$）和显著的长度（$L_k$）。当且仅当以下所有三个不等式都满足时，布尔条件 `is_candidate` 才为真：\n$$I_k \\ge I_0$$\n$$A_k \\ge A_0$$\n$$L_k \\ge L_0$$\n阈值给定为 $I_0 = 250 \\, \\mathrm{kg \\, m^{-1} \\, s^{-1}}$，$A_0 = 2.0$（无量纲），以及 $L_0 = 1.5 \\times 10^{6} \\, \\mathrm{m}$。如果候选特征未能通过此筛选，它将立即被排除。\n\n其次，如果一个特征通过了初始筛选，它将被用热带气旋排除过滤器进行检查。TC 的特点是非常强、紧凑的气旋性旋转。该算法使用相对涡度（$\\zeta_k$）和无量纲涡核紧凑度指标（$\\chi_k$）的阈值来识别此类特征。高 $\\zeta_k$ 值表示强旋转，高 $\\chi_k$ 值（接近 $1$）表示圆形、紧凑的核心，这两者都是 TC 的标志。当且仅当以下两个不等式同时满足时，布尔条件 `is_tc` 才为真：\n$$\\zeta_k \\ge \\zeta_0$$\n$$\\chi_k \\ge \\chi_0$$\n阈值给定为 $\\zeta_0 = 7.0 \\times 10^{-4} \\, \\mathrm{s^{-1}}$ 和 $\\chi_0 = 0.6$。\n\n第三，对该特征进行静止锋排除过滤器检查。静止锋或准静止锋可以表现出强水汽辐合，但缺乏 AR 所特有的快速、连贯的平流特性。此过滤器通过结合锋面增强的度量（锋生，$F_k$）与特征的移动速度（$U_{t,k}$）来识别此类特征。如果一个特征在移动非常缓慢的同时表现出显著的锋生，它就会被标记为静止锋。当且仅当以下两个不等式同时满足时，布尔条件 `is_sf` 才为真：\n$$F_k \\ge F_0$$\n$$U_{t,k} \\le U_0$$\n阈值给定为 $F_0 = 1.8 \\times 10^{-9} \\, \\mathrm{K \\, m^{-1} \\, s^{-1}}$ 和 $U_0 = 2.0 \\, \\mathrm{m \\, s^{-1}}$。\n\n最后，做出将特征保留在 AR 目录中的决定。一个特征当且仅当通过了初始候选筛选，并且既不被 TC 过滤器也不被 SF 过滤器排除时，才会被保留。该逻辑由复合布尔表达式表示：\n$$\\text{keep} = \\text{is\\_candidate} \\land (\\neg \\text{is\\_tc}) \\land (\\neg \\text{is\\_sf})$$\n其中 $\\land$ 表示逻辑与运算符，$\\neg$ 表示逻辑非运算符。\n\n这个完整的逻辑框架被应用于所提供的每个测试用例。程序将遍历输入元组列表，评估这三个条件，计算最终的 `keep` 决策（一个布尔值），并将这些布尔值收集到一个输出列表中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a decision algorithm to classify atmospheric features\n    for inclusion in or exclusion from an Atmospheric River (AR) catalog.\n    \"\"\"\n\n    # Define the physical thresholds in SI units as specified in the problem.\n    I_0 = 250.0  # kg m^-1 s^-1\n    A_0 = 2.0  # dimensionless aspect ratio\n    L_0 = 1.5e6  # m\n    ZETA_0 = 7.0e-4  # s^-1\n    CHI_0 = 0.6  # dimensionless compactness\n    F_0 = 1.8e-9  # K m^-1 s^-1\n    U_0 = 2.0  # m s^-1\n\n    # Define the test cases as a list of tuples:\n    # (I, A, L, zeta, chi, F, U_t)\n    test_cases = [\n        (500.0, 4.0, 3.0e6, 2.0e-4, 0.2, 5.0e-10, 10.0),   # Test 1\n        (600.0, 3.0, 2.0e6, 1.1e-3, 0.8, 1.0e-9, 6.0),    # Test 2\n        (400.0, 4.0, 2.5e6, 3.0e-4, 0.3, 2.2e-9, 0.5),    # Test 3\n        (250.0, 2.0, 1.5e6, 6.5e-4, 0.7, 1.6e-9, 3.0),    # Test 4\n        (550.0, 3.5, 2.0e6, 8.0e-4, 0.4, 1.0e-9, 8.0),    # Test 5\n        (200.0, 2.5, 2.0e6, 2.0e-4, 0.3, 1.0e-9, 5.0),    # Test 6\n        (450.0, 2.1, 1.6e6, 2.0e-4, 0.5, 1.8e-9, 2.0),    # Test 7\n        (520.0, 3.2, 2.2e6, 3.0e-4, 0.35, 2.5e-9, 2.1),   # Test 8\n    ]\n\n    results = []\n    for case in test_cases:\n        I_k, A_k, L_k, zeta_k, chi_k, F_k, U_t_k = case\n\n        # Stage 1: Candidate AR screening\n        # Checks for high IVT, large aspect ratio, and sufficient length.\n        is_candidate = (I_k >= I_0) and (A_k >= A_0) and (L_k >= L_0)\n\n        # Stage 2: Tropical cyclone exclusion\n        # Checks for a compact, intense cyclonic core.\n        is_tc = (zeta_k >= ZETA_0) and (chi_k >= CHI_0)\n\n        # Stage 3: Stationary front exclusion\n        # Checks for a strong, slow-moving frontal feature.\n        is_sf = (F_k >= F_0) and (U_t_k = U_0)\n\n        # Final Decision: Keep if it's a candidate and not excluded.\n        keep_decision = is_candidate and not is_tc and not is_sf\n        \n        results.append(keep_decision)\n\n    # Format the output as a single-line string: [True,False,...]\n    # The boolean values are converted to strings \"True\" and \"False\".\n    output_string = f\"[{','.join(str(r) for r in results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "准确预测与大气河相关的强降水是数值天气预报的一个主要目标。这项高级练习要求你为次网格尺度的湿度开发一个随机参数化方案，这是控制云形成和降雨的关键因素。通过使用概率密度函数（$PDF$）方法，你将探索统计方法如何表达未解析的物理过程，并将次网格变率与云量和降水率等宏观结果直接联系起来。",
            "id": "4014387",
            "problem": "您的任务是为一个代表大气河（AR）的单一模式大气层，设计并实现一个针对次网格尺度湿度变率的随机参数化方案。该参数化方案必须假设次网格尺度的比湿 $q$ 服从一个连续的正概率密度函数（PDF），其参数由网格平均湿度和某个变率度量确定。您需要从第一性原理出发，以水物质守恒和饱和定义为基础，推导因次网格过饱和而产生的云量和平均降水来源的表达式。您的推导必须基于以下基础：(i) 在给定热力学条件下通过饱和比湿 $q_s$ 定义饱和，(ii) 通过 $q$ 的PDF计算统计期望和超出概率，以及 (iii) 连接期望过饱和与降水产生的简单自动转化比例关系。除了从这些基础推导出的公式外，您不能假设任何现成的诊断公式。\n\n假设该单层采用以下模型选择：\n- 假设次网格尺度比湿 $q$ 服从对数正态分布。其两个参数必须通过匹配给定的网格平均湿度 $\\bar{q}$ 和给定的次网格方差 $\\sigma_q^2$ 来确定。\n- 将次网格方差定义为 $\\sigma_q^2 = \\lambda \\bar{q}^2$，其中 $\\lambda$ 是一个非负的无量纲变率系数。\n- 将网格框中的云量 $C$ 定义为 $q$ 超过饱和阈值的概率，即 $C = \\mathbb{P}(q \\ge q_s)$。\n- 将网格平均过饱和盈余定义为 $\\mathbb{E}\\big[(q - q_s)^+\\big]$，其中 $(x)^+ = \\max(x,0)$。\n- 将降水产生率（一个源项）定义为 $R = \\varepsilon \\,\\rho\\,H\\,k\\,\\mathbb{E}\\big[(q - q_s)^+\\big]$，单位为千克/平方米/秒，其中 $\\rho$ 是空气密度（单位 $\\mathrm{kg\\,m^{-3}}$），$H$ 是层厚度（单位 $\\mathrm{m}$），$k$ 是自动转化率常数（单位 $\\mathrm{s^{-1}}$），而 $\\varepsilon$ 是一个无量纲效率因子。通过使用 $1\\,\\mathrm{kg\\,m^{-2}} = 1\\,\\mathrm{mm}$ 液态水的转换关系，并乘以每小时的秒数，将最终降水表示为累积率 $\\Pi$，单位为毫米/小时。\n\n您的任务：\n1. 基于上述基础，推導计算以下量所需的表达式：\n   - 从 $\\bar{q}$ 和 $\\sigma_q^2$ 计算对数正态分布的参数。\n   - 云量 $C$。\n   - 期望过饱和盈余 $\\mathbb{E}\\big[(q - q_s)^+\\big]$。\n   - 降水累积率 $\\Pi$，单位为 $\\mathrm{mm\\,hr^{-1}}$。\n2. 实现一个程序，为下方的每个测试用例计算并返回一个包含云量 $C$（无量纲）和降水累积率 $\\Pi$（单位 $\\mathrm{mm\\,hr^{-1}}$）的数对。所有数值输出必须表示为浮点数。对于降水，结果以 $\\mathrm{mm\\,hr^{-1}}$ 表示。将两个值都精确到 $6$ 位小数。\n3. 您的程序应生成单行输出，其中包含一个由方括号括起的、逗号分隔的数对列表，每个数对本身也是一个由方括号括起的、逗号分隔的列表。例如：$[[c_1,\\pi_1],[c_2,\\pi_2],\\ldots]$。不应打印任何其他文本。\n\n使用以下参数值测试套件（每行为一个测试用例）：\n- 案例A（理想路径，中等变率的近饱和大气河层）：$\\bar{q} = 0.017\\,\\mathrm{kg\\,kg^{-1}}$，$q_s = 0.018\\,\\mathrm{kg\\,kg^{-1}}$，$\\lambda = 0.1$，$\\rho = 1.2\\,\\mathrm{kg\\,m^{-3}}$，$H = 1500\\,\\mathrm{m}$，$k = 1/900\\,\\mathrm{s^{-1}}$，$\\varepsilon = 0.7$。\n- 案例B（边界情况，几乎确定的过饱和）：$\\bar{q} = 0.0185\\,\\mathrm{kg\\,kg^{-1}}$，$q_s = 0.018\\,\\mathrm{kg\\,kg^{-1}}$，$\\lambda = 10^{-6}$，$\\rho = 1.15\\,\\mathrm{kg\\,m^{-3}}$，$H = 1000\\,\\mathrm{m}$，$k = 1/1200\\,\\mathrm{s^{-1}}$，$\\varepsilon = 0.8$。\n- 案例C（边缘情况，均值未饱和但变率高）：$\\bar{q} = 0.014\\,\\mathrm{kg\\,kg^{-1}}$，$q_s = 0.018\\,\\mathrm{kg\\,kg^{-1}}$，$\\lambda = 0.5$，$\\rho = 1.1\\,\\mathrm{kg\\,m^{-3}}$，$H = 2000\\,\\mathrm{m}$，$k = 1/600\\,\\mathrm{s^{-1}}$，$\\varepsilon = 0.6$。\n- 案例D（湿润的大气河核心，强转化）：$\\bar{q} = 0.022\\,\\mathrm{kg\\,kg^{-1}}$，$q_s = 0.019\\,\\mathrm{kg\\,kg^{-1}}$，$\\lambda = 0.2$，$\\rho = 1.3\\,\\mathrm{kg\\,m^{-3}}$，$H = 1000\\,\\mathrm{m}$，$k = 1/300\\,\\mathrm{s^{-1}}$，$\\varepsilon = 0.9$。\n- 案例E（干燥层，深厚但转化弱）：$\\bar{q} = 0.010\\,\\mathrm{kg\\,kg^{-1}}$，$q_s = 0.018\\,\\mathrm{kg\\,kg^{-1}}$，$\\lambda = 0.3$，$\\rho = 1.0\\,\\mathrm{kg\\,m^{-3}}$，$H = 3000\\,\\mathrm{m}$，$k = 1/1800\\,\\mathrm{s^{-1}}$，$\\varepsilon = 0.5$。\n\n本问题不涉及角度单位。所有物理单位均已在上方指定，必须按规定遵守。要求的最终输出格式为单行：$[[C_A,\\Pi_A],[C_B,\\Pi_B],[C_C,\\Pi_C],[C_D,\\Pi_D],[C_E,\\Pi_E]]$，其中每个数字按要求精确到 $6$ 位小数。",
            "solution": "问题陈述具有科学依据、提法明确且内部一致。它概述了大气建模中使用概率密度函数（PDF）方法参数化次网格尺度云和降水过程的标准程序。其假设、定义和物理参数都陈述清晰且物理上合理。因此，可以按要求从第一性原理推导出解决方案。\n\n总体任务是，在给定网格平均量和次网格湿度的统计模型的情况下，计算单个大气层的云量 $C$ 和降水率 $\\Pi$。假设比湿 $q$ 服从对数正态分布 $q \\sim \\text{Lognormal}(\\mu, \\sigma^2)$，其中 $\\mu$ 和 $\\sigma^2$ 是其基础正态变量 $\\ln(q)$ 的均值和方差。\n\n**1. 对数正态PDF参数的推导**\n\n基础正态分布的参数 $\\mu$ 和 $\\sigma^2$ 必须根据给定的网格平均比湿 $\\bar{q}$ 及其方差 $\\sigma_q^2$ 来确定。对数正态分布的均值和方差由以下公式给出：\n$$ \\bar{q} = \\mathbb{E}[q] = \\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right) $$\n$$ \\sigma_q^2 = \\text{Var}[q] = \\left[\\exp(\\sigma^2) - 1\\right]\\exp\\left(2\\mu + \\sigma^2\\right) = \\left[\\exp(\\sigma^2) - 1\\right]\\bar{q}^2 $$\n问题为方差提供了一个本构关系：$\\sigma_q^2 = \\lambda \\bar{q}^2$。通过令两个方差表达式相等，我们可以解出 $\\sigma^2$：\n$$ \\lambda \\bar{q}^2 = \\left[\\exp(\\sigma^2) - 1\\right]\\bar{q}^2 $$\n$$ \\lambda = \\exp(\\sigma^2) - 1 \\implies \\sigma^2 = \\ln(\\lambda + 1) $$\n这就得到了基础正态分布的方差 $\\sigma^2$。现在我们可以使用均值 $\\bar{q}$ 的表达式来求解 $\\mu$：\n$$ \\bar{q} = \\exp(\\mu) \\exp\\left(\\frac{\\sigma^2}{2}\\right) $$\n$$ \\exp(\\mu) = \\frac{\\bar{q}}{\\exp(\\sigma^2/2)} = \\frac{\\bar{q}}{\\exp(\\ln(\\lambda+1)/2)} = \\frac{\\bar{q}}{\\sqrt{\\lambda+1}} $$\n$$ \\mu = \\ln\\left(\\frac{\\bar{q}}{\\sqrt{\\lambda+1}}\\right) = \\ln(\\bar{q}) - \\frac{1}{2}\\ln(\\lambda+1) = \\ln(\\bar{q}) - \\frac{\\sigma^2}{2} $$\n因此，参数 $\\mu$ 和 $\\sigma = \\sqrt{\\sigma^2}$ 完全由给定的 $\\bar{q}$ 和 $\\lambda$ 确定。\n\n**2. 云量 $C$ 的推导**\n\n云量 $C$ 被定义为饱和的概率，即 $C = \\mathbb{P}(q \\ge q_s)$，其中 $q_s$ 是饱和比湿。由于 $q$ 服从对数正态分布，其对数 $Y = \\ln(q)$ 服从均值为 $\\mu$、方差为 $\\sigma^2$ 的正态分布，即 $Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$。条件 $q \\ge q_s$ 等价于 $\\ln(q) \\ge \\ln(q_s)$。\n$$ C = \\mathbb{P}(Y \\ge \\ln(q_s)) $$\n为了计算这个概率，我们对变量 $Y$进行标准化。令 $Z = (Y - \\mu)/\\sigma$ 为标准正态变量，$Z \\sim \\mathcal{N}(0, 1)$。不等式变为：\n$$ Y - \\mu \\ge \\ln(q_s) - \\mu \\implies \\frac{Y - \\mu}{\\sigma} \\ge \\frac{\\ln(q_s) - \\mu}{\\sigma} $$\n因此，$C = \\mathbb{P}\\left(Z \\ge \\frac{\\ln(q_s) - \\mu}{\\sigma}\\right)$。令 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF）。那么 $\\mathbb{P}(Z \\ge z) = 1 - \\Phi(z) = \\Phi(-z)$。\n$$ C = \\Phi\\left(-\\frac{\\ln(q_s) - \\mu}{\\sigma}\\right) = \\Phi\\left(\\frac{\\mu - \\ln(q_s)}{\\sigma}\\right) $$\n为了计算方便，我们定义一个参数 $d_2$：\n$$ d_2 = \\frac{\\mu - \\ln(q_s)}{\\sigma} = \\frac{\\ln(\\bar{q}) - \\sigma^2/2 - \\ln(q_s)}{\\sigma} = \\frac{\\ln(\\bar{q}/q_s) - \\sigma^2/2}{\\sigma} $$\n那么，云量就是 $C = \\Phi(d_2)$。\n\n**3. 期望过饱和盈余的推导**\n\n网格平均过饱和盈余定义为 $S = \\mathbb{E}\\big[(q - q_s)^+\\big]$。这可以通过对 $q$ 的PDF（记为 $f(q)$）进行积分来计算：\n$$ S = \\int_0^{\\infty} \\max(q-q_s, 0) f(q) \\,dq = \\int_{q_s}^{\\infty} (q - q_s) f(q) \\,dq $$\n我们可以将积分分成两部分：\n$$ S = \\int_{q_s}^{\\infty} q f(q) \\,dq - q_s \\int_{q_s}^{\\infty} f(q) \\,dq $$\n第二项很简单：$\\int_{q_s}^{\\infty} f(q) \\,dq = \\mathbb{P}(q \\ge q_s) = C$。所以第二项是 $q_s C$。\n第一项是 $q$ 在分布饱和部分的偏期望。我们来计算它。我们将积分变量改为 $y = \\ln(q)$，因此 $q=e^y$，PDF变为正态变量 $Y$ 的PDF，$f_Y(y) = \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right)$。\n$$ \\int_{q_s}^{\\infty} q f(q) \\,dq = \\int_{\\ln(q_s)}^{\\infty} e^y f_Y(y) \\,dy = \\int_{\\ln(q_s)}^{\\infty} e^y \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right) \\,dy $$\n通过对指数部分进行配方（如在对数正态均值推导中所述），该积分简化为：\n$$ \\exp\\left(\\mu + \\frac{\\sigma^2}{2}\\right) \\mathbb{P}(Y' \\ge \\ln(q_s)) = \\bar{q} \\cdot \\mathbb{P}(Y' \\ge \\ln(q_s)) $$\n其中 $Y'$ 是一个均值平移了的正态变量，$Y' \\sim \\mathcal{N}(\\mu+\\sigma^2, \\sigma^2)$。对 $Y'$进行标准化得到：\n$$ \\mathbb{P}\\left(Z \\ge \\frac{\\ln(q_s) - (\\mu+\\sigma^2)}{\\sigma}\\right) = \\Phi\\left(-\\frac{\\ln(q_s) - (\\mu+\\sigma^2)}{\\sigma}\\right) = \\Phi\\left(\\frac{\\mu + \\sigma^2 - \\ln(q_s)}{\\sigma}\\right) $$\n我们定义第二个参数 $d_1$：\n$$ d_1 = \\frac{\\mu + \\sigma^2 - \\ln(q_s)}{\\sigma} = \\frac{\\ln(\\bar{q}/q_s) + \\sigma^2/2}{\\sigma} $$\n注意 $d_1 = d_2 + \\sigma$。因此，偏期望为 $\\bar{q} \\Phi(d_1)$。\n合并各项，过饱和盈余为：\n$$ S = \\bar{q} \\Phi(d_1) - q_s \\Phi(d_2) = \\bar{q} \\Phi(d_1) - q_s C $$\n\n**4. 降水累积率 $\\Pi$ 的推导**\n\n降水产生率 $R$ 以 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$ 为单位给出：\n$$ R = \\varepsilon \\rho H k S $$\n其中 $\\varepsilon$ 是无量纲效率因子，$\\rho$ 是空气密度（$\\mathrm{kg\\,m^{-3}}$），$H$ 是层厚度（$\\mathrm{m}$），$k$ 是自动转化率常数（$\\mathrm{s^{-1}}$），而 $S = \\mathbb{E}\\big[(q - q_s)^+\\big]$ 是无量纲盈余（单位 $\\mathrm{kg\\,kg^{-1}}$）。单位是一致的：$(\\mathrm{kg\\,m^{-3}}) \\cdot (\\mathrm{m}) \\cdot (\\mathrm{s^{-1}}) \\cdot (\\mathrm{kg\\,kg^{-1}}) = \\mathrm{kg\\,m^{-2}\\,s^{-1}}$。\n\n为了将其转换为以毫米/小时（$\\mathrm{mm\\,hr^{-1}}$）为单位的累积率 $\\Pi$，我们使用提供的转换关系。首先，$1\\,\\mathrm{kg\\,m^{-2}}$ 的水等效于 $1\\,\\mathrm{mm}$ 的液态水深度。因此，一个以 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$ 为单位的率 $R$ 在数值上等于一个以 $\\mathrm{mm\\,s^{-1}}$ 为单位的率 $R$。其次，为了从每秒转换为每小时，我们乘以一小时的秒数（$3600\\,\\mathrm{s\\,hr^{-1}}$）。\n$$ \\Pi \\,[\\mathrm{mm\\,hr^{-1}}] = R \\,[\\mathrm{kg\\,m^{-2}\\,s^{-1}}] \\times 3600 \\,[\\mathrm{s\\,hr^{-1}}] $$\n代入 $R$ 的表达式：\n$$ \\Pi = 3600 \\cdot \\varepsilon \\rho H k S = 3600 \\cdot \\varepsilon \\rho H k \\left( \\bar{q} \\Phi(d_1) - q_s \\Phi(d_2) \\right) $$\n\n**计算方案摘要：**\n\n对于每组输入参数（$\\bar{q}, q_s, \\lambda, \\rho, H, k, \\varepsilon$）：\n1. 计算基础正态分布的参数：$\\sigma^2 = \\ln(\\lambda + 1)$ 和 $\\sigma = \\sqrt{\\sigma^2}$。\n2. 计算CDF的参数：$d_1 = (\\ln(\\bar{q}/q_s) + \\sigma^2/2)/\\sigma$ 和 $d_2 = (\\ln(\\bar{q}/q_s) - \\sigma^2/2)/\\sigma$。\n3. 计算云量：$C = \\Phi(d_2)$。\n4. 计算降水率：$\\Pi = 3600 \\cdot \\varepsilon \\rho H k \\left( \\bar{q} \\Phi(d_1) - q_s \\Phi(d_2) \\right)$。\n5. 将 $C$ 和 $\\Pi$ 四舍五入到 $6$ 位小数。\n\n至此推導完成。实现将遵循这些步骤。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Derives and implements a stochastic parameterization for subgrid-scale\n    humidity, cloud fraction, and precipitation in an atmospheric model layer.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (q_bar, q_s, lam, rho, H, k, eps)\n    test_cases = [\n        # Case A\n        (0.017, 0.018, 0.1, 1.2, 1500, 1.0/900.0, 0.7),\n        # Case B\n        (0.0185, 0.018, 1e-6, 1.15, 1000, 1.0/1200.0, 0.8),\n        # Case C\n        (0.014, 0.018, 0.5, 1.1, 2000, 1.0/600.0, 0.6),\n        # Case D\n        (0.022, 0.019, 0.2, 1.3, 1000, 1.0/300.0, 0.9),\n        # Case E\n        (0.010, 0.018, 0.3, 1.0, 3000, 1.0/1800.0, 0.5),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current test case.\n        q_bar, q_s, lam, rho, H, k, eps = case\n\n        # Step 1: Calculate parameters of the underlying normal distribution for ln(q).\n        # sigma2 is the variance, sigma is the standard deviation.\n        sigma2 = np.log(lam + 1.0)\n        sigma = np.sqrt(sigma2)\n\n        # Step 2: Calculate the arguments for the standard normal CDF.\n        # log_q_ratio corresponds to ln(q_bar / q_s).\n        # q_s is always positive in the test cases, so no special handling needed.\n        # handle case where sigma is very close to zero to avoid division by zero\n        if sigma  1e-9: # Practically zero variability\n            d1 = np.inf if q_bar > q_s else -np.inf\n            d2 = np.inf if q_bar > q_s else -np.inf\n        else:\n            log_q_ratio = np.log(q_bar / q_s)\n            d1 = (log_q_ratio + sigma2 / 2.0) / sigma\n            d2 = (log_q_ratio - sigma2 / 2.0) / sigma\n        \n        # Use scipy.stats.norm.cdf for the standard normal CDF Phi.\n        phi_d1 = norm.cdf(d1)\n        phi_d2 = norm.cdf(d2)\n\n        # Step 3: Calculate the cloud fraction C.\n        # C = Phi(d2)\n        C = phi_d2\n\n        # Step 4: Calculate the expected supersaturation surplus S.\n        # S = q_bar * Phi(d1) - q_s * Phi(d2)\n        S = q_bar * phi_d1 - q_s * phi_d2\n\n        # Step 5: Calculate the precipitation accumulation rate Pi in mm/hr.\n        # Pi = 3600 * eps * rho * H * k * S\n        Pi = 3600.0 * eps * rho * H * k * S\n        \n        # Append the formatted result string for the current case.\n        # Values are rounded to exactly 6 decimal places.\n        results.append(f\"[{C:.6f},{Pi:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}