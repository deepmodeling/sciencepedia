{
    "hands_on_practices": [
        {
            "introduction": "本练习聚焦于布鲁尔-多布森环流（Brewer-Dobson circulation, BDC）“热带外水泵”机制的核心：波-流相互作用。通过计算一个重力波包的动量通量及其产生的平均流加速度，你将对源于对流层的波动如何驱动大规模平流层环流获得具体的理解。这项练习将波强迫的抽象理论与可量化的结果联系起来 ()。",
            "id": "4095869",
            "problem": "考虑一个在西风急流的赤道至亚热带一侧，通过稳定层结大气向上-传播的小振幅二维内重力波包。使用Boussinesq近似和线性动力学对流动进行建模，忽略行星旋转的影响。设纬向和垂直速度扰动分别用 $u'(x,z,t)$ 和 $w'(x,z,t)$ 表示，并假设为单色平面波结构 $w'(x,z,t) = \\Re\\{\\hat{w}\\exp[i(k x + m z - \\omega t)]\\}$，其中波数 $k$ 和 $m$ 以及频率 $\\omega$ 均为实数。雷诺平均算子 $\\overline{(\\cdot)}$ 是对多个波周期的-时间平均或相位平均。与波相关的水平（纬向）动量的垂直通量为 $\\rho\\,\\overline{u'w'}$，其中 $\\rho$ 是环境密度。在转换欧拉平均（TEM）框架下，由波与平均流相互作用引起的纬向平均纬向风趋势为 $-(1/\\rho)\\,\\partial\\big(\\rho\\,\\overline{u'w'}\\big)/\\partial z$。\n\n从线性化的Boussinesq方程组和质量连续性方程出发，推导用复振幅 $\\hat{w}$ 以及波数 $k$ 和 $m$ 表示的 $\\overline{u'w'}$ 的表达式，然后使用以下科学上合理的参数，计算急流核心层下边界处的垂直通量 $\\rho\\,\\overline{u'w'}$：\n- 水平波数 $k = 1.0 \\times 10^{-5}\\ \\mathrm{m}^{-1}$，\n- 垂直波数 $m = -1.0 \\times 10^{-3}\\ \\mathrm{m}^{-1}$，\n- 垂直速度振幅 $|\\hat{w}| = 5.0 \\times 10^{-2}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$，\n- 层下边界密度 $\\rho_{\\mathrm{b}} = 1.8 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n\n假设波在急流核心层内遇到一个临界层并被完全吸收，因此该层上边界的垂直通量为零，且该层的厚度为 $\\Delta z = 5.0 \\times 10^{3}\\ \\mathrm{m}$。使用TEM平均流强迫，通过将垂直导数近似为有限差分，并使用层平均密度 $\\rho_{\\mathrm{avg}} = 1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$，计算整个层内的相应纬向平均纬向加速度。将垂直动量通量和纬向平均加速度均四舍五入至三位有效数字。通量以帕斯卡（Pascals）为单位，加速度以 $\\mathrm{m}\\,\\mathrm{s}^{-2}$ 为单位表示。你的最终答案必须是一个计算结果，并报告所要求的两个量。",
            "solution": "该问题陈述经评估有效。它在科学上基于大气流体动力学原理，特别是内重力波理论及其与平均流的相互作用。该问题是适定的，提供了所有必需的参数和明确的目标。语言客观，参数具有物理合理性。任务是基于基本方程推导和计算物理量，这是一个标准且可验证的过程。\n\n我们首先推导水平动量垂直通量的表达式，该通量通常被称为雷诺应力分量 $\\overline{u'w'}$。问题要求使用线性化的Boussinesq方程组，并忽略旋转。关联速度分量 $u'$ 和 $w'$ 的最直接方法是通过不可压缩流体的质量连续性方程（Boussinesq近似的一个核心组成部分）：\n$$\n\\frac{\\partial u'}{\\partial x} + \\frac{\\partial w'}{\\partial z} = 0\n$$\n速度扰动以单色平面波的形式给出。我们可以将 $u'$ 和 $w'$ 都写成复数形式，并理解物理量是其实部：\n$$\nu'(x,z,t) = \\Re\\{\\hat{u}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n$$\nw'(x,z,t) = \\Re\\{\\hat{w}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n这里，$\\hat{u}$ 和 $\\hat{w}$ 分别是纬向和垂直速度的复振幅。将这些形式代入连续性方程需要求导：\n$$\n\\frac{\\partial u'}{\\partial x} = \\Re\\{i k \\hat{u}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n$$\n\\frac{\\partial w'}{\\partial z} = \\Re\\{i m \\hat{w}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n将它们相加得到：\n$$\n\\Re\\{i(k\\hat{u} + m\\hat{w})\\exp[i(k x + m z - \\omega t)]\\} = 0\n$$\n为使此方程对所有 $x$、$z$ 和 $t$ 成立，乘以指数项的复数项必须为零。这给出了复振幅之间的关系：\n$$\nk\\hat{u} + m\\hat{w} = 0 \\implies \\hat{u} = -\\frac{m}{k}\\hat{w}\n$$\n接下来，我们计算时间平均乘积 $\\overline{u'w'}$。对于两个一般的振荡量 $A(t) = \\Re\\{\\hat{A}\\exp(-i\\omega t)\\}$ 和 $B(t) = \\Re\\{\\hat{B}\\exp(-i\\omega t)\\}$，其在一个或多个周期上的时间平均由 $\\overline{A B} = \\frac{1}{2}\\Re\\{\\hat{A}\\hat{B}^*\\}$ 给出，其中 $\\hat{B}^*$ 是 $\\hat{B}$ 的复共轭。在我们的例子中，包含空间依赖性的完整复振幅是 $\\hat{u}\\exp[i(kx+mz)]$ 和 $\\hat{w}\\exp[i(kx+mz)]$。时间平均与空间坐标无关，因此我们有：\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\{ \\left( \\hat{u}\\exp[i(kx+mz)] \\right) \\left( \\hat{w}\\exp[i(kx+mz)] \\right)^* \\}\n$$\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\{ \\hat{u}\\exp[i(kx+mz)] \\hat{w}^*\\exp[-i(kx+mz)] \\} = \\frac{1}{2}\\Re\\{\\hat{u}\\hat{w}^*\\}\n$$\n现在，我们代入从连续性方程推导出的 $\\hat{u}$ 的关系式：\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\left\\{\\left(-\\frac{m}{k}\\hat{w}\\right)\\hat{w}^*\\right\\} = \\frac{1}{2}\\Re\\left\\{-\\frac{m}{k}(\\hat{w}\\hat{w}^*)\\right\\}\n$$\n由于 $\\hat{w}\\hat{w}^* = |\\hat{w}|^2$，并且波数 $k$ 和 $m$ 是实数，因此实部算子内的表达式完全是实数。因此，我们得到了第一个所需的表达式：\n$$\n\\overline{u'w'} = -\\frac{m}{2k}|\\hat{w}|^2\n$$\n水平动量的垂直通量为 $F_m = \\rho\\,\\overline{u'w'}$。题目要求我们计算急流核心层下边界处的该值，我们用下标 $b$ 表示。\n$$\nF_{m,b} = \\rho_b \\left( -\\frac{m}{2k}|\\hat{w}|^2 \\right)\n$$\n我们代入给定的数值：\n- 水平波数 $k = 1.0 \\times 10^{-5}\\ \\mathrm{m}^{-1}$\n- 垂直波数 $m = -1.0 \\times 10^{-3}\\ \\mathrm{m}^{-1}$\n- 垂直速度振幅 $|\\hat{w}| = 5.0 \\times 10^{-2}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 下边界密度 $\\rho_b = 1.8 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n\n首先，我们计算括号中的项：\n$$\n-\\frac{m}{2k}|\\hat{w}|^2 = -\\frac{-1.0 \\times 10^{-3}\\ \\mathrm{m}^{-1}}{2(1.0 \\times 10^{-5}\\ \\mathrm{m}^{-1})} (5.0 \\times 10^{-2}\\ \\mathrm{m}\\,\\mathrm{s}^{-1})^2\n$$\n$$\n= \\frac{1.0 \\times 10^{-3}}{2.0 \\times 10^{-5}} (2.5 \\times 10^{-3}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}) = (50) \\times (2.5 \\times 10^{-3}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}) = 1.25 \\times 10^{-1}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}\n$$\n现在，我们计算通量：\n$$\nF_{m,b} = (1.8 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}) \\times (1.25 \\times 10^{-1}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}) = 2.25 \\times 10^{-2}\\ \\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}\n$$\n单位 $\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}$ 等效于帕斯卡（$\\mathrm{Pa}$），符合要求。四舍五入到三位有效数字，通量为 $2.25 \\times 10^{-2}\\ \\mathrm{Pa}$。\n\n最后，我们计算整个层内的纬向平均纬向加速度。该强迫由转换欧拉平均（TEM）表达式给出：\n$$\na = -\\frac{1}{\\rho}\\frac{\\partial(\\rho\\,\\overline{u'w'})}{\\partial z}\n$$\n我们使用厚度为 $\\Delta z$ 的层上的有限差分来近似该值，并使用层平均密度 $\\rho_{\\mathrm{avg}}$：\n$$\na \\approx -\\frac{1}{\\rho_{\\mathrm{avg}}} \\frac{\\Delta(\\rho\\,\\overline{u'w'})}{\\Delta z} = -\\frac{1}{\\rho_{\\mathrm{avg}}} \\frac{(\\rho\\,\\overline{u'w'})_{\\text{top}} - (\\rho\\,\\overline{u'w'})_{\\text{bottom}}}{\\Delta z}\n$$\n问题陈述波在该层内被完全吸收，这意味着该层顶部的动量通量为零：$(\\rho\\,\\overline{u'w'})_{\\text{top}} = 0$。底部的通量是我们刚刚计算出的值 $F_{m,b}$。\n给定的参数是：\n- $(\\rho\\,\\overline{u'w'})_{\\text{bottom}} = 2.25 \\times 10^{-2}\\ \\mathrm{Pa}$\n- $\\rho_{\\mathrm{avg}} = 1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $\\Delta z = 5.0 \\times 10^{3}\\ \\mathrm{m}$\n\n将这些值代入加速度的近似公式中：\n$$\na \\approx -\\frac{1}{1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}} \\frac{0 - (2.25 \\times 10^{-2}\\ \\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2})}{5.0 \\times 10^{3}\\ \\mathrm{m}}\n$$\n$$\na \\approx \\frac{2.25 \\times 10^{-2}\\ \\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}}{(1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}) \\times (5.0 \\times 10^{3}\\ \\mathrm{m})}\n$$\n$$\na \\approx \\frac{2.25 \\times 10^{-2}}{7.5 \\times 10^{2}} \\frac{\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}}{\\mathrm{kg}\\,\\mathrm{m}^{-2}} = 0.3 \\times 10^{-4}\\ \\mathrm{m}\\,\\mathrm{s}^{-2} = 3.0 \\times 10^{-5}\\ \\mathrm{m}\\,\\mathrm{s}^{-2}\n$$\n四舍五入到三位有效数字，加速度为 $3.00 \\times 10^{-5}\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.25 \\times 10^{-2}  3.00 \\times 10^{-5} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "平流层-对流层交换（Stratosphere-troposphere exchange, STE）严重依赖于对流层顶的位置，但其定义并非唯一。本练习要求你实现并比较不同的对流层顶定义（基于位涡和基于温度递减率），并观察它们如何影响计算出的示踪剂通量 ()。这项练习突出了从模式或观测数据中诊断大气输送的实际困难和敏感性。",
            "id": "4095866",
            "problem": "考虑一个由 $N_x$ 个独立气柱组成的高度理想化的纬向带，每个气柱都在 $N_z$ 个固定的几何高度层上进行离散化。其目的是诊断一个类似臭氧的被动示踪剂，穿过根据不同定义和阈值诊断出的对流层顶的瞬时向下平流层-对流层交换 (STE) 通量，并量化其对位涡 (PV) 阈值和温度直减率判据的敏感性。诊断必须从基本原理和核心定义开始，所有计算都必须用国际单位制 (SI) 表示。最终程序必须为一组固定的测试套件生成结果。\n\n该问题的基本基础如下。\n\n- 示踪剂穿过一个物质表面的瞬时垂直质量通量，根据连续性方程和输运方程，定义为空气密度、垂直速度和示踪剂质量混合比三者乘积的面积分。对于一个由几何高度 $z = z_{\\mathrm{tp}}(x)$ 处的水平面近似并在离散层上诊断的界面，区域积分的向下示踪剂通量可近似为\n$$\n\\mathcal{F}_{\\downarrow} \\approx \\sum_{i=1}^{N_x} \\rho_i(z_{\\mathrm{tp}, i}) \\, \\max\\left(-w_i(z_{\\mathrm{tp}, i}), 0\\right) \\, \\chi_i(z_{\\mathrm{tp}, i}) \\, \\Delta A_i,\n$$\n其中 $\\rho$ 是空气密度，单位为 $\\mathrm{kg\\, m^{-3}}$，$w$ 是垂直速度，单位为 $\\mathrm{m\\, s^{-1}}$（向上为正），$\\chi$ 是示踪剂质量混合比，单位为 $\\mathrm{kg\\, kg^{-1}}$，$\\Delta A_i$ 是气柱面积，单位为 $\\mathrm{m^2}$。量 $\\mathcal{F}_{\\downarrow}$ 的单位为 $\\mathrm{kg\\, s^{-1}}$。\n\n- 几何对流层顶通过三种方式诊断，每种方式都会得到一个指数 $k_{\\mathrm{tp}, i}$，对应于高度为 $z_{k_{\\mathrm{tp}, i}}$ 的一个离散模式层。\n\n  1. 基于 PV 的定义：给定一个以位涡单位 (PVU) 表示的 PV 阈值 $q_t$，其中 $1\\,\\mathrm{PVU} = 10^{-6}\\,\\mathrm{K\\, m^2\\, kg^{-1}\\, s^{-1}}$，找到随高度增加的第一个层指数 $k$，使得 $q_i(k) \\ge q_t$ 并且 $k = 0$ 或 $q_i(k-1)  q_t$。如果不存在这样的穿越点，则将 $k_{\\mathrm{tp}, i}$ 赋为最高层的指数。\n\n  2. 温度直减率定义：将相邻层之间的离散直减率定义为\n  $$\n  \\Gamma_i(k) = -\\frac{T_i(k+1) - T_i(k)}{z_{k+1} - z_k} \\times 10^{3},\n  $$\n  单位为 $\\mathrm{K\\, km^{-1}}$，其中 $k \\in \\{0,\\dots,N_z-2\\}$。给定一个以 $\\mathrm{K\\, km^{-1}}$ 为单位的阈值 $\\gamma_t$，找到第一个满足 $\\Gamma_i(k) \\le \\gamma_t$ 的 $k$，并设置 $k_{\\mathrm{tp}, i} = k + 1$。如果不存在这样的指数，则将 $k_{\\mathrm{tp}, i}$ 赋为最高层的指数。\n\n  3. 混合定义：当可用时，计算基于 PV 和基于温度的两种指数，并选择高度更高（即 $z_{k_{\\mathrm{tp}, i}}$ 更大）的那个。如果只有一个可用，则使用它；如果两个都未找到，则赋为最高层的指数。\n\n合成区域和场定义如下。\n\n- 气柱数为 $N_x = 4$。垂直层数为 $N_z = 10$。各层高度为\n$$\nz_k = 6000 + 1000\\,k \\quad \\text{for } k \\in \\{0,1,\\dots,9\\},\n$$\n单位为米。\n\n- 每个气柱 $i \\in \\{0,1,2,3\\}$ 都有一个依赖于气柱的对流层顶高度\n$$\nz_{\\mathrm{tp}, i}^{\\star} = 10000 + 500\\,(i - 1.5),\n$$\n单位为米。\n\n- 温度 $T_i(k)$（单位：开尔文）由 $z_{\\mathrm{tp}, i}^{\\star}$ 以下的对流层直减率和以上的弱平流层直减率构成：\n  - 在 $z_0 = 6000\\,\\mathrm{m}$ 处定义基础温度为 $T_{0,i} = 245 - 2\\,i$ (单位：开尔文)。\n  - 对于 $z_k \\le z_{\\mathrm{tp}, i}^{\\star}$，\n  $$\n  T_i(k) = T_{0,i} - 6.5 \\times \\frac{z_k - 6000}{1000}.\n  $$\n  - 对于 $z_k > z_{\\mathrm{tp}, i}^{\\star}$，设\n  $$\n  T_i(k) = T_{0,i} - 6.5 \\times \\frac{z_{\\mathrm{tp}, i}^{\\star} - 6000}{1000} - 1.0 \\times \\frac{z_k - z_{\\mathrm{tp}, i}^{\\star}}{1000}.\n  $$\n\n- 位涡 $q_i(k)$ (单位：PVU) 定义为\n$$\nq_i(k) = \\left(0.5 + 0.15\\,k + 0.1\\,i\\right) + \\Delta q_i(k), \\quad \\Delta q_i(k) = \\begin{cases}\n0,  z_k  z_{\\mathrm{tp}, i}^{\\star},\\\\\n2.0,  z_k \\ge z_{\\mathrm{tp}, i}^{\\star}.\n\\end{cases}\n$$\n\n- 垂直速度 $w_i(k)$ (单位：$\\mathrm{m\\, s^{-1}}$) 由以下公式指定\n$$\nw_i(k) = 0.02 \\,\\sin\\!\\left(\\frac{\\pi}{4} \\left(\\frac{z_k}{1000} - 6 + 0.5\\,i\\right)\\right) - 0.005.\n$$\n\n- 示踪剂质量混合比 $\\chi_i(k)$ (单位：$\\mathrm{kg\\, kg^{-1}}$) 随高度增加，并在对流层顶有一个小的阶跃：\n  - 对于 $z_k \\le z_{\\mathrm{tp}, i}^{\\star}$，\n  $$\n  \\chi_i(k) = 4\\times 10^{-6} + 0.5\\times 10^{-6} \\times \\frac{z_k - 6000}{1000}.\n  $$\n  - 对于 $z_k > z_{\\mathrm{tp}, i}^{\\star}$，\n  $$\n  \\chi_i(k) = \\left[4\\times 10^{-6} + 0.5\\times 10^{-6} \\times \\frac{z_{\\mathrm{tp}, i}^{\\star} - 6000}{1000}\\right] + 3\\times 10^{-6} + 0.3\\times 10^{-6} \\times \\frac{z_k - z_{\\mathrm{tp}, i}^{\\star}}{1000}.\n  $$\n\n- 空气密度 $\\rho_i(k)$ (单位：$\\mathrm{kg\\, m^{-3}}$) 随高度呈指数变化，并带有一个依赖于气柱的指数前因子：\n  - 在 $z = 6000\\,\\mathrm{m}$ 处定义 $\\rho_{6,i} = 0.66 \\times \\left(1 + 0.03\\,(i - 1.5)\\right)$。\n  - 设标高为 $H = 7000\\,\\mathrm{m}$，对于任意 $z_k$，\n  $$\n  \\rho_i(k) = \\rho_{6,i}\\,\\exp\\!\\left(-\\frac{z_k - 6000}{H}\\right).\n  $$\n\n- 每个气柱代表相等的面积 $\\Delta A_i = \\Delta A = 10^{10}\\,\\mathrm{m^2}$。\n\n使用这些定义，实现一个算法：对于给定的诊断类型和阈值，确定每个气柱中的对流层顶层 $k_{\\mathrm{tp}, i}$，计算 $\\rho_i(k_{\\mathrm{tp}, i})$、$w_i(k_{\\mathrm{tp}, i})$ 和 $\\chi_i(k_{\\mathrm{tp}, i})$ 的值，并按规定计算总的向下示踪剂通量 $\\mathcal{F}_{\\downarrow}$ (单位：$\\mathrm{kg\\, s^{-1}}$)。如果不满足上述定义的 PV 穿越或温度判据，则对该方法使用最高层作为对流层顶；对于混合方法，从可用方法中选择海拔最高的那个，如果两种方法都未得到对流层顶的层，则退而求其次使用最高层。\n\n测试套件和输出要求：\n\n- 您的程序的输入由以下 $8$ 个测试用例固定，每个用例都是一个三元组 $(\\text{def}, q_t, \\gamma_t)$：\n  - 用例 1: 基于PV，$(\\text{\"PV\"}, 2.0, 2.0)$，\n  - 用例 2: 基于PV，$(\\text{\"PV\"}, 3.5, 2.0)$，\n  - 用例 3: 基于温度，$(\\text{\"TH\"}, 2.0, 2.0)$，\n  - 用例 4: 基于温度，$(\\text{\"TH\"}, 2.0, 1.5)$，\n  - 用例 5: 混合，$(\\text{\"HYB\"}, 2.0, 2.0)$，\n  - 用例 6: 混合，$(\\text{\"HYB\"}, 3.5, 1.5)$，\n  - 用例 7: 基于PV的高阈值边界情况，$(\\text{\"PV\"}, 6.0, 2.0)$，\n  - 用例 8: 基于温度的严格判据边界情况，$(\\text{\"TH\"}, 2.0, 0.5)$。\n\n- 对于每个用例，计算 $\\mathcal{F}_{\\downarrow}$ (单位：$\\mathrm{kg\\, s^{-1}}$)，四舍五入到 $6$ 位小数。\n\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，顺序与测试套件相同（例如，$[\\text{result}_1,\\text{result}_2,\\dots,\\text{result}_8]$）。不允许有其他输出。\n\n本问题不使用角度，也没有百分比。所有输出必须按规定以 $\\mathrm{kg\\, s^{-1}}$ 为单位报告，并四舍五入到六位小数。",
            "solution": "问题要求计算被动示踪剂穿过一个经诊断确定的对流层顶的瞬时向下平流层-对流层交换 (STE) 通量。该计算在一个合成的、理想化的二维区域上进行。解决方案包括三个主要阶段：首先，构建离散的大气状态变量；其次，根据三种不同的定义诊断对流层顶的高度；第三，通过对每个大气气柱的贡献求和来计算总的向下通量。\n\n首先，我们建立计算域和离散化方案。该区域由 $N_x = 4$ 个独立的垂直气柱组成，由 $i \\in \\{0, 1, 2, 3\\}$ 索引。每个气柱被离散化为 $N_z = 10$ 个垂直层，由 $k \\in \\{0, 1, \\dots, 9\\}$ 索引。每个层 $z_k$ 的几何高度由公式 $z_k = 6000 + 1000k$ 给出，其中 $z_k$ 单位为米。与每个气柱相关的面积是常数 $\\Delta A = 10^{10}\\,\\mathrm{m^2}$。\n\n接下来，我们为每个气柱 $i$ 和每个层次 $k$ 生成所需的物理场。这些场包括温度 $T_i(k)$、位涡 $q_i(k)$、垂直速度 $w_i(k)$、示踪剂质量混合比 $\\chi_i(k)$ 和空气密度 $\\rho_i(k)$。这些定义是基于一个依赖于气柱的参考对流层顶高度 $z_{\\mathrm{tp}, i}^{\\star} = 10000 + 500(i - 1.5)\\,\\mathrm{m}$ 进行参数化的。\n\n温度场 $T_i(k)$ 是分段定义的。在 $z_0 = 6000\\,\\mathrm{m}$ 处的基础温度设为 $T_{0,i} = 245 - 2i\\,\\mathrm{K}$。在 $z_{\\mathrm{tp}, i}^{\\star}$ 以下，温度遵循一个恒定的 $6.5\\,\\mathrm{K\\,km^{-1}}$ 直减率：\n$$ T_i(k) = T_{0,i} - 6.5 \\times \\frac{z_k - 6000}{1000} \\quad \\text{for } z_k \\le z_{\\mathrm{tp}, i}^{\\star}. $$\n在 $z_{\\mathrm{tp}, i}^{\\star}$ 以上，大气更加稳定，温度以 $1.0\\,\\mathrm{K\\,km^{-1}}$ 的速率递减：\n$$ T_i(k) = T(z_{\\mathrm{tp}, i}^{\\star}) - 1.0 \\times \\frac{z_k - z_{\\mathrm{tp}, i}^{\\star}}{1000} \\quad \\text{for } z_k > z_{\\mathrm{tp}, i}^{\\star}, $$\n其中 $T(z_{\\mathrm{tp}, i}^{\\star})$ 是使用对流层廓线计算的参考对流层顶高度处的温度。\n\n位涡 $q_i(k)$，单位为位涡单位 (PVU)，由一个随层指数 $k$ 线性增加并随气柱指数 $i$ 变化的背景廓线，加上在参考对流层顶高度 $z_{\\mathrm{tp}, i}^{\\star}$ 及以上急剧增加的 $2.0\\,\\mathrm{PVU}$ 构成：\n$$ q_i(k) = (0.5 + 0.15k + 0.1i) + \\Delta q_i(k), \\quad \\text{where } \\Delta q_i(k) = \\begin{cases} 0,  z_k  z_{\\mathrm{tp}, i}^{\\star} \\\\ 2.0,  z_k \\ge z_{\\mathrm{tp}, i}^{\\star} \\end{cases}. $$\n\n垂直速度 $w_i(k)$，单位为 $\\mathrm{m\\,s^{-1}}$，由一个关于高度和气柱指数的正弦函数加上一个恒定的向下偏移量给出：\n$$ w_i(k) = 0.02 \\sin\\left(\\frac{\\pi}{4} \\left(\\frac{z_k}{1000} - 6 + 0.5i\\right)\\right) - 0.005. $$\n\n示踪剂质量混合比 $\\chi_i(k)$，单位为 $\\mathrm{kg\\,kg^{-1}}$，在 $z_{\\mathrm{tp}, i}^{\\star}$ 上下以不同的梯度分段定义，并在过渡处包含一个 $3 \\times 10^{-6}\\,\\mathrm{kg\\,kg^{-1}}$ 的阶跃增加，模拟一种平流层示踪剂。\n\n空气密度 $\\rho_i(k)$，单位为 $\\mathrm{kg\\,m^{-3}}$，随高度呈指数衰减（等温大气近似），具有指定的标高 $H = 7000\\,\\mathrm{m}$ 和一个依赖于气柱的参考密度 $\\rho_{6,i} = 0.66(1 + 0.03(i-1.5))\\,\\mathrm{kg\\,m^{-3}}$（在基础高度 $z_0=6000\\,\\mathrm{m}$ 处）：\n$$ \\rho_i(k) = \\rho_{6,i} \\exp\\left(-\\frac{z_k - 6000}{H}\\right). $$\n\n物理场定义好后，算法的核心是根据三种方法之一为每个气柱 $i$ 诊断对流层顶的层指数 $k_{\\mathrm{tp}, i}$。\n\n1.  基于 PV 的定义：对于给定的 PV 阈值 $q_t$，我们搜索最低的层指数 $k \\in \\{0, \\dots, N_z-1\\}$，使得 $q_i(k) \\ge q_t$ 并且 $k=0$ 或 $q_i(k-1)  q_t$。如果找不到这样的层，则将对流层顶赋为最高的模式层，$k_{\\mathrm{tp}, i} = N_z - 1$。\n\n2.  温度直减率定义：首先，我们使用 $\\Gamma_i(k) = -\\frac{T_i(k+1) - T_i(k)}{z_{k+1} - z_k} \\times 1000$ 计算相邻层之间的直减率 $\\Gamma_i(k)$（单位：$\\mathrm{K\\,km^{-1}}$），其中 $k \\in \\{0, \\dots, N_z-2\\}$。由于 $z_{k+1} - z_k = 1000\\,\\mathrm{m}$，这简化为 $\\Gamma_i(k) = -(T_i(k+1) - T_i(k))$。对于给定的阈值 $\\gamma_t$，我们找到 $\\Gamma_i(k) \\le \\gamma_t$ 的最低指数 $k$。然后将对流层顶层设为 $k_{\\mathrm{tp}, i} = k + 1$。如果这个条件从未满足，我们再次默认设置为最高层，$k_{\\mathrm{tp}, i} = N_z - 1$。\n\n3.  混合定义：此方法综合了 PV 和温度定义。我们首先尝试使用两种方法找到对流层顶。设它们为 $k_{\\mathrm{pv}}$ 和 $k_{\\mathrm{th}}$，我们追踪每种方法是通过真实的阈值穿越找到的，还是通过默认设置为最高层找到的。\n    - 如果两种方法都得到了一个有效的穿越点，我们选择对应于更高几何高度的那个，即更大的层指数。\n    - 如果只有一种方法得到了一个有效的穿越点，我们使用其结果指数。\n    - 如果两种方法都没有找到穿越点，我们使用默认的最高层指数 $N_z - 1$。\n\n最后，对于每个测试用例，我们计算总的向下示踪剂通量 $\\mathcal{F}_{\\downarrow}$。对于给定的对流层顶定义及其相关阈值，我们遍历每个气柱 $i=0, \\dots, N_x-1$：\na. 确定对流层顶层指数 $k_{\\mathrm{tp}, i}$。\nb. 获取该层上的密度 $\\rho_i(k_{\\mathrm{tp}, i})$、垂直速度 $w_i(k_{\\mathrm{tp}, i})$ 和示踪剂混合比 $\\chi_i(k_{\\mathrm{tp}, i})$ 的值。\nc. 计算该气柱的向下通量贡献。仅当存在向下运动（$w_i  0$）时，该贡献才非零。贡献值为 $\\rho_i(k_{\\mathrm{tp}, i}) \\times \\max(-w_i(k_{\\mathrm{tp}, i}), 0) \\times \\chi_i(k_{\\mathrm{tp}, i}) \\times \\Delta A$。\nd. 将所有气柱的这些贡献相加，得到总通量 $\\mathcal{F}_{\\downarrow}$，单位为 $\\mathrm{kg\\,s^{-1}}$。\n\n每个测试用例的最终结果按照要求四舍五入到 6 位小数。整个算法的实现方式是：首先在网格上预计算所有物理场，然后对测试套件中的每个用例应用诊断程序。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes stratosphere-troposphere exchange flux for a suite of test cases.\n    \"\"\"\n    # 1. Define domain and constants\n    Nx = 4\n    Nz = 10\n    i_indices = np.arange(Nx)\n    k_indices = np.arange(Nz)\n    \n    z_k = 6000.0 + 1000.0 * k_indices  # meters\n    DeltaA = 1.0e10  # m^2\n    H = 7000.0  # meters\n\n    # 2. Generate the physical fields\n    \n    # Pre-allocate arrays\n    T = np.zeros((Nx, Nz))\n    q = np.zeros((Nx, Nz))\n    w = np.zeros((Nx, Nz))\n    chi = np.zeros((Nx, Nz))\n    rho = np.zeros((Nx, Nz))\n    \n    z_tp_star = 10000.0 + 500.0 * (i_indices - 1.5)\n    \n    # Base temperature at z=6000m\n    T0_i = 245.0 - 2.0 * i_indices\n    \n    # Base density at z=6000m\n    rho6_i = 0.66 * (1.0 + 0.03 * (i_indices - 1.5))\n    \n    for i in i_indices:\n        # Temperature\n        T_at_ztp_star = T0_i[i] - 6.5 * (z_tp_star[i] - 6000.0) / 1000.0\n        chi_at_ztp_star = 4e-6 + 0.5e-6 * (z_tp_star[i] - 6000.0) / 1000.0\n        \n        for k in k_indices:\n            zk = z_k[k]\n            \n            # Temperature T\n            if zk = z_tp_star[i]:\n                T[i, k] = T0_i[i] - 6.5 * (zk - 6000.0) / 1000.0\n            else:\n                T[i, k] = T_at_ztp_star - 1.0 * (zk - z_tp_star[i]) / 1000.0\n            \n            # Potential Vorticity q\n            delta_q = 2.0 if zk >= z_tp_star[i] else 0.0\n            q[i, k] = (0.5 + 0.15 * k + 0.1 * i) + delta_q\n            \n            # Vertical Velocity w\n            w[i, k] = 0.02 * np.sin(np.pi / 4.0 * (zk / 1000.0 - 6.0 + 0.5 * i)) - 0.005\n            \n            # Tracer mixing ratio chi\n            if zk = z_tp_star[i]:\n                chi[i, k] = 4e-6 + 0.5e-6 * (zk - 6000.0) / 1000.0\n            else:\n                chi[i, k] = chi_at_ztp_star + 3e-6 + 0.3e-6 * (zk - z_tp_star[i]) / 1000.0\n            \n            # Density rho\n            rho[i, k] = rho6_i[i] * np.exp(-(zk - 6000.0) / H)\n\n    # 3. Implement Tropopause Finders\n    \n    def find_pv_tropopause(i, q_t):\n        for k in k_indices:\n            is_crossing = q[i, k] >= q_t\n            if k == 0:\n                if is_crossing:\n                    return k, True # Found at lowest level\n            else:\n                if is_crossing and q[i, k-1]  q_t:\n                    return k, True # Found crossing\n        return Nz - 1, False # Not found, default to top\n\n    def find_thermal_tropopause(i, gamma_t):\n        # Lapse rate Gamma is defined for k in {0, ..., Nz-2}\n        for k in range(Nz - 1):\n            # z_{k+1} - z_k = 1000, so factor of 1000 cancels\n            gamma_k = -(T[i, k+1] - T[i, k])\n            if gamma_k = gamma_t:\n                return k + 1, True # Tropopause is at level k+1\n        return Nz - 1, False # Not found, default to top\n        \n    def find_hybrid_tropopause(i, q_t, gamma_t):\n        k_pv, found_pv = find_pv_tropopause(i, q_t)\n        k_th, found_th = find_thermal_tropopause(i, gamma_t)\n        \n        if found_pv and found_th:\n            # Both found, pick higher altitude\n            return k_pv if z_k[k_pv] >= z_k[k_th] else k_th\n        elif found_pv:\n            return k_pv\n        elif found_th:\n            return k_th\n        else:\n            # Neither found, default to top\n            return Nz - 1\n\n    # 4. Process test suite and calculate fluxes\n\n    test_cases = [\n        (\"PV\", 2.0, 2.0),\n        (\"PV\", 3.5, 2.0),\n        (\"TH\", 2.0, 2.0),\n        (\"TH\", 2.0, 1.5),\n        (\"HYB\", 2.0, 2.0),\n        (\"HYB\", 3.5, 1.5),\n        (\"PV\", 6.0, 2.0),\n        (\"TH\", 2.0, 0.5),\n    ]\n\n    results = []\n    \n    for case_def, q_t, gamma_t in test_cases:\n        total_flux = 0.0\n        for i in i_indices:\n            if case_def == \"PV\":\n                k_tp, _ = find_pv_tropopause(i, q_t)\n            elif case_def == \"TH\":\n                k_tp, _ = find_thermal_tropopause(i, gamma_t)\n            elif case_def == \"HYB\":\n                k_tp = find_hybrid_tropopause(i, q_t, gamma_t)\n            \n            # Retrieve values at tropopause level\n            rho_tp = rho[i, k_tp]\n            w_tp = w[i, k_tp]\n            chi_tp = chi[i, k_tp]\n            \n            # Calculate downward flux contribution\n            downward_mass_flux_per_area = rho_tp * max(-w_tp, 0)\n            flux_contribution = downward_mass_flux_per_area * chi_tp * DeltaA\n            total_flux += flux_contribution\n            \n        results.append(round(total_flux, 6))\n\n    # 5. Final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "准确模拟臭氧等化学物质的输送是气候模式的一个关键目标。本练习深入探讨了这些模拟背后的数值方法，特别是平流方案 ()。你将通过计算库朗数来评估数值稳定性，并探索数值耗散的概念，从而揭示稳定方案与物理真实性之间的关键权衡。",
            "id": "4095886",
            "problem": "一个全球化学气候模型被用来模拟由 Brewer–Dobson 环流和平流层-对流层交换引起的臭氧输运。考虑在每个坐标方向上由一维线性平流方程控制的示踪剂平流，其采用显式上游有限体积离散化，并用前向欧拉法进行时间推进。沿着平流层低层的一个中纬度纬圈，取典型纬向风速为 $u = 40 \\,\\text{m s}^{-1}$，水平网格间距为 $\\Delta x = 100 \\,\\text{km}$，时间步长为 $\\Delta t = 1800 \\,\\text{s}$。对于穿越热带对流层顶层的垂直输运，取典型剩余平均垂直速度为 $w = 1.5 \\times 10^{-3} \\,\\text{m s}^{-1}$，垂直网格间距为 $\\Delta z = 1.5 \\,\\text{km}$，以及相同的时间步长 $\\Delta t = 1800 \\,\\text{s}$。 \n\n从平流方程和控制体离散化出发，使用傅里叶 (von Neumann) 稳定性分析，计算在这些条件下水平和垂直示踪剂平流的 Courant–Friedrichs–Lewy (CFL) Courant 数，并确定显式上游平流在每个方向上是否稳定。然后，基于修正方程的观点，通过将该格式所隐含的领头阶数值扩散与物理上合理的平流层低层混合率进行比较，来评估预期的精度状况。\n\n将每个 Courant 数四舍五入到三位有效数字。在最终答案中，将 Courant 数表示为没有单位的无量纲数。",
            "solution": "该问题要求分析化学气候模型中用于示踪剂平流的显式上游有限体积格式的稳定性和准确性。分析基于所提供的参数，分别针对水平（纬向）和垂直输运进行。\n\n对于浓度为 $\\phi$ 的非反应性示踪剂，在恒定速度 $c$ 下的一维纯平流的控制方程是线性平流方程：\n$$\n\\frac{\\partial \\phi}{\\partial t} + c \\frac{\\partial \\phi}{\\partial x} = 0\n$$\n\n我们使用有限体积方法在间距为 $\\Delta x$ 的均匀网格上对此方程进行离散化。对于中心在 $x_i$ 的网格单元 $i$，其单元平均浓度的变化率由单元面上的通量控制：\n$$\n\\frac{d\\phi_i}{dt}\\Delta x + (c\\phi)_{i+1/2} - (c\\phi)_{i-1/2} = 0\n$$\n此处，$\\phi_i$ 是单元 $i$ 中的平均浓度，$(c\\phi)_{i\\pm1/2}$ 分别是右侧和左侧单元交界面上的通量。\n\n指定的格式在时间上是前向欧拉法，空间通量是显式上游格式。时间导数的前向欧拉离散化为 $\\frac{d\\phi_i}{dt} \\approx \\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t}$。上游格式规定，单元交界面上的 $\\phi$ 值取自迎风单元。对于正速度 ($c > 0$)，这意味着 $(c\\phi)_{i+1/2} = c\\phi_i^n$ 且 $(c\\phi)_{i-1/2} = c\\phi_{i-1}^n$。将这些代入有限体积方程，得到：\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} \\Delta x + c\\phi_i^n - c\\phi_{i-1}^n = 0\n$$\n对新时间步的 $\\phi_i^{n+1}$ 进行整理：\n$$\n\\phi_i^{n+1} = \\phi_i^n - \\frac{c \\Delta t}{\\Delta x} (\\phi_i^n - \\phi_{i-1}^n)\n$$\n我们将无量纲的 Courant–Friedrichs–Lewy (CFL) 数（或 Courant 数）定义为 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$。更新方程变为：\n$$\n\\phi_i^{n+1} = (1 - \\sigma)\\phi_i^n + \\sigma\\phi_{i-1}^n\n$$\n对该格式的傅里叶 (von Neumann) 稳定性分析表明，其数值稳定的充要条件是 Courant 数 $\\sigma$ 满足条件 $0 \\le \\sigma \\le 1$。\n\n我们现在将此框架应用于所提供的两种情况。\n\n**1. 水平（纬向）平流**\n\n给定的参数为：\n- 纬向风速: $u = 40 \\,\\text{m s}^{-1}$\n- 水平网格间距: $\\Delta x = 100 \\,\\text{km} = 1 \\times 10^5 \\,\\text{m}$\n- 时间步长: $\\Delta t = 1800 \\,\\text{s}$\n\n水平平流的 Courant 数 $\\sigma_x$ 是：\n$$\n\\sigma_x = \\frac{u \\Delta t}{\\Delta x} = \\frac{(40 \\,\\text{m s}^{-1}) \\times (1800 \\,\\text{s})}{1 \\times 10^5 \\,\\text{m}} = \\frac{72000}{100000} = 0.72\n$$\n四舍五入到三位有效数字，得到 $\\sigma_x = 0.720$。\n由于 $0 \\le 0.720 \\le 1$，稳定性条件得到满足。因此，在这些条件下，用于水平平流的显式上游格式是**稳定**的。\n\n**2. 垂直平流**\n\n给定的参数为：\n- 剩余平均垂直速度: $w = 1.5 \\times 10^{-3} \\,\\text{m s}^{-1}$\n- 垂直网格间距: $\\Delta z = 1.5 \\,\\text{km} = 1.5 \\times 10^3 \\,\\text{m}$\n- 时间步长: $\\Delta t = 1800 \\,\\text{s}$\n\n垂直平流的 Courant 数 $\\sigma_z$ 是：\n$$\n\\sigma_z = \\frac{w \\Delta t}{\\Delta z} = \\frac{(1.5 \\times 10^{-3} \\,\\text{m s}^{-1}) \\times (1800 \\,\\text{s})}{1.5 \\times 10^3 \\,\\text{m}} = \\frac{2.7}{1500} = 0.0018\n$$\n四舍五入到三位有效数字，得到 $\\sigma_z = 0.00180$。\n由于 $0 \\le 0.00180 \\le 1$，稳定性条件得到满足。用于垂直平流的显式上游格式也是**稳定**的。\n\n**3. 通过修正方程进行精度评估**\n\n尽管该格式在两个方向上都是稳定的，但必须评估其准确性。众所周知，前向欧拉、上游格式仅具有一阶精度，并会引入显著的数值扩散。这可以通过修正方程的观点进行量化，该观点揭示了数值格式实际求解的偏微分方程。对于此格式，修正方程为：\n$$\n\\frac{\\partial \\phi}{\\partial t} + c \\frac{\\partial \\phi}{\\partial x} = K_{num} \\frac{\\partial^2 \\phi}{\\partial x^2} + \\dots (\\text{高阶项})\n$$\n领头阶误差项具有物理扩散项的形式，其中 $K_{num}$ 是数值扩散系数。其值由下式给出：\n$$\nK_{num} = \\frac{c \\Delta x}{2}(1 - \\sigma)\n$$\n这种数值扩散是离散化产生的假象，如果其量级与所模拟的物理混合过程相当或更大，则会破坏模拟结果。\n\n**水平精度：**\n水平平流的数值扩散系数为：\n$$\nK_{num, x} = \\frac{u \\Delta x}{2}(1 - \\sigma_x) = \\frac{(40 \\,\\text{m s}^{-1})(1 \\times 10^5 \\,\\text{m})}{2}(1 - 0.720) = (2 \\times 10^6 \\,\\text{m}^2 \\text{s}^{-1})(0.28) = 5.6 \\times 10^5 \\,\\text{m}^2 \\text{s}^{-1}\n$$\n在平流层低层，由破碎的行星波引起的大尺度准水平混合是一个关键的物理过程，其特征是有效水平涡动扩散系数的量级约为 $K_{yy} \\approx 10^5 - 10^6 \\,\\text{m}^2 \\text{s}^{-1}$。计算出的数值扩散系数 $K_{num, x} = 5.6 \\times 10^5 \\,\\text{m}^2 \\text{s}^{-1}$ 正好落在这个范围内。这意味着由数值格式引起的人为扩散与它旨在解析的物理过程具有相同的量级。因此，模拟的水平输运将被数值误差主导，这代表了**较差的精度状况**。\n\n**垂直精度：**\n垂直平流的数值扩散系数为：\n$$\nK_{num, z} = \\frac{w \\Delta z}{2}(1 - \\sigma_z) = \\frac{(1.5 \\times 10^{-3} \\,\\text{m s}^{-1})(1.5 \\times 10^3 \\,\\text{m})}{2}(1 - 0.00180) \\approx \\frac{2.25 \\,\\text{m}^2 \\text{s}^{-1}}{2}(0.9982) \\approx 1.12 \\,\\text{m}^2 \\text{s}^{-1}\n$$\n平流层低层是高度稳定分层的，物理上的垂直混合很弱。垂直涡动扩散系数 $K_{zz}$ 的合理值通常在 $0.1 - 1.0 \\,\\text{m}^2 \\text{s}^{-1}$ 的范围内。计算出的数值扩散系数 $K_{num, z} \\approx 1.12 \\,\\text{m}^2 \\text{s}^{-1}$ 处于合理物理值的上限，甚至超过了它。这一点尤其成问题，因为 Brewer-Dobson 环流中的垂直输运很慢，而维持诸如臭氧等示踪剂跨越对流层顶的陡峭垂直梯度至关重要。巨大的数值扩散会人为地平滑这些梯度，从根本上错误地表征了平流层-对流层交换的物理过程。这构成了一个**非常差的精度状况**。请注意，极小的 Courant 数（$\\sigma_z \\ll 1$）导致了最大的数值扩散，这是该格式在处理缓慢平流过程时的一个典型缺陷。\n\n总之，尽管对于给定的参数，该格式是数值稳定的，但其在水平和垂直方向上的内在数值扩散都非常大，以至于使得用于研究平流层低层输运的模拟在科学上是不准确的。现代气候模型采用更高阶、扩散更小的平流格式来缓解这一关键问题。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.720  0.00180 \\end{pmatrix}}\n$$"
        }
    ]
}