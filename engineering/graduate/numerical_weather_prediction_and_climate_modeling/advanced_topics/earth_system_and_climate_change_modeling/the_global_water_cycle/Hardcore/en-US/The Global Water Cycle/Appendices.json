{
    "hands_on_practices": [
        {
            "introduction": "The foundation of the global water cycle is the principle of mass conservation. Over long timescales, the Earth's climate system can be considered in a statistically steady state, where the total amount of water in the atmosphere remains constant. This implies a simple but powerful balance: global mean evaporation must equal global mean precipitation. This exercise applies this fundamental concept to make a first-order estimate of ocean evaporation, the largest single flux in the water cycle, and quantifies the sensitivity of this estimate to assumptions about terrestrial evaporation .",
            "id": "4100576",
            "problem": "In Numerical Weather Prediction (NWP) and climate modeling, closure of the global hydrological cycle follows from conservation of water substance in the atmosphere. Consider a statistically steady climate in which the long-term, vertically integrated atmospheric water storage tendency is negligible, so that the global, area-mean evaporation equals the global, area-mean precipitation. Let the Earth’s ocean area fraction be $f_{o}$ and the land area fraction be $f_{\\ell} = 1 - f_{o}$. Let the long-term, area-mean precipitation over the entire globe be $P$ (defined per unit area of the Earth’s surface). Let the long-term, area-mean evaporation over ocean and land (each defined per unit area of their respective surfaces) be $E_{o}$ and $E_{\\ell}$, respectively. The global, area-mean evaporation then satisfies $E = f_{o} E_{o} + f_{\\ell} E_{\\ell}$, and global water-mass conservation at steady state implies $E = P$.\n\nGiven observational estimates $P = 2.7$ mm day$^{-1}$ and $f_{o} = 0.71$, do the following:\n1) Using only the fundamental mass-conservation statement described above and area-weighting, derive and compute the implied $E_{o}$ under the assumption of negligible continental evaporation, $E_{\\ell} \\approx 0$.\n2) Quantify the absolute error in $E_{o}$ that arises if, in reality, the continental evaporation is $E_{\\ell} = 0.5$ mm day$^{-1}$.\n\nExpress both requested quantities in mm day$^{-1}$. Round your answer to four significant figures.",
            "solution": "The fundamental basis is the conservation of water substance applied to the global atmosphere under steady-state conditions. The vertically integrated atmospheric water budget, averaged over a sufficiently long time, reduces to equality of global, area-mean evaporation and precipitation:\n$$\nE = P.\n$$\nHere $E$ denotes the global, area-mean evaporation (per unit area of the Earth’s surface) and $P$ is the global, area-mean precipitation (per unit area of the Earth’s surface). Because the surface is partitioned into ocean and land with respective area fractions $f_{o}$ and $f_{\\ell} = 1 - f_{o}$, the global mean of evaporation is the area-weighted mean of the component fluxes:\n$$\nE = f_{o} E_{o} + f_{\\ell} E_{\\ell}.\n$$\nCombining this with mass conservation gives\n$$\nP = f_{o} E_{o} + f_{\\ell} E_{\\ell}.\n$$\n\nPart 1: Negligible continental evaporation. If $E_{\\ell} \\approx 0$, then\n$$\nP = f_{o} E_{o} \\quad \\Rightarrow \\quad E_{o} = \\frac{P}{f_{o}}.\n$$\nWith $P = 2.7$ mm day$^{-1}$ and $f_{o} = 0.71$,\n$$\nE_{o}^{(0)} = \\frac{2.7}{0.71} \\ \\text{mm day}^{-1}.\n$$\n\nPart 2: Absolute error when $E_{\\ell} \\neq 0$. If the actual continental evaporation is $E_{\\ell} = 0.5$ mm day$^{-1}$, then the correct ocean evaporation that satisfies the budget is\n$$\nE_{o}^{(\\text{true})} = \\frac{P - f_{\\ell} E_{\\ell}}{f_{o}},\n$$\nobtained by solving $P = f_{o} E_{o} + f_{\\ell} E_{\\ell}$ for $E_{o}$. The absolute error from assuming $E_{\\ell} \\approx 0$ is\n$$\n\\Delta E_{o} = \\left| E_{o}^{(0)} - E_{o}^{(\\text{true})} \\right|\n= \\left| \\frac{P}{f_{o}} - \\frac{P - f_{\\ell} E_{\\ell}}{f_{o}} \\right|\n= \\frac{f_{\\ell} E_{\\ell}}{f_{o}}.\n$$\nUsing $f_{o} = 0.71$, $f_{\\ell} = 1 - 0.71 = 0.29$, and $E_{\\ell} = 0.5$ mm day$^{-1}$,\n$$\n\\Delta E_{o} = \\frac{0.29 \\times 0.5}{0.71} \\ \\text{mm day}^{-1}.\n$$\n\nNumerical evaluations:\n- Implied ocean evaporation with $E_{\\ell} \\approx 0$:\n$$\nE_{o}^{(0)} = \\frac{2.7}{0.71} \\approx 3.802816901\\ \\text{mm day}^{-1}.\n$$\n- Absolute error when $E_{\\ell} = 0.5$ mm day$^{-1}$:\n$$\n\\Delta E_{o} = \\frac{0.145}{0.71} = \\frac{29}{142} \\approx 0.204225352\\ \\text{mm day}^{-1}.\n$$\n\nRounding both quantities to four significant figures and expressing in mm day$^{-1}$ yields $E_{o}^{(0)} \\approx 3.803$ mm day$^{-1}$ and $\\Delta E_{o} \\approx 0.2042$ mm day$^{-1}$.",
            "answer": "$$\\boxed{\\begin{pmatrix}3.803  0.2042\\end{pmatrix}}$$"
        },
        {
            "introduction": "While the global water budget balances over long periods, the picture is more dynamic on regional and shorter timescales. The full atmospheric moisture budget includes a local storage term, $\\partial_{t} W$, which accounts for changes in the amount of water vapor held in an atmospheric column. This practice employs scale analysis, a cornerstone technique in geophysical fluid dynamics, to investigate how the importance of this storage term compares to surface fluxes like evaporation and precipitation across different timescales from daily to seasonal . Understanding this scaling is crucial for justifying the simplifying assumptions made in different types of numerical models, from weather prediction to climate projection.",
            "id": "4100545",
            "problem": "A core diagnostic used in Numerical Weather Prediction (NWP) and climate modeling for the global water cycle is the column-integrated atmospheric moisture budget, which states that the local tendency of column water storage is balanced by surface freshwater fluxes and horizontal moisture transport. Consider the column-integrated atmospheric moisture budget in height or pressure coordinates, written schematically as\n$$\n\\partial_{t} W + \\nabla \\cdot \\mathbf{F} = E - P,\n$$\nwhere $W$ is the precipitable water (column-integrated specific humidity expressed in millimeters via $1\\,\\mathrm{kg}\\,\\mathrm{m}^{-2} \\equiv 1\\,\\mathrm{mm}$), $\\mathbf{F}$ is the vertically integrated horizontal moisture flux, $E$ is evaporation from the surface to the atmosphere, and $P$ is precipitation from the atmosphere to the surface. In scale analysis, the magnitude of the local storage tendency is estimated by $|\\partial_t W| \\sim W/\\tau$ at timescale $\\tau$, and the net surface freshwater flux magnitude is represented by $|E-P|$.\n\nStarting from the budget statement and the definitions above, derive a nondimensional ratio that quantifies the relative importance of the local storage tendency to the net surface freshwater flux at a timescale $\\tau$. Then, using scientifically plausible and widely used characteristic magnitudes for the deep tropics and midlatitude extratropics, evaluate this ratio for daily, weekly, and seasonal applications:\n\n- Deep tropics: precipitable water $W_{\\mathrm{trop}} = 50$ mm; characteristic net surface freshwater flux magnitude $|E-P|_{\\mathrm{trop}} = 6$ mm day$^{-1}$.\n- Midlatitude extratropics: precipitable water $W_{\\mathrm{extr}} = 20$ mm; characteristic net surface freshwater flux magnitude $|E-P|_{\\mathrm{extr}} = 3$ mm day$^{-1}$.\n\nUse timescales $\\tau_{\\mathrm{day}} = 1$ day, $\\tau_{\\mathrm{week}} = 7$ days, and $\\tau_{\\mathrm{season}} = 90$ days. Report the six nondimensional ratios in the order: tropics (daily, weekly, seasonal), extratropics (daily, weekly, seasonal). Express all answers as dimensionless numbers and round to three significant figures. Do not include units in your final reported values.",
            "solution": "The task is to derive a nondimensional ratio that quantifies the relative importance of the local storage tendency to the net surface freshwater flux, and then to evaluate this ratio for two different climate regimes at three different timescales.\n\nLet the nondimensional ratio be denoted by $\\mathcal{R}$. By definition, this ratio is the magnitude of the local storage tendency term divided by the magnitude of the net surface freshwater flux term. Using the provided scale analysis approximation, $|\\partial_t W| \\sim \\frac{W}{\\tau}$ at a characteristic timescale $\\tau$, the ratio is:\n$$\n\\mathcal{R} = \\frac{|\\partial_t W|}{|E - P|} \\sim \\frac{W/\\tau}{|E-P|} = \\frac{W}{\\tau |E - P|}\n$$\nThis expression is dimensionless, as the units are $\\frac{[\\text{mm}]}{[\\text{day}] \\times [\\text{mm day}^{-1}]} = 1$.\n\nWe now evaluate this ratio for the six specified cases, rounding the results to three significant figures.\n\n**1. Deep Tropics ($W = 50$ mm, $|E-P| = 6$ mm day$^{-1}$)**\n\n-   **Daily timescale ($\\tau = 1$ day):**\n    $$\n    \\mathcal{R}_{\\mathrm{trop, day}} = \\frac{50 \\text{ mm}}{(1 \\text{ day}) \\times (6 \\text{ mm day}^{-1})} = \\frac{50}{6} \\approx 8.33\n    $$\n\n-   **Weekly timescale ($\\tau = 7$ days):**\n    $$\n    \\mathcal{R}_{\\mathrm{trop, week}} = \\frac{50 \\text{ mm}}{(7 \\text{ days}) \\times (6 \\text{ mm day}^{-1})} = \\frac{50}{42} \\approx 1.19\n    $$\n\n-   **Seasonal timescale ($\\tau = 90$ days):**\n    $$\n    \\mathcal{R}_{\\mathrm{trop, season}} = \\frac{50 \\text{ mm}}{(90 \\text{ days}) \\times (6 \\text{ mm day}^{-1})} = \\frac{50}{540} \\approx 0.0926\n    $$\n\n**2. Midlatitude Extratropics ($W = 20$ mm, $|E-P| = 3$ mm day$^{-1}$)**\n\n-   **Daily timescale ($\\tau = 1$ day):**\n    $$\n    \\mathcal{R}_{\\mathrm{extr, day}} = \\frac{20 \\text{ mm}}{(1 \\text{ day}) \\times (3 \\text{ mm day}^{-1})} = \\frac{20}{3} \\approx 6.67\n    $$\n\n-   **Weekly timescale ($\\tau = 7$ days):**\n    $$\n    \\mathcal{R}_{\\mathrm{extr, week}} = \\frac{20 \\text{ mm}}{(7 \\text{ days}) \\times (3 \\text{ mm day}^{-1})} = \\frac{20}{21} \\approx 0.952\n    $$\n\n-   **Seasonal timescale ($\\tau = 90$ days):**\n    $$\n    \\mathcal{R}_{\\mathrm{extr, season}} = \\frac{20 \\text{ mm}}{(90 \\text{ days}) \\times (3 \\text{ mm day}^{-1})} = \\frac{20}{270} \\approx 0.0741\n    $$\n\nThe six calculated nondimensional ratios are: $8.33$, $1.19$, $0.0926$, $6.67$, $0.952$, and $0.0741$. These results show that the local storage of atmospheric water is a dominant term in the moisture budget on daily timescales, becomes comparable to surface fluxes on weekly timescales, and is a relatively minor term on seasonal timescales, where the budget is primarily a balance between moisture flux divergence and net surface fluxes.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 8.33  1.19  0.0926  6.67  0.952  0.0741 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Moving from global principles to regional applications, this exercise demonstrates how the water budget is closed at the scale of a river basin. Here, the atmospheric input, Precipitation minus Evaporation ($P-E$), is balanced by the combined effects of river discharge ($R$) and changes in terrestrial water storage ($dS/dt$). This hands-on problem simulates a core task in modern hydrology and climate model evaluation: using observable data like river discharge to test the fidelity of a reanalysis product's representation of the surface water balance . By calculating the budget residual, you will gain practical experience in a fundamental method for diagnosing errors and uncertainties in Earth system models.",
            "id": "4100556",
            "problem": "You are tasked with developing a complete, runnable program that evaluates basin-scale water budget closure in the context of the Global Water Cycle (GWC) within Numerical Weather Prediction (NWP) and climate modeling. The governing physical principle is conservation of mass for a control volume: in a river basin, the net atmospheric input and surface losses must be consistent with the change in terrestrial water storage and the volumetric discharge leaving the basin through its outlet. Starting from conservation of mass for a fixed-area basin and using well-tested hydrological facts and definitions, your program must compute, for several test cases, the closure residual time series and summary statistics that quantify agreement between observed discharge-derived water budget and an atmospheric reanalysis estimate of precipitation minus evaporation. The atmospheric reanalysis (first defined here) is a data-assimilation product that reconstructs past atmospheric states, including precipitation and evaporation fields.\n\nDefinitions and conventions:\n- Let $A$ denote the basin area in $\\mathrm{m^2}$.\n- Let $Q(t)$ denote the observed river discharge at the basin outlet in $\\mathrm{m^3/s}$.\n- Let $P(t)$ denote precipitation in $\\mathrm{m/s}$.\n- Let $E(t)$ denote evaporation in $\\mathrm{m/s}$.\n- Let $S(t)$ denote vertically integrated terrestrial water storage (soil moisture, snow, groundwater, surface water) in $\\mathrm{m}$, so that $\\frac{dS}{dt}(t)$ is in $\\mathrm{m/s}$.\n- Let $(P - E)_{\\mathrm{rean}}(t)$ denote precipitation minus evaporation from an atmospheric reanalysis, in $\\mathrm{m/s}$.\n- Assume a single dominant outlet and negligible lateral groundwater exchange across basin boundaries, so that runoff integrated over the basin equals outlet discharge, and basin-average runoff $R(t)$ in $\\mathrm{m/s}$ satisfies $R(t) = \\frac{Q(t)}{A}$.\n\nYour task is to:\n1. Derive, from conservation of mass, the basin water budget relationship that links $P(t)$, $E(t)$, $R(t)$, and $\\frac{dS}{dt}(t)$, and use it to define a closure residual time series $\\varepsilon(t)$ that compares $(P - E)_{\\mathrm{rean}}(t)$ to the discharge-derived budget.\n2. Implement an algorithm to compute, for each test case time series:\n   - The closure residuals $\\varepsilon(t)$ in $\\mathrm{m/s}$ over all provided times.\n   - The mean bias $b = \\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t)$ in $\\mathrm{m/s}$.\n   - The root-mean-square error $\\mathrm{RMSE} = \\sqrt{\\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t)^2}$ in $\\mathrm{m/s}$.\n   - The Pearson correlation coefficient $\\rho$ between $(P - E)_{\\mathrm{rean}}(t)$ and $R(t) + \\frac{dS}{dt}(t)$ (unitless). If either series has zero variance, define $\\rho = 0$ by convention.\n   - A boolean flag indicating whether closure is satisfactory, defined as $\\mathrm{RMSE} \\le \\tau$, with threshold $\\tau = 1\\times 10^{-8}\\ \\mathrm{m/s}$.\n3. Express all physical quantities in SI units. Angles, where relevant to synthetic construction of time series, must be in radians. The output statistics $b$, $\\mathrm{RMSE}$, and $\\rho$ must be floats; the closure flag must be a boolean.\n\nTest suite specification:\nFor each case, you are given $A$, $Q(t)$, and $\\frac{dS}{dt}(t)$ as monthly time series of length $N = 12$. The $(P - E)_{\\mathrm{rean}}(t)$ series is to be constructed from these fields using a specified base and an additive harmonic noise term. For month index $t \\in \\{1,2,\\dots,12\\}$, define the noise as either $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$ or $\\eta(t) = \\alpha \\sin\\!\\left(\\frac{2\\pi t}{6}\\right)$, with amplitude $\\alpha$ given per case (angles in radians).\n\n- Case 1 (happy path, small mismatch):\n  - Basin area: $A = 1.2 \\times 10^{11}\\ \\mathrm{m^2}$.\n  - Discharge time series $Q(t)$ in $\\mathrm{m^3/s}$ for $t=1,\\dots,12$: $[14000, 13000, 12000, 11000, 10000, 9000, 8000, 7500, 8000, 9000, 10000, 12000]$.\n  - Storage-change time series $\\frac{dS}{dt}(t)$ in $\\mathrm{m/s}$: $[-2\\times 10^{-8}, -1.5\\times 10^{-8}, -1\\times 10^{-8}, -5\\times 10^{-9}, 1\\times 10^{-9}, 5\\times 10^{-9}, 1\\times 10^{-8}, 1.5\\times 10^{-8}, 1\\times 10^{-8}, 5\\times 10^{-9}, 0, -1\\times 10^{-8}]$.\n  - Construct $(P - E)_{\\mathrm{rean}}(t)$ as base $R(t) + \\frac{dS}{dt}(t)$ plus noise $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$ with $\\alpha = 5\\times 10^{-9}$.\n\n- Case 2 (boundary, zero storage change):\n  - Basin area: $A = 8.0 \\times 10^{10}\\ \\mathrm{m^2}$.\n  - Discharge $Q(t)$ in $\\mathrm{m^3/s}$: $[5000, 6000, 7000, 8000, 9000, 10000, 11000, 10000, 9000, 8000, 7000, 6000]$.\n  - Storage change $\\frac{dS}{dt}(t)$ in $\\mathrm{m/s}$: $[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]$.\n  - Construct $(P - E)_{\\mathrm{rean}}(t)$ as base $R(t)$ with zero noise $\\alpha = 0$.\n\n- Case 3 (edge, low discharge regime where atmospheric input is stored):\n  - Basin area: $A = 1.5 \\times 10^{11}\\ \\mathrm{m^2}$.\n  - Discharge $Q(t)$ in $\\mathrm{m^3/s}$: $[800, 700, 600, 500, 400, 300, 200, 300, 400, 500, 600, 700]$.\n  - Storage change $\\frac{dS}{dt}(t)$ in $\\mathrm{m/s}$: $[2\\times 10^{-8}, 1.5\\times 10^{-8}, 1\\times 10^{-8}, 5\\times 10^{-9}, 0, -5\\times 10^{-9}, -1\\times 10^{-8}, -1.5\\times 10^{-8}, -1\\times 10^{-8}, -5\\times 10^{-9}, 0, 5\\times 10^{-9}]$.\n  - Construct $(P - E)_{\\mathrm{rean}}(t)$ as base $\\frac{dS}{dt}(t)$ plus noise $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$ with $\\alpha = 1\\times 10^{-9}$.\n\n- Case 4 (edge, small basin with larger mismatch):\n  - Basin area: $A = 5.0 \\times 10^{9}\\ \\mathrm{m^2}$.\n  - Discharge $Q(t)$ in $\\mathrm{m^3/s}$: $[400, 500, 600, 700, 800, 900, 1000, 900, 800, 700, 600, 500]$.\n  - Storage change $\\frac{dS}{dt}(t)$ in $\\mathrm{m/s}$: $[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]$.\n  - Construct $(P - E)_{\\mathrm{rean}}(t)$ as base $R(t)$ plus noise $\\eta(t) = \\alpha \\sin\\!\\left(\\frac{2\\pi t}{6}\\right)$ with $\\alpha = 2\\times 10^{-8}$.\n\nAlgorithmic requirements:\n- For each case, compute $R(t) = \\frac{Q(t)}{A}$ in $\\mathrm{m/s}$.\n- Using the specified construction rules, generate $(P - E)_{\\mathrm{rean}}(t)$.\n- Define the closure residual $\\varepsilon(t)$ by comparing $(P - E)_{\\mathrm{rean}}(t)$ to the discharge-derived budget. Use this to compute $b$, $\\mathrm{RMSE}$, and $\\rho$.\n- Decide closure satisfactory if $\\mathrm{RMSE} \\le \\tau$ with $\\tau = 1\\times 10^{-8}\\ \\mathrm{m/s}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case contributes a sublist in the form $[b,\\ \\mathrm{RMSE},\\ \\rho,\\ \\mathrm{pass}]$, where $b$, $\\mathrm{RMSE}$, and $\\rho$ are floats and $\\mathrm{pass}$ is a boolean. For example, the final line should look like $[[b_1,\\mathrm{RMSE}_1,\\rho_1,\\mathrm{pass}_1],[b_2,\\mathrm{RMSE}_2,\\rho_2,\\mathrm{pass}_2],[b_3,\\mathrm{RMSE}_3,\\rho_3,\\mathrm{pass}_3],[b_4,\\mathrm{RMSE}_4,\\rho_4,\\mathrm{pass}_4]]$.",
            "solution": "We anchor the derivation in conservation of mass for a control volume representing a fixed-area river basin. Let the control volume be the basin with spatial domain $\\Omega$ and area $A$. The vertically integrated water storage is $S(t)$ in $\\mathrm{m}$, representing total water per unit area. The conservation of mass (continuity) for the basin-average water content can be expressed as:\n$$\n\\frac{dS}{dt}(t) = P(t) - E(t) - R(t),\n$$\nwhere $P(t)$ is precipitation input from the atmosphere in $\\mathrm{m/s}$, $E(t)$ is evaporation loss to the atmosphere in $\\mathrm{m/s}$, and $R(t)$ is the basin-average runoff in $\\mathrm{m/s}$ that leaves through the basin boundaries (primarily the river outlet). This statement relies on standard hydrological assumptions: negligible lateral groundwater exchange across boundaries relative to outlet discharge for the timescales of interest, and a single dominant outlet.\n\nFor a single-outlet basin, a well-tested hydrological identity equates the spatially integrated runoff to the outlet discharge. If $Q(t)$ is the volumetric discharge in $\\mathrm{m^3/s}$ at the outlet, then the basin-average runoff in $\\mathrm{m/s}$ is:\n$$\nR(t) = \\frac{Q(t)}{A}.\n$$\nSubstituting into the continuity equation and rearranging yields a relationship between atmospheric fluxes and terrestrial terms:\n$$\nP(t) - E(t) = R(t) + \\frac{dS}{dt}(t) = \\frac{Q(t)}{A} + \\frac{dS}{dt}(t).\n$$\nThe atmospheric reanalysis provides $(P - E)_{\\mathrm{rean}}(t)$ in $\\mathrm{m/s}$, which ideally should satisfy the above relationship when averaged over the basin. Therefore, a closure residual that quantifies mismatch is defined as:\n$$\n\\varepsilon(t) = (P - E)_{\\mathrm{rean}}(t) - \\left(\\frac{Q(t)}{A} + \\frac{dS}{dt}(t)\\right).\n$$\nIf the reanalysis and observations close the water budget, then $\\varepsilon(t)$ should be close to zero.\n\nTo summarize discrepancies over the time series $t=1,\\dots,N$ with $N=12$ months, we compute:\n- The mean bias:\n$$\nb = \\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t)\n$$\n- The root-mean-square error:\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t)^2}\n$$\n- The Pearson correlation coefficient between the reanalysis atmospheric input and the discharge-derived budget:\n$$\n\\rho = \\mathrm{corr}\\left((P - E)_{\\mathrm{rean}}(t),\\ \\frac{Q(t)}{A} + \\frac{dS}{dt}(t)\\right)\n$$\nwhich is unitless. If either series has zero variance, we define $\\rho = 0$ by convention.\n\nFor closure evaluation, we use a threshold $\\tau = 1\\times 10^{-8}\\ \\mathrm{m/s}$, and define the boolean closure flag as $\\mathrm{pass} = (\\mathrm{RMSE} \\le \\tau)$.\n\nThe algorithmic implementation will follow these steps for each test case, constructing the reanalysis time series as specified, calculating the residual series, and then computing the required statistical metrics ($b$, $\\mathrm{RMSE}$, $\\rho$) and the closure flag. The results for all four cases will be aggregated into the specified final output format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef safe_corr(x: np.ndarray, y: np.ndarray) -> float:\n    \"\"\"Compute Pearson correlation if both series have non-zero variance; else return 0.0.\"\"\"\n    x = np.asarray(x, dtype=float)\n    y = np.asarray(y, dtype=float)\n    sx = np.std(x)\n    sy = np.std(y)\n    if sx == 0.0 or sy == 0.0:\n        return 0.0\n    return float(np.corrcoef(x, y)[0, 1])\n\ndef compute_metrics(A, Q, dSdt, pe_mode):\n    \"\"\"\n    Compute closure residual metrics:\n    - A: basin area (m^2)\n    - Q: array of discharge (m^3/s)\n    - dSdt: array of storage change (m/s)\n    - pe_mode: dict controlling construction of reanalysis P-E\n        keys:\n          'base': 'R_plus_dSdt', 'R_only', or 'dSdt_only'\n          'noise_amp': float amplitude (m/s)\n          'noise_func': 'cos12' or 'sin6'\n    Returns: [mean_bias, rmse, corr, pass_bool]\n    \"\"\"\n    Q = np.asarray(Q, dtype=float)\n    dSdt = np.asarray(dSdt, dtype=float)\n    # Compute basin-mean runoff R = Q/A (m/s)\n    R = Q / float(A)\n\n    # Build base series for reanalysis P-E\n    base_choice = pe_mode.get('base', 'R_plus_dSdt')\n    if base_choice == 'R_plus_dSdt':\n        base = R + dSdt\n    elif base_choice == 'R_only':\n        base = R\n    elif base_choice == 'dSdt_only':\n        base = dSdt\n    else:\n        raise ValueError(\"Invalid base choice for P-E construction.\")\n\n    # Harmonic noise (angles in radians)\n    N = len(Q)\n    t = np.arange(1, N + 1, dtype=float)\n    amp = float(pe_mode.get('noise_amp', 0.0))\n    nf = pe_mode.get('noise_func', 'cos12')\n    if amp == 0.0:\n        noise = np.zeros_like(base)\n    else:\n        if nf == 'cos12':\n            noise = amp * np.cos(2.0 * np.pi * t / 12.0)\n        elif nf == 'sin6':\n            noise = amp * np.sin(2.0 * np.pi * t / 6.0)\n        else:\n            raise ValueError(\"Invalid noise function for P-E construction.\")\n\n    pe_rean = base + noise\n\n    # Closure residual: epsilon = (P-E)_rean - (R + dSdt)\n    epsilon = pe_rean - (R + dSdt)\n\n    # Metrics\n    mean_bias = float(np.mean(epsilon))\n    rmse = float(np.sqrt(np.mean(epsilon ** 2)))\n    corr = safe_corr(pe_rean, (R + dSdt))\n\n    # Closure pass criterion: RMSE = tau\n    tau = 1e-8  # m/s\n    closure_pass = rmse = tau\n\n    return [mean_bias, rmse, corr, closure_pass]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"A\": 1.2e11,\n            \"Q\": [14000, 13000, 12000, 11000, 10000, 9000, 8000, 7500, 8000, 9000, 10000, 12000],\n            \"dSdt\": [-2e-8, -1.5e-8, -1e-8, -5e-9, 1e-9, 5e-9, 1e-8, 1.5e-8, 1e-8, 5e-9, 0.0, -1e-8],\n            \"pe_mode\": {\"base\": \"R_plus_dSdt\", \"noise_amp\": 5e-9, \"noise_func\": \"cos12\"},\n        },\n        {\n            \"A\": 8.0e10,\n            \"Q\": [5000, 6000, 7000, 8000, 9000, 10000, 11000, 10000, 9000, 8000, 7000, 6000],\n            \"dSdt\": [0.0] * 12,\n            \"pe_mode\": {\"base\": \"R_only\", \"noise_amp\": 0.0, \"noise_func\": \"cos12\"},\n        },\n        {\n            \"A\": 1.5e11,\n            \"Q\": [800, 700, 600, 500, 400, 300, 200, 300, 400, 500, 600, 700],\n            \"dSdt\": [2e-8, 1.5e-8, 1e-8, 5e-9, 0.0, -5e-9, -1e-8, -1.5e-8, -1e-8, -5e-9, 0.0, 5e-9],\n            \"pe_mode\": {\"base\": \"dSdt_only\", \"noise_amp\": 1e-9, \"noise_func\": \"cos12\"},\n        },\n        {\n            \"A\": 5.0e9,\n            \"Q\": [400, 500, 600, 700, 800, 900, 1000, 900, 800, 700, 600, 500],\n            \"dSdt\": [0.0] * 12,\n            \"pe_mode\": {\"base\": \"R_only\", \"noise_amp\": 2e-8, \"noise_func\": \"sin6\"},\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        res = compute_metrics(case[\"A\"], case[\"Q\"], case[\"dSdt\"], case[\"pe_mode\"])\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Ensure single-line output with comma-separated list enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}