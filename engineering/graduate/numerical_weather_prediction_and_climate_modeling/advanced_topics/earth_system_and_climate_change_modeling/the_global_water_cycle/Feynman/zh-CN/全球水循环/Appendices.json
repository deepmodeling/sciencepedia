{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的计算之前，理解水收支方程中各项的相对重要性至关重要。本练习使用尺度分析——流体动力学和气候科学中的一个强大工具——来探究在不同时间尺度上，局地水储量变化相对于地表通量的显著性。这项实践将帮助您建立直觉，判断何时可以对水汽收支进行简化，这是天气预报和气候分析中的一项关键技能。",
            "id": "4100545",
            "problem": "在数值天气预报（NWP）和气候模拟中，用于全球水循环的一個核心诊断量是整层大气水汽收支。该收支表明，整层水汽储存的局地变化趋势由地表淡水通量和水平水汽输送相平衡。考虑在高度或气压坐标系下的整层大气水汽收支，其示意性方程如下：\n$$\n\\partial_{t} W + \\nabla \\cdot \\mathbf{F} = E - P,\n$$\n其中，$W$ 是可降水量（整层积分的比湿，通过 $1\\,\\mathrm{kg}\\,\\mathrm{m}^{-2} \\equiv 1\\,\\mathrm{mm}$ 换算成毫米单位），$\\mathbf{F}$ 是垂直积分的水平水汽通量，$E$ 是从地表到大气的蒸发，$P$ 是从大气到地表的降水。在尺度分析中，局地储存变化趋势的量级在时间尺度 $\\tau$ 上估计为 $|\\partial_t W| \\sim W/\\tau$，而净地表淡水通量的量级表示为 $|E-P|$。\n\n从上述收支方程和定义出发，推导一个无量纲比率，用以量化在时间尺度 $\\tau$ 下，局地储存变化趋势相对于净地表淡水通量的重要性。然后，使用科学上合理且广泛使用的深热带和中纬度温带地区的特征量级，评估该比率在日、周和季节尺度上的应用：\n\n- 深热带地区：可降水量 $W_{\\mathrm{trop}} = 50$ mm；特征净地表淡水通量量级 $|E-P|_{\\mathrm{trop}} = 6$ mm day$^{-1}$。\n- 中纬度温带地区：可降水量 $W_{\\mathrm{extr}} = 20$ mm；特征净地表淡水通量量级 $|E-P|_{\\mathrm{extr}} = 3$ mm day$^{-1}$。\n\n使用时间尺度 $\\tau_{\\mathrm{day}} = 1$ 天，$\\tau_{\\mathrm{week}} = 7$ 天，以及 $\\tau_{\\mathrm{season}} = 90$ 天。按以下顺序报告六个无量纲比率：热带（日、周、季节），温带（日、周、季节）。所有答案均表示为无量纲数，并四舍五入至三位有效数字。最终报告值中不包含单位。",
            "solution": "本题要求推导一个无量纲比率，用以量化局地储存变化趋势相对于净地表淡水通量的重要性，然后为两种不同的气候区在三个不同的时间尺度上评估这个比率。\n\n设该无量纲比率为 $\\mathcal{R}$。根据定义，此比率是局地储存变化趋势项的量级除以净地表淡水通量项的量级。\n$$\n\\mathcal{R} = \\frac{|\\partial_t W|}{|E - P|}\n$$\n问题为局地储存变化趋势项的量级 $|\\partial_t W|$ 提供了一个在特征时间尺度 $\\tau$ 上的尺度分析近似：\n$$\n|\\partial_t W| \\sim \\frac{W}{\\tau}\n$$\n其中 $W$ 是可降水量的特征量级。净地表淡水通量的量级作为一个特征值 $|E - P|$ 给出。\n\n将尺度近似代入 $\\mathcal{R}$ 的定义，我们得到该无量纲比率的公式：\n$$\n\\mathcal{R} = \\frac{W / \\tau}{|E - P|} = \\frac{W}{\\tau |E - P|}\n$$\n我们可以验证这个比率确实是无量纲的。单位如下：\n-   $W$ 的单位是 mm。\n-   $\\tau$ 的单位是天 (day)。\n-   $|E - P|$ 的单位是 mm day$^{-1}$。\n因此，表达式的单位是 $\\frac{[\\text{mm}]}{[\\text{day}] \\times [\\text{mm day}^{-1}]} = \\frac{[\\text{mm}]}{[\\text{mm}]}$，这是无量纲的。推导的公式是正确的。\n\n现在，我们为六个指定情况计算这个比率，并将结果四舍五入到三位有效数字。\n\n**1. 深热带地区 ($W = W_{\\mathrm{trop}} = 50$ mm, $|E-P| = |E-P|_{\\mathrm{trop}} = 6$ mm day$^{-1}$)**\n\n-   **日时间尺度 ($\\tau = \\tau_{\\mathrm{day}} = 1$ 天):**\n    $$\n    \\mathcal{R}_{\\mathrm{trop, day}} = \\frac{50 \\text{ mm}}{(1 \\text{ day}) \\times (6 \\text{ mm day}^{-1})} = \\frac{50}{6} = \\frac{25}{3} \\approx 8.333... \\approx 8.33\n    $$\n\n-   **周时间尺度 ($\\tau = \\tau_{\\mathrm{week}} = 7$ 天):**\n    $$\n    \\mathcal{R}_{\\mathrm{trop, week}} = \\frac{50 \\text{ mm}}{(7 \\text{ days}) \\times (6 \\text{ mm day}^{-1})} = \\frac{50}{42} = \\frac{25}{21} \\approx 1.1904... \\approx 1.19\n    $$\n\n-   **季节时间尺度 ($\\tau = \\tau_{\\mathrm{season}} = 90$ 天):**\n    $$\n    \\mathcal{R}_{\\mathrm{trop, season}} = \\frac{50 \\text{ mm}}{(90 \\text{ days}) \\times (6 \\text{ mm day}^{-1})} = \\frac{50}{540} = \\frac{5}{54} \\approx 0.09259... \\approx 0.0926\n    $$\n\n**2. 中纬度温带地区 ($W = W_{\\mathrm{extr}} = 20$ mm, $|E-P| = |E-P|_{\\mathrm{extr}} = 3$ mm day$^{-1}$)**\n\n-   **日时间尺度 ($\\tau = \\tau_{\\mathrm{day}} = 1$ 天):**\n    $$\n    \\mathcal{R}_{\\mathrm{extr, day}} = \\frac{20 \\text{ mm}}{(1 \\text{ day}) \\times (3 \\text{ mm day}^{-1})} = \\frac{20}{3} \\approx 6.666... \\approx 6.67\n    $$\n\n-   **周时间尺度 ($\\tau = \\tau_{\\mathrm{week}} = 7$ 天):**\n    $$\n    \\mathcal{R}_{\\mathrm{extr, week}} = \\frac{20 \\text{ mm}}{(7 \\text{ days}) \\times (3 \\text{ mm day}^{-1})} = \\frac{20}{21} \\approx 0.95238... \\approx 0.952\n    $$\n\n-   **季节时间尺度 ($\\tau = \\tau_{\\mathrm{season}} = 90$ 天):**\n    $$\n    \\mathcal{R}_{\\mathrm{extr, season}} = \\frac{20 \\text{ mm}}{(90 \\text{ days}) \\times (3 \\text{ mm day}^{-1})} = \\frac{20}{270} = \\frac{2}{27} \\approx 0.07407... \\approx 0.0741\n    $$\n\n按要求的顺序——热带（日、周、季节），然后是温带（日、周、季节）——计算出的六个无量纲比率是：$8.33$、$1.19$、$0.0926$、$6.67$、$0.952$ 和 $0.0741$。这些结果表明，在日时间尺度上，大气水的局地储存是水汽收支中的主导项；在周时间尺度上，其量级与地表通量相当；而在季节时间尺度上，它是一个相对较小的项，此时水汽收支主要表现为水汽通量散度与净地表通量之间的平衡。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 8.33 & 1.19 & 0.0926 & 6.67 & 0.952 & 0.0741 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "来自陆地表面的蒸发和蒸腾（合称蒸散发）是水循环的关键组成部分，它将水和能量收支联系在一起。Penman-Monteith方程是水文学和气候模型中估算这些通量的基石。本练习将引导您推导并应用该方程，从而加深您对地表能量平衡、空气动力学阻力和植物生理控制（气孔阻力）如何共同决定水分返回大气速率的理解。",
            "id": "4100548",
            "problem": "一个水分充足的植被冠层通过感热通量和潜热通量与大气交换能量。考虑一个水平均匀的冠层，其可用能量为 $A$，并假设系统处于稳态，因此冠层能量平衡为 $A = H + \\lambda E$，其中 $H$ 是感热通量，$\\lambda E$ 是潜热通量。感热通量可以通过整体输送公式表示，其中空气动力学阻力为 $r_a$，即 $H = \\rho c_p g_a (T_s - T_a)$，这里 $\\rho$ 是空气密度，$c_p$ 是空气的定压比热容，$g_a = 1/r_a$ 是空气动力学导度，$T_s$ 是冠层表面温度，$T_a$ 是气温。设气孔阻力 $r_s$ 仅限制水汽路径，气孔导度为 $g_s = 1/r_s$，并假设热量和水汽的空气动力学阻力相同。冠层表面的水汽压近似为 $T_s$ 下的饱和水汽压，并在 $T_a$ 附近进行线性化，因此 $e_s - e_a \\approx D + \\Delta (T_s - T_a)$，其中 $e_s$ 是冠层表面的饱和水汽压，$e_a$ 是环境水汽压，$D$ 是环境水汽压亏缺，$\\Delta$ 是饱和水汽压曲线随温度变化的斜率。使用干湿表常数 $\\gamma$ 来关联恒压下的热量和质量传输。\n\n从这些物理陈述和定义出发，推导潜热通量 $\\lambda E$ 的表达式，该表达式应由 $A$、$\\Delta$、$\\gamma$、$\\rho$、$c_p$、$g_a$、$g_s$ 和 $D$ 表示，且不引入任何额外的经验公式。然后，使用以下数值计算水分充足冠层的 $\\lambda E$：$A = 400$ W m$^{-2}$，$\\Delta = 0.2$ kPa K$^{-1}$，$\\gamma = 0.066$ kPa K$^{-1}$，$r_a = 50$ s m$^{-1}$，$r_s = 100$ s m$^{-1}$，$D = 1$ kPa，$\\rho = 1.2$ kg m$^{-3}$，以及 $c_p = 1005$ J kg$^{-1}$ K$^{-1}$。将 $\\lambda E$ 的最终答案以 W m$^{-2}$ 为单位表示，并将结果四舍五入至四位有效数字。",
            "solution": "该问题要求推导潜热通量 $\\lambda E$ 的表达式，并随后进行数值计算。推导过程基于将能量平衡方程与感热和潜热通量的整体输送公式相结合。此过程得出了著名的 Penman-Monteith 方程。\n\n该物理系统由以下方程组描述：\n冠层表面的能量平衡由下式给出：\n$$ A = H + \\lambda E \\quad (1) $$\n其中 $A$ 是可用能量，$H$ 是感热通量，$\\lambda E$ 是潜热通量。\n\n感热通量由整体空气动力学公式定义：\n$$ H = \\rho c_p g_a (T_s - T_a) \\quad (2) $$\n其中 $\\rho$ 是空气密度，$c_p$ 是空气的定压比热容，$g_a = 1/r_a$ 是空气动力学导度，$T_s$ 是冠层表面温度，$T_a$ 是环境空气温度。\n\n潜热通量代表用于蒸散的能量，它由一个类似的整体输送公式描述。水汽输送的总阻力是空气动力学阻力 $r_a$ 和表面（气孔）阻力 $r_s$ 的和。使用干湿表常数 $\\gamma$ 将水汽压梯度与能量通量相关联，潜热通量由下式给出：\n$$ \\lambda E = \\frac{\\rho c_p}{\\gamma} \\frac{1}{r_a + r_s} (e_s - e_a) \\quad (3) $$\n其中 $e_s$ 是表面的水汽压，$e_a$ 是环境水汽压。\n\n表面水汽压 $e_s$ 被假定为表面温度 $T_s$ 下的饱和水汽压。水汽压差与温差之间的关系被线性化为：\n$$ e_s - e_a = D + \\Delta (T_s - T_a) \\quad (4) $$\n其中 $D$ 是环境水汽压亏缺，$\\Delta$ 是饱和水汽压曲线在环境温度下的斜率。\n\n推导的目的是找到一个不依赖于未知表面温度 $T_s$ 的 $\\lambda E$ 表达式。这可以通过组合以上方程来消去 $T_s$ 来实现。\n\n从方程($2$)，我们可以将表面-空气温差 $T_s - T_a$ 表示为：\n$$ T_s - T_a = \\frac{H}{\\rho c_p g_a} = \\frac{r_a H}{\\rho c_p} \\quad (5) $$\n\n接下来，我们重排方程($3$)并代入方程($4$)，以找到 $T_s - T_a$ 的另一个表达式：\n$$ \\lambda E = \\frac{\\rho c_p}{\\gamma (r_a + r_s)} [D + \\Delta (T_s - T_a)] $$\n求解 $T_s - T_a$：\n$$ \\frac{\\gamma \\lambda E (r_a + r_s)}{\\rho c_p} = D + \\Delta (T_s - T_a) $$\n$$ \\Delta (T_s - T_a) = \\frac{\\gamma \\lambda E (r_a + r_s)}{\\rho c_p} - D $$\n$$ T_s - T_a = \\frac{\\gamma \\lambda E (r_a + r_s)}{\\Delta \\rho c_p} - \\frac{D}{\\Delta} \\quad (6) $$\n\n现在，我们将方程($5$)和($6$)中 $T_s - T_a$ 的两个表达式相等：\n$$ \\frac{r_a H}{\\rho c_p} = \\frac{\\gamma \\lambda E (r_a + r_s)}{\\Delta \\rho c_p} - \\frac{D}{\\Delta} $$\n为了从分母中消去 $\\rho c_p$ 和 $\\Delta$，我们将整个方程乘以 $\\Delta \\rho c_p$：\n$$ \\Delta r_a H = \\gamma \\lambda E (r_a + r_s) - \\rho c_p D $$\n\n最后一步是使用能量平衡方程($1$)，$H = A - \\lambda E$，来消去 $H$：\n$$ \\Delta r_a (A - \\lambda E) = \\gamma \\lambda E (r_a + r_s) - \\rho c_p D $$\n展开各项：\n$$ \\Delta r_a A - \\Delta r_a \\lambda E = \\gamma r_a \\lambda E + \\gamma r_s \\lambda E - \\rho c_p D $$\n现在，我们将所有包含 $\\lambda E$ 的项归并到方程的一边：\n$$ \\Delta r_a A + \\rho c_p D = \\Delta r_a \\lambda E + \\gamma r_a \\lambda E + \\gamma r_s \\lambda E $$\n$$ \\Delta r_a A + \\rho c_p D = \\lambda E (\\Delta r_a + \\gamma r_a + \\gamma r_s) $$\n$$ \\Delta r_a A + \\rho c_p D = \\lambda E [\\Delta r_a + \\gamma (r_a + r_s)] $$\n\n最后，求解 $\\lambda E$：\n$$ \\lambda E = \\frac{\\Delta r_a A + \\rho c_p D}{\\Delta r_a + \\gamma (r_a + r_s)} $$\n为按要求用导度 $g_a = 1/r_a$ 和 $g_s = 1/r_s$ 表示，我们可以将分子和分母同除以 $r_a$：\n$$ \\lambda E = \\frac{\\Delta A + \\frac{\\rho c_p D}{r_a}}{\\Delta + \\gamma \\frac{r_a+r_s}{r_a}} $$\n代入 $1/r_a = g_a$ 和 $(r_a+r_s)/r_a = 1 + r_s/r_a = 1 + g_a/g_s$：\n$$ \\lambda E = \\frac{\\Delta A + \\rho c_p D g_a}{\\Delta + \\gamma (1 + g_a/g_s)} $$\n这就是推导出的潜热通量表达式。\n\n现在，我们使用给定的数值来计算这个表达式：\n-   可用能量, $A = 400 \\text{ W m}^{-2}$\n-   饱和水汽压曲线斜率, $\\Delta = 0.2 \\text{ kPa K}^{-1}$\n-   干湿表常数, $\\gamma = 0.066 \\text{ kPa K}^{-1}$\n-   空气动力学阻力, $r_a = 50 \\text{ s m}^{-1}$\n-   气孔阻力, $r_s = 100 \\text{ s m}^{-1}$\n-   水汽压亏缺, $D = 1 \\text{ kPa}$\n-   空气密度, $\\rho = 1.2 \\text{ kg m}^{-3}$\n-   空气比热, $c_p = 1005 \\text{ J kg}^{-1} \\text{ K}^{-1}$\n\n首先，我们计算导度：\n空气动力学导度, $g_a = 1/r_a = 1/50 \\text{ m s}^{-1} = 0.02 \\text{ m s}^{-1}$。\n气孔导度, $g_s = 1/r_s = 1/100 \\text{ m s}^{-1} = 0.01 \\text{ m s}^{-1}$。\n\n接下来，我们计算 $\\lambda E$ 表达式的分子和分母。\n\n分子 = $\\Delta A + \\rho c_p D g_a$\n$$ \\text{分子} = (0.2 \\text{ kPa K}^{-1})(400 \\text{ W m}^{-2}) + (1.2 \\text{ kg m}^{-3})(1005 \\text{ J kg}^{-1} \\text{ K}^{-1})(1 \\text{ kPa})(0.02 \\text{ m s}^{-1}) $$\n$$ \\text{分子} = 80 \\text{ W m}^{-2} \\text{kPa K}^{-1} + 24.12 \\text{ J s}^{-1} \\text{m}^{-2} \\text{kPa K}^{-1} $$\n由于 $1 \\text{ J s}^{-1} = 1 \\text{ W}$，单位是一致的。\n$$ \\text{分子} = 80 + 24.12 = 104.12 \\text{ W m}^{-2} \\text{kPa K}^{-1} $$\n\n分母 = $\\Delta + \\gamma (1 + g_a/g_s)$\n$$ \\text{分母} = 0.2 \\text{ kPa K}^{-1} + (0.066 \\text{ kPa K}^{-1})(1 + \\frac{0.02 \\text{ m s}^{-1}}{0.01 \\text{ m s}^{-1}}) $$\n$$ \\text{分母} = 0.2 \\text{ kPa K}^{-1} + (0.066 \\text{ kPa K}^{-1})(1 + 2) $$\n$$ \\text{分母} = 0.2 + 3 \\times 0.066 = 0.2 + 0.198 = 0.398 \\text{ kPa K}^{-1} $$\n\n最后，我们通过将分子除以分母来计算 $\\lambda E$：\n$$ \\lambda E = \\frac{104.12 \\text{ W m}^{-2} \\text{kPa K}^{-1}}{0.398 \\text{ kPa K}^{-1}} $$\n$$ \\lambda E = 261.60804... \\text{ W m}^{-2} $$\n\n按要求将结果四舍五入到四位有效数字：\n$$ \\lambda E \\approx 261.6 \\text{ W m}^{-2} $$\n最终答案是 $261.6$。",
            "answer": "$$\n\\boxed{261.6}\n$$"
        },
        {
            "introduction": "本练习将水循环的多个组成部分整合到一个实际的、数据驱动的分析中。您将扮演一名水文学家或气候科学家的角色，通过与陆地观测（河流流量和储量变化）进行比较，评估大气数据（来自再分析产品）在多大程度上实现了流域水收支的闭合。通过实施收支闭合计算，您将获得一项基本验证技术的实践经验，该技术用于评估气候模型和观测数据集的质量。",
            "id": "4100556",
            "problem": "您的任务是开发一个完整的、可运行的程序，用于在数值天气预报（NWP）和气候模拟的背景下，评估全球水循环（GWC）中流域尺度的水量平衡闭合情况。其支配物理原理是控制体的质量守恒：在河流流域中，大气的净输入和地表损失必须与陆地水储量的变化以及通过其出水口离开流域的体积流量相一致。从质量守恒定律以及经过充分检验的水文事实和定义出发，您的程序必须为几个测试案例计算闭合残差时间序列和汇总统计数据，以量化观测流量衍生的水量平衡与大气再分析估计的降水量减去蒸发量之间的一致性。大气再分析（此处首次定义）是一种数据同化产品，它重建了过去的大气状态，包括降水和蒸发场。\n\n定义和约定：\n- 令 $A$ 表示流域面积，单位为 $\\mathrm{m^2}$。\n- 令 $Q(t)$ 表示流域出水口的观测河流流量，单位为 $\\mathrm{m^3/s}$。\n- 令 $P(t)$ 表示降水量，单位为 $\\mathrm{m/s}$。\n- 令 $E(t)$ 表示蒸发量，单位为 $\\mathrm{m/s}$。\n- 令 $S(t)$ 表示垂直积分的陆地水储量（土壤湿度、雪、地下水、地表水），单位为 $\\mathrm{m}$，因此 $\\frac{dS}{dt}(t)$ 的单位为 $\\mathrm{m/s}$。\n- 令 $(P - E)_{\\mathrm{rean}}(t)$ 表示来自大气再分析的降水量减去蒸发量，单位为 $\\mathrm{m/s}$。\n- 假设只有一个主要出水口，且跨流域边界的侧向地下水交换可忽略不计，因此在流域上积分的径流量等于出水口流量，流域平均径流 $R(t)$（单位为 $\\mathrm{m/s}$）满足 $R(t) = \\frac{Q(t)}{A}$。\n\n您的任务是：\n1. 从质量守恒推导出连接 $P(t)$、$E(t)$、$R(t)$ 和 $\\frac{dS}{dt}(t)$ 的流域水量平衡关系，并用它来定义一个闭合残差时间序列 $\\varepsilon(t)$，该序列比较 $(P - E)_{\\mathrm{rean}}(t)$ 和流量衍生的水量平衡。\n2. 实现一个算法，为每个测试案例的时间序列计算：\n   - 在所有给定时间内的闭合残差 $\\varepsilon(t)$，单位为 $\\mathrm{m/s}$。\n   - 平均偏差 $b = \\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t)$，单位为 $\\mathrm{m/s}$。\n   - 均方根误差 $\\mathrm{RMSE} = \\sqrt{\\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t)^2}$，单位为 $\\mathrm{m/s}$。\n   - $(P - E)_{\\mathrm{rean}}(t)$ 和 $R(t) + \\frac{dS}{dt}(t)$ 之间的皮尔逊（Pearson）相关系数 $\\rho$（无量纲）。如果任一序列的方差为零，按惯例定义 $\\rho = 0$。\n   - 一个布尔标志，指示闭合是否令人满意，定义为 $\\mathrm{RMSE} \\le \\tau$，阈值 $\\tau = 1\\times 10^{-8}\\ \\mathrm{m/s}$。\n3. 所有物理量均以国际单位制（SI）表示。与时间序列综合构建相关的角度（如适用）必须以弧度为单位。输出的统计量 $b$、$\\mathrm{RMSE}$ 和 $\\rho$ 必须是浮点数；闭合标志必须是布尔值。\n\n测试套件规范：\n对于每个案例，您将获得作为长度为 $N = 12$ 的月度时间序列的 $A$、$Q(t)$ 和 $\\frac{dS}{dt}(t)$。$(P - E)_{\\mathrm{rean}}(t)$ 序列将使用指定的基础值和一个加性谐波噪声项从这些场构建。对于月份索引 $t \\in \\{1,2,\\dots,12\\}$，将噪声定义为 $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$ 或 $\\eta(t) = \\alpha \\sin\\!\\left(\\frac{2\\pi t}{6}\\right)$，每个案例给定振幅 $\\alpha$（角度以弧度为单位）。\n\n- 案例1（理想情况，微小不匹配）：\n  - 流域面积：$A = 1.2 \\times 10^{11}\\ \\mathrm{m^2}$。\n  - 流量时间序列 $Q(t)$（单位 $\\mathrm{m^3/s}$），对于 $t=1,\\dots,12$：$[14000, 13000, 12000, 11000, 10000, 9000, 8000, 7500, 8000, 9000, 10000, 12000]$。\n  - 储量变化时间序列 $\\frac{dS}{dt}(t)$（单位 $\\mathrm{m/s}$）：$[-2\\times 10^{-8}, -1.5\\times 10^{-8}, -1\\times 10^{-8}, -5\\times 10^{-9}, 1\\times 10^{-9}, 5\\times 10^{-9}, 1\\times 10^{-8}, 1.5\\times 10^{-8}, 1\\times 10^{-8}, 5\\times 10^{-9}, 0, -1\\times 10^{-8}]$。\n  - 将 $(P - E)_{\\mathrm{rean}}(t)$ 构建为基础值 $R(t) + \\frac{dS}{dt}(t)$ 加上噪声 $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$，其中 $\\alpha = 5\\times 10^{-9}$。\n\n- 案例2（边界情况，储量变化为零）：\n  - 流域面积：$A = 8.0 \\times 10^{10}\\ \\mathrm{m^2}$。\n  - 流量 $Q(t)$（单位 $\\mathrm{m^3/s}$）：$[5000, 6000, 7000, 8000, 9000, 10000, 11000, 10000, 9000, 8000, 7000, 6000]$。\n  - 储量变化 $\\frac{dS}{dt}(t)$（单位 $\\mathrm{m/s}$）：$[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]$。\n  - 将 $(P - E)_{\\mathrm{rean}}(t)$ 构建为基础值 $R(t)$，噪声为零 $\\alpha = 0$。\n\n- 案例3（边缘情况，大气输入被储存的低流量情景）：\n  - 流域面积：$A = 1.5 \\times 10^{11}\\ \\mathrm{m^2}$。\n  - 流量 $Q(t)$（单位 $\\mathrm{m^3/s}$）：$[800, 700, 600, 500, 400, 300, 200, 300, 400, 500, 600, 700]$。\n  - 储量变化 $\\frac{dS}{dt}(t)$（单位 $\\mathrm{m/s}$）：$[2\\times 10^{-8}, 1.5\\times 10^{-8}, 1\\times 10^{-8}, 5\\times 10^{-9}, 0, -5\\times 10^{-9}, -1\\times 10^{-8}, -1.5\\times 10^{-8}, -1\\times 10^{-8}, -5\\times 10^{-9}, 0, 5\\times 10^{-9}]$。\n  - 将 $(P - E)_{\\mathrm{rean}}(t)$ 构建为基础值 $\\frac{dS}{dt}(t)$ 加上噪声 $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$，其中 $\\alpha = 1\\times 10^{-9}$。\n\n- 案例4（边缘情况，具有较大不匹配的小型流域）：\n  - 流域面积：$A = 5.0 \\times 10^{9}\\ \\mathrm{m^2}$。\n  - 流量 $Q(t)$（单位 $\\mathrm{m^3/s}$）：$[400, 500, 600, 700, 800, 900, 1000, 900, 800, 700, 600, 500]$。\n  - 储量变化 $\\frac{dS}{dt}(t)$（单位 $\\mathrm{m/s}$）：$[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]$。\n  - 将 $(P - E)_{\\mathrm{rean}}(t)$ 构建为基础值 $R(t)$ 加上噪声 $\\eta(t) = \\alpha \\sin\\!\\left(\\frac{2\\pi t}{6}\\right)$，其中 $\\alpha = 2\\times 10^{-8}$。\n\n算法要求：\n- 对于每个案例，计算 $R(t) = \\frac{Q(t)}{A}$，单位为 $\\mathrm{m/s}$。\n- 使用指定的构建规则生成 $(P - E)_{\\mathrm{rean}}(t)$。\n- 通过比较 $(P - E)_{\\mathrm{rean}}(t)$ 与流量衍生的水量平衡来定义闭合残差 $\\varepsilon(t)$。用它来计算 $b$、$\\mathrm{RMSE}$ 和 $\\rho$。\n- 如果 $\\mathrm{RMSE} \\le \\tau$ 且 $\\tau = 1\\times 10^{-8}\\ \\mathrm{m/s}$，则判定闭合令人满意。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试案例贡献一个形如 $[b,\\ \\mathrm{RMSE},\\ \\rho,\\ \\mathrm{pass}]$ 的子列表，其中 $b$、$\\mathrm{RMSE}$ 和 $\\rho$ 是浮点数，$\\mathrm{pass}$ 是布尔值。例如，最后一行应类似于 $[[b_1,\\mathrm{RMSE}_1,\\rho_1,\\mathrm{pass}_1],[b_2,\\mathrm{RMSE}_2,\\rho_2,\\mathrm{pass}_2],[b_3,\\mathrm{RMSE}_3,\\rho_3,\\mathrm{pass}_3],[b_4,\\mathrm{RMSE}_4,\\rho_4,\\mathrm{pass}_4]]$。",
            "solution": "我们的推导基于代表固定面积河流流域的控制体的质量守恒。令控制体为具有空间域 $\\Omega$ 和面积 $A$ 的流域。垂直积分的水储量为 $S(t)$（单位 $\\mathrm{m}$），表示单位面积的总水量。流域平均水含量的质量守恒（连续性）可以表示为\n$$\n\\frac{dS}{dt}(t) = P(t) - E(t) - R(t),\n$$\n其中 $P(t)$ 是来自大气的降水输入（单位 $\\mathrm{m/s}$），$E(t)$ 是向大气的蒸发损失（单位 $\\mathrm{m/s}$），$R(t)$ 是通过流域边界（主要是河流出水口）流出的流域平均径流（单位 $\\mathrm{m/s}$）。这一陈述依赖于标准的水文假设：在所关注的时间尺度上，相对于出水口流量，跨边界的侧向地下水交换可忽略不计，且只有一个主要出水口。\n\n对于单出水口流域，一个经过充分检验的水文恒等式将空间积分的径流量与出水口流量等同起来。如果 $Q(t)$ 是出水口的体积流量（单位 $\\mathrm{m^3/s}$），那么流域平均径流（单位 $\\mathrm{m/s}$）是\n$$\nR(t) = \\frac{Q(t)}{A}.\n$$\n将其代入连续性方程并重新整理，得到大气通量与陆地项之间的关系：\n$$\nP(t) - E(t) = R(t) + \\frac{dS}{dt}(t) = \\frac{Q(t)}{A} + \\frac{dS}{dt}(t).\n$$\n大气再分析提供了 $(P - E)_{\\mathrm{rean}}(t)$（单位 $\\mathrm{m/s}$），在理想情况下，当在流域上平均时，它应满足上述关系。因此，量化不匹配的闭合残差定义为\n$$\n\\varepsilon(t) = (P - E)_{\\mathrm{rean}}(t) - \\left(\\frac{Q(t)}{A} + \\frac{dS}{dt}(t)\\right).\n$$\n如果再分析和观测值使水量平衡闭合，则 $\\varepsilon(t)$ 应接近于零。\n\n为总结时间序列 $t=1,\\dots,N$（其中 $N=12$ 个月）的差异，计算：\n- 平均偏差：\n$$\nb = \\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t),\n$$\n单位为 $\\mathrm{m/s}$。\n- 均方根误差：\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N}\\sum_{t=1}^N \\varepsilon(t)^2},\n$$\n单位为 $\\mathrm{m/s}$。\n- 再分析的大气输入与流量衍生的水量平衡之间的皮尔逊（Pearson）相关系数：\n$$\n\\rho = \\mathrm{corr}\\left((P - E)_{\\mathrm{rean}}(t),\\ \\frac{Q(t)}{A} + \\frac{dS}{dt}(t)\\right),\n$$\n此值无量纲。如果任一序列的方差为零，按惯例定义 $\\rho = 0$，以避免未定义的行为。\n\n对于闭合评估，使用一个具有物理意义的小阈值 $\\tau$（单位 $\\mathrm{m/s}$）来判断不匹配是否在可接受的小范围内。我们设定\n$$\n\\tau = 1\\times 10^{-8}\\ \\mathrm{m/s},\n$$\n并将布尔闭合标志定义为 $\\mathrm{pass} = \\left(\\mathrm{RMSE} \\le \\tau\\right)$。\n\n算法实现细节：\n1. 对于每个案例，读取 $A$（单位 $\\mathrm{m^2}$）、列表 $Q(t)$（单位 $\\mathrm{m^3/s}$）和列表 $\\frac{dS}{dt}(t)$（单位 $\\mathrm{m/s}$），每个列表长度为 $N=12$ 个月。\n2. 逐元素计算 $R(t) = \\frac{Q(t)}{A}$，得到一个单位为 $\\mathrm{m/s}$ 的时间序列。\n3. 按案例构建 $(P - E)_{\\mathrm{rean}}(t)$：\n   - 案例 1：基础值 $R(t) + \\frac{dS}{dt}(t)$ 加上谐波噪声 $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$，其中 $\\alpha = 5\\times 10^{-9}$ 且 $t$ 以弧度为单位。\n   - 案例 2：基础值 $R(t)$ 且 $\\alpha = 0$。\n   - 案例 3：基础值 $\\frac{dS}{dt}(t)$ 加上噪声 $\\eta(t) = \\alpha \\cos\\!\\left(\\frac{2\\pi t}{12}\\right)$，其中 $\\alpha = 1\\times 10^{-9}$。\n   - 案例 4：基础值 $R(t)$ 加上噪声 $\\eta(t) = \\alpha \\sin\\!\\left(\\frac{2\\pi t}{6}\\right)$，其中 $\\alpha = 2\\times 10^{-8}$。\n4. 如上计算闭合残差 $\\varepsilon(t)$，然后计算 $b$、$\\mathrm{RMSE}$ 和 $\\rho$。使用一个稳健的相关性计算方法，当任一时间序列的方差为零时，返回 $\\rho = 0$。\n5. 比较 $\\mathrm{RMSE}$ 和 $\\tau$ 以设置 $\\mathrm{pass}$。\n6. 将结果汇总为所需的最终输出格式：表示一个包含四个子列表的列表的单行字符串，每个子列表对应一个案例，格式为 $[b,\\ \\mathrm{RMSE},\\ \\rho,\\ \\mathrm{pass}]$。\n\n科学真实性和数值稳健性：\n- 所使用的量级对于中到大型流域是合理的：例如，$Q$ 的数量级为 $10^3$ 到 $10^4\\ \\mathrm{m^3/s}$，$A$ 的数量级为 $10^{10}$ 到 $10^{11}\\ \\mathrm{m^2}$，得出的 $R = \\frac{Q}{A}$ 的数量级为 $10^{-8}$ 到 $10^{-7}\\ \\mathrm{m/s}$，这与典型的流域平均通量（毫米/天尺度）一致。\n- 储量变化序列 $\\frac{dS}{dt}(t)$ 在 $10^{-9}$ 到 $10^{-8}\\ \\mathrm{m/s}$ 范围内，与观测到的季节性陆地水储量变化一致。\n- 谐波噪声项代表了再分析产品中经常存在的时空不匹配和模型误差。\n\n该程序将实现此逻辑并打印所需的单行输出，包含所有四个测试案例的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef safe_corr(x: np.ndarray, y: np.ndarray) -> float:\n    \"\"\"Compute Pearson correlation if both series have non-zero variance; else return 0.0.\"\"\"\n    x = np.asarray(x, dtype=float)\n    y = np.asarray(y, dtype=float)\n    sx = np.std(x)\n    sy = np.std(y)\n    if sx == 0.0 or sy == 0.0:\n        return 0.0\n    return float(np.corrcoef(x, y)[0, 1])\n\ndef compute_metrics(A, Q, dSdt, pe_mode):\n    \"\"\"\n    Compute closure residual metrics:\n    - A: basin area (m^2)\n    - Q: array of discharge (m^3/s)\n    - dSdt: array of storage change (m/s)\n    - pe_mode: dict controlling construction of reanalysis P-E\n        keys:\n          'base': 'R_plus_dSdt', 'R_only', or 'dSdt_only'\n          'noise_amp': float amplitude (m/s)\n          'noise_func': 'cos12' or 'sin6'\n    Returns: [mean_bias, rmse, corr, pass_bool]\n    \"\"\"\n    Q = np.asarray(Q, dtype=float)\n    dSdt = np.asarray(dSdt, dtype=float)\n    # Compute basin-mean runoff R = Q/A (m/s)\n    R = Q / float(A)\n\n    # Build base series for reanalysis P-E\n    base_choice = pe_mode.get('base', 'R_plus_dSdt')\n    if base_choice == 'R_plus_dSdt':\n        base = R + dSdt\n    elif base_choice == 'R_only':\n        base = R\n    elif base_choice == 'dSdt_only':\n        base = dSdt\n    else:\n        raise ValueError(\"Invalid base choice for P-E construction.\")\n\n    # Harmonic noise (angles in radians)\n    N = len(Q)\n    t = np.arange(1, N + 1, dtype=float)\n    amp = float(pe_mode.get('noise_amp', 0.0))\n    nf = pe_mode.get('noise_func', 'cos12')\n    if amp == 0.0:\n        noise = np.zeros_like(base)\n    else:\n        if nf == 'cos12':\n            noise = amp * np.cos(2.0 * np.pi * t / 12.0)\n        elif nf == 'sin6':\n            noise = amp * np.sin(2.0 * np.pi * t / 6.0)\n        else:\n            raise ValueError(\"Invalid noise function for P-E construction.\")\n\n    pe_rean = base + noise\n\n    # Closure residual: epsilon = (P-E)_rean - (R + dSdt)\n    epsilon = pe_rean - (R + dSdt)\n\n    # Metrics\n    mean_bias = float(np.mean(epsilon))\n    rmse = float(np.sqrt(np.mean(epsilon ** 2)))\n    corr = safe_corr(pe_rean, (R + dSdt))\n\n    # Closure pass criterion: RMSE = tau\n    tau = 1e-8  # m/s\n    closure_pass = rmse = tau\n\n    return [mean_bias, rmse, corr, closure_pass]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"A\": 1.2e11,\n            \"Q\": [14000, 13000, 12000, 11000, 10000, 9000, 8000, 7500, 8000, 9000, 10000, 12000],\n            \"dSdt\": [-2e-8, -1.5e-8, -1e-8, -5e-9, 1e-9, 5e-9, 1e-8, 1.5e-8, 1e-8, 5e-9, 0.0, -1e-8],\n            \"pe_mode\": {\"base\": \"R_plus_dSdt\", \"noise_amp\": 5e-9, \"noise_func\": \"cos12\"},\n        },\n        {\n            \"A\": 8.0e10,\n            \"Q\": [5000, 6000, 7000, 8000, 9000, 10000, 11000, 10000, 9000, 8000, 7000, 6000],\n            \"dSdt\": [0.0] * 12,\n            \"pe_mode\": {\"base\": \"R_only\", \"noise_amp\": 0.0, \"noise_func\": \"cos12\"},\n        },\n        {\n            \"A\": 1.5e11,\n            \"Q\": [800, 700, 600, 500, 400, 300, 200, 300, 400, 500, 600, 700],\n            \"dSdt\": [2e-8, 1.5e-8, 1e-8, 5e-9, 0.0, -5e-9, -1e-8, -1.5e-8, -1e-8, -5e-9, 0.0, 5e-9],\n            \"pe_mode\": {\"base\": \"dSdt_only\", \"noise_amp\": 1e-9, \"noise_func\": \"cos12\"},\n        },\n        {\n            \"A\": 5.0e9,\n            \"Q\": [400, 500, 600, 700, 800, 900, 1000, 900, 800, 700, 600, 500],\n            \"dSdt\": [0.0] * 12,\n            \"pe_mode\": {\"base\": \"R_only\", \"noise_amp\": 2e-8, \"noise_func\": \"sin6\"},\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        res = compute_metrics(case[\"A\"], case[\"Q\"], case[\"dSdt\"], case[\"pe_mode\"])\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Ensure single-line output with comma-separated list enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}