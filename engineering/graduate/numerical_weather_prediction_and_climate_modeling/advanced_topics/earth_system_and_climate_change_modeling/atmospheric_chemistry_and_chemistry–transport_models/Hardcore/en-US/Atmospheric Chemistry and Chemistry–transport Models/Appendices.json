{
    "hands_on_practices": [
        {
            "introduction": "In building a Chemistry-Transport Model (CTM), a fundamental task is to accurately simulate the movement of chemical species by the wind, a process known as advection. While many sophisticated numerical schemes exist, the first-order upwind scheme is often used for its simplicity and stability. This exercise reveals that this simplicity has a hidden cost: the scheme introduces an artificial damping effect that acts like physical diffusion, a phenomenon called numerical diffusion. By analyzing how the scheme affects a simple wave, you will derive this effective diffusion coefficient and gain a crucial insight into how numerical discretization can alter the physical behavior of a model .",
            "id": "4013330",
            "problem": "A one-dimensional tracer mixing ratio $q(x,t)$ transported by a constant zonal wind $u>0$ is evolved on a uniform Eulerian grid in a Chemistry–Transport Model (CTM) used within Numerical Weather Prediction (NWP) and climate modeling. The governing continuous equation is the linear advection equation $ \\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} = 0 $. The grid has spacing $\\Delta x$ and the time step is $\\Delta t$, and the Courant number (defined as $C \\equiv \\frac{u \\Delta t}{\\Delta x}$) satisfies $0<C\\leq 1$. The numerical scheme is the first-order upwind discretization for $u>0$,\n$$\nq_{i}^{n+1} = q_{i}^{n} - C \\left(q_{i}^{n} - q_{i-1}^{n}\\right),\n$$\nwhere $q_{i}^{n}$ denotes the grid value at index $i$ and time level $n$.\n\nConsider a single Fourier mode $q_{i}^{n} = \\Re\\{\\hat{q}^{\\,n} \\exp(i k x_{i})\\}$ with physical wavenumber $k$ and grid point locations $x_{i}=i\\,\\Delta x$. Using only first principles and the definitions provided above, determine the amplitude damping of this mode under one time step of the numerical scheme and, by matching that damping to the amplitude decay of the diffusion equation $ \\frac{\\partial q}{\\partial t} = \\kappa_{\\mathrm{eff}} \\frac{\\partial^{2} q}{\\partial x^{2}} $ applied to the same Fourier mode, derive the effective diffusion coefficient $\\kappa_{\\mathrm{eff}}$ of the upwind advection scheme in the long-wave limit $k \\Delta x \\ll 1$.\n\nYour final answer must be a single closed-form analytic expression for $\\kappa_{\\mathrm{eff}}$ expressed in terms of $u$, $\\Delta x$, and $C$. Express $\\kappa_{\\mathrm{eff}}$ in $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$. Do not provide intermediate equations as your final answer. No numerical evaluation is required.",
            "solution": "The problem requires the derivation of the effective diffusion coefficient, $\\kappa_{\\mathrm{eff}}$, for the first-order upwind numerical advection scheme. The derivation proceeds by analyzing the amplification and damping of a single Fourier mode by the numerical scheme and equating its leading-order damping term to the damping produced by a physical diffusion process over a single time step, $\\Delta t$, in the long-wave limit ($k \\Delta x \\ll 1$).\n\nFirst, we analyze the effect of the numerical scheme on a single Fourier mode. The scheme is given by:\n$$\nq_{i}^{n+1} = q_{i}^{n} - C \\left(q_{i}^{n} - q_{i-1}^{n}\\right)\n$$\nwhere $C = \\frac{u \\Delta t}{\\Delta x}$ is the Courant number. We consider a single complex Fourier mode $q_{i}^{n} = \\hat{q}^{\\,n} \\exp(i k x_{i})$, where $x_i = i \\Delta x$. Substituting this ansätz into the numerical scheme gives:\n$$\n\\hat{q}^{\\,n+1} \\exp(i k x_i) = \\hat{q}^{\\,n} \\exp(i k x_i) - C \\left( \\hat{q}^{\\,n} \\exp(i k x_i) - \\hat{q}^{\\,n} \\exp(i k x_{i-1}) \\right)\n$$\nUsing $x_{i-1} = (i-1) \\Delta x = x_i - \\Delta x$, we have $\\exp(i k x_{i-1}) = \\exp(i k (x_i - \\Delta x)) = \\exp(i k x_i) \\exp(-i k \\Delta x)$. Substituting this and dividing the entire equation by $\\hat{q}^{\\,n} \\exp(i k x_i)$ (assuming $\\hat{q}^{\\,n} \\neq 0$), we obtain the expression for the amplification factor $G_k \\equiv \\frac{\\hat{q}^{\\,n+1}}{\\hat{q}^{\\,n}}$:\n$$\nG_k = 1 - C (1 - \\exp(-i k \\Delta x)) = 1 - C + C \\exp(-i k \\Delta x)\n$$\nThe problem specifies the long-wave limit, which corresponds to $k \\Delta x \\ll 1$. Let $\\theta = k \\Delta x$. We can expand the exponential term $\\exp(-i \\theta)$ in a Taylor series for small $\\theta$:\n$$\n\\exp(-i \\theta) = 1 - i\\theta - \\frac{\\theta^2}{2} + i\\frac{\\theta^3}{6} + \\mathcal{O}(\\theta^4)\n$$\nSubstituting this into the expression for $G_k$:\n$$\nG_k = 1 - C + C \\left(1 - i\\theta - \\frac{\\theta^2}{2} + \\mathcal{O}(\\theta^3) \\right) = 1 - i C \\theta - C \\frac{\\theta^2}{2} + \\mathcal{O}(\\theta^3)\n$$\nThe amplitude of the wave after one time step is modified by the modulus of the amplification factor, $|G_k|$. We compute $|G_k|^2$:\n$$\n|G_k|^2 = G_k G_k^* = \\left(1 - C \\frac{\\theta^2}{2} - i C \\theta \\right) \\left(1 - C \\frac{\\theta^2}{2} + i C \\theta \\right) + \\mathcal{O}(\\theta^4)\n$$\n$$\n|G_k|^2 = \\left(1 - C \\frac{\\theta^2}{2}\\right)^2 + (C\\theta)^2 + \\mathcal{O}(\\theta^4) = 1 - C\\theta^2 + \\frac{C^2\\theta^4}{4} + C^2\\theta^2 + \\mathcal{O}(\\theta^4)\n$$\n$$\n|G_k|^2 = 1 - C(1-C)\\theta^2 + \\mathcal{O}(\\theta^4)\n$$\nTaking the square root and using the approximation $\\sqrt{1-x} \\approx 1-x/2$ for small $x$:\n$$\n|G_k| = \\sqrt{1 - C(1-C)\\theta^2 + \\mathcal{O}(\\theta^4)} \\approx 1 - \\frac{1}{2}C(1-C)\\theta^2 = 1 - \\frac{1}{2}C(1-C)(k \\Delta x)^2\n$$\nThis expression describes the amplitude damping factor of the numerical scheme for one time step in the long-wave limit.\n\nNext, we analyze the amplitude decay for the diffusion equation $\\frac{\\partial q}{\\partial t} = \\kappa_{\\mathrm{eff}} \\frac{\\partial^{2} q}{\\partial x^{2}}$. We substitute the same Fourier mode ansätz, $q(x,t) = \\hat{q}(t) \\exp(i k x)$, into this equation:\n$$\n\\frac{d\\hat{q}(t)}{dt} \\exp(ikx) = \\kappa_{\\mathrm{eff}} \\hat{q}(t) (ik)^2 \\exp(ikx)\n$$\n$$\n\\frac{d\\hat{q}(t)}{dt} = -k^2 \\kappa_{\\mathrm{eff}} \\hat{q}(t)\n$$\nThis is a first-order linear ordinary differential equation for the amplitude $\\hat{q}(t)$. Its solution is:\n$$\n\\hat{q}(t) = \\hat{q}(0) \\exp(-k^2 \\kappa_{\\mathrm{eff}} t)\n$$\nThe amplitude after a single time step $\\Delta t$ is $\\hat{q}(\\Delta t) = \\hat{q}(0) \\exp(-k^2 \\kappa_{\\mathrm{eff}} \\Delta t)$. The amplitude decay factor is the modulus $|\\exp(-k^2 \\kappa_{\\mathrm{eff}} \\Delta t)| = \\exp(-k^2 \\kappa_{\\mathrm{eff}} \\Delta t)$, since $k$, $\\kappa_{\\mathrm{eff}}$, and $\\Delta t$ are real and non-negative. For a small time step, we can expand the exponential:\n$$\n\\exp(-k^2 \\kappa_{\\mathrm{eff}} \\Delta t) \\approx 1 - k^2 \\kappa_{\\mathrm{eff}} \\Delta t\n$$\nNow, we match the amplitude damping from the numerical scheme to the amplitude decay from the physical diffusion process. Equating the two factors:\n$$\n1 - \\frac{1}{2}C(1-C)(k \\Delta x)^2 = 1 - k^2 \\kappa_{\\mathrm{eff}} \\Delta t\n$$\n$$\n\\frac{1}{2}C(1-C)(k \\Delta x)^2 = k^2 \\kappa_{\\mathrm{eff}} \\Delta t\n$$\nAssuming $k \\neq 0$, we can divide by $k^2$ and solve for $\\kappa_{\\mathrm{eff}}$:\n$$\n\\kappa_{\\mathrm{eff}} = \\frac{C(1-C)(\\Delta x)^2}{2 \\Delta t}\n$$\nThe problem requires the final answer to be expressed in terms of $u$, $\\Delta x$, and $C$. We use the definition of the Courant number, $C = \\frac{u \\Delta t}{\\Delta x}$, to eliminate $\\Delta t$. Rearranging this definition gives $\\frac{1}{\\Delta t} = \\frac{u}{C \\Delta x}$. Substituting this into the expression for $\\kappa_{\\mathrm{eff}}$:\n$$\n\\kappa_{\\mathrm{eff}} = \\frac{C(1-C)(\\Delta x)^2}{2} \\left(\\frac{u}{C \\Delta x}\\right)\n$$\n$$\n\\kappa_{\\mathrm{eff}} = \\frac{u \\Delta x (1 - C)}{2}\n$$\nThis is the effective diffusion coefficient of the first-order upwind scheme. This artificial diffusion is a leading-order truncation error of the scheme and is responsible for damping short waves. The units are $(\\mathrm{m}\\,\\mathrm{s}^{-1})(\\mathrm{m}) = \\mathrm{m}^2\\,\\mathrm{s}^{-1}$, which are the correct units for a diffusion coefficient.",
            "answer": "$$\n\\boxed{\\frac{u \\Delta x (1 - C)}{2}}\n$$"
        },
        {
            "introduction": "Real-world CTMs must simulate multiple interacting processes, such as transport and chemical reactions, simultaneously. A common and practical technique to manage this complexity is operator splitting, where each process is solved sequentially over a small time step. This practice explores the subtle but significant consequences of this method: because the transport and chemistry operators do not generally commute, the order of operations matters and introduces a splitting error. Through a computational exercise comparing a 'Transport-then-Chemistry' approach with a 'Chemistry-then-Transport' approach, you will quantify this error and develop an intuition for its behavior in different chemical regimes .",
            "id": "4013367",
            "problem": "Consider a one-dimensional reactive transport problem in atmospheric chemistry on a periodic domain, designed to emulate an idealized photochemical loss process with spatially varying photolysis rate such as clouds and solar zenith angle variations. The governing equation for the concentration field $c(x,t)$, with $x \\in [0,L)$ and time $t \\ge 0$, is\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = -k(x)\\, c,\n$$\nwhere $u$ is a constant advective velocity and $k(x)$ is a spatially varying first-order loss rate. Let the loss rate be specified as\n$$\nk(x) = k_0 + k_1 \\sin\\left(\\frac{2\\pi x}{L}\\right),\n$$\nwith $k_0 > 0$ and $k_1 \\ge 0$, and the initial concentration be\n$$\nc_0(x) = c_b + A \\sin\\left(\\frac{4\\pi x}{L}\\right) + \\frac{A}{2} \\cos\\left(\\frac{6\\pi x}{L}\\right),\n$$\nwith $c_b > 0$ and $A > 0$. The boundary condition is periodic on the interval $[0,L)$.\n\nThis problem examines two first-order operator splitting approaches often employed in Chemistry–Transport Models (CTMs) within Numerical Weather Prediction (NWP) and climate modeling:\n\n- Transport-then-Chemistry (TC): Apply the advective transport over a single time step of length $\\Delta t$, followed by the chemical loss over $\\Delta t$.\n- Chemistry-then-Transport (CT): Apply the chemical loss over a single time step of length $\\Delta t$, followed by the advective transport over $\\Delta t$.\n\nFor constant $u$, the advective transport over time $\\Delta t$ is equivalent to a shift $x \\mapsto x - u \\Delta t$ (with periodic wrap-around). The chemical loss operator over time $\\Delta t$ is a local multiplication by $\\exp\\left(-k(x)\\, \\Delta t\\right)$. Using only these fundamental operators, the two sequential compositions over one time step produce the fields\n$$\nc_{\\mathrm{TC}}(x) = \\exp\\left(-k(x)\\, \\Delta t\\right)\\, c_0\\!\\left(x - u\\Delta t\\right),\n$$\n$$\nc_{\\mathrm{CT}}(x) = \\exp\\left(-k\\!\\left(x - u\\Delta t\\right)\\, \\Delta t\\right)\\, c_0\\!\\left(x - u\\Delta t\\right).\n$$\nDefine the root-mean-square (RMS) difference over the domain after one step as\n$$\nE = \\sqrt{\\frac{1}{L}\\int_0^L \\left(c_{\\mathrm{TC}}(x) - c_{\\mathrm{CT}}(x)\\right)^2\\, dx},\n$$\nand report $E$ in mol m$^{-3}$.\n\nStarting from mass conservation and the definitions of the transport and chemistry operators above, derive the expressions for $c_{\\mathrm{TC}}(x)$ and $c_{\\mathrm{CT}}(x)$, and then construct an algorithm that computes $E$ numerically by discretizing the domain with $N_x$ uniformly spaced grid points, evaluating $c_0(x)$ and $k(x)$ at those points, shifting by $u\\Delta t$ with periodic wrap-around, applying the appropriate exponential factors, and approximating the RMS integral with the discrete mean.\n\nYour program must implement this algorithm and compute $E$ for each of the following test cases. Use the specified physical units exactly as stated, and produce results in mol m$^{-3}$.\n\n- Test Case 1 (stiff relative to advection, positive velocity):\n  - $L = 1.0\\times 10^{5}$ m, $u = 10$ m s$^{-1}$, $\\Delta t = 600$ s, $k_0 = 1.0\\times 10^{-3}$ s$^{-1}$, $k_1 = 5.0\\times 10^{-4}$ s$^{-1}$, $c_b = 2.0\\times 10^{-6}$ mol m$^{-3}$, $A = 1.0\\times 10^{-6}$ mol m$^{-3}$, $N_x = 4096$.\n- Test Case 2 (strongly stiff, positive velocity, longer step):\n  - $L = 1.0\\times 10^{5}$ m, $u = 10$ m s$^{-1}$, $\\Delta t = 1800$ s, $k_0 = 1.0\\times 10^{-2}$ s$^{-1}$, $k_1 = 5.0\\times 10^{-3}$ s$^{-1}$, $c_b = 2.0\\times 10^{-6}$ mol m$^{-3}$, $A = 1.0\\times 10^{-6}$ mol m$^{-3}$, $N_x = 4096$.\n- Test Case 3 (non-stiff, constant chemistry rate as a commutation check):\n  - $L = 1.0\\times 10^{5}$ m, $u = 10$ m s$^{-1}$, $\\Delta t = 600$ s, $k_0 = 1.0\\times 10^{-4}$ s$^{-1}$, $k_1 = 0$ s$^{-1}$, $c_b = 2.0\\times 10^{-6}$ mol m$^{-3}$, $A = 1.0\\times 10^{-6}$ mol m$^{-3}$, $N_x = 4096$.\n- Test Case 4 (no transport as a commutation check):\n  - $L = 1.0\\times 10^{5}$ m, $u = 0$ m s$^{-1}$, $\\Delta t = 600$ s, $k_0 = 1.0\\times 10^{-3}$ s$^{-1}$, $k_1 = 5.0\\times 10^{-4}$ s$^{-1}$, $c_b = 2.0\\times 10^{-6}$ mol m$^{-3}$, $A = 1.0\\times 10^{-6}$ mol m$^{-3}$, $N_x = 4096$.\n- Test Case 5 (stiff, negative velocity to test periodic wrap-around symmetry):\n  - $L = 1.0\\times 10^{5}$ m, $u = -10$ m s$^{-1}$, $\\Delta t = 600$ s, $k_0 = 1.0\\times 10^{-3}$ s$^{-1}$, $k_1 = 5.0\\times 10^{-4}$ s$^{-1}$, $c_b = 2.0\\times 10^{-6}$ mol m$^{-3}$, $A = 1.0\\times 10^{-6}$ mol m$^{-3}$, $N_x = 4096$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,...]\"), where each entry is the RMS difference $E$ for the corresponding test case in mol m$^{-3}$, expressed as decimal floats.",
            "solution": "The user-provided problem has been analyzed and is deemed valid. It is scientifically grounded in the field of numerical methods for atmospheric chemistry, is well-posed with all necessary parameters and definitions provided, and is stated in objective, formal language. The problem asks for the derivation of two operator-splitting schemes and the numerical computation of the root-mean-square (RMS) difference between them for a set of test cases.\n\n### Governing Equation and Operator Splitting\n\nThe problem is described by the one-dimensional reactive transport equation on a periodic domain $x \\in [0,L)$:\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = -k(x)\\, c\n$$\nThis partial differential equation (PDE) can be conceptually split into two simpler equations, one for pure transport (advection) and one for pure chemical reaction.\nThe transport operator, $\\mathcal{T}$, evolves the concentration field according to the pure advection equation:\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = 0\n$$\nFor a constant velocity $u$, the solution to this equation over a time step $\\Delta t$ is a simple spatial shift. Using the method of characteristics, we find that the concentration is constant along lines where $dx/dt = u$. Integrating gives $x(t) = x_0 + ut$, where $x_0$ is the position at $t=0$. Thus, the concentration at position $x$ and time $t$ is the initial concentration at position $x-ut$. The transport operator over a time step $\\Delta t$ applied to a function $f(x)$ is therefore:\n$$\n\\mathcal{T}(\\Delta t)f(x) = f(x - u\\Delta t)\n$$\n\nThe chemistry operator, $\\mathcal{C}$, evolves the concentration field according to the pure reaction equation:\n$$\n\\frac{\\partial c}{\\partial t} = -k(x)\\, c\n$$\nFor a fixed position $x$, this is an ordinary differential equation (ODE) in time. Integrating from $t$ to $t+\\Delta t$ gives:\n$$\n\\int_{c(t)}^{c(t+\\Delta t)} \\frac{dc}{c} = \\int_t^{t+\\Delta t} -k(x) dt' \\implies \\ln\\left(\\frac{c(t+\\Delta t)}{c(t)}\\right) = -k(x)\\Delta t\n$$\nThe solution is $c(t+\\Delta t) = c(t) \\exp(-k(x)\\Delta t)$. The chemistry operator over a time step $\\Delta t$ applied to a function $f(x)$ is:\n$$\n\\mathcal{C}(\\Delta t)f(x) = f(x) \\exp(-k(x)\\Delta t)\n$$\n\n### Derivation of Transport-then-Chemistry (TC) and Chemistry-then-Transport (CT) Schemes\n\nThe two first-order operator splitting schemes are defined by the order in which the operators are applied to the initial concentration field $c_0(x)$.\n\n**Transport-then-Chemistry (TC):**\nFirst, the transport operator $\\mathcal{T}(\\Delta t)$ is applied to the initial field $c_0(x)$ to obtain an intermediate field $c'(x)$. Second, the chemistry operator $\\mathcal{C}(\\Delta t)$ is applied to $c'(x)$.\n$$\nc'(x) = \\mathcal{T}(\\Delta t) c_0(x) = c_0(x - u\\Delta t)\n$$\n$$\nc_{\\mathrm{TC}}(x) = \\mathcal{C}(\\Delta t) c'(x) = c'(x) \\exp(-k(x)\\Delta t) = c_0(x - u\\Delta t) \\exp(-k(x)\\Delta t)\n$$\nThis confirms the expression for $c_{\\mathrm{TC}}(x)$ provided in the problem statement.\n\n**Chemistry-then-Transport (CT):**\nFirst, the chemistry operator $\\mathcal{C}(\\Delta t)$ is applied to the initial field $c_0(x)$ to obtain an intermediate field $c''(x)$. Second, the transport operator $\\mathcal{T}(\\Delta t)$ is applied to $c''(x)$.\n$$\nc''(x) = \\mathcal{C}(\\Delta t) c_0(x) = c_0(x) \\exp(-k(x)\\Delta t)\n$$\n$$\nc_{\\mathrm{CT}}(x) = \\mathcal{T}(\\Delta t) c''(x) = c''(x-u\\Delta t) = c_0(x - u\\Delta t) \\exp(-k(x-u\\Delta t)\\Delta t)\n$$\nThis confirms the expression for $c_{\\mathrm{CT}}(x)$ provided in the problem statement.\n\n### Splitting Error and RMS Difference\n\nThe difference between the two schemes, known as the splitting error, arises because the transport and chemistry operators do not, in general, commute. That is, $\\mathcal{C}(\\Delta t)\\mathcal{T}(\\Delta t) \\neq \\mathcal{T}(\\Delta t)\\mathcal{C}(\\Delta t)$. The difference is:\n$$\nc_{\\mathrm{TC}}(x) - c_{\\mathrm{CT}}(x) = c_0(x - u\\Delta t) \\left[ \\exp(-k(x)\\Delta t) - \\exp(-k(x-u\\Delta t)\\Delta t) \\right]\n$$\nThis difference is non-zero if and only if $c_0(x-u\\Delta t) \\neq 0$ and $k(x) \\neq k(x-u\\Delta t)$. The latter condition implies that the error is zero if the transport velocity $u=0$ (Case 4) or if the reaction rate $k(x)$ is constant, i.e., $k_1=0$ (Case 3).\n\nThe root-mean-square (RMS) difference $E$ is defined as:\n$$\nE = \\sqrt{\\frac{1}{L}\\int_0^L \\left(c_{\\mathrm{TC}}(x) - c_{\\mathrm{CT}}(x)\\right)^2\\, dx}\n$$\n\n### Numerical Algorithm\n\nTo compute $E$ numerically, we discretize the spatial domain and approximate the integral.\n\n1.  **Discretize Domain:** The domain $[0,L)$ is discretized into $N_x$ uniformly spaced grid points $x_j = j \\cdot \\Delta x$ for $j = 0, 1, \\dots, N_x-1$, where the grid spacing is $\\Delta x = L/N_x$.\n\n2.  **Evaluate Fields at Grid Points:**\n    The initial concentration $c_0(x)$ and the loss rate $k(x)$ are defined by:\n    $$\n    k(x) = k_0 + k_1 \\sin\\left(\\frac{2\\pi x}{L}\\right)\n    $$\n    $$\n    c_0(x) = c_b + A \\sin\\left(\\frac{4\\pi x}{L}\\right) + \\frac{A}{2} \\cos\\left(\\frac{6\\pi x}{L}\\right)\n    $$\n    We need to evaluate these functions at the original grid points $x_j$ and at the advection-shifted grid points $x'_j = (x_j - u\\Delta t) \\pmod L$. We create discrete arrays representing the fields at these points:\n    - $\\mathbf{x}$: An array of grid points $x_j$.\n    - $\\mathbf{x}_{\\text{shifted}}$: An array of shifted grid points $(x_j - u\\Delta t) \\pmod L$.\n    - $\\mathbf{k}$: The reaction rate evaluated at $\\mathbf{x}$, i.e., $k(x_j)$.\n    - $\\mathbf{k}_{\\text{shifted}}$: The reaction rate evaluated at $\\mathbf{x}_{\\text{shifted}}$.\n    - $\\mathbf{c}_{0, \\text{shifted}}$: The initial concentration evaluated at $\\mathbf{x}_{\\text{shifted}}$.\n\n3.  **Compute Discrete Solutions:** Using the arrays from the previous step, we compute the discrete versions of $c_{\\mathrm{TC}}$ and $c_{\\mathrm{CT}}$ at each grid point $x_j$. Let $\\odot$ denote element-wise multiplication.\n    $$\n    \\mathbf{c}_{\\mathrm{TC}} = \\exp(-\\mathbf{k} \\cdot \\Delta t) \\odot \\mathbf{c}_{0, \\text{shifted}}\n    $$\n    $$\n    \\mathbf{c}_{\\mathrm{CT}} = \\exp(-\\mathbf{k}_{\\text{shifted}} \\cdot \\Delta t) \\odot \\mathbf{c}_{0, \\text{shifted}}\n    $$\n    \n4.  **Compute RMS Difference:** The integral in the definition of $E$ is approximated by a mean over the discrete grid points. The expression for $E^2$ becomes:\n    $$\n    E^2 = \\frac{1}{L}\\int_0^L \\left(c_{\\mathrm{TC}}(x) - c_{\\mathrm{CT}}(x)\\right)^2\\, dx \\approx \\frac{1}{L} \\sum_{j=0}^{N_x-1} \\left(c_{\\mathrm{TC}}(x_j) - c_{\\mathrm{CT}}(x_j)\\right)^2 \\Delta x\n    $$\n    Substituting $\\Delta x = L/N_x$, we get:\n    $$\n    E^2 \\approx \\frac{1}{L} \\frac{L}{N_x} \\sum_{j=0}^{N_x-1} \\left(c_{\\mathrm{TC},j} - c_{\\mathrm{CT},j}\\right)^2 = \\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left(c_{\\mathrm{TC},j} - c_{\\mathrm{CT},j}\\right)^2\n    $$\n    This is the definition of the mean squared error. The RMS difference $E$ is therefore the square root of the mean of the squared differences between the two solution arrays:\n    $$\n    E = \\sqrt{\\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left(\\mathbf{c}_{\\mathrm{TC}} - \\mathbf{c}_{\\mathrm{CT}}\\right)_j^2} = \\text{RMS}(\\mathbf{c}_{\\mathrm{TC}} - \\mathbf{c}_{\\mathrm{CT}})\n    $$\n    This algorithm will be implemented for each test case to compute the required values of $E$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RMS difference between Transport-then-Chemistry (TC) and\n    Chemistry-then-Transport (CT) operator splitting schemes for a 1D\n    advection-reaction problem.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, u, dt, k0, k1, cb, A, Nx)\n        # Test Case 1: stiff, positive velocity\n        (1.0e5, 10.0, 600.0, 1.0e-3, 5.0e-4, 2.0e-6, 1.0e-6, 4096),\n        # Test Case 2: strongly stiff, positive velocity, longer step\n        (1.0e5, 10.0, 1800.0, 1.0e-2, 5.0e-3, 2.0e-6, 1.0e-6, 4096),\n        # Test Case 3: non-stiff, constant chemistry (commutation check)\n        (1.0e5, 10.0, 600.0, 1.0e-4, 0.0, 2.0e-6, 1.0e-6, 4096),\n        # Test Case 4: no transport (commutation check)\n        (1.0e5, 0.0, 600.0, 1.0e-3, 5.0e-4, 2.0e-6, 1.0e-6, 4096),\n        # Test Case 5: stiff, negative velocity\n        (1.0e5, -10.0, 600.0, 1.0e-3, 5.0e-4, 2.0e-6, 1.0e-6, 4096),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, u, dt, k0, k1, cb, A, Nx = case\n\n        # 1. Discretize the domain [0, L)\n        # endpoint=False is crucial for a periodic domain to avoid duplicating x=0 and x=L\n        x = np.linspace(0, L, Nx, endpoint=False)\n\n        # 2. Define analytical functions for k(x) and c0(x)\n        def k_func(pos, L_val, k0_val, k1_val):\n            return k0_val + k1_val * np.sin(2 * np.pi * pos / L_val)\n        \n        def c0_func(pos, L_val, cb_val, A_val):\n            return (cb_val + \n                    A_val * np.sin(4 * np.pi * pos / L_val) + \n                    (A_val / 2) * np.cos(6 * np.pi * pos / L_val))\n\n        # 3. Evaluate fields at original and shifted grid points\n        # Calculate shifted coordinates with periodic wrap-around\n        x_shifted = (x - u * dt) % L\n        \n        # Evaluate k(x) on the original grid\n        k_x = k_func(x, L, k0, k1)\n        \n        # Evaluate k(x) on the shifted grid for the CT scheme\n        k_x_shifted = k_func(x_shifted, L, k0, k1)\n\n        # Evaluate c0(x) on the shifted grid for both schemes\n        c0_x_shifted = c0_func(x_shifted, L, cb, A)\n\n        # 4. Compute the discrete solutions for TC and CT\n        \n        # Transport-then-Chemistry (TC)\n        # c_tc(x) = exp(-k(x) * dt) * c0(x - u*dt)\n        c_tc = np.exp(-k_x * dt) * c0_x_shifted\n\n        # Chemistry-then-Transport (CT)\n        # c_ct(x) = exp(-k(x - u*dt) * dt) * c0(x - u*dt)\n        c_ct = np.exp(-k_x_shifted * dt) * c0_x_shifted\n        \n        # 5. Compute the RMS difference\n        # The integral approximation simplifies to the standard discrete RMS\n        # E = sqrt(mean((c_tc - c_ct)^2))\n        diff_sq = (c_tc - c_ct)**2\n        rms_error = np.sqrt(np.mean(diff_sq))\n        \n        results.append(rms_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The final step in preparing a CTM for a simulation run involves integrating all its components—advection, diffusion, and chemistry—and selecting a stable time step. When using explicit time-stepping schemes, the numerical stability of each process imposes a strict upper limit on the size of this time step, $\\Delta t$. This culminating exercise places you in the role of a modeler tasked with determining the single, globally-valid timestep for a 3D model. You will learn to identify the most restrictive stability constraint, whether from fast winds, strong diffusion, or rapid chemical reactions, ensuring the entire simulation remains physically realistic and computationally stable .",
            "id": "3863647",
            "problem": "A conserved chemical tracer concentration field $C(\\mathbf{x},t)$ in a three-dimensional atmospheric chemical transport model evolves under the combined effects of advection, diffusion, and gas-phase chemistry. The governing conservation law is\n$$\n\\frac{\\partial C}{\\partial t} + \\nabla \\cdot \\left( \\mathbf{u}\\, C \\right) \\;=\\; \\nabla \\cdot \\left( \\mathbf{K}\\, \\nabla C \\right) \\;+\\; R(C),\n$$\nwhere $\\mathbf{u} = (u,v,w)$ is the wind velocity, $\\mathbf{K} = \\mathrm{diag}(K_{x},K_{y},K_{z})$ is the eddy diffusivity tensor, and $R(C)$ represents the net chemical tendency. Consider an explicit time-stepping scheme that uses a flux-form finite-volume, unsplit donor-cell (upwind) discretization for advection, an explicit second-order central difference discretization for diffusion along each axis independently, and operator splitting with an explicit forward Euler step for the gas-phase chemistry.\n\nThe computational grid is Cartesian and uniform with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$. The domain has altitude $z \\in [0,\\, 5\\,\\mathrm{km}]$, and the wind and diffusivity fields vary with altitude according to\n- $u(z) = 12 + 6\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$,\n- $v(z) = 8 + 4\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$,\n- $w(z) = 0.6$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$,\n- $K_{x}(z) = 50 + 60\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$,\n- $K_{y}(z) = 40 + 40\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$,\n- $K_{z}(z) = 0.3 + 0.4\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$.\n\nThe uniform grid spacings are\n- $\\Delta x = 12\\,\\mathrm{km}$,\n- $\\Delta y = 8\\,\\mathrm{km}$,\n- $\\Delta z = 200\\,\\mathrm{m}$.\n\nThe chemical mechanism’s stiffest first-order rate in the operator-split gas-phase solver is characterized by a maximum eigenvalue magnitude $k_{\\max} = 0.004$ $\\mathrm{s}^{-1}$.\n\nStarting from the conservation law and the stated numerical scheme, use stability and positivity arguments appropriate to explicit methods to determine, in closed form, the maximum allowable global timestep $\\Delta t_{\\max}$ that simultaneously satisfies the following requirements everywhere in the domain:\n- the multidimensional Courant-type constraint for the unsplit upwind advection discretization,\n- the explicit central-difference diffusion stability constraints along each coordinate direction,\n- the explicit forward Euler chemical stability bound associated with $k_{\\max}$.\n\nCompute the resulting $\\Delta t_{\\max}$ using the provided fields and grid spacings. Express your final timestep in seconds and round your answer to four significant figures.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and all necessary information is provided.\n\n**Step 1: Extract Givens**\n- Governing partial differential equation: $\\frac{\\partial C}{\\partial t} + \\nabla \\cdot \\left( \\mathbf{u}\\, C \\right) = \\nabla \\cdot \\left( \\mathbf{K}\\, \\nabla C \\right) + R(C)$\n- Wind velocity vector: $\\mathbf{u} = (u,v,w)$\n- Eddy diffusivity tensor: $\\mathbf{K} = \\mathrm{diag}(K_{x},K_{y},K_{z})$\n- Chemical tendency term: $R(C)$\n- Numerical scheme details:\n  - Time integration: Explicit, operator-split\n  - Advection: Flux-form finite-volume, unsplit donor-cell (upwind)\n  - Diffusion: Explicit second-order central difference\n  - Chemistry: Explicit forward Euler\n- Grid: Uniform Cartesian with spacings $\\Delta x = 12\\,\\mathrm{km}$, $\\Delta y = 8\\,\\mathrm{km}$, $\\Delta z = 200\\,\\mathrm{m}$.\n- Domain altitude range: $z \\in [0,\\, 5\\,\\mathrm{km}]$\n- Altitude-dependent wind fields:\n  - $u(z) = 12 + 6\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$\n  - $v(z) = 8 + 4\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$\n  - $w(z) = 0.6$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- Altitude-dependent diffusivity fields:\n  - $K_{x}(z) = 50 + 60\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n  - $K_{y}(z) = 40 + 40\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n  - $K_{z}(z) = 0.3 + 0.4\\,\\frac{z}{5\\,\\mathrm{km}}$ $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n- Stiffest chemical rate: Maximum eigenvalue magnitude $k_{\\max} = 0.004$ $\\mathrm{s}^{-1}$.\n- Objective: Find the maximum allowable global timestep $\\Delta t_{\\max}$ satisfying stability and positivity constraints for advection, diffusion, and chemistry, and compute its value rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, describing a standard numerical implementation for an atmospheric chemical transport model. The governing equation is the standard advection-diffusion-reaction equation. The numerical methods mentioned are common in this field. The parameter values are physically plausible for a mesoscale model. The problem is well-posed, as it asks for a specific numerical stability constraint derived from established principles. It is complete, objective, and contains no contradictions.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full solution will be provided.\n\n**Solution Derivation**\nThe overall maximum allowable timestep, $\\Delta t_{\\max}$, for an explicit, operator-split scheme is constrained by the most restrictive timestep limit among all individual processes: advection, diffusion, and chemistry.\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{diff}}, \\Delta t_{\\text{chem}})\n$$\nWe derive the limit for each process separately.\n\n**1. Advection Stability Constraint (Courant-Friedrichs-Lewy, CFL)**\nFor an explicit, unsplit, first-order upwind (donor-cell) finite-volume scheme in three dimensions, the stability condition is given by:\n$$\n\\Delta t_{\\text{adv}} \\leq \\left( \\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} + \\frac{|w|}{\\Delta z} \\right)^{-1}\n$$\nThis constraint must be satisfied everywhere in the domain. Therefore, we must use the maximum possible values for the velocity components to find the most restrictive timestep. The wind components $u(z)$ and $v(z)$ are linear, increasing functions of altitude $z$, while $w(z)$ is constant. The maximum values thus occur at the top of the domain, $z = 5\\,\\mathrm{km}$.\n\nFirst, convert all grid spacings to meters:\n- $\\Delta x = 12\\,\\mathrm{km} = 12000\\,\\mathrm{m}$\n- $\\Delta y = 8\\,\\mathrm{km} = 8000\\,\\mathrm{m}$\n- $\\Delta z = 200\\,\\mathrm{m}$\n\nNext, evaluate the maximum velocities at $z=5\\,\\mathrm{km} = 5000\\,\\mathrm{m}$:\n- $u_{\\max} = u(5000\\,\\mathrm{m}) = 12 + 6\\left(\\frac{5000}{5000}\\right) = 18\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- $v_{\\max} = v(5000\\,\\mathrm{m}) = 8 + 4\\left(\\frac{5000}{5000}\\right) = 12\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- $w_{\\max} = w = 0.6\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ (constant)\n\nThe sum of the Courant numbers is:\n$$\n\\frac{|u_{\\max}|}{\\Delta x} + \\frac{|v_{\\max}|}{\\Delta y} + \\frac{|w_{\\max}|}{\\Delta z} = \\frac{18}{12000} + \\frac{12}{8000} + \\frac{0.6}{200}\n$$\n$$\n= 0.0015\\,\\mathrm{s}^{-1} + 0.0015\\,\\mathrm{s}^{-1} + 0.003\\,\\mathrm{s}^{-1} = 0.006\\,\\mathrm{s}^{-1}\n$$\nThe maximum timestep for advection is the reciprocal of this sum:\n$$\n\\Delta t_{\\text{adv}} = \\frac{1}{0.006\\,\\mathrm{s}^{-1}} = \\frac{1000}{6}\\,\\mathrm{s} = \\frac{500}{3}\\,\\mathrm{s} \\approx 166.67\\,\\mathrm{s}\n$$\n\n**2. Diffusion Stability Constraint**\nFor an explicit, second-order central difference scheme for the three-dimensional diffusion equation with a diagonal diffusivity tensor, the stability constraint is:\n$$\n\\Delta t_{\\text{diff}} \\leq \\frac{1}{2 \\left( \\frac{K_x}{(\\Delta x)^2} + \\frac{K_y}{(\\Delta y)^2} + \\frac{K_z}{(\\Delta z)^2} \\right)}\n$$\nSimilar to the advection case, this constraint must be satisfied everywhere. The diffusivity components $K_x(z)$, $K_y(z)$, and $K_z(z)$ are all linear, increasing functions of altitude $z$. Their maximum values, which result in the most restrictive constraint, occur at $z = 5\\,\\mathrm{km}$.\n\nEvaluate the maximum diffusivities at $z=5000\\,\\mathrm{m}$:\n- $K_{x,\\max} = K_x(5000\\,\\mathrm{m}) = 50 + 60\\left(\\frac{5000}{5000}\\right) = 110\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n- $K_{y,\\max} = K_y(5000\\,\\mathrm{m}) = 40 + 40\\left(\\frac{5000}{5000}\\right) = 80\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n- $K_{z,\\max} = K_z(5000\\,\\mathrm{m}) = 0.3 + 0.4\\left(\\frac{5000}{5000}\\right) = 0.7\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n\nThe sum of the diffusion terms is:\n$$\n\\frac{K_{x,\\max}}{(\\Delta x)^2} + \\frac{K_{y,\\max}}{(\\Delta y)^2} + \\frac{K_{z,\\max}}{(\\Delta z)^2} = \\frac{110}{(12000)^2} + \\frac{80}{(8000)^2} + \\frac{0.7}{(200)^2}\n$$\n$$\n= \\frac{110}{144 \\times 10^6} + \\frac{80}{64 \\times 10^6} + \\frac{0.7}{4 \\times 10^4}\n$$\n$$\n\\approx 7.639 \\times 10^{-7} + 1.25 \\times 10^{-6} + 1.75 \\times 10^{-5} \\approx 1.9514 \\times 10^{-5}\\,\\mathrm{s}^{-1}\n$$\nThe maximum timestep for diffusion is:\n$$\n\\Delta t_{\\text{diff}} = \\frac{1}{2 \\times (1.9514 \\times 10^{-5}\\,\\mathrm{s}^{-1})} \\approx \\frac{1}{3.9028 \\times 10^{-5}\\,\\mathrm{s}^{-1}} \\approx 25623\\,\\mathrm{s}\n$$\n\n**3. Chemistry Stability and Positivity Constraint**\nFor the operator-split chemical step using an explicit forward Euler scheme, we consider a representative first-order loss process, $\\frac{dC}{dt} = -kC$. The forward Euler update is $C^{n+1} = C^n - \\Delta t \\cdot k C^n = (1 - k\\Delta t)C^n$.\nThe problem requires satisfying both stability and positivity.\n- Pure numerical stability requires the amplification factor $|1 - k\\Delta t|$ to be less than or equal to $1$. This leads to $-1 \\leq 1-k\\Delta t \\leq 1$, which implies $\\Delta t \\leq \\frac{2}{k}$.\n- Positivity requires that if $C^n \\geq 0$, then $C^{n+1} \\geq 0$. This implies $1 - k\\Delta t \\geq 0$, which leads to the more restrictive condition $\\Delta t \\leq \\frac{1}{k}$.\n\nWe must apply the more restrictive condition, which is the positivity constraint. This constraint must hold for the stiffest (fastest) reaction, characterized by the maximum eigenvalue magnitude $k_{\\max}$.\n$$\n\\Delta t_{\\text{chem}} \\leq \\frac{1}{k_{\\max}}\n$$\nGiven $k_{\\max} = 0.004\\,\\mathrm{s}^{-1}$:\n$$\n\\Delta t_{\\text{chem}} = \\frac{1}{0.004\\,\\mathrm{s}^{-1}} = 250\\,\\mathrm{s}\n$$\n\n**Overall Maximum Timestep**\nThe global maximum timestep $\\Delta t_{\\max}$ is the minimum of the individual timestep limits:\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{diff}}, \\Delta t_{\\text{chem}})\n$$\n$$\n\\Delta t_{\\max} = \\min\\left(\\frac{500}{3}\\,\\mathrm{s}, 25623\\,\\mathrm{s}, 250\\,\\mathrm{s}\\right)\n$$\n$$\n\\Delta t_{\\max} = \\min(166.666...\\,\\mathrm{s}, 25623\\,\\mathrm{s}, 250\\,\\mathrm{s}) = 166.666...\\,\\mathrm{s}\n$$\nThe most restrictive constraint is imposed by the advection scheme (CFL condition).\n\nRounding the result to four significant figures gives $166.7\\,\\mathrm{s}$.",
            "answer": "$$\n\\boxed{166.7}\n$$"
        }
    ]
}