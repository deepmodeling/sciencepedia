{
    "hands_on_practices": [
        {
            "introduction": "全球碳预算是理解地球系统对人为排放响应的基石。然而，综合来自不同来源（如化石燃料排放清单、大气浓度观测以及陆地和海洋通量的独立估计）的数据以实现质量守恒是一项重大挑战。本练习将引导您应用加权最小二乘法，这是一种在数据同化和模型约束中广泛使用的基本技术，以协调这些存在不确定性的不同数据流，从而得出一个物理上一致的全球碳汇划分 。",
            "id": "4100253",
            "problem": "考虑一项单年度全球碳收支分析，该分析用于约束嵌入在数值天气预报（NWP）和气候模拟工作流中的地球系统模型（ESM）的地表通量。设大气碳质量 $M_{\\mathrm{atm}}$ 在一年内遵循质量守恒，因此其趋势 $dM_{\\mathrm{atm}}/dt$ 等于排放量减去吸收汇。在本练习中，假设考虑的唯一人为来源是化石燃料和水泥生产排放 $E_{\\mathrm{ff}}$，并忽略土地利用变化排放和任何收支残余项。观测到的大气增长速率记为 $G_{\\mathrm{atm}}$。那么，隐含的总汇受质量守恒的约束。\n\n总汇被划分为陆地汇 $S_{\\mathrm{land}}$ 和海洋汇 $S_{\\mathrm{ocn}}$。在没有完全解析过程的约束的情况下，采用参数化 $S_{\\mathrm{land}} = \\alpha S_{\\mathrm{tot}}$ 和 $S_{\\mathrm{ocn}} = (1-\\alpha) S_{\\mathrm{tot}}$，其中 $S_{\\mathrm{tot}}$ 是由收支所隐含的总汇。来自过程模型和基于观测的重建对该年的年平均汇的独立估算值为 $S_{\\mathrm{land}}^{\\ast}$ 和 $S_{\\mathrm{ocn}}^{\\ast}$，其相关的单标准差不确定性为 $\\sigma_{\\mathrm{land}}$ 和 $\\sigma_{\\mathrm{ocn}}$。使用加权最小二乘法失配来确定最优分配系数 $\\alpha$：\n$$\nJ(\\alpha) = w_{\\mathrm{land}}\\left(\\alpha S_{\\mathrm{tot}} - S_{\\mathrm{land}}^{\\ast}\\right)^{2} + w_{\\mathrm{ocn}}\\left((1-\\alpha) S_{\\mathrm{tot}} - S_{\\mathrm{ocn}}^{\\ast}\\right)^{2},\n$$\n其中 $w_{\\mathrm{land}} = 1/\\sigma_{\\mathrm{land}}^{2}$ 且 $w_{\\mathrm{ocn}} = 1/\\sigma_{\\mathrm{ocn}}^{2}$。\n\n目标年份的数据如下：\n- 化石燃料和水泥排放 $E_{\\mathrm{ff}} = 9.8$ 拍克碳/年 ($\\mathrm{PgC\\,yr^{-1}}$)。\n- 观测到的大气增长速率 $G_{\\mathrm{atm}} = 5.3$ 拍克碳/年 ($\\mathrm{PgC\\,yr^{-1}}$)。\n- 独立陆地汇估算值 $S_{\\mathrm{land}}^{\\ast} = 3.0$ 拍克碳/年 ($\\mathrm{PgC\\,yr^{-1}}$)，不确定性 $\\sigma_{\\mathrm{land}} = 0.4$ 拍克碳/年 ($\\mathrm{PgC\\,yr^{-1}}$)。\n- 独立海洋汇估算值 $S_{\\mathrm{ocn}}^{\\ast} = 2.6$ 拍克碳/年 ($\\mathrm{PgC\\,yr^{-1}}$)，不确定性 $\\sigma_{\\mathrm{ocn}} = 0.2$ 拍克碳/年 ($\\mathrm{PgC\\,yr^{-1}}$)。\n\n任务：\n1. 从质量守恒出发，根据此简化收支，推导用 $E_{\\mathrm{ff}}$ 和 $G_{\\mathrm{atm}}$ 表示的 $S_{\\mathrm{tot}}$。\n2. 构建并解析最小化 $J(\\alpha)$，以获得用 $S_{\\mathrm{tot}}$、$S_{\\mathrm{land}}^{\\ast}$、$S_{\\mathrm{ocn}}^{\\ast}$、$w_{\\mathrm{land}}$ 和 $w_{\\mathrm{ocn}}$ 表示的最优 $\\alpha$ 的闭式表达式。\n3. 使用所提供的数值，计算最优 $\\alpha$ 的数值。\n4. 使用这个最优 $\\alpha$，计算隐含的汇 $S_{\\mathrm{land}}$ 和 $S_{\\mathrm{ocn}}$，并根据它们的大小，讨论它们与独立估算值 $S_{\\mathrm{land}}^{\\ast}$ 和 $S_{\\mathrm{ocn}}^{\\ast}$ 的比较情况。\n\n报告最优分配系数 $\\alpha$ 作为最终答案。将您报告的 $\\alpha$ 四舍五入到四位有效数字。将最终答案表示为一个无单位的数字。您计算的任何中间量在适用时应以 PgC yr$^{-1}$ 为单位表示。",
            "solution": "首先验证问题，以确保其科学上可靠、适定且客观。问题陈述描述了一种简化但标准的碳收支闭合方法，这是气候科学中的一项常见任务。它使用质量守恒原理和加权最小二乘优化这一数学技术来协调不同的数据源。所有提供的数据在物理上都是现实的，并且在量纲上是一致的。该问题定义明确，不含矛盾，并具有唯一、稳定的解。因此，该问题被认为是有效的。我们按顺序进行解答，处理四个任务中的每一个。\n\n首先，我们处理任务1：推导总汇 $S_{\\mathrm{tot}}$。问题指出，大气碳质量的变化率 $dM_{\\mathrm{atm}}/dt$，即观测到的大气增长速率 $G_{\\mathrm{atm}}$，等于总排放量减去总汇。在这个简化收支中，唯一的排放源是 $E_{\\mathrm{ff}}$，总汇是 $S_{\\mathrm{tot}}$。因此，质量守恒方程为：\n$$\nG_{\\mathrm{atm}} = \\frac{dM_{\\mathrm{atm}}}{dt} = E_{\\mathrm{ff}} - S_{\\mathrm{tot}}\n$$\n求解总汇 $S_{\\mathrm{tot}}$ 可得：\n$$\nS_{\\mathrm{tot}} = E_{\\mathrm{ff}} - G_{\\mathrm{atm}}\n$$\n使用提供的数值数据，$E_{\\mathrm{ff}} = 9.8\\,\\mathrm{PgC\\,yr^{-1}}$ 和 $G_{\\mathrm{atm}} = 5.3\\,\\mathrm{PgC\\,yr^{-1}}$，我们可以计算出总汇的值：\n$$\nS_{\\mathrm{tot}} = 9.8 - 5.3 = 4.5 \\, \\mathrm{PgC\\,yr^{-1}}\n$$\n\n接下来，对于任务2，我们通过最小化成本函数 $J(\\alpha)$ 来找到最优分配系数 $\\alpha$。成本函数给出如下：\n$$\nJ(\\alpha) = w_{\\mathrm{land}}\\left(\\alpha S_{\\mathrm{tot}} - S_{\\mathrm{land}}^{\\ast}\\right)^{2} + w_{\\mathrm{ocn}}\\left((1-\\alpha) S_{\\mathrm{tot}} - S_{\\mathrm{ocn}}^{\\ast}\\right)^{2}\n$$\n为了找到最小值，我们必须找到使 $J(\\alpha)$ 对 $\\alpha$ 的一阶导数为零的 $\\alpha$ 值，即 $dJ/d\\alpha = 0$。使用链式法则进行微分：\n$$\n\\frac{dJ}{d\\alpha} = w_{\\mathrm{land}} \\cdot 2 \\left(\\alpha S_{\\mathrm{tot}} - S_{\\mathrm{land}}^{\\ast}\\right) \\cdot (S_{\\mathrm{tot}}) + w_{\\mathrm{ocn}} \\cdot 2 \\left((1-\\alpha) S_{\\mathrm{tot}} - S_{\\mathrm{ocn}}^{\\ast}\\right) \\cdot (-S_{\\mathrm{tot}})\n$$\n将导数设为零：\n$$\n2 S_{\\mathrm{tot}} \\left[ w_{\\mathrm{land}}\\left(\\alpha S_{\\mathrm{tot}} - S_{\\mathrm{land}}^{\\ast}\\right) - w_{\\mathrm{ocn}}\\left((1-\\alpha) S_{\\mathrm{tot}} - S_{\\mathrm{ocn}}^{\\ast}\\right) \\right] = 0\n$$\n由于 $S_{\\mathrm{tot}} = 4.5 \\neq 0$，我们可以除以 $2 S_{\\mathrm{tot}}$：\n$$\nw_{\\mathrm{land}}\\left(\\alpha S_{\\mathrm{tot}} - S_{\\mathrm{land}}^{\\ast}\\right) - w_{\\mathrm{ocn}}\\left(S_{\\mathrm{tot}} - \\alpha S_{\\mathrm{tot}} - S_{\\mathrm{ocn}}^{\\ast}\\right) = 0\n$$\n我们现在求解 $\\alpha$。展开各项：\n$$\nw_{\\mathrm{land}} \\alpha S_{\\mathrm{tot}} - w_{\\mathrm{land}} S_{\\mathrm{land}}^{\\ast} - w_{\\mathrm{ocn}} S_{\\mathrm{tot}} + w_{\\mathrm{ocn}} \\alpha S_{\\mathrm{tot}} + w_{\\mathrm{ocn}} S_{\\mathrm{ocn}}^{\\ast} = 0\n$$\n将含有 $\\alpha$ 的项组合到方程的一侧：\n$$\n\\alpha S_{\\mathrm{tot}} (w_{\\mathrm{land}} + w_{\\mathrm{ocn}}) = w_{\\mathrm{land}} S_{\\mathrm{land}}^{\\ast} + w_{\\mathrm{ocn}} S_{\\mathrm{tot}} - w_{\\mathrm{ocn}} S_{\\mathrm{ocn}}^{\\ast}\n$$\n分离 $\\alpha$ 得到最优分配系数的闭式表达式：\n$$\n\\alpha = \\frac{w_{\\mathrm{land}} S_{\\mathrm{land}}^{\\ast} + w_{\\mathrm{ocn}} (S_{\\mathrm{tot}} - S_{\\mathrm{ocn}}^{\\ast})}{S_{\\mathrm{tot}} (w_{\\mathrm{land}} + w_{\\mathrm{ocn}})}\n$$\n为了确认这是一个最小值，我们检查二阶导数：$\\frac{d^2 J}{d\\alpha^2} = 2 S_{\\mathrm{tot}}^2 (w_{\\mathrm{land}} + w_{\\mathrm{ocn}})$。由于权重 $w = 1/\\sigma^2$ 为正，且 $S_{\\mathrm{tot}}^2$ 为正，所以 $\\frac{d^2 J}{d\\alpha^2}  0$，确认了这是一个最小值。\n\n对于任务3，我们计算 $\\alpha$ 的数值。首先，我们根据给定的不确定性 $\\sigma_{\\mathrm{land}} = 0.4\\,\\mathrm{PgC\\,yr^{-1}}$ 和 $\\sigma_{\\mathrm{ocn}} = 0.2\\,\\mathrm{PgC\\,yr^{-1}}$ 计算权重 $w_{\\mathrm{land}}$ 和 $w_{\\mathrm{ocn}}$：\n$$\nw_{\\mathrm{land}} = \\frac{1}{\\sigma_{\\mathrm{land}}^{2}} = \\frac{1}{(0.4)^{2}} = \\frac{1}{0.16} = 6.25 \\, (\\mathrm{PgC\\,yr^{-1}})^{-2}\n$$\n$$\nw_{\\mathrm{ocn}} = \\frac{1}{\\sigma_{\\mathrm{ocn}}^{2}} = \\frac{1}{(0.2)^{2}} = \\frac{1}{0.04} = 25 \\, (\\mathrm{PgC\\,yr^{-1}})^{-2}\n$$\n现在，我们将所有数值代入 $\\alpha$ 的表达式中：\n$S_{\\mathrm{tot}} = 4.5$，$S_{\\mathrm{land}}^{\\ast} = 3.0$，$S_{\\mathrm{ocn}}^{\\ast} = 2.6$，$w_{\\mathrm{land}} = 6.25$，$w_{\\mathrm{ocn}} = 25$。\n分子是：\n$$\nw_{\\mathrm{land}} S_{\\mathrm{land}}^{\\ast} + w_{\\mathrm{ocn}} (S_{\\mathrm{tot}} - S_{\\mathrm{ocn}}^{\\ast}) = 6.25 \\times 3.0 + 25 \\times (4.5 - 2.6) = 18.75 + 25 \\times 1.9 = 18.75 + 47.5 = 66.25\n$$\n分母是：\n$$\nS_{\\mathrm{tot}} (w_{\\mathrm{land}} + w_{\\mathrm{ocn}}) = 4.5 \\times (6.25 + 25) = 4.5 \\times 31.25 = 140.625\n$$\n因此，最优 $\\alpha$ 是：\n$$\n\\alpha = \\frac{66.25}{140.625} = 0.47111...\n$$\n四舍五入到四位有效数字，我们得到 $\\alpha \\approx 0.4711$。\n\n最后，对于任务4，我们计算隐含的汇并讨论结果。为了精确起见，使用未四舍五入的 $\\alpha$ 值，隐含的陆地和海洋汇是：\n$$\nS_{\\mathrm{land}} = \\alpha S_{\\mathrm{tot}} = \\left(\\frac{66.25}{140.625}\\right) \\times 4.5 = 2.12 \\, \\mathrm{PgC\\,yr^{-1}}\n$$\n$$\nS_{\\mathrm{ocn}} = (1-\\alpha) S_{\\mathrm{tot}} = S_{\\mathrm{tot}} - S_{\\mathrm{land}} = 4.5 - 2.12 = 2.38 \\, \\mathrm{PgC\\,yr^{-1}}\n$$\n我们将这些优化后的汇与独立估算值进行比较：\n- 隐含陆地汇 $S_{\\mathrm{land}} = 2.12\\,\\mathrm{PgC\\,yr^{-1}}$ vs 独立估算值 $S_{\\mathrm{land}}^{\\ast} = 3.0\\,\\mathrm{PgC\\,yr^{-1}}$。\n- 隐含海洋汇 $S_{\\mathrm{ocn}} = 2.38\\,\\mathrm{PgC\\,yr^{-1}}$ vs 独立估算值 $S_{\\mathrm{ocn}}^{\\ast} = 2.6\\,\\mathrm{PgC\\,yr^{-1}}$。\n\n独立汇估算值的总和是 $S_{\\mathrm{land}}^{\\ast} + S_{\\mathrm{ocn}}^{\\ast} = 3.0 + 2.6 = 5.6\\,\\mathrm{PgC\\,yr^{-1}}$，这大于质量守恒所要求的总汇 $S_{\\mathrm{tot}} = 4.5\\,\\mathrm{PgC\\,yr^{-1}}$。因此，优化过程找到了一个折衷方案，调整了各个汇以满足该守恒定律。优化后的陆地汇 $S_{\\mathrm{land}}$ 和海洋汇 $S_{\\mathrm{ocn}}$ 都小于它们各自的独立估算值。\n\n调整的幅度由不确定性决定。海洋汇估算值的不确定性（$\\sigma_{\\mathrm{ocn}} = 0.2$）小于陆地汇估算值的不确定性（$\\sigma_{\\mathrm{land}} = 0.4$），导致其权重（$w_{\\mathrm{ocn}}=25$ 对比 $w_{\\mathrm{land}}=6.25$）大得多。因此，成本函数对偏离海洋估算值的惩罚更重。结果是，优化后的海洋汇（$2.38\\,\\mathrm{PgC\\,yr^{-1}}$）与它的独立估算值（$2.6\\,\\mathrm{PgC\\,yr^{-1}}$）保持得更近，差值仅为 $|2.38 - 2.6| = 0.22\\,\\mathrm{PgC\\,yr^{-1}}$。相比之下，优化后的陆地汇（$2.12\\,\\mathrm{PgC\\,yr^{-1}}$）被拉得离其更不确定的独立估算值（$3.0\\,\\mathrm{PgC\\,yr^{-1}}$）更远，差值更大，为 $|2.12 - 3.0| = 0.88\\,\\mathrm{PgC\\,yr^{-1}}$。最终的划分反映了相比于陆地汇估算值，我们对海洋汇估算值有更高的置信度。",
            "answer": "$$\\boxed{0.4711}$$"
        },
        {
            "introduction": "在掌握了单一年份的碳预算之后，我们转向分析碳循环随时间演变的动态。一个关键的诊断指标是“空气传播分数”（airborne fraction），它量化了每年有多少人为排放的二氧化碳留在了大气中。本练习将通过处理时间序列数据，让您亲手计算这一重要指标，并进一步分解其年际变化的驱动因素，从而深入理解碳汇效率的波动性及其与排放变率的相互作用 。",
            "id": "4100181",
            "problem": "考虑数值天气预报和气候模拟中的全球碳循环，以及人为二氧化碳排放在改变大气碳含量中的作用。使用大气碳的质量守恒作为基本基础：大气碳储量的时间变化等于人为排放和总汇之间的净不平衡。根据质量守恒和人为归因，将空气滞留分数定义为在指定时期内，有多少人为排放物存留在大气中的无量纲度量，并根据排放和大气增长的时间序列计算其十年平均值。然后，通过将年际变率分解为可归因于排放变率、大气增长变率及其协方差的分量，来量化和解释空气滞留分数的年际变率。\n\n你必须构建一个完整的、可运行的程序，对于每个测试用例，在不预设任何快捷公式的情况下，执行以下基于上述原则的任务：\n- 根据质量守恒，计算十年空气滞留分数，即十年期间累计的大气增长与人为排放之间的无量纲比率。\n- 在年度空气滞留分数有明确定义的年份里，计算其年际标准差。\n- 使用围绕十年均值的一阶扰动分析，将年度空气滞留分数的方差分解为由排放变率、大气增长变率及其协方差贡献的部分。将每个贡献表示为总方差的份额。如果年度空气滞留分数的十年方差为零，则将所有份额定义为$0$。\n- 如果由于十年排放量为零导致十年空气滞留分数未定义，则标记此情况。\n\n所有物理量必须使用适当的单位处理：人为排放 $E_t$ 和大气增长 $G_t$ 的单位是每年十亿吨碳 ($\\mathrm{GtC/yr}$)。空气滞留分数是无单位的小数。所有三角函数角度均以弧度解释。所有输出均以小数或整数表示；不要使用百分号。\n\n你的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，格式如下：\n- 对于每个测试用例，输出一个形式为 $[a_f, a_\\sigma, s_e, s_g, s_c, d]$ 的列表，其中：\n    - $a_f$ 是十年空气滞留分数，一个无单位小数。\n    - $a_\\sigma$ 是年度空气滞留分数的年际标准差（无单位）。\n    - $s_e$ 是可归因于排放变率的方差份额（无单位小数）。\n    - $s_g$ 是可归因于大气增长变率的方差份额（无单位小数）。\n    - $s_c$ 是可归因于排放与大气增长之间协方差的方差份额（无单位小数，可为负）。\n    - $d$ 是一个整数诊断标志，如果十年排放量为严格正值且十年空气滞留分数已定义，则等于$1$，否则为$0$。\n将三个测试用例的输出汇总到一个列表中，例如 $[[\\dots],[\\dots],[\\dots]]$。\n\n测试套件：\n使用以下三个十年测试用例。每个十年由 $t \\in \\{0,1,2,3,4,5,6,7,8,9\\}$ 索引，三角函数参数以弧度为单位。\n\n- 案例 A（排放增长，中等汇变率）：\n    - 排放：$E_t = 10 + 0.2\\,(t - 4.5) + 0.1\\,\\cos\\left(\\pi t / 5\\right)$，单位 GtC/yr。\n    - 大气增长：$G_t = 0.48\\,E_t + 0.5\\,\\sin\\left(2\\pi t / 10\\right) + 0.05\\,\\cos\\left(\\pi t / 5\\right)$，单位 GtC/yr。\n\n- 案例 B（低排放且包含零排放年份，弱汇变率）：\n    - 排放：$E_t$ 由序列明确给出，单位 GtC/yr\n      $[0.0,\\,0.5,\\,1.0,\\,1.5,\\,2.0,\\,1.5,\\,1.0,\\,0.5,\\,0.0,\\,0.5]$。\n    - 大气增长：$G_t = 0.55\\,E_t + 0.1\\,\\sin\\left(2\\pi t / 10\\right)$，单位 GtC/yr。\n\n- 案例 C（恒定排放，强汇变率）：\n    - 排放：对于所有 $t$，$E_t = 9.5$，单位 GtC/yr。\n    - 大气增长：$G_t = 0.45\\,E_t + 1.0\\,\\sin\\left(2\\pi t / 10\\right)$，单位 GtC/yr。\n\n在你的程序中应遵循的算法要求和定义：\n- 年份 $t$ 的年度空气滞留分数仅在 $E_t > 0$ 时有明确定义，并且是该年度 $G_t$ 和 $E_t$ 之间符合质量守恒的无量纲比率。\n- 十年空气滞留分数是在十年期间 $\\sum_t G_t$ 和 $\\sum_t E_t$ 之间符合质量守恒的唯一无量纲比率。如果 $\\sum_t E_t = 0$，将诊断标志 $d=0$ 并将 $a_f$ 定义为非数字（not-a-number）以表示未定义。\n- 对于年度空气滞留分数 $A_t$ 的方差分解，使用 $E_t > 0$ 的有效年份，并计算这些年份的平均值 $\\bar{E}$ 和 $\\bar{G}$。令 $e_t = E_t - \\bar{E}$ 和 $g_t = G_t - \\bar{G}$。使用 $A_t$ 关于 $(\\bar{E},\\bar{G})$ 的一阶扰动，近似的方差贡献是 $\\mathrm{Var}(e_t)$、$\\mathrm{Var}(g_t)$ 和 $\\mathrm{Cov}(g_t,e_t)$ 以及 $\\bar{E}$ 和 $\\bar{G}$ 的函数。将份额 $s_e$、$s_g$ 和 $s_c$ 报告为各贡献除以 $A_t$ 的总方差。如果 $A_t$ 的方差为零，则设置 $s_e=s_g=s_c=0$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如 $[[0.5,0.1,0.3,0.7,0.0,1],[\\dots],[\\dots]]$）。",
            "solution": "该问题被评估为有效。它科学上基于应用于全球碳循环的质量守恒原理，这是气候科学中的一个核心概念。该问题是适定的，提供了所有必要的数据、明确的函数形式以及待计算量的清晰、无歧义的定义。所使用的术语，如空气滞留分数、人为排放和大气增长，都是该领域的标准术语。所涉及的数学任务，包括时间序列分析和用于方差分解的一阶扰动，是进行敏感性分析的标准且适当的技术。该问题是客观的、定量的，并且没有任何逻辑矛盾或事实不准确之处。\n\n解决方案首先建立理论框架，然后推导所需量的公式。\n\n基本原理是大气碳的质量守恒。大气中碳质量的变化率，称为大气增长率（$G_t$），等于人为排放率（$E_t$）减去自然汇（海洋和陆地）的吸收率 $S_{nat}$。\n$$ \\frac{dC_{atm}}{dt} = G_t = E_t - S_{nat, t} $$\n所有量均以每年十亿吨碳（$\\mathrm{GtC/yr}$）为单位。\n\n1.  **空气滞留分数（$a_f$ 和 $A_t$）**\n    空气滞留分数是在给定时间段内大气增长与人为排放之间的无量纲比率。\n\n    特定年份 $t$ 的**年度空气滞留分数**定义为：\n    $$ A_t = \\frac{G_t}{E_t} $$\n    该量仅在排放为严格正值时，即 $E_t > 0$ 时，才具有物理和数学意义。\n\n    **十年空气滞留分数**（$a_f$）是基于整个十年（$t=0$ 到 $t=9$）的总质量守恒来定义的。它是该十年期间大气中累积的总碳质量与同期排放的总碳质量之比。假设年度时间步长（$\\Delta t = 1$ 年），则为：\n    $$ a_f = \\frac{\\text{总大气增长}}{\\text{总排放}} = \\frac{\\sum_{t=0}^{9} G_t}{\\sum_{t=0}^{9} E_t} $$\n    如果十年总排放量 $\\sum_{t=0}^{9} E_t = 0$，则此值未定义。如果 $\\sum_{t=0}^{9} E_t > 0$，则诊断标志 $d$ 设置为 $1$，否则为 $0$。\n\n2.  **年际变率（$a_\\sigma$）**\n    空气滞留分数的年际变率通过年度空气滞留分数序列 $A_t$ 的标准差来量化。此计算仅在 $E_t > 0$ 的年份集合 $\\mathcal{T}_{valid}$ 上进行。设 $N_{valid}$ 为此类年份的数量。标准差 $a_\\sigma$ 为：\n    $$ a_\\sigma = \\sqrt{\\frac{1}{N_{valid}} \\sum_{t \\in \\mathcal{T}_{valid}} (A_t - \\bar{A})^2} $$\n    其中 $\\bar{A}$ 是有效年份内年度空气滞留分数的平均值：\n    $$ \\bar{A} = \\frac{1}{N_{valid}} \\sum_{t \\in \\mathcal{T}_{valid}} A_t $$\n    我们使用总体标准差，因为这十年代表了整个感兴趣的总体。\n\n3.  **方差分解（$s_e, s_g, s_c$）**\n    为了将年度空气滞留分数的方差 $\\mathrm{Var}(A_t)$ 分解为可归因于排放（$E_t$）和大气增长（$G_t$）变率的分量，我们使用一阶泰勒展开（扰动分析）。该分析在有效年份 $\\mathcal{T}_{valid}$ 的数据上进行。\n\n    设 $\\bar{E}$ 和 $\\bar{G}$ 为这些有效年份的平均排放量和平均增长量。我们将年度值表示为平均值加上一个扰动：\n    $E_t = \\bar{E} + e_t$\n    $G_t = \\bar{G} + g_t$\n    其中 $e_t$ 和 $g_t$ 是年份 $t$ 相对于平均值的偏差。\n\n    年度空气滞留分数 $A_t$ 可以写成：\n    $$ A_t = \\frac{G_t}{E_t} = \\frac{\\bar{G} + g_t}{\\bar{E} + e_t} = \\frac{\\bar{G}}{\\bar{E}} \\left( \\frac{1 + g_t/\\bar{G}}{1 + e_t/\\bar{E}} \\right) $$\n    对于小的 $x = e_t/\\bar{E}$，使用一阶近似 $(1+x)^{-1} \\approx 1-x$，我们得到：\n    $$ A_t \\approx \\frac{\\bar{G}}{\\bar{E}} (1 + g_t/\\bar{G})(1 - e_t/\\bar{E}) \\approx \\frac{\\bar{G}}{\\bar{E}} \\left(1 + \\frac{g_t}{\\bar{G}} - \\frac{e_t}{\\bar{E}} \\right) $$\n    在这里我们忽略了二阶项 $(g_t e_t)/(\\bar{G}\\bar{E})$。这简化为 $A_t$ 的一阶近似：\n    $$ A_t \\approx \\frac{\\bar{G}}{\\bar{E}} + \\frac{g_t}{\\bar{E}} - \\frac{\\bar{G} e_t}{\\bar{E}^2} $$\n    这个 $A_t$ 近似表达式的方差是：\n    $$ \\mathrm{Var}(A_t) \\approx \\mathrm{Var}\\left( \\frac{g_t}{\\bar{E}} - \\frac{\\bar{G} e_t}{\\bar{E}^2} \\right) $$\n    使用属性 $\\mathrm{Var}(aX + bY) = a^2\\mathrm{Var}(X) + b^2\\mathrm{Var}(Y) + 2ab\\mathrm{Cov}(X,Y)$，展开为：\n    $$ \\mathrm{Var}(A_t) \\approx \\frac{1}{\\bar{E}^2}\\mathrm{Var}(g_t) + \\frac{\\bar{G}^2}{\\bar{E}^4}\\mathrm{Var}(e_t) - \\frac{2\\bar{G}}{\\bar{E}^3}\\mathrm{Cov}(g_t, e_t) $$\n    因为 $\\mathrm{Var}(g_t) = \\mathrm{Var}(G_t)$，$\\mathrm{Var}(e_t) = \\mathrm{Var}(E_t)$，以及 $\\mathrm{Cov}(g_t, e_t) = \\mathrm{Cov}(G_t, E_t)$，我们可以确定近似方差的三个贡献部分：\n    -   来自增长变率的贡献：$V_g = \\frac{\\mathrm{Var}(G_t)}{\\bar{E}^2}$\n    -   来自排放变率的贡献：$V_e = \\frac{\\bar{G}^2 \\mathrm{Var}(E_t)}{\\bar{E}^4}$\n    -   来自协方差的贡献：$V_c = -\\frac{2\\bar{G} \\mathrm{Cov}(G_t, E_t)}{\\bar{E}^3}$\n\n    问题要求将这些贡献表示为年度空气滞留分数*实际*总方差 $\\sigma_A^2 = \\mathrm{Var}(A_t)$ 的份额，该方差直接从序列 $\\{A_t\\}_{t \\in \\mathcal{T}_{valid}}$ 计算得出。因此，份额为：\n    $$ s_g = \\frac{V_g}{\\sigma_A^2} \\quad, \\quad s_e = \\frac{V_e}{\\sigma_A^2} \\quad, \\quad s_c = \\frac{V_c}{\\sigma_A^2} $$\n    如果 $\\sigma_A^2 = 0$，则所有份额都定义为 $0$。注意，由于这是一阶近似，份额之和 $s_e + s_g + s_c$ 不保证等于 $1$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_metrics(E_t, G_t):\n    \"\"\"\n    Computes carbon cycle metrics for a given decadal time series.\n\n    Args:\n        E_t (np.ndarray): Time series of anthropogenic emissions (GtC/yr).\n        G_t (np.ndarray): Time series of atmospheric growth (GtC/yr).\n\n    Returns:\n        list: A list containing [a_f, a_sigma, s_e, s_g, s_c, d].\n    \"\"\"\n    sum_E = np.sum(E_t)\n\n    # Check for non-positive total decadal emissions\n    if not sum_E  0:\n        d = 0\n        a_f = np.nan\n        a_sigma = np.nan\n        s_e, s_g, s_c = np.nan, np.nan, np.nan\n        return [a_f, a_sigma, s_e, s_g, s_c, d]\n    \n    d = 1\n    \n    # 1. Decadal airborne fraction\n    sum_G = np.sum(G_t)\n    a_f = sum_G / sum_E\n    \n    # 2. Interannual variability\n    # Identify valid years where annual AF is well-defined (E_t  0)\n    valid_indices = E_t  0\n    E_valid = E_t[valid_indices]\n    G_valid = G_t[valid_indices]\n    \n    if E_valid.size == 0:\n        # No years with positive emissions, so no basis for interannual variability\n        return [a_f, 0.0, 0.0, 0.0, 0.0, d]\n        \n    A_t_valid = G_valid / E_valid\n    a_sigma = np.std(A_t_valid)  # Population standard deviation (ddof=0 is default)\n    \n    # 3. Variance Decomposition\n    var_A = np.var(A_t_valid) # Population variance (ddof=0 is default)\n    \n    # Per problem spec, if variance is zero, all shares are zero.\n    if np.isclose(var_A, 0):\n        s_e, s_g, s_c = 0.0, 0.0, 0.0\n    else:\n        # Calculate means, variances, and covariance over valid years\n        E_bar = np.mean(E_valid)\n        G_bar = np.mean(G_valid)\n        \n        var_E = np.var(E_valid)\n        var_G = np.var(G_valid)\n        \n        # Must use ddof=0 for population covariance to be consistent\n        cov_GE = np.cov(G_valid, E_valid, ddof=0)[0, 1]\n        \n        # First-order perturbation contributions to variance\n        V_g = var_G / (E_bar**2)\n        V_e = (G_bar**2 * var_E) / (E_bar**4)\n        V_c = (-2 * G_bar * cov_GE) / (E_bar**3)\n        \n        # Shares of total actual variance\n        s_g = V_g / var_A\n        s_e = V_e / var_A\n        s_c = V_c / var_A\n        \n    return [a_f, a_sigma, s_e, s_g, s_c, d]\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    all_results = []\n    \n    # Define the time vector for the decade\n    t = np.arange(10, dtype=float)\n\n    # --- Test Case A ---\n    E_t_A = 10.0 + 0.2 * (t - 4.5) + 0.1 * np.cos(np.pi * t / 5.0)\n    G_t_A = 0.48 * E_t_A + 0.5 * np.sin(2.0 * np.pi * t / 10.0) + 0.05 * np.cos(np.pi * t / 5.0)\n    results_A = calculate_metrics(E_t_A, G_t_A)\n    all_results.append(results_A)\n\n    # --- Test Case B ---\n    E_t_B = np.array([0.0, 0.5, 1.0, 1.5, 2.0, 1.5, 1.0, 0.5, 0.0, 0.5])\n    G_t_B = 0.55 * E_t_B + 0.1 * np.sin(2.0 * np.pi * t / 10.0)\n    results_B = calculate_metrics(E_t_B, G_t_B)\n    all_results.append(results_B)\n\n    # --- Test Case C ---\n    E_t_C = np.full_like(t, 9.5)\n    G_t_C = 0.45 * E_t_C + 1.0 * np.sin(2.0 * np.pi * t / 10.0)\n    results_C = calculate_metrics(E_t_C, G_t_C)\n    all_results.append(results_C)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "为了预测全球碳循环的未来行为，我们必须超越宏观预算，深入探索其核心过程。本练习揭示了地球系统模型中陆地碳汇模块的内部机制，特别是土壤有机碳的动态。您将通过推导一个多室模型（multi-compartment model）的稳态解，来理解土壤碳储量如何由凋落物输入和分解速率之间的平衡决定，并分析该平衡如何响应温度等环境因子的变化，这正是理解碳-气候反馈的关键所在 。",
            "id": "4100261",
            "problem": "一个综合性数值天气预报（NWP）和气候模拟系统中的陆面碳模块将土壤有机碳表示为一组由 $n$ 个相互连通的仓室（库）组成的集合，其分解过程为一级动力学。设土壤碳状态向量为 $\\mathbf{C}(t) \\in \\mathbb{R}^{n}$，恒定的凋落物输入向量为 $\\mathbf{L} \\in \\mathbb{R}^{n}$，其各分量均为非负值。每个碳库 $i$ 以一个基础速率常数 $k_{i}  0$ 分解，这些常数构成对角矩阵 $\\mathbf{K} = \\mathrm{diag}(k_{1}, \\dots, k_{n})$。从碳库 $i$ 分解通量中，有一部分（比例为 $a_{ij} \\in [0,1]$）会瞬间转移到碳库 $j$，剩余部分则通过呼吸作用释放到大气中；定义转移矩阵 $\\mathbf{A} \\in \\mathbb{R}^{n \\times n}$，其元素为 $a_{ij}$，并假设行和对所有 $i$ 均满足 $\\sum_{j=1}^{n} a_{ij} \\le 1$。环境条件通过一个标量 $s(T,\\theta)$ 对所有分解通量进行乘法调节，其中 $T$ 是温度（以摄氏度表示），$\\theta$ 是一个无量纲的土壤湿度指数。该调节因子由 $s(T,\\theta) = f_{T}(T)\\,f_{\\theta}(\\theta)$ 给出，其中使用了温度敏感性因子（$Q_{10}$）：$f_{T}(T) = Q_{10}^{(T - T_{\\mathrm{ref}})/10}$，其中 $Q_{10}  1$，参考温度为 $T_{\\mathrm{ref}}$，湿度标量 $f_{\\theta}(\\theta) \\in (0,1]$ 是 $\\theta$ 的一个固定函数。\n\n在这些假设下，将土壤碳动态建模为一个由 $\\mathbf{L}$ 驱动并遵循质量守恒的线性仓室系统。假设矩阵 $\\mathbf{M} = (\\mathbf{I} - \\mathbf{A})\\,\\mathbf{K}$ 是非奇异的。假设系统处于初始环境状态 $(T_{0},\\theta_{0})$，调节因子为 $s_{0} = s(T_{0},\\theta_{0})$，并且系统已经平衡至稳态 $\\mathbf{C}^{*}_{0}$。在时间 $t=0$ 时，一次突发的升温事件使温度变为新的常数 $T_{1}$，而湿度保持在 $\\theta_{0}$，因此调节因子变为 $s_{1} = s(T_{1},\\theta_{0})$。系统重新平衡至新的稳态 $\\mathbf{C}^{*}_{1}$。设稳态下的总土壤碳储量为 $S = \\mathbf{1}^{\\top}\\mathbf{C}^{*}$，其中 $\\mathbf{1}$ 是 $n$ 维全一向量。\n\n从质量守恒基本定律以及指定的一级动力学和转移结构出发，推导稳态解，并解释环境标量 $s$ 如何影响平衡。然后，确定升温后与升温前总稳态土壤碳储量之比 $R = S_{1}/S_{0}$ 的一个封闭形式解析表达式，该表达式仅用 $Q_{10}$、$T_{0}$、$T_{1}$ 和 $T_{\\mathrm{ref}}$ 表示。你可以假设 $f_{\\theta}(\\theta_{0})$ 在整个变化过程中保持不变。提供 $R$ 的表达式作为最终答案。不需要进行数值计算，也不需要四舍五入。最终答案必须是无量纲的。",
            "solution": "问题要求计算在温度突变前后，总稳态土壤碳储量的比值。该系统被描述为一个线性仓室模型。求解过程需要首先推导控制方程，然后找出稳态解，最后计算所求的比值。\n\n设 $\\mathbf{C}(t) = [C_1(t), C_2(t), \\dots, C_n(t)]^{\\top}$ 是 $n$ 个土壤仓室在时间 $t$ 的碳储量向量。任意仓室 $i$ 中碳储量的动态变化由一个质量平衡方程控制：碳库中碳的变化率等于所有输入之和减去所有输出之和。\n\n仓室 $i$ 的输入包括：\n1.  来自系统外部的凋落物输入，由向量 $\\mathbf{L}$ 的第 $i$ 个分量 $L_i$ 给出。\n2.  从其他仓室 $j$ 转移到仓室 $i$ 的碳。问题说明，从碳库 $j$ 分解通量的一部分（比例为 $a_{ji}$）会转移到碳库 $i$。碳库 $j$ 的分解通量为 $s(T,\\theta) k_j C_j(t)$。因此，从所有其他碳库输入到碳库 $i$ 的总量为 $\\sum_{j=1}^{n} a_{ji} s(T,\\theta) k_j C_j(t)$。\n\n仓室 $i$ 的输出是其总分解通量，即 $s(T,\\theta) k_i C_i(t)$。该通量被分配到向大气的呼吸作用和其他仓室的转移中。\n\n综合这些项，仓室 $i$ 的质量平衡方程为：\n$$ \\frac{dC_i}{dt} = L_i + \\sum_{j=1}^{n} a_{ji} s(T,\\theta) k_j C_j(t) - s(T,\\theta) k_i C_i(t) $$\n\n这 $n$ 个常微分方程组可以用矩阵-向量形式表示。设 $\\mathbf{A}$ 是元素为 $a_{ij}$ 的矩阵，$\\mathbf{K}$ 是元素为 $k_i$ 的对角矩阵。项 $\\sum_{j=1}^{n} a_{ji} s(T,\\theta) k_j C_j(t)$ 是向量 $s(T,\\theta) \\mathbf{A}^{\\top} \\mathbf{K} \\mathbf{C}(t)$ 的第 $i$ 个元素。项 $s(T,\\theta) k_i C_i(t)$ 是向量 $s(T,\\theta) \\mathbf{K} \\mathbf{C}(t)$ 的第 $i$ 个元素。因此，该方程组为：\n$$ \\frac{d\\mathbf{C}}{dt} = \\mathbf{L} + s(T,\\theta) \\mathbf{A}^{\\top} \\mathbf{K} \\mathbf{C} - s(T,\\theta) \\mathbf{K} \\mathbf{C} $$\n$$ \\frac{d\\mathbf{C}}{dt} = \\mathbf{L} - s(T,\\theta) (\\mathbf{I} - \\mathbf{A}^{\\top}) \\mathbf{K} \\mathbf{C} $$\n然而，问题中将矩阵 $\\mathbf{M} = (\\mathbf{I} - \\mathbf{A})\\mathbf{K}$ 标明为重要，这暗示了转移过程可能采用了另一种索引约定。让我们重新考虑这个公式。如果 $a_{ij}$ 是从碳库 $i$ 分解的通量中转移*到*碳库 $j$ 的比例，那么仓室 $j$ 的质量平衡方程是：\n$$ \\frac{dC_j}{dt} = L_j + \\sum_{i=1}^{n} (\\text{transfer } i \\to j) - (\\text{decomposition of } j) $$\n$$ \\frac{dC_j}{dt} = L_j + \\sum_{i=1}^{n} a_{ij} s(T,\\theta) k_i C_i(t) - s(T,\\theta) k_j C_j(t) $$\n求和项 $\\sum_{i=1}^{n} a_{ij} s k_i C_i$ 是矩阵-向量积 $s \\mathbf{A} \\mathbf{K} \\mathbf{C}$ 的第 $j$ 个分量。因此，该系统变为：\n$$ \\frac{d\\mathbf{C}}{dt} = \\mathbf{L} + s(T,\\theta) \\mathbf{A} \\mathbf{K} \\mathbf{C} - s(T,\\theta) \\mathbf{K} \\mathbf{C} $$\n$$ \\frac{d\\mathbf{C}}{dt} = \\mathbf{L} - s(T,\\theta) (\\mathbf{I} - \\mathbf{A}) \\mathbf{K} \\mathbf{C} $$\n使用问题中提供的定义 $\\mathbf{M} = (\\mathbf{I} - \\mathbf{A}) \\mathbf{K}$，系统动态方程为：\n$$ \\frac{d\\mathbf{C}}{dt} = \\mathbf{L} - s(T,\\theta) \\mathbf{M} \\mathbf{C} $$\n这个公式与问题陈述中给出的信息一致。\n\n在稳态下，碳储量是恒定的，所以 $\\frac{d\\mathbf{C}}{dt} = \\mathbf{0}$。设稳态碳向量为 $\\mathbf{C}^{*}$。方程变为：\n$$ \\mathbf{0} = \\mathbf{L} - s \\mathbf{M} \\mathbf{C}^{*} $$\n$$ s \\mathbf{M} \\mathbf{C}^{*} = \\mathbf{L} $$\n问题陈述 $\\mathbf{M}$ 是非奇异的。环境标量 $s(T,\\theta) = f_T(T) f_\\theta(\\theta)$ 是严格为正的，因为 $Q_{10}  1$ 且 $f_\\theta(\\theta) \\in (0,1]$。因此，我们可以求解唯一的稳态向量 $\\mathbf{C}^{*}$：\n$$ \\mathbf{C}^{*} = \\frac{1}{s} \\mathbf{M}^{-1} \\mathbf{L} $$\n这个表达式表明，稳态碳储量向量 $\\mathbf{C}^{*}$ 与环境标量 $s$ 成反比。物理上，这意味着对于固定的输入速率 $\\mathbf{L}$，更高的分解速率（更大的 $s$）会导致更低的平衡碳储量。\n\n稳态下的总土壤碳储量 $S$ 是 $\\mathbf{C}^{*}$ 各元素之和，可以写为 $S = \\mathbf{1}^{\\top}\\mathbf{C}^{*}$，其中 $\\mathbf{1}$ 是 $n$ 维列向量（所有元素均为1）。\n$$ S = \\mathbf{1}^{\\top} \\left( \\frac{1}{s} \\mathbf{M}^{-1} \\mathbf{L} \\right) = \\frac{1}{s} \\left( \\mathbf{1}^{\\top} \\mathbf{M}^{-1} \\mathbf{L} \\right) $$\n括号中的项 $\\mathbf{1}^{\\top} \\mathbf{M}^{-1} \\mathbf{L}$ 是一个标量常数，由土壤系统的内在属性（$\\mathbf{A}$、$\\mathbf{K}$）和凋落物输入（$\\mathbf{L}$）决定，但它与封装在 $s$ 中的环境条件无关。\n\n我们现在将此结果应用于两个指定的环境状态。\n1.  **升温前状态（下标为 $0$）**：系统在温度 $T_0$ 和湿度 $\\theta_0$ 下处于稳态。环境标量为 $s_0 = s(T_0, \\theta_0)$。总稳态碳储量为 $S_0$。\n    $$ S_0 = \\frac{1}{s_0} \\left( \\mathbf{1}^{\\top} \\mathbf{M}^{-1} \\mathbf{L} \\right) $$\n\n2.  **升温后状态（下标为 $1$）**：系统在温度 $T_1$ 和湿度 $\\theta_0$ 下达到新的稳态。环境标量为 $s_1 = s(T_1, \\theta_0)$。新的总稳态碳储量为 $S_1$。\n    $$ S_1 = \\frac{1}{s_1} \\left( \\mathbf{1}^{\\top} \\mathbf{M}^{-1} \\mathbf{L} \\right) $$\n\n问题要求计算比值 $R = S_1 / S_0$。\n$$ R = \\frac{S_1}{S_0} = \\frac{\\frac{1}{s_1} \\left( \\mathbf{1}^{\\top} \\mathbf{M}^{-1} \\mathbf{L} \\right)}{\\frac{1}{s_0} \\left( \\mathbf{1}^{\\top} \\mathbf{M}^{-1} \\mathbf{L} \\right)} = \\frac{s_0}{s_1} $$\n在比值中，所有仓室模型的参数（$\\mathbf{A}$、$\\mathbf{K}$、$\\mathbf{L}$）的细节都被消去了。\n\n现在，我们代入 $s_0$ 和 $s_1$ 的定义。\n环境调节因子为 $s(T,\\theta) = f_{T}(T)\\,f_{\\theta}(\\theta) = Q_{10}^{(T - T_{\\mathrm{ref}})/10} f_{\\theta}(\\theta)$。\n所以，对于升温前状态：\n$$ s_0 = Q_{10}^{(T_0 - T_{\\mathrm{ref}})/10} f_{\\theta}(\\theta_0) $$\n对于升温后状态（温度为 $T_1$，湿度不变为 $\\theta_0$）：\n$$ s_1 = Q_{10}^{(T_1 - T_{\\mathrm{ref}})/10} f_{\\theta}(\\theta_0) $$\n将这些代入 $R$ 的表达式中：\n$$ R = \\frac{s_0}{s_1} = \\frac{Q_{10}^{(T_0 - T_{\\mathrm{ref}})/10} f_{\\theta}(\\theta_0)}{Q_{10}^{(T_1 - T_{\\mathrm{ref}})/10} f_{\\theta}(\\theta_0)} $$\n湿度标量 $f_{\\theta}(\\theta_0)$ 在分子和分母中相同，可以消去。\n$$ R = \\frac{Q_{10}^{(T_0 - T_{\\mathrm{ref}})/10}}{Q_{10}^{(T_1 - T_{\\mathrm{ref}})/10}} $$\n使用指数法则 $x^a / x^b = x^{a-b}$：\n$$ R = Q_{10}^{\\left( \\frac{T_0 - T_{\\mathrm{ref}}}{10} - \\frac{T_1 - T_{\\mathrm{ref}}}{10} \\right)} $$\n$$ R = Q_{10}^{\\frac{(T_0 - T_{\\mathrm{ref}}) - (T_1 - T_{\\mathrm{ref}})}{10}} $$\n$$ R = Q_{10}^{\\frac{T_0 - T_{\\mathrm{ref}} - T_1 + T_{\\mathrm{ref}}}{10}} $$\n$$ R = Q_{10}^{\\frac{T_0 - T_1}{10}} $$\n这就是总稳态土壤碳储量比值的最终封闭形式表达式。根据要求，它仅取决于温度敏感性 $Q_{10}$ 以及初始和最终温度 $T_0$ 和 $T_1$。",
            "answer": "$$\\boxed{Q_{10}^{\\frac{T_{0} - T_{1}}{10}}}$$"
        }
    ]
}