{
    "hands_on_practices": [
        {
            "introduction": "对于像欧拉方程这样的双曲型系统，信息是沿着特征线传播的。一个物理上合理的边界条件必须区分进入计算区域的信息（必须被指定或松弛）和离开计算区域的信息（应被允许无反射地通过）。本练习 () 将运用特征分析这一基本工具，来精确确定在给定边界上需要为多少个以及哪些变量族提供边界数据，这是设计任何边界松弛方案的理论第一步。",
            "id": "4059587",
            "problem": "考虑理想气体的三维可压缩欧拉方程，该方程已在密度为$\\rho_{0}$、压力为$p_{0}$、速度为$\\mathbf{U}_{0}$的空间均匀平均态附近进行了线性化。声速为$c$，它与热力学状态的关系式为$c^{2}=\\gamma p_{0}/\\rho_{0}$，其中比热比$\\gamma>1$。您正在为数值天气预报（NWP）建立一个有限区域模式，并且您将只对进入该区域的特征变量施加侧边界松弛。\n\n重点考虑一个垂直侧边界$\\Gamma$，它是一个平面，其单位外法向量为$\\mathbf{n}=(-1,0,0)$（一个西边界）。均匀平均风为$\\mathbf{U}_{0}=(15,0,0)$ m s$^{-1}$，声速为$c=340$ m s$^{-1}$。运用线性双曲系统的基本原理和特征分析，确定在边界$\\Gamma$处有多少个入射特征变量，因此必须由侧边界格式指定或松弛。同时，用文字说明这些入射变量对应于哪些特征族。请以整数形式给出最终答案（不带单位）。不要四舍五入。",
            "solution": "该问题要求分析三维线性化可压缩欧拉方程在一个数值模式区域的特定侧边界上的边界条件。必须指定的边界条件数量等于与传播进入计算区域的波相对应的特征变量的数量。这个数量是通过分析系统在垂直于边界方向上的特征速度（特征值）的符号来确定的。\n\n该方程组是三维可压缩欧拉方程，在以速度$\\mathbf{U}_{0}$、密度$\\rho_{0}$和压力$p_{0}$为特征的均匀平均态附近进行了线性化。该系统包含五个方程，分别对应质量守恒、三个动量分量守恒和能量守恒。因此，对于任何给定的传播方向，都有五个特征变量和五个相关的特征速度。\n\n所讨论的边界$\\Gamma$是一个平面，其单位外法向量为$\\mathbf{n}=(-1,0,0)$。这在标准笛卡尔坐标系$(x,y,z)$中对应于一个西边界。计算区域位于该边界的东侧，即$x$值增大的区域。因此，指向区域*内部*的方向是$x$轴正方向。如果一个特征波沿$x$轴正方向传播，则认为它在该边界是“入射”的。在$x$方向上传播的特征波的传播速度由欧拉方程的通量雅可比矩阵$\\mathbf{A}_x$在平均态下的特征值给出。\n\n对于三维欧拉方程，在速度为$\\mathbf{U}_{0} = (U_0, V_0, W_0)$的平均态下，沿$x$方向传播的波的特征速度由以下特征值集合给出：\n$$\n\\lambda_x \\in \\{U_0, U_0, U_0, U_0 - c, U_0 + c\\}\n$$\n这里，$U_0$是平均风在$x$方向上的分量，$c$是声速。特征值$U_0$的重数为三。\n\n问题提供了以下数值：\n- 平均风向量：$\\mathbf{U}_{0} = (15, 0, 0)$ m s$^{-1}$。由此可得平均速度的$x$分量为$U_0 = 15$ m s$^{-1}$。\n- 声速：$c = 340$ m s$^{-1}$。\n\n现在，我们可以将这些值代入特征速度的表达式中：\n1.  三个特征值等于平流速度$U_0$：\n    $$ \\lambda_{1,2,3} = U_0 = 15 \\, \\text{m s}^{-1} $$\n2.  一个特征值对应于一个逆着流向传播的声波：\n    $$ \\lambda_4 = U_0 - c = 15 - 340 = -325 \\, \\text{m s}^{-1} $$\n3.  一个特征值对应于一个顺着流向传播的声波：\n    $$ \\lambda_5 = U_0 + c = 15 + 340 = 355 \\, \\text{m s}^{-1} $$\n\n入射特征变量的数量等于这些特征速度中为正值的数量，因为正速度表示沿$x$轴正方向传播，即进入计算区域。我们来检查这些速度的符号：\n-   $\\lambda_{1,2,3} = 15 > 0$。这三个特征是入射的。\n-   $\\lambda_4 = -325  0$。这个特征是出射的。\n-   $\\lambda_5 = 355 > 0$。这个特征是入射的。\n\n通过统计正特征值的数量，我们发现有$3 + 1 = 4$个入射特征。因此，在这个西边界上必须指定$4$个边界条件。\n\n问题还要求指出这些入射变量对应的特征族。\n-   速度为$\\lambda = U_0$的三个特征是平流模态。它们对应于平均流对熵和两个切向速度分量（$v'$和$w'$）的平流输运。由于$U_0 > 0$，平均流正进入计算区域，并携带这些信息。这些特征族是一个熵波和两个剪切波。\n-   速度为$\\lambda = U_0+c$的特征是一个声学模态（声波）。其正速度表明它向区域内部传播。\n-   速度为$\\lambda = U_0-c$的特征也是一个声学模态。其负速度表明它向区域外部传播。\n\n总之，必须在边界上指定的四个入射特征对应于一个熵波、两个剪切波（切向速度分量）和两个声波中的一个。\n因此，入射特征的数量为$4$。",
            "answer": "$$\n\\boxed{4}\n$$"
        },
        {
            "introduction": "在确定了需要对哪些变量进行松弛之后，一个自然的问题是，“海绵层”在物理上是如何实现其功能的？本练习 () 将缓冲区域模型化为一个能量汇，以帮助我们直观地理解其工作原理。通过推导和求解稳态能量收支，你将能够量化松弛项如何从入射波中提取能量，从而有效地抑制波在边界处的反射并保护内部解的准确性。",
            "id": "4059542",
            "problem": "考虑一个在数值天气预报（NWP）和气候模拟中使用的二维侧向边界松弛配置。一个矩形通道区域占据 $x \\in [0, L]$ 和 $y \\in [0, L_y]$。侧向边界缓冲区定义为 $x \\in [0, L_b]$，其中有一个松弛（海绵）项在起作用。在缓冲区之外，对于 $x > L_b$，松弛为零。在缓冲区内，一个标量预报场 $\\phi(x,y,t)$ 由线性平流-松弛方程控制\n$$\n\\frac{\\partial \\phi}{\\partial t} + c\\,\\frac{\\partial \\phi}{\\partial x} \\;=\\; -\\alpha(x)\\,\\phi,\n$$\n其中 $c > 0$ 为常数，$\\alpha(x)$ 定义为\n$$\n\\alpha(x) \\;=\\; \\alpha_0\\left(\\frac{x}{L_b}\\right)^2 \\quad \\text{for } x \\in [0, L_b], \\quad \\alpha(x)=0 \\quad \\text{for } x > L_b,\n$$\n其中 $\\alpha_0 > 0$ 和 $L_b > 0$ 是给定参数。假设 $y$ 方向是均匀的，在缓冲区内的强迫或响应中没有对 $y$ 的依赖性。在 $x=0$ 处的侧向边界条件是一个稳定强迫 $\\phi(0,y,t)=\\Phi_0$，其中 $\\Phi_0 > 0$ 不随时间变化且在 $y$ 方向上是均匀的。\n\n将 $\\phi$ 的二次能量密度定义为\n$$\n\\mathcal{E}(x,t) \\;=\\; \\frac{1}{2}\\,\\phi(x,t)^2,\n$$\n并将 $x$ 方向的平流能量通量取为 $c\\,\\mathcal{E}$。从平流-松弛方程和 $\\mathcal{E}$ 的定义出发，推导缓冲区中的稳态（$\\partial/\\partial t=0$）能量收支，并用它来计算：\n- 通过 $x=0$ 边界的能量流入率，在跨度 $L_y$ 上积分，\n- 由松弛作用引起的能量提取率，在 $x \\in [0, L_b]$ 和跨度 $L_y$ 上积分，\n- 进入内部区域（$x > L_b$）的净能量流入率，定义为 $x=0$ 处的流入率与在 $x \\in [0, L_b]$ 内的积分提取率之差。\n\n假设在 $x \\in [0, L_b]$ 内已达到稳态解，并且在整个缓冲区内 $\\phi$ 在 $y$ 方向上是均匀的。将进入内部区域的最终净能量流入率表示为关于 $c$, $\\Phi_0$, $\\alpha_0$, $L_b$ 和 $L_y$ 的单个闭合形式解析表达式。以焦耳每秒每米（W m$^{-1}$）表示最终的率。在您方框内的最终答案中不要包含单位。无需四舍五入。",
            "solution": "问题要求计算进入内部区域 $x > L_b$ 的净能量流入率，该系统在缓冲区 $x \\in [0, L_b]$ 内由一个线性平流-松弛方程控制。该率定义为 $x=0$ 边界处的能量流入与缓冲区内松弛机制提取的总能量之差。我们将首先推导稳态能量收支，然后求解稳态标量场 $\\phi(x)$，最后计算所需的率。\n\n首先，我们推导能量收支方程。标量场 $\\phi(x,t)$ 的控制方程是：\n$$\n\\frac{\\partial \\phi}{\\partial t} + c\\,\\frac{\\partial \\phi}{\\partial x} \\;=\\; -\\alpha(x)\\,\\phi\n$$\n二次能量密度定义为 $\\mathcal{E}(x,t) = \\frac{1}{2}\\phi(x,t)^2$。将控制方程乘以 $\\phi$ 得到：\n$$\n\\phi\\frac{\\partial \\phi}{\\partial t} + c\\,\\phi\\frac{\\partial \\phi}{\\partial x} \\;=\\; -\\alpha(x)\\,\\phi^2\n$$\n我们可以使用 $\\mathcal{E}$ 的定义重写这些项：\n$$\n\\frac{\\partial}{\\partial t}\\left(\\frac{1}{2}\\phi^2\\right) + \\frac{\\partial}{\\partial x}\\left(\\frac{1}{2}c\\,\\phi^2\\right) \\;=\\; -\\alpha(x)\\phi^2\n$$\n用能量密度 $\\mathcal{E}$ 和平流能量通量 $F_E = c\\,\\mathcal{E}$ 表示，方程为：\n$$\n\\frac{\\partial \\mathcal{E}}{\\partial t} + \\frac{\\partial F_E}{\\partial x} \\;=\\; -2\\alpha(x)\\mathcal{E}\n$$\n这个方程代表了局地能量收支。右边的项 $-2\\alpha(x)\\mathcal{E} = -\\alpha(x)\\phi^2$ 是由松弛引起的能量汇项。\n对于稳态，$\\frac{\\partial}{\\partial t} = 0$，所以稳态能量收支为：\n$$\n\\frac{d F_E}{dx} \\;=\\; -\\alpha(x)\\phi^2\n$$\n\n接下来，我们求解 $\\phi(x)$ 的稳态解。在稳态下，控制方程变为一个常微分方程：\n$$\nc\\,\\frac{d\\phi}{dx} \\;=\\; -\\alpha(x)\\,\\phi\n$$\n这是一个可分离的一阶常微分方程。我们可以将其写为：\n$$\n\\frac{d\\phi}{\\phi} \\;=\\; -\\frac{\\alpha(x)}{c}\\,dx\n$$\n我们使用边界条件 $\\phi(0) = \\Phi_0$，将此方程从边界 $x'=0$ 积分到缓冲区内的一点 $x$：\n$$\n\\int_{\\Phi_0}^{\\phi(x)} \\frac{d\\phi'}{\\phi'} \\;=\\; -\\frac{1}{c}\\int_{0}^{x} \\alpha(x')\\,dx'\n$$\n代入 $\\alpha(x) = \\alpha_0(x/L_b)^2$ 的给定形式：\n$$\n\\ln\\left(\\frac{\\phi(x)}{\\Phi_0}\\right) \\;=\\; -\\frac{1}{c}\\int_{0}^{x} \\alpha_0\\left(\\frac{x'}{L_b}\\right)^2\\,dx' \\;=\\; -\\frac{\\alpha_0}{c L_b^2}\\int_{0}^{x} (x')^2\\,dx'\n$$\n进行积分：\n$$\n\\ln\\left(\\frac{\\phi(x)}{\\Phi_0}\\right) \\;=\\; -\\frac{\\alpha_0}{c L_b^2}\\left[\\frac{(x')^3}{3}\\right]_0^x \\;=\\; -\\frac{\\alpha_0 x^3}{3 c L_b^2}\n$$\n求解 $\\phi(x)$ 得到缓冲区 $x \\in [0, L_b]$ 内的稳态解：\n$$\n\\phi(x) \\;=\\; \\Phi_0\\,\\exp\\left(-\\frac{\\alpha_0 x^3}{3 c L_b^2}\\right)\n$$\n\n现在我们计算所需的能量率，并在通道跨度 $L_y$ 上积分。\n\n1.  **在 $x=0$ 处的能量流入率**：\n    在 $x=0$ 处的能量通量为 $F_E(0) = c\\,\\mathcal{E}(0) = \\frac{1}{2}c\\,\\phi(0)^2$。由于 $\\phi(0) = \\Phi_0$，通量为 $F_E(0) = \\frac{1}{2}c\\,\\Phi_0^2$。总流入率 $P_{in}$ 是此通量在跨度 $L_y$ 上的积分：\n    $$\n    P_{in} = \\int_0^{L_y} F_E(0)\\,dy = F_E(0) \\int_0^{L_y} dy = L_y F_E(0) = \\frac{1}{2}c\\,\\Phi_0^2 L_y\n    $$\n\n2.  **缓冲区内的能量提取率**：\n    单位面积的局地能量提取率为 $S(x) = \\alpha(x)\\phi(x)^2$。总提取率 $P_{extract}$ 是 $S(x)$ 在缓冲区面积 $x \\in [0, L_b], y \\in [0, L_y]$ 上的积分：\n    $$\n    P_{extract} = \\int_0^{L_y} \\int_0^{L_b} \\alpha(x)\\phi(x)^2 \\,dx\\,dy = L_y \\int_0^{L_b} \\alpha(x)\\phi(x)^2 \\,dx\n    $$\n    代入 $\\alpha(x)$ 和 $\\phi(x)$ 的表达式：\n    $$\n    P_{extract} = L_y \\int_0^{L_b} \\left(\\alpha_0 \\frac{x^2}{L_b^2}\\right) \\left(\\Phi_0\\,\\exp\\left(-\\frac{\\alpha_0 x^3}{3 c L_b^2}\\right)\\right)^2 \\,dx\n    $$\n    $$\n    P_{extract} = \\frac{\\alpha_0 \\Phi_0^2 L_y}{L_b^2} \\int_0^{L_b} x^2 \\exp\\left(-\\frac{2\\alpha_0 x^3}{3 c L_b^2}\\right) \\,dx\n    $$\n    为了计算该积分，我们使用换元法，令 $u = \\frac{2\\alpha_0 x^3}{3 c L_b^2}$。其微分为 $du = \\frac{2\\alpha_0}{3 c L_b^2} (3x^2) dx = \\frac{2\\alpha_0 x^2}{c L_b^2} dx$。这得到 $x^2 dx = \\frac{c L_b^2}{2\\alpha_0} du$。\n    $u$ 的积分上下限为：当 $x=0$ 时，$u=0$；当 $x=L_b$ 时，$u = \\frac{2\\alpha_0 L_b^3}{3 c L_b^2} = \\frac{2\\alpha_0 L_b}{3c}$。\n    积分变为：\n    $$\n    \\int_0^{L_b} x^2 \\exp\\left(-\\frac{2\\alpha_0 x^3}{3 c L_b^2}\\right) \\,dx = \\int_0^{\\frac{2\\alpha_0 L_b}{3c}} \\exp(-u) \\left(\\frac{c L_b^2}{2\\alpha_0}\\right) du = \\frac{c L_b^2}{2\\alpha_0} [-\\exp(-u)]_0^{\\frac{2\\alpha_0 L_b}{3c}}\n    $$\n    $$\n    = \\frac{c L_b^2}{2\\alpha_0} \\left(1 - \\exp\\left(-\\frac{2\\alpha_0 L_b}{3c}\\right)\\right)\n    $$\n    将此结果代回 $P_{extract}$ 的表达式中：\n    $$\n    P_{extract} = \\frac{\\alpha_0 \\Phi_0^2 L_y}{L_b^2} \\left[ \\frac{c L_b^2}{2\\alpha_0} \\left(1 - \\exp\\left(-\\frac{2\\alpha_0 L_b}{3c}\\right)\\right) \\right]\n    $$\n    $$\n    P_{extract} = \\frac{1}{2}c\\,\\Phi_0^2 L_y \\left(1 - \\exp\\left(-\\frac{2\\alpha_0 L_b}{3c}\\right)\\right)\n    $$\n\n3.  **进入内部区域的净能量流入率**：\n    这定义为差值 $P_{net} = P_{in} - P_{extract}$：\n    $$\n    P_{net} = \\frac{1}{2}c\\,\\Phi_0^2 L_y - \\frac{1}{2}c\\,\\Phi_0^2 L_y \\left(1 - \\exp\\left(-\\frac{2\\alpha_0 L_b}{3c}\\right)\\right)\n    $$\n    $$\n    P_{net} = \\frac{1}{2}c\\,\\Phi_0^2 L_y \\left[ 1 - \\left(1 - \\exp\\left(-\\frac{2\\alpha_0 L_b}{3c}\\right)\\right) \\right]\n    $$\n    $$\n    P_{net} = \\frac{1}{2}c\\,\\Phi_0^2 L_y \\exp\\left(-\\frac{2\\alpha_0 L_b}{3c}\\right)\n    $$\n    这就是进入内部区域的净能量流入率的最终表达式。在物理上，这对应于在 $x=L_b$ 处离开缓冲区并进入内部区域的能量通量，即 $P_{out} = L_y F_E(L_b)$。\n\n最终答案是根据要求，以给定参数 $c, \\Phi_0, \\alpha_0, L_b$ 和 $L_y$ 表示的闭合形式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{1}{2} c \\Phi_0^2 L_y \\exp\\left(-\\frac{2 \\alpha_0 L_b}{3 c}\\right)}\n$$"
        },
        {
            "introduction": "本练习将理论和物理直觉转化为具体的代码实现，这是数值建模中的关键一步。练习 () 聚焦于为关键的预报变量——速度——设计一个实际的、流场依赖的松弛方案。你将学习如何将“仅阻尼入流分量”这一物理原则转化为一个稳健的算法，包括速度矢量的分解和确保数值稳定性的更新策略，这些都是在真实模型中构建边界条件的常用技术。",
            "id": "4059614",
            "problem": "在数值天气预报（NWP）和气候模拟的背景下，给定一个二维侧边界。在每个离散的边界段上，有一个以米/秒（$\\mathrm{m/s}$）为单位的预报水平速度矢量 $\\mathbf{v} = (u, v)$，以及一个相应的、几何上表征边界方向的外向单位法向量 $\\hat{\\mathbf{n}}$。目标是实现一个科学上一致的、与流场相关的弛豫步骤，该步骤仅阻尼 $\\mathbf{v}$ 的入流法向分量，而出流分量不受影响。此弛豫步骤必须与以下基本依据和约束条件保持一致：\n\n- 从线性平流和标准的边界法向分解角度出发。仅根据法向分量 $v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$ 的符号，使用点积来区分入流与出流。入流对应于 $v_n  0$（通量从外部指向区域内部），出流对应于 $v_n \\ge 0$。\n- 将 $\\mathbf{v}$ 分解为相对于 $\\hat{\\mathbf{n}}$ 的法向和切向分量，并设计一个弛豫机制，该机制仅作用于速度的入流法向分量，而不阻尼切向分量。\n- 弛豫必须是流相关的：阻尼强度必须随入流法向速率的大小而增加，并且必须与一个具有物理意义的弛豫长度尺度 $L_{\\mathrm{relax}}$（单位：米）和一个时间步长 $\\Delta t$（单位：秒）成比例。通过设计弛豫方案以确保其在单个步骤内不会反转 $v_n$ 的符号，来保证数值稳定性。\n- 该实现必须构建为单步显式时间更新。结果必须是在边界段上更新后的、物理上和数值上合理的以 $\\mathrm{m/s}$ 为单位的速度 $\\mathbf{v}^{\\mathrm{new}}$。\n\n您的程序必须实现上述逻辑，不使用任何外部输入，并且必须评估以下测试套件。在每种情况下，将 $\\hat{\\mathbf{n}}$ 视为外向单位法向量（如有必要，进行归一化），$\\mathbf{v}$ 视为以 $\\mathrm{m/s}$ 为单位的边界速度，$\\Delta t$ 以秒为单位， $L_{\\mathrm{relax}}$ 以米为单位。对于每种情况，计算经过一个弛豫步骤后更新的速度 $\\mathbf{v}^{\\mathrm{new}}$（以 $\\mathrm{m/s}$ 为单位），并将其每个分量四舍五入到六位小数。\n\n测试套件：\n\n- 情况 A（正常入流）：$\\hat{\\mathbf{n}} = (1, 0)$，$\\mathbf{v} = (-10, 3)$，$\\Delta t = 30$ 秒，$L_{\\mathrm{relax}} = 10000$ 米。\n- 情况 B（纯出流，应保持不变）：$\\hat{\\mathbf{n}} = (1, 0)$，$\\mathbf{v} = (5, -2)$，$\\Delta t = 30$ 秒，$L_{\\mathrm{relax}} = 10000$ 米。\n- 情况 C（纯切向流，法向分量为零）：$\\hat{\\mathbf{n}} = (0, 1)$，$\\mathbf{v} = (3, 0)$，$\\Delta t = 60$ 秒，$L_{\\mathrm{relax}} = 12000$ 米。\n- 情况 D（强入流，饱和边界情况）：$\\hat{\\mathbf{n}} = (0, 1)$，$\\mathbf{v} = (0, -50)$，$\\Delta t = 300$ 秒，$L_{\\mathrm{relax}} = 15000$ 米。\n- 情况 E（对角边界法线与斜向入流）：$\\hat{\\mathbf{n}} = \\left(\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$，$\\mathbf{v} = (-10, -10)$，$\\Delta t = 60$ 秒，$L_{\\mathrm{relax}} = 8000$ 米。\n\n最终输出格式规范：\n\n- 您的程序应生成单行输出，该输出是一个用方括号括起来的逗号分隔列表，其中每个元素是针对一个测试用例更新后的速度矢量，表示为一个包含两个浮点数的列表，浮点数四舍五入到六位小数，单位为 $\\mathrm{m/s}$。例如：$[[u_1^{\\mathrm{new}},v_1^{\\mathrm{new}}],[u_2^{\\mathrm{new}},v_2^{\\mathrm{new}}],\\dots]$。\n\n不应使用用户输入或外部文件；所有数据必须完全按照上述规定在程序中硬编码。",
            "solution": "问题陈述是有效的。它在科学上基于流体动力学和数值模拟的原理，特别是关于有限区域模型中的侧边界条件。该问题是适定的，提供了推导唯一且稳定解所需的所有物理和数值约束。其语言是客观的，参数是物理上现实的。因此，我们可以着手推导和实现解决方案。\n\n核心任务是为一个二维侧边界上的速度矢量 $\\mathbf{v}$ 设计一个流相关的弛豫步骤，该边界由一个外向单位法向量 $\\hat{\\mathbf{n}}$ 表征。弛豫必须只阻尼流场的入流分量。\n\n首先，我们将速度矢量 $\\mathbf{v}$ 分解为其在边界上的法向和切向分量。标量法向速度 $v_n$ 是 $\\mathbf{v}$ 在 $\\hat{\\mathbf{n}}$ 上的投影：\n$$v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$$\n$v_n$ 的符号决定了相对于模型区域的流动方向。根据问题规范，入流对应于 $v_n  0$，而出流或纯切向流对应于 $v_n \\ge 0$。弛豫仅适用于入流情况。\n\n速度矢量 $\\mathbf{v}$ 可以写成其法向和切向矢量分量之和：\n$$ \\mathbf{v} = \\mathbf{v}_n + \\mathbf{v}_t $$\n其中法向速度矢量为 $\\mathbf{v}_n = v_n \\hat{\\mathbf{n}}$，切向速度矢量为 $\\mathbf{v}_t = \\mathbf{v} - \\mathbf{v}_n$。问题指出，弛豫不能影响切向分量，因此更新后的切向速度 $\\mathbf{v}_t^{\\mathrm{new}}$ 保持与原始值相等，即 $\\mathbf{v}_t^{\\mathrm{new}} = \\mathbf{v}_t$。整个更新作用于法向分量 $\\mathbf{v}_n$。\n\n对于入流（$v_n  0$），我们设计一个显式弛豫方案，将法向速度推向目标值 $0$。对于一个量 $\\phi$，在一个时间步长 $\\Delta t$ 内，以弛豫系数 $K$ 向目标值 $\\phi_{\\text{target}}$ 进行的标准显式更新为：\n$$ \\frac{\\phi^{\\mathrm{new}} - \\phi}{\\Delta t} = -K (\\phi - \\phi_{\\text{target}}) $$\n在我们的情况下，这个量是法向速度标量，即 $\\phi = v_n$，目标值为 $v_{n, \\text{target}} = 0$。$v_n$ 的更新规则变为：\n$$ \\frac{v_n^{\\mathrm{new}} - v_n}{\\Delta t} = -K v_n \\quad \\implies \\quad v_n^{\\mathrm{new}} = (1 - K \\Delta t) v_n $$\n问题要求阻尼强度是流相关的，随入流法向速率的大小 $|v_n|$ 而增加，并与弛豫长度尺度 $L_{\\mathrm{relax}}$ 成比例。基于平流的一个物理上一致的 $K$ 的形式是 $K \\propto |v_n| / L_{\\mathrm{relax}}$。我们设定：\n$$ K = \\frac{|v_n|}{L_{\\mathrm{relax}}} $$\n因为这只在 $v_n  0$ 时适用，我们有 $|v_n| = -v_n$，所以：\n$$ K = \\frac{-v_n}{L_{\\mathrm{relax}}} $$\n将此代入更新规则，得到：\n$$ v_n^{\\mathrm{new}} = \\left(1 - \\left(\\frac{-v_n}{L_{\\mathrm{relax}}}\\right) \\Delta t\\right) v_n $$\n我们定义一个无量纲的阻尼因子 $\\alpha$：\n$$ \\alpha = \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}} $$\n更新规则简化为 $v_n^{\\mathrm{new}} = (1 - \\alpha) v_n$。由于 $v_n  0$、$\\Delta t > 0$ 和 $L_{\\mathrm{relax}} > 0$，因子 $\\alpha$ 是正的，这确保了更新项 $-\\alpha v_n$ 与 $v_n$ 的符号相反，从而阻尼其大小。\n\n一个关键的约束是数值稳定性：弛豫不能反转 $v_n$ 的符号。对于初始的 $v_n  0$，我们必须确保 $v_n^{\\mathrm{new}} \\le 0$。这意味着：\n$$ (1 - \\alpha) v_n \\le 0 $$\n由于 $v_n  0$，我们用它来除并反转不等号，得到 $1 - \\alpha \\ge 0$，即 $\\alpha \\le 1$。这是一个类CFL条件。为保证稳定性，我们必须将阻尼因子的上限设为 $1$。因此，有效的阻尼因子 $\\alpha_{\\mathrm{eff}}$ 是：\n$$ \\alpha_{\\mathrm{eff}} = \\min\\left(1, \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}}\\right) $$\n标量法向速度的最终更新公式为 $v_n^{\\mathrm{new}} = (1 - \\alpha_{\\mathrm{eff}}) v_n$。\n\n更新后的速度矢量 $\\mathbf{v}^{\\mathrm{new}}$ 是新的法向分量和未改变的切向分量之和：\n$$ \\mathbf{v}^{\\mathrm{new}} = \\mathbf{v}_n^{\\mathrm{new}} + \\mathbf{v}_t = \\big( (1 - \\alpha_{\\mathrm{eff}}) v_n \\big) \\hat{\\mathbf{n}} + (\\mathbf{v} - v_n \\hat{\\mathbf{n}}) $$\n$$ \\mathbf{v}^{\\mathrm{new}} = \\mathbf{v} - v_n \\hat{\\mathbf{n}} + (1 - \\alpha_{\\mathrm{eff}}) v_n \\hat{\\mathbf{n}} = \\mathbf{v} - \\alpha_{\\mathrm{eff}} v_n \\hat{\\mathbf{n}} $$\n这个简洁的公式代表了最终的算法。\n\n完整的步骤如下：\n1.  计算 $v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$。\n2.  如果 $v_n \\ge 0$，则流动为出流或切向流。不执行更新：$\\mathbf{v}^{\\mathrm{new}} = \\mathbf{v}$。\n3.  如果 $v_n  0$，则流动为入流。\n    a.  计算阻尼因子 $\\alpha = \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}}$。\n    b.  应用稳定性上限：$\\alpha_{\\mathrm{eff}} = \\min(1, \\alpha)$。\n    c.  计算更新后的速度：$\\mathbf{v}^{\\mathrm{new}} = \\mathbf{v} - (\\alpha_{\\mathrm{eff}} v_n) \\hat{\\mathbf{n}}$。\n\n此算法将应用于每个测试用例以计算最终结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and evaluates a flow-dependent lateral boundary relaxation scheme for NWP models.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (n_hat_tuple, v_tuple, delta_t, L_relax)\n    test_cases = [\n        # Case A (happy path inflow)\n        {'n_hat': (1.0, 0.0), 'v': (-10.0, 3.0), 'dt': 30.0, 'L_relax': 10000.0},\n        # Case B (pure outflow, should be unchanged)\n        {'n_hat': (1.0, 0.0), 'v': (5.0, -2.0), 'dt': 30.0, 'L_relax': 10000.0},\n        # Case C (pure tangential flow, neutral normal component)\n        {'n_hat': (0.0, 1.0), 'v': (3.0, 0.0), 'dt': 60.0, 'L_relax': 12000.0},\n        # Case D (strong inflow, saturation edge case)\n        {'n_hat': (0.0, 1.0), 'v': (0.0, -50.0), 'dt': 300.0, 'L_relax': 15000.0},\n        # Case E (diagonal boundary normal with oblique inflow)\n        {'n_hat': (1/np.sqrt(2), 1/np.sqrt(2)), 'v': (-10.0, -10.0), 'dt': 60.0, 'L_relax': 8000.0}\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters and convert to numpy arrays for vector operations\n        n_hat = np.array(case['n_hat'], dtype=float)\n        v = np.array(case['v'], dtype=float)\n        dt = case['dt']\n        L_relax = case['L_relax']\n\n        # Step 1: Decompose velocity by calculating the scalar normal component.\n        # v_n is the projection of v onto the outward normal n_hat.\n        v_n = np.dot(v, n_hat)\n\n        # Step 2: Apply relaxation based on flow direction.\n        # The relaxation is applied only for v_n  0 (incoming flow).\n        if v_n >= 0:\n            # For outgoing or tangential flow (v_n >= 0), the velocity is unchanged.\n            v_new = v\n        else:\n            # For incoming flow (v_n  0), calculate the damping.\n            \n            # Step 3a: Calculate the non-dimensional damping factor 'alpha'.\n            # It's proportional to the incoming speed |-v_n| and time step dt,\n            # and inversely proportional to the relaxation length scale L_relax.\n            alpha = (-v_n * dt) / L_relax\n\n            # Step 3b: Enforce numerical stability.\n            # The factor is capped at 1.0 to prevent the flow from reversing direction\n            # in a single time step (a CFL-like condition).\n            alpha_eff = min(1.0, alpha)\n\n            # Step 3c: Compute the updated velocity vector.\n            # The change is applied only along the normal direction.\n            # v_new = v - (alpha_eff * v_n) * n_hat\n            update_term = - (alpha_eff * v_n) * n_hat\n            v_new = v + update_term\n\n        # Round each component of the final velocity to six decimal places as required.\n        v_new_rounded = np.round(v_new, 6).tolist()\n        results.append(v_new_rounded)\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists.\n    # Using map(str, ...) on the list of lists achieves the desired output format,\n    # including the required spacing.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}