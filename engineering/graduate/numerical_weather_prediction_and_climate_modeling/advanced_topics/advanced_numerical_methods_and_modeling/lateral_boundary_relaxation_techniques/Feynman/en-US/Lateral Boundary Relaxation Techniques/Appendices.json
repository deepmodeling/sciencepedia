{
    "hands_on_practices": [
        {
            "introduction": "Before we can apply a boundary condition, we must first understand what information is flowing into our limited-area domain versus what is flowing out. This fundamental distinction is the basis for all well-posed lateral boundary treatments. This exercise guides you through a characteristic analysis of the linearized Euler equations to determine precisely how many variables are \"incoming\" and thus require specification or relaxation, providing the theoretical justification for the methods that follow. ",
            "id": "4059587",
            "problem": "Consider the three-dimensional compressible Euler equations for an ideal gas, linearized about a spatially uniform mean state with density $\\rho_{0}$, pressure $p_{0}$, and velocity $\\mathbf{U}_{0}$. The speed of sound is $c$, related to the thermodynamic state by $c^{2}=\\gamma p_{0}/\\rho_{0}$ with ratio of specific heats $\\gamma > 1$. You are modeling a limited-area domain for Numerical Weather Prediction (NWP), and you will impose lateral boundary relaxation only on those characteristic variables that enter the domain.\n\nFocus on a vertical lateral boundary $\\Gamma$ that is a plane with outward unit normal $\\mathbf{n}=(-1,0,0)$ (a western boundary). The uniform mean wind is $\\mathbf{U}_{0}=(15,0,0)$ in m s$^{-1}$, and the speed of sound is $c=340$ in m s$^{-1}$. Using first principles of linear hyperbolic systems and characteristic analysis, determine how many characteristic variables are incoming at $\\Gamma$ and therefore must be specified or relaxed by the lateral boundary scheme. Also state, in words, which characteristic families these incoming variables correspond to. Give your final answer as an integer (no units). Do not round.",
            "solution": "The problem requires an analysis of the boundary conditions for the three-dimensional linearized compressible Euler equations at a specific lateral boundary of a numerical model domain. The number of boundary conditions that must be specified is equal to the number of characteristic variables that correspond to waves propagating into the computational domain. This is determined by analyzing the signs of the characteristic speeds (eigenvalues) of the system normal to the boundary.\n\nThe system of equations is the 3D compressible Euler equations, linearized about a uniform mean state characterized by velocity $\\mathbf{U}_{0}$, density $\\rho_{0}$, and pressure $p_{0}$. The speed of sound is $c$. There are five equations in this system, corresponding to the conservation of mass, three components of momentum, and energy. Consequently, there are five characteristic variables and five associated characteristic speeds for any given direction of propagation.\n\nThe boundary in question, $\\Gamma$, is a plane with an outward unit normal vector $\\mathbf{n}=(-1,0,0)$. This corresponds to a western boundary in a standard Cartesian coordinate system $(x,y,z)$. The computational domain lies to the east of this boundary, i.e., in the region of increasing $x$. Therefore, the direction pointing *into* the domain is the positive $x$-direction. A characteristic wave is considered \"incoming\" at this boundary if it propagates in the positive $x$-direction. The propagation speeds of characteristic waves in the $x$-direction are given by the eigenvalues of the flux Jacobian matrix $\\mathbf{A}_x$ of the Euler equations, evaluated at the mean state.\n\nFor the three-dimensional Euler equations, the characteristic speeds of waves propagating in the $x$-direction, evaluated at a mean state with velocity $\\mathbf{U}_{0} = (U_0, V_0, W_0)$, are given by the set of eigenvalues:\n$$\n\\lambda_x \\in \\{U_0, U_0, U_0, U_0 - c, U_0 + c\\}\n$$\nHere, $U_0$ is the component of the mean wind in the $x$-direction, and $c$ is the speed of sound. The eigenvalue $U_0$ has a multiplicity of three.\n\nThe problem provides the following values:\n- Mean wind vector: $\\mathbf{U}_{0} = (15, 0, 0)$ m s$^{-1}$. This gives the $x$-component of the mean velocity as $U_0 = 15$ m s$^{-1}$.\n- Speed of sound: $c = 340$ m s$^{-1}$.\n\nWe can now substitute these values into the expressions for the characteristic speeds:\n1.  Three eigenvalues are equal to the advective speed $U_0$:\n    $$ \\lambda_{1,2,3} = U_0 = 15 \\, \\text{m s}^{-1} $$\n2.  One eigenvalue corresponds to an acoustic wave propagating against the flow direction:\n    $$ \\lambda_4 = U_0 - c = 15 - 340 = -325 \\, \\text{m s}^{-1} $$\n3.  One eigenvalue corresponds to an acoustic wave propagating with the flow direction:\n    $$ \\lambda_5 = U_0 + c = 15 + 340 = 355 \\, \\text{m s}^{-1} $$\n\nThe number of incoming characteristic variables equals the number of these characteristic speeds that are positive, as a positive speed indicates propagation in the positive $x$-direction and thus into the domain. Let's examine the signs of these speeds:\n-   $\\lambda_{1,2,3} = 15 > 0$. These three characteristics are incoming.\n-   $\\lambda_4 = -325  0$. This characteristic is outgoing.\n-   $\\lambda_5 = 355 > 0$. This characteristic is incoming.\n\nBy counting the positive eigenvalues, we find there are $3 + 1 = 4$ incoming characteristics. Therefore, $4$ boundary conditions must be specified at this western boundary.\n\nThe problem also asks to identify the characteristic families corresponding to these incoming variables.\n-   The three characteristics with speed $\\lambda = U_0$ are advective modes. They correspond to the advection of entropy and the two tangential velocity components ($v'$ and $w'$) by the mean flow. Since $U_0 > 0$, the mean flow is entering the domain, carrying this information with it. These families are one entropy wave and two shear waves.\n-   The characteristic with speed $\\lambda = U_0+c$ is an acoustic mode (a sound wave). Its positive speed indicates it propagates into the domain.\n-   The characteristic with speed $\\lambda = U_0-c$ is also an acoustic mode. Its negative speed indicates it propagates out of the domain.\n\nIn summary, the four incoming characteristics that must be specified at the boundary correspond to the entropy wave, the two shear waves (tangential velocity components), and one of the two acoustic waves.\nThe number of incoming characteristics is therefore $4$.",
            "answer": "$$\n\\boxed{4}\n$$"
        },
        {
            "introduction": "Adding a relaxation or \"sponge\" term is a common method for damping spurious wave reflections near a model boundary. However, this modification to the governing equations directly impacts the numerical stability of the time-stepping scheme. This practice uses the powerful technique of von Neumann stability analysis to find the precise mathematical constraints on the relaxation strength, ensuring that our boundary treatment solves the problem of wave reflection without creating a new one of numerical instability. ",
            "id": "4059554",
            "problem": "Consider a one-dimensional linear transport equation with a uniform lateral boundary relaxation (sponge) term, a simple model frequently used to represent the effect of lateral boundary relaxation in limited-area Numerical Weather Prediction (NWP) and regional climate simulations:\n$$u_{t} + c\\,u_{x} = -\\alpha\\,u,$$\nwhere $u(x,t)$ is a scalar prognostic variable, $c$ is a constant advection speed, and $\\alpha \\ge 0$ is a constant relaxation (nudging) coefficient. The goal is to assess the von Neumann (Fourier) stability of a standard explicit scheme used in practice. Discretize the equation on a uniform mesh $x_{j} = j\\,\\Delta x$ and time levels $t^{n} = n\\,\\Delta t$ using forward Euler in time and first-order upwind in space for the advective flux, with the relaxation term discretized explicitly:\n- For $c > 0$, use the update\n$$\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + c\\,\\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x} = -\\alpha\\,u_{j}^{n}.$$\n- For $c  0$, the upwind stencil is reversed analogously.\n\nAssume an infinite or periodic domain so that a Fourier-mode analysis applies, and define the Courant number\n$$\\nu \\equiv \\frac{|c|\\,\\Delta t}{\\Delta x}.$$\nPerform a von Neumann stability analysis and determine, as a function of $\\nu$, the supremum of the non-dimensional relaxation strength $\\alpha\\,\\Delta t$ that guarantees stability (no amplification of any discrete Fourier mode) for all wavenumbers, under the standard advection stability condition $0 \\le \\nu \\le 1$ for the first-order upwind scheme. Express your final answer as a single closed-form analytic expression in terms of $\\nu$. No rounding is required, and no units should be included in the final expression.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. It is a standard exercise in the stability analysis of numerical methods for partial differential equations. We may therefore proceed with the solution.\n\nThe problem asks for the von Neumann stability analysis of a discretized one-dimensional linear transport equation with a relaxation term. The governing partial differential equation is:\n$$u_{t} + c\\,u_{x} = -\\alpha\\,u$$\nwhere $u(x,t)$ is the prognostic variable, $c$ is a constant advection speed, and $\\alpha \\ge 0$ is a constant relaxation coefficient.\n\nWe first analyze the case where the advection speed $c > 0$. The specified discretization scheme is forward Euler in time and first-order upwind in space:\n$$\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + c\\,\\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x} = -\\alpha\\,u_{j}^{n}$$\nHere, $u_{j}^{n}$ approximates $u(j\\Delta x, n\\Delta t)$. We can rearrange this equation to solve for $u_{j}^{n+1}$:\n$$u_{j}^{n+1} = u_{j}^{n} - c\\frac{\\Delta t}{\\Delta x}(u_{j}^{n} - u_{j-1}^{n}) - \\alpha\\Delta t\\,u_{j}^{n}$$\nCollecting terms involving $u_{j}^{n}$ and $u_{j-1}^{n}$:\n$$u_{j}^{n+1} = \\left(1 - c\\frac{\\Delta t}{\\Delta x} - \\alpha\\Delta t\\right)u_{j}^{n} + \\left(c\\frac{\\Delta t}{\\Delta x}\\right)u_{j-1}^{n}$$\nThe problem defines the Courant number as $\\nu \\equiv \\frac{|c|\\,\\Delta t}{\\Delta x}$. Since we are in the case $c > 0$, $|c|=c$, so $\\nu = \\frac{c\\,\\Delta t}{\\Delta x}$. Substituting $\\nu$ and the non-dimensional relaxation strength, which we denote as $A = \\alpha\\Delta t$, the equation becomes:\n$$u_{j}^{n+1} = (1 - \\nu - A)u_{j}^{n} + \\nu u_{j-1}^{n}$$\n\nFor the von Neumann stability analysis, we consider a single Fourier mode of the solution, of the form $u_{j}^{n} = \\hat{u}^{n}(k)e^{i k x_j}$, where $k$ is the wavenumber, $i = \\sqrt{-1}$, and $x_j = j\\Delta x$. Substituting this ansatz into the discretized equation:\n$$\\hat{u}^{n+1}e^{i k j \\Delta x} = (1 - \\nu - A)\\hat{u}^{n}e^{i k j \\Delta x} + \\nu \\hat{u}^{n}e^{i k (j-1) \\Delta x}$$\nThe amplification factor $G(k)$ is defined as the ratio of the Fourier amplitudes at successive time steps, $G(k) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^{n}}$. To find it, we divide the entire equation by $\\hat{u}^{n}e^{i k j \\Delta x}$:\n$$G(k) = (1 - \\nu - A) + \\nu e^{-i k \\Delta x}$$\nLet the non-dimensional wavenumber be $\\theta = k\\Delta x$. The amplification factor as a function of $\\theta$ is:\n$$G(\\theta) = (1 - \\nu - A) + \\nu (\\cos\\theta - i\\sin\\theta)$$\n$$G(\\theta) = (1 - \\nu - A + \\nu\\cos\\theta) - i(\\nu\\sin\\theta)$$\nFor the numerical scheme to be stable, the magnitude of the amplification factor must not exceed unity for any possible wavenumber, i.e., $|G(\\theta)| \\le 1$ for all $\\theta \\in [-\\pi, \\pi]$.\n\nThe expression for $G(\\theta)$ describes a circle in the complex plane. The center of the circle is at the real-valued point $z_c = 1 - \\nu - A$, and its radius is $R = \\nu$. For the scheme to be stable, this entire circle must be contained within or on the boundary of the unit circle centered at the origin. This condition is met if the sum of the magnitude of the center's position and the radius is less than or equal to $1$:\n$$|z_c| + R \\le 1$$\nSubstituting the expressions for $z_c$ and $R$:\n$$|1 - \\nu - A| + \\nu \\le 1$$\nSince $\\nu \\ge 0$, we can rearrange this to:\n$$|1 - \\nu - A| \\le 1 - \\nu$$\nThe problem specifies that the standard advection stability condition $0 \\le \\nu \\le 1$ holds. This ensures that the right-hand side, $1-\\nu$, is non-negative. We can therefore resolve the absolute value inequality as:\n$$-(1 - \\nu) \\le 1 - \\nu - A \\le 1 - \\nu$$\nThis provides two separate conditions on $A = \\alpha\\Delta t$:\n1. Right inequality: $1 - \\nu - A \\le 1 - \\nu \\implies -A \\le 0 \\implies A \\ge 0$. This is consistent with the given condition $\\alpha \\ge 0$.\n2. Left inequality: $-(1 - \\nu) \\le 1 - \\nu - A \\implies -1 + \\nu \\le 1 - \\nu - A \\implies A \\le 1 - \\nu + 1 - \\nu \\implies A \\le 2 - 2\\nu$.\n\nCombining these, the stability condition is $0 \\le \\alpha\\Delta t \\le 2(1-\\nu)$.\n\nNow, we consider the case $c  0$. The upwind direction is reversed, so the spatial derivative is approximated using points $j$ and $j+1$:\n$$\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + c\\,\\frac{u_{j+1}^{n} - u_{j}^{n}}{\\Delta x} = -\\alpha\\,u_{j}^{n}$$\nRearranging to solve for $u_{j}^{n+1}$:\n$$u_{j}^{n+1} = \\left(1 + c\\frac{\\Delta t}{\\Delta x} - \\alpha\\Delta t\\right)u_{j}^{n} - \\left(c\\frac{\\Delta t}{\\Delta x}\\right)u_{j+1}^{n}$$\nIn this case, $|c|=-c$, so the Courant number $\\nu = \\frac{-c\\Delta t}{\\Delta x}$, which means $c\\frac{\\Delta t}{\\Delta x} = -\\nu$. Substituting this into the equation gives:\n$$u_{j}^{n+1} = (1 - \\nu - A)u_{j}^{n} + \\nu u_{j+1}^{n}$$\nApplying the same Fourier mode $u_{j}^{n} = \\hat{u}^{n}e^{i k j \\Delta x}$:\n$$\\hat{u}^{n+1}e^{i k j \\Delta x} = (1 - \\nu - A)\\hat{u}^{n}e^{i k j \\Delta x} + \\nu \\hat{u}^{n}e^{i k (j+1) \\Delta x}$$\nDividing by $\\hat{u}^{n}e^{i k j \\Delta x}$ yields the amplification factor:\n$$G(k) = (1 - \\nu - A) + \\nu e^{i k \\Delta x}$$\nThis amplification factor is the complex conjugate of the one derived for the $c > 0$ case. Since the magnitude of a complex number is equal to the magnitude of its conjugate, $|G(\\theta)|$ is identical for both $c > 0$ and $c  0$. Therefore, the stability analysis is exactly the same, leading to the same condition:\n$$0 \\le \\alpha\\Delta t \\le 2(1-\\nu)$$\nThis condition guarantees stability for all wavenumbers, provided $0 \\le \\nu \\le 1$. The problem asks for the supremum of the non-dimensional relaxation strength $\\alpha\\Delta t$ that guarantees stability. This corresponds to the upper bound of the derived inequality.\n\nThus, the supremum of $\\alpha\\Delta t$ is $2(1-\\nu)$.",
            "answer": "$$\\boxed{2(1-\\nu)}$$"
        },
        {
            "introduction": "Moving from simplified theory to practical implementation, this exercise addresses the design of a physically consistent, flow-dependent relaxation scheme. Unlike a uniform sponge layer, effective boundary treatments in modern models selectively damp only the incoming flow components, leaving outgoing information unaltered. This coding challenge requires you to decompose a velocity vector at the boundary and apply a stable, adaptive damping, mirroring the logic used in operational Numerical Weather Prediction systems. ",
            "id": "4059614",
            "problem": "You are given a two-dimensional lateral boundary in a Numerical Weather Prediction (NWP) and climate modeling context. At each discrete boundary segment, there is a prognostic horizontal velocity vector $\\mathbf{v} = (u, v)$ expressed in meters per second ($\\mathrm{m/s}$), and a corresponding outward unit normal vector $\\hat{\\mathbf{n}}$ that geometrically characterizes the boundary orientation. The goal is to implement a scientifically consistent flow-dependent relaxation step that damps only incoming normal components of $\\mathbf{v}$, while leaving outgoing components unaffected. The relaxation step must be consistent with the following fundamental base and constraints:\n\n- Begin from the linear advection perspective and standard boundary-normal decomposition. Use the dot product to classify incoming versus outgoing flow based solely on the sign of the normal component $v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$. Incoming flow corresponds to $v_n  0$ (flux directed from outside into the domain), and outgoing flow corresponds to $v_n \\ge 0$.\n- Decompose $\\mathbf{v}$ into normal and tangential components relative to $\\hat{\\mathbf{n}}$, and design a relaxation mechanism that acts only on the incoming normal component of velocity with no damping of the tangential component.\n- The relaxation must be flow dependent: the damping strength must increase with the magnitude of incoming normal speed and must scale with a physically meaningful relaxation length scale $L_{\\mathrm{relax}}$ in meters and a time step $\\Delta t$ in seconds. Ensure numerical stability by designing the relaxation so that it cannot reverse the sign of $v_n$ in a single step.\n- The implementation must be framed as a single explicit time step update. The result must be a physically and numerically sensible updated velocity $\\mathbf{v}^{\\mathrm{new}}$ at the boundary segment in $\\mathrm{m/s}$.\n\nYour program must implement the above logic without using any external inputs and must evaluate the following test suite. In each case, treat $\\hat{\\mathbf{n}}$ as an outward unit normal (i.e., normalize if necessary), $\\mathbf{v}$ as the boundary velocity in $\\mathrm{m/s}$, $\\Delta t$ in seconds, and $L_{\\mathrm{relax}}$ in meters. For each case, compute the updated velocity $\\mathbf{v}^{\\mathrm{new}}$ after one relaxation step, expressed in $\\mathrm{m/s}$, and round each component to six decimal places.\n\nTest suite:\n\n- Case A (happy path inflow): $\\hat{\\mathbf{n}} = (1, 0)$, $\\mathbf{v} = (-10, 3)$, $\\Delta t = 30$ seconds, $L_{\\mathrm{relax}} = 10000$ meters.\n- Case B (pure outflow, should be unchanged): $\\hat{\\mathbf{n}} = (1, 0)$, $\\mathbf{v} = (5, -2)$, $\\Delta t = 30$ seconds, $L_{\\mathrm{relax}} = 10000$ meters.\n- Case C (pure tangential flow, neutral normal component): $\\hat{\\mathbf{n}} = (0, 1)$, $\\mathbf{v} = (3, 0)$, $\\Delta t = 60$ seconds, $L_{\\mathrm{relax}} = 12000$ meters.\n- Case D (strong inflow, saturation edge case): $\\hat{\\mathbf{n}} = (0, 1)$, $\\mathbf{v} = (0, -50)$, $\\Delta t = 300$ seconds, $L_{\\mathrm{relax}} = 15000$ meters.\n- Case E (diagonal boundary normal with oblique inflow): $\\hat{\\mathbf{n}} = \\left(\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$, $\\mathbf{v} = (-10, -10)$, $\\Delta t = 60$ seconds, $L_{\\mathrm{relax}} = 8000$ meters.\n\nFinal output format specification:\n\n- Your program should produce a single line of output that is a comma-separated list enclosed in square brackets, where each element is the updated velocity vector for a test case, represented as a two-element list of floats rounded to six decimal places and expressed in $\\mathrm{m/s}$. For example: $[[u_1^{\\mathrm{new}},v_1^{\\mathrm{new}}],[u_2^{\\mathrm{new}},v_2^{\\mathrm{new}}],\\dots]$.\n\nNo user input or external files should be used; all data must be hardcoded exactly as specified above in the program.",
            "solution": "The problem statement is valid. It is scientifically grounded in the principles of fluid dynamics and numerical modeling, specifically concerning lateral boundary conditions in limited-area models. It is well-posed, providing all necessary physical and numerical constraints to derive a unique and stable solution. The language is objective and the parameters are physically realistic. We can therefore proceed with the derivation and implementation of the solution.\n\nThe core task is to design a flow-dependent relaxation step for a velocity vector $\\mathbf{v}$ at a two-dimensional lateral boundary characterized by an outward unit normal vector $\\hat{\\mathbf{n}}$. The relaxation must damp only the incoming component of the flow.\n\nFirst, we decompose the velocity vector $\\mathbf{v}$ into its components normal and tangential to the boundary. The scalar normal velocity, $v_n$, is the projection of $\\mathbf{v}$ onto $\\hat{\\mathbf{n}}$:\n$$v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$$\nThe sign of $v_n$ determines the flow direction relative to the model domain. According to the problem specification, incoming flow corresponds to $v_n  0$, while outgoing or purely tangential flow corresponds to $v_n \\ge 0$. The relaxation is applied only for incoming flow.\n\nThe velocity vector $\\mathbf{v}$ can be written as the sum of its vector components normal and tangential to the boundary:\n$$ \\mathbf{v} = \\mathbf{v}_n + \\mathbf{v}_t $$\nwhere the normal velocity vector is $\\mathbf{v}_n = v_n \\hat{\\mathbf{n}}$ and the tangential velocity vector is $\\mathbf{v}_t = \\mathbf{v} - \\mathbf{v}_n$. The problem states that the relaxation must not affect the tangential component, so the updated tangential velocity $\\mathbf{v}_t^{\\mathrm{new}}$ remains equal to the original, $\\mathbf{v}_t^{\\mathrm{new}} = \\mathbf{v}_t$. The entire update acts on the normal component, $\\mathbf{v}_n$.\n\nFor incoming flow ($v_n  0$), we design an explicit relaxation scheme to drive the normal velocity towards a target value of $0$. A standard explicit update for a quantity $\\phi$ over a time step $\\Delta t$ with a relaxation coefficient $K$ towards a target $\\phi_{\\text{target}}$ is:\n$$ \\frac{\\phi^{\\mathrm{new}} - \\phi}{\\Delta t} = -K (\\phi - \\phi_{\\text{target}}) $$\nIn our case, the quantity is the normal velocity scalar, $\\phi = v_n$, and the target is $v_{n, \\text{target}} = 0$. The update rule for $v_n$ becomes:\n$$ \\frac{v_n^{\\mathrm{new}} - v_n}{\\Delta t} = -K v_n \\quad \\implies \\quad v_n^{\\mathrm{new}} = (1 - K \\Delta t) v_n $$\nThe problem requires the damping strength to be flow-dependent, increasing with the magnitude of the incoming normal speed, $|v_n|$, and scaling with a relaxation length scale $L_{\\mathrm{relax}}$. A physically consistent form for $K$ based on advection is $K \\propto |v_n| / L_{\\mathrm{relax}}$. We set:\n$$ K = \\frac{|v_n|}{L_{\\mathrm{relax}}} $$\nSince this applies only when $v_n  0$, we have $|v_n| = -v_n$, so:\n$$ K = \\frac{-v_n}{L_{\\mathrm{relax}}} $$\nSubstituting this into the update rule gives:\n$$ v_n^{\\mathrm{new}} = \\left(1 - \\left(\\frac{-v_n}{L_{\\mathrm{relax}}}\\right) \\Delta t\\right) v_n $$\nLet us define a non-dimensional damping factor $\\alpha$:\n$$ \\alpha = \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}} $$\nThe update rule simplifies to $v_n^{\\mathrm{new}} = (1 - \\alpha) v_n$. Since $v_n  0$, $\\Delta t  0$, and $L_{\\mathrm{relax}}  0$, the factor $\\alpha$ is positive, ensuring that the update term $-\\alpha v_n$ has the opposite sign to $v_n$, thus damping its magnitude.\n\nA critical constraint is numerical stability: the relaxation must not reverse the sign of $v_n$. For an initial $v_n  0$, we must ensure $v_n^{\\mathrm{new}} \\le 0$. This implies:\n$$ (1 - \\alpha) v_n \\le 0 $$\nSince $v_n  0$, we divide by it and reverse the inequality, yielding $1 - \\alpha \\ge 0$, or $\\alpha \\le 1$. This is a CFL-like condition. To guarantee stability, we must cap the damping factor at $1$. The effective damping factor, $\\alpha_{\\mathrm{eff}}$, is therefore:\n$$ \\alpha_{\\mathrm{eff}} = \\min\\left(1, \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}}\\right) $$\nThe final update for the scalar normal velocity is $v_n^{\\mathrm{new}} = (1 - \\alpha_{\\mathrm{eff}}) v_n$.\n\nThe updated velocity vector $\\mathbf{v}^{\\mathrm{new}}$ is the sum of the new normal component and the unchanged tangential component:\n$$ \\mathbf{v}^{\\mathrm{new}} = \\mathbf{v}_n^{\\mathrm{new}} + \\mathbf{v}_t = \\big( (1 - \\alpha_{\\mathrm{eff}}) v_n \\big) \\hat{\\mathbf{n}} + (\\mathbf{v} - v_n \\hat{\\mathbf{n}}) $$\n$$ \\mathbf{v}^{\\mathrm{new}} = \\mathbf{v} - v_n \\hat{\\mathbf{n}} + (1 - \\alpha_{\\mathrm{eff}}) v_n \\hat{\\mathbf{n}} = \\mathbf{v} - \\alpha_{\\mathrm{eff}} v_n \\hat{\\mathbf{n}} $$\nThis compact formula represents the final algorithm.\n\nThe complete procedure is as follows:\n1.  Calculate $v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$.\n2.  If $v_n \\ge 0$, the flow is outgoing or tangential. No update is performed: $\\mathbf{v}^{\\mathrm{new}} = \\mathbf{v}$.\n3.  If $v_n  0$, the flow is incoming.\n    a.  Calculate the damping factor $\\alpha = \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}}$.\n    b.  Apply the stability cap: $\\alpha_{\\mathrm{eff}} = \\min(1, \\alpha)$.\n    c.  Compute the updated velocity: $\\mathbf{v}^{\\mathrm{new}} = \\mathbf{v} - (\\alpha_{\\mathrm{eff}} v_n) \\hat{\\mathbf{n}}$.\n\nThis algorithm is applied to each test case to compute the final results.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and evaluates a flow-dependent lateral boundary relaxation scheme for NWP models.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (n_hat_tuple, v_tuple, delta_t, L_relax)\n    test_cases = [\n        # Case A (happy path inflow)\n        {'n_hat': (1.0, 0.0), 'v': (-10.0, 3.0), 'dt': 30.0, 'L_relax': 10000.0},\n        # Case B (pure outflow, should be unchanged)\n        {'n_hat': (1.0, 0.0), 'v': (5.0, -2.0), 'dt': 30.0, 'L_relax': 10000.0},\n        # Case C (pure tangential flow, neutral normal component)\n        {'n_hat': (0.0, 1.0), 'v': (3.0, 0.0), 'dt': 60.0, 'L_relax': 12000.0},\n        # Case D (strong inflow, saturation edge case)\n        {'n_hat': (0.0, 1.0), 'v': (0.0, -50.0), 'dt': 300.0, 'L_relax': 15000.0},\n        # Case E (diagonal boundary normal with oblique inflow)\n        {'n_hat': (1/np.sqrt(2), 1/np.sqrt(2)), 'v': (-10.0, -10.0), 'dt': 60.0, 'L_relax': 8000.0}\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters and convert to numpy arrays for vector operations\n        n_hat = np.array(case['n_hat'], dtype=float)\n        v = np.array(case['v'], dtype=float)\n        dt = case['dt']\n        L_relax = case['L_relax']\n\n        # Step 1: Decompose velocity by calculating the scalar normal component.\n        # v_n is the projection of v onto the outward normal n_hat.\n        v_n = np.dot(v, n_hat)\n\n        # Step 2: Apply relaxation based on flow direction.\n        # The relaxation is applied only for v_n  0 (incoming flow).\n        if v_n >= 0:\n            # For outgoing or tangential flow (v_n >= 0), the velocity is unchanged.\n            v_new = v\n        else:\n            # For incoming flow (v_n  0), calculate the damping.\n            \n            # Step 3a: Calculate the non-dimensional damping factor 'alpha'.\n            # It's proportional to the incoming speed |-v_n| and time step dt,\n            # and inversely proportional to the relaxation length scale L_relax.\n            alpha = (-v_n * dt) / L_relax\n\n            # Step 3b: Enforce numerical stability.\n            # The factor is capped at 1.0 to prevent the flow from reversing direction\n            # in a single time step (a CFL-like condition).\n            alpha_eff = min(1.0, alpha)\n\n            # Step 3c: Compute the updated velocity vector.\n            # The change is applied only along the normal direction.\n            # v_new = v - (alpha_eff * v_n) * n_hat\n            update_term = - (alpha_eff * v_n) * n_hat\n            v_new = v + update_term\n\n        # Round each component of the final velocity to six decimal places as required.\n        v_new_rounded = np.round(v_new, 6).tolist()\n        results.append(v_new_rounded)\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists.\n    # Using map(str, ...) on the list of lists achieves the desired output format,\n    # including the required spacing.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}