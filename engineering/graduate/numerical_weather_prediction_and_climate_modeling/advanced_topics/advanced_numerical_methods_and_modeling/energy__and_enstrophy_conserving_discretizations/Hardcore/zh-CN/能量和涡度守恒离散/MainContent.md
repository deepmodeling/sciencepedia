## 引言
在数值天气预报和气候建模领域，模型的长期稳定性和物理真实性是衡量其性能的黄金标准。当我们将模拟的时间尺度从几天延伸到数十年乃至数百年时，即便是微小的数值误差也会累积，可能导致灾难性的结果。[理想流体动力学](@entry_id:1126342)系统所固有的基本守恒律，如能量守恒和涡能守恒，是约束流体长期演化的“铁律”。然而，传统的[数值离散化](@entry_id:752782)方法往往会无意中破坏这些守恒律，引入虚假的能量和涡度源汇，从而严重污染模拟结果，使其偏离物理现实。

本文旨在系统性地解决这一核心问题，深入探讨如何设计并实现能够严格保持能量与涡量守恒的[数值离散化](@entry_id:752782)方案。我们将揭示，这种守恒并非巧合，而是源于对离散[算子代数](@entry_id:146444)结构的精心设计，使其能够“模拟”连续世界中微分算子的积分性质。

通过阅读本文，您将学习到：
*   在“原理与机制”一章中，我们将从理想流体的基本不变量出发，理解能量与涡能的物理差异，并揭示如何通过算子的伴随关系和[反对称性](@entry_id:261893)来构建[守恒格式](@entry_id:747714)，最终将其与哈密顿几何结构等高等观点联系起来。
*   在“应用与跨学科联系”一章中，我们将探讨这些[守恒格式](@entry_id:747714)在地球物理流体动力学中的具体物理效应，如维持地转平衡和正确模拟[湍流](@entry_id:151300)，并考察其在谱方法、大涡模拟等不同数值方法中的应用，以及如何应对地形和[正定性](@entry_id:149643)等实践挑战。
*   最后，在“动手实践”部分，您将有机会通过具体的计算练习，亲手验证和感受[守恒格式](@entry_id:747714)背后的数学机制及其重要性。

这趟知识之旅将从最基本的物理原理开始，逐步深入到数值算法的精巧构造，最终抵达理论研究的前沿，为您构建坚实、可靠的地球物理流体模型打下坚实的基础。

## 原理与机制

在上一章引言的基础上，本章旨在深入探讨能量与涡量[守恒离散化](@entry_id:747709)方案背后的核心原理与关键机制。建立能够精确反映[理想流体动力学](@entry_id:1126342)系统基本守恒律的数值格式，对于气候模拟和长期天气预报的物理保真度和稳定性至关重要。我们将从连续介质的守恒律出发，揭示其物理本质，然后系统地阐述如何在离散的数值世界中构造相应的守恒性质，最终将这些思想与更深刻的哈密顿几何结构联系起来。

### [理想流体](@entry_id:1126341)中的基本不变量

为了构建[守恒格式](@entry_id:747714)，我们首先必须理解在连续的物理世界中，究竟是什么量在何种条件下守恒。我们以一个理想化的模型——二维不可压欧拉方程——作为起点。

该系统描述了无粘、不可压缩的二维流体运动，其速度场 $\boldsymbol{u}$ 和压力 $p$ 由以下方程组控制：
$$
\partial_t \boldsymbol{u} + (\boldsymbol{u}\cdot \nabla)\boldsymbol{u} = -\frac{1}{\rho}\nabla p, \qquad \nabla \cdot \boldsymbol{u} = 0
$$
其中 $\rho$ 为常数密度。对于这一系统，两个至关重要的二次积分为**动能（Kinetic Energy）**和**涡能（Enstrophy）**。

全域动能 $K$ 定义为：
$$
K(t) = \int_{\Omega} \frac{1}{2}\,\rho\,|\boldsymbol{u}|^2 \,\mathrm{d}A
$$
涡能 $Z$ 是涡度平方的全域积分，其中涡度 $\zeta = \nabla \times \boldsymbol{u} \cdot \hat{\boldsymbol{k}}$，定义为：
$$
Z(t) = \int_{\Omega} \frac{1}{2}\,\zeta^2 \,\mathrm{d}A
$$

通过对动能 $K(t)$ 求时间导数，并利用欧拉方程和矢量恒等式，我们可以推导出动能的收支方程  ：
$$
\frac{\mathrm{d}K}{\mathrm{d}t} = - \oint_{\partial \Omega} \left(\frac{1}{2}\rho|\boldsymbol{u}|^2 + p\right) (\boldsymbol{u} \cdot \boldsymbol{n}) \,\mathrm{d}s
$$
类似地，通过首先推导[涡度输运](@entry_id:1133914)方程 $\partial_t \zeta + \boldsymbol{u} \cdot \nabla \zeta = 0$，我们可以得到涡能的收支方程：
$$
\frac{\mathrm{d}Z}{\mathrm{d}t} = - \oint_{\partial \Omega} \frac{1}{2}\zeta^2 (\boldsymbol{u} \cdot \boldsymbol{n}) \,\mathrm{d}s
$$
其中 $\partial \Omega$ 是区域 $\Omega$ 的边界，$\boldsymbol{n}$ 是边界外[法线](@entry_id:167651)[单位向量](@entry_id:165907)。

这两个收支方程清晰地表明，在无外力、无粘性的理想情况下，动能和涡能的变化完全取决于通过区域边界的[能量通量](@entry_id:266056)和涡能通量。因此，守恒律的成立与否，直接取决于**边界条件**。

*   **周期性边界条件**：此时区域没有实际边界，边界积分项自然为零。因此，动能和涡能均精确守恒。
*   **固壁无通透（自由滑移）边界**：该条件要求 $\boldsymbol{u} \cdot \boldsymbol{n} = 0$。通量项中的 $(\boldsymbol{u} \cdot \boldsymbol{n})$ 因子使得两个边界积分都为零。因此，动能和涡能也精确守恒。
*   **固壁无滑移边界**：该条件要求 $\boldsymbol{u} = \boldsymbol{0}$。这同样导致 $(\boldsymbol{u} \cdot \boldsymbol{n}) = 0$，使得两个通量项为零。因此，如果我们**假设存在一个与[无滑移边界条件](@entry_id:186229)相容的光滑[欧拉方程](@entry_id:177914)解**，那么动能和涡能理论上是守恒的 。然而，这是一个非常强的数学假设，因为它忽略了在真实[粘性流](@entry_id:136330)体趋近无粘极限时边界层内产生的复杂现象。在物理现实中，无滑移边界是粘性效应产生涡度的源头。

#### 能量与涡能的物理差异：[二维湍流](@entry_id:198015)的双级串

为何同时关注能量和涡能的守恒如此重要？答案蕴含在[二维湍流](@entry_id:198015)的独特物理学中。能量和涡能在物理维度和[非线性](@entry_id:637147)[传输特性](@entry_id:1133302)上存在本质区别 。单位面积的能量密度 $e = \frac{1}{2}|\boldsymbol{u}|^2$ 的量纲为 $L^2 T^{-2}$，而涡能密度 $z = \frac{1}{2}\zeta^2$ 的量纲为 $T^{-2}$。在波数空间中，能量谱 $E(k)$ 和涡能谱 $Z(k)$ 之间存在关系 $Z(k) = k^2 E(k)$，这表明涡能更多地集中在小尺度（高波数）上。

根据Kraichnan的经典理论，[二维湍流](@entry_id:198015)中能量和涡能的同时守恒导致了著名的**双级串（dual cascade）**现象。当在一个中间尺度注入能量和涡能时：
*   **能量**会通过[非线性](@entry_id:637147)相互作用向更大尺度（低波数）传输，形成**逆能量级串（inverse energy cascade）**。在相应的[惯性区](@entry_id:1126481)内，能量谱遵循 $E(k) \propto k^{-5/3}$ 的规律。这解释了为何大气和海洋中会出现巨大的、长生命期的涡旋结构。
*   **涡能**则向更小尺度（高波数）传输，形成**正涡能级串（forward enstrophy cascade）**，并最终在极小尺度上被粘性耗散。在相应的[惯性区](@entry_id:1126481)内，能量谱遵循 $E(k) \propto k^{-3}$ 的规律。

一个不能同时守恒能量和涡能的数值模型，会错误地模拟[非线性](@entry_id:637147)尺度串级过程，导致能量在不同尺度间的不真实累积或耗散，从而严重破坏模拟的物理保真度。

### [模拟方法](@entry_id:751987)：算符性质与守恒律

要在离散的数值模型中复现连续世界的守恒律，我们不能依赖于巧合，而必须精心设计离散算符的[代数结构](@entry_id:137052)，使其能够“模拟”连续[微分](@entry_id:158422)算符的积分性质。这种方法被称为**[模拟离散化](@entry_id:751986)（mimetic discretization）**或结构保持算法。

#### 能量守恒与算符的伴随关系

我们以旋转浅水波方程为例来说明能量守恒的离散化原理。其总能量包括动能和势能。能量在动能和势能之间的转换由压力梯度项和散度项控制。离散总能量守恒的核心在于确保压力[梯度力](@entry_id:166847)所做的功恰好等于势能的变化率，不多也不少 。

考虑一个交错网格（如**Arakawa C-grid**），其中厚度（或压力）变量 $h$ 位于网格中心，而速度分量 $u,v$ 位于网格面上。我们定义离散的梯度算符 $\mathcal{G}$（从中心到面）和散度算符 $\mathcal{D}$（从面到中心）。离散动能和势能可写为适当的[内积](@entry_id:750660)形式：$K_h = \frac{1}{2} \langle \boldsymbol{u}, \boldsymbol{u} \rangle_h$ 和 $P_h = \frac{1}{2g} \langle gh, gh \rangle_c$。

能量在动能和势能之间的转化速率取决于项 $\langle \boldsymbol{u}, \mathcal{G}(gh) \rangle_h$ 和 $\langle gh, \mathcal{D}(h\boldsymbol{u}) \rangle_c$。要使总能量守恒，这两个项必须相互抵消。这要求[离散梯度](@entry_id:171970)和散度算符之间存在一种**负伴随关系（negative adjointness）**：
$$
\langle \boldsymbol{v}, \mathcal{G} \phi \rangle_h = - \langle \mathcal{D}(h \boldsymbol{v}), \phi \rangle_c
$$
对于所有合适的离散场 $\boldsymbol{v}$ 和 $\phi$。这个性质是连续世界中[分部积分公式](@entry_id:145262) $\int \boldsymbol{v} \cdot \nabla\phi \, dA = - \int \phi (\nabla \cdot \boldsymbol{v}) \, dA$（边界项为零时）的直接模拟。在离散情况下，这个关系可以通过“[分部求和](@entry_id:755630)”（summation by parts）来证明，而这又依赖于[中心差分](@entry_id:173198)算符的特定结构以及在[交错网格](@entry_id:1125805)上对变量（如动能中的 $h$）进行的恰当平均  。

#### 涡能守恒与平流项的[反对称性](@entry_id:261893)

涡能守恒则对[非线性平流](@entry_id:1128854)项的离散化提出了要求。在连续情况下，平流项 $\boldsymbol{u} \cdot \nabla \zeta$ 对总涡能没有贡献，因为 $\int \zeta (\boldsymbol{u} \cdot \nabla \zeta) \, dA = \int \boldsymbol{u} \cdot \nabla(\frac{1}{2}\zeta^2) \, dA = \oint (\frac{1}{2}\zeta^2) \boldsymbol{u} \cdot \boldsymbol{n} \, ds - \int (\frac{1}{2}\zeta^2) (\nabla \cdot \boldsymbol{u}) \, dA = 0$（边界项为零且不可压）。

在离散形式中，这意味着代表平流的算符 $\mathcal{A}$ 在[能量内积](@entry_id:167297)下必须是**反对称的（skew-symmetric）**，即 $\langle \boldsymbol{u}_h, \mathcal{A}(\boldsymbol{u}_h, \boldsymbol{u}_h) \rangle_h = 0$。对于涡度方程，描述涡度平流的离散雅可比算符 $J_h(\psi_h, \zeta_h)$ 也需要满足类似的[反对称性](@entry_id:261893) $\langle \zeta_h, J_h(\psi_h, \zeta_h) \rangle_c = 0$ 才能保证涡能守恒。

**Arakawa雅可比（Arakawa Jacobian）**便是一个经典的例子，它通过组合多个不同的[中心差分](@entry_id:173198)形式，被精巧地构造成既能保证[动能守恒](@entry_id:177660)，又能保证涡能守恒的离散算符 。

#### 耗散项的离散化

这些结构性质也延伸到了耗散项的离散化。物理[粘性耗散](@entry_id:143708)对应于[拉普拉斯算子](@entry_id:146319) $\nabla^2 \zeta$。一个物理上正确的[离散拉普拉斯算子](@entry_id:634690)应该保证它总是从系统中移除涡能（或能量），即它必须是一个**负半定（negative semi-definite）**算子。

通过将[离散拉普拉斯算子](@entry_id:634690) $L_c$ 定义为散度与梯度的复合算子，即 $L_c = \mathcal{D}\mathcal{G}$，我们可以利用上面讨论的伴随性质。在周期性边界条件下，可以证明 $L_c$ 是一个**对称负半定**算子，即 $\langle q, L_c r \rangle_c = \langle L_c q, r \rangle_c$ 且 $\langle q, L_c q \rangle_c \le 0$。这意味着离散粘性项 $\nu L_c \zeta$ 对涡能收支的贡献 $\nu \langle \zeta, L_c \zeta \rangle_c$ 永远是非正的，完美地模拟了物理耗散过程 。

### 在地球物理模型中的应用

上述原理在现代大气和[海洋环流](@entry_id:195237)模型的构建中扮演着核心角色。

#### 地转平衡的表示

地球流体的一个主导特征是**地转平衡（geostrophic balance）**，即科氏力与压力[梯度力](@entry_id:166847)的平衡。数值格式能否精确地维持这种平衡，对模拟大尺度环流的稳定性至关重要。

Arakawa C-grid 交错网格在这方面表现出卓越的特性。在C-grid上，压力（或高度场 $\eta$）位于网格中心，而速度分量位于法向面上。这种布局使得离散的压力梯度项天然地作用于其对应的速度分量上。更重要的是，对于通过旋转[离散梯度](@entry_id:171970)场得到的地转速度场，其离散散度恒为零。这可以形式化地写作 $\mathcal{D}(\mathcal{R}(\mathcal{G}\eta)) = 0$，其中 $\mathcal{R}$ 是离散[旋转算符](@entry_id:136702)。这个性质是连续恒等式 $\nabla \cdot (\hat{\boldsymbol{k}} \times \nabla \eta) = 0$ 的完美离散模拟 。它保证了地转流是非发散的，不会错误地激发虚假的高频重力波。相比之下，A-grid（所有变量同位）等其他网格不具备此优良性质，容易产生数值噪音。如果一个格式不能精确地支持离散地转平衡，即使在没有外源的情况下，压力梯度也可能对流动做虚假的功，导致能量不守恒和模式不稳定 。

#### 一个完整的[守恒格式](@entry_id:747714)：以Arakawa-Lamb格式为例

将以上所有原理结合起来，就可以构建一个完整的能量与涡能[守恒格式](@entry_id:747714)。Arakawa和Lamb (1981) 为浅水波方程设计的C-grid格式便是一个典范 。为了同时守恒离散总能量 $E_h = \sum (\frac{1}{2} h_f |\boldsymbol{u}_f|^2 + \frac{1}{2} g h_c^2)$ 和离散位[势涡](@entry_id:1129997)能 $Z_h = \sum \frac{1}{2} h_c q_c^2$，该格式采用了如下一系列精巧的离散化选择：
1.  **变量布局**：采用C-grid，即将 $h$ 置于网格中心，将 $u,v$ 置于网格法向面。
2.  **能量守恒**：为满足梯度和散度的负伴随关系，动能项中的面心厚度 $h_f$ 必须通过对相邻中心厚度 $h_c$ 进行算术平均得到。
3.  **涡能守恒**：位[势涡](@entry_id:1129997)能 $q$ 被定义在网格中心，与 $h$ 同位。这要求相对涡度 $\zeta$ 也需在中心定义。然而，在C-grid上，相对涡度最自然地通过环流定理计算在网格角点。因此，中心涡度必须通过对周围四个角点涡度进行对称平均得到。

这些看似繁琐的细节，实际上是保证离散系统代数结构与[连续系统](@entry_id:178397)积分性质一致的必然要求。

#### 有限元方法的视角

除了有限差分/体积法，**有限元方法（Finite Element Method, FEM）**也采纳了类似的结构保持思想。在FEM的[弱形式](@entry_id:142897)框架下，能量守恒通过选择**相容的有限元空间（compatible finite element spaces）**来实现 。

对于浅水波方程，速度场 $\boldsymbol{u}_h$ 和高度场 $\eta_h$ 的近似空间 $V_h$ 和 $W_h$ 必须满足所谓的**inf-sup**或LBB（Ladyzhenskaya-Babuška-Brezzi）稳定条件。这一条件与一个关键的几何性质紧密相连：速度空间的散度必须被包含在压力（或高度）空间内，即 $\nabla \cdot V_h \subset W_h$。

这一[相容性条件](@entry_id:637057)保证了离散散度算符和梯度算符构成一个稳定的、互为伴随的对偶系统，从而在[弱形式](@entry_id:142897)下精确地平衡动能和势能的转换。满足此条件的函数空间对包括**Raviart-Thomas (RT)** 速度元和**Discontinuous Galerkin (DG)** 压力元 ($V_h = \mathrm{RT}_k, W_h = \mathrm{DG}_k$)，以及**Brezzi-Douglas-Marini (BDM)** 速度元和DG压力元 ($V_h = \mathrm{BDM}_k, W_h = \mathrm{DG}_{k-1}$) 。而像连续的同阶[拉格朗日元](@entry_id:168612) ($V_h = \mathrm{CG}_k^2, W_h = \mathrm{CG}_k$) 这样的“朴素”选择则不满足此条件，会导致压[力场](@entry_id:147325)出现[伪振荡](@entry_id:152404)且不守恒能量。

### 高等观点：哈密顿与楠部结构

能量与涡能守恒的背后，其实是更深刻的几何结构。[理想流体动力学](@entry_id:1126342)系统可以被描述为（无限维的）[哈密顿系统](@entry_id:143533)。

#### 二维[欧拉方程](@entry_id:177914)的[李-泊松结构](@entry_id:157559)

二维[欧拉方程](@entry_id:177914)在涡度-流函数表述下，构成一个**[李-泊松系统](@entry_id:1127201)（Lie-Poisson system）** 。其状态变量是涡度场 $\zeta$。系统的哈密顿量 $H$ 正是动能 $H[\zeta] = \frac{1}{2}\int |\nabla \psi|^2\,dA$。任意一个泛函 $F[\zeta]$ 的时间演化由一个李-泊松括号给出：
$$
\frac{dF}{dt} = \{F, H\} = \int \zeta \left[\frac{\delta F}{\delta \zeta}, \frac{\delta H}{\delta \zeta}\right] \,dA
$$
其中 $[\cdot, \cdot]$ 是空间雅可比算符，$\delta/\delta\zeta$ 是泛函导数。

这个括号结构有一类特殊的[守恒量](@entry_id:161475)，称为**卡西米尔不变量（Casimir invariants）**。它们是任何与括号中所有泛函的括号运算结果为零的泛函。对于二维[欧拉系统](@entry_id:180928)，[卡西米尔不变量](@entry_id:181340)族为 $C_f[\zeta] = \int f(\zeta) \,dA$，其中 $f$ 是任意[光滑函数](@entry_id:267124)。

这意味着，不仅涡能 $Z = \frac{1}{2}\int\zeta^2\,dA$（对应 $f(x)=\frac{1}{2}x^2$）是守恒的，所有涡度的矩（$\int\zeta^n\,dA$）都守恒。一个理想的**[几何积分算法](@entry_id:138085)（geometric integrator）**应该离散地保持整个[李-泊松括号](@entry_id:159190)的结构，从而自动守恒[哈密顿量](@entry_id:144286)（能量）和所有的卡西米尔不变量。经典的Arakawa格式，因其离散雅可比不满足离散的雅可比恒等式，故不是一个严格意义上的李-泊松积分子。它通过特殊构造保证了能量和涡能（一个特定的卡西米尔）的守恒，但一般不守恒更高阶的涡度矩 。

#### 浅水波方程的楠部结构

当一个系统拥有两个以上（除去卡西米尔）的守恒律时，它可能符合**楠部力学（Nambu mechanics）**的框架。浅水波方程正是如此，它至少守恒总质量 $M$、总能量 $H$ 和总位[势涡](@entry_id:1129997)能 $Z$。其动力学可以由一个三元括号——楠部括号——来描述 ：
$$
\frac{dF}{dt} = \{F, H, Z\} + \{F, H, M\}
$$
楠部括号的一个关键性质是其对三个变量的**完全[反对称性](@entry_id:261893)**。这个性质直接保证了括号的三个“生成元”（此处为$H, Z, M$）都是守恒的，因为将任意一个生成元代入 $F$ 的位置都会导致括号中出现重[复变量](@entry_id:175312)，从而根据[反对称性](@entry_id:261893)结果为零。例如，$\frac{dH}{dt} = \{H, H, Z\} + \{H, H, M\} = 0+0=0$。

这种观点为从最基本的对称性原理出发，系统性地设计能够同时保持多个守恒律的数值格式提供了理论指导，是现代结构保持算法研究的前沿领域。