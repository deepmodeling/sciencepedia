{
    "hands_on_practices": [
        {
            "introduction": "理论学习之后，最好的巩固方式就是亲自动手计算。第一个练习将通过一个标准的二维笛卡尔域分解场景，带你具体实践网格划分的力学过程。这个练习的核心在于处理网格维度无法被处理器数量整除的常见情况，并量化由此产生的静态负载不均衡，这对于理解并行效率的来源至关重要。",
            "id": "4032181",
            "problem": "一个用于数值天气预报的全球大气模型，在一个水平维度为 $N_x \\times N_y$ 的均匀经纬度网格上进行离散化，其中 $N_x$ 是经度方向的格点数，$N_y$ 是纬度方向的格点数。该模型使用有限体积法来推进预报变量，每个水平网格单元的计算成本是均匀的，因此总计算成本与分配给一个 rank 的网格单元数量成正比。\n\n为对模型进行并行化，使用了一种二维笛卡尔消息传递接口（MPI）区域分解方法，将水平网格在 $x$ 方向上划分为 $p_x$ 个块，在 $y$ 方向上划分为 $p_y$ 个块，每个子域分配一个 MPI rank。给定 $N_x = 1536$，$N_y = 768$，以及总共 $p = 128$ 个 MPI rank。出于架构对称性的原因，项目经理要求在水平分解中 $p_x = p_y$。为了在每个单元成本均匀的情况下保持负载均衡，该划分必须遵守以下广泛使用的块分布规则：\n- 对于每个维度 $\\alpha \\in \\{x,y\\}$，令 $q_{\\alpha} = \\lfloor N_{\\alpha} / p_{\\alpha} \\rfloor$ 且 $r_{\\alpha} = N_{\\alpha} \\bmod p_{\\alpha}$。沿着维度 $\\alpha$ 的前 $r_{\\alpha}$ 个块会分配到 $q_{\\alpha} + 1$ 个单元，剩下的 $p_{\\alpha} - r_{\\alpha}$ 个块会分配到 $q_{\\alpha}$ 个单元。\n\n根据这些定义和约束，确定：\n1. 满足 $p_x = p_y$ 和 $p_x p_y \\le p$ 的最大可行整数 $p_x$ 和 $p_y$。\n2. 基本块大小 $q_x$ 和 $q_y$，较大的块大小 $q_x + 1$ 和 $q_y + 1$，以及余数 $r_x$ 和 $r_y$。\n3. 四种局部大小类别中每一种的 rank 数量：$(q_x + 1) \\times (q_y + 1)$、$(q_x + 1) \\times q_y$、 $q_x \\times (q_y + 1)$ 和 $q_x \\times q_y$。\n4. 由 $p_x = p_y$ 约束导致的未使用的 MPI rank 数量（空闲 rank）。\n5. 在每个单元成本均匀的假设下，所有 rank 中最大局部工作负载与最小局部工作负载的比率。\n\n使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境将您的最终答案表示为一个行矩阵，其条目按以下顺序排列：$p_x$、$p_y$、$q_x$、$q_x + 1$、$q_y$、$q_y + 1$、$r_x r_y$、$r_x (p_y - r_y)$、$(p_x - r_x) r_y$、$(p_x - r_x)(p_y - r_y)$、$p - p_x p_y$ 以及工作负载比率 $\\frac{(q_x + 1)(q_y + 1)}{q_x q_y}$。无需四舍五入，条目均为无单位的纯数字。",
            "solution": "问题陈述经评估是有效的。其科学依据在于并行计算和数值方法的原理，特别是针对基于网格模型的区域分解。该问题是适定的，提供了所有必要的数据和约束（$N_x = 1536$，$N_y = 768$，$p = 128$，$p_x = p_y$），从而可以得出一个唯一的、有意义的解。定义和目标陈述清晰，没有歧义或矛盾。\n\n我们将按顺序解决问题的五个部分来给出解答。\n\n1. 确定 $p_x$ 和 $p_y$\n\n问题要求将网格进行二维笛卡尔分解为 $p_x \\times p_y$ 个子域。我们得到的约束条件是 $p_x = p_y$ 且使用的 MPI rank 总数 $p_x p_y$ 不得超过可用的 rank 总数 $p = 128$。\n将第一个约束代入第二个约束，得到：\n$$p_x \\cdot p_x \\le p$$\n$$p_x^2 \\le 128$$\n我们需要寻找满足此不等式的最大整数 $p_x$。对两边取平方根：\n$$p_x \\le \\sqrt{128} = \\sqrt{64 \\times 2} = 8\\sqrt{2}$$\n使用近似值 $\\sqrt{2} \\approx 1.414$，我们发现 $p_x \\le 8 \\times 1.414 = 11.312$。满足此条件的最大整数是 $p_x = 11$。\n根据约束条件 $p_x = p_y$，我们有 $p_y = 11$。\n使用的 rank 总数为 $p_x p_y = 11 \\times 11 = 121$，这确实小于或等于可用的 128 个 rank。\n\n2. 计算块大小和余数\n\n问题定义了一个基于整数除法的块分布规则。对于每个维度 $\\alpha \\in \\{x,y\\}$，基本块大小为 $q_{\\alpha} = \\lfloor N_{\\alpha} / p_{\\alpha} \\rfloor$，余数为 $r_{\\alpha} = N_{\\alpha} \\bmod p_{\\alpha}$。\n\n对于 $x$ 方向（经度）：\n给定 $N_x = 1536$ 和 $p_x = 11$。\n$$q_x = \\lfloor \\frac{1536}{11} \\rfloor = \\lfloor 139.636... \\rfloor = 139$$\n$$r_x = 1536 \\bmod 11$$\n为了求余数，我们使用除法算法：$1536 = 11 \\times 139 + r_x$。\n$11 \\times 139 = 1529$。\n$1536 = 1529 + 7$，所以 $r_x = 7$。\n$x$ 方向的块大小为基本大小 $q_x = 139$ 和较大大小 $q_x + 1 = 140$。\n\n对于 $y$ 方向（纬度）：\n给定 $N_y = 768$ 和 $p_y = 11$。\n$$q_y = \\lfloor \\frac{768}{11} \\rfloor = \\lfloor 69.818... \\rfloor = 69$$\n$$r_y = 768 \\bmod 11$$\n使用除法算法：$768 = 11 \\times 69 + r_y$。\n$11 \\times 69 = 759$。\n$768 = 759 + 9$，所以 $r_y = 9$。\n$y$ 方向的块大小为基本大小 $q_y = 69$ 和较大大小 $q_y + 1 = 70$。\n\n3. 按局部大小类别统计 Rank\n\n总的 $p_x \\times p_y$ 区域根据局部网格大小被划分为四组。\n- 在 $x$ 方向上，前 $r_x = 7$ 个块的大小为 $q_x+1$，其余 $p_x - r_x = 11 - 7 = 4$ 个块的大小为 $q_x$。\n- 在 $y$ 方向上，前 $r_y = 9$ 个块的大小为 $q_y+1$，其余 $p_y - r_y = 11 - 9 = 2$ 个块的大小为 $q_y$。\n\n四种大小类别中每一种的 rank 数量是：\n- 大小为 $(q_x + 1) \\times (q_y + 1)$ 的子域：这些对应于前 $r_x$ 列和前 $r_y$ 行的交集。\n  Rank 数量 = $r_x \\times r_y = 7 \\times 9 = 63$。\n- 大小为 $(q_x + 1) \\times q_y$ 的子域：这些对应于前 $r_x$ 列和其余 $p_y - r_y$ 行的交集。\n  Rank 数量 = $r_x \\times (p_y - r_y) = 7 \\times 2 = 14$。\n- 大小为 $q_x \\times (q_y + 1)$ 的子域：这些对应于其余 $p_x - r_x$ 列和前 $r_y$ 行的交集。\n  Rank 数量 = $(p_x - r_x) \\times r_y = 4 \\times 9 = 36$。\n- 大小为 $q_x \\times q_y$ 的子域：这些对应于其余 $p_x - r_x$ 列和其余 $p_y - r_y$ 行的交集。\n  Rank 数量 = $(p_x - r_x) \\times (p_y - r_y) = 4 \\times 2 = 8$。\nrank 的总和是 $63 + 14 + 36 + 8 = 121$，与 $p_x p_y$ 相符。\n\n4. 确定未使用的 Rank\n\n未使用的（空闲的）MPI rank 数量是可用 rank 总数与分解中使用的 rank 总数之差。\n空闲 rank 数量 = $p - p_x p_y = 128 - 121 = 7$。\n\n5. 计算工作负载不均衡比率\n\n假设每个网格单元的计算成本是均匀的，一个 rank 的工作负载与其子域中的网格单元数量成正比。工作负载不均衡是最大工作负载与最小工作负载的比率。\n四种可能的子域大小（工作负载）是：\n- $W_{max} = (q_x + 1) \\times (q_y + 1) = (139 + 1) \\times (69 + 1) = 140 \\times 70 = 9800$。\n- $W_2 = (q_x + 1) \\times q_y = 140 \\times 69 = 9660$。\n- $W_3 = q_x \\times (q_y + 1) = 139 \\times 70 = 9730$。\n- $W_{min} = q_x \\times q_y = 139 \\times 69 = 9591$。\n最大工作负载为 $9800$，最小工作负载为 $9591$。问题要求的是最大与最小的比率，即 $\\frac{W_{max}}{W_{min}}$。\n$$\\text{比率} = \\frac{(q_x + 1)(q_y + 1)}{q_x q_y} = \\frac{9800}{9591}$$\n这个分数是不可约的，因为分子的素数分解是 $9800 = 2^3 \\times 5^2 \\times 7^2$，分母的素数分解是 $9591 = 3 \\times 23 \\times 139$。没有公共素因子。\n\n最终结果按指定顺序组合。\n- $p_x = 11$\n- $p_y = 11$\n- $q_x = 139$\n- $q_x+1 = 140$\n- $q_y = 69$\n- $q_y+1 = 70$\n- $r_x r_y = 63$\n- $r_x(p_y-r_y) = 14$\n- $(p_x-r_x)r_y = 36$\n- $(p_x-r_x)(p_y-r_y) = 8$\n- $p - p_x p_y = 7$\n- 工作负载比率 = $\\frac{9800}{9591}$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n11 & 11 & 139 & 140 & 69 & 70 & 63 & 14 & 36 & 8 & 7 & \\frac{9800}{9591}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在将计算域分解到多个处理器后，我们必须面对随之而来的通信开销。本练习将引导你从具体的数值计算转向符号推导，建立一个用于计算“光环”或“幽灵区”数据交换所需总通信量的分析模型。掌握这项技能是分析并行模型可扩展性的关键，因为通信开销往往是限制性能提升的主要瓶颈。",
            "id": "4032214",
            "problem": "一个二维结构化大气模型使用大小为 $N_x \\times N_y$ 个网格点的笛卡尔水平网格，在 $x$ 和 $y$ 方向上均采用周期性边界条件。该区域为并行执行被分解为一个由 $p_x \\times p_y$ 个子域组成的均匀网格，且具有精确可分性，因此每个子域在 $x$ 方向上包含 $n_x = N_x / p_x$ 个网格点，在 $y$ 方向上包含 $n_y = N_y / p_y$ 个网格点。每个子域在每个面上都维护一个整数宽度为 $w \\ge 1$ 个网格点的晕轮区。在每个模型时间步，每个子域与其四个面相邻的邻居进行最近邻交换，发送每个面上的整个晕轮宽度的条带，并从其邻居接收相应的条带。使用消息聚合技术，使得每次面交换在每个时间步中对每个面都实现为单个聚合消息。假设一个以双精度（每个网格值 $8$ 字节）存储的单一预报标量场。\n\n仅使用上述假设以及均匀笛卡尔区域分解和晕轮交换的基本定义，推导一个闭式表达式，用于计算所有子域在每个时间步发送的总聚合字节数。将您的最终答案表示为 $N_x$、$N_y$、$p_x$、$p_y$ 和 $w$ 的函数，并以字节为单位。不需要进行数值代入或四舍五入；请提供一个精确的解析表达式。",
            "solution": "在尝试任何解答之前，对用户提供的问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   **全局网格大小：**一个 $N_x \\times N_y$ 个网格点的二维笛卡尔网格。\n-   **边界条件：**在 $x$ 和 $y$ 方向上均是周期性的。\n-   **分解：**区域被分解成一个由 $p_x \\times p_y$ 个子域组成的均匀网格。\n-   **可分性：**$N_x$ 可被 $p_x$ 整除，$N_y$ 可被 $p_y$ 整除。\n-   **子域网格大小：**每个子域在 $x$ 方向上包含 $n_x = N_x / p_x$ 个网格点，在 $y$ 方向上包含 $n_y = N_y / p_y$ 个网格点。\n-   **晕轮（幽灵区）：**每个子域在每个面上都维护一个整数宽度为 $w \\ge 1$ 个网格点的晕轮区。\n-   **通信协议：**在每个时间步，进行最近邻交换。每个子域向其四个面相邻的邻居发送整个晕轮宽度的条带。\n-   **消息聚合：**每次面交换是单个聚合消息。\n-   **数据类型：**一个单一的预报标量场以双精度存储，对应每个网格值 $8$ 字节。\n-   **目标：**推导一个闭式表达式，用于计算所有子域在每个时间步发送的总聚合字节数，该表达式是 $N_x$、$N_y$、$p_x$、$p_y$ 和 $w$ 的函数。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据：**该问题牢固地建立在高性能计算的原理之上，特别是用于偏微分方程数值解（例如气候和天气模型中的那些）的区域分解和消息传递范式。结构化网格、晕轮交换和周期性边界的概念是标准和基础的。该问题在科学上是合理的。\n-   **适定性：**该问题是适定的。它提供了推导唯一解析解所需的所有变量（$N_x, N_y, p_x, p_y, w$）和常量（$8$ 字节/值）。均匀分解和精确可分性的约束消除了歧义，并确保了确定性的结果。\n-   **客观性：**该问题以精确、客观和技术性的语言陈述，不含任何主观或定性元素。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**，因为它具有科学依据、适定性和客观性。没有可识别的缺陷，如内部矛盾、信息缺失或违反物理或数学原理。因此，我将继续进行解的推导。\n\n### 解的推导\n目标是计算在一个时间步内所有子域合计发送的总数据量（以字节为单位）。我们可以通过计算单个代表性子域发送的数据量，然后乘以子域的总数来解决这个问题。这种方法是有效的，因为区域分解是均匀的，边界条件是周期性的，这意味着每个子域都有相同的通信模式和通信量。\n\n让我们考虑单个子域。其核心计算网格的维度为 $n_x \\times n_y$。它需要将其边界上的数据发送给它的四个邻居（左、右、上、下）。\n\n$1$. **在 x 方向发送的数据：**\n-   向其右侧邻居，该子域发送一个网格点条带。该条带的宽度为 $w$，高度对应于子域在 $y$ 方向上的网格点数，即 $n_y$。此消息中的网格点数为 $w \\times n_y$。\n-   向其左侧邻居，它发送一个大小相似的条带，尺寸为 $w \\times n_y$。\n-   一个子域在 $x$ 方向上发送的网格点总数为 $(w \\times n_y) + (w \\times n_y) = 2 w n_y$。\n\n$2$. **在 y 方向发送的数据：**\n-   向其上方邻居（在 $y$ 正方向），该子域发送一个网格点条带。该条带的宽度为 $n_x$，高度为 $w$。此消息中的网格点数为 $n_x \\times w$。\n-   向其下方邻居（在 $y$ 负方向），它发送一个大小相似的条带，尺寸为 $n_x \\times w$。\n-   一个子域在 $y$ 方向上发送的网格点总数为 $(n_x \\times w) + (n_x \\times w) = 2 w n_x$。\n\n$3$. **单个子域发送的总数据：**\n单个子域发送的网格点值总数 $V_{sub}$ 是在两个方向上发送的点数之和：\n$$V_{sub} = 2 w n_y + 2 w n_x = 2w(n_x + n_y)$$\n问题规定每个网格点值是一个双精度数，需要 $8$ 字节的存储空间。因此，单个子域发送的总字节数 $B_{sub}$ 为：\n$$B_{sub} = 8 \\times V_{sub} = 8 \\times 2w(n_x + n_y) = 16w(n_x + n_y)$$\n\n$4$. **所有子域发送的总聚合数据：**\n区域被分解为 $p_x \\times p_y$ 个子域。子域的总数为 $p_x p_y$。由于每个子域发送的数据量为 $B_{sub}$，因此发送的总聚合字节数 $B_{total}$ 是每个子域的字节数与子域总数的乘积。\n$$B_{total} = (p_x p_y) \\times B_{sub} = (p_x p_y) \\times 16w(n_x + n_y)$$\n\n$5$. **用所需变量表示结果：**\n问题要求最终答案是 $N_x$、$N_y$、$p_x$、$p_y$ 和 $w$ 的函数。我们必须代入 $n_x$ 和 $n_y$ 的定义：\n$$n_x = \\frac{N_x}{p_x}$$\n$$n_y = \\frac{N_y}{p_y}$$\n将这些代入 $B_{total}$ 的表达式中：\n$$B_{total} = 16w(p_x p_y) \\left( \\frac{N_x}{p_x} + \\frac{N_y}{p_y} \\right)$$\n将 $(p_x p_y)$ 项分配到括号内：\n$$B_{total} = 16w \\left( (p_x p_y)\\frac{N_x}{p_x} + (p_x p_y)\\frac{N_y}{p_y} \\right)$$\n通过约分来简化分数：\n$$B_{total} = 16w \\left( p_y N_x + p_x N_y \\right)$$\n这是所有子域在每个时间步发送的总聚合字节数的最终闭式表达式。此结果正确地计入了所有的 `send` 操作。或者，可以计算通信接口的总数（$p_x p_y$ 个垂直接口和 $p_x p_y$ 个水平接口），注意每个接口都促成了两次 `send` 操作（每个方向一次），计算每种接口类型的消息大小（垂直接口为 $8wn_y$ 字节，水平接口为 $8wn_x$ 字节），然后将它们相加，也会得到相同的结果。",
            "answer": "$$\n\\boxed{16w(p_y N_x + p_x N_y)}\n$$"
        },
        {
            "introduction": "这个综合性练习将计算扩展和通信成本的概念融合到一个全面的性能模型中。通过将阿姆达尔定律（Amdahl's Law）与一个考虑了延迟和带宽的实际通信模型相结合，本练习使我们能够预测并行应用程序的真实加速比。它揭示了可并行化工作、串行瓶颈以及域分解引入的开销之间的关键相互作用，是评估和预测大规模并行计算性能的核心实践。",
            "id": "4032167",
            "problem": "一个全球气候模型使用显式时间步进方法在三维网格上更新预报变量。该模型在一个使用消息传递接口（MPI）和区域分解的高性能计算（HPC）系统上实现。空间域是一个由 $N \\times N \\times N$ 个网格单元组成的立方体，其中 $N = 2048$。该空间域被分解为 $p$ 个相等的子域，排列成一个 $q \\times q \\times q$ 的笛卡尔分区，其中 $q^{3} = p$ 且 $q \\in \\mathbb{N}$。每个子域都是一个立方体，在每个时间步，都会在所有 $6$ 个面上交换宽度为 $h$ 个网格单元的光环数据，这些数据是为 $n_{v}$ 个以 $b$ 字节浮点精度存储的预报变量。网络参数为每条消息的延迟 $\\alpha$ 和逆带宽 $\\beta$。假设计算与通信没有重叠。\n\n单个处理器每个时间步的基准时间（包括物理和动力学部分）为 $T_{1} = 10$ s。$T_{1}$ 的一部分（比例为 $f = 0.98$）是理想可并行化的，剩余部分（比例为 $1 - f$）是严格串行的。在强扩展模式下，通过将可并行化的工作均匀分配，$p$ 个处理器上每个时间步的理想计算时间得以获得，而串行部分保持不变。通信包括每个时间步中光环数据的最近邻交换。对于边长为 $N/q$ 个网格单元的立方体，每个面的消息大小为\n$$\nm(p) = h \\, n_{v} \\, b \\, \\left(\\frac{N}{q}\\right)^{2},\n$$\n每个处理器每个时间步的通信时间为\n$$\nT_{\\mathrm{comm}}(p) = 6 \\left[ \\alpha + \\beta \\, m(p) \\right].\n$$\n使用参数 $p = 512$，$h = 4$，$n_{v} = 50$，$b = 8$ 字节，$\\alpha = 2 \\times 10^{-5}$ s，以及 $\\beta = 5 \\times 10^{-11}$ s/byte。\n\n从加速比的定义 $S(p) = T_{1}/T_{p}$ 以及将 $T_{p}$ 分解为可并行化、严格串行和通信三个部分出发，首先从第一性原理推导在没有通信情况下的理想加速比公式。然后，引入 $T_{\\mathrm{comm}}(p)$ 来表达考虑通信的加速比 $S(p)$ 和有效并行分数 $f_{\\mathrm{eff}}(p)$，该有效并行分数能在类似 Amdahl 的划分下重现相同的 $T_{p}$。利用区域分解的几何特性，定性解释当 $p$ 增加时，$T_{\\mathrm{comm}}(p)$ 随 $p$ 的扩展性如何影响 $f_{\\mathrm{eff}}(p)$。\n\n最后，使用给定参数计算在 $p = 512$ 时考虑通信的加速比 $S(p)$。将你的最终加速比结果四舍五入到四位有效数字。以无量纲数的形式表达你的最终答案。",
            "solution": "在尝试求解之前，首先对问题进行验证，以确保它是自洽的、有科学依据的并且是适定的。\n\n### 步骤 1：提取给定条件\n-   域网格维度：$N \\times N \\times N$，其中 $N = 2048$。\n-   处理器（子域）数量：$p$。\n-   子域分区：$q \\times q \\times q$，其中 $q^{3} = p$ 且 $q \\in \\mathbb{N}$。\n-   光环宽度：$h = 4$ 个网格单元。\n-   预报变量数量：$n_{v} = 50$。\n-   浮点精度：$b = 8$ 字节。\n-   网络延迟：$\\alpha = 2 \\times 10^{-5}$ s。\n-   网络逆带宽：$\\beta = 5 \\times 10^{-11}$ s/byte。\n-   单处理器每步时间：$T_{1} = 10$ s。\n-   $T_{1}$ 中理想可并行化的部分：$f = 0.98$。\n-   $T_{1}$ 中严格串行的部分：$1 - f = 0.02$。\n-   每个面的消息大小：$m(p) = h \\, n_{v} \\, b \\, \\left(\\frac{N}{q}\\right)^{2}$。\n-   每个处理器每步的通信时间：$T_{\\mathrm{comm}}(p) = 6 \\left[ \\alpha + \\beta \\, m(p) \\right]$。\n-   用于计算的特定处理器数量：$p = 512$。\n-   假设：计算与通信无重叠。\n\n### 步骤 2：使用提取的给定条件进行验证\n-   **科学依据：** 该问题使用了高性能计算和性能建模中标准的、公认的概念，包括区域分解、光环交换、Amdahl 定律以及用于通信成本的延迟-带宽模型。这些是并行算法分析的基础。\n-   **适定性：** 问题提供了推导所需公式和计算最终数值所必需的所有参数和方程。关系式 $p=q^3$ 与给定值 $p=512$ 一致，因为 $q=\\sqrt[3]{512}=8$，这是一个自然数。\n-   **客观性：** 问题以精确、定量和客观的术语陈述。\n-   **一致性检查：** 所有参数的单位都一致（或是无量纲的）。所提供的消息大小和通信时间的公式是此类问题的标准表示。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\n### 理想加速比的推导 (Amdahl 定律)\n在单个处理器上的总时间是 $T_{1}$。这个时间由一个比例为 $f$ 的完全可并行化部分和一个比例为 $1-f$ 的严格串行部分组成。\n$$T_{1} = f T_{1} + (1-f) T_{1}$$\n当工作负载在强扩展模式下分布到 $p$ 个处理器上时，工作的可并行化部分被分配到各个处理器上，而串行部分保持不变。在理想情况下（无通信开销），在 $p$ 个处理器上的时间 $T_{p, \\text{ideal}}$ 为：\n$$T_{p, \\text{ideal}} = \\frac{f T_{1}}{p} + (1-f) T_{1}$$\n加速比 $S(p)$ 定义为单处理器时间与多处理器时间之比。因此，理想加速比为：\n$$S_{\\text{ideal}}(p) = \\frac{T_{1}}{T_{p, \\text{ideal}}} = \\frac{T_{1}}{\\frac{f T_{1}}{p} + (1-f) T_{1}}$$\n分子分母同除以 $T_{1}$，得到 Amdahl 定律的标准表达式：\n$$S_{\\text{ideal}}(p) = \\frac{1}{\\frac{f}{p} + (1-f)}$$\n\n### 考虑通信的加速比和有效并行分数\n计算与通信不重叠的假设意味着通信时间 $T_{\\mathrm{comm}}(p)$ 被加到计算时间上。在 $p$ 个处理器上的总时间 $T_{p}$ 为：\n$$T_{p} = T_{p, \\text{ideal}} + T_{\\mathrm{comm}}(p) = \\frac{f T_{1}}{p} + (1-f) T_{1} + T_{\\mathrm{comm}}(p)$$\n考虑通信的加速比 $S(p)$ 为：\n$$S(p) = \\frac{T_{1}}{T_{p}} = \\frac{T_{1}}{\\frac{f T_{1}}{p} + (1-f) T_{1} + T_{\\mathrm{comm}}(p)}$$\n分子分母同除以 $T_{1}$，我们得到 $S(p)$ 的表达式：\n$$S(p) = \\frac{1}{\\frac{f}{p} + (1-f) + \\frac{T_{\\mathrm{comm}}(p)}{T_{1}}}$$\n有效并行分数 $f_{\\mathrm{eff}}(p)$ 的定义使得观测到的时间 $T_{p}$ 可以用一个使用 $f_{\\mathrm{eff}}(p)$ 的简单 Amdahl 定律模型来描述：\n$$T_{p} = \\frac{f_{\\mathrm{eff}}(p) T_{1}}{p} + (1 - f_{\\mathrm{eff}}(p)) T_{1}$$\n我们令两个 $T_{p}$ 的表达式相等，然后求解 $f_{\\mathrm{eff}}(p)$：\n$$\\frac{f T_{1}}{p} + (1-f) T_{1} + T_{\\mathrm{comm}}(p) = \\frac{f_{\\mathrm{eff}}(p) T_{1}}{p} + (1 - f_{\\mathrm{eff}}(p)) T_{1}$$\n两边同除以 $T_{1}$：\n$$\\frac{f}{p} + 1 - f + \\frac{T_{\\mathrm{comm}}(p)}{T_{1}} = \\frac{f_{\\mathrm{eff}}(p)}{p} + 1 - f_{\\mathrm{eff}}(p)$$\n重新整理以分离含 $f_{\\mathrm{eff}}(p)$ 的项：\n$$\\frac{f}{p} - f + \\frac{T_{\\mathrm{comm}}(p)}{T_{1}} = f_{\\mathrm{eff}}(p) \\left(\\frac{1}{p} - 1\\right) = f_{\\mathrm{eff}}(p) \\left(\\frac{1-p}{p}\\right)$$\n求解 $f_{\\mathrm{eff}}(p)$：\n$$f_{\\mathrm{eff}}(p) = \\frac{p}{1-p} \\left( \\frac{f}{p} - f + \\frac{T_{\\mathrm{comm}}(p)}{T_{1}} \\right) = \\frac{p}{1-p} \\left( f\\left(\\frac{1-p}{p}\\right) + \\frac{T_{\\mathrm{comm}}(p)}{T_{1}} \\right)$$\n$$f_{\\mathrm{eff}}(p) = f - \\frac{p}{p-1} \\frac{T_{\\mathrm{comm}}(p)}{T_{1}}$$\n\n### 扩展性的定性分析\n为了理解 $T_{\\mathrm{comm}}(p)$ 如何影响 $f_{\\mathrm{eff}}(p)$，我们首先分析 $T_{\\mathrm{comm}}(p)$ 的扩展性。当 $q=p^{1/3}$ 时，消息大小为 $m(p) = h n_v b (N/p^{1/3})^2 = h n_v b N^2 p^{-2/3}$。通信时间为：\n$$T_{\\mathrm{comm}}(p) = 6\\alpha + 6\\beta h n_v b N^2 p^{-2/3}$$\n随着 $p$ 的增加，子域尺寸减小，导致表面积减小，从而消息变小。因此，$T_{\\mathrm{comm}}(p)$ 中依赖于带宽的部分减小，整个 $T_{\\mathrm{comm}}(p)$ 也随之减小，趋近于极限 $6\\alpha$。\n\n有效并行分数为 $f_{\\mathrm{eff}}(p) = f - \\frac{p}{p-1} \\frac{T_{\\mathrm{comm}}(p)}{T_{1}}$。被减去的项 $H(p) = \\frac{p}{p-1} \\frac{T_{\\mathrm{comm}}(p)}{T_{1}}$ 表示通信带来的性能损失，并映射到 Amdahl 的形式体系中。随着 $p$ 的增加，因子 $\\frac{p}{p-1}$ 趋近于 $1$。项 $T_{\\mathrm{comm}}(p)$ 随 $p^{-2/3}$ 减小（为分析扩展行为，忽略常数延迟部分）。损失项 $H(p)$ 是两个关于 $p$ 的递减函数（对于 $p>1$）的乘积，并且可以证明其本身也是一个递减函数。因此，随着 $p$ 的增加，损失 $H(p)$ 减小，而 $f_{\\mathrm{eff}}(p)$ 增加，趋近于极限 $f - 6\\alpha/T_{1}$。\n\n这可能看起来有悖直觉，因为通信开销通常会降低并行效率，尤其是在处理器数量很高时。解决这个矛盾的关键在于认识到 $f_{\\mathrm{eff}}(p)$ 是一个将复杂的性能模型拟合到更简单模型中的代数构造。$f_{\\mathrm{eff}}(p)$ 的增加并不意味着整体效率更好。并行效率 $E(p) = S(p)/p$ 由 $E(p) = T_{1}/(pT_{p}) = T_{1}/(fT_{1} + p(1-f)T_{1} + pT_{\\mathrm{comm}}(p))$ 给出。项 $pT_{\\mathrm{comm}}(p) = 6\\alpha p + 6\\beta h n_v b N^2 p^{1/3}$ 随 $p$ 增长。这导致 $E(p)$ 的分母增长速度快于 $p$ 的线性增长，从而导致效率急剧下降，这是预期的行为。通信开销以表面积与体积比（$p^{1/3}$）的几何方式扩展，逐渐主导扩展行为并降低性能。\n\n### 计算 $p=512$ 时的加速比\n给定参数为：$N = 2048$，$p = 512$，$h = 4$，$n_{v} = 50$，$b = 8$，$\\alpha = 2 \\times 10^{-5}$ s，$\\beta = 5 \\times 10^{-11}$ s/byte，$T_{1} = 10$ s，以及 $f = 0.98$。\n\n1.  计算 $q$：\n    $$q = p^{1/3} = (512)^{1/3} = 8$$\n\n2.  计算消息大小 $m(p)$：\n    $$m(512) = h \\, n_{v} \\, b \\, \\left(\\frac{N}{q}\\right)^{2} = 4 \\times 50 \\times 8 \\times \\left(\\frac{2048}{8}\\right)^{2}$$\n    $$m(512) = 1600 \\times (256)^{2} = 1600 \\times 65536 = 104,857,600 \\, \\text{字节}$$\n\n3.  计算通信时间 $T_{\\mathrm{comm}}(p)$：\n    $$T_{\\mathrm{comm}}(512) = 6 \\left[ \\alpha + \\beta \\, m(512) \\right]$$\n    $$T_{\\mathrm{comm}}(512) = 6 \\left[ 2 \\times 10^{-5} + (5 \\times 10^{-11}) \\times 104,857,600 \\right]$$\n    $$T_{\\mathrm{comm}}(512) = 6 \\left[ 2 \\times 10^{-5} + 0.00524288 \\right]$$\n    $$T_{\\mathrm{comm}}(512) = 6 \\left[ 0.00526288 \\right] = 0.03157728 \\, \\text{s}$$\n\n4.  计算在 $p=512$ 个处理器上的总时间 $T_{512}$：\n    $$T_{512} = \\frac{f T_{1}}{p} + (1-f) T_{1} + T_{\\mathrm{comm}}(512)$$\n    $$T_{512} = \\frac{0.98 \\times 10}{512} + (1-0.98) \\times 10 + 0.03157728$$\n    $$T_{512} = \\frac{9.8}{512} + 0.2 + 0.03157728$$\n    $$T_{512} = 0.019140625 + 0.2 + 0.03157728 = 0.250717905 \\, \\text{s}$$\n\n5.  计算考虑通信的加速比 $S(p)$：\n    $$S(512) = \\frac{T_{1}}{T_{512}} = \\frac{10}{0.250717905} \\approx 39.88551$$\n\n四舍五入到四位有效数字，加速比为 $39.89$。",
            "answer": "$$\n\\boxed{39.89}\n$$"
        }
    ]
}