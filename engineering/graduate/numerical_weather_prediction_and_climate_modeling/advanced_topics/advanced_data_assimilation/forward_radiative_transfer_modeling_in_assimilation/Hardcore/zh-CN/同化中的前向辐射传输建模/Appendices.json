{
    "hands_on_practices": [
        {
            "introduction": "辐射传输正演模型的核心任务是根据给定的大气廓线，模拟卫星能够观测到的辐射量。这项练习  将此模拟过程分解为来自不同大气层的贡献。通过计算贡献函数，我们可以精确定位卫星通道的“有效发射高度”，从而物理地理解观测对大气哪一部分最为敏感。",
            "id": "4044597",
            "problem": "考虑在局地热力学平衡（LTE）的平行平面、无散射大气中，用于数值天气预报（NWP）同化温度探测微波通道卫星辐射率的前向模型。设卫星天顶角为 $\\theta$ 时，上行比辐射强度 $I_{\\nu}$ 的单色辐射传输方程 (RTE) 沿斜程路径给出，路径变量为 $s$，吸收系数为 $\\kappa_{\\nu}$，质量密度为 $\\rho$，普朗克源函数为 $B_{\\nu}(T)$。假设采用 Rayleigh–Jeans 近似 $B_{\\nu}(T) = C_{\\nu} T$，其中 $C_{\\nu} = \\frac{2 k_{B} \\nu^{2}}{c^{2}}$，$k_{B}$ 是玻尔兹曼常数，$\\nu$ 是频率，$c$ 是光速。大气被离散化为 $N$ 个均匀层，每一层都具有该通道的垂直光学厚度 $\\tau_{i}$（$i=1$ 是邻近地表的最低层，$i=N$ 是邻近太空的最高层）。卫星在天顶角 $\\theta$ 处进行观测，其中 $\\mu \\equiv \\cos\\theta$。\n\n从单色 RTE 和比尔-朗伯定律出发，推导在天顶角 $\\theta$ 下从地表到太空的累积透过率，用 $\\tau_{i}$ 和 $\\mu$ 表示。然后，构建一个离散的上行形式解，以表示每一层对大气层顶 (TOA) 辐射率的贡献，并用分层光学厚度和温度 $\\{T_{i}\\}$ 定义分层贡献函数。\n\n现给定一个对氧气敏感的微波温度探测通道的以下物理上一致的分层属性：\n- 天顶角 $\\theta = 53^{\\circ}$。\n- 六层 ($N=6$) 的气压（层边界）和层中温度：\n  - 第 $1$ 层：$1000$–$900$ $\\mathrm{hPa}$，$T_{1} = 290$ $\\mathrm{K}$。\n  - 第 $2$ 层：$900$–$800$ $\\mathrm{hPa}$，$T_{2} = 285$ $\\mathrm{K}$。\n  - 第 $3$ 层：$800$–$700$ $\\mathrm{hPa}$，$T_{3} = 279$ $\\mathrm{K}$。\n  - 第 $4$ 层：$700$–$600$ $\\mathrm{hPa}$，$T_{4} = 272$ $\\mathrm{K}$。\n  - 第 $5$ 层：$600$–$400$ $\\mathrm{hPa}$，$T_{5} = 260$ $\\mathrm{K}$。\n  - 第 $6$ 层：$400$–$200$ $\\mathrm{hPa}$，$T_{6} = 240$ $\\mathrm{K}$。\n- 各层中该通道的垂直光学厚度（平行平面下法向入射）：\n  - $\\tau_{1} = 0.9$, $\\tau_{2} = 0.7$, $\\tau_{3} = 0.5$, $\\tau_{4} = 0.4$, $\\tau_{5} = 0.3$, $\\tau_{6} = 0.1$。\n\n假设地表发射率接近 1，且该通道的有效发射高度由对 TOA 辐射率贡献最大的大气层决定；忽略任何地表反射，只考虑大气贡献函数。使用你推导的贡献函数来确定有效发射层，并报告其有效发射气压，该气压定义为贡献最大层的层中气压。\n\n以 $\\mathrm{hPa}$ 为单位，将你的最终答案表示为单个气压值，并四舍五入到三位有效数字。",
            "solution": "该问题要求通过找出对大气层顶 (TOA) 辐射率贡献最大的层，来确定给定大气廓线和卫星观测几何下的有效发射层。这需要推导辐射传输方程的离散形式，然后将其应用于所提供的数据。\n\n首先，对问题进行验证。\n\n**步骤 1：提取已知条件**\n-   物理模型为局地热力学平衡（LTE）下的平行平面、无散射大气。\n-   上行比辐射强度 $I_{\\nu}$ 的单色辐射传输方程 (RTE) 的概念形式为：$\\frac{dI_{\\nu}}{ds} = -\\kappa_{\\nu} \\rho I_{\\nu} + \\kappa_{\\nu} \\rho B_{\\nu}(T)$。\n-   假设采用 Rayleigh–Jeans 近似：$B_{\\nu}(T) = C_{\\nu} T$，其中 $C_{\\nu} = \\frac{2 k_{B} \\nu^{2}}{c^{2}}$。\n-   大气被离散化为 $N=6$ 个均匀层，索引从 $i=1$（最低）到 $i=6$（最高）。\n-   卫星在天顶角 $\\theta = 53^{\\circ}$ 处观测，$\\mu = \\cos\\theta$。\n-   分层属性：\n    -   第 $1$ 层：$1000$–$900$ $\\mathrm{hPa}$，$T_{1} = 290$ $\\mathrm{K}$。\n    -   第 $2$ 层：$900$–$800$ $\\mathrm{hPa}$，$T_{2} = 285$ $\\mathrm{K}$。\n    -   第 $3$ 层：$800$–$700$ $\\mathrm{hPa}$，$T_{3} = 279$ $\\mathrm{K}$。\n    -   第 $4$ 层：$700$–$600$ $\\mathrm{hPa}$，$T_{4} = 272$ $\\mathrm{K}$。\n    -   第 $5$ 层：$600$–$400$ $\\mathrm{hPa}$，$T_{5} = 260$ $\\mathrm{K}$。\n    -   第 $6$ 层：$400$–$200$ $\\mathrm{hPa}$，$T_{6} = 240$ $\\mathrm{K}$。\n-   各层的垂直光学厚度：\n    -   $\\tau_{1} = 0.9$, $\\tau_{2} = 0.7$, $\\tau_{3} = 0.5$, $\\tau_{4} = 0.4$, $\\tau_{5} = 0.3$, $\\tau_{6} = 0.1$。\n-   约束条件：假设地表发射率接近 1，忽略地表反射，并且只考虑大气贡献函数。\n-   目标：找到有效发射层（对 TOA 辐射率贡献最大的层）并报告其层中气压。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学上成立：** 该问题在一个简化但物理上有效的大气模型（平行平面、无散射、LTE）中使用了标准的 RTE。Rayleigh-Jeans 近似适用于微波区域。所有概念（光学厚度、透过率、贡献函数）都是大气辐射传输的基础。\n-   **适定性：** 问题陈述清晰，提供了计算唯一解所需的所有数据。目标明确且可实现。\n-   **客观性：** 语言正式且定量，没有任何主观性。\n-   **结论：** 该问题是自洽的、科学上合理且适定的。未发现任何缺陷。\n\n**步骤 3：判定与行动**\n问题有效。将提供完整解答。\n\n**离散形式解的推导**\n对于一个吸收-发射、无散射的大气，其 RTE 为：\n$$ \\mu \\frac{dI_{\\nu}}{d\\tau} = I_{\\nu} - B_{\\nu}(T(\\tau)) $$\n其中 $\\tau$ 是从大气层顶向下的垂直光学厚度。源于大气的、在 TOA ($\\tau=0$) 处的上行辐射率的形式解通过对此方程积分得到：\n$$ I_{\\nu}^{\\text{atm}}(\\text{TOA}) = \\int_{0}^{\\tau_{\\text{sfc}}} B_{\\nu}(T(\\tau)) e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu} $$\n其中 $\\tau_{\\text{sfc}}$ 是大气的总垂直光学厚度。\n\n对于一个由 $N$ 层组成的离散大气，其中第 $i$ 层具有恒定温度 $T_i$ 和垂直光学厚度 $\\tau_i$，该积分变为一个和式。层的索引从地表的 $i=1$ 到顶部的 $i=N$。令 $\\tilde{\\tau}_{\\text{top}, i}$ 和 $\\tilde{\\tau}_{\\text{bot}, i}$ 分别为从 TOA 到第 $i$ 层顶部和底部的累积垂直光学厚度。\n$$ \\tilde{\\tau}_{\\text{top}, i} = \\sum_{j=i+1}^{N} \\tau_j \\quad (\\text{当 } i=N \\text{ 时，和为 } 0) $$\n$$ \\tilde{\\tau}_{\\text{bot}, i} = \\sum_{j=i}^{N} \\tau_j $$\n第 $i$ 层对 TOA 辐射率的贡献为：\n$$ I_{\\nu, i} = \\int_{\\tilde{\\tau}_{\\text{top}, i}}^{\\tilde{\\tau}_{\\text{bot}, i}} B_{\\nu}(T_i) e^{-\\tau/\\mu} \\frac{d\\tau}{\\mu} = B_{\\nu}(T_i) \\left[ -e^{-\\tau/\\mu} \\right]_{\\tilde{\\tau}_{\\text{top}, i}}^{\\tilde{\\tau}_{\\text{bot}, i}} $$\n$$ I_{\\nu, i} = B_{\\nu}(T_i) \\left( e^{-\\tilde{\\tau}_{\\text{top}, i}/\\mu} - e^{-\\tilde{\\tau}_{\\text{bot}, i}/\\mu} \\right) $$\n括号中的项是该层顶部和底部到太空的透过率之差。\n\n使用 Rayleigh-Jeans 近似，$B_{\\nu}(T_i) = C_{\\nu} T_i$。由于我们想找到贡献最大的层，我们可以最大化量 $W_i = I_{\\nu, i}/C_\\nu$：\n$$ W_i = T_i \\left( e^{-\\tilde{\\tau}_{\\text{top}, i}/\\mu} - e^{-\\tilde{\\tau}_{\\text{bot}, i}/\\mu} \\right) $$\n\n**计算**\n首先，计算常数 $\\mu$：\n$$ \\mu = \\cos(53^{\\circ}) \\approx 0.601815 $$\n接下来，我们计算从 TOA 向下的累积垂直光学厚度。令 $S_i = \\tilde{\\tau}_{\\text{bot}, i} = \\sum_{j=i}^{N} \\tau_j$。\n-   $\\tau_6 = 0.1$\n-   $\\tau_5 = 0.3$\n-   $\\tau_4 = 0.4$\n-   $\\tau_3 = 0.5$\n-   $\\tau_2 = 0.7$\n-   $\\tau_1 = 0.9$\n\n各层底部的累积光学厚度为（注意索引顺序与问题描述相反，此处从顶向下累加）：\n-   $S_6 = \\tau_6 = 0.1$\n-   $S_5 = \\tau_5 + S_6 = 0.3 + 0.1 = 0.4$\n-   $S_4 = \\tau_4 + S_5 = 0.4 + 0.4 = 0.8$\n-   $S_3 = \\tau_3 + S_4 = 0.5 + 0.8 = 1.3$\n-   $S_2 = \\tau_2 + S_3 = 0.7 + 1.3 = 2.0$\n-   $S_1 = \\tau_1 + S_2 = 0.9 + 2.0 = 2.9$\n\n第 $i$ 层顶部的光学厚度为 $S_{i+1}$（其中 $S_7=0$）。每一层的贡献函数 $W_i$ 为：\n$$ W_i = T_i \\left( \\exp(-S_{i+1}/\\mu) - \\exp(-S_i/\\mu) \\right) $$\n\n我们计算每一层（$i=1, \\dots, 6$）的 $W_i$：\n-   **第 6 层 ($i=6$):** $T_6 = 240$ K. $S_6=0.1, S_7=0$.\n    $W_6 = 240 \\left( \\exp(0) - \\exp(-0.1/0.601815) \\right) = 240 \\left( 1 - \\exp(-0.16616) \\right) = 240(1-0.84690) = 36.74$\n-   **第 5 层 ($i=5$):** $T_5 = 260$ K. $S_5=0.4, S_6=0.1$.\n    $W_5 = 260 \\left( \\exp(-0.1/0.601815) - \\exp(-0.4/0.601815) \\right) = 260 (\\exp(-0.16616) - \\exp(-0.66465)) = 260(0.84690-0.51445) = 86.44$\n-   **第 4 层 ($i=4$):** $T_4 = 272$ K. $S_4=0.8, S_5=0.4$.\n    $W_4 = 272 \\left( \\exp(-0.4/0.601815) - \\exp(-0.8/0.601815) \\right) = 272 (\\exp(-0.66465) - \\exp(-1.32930)) = 272(0.51445-0.26467) = 67.94$\n-   **第 3 层 ($i=3$):** $T_3 = 279$ K. $S_3=1.3, S_4=0.8$.\n    $W_3 = 279 \\left( \\exp(-0.8/0.601815) - \\exp(-1.3/0.601815) \\right) = 279 (\\exp(-1.32930) - \\exp(-2.16012)) = 279(0.26467-0.11531) = 41.67$\n-   **第 2 层 ($i=2$):** $T_2 = 285$ K. $S_2=2.0, S_3=1.3$.\n    $W_2 = 285 \\left( \\exp(-1.3/0.601815) - \\exp(-2.0/0.601815) \\right) = 285 (\\exp(-2.16012) - \\exp(-3.32327)) = 285(0.11531-0.03602) = 22.60$\n-   **第 1 层 ($i=1$):** $T_1 = 290$ K. $S_1=2.9, S_2=2.0$.\n    $W_1 = 290 \\left( \\exp(-2.0/0.601815) - \\exp(-2.9/0.601815) \\right) = 290 (\\exp(-3.32327) - \\exp(-4.81873)) = 290(0.03602 - 0.00808) = 8.10$\n\n比较 $W_i$ 的值：\n$W_1 \\approx 8.10$, $W_2 \\approx 22.60$, $W_3 \\approx 41.67$, $W_4 \\approx 67.94$, $W_5 \\approx 86.44$, $W_6 \\approx 36.74$。\n最大值为 $W_5 \\approx 86.44$。因此，对 TOA 辐射率贡献最大的层是第 5 层。\n\n**有效发射气压的确定**\n问题将有效发射气压定义为贡献最大层的层中气压。第 5 层被指定在 $600$–$400$ $\\mathrm{hPa}$ 的气压范围内。\n层中气压是气压边界的算术平均值：\n$$ P_{\\text{mid}, 5} = \\frac{600 \\, \\mathrm{hPa} + 400 \\, \\mathrm{hPa}}{2} = \\frac{1000 \\, \\mathrm{hPa}}{2} = 500 \\, \\mathrm{hPa} $$\n问题要求答案四舍五入到三位有效数字。计算值恰好是 $500$。作为一个整数，$500$ 满足此要求。\n有效发射气压是 $500$ $\\mathrm{hPa}$。",
            "answer": "$$\\boxed{500}$$"
        },
        {
            "introduction": "变分资料同化依赖于对复杂、非线性的正演模型进行线性化。这项练习  介绍了一种量化非线性程度的实用方法。通过计算一个非线性指标，我们可以判断切线性近似对于给定的状态变量增量是否足够准确，这对于同化系统的稳定性和准确性至关重要。",
            "id": "4044580",
            "problem": "考虑一个用于变分资料同化的湿敏微波通道，在一维、平面平行、无散射、等温层且地表发射率恒定的近似下，其正向大气层顶单色辐射率可由辐射传输方程（RTE）的积分解建模为\n$$\nI(x) \\;=\\; \\epsilon_{s}\\,B(T_{s})\\,\\exp(-\\tau)\\;+\\;\\int_{0}^{\\tau} B(T)\\,\\exp\\!\\big(-( \\tau - t)\\big)\\,dt,\n$$\n其中光学深度 $\\tau = k\\,x$，$x$ 是单位为 $\\mathrm{kg\\,m^{-2}}$ 的层积分水汽路径，$k$ 是单位为 $\\mathrm{m^{2}\\,kg^{-1}}$ 的有效质量吸收系数，$B(T)$ 是在层温度 $T$ 下计算的普朗克函数，且在该层内被视为相对于 $x$ 的常数，$B(T_{s})$ 是在地表温度 $T_{s}$ 下的普朗克函数，$\\epsilon_{s}$ 是该通道的地表发射率。在所述假设下，正向模型简化为\n$$\nI(x) \\;=\\; B(T)\\,\\big(1 - \\exp(-k x)\\big) \\;+\\; \\epsilon_{s}\\,B(T_{s})\\,\\exp(-k x),\n$$\n其中 $B(T)$、$\\epsilon_{s}$ 和 $B(T_{s})$ 均不依赖于 $x$。\n\n在关于背景态 $x_{0}$ 的切线性（TL）变分更新中，由湿度增量 $\\delta x$ 引起的辐射率增量，一阶近似由 $I(x)$ 在 $x_{0}$ 处的泰勒展开的线性项表示。将非线性指标 $r(\\delta x; x_{0})$ 定义为 $I(x_{0}+\\delta x)$ 在 $x_{0}$ 处关于给定 $\\delta x$ 求值的泰勒级数中，二阶项大小与一阶项大小之比的绝对值：\n$$\nr(\\delta x; x_{0}) \\;=\\; \\left| \\frac{\\tfrac{1}{2}\\,I''(x_{0})\\,(\\delta x)^{2}}{I'(x_{0})\\,\\delta x} \\right|.\n$$\n\n给定 $k = 0.04\\ \\mathrm{m^{2}\\,kg^{-1}}$，$x_{0} = 20\\ \\mathrm{kg\\,m^{-2}}$，以及一组湿度增量 $\\{\\delta x\\} = \\{0.10,\\ 0.50,\\ 1.00\\}\\ \\mathrm{kg\\,m^{-2}}$，计算该集合上 $r(\\delta x; x_{0})$ 的最大值。将你的最终答案表示为一个无量纲数，并四舍五入到三位有效数字。在你的推导过程中，从所述的正向模型和基本的泰勒展开定义出发，不要引用任何预先形成的线性度量。此外，根据计算出的指标相对于 1 的大小，简要评论切线性（TL）近似对于该通道中这些增量的充分性。最终报告的值必须是给定增量中的单个最大指标值。最终值不应报告单位。",
            "solution": "用户希望根据提供的文本解决一个问题。\n\n问题验证如下：\n1.  **提取给定条件**：\n    -   正向模型： $$I(x) \\;=\\; B(T)\\,\\big(1 - \\exp(-k x)\\big) \\;+\\; \\epsilon_{s}\\,B(T_{s})\\,\\exp(-k x)$$\n    -   参数 $B(T)$、$\\epsilon_{s}$ 和 $B(T_{s})$ 不依赖于 $x$。\n    -   非线性指标的定义： $$r(\\delta x; x_{0}) \\;=\\; \\left| \\frac{\\tfrac{1}{2}\\,I''(x_{0})\\,(\\delta x)^{2}}{I'(x_{0})\\,\\delta x} \\right|$$\n    -   常数值：$k = 0.04\\ \\mathrm{m^{2}\\,kg^{-1}}$\n    -   背景态：$x_{0} = 20\\ \\mathrm{kg\\,m^{-2}}$\n    -   增量集合：$\\{\\delta x\\} = \\{0.10,\\ 0.50,\\ 1.00\\}\\ \\mathrm{kg\\,m^{-2}}$\n    -   目标：计算给定增量集合上 $r(\\delta x; x_{0})$ 的最大值。结果应为一个无量纲数，四舍五入到三位有效数字。\n\n2.  **使用提取的给定条件进行验证**：\n    -   **科学依据**：该问题使用了一个标准的、尽管是简化形式的辐射传输方程（RTE），适用于无散射、等温的大气。该模型常用于大气科学和遥感领域，特别是在教学中以及在某些业务环境中作为一阶近似。切线性模型和非线性分析的概念是数值天气预报中变分资料同化方法的核心。该问题具有科学合理性。\n    -   **适定性**：该问题提供了一个明确定义的函数 $I(x)$、所有必要的常数和一个清晰的目标。函数 $r(\\delta x; x_{0})$ 可以被唯一确定。问题中描述的“湿敏”通道意味着一阶导数 $I'(x)$ 非零，从而隐含地排除了 $r$ 定义中分母为零的可能性。\n    -   **目标**：该问题以精确、定量且无偏见的科学语言陈述。\n    -   **结论**：该问题是有效的、适定的，并具有科学依据。\n\n开始求解。\n\n大气层顶辐射率 $I(x)$ 的正向模型如下：\n$$\nI(x) \\;=\\; B(T)\\,\\big(1 - \\exp(-k x)\\big) \\;+\\; \\epsilon_{s}\\,B(T_{s})\\,\\exp(-k x)\n$$\n为简化微分过程，我们定义两个常数 $C_1 = B(T)$ 和 $C_2 = \\epsilon_{s}B(T_{s})$，它们不依赖于水汽路径 $x$。模型可重写为：\n$$\nI(x) = C_1 (1 - \\exp(-kx)) + C_2 \\exp(-kx) = C_1 + (C_2 - C_1)\\exp(-kx)\n$$\n切线性近似依赖于 $I(x)$ 的一阶导数，而泰勒展开中的二阶项涉及二阶导数。我们计算这些关于 $x$ 的导数。\n\n一阶导数 $I'(x)$ 为：\n$$\nI'(x) = \\frac{d}{dx} \\left[ C_1 + (C_2 - C_1)\\exp(-kx) \\right] = (C_2 - C_1) \\cdot \\frac{d}{dx}[\\exp(-kx)]\n$$\n$$\nI'(x) = (C_2 - C_1) (-k) \\exp(-kx) = k(C_1 - C_2)\\exp(-kx)\n$$\n二阶导数 $I''(x)$ 是 $I'(x)$ 的导数：\n$$\nI''(x) = \\frac{d}{dx} \\left[ k(C_1 - C_2)\\exp(-kx) \\right] = k(C_1 - C_2) \\cdot \\frac{d}{dx}[\\exp(-kx)]\n$$\n$$\nI''(x) = k(C_1 - C_2) (-k) \\exp(-kx) = -k^2(C_1 - C_2)\\exp(-kx)\n$$\n非线性指标 $r(\\delta x; x_{0})$ 定义为：\n$$\nr(\\delta x; x_{0}) = \\left| \\frac{\\tfrac{1}{2}\\,I''(x_{0})\\,(\\delta x)^{2}}{I'(x_{0})\\,\\delta x} \\right|\n$$\n对于非零增量 $\\delta x$，上式简化为：\n$$\nr(\\delta x; x_{0}) = \\frac{1}{2} |\\delta x| \\left| \\frac{I''(x_{0})}{I'(x_{0})} \\right|\n$$\n现在，我们计算在背景态 $x_{0}$ 处计算的二阶导数与一阶导数之比：\n$$\n\\frac{I''(x_{0})}{I'(x_{0})} = \\frac{-k^2(C_1 - C_2)\\exp(-kx_0)}{k(C_1 - C_2)\\exp(-kx_0)}\n$$\n通道被描述为“湿敏”，这意味着辐射率随水汽变化，即 $I'(x) \\neq 0$。这要求 $k \\neq 0$ 且 $C_1 \\neq C_2$。由于给定的 $k$ 是一个非零值，因此条件 $C_1 \\neq C_2$ 必须成立。所以，我们可以安全地从分子和分母中消去项 $(C_1 - C_2)$ 和指数项 $\\exp(-kx_0)$。\n$$\n\\frac{I''(x_{0})}{I'(x_{0})} = -k\n$$\n有趣的是，对于这个特定的正向模型，导数之比是一个常数 $-k$，并且不依赖于背景态 $x_0$。\n\n将此结果代回非线性指标 $r$ 的表达式中：\n$$\nr(\\delta x; x_{0}) = \\frac{1}{2} |\\delta x| |-k|\n$$\n考虑到吸收系数 $k$ 是一个正的物理量，所以 $|-k| = k$。此外，给定的增量 $\\delta x$ 是正的，因此 $|\\delta x| = \\delta x$。表达式简化为：\n$$\nr(\\delta x; x_{0}) = \\frac{1}{2} k \\delta x\n$$\n我们已知 $k = 0.04\\ \\mathrm{m^{2}\\,kg^{-1}}$ 和增量集合 $\\{\\delta x\\} = \\{0.10,\\ 0.50,\\ 1.00\\}\\ \\mathrm{kg\\,m^{-2}}$。现在我们可以为每个增量计算 $r$ 的值。\n\n对于 $\\delta x = 0.10\\ \\mathrm{kg\\,m^{-2}}$：\n$$\nr(0.10; 20) = \\frac{1}{2} (0.04)(0.10) = 0.02 \\times 0.10 = 0.002\n$$\n对于 $\\delta x = 0.50\\ \\mathrm{kg\\,m^{-2}}$：\n$$\nr(0.50; 20) = \\frac{1}{2} (0.04)(0.50) = 0.02 \\times 0.50 = 0.010\n$$\n对于 $\\delta x = 1.00\\ \\mathrm{kg\\,m^{-2}}$：\n$$\nr(1.00; 20) = \\frac{1}{2} (0.04)(1.00) = 0.02 \\times 1.00 = 0.020\n$$\n问题要求找出该集合上 $r$ 的最大值。通过观察，计算出的值为 $\\{0.002, 0.010, 0.020\\}$。最大值为 $0.020$。另外，由于 $r$ 是 $\\delta x$ 的线性函数，其斜率为正值 $\\frac{k}{2}$，因此它在增量集合上的最大值将出现在 $\\delta x$ 的最大值处，即 $1.00\\ \\mathrm{kg\\,m^{-2}}$。\n\n最大值为 $r_{\\max} = 0.020$。问题要求将此值四舍五入到三位有效数字。数字 $0.020$ 有两位有效数字。要用三位有效数字表示，我们写成 $0.0200$。\n\n作为对切线性（TL）近似适用性的简要评论，非线性指标 $r$ 代表了泰勒展开中二阶项相对于一阶（线性）项的大小。计算出的最大值为 $r_{\\max} = 0.0200$，相当于 $2\\%$ 的相对大小。由于所有计算出的 $r$ 值都远小于 1（即 $r \\ll 1$），二阶项与线性项相比很小。这表明对于给定的增量范围，正向模型的非线性很弱，因此 TL 近似非常适用于变分更新。",
            "answer": "$$\n\\boxed{0.0200}\n$$"
        },
        {
            "introduction": "伴随模型是变分同化的计算核心，它使得代价函数梯度的有效计算成为可能。然而，伴随模型的编码是出了名的容易出错。这项实践  介绍了至关重要的“伴随检验”，这是一种数值验证技术，用以确保所实现的伴随代码与其对应的切线性模型在数学上是一致的，这是任何业务系统中一个关键的质量控制步骤。",
            "id": "4044571",
            "problem": "考虑一个用于数值天气预报和气候模拟中数据同化的简化一维正向辐射传输算子。该算子根据比尔-朗伯定律，将大气状态向量映射到大气层顶辐射率。目标是为该算子构建并实现一个严格的切线性（TL）和伴随（AD）一致性检验。\n\n基本原理：\n- 比尔-朗伯定律：对于通道 $j$，光学深度为 $\\tau_j = \\sum_{i=1}^{n} \\alpha_{j,i} x_i$，透射率为 $T_j = \\exp(-\\tau_j)$。\n- 大气层顶辐射率：对于通道 $j$，$R_j = T_j S_{0,j} + (1 - T_j) S_{1,j}$，其中 $S_{0,j}$ 和 $S_{1,j}$ 是固定的、已知的依赖于通道的源项（单位为任意一致的辐射率单位）。\n- 正向算子 $F: \\mathbb{R}^n \\to \\mathbb{R}^m$ 根据上述公式将状态向量 $x \\in \\mathbb{R}^n$ 映射到辐射率 $R \\in \\mathbb{R}^m$。\n\n定义：\n- 在 $x$ 点的切线性（TL）算子，记作 $H_x$，是一个线性映射，使得对于一个小的微扰 $dx$，$F(x + dx) \\approx F(x) + H_x dx$。\n- 在 $x$ 点的伴随（AD）算子，记作 $H_x^\\top$，是关于欧几里得内積的线性映射，满足对于所有 $dx \\in \\mathbb{R}^n$ 和 $y \\in \\mathbb{R}^m$，$\\langle H_x dx, y \\rangle = \\langle dx, H_x^\\top y \\rangle$ 成立，其中 $\\langle \\cdot, \\cdot \\rangle$ 是标准点积。\n\n任务：\n1. 使用基本原理，推导正向算子 $F$ 的切线性算子 $H_x$ 和伴随算子 $H_x^\\top$ 的表达式。不要使用任何预先推导的快捷公式。\n2. 实现一个数值 TL/AD 一致性检验，对于给定的 $x$、$dx$ 和 $y$，计算 $\\langle H_x dx, y \\rangle$ 和 $\\langle dx, H_x^\\top y \\rangle$，并返回定义如下的相对差异\n   $$\\epsilon = \\frac{\\left| \\langle H_x dx, y \\rangle - \\langle dx, H_x^\\top y \\rangle \\right|}{\\max\\left(1, \\left| \\langle H_x dx, y \\rangle \\right|, \\left| \\langle dx, H_x^\\top y \\rangle \\right|\\right)}.$$\n   结果 $\\epsilon$ 是无量纲的。在 $10^{-12}$ 的容差范围内的匹配表明伴随算子与切线性算子是一致的。\n3. 对状态空间和观测空间均使用欧几里得内积。\n4. 使用以下固定参数实现正向算子 $F(x)$、切线性作用 $H_x dx$ 和伴随作用 $H_x^\\top y$：\n   - 通道数 $m = 3$，状态维度 $n = 5$。\n   - 吸收系数矩阵 $\\alpha \\in \\mathbb{R}^{m \\times n}$:\n     $$\\alpha = \\begin{bmatrix}\n     0.7  0.1  0.05  0.2  0.3 \\\\\n     0.02  0.5  0.1  0.4  0.05 \\\\\n     0.3  0.3  0.8  0.1  0.2\n     \\end{bmatrix}.$$\n   - 源项 $S_0, S_1 \\in \\mathbb{R}^m$（单位为任意一致的辐射率单位）：\n     $$S_0 = \\begin{bmatrix} 2.5 \\\\ 0.5 \\\\ 1.8 \\end{bmatrix}, \\quad S_1 = \\begin{bmatrix} 0.2 \\\\ 0.5 \\\\ 1.2 \\end{bmatrix}.$$\n5. 构建以下由 $(x, dx, y)$ 三元组组成的测试套件，以评估 TL/AD 一致性的不同方面和边界情况：\n   - 情况 1 (常规情况): $x = [0.8, 0.4, 1.2, 0.6, 0.3]$, $dx = [0.02, -0.03, 0.01, 0.00, -0.02]$, $y = [1.0, -0.5, 0.7]$。\n   - 情况 2 (零微扰): $x = [0.8, 0.4, 1.2, 0.6, 0.3]$, $dx = [0, 0, 0, 0, 0]$, $y = [0.1, 0.2, -0.1]$。\n   - 情况 3 (小量级微扰和混合的 $y$): $x = [0.8, 0.4, 1.2, 0.6, 0.3]$, $dx = [10^{-8}, -2 \\cdot 10^{-8}, 10^{-9}, -3 \\cdot 10^{-9}, 0]$, $y = [0.7, 0.0, -0.2]$。\n   - 情况 4 (高光学深度饱和): $x = [10.0, 8.0, 12.0, 9.0, 7.0]$, $dx = [0.001, -0.002, 0.0015, -0.0005, 0.0008]$, $y = [-0.4, 0.9, 0.3]$。\n   - 情况 5 (透明极限): $x = [0, 0, 0, 0, 0]$, $dx = [0.05, -0.05, 0.02, 0.01, -0.01]$, $y = [0.5, -1.0, 0.25]$。\n6. 你的程序应生成单行输出，其中包含五个情况的相对差异 $\\epsilon$，形式为方括号括起来的逗号分隔列表（例如，“[$e_1$,$e_2$,$e_3$,$e_4$,$e_5$]”）。每个 $e_k$ 必须是十进制浮点数。这些差异是无量纲的，输出中不需要物理单位。",
            "solution": "该问题要求对一个简化的一维正向辐射传输算子，推导并实现一个切线性（TL）和伴随（AD）一致性检验。验证和解决方案如下所述。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **正向算子基础：**\n  - 通道 $j$ 的光学深度：$\\tau_j = \\sum_{i=1}^{n} \\alpha_{j,i} x_i$\n  - 通道 $j$ 的透射率：$T_j = \\exp(-\\tau_j)$\n  - 通道 $j$ 的大气层顶辐射率：$R_j = T_j S_{0,j} + (1 - T_j) S_{1,j}$\n  - 正向算子：$F: \\mathbb{R}^n \\to \\mathbb{R}^m$，将状态向量 $x \\in \\mathbb{R}^n$ 映射到辐射率 $R \\in \\mathbb{R}^m$。\n- **定义：**\n  - 在 $x$ 点的切线性（TL）算子：$H_x$，其中 $F(x + dx) \\approx F(x) + H_x dx$。\n  - 在 $x$ 点的伴随（AD）算子：$H_x^\\top$，满足 $\\langle H_x dx, y \\rangle = \\langle dx, H_x^\\top y \\rangle$，使用欧几里得内积。\n- **任务：**\n  1. 推导 $H_x$ 和 $H_x^\\top$ 的表达式。\n  2. 实现一个一致性检验，计算相对差异：\n     $$\\epsilon = \\frac{\\left| \\langle H_x dx, y \\rangle - \\langle dx, H_x^\\top y \\rangle \\right|}{\\max\\left(1, \\left| \\langle H_x dx, y \\rangle \\right|, \\left| \\langle dx, H_x^\\top y \\rangle \\right|\\right)}.$$\n     一致性容差指定为 $10^{-12}$。\n- **固定参数：**\n  - 通道数 $m = 3$，状态维度 $n = 5$。\n  - 吸收系数矩阵 $\\alpha \\in \\mathbb{R}^{3 \\times 5}$:\n    $$\\alpha = \\begin{bmatrix}\n    0.7  0.1  0.05  0.2  0.3 \\\\\n    0.02  0.5  0.1  0.4  0.05 \\\\\n    0.3  0.3  0.8  0.1  0.2\n    \\end{bmatrix}.$$\n  - 源项 $S_0, S_1 \\in \\mathbb{R}^3$:\n    $$S_0 = \\begin{bmatrix} 2.5 \\\\ 0.5 \\\\ 1.8 \\end{bmatrix}, \\quad S_1 = \\begin{bmatrix} 0.2 \\\\ 0.5 \\\\ 1.2 \\end{bmatrix}.$$\n- **测试套件：**\n  - 情况 1: $x = [0.8, 0.4, 1.2, 0.6, 0.3]$, $dx = [0.02, -0.03, 0.01, 0.00, -0.02]$, $y = [1.0, -0.5, 0.7]$。\n  - 情况 2: $x = [0.8, 0.4, 1.2, 0.6, 0.3]$, $dx = [0, 0, 0, 0, 0]$, $y = [0.1, 0.2, -0.1]$。\n  - 情况 3: $x = [0.8, 0.4, 1.2, 0.6, 0.3]$, $dx = [10^{-8}, -2 \\cdot 10^{-8}, 10^{-9}, -3 \\cdot 10^{-9}, 0]$, $y = [0.7, 0.0, -0.2]$。\n  - 情况 4: $x = [10.0, 8.0, 12.0, 9.0, 7.0]$, $dx = [0.001, -0.002, 0.0015, -0.0005, 0.0008]$, $y = [-0.4, 0.9, 0.3]$。\n  - 情况 5: $x = [0, 0, 0, 0, 0]$, $dx = [0.05, -0.05, 0.02, 0.01, -0.01]$, $y = [0.5, -1.0, 0.25]$。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据充分：** 该问题基于辐射传输的基本原理——比尔-朗伯定律，并使用了数据同化领域的标准数学工具（微积分、线性代数）和概念（切线性模型和伴随模型）。该问题在科学上是合理的。\n- **适定性良好：** 所有必需的输入、参数和定义均已提供。任务是执行一组特定的计算，这将为每个测试用例得出唯一的数值结果。\n- **客观性：** 该问题使用精确的数学形式化语言陈述，没有任何主观或模糊的语言。\n- **完整性和一致性：** 问题是自洽的。所有矩阵、向量和常数都已完全指定。维度是一致的：$\\alpha$ 是一个 $3 \\times 5$ 矩阵，$x$ 是一个 $5$ 维向量，因此 $\\tau = \\alpha x$ 正确地产生一个 $3$ 维向量。所有后续操作在维度上也是一致的。\n- **未检测到其他缺陷：** 该问题并非不切实际（它是一个简化模型）、不适定、微不足道或无法验证。\n\n**步骤 3：结论与行动**\n此问题是**有效的**。将提供完整的解决方案。\n\n### 推导与求解\n\n任务的核心是为给定的正向算子 $F$ 推导切线性（TL）和伴随（AD）算子，该算子将状态向量 $x \\in \\mathbb{R}^n$ 映射到辐射率向量 $R \\in \\mathbb{R}^m$。正向过程是一系列操作：\n$1$. 光学深度：$\\tau(x) = \\alpha x$。对于每个通道 $j$，$\\tau_j = \\sum_{i=1}^{n} \\alpha_{j,i} x_i$。\n$2$. 透射率：$T(\\tau) = \\exp(-\\tau)$。对于每个通道 $j$，$T_j = \\exp(-\\tau_j)$。\n$3$. 辐射率：$R(T) = T \\odot S_0 + (\\mathbf{1}-T) \\odot S_1$。对于每个通道 $j$，$R_j = T_j S_{0,j} + (1-T_j)S_{1,j}$。此处，$\\odot$ 表示逐元素（Hadamard）乘积，$\\mathbf{1}$ 是一个全为1的向量。\n\n**1. 切线性（TL）算子推导**\n\nTL 算子 $H_x$ 描述了一个小微扰 $dx$ 如何通过正向算子 $F$ 传播。我们通过对操作序列应用链式法则来找到其作用 $H_x dx = dR$。\n\n- **光学深度的微扰：** 光学深度的计算是线性操作 $\\tau = \\alpha x$。因此，微擾 $d\\tau$ 由下式给出：\n  $$d\\tau = \\alpha dx$$\n- **透射率的微扰：** 透射率为 $T_j = \\exp(-\\tau_j)$。应用链式法则，微扰 $d\\tau_j$ 引起微扰 $dT_j$：\n  $$dT_j = \\frac{\\partial T_j}{\\partial \\tau_j} d\\tau_j = -\\exp(-\\tau_j) d\\tau_j = -T_j d\\tau_j$$\n  用向量形式，使用逐元素乘积：\n  $$dT = -T \\odot d\\tau$$\n- **辐射率的微扰：** 辐射率为 $R_j = T_j S_{0,j} + (1-T_j)S_{1,j} = T_j(S_{0,j} - S_{1,j}) + S_{1,j}$。微扰 $dT_j$ 引起微扰 $dR_j$：\n  $$dR_j = \\frac{\\partial R_j}{\\partial T_j} dT_j = (S_{0,j} - S_{1,j}) dT_j$$\n  用向量形式：\n  $$dR = (S_0 - S_1) \\odot dT$$\n- **合并步骤：** 我们向后代入表达式，将 $dR$ 与 $dx$ 关联起来。\n  $$dR = (S_0 - S_1) \\odot dT = (S_0 - S_1) \\odot (-T \\odot d\\tau) = -(S_0 - S_1) \\odot T \\odot d\\tau$$\n  最后，代入 $d\\tau = \\alpha dx$：\n  $$H_x dx = dR = -(S_0 - S_1) \\odot T \\odot (\\alpha dx)$$\n  此方程定义了切线性算子 $H_x$ 对微扰向量 $dx$ 的作用。透射率向量 $T = \\exp(-\\alpha x)$ 必须在线性化点 $x$ 计算。\n\n**2. 伴随（AD）算子推导**\n\n伴随算子 $H_x^\\top$ 由恒等式 $\\langle H_x dx, y \\rangle = \\langle dx, H_x^\\top y \\rangle$ 定义，对任意向量 $y \\in \\mathbb{R}^m$ 成立。线性算子复合的伴随是其伴随算子以相反顺序的复合。我们反向追踪 TL 链，并转置每个线性算子。\n\nTL 链为：$dx \\xrightarrow{L_1} d\\tau \\xrightarrow{L_2} dT \\xrightarrow{L_3} dR$，其中：\n- $L_1(dx) = \\alpha dx$\n- $L_2(d\\tau) = -\\mathrm{diag}(T) d\\tau$\n- $L_3(dT) = \\mathrm{diag}(S_0 - S_1) dT$\n\n伴随链为 $y \\xrightarrow{L_3^\\top} y_{AD}^{(T)} \\xrightarrow{L_2^\\top} y_{AD}^{(\\tau)} \\xrightarrow{L_1^\\top} dx_{AD}$，其中 $dx_{AD} = H_x^\\top y$。\n\n- **辐射率步骤的伴随 ($L_3^\\top$)：** 该线性算子是乘以对角矩阵 $\\mathrm{diag}(S_0 - S_1)$，这是一个对称矩阵。因此，$L_3^\\top=L_3$。\n  $$y_{AD}^{(T)} = \\mathrm{diag}(S_0 - S_1) y = (S_0 - S_1) \\odot y$$\n- **透射率步骤的伴随 ($L_2^\\top$)：** 该线性算子是乘以 $-\\mathrm{diag}(T)$，这也是一个对称矩阵。因此，$L_2^\\top=L_2$。\n  $$y_{AD}^{(\\tau)} = -\\mathrm{diag}(T) y_{AD}^{(T)} = -T \\odot y_{AD}^{(T)}$$\n  代入前一步的结果：\n  $$y_{AD}^{(\\tau)} = -T \\odot ((S_0 - S_1) \\odot y)$$\n- **光学深度步骤的伴随 ($L_1^\\top$)：** 该线性算子是乘以矩阵 $\\alpha$。其伴随是乘以转置矩阵 $\\alpha^\\top$。\n  $$dx_{AD} = \\alpha^\\top y_{AD}^{(\\tau)}$$\n- **合并步骤：** 我们组合这些表达式以获得伴随算子的最终作用。\n  $$H_x^\\top y = dx_{AD} = \\alpha^\\top \\left( -T \\odot ((S_0 - S_1) \\odot y) \\right)$$\n  $$H_x^\\top y = -\\alpha^\\top (T \\odot (S_0 - S_1) \\odot y)$$\n  此方程定义了伴随算子 $H_x^\\top$ 对向量 $y$ 的作用。\n\n**3. 实现与一致性检验**\n\n推导出的 TL 和 AD 作用被实现为函数。一致性检验计算伴随恒等式的两项，即 $\\langle H_x dx, y \\rangle$ 和 $\\langle dx, H_x^\\top y \\rangle$，并使用提供的公式计算它们的相对差异 $\\epsilon$。计算并报告了五个测试用例的结果。实现证实，对于所有测试用例，差异都非常小（在 $10^{-16}$ 的数量级或恰好为 $0$），远在要求的 $10^{-12}$ 容差之内，从而验证了 TL 和 AD 推导及其实现的正确性。\n\n```python\nimport numpy as np\n\n# Fixed parameters from the problem statement\nALPHA = np.array([\n    [0.7, 0.1, 0.05, 0.2, 0.3],\n    [0.02, 0.5, 0.1, 0.4, 0.05],\n    [0.3, 0.3, 0.8, 0.1, 0.2]\n])\nS0 = np.array([2.5, 0.5, 1.8])\nS1 = np.array([0.2, 0.5, 1.2])\n\ndef tangent_linear_action(x, dx):\n    \"\"\"Computes the action of the tangent-linear operator H_x on a perturbation dx.\"\"\"\n    tau = ALPHA @ x\n    T = np.exp(-tau)\n    dtau = ALPHA @ dx\n    dT = -T * dtau\n    dR = (S0 - S1) * dT\n    return dR\n\ndef adjoint_action(x, y):\n    \"\"\"Computes the action of the adjoint operator H_x^T on a vector y.\"\"\"\n    tau = ALPHA @ x\n    T = np.exp(-tau)\n    y_T = (S0 - S1) * y\n    y_tau = -T * y_T\n    y_x = ALPHA.T @ y_tau\n    return y_x\n\ndef run_consistency_test(x, dx, y):\n    \"\"\"Performs the TL/AD consistency test and computes the relative discrepancy.\"\"\"\n    lhs_action = tangent_linear_action(x, dx)\n    rhs_action = adjoint_action(x, y)\n    \n    val1 = np.dot(lhs_action, y)\n    val2 = np.dot(dx, rhs_action)\n    \n    numerator = np.abs(val1 - val2)\n    denominator = np.max([1.0, np.abs(val1), np.abs(val2)])\n    \n    if denominator == 0.0:\n        return 0.0\n    \n    epsilon = numerator / denominator\n    return epsilon\n\n# Test cases from the problem statement\ntest_cases = [\n    # Case 1\n    (np.array([0.8, 0.4, 1.2, 0.6, 0.3]), np.array([0.02, -0.03, 0.01, 0.00, -0.02]), np.array([1.0, -0.5, 0.7])),\n    # Case 2\n    (np.array([0.8, 0.4, 1.2, 0.6, 0.3]), np.array([0, 0, 0, 0, 0]), np.array([0.1, 0.2, -0.1])),\n    # Case 3\n    (np.array([0.8, 0.4, 1.2, 0.6, 0.3]), np.array([1e-8, -2e-8, 1e-9, -3e-9, 0]), np.array([0.7, 0.0, -0.2])),\n    # Case 4\n    (np.array([10.0, 8.0, 12.0, 9.0, 7.0]), np.array([0.001, -0.002, 0.0015, -0.0005, 0.0008]), np.array([-0.4, 0.9, 0.3])),\n    # Case 5\n    (np.array([0, 0, 0, 0, 0]), np.array([0.05, -0.05, 0.02, 0.01, -0.01]), np.array([0.5, -1.0, 0.25]))\n]\n\n# Run the tests and collect results\nresults = []\nfor x_case, dx_case, y_case in test_cases:\n    epsilon = run_consistency_test(x_case, dx_case, y_case)\n    results.append(epsilon)\n\n# The final answer is the list of computed epsilon values.\n# print(f\"[{','.join(map(str, results))}]\")\n```",
            "answer": "[8.225501865910903e-17,0.0,2.152869573621443e-17,0.0,0.0]"
        }
    ]
}