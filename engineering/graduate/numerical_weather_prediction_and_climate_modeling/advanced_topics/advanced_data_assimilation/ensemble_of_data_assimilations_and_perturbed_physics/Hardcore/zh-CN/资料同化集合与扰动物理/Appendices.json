{
    "hands_on_practices": [
        {
            "introduction": "数据同化的核心是贝叶斯推断问题，即如何将新的观测信息与我们已有的背景知识（通常来自模式预报）相结合。这个练习将复杂的集合同化系统简化为一个标量系统，让您能够从第一性原理出发，推导出后验（或称分析）均值和方差的表达式。通过这个过程，您将亲手实践贝叶斯定理如何量化地指导我们融合信息，并理解计算出的“信息含量”度量  实质上就是经典的卡尔曼增益，它决定了观测在更新最终分析场中所占的权重。",
            "id": "4037075",
            "problem": "在一个简化的、具有扰动物理过程的数值天气预报一维试验平台中，考虑一个标量状态变量 $x$，它代表一个空间平均的大气量。对于该变量，一组模式积分集合产生了一个高斯背景（先验）分布 $x \\sim \\mathcal{N}(x_b, P_b)$。假设集合平均值为 $x_b = 0$，集合方差为 $P_b = 1$，这与无偏的物理扰动集合离散度一致。通过线性观测算子 $H = 1$ 可获得该状态的单个观测值 $y$，其观测误差 $\\epsilon \\sim \\mathcal{N}(0, R)$ 是加性的、无偏的、高斯的，其中 $R = 0.25$。实现的观测值为 $y = 2$。\n\n从Bayes定理和上述线性高斯假设出发，推导后验（分析）分布 $p(x \\mid y)$ 的闭合形式。特别地，将分析平均值 $x_a$ 和分析方差 $P_a$ 表示为 $x_b$、$P_b$、$H$、$R$ 和 $y$ 的函数，并且不使用任何不能从这些假设中推导出的公式。接下来，定义一个标量信息含量度量，即在线性高斯模型下分析平均值对观测值的敏感度，即导数 $\\partial x_a / \\partial y$，并根据给定的数值参数和观测值计算其值。\n\n以行矩阵的形式提供最终的数值输出，按顺序包含分析平均值 $x_a$、分析方差 $P_a$ 和信息含量度量 $\\partial x_a / \\partial y$。无需四舍五入。不要包含单位。此外，简要解释计算出的敏感度对于观测值相对于先验值的权重意味着什么。",
            "solution": "问题要求在给定先验分布和观测值 $y$ 的情况下，求状态变量 $x$ 的后验分布 $p(x \\mid y)$。我们从Bayes定理开始，该定理指出后验概率与似然概率和先验概率的乘积成正比：\n$$p(x \\mid y) \\propto p(y \\mid x) p(x)$$\n\n状态变量 $x$ 的先验分布是高斯分布，$x \\sim \\mathcal{N}(x_b, P_b)$，其中平均值为 $x_b$，方差为 $P_b$。先验的概率密度函数（PDF）为：\n$$p(x) = \\frac{1}{\\sqrt{2\\pi P_b}} \\exp\\left(-\\frac{1}{2} \\frac{(x - x_b)^2}{P_b}\\right)$$\n\n观测值 $y$ 通过线性观测模型 $y = Hx + \\epsilon$ 与状态 $x$ 相关，其中 $H$ 是观测算子，$\\epsilon$ 是观测误差。误差为无偏高斯分布，方差为 $R$，即 $\\epsilon \\sim \\mathcal{N}(0, R)$。这意味着似然函数，即在给定 $x$ 的条件下 $y$ 的分布，也是高斯分布：$y \\mid x \\sim \\mathcal{N}(Hx, R)$。似然的PDF为：\n$$p(y \\mid x) = \\frac{1}{\\sqrt{2\\pi R}} \\exp\\left(-\\frac{1}{2} \\frac{(y - Hx)^2}{R}\\right)$$\n\n将先验和似然的PDF代入Bayes定理，我们得到后验分布：\n$$p(x \\mid y) \\propto \\exp\\left(-\\frac{1}{2} \\frac{(x - x_b)^2}{P_b}\\right) \\exp\\left(-\\frac{1}{2} \\frac{(y - Hx)^2}{R}\\right)$$\n我们可以合并指数部分：\n$$p(x \\mid y) \\propto \\exp\\left(-\\frac{1}{2} \\left[ \\frac{(x - x_b)^2}{P_b} + \\frac{(y - Hx)^2}{R} \\right]\\right)$$\n方括号内的项，通常表示为代价函数 $J(x)$，是：\n$$J(x) = \\frac{(x - x_b)^2}{P_b} + \\frac{(y - Hx)^2}{R}$$\n由于后验分布的PDF是关于 $x$ 的二次函数的指数，因此后验分布也是高斯分布，我们可以写成 $x \\mid y \\sim \\mathcal{N}(x_a, P_a)$。后验的PDF为：\n$$p(x \\mid y) = \\frac{1}{\\sqrt{2\\pi P_a}} \\exp\\left(-\\frac{1}{2} \\frac{(x - x_a)^2}{P_a}\\right)$$\n为了找到分析平均值 $x_a$ 和分析方差 $P_a$，我们可以将 $J(x)$ 展开为 $x$ 的幂次形式，并将其与后验PDF的指数部分进行比较。\n$$J(x) = \\frac{x^2 - 2xx_b + x_b^2}{P_b} + \\frac{y^2 - 2yHx + H^2x^2}{R}$$\n$$J(x) = x^2 \\left(\\frac{1}{P_b} + \\frac{H^2}{R}\\right) - 2x \\left(\\frac{x_b}{P_b} + \\frac{yH}{R}\\right) + \\left(\\frac{x_b^2}{P_b} + \\frac{y^2}{R}\\right)$$\n后验高斯分布中指数的一般形式是 $\\frac{(x - x_a)^2}{P_a} = \\frac{x^2}{P_a} - \\frac{2xx_a}{P_a} + \\frac{x_a^2}{P_a}$。\n通过将 $J(x)$ 中 $x^2$ 项的系数与此形式进行比较，我们确定分析方差的倒数：\n$$\\frac{1}{P_a} = \\frac{1}{P_b} + \\frac{H^2}{R}$$\n这就得到了分析方差 $P_a$：\n$$P_a = \\left(\\frac{1}{P_b} + \\frac{H^2}{R}\\right)^{-1} = \\frac{P_b R}{R + P_b H^2}$$\n通过比较 $x$ 项的系数，我们得到：\n$$\\frac{x_a}{P_a} = \\frac{x_b}{P_b} + \\frac{yH}{R}$$\n这就得到了分析平均值 $x_a$：\n$$x_a = P_a \\left(\\frac{x_b}{P_b} + \\frac{yH}{R}\\right)$$\n这就完成了后验平均值和方差的推导。\n\n接下来，我们定义标量信息含量度量为分析平均值对观测值的敏感度 $\\frac{\\partial x_a}{\\partial y}$。使用推导出的 $x_a$ 表达式，并将 $x_b$、$P_b$、$P_a$、$H$ 和 $R$ 视为不依赖于 $y$ 的具体实现值的量：\n$$\\frac{\\partial x_a}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ P_a \\left(\\frac{x_b}{P_b} + \\frac{Hy}{R}\\right) \\right] = P_a \\left(0 + \\frac{H}{R}\\right) = \\frac{P_a H}{R}$$\n代入 $P_a$ 的表达式：\n$$\\frac{\\partial x_a}{\\partial y} = \\left(\\frac{P_b R}{R + P_b H^2}\\right) \\frac{H}{R} = \\frac{P_b H}{R + P_b H^2}$$\n这个表达式是著名的Kalman增益，通常用 $K$ 表示。\n\n现在我们使用给定的参数计算数值：$x_b = 0$，$P_b = 1$，$H = 1$，$R = 0.25$，以及实现的观测值 $y = 2$。\n\n首先，分析方差 $P_a$：\n$$P_a = \\frac{1 \\cdot 0.25}{0.25 + 1 \\cdot 1^2} = \\frac{0.25}{1.25} = \\frac{1/4}{5/4} = \\frac{1}{5} = 0.2$$\n\n其次，分析平均值 $x_a$：\n$$x_a = P_a \\left(\\frac{x_b}{P_b} + \\frac{yH}{R}\\right) = 0.2 \\left(\\frac{0}{1} + \\frac{2 \\cdot 1}{0.25}\\right) = 0.2 \\left(8\\right) = 1.6$$\n\n第三，信息含量度量（敏感度）$\\frac{\\partial x_a}{\\partial y}$：\n$$\\frac{\\partial x_a}{\\partial y} = \\frac{P_a H}{R} = \\frac{0.2 \\cdot 1}{0.25} = \\frac{0.2}{0.25} = \\frac{20}{25} = \\frac{4}{5} = 0.8$$\n\n敏感度值 $\\frac{\\partial x_a}{\\partial y} = 0.8$ 代表在确定最终分析时给予观测值的权重。它量化了当观测值发生单位变化时，分析平均值会改变多少。在本例中，$y$ 变化 $1.0$ 会导致 $x_a$ 变化 $0.8$。分析平均值 $x_a$ 是背景信息和观测信息的加权平均。当 $H=1$ 时，分析可以写成 $x_a = (1-K)x_b + Ky$，其中 $K=0.8$。这得到 $x_a = (0.2)x_b + (0.8)y$。$K=0.8$ 这个值表明对观测值有很高的敏感度，意味着观测值的权重远大于背景（先验）状态。这与给定的方差是一致的：背景方差为 $P_b=1$，而观测误差方差为 $R=0.25$。由于观测值的精度是背景的四倍（$P_b/R = 4$），因此它对最终结果的贡献权重也是背景的四倍（$0.8/0.2 = 4$）。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.6 & 0.2 & 0.8\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在理想化的世界里，模式是完美的，集合能够完全捕捉预报的不确定性。然而在现实中，由于模式误差和有限的集合成员数量，预报集合往往存在“离散度不足”（under-dispersive）的问题，即集合的离散程度小于真实的预报误差。这个练习  介绍了一种关键的实用技术——乘性方差膨胀（multiplicative variance inflation）——来弥补这一缺陷。您将通过一个具体的计算，学习如何利用新息（观测与预报之差）的统计特性来校准膨胀因子 $\\lambda$，确保集合系统的统计一致性。",
            "id": "4037121",
            "problem": "考虑一个用于集合卡尔曼滤波器 (EnKF) 的一维线性高斯数据同化场景，其中观测算子为单位算子。设从一个由扰动参数物理过程生成的集合中估计出的先验（预报）误差协方差表示为 $P^{f}$。由于对模式误差的不完美表示，集合是离散度不足的（underdispersive），因此应用了乘性协方差膨胀：膨胀后的先验协方差定义为 $\\lambda P^{f}$，其中 $\\lambda$ 是一个待确定的标量膨胀因子。\n\n设新息为 $d = y - H x^{f}$，其中 $y$ 是观测值，$H$ 是观测算子，$x^{f}$ 是先验状态。在具有高斯误差的线性、无偏条件下，经过乘性膨胀后滤波器预测的新息方差为 $S_{\\text{infl}} = H \\left(\\lambda P^{f}\\right) H^{\\top} + R$，其中 $R$ 是观测误差方差。在观测算子为单位算子的标量情况下，该式简化为 $S_{\\text{infl}} = \\lambda P^{f} + R$。\n\n假设从一个足够大的时间窗口中，观测到的均方新息为 $E[d^{2}] = 1.0$（在平稳性假设下可解释为预期的新息方差），先验集合协方差为 $P^{f} = 0.5$，观测误差方差为 $R = 0.2$。假设 $H$ 是单位算子且所有量均为标量，确定乘性膨胀因子 $\\lambda$ 的值，使得预测的新息方差与观测到的均方新息一致。\n\n提供你的最终答案 $\\lambda$，四舍五入到四位有效数字。报告一个无单位的值。",
            "solution": "确定膨胀因子 $\\lambda$ 的核心原则是强制滤波器预测的统计量与观测到的新息统计量之间的一致性。新息 $d$ 是观测值 $y$ 与投影到观测空间的预报值 $H x^f$ 之间的差值。\n\n根据滤波器的统计模型预测的新息方差由新息协方差公式 $S$ 给出。在这个具体问题中，将一个乘性膨胀因子 $\\lambda$ 应用于先验误差协方差 $P^f$。膨胀后的预测新息方差 $S_{\\text{infl}}$ 的公式为：\n$$S_{\\text{infl}} = H (\\lambda P^{f}) H^{\\top} + R$$\n问题指定了一个一维（标量）情况，其中观测算子 $H$ 是单位算子。在标量背景下，$H=1$ 且转置不起作用。该公式简化为：\n$$S_{\\text{infl}} = \\lambda P^{f} + R$$\n这是新息的理论或预测方差。\n\n问题还提供了新息方差的观测统计量，即均方新息 $E[d^2]$。假设滤波器是无偏的（即，平均新息 $E[d]$ 为零），则新息的方差等于均方新息。\n$$\\text{Var}(d) = E[d^2]$$\n给定值为 $E[d^2] = 1.0$。\n\n为确保一致性，我们令预测的新息方差等于观测到的新息方差：\n$$S_{\\text{infl}} = E[d^2]$$\n代入两边的表达式，我们得到求解 $\\lambda$ 的方程：\n$$\\lambda P^{f} + R = E[d^2]$$\n现在我们可以用代数方法求解 $\\lambda$：\n$$\\lambda P^{f} = E[d^2] - R$$\n$$\\lambda = \\frac{E[d^2] - R}{P^{f}}$$\n问题提供了以下数值：\n-   $E[d^2] = 1.0$\n-   $R = 0.2$\n-   $P^{f} = 0.5$\n\n将这些值代入 $\\lambda$ 的表达式中：\n$$\\lambda = \\frac{1.0 - 0.2}{0.5}$$\n$$\\lambda = \\frac{0.8}{0.5}$$\n$$\\lambda = 1.6$$\n问题要求答案四舍五入到四位有效数字。精确值 $1.6$ 可以写成 $1.600$ 以满足此要求。这个结果在物理上是合理的，因为 $\\lambda > 1$ 的值表明原始的预报集合是离散度不足的（其方差 $P^f$ 太小），需要进行膨胀才能与观测值在统计上保持一致。",
            "answer": "$$\\boxed{1.600}$$"
        },
        {
            "introduction": "理论推导和参数调整是基础，但最终我们需要在代码中实现这些算法。这个实践练习  将引导您进入集合数据同化的编程实践，比较两种主流的集合卡尔曼滤波（EnKF）算法：随机的“扰动观测”EnKF 和确定性的“集合平方根滤波”（EnSRF）。通过为一个包含物理过程扰动的系统编写代码并运行两种方案，您将能够量化比较它们在分析场的均值、方差乃至高阶矩（如偏度和峰度）上的差异。这项实践有助于深刻理解不同算法在处理采样误差和维持由模式物理过程引入的非高斯特性方面的优缺点。",
            "id": "4037082",
            "problem": "考虑一个适用于对带有扰动物理的低维系统进行集成卡尔曼滤波（EnKF）分析的线性高斯数据同化设置。设状态向量为 $\\mathbf{x} \\in \\mathbb{R}^n$，其中 $n=2$，第一个分量是观测变量。观测算子为 $\\mathbf{H} \\in \\mathbb{R}^{1 \\times 2}$，它提取第一个分量，即 $\\mathbf{H} = [1, 0]$。观测方程为 $y = \\mathbf{H} \\mathbf{x} + \\eta$，其中 $\\eta \\sim \\mathcal{N}(0, R)$，$R \\in \\mathbb{R}$ 是观测误差方差。先验（背景）集合由高斯分布 $\\mathcal{N}(\\mathbf{x}_b, \\mathbf{P}_b)$ 生成，集合大小为 $m \\in \\mathbb{N}$。\n\n为了表示扰动物理，每个集合成员通过一个依赖于物理参数 $c \\in \\mathbb{R}$ 的线性模型向前预报一步，其中每个成员的参数 $c_i$ 独立地从 $\\mathcal{N}(c_0, \\sigma_c^2)$ 中采样。对于大小为 $dt$ 的时间步和线性阻尼系数 $d$，预报模型为\n$$\n\\mathbf{M}(c) = \n\\begin{bmatrix}\n1 & dt \\, c \\\\\n- dt \\, c & 1 - dt \\, d\n\\end{bmatrix},\n$$\n成员 $i$ 的预报更新为\n$$\n\\mathbf{x}_i^{f} = \\mathbf{M}(c_i) \\, \\mathbf{x}_i^{b} + \\mathbf{w}_i,\n$$\n其中 $\\mathbf{w}_i \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{Q})$ 是附加模型误差，其协方差为 $\\mathbf{Q} \\in \\mathbb{R}^{2 \\times 2}$。\n\n定义预报时刻的集合均值和距平：\n$$\n\\bar{\\mathbf{x}}^{f} = \\frac{1}{m} \\sum_{i=1}^{m} \\mathbf{x}_i^{f}, \\quad\n\\mathbf{A}^{f} = \\left[ \\mathbf{x}_1^{f} - \\bar{\\mathbf{x}}^{f}, \\ldots, \\mathbf{x}_m^{f} - \\bar{\\mathbf{x}}^{f} \\right] \\in \\mathbb{R}^{2 \\times m},\n$$\n以及预报协方差\n$$\n\\mathbf{P}^{f} = \\frac{1}{m-1} \\mathbf{A}^{f} (\\mathbf{A}^{f})^{\\top}.\n$$\n卡尔曼增益由预报集合计算得出\n$$\n\\mathbf{K} = \\mathbf{P}^{f} \\mathbf{H}^{\\top} \\left( \\mathbf{H} \\mathbf{P}^{f} \\mathbf{H}^{\\top} + R \\right)^{-1}.\n$$\n\n您需要根据第一个分量的单个标量观测 $y_{\\text{obs}} \\in \\mathbb{R}$ 计算两个分析集合：\n\n- 带扰动观测的随机集成卡尔曼滤波（EnKF）：\n  - 对每个成员 $i$，独立采样 $\\epsilon_i \\sim \\mathcal{N}(0, R)$ 并更新\n    $$\n    \\mathbf{x}_i^{a, \\text{sto}} = \\mathbf{x}_i^{f} + \\mathbf{K} \\left( y_{\\text{obs}} + \\epsilon_i - \\mathbf{H} \\mathbf{x}_i^{f} \\right).\n    $$\n\n- 针对标量观测的确定性集合平方根滤波（EnSRF）：\n  - 更新分析均值\n    $$\n    \\bar{\\mathbf{x}}^{a} = \\bar{\\mathbf{x}}^{f} + \\mathbf{K} \\left( y_{\\text{obs}} - \\mathbf{H} \\bar{\\mathbf{x}}^{f} \\right).\n    $$\n  - 设观测空间距平为 $\\mathbf{s} = \\mathbf{H} \\mathbf{A}^{f} \\in \\mathbb{R}^{1 \\times m}$。设 $S = \\mathbf{H} \\mathbf{P}^{f} \\mathbf{H}^{\\top} \\in \\mathbb{R}$。定义确定性距平更新\n    $$\n    \\mathbf{A}^{a} = \\mathbf{A}^{f} - \\mathbf{K} \\, \\frac{\\mathbf{s}}{1 + \\sqrt{R / S}},\n    $$\n    其中，除以标量 $(1 + \\sqrt{R / S})$ 的操作逐元素应用于 $1 \\times m$ 的行向量 $\\mathbf{s}$。如果 $S=0$，则取 $\\mathbf{A}^{a} = \\mathbf{A}^{f}$。确定性分析集合重构如下\n    $$\n    \\mathbf{x}_i^{a, \\text{det}} = \\bar{\\mathbf{x}}^{a} + \\mathbf{A}^{a}_{[:, i]}.\n    $$\n\n对于每个分析集合，关注第一个分量（观测变量）的分布。计算以下样本统计量：\n- 样本均值 $\\mu = \\frac{1}{m} \\sum_{i=1}^{m} z_i$，其中 $z_i$ 是分析集合的第一个分量。\n- 样本方差 $\\sigma^2 = \\frac{1}{m} \\sum_{i=1}^{m} (z_i - \\mu)^2$。\n- 样本偏度 $\\gamma_1 = \\mu_3 / \\mu_2^{3/2}$，其中 $\\mu_k = \\frac{1}{m} \\sum_{i=1}^{m} (z_i - \\mu)^k$。\n- 样本超额峰度 $\\gamma_2 = \\mu_4 / \\mu_2^2 - 3$。\n\n通过返回以下四个值来量化确定性分析和随机性分析之间的差异\n$$\n\\Delta \\mu = \\mu_{\\text{det}} - \\mu_{\\text{sto}}, \\quad\n\\Delta \\sigma^2 = \\sigma^2_{\\text{det}} - \\sigma^2_{\\text{sto}}, \\quad\n\\Delta \\gamma_1 = \\gamma_{1,\\text{det}} - \\gamma_{1,\\text{sto}}, \\quad\n\\Delta \\gamma_2 = \\gamma_{2,\\text{det}} - \\gamma_{2,\\text{sto}}.\n$$\n\n使用以下测试套件实现上述过程。每个测试用例指定 $(m, c_0, \\sigma_c, dt, d, \\mathbf{Q}, \\mathbf{x}_b, \\mathbf{P}_b, y_{\\text{obs}}, R, \\text{seed})$，所有量均为实数，矩阵如指定：\n\n- 测试用例 1 (一般情况):\n  - $m = 20$, $c_0 = 0.4$, $\\sigma_c = 0.1$, $dt = 0.5$, $d = 0.2$,\n  - $\\mathbf{Q} = \\operatorname{diag}(0.01, 0.01)$,\n  - $\\mathbf{x}_b = [1.0, -0.5]^{\\top}$, $\\mathbf{P}_b = \\operatorname{diag}(0.25, 0.09)$,\n  - $y_{\\text{obs}} = 0.8$, $R = 0.04$, $\\text{seed} = 123$。\n\n- 测试用例 2 (小集合，大观测误差):\n  - $m = 3$, $c_0 = 0.3$, $\\sigma_c = 0.05$, $dt = 0.2$, $d = 0.1$,\n  - $\\mathbf{Q} = \\operatorname{diag}(0.0, 0.0)$,\n  - $\\mathbf{x}_b = [0.0, 0.0]^{\\top}$, $\\mathbf{P}_b = \\operatorname{diag}(0.16, 0.16)$,\n  - $y_{\\text{obs}} = -0.2$, $R = 1.0$, $\\text{seed} = 42$。\n\n- 测试用例 3 (小观测误差，中等物理扰动):\n  - $m = 15$, $c_0 = 0.5$, $\\sigma_c = 0.2$, $dt = 0.3$, $d = 0.15$,\n  - $\\mathbf{Q} = \\operatorname{diag}(0.005, 0.005)$,\n  - $\\mathbf{x}_b = [0.5, 0.5]^{\\top}$, $\\mathbf{P}_b = \\operatorname{diag}(0.04, 0.04)$,\n  - $y_{\\text{obs}} = 0.6$, $R = 0.0001$, $\\text{seed} = 7$。\n\n- 测试用例 4 (无物理或模型扰动，较大集合):\n  - $m = 30$, $c_0 = 0.2$, $\\sigma_c = 0.0$, $dt = 0.1$, $d = 0.0$,\n  - $\\mathbf{Q} = \\operatorname{diag}(0.0, 0.0)$,\n  - $\\mathbf{x}_b = [1.0, 1.0]^{\\top}$, $\\mathbf{P}_b = \\operatorname{diag}(0.01, 0.01)$,\n  - $y_{\\text{obs}} = 1.05$, $R = 0.01$, $\\text{seed} = 888$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果必须是四个浮点数的列表 $[\\Delta \\mu, \\Delta \\sigma^2, \\Delta \\gamma_1, \\Delta \\gamma_2]$，其顺序与测试套件中的顺序相同，从而产生以下形式的总体输出\n$$\n\\left[ [\\Delta \\mu_1, \\Delta \\sigma^2_1, \\Delta \\gamma_{1,1}, \\Delta \\gamma_{2,1}], [\\Delta \\mu_2, \\Delta \\sigma^2_2, \\Delta \\gamma_{1,2}, \\Delta \\gamma_{2,2}], [\\Delta \\mu_3, \\Delta \\sigma^2_3, \\Delta \\gamma_{1,3}, \\Delta \\gamma_{2,3}], [\\Delta \\mu_4, \\Delta \\sigma^2_4, \\Delta \\gamma_{1,4}, \\Delta \\gamma_{2,4}] \\right].\n$$\n无需物理单位，所有角度都通过 $\\mathbf{M}(c)$ 中指定的线性耦合隐式处理，这不需要角度单位。最终输出必须是原始十进制数，不带百分号，并且必须完全按照每个测试用例中分析集合的第一个分量分布的规定进行计算。",
            "solution": "解决方案的步骤是为每个测试用例实现指定的数据同化循环。该过程涉及几个不同步骤：生成初始集合，使用扰动模型随时间向前传播，计算预报统计量和卡尔曼增益，应用两种不同的分析更新（随机和确定性），最后计算并比较所得分析分布的统计矩。\n\n**1. 集合和参数生成**\n\n对于每个测试用例，我们首先用指定的种子初始化伪随机数生成器以确保可复现性。采样以下随机变量：\n-   一个大小为 $m$ 的初始背景集合 $\\{\\mathbf{x}_i^b\\}_{i=1}^m$，其中每个成员都从多元正态分布 $\\mathcal{N}(\\mathbf{x}_b, \\mathbf{P}_b)$ 中抽取。每个 $\\mathbf{x}_i^b \\in \\mathbb{R}^2$。\n-   一组物理参数 $\\{c_i\\}_{i=1}^m$，其中每个 $c_i$ 都独立地从正态分布 $\\mathcal{N}(c_0, \\sigma_c^2)$ 中抽取。\n-   一组附加模型误差 $\\{\\mathbf{w}_i\\}_{i=1}^m$，其中每个 $\\mathbf{w}_i$ 都从 $\\mathcal{N}(\\mathbf{0}, \\mathbf{Q})$ 中抽取。\n-   一组用于随机滤波器的观测扰动 $\\{\\epsilon_i\\}_{i=1}^m$，其中每个 $\\epsilon_i$ 都从 $\\mathcal{N}(0, R)$ 中抽取。\n\n**2. 预报步骤**\n\n每个背景集合成员 $\\mathbf{x}_i^b$ 都使用其对应的扰动物理参数 $c_i$ 和模型误差 $\\mathbf{w}_i$ 向前推进到预报时刻。成员 $i$ 的预报模型由一个线性变换 $\\mathbf{M}(c_i)$ 加上一个附加误差给出：\n$$\n\\mathbf{x}_i^{f} = \\mathbf{M}(c_i) \\, \\mathbf{x}_i^{b} + \\mathbf{w}_i,\n$$\n其中模型矩阵 $\\mathbf{M}(c_i)$ 定义为：\n$$\n\\mathbf{M}(c_i) = \n\\begin{bmatrix}\n1 & dt \\, c_i \\\\\n- dt \\, c_i & 1 - dt \\, d\n\\end{bmatrix}.\n$$\n此步骤生成预报集合 $\\{\\mathbf{x}_i^f\\}_{i=1}^m$。在模型矩阵中引入随机参数 $c_i$ 意味着即使背景集合是完全高斯的，由于乘积项 $c_i \\mathbf{x}_i^b$ 的存在，预报集合通常也是非高斯的。\n\n**3. 预报统计量和卡尔曼增益**\n\n从预报集合中，我们计算卡尔曼更新所需的样本统计量。\n-   预报集合均值： $\\bar{\\mathbf{x}}^{f} = \\frac{1}{m} \\sum_{i=1}^{m} \\mathbf{x}_i^{f}$。\n-   预报集合距平，以矩阵列的形式收集： $\\mathbf{A}^{f} = \\left[ \\mathbf{x}_1^{f} - \\bar{\\mathbf{x}}^{f}, \\ldots, \\mathbf{x}_m^{f} - \\bar{\\mathbf{x}}^{f} \\right]$。\n-   样本预报误差协方差矩阵，使用因子 $\\frac{1}{m-1}$ 以获得无偏估计： $\\mathbf{P}^{f} = \\frac{1}{m-1} \\mathbf{A}^{f} (\\mathbf{A}^{f})^{\\top}$。\n\n然后计算卡尔曼增益 $\\mathbf{K} \\in \\mathbb{R}^{2 \\times 1}$。它平衡了预报和观测之间的信任度。给定观测算子 $\\mathbf{H} = [1, 0]$ 和观测误差方差 $R$，增益为：\n$$\n\\mathbf{K} = \\mathbf{P}^{f} \\mathbf{H}^{\\top} \\left( \\mathbf{H} \\mathbf{P}^{f} \\mathbf{H}^{\\top} + R \\right)^{-1}.\n$$\n由于 $\\mathbf{H} \\mathbf{P}^{f} \\mathbf{H}^{\\top}$ 和 $R$ 都是标量，矩阵求逆简化为标量求倒数。具体来说，$\\mathbf{H} \\mathbf{P}^{f} \\mathbf{H}^{\\top}$ 是 $\\mathbf{P}^{f}$ 的 (1,1) 元素，我们记为 $P^f_{11}$。\n\n**4. 随机 EnKF 分析**\n\n随机 EnKF 通过同化一个扰动观测来更新每个集合成员。这种方法通过引入随机噪声来对理论分析分布进行采样。对每个成员 $i$：\n$$\n\\mathbf{x}_i^{a, \\text{sto}} = \\mathbf{x}_i^{f} + \\mathbf{K} \\left( y_{\\text{obs}} + \\epsilon_i - \\mathbf{H} \\mathbf{x}_i^{f} \\right).\n$$\n此处，$\\epsilon_i$ 是为成员 $i$ 从 $\\mathcal{N}(0, R)$ 中抽取的随机样本。此过程产生随机分析集合 $\\{\\mathbf{x}_i^{a, \\text{sto}}\\}_{i=1}^m$。\n\n**5. 确定性 EnSRF 分析**\n\n确定性 EnSRF 是一种平方根滤波器，它分别更新集合均值和距平，以避免由扰动观测引入的采样误差，同时旨在获得正确的分析协方差。\n-   分析均值使用未扰动的观测进行更新：\n    $$\n    \\bar{\\mathbf{x}}^{a} = \\bar{\\mathbf{x}}^{f} + \\mathbf{K} \\left( y_{\\text{obs}} - \\mathbf{H} \\bar{\\mathbf{x}}^{f} \\right).\n    $$\n-   分析距平 $\\mathbf{A}^a$ 是通过对预报距平 $\\mathbf{A}^f$ 应用一个变换来计算的。对于标量观测，该变换为：\n    $$\n    \\mathbf{A}^{a} = \\mathbf{A}^{f} - \\mathbf{K} \\, \\frac{\\mathbf{s}}{1 + \\sqrt{R / S}},\n    $$\n    其中 $\\mathbf{s} = \\mathbf{H} \\mathbf{A}^{f}$ 是观测空间中预报距平的 $1 \\times m$ 向量，而 $S = P^f_{11}$ 是观测空间中的预报方差。如果 $S = 0$，则距平保持不变（$\\mathbf{A}^{a} = \\mathbf{A}^{f}$）。\n-   确定性分析集合由新的均值和新的距平重构：\n    $$\n    \\mathbf{x}_i^{a, \\text{det}} = \\bar{\\mathbf{x}}^{a} + \\mathbf{A}^{a}_{[:, i]},\n    $$\n    其中 $\\mathbf{A}^{a}_{[:, i]}$ 是分析距平矩阵的第 $i$ 列。\n\n**6. 统计矩和差异的计算**\n\n对于随机和确定性分析集合，我们都关注第一个分量（观测变量 $z_i$）。我们计算问题中定义的四个样本统计量：\n-   样本均值： $\\mu = \\frac{1}{m} \\sum_{i=1}^{m} z_i$\n-   样本方差： $\\sigma^2 = \\frac{1}{m} \\sum_{i=1}^{m} (z_i - \\mu)^2$ （注意 $1/m$ 的归一化）\n-   中心矩： $\\mu_k = \\frac{1}{m} \\sum_{i=1}^{m} (z_i - \\mu)^k$，对于 $k=3, 4$\n-   样本偏度： $\\gamma_1 = \\mu_3 / {\\mu_2}^{3/2}$\n-   样本超额峰度： $\\gamma_2 = \\mu_4 / {\\mu_2}^2 - 3$\n\n最后，我们通过计算所要求的四个 delta 值来量化两种方法之间的差异：$\\Delta \\mu = \\mu_{\\text{det}} - \\mu_{\\text{sto}}$，$\\Delta \\sigma^2 = \\sigma^2_{\\text{det}} - \\sigma^2_{\\text{sto}}$，$\\Delta \\gamma_1 = \\gamma_{1,\\text{det}} - \\gamma_{1,\\text{sto}}$ 和 $\\Delta \\gamma_2 = \\gamma_{2,\\text{det}} - \\gamma_{2,\\text{sto}}$。对每个测试用例重复此过程。",
            "answer": "[[-0.004186532450841961, -0.0006764373400262145, 0.1417255146580971, -0.06198941785217462],[-0.03361517595568853, -0.24580327732812235, -1.0494487422173255, -1.5],[-0.0001217985160814987, -1.1852654316827044e-05, -0.19827011986518116, 0.03318991471370966],[0.0003023021950450597, -0.0003290317327310574, -0.0016140510613271424, 0.0019277025816301323]]"
        }
    ]
}