{
    "hands_on_practices": [
        {
            "introduction": "理论学习的最佳伙伴是动手实践。本练习将通过一个简单的数值示例，帮助您将集合变换卡尔曼滤波（ETKF）的抽象理论付诸实践。您将亲手计算分析均值权重向量（$w^a$）和分析异常变换矩阵（$W^a$），这两个算子是更新集合均值和离散度的核心。通过这个练习，您将对滤波器更新步骤中各个组件的计算过程和相互关系有更清晰的认识。",
            "id": "4038057",
            "problem": "考虑一个用于集成平方根滤波 (EnSRF) 或集成变换卡尔曼滤波 (ETKF) 的线性高斯数据同化设置，该设置应用于一个包含 $N_e = 4$ 个成员的预报集成。设观测算子是线性的，观测误差是均值为零、协方差为 $R \\in \\mathbb{R}^{m \\times m}$ 的高斯分布，观测空间中的预报集成扰动由矩阵 $Y \\in \\mathbb{R}^{m \\times N_e}$ 表示，该矩阵满足 $Y \\mathbf{1} = \\mathbf{0}$（跨集成成员求和为零）。对于一个 $m = 2$ 的小例子，假设\n$$\nR = I_2, \\quad\nY = \n\\begin{pmatrix}\n2  -1  -1  0 \\\\\n0  2  -2  0\n\\end{pmatrix}, \\quad\nd = \n\\begin{pmatrix}\n3 \\\\\n0\n\\end{pmatrix},\n$$\n其中 $d$ 是新息向量。定义白化的投影集成扰动\n$$\n\\tilde{Y} \\equiv R^{-1/2} Y \\left(N_e - 1\\right)^{-1/2}\n$$\n从线性高斯贝叶斯更新和预报误差协方差的集成表示出发，推导集成空间分析均值权重向量 $w^a \\in \\mathbb{R}^{N_e}$ 和一个集成空间对称变换 $W^a \\in \\mathbb{R}^{N_e \\times N_e}$，该变换将预报扰动映射到分析扰动，并与平方根滤波原理保持一致。计算 $\\tilde{Y}$ 和 $w^a$，并通过其谱来刻画 $W^a$。用 $N_e$ 和 $m$ 解释构造 $\\tilde{Y}$、计算 $w^a$ 和构建 $W^a$ 的计算复杂度（忽略状态维数，并假设矩阵-向量乘法是主要计算成本）。最后，对所给的数值例子计算 $W^a$ 的行列式，并将你的最终答案表示为一个无舍入的精确值。",
            "solution": "首先验证问题，以确保其科学上可靠、良定且客观。\n\n### 步骤 1: 提取已知条件\n-   **系统类型**: 线性高斯数据同化。\n-   **滤波器类型**: 集成平方根滤波 (EnSRF) 或集成变换卡尔曼滤波 (ETKF)。\n-   **集成大小**: $N_e = 4$。\n-   **观测维数**: $m = 2$。\n-   **观测误差协方差**: $R = I_2 = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$。\n-   **观测空间中的预报集成扰动**: $Y = \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix}$。此矩阵必须满足 $Y \\mathbf{1} = \\mathbf{0}$。\n-   **新息向量**: $d = \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix}$。\n-   **定义**: 白化的投影集成扰动 $\\tilde{Y} \\equiv R^{-1/2} Y (N_e - 1)^{-1/2}$。\n\n### 步骤 2: 使用提取的已知条件进行验证\n问题陈述具有科学依据，植根于集成卡尔曼滤波的标准理论，这是一种在数值天气预报和其他地球物理科学中广泛使用的技术。所提供的方程和定义，例如卡尔曼增益和 ETKF 更新，都是标准的。该问题是良定的，为求得唯一解提供了所有必要的数据（$N_e$, $m$, $R$, $Y$, $d$）。语言客观而精确。对给定约束 $Y \\mathbf{1} = \\mathbf{0}$ 的检查证实了其有效性：\n$$\nY \\mathbf{1} = \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 2 - 1 - 1 + 0 \\\\ 0 + 2 - 2 + 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\mathbf{0}.\n$$\n该问题没有科学上的不合理性、模糊性和矛盾。\n\n### 步骤 3: 结论与行动\n该问题被认为是**有效的**。将提供完整的解。\n\n### 解\n集成变换卡尔曼滤波 (ETKF) 的分析步骤将预报集成均值 $\\bar{x}^f$ 和预报扰动 $A^f$ 更新为分析均值 $\\bar{x}^a$ 和分析扰动 $A^a$。更新公式如下：\n$$\n\\bar{x}^a = \\bar{x}^f + A^f w^a\n$$\n$$\nA^a = A^f W^a\n$$\n其中 $w^a$ 是分析均值权重向量，$W^a$ 是一个对称变换矩阵。它们定义在维度为 $N_e$ 的集成空间中。\n\n**1. 推导与初始计算**\n\n首先，我们定义并计算白化的投影扰动 $\\tilde{Y}$。\n给定 $R = I_2$，其平方根的逆 $R^{-1/2}$ 也是 $I_2$。对于 $N_e = 4$，我们有 $(N_e - 1)^{-1/2} = 1/\\sqrt{3}$。\n$$\n\\tilde{Y} = R^{-1/2} Y (N_e - 1)^{-1/2} = I_2 \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix} \\frac{1}{\\sqrt{3}} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix}\n$$\nETKF 的核心是 $N_e \\times N_e$ 矩阵 $C = \\tilde{Y}^T \\tilde{Y}$。\n$$\nC = \\tilde{Y}^T \\tilde{Y} = \\left( \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  0 \\\\ -1  2 \\\\ -1  -2 \\\\ 0  0 \\end{pmatrix} \\right) \\left( \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix} \\right) = \\frac{1}{3} \\begin{pmatrix} 4  -2  -2  0 \\\\ -2  5  -3  0 \\\\ -2  -3  5  0 \\\\ 0  0  0  0 \\end{pmatrix}\n$$\n\n**2. 分析均值权重向量 ($w^a$)**\n\n分析均值权重向量 $w^a$ 是从标准卡尔曼增益公式推导出来的，并在集成空间中表示：\n$$\nw^a = \\frac{1}{\\sqrt{N_e - 1}} (I_{N_e} + \\tilde{Y}^T \\tilde{Y})^{-1} \\tilde{Y}^T \\tilde{d}\n$$\n其中 $\\tilde{d} = R^{-1/2} d$。\n首先，我们计算所需的项：\n$\\tilde{d} = I_2 d = \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix}$。\n$$\n\\tilde{Y}^T \\tilde{d} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  0 \\\\ -1  2 \\\\ -1  -2 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 6 \\\\ -3 \\\\ -3 \\\\ 0 \\end{pmatrix} = \\sqrt{3} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix}\n$$\n接下来，我们计算 $(I_{N_e} + C)^{-1}$。\n$$\nI_{N_e} + C = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix} + \\frac{1}{3} \\begin{pmatrix} 4  -2  -2  0 \\\\ -2  5  -3  0 \\\\ -2  -3  5  0 \\\\ 0  0  0  0 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 7  -2  -2  0 \\\\ -2  8  -3  0 \\\\ -2  -3  8  0 \\\\ 0  0  0  3 \\end{pmatrix}\n$$\n令 $3 \\times 3$ 子矩阵为 $B = \\begin{pmatrix} 7  -2  -2 \\\\ -2  8  -3 \\\\ -2  -3  8 \\end{pmatrix}$。其行列式为 $\\det(B) = 7(64-9) + 2(-16-6) - 2(6+16) = 7(55) - 2(22) - 2(22) = 385 - 88 = 297$。\n逆矩阵为 $(I_{N_e} + C)^{-1} = 3 \\begin{pmatrix} B^{-1}  \\mathbf{0} \\\\ \\mathbf{0}^T  1/3 \\end{pmatrix}$。\n我们求得 $B^{-1} = \\frac{1}{297} \\begin{pmatrix} 55  22  22 \\\\ 22  52  25 \\\\ 22  25  52 \\end{pmatrix}$。\n所以，$(I_{N_e} + C)^{-1} = \\frac{3}{297} \\begin{pmatrix} 55  22  22  0 \\\\ 22  52  25  0 \\\\ 22  25  52  0 \\\\ 0  0  0  99 \\end{pmatrix} = \\frac{1}{99} \\begin{pmatrix} 55  22  22  0 \\\\ 22  52  25  0 \\\\ 22  25  52  0 \\\\ 0  0  0  99 \\end{pmatrix}$。\n现在我们计算 $w^a$：\n$$\nw^a = \\frac{1}{\\sqrt{3}} \\left( \\frac{1}{99} \\begin{pmatrix} 55  22  22  0 \\\\ 22  52  25  0 \\\\ 22  25  52  0 \\\\ 0  0  0  99 \\end{pmatrix} \\right) \\left( \\sqrt{3} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix} \\right)\n= \\frac{1}{99} \\begin{pmatrix} 55(2) + 22(-1) + 22(-1) \\\\ 22(2) + 52(-1) + 25(-1) \\\\ 22(2) + 25(-1) + 52(-1) \\\\ 0 \\end{pmatrix}\n$$\n$$\nw^a = \\frac{1}{99} \\begin{pmatrix} 110 - 22 - 22 \\\\ 44 - 52 - 25 \\\\ 44 - 25 - 52 \\\\ 0 \\end{pmatrix} = \\frac{1}{99} \\begin{pmatrix} 66 \\\\ -33 \\\\ -33 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2/3 \\\\ -1/3 \\\\ -1/3 \\\\ 0 \\end{pmatrix}\n$$\n\n**3. 扰动变换矩阵 ($W^a$)**\n\n对称变换矩阵 $W^a$ 是集成空间中分析误差协方差的矩阵平方根：\n$$\nW^a = \\left[ (I_{N_e} + \\tilde{Y}^T \\tilde{Y})^{-1} \\right]^{1/2} = \\left[ (I_{N_e} + C)^{-1} \\right]^{1/2}\n$$\n为了通过其谱来刻画 $W^a$，我们求出 $C$ 的特征值，记为 $\\lambda_i$。那么 $W^a$ 的特征值将是 $(1+\\lambda_i)^{-1/2}$。\n$C$ 的特征值是 $3C = \\begin{pmatrix} 4  -2  -2  0 \\\\ -2  5  -3  0 \\\\ -2  -3  5  0 \\\\ 0  0  0  0 \\end{pmatrix}$ 的特征值的 $1/3$ 倍。\n一个特征值显然是 $0$。其他的来自左上角的 $3 \\times 3$ 块，记为 $M$。$M$ 的特征多项式是 $\\det(M-\\lambda I) = -\\lambda(\\lambda-6)(\\lambda-8)$。$M$ 的特征值是 $\\{0, 6, 8\\}$。\n因此，$3C$ 的特征值是 $\\{8, 6, 0, 0\\}$。\n$C$ 的特征值是 $\\lambda_i = \\{8/3, 2, 0, 0\\}$。\n$W^a$ 的谱因此是：\n$$\n\\left\\{ (1+8/3)^{-1/2}, (1+2)^{-1/2}, (1+0)^{-1/2}, (1+0)^{-1/2} \\right\\} = \\left\\{ (11/3)^{-1/2}, (3)^{-1/2}, 1, 1 \\right\\} = \\left\\{ \\sqrt{\\frac{3}{11}}, \\frac{1}{\\sqrt{3}}, 1, 1 \\right\\}\n$$\n\n**4. 计算复杂度**\n\n-   **构造 $\\tilde{Y}$**: 对于一个一般的 $m \\times m$ 矩阵 $R$，计算 $R^{-1/2}$ 的成本是 $O(m^3)$。矩阵乘积 $R^{-1/2}Y$ 的成本是 $O(m^2 N_e)$。总复杂度是 $O(m^3 + m^2 N_e)$。如果 $R$ 是对角矩阵，则复杂度降低为 $O(m^2 N_e)$。\n-   **计算 $w^a$**: 主要步骤如下：\n    1.  构造 $C = \\tilde{Y}^T \\tilde{Y}$：一个 $N_e \\times m$ 矩阵乘以一个 $m \\times N_e$ 矩阵，成本为 $O(N_e^2 m)$。\n    2.  对 $(I_{N_e} + C)$ 求逆：一个 $N_e \\times N_e$ 矩阵，成本为 $O(N_e^3)$。\n    3.  矩阵-向量乘积：成本为 $O(N_e m)$ 和 $O(N_e^2)$。\n    主要成本是 $O(N_e^2 m + N_e^3)$。因为通常 $N_e \\ll m$，这通常被认为是 $O(N_e^2 m)$。\n-   **构建 $W^a$**: 这需要对 $N_e \\times N_e$ 矩阵 $(I_{N_e} + C)$ 进行特征分解，成本为 $O(N_e^3)$。\n    1.  构造 $C$：$O(N_e^2 m)$。\n    2.  特征分解：$O(N_e^3)$。\n    3.  从其特征分量重构 $W^a$：$O(N_e^3)$。\n    总的主要成本同样是 $O(N_e^2 m + N_e^3)$。\n\n**5. $W^a$ 的行列式**\n\n矩阵的行列式是其所有特征值的乘积。使用上面计算出的 $W^a$ 的谱：\n$$\n\\det(W^a) = 1 \\times 1 \\times \\frac{1}{\\sqrt{3}} \\times \\sqrt{\\frac{3}{11}} = \\frac{1}{\\sqrt{3}} \\frac{\\sqrt{3}}{\\sqrt{11}} = \\frac{1}{\\sqrt{11}}\n$$\n或者，我们可以使用性质 $\\det(A^{1/2}) = \\sqrt{\\det(A)}$ 和 $\\det(A^{-1}) = (\\det(A))^{-1}$：\n$$\n\\det(W^a) = \\sqrt{\\det((I+C)^{-1})} = \\sqrt{(\\det(I+C))^{-1}} = (\\det(I+C))^{-1/2}\n$$\n我们计算 $\\det(I+C)$:\n$$\n\\det(I+C) = \\det\\left( \\frac{1}{3} \\begin{pmatrix} 7  -2  -2  0 \\\\ -2  8  -3  0 \\\\ -2  -3  8  0 \\\\ 0  0  0  3 \\end{pmatrix} \\right) = \\left(\\frac{1}{3}\\right)^4 \\det \\begin{pmatrix} 7  -2  -2  0 \\\\ -2  8  -3  0 \\\\ -2  -3  8  0 \\\\ 0  0  0  3 \\end{pmatrix}\n$$\n该块矩阵的行列式是 $3 \\times \\det(B) = 3 \\times 297$。\n$$\n\\det(I+C) = \\frac{1}{81} \\times (3 \\times 297) = \\frac{297}{27} = 11\n$$\n因此，$\\det(W^a) = (11)^{-1/2} = \\frac{1}{\\sqrt{11}}$。结果一致。\n最终答案要求为精确值。\n$$\n\\det(W^a) = \\frac{1}{\\sqrt{11}}\n$$",
            "answer": "$$\n\\boxed{\\frac{1}{\\sqrt{11}}}\n$$"
        },
        {
            "introduction": "在掌握了核心更新计算之后，理解其背后的基本原理至关重要。本练习将深入探讨集合异常的一个关键概念：中心化。您将推导出一个“中心化算子”，并理解为什么在更新过程中必须确保集合异常始终保持中心化（即异常之和为零），这是保证最终分析集合具有正确均值的关键步骤。",
            "id": "4038090",
            "problem": "考虑数值天气预报和气候模拟中一个使用集合平方根滤波器 (EnSRF) 的基于集合的数据同化步骤。设在维度为 $n$ 的状态空间中有 $N_e$ 个集合成员，它们作为预报集合矩阵 $E^{f} \\in \\mathbb{R}^{n \\times N_e}$ 的列。预报集合平均定义为 $\\,\\bar{x}^{f} = \\frac{1}{N_e} E^{f} \\mathbf{1}\\,$，其中 $\\mathbf{1} \\in \\mathbb{R}^{N_e}$ 表示全1列向量。预报扰动定义为 $\\,X^{f} = E^{f} - \\bar{x}^{f} \\mathbf{1}^{\\top}\\,$。样本预报协方差为 $\\,P^{f} = \\frac{1}{N_e-1} X^{f} (X^{f})^{\\top}\\,$。分析平均增量 $\\,\\delta \\bar{x}^{a} \\in \\mathbb{R}^{n}\\,$ 是在给定观测算子和增益的情况下，通过对集合平均进行有效的 Kalman 更新得到的，并被均匀地应用于所有集合成员，从而产生一个临时的平均更新后的集合 $\\,\\widetilde{E}^{a} = E^{f} + \\delta \\bar{x}^{a} \\mathbf{1}^{\\top}\\,$。随后，将一个集合空间平方根变换 $\\,T \\in \\mathbb{R}^{N_e \\times N_e}\\,$ 应用于扰动以调整分析离散度，得到分析扰动 $\\,X^{a} = \\widetilde{E}^{a} T - \\big(\\frac{1}{N_e} \\widetilde{E}^{a} T \\mathbf{1}\\big) \\mathbf{1}^{\\top}\\,$。\n\n从上述集合平均和扰动的基本定义出发，并利用 $\\mathbb{R}^{N_e}$ 中到与 $\\mathbf{1}$ 正交的子空间上的正交投影概念，推导一个单一的右乘算子 $\\,C_{N_e} \\in \\mathbb{R}^{N_e \\times N_e}\\,$。当此算子应用于任何集合矩阵 $E \\in \\mathbb{R}^{n \\times N_e}$ 时，会产生满足 $\\,X \\mathbf{1} = \\mathbf{0}\\,$ 的中心化扰动 $\\,X = E C_{N_e}\\,$。你的推导必须证明 $C_{N_e}$ 所需具备的性质，以确保向 $E$ 添加一个均匀平均增量 $\\,\\delta \\bar{x} \\mathbf{1}^{\\top}\\,$ 不会污染扰动，并解释为什么这种中心化对于在 EnSRF 中保持 $\\,X^{a} \\mathbf{1} = \\mathbf{0}\\,$ 至关重要。\n\n请以 $N_e$ 和 $\\mathbf{1}$ 的闭式解析表达式形式给出 $\\,C_{N_e}\\,$ 的最终答案。无需进行数值计算。最终答案必须是单一的符号表达式。",
            "solution": "问题要求推导一个右乘算子 $C_{N_e} \\in \\mathbb{R}^{N_e \\times N_e}$，该算子将集合矩阵 $E \\in \\mathbb{R}^{n \\times N_e}$ 变换为其对应的中心化扰动矩阵 $X \\in \\mathbb{R}^{n \\times N_e}$。推导从所提供的基本定义开始。\n\n设集合矩阵为 $E$，其列为 $N_e$ 个集合成员。集合平均 $\\bar{x} \\in \\mathbb{R}^{n}$ 是这些成员的平均值。\n$$\n\\bar{x} = \\frac{1}{N_e} \\sum_{i=1}^{N_e} x_i = \\frac{1}{N_e} E \\mathbf{1}\n$$\n其中 $\\mathbf{1} \\in \\mathbb{R}^{N_e}$ 是一个全1列向量。\n\n扰动矩阵 $X$ 定义为从每个集合成员中减去平均值后的集合矩阵。这可以写成：\n$$\nX = E - \\bar{x} \\mathbf{1}^{\\top}\n$$\n项 $\\bar{x} \\mathbf{1}^{\\top}$ 表示一个大小为 $n \\times N_e$ 的矩阵，其中每一列都是平均向量 $\\bar{x}$。\n\n为了推导算子 $C_{N_e}$ 使得 $X = E C_{N_e}$，我们将平均值 $\\bar{x}$ 的表达式代入扰动 $X$ 的定义中：\n$$\nX = E - \\left(\\frac{1}{N_e} E \\mathbf{1}\\right) \\mathbf{1}^{\\top}\n$$\n利用矩阵乘法的结合律，第二项可以改写为：\n$$\nX = E - E \\left(\\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top}\\right)\n$$\n现在我们可以在左侧提出集合矩阵 $E$。为此，我们将第一项表示为 $E$ 乘以 $N_e \\times N_e$ 的单位矩阵 $I$：\n$$\nX = E I - E \\left(\\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top}\\right)\n$$\n提出 $E$ 得到：\n$$\nX = E \\left(I - \\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top}\\right)\n$$\n通过将此表达式与所需形式 $X = E C_{N_e}$ 进行比较，我们可以确定中心化算子 $C_{N_e}$ 为：\n$$\nC_{N_e} = I - \\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top}\n$$\n问题要求所得的扰动 $X$ 满足条件 $X \\mathbf{1} = \\mathbf{0}$。我们可以通过将我们的 $X$ 表达式右乘 $\\mathbf{1}$ 来验证此性质：\n$$\nX \\mathbf{1} = (E C_{N_e}) \\mathbf{1} = E (C_{N_e} \\mathbf{1})\n$$\n我们来计算乘积 $C_{N_e} \\mathbf{1}$：\n$$\nC_{N_e} \\mathbf{1} = \\left(I - \\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top}\\right) \\mathbf{1} = I \\mathbf{1} - \\frac{1}{N_e} \\mathbf{1} (\\mathbf{1}^{\\top} \\mathbf{1})\n$$\n乘积 $\\mathbf{1}^{\\top} \\mathbf{1}$ 是全1向量与自身的点积，即 $N_e$ 个1的和，所以 $\\mathbf{1}^{\\top} \\mathbf{1} = N_e$。代入此结果：\n$$\nC_{N_e} \\mathbf{1} = \\mathbf{1} - \\frac{1}{N_e} \\mathbf{1} (N_e) = \\mathbf{1} - \\mathbf{1} = \\mathbf{0}\n$$\n其中 $\\mathbf{0}$ 是 $\\mathbb{R}^{N_e}$ 中的零向量。因此，$X \\mathbf{1} = E \\mathbf{0} = \\mathbf{0}$（$\\mathbb{R}^{n}$ 中的零向量），这证实了扰动矩阵 $X$ 的列之和为零，符合中心化扰动的要求。\n\n算子 $C_{N_e}$ 是一个正交投影矩阵。它将 $\\mathbb{R}^{N_e}$ 中的向量投影到与向量 $\\mathbf{1}$ 正交的子空间上。这个子空间是其分量之和为零的向量所构成的子空间。\n\n接下来，我们必须证明为什么向集合 $E$ 添加一个均匀平均增量 $\\delta \\bar{x} \\mathbf{1}^{\\top}$ 不会污染使用 $C_{N_e}$ 计算出的扰动。设新集合为 $E' = E + \\delta \\bar{x} \\mathbf{1}^{\\top}$。新的扰动矩阵 $X'$ 是：\n$$\nX' = E' C_{N_e} = (E + \\delta \\bar{x} \\mathbf{1}^{\\top}) C_{N_e} = E C_{N_e} + (\\delta \\bar{x} \\mathbf{1}^{\\top}) C_{N_e}\n$$\n第一项 $E C_{N_e}$ 是原始的扰动矩阵 $X$。第二项可以改写为：\n$$\n(\\delta \\bar{x} \\mathbf{1}^{\\top}) C_{N_e} = \\delta \\bar{x} (\\mathbf{1}^{\\top} C_{N_e})\n$$\n项 $\\mathbf{1}^{\\top} C_{N_e}$ 是 $C_{N_e}^{\\top} \\mathbf{1}$ 的转置。矩阵 $C_{N_e}$ 是对称的，因为 $(I - \\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top})^{\\top} = I^{\\top} - \\frac{1}{N_e} (\\mathbf{1}^{\\top})^{\\top} \\mathbf{1}^{\\top} = I - \\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top} = C_{N_e}$。因此，$C_{N_e}^{\\top} = C_{N_e}$。\n所以，$\\mathbf{1}^{\\top} C_{N_e} = (C_{N_e} \\mathbf{1})^{\\top}$。如前所示，$C_{N_e} \\mathbf{1} = \\mathbf{0}$。因此，$\\mathbf{1}^{\\top} C_{N_e} = \\mathbf{0}^{\\top}$。\n污染项为 $\\delta \\bar{x} (\\mathbf{0}^{\\top}) = \\mathbf{0}$（$n \\times N_e$ 的零矩阵）。\n这证明了 $X' = X + \\mathbf{0} = X$。扰动对于集合的任何均匀平移都是不变的，这是中心化算子 $C_{N_e}$ 投影到与均匀平移方向（向量 $\\mathbf{1}$）正交的子空间上的直接结果。\n\n最后，我们解释为什么这种中心化对于在 EnSRF 的背景下保持 $X^a \\mathbf{1} = \\mathbf{0}$ 是至关重要的。数据同化更新在概念上分为均值更新和扰动（离散度）更新。分析集合 $E^a$ 由更新后的分析平均 $\\bar{x}^a$ 和更新后的分析扰动 $X^a$ 重构而成：\n$$\nE^a = \\bar{x}^a \\mathbf{1}^{\\top} + X^a\n$$\n这个新形成的集合 $E^a$ 的平均值计算如下：\n$$\n\\text{mean}(E^a) = \\frac{1}{N_e} E^a \\mathbf{1} = \\frac{1}{N_e} (\\bar{x}^a \\mathbf{1}^{\\top} + X^a) \\mathbf{1}\n$$\n$$\n\\text{mean}(E^a) = \\frac{1}{N_e} \\bar{x}^a (\\mathbf{1}^{\\top} \\mathbf{1}) + \\frac{1}{N_e} X^a \\mathbf{1} = \\frac{1}{N_e} \\bar{x}^a (N_e) + \\frac{1}{N_e} X^a \\mathbf{1} = \\bar{x}^a + \\frac{1}{N_e} X^a \\mathbf{1}\n$$\n为了使分析集合的平均值等于计算出的分析平均 $\\bar{x}^a$，数学上必须要求第二项为零：$\\frac{1}{N_e} X^a \\mathbf{1} = \\mathbf{0}$，这需要 $X^a \\mathbf{1} = \\mathbf{0}$。这个条件意味着分析扰动必须是中心化的。问题中给出的分析扰动定义，$X^{a} = \\widetilde{E}^{a} T - \\big(\\frac{1}{N_e} \\widetilde{E}^{a} T \\mathbf{1}\\big) \\mathbf{1}^{\\top}$，正是将此中心化原理应用于变换后的集合 $\\widetilde{E}^{a} T$。使用算子 $C_{N_e}$，这可以优雅地写成 $X^a = (\\widetilde{E}^{a} T) C_{N_e}$。这个操作强制执行了中心化条件，这对滤波器的一致性至关重要，确保了最终集合的统计量（均值和离散度）与同化算法所规定的完全一致。",
            "answer": "$$\n\\boxed{I - \\frac{1}{N_e} \\mathbf{1} \\mathbf{1}^{\\top}}\n$$"
        },
        {
            "introduction": "实践的最后一步是验证我们的方法是否达到了预期目标。本练习将理论上的卡尔曼更新与实际的集合表示联系起来，形成一个完整的闭环。通过构建最终的分析集合成员并计算其样本统计量，您将验证集合平方根滤波器方法如何精确地生成一个其样本均值和协方差与贝叶斯理论推导出的后验统计量相匹配的集合，从而证实该方法的有效性和一致性。",
            "id": "4038070",
            "problem": "考虑一个在二维状态空间中为数值天气预报模型进行的单次线性高斯数据同化步骤。使用了一个集合大小为 $N_e = 3$ 的集合平方根滤波器 (Ensemble Square Root Filter, ESRF)。预报集合的样本均值为 $\\bar{x}^f \\in \\mathbb{R}^2$，缩放异常矩阵为 $A^f \\in \\mathbb{R}^{2 \\times 3}$，其定义使得预报协方差满足 $P^f = A^f (A^f)^{\\top}$。观测通过线性观测算子 $H \\in \\mathbb{R}^{2 \\times 2}$ 和观测误差协方差 $R \\in \\mathbb{R}^{2 \\times 2}$ 进行，观测向量为 $y \\in \\mathbb{R}^2$。\n\n给定以下具体的、科学上合理的配置：\n- 状态维数 $m = 2$ 和集合大小 $N_e = 3$。\n- 预报均值 $\\bar{x}^f = \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix}$。\n- 缩放预报异常\n$$\nA^f = \\begin{pmatrix}\n\\sqrt{\\frac{2}{3}}  -\\frac{1}{\\sqrt{6}}  -\\frac{1}{\\sqrt{6}} \\\\\n0  \\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{2}}\n\\end{pmatrix},\n$$\n其构造使得列均值为零且协方差是各向同性的。\n- 观测算子 $H = I_2$（$2 \\times 2$ 单位矩阵）。\n- 观测误差协方差 $R = 2 I_2$。\n- 观测向量 $y = \\begin{pmatrix}3 \\\\ -1 \\end{pmatrix}$。\n\n从线性高斯估计的第一性原理（Kalman 滤波器的贝叶斯推导）和集合样本统计量的定义出发，完成以下任务：\n1. 推导并计算 Kalman 增益 $K$、分析均值 $\\bar{x}^a$ 和分析协方差 $P^a$。\n2. 在集合空间中推导并计算一个对称平方根集合变换矩阵 $T \\in \\mathbb{R}^{3 \\times 3}$，使得分析缩放异常满足 $A^a = A^f T$ 和 $A^a (A^a)^{\\top} = P^a$。在您的推导步骤中，仅使用由 $H$、$R$ 和 $P^f$ 所蕴含的各向同性性质。\n3. 使用典范平方根重构规则，根据分析均值和缩放异常构造分析集合成员，并计算它们的样本均值和样本协方差。\n4. 定义验证指标\n$$\nJ \\;=\\; \\left\\| \\bar{x}_{\\text{sample}}^a - \\bar{x}^a \\right\\|_2^2 \\;+\\; \\left\\| P_{\\text{sample}}^a - P^a \\right\\|_F^2,\n$$\n其中 $\\|\\cdot\\|_2$ 是欧几里得范数，$\\|\\cdot\\|_F$ 是 Frobenius 范数。计算 $J$ 的精确值。不需要四舍五入。最终答案必须是 $J$ 的单一数值，不带单位。",
            "solution": "该问题被评估为具有科学依据、良定且客观。所有必要的数据和定义都已提供，并且没有内部矛盾。问题设置是数据同化领域一个标准的（尽管是简化的）例子，适合进行严谨的求解。因此我们可以继续。\n\n解答按照问题陈述的要求分为四个部分。\n\n### 第 1 部分：Kalman 增益、分析均值和分析协方差\n\n分析步骤的基础是从线性高斯贝叶斯推断导出的标准 Kalman 滤波器更新方程组。分析均值 $\\bar{x}^a$ 和分析协方差 $P^a$ 由以下公式给出：\n$$ \\bar{x}^a = \\bar{x}^f + K(y - H\\bar{x}^f) $$\n$$ P^a = (I - KH)P^f $$\n其中 Kalman 增益 $K$ 定义为：\n$$ K = P^f H^{\\top} (H P^f H^{\\top} + R)^{-1} $$\n\n首先，我们根据给定的缩放异常矩阵 $A^f$ 计算预报协方差矩阵 $P^f$。问题将关系定义为 $P^f = A^f (A^f)^{\\top}$。\n$$ P^f = \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  -\\frac{1}{\\sqrt{6}}  -\\frac{1}{\\sqrt{6}} \\\\ 0  \\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{2}} \\end{pmatrix} \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  0 \\\\ -\\frac{1}{\\sqrt{6}}  \\frac{1}{\\sqrt{2}} \\\\ -\\frac{1}{\\sqrt{6}}  -\\frac{1}{\\sqrt{2}} \\end{pmatrix} $$\n$$ P^f = \\begin{pmatrix} \\left(\\frac{2}{3}\\right) + \\left(\\frac{1}{6}\\right) + \\left(\\frac{1}{6}\\right)  & 0 - \\frac{1}{\\sqrt{12}} + \\frac{1}{\\sqrt{12}} \\\\ 0 - \\frac{1}{\\sqrt{12}} + \\frac{1}{\\sqrt{12}}  & 0 + \\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{2}\\right) \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{3}+\\frac{1}{3}  & 0 \\\\ 0  & 1 \\end{pmatrix} = \\begin{pmatrix} 1  & 0 \\\\ 0  & 1 \\end{pmatrix} = I_2 $$\n预报协方差是 $2 \\times 2$ 单位矩阵，这证实了所述的各向同性。\n\n接下来，我们计算 Kalman 增益 $K$。给定 $H=I_2$ 和 $R=2I_2$。\n项 $H P^f H^{\\top} + R$ 变为：\n$$ H P^f H^{\\top} + R = I_2 I_2 I_2^{\\top} + 2I_2 = I_2 + 2I_2 = 3I_2 $$\n其逆矩阵是 $(3I_2)^{-1} = \\frac{1}{3}I_2$。\n现在，我们计算 $K$：\n$$ K = (P^f H^{\\top}) (H P^f H^{\\top} + R)^{-1} = (I_2 I_2^{\\top}) \\left(\\frac{1}{3}I_2\\right) = I_2 \\left(\\frac{1}{3}I_2\\right) = \\frac{1}{3}I_2 $$\n\n使用计算出的增益 $K$，我们求得分析均值 $\\bar{x}^a$。给定 $\\bar{x}^f = \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix}$ 和 $y = \\begin{pmatrix}3 \\\\ -1 \\end{pmatrix}$。\n$$ \\bar{x}^a = \\bar{x}^f + K(y - H\\bar{x}^f) = \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix} + \\frac{1}{3}I_2 \\left( \\begin{pmatrix}3 \\\\ -1 \\end{pmatrix} - I_2 \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix} \\right) = \\frac{1}{3}\\begin{pmatrix}3 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} $$\n\n最后，我们计算分析协方差 $P^a$：\n$$ P^a = (I - KH)P^f = \\left(I_2 - \\left(\\frac{1}{3}I_2\\right)I_2\\right)I_2 = \\left(I_2 - \\frac{1}{3}I_2\\right)I_2 = \\frac{2}{3}I_2 $$\n分析协方差为 $P^a = \\begin{pmatrix} \\frac{2}{3}  & 0 \\\\ 0  & \\frac{2}{3} \\end{pmatrix}$。\n\n### 第 2 部分：集合变换矩阵\n\n我们需要找到一个对称矩阵 $T \\in \\mathbb{R}^{3 \\times 3}$，使得分析缩放异常 $A^a = A^f T$ 满足 $A^a (A^a)^{\\top} = P^a$。\n问题指明要使用系统的各向同性。鉴于 $P^f$、$H$ 和 $R$ 都是各向同性的（与单位矩阵成比例），从预报空间到分析空间的变换也是各向同性的。这表明异常变换的最简单形式是简单缩放。因此，我们假设一个形式为 $T = c I_{N_e}$ 的变换矩阵，其中 $c$ 是一个标量，$N_e = 3$。这个 $T$ 的选择是对称的。\n\n将 $A^a = c A^f$ 代入协方差方程：\n$$ P^a = A^a (A^a)^{\\top} = (c A^f)(c A^f)^{\\top} = c^2 A^f (A^f)^{\\top} = c^2 P^f $$\n从第 1 部分，我们知道 $P^a = \\frac{2}{3}I_2$ 且 $P^f=I_2$。\n$$ \\frac{2}{3}I_2 = c^2 I_2 $$\n这意味着 $c^2 = \\frac{2}{3}$。对于正定变换，我们选择正根 $c = \\sqrt{\\frac{2}{3}}$。\n因此，一个有效的对称变换矩阵是：\n$$ T = \\sqrt{\\frac{2}{3}} I_3 = \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  & 0  & 0 \\\\ 0  & \\sqrt{\\frac{2}{3}}  & 0 \\\\ 0  & 0  & \\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n值得注意的是，$T$ 的标准集合平方根滤波器公式是 $T_{\\text{std}} = (I + (HA^f)^\\top R^{-1} (HA^f))^{-1/2}$。对于中心化的异常（如此处，$A^f$ 的列和为零），有 $A^f J = 0$，其中 $J$ 是全一矩阵。在这种情况下，$A^f T_{\\text{std}} = A^f (\\sqrt{\\frac{2}{3}} I_3)$。这证实了我们基于各向同性选择的 $T$ 能够为分析异常带来正确的物理结果。\n\n### 第 3 部分：分析集合成员和样本统计量\n\n分析缩放异常为 $A^a=A^f T = \\sqrt{\\frac{2}{3}}A^f$：\n$$ A^a = \\sqrt{\\frac{2}{3}} \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  &-\\frac{1}{\\sqrt{6}}  &-\\frac{1}{\\sqrt{6}} \\\\ 0  &\\frac{1}{\\sqrt{2}}  &-\\frac{1}{\\sqrt{2}} \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{3}  &-\\frac{1}{3}  &-\\frac{1}{3} \\\\ 0  &\\frac{1}{\\sqrt{3}}  &-\\frac{1}{\\sqrt{3}} \\end{pmatrix} $$\n集合成员的典范重构规则需要未缩放的异常矩阵 $X'^a$，其列是与均值的偏差。关系式为 $X'^a = \\sqrt{N_e - 1} A^a$。这里 $N_e=3$。\n$$ X'^a = \\sqrt{2} A^a = \\sqrt{2} \\begin{pmatrix} \\frac{2}{3}  &-\\frac{1}{3}  &-\\frac{1}{3} \\\\ 0  &\\frac{1}{\\sqrt{3}}  &-\\frac{1}{\\sqrt{3}} \\end{pmatrix} = \\begin{pmatrix} \\frac{2\\sqrt{2}}{3}  &-\\frac{\\sqrt{2}}{3}  &-\\frac{\\sqrt{2}}{3} \\\\ 0  &\\sqrt{\\frac{2}{3}}  &-\\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n分析集合成员 $x_i^a$ 构造为 $x_i^a = \\bar{x}^a + X'_{a,i}$，其中 $X'_{a,i}$ 是 $X'^a$ 的第 $i$ 列。\n$$ x_1^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} + \\begin{pmatrix} \\frac{2\\sqrt{2}}{3} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 + \\frac{2\\sqrt{2}}{3} \\\\ -\\frac{1}{3} \\end{pmatrix} $$\n$$ x_2^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} + \\begin{pmatrix} -\\frac{\\sqrt{2}}{3} \\\\ \\sqrt{\\frac{2}{3}} \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{\\sqrt{2}}{3} \\\\ -\\frac{1}{3} + \\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n$$ x_3^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} + \\begin{pmatrix} -\\frac{\\sqrt{2}}{3} \\\\ -\\sqrt{\\frac{2}{3}} \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{\\sqrt{2}}{3} \\\\ -\\frac{1}{3} - \\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n现在，我们计算样本均值 $\\bar{x}_{\\text{sample}}^a = \\frac{1}{3}(x_1^a + x_2^a + x_3^a)$：\n$$ \\bar{x}_{\\text{sample}}^a = \\frac{1}{3} \\left( 3\\bar{x}^a + (X'_{a,1} + X'_{a,2} + X'_{a,3}) \\right) = \\bar{x}^a + \\frac{1}{3} X'^a \\begin{pmatrix}1\\\\1\\\\1\\end{pmatrix} $$\n$X'^a$ 的列和为 $\\begin{pmatrix} \\frac{2\\sqrt{2}}{3}-\\frac{\\sqrt{2}}{3}-\\frac{\\sqrt{2}}{3} \\\\ 0+\\sqrt{\\frac{2}{3}}-\\sqrt{\\frac{2}{3}} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。这是有保证的，因为 $A^f$ 中的初始异常是中心化的。\n因此，$\\bar{x}_{\\text{sample}}^a = \\bar{x}^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix}$。\n\n接下来，我们计算样本协方差 $P_{\\text{sample}}^a = \\frac{1}{N_e-1} X'^a (X'^a)^{\\top}$：\n$$ P_{\\text{sample}}^a = \\frac{1}{2} (\\sqrt{2}A^a) (\\sqrt{2}A^a)^{\\top} = \\frac{1}{2}(2)A^a(A^a)^{\\top} = A^a(A^a)^{\\top} $$\n根据分析步骤的定义，我们要求 $A^a(A^a)^{\\top} = P^a$。\n因此，$P_{\\text{sample}}^a = P^a = \\frac{2}{3}I_2$。\n\n### 第 4 部分：验证指标\n\n验证指标定义为 $ J = \\left\\| \\bar{x}_{\\text{sample}}^a - \\bar{x}^a \\right\\|_2^2 + \\left\\| P_{\\text{sample}}^a - P^a \\right\\|_F^2 $。\n从第 3 部分，我们已严格证明：\n1. $\\bar{x}_{\\text{sample}}^a = \\bar{x}^a$，这意味着 $\\bar{x}_{\\text{sample}}^a - \\bar{x}^a = \\mathbf{0}$。\n2. $P_{\\text{sample}}^a = P^a$，这意味着 $P_{\\text{sample}}^a - P^a = \\mathbf{0}$。\n\n将这些结果代入 $J$ 的定义：\n$$ J = \\left\\| \\mathbf{0} \\right\\|_2^2 + \\left\\| \\mathbf{0} \\right\\|_F^2 $$\n零向量的欧几里得范数为 $0$，零矩阵的 Frobenius 范数为 $0$。\n$$ J = 0^2 + 0^2 = 0 $$\n验证指标 $J$ 的精确值为 $0$。这个结果证实了，当正确应用时，集合平方根滤波器方法论会产生一个分析集合，其样本一阶矩和二阶矩与从 Kalman 滤波器方程导出的理论矩完全匹配。",
            "answer": "$$\\boxed{0}$$"
        }
    ]
}