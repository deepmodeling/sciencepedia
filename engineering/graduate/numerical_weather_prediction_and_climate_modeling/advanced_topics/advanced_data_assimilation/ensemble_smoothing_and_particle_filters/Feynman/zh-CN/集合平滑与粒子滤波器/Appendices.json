{
    "hands_on_practices": [
        {
            "introduction": "本练习通过将平滑问题构建为贝叶斯推断问题，为其奠定了理论基础。您将推导负对数后验目标函数（通常称为代价函数），这是诸如4D-Var等变分平滑方法所最小化的核心量。掌握此推导是理解我们如何在一个时间窗口内结合模型动力学和观测来找到最可能状态轨迹的关键。",
            "id": "4037876",
            "problem": "考虑一个用于数值天气预报和气候建模的离散时间状态空间模型，其同化窗口的时间索引为 $t = 0, 1, \\dots, T$。大气的真实状态由序列 $x_{0:T}$ 表示，其中 $x_t \\in \\mathbb{R}^{n}$，观测数据为 $y_{0:T}$，其中 $y_t \\in \\mathbb{R}^{m_t}$。假设如下：\n- 预报模型将状态传播为 $x_t = M_t x_{t-1} + \\eta_t$，其中 $M_t \\in \\mathbb{R}^{n \\times n}$ 是一个已知的线性化模型算子，$\\eta_t \\sim \\mathcal{N}(0, Q_t)$，其中 $Q_t \\in \\mathbb{R}^{n \\times n}$ 是对称正定的，并且在时间上独立。\n- 观测模型为 $y_t = h_t(x_t) + \\epsilon_t$，其中 $h_t: \\mathbb{R}^{n} \\to \\mathbb{R}^{m_t}$ 是一个可微（可能非线性）的观测算子，$\\epsilon_t \\sim \\mathcal{N}(0, R_t)$，其中 $R_t \\in \\mathbb{R}^{m_t \\times m_t}$ 是对称正定的，在时间上独立，并且与 $\\eta_{1:T}$ 相互独立。\n- 关于 $x_0$ 的先验被认为是无信息的（平坦的），因此它对目标函数没有贡献惩罚项。\n- 对于 $v \\in \\mathbb{R}^{k}$ 和对称正定矩阵 $A \\in \\mathbb{R}^{k \\times k}$，定义加权范数 $\\|v\\|_{A^{-1}}^{2}$ 为 $\\|v\\|_{A^{-1}}^{2} = v^{\\top} A^{-1} v$。\n\n从贝叶斯法则和上述高斯假设出发，推导路径 $x_{0:T}$ 的负对数后验目标函数（不考虑加性常数）。然后，计算该目标函数关于任意索引 $t \\in \\{0, 1, \\dots, T\\}$ 的单个状态 $x_t$ 的梯度。使用指示函数处理边界情况 $t=0$ 和 $t=T$，将最终的梯度表示为对所有 $t$ 都有效的单个闭式解析表达式。令 $H_t(x_t) \\in \\mathbb{R}^{m_t \\times n}$ 表示 $h_t$ 在 $x_t$ 处的雅可比矩阵，并将 $H_t(x_t)$ 简写为 $H_t$。你的最终答案必须是单个闭式解析表达式。不要包含任何单位。",
            "solution": "问题是推导状态轨迹 $x_{0:T}$ 的负对数后验目标函数，然后计算其关于任意时间 $t$ 的状态 $x_t$ 的梯度。这个问题在变分数据同化的框架内是适定的，并且具有科学依据。\n\n首先，我们推导目标函数。给定观测值 $y_{0:T} = (y_0, y_1, \\dots, y_T)$，状态轨迹 $x_{0:T} = (x_0, x_1, \\dots, x_T)$ 的后验概率由贝叶斯法则给出：\n$$\np(x_{0:T} | y_{0:T}) \\propto p(y_{0:T} | x_{0:T}) p(x_{0:T})\n$$\n项 $p(x_{0:T})$ 是状态轨迹的先验概率，而 $p(y_{0:T} | x_{0:T})$ 是给定轨迹下观测值的似然。\n\n先验 $p(x_{0:T})$ 可以使用概率的链式法则和动态模型的马尔可夫性质进行分解：\n$$\np(x_{0:T}) = p(x_0) \\prod_{t=1}^{T} p(x_t | x_{t-1})\n$$\n问题陈述中提到，关于 $x_0$ 的先验是无信息的，这意味着 $p(x_0)$ 是一个常数。状态传播模型为 $x_t = M_t x_{t-1} + \\eta_t$，模型误差为 $\\eta_t \\sim \\mathcal{N}(0, Q_t)$。这意味着条件分布 $p(x_t | x_{t-1})$ 是一个均值为 $M_t x_{t-1}$、协方差为 $Q_t$ 的多元正态分布。其概率密度函数为：\n$$\np(x_t | x_{t-1}) \\propto \\exp\\left( -\\frac{1}{2} (x_t - M_t x_{t-1})^{\\top} Q_t^{-1} (x_t - M_t x_{t-1}) \\right) = \\exp\\left( -\\frac{1}{2} \\|x_t - M_t x_{t-1}\\|_{Q_t^{-1}}^2 \\right)\n$$\n因此，完整的先验为：\n$$\np(x_{0:T}) \\propto \\prod_{t=1}^{T} \\exp\\left( -\\frac{1}{2} \\|x_t - M_t x_{t-1}\\|_{Q_t^{-1}}^2 \\right) = \\exp\\left( -\\frac{1}{2} \\sum_{t=1}^{T} \\|x_t - M_t x_{t-1}\\|_{Q_t^{-1}}^2 \\right)\n$$\n\n似然项 $p(y_{0:T} | x_{0:T})$ 考虑了观测模型 $y_t = h_t(x_t) + \\epsilon_t$，其中观测误差为 $\\epsilon_t \\sim \\mathcal{N}(0, R_t)$。在给定时间 $t$ 的观测值仅依赖于该时间的状态 $x_t$。观测误差在时间上是独立的。因此，似然可以分解为：\n$$\np(y_{0:T} | x_{0:T}) = \\prod_{t=0}^{T} p(y_t | x_t)\n$$\n给定 $x_t$ 时 $y_t$ 的分布是一个均值为 $h_t(x_t)$、协方差为 $R_t$ 的多元正态分布。其概率密度函数为：\n$$\np(y_t | x_t) \\propto \\exp\\left( -\\frac{1}{2} (y_t - h_t(x_t))^{\\top} R_t^{-1} (y_t - h_t(x_t)) \\right) = \\exp\\left( -\\frac{1}{2} \\|y_t - h_t(x_t)\\|_{R_t^{-1}}^2 \\right)\n$$\n完整的似然为：\n$$\np(y_{0:T} | x_{0:T}) \\propto \\prod_{t=0}^{T} \\exp\\left( -\\frac{1}{2} \\|y_t - h_t(x_t)\\|_{R_t^{-1}}^2 \\right) = \\exp\\left( -\\frac{1}{2} \\sum_{t=0}^{T} \\|y_t - h_t(x_t)\\|_{R_t^{-1}}^2 \\right)\n$$\n\n结合先验和似然，后验概率正比于：\n$$\np(x_{0:T} | y_{0:T}) \\propto \\exp\\left( -\\frac{1}{2} \\sum_{t=1}^{T} \\|x_t - M_t x_{t-1}\\|_{Q_t^{-1}}^2 - \\frac{1}{2} \\sum_{t=0}^{T} \\|y_t - h_t(x_t)\\|_{R_t^{-1}}^2 \\right)\n$$\n负对数后验目标函数，记为 $J(x_{0:T})$，是通过对后验概率取负对数并舍去加性常数得到的。因子 $\\frac{1}{2}$ 通常会被保留。\n$$\nJ(x_{0:T}) = \\frac{1}{2} \\sum_{t=1}^{T} \\|x_t - M_t x_{t-1}\\|_{Q_t^{-1}}^2 + \\frac{1}{2} \\sum_{t=0}^{T} \\|y_t - h_t(x_t)\\|_{R_t^{-1}}^2\n$$\n这个表达式是标准的弱约束四维变分（4D-Var）代价函数。\n\n接下来，我们计算 $J(x_{0:T})$ 关于任意时间 $t \\in \\{0, 1, \\dots, T\\}$ 的状态 $x_t$ 的梯度。状态向量 $x_t$ 在目标函数中最多出现在三个项中：\n1.  时间 $t$ 的观测项：$\\frac{1}{2} \\|y_t - h_t(x_t)\\|_{R_t^{-1}}^2$。\n2.  连接 $t-1$ 和 $t$ 的模型动力学项：$\\frac{1}{2} \\|x_t - M_t x_{t-1}\\|_{Q_t^{-1}}^2$，当 $t \\ge 1$ 时存在。\n3.  连接 $t$ 和 $t+1$ 的模型动力学项：$\\frac{1}{2} \\|x_{t+1} - M_{t+1} x_t\\|_{Q_{t+1}^{-1}}^2$，当 $t \\le T-1$ 时存在。\n\n我们使用向量微积分的标准法则计算这些项中每一项关于 $x_t$ 的梯度。令 $H_t$ 为 $h_t$ 在 $x_t$ 处的雅可比矩阵。矩阵 $Q_t^{-1}$ 和 $R_t^{-1}$ 是对称的。\n\n1.  观测项的梯度：\n    $$\n    \\nabla_{x_t} \\left( \\frac{1}{2} (y_t - h_t(x_t))^{\\top} R_t^{-1} (y_t - h_t(x_t)) \\right) = -H_t^{\\top} R_t^{-1} (y_t - h_t(x_t))\n    $$\n    这个项对所有 $t \\in \\{0, 1, \\dots, T\\}$ 都存在。\n\n2.  区间 $[t-1, t]$ 的模型动力学项的梯度：\n    $$\n    \\nabla_{x_t} \\left( \\frac{1}{2} (x_t - M_t x_{t-1})^{\\top} Q_t^{-1} (x_t - M_t x_{t-1}) \\right) = Q_t^{-1} (x_t - M_t x_{t-1})\n    $$\n    这个项对 $t \\in \\{1, \\dots, T\\}$ 存在。\n\n3.  区间 $[t, t+1]$ 的模型动力学项的梯度：\n    $$\n    \\nabla_{x_t} \\left( \\frac{1}{2} (x_{t+1} - M_{t+1} x_t)^{\\top} Q_{t+1}^{-1} (x_{t+1} - M_{t+1} x_t) \\right) = -M_{t+1}^{\\top} Q_{t+1}^{-1} (x_{t+1} - M_{t+1} x_t)\n    $$\n    这个项对 $t \\in \\{0, \\dots, T-1\\}$ 存在。\n\n为了形成一个对所有 $t \\in \\{0, 1, \\dots, T\\}$ 都有效的梯度 $\\nabla_{x_t} J(x_{0:T})$ 的单一表达式，我们使用指示函数来组合这些分量。令 $\\mathbb{I}_{condition}$ 为一个指示函数，当条件为真时其值为 $1$，否则为 $0$。\n\n总梯度是来自相关项的梯度之和：\n$$\n\\nabla_{x_t} J(x_{0:T}) = -H_t^{\\top} R_t^{-1} (y_t - h_t(x_t)) + \\mathbb{I}_{t \\ge 1} Q_t^{-1} (x_t - M_t x_{t-1}) - \\mathbb{I}_{t \\le T-1} M_{t+1}^{\\top} Q_{t+1}^{-1} (x_{t+1} - M_{t+1} x_t)\n$$\n这个表达式对所有 $t \\in \\{0, 1, \\dots, T\\}$ 都成立。\n- 对于内部时间 $1 \\le t \\le T-1$，两个指示函数都为 $1$。\n- 对于初始时间 $t=0$，$\\mathbb{I}_{t \\ge 1}=0$ 且 $\\mathbb{I}_{t \\le T-1}=1$（假设 $T \\ge 1$），得到 $\\nabla_{x_0} J = -H_0^{\\top} R_0^{-1} (y_0 - h_0(x_0)) - M_1^{\\top} Q_1^{-1} (x_1 - M_1 x_0)$。\n- 对于最终时间 $t=T$，$\\mathbb{I}_{t \\ge 1}=1$（假设 $T \\ge 1$）且 $\\mathbb{I}_{t \\le T-1}=0$，得到 $\\nabla_{x_T} J = -H_T^{\\top} R_T^{-1} (y_T - h_T(x_T)) + Q_T^{-1} (x_T - M_T x_{T-1})$。\n这些特殊情况都由该通用公式正确处理。",
            "answer": "$$\n\\boxed{-H_t^{\\top} R_t^{-1} (y_t - h_t(x_t)) + \\mathbb{I}_{t \\ge 1} Q_t^{-1} (x_t - M_t x_{t-1}) - \\mathbb{I}_{t \\le T-1} M_{t+1}^{\\top} Q_{t+1}^{-1} (x_{t+1} - M_{t+1} x_t)}\n$$"
        },
        {
            "introduction": "变分法优化代价函数，而集合法则通过传播一组状态来表示不确定性。本练习深入探讨了集合方法的一个关键组成部分：分析更新步骤。您将为确定性“平方根”集合滤波器推导变换矩阵，这是一种无需扰动观测即可更新集合的先进方法，从而提高了基于集合的平滑器的稳定性和准确性。",
            "id": "4037861",
            "problem": "在一个代表数值天气预报和气候模拟的单一线性高斯数据同化步骤中，考虑一个维数为 $n$ 的状态向量和一个大小为 $m>1$ 的预报集合。设预报集合扰动矩阵为 $A^{f} \\in \\mathbb{R}^{n \\times m}$，其列和为零，预报误差协方差为 $P^{f} = \\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}}$。观测遵循线性模型 $y = H x + \\varepsilon$，其中观测算子为 $H \\in \\mathbb{R}^{p \\times n}$，观测误差为 $\\varepsilon \\sim \\mathcal{N}(0,R)$，其协方差矩阵 $R \\in \\mathbb{R}^{p \\times p}$ 是对称正定的。此线性高斯系统的卡尔曼滤波分析协方差为 $P^{a} = P^{f} - P^{f} H^{\\mathsf{T}} \\left(H P^{f} H^{\\mathsf{T}} + R\\right)^{-1} H P^{f}$。\n\n比较扰动观测的随机集合卡尔曼滤波（EnKF）与避免扰动观测的确定性平方根 EnKF。然后，仅使用上述定义和线性高斯系统卡尔曼滤波的基本性质，构建一个确定性集合空间变换矩阵 $T \\in \\mathbb{R}^{m \\times m}$，使得分析扰动 $A^{a} = A^{f} T$ 满足 $\\frac{1}{m-1} A^{a} (A^{a})^{\\mathsf{T}} = P^{a}$，且不扰动观测。您的构造必须以 $H$、$R$、$A^{f}$ 和 $m$ 的闭式形式明确给出。\n\n将集合投影的观测扰动定义为 $Y^{f} = H A^{f} \\in \\mathbb{R}^{p \\times m}$，并仅用 $Y^{f}$、$R$ 和 $m$ 来表示您关于 $T$ 的最终答案。最终答案必须是关于 $T$ 的单一闭式解析表达式。不需要进行数值计算。如果需要，您可以使用对称正定矩阵平方根表示法。将最终答案表示为单一的解析矩阵表达式。不需要单位。",
            "solution": "在尝试求解之前，首先对问题进行严格验证。\n\n### 步骤 1：提取已知条件\n- 状态向量维数：$n$\n- 集合大小：$m > 1$\n- 预报集合扰动矩阵：$A^{f} \\in \\mathbb{R}^{n \\times m}$，其列和为零。\n- 预报误差协方差：$P^{f} = \\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}}$\n- 观测模型：$y = H x + \\varepsilon$\n- 观测算子：$H \\in \\mathbb{R}^{p \\times n}$\n- 观测误差：$\\varepsilon \\sim \\mathcal{N}(0,R)$\n- 观测误差协方差矩阵：$R \\in \\mathbb{R}^{p \\times p}$，对称正定。\n- 卡尔曼滤波分析协方差：$P^{a} = P^{f} - P^{f} H^{\\mathsf{T}} \\left(H P^{f} H^{\\mathsf{T}} + R\\right)^{-1} H P^{f}$\n- 分析集合扰动：$A^{a} = A^{f} T$，其中 $T \\in \\mathbb{R}^{m \\times m}$ 是待求的变换矩阵。\n- 需要满足的条件：$\\frac{1}{m-1} A^{a} (A^{a})^{\\mathsf{T}} = P^{a}$\n- 集合投影的观测扰动定义：$Y^{f} = H A^{f} \\in \\mathbb{R}^{p \\times m}$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它描述了集合数据同化理论中的一个核心推导，特别是针对确定性平方根集合卡尔曼滤波（EnKFs）。所提供的预报和分析协方差方程是线性高斯估计理论中的标准方程。该问题是适定的、客观的、自洽的，提供了构建矩阵 $T$ 所需的所有必要定义。没有矛盾、歧义或事实错误。该问题是将矩阵代数应用于数值天气预报和气候模拟的一个可形式化且相关的练习。\n\n### 步骤 3：结论与行动\n问题有效。将构建一个解。\n\n### 解题推导\n目标是找到一个确定性变换矩阵 $T \\in \\mathbb{R}^{m \\times m}$，使得定义为 $A^{a} = A^{f} T$ 的分析集合扰动的样本协方差与卡尔曼滤波的理论分析误差协方差 $P^{a}$ 相匹配。\n\n分析集合的样本协方差由下式给出：\n$$\n\\frac{1}{m-1} A^{a} (A^{a})^{\\mathsf{T}} = \\frac{1}{m-1} (A^{f} T) (A^{f} T)^{\\mathsf{T}} = \\frac{1}{m-1} A^{f} T T^{\\mathsf{T}} (A^{f})^{\\mathsf{T}}\n$$\n我们必须将其等同于卡尔曼分析协方差 $P^{a}$：\n$$\n\\frac{1}{m-1} A^{f} T T^{\\mathsf{T}} (A^{f})^{\\mathsf{T}} = P^{a}\n$$\n代入给定的 $P^{a}$ 表达式：\n$$\n\\frac{1}{m-1} A^{f} T T^{\\mathsf{T}} (A^{f})^{\\mathsf{T}} = P^{f} - P^{f} H^{\\mathsf{T}} \\left(H P^{f} H^{\\mathsf{T}} + R\\right)^{-1} H P^{f}\n$$\n现在，将预报误差协方差的定义 $P^{f} = \\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}}$ 代入此方程。\n$$\n\\frac{1}{m-1} A^{f} T T^{\\mathsf{T}} (A^{f})^{\\mathsf{T}} = \\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}} - \\left(\\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}}\\right) H^{\\mathsf{T}} \\left(H \\left(\\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}}\\right) H^{\\mathsf{T}} + R\\right)^{-1} H \\left(\\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}}\\right)\n$$\n我们可以使用定义 $Y^{f} = H A^{f}$。这意味着 $H P^{f} H^{\\mathsf{T}} = \\frac{1}{m-1} H A^{f} (A^{f})^{\\mathsf{T}} H^{\\mathsf{T}} = \\frac{1}{m-1} (H A^{f}) (H A^{f})^{\\mathsf{T}} = \\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}}$。同时，$P^{f} H^{\\mathsf{T}} = \\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}} H^{\\mathsf{T}} = \\frac{1}{m-1} A^{f} (H A^{f})^{\\mathsf{T}} = \\frac{1}{m-1} A^{f} (Y^{f})^{\\mathsf{T}}$。\n\n将这些代入 $P^{a}$ 的方程中：\n$$\n\\frac{1}{m-1} A^{f} T T^{\\mathsf{T}} (A^{f})^{\\mathsf{T}} = \\frac{1}{m-1} A^{f} (A^{f})^{\\mathsf{T}} - \\left(\\frac{1}{m-1} A^{f} (Y^{f})^{\\mathsf{T}}\\right) \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} \\left(\\frac{1}{m-1} (Y^{f}) (A^{f})^{\\mathsf{T}}\\right)\n$$\n将右侧的 $A^{f}$ 提取到左边，$(A^{f})^{\\mathsf{T}}$ 提取到右边，得到：\n$$\n\\frac{1}{m-1} A^{f} T T^{\\mathsf{T}} (A^{f})^{\\mathsf{T}} = \\frac{1}{m-1} A^{f} \\left( I_m - \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} Y^{f} \\right) (A^{f})^{\\mathsf{T}}\n$$\n其中 $I_m$ 是 $m \\times m$ 的单位矩阵。通过比较两侧 $A^{f}$ 和 $(A^{f})^{\\mathsf{T}}$ 之间的项，我们确定 $T T^{\\mathsf{T}}$ 的表达式：\n$$\nT T^{\\mathsf{T}} = I_m - \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} Y^{f}\n$$\n这个表达式可以使用 Woodbury 矩阵恒等式进行简化，该恒等式表述为 $(A+UCV)^{-1} = A^{-1} - A^{-1}U(C^{-1}+VA^{-1}U)^{-1}VA^{-1}$。对于这个问题，一个更方便的形式是证明一个相关矩阵的逆具有更简单的形式。我们假设 $T T^{\\mathsf{T}}$ 的逆是 $I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f}$。我们通过乘法来验证这一点：\n$$\n\\left( I_m - \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} Y^{f} \\right) \\left( I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f} \\right)\n$$\n让我们展开这个乘积：\n$$\n= I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f} - \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} Y^{f} - \\frac{1}{(m-1)^2} (Y^{f})^{\\mathsf{T}} \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} Y^{f} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f}\n$$\n提取出 $(Y^{f})^{\\mathsf{T}}$ 和 $Y^{f}$：\n$$\n= I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} \\left[ R^{-1} - \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} - \\frac{1}{m-1} \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} Y^{f} (Y^{f})^{\\mathsf{T}} R^{-1} \\right] Y^{f}\n$$\n关注方括号中的项。提取出公共的逆矩阵：\n$$\n= R^{-1} - \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} \\left( I_p + \\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} R^{-1} \\right)\n$$\n其中 $I_p$ 是 $p \\times p$ 的单位矩阵。我们可以将最后一个括号重写为：\n$$\nI_p + \\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} R^{-1} = \\left(R + \\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}}\\right) R^{-1}\n$$\n将此代回括号内的表达式：\n$$\nR^{-1} - \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right)^{-1} \\left(\\frac{1}{m-1} Y^{f} (Y^{f})^{\\mathsf{T}} + R\\right) R^{-1} = R^{-1} - I_p R^{-1} = R^{-1} - R^{-1} = 0\n$$\n由于方括号中的项为零，整个乘积简化为 $I_m$。这证明了：\n$$\n(T T^{\\mathsf{T}})^{-1} = I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f}\n$$\n因此：\n$$\nT T^{\\mathsf{T}} = \\left( I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f} \\right)^{-1}\n$$\n问题要求构建一个确定性矩阵 $T$。在平方根滤波器中，对此类矩阵的一个常见且稳定的选择是 $T T^{\\mathsf{T}}$ 的对称正定平方根。我们定义矩阵 $S = I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f}$。由于 $R$ 是对称正定的，$R^{-1}$ 也是对称正定的，因此 $(Y^{f})^{\\mathsf{T}} R^{-1} Y^{f}$ 是对称半正定的。所以，$S$ 是一个对称正定矩阵。因此，它存在一个唯一的对称正定平方根，记为 $S^{1/2}$。\n\n我们选择 $T$ 为对称矩阵 $T = (S^{-1})^{1/2} = S^{-1/2}$。这个选择使得 $T T^{\\mathsf{T}} = T^2 = S^{-1}$，满足条件。题目明确允许使用对称正定矩阵平方根表示法。\n\n因此，$T$ 的最终表达式是矩阵 $S$ 的逆对称平方根。\n\n$$\nT = \\left( I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f} \\right)^{-1/2}\n$$\n该表达式是闭式形式，并且仅依赖于 $Y^{f}$、$R$ 和 $m$，符合要求。",
            "answer": "$$\\boxed{\\left( I_m + \\frac{1}{m-1} (Y^{f})^{\\mathsf{T}} R^{-1} Y^{f} \\right)^{-1/2}}$$"
        },
        {
            "introduction": "状态集合提供了潜在后验分布的离散样本，但我们如何将其可视化并作为连续场进行分析？本练习引入核密度估计（KDE）作为一种强大的工具，从有限的集合中重建连续的后验密度。通过执行具体的计算，并将得到的矩与标准集合统计量进行比较，您将对集合如何表示不确定性以及不同统计估计量之间的关系有更细致的理解。",
            "id": "4037867",
            "problem": "考虑一个数值天气预报分析中的局部化双变量无量纲状态，该状态表示近地面温度和纬向风的标准化异常。一个集合卡尔曼滤波器 (EnKF) 产生了一个大小为 $N=5$ 的分析集合，其成员为 $\\{x^{(i)}\\}_{i=1}^{N}$，其中每个 $x^{(i)} \\in \\mathbb{R}^{2}$ 已经通过气候方差进行了标准化，因此是无量纲的。该集合的成员是\n$$\nx^{(1)}=\\begin{pmatrix}0.80\\\\-1.20\\end{pmatrix},\\quad\nx^{(2)}=\\begin{pmatrix}1.10\\\\-0.90\\end{pmatrix},\\quad\nx^{(3)}=\\begin{pmatrix}0.50\\\\-1.50\\end{pmatrix},\\quad\nx^{(4)}=\\begin{pmatrix}0.95\\\\-1.05\\end{pmatrix},\\quad\nx^{(5)}=\\begin{pmatrix}0.65\\\\-1.35\\end{pmatrix}.\n$$\n在集合平滑中，可以用核密度估计 (KDE) 来近似后验分布，这里使用以每个集合成员为中心的等权重高斯核来构建 KDE。设核函数为多元高斯分布，其带宽矩阵为 $H=h^{2}I_{2}$，其中 $h=0.20$（因此 $H=0.04\\,I_{2}$）。使用核函数 $K_{H}$ 的基本定义以及全期望定律和全协方差定律，执行以下操作：\n\n- 推导由给定核函数和集合所隐含的 KDE 后验 $\\hat{p}(x)$ 的解析表达式。\n- 从第一性原理出发，推导 $\\hat{p}(x)$ 的均值和协方差关于 $H$ 和集合矩的闭式表达式。\n- 根据给定的集合和带宽，计算 $\\hat{p}(x)$ 的数值均值和协方差。\n- 计算同一集合下集合卡尔曼滤波器 (EnKF) 使用的无偏样本协方差。\n- 计算 KDE 协方差与 EnKF 样本协方差之差的弗罗贝尼乌斯范数。\n\n提供弗罗贝尼乌斯范数的最终标量值作为您的答案。最终答案必须是无量纲的，并四舍五入到四位有效数字。以无单位的标量形式表示最终答案。",
            "solution": "用户想要解决一个关于集合平滑和核密度估计 (KDE) 的问题。\n\n### 问题验证\n\n**第一步：提取已知条件**\n\n- **集合大小**: $N=5$。\n- **状态空间维度**: $d=2$。\n- **集合成员** $\\{x^{(i)}\\}_{i=1}^{5}$:\n$$\nx^{(1)}=\\begin{pmatrix}0.80\\\\-1.20\\end{pmatrix},\\quad\nx^{(2)}=\\begin{pmatrix}1.10\\\\-0.90\\end{pmatrix},\\quad\nx^{(3)}=\\begin{pmatrix}0.50\\\\-1.50\\end{pmatrix},\\quad\nx^{(4)}=\\begin{pmatrix}0.95\\\\-1.05\\end{pmatrix},\\quad\nx^{(5)}=\\begin{pmatrix}0.65\\\\-1.35\\end{pmatrix}.\n$$\n- **KDE 核函数**：多元高斯分布。\n- **带宽矩阵**：$H=h^{2}I_{2}$，其中 $I_{2}$ 是 $2 \\times 2$ 的单位矩阵。\n- **带宽参数**：$h=0.20$。这意味着 $H = (0.20)^{2} I_{2} = 0.04 \\, I_{2}$。\n\n**第二步：使用提取的已知条件进行验证**\n\n- **科学依据**：该问题基于数据同化和统计估计中的标准、成熟方法，即集合卡尔曼滤波器 (EnKF) 和核密度估计 (KDE)。这些是数值天气预报及相关领域的常规工具。\n- **适定性**：该问题提供了所有必要的数据，并定义了一组清晰、有序的任务，这些任务导向一个唯一的数值解。集合成员的数量、它们的值以及 KDE 参数都已指定。\n- **客观性**：该问题以精确、定量的术语陈述。没有主观或模糊的元素。\n\n**第三步：结论与行动**\n\n问题是有效的。这是一个在地球物理建模背景下的应用统计学和线性代数的明确定义的练习。将提供完整的解决方案。\n\n### 解答\n\n解答过程遵循问题陈述中列出的任务进行。\n\n**1. KDE 后验的解析表达式**\n\n后验概率密度函数 $\\hat{p}(x)$ 通过由集合成员构建的核密度估计 (KDE) 来近似。对于等权重的高斯核，KDE 是一个由 $N$ 个高斯分布组成的混合模型，其中每个分量都以一个集合成员 $x^{(i)}$ 为中心。\n\nKDE 的一般形式是：\n$$\n\\hat{p}(x) = \\frac{1}{N} \\sum_{i=1}^{N} K_{H}(x - x^{(i)})\n$$\n其中 $K_{H}$ 是带宽矩阵为 $H$ 的核函数。对于 $d$ 维的多元高斯核，其形式为：\n$$\nK_{H}(u) = \\frac{1}{(2\\pi)^{d/2} |H|^{1/2}} \\exp\\left(-\\frac{1}{2} u^T H^{-1} u\\right)\n$$\n在这个问题中，$d=2$，$N=5$，且 $H = 0.04 \\, I_{2}$。我们有：\n- H 的行列式：$|H| = |0.04 \\, I_{2}| = 0.04^2 = 0.0016$。因此，$|H|^{1/2} = 0.04$。\n- H 的逆矩阵：$H^{-1} = (0.04 \\, I_{2})^{-1} = \\frac{1}{0.04} I_{2} = 25 \\, I_{2}$。\n\n将这些代入核函数表达式，后验 KDE 的解析表达式为：\n$$\n\\hat{p}(x) = \\frac{1}{5} \\sum_{i=1}^{5} \\frac{1}{(2\\pi)^{2/2} (0.04)} \\exp\\left(-\\frac{1}{2} (x - x^{(i)})^T (25 \\, I_{2}) (x - x^{(i)})\\right)\n$$\n$$\n\\hat{p}(x) = \\frac{1}{5 \\cdot 2\\pi \\cdot 0.04} \\sum_{i=1}^{5} \\exp\\left(-\\frac{25}{2} \\|x - x^{(i)}\\|^2\\right)\n$$\n$$\n\\hat{p}(x) = \\frac{1}{0.4\\pi} \\sum_{i=1}^{5} \\exp\\left(-12.5 \\|x - x^{(i)}\\|^2\\right)\n$$\n\n**2. KDE 后验的均值和协方差**\n\n我们推导具有概率密度 $\\hat{p}(x)$ 的随机向量 $X$ 的均值和协方差。这是一个混合分布。我们可以将对 $X$ 的采样看作一个两阶段过程：首先，以均匀概率 $P(I=i) = 1/N$ 选择一个索引 $I \\in \\{1, 2, 3, 4, 5\\}$；其次，从高斯分布 $\\mathcal{N}(x^{(i)}, H)$ 中抽取 $X$。\n\n使用全期望定律求均值 $\\mu_{KDE}$：\n$$\n\\mu_{KDE} = E[X] = E_I[E[X|I]]\n$$\n条件期望 $E[X|I=i]$ 是第 $i$ 个高斯分量的均值，即 $x^{(i)}$。因此：\n$$\n\\mu_{KDE} = E_I[x^{(I)}] = \\sum_{i=1}^{N} P(I=i) x^{(i)} = \\frac{1}{N} \\sum_{i=1}^{N} x^{(i)}\n$$\nKDE 后验的均值是集合的样本均值，我们将其表示为 $\\bar{x}$。\n\n使用全协方差定律求协方差 $P_{KDE}$：\n$$\nP_{KDE} = \\text{Cov}(X) = E_I[\\text{Cov}(X|I)] + \\text{Cov}_I(E[X|I])\n$$\n条件协方差 $\\text{Cov}(X|I=i)$ 是第 $i$ 个高斯分量的协方差，即带宽矩阵 $H$。这对所有的 $i$ 都是常数。所以，第一项是：\n$$\nE_I[\\text{Cov}(X|I)] = E_I[H] = H\n$$\n第二项是条件期望 $E[X|I]=x^{(I)}$ 的协方差：\n$$\n\\text{Cov}_I(E[X|I]) = \\text{Cov}_I(x^{(I)}) = E_I[(x^{(I)} - E_I[x^{(I)}])(x^{(I)} - E_I[x^{(I)}])^T]\n$$\n由于 $E_I[x^{(I)}] = \\bar{x}$，这变为：\n$$\n\\text{Cov}_I(x^{(I)}) = \\frac{1}{N} \\sum_{i=1}^{N} (x^{(i)} - \\bar{x})(x^{(i)} - \\bar{x})^T\n$$\n这是集合的有偏样本协方差。我们称之为 $P_{\\text{biased}}$。\n合并各项，KDE 后验的协方差为：\n$$\nP_{KDE} = H + \\frac{1}{N} \\sum_{i=1}^{N} (x^{(i)} - \\bar{x})(x^{(i)} - \\bar{x})^T = H + P_{\\text{biased}}\n$$\n\n**3. 数值计算**\n\n首先，我们计算样本均值 $\\bar{x}$：\n$$\n\\sum_{i=1}^{5} x^{(i)} = \\begin{pmatrix}0.80+1.10+0.50+0.95+0.65\\\\-1.20-0.90-1.50-1.05-1.35\\end{pmatrix} = \\begin{pmatrix}4.00\\\\-6.00\\end{pmatrix}\n$$\n$$\n\\bar{x} = \\frac{1}{5} \\begin{pmatrix}4.00\\\\-6.00\\end{pmatrix} = \\begin{pmatrix}0.80\\\\-1.20\\end{pmatrix}\n$$\nKDE 后验的均值为 $\\mu_{KDE} = \\bar{x} = \\begin{pmatrix}0.80\\\\-1.20\\end{pmatrix}$。\n\n接下来，我们计算与均值的偏差，$d^{(i)} = x^{(i)} - \\bar{x}$：\n$$\nd^{(1)} = \\begin{pmatrix}0\\\\0\\end{pmatrix}, \\quad d^{(2)} = \\begin{pmatrix}0.30\\\\0.30\\end{pmatrix}, \\quad d^{(3)} = \\begin{pmatrix}-0.30\\\\-0.30\\end{pmatrix}, \\quad d^{(4)} = \\begin{pmatrix}0.15\\\\0.15\\end{pmatrix}, \\quad d^{(5)} = \\begin{pmatrix}-0.15\\\\-0.15\\end{pmatrix}\n$$\n现在，我们计算偏差的外积之和，$\\sum_{i=1}^{N} (x^{(i)} - \\bar{x})(x^{(i)} - \\bar{x})^T = \\sum_{i=1}^{5} d^{(i)}(d^{(i)})^T$：\n$$\n\\sum_{i=1}^{5} d^{(i)}(d^{(i)})^T = \\begin{pmatrix}0\\\\0\\end{pmatrix}\\begin{pmatrix}00\\end{pmatrix} + \\begin{pmatrix}0.3\\\\0.3\\end{pmatrix}\\begin{pmatrix}0.30.3\\end{pmatrix} + \\begin{pmatrix}-0.3\\\\-0.3\\end{pmatrix}\\begin{pmatrix}-0.3-0.3\\end{pmatrix} + \\begin{pmatrix}0.15\\\\0.15\\end{pmatrix}\\begin{pmatrix}0.150.15\\end{pmatrix} + \\begin{pmatrix}-0.15\\\\-0.15\\end{pmatrix}\\begin{pmatrix}-0.15-0.15\\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix}00\\\\00\\end{pmatrix} + \\begin{pmatrix}0.090.09\\\\0.090.09\\end{pmatrix} + \\begin{pmatrix}0.090.09\\\\0.090.09\\end{pmatrix} + \\begin{pmatrix}0.02250.0225\\\\0.02250.0225\\end{pmatrix} + \\begin{pmatrix}0.02250.0225\\\\0.02250.0225\\end{pmatrix}\n$$\n$$\n\\sum_{i=1}^{5} d^{(i)}(d^{(i)})^T = \\begin{pmatrix}0.09+0.09+0.0225+0.0225  0.09+0.09+0.0225+0.0225 \\\\ 0.09+0.09+0.0225+0.0225  0.09+0.09+0.0225+0.0225\\end{pmatrix} = \\begin{pmatrix}0.225  0.225 \\\\ 0.225  0.225\\end{pmatrix}\n$$\nEnKF 使用的无偏样本协方差为：\n$$\nP_{EnKF} = \\frac{1}{N-1} \\sum_{i=1}^{N} (x^{(i)} - \\bar{x})(x^{(i)} - \\bar{x})^T = \\frac{1}{4} \\begin{pmatrix}0.225  0.225 \\\\ 0.225  0.225\\end{pmatrix} = \\begin{pmatrix}0.05625  0.05625 \\\\ 0.05625  0.05625\\end{pmatrix}\n$$\n有偏样本协方差为：\n$$\nP_{\\text{biased}} = \\frac{1}{N} \\sum_{i=1}^{N} (x^{(i)} - \\bar{x})(x^{(i)} - \\bar{x})^T = \\frac{1}{5} \\begin{pmatrix}0.225  0.225 \\\\ 0.225  0.225\\end{pmatrix} = \\begin{pmatrix}0.045  0.045 \\\\ 0.045  0.045\\end{pmatrix}\n$$\nKDE 协方差计算为 $P_{KDE} = H + P_{\\text{biased}}$：\n$$\nH = \\begin{pmatrix}0.04  0 \\\\ 0  0.04\\end{pmatrix}\n$$\n$$\nP_{KDE} = \\begin{pmatrix}0.04  0 \\\\ 0  0.04\\end{pmatrix} + \\begin{pmatrix}0.045  0.045 \\\\ 0.045  0.045\\end{pmatrix} = \\begin{pmatrix}0.085  0.045 \\\\ 0.045  0.085\\end{pmatrix}\n$$\n\n**4. 弗罗贝尼乌斯范数计算**\n\n我们需要计算差分矩阵 $\\Delta P = P_{KDE} - P_{EnKF}$ 的弗罗贝尼乌斯范数。\n$$\n\\Delta P = \\begin{pmatrix}0.085  0.045 \\\\ 0.045  0.085\\end{pmatrix} - \\begin{pmatrix}0.05625  0.05625 \\\\ 0.05625  0.05625\\end{pmatrix}\n$$\n$$\n\\Delta P = \\begin{pmatrix}0.085 - 0.05625  0.045 - 0.05625 \\\\ 0.045 - 0.05625  0.085 - 0.05625\\end{pmatrix} = \\begin{pmatrix}0.02875  -0.01125 \\\\ -0.01125  0.02875\\end{pmatrix}\n$$\n弗罗贝尼乌斯范数 $\\|\\Delta P\\|_F$ 是其所有元素平方和的平方根：\n$$\n\\|\\Delta P\\|_F = \\sqrt{(0.02875)^2 + (-0.01125)^2 + (-0.01125)^2 + (0.02875)^2}\n$$\n$$\n\\|\\Delta P\\|_F = \\sqrt{2 \\times (0.02875)^2 + 2 \\times (-0.01125)^2}\n$$\n$$\n\\|\\Delta P\\|_F = \\sqrt{2 \\times (0.0008265625) + 2 \\times (0.0001265625)}\n$$\n$$\n\\|\\Delta P\\|_F = \\sqrt{0.001653125 + 0.000253125}\n$$\n$$\n\\|\\Delta P\\|_F = \\sqrt{0.00190625}\n$$\n$$\n\\|\\Delta P\\|_F \\approx 0.04365856\n$$\n四舍五入到四位有效数字，结果是 $0.04366$。",
            "answer": "$$\\boxed{0.04366}$$"
        }
    ]
}