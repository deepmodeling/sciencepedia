{
    "hands_on_practices": [
        {
            "introduction": "为了在气候模型中准确表示二氧化碳移除（CDR）策略，我们首先需要理解其核心动态。这项实践练习将引导您为一个关键的CDR技术——地质封存——建立一个基本的数学模型。通过应用质量守恒原理，您将推导出一个描述封存碳量随时间变化的微分方程，这有助于我们理解注入和泄漏过程之间的相互作用 。掌握这种基本建模方法是构建更复杂地球系统模型（ESM）的基石。",
            "id": "4021082",
            "problem": "在一个数值天气预报（NWP）和气候模拟框架的地球系统分量中，一项二氧化碳去除（CDR）技术将碳注入一个长期的地质储层。设储存的碳为 $S(t)$，单位为千兆吨碳（$\\mathrm{GtC}$），设外部规定的注入速率为 $I(t)$，单位为千兆吨碳/年（$\\mathrm{GtC}\\,\\mathrm{yr}^{-1}$）。假设储存的泄漏可以很好地用一个一级过程来描述，其速率常数为 $\\ell$，单位为 $\\mathrm{yr}^{-1}$，表示单位时间内逸出的已储存碳的比例。从质量守恒出发，推导 $S(t)$ 关于 $I(t)$ 和 $\\ell$ 的控制微分方程。然后，对于在所有 $t \\ge 0$ 时注入速率恒为 $I(t)=I_{0}$ 且初始条件为 $S(0)=0$ 的情况，求解 $S(t)$ 的闭式解。假设 $t$ 的单位为年（$\\mathrm{yr}$）。将 $S(t)$ 的最终结果以单一闭式解析表达式的形式给出。不要计算任何数值，并且不要在最终表达式后附加单位。",
            "solution": "该问题被验证为具有科学依据、适定、客观和完整。提供了建立和求解控制微分方程所需的所有信息。\n\n推导始于地质储层中储存碳的质量守恒原理。储存碳的变化率 $\\frac{dS(t)}{dt}$ 等于碳注入速率减去碳泄漏速率。\n\n注入速率由外部规定的函数 $I(t)$ 给出。\n\n泄漏被描述为一个一级过程。这意味着泄漏速率与当前储存的碳量 $S(t)$ 成正比。比例常数是泄漏速率常数 $\\ell$。因此，泄漏速率为 $\\ell S(t)$。\n\n结合这些项，质量平衡方程为：\n$$\n\\frac{dS(t)}{dt} = \\text{注入速率} - \\text{泄漏速率}\n$$\n代入给定的表达式，我们得到 $S(t)$ 的控制微分方程：\n$$\n\\frac{dS(t)}{dt} = I(t) - \\ell S(t)\n$$\n这是一个一阶线性常微分方程。\n\n问题接着指定了一种情况，即从时间 $t=0$ 开始，注入速率为常数 $I(t) = I_{0}$，并且初始时储层中没有碳，这对应于初始条件 $S(0) = 0$。对于 $t \\ge 0$，微分方程变为：\n$$\n\\frac{dS(t)}{dt} = I_{0} - \\ell S(t)\n$$\n这个方程可以重排为一阶线性常微分方程(ODE)的标准形式：\n$$\n\\frac{dS(t)}{dt} + \\ell S(t) = I_{0}\n$$\n为了解这个方程，我们使用积分因子法，积分因子为 $\\mu(t)$。积分因子由下式给出：\n$$\n\\mu(t) = \\exp\\left(\\int \\ell \\, dt\\right) = \\exp(\\ell t)\n$$\n将整个微分方程乘以 $\\mu(t)$：\n$$\n\\exp(\\ell t) \\frac{dS(t)}{dt} + \\ell \\exp(\\ell t) S(t) = I_{0} \\exp(\\ell t)\n$$\n根据乘法法则，该方程的左侧是乘积 $S(t)\\mu(t)$ 的导数：\n$$\n\\frac{d}{dt}\\left[ S(t) \\exp(\\ell t) \\right] = I_{0} \\exp(\\ell t)\n$$\n为了求出 $S(t)$，我们对两边关于时间 $t$ 积分：\n$$\n\\int \\frac{d}{dt}\\left[ S(t) \\exp(\\ell t) \\right] dt = \\int I_{0} \\exp(\\ell t) dt\n$$\n$$\nS(t) \\exp(\\ell t) = I_{0} \\int \\exp(\\ell t) dt\n$$\n对右侧进行积分得到：\n$$\nS(t) \\exp(\\ell t) = \\frac{I_{0}}{\\ell} \\exp(\\ell t) + C\n$$\n其中 $C$ 是积分常数。\n\n为了求出 $S(t)$ 的显式解，我们除以 $\\exp(\\ell t)$：\n$$\nS(t) = \\frac{I_{0}}{\\ell} + C \\exp(-\\ell t)\n$$\n这是微分方程的通解。我们现在应用初始条件 $S(0) = 0$ 来确定常数 $C$ 的值。\n$$\nS(0) = \\frac{I_{0}}{\\ell} + C \\exp(-\\ell \\cdot 0) = \\frac{I_{0}}{\\ell} + C \\exp(0) = \\frac{I_{0}}{\\ell} + C\n$$\n将此式设为 $0$：\n$$\n0 = \\frac{I_{0}}{\\ell} + C \\implies C = -\\frac{I_{0}}{\\ell}\n$$\n将 $C$ 的这个值代回通解，得到 $S(t)$ 的特解：\n$$\nS(t) = \\frac{I_{0}}{\\ell} - \\frac{I_{0}}{\\ell} \\exp(-\\ell t)\n$$\n提出公因式 $\\frac{I_{0}}{\\ell}$，我们得到储存碳量随时间变化的最终闭式表达式：\n$$\nS(t) = \\frac{I_{0}}{\\ell} \\left(1 - \\exp(-\\ell t)\\right)\n$$\n该表达式表明，储存的碳量从 $0$ 开始增加，并随着 $t \\to \\infty$ 渐近地趋于稳态值 $\\frac{I_{0}}{\\ell}$。当泄漏速率 $\\ell S$ 等于恒定的注入速率 $I_{0}$ 时，达到稳态。",
            "answer": "$$\n\\boxed{\\frac{I_{0}}{\\ell} \\left(1 - \\exp(-\\ell t)\\right)}\n$$"
        },
        {
            "introduction": "二氧化碳移除策略并非在真空中运作，而是与地球气候系统的其他组成部分紧密互动。这项练习将我们的视角从单个封存库扩展到一个简化的耦合系统，该系统代表了大气和海洋之间的碳交换 。通过分析这个双箱模型，您将探究CDR如何影响大气CO₂的稳态浓度，并评估这个新平衡点的稳定性。这对于预测CDR策略的长期全球影响至关重要。",
            "id": "4021145",
            "problem": "考虑一个简化的双箱大气-混合层海洋系统，该系统旨在用于将二氧化碳移除（CDR）情景实验与地球系统模型（ESM）的数值天气预报（NWP）和气候模型分量耦合。大气由一个充分混合的箱体表示，其有效空气质量为 $M_a$，预报性大气二氧化碳（CO$_2$）混合比为 $C_a(t)$（无量纲，mol/mol）。海洋由一个表层混合层箱体表示，其有效碳容量为 $M_o$，预报性水相 CO$_2$ 状态变量为 $C_o(t)$（无量纲，mol/mol），其定义使得海气交换与非平衡量 $C_a - \\alpha C_o$ 成正比，其中 $\\alpha$ 是一个无量纲的类亨利定律转换因子，用于将水相 CO$_2$ 与其等效的大气信号联系起来。\n\n令 $F_E$ 表示向大气的时均人为 CO$_2$ 排放率（单位时间的质量），令 $F_R$ 表示通过 CDR 实现的时均净大气 CO$_2$ 移除率（单位时间的质量），两者在所关心的时间尺度上均被视为常数。定义净大气源 $F_N = F_E - F_R$（单位时间的质量）。海气交换由一个大气侧传输系数 $k_a$（每单位时间）参数化，产生向下的质量通量 $F_{\\text{ex}} = k_a M_a (C_a - \\alpha C_o)$。从混合层到深海的输出被参数化为 $F_{\\text{do}} = \\gamma M_o C_o$，其中 $\\gamma$ 是一个正速率（每单位时间）。控制质量守恒方程为\n$$\nM_a \\frac{dC_a}{dt} = F_N - F_{\\text{ex}},\n\\qquad\nM_o \\frac{dC_o}{dt} = F_{\\text{ex}} - F_{\\text{do}}.\n$$\n等效地，用状态变量的速率表示，\n$$\n\\frac{dC_a}{dt} = \\frac{F_N}{M_a} - k_a \\left(C_a - \\alpha C_o\\right), \\qquad\n\\frac{dC_o}{dt} = k_o \\left(C_a - \\alpha C_o\\right) - \\gamma C_o,\n$$\n其中 $k_o \\equiv \\frac{k_a M_a}{M_o}$ 是海洋状态变量的诱导交换率。假设 $k_a > 0$，$k_o > 0$，$\\alpha \\ge 0$ 且 $\\gamma > 0$。\n\n从上述质量守恒原理和给定的线性参数化出发，推导稳态大气 CO$_2$ 混合比 $C_a^{*}$ 作为 $F_E$、$F_R$、$M_a$、$k_a$、$k_o$、$\\alpha$ 和 $\\gamma$ 的函数的闭式解。此外，陈述使该稳态保持线性稳定的关于 $k_a$、$k_o$、$\\alpha$ 和 $\\gamma$ 的条件。\n\n您的最终答案必须是仅用给定符号写出的关于 $C_a^{*}$ 的单个代数表达式。如果进行数值计算，请以无量纲单位 mol/mol 报告 $C_a^{*}$。最终方框内的表达式中不要包含单位。无需进行数值计算或四舍五入。",
            "solution": "该问题要求推导稳态大气 CO$_2$ 混合比（记作 $C_a^*$），并对一个简化的双箱大气-海洋碳循环模型的该稳态进行线性稳定性分析。\n\n该系统的控制方程如下：\n$$\n\\frac{dC_a}{dt} = \\frac{F_N}{M_a} - k_a \\left(C_a - \\alpha C_o\\right)\n$$\n$$\n\\frac{dC_o}{dt} = k_o \\left(C_a - \\alpha C_o\\right) - \\gamma C_o\n$$\n其中 $F_N = F_E - F_R$。参数受约束，使得 $k_a > 0$，$k_o > 0$，$\\alpha \\ge 0$ 且 $\\gamma > 0$。\n\n首先，我们确定稳态解，记为 $(C_a^*, C_o^*)$。在稳态时，时间导数为零：$\\frac{dC_a}{dt} = 0$ 和 $\\frac{dC_o}{dt} = 0$。这得到一个由两个线性代数方程组成的方程组：\n$$\n0 = \\frac{F_N}{M_a} - k_a \\left(C_a^* - \\alpha C_o^*\\right) \\quad (1)\n$$\n$$\n0 = k_o \\left(C_a^* - \\alpha C_o^*\\right) - \\gamma C_o^* \\quad (2)\n$$\n\n从方程（2）中，我们可以表示出稳态浓度之间的关系。\n$$\nk_o \\left(C_a^* - \\alpha C_o^*\\right) = \\gamma C_o^*\n$$\n该方程表明，在稳态时，进入海洋箱的净海气交换通量（经 $k_o$ 缩放）与向深海的输出通量相平衡。\n\n从方程（1）中，我们有：\n$$\nk_a \\left(C_a^* - \\alpha C_o^*\\right) = \\frac{F_N}{M_a}\n$$\n这表明从大气箱输出的海气交换通量与净人为源相平衡。\n\n我们可以求解这个方程组得到 $C_a^*$ 和 $C_o^*$。让我们首先通过将方程(1)中的项 $(C_a^* - \\alpha C_o^*)$ 代入方程(2)来求解 $C_o^*$。从(1)式，我们有 $C_a^* - \\alpha C_o^* = \\frac{F_N}{k_a M_a}$。将其代入(2)式：\n$$\nk_o \\left( \\frac{F_N}{k_a M_a} \\right) - \\gamma C_o^* = 0\n$$\n求解 $C_o^*$：\n$$\n\\gamma C_o^* = \\frac{k_o F_N}{k_a M_a} \\implies C_o^* = \\frac{k_o F_N}{\\gamma k_a M_a}\n$$\n现在，我们求解 $C_a^*$。从方程（1）中：\n$$\nC_a^* - \\alpha C_o^* = \\frac{F_N}{k_a M_a}\n$$\n$$\nC_a^* = \\alpha C_o^* + \\frac{F_N}{k_a M_a}\n$$\n代入 $C_o^*$ 的表达式：\n$$\nC_a^* = \\alpha \\left( \\frac{k_o F_N}{\\gamma k_a M_a} \\right) + \\frac{F_N}{k_a M_a}\n$$\n提出公因式 $\\frac{F_N}{k_a M_a}$：\n$$\nC_a^* = \\frac{F_N}{k_a M_a} \\left( 1 + \\frac{\\alpha k_o}{\\gamma} \\right)\n$$\n最后，代入 $F_N = F_E - F_R$，我们得到作为指定参数函数的稳态大气 CO$_2$ 浓度：\n$$\nC_a^* = \\frac{F_E - F_R}{k_a M_a} \\left( 1 + \\frac{\\alpha k_o}{\\gamma} \\right)\n$$\n\n接下来，我们分析此稳态的线性稳定性。该微分方程组是线性的。我们可以将其写成矩阵形式 $\\frac{d\\mathbf{x}}{dt} = \\mathbf{J}\\mathbf{x} + \\mathbf{b}$，其中 $\\mathbf{x} = \\begin{pmatrix} C_a \\\\ C_o \\end{pmatrix}$，$\\mathbf{J}$ 是雅可比矩阵。\n该系统是：\n$$\n\\frac{dC_a}{dt} = -k_a C_a + (k_a \\alpha) C_o + \\frac{F_N}{M_a}\n$$\n$$\n\\frac{dC_o}{dt} = k_o C_a - (k_o \\alpha + \\gamma) C_o\n$$\n雅可比矩阵 $\\mathbf{J}$ 是：\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial \\dot{C}_a}{\\partial C_a} & \\frac{\\partial \\dot{C}_a}{\\partial C_o} \\\\ \\frac{\\partial \\dot{C}_o}{\\partial C_a} & \\frac{\\partial \\dot{C}_o}{\\partial C_o} \\end{pmatrix} = \\begin{pmatrix} -k_a & k_a \\alpha \\\\ k_o & -(k_o \\alpha + \\gamma) \\end{pmatrix}\n$$\n一个线性系统的不动点是稳定的，当且仅当其雅可比矩阵的所有特征值都具有负实部。对于一个 $2 \\times 2$ 系统，劳斯-赫尔维茨稳定性判据提供了一个更简单的等价条件：雅可比矩阵的迹必须为负，其行列式必须为正。\n$$\n\\text{Tr}(\\mathbf{J})  0 \\quad \\text{and} \\quad \\det(\\mathbf{J}) > 0\n$$\n让我们计算迹和行列式：\n$$\n\\text{Tr}(\\mathbf{J}) = -k_a - (k_o \\alpha + \\gamma) = -(k_a + k_o \\alpha + \\gamma)\n$$\n$$\n\\det(\\mathbf{J}) = (-k_a)(-(k_o \\alpha + \\gamma)) - (k_a \\alpha)(k_o) = k_a(k_o \\alpha + \\gamma) - k_a k_o \\alpha = k_a k_o \\alpha + k_a \\gamma - k_a k_o \\alpha = k_a \\gamma\n$$\n现在我们根据给定的参数约束来检查这些条件：$k_a  0$，$k_o  0$，$\\alpha \\ge 0$ 且 $\\gamma  0$。\n\n1.  迹条件：$\\text{Tr}(\\mathbf{J})  0$\n    我们有 $\\text{Tr}(\\mathbf{J}) = -(k_a + k_o \\alpha + \\gamma)$。由于 $k_a  0$，$k_o  0$，$\\gamma  0$ 且 $\\alpha \\ge 0$，项 $k_a + k_o \\alpha + \\gamma$ 是正项和非负项的和，因此严格为正。所以，$\\text{Tr}(\\mathbf{J})$ 总是负的。\n\n2.  行列式条件：$\\det(\\mathbf{J})  0$\n    我们有 $\\det(\\mathbf{J}) = k_a \\gamma$。由于 $k_a  0$ 且 $\\gamma  0$，它们的乘积 $k_a \\gamma$ 严格为正。因此，$\\det(\\mathbf{J})$ 总是正的。\n\n由于劳斯-赫尔维茨判据（$\\text{Tr}(\\mathbf{J})  0$ 和 $\\det(\\mathbf{J}) > 0$）对于问题中指定的具有物理动机的约束内的所有参数值都成立，因此稳态解 $(C_a^*, C_o^*)$ 总是线性稳定的。稳定性的条件与给定的参数约束相同：$k_a  0$，$k_o  0$，$\\alpha \\ge 0$ 且 $\\gamma  0$。\n问题要求将 $C_a^*$ 的闭式解作为最终答案。",
            "answer": "$$\n\\boxed{\\frac{F_E - F_R}{k_a M_a} \\left(1 + \\frac{\\alpha k_o}{\\gamma}\\right)}\n$$"
        },
        {
            "introduction": "气候模型及其参数（如CDR通量）本质上都存在不确定性。为了得到更可靠的估计，我们必须将模型预测与实际观测数据相结合。这项实践练习介绍了一种强大的技术——贝叶斯反演，它是在数值天气预报和气候科学中数据同化的核心 。您将通过一个实际案例，学习如何利用合成的大气浓度观测数据来量化评估一个假设的直接空气捕获（DAC）集群的移除效率，并减少我们对其性能的不确定性。",
            "id": "4021102",
            "problem": "考虑一个假设的直接空气捕获（DAC）集群，它由 $n$ 个未知的稳态清除通量表示，这些通量收集在一个状态向量 $\\mathbf{x} \\in \\mathbb{R}^n$ 中，单位为百万吨二氧化碳/年（Mt CO$_2$ yr$^{-1}$）。在 $m$ 个传感器处收集二氧化碳浓度异常的合成大气观测数据，并汇集到向量 $\\mathbf{y} \\in \\mathbb{R}^m$ 中，单位为百万分率（ppm）。从通量到观测的正向映射是线性的，$\\mathbf{y} = \\mathbf{H}\\mathbf{x} + \\mathbf{e}$，其中 $\\mathbf{H} \\in \\mathbb{R}^{m \\times n}$ 是观测算子（单位为 ppm / (Mt CO$_2$ yr$^{-1}$)），$\\mathbf{e}$ 是观测误差。假设一个高斯先验 $\\mathbf{x} \\sim \\mathcal{N}(\\mathbf{x}_b, \\mathbf{B})$，其先验均值为 $\\mathbf{x}_b \\in \\mathbb{R}^n$ (Mt CO$_2$ yr$^{-1}$)，先验协方差为 $\\mathbf{B} \\in \\mathbb{R}^{n \\times n}$ (Mt CO$_2$ yr$^{-2}$)。假设误差模型是高斯的，$\\mathbf{e} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R})$，其中 $\\mathbf{R} \\in \\mathbb{R}^{m \\times m}$ 是观测误差协方差（ppm$^2$）。\n\n从贝叶斯定理和线性高斯模型假设出发，推导在给定 $\\mathbf{y}$ 的情况下 $\\mathbf{x}$ 的后验均值 $\\mathbf{x}_a$ 和后验协方差 $\\mathbf{A}$ 的表达式。实现一个数值稳定的算法，使用不显式求逆矩阵的标准线性代数运算来计算 $\\mathbf{x}_a$ 和边际后验标准差 $\\boldsymbol{\\sigma}_a = \\sqrt{\\mathrm{diag}(\\mathbf{A})}$。\n\n下面的测试套件指定了四种科学上合理的场景，所有场景均有 $n = 3$ 个通量和 $m = 4$ 个传感器。在每个场景中，先验协方差 $\\mathbf{B}$ 由下三角矩阵 $\\mathbf{L}$ 通过 $\\mathbf{B} = \\mathbf{L}\\mathbf{L}^\\top$ 构建，以保证对称性和正定性。合成观测数据是使用固定的“真实”通量向量 $\\mathbf{x}_{\\text{true}}$ 和观测误差的固定实现 $\\boldsymbol{\\epsilon}$ 生成的，即 $\\mathbf{y} = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}$。\n\n对所有场景使用以下通用参数：\n- 通量数量：$n = 3$。\n- 传感器数量：$m = 4$。\n- 先验均值：$\\mathbf{x}_b = [\\,0.6,\\,0.5,\\,0.7\\,]$ Mt CO$_2$ yr$^{-1}$。\n- 真实通量：$\\mathbf{x}_{\\text{true}} = [\\,0.8,\\,0.4,\\,0.9\\,]$ Mt CO$_2$ yr$^{-1}$。\n- 观测算子：\n$$\n\\mathbf{H} =\n\\begin{bmatrix}\n0.9  0.1  0.0 \\\\\n0.2  0.6  0.1 \\\\\n0.1  0.2  0.8 \\\\\n0.5  0.3  0.2\n\\end{bmatrix}\n\\quad \\text{(ppm / (Mt CO$_2$ yr$^{-1}$))}。\n$$\n- 先验协方差因子：\n$$\n\\mathbf{L} =\n\\begin{bmatrix}\n0.25  0.00  0.00 \\\\\n0.05  0.20  0.00 \\\\\n0.00  0.04  0.30\n\\end{bmatrix},\n\\quad \\mathbf{B} = \\mathbf{L}\\mathbf{L}^\\top\n\\quad \\text{(Mt CO$_2$ yr$^{-2}$)}。\n$$\n\n定义以下四个场景：\n\n1. 场景1（中等噪声，对角 $\\mathbf{R}$）：\n   - 观测协方差：\n   $$\n   \\mathbf{R}_1 = \\mathrm{diag}\\left(\\,0.04,\\,0.03,\\,0.05,\\,0.02\\,\\right)\n   \\quad \\text{(ppm$^2$)}。\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_1 = [\\,0.02,\\,-0.01,\\,0.03,\\,-0.02\\,] \\quad \\text{(ppm)}。\n   $$\n   - 观测值：\n   $$\n   \\mathbf{y}_1 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_1。\n   $$\n\n2. 场景2（高噪声，对角 $\\mathbf{R}$）：\n   - 观测协方差：\n   $$\n   \\mathbf{R}_2 = \\mathrm{diag}\\left(\\,0.4,\\,0.3,\\,0.5,\\,0.2\\,\\right)\n   \\quad \\text{(ppm$^2$)}。\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_2 = [\\,0.2,\\,-0.1,\\,0.15,\\,-0.05\\,] \\quad \\text{(ppm)}。\n   $$\n   - 观测值：\n   $$\n   \\mathbf{y}_2 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_2。\n   $$\n\n3. 场景3（低噪声，对角 $\\mathbf{R}$）：\n   - 观测协方差：\n   $$\n   \\mathbf{R}_3 = \\mathrm{diag}\\left(\\,0.0025,\\,0.0025,\\,0.0025,\\,0.0025\\,\\right)\n   \\quad \\text{(ppm$^2$)}。\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_3 = [\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,] \\quad \\text{(ppm)}。\n   $$\n   - 观测值：\n   $$\n   \\mathbf{y}_3 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_3。\n   $$\n\n4. 场景4（相关误差，非对角 $\\mathbf{R}$）：\n   - 标准差：\n   $$\n   \\mathbf{s} = [\\,0.15,\\,0.10,\\,0.20,\\,0.12\\,] \\quad \\text{(ppm)}。\n   $$\n   - 相关矩阵：\n   $$\n   \\mathbf{C} =\n   \\begin{bmatrix}\n   1  0.3  0.1  0.0 \\\\\n   0.3  1  0.25  0.1 \\\\\n   0.1  0.25  1  0.2 \\\\\n   0.0  0.1  0.2  1\n   \\end{bmatrix}。\n   $$\n   - 观测协方差：\n   $$\n   \\mathbf{R}_4 = \\mathrm{diag}(\\mathbf{s})\\,\\mathbf{C}\\,\\mathrm{diag}(\\mathbf{s})\n   \\quad \\text{(ppm$^2$)}。\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_4 = [\\,0.05,\\,-0.02,\\,0.00,\\,0.01\\,] \\quad \\text{(ppm)}。\n   $$\n   - 观测值：\n   $$\n   \\mathbf{y}_4 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_4。\n   $$\n\n要求：\n- 使用贝叶斯定理，根据第一性原理，在指定的线性高斯假设下推导后验均值 $\\mathbf{x}_a$ 和后验协方差 $\\mathbf{A}$。\n- 实现一个计算 $\\mathbf{x}_a$ 和 $\\boldsymbol{\\sigma}_a = \\sqrt{\\mathrm{diag}(\\mathbf{A})}$ 的算法，不显式地求任何矩阵的逆。对对称正定系统使用数值稳定的求解方法（例如，Cholesky分解）。\n- 对于每个场景，返回后验均值和边际后验标准差，单位为 Mt CO$_2$ yr$^{-1}$。\n- 所有返回的通量值和不确定性均以 Mt CO$_2$ yr$^{-1}$ 为单位表示，并四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，不含空格。每个场景的结果必须是一对列表：第一个列表是后验均值向量 $\\mathbf{x}_a$，第二个列表是后验标准差向量 $\\boldsymbol{\\sigma}_a$。例如，单个场景的结果应类似于 $[[x_1,x_2,x_3],[s_1,s_2,s_3]]$，每个数字都保留六位小数。最终输出按顺序将所有四个场景聚合为一个列表：$[[[x_1,x_2,x_3],[s_1,s_2,s_3]],[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]],[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]],[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]]]$。\n\n测试套件和答案规范：\n- 程序必须计算上述四个场景的结果。\n- 输出必须是包含上述聚合列表的单行。\n- 输出中的每个数字必须是四舍五入到六位小数的浮点数。",
            "solution": "该问题要求推导并实现一个贝叶斯线性反演，以从合成的大气观测数据中估算二氧化碳清除通量。\n\n### 1. 理论推导\n\n问题是在给定观测向量 $\\mathbf{y} \\in \\mathbb{R}^m$ 的情况下，求状态向量 $\\mathbf{x} \\in \\mathbb{R}^n$ 的后验概率分布，记为 $p(\\mathbf{x}|\\mathbf{y})$。贝叶斯定理指出：\n$$\np(\\mathbf{x}|\\mathbf{y}) = \\frac{p(\\mathbf{y}|\\mathbf{x}) p(\\mathbf{x})}{p(\\mathbf{y})} \\propto p(\\mathbf{y}|\\mathbf{x}) p(\\mathbf{x})\n$$\n其中 $p(\\mathbf{y}|\\mathbf{x})$ 是似然， $p(\\mathbf{x})$ 是先验，$p(\\mathbf{y})$ 是一个归一化常数（证据）。\n\n问题定义了一个线性高斯模型。通量向量 $\\mathbf{x}$ 的先验分布是一个多元高斯分布：\n$$\np(\\mathbf{x}) = \\mathcal{N}(\\mathbf{x}_b, \\mathbf{B}) \\propto \\exp\\left(-\\frac{1}{2}(\\mathbf{x} - \\mathbf{x}_b)^\\top \\mathbf{B}^{-1} (\\mathbf{x} - \\mathbf{x}_b)\\right)\n$$\n其中 $\\mathbf{x}_b$ 是先验均值，$\\mathbf{B}$ 是先验协方差矩阵。\n\n将状态 $\\mathbf{x}$ 与观测 $\\mathbf{y}$ 关联的正向模型是线性的：\n$$\n\\mathbf{y} = \\mathbf{H}\\mathbf{x} + \\mathbf{e}\n$$\n观测误差 $\\mathbf{e}$ 被假定为一个零均值高斯随机变量，$\\mathbf{e} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R})$，其中 $\\mathbf{R}$ 是观测误差协方差矩阵。这意味着在给定状态 $\\mathbf{x}$ 的情况下观测到 $\\mathbf{y}$ 的似然也是一个多元高斯分布：\n$$\np(\\mathbf{y}|\\mathbf{x}) = \\mathcal{N}(\\mathbf{H}\\mathbf{x}, \\mathbf{R}) \\propto \\exp\\left(-\\frac{1}{2}(\\mathbf{y} - \\mathbf{H}\\mathbf{x})^\\top \\mathbf{R}^{-1} (\\mathbf{y} - \\mathbf{H}\\mathbf{x})\\right)\n$$\n将似然和先验代入贝叶斯定理，后验分布为：\n$$\np(\\mathbf{x}|\\mathbf{y}) \\propto \\exp\\left(-\\frac{1}{2}\\left[ (\\mathbf{x} - \\mathbf{x}_b)^\\top \\mathbf{B}^{-1} (\\mathbf{x} - \\mathbf{x}_b) + (\\mathbf{y} - \\mathbf{H}\\mathbf{x})^\\top \\mathbf{R}^{-1} (\\mathbf{y} - \\mathbf{H}\\mathbf{x}) \\right]\\right)\n$$\n指数中的表达式是 $\\mathbf{x}$ 的二次函数，这意味着后验分布也是一个高斯分布，$p(\\mathbf{x}|\\mathbf{y}) = \\mathcal{N}(\\mathbf{x}_a, \\mathbf{A})$。后验均值 $\\mathbf{x}_a$ 对应于使后验概率最大化的 $\\mathbf{x}$ 值，这等同于最小化负对数后验，通常称为代价函数 $J(\\mathbf{x})$：\n$$\nJ(\\mathbf{x}) = \\frac{1}{2}(\\mathbf{x} - \\mathbf{x}_b)^\\top \\mathbf{B}^{-1} (\\mathbf{x} - \\mathbf{x}_b) + \\frac{1}{2}(\\mathbf{y} - \\mathbf{H}\\mathbf{x})^\\top \\mathbf{R}^{-1} (\\mathbf{y} - \\mathbf{H}\\mathbf{x})\n$$\n为了找到最小值，我们将 $J(\\mathbf{x})$ 对 $\\mathbf{x}$ 的梯度设为零：\n$$\n\\nabla_{\\mathbf{x}} J(\\mathbf{x}) = \\mathbf{B}^{-1}(\\mathbf{x} - \\mathbf{x}_b) - \\mathbf{H}^\\top \\mathbf{R}^{-1}(\\mathbf{y} - \\mathbf{H}\\mathbf{x}) = \\mathbf{0}\n$$\n重新整理各项以求解 $\\mathbf{x}$，得到后验均值 $\\mathbf{x}_a$：\n$$\n\\mathbf{B}^{-1}\\mathbf{x}_a - \\mathbf{B}^{-1}\\mathbf{x}_b + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H}\\mathbf{x}_a - \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{y} = \\mathbf{0}\n$$\n$$\n(\\mathbf{B}^{-1} + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H})\\mathbf{x}_a = \\mathbf{B}^{-1}\\mathbf{x}_b + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{y}\n$$\n项 $(\\mathbf{B}^{-1} + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H})$ 是后验协方差矩阵的逆，也称为代价函数的Hessian矩阵。因此，后验协方差 $\\mathbf{A}$ 为：\n$$\n\\mathbf{A} = (\\mathbf{B}^{-1} + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H})^{-1}\n$$\n而后验均值为：\n$$\n\\mathbf{x}_a = \\mathbf{A}(\\mathbf{B}^{-1}\\mathbf{x}_b + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{y})\n$$\n这些表达式需要显式地进行矩阵求逆（$\\mathbf{B}^{-1}$, $\\mathbf{R}^{-1}$ 和Hessian矩阵），这在数值上可能不稳定。\n\n### 2. 数值稳定的算法设计\n\n为避免显式求逆，我们可以重新表述这些表达式。使用Woodbury矩阵恒等式，后验协方差 $\\mathbf{A}$ 可以重写为：\n$$\n\\mathbf{A} = \\mathbf{B} - \\mathbf{B}\\mathbf{H}^\\top (\\mathbf{R} + \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top)^{-1} \\mathbf{H}\\mathbf{B}\n$$\n这种形式仍然涉及求逆，但求逆的是一个更小的 $m \\times m$ 矩阵 $(\\mathbf{R} + \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top)$，而不是 $n \\times n$ 的Hessian矩阵。当 $m \\ll n$ 时，这尤其有利。更重要的是，这引出了卡尔曼增益公式。\n\n我们定义增益矩阵 $\\mathbf{K}$ 为：\n$$\n\\mathbf{K} = \\mathbf{B}\\mathbf{H}^\\top (\\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R})^{-1}\n$$\n后验均值 $\\mathbf{x}_a$ 随后可以表示为对先验均值的更新：\n$$\n\\mathbf{x}_a = \\mathbf{x}_b + \\mathbf{K}(\\mathbf{y} - \\mathbf{H}\\mathbf{x}_b)\n$$\n而后验协方差 $\\mathbf{A}$ 可以简化为：\n$$\n\\mathbf{A} = (\\mathbf{I} - \\mathbf{K}\\mathbf{H})\\mathbf{B}\n$$\n其中 $\\mathbf{I}$ 是 $n \\times n$ 的单位矩阵。这种表述在数据同化和滤波理论中是标准的。\n\n增益矩阵 $\\mathbf{K}$ 的计算涉及项 $(\\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R})^{-1}$。我们定义新息协方差矩阵 $\\mathbf{S} = \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R}$。增益矩阵变为 $\\mathbf{K} = \\mathbf{B}\\mathbf{H}^\\top\\mathbf{S}^{-1}$。我们可以通过求解一个线性方程组来代替对 $\\mathbf{S}$ 求逆。为了求 $\\mathbf{K}$，我们求解：\n$$\n\\mathbf{K}\\mathbf{S} = \\mathbf{B}\\mathbf{H}^\\top \\implies \\mathbf{S}^\\top \\mathbf{K}^\\top = (\\mathbf{B}\\mathbf{H}^\\top)^\\top\n$$\n由于 $\\mathbf{B}$ 和 $\\mathbf{R}$ 是对称正定（SPD）的，$\\mathbf{S}$ 也是SPD的，所以 $\\mathbf{S}^\\top = \\mathbf{S}$。求解 $\\mathbf{K}^\\top$ 的系统是：\n$$\n\\mathbf{S} \\mathbf{K}^\\top = \\mathbf{H}\\mathbf{B}\n$$\n这是一个形式为 $\\mathbf{A}_{\\text{sys}}\\mathbf{X}_{\\text{sys}}=\\mathbf{B}_{\\text{sys}}$ 的标准线性矩阵方程，其中 $\\mathbf{A}_{\\text{sys}}=\\mathbf{S}$，$\\mathbf{X}_{\\text{sys}}=\\mathbf{K}^\\top$，以及 $\\mathbf{B}_{\\text{sys}}=\\mathbf{H}\\mathbf{B}$。由于 $\\mathbf{S}$ 是SPD的，这个系统可以使用Cholesky分解高效且稳定地求解。\n\n由此产生的算法流程如下：\n1.  给定一个场景的输入（$\\mathbf{x}_b, \\mathbf{B}, \\mathbf{H}, \\mathbf{y}, \\mathbf{R}$）。\n2.  计算新息协方差矩阵：$\\mathbf{S} = \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R}$。\n3.  对 $\\mathbf{S}$ 进行Cholesky分解：$\\mathbf{S} = \\mathbf{C}\\mathbf{C}^\\top$，其中 $\\mathbf{C}$ 是一个下三角矩阵。\n4.  使用Cholesky因子 $\\mathbf{C}$ 求解系统 $\\mathbf{S}\\mathbf{K}^\\top = \\mathbf{H}\\mathbf{B}$ 以得到 $\\mathbf{K}^\\top$（例如，通过 `cho_solve`），这涉及前向和后向替换。然后求得 $\\mathbf{K}$。\n5.  计算后验均值：$\\mathbf{x}_a = \\mathbf{x}_b + \\mathbf{K}(\\mathbf{y} - \\mathbf{H}\\mathbf{x}_b)$。\n6.  计算后验协方差：$\\mathbf{A} = (\\mathbf{I} - \\mathbf{K}\\mathbf{H})\\mathbf{B}$。\n7.  提取边际后验标准差：$\\boldsymbol{\\sigma}_a = \\sqrt{\\mathrm{diag}(\\mathbf{A})}$。通过在开方前取对角线元素与零的最大值，注意处理由浮点误差引起的潜在微小负对角线元素。\n\n该算法无需任何显式矩阵求逆即可计算所需量，满足了问题的要求。",
            "answer": "[[[0.781846,0.420658,0.893120],[0.134812,0.119934,0.144410]],[[0.640989,0.485121,0.741009],[0.231940,0.187834,0.264669]],[[0.799797,0.400269,0.900139],[0.045050,0.043444,0.045292]],[[0.749007,0.435882,0.865922],[0.182442,0.155458,0.210403]]]"
        }
    ]
}