{
    "hands_on_practices": [
        {
            "introduction": "To appreciate the sophistication of modern transport schemes, we must first understand the behavior of the simplest methods. This exercise provides a foundational analysis of the first-order upwind scheme, a building block for many advanced algorithms. By applying it to a sharp discontinuity, we can directly observe its inherent numerical diffusion and introduce the crucial diagnostic tool of Total Variation ($TV$), laying the groundwork for understanding the principles of Total Variation Diminishing (TVD) schemes .",
            "id": "4043793",
            "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ with constant speed $a0$ on a uniform grid $x_{i} = i\\,\\Delta x$, where $i \\in \\mathbb{Z}$. Let the Courant number be $C = a\\,\\Delta t / \\Delta x = 0.7$. The initial data are a discrete Heaviside step given by $u_{i}^{0} = 0$ for $i \\leq 0$ and $u_{i}^{0} = 1$ for $i \\geq 1$. Assume that the computational domain is sufficiently large and initialized in these constant states so that boundary effects are irrelevant during the first time step.\n\nUse the conservative, first-order upwind method corresponding to positive advection speed $a0$ to advance the solution by a single time step from $t^{0}$ to $t^{1} = t^{0} + \\Delta t$. Then, compute the discrete total variation at $t^{1}$, defined by\n$$\n\\mathrm{TV}\\!\\left(u^{1}\\right) = \\sum_{i=-\\infty}^{\\infty} \\left| u_{i+1}^{1} - u_{i}^{1} \\right|.\n$$\nAnswer the following, working from fundamental principles of conservation and monotonicity that underlie flux-corrected transport and Total Variation Diminishing (TVD) methodology, beginning from this first-order upwind baseline: derive the one-step update in flux form, determine the nontrivial updated values near the discontinuity, and evaluate the discrete total variation. Express your final answer as the single real number equal to $\\mathrm{TV}\\!\\left(u^{1}\\right)$, with no units required. No rounding is necessary.",
            "solution": "The problem requires the calculation of the discrete total variation, $\\mathrm{TV}(u^1)$, of a solution to the one-dimensional linear advection equation after one time step using the first-order upwind method.\n\nThe governing partial differential equation is the linear advection equation:\n$$\nu_{t} + a\\,u_{x} = 0\n$$\nwhere the advection speed $a$ is a positive constant ($a0$). This equation can be written in conservation form, $u_t + F(u)_x = 0$, by identifying the flux function as $F(u) = a u$.\n\nA general conservative finite volume scheme for this equation on a uniform grid with spacing $\\Delta x$ and time step $\\Delta t$ is given by:\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nHere, $u_i^n$ is the numerical approximation of the solution at grid point $x_i = i\\,\\Delta x$ and time $t^n = n\\,\\Delta t$. The term $F_{i\\pm 1/2}$ represents the numerical flux at the interface between cell $i$ and cell $i\\pm1$.\n\nThe problem specifies the use of the first-order upwind method. For $a0$, information propagates in the positive $x$-direction (from left to right). Therefore, the \"upwind\" value at the interface $x_{i+1/2}$ (the right boundary of cell $i$) is the value from cell $i$. The numerical flux is thus defined as:\n$$\nF_{i+1/2} = F(u_i^n) = a u_i^n\n$$\nSimilarly, the flux at the left boundary of cell $i$, $x_{i-1/2}$, is determined by the upwind cell, which is cell $i-1$:\n$$\nF_{i-1/2} = F(u_{i-1}^n) = a u_{i-1}^n\n$$\nSubstituting these flux definitions into the conservative scheme provides the update rule in flux form:\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\left( a u_i^n - a u_{i-1}^n \\right)\n$$\nBy defining the Courant number $C = \\frac{a \\Delta t}{\\Delta x}$, the equation simplifies to:\n$$\nu_{i}^{n+1} = u_{i}^{n} - C \\left( u_{i}^{n} - u_{i-1}^{n} \\right)\n$$\nThis is the one-step update formula for the first-order upwind method. This scheme is known to be Total Variation Diminishing (TVD) for $0 \\leq C \\leq 1$.\n\nThe problem provides the following data:\n- Courant number: $C = 0.7$.\n- Initial condition at time $t=t^0$: $u_i^0$ is a discrete Heaviside step function.\n$$\nu_{i}^{0} = \\begin{cases} 0  \\text{for } i \\leq 0 \\\\ 1  \\text{for } i \\geq 1 \\end{cases}\n$$\nWe apply the update formula with $n=0$ to find the solution at $t^1 = t^0 + \\Delta t$:\n$$\nu_{i}^{1} = u_{i}^{0} - 0.7 \\left( u_{i}^{0} - u_{i-1}^{0} \\right)\n$$\nThe value of $u_i^1$ will differ from $u_i^0$ only where the gradient $u_{i}^{0} - u_{i-1}^{0}$ is non-zero. This occurs exclusively at the grid point $i=1$, since $u_1^0=1$ and $u_0^0=0$.\n\nLet's compute the updated values $u_i^1$ for all relevant grid indices $i$:\n1.  For $i \\leq 0$:\n    Both $u_{i}^{0}$ and $u_{i-1}^{0}$ are equal to $0$.\n    $$\n    u_{i}^{1} = 0 - 0.7 \\left( 0 - 0 \\right) = 0\n    $$\n    Thus, $u_{i}^{1} = 0$ for all $i \\leq 0$.\n\n2.  For $i = 1$:\n    We have $u_{1}^{0}=1$ and $u_{0}^{0}=0$.\n    $$\n    u_{1}^{1} = u_{1}^{0} - 0.7 \\left( u_{1}^{0} - u_{0}^{0} \\right) = 1 - 0.7 \\left( 1 - 0 \\right) = 1 - 0.7 = 0.3\n    $$\n\n3.  For $i \\geq 2$:\n    Both $u_{i}^{0}$ and $u_{i-1}^{0}$ are equal to $1$.\n    $$\n    u_{i}^{1} = 1 - 0.7 \\left( 1 - 1 \\right) = 1\n    $$\n    Thus, $u_{i}^{1} = 1$ for all $i \\geq 2$.\n\nThe solution profile at time $t^1$ is therefore:\n$$\nu_i^1 = \\begin{cases} 0  \\text{if } i \\le 0 \\\\ 0.3  \\text{if } i = 1 \\\\ 1  \\text{if } i \\ge 2 \\end{cases}\n$$\nThe initially sharp step has been smeared over the interface between cells $i=0$ and $i=2$, a characteristic diffusive behavior of the first-order upwind scheme.\n\nNow, we compute the discrete total variation of this new state, $\\mathrm{TV}(u^1)$, using the provided definition:\n$$\n\\mathrm{TV}\\!\\left(u^{1}\\right) = \\sum_{i=-\\infty}^{\\infty} \\left| u_{i+1}^{1} - u_{i}^{1} \\right|\n$$\nWe only need to sum the terms where the difference is non-zero. These occur at the interfaces where the solution value changes.\n-   For $i \\leq -1$: $|u_{i+1}^1 - u_i^1| = |0-0| = 0$.\n-   For $i = 0$: $|u_1^1 - u_0^1| = |0.3 - 0| = 0.3$.\n-   For $i = 1$: $|u_2^1 - u_1^1| = |1 - 0.3| = 0.7$.\n-   For $i \\geq 2$: $|u_{i+1}^1 - u_i^1| = |1-1| = 0$.\n\nThe total variation is the sum of the magnitudes of these jumps:\n$$\n\\mathrm{TV}\\!\\left(u^{1}\\right) = 0.3 + 0.7 = 1\n$$\nFor context, the total variation of the initial data was $\\mathrm{TV}(u^0) = |u_1^0 - u_0^0| = |1-0| = 1$. The fact that $\\mathrm{TV}(u^1) \\leq \\mathrm{TV}(u^0)$ confirms the Total Variation Diminishing (TVD) nature of the method for this case.\nThe final answer is the numerical value of $\\mathrm{TV}(u^1)$.",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "While the upwind scheme is stable and monotonic, its excessive diffusion limits its accuracy. To overcome this, flux-corrected transport and TVD schemes introduce a high-order correction that is carefully controlled by a flux limiter. This practice delves into the inner workings of a TVD flux-limiter scheme, demonstrating how a limiter function, such as the `minmod` limiter, uses a measure of local solution smoothness ($r$) to prevent the formation of new oscillations, particularly near local extrema .",
            "id": "4043769",
            "problem": "Consider one-dimensional transport of a passive tracer in a conservative finite-volume discretization of the linear advection equation $u_{t} + a\\,u_{x} = 0$ used in numerical weather prediction and climate modeling. Let the mesh be uniform with cell index $i \\in \\{-2,-1,0,1,2\\}$ and cell-averaged values $u_{i}^{n}$ at time level $n$. The background state is piecewise constant outside the local extremum. The discrete profile at time level $n$ is\n$$\nu_{-2}^{n} = 1.0,\\quad u_{-1}^{n} = 1.5,\\quad u_{0}^{n} = 2.0,\\quad u_{1}^{n} = 1.5,\\quad u_{2}^{n} = 1.0.\n$$\nAssume a positive advection speed $a0$, a uniform grid spacing $\\Delta x$, and a time step $\\Delta t$ such that the Courant–Friedrichs–Lewy (CFL) number $C = a\\,\\Delta t / \\Delta x$ equals $C = 0.8$. The boundary values $u_{-2}^{n}$ and $u_{2}^{n}$ are held fixed for this single time step, consistent with a constant inflow/outflow outside the local extremum.\n\nUse a flux-corrected transport (FCT) update composed of:\n- a low-order upwind step, and\n- a second-order antidiffusive correction limited by a Total Variation Diminishing (TVD) flux limiter.\n\nLet the limited high-resolution update be constructed with the minmod flux limiter $\\varphi(r) = \\max(0,\\min(1,r))$, where the smoothness indicator at interface $i+\\tfrac{1}{2}$ is\n$$\nr_{i+\\frac{1}{2}} = \\frac{u_{i}^{n} - u_{i-1}^{n}}{u_{i+1}^{n} - u_{i}^{n}},\n$$\nwith the convention that if $u_{i+1}^{n} - u_{i}^{n} = 0$ then $r_{i+\\frac{1}{2}}$ is set to $0$. The conservative, second-order TVD flux-limiter update for interior cells $i \\in \\{-1,0,1\\}$ is given by\n$$\nu_{i}^{n+1} = u_{i}^{n} - C\\left(u_{i}^{n}-u_{i-1}^{n}\\right) - \\frac{1}{2}C(1-C)\\left[\\,\\varphi\\!\\left(r_{i+\\frac{1}{2}}\\right)\\left(u_{i+1}^{n}-u_{i}^{n}\\right) - \\varphi\\!\\left(r_{i-\\frac{1}{2}}\\right)\\left(u_{i}^{n}-u_{i-1}^{n}\\right)\\right],\n$$\nwith $u_{-2}^{n+1}=u_{-2}^{n}$ and $u_{2}^{n+1}=u_{2}^{n}$.\n\nStarting from the definitions of conservation for $u$ and the TVD principle, derive the above update from the low-order upwind flux and the limited antidiffusive correction, then compute:\n1. the total variation at time $n$,\n$$\n\\mathrm{TV}(u^{n}) = \\sum_{i=-2}^{1} \\left|u_{i+1}^{n} - u_{i}^{n}\\right|,\n$$\n2. the total variation at time $n+1$,\n$$\n\\mathrm{TV}(u^{n+1}) = \\sum_{i=-2}^{1} \\left|u_{i+1}^{n+1} - u_{i}^{n+1}\\right|,\n$$\nand\n3. the change in total variation $\\Delta \\mathrm{TV} = \\mathrm{TV}(u^{n+1}) - \\mathrm{TV}(u^{n})$.\n\nExpress the final answer as the single real number $\\Delta \\mathrm{TV}$. No rounding is required and the quantity is dimensionless. Also briefly assess, based on the sign of $\\Delta \\mathrm{TV}$, whether the minmod limiter maintains the Total Variation Diminishing (TVD) property for this one time step applied to the given profile.",
            "solution": "The problem is valid. It is a well-posed, scientifically grounded problem in the field of numerical methods for partial differential equations, specifically for hyperbolic conservation laws. All necessary data, equations, and definitions are provided, and they are consistent with established theory.\n\n### Derivation of the Update Scheme\n\nThe one-dimensional linear advection equation is given by\n$$ \\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0 $$\nwhere $u$ is a conserved quantity and $a$ is the constant advection speed, assumed to be positive ($a0$).\nIn a conservative finite-volume method, the cell-averaged value $u_i^n$ is updated from time level $n$ to $n+1$ via the formula\n$$ u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} \\right) $$\nwhere $F_{i+\\frac{1}{2}}$ is the numerical flux at the interface between cells $i$ and $i+1$, and $C = a \\Delta t / \\Delta x$ is the Courant number.\n\nThe flux-corrected transport (FCT) approach combines a low-order, monotonic scheme with a high-order scheme to achieve high accuracy while preventing spurious oscillations.\n\n1.  **Low-Order Scheme**: For $a0$, the first-order upwind scheme is a simple, robust, and monotonic (but diffusive) choice. Its flux is defined as\n    $$ F_{i+\\frac{1}{2}}^{L} = a u_i^n $$\n    The corresponding update is\n    $$ u_i^{n+1, L} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( a u_i^n - a u_{i-1}^n \\right) = u_i^n - C \\left( u_i^n - u_{i-1}^n \\right) $$\n    This is the first part of the update formula provided in the problem statement.\n\n2.  **High-Order Scheme and Antidiffusive Flux**: A high-order scheme, such as the second-order Lax-Wendroff scheme, provides better accuracy but can introduce non-physical oscillations. The FCT methodology defines an \"antidiffusive flux\" $A_{i+\\frac{1}{2}}$ as the difference between a high-order flux $F_{i+\\frac{1}{2}}^{H}$ and the low-order flux $F_{i+\\frac{1}{2}}^{L}$. The Lax-Wendroff flux is\n    $$ F_{i+\\frac{1}{2}}^{H} = \\frac{a}{2} \\left( u_i^n + u_{i+1}^n \\right) - \\frac{a^2 \\Delta t}{2 \\Delta x} \\left( u_{i+1}^n - u_i^n \\right) = \\frac{a}{2} \\left( u_i^n + u_{i+1}^n \\right) - \\frac{a C}{2} \\left( u_{i+1}^n - u_i^n \\right) $$\n    The antidiffusive flux is then\n    $$ A_{i+\\frac{1}{2}} = F_{i+\\frac{1}{2}}^{H} - F_{i+\\frac{1}{2}}^{L} = \\left[ \\frac{a}{2} \\left( u_i^n + u_{i+1}^n \\right) - \\frac{a C}{2} \\left( u_{i+1}^n - u_i^n \\right) \\right] - a u_i^n $$\n    $$ A_{i+\\frac{1}{2}} = \\frac{a}{2} \\left( u_{i+1}^n - u_i^n \\right) - \\frac{a C}{2} \\left( u_{i+1}^n - u_i^n \\right) = \\frac{a}{2} (1-C) \\left( u_{i+1}^n - u_i^n \\right) $$\n\n3.  **Limited Antidiffusive Correction**: To ensure the Total Variation Diminishing (TVD) property, the antidiffusive flux is limited by a flux limiter function $\\varphi$. The limited antidiffusive flux is $A_{i+\\frac{1}{2}}^C = \\varphi\\left(r_{i+\\frac{1}{2}}\\right) A_{i+\\frac{1}{2}}$. The final update is constructed by adding the limited antidiffusive correction to the low-order update:\n    $$ u_i^{n+1} = u_i^{n+1, L} - \\frac{\\Delta t}{\\Delta x} \\left( A_{i+\\frac{1}{2}}^C - A_{i-\\frac{1}{2}}^C \\right) $$\n    Substituting the expressions for $u_i^{n+1, L}$ and $A_{i+\\frac{1}{2}}^C$:\n    $$ u_i^{n+1} = u_i^n - C \\left( u_i^n - u_{i-1}^n \\right) - \\frac{\\Delta t}{\\Delta x} \\left[ \\varphi\\left(r_{i+\\frac{1}{2}}\\right) \\frac{a}{2} (1-C) \\left( u_{i+1}^n - u_i^n \\right) - \\varphi\\left(r_{i-\\frac{1}{2}}\\right) \\frac{a}{2} (1-C) \\left( u_i^n - u_{i-1}^n \\right) \\right] $$\n    Factoring out terms and using $C = a \\Delta t / \\Delta x$:\n    $$ u_{i}^{n+1} = u_{i}^{n} - C\\left(u_{i}^{n}-u_{i-1}^{n}\\right) - \\frac{1}{2}C(1-C)\\left[\\,\\varphi\\!\\left(r_{i+\\frac{1}{2}}\\right)\\left(u_{i+1}^{n}-u_{i}^{n}\\right) - \\varphi\\!\\left(r_{i-\\frac{1}{2}}\\right)\\left(u_{i}^{n}-u_{i-1}^{n}\\right)\\right] $$\n    This completes the derivation, confirming that the given update formula represents a standard conservative flux-limiter scheme.\n\n### Calculation\n\nWe now apply this formula to the given data.\nThe initial profile is $u_{-2}^{n} = 1.0$, $u_{-1}^{n} = 1.5$, $u_{0}^{n} = 2.0$, $u_{1}^{n} = 1.5$, $u_{2}^{n} = 1.0$. The Courant number is $C=0.8$. The boundary cells $i=-2$ and $i=2$ are held fixed.\n\n**1. Total Variation at time $n$**\nThe total variation is $\\mathrm{TV}(u^{n}) = \\sum_{i=-2}^{1} |u_{i+1}^{n} - u_{i}^{n}|$.\nThe differences are:\n$u_{-1}^{n} - u_{-2}^{n} = 1.5 - 1.0 = 0.5$\n$u_{0}^{n} - u_{-1}^{n} = 2.0 - 1.5 = 0.5$\n$u_{1}^{n} - u_{0}^{n} = 1.5 - 2.0 = -0.5$\n$u_{2}^{n} - u_{1}^{n} = 1.0 - 1.5 = -0.5$\n$$ \\mathrm{TV}(u^{n}) = |0.5| + |0.5| + |-0.5| + |-0.5| = 0.5 + 0.5 + 0.5 + 0.5 = 2.0 $$\n\n**2. Computation of $u_i^{n+1}$ for interior cells**\nWe need to calculate the smoothness indicators $r_{i\\pm\\frac{1}{2}}$ and the corresponding limiter values $\\varphi(r_{i\\pm\\frac{1}{2}})$. The smoothness indicator is $r_{i+\\frac{1}{2}} = \\frac{u_{i}^{n} - u_{i-1}^{n}}{u_{i+1}^{n} - u_{i}^{n}}$.\nThe limiter is $\\varphi(r) = \\max(0, \\min(1, r))$.\n\nThe required smoothness indicators for updating $u_{-1}, u_0, u_1$ are:\n$r_{-3/2} = \\frac{u_{-2}^{n} - u_{-3}^{n}}{u_{-1}^{n} - u_{-2}^{n}}$. Assuming $u_{-3}^n=u_{-2}^n=1.0$ (piecewise constant background), the numerator is $0$, so $r_{-3/2}=0$.\n$r_{-1/2} = \\frac{u_{-1}^{n} - u_{-2}^{n}}{u_{0}^{n} - u_{-1}^{n}} = \\frac{0.5}{0.5} = 1.0$.\n$r_{1/2} = \\frac{u_{0}^{n} - u_{-1}^{n}}{u_{1}^{n} - u_{0}^{n}} = \\frac{0.5}{-0.5} = -1.0$.\n$r_{3/2} = \\frac{u_{1}^{n} - u_{0}^{n}}{u_{2}^{n} - u_{1}^{n}} = \\frac{-0.5}{-0.5} = 1.0$.\n\nThe limiter values are:\n$\\varphi(r_{-3/2}) = \\varphi(0) = 0$.\n$\\varphi(r_{-1/2}) = \\varphi(1.0) = 1.0$.\n$\\varphi(r_{1/2}) = \\varphi(-1.0) = \\max(0,\\min(1,-1)) = 0$.\n$\\varphi(r_{3/2}) = \\varphi(1.0) = 1.0$.\n\nThe constant coefficient in the correction term is $\\frac{1}{2}C(1-C) = \\frac{1}{2}(0.8)(1-0.8) = \\frac{1}{2}(0.8)(0.2) = 0.08$.\n\nNow, we compute the updated values for $i \\in \\{-1, 0, 1\\}$:\n- For $i=-1$:\n$u_{-1}^{n+1} = u_{-1}^{n} - C(u_{-1}^{n}-u_{-2}^{n}) - 0.08[\\varphi(r_{-1/2})(u_{0}^{n}-u_{-1}^{n}) - \\varphi(r_{-3/2})(u_{-1}^{n}-u_{-2}^{n})]$\n$u_{-1}^{n+1} = 1.5 - 0.8(0.5) - 0.08[1.0(0.5) - 0(0.5)] = 1.5 - 0.4 - 0.08(0.5) = 1.1 - 0.04 = 1.06$.\n\n- For $i=0$:\n$u_{0}^{n+1} = u_{0}^{n} - C(u_{0}^{n}-u_{-1}^{n}) - 0.08[\\varphi(r_{1/2})(u_{1}^{n}-u_{0}^{n}) - \\varphi(r_{-1/2})(u_{0}^{n}-u_{-1}^{n})]$\n$u_{0}^{n+1} = 2.0 - 0.8(0.5) - 0.08[0(-0.5) - 1.0(0.5)] = 2.0 - 0.4 - 0.08(-0.5) = 1.6 + 0.04 = 1.64$.\n\n- For $i=1$:\n$u_{1}^{n+1} = u_{1}^{n} - C(u_{1}^{n}-u_{0}^{n}) - 0.08[\\varphi(r_{3/2})(u_{2}^{n}-u_{1}^{n}) - \\varphi(r_{1/2})(u_{1}^{n}-u_{0}^{n})]$\n$u_{1}^{n+1} = 1.5 - 0.8(-0.5) - 0.08[1.0(-0.5) - 0(-0.5)] = 1.5 + 0.4 - 0.08(-0.5) = 1.9 + 0.04 = 1.94$.\n\nThe new profile is $u_{-2}^{n+1}=1.0$, $u_{-1}^{n+1}=1.06$, $u_{0}^{n+1}=1.64$, $u_{1}^{n+1}=1.94$, $u_{2}^{n+1}=1.0$.\n\n**3. Total Variation at time $n+1$**\n$\\mathrm{TV}(u^{n+1}) = \\sum_{i=-2}^{1} |u_{i+1}^{n+1} - u_{i}^{n+1}|$.\nThe new differences are:\n$u_{-1}^{n+1} - u_{-2}^{n+1} = 1.06 - 1.0 = 0.06$\n$u_{0}^{n+1} - u_{-1}^{n+1} = 1.64 - 1.06 = 0.58$\n$u_{1}^{n+1} - u_{0}^{n+1} = 1.94 - 1.64 = 0.30$\n$u_{2}^{n+1} - u_{1}^{n+1} = 1.0 - 1.94 = -0.94$\n$$ \\mathrm{TV}(u^{n+1}) = |0.06| + |0.58| + |0.30| + |-0.94| = 0.06 + 0.58 + 0.30 + 0.94 = 1.88 $$\n\n**4. Change in Total Variation**\nThe change in total variation is\n$$ \\Delta \\mathrm{TV} = \\mathrm{TV}(u^{n+1}) - \\mathrm{TV}(u^{n}) = 1.88 - 2.0 = -0.12 $$\n\n**Assessment of the TVD Property**\nA numerical scheme is Total Variation Diminishing (TVD) if $\\mathrm{TV}(u^{n+1}) \\le \\mathrm{TV}(u^{n})$. This is equivalent to $\\Delta \\mathrm{TV} \\le 0$. In this case, $\\Delta \\mathrm{TV} = -0.12$, which is negative. Therefore, for this single time step applied to the given profile, the total variation has decreased, and the minmod-limited scheme has behaved in a TVD manner, as expected from theory. The non-zero dissipation is characteristic of TVD schemes, especially near extrema where limiters are active.",
            "answer": "$$\n\\boxed{-0.12}\n$$"
        },
        {
            "introduction": "This practice moves from theoretical calculation to practical implementation, which is the ultimate test of understanding. Here, you will construct a complete one-dimensional Flux-Corrected Transport (FCT) scheme from its fundamental components, using the robust Zalesak limiter. The exercise requires implementing a low-order transport step, calculating raw anti-diffusive fluxes, and then applying a sophisticated, physically-motivated limiting procedure to ensure the final solution remains sharp, monotonic, and respects physical bounds—a core challenge in climate and weather modeling .",
            "id": "4043809",
            "problem": "Consider the one-dimensional conservative advection of a moisture mixing ratio $q(x,t)$ governed by the linear transport equation\n$$\n\\partial_t q + a \\,\\partial_x q = 0,\n$$\nwhere $a$ is a constant advection velocity and $q$ is bounded by physical constraints $q \\in [0,1]$. The task is to implement a single flux-corrected transport (FCT) step that combines a low-order monotone flux with a high-order flux and applies limiting to the anti-diffusive flux to prevent overshoots beyond the bounds while minimizing numerical diffusion. The computation is on a uniform periodic grid in one spatial dimension.\n\nYou must start from the following base:\n- Conservation of mass in a finite-volume discretization implies that changes in the cell averages are determined solely by numerical flux differences at cell interfaces.\n- A low-order upwind flux is monotone and positivity-preserving for Courant number $C = |a| \\Delta t / \\Delta x \\leq 1$.\n- A high-order flux (e.g., a centered or second-order accurate flux) reduces numerical diffusion but can create overshoots and undershoots near sharp gradients.\n- Flux-corrected transport defines an anti-diffusive flux as the difference between a chosen high-order flux and a low-order monotone flux and then limits this anti-diffusive flux to enforce bounds and avoid new extrema.\n\nImplement the following requirements without using shortcut formulas provided in the problem text:\n- Use a uniform periodic grid of $N$ cells covering $[0,L)$ with cell width $\\Delta x = L/N$ and one explicit time step $\\Delta t$ determined by a prescribed Courant number $C$ using $\\Delta t = C \\Delta x / |a|$.\n- Construct a sharp moisture front initial condition $q(x,0)$ that is piecewise constant: $q(x,0) = 1$ in one or more specified intervals and $q(x,0) = 0$ elsewhere (periodic across $x=0$ and $x=L$).\n- Compute a low-order monotone numerical flux at cell interfaces, a high-order consistent numerical flux, and form the raw anti-diffusive flux as their difference. Then compute limited anti-diffusive fluxes that:\n  1) enforce $q \\in [0,1]$ after the correction step, and\n  2) avoid creation of new local extrema relative to the three-point stencil from the previous time level.\n- Perform one FCT update step that applies the limited anti-diffusive fluxes to the low-order solution, resulting in the final $q$ for that single time step.\n\nUnits:\n- Advection velocity $a$ must be specified in meters per second ($\\mathrm{m/s}$).\n- Spatial length $L$ must be specified in meters ($\\mathrm{m}$).\n- The time step $\\Delta t$ must be computed in seconds ($\\mathrm{s}$) using the Courant number $C$.\n\nYour program must compute, for each test case, the following three diagnostics after the FCT-limited update:\n- The overshoot magnitude above the upper bound: $\\max(\\max_i q_i - 1, 0)$ expressed as a decimal.\n- The undershoot magnitude below the lower bound: $\\max(0 - \\min_i q_i, 0)$ expressed as a decimal.\n- The total variation defined on the periodic grid: $\\sum_{i=0}^{N-1} |q_{i+1 \\bmod N} - q_i|$ expressed as a decimal.\n\nTest suite:\nUse the following four test cases, each specified by $(N,L,a,C,\\text{intervals})$ where the intervals are subranges of $[0,L)$ on which $q=1$ initially:\n- Test $1$: $N=200$, $L=1$, $a=1$, $C=0.5$, intervals $\\{[0.4L,0.6L]\\}$.\n- Test $2$: $N=200$, $L=1$, $a=1$, $C=0.5$, intervals that wrap across the boundary: $\\{[0.9L, L), [0, 0.1L]\\}$.\n- Test $3$: $N=200$, $L=1$, $a=1$, $C=0.95$, intervals $\\{[0.25L,0.35L]\\}$.\n- Test $4$: $N=200$, $L=1$, $a=-1$, $C=0.7$, intervals $\\{[0.5L,0.7L]\\}$.\n\nFinal output format:\nYour program should produce a single line of output containing the concatenated diagnostics for all four tests in order, as a comma-separated list enclosed in square brackets. Specifically:\n$[o_1,u_1,tv_1,o_2,u_2,tv_2,o_3,u_3,tv_3,o_4,u_4,tv_4]$\nwhere $o_k$ is the overshoot magnitude, $u_k$ is the undershoot magnitude, and $tv_k$ is the total variation for test $k$, each expressed as a decimal.",
            "solution": "The problem statement has been critically validated and is deemed valid. It is scientifically grounded, well-posed, objective, and internally consistent. It presents a standard numerical methods problem from the field of computational fluid dynamics, specifically the implementation of a Flux-Corrected Transport (FCT) scheme for the linear advection equation. All necessary parameters and specifications are provided to construct a unique and verifiable solution.\n\nThe problem requires the implementation of a single time step for the one-dimensional linear advection equation,\n$$\n\\partial_t q + a \\, \\partial_x q = 0,\n$$\nwhere $q(x,t)$ is a moisture mixing ratio physically constrained to $q \\in [0,1]$, and $a$ is a constant advection velocity. The solution is to be computed on a uniform periodic grid of $N$ cells over a domain $[0, L)$. The core task is to implement a flux-corrected transport (FCT) update step.\n\nA finite-volume discretization of the equation over a grid cell $i$ (from $x_{i-1/2}$ to $x_{i+1/2}$) leads to an update formula for the cell-averaged quantity $q_i$:\n$$\nq_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x} (F_{i+1/2} - F_{i-1/2}),\n$$\nwhere $q_i^n$ is the value at time level $n$, $\\Delta x = L/N$ is the cell width, $\\Delta t$ is the time step, and $F_{i+1/2}$ is the numerical flux at the interface between cells $i$ and $i+1$. The time step is determined by the Courant number $C$ as $\\Delta t = C \\Delta x / |a|$.\n\nThe FCT methodology combines a low-order, monotone scheme with a high-order, more accurate but potentially oscillatory scheme to achieve a solution that is both accurate and non-oscillatory. The process is executed in several stages.\n\n**1. Low-Order Solution (Transport and Diffusion)**\n\nFirst, a tentative solution $q^L$ is computed using a low-order, monotone flux $F^L$. A standard choice is the first-order upwind flux, which is diffusive but guarantees that for $q^n \\in [0,1]$ and Courant number $C \\le 1$, the solution $q^L$ will also remain in $[0,1]$ and will not create new extrema. The upwind flux is defined as:\n$$\nF^L_{i+1/2} = \\begin{cases} a q_i^n  \\text{if } a > 0 \\\\ a q_{i+1}^n  \\text{if } a  0 \\end{cases}\n$$\nThe low-order, \"transported and diffused\" solution $q_i^L$ is then:\n$$\nq_i^L = q_i^n - \\frac{\\Delta t}{\\Delta x} (F^L_{i+1/2} - F^L_{i-1/2})\n$$\n\n**2. Anti-Diffusive Flux Calculation**\n\nNext, we define an anti-diffusive flux, which represents the difference between a high-order flux $F^H$ and the low-order flux $F^L$. This flux will be used to \"correct\" the overly-diffusive low-order solution. A suitable high-order choice is the second-order accurate Lax-Wendroff flux. The raw (unlimited) anti-diffusive flux $A_{i+1/2}$ is:\n$$\nA_{i+1/2} = F^H_{i+1/2} - F^L_{i+1/2}\n$$\nFor the linear advection equation, this difference can be shown to be equivalent to applying a numerical anti-diffusion. Using the Lax-Wendroff scheme as the high-order reference, the anti-diffusive flux simplifies to:\n$$\nA_{i+1/2} = \\frac{|a|}{2}(1-C)(q_{i+1}^n - q_i^n)\n$$\nwhere $C = |a| \\Delta t / \\Delta x$ is the Courant number. This flux is proportional to the local gradient and aims to sharpen the features diffused by the low-order step.\n\n**3. Flux Limiting (The \"Correction\" Step)**\n\nApplying the raw anti-diffusive fluxes directly could re-introduce the overshoots and undershoots of the high-order scheme. The central idea of FCT is to limit these fluxes to ensure that the final solution remains physically bounded and creates no new local extrema. The limited flux $A^c_{i+1/2}$ is a fraction of the raw flux: $A^c_{i+1/2} = \\alpha_{i+1/2} A_{i+1/2}$, where the correction factor $\\alpha_{i+1/2}$ is in $[0,1]$. We use the robust method of Zalesak (1979).\n\na. **Define Local Bounds**: For each cell $i$, we determine the maximum and minimum allowable values for the updated solution $q_i^{n+1}$. These are constrained by the physical bounds $[0,1]$ and the \"no new extrema\" condition relative to the solution at the previous time level, $q^n$. The bounds for cell $i$ are:\n$$\nQ_i^{\\max} = \\min(1, \\max(q_{i-1}^n, q_i^n, q_{i+1}^n))\n$$\n$$\nQ_i^{\\min} = \\max(0, \\min(q_{i-1}^n, q_i^n, q_{i+1}^n))\n$$\nIndices are handled periodically.\n\nb. **Calculate Cell Capacities**: The low-order solution $q_i^L$ serves as the base. The maximum possible increase in cell $i$ is $Q_i^{\\max} - q_i^L$ and the maximum possible decrease is $q_i^L - Q_i^{\\min}$. We compute the total \"room\" for incoming anti-diffusive mass, $M_i^+$, and the total available \"substance\" for outgoing anti-diffusive mass, $M_i^-$:\n$$\nM_i^+ = (Q_i^{\\max} - q_i^L) \\Delta x\n$$\n$$\nM_i^- = (q_i^L - Q_i^{\\min}) \\Delta x\n$$\n\nc. **Sum Raw Fluxes**: For each cell $i$, we calculate the total mass that would be added by incoming raw anti-diffusive fluxes, $P_i^+$, and the total mass that would be removed by outgoing raw anti-diffusive fluxes, $P_i^-$.\n$$\nP_i^+ = \\Delta t (\\max(0, A_{i-1/2}) - \\min(0, A_{i+1/2}))\n$$\n$$\nP_i^- = \\Delta t (\\max(0, A_{i+1/2}) - \\min(0, A_{i-1/2}))\n$$\n\nd. **Determine Correction Ratios**: We compute cell-wise correction ratios for incoming ($R_i^+$) and outgoing ($R_i^-$) fluxes. These ratios determine what fraction of the total incoming/outgoing flux can be accommodated without violating the bounds.\n$$\nR_i^+ = \\begin{cases} \\min(1, M_i^+ / P_i^+)  \\text{if } P_i^+  0 \\\\ 1  \\text{if } P_i^+ = 0 \\end{cases}\n$$\n$$\nR_i^- = \\begin{cases} \\min(1, M_i^- / P_i^-)  \\text{if } P_i^-  0 \\\\ 1  \\text{if } P_i^- = 0 \\end{cases}\n$$\n\ne. **Limit Each Flux**: Each flux $A_{i+1/2}$ is limited by the constraints of both its donor and receiver cells.\nIf $A_{i+1/2}  0$, it removes mass from cell $i$ (donor) and adds mass to cell $i+1$ (receiver). The correction factor is $\\alpha_{i+1/2} = \\min(R_i^-, R_{i+1}^+)$.\nIf $A_{i+1/2}  0$, it adds mass to cell $i$ (receiver) and removes mass from cell $i+1$ (donor). The correction factor is $\\alpha_{i+1/2} = \\min(R_i^+, R_{i+1}^-)$.\nIf $A_{i+1/2} = 0$, $\\alpha_{i+1/2}$ is undefined but the corrected flux is $0$.\nThe corrected flux is then $A^c_{i+1/2} = \\alpha_{i+1/2} A_{i+1/2}$.\n\n**4. Final Update (Anti-Diffusion)**\n\nFinally, the limited anti-diffusive fluxes are applied to the low-order solution to obtain the final, corrected solution for the time step:\n$$\nq_i^{n+1} = q_i^L - \\frac{\\Delta t}{\\Delta x}(A^c_{i+1/2} - A^c_{i-1/2})\n$$\nBy construction, $q_i^{n+1}$ will respect the physical bounds and will not contain any new, unphysical oscillations.\n\n**Diagnostics**\n\nThe performance of the scheme is evaluated using three diagnostics computed from the final state $q^{n+1}$:\n- Overshoot: $\\max(\\max_i q_i^{n+1} - 1, 0)$\n- Undershoot: $\\max(0 - \\min_i q_i^{n+1}, 0)$\n- Total Variation (TV): $\\sum_{i=0}^{N-1} |q_{(i+1) \\bmod N}^{n+1} - q_i^{n+1}|$. An ideal scheme for a square wave would keep the TV from increasing.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_fct_step(N, L, a, C, intervals):\n    \"\"\"\n    Performs a single Flux-Corrected Transport (FCT) step and computes diagnostics.\n    \n    Args:\n        N (int): Number of grid cells.\n        L (float): Length of the periodic domain.\n        a (float): Advection velocity.\n        C (float): Courant number.\n        intervals (list of tuples): List of [start, end) intervals where q=1.\n\n    Returns:\n        tuple: A tuple containing (overshoot, undershoot, total_variation).\n    \"\"\"\n\n    # 1. Grid and Parameters Setup\n    dx = L / N\n    dt = C * dx / abs(a)\n    nu = a * dt / dx  # Signed Courant number\n\n    # Cell centers\n    x = (np.arange(N) + 0.5) * dx\n    \n    # Initial condition q^n\n    q_n = np.zeros(N, dtype=np.float64)\n    for start, end in intervals:\n        # Indices for cells whose centers fall in [start, end)\n        # i_start = i = i_end\n        # start = (i + 0.5) * dx  end\n        # start/dx - 0.5 = i  end/dx - 0.5\n        i_start = int(np.ceil(start / dx - 0.5))\n        i_end = int(np.floor(end / dx - 0.5))\n        if i_start = i_end: # Handles standard interval\n            q_n[i_start : i_end + 1] = 1.0\n        else: # Handle wrap-around case e.g., i_start > i_end\n            q_n[i_start:] = 1.0\n            q_n[:i_end+1] = 1.0\n    \n    # Helper for periodic boundaries\n    def roll(arr, shift):\n        return np.roll(arr, shift)\n\n    # 2. Low-Order Solution (Transport and Diffusion)\n    # Using first-order upwind scheme\n    if a > 0:\n        # Flux F^L_{i+1/2} = a * q_i\n        # Flux F^L_{i-1/2} = a * q_{i-1} -> roll(q_n, 1)\n        flux_diff = a * (q_n - roll(q_n, 1))\n    else:  # a  0\n        # Flux F^L_{i+1/2} = a * q_{i+1} -> roll(q_n, -1)\n        # Flux F^L_{i-1/2} = a * q_i\n        flux_diff = a * (roll(q_n, -1) - q_n)\n    \n    q_L = q_n - (dt / dx) * flux_diff\n\n    # 3. Anti-Diffusive Flux Calculation\n    # A_{i+1/2} = |a|/2 * (1-C) * (q_{i+1} - q_i)\n    # A_{i+1/2} is defined at interfaces, so we calculate it for all N interfaces\n    q_ip1 = roll(q_n, -1)\n    A_ip12 = (abs(a) / 2.0) * (1.0 - C) * (q_ip1 - q_n)\n    \n    # 4. Flux Limiting (Zalesak, 1979)\n    \n    # a. Define Local Bounds\n    q_im1 = roll(q_n, 1) # q_{i-1} for all i\n    Q_max = np.minimum(1.0, np.maximum(np.maximum(q_im1, q_n), q_ip1))\n    Q_min = np.maximum(0.0, np.minimum(np.minimum(q_im1, q_n), q_ip1))\n    \n    # b. Calculate Cell Capacities (as mass)\n    M_plus = (Q_max - q_L) * dx\n    M_minus = (q_L - Q_min) * dx\n    \n    # c. Sum Raw Fluxes (as mass)\n    # Fluxes for cell i are A_{i-1/2} and A_{i+1/2}\n    # A_{i-1/2} for all i is roll(A_ip12, 1)\n    A_im12 = roll(A_ip12, 1)\n    \n    P_plus = dt * (np.maximum(0, A_im12) - np.minimum(0, A_ip12))\n    P_minus = dt * (np.maximum(0, A_ip12) - np.minimum(0, A_im12))\n\n    # d. Determine Correction Ratios\n    # Use np.divide to handle division by zero safely\n    R_plus = np.divide(M_plus, P_plus, out=np.ones_like(P_plus), where=P_plus > 1e-15)\n    R_plus = np.minimum(1.0, R_plus)\n\n    R_minus = np.divide(M_minus, P_minus, out=np.ones_like(P_minus), where=P_minus > 1e-15)\n    R_minus = np.minimum(1.0, R_minus)\n\n    # e. Limit Each Flux\n    # Flux A_{i+1/2} affects cells i and i+1\n    # R_plus for cell i+1 is roll(R_plus, -1)\n    # R_minus for cell i+1 is roll(R_minus, -1)\n    R_plus_ip1 = roll(R_plus, -1)\n    R_minus_ip1 = roll(R_minus, -1)\n    \n    # Correction factor alpha_{i+1/2}\n    alpha = np.ones_like(A_ip12)\n    # Case A_{i+1/2} > 0: donor is i, receiver is i+1\n    # alpha_{i+1/2} = min(R_i^-, R_{i+1}^+)\n    positive_flux_mask = A_ip12 > 0\n    alpha[positive_flux_mask] = np.minimum(R_minus[positive_flux_mask], R_plus_ip1[positive_flux_mask])\n    \n    # Case A_{i+1/2}  0: donor is i+1, receiver is i\n    # alpha_{i+1/2} = min(R_i^+, R_{i+1}^-)\n    negative_flux_mask = A_ip12  0\n    alpha[negative_flux_mask] = np.minimum(R_plus[negative_flux_mask], R_minus_ip1[negative_flux_mask])\n\n    A_c_ip12 = alpha * A_ip12\n    \n    # 5. Final Update (Anti-Diffusion)\n    # Corrected fluxes at i-1/2 interface\n    A_c_im12 = roll(A_c_ip12, 1)\n    q_new = q_L - (dt / dx) * (A_c_ip12 - A_c_im12)\n    \n    # 6. Diagnostics\n    overshoot = max(np.max(q_new) - 1.0, 0.0)\n    undershoot = max(0.0 - np.min(q_new), 0.0)\n    total_variation = np.sum(np.abs(roll(q_new, -1) - q_new))\n    \n    return overshoot, undershoot, total_variation\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, L, a, C, intervals)\n        (200, 1.0, 1.0, 0.5, [(0.4, 0.6)]),\n        (200, 1.0, 1.0, 0.5, [(0.9, 1.0), (0.0, 0.1)]),\n        (200, 1.0, 1.0, 0.95, [(0.25, 0.35)]),\n        (200, 1.0, -1.0, 0.7, [(0.5, 0.7)]),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, L, a, C, raw_intervals = case\n        # Scale intervals by L\n        intervals = [(start * L, end * L) for start, end in raw_intervals]\n        \n        overshoot, undershoot, tv = run_fct_step(N, L, a, C, intervals)\n        results.extend([overshoot, undershoot, tv])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}