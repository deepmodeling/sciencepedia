{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of probabilistic event attribution is quantifying how anthropogenic forcing has altered the likelihood of a specific extreme event. This practice focuses on the most direct method: calculating the Risk Ratio ($RR$) from large climate model ensembles. By treating event occurrences as binomial processes, you will use maximum likelihood estimation and the Delta method to not only compute the $RR$ but also to derive its statistical uncertainty, a critical step for a robust attribution statement. ",
            "id": "4041785",
            "problem": "A global coupled General Circulation Model (GCM) is used to perform a large-ensemble event attribution analysis for a heatwave threshold defined by daily maximum temperature exceeding a high quantile calibrated from a long control simulation. Two sets of atmosphere-only simulations are generated with distinct external forcings but identical model physics and comparable sample sizes: a \"factual\" world with present-day forcings and a \"counterfactual\" world approximating preindustrial forcings. Let $N_1$ and $N_0$ denote the total numbers of independent daily samples pooled across all ensemble members and relevant seasons for the factual and counterfactual sets, respectively, and let $n_1$ and $n_0$ denote the corresponding numbers of exceedances of the threshold. Assume that within each world, exceedances arise as independent Bernoulli trials with constant probability.\n\nIn a particular analysis, the model produced $N_1 = 50{,}000$ daily samples in the factual world with $n_1 = 2{,}100$ exceedances, and $N_0 = 50{,}000$ daily samples in the counterfactual world with $n_0 = 200$ exceedances.\n\nUsing only core definitions and large-sample properties of binomial sampling, do the following:\n\n- Define the Risk Ratio (RR) for the event as the ratio of the exceedance probability in the factual world to that in the counterfactual world, and compute its maximum likelihood estimator based on the given counts.\n- Starting from the binomial model and the large-sample Gaussian approximation for the sample proportions, derive the asymptotic standard error of the natural logarithm of the estimated Risk Ratio, and then evaluate it numerically using the given counts.\n\nRound both the estimated Risk Ratio and the asymptotic standard error of its natural logarithm to four significant figures. Report dimensionless quantities (do not express any result as a percentage).",
            "solution": "The problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution. We may proceed with the analysis.\n\nLet $p_1$ be the true probability of a daily maximum temperature exceedance in the factual world and $p_0$ be the true probability of an exceedance in the counterfactual world. The problem states that within each world, the occurrences of exceedances are modeled as independent Bernoulli trials.\nThe number of exceedances $n_1$ in the factual world, from a total of $N_1$ samples, is thus a realization of a random variable following a binomial distribution, $n_1 \\sim \\text{Bin}(N_1, p_1)$.\nSimilarly, the number of exceedances $n_0$ in the counterfactual world follows $n_0 \\sim \\text{Bin}(N_0, p_0)$.\n\nThe maximum likelihood estimator (MLE) for the probability parameter $p$ of a binomial distribution is the sample proportion $\\hat{p} = \\frac{n}{N}$.\nTherefore, the MLEs for $p_1$ and $p_0$ are:\n$$ \\hat{p}_1 = \\frac{n_1}{N_1} $$\n$$ \\hat{p}_0 = \\frac{n_0}{N_0} $$\n\nThe first task is to define the Risk Ratio ($RR$) and compute its MLE.\nThe $RR$ is defined as the ratio of the exceedance probability in the factual world to that in the counterfactual world:\n$$ RR = \\frac{p_1}{p_0} $$\n\nBy the invariance property of maximum likelihood estimators, the MLE of a function of parameters is that same function applied to the MLEs of the parameters. Thus, the MLE of the Risk Ratio, denoted $\\widehat{RR}$, is:\n$$ \\widehat{RR} = \\frac{\\hat{p}_1}{\\hat{p}_0} = \\frac{n_1/N_1}{n_0/N_0} $$\n\nUsing the provided data, $N_1 = 50,000$, $n_1 = 2,100$, $N_0 = 50,000$, and $n_0 = 200$:\n$$ \\hat{p}_1 = \\frac{2,100}{50,000} = 0.042 $$\n$$ \\hat{p}_0 = \\frac{200}{50,000} = 0.004 $$\n$$ \\widehat{RR} = \\frac{0.042}{0.004} = 10.5 $$\nRounding to four significant figures, we get $\\widehat{RR} = 10.50$.\n\nThe second task is to derive the asymptotic standard error of the natural logarithm of the estimated Risk Ratio, $\\text{SE}(\\ln(\\widehat{RR}))$.\nLet $g(p_1, p_0) = \\ln(RR) = \\ln(\\frac{p_1}{p_0}) = \\ln(p_1) - \\ln(p_0)$. We are interested in the standard error of $g(\\hat{p}_1, \\hat{p}_0) = \\ln(\\widehat{RR})$.\n\nAccording to the central limit theorem, for large sample sizes, the distributions of the sample proportions $\\hat{p}_1$ and $\\hat{p}_0$ are approximately Gaussian:\n$$ \\hat{p}_1 \\approx \\mathcal{N}\\left(p_1, \\frac{p_1(1-p_1)}{N_1}\\right) $$\n$$ \\hat{p}_0 \\approx \\mathcal{N}\\left(p_0, \\frac{p_0(1-p_0)}{N_0}\\right) $$\nThe variances are $\\text{Var}(\\hat{p}_1) = \\frac{p_1(1-p_1)}{N_1}$ and $\\text{Var}(\\hat{p}_0) = \\frac{p_0(1-p_0)}{N_0}$. Since the factual and counterfactual simulations are independent, $\\text{Cov}(\\hat{p}_1, \\hat{p}_0) = 0$.\n\nWe use the multivariate Delta method to find the asymptotic variance of $\\ln(\\widehat{RR})$. For a function $g(\\hat{\\theta}_1, \\hat{\\theta}_2)$ of two independent estimators, the variance is approximated by:\n$$ \\text{Var}(g(\\hat{\\theta}_1, \\hat{\\theta}_2)) \\approx \\left(\\frac{\\partial g}{\\partial \\theta_1}\\right)^2 \\text{Var}(\\hat{\\theta}_1) + \\left(\\frac{\\partial g}{\\partial \\theta_2}\\right)^2 \\text{Var}(\\hat{\\theta}_2) $$\nwhere the partial derivatives are evaluated at the true parameter values $(\\theta_1, \\theta_2)$.\n\nIn our case, $\\theta_1 = p_1$, $\\theta_2 = p_0$, and $g(p_1, p_0) = \\ln(p_1) - \\ln(p_0)$. The partial derivatives are:\n$$ \\frac{\\partial g}{\\partial p_1} = \\frac{1}{p_1} $$\n$$ \\frac{\\partial g}{\\partial p_0} = -\\frac{1}{p_0} $$\n\nSubstituting these into the Delta method formula:\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\left(\\frac{1}{p_1}\\right)^2 \\text{Var}(\\hat{p}_1) + \\left(-\\frac{1}{p_0}\\right)^2 \\text{Var}(\\hat{p}_0) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1}{p_1^2} \\left( \\frac{p_1(1-p_1)}{N_1} \\right) + \\frac{1}{p_0^2} \\left( \\frac{p_0(1-p_0)}{N_0} \\right) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1-p_1}{p_1 N_1} + \\frac{1-p_0}{p_0 N_0} $$\nThis is the asymptotic variance. To obtain an estimated variance, we substitute the MLEs $\\hat{p}_1$ and $\\hat{p}_0$ for the true parameters $p_1$ and $p_0$:\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1-\\hat{p}_1}{\\hat{p}_1 N_1} + \\frac{1-\\hat{p}_0}{\\hat{p}_0 N_0} $$\nSubstituting $\\hat{p}_1 = n_1/N_1$ and $\\hat{p}_0 = n_0/N_0$:\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1 - n_1/N_1}{ (n_1/N_1) N_1} + \\frac{1 - n_0/N_0}{ (n_0/N_0) N_0} = \\frac{(N_1 - n_1)/N_1}{n_1} + \\frac{(N_0 - n_0)/N_0}{n_0} $$\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{N_1 - n_1}{n_1 N_1} + \\frac{N_0 - n_0}{n_0 N_0} $$\nThis expression can be rewritten as:\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\left(\\frac{1}{n_1} - \\frac{1}{N_1}\\right) + \\left(\\frac{1}{n_0} - \\frac{1}{N_0}\\right) $$\nThe asymptotic standard error is the square root of this estimated variance:\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{n_1} - \\frac{1}{N_1} + \\frac{1}{n_0} - \\frac{1}{N_0}} $$\n\nNow, we evaluate this numerically with the given counts:\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} - \\frac{1}{50,000} + \\frac{1}{200} - \\frac{1}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} + \\frac{1}{200} - \\frac{2}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.000476190... + 0.005 - 0.00004} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.005436190...} \\approx 0.07373052... $$\nRounding to four significant figures, we get $\\text{SE}(\\ln(\\widehat{RR})) = 0.07373$.\n\nThe two required quantities are the estimated Risk Ratio, $\\widehat{RR}$, and the asymptotic standard error of its logarithm, $\\text{SE}(\\ln(\\widehat{RR}))$.\n- Estimated Risk Ratio: $10.50$\n- Asymptotic standard error of the log-Risk Ratio: $0.07373$",
            "answer": "$$\\boxed{\\begin{pmatrix} 10.50 & 0.07373 \\end{pmatrix}}$$"
        },
        {
            "introduction": "While direct counting from ensembles provides an empirical estimate, parametric models from Extreme Value Theory (EVT) offer deeper physical and statistical insights. This exercise uses the Generalized Extreme Value (GEV) distribution, the theoretical model for block maxima, to analytically explore how a simple shift in the climate's mean can dramatically alter the return period of a rare event. Mastering this relationship is key to understanding the highly non-linear response of extremes to climate change. ",
            "id": "4041693",
            "problem": "Consider a sequence of annual block maxima $\\{X_{1}, X_{2}, \\dots, X_{n}\\}$ for a climate variable (e.g., annual maximum daily precipitation), modeled as independent and identically distributed draws from the Generalized Extreme Value (GEV) distribution with location parameter $\\mu$, scale parameter $\\sigma>0$, and shape parameter $\\xi \\neq 0$. The cumulative distribution function of the GEV for a value $x$ is given by\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\ndefined for values of $x$ such that $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$. Let $z$ be the baseline return level such that the one-year exceedance probability under the baseline climate is $P(X > z) = \\frac{1}{T_{b}}$, where $T_{b} > 1$ is the baseline return period in years.\n\nSuppose that under a perturbed climate state attributable to a systematic forcing, the location parameter shifts to $\\mu' = \\mu + \\Delta\\mu$, while $\\sigma$ and $\\xi$ remain unchanged. Assume that years remain independent and that the threshold $z$ is fixed at its baseline value. Using only the definition of the expected value and the GEV cumulative distribution function, derive an exact expression for:\n- the expected number of exceedances above $z$ in the next $n$ years under the perturbed climate, and\n- the perturbed return period $T'$ (in years) associated with threshold $z$ under the perturbed climate.\n\nExpress your final answer in a single closed-form expression in terms of $n$, $T_{b}$, $\\sigma$, $\\xi$, and $\\Delta\\mu$. You must state and use any domain conditions required for validity (e.g., positivity constraints for the GEV support), but your final boxed answer must not include these conditions. No numerical approximation or rounding is required, and no physical units should be included in the final boxed expression.",
            "solution": "The Generalized Extreme Value (GEV) distribution describes block maxima with cumulative distribution function\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\ndefined on the support where $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$. For a fixed threshold $z$, the per-year exceedance probability under parameters $(\\mu, \\sigma, \\xi)$ is\n$$\np(\\mu) \\equiv P(X > z) \\;=\\; 1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\nagain with the domain restriction $1 + \\xi\\,\\frac{z-\\mu}{\\sigma} > 0$.\n\nBy the definition of the return period, the baseline condition $P(X > z) = 1/T_{b}$ implies\n$$\n1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; \\frac{1}{T_{b}}\n\\;\\;\\Longrightarrow\\;\\;\nG(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\frac{1}{T_{b}}.\n$$\nUsing the GEV cumulative distribution function, we have\n$$\n\\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\n\\;=\\;\n1 - \\frac{1}{T_{b}}.\n$$\nTaking the natural logarithm on both sides yields\n$$\n-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right),\n$$\nso\n$$\n\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right).\n$$\nDefine the positive quantity (for $T_{b} > 1$)\n$$\nA \\;\\equiv\\; -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right) \\;>\\; 0.\n$$\nThen\n$$\n1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi},\n$$\nand consequently\n$$\nz - \\mu\n\\;=\\;\n\\frac{\\sigma}{\\xi}\\,\\Big(A^{-\\xi} - 1\\Big).\n$$\n\nUnder the perturbed climate with location parameter $\\mu' = \\mu + \\Delta\\mu$ (and unchanged $\\sigma$ and $\\xi$), the per-year exceedance probability for the same threshold $z$ becomes\n$$\np' \\;\\equiv\\; P(X > z \\,|\\, \\mu') \\;=\\; 1 - G\\big(z; \\mu + \\Delta\\mu, \\sigma, \\xi\\big)\n\\;=\\;\n1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\nwith the perturbed support condition\n$$\n1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma} \\;>\\; 0.\n$$\nUsing the expression for $z - \\mu$ found above,\n$$\n1 + \\xi\\,\\frac{z - (\\mu + \\Delta\\mu)}{\\sigma}\n\\;=\\;\n1 + \\xi\\,\\frac{(z-\\mu) - \\Delta\\mu}{\\sigma}\n\\;=\\;\n\\left(1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right) - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}.\n$$\nTherefore,\n$$\np' \\;=\\; 1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\nvalid when $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$ (to keep the perturbed threshold within the GEV support).\n\nThe expected number of exceedances over $n$ independent years under the perturbed climate is, by linearity of expectation and independence,\n$$\nE' \\;=\\; n\\,p' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}.\n$$\n\nThe perturbed return period $T'$ for threshold $z$ is defined as the reciprocal of the per-year exceedance probability,\n$$\nT' \\;=\\; \\frac{1}{p'}\n\\;=\\;\n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1}.\n$$\n\nSummarizing, with $A = -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)$, the exact expressions are\n$$\nE' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\},\n\\qquad\nT' \\;=\\; \\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1},\n$$\nsubject to the domain condition $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$ ensuring that the threshold $z$ lies within the support under the perturbed climate. These formulas explicitly connect a location shift $\\Delta\\mu$ to changes in the expected exceedance count over $n$ years and the corresponding return period under the GEV framework.",
            "answer": "$$\\boxed{\\begin{pmatrix}\nn\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right] &\n\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right]^{-1}\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "Moving from block maxima (GEV) to a more data-efficient approach, the Peaks-Over-Threshold (POT) method is a powerful tool in the attribution scientist's toolkit. This hands-on programming exercise challenges you to build a complete POT model, which combines a Poisson process for the rate of extreme events with a Generalized Pareto Distribution (GPD) for their magnitudes. By implementing and testing this model, you will gain practical experience in simulating how changes in climate affect both the frequency and intensity of extremes. ",
            "id": "4041726",
            "problem": "Consider a stochastic representation of daily precipitation in a region used for extreme event attribution in numerical weather prediction and climate modeling. Let daily precipitation be denoted by a sequence $\\{R(t)\\}_{t=1,2,\\dots}$, measured in millimeters per day ($\\mathrm{mm/day}$). Define an extreme precipitation event over a duration window of $D$ days and a threshold $u$ (in $\\mathrm{mm/day}$) as the event $E=\\{\\max_{t\\in\\{1,2,\\dots,D\\}} R(t)>u\\}$. Let $P_1$ be the probability of $E$ in a present-day (factual) climate and $P_0$ be the probability of $E$ in a counterfactual climate without anthropogenic forcing. Define the Relative Risk (RR) as $RR = P_1 / P_0$.\n\nUse a Peaks-Over-Threshold (POT) model grounded in Extreme Value Theory. Assume exceedances above a chosen base threshold $u_0$ (in $\\mathrm{mm/day}$) arrive according to a homogeneous Poisson process with rate $\\lambda_{u_0}$ per day, and the exceedance magnitudes $Y=R-u_0$ conditioned on $R>u_0$ follow a Generalized Pareto Distribution (GPD) with shape parameter $\\xi$ and scale parameter $\\sigma$ at threshold $u_0$. Model two climates: the factual world with parameters $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)})$ and the counterfactual world with parameters $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)})$. Assume independence of daily exceedance occurrences and that $u\\ge u_0$.\n\nStarting from the core definitions above and well-tested facts about the Poisson process and the Generalized Pareto Distribution, derive expressions for $P_1$, $P_0$, and $RR$ as functions of $(D,u,u_0,\\lambda_{u_0},\\xi,\\sigma)$ under the POT framework, and implement these expressions in a program. The program must compute $P_1$, $P_0$, and $RR$ for each of the test cases listed below. If $P_0=0$ and $P_1>0$, define $RR$ as $+\\infty$. If $P_0=0$ and $P_1=0$, define $RR$ as not-a-number ($\\mathrm{NaN}$). All probabilities must be expressed as decimal fractions (unitless), and thresholds as $\\mathrm{mm/day}$, durations as days. The program must round all floating-point outputs to $6$ decimal places when printing.\n\nUse the following scientifically consistent test suite with varying $D$ and $u$ to explore sensitivity:\n\n- Test case $1$ (happy path, moderate window and threshold, exponential tail in counterfactual):\n  - $u_0 = 20\\,\\mathrm{mm/day}$,\n  - factual parameters $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)}) = (0.25\\,\\mathrm{day}^{-1}, 0.10, 15\\,\\mathrm{mm})$,\n  - counterfactual parameters $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)}) = (0.20\\,\\mathrm{day}^{-1}, 0.00, 12\\,\\mathrm{mm})$,\n  - window $D=5$ days,\n  - threshold $u=50\\,\\mathrm{mm/day}$.\n\n- Test case $2$ (larger window, very high threshold):\n  - same $u_0$ and parameter sets as in test case $1$,\n  - window $D=10$ days,\n  - threshold $u=100\\,\\mathrm{mm/day}$.\n\n- Test case $3$ (short window, lower threshold):\n  - same $u_0$ and parameter sets as in test case $1$,\n  - window $D=1$ day,\n  - threshold $u=30\\,\\mathrm{mm/day}$.\n\n- Test case $4$ (boundary case $D=0$ days):\n  - same $u_0$ and parameter sets as in test case $1$,\n  - window $D=0$ days,\n  - threshold $u=60\\,\\mathrm{mm/day}$.\n\n- Test case $5$ (finite right endpoint in counterfactual tail, intermediate threshold):\n  - $u_0 = 20\\,\\mathrm{mm/day}$,\n  - factual parameters $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)}) = (0.30\\,\\mathrm{day}^{-1}, 0.05, 18\\,\\mathrm{mm})$,\n  - counterfactual parameters $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)}) = (0.22\\,\\mathrm{day}^{-1}, -0.10, 25\\,\\mathrm{mm})$,\n  - window $D=7$ days,\n  - threshold $u=110\\,\\mathrm{mm/day}$.\n\n- Test case $6$ (finite endpoint leading to zero probability in counterfactual):\n  - $u_0 = 20\\,\\mathrm{mm/day}$,\n  - factual parameters $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)}) = (0.30\\,\\mathrm{day}^{-1}, 0.05, 18\\,\\mathrm{mm})$,\n  - counterfactual parameters $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)}) = (0.22\\,\\mathrm{day}^{-1}, -0.10, 25\\,\\mathrm{mm})$,\n  - window $D=14$ days,\n  - threshold $u=280\\,\\mathrm{mm/day}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result itself being a comma-separated triple enclosed in square brackets, in the order $[P_1,P_0,RR]$. For example, the overall format must be like $[[p_{1,1},p_{0,1},rr_1],[p_{1,2},p_{0,2},rr_2],\\dots]$ with no spaces. All printed numeric entries must be rounded to $6$ decimal places, and special values must be printed as $\\mathrm{inf}$ or $\\mathrm{nan}$ when applicable.",
            "solution": "The problem requires the derivation and implementation of formulas for extreme event probabilities and their relative risk under the Peaks-Over-Threshold (POT) framework, a standard methodology in Extreme Value Theory (EVT).\n\n### Step 1: Problem Validation\n\nThe problem statement provides a scientifically sound and well-posed scenario grounded in statistical climatology.\n\n**Extracted Givens:**\n-   **Model:** Peaks-Over-Threshold (POT) for daily precipitation $R(t)$.\n-   **Base Threshold:** $u_0$ ($\\mathrm{mm/day}$).\n-   **Exceedance Arrivals:** Exceedances of $u_0$ follow a homogeneous Poisson process with rate $\\lambda_{u_0}$ ($\\mathrm{day}^{-1}$).\n-   **Exceedance Magnitudes:** The excesses $Y=R-u_0$ (for $R>u_0$) follow a Generalized Pareto Distribution (GPD) with shape $\\xi$ and scale $\\sigma$ ($\\mathrm{mm}$).\n-   **Climates:**\n    -   Factual: Parameters $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)})$.\n    -   Counterfactual: Parameters $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)})$.\n-   **Extreme Event:** $E=\\{\\max_{t\\in\\{1,2,\\dots,D\\}} R(t)>u\\}$, for a duration $D$ (days) and threshold $u$ ($\\mathrm{mm/day}$), with $u \\ge u_0$.\n-   **Probabilities:** $P_1 = P(E)$ in the factual climate, $P_0 = P(E)$ in the counterfactual climate.\n-   **Relative Risk:** $RR = P_1 / P_0$.\n    -   If $P_0=0$ and $P_1>0$, $RR = +\\infty$.\n    -   If $P_0=0$ and $P_1=0$, $RR = \\mathrm{NaN}$.\n-   **Assumption:** Independence of daily exceedance occurrences.\n-   **Test Data:** Six distinct test cases are provided with all necessary parameters.\n\n**Validation Verdict:**\nThe problem is valid. It is scientifically grounded in EVT, a cornerstone of modern climate science for analyzing extremes. The definitions are precise, the setup is complete and internally consistent, and the parameters are physically plausible. The problem requires a standard derivation based on the properties of the Poisson process and the GPD, which is a non-trivial but well-defined task.\n\n### Step 2: Derivation of Probabilities and Relative Risk\n\nThe core of the POT model is that exceedances of a high threshold $u_0$ occur as a Poisson point process. The rate of these exceedances is $\\lambda_{u_0}$ events per day. The magnitude of an exceedance above $u_0$, given that one has occurred, follows a GPD.\n\nLet us first derive the probability $P$ of the event $E$ for a generic set of parameters $(D, u, u_0, \\lambda_{u_0}, \\xi, \\sigma)$. The event $E$ is that the maximum precipitation over $D$ days exceeds a threshold $u$.\n\n1.  **Thinning a Poisson Process:** The rate of exceedances above the base threshold $u_0$ is $\\lambda_{u_0}$. We are interested in exceedances of a higher threshold $u$. Based on the thinning property of Poisson processes, if events of a certain type arrive with rate $\\lambda_A$, and each event independently has a specific characteristic with probability $p$, then the events with that characteristic also arrive as a Poisson process with a thinned rate $\\lambda_B = p \\lambda_A$.\n\n    In our case, the initial events are exceedances over $u_0$. The characteristic of interest is that the precipitation also exceeds $u$. The probability $p$ is thus $P(R > u | R > u_0)$. The rate of exceedances over $u$, denoted $\\lambda_u$, is therefore:\n    $$ \\lambda_u = \\lambda_{u_0} \\cdot P(R > u | R > u_0) $$\n\n2.  **GPD Survival Function:** The probability $P(R > u | R > u_0)$ is the probability that an excess $Y = R - u_0$ is greater than $u - u_0$. This is given by the survival function of the GPD, $S_{GPD}(y)$, evaluated at $y = u - u_0$.\n\n    The GPD survival function for an excess amount $y = u - u_0 \\ge 0$ is:\n    $$ S_{GPD}(y; \\xi, \\sigma) = P(Y > y) = \\begin{cases} \\left(1 + \\frac{\\xi y}{\\sigma}\\right)^{-1/\\xi} & \\text{if } \\xi \\neq 0 \\\\ \\exp\\left(-\\frac{y}{\\sigma}\\right) & \\text{if } \\xi = 0 \\end{cases} $$\n    This is valid for the support of the distribution. For $\\xi < 0$, the GPD has a finite upper endpoint at $y_{max} = -\\sigma/\\xi$. If $y \\ge y_{max}$, the probability of exceedance is $0$. For $\\xi \\ge 0$, the support is unbounded.\n\n3.  **Rate of High-Threshold Exceedances:** Combining these, the rate $\\lambda_u$ becomes:\n    For $\\xi \\neq 0$:\n    $$ \\lambda_u = \\lambda_{u_0} \\left(1 + \\frac{\\xi (u-u_0)}{\\sigma}\\right)^{-1/\\xi} \\quad \\text{provided } 1 + \\frac{\\xi(u-u_0)}{\\sigma} > 0 $$\n    For $\\xi = 0$:\n    $$ \\lambda_u = \\lambda_{u_0} \\exp\\left(-\\frac{u-u_0}{\\sigma}\\right) $$\n    If $\\xi < 0$ and $u-u_0 \\ge -\\sigma/\\xi$, then $\\lambda_u = 0$.\n\n4.  **Probability of the Extreme Event:** The event $E = \\{\\max_{t\\in\\{1,2,\\dots,D\\}} R(t)>u\\}$ is equivalent to the event that at least one exceedance of the threshold $u$ occurs within the $D$-day window. Let $N_D(u)$ be the number of such exceedances in $D$ days. Since these events follow a homogeneous Poisson process with rate $\\lambda_u$, $N_D(u)$ follows a Poisson distribution with mean $D \\lambda_u$.\n\n    The probability of the event $E$ is $P(N_D(u) > 0)$. It is simpler to calculate the complement:\n    $$ P(E) = 1 - P(N_D(u)=0) $$\n    From the Poisson probability mass function, $P(k) = \\frac{\\mu^k e^{-\\mu}}{k!}$, with $\\mu = D \\lambda_u$:\n    $$ P(N_D(u)=0) = \\frac{(D\\lambda_u)^0 e^{-D\\lambda_u}}{0!} = e^{-D\\lambda_u} $$\n    Therefore, the probability of the extreme event is:\n    $$ P(E) = 1 - e^{-D\\lambda_u} $$\n\n5.  **Final Formulas:** We can now write the expressions for $P_1$ (factual) and $P_0$ (counterfactual) by substituting the respective parameter sets.\n    Let $\\lambda_u^{(i)}$ be the rate of exceeding threshold $u$ in climate $i \\in \\{0, 1\\}$.\n    $$ P_i = 1 - \\exp(-D \\lambda_u^{(i)}) $$\n    where $\\lambda_u^{(i)}$ is calculated using the parameters $(\\lambda_{u_0}^{(i)}, \\xi^{(i)}, \\sigma^{(i)})$.\n\n    The Relative Risk $RR$ is then computed as $RR = P_1 / P_0$, with the special cases for $P_0=0$ handled as specified. For the case $D=0$, the mean of the Poisson process $D\\lambda_u$ is $0$, leading to $P_i = 1 - e^0 = 0$ for both climates. This results in $RR = \\mathrm{NaN}$ as per the problem definition.\n\nThis completes the derivation. The next step is to implement this logic in a program.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the extreme event attribution problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 5,\n            \"u\": 50.0,\n        },\n        # Test case 2\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 10,\n            \"u\": 100.0,\n        },\n        # Test case 3\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 1,\n            \"u\": 30.0,\n        },\n        # Test case 4\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 0,\n            \"u\": 60.0,\n        },\n        # Test case 5\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.30, \"xi\": 0.05, \"sigma\": 18.0},\n            \"counterfactual\": {\"lam_u0\": 0.22, \"xi\": -0.10, \"sigma\": 25.0},\n            \"D\": 7,\n            \"u\": 110.0,\n        },\n        # Test case 6\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.30, \"xi\": 0.05, \"sigma\": 18.0},\n            \"counterfactual\": {\"lam_u0\": 0.22, \"xi\": -0.10, \"sigma\": 25.0},\n            \"D\": 14,\n            \"u\": 280.0,\n        },\n    ]\n\n    def calculate_event_prob(D, u, u0, lam_u0, xi, sigma):\n        \"\"\"\n        Calculates the probability of an extreme event E = {max(R(t)) > u} over D days.\n        \"\"\"\n        if D == 0:\n            return 0.0\n\n        y = u - u0\n        \n        # The POT model is for y >= 0 (since u >= u0)\n        if y < 0:\n            return 0.0\n\n        # Handle GPD upper bound for xi < 0\n        if xi < 0:\n            upper_endpoint_excess = -sigma / xi\n            if y >= upper_endpoint_excess:\n                return 0.0 # Probability of exceeding the upper bound is zero.\n\n        # Calculate the rate of exceedances lambda_u\n        if xi == 0.0:\n            # Exponential case\n            lambda_u = lam_u0 * np.exp(-y / sigma)\n        else:\n            # General case\n            base = 1.0 + xi * y / sigma\n            # The base check should not be necessary due to the endpoint check above,\n            # but it is a good safeguard against floating point inaccuracies.\n            if base <= 0:\n                return 0.0\n            lambda_u = lam_u0 * (base ** (-1.0 / xi))\n        \n        # Calculate event probability from the Poisson process\n        prob_no_event = np.exp(-D * lambda_u)\n        prob_event = 1.0 - prob_no_event\n        \n        return prob_event\n\n    def format_num(n):\n        \"\"\"Formats a number, handling inf and nan correctly.\"\"\"\n        if np.isinf(n):\n            return \"inf\"\n        if np.isnan(n):\n            return \"nan\"\n        return f\"{n:.6f}\"\n\n    results = []\n    for case in test_cases:\n        p1 = calculate_event_prob(case[\"D\"], case[\"u\"], case[\"u0\"], **case[\"factual\"])\n        p0 = calculate_event_prob(case[\"D\"], case[\"u\"], case[\"u0\"], **case[\"counterfactual\"])\n\n        if p0 == 0.0:\n            if p1 > 0.0:\n                rr = np.inf\n            else: # p1 must also be 0 in cases like D=0\n                rr = np.nan\n        else:\n            rr = p1 / p0\n        \n        results.append(f\"[{format_num(p1)},{format_num(p0)},{format_num(rr)}]\")\n    \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}