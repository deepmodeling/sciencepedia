{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个练习是一个基础应用。我们从一个给定的压力场——高斯型压力凹陷——开始，这是一个对孤立涡旋的常见理想化模型。我们的目标是从第一性原理出发，推导出风场，并确定其关键特征：最大风速及其出现的位置。这个练习旨在强化压力梯度力与最终形成的圆周运动之间的直接联系。",
            "id": "4029714",
            "problem": "考虑一个小型轴对称涡旋，其水平流被限制在近地表的一个浅层内，这是罗斯贝数较大且科里奥利力可忽略不计的典型状态。假设流动是稳定的、无粘的、轴对称的，具有纯方位角速度 $V(r)$ 和可忽略的径向速度，并且空气密度 $\\rho$ 在所关注的层内是水平均匀且恒定的。柱坐标半径为 $r$ 的压力场由一个高斯型低压给出：\n$$\np(r)=p_{\\infty}-\\Delta p\\,\\exp\\!\\left(-\\frac{r^{2}}{a^{2}}\\right),\n$$\n其中 $p_{\\infty}$ 是远离涡旋的环境压力，$\\Delta p0$ 是中心压力亏损幅度，而 $a0$ 是一个径向尺度。从应用于流体微元的牛顿第二定律出发，并对稳定、轴对称、无粘且科里奥利力可忽略的涡旋流进行适当简化，推导由给定 $p(r)$ 所隐含的 $V(r)$ 与径向压力梯度之间的旋衡关系，获得用 $\\Delta p$、$\\rho$ 和 $a$ 表示的 $V(r)$ 的闭式表达式，然后确定最大方位角风速 $V_{\\max}$ 和 $V(r)$ 达到峰值时的半径 $r$。将你的最终答案表示为用 $\\Delta p$、$\\rho$ 和 $a$ 表示的闭式解析表达式。不要代入数值，最终答案也不要附带单位；将 $\\Delta p$ 的单位解释为帕斯卡，$\\rho$ 的单位解释为千克/立方米， $a$ 的单位解释为米，$V$ 的单位解释为米/秒。",
            "solution": "该问题要求从第一性原理推导旋衡风方程，并将其应用于指定的压力场，以求出方位角速度剖面、最大风速以及达到该最大值时的半径。\n\n流体运动的控制方程是应用于流体微元的牛顿第二定律，在没有粘性力的情况下，即为欧拉方程：\n$$\n\\rho \\frac{D\\mathbf{u}}{Dt} = -\\nabla p\n$$\n其中 $\\rho$ 是流体密度，$\\mathbf{u}$ 是速度矢量，$\\frac{D}{Dt}$ 是物质导数，$\\nabla p$ 是压力梯度力。问题指明科里奥利力可以忽略不计。\n\n我们在柱坐标系 $(r, \\theta, z)$ 中进行分析，相应的速度分量为 $(u_r, u_\\theta, u_z)$。物质导数由 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$ 给出。对于轴对称流，速度矢量为 $\\mathbf{u}(r, z, t)$。问题陈述流动是稳定的（$\\frac{\\partial}{\\partial t} = 0$）和轴对称的（$\\frac{\\partial}{\\partial \\theta} = 0$）。速度是纯方位角的，因此 $u_r=0$, $u_z=0$，且 $u_\\theta = V(r)$。因此，速度矢量为 $\\mathbf{u} = V(r)\\hat{\\mathbf{\\theta}}$。\n\n在柱坐标系中，加速度矢量 $\\mathbf{a} = \\frac{D\\mathbf{u}}{Dt} = (\\mathbf{u} \\cdot \\nabla)\\mathbf{u}$ 为：\n$$\n\\mathbf{a} = \\left( \\frac{\\partial u_r}{\\partial t} + u_r\\frac{\\partial u_r}{\\partial r} + \\frac{u_\\theta}{r}\\frac{\\partial u_r}{\\partial\\theta} - \\frac{u_\\theta^2}{r} + u_z\\frac{\\partial u_r}{\\partial z} \\right) \\hat{\\mathbf{r}} + \\left( \\frac{\\partial u_\\theta}{\\partial t} + u_r\\frac{\\partial u_\\theta}{\\partial r} + \\frac{u_\\theta}{r}\\frac{\\partial u_\\theta}{\\partial\\theta} + \\frac{u_r u_\\theta}{r} + u_z\\frac{\\partial u_\\theta}{\\partial z} \\right) \\hat{\\mathbf{\\theta}} + \\dots\n$$\n应用给定条件（$u_r = 0$, $u_z=0$, $u_\\theta = V(r)$, $\\frac{\\partial}{\\partial t} = 0$, $\\frac{\\partial}{\\partial \\theta} = 0$），加速度的径向分量 $a_r$ 简化为：\n$$\na_r = - \\frac{V(r)^2}{r}\n$$\n这是指向内部的向心加速度。\n\n欧拉方程的径向分量是 $\\rho a_r = -(\\nabla p)_r$。由于压力仅是半径的函数，$p=p(r)$，径向压力梯度为 $\\frac{\\partial p}{\\partial r} = \\frac{dp}{dr}$。因此方程变为：\n$$\n\\rho \\left( - \\frac{V(r)^2}{r} \\right) = - \\frac{dp}{dr}\n$$\n这简化为旋衡平衡方程，该方程关联了单位体积的离心力与单位体积的压力梯度力：\n$$\n\\frac{V(r)^2}{r} = \\frac{1}{\\rho} \\frac{dp}{dr}\n$$\n接下来，我们使用给定的压力场：\n$$\np(r) = p_{\\infty} - \\Delta p \\exp\\left(-\\frac{r^2}{a^2}\\right)\n$$\n我们计算 $p(r)$ 关于 $r$ 的导数：\n$$\n\\frac{dp}{dr} = \\frac{d}{dr} \\left( p_{\\infty} - \\Delta p \\exp\\left(-\\frac{r^2}{a^2}\\right) \\right) = - \\Delta p \\cdot \\exp\\left(-\\frac{r^2}{a^2}\\right) \\cdot \\left(-\\frac{2r}{a^2}\\right)\n$$\n$$\n\\frac{dp}{dr} = \\frac{2 \\Delta p \\, r}{a^2} \\exp\\left(-\\frac{r^2}{a^2}\\right)\n$$\n将这个压力梯度的表达式代入旋衡平衡方程得到：\n$$\n\\frac{V(r)^2}{r} = \\frac{1}{\\rho} \\left( \\frac{2 \\Delta p \\, r}{a^2} \\exp\\left(-\\frac{r^2}{a^2}\\right) \\right)\n$$\n解出 $V(r)^2$：\n$$\nV(r)^2 = \\frac{2 \\Delta p \\, r^2}{\\rho a^2} \\exp\\left(-\\frac{r^2}{a^2}\\right)\n$$\n方位角风速 $V(r)$ 通过取正平方根得到（因为速率是一个非负标量）：\n$$\nV(r) = \\sqrt{\\frac{2 \\Delta p}{\\rho a^2}} \\cdot r \\cdot \\exp\\left(-\\frac{r^2}{2a^2}\\right)\n$$\n为了求最大方位角风速 $V_{\\max}$，我们必须找到使 $V(r)$ 达到最大值的半径 $r$。这发生在导数 $\\frac{dV}{dr}$ 为零的地方。计算上更简单的方法是求 $V(r)^2$ 的最大值，对于 $V(r)  0$，这与 $V(r)$ 的最大值发生在相同的半径处。令 $f(r) = V(r)^2$。\n$$\nf(r) = \\frac{2 \\Delta p}{\\rho a^2} r^2 \\exp\\left(-\\frac{r^2}{a^2}\\right)\n$$\n我们使用乘法法则对 $f(r)$ 关于 $r$ 求导：\n$$\n\\frac{df}{dr} = \\frac{2 \\Delta p}{\\rho a^2} \\left[ (2r) \\exp\\left(-\\frac{r^2}{a^2}\\right) + r^2 \\cdot \\exp\\left(-\\frac{r^2}{a^2}\\right) \\cdot \\left(-\\frac{2r}{a^2}\\right) \\right]\n$$\n令 $\\frac{df}{dr}=0$ 以寻找临界点：\n$$\n\\frac{4 \\Delta p \\, r}{\\rho a^2} \\exp\\left(-\\frac{r^2}{a^2}\\right) \\left[ 1 - \\frac{r^2}{a^2} \\right] = 0\n$$\n对于非平凡涡旋（$r  0$，$\\Delta p  0$），方括号中的项必须为零：\n$$\n1 - \\frac{r^2}{a^2} = 0 \\implies r^2 = a^2\n$$\n由于半径 $r$ 和尺度长度 $a$ 都为正，速度在以下半径处达到最大值：\n$$\nr = a\n$$\n最后，我们通过将 $r=a$ 代入 $V(r)$ 的表达式来求最大风速 $V_{\\max}$：\n$$\nV_{\\max} = V(a) = \\sqrt{\\frac{2 \\Delta p}{\\rho a^2}} \\cdot a \\cdot \\exp\\left(-\\frac{a^2}{2a^2}\\right)\n$$\n$$\nV_{\\max} = \\sqrt{\\frac{2 \\Delta p}{\\rho}} \\frac{a}{a} \\exp\\left(-\\frac{1}{2}\\right)\n$$\n$$\nV_{\\max} = \\sqrt{\\frac{2 \\Delta p}{\\rho}} \\exp\\left(-\\frac{1}{2}\\right) = \\sqrt{\\frac{2 \\Delta p}{\\rho e}}\n$$\n因此，最大方位角风速为 $V_{\\max} = \\sqrt{\\frac{2 \\Delta p}{\\rho e}}$，并且它发生在半径 $r=a$ 处。",
            "answer": "$$\n\\boxed{V_{\\max} = \\sqrt{\\frac{2 \\Delta p}{\\rho e}}, \\quad r_{\\max} = a}\n$$"
        },
        {
            "introduction": "这个练习将我们的重点从纯理论推导转向在数值天气预报（NWP）中的实际应用。在模型中，压力场有时会产生不切实际的梯度，导致非物理的风速。本练习探讨如何利用旋衡风平衡来确定涡旋核心边缘允许的最大压力梯度，以防止风速超过物理上合理的阈值。",
            "id": "4029676",
            "problem": "考虑一个用于数值天气预报（NWP）和气候模型中的理想化轴对称涡旋，以在没有地球自转的情况下测试小尺度平衡约束。在近地表层，流动是稳定的、无粘性的、近似不可压缩的，并且由于涡旋核心的罗斯贝数 $\\mathrm{Ro}$ 很大，科里奥利效应可以忽略不计。使用柱坐标系 $(r,\\theta,z)$，并假设在核心附近，压力分布在径向上是平坦的，并且可以由以下主导项表示\n$$\np(r) = p_c + \\frac{1}{2}\\,\\alpha\\,r^{2}, \\quad \\text{for } 0 \\le r \\le r_c,\n$$\n其中 $p_c$ 是中心压力，$\\alpha$ 是一个常数曲率参数，$r_c$ 是平坦核心近似不再有效的核心半径。在核心内部，假设径向速度可以忽略不计，$v_r \\approx 0$，切向速度 $v_{\\theta}(r)$ 是有限且连续的。\n\n从应用于柱坐标系中径向动量方程的牛顿第二定律出发，并忽略科里奥利项和摩擦项，推导稳定圆周运动中径向压力梯度 $\\partial p/\\partial r$ 与切向风速 $v_{\\theta}$ 之间的关系。利用这个关系，确定在平坦核心边缘 $r=r_c$ 处，径向压力梯度必须有多小，以确保气旋风平衡的切向风速不超过模型系统认为物理上可接受的预设上限 $V_{\\text{thr}}$。\n\n使用以下参数值：空气密度 $\\rho = 1.15\\,\\text{kg}\\,\\text{m}^{-3}$，核心半径 $r_c = 200\\,\\text{m}$，以及最大可接受风速 $V_{\\text{thr}} = 110\\,\\text{m}\\,\\text{s}^{-1}$。将您计算出的在 $r=r_c$ 处的径向压力梯度数值界限以帕斯卡/米为单位表示，并将您的答案四舍五入到三位有效数字。你的最终答案必须是一个实数。",
            "solution": "问题陈述经评估有效。它在科学上基于流体动力学原理，特别是气旋风平衡，并且问题设定良好，为求得唯一解提供了所有必要的参数。\n\n第一步是推导在没有科里奥利力的情况下，稳定、圆形、无粘性流动的控制方程。这由柱坐标系 $(r, \\theta, z)$ 中的动量方程的径向分量（牛顿第二定律的一个应用）来描述。对于密度为 $\\rho$ 的流体，该方程的一般形式是：\n$$\n\\frac{\\partial v_r}{\\partial t} + v_r \\frac{\\partial v_r}{\\partial r} + \\frac{v_{\\theta}}{r} \\frac{\\partial v_r}{\\partial \\theta} - \\frac{v_{\\theta}^2}{r} + v_z \\frac{\\partial v_r}{\\partial z} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial r}\n$$\n其中 $v_r$、$v_{\\theta}$ 和 $v_z$ 分别是径向、切向（方位角）和垂直方向的速度分量，$p$ 是压力。如问题所述，科里奥利项和摩擦项已被忽略。\n\n我们应用为理想化涡旋给出的条件：\n1.  流动是稳定的，因此所有时间导数均为零：$\\frac{\\partial}{\\partial t} = 0$。\n2.  涡旋是轴对称的，因此在方位角方向上没有变化：$\\frac{\\partial}{\\partial \\theta} = 0$。\n3.  径向速度可以忽略不计：$v_r \\approx 0$。这意味着涉及 $v_r$ 及其导数的项，例如 $\\frac{\\partial v_r}{\\partial t}$、$v_r \\frac{\\partial v_r}{\\partial r}$ 和 $\\frac{v_{\\theta}}{r} \\frac{\\partial v_r}{\\partial \\theta}$ 均为零。我们还假设垂直运动不引起径向加速度，因此 $v_z \\frac{\\partial v_r}{\\partial z} = 0$。\n\n将这些简化应用于径向动量方程，使其简化为单位质量的离心力（向外）和单位质量的压力梯度力（向内）之间的平衡。\n$$\n- \\frac{v_{\\theta}^2}{r} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial r}\n$$\n重新整理这个方程，得到气旋风平衡关系式：\n$$\n\\frac{\\partial p}{\\partial r} = \\frac{\\rho v_{\\theta}^2}{r}\n$$\n这个基本方程将径向压力梯度与切向速度 $v_{\\theta}$ 和半径 $r$ 联系起来。它表明，需要一个正的径向压力梯度（压力向外增加）来维持圆周运动。\n\n问题要求在涡旋核心的边缘 $r=r_c$ 处，切向风速 $v_{\\theta}(r_c)$ 不超过预设的阈值 $V_{\\text{thr}}$。这可以表示为一个不等式：\n$$\nv_{\\theta}(r_c) \\le V_{\\text{thr}}\n$$\n我们可以使用在 $r=r_c$ 处求值的气旋风平衡方程，将这个对速度的约束转化为对该位置径向压力梯度的约束，我们将其表示为 $(\\frac{\\partial p}{\\partial r})_{r_c}$。\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{r_c} = \\frac{\\rho \\, v_{\\theta}(r_c)^2}{r_c}\n$$\n代入 $v_{\\theta}(r_c)$ 的不等式：\n$$\nv_{\\theta}(r_c)^2 \\le V_{\\text{thr}}^2\n$$\n因此，在 $r=r_c$ 处的径向压力梯度必须满足：\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{r_c} \\le \\frac{\\rho V_{\\text{thr}}^2}{r_c}\n$$\n问题要求的是径向压力梯度的极限，这对应于不违反风速约束的最大允许值。这个上限是：\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{\\text{max}} = \\frac{\\rho V_{\\text{thr}}^2}{r_c}\n$$\n给定以下参数值：\n-   空气密度, $\\rho = 1.15\\,\\text{kg}\\,\\text{m}^{-3}$\n-   核心半径, $r_c = 200\\,\\text{m}$\n-   最大可接受风速, $V_{\\text{thr}} = 110\\,\\text{m}\\,\\text{s}^{-1}$\n\n将这些值代入最大压力梯度的表达式中：\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{\\text{max}} = \\frac{(1.15\\,\\text{kg}\\,\\text{m}^{-3}) \\times (110\\,\\text{m}\\,\\text{s}^{-1})^2}{200\\,\\text{m}}\n$$\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{\\text{max}} = \\frac{1.15 \\times 12100}{200} \\, \\frac{\\text{kg} \\cdot \\text{m}^2 \\cdot \\text{s}^{-2}}{\\text{m}^3 \\cdot \\text{m}}\n$$\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{\\text{max}} = \\frac{13915}{200} \\, \\text{kg}\\,\\text{m}^{-2}\\,\\text{s}^{-2}\n$$\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{\\text{max}} = 69.575 \\, \\text{Pa}\\,\\text{m}^{-1}\n$$\n问题要求最终答案四舍五入到三位有效数字。\n$$\n\\left(\\frac{\\partial p}{\\partial r}\\right)_{\\text{max}} \\approx 69.6 \\, \\text{Pa}\\,\\text{m}^{-1}\n$$\n这是在 $r=r_c$ 处，为确保切向风速不超过指定阈值，径向压力梯度可以具有的最大值。压力的显式分布形式 $p(r) = p_c + \\frac{1}{2}\\,\\alpha\\,r^{2}$ 与此分析一致，因为它意味着径向压力梯度为 $\\frac{\\partial p}{\\partial r} = \\alpha r$，在 $r=r_c$ 处可以将其设置为此极限值。",
            "answer": "$$\\boxed{69.6}$$"
        },
        {
            "introduction": "最后的练习将解析理论与计算科学相结合，这是建模人员的一项关键技能。在这里，我们将设计一个完整的“人造解方法”（method of manufactured solutions）测试案例。通过从一个选定的解析风场剖面出发，我们推导出相应的压力场，然后概述如何使用这个精确解来验证数值模型中压力梯度计算的准确性。这个练习展示了理论概念如何被用来确保复杂计算机模拟的可靠性。",
            "id": "4029723",
            "problem": "考虑一个柱坐标系下的稳态、无粘性、轴对称流动，其切向速度为 $V(r)$，压力为 $p(r)$，密度为常数 $\\rho_0$。忽略所有外力，包括科里奥利力，并假设没有径向或垂直运动。严格从牛顿第二定律和物质加速度的定义出发，构建此轴对称流动的控制径向动量平衡方程。然后，通过选择一个在 $r=0$ 处有限、对所有 $r \\ge 0$ 可微、且当 $r \\to \\infty$ 时单调衰减的光滑解析切向速度 $V(r)$，提出一个诊断测试用例。使用所选的 $V(r)$，推导出一个解析压力分布 $p(r)$，该分布满足密度为常数 $\\rho_0$ 的正压流体在径向动量方程所蕴含的稳态平衡。在轴心和有限外半径 $R_{\\text{out}}$ 处指定物理上一致的边界条件，并定义可用于数值评估的模型验证定量度量。\n\n您提出的诊断必须遵循以下要求：\n\n- 解析切向速度必须定义为 $V(r) = V_0 \\frac{r}{a} \\exp\\!\\left(-\\frac{r}{a}\\right)$，其中 $V_0$ 和 $a$ 是正常数，单位分别为 $\\mathrm{m/s}$ 和 $\\mathrm{m}$。\n- 密度必须为常数且等于 $\\rho_0$（单位 $\\mathrm{kg/m^3}$），且外边界压力必须满足 $p(R_{\\text{out}}) = p_\\infty$（单位 $\\mathrm{Pa}$）。\n- 径向网格必须在 $[0, R_{\\text{out}}]$ 上是均匀的，有 $N$ 个点，其中 $N \\ge 128$ 是一个整数。\n- 在 $r=0$ 处指定轴心正则性边界条件，以确保加速度和梯度是有限的。\n- 推导与控制平衡和边界条件 $p(R_{\\text{out}})=p_\\infty$ 一致的 $p(r)$ 解析表达式。\n- 定义明确的数值验证度量：\n  1. 使用网格上对 $\\frac{dp}{dr}$ 的二阶有限差分近似计算出的旋衡平衡的均方根残差 $L_2$，\n  2. 网格上的最大绝对残差 $L_\\infty$，以及\n  3. 通过将 $N$ 加倍（即比较 $N$ 和 $2N$）计算出的观测收敛阶 $q$，$q = \\log_2\\!\\left(\\frac{L_2(N)}{L_2(2N)}\\right)$。\n- 残差必须按 $R(r_i) = \\frac{V(r_i)^2}{r_i} - \\frac{1}{\\rho_0}\\left.\\frac{dp}{dr}\\right|_{\\text{FD}}(r_i)$ 计算，适用于所有网格点 $r_i$，并在边界处使用合适的二阶单边公式。在 $r=0$ 处，使用与极限一致的表达式以避免除以零。\n\n单位和输出规格：\n- 以 $\\mathrm{m/s^2}$ 为单位报告 $L_2$ 和 $L_\\infty$，$q$ 为无量纲量。\n- 不涉及角度；无需角度单位。\n- 您的程序必须为以下每个测试用例计算这些度量：\n  1. 用例 A: $V_0 = 50$ $\\mathrm{m/s}$, $a = 10000$ $\\mathrm{m}$, $R_{\\text{out}} = 100000$ $\\mathrm{m}$, $\\rho_0 = 1.2$ $\\mathrm{kg/m^3}$, $p_\\infty = 100000$ $\\mathrm{Pa}$, $N = 512$。\n  2. 用例 B: $V_0 = 80$ $\\mathrm{m/s}$, $a = 5000$ $\\mathrm{m}$, $R_{\\text{out}} = 30000$ $\\mathrm{m}$, $\\rho_0 = 1.2$ $\\mathrm{kg/m^3}$, $p_\\infty = 100000$ $\\mathrm{Pa}$, $N = 256$。\n  3. 用例 C: $V_0 = 10$ $\\mathrm{m/s}$, $a = 25000$ $\\mathrm{m}$, $R_{\\text{out}} = 200000$ $\\mathrm{m}$, $\\rho_0 = 1.0$ $\\mathrm{kg/m^3}$, $p_\\infty = 101325$ $\\mathrm{Pa}$, $N = 512$。\n  4. 用例 D: $V_0 = 60$ $\\mathrm{m/s}$, $a = 8000$ $\\mathrm{m}$, $R_{\\text{out}} = 16000$ $\\mathrm{m}$, $\\rho_0 = 1.2$ $\\mathrm{kg/m^3}$, $p_\\infty = 100000$ $\\mathrm{Pa}$, $N = 128$。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[result1,result2,result3]$）。汇总输出必须按 $[L_2^{(A)},L_\\infty^{(A)},q^{(A)},L_2^{(B)},L_\\infty^{(B)},q^{(B)},L_2^{(C)},L_\\infty^{(C)},q^{(C)},L_2^{(D)},L_\\infty^{(D)},q^{(D)}]$ 的顺序排列。\n\n确保所有参数和单位的科学真实性和内部一致性。您的推导必须仅使用基本定律和核心定义，避免使用简便公式。数值实现必须是自包含的，并且不需要任何外部输入。",
            "solution": "用户提供的问题已经过验证，被确定为一个有效的科学问题。它以流体动力学原理为科学基础，是良态的，具有唯一解的充分条件，并且其表述是客观的。所有参数在物理上都是现实的，并且在量纲上是一致的。该问题要求从第一性原理推导旋衡平衡，并构建一个相应的数值诊断测试用例，这是验证计算流体动力学模型的标准程序。\n\n控制径向动量平衡的推导始于连续介质的牛顿第二定律（柯西动量方程）。对于密度为 $\\rho$、速度场为 $\\vec{u}$、受压力场 $p$ 作用且无外部体力的无粘性流体，其方程为：\n$$\n\\rho \\frac{D\\vec{u}}{Dt} = -\\nabla p\n$$\n其中 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\vec{u} \\cdot \\nabla$ 是物质导数。在柱坐标系 $(r, \\theta, z)$ 中，速度矢量为 $\\vec{u} = u_r \\hat{r} + u_\\theta \\hat{\\theta} + u_z \\hat{z}$。加速度的径向分量由下式给出：\n$$\na_r = \\frac{\\partial u_r}{\\partial t} + u_r \\frac{\\partial u_r}{\\partial r} + \\frac{u_\\theta}{r} \\frac{\\partial u_r}{\\partial \\theta} - \\frac{u_\\theta^2}{r} + u_z \\frac{\\partial u_r}{\\partial z}\n$$\n压力梯度为 $\\nabla p = \\frac{\\partial p}{\\partial r}\\hat{r} + \\frac{1}{r}\\frac{\\partial p}{\\partial \\theta}\\hat{\\theta} + \\frac{\\partial p}{\\partial z}\\hat{z}$。因此，动量方程的径向分量为：\n$$\n\\rho a_r = -\\frac{\\partial p}{\\partial r}\n$$\n我们应用问题中指定的条件：\n1.  稳态流: $\\frac{\\partial}{\\partial t} = 0$。\n2.  轴对称流: $\\frac{\\partial}{\\partial \\theta} = 0$。这意味着压力也与 $\\theta$ 无关，即 $p = p(r, z)$。\n3.  无径向或垂直运动: $u_r = 0$ 和 $u_z = 0$。\n4.  切向速度仅是半径的函数: $u_\\theta = V(r)$。\n5.  密度为常数: $\\rho = \\rho_0$。\n\n在这些条件下，垂直动量方程变为 $\\rho_0 a_z = -\\frac{\\partial p}{\\partial z}$。由于 $u_z = 0$，则 $a_z = 0$，这意味着 $\\frac{\\partial p}{\\partial z} = 0$。因此，压力仅是半径的函数，即 $p = p(r)$。\n\n将这些约束条件代入径向加速度公式，得到：\n$$\na_r = 0 + 0 \\cdot \\frac{\\partial 0}{\\partial r} + \\frac{V(r)}{r} \\cdot 0 - \\frac{V(r)^2}{r} + 0 \\cdot \\frac{\\partial 0}{\\partial z} = -\\frac{V(r)^2}{r}\n$$\n于是，径向动量方程简化为：\n$$\n\\rho_0 \\left( -\\frac{V(r)^2}{r} \\right) = -\\frac{dp}{dr}\n$$\n这就得到了旋衡平衡方程，它将单位体积的离心力与压力梯度力相等：\n$$\n\\frac{1}{\\rho_0} \\frac{dp}{dr} = \\frac{V(r)^2}{r}\n$$\n接下来，我们为指定的切向速度剖面 $V(r) = V_0 \\frac{r}{a} \\exp(-\\frac{r}{a})$ 推导解析压力分布。将其代入平衡方程：\n$$\n\\frac{dp}{dr} = \\rho_0 \\frac{1}{r} \\left( V_0 \\frac{r}{a} \\exp\\left(-\\frac{r}{a}\\right) \\right)^2 = \\rho_0 \\frac{V_0^2 r^2}{r a^2} \\exp\\left(-\\frac{2r}{a}\\right) = \\frac{\\rho_0 V_0^2}{a^2} r \\exp\\left(-\\frac{2r}{a}\\right)\n$$\n为了求得 $p(r)$，我们对该表达式关于 $r$ 进行积分，并应用边界条件 $p(R_{\\text{out}}) = p_\\infty$。\n$$\n\\int_{r}^{R_{\\text{out}}} \\frac{dp}{dr'} dr' = p(R_{\\text{out}}) - p(r) = p_\\infty - p(r)\n$$\n因此，$p(r) = p_\\infty - \\int_{r}^{R_{\\text{out}}} \\frac{\\rho_0 V_0^2}{a^2} r' \\exp\\left(-\\frac{2r'}{a}\\right) dr'$。该积分使用分部积分法求解。令 $u = r'$ 且 $dv = \\exp\\left(-\\frac{2r'}{a}\\right)dr'$。则 $du = dr'$ 且 $v = -\\frac{a}{2} \\exp\\left(-\\frac{2r'}{a}\\right)$。\n\\begin{align*}\n\\int r' \\exp\\left(-\\frac{2r'}{a}\\right) dr' = r' \\left(-\\frac{a}{2} \\exp\\left(-\\frac{2r'}{a}\\right)\\right) - \\int \\left(-\\frac{a}{2} \\exp\\left(-\\frac{2r'}{a}\\right)\\right) dr' \\\\\n= -\\frac{ar'}{2} \\exp\\left(-\\frac{2r'}{a}\\right) - \\frac{a^2}{4} \\exp\\left(-\\frac{2r'}{a}\\right) \\\\\n= -\\frac{a^2}{4} \\left(1 + \\frac{2r'}{a}\\right) \\exp\\left(-\\frac{2r'}{a}\\right)\n\\end{align*}\n计算从 $r$ 到 $R_{\\text{out}}$ 的定积分：\n$$\n\\int_{r}^{R_{\\text{out}}} (\\dots) dr' = \\left[ -\\frac{a^2}{4} \\left(1 + \\frac{2r'}{a}\\right) \\exp\\left(-\\frac{2r'}{a}\\right) \\right]_r^{R_{\\text{out}}} = -\\frac{a^2}{4} \\left[ \\left(1+\\frac{2R_{\\text{out}}}{a}\\right)e^{-\\frac{2R_{\\text{out}}}{a}} - \\left(1+\\frac{2r}{a}\\right)e^{-\\frac{2r}{a}} \\right]\n$$\n将此结果代回 $p(r)$ 的表达式：\n$$\np(r) = p_\\infty - \\frac{\\rho_0 V_0^2}{a^2} \\left( -\\frac{a^2}{4} \\left[ \\left(1+\\frac{2R_{\\text{out}}}{a}\\right)e^{-\\frac{2R_{\\text{out}}}{a}} - \\left(1+\\frac{2r}{a}\\right)e^{-\\frac{2r}{a}} \\right] \\right)\n$$\n最终压力的解析表达式为：\n$$\np(r) = p_\\infty + \\frac{\\rho_0 V_0^2}{4} \\left[ \\left(1 + \\frac{2R_{\\text{out}}}{a}\\right)e^{-\\frac{2R_{\\text{out}}}{a}} - \\left(1 + \\frac{2r}{a}\\right)e^{-\\frac{2r}{a}} \\right]\n$$\n在 $r=0$ 处的轴心正则性条件要求梯度和加速度是有限的。\n$\\lim_{r\\to 0} \\frac{V(r)^2}{r} = \\lim_{r\\to 0} \\frac{V_0^2 r}{a^2}\\exp(-\\frac{2r}{a}) = 0$。\n$\\lim_{r\\to 0} \\frac{1}{\\rho_0}\\frac{dp}{dr} = \\lim_{r\\to 0} \\frac{V_0^2 r}{a^2}\\exp(-\\frac{2r}{a}) = 0$。\n两项在轴心处都为零，满足正则性条件。\n\n对于数值验证，旋衡平衡的残差 $R(r_i)$ 在一个均匀网格 $r_i = i \\Delta r$（其中 $i=0, \\dots, N-1$ 且 $\\Delta r = R_{\\text{out}}/(N-1)$）上计算：\n$$\nR(r_i) = \\frac{V(r_i)^2}{r_i} - \\frac{1}{\\rho_0}\\left.\\frac{dp}{dr}\\right|_{\\text{FD}}(r_i)\n$$\n在 $r_0=0$ 处，项 $\\frac{V(r)^2}{r}$ 的值为 $0$。压力梯度 $\\frac{dp}{dr}$ 使用二阶有限差分进行近似：\n-   内部点 ($0  i  N-1$): 中心差分 $\\left.\\frac{dp}{dr}\\right|_{i} \\approx \\frac{p_{i+1} - p_{i-1}}{2\\Delta r}$。\n-   左边界 ($i=0$): 向前差分 $\\left.\\frac{dp}{dr}\\right|_{0} \\approx \\frac{-3p_0 + 4p_1 - p_2}{2\\Delta r}$。\n-   右边界 ($i=N-1$): 向后差分 $\\left.\\frac{dp}{dr}\\right|_{N-1} \\approx \\frac{3p_{N-1} - 4p_{N-2} + p_{N-3}}{2\\Delta r}$。\n\n验证度量定义为：\n1.  均方根残差: $L_2 = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} R(r_i)^2}$。\n2.  最大绝对残差: $L_\\infty = \\max_{i} |R(r_i)|$。\n3.  观测收敛阶: $q = \\log_2\\left(\\frac{L_2(N)}{L_2(2N)}\\right)$。\n\n提供的 Python 代码实现了这个诊断测试。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the cyclostrophic balance diagnostic test case problem.\n    \"\"\"\n    test_cases = [\n        {'V0': 50, 'a': 10000, 'Rout': 100000, 'rho0': 1.2, 'p_inf': 100000, 'N': 512, 'id': 'A'},\n        {'V0': 80, 'a': 5000, 'Rout': 30000, 'rho0': 1.2, 'p_inf': 100000, 'N': 256, 'id': 'B'},\n        {'V0': 10, 'a': 25000, 'Rout': 200000, 'rho0': 1.0, 'p_inf': 101325, 'N': 512, 'id': 'C'},\n        {'V0': 60, 'a': 8000, 'Rout': 16000, 'rho0': 1.2, 'p_inf': 100000, 'N': 128, 'id': 'D'}\n    ]\n\n    def calculate_metrics(V0, a, Rout, rho0, p_inf, N):\n        \"\"\"\n        Calculates L2 and L-infinity norms of the residual for a given set of parameters and grid size N.\n        \"\"\"\n        # 1. Setup grid\n        dr = Rout / (N - 1)\n        r = np.linspace(0, Rout, N)\n\n        # 2. Compute analytic velocity and pressure fields\n        V = V0 * (r / a) * np.exp(-r / a)\n        \n        # Analytic pressure using the derived formula\n        p_term_Rout = (1 + 2 * Rout / a) * np.exp(-2 * Rout / a)\n        p_term_r = (1 + 2 * r / a) * np.exp(-2 * r / a)\n        p = p_inf + (rho0 * V0**2 / 4) * (p_term_Rout - p_term_r)\n\n        # 3. Compute pressure gradient using second-order finite differences\n        dpdr_fd = np.zeros(N)\n        \n        # Central difference for interior points\n        if N > 2:\n            dpdr_fd[1:-1] = (p[2:] - p[:-2]) / (2 * dr)\n        \n        # Second-order forward difference at the left boundary (r=0)\n        if N > 2:\n            dpdr_fd[0] = (-3 * p[0] + 4 * p[1] - p[2]) / (2 * dr)\n        elif N == 2: # Fallback to first order if N is too small\n            dpdr_fd[0] = (p[1] - p[0]) / dr\n\n        # Second-order backward difference at the right boundary\n        if N > 2:\n            dpdr_fd[-1] = (3 * p[-1] - 4 * p[-2] + p[-3]) / (2 * dr)\n        elif N == 2: # Fallback to first order if N is too small\n             dpdr_fd[-1] = (p[-1] - p[-2]) / dr\n\n        # 4. Compute the residual of the cyclostrophic balance equation\n        # Centrifugal term V^2/r\n        centrifugal_term = np.zeros(N)\n        # Avoid division by zero at r=0, where the limit is 0\n        if N > 1:\n            centrifugal_term[1:] = V[1:]**2 / r[1:]\n        \n        # Residual R(r) = V^2/r - (1/rho0) * dp/dr\n        residual = centrifugal_term - (1/rho0) * dpdr_fd\n\n        # 5. Compute L2 and L_infinity norms of the residual\n        L2 = np.sqrt(np.mean(residual**2))\n        L_inf = np.max(np.abs(residual))\n        \n        return L2, L_inf\n\n    results = []\n    for case in test_cases:\n        V0, a, Rout, rho0, p_inf, N = case['V0'], case['a'], case['Rout'], case['rho0'], case['p_inf'], case['N']\n\n        # Calculate metrics for N\n        L2_N, L_inf_N = calculate_metrics(V0, a, Rout, rho0, p_inf, N)\n        \n        # Calculate L2 metric for 2N to find convergence order\n        L2_2N, _ = calculate_metrics(V0, a, Rout, rho0, p_inf, 2 * N)\n        \n        # Calculate observed order of convergence, q\n        # Handle potential division by zero if L2_2N is close to machine precision\n        if L2_2N > 0:\n            q = np.log2(L2_N / L2_2N)\n        else:\n            q = np.inf  # Or some other indicator of extremely fast convergence\n\n        results.extend([L2_N, L_inf_N, q])\n\n    # Format the output as a single string\n    output_str = \",\".join([f\"{val:.10g}\" for val in results])\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}