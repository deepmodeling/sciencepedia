{
    "hands_on_practices": [
        {
            "introduction": "为了在实践中有效地运用位涡（Potential Vorticity, $PV$），我们首先需要将其基本矢量定义转化为更适用于大气科学的形式。本练习将指导您完成在气压坐标系下 $PV$ 方程的关键推导，这是天气学分析中的一个标准工具。通过这项练习，您将对涡度和静力稳定度如何结合定义气块的 $PV$ 建立起坚实的基础，并对 $PV$ 在真实大气中的量级获得直观感受。",
            "id": "4077864",
            "problem": "在数值天气预报（Numerical Weather Prediction (NWP)）和气候模拟中，气压坐标系下的埃特尔位涡（Potential Vorticity (PV)）在静力、绝热和无摩擦条件下是一个物质守恒的示踪物。从埃特尔位涡的基本定义出发，\n$$\nq \\equiv \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta,\n$$\n其中 $\\rho$ 是质量密度，$\\boldsymbol{\\omega}_{a}$ 是绝对涡度矢量，$\\theta$ 是位温，推导一个适用于等压面上大尺度静力平衡大气的表达式，其中可以忽略 $\\theta$ 的水平梯度以及评估点处的非地转垂直切变贡献。然后，使用该表达式计算在纬度 $\\phi = 45^{\\circ}\\mathrm{N}$ 的 $p = 500$ hPa 等压面上 $q$ 的值，给定条件如下：\n- 相对涡度 $\\zeta = +5.00 \\times 10^{-5}$ s$^{-1}$，\n- 科里奥利参数 $f = +1.03 \\times 10^{-4}$ s$^{-1}$，\n- 在 $p = 500$ hPa 处，气压形式的局地静力稳定度为 $\\frac{\\partial \\theta}{\\partial p} = -1.00 \\times 10^{-3}$ K Pa$^{-1}$，\n- 重力加速度 $g = 9.81$ m s$^{-2}$。\n\n接下来，通过考虑在相同位置和气压层，$\\frac{\\partial \\theta}{\\partial p}$ 的量值均匀增加 $25$%，且符号约定不变，来分析 $q$ 对层结变化的敏感性。根据你的分析，确定此变化后新的 $q$ 值。\n\n所有位涡值均以位涡单位（Potential Vorticity Unit (PVU)）表示，其中 $1$ PVU $= 10^{-6}$ K m$^{2}$ kg$^{-1}$ s$^{-1}$。将你最终报告的新 PV 值四舍五入至四位有效数字。",
            "solution": "该问题要求在特定的大尺度大气近似条件下，推导埃特尔位涡（PV）在气压坐标系下的简化表达式，然后使用该表达式计算一个数值，并分析其对大气稳定度变化的敏感性。\n\n首先，我将验证问题陈述。\n\n### 步骤1：提取给定条件\n-   埃特尔位涡的基本定义：$q \\equiv \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta$\n-   $\\rho$：质量密度\n-   $\\boldsymbol{\\omega}_{a}$：绝对涡度矢量\n-   $\\theta$：位温\n-   推导假设：大尺度静力平衡大气、等压面、忽略 $\\theta$ 的水平梯度、忽略非地转垂直切变贡献。\n-   气压层：$p = 500$ hPa\n-   纬度：$\\phi = 45^{\\circ}\\mathrm{N}$\n-   相对涡度：$\\zeta = +5.00 \\times 10^{-5}$ s$^{-1}$\n-   科里奥利参数：$f = +1.03 \\times 10^{-4}$ s$^{-1}$\n-   局地静力稳定度：$\\frac{\\partial \\theta}{\\partial p} = -1.00 \\times 10^{-3}$ K Pa$^{-1}$\n-   重力加速度：$g = 9.81$ m s$^{-2}$\n-   敏感性分析条件：$\\frac{\\partial \\theta}{\\partial p}$ 的量值增加 $25\\%$, 符号不变。\n-   单位转换：$1$ 位涡单位 (PVU) $= 10^{-6}$ K m$^{2}$ kg$^{-1}$ s$^{-1}$\n-   四舍五入要求：最终的新 PV 值保留四位有效数字。\n\n### 步骤2：使用提取的给定条件进行验证\n该问题具有科学依据。它在地球物理流体动力学和数值天气预报的标准框架内，处理了一个基本量——埃特尔位涡。所要求的推导是该领域广泛使用的标准简化方法。提供的相对涡度、科里奥利参数（与 $45^{\\circ}\\mathrm{N}$ 一致）和静力稳定度的值对于对流层中部而言是物理上现实的。该问题提法得当，提供了所有必要的信息和清晰的指令以得出唯一的解。语言客观而精确。问题自成一体且内部一致。\n\n### 步骤3：结论与行动\n问题有效。我将继续进行解答。\n\n### 第1部分：Ertel PV工作表达式的推導\n\n埃特尔位涡 $q$ 定义为：\n$$q = \\frac{1}{\\rho} \\boldsymbol{\\omega}_a \\cdot \\nabla \\theta$$\n其中 $\\rho$ 是密度，$\\boldsymbol{\\omega}_a$ 是三维绝对涡度矢量，$\\theta$ 是位温。在笛卡尔坐标系中，设 $x, y$ 为水平方向，$z$ 为局地垂直方向，绝对涡度矢量是相对涡度 $\\boldsymbol{\\omega} = \\nabla \\times \\mathbf{u}$ 和行星涡度 $2\\boldsymbol{\\Omega}$ 的和：\n$$\\boldsymbol{\\omega}_a = \\boldsymbol{\\omega} + 2\\boldsymbol{\\Omega}$$\n$\\boldsymbol{\\omega}_a$ 的分量为：\n$$ \\boldsymbol{\\omega}_a = \\left(\\frac{\\partial w}{\\partial y} - \\frac{\\partial v}{\\partial z}\\right)\\mathbf{i} + \\left(2\\Omega\\cos\\phi + \\frac{\\partial u}{\\partial z} - \\frac{\\partial w}{\\partial x}\\right)\\mathbf{j} + \\left(2\\Omega\\sin\\phi + \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}\\right)\\mathbf{k} $$\n其中 $(u, v, w)$ 是风速分量，$\\Omega$ 是地球自转角速度，$\\phi$ 是纬度。我们定义科里奥利参数 $f = 2\\Omega\\sin\\phi$ 和相对涡度的垂直分量 $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$。\n\n位温的梯度是：\n$$ \\nabla\\theta = \\frac{\\partial\\theta}{\\partial x}\\mathbf{i} + \\frac{\\partial\\theta}{\\partial y}\\mathbf{j} + \\frac{\\partial\\theta}{\\partial z}\\mathbf{k} $$\n\n因此，点积 $\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta$ 是：\n$$ \\boldsymbol{\\omega}_a \\cdot \\nabla \\theta = \\left(\\frac{\\partial w}{\\partial y} - \\frac{\\partial v}{\\partial z}\\right)\\frac{\\partial\\theta}{\\partial x} + \\left(2\\Omega\\cos\\phi + \\frac{\\partial u}{\\partial z} - \\frac{\\partial w}{\\partial x}\\right)\\frac{\\partial\\theta}{\\partial y} + (f + \\zeta)\\frac{\\partial\\theta}{\\partial z} $$\n\n对于大尺度、静力平衡运动，垂直速度 $w$ 及其水平导数远小于其他项，可以忽略不计。此外，问题明确指出要忽略位温的水平梯度，即 $\\frac{\\partial\\theta}{\\partial x} \\approx 0$ 和 $\\frac{\\partial\\theta}{\\partial y} \\approx 0$。这一指示也隐含地处理了非地转垂直切变贡献的忽略，该贡献来自于包含 $\\frac{\\partial u}{\\partial z}$ 和 $\\frac{\\partial v}{\\partial z}$ 的项乘以 $\\theta$ 的水平梯度。\n\n应用这些简化，点积简化为其最后一项：\n$$ \\boldsymbol{\\omega}_a \\cdot \\nabla \\theta \\approx (f + \\zeta)\\frac{\\partial\\theta}{\\partial z} $$\n$q$ 的表达式变为：\n$$ q \\approx \\frac{1}{\\rho}(f + \\zeta)\\frac{\\partial\\theta}{\\partial z} $$\n为了用气压坐标表示，我们使用静力平衡方程：\n$$ \\frac{\\partial p}{\\partial z} = -\\rho g $$\n其中 $p$ 是气压，$g$ 是重力加速度。我们还可以使用链式法则将 $\\theta$ 在高度坐标中的垂直导数与其在气壓坐标中的垂直导数联系起来：\n$$ \\frac{\\partial\\theta}{\\partial z} = \\frac{\\partial\\theta}{\\partial p} \\frac{\\partial p}{\\partial z} $$\n将静力平衡方程代入链式法则表达式中得到：\n$$ \\frac{\\partial\\theta}{\\partial z} = \\frac{\\partial\\theta}{\\partial p} (-\\rho g) = -g\\rho\\frac{\\partial\\theta}{\\partial p} $$\n现在，我们将其代回 $q$ 的近似表达式中：\n$$ q \\approx \\frac{1}{\\rho}(f + \\zeta) \\left(-g\\rho\\frac{\\partial\\theta}{\\partial p}\\right) $$\n密度 $\\rho$ 消去，得到在给定近似下，气压坐标中 Ertel PV 的最终工作表达式：\n$$ q = -g(f + \\zeta)\\frac{\\partial\\theta}{\\partial p} $$\n\n### 第2部分：新位涡的计算\n\n题目要求我们计算大气层结增强后位涡的新值 $q_{\\text{new}}$。首先，让我们确定静力稳定度参数 $\\frac{\\partial\\theta}{\\partial p}$ 的新值。\n\n初始值为 $\\left(\\frac{\\partial\\theta}{\\partial p}\\right)_{\\text{initial}} = -1.00 \\times 10^{-3}$ K Pa$^{-1}$。\n该值的量值为 $\\left|\\left(\\frac{\\partial\\theta}{\\partial p}\\right)_{\\text{initial}}\\right| = 1.00 \\times 10^{-3}$ K Pa$^{-1}$。\n这个量值增加了25% ($0.25$)。新的量值为：\n$$ \\left|\\left(\\frac{\\partial\\theta}{\\partial p}\\right)_{\\text{new}}\\right| = (1.00 \\times 10^{-3} \\text{ K Pa}^{-1}) \\times (1 + 0.25) = 1.25 \\times 10^{-3} \\text{ K Pa}^{-1} $$\n问题陈述符号约定不变，所以静力稳定度的新值为：\n$$ \\left(\\frac{\\partial\\theta}{\\partial p}\\right)_{\\text{new}} = -1.25 \\times 10^{-3} \\text{ K Pa}^{-1} $$\n\n现在我们可以使用推导出的公式和给定值来计算 $q_{\\text{new}}$：\n-   $g = 9.81$ m s$^{-2}$\n-   $f = 1.03 \\times 10^{-4}$ s$^{-1}$\n-   $\\zeta = 5.00 \\times 10^{-5}$ s$^{-1}$\n-   $\\left(\\frac{\\partial\\theta}{\\partial p}\\right)_{\\text{new}} = -1.25 \\times 10^{-3}$ K Pa$^{-1}$\n\n绝对涡度为 $\\eta = f + \\zeta = 1.03 \\times 10^{-4} \\text{ s}^{-1} + 5.00 \\times 10^{-5} \\text{ s}^{-1} = 1.53 \\times 10^{-4} \\text{ s}^{-1}$。\n\n代入PV方程：\n$$ q_{\\text{new}} = -g \\eta \\left(\\frac{\\partial\\theta}{\\partial p}\\right)_{\\text{new}} $$\n$$ q_{\\text{new}} = -(9.81 \\text{ m s}^{-2}) (1.53 \\times 10^{-4} \\text{ s}^{-1}) (-1.25 \\times 10^{-3} \\text{ K Pa}^{-1}) $$\n两个负号相互抵消：\n$$ q_{\\text{new}} = (9.81)(1.53)(1.25) \\times 10^{-7} \\text{ K m s}^{-3} \\text{ Pa}^{-1} $$\n为了用标准的PV单位表示，我们利用 $1 \\text{ Pa} = 1 \\text{ kg m}^{-1} \\text{ s}^{-2}$，因此 $1 \\text{ Pa}^{-1} = 1 \\text{ kg}^{-1} \\text{ m s}^{2}$。于是 $q$ 的单位是：\n$$ (\\text{K m s}^{-3}) (\\text{kg}^{-1} \\text{ m s}^{2}) = \\text{K m}^2 \\text{kg}^{-1} \\text{s}^{-1} $$\n这与PV的基本国际单位制（SI）单位相符。\n现在，我们计算数值：\n$$ q_{\\text{new}} = (9.81 \\times 1.53 \\times 1.25) \\times 10^{-7} \\text{ K m}^2 \\text{kg}^{-1} \\text{s}^{-1} $$\n$$ q_{\\text{new}} = 18.761625 \\times 10^{-7} \\text{ K m}^2 \\text{kg}^{-1} \\text{s}^{-1} $$\n题目要求用位涡单位（PVU）表示结果，其中 $1$ PVU $= 10^{-6}$ K m$^2$ kg$^{-1}$ s$^{-1}$。\n$$ q_{\\text{new}} = 1.8761625 \\times 10^{-6} \\text{ K m}^2 \\text{kg}^{-1} \\text{s}^{-1} = 1.8761625 \\text{ PVU} $$\n最后，按要求将结果四舍五入至四位有效数字：\n$$ q_{\\text{new}} \\approx 1.876 \\text{ PVU} $$\n静力稳定度量值的增加（即大气更稳定）导致位涡成比例增加，如推导公式中的线性关系所示。",
            "answer": "$$\n\\boxed{1.876}\n$$"
        },
        {
            "introduction": "位涡（$PV$）的威力在于其能够诊断大气的演变，但这要求我们必须考虑其源和汇。本练习将挑战您运用完整的 $PV$ 倾向方程，去分析非绝热加热对一个大尺度天气系统——大气阻塞——的影响。通过分析潜热释放在动力学上如何改变气流，您将学到如何使用 $PV$ 作为连接热力学和动力学的强大诊断工具。",
            "id": "4012985",
            "problem": "在一个全球大气模型中，一个理想化的中纬度阻塞形势被诊断为在 $500\\,\\mathrm{hPa}$ 高度上一个嵌入在弱斜压性西风急流中的准静止反气旋脊。为评估湿过程在该阻塞的维持和衰减中的作用，请考虑以下基本依据和假设。\n\n- 使用为可压缩、静力平衡大气定义的 Ertel 位涡 (PV)，其表达式为 $q = \\dfrac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta$，其中 $\\rho$ 是密度，$\\boldsymbol{\\omega}_a$ 是绝对涡度矢量，$\\theta$ 是位温。\n- 使用以位温表示的热力学能量方程 $D\\theta/Dt = \\dot{\\theta}$，其中 $\\dot{\\theta}$ 是以位温为单位的非绝热加热率。设凝结潜热的贡献为 $\\dot{\\theta}_{\\mathrm{LH}} = \\dfrac{\\theta}{T}\\,\\dfrac{Q_{\\mathrm{LH}}}{c_p}$，其中 $T$ 是温度，$c_p$ 是定压比热，$Q_{\\mathrm{LH}}$ 是单位质量的潜热加热率。\n- 假设静力平衡和用于解释性标度的类 Boussinesq 近似，使得在中纬度地区 $\\boldsymbol{\\omega}_a \\approx \\hat{\\boldsymbol{k}}\\,(f+\\zeta)$，其中 $f$ 是科里奥利参数，$\\zeta$ 是相对涡度的垂直分量，并且在脊顶附近，垂直变化主导绝对涡度的方向。\n- 在本次诊断中，边界层之上的摩擦力很小，在自由对流层中可以忽略不计。\n\n任务：仅从这些依据出发，推导由潜热加热引起的对 PV 趋势的非绝热贡献，并用 $\\boldsymbol{\\omega}_a$ 和 $\\nabla \\dot{\\theta}_{\\mathrm{LH}}$ 表示。然后，对于一个位于脊西侧的观测到的中尺度潜热加热极大值，其水平加热梯度 $\\nabla_h \\dot{\\theta}_{\\mathrm{LH}}$ 指向东方，且整个对流层上层的垂直加热梯度 $\\partial \\dot{\\theta}_{\\mathrm{LH}}/\\partial z  0$ 的情况，使用您推导的表达式来确定脊内和脊周围 PV 趋势的符号和定性结构。最后，将此非绝热效应与维持阻塞的主要干动力学机制（例如，Rossby 波破碎和涡度通量辐合）进行对比，并指出在这种情况下，潜热加热模式是倾向于维持还是削弱该脊。\n\n哪个选项正确地陈述了由潜热加热引起的非绝热 PV 生成的形式，并将其定性效应与干动力学在对流层阻塞形势的维持和衰减中的作用区分开来？\n\nA. 由潜热加热引起的非绝热 PV 生成为 $Dq/Dt\\big|_{\\mathrm{LH}} = \\dfrac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta}_{\\mathrm{LH}}$。在中纬度地区，当 $\\boldsymbol{\\omega}_a \\approx \\hat{\\boldsymbol{k}}(f+\\zeta)$ 时，正的垂直梯度 $\\partial \\dot{\\theta}_{\\mathrm{LH}}/\\partial z  0$ 会在高空产生正的 PV，这会侵蚀反气旋脊的低 PV 异常，从而有利于阻塞衰减，而干动力学通过近似守恒的 PV、Rossby 波破碎和加强脊的涡度通量辐合来维持阻塞。\n\nB. 由潜热加热引起的非绝热 PV 生成为 $Dq/Dt\\big|_{\\mathrm{LH}} = \\dfrac{1}{\\rho}\\,\\nabla \\cdot \\left(\\dot{\\theta}_{\\mathrm{LH}}\\,\\boldsymbol{\\omega}_a\\right)$，并且无论加热梯度如何，潜热加热总是通过在高空产生负 PV 来维持反气旋，从而补充了干动力学的作用。\n\nC. 潜热加热仅改变静力稳定度，不进入 PV 趋势方程；因此阻塞的维持和衰减纯粹由干动力学（如 Rossby 波破碎）控制，没有直接的非绝热 PV 生成。\n\nD. 由潜热加热引起的非绝热 PV 生成通过 $Dq/Dt\\big|_{\\mathrm{LH}} = \\dfrac{1}{\\rho}\\,(\\nabla \\theta \\times \\nabla_h \\dot{\\theta}_{\\mathrm{LH}})\\cdot \\hat{\\boldsymbol{k}}$ 依赖于水平加热梯度，因此向东的 $\\nabla_h \\dot{\\theta}_{\\mathrm{LH}}$ 会使 PV 梯度变陡并增强阻塞的维持，这与主要作用是混合 PV 和削弱梯度的干动力学相反。",
            "solution": "用户请求分析一个关于湿非绝热过程对大气阻塞形势影响的问题。分析必须从对问题陈述的严格验证开始。\n\n### 步骤 1：提取已知条件\n\n问题陈述提供了以下定义、假设和条件：\n- **系统**: 一个理想化的中纬度阻塞形势，其特征为在 $500\\,\\mathrm{hPa}$ 高度上嵌入在弱斜压性西风急流中的一个准静止反气旋脊。\n- **控制变量**: Ertel 位涡 (PV)，定义为 $q = \\dfrac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta$。\n- **变量**: $\\rho$ 是密度，$\\boldsymbol{\\omega}_a$ 是绝对涡度矢量，$\\theta$ 是位温。\n- **控制方程 (热力学)**: $D\\theta/Dt = \\dot{\\theta}$，其中 $\\dot{\\theta}$ 是非绝热加热率。\n- **潜热贡献**: 来自潜热的 $\\dot{\\theta}$ 部分为 $\\dot{\\theta}_{\\mathrm{LH}} = \\dfrac{\\theta}{T}\\,\\dfrac{Q_{\\mathrm{LH}}}{c_p}$，其中 $T$ 为温度，$c_p$ 为定压比热，$Q_{\\mathrm{LH}}$ 为单位质量的潜热加热率。\n- **假设**:\n    1. 静力平衡。\n    2. 用于中纬度标度的类 Boussinesq 近似：$\\boldsymbol{\\omega}_a \\approx \\hat{\\boldsymbol{k}}\\,(f+\\zeta)$，其中 $f$ 是科里奥利参数，$\\zeta$ 是相对涡度的垂直分量，$\\hat{\\boldsymbol{k}}$ 是垂直单位矢量。这意味着在脊顶附近，垂直变化主导绝对涡度的方向。\n    3. 自由对流层中的摩擦力可以忽略不计。\n- **分析情景**:\n    1. 一个中尺度潜热加热极大值位于脊的西侧。\n    2. 潜热加热的水平梯度 $\\nabla_h \\dot{\\theta}_{\\mathrm{LH}}$ 指向东方。\n    3. 整个对流层上层的潜热加热垂直梯度 $\\partial \\dot{\\theta}_{\\mathrm{LH}}/\\partial z  0$。\n- **任务**:\n    1. 推导潜热加热对 PV 趋势 ($Dq/Dt$) 的非绝热贡献。\n    2. 用 $\\boldsymbol{\\omega}_a$ 和 $\\nabla \\dot{\\theta}_{\\mathrm{LH}}$ 表示此趋势。\n    3. 确定给定情景下 PV 趋势的符号和定性结构。\n    4. 将非绝热效应与干动力学机制进行对比，并确定潜热加热是帮助维持还是削弱脊。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n- **科学基础**: 该问题牢固地植根于地球物理流体动力学的基本原理。Ertel PV 和热力学能量方程的定义是标准的。中纬度阻塞和潜热作用的情景是活跃的研究课题，也是大气科学中公认的概念。该问题是科学上现实的。\n- **适定性**: 该问题的结构能够导出一个唯一且有意义的解。它提供了必要的起始方程和要分析的具体情景。任务是循序渐进且逻辑上相互关联的。\n- **客观性**: 语言精确且定量。使用的术语（例如，“准静止反气旋脊”、“位涡”）在气象学中有清晰、明确的定义。\n\n该问题不违反任何无效性标准：\n1.  **科学/事实不健全**: 无违反。物理原理是正确的。\n2.  **不可形式化/不相关**: 该问题是可形式化的，并且是大气阻塞主题的核心。\n3.  **不完整/矛盾的设置**: 设置是自洽的，足以进行推导。\n4.  **不现实/不可行**: 假设（静力平衡，可忽略的摩擦力）和情景（阻塞附近存在潜热加热）对于大尺度大气动力学是标准且合理的。\n5.  **不适定/结构不良**: 该问题是适定的。\n6.  **伪深刻/琐碎**: 该问题需要对一个基本定理（Ertel 位涡定理）进行不平凡的推导和应用，代表了动力学中的一个核心概念挑战。\n7.  **超出科学可验证性**: 其原理和结果在（大气物理学）框架内是可验证的。\n\n### 步骤 3：结论和行动\n\n问题陈述是**有效的**。现在开始求解过程。\n\n### 推导与分析\n\n**1. 非绝热 PV 趋势的推导**\n\n对 Ertel PV $q = \\dfrac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta$ 取物质导数：\n$$ \\frac{Dq}{Dt} = \\frac{D}{Dt}\\left(\\frac{1}{\\rho}\\right) (\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta) + \\frac{1}{\\rho} \\frac{D\\boldsymbol{\\omega}_a}{Dt} \\cdot \\nabla \\theta + \\frac{1}{\\rho} \\boldsymbol{\\omega}_a \\cdot \\frac{D(\\nabla \\theta)}{Dt} $$\n这个表达式可以使用连续性方程、完整的涡度方程和热力学能量方程来简化。标准结果，即所谓的 Ertel 位涡定理，是：\n$$ \\frac{Dq}{Dt} = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla\\left(\\frac{D\\theta}{Dt}\\right) + \\frac{1}{\\rho}(\\nabla \\times \\mathbf{F}) \\cdot \\nabla\\theta + \\text{螺线项} $$\n其中 $\\mathbf{F}$ 是摩擦力。问题陈述中指出热力学方程为 $D\\theta/Dt = \\dot{\\theta}$ 且摩擦力可忽略（$\\mathbf{F} \\approx \\boldsymbol{0}$）。螺线项由流体的斜压性引起，与绝热、无摩擦的动力学相关。因此，由非绝热过程引起的 PV 源/汇被分离出来，即包含 $\\dot{\\theta}$ 的项。\n$$ \\left.\\frac{Dq}{Dt}\\right|_{\\text{diabatic}} = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta} $$\n对于潜热加热的特定情况，我们用 $\\dot{\\theta}_{\\mathrm{LH}}$ 替换 $\\dot{\\theta}$：\n$$ \\left.\\frac{Dq}{Dt}\\right|_{\\mathrm{LH}} = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta}_{\\mathrm{LH}} $$\n该表达式符合任务的要求。\n\n**2. 应用于阻塞脊情景**\n\n我们将此公式应用于给定的情景。这些假设使我们能够近似各项：\n- 绝对涡度矢量主要是垂直的：$\\boldsymbol{\\omega}_a \\approx \\hat{\\boldsymbol{k}}\\,(f+\\zeta)$。在北半球的反气旋脊中，相对涡度 $\\zeta$ 为负。然而，除了最极端和动力学不稳定的情况外，绝对涡度 $f+\\zeta$ 保持为正。因此，$f+\\zeta  0$。\n- 非绝热加热率的梯度为 $\\nabla \\dot{\\theta}_{\\mathrm{LH}} = \\nabla_h \\dot{\\theta}_{\\mathrm{LH}} + \\hat{\\boldsymbol{k}}\\,\\frac{\\partial \\dot{\\theta}_{\\mathrm{LH}}}{\\partial z}$。\n\n将这些代入趋势方程：\n$$ \\left.\\frac{Dq}{Dt}\\right|_{\\mathrm{LH}} \\approx \\frac{1}{\\rho} \\left( \\hat{\\boldsymbol{k}}\\,(f+\\zeta) \\right) \\cdot \\left( \\nabla_h \\dot{\\theta}_{\\mathrm{LH}} + \\hat{\\boldsymbol{k}}\\,\\frac{\\partial \\dot{\\theta}_{\\mathrm{LH}}}{\\partial z} \\right) $$\n点积简化为：\n$$ \\left.\\frac{Dq}{Dt}\\right|_{\\mathrm{LH}} \\approx \\frac{1}{\\rho} (f+\\zeta) \\frac{\\partial \\dot{\\theta}_{\\mathrm{LH}}}{\\partial z} $$\n给定在对流层上层 $\\partial \\dot{\\theta}_{\\mathrm{LH}}/\\partial z  0$。由于 $\\rho  0$ 和 $f+\\zeta  0$，PV 趋势的符号为正：\n$$ \\left.\\frac{Dq}{Dt}\\right|_{\\mathrm{LH}}  0 $$\n这表明在感兴趣的区域内有正位涡生成。\n\n**3. 解释及与干动力学的对比**\n\n- **对阻塞的影响**：大气阻塞（一个强的反气旋脊）本质上是上对流层中的一个**低位涡**异常区。此情景中的非绝热过程正在*生成*正 PV。将一个正 PV 源放置在一个以缺少 PV 为特征的区域内，将起到“填补”负异常的作用。因此，这个过程会侵蚀阻塞的特征性 PV 结构，促进其**衰减**。在 $\\boldsymbol{\\omega}_a$ 是垂直的近似下，关于指向东方的水平加热梯度的信息是次要的，但如果考虑 $\\boldsymbol{\\omega}_a$ 的水平分量，它们将对更复杂的 PV 生成三维结构有所贡献。然而，对于大尺度系统，主导效应由垂直分量捕获。\n\n- **与干动力学的对比**：阻塞高压的维持主要归因于干动力学过程。在没有非绝热加热和摩擦的情况下，PV 跟随流体质点守恒 ($Dq/Dt = 0$)。阻塞的维持是通过大尺度的、准绝热的 PV 重排实现的。机制包括：\n    - **Rossby 波破碎**：大振幅波翻转并破碎，不可逆地将来自副热带的低 PV 空气向极地输送，并将来自极地的高 PV 空气向赤道输送。这创造并维持了构成阻塞的大片低 PV 空气区。\n    - **涡度通量辐合**：穿过大尺度流场的瞬态小尺度涡旋，会优先将其反气旋涡度释放到脊中，从而系统地加强脊以抵抗耗散。\n\n因此，干动力学通过重新分配现有的 PV 来*维持*阻塞，而指定的湿非绝热过程通过生成与阻塞异常相反的新 PV 来*削弱*阻塞。\n\n### 逐项分析选项\n\n**A. 由潜热加热引起的非绝热 PV 生成为 $Dq/Dt\\big|_{\\mathrm{LH}} = \\dfrac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta}_{\\mathrm{LH}}$。在中纬度地区，当 $\\boldsymbol{\\omega}_a \\approx \\hat{\\boldsymbol{k}}(f+\\zeta)$ 时，正的垂直梯度 $\\partial \\dot{\\theta}_{\\mathrm{LH}}/\\partial z  0$ 会在高空产生正的 PV，这会侵蚀反气旋脊的低 PV 异常，从而有利于阻塞衰减，而干动力学通过近似守恒的 PV、Rossby 波破碎和加强脊的涡度通量辐合来维持阻塞。**\n- PV 趋势的公式是正确的。\n- 中纬度近似的应用和符号分析（$\\frac{Dq}{Dt}  0$）是正确的。\n- 正 PV 生成会侵蚀脊的低 PV 异常，导致衰减的解释是正确的。\n- 对干动力学维持机制的描述是准确的，并提供了正确的对比。\n- **结论：正确。**\n\n**B. 由潜热加热引起的非绝热 PV 生成为 $Dq/Dt\\big|_{\\mathrm{LH}} = \\dfrac{1}{\\rho}\\,\\nabla \\cdot \\left(\\dot{\\theta}_{\\mathrm{LH}}\\,\\boldsymbol{\\omega}_a\\right)$，并且无论加热梯度如何，潜热加热总是通过在高空产生负 PV 来维持反气旋，从而补充了干动力学的作用。**\n- 公式 $Dq/Dt = \\frac{1}{\\rho}\\nabla \\cdot (\\dot{\\theta} \\boldsymbol{\\omega}_a)$ 在数学上是等价于标准形式的，因为绝对涡度的散度为零（$\\nabla \\cdot \\boldsymbol{\\omega}_a = 0$）。然而，其后的物理推理是错误的。\n- “无论加热梯度如何，潜热加热总是通过在高空产生负 PV 来维持反气旋”的说法是错误的。如上所述，PV 生成的符号取决于点积 $\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta}_{\\mathrm{LH}}$，在本例中为正值。\n- **结论：不正确。**\n\n**C. 潜热加热仅改变静力稳定度，不进入 PV 趋势方程；因此阻塞的维持和衰减纯粹由干动力学（如 Rossby 波破碎）控制，没有直接的非绝热 PV 生成。**\n- 这个陈述从根本上是错误的。Ertel PV 趋势方程的推导明确包含一个非绝热生成项 $\\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta}$。潜热加热是非绝热加热的主要形式，并且是众所周知的 PV 源/汇。\n- **结论：不正确。**\n\n**D. 由潜热加热引起的非绝热 PV 生成通过 $Dq/Dt\\big|_{\\mathrm{LH}} = \\dfrac{1}{\\rho}\\,(\\nabla \\theta \\times \\nabla_h \\dot{\\theta}_{\\mathrm{LH}})\\cdot \\hat{\\boldsymbol{k}}$ 依赖于水平加热梯度，因此向东的 $\\nabla_h \\dot{\\theta}_{\\mathrm{LH}}$ 会使 PV 梯度变陡并增强阻塞的维持，这与主要作用是混合 PV 和削弱梯度的干动力学相反。**\n- 提供的 PV 趋势公式是错误的。它与标准推导形式不符。正确的形式涉及涡度与加热梯度的点积，而不是涉及位温梯度的叉积。\n- 该过程增强阻塞维持的结论与我们的分析相反。\n- 将干动力学主要描述为混合和削弱梯度是一种过度简化；在大尺度上，波破碎建立了定义阻塞的反向梯度。\n- **结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "检验是否真正理解一条物理定律的最终标准，往往是能否将其在计算中付诸实践。本练习要求您将理论上的位涡（$PV$）收支方程转化为一个可操作的数值诊断程序。通过编写代码来诊断 $PV$ 的非绝热生成，并将其与模型中 $PV$ 的实际演变进行比较，您将获得分析复杂动力过程所需的宝贵的第一手编程经验，这是现代气象学家和气候建模者的核心技能。",
            "id": "4077005",
            "problem": "构造一个程序，用于诊断三维旋转 Boussinesq 流体中由非绝热加热引起的厄特位涡（PV）生成，并使用通量形式的倾向项检验 PV 收支闭合。推导和算法必须从旋转坐标系下的动量方程、位温的热力学方程和质量连续性方程出发，逻辑地推导出厄特 PV 收支方程，而不能直接使用预先记下的简化公式。程序必须实现周期性边界条件，并使用二阶中心差分计算空间导数。所有三角函数的参数都必须以弧度为单位。所有与 PV 相关的量都必须用国际单位制表示，并以位涡单位每秒（PVU/s）报告最终的诊断残差，其中 $1\\,\\mathrm{PVU} = 10^{-6}\\,\\mathrm{K\\,m^2\\,kg^{-1}\\,s^{-1}}$。\n\n使用的定义和约束条件：\n- 考虑一个笛卡尔坐标域，坐标为 $(x,y,z)$，所有三个方向均为周期性边界。科里奥利参数 $f$ 为常数（$f$ 平面）。密度 $\\rho$ 为常数（Boussinesq 近似）。重力效应已隐含在位温的定义中。摩擦力被忽略。\n- 速度场 $\\mathbf{u} = (u,v,w)$ 必须是无散的，即 $\\nabla \\cdot \\mathbf{u} = 0$，这一点通过构造来保证。\n- 绝对涡度定义为 $\\boldsymbol{\\omega}_a = \\nabla \\times \\mathbf{u} + \\mathbf{f}$，其中 $\\mathbf{f} = (0,0,f)$。\n\n需要实现的诊断任务：\n1. 对每个测试案例，计算整个计算域上的厄特位涡 $Q$ 及其仅含非绝热源项的收支。您必须：\n   - 根据各案例的规定，构造场 $\\theta(x,y,z)$ 和 $\\dot{\\theta}(x,y,z)$。\n   - 使用带周期性边界条件的二阶中心差分计算 $\\boldsymbol{\\omega}_a$ 和 $\\nabla \\theta$。\n   - 逐点计算 $Q = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta$。\n   - 通过在上述表达式中用 $\\nabla \\dot{\\theta}$ 替换 $\\nabla \\theta$ 并除以 $\\rho$，来预测由加热引起的局地位涡倾向 $\\left.\\partial_t Q\\right|_{\\mathrm{heat}}$。\n   - 使用 $\\theta^{n+1} = \\theta^n + \\dot{\\theta}\\,\\Delta t$ 将 $\\theta$ 向前推进一个时长为 $\\Delta t$ 的显式时间步，同时保持速度场不变，然后重新计算 $Q^{n+1}$，并估算实际倾向 $(Q^{n+1} - Q^n)/\\Delta t$。\n   - 计算预测的加热倾向与实际倾向之间的全域平均绝对残差，并将此残差转换为 PVU/s。\n\n2. 所有求导运算均使用周期性边界条件。所有导数必须在均匀网格上通过二阶中心差分进行近似。\n\n3. 单位：\n   - 以 PVU/s 为单位表示最终的诊断残差。\n   - 所有距离单位为米，时间单位为秒，位温单位为开尔文，密度单位为千克/立方米。\n\n网格、参数和测试套件：\n- 所有案例的通用计算域和物理参数：\n  - 计算域尺寸：$L_x = 10^5\\,\\mathrm{m}$，$L_y = 10^5\\,\\mathrm{m}$，$L_z = 10^4\\,\\mathrm{m}$。\n  - 网格分辨率：$N_x = 16$，$N_y = 16$，$N_z = 16$，对应的网格间距为 $\\Delta x = L_x/N_x$，$\\Delta y = L_y/N_y$，$\\Delta z = L_z/N_z$。\n  - 波数：$k_x = 2\\pi/L_x$，$k_y = 2\\pi/L_y$，$k_z = 2\\pi/L_z$。\n  - 科里奥利参数：$f = 10^{-4}\\,\\mathrm{s^{-1}}$。\n  - 密度：$\\rho = 1.2\\,\\mathrm{kg\\,m^{-3}}$。\n  - 时间步长：$\\Delta t = 10\\,\\mathrm{s}$。\n  - 基础位温廓线：$\\theta(x,y,z) = \\theta_0 + \\Gamma z + \\varepsilon \\cos(k_x x)\\sin(k_y y)$，其中 $\\theta_0 = 300\\,\\mathrm{K}$，$\\Gamma = 5\\times 10^{-3}\\,\\mathrm{K\\,m^{-1}}$，$\\varepsilon = 1\\,\\mathrm{K}$。\n  - 速度场（通过构造保证无散）：\n    $$u(x,y,z) = U_0 \\sin(k_x x)\\cos(k_y y)\\cos(k_z z),$$\n    $$v(x,y,z) = V_0 \\cos(k_x x)\\sin(k_y y)\\cos(k_z z),$$\n    $$w(x,y,z) = W_0 \\cos(k_x x)\\cos(k_y y)\\sin(k_z z),$$\n    其中 $U_0 = 10\\,\\mathrm{m\\,s^{-1}}$，$V_0 = 5\\,\\mathrm{m\\,s^{-1}}$，且 $W_0$ 的选择是为了确保 $\\nabla\\cdot\\mathbf{u}=0$，即 $W_0 = -\\frac{U_0 k_x + V_0 k_y}{k_z}$。\n\n- $\\dot{\\theta}(x,y,z)$ 的测试案例：\n  1. 案例 1（绝热参考）：对于所有的 $(x,y,z)$，$\\dot{\\theta}(x,y,z) = 0\\,\\mathrm{K\\,s^{-1}}$。\n  2. 案例 2（垂直加热梯度）：$\\dot{\\theta}(x,y,z) = A \\sin(k_z z)$，其中 $A = 10^{-3}\\,\\mathrm{K\\,s^{-1}}$。\n  3. 案例 3（水平加热梯度）：$\\dot{\\theta}(x,y,z) = B \\sin(k_x x)\\cos(k_y y)$，其中 $B = 10^{-3}\\,\\mathrm{K\\,s^{-1}}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3]”），列表中的每个条目是对应测试案例的全域平均绝对残差（单位为 PVU/s），顺序与上文列出的顺序一致。",
            "solution": "从适用于 Boussinesq 近似下的静力平衡大气的旋转坐标系方程和核心定义开始。相关的控制关系和定义如下：\n\n1. 在以角速度 $\\boldsymbol{\\Omega}$ 旋转的坐标系中，动量方程为\n$$\\frac{D\\mathbf{u}}{Dt} + 2\\boldsymbol{\\Omega}\\times \\mathbf{u} = -\\frac{1}{\\rho}\\nabla p + \\mathbf{g} + \\frac{\\mathbf{F}}{\\rho},$$\n其中 $\\mathbf{u}$ 是速度，$\\rho$ 是密度，$p$ 是压力，$\\mathbf{g}$ 是重力，$\\mathbf{F}$ 是非保守力（例如摩擦力）。在 $f$ 平面上，$2\\boldsymbol{\\Omega}$ 简化为 $\\mathbf{f}=(0,0,f)$。\n\n2. 位温的热力学方程为\n$$\\frac{D\\theta}{Dt} = \\dot{\\theta},$$\n其中 $\\theta$ 是位温，$\\dot{\\theta}$ 表示以 $\\mathrm{K\\,s^{-1}}$ 为单位的非绝热加热率。\n\n3. 在密度恒定的 Boussinesq 近似下，质量连续性方程意味着\n$$\\nabla\\cdot \\mathbf{u} = 0.$$\n\n4. 定义绝对涡度\n$$\\boldsymbol{\\omega}_a = \\nabla \\times \\mathbf{u} + \\mathbf{f},$$\n其中 $\\mathbf{f}=(0,0,f)$，以及厄特位涡\n$$Q = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta.$$\n\n由非绝热加热引起的 PV 收支方程的推导从 $Q$ 的物质导数开始：\n$$\\frac{DQ}{Dt} = \\frac{D}{Dt}\\left(\\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta\\right).$$\n在 Boussinesq 近似下，$\\rho$ 是常数，因此 $1/\\rho$ 也是常数。使用乘法法则和矢量微积分，\n$$\\frac{DQ}{Dt} = \\frac{1}{\\rho}\\left(\\frac{D\\boldsymbol{\\omega}_a}{Dt}\\cdot \\nabla \\theta + \\boldsymbol{\\omega}_a \\cdot \\frac{D(\\nabla \\theta)}{Dt}\\right).$$\n包含 $\\frac{D\\boldsymbol{\\omega}_a}{Dt}$ 的项受斜压扭矩和通过动量方程旋度项产生的非保守力影响。包含 $\\frac{D(\\nabla \\theta)}{Dt}$ 的项可以使用恒等式重写\n$$\\frac{D(\\nabla \\theta)}{Dt} = \\nabla\\left(\\frac{D\\theta}{Dt}\\right) - (\\nabla \\mathbf{u})^\\top \\cdot \\nabla \\theta.$$\n代入 $\\frac{D\\theta}{Dt} = \\dot{\\theta}$ 可得\n$$\\frac{D(\\nabla \\theta)}{Dt} = \\nabla \\dot{\\theta} - (\\nabla \\mathbf{u})^\\top \\cdot \\nabla \\theta.$$\n合并各项并应用 Boussinesq、无粘、绝热约束下的涡度方程（忽略 $\\mathbf{F}$ 并仅保留保守效应），可以得到在绝热、无摩擦极限情况下（$\\dot{\\theta}=0$, $\\mathbf{F}=\\mathbf{0}$）的厄特 PV 守恒定律：\n$$\\frac{DQ}{Dt} = 0.$$\n更一般地，当包含非绝热加热，同时忽略非保守动量强迫并保持 $\\rho$ 恒定时，生成项来自于绝对涡度在加热梯度上的投影：\n$$\\frac{DQ}{Dt} = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta}.$$\n其通量形式为\n$$\\frac{\\partial Q}{\\partial t} + \\nabla\\cdot(\\mathbf{u}Q) = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_a \\cdot \\nabla \\dot{\\theta},$$\n因此，对于一个三重周期性区域，平流项通量散度的体积分消失，区域平均的倾向等于由加热引起的区域平均源项。\n\n算法实现：\n- 使用均匀间距 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$ 以及周期性边界条件对计算域进行离散化。在由 $(i,j,k)$ 索引（对应于 $(x_i,y_j,z_k)$）的三维网格上表示物理场。\n- 使用带周期性回卷的二阶中心差分计算空间导数：\n  - 对于标量场 $\\phi$，通过 $(\\phi_{i+1,j,k} - \\phi_{i-1,j,k})/(2\\Delta x)$ 计算 $\\partial \\phi/\\partial x$，这可通过循环移位实现。对 $\\partial \\phi/\\partial y$ 和 $\\partial \\phi/\\partial z$ 的计算也类似。\n  - 对于旋度，使用标准的离散近似：\n    $$\\omega_x = \\frac{\\partial w}{\\partial y} - \\frac{\\partial v}{\\partial z},\\quad \\omega_y = \\frac{\\partial u}{\\partial z} - \\frac{\\partial w}{\\partial x},\\quad \\omega_z = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}.$$\n- 构造 $\\boldsymbol{\\omega}_a = (\\omega_x,\\omega_y,\\omega_z + f)$。\n- 通过中心差分计算 $\\nabla \\theta$ 和 $\\nabla \\dot{\\theta}$，并逐点计算\n  $$Q = \\frac{1}{\\rho}(\\omega_{a,x}\\,\\theta_x + \\omega_{a,y}\\,\\theta_y + \\omega_{a,z}\\,\\theta_z),$$\n  $$S_{\\mathrm{heat}} = \\frac{1}{\\rho}(\\omega_{a,x}\\,\\dot{\\theta}_x + \\omega_{a,y}\\,\\dot{\\theta}_y + \\omega_{a,z}\\,\\dot{\\theta}_z).$$\n- 使用 $\\theta^{n+1} = \\theta^n + \\dot{\\theta}\\,\\Delta t$ 将标量场 $\\theta$ 向前推进 $\\Delta t$，保持 $\\mathbf{u}$ 不变，重新计算 $Q^{n+1}$，并估算实际倾向为 $(Q^{n+1} - Q^n)/\\Delta t$。\n- 计算区域平均绝对残差 $\\overline{|(Q^{n+1} - Q^n)/\\Delta t - S_{\\mathrm{heat}}|}$，然后除以 $10^{-6}$ 转换为 PVU/s。\n- 对三个指定案例中的每一个执行此诊断：\n  1. $\\dot{\\theta} = 0$ (绝热参考，预期残差接近数值舍入误差)。\n  2. $\\dot{\\theta} = A\\sin(k_z z)$ (垂直加热梯度)。\n  3. $\\dot{\\theta} = B\\sin(k_x x)\\cos(k_y y)$ (水平加热梯度)，此案例可检验水平涡度对 PV 源项的贡献。\n\n数值考虑：\n- 周期性中心差分会引入 $O(\\Delta x^2,\\Delta y^2,\\Delta z^2)$ 阶的截断误差；对于光滑的正弦场，残差应接近机器精度乘以几何因子的量级。该诊断是在给定假设下的一个精确恒等式的比较，因此残差量化了离散化误差和算术舍入误差。\n\n程序输出单行，其中包含一个含有三个浮点数的列表，分别对应问题陈述中定义的每个案例的残差（单位为 PVU/s），顺序与定义顺序一致。",
            "answer": "```python\n# Python 3.12\n# Libraries: numpy 1.23.5, scipy 1.11.4 (not used)\nimport numpy as np\n\ndef grad_periodic(F, dx, dy, dz):\n    \"\"\"\n    Compute the gradient of a 3D scalar field F using second-order central differences\n    with periodic boundary conditions. Axes: 0-x, 1-y, 2-z.\n    \"\"\"\n    dFdx = (np.roll(F, -1, axis=0) - np.roll(F, 1, axis=0)) / (2.0 * dx)\n    dFdy = (np.roll(F, -1, axis=1) - np.roll(F, 1, axis=1)) / (2.0 * dy)\n    dFdz = (np.roll(F, -1, axis=2) - np.roll(F, 1, axis=2)) / (2.0 * dz)\n    return dFdx, dFdy, dFdz\n\ndef curl_periodic(u, v, w, dx, dy, dz):\n    \"\"\"\n    Compute curl(u) using second-order central differences with periodic boundary conditions.\n    \"\"\"\n    # omega_x = dw/dy - dv/dz\n    dwdY = (np.roll(w, -1, axis=1) - np.roll(w, 1, axis=1)) / (2.0 * dy)\n    dvdZ = (np.roll(v, -1, axis=2) - np.roll(v, 1, axis=2)) / (2.0 * dz)\n    omega_x = dwdY - dvdZ\n\n    # omega_y = du/dz - dw/dx\n    dudZ = (np.roll(u, -1, axis=2) - np.roll(u, 1, axis=2)) / (2.0 * dz)\n    dwdX = (np.roll(w, -1, axis=0) - np.roll(w, 1, axis=0)) / (2.0 * dx)\n    omega_y = dudZ - dwdX\n\n    # omega_z = dv/dx - du/dy\n    dvdX = (np.roll(v, -1, axis=0) - np.roll(v, 1, axis=0)) / (2.0 * dx)\n    dudY = (np.roll(u, -1, axis=1) - np.roll(u, 1, axis=1)) / (2.0 * dy)\n    omega_z = dvdX - dudY\n\n    return omega_x, omega_y, omega_z\n\ndef build_fields(Nx, Ny, Nz, Lx, Ly, Lz, U0, V0, theta0, Gamma, eps, f):\n    \"\"\"\n    Build coordinates, velocity (u,v,w), and base potential temperature theta.\n    \"\"\"\n    # Grid spacings\n    dx = Lx / Nx\n    dy = Ly / Ny\n    dz = Lz / Nz\n\n    # Wavenumbers\n    kx = 2.0 * np.pi / Lx\n    ky = 2.0 * np.pi / Ly\n    kz = 2.0 * np.pi / Lz\n\n    # Divergence-free constraint to determine W0\n    W0 = - (U0 * kx + V0 * ky) / kz\n\n    # Coordinates (cell centers)\n    x = np.linspace(0.0, Lx - dx, Nx)\n    y = np.linspace(0.0, Ly - dy, Ny)\n    z = np.linspace(0.0, Lz - dz, Nz)\n    X, Y, Z = np.meshgrid(x, y, z, indexing='ij')\n\n    # Velocity field: divergence-free by construction\n    u = U0 * np.sin(kx * X) * np.cos(ky * Y) * np.cos(kz * Z)\n    v = V0 * np.cos(kx * X) * np.sin(ky * Y) * np.cos(kz * Z)\n    w = W0 * np.cos(kx * X) * np.cos(ky * Y) * np.sin(kz * Z)\n\n    # Base potential temperature\n    theta = theta0 + Gamma * Z + eps * np.cos(kx * X) * np.sin(ky * Y)\n\n    return X, Y, Z, dx, dy, dz, kx, ky, kz, u, v, w, theta\n\ndef compute_pv_and_tendency(u, v, w, theta, dot_theta, dx, dy, dz, rho, f):\n    \"\"\"\n    Compute Ertel PV Q, predicted heating tendency S_heat, and actual tendency dQ/dt\n    after updating theta by dot_theta over dt.\n    \"\"\"\n    # Compute curl and absolute vorticity\n    omega_x, omega_y, omega_z = curl_periodic(u, v, w, dx, dy, dz)\n    omega_a_x = omega_x\n    omega_a_y = omega_y\n    omega_a_z = omega_z + f  # add planetary vorticity\n\n    # Gradients of theta and dot_theta\n    theta_x, theta_y, theta_z = grad_periodic(theta, dx, dy, dz)\n    dottheta_x, dottheta_y, dottheta_z = grad_periodic(dot_theta, dx, dy, dz)\n\n    # Ertel PV\n    Q = (omega_a_x * theta_x + omega_a_y * theta_y + omega_a_z * theta_z) / rho\n\n    # Heating source tendency\n    S_heat = (omega_a_x * dottheta_x + omega_a_y * dottheta_y + omega_a_z * dottheta_z) / rho\n\n    return Q, S_heat\n\ndef solve():\n    # Common parameters\n    Nx, Ny, Nz = 16, 16, 16\n    Lx, Ly, Lz = 1.0e5, 1.0e5, 1.0e4\n    U0, V0 = 10.0, 5.0  # m/s\n    theta0 = 300.0      # K\n    Gamma = 5.0e-3      # K/m\n    eps = 1.0           # K\n    f = 1.0e-4          # s^-1\n    rho = 1.2           # kg/m^3\n    dt = 10.0           # s\n\n    # Build base fields\n    X, Y, Z, dx, dy, dz, kx, ky, kz, u, v, w, theta = build_fields(\n        Nx, Ny, Nz, Lx, Ly, Lz, U0, V0, theta0, Gamma, eps, f\n    )\n\n    # Define test cases for dot_theta\n    A = 1.0e-3  # K/s\n    B = 1.0e-3  # K/s\n    dot_theta_cases = [\n        np.zeros_like(theta),                              # Case 1: adiabatic\n        A * np.sin(kz * Z),                                # Case 2: vertical heating gradient\n        B * np.sin(kx * X) * np.cos(ky * Y),               # Case 3: horizontal heating gradient\n    ]\n\n    results = []\n    for dot_theta in dot_theta_cases:\n        # Compute PV and predicted heating tendency\n        Q_old, S_heat = compute_pv_and_tendency(u, v, w, theta, dot_theta, dx, dy, dz, rho, f)\n\n        # Advance theta by dt using dot_theta, recompute PV\n        theta_new = theta + dot_theta * dt\n        Q_new, _ = compute_pv_and_tendency(u, v, w, theta_new, dot_theta, dx, dy, dz, rho, f)\n\n        # Actual tendency\n        actual_tendency = (Q_new - Q_old) / dt\n\n        # Domain-mean absolute residual between actual and predicted heating tendency\n        residual = np.mean(np.abs(actual_tendency - S_heat))\n\n        # Convert residual to PVU/s\n        residual_pvu_per_s = residual / 1.0e-6\n        results.append(residual_pvu_per_s)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}