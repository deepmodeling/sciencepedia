{
    "hands_on_practices": [
        {
            "introduction": "The process of geostrophic adjustment is governed by fundamental physical scales. This practice focuses on calculating two of the most important ones: the gravity wave phase speed, which sets the speed of adjustment, and the Rossby radius of deformation, which defines the length scale separating large-scale, rotationally dominated regimes from small-scale, wave-like regimes. By working through the derivation and computation for a stratified ocean , you will gain a tangible understanding of the parameters that determine the structure of the final balanced state.",
            "id": "4048417",
            "problem": "Consider a midlatitude geostrophic adjustment scenario in a continuously stratified, hydrostatic, Boussinesq ocean on an $f$-plane. A localized buoyancy anomaly excites vertical modes that propagate as long gravity waves and subsequently adjust into a balanced flow. In a vertical-mode decomposition, each mode behaves like a shallow-water layer with an equivalent depth $h_n$ and phase speed $c_n$. Let the environment be characterized by a Brunt–Väisälä frequency $N=10^{-3}\\,\\mathrm{s^{-1}}$, total depth $H=4000\\,\\mathrm{m}$, and suppose the first baroclinic mode has equivalent depth $h_1=50\\,\\mathrm{m}$. You are to:\n1. Derive, from the linearized hydrostatic Boussinesq equations and the vertical eigenmode formulation, the expression for the mode-$1$ long-wave phase speed $c_1$ in terms of $h_1$ and the gravitational acceleration $g$.\n2. Using the geostrophic adjustment scale implied by the linear shallow-water and Quasi-Geostrophic (QG) dynamics, derive the first baroclinic Rossby radius of deformation $L_{D,1}$ at latitude $\\phi=45^\\circ$ in terms of $c_1$ and the Coriolis parameter $f$.\n\nThen, compute numerical values for $c_1$ and $L_{D,1}$ using $g=9.81\\,\\mathrm{m\\,s^{-2}}$ and Earth’s rotation rate $\\Omega=7.2921159\\times 10^{-5}\\,\\mathrm{s^{-1}}$. Treat $\\phi=45^\\circ$ as degrees. Round both requested quantities to four significant figures. Express $c_1$ in $\\mathrm{m\\,s^{-1}}$ and $L_{D,1}$ in $\\mathrm{km}$.",
            "solution": "The problem will first be validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **System**: A midlatitude geostrophic adjustment scenario in a continuously stratified, hydrostatic, Boussinesq ocean on an $f$-plane.\n- **Excitation**: A localized buoyancy anomaly.\n- **Dynamics**: Vertical modes propagate as long gravity waves and adjust into a balanced flow.\n- **Model**: Vertical-mode decomposition, where each mode $n$ behaves like a shallow-water layer with an equivalent depth $h_n$ and phase speed $c_n$.\n- **Environmental Parameters**:\n    - Brunt–Väisälä frequency: $N=10^{-3}\\,\\mathrm{s^{-1}}$\n    - Total depth: $H=4000\\,\\mathrm{m}$\n- **Mode-1 Parameter**:\n    - Equivalent depth: $h_1=50\\,\\mathrm{m}$\n- **Constants**:\n    - Gravitational acceleration: $g=9.81\\,\\mathrm{m\\,s^{-2}}$\n    - Earth's rotation rate: $\\Omega=7.2921159\\times 10^{-5}\\,\\mathrm{s^{-1}}$\n- **Condition**:\n    - Latitude: $\\phi=45^\\circ$\n- **Tasks**:\n    1. Derive the expression for the mode-$1$ long-wave phase speed $c_1$ in terms of $h_1$ and $g$.\n    2. Derive the first baroclinic Rossby radius of deformation $L_{D,1}$ at latitude $\\phi=45^\\circ$ in terms of $c_1$ and the Coriolis parameter $f$.\n    3. Compute numerical values for $c_1$ and $L_{D,1}$, rounded to four significant figures.\n    4. Express $c_1$ in $\\mathrm{m\\,s^{-1}}$ and $L_{D,1}$ in $\\mathrm{km}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is firmly located within the canon of geophysical fluid dynamics. It employs standard models (hydrostatic, Boussinesq, $f$-plane), concepts (geostrophic adjustment, vertical modes, Rossby radius), and parameter values that are realistic for Earth's midlatitude oceans.\n- **Well-Posed**: The problem is well-posed. It provides all necessary information for the derivations and calculations. The tasks are stated unambiguously. The provision of the equivalent depth $h_1$ simplifies the problem by bypassing the need to solve the vertical structure (Sturm-Liouville) problem, which would otherwise require the given $N$ and $H$. This is a standard pedagogical simplification and does not render the problem incomplete. A unique solution exists.\n- **Objective**: The problem is stated in precise, objective, and quantitative terms.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a standard, well-posed problem in geophysical fluid dynamics. The solution will now proceed.\n\nThe solution is partitioned into two derivations followed by numerical calculations, as requested.\n\n**1. Derivation of the mode-1 phase speed $c_1$**\n\nThe problem states that in a vertical-mode decomposition of a continuously stratified fluid, each mode behaves as a shallow-water layer. The linearized equations governing the horizontal velocity field $(u_n, v_n)$ and pressure field $p_n$ for a given vertical mode $n$ can be written as:\n$$\n\\frac{\\partial u_n}{\\partial t} - f v_n = -\\frac{\\partial p_n}{\\partial x}\n$$\n$$\n\\frac{\\partial v_n}{\\partial t} + f u_n = -\\frac{\\partial p_n}{\\partial y}\n$$\n$$\n\\frac{\\partial p_n}{\\partial t} + c_n^2 \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\nHere, $u_n$, $v_n$, and $p_n$ represent the horizontal and temporal parts of the full solution for mode $n$, and $c_n^2$ is the eigenvalue (separation constant) that arises from the separation of variables. This constant, $c_n$, is the phase speed of long, non-rotating gravity waves for that mode.\n\nThese equations can be made directly analogous to the standard linear shallow-water equations. The standard shallow-water equations for a layer of fluid with mean depth $h$ and free surface displacement $\\eta$ are:\n$$\n\\frac{\\partial u}{\\partial t} - f v = -g \\frac{\\partial \\eta}{\\partial x}\n$$\n$$\n\\frac{\\partial v}{\\partial t} + f u = -g \\frac{\\partial \\eta}{\\partial y}\n$$\n$$\n\\frac{\\partial \\eta}{\\partial t} + h \\left( \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} \\right) = 0\n$$\nTo establish the correspondence, we can define an \"equivalent surface elevation\" for mode $n$ as $\\eta_n = p_n/g$. Substituting $p_n = g \\eta_n$ into the modal continuity equation yields:\n$$\ng \\frac{\\partial \\eta_n}{\\partial t} + c_n^2 \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\n$$\n\\frac{\\partial \\eta_n}{\\partial t} + \\frac{c_n^2}{g} \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\nComparing this with the standard shallow-water continuity equation, we see that the systems are dynamically equivalent if we identify the equivalent depth $h_n$ with the term $c_n^2/g$.\n$$\nh_n = \\frac{c_n^2}{g}\n$$\nSolving for the phase speed $c_n$ gives:\n$$\nc_n = \\sqrt{g h_n}\n$$\nThis relationship connects the phase speed of the $n$-th modal gravity wave to its corresponding equivalent depth. For the first baroclinic mode ($n=1$), the expression is:\n$$\nc_1 = \\sqrt{g h_1}\n$$\n\n**2. Derivation of the first baroclinic Rossby radius $L_{D,1}$**\n\nThe Rossby radius of deformation is the characteristic length scale at which rotational effects become comparable to stratification effects (represented here by the gravity wave speed $c_n$). It defines the scale of adjustment to geostrophic balance. We can derive this scale from the linearized shallow-water equations for mode $n$.\n\nLet us combine the modal equations to obtain a single equation for the pressure field $p_n$ (or equivalently, $\\eta_n$). Taking the time derivative of the continuity equation:\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} + c_n^2 \\left( \\frac{\\partial}{\\partial x} \\frac{\\partial u_n}{\\partial t} + \\frac{\\partial}{\\partial y} \\frac{\\partial v_n}{\\partial t} \\right) = 0\n$$\nSubstitute for $\\partial u_n/\\partial t$ and $\\partial v_n/\\partial t$ from the momentum equations:\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} + c_n^2 \\left[ \\frac{\\partial}{\\partial x} \\left(f v_n - \\frac{\\partial p_n}{\\partial x}\\right) + \\frac{\\partial}{\\partial y} \\left(-f u_n - \\frac{\\partial p_n}{\\partial y}\\right) \\right] = 0\n$$\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} - c_n^2 \\nabla_h^2 p_n + f c_n^2 \\left( \\frac{\\partial v_n}{\\partial x} - \\frac{\\partial u_n}{\\partial y} \\right) = 0\n$$\nwhere $\\nabla_h^2 = \\partial^2/\\partial x^2 + \\partial^2/\\partial y^2$. The term $\\zeta_n = \\partial v_n/\\partial x - \\partial u_n/\\partial y$ is the relative vorticity of mode $n$. From the momentum equations, one can derive the vorticity equation:\n$$\n\\frac{\\partial \\zeta_n}{\\partial t} + f \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\nUsing the continuity equation, this becomes $\\frac{\\partial \\zeta_n}{\\partial t} - \\frac{f}{c_n^2} \\frac{\\partial p_n}{\\partial t} = 0$. Integrating with respect to time yields the conservation of potential vorticity for an initially resting state: $\\zeta_n = \\frac{f}{c_n^2} p_n$.\n\nSubstituting this back into the wave equation gives:\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} - c_n^2 \\nabla_h^2 p_n + f^2 p_n = 0\n$$\nThis is a form of the Klein-Gordon equation. A geostrophically adjusted, steady state ($\\partial/\\partial t = 0$) must satisfy:\n$$\n- c_n^2 \\nabla_h^2 p_n + f^2 p_n = 0 \\quad \\implies \\quad \\nabla_h^2 p_n - \\frac{f^2}{c_n^2} p_n = 0\n$$\nThis is a Helmholtz equation. It shows that spatial structures in the balanced field $p_n$ must decay or oscillate over a characteristic length scale $L$ such that $1/L^2$ is of the order $f^2/c_n^2$. This scale is the Rossby radius of deformation, $L_{D,n}$:\n$$\nL_{D,n} = \\frac{c_n}{|f|}\n$$\nThe sign of $f$ is irrelevant as a length scale must be positive. Since the problem specifies a midlatitude scenario, $f \\neq 0$. For the first baroclinic mode, the expression is:\n$$\nL_{D,1} = \\frac{c_1}{f}\n$$\n(assuming $\\phi>0$ such that $f>0$).\n\n**3. Numerical Computation**\n\nThe problem provides the following values for computation:\n$g = 9.81\\,\\mathrm{m\\,s^{-2}}$\n$h_1 = 50\\,\\mathrm{m}$\n$\\phi = 45^\\circ$\n$\\Omega = 7.2921159 \\times 10^{-5}\\,\\mathrm{s^{-1}}$\n\nFirst, we compute the phase speed of the first baroclinic mode, $c_1$:\n$$\nc_1 = \\sqrt{g h_1} = \\sqrt{(9.81\\,\\mathrm{m\\,s^{-2}}) \\times (50\\,\\mathrm{m})} = \\sqrt{490.5\\,\\mathrm{m^2\\,s^{-2}}} \\approx 22.14723\\,\\mathrm{m\\,s^{-1}}\n$$\nRounding to four significant figures, we get $c_1 = 22.15\\,\\mathrm{m\\,s^{-1}}$.\n\nNext, we compute the Coriolis parameter $f$ at latitude $\\phi=45^\\circ$:\n$$\nf = 2 \\Omega \\sin\\phi = 2 \\times (7.2921159 \\times 10^{-5}\\,\\mathrm{s^{-1}}) \\times \\sin(45^\\circ)\n$$\n$$\nf = 2 \\times (7.2921159 \\times 10^{-5}\\,\\mathrm{s^{-1}}) \\times \\frac{\\sqrt{2}}{2} \\approx 1.03126 \\times 10^{-4}\\,\\mathrm{s^{-1}}\n$$\nNow, we can compute the first baroclinic Rossby radius of deformation, $L_{D,1}$:\n$$\nL_{D,1} = \\frac{c_1}{f} = \\frac{22.14723\\,\\mathrm{m\\,s^{-1}}}{1.03126 \\times 10^{-4}\\,\\mathrm{s^{-1}}} \\approx 214757.5\\,\\mathrm{m}\n$$\nThe problem requires the answer in kilometers. Converting meters to kilometers:\n$$\nL_{D,1} \\approx 214.7575\\,\\mathrm{km}\n$$\nRounding to four significant figures, we get $L_{D,1} = 214.8\\,\\mathrm{km}$.\n\nThe final computed values are $c_1 \\approx 22.15\\,\\mathrm{m\\,s^{-1}}$ and $L_{D,1} \\approx 214.8\\,\\mathrm{km}$. Note that the provided values for $N$ and $H$ were not required for the calculation as the equivalent depth $h_1$ was given directly.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 22.15 & 214.8 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A central question in geostrophic adjustment is: how much of an initial imbalance is retained in the final balanced flow, and how much is radiated away by waves? This exercise explores this question using the powerful principle of potential vorticity (PV) conservation. By applying PV conservation to an initial state of rest , you can determine the amplitude of the final geostrophically balanced state without solving the full time-dependent equations, revealing the critical role of spatial scale in the adjustment process.",
            "id": "4048418",
            "problem": "In numerical weather prediction and climate modeling, the understanding of geostrophic adjustment governs how initially unbalanced disturbances partition into slow balanced motions and fast gravity waves. Consider a single-layer shallow-water system on a constant Coriolis parameter plane (an $f$-plane), with mean depth $H$, gravitational acceleration $g$, and Coriolis parameter $f$. The Rossby deformation radius is defined as $L_D = \\sqrt{g H}/f$. At time $t=0$, suppose the fluid has no motion and the free-surface height is perturbed by a single horizontally isotropic Fourier mode of wavenumber magnitude $k$ (associated with horizontal scale $L$ via $k \\approx 1/L$) with amplitude $\\eta_0$. The domain is unbounded and there are no external forcings.\n\nStarting only from the linearized shallow-water equations, conservation of linearized potential vorticity, and the quasi-geostrophic (QG) balanced relation between velocity and free-surface height, determine the amplitude of the balanced free-surface height response $\\eta_b$ for this mode after geostrophic adjustment. Express your final result as an analytic expression for the ratio $\\eta_b/\\eta_0$ simplified in the small-scale limit $L \\ll L_D$. Then, using the linear shallow-water energy, provide a brief physical justification for why, in this limit, most of the initial energy is carried away by gravity waves.\n\nYour final answer must be a single closed-form analytic expression for $\\eta_b/\\eta_0$ valid in the limit $L \\ll L_D$.",
            "solution": "The problem statement is first subjected to a validation process.\n\n### Step 1: Extract Givens\n- **System**: A single-layer shallow-water system on a constant Coriolis parameter plane ($f$-plane).\n- **Physical Constants**: Mean fluid depth $H$, gravitational acceleration $g$, Coriolis parameter $f$.\n- **Defined Parameter**: Rossby deformation radius, $L_D = \\frac{\\sqrt{g H}}{f}$.\n- **Initial Conditions ($t=0$)**:\n    - No motion: $u(x, y, 0) = 0$, $v(x, y, 0) = 0$.\n    - Free-surface height perturbation: A single horizontally isotropic Fourier mode of wavenumber magnitude $k$ with amplitude $\\eta_0$. The horizontal scale is given by $L \\approx 1/k$.\n- **Domain and Forcing**: The domain is unbounded, and there are no external forcings.\n- **Required Tools**: Linearized shallow-water equations, conservation of linearized potential vorticity, and the quasi-geostrophic (QG) balanced relation.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Groundedness**: The problem is a classic and fundamental exercise in geophysical fluid dynamics, concerning the process of geostrophic adjustment. It is based on the well-established shallow-water equations and the principle of potential vorticity conservation. All concepts are standard in the field.\n- **Well-Posedness**: The problem is well-posed. The initial state is fully specified, and the principle of potential vorticity conservation provides a unique path to determine the final balanced state.\n- **Objectivity**: The language is precise, technical, and free of any subjective or ambiguous statements.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and objective. It does not violate any of the invalidity criteria. Therefore, the problem is deemed valid and a full solution will be provided.\n\n### Solution Derivation\n\nThe core principle for solving this problem is the conservation of linearized potential vorticity (PV). The initial state, composed of a height perturbation and zero velocity, will evolve into a final state consisting of a steady, geostrophically balanced flow and transient, propagating gravity waves. As the gravity waves radiate away in an unbounded domain, only the balanced state remains. The PV of this final balanced state must be equal to the PV of the initial state.\n\nThe linearized potential vorticity perturbation, $q'$, for the shallow-water system is given by:\n$$\nq' = \\frac{\\zeta - \\frac{f}{H}\\eta}{H}\n$$\nwhere $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$ is the relative vorticity and $\\eta$ is the free-surface height perturbation. In the absence of forcing and dissipation, $q'$ is conserved following a fluid parcel. For linearized dynamics, this implies $\\frac{\\partial q'}{\\partial t} = 0$, so the PV field at any time is identical to the initial PV field.\n\nWe will work with a single Fourier mode, as specified. Let the initial height perturbation be $\\eta(x, y, 0) = \\eta_0 \\exp(i(k_x x + k_y y))$, where $k^2 = k_x^2 + k_y^2$. We denote the Fourier amplitude of a field $A$ as $\\hat{A}$.\n\n**1. Initial State Potential Vorticity ($t=0$)**\nThe initial conditions are $u_0 = 0$ and $v_0 = 0$. This implies that the initial relative vorticity is zero: $\\zeta_0 = 0$. The initial height perturbation has amplitude $\\eta_0$.\nThe Fourier amplitude of the initial PV perturbation, $\\hat{q'}_0$, is:\n$$\n\\hat{q'}_0 = \\frac{1}{H} \\left( \\hat{\\zeta}_0 - \\frac{f}{H}\\hat{\\eta}_0 \\right) = \\frac{1}{H} \\left( 0 - \\frac{f}{H}\\hat{\\eta}_0 \\right) = -\\frac{f}{H^2}\\hat{\\eta}_0\n$$\n\n**2. Final Balanced State Potential Vorticity ($t \\to \\infty$)**\nAfter the adjustment process, the system settles into a geostrophically balanced state, denoted by a subscript '$b$'. The geostrophic balance relations are:\n$$\n-fv_b = -g \\frac{\\partial \\eta_b}{\\partial x} \\quad \\implies \\quad \\hat{v}_b = \\frac{g}{f}(ik_x)\\hat{\\eta}_b\n$$\n$$\nfu_b = -g \\frac{\\partial \\eta_b}{\\partial y} \\quad \\implies \\quad \\hat{u}_b = -\\frac{g}{f}(ik_y)\\hat{\\eta}_b\n$$\nThe relative vorticity of the balanced flow, $\\zeta_b$, is $\\zeta_b = \\frac{\\partial v_b}{\\partial x} - \\frac{\\partial u_b}{\\partial y}$. In Fourier space, this becomes:\n$$\n\\hat{\\zeta}_b = ik_x \\hat{v}_b - ik_y \\hat{u}_b = ik_x \\left( \\frac{igk_x}{f}\\hat{\\eta}_b \\right) - ik_y \\left( -\\frac{igk_y}{f}\\hat{\\eta}_b \\right)\n$$\n$$\n\\hat{\\zeta}_b = \\left( -\\frac{gk_x^2}{f} - \\frac{gk_y^2}{f} \\right) \\hat{\\eta}_b = -\\frac{g k^2}{f}\\hat{\\eta}_b\n$$\nThis equation represents the QG relationship between the balanced vorticity and height fields. Now, we compute the Fourier amplitude of the PV perturbation for this final balanced state:\n$$\n\\hat{q'}_b = \\frac{1}{H} \\left( \\hat{\\zeta}_b - \\frac{f}{H}\\hat{\\eta}_b \\right) = \\frac{1}{H} \\left( -\\frac{g k^2}{f}\\hat{\\eta}_b - \\frac{f}{H}\\hat{\\eta}_b \\right) = -\\left( \\frac{g k^2}{fH} + \\frac{f}{H^2} \\right) \\hat{\\eta}_b\n$$\n\n**3. Application of PV Conservation and Derivation of the Ratio**\nBy conservation of potential vorticity, $\\hat{q'}_0 = \\hat{q'}_b$:\n$$\n-\\frac{f}{H^2}\\hat{\\eta}_0 = -\\left( \\frac{g k^2}{fH} + \\frac{f}{H^2} \\right) \\hat{\\eta}_b\n$$\nSolving for the ratio of the final balanced amplitude to the initial amplitude, $\\eta_b/\\eta_0$ (which is equal to $\\hat{\\eta}_b/\\hat{\\eta}_0$):\n$$\n\\frac{\\eta_b}{\\eta_0} = \\frac{\\frac{f}{H^2}}{\\frac{g k^2}{fH} + \\frac{f}{H^2}} = \\frac{f^2}{g k^2 H + f^2}\n$$\nDividing the numerator and denominator by $f^2$:\n$$\n\\frac{\\eta_b}{\\eta_0} = \\frac{1}{\\frac{gH}{f^2}k^2 + 1}\n$$\nUsing the definition of the Rossby deformation radius, $L_D = \\sqrt{g H}/f$, so $L_D^2 = gH/f^2$, we obtain the general expression:\n$$\n\\frac{\\eta_b}{\\eta_0} = \\frac{1}{1 + k^2 L_D^2}\n$$\n\n**4. The Small-Scale Limit**\nThe problem asks for this ratio in the small-scale limit, $L \\ll L_D$. Given the association $k \\approx 1/L$, this limit is equivalent to $1/k \\ll L_D$, or $k L_D \\gg 1$. In this limit, the term $1$ in the denominator is negligible compared to $k^2 L_D^2$:\n$$\n\\frac{\\eta_b}{\\eta_0} \\approx \\frac{1}{k^2 L_D^2}\n$$\nSubstituting $k \\approx 1/L$, we can express this result in terms of length scales:\n$$\n\\frac{\\eta_b}{\\eta_0} \\approx \\left(\\frac{L}{L_D}\\right)^2\n$$\nThis expression demonstrates that for initial disturbances on scales much smaller than the Rossby radius, the amplitude of the final balanced height field is quadratically smaller than the initial amplitude.\n\n**5. Physical Justification via Energy Conservation**\nThe total energy density (per unit area) in the linear shallow-water system is the sum of kinetic energy (KE) and available potential energy (APE):\n$$\nE = \\text{KE} + \\text{APE} = \\frac{1}{2} H (u^2 + v^2) + \\frac{1}{2} g \\eta^2\n$$\nThe initial state has $u_0=v_0=0$, so its energy is purely potential. For a single mode with amplitude $\\eta_0$, the initial energy is $E_0 \\propto \\frac{1}{2}g\\eta_0^2$.\nThe final balanced state has both kinetic and potential energy. The energy of the balanced state is $E_b \\propto \\frac{1}{2}H(u_b^2+v_b^2) + \\frac{1}{2}g\\eta_b^2$.\nFrom the geostrophic relations, the kinetic energy of the balanced state for a single mode is related to its potential energy:\n$$\n\\text{KE}_b \\propto \\frac{1}{2}H \\frac{g^2 k^2}{f^2} \\eta_b^2 = \\frac{1}{2}g\\eta_b^2 \\left(\\frac{gH k^2}{f^2}\\right) = \\text{APE}_b \\cdot (k^2 L_D^2)\n$$\nThus, the total energy in the final balanced state is:\n$$\nE_b = \\text{APE}_b + \\text{KE}_b = \\text{APE}_b (1 + k^2 L_D^2) \\propto \\frac{1}{2}g\\eta_b^2(1+k^2L_D^2)\n$$\nUsing our result for the amplitude ratio, $\\eta_b = \\eta_0 / (1+k^2L_D^2)$:\n$$\nE_b \\propto \\frac{1}{2}g \\left(\\frac{\\eta_0}{1+k^2L_D^2}\\right)^2 (1+k^2L_D^2) = \\left(\\frac{1}{2}g\\eta_0^2\\right) \\frac{1}{1+k^2L_D^2}\n$$\nSo, the ratio of the final balanced energy to the initial energy is:\n$$\n\\frac{E_b}{E_0} = \\frac{1}{1+k^2L_D^2}\n$$\nIn the small-scale limit ($kL_D \\gg 1$), this ratio becomes very small:\n$$\n\\frac{E_b}{E_0} \\approx \\frac{1}{k^2L_D^2} \\ll 1\n$$\nThis shows that only a tiny fraction of the initial energy remains in the balanced flow. Since the shallow-water equations conserve total energy, the vast majority of the initial energy, $E_0 - E_b$, must have been partitioned into the transient part of the solution, which consists of inertial-gravity waves. These waves propagate away from the initial disturbance region, effectively removing most of the energy and leaving behind a low-energy, geostrophically balanced state. This provides a physical justification for why the final balanced amplitude $\\eta_b$ is so small for small-scale initial perturbations.\nThe final answer is the simplified expression for the amplitude ratio in the specified limit. Using the length scale $L$ provides a more intuitive form.",
            "answer": "$$\n\\boxed{\\left(\\frac{L}{L_D}\\right)^2}\n$$"
        },
        {
            "introduction": "The theoretical link between potential vorticity ($q$) and the balanced flow field (streamfunction $\\psi$) is not just a conceptual tool; it is a cornerstone of numerical weather prediction and oceanography. This hands-on computational exercise challenges you to implement a spectral solver for the quasi-geostrophic PV inversion equation, a technique used to initialize numerical models and diagnose balanced flows from observational data. By solving for the balanced velocity and height fields from a given PV anomaly , you will bridge the gap between theory and the practical algorithms that underpin modern geophysical modeling.",
            "id": "4048382",
            "problem": "You are tasked with implementing a spectral inversion for one-layer quasi-geostrophic (QG) geostrophic adjustment on a doubly periodic domain to compute balanced velocity and height fields associated with a prescribed discrete potential vorticity anomaly. The derivation and algorithm must start from the rotating shallow-water equations and the geostrophic balance, and proceed through the quasi-geostrophic potential vorticity inversion principle. The program must compute diagnostic metrics and evaluate the effect of domain size.\n\nStarting point and physical setting:\n- Consider a one-layer rotating shallow-water system on an $f$-plane with constant Coriolis parameter $f_0$ and gravitational acceleration $g$. Let the mean depth be $H$, and let the deformation radius be $L_D = \\sqrt{g H} / f_0$.\n- Impose geostrophic balance and small Rossby number consistent with quasi-geostrophic scaling. Under this scaling, define a streamfunction $\\psi$ such that the horizontal velocity field is $u = -\\partial \\psi / \\partial y$ and $v = \\partial \\psi / \\partial x$. The free-surface height perturbation $\\eta$ is related to the streamfunction by geostrophic balance.\n- The quasi-geostrophic potential vorticity $q$ is defined on the grid and must be inverted spectrally on a doubly periodic domain to obtain the balanced $\\psi$, from which $u$, $v$, and $\\eta$ follow.\n\nAlgorithmic and numerical requirements:\n- Use a uniform grid of $N \\times N$ points on a rectangular periodic domain of physical size $L_x \\times L_y$. Define the discrete potential vorticity anomaly $q(x,y)$ on this grid as the sum of two oppositely signed, isotropic Gaussian anomalies centered at positions symmetric about the domain center to ensure near-zero net integral:\n  $$ q(x, y) = A \\exp\\left(-\\frac{(x - x_c - \\delta_x)^2 + (y - y_c)^2}{2 \\sigma^2}\\right) - A \\exp\\left(-\\frac{(x - x_c + \\delta_x)^2 + (y - y_c)^2}{2 \\sigma^2}\\right), $$\n  where $(x_c, y_c)$ is the domain center, $A$ is the anomaly amplitude, $\\sigma$ is the Gaussian width, and $\\delta_x$ is the offset from the center in the $x$ direction. All quantities must be in International System of Units (SI).\n- Invert for the balanced streamfunction $\\psi$ using a spectral method consistent with the doubly periodic domain. Compute the geostrophic velocity $(u, v)$ and height perturbation $\\eta$ implied by $\\psi$.\n- Quantify the effect of domain size by computing two metrics for each test case:\n  1. The maximum geostrophic speed magnitude over the domain,\n     $$ U_{\\max} = \\max \\sqrt{u^2 + v^2}, $$\n     expressed in meters per second (m/s).\n  2. The root-mean-square height perturbation,\n     $$ \\eta_{\\mathrm{rms}} = \\sqrt{\\langle \\eta^2 \\rangle}, $$\n     expressed in meters (m).\n- Round each reported metric to six decimal places.\n\nPhysical constants and parameters to be used:\n- $f_0 = 1.0 \\times 10^{-4}$ s$^{-1}$,\n- $g = 9.81$ m s$^{-2}$,\n- $H = 5000$ m,\n- $A = 1.0 \\times 10^{-5}$ s$^{-1}$,\n- $\\sigma = 2.5 \\times 10^{5}$ m,\n- $\\delta_x = 3.0 \\times 10^{5}$ m,\n- $N = 128$.\n\nSpectral method requirements:\n- Use discrete Fourier transforms with wavenumbers defined consistently with the physical domain sizes $L_x$ and $L_y$, such that for discrete transforms the wavenumber arrays are $k_x = 2 \\pi n_x / L_x$ and $k_y = 2 \\pi n_y / L_y$, with $n_x$ and $n_y$ given by the appropriate discrete frequency indices.\n- Employ doubly periodic boundary conditions and ensure that the inversion is well-posed for all modes, including the zero mode.\n- Implement inversion and differentiation in spectral space to avoid numerical differentiation errors.\n\nTest suite:\nUse the following four test cases to assess the effect of domain size while keeping all other parameters fixed:\n1. $L_x = 4.0 \\times 10^{6}$ m, $L_y = 4.0 \\times 10^{6}$ m,\n2. $L_x = 2.0 \\times 10^{6}$ m, $L_y = 2.0 \\times 10^{6}$ m,\n3. $L_x = 8.0 \\times 10^{6}$ m, $L_y = 8.0 \\times 10^{6}$ m,\n4. $L_x = 6.0 \\times 10^{5}$ m, $L_y = 6.0 \\times 10^{5}$ m.\n\nRequired outputs:\n- For each test case, compute and return the pair $(U_{\\max}, \\eta_{\\mathrm{rms}})$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example:\n  $$ [U_{\\max,1}, \\eta_{\\mathrm{rms},1}, U_{\\max,2}, \\eta_{\\mathrm{rms},2}, U_{\\max,3}, \\eta_{\\mathrm{rms},3}, U_{\\max,4}, \\eta_{\\mathrm{rms},4}] $$\n- Express $U_{\\max}$ in meters per second (m/s) and $\\eta_{\\mathrm{rms}}$ in meters (m), each rounded to six decimal places.\n\nNo user input or external files are permitted. The program must be entirely self-contained and must adhere to the specified output format.",
            "solution": "The problem statement is well-posed, scientifically grounded, and contains all necessary information to proceed. It describes a classic numerical problem in geophysical fluid dynamics: the inversion of quasi-geostrophic potential vorticity (QG-PV) to find balanced flow and mass fields. No inconsistencies, ambiguities, or factual errors were detected.\n\nThe solution proceeds by first establishing the governing mathematical equation from the provided physical principles. Then, a spectral method is formulated for its solution on a doubly periodic domain. Finally, a detailed computational algorithm is described to implement this method and compute the required diagnostic metrics for the specified test cases.\n\n**1. Theoretical Foundation: The Quasi-Geostrophic Potential Vorticity Inversion Equation**\n\nThe problem is set within the framework of a single-layer rotating shallow-water system on an $f$-plane, under the quasi-geostrophic (QG) approximation. The QG approximation assumes a small Rossby number, implying that the flow is nearly in geostrophic balance.\n\nThe geostrophic balance relates the pressure gradient force to the Coriolis force. In a shallow-water model, this balance connects the free-surface height perturbation, $\\eta$, to a geostrophic streamfunction, $\\psi$. The geostrophic velocity components are defined as $u = -\\partial\\psi/\\partial y$ and $v = \\partial\\psi/\\partial x$. The relationship between $\\eta$ and $\\psi$ is derived from the momentum equations:\n$$ f_0 u = -g \\frac{\\partial\\eta}{\\partial y} \\quad \\text{and} \\quad -f_0 v = -g \\frac{\\partial\\eta}{\\partial x} $$\nSubstituting the definitions for $u$ and $v$ in terms of $\\psi$ yields:\n$$ -f_0 \\frac{\\partial\\psi}{\\partial y} = -g \\frac{\\partial\\eta}{\\partial y} \\quad \\text{and} \\quad -f_0 \\frac{\\partial\\psi}{\\partial x} = -g \\frac{\\partial\\eta}{\\partial x} $$\nIntegrating these gives $\\eta = (f_0/g)\\psi + \\text{const}$. For perturbations from a state of rest, the constant is zero, leading to the relation:\n$$ \\eta = \\frac{f_0}{g}\\psi $$\nThe quasi-geostrophic potential vorticity, $q$, is the quantity conserved by the geostrophic flow. For a single-layer system, it is composed of the relative vorticity and a stretching term associated with the height field:\n$$ q = \\zeta_g - \\frac{f_0}{H}\\eta $$\nwhere $\\zeta_g$ is the geostrophic relative vorticity and $H$ is the mean fluid depth. Substituting the geostrophic relations for $\\zeta_g$ and $\\eta$ in terms of $\\psi$:\n$$ \\zeta_g = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial\\psi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial\\psi}{\\partial y}\\right) = \\nabla^2\\psi $$\n$$ q = \\nabla^2\\psi - \\frac{f_0}{H}\\left(\\frac{f_0}{g}\\psi\\right) = \\nabla^2\\psi - \\frac{f_0^2}{gH}\\psi $$\nThe problem defines the Rossby radius of deformation as $L_D = \\sqrt{g H} / f_0$. Therefore, the term $f_0^2/(gH)$ is equal to $1/L_D^2$. This yields the QG-PV inversion equation, which is a Helmholtz equation relating the potential vorticity anomaly $q$ to the streamfunction $\\psi$:\n$$ q(x, y) = \\nabla^2\\psi(x, y) - \\frac{1}{L_D^2}\\psi(x, y) $$\nThis equation is diagnostic, meaning that if $q$ is known at every point, $\\psi$ (and thus the balanced velocity and height fields) can be determined by solving this equation.\n\n**2. Spectral Inversion Method**\n\nFor a doubly periodic domain, spectral methods using the Discrete Fourier Transform (DFT) are exceptionally well-suited. We represent the fields $q(x,y)$ and $\\psi(x,y)$ as a sum of Fourier modes:\n$$ \\psi(x, y) = \\sum_{k_x, k_y} \\hat{\\psi}(k_x, k_y) e^{i(k_x x + k_y y)} $$\nThe Laplacian operator in spectral space becomes a simple multiplication: $\\mathcal{F}(\\nabla^2\\psi) = -(k_x^2 + k_y^2)\\hat{\\psi} = -K^2\\hat{\\psi}$, where $\\mathcal{F}$ denotes the Fourier transform and $K^2 = k_x^2 + k_y^2$ is the squared total wavenumber.\nApplying the Fourier transform to the QG-PV inversion equation gives:\n$$ \\hat{q}(k_x, k_y) = -K^2 \\hat{\\psi}(k_x, k_y) - \\frac{1}{L_D^2}\\hat{\\psi}(k_x, k_y) = -\\left(K^2 + \\frac{1}{L_D^2}\\right)\\hat{\\psi}(k_x, k_y) $$\nThis algebraic equation can be solved for the spectral streamfunction $\\hat{\\psi}$:\n$$ \\hat{\\psi}(k_x, k_y) = - \\frac{\\hat{q}(k_x, k_y)}{K^2 + 1/L_D^2} $$\nThis expression is well-defined for all wavenumbers, as the denominator $K^2 + 1/L_D^2$ is strictly positive for real $L_D$. The zero-wavenumber mode ($K=0$) is also handled without singularity.\n\n**3. Algorithmic Implementation**\n\nThe numerical solution is implemented as follows:\n\n1.  **Constants and Grid Setup:** The physical constants $f_0, g, H$ and anomaly parameters $A, \\sigma, \\delta_x$ are defined. The number of grid points is $N=128$. For each test case with domain size $L_x \\times L_y$, a uniform Cartesian grid is constructed with coordinates $x_i = i \\cdot L_x/N$ and $y_j = j \\cdot L_y/N$ for $i, j \\in \\{0, 1, \\dots, N-1\\}$.\n\n2.  **PV Anomaly Construction:** The discrete potential vorticity field $q(x,y)$ is computed on the grid using the specified formula for the sum of two Gaussian anomalies.\n\n3.  **Spectral Inversion:**\n    a. The $2$D Fast Fourier Transform (FFT) of the discrete field $q(x,y)$ is computed to obtain its spectral representation $\\hat{q}(k_x, k_y)$.\n    b. Grids for the discrete wavenumbers $k_x$ and $k_y$ are generated, corresponding to the physical domain size and number of grid points.\n    c. The spectral streamfunction $\\hat{\\psi}$ is calculated using the algebraic inversion formula derived above.\n\n4.  **Field Calculation:**\n    a. The velocity components $u$ and $v$ are obtained via spectral differentiation. The Fourier transforms of the velocity components are $\\hat{u} = -i k_y \\hat{\\psi}$ and $\\hat{v} = i k_x \\hat{\\psi}$.\n    b. The physical velocity fields $u(x,y)$ and $v(x,y)$ are recovered by applying the inverse $2$D FFT to $\\hat{u}$ and $\\hat{v}$.\n    c. The physical streamfunction field $\\psi(x,y)$ is found by applying the inverse $2$D FFT to $\\hat{\\psi}$. The height perturbation field is then calculated directly as $\\eta(x,y) = (f_0/g)\\psi(x,y)$.\n\n5.  **Diagnostic Metrics:**\n    a. The geostrophic speed field is computed as $\\sqrt{u(x,y)^2 + v(x,y)^2}$. The maximum value, $U_{\\max}$, is found over the entire domain.\n    b. The root-mean-square height perturbation, $\\eta_{\\mathrm{rms}} = \\sqrt{\\langle \\eta^2 \\rangle}$, is calculated, where $\\langle \\cdot \\rangle$ denotes the spatial average over the domain.\n\n**4. Parameters and Test Cases**\n\nThe algorithm uses the following fixed parameters:\n- $f_0 = 1.0 \\times 10^{-4}$ s$^{-1}$\n- $g = 9.81$ m s$^{-2}$\n- $H = 5000$ m\n- $A = 1.0 \\times 10^{-5}$ s$^{-1}$\n- $\\sigma = 2.5 \\times 10^{5}$ m\n- $\\delta_x = 3.0 \\times 10^{5}$ m\n- $N = 128$\n\nFrom these, the Rossby deformation radius is $L_D = \\sqrt{gH}/f_0 \\approx 2.215 \\times 10^6$ m.\n\nThe effect of domain size is evaluated for four square domains ($L_x = L_y = L$):\n1.  Case 1: $L = 4.0 \\times 10^6$ m\n2.  Case 2: $L = 2.0 \\times 10^6$ m\n3.  Case 3: $L = 8.0 \\times 10^6$ m\n4.  Case 4: $L = 6.0 \\times 10^5$ m\n\nFor Case 4, the domain width $L_x$ is exactly equal to the separation $2\\delta_x$ of the Gaussian anomaly centers. On a periodic domain, this causes the positive and negative anomalies to be centered at the same location ($x=0$ and $x=L_x$), resulting in their exact cancellation. Consequently, the input potential vorticity field $q(x,y)$ is zero, leading to zero balanced fields and thus $U_{\\max}=0$ and $\\eta_{\\mathrm{rms}}=0$.",
            "answer": "[0.038164,0.288289,0.040182,0.231269,0.038128,0.289196,0.000000,0.000000]"
        }
    ]
}