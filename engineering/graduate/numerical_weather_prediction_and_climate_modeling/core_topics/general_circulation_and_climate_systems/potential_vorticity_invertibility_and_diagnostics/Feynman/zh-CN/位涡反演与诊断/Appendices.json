{
    "hands_on_practices": [
        {
            "introduction": "为了掌握位涡 (PV) 可反演性的核心思想，我们首先从一个简化的浅水系统入手。这个练习将引导你推导一个线性化的位涡反演关系，它通过一个亥姆霍兹型方程将位涡异常与流函数或高度场联系起来。通过求解一个给定的正弦位涡异常所对应的平衡流场，你将亲身体验位涡分布如何唯一地决定质量场和风场，这是位涡思维的基石。",
            "id": "4077245",
            "problem": "考虑一个单层浅水系统，其位于一个无辐散、无界的区域上，具有恒定的背景层厚度 $H$、恒定的科里奥利参数 $f$ 和重力加速度 $g$。假设罗斯贝数很小，使得水平动量处于地转平衡状态，并只关注平衡的、缓慢变化的运动。设层厚度为 $h(x,y,t) = H + \\eta(x,y,t)$，其中 $|\\eta| \\ll H$，并通过流函数 $\\psi(x,y,t)$ 定义水平地转速度 $u = -\\partial \\psi/\\partial y$ 和 $v = \\partial \\psi/\\partial x$，地转平衡关系为 $u = -(g/f)\\,\\partial \\eta/\\partial y$，$v = (g/f)\\,\\partial \\eta/\\partial x$。\n\n定义绝对涡度 $\\zeta_{a} = \\zeta + f$，其中相对涡度 $\\zeta = \\partial v/\\partial x - \\partial u/\\partial y$，浅水位涡 (PV) 定义为 $q = \\zeta_{a}/h$。考虑围绕静止状态（$H$ 为常数且 $u=v=0$）的扰动，并定义线性位涡异常 $q' = q - f/H$。引入无量纲位涡异常 $\\tilde{q} = H q'/f$。\n\n施加一个给定的、稳定的、水平周期性的无量纲位涡异常，其形式为\n$$\n\\tilde{q}(x) = A \\cos(k x),\n$$\n其中波数 $k > 0$，振幅 $A$ 为常数（无量纲），且不依赖于 $y$。假设扰动在无穷远处衰减，并且没有外部强迫或耗散。\n\n从浅水定义和地转平衡出发，对位涡绕基态进行线性化，并推导连接地转流函数 $\\psi$ 和位涡异常的平衡可逆性关系。然后反演该关系，求出相应的地转高度扰动 $\\eta$ 和风场。最后，确定唯一的常系数 $C$，使得无量纲高度扰动 $h'(x)/H = \\eta(x)/H$ 可以写成\n$$\n\\frac{h'(x)}{H} = C \\cos(k x),\n$$\n并将 $C$ 完全用 $A$、$k$ 和罗斯贝变形半径 $L_{d} = \\sqrt{g H}/f$ 表示。由于 $C$ 是无量纲的，最终表达式中不需要单位。",
            "solution": "本题的目标是在一个线性化的浅水系统中，找到关联无量纲位涡 (PV) 异常与由此产生的无量纲地转高度扰动的系数 $C$。这首先需要推导位涡可逆性关系。\n\n浅水位涡 $q$ 定义为绝对涡度 $\\zeta_a$ 与总流体深度 $h$ 之比：\n$$\nq = \\frac{\\zeta_a}{h} = \\frac{\\zeta + f}{h}\n$$\n其中 $f$ 是恒定的科里奥利参数，$\\zeta = \\partial v/\\partial x - \\partial u/\\partial y$ 是相对涡度，$h(x,y,t) = H + \\eta(x,y,t)$ 是层厚度，其中 $H$ 是恒定的平均厚度，$\\eta$ 是扰动。\n\n在缓慢变化的运动满足地转平衡的假设下，速度分量 $(u, v)$ 通过地转流函数 $\\psi$ 与 $u = -\\partial \\psi/\\partial y$ 和 $v = \\partial \\psi/\\partial x$ 相关。相对涡度则由流函数的拉普拉斯算子给出：\n$$\n\\zeta = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\psi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\psi}{\\partial y}\\right) = \\nabla^2 \\psi\n$$\n地转平衡方程也将速度与高度扰动 $\\eta$ 联系起来：\n$$\nu = -\\frac{g}{f}\\frac{\\partial \\eta}{\\partial y} \\quad , \\quad v = \\frac{g}{f}\\frac{\\partial \\eta}{\\partial x}\n$$\n比较用 $\\psi$ 和 $\\eta$ 表示的速度分量表达式，我们看到 $\\partial \\psi/\\partial y = (g/f)\\partial \\eta/\\partial y$ 和 $\\partial \\psi/\\partial x = (g/f)\\partial \\eta/\\partial x$。对这些关系式进行积分，得到流函数和高度扰动之间的直接关系，该关系相差一个空间常数，为方便起见可设为零：\n$$\n\\psi = \\frac{g}{f} \\eta \\quad \\text{或} \\quad \\eta = \\frac{f}{g} \\psi\n$$\n我们现在对位涡表达式围绕静止状态（$u=v=0$, $\\zeta=0$, $\\eta=0$）进行线性化，此时位涡为 $q_0 = f/H$。对于小扰动，有 $|\\eta| \\ll H$ 和 $|\\zeta| \\ll f$。\n$$\nq = \\frac{f + \\nabla^2 \\psi}{H + \\eta} = \\frac{f + \\nabla^2 \\psi}{H(1 + \\eta/H)} \\approx \\frac{1}{H}(f + \\nabla^2 \\psi)\\left(1 - \\frac{\\eta}{H}\\right)\n$$\n展开并仅保留扰动量（$\\psi$ 和 $\\eta$）的一次项，我们忽略小项的乘积 $(\\nabla^2 \\psi)(\\eta/H)$：\n$$\nq \\approx \\frac{f}{H} - \\frac{f \\eta}{H^2} + \\frac{\\nabla^2 \\psi}{H}\n$$\n线性位涡异常 $q'$ 定义为 $q' = q - q_0 = q - f/H$。因此，\n$$\nq' \\approx \\frac{\\nabla^2 \\psi}{H} - \\frac{f \\eta}{H^2}\n$$\n现在，我们将 $\\eta = (f/g)\\psi$ 代入此表达式，以获得一个仅用 $\\psi$ 表示的关系式：\n$$\nq' = \\frac{\\nabla^2 \\psi}{H} - \\frac{f}{H^2}\\left(\\frac{f}{g}\\psi\\right) = \\frac{1}{H}\\left(\\nabla^2 \\psi - \\frac{f^2}{gH}\\psi\\right)\n$$\n问题将罗斯贝变形半径定义为 $L_d = \\sqrt{g H}/f$，因此其平方为 $L_d^2 = gH/f^2$。所以 $f^2/(gH)$ 项等于 $1/L_d^2$。线性化的位涡可逆性关系是：\n$$\nq' = \\frac{1}{H}\\left(\\nabla^2 \\psi - \\frac{1}{L_d^2}\\psi\\right)\n$$\n这是一个连接位涡异常 $q'$ 和流函数 $\\psi$ 的亥姆霍兹型椭圆方程。\n\n接下来，我们使用给定的无量纲位涡异常 $\\tilde{q}(x) = A \\cos(k x)$。$\\tilde{q}$ 和 $q'$ 之间的关系是 $\\tilde{q} = H q'/f$，这意味着 $q' = (f/H)\\tilde{q}$。将其代入可逆性方程：\n$$\n\\frac{f}{H}\\tilde{q} = \\frac{1}{H}\\left(\\nabla^2 \\psi - \\frac{1}{L_d^2}\\psi\\right)\n$$\n$$\nf\\tilde{q} = \\nabla^2 \\psi - \\frac{1}{L_d^2}\\psi\n$$\n问题指明 $\\tilde{q}$ 仅依赖于 $x$，因此我们假设响应 $\\psi$ 也仅依赖于 $x$，即 $\\psi = \\psi(x)$。拉普拉斯算子变为 $\\nabla^2 = d^2/dx^2$。$\\psi$ 的控制方程为：\n$$\nf A \\cos(k x) = \\frac{d^2 \\psi}{dx^2} - \\frac{1}{L_d^2}\\psi\n$$\n我们寻找形式为 $\\psi(x) = \\Psi_0 \\cos(k x)$ 的周期解，其中 $\\Psi_0$ 是流函数的恒定振幅。将此拟设解代入微分方程：\n$$\n\\frac{d^2}{dx^2}(\\Psi_0 \\cos(k x)) = -k^2 \\Psi_0 \\cos(k x)\n$$\n于是，方程变为：\n$$\nf A \\cos(k x) = -k^2 \\Psi_0 \\cos(k x) - \\frac{1}{L_d^2} \\Psi_0 \\cos(k x)\n$$\n为使此方程对所有 $x$ 成立，两边 $\\cos(k x)$ 的系数必须相等：\n$$\nf A = -k^2 \\Psi_0 - \\frac{1}{L_d^2} \\Psi_0 = -\\Psi_0 \\left(k^2 + \\frac{1}{L_d^2}\\right)\n$$\n解出流函数振幅 $\\Psi_0$：\n$$\n\\Psi_0 = -\\frac{f A}{k^2 + 1/L_d^2}\n$$\n相应的地转高度扰动 $\\eta(x)$ 可通过 $\\eta = (f/g)\\psi$ 求出：\n$$\n\\eta(x) = \\frac{f}{g} \\psi(x) = \\frac{f}{g} \\left(-\\frac{f A}{k^2 + 1/L_d^2}\\right) \\cos(k x) = -\\frac{f^2 A}{g(k^2 + 1/L_d^2)} \\cos(k x)\n$$\n问题要求的是无量纲高度扰动 $\\eta(x)/H$ 表达式中的系数 $C$：\n$$\n\\frac{\\eta(x)}{H} = -\\frac{f^2 A}{g H (k^2 + 1/L_d^2)} \\cos(k x)\n$$\n通过将其与形式 $\\frac{\\eta(x)}{H} = C \\cos(k x)$ 进行比较，我们确定系数 $C$ 为：\n$$\nC = -\\frac{f^2 A}{g H (k^2 + 1/L_d^2)}\n$$\n为了将 $C$ 完全用 $A$、$k$ 和 $L_d$ 表示，我们使用关系式 $1/L_d^2 = f^2/(gH)$：\n$$\nC = -A \\frac{f^2/(gH)}{k^2 + 1/L_d^2} = -A \\frac{1/L_d^2}{k^2 + 1/L_d^2}\n$$\n将分子和分母同乘以 $L_d^2$ 可简化表达式：\n$$\nC = -A \\frac{1}{L_d^2(k^2 + 1/L_d^2)} = -\\frac{A}{k^2 L_d^2 + 1}\n$$\n为完整起见，风场的分量为 $u=0$（因为 $\\psi$ 不依赖于 $y$）和 $v = \\partial\\psi/\\partial x$：\n$$\nv(x) = \\frac{\\partial}{\\partial x}\\left(\\Psi_0 \\cos(k x)\\right) = -k \\Psi_0 \\sin(k x) = -k \\left(-\\frac{f A}{k^2 + 1/L_d^2}\\right) \\sin(k x) = \\frac{k f A}{k^2 + 1/L_d^2} \\sin(k x)\n$$\n系数 $C$ 的最终表达式是无量纲的，符合要求。它将高度响应的振幅与位涡强迫的振幅联系起来，这种联系由无量纲参数 $k L_d$ 介导，该参数是变形半径与强迫空间尺度的比值。",
            "answer": "$$\\boxed{-\\frac{A}{1 + k^{2}L_{d}^{2}}}$$"
        },
        {
            "introduction": "在理想绝热、无摩擦的条件下，位涡是守恒的，但真实大气充满了改变位涡的物理过程。本练习将你的注意力从静态的反演关系转移到位涡的动态演变上。通过使用一个包含非绝热加热和摩擦效应的完整位涡趋势方程，你将定量计算在一个具体的大气格点上，这些非保守过程是如何作为位涡的“源”或“汇”，从而在一段时间内改变局地位涡值的。",
            "id": "4077234",
            "problem": "需要在数值天气预报（NWP）模型中，对一个中纬度对流层内的点进行埃特尔位涡（PV）诊断。埃特尔位涡定义为 $q = \\rho^{-1} \\boldsymbol{\\omega}_{a} \\cdot \\nabla \\theta$，其中 $\\rho$ 是密度，$\\boldsymbol{\\omega}_{a}$ 是绝对涡度矢量，$\\theta$ 是位温。在分析点，假设以下物理场在一个小邻域内是均匀的，并且在 $\\Delta t = 6$ 小时的时间窗口内是恒定的：\n- 密度: $\\rho = 0.8 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$。\n- 绝对涡度: $\\boldsymbol{\\omega}_{a} = \\left(2.0 \\times 10^{-4}, \\ -1.0 \\times 10^{-4}, \\ 1.0 \\times 10^{-4}\\right) \\ \\mathrm{s}^{-1}$。\n- 位温梯度: $\\nabla \\theta = \\left(1.5 \\times 10^{-5}, \\ -2.0 \\times 10^{-5}, \\ 1.2 \\times 10^{-2}\\right) \\ \\mathrm{K} \\ \\mathrm{m}^{-1}$。\n- 非绝热加热率梯度: $\\nabla \\dot{\\theta} = \\left(4.0 \\times 10^{-11}, \\ -2.0 \\times 10^{-11}, \\ -3.0 \\times 10^{-8}\\right) \\ \\mathrm{K} \\ \\mathrm{s}^{-1} \\ \\mathrm{m}^{-1}$。\n- 单位质量非保守力（摩擦力）的旋度: $\\nabla \\times \\boldsymbol{F} = \\left(1.0 \\times 10^{-9}, \\ -1.0 \\times 10^{-9}, \\ 5.0 \\times 10^{-9}\\right) \\ \\mathrm{s}^{-2}$。\n\n从旋转坐标系中包含单位质量非保守力 $\\boldsymbol{F}$ 的可压缩运动方程和热力学方程 $D\\theta/Dt = \\dot{\\theta}$ 出发，使用基本定律和定义推导出埃特尔位涡的物质导数 $Dq/Dt$，包括由非绝热加热和摩擦引起的源项和汇项。然后，在所述的均匀性和恒定性假设下，计算分析点在时间窗口 $\\Delta t$ 内的净位涡变化量 $\\Delta q$。\n\n将您的最终答案以位涡单位（PVU）表示，定义为 $1 \\ \\mathrm{PVU} = 10^{-6} \\ \\mathrm{K} \\ \\mathrm{m}^{2} \\ \\mathrm{kg}^{-1} \\ \\mathrm{s}^{-1}$。将您的答案四舍五入到三位有效数字。",
            "solution": "埃特尔位涡（PV）定义为\n$$\nq \\equiv \\frac{1}{\\rho} \\boldsymbol{\\omega}_{a} \\cdot \\nabla \\theta,\n$$\n其中 $\\boldsymbol{\\omega}_{a} = \\nabla \\times \\boldsymbol{v} + 2 \\boldsymbol{\\Omega}$ 是绝对涡度，$\\rho$ 是密度，$\\theta$ 是位温。在绝热无粘性流中，$q$ 是物质守恒的。在存在非绝热加热和摩擦的情况下，$q$ 根据从控制方程推导出的源项和汇项演变。\n\n我们从旋转坐标系中的可压缩动量方程开始，\n$$\n\\frac{D \\boldsymbol{v}}{D t} + 2 \\boldsymbol{\\Omega} \\times \\boldsymbol{v} = - \\frac{1}{\\rho} \\nabla p + \\boldsymbol{g} + \\boldsymbol{F},\n$$\n连续性方程，\n$$\n\\frac{D \\rho}{D t} + \\rho \\, \\nabla \\cdot \\boldsymbol{v} = 0,\n$$\n以及位温的热力学方程，\n$$\n\\frac{D \\theta}{D t} = \\dot{\\theta}.\n$$\n对 $q$ 求物质导数可得\n$$\n\\frac{D q}{D t} = \\frac{D}{D t}\\left( \\frac{1}{\\rho} \\boldsymbol{\\omega}_{a} \\cdot \\nabla \\theta \\right)\n= \\frac{1}{\\rho} \\frac{D \\boldsymbol{\\omega}_{a}}{D t} \\cdot \\nabla \\theta + \\frac{1}{\\rho} \\boldsymbol{\\omega}_{a} \\cdot \\frac{D (\\nabla \\theta)}{D t} - \\frac{q}{\\rho} \\frac{D \\rho}{D t}.\n$$\n使用连续性方程替换 $D \\rho / D t = - \\rho \\, \\nabla \\cdot \\boldsymbol{v}$，最后一项变为 $q \\, \\nabla \\cdot \\boldsymbol{v}$。梯度的物质导数是\n$$\n\\frac{D (\\nabla \\theta)}{D t} = \\nabla \\left( \\frac{D \\theta}{D t} \\right) - (\\nabla \\boldsymbol{v})^{\\top} \\cdot \\nabla \\theta = \\nabla \\dot{\\theta} - (\\nabla \\boldsymbol{v})^{\\top} \\cdot \\nabla \\theta.\n$$\n绝对涡度的演变可以写成（使用旋转坐标系中包含单位质量非保守力 $\\boldsymbol{F}$ 的可压缩流的标准涡度恒等式），\n$$\n\\frac{D \\boldsymbol{\\omega}_{a}}{D t} = (\\boldsymbol{\\omega}_{a} \\cdot \\nabla) \\boldsymbol{v} - \\boldsymbol{\\omega}_{a} \\, \\nabla \\cdot \\boldsymbol{v} + \\frac{1}{\\rho^{2}} \\nabla \\rho \\times \\nabla p + \\nabla \\times \\boldsymbol{F}.\n$$\n将这些代入 $Dq/Dt$ 并合并各项，得到\n$$\n\\frac{D q}{D t}\n= \\frac{1}{\\rho} \\left[ \\left( (\\boldsymbol{\\omega}_{a} \\cdot \\nabla) \\boldsymbol{v} - \\boldsymbol{\\omega}_{a} \\, \\nabla \\cdot \\boldsymbol{v} + \\frac{1}{\\rho^{2}} \\nabla \\rho \\times \\nabla p + \\nabla \\times \\boldsymbol{F} \\right) \\cdot \\nabla \\theta \\right]\n+ \\frac{1}{\\rho} \\boldsymbol{\\omega}_{a} \\cdot \\left( \\nabla \\dot{\\theta} - (\\nabla \\boldsymbol{v})^{\\top} \\cdot \\nabla \\theta \\right)\n+ q \\, \\nabla \\cdot \\boldsymbol{v}.\n$$\n使用恒等式\n$$\n\\left( (\\boldsymbol{\\omega}_{a} \\cdot \\nabla) \\boldsymbol{v} \\right) \\cdot \\nabla \\theta\n= \\boldsymbol{\\omega}_{a} \\cdot \\left( (\\nabla \\boldsymbol{v})^{\\top} \\cdot \\nabla \\theta \\right),\n$$\n它抵消了来自 $\\boldsymbol{\\omega}_{a} \\cdot \\left( - (\\nabla \\boldsymbol{v})^{\\top} \\cdot \\nabla \\theta \\right)$ 的相应项。同样，可压缩性项也相互抵消：$-(\\boldsymbol{\\omega}_{a} \\, \\nabla \\cdot \\boldsymbol{v}) \\cdot \\nabla \\theta / \\rho + q \\, \\nabla \\cdot \\boldsymbol{v} = 0$，因为 $q = \\rho^{-1} \\boldsymbol{\\omega}_{a} \\cdot \\nabla \\theta$。由于 $\\theta$ 定义为熵的单调函数，这保证了 $\\nabla \\rho \\times \\nabla p$ 与 $\\nabla \\theta$ 正交，因此对于埃特尔位涡，斜压扭矩项 $(\\rho^{-2} \\nabla \\rho \\times \\nabla p) \\cdot \\nabla \\theta$ 为零。因此我们得到了包含非绝热源和摩擦源的标准埃特尔位涡倾向方程：\n$$\n\\frac{D q}{D t} = \\frac{1}{\\rho} \\left( \\boldsymbol{\\omega}_{a} \\cdot \\nabla \\dot{\\theta} + \\nabla \\theta \\cdot (\\nabla \\times \\boldsymbol{F}) \\right).\n$$\n\n在所述的场是均匀且在时间窗口内恒定的假设下，$\\Delta t$ 内的净位涡变化为\n$$\n\\Delta q = \\left( \\frac{D q}{D t} \\right) \\Delta t.\n$$\n我们现在对源项进行数值计算。\n\n首先，计算非绝热项：\n$$\n\\boldsymbol{\\omega}_{a} \\cdot \\nabla \\dot{\\theta}\n= (2.0 \\times 10^{-4})(4.0 \\times 10^{-11}) + (-1.0 \\times 10^{-4})(-2.0 \\times 10^{-11}) + (1.0 \\times 10^{-4})(-3.0 \\times 10^{-8}).\n$$\n计算每个乘积：\n$$\n(2.0 \\times 10^{-4})(4.0 \\times 10^{-11}) = 8.0 \\times 10^{-15},\n$$\n$$\n(-1.0 \\times 10^{-4})(-2.0 \\times 10^{-11}) = 2.0 \\times 10^{-15},\n$$\n$$\n(1.0 \\times 10^{-4})(-3.0 \\times 10^{-8}) = -3.0 \\times 10^{-12}.\n$$\n因此，\n$$\n\\boldsymbol{\\omega}_{a} \\cdot \\nabla \\dot{\\theta} = -2.99 \\times 10^{-12} \\ \\mathrm{K} \\ \\mathrm{s}^{-2} \\ \\mathrm{m}^{-1}.\n$$\n\n接下来，计算摩擦项：\n$$\n\\nabla \\theta \\cdot (\\nabla \\times \\boldsymbol{F})\n= (1.5 \\times 10^{-5})(1.0 \\times 10^{-9}) + (-2.0 \\times 10^{-5})(-1.0 \\times 10^{-9}) + (1.2 \\times 10^{-2})(5.0 \\times 10^{-9}).\n$$\n计算每个乘积：\n$$\n(1.5 \\times 10^{-5})(1.0 \\times 10^{-9}) = 1.5 \\times 10^{-14},\n$$\n$$\n(-2.0 \\times 10^{-5})(-1.0 \\times 10^{-9}) = 2.0 \\times 10^{-14},\n$$\n$$\n(1.2 \\times 10^{-2})(5.0 \\times 10^{-9}) = 6.0 \\times 10^{-11}.\n$$\n因此，\n$$\n\\nabla \\theta \\cdot (\\nabla \\times \\boldsymbol{F}) = 6.0035 \\times 10^{-11} \\ \\mathrm{K} \\ \\mathrm{m}^{-1} \\ \\mathrm{s}^{-2}.\n$$\n\n将两个源项相加并除以 $\\rho$：\n$$\n\\frac{D q}{D t} = \\frac{1}{\\rho} \\left[ \\boldsymbol{\\omega}_{a} \\cdot \\nabla \\dot{\\theta} + \\nabla \\theta \\cdot (\\nabla \\times \\boldsymbol{F}) \\right]\n= \\frac{1}{0.8} \\left( -2.99 \\times 10^{-12} + 6.0035 \\times 10^{-11} \\right).\n$$\n计算括号中的和：\n$$\n-2.99 \\times 10^{-12} + 6.0035 \\times 10^{-11} = 5.7045 \\times 10^{-11}.\n$$\n因此，\n$$\n\\frac{D q}{D t} = \\frac{5.7045 \\times 10^{-11}}{0.8} = 7.130625 \\times 10^{-11} \\ \\mathrm{K} \\ \\mathrm{m}^{2} \\ \\mathrm{kg}^{-1} \\ \\mathrm{s}^{-2}.\n$$\n\n在 $\\Delta t = 6$ 小时 $= 6 \\times 3600 = 21600 \\ \\mathrm{s}$ 的时间里，净位涡变化为\n$$\n\\Delta q = \\left( 7.130625 \\times 10^{-11} \\right) \\times 21600 = 1.540215 \\times 10^{-6} \\ \\mathrm{K} \\ \\mathrm{m}^{2} \\ \\mathrm{kg}^{-1} \\ \\mathrm{s}^{-1}.\n$$\n转换为位涡单位（PVU），其中 $1 \\ \\mathrm{PVU} = 10^{-6} \\ \\mathrm{K} \\ \\mathrm{m}^{2} \\ \\mathrm{kg}^{-1} \\ \\mathrm{s}^{-1}$，得到\n$$\n\\Delta q = 1.540215 \\ \\mathrm{PVU}.\n$$\n四舍五入到三位有效数字，所求的净位涡变化为\n$$\n\\Delta q = 1.54 \\ \\mathrm{PVU}.\n$$",
            "answer": "$$\\boxed{1.54}$$"
        },
        {
            "introduction": "分块位涡反演 (Piecewise PV inversion) 是位涡诊断学中一项极为强大的技术。由于（准地转）位涡反演算子是线性的，我们可以将一个复杂的总位涡场分解为由不同天气系统（如高空槽、地面气旋等）贡献的若干部分。这个动手实践将指导你通过编写一个数值求解器，分别反演两个独立的位涡异常，并分析它们各自产生的流场以及相互作用对总动能的贡献。这个练习不仅能让你掌握数值反演的技能，还能深刻揭示即使速度场是线性叠加的，动能的归因也是非线性的。",
            "id": "4077232",
            "problem": "考虑一个在边长为 $L_x$ 和 $L_y$ 的双周期域上的正压准地转（QG）流，其科里奥利参数 $f_0$ 为常数。在正压准地转近似下，位涡（PV）异常 $q'$ 通过泊松方程 $q' = \\nabla^2 \\psi$ 与流函数 $\\psi$ 相关。地转速度场 $(u,v)$ 由 $u = -\\partial \\psi / \\partial y$ 和 $v = \\partial \\psi / \\partial x$ 给出。单位质量动能定义为 $K = \\frac{1}{2} (u^2 + v^2)$。目标是执行分块 PV 反演和归因诊断：构建 PV 子场 $q_A$ 和 $q_B$，分别和联合地对它们进行反演，并量化它们的贡献如何结合以产生总动能。\n\n基本原理：\n- 使用正压准地转（QG）位涡（PV）异常 $q'$ 的定义，在具有周期性边界条件的二维域上 $q' = \\nabla^2 \\psi$。\n- 使用离散傅里叶变换（DFT）表示场并在谱空间中计算空间导数。使用周期域长度 $L_x$ 和 $L_y$ 定义波数 $k_x$ 和 $k_y$，其中 $k_x = 2\\pi n_x / L_x$ 和 $k_y = 2\\pi n_y / L_y$，$n_x$ 和 $n_y$ 是整数模态指数。\n- 在谱空间中实现泊松方程的反演，通过求解 $\\psi$ 使其拉普拉斯算子与 $q'$ 匹配，确保在反演前通过移除 $q$ 的域平均值来正确处理零波数模态。将 $\\psi$ 的零波数分量设置为零以固定规范，因为向 $\\psi$ 添加任何常数都不会改变 $(u,v)$。\n\n您的任务：\n1. 将两个 PV 异常子场 $q_A(x,y)$ 和 $q_B(x,y)$ 构建为域上的各向同性高斯函数，并将总 PV 异常定义为其和 $q(x,y) = q_A(x,y) + q_B(x,y)$。每个高斯函数由振幅 $A$（单位为 $\\mathrm{s}^{-1}$）、径向尺度（标准差）$\\sigma$（单位为 $\\mathrm{m}$）和中心 $(x_0,y_0)$（单位为 $\\mathrm{m}$）通过以下公式定义：\n   $$ q_G(x,y) = A \\exp\\left(-\\frac{(x-x_0)^2+(y-y_0)^2}{2\\sigma^2}\\right). $$\n   为了进行反演，从每个场中移除域平均值：使用 $q'_A = q_A - \\langle q_A \\rangle$，$q'_B = q_B - \\langle q_B \\rangle$ 和 $q' = q - \\langle q \\rangle$。\n2. 使用谱方法，在周期性边界条件下反演 $q'_A$、$q'_B$ 和 $q'$，以分别获得 $\\psi_A$、$\\psi_B$ 和 $\\psi$。基于泊松方程推导 $q'$ 和 $\\psi$ 之间的谱关系，并以数值方式实现它。确保将 $\\psi$ 的零波数模态设置为零。\n3. 使用谱微分，分别从 $\\psi_A$、$\\psi_B$ 和 $\\psi$ 计算地转速度 $(u_A,v_A)$、$(u_B,v_B)$ 和 $(u,v)$。验证速度的线性叠加，即检查 $(u,v)$ 是否在数值精度范围内等于 $(u_A+u_B, v_A+v_B)$。\n4. 计算单位质量的域平均动能（单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$）：$K_{\\text{tot}} = \\langle \\frac{1}{2}(u^2+v^2) \\rangle$、$K_A = \\langle \\frac{1}{2}(u_A^2+v_A^2) \\rangle$ 和 $K_B = \\langle \\frac{1}{2}(u_B^2+v_B^2) \\rangle$。量化由分块贡献之间的相互作用引起的非可加性交叉项 $K_\\times = K_{\\text{tot}} - K_A - K_B$。\n5. 作为可反演性诊断，使用 $q'_{\\text{rec}} = \\nabla^2 \\psi$ 在谱空间中从 $\\psi$ 计算重构的 PV 异常 $q'_{\\text{rec}}$。计算相对均方根误差 $E = \\|q' - q'_{\\text{rec}}\\|_2 / \\|q'\\|_2$，并返回一个布尔值，指示 $E \\le 10^{-11}$ 是否成立。\n\n物理和数值单位：\n- $L_x$、$L_y$、$\\sigma$、$x_0$ 和 $y_0$ 的单位必须是米（$\\mathrm{m}$）。\n- PV 振幅 $A$ 的单位必须是秒的倒数（$\\mathrm{s}^{-1}$）。\n- 速度的计算单位必须是米每秒（$\\mathrm{m}\\,\\mathrm{s}^{-1}$）。\n- 动能必须以域平均值的形式返回，单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$。\n- 不使用角度；不需要角度单位。\n\n测试套件：\n实现您的程序以运行以下四个测试用例。每个用例由 $(N_x,N_y,L_x,L_y,A_A,A_B,\\sigma_A,\\sigma_B,x_{0A},y_{0A},x_{0B},y_{0B})$ 定义：\n\n- 用例 1（一般情况，两个符号相反的异常）：$(64,64,1.0\\times 10^6,1.0\\times 10^6,5.0\\times 10^{-5},-4.0\\times 10^{-5},1.2\\times 10^5,1.8\\times 10^5,3.0\\times 10^5,7.0\\times 10^5,7.0\\times 10^5,3.0\\times 10^5)$。\n- 用例 2（边界情况，只有一个异常）：$(64,64,1.0\\times 10^6,1.0\\times 10^6,4.0\\times 10^{-5},0.0,1.5\\times 10^5,1.0\\times 10^5,5.0\\times 10^5,5.0\\times 10^5,2.0\\times 10^5,8.0\\times 10^5)$。\n- 用例 3（边缘情况，具有两个正异常的高波数内容）：$(64,64,1.0\\times 10^6,1.0\\times 10^6,6.0\\times 10^{-5},6.0\\times 10^{-5},8.0\\times 10^4,1.0\\times 10^5,2.5\\times 10^5,2.5\\times 10^5,7.5\\times 10^5,7.5\\times 10^5)$。\n- 用例 4（边缘情况，邻近的相反异常导致抵消）：$(64,64,1.0\\times 10^6,1.0\\times 10^6,5.0\\times 10^{-5},-5.0\\times 10^{-5},1.2\\times 10^5,1.2\\times 10^5,4.5\\times 10^5,5.5\\times 10^5,5.5\\times 10^5,4.5\\times 10^5)$。\n\n对于每个测试用例，计算并返回一个包含五个条目的列表：\n- $K_{\\text{tot}}$（浮点数，单位 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$），\n- $K_A$（浮点数，单位 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$），\n- $K_B$（浮点数，单位 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$），\n- $K_\\times$（浮点数，单位 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$），\n- 可反演性布尔值（如果 $E \\le 10^{-11}$ 则为 true，否则为 false）。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，该列表由每个测试用例的结果列表组成，并用方括号括起来。例如，输出应如下所示：\n\"[[K_tot1,K_A1,K_B1,K_cross1,inv_ok1],[K_tot2,K_A2,K_B2,K_cross2,inv_ok2],[K_tot3,K_A3,K_B3,K_cross3,inv_ok3],[K_tot4,K_A4,K_B4,K_cross4,inv_ok4]]\"。",
            "solution": "该问题提法恰当且科学上合理，是地球物理流体动力学中的一个标准数值练习。我们将给出一个完整的解决方案。\n\n**1. 控制方程与离散化**\n\nPV 异常 $q'$ 与地转流函数 $\\psi$ 之间的基本关系由泊松方程给出：\n$$ q'(x,y) = \\nabla^2 \\psi(x,y) = \\left(\\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}\\right) \\psi(x,y) $$\n域是一个具有周期性边界条件的矩形 $(x,y) \\in [0, L_x) \\times [0, L_y)$。地转速度分量 $(u,v)$ 从流函数导出：\n$$ u(x,y) = -\\frac{\\partial \\psi}{\\partial y}, \\quad v(x,y) = \\frac{\\partial \\psi}{\\partial x} $$\n该问题在大小为 $N_x \\times N_y$ 的离散网格上进行数值求解。\n\n**2. 用于 PV 反演的谱方法**\n\n双周期域的使用使得离散傅里叶变换（DFT）成为一种极其高效和精确的工具。物理空间中的场 $f(x,y)$ 可以由其在谱空间中的复傅里叶系数 $\\hat{f}(k_x, k_y)$ 表示。\n\n傅里叶变换的关键特性是物理空间中的微分变成了谱空间中的乘法。具体来说，$\\mathcal{F}\\{\\frac{\\partial f}{\\partial x}\\} = i k_x \\hat{f}$ 和 $\\mathcal{F}\\{\\frac{\\partial f}{\\partial y}\\} = i k_y \\hat{f}$，其中 $i=\\sqrt{-1}$，$k_x$ 和 $k_y$ 是波数。波数由域大小和网格分辨率定义：\n$$ k_x = \\frac{2\\pi n_x}{L_x}, \\quad k_y = \\frac{2\\pi n_y}{L_y} $$\n对于整数模态指数 $n_x \\in [ -N_x/2+1, ..., N_x/2 ]$ 和 $n_y \\in [ -N_y/2+1, ..., N_y/2 ]$。\n\n将二维傅里叶变换 $\\mathcal{F}$ 应用于泊松方程，得到：\n$$ \\hat{q}'(k_x, k_y) = \\mathcal{F}\\{\\nabla^2 \\psi\\} = \\mathcal{F}\\left\\{\\frac{\\partial^2 \\psi}{\\partial x^2}\\right\\} + \\mathcal{F}\\left\\{\\frac{\\partial^2 \\psi}{\\partial y^2}\\right\\} = ((i k_x)^2 + (i k_y)^2) \\hat{\\psi} = -(k_x^2 + k_y^2) \\hat{\\psi} $$\n令 $k^2 = k_x^2 + k_y^2$。谱空间中的方程为 $\\hat{q}' = -k^2 \\hat{\\psi}$。\n\n这种代数关系允许直接反演，从 $\\hat{q}'$ 求得 $\\hat{\\psi}$：\n$$ \\hat{\\psi}(k_x, k_y) = -\\frac{\\hat{q}'(k_x, k_y)}{k^2} $$\n此反演仅在 $k^2 \\neq 0$ 时有定义。\n\n对于零波数模态（$k_x=0, k_y=0$，因此 $k^2=0$），必须满足两个条件：\n1.  **可解性条件**：分子 $\\hat{q}'(0,0)$ 必须为零。零波数傅里叶系数与场的域平均值成正比。因此，我们必须使用一个零平均值的 PV 异常场。这通过计算 $q' = q - \\langle q \\rangle$ 来实现，其中 $\\langle \\cdot \\rangle$ 表示空间平均。\n2.  **规范固定**：$\\hat{\\psi}(0,0)$ 的值是不确定的。这对应于向 $\\psi$ 添加任意常数不会改变速度场这一事实。我们通过设置 $\\hat{\\psi}(0,0) = 0$ 来固定此规范。\n\nPV 反演的完整算法如下：\n1.  给定 PV 场 $q(x,y)$，计算其异常 $q'(x,y) = q(x,y) - \\langle q(x,y) \\rangle$。\n2.  计算其傅里叶变换 $\\hat{q}'(k_x,k_y) = \\mathcal{F}\\{q'\\}$。\n3.  通过设置 $\\hat{\\psi}(0,0) = 0$ 并对所有其他波数设置 $\\hat{\\psi}(k_x, k_y) = -\\hat{q}'(k_x, k_y) / (k_x^2 + k_y^2)$ 来计算谱流函数 $\\hat{\\psi}$。\n4.  计算物理空间流函数 $\\psi(x,y) = \\mathcal{F}^{-1}\\{\\hat{\\psi}\\}$。\n\n**3. 速度和动能计算**\n\n一旦 $\\hat{\\psi}$ 已知，速度的谱表示为：\n$$ \\hat{u}(k_x, k_y) = -i k_y \\hat{\\psi}(k_x, k_y) $$\n$$ \\hat{v}(k_x, k_y) = i k_x \\hat{\\psi}(k_x, k_y) $$\n物理速度场 $u(x,y)$ 和 $v(x,y)$ 是通过应用傅里叶逆变换获得的。单位质量动能为 $K = \\frac{1}{2}(u^2+v^2)$，我们需要计算其域平均值 $\\langle K \\rangle$。\n\n**4. 分块反演与能量归因**\n\n总 PV 是两个分量的和，$q = q_A + q_B$。由于反演过程（移除平均值、FFT、除以 $-k^2$、IFFT）是线性的，因此得到的总流函数是来自分量流函数的和：$\\psi = \\psi_A + \\psi_B$。因此，总速度也是一个线性叠加：$\\mathbf{v} = \\mathbf{v}_A + \\mathbf{v}_B$。\n\n然而，动能是一个二次量，不能线性叠加。总域平均动能 $K_{\\text{tot}}$ 为：\n$$ K_{\\text{tot}} = \\left\\langle \\frac{1}{2} (\\mathbf{v}_A+\\mathbf{v}_B) \\cdot (\\mathbf{v}_A+\\mathbf{v}_B) \\right\\rangle = \\left\\langle \\frac{1}{2}(\\mathbf{v}_A \\cdot \\mathbf{v}_A) + \\frac{1}{2}(\\mathbf{v}_B \\cdot \\mathbf{v}_B) + \\mathbf{v}_A \\cdot \\mathbf{v}_B \\right\\rangle $$\n$$ K_{\\text{tot}} = K_A + K_B + K_\\times $$\n其中 $K_A = \\langle \\frac{1}{2}(u_A^2+v_A^2) \\rangle$ 和 $K_B = \\langle \\frac{1}{2}(u_B^2+v_B^2) \\rangle$ 是各分量的能量，而 $K_\\times = \\langle u_A u_B + v_A v_B \\rangle$ 是交叉项或相互作用能。该项量化了由两个 PV 异常引起的流场之间的相长或相消干涉。\n\n**5. 可反演性诊断**\n\n为了验证数值实现，我们执行一个往返计算。我们从总 PV 异常 $q'$ 开始，将其反演得到 $\\psi$，然后将正向算子 $\\nabla^2$ 应用于 $\\psi$ 以获得重构的 PV 异常 $q'_{\\text{rec}}$。\n$$ q'_{\\text{rec}} = \\nabla^2 \\psi $$\n在谱空间中，这很简单，即 $\\hat{q}'_{\\text{rec}} = -k^2 \\hat{\\psi}$。\n理论上，$q'_{\\text{rec}}$ 应与 $q'$ 完全相同。我们通过相对均方根误差 $E = \\|q' - q'_{\\text{rec}}\\|_2 / \\|q'\\|_2$ 来衡量数值误差，其中 $\\|f\\|_2 = \\sqrt{\\sum f_{ij}^2}$ 是 L2 范数。一个小的 $E$ 值（例如，小于 $10^{-11}$）证实了谱计算的准确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the PV inversion test cases.\n    \"\"\"\n    test_cases = [\n        # (Nx, Ny, Lx, Ly, A_A, A_B, sigma_A, sigma_B, x0A, y0A, x0B, y0B)\n        (64, 64, 1.0e6, 1.0e6, 5.0e-5, -4.0e-5, 1.2e5, 1.8e5, 3.0e5, 7.0e5, 7.0e5, 3.0e5),\n        (64, 64, 1.0e6, 1.0e6, 4.0e-5, 0.0, 1.5e5, 1.0e5, 5.0e5, 5.0e5, 2.0e5, 8.0e5),\n        (64, 64, 1.0e6, 1.0e6, 6.0e-5, 6.0e-5, 8.0e4, 1.0e5, 2.5e5, 2.5e5, 7.5e5, 7.5e5),\n        (64, 64, 1.0e6, 1.0e6, 5.0e-5, -5.0e-5, 1.2e5, 1.2e5, 4.5e5, 5.5e5, 5.5e5, 4.5e5),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = process_case(case)\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    case_strs = []\n    for r in results:\n        bool_str = 'true' if r[4] else 'false'\n        case_strs.append(f\"[{r[0]},{r[1]},{r[2]},{r[3]},{bool_str}]\")\n    \n    final_output = f\"[{','.join(case_strs)}]\"\n    print(final_output)\n\ndef make_gaussian(X, Y, A, sigma, x0, y0):\n    \"\"\"\n    Generates a 2D Gaussian function on a grid.\n    \"\"\"\n    return A * np.exp(-((X - x0)**2 + (Y - y0)**2) / (2 * sigma**2))\n\ndef process_case(case):\n    \"\"\"\n    Processes a single test case for PV inversion and diagnostics.\n    \"\"\"\n    Nx, Ny, Lx, Ly, A_A, A_B, sigma_A, sigma_B, x0A, y0A, x0B, y0B = case\n    \n    # 1. Set up grid and wavenumbers\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    X, Y = np.meshgrid(x, y)\n\n    kx_1d = 2 * np.pi * np.fft.fftfreq(Nx, d=Lx/Nx)\n    ky_1d = 2 * np.pi * np.fft.fftfreq(Ny, d=Ly/Ny)\n    Kx, Ky = np.meshgrid(kx_1d, ky_1d)\n    \n    K_squared = Kx**2 + Ky**2\n    iKx = 1j * Kx\n    iKy = 1j * Ky\n\n    # 2. Construct PV anomaly fields\n    q_A = make_gaussian(X, Y, A_A, sigma_A, x0A, y0A)\n    q_B = make_gaussian(X, Y, A_B, sigma_B, x0B, y0B)\n    q_total = q_A + q_B\n    \n    def invert_and_differentiate(q_field):\n        \"\"\"\n        Performs PV inversion and calculates velocities for a given PV field.\n        \"\"\"\n        # A. Remove domain mean to get PV anomaly q'\n        q_prime = q_field - np.mean(q_field)\n        \n        # B. Invert for streamfunction psi in spectral space\n        q_prime_hat = np.fft.fft2(q_prime)\n        psi_hat = np.zeros_like(q_prime_hat)\n        \n        # Avoid division by zero at k=0. \n        # The (0,0) component of psi_hat remains 0, fixing the gauge.\n        nonzero_k_mask = K_squared != 0\n        psi_hat[nonzero_k_mask] = -q_prime_hat[nonzero_k_mask] / K_squared[nonzero_k_mask]\n        \n        # C. Differentiate for velocity in spectral space\n        u_hat = -iKy * psi_hat\n        v_hat = iKx * psi_hat\n        \n        # D. Inverse transform to physical space and take the real part\n        psi = np.fft.ifft2(psi_hat).real\n        u = np.fft.ifft2(u_hat).real\n        v = np.fft.ifft2(v_hat).real\n        \n        return psi, u, v\n\n    # 3. Invert the individual and total PV fields\n    psi_A, u_A, v_A = invert_and_differentiate(q_A)\n    psi_B, u_B, v_B = invert_and_differentiate(q_B)\n    psi_total, u_total, v_total = invert_and_differentiate(q_total)\n\n    # 4. Compute domain-mean kinetic energies\n    K_A = 0.5 * np.mean(u_A**2 + v_A**2)\n    K_B = 0.5 * np.mean(u_B**2 + v_B**2)\n    K_tot = 0.5 * np.mean(u_total**2 + v_total**2)\n    K_cross = K_tot - K_A - K_B\n\n    # 5. Perform the invertibility diagnostic\n    q_prime_total = q_total - np.mean(q_total)\n    \n    # Reconstruct q' from the final streamfunction psi_total\n    psi_total_hat = np.fft.fft2(psi_total)\n    q_rec_prime_hat = -K_squared * psi_total_hat\n    q_rec_prime = np.fft.ifft2(q_rec_prime_hat).real\n    \n    # Calculate the relative RMS error\n    norm_q_prime = np.linalg.norm(q_prime_total)\n    \n    if norm_q_prime == 0:\n        # If the input PV field is uniform, its anomaly is zero.\n        # The reconstruction will also be zero, so the error is zero.\n        rel_error = 0.0\n    else:\n        rel_error = np.linalg.norm(q_prime_total - q_rec_prime) / norm_q_prime\n        \n    invertibility_ok = rel_error = 1e-11\n    \n    return [K_tot, K_A, K_B, K_cross, invertibility_ok]\n\n# solve()\n```"
        }
    ]
}