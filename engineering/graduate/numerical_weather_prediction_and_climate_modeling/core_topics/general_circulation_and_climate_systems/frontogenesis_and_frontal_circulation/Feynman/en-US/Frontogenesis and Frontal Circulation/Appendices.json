{
    "hands_on_practices": [
        {
            "introduction": "Understanding frontogenesis begins with quantifying how a given flow field alters a temperature gradient. This foundational exercise  strips the problem down to its kinematic essence, providing a clear illustration of the underlying physical mechanism. By applying the material derivative to the magnitude of the potential temperature gradient within an idealized pure strain flow, you will derive the frontogenesis function from first principles and see directly how fluid deformation leads to the strengthening or weakening of a front.",
            "id": "4046338",
            "problem": "Consider a two-dimensional, inviscid, adiabatic, and Boussinesq atmosphere on a constant-pressure surface. Let the horizontal velocity field be given by $u(x,y,t)=a x$ and $v(x,y,t)=-a y$, where $a$ is a constant with units of inverse time. The potential temperature field is initially $\\theta(x,y,0)=x$. Assume the potential temperature $\\theta$ is materially conserved (no diabatic heating or diffusion), so that the scalar advection equation $D_t \\theta = \\partial_t \\theta + u \\,\\partial_x \\theta + v \\,\\partial_y \\theta = 0$ holds. Denote the horizontal gradient by $\\nabla_h \\theta = (\\partial_x \\theta, \\partial_y \\theta)$ and its squared magnitude by $|\\nabla_h \\theta|^2 = (\\partial_x \\theta)^2 + (\\partial_y \\theta)^2$. \n\nStarting from the scalar advection equation and first principles of continuum kinematics, derive the expression for the material time derivative $D_t |\\nabla_h \\theta|^2$ evaluated at $t=0$ for the given flow and initial temperature field. Then, based on the sign of the computed tendency, state whether frontogenesis (strengthening of the horizontal temperature gradient) or frontolysis (weakening of the horizontal temperature gradient) occurs at $t=0$. Provide your final answer as a closed-form analytic expression in terms of $a$. No rounding is required. Do not include any units in the final boxed expression; all interpretation of units and physical meaning should be provided in your derivation.",
            "solution": "The problem asks for the material time derivative of the squared magnitude of the horizontal potential temperature gradient, $D_t |\\nabla_h \\theta|^2$, evaluated at time $t=0$. This quantity is central to the study of frontogenesis.\n\nFirst, we perform a validation of the problem statement.\n\n**Step 1: Extract Givens**\n-   Velocity field: $u(x,y,t) = a x$ and $v(x,y,t) = -a y$, where $a$ is a constant.\n-   Initial potential temperature field: $\\theta(x,y,0) = x$.\n-   Governing equation for potential temperature: $D_t \\theta = \\partial_t \\theta + u \\,\\partial_x \\theta + v \\,\\partial_y \\theta = 0$.\n-   Definitions: $\\nabla_h \\theta = (\\partial_x \\theta, \\partial_y \\theta)$ and $|\\nabla_h \\theta|^2 = (\\partial_x \\theta)^2 + (\\partial_y \\theta)^2$.\n-   Task: Derive an expression for $D_t |\\nabla_h \\theta|^2$ at $t=0$ and determine if this corresponds to frontogenesis or frontolysis.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is set within the established framework of geophysical fluid dynamics. The governing equation $D_t \\theta = 0$ correctly represents the material conservation of potential temperature in an adiabatic flow. The velocity field describes a pure strain flow, a standard kinematic model. The initial condition is a simple linear gradient. The quantity to be calculated, $D_t |\\nabla_h \\theta|^2$, is the standard measure for the rate of frontogenesis. The problem is scientifically sound.\n-   **Well-Posed:** The problem provides a complete set of information: the flow field, the initial condition for the scalar, and the governing equation. The question is specific and C. A unique, meaningful solution can be found.\n-   **Objective:** The problem is stated using precise mathematical language, free from subjective or ambiguous terms. While the sign of the constant $a$ is not specified, this does not invalidate the derivation of the expression itself. The interpretation can be correctly conditioned on the sign of $a$.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. We proceed with the derivation.\n\nThe quantity of interest is the squared magnitude of the horizontal potential temperature gradient, given by:\n$$\n|\\nabla_h \\theta|^2 = (\\partial_x \\theta)^2 + (\\partial_y \\theta)^2\n$$\nWe need to find its material time derivative, $D_t |\\nabla_h \\theta|^2$. The material derivative operator is $D_t = \\partial_t + u \\partial_x + v \\partial_y$. Applying this operator and using the chain rule, we get:\n$$\nD_t (|\\nabla_h \\theta|^2) = D_t [(\\partial_x \\theta)^2] + D_t [(\\partial_y \\theta)^2] = 2(\\partial_x \\theta) D_t(\\partial_x \\theta) + 2(\\partial_y \\theta) D_t(\\partial_y \\theta)\n$$\nTo proceed, we must find expressions for $D_t(\\partial_x \\theta)$ and $D_t(\\partial_y \\theta)$. This requires commuting the material and spatial derivative operators. Let's consider the general commutation rule for a spatial derivative $\\partial_i$ and the material derivative $D_t$:\n$$\nD_t(\\partial_i \\theta) = (\\partial_t + u_j \\partial_j)(\\partial_i \\theta) = \\partial_t \\partial_i \\theta + u_j \\partial_j \\partial_i \\theta\n$$\nAssuming sufficient smoothness of the fields, we can interchange the order of partial derivatives:\n$$\nD_t(\\partial_i \\theta) = \\partial_i (\\partial_t \\theta) + u_j \\partial_i \\partial_j \\theta\n$$\nNow consider the spatial derivative of the material derivative of $\\theta$:\n$$\n\\partial_i(D_t \\theta) = \\partial_i(\\partial_t \\theta + u_j \\partial_j \\theta) = \\partial_i (\\partial_t \\theta) + (\\partial_i u_j)(\\partial_j \\theta) + u_j \\partial_i(\\partial_j \\theta)\n$$\nComparing the two expressions, we find the commutation relation:\n$$\nD_t(\\partial_i \\theta) = \\partial_i(D_t \\theta) - (\\partial_i u_j)(\\partial_j \\theta)\n$$\nThe problem states that potential temperature is materially conserved, so $D_t \\theta = 0$. This simplifies the commutation relation significantly:\n$$\nD_t(\\partial_i \\theta) = - (\\partial_i u_j)(\\partial_j \\theta)\n$$\nWriting this out in component form for $i=x$ (or $1$) and $i=y$ (or $2$), with summation over $j = x, y$:\n$$\nD_t(\\partial_x \\theta) = - [(\\partial_x u)(\\partial_x \\theta) + (\\partial_x v)(\\partial_y \\theta)]\n$$\n$$\nD_t(\\partial_y \\theta) = - [(\\partial_y u)(\\partial_x \\theta) + (\\partial_y v)(\\partial_y \\theta)]\n$$\nNow we substitute these expressions back into the equation for $D_t |\\nabla_h \\theta|^2$:\n$$\nD_t |\\nabla_h \\theta|^2 = 2(\\partial_x \\theta) \\{-[(\\partial_x u)(\\partial_x \\theta) + (\\partial_x v)(\\partial_y \\theta)]\\} + 2(\\partial_y \\theta) \\{-[(\\partial_y u)(\\partial_x \\theta) + (\\partial_y v)(\\partial_y \\theta)]\\}\n$$\nExpanding this gives the general expression for the frontogenesis function:\n$$\nD_t |\\nabla_h \\theta|^2 = -2 [(\\partial_x u)(\\partial_x \\theta)^2 + (\\partial_y v)(\\partial_y \\theta)^2 + (\\partial_y u + \\partial_x v)(\\partial_x \\theta)(\\partial_y \\theta)]\n$$\nNext, we evaluate this expression at $t=0$ using the specific fields given in the problem.\nFirst, we compute the derivatives of the velocity field components:\n-   $u = ax \\implies \\partial_x u = a$, $\\partial_y u = 0$\n-   $v = -ay \\implies \\partial_x v = 0$, $\\partial_y v = -a$\n\nSecond, we compute the derivatives of the initial potential temperature field:\n-   $\\theta(x,y,0) = x \\implies \\partial_x \\theta |_{t=0} = 1$, $\\partial_y \\theta |_{t=0} = 0$\n\nNow, we substitute these values into the general expression for $D_t |\\nabla_h \\theta|^2$ and evaluate at $t=0$:\n$$\nD_t |\\nabla_h \\theta|^2 |_{t=0} = -2 [(a)(1)^2 + (-a)(0)^2 + (0 + 0)(1)(0)]\n$$\n$$\nD_t |\\nabla_h \\theta|^2 |_{t=0} = -2 [a \\cdot 1 + 0 + 0]\n$$\n$$\nD_t |\\nabla_h \\theta|^2 |_{t=0} = -2a\n$$\nThis is the required expression.\n\nFinally, we interpret this result. Frontogenesis (the strengthening of the gradient) occurs when $D_t |\\nabla_h \\theta|^2 > 0$. Frontolysis (the weakening of the gradient) occurs when $D_t |\\nabla_h \\theta|^2 < 0$.\nThe sign of our result, $-2a$, depends on the sign of the constant $a$.\n-   If $a > 0$, the flow field $u=ax, v=-ay$ represents stretching along the $x$-axis and compression along the $y$-axis. The initial isotherms are vertical lines ($\\theta=x=constant$). The stretching in the $x$-direction pulls these isotherms apart, weakening the gradient. In this case, $D_t |\\nabla_h \\theta|^2 = -2a < 0$, which corresponds to **frontolysis**.\n-   If $a < 0$, the flow represents compression along the $x$-axis and stretching along the $y$-axis. The compression in the $x$-direction squeezes the vertical isotherms together, strengthening the gradient. In this case, $D_t |\\nabla_h \\theta|^2 = -2a > 0$, which corresponds to **frontogenesis**.\n\nThe problem asks for the closed-form analytic expression for the material time derivative, which we have found to be $-2a$.",
            "answer": "$$\\boxed{-2a}$$"
        },
        {
            "introduction": "While analytical solutions provide crucial insight, real-world atmospheric analysis relies on diagnosing processes from gridded numerical data. This practice  transitions from pure theory to the practical challenges of calculating the kinematic frontogenesis function, $F$, from complex fields representative of model output. You will implement the diagnostic equation numerically, exploring the critical sensitivity of the result to the choice of finite-difference schemes and the application of spatial filters, which are key considerations in modern numerical weather prediction and data analysis.",
            "id": "4046344",
            "problem": "You are given a periodic, high-resolution analysis of a two-dimensional frontal zone within the context of Numerical Weather Prediction (NWP) and climate modeling. The goal is to design a calculation to estimate spatial maps of the kinematic frontogenesis function $F$ and to quantify sensitivity to numerical differentiation and filtering choices. The calculation must begin from first principles: the material derivative, the transport identity for gradients, and the kinematic decomposition of the horizontal velocity gradient tensor. You must not assume or start from any specialized or shortcut frontogenesis formula. Instead, construct $F$ by reasoning from the following base.\n\nFundamental base:\n- The material derivative of a scalar field $\\theta$ is $D\\theta/Dt = \\partial \\theta/\\partial t + \\mathbf{v}\\cdot\\nabla \\theta$.\n- The material derivative of a gradient obeys the transport identity $D(\\nabla \\theta)/Dt = \\nabla(D\\theta/Dt) - (\\nabla \\mathbf{v})^{\\top}\\nabla \\theta$.\n- Under adiabatic and frictionless conditions on an analysis snapshot, one may set $D\\theta/Dt \\approx 0$ to isolate the kinematic contribution.\n- The horizontal velocity gradient tensor $\\nabla \\mathbf{v}$ can be decomposed into the symmetric strain-rate part and the antisymmetric rotation part, and the divergence $\\nabla\\cdot\\mathbf{v}$ is the trace of the tensor.\n\nDomain and fields:\n- Consider a square, doubly periodic domain with side length $L_x = L_y = 1.0\\times 10^6$ meters, discretized on an $N\\times N$ grid with $N = 256$, uniform spacing $\\Delta x = \\Delta y = L_x/N$ meters, and periodic boundary conditions in both directions.\n- Define the potential temperature field $\\theta(x,y)$ representing a meandering frontal zone with controlled sharpness and noise:\n$$\n\\theta(x,y) = \\theta_{\\mathrm{ref}} + \\Delta \\theta \\,\\tanh\\!\\left(\\frac{y - y_0 + A\\cos(k_x x)}{w}\\right) + \\eta\\,\\xi(x,y),\n$$\nwhere $x\\in[0,L_x)$, $y\\in[0,L_y)$, $\\theta_{\\mathrm{ref}} = 280\\,\\mathrm{K}$, $\\Delta \\theta = 12\\,\\mathrm{K}$, $y_0 = L_y/2$, $A = 1.0\\times 10^5\\,\\mathrm{m}$, $k_x = 6\\pi/L_x$, $w$ is the frontal half-width in meters, $\\eta$ is the noise amplitude in Kelvin, and $\\xi(x,y)$ is a zero-mean, unit-variance Gaussian random field.\n- Define a horizontally varying wind field with realistic confluence and shear, periodic in both directions:\n$$\nu(x,y) = U_0 + a \\sin(k_x x)\\cos(k_y y),\\quad v(x,y) = V_0 + b \\cos(k_x x)\\sin(k_y y),\n$$\nwith $U_0 = 10\\,\\mathrm{m\\,s^{-1}}$, $V_0 = 0\\,\\mathrm{m\\,s^{-1}}$, $a = 8\\,\\mathrm{m\\,s^{-1}}$, $b = 6\\,\\mathrm{m\\,s^{-1}}$, and $k_y = 6\\pi/L_y$.\n\nTask:\n- Starting only from the fundamental base above, derive an expression for the kinematic frontogenesis function $F$, defined as the material rate of change of the magnitude of the horizontal gradient of $\\theta$, that is,\n$$\nF \\equiv \\frac{D}{Dt}\\left\\lVert \\nabla_h \\theta \\right\\rVert,\n$$\nexpressed entirely in terms of horizontal first derivatives of $\\theta$, $u$, and $v$.\n- Implement a program to compute spatial maps of $F$ on the grid using two finite-difference schemes for first derivatives: second-order centered ($p=2$) and fourth-order centered ($p=4$), both with periodic boundary conditions. To examine sensitivity, optionally pre-filter $\\theta$, $u$, and $v$ fields using a Gaussian filter with standard deviation $\\sigma$ measured in grid points, with periodic wrapping.\n- Quantify the sensitivity by reporting, for each test case, the domain-mean of strictly positive $F$ values (frontogenesis only), expressed in $\\mathrm{K\\,m^{-1}\\,s^{-1}}$. If no strictly positive values exist, report $0.0$.\n\nUnits:\n- Express all final numeric answers in $\\mathrm{K\\,m^{-1}\\,s^{-1}}$.\n- No angles are required, so no angle unit specification is needed.\n\nTest suite:\nUse the following five test cases, each defined by the tuple $(p,\\sigma,w,\\eta)$ where $p$ is the finite-difference order, $\\sigma$ is the Gaussian filter standard deviation in grid points, $w$ is the frontal half-width in meters, and $\\eta$ is the noise amplitude in Kelvin.\n\n- Case $1$: $(2, 0, 6.0\\times 10^4, 0.0)$, a well-resolved baseline with second-order differences and no filtering.\n- Case $2$: $(4, 0, 6.0\\times 10^4, 0.0)$, a well-resolved baseline with fourth-order differences and no filtering.\n- Case $3$: $(2, 0, 2.0\\times 10^4, 0.5)$, a marginally resolved sharp front with added noise and no filtering.\n- Case $4$: $(2, 1, 2.0\\times 10^4, 0.5)$, the same as Case $3$ but with mild Gaussian smoothing.\n- Case $5$: $(4, 2, 1.5\\times 10^4, 1.0)$, a very sharp, noisy front with stronger smoothing and higher-order differences.\n\nOutput specification:\n- For each test case, compute the domain-mean of $F$ over points where $F>0$, rounded to $6$ decimal places, in $\\mathrm{K\\,m^{-1}\\,s^{-1}}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4,r_5]$), where each $r_i$ corresponds to the result from Case $i$ in the order specified above.",
            "solution": "The problem requires the derivation and numerical computation of the kinematic frontogenesis function, $F$, starting from fundamental principles of fluid dynamics. We must then apply this computation to a set of test cases involving a semi-analytic frontal zone, evaluating the sensitivity of the result to numerical differentiation schemes and pre-filtering.\n\n### **Part 1: Derivation of the Frontogenesis Function**\n\nThe frontogenesis function, $F$, is defined as the material rate of change of the magnitude of the horizontal potential temperature gradient, $\\nabla_h \\theta$. The horizontal gradient vector is $\\nabla_h \\theta = \\frac{\\partial \\theta}{\\partial x}\\mathbf{i} + \\frac{\\partial \\theta}{\\partial y}\\mathbf{j}$, and its magnitude is $\\lVert \\nabla_h \\theta \\rVert = \\sqrt{(\\frac{\\partial \\theta}{\\partial x})^2 + (\\frac{\\partial \\theta}{\\partial y})^2}$.\n\nThe definition of $F$ is:\n$$\nF \\equiv \\frac{D}{Dt}\\left\\lVert \\nabla_h \\theta \\right\\rVert = \\frac{D}{Dt} \\left( (\\nabla_h \\theta) \\cdot (\\nabla_h \\theta) \\right)^{1/2}\n$$\nApplying the chain rule for the material derivative $\\frac{D}{Dt}$:\n$$\nF = \\frac{1}{2 \\left( (\\nabla_h \\theta) \\cdot (\\nabla_h \\theta) \\right)^{1/2}} \\frac{D}{Dt} \\left( (\\nabla_h \\theta) \\cdot (\\nabla_h \\theta) \\right)\n$$\nUsing the product rule for the material derivative of a dot product, $\\frac{D}{Dt}(\\mathbf{A} \\cdot \\mathbf{B}) = \\frac{D\\mathbf{A}}{Dt}\\cdot\\mathbf{B} + \\mathbf{A}\\cdot\\frac{D\\mathbf{B}}{Dt}$:\n$$\nF = \\frac{1}{2 \\lVert \\nabla_h \\theta \\rVert} \\left( \\frac{D(\\nabla_h \\theta)}{Dt} \\cdot (\\nabla_h \\theta) + (\\nabla_h \\theta) \\cdot \\frac{D(\\nabla_h \\theta)}{Dt} \\right) = \\frac{1}{\\lVert \\nabla_h \\theta \\rVert} \\left( (\\nabla_h \\theta) \\cdot \\frac{D(\\nabla_h \\theta)}{Dt} \\right)\n$$\nAt this point, we must find an expression for $\\frac{D(\\nabla_h \\theta)}{Dt}$. The problem provides the transport identity for the gradient of a scalar field:\n$$\n\\frac{D(\\nabla \\theta)}{Dt} = \\nabla\\left(\\frac{D\\theta}{Dt}\\right) - (\\nabla \\mathbf{v})^{\\top}\\nabla \\theta\n$$\nThis identity applies in three dimensions, but since we are concerned with the horizontal gradient $\\nabla_h \\theta$ and the horizontal velocity $\\mathbf{v}_h = (u,v)$, we use its horizontal counterpart:\n$$\n\\frac{D(\\nabla_h \\theta)}{Dt} = \\nabla_h\\left(\\frac{D\\theta}{Dt}\\right) - (\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta\n$$\nThe problem states that for a kinematic analysis of an atmospheric snapshot under adiabatic and frictionless conditions, we can assume the material derivative of potential temperature is approximately zero, i.e., $\\frac{D\\theta}{Dt} \\approx 0$. This greatly simplifies the transport identity:\n$$\n\\frac{D(\\nabla_h \\theta)}{Dt} \\approx - (\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta\n$$\nSubstituting this result back into the expression for $F$:\n$$\nF \\approx -\\frac{1}{\\lVert \\nabla_h \\theta \\rVert} \\left( (\\nabla_h \\theta) \\cdot ((\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta) \\right)\n$$\nTo obtain a computational formula, we express this in component form. Let $\\theta_x = \\frac{\\partial \\theta}{\\partial x}$ and $\\theta_y = \\frac{\\partial \\theta}{\\partial y}$. The horizontal gradient vector is $\\nabla_h \\theta = \\begin{pmatrix} \\theta_x \\\\ \\theta_y \\end{pmatrix}$. The horizontal velocity gradient tensor is $\\nabla_h \\mathbf{v}_h = \\begin{pmatrix} u_x & u_y \\\\ v_x & v_y \\end{pmatrix}$, where $u_x = \\frac{\\partial u}{\\partial x}$, etc. Its transpose is $(\\nabla_h \\mathbf{v}_h)^{\\top} = \\begin{pmatrix} u_x & v_x \\\\ u_y & v_y \\end{pmatrix}$.\n\nThe vector term $-(\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta$ becomes:\n$$\n-\\begin{pmatrix} u_x & v_x \\\\ u_y & v_y \\end{pmatrix} \\begin{pmatrix} \\theta_x \\\\ \\theta_y \\end{pmatrix} = -\\begin{pmatrix} u_x \\theta_x + v_x \\theta_y \\\\ u_y \\theta_x + v_y \\theta_y \\end{pmatrix}\n$$\nNow, taking the dot product with $\\nabla_h \\theta = \\begin{pmatrix} \\theta_x \\\\ \\theta_y \\end{pmatrix}$:\n$$\n(\\nabla_h \\theta) \\cdot ( -(\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta ) = \\theta_x(-u_x \\theta_x - v_x \\theta_y) + \\theta_y(-u_y \\theta_x - v_y \\theta_y) = - (u_x \\theta_x^2 + (u_y + v_x)\\theta_x \\theta_y + v_y \\theta_y^2)\n$$\nSubstituting this final piece into the expression for $F$ yields the operational formula, expressed entirely in terms of the first derivatives of the fields $\\theta$, $u$, and $v$:\n$$\nF = -\\frac{u_x \\theta_x^2 + (u_y+v_x)\\theta_x\\theta_y + v_y \\theta_y^2}{\\sqrt{\\theta_x^2 + \\theta_y^2}}\n$$\nThis is the kinematic frontogenesis function. The numerator is a quadratic form that describes the projection of the strain rate tensor onto the gradient vector, confirming that frontogenesis is driven by the fluid's deformation field acting to compress the isotherms.\n\n### **Part 2: Numerical Implementation**\n\nThe implementation proceeds in several steps for each test case.\n\n1.  **Grid and Field Generation**: A uniform, doubly periodic grid of size $N \\times N$ with $N=256$ and side length $L=1.0\\times 10^6\\,\\mathrm{m}$ is constructed. The potential temperature $\\theta(x,y)$ and wind fields $u(x,y)$, $v(x,y)$ are computed at each grid point using the specified analytical functions and parameters $(w, \\eta)$. The random field $\\xi(x,y)$ is generated from a standard normal distribution.\n\n2.  **Gaussian Filtering**: For test cases where the filter standard deviation $\\sigma > 0$, the $\\theta$, $u$, and $v$ fields are pre-filtered. To correctly handle periodic boundary conditions, filtering is performed in the frequency domain. Each field is transformed using a 2D Fast Fourier Transform (FFT). The transformed field is multiplied by a spectral filter, which is the Fourier transform of a Gaussian kernel. The standard deviation of the kernel is $\\sigma_{phys} = \\sigma \\cdot \\Delta x$, where $\\sigma$ is specified in grid points and $\\Delta x$ is the grid spacing. The resulting spectrum is then inverse-transformed back to physical space to yield the smoothed field.\n\n3.  **Numerical Differentiation**: The first derivatives ($\\theta_x, \\theta_y, u_x, u_y, v_x, v_y$) required by the formula for $F$ are computed using finite differences. The problem specifies two centered schemes: a second-order scheme ($p=2$) and a fourth-order scheme ($p=4$). Periodic boundary conditions are handled by using `numpy.roll` to perform cyclic shifts of the arrays, which is equivalent to accessing neighboring grid points across the domain boundary.\n    - Second-order: $\\frac{\\partial f}{\\partial x}\\bigg|_i \\approx \\frac{f_{i+1} - f_{i-1}}{2\\Delta x}$\n    - Fourth-order: $\\frac{\\partial f}{\\partial x}\\bigg|_i \\approx \\frac{-f_{i+2} + 8f_{i+1} - 8f_{i-1} + f_{i-2}}{12\\Delta x}$\n\n4.  **Computation and Analysis**: With all derivative fields computed, the frontogenesis function $F$ is calculated at each grid point using the derived formula. A small epsilon is used in the denominator to avoid division by zero in regions where the potential temperature gradient is numerically zero (in which case the numerator is also zero, and $F$ is defined as $0$). Finally, to quantify the result for each test case, we identify all grid points where $F > 0$ (regions of frontogenesis). The arithmetic mean of these strictly positive values is computed. If no such values exist, the result is $0.0$. The final value is reported in units of $\\mathrm{K\\,m^{-1}\\,s^{-1}}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the kinematic frontogenesis function for a series of test cases.\n    \"\"\"\n\n    def get_derivatives(field, dx, dy, order):\n        \"\"\"\n        Computes first derivatives of a 2D field using centered finite differences\n        with periodic boundary conditions.\n        \"\"\"\n        if order == 2:\n            # Second-order centered difference\n            df_dx = (np.roll(field, -1, axis=1) - np.roll(field, 1, axis=1)) / (2 * dx)\n            df_dy = (np.roll(field, -1, axis=0) - np.roll(field, 1, axis=0)) / (2 * dy)\n        elif order == 4:\n            # Fourth-order centered difference\n            df_dx = (-np.roll(field, -2, axis=1) + 8 * np.roll(field, -1, axis=1) -\n                     8 * np.roll(field, 1, axis=1) + np.roll(field, 2, axis=1)) / (12 * dx)\n            df_dy = (-np.roll(field, -2, axis=0) + 8 * np.roll(field, -1, axis=0) -\n                     8 * np.roll(field, 1, axis=0) + np.roll(field, 2, axis=0)) / (12 * dy)\n        else:\n            raise ValueError(f\"Finite difference order p={order} is not supported. Must be 2 or 4.\")\n        return df_dx, df_dy\n\n    def gaussian_filter_2d(field, sigma, dx, dy):\n        \"\"\"\n        Applies a 2D Gaussian filter in the frequency domain to handle\n        periodic boundary conditions correctly. sigma is in grid points.\n        \"\"\"\n        if sigma == 0:\n            return field\n        \n        N, M = field.shape\n        # Wavenumbers\n        kx = 2 * np.pi * np.fft.fftfreq(M, d=dx)\n        ky = 2 * np.pi * np.fft.fftfreq(N, d=dy)\n        Kx, Ky = np.meshgrid(kx, ky)\n        \n        # Physical standard deviation\n        sigma_phys_x = sigma * dx\n        sigma_phys_y = sigma * dy\n\n        # Gaussian kernel in Fourier space\n        kernel_fourier = np.exp(-0.5 * (Kx**2 * sigma_phys_x**2 + Ky**2 * sigma_phys_y**2))\n        \n        # Apply filter\n        field_fourier = np.fft.fft2(field)\n        filtered_field_fourier = field_fourier * kernel_fourier\n        filtered_field = np.fft.ifft2(filtered_field_fourier).real\n        \n        return filtered_field\n\n    # Domain and physical constants\n    N = 256\n    L = 1.0e6  # L_x = L_y\n    dx = L / N\n    dy = L / N\n    theta_ref = 280.0\n    delta_theta = 12.0\n    y0 = L / 2.0\n    A = 1.0e5\n    kx_val = 6.0 * np.pi / L\n    ky_val = 6.0 * np.pi / L\n    U0 = 10.0\n    V0 = 0.0\n    a = 8.0\n    b = 6.0\n    \n    # Grid coordinates\n    x_1d = np.arange(N) * dx\n    y_1d = np.arange(N) * dy\n    X, Y = np.meshgrid(x_1d, y_1d)\n\n    test_cases = [\n        # (p, sigma, w, eta)\n        (2, 0.0, 6.0e4, 0.0),\n        (4, 0.0, 6.0e4, 0.0),\n        (2, 0.0, 2.0e4, 0.5),\n        (2, 1.0, 2.0e4, 0.5),\n        (4, 2.0, 1.5e4, 1.0),\n    ]\n\n    results = []\n    \n    # Use a fixed seed for reproducible noise\n    np.random.seed(0)\n\n    for p, sigma, w, eta in test_cases:\n        # Generate noise field (zero-mean, unit-variance)\n        xi = np.random.randn(N, N) if eta > 0 else np.zeros((N, N))\n\n        # Generate analytical fields\n        theta = theta_ref + delta_theta * np.tanh((Y - y0 + A * np.cos(kx_val * X)) / w) + eta * xi\n        u = U0 + a * np.sin(kx_val * X) * np.cos(ky_val * Y)\n        v = V0 + b * np.cos(kx_val * X) * np.sin(ky_val * Y)\n\n        # Apply spatial filtering if specified\n        theta_f = gaussian_filter_2d(theta, sigma, dx, dy)\n        u_f = gaussian_filter_2d(u, sigma, dx, dy)\n        v_f = gaussian_filter_2d(v, sigma, dx, dy)\n        \n        # Compute all required first derivatives\n        theta_x, theta_y = get_derivatives(theta_f, dx, dy, p)\n        u_x, u_y = get_derivatives(u_f, dx, dy, p)\n        v_x, v_y = get_derivatives(v_f, dx, dy, p)\n\n        # Compute the kinematic frontogenesis function F\n        # Numerator: -(u_x*theta_x^2 + (u_y+v_x)*theta_x*theta_y + v_y*theta_y^2)\n        numerator = -(u_x * theta_x**2 + (u_y + v_x) * theta_x * theta_y + v_y * theta_y**2)\n        \n        # Denominator: |grad_h theta|\n        grad_theta_mag = np.sqrt(theta_x**2 + theta_y**2)\n        \n        # Calculate F, avoiding division by zero\n        # Where grad_theta_mag is zero, numerator is also zero, so F=0.\n        F = np.zeros_like(grad_theta_mag)\n        mask_denom_nonzero = grad_theta_mag > 1e-15\n        F[mask_denom_nonzero] = numerator[mask_denom_nonzero] / grad_theta_mag[mask_denom_nonzero]\n        \n        # Calculate the domain-mean of strictly positive F values\n        F_positive = F[F > 0]\n        \n        if F_positive.size > 0:\n            mean_F_pos = np.mean(F_positive)\n        else:\n            mean_F_pos = 0.0\n\n        results.append(f\"{mean_F_pos:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The intensification of a temperature gradient is not just a kinematic process; it forces a dynamic response in the form of a cross-frontal, ageostrophic circulation. This final practice  delves into modeling this response using the Sawyer-Eliassen equation, the primary diagnostic tool for balanced secondary circulations. By numerically solving this elliptic PDE for both Quasi-Geostrophic (QG) and the more advanced Semi-Geostrophic (SG) frameworks, you will quantify how the predicted circulation intensifies in sharp fronts, revealing the limitations of simpler theories and the richer dynamics captured by more sophisticated balanced models.",
            "id": "4046318",
            "problem": "Consider a dry, inviscid, stably stratified atmosphere under the Boussinesq approximation, with hydrostatic balance and geostrophic balance, and assume along-front uniformity so that all variations are confined to a vertical cross-section with horizontal coordinate $x$ (cross-front) and vertical coordinate $z$. Denote the geostrophic wind components by $u_g$ and $v_g$, the Coriolis parameter by $f$, the Brunt–Väisälä frequency by $N$, and the horizontal geostrophic shear across the front by $S_g = \\partial v_g / \\partial x$. The cross-frontal secondary circulation is represented by a streamfunction $\\psi(x,z)$ that satisfies mass continuity in the two-dimensional $(x,z)$ plane, with ageostrophic wind components defined by $u_a(x,z) = \\partial \\psi / \\partial z$ and $w(x,z) = - \\partial \\psi / \\partial x$, where $w$ is the vertical velocity. The steady transverse circulation associated with frontogenesis can be represented, in balanced theory, by an elliptic partial differential equation for $\\psi$ whose coefficients depend on the underlying balance framework.\n\nStarting from the inviscid momentum equations in the rotating frame, the hydrostatic relation, the Boussinesq continuity constraint, and the geostrophic balance for the basic state,\n- geostrophic balance: $f v_g = \\partial \\phi / \\partial x$, $- f u_g = \\partial \\phi / \\partial y$,\n- hydrostatic balance: $\\partial \\phi / \\partial z = b$, with $\\phi$ the geopotential and $b$ the buoyancy,\n- Boussinesq continuity: $\\partial u_a / \\partial x + \\partial w / \\partial z = 0$,\none can eliminate the pressure and reduce the transverse circulation problem to a single second-order elliptic equation for $\\psi$ in the $(x,z)$ plane. In the Quasi-Geostrophic (QG) approximation, the effective static stability remains the dry static stability $N^2$, and the elliptic operator is isotropic up to a constant factor derived from the ratio $f^2/N^2$. In the Semi-Geostrophic (SG) approximation, the coordinate transformation to geostrophic momentum coordinates modifies the effective static stability through the along-front absolute momentum gradients, intensifying the ageostrophic circulation in sharp fronts. For a sharp front, a widely used parameterization that captures the intensification while preserving ellipticity is to replace $N^2$ by an effective stability $N_{\\text{eff}}^2$ defined by\n$$\nN_{\\text{eff}}^2 = \\max\\!\\left(\\varepsilon N^2,\\; N^2 - \\gamma S_g^2\\right),\n$$\nwith $0 < \\varepsilon < 1$ a small safeguard factor enforcing ellipticity and $\\gamma$ a dimensionless coefficient that scales the shear contribution. With this reduced effective stability, the SG formulation increases the anisotropy of the operator relative to the QG case and yields stronger cross-frontal secondary circulation for the same frontogenetic forcing. In both QG and SG, we model the Sawyer–Eliassen equation in the $(x,z)$ plane with a simplified elliptic operator and a localized kinematic frontogenesis forcing:\n$$\n\\alpha \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} = S(x,z),\n$$\nwhere\n$$\n\\alpha_{\\text{QG}} = \\frac{f^2}{N^2}, \\quad \\alpha_{\\text{SG}} = \\frac{f^2}{N_{\\text{eff}}^2}, \\quad\nS(x,z) = D \\exp\\!\\left(-\\left(\\frac{x}{w_x}\\right)^2 - \\left(\\frac{z - z_0}{w_z}\\right)^2\\right).\n$$\nHere $D$ is a frontogenesis rate with units of $\\mathrm{s^{-1}}$, $w_x$ and $w_z$ are horizontal and vertical localization half-widths with units of $\\mathrm{m}$, and $z_0$ is the level where the forcing is centered. The boundary condition is $\\psi = 0$ on all domain boundaries, implying no transverse flow through the boundaries. From the solution $\\psi$, the cross-frontal ageostrophic wind and vertical velocity at any $(x,z)$ are recovered by\n$$\nu_a(x,z) = \\frac{\\partial \\psi}{\\partial z}, \\quad\nw(x,z) = - \\frac{\\partial \\psi}{\\partial x}.\n$$\n\nYour task is to implement a numerical solver for the above elliptic problem using second-order centered finite differences on a uniform grid, with homogeneous Dirichlet boundary conditions for $\\psi$. For each test case, compute both the QG and SG solutions by using $\\alpha_{\\text{QG}}$ and $\\alpha_{\\text{SG}}$, respectively, and report the cross-frontal ageostrophic wind $u_a$ and the vertical velocity $w$ evaluated at $(x = 0, z = z_0)$. Express all velocities in $\\mathrm{m\\,s^{-1}}$, rounded to six decimal digits.\n\nDiscretization requirements:\n- Domain: $x \\in [-L_x/2, L_x/2]$, $z \\in [0, L_z]$.\n- Grid resolution: $N_x = 129$ points in $x$, $N_z = 65$ points in $z$, uniform spacing.\n- Finite difference scheme: second-order centered differences for the Laplacian on interior points, and $\\psi = 0$ on boundaries.\n- Derivative evaluation for reporting: second-order centered differences at the grid point nearest to $(x=0, z=z_0)$.\n\nUse the following test suite. All physical parameters are given in SI units, and all constants must be used exactly as specified in the program.\n\n- Case $1$ (happy path, midlatitude sharp front):\n  - $L_x = 2.00 \\times 10^{5}\\ \\mathrm{m}$,\n  - $L_z = 5.00 \\times 10^{3}\\ \\mathrm{m}$,\n  - $w_x = 2.50 \\times 10^{4}\\ \\mathrm{m}$,\n  - $w_z = 1.00 \\times 10^{3}\\ \\mathrm{m}$,\n  - $z_0 = 2.50 \\times 10^{3}\\ \\mathrm{m}$,\n  - $f = 1.00 \\times 10^{-4}\\ \\mathrm{s^{-1}}$,\n  - $N = 1.00 \\times 10^{-2}\\ \\mathrm{s^{-1}}$,\n  - $S_g = 3.00 \\times 10^{-3}\\ \\mathrm{s^{-1}}$,\n  - $\\gamma = 5.00 \\times 10^{-1}$,\n  - $\\varepsilon = 5.00 \\times 10^{-2}$,\n  - $D = 1.00 \\times 10^{-5}\\ \\mathrm{s^{-1}}$.\n\n- Case $2$ (stronger shear and forcing, still elliptic):\n  - $L_x = 2.00 \\times 10^{5}\\ \\mathrm{m}$,\n  - $L_z = 5.00 \\times 10^{3}\\ \\mathrm{m}$,\n  - $w_x = 2.50 \\times 10^{4}\\ \\mathrm{m}$,\n  - $w_z = 1.00 \\times 10^{3}\\ \\mathrm{m}$,\n  - $z_0 = 2.50 \\times 10^{3}\\ \\mathrm{m}$,\n  - $f = 1.00 \\times 10^{-4}\\ \\mathrm{s^{-1}}$,\n  - $N = 1.00 \\times 10^{-2}\\ \\mathrm{s^{-1}}$,\n  - $S_g = 5.00 \\times 10^{-3}\\ \\mathrm{s^{-1}}$,\n  - $\\gamma = 8.00 \\times 10^{-1}$,\n  - $\\varepsilon = 5.00 \\times 10^{-2}$,\n  - $D = 3.00 \\times 10^{-5}\\ \\mathrm{s^{-1}}$.\n\n- Case $3$ (edge case with no horizontal shear, so SG reduces to QG):\n  - $L_x = 2.00 \\times 10^{5}\\ \\mathrm{m}$,\n  - $L_z = 5.00 \\times 10^{3}\\ \\mathrm{m}$,\n  - $w_x = 2.50 \\times 10^{4}\\ \\mathrm{m}$,\n  - $w_z = 1.00 \\times 10^{3}\\ \\mathrm{m}$,\n  - $z_0 = 2.50 \\times 10^{3}\\ \\mathrm{m}$,\n  - $f = 1.00 \\times 10^{-4}\\ \\mathrm{s^{-1}}$,\n  - $N = 1.00 \\times 10^{-2}\\ \\mathrm{s^{-1}}$,\n  - $S_g = 0.00 \\times 10^{0}\\ \\mathrm{s^{-1}}$,\n  - $\\gamma = 5.00 \\times 10^{-1}$,\n  - $\\varepsilon = 5.00 \\times 10^{-2}$,\n  - $D = 1.00 \\times 10^{-5}\\ \\mathrm{s^{-1}}$.\n\nYour program must construct the finite-difference linear system for each case, solve for $\\psi$ using a sparse linear solver, compute $u_a$ and $w$ at $(x=0,z=z_0)$ for both QG and SG, and aggregate the results for all test cases into one single line of output containing a list of lists. Each sublist must be of the form\n$$\n\\left[ u_{a,\\text{QG}},\\ w_{\\text{QG}},\\ u_{a,\\text{SG}},\\ w_{\\text{SG}},\\ u_{a,\\text{SG}} - u_{a,\\text{QG}},\\ w_{\\text{SG}} - w_{\\text{QG}} \\right],\n$$\nwith all entries in $\\mathrm{m\\,s^{-1}}$ rounded to six decimal digits. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $\\left[ [\\ldots],[\\ldots],[\\ldots] \\right]$.",
            "solution": "The user has provided a problem requiring the numerical solution of a two-dimensional elliptic partial differential equation, known as the Sawyer-Eliassen equation, which describes the secondary circulation in an atmospheric front. The solution is to be computed for two different physical approximations: Quasi-Geostrophic (QG) and Semi-Geostrophic (SG).\n\n### Step 1: Problem Validation\n\n**1. Extract Givens**\n\n- **Governing Equation:** The elliptic PDE for the streamfunction $\\psi(x,z)$ is\n$$\n\\alpha \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} = S(x,z)\n$$\n- **Domain:** A rectangular domain defined by $x \\in [-L_x/2, L_x/2]$ and $z \\in [0, L_z]$.\n- **Boundary Conditions:** Homogeneous Dirichlet conditions, $\\psi = 0$, on all four boundaries of the domain.\n- **Forcing Term:** A Gaussian forcing function is given by\n$$\nS(x,z) = D \\exp\\!\\left(-\\left(\\frac{x}{w_x}\\right)^2 - \\left(\\frac{z - z_0}{w_z}\\right)^2\\right)\n$$\n- **Coefficients:** The coefficient $\\alpha$ depends on the approximation:\n    - **QG:** $\\alpha_{\\text{QG}} = \\frac{f^2}{N^2}$, where $f$ is the Coriolis parameter and $N$ is the Brunt–Väisälä frequency.\n    - **SG:** $\\alpha_{\\text{SG}} = \\frac{f^2}{N_{\\text{eff}}^2}$, with an effective stability defined as $N_{\\text{eff}}^2 = \\max\\!\\left(\\varepsilon N^2,\\; N^2 - \\gamma S_g^2\\right)$. Here, $S_g$ is the geostrophic shear, $\\gamma$ is a dimensionless coefficient, and $\\varepsilon$ is a small parameter to ensure ellipticity.\n- **Output Quantities:** The cross-frontal ageostrophic wind $u_a = \\partial \\psi / \\partial z$ and vertical velocity $w = - \\partial \\psi / \\partial x$ are to be computed at the point $(x=0, z=z_0)$.\n- **Numerical Method:**\n    - **Discretization:** Second-order centered finite differences on a uniform grid.\n    - **Grid:** $N_x = 129$ points in $x$, $N_z = 65$ points in $z$.\n    - **Derivatives:** Second-order centered differences for evaluating $u_a$ and $w$.\n- **Test Cases:** Three sets of physical parameters ($L_x, L_z, w_x, w_z, z_0, f, N, S_g, \\gamma, \\varepsilon, D$) are provided.\n\n**2. Validate Using Extracted Givens**\n\n- **Scientific Grounding (Critical):** The problem is fundamentally based on the Sawyer-Eliassen equation, a cornerstone of dynamical meteorology for studying frontal circulations. The QG and SG approximations are standard, and the parameterization of effective stability in the SG case is a physically sound method to account for the slantwise orientation of motion in strong fronts. All parameters are within physically realistic ranges for Earth's atmosphere. The problem is scientifically sound.\n- **Well-Posed:** The governing equation is a linear, second-order elliptic PDE. The coefficients $\\alpha$ for both QG and SG cases are guaranteed to be positive ($f^2>0, N^2>0, N_{\\text{eff}}^2>0$), which ensures the operator is elliptic. With specified Dirichlet boundary conditions on a closed domain, the problem is well-posed, admitting a unique and stable solution.\n- **Objective (Critical):** The problem is stated in precise mathematical language, free from ambiguity or subjective claims. All parameters, methods, and output requirements are explicitly defined.\n- **Completeness and Consistency:** The problem provides all necessary information—governing equation, boundary conditions, domain geometry, physical parameters, and numerical scheme—to proceed with a solution. There are no contradictions.\n\n**3. Verdict and Action**\n\nThe problem is **valid** as it is scientifically grounded, well-posed, objective, and complete. I will proceed to develop the numerical solution.\n\n### Step 2: Principle-Based Design of the Solution\n\nThe core task is to solve the linear system of equations that arises from the finite-difference discretization of the elliptic PDE.\n\n**Discretization of the PDE**\nA uniform grid is defined over the domain $(x,z) \\in [-L_x/2, L_x/2] \\times [0, L_z]$ with grid spacings $\\Delta x = L_x / (N_x - 1)$ and $\\Delta z = L_z / (N_z - 1)$. Let $\\psi_{i,j}$ denote the value of the streamfunction at grid point $(z_i, x_j)$. The second-order centered difference approximation of the governing equation at an interior grid point $(i,j)$ is:\n$$\n\\alpha \\left( \\frac{\\psi_{i,j+1} - 2\\psi_{i,j} + \\psi_{i,j-1}}{\\Delta x^2} \\right) + \\left( \\frac{\\psi_{i+1,j} - 2\\psi_{i,j} + \\psi_{i-1,j}}{\\Delta z^2} \\right) = S_{i,j}\n$$\nThis can be rearranged into a linear equation for the unknown $\\psi$ values at all interior points. The collection of these equations forms a large, sparse linear system of the form $\\mathbf{A} \\vec{\\psi} = \\vec{S}$, where $\\mathbf{A}$ is the matrix representing the discretized elliptic operator, $\\vec{\\psi}$ is a vector of the unknown streamfunction values at interior grid points, and $\\vec{S}$ is a vector of the forcing term values at those points. The Dirichlet boundary condition $\\psi=0$ is incorporated by only solving for the interior points and setting the boundary values to zero.\n\n**Construction of the Linear System**\nThe matrix $\\mathbf{A}$ is a block-tridiagonal matrix. A standard and numerically robust method for its construction is to use the Kronecker product. The 2D Laplace operator can be expressed as the sum of two operators, one for each spatial dimension, acting on the vectorized 2D field. Let $\\mathbf{D}_{xx}$ and $\\mathbf{D}_{zz}$ be the 1D second-derivative matrices for the $x$ and $z$ dimensions, respectively, and let $\\mathbf{I}_x$ and $\\mathbf{I}_z$ be the corresponding identity matrices. The matrix $\\mathbf{A}$ can be constructed as:\n$$\n\\mathbf{A} = \\mathbf{I}_z \\otimes (\\alpha \\mathbf{D}_{xx}) + \\mathbf{D}_{zz} \\otimes \\mathbf{I}_x\n$$\nwhere $\\otimes$ denotes the Kronecker product. This construction correctly represents the connectivity of grid points in the 2D finite-difference stencil. The right-hand side vector $\\vec{S}$ is formed by flattening the 2D array of the forcing term $S(x,z)$ evaluated at the interior grid points.\n\n**Solving the System and Post-processing**\nOnce the matrix $\\mathbf{A}$ and vector $\\vec{S}$ are constructed, the linear system is solved for $\\vec{\\psi}$ using a sparse linear algebra solver, such as `scipy.sparse.linalg.spsolve`. The resulting solution vector is then reshaped back into a 2D array representing the streamfunction at interior points. This interior solution is embedded within a larger 2D array of size $N_z \\times N_x$, which is initialized to zero to enforce the boundary conditions.\n\nFinally, the ageostrophic wind components $u_a$ and $w$ are computed at the specified point $(x=0, z=z_0)$ using second-order centered finite differences on the solved $\\psi$ field:\n$$\nu_{a,i_0,j_0} = \\frac{\\psi_{i_0+1,j_0} - \\psi_{i_0-1,j_0}}{2 \\Delta z}\n$$\n$$\nw_{i_0,j_0} = - \\frac{\\psi_{i_0,j_0+1} - \\psi_{i_0,j_0-1}}{2 \\Delta x}\n$$\nwhere $(i_0, j_0)$ are the grid indices corresponding to the point $(x=0, z=z_0)$. This entire process is repeated for both the QG and SG cases (by re-calculating $\\alpha$ and re-solving the system) for each set of test parameters. For the special case where $S_g=0$, $\\alpha_{\\text{SG}}$ becomes equal to $\\alpha_{\\text{QG}}$, and the SG solution is identical to the QG solution, allowing for a computational optimization.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import diags, kron, linalg, csc_matrix\n\ndef solve():\n    \"\"\"\n    Main function to solve the Sawyer-Eliassen equation for QG and SG\n    approximations across a suite of test cases.\n    \"\"\"\n    \n    # -- Problem Constants --\n    # Grid resolution\n    Nx = 129\n    Nz = 65\n\n    # -- Test Cases Definition --\n    test_cases = [\n        # Case 1 (happy path, midlatitude sharp front)\n        {\n            \"Lx\": 2.00e5, \"Lz\": 5.00e3, \"wx\": 2.50e4, \"wz\": 1.00e3, \"z0\": 2.50e3,\n            \"f\": 1.00e-4, \"N\": 1.00e-2, \"Sg\": 3.00e-3, \"gamma\": 0.50,\n            \"epsilon\": 0.05, \"D\": 1.00e-5\n        },\n        # Case 2 (stronger shear and forcing, still elliptic)\n        {\n            \"Lx\": 2.00e5, \"Lz\": 5.00e3, \"wx\": 2.50e4, \"wz\": 1.00e3, \"z0\": 2.50e3,\n            \"f\": 1.00e-4, \"N\": 1.00e-2, \"Sg\": 5.00e-3, \"gamma\": 0.80,\n            \"epsilon\": 0.05, \"D\": 3.00e-5\n        },\n        # Case 3 (edge case with no horizontal shear, so SG reduces to QG)\n        {\n            \"Lx\": 2.00e5, \"Lz\": 5.00e3, \"wx\": 2.50e4, \"wz\": 1.00e3, \"z0\": 2.50e3,\n            \"f\": 1.00e-4, \"N\": 1.00e-2, \"Sg\": 0.0, \"gamma\": 0.50,\n            \"epsilon\": 0.05, \"D\": 1.00e-5\n        },\n    ]\n\n    # --- Helper function to construct the finite-difference matrix ---\n    def construct_A(alpha, Nx, Nz, dx, dz):\n        num_x_interior = Nx - 2\n        num_z_interior = Nz - 2\n\n        # 1D second-derivative operator for x-direction\n        Dxx_1d = diags([1, -2, 1], [-1, 0, 1], shape=(num_x_interior, num_x_interior), format='csc') / (dx**2)\n        \n        # 1D second-derivative operator for z-direction\n        Dzz_1d = diags([1, -2, 1], [-1, 0, 1], shape=(num_z_interior, num_z_interior), format='csc') / (dz**2)\n        \n        # Identity matrices for Kronecker product\n        Ix = diags([np.ones(num_x_interior)], [0], format='csc')\n        Iz = diags([np.ones(num_z_interior)], [0], format='csc')\n        \n        # Assemble the 2D operator using Kronecker products for a (z, x) grid\n        A_xx = kron(Iz, alpha * Dxx_1d)\n        A_zz = kron(Dzz_1d, Ix)\n        \n        A = A_xx + A_zz\n        return csc_matrix(A)\n\n    # --- Main processing loop ---\n    all_results = []\n    for params in test_cases:\n        # Unpack parameters\n        Lx, Lz, wx, wz, z0 = params[\"Lx\"], params[\"Lz\"], params[\"wx\"], params[\"wz\"], params[\"z0\"]\n        f, N, Sg, gamma, epsilon, D = params[\"f\"], params[\"N\"], params[\"Sg\"], params[\"gamma\"], params[\"epsilon\"], params[\"D\"]\n\n        # Grid setup\n        x = np.linspace(-Lx / 2, Lx / 2, Nx)\n        z = np.linspace(0, Lz, Nz)\n        dx = x[1] - x[0]\n        dz = z[1] - z[0]\n        \n        X, Z = np.meshgrid(x, z)\n        \n        # Forcing term\n        S = D * np.exp(-((X / wx)**2) - ((Z - z0) / wz)**2)\n        \n        # RHS vector (flattened interior part of the source term)\n        b = S[1:-1, 1:-1].flatten()\n\n        # Function to solve the system for a given alpha\n        def solve_for_psi(alpha):\n            A = construct_A(alpha, Nx, Nz, dx, dz)\n            psi_interior_vec = linalg.spsolve(A, b)\n            \n            psi = np.zeros((Nz, Nx))\n            psi[1:-1, 1:-1] = psi_interior_vec.reshape((Nz - 2, Nx - 2))\n            return psi\n\n        # Find indices for evaluation point (x=0, z=z0)\n        j0 = (Nx - 1) // 2\n        i0 = np.argmin(np.abs(z - z0))\n\n        # Function to compute derivatives from the psi field\n        def compute_derivatives(psi):\n            ua = (psi[i0 + 1, j0] - psi[i0 - 1, j0]) / (2 * dz)\n            w = -(psi[i0, j0 + 1] - psi[i0, j0 - 1]) / (2 * dx)\n            return ua, w\n\n        # QG Solution\n        N2 = N**2\n        alpha_qg = f**2 / N2\n        psi_qg = solve_for_psi(alpha_qg)\n        ua_qg, w_qg = compute_derivatives(psi_qg)\n        \n        # SG Solution\n        N_eff2 = max(epsilon * N2, N2 - gamma * Sg**2)\n        alpha_sg = f**2 / N_eff2\n        \n        if np.isclose(alpha_sg, alpha_qg):\n            psi_sg = psi_qg\n        else:\n            psi_sg = solve_for_psi(alpha_sg)\n        \n        ua_sg, w_sg = compute_derivatives(psi_sg)\n        \n        # Assemble and round results for the current case\n        case_results = [\n            round(ua_qg, 6), round(w_qg, 6),\n            round(ua_sg, 6), round(w_sg, 6),\n            round(ua_sg - ua_qg, 6), round(w_sg - w_qg, 6)\n        ]\n        all_results.append(case_results)\n\n    # Format and print the final output as a list of lists\n    results_str_list = [str(res) for res in all_results]\n    print(f\"[{','.join(results_str_list)}]\")\n\nsolve()\n```"
        }
    ]
}