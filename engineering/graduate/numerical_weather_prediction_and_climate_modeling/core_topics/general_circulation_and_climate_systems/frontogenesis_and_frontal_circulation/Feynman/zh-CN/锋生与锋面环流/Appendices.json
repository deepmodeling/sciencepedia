{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在揭示运动学锋生过程的本质。通过在一个理想化的纯应变流场中，从第一性原理出发推导温度梯度的物质导数，我们可以清晰地观察到流场变形如何拉伸等温线并增强梯度，这是理解锋面形成和发展的基本功。",
            "id": "4046338",
            "problem": "考虑一个二维、无粘、绝热的 Boussinesq 大气在等压面上。设水平速度场由 $u(x,y,t)=a x$ 和 $v(x,y,t)=-a y$ 给出，其中 $a$ 是一个常数，单位为时间的倒数。初始位温场为 $\\theta(x,y,0)=x$。假设位温 $\\theta$ 是物质守恒的（无非绝热加热或扩散），因此标量平流方程 $D_t \\theta = \\partial_t \\theta + u \\,\\partial_x \\theta + v \\,\\partial_y \\theta = 0$ 成立。用 $\\nabla_h \\theta = (\\partial_x \\theta, \\partial_y \\theta)$ 表示水平梯度，其模的平方为 $|\\nabla_h \\theta|^2 = (\\partial_x \\theta)^2 + (\\partial_y \\theta)^2$。\n\n从标量平流方程和连续介质运动学的基本原理出发，推导在给定流场和初始温度场下，物质时间导数 $D_t |\\nabla_h \\theta|^2$ 在 $t=0$ 时的表达式。然后，根据计算出的趋势项的符号，说明在 $t=0$ 时是发生锋生（水平温度梯度增强）还是锋消（水平温度梯度减弱）。请以 $a$ 的闭式解析表达式的形式提供你的最终答案。不需要四舍五入。最终方框内的表达式不应包含任何单位；所有关于单位和物理意义的解释应在推导过程中给出。",
            "solution": "该问题要求计算水平位温梯度模的平方的物质时间导数 $D_t |\\nabla_h \\theta|^2$ 在时间 $t=0$ 时的值。这个量是锋生研究的核心。\n\n首先，我们对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n-   速度场：$u(x,y,t) = a x$ 和 $v(x,y,t) = -a y$，其中 $a$ 是一个常数。\n-   初始位温场：$\\theta(x,y,0) = x$。\n-   位温的控制方程：$D_t \\theta = \\partial_t \\theta + u \\,\\partial_x \\theta + v \\,\\partial_y \\theta = 0$。\n-   定义：$\\nabla_h \\theta = (\\partial_x \\theta, \\partial_y \\theta)$ 和 $|\\nabla_h \\theta|^2 = (\\partial_x \\theta)^2 + (\\partial_y \\theta)^2$。\n-   任务：推导 $D_t |\\nabla_h \\theta|^2$ 在 $t=0$ 时的表达式，并确定这对应于锋生还是锋消。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题设置在地球物理流体动力学的既定框架内。控制方程 $D_t \\theta = 0$ 正确表示了绝热流中位温的物质守恒。速度场描述了一个纯应变流，这是一个标准的运动学模型。初始条件是一个简单的线性梯度。待计算的量 $D_t |\\nabla_h \\theta|^2$ 是锋生率的标准度量。该问题是科学合理的。\n-   **适定性：** 该问题提供了一套完整的信息：流场、标量的初始条件和控制方程。问题是具体且清晰的。可以找到一个唯一的、有意义的解。\n-   **客观性：** 该问题使用精确的数学语言陈述，没有主观或含糊的术语。虽然常数 $a$ 的符号未指定，但这并不影响表达式本身的推导。其物理解释可以根据 $a$ 的符号进行条件判断。\n\n**步骤 3：结论与行动**\n该问题被认为是有效的。我们继续进行推导。\n\n我们感兴趣的量是水平位温梯度的模的平方，由下式给出：\n$$\n|\\nabla_h \\theta|^2 = (\\partial_x \\theta)^2 + (\\partial_y \\theta)^2\n$$\n我们需要求它的物质时间导数 $D_t |\\nabla_h \\theta|^2$。物质导数算子为 $D_t = \\partial_t + u \\partial_x + v \\partial_y$。应用此算子并使用链式法则，我们得到：\n$$\nD_t (|\\nabla_h \\theta|^2) = D_t [(\\partial_x \\theta)^2] + D_t [(\\partial_y \\theta)^2] = 2(\\partial_x \\theta) D_t(\\partial_x \\theta) + 2(\\partial_y \\theta) D_t(\\partial_y \\theta)\n$$\n为了继续进行，我们必须找到 $D_t(\\partial_x \\theta)$ 和 $D_t(\\partial_y \\theta)$ 的表达式。这需要交换物质导数算子和空间导数算子。让我们考虑空间导数 $\\partial_i$ 和物质导数 $D_t$ 的一般交换法则：\n$$\nD_t(\\partial_i \\theta) = (\\partial_t + u_j \\partial_j)(\\partial_i \\theta) = \\partial_t \\partial_i \\theta + u_j \\partial_j \\partial_i \\theta\n$$\n假设场具有足够的光滑性，我们可以交换偏导数的顺序：\n$$\nD_t(\\partial_i \\theta) = \\partial_i (\\partial_t \\theta) + u_j \\partial_i \\partial_j \\theta\n$$\n现在考虑 $\\theta$ 的物质导数的空间导数：\n$$\n\\partial_i(D_t \\theta) = \\partial_i(\\partial_t \\theta + u_j \\partial_j \\theta) = \\partial_i (\\partial_t \\theta) + (\\partial_i u_j)(\\partial_j \\theta) + u_j \\partial_i(\\partial_j \\theta)\n$$\n比较这两个表达式，我们得到交换关系：\n$$\nD_t(\\partial_i \\theta) = \\partial_i(D_t \\theta) - (\\partial_i u_j)(\\partial_j \\theta)\n$$\n问题陈述了位温是物质守恒的，因此 $D_t \\theta = 0$。这极大地简化了交换关系：\n$$\nD_t(\\partial_i \\theta) = - (\\partial_i u_j)(\\partial_j \\theta)\n$$\n将其以分量形式写出，对于 $i=x$（或 1）和 $i=y$（或 2），对 $j=x, y$ 求和：\n$$\nD_t(\\partial_x \\theta) = - [(\\partial_x u)(\\partial_x \\theta) + (\\partial_x v)(\\partial_y \\theta)]\n$$\n$$\nD_t(\\partial_y \\theta) = - [(\\partial_y u)(\\partial_x \\theta) + (\\partial_y v)(\\partial_y \\theta)]\n$$\n现在我们将这些表达式代回 $D_t |\\nabla_h \\theta|^2$ 的方程中：\n$$\nD_t |\\nabla_h \\theta|^2 = 2(\\partial_x \\theta) \\{-[(\\partial_x u)(\\partial_x \\theta) + (\\partial_x v)(\\partial_y \\theta)]\\} + 2(\\partial_y \\theta) \\{-[(\\partial_y u)(\\partial_x \\theta) + (\\partial_y v)(\\partial_y \\theta)]\\}\n$$\n展开此式可得到锋生函数的一般表达式：\n$$\nD_t |\\nabla_h \\theta|^2 = -2 [(\\partial_x u)(\\partial_x \\theta)^2 + (\\partial_y v)(\\partial_y \\theta)^2 + (\\partial_y u + \\partial_x v)(\\partial_x \\theta)(\\partial_y \\theta)]\n$$\n接下来，我们使用问题中给出的特定场来计算该表达式在 $t=0$ 时的值。\n首先，我们计算速度场分量的导数：\n-   $u = ax \\implies \\partial_x u = a$, $\\partial_y u = 0$\n-   $v = -ay \\implies \\partial_x v = 0$, $\\partial_y v = -a$\n\n其次，我们计算初始位温场的导数：\n-   $\\theta(x,y,0) = x \\implies \\partial_x \\theta |_{t=0} = 1$, $\\partial_y \\theta |_{t=0} = 0$\n\n现在，我们将这些值代入 $D_t |\\nabla_h \\theta|^2$ 的一般表达式中，并计算 $t=0$ 时的值：\n$$\nD_t |\\nabla_h \\theta|^2 |_{t=0} = -2 [(a)(1)^2 + (-a)(0)^2 + (0 + 0)(1)(0)]\n$$\n$$\nD_t |\\nabla_h \\theta|^2 |_{t=0} = -2 [a \\cdot 1 + 0 + 0]\n$$\n$$\nD_t |\\nabla_h \\theta|^2 |_{t=0} = -2a\n$$\n这就是所求的表达式。\n\n最后，我们解释这个结果。当 $D_t |\\nabla_h \\theta|^2 > 0$ 时，发生锋生（梯度增强）。当 $D_t |\\nabla_h \\theta|^2  0$ 时，发生锋消（梯度减弱）。\n我们的结果 $-2a$ 的符号取决于常数 $a$ 的符号。\n-   如果 $a > 0$，流场 $u=ax, v=-ay$ 表示沿 $x$ 轴的拉伸和沿 $y$ 轴的压缩。初始等温线是垂直线（$\\theta=x=常数$）。$x$ 方向的拉伸将这些等温线拉开，从而减弱了梯度。在这种情况下，$D_t |\\nabla_h \\theta|^2 = -2a  0$，对应于**锋消**。\n-   如果 $a  0$，流场表示沿 $x$ 轴的压缩和沿 $y$ 轴的拉伸。$x$ 方向的压缩将垂直的等温线挤压在一起，从而增强了梯度。在这种情况下，$D_t |\\nabla_h \\theta|^2 = -2a > 0$，对应于**锋生**。\n\n问题要求物质时间导数的闭式解析表达式，我们已求得其为 $-2a$。",
            "answer": "$$\\boxed{-2a}$$"
        },
        {
            "introduction": "从理想化的解析计算过渡到更真实的数值模型输出，本练习要求您在二维网格上实现锋生函数的诊断。这项实践模拟了在数值天气预报（NWP）中分析锋区强度的核心技能，并特别关注了数值微分方案和滤波选择对计算结果的敏感性，从而揭示了在处理真实或模拟数据时必须面对的实际挑战。",
            "id": "4046344",
            "problem": "在数值天气预报 (NWP) 和气候模拟的背景下，给定一个二维锋区的周期性、高分辨率分析场。目标是设计一种计算方法，以估算运动锋生函数 $F$ 的空间分布图，并量化其对数值微分和滤波选择的敏感性。计算必须从第一性原理出发：物质导数、梯度的输运恒等式，以及水平速度梯度张量的运动学分解。您不得假设或直接使用任何专门的或简化的锋生公式。相反，您必须基于以下基础来构建 $F$。\n\n基本原理：\n- 标量场 $\\theta$ 的物质导数为 $D\\theta/Dt = \\partial \\theta/\\partial t + \\mathbf{v}\\cdot\\nabla \\theta$。\n- 梯度的物质导数遵循输运恒等式 $D(\\nabla \\theta)/Dt = \\nabla(D\\theta/Dt) - (\\nabla \\mathbf{v})^{\\top}\\nabla \\theta$。\n- 在对分析快照进行分析时，若满足绝热无摩擦条件，可以设定 $D\\theta/Dt \\approx 0$ 以分离出运动学贡献。\n- 水平速度梯度张量 $\\nabla \\mathbf{v}$ 可以分解为对称的应变率部分和反对称的旋转部分，而散度 $\\nabla\\cdot\\mathbf{v}$ 是该张量的迹。\n\n区域与场：\n- 考虑一个正方形双周期域，边长 $L_x = L_y = 1.0\\times 10^6$ 米，在一个 $N\\times N$ 的网格上离散化，其中 $N = 256$，均匀间距为 $\\Delta x = \\Delta y = L_x/N$ 米，且在两个方向上均采用周期性边界条件。\n- 定义位温场 $\\theta(x,y)$，它代表一个具有可控锋利度和噪声的曲折锋区：\n$$\n\\theta(x,y) = \\theta_{\\mathrm{ref}} + \\Delta \\theta \\,\\tanh\\!\\left(\\frac{y - y_0 + A\\cos(k_x x)}{w}\\right) + \\eta\\,\\xi(x,y),\n$$\n其中 $x\\in[0,L_x)$，$y\\in[0,L_y)$，$\\theta_{\\mathrm{ref}} = 280\\,\\mathrm{K}$，$\\Delta \\theta = 12\\,\\mathrm{K}$，$y_0 = L_y/2$，$A = 1.0\\times 10^5\\,\\mathrm{m}$，$k_x = 6\\pi/L_x$，$w$ 是锋面半宽（单位：米），$\\eta$ 是噪声振幅（单位：开尔文），$\\xi(x,y)$ 是一个零均值、单位方差的高斯随机场。\n- 定义一个具有真实感合流和切变且在两个方向上均是周期性的水平变化风场：\n$$\nu(x,y) = U_0 + a \\sin(k_x x)\\cos(k_y y),\\quad v(x,y) = V_0 + b \\cos(k_x x)\\sin(k_y y),\n$$\n其中 $U_0 = 10\\,\\mathrm{m\\,s^{-1}}$，$V_0 = 0\\,\\mathrm{m\\,s^{-1}}$，$a = 8\\,\\mathrm{m\\,s^{-1}}$，$b = 6\\,\\mathrm{m\\,s^{-1}}$，$k_y = 6\\pi/L_y$。\n\n任务：\n- 仅从上述基本原理出发，推导运动锋生函数 $F$ 的表达式。$F$ 定义为 $\\theta$ 水平梯度大小的物质变化率，即：\n$$\nF \\equiv \\frac{D}{Dt}\\left\\lVert \\nabla_h \\theta \\right\\rVert,\n$$\n该表达式应完全用 $\\theta$、$u$ 和 $v$ 的水平一阶导数来表示。\n- 编写一个程序，在网格上使用两种一阶导数有限差分格式计算 $F$ 的空间分布图：二阶中心差分 ($p=2$) 和四阶中心差分 ($p=4$)，两者都采用周期性边界条件。为了检验敏感性，可选择性地使用标准差为 $\\sigma$（以网格点为单位）的高斯滤波器对 $\\theta$、$u$ 和 $v$ 场进行预滤波，并进行周期性环绕处理。\n- 通过报告每个测试案例中严格为正的 $F$ 值（仅锋生区）的区域平均值来量化敏感性，单位为 $\\mathrm{K\\,m^{-1}\\,s^{-1}}$。如果没有严格为正的值，则报告 $0.0$。\n\n单位：\n- 所有最终数值答案均以 $\\mathrm{K\\,m^{-1}\\,s^{-1}}$ 为单位。\n- 不需要角度，因此无需指定角度单位。\n\n测试组：\n使用以下五个测试案例，每个案例由元组 $(p,\\sigma,w,\\eta)$ 定义，其中 $p$ 是有限差分阶数，$\\sigma$ 是高斯滤波器的标准差（以网格点为单位），$w$ 是锋面半宽（单位：米），$\\eta$ 是噪声振幅（单位：开尔文）。\n\n- 案例1：$(2, 0, 6.0\\times 10^4, 0.0)$，一个使用二阶差分且无滤波的解析良好的基准案例。\n- 案例2：$(4, 0, 6.0\\times 10^4, 0.0)$，一个使用四阶差分且无滤波的解析良好的基准案例。\n- 案例3：$(2, 0, 2.0\\times 10^4, 0.5)$，一个增加了噪声且无滤波的临界解析的陡峭锋面。\n- 案例4：$(2, 1, 2.0\\times 10^4, 0.5)$，与案例3相同，但进行了轻微的高斯平滑。\n- 案例5：$(4, 2, 1.5\\times 10^4, 1.0)$，一个使用更强平滑和更高阶差分的非常陡峭、充满噪声的锋面。\n\n输出规格：\n- 对每个测试案例，计算 $F>0$ 的点上的 $F$ 值的区域平均值，结果四舍五入到6位小数，单位为 $\\mathrm{K\\,m^{-1}\\,s^{-1}}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 对应于上面指定顺序的案例 $i$ 的结果。",
            "solution": "问题要求从流体动力学的基本原理出发，推导并数值计算运动锋生函数 $F$。然后，我们必须将此计算应用于一组涉及半解析锋区的测试案例，评估结果对数值微分格式和预滤波的敏感性。\n\n### **第一部分：锋生函数的推导**\n\n锋生函数 $F$ 定义为水平位温梯度 $\\nabla_h \\theta$ 大小的物质变化率。水平梯度向量为 $\\nabla_h \\theta = \\frac{\\partial \\theta}{\\partial x}\\mathbf{i} + \\frac{\\partial \\theta}{\\partial y}\\mathbf{j}$，其大小为 $\\lVert \\nabla_h \\theta \\rVert = \\sqrt{(\\frac{\\partial \\theta}{\\partial x})^2 + (\\frac{\\partial \\theta}{\\partial y})^2}$。\n\n$F$ 的定义是：\n$$\nF \\equiv \\frac{D}{Dt}\\left\\lVert \\nabla_h \\theta \\right\\rVert = \\frac{D}{Dt} \\left( (\\nabla_h \\theta) \\cdot (\\nabla_h \\theta) \\right)^{1/2}\n$$\n应用物质导数 $\\frac{D}{Dt}$ 的链式法则：\n$$\nF = \\frac{1}{2 \\left( (\\nabla_h \\theta) \\cdot (\\nabla_h \\theta) \\right)^{1/2}} \\frac{D}{Dt} \\left( (\\nabla_h \\theta) \\cdot (\\nabla_h \\theta) \\right)\n$$\n使用点积的物质导数乘积法则 $\\frac{D}{Dt}(\\mathbf{A} \\cdot \\mathbf{B}) = \\frac{D\\mathbf{A}}{Dt}\\cdot\\mathbf{B} + \\mathbf{A}\\cdot\\frac{D\\mathbf{B}}{Dt}$：\n$$\nF = \\frac{1}{2 \\lVert \\nabla_h \\theta \\rVert} \\left( \\frac{D(\\nabla_h \\theta)}{Dt} \\cdot (\\nabla_h \\theta) + (\\nabla_h \\theta) \\cdot \\frac{D(\\nabla_h \\theta)}{Dt} \\right) = \\frac{1}{\\lVert \\nabla_h \\theta \\rVert} \\left( (\\nabla_h \\theta) \\cdot \\frac{D(\\nabla_h \\theta)}{Dt} \\right)\n$$\n此时，我们必须找到 $\\frac{D(\\nabla_h \\theta)}{Dt}$ 的表达式。问题给出了标量场梯度的输运恒等式：\n$$\n\\frac{D(\\nabla \\theta)}{Dt} = \\nabla\\left(\\frac{D\\theta}{Dt}\\right) - (\\nabla \\mathbf{v})^{\\top}\\nabla \\theta\n$$\n此恒等式适用于三维空间，但由于我们关心的是水平梯度 $\\nabla_h \\theta$ 和水平速度 $\\mathbf{v}_h = (u,v)$，我们使用其水平对应形式：\n$$\n\\frac{D(\\nabla_h \\theta)}{Dt} = \\nabla_h\\left(\\frac{D\\theta}{Dt}\\right) - (\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta\n$$\n问题指出，对于一个大气快照在绝热无摩擦条件下的运动学分析，我们可以假定位温的物质导数近似为零，即 $\\frac{D\\theta}{Dt} \\approx 0$。这极大地简化了输运恒等式：\n$$\n\\frac{D(\\nabla_h \\theta)}{Dt} \\approx - (\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta\n$$\n将此结果代回 $F$ 的表达式中：\n$$\nF \\approx -\\frac{1}{\\lVert \\nabla_h \\theta \\rVert} \\left( (\\nabla_h \\theta) \\cdot ((\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta) \\right)\n$$\n为了得到一个计算公式，我们用分量形式来表示它。令 $\\theta_x = \\frac{\\partial \\theta}{\\partial x}$ 和 $\\theta_y = \\frac{\\partial \\theta}{\\partial y}$。水平梯度向量为 $\\nabla_h \\theta = \\begin{pmatrix} \\theta_x \\\\ \\theta_y \\end{pmatrix}$。水平速度梯度张量为 $\\nabla_h \\mathbf{v}_h = \\begin{pmatrix} u_x  u_y \\\\ v_x  v_y \\end{pmatrix}$，其中 $u_x = \\frac{\\partial u}{\\partial x}$，以此类推。其转置为 $(\\nabla_h \\mathbf{v}_h)^{\\top} = \\begin{pmatrix} u_x  v_x \\\\ u_y  v_y \\end{pmatrix}$。\n\n向量项 $-(\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta$ 变为：\n$$\n-\\begin{pmatrix} u_x  v_x \\\\ u_y  v_y \\end{pmatrix} \\begin{pmatrix} \\theta_x \\\\ \\theta_y \\end{pmatrix} = -\\begin{pmatrix} u_x \\theta_x + v_x \\theta_y \\\\ u_y \\theta_x + v_y \\theta_y \\end{pmatrix}\n$$\n现在，与 $\\nabla_h \\theta = \\begin{pmatrix} \\theta_x \\\\ \\theta_y \\end{pmatrix}$ 求点积：\n$$\n(\\nabla_h \\theta) \\cdot ( -(\\nabla_h \\mathbf{v}_h)^{\\top}\\nabla_h \\theta ) = \\theta_x(-u_x \\theta_x - v_x \\theta_y) + \\theta_y(-u_y \\theta_x - v_y \\theta_y) = - (u_x \\theta_x^2 + (u_y + v_x)\\theta_x \\theta_y + v_y \\theta_y^2)\n$$\n将这最后一部分代入 $F$ 的表达式，得到完全用场 $\\theta$、$u$ 和 $v$ 的一阶导数表示的运算公式：\n$$\nF = -\\frac{u_x \\theta_x^2 + (u_y+v_x)\\theta_x\\theta_y + v_y \\theta_y^2}{\\sqrt{\\theta_x^2 + \\theta_y^2}}\n$$\n这就是运动锋生函数。分子是一个二次型，描述了应变率张量在梯度向量上的投影，证实了锋生是由流体变形场压缩等温线驱动的。\n\n### **第二部分：数值实现**\n\n对每个测试案例，实现过程分几个步骤进行。\n\n1.  **网格与场生成**：构建一个大小为 $N \\times N$（$N=256$）、边长为 $L=1.0\\times 10^6\\,\\mathrm{m}$ 的均匀双周期网格。使用指定的解析函数和参数 $(w, \\eta)$ 在每个网格点上计算位温场 $\\theta(x,y)$ 和风场 $u(x,y)$、$v(x,y)$。随机场 $\\xi(x,y)$ 由标准正态分布生成。\n\n2.  **高斯滤波**：对于滤波器标准差 $\\sigma > 0$ 的测试案例，对 $\\theta$、$u$ 和 $v$ 场进行预滤波。为了正确处理周期性边界条件，滤波在频域中执行。每个场都使用二维快速傅里叶变换 (FFT) 进行变换。变换后的场与一个谱滤波器相乘，该滤波器是高斯核的傅里叶变换。核的标准差为 $\\sigma_{phys} = \\sigma \\cdot \\Delta x$，其中 $\\sigma$ 以网格点为单位指定，$\\Delta x$ 是网格间距。然后将得到的谱通过逆变换转回物理空间，得到平滑后的场。\n\n3.  **数值微分**：$F$ 公式所需的一阶导数（$\\theta_x, \\theta_y, u_x, u_y, v_x, v_y$）使用有限差分计算。问题指定了两种中心差分格式：二阶格式 ($p=2$) 和四阶格式 ($p=4$)。通过使用 `numpy.roll` 对数组进行循环移位来处理周期性边界条件，这等效于跨越区域边界访问相邻网格点。\n    - 二阶：$\\frac{\\partial f}{\\partial x}\\bigg|_i \\approx \\frac{f_{i+1} - f_{i-1}}{2\\Delta x}$\n    - 四阶：$\\frac{\\partial f}{\\partial x}\\bigg|_i \\approx \\frac{-f_{i+2} + 8f_{i+1} - 8f_{i-1} + f_{i-2}}{12\\Delta x}$\n\n4.  **计算与分析**：在计算出所有导数场后，使用推导出的公式在每个网格点上计算锋生函数 $F$。在分母中使用一个很小的 epsilon 以避免在位温梯度数值上为零的区域（此时分子也为零，$F$ 定义为 $0$）出现除以零的错误。最后，为量化每个测试案例的结果，我们找出所有 $F > 0$（锋生区域）的网格点。计算这些严格为正的值的算术平均值。如果没有这样的值存在，结果为 $0.0$。最终值以 $\\mathrm{K\\,m^{-1}\\,s^{-1}}$ 为单位报告。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the kinematic frontogenesis function for a series of test cases.\n    \"\"\"\n\n    def get_derivatives(field, dx, dy, order):\n        \"\"\"\n        Computes first derivatives of a 2D field using centered finite differences\n        with periodic boundary conditions.\n        \"\"\"\n        if order == 2:\n            # Second-order centered difference\n            df_dx = (np.roll(field, -1, axis=1) - np.roll(field, 1, axis=1)) / (2 * dx)\n            df_dy = (np.roll(field, -1, axis=0) - np.roll(field, 1, axis=0)) / (2 * dy)\n        elif order == 4:\n            # Fourth-order centered difference\n            df_dx = (-np.roll(field, -2, axis=1) + 8 * np.roll(field, -1, axis=1) -\n                     8 * np.roll(field, 1, axis=1) + np.roll(field, 2, axis=1)) / (12 * dx)\n            df_dy = (-np.roll(field, -2, axis=0) + 8 * np.roll(field, -1, axis=0) -\n                     8 * np.roll(field, 1, axis=0) + np.roll(field, 2, axis=0)) / (12 * dy)\n        else:\n            raise ValueError(f\"Finite difference order p={order} is not supported. Must be 2 or 4.\")\n        return df_dx, df_dy\n\n    def gaussian_filter_2d(field, sigma, dx, dy):\n        \"\"\"\n        Applies a 2D Gaussian filter in the frequency domain to handle\n        periodic boundary conditions correctly. sigma is in grid points.\n        \"\"\"\n        if sigma == 0:\n            return field\n        \n        N, M = field.shape\n        # Wavenumbers\n        kx = 2 * np.pi * np.fft.fftfreq(M, d=dx)\n        ky = 2 * np.pi * np.fft.fftfreq(N, d=dy)\n        Kx, Ky = np.meshgrid(kx, ky)\n        \n        # Physical standard deviation\n        sigma_phys_x = sigma * dx\n        sigma_phys_y = sigma * dy\n\n        # Gaussian kernel in Fourier space\n        kernel_fourier = np.exp(-0.5 * (Kx**2 * sigma_phys_x**2 + Ky**2 * sigma_phys_y**2))\n        \n        # Apply filter\n        field_fourier = np.fft.fft2(field)\n        filtered_field_fourier = field_fourier * kernel_fourier\n        filtered_field = np.fft.ifft2(filtered_field_fourier).real\n        \n        return filtered_field\n\n    # Domain and physical constants\n    N = 256\n    L = 1.0e6  # L_x = L_y\n    dx = L / N\n    dy = L / N\n    theta_ref = 280.0\n    delta_theta = 12.0\n    y0 = L / 2.0\n    A = 1.0e5\n    kx_val = 6.0 * np.pi / L\n    ky_val = 6.0 * np.pi / L\n    U0 = 10.0\n    V0 = 0.0\n    a = 8.0\n    b = 6.0\n    \n    # Grid coordinates\n    x_1d = np.arange(N) * dx\n    y_1d = np.arange(N) * dy\n    X, Y = np.meshgrid(x_1d, y_1d)\n\n    test_cases = [\n        # (p, sigma, w, eta)\n        (2, 0.0, 6.0e4, 0.0),\n        (4, 0.0, 6.0e4, 0.0),\n        (2, 0.0, 2.0e4, 0.5),\n        (2, 1.0, 2.0e4, 0.5),\n        (4, 2.0, 1.5e4, 1.0),\n    ]\n\n    results = []\n    \n    # Use a fixed seed for reproducible noise\n    np.random.seed(0)\n\n    for p, sigma, w, eta in test_cases:\n        # Generate noise field (zero-mean, unit-variance)\n        xi = np.random.randn(N, N) if eta > 0 else np.zeros((N, N))\n\n        # Generate analytical fields\n        theta = theta_ref + delta_theta * np.tanh((Y - y0 + A * np.cos(kx_val * X)) / w) + eta * xi\n        u = U0 + a * np.sin(kx_val * X) * np.cos(ky_val * Y)\n        v = V0 + b * np.cos(kx_val * X) * np.sin(ky_val * Y)\n\n        # Apply spatial filtering if specified\n        theta_f = gaussian_filter_2d(theta, sigma, dx, dy)\n        u_f = gaussian_filter_2d(u, sigma, dx, dy)\n        v_f = gaussian_filter_2d(v, sigma, dx, dy)\n        \n        # Compute all required first derivatives\n        theta_x, theta_y = get_derivatives(theta_f, dx, dy, p)\n        u_x, u_y = get_derivatives(u_f, dx, dy, p)\n        v_x, v_y = get_derivatives(v_f, dx, dy, p)\n\n        # Compute the kinematic frontogenesis function F\n        # Numerator: -(u_x*theta_x^2 + (u_y+v_x)*theta_x*theta_y + v_y*theta_y^2)\n        numerator = -(u_x * theta_x**2 + (u_y + v_x) * theta_x * theta_y + v_y * theta_y**2)\n        \n        # Denominator: |grad_h theta|\n        grad_theta_mag = np.sqrt(theta_x**2 + theta_y**2)\n        \n        # Calculate F, avoiding division by zero\n        # Where grad_theta_mag is zero, numerator is also zero, so F=0.\n        F = np.zeros_like(grad_theta_mag)\n        mask_denom_nonzero = grad_theta_mag > 1e-15\n        F[mask_denom_nonzero] = numerator[mask_denom_nonzero] / grad_theta_mag[mask_denom_nonzero]\n        \n        # Calculate the domain-mean of strictly positive F values\n        F_positive = F[F > 0]\n        \n        if F_positive.size > 0:\n            mean_F_pos = np.mean(F_positive)\n        else:\n            mean_F_pos = 0.0\n\n        results.append(f\"{mean_F_pos:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "锋生过程不仅是运动学的，它还会驱动一个动力学响应——即锋面次级环流。本练习引导您对这一响应进行建模，通过求解Sawyer-Eliassen方程来模拟锋面附近的垂直和跨锋面风场。通过对比准地转（Quasi-Geostrophic, QG）和半地转（Semi-Geostrophic, SG）理论下的环流解，您将深刻理解为何更高级的平衡模式对于准确刻画急流区强锋区的狭窄而强烈的环流至关重要。",
            "id": "4046318",
            "problem": "考虑一个Boussinesq近似下的干燥、无粘、稳定层结大气，该大气处于静力平衡和地转平衡状态，并假设沿锋均匀，使得所有变化都局限在一个垂直横截面内，该横截面具有水平坐标 $x$（跨锋）和垂直坐标 $z$。用 $u_g$ 和 $v_g$ 表示地转风分量，用 $f$ 表示科里奥利参数，用 $N$ 表示Brunt–Väisälä频率，用 $S_g = \\partial v_g / \\partial x$ 表示跨锋的水平地转切变。跨锋次级环流由一个流函数 $\\psi(x,z)$ 表示，该流函数在二维 $(x,z)$ 平面内满足质量连续性，其非地转风分量定义为 $u_a(x,z) = \\partial \\psi / \\partial z$ 和 $w(x,z) = - \\partial \\psi / \\partial x$，其中 $w$ 是垂直速度。在平衡理论中，与锋生相关的稳定横向环流可以用一个关于 $\\psi$ 的椭圆型偏微分方程来表示，其系数取决于底层的平衡框架。\n\n从旋转参考系中的无粘动量方程、静力关系、Boussinesq连续性约束以及基本态的地转平衡出发，\n- 地转平衡：$f v_g = \\partial \\phi / \\partial x$，$- f u_g = \\partial \\phi / \\partial y$，\n- 静力平衡：$\\partial \\phi / \\partial z = b$，其中 $\\phi$ 是位势， $b$ 是浮力，\n- Boussinesq连续性：$\\partial u_a / \\partial x + \\partial w / \\partial z = 0$，\n可以消去气压，将横向环流问题简化为 $(x,z)$ 平面内关于 $\\psi$ 的单个二阶椭圆方程。在准地转（QG）近似中，有效静力稳定度保持为干静力稳定度 $N^2$，并且椭圆算子在除去一个由比率 $f^2/N^2$ 导出的常数因子后是各向同性的。在半地转（SG）近似中，到地转动量坐标的坐标变换通过沿锋绝对动量梯度修改了有效静力稳定度，从而在强锋中增强了非地转环流。对于一个强锋，一个广泛使用的参数化方法是在保留椭圆性的同时捕捉这种增强效应，该方法是将 $N^2$ 替换为一个有效稳定度 $N_{\\text{eff}}^2$，定义为\n$$\nN_{\\text{eff}}^2 = \\max\\!\\left(\\varepsilon N^2,\\; N^2 - \\gamma S_g^2\\right),\n$$\n其中 $0  \\varepsilon  1$ 是一个强制椭圆性的小型保险因子，$\\gamma$ 是一个缩放切变贡献的无量纲系数。通过这个降低的有效稳定度，SG公式相对于QG情况增加了算子的各向异性，并在相同的锋生强迫下产生更强的跨锋次级环流。在QG和SG中，我们都使用简化的椭圆算子和局地化的运动学锋生强迫来模拟 $(x,z)$ 平面中的Sawyer–Eliassen方程：\n$$\n\\alpha \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} = S(x,z),\n$$\n其中\n$$\n\\alpha_{\\text{QG}} = \\frac{f^2}{N^2}, \\quad \\alpha_{\\text{SG}} = \\frac{f^2}{N_{\\text{eff}}^2}, \\quad\nS(x,z) = D \\exp\\!\\left(-\\left(\\frac{x}{w_x}\\right)^2 - \\left(\\frac{z - z_0}{w_z}\\right)^2\\right).\n$$\n这里 $D$ 是锋生率，单位为 $\\mathrm{s^{-1}}$，$w_x$ 和 $w_z$ 是水平和垂直的局地化半宽度，单位为 $\\mathrm{m}$，$z_0$ 是强迫中心的层级。边界条件是在所有区域边界上 $\\psi = 0$，意味着没有横向流穿过边界。从解 $\\psi$ 中，可以通过以下方式恢复任意点 $(x,z)$ 的跨锋非地转风和垂直速度：\n$$\nu_a(x,z) = \\frac{\\partial \\psi}{\\partial z}, \\quad\nw(x,z) = - \\frac{\\partial \\psi}{\\partial x}.\n$$\n\n您的任务是使用均匀网格上的二阶中心有限差分法，为上述椭圆问题实现一个数值求解器，并对 $\\psi$ 使用均匀Dirichlet边界条件。对于每个测试用例，分别使用 $\\alpha_{\\text{QG}}$ 和 $\\alpha_{\\text{SG}}$ 计算QG和SG解，并报告在 $(x = 0, z = z_0)$ 处评估的跨锋非地转风 $u_a$ 和垂直速度 $w$。所有速度均以 $\\mathrm{m\\,s^{-1}}$ 表示，并四舍五入到六位小数。\n\n离散化要求：\n- 区域：$x \\in [-L_x/2, L_x/2]$，$z \\in [0, L_z]$。\n- 网格分辨率：$x$ 方向 $N_x = 129$ 个点，$z$ 方向 $N_z = 65$ 个点，间距均匀。\n- 有限差分格式：对内部点使用拉普拉斯算子的二阶中心差分，边界上 $\\psi = 0$。\n- 报告的导数评估：在最接近 $(x=0, z=z_0)$ 的网格点上使用二阶中心差分。\n\n使用以下测试套件。所有物理参数均以SI单位给出，所有常数必须严格按照程序中指定的方式使用。\n\n- 情况 $1$（理想情况，中纬度强锋）：\n  - $L_x = 2.00 \\times 10^{5}\\ \\mathrm{m}$，\n  - $L_z = 5.00 \\times 10^{3}\\ \\mathrm{m}$，\n  - $w_x = 2.50 \\times 10^{4}\\ \\mathrm{m}$，\n  - $w_z = 1.00 \\times 10^{3}\\ \\mathrm{m}$，\n  - $z_0 = 2.50 \\times 10^{3}\\ \\mathrm{m}$，\n  - $f = 1.00 \\times 10^{-4}\\ \\mathrm{s^{-1}}$，\n  - $N = 1.00 \\times 10^{-2}\\ \\mathrm{s^{-1}}$，\n  - $S_g = 3.00 \\times 10^{-3}\\ \\mathrm{s^{-1}}$，\n  - $\\gamma = 5.00 \\times 10^{-1}$，\n  - $\\varepsilon = 5.00 \\times 10^{-2}$，\n  - $D = 1.00 \\times 10^{-5}\\ \\mathrm{s^{-1}}$。\n\n- 情况 $2$（更强的切变和强迫，仍为椭圆型）：\n  - $L_x = 2.00 \\times 10^{5}\\ \\mathrm{m}$，\n  - $L_z = 5.00 \\times 10^{3}\\ \\mathrm{m}$，\n  - $w_x = 2.50 \\times 10^{4}\\ \\mathrm{m}$，\n  - $w_z = 1.00 \\times 10^{3}\\ \\mathrm{m}$，\n  - $z_0 = 2.50 \\times 10^{3}\\ \\mathrm{m}$，\n  - $f = 1.00 \\times 10^{-4}\\ \\mathrm{s^{-1}}$，\n  - $N = 1.00 \\times 10^{-2}\\ \\mathrm{s^{-1}}$，\n  - $S_g = 5.00 \\times 10^{-3}\\ \\mathrm{s^{-1}}$，\n  - $\\gamma = 8.00 \\times 10^{-1}$，\n  - $\\varepsilon = 5.00 \\times 10^{-2}$，\n  - $D = 3.00 \\times 10^{-5}\\ \\mathrm{s^{-1}}$。\n\n- 情况 $3$（无水平切变的边界情况，因此SG简化为QG）：\n  - $L_x = 2.00 \\times 10^{5}\\ \\mathrm{m}$，\n  - $L_z = 5.00 \\times 10^{3}\\ \\mathrm{m}$，\n  - $w_x = 2.50 \\times 10^{4}\\ \\mathrm{m}$，\n  - $w_z = 1.00 \\times 10^{3}\\ \\mathrm{m}$，\n  - $z_0 = 2.50 \\times 10^{3}\\ \\mathrm{m}$，\n  - $f = 1.00 \\times 10^{-4}\\ \\mathrm{s^{-1}}$，\n  - $N = 1.00 \\times 10^{-2}\\ \\mathrm{s^{-1}}$，\n  - $S_g = 0.00 \\times 10^{0}\\ \\mathrm{s^{-1}}$，\n  - $\\gamma = 5.00 \\times 10^{-1}$，\n  - $\\varepsilon = 5.00 \\times 10^{-2}$，\n  - $D = 1.00 \\times 10^{-5}\\ \\mathrm{s^{-1}}$。\n\n您的程序必须为每种情况构建有限差分线性系统，使用稀疏线性求解器求解 $\\psi$，计算QG和SG在 $(x=0,z=z_0)$ 处的 $u_a$ 和 $w$，并将所有测试用例的结果汇总到一行输出中，该输出包含一个列表的列表。每个子列表必须是以下形式\n$$\n\\left[ u_{a,\\text{QG}},\\ w_{\\text{QG}},\\ u_{a,\\text{SG}},\\ w_{\\text{SG}},\\ u_{a,\\text{SG}} - u_{a,\\text{QG}},\\ w_{\\text{SG}} - w_{\\text{QG}} \\right],\n$$\n所有条目均以 $\\mathrm{m\\,s^{-1}}$ 为单位，并四舍五入到六位小数。您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如 $\\left[ [\\ldots],[\\ldots],[\\ldots] \\right]$。",
            "solution": "用户提供了一个问题，要求对一个二维椭圆型偏微分方程进行数值求解，该方程被称为Sawyer-Eliassen方程，用于描述大气锋中的次级环流。该解需要针对两种不同的物理近似进行计算：准地转（QG）和半地转（SG）。\n\n### 第一步：问题验证\n\n**1. 提取给定信息**\n\n- **控制方程：** 流函数 $\\psi(x,z)$ 的椭圆型偏微分方程为\n$$\n\\alpha \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} = S(x,z)\n$$\n- **区域：** 一个由 $x \\in [-L_x/2, L_x/2]$ 和 $z \\in [0, L_z]$ 定义的矩形区域。\n- **边界条件：** 在区域的所有四个边界上采用均匀Dirichlet条件，即 $\\psi = 0$。\n- **强迫项：** 一个高斯强迫函数，由下式给出\n$$\nS(x,z) = D \\exp\\!\\left(-\\left(\\frac{x}{w_x}\\right)^2 - \\left(\\frac{z - z_0}{w_z}\\right)^2\\right)\n$$\n- **系数：** 系数 $\\alpha$ 取决于所用的近似：\n    - **QG：** $\\alpha_{\\text{QG}} = \\frac{f^2}{N^2}$，其中 $f$ 是科里奥利参数，$N$ 是Brunt–Väisälä频率。\n    - **SG：** $\\alpha_{\\text{SG}} = \\frac{f^2}{N_{\\text{eff}}^2}$，其有效稳定度定义为 $N_{\\text{eff}}^2 = \\max\\!\\left(\\varepsilon N^2,\\; N^2 - \\gamma S_g^2\\right)$。这里，$S_g$ 是地转切变，$\\gamma$ 是一个无量纲系数，$\\varepsilon$ 是一个确保椭圆性的小参数。\n- **输出量：** 需要在点 $(x=0, z=z_0)$ 处计算跨锋非地转风 $u_a = \\partial \\psi / \\partial z$ 和垂直速度 $w = - \\partial \\psi / \\partial x$。\n- **数值方法：**\n    - **离散化：** 在均匀网格上使用二阶中心有限差分。\n    - **网格：** $x$ 方向 $N_x = 129$ 个点，$z$ 方向 $N_z = 65$ 个点。\n    - **导数：** 使用二阶中心差分计算 $u_a$ 和 $w$。\n- **测试用例：** 提供了三组物理参数（$L_x, L_z, w_x, w_z, z_0, f, N, S_g, \\gamma, \\varepsilon, D$）。\n\n**2. 使用提取的给定信息进行验证**\n\n- **科学基础（关键）：** 该问题根本上基于Sawyer-Eliassen方程，这是研究锋面环流的动力气象学基石。QG和SG近似是标准方法，SG情况下有效稳定度的参数化是一种物理上合理的方法，用以解释强锋中运动的倾斜特性。所有参数都在地球大气的物理现实范围内。该问题在科学上是合理的。\n- **适定性：** 控制方程是一个线性的二阶椭圆型偏微分方程。QG和SG情况下的系数 $\\alpha$ 均保证为正（$f^2>0, N^2>0, N_{\\text{eff}}^2>0$），这确保了算子是椭圆的。在封闭区域上给定Dirichlet边界条件，该问题是适定的，存在唯一且稳定的解。\n- **客观性（关键）：** 问题以精确的数学语言陈述，没有歧义或主观论断。所有参数、方法和输出要求都已明确定义。\n- **完整性和一致性：** 问题提供了进行求解所需的所有必要信息——控制方程、边界条件、区域几何、物理参数和数值方案。没有矛盾之处。\n\n**3. 结论和行动**\n\n该问题是**有效的**，因为它科学基础扎实、适定、客观且完整。我将着手开发数值解法。\n\n### 第二步：基于原理的求解方案设计\n\n核心任务是求解由椭圆型偏微分方程的有限差分离散化产生的线性方程组。\n\n**偏微分方程的离散化**\n在区域 $(x,z) \\in [-L_x/2, L_x/2] \\times [0, L_z]$ 上定义一个均匀网格，网格间距为 $\\Delta x = L_x / (N_x - 1)$ 和 $\\Delta z = L_z / (N_z - 1)$。设 $\\psi_{i,j}$ 表示网格点 $(z_i, x_j)$ 处的流函数值。在内部网格点 $(i,j)$ 处，控制方程的二阶中心差分近似为：\n$$\n\\alpha \\left( \\frac{\\psi_{i,j+1} - 2\\psi_{i,j} + \\psi_{i,j-1}}{\\Delta x^2} \\right) + \\left( \\frac{\\psi_{i+1,j} - 2\\psi_{i,j} + \\psi_{i-1,j}}{\\Delta z^2} \\right) = S_{i,j}\n$$\n这可以重新排列成一个关于所有内部点上未知 $\\psi$ 值的线性方程。这些方程的集合构成一个大型稀疏线性系统，形式为 $\\mathbf{A} \\vec{\\psi} = \\vec{S}$，其中 $\\mathbf{A}$ 是表示离散化椭圆算子的矩阵，$\\vec{\\psi}$ 是内部网格点上未知流函数值的向量，$\\vec{S}$ 是这些点上强迫项值的向量。Dirichlet边界条件 $\\psi=0$ 通过仅求解内部点并将边界值设为零来并入。\n\n**线性系统的构建**\n矩阵 $\\mathbf{A}$ 是一个块三对角矩阵。一个标准且数值稳健的构建方法是使用克罗内克积。二维拉普拉斯算子可以表示为作用于矢量化二维场的两个算子（每个空间维度一个）之和。设 $\\mathbf{D}_{xx}$ 和 $\\mathbf{D}_{zz}$ 分别是 $x$ 和 $z$ 维度的一维二阶导数矩阵，$\\mathbf{I}_x$ 和 $\\mathbf{I}_z$ 是相应的单位矩阵。矩阵 $\\mathbf{A}$ 可以构建为：\n$$\n\\mathbf{A} = \\mathbf{I}_z \\otimes (\\alpha \\mathbf{D}_{xx}) + \\mathbf{D}_{zz} \\otimes \\mathbf{I}_x\n$$\n其中 $\\otimes$ 表示克罗内克积。这种构建方式正确地表示了二维有限差分模板中网格点的连通性。右侧向量 $\\vec{S}$ 是通过将内部网格点上评估的强迫项 $S(x,z)$ 的二维数组展平而形成的。\n\n**系统求解与后处理**\n一旦构建了矩阵 $\\mathbf{A}$ 和向量 $\\vec{S}$，就使用稀疏线性代数求解器（如 `scipy.sparse.linalg.spsolve`）求解线性系统以得到 $\\vec{\\psi}$。得到的解向量随后被重塑为一个二维数组，表示内部点的流函数。这个内部解被嵌入一个大小为 $N_z \\times N_x$ 的更大二维数组中，该数组初始化为零以强制执行边界条件。\n\n最后，在指定的点 $(x=0, z=z_0)$ 处，使用求解出的 $\\psi$ 场上的二阶中心有限差分来计算非地转风分量 $u_a$ 和 $w$：\n$$\nu_{a,i_0,j_0} = \\frac{\\psi_{i_0+1,j_0} - \\psi_{i_0-1,j_0}}{2 \\Delta z}\n$$\n$$\nw_{i_0,j_0} = - \\frac{\\psi_{i_0,j_0+1} - \\psi_{i_0,j_0-1}}{2 \\Delta x}\n$$\n其中 $(i_0, j_0)$ 是对应于点 $(x=0, z=z_0)$ 的网格索引。对于每一组测试参数，整个过程都会针对QG和SG两种情况（通过重新计算 $\\alpha$ 并重新求解系统）重复进行。对于 $S_g=0$ 的特殊情况，$\\alpha_{\\text{SG}}$ 等于 $\\alpha_{\\text{QG}}$，SG解与QG解相同，这允许进行计算优化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import diags, kron, linalg, csc_matrix\n\ndef solve():\n    \"\"\"\n    Main function to solve the Sawyer-Eliassen equation for QG and SG\n    approximations across a suite of test cases.\n    \"\"\"\n    \n    # -- Problem Constants --\n    # Grid resolution\n    Nx = 129\n    Nz = 65\n\n    # -- Test Cases Definition --\n    test_cases = [\n        # Case 1 (happy path, midlatitude sharp front)\n        {\n            \"Lx\": 2.00e5, \"Lz\": 5.00e3, \"wx\": 2.50e4, \"wz\": 1.00e3, \"z0\": 2.50e3,\n            \"f\": 1.00e-4, \"N\": 1.00e-2, \"Sg\": 3.00e-3, \"gamma\": 0.50,\n            \"epsilon\": 0.05, \"D\": 1.00e-5\n        },\n        # Case 2 (stronger shear and forcing, still elliptic)\n        {\n            \"Lx\": 2.00e5, \"Lz\": 5.00e3, \"wx\": 2.50e4, \"wz\": 1.00e3, \"z0\": 2.50e3,\n            \"f\": 1.00e-4, \"N\": 1.00e-2, \"Sg\": 5.00e-3, \"gamma\": 0.80,\n            \"epsilon\": 0.05, \"D\": 3.00e-5\n        },\n        # Case 3 (edge case with no horizontal shear, so SG reduces to QG)\n        {\n            \"Lx\": 2.00e5, \"Lz\": 5.00e3, \"wx\": 2.50e4, \"wz\": 1.00e3, \"z0\": 2.50e3,\n            \"f\": 1.00e-4, \"N\": 1.00e-2, \"Sg\": 0.0, \"gamma\": 0.50,\n            \"epsilon\": 0.05, \"D\": 1.00e-5\n        },\n    ]\n\n    # --- Helper function to construct the finite-difference matrix ---\n    def construct_A(alpha, Nx, Nz, dx, dz):\n        num_x_interior = Nx - 2\n        num_z_interior = Nz - 2\n\n        # 1D second-derivative operator for x-direction\n        Dxx_1d = diags([1, -2, 1], [-1, 0, 1], shape=(num_x_interior, num_x_interior), format='csc') / (dx**2)\n        \n        # 1D second-derivative operator for z-direction\n        Dzz_1d = diags([1, -2, 1], [-1, 0, 1], shape=(num_z_interior, num_z_interior), format='csc') / (dz**2)\n        \n        # Identity matrices for Kronecker product\n        Ix = diags([np.ones(num_x_interior)], [0], format='csc')\n        Iz = diags([np.ones(num_z_interior)], [0], format='csc')\n        \n        # Assemble the 2D operator using Kronecker products for a (z, x) grid\n        A_xx = kron(Iz, alpha * Dxx_1d)\n        A_zz = kron(Dzz_1d, Ix)\n        \n        A = A_xx + A_zz\n        return csc_matrix(A)\n\n    # --- Main processing loop ---\n    all_results = []\n    for params in test_cases:\n        # Unpack parameters\n        Lx, Lz, wx, wz, z0 = params[\"Lx\"], params[\"Lz\"], params[\"wx\"], params[\"wz\"], params[\"z0\"]\n        f, N, Sg, gamma, epsilon, D = params[\"f\"], params[\"N\"], params[\"Sg\"], params[\"gamma\"], params[\"epsilon\"], params[\"D\"]\n\n        # Grid setup\n        x = np.linspace(-Lx / 2, Lx / 2, Nx)\n        z = np.linspace(0, Lz, Nz)\n        dx = x[1] - x[0]\n        dz = z[1] - z[0]\n        \n        X, Z = np.meshgrid(x, z)\n        \n        # Forcing term\n        S = D * np.exp(-((X / wx)**2) - ((Z - z0) / wz)**2)\n        \n        # RHS vector (flattened interior part of the source term)\n        b = S[1:-1, 1:-1].flatten()\n\n        # Function to solve the system for a given alpha\n        def solve_for_psi(alpha):\n            A = construct_A(alpha, Nx, Nz, dx, dz)\n            psi_interior_vec = linalg.spsolve(A, b)\n            \n            psi = np.zeros((Nz, Nx))\n            psi[1:-1, 1:-1] = psi_interior_vec.reshape((Nz - 2, Nx - 2))\n            return psi\n\n        # Find indices for evaluation point (x=0, z=z0)\n        j0 = (Nx - 1) // 2\n        i0 = np.argmin(np.abs(z - z0))\n\n        # Function to compute derivatives from the psi field\n        def compute_derivatives(psi):\n            ua = (psi[i0 + 1, j0] - psi[i0 - 1, j0]) / (2 * dz)\n            w = -(psi[i0, j0 + 1] - psi[i0, j0 - 1]) / (2 * dx)\n            return ua, w\n\n        # QG Solution\n        N2 = N**2\n        alpha_qg = f**2 / N2\n        psi_qg = solve_for_psi(alpha_qg)\n        ua_qg, w_qg = compute_derivatives(psi_qg)\n        \n        # SG Solution\n        N_eff2 = max(epsilon * N2, N2 - gamma * Sg**2)\n        alpha_sg = f**2 / N_eff2\n        \n        if np.isclose(alpha_sg, alpha_qg):\n            psi_sg = psi_qg\n        else:\n            psi_sg = solve_for_psi(alpha_sg)\n        \n        ua_sg, w_sg = compute_derivatives(psi_sg)\n        \n        # Assemble and round results for the current case\n        case_results = [\n            round(ua_qg, 6), round(w_qg, 6),\n            round(ua_sg, 6), round(w_sg, 6),\n            round(ua_sg - ua_qg, 6), round(w_sg - w_qg, 6)\n        ]\n        all_results.append(case_results)\n\n    # Format and print the final output as a list of lists\n    results_str_list = [str(res) for res in all_results]\n    print(f\"[{','.join(results_str_list)}]\")\n\nsolve()\n```"
        }
    ]
}