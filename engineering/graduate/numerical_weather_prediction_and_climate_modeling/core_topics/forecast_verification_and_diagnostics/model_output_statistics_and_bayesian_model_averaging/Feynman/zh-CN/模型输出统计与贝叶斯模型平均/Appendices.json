{
    "hands_on_practices": [
        {
            "introduction": "一个优秀的概率预报需要使用恰当的评分规则进行评估，该规则需同时考察预报的“锐度”（sharpness，即集中度）和“可靠性”（reliability，即统计一致性）。连续分级概率评分（Continuous Ranked Probability Score, CRPS）是评估温度等连续变量时广泛使用的关键指标。本练习  提供了一个动手实践的机会，您将推导高斯预报的 CRPS 表达式，并用它来量化统计后处理带来的改进，从而揭示偏差校正和离散度调整之间的根本权衡。",
            "id": "4065230",
            "problem": "一个来自数值天气预报（NWP）系统的特定地点的 $2\\,\\mathrm{m}$ 气温预报，通过与一个观测值进行对比验证。原始集合预报被近似为一个高斯预测分布，其均值为 $\\mu_{\\mathrm{r}} = 289\\,\\mathrm{K}$，标准差为 $\\sigma_{\\mathrm{r}} = 2\\,\\mathrm{K}$。一个通过模式输出统计（MOS）方法获得并符合贝叶斯模型平均（BMA）原则的校准预测分布，表示为一个高斯分布，其均值为 $\\mu_{\\mathrm{c}} = 291\\,\\mathrm{K}$，标准差为 $\\sigma_{\\mathrm{c}} = 2.5\\,\\mathrm{K}$。用于验证的观测值为 $y = 291\\,\\mathrm{K}$。\n\n从连续分级概率评分（CRPS）作为预测累积分布函数和观测值泛函的形式化定义出发，推导出一个正态预测分布的CRPS的闭合形式表达式，该表达式应使用标准化误差 $z = (y - \\mu)/\\sigma$、标准正态概率密度函数和标准正态累积分布函数来表示。然后，使用此表达式计算原始集合预报（$\\mu_{\\mathrm{r}}, \\sigma_{\\mathrm{r}}$）和校准后的MOS/BMA分布（$\\mu_{\\mathrm{c}}, \\sigma_{\\mathrm{c}}$）在观测值 $y$ 处的CRPS。\n\n将校准带来的改进定义为 $\\Delta = \\mathrm{CRPS}_{\\mathrm{raw}} - \\mathrm{CRPS}_{\\mathrm{calibrated}}$。计算 $\\Delta$ 并以 $\\mathrm{K}$ 为单位表示您的最终数值答案。将您的最终答案四舍五入到四位有效数字。此外，使用推导出的表达式和科学支持的推理，定性地解释集合预报的校准（偏差校正和离散度调整）如何相对于原始集合预报影响CRPS。",
            "solution": "首先验证问题，以确保其科学上合理、提法恰当且完整。\n\n### 第1步：提取已知条件\n- 验证观测值：$y = 291\\,\\mathrm{K}$\n- 原始集合预测分布：一个高斯分布，均值为 $\\mu_{\\mathrm{r}} = 289\\,\\mathrm{K}$，标准差为 $\\sigma_{\\mathrm{r}} = 2\\,\\mathrm{K}$。\n- 校准后的MOS/BMA预测分布：一个高斯分布，均值为 $\\mu_{\\mathrm{c}} = 291\\,\\mathrm{K}$，标准差为 $\\sigma_{\\mathrm{c}} = 2.5\\,\\mathrm{K}$。\n- 改进的定义：$\\Delta = \\mathrm{CRPS}_{\\mathrm{raw}} - \\mathrm{CRPS}_{\\mathrm{calibrated}}$。\n- 任务1：对于一个正态预测分布 $N(\\mu, \\sigma^2)$ 和一个观测值 $y$，推导连续分级概率评分（CRPS）的闭合形式表达式，用标准化误差 $z = (y - \\mu)/\\sigma$、标准正态概率密度函数 $\\phi(z)$ 和标准正态累积分布函数 $\\Phi(z)$ 表示。\n- 任务2：计算 $\\mathrm{CRPS}_{\\mathrm{raw}}$ 和 $\\mathrm{CRPS}_{\\mathrm{calibrated}}$。\n- 任务3：计算 $\\Delta$，保留四位有效数字。\n- 任务4：定性解释校准如何影响CRPS。\n\n### 第2步：使用提取的已知条件进行验证\n该问题在数值天气预报和预报验证领域有坚实的基础。连续分级概率评分（CRPS）、模式输出统计（MOS）和贝叶斯模型平均（BMA）都是标准且成熟的概念。物理量及其数值（以开尔文为单位的气温、标准差）是符合实际的。问题是自洽的，提供了所有必要的数据和定义。任务陈述清晰，并能导出一个唯一且有意义的解。没有科学或逻辑上的矛盾、歧义或不切实际的假设。\n\n### 第3步：结论和行动\n问题被判定为**有效**。现在开始求解过程。\n\n### 正态分布CRPS的推导\n对于预测累积分布函数（CDF）$F(x)$ 和单个标量观测值 $y$，CRPS可以使用一个计算上更方便的替代形式来定义：\n$$\n\\mathrm{CRPS}(F, y) = E_F[|X - y|] - \\frac{1}{2} E_F[|X - X'|]\n$$\n其中 $X$ 和 $X'$ 是从具有CDF $F$ 的预测分布中抽取的独立随机变量。\n\n在本问题中，预测分布是高斯分布，$X \\sim N(\\mu, \\sigma^2)$。\n\n首先，我们计算第二项，$\\frac{1}{2} E_F[|X - X'|]$。\n令 $Z = X - X'$。由于 $X$ 和 $X'$ 是独立同分布于 $N(\\mu, \\sigma^2)$，它们的差 $Z$ 服从一个正态分布，其均值为 $E[Z] = E[X] - E[X'] = \\mu - \\mu = 0$，方差为 $\\mathrm{Var}(Z) = \\mathrm{Var}(X) + \\mathrm{Var}(X') = \\sigma^2 + \\sigma^2 = 2\\sigma^2$。因此，$Z \\sim N(0, 2\\sigma^2)$。$Z$ 的标准差是 $\\sigma_Z = \\sqrt{2}\\sigma$。\n一个均值为零的正态变量 $Z$ 的绝对值的期望是其平均绝对偏差，由 $\\sigma_Z \\sqrt{2/\\pi}$ 给出。\n$$\nE[|X - X'|] = E[|Z|] = (\\sqrt{2}\\sigma) \\sqrt{\\frac{2}{\\pi}} = \\frac{2\\sigma}{\\sqrt{\\pi}}\n$$\n因此，第二项是：\n$$\n\\frac{1}{2} E[|X - X'|] = \\frac{1}{2} \\left( \\frac{2\\sigma}{\\sqrt{\\pi}} \\right) = \\frac{\\sigma}{\\sqrt{\\pi}}\n$$\n\n接下来，我们计算第一项，$E_F[|X - y|]$。\n令 $W = X - y$。随机变量 $W$ 服从一个正态分布，其均值为 $E[W] = E[X] - y = \\mu - y$，方差为 $\\mathrm{Var}(W) = \\mathrm{Var}(X) = \\sigma^2$。因此，$W \\sim N(\\mu - y, \\sigma^2)$。\n我们需要计算 $E[|W|]$。令 $\\mu_W = \\mu - y$。\n$$\nE[|W|] = \\int_{-\\infty}^{\\infty} |w| \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(w - \\mu_W)^2}{2\\sigma^2}\\right) dw\n$$\n我们进行变量替换，转换到标准正态空间：$u = (w - \\mu_W)/\\sigma$，因此 $w = \\sigma u + \\mu_W$ 且 $dw = \\sigma du$。标准正态PDF为 $\\phi(u) = \\frac{1}{\\sqrt{2\\pi}}\\exp(-u^2/2)$。\n$$\nE[|W|] = \\int_{-\\infty}^{\\infty} |\\sigma u + \\mu_W| \\phi(u) du = \\sigma \\int_{-\\infty}^{\\infty} |u + \\mu_W/\\sigma| \\phi(u) du\n$$\n我们识别出标准化误差 $z = (y - \\mu)/\\sigma$，所以 $\\mu_W/\\sigma = (\\mu-y)/\\sigma = -z$。\n$$\nE[|X - y|] = \\sigma \\int_{-\\infty}^{\\infty} |u - z| \\phi(u) du\n$$\n我们在 $u=z$ 处拆分积分：\n$$\nE[|X - y|] = \\sigma \\left[ \\int_{-\\infty}^{z} (z-u)\\phi(u)du + \\int_{z}^{\\infty} (u-z)\\phi(u)du \\right]\n$$\n$$\n= \\sigma \\left[ z\\int_{-\\infty}^{z}\\phi(u)du - \\int_{-\\infty}^{z}u\\phi(u)du + \\int_{z}^{\\infty}u\\phi(u)du - z\\int_{z}^{\\infty}\\phi(u)du \\right]\n$$\n我们使用标准正态分布的性质：\n- $\\int_{-\\infty}^{z}\\phi(u)du = \\Phi(z)$\n- $\\int_{z}^{\\infty}\\phi(u)du = 1 - \\Phi(z)$\n- $\\int u\\phi(u)du = -\\phi(u)$ (因为 $d\\phi(u)/du = -u\\phi(u)$)，所以 $\\int_{-\\infty}^{z}u\\phi(u)du = [-\\phi(u)]_{-\\infty}^{z} = -\\phi(z)$，且 $\\int_{z}^{\\infty}u\\phi(u)du = [-\\phi(u)]_{z}^{\\infty} = \\phi(z)$。\n\n代入这些结果：\n$$\nE[|X - y|] = \\sigma \\left[ z\\Phi(z) - (-\\phi(z)) + (\\phi(z)) - z(1 - \\Phi(z)) \\right]\n$$\n$$\n= \\sigma \\left[ z\\Phi(z) + \\phi(z) + \\phi(z) - z + z\\Phi(z) \\right]\n$$\n$$\n= \\sigma \\left[ 2z\\Phi(z) - z + 2\\phi(z) \\right] = \\sigma \\left[ z(2\\Phi(z) - 1) + 2\\phi(z) \\right]\n$$\n结合两项，我们得到正态分布CRPS的最终表达式：\n$$\n\\mathrm{CRPS}(N(\\mu, \\sigma^2), y) = \\sigma \\left[ z(2\\Phi(z) - 1) + 2\\phi(z) \\right] - \\frac{\\sigma}{\\sqrt{\\pi}}\n$$\n$$\n\\mathrm{CRPS} = \\sigma \\left( z(2\\Phi(z) - 1) + 2\\phi(z) - \\frac{1}{\\sqrt{\\pi}} \\right)\n$$\n这就是所要求的闭合形式表达式。\n\n### 原始集合与校准集合CRPS的计算\n我们将使用以下常数的数值：\n- $\\Phi(0) = 0.5$\n- $\\phi(0) = 1/\\sqrt{2\\pi} \\approx 0.398942$\n- 对于 $z=1$：$\\Phi(1) \\approx 0.841345$，$\\phi(1) = \\exp(-0.5)/\\sqrt{2\\pi} \\approx 0.241971$\n- $1/\\sqrt{\\pi} \\approx 0.564190$\n\n**1. 原始集合的CRPS（$\\mathrm{CRPS}_{\\mathrm{raw}}$）**\n- 已知：$\\mu_{\\mathrm{r}} = 289\\,\\mathrm{K}$，$\\sigma_{\\mathrm{r}} = 2\\,\\mathrm{K}$，$y = 291\\,\\mathrm{K}$。\n- 标准化误差：$z_{\\mathrm{r}} = (291 - 289)/2 = 1$。\n- $\\mathrm{CRPS}_{\\mathrm{raw}} = \\sigma_{\\mathrm{r}} \\left( z_{\\mathrm{r}}(2\\Phi(z_{\\mathrm{r}}) - 1) + 2\\phi(z_{\\mathrm{r}}) - \\frac{1}{\\sqrt{\\pi}} \\right)$\n- $\\mathrm{CRPS}_{\\mathrm{raw}} = 2 \\left( 1(2\\Phi(1) - 1) + 2\\phi(1) - \\frac{1}{\\sqrt{\\pi}} \\right)$\n- $\\mathrm{CRPS}_{\\mathrm{raw}} \\approx 2 \\left( 1(2 \\times 0.841345 - 1) + 2 \\times 0.241971 - 0.564190 \\right)$\n- $\\mathrm{CRPS}_{\\mathrm{raw}} \\approx 2 \\left( (1.68269 - 1) + 0.483942 - 0.564190 \\right)$\n- $\\mathrm{CRPS}_{\\mathrm{raw}} \\approx 2 \\left( 0.68269 + 0.483942 - 0.564190 \\right) = 2(0.602442) \\approx 1.20488\\,\\mathrm{K}$。\n\n**2. 校准集合的CRPS（$\\mathrm{CRPS}_{\\mathrm{calibrated}}$）**\n- 已知：$\\mu_{\\mathrm{c}} = 291\\,\\mathrm{K}$，$\\sigma_{\\mathrm{c}} = 2.5\\,\\mathrm{K}$，$y = 291\\,\\mathrm{K}$。\n- 标准化误差：$z_{\\mathrm{c}} = (291 - 291)/2.5 = 0$。\n- $\\mathrm{CRPS}_{\\mathrm{calibrated}} = \\sigma_{\\mathrm{c}} \\left( z_{\\mathrm{c}}(2\\Phi(z_{\\mathrm{c}}) - 1) + 2\\phi(z_{\\mathrm{c}}) - \\frac{1}{\\sqrt{\\pi}} \\right)$\n- 当 $z_c = 0$ 时，第一项变为0。\n- $\\mathrm{CRPS}_{\\mathrm{calibrated}} = 2.5 \\left( 2\\phi(0) - \\frac{1}{\\sqrt{\\pi}} \\right)$\n- $\\mathrm{CRPS}_{\\mathrm{calibrated}} \\approx 2.5 \\left( 2 \\times 0.398942 - 0.564190 \\right)$\n- $\\mathrm{CRPS}_{\\mathrm{calibrated}} \\approx 2.5 \\left( 0.797884 - 0.564190 \\right) = 2.5(0.233694) \\approx 0.584235\\,\\mathrm{K}$。\n\n### 改进量（$\\Delta$）的计算\n改进量是由于校准而导致的CRPS减少量。\n$$\n\\Delta = \\mathrm{CRPS}_{\\mathrm{raw}} - \\mathrm{CRPS}_{\\mathrm{calibrated}}\n$$\n$$\n\\Delta \\approx 1.20488\\,\\mathrm{K} - 0.584235\\,\\mathrm{K} \\approx 0.620645\\,\\mathrm{K}\n$$\n四舍五入到四位有效数字，我们得到 $\\Delta \\approx 0.6206\\,\\mathrm{K}$。\n\n### 定性解释\n推导出的公式 $\\mathrm{CRPS} = \\sigma ( z(2\\Phi(z) - 1) + 2\\phi(z) - 1/\\sqrt{\\pi} )$ 揭示了校准的两个主要组成部分——偏差校正和离散度调整——如何影响评分。CRPS是一种固有评分规则，它同时评估概率预报的锐度（集中度）和可靠性（统计一致性）。较低的CRPS表示更好的预报。\n\n1.  **偏差校正（影响 $z$）：** 偏差校正调整预报分布的均值 $\\mu$，使其平均而言更接近观测结果 $y$。这直接减小了标准化误差的绝对值 $|z| = |y-\\mu|/\\sigma$。括号中的项 $g(z) = z(2\\Phi(z) - 1) + 2\\phi(z) - 1/\\sqrt{\\pi}$ 是一个关于 $z$ 的非负函数，在 $z=0$ 处（即当预报均值等于观测值时）有全局最小值。因此，通过使 $\\mu$ 更接近 $y$（从而使 $z$ 更接近0）来减小偏差，总会减小 $g(z)$ 的值，从而导致更低（更好）的CRPS，前提是 $\\sigma$ 保持不变。在本问题中，对于这个特定实例，校准在偏差校正方面是完美的，将 $\\mu$ 从 $289\\,\\mathrm{K}$ 移动到 $291\\,\\mathrm{K}$，恰好与观测值一致。这将 $z$ 从1变为0，显著降低了 $g(z)$ 的值，从而为评分带来了大的改进。\n\n2.  **离散度调整（影响 $\\sigma$）：** 离散度调整修改了预报分布的标准差 $\\sigma$。原始集合预报通常是离散不足的（过于自信），意味着它们的离散度太小，无法准确表示真实的预报不确定性。校准，特别是使用像BMA这样的方法，通常会将离散度增加到一个更可靠的值。改变 $\\sigma$ 对CRPS的影响是双重的：\n    - 表达式前面有一个直接的线性缩放因子 $\\sigma$。增加 $\\sigma$ 会直接增加CRPS，惩罚那些不够锐利的预报。\n    - $z$ 的值也取决于 $\\sigma$。\n    在我们的特定案例中，离散度从 $\\sigma_{\\mathrm{r}} = 2\\,\\mathrm{K}$ 增加到 $\\sigma_{\\mathrm{c}} = 2.5\\,\\mathrm{K}$。对于校准后的情况，$z=0$，所以 $\\mathrm{CRPS}_{\\mathrm{calibrated}} \\propto \\sigma_{\\mathrm{c}}$。离散度从 $2\\,\\mathrm{K}$ 增加到 $2.5\\,\\mathrm{K}$ 的作用是使评分变差。然而，这个惩罚远小于消除偏差（将 $z$ 从1减小到0）带来的巨大收益。净效应是显著的改进（$\\Delta > 0$）。这说明了CRPS评估的基本权衡：校准后的预报锐度较低（$\\sigma$ 更大），但更可靠（无偏差），而在本案例中，可靠性带来的收益远远超过了锐度上的损失。对于确定性预报（$\\sigma \\to 0$），CRPS收敛于绝对误差 $|y-\\mu|$。校准确保了概率预报在出错时会因过于自信而受到惩罚。\n\n总而言之，校准通过纠正原始集合的显著偏差提高了整体预报质量，即使这需要增加预报的离散度。CRPS指标正确地将此识别为净改进。",
            "answer": "$$\\boxed{0.6206}$$"
        },
        {
            "introduction": "在对整个预测分布进行评分之外，评估其可靠性的特定方面也至关重要，例如预测区间的表现。本练习聚焦于这种常见的预报产品，并探讨覆盖概率（coverage probability）这一关键概念。在本练习  中，您将推导出一个在实践中常见的问题——即当预报方差校准不准时，预测区间会如何变得过窄（过于自信）或过宽（信心不足），从而导致其实际覆盖率无法达到其声称的标称水平。",
            "id": "4065264",
            "problem": "在数值天气预报中，使用模式输出统计 (MOS) 进行后处理，旨在校正原始模式输出中的系统性误差，并为给定站点和预报时效下的某个天气量（例如，近地面温度）生成预测分布。MOS 中一个常用且经过充分检验的方法是，假设在给定预报因子（例如，集合平均和离散度）的条件下，验证观测值 $Y$ 服从高斯分布，其均值通过线性回归校正，方差根据历史误差估计。假设给定预报因子时 $Y$ 的 MOS 预测分布为均值为 $\\mu_{\\text{MOS}}$、方差为 $\\sigma_{\\text{MOS}}^{2}$ 的高斯分布，并且预测区间是通过对该预测累积分布函数求逆来构建的。水平为 $1-\\alpha$ 的预期名义双边预测区间使用围绕 MOS 均值的对称分位数。然而，在实践中，即使预测均值是无偏的，由于抽样变异性、模态转换或不完美的离散度-技巧关系，方差估计相对于真实验证分布也可能存在失准。\n\n假设以下科学上现实且自洽的设定：\n- MOS 预测分布为 $Y \\mid \\text{predictors} \\sim \\mathcal{N}\\!\\left(\\mu_{\\text{MOS}},\\,\\sigma_{\\text{MOS}}^{2}\\right)$。\n- 实际验证分布的均值无偏，但存在一个乘性方差失准因子 $\\lambda>0$：$Y \\mid \\text{predictors} \\sim \\mathcal{N}\\!\\left(\\mu_{\\text{MOS}},\\,\\lambda\\,\\sigma_{\\text{MOS}}^{2}\\right)$。\n- 令 $\\Phi$ 表示标准正态分布的累积分布函数，令 $\\Phi^{-1}$ 表示其分位数函数。令 $z_{p}=\\Phi^{-1}(p)$，其中 $p\\in(0,1)$。\n\n任务：\n1. 从预测区间的定义（即预测累积分布函数的逆象）出发，构建由 MOS 预测分布所蕴含的 $Y$ 的名义双边 $(1-\\alpha)$ 预测区间。\n2. 使用覆盖概率的频率主义定义和高斯分布的性质，推导在方差因子为 $\\lambda$ 的真实验证分布下，该名义 $(1-\\alpha)$ 预测区间的实际覆盖概率。\n\n将你的最终答案表示为关于 $\\alpha$ 和 $\\lambda$ 的实际覆盖概率的单个闭式解析表达式。无需进行数值计算。如果在推导过程中引入任何其他函数，请明确定义它们。最终答案必须是单个表达式，且不得包含单位或不等式。",
            "solution": "问题陈述已经过验证，被认为是科学上合理、适定且无矛盾的。任务是当潜在高斯过程的方差失准时，推导名义预测区间的实际覆盖概率。\n\n推导过程按要求分为两部分。\n\n**第一部分：构建名义预测区间**\n\n名义预测区间是基于假设的模式输出统计 (MOS) 预测分布构建的。该分布是给定预报因子条件下，验证观测值 $Y$ 的正态分布：\n$$ Y \\mid \\text{predictors} \\sim \\mathcal{N}\\!\\left(\\mu_{\\text{MOS}},\\,\\sigma_{\\text{MOS}}^{2}\\right) $$\n名义覆盖水平为 $1-\\alpha$ 的双边预测区间由该分布的分位数定义。具体来说，对称区间是使用 $\\frac{\\alpha}{2}$ 和 $1-\\frac{\\alpha}{2}$ 分位数构建的。\n\n令 $F_{\\text{MOS}}$ 为此名义分布的累积分布函数 (CDF)。区间 $[L, U]$ 的构建满足 $F_{\\text{MOS}}(L) = \\frac{\\alpha}{2}$ 和 $F_{\\text{MOS}}(U) = 1 - \\frac{\\alpha}{2}$。为了找到这些分位数，我们根据名义分布对随机变量 $Y$ 进行标准化。令 $Z$ 为一个标准正态随机变量，$Z \\sim \\mathcal{N}(0, 1)$。\n$$ Z = \\frac{Y - \\mu_{\\text{MOS}}}{\\sigma_{\\text{MOS}}} $$\n标准正态分布的分位数用 $z_{p} = \\Phi^{-1}(p)$ 表示，其中 $\\Phi$ 是标准正态分布的 CDF。$Z$ 所需的分位数是 $z_{\\alpha/2}$ 和 $z_{1-\\alpha/2}$。\n名义区间的构建满足：\n$$ P(z_{\\alpha/2} \\le Z \\le z_{1-\\alpha/2}) = 1 - \\alpha $$\n代入 $Z$ 的表达式：\n$$ P\\left(z_{\\alpha/2} \\le \\frac{Y - \\mu_{\\text{MOS}}}{\\sigma_{\\text{MOS}}} \\le z_{1-\\alpha/2}\\right) = 1 - \\alpha $$\n我们可以通过整理不等式来解出 $Y$：\n$$ \\mu_{\\text{MOS}} + \\sigma_{\\text{MOS}}z_{\\alpha/2} \\le Y \\le \\mu_{\\text{MOS}} + \\sigma_{\\text{MOS}}z_{1-\\alpha/2} $$\n因此，名义 $(1-\\alpha)$ 预测区间（记为 $I_{\\text{nom}}$）为：\n$$ I_{\\text{nom}} = [\\mu_{\\text{MOS}} + \\sigma_{\\text{MOS}}z_{\\alpha/2}, \\mu_{\\text{MOS}} + \\sigma_{\\text{MOS}}z_{1-\\alpha/2}] $$\n由于标准正态分布的对称性，我们有 $z_{\\alpha/2} = -z_{1-\\alpha/2}$。该区间可以更紧凑地表示为：\n$$ I_{\\text{nom}} = [\\mu_{\\text{MOS}} - \\sigma_{\\text{MOS}}z_{1-\\alpha/2}, \\mu_{\\text{MOS}} + \\sigma_{\\text{MOS}}z_{1-\\alpha/2}] $$\n\n**第二部分：推导实际覆盖概率**\n\n实际覆盖概率是指从*真实*验证分布中随机抽取一个值落在*名义*预测区间 $I_{\\text{nom}}$ 内的概率。\n真实分布给定为：\n$$ Y \\mid \\text{predictors} \\sim \\mathcal{N}\\!\\left(\\mu_{\\text{MOS}},\\,\\lambda\\,\\sigma_{\\text{MOS}}^{2}\\right) $$\n其中 $\\lambda > 0$ 是乘性方差失准因子。其关键特征是均值仍然是 $\\mu_{\\text{MOS}}$（无偏），但真实方差是 $\\lambda\\sigma_{\\text{MOS}}^2$，因此真实标准差是 $\\sqrt{\\lambda}\\sigma_{\\text{MOS}}$。\n\n我们需要计算概率 $P(Y \\in I_{\\text{nom}})$，其中 $Y$ 服从这个真实分布。\n$$ P_{\\text{actual}} = P(\\mu_{\\text{MOS}} - \\sigma_{\\text{MOS}}z_{1-\\alpha/2} \\le Y \\le \\mu_{\\text{MOS}} + \\sigma_{\\text{MOS}}z_{1-\\alpha/2}) $$\n为了计算这个概率，我们必须使用 $Y$ 的真实均值和真实标准差对其进行标准化。令 $Z'$ 为一个标准正态随机变量，定义为：\n$$ Z' = \\frac{Y - \\mu_{\\text{MOS}}}{\\sqrt{\\lambda}\\sigma_{\\text{MOS}}} \\sim \\mathcal{N}(0, 1) $$\n我们现在将关于 $Y$ 的不等式转换为关于 $Z'$ 的不等式。\n\n首先，从不等式的所有部分减去均值 $\\mu_{\\text{MOS}}$：\n$$ -\\sigma_{\\text{MOS}}z_{1-\\alpha/2} \\le Y - \\mu_{\\text{MOS}} \\le \\sigma_{\\text{MOS}}z_{1-\\alpha/2} $$\n接下来，将所有部分除以真实标准差 $\\sqrt{\\lambda}\\sigma_{\\text{MOS}}$（因为 $\\lambda > 0$ 且 $\\sigma_{\\text{MOS}} > 0$，不等式方向保持不变）：\n$$ \\frac{-\\sigma_{\\text{MOS}}z_{1-\\alpha/2}}{\\sqrt{\\lambda}\\sigma_{\\text{MOS}}} \\le \\frac{Y - \\mu_{\\text{MOS}}}{\\sqrt{\\lambda}\\sigma_{\\text{MOS}}} \\le \\frac{\\sigma_{\\text{MOS}}z_{1-\\alpha/2}}{\\sqrt{\\lambda}\\sigma_{\\text{MOS}}} $$\n简化左右两边的表达式得到：\n$$ -\\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}} \\le Z' \\le \\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}} $$\n实际覆盖概率是标准正态变量 $Z'$ 落在这个新区间内的概率：\n$$ P_{\\text{actual}} = P\\left(-\\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}} \\le Z' \\le \\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}}\\right) $$\n这个概率可以用标准正态 CDF $\\Phi(x)$ 表示：\n$$ P_{\\text{actual}} = \\Phi\\left(\\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}}\\right) - \\Phi\\left(-\\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}}\\right) $$\n利用标准正态 CDF 的对称性质 $\\Phi(-x) = 1 - \\Phi(x)$，我们可以简化此表达式：\n$$ P_{\\text{actual}} = \\Phi\\left(\\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}}\\right) - \\left[1 - \\Phi\\left(\\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}}\\right)\\right] $$\n$$ P_{\\text{actual}} = 2\\Phi\\left(\\frac{z_{1-\\alpha/2}}{\\sqrt{\\lambda}}\\right) - 1 $$\n最后，我们代入定义 $z_{1-\\alpha/2} = \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right)$，得到以 $\\alpha$ 和 $\\lambda$ 表示的实际覆盖概率的最终表达式：\n$$ P_{\\text{actual}} = 2\\Phi\\left(\\frac{\\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right)}{\\sqrt{\\lambda}}\\right) - 1 $$\n这就是所要求的闭式解析表达式。",
            "answer": "$$\n\\boxed{2\\Phi\\left(\\frac{\\Phi^{-1}\\left(1-\\frac{\\alpha}{2}\\right)}{\\sqrt{\\lambda}}\\right) - 1}\n$$"
        },
        {
            "introduction": "将统计模型应用于真实的气象数据时，需要精心设计的实验方案才能获得可靠的样本外性能估计。本练习  探讨了为数值天气预报数据设计有效交叉验证方案这一复杂挑战，因为这类数据表现出强烈的时间相关性和非交换的预报时效特性。您将批判性地分析不同的验证策略，以确定一种能够防止数据泄漏并确保对模型真实预测技巧进行无偏评估的稳健方法。",
            "id": "4065253",
            "problem": "您获得了一份来自全球集合数值天气预报（NWP）系统的历史档案，该档案包含在世界协调时（UTC）00点连续 $T = 730$ 天的每日预报起始数据。每次起始预报为单个站点的2米气温提供 $K = 6$ 个预报时效，$L \\in \\{12, 24, 36, 48, 60, 72\\}$ 小时。对于每个起始日 $i \\in \\{1,\\dots,T\\}$ 和预报时效 $\\ell \\in \\{1,\\dots,K\\}$，您拥有集合平均预报 $x_{i\\ell}$ 和检验观测值 $y_{i\\ell}$。您希望评估一种结合了模式输出统计（MOS）和贝叶斯模型平均（BMA）的后处理方案的样本外性能。具体而言，您将为每个预报时效拟合一个形如 $y_{i\\ell} = \\beta_\\ell x_{i\\ell} + \\epsilon_{i\\ell}$ 的MOS线性校准模型，然后对一组 $J$ 个候选MOS模型应用贝叶斯模型平均（BMA），从而为每个预报时效的 $y_{i\\ell}$ 得出一个校准后的预测分布。\n\n假设以下经过充分检验的事实和条件成立：\n- MOS线性模型是一个公认的基准模型，其点校准采用高斯误差假设下的最小二乘估计。贝叶斯模型平均（BMA）在各模型间使用基于似然的权重，而诸如对数评分和连续分级概率评分（CRPS）等恰当评分规则是评估概率预报的标准方法。\n- 对于每次起始 $i$，跨预报时效的MOS残差向量 $\\epsilon_{i} = (\\epsilon_{i1},\\dots,\\epsilon_{iK})^\\top$ 服从零均值高斯分布，其协方差矩阵的对角元素为 $\\sigma^2$，非对角元素（当 $\\ell \\neq \\ell'$ 时）为 $\\rho \\sigma^2$，其中 $\\rho \\in (0,1)$ 是一个固定值。不同起始的残差在超过一个很小的时间滞后后是不相关的。此外，在进行季节性去趋势后，$\\{(x_{i\\ell}, y_{i\\ell})\\}$ 的联合分布在 $T$ 天内是近似平稳的。\n- 条件分布 $p(y_{i\\ell}\\,|\\,x_{i\\ell})$ 依赖于预报时效 $\\ell$；也就是说，数据在不同预报时效之间是不可交换的。因此，在建模或验证中混合不同预报时效的数据必须有您能够辩护的不变性论证作为理由。\n\n您的任务是，在上述平稳性和相关性结构下，选择一种交叉验证设计及其理由，该设计能为每个预报时效的MOS和BMA提供一个统计上有效、近似无偏的样本外技巧估计。在您的推理中，请从可交换性条件下交叉验证一致性的基本原理出发，然后考虑此NWP情景下的时间相关性和预报时效的不可交换性。特别地，请论证为什么将不同预报时效的数据混合到同一交叉验证折中会因时间相关性而使性能估计失效，并指出在 $\\rho > 0$ 的情况下，这种混合所导致的偏差的预期方向。\n\n哪个选项最能满足这些要求？\n\nA. 针对每个预报时效 $\\ell$，对所有起始进行滚动起始、分块交叉验证：将 $T$ 天划分为 $K_{\\mathrm{CV}}$ 个长度为 $B$ 天的连续验证块；对于块 $b$，仅使用严格在该块之前且至少有 $g$ 天间隔的数据来拟合MOS和BMA模型，以减少残差的时间相关性，所有数据都处于相同的预报时效 $\\ell$；然后，在留出的块上评估恰当评分（例如，对数评分和CRPS），并汇总所有块的结果来估计该预报时效的技巧。这尊重了 $p(y_{i\\ell}\\,|\\,x_{i\\ell})$ 是预报时效特定的事实，并避免了将共享相同起始的训练案例和测试案例放在同一个折中。在折内混合不同预报时效会通过正的跨时效残差相关性 $\\rho$ 将训练参数估计与测试残差耦合起来，这会导致评估的误差指标出现乐观偏差，因为训练时的统计量通过共享的起始部分“看到”了测试时的噪声。\n\nB. 随机打乱所有起始和预报时效的配对 $\\{(x_{i\\ell}, y_{i\\ell})\\}$，然后执行标准的无间隔K折交叉验证，拟合一个在所有预报时效间共享参数的单一MOS和BMA模型，并计算汇总评分。大样本量确保大数定律消除了对序列相关性和不可交换性的担忧，因此混合预报时效不会使估计的技巧产生偏差。\n\nC. 对于每个起始 $i$，将一个预报时效 $\\ell$ 作为测试集留出，并使用来自同一起始 $i$ 的其余预报时效作为训练数据，对所有起始和时效重复此过程。因为目标时间不同，测试案例和训练案例在给定 $i$ 的条件下是条件独立的，所以交叉验证误差是无偏的。汇总所有 $\\ell$ 的评分来估计整体技巧。\n\nD. 使用连续的时间块作为折，但在拟合一个跨 $\\ell$ 共享参数的单一MOS-BMA模型时汇集所有预报时效。通过对留出块中所有 $\\ell$ 的评分取平均来评估恰当评分。由于每个折都是一个干净的时间留出集，汇集不同预报时效不会扭曲每个预报时效的技巧估计，并且一旦整个块被留出，任何起始内部的时间相关性都变得无关紧要。\n\n选择一个选项。",
            "solution": "问题陈述是有效的。它在数值天气预报（NWP）后处理领域提出了一个适定、有科学依据且客观的问题。所提供的数据结构假设，包括平稳性、时间相关性和特定于预报时效的分布，是现实的，并为统计推理构成了连贯的基础。任务是确定一种尊重这种结构以产生样本外预测技巧的无偏估计的交叉验证方案。\n\n标准交叉验证（CV）的基本原则是数据的可交换性。如果一个数据集的联合概率分布对其索引的任何排列都是不变的，那么该数据集就是可交换的。例如，独立同分布（i.i.d.）的数据就满足这个条件。当数据不可交换时，依赖于随机划分的标准CV会产生有偏的泛化误差估计。问题详细描述了两种违反可交换性的情况：\n\n1.  **时间相关性**：陈述“不同起始的残差在超过一个很小的时间滞后后是不相关的”意味着，如果起始日 $i$ 和 $j$ 很接近，数据点 $(x_{i\\ell}, y_{i\\ell})$ 和 $(x_{j\\ell}, y_{j\\ell})$ 是相关的。这是一个经典的时间序列结构。将数据随机划分为训练折和验证折会将相关的数据点同时放入两个集合中，导致信息泄露和乐观偏差（即低估）的误差。处理时间序列的正确程序是采用分块或滚动起始的交叉验证，它保留了时间顺序，使用过去的数据进行训练，未来的数据进行测试。\n\n2.  **预报时效不可交换性**：问题明确指出“条件分布 $p(y_{i\\ell}\\,|\\,x_{i\\ell})$ 依赖于预报时效 $\\ell$”。这意味着数据在不同预报时效之间不是同分布的。预报偏差和方差通常会随着预报时程而变化。因此，将来自不同预报时效的数据汇集起来拟合一个单一模型，就好像它们是从同一分布中抽取的一样，构成了模型设定错误。任务是估计“每个预报时效的”技巧，这进一步要求应为每个预报时效 $\\ell$ 分别拟合和评估模型。\n\n第三个关键细节是起始内部的相关性结构：对于一个固定的起始日 $i$，不同预报时效 $\\ell$ 和 $\\ell'$ 的预报误差 $\\epsilon_{i\\ell}$ 和 $\\epsilon_{i\\ell'}$ 是相关的，其协方差为 $\\text{Cov}(\\epsilon_{i\\ell}, \\epsilon_{i\\ell'}) = \\rho \\sigma^2$，其中 $\\rho > 0$。这种正相关意味着，如果模型在某一天预报的一个预报时效上有较大的正误差，那么它很可能在同一天预报的其他预报时效上也有正误差。任何使用起始 $i$ 的一个预报时效的数据来训练模型，并使用*同一*起始 $i$ 的另一个预报时效的数据来测试它的验证方案，都将遭受严重的数据泄露。训练过程会无意中从测试集的噪声统计信息中学习，导致性能指标出现显著的乐观偏差。\n\n在确立了这些原则之后，我们来评估各个选项。\n\n#### 逐项分析\n\n**A. 针对每个预报时效 $\\ell$，对所有起始进行滚动起始、分块交叉验证：将 $T$ 天划分为 $K_{\\mathrm{CV}}$ 个长度为 $B$ 天的连续验证块；对于块 $b$，仅使用严格在该块之前且至少有 $g$ 天间隔的数据来拟合MOS和BMA模型，以减少残差的时间相关性，所有数据都处于相同的预报时效 $\\ell$；然后，在留出的块上评估恰当评分（例如，对数评分和CRPS），并汇总所有块的结果来估计该预报时效的技巧。这尊重了 $p(y_{i\\ell}\\,|\\,x_{i\\ell})$ 是预报时效特定的事实，并避免了将共享相同起始的训练案例和测试案例放在同一个折中。在折内混合不同预报时效会通过正的跨时效残差相关性 $\\rho$ 将训练参数估计与测试残差耦合起来，这会导致评估的误差指标出现乐观偏差，因为训练时的统计量通过共享的起始部分“看到”了测试时的噪声。**\n\n该选项描述了一种正确且严谨的方法。\n1.  **建模**：它分别处理每个预报时效 $\\ell$（“针对每个预报时效 $\\ell$ ...”），这尊重了所述的跨预报时效的不可交换性，并解决了估计“每个预报时效”技巧的任务。\n2.  **时间相关性**：它采用了带有“$g$ 天间隔”的“滚动起始、分块交叉验证”，这是处理时间序列预测中时间相关性的最新方法，确保测试集总是相对于训练集处于未来，并且有足够的分隔以减轻相关性。\n3.  **起始内相关性**：由于设计上为每个预报时效 $\\ell$ 仅使用该时效的数据建立一个单独的模型，因此不可能将数据点 $(x_{i\\ell}, y_{i\\ell})$ 用于训练，而将 $(x_{i\\ell'}, y_{i\\ell'})$ 用于测试。它正确地避免了这种形式的数据泄露。\n4.  **理由**：所提供的推理是合理的。它正确地指出，由于正相关 $\\rho > 0$，混合预报时效会导致数据泄露，并正确地推断出这种泄露将导致乐观偏差（低估真实误差）。\n整个描述在统计上是稳健的，并处理了问题的所有复杂性。\n\n**结论：正确。**\n\n**B. 随机打乱所有起始和预报时效的配对 $\\{(x_{i\\ell}, y_{i\\ell})\\}$，然后执行标准的无间隔K折交叉验证，拟合一个在所有预报时效间共享参数的单一MOS和BMA模型，并计算汇总评分。大样本量确保大数定律消除了对序列相关性和不可交换性的担忧，因此混合预报时效不会使估计的技巧产生偏差。**\n\n这个选项存在根本性缺陷。\n1.  **违反可交换性**：它完全忽略了时间相关性和预报时效的不可交换性。随机打乱破坏了时间序列结构，保证了相关的数据点会同时出现在训练集和测试集中。\n2.  **模型设定错误**：它跨所有预报时效拟合单一模型，这与数据生成过程依赖于 $\\ell$ 的已知事实相矛盾。\n3.  **错误的理由**：诉诸“大数定律”是对统计理论的严重误解。大数定律并不能消除数据相关性对估计量偏差的影响；它只描述了样本均值的收敛性。由无效的CV程序引起的偏差问题依然存在，无论样本大小如何。\n\n**结论：不正确。**\n\n**C. 对于每个起始 $i$，将一个预报时效 $\\ell$ 作为测试集留出，并使用来自同一起始 $i$ 的其余预报时效作为训练数据，对所有起始和时效重复此过程。因为目标时间不同，测试案例和训练案例在给定 $i$ 的条件下是条件独立的，所以交叉验证误差是无偏的。汇总所有 $\\ell$ 的评分来估计整体技巧。**\n\n这个选项提出的程序直接掉入了起始内相关性的陷阱。\n1.  **数据泄露**：它明确地使用来自起始 $i$ 的数据（例如，在 $\\{12, 24, 48, 60, 72\\}$ 小时等预报时效）进行训练，并使用来自*同一*起始 $i$ 的不同预报时效的数据（例如，在 $36$ 小时）进行测试。鉴于 $\\text{Cov}(\\epsilon_{i\\ell}, \\epsilon_{i\\ell'}) = \\rho \\sigma^2 > 0$，训练集和测试集在统计上是相关的。这是一种严重的数据泄露形式。\n2.  **错误的理由**：关于条件独立性的说法是错误的。对于给定的 $i$，误差项 $\\epsilon_{i\\ell}$ 是相关的，因此观测值 $y_{i\\ell}$ 不是条件独立的。这个程序将导致巨大的乐观偏差。\n\n**结论：不正确。**\n\n**D. 使用连续的时间块作为折，但在拟合一个跨 $\\ell$ 共享参数的单一MOS-BMA模型时汇集所有预报时效。通过对留出块中所有 $\\ell$ 的评分取平均来评估恰当评分。由于每个折都是一个干净的时间留出集，汇集不同预报时效不会扭曲每个预报时效的技巧估计，并且一旦整个块被留出，任何起始内部的时间相关性都变得无关紧要。**\n\n这个选项正确处理了一个问题，但在另一个问题上失败了。\n1.  **时间相关性**：它正确地使用“连续的时间块作为折”，这尊重了起始数据的时间序列性质。\n2.  **模型设定错误**：它错误地“在拟合一个单一……模型时汇集所有预报时效”。这是一种模型设定错误，因为已知关系 $p(y_{i\\ell}\\,|\\,x_{i\\ell})$ 是依赖于预报时效的。由此产生的模型是次优的。\n3.  **未能实现目标**：因为它拟合和评估的是一个单一的汇集模型，所以它无法提供“每个预报时效的”技巧估计，而这是任务的一项要求。它只为一个设定错误模型提供了汇总技巧。声称这“不会扭曲每个预报时效的技巧估计”是错误的；评估的是一个汇集模型，而不是一个特定于预报时效的模型。\n\n**结论：不正确。**\n\n总之，选项A是唯一一个提出了统计上合理的验证框架的选择，该框架正确地处理了NWP输出的复杂相关性结构，并遵循了结构化数据交叉验证的基本原则。它使用适当的标准技术解决了时间相关性、预报时效不可交换性和起始内相关性的问题。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}