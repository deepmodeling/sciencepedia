{
    "hands_on_practices": [
        {
            "introduction": "在任何大气模拟中，首要步骤是选择合适的动力核心。本练习将指导您运用一种基本技巧——标度分析（scaling analysis），来确定何时非静力效应变得至关重要。通过为一个典型的中尺度系统计算关键的无量纲数，您将学会如何定量地论证使用非静力模型的必要性，这是任何大气建模者都应具备的核心技能。",
            "id": "3898947",
            "problem": "考虑一个位于中纬度的干燥、稳定分层的大气层，其深度为 $H$，水平尺度为 $L$。该大气层具有特征水平风速 $U$、科里奥利参数 $f$、Brunt-Väisälä 频率 $N$ 和声速 $c$。从旋转、可压缩的 Navier-Stokes 方程和 Brunt-Väisälä 频率的定义出发，进行第一性原理尺度分析，以识别并定义三个无量纲群，用于量化旋转、分层和可压缩性的相对重要性。使用这些群，为参数集 $U=15\\,\\mathrm{m\\,s^{-1}}$、$L=20\\,\\mathrm{km}$、$H=5\\,\\mathrm{km}$、$f=10^{-4}\\,\\mathrm{s^{-1}}$、$N=0.01\\,\\mathrm{s^{-1}}$ 和 $c=320\\,\\mathrm{m\\,s^{-1}}$ 计算它们的值。将每个无量纲值四舍五入至三位有效数字。根据您找到的量级，论证保留非静力动力学是否必要，以及无声波（sound-proof）公式（例如，滞弹性或伪不可压缩）是否适用于此流态。您的最终答案必须仅包含这三个无量纲值，按旋转、分层和可压缩性的顺序排列，并表示为单个行向量。无量纲值没有单位；最终答案中不要包含任何单位。",
            "solution": "问题陈述已经过验证，被确定为地球物理流体动力学中一个适定且有科学依据的问题。所有必要的参数都已提供，并且其数值对于中尺度大气现象是物理上现实的。\n\n任务是对大气运动的控制方程进行尺度分析，以推导出表征流态的三个关键无量纲参数。这些参数量化了旋转、分层和可压缩性的相对重要性。\n\n旋转、可压缩流体的基本方程是 Navier-Stokes 方程。为进行尺度分析，我们可以考虑应用于干燥大气的无粘性形式（欧拉方程）。相关方程包括动量方程、连续性方程和热力学方程。\n\n设流动的特征尺度为：\n- 水平速度：$U$\n- 垂直速度：$W$\n- 水平长度：$L$\n- 垂直长度：$H$\n- 时间：$T \\sim L/U$（平流时间尺度）\n- 相对于静力平衡基态的压力扰动：$P$\n- 相对于基态的密度扰动：$R$\n\n分析过程通过对控制方程进行无量纲化并检验各项的比率来进行。\n\n**1. 旋转：罗斯贝数 ($Ro$)**\n\n水平动量方程为：\n$$ \\frac{D\\mathbf{u}_h}{Dt} = -f \\mathbf{k} \\times \\mathbf{u}_h - \\frac{1}{\\rho}\\nabla_h p $$\n此处，$\\mathbf{u}_h$ 是水平速度矢量，$f$ 是科里奥利参数，$\\mathbf{k}$ 是垂直单位矢量，$\\rho$ 是密度，$p$ 是压力。物质导数为 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$。\n\n控制大尺度水平动力学的两个主要项是惯性加速度（平流）和科里奥利力。\n- 惯性加速度的尺度：$|\\mathbf{u}_h \\cdot \\nabla_h \\mathbf{u}_h| \\sim \\frac{U^2}{L}$\n- 科里奥利力的尺度：$|f \\mathbf{k} \\times \\mathbf{u}_h| \\sim fU$\n\n惯性项与科里奥利项之比定义了罗斯贝数，$Ro$：\n$$ Ro = \\frac{\\text{Inertial Force}}{\\text{Coriolis Force}} \\sim \\frac{U^2/L}{fU} = \\frac{U}{fL} $$\n罗斯贝数量化了旋转的重要性。当 $Ro \\ll 1$ 时，流动处于地转平衡状态，由旋转主导。当 $Ro \\gtrsim 1$ 时，惯性效应显著，流动为非地转的。\n\n**2. 分层：内部弗劳德数 ($Fr$)**\n\n分层指的是流体的垂直密度梯度，它会产生浮力。Brunt-Väisälä 频率 $N$ 是流体质块在稳定分层中垂直振荡的自然频率。其平方定义为 $N^2 = \\frac{g}{\\theta_0} \\frac{d\\theta_0}{dz}$，其中 $g$ 是重力加速度，$\\theta_0$ 是背景位温。\n\n内部弗劳德数 $Fr$ 比较了流动的动能与克服稳定分层所需的势能。它可以看作是特征流速 $U$ 与长内重力波的特征速度 $c_g \\sim NH$ 之比。\n$$ Fr = \\frac{U}{NH} $$\n当 $Fr \\ll 1$ 时，流动没有足够的动能来抵抗强分层进行垂直运动，因此被限制在准水平方向上运动。当 $Fr \\gtrsim 1$ 时，流动可以克服浮力屏障，并可能发生显著的垂直运动。\n\n**3. 可压缩性：马赫数 ($Ma$)**\n\n可压缩性效应与流体密度响应压力变化而发生的变化有关。这些效应与声波的传播紧密相连。量化可压缩性重要性的参数是马赫数 $Ma$，定义为特征流速 $U$ 与声速 $c$ 的比值。\n$$ Ma = \\frac{U}{c} $$\n其推导源于完整的连续性方程 $\\frac{1}{\\rho}\\frac{D\\rho}{Dt} + \\nabla \\cdot \\mathbf{u} = 0$，其中 $\\frac{1}{\\rho}\\frac{D\\rho}{Dt}$ 可以通过声速与压力变化相关联，即 $\\frac{1}{\\rho}\\frac{D\\rho}{Dt} = \\frac{1}{\\rho c^2}\\frac{Dp}{Dt}$。尺度分析表明，这个可压缩性项与散度项 $\\nabla \\cdot \\mathbf{u}$ 的比率量级为 $Ma^2 = (U/c)^2$。当 $Ma \\ll 1$ 时，由压力变化引起的密度变化在动力学上可以忽略不计，流动可以近似为声学不可压缩的（例如，使用滞弹性模型）。\n\n**无量纲值的计算**\n\n给定的参数值为：\n- $U = 15\\,\\mathrm{m\\,s^{-1}}$\n- $L = 20\\,\\mathrm{km} = 2 \\times 10^4\\,\\mathrm{m}$\n- $H = 5\\,\\mathrm{km} = 5 \\times 10^3\\,\\mathrm{m}$\n- $f = 10^{-4}\\,\\mathrm{s^{-1}}$\n- $N = 0.01\\,\\mathrm{s^{-1}}$\n- $c = 320\\,\\mathrm{m\\,s^{-1}}$\n\n三个无量纲群的计算如下：\n\n- **罗斯贝数 ($Ro$)**\n$$ Ro = \\frac{U}{fL} = \\frac{15}{ (10^{-4}) \\times (2 \\times 10^4) } = \\frac{15}{2} = 7.5 $$\n四舍五入至三位有效数字，$Ro = 7.50$。\n\n- **内部弗劳德数 ($Fr$)**\n$$ Fr = \\frac{U}{NH} = \\frac{15}{ (0.01) \\times (5 \\times 10^3) } = \\frac{15}{50} = 0.3 $$\n四舍五入至三位有效数字，$Fr = 0.300$。\n\n- **马赫数 ($Ma$)**\n$$ Ma = \\frac{U}{c} = \\frac{15}{320} = 0.046875 $$\n四舍五入至三位有效数字，$Ma = 0.0469$。\n\n**模型选择的论证**\n\n基于计算出的值：\n\n- **非静力动力学：** 当垂直加速度与垂直气压梯度力和浮力相比可以忽略不计时，静力平衡近似是有效的。评估这一点的一个常用标准是几何纵横比 $\\delta = H/L$。对于给定参数，$\\delta = \\frac{5\\,\\mathrm{km}}{20\\,\\mathrm{km}} = 0.25$。由于 $\\delta$ 并不远小于1，预计垂直加速度将是显著的。另一个指标是静止内重力波的水平波长，$\\lambda_x = 2\\pi U/N = 2\\pi (15)/(0.01) \\approx 9425\\,\\mathrm{m} = 9.4\\,\\mathrm{km}$。这个自然响应波长与给定的水平尺度 $L=20\\,\\mathrm{km}$ 处于同一量级，这表明所产生的流动结构将具有一个不小的纵横比，从而违反了静力平衡假设。因此，**保留非静力动力学是必要的**。\n\n- **无声波公式：** 马赫数 $Ma \\approx 0.0469$。由于 $Ma \\ll 1$（通常标准为 $Ma  0.3$），该流动完全处于低马赫数范畴。这意味着声波对于所关注的现象在动力学上不重要，并且其传播速度远快于平流过程。使用完全可压缩模型在计算上是不可行的，因为时间步长会受到声波的 Courant-Friedrichs-Lewy (CFL) 条件的严格限制。一个无声波模型，如滞弹性或伪不可压缩公式，可以滤除这些声学模态，同时保留与惯性、旋转和浮力相关的基本动力学。因此，**无声波公式是合适的**，并且对于此流态非常有利。\n\n最终答案由三个计算出的无量纲值组成。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n7.50  0.300  0.0469\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "当我们确定需要一个非静力模型后，便会面临其数值实现的挑战，尤其是在复杂地形上。本练习揭示了地形追随坐标系中的一个典型陷阱：气压梯度力（pressure gradient force）的伪计算问题。您将亲自推导这个数值误差，并探索现代模型中为确保精度而采用的“精确平衡”（well-balanced）原理，即使是在陡峭山脉上的静止大气中也能保持准确。",
            "id": "4068851",
            "problem": "考虑一个在陡峭地形上处于静止静力平衡状态的二维、干燥、可压缩、非静力大气。静止状态满足静力平衡方程 $ \\frac{\\partial p}{\\partial z} = - \\rho g $，其中 $p$ 是气压，$\\rho$ 是密度，$z$ 是几何高度，$g$ 是重力加速度。地形高度由 $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $ 给出，其中 $z_{0}$、振幅 $A$ 和水平波长 $L$ 是常数。垂直坐标是地形跟随 sigma 坐标 $ \\sigma \\in [0,1] $，其映射关系为\n$$\nz(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H,\n$$\n其中 $H$ 是一个恒定的模式顶高度。在 sigma 坐标模式中，对水平气压梯度力进行朴素的实现时，水平气压梯度在固定的 $ \\sigma $ （而不是固定的几何高度 $z$）上进行离散化，因此在静止静力平衡状态下的残余水平加速度变为 $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $。\n\n从上述静力平衡和 sigma 坐标映射出发，推导出一个用 $ g $、$ \\sigma $ 和地形坡度 $ \\frac{d z_{s}}{d x} $ 表示的 $ a_{\\text{naive}} $ 的闭式表达式。然后，使用参数值 $ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $、$ H = 12{,}000 \\ \\mathrm{m} $、$ z_{0} = 1{,}500 \\ \\mathrm{m} $、$ A = 1{,}000 \\ \\mathrm{m} $ 和 $ L = 30{,}000 \\ \\mathrm{m} $，计算在 $ x = 0 $ 和 $ \\sigma = 0.25 $ 处的 $ a_{\\text{naive}} $。最后，使用第一性原理，解释一个强制在固定几何高度 $z$ 上计算水平气压梯度（或等效地，添加适当的度量修正）的良好平衡修正是如何减小静止静力平衡状态下的残余加速度的。\n\n将您的 $ a_{\\text{naive}} $ 数值结果四舍五入到四位有效数字。最终加速度以 $ \\mathrm{m\\,s^{-2}} $ 为单位表示。您的最终答案必须是一个单个实数。",
            "solution": "该问题要求推导和计算在地形跟随坐标系中，当气压梯度力被朴素地计算时所产生的虚假水平加速度。它还要求解释在一个良好平衡的数值格式中如何修正这个误差。\n\n首先，我们验证问题的有效性。该设置是大气数值模拟中的一个经典教科书案例，特别是关于 sigma 坐标系中的气压梯度力误差。所有给出的物理原理、方程和参数都是标准的、一致的且科学上合理的。该问题是适定的，并包含了获得唯一解所需的所有信息。因此，该问题是有效的。\n\n核心任务是推导朴素水平加速度的表达式，其定义为 $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $。项 $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ 表示气压 $p$ 相对于水平坐标 $x$ 的偏导数，同时保持 sigma 坐标 $\\sigma$ 不变。\n\n为了将其与物理量联系起来，我们必须将导数从 $ (x, \\sigma) $ 坐标系转换到物理 $ (x, z) $ 坐标系。物理上，气压 $p$ 是 $x$ 和 $z$ 的函数，即 $ p(x, z) $。在 sigma 坐标系中，垂直坐标 $z$ 本身是 $x$ 和 $\\sigma$ 的函数，所以我们有 $ p(x, z(x, \\sigma)) $。使用多元函数的链式法则，我们可以将 $p$ 在 $\\sigma$ 恒定时对 $x$ 的偏导数表示为：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} + \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\n问题指出大气处于静止的静力平衡状态。在这种状态下，恒定几何高度（$z$）面上不存在气压的水平变化。气压场仅依赖于垂直坐标，$ p = p(z) $。这意味着真实的水平气压梯度为零：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = 0\n$$\n垂直气压梯度由静力平衡方程给出：\n$$\n\\frac{\\partial p}{\\partial z} = - \\rho g\n$$\n我们需要的最后一项是恒定-$\\sigma$ 面的斜率 $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} $。我们通过对给定的坐标变换 $ z(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H $ 关于 $x$ 求导（同时保持 $\\sigma$ 不变）来得到它：\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = \\frac{\\partial}{\\partial x} \\left[ (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H \\right]\n$$\n由于 $\\sigma$ 和 $H$ 相对于此微分是常数，我们得到：\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\n现在我们将这三个分量代回链式法则表达式：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = 0 + (-\\rho g) \\left( (1 - \\sigma) \\frac{d z_{s}}{d x} \\right) = - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\n最后，我们将此结果代入 $ a_{\\text{naive}} $ 的定义中：\n$$\na_{\\text{naive}} = - \\frac{1}{\\rho} \\left[ - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x} \\right] = g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\n这就是所需的虚假加速度的闭式表达式。\n\n接下来，我们使用给定的参数在 $ x = 0 $ 和 $ \\sigma = 0.25 $ 处计算这个表达式的值。地形高度为 $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $。首先，我们计算地形坡度 $ \\frac{d z_{s}}{d x} $：\n$$\n\\frac{d z_{s}}{d x} = \\frac{d}{dx} \\left[ z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) \\right] = A \\cos\\!\\left(\\frac{2\\pi}{L} x\\right) \\cdot \\frac{2\\pi}{L}\n$$\n计算在 $ x = 0 $ 处的坡度：\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi A}{L} \\cos(0) = \\frac{2\\pi A}{L}\n$$\n现在我们代入给定的数值：$ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $、$ A = 1{,}000 \\ \\mathrm{m} $ 和 $ L = 30{,}000 \\ \\mathrm{m} $：\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi (1000)}{30000} = \\frac{2\\pi}{30} = \\frac{\\pi}{15}\n$$\n这是一个无量纲量（坡度）。现在我们可以计算在 $ \\sigma = 0.25 $ 处的 $ a_{\\text{naive}} $：\n$$\na_{\\text{naive}} = g (1 - \\sigma) \\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = (9.81) \\cdot (1 - 0.25) \\cdot \\left(\\frac{\\pi}{15}\\right)\n$$\n$$\na_{\\text{naive}} = (9.81) \\cdot (0.75) \\cdot \\left(\\frac{\\pi}{15}\\right) = (9.81) \\cdot \\frac{3}{4} \\cdot \\frac{\\pi}{15} = \\frac{9.81 \\pi}{20}\n$$\n计算数值：\n$$\na_{\\text{naive}} \\approx 1.54096119 \\dots \\ \\mathrm{m\\,s^{-2}}\n$$\n四舍五入到四位有效数字得到 $ 1.541 \\ \\mathrm{m\\,s^{-2}} $。\n\n最后，我们解释一个良好平衡的修正如何校正这个虚假加速度。\n误差的根本来源在于，朴素计算 $ - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ 并不代表真实的水平气压梯度力。真实的水平加速度由 $ a_x = - \\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $ 给出。在静止静力状态下，$ a_x = 0 $。朴素计算产生非零结果，是因为恒定-$\\sigma$ 面不是水平的，而是跟随地形。在倾斜的地形上沿恒定-$\\sigma$ 面移动会涉及到几何高度 $z$ 的变化，这在静力大气中意味着气压的变化。朴素的公式将这种气压变化错误地解释为水平气压梯度。\n\n一个良好平衡的格式被设计用来正确地计算真实的水平气压梯度 $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $。从我们的链式法则展开式中，我们可以重新整理以求解该项：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\n因此，良好平衡的水平加速度为：\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = - \\frac{1}{\\rho} \\left( \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} \\right)\n$$\n将静力关系 $ \\frac{\\partial p}{\\partial z} = - \\rho g $ 代入修正项中，得到：\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\n这个修正后的公式包含两项：$\\sigma$ 面上的朴素气压梯度和一个解释该面斜率的度量修正项。对于静止状态，我们之前推导出 $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = -\\rho g (1-\\sigma)\\frac{dz_s}{dx} $ 和 $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1-\\sigma)\\frac{dz_s}{dx} $。将这些代入良好平衡的公式中，得到：\n$$\na_x = - \\frac{1}{\\rho} \\left( -\\rho g (1-\\sigma)\\frac{dz_s}{dx} \\right) - g \\left( (1-\\sigma)\\frac{dz_s}{dx} \\right)\n$$\n$$\na_x = g (1-\\sigma)\\frac{dz_s}{dx} - g (1-\\sigma)\\frac{dz_s}{dx} = 0\n$$\n因此，良好平衡的格式正确地计算出静止状态的加速度为零，因为两个大的、相反的项完全抵消了。一个良好平衡的数值模式的本质是以一种一致的方式离散化这两项，以保持这种抵消特性，从而防止在地形上产生虚假流动。",
            "answer": "$$\\boxed{1.541}$$"
        },
        {
            "introduction": "仅仅在理论上理解数值方案是不够的；我们还必须验证代码是否正确地实现了这些方案。这个动手练习将通过一个标准测试案例——暖泡平流（advection of a warm bubble）——来介绍模型验证的关键实践。您将亲手实现一个数值平流方案并进行收敛性分析（convergence analysis），这是一种基本技术，用于确认您的模型精度是否如理论预测那样随着网格分辨率的提高而提高。",
            "id": "4068897",
            "problem": "考虑一个由矩形 $\\Omega = [0,L_x]\\times[0,L_z]$ 表示的二维干空气域，其横向和垂直边界均为周期性边界。在用于数值天气预报（NWP）的非静力大气建模中，上升暖泡测试用于评估模型在给定动力学条件下传输和演变局部温位扰动的能力。为了分离和评估标量输运的离散化精度，我们使用一个人造测试，其中扰动由一个恒定的、无散度的速度场平流。这将输运算子与浮力引起的加速度分离开来，同时为验证目的保留了科学真实性。\n\n从给定速度下的位温输运标量守恒定律开始：\n$$\n\\frac{\\partial \\theta}{\\partial t} + u\\frac{\\partial \\theta}{\\partial x} + w\\frac{\\partial \\theta}{\\partial z} = 0,\n$$\n其中 $\\theta$ 是位温，$u$ 是水平速度，$w$ 是垂直速度。假设初始条件是一个叠加在恒定背景上的高斯暖泡：\n$$\n\\theta(x,z,0) = \\theta_b + A\\exp\\left(-\\frac{(x-x_0)^2 + (z-z_0)^2}{2R^2}\\right),\n$$\n其中 $\\theta_b$ 是背景位温，$A$ 是泡的振幅，$(x_0,z_0)$ 是泡心， $R$ 是泡的半径。在给定的恒定速度下，时刻 $t$ 的精确解是平移得到的\n$$\n\\theta_{\\text{exact}}(x,z,t) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x,t)-x_0\\big)^2 + \\big(\\tilde{z}(z,t)-z_0\\big)^2}{2R^2}\\right),\n$$\n其中周期性位移为 $\\tilde{x}(x,t) = (x - ut)\\bmod L_x$ 和 $\\tilde{z}(z,t) = (z - wt)\\bmod L_z$。\n\n使用 MacCormack 预报-校正方法（对于光滑解，在空间和时间上均为二阶精度）在具有 $N_x$ 个 $x$ 方向格点和 $N_z$ 个 $z$ 方向格点的均匀网格上离散化标量输运方程。令 $\\Delta x = L_x/N_x$，$\\Delta z = L_z/N_z$，并选择满足 Courant–Friedrichs–Lewy (CFL) 条件的时间步长 $\\Delta t$：\n$$\n\\Delta t = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right),\n$$\n并进行调整以确保恰好达到最终时间。在周期性网格上，MacCormack 格式通过以下方式将 $\\theta^n$推进到 $\\theta^{n+1}$：\n预报步：\n$$\n\\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right),\n$$\n校正步：\n$$\n\\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right],\n$$\n其中索引是周期性回绕的（例如，当 $i=N_x-1$ 时，$i+1$ 映射到 $0$，$z$ 方向同理）。\n\n为了在最终时间 $T$ 进行比较，定义具有科学意义的误差范数，这些范数是在 $\\Omega$ 上空间平均的积分范数，因此单位均为开尔文：\n- 归一化的 $L^1$ 范数：\n$$\n\\|e\\|_{L^1} = \\frac{1}{L_x L_z} \\int_\\Omega |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)| \\, dx\\, dz.\n$$\n- 归一化的 $L^2$ 范数：\n$$\n\\|e\\|_{L^2} = \\sqrt{\\frac{1}{L_x L_z} \\int_\\Omega \\left(\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)\\right)^2 \\, dx\\, dz }.\n$$\n- $L^\\infty$ 范数：\n$$\n\\|e\\|_{L^\\infty} = \\max_{(x,z)\\in\\Omega} |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)|.\n$$\n使用 $\\Delta x\\Delta z$ 作为单元面积，在离散网格上通过黎曼和来近似这些积分。\n\n使用在连续的网格间距 $h_k = \\max(\\Delta x_k,\\Delta z_k)$ 下的归一化 $L^2$ 误差计算观测到的精度阶 $p$：\n$$\np_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}.\n$$\n\n使用以下科学上一致的参数（单位为国际单位制；SI）：\n- 区域尺寸：$L_x = 1000\\,\\mathrm{m}$, $L_z = 1000\\,\\mathrm{m}$。\n- 恒定速度：$u = 5\\,\\mathrm{m/s}$, $w = 2\\,\\mathrm{m/s}$。\n- 泡参数：背景 $\\theta_b = 300\\,\\mathrm{K}$，振幅 $A = 1\\,\\mathrm{K}$，半径 $R = 100\\,\\mathrm{m}$，中心 $(x_0,z_0)=(200\\,\\mathrm{m},200\\,\\mathrm{m})$。\n- 最终时间：$T = 100\\,\\mathrm{s}$。\n- Courant–Friedrichs–Lewy (CFL) 数：$\\mathrm{CFL}=0.4$（无量纲）。\n- 网格（测试套件）：案例 1 使用 $(N_x,N_z)=(32,32)$，案例 2 使用 $(64,64)$，案例 3 使用 $(128,128)$，案例 4 使用 $(256,256)$。\n\n任务：\n1. 为上述标量输运问题实现带周期性边界的 MacCormack 格式。\n2. 对于测试套件中的每个网格，计算在时间 $T$ 时数值解与精确解之间的归一化 $L^1$、归一化 $L^2$ 和 $L^\\infty$ 误差范数。\n3. 使用归一化的 $L^2$ 误差，计算连续网格分辨率 $(32\\to64)$、$(64\\to128)$ 和 $(128\\to256)$ 之间的观测精度阶 $p$。\n\n答案规格：\n- 所有误差范数均以开尔文为单位表示，并四舍五入到六位小数。\n- 将观测精度阶 $p$ 表示为无量纲浮点数，并四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$$\n[\\|e\\|_{L^2}(32), \\|e\\|_{L^2}(64), \\|e\\|_{L^2}(128), \\|e\\|_{L^2}(256), p_{32\\to64}, p_{64\\to128}, p_{128\\to256}]\n$$\n其中每个 $\\|e\\|_{L^2}(N)$ 是 $N_x=N_z=N$ 网格的归一化 $L^2$ 误差。所有误差单位均为 $\\mathrm{K}$，所有 $p$ 值均为无量纲，且均四舍五入到六位小数。",
            "solution": "该问题被评估为科学上合理、适定、客观且自洽。它描述了标量平流方程的一个标准数值验证测试，这是计算流体动力学和数值天气预报中的一个基本问题。所有参数、方程和数值方法都得到了清晰和正确的定义。该问题是有效的。\n\n求解过程如下：\n首先，我们根据问题陈述建立物理和数值参数。\n区域为 $\\Omega = [0,L_x]\\times[0,L_z]$，其中 $L_x = 1000\\,\\mathrm{m}$ 且 $L_z = 1000\\,\\mathrm{m}$。\n恒定速度场为 $(u, w) = (5\\,\\mathrm{m/s}, 2\\,\\mathrm{m/s})$。\n初始位温扰动是一个高斯泡，定义如下：\n- 背景位温 $\\theta_b = 300\\,\\mathrm{K}$\n- 振幅 $A = 1\\,\\mathrm{K}$\n- 半径 $R = 100\\,\\mathrm{m}$\n- 初始中心 $(x_0, z_0) = (200\\,\\mathrm{m}, 200\\,\\mathrm{m})$\n\n模拟运行至最终时间 $T = 100\\,\\mathrm{s}$。数值格式使用由 Courant–Friedrichs–Lewy (CFL) 数 $\\mathrm{CFL}=0.4$ 确定的时间步长 $\\Delta t$ 进行推进。\n\n对于每个具有网格分辨率 $(N_x, N_z)$ 的测试案例，我们执行以下步骤：\n\n1.  **网格和时间步长离散化**：\n    定义一个均匀网格，在 x 方向有 $N_x$ 个点，在 z 方向有 $N_z$ 个点。网格间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta z = L_z/N_z$。网格点为 $(x_i, z_j) = (i\\Delta x, j\\Delta z)$，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 且 $j \\in \\{0, \\dots, N_z-1\\}$。\n    时间步长 $\\Delta t$ 必须满足 CFL 条件，并确保模拟恰好达到最终时间 $T$。首先，计算一个临时时间步长：\n    $$\n    \\Delta t_{\\text{CFL}} = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right)\n    $$\n    然后，时间步数 $N_t$ 计算为满足 $N_t \\Delta t_{\\text{CFL}} \\ge T$ 的最小整数：\n    $$\n    N_t = \\left\\lceil \\frac{T}{\\Delta t_{\\text{CFL}}} \\right\\rceil\n    $$\n    然后，用于模拟的最终时间步长被调整为：\n    $$\n    \\Delta t = \\frac{T}{N_t}\n    $$\n\n2.  **初始条件**：\n    将连续初始条件离散化到网格上，得到初始场 $\\theta^0_{i,j}$：\n    $$\n    \\theta^0_{i,j} = \\theta(x_i, z_j, 0) = \\theta_b + A\\exp\\left(-\\frac{(x_i-x_0)^2 + (z_j-z_0)^2}{2R^2}\\right)\n    $$\n\n3.  **使用 MacCormack 格式进行时间积分**：\n    解在 $N_t$ 个步长内从时间 $t=0$ 推进到 $t=T$。在每个步长 $n$ 中，从 $\\theta^n$ 到 $\\theta^{n+1}$，应用两步 MacCormack 方法。鉴于使用了周期性边界条件，有限差分所需的空间位移可以通过对数据数组执行循环滚动操作来高效实现。\n\n    **预报步**：此步骤对空间导数使用前向差分。\n    $$\n    \\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right)\n    $$\n    索引按周期性处理，例如，对于 $i=N_x-1$，$i+1$ 变为 $0$。\n\n    **校正步**：此步骤对预报场 $\\hat{\\theta}$ 使用后向差分。\n    $$\n    \\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right]\n    $$\n    同样，索引也按周期性处理。这个两步过程在最终时间 $T$ 得到数值解 $\\theta^{N_t}_{i,j}$。\n\n4.  **精确解计算**：\n    在最终时间 $T$，每个网格点 $(x_i, z_j)$ 上的精确解使用提供的公式计算，该公式考虑了周期性回绕：\n    $$\n    \\theta_{\\text{exact}}(x_i,z_j,T) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x_i,T)-x_0\\big)^2 + \\big(\\tilde{z}(z_j,T)-z_0\\big)^2}{2R^2}\\right)\n    $$\n    其中 $\\tilde{x}(x_i,T) = (x_i - uT)\\bmod L_x$ 且 $\\tilde{z}(z_j,T) = (z_j - wT)\\bmod L_z$。\n\n5.  **误差范数计算**：\n    误差场是数值解与精确解之间的差值：$e_{i,j} = \\theta^{N_t}_{i,j} - \\theta_{\\text{exact}}(x_i,z_j,T)$。指定的范数通过离散求和来近似。\n    - 归一化 $L^1$ 范数：\n    $$\n    \\|e\\|_{L^1} \\approx \\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} |e_{i,j}|\n    $$\n    - 归一化 $L^2$ 范数：\n    $$\n    \\|e\\|_{L^2} \\approx \\sqrt{\\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} e_{i,j}^2}\n    $$\n    - $L^\\infty$ 范数：\n    $$\n    \\|e\\|_{L^\\infty} \\approx \\max_{i,j} |e_{i,j}|\n    $$\n\n6.  **观测精度阶**：\n    在计算了对应于特征网格间距 $h_k$ 和 $h_{k+1}$ 的两个连续网格分辨率的归一化 $L^2$ 误差 $\\|e\\|_{L^2}(h_k)$ 后，观测精度阶 $p$ 按如下方式计算：\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}\n    $$\n    由于网格在每个维度上都加密了 2 倍，即 $N_{k+1}=2N_k$，这意味着 $h_{k+1}=h_k/2$。分母简化为 $\\ln(h_k/h_{k+1}) = \\ln(2)$。\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k) / \\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(2)}\n    $$\n\n对测试套件中的每个网格分辨率：$(32,32)$、$(64,64)$、$(128,128)$ 和 $(256,256)$ 重复此过程。最终输出将包括四个计算出的 $\\|e\\|_{L^2}$ 范数和三个由此得到的观测精度阶 $p$。鉴于 MacCormack 格式对于光滑解是二阶精度的，计算出的 $p$ 值预计将接近 2。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    \n    def run_simulation(N):\n        \"\"\"\n        Runs a single simulation for a given grid resolution N x N.\n\n        Args:\n            N (int): The number of grid points in each dimension (Nx and Nz).\n\n        Returns:\n            tuple: A tuple containing the L1, L2, and L-infinity error norms.\n        \"\"\"\n        # Scientific parameters (SI units)\n        Lx = 1000.0  # m\n        Lz = 1000.0  # m\n        u = 5.0      # m/s\n        w = 2.0      # m/s\n        theta_b = 300.0  # K\n        A = 1.0      # K\n        R = 100.0    # m\n        x0 = 200.0   # m\n        z0 = 200.0   # m\n        T = 100.0    # s\n        CFL = 0.4    # dimensionless\n\n        # Grid and time step discretization\n        Nx, Nz = N, N\n        dx, dz = Lx / Nx, Lz / Nz\n        \n        # Grid coordinates\n        # Using np.arange for grid points [0, L-dx]\n        x = np.arange(Nx) * dx\n        z = np.arange(Nz) * dz\n        # meshgrid with 'xy' indexing (default) creates arrays of shape (Nz, Nx)\n        # xx[j, i] = x[i], zz[j, i] = z[j]\n        xx, zz = np.meshgrid(x, z)\n\n        # Time step calculation\n        if u == 0 and w == 0:\n             # aribtrary time step if velocity is zero, though problem states non-zero\n             dt_cfl = 1.0\n        else:\n            dt_cfl_x = dx / abs(u) if abs(u)  0 else float('inf')\n            dt_cfl_z = dz / abs(w) if abs(w)  0 else float('inf')\n            dt_cfl = CFL * min(dt_cfl_x, dt_cfl_z)\n        \n        num_steps = int(np.ceil(T / dt_cfl))\n        dt = T / num_steps\n\n        # Initial condition\n        theta = theta_b + A * np.exp(-((xx - x0)**2 + (zz - z0)**2) / (2 * R**2))\n\n        # Time integration loop\n        for _ in range(num_steps):\n            theta_n = theta.copy()\n            \n            # Predictor step (forward differences)\n            # axis=1 for x-dir (columns), axis=0 for z-dir (rows)\n            dtheta_dx_fwd = (np.roll(theta_n, -1, axis=1) - theta_n) / dx\n            dtheta_dz_fwd = (np.roll(theta_n, -1, axis=0) - theta_n) / dz\n            hat_theta = theta_n - dt * (u * dtheta_dx_fwd + w * dtheta_dz_fwd)\n\n            # Corrector step (backward differences on hat_theta)\n            dhat_theta_dx_bwd = (hat_theta - np.roll(hat_theta, 1, axis=1)) / dx\n            dhat_theta_dz_bwd = (hat_theta - np.roll(hat_theta, 1, axis=0)) / dz\n            theta = 0.5 * (theta_n + hat_theta - dt * (u * dhat_theta_dx_bwd + w * dhat_theta_dz_bwd))\n\n        # Compute exact solution at time T\n        x_shifted = (xx - u * T) % Lx\n        z_shifted = (zz - w * T) % Lz\n        theta_exact = theta_b + A * np.exp(-((x_shifted - x0)**2 + (z_shifted - z0)**2) / (2 * R**2))\n\n        # Calculate error field and norms\n        error = theta - theta_exact\n        \n        # Normalized L1 norm\n        l1_norm = np.mean(np.abs(error))\n        # Normalized L2 norm\n        l2_norm = np.sqrt(np.mean(error**2))\n        # L-infinity norm\n        linf_norm = np.max(np.abs(error))\n\n        return l1_norm, l2_norm, linf_norm\n\n    # Define the test cases from the problem statement.\n    test_cases_N = [32, 64, 128, 256]\n\n    l2_errors = []\n    for N_val in test_cases_N:\n        _, l2, _ = run_simulation(N_val)\n        l2_errors.append(l2)\n\n    # Compute observed order of accuracy p\n    orders_of_accuracy = []\n    for i in range(len(l2_errors) - 1):\n        # p = log(E_k / E_{k+1}) / log(h_k / h_{k+1})\n        # h_k / h_{k+1} = (L/N_k) / (L/N_{k+1}) = N_{k+1} / N_k = 2\n        p = np.log(l2_errors[i] / l2_errors[i+1]) / np.log(2)\n        orders_of_accuracy.append(p)\n\n    # Assemble final result list as per problem specification\n    final_results = l2_errors + orders_of_accuracy\n\n    # Format and print the final output\n    formatted_results = [f\"{val:.6f}\" for val in final_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}