{
    "hands_on_practices": [
        {
            "introduction": "理解任何数值方法的关键在于分析其在简化问题上的行为。本练习通过对复杂的非线性WENO格式进行线性化，深入探讨其核心机制，并利用冯·诺依曼分析方法研究其对小振幅波的基本色散和耗散特性。这是表征任何数值方法性能的重要第一步，为了解其在更复杂流动中的表现奠定了基础 。",
            "id": "4051122",
            "problem": "考虑一维线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中常数速度 $a > 0$，在间距为 $\\Delta x$ 的均匀网格上，通过守恒型有限体积法求解单元平均值 $\\bar{u}_{j}(t)$，其中 $j \\in \\mathbb{Z}$。其半离散更新形式由下式给出\n$$\n\\frac{d \\bar{u}_{j}}{dt} = -\\frac{1}{\\Delta x}\\left( f_{j+\\frac{1}{2}} - f_{j-\\frac{1}{2}} \\right),\n$$\n其中 $f(u)=a\\,u$ 且使用正向上风格式（即 $f_{j+\\frac{1}{2}} = a\\,u^{-}_{j+\\frac{1}{2}}$，左偏状态 $u^{-}_{j+\\frac{1}{2}}$ 是通过 Jiang–Shu 框架下的五阶加权基本无振荡（WENO）格式从单元平均值重构的）。WENO 重构使用三个三阶候选多项式 $v_{0}$、$v_{1}$、$v_{2}$，它们分别建立在模板 $\\{j-2,j-1,j\\}$、$\\{j-1,j,j+1\\}$ 和 $\\{j,j+1,j+2\\}$ 上。非线性凸组合权 $\\omega_{k}$，$k \\in \\{0,1,2\\}$，定义为\n$$\n\\alpha_{k} = \\frac{d_{k}}{ \\left( \\varepsilon_{s} + \\beta_{k} \\right)^{p} }, \n\\quad\n\\omega_{k} = \\frac{\\alpha_{k}}{\\alpha_{0} + \\alpha_{1} + \\alpha_{2}},\n$$\n其中 $d_{0} = \\frac{1}{10}$、$d_{1} = \\frac{3}{5}$、$d_{2} = \\frac{3}{10}$ 是线性权，$\\varepsilon_{s} > 0$ 是一个小的光滑度参数，$p \\geq 1$，$\\beta_{k}$ 是 Jiang–Shu 光滑度指示子。在 $x_{j+\\frac{1}{2}}$ 处的左偏界面值由 $u^{-}_{j+\\frac{1}{2}} = \\omega_{0} v_{0} + \\omega_{1} v_{1} + \\omega_{2} v_{2}$ 给出。三阶候选界面值由相邻单元平均值 $\\bar{u}_{j+m}$ 构造如下\n$$\nv_{0} = \\frac{1}{3}\\,\\bar{u}_{j-2} - \\frac{7}{6}\\,\\bar{u}_{j-1} + \\frac{11}{6}\\,\\bar{u}_{j}, \n\\quad\nv_{1} = -\\frac{1}{6}\\,\\bar{u}_{j-1} + \\frac{5}{6}\\,\\bar{u}_{j} + \\frac{1}{3}\\,\\bar{u}_{j+1},\n\\quad\nv_{2} = \\frac{1}{3}\\,\\bar{u}_{j} + \\frac{5}{6}\\,\\bar{u}_{j+1} - \\frac{1}{6}\\,\\bar{u}_{j+2}.\n$$\n假设一个关于常数状态的小振幅傅里叶扰动，形式为 $\\bar{u}_{j}(t) = \\bar{u} + \\eta\\,\\exp\\!\\big(i\\,\\theta\\,j\\big)$，其中 $0  \\eta \\ll 1$，相位 $\\theta \\in \\mathbb{R}$ 以弧度表示。围绕常数状态线性化 WENO 权，并执行 von Neumann 傅里叶分析，以获得使用时间步长 $\\Delta t$ 和库朗数 $\\nu = a\\,\\Delta t / \\Delta x$ 的三阶强保稳龙格库塔（SSPRK(3,3)）时间积分器的全离散单步放大因子。\n\n推导由 SSPRK(3,3) 推进的线性化 WENO5 有限体积格式的数值放大因子 $G(\\theta,\\nu)$ 的闭式解析表达式，该表达式用 $\\exp(i\\,\\theta)$ 和有理系数表示。以关于 $\\theta$（以弧度为单位）和 $\\nu$ 的单个解析表达式的形式提供最终答案。最终答案中不应包含任何单位。",
            "solution": "### 第1步：提取已知条件\n-   **方程**：一维线性平流方程，$u_{t} + a\\,u_{x} = 0$，常数速度 $a > 0$。\n-   **离散化**：在间距为 $\\Delta x$ 的均匀网格上采用有限体积法。\n-   **半离散形式**：$\\frac{d \\bar{u}_{j}}{dt} = -\\frac{1}{\\Delta x}\\left( f_{j+\\frac{1}{2}} - f_{j-\\frac{1}{2}} \\right)$，用于单元平均值 $\\bar{u}_{j}$。\n-   **通量函数**：$f(u) = a\\,u$。\n-   **数值通量**：使用正向上风，$f_{j+\\frac{1}{2}} = a\\,u^{-}_{j+\\frac{1}{2}}$。\n-   **重构**：用于左偏状态 $u^{-}_{j+\\frac{1}{2}}$ 的五阶WENO格式（Jiang-Shu）。\n-   **候选多项式**：三个三阶多项式 $v_{0}, v_{1}, v_{2}$，分别位于模板 $S_0 = \\{j-2,j-1,j\\}$、$S_1 = \\{j-1,j,j+1\\}$ 和 $S_2 = \\{j,j+1,j+2\\}$ 上。它们在界面 $x_{j+\\frac{1}{2}}$ 处的显式表达式为：\n    $$v_{0} = \\frac{1}{3}\\,\\bar{u}_{j-2} - \\frac{7}{6}\\,\\bar{u}_{j-1} + \\frac{11}{6}\\,\\bar{u}_{j}$$\n    $$v_{1} = -\\frac{1}{6}\\,\\bar{u}_{j-1} + \\frac{5}{6}\\,\\bar{u}_{j} + \\frac{1}{3}\\,\\bar{u}_{j+1}$$\n    $$v_{2} = \\frac{1}{3}\\,\\bar{u}_{j} + \\frac{5}{6}\\,\\bar{u}_{j+1} - \\frac{1}{6}\\,\\bar{u}_{j+2}$$\n-   **非线性权**：$\\omega_{k} = \\frac{\\alpha_{k}}{\\sum_{l=0}^2 \\alpha_{l}}$，其中 $\\alpha_{k} = \\frac{d_{k}}{ ( \\varepsilon_{s} + \\beta_{k} )^{p} }$。\n-   **权参数**：线性权 $d_{0} = \\frac{1}{10}$，$d_{1} = \\frac{3}{5}$，$d_{2} = \\frac{3}{10}$。光滑度参数 $\\varepsilon_{s} > 0$，指数 $p \\geq 1$。$\\beta_{k}$ 是 Jiang-Shu 光滑度指示子。\n-   **重构值**：$u^{-}_{j+\\frac{1}{2}} = \\omega_{0} v_{0} + \\omega_{1} v_{1} + \\omega_{2} v_{2}$。\n-   **分析设置**：围绕常数状态 $\\bar{u}$ 使用小振幅傅里叶扰动 $\\bar{u}_{j}(t) = \\bar{u} + \\eta\\,\\exp(i\\,\\theta\\,j)$ 进行线性化，其中 $0  \\eta \\ll 1$。\n-   **时间积分**：三阶强保稳龙格库塔（SSPRK(3,3)），时间步长为 $\\Delta t$。\n-   **库朗数**：$\\nu = a\\,\\Delta t / \\Delta x$。\n-   **目标**：推导数值放大因子 $G(\\theta,\\nu)$ 的闭式解析表达式。\n\n### 第2步：使用提取的已知条件进行验证\n该问题是偏微分方程数值方法领域的一个标准练习，特别是针对双曲守恒律。\n-   **科学依据**：该问题基于数值分析的既定原则。WENO5-JS 格式和 SSPRK(3,3) 积分器是广泛使用且有据可查的方法。von Neumann 稳定性分析是分析线性、常系数有限差分/体积格式的标准技术。\n-   **适定的**：问题陈述清晰，并包含执行推导所需的所有必要信息。对闭式放大因子的要求是明确的。存在唯一解。\n-   **客观性**：语言精确，没有主观论断。数值格式的所有组成部分都得到了明确定义。\n-   **完整性**：所有必需的公式、常数和扰动形式都已提供。问题是自洽的。\n-   **一致性**：所提供的信息中没有矛盾之处。这些组件描述了一种功能性和公认的数值方法。\n\n该问题不违反任何无效性标准。它是计算数学中一个有效且适定的问题。\n\n### 第3步：结论与行动\n该问题有效。我将继续进行求解。\n\n### 放大因子的推导\n\n推导过程分为三个主要阶段：\n1.  WENO 格式的线性化。\n2.  线性化半离散空间算子的傅里叶分析。\n3.  SSPRK(3,3) 时间积分器稳定性函数的应用。\n\n**1. WENO 格式的线性化**\n\nvon Neumann 分析是在格式的线性化版本上进行的。我们考虑围绕常数状态 $\\bar{u}$ 的一个小扰动 $\\delta \\bar{u}_j = \\eta\\,\\exp(i\\,\\theta\\,j)$。单元平均值为 $\\bar{u}_j = \\bar{u} + \\delta \\bar{u}_j$。\n\nJiang-Shu 光滑度指示子 $\\beta_k$ 定义为候选多项式缩放导数的平方和。对于常数状态 $\\bar{u}$，所有单元平均值的差都为零，因此对于 $k \\in \\{0,1,2\\}$，$\\beta_k = 0$。对于扰动状态，差值为 $\\eta$ 阶，使得光滑度指示子 $\\beta_k$ 为 $\\eta^2$ 阶。\n\n非线性权由 $\\omega_k = \\frac{\\alpha_k}{\\sum_l \\alpha_l}$ 给出，其中 $\\alpha_k = d_k / (\\varepsilon_s + \\beta_k)^p$。\n对于常数状态，$\\beta_k = 0$，导致 $\\alpha_k = d_k/\\varepsilon_s^p$。权变为 $\\omega_k = \\frac{d_k/\\varepsilon_s^p}{\\sum_l d_l/\\varepsilon_s^p} = \\frac{d_k}{\\sum_l d_l}$。线性权被设计为和为一：$d_0+d_1+d_2 = \\frac{1}{10} + \\frac{6}{10} + \\frac{3}{10} = 1$。因此，对于常数状态，$\\omega_k = d_k$。\n\n当我们线性化该格式时，我们考虑 $\\eta$ 的一阶项。重构为 $u^{-}_{j+1/2} = \\sum_k \\omega_k v_k$。候选多项式 $v_k$ 在 $\\bar{u}_j$ 中是线性的。我们可以写成 $v_k = v_k(\\bar{u}) + v_k(\\delta \\bar{u}) = \\bar{u} + \\delta v_k$。权为 $\\omega_k = d_k + O(\\eta^2)$。\n那么 $u^{-}_{j+1/2} = \\sum_k (d_k + O(\\eta^2))(\\bar{u} + \\delta v_k) = \\bar{u}\\sum_k d_k + \\sum_k d_k \\delta v_k + O(\\eta^2) = \\bar{u} + \\sum_k d_k \\delta v_k + O(\\eta^2)$。\n对于 $\\eta$ 的一阶项，扰动的重构是 $\\delta u^{-}_{j+1/2} = \\sum_k d_k \\delta v_k$。这意味着线性化格式等效于通过直接使用线性权 $d_k$ 获得的底层五阶线性上风格式。\n\n**2. 半离散格式的傅里叶分析**\n\n$u^-_{j+1/2}$ 的线性化重构是 $u^-_{j+1/2} = d_0 v_0 + d_1 v_1 + d_2 v_2$。代入 $v_k$ 和 $d_k$ 的表达式：\n$$\nu^-_{j+1/2} = \\frac{1}{10}\\left(\\frac{1}{3}\\bar{u}_{j-2} - \\frac{7}{6}\\bar{u}_{j-1} + \\frac{11}{6}\\bar{u}_{j}\\right) + \\frac{6}{10}\\left(-\\frac{1}{6}\\bar{u}_{j-1} + \\frac{5}{6}\\bar{u}_{j} + \\frac{1}{3}\\bar{u}_{j+1}\\right) + \\frac{3}{10}\\left(\\frac{1}{3}\\bar{u}_{j} + \\frac{5}{6}\\bar{u}_{j+1} - \\frac{1}{6}\\bar{u}_{j+2}\\right)\n$$\n收集每个 $\\bar{u}_{j+m}$ 的系数：\n$$\nu^-_{j+1/2} = \\left(\\frac{1}{30}\\right)\\bar{u}_{j-2} + \\left(-\\frac{7}{60}-\\frac{6}{60}\\right)\\bar{u}_{j-1} + \\left(\\frac{11}{60}+\\frac{30}{60}+\\frac{6}{60}\\right)\\bar{u}_{j} + \\left(\\frac{12}{60}+\\frac{15}{60}\\right)\\bar{u}_{j+1} + \\left(-\\frac{3}{60}\\right)\\bar{u}_{j+2}\n$$\n$$\nu^-_{j+1/2} = \\frac{1}{60}\\left(2\\bar{u}_{j-2} - 13\\bar{u}_{j-1} + 47\\bar{u}_{j} + 27\\bar{u}_{j+1} - 3\\bar{u}_{j+2}\\right)\n$$\n半离散方程考虑通量差 $f_{j+1/2} - f_{j-1/2} = a(u^-_{j+1/2} - u^-_{j-1/2})$。\n让我们将傅里叶模式 $\\bar{u}_j(t) = \\hat{u}(t)e^{i\\theta j}$ 代入空间算子的表达式中。离散空间算子是 $\\mathcal{L}_h[\\bar{u}]_j = -\\frac{a}{\\Delta x}(u^-_{j+1/2} - u^-_{j-1/2})$。\n重构算子 $u^-_{j+1/2}$ 的傅里叶符号是 $P(\\theta)$：\n$$\nP(\\theta) = \\frac{1}{60}\\left(2e^{-2i\\theta} - 13e^{-i\\theta} + 47 + 27e^{i\\theta} - 3e^{2i\\theta}\\right)\n$$\n通量差算子 $u^-_{j+1/2} - u^-_{j-1/2}$ 的符号是 $P(\\theta) - e^{-i\\theta}P(\\theta) = P(\\theta)(1 - e^{-i\\theta})$。我们用 $S(\\theta)$ 来表示它。\n$S(\\theta) = \\frac{1}{60}\\left(2e^{-2i\\theta} - 13e^{-i\\theta} + 47 + 27e^{i\\theta} - 3e^{2i\\theta}\\right)(1 - e^{-i\\theta})$\n展开此乘积得到：\n$$\nS(\\theta) = \\frac{1}{60}\\left( -2e^{-3i\\theta} + (2 - (-13))e^{-2i\\theta} + (-13-47)e^{-i\\theta} + (47-27) + (27-(-3))e^{i\\theta} - 3e^{2i\\theta} \\right)\n$$\n$$\nS(\\theta) = \\frac{1}{60}\\left(-2e^{-3i\\theta} + 15e^{-2i\\theta} - 60e^{-i\\theta} + 20 + 30e^{i\\theta} - 3e^{2i\\theta}\\right)\n$$\n在傅里叶空间中的半离散方程是 $\\frac{d\\hat{u}}{dt} = -\\frac{a}{\\Delta x} S(\\theta) \\hat{u}$。\n\n**3. SSPRK(3,3) 积分器的应用**\n\n对于常微分方程 $y' = \\mathcal{L}(y)$，SSPRK(3,3) 方法由下式给出：\n$$ u^{(1)} = u^n + \\Delta t \\mathcal{L}(u^n) $$\n$$ u^{(2)} = \\frac{3}{4} u^n + \\frac{1}{4} u^{(1)} + \\frac{1}{4} \\Delta t \\mathcal{L}(u^{(1)}) $$\n$$ u^{n+1} = \\frac{1}{3} u^n + \\frac{2}{3} u^{(2)} + \\frac{2}{3} \\Delta t \\mathcal{L}(u^{(2)}) $$\n对于我们的线性算子，其符号是 $\\hat{\\mathcal{L}}(\\theta) = -\\frac{a}{\\Delta x}S(\\theta)$。令 $w = \\Delta t \\hat{\\mathcal{L}}(\\theta) = -\\frac{a\\Delta t}{\\Delta x} S(\\theta) = -\\nu S(\\theta)$。\n在傅里叶空间中应用该格式，得到放大因子 $G(\\theta, \\nu) = \\hat{u}^{n+1}/\\hat{u}^n$。\n$$ \\hat{u}^{(1)} = (1+w)\\hat{u}^n $$\n$$ \\hat{u}^{(2)} = \\left(\\frac{3}{4} + \\frac{1}{4} (1+w)\\right) + \\frac{1}{4}w (1+w)\\hat{u}^n = \\left(\\frac{3}{4} + \\frac{1}{4} + \\frac{1}{4} w + \\frac{1}{4} w + \\frac{1}{4}w^2 \\right) \\hat{u}^n = \\left(1 + \\frac{1}{2}w + \\frac{1}{4}w^2\\right)\\hat{u}^n $$\n... 稳定性函数推导 ... 放大因子是 RK 方法的稳定性函数 $G(w)$：\n$$ G(w) = 1 + w + \\frac{1}{2}w^2 + \\frac{1}{6}w^3 $$\n最终的放大因子通过代入 $w = -\\nu S(\\theta)$ 获得：\n$$ G(\\theta, \\nu) = 1 - \\nu S(\\theta) + \\frac{1}{2}(-\\nu S(\\theta))^2 + \\frac{1}{6}(-\\nu S(\\theta))^3 $$\n$$ G(\\theta, \\nu) = 1 - \\nu S(\\theta) + \\frac{1}{2}\\nu^2 S(\\theta)^2 - \\frac{1}{6}\\nu^3 S(\\theta)^3 $$\n代入 $S(\\theta)$ 的表达式：\n$$\nS(\\theta) = \\frac{1}{60}\\left(-3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-i\\theta} + 15e^{-2i\\theta} - 2e^{-3i\\theta}\\right)\n$$\n放大因子的完整表达式是：\n$$\nG(\\theta, \\nu) = 1 - \\frac{\\nu}{60}\\left(-3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-i\\theta} + 15e^{-2i\\theta} - 2e^{-3i\\theta}\\right)\n+ \\frac{\\nu^2}{2}\\left(\\frac{1}{60}\\left(-3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-i\\theta} + 15e^{-2i\\theta} - 2e^{-3i\\theta}\\right)\\right)^2\n- \\frac{\\nu^3}{6}\\left(\\frac{1}{60}\\left(-3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-itheta} + 15e^{-2i\\theta} - 2e^{-3i\\theta}\\right)\\right)^3\n$$\n这可以简化为：\n$$\nG(\\theta, \\nu) = 1 - \\frac{\\nu}{60}H(\\theta) + \\frac{\\nu^2}{7200}H(\\theta)^2 - \\frac{\\nu^3}{1296000}H(\\theta)^3\n$$\n其中 $H(\\theta) = -3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-i\\theta} + 15e^{-2i\\theta} - 2e^{-3i\\theta}$。\n这就是放大因子的闭式解析表达式。",
            "answer": "$$\n\\boxed{\n1 - \\frac{\\nu}{60}\\left( -3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-i\\theta} + 15e^{-2i\\theta} - 2e^{-3i\\theta} \\right) + \\frac{\\nu^2}{7200}\\left( -3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-i\\theta} + 15e^{-2i\\theta} - 2e^{-3i\\theta} \\right)^2 - \\frac{\\nu^3}{1296000}\\left( -3e^{2i\\theta} + 30e^{i\\theta} + 20 - 60e^{-i\\theta} + 15e^{-2i\\theta} - 2e^{-3i\\theta} \\right)^3\n}\n$$"
        },
        {
            "introduction": "在高阶有限体积法中，在单元界面处重构出左右状态后，需要一个黎曼求解器来计算数值通量，特别是对于支持激波的欧拉方程组。本实践练习要求您推导并实现两种经典的近似黎曼求解器——HLL和HLLC，并通过与精确解的对比来评估它们分辨接触间断和激波的能力。这将为您提供构建现代有限体积程序核心部件的实践经验 。",
            "id": "4051161",
            "problem": "考虑由欧拉方程的守恒形式（忽略黏性和科里奥利力）控制的一维可压缩大气流动，该流动采用理想气体闭合关系，并有一个引力源项，该源项与单元间通量的处理是分开的。设守恒向量为 $U = [\\rho, \\rho u, E]^\\top$，其中 $\\rho$ 是质量密度（单位 $\\mathrm{kg/m^3}$），$u$ 是速度（单位 $\\mathrm{m/s}$），$E$ 是总能量密度（单位 $\\mathrm{J/m^3}$）。设通量为 $F(U) = [\\rho u, \\rho u^2 + p, u(E + p)]^\\top$，其中压力 $p$ 在理想气体状态方程下通过 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$ 与守恒变量相关，$\\gamma$ 为比热比。在使用加权基本无振荡（WENO）重构的高阶有限体积法中，在单元界面处重构的左、右状态定义了一个局部黎曼问题，其数值通量决定了界面的贡献。两种广泛使用的近似黎曼求解器是 Harten-Lax-van Leer (HLL) 通量和 Harten-Lax-van Leer Contact (HLLC) 通量。\n\n您的任务是从 Rankine–Hugoniot 跳跃条件和欧拉方程黎曼问题解的自相似结构出发，推导 HLL 和 HLLC 单元间数值通量，然后实现这两种通量。推导必须从欧拉方程的守恒形式开始，并使用与物理上允许的状态一致的波速估计。然后，您必须通过将每个求解器预测的界面质量通量与在自相似坐标 $x/t = 0$ 处的精确黎曼解的界面质量通量进行比较，来量化它们在分层大气配置中解析接触间断和激波的能力。\n\n使用以下定义和约束：\n- 基本方程是理想气体的可壓縮欧拉方程，带有引力，但引力源项通过单独的算子分裂处理，不进入单元间通量的推导。因此，对于通量推导和比较，仅使用齐次欧拉方程。\n- 比热比为常数，给定为 $\\gamma = 1.4$。\n- 声速为 $a = \\sqrt{\\gamma p / \\rho}$。\n\n从这些基础出发，推导：\n- Harten-Lax-van Leer (HLL) 通量，假设有两道速度为 $S_L$ 和 $S_R$ 的波，它们界定了一个单一的恒定中间状态，并在每道波上强制执行 Rankine–Hugoniot 跳跃条件，求解单元间通量 $F_{\\mathrm{HLL}}$。\n- Harten-Lax-van Leer Contact (HLLC) 通量，通过扩展 HLL 结构以包含速度为 $S_M$ 的接触波，并在接触面上强制执行一致的压力和法向速度，以获得中间的“星区”状态和通量 $F_{\\mathrm{HLLC}}$。\n\n然后实现一个程序，该程序：\n1. 对于每个测试用例，构建国际单位制（SI）中的左、右原始状态 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，并将其转换为守恒变量。\n2. 使用 Davis 型信号速度估计 $S_L = \\min(u_L - a_L, u_R - a_R)$ 和 $S_R = \\max(u_L + a_L, u_R + a_R)$ 计算界面处的 HLL 通量和 HLLC 通量，其中 $a_L$ 和 $a_R$ 是左、右状态的声速。\n3. 使用理想气体定律和标准的激波/稀疏关系，计算欧拉方程在 $x/t = 0$ 处的精确黎曼解，以获得中间压力 $p^\\star$、速度 $u^\\star$以及左/右星区密度 $\\rho_L^\\star$ 和 $\\rho_R^\\star$。取精确的界面质量通量为 $f_{\\mathrm{exact}} = \\rho^\\star u^\\star$，其中如果 $u^\\star > 0$ 则 $\\rho^\\star = \\rho_L^\\star$，如果 $u^\\star  0$ 则 $\\rho^\\star = \\rho_R^\\star$。如果 $u^\\star = 0$，则取 $\\rho^\\star = (\\rho_L^\\star + \\rho_R^\\star)/2$。\n4. 对于每个求解器（HLL 和 HLLC），报告界面质量通量（通量向量的第一个分量）与精确界面质量通量相比的绝对误差，即 $|f_{\\mathrm{solver}} - f_{\\mathrm{exact}}|$。\n\n使用以下三个大气黎曼问题的测试套件，旨在探测在可变分层下对接触间断和激波的解析能力。所有输入均采用 SI 单位：\n- 情况 $1$（分层大气中的平流接触）：$\\rho_L = 1.2$, $u_L = 50.0$, $p_L = 100000.0$；$\\rho_R = 0.6$, $u_R = 50.0$, $p_R = 100000.0$。\n- 情况 $2$（带有强激波的经典激波管）：$\\rho_L = 1.0$, $u_L = 0.0$, $p_L = 100000.0$；$\\rho_R = 0.125$, $u_R = 0.0$, $p_R = 10000.0$。\n- 情况 $3$（海平面到高层大气的稀疏波）：$\\rho_L = 1.0, u_L = 0.0, p_L = 100000.0$；$\\rho_R = 0.02, u_R = 0.0, p_R = 2000.0$。\n\n对于此问题，速度单位必须是 $\\mathrm{m/s}$，密度单位是 $\\mathrm{kg/m^3}$，压力单位是 $\\mathrm{Pa}$。程序必须为每种情况计算 HLL 和 HLLC 的界面质量通量绝对误差。最终程序输出必须是包含六个浮点数的单行平面列表，对应于：\n$[e_{\\mathrm{HLL},1}, e_{\\mathrm{HLLC},1}, e_{\\mathrm{HLL},2}, e_{\\mathrm{HLLC},2}, e_{\\mathrm{HLL},3}, e_{\\mathrm{HLLC},3}]$，\n其中 $e_{\\mathrm{HLL},i}$ 和 $e_{\\mathrm{HLLC},i}$ 是按上述方法计算的情况 $i$ 的绝对质量通量误差。以标准十进制表示法表示浮点数。程序必须完全自包含，不接受任何输入，并严格按照规定产生一行输出。",
            "solution": "该问题要求推导和实现用于一维可压缩欧拉方程的 Harten-Lax-van Leer (HLL) 和 Harten-Lax-van Leer Contact (HLLC) 近似黎曼求解器。随后，通过比较计算出的界面质量通量，将这些求解器与三个特定测试用例的精确黎曼求解器进行评估。\n\n一维欧拉方程的守恒形式为：\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\n其中 $U$ 是守恒变量向量，$F(U)$ 是通量向量：\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{pmatrix}\n$$\n这里，$\\rho$ 是质量密度，$u$ 是速度，$E$ 是总能量密度。该系统通过理想气体状态方程封闭，该方程将压力 $p$ 与守恒变量联系起来：\n$$\np = (\\gamma - 1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\n其中 $\\gamma$ 是比热比，给定为 $\\gamma = 1.4$。\n\n通过有限体积法求解这些方程涉及到计算两个单元 $i$ 和 $i+1$ 之间界面处的数值通量 $F_{i+1/2}$。这是通过求解具有初始状态 $U_L = U_i$ 和 $U_R = U_{i+1}$ 的黎曼问题来完成的。\n\n**1. Harten-Lax-van Leer (HLL) 通量推导**\n\nHLL 求解器基于黎曼问题解的两波近似。它假设初始状态 $U_L$ 和 $U_R$ 被一个中心的恒定状态 $U_{HLL}$ 分隔，该状态由速度为 $S_L$ 的最快左行波和速度为 $S_R$ 的最快右行波界定。\n\n在由直线 $x=S_L t$，$x=S_R t$，$t=0$ 和 $t=T$ 定义的 $x-t$ 平面上的控制体积上应用守恒律的积分形式 $\\oint (U dx - F dt) = 0$，我们得到：\n$$\n\\int_{S_L T}^{S_R T} U(x,T) dx - \\int_{-\\infty}^{\\infty} U(x,0) dx_{relevant} = \\int_0^T (F(U_L) - F(U_R)) dt\n$$\n考虑到分段常数初始条件和波之间假定的恒定状态 $U_{HLL}$，对于时间间隔 $\\Delta t$ 的方程变为：\n$$\n(S_R \\Delta t - S_L \\Delta t) U_{HLL} - (S_R \\Delta t U_R - S_L \\Delta t U_L) = (F_L - F_R) \\Delta t\n$$\n求解中间状态 $U_{HLL}$ 得：\n$$\nU_{HLL} = \\frac{S_R U_R - S_L U_L - (F_R - F_L)}{S_R - S_L}\n$$\nHLL 数值通量 $F_{HLL}$ 在界面处（$x/t=0$）由该位置的主导状态决定。Rankine-Hugoniot 条件必须在波 $S_L$ 和 $S_R$ 上得到满足。跨越斜率为 $1/S$ 的线的通量是 $F - SU$。为确保一致性，界面通量必须满足跳跃条件。这导致了 HLL 通量的单一表达式，可以通过考虑 $S_L \\le 0 \\le S_R$ 的情况推导出来，此时界面位于平均状态区域内。通量 $F_{HLL}$ 必须满足 $F_{HLL} - F_L = S_L (U_{HLL} - U_L)$ 和 $F_{HLL} - F_R = S_R (U_{HLL} - U_R)$。求解任意一个关于 $F_{HLL}$ 的方程并代入 $U_{HLL}$ 的表达式可得：\n$$\nF_{HLL} = \\frac{S_R F_L - S_L F_R + S_L S_R (U_R - U_L)}{S_R - S_L}\n$$\n如果 $S_L  0$，此公式正确地简化为 $F_L$；如果 $S_R  0$，则简化为 $F_R$，从而涵盖了所有情况。波速 $S_L$ 和 $S_R$ 使用 Davis 公式进行估计：\n$$\nS_L = \\min(u_L - a_L, u_R - a_R), \\quad S_R = \\max(u_L + a_L, u_R + a_R)\n$$\n其中 $a_K = \\sqrt{\\gamma p_K / \\rho_K}$ 对于 $K \\in \\{L, R\\}$。\n\n**2. Harten-Lax-van Leer Contact (HLLC) 通量推导**\n\nHLLC 求解器通过重新引入 HLL 所平均掉的接触间断来改进 HLL 模型。波结构被假定为由三道波组成：最左边的波 ($S_L$)、接触波 ($S_M$) 和最右边的波 ($S_R$)。这将解划分为四个恒定状态：$U_L$、$U_L^*$、$U_R^*$ 和 $U_R$。\n\n在接触波上，压力和速度是连续的：$p_L^* = p_R^* = p^*$ 和 $u_L^* = u_R^* = u^* = S_M$。星区状态 $U_K^*$ ($K \\in \\{L, R\\}$) 通过跨越 $S_L$ 和 $S_R$ 的跳跃条件与外部状态 $U_K$ 相关联。\n$$\nF_K^* - F_K = S_K(U_K^* - U_K) \\implies S_K U_K^* - F_K^* = S_K U_K - F_K\n$$\n将此方程写成分量形式并使用 $u^* = S_M$，我们可以求解星区状态的属性。星区的密度被发现为：\n$$\n\\rho_K^* = \\rho_K \\frac{S_K - u_K}{S_K - S_M}\n$$\n星区的压力 $p^*$ 是从动量方程的跳跃条件推导出来的，这给出了两个必须相等的表达式：\n$$\np^* = p_L + \\rho_L(u_L - S_L)(u_L - S_M) = p_R + \\rho_R(u_R - S_R)(u_R - S_M)\n$$\n这个等式被用来求解接触波速 $S_M$：\n$$\nS_M = \\frac{p_R - p_L + \\rho_L u_L(S_L - u_L) - \\rho_R u_R(S_R - u_R)}{\\rho_L(S_L - u_L) - \\rho_R(S_R - u_R)}\n$$\n已知 $S_M$后，可以计算 $p^*$，并确定星区状态密度 $\\rho_L^*$ 和 $\\rho_R^*$。星区状态的能量密度为 $E_K^* = \\frac{p^*}{\\gamma-1} + \\frac{1}{2}\\rho_K^*(S_M)^2$。这完全定义了状态 $U_L^*$ 和 $U_R^*$。\n\n然后，HLLC 界面通量根据其相对于波的位置来选择：\n$$\nF_{HLLC} =\n\\begin{cases}\n    F_L  \\text{if } S_L  0 \\\\\n    F_L^* = F_L + S_L(U_L^* - U_L)  \\text{if } S_L \\le 0  S_M \\\\\n    F_R^* = F_R + S_R(U_R^* - U_R)  \\text{if } S_M \\le 0 \\le S_R \\\\\n    F_R  \\text{if } S_R  0\n\\end{cases}\n$$\n\n**3. 精确黎曼求解器**\n\n欧拉方程黎曼问题的精确解被用作参考。其结构类似于 HLLC 模型，但外部的波可以是激波或平滑的稀疏扇。该方法的核心是找到星区的压力 $p^*$ 和速度 $u^*$。这些是通过求解非线性代数方程 $g(p) = 0$ 来找到的，其中：\n$$\ng(p) = f_L(p) + f_R(p) + u_L - u_R\n$$\n函数 $f_K(p)$ 取决于波是激波 ($p  p_K$) 还是稀疏波 ($p \\le p_K$)：\n- 激波：$f_K(p) = (p - p_K) \\sqrt{\\frac{A_K}{p + B_K}}$，其中 $A_K = \\frac{2}{(\\gamma+1)\\rho_K}$ 和 $B_K = \\frac{\\gamma-1}{\\gamma+1}p_K$。\n- 稀疏波：$f_K(p) = \\frac{2 a_K}{\\gamma - 1} \\left[ \\left(\\frac{p}{p_K}\\right)^{\\frac{\\gamma-1}{2\\gamma}} - 1 \\right]$。\n\n这个方程使用数值求根算法求解 $p^*$。一旦找到 $p^*$，就计算 $u^*$ 为 $u^* = \\frac{1}{2}(u_L + u_R) + \\frac{1}{2}(f_R(p^*) - f_L(p^*))$。界面 $x/t=0$ 处的状态由 $u^*$ 的符号决定：\n- 如果 $u^* > 0$，状态为 $U_L^*$。\n- 如果 $u^*  0$，状态为 $U_R^*$。\n- 如果 $u^* = 0$，接触间断在界面处静止。\n\n密度 $\\rho_L^*$ 和 $\\rho_R^*$ 基于 $p^*$ 和波的类型（稀疏波用等熵关系，激波用 Rankine-Hugoniot 关系）计算。精确的界面质量通量为 $f_{\\mathrm{exact}} = \\rho^* u^*$，其中如果 $u^* > 0$，$\\rho^* = \\rho_L^*$；如果 $u^*  0$，$\\rho^* = \\rho_R^*$。如果 $u^*=0$，质量通量为 $0$。\n\n**4. 实现与比较**\n\n程序为所提供的测试用例实现了这三个求解器（HLL、HLLC、精确解）。对于每个用例，它计算 $F_{HLL}$、$F_{HLLC}$ 的质量通量分量以及精确通量 $f_{\\mathrm{exact}}$。然后为 HLL 和 HLLC 求解器计算绝对误差 $|f_{\\mathrm{solver}} - f_{\\mathrm{exact}}|$。这些测试用例旨在突出求解器的不同能力：情况1是一个孤立的接触间斷，对此 HLLC 应该是精确的，而 HLL 是耗散的。情况2是一个经典的激波管问题，测试激波和接触间断的解析能力。情况3涉及两个稀疏波，测试在具有大压力和密度梯度但没有激波的情况下的行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It computes the HLL and HLLC flux errors against an exact Riemann solver.\n    \"\"\"\n    gamma = 1.4\n\n    test_cases = [\n        # Case 1: Advected contact\n        # rho_L, u_L, p_L, rho_R, u_R, p_R\n        (1.2, 50.0, 100000.0, 0.6, 50.0, 100000.0),\n        # Case 2: Sod shock tube\n        (1.0, 0.0, 100000.0, 0.125, 0.0, 10000.0),\n        # Case 3: Two-rarefaction problem\n        (1.0, 0.0, 100000.0, 0.02, 0.0, 2000.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        e_hll, e_hllc = compute_flux_errors(case, gamma)\n        results.extend([e_hll, e_hllc])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef prim_to_cons(rho, u, p, gamma):\n    \"\"\"Converts primitive variables to conserved variables.\"\"\"\n    E = p / (gamma - 1.0) + 0.5 * rho * u**2\n    return np.array([rho, rho * u, E])\n\ndef get_flux(rho, u, p, E):\n    \"\"\"Computes the flux vector from primitive and conserved variables.\"\"\"\n    return np.array([rho * u, rho * u**2 + p, u * (E + p)])\n\ndef compute_flux_errors(case, gamma):\n    \"\"\"\n    Computes absolute mass flux errors for HLL and HLLC solvers for a single case.\n    \"\"\"\n    rho_L, u_L, p_L, rho_R, u_R, p_R = case\n\n    # --- Exact Solver ---\n    exact_mass_flux = calc_exact_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n\n    # --- Approximate Solvers ---\n    # Derived quantities and initial state vectors\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n    \n    U_L = prim_to_cons(rho_L, u_L, p_L, gamma)\n    U_R = prim_to_cons(rho_R, u_R, p_R, gamma)\n    \n    F_L = get_flux(rho_L, u_L, p_L, U_L[2])\n    F_R = get_flux(rho_R, u_R, p_R, U_R[2])\n\n    # Davis wave speed estimates\n    S_L = min(u_L - a_L, u_R - a_R)\n    S_R = max(u_L + a_L, u_R + a_R)\n    \n    # --- HLL Flux ---\n    if S_L > 0:\n        F_HLL = F_L\n    elif S_R  0:\n        F_HLL = F_R\n    else:\n        F_HLL = (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / (S_R - S_L)\n    hll_mass_flux = F_HLL[0]\n\n    # --- HLLC Flux ---\n    # Calculate contact wave speed S_M\n    num = p_R - p_L + rho_L * u_L * (S_L - u_L) - rho_R * u_R * (S_R - u_R)\n    den = rho_L * (S_L - u_L) - rho_R * (S_R - u_R)\n    S_M = num / den\n\n    if S_L > 0:\n        F_HLLC = F_L\n    elif S_R  0:\n        F_HLLC = F_R\n    else:\n        if S_M >= 0:\n            p_star = p_L + rho_L * (u_L - S_L) * (u_L - S_M)\n            rho_star_L = rho_L * (S_L - u_L) / (S_L - S_M)\n            E_star_L = p_star / (gamma - 1.0) + 0.5 * rho_star_L * S_M**2\n            U_star_L = np.array([rho_star_L, rho_star_L * S_M, E_star_L])\n            F_HLLC = F_L + S_L * (U_star_L - U_L)\n        else: # S_M  0\n            p_star = p_R + rho_R * (u_R - S_R) * (u_R - S_M)\n            rho_star_R = rho_R * (S_R - u_R) / (S_R - S_M)\n            E_star_R = p_star / (gamma - 1.0) + 0.5 * rho_star_R * S_M**2\n            U_star_R = np.array([rho_star_R, rho_star_R * S_M, E_star_R])\n            F_HLLC = F_R + S_R * (U_star_R - U_R)\n    hllc_mass_flux = F_HLLC[0]\n\n    # Calculate absolute errors\n    e_hll = abs(hll_mass_flux - exact_mass_flux)\n    e_hllc = abs(hllc_mass_flux - exact_mass_flux)\n\n    return e_hll, e_hllc\n\ndef calc_exact_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma):\n    \"\"\"\n    Computes the exact mass flux at the interface x/t=0 for the Euler equations.\n    \"\"\"\n    \n    def pressure_func(p_star, rho_K, p_K, a_K):\n        \"\"\"Pressure function for a single state (left or right).\"\"\"\n        if p_star > p_K:  # Shock\n            A_K = 2.0 / ((gamma + 1.0) * rho_K)\n            B_K = p_K * (gamma - 1.0) / (gamma + 1.0)\n            return (p_star - p_K) * np.sqrt(A_K / (p_star + B_K))\n        else:  # Rarefaction\n            return (2.0 * a_K / (gamma - 1.0)) * ((p_star / p_K)**((gamma - 1.0) / (2.0 * gamma)) - 1.0)\n\n    def root_func(p_star):\n        \"\"\"Function whose root is the star pressure.\"\"\"\n        a_L = np.sqrt(gamma * p_L / rho_L)\n        a_R = np.sqrt(gamma * p_R / rho_R)\n        f_L = pressure_func(p_star, rho_L, p_L, a_L)\n        f_R = pressure_func(p_star, rho_R, p_R, a_R)\n        return f_L + f_R + u_L - u_R\n\n    # Solve for p_star using a bracketing root-finder\n    p_min = 1e-6\n    p_max = max(p_L, p_R) * 10 if max(p_L, p_R) > 1 else max(p_L,p_R)*100\n    if root_func(p_min)*root_func(p_max) > 0: # find better bracket\n         p_max = p_max*100\n         \n    p_star = brentq(root_func, p_min, p_max)\n    \n    # Calculate u_star\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n    f_L = pressure_func(p_star, rho_L, p_L, a_L)\n    f_R = pressure_func(p_star, rho_R, p_R, a_R)\n    u_star = 0.5 * (u_L + u_R) + 0.5 * (f_R - f_L)\n\n    if u_star == 0.0:\n        return 0.0\n\n    if u_star > 0.0:\n        # State at interface is from left state\n        if p_star > p_L:  # Shock\n            rho_star = rho_L * ((p_star / p_L + (gamma - 1.0) / (gamma + 1.0)) /\n                                (((gamma - 1.0) / (gamma + 1.0)) * (p_star / p_L) + 1.0))\n        else:  # Rarefaction\n            rho_star = rho_L * (p_star / p_L)**(1.0 / gamma)\n    else:  # u_star  0.0\n        # State at interface is from right state\n        if p_star > p_R:  # Shock\n            rho_star = rho_R * ((p_star / p_R + (gamma - 1.0) / (gamma + 1.0)) /\n                                (((gamma - 1.0) / (gamma + 1.0)) * (p_star / p_R) + 1.0))\n        else:  # Rarefaction\n            rho_star = rho_R * (p_star / p_R)**(1.0 / gamma)\n            \n    return rho_star * u_star\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "许多现实世界的问题，尤其是在地球物理流体力学中，涉及必须与通量梯度相平衡以维持稳态的源项。本练习旨在解决“良好平衡”（well-balancing）这一关键概念，通过一个模拟静水平衡的浅水模型，来研究高阶时间积分方法（SSP RK）与源项离散化策略的相互作用。掌握如何精确地平衡通量与源项，是确保数值模型在存在地形等外力时保持稳定和准确的关键技能 。",
            "id": "4051119",
            "problem": "考虑一个一维守恒律，它在周期性域 $[0,L]$（其中 $L=1$）上，将重力作用下的静水压力平衡建模为源于浅水方程动量平衡的一个孤立标量子系统：\n$$\n\\frac{\\partial h(x,t)}{\\partial t} + \\frac{\\partial}{\\partial x}\\left( \\tfrac{1}{2} g h(x,t)^2 \\right) = - g \\, h(x,t) \\, \\frac{\\partial b(x)}{\\partial x}.\n$$\n此处，$h(x,t)$ 是水柱高度，$b(x)$ 是底部地形，$g$ 是重力加速度。静水湖泊静止平衡满足 $u(x,t)=0$，并且自由表面高程 $\\eta(x,t) = h(x,t) + b(x)$ 在空间和时间上是恒定的。在此平衡状态下，压力通量的空间导数与重力源项精确抵消，即：\n$$\n\\frac{\\partial}{\\partial x}\\left( \\tfrac{1}{2} g h^2 \\right) + g \\, h \\, \\frac{\\partial b}{\\partial x} = 0\n$$\n当 $\\eta$ 为常数时。\n\n本题要求您为上述标量守恒律实现一种采用加权基本无振荡 (WENO) 重构的高阶有限体积空间离散方法，并结合强稳定性保持龙格-库塔 (SSP RK) 时间积分方法。目标是定量评估 SSP RK 时间步进器的阶行为如何与重力源项的离散化相互作用，并影响静水平衡特性。该特性通过单个时间步后与湖泊静止状态的偏差来衡量。\n\n使用以下具有科学依据且自洽的设置：\n- 周期性域 $[0,1]$，包含 $N$ 个宽度为 $\\Delta x = 1/N$ 的均匀网格。\n- 光滑的底部地形\n$$\nb(x) = A \\sin(2\\pi x) + 0.05 \\cos(4\\pi x),\n$$\n振幅 $A=0.2$。\n- 重力加速度 $g = 9.81$。\n- 静水初始条件 $u(x,0)=0$ 且\n$$\n\\eta(x,0) = H, \\quad h(x,0)=H-b(x),\n$$\n其中 $H=1.0$，确保对所有 $x$ 都有 $h(x,0)  0$。\n\n空间离散要求：\n- 用于网格平均值更新的有限体积形式。使用五阶 WENO-Jiang-Shu 重构来重构 $h$ 的左右界面值。在界面处，使用 Lax-Friedrichs (Rusanov) 通量计算 $f(h)=\\tfrac{1}{2} g h^2$ 的数值通量，其中每个界面的波速为 $a=\\max\\{ |f'(h^-)|, |f'(h^+)| \\} = g \\max\\{h^-, h^+\\}$。通量散度通过界面通量差除以 $\\Delta x$ 来近似。\n- 网格中心的重力源项使用五阶精度周期性中心有限差分格式来近似 $\\partial b/\\partial x$：\n$$\n\\left( \\frac{\\partial b}{\\partial x} \\right)_i \\approx \\frac{1}{60\\,\\Delta x}\\left( b_{i-3} - 9 b_{i-2} + 45 b_{i-1} - 45 b_{i+1} + 9 b_{i+2} - b_{i+3} \\right),\n$$\n使用周期性索引。\n\n时间离散要求：\n- 实现两种强稳定性保持龙格-库塔格式：二阶 SSP RK (两步) 和三阶 SSP RK (三步)。在每种情况下，半离散右端项为\n$$\n\\mathcal{L}(h) = - \\left( \\frac{\\partial}{\\partial x}\\left( \\tfrac{1}{2} g h^2 \\right) \\right) + \\mathcal{S}(h),\n$$\n其中离散源项为\n$$\n\\mathcal{S}(h)_i = - g \\, h_i \\left( \\frac{\\partial b}{\\partial x} \\right)_i.\n$$\n您必须评估两种不同的源项处理策略：\n1. 阶段感知源项 (Stage-aware source)：在每个龙格-库塔阶段，使用当前阶段的状态 $h$ 来计算 $\\mathcal{S}(h)$。\n2. 冻结源项 (Frozen-source)：在每个龙格-库塔阶段，使用时间步开始时的初始状态 $h^n$ 来计算 $\\mathcal{S}(h)$，即 $\\mathcal{S}(h^n)$ 在所有阶段中保持不变。\n\n定量度量：\n- 在单个时间步 $\\Delta t$ 后，计算自由表面高程 $\\eta^{n+1}_i = h^{n+1}_i + b_i$，并使用离散均方根 (RMS) 范数来衡量与静水平衡的偏差：\n$$\nE = \\sqrt{ \\frac{1}{N} \\sum_{i=0}^{N-1} \\left( \\eta^{n+1}_i - H \\right)^2 }.\n$$\n该度量是无量纲的；请以浮点数形式报告。\n\n测试套件：\n- 使用 $N=256$。\n- 考虑以下单步实验，每个实验由一个三元组 $(\\text{格式}, \\text{策略}, \\Delta t)$ 指定：\n    1. $(\\text{SSP RK2}, \\text{阶段感知}, \\Delta t = 1.0\\times 10^{-4})$。\n    2. $(\\text{SSP RK2}, \\text{冻结源项}, \\Delta t = 1.0\\times 10^{-4})$。\n    3. $(\\text{SSP RK3}, \\text{阶段感知}, \\Delta t = 2.0\\times 10^{-4})$。\n    4. $(\\text{SSP RK3}, \\text{冻结源项}, \\Delta t = 2.0\\times 10^{-4})$。\n    5. $(\\text{SSP RK3}, \\text{阶段感知}, \\Delta t = 2.5\\times 10^{-4})$。\n    6. $(\\text{SSP RK3}, \\text{冻结源项}, \\Delta t = 2.5\\times 10^{-4})$。\n\n您的程序应生成单行输出，其中包含按上述顺序列出的六个实验的结果，格式为方括号内的逗号分隔列表。例如：\n\"[E1,E2,E3,E4,E5,E6]\"。\n输出中的所有数值都必须是浮点数。\n\n可使用任何现代语言实现该程序，但最终答案必须是一个完整的、可运行的程序。不允许用户输入；所有参数均已在上面定义。请确保在所述离散化框架内，所有数值步骤都是自洽且科学合理的。评估的重点是基于第一性原理对通量-源项平衡、离散一致性以及龙格-库塔阶段行为对静水平衡特性的影响进行推理。",
            "solution": "所提出的问题要求对一个一维标量守恒律进行数值求解，该守恒律模拟了浅水方程中的静水平衡。主要目标是研究不同的强稳定性保持龙格-库塔 (SSP RK) 时间积分策略对高阶有限体积格式的平衡特性的影响。一个具有良好平衡特性的格式（well-balanced scheme）是指能够在离散层面上精确保持已知稳态解（在此案例中为“湖泊静止”状态）的格式。\n\n控制方程由下式给出：\n$$\n\\frac{\\partial h}{\\partial t} + \\frac{\\partial f(h)}{\\partial x} = S(h,x)\n$$\n其中 $h(x,t)$ 是流体深度，通量为 $f(h) = \\frac{1}{2} g h^2$，由底部地形 $b(x)$ 引起的源项为 $S(h,x) = -g h \\frac{\\partial b}{\\partial x}$。常数 $g$ 是重力加速度。\n\n湖泊静止稳态的特征是自由表面高程恒定，即 $\\eta(x) = h(x) + b(x) = H$，其中 $H$ 是一个常数。在此平衡状态下，通量梯度与源项完美平衡：\n$$\n\\frac{\\partial f(h)}{\\partial x} = \\frac{\\partial}{\\partial x}\\left( \\frac{1}{2} g (H-b(x))^2 \\right) = -g(H-b(x))\\frac{\\partial b}{\\partial x} = -g h \\frac{\\partial b}{\\partial x} = S(h,x)\n$$\n因此，$\\frac{\\partial h}{\\partial t} = 0$，状态是静止的。数值格式可能无法保持这种平衡，从而引入伪振荡。本研究旨在量化这种偏差。\n\n我们采用线方法（method of lines），即首先在空间上进行离散化以获得一个常微分方程组 (ODEs)，然后使用适当的时间积分器求解该方程组。\n\n**空间离散：有限体积法**\n将域 $[0,L]$ 划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀网格 $I_i = [x_{i-1/2}, x_{i+1/2}]$。我们考虑网格平均量 $\\bar{h}_i(t) = \\frac{1}{\\Delta x} \\int_{I_i} h(x,t) dx$。将偏微分方程在网格 $I_i$上积分，得到网格平均值的精确演化方程：\n$$\n\\frac{d\\bar{h}_i}{dt} + \\frac{1}{\\Delta x} \\left( f(h(x_{i+1/2},t)) - f(h(x_{i-1/2},t)) \\right) = \\frac{1}{\\Delta x} \\int_{I_i} S(h,x) dx\n$$\n这可以近似为一个半离散系统：\n$$\n\\frac{d\\bar{h}_i}{dt} = - \\frac{1}{\\Delta x} \\left( \\hat{f}_{i+1/2} - \\hat{f}_{i-1/2} \\right) + \\bar{S}_i = \\mathcal{L}(\\bar{h})_i\n$$\n其中 $\\hat{f}_{i+1/2}$ 是网格界面 $x_{i+1/2}$ 处的数值通量，$\\bar{S}_i$ 是网格平均源项的近似值。\n\n**1. 界面重构：五阶 WENO**\n为了计算数值通量，我们需要每个网格界面左右两侧的 $h$ 值，记为 $h_{i+1/2}^-$ 和 $h_{i+1/2}^+$。这些值是使用五阶精度的加权基本无振荡 (WENO-JS) 重构从网格平均值 $\\bar{h}_i$ 中获得的。该方法在重叠的模板上使用三个候选的三阶多项式重构的凸组合，以在光滑区域达到高精度，同时避免在间断附近的伪振荡。\n\n对于 $h_{i+1/2}^-$ 的左偏重构，我们使用网格平均值的模板 $\\{\\bar{h}_{i-2}, \\bar{h}_{i-1}, \\bar{h}_i, \\bar{h}_{i+1}, \\bar{h}_{i+2}\\}$。重构是在界面处求值的三个三阶多项式插值 $\\hat{h}^{(k)}_{i+1/2}$ 的加权和：\n$$\nh_{i+1/2}^- = \\omega_0 \\hat{h}^{(0)}_{i+1/2} + \\omega_1 \\hat{h}^{(1)}_{i+1/2} + \\omega_2 \\hat{h}^{(2)}_{i+1/2}\n$$\n非线性权重 $\\omega_k$ 取决于光滑度指示子 $\\beta_k$，后者衡量解在每个子模板上的变化。在光滑区域，权重趋近于最优线性权重 $\\{d_0, d_1, d_2\\} = \\{0.1, 0.6, 0.3\\}$，以达到五阶精度。右偏重构 $h_{i+1/2}^+$ 通过使用一个向右平移的对称模板进行类似的计算。\n\n**2. 数值通量：Lax-Friedrichs (Rusanov)**\n数值通量 $\\hat{f}_{i+1/2}$ 使用局部 Lax-Friedrichs（或 Rusanov）通量计算，该方法简单且稳健：\n$$\n\\hat{f}_{i+1/2} = \\frac{1}{2} \\left( f(h_{i+1/2}^-) + f(h_{i+1/2}^+) \\right) - \\frac{a_{i+1/2}}{2} \\left( h_{i+1/2}^+ - h_{i+1/2}^- \\right)\n$$\n局部波速 $a_{i+1/2}$ 是界面处特征速度的一个上界。对于通量 $f(h)=\\frac{1}{2}gh^2$，特征速度为 $f'(h)=gh$。因此，我们使用 $a_{i+1/2} = g \\max(|h_{i+1/2}^-|, |h_{i+1/2}^+|)$。\n\n**3. 源项离散**\n网格平均源项近似为 $\\bar{S}_i \\approx S(\\bar{h}_i, x_i) = -g \\bar{h}_i (\\frac{\\partial b}{\\partial x})_i$。在网格中心 $x_i$ 处的地形导数 $(\\frac{\\partial b}{\\partial x})_i$ 是通过对点值 $b_j = b(x_j)$ 使用指定的五阶精度中心有限差分模板计算的：\n$$\n\\left( \\frac{\\partial b}{\\partial x} \\right)_i \\approx \\frac{1}{60\\,\\Delta x}\\left( b_{i-3} - 9 b_{i-2} + 45 b_{i-1} - 45 b_{i+1} + 9 b_{i+2} - b_{i+3} \\right)\n$$\n对于超出有效范围的索引，应用周期性边界条件。\n\n**时间离散：SSP 龙格-库塔方法**\n半离散系统 $\\frac{d\\bar{h}}{dt} = \\mathcal{L}(\\bar{h})$ 使用 SSP RK 方法进行时间积分，这些方法旨在保持前向欧拉方法的稳定性属性（例如，总变差递减）。我们测试两种格式：SSP RK2 和 SSP RK3。\n\n- **SSP RK2 (Heun 方法，两步，二阶):**\n  $$\n  \\begin{aligned}\n  \\bar{h}^{(1)} = \\bar{h}^n + \\Delta t \\, \\mathcal{L}(\\bar{h}^n) \\\\\n  \\bar{h}^{n+1} = \\frac{1}{2}\\bar{h}^n + \\frac{1}{2}\\left(\\bar{h}^{(1)} + \\Delta t \\, \\mathcal{L}(\\bar{h}^{(1)})\\right)\n  \\end{aligned}\n  $$\n\n- **SSP RK3 (Shu-Osher 方法，三步，三阶):**\n  $$\n  \\begin{aligned}\n  \\bar{h}^{(1)} = \\bar{h}^n + \\Delta t \\, \\mathcal{L}(\\bar{h}^n) \\\\\n  \\bar{h}^{(2)} = \\frac{3}{4}\\bar{h}^n + \\frac{1}{4}\\left(\\bar{h}^{(1)} + \\Delta t \\, \\mathcal{L}(\\bar{h}^{(1)})\\right) \\\\\n  \\bar{h}^{n+1} = \\frac{1}{3}\\bar{h}^n + \\frac{2}{3}\\left(\\bar{h}^{(2)} + \\Delta t \\, \\mathcal{L}(\\bar{h}^{(2)})\\right)\n  \\end{aligned}\n  $$\n\n**源项策略与平衡特性**\n本研究的关键部分是在 RK 阶段内对源项的处理。通量散度的离散形式与源项之间可能无法保持平衡，即，即使对于精确的静水初始数据，也可能有 $-\\frac{1}{\\Delta x}(\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2}) + \\bar{S}_i \\neq 0$。这种不平衡会作为一个扰动，被时间步进格式传播。\n\n我们分析在每个 RK 阶段内计算算子 $\\mathcal{L}(\\bar{h})$ 中源项的两种策略：\n1.  **阶段感知源项 (Stage-aware source)：** $\\mathcal{L}(\\bar{h}^{(\\text{stage})})$ 使用根据当前阶段值计算的源项 $\\bar{S}(\\bar{h}^{(\\text{stage})})$。这是求解一般常微分方程的标准方法。\n2.  **冻结源项 (Frozen-source)：** $\\mathcal{L}(\\bar{h}^{(\\text{stage})})$ 使用从时间步开始时的解 $\\bar{h}^n$ 计算出的源项 $\\bar{S}(\\bar{h}^n)$，并在所有阶段中保持其恒定。这样做的动机是，对于一个真实的稳态，源项不应改变。如果离散算子近似平衡，冻结源项可以防止非物理的中间阶段值破坏源项计算，从而避免加剧不平衡。\n\n**实现与评估**\n该算法使用 Python 实现，并利用 NumPy 进行向量化计算。域的周期性通过 `numpy.roll` 函数高效处理。用于左右界面状态的 WENO-5 重构和用于地形梯度的有限差分都实现为向量化函数。主循环遍历六个指定的测试用例，每个用例由一个 RK 格式、一个源项策略和一个时间步长 $\\Delta t$ 定义。对于每个用例，我们从静水初始条件 $\\bar{h}_i^0 = H - b(x_i)$ 开始执行单个时间步。与平衡状态的偏差通过自由表面高程误差的 RMS 范数来衡量：\n$$\nE = \\sqrt{ \\frac{1}{N} \\sum_{i=0}^{N-1} \\left( (h^{n+1}_i + b_i) - H \\right)^2 }\n$$\n这个定量度量使我们能够比较不同数值策略的平衡特性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D hydrostatic balance law problem and evaluates well-balancing errors.\n    \"\"\"\n    # Define problem parameters\n    N = 256\n    L = 1.0\n    g = 9.81\n    A = 0.2\n    H = 1.0\n    dx = L / N\n    x = np.linspace(0.5 * dx, L - 0.5 * dx, N)\n\n    # Define bottom topography and its derivative\n    b = A * np.sin(2 * np.pi * x) + 0.05 * np.cos(4 * np.pi * x)\n    \n    # Pre-compute the 5th-order finite difference of the topography\n    # (Db/Dx)_i approx (1/60dx) * (b_{i-3} - 9b_{i-2} + 45b_{i-1} - 45b_{i+1} + 9b_{i+2} - b_{i+3})\n    dbdx = (\n        np.roll(b, 3) - 9 * np.roll(b, 2) + 45 * np.roll(b, 1) -\n        45 * np.roll(b, -1) + 9 * np.roll(b, -2) - np.roll(b, -3)\n    ) / (60.0 * dx)\n\n    # Initial condition (hydrostatic equilibrium)\n    h0 = H - b\n\n    # --- WENO-5 Reconstruction ---\n    def weno5_reconstruct(h):\n        \"\"\"\n        Computes the 5th-order WENO reconstruction for left and right states\n        at all cell interfaces in a vectorized manner.\n        \n        Returns:\n            h_minus (np.ndarray): Left-reconstructed values at i+1/2\n            h_plus (np.ndarray): Right-reconstructed values at i+1/2\n        \"\"\"\n        epsilon = 1e-6\n\n        # --- Left-biased reconstruction for h_{i+1/2}^{-} ---\n        v0 = np.roll(h, 2)\n        v1 = np.roll(h, 1)\n        v2 = h\n        v3 = np.roll(h, -1)\n        v4 = np.roll(h, -2)\n\n        beta0 = 13./12. * (v0 - 2*v1 + v2)**2 + 1./4. * (v0 - 4*v1 + 3*v2)**2\n        beta1 = 13./12. * (v1 - 2*v2 + v3)**2 + 1./4. * (v1 - v3)**2\n        beta2 = 13./12. * (v2 - 2*v3 + v4)**2 + 1./4. * (3*v2 - 4*v3 + v4)**2\n\n        d0, d1, d2 = 0.1, 0.6, 0.3\n\n        alpha0 = d0 / (epsilon + beta0)**2\n        alpha1 = d1 / (epsilon + beta1)**2\n        alpha2 = d2 / (epsilon + beta2)**2\n        alpha_sum = alpha0 + alpha1 + alpha2\n\n        w0 = alpha0 / alpha_sum\n        w1 = alpha1 / alpha_sum\n        w2 = alpha2 / alpha_sum\n        \n        h_recon0 = 2./6.*v0 - 7./6.*v1 + 11./6.*v2\n        h_recon1 = -1./6.*v1 + 5./6.*v2 + 2./6.*v3\n        h_recon2 = 2./6.*v2 + 5./6.*v3 - 1./6.*v4\n\n        h_minus = w0 * h_recon0 + w1 * h_recon1 + w2 * h_recon2\n\n        # --- Right-biased reconstruction for h_{i+1/2}^{+} ---\n        # This is equivalent to a left-biased reconstruction on a reversed stencil.\n        v0_r = np.roll(h, -3)\n        v1_r = np.roll(h, -2)\n        v2_r = np.roll(h, -1)\n        v3_r = h\n        v4_r = np.roll(h, 1)\n\n        beta0_r = 13./12. * (v0_r - 2*v1_r + v2_r)**2 + 1./4. * (v0_r - 4*v1_r + 3*v2_r)**2\n        beta1_r = 13./12. * (v1_r - 2*v2_r + v3_r)**2 + 1./4. * (v1_r - v3_r)**2\n        beta2_r = 13./12. * (v2_r - 2*v3_r + v4_r)**2 + 1./4. * (3*v2_r - 4*v3_r + v4_r)**2\n\n        # Linear weights are reversed for right-biased reconstruction\n        d0_r, d1_r, d2_r = 0.3, 0.6, 0.1\n        \n        alpha0_r = d0_r / (epsilon + beta0_r)**2\n        alpha1_r = d1_r / (epsilon + beta1_r)**2\n        alpha2_r = d2_r / (epsilon + beta2_r)**2\n        alpha_sum_r = alpha0_r + alpha1_r + alpha2_r\n\n        w0_r = alpha0_r / alpha_sum_r\n        w1_r = alpha1_r / alpha_sum_r\n        w2_r = alpha2_r / alpha_sum_r\n\n        h_recon0_r = 2./6.*v0_r - 7./6.*v1_r + 11./6.*v2_r\n        h_recon1_r = -1./6.*v1_r + 5./6.*v2_r + 2./6.*v3_r\n        h_recon2_r = 2./6.*v2_r + 5./6.*v3_r - 1./6.*v4_r\n\n        h_plus = w0_r * h_recon0_r + w1_r * h_recon1_r + w2_r * h_recon2_r\n\n        return h_minus, h_plus\n    \n    # --- RHS Operator ---\n    def L_operator(h, h_initial, policy):\n        \"\"\"\n        Computes the semi-discrete RHS L(h) = -div(f) + S.\n        \"\"\"\n        # --- Flux divergence part ---\n        h_minus, h_plus = weno5_reconstruct(h)\n\n        f_minus = 0.5 * g * h_minus**2\n        f_plus = 0.5 * g * h_plus**2\n        \n        # Local Lax-Friedrichs (Rusanov) wavespeed\n        alpha = g * np.maximum(h_minus, h_plus)\n        \n        # Numerical flux at i+1/2\n        flux_iph = 0.5 * (f_minus + f_plus) - 0.5 * alpha * (h_plus - h_minus)\n        \n        # Flux at i-1/2\n        flux_imh = np.roll(flux_iph, 1)\n\n        flux_divergence = (flux_iph - flux_imh) / dx\n        \n        # --- Source term part ---\n        source_h = h if policy == 'stage-aware' else h_initial\n        source_term = -g * source_h * dbdx\n\n        return -flux_divergence + source_term\n\n    # Define test cases\n    test_cases = [\n        ('SSP RK2', 'stage-aware', 1.0e-4),\n        ('SSP RK2', 'frozen-source', 1.0e-4),\n        ('SSP RK3', 'stage-aware', 2.0e-4),\n        ('SSP RK3', 'frozen-source', 2.0e-4),\n        ('SSP RK3', 'stage-aware', 2.5e-4),\n        ('SSP RK3', 'frozen-source', 2.5e-4),\n    ]\n\n    results = []\n\n    for scheme, policy, dt in test_cases:\n        h_n = h0.copy()\n\n        if scheme == 'SSP RK2':\n            # Stage 1\n            L_n = L_operator(h_n, h_n, policy)\n            h_1 = h_n + dt * L_n\n            # Stage 2\n            L_1 = L_operator(h_1, h_n, policy)\n            h_final = 0.5 * h_n + 0.5 * (h_1 + dt * L_1)\n        elif scheme == 'SSP RK3':\n            # Stage 1\n            L_n = L_operator(h_n, h_n, policy)\n            h_1 = h_n + dt * L_n\n            # Stage 2\n            L_1 = L_operator(h_1, h_n, policy)\n            h_2 = 0.75 * h_n + 0.25 * (h_1 + dt * L_1)\n            # Stage 3\n            L_2 = L_operator(h_2, h_n, policy)\n            h_final = (1./3.) * h_n + (2./3.) * (h_2 + dt * L_2)\n        else:\n            raise ValueError(f\"Unknown scheme: {scheme}\")\n\n        # Compute the free-surface elevation and the RMS error\n        eta_final = h_final + b\n        error = np.sqrt(np.mean((eta_final - H)**2))\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}