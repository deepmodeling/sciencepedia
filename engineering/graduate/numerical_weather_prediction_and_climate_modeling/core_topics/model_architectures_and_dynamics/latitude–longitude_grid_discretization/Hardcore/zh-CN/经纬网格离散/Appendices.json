{
    "hands_on_practices": [
        {
            "introduction": "纬度-经度网格的一个核心挑战在于极地附近。本练习将通过计算一个特定纬度上的最大稳定时间步长，来具体展示这一“极地问题”。这个实践将帮助您把抽象的 $CFL$ (Courant–Friedrichs–Lewy) 稳定性条件与球体上不断变化的网格间距联系起来，从而深刻理解为何在高纬度地区，经向流动会极大地限制数值模型的积分效率。",
            "id": "4059983",
            "problem": "在数值天气预报模型中，一个被动标量在一个球形地球上使用结构化经纬度网格进行平流计算。考虑一个位于纬度 $\\phi=60^\\circ$ 的点，该点所在的网格在经度和纬度方向上具有均匀的角间距 $\\Delta\\lambda=0.5^\\circ$ 和 $\\Delta\\phi=0.5^\\circ$。地球半径为 $R=6.371\\times 10^{6}\\ \\mathrm{m}$。该标量满足线性平流方程，该方程在物理（度量）网格上，在每个水平方向上使用一阶迎风格式进行时间显式离散。对于此格式，Courant–Friedrichs–Lewy (CFL) 稳定性要求是，在每个一维方向上，柯朗数 (Courant number) 不超过一个给定的界限 $C$，此处取 $C=1$。\n\n假设在关注点上，风是速度为 $u=30\\ \\mathrm{m\\,s^{-1}}$ 的纯纬向均匀风，且经向分量为零。将沿经度和纬度方向以物理单位表示的局地网格间距视为球面上的弧长。从球面弧长的定义和一维 CFL 条件出发，推导在该纬度上由经度方向所决定的最大稳定时间步长 $\\Delta t_{\\max}$。然后，使用相同的原理，确定如果经向风分量的大小与纬向分量相当，哪个水平方向将成为限制方向。\n\n使用 $R=6.371\\times 10^{6}\\ \\mathrm{m}$ 和 $C=1$ 计算 $\\Delta t_{\\max}$ 的单个数值，单位为秒。在需要时将角间距从度转换为弧度。将最终数值答案四舍五入至四位有效数字。以秒为单位表示最终时间。",
            "solution": "一维空间中的被动标量平流遵循线性平流方程\n$$\n\\frac{\\partial \\psi}{\\partial t} + u \\frac{\\partial \\psi}{\\partial x} = 0,\n$$\n其中 $u$ 是沿坐标方向 $x$ 的平流速度分量。对于采用一阶迎风空间格式的显式时间离散，经过充分检验的一维 Courant–Friedrichs–Lewy (CFL) 稳定性要求是柯朗数 (Courant number)\n$$\n\\mathcal{C} \\equiv \\frac{|u|\\,\\Delta t}{\\Delta x}\n$$\n满足\n$$\n\\mathcal{C} \\le C,\n$$\n对于此离散格式，$C=1$。\n\n在半径为 $R$ 的球面上，在纬度 $\\phi$ 处，对应于角增量 $\\Delta\\lambda$ (以弧度为单位) 的沿经度方向的物理弧长为\n$$\n\\Delta x_{\\lambda} = R\\cos\\phi\\,\\Delta\\lambda,\n$$\n而对应于角增量 $\\Delta\\phi$ (以弧度为单位) 的沿纬度方向的物理弧长为\n$$\n\\Delta x_{\\phi} = R\\,\\Delta\\phi.\n$$\n这些公式源于球面弧长的定义：沿大圆的弧长为 $ds = R\\,d\\theta$，而在固定纬度 $\\phi$ 处的沿经度方向的弧长因度量因子 $\\cos\\phi$ 而缩短。\n\n对于速度为 $u$ 且经向分量为零的纯纬向风，只有经度方向会带来稳定性约束。因此，由经度方向决定的最大稳定时间步长为\n$$\n\\Delta t_{\\max} = \\frac{C\\,\\Delta x_{\\lambda}}{|u|} = \\frac{C\\,R\\cos\\phi\\,\\Delta\\lambda}{|u|}.\n$$\n现在我们代入给定的数值。首先将角间距转换为弧度。$0.5^\\circ$ 的角增量等于\n$$\n\\Delta\\lambda = \\Delta\\phi = 0.5^\\circ \\times \\frac{\\pi}{180^\\circ} = \\frac{\\pi}{360}\\ \\text{radians}.\n$$\n在纬度 $\\phi=60^\\circ$ 处，我们有\n$$\n\\cos\\phi = \\cos 60^\\circ = \\frac{1}{2}.\n$$\n因此，\n$$\n\\Delta x_{\\lambda} = R\\cos\\phi\\,\\Delta\\lambda = R \\left(\\frac{1}{2}\\right)\\left(\\frac{\\pi}{360}\\right) = \\frac{\\pi R}{720}.\n$$\n当 $C=1$ 且 $|u|=30\\ \\mathrm{m\\,s^{-1}}$ 时，最大稳定时间步长为\n$$\n\\Delta t_{\\max} = \\frac{C\\,\\Delta x_{\\lambda}}{|u|} = \\frac{1}{30}\\left(\\frac{\\pi R}{720}\\right) = \\frac{\\pi R}{21600}.\n$$\n代入 $R=6.371\\times 10^{6}\\ \\mathrm{m}$ 得到数值\n$$\n\\Delta t_{\\max} = \\frac{\\pi\\,(6.371\\times 10^{6})}{21600}\\ \\mathrm{s}.\n$$\n计算得，\n$$\n\\Delta t_{\\max} \\approx 926.6243887\\ \\mathrm{s}.\n$$\n四舍五入到四位有效数字，结果为 $926.6\\ \\mathrm{s}$。\n\n关于限制方向：如果经向风分量的大小与纬向分量相当，那么经向 CFL 约束将是\n$$\n\\Delta t \\le \\frac{C\\,\\Delta x_{\\phi}}{|v|} = \\frac{C\\,R\\,\\Delta\\phi}{|v|}.\n$$\n在 $\\phi=60^\\circ$ 且 $\\Delta\\phi=\\Delta\\lambda=\\pi/360$ 时，我们有 $\\Delta x_{\\phi} = R\\,\\pi/360$ 而 $\\Delta x_{\\lambda} = R\\,\\pi/720$。因此 $\\Delta x_{\\lambda}$ 的值是 $\\Delta x_{\\phi}$ 的一半，这使得经度方向的约束更为严格。因此，对于大小相当的 $|u|$ 和 $|v|$，在该纬度上，经度方向设定了更严格的时间步长界限。\n\n所要求的最大稳定时间步长的单个数值结果（单位为秒，并四舍五入至四位有效数字）报告如下。",
            "answer": "$$\\boxed{926.6}$$"
        },
        {
            "introduction": "通过分析离散梯度和散度算子的截断误差，您将揭示纬度-经度网格的另一个深层问题：数值精度上的各向异性。这项实践将从数学上阐明，为何随着纬度的升高，不仅计算稳定性受到挑战，连微分算子的近似精度也会因方向而异，并向两极急剧恶化。这有助于您理解在设计数值方案时，必须考虑网格几何形状对解的准确性的影响。",
            "id": "4060064",
            "problem": "考虑一个定义在半径为 $\\,a\\,$ 的球形地球上的光滑标量场 $\\,\\psi(\\lambda,\\varphi)\\,$ 和一个光滑的水平速度场 $\\,\\vec{u}(\\lambda,\\varphi) = \\big(u(\\lambda,\\varphi),\\,v(\\lambda,\\varphi)\\big)\\,$，其中 $\\,\\lambda\\,$ 表示经度，$\\,\\varphi\\,$ 表示纬度。角度 $\\,\\lambda\\,$ 和 $\\,\\varphi\\,$ 以及网格间距 $\\,\\Delta \\lambda\\,$ 和 $\\,\\Delta \\varphi\\,$ 都以弧度为单位。在一个角度均匀的经纬度网格上，水平距离的球坐标度量由 $\\,\\mathrm{d}s^{2} = a^{2}\\cos^{2}\\varphi\\,\\mathrm{d}\\lambda^{2} + a^{2}\\,\\mathrm{d}\\varphi^{2}\\,$ 给出，其尺度因子为 $\\,h_{\\lambda} = a\\cos\\varphi\\,$ 和 $\\,h_{\\varphi} = a\\,$。考虑度量的 $\\,\\psi\\,$ 的连续水平梯度为 $\\,\\nabla_{h}\\psi = \\left(\\frac{1}{a\\cos\\varphi}\\frac{\\partial \\psi}{\\partial \\lambda},\\,\\frac{1}{a}\\frac{\\partial \\psi}{\\partial \\varphi}\\right)\\,$，以及考虑度量的 $\\,\\vec{u}\\,$（物理分量 $\\,u\\,$ 向东，$\\,v\\,$ 向北）的连续水平散度为 $\\,\\nabla_{h}\\cdot\\vec{u} = \\frac{1}{a\\cos\\varphi}\\frac{\\partial u}{\\partial \\lambda} + \\frac{1}{a\\cos\\varphi}\\frac{\\partial\\big(v\\cos\\varphi\\big)}{\\partial \\varphi}\\,$。\n\n在网格点 $\\,(\\lambda_{i},\\varphi_{j})\\,$ 处，使用二阶中心差分在每个坐标上定义考虑度量的离散算子：\n- 离散梯度分量为 $\\,\\left(\\frac{1}{a\\cos\\varphi_{j}}\\,\\delta_{\\lambda}\\psi,\\,\\frac{1}{a}\\,\\delta_{\\varphi}\\psi\\right)\\,$，其中 $\\,\\delta_{\\lambda}\\psi = \\frac{\\psi(\\lambda_{i+1},\\varphi_{j}) - \\psi(\\lambda_{i-1},\\varphi_{j})}{2\\,\\Delta \\lambda}\\,$ 且 $\\,\\delta_{\\varphi}\\psi = \\frac{\\psi(\\lambda_{i},\\varphi_{j+1}) - \\psi(\\lambda_{i},\\varphi_{j-1})}{2\\,\\Delta \\varphi}\\,$。\n- 离散散度为 $\\,\\frac{1}{a\\cos\\varphi_{j}}\\,\\delta_{\\lambda}u + \\frac{1}{a\\cos\\varphi_{j}}\\,\\delta_{\\varphi}(v\\cos\\varphi)\\,$，其中 $\\,\\delta_{\\lambda}u = \\frac{u(\\lambda_{i+1},\\varphi_{j}) - u(\\lambda_{i-1},\\varphi_{j})}{2\\,\\Delta \\lambda}\\,$ 且 $\\,\\delta_{\\varphi}(v\\cos\\varphi) = \\frac{v(\\lambda_{i},\\varphi_{j+1})\\cos\\varphi_{j+1} - v(\\lambda_{i},\\varphi_{j-1})\\cos\\varphi_{j-1}}{2\\,\\Delta \\varphi}\\,$。\n\n从光滑函数 $\\,f\\,$ 的一阶导数的二阶中心差分近似的基本 Taylor 展开式 $\\,\\frac{\\mathrm{d}f}{\\mathrm{d}x} = \\frac{f(x+\\Delta) - f(x-\\Delta)}{2\\Delta} - \\frac{\\Delta^{2}}{6}\\,f^{(3)}(x) + \\mathcal{O}(\\Delta^{4})\\,$ 出发，推导在 $\\,(\\lambda_{i},\\varphi_{j})\\,$ 处考虑度量的离散梯度和散度算子的主阶截断误差。将这些主阶截断误差贡献明确地表示为 $\\,\\Delta \\lambda\\,$、$\\,\\Delta \\varphi\\,$、$\\,a\\,$、$\\,\\varphi_{j}\\,$以及 $\\,\\psi\\,$、$\\,u\\,$ 和 $\\,v\\,$ 的相应三阶导数的函数。然后，通过分离系数随 $\\,\\varphi_{j}\\,$ 变化的项来确定随纬度变化的各向异性，揭示出随远离赤道而加剧的方向性差异。\n\n将你的最终表达式表示为单个行向量 $\\,\\big(E_{\\nabla,\\lambda},\\,E_{\\nabla,\\varphi},\\,E_{\\nabla\\cdot,\\lambda},\\,E_{\\nabla\\cdot,\\varphi}\\big)\\,$，其中 $\\,E_{\\nabla,\\lambda}\\,$ 和 $\\,E_{\\nabla,\\varphi}\\,$ 分别是梯度在 $\\,\\lambda\\,$ 和 $\\,\\varphi\\,$ 方向分量上的主阶截断误差，而 $\\,E_{\\nabla\\cdot,\\lambda}\\,$ 和 $\\,E_{\\nabla\\cdot,\\varphi}\\,$ 分别是来自 $\\,\\lambda\\,$ 和 $\\,\\varphi\\,$ 方向中心差分对散度的主阶截断误差贡献。角度必须以弧度处理。不需要数值计算，也无需四舍五入。将最终答案表示为封闭形式的解析表达式。",
            "solution": "离散算子的截断误差（Truncation Error, TE）定义为离散近似与精确连续算子之差。我们将对梯度和散度算子的每一项分别推导其主阶截断误差。\n\n根据问题中给出的泰勒展开，一个二阶中心差分算子与其逼近的一阶导数之间的关系为：\n$$ \\frac{f(x+\\Delta) - f(x-\\Delta)}{2\\Delta} = \\frac{\\mathrm{d}f}{\\mathrm{d}x} + \\frac{\\Delta^{2}}{6}\\,f^{(3)}(x) + \\mathcal{O}(\\Delta^{4}) $$\n因此，该差分格式的主阶截断误差项为 $\\frac{\\Delta^{2}}{6}\\,f^{(3)}(x)$。我们将应用此公式于网格点 $(\\lambda_{i}, \\varphi_{j})$。\n\n**1. 梯度截断误差**\n\n*   **经度分量 ($E_{\\nabla,\\lambda}$)**：\n    离散梯度的经度分量为 $\\frac{1}{a\\cos\\varphi_{j}}\\delta_{\\lambda}\\psi$。其截断误差为：\n    $$ E_{\\nabla,\\lambda} = \\left(\\frac{1}{a\\cos\\varphi_{j}}\\delta_{\\lambda}\\psi\\right) - \\left(\\frac{1}{a\\cos\\varphi_{j}}\\frac{\\partial \\psi}{\\partial \\lambda}\\right) = \\frac{1}{a\\cos\\varphi_{j}}\\left(\\delta_{\\lambda}\\psi - \\frac{\\partial \\psi}{\\partial \\lambda}\\right) $$\n    括号中的项是 $\\frac{\\partial\\psi}{\\partial\\lambda}$ 的中心差分近似的误差。其主阶项为 $\\frac{(\\Delta\\lambda)^{2}}{6}\\frac{\\partial^3\\psi}{\\partial\\lambda^3}$。因此：\n    $$ E_{\\nabla,\\lambda} = \\frac{(\\Delta\\lambda)^{2}}{6a\\cos\\varphi_{j}}\\frac{\\partial^3\\psi}{\\partial\\lambda^3} $$\n\n*   **纬度分量 ($E_{\\nabla,\\varphi}$)**：\n    同理，离散梯度的纬度分量为 $\\frac{1}{a}\\delta_{\\varphi}\\psi$。其截断误差为：\n    $$ E_{\\nabla,\\varphi} = \\frac{1}{a}\\left(\\delta_{\\varphi}\\psi - \\frac{\\partial \\psi}{\\partial \\varphi}\\right) $$\n    $\\delta_{\\varphi}\\psi$ 的主阶误差为 $\\frac{(\\Delta\\varphi)^{2}}{6}\\frac{\\partial^3\\psi}{\\partial\\varphi^3}$。因此：\n    $$ E_{\\nabla,\\varphi} = \\frac{(\\Delta\\varphi)^{2}}{6a}\\frac{\\partial^3\\psi}{\\partial\\varphi^3} $$\n\n**2. 散度截断误差**\n\n*   **经度方向的贡献 ($E_{\\nabla\\cdot,\\lambda}$)**：\n    散度中经度方向项的截断误差为：\n    $$ E_{\\nabla\\cdot,\\lambda} = \\left(\\frac{1}{a\\cos\\varphi_{j}}\\delta_{\\lambda}u\\right) - \\left(\\frac{1}{a\\cos\\varphi_{j}}\\frac{\\partial u}{\\partial \\lambda}\\right) = \\frac{1}{a\\cos\\varphi_{j}}\\left(\\delta_{\\lambda}u - \\frac{\\partial u}{\\partial \\lambda}\\right) $$\n    其主阶误差为：\n    $$ E_{\\nabla\\cdot,\\lambda} = \\frac{(\\Delta\\lambda)^{2}}{6a\\cos\\varphi_{j}}\\frac{\\partial^3 u}{\\partial\\lambda^3} $$\n\n*   **纬度方向的贡献 ($E_{\\nabla\\cdot,\\varphi}$)**：\n    散度中纬度方向项的截断误差涉及对函数 $f(\\varphi) = v\\cos\\varphi$ 的差分：\n    $$ E_{\\nabla\\cdot,\\varphi} = \\frac{1}{a\\cos\\varphi_{j}}\\left(\\delta_{\\varphi}(v\\cos\\varphi) - \\frac{\\partial(v\\cos\\varphi)}{\\partial \\varphi}\\right) $$\n    其主阶误差是 $\\frac{1}{a\\cos\\varphi_{j}} \\left( \\frac{(\\Delta\\varphi)^{2}}{6}\\frac{\\partial^3(v\\cos\\varphi)}{\\partial\\varphi^3} \\right)$。我们需要计算 $f(\\varphi) = v\\cos\\varphi$ 的三阶导数（记 $\\partial/\\partial\\varphi$ 为 $'$）：\n    \\begin{align*} f' &= v'\\cos\\varphi - v\\sin\\varphi \\\\ f'' &= v''\\cos\\varphi - 2v'\\sin\\varphi - v\\cos\\varphi \\\\ f''' &= v'''\\cos\\varphi - 3v''\\sin\\varphi - 3v'\\cos\\varphi + v\\sin\\varphi \\end{align*}\n    将此结果代入并除以 $\\cos\\varphi_j$，得到：\n    $$ E_{\\nabla\\cdot,\\varphi} = \\frac{(\\Delta\\varphi)^{2}}{6a} \\left( \\frac{\\partial^3 v}{\\partial\\varphi^3} - 3\\frac{\\partial^2 v}{\\partial\\varphi^2}\\tan\\varphi_j - 3\\frac{\\partial v}{\\partial\\varphi} + v\\tan\\varphi_j \\right) $$\n\n**各向异性分析**\n\n这些误差项揭示了强烈的各向异性。经度方向的误差项 $E_{\\nabla,\\lambda}$ 和 $E_{\\nabla\\cdot,\\lambda}$ 均包含 $1/\\cos\\varphi_j$ 因子，当纬度 $\\varphi_j$ 接近两极时，该因子趋于无穷，导致误差急剧放大。纬度方向的误差项 $E_{\\nabla,\\varphi}$ 与纬度无关，而 $E_{\\nabla\\cdot,\\varphi}$ 包含 $\\tan\\varphi_j$ 项，在两极同样奇异。这种精度随方向和纬度变化而剧烈变化的特性，是纬度-经度网格的一个根本缺陷。",
            "answer": "$$ \\boxed{\\begin{pmatrix} \\frac{(\\Delta\\lambda)^{2}}{6a\\cos\\varphi_{j}}\\frac{\\partial^3\\psi}{\\partial\\lambda^3} & \\frac{(\\Delta\\varphi)^{2}}{6a}\\frac{\\partial^3\\psi}{\\partial\\varphi^3} & \\frac{(\\Delta\\lambda)^{2}}{6a\\cos\\varphi_{j}}\\frac{\\partial^3 u}{\\partial\\lambda^3} & \\frac{(\\Delta\\varphi)^{2}}{6a}\\left( \\frac{\\partial^3 v}{\\partial\\varphi^3} - 3\\tan\\varphi_j \\frac{\\partial^2 v}{\\partial\\varphi^2} - 3\\frac{\\partial v}{\\partial\\varphi} + v\\tan\\varphi_j \\right) \\end{pmatrix}} $$"
        },
        {
            "introduction": "在认识到均匀纬度-经度网格的局限性后，自然会引出一个问题：我们如何改进？此练习将通过一个编程任务，让您亲手比较两种不同纬度离散化方案的积分精度。您将实现并评估在一个均匀网格上使用矩形法则和在一个高斯网格上使用高斯-勒让德求积法的效果，从而直观地理解为何高斯网格在精确表示球谐函数等操作中具有巨大优势。",
            "id": "4060072",
            "problem": "考虑一个单位半径球面，其由经度 $\\lambda \\in [0,2\\pi)$ 和纬度 $\\phi \\in [-\\pi/2,\\pi/2]$ 参数化，球面面积元为 $dA = \\cos\\phi\\,d\\phi\\,d\\lambda$。在数值天气预报 (NWP) 和气候建模中，纬向离散化对球谐函数的求积精度有很大影响。定义测试函数 $\\psi(\\lambda,\\phi) = \\cos(m\\lambda)\\,P_n(\\sin\\phi)$，其中 $P_n$ 是 $n$ 次勒让德多项式，$m$ 和 $n$ 是非负整数。$\\psi$ 在单位球面上的精确球面积分为\n$$\nI_{\\text{exact}} = \\int_{0}^{2\\pi}\\int_{-\\pi/2}^{\\pi/2} \\psi(\\lambda,\\phi)\\,\\cos\\phi\\,d\\phi\\,d\\lambda.\n$$\n使用变量代换 $\\mu = \\sin\\phi$（因此 $d\\mu = \\cos\\phi\\,d\\phi$ 且 $\\mu\\in[-1,1]$），该积分可以写成\n$$\nI_{\\text{exact}} = \\int_{0}^{2\\pi}\\int_{-1}^{1} \\cos(m\\lambda)\\,P_n(\\mu)\\,d\\mu\\,d\\lambda.\n$$\n你的任务是使用两种经纬度网格离散化方法，计算并比较 $I_{\\text{exact}}$ 的离散近似值，然后通过报告绝对误差来评估它们的求积精度。角度必须以弧度为单位处理。\n\n1. 均匀经纬度矩形法则：\n   - 经度：$L$ 个等距点 $\\lambda_k = \\frac{2\\pi k}{L}$，其中 $k=0,1,\\dots,L-1$，权重为 $\\Delta\\lambda = \\frac{2\\pi}{L}$。\n   - 纬度：$J$ 个中点 $\\phi_j = -\\frac{\\pi}{2} + \\left(j+\\frac{1}{2}\\right)\\Delta\\phi$，其中 $j=0,1,\\dots,J-1$，$ \\Delta\\phi = \\frac{\\pi}{J}$，矩形权重为 $\\Delta\\phi$，度量因子为 $\\cos\\phi_j$。\n   - 近似：\n     $$\n     I_{\\text{uni}} = \\sum_{k=0}^{L-1} \\sum_{j=0}^{J-1} \\cos(m\\lambda_k)\\,P_n(\\sin\\phi_j)\\,\\cos\\phi_j\\,\\Delta\\lambda\\,\\Delta\\phi.\n     $$\n\n2. 在 $\\mu$（纬度方向）上使用高斯-勒让德求积的高斯纬度网格和等距经度：\n   - 经度：$L$ 个等距点 $\\lambda_k = \\frac{2\\pi k}{L}$，其中 $k=0,1,\\dots,L-1$，权重为 $\\Delta\\lambda = \\frac{2\\pi}{L}$。\n   - 纬度：$[-1,1]$ 上的 $J$ 个高斯-勒让德节点和权重 $\\{\\mu_j,w_j\\}$。\n   - 近似：\n     $$\n     I_{\\text{gau}} = \\sum_{k=0}^{L-1} \\sum_{j=0}^{J-1} \\cos(m\\lambda_k)\\,P_n(\\mu_j)\\,w_j\\,\\Delta\\lambda.\n     $$\n\n使用的基本依据：\n- 单位球面的球面面积元为 $dA = \\cos\\phi\\,d\\phi\\,d\\lambda$。\n- 变量代换 $\\mu=\\sin\\phi$，因此 $d\\mu=\\cos\\phi\\,d\\phi$。\n- 勒让德多项式在 $[-1,1]$ 上关于权重 $1$ 的正交性，意味着 $\\int_{-1}^{1}P_n(\\mu)\\,d\\mu$ 当 $n=0$ 时为 $2$，当 $n\\ge 1$ 时为 $0$。\n- 精确的周期积分 $\\int_0^{2\\pi}\\cos(m\\lambda)\\,d\\lambda$ 当 $m=0$ 时为 $2\\pi$，当 $m\\ge 1$ 时为 $0$。\n- 具有 $J$ 个节点的高斯-勒让德求积对于 $[-1,1]$ 上次数至多为 $2J-1$ 的多项式是精确的这一性质。\n\n基于这些，精确积分满足\n$$\nI_{\\text{exact}} = \n\\begin{cases}\n4\\pi,  \\text{如果 } m=0 \\text{ 且 } n=0,\\\\\n0,  \\text{其他情况}.\n\\end{cases}\n$$\n\n实现一个程序，对于每个测试用例，计算 $I_{\\text{uni}}$ 和 $I_{\\text{gau}}$，并返回它们相对于 $I_{\\text{exact}}$ 的绝对误差。使用以下测试套件，它涵盖了一般情况、高斯求积在纬度方向上精确的情况、均匀经纬度网格在纬度方向上遇到困难的情况，以及一个经度混叠的边界情况：\n\n- 测试用例 1：$(L,J,m,n) = (64,32,3,5)$。\n- 测试用例 2：$(L,J,m,n) = (64,32,0,0)$。\n- 测试用例 3：$(L,J,m,n) = (64,32,0,7)$。\n- 测试用例 4：$(L,J,m,n) = (16,8,16,0)$。\n- 测试用例 5：$(L,J,m,n) = (32,3,0,7)$。\n\n对于每个测试用例，你的程序必须计算两个浮点数：绝对误差 $|I_{\\text{uni}}-I_{\\text{exact}}|$ 和绝对误差 $|I_{\\text{gau}}-I_{\\text{exact}}|$。\n\n最终输出格式：你的程序应该生成单行输出，其中包含所有测试用例结果的逗号分隔列表。每个结果本身是方括号内的一个双元素逗号分隔浮点数列表，整个序列被外层方括号包围。例如：$[[e_{1,\\text{uni}},e_{1,\\text{gau}}],[e_{2,\\text{uni}},e_{2,\\text{gau}}],\\dots]$。角度必须以弧度解释。不应打印任何附加文本。",
            "solution": "我们从单位半径球面的参数化开始，经度为 $\\lambda \\in [0,2\\pi)$，纬度为 $\\phi \\in [-\\pi/2,\\pi/2]$。单位半径下的球面面积元为 $dA=\\cos\\phi\\,d\\phi\\,d\\lambda$。测试函数为 $\\psi(\\lambda,\\phi)=\\cos(m\\lambda)\\,P_n(\\sin\\phi)$，其中 $P_n$ 是 $n$ 次勒让德多项式。\n\n精确积分为\n$$\nI_{\\text{exact}} = \\int_{0}^{2\\pi}\\int_{-\\pi/2}^{\\pi/2} \\cos(m\\lambda)\\,P_n(\\sin\\phi)\\,\\cos\\phi\\,d\\phi\\,d\\lambda.\n$$\n使用 $\\mu=\\sin\\phi$，其中 $d\\mu=\\cos\\phi\\,d\\phi$ 且 $\\mu\\in[-1,1]$，我们得到\n$$\nI_{\\text{exact}} = \\int_{0}^{2\\pi} \\cos(m\\lambda)\\,d\\lambda \\;\\times\\; \\int_{-1}^{1} P_n(\\mu)\\,d\\mu.\n$$\n根据余弦的傅里叶分析和勒让德多项式的正交性，我们得到\n$$\n\\int_{0}^{2\\pi} \\cos(m\\lambda)\\,d\\lambda =\n\\begin{cases}\n2\\pi,  m=0,\\\\\n0,  m\\ge 1,\n\\end{cases}\n\\qquad\n\\int_{-1}^{1} P_n(\\mu)\\,d\\mu =\n\\begin{cases}\n2,  n=0,\\\\\n0,  n\\ge 1.\n\\end{cases}\n$$\n因此\n$$\nI_{\\text{exact}}=\n\\begin{cases}\n4\\pi,  m=0,\\,n=0,\\\\\n0,  \\text{其他情况}.\n\\end{cases}\n$$\n\n我们考虑两种离散求积方案。\n\n1. 均匀经纬度矩形法则。经度为 $L$ 个等距点 $\\lambda_k=\\frac{2\\pi k}{L}$，权重为 $\\Delta\\lambda=\\frac{2\\pi}{L}$，其中 $k=0,1,\\dots,L-1$。纬度为 $J$ 个中点 $\\phi_j=-\\frac{\\pi}{2}+\\left(j+\\frac{1}{2}\\right)\\Delta\\phi$，其中 $\\Delta\\phi=\\frac{\\pi}{J}$，$j=0,1,\\dots,J-1$，并且度量因子 $\\cos\\phi_j$ 必须包含在面积元中。离散积分表示为\n$$\nI_{\\text{uni}} = \\sum_{k=0}^{L-1}\\sum_{j=0}^{J-1}\n\\cos(m\\lambda_k)\\,P_n(\\sin\\phi_j)\\,\\cos\\phi_j\\,\\Delta\\lambda\\,\\Delta\\phi.\n$$\n根据可分离性，我们可以将其解释为离散经向和与离散纬向和的乘积：\n$$\nI_{\\text{uni}}=\\left(\\Delta\\lambda \\sum_{k=0}^{L-1}\\cos(m\\lambda_k)\\right)\\left(\\Delta\\phi\\sum_{j=0}^{J-1}P_n(\\sin\\phi_j)\\cos\\phi_j\\right).\n$$\n在经度圆上，对于所有不是 $L$ 的倍数的整数 $m$，等距和能精确积分 $\\cos(m\\lambda)$（在这种情况下它恒等于 $0$），并且当 $m=0$ 时等于 $2\\pi$；如果 $m$ 是 $L$ 的正倍数，离散和会混叠到零频率分量上，结果等于 $2\\pi$。因此，当 $m$ 是 $L$ 的倍数时，会发生经向混叠。\n\n2. 在 $\\mu$ 上使用高斯-勒让德求积的高斯纬度网格和等距经度。设 $\\{\\mu_j,w_j\\}_{j=0}^{J-1}$ 为 $[-1,1]$ 上的 $J$ 点高斯-勒让德求积节点和权重，经度如上所述。使用 $\\mu$ 作为纬度坐标可以从被积函数中移除度量因子。离散积分表示为\n$$\nI_{\\text{gau}}=\\sum_{k=0}^{L-1}\\sum_{j=0}^{J-1}\\cos(m\\lambda_k)\\,P_n(\\mu_j)\\,w_j\\,\\Delta\\lambda\n= \\left(\\Delta\\lambda \\sum_{k=0}^{L-1}\\cos(m\\lambda_k)\\right)\\left(\\sum_{j=0}^{J-1}P_n(\\mu_j)\\,w_j\\right).\n$$\n根据高斯-勒让德性质，对于任何 $n\\le 2J-1$，$\\sum_{j=0}^{J-1}P_n(\\mu_j)\\,w_j$ 精确等于 $\\int_{-1}^{1}P_n(\\mu)\\,d\\mu$，特别地，当 $n=0$ 时精确等于 $2$。对于 $n>2J-1$，求积会引入误差。与均匀方案一样，如果 $m$ 是 $L$ 的倍数，会发生经向混叠，即使 $\\cos(m\\lambda)$ 的精确积分为零，也会导致非零的离散经向和。\n\n每个测试用例 $(L,J,m,n)$ 的算法步骤：\n- 计算 $\\Delta\\lambda=\\frac{2\\pi}{L}$ 和 $\\lambda_k=\\frac{2\\pi k}{L}$，其中 $k=0,\\dots,L-1$。\n- 均匀经纬度：\n  - 计算 $\\Delta\\phi=\\frac{\\pi}{J}$ 和 $\\phi_j=-\\frac{\\pi}{2}+\\left(j+\\frac{1}{2}\\right)\\Delta\\phi$，其中 $j=0,\\dots,J-1$。\n  - 计算 $P_n(\\sin\\phi_j)$ 和 $\\cos\\phi_j$ 的值。\n  - 构建经向和 $S_\\lambda^{\\text{uni}}=\\Delta\\lambda\\sum_{k=0}^{L-1}\\cos(m\\lambda_k)$。\n  - 构建纬向和 $S_\\phi^{\\text{uni}}=\\Delta\\phi\\sum_{j=0}^{J-1}P_n(\\sin\\phi_j)\\cos\\phi_j$。\n  - 计算 $I_{\\text{uni}}=S_\\lambda^{\\text{uni}}\\,S_\\phi^{\\text{uni}}$。\n- 高斯纬度：\n  - 获取高斯-勒让德节点和权重 $\\{\\mu_j,w_j\\}$，其中 $j=0,\\dots,J-1$。\n  - 计算 $P_n(\\mu_j)$ 的值。\n  - 构建经向和 $S_\\lambda^{\\text{gau}}=\\Delta\\lambda\\sum_{k=0}^{L-1}\\cos(m\\lambda_k)$（与均匀经度相同）。\n  - 构建高斯-勒让德纬向和 $S_\\mu^{\\text{gau}}=\\sum_{j=0}^{J-1}P_n(\\mu_j)\\,w_j$。\n  - 计算 $I_{\\text{gau}}=S_\\lambda^{\\text{gau}}\\,S_\\mu^{\\text{gau}}$。\n- 如果 $m=0$ 且 $n=0$，计算精确积分 $I_{\\text{exact}}=4\\pi$，否则 $I_{\\text{exact}}=0$。\n- 报告绝对误差 $|I_{\\text{uni}}-I_{\\text{exact}}|$ 和 $|I_{\\text{gau}}-I_{\\text{exact}}|$。\n\n对测试套件的解释：\n- 对于测试用例1，$(L,J,m,n)=(64,32,3,5)$，精确积分为 $0$。由于 $m$ 不为 $0$ 也不是 $L$ 的倍数，经向和精确为 $0$，这使得两种方案无论纬度处理如何都是精确的。\n- 对于测试用例2，$(L,J,m,n)=(64,32,0,0)$，精确积分为 $4\\pi$。高斯纬度求积是精确的，经向和也是精确的，所以 $I_{\\text{gau}}=4\\pi$。均匀经纬度矩形法则近似了纬向积分，产生一个小的误差。\n- 对于测试用例3，$(L,J,m,n)=(64,32,0,7)$，精确积分为 $0$。由于 $n\\le 2J-1$，高斯纬度求积是精确的，所以 $I_{\\text{gau}}=0$。均匀经纬度矩形法则会产生纬向求积误差。\n- 对于测试用例4，$(L,J,m,n)=(16,8,16,0)$，精确积分为 $0$，但 $m$ 是 $L$ 的倍数，导致经向混叠。两种方案都产生一个等于 $2\\pi$ 的非零经向和，而对于 $n=0$ 高斯纬度是精确的，从而产生一个量级为 $4\\pi$ 的大误差；均匀经纬度方案的值接近该值，纬度误差很小。\n- 对于测试用例5，$(L,J,m,n)=(32,3,0,7)$，精确积分为 $0$，但高斯纬度求积的精度为 $2J-1=5$ 次，小于 $n=7$，从而引入了纬向求积误差；均匀经纬度方法也存在纬向误差。\n\n程序应完全按照所述实现这些计算，并打印形如 $[[e_{1,\\text{uni}},e_{1,\\text{gau}}],[e_{2,\\text{uni}},e_{2,\\text{gau}}],[e_{3,\\text{uni}},e_{3,\\text{gau}}],[e_{4,\\text{uni}},e_{4,\\text{gau}}],[e_{5,\\text{uni}},e_{5,\\text{gau}}]]$ 的单行输出，其中每个 $e_{\\cdot,\\cdot}$ 都是一个浮点数。所有角度都必须以弧度解释。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\nfrom scipy.special import eval_legendre\n\ndef spherical_integral_errors(L, J, m, n):\n    # Constants\n    two_pi = 2.0 * np.pi\n\n    # Longitudes: endpoints (equispaced)\n    k = np.arange(L)\n    lam = two_pi * k / L\n    dlam = two_pi / L\n\n    # Longitudinal sum (same for both schemes)\n    S_lambda = dlam * np.sum(np.cos(m * lam))\n\n    # Uniform latitude: midpoints in phi\n    dphi = np.pi / J\n    j = np.arange(J)\n    phi = -np.pi / 2.0 + (j + 0.5) * dphi\n    mu_uniform = np.sin(phi)\n    cosphi = np.cos(phi)\n\n    Pn_uniform = eval_legendre(n, mu_uniform)\n    S_phi_uniform = dphi * np.sum(Pn_uniform * cosphi)\n    I_uni = S_lambda * S_phi_uniform\n\n    # Gaussian latitude: Gauss-Legendre nodes and weights in mu\n    mu_gau, w_gau = leggauss(J)\n    Pn_gau = eval_legendre(n, mu_gau)\n    S_mu_gau = np.sum(Pn_gau * w_gau)\n    I_gau = S_lambda * S_mu_gau\n\n    # Exact integral: 4*pi if m=0 and n=0; else 0\n    I_exact = (4.0 * np.pi) if (m == 0 and n == 0) else 0.0\n\n    # Absolute errors\n    err_uni = abs(I_uni - I_exact)\n    err_gau = abs(I_gau - I_exact)\n    return err_uni, err_gau\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple (L, J, m, n)\n    test_cases = [\n        (64, 32, 3, 5),   # General case: exact 0, longitudinal sum zero\n        (64, 32, 0, 0),   # Non-zero exact integral (4*pi), Gaussian exact\n        (64, 32, 0, 7),   # Exact 0, Gaussian exact, uniform latitude error\n        (16, 8, 16, 0),   # Longitudinal aliasing: m multiple of L\n        (32, 3, 0, 7),    # Gaussian latitude inexact: 2J-1=5  n=7\n    ]\n\n    results = []\n    for L, J, m, n in test_cases:\n        err_uni, err_gau = spherical_integral_errors(L, J, m, n)\n        results.append([err_uni, err_gau])\n\n    # Format output: single line, list of lists with comma-separated floats, no extra spaces\n    def format_float(x):\n        # Use a concise representation with up to 12 significant digits\n        return f\"{x:.12g}\"\n\n    formatted = \"[\" + \",\".join(\"[\" + \",\".join(format_float(x) for x in pair) + \"]\" for pair in results) + \"]\"\n    print(formatted)\n\nsolve()\n```"
        }
    ]
}