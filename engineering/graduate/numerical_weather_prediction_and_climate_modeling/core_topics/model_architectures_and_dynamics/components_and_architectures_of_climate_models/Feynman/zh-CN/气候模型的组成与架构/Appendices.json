{
    "hands_on_practices": [
        {
            "introduction": "气候模型由来自太阳的能量驱动，而辐射分量则负责模拟能量如何在大气中传输。本练习  提供了一个辐射传输的基础实践，您将从第一性原理出发，推导广泛使用的双流近似方程。通过将这些方程应用于一个简化的大气廓线来计算能量通量，您将获得关于气候模型核心参数化方案的实践经验。",
            "id": "4025073",
            "problem": "您正在一个全球气候模型中，使用双流架构为一个平行平面大气实现辐射分量。目标是从第一性原理出发，获得半球分辨的通量方程，然后为一个特定的大气廓线计算一个诊断性的大气层顶物理量。从灰色介质的辐射传输方程 (RTE) 出发，使用基本陈述：对于方向余弦为 $\\mu$ 的强度 $I(\\tau,\\mu)$，RTE 为 $\\mu\\,\\frac{\\partial I}{\\partial \\tau} = I - S$，其中光学厚度 $\\tau$ 向下增加，源函数 $S$ 是热发射和散射贡献的总和。定义单次散射反照率 $\\omega$ 为散射与消光之比，普朗克函数为 $B(T)$，并回顾向上半球通量和向下半球通量分别为 $F^{\\uparrow} = \\int_{0}^{2\\pi}\\int_{0}^{1} I(\\tau,\\mu)\\,\\mu\\,d\\mu\\,d\\phi$ 和 $F^{\\downarrow} = \\int_{0}^{2\\pi}\\int_{-1}^{0} I(\\tau,\\mu)\\,\\mu\\,d\\mu\\,d\\phi$。采用双流半球（Eddington）闭合，使得每个半球由单一的特征方向表示，并定义光学厚度缩放，以便热发射对每个半球通量方程的贡献为每单位光学厚度 $\\pi B(T)$。\n\n任务1（推导）：在这些假设下，推导控制灰色大气中 $F^{\\uparrow}(\\tau)$ 和 $F^{\\downarrow}(\\tau)$ 的耦合一阶常微分方程。清楚地说明 $\\omega$ 在一般形式中的作用，并展示当散射可忽略不计时（$\\omega = 0$）方程的简化形式。\n\n任务2（计算）：考虑热红外（长波）极限，其中散射可忽略不计，因此 $\\omega = 0$。考虑一个总光学厚度为 $\\tau_{s}$、温度为 $T_{a}$ 的均匀等温大气层，位于温度为 $T_{s}$ 的黑体表面（表面发射率为1）之上。大气层顶 (TOA) 的边界条件是来自空间的向下长波辐射为零，$F^{\\downarrow}(0) = 0$，而下边界条件是 $F^{\\uparrow}(\\tau_{s}) = \\sigma T_{s}^{4}$，其中 $\\sigma$ 是斯蒂芬-玻尔兹曼常数。使用您推导的通量方程，为给定的廓线计算 TOA 净长波通量 $F_{\\text{net}}^{\\text{TOA}} \\equiv F^{\\downarrow}(0) - F^{\\uparrow}(0)$：\n- $T_{a} = 255\\,\\text{K}$，\n- $T_{s} = 288\\,\\text{K}$，\n- $\\tau_{s} = 2$，\n- $\\sigma = 5.670374419 \\times 10^{-8}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{K}^{-4}$。\n\n将最终的净通量以瓦特/平方米表示，并将您的答案四舍五入到四位有效数字。不要在最终的方框答案中包含单位。",
            "solution": "该问题经评估具有科学依据，提法恰当，并为获得唯一解提供了充分信息。其语言虽然在“光学厚度缩放”方面包含一些特殊措辞，但在辐射传输理论的标准框架内可以得到一致的解释。因此，该问题是有效的。\n\n**任务1：双流通量方程的推导**\n\n我们从灰色、平行平面大气的辐射传输方程 (RTE) 开始，其形式如下：\n$$\n\\mu\\,\\frac{\\partial I(\\tau,\\mu)}{\\partial \\tau} = I(\\tau,\\mu) - S(\\tau)\n$$\n其中 $I$ 是强度，$\\tau$ 是向下增加的光学厚度，$\\mu$ 是天顶角的余弦，而 $S$ 是源函数。在这个灰色大气中，源函数包括热发射和各向同性散射：\n$$\nS(\\tau) = (1-\\omega)B(\\tau) + \\omega J(\\tau)\n$$\n此处，$\\omega$ 是单次散射反照率，$B(\\tau)$ 是普朗克函数（隐含为 $B(T(\\tau))$），$J(\\tau)$ 是平均强度，定义为 $J = \\frac{1}{4\\pi}\\int_{4\\pi} I d\\Omega$。\n\n双流近似通过将向上半球（$\\mu>0$）的强度表示为单一值 $I^+(\\tau)$ 和将向下半球（$\\mu<0$）的强度表示为单一值 $I^-(\\tau)$ 来简化辐射场。这等效于在两个特征方向余弦 $\\pm\\bar{\\mu}$ 处评估 RTE，其中 $\\bar{\\mu} \\in (0, 1)$。\nRTE 因此变成一个由两个常微分方程组成的系统：\n$$\n\\bar{\\mu} \\frac{dI^+}{d\\tau} = I^+ - S \\quad (\\text{对于 } \\mu = \\bar{\\mu})\n$$\n$$\n-\\bar{\\mu} \\frac{dI^-}{d\\tau} = I^- - S \\quad (\\text{对于 } \\mu = -\\bar{\\mu})\n$$\n半球通量定义为强度的积分。在双流假设下，它们变为：\n$$\nF^{\\uparrow}(\\tau) = \\int_{0}^{2\\pi}\\int_{0}^{1} I(\\tau,\\mu)\\,\\mu\\,d\\mu\\,d\\phi = \\int_{0}^{2\\pi}\\int_{0}^{1} I^+\\,\\mu\\,d\\mu\\,d\\phi = I^+ \\cdot 2\\pi \\cdot \\frac{1}{2} = \\pi I^+\n$$\n$$\nF^{\\downarrow}(\\tau) = \\int_{0}^{2\\pi}\\int_{-1}^{0} I(\\tau,\\mu)\\,\\mu\\,d\\mu\\,d\\phi = \\int_{0}^{2\\pi}\\int_{-1}^{0} I^-\\,\\mu\\,d\\mu\\,d\\phi = I^- \\cdot 2\\pi \\cdot \\left(-\\frac{1}{2}\\right) = -\\pi I^-\n$$\n由此，我们用通量表示强度：$I^+ = F^{\\uparrow}/\\pi$ 和 $I^- = -F^{\\downarrow}/\\pi$。注意，根据这个定义，$F^{\\uparrow} \\ge 0$ 且 $F^{\\downarrow} \\le 0$。\n\n平均强度 $J$ 现在可以用通量表示。假设每个半球内的强度是各向同性的：\n$$\nJ = \\frac{1}{2}\\left( \\int_{0}^{1} I^+ d\\mu' + \\int_{-1}^{0} I^- d\\mu' \\right) = \\frac{1}{2}(I^+ + I^-) = \\frac{1}{2}\\left(\\frac{F^{\\uparrow}}{\\pi} - \\frac{F^{\\downarrow}}{\\pi}\\right) = \\frac{1}{2\\pi}(F^{\\uparrow} - F^{\\downarrow})\n$$\n将此代入源函数表达式：\n$$\nS = (1-\\omega)B + \\frac{\\omega}{2\\pi}(F^{\\uparrow} - F^{\\downarrow})\n$$\n现在，我们将基于通量的 $I^+$、$I^-$ 和 $S$ 的表达式代入双流 RTEs：\n$$\n\\bar{\\mu} \\frac{d}{d\\tau}\\left(\\frac{F^{\\uparrow}}{\\pi}\\right) = \\frac{F^{\\uparrow}}{\\pi} - \\left[(1-\\omega)B + \\frac{\\omega}{2\\pi}(F^{\\uparrow} - F^{\\downarrow})\\right]\n$$\n$$\n-\\bar{\\mu} \\frac{d}{d\\tau}\\left(\\frac{-F^{\\downarrow}}{\\pi}\\right) = \\frac{-F^{\\downarrow}}{\\pi} - \\left[(1-\\omega)B + \\frac{\\omega}{2\\pi}(F^{\\uparrow} - F^{\\downarrow})\\right]\n$$\n将两个方程都乘以 $\\pi$ 并化简，得到：\n$$\n\\bar{\\mu} \\frac{dF^{\\uparrow}}{d\\tau} = F^{\\uparrow} - \\pi(1-\\omega)B - \\frac{\\omega}{2}(F^{\\uparrow} - F^{\\downarrow}) = \\left(1-\\frac{\\omega}{2}\\right)F^{\\uparrow} + \\frac{\\omega}{2}F^{\\downarrow} - \\pi(1-\\omega)B\n$$\n$$\n\\bar{\\mu} \\frac{dF^{\\downarrow}}{d\\tau} = -F^{\\downarrow} - \\pi(1-\\omega)B - \\frac{\\omega}{2}(F^{\\uparrow} - F^{\\downarrow}) = -\\frac{\\omega}{2}F^{\\uparrow} - \\left(1-\\frac{\\omega}{2}\\right)F^{\\downarrow} - \\pi(1-\\omega)B\n$$\n问题指定要“定义光学厚度缩放”，以使方程呈现规范形式。这通过定义一个缩放后的光学厚度 $\\tau' = \\tau/\\bar{\\mu}$ 来实现。根据这个定义，$d\\tau' = d\\tau/\\bar{\\mu}$，因此 $\\frac{d}{d\\tau} = \\frac{1}{\\bar{\\mu}}\\frac{d}{d\\tau'}$。将此代入方程并消去因子 $\\bar{\\mu}$（这等效于将方程除以 $\\bar{\\mu}$ 并将结果与关于 $\\tau'$ 的导数关联起来），我们得到最终的耦合常微分方程。为清晰起见，我们去掉 $\\tau$ 上的撇号，并理解它代表缩放后的光学厚度：\n$$\n\\frac{dF^{\\uparrow}}{d\\tau} = \\left(1-\\frac{\\omega}{2}\\right)F^{\\uparrow} + \\frac{\\omega}{2}F^{\\downarrow} - \\pi(1-\\omega)B\n$$\n$$\n\\frac{dF^{\\downarrow}}{d\\tau} = -\\frac{\\omega}{2}F^{\\uparrow} - \\left(1-\\frac{\\omega}{2}\\right)F^{\\downarrow} - \\pi(1-\\omega)B\n$$\n这些方程显示了 $\\omega$ 的作用。与 $\\omega$ 成正比的项表示从一个半球到另一个半球的通量散射，从而耦合了这两个方程。因子 $(1-\\omega)$ 调节了热发射的强度。\n\n对于散射可以忽略不计的情况（$\\omega = 0$），这些方程简化为：\n$$\n\\frac{dF^{\\uparrow}}{d\\tau} = F^{\\uparrow} - \\pi B\n$$\n$$\n\\frac{dF^{\\downarrow}}{d\\tau} = -F^{\\downarrow} - \\pi B\n$$\n在此极限下，两个通量方程是解耦的。\n\n**任务2：TOA 净长波通量的计算**\n\n我们使用为无散射情况（$\\omega = 0$）推导的方程。大气是等温的，温度为 $T_a$，所以普朗克函数 $B$ 是常数。源项 $\\pi B$ 由黑体的 Stefan-Boltzmann 定律给出，$S_a = \\pi B(T_a) = \\sigma T_a^4$。控制性常微分方程变为：\n$$\n\\frac{dF^{\\uparrow}}{d\\tau} = F^{\\uparrow} - \\sigma T_a^4\n$$\n$$\n\\frac{dF^{\\downarrow}}{d\\tau} = -F^{\\downarrow} - \\sigma T_a^4\n$$\n这些是线性、一阶、非齐次常微分方程。$F^{\\uparrow}(\\tau)$ 的通解可以通过将方程重写为 $\\frac{dF^{\\uparrow}}{d\\tau} - F^{\\uparrow} = -\\sigma T_a^4$ 来找到。积分因子是 $\\exp(-\\tau)$，得到：\n$$\n\\frac{d}{d\\tau}(F^{\\uparrow}e^{-\\tau}) = -\\sigma T_a^4 e^{-\\tau} \\implies F^{\\uparrow}(\\tau)e^{-\\tau} = \\sigma T_a^4 e^{-\\tau} + C_1 \\implies F^{\\uparrow}(\\tau) = \\sigma T_a^4 + C_1 e^{\\tau}\n$$\n$F^{\\downarrow}(\\tau)$ 的通解可以从 $\\frac{dF^{\\downarrow}}{d\\tau} + F^{\\downarrow} = -\\sigma T_a^4$ 中找到。积分因子是 $\\exp(\\tau)$，得到：\n$$\n\\frac{d}{d\\tau}(F^{\\downarrow}e^{\\tau}) = -\\sigma T_a^4 e^{\\tau} \\implies F^{\\downarrow}(\\tau)e^{\\tau} = -\\sigma T_a^4 e^{\\tau} + C_2 \\implies F^{\\downarrow}(\\tau) = -\\sigma T_a^4 + C_2 e^{-\\tau}\n$$\n常数 $C_1$ 和 $C_2$ 由边界条件确定。\n1.  大气层顶 (TOA) 处 $\\tau=0$：$F^{\\downarrow}(0) = 0$。\n    $F^{\\downarrow}(0) = -\\sigma T_a^4 + C_2 e^0 = 0 \\implies C_2 = \\sigma T_a^4$。\n    因此，向下通量为 $F^{\\downarrow}(\\tau) = -\\sigma T_a^4 + \\sigma T_a^4 e^{-\\tau} = \\sigma T_a^4 (e^{-\\tau}-1)$。\n2.  地表处 $\\tau=\\tau_s$：向上通量等于温度为 $T_s$ 的黑体表面的发射，所以 $F^{\\uparrow}(\\tau_s) = \\sigma T_s^4$。\n    $F^{\\uparrow}(\\tau_s) = \\sigma T_a^4 + C_1 e^{\\tau_s} = \\sigma T_s^4 \\implies C_1 = (\\sigma T_s^4 - \\sigma T_a^4)e^{-\\tau_s}$。\n    因此，向上通量为 $F^{\\uparrow}(\\tau) = \\sigma T_a^4 + (\\sigma T_s^4 - \\sigma T_a^4)e^{\\tau - \\tau_s}$。\n\n我们需要计算 TOA 净长波通量，$F_{\\text{net}}^{\\text{TOA}} = F^{\\downarrow}(0) - F^{\\uparrow}(0)$。\n根据边界条件，$F^{\\downarrow}(0) = 0$。\nTOA 处的向上通量是：\n$$\nF^{\\uparrow}(0) = \\sigma T_a^4 + (\\sigma T_s^4 - \\sigma T_a^4)e^{0 - \\tau_s} = \\sigma T_a^4 + (\\sigma T_s^4 - \\sigma T_a^4)e^{-\\tau_s}\n$$\n$$\nF^{\\uparrow}(0) = \\sigma T_a^4 (1 - e^{-\\tau_s}) + \\sigma T_s^4 e^{-\\tau_s}\n$$\n因此，净通量为：\n$$\nF_{\\text{net}}^{\\text{TOA}} = 0 - F^{\\uparrow}(0) = -[\\sigma T_a^4 (1 - e^{-\\tau_s}) + \\sigma T_s^4 e^{-\\tau_s}]\n$$\n现在，我们代入给定的数值：\n$T_a = 255\\,\\text{K}$\n$T_s = 288\\,\\text{K}$\n$\\tau_s = 2$\n$\\sigma = 5.670374419 \\times 10^{-8}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{K}^{-4}$\n\n首先，我们计算黑体发射项：\n$$\n\\sigma T_a^4 = (5.670374419 \\times 10^{-8}) \\cdot (255)^4 \\approx 239.9525\\,\\text{W}\\,\\text{m}^{-2}\n$$\n$$\n\\sigma T_s^4 = (5.670374419 \\times 10^{-8}) \\cdot (288)^4 \\approx 390.0965\\,\\text{W}\\,\\text{m}^{-2}\n$$\n大气透射率项是：\n$$\ne^{-\\tau_s} = e^{-2} \\approx 0.135335\n$$\n大气发射率项是：\n$$\n1 - e^{-\\tau_s} = 1 - e^{-2} \\approx 0.864665\n$$\n将这些代入 $F^{\\uparrow}(0)$ 的表达式：\n$$\nF^{\\uparrow}(0) \\approx (239.9525) \\cdot (0.864665) + (390.0965) \\cdot (0.135335)\n$$\n$$\nF^{\\uparrow}(0) \\approx 207.4699 + 52.8028 \\approx 260.2727\\,\\text{W}\\,\\text{m}^{-2}\n$$\nTOA 净通量是这个值的负数：\n$$\nF_{\\text{net}}^{\\text{TOA}} = -F^{\\uparrow}(0) \\approx -260.2727\\,\\text{W}\\,\\text{m}^{-2}\n$$\n四舍五入到四位有效数字，我们得到 -260.3。",
            "answer": "$$\\boxed{-260.3}$$"
        },
        {
            "introduction": "动力核心是大气模型的计算心脏，负责求解流体运动方程。其中一个关键的架构选择是垂直坐标系，尤其是在模拟跨山气流时。本练习  深入探讨了这一问题，要求您在地形追随坐标系中推导水平气压梯度力（PGF）。这个练习将揭示一个经典的数值挑战：PGF被计算为两个大项之间的小差值，这是陡峭地形上一个主要的误差来源。",
            "id": "4025123",
            "problem": "考虑一个大气模型，该模型使用由映射 $p(\\eta,x,y,t) = A(\\eta) + B(\\eta)\\,p_{s}(x,y,t)$ 定义的地形追随混合压力坐标，其中 $A(\\eta)$ 和 $B(\\eta)$ 仅是垂直坐标 $\\eta$ 的指定无量纲函数，而 $p_{s}(x,y,t)$ 是地面气压。假设大气是静力平衡的，其静力平衡方程为 $\\partial p/\\partial z = -\\rho g$，状态方程为 $p = \\rho R T$，位势为 $\\Phi = g z$，其中 $g$ 是重力加速度，$\\rho$ 是密度， $R$ 是干空气的比气体常数， $T$ 是温度， $z$ 是几何高度。用 $\\alpha = 1/\\rho$ 表示比容。在恒定几何高度 $z$ 上，单位质量的水平气压梯度力为 $-\\rho^{-1}\\nabla p|_{z}$。仅使用所述的平衡关系和定义，以及标准多元微积分（链式法则）来变换 $(x,y,z)$ 和 $(x,y,\\eta)$ 之间的导数，推导在恒定 $\\eta$ 面上计算的单位质量水平气压梯度力的精确表达式，该表达式应以 $\\Phi$、$\\alpha$、 $B(\\eta)$ 和 $\\nabla p_{s}$ 表示。清晰定义您引入的任何中间量，并将在恒定 $\\eta$ 面上的所有水平梯度记为 $\\nabla_{\\eta}$。您的推导应明确指出哪个项是由地形追随坐标面的坡度引起的，因此在使用此架构的大气模型中，该项可能成为陡峭地形上数值误差的来源。将最终答案表示为关于 $\\nabla_{\\eta}\\Phi$、$\\alpha$、 $B(\\eta)$ 和 $\\nabla p_{s}$ 的水平力矢量的单个闭式解析表达式，不附加任何评论或单位。",
            "solution": "该问题要求在地形追随混合压力坐标系中推导单位质量的水平气压梯度力（PGF）。在恒定几何高度 $z$ 的表面上，单位质量的 PGF 由 $-\\rho^{-1}\\nabla p|_{z}$ 给出，使用比容 $\\alpha = 1/\\rho$ 可写为 $-\\alpha \\nabla_z p$，其中梯度算子上的下标 $z$ 表示保持 $z$ 恒定。我们的目标是在模型的自然坐标系 $(x,y,\\eta)$ 中表示该矢量，其中梯度沿恒定 $\\eta$ 的表面（记为 $\\nabla_{\\eta}$）计算。\n\n任何标量场 $\\psi$ 的水平梯度从恒定 $z$ 面到恒定 $\\eta$ 面的变换可以使用链式法则推导。$\\psi$ 的变化可以在任一坐标系中表示：\n$d\\psi = (\\frac{\\partial \\psi}{\\partial x})_{\\eta} dx + (\\frac{\\partial \\psi}{\\partial y})_{\\eta} dy + \\frac{\\partial \\psi}{\\partial \\eta} d\\eta = \\nabla_{\\eta}\\psi \\cdot d\\mathbf{r} + \\frac{\\partial \\psi}{\\partial \\eta} d\\eta$\n$d\\psi = (\\frac{\\partial \\psi}{\\partial x})_{z} dx + (\\frac{\\partial \\psi}{\\partial y})_{z} dy + \\frac{\\partial \\psi}{\\partial z} dz = \\nabla_{z}\\psi \\cdot d\\mathbf{r} + \\frac{\\partial \\psi}{\\partial z} dz$\n其中 $d\\mathbf{r} = dx\\,\\hat{i} + dy\\,\\hat{j}$。\n\n为了关联这些梯度，我们首先需要 $d\\eta$ 和 $dz$ 之间的关系。从函数关系 $z=z(x,y,\\eta)$，我们可以写出其全微分：\n$dz = (\\frac{\\partial z}{\\partial x})_{\\eta} dx + (\\frac{\\partial z}{\\partial y})_{\\eta} dy + \\frac{\\partial z}{\\partial \\eta} d\\eta = \\nabla_{\\eta}z \\cdot d\\mathbf{r} + \\frac{\\partial z}{\\partial \\eta} d\\eta$\n\n通过令 $d\\psi$ 的两个表达式相等，并代入 $dz$ 的表达式，我们得到：\n$\\nabla_{\\eta}\\psi \\cdot d\\mathbf{r} + \\frac{\\partial \\psi}{\\partial \\eta} d\\eta = \\nabla_{z}\\psi \\cdot d\\mathbf{r} + \\frac{\\partial \\psi}{\\partial z} \\left( \\nabla_{\\eta}z \\cdot d\\mathbf{r} + \\frac{\\partial z}{\\partial \\eta} d\\eta \\right)$\n\n该方程必须对任何独立的变量 $d\\mathbf{r}$ 和 $d\\eta$ 成立。比较 $d\\mathbf{r}$ 的系数，得出水平梯度之间的关系：\n$\\nabla_{\\eta}\\psi = \\nabla_{z}\\psi + \\frac{\\partial \\psi}{\\partial z} \\nabla_{\\eta}z$\n整理我们感兴趣的量 $\\nabla_{z}\\psi$，我们有：\n$\\nabla_{z}\\psi = \\nabla_{\\eta}\\psi - \\frac{\\partial \\psi}{\\partial z} \\nabla_{\\eta}z$\n\n现在，我们将这个通用变换应用于压力场 $\\psi=p$：\n$\\nabla_{z}p = \\nabla_{\\eta}p - \\frac{\\partial p}{\\partial z} \\nabla_{\\eta}z$\n\n我们已知静力平衡方程 $\\frac{\\partial p}{\\partial z} = -\\rho g$。将其代入变换后的梯度表达式，得到：\n$\\nabla_{z}p = \\nabla_{\\eta}p - (-\\rho g) \\nabla_{\\eta}z = \\nabla_{\\eta}p + \\rho g \\nabla_{\\eta}z$\n\n单位质量的 PGF 是 $-\\alpha \\nabla_{z}p$。将上述表达式乘以 $-\\alpha = -1/\\rho$：\n$-\\alpha \\nabla_{z}p = -\\alpha (\\nabla_{\\eta}p + \\rho g \\nabla_{\\eta}z) = -\\alpha \\nabla_{\\eta}p - \\alpha \\rho g \\nabla_{\\eta}z$\n\n由于 $\\alpha\\rho = 1$，这简化为：\n$-\\alpha \\nabla_{z}p = -\\alpha \\nabla_{\\eta}p - g \\nabla_{\\eta}z$\n\n接下来，我们使用位势的定义 $\\Phi = gz$。在恒定 $\\eta$ 上取水平梯度得到 $\\nabla_{\\eta}\\Phi = \\nabla_{\\eta}(gz) = g\\nabla_{\\eta}z$，因为 $g$ 是一个常数。将此代入我们的 PGF 表达式，得到：\n$-\\alpha \\nabla_{z}p = -\\alpha \\nabla_{\\eta}p - \\nabla_{\\eta}\\Phi$\n\n最后一步是使用混合坐标的定义 $p(\\eta,x,y,t) = A(\\eta) + B(\\eta)\\,p_{s}(x,y,t)$ 来计算 $\\nabla_{\\eta}p$。我们沿恒定 $\\eta$ 的表面取梯度。\n$\\nabla_{\\eta}p = \\nabla_{\\eta} \\left( A(\\eta) + B(\\eta)\\,p_{s}(x,y,t) \\right)$\n由于 $\\eta$ 保持恒定，所以 $A(\\eta)$ 和 $B(\\eta)$ 相对于 $\\nabla_{\\eta}$ 算子也是常数。\n$\\nabla_{\\eta}p = \\nabla_{\\eta}(A(\\eta)) + \\nabla_{\\eta}(B(\\eta)\\,p_{s}) = 0 + B(\\eta)\\nabla_{\\eta}p_{s}$\n地面气压 $p_{s}$ 仅是 $(x,y,t)$ 的函数，不依赖于 $\\eta$。因此，它在恒定 $\\eta$ 面上的梯度就是其水平梯度，在问题陈述中记为 $\\nabla p_s$。因此，$\\nabla_{\\eta}p_s = \\nabla p_s$。\n这给出 $\\nabla_{\\eta}p = B(\\eta) \\nabla p_s$。\n\n将此结果代回 PGF 的表达式，我们得到最终形式：\nPGF = $-\\nabla_{\\eta}\\Phi - \\alpha \\nabla_{\\eta}p = -\\nabla_{\\eta}\\Phi - \\alpha B(\\eta) \\nabla p_s$\n\n这个表达式由两项组成。项 $-\\nabla_{\\eta}\\Phi$ 是沿地形追随 $\\eta$ 面的位势梯度。该项直接源于坐标面不水平（即不是恒定位势面），而是具有跟随下方地形的坡度。第二项 $-\\alpha B(\\eta) \\nabla p_s$ 与地面气压梯度成正比。在陡峭地形上，$p_s$ 和 $\\eta$ 面的坡度都急剧变化。这导致 $-\\nabla_{\\eta}\\Phi$ 和 $-\\alpha B(\\eta) \\nabla p_s$ 的量级都变得很大。真实的水平 PGF 是这两个大项之间的小差值。使用有限差分格式对这个差值进行数值计算容易产生显著的截断误差，这是使用此架构的大气模型中一个众所周知的问题。明确表示来自倾斜坐标面贡献的项是 $-\\nabla_{\\eta}\\Phi$。",
            "answer": "$$\n\\boxed{- \\nabla_{\\eta}\\Phi - \\alpha B(\\eta) \\nabla p_{s}}\n$$"
        },
        {
            "introduction": "现代气候模型是由大气、海洋等多个相互作用的分量组成的复杂系统。一个主要的架构挑战是如何在不违反基本守恒定律的前提下，耦合这些通常以不同时间步长运行的分量。本练习  直接针对这一问题，指导您推导异步耦合如何导致守恒误差，以及如何设计“通量订正”来恢复平衡。这个练习能让您深刻理解构建一个稳定且物理上一致的耦合模型所需的数值工程技术。",
            "id": "4025105",
            "problem": "考虑一个耦合的大气-海洋气候模型架构，其中大气分量和海洋分量通过表面质量通量，在其共享界面上交换一个守恒标量（为具体起见，即单位面积的水质量）。大气使用短时间步长进行子循环推进，而海洋使用更长的时间步长推进。在每个分量中，交换通量由其有限体积格式下的离散连续性方程表示。\n\n设分量 $X \\in \\{A, O\\}$（大气 A，海洋 O）中的守恒标量场在体积为 $V_{X,i}$ 的网格单元 $i$ 中用 $q_{X,i}$ 表示。分量 $X$ 在其一个时间步长 $\\Delta t_{X}$ 内的离散连续性方程可以写成如下有限体积形式：\n$$\nq_{X,i}^{n+1} \\;=\\; q_{X,i}^{n} \\;-\\; \\frac{\\Delta t_{X}}{V_{X,i}} \\sum_{f \\in \\partial i} F_{X,i,f}^{n+\\frac{1}{2}} A_{X,i,f} \\;+\\; \\Delta t_{X}\\, S_{X,i}^{n+\\frac{1}{2}},\n$$\n其中 $F_{X,i,f}^{n+\\frac{1}{2}}$ 是穿过网格单元 $i$ 的面 $f$ 的向外法向通量，$A_{X,i,f}$ 是面 $f$ 的面积，而 $S_{X,i}^{n+\\frac{1}{2}}$ 是一个源项。在时间层 $n$，分量 $X$ 上 $q$ 的全局积分量为 $M_{X}^{n} = \\sum_{i} V_{X,i}\\, q_{X,i}^{n}$。\n\n从这个离散定律出发，推导在一个耦合时间步内 $M_{A} + M_{O}$ 之和的全局积分约束。在此耦合时间步内，大气推进 $N$ 个长度为 $\\Delta t_{A}$ 的子步，而海洋推进一个长度为 $\\Delta t_{O} = N\\, \\Delta t_{A}$ 的步。假设：(i) 组合的大气-海洋系统的外部边界对所交换的标量是封闭的，因此任何穿过大气-海洋界面 $\\Gamma$ 的通量对于组合系统而言纯粹是内部的，并且在两个分量中符号相反；(ii) 组合源为零，$S_{A} + S_{O} = 0$（除了界面交换外，所交换的标量是严格守恒的）。\n\n在异步耦合中，海洋在其步长内使用一个不随时间变化的界面通量 $F_{O}$，而大气在其 $N$ 个子步内使用分段常数的子步界面通量 $F_{A,k}$（$k = 1, \\dots, N$）。设界面面积为 $A_{\\Gamma}$，并假设两个分量使用相同的几何界面 $\\Gamma$，因此相同的 $A_{\\Gamma}$ 对两者都适用，只是通量符号相反。\n\n(a) 使用离散连续性方程，推导 $M_{A}^{n+N} + M_{O}^{n+1}$ 的全局积分约束（用时间积分的界面通量表示），并说明如果大气和海洋使用不同的界面通量时间表示，将如何产生净不平衡。将一个海洋时间步长后的不平衡量 $\\Delta$ 表示为大气累积界面输运量与海洋界面输运量之差。\n\n(b) 提出一种标量通量校正策略，通过一个单一因子 $\\alpha$（在 $N$ 个子步上对每个 $F_{A,k}$ 同样应用）来重新缩放大气子步通量，以在耦合步长内强制实现 $M_{A} + M_{O}$ 的精确守恒。推导出 $\\alpha$ 的一个闭式表达式，用 $F_{O}$、$\\{F_{A,k}\\}_{k=1}^{N}$、$\\Delta t_{A}$ 和 $\\Delta t_{O}$ 表示。\n\n(c) 对于一个科学上符合实际的数值配置，$N = 5$，$\\Delta t_{A} = 180\\,\\text{s}$，$\\Delta t_{O} = 900\\,\\text{s}$，$A_{\\Gamma} = 3.6 \\times 10^{14}\\,\\text{m}^{2}$，海洋使用的界面通量 $F_{O} = 1.7 \\times 10^{-4}\\,\\text{kg}\\,\\text{m}^{-2}\\,\\text{s}^{-1}$，以及大气子步通量\n$$\nF_{A,1} = 1.6 \\times 10^{-4},\\quad F_{A,2} = 1.7 \\times 10^{-4},\\quad F_{A,3} = 1.9 \\times 10^{-4},\\quad F_{A,4} = 2.0 \\times 10^{-4},\\quad F_{A,5} = 1.8 \\times 10^{-4}\n$$\n（单位均为 $\\text{kg}\\,\\text{m}^{-2}\\,\\text{s}^{-1}$），计算用于恢复守恒的通量校正因子 $\\alpha$ 的数值。将答案四舍五入到六位有效数字。将最终答案以单个实数的形式给出。$\\alpha$ 不需要单位。",
            "solution": "出发点是每个分量 $X \\in \\{A, O\\}$ 的有限体积离散连续性方程：\n$$\nq_{X,i}^{n+1} \\;=\\; q_{X,i}^{n} \\;-\\; \\frac{\\Delta t_{X}}{V_{X,i}} \\sum_{f \\in \\partial i} F_{X,i,f}^{n+\\frac{1}{2}} A_{X,i,f} \\;+\\; \\Delta t_{X}\\, S_{X,i}^{n+\\frac{1}{2}}.\n$$\n对分量 $X$ 中的所有网格单元 $i$ 求和，得到在一个时间步长内全局质量（或守恒标量的积分）的变化：\n$$\nM_{X}^{n+1} - M_{X}^{n} \\;=\\; - \\Delta t_{X} \\sum_{i} \\sum_{f \\in \\partial i} F_{X,i,f}^{n+\\frac{1}{2}} A_{X,i,f} \\;+\\; \\Delta t_{X} \\sum_{i} V_{X,i}\\, S_{X,i}^{n+\\frac{1}{2}}.\n$$\n位于分量 $X$ 内部的面 $f$ 在对 $i$ 的双重求和中以相反的方向出现两次，其通量贡献成对抵消。唯一剩下的面是 $X$ 的外部边界，特别是大气和海洋之间的界面 $\\Gamma$。将分量 $X$ 穿过其外部边界的净向外通量记为 $F_{X,\\Gamma}^{n+\\frac{1}{2}}$ 乘以界面面积 $A_{\\Gamma}$，我们写出\n$$\nM_{X}^{n+1} - M_{X}^{n} \\;=\\; - \\Delta t_{X}\\, F_{X,\\Gamma}^{n+\\frac{1}{2}}\\, A_{\\Gamma} \\;+\\; \\Delta t_{X} \\int_{\\Omega_{X}} S_{X}^{n+\\frac{1}{2}}\\, \\mathrm{d}V,\n$$\n其中 $\\Omega_{X}$ 是分量 $X$ 的区域。对于耦合系统，我们假设交换标量的外部边界是封闭的，并且组合源为零，$S_{A} + S_{O} = 0$。穿过界面 $\\Gamma$ 的通量对组合系统是内部的，并且在分量之间符号相反：\n$$\nF_{A,\\Gamma}^{n+\\frac{1}{2}} \\;=\\; - F_{O,\\Gamma}^{n+\\frac{1}{2}}.\n$$\n因此，在一个共同的耦合区间上对大气和海洋的全局更新求和，得到组合守恒定律：\n$$\n\\left(M_{A}^{\\text{after}} - M_{A}^{\\text{before}}\\right) + \\left(M_{O}^{\\text{after}} - M_{O}^{\\text{before}}\\right) \\;=\\; - \\int_{t_{\\text{before}}}^{t_{\\text{after}}} \\left[F_{A,\\Gamma}(t) + F_{O,\\Gamma}(t)\\right] A_{\\Gamma}\\, \\mathrm{d}t \\;+\\; \\int_{t_{\\text{before}}}^{t_{\\text{after}}} \\int_{\\Omega_{A} \\cup \\Omega_{O}} \\left(S_{A} + S_{O}\\right) \\mathrm{d}V\\, \\mathrm{d}t.\n$$\n在 $S_{A} + S_{O} = 0$ 和 $F_{A,\\Gamma}(t) = - F_{O,\\Gamma}(t)$ 的条件下，在连续时间理想化中，右侧恒等于零，从而得到精确守恒：\n$$\nM_{A}^{\\text{after}} + M_{O}^{\\text{after}} \\;=\\; M_{A}^{\\text{before}} + M_{O}^{\\text{before}}.\n$$\n\n在离散异步耦合中，海洋在 $(t^{n}, t^{n+1})$ 上使用不随时间变化的通量 $F_{O}$ 推进一个长度为 $\\Delta t_{O}$ 的步，而大气在 $(t^{n+(k-1)}, t^{n+k})$（$k=1, \\dots, N$）上使用分段常数通量 $F_{A,k}$ 推进 $N$ 个长度为 $\\Delta t_{A}$ 的子步，其中 $t^{n+k} = t^{n} + k\\, \\Delta t_{A}$ 且 $\\Delta t_{O} = N\\, \\Delta t_{A}$。大气在整个海洋步长内的离散界面输运量为\n$$\nT_{A} \\;=\\; \\sum_{k=1}^{N} F_{A,k}\\, A_{\\Gamma}\\, \\Delta t_{A},\n$$\n而海洋在同一区间内的离散界面输运量为\n$$\nT_{O} \\;=\\; F_{O}\\, A_{\\Gamma}\\, \\Delta t_{O}.\n$$\n对于组合系统，当源项为零且外部边界封闭时，其全局积分约束要求 $T_{A} + T_{O} = 0$（当通量符号取得一致时）。在实践中，由于两个分量采用相反的向外法向约定，精确守恒要求 $T_{A} = T_{O}$（在量值上）。如果由于不同的通量时间表示导致 $T_{A} \\neq T_{O}$，就会产生一个净不平衡。将不平衡量 $\\Delta$ 定义为大气的累积界面输运量减去海洋的界面输运量，可得\n$$\n\\Delta \\;=\\; T_{A} - T_{O} \\;=\\; \\left(\\sum_{k=1}^{N} F_{A,k}\\, A_{\\Gamma}\\, \\Delta t_{A}\\right) \\;-\\; \\left(F_{O}\\, A_{\\Gamma}\\, \\Delta t_{O}\\right).\n$$\n一个非零的 $\\Delta$ 表明，在离散格式中 $M_{A}^{\\text{after}} + M_{O}^{\\text{after}} \\neq M_{A}^{\\text{before}} + M_{O}^{\\text{before}}$。\n\n为了恢复守恒，我们建议通过一个单一因子 $\\alpha$（对每个子步同样应用）来重新缩放大气子步通量，从而产生校正后的通量 $\\alpha\\, F_{A,k}$。校正后的大气输运量变为\n$$\nT_{A}^{\\text{corr}} \\;=\\; \\sum_{k=1}^{N} \\alpha\\, F_{A,k}\\, A_{\\Gamma}\\, \\Delta t_{A} \\;=\\; \\alpha\\, A_{\\Gamma}\\, \\Delta t_{A}\\, \\sum_{k=1}^{N} F_{A,k}.\n$$\n通过使校正后的大气输运量与海洋的输运量 $T_{O}$ 在量值上匹配，从而在离散意义上强制实现精确守恒，可得\n$$\n\\alpha\\, A_{\\Gamma}\\, \\Delta t_{A}\\, \\sum_{k=1}^{N} F_{A,k} \\;=\\; F_{O}\\, A_{\\Gamma}\\, \\Delta t_{O}.\n$$\n消去公共的界面面积 $A_{\\Gamma}$ 并使用 $\\Delta t_{O} = N\\, \\Delta t_{A}$，得到标量校正因子的闭式表达式：\n$$\n\\alpha \\;=\\; \\frac{F_{O}\\, \\Delta t_{O}}{\\Delta t_{A}\\, \\sum_{k=1}^{N} F_{A,k}} \\;=\\; \\frac{F_{O}\\, N}{\\sum_{k=1}^{N} F_{A,k}}.\n$$\n该表达式仅依赖于海洋的常数通量 $F_{O}$、大气子步通量集合 $\\{F_{A,k}\\}$以及时间步长比率 $N$；它与界面面积 $A_{\\Gamma}$ 无关。\n\n对于给定的数值配置，我们有 $N = 5$，$\\Delta t_{A} = 180\\,\\text{s}$，$\\Delta t_{O} = 900\\,\\text{s}$，$F_{O} = 1.7 \\times 10^{-4}\\,\\text{kg}\\,\\text{m}^{-2}\\,\\text{s}^{-1}$，以及\n$$\nF_{A,1} = 1.6 \\times 10^{-4},\\quad F_{A,2} = 1.7 \\times 10^{-4},\\quad F_{A,3} = 1.9 \\times 10^{-4},\\quad F_{A,4} = 2.0 \\times 10^{-4},\\quad F_{A,5} = 1.8 \\times 10^{-4}.\n$$\n计算大气子步通量之和：\n$$\n\\sum_{k=1}^{5} F_{A,k} \\;=\\; \\left(1.6 + 1.7 + 1.9 + 2.0 + 1.8\\right) \\times 10^{-4} \\;=\\; 9.0 \\times 10^{-4}.\n$$\n于是，校正因子为\n$$\n\\alpha \\;=\\; \\frac{F_{O}\\, N}{\\sum_{k=1}^{N} F_{A,k}} \\;=\\; \\frac{\\left(1.7 \\times 10^{-4}\\right)\\, 5}{9.0 \\times 10^{-4}} \\;=\\; \\frac{8.5 \\times 10^{-4}}{9.0 \\times 10^{-4}} \\;=\\; \\frac{17}{18}.\n$$\n表示为小数并四舍五入到六位有效数字，得到\n$$\n\\alpha \\;\\approx\\; 0.944444.\n$$\n在所述假设下，将此标量因子统一应用于每个大气子步通量 $F_{A,k}$，即可在耦合时间步内恢复全局积分质量 $M_{A} + M_{O}$ 的精确离散守恒。",
            "answer": "$$\\boxed{0.944444}$$"
        }
    ]
}