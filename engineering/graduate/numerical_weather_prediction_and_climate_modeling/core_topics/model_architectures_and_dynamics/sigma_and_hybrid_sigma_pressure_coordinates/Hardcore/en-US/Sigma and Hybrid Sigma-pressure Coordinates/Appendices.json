{
    "hands_on_practices": [
        {
            "introduction": "In a hydrostatic atmosphere at rest, horizontal pressure gradients at a constant geometric height $z$ should be zero, resulting in no horizontal acceleration. However, when we discretize the governing equations on terrain-following coordinates, numerical inaccuracies can arise. This exercise provides a direct, hands-on opportunity to quantify this \"pressure gradient force error\" within a pure sigma-coordinate system, revealing the core computational challenge that has driven the development of more sophisticated vertical coordinates like the hybrid sigma-pressure system .",
            "id": "4089051",
            "problem": "Consider a dry, isothermal atmosphere used in Numerical Weather Prediction (NWP) and climate modeling, occupying a two-dimensional domain with horizontal coordinate $x$ and geometric height $z$. Let the atmosphere be in hydrostatic balance and governed by the Ideal Gas Law. The hydrostatic balance is $\\frac{\\partial p}{\\partial z}=-\\rho g$, and the Ideal Gas Law is $p=\\rho R T$, where $p$ is pressure, $\\rho$ is density, $g$ is gravitational acceleration, $R$ is the specific gas constant for dry air, and $T$ is absolute temperature. Assume an isothermal atmosphere with constant temperature $T=T_0$, and a reference pressure $p_{\\mathrm{ref}}$ at $z=0$.\n\nThe terrain height is given by $z_s(x)=s\\,x$ with constant slope parameter $s$, and the surface pressure is the hydrostatic value $p_s(x)=p_{\\mathrm{ref}}\\exp\\!\\left(-\\frac{z_s(x)}{H}\\right)$, where $H=\\frac{R T_0}{g}$ is the density scale height. Define the terrain-following sigma coordinate by $\\sigma(x,z)=\\frac{p(x,z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}$, where $p_{\\mathrm{top}}$ is the constant pressure at the model top. For any fixed $\\sigma$, define the hydrostatic state by $p(x,\\sigma)=p_{\\mathrm{top}}+\\sigma\\big(p_s(x)-p_{\\mathrm{top}}\\big)$ and $\\rho(x,\\sigma)=\\frac{p(x,\\sigma)}{R T_0}$ under the assumption of horizontal isothermality and hydrostatic balance.\n\nStarting from these foundations, address the following tasks:\n\n- Derive, from first principles and explicit application of hydrostatic balance and the Ideal Gas Law, the continuous expression for the horizontal pressure gradient force (PGF) at constant geometric height $z$, and explain why it vanishes for the specified isothermal hydrostatic state over sloping terrain (i.e., $\\left.\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\right|_{z}=0$ for all $x$ when the true $p$ depends only on $z$).\n- Construct a discrete approximation to the horizontal PGF using sigma coordinates by computing a centered finite-difference approximation to $\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}$ along constant-$\\sigma$ surfaces. Use a periodic domain in $x$ of length $L$ with $N_x$ equally spaced grid points and $N_\\sigma$ equally spaced sigma levels located at mid-layer positions $\\sigma_k=\\frac{k+\\tfrac{1}{2}}{N_\\sigma}$ for $k\\in\\{0,1,\\dots,N_\\sigma-1\\}$. Use centered finite differences with periodic boundary conditions for the horizontal derivative at each $\\sigma_k$. Quantify the resulting spurious horizontal acceleration as $a(x,\\sigma_k)=-\\frac{1}{\\rho(x,\\sigma_k)}\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}$, expressed in $\\mathrm{m/s^2}$.\n- Aggregate the discrete spurious acceleration over the two-dimensional grid by reporting the maximum absolute value $\\max_{x,k}\\left|a(x,\\sigma_k)\\right|$ in $\\mathrm{m/s^2}$.\n\nYour program must implement the above discrete construction and produce numerical results for the following test suite, each case defined by $[L,s,N_x,N_\\sigma]$, with fixed constants $g=9.81\\,\\mathrm{m/s^2}$, $R=287\\,\\mathrm{J/(kg\\cdot K)}$, $T_0=300\\,\\mathrm{K}$, $p_{\\mathrm{ref}}=100000\\,\\mathrm{Pa}$, and $p_{\\mathrm{top}}=20000\\,\\mathrm{Pa}$:\n\n- Case $1$: $[L=100000\\,\\mathrm{m},\\,s=0.01,\\,N_x=128,\\,N_\\sigma=30]$.\n- Case $2$ (boundary condition check): $[L=100000\\,\\mathrm{m},\\,s=0,\\,N_x=128,\\,N_\\sigma=30]$.\n- Case $3$ (coarse vertical resolution): $[L=100000\\,\\mathrm{m},\\,s=0.01,\\,N_x=128,\\,N_\\sigma=3]$.\n- Case $4$ (steeper slope): $[L=100000\\,\\mathrm{m},\\,s=0.05,\\,N_x=128,\\,N_\\sigma=30]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[a_1,a_2,a_3,a_4]$), where $a_i$ is the maximum absolute spurious acceleration for Case $i$ in $\\mathrm{m/s^2}$, represented as floating-point numbers. Angles do not appear in this problem. There are no percentages in this problem; report floating-point values directly. All quantities must be computed in $\\mathrm{SI}$ units as given, and the final outputs must be in $\\mathrm{m/s^2}$.",
            "solution": "We begin from the hydrostatic balance and the Ideal Gas Law, the cornerstones of dry atmospheric thermodynamics used in Numerical Weather Prediction (NWP) and climate modeling. Hydrostatic balance states\n$$\n\\frac{\\partial p}{\\partial z}=-\\rho g,\n$$\nand the Ideal Gas Law states\n$$\np=\\rho R T.\n$$\nUnder the isothermal assumption $T=T_0$, we can combine the two to derive the classic exponential pressure profile. Substituting $\\rho=\\frac{p}{R T_0}$ into hydrostatic balance gives\n$$\n\\frac{\\partial p}{\\partial z}=-\\frac{p}{R T_0}\\,g=-\\frac{p}{H},\n$$\nwhere $H=\\frac{R T_0}{g}$ is the density scale height. Solving this ordinary differential equation with the boundary condition $p(0)=p_{\\mathrm{ref}}$ yields\n$$\np(z)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{z}{H}\\right).\n$$\nFor a sloping lower boundary $z_s(x)=s\\,x$, the surface pressure is obtained by evaluation at the terrain height:\n$$\np_s(x)=p\\big(z_s(x)\\big)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{s\\,x}{H}\\right).\n$$\n\nDefine the terrain-following sigma coordinate by\n$$\n\\sigma(x,z)=\\frac{p(x,z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}.\n$$\nFor a hydrostatic, isothermal atmosphere, one can construct a hydrostatic state on sigma surfaces by\n$$\np(x,\\sigma)=p_{\\mathrm{top}}+\\sigma\\left(p_s(x)-p_{\\mathrm{top}}\\right),\\qquad \\rho(x,\\sigma)=\\frac{p(x,\\sigma)}{R T_0}.\n$$\nIn this construction, the continuous atmospheric state in geometric height $z$ is horizontally uniform at fixed $z$ because $p(z)$ depends only on $z$; hence, the true horizontal pressure gradient at constant geometric height vanishes:\n$$\n\\left.\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\right|_{z}=0.\n$$\nTo see this formally, apply the chain rule. Consider $p$ as a function of $(x,\\sigma)$ with $\\sigma=\\sigma(x,z)$. The derivative at constant $z$ can be written as\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}+\\left.\\frac{\\partial p}{\\partial \\sigma}\\right|_{x}\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}.\n$$\nThe first term is the derivative along constant-$\\sigma$ surfaces,\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}=\\sigma \\frac{\\partial p_s}{\\partial x},\n$$\nbecause $p(x,\\sigma)=p_{\\mathrm{top}}+\\sigma(p_s(x)-p_{\\mathrm{top}})$ implies $\\frac{\\partial p}{\\partial x}\\big|_{\\sigma}=\\sigma \\frac{\\partial p_s}{\\partial x}$. The derivative with respect to $\\sigma$ at fixed $x$ is\n$$\n\\left.\\frac{\\partial p}{\\partial \\sigma}\\right|_{x}=p_s(x)-p_{\\mathrm{top}}.\n$$\nWe compute $\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}$ from the definition of $\\sigma(x,z)$ while keeping $z$ fixed. Observe that $p(x,z)=p(z)$ (independent of $x$) implies $\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=0$ in the continuous analytic field, but writing the chain rule is instructive to identify cancellation. Differentiating $\\sigma(x,z)=\\frac{p(z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}$ at fixed $z$ yields\n$$\n\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}=-\\frac{p(z)-p_{\\mathrm{top}}}{\\left(p_s(x)-p_{\\mathrm{top}}\\right)^2}\\,\\frac{\\partial p_s}{\\partial x}=-\\frac{\\sigma}{p_s(x)-p_{\\mathrm{top}}}\\,\\frac{\\partial p_s}{\\partial x}.\n$$\nCombining the terms,\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=\\sigma \\frac{\\partial p_s}{\\partial x} + \\left(p_s(x)-p_{\\mathrm{top}}\\right)\\left(-\\frac{\\sigma}{p_s(x)-p_{\\mathrm{top}}}\\,\\frac{\\partial p_s}{\\partial x}\\right)=0.\n$$\nTherefore, in the continuous setting, the metric term exactly cancels the along-$\\sigma$ derivative term, yielding zero horizontal PGF at constant $z$ for the isothermal hydrostatic atmosphere, independent of slope $s$.\n\nIn a discrete terrain-following sigma-coordinate model that approximates the horizontal pressure gradient by centered finite differences along constant-$\\sigma$ surfaces and ignores the metric cancellation term, spurious acceleration appears. We construct the discrete approximation as follows:\n\n- Discretize $x\\in[0,L)$ with $N_x$ grid points $x_i=i\\,\\Delta x$, where $\\Delta x=L/N_x$, using periodic boundary conditions.\n- Discretize sigma with $N_\\sigma$ mid-layer levels $\\sigma_k=\\frac{k+\\tfrac{1}{2}}{N_\\sigma}$ for $k=0,1,\\dots,N_\\sigma-1$.\n- Compute $p_s(x_i)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{s\\,x_i}{H}\\right)$, with $H=\\frac{R T_0}{g}$.\n- Compute $p(x_i,\\sigma_k)=p_{\\mathrm{top}}+\\sigma_k\\left(p_s(x_i)-p_{\\mathrm{top}}\\right)$ and $\\rho(x_i,\\sigma_k)=\\frac{p(x_i,\\sigma_k)}{R T_0}$.\n- Approximate the horizontal derivative at constant $\\sigma_k$ by centered finite differences with periodic boundaries:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\bigg|_{x_i}\\approx \\frac{p(x_{i+1},\\sigma_k)-p(x_{i-1},\\sigma_k)}{2\\Delta x},\n$$\nwith indices taken modulo $N_x$ for periodicity.\n- Define the discrete spurious acceleration (due solely to using the along-$\\sigma$ finite-difference approximation and omitting the metric term) by\n$$\na(x_i,\\sigma_k)=-\\frac{1}{\\rho(x_i,\\sigma_k)}\\,\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\bigg|_{x_i}.\n$$\n\nSince the true continuous PGF at constant $z$ is zero for the analytic state, any nonzero $a(x_i,\\sigma_k)$ computed by the above discrete approximation directly quantifies the spurious horizontal acceleration introduced by discretization on terrain-following surfaces.\n\nWe must report a single scalar per test case: the maximum absolute spurious acceleration over all discrete points,\n$$\nA_{\\max}=\\max_{0\\le i\\le N_x-1}\\max_{0\\le k\\le N_\\sigma-1}\\left|a(x_i,\\sigma_k)\\right|,\n$$\nin $\\mathrm{m/s^2}$.\n\nAlgorithmic steps:\n\n- For each test case, compute $H=\\frac{R T_0}{g}$, construct $x_i$, $p_s(x_i)$, $\\sigma_k$, $p(x_i,\\sigma_k)$, and $\\rho(x_i,\\sigma_k)$.\n- Compute the centered finite-difference approximation to $\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}$ at each $(i,k)$ with periodic boundaries.\n- Compute $a(x_i,\\sigma_k)$ and then $A_{\\max}$ as the maximum absolute value over all grid points.\n- Output the list $[A_{\\max}^{(1)},A_{\\max}^{(2)},A_{\\max}^{(3)},A_{\\max}^{(4)}]$ for the four specified cases, in $\\mathrm{m/s^2}$.\n\nSanity checks and expected behavior:\n\n- For $s=0$, we have $p_s(x)=p_{\\mathrm{ref}}$ for all $x$, hence $p(x,\\sigma)$ is constant in $x$ at each $\\sigma$, our finite-difference derivative is exactly zero, and thus $A_{\\max}=0$ (up to floating-point roundoff).\n- As $s$ increases, $p_s(x)$ varies more strongly with $x$, the centered difference of $p(x,\\sigma)$ along $\\sigma$ yields larger magnitude, and the spurious acceleration increases roughly proportionally to $s$, modulated by $\\sigma$ and the pressure variation with $x$.\n- Changing $N_\\sigma$ shifts which $\\sigma$ values are sampled; since $|a|$ increases with larger $\\sigma$ (closer to the surface) and with larger $p_s$, coarse vertical resolution may slightly alter the reported maximum depending on the sampled $\\sigma$ levels, but the fundamental spurious acceleration persists.\n\nAll computations use the specified $\\mathrm{SI}$ constants and units, and accelerations are reported in $\\mathrm{m/s^2}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_spurious_acceleration(L, s, Nx, Nz, g=9.81, R=287.0, T0=300.0, p_ref=100000.0, p_top=20000.0):\n    \"\"\"\n    Compute the maximum absolute spurious horizontal acceleration (in m/s^2)\n    arising from a naive discrete horizontal pressure gradient along constant-sigma\n    surfaces for an isothermal hydrostatic atmosphere over sloping terrain.\n    \"\"\"\n    # Scale height\n    H = R * T0 / g\n\n    # Grid\n    dx = L / Nx\n    x = np.arange(Nx) * dx  # periodic grid\n\n    # Terrain and surface pressure\n    z_s = s * x\n    p_s = p_ref * np.exp(-z_s / H)\n\n    # Sigma levels (mid-layer)\n    k = np.arange(Nz)\n    sigma = (k + 0.5) / Nz  # shape (Nz,)\n\n    # Build pressure field p(x_i, sigma_k) and density rho\n    # p(x, sigma) = p_top + sigma * (p_s(x) - p_top)\n    # We broadcast: x axis length Nx, sigma axis length Nz\n    p = p_top + np.outer(p_s - p_top, sigma)  # shape (Nx, Nz)\n    rho = p / (R * T0)\n\n    # Centered finite difference in x with periodic boundary conditions for each sigma level\n    # dp/dx at constant sigma\n    # We'll compute for all k simultaneously using roll\n    p_plus = np.roll(p, -1, axis=0)  # i+1\n    p_minus = np.roll(p, 1, axis=0)  # i-1\n    dpdx = (p_plus - p_minus) / (2.0 * dx)\n\n    # Spurious acceleration: a = -(1/rho) * dpdx\n    a = -(1.0 / rho) * dpdx\n\n    # Maximum absolute value over all i,k\n    A_max = np.max(np.abs(a))\n    return A_max\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (L [m], s [dimensionless slope], Nx, Nz)\n    test_cases = [\n        (100000.0, 0.01, 128, 30),  # Case 1\n        (100000.0, 0.0, 128, 30),   # Case 2 (boundary: zero slope)\n        (100000.0, 0.01, 128, 3),   # Case 3 (coarse vertical resolution)\n        (100000.0, 0.05, 128, 30),  # Case 4 (steeper slope)\n    ]\n\n    results = []\n    for case in test_cases:\n        L, s, Nx, Nz = case\n        A_max = compute_spurious_acceleration(L, s, Nx, Nz)\n        # Format to a reasonable precision\n        results.append(f\"{A_max:.10e}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having uncovered the limitations of pure sigma coordinates, the logical next step is to engineer a superior alternative. This practice guides you through the practical design of a hybrid sigma-pressure coordinate, a versatile framework employed in many state-of-the-art weather and climate models. You will construct the critical blending functions, $A(\\eta)$ and $B(\\eta)$, to satisfy key design objectives: smoothly transitioning from a terrain-following structure near the ground to pure pressure surfaces in the upper atmosphere, thereby mitigating the pressure gradient errors explored previously .",
            "id": "4089111",
            "problem": "A global primitive-equation Numerical Weather Prediction (NWP) model uses a hybrid sigma–pressure vertical coordinate. The hybrid coordinate is defined by the mapping $p(\\eta) = A(\\eta) + B(\\eta)\\,p_{s}$, where $p(\\eta)$ is the pressure at hybrid coordinate $0 \\leq \\eta \\leq 1$, $A(\\eta)$ and $B(\\eta)$ are smooth, monotonic functions, and $p_{s}$ is the model surface pressure. The sigma coordinate is recovered near the surface when $B(\\eta) \\approx 1$ and $A(\\eta) \\approx 0$, while pressure levels are fixed aloft when $B(\\eta) = 0$ and $A(\\eta)$ prescribes the target pressure profile. Let the top-of-atmosphere pressure be $p_{\\mathrm{top}} = 50\\,\\mathrm{hPa}$ at $\\eta = 0$. To maintain terrain-following structure near the surface while constraining upper levels to prescribed pressures, you are asked to design $A(\\eta)$ and $B(\\eta)$ with the following scientifically motivated constraints derived from well-tested practice in hybrid-coordinate models:\n\n1. Fixed-pressure upper layers: for $\\eta \\leq \\eta_{t}$ with $\\eta_{t} = 0.30$, require $B(\\eta) = 0$ so that $p(\\eta) = A(\\eta)$ matches prescribed target pressures at the three upper-level points\n   - $(\\eta_{0}, p_{0}) = (0.00, 50\\,\\mathrm{hPa})$,\n   - $(\\eta_{1}, p_{1}) = (0.15, 180\\,\\mathrm{hPa})$,\n   - $(\\eta_{2}, p_{2}) = (0.30, 320\\,\\mathrm{hPa})$.\n   Assume the minimal-degree polynomial form for the aloft reference $A(\\eta)$ that exactly fits these three points.\n\n2. Terrain-following near the surface and smooth transition: for $\\eta_{t} < \\eta \\leq 1$, require $B(\\eta)$ to increase smoothly from $0$ at $\\eta = \\eta_{t}$ to $1$ at $\\eta = 1$, with zero first and second derivatives at both ends to suppress spurious vertical pressure-gradient accelerations. Let the transition be expressed using a nondimensional blend coordinate $s = \\dfrac{\\eta - \\eta_{t}}{1 - \\eta_{t}} \\in [0,1]$, and take $B(\\eta)$ to be the minimal-degree polynomial in $s$ that satisfies\n   - $B(\\eta_{t}) = 0$, $B(1) = 1$, $B'(\\eta_{t}) = 0$, $B'(1) = 0$, $B''(\\eta_{t}) = 0$, $B''(1) = 0$,\n   where primes denote differentiation with respect to $\\eta$ via $s(\\eta)$.\n\n3. To ensure that $A(\\eta)$ vanishes at the surface and the mapping continuously approaches the sigma limit, blend the aloft reference profile into the terrain-following form by setting $A(\\eta) = \\bar{A}(\\eta)\\,\\bigl(1 - B(\\eta)\\bigr)$ for all $\\eta$, where $\\bar{A}(\\eta)$ is the minimal-degree polynomial determined in item 1.\n\nStarting from the fundamental sigma definition $\\,\\sigma = p/p_{s}\\,$ and the hybrid mapping $\\,p(\\eta) = A(\\eta) + B(\\eta)\\,p_{s}\\,$, derive closed-form expressions for $A(\\eta)$ and $B(\\eta)$ that satisfy the above constraints. Then, for a column with surface pressure $p_{s} = 950\\,\\mathrm{hPa}$, compute the resulting pressure $p(\\eta)$ at $\\eta = 0.65$. Express your final value in $\\mathrm{hPa}$ and round your answer to four significant figures.",
            "solution": "The starting point is the definition of the sigma coordinate $\\sigma = p/p_{s}$ and the hybrid sigma–pressure mapping $p(\\eta) = A(\\eta) + B(\\eta)\\,p_{s}$. In the aloft fixed-pressure regime, $B(\\eta) = 0$ and $p(\\eta) = A(\\eta)$; near the surface, terrain-following behavior requires $B(\\eta) \\to 1$ and $A(\\eta) \\to 0$. We must design $A(\\eta)$ and $B(\\eta)$ to meet the constraints.\n\nStep 1: Construct the aloft reference profile $\\bar{A}(\\eta)$ that matches the prescribed upper-level targets.\n\nWe seek the minimal-degree polynomial $\\bar{A}(\\eta)$ that fits the three points $(\\eta_{0}, p_{0}) = (0.00, 50)$, $(\\eta_{1}, p_{1}) = (0.15, 180)$, $(\\eta_{2}, p_{2}) = (0.30, 320)$, all in $\\mathrm{hPa}$. The minimal-degree polynomial passing through three points is quadratic:\n$$\n\\bar{A}(\\eta) = \\alpha_{0} + \\alpha_{1}\\,\\eta + \\alpha_{2}\\,\\eta^{2}.\n$$\nImpose the interpolation conditions:\n$$\n\\begin{aligned}\n\\bar{A}(0.00) &= \\alpha_{0} = 50, \\\\\n\\bar{A}(0.15) &= \\alpha_{0} + 0.15\\,\\alpha_{1} + 0.0225\\,\\alpha_{2} = 180, \\\\\n\\bar{A}(0.30) &= \\alpha_{0} + 0.30\\,\\alpha_{1} + 0.09\\,\\alpha_{2} = 320.\n\\end{aligned}\n$$\nSet $\\alpha_{0} = 50$ from the first equation. The remaining linear system is\n$$\n\\begin{aligned}\n0.15\\,\\alpha_{1} + 0.0225\\,\\alpha_{2} &= 130, \\\\\n0.30\\,\\alpha_{1} + 0.09\\,\\alpha_{2} &= 270.\n\\end{aligned}\n$$\nMultiply the first equation by $2$ to obtain $0.30\\,\\alpha_{1} + 0.045\\,\\alpha_{2} = 260$ and subtract from the second to get $0.045\\,\\alpha_{2} = 10$, hence\n$$\n\\alpha_{2} = \\frac{10}{0.045} = \\frac{2000}{9}.\n$$\nThen\n$$\n0.15\\,\\alpha_{1} + 0.0225\\,\\alpha_{2} = 130 \\quad \\Rightarrow \\quad 0.15\\,\\alpha_{1} + 0.0225\\cdot\\frac{2000}{9} = 130.\n$$\nCompute the second term: $0.0225\\cdot\\frac{2000}{9} = \\frac{45}{2000}\\cdot\\frac{2000}{9}$ is more cleanly evaluated as $0.0225 \\times 222.\\overline{2} = 5$, yielding\n$$\n0.15\\,\\alpha_{1} + 5 = 130 \\quad \\Rightarrow \\quad \\alpha_{1} = \\frac{125}{0.15} = \\frac{2500}{3}.\n$$\nThus,\n$$\n\\bar{A}(\\eta) = 50 + \\frac{2500}{3}\\,\\eta + \\frac{2000}{9}\\,\\eta^{2}.\n$$\n\nStep 2: Derive the smooth transition function $B(\\eta)$.\n\nWe require $B(\\eta) = 0$ for $\\eta \\leq \\eta_{t}$, and $B(\\eta)$ transitions smoothly to $1$ at $\\eta = 1$ with zero first and second derivatives at both ends of the transition. Define the nondimensional blend coordinate\n$$\ns = \\frac{\\eta - \\eta_{t}}{1 - \\eta_{t}}, \\quad \\text{so that} \\quad s \\in [0,1] \\ \\text{for}\\ \\eta \\in [\\eta_{t}, 1].\n$$\nWe seek the minimal-degree polynomial in $s$ that meets six conditions:\n$$\nB(\\eta_{t}) = 0,\\quad B(1) = 1,\\quad B'(\\eta_{t}) = 0,\\quad B'(1) = 0,\\quad B''(\\eta_{t}) = 0,\\quad B''(1) = 0.\n$$\nThe minimal-degree polynomial that can satisfy six independent linear conditions is quintic. Let\n$$\nB(\\eta) \\equiv S(s) = a\\,s^{5} + b\\,s^{4} + c\\,s^{3} + d\\,s^{2} + e\\,s + f.\n$$\nImpose the endpoint constraints at $s=0$ (i.e., $\\eta=\\eta_{t}$) and $s=1$ (i.e., $\\eta=1$). At $s=0$:\n$$\nS(0) = f = 0,\\quad S'(0) = e = 0,\\quad S''(0) = 2d = 0 \\Rightarrow d = 0.\n$$\nAt $s=1$:\n$$\nS(1) = a + b + c = 1, \\\\\nS'(1) = 5a + 4b + 3c = 0, \\\\\nS''(1) = 20a + 12b + 6c = 0.\n$$\nSolve for $a$, $b$, and $c$. Subtract the $S'(1)$ equation from half of the $S''(1)$ equation:\n$$\n\\frac{1}{2}S''(1) - S'(1):\\quad (10a + 6b + 3c) - (5a + 4b + 3c) = 0 \\Rightarrow 5a + 2b = 0 \\Rightarrow b = -\\frac{5}{2}\\,a.\n$$\nPlug into $S'(1)$:\n$$\n5a + 4\\left(-\\frac{5}{2}a\\right) + 3c = 0 \\Rightarrow 5a - 10a + 3c = 0 \\Rightarrow c = \\frac{5}{3}\\,a.\n$$\nUse $S(1)$:\n$$\na + b + c = a - \\frac{5}{2}a + \\frac{5}{3}a = a\\left(1 - \\frac{5}{2} + \\frac{5}{3}\\right) = a\\left(\\frac{6 - 15 + 10}{6}\\right) = a\\left(\\frac{1}{6}\\right) = 1,\n$$\nwhich yields $a = 6$. Therefore,\n$$\nb = -15,\\quad c = 10,\n$$\nand the smoothstep function is\n$$\nB(\\eta) =\n\\begin{cases}\n0, & \\eta \\leq \\eta_{t}, \\\\\n6s^{5} - 15s^{4} + 10s^{3}, & \\eta_{t} < \\eta < 1,\\ \\ s = \\dfrac{\\eta - \\eta_{t}}{1 - \\eta_{t}}, \\\\\n1, & \\eta = 1.\n\\end{cases}\n$$\n\nStep 3: Blend $\\bar{A}(\\eta)$ into the terrain-following form and form $A(\\eta)$.\n\nTo ensure $A(\\eta)$ vanishes at the surface and equals $\\bar{A}(\\eta)$ at the start of the transition, set\n$$\nA(\\eta) = \\bar{A}(\\eta)\\,\\bigl(1 - B(\\eta)\\bigr).\n$$\nThis guarantees\n$$\nA(\\eta_{t}) = \\bar{A}(\\eta_{t})\\,(1 - 0) = \\bar{A}(\\eta_{t}),\\quad A(1) = \\bar{A}(1)\\,(1 - 1) = 0,\n$$\nand provides continuous first and second derivatives given the smoothness of $B(\\eta)$.\n\nStep 4: Evaluate $p(\\eta)$ at $\\eta = 0.65$ for $p_{s} = 950\\,\\mathrm{hPa}$.\n\nCompute the blend coordinate $s$ for $\\eta = 0.65$ with $\\eta_{t} = 0.30$:\n$$\ns = \\frac{0.65 - 0.30}{1 - 0.30} = \\frac{0.35}{0.70} = 0.5.\n$$\nEvaluate $B(\\eta)$ via $S(s)$ at $s = 0.5$:\n$$\nS(0.5) = 6\\left(\\frac{1}{32}\\right) - 15\\left(\\frac{1}{16}\\right) + 10\\left(\\frac{1}{8}\\right) = \\frac{6}{32} - \\frac{15}{16} + \\frac{10}{8} = \\frac{3}{16} - \\frac{15}{16} + \\frac{5}{4} = -\\frac{12}{16} + \\frac{5}{4} = -\\frac{3}{4} + \\frac{5}{4} = \\frac{1}{2}.\n$$\nThus, $B(0.65) = \\frac{1}{2}$ and $1 - B(0.65) = \\frac{1}{2}$.\n\nEvaluate $\\bar{A}(\\eta)$ at $\\eta = 0.65$. Use exact fractional arithmetic: $\\eta = 0.65 = \\frac{13}{20}$ and $\\eta^{2} = \\frac{169}{400}$. Recall\n$$\n\\bar{A}(\\eta) = 50 + \\frac{2500}{3}\\,\\eta + \\frac{2000}{9}\\,\\eta^{2}.\n$$\nCompute the terms:\n$$\n\\frac{2500}{3}\\,\\eta = \\frac{2500}{3}\\cdot\\frac{13}{20} = \\frac{1625}{3},\\quad \\frac{2000}{9}\\,\\eta^{2} = \\frac{2000}{9}\\cdot\\frac{169}{400} = \\frac{845}{9}.\n$$\nSum with $50$:\n$$\n\\bar{A}(0.65) = 50 + \\frac{1625}{3} + \\frac{845}{9} = \\frac{450}{9} + \\frac{4875}{9} + \\frac{845}{9} = \\frac{6170}{9}.\n$$\nNow blend to obtain $A(0.65)$:\n$$\nA(0.65) = \\bar{A}(0.65)\\,\\bigl(1 - B(0.65)\\bigr) = \\frac{6170}{9}\\cdot\\frac{1}{2} = \\frac{6170}{18}.\n$$\nFinally, compute the pressure:\n$$\np(0.65) = A(0.65) + B(0.65)\\,p_{s} = \\frac{6170}{18} + \\frac{1}{2}\\cdot 950 = \\frac{6170}{18} + 475 = \\frac{6170 + 8550}{18} = \\frac{14720}{18} = \\frac{7360}{9}\\ \\mathrm{hPa}.\n$$\nAs a decimal, $\\frac{7360}{9} \\approx 817.777\\ldots\\,\\mathrm{hPa}$. Rounded to four significant figures, this is $817.8\\,\\mathrm{hPa}$.\n\nTherefore, the derived closed-form expressions are\n$$\n\\bar{A}(\\eta) = 50 + \\frac{2500}{3}\\,\\eta + \\frac{2000}{9}\\,\\eta^{2},\\quad B(\\eta) =\n\\begin{cases}\n0, & \\eta \\leq 0.30, \\\\\n6s^{5} - 15s^{4} + 10s^{3}, & 0.30 < \\eta < 1,\\ \\ s = \\dfrac{\\eta - 0.30}{0.70}, \\\\\n1, & \\eta = 1,\n\\end{cases}\n$$\nand $A(\\eta) = \\bar{A}(\\eta)\\,\\bigl(1 - B(\\eta)\\bigr)$, which together yield $p(0.65)$ for $p_{s} = 950\\,\\mathrm{hPa}$ as computed above.",
            "answer": "$$\\boxed{817.8}$$"
        },
        {
            "introduction": "The final and most crucial step in our exploration is to verify that the hybrid coordinate system performs as intended. This practice establishes a direct, quantitative comparison between the pure sigma and hybrid coordinate frameworks over an idealized mountain. By implementing both systems and calculating the resulting spurious horizontal accelerations, you will witness firsthand the significant reduction in pressure gradient force error that the hybrid coordinate provides, solidifying your understanding of its practical advantages in numerical modeling .",
            "id": "4089087",
            "problem": "Consider an idealized, hydrostatic, dry atmosphere at rest over a two-dimensional mountain ridge in the context of Numerical Weather Prediction (NWP) and climate modeling. Let the horizontal coordinate be $x$ (in meters), and the vertical coordinate be a terrain-following variable $\\eta \\in [0,1]$, with $\\eta = 0$ at the model top and $\\eta = 1$ at the surface. The surface elevation is specified by the function $h(x)$ (in meters). Assume a horizontally uniform, isothermal temperature $T$ (in Kelvin), constant gravitational acceleration $g$ (in meters per second squared), and the dry-air gas constant $R_d$ (in Joules per kilogram per Kelvin). The reference sea-level pressure is $p_0$ (in Pascals), and the model top pressure is $p_{\\mathrm{top}}$ (in Pascals). Define the scale height $H = R_d T / g$ (in meters).\n\nUnder hydrostatic balance and the Ideal Gas Law, the surface pressure varies with elevation as\n$$\np_s(x) = p_0 \\exp\\!\\left(-\\frac{h(x)}{H}\\right).\n$$\nDefine the Gaussian mountain ridge profile\n$$\nh(x) = h_0 \\exp\\!\\left(-\\left(\\frac{x}{w}\\right)^2\\right),\n$$\nwhere $h_0$ (in meters) is the peak height, and $w$ (in meters) is the half-width parameter controlling the ridge sharpness.\n\nConsider two vertical coordinate formulations:\n\n1. Pure sigma coordinate:\n$$\np_{\\sigma}(x,\\eta) = p_{\\mathrm{top}} + \\eta \\left(p_s(x) - p_{\\mathrm{top}}\\right).\n$$\n\n2. Hybrid sigma-pressure coordinate:\n$$\np_{\\mathrm{hyb}}(x,\\eta) = A(\\eta) + B(\\eta)\\, p_s(x),\n$$\nwith the following choice that yields equidistant pressure levels above a transition $\\eta_c \\in (0,1)$:\n- For $0 \\le \\eta \\le \\eta_c$,\n$$\nB(\\eta)=0, \\quad A(\\eta) = p_{\\mathrm{top}} + \\frac{\\eta}{\\eta_c} \\left(p_c - p_{\\mathrm{top}}\\right),\n$$\nwhich produces linearly spaced pressure levels between $p_{\\mathrm{top}}$ and a specified transition pressure $p_c$ (in Pascals).\n- For $\\eta_c \\le \\eta \\le 1$,\n$$\nB(\\eta) = \\frac{\\eta - \\eta_c}{1 - \\eta_c}, \\quad A(\\eta) = p_{\\mathrm{top}} + \\left(p_c - p_{\\mathrm{top}}\\right) - p_c \\frac{\\eta - \\eta_c}{1 - \\eta_c}.\n$$\nThis construction ensures continuity at $\\eta_c$ with $p(\\eta_c)=p_c$, and enforces $p(1)=p_s(x)$ and $p(0)=p_{\\mathrm{top}}$.\n\nLet the geopotential (in square meters per second squared) at a given pressure be defined by the hydrostatic relation for an isothermal atmosphere:\n$$\n\\Phi(x,\\eta) = g\\, z(x,\\eta) = R_d\\, T \\ln\\!\\left(\\frac{p_0}{p(x,\\eta)}\\right),\n$$\nwhere $p(x,\\eta)$ is either $p_{\\sigma}(x,\\eta)$ or $p_{\\mathrm{hyb}}(x,\\eta)$, and $z(x,\\eta)$ is the geometric height of the pressure level.\n\nAssume a naïve discrete evaluation of the horizontal pressure-gradient term at constant $\\eta$ using a second-order central difference on a uniform grid with spacing $\\Delta x$ (in meters):\n$$\na_i(\\eta) = -\\frac{\\Phi_{i+1}(\\eta) - \\Phi_{i-1}(\\eta)}{2\\, \\Delta x},\n$$\nwhich yields an acceleration (in meters per second squared). In the physically correct, horizontally uniform resting isothermal atmosphere, the true horizontal acceleration should be $0$; any nonzero $a_i(\\eta)$ computed by this naïve terrain-following discretization is a terrain-induced pressure-gradient error.\n\nDefine the root-mean-square (RMS) terrain-induced acceleration error across all interior horizontal grid points $i$ and across all discrete vertical levels $\\eta_k$, for a given coordinate system, as\n$$\nE = \\sqrt{\\frac{1}{N_{\\mathrm{lev}}\\, N_{\\mathrm{int}}} \\sum_{k=1}^{N_{\\mathrm{lev}}} \\sum_{i \\in \\mathcal{I}} \\left(a_i(\\eta_k)\\right)^2},\n$$\nwhere $N_{\\mathrm{lev}}$ is the number of vertical levels, $\\mathcal{I}$ denotes the set of interior horizontal indices (excluding boundary points for the central difference), and $N_{\\mathrm{int}} = |\\mathcal{I}|$ is the number of interior points. Let $E_{\\sigma}$ denote this RMS error computed with $p_{\\sigma}$, and $E_{\\mathrm{hyb}}$ denote the RMS error computed with $p_{\\mathrm{hyb}}$.\n\nYour task is to compute the reduction in terrain-induced pressure-gradient errors due to the hybrid sigma-pressure choice, quantified by the dimensionless ratio\n$$\n\\mathcal{R} = \\frac{E_{\\mathrm{hyb}}}{E_{\\sigma}}.\n$$\nWhen $E_{\\sigma}$ is numerically zero, set $\\mathcal{R} = 0$ if $E_{\\mathrm{hyb}}$ is also numerically zero; otherwise set $\\mathcal{R}$ to a large sentinel value (e.g., $10^9$) to indicate a pathological case.\n\nImplement a complete program that:\n- Constructs a one-dimensional horizontal grid over $x \\in [-L, L]$ with uniform spacing $\\Delta x$ and $N_x = 2L/\\Delta x + 1$ points, where $L$ is a fixed domain half-length (in meters).\n- Constructs $N_{\\mathrm{lev}}$ uniformly spaced vertical levels in $\\eta \\in [0,1]$ including endpoints.\n- Computes $p_s(x)$, $p_{\\sigma}(x,\\eta)$, $p_{\\mathrm{hyb}}(x,\\eta)$, and the corresponding $\\Phi(x,\\eta)$ fields.\n- Computes $a_i(\\eta)$ using the central difference across interior points.\n- Computes $E_{\\sigma}$, $E_{\\mathrm{hyb}}$, and the ratio $\\mathcal{R}$.\n\nUse the following fixed physical parameters in your calculations:\n- $R_d = 287\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $g = 9.81\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$,\n- $T = 280\\ \\mathrm{K}$,\n- $p_0 = 101325\\ \\mathrm{Pa}$,\n- Transition pressure $p_c = 70000\\ \\mathrm{Pa}$,\n- Domain half-length $L = 200000\\ \\mathrm{m}$,\n- Number of vertical levels $N_{\\mathrm{lev}} = 30$.\n\nDesign a test suite of six parameter sets, each specified by $(h_0, w, \\Delta x, \\eta_c, p_{\\mathrm{top}})$:\n1. $(1500,\\ 20000,\\ 2000,\\ 0.7,\\ 10000)$ happy-path moderate mountain and standard transition.\n2. $(0,\\ 20000,\\ 2000,\\ 0.7,\\ 10000)$ flat terrain boundary case (expect essentially zero errors).\n3. $(2500,\\ 10000,\\ 1000,\\ 0.7,\\ 10000)$ steep and narrow ridge.\n4. $(1500,\\ 20000,\\ 2000,\\ 0.95,\\ 10000)$ transition very close to the surface (mostly pressure-based aloft).\n5. $(1500,\\ 20000,\\ 2000,\\ 0.15,\\ 10000)$ transition close to the top (mostly sigma-like).\n6. $(1500,\\ 20000,\\ 2000,\\ 0.7,\\ 30000)$ higher model top pressure.\n\nFor all computations, express acceleration in $\\mathrm{m}\\,\\mathrm{s}^{-2}$. The final required output of your program is a single line containing the six $\\mathcal{R}$ values for the test suite as a comma-separated list enclosed in square brackets, for example, \"[r1,r2,r3,r4,r5,r6]\". Each $r_j$ must be a floating-point number.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5,result6]\").",
            "solution": "The problem is validated as scientifically sound, well-posed, objective, and self-contained. All necessary equations, parameters, and numerical procedures are provided to compute a unique, verifiable solution. The underlying physical and numerical concepts are standard in atmospheric modeling. We may, therefore, proceed with the solution.\n\nThe objective is to quantify the reduction in the numerical pressure-gradient force (PGF) error when transitioning from a pure sigma ($\\sigma$) coordinate system to a hybrid sigma-pressure coordinate system. This error is a well-known artifact in terrain-following coordinate models, arising from the finite-difference approximation of two large, nearly-canceling terms in the PGF calculation. A physically correct model of a resting, hydrostatic atmosphere should yield zero horizontal acceleration, so any computed non-zero acceleration is a numerical error. We will compute the ratio of the root-mean-square (RMS) acceleration error of the hybrid system to that of the pure sigma system, $\\mathcal{R} = E_{\\mathrm{hyb}} / E_{\\sigma}$.\n\nThe solution methodology involves the following sequential steps for each provided test case:\n\nFirst, we establish the physical and numerical environment. The fundamental physical constants are given as $R_d = 287\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ (dry-air gas constant), $g = 9.81\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$ (gravitational acceleration), $T = 280\\ \\mathrm{K}$ (isothermal temperature), and $p_0 = 101325\\ \\mathrm{Pa}$ (reference sea-level pressure). From these, we compute the atmospheric scale height, $H = R_d T / g$. The numerical domain is a two-dimensional grid spanning the horizontal coordinate $x$ and the vertical coordinate $\\eta$. The horizontal grid for $x$ is defined over the domain $[-L, L]$ with $L = 200000\\ \\mathrm{m}$, using a uniform spacing $\\Delta x$ which varies per test case. The number of horizontal grid points is $N_x = 2L/\\Delta x + 1$. The vertical grid for $\\eta$ consists of $N_{\\mathrm{lev}} = 30$ uniformly spaced levels from $\\eta=0$ (model top) to $\\eta=1$ (surface), inclusive.\n\nSecond, we define the surface topography and the corresponding surface pressure. The mountain ridge is modeled by a Gaussian profile, $h(x) = h_0 \\exp(-(x/w)^2)$, where $h_0$ and $w$ are test-case-specific parameters. Under the assumptions of a hydrostatic and isothermal atmosphere, the surface pressure $p_s(x)$ is calculated as $p_s(x) = p_0 \\exp(-h(x)/H)$. This computation yields a one-dimensional array of surface pressure values corresponding to each point on the horizontal grid.\n\nThird, we construct the full two-dimensional pressure fields, $p(x, \\eta)$, for both coordinate systems. These fields are represented by arrays of dimension $(N_{\\mathrm{lev}}, N_x)$.\nFor the pure sigma coordinate system, the pressure at each grid point is given by a linear interpolation in pressure between the surface and the model top:\n$$\np_{\\sigma}(x,\\eta) = p_{\\mathrm{top}} + \\eta \\left(p_s(x) - p_{\\mathrm{top}}\\right)\n$$\nFor the hybrid sigma-pressure coordinate system, the pressure is defined as $p_{\\mathrm{hyb}}(x,\\eta) = A(\\eta) + B(\\eta) p_s(x)$. The coefficients $A(\\eta)$ and $B(\\eta)$ are defined piecewise to create a smooth transition from a pure pressure coordinate system aloft to a terrain-following system near the surface. The transition occurs at level $\\eta_c$ and pressure $p_c=70000\\ \\mathrm{Pa}$.\nFor levels above the transition ($0 \\le \\eta \\le \\eta_c$), the coordinate is purely pressure-based:\n$$\nB(\\eta)=0, \\quad A(\\eta) = p_{\\mathrm{top}} + \\frac{\\eta}{\\eta_c} \\left(p_c - p_{\\mathrm{top}}\\right)\n$$\nFor levels below the transition ($\\eta_c < \\eta \\le 1$), the coordinate is a hybrid:\n$$\nB(\\eta) = \\frac{\\eta - \\eta_c}{1 - \\eta_c}, \\quad A(\\eta) = p_{\\mathrm{top}} + \\left(p_c - p_{\\mathrm{top}}\\right) - p_c \\frac{\\eta - \\eta_c}{1 - \\eta_c}\n$$\nThese formulations result in two distinct pressure fields, $p_{\\sigma}$ and $p_{\\mathrm{hyb}}$, on the $(x, \\eta)$ grid.\n\nFourth, we calculate the geopotential field $\\Phi(x, \\eta)$. For an isothermal atmosphere, the geopotential is related to pressure by the hypsometric equation integrated from sea level, yielding:\n$$\n\\Phi(x,\\eta) = R_d T \\ln\\left(\\frac{p_0}{p(x,\\eta)}\\right) = H g \\ln\\left(\\frac{p_0}{p(x,\\eta)}\\right)\n$$\nThis calculation is performed for both pressure fields, producing $\\Phi_{\\sigma}(x, \\eta)$ and $\\Phi_{\\mathrm{hyb}}(x, \\eta)$.\n\nFifth, we compute the terrain-induced horizontal acceleration error. This error, $a_i(\\eta)$, is calculated at each vertical level $\\eta_k$ and at each interior horizontal grid point $i$ using a second-order central finite-difference approximation of the horizontal geopotential gradient on a constant $\\eta$ surface:\n$$\na_i(\\eta) = -\\frac{\\Phi_{i+1}(\\eta) - \\Phi_{i-1}(\\eta)}{2 \\Delta x}\n$$\nThis operation is applied to both geopotential fields, $\\Phi_{\\sigma}$ and $\\Phi_{\\mathrm{hyb}}$, yielding two error fields, $a_{\\sigma}$ and $a_{\\mathrm{hyb}}$, defined on the interior of the domain.\n\nFinally, we quantify and compare the total error for each system. The root-mean-square (RMS) error is calculated over all interior horizontal points and all vertical levels:\n$$\nE = \\sqrt{\\frac{1}{N_{\\mathrm{lev}} N_{\\mathrm{int}}} \\sum_{k=1}^{N_{\\mathrm{lev}}} \\sum_{i \\in \\mathcal{I}} \\left(a_i(\\eta_k)\\right)^2}\n$$\nwhere $N_{\\mathrm{int}} = N_x - 2$ is the number of interior horizontal points. This yields the RMS errors $E_{\\sigma}$ and $E_{\\mathrm{hyb}}$. The final metric is their ratio, $\\mathcal{R} = E_{\\mathrm{hyb}} / E_{\\sigma}$. A special case is handled for flat terrain ($h_0=0$), where both errors are expected to be numerically zero; in this instance, $\\mathcal{R}$ is set to $0$. If $E_{\\sigma}$ is numerically zero but $E_{\\mathrm{hyb}}$ is not, $\\mathcal{R}$ is set to a large sentinel value ($10^9$), though this is not expected to occur. This entire procedure is repeated for each of the six test cases specified in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_r(params):\n    \"\"\"\n    Calculates the ratio of terrain-induced pressure-gradient errors for a single test case.\n    \"\"\"\n    h0, w, delta_x, eta_c, p_top = params\n\n    # Fixed physical parameters\n    R_d = 287.0\n    g = 9.81\n    T = 280.0\n    p0 = 101325.0\n    pc = 70000.0\n    L = 200000.0\n    N_lev = 30\n\n    # Scale height\n    H = R_d * T / g\n\n    # Numerical grids\n    Nx = int(2 * L / delta_x) + 1\n    x = np.linspace(-L, L, Nx)\n    eta = np.linspace(0, 1, N_lev)\n\n    # Surface fields\n    h = h0 * np.exp(-(x / w)**2)\n    ps = p0 * np.exp(-h / H)\n\n    # Reshape for broadcasting\n    eta_col = eta.reshape(-1, 1)\n    ps_row = ps.reshape(1, -1)\n\n    # --- Pure Sigma Coordinate Calculation ---\n    p_sigma = p_top + eta_col * (ps_row - p_top)\n    \n    # --- Hybrid Sigma-Pressure Coordinate Calculation ---\n    A = np.zeros(N_lev)\n    B = np.zeros(N_lev)\n\n    # Region 1: 0 <= eta <= eta_c\n    mask_lower = eta <= eta_c\n    B[mask_lower] = 0.0\n    A[mask_lower] = p_top + (eta[mask_lower] / eta_c) * (pc - p_top)\n\n    # Region 2: eta_c < eta <= 1\n    mask_upper = eta > eta_c\n    if np.any(mask_upper):\n        term = (eta[mask_upper] - eta_c) / (1 - eta_c)\n        B[mask_upper] = term\n        A[mask_upper] = p_top + (pc - p_top) - pc * term\n\n    A_col = A.reshape(-1, 1)\n    B_col = B.reshape(-1, 1)\n    p_hyb = A_col + B_col * ps_row\n    \n    # --- Geopotential Field Calculation ---\n    # Note: Using np.log(p0) - np.log(p) is more stable than np.log(p0/p)\n    # but the problem statement implies the latter. Given inputs are safe.\n    phi_sigma = H * g * np.log(p0 / p_sigma)\n    phi_hyb = H * g * np.log(p0 / p_hyb)\n\n    # --- Acceleration Error Calculation ---\n    # Central difference on interior points\n    a_sigma = -(phi_sigma[:, 2:] - phi_sigma[:, :-2]) / (2 * delta_x)\n    a_hyb = -(phi_hyb[:, 2:] - phi_hyb[:, :-2]) / (2 * delta_x)\n\n    # --- RMS Error Calculation ---\n    E_sigma = np.sqrt(np.mean(a_sigma**2))\n    E_hyb = np.sqrt(np.mean(a_hyb**2))\n\n    # --- Ratio Calculation with special case handling ---\n    zero_tol = 1e-15\n    if E_sigma < zero_tol:\n        if E_hyb < zero_tol:\n            return 0.0\n        else:\n            return 1e9\n    else:\n        return E_hyb / E_sigma\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h0, w, delta_x, eta_c, p_top)\n        (1500, 20000, 2000, 0.7, 10000),  # 1. Happy-path moderate mountain\n        (0, 20000, 2000, 0.7, 10000),     # 2. Flat terrain boundary case\n        (2500, 10000, 1000, 0.7, 10000),  # 3. Steep and narrow ridge\n        (1500, 20000, 2000, 0.95, 10000), # 4. Transition very close to surface\n        (1500, 20000, 2000, 0.15, 10000), # 5. Transition close to top\n        (1500, 20000, 2000, 0.7, 30000),  # 6. Higher model top pressure\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_r(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}