{
    "hands_on_practices": [
        {
            "introduction": "To effectively work with terrain-following coordinates, one must be proficient in translating fundamental physical laws, like the hydrostatic balance, into the model's vertical coordinate system. This first exercise provides essential practice in this skill. Starting from first principles, you will derive an analytical expression for the geopotential difference between two layers in a hypothetical atmosphere defined by a hybrid coordinate, reinforcing the connection between the continuous equations and their application within a specific vertical grid structure .",
            "id": "4089053",
            "problem": "Consider a single vertical atmospheric column in a Numerical Weather Prediction (NWP) model that uses a hybrid sigma-pressure vertical coordinate $\\eta$. The hydrostatic balance, the definition of geopotential $\\Phi$, and the ideal gas law constitute the foundational base of this problem. Assume the atmosphere is hydrostatic, the gravitational acceleration $g$ is constant with height, and the air behaves as an ideal gas so that the specific volume $\\alpha$ satisfies $\\alpha = R T / p$, where $R$ is the specific gas constant for dry air, $T$ is the absolute temperature, and $p$ is the pressure.\n\nThe hybrid sigma-pressure mapping defines pressure as a function of the vertical coordinate $\\eta$ via a prescribed profile $p(\\eta)$. In this column, the pressure profile is chosen to be a special hybrid form $p(\\eta) = p_{s} \\exp(-\\beta \\eta)$, which corresponds to $A(\\eta) = 0$ and $B(\\eta) = \\exp(-\\beta \\eta)$ in the generic hybrid form $p(\\eta) = A(\\eta) + B(\\eta) p_{s}$. Here $p_{s} > 0$ is the column surface pressure and $\\beta > 0$ is a constant that controls the rate at which pressure decays with $\\eta$. The temperature profile is specified as $T(\\eta) = T_{0} + T_{1} \\eta$, where $T_{0} > 0$ and $T_{1}$ are constants.\n\nStarting from first principles (hydrostatic balance, the definition of geopotential, and the ideal gas law), derive a closed-form analytic expression for the geopotential difference between two hybrid layers at $\\eta_{1}$ and $\\eta_{2}$, namely $\\Phi(\\eta_{2}) - \\Phi(\\eta_{1})$, in terms of $R$, $\\beta$, $T_{0}$, $T_{1}$, $\\eta_{1}$, and $\\eta_{2}$.\n\nExpress the final answer in joules per kilogram (J kg$^{-1}$) and provide your result as a single closed-form analytic expression. No numerical values are to be substituted. Do not simplify to a numerical value. No rounding is required.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective, providing all necessary information to derive a unique solution based on fundamental principles of atmospheric science.\n\nThe derivation begins with the hydrostatic balance equation, which relates the change in pressure $p$ with a change in geometric height $z$. In a fluid at rest, the pressure gradient balances the force of gravity:\n$$\n\\frac{dp}{dz} = -\\rho g\n$$\nwhere $\\rho$ is the density of the air and $g$ is the acceleration due to gravity, assumed to be constant.\n\nThe geopotential $\\Phi$ is defined as the work done against gravity to lift a unit mass from sea level to a certain height $z$. Its differential is given by:\n$$\nd\\Phi = g \\, dz\n$$\nCombining these two equations allows us to relate the differential of geopotential to the differential of pressure. From the definition of geopotential, we have $dz = \\frac{d\\Phi}{g}$. Substituting this into the hydrostatic equation gives:\n$$\n\\frac{dp}{d\\Phi/g} = -\\rho g \\implies \\frac{dp}{d\\Phi} = -\\rho\n$$\nThe problem states that air is to be treated as an ideal gas. The ideal gas law for a specific volume $\\alpha = 1/\\rho$ is given by:\n$$\np\\alpha = RT\n$$\nwhere $R$ is the specific gas constant for dry air and $T$ is the absolute temperature. Thus, $\\rho = \\frac{p}{RT}$. Substituting this into our expression for the pressure gradient with respect to geopotential yields:\n$$\n\\frac{dp}{d\\Phi} = -\\frac{p}{RT}\n$$\nRearranging this equation provides a fundamental differential relationship between geopotential, temperature, and pressure:\n$$\nd\\Phi = -RT \\frac{dp}{p}\n$$\nThe objective is to find the geopotential difference $\\Phi(\\eta_2) - \\Phi(\\eta_1)$ between two levels defined by the hybrid vertical coordinate $\\eta$. To do this, we integrate $d\\Phi$. However, the variables on the right-hand side, $T$ and $p$, are given as functions of $\\eta$. Therefore, it is most convenient to change the variable of integration from $p$ or $\\Phi$ to $\\eta$.\n\nUsing the chain rule, we can express the derivative of geopotential with respect to the coordinate $\\eta$ as:\n$$\n\\frac{d\\Phi}{d\\eta} = \\frac{d\\Phi}{dp} \\frac{dp}{d\\eta}\n$$\nFrom the relation $d\\Phi = -RT \\frac{dp}{p}$, we can identify $\\frac{d\\Phi}{dp} = -\\frac{RT}{p}$.\n\nNext, we evaluate the term $\\frac{dp}{d\\eta}$. The pressure profile is given by:\n$$\np(\\eta) = p_{s} \\exp(-\\beta \\eta)\n$$\nDifferentiating $p$ with respect to $\\eta$ gives:\n$$\n\\frac{dp}{d\\eta} = p_{s} \\cdot \\exp(-\\beta \\eta) \\cdot (-\\beta) = -\\beta \\left( p_{s} \\exp(-\\beta \\eta) \\right) = -\\beta p(\\eta)\n$$\nSubstituting these derivatives back into the chain rule expression for $\\frac{d\\Phi}{d\\eta}$:\n$$\n\\frac{d\\Phi}{d\\eta} = \\left( -\\frac{RT}{p} \\right) (-\\beta p) = R\\beta T\n$$\nSince both $R$ and $\\beta$ are constants, the rate of change of geopotential with respect to the $\\eta$ coordinate is directly proportional to the temperature $T$.\n\nTo find the geopotential difference $\\Phi(\\eta_2) - \\Phi(\\eta_1)$, we integrate $\\frac{d\\Phi}{d\\eta}$ with respect to $\\eta$ from $\\eta_1$ to $\\eta_2$:\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = \\int_{\\eta_1}^{\\eta_2} \\frac{d\\Phi}{d\\eta} d\\eta = \\int_{\\eta_1}^{\\eta_2} R\\beta T(\\eta) d\\eta\n$$\nThe problem specifies the temperature profile as a linear function of $\\eta$:\n$$\nT(\\eta) = T_{0} + T_{1}\\eta\n$$\nSubstituting this into the integral:\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\int_{\\eta_1}^{\\eta_2} (T_{0} + T_{1}\\eta) d\\eta\n$$\nWe can now carry out the integration:\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\left[ T_{0}\\eta + \\frac{1}{2}T_{1}\\eta^2 \\right]_{\\eta_1}^{\\eta_2}\n$$\nEvaluating the expression at the limits of integration $\\eta_2$ and $\\eta_1$:\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\left( \\left( T_{0}\\eta_2 + \\frac{1}{2}T_{1}\\eta_2^2 \\right) - \\left( T_{0}\\eta_1 + \\frac{1}{2}T_{1}\\eta_1^2 \\right) \\right)\n$$\nFinally, we group the terms to obtain the closed-form analytic expression for the geopotential difference:\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\left( T_{0}(\\eta_2 - \\eta_1) + \\frac{1}{2}T_{1}(\\eta_2^2 - \\eta_1^2) \\right)\n$$\nThe units of this expression are $[J \\cdot kg^{-1} \\cdot K^{-1}] \\cdot [dimensionless] \\cdot ([K] \\cdot [dimensionless] + [K] \\cdot [dimensionless]^2) = [J \\cdot kg^{-1}]$, which are the correct units for geopotential.",
            "answer": "$$\n\\boxed{R \\beta \\left( T_{0}(\\eta_{2} - \\eta_{1}) + \\frac{1}{2} T_{1}(\\eta_{2}^{2} - \\eta_{1}^{2}) \\right)}\n$$"
        },
        {
            "introduction": "One of the most significant challenges in using pure sigma coordinates is the accurate calculation of the horizontal pressure gradient force (PGF) over sloped terrain. Because constant sigma surfaces are not level, a naive finite-difference approximation of the PGF can introduce significant, non-physical accelerations. This hands-on coding exercise  allows you to numerically quantify this spurious acceleration in a controlled, idealized setting, providing a concrete demonstration of a core problem that drove the development of more advanced vertical coordinates.",
            "id": "4089051",
            "problem": "Consider a dry, isothermal atmosphere used in Numerical Weather Prediction (NWP) and climate modeling, occupying a two-dimensional domain with horizontal coordinate $x$ and geometric height $z$. Let the atmosphere be in hydrostatic balance and governed by the Ideal Gas Law. The hydrostatic balance is $\\,\\frac{\\partial p}{\\partial z}=-\\rho g\\,$ and the Ideal Gas Law is $\\,p=\\rho R T\\,$, where $p$ is pressure, $\\rho$ is density, $g$ is gravitational acceleration, $R$ is the specific gas constant for dry air, and $T$ is absolute temperature. Assume an isothermal atmosphere with constant temperature $T=T_0$, and a reference pressure $p_{\\mathrm{ref}}$ at $z=0$.\n\nThe terrain height is given by $z_s(x)=s\\,x$ with constant slope parameter $s$, and the surface pressure is the hydrostatic value $p_s(x)=p_{\\mathrm{ref}}\\exp\\!\\left(-\\frac{z_s(x)}{H}\\right)$, where $H=\\frac{R T_0}{g}$ is the density scale height. Define the terrain-following sigma coordinate by $\\,\\sigma(x,z)=\\frac{p(x,z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}\\,$, where $p_{\\mathrm{top}}$ is the constant pressure at the model top. For any fixed $\\sigma$, define the hydrostatic state by $\\,p(x,\\sigma)=p_{\\mathrm{top}}+\\sigma\\big(p_s(x)-p_{\\mathrm{top}}\\big)\\,$ and $\\,\\rho(x,\\sigma)=\\frac{p(x,\\sigma)}{R T_0}\\,$ under the assumption of horizontal isothermality and hydrostatic balance.\n\nStarting from these foundations, address the following tasks:\n\n- Derive, from first principles and explicit application of hydrostatic balance and the Ideal Gas Law, the continuous expression for the horizontal pressure gradient force (PGF) at constant geometric height $z$, and explain why it vanishes for the specified isothermal hydrostatic state over sloping terrain (i.e., $\\,\\left.\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\right|_{z}=0\\,$ for all $x$ when the true $p$ depends only on $z$).\n- Construct a discrete approximation to the horizontal PGF using sigma coordinates by computing a centered finite-difference approximation to $\\,\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}\\,$ along constant-$\\sigma$ surfaces. Use a periodic domain in $x$ of length $L$ with $N_x$ equally spaced grid points and $N_\\sigma$ equally spaced sigma levels located at mid-layer positions $\\,\\sigma_k=\\frac{k+\\tfrac{1}{2}}{N_\\sigma}\\,$ for $k\\in\\{0,1,\\dots,N_\\sigma-1\\}$. Use centered finite differences with periodic boundary conditions for the horizontal derivative at each $\\sigma_k$. Quantify the resulting spurious horizontal acceleration as $\\,a(x,\\sigma_k)=-\\frac{1}{\\rho(x,\\sigma_k)}\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\,$, expressed in $\\mathrm{m/s^2}$.\n- Aggregate the discrete spurious acceleration over the two-dimensional grid by reporting the maximum absolute value $\\,\\max_{x,k}\\left|a(x,\\sigma_k)\\right|\\,$ in $\\mathrm{m/s^2}$.\n\nYour program must implement the above discrete construction and produce numerical results for the following test suite, each case defined by $[L,s,N_x,N_\\sigma]$, with fixed constants $\\,g=9.81\\,\\mathrm{m/s^2}\\,$, $\\,R=287\\,\\mathrm{J/(kg\\cdot K)}\\,$, $\\,T_0=300\\,\\mathrm{K}\\,$, $\\,p_{\\mathrm{ref}}=100000\\,\\mathrm{Pa}\\,$, and $\\,p_{\\mathrm{top}}=20000\\,\\mathrm{Pa}$:\n\n- Case $1$: $[L=100000\\,\\mathrm{m},\\,s=0.01,\\,N_x=128,\\,N_\\sigma=30]$.\n- Case $2$ (boundary condition check): $[L=100000\\,\\mathrm{m},\\,s=0,\\,N_x=128,\\,N_\\sigma=30]$.\n- Case $3$ (coarse vertical resolution): $[L=100000\\,\\mathrm{m},\\,s=0.01,\\,N_x=128,\\,N_\\sigma=3]$.\n- Case $4$ (steeper slope): $[L=100000\\,\\mathrm{m},\\,s=0.05,\\,N_x=128,\\,N_\\sigma=30]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[a_1,a_2,a_3,a_4]$), where $a_i$ is the maximum absolute spurious acceleration for Case $i$ in $\\mathrm{m/s^2}$, represented as floating-point numbers. Angles do not appear in this problem. There are no percentages in this problem; report floating-point values directly. All quantities must be computed in $\\mathrm{SI}$ units as given, and the final outputs must be in $\\mathrm{m/s^2}$.",
            "solution": "We begin from the hydrostatic balance and the Ideal Gas Law, the cornerstones of dry atmospheric thermodynamics used in Numerical Weather Prediction (NWP) and climate modeling. Hydrostatic balance states\n$$\n\\frac{\\partial p}{\\partial z}=-\\rho g,\n$$\nand the Ideal Gas Law states\n$$\np=\\rho R T.\n$$\nUnder the isothermal assumption $T=T_0$, we can combine the two to derive the classic exponential pressure profile. Substituting $\\rho=\\frac{p}{R T_0}$ into hydrostatic balance gives\n$$\n\\frac{\\partial p}{\\partial z}=-\\frac{p}{R T_0}\\,g=-\\frac{p}{H},\n$$\nwhere $H=\\frac{R T_0}{g}$ is the density scale height. Solving this ordinary differential equation with the boundary condition $p(0)=p_{\\mathrm{ref}}$ yields\n$$\np(z)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{z}{H}\\right).\n$$\nFor a sloping lower boundary $z_s(x)=s\\,x$, the surface pressure is obtained by evaluation at the terrain height:\n$$\np_s(x)=p\\big(z_s(x)\\big)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{s\\,x}{H}\\right).\n$$\n\nDefine the terrain-following sigma coordinate by\n$$\n\\sigma(x,z)=\\frac{p(x,z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}.\n$$\nFor a hydrostatic, isothermal atmosphere, one can construct a hydrostatic state on sigma surfaces by\n$$\np(x,\\sigma)=p_{\\mathrm{top}}+\\sigma\\left(p_s(x)-p_{\\mathrm{top}}\\right),\\qquad \\rho(x,\\sigma)=\\frac{p(x,\\sigma)}{R T_0}.\n$$\nIn this construction, the continuous atmospheric state in geometric height $z$ is horizontally uniform at fixed $z$ because $p(z)$ depends only on $z$; hence, the true horizontal pressure gradient at constant geometric height vanishes:\n$$\n\\left.\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\right|_{z}=0.\n$$\nTo see this formally, apply the chain rule. Consider $p$ as a function of $(x,\\sigma)$ with $\\sigma=\\sigma(x,z)$. The derivative at constant $z$ can be written as\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}+\\left.\\frac{\\partial p}{\\partial \\sigma}\\right|_{x}\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}.\n$$\nThe first term is the derivative along constant-$\\sigma$ surfaces,\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}=\\sigma \\frac{\\partial p_s}{\\partial x},\n$$\nbecause $p(x,\\sigma)=p_{\\mathrm{top}}+\\sigma(p_s(x)-p_{\\mathrm{top}})$ implies $\\frac{\\partial p}{\\partial x}\\big|_{\\sigma}=\\sigma \\frac{\\partial p_s}{\\partial x}$. The derivative with respect to $\\sigma$ at fixed $x$ is\n$$\n\\left.\\frac{\\partial p}{\\partial \\sigma}\\right|_{x}=p_s(x)-p_{\\mathrm{top}}.\n$$\nWe compute $\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}$ from the definition of $\\sigma(x,z)$ while keeping $z$ fixed. Observe that $p(x,z)=p(z)$ (independent of $x$) implies $\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=0$ in the continuous analytic field, but writing the chain rule is instructive to identify cancellation. Differentiating $\\sigma(x,z)=\\frac{p(z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}$ at fixed $z$ yields\n$$\n\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}=-\\frac{p(z)-p_{\\mathrm{top}}}{\\left(p_s(x)-p_{\\mathrm{top}}\\right)^2}\\,\\frac{\\partial p_s}{\\partial x}=-\\frac{\\sigma}{p_s(x)-p_{\\mathrm{top}}}\\,\\frac{\\partial p_s}{\\partial x}.\n$$\nCombining the terms,\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=\\sigma \\frac{\\partial p_s}{\\partial x} + \\left(p_s(x)-p_{\\mathrm{top}}\\right)\\left(-\\frac{\\sigma}{p_s(x)-p_{\\mathrm{top}}}\\,\\frac{\\partial p_s}{\\partial x}\\right)=0.\n$$\nTherefore, in the continuous setting, the metric term exactly cancels the along-$\\sigma$ derivative term, yielding zero horizontal PGF at constant $z$ for the isothermal hydrostatic atmosphere, independent of slope $s$.\n\nIn a discrete terrain-following sigma-coordinate model that approximates the horizontal pressure gradient by centered finite differences along constant-$\\sigma$ surfaces and ignores the metric cancellation term, spurious acceleration appears. We construct the discrete approximation as follows:\n\n- Discretize $x\\in[0,L)$ with $N_x$ grid points $x_i=i\\,\\Delta x$, where $\\Delta x=L/N_x$, using periodic boundary conditions.\n- Discretize sigma with $N_\\sigma$ mid-layer levels $\\sigma_k=\\frac{k+\\tfrac{1}{2}}{N_\\sigma}$ for $k=0,1,\\dots,N_\\sigma-1$.\n- Compute $p_s(x_i)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{s\\,x_i}{H}\\right)$, with $H=\\frac{R T_0}{g}$.\n- Compute $p(x_i,\\sigma_k)=p_{\\mathrm{top}}+\\sigma_k\\left(p_s(x_i)-p_{\\mathrm{top}}\\right)$ and $\\rho(x_i,\\sigma_k)=\\frac{p(x_i,\\sigma_k)}{R T_0}$.\n- Approximate the horizontal derivative at constant $\\sigma_k$ by centered finite differences with periodic boundaries:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\bigg|_{x_i}\\approx \\frac{p(x_{i+1},\\sigma_k)-p(x_{i-1},\\sigma_k)}{2\\Delta x},\n$$\nwith indices taken modulo $N_x$ for periodicity.\n- Define the discrete spurious acceleration (due solely to using the along-$\\sigma$ finite-difference approximation and omitting the metric term) by\n$$\na(x_i,\\sigma_k)=-\\frac{1}{\\rho(x_i,\\sigma_k)}\\,\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\bigg|_{x_i}.\n$$\n\nSince the true continuous PGF at constant $z$ is zero for the analytic state, any nonzero $a(x_i,\\sigma_k)$ computed by the above discrete approximation directly quantifies the spurious horizontal acceleration introduced by discretization on terrain-following surfaces.\n\nWe must report a single scalar per test case: the maximum absolute spurious acceleration over all discrete points,\n$$\nA_{\\max}=\\max_{0\\le i\\le N_x-1}\\max_{0\\le k\\le N_\\sigma-1}\\left|a(x_i,\\sigma_k)\\right|,\n$$\nin $\\mathrm{m/s^2}$.\n\nAlgorithmic steps:\n\n- For each test case, compute $H=\\frac{R T_0}{g}$, construct $x_i$, $p_s(x_i)$, $\\sigma_k$, $p(x_i,\\sigma_k)$, and $\\rho(x_i,\\sigma_k)$.\n- Compute the centered finite-difference approximation to $\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}$ at each $(i,k)$ with periodic boundaries.\n- Compute $a(x_i,\\sigma_k)$ and then $A_{\\max}$ as the maximum absolute value over all grid points.\n- Output the list $[A_{\\max}^{(1)},A_{\\max}^{(2)},A_{\\max}^{(3)},A_{\\max}^{(4)}]$ for the four specified cases, in $\\mathrm{m/s^2}$.\n\nSanity checks and expected behavior:\n\n- For $s=0$, we have $p_s(x)=p_{\\mathrm{ref}}$ for all $x$, hence $p(x,\\sigma)$ is constant in $x$ at each $\\sigma$, our finite-difference derivative is exactly zero, and thus $A_{\\max}=0$ (up to floating-point roundoff).\n- As $s$ increases, $p_s(x)$ varies more strongly with $x$, the centered difference of $p(x,\\sigma)$ along $\\sigma$ yields larger magnitude, and the spurious acceleration increases roughly proportionally to $s$, modulated by $\\sigma$ and the pressure variation with $x$.\n- Changing $N_\\sigma$ shifts which $\\sigma$ values are sampled; since $|a|$ increases with larger $\\sigma$ (closer to the surface) and with larger $p_s$, coarse vertical resolution may slightly alter the reported maximum depending on the sampled $\\sigma$ levels, but the fundamental spurious acceleration persists.\n\nAll computations use the specified $\\mathrm{SI}$ constants and units, and accelerations are reported in $\\mathrm{m/s^2}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_spurious_acceleration(L, s, Nx, Nz, g=9.81, R=287.0, T0=300.0, p_ref=100000.0, p_top=20000.0):\n    \"\"\"\n    Compute the maximum absolute spurious horizontal acceleration (in m/s^2)\n    arising from a naive discrete horizontal pressure gradient along constant-sigma\n    surfaces for an isothermal hydrostatic atmosphere over sloping terrain.\n    \"\"\"\n    # Scale height\n    H = R * T0 / g\n\n    # Grid\n    dx = L / Nx\n    x = np.arange(Nx) * dx  # periodic grid\n\n    # Terrain and surface pressure\n    z_s = s * x\n    p_s = p_ref * np.exp(-z_s / H)\n\n    # Sigma levels (mid-layer)\n    k = np.arange(Nz)\n    sigma = (k + 0.5) / Nz  # shape (Nz,)\n\n    # Build pressure field p(x_i, sigma_k) and density rho\n    # p(x, sigma) = p_top + sigma * (p_s(x) - p_top)\n    # We broadcast: x axis length Nx, sigma axis length Nz\n    p = p_top + np.outer(p_s - p_top, sigma)  # shape (Nx, Nz)\n    rho = p / (R * T0)\n\n    # Centered finite difference in x with periodic boundary conditions for each sigma level\n    # dp/dx at constant sigma\n    # We'll compute for all k simultaneously using roll\n    p_plus = np.roll(p, -1, axis=0)  # i+1\n    p_minus = np.roll(p, 1, axis=0)  # i-1\n    dpdx = (p_plus - p_minus) / (2.0 * dx)\n\n    # Spurious acceleration: a = -(1/rho) * dpdx\n    a = -(1.0 / rho) * dpdx\n\n    # Maximum absolute value over all i,k\n    A_max = np.max(np.abs(a))\n    return A_max\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (L [m], s [dimensionless slope], Nx, Nz)\n    test_cases = [\n        (100000.0, 0.01, 128, 30),  # Case 1\n        (100000.0, 0.0, 128, 30),   # Case 2 (boundary: zero slope)\n        (100000.0, 0.01, 128, 3),   # Case 3 (coarse vertical resolution)\n        (100000.0, 0.05, 128, 30),  # Case 4 (steeper slope)\n    ]\n\n    results = []\n    for case in test_cases:\n        L, s, Nx, Nz = case\n        A_max = compute_spurious_acceleration(L, s, Nx, Nz)\n        # Format to a reasonable precision\n        results.append(f\"{A_max:.10e}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having identified the pressure gradient force error inherent in pure sigma coordinates, we now turn to quantifying the solution. Hybrid sigma-pressure coordinates were designed specifically to mitigate this error by transitioning to pure pressure levels away from the surface. In this capstone exercise , you will implement both a pure sigma and a hybrid coordinate system to directly compare the magnitude of the terrain-induced errors, demonstrating why hybrid coordinates are a critical component of modern atmospheric models.",
            "id": "4089087",
            "problem": "Consider an idealized, hydrostatic, dry atmosphere at rest over a two-dimensional mountain ridge in the context of Numerical Weather Prediction (NWP) and climate modeling. Let the horizontal coordinate be $x$ (in meters), and the vertical coordinate be a terrain-following variable $\\eta \\in [0,1]$, with $\\eta = 0$ at the model top and $\\eta = 1$ at the surface. The surface elevation is specified by the function $h(x)$ (in meters). Assume a horizontally uniform, isothermal temperature $T$ (in Kelvin), constant gravitational acceleration $g$ (in meters per second squared), and the dry-air gas constant $R_d$ (in Joules per kilogram per Kelvin). The reference sea-level pressure is $p_0$ (in Pascals), and the model top pressure is $p_{\\mathrm{top}}$ (in Pascals). Define the scale height $H = R_d T / g$ (in meters).\n\nUnder hydrostatic balance and the Ideal Gas Law, the surface pressure varies with elevation as\n$$\np_s(x) = p_0 \\exp\\!\\left(-\\frac{h(x)}{H}\\right).\n$$\nDefine the Gaussian mountain ridge profile\n$$\nh(x) = h_0 \\exp\\!\\left(-\\left(\\frac{x}{w}\\right)^2\\right),\n$$\nwhere $h_0$ (in meters) is the peak height, and $w$ (in meters) is the half-width parameter controlling the ridge sharpness.\n\nConsider two vertical coordinate formulations:\n\n1. Pure sigma coordinate:\n$$\np_{\\sigma}(x,\\eta) = p_{\\mathrm{top}} + \\eta \\left(p_s(x) - p_{\\mathrm{top}}\\right).\n$$\n\n2. Hybrid sigma-pressure coordinate:\n$$\np_{\\mathrm{hyb}}(x,\\eta) = A(\\eta) + B(\\eta)\\, p_s(x),\n$$\nwith the following choice that yields equidistant pressure levels above a transition $\\eta_c \\in (0,1)$:\n- For $0 \\le \\eta \\le \\eta_c$,\n$$\nB(\\eta)=0, \\quad A(\\eta) = p_{\\mathrm{top}} + \\frac{\\eta}{\\eta_c} \\left(p_c - p_{\\mathrm{top}}\\right),\n$$\nwhich produces linearly spaced pressure levels between $p_{\\mathrm{top}}$ and a specified transition pressure $p_c$ (in Pascals).\n- For $\\eta_c \\le \\eta \\le 1$,\n$$\nB(\\eta) = \\frac{\\eta - \\eta_c}{1 - \\eta_c}, \\quad A(\\eta) = p_{\\mathrm{top}} + \\left(p_c - p_{\\mathrm{top}}\\right) - p_c \\frac{\\eta - \\eta_c}{1 - \\eta_c}.\n$$\nThis construction ensures continuity at $\\eta_c$ with $p(\\eta_c)=p_c$, and enforces $p(1)=p_s(x)$ and $p(0)=p_{\\mathrm{top}}$.\n\nLet the geopotential (in square meters per second squared) at a given pressure be defined by the hydrostatic relation for an isothermal atmosphere:\n$$\n\\Phi(x,\\eta) = g\\, z(x,\\eta) = R_d\\, T \\ln\\!\\left(\\frac{p_0}{p(x,\\eta)}\\right),\n$$\nwhere $p(x,\\eta)$ is either $p_{\\sigma}(x,\\eta)$ or $p_{\\mathrm{hyb}}(x,\\eta)$, and $z(x,\\eta)$ is the geometric height of the pressure level.\n\nAssume a naïve discrete evaluation of the horizontal pressure-gradient term at constant $\\eta$ using a second-order central difference on a uniform grid with spacing $\\Delta x$ (in meters):\n$$\na_i(\\eta) = -\\frac{\\Phi_{i+1}(\\eta) - \\Phi_{i-1}(\\eta)}{2\\, \\Delta x},\n$$\nwhich yields an acceleration (in meters per second squared). In the physically correct, horizontally uniform resting isothermal atmosphere, the true horizontal acceleration should be $0$; any nonzero $a_i(\\eta)$ computed by this naïve terrain-following discretization is a terrain-induced pressure-gradient error.\n\nDefine the root-mean-square (RMS) terrain-induced acceleration error across all interior horizontal grid points $i$ and across all discrete vertical levels $\\eta_k$, for a given coordinate system, as\n$$\nE = \\sqrt{\\frac{1}{N_{\\mathrm{lev}}\\, N_{\\mathrm{int}}} \\sum_{k=1}^{N_{\\mathrm{lev}}} \\sum_{i \\in \\mathcal{I}} \\left(a_i(\\eta_k)\\right)^2},\n$$\nwhere $N_{\\mathrm{lev}}$ is the number of vertical levels, $\\mathcal{I}$ denotes the set of interior horizontal indices (excluding boundary points for the central difference), and $N_{\\mathrm{int}} = |\\mathcal{I}|$ is the number of interior points. Let $E_{\\sigma}$ denote this RMS error computed with $p_{\\sigma}$, and $E_{\\mathrm{hyb}}$ denote the RMS error computed with $p_{\\mathrm{hyb}}$.\n\nYour task is to compute the reduction in terrain-induced pressure-gradient errors due to the hybrid sigma-pressure choice, quantified by the dimensionless ratio\n$$\n\\mathcal{R} = \\frac{E_{\\mathrm{hyb}}}{E_{\\sigma}}.\n$$\nWhen $E_{\\sigma}$ is numerically zero, set $\\mathcal{R} = 0$ if $E_{\\mathrm{hyb}}$ is also numerically zero; otherwise set $\\mathcal{R}$ to a large sentinel value (e.g., $10^9$) to indicate a pathological case.\n\nImplement a complete program that:\n- Constructs a one-dimensional horizontal grid over $x \\in [-L, L]$ with uniform spacing $\\Delta x$ and $N_x = 2L/\\Delta x + 1$ points, where $L$ is a fixed domain half-length (in meters).\n- Constructs $N_{\\mathrm{lev}}$ uniformly spaced vertical levels in $\\eta \\in [0,1]$ including endpoints.\n- Computes $p_s(x)$, $p_{\\sigma}(x,\\eta)$, $p_{\\mathrm{hyb}}(x,\\eta)$, and the corresponding $\\Phi(x,\\eta)$ fields.\n- Computes $a_i(\\eta)$ using the central difference across interior points.\n- Computes $E_{\\sigma}$, $E_{\\mathrm{hyb}}$, and the ratio $\\mathcal{R}$.\n\nUse the following fixed physical parameters in your calculations:\n- $R_d = 287\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $g = 9.81\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$,\n- $T = 280\\ \\mathrm{K}$,\n- $p_0 = 101325\\ \\mathrm{Pa}$,\n- Transition pressure $p_c = 70000\\ \\mathrm{Pa}$,\n- Domain half-length $L = 200000\\ \\mathrm{m}$,\n- Number of vertical levels $N_{\\mathrm{lev}} = 30$.\n\nDesign a test suite of six parameter sets, each specified by $(h_0, w, \\Delta x, \\eta_c, p_{\\mathrm{top}})$:\n1. $(1500,\\ 20000,\\ 2000,\\ 0.7,\\ 10000)$ happy-path moderate mountain and standard transition.\n2. $(0,\\ 20000,\\ 2000,\\ 0.7,\\ 10000)$ flat terrain boundary case (expect essentially zero errors).\n3. $(2500,\\ 10000,\\ 1000,\\ 0.7,\\ 10000)$ steep and narrow ridge.\n4. $(1500,\\ 20000,\\ 2000,\\ 0.95,\\ 10000)$ transition very close to the surface (mostly pressure-based aloft).\n5. $(1500,\\ 20000,\\ 2000,\\ 0.15,\\ 10000)$ transition close to the top (mostly sigma-like).\n6. $(1500,\\ 20000,\\ 2000,\\ 0.7,\\ 30000)$ higher model top pressure.\n\nFor all computations, express acceleration in $\\mathrm{m}\\,\\mathrm{s}^{-2}$. The final required output of your program is a single line containing the six $\\mathcal{R}$ values for the test suite as a comma-separated list enclosed in square brackets, for example, \"[r1,r2,r3,r4,r5,r6]\". Each $r_j$ must be a floating-point number.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5,result6]\").",
            "solution": "The problem is validated as scientifically sound, well-posed, objective, and self-contained. All necessary equations, parameters, and numerical procedures are provided to compute a unique, verifiable solution. The underlying physical and numerical concepts are standard in atmospheric modeling. We may, therefore, proceed with the solution.\n\nThe objective is to quantify the reduction in the numerical pressure-gradient force (PGF) error when transitioning from a pure sigma ($\\sigma$) coordinate system to a hybrid sigma-pressure coordinate system. This error is a well-known artifact in terrain-following coordinate models, arising from the finite-difference approximation of two large, nearly-canceling terms in the PGF calculation. A physically correct model of a resting, hydrostatic atmosphere should yield zero horizontal acceleration, so any computed non-zero acceleration is a numerical error. We will compute the ratio of the root-mean-square (RMS) acceleration error of the hybrid system to that of the pure sigma system, $\\mathcal{R} = E_{\\mathrm{hyb}} / E_{\\sigma}$.\n\nThe solution methodology involves the following sequential steps for each provided test case:\n\nFirst, we establish the physical and numerical environment. The fundamental physical constants are given as $R_d = 287\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ (dry-air gas constant), $g = 9.81\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$ (gravitational acceleration), $T = 280\\ \\mathrm{K}$ (isothermal temperature), and $p_0 = 101325\\ \\mathrm{Pa}$ (reference sea-level pressure). From these, we compute the atmospheric scale height, $H = R_d T / g$. The numerical domain is a two-dimensional grid spanning the horizontal coordinate $x$ and the vertical coordinate $\\eta$. The horizontal grid for $x$ is defined over the domain $[-L, L]$ with $L = 200000\\ \\mathrm{m}$, using a uniform spacing $\\Delta x$ which varies per test case. The number of horizontal grid points is $N_x = 2L/\\Delta x + 1$. The vertical grid for $\\eta$ consists of $N_{\\mathrm{lev}} = 30$ uniformly spaced levels from $\\eta=0$ (model top) to $\\eta=1$ (surface), inclusive.\n\nSecond, we define the surface topography and the corresponding surface pressure. The mountain ridge is modeled by a Gaussian profile, $h(x) = h_0 \\exp(-(x/w)^2)$, where $h_0$ and $w$ are test-case-specific parameters. Under the assumptions of a hydrostatic and isothermal atmosphere, the surface pressure $p_s(x)$ is calculated as $p_s(x) = p_0 \\exp(-h(x)/H)$. This computation yields a one-dimensional array of surface pressure values corresponding to each point on the horizontal grid.\n\nThird, we construct the full two-dimensional pressure fields, $p(x, \\eta)$, for both coordinate systems. These fields are represented by arrays of dimension $(N_{\\mathrm{lev}}, N_x)$.\nFor the pure sigma coordinate system, the pressure at each grid point is given by a linear interpolation in pressure between the surface and the model top:\n$$\np_{\\sigma}(x,\\eta) = p_{\\mathrm{top}} + \\eta \\left(p_s(x) - p_{\\mathrm{top}}\\right)\n$$\nFor the hybrid sigma-pressure coordinate system, the pressure is defined as $p_{\\mathrm{hyb}}(x,\\eta) = A(\\eta) + B(\\eta) p_s(x)$. The coefficients $A(\\eta)$ and $B(\\eta)$ are defined piecewise to create a smooth transition from a pure pressure coordinate system aloft to a terrain-following system near the surface. The transition occurs at level $\\eta_c$ and pressure $p_c=70000\\ \\mathrm{Pa}$.\nFor levels above the transition ($0 \\le \\eta \\le \\eta_c$), the coordinate is purely pressure-based:\n$$\nB(\\eta)=0, \\quad A(\\eta) = p_{\\mathrm{top}} + \\frac{\\eta}{\\eta_c} \\left(p_c - p_{\\mathrm{top}}\\right)\n$$\nFor levels below the transition ($\\eta_c < \\eta \\le 1$), the coordinate is a hybrid:\n$$\nB(\\eta) = \\frac{\\eta - \\eta_c}{1 - \\eta_c}, \\quad A(\\eta) = p_{\\mathrm{top}} + \\left(p_c - p_{\\mathrm{top}}\\right) - p_c \\frac{\\eta - \\eta_c}{1 - \\eta_c}\n$$\nThese formulations result in two distinct pressure fields, $p_{\\sigma}$ and $p_{\\mathrm{hyb}}$, on the $(x, \\eta)$ grid.\n\nFourth, we calculate the geopotential field $\\Phi(x, \\eta)$. For an isothermal atmosphere, the geopotential is related to pressure by the hypsometric equation integrated from sea level, yielding:\n$$\n\\Phi(x,\\eta) = R_d T \\ln\\left(\\frac{p_0}{p(x,\\eta)}\\right) = H g \\ln\\left(\\frac{p_0}{p(x,\\eta)}\\right)\n$$\nThis calculation is performed for both pressure fields, producing $\\Phi_{\\sigma}(x, \\eta)$ and $\\Phi_{\\mathrm{hyb}}(x, \\eta)$.\n\nFifth, we compute the terrain-induced horizontal acceleration error. This error, $a_i(\\eta)$, is calculated at each vertical level $\\eta_k$ and at each interior horizontal grid point $i$ using a second-order central finite-difference approximation of the horizontal geopotential gradient on a constant $\\eta$ surface:\n$$\na_i(\\eta) = -\\frac{\\Phi_{i+1}(\\eta) - \\Phi_{i-1}(\\eta)}{2 \\Delta x}\n$$\nThis operation is applied to both geopotential fields, $\\Phi_{\\sigma}$ and $\\Phi_{\\mathrm{hyb}}$, yielding two error fields, $a_{\\sigma}$ and $a_{\\mathrm{hyb}}$, defined on the interior of the domain.\n\nFinally, we quantify and compare the total error for each system. The root-mean-square (RMS) error is calculated over all interior horizontal points and all vertical levels:\n$$\nE = \\sqrt{\\frac{1}{N_{\\mathrm{lev}} N_{\\mathrm{int}}} \\sum_{k=1}^{N_{\\mathrm{lev}}} \\sum_{i \\in \\mathcal{I}} \\left(a_i(\\eta_k)\\right)^2}\n$$\nwhere $N_{\\mathrm{int}} = N_x - 2$ is the number of interior horizontal points. This yields the RMS errors $E_{\\sigma}$ and $E_{\\mathrm{hyb}}$. The final metric is their ratio, $\\mathcal{R} = E_{\\mathrm{hyb}} / E_{\\sigma}$. A special case is handled for flat terrain ($h_0=0$), where both errors are expected to be numerically zero; in this instance, $\\mathcal{R}$ is set to $0$. If $E_{\\sigma}$ is numerically zero but $E_{\\mathrm{hyb}}$ is not, $\\mathcal{R}$ is set to a large sentinel value ($10^9$), though this is not expected to occur. This entire procedure is repeated for each of the six test cases specified in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_r(params):\n    \"\"\"\n    Calculates the ratio of terrain-induced pressure-gradient errors for a single test case.\n    \"\"\"\n    h0, w, delta_x, eta_c, p_top = params\n\n    # Fixed physical parameters\n    R_d = 287.0\n    g = 9.81\n    T = 280.0\n    p0 = 101325.0\n    pc = 70000.0\n    L = 200000.0\n    N_lev = 30\n\n    # Scale height\n    H = R_d * T / g\n\n    # Numerical grids\n    Nx = int(2 * L / delta_x) + 1\n    x = np.linspace(-L, L, Nx)\n    eta = np.linspace(0, 1, N_lev)\n\n    # Surface fields\n    h = h0 * np.exp(-(x / w)**2)\n    ps = p0 * np.exp(-h / H)\n\n    # Reshape for broadcasting\n    eta_col = eta.reshape(-1, 1)\n    ps_row = ps.reshape(1, -1)\n\n    # --- Pure Sigma Coordinate Calculation ---\n    p_sigma = p_top + eta_col * (ps_row - p_top)\n    \n    # --- Hybrid Sigma-Pressure Coordinate Calculation ---\n    A = np.zeros(N_lev)\n    B = np.zeros(N_lev)\n\n    # Region 1: 0 <= eta <= eta_c\n    mask_lower = eta <= eta_c\n    B[mask_lower] = 0.0\n    A[mask_lower] = p_top + (eta[mask_lower] / eta_c) * (pc - p_top)\n\n    # Region 2: eta_c < eta <= 1\n    mask_upper = eta > eta_c\n    if np.any(mask_upper):\n        term = (eta[mask_upper] - eta_c) / (1 - eta_c)\n        B[mask_upper] = term\n        A[mask_upper] = p_top + (pc - p_top) - pc * term\n\n    A_col = A.reshape(-1, 1)\n    B_col = B.reshape(-1, 1)\n    p_hyb = A_col + B_col * ps_row\n    \n    # --- Geopotential Field Calculation ---\n    # Note: Using np.log(p0) - np.log(p) is more stable than np.log(p0/p)\n    # but the problem statement implies the latter. Given inputs are safe.\n    phi_sigma = H * g * np.log(p0 / p_sigma)\n    phi_hyb = H * g * np.log(p0 / p_hyb)\n\n    # --- Acceleration Error Calculation ---\n    # Central difference on interior points\n    a_sigma = -(phi_sigma[:, 2:] - phi_sigma[:, :-2]) / (2 * delta_x)\n    a_hyb = -(phi_hyb[:, 2:] - phi_hyb[:, :-2]) / (2 * delta_x)\n\n    # --- RMS Error Calculation ---\n    E_sigma = np.sqrt(np.mean(a_sigma**2))\n    E_hyb = np.sqrt(np.mean(a_hyb**2))\n\n    # --- Ratio Calculation with special case handling ---\n    zero_tol = 1e-15\n    if E_sigma < zero_tol:\n        if E_hyb < zero_tol:\n            return 0.0\n        else:\n            return 1e9\n    else:\n        return E_hyb / E_sigma\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h0, w, delta_x, eta_c, p_top)\n        (1500, 20000, 2000, 0.7, 10000),  # 1. Happy-path moderate mountain\n        (0, 20000, 2000, 0.7, 10000),     # 2. Flat terrain boundary case\n        (2500, 10000, 1000, 0.7, 10000),  # 3. Steep and narrow ridge\n        (1500, 20000, 2000, 0.95, 10000), # 4. Transition very close to surface\n        (1500, 20000, 2000, 0.15, 10000), # 5. Transition close to top\n        (1500, 20000, 2000, 0.7, 30000),  # 6. Higher model top pressure\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_r(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}