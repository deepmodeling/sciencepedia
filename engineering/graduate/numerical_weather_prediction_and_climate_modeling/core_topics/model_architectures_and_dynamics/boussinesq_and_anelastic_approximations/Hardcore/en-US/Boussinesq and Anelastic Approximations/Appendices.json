{
    "hands_on_practices": [
        {
            "introduction": "Before applying a simplified model, it is crucial to understand when it is appropriate. This first practice uses scaling analysis, a powerful tool in fluid dynamics, to investigate the governing equations of a compressible atmosphere. By estimating the order of magnitude of different terms for typical atmospheric conditions, you will discover why the effects of acoustic compressibility are often very small, providing a direct justification for using sound-proof models like the anelastic and Boussinesq approximations. ",
            "id": "4018650",
            "problem": "Consider a dry ideal-gas atmosphere with a horizontally homogeneous, vertically stratified base state described by a base-state density $ \\rho_{0}(z) $ and pressure $ p_{0}(z) $ in hydrostatic balance $ \\mathrm{d}p_{0}/\\mathrm{d}z = -\\rho_{0} g $. Let small perturbations $ \\rho'(x,t) $, $ p'(x,t) $, and $ \\boldsymbol{u}(x,t) $ evolve according to the inviscid compressible equations with gravity:\n- Continuity: $ \\partial_{t} \\rho + \\nabla \\cdot (\\rho \\boldsymbol{u}) = 0 $.\n- Momentum: $ \\partial_{t} \\boldsymbol{u} + (\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u} = -\\frac{1}{\\rho} \\nabla p - g \\hat{\\boldsymbol{z}} $.\n- Equation of state: $ p = \\rho R T $.\nAssume stably stratified conditions characterized by the Brunt–Väisälä frequency (BVF) $ N $, with a vertical depth scale of motion $ H $ and a characteristic horizontal flow speed $ U $. Define the Mach number $ Ma = U / c_{s} $ using the adiabatic sound speed $ c_{s} $, and the Froude number $ Fr = U / (N H) $.\n\nStarting from these fundamental laws and definitions, perform an order-of-magnitude scaling analysis to:\n1. Show that the fractional density perturbation obeys $ \\rho' / \\rho_0 \\sim Ma^2 $ under subsonic, nearly isentropic conditions, by relating $ p' $ to the dynamic pressure scale and invoking the acoustic compressibility relation.\n2. Using the continuity equation, estimate the ratio between the compressible storage term $ \\lvert\\partial_{t} \\rho'\\rvert $ and the advective mass-flux divergence term $ \\lvert\\nabla \\cdot (\\rho_{0} \\boldsymbol{u})\\rvert $. Express this ratio as a dimensionless quantity $ R_{c} $ in terms of $ Ma $ only.\n3. Using the momentum equation and the static stability timescale, estimate the ratio $ R_{ab} $ between the acoustic propagation timescale across the vertical depth $ T_{a} = H / c_{s} $ and the buoyancy timescale $ T_{b} = 1 / N $. Express $ R_{ab} $ in terms of $ Ma $ and $ Fr $.\n\nThen, for typical tropospheric values $ U = 10\\,\\mathrm{m\\,s^{-1}} $, $ c_{s} = 340\\,\\mathrm{m\\,s^{-1}} $, $ N = 10^{-2}\\,\\mathrm{s^{-1}} $, and $ H = 10^{4}\\,\\mathrm{m} $, compute:\n- $ Ma $,\n- $ Fr $,\n- $ R_{c} $,\n- $ R_{ab} $.\n\nExpress the final answer as a row matrix $ [Ma,\\, Fr,\\, R_{c},\\, R_{ab}] $, with each entry rounded to four significant figures. No units are required for the final answer.",
            "solution": "The problem statement is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n- **Atmosphere Model:** Dry ideal-gas atmosphere.\n- **Base State:** Horizontally homogeneous, vertically stratified base state with density $ \\rho_{0}(z) $ and pressure $ p_{0}(z) $.\n- **Hydrostatic Balance:** $ \\mathrm{d}p_{0}/\\mathrm{d}z = -\\rho_{0} g $.\n- **Perturbations:** Density $ \\rho'(x,t) $, pressure $ p'(x,t) $, and velocity $ \\boldsymbol{u}(x,t) $. The total fields are $ \\rho = \\rho_{0} + \\rho' $ and $ p = p_{0} + p' $.\n- **Governing Equations (inviscid, compressible):**\n    - Continuity: $ \\partial_{t} \\rho + \\nabla \\cdot (\\rho \\boldsymbol{u}) = 0 $.\n    - Momentum: $ \\partial_{t} \\boldsymbol{u} + (\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u} = -\\frac{1}{\\rho} \\nabla p - g \\hat{\\boldsymbol{z}} $.\n    - Equation of state: $ p = \\rho R T $.\n- **Conditions:** Stably stratified conditions characterized by the Brunt–Väisälä frequency $ N $.\n- **Characteristic Scales:**\n    - Vertical depth of motion: $ H $.\n    - Horizontal flow speed: $ U $.\n- **Dimensionless Numbers:**\n    - Mach number: $ Ma = U / c_{s} $, where $ c_{s} $ is the adiabatic sound speed.\n    - Froude number: $ Fr = U / (N H) $.\n- **Tasks (Analysis):**\n    1. Show that the fractional density perturbation obeys $ \\rho' / \\rho_{0} \\sim Ma^{2} $.\n    2. Estimate the ratio $ R_{c} = \\lvert\\partial_{t} \\rho'\\rvert / \\lvert\\nabla \\cdot (\\rho_{0} \\boldsymbol{u})\\rvert $ in terms of $ Ma $.\n    3. Estimate the ratio $ R_{ab} = T_{a} / T_{b} $, where $ T_{a} = H / c_{s} $ and $ T_{b} = 1 / N $, in terms of $ Ma $ and $ Fr $.\n- **Tasks (Numerical Calculation):**\n    - Use typical tropospheric values: $ U = 10\\,\\mathrm{m\\,s^{-1}} $, $ c_{s} = 340\\,\\mathrm{m\\,s^{-1}} $, $ N = 10^{-2}\\,\\mathrm{s^{-1}} $, $ H = 10^{4}\\,\\mathrm{m} $.\n    - Compute $ Ma $, $ Fr $, $ R_{c} $, and $ R_{ab} $.\n- **Output Format:** Express the final numerical answer as a row matrix $ [Ma,\\, Fr,\\, R_{c},\\, R_{ab}] $ with each entry rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding:** The problem is firmly rooted in the principles of geophysical fluid dynamics. The equations, definitions ($N$, $Ma$, $Fr$), and the overall context of scaling analysis are standard and fundamental to the study of atmospheric motions and the derivation of simplified models like the anelastic and Boussinesq approximations.\n- **Well-Posedness:** The problem is well-posed. It provides all necessary equations, definitions, and data to perform the requested scaling analysis and subsequent numerical calculation. The tasks are specified clearly, leading to a unique and meaningful result.\n- **Objectivity:** The problem statement is objective, using precise, technical language devoid of ambiguity, subjectivity, or opinion.\n- **Consistency and Completeness:** The problem is self-contained and internally consistent. There are no missing definitions or contradictory constraints. The specified analysis is a standard academic exercise in this field.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid** as it is scientifically sound, well-posed, objective, and directly relevant to the study of atmospheric dynamics. Proceeding to a full solution.\n\n### Solution Derivation\n\nThis solution will proceed in four parts: the three analytical derivations followed by the numerical computation.\n\n**Part 1: Scaling of the Fractional Density Perturbation**\n\nWe begin by linearizing the momentum equation. The total fields are $ p = p_{0} + p' $ and $ \\rho = \\rho_{0} + \\rho' $. Substituting these into the momentum equation and recognizing that the base state is in hydrostatic balance ($ -\\frac{1}{\\rho_0} \\nabla p_0 - g \\hat{\\boldsymbol{z}} \\approx 0 $ after applying the Boussinesq approximation within the gradient term) yields the equation for the perturbations. A key balance for subsonic flow, particularly in the horizontal, is between the advection term and the perturbation pressure gradient term.\n$$ (\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u} \\approx -\\frac{1}{\\rho_0} \\nabla p' $$\nWe perform an order-of-magnitude scaling analysis on this balance. Let $ U $ be the characteristic horizontal velocity scale and $ L $ be the characteristic horizontal length scale.\n$$ |\\!|(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}|\\!| \\sim \\frac{U^{2}}{L} $$\n$$ |\\!|-\\frac{1}{\\rho_0} \\nabla p'|\\!| \\sim \\frac{p'}{\\rho_0 L} $$\nEquating these scales gives an estimate for the magnitude of the pressure perturbation, which is the dynamic pressure:\n$$ \\frac{U^{2}}{L} \\sim \\frac{p'}{\\rho_0 L} \\implies p' \\sim \\rho_0 U^{2} $$\nThe problem specifies \"nearly isentropic conditions\". For an isentropic process, the pressure and density perturbations are related through the square of the adiabatic sound speed, $ c_{s}^{2} = (\\partial p / \\partial \\rho)_{s} $. For small perturbations, this relationship becomes:\n$$ p' \\approx c_{s}^{2} \\rho' $$\nThis is the \"acoustic compressibility relation\" mentioned in the problem. Combining the two estimates for $ p' $:\n$$ c_{s}^{2} \\rho' \\sim \\rho_0 U^{2} $$\nRearranging this to find the fractional density perturbation gives:\n$$ \\frac{\\rho'}{\\rho_0} \\sim \\frac{U^{2}}{c_{s}^{2}} $$\nBy the definition of the Mach number, $ Ma = U / c_{s} $, we arrive at the required result:\n$$ \\frac{\\rho'}{\\rho_0} \\sim Ma^{2} $$\n\n**Part 2: Ratio of Compressible Storage to Mass-Flux Divergence ($ R_{c} $)**\n\nWe are asked to find the ratio $ R_{c} = \\lvert\\partial_{t} \\rho'\\rvert / \\lvert\\nabla \\cdot (\\rho_{0} \\boldsymbol{u})\\rvert $. We again use scaling analysis. Let $ T_{adv} \\sim L/U $ be the advective timescale for the motion, where $ L $ is the horizontal length scale and $ U $ is the characteristic velocity.\nThe numerator is the temporal change of the density perturbation, which scales as:\n$$ \\lvert\\partial_{t} \\rho'\\rvert \\sim \\frac{\\rho'}{T_{adv}} \\sim \\frac{\\rho' U}{L} $$\nThe denominator is the divergence of the mass flux. Its horizontal component scales as:\n$$ \\lvert\\nabla \\cdot (\\rho_{0} \\boldsymbol{u})\\rvert \\sim \\frac{\\rho_0 U}{L} $$\nHere, we assume that the horizontal divergence is representative of the total divergence scale, a common approach in scaling for large-aspect-ratio flows. Taking the ratio of these two scales:\n$$ R_{c} \\sim \\frac{\\rho' U / L}{\\rho_0 U / L} = \\frac{\\rho'}{\\rho_0} $$\nUsing the result from Part 1, we can express this ratio in terms of the Mach number:\n$$ R_{c} \\sim Ma^{2} $$\nThis result signifies that for low Mach number flows ($ Ma \\ll 1 $), the compressible storage of mass is negligible compared to the divergence of the mass flux, which is a cornerstone of the anelastic approximation ($ \\nabla \\cdot (\\rho_{0} \\boldsymbol{u}) = 0 $).\n\n**Part 3: Ratio of Acoustic to Buoyancy Timescales ($ R_{ab} $)**\n\nWe need to find the ratio $ R_{ab} = T_{a} / T_{b} $. The problem defines the timescales:\n- Acoustic timescale across vertical depth $ H $: $ T_{a} = H / c_{s} $.\n- Buoyancy timescale (inverse of the Brunt-Väisälä frequency): $ T_{b} = 1 / N $.\nThe ratio is therefore:\n$$ R_{ab} = \\frac{T_{a}}{T_{b}} = \\frac{H / c_{s}}{1 / N} = \\frac{N H}{c_{s}} $$\nWe are required to express this in terms of the Mach number $ Ma = U / c_{s} $ and the Froude number $ Fr = U / (N H) $. We can rearrange these definitions to solve for the terms in our expression for $ R_{ab} $:\n- From $ Ma = U / c_{s} $, we get $ c_{s} = U / Ma $.\n- From $ Fr = U / (N H) $, we get $ N H = U / Fr $.\nSubstituting these into the expression for $ R_{ab} $:\n$$ R_{ab} = \\frac{U / Fr}{U / Ma} = \\frac{U}{Fr} \\cdot \\frac{Ma}{U} = \\frac{Ma}{Fr} $$\nThis ratio compares the timescale of sound wave propagation to the timescale of buoyancy oscillations (internal gravity waves).\n\n**Part 4: Numerical Computations**\n\nThe given values are:\n- $ U = 10\\,\\mathrm{m\\,s^{-1}} $\n- $ c_{s} = 340\\,\\mathrm{m\\,s^{-1}} $\n- $ N = 10^{-2}\\,\\mathrm{s^{-1}} $\n- $ H = 10^{4}\\,\\mathrm{m} $\n\nWe now compute the required quantities and round to four significant figures.\n\n- **Mach number ($ Ma $):**\n  $$ Ma = \\frac{U}{c_{s}} = \\frac{10}{340} \\approx 0.02941176... \\approx 0.02941 $$\n\n- **Froude number ($ Fr $):**\n  First, compute the product $ N H $:\n  $$ N H = (10^{-2}\\,\\mathrm{s^{-1}}) \\times (10^{4}\\,\\mathrm{m}) = 100\\,\\mathrm{m\\,s^{-1}} $$\n  Then, compute $ Fr $:\n  $$ Fr = \\frac{U}{N H} = \\frac{10}{100} = 0.1 $$\n  To four significant figures, this is $ 0.1000 $.\n\n- **Compressibility ratio ($ R_{c} $):**\n  $$ R_{c} = Ma^{2} = \\left(\\frac{10}{340}\\right)^{2} \\approx (0.02941176...)^{2} \\approx 0.00086505... \\approx 0.0008651 $$\n\n- **Timescale ratio ($ R_{ab} $):**\n  $$ R_{ab} = \\frac{Ma}{Fr} = \\frac{0.02941176...}{0.1} = 0.2941176... \\approx 0.2941 $$\n\nThe computed values represent typical conditions for synoptic-scale atmospheric motions, where $ Ma \\ll 1 $ and $ Fr \\ll 1 $. This regime justifies the use of filtered equation sets that remove acoustic waves, such as the anelastic and Boussinesq systems. The small value of $ R_c = Ma^2 $ directly shows why a simplified continuity equation is appropriate. The value of $ R_{ab} $ being less than $ 1 $ indicates that buoyancy effects evolve on a timescale longer than that of acoustic propagation.\n\nThe final results are collected into a row matrix.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.02941 & 0.1000 & 0.0008651 & 0.2941 \\end{pmatrix} } $$"
        },
        {
            "introduction": "The Boussinesq approximation is computationally efficient but rests on the strong assumption of a nearly constant background density. This practice explores the limits of that assumption by analyzing an idealized isothermal atmosphere under hydrostatic balance. You will derive the density scale height, $H_{\\rho}$, and quantify how density changes with altitude, establishing the crucial criterion that the vertical scale of motion must be much smaller than $H_{\\rho}$ for the approximation to be valid. ",
            "id": "4018620",
            "problem": "In Numerical Weather Prediction (NWP) and climate modeling, the Boussinesq approximation assumes a constant reference density except in buoyancy, which can introduce error when the background density varies appreciably with height. Consider a dry, compressible, hydrostatic, isothermal atmosphere with temperature $T$ and a background reference density at the lower boundary $z=0$ equal to $\\rho_{0}$. Let the vertical domain have depth $H$. The hydrostatic balance and the Ideal Gas Law imply an exponential background density profile with a density scale height $H_{\\rho}$ defined by $H_{\\rho}^{-1} = -\\left.\\frac{d \\ln \\overline{\\rho}}{dz}\\right|_{z}$, where $\\overline{\\rho}(z)$ is the slowly varying background density.\n\nStarting from the fundamental laws appropriate to this setting, namely the hydrostatic balance $dp/dz = -\\rho g$ and the Ideal Gas Law $p = \\rho R T$ for a dry atmosphere with constant $T$, derive an analytic expression for the fractional background density variation across the domain,\n$$\\frac{\\Delta \\rho}{\\rho_{0}},$$\nwhere $\\Delta \\rho = \\overline{\\rho}(0) - \\overline{\\rho}(H)$, in terms of the non-dimensional ratio $H/H_{\\rho}$. Use this to justify the small-parameter criterion for the validity of the Boussinesq approximation in a deep atmosphere by identifying the leading-order term in an asymptotic expansion for small $H/H_{\\rho}$.\n\nProvide your final answer as a single closed-form analytic expression for $\\Delta \\rho/\\rho_{0}$ in terms of $H/H_{\\rho}$. No numerical evaluation is required, and no units should be included in the final expression.",
            "solution": "The problem is first validated against the specified criteria.\n\n**Step 1: Extract Givens**\n- **System**: A dry, compressible, hydrostatic, isothermal atmosphere.\n- **Temperature**: $T$ (constant).\n- **Reference Density at Lower Boundary**: $\\overline{\\rho}(0) = \\rho_0$.\n- **Vertical Domain Depth**: $H$.\n- **Fundamental Laws**:\n  1.  Hydrostatic balance: $\\frac{dp}{dz} = -\\rho g$.\n  2.  Ideal Gas Law: $p = \\rho R T$.\n- **Definition of Density Scale Height**: $H_{\\rho}^{-1} = -\\left.\\frac{d \\ln \\overline{\\rho}}{dz}\\right|_{z}$, where $\\overline{\\rho}(z)$ is the background density.\n- **Quantity to Derive**: The fractional background density variation, $\\frac{\\Delta \\rho}{\\rho_{0}}$, where $\\Delta \\rho = \\overline{\\rho}(0) - \\overline{\\rho}(H)$.\n- **Final Form**: An analytic expression in terms of the non-dimensional ratio $H/H_{\\rho}$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed for validity:\n- **Scientifically Grounded**: Yes. The problem is based on the fundamental principles of atmospheric thermodynamics and statics (hydrostatic balance, ideal gas law). The concept of scale height and its relation to the Boussinesq approximation are standard topics in geophysical fluid dynamics.\n- **Well-Posed**: Yes. The problem provides all necessary equations and boundary conditions to derive the requested expression. It is self-contained and unambiguous.\n- **Objective**: Yes. The problem is stated using precise, formal scientific language, free from subjectivity or opinion.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A complete, reasoned solution will be provided.\n\n**Derivation of the Solution**\nThe starting point is the set of fundamental equations governing the state of the specified atmosphere. We are considering the background state, so the density $\\rho$ and pressure $p$ are the background fields $\\overline{\\rho}(z)$ and $\\overline{p}(z)$.\n\nThe hydrostatic balance is given by:\n$$\n\\frac{d\\overline{p}}{dz} = -\\overline{\\rho}g\n$$\nwhere $g$ is the acceleration due to gravity.\n\nThe Ideal Gas Law for a dry atmosphere is:\n$$\n\\overline{p} = \\overline{\\rho} R T\n$$\nwhere $R$ is the specific gas constant for dry air. The problem states that the temperature $T$ is constant (isothermal atmosphere).\n\nWe can differentiate the Ideal Gas Law with respect to the vertical coordinate $z$:\n$$\n\\frac{d\\overline{p}}{dz} = R T \\frac{d\\overline{\\rho}}{dz}\n$$\nsince $R$ and $T$ are constants.\n\nNow, we equate the two expressions for the pressure gradient $\\frac{d\\overline{p}}{dz}$:\n$$\nR T \\frac{d\\overline{\\rho}}{dz} = -\\overline{\\rho}g\n$$\nThis is a first-order linear ordinary differential equation for the background density profile $\\overline{\\rho}(z)$. We can solve it using separation of variables:\n$$\n\\frac{1}{\\overline{\\rho}} d\\overline{\\rho} = -\\frac{g}{RT} dz\n$$\nTo find the density profile, we integrate this equation from the lower boundary at $z=0$ to an arbitrary height $z$:\n$$\n\\int_{\\overline{\\rho}(0)}^{\\overline{\\rho}(z)} \\frac{1}{\\rho'} d\\rho' = \\int_{0}^{z} -\\frac{g}{RT} dz'\n$$\nThe integration yields:\n$$\n[\\ln(\\rho')]_{\\overline{\\rho}(0)}^{\\overline{\\rho}(z)} = -\\frac{g}{RT} [z']_{0}^{z}\n$$\n$$\n\\ln(\\overline{\\rho}(z)) - \\ln(\\overline{\\rho}(0)) = -\\frac{gz}{RT}\n$$\n$$\n\\ln\\left(\\frac{\\overline{\\rho}(z)}{\\overline{\\rho}(0)}\\right) = -\\frac{gz}{RT}\n$$\nExponentiating both sides gives the expression for the background density profile:\n$$\n\\overline{\\rho}(z) = \\overline{\\rho}(0) \\exp\\left(-\\frac{gz}{RT}\\right)\n$$\nThe problem defines the density scale height $H_{\\rho}$ as $H_{\\rho}^{-1} = -\\frac{d \\ln \\overline{\\rho}}{dz}$. From our integrated equation $\\ln(\\overline{\\rho}(z)) = \\ln(\\overline{\\rho}(0)) - \\frac{gz}{RT}$, we can find the derivative:\n$$\n\\frac{d \\ln \\overline{\\rho}}{dz} = -\\frac{g}{RT}\n$$\nTherefore, the scale height is identified as:\n$$\nH_{\\rho}^{-1} = -\\left(-\\frac{g}{RT}\\right) = \\frac{g}{RT} \\implies H_{\\rho} = \\frac{RT}{g}\n$$\nSubstituting $H_{\\rho}$ into the density profile equation, and using the given boundary condition $\\overline{\\rho}(0) = \\rho_{0}$, we obtain:\n$$\n\\overline{\\rho}(z) = \\rho_{0} \\exp\\left(-\\frac{z}{H_{\\rho}}\\right)\n$$\nWe are asked to find the fractional background density variation across the domain of depth $H$, which is defined as $\\frac{\\Delta \\rho}{\\rho_{0}}$, where $\\Delta \\rho = \\overline{\\rho}(0) - \\overline{\\rho}(H)$.\n\nFirst, we calculate the density at the top of the domain, $z=H$:\n$$\n\\overline{\\rho}(H) = \\rho_{0} \\exp\\left(-\\frac{H}{H_{\\rho}}\\right)\n$$\nThe total density variation $\\Delta \\rho$ is:\n$$\n\\Delta \\rho = \\overline{\\rho}(0) - \\overline{\\rho}(H) = \\rho_{0} - \\rho_{0} \\exp\\left(-\\frac{H}{H_{\\rho}}\\right)\n$$\n$$\n\\Delta \\rho = \\rho_{0} \\left(1 - \\exp\\left(-\\frac{H}{H_{\\rho}}\\right)\\right)\n$$\nFinally, the fractional density variation is:\n$$\n\\frac{\\Delta \\rho}{\\rho_{0}} = \\frac{\\rho_{0} \\left(1 - \\exp\\left(-\\frac{H}{H_{\\rho}}\\right)\\right)}{\\rho_{0}} = 1 - \\exp\\left(-\\frac{H}{H_{\\rho}}\\right)\n$$\nThis is the required analytic expression.\n\nTo justify the small-parameter criterion for the Boussinesq approximation, we consider the limit where this fractional density variation is small. The Boussinesq approximation is valid when $\\frac{\\Delta \\rho}{\\rho_{0}} \\ll 1$. Let the non-dimensional parameter be $x = \\frac{H}{H_{\\rho}}$. The criterion is valid when $x$ is small. We perform a Taylor series expansion of the expression for $\\frac{\\Delta \\rho}{\\rho_{0}}$ around $x=0$:\n$$\n\\exp(-x) = 1 - x + \\frac{x^2}{2!} - \\frac{x^3}{3!} + \\dots\n$$\nSubstituting this into our result:\n$$\n\\frac{\\Delta \\rho}{\\rho_{0}} = 1 - \\left(1 - x + \\frac{x^2}{2} - \\dots\\right) = x - \\frac{x^2}{2} + \\dots\n$$\n$$\n\\frac{\\Delta \\rho}{\\rho_{0}} = \\frac{H}{H_{\\rho}} - \\frac{1}{2}\\left(\\frac{H}{H_{\\rho}}\\right)^2 + O\\left(\\left(\\frac{H}{H_{\\rho}}\\right)^3\\right)\n$$\nFor small fractional density changes, the leading-order term dominates. Thus, the condition $\\frac{\\Delta \\rho}{\\rho_{0}} \\ll 1$ becomes equivalent to the condition that the leading-order term is small:\n$$\n\\frac{H}{H_{\\rho}} \\ll 1\n$$\nThis demonstrates that the non-dimensional ratio of the domain depth $H$ to the density scale height $H_{\\rho}$ serves as the small parameter governing the validity of the Boussinesq approximation. The approximation is appropriate for atmospheric phenomena occurring over a vertical scale much smaller than the density scale height.",
            "answer": "$$\\boxed{1 - \\exp\\left(-\\frac{H}{H_{\\rho}}\\right)}$$"
        },
        {
            "introduction": "The core purpose of the Boussinesq and anelastic approximations is to 'filter' out computationally expensive sound waves while retaining slower, buoyancy-driven motions. This final practice demonstrates this filtering effect at the fundamental level of wave dynamics. By deriving and comparing the dispersion relations for a full compressible system and its sound-proof counterpart, you will see precisely how the fast acoustic modes are eliminated, and then verify numerically how accurately the slow internal gravity waves are represented. ",
            "id": "4018602",
            "problem": "Consider a two-dimensional, inviscid, dry atmosphere modeled by small-amplitude perturbations about a hydrostatic, stably stratified background with constant Brunt–Väisälä frequency $N$ and constant sound speed $c_s$. Let the perturbations be of plane-wave form with horizontal wavenumber magnitude $k_h$, vertical wavenumber $m$, and angular frequency $\\omega$, i.e., proportional to $\\exp\\left(i(k_x x + m z - \\omega t)\\right)$ with $k_h^2 = k_x^2$ and $k^2 = k_h^2 + m^2$. Starting from the fundamental base of the compressible Euler equations, the ideal gas equation of state, hydrostatic balance of the background, and the definition of the Brunt–Väisälä frequency as $N^2 = \\frac{g}{\\theta_0}\\frac{d\\theta_0}{dz}$ with constant $N$, derive the linear dispersion relation for the compressible system that admits both fast acoustic modes and slow internal gravity modes. Also, derive the corresponding gravity-wave dispersion relation under the sound-proof assumptions (Boussinesq or anelastic), which filter acoustic waves but retain the slow manifold. Do not assume any shortcut formulas; your derivations must proceed from the stated base.\n\nThen, construct a numerical benchmark that isolates acoustic effects and demonstrates that sound-proof models reproduce the slow manifold while filtering fast modes. Specifically, implement a program that, for each test case $(N, c_s, k_h, m)$:\n1. Computes the two nonnegative angular frequencies $\\omega_{\\text{comp,grav}}$ and $\\omega_{\\text{comp,ac}}$ of the compressible system corresponding to the slow (internal gravity) and fast (acoustic) branches, respectively.\n2. Computes the sound-proof gravity-wave angular frequency $\\omega_{\\text{sp}}$ under the Boussinesq or anelastic approximation for the same $(k_h, m)$.\n3. Reports the relative error of the slow manifold frequency reproduction by the sound-proof model, defined as $e_{\\text{slow}} = \\left|\\omega_{\\text{comp,grav}} - \\omega_{\\text{sp}}\\right| / \\max\\left(\\omega_{\\text{sp}}, \\varepsilon\\right)$, where $\\varepsilon$ is a small positive tolerance, and the separation ratio $r_{\\text{slow/fast}} = \\omega_{\\text{sp}} / \\omega_{\\text{comp,ac}}$. If $\\omega_{\\text{sp}} = 0$ exactly, define $e_{\\text{slow}} = 0$ and $r_{\\text{slow/fast}} = 0$ for that case.\n\nAll angular frequencies $\\omega_{\\text{comp,grav}}$, $\\omega_{\\text{comp,ac}}$, and $\\omega_{\\text{sp}}$ must be expressed in $\\text{s}^{-1}$ as floating-point numbers. The relative error $e_{\\text{slow}}$ and the separation ratio $r_{\\text{slow/fast}}$ are dimensionless floating-point numbers.\n\nUse the following test suite to ensure coverage of a general case, a boundary condition with no horizontal structure, and a boundary condition with no vertical structure. All parameters are specified in consistent SI units:\n- Test case $1$ (general, well-separated scales): $N = 0.01\\,\\text{s}^{-1}$, $c_s = 340\\,\\text{m}\\,\\text{s}^{-1}$, $k_h = \\frac{2\\pi}{100000}\\,\\text{m}^{-1}$, $m = \\frac{2\\pi}{10000}\\,\\text{m}^{-1}$.\n- Test case $2$ (boundary, no horizontal structure): $N = 0.01\\,\\text{s}^{-1}$, $c_s = 340\\,\\text{m}\\,\\text{s}^{-1}$, $k_h = 0\\,\\text{m}^{-1}$, $m = \\frac{2\\pi}{5000}\\,\\text{m}^{-1}$.\n- Test case $3$ (boundary, no vertical structure): $N = 0.01\\,\\text{s}^{-1}$, $c_s = 340\\,\\text{m}\\,\\text{s}^{-1}$, $k_h = \\frac{2\\pi}{100000}\\,\\text{m}^{-1}$, $m = 0\\,\\text{m}^{-1}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case must contribute a sublist in the form $[e_{\\text{slow}}, r_{\\text{slow/fast}}, \\omega_{\\text{sp}}, \\omega_{\\text{comp,grav}}, \\omega_{\\text{comp,ac}}]$, where the last three entries are the angular frequencies in $\\text{s}^{-1}$. For example, the output format must be like $[[a_1,b_1,c_1,d_1,e_1],[a_2,b_2,c_2,d_2,e_2],[a_3,b_3,c_3,d_3,e_3]]$ with the actual numerical values substituted for each test case.",
            "solution": "The user-provided problem statement is subjected to the following validation process.\n\n### Step 1: Extract Givens\n- **Physical System**: A two-dimensional, inviscid, dry atmosphere.\n- **Background State**: A resting ($\\mathbf{u}_0=0$), hydrostatic, stably stratified state.\n- **Constants**: The Brunt–Väisälä frequency $N$ and the sound speed $c_s$ are constant.\n- **Perturbations**: Small-amplitude plane waves of the form $\\exp\\left(i(k_x x + m z - \\omega t)\\right)$.\n- **Wavenumbers**: Horizontal wavenumber magnitude $k_h$ (with $k_h^2=k_x^2$), vertical wavenumber $m$, and total wavenumber magnitude $k$ (with $k^2 = k_h^2 + m^2$).\n- **Fundamental Basis for Derivation**:\n    1. Compressible Euler equations.\n    2. Ideal gas equation of state.\n    3. Hydrostatic balance for the background state.\n    4. Definition of Brunt-Väisälä frequency $N^2 = \\frac{g}{\\theta_0}\\frac{d\\theta_0}{dz}$.\n- **Task 1 (Derivation)**:\n    1. Derive the linear dispersion relation for the compressible system admitting both acoustic and internal gravity modes.\n    2. Derive the dispersion relation for internal gravity waves under a sound-proof approximation (Boussinesq or anelastic).\n- **Task 2 (Numerical)**:\n    1. For each test case $(N, c_s, k_h, m)$, compute the slow compressible frequency $\\omega_{\\text{comp,grav}}$, the fast compressible frequency $\\omega_{\\text{comp,ac}}$, and the sound-proof frequency $\\omega_{\\text{sp}}$.\n    2. Compute the relative error $e_{\\text{slow}} = \\left|\\omega_{\\text{comp,grav}} - \\omega_{\\text{sp}}\\right| / \\max\\left(\\omega_{\\text{sp}}, \\varepsilon\\right)$.\n    3. Compute the separation ratio $r_{\\text{slow/fast}} = \\omega_{\\text{sp}} / \\omega_{\\text{comp,ac}}$.\n    4. Special conditions: If $\\omega_{\\text{sp}} = 0$, then $e_{\\text{slow}} = 0$ and $r_{\\text{slow/fast}} = 0$.\n- **Test Cases (SI Units)**:\n    1. $N = 0.01\\,\\text{s}^{-1}$, $c_s = 340\\,\\text{m}\\,\\text{s}^{-1}$, $k_h = \\frac{2\\pi}{100000}\\,\\text{m}^{-1}$, $m = \\frac{2\\pi}{10000}\\,\\text{m}^{-1}$.\n    2. $N = 0.01\\,\\text{s}^{-1}$, $c_s = 340\\,\\text{m}\\,\\text{s}^{-1}$, $k_h = 0\\,\\text{m}^{-1}$, $m = \\frac{2\\pi}{5000}\\,\\text{m}^{-1}$.\n    3. $N = 0.01\\,\\text{s}^{-1}$, $c_s = 340\\,\\text{m}\\,\\text{s}^{-1}$, $k_h = \\frac{2\\pi}{100000}\\,\\text{m}^{-1}$, $m = 0\\,\\text{m}^{-1}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is a standard topic in geophysical fluid dynamics concerning atmospheric waves. The concepts of Euler equations, Brunt-Väisälä frequency, and sound-proof approximations are fundamental and well-established. The specified assumptions of constant $N$ and $c_s$ are physically consistent with a model of an isothermal, hydrostatically balanced atmosphere.\n- **Well-Posed**: The problem is well-posed. The derivations lead to specific algebraic dispersion relations, and the numerical task involves the direct evaluation of these relations. A unique and meaningful solution exists for the given test cases.\n- **Objective**: The problem is stated using precise, objective scientific language, free from ambiguity or subjective claims.\n\n- **Flaw Checklist**:\n    1. **Scientific/Factual Unsoundness**: None.\n    2. **Non-Formalizable/Irrelevant**: None. The problem is formalizable and directly relevant to the topic of Boussinesq/anelastic models.\n    3. **Incomplete/Contradictory Setup**: The request to derive from \"fundamental base\" while assuming a \"plane-wave form\" for a stratified atmosphere requires a clarifying assumption. A full derivation for a stratified medium (e.g., isothermal) shows that pure plane waves are not solutions due to the variation of background density $\\rho_0(z)$. The solutions are typically of the form $f(z) e^{imz}$ where $f(z)$ accounts for density variation. However, assuming a simple plane-wave form implies a \"local\" analysis where the background state is treated as uniform for the purpose of wave kinematics. This is a standard and necessary simplification to arrive at an algebraic dispersion relation and is evidently intended by the problem statement.\n    4. **Unrealistic/Infeasible**: None. The physical parameters are realistic.\n    5. **Ill-Posed/Poorly Structured**: None.\n    6. **Pseudo-Profound/Trivial**: None. The problem is a standard, non-trivial exercise.\n    7. **Outside Scientific Verifiability**: None.\n\n### Step 3: Verdict and Action\nThe problem is valid. The solution will proceed, with the derivation clarifying the necessary simplifying assumptions.\n\n### Theoretical Derivation\n\nThe derivation of the dispersion relations proceeds from the linearized equations of motion for an inviscid, non-rotating, compressible fluid. The background state is at rest and in hydrostatic balance. A crucial simplifying assumption, implied by the request for a plane-wave solution form, is the \"local approximation,\" where the background density $\\rho_0$ is treated as a constant in the dynamic equations, except when it is coupled to gravity giving rise to buoyancy. This is a common feature of Boussinesq and anelastic models that simplifies the analysis greatly.\n\nThe linearized system of equations for perturbations proportional to $\\exp(i(k_h x + m z - \\omega t))$ is as follows, where $(u', w')$ are velocity perturbations, $p'$ is pressure perturbation, and $b'$ is the buoyancy perturbation $b' = -g\\rho'/\\rho_0$:\n\n1.  **Horizontal momentum**: $-i\\omega u' = -ik_h p'/\\rho_0$\n2.  **Vertical momentum**: $-i\\omega w' = -im p'/\\rho_0 - b'$\n3.  **Continuity (anelastic form)**: The sound-proof anelastic approximation filters sound waves by assuming $\\nabla \\cdot (\\rho_0 \\mathbf{u'}) = 0$. A common formulation for compressible flow that captures acoustic phenomena arises from a modified continuity equation: $\\partial_t p' + \\rho_0 c_s^2 \\nabla \\cdot \\mathbf{u}' = 0$. In Fourier space, this is: $-i\\omega p' + \\rho_0 c_s^2(ik_h u' + im w') = 0$.\n4.  **Thermodynamic equation**: The evolution of buoyancy is governed by vertical displacement in a stratified fluid: $\\partial_t b' = N^2 w'$, which in Fourier space is: $-i\\omega b' = N^2 w'$.\n\nWe can combine these four algebraic equations to find the dispersion relation $\\omega(k_h, m)$.\n\nFrom (4), we express buoyancy in terms of vertical velocity: $b' = \\frac{iN^2}{\\omega} w'$.\nSubstituting this into (2):\n$-i\\omega w' = -im p'/\\rho_0 - \\frac{iN^2}{\\omega} w'$\nMultiplying by $i\\omega\\rho_0$:\n$\\omega^2 \\rho_0 w' = m\\omega p' - N^2\\rho_0 w' \\implies (\\omega^2 - N^2) w' = \\frac{m\\omega}{\\rho_0} p'$\nThis gives a relationship between $w'$ and $p'$:\n$$ (\\omega^2 - N^2)w' = \\frac{m\\omega}{\\rho_0} p' \\quad (1) $$\n\nFrom (1), we have $u' = \\frac{k_h}{\\omega\\rho_0}p'$. Substituting this into the anelastic continuity equation (3):\n$-i\\omega p' + i\\rho_0 c_s^2 (k_h \\frac{k_h}{\\omega\\rho_0}p' + m w') = 0$\n$\\omega p' - c_s^2 (\\frac{k_h^2}{\\omega}p' + \\rho_0 m w') = 0$\n$p' (\\omega - \\frac{c_s^2 k_h^2}{\\omega}) = c_s^2 \\rho_0 m w'$\n$$ p'(\\omega^2 - c_s^2 k_h^2) = \\omega c_s^2 \\rho_0 m w' \\quad (2) $$\n\nWe now have a system of two equations for $p'$ and $w'$. For a non-trivial solution, we can eliminate the variables. From (1), $p' = w' \\frac{\\rho_0(\\omega^2-N^2)}{m\\omega}$. Substituting this into (2):\n$w' \\frac{\\rho_0(\\omega^2-N^2)}{m\\omega} (\\omega^2 - c_s^2 k_h^2) = \\omega c_s^2 \\rho_0 m w'$\nAssuming $w' \\neq 0$:\n$(\\omega^2-N^2)(\\omega^2 - c_s^2 k_h^2) = m^2 c_s^2 \\omega^2$\nExpanding and rearranging gives the dispersion relation for compressible acoustic-gravity waves:\n$\\omega^4 - \\omega^2 c_s^2 k_h^2 - N^2 \\omega^2 + N^2 c_s^2 k_h^2 - m^2 c_s^2 \\omega^2 = 0$\n$$ \\omega^4 - \\omega^2 [N^2 + c_s^2(k_h^2 + m^2)] + N^2 c_s^2 k_h^2 = 0 $$\nThis is a quadratic equation in $\\omega^2$. Let $k^2 = k_h^2 + m^2$.\n$$ (\\omega^2)^2 - (N^2 + c_s^2 k^2)\\omega^2 + N^2 c_s^2 k_h^2 = 0 $$\nThe solutions for $\\omega^2$ are:\n$$ \\omega^2 = \\frac{1}{2} \\left[ (N^2 + c_s^2 k^2) \\pm \\sqrt{(N^2 + c_s^2 k^2)^2 - 4N^2 c_s^2 k_h^2} \\right] $$\nThe positive sign corresponds to the fast acoustic branch ($\\omega_{\\text{comp,ac}}$), and the negative sign corresponds to the slow internal gravity wave branch ($\\omega_{\\text{comp,grav}}$).\n\n#### Sound-Proof Dispersion Relation ($\\omega_{\\text{sp}}$)\n\nThe sound-proof models (Boussinesq or anelastic) are designed to filter out acoustic waves. Mathematically, this limit can be obtained by letting $c_s \\to \\infty$. This implies that the fluid is effectively incompressible for the slow modes. To see this, we examine the low-frequency branch $\\omega_{\\text{comp,grav}}^2$ in the limit of large $c_s$:\nThe term under the square root can be factored:\n$ \\sqrt{c_s^4 k^4 + 2N^2 c_s^2 k^2 + N^4 - 4N^2 c_s^2 k_h^2} = c_s^2 k^2 \\sqrt{1 + \\frac{2N^2}{c_s^2 k^2} - \\frac{4N^2 k_h^2}{c_s^4 k^4} + \\mathcal{O}(c_s^{-8})} $\nUsing the Taylor expansion $\\sqrt{1+x} \\approx 1+x/2$ for small $x$:\n$ \\sqrt{\\dots} \\approx c_s^2 k^2 \\left( 1 + \\frac{N^2}{c_s^2 k^2} - \\frac{2N^2 k_h^2}{c_s^4 k^4} \\right) $\nSubstituting this into the expression for $\\omega_{\\text{comp,grav}}^2$:\n$ \\omega_{\\text{comp,grav}}^2 \\approx \\frac{1}{2} \\left[ (N^2 + c_s^2 k^2) - c_s^2 k^2 \\left( 1 + \\frac{N^2}{c_s^2 k^2} - \\frac{2N^2 k_h^2}{c_s^4 k^4} \\right) \\right] $\n$ \\omega_{\\text{comp,grav}}^2 \\approx \\frac{1}{2} \\left[ N^2 + c_s^2 k^2 - c_s^2 k^2 - N^2 + \\frac{2N^2 k_h^2}{c_s^2 k^2} \\right] = \\frac{N^2 k_h^2}{k^2}$\nThis gives the dispersion relation for internal gravity waves under the sound-proof (Boussinesq/anelastic) approximation:\n$$ \\omega_{\\text{sp}}^2 = \\frac{N^2 k_h^2}{k_h^2 + m^2} $$\n\n### Numerical Implementation\n\nThe numerical benchmark will be implemented in Python using the `numpy` library. For each test case defined by $(N, c_s, k_h, m)$, the program will:\n1.  Calculate the sound-proof frequency $\\omega_{\\text{sp}}$ using $\\omega_{\\text{sp}} = \\sqrt{\\frac{N^2 k_h^2}{k_h^2 + m^2}}$. A small tolerance is used to handle the case $k_h=m=0$, although this is not among the test cases. If $k_h=0$, $\\omega_{\\text{sp}}=0$.\n2.  Calculate the two compressible frequencies $\\omega_{\\text{comp,grav}}$ and $\\omega_{\\text{comp,ac}}$. Let $A = N^2 + c_s^2(k_h^2 + m^2)$ and $B = 4N^2 c_s^2 k_h^2$.\n    -   $\\omega_{\\text{comp,ac}} = \\sqrt{\\frac{1}{2}(A + \\sqrt{A^2-B})}$\n    -   $\\omega_{\\text{comp,grav}} = \\sqrt{\\frac{1}{2}(A - \\sqrt{A^2-B})}$\n    The discriminant $A^2-B$ is guaranteed to be non-negative.\n3.  Compute the metrics $e_{\\text{slow}}$ and $r_{\\text{slow/fast}}$. The tolerance $\\varepsilon$ is set to a small machine-precision value (e.g., $10^{-15}$) to prevent division by zero in the definition of $e_{\\text{slow}}$. The special case for $\\omega_{\\text{sp}} = 0$ is handled as specified.\n4.  The results for each test case, consisting of $[e_{\\text{slow}}, r_{\\text{slow/fast}}, \\omega_{\\text{sp}}, \\omega_{\\text{comp,grav}}, \\omega_{\\text{comp,ac}}]$, will be collected and printed in the required list-of-lists format.\n\nThe special cases in the test suite are correctly handled by these formulas:\n-   If $k_h = 0$ (Test Case 2), then $\\omega_{\\text{sp}}=0$. The full compressible relation yields $\\omega_{\\text{comp,grav}}^2=0$ and $\\omega_{\\text{comp,ac}}^2 = N^2 + c_s^2 m^2$.\n-   If $m = 0$ (Test Case 3), then $\\omega_{\\text{sp}}^2=N^2$. The full relation yields $\\omega_{\\text{comp,grav}}^2=N^2$ and $\\omega_{\\text{comp,ac}}^2 = c_s^2 k_h^2$, assuming $c_s^2k_h^2 > N^2$, which holds for the given parameters.\nIn both boundary cases, the sound-proof model exactly reproduces the slow branch of the compressible model, resulting in $e_{\\text{slow}}=0$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes acoustic/gravity wave frequencies and comparison metrics.\n    \"\"\"\n\n    # Define the small tolerance for division stability.\n    epsilon = 1e-15\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (N, c_s, k_h, m) in SI units.\n    test_cases = [\n        (0.01, 340.0, 2.0 * np.pi / 100000.0, 2.0 * np.pi / 10000.0),  # General case\n        (0.01, 340.0, 0.0, 2.0 * np.pi / 5000.0),                      # No horizontal structure\n        (0.01, 340.0, 2.0 * np.pi / 100000.0, 0.0),                      # No vertical structure\n    ]\n\n    results = []\n    for case in test_cases:\n        N, c_s, k_h, m = case\n\n        # --- Sound-Proof Model Frequency (omega_sp) ---\n        N_sq = N**2\n        kh_sq = k_h**2\n        m_sq = m**2\n        k_total_sq = kh_sq + m_sq\n\n        if k_total_sq  epsilon:\n            w_sp = 0.0\n        else:\n            w_sp_sq = (N_sq * kh_sq) / k_total_sq\n            w_sp = np.sqrt(w_sp_sq)\n\n        # --- Compressible Model Frequencies (omega_comp_grav, omega_comp_ac) ---\n        cs_sq = c_s**2\n        \n        # The dispersion relation is a quadratic equation for omega^2:\n        # (omega^2)^2 - A * (omega^2) + B = 0\n        # A = N^2 + c_s^2 * (k_h^2 + m^2)\n        # B = N^2 * c_s^2 * k_h^2\n        A = N_sq + cs_sq * k_total_sq\n        B = N_sq * cs_sq * kh_sq\n        \n        discriminant = A**2 - 4.0 * B\n        # Discriminant is theoretically non-negative.\n        # Add safeguard for floating point inaccuracies.\n        if discriminant  0:\n            discriminant = 0.0\n            \n        sqrt_discriminant = np.sqrt(discriminant)\n        \n        # Solve for the two omega^2 roots\n        w_sq_ac = (A + sqrt_discriminant) / 2.0    # Fast (acoustic) branch\n        w_sq_grav = (A - sqrt_discriminant) / 2.0  # Slow (gravity) branch\n        \n        w_comp_ac = np.sqrt(w_sq_ac)\n        w_comp_grav = np.sqrt(w_sq_grav)\n\n        # --- Calculate Metrics: Relative Error and Separation Ratio ---\n        if abs(w_sp)  epsilon:\n            # Special case as defined in the problem\n            e_slow = 0.0\n            r_slow_fast = 0.0\n        else:\n            # Relative error in slow manifold reproduction\n            e_slow = abs(w_comp_grav - w_sp) / max(w_sp, epsilon)\n            \n            # Separation ratio between slow and fast modes\n            if abs(w_comp_ac)  epsilon:\n                # This case implies c_s=0 or k=0, avoid division by zero.\n                r_slow_fast = np.inf\n            else:\n                r_slow_fast = w_sp / w_comp_ac\n        \n        results.append([e_slow, r_slow_fast, w_sp, w_comp_grav, w_comp_ac])\n\n    # Final print statement in the exact required format.\n    # Convert numerical results to string format for printing.\n    output_str = \"[\"\n    for i, res in enumerate(results):\n        output_str += f\"[{','.join(f'{val:.6e}' for val in res)}]\"\n        if i  len(results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    \n    # Per final instructions, use Python's default float representation. Let's adjust.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}