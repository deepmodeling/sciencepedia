{
    "hands_on_practices": [
        {
            "introduction": "To effectively control aliasing, one must first build a solid intuition for its underlying mechanism. This foundational exercise guides you through an analytical calculation to reveal precisely how the discrete sampling process on a finite grid causes high-wavenumber information, generated by a nonlinear product, to be erroneously \"folded back\" and misrepresented as a lower-wavenumber component. By tracing the fate of interacting waves near the Nyquist frequency, you will see firsthand how spurious modes are created and contaminate the resolved spectrum .",
            "id": "3423339",
            "problem": "Consider the standard pseudospectral discretization of a $2\\pi$-periodic function on $[0,2\\pi)$ using $N$ equispaced grid points $x_j = 2\\pi j/N$, where $N$ is an even integer. The Discrete Fourier Transform (DFT) on this grid represents Fourier modes with integer wavenumber indices in the principal set $\\{-\\frac{N}{2}+1,\\ldots,-1,0,1,\\ldots,\\frac{N}{2}\\}$, and convolution in spectral space wraps indices modulo $N$. Let $u(x)=\\sin(kx)$ and $v(x)=\\sin(\\ell x)$ with $k=\\frac{N}{2}-1$ and $\\ell=\\frac{N}{2}-2$. The pointwise product $w(x)=u(x)v(x)$ is evaluated on the physical grid and then transformed back to spectral space.\n\nStarting from first principles:\n- The trigonometric product-to-sum identity.\n- The interpretation of Fourier multiplication as convolution of modal coefficients.\n- The wrap-around of convolution modulo $N$ for the DFT, which causes aliasing into the principal index set.\n\nAnswer the following in the context of quadratic aliasing control.\n1) If the product $w(x)$ is computed on the original $N$-point grid without any padding, identify the aliased wavenumber index in the principal set corresponding to the high-frequency sum-harmonic in $w(x)$.\n2) If instead the “three-halves” de-aliasing rule is used (that is, zero-pad to a grid of size $P=\\frac{3N}{2}$ in spectral space, transform to physical space, compute the product on the $P$-point grid, transform back, and then truncate to the original $N$-mode band), identify the unaliased high-frequency wavenumber index of the sum-harmonic prior to truncation (that is, the true sum-harmonic index on the integer wavenumber line).\n\nExpress your final answer as a row matrix with two entries $\\big(m_{\\text{alias}},\\,m_{\\text{true}}\\big)$, where $m_{\\text{alias}}$ is the aliased index found in part (1) and $m_{\\text{true}}$ is the true high-frequency sum-harmonic index found in part (2). No rounding is required. Do not include units.",
            "solution": "The problem requires us to analyze the phenomenon of aliasing in the context of a pseudospectral method. We are given two sinusoidal functions, $u(x)$ and $v(x)$, and we need to determine the wavenumber of the sum-harmonic in their product, $w(x)=u(x)v(x)$, under two different computational scenarios.\n\nThe functions are given by $u(x) = \\sin(kx)$ and $v(x) = \\sin(\\ell x)$, with integer wavenumbers $k=\\frac{N}{2}-1$ and $\\ell=\\frac{N}{2}-2$. Here, $N$ is the number of equispaced grid points on the interval $[0, 2\\pi)$ and is an even integer.\n\nFirst, we establish the analytical form of the product $w(x)$ using the trigonometric product-to-sum identity:\n$$ \\sin(A)\\sin(B) = \\frac{1}{2}\\left[\\cos(A-B) - \\cos(A+B)\\right] $$\nApplying this identity to $w(x)=u(x)v(x)$, we get:\n$$ w(x) = \\sin(kx)\\sin(\\ell x) = \\frac{1}{2}\\left[\\cos((k-\\ell)x) - \\cos((k+\\ell)x)\\right] $$\nThis shows that the product $w(x)$ is a superposition of two cosine waves. The wavenumbers of these components are the difference-harmonic, $m_{\\text{diff}} = k-\\ell$, and the sum-harmonic, $m_{\\text{sum}} = k+\\ell$.\n\nSubstituting the given values for $k$ and $\\ell$:\n$$ m_{\\text{diff}} = k-\\ell = \\left(\\frac{N}{2}-1\\right) - \\left(\\frac{N}{2}-2\\right) = 1 $$\n$$ m_{\\text{sum}} = k+\\ell = \\left(\\frac{N}{2}-1\\right) + \\left(\\frac{N}{2}-2\\right) = N-3 $$\nSo, the exact analytical product is $w(x) = \\frac{1}{2}\\left[\\cos(x) - \\cos((N-3)x)\\right]$. The high-frequency sum-harmonic corresponds to the term $\\cos((N-3)x)$, which is composed of complex exponentials with wavenumbers $\\pm(N-3)$.\n\n**Part 1: Aliased Wavenumber on an $N$-point Grid**\n\nA pseudospectral method on an $N$-point grid can only represent a finite set of wavenumbers without ambiguity. The problem specifies this set, the principal set, as $\\{-\\frac{N}{2}+1, \\ldots, \\frac{N}{2}\\}$. Any wavenumber $m$ outside this set is aliased to a wavenumber $m_{\\text{alias}}$ inside the set, where $m_{\\text{alias}}$ is congruent to $m$ modulo $N$. That is, $m_{\\text{alias}} = m + qN$ for some integer $q$ such that $m_{\\text{alias}}$ is in the principal set.\n\nThe high-frequency sum-harmonic has a true wavenumber of $m = N-3$. We need to find its alias in the principal set. We are looking for an integer $q$ such that $-\\frac{N}{2}+1 \\le (N-3) + qN \\le \\frac{N}{2}$.\nChoosing $q=-1$, we get:\n$$ m_{\\text{alias}} = (N-3) - N = -3 $$\nWe must verify that this aliased wavenumber lies within the principal set $\\{-\\frac{N}{2}+1, \\ldots, \\frac{N}{2}\\}$. The condition is $-\\frac{N}{2}+1 \\le -3$. This simplifies to $4 \\le \\frac{N}{2}$, or $N \\ge 8$. The problem is posed for a general even $N$, and the wavenumbers $k$ and $\\ell$ are chosen to be close to the Nyquist frequency $\\frac{N}{2}$, which is characteristic of scenarios where aliasing is a major concern. For small $N$ (e.g., $N=4$ or $N=6$), the sum-harmonic $N-3$ might fall within the principal set, meaning no aliasing occurs for that specific component. However, the general case, implied by the context of aliasing control rules, is for $N$ sufficiently large that the sum-harmonic falls outside the representable range. Thus, assuming $N \\ge 8$, the aliased wavenumber from the sum-harmonic $k+\\ell=N-3$ is $m_{\\text{alias}} = -3$.\n\n**Part 2: Unaliased Wavenumber using the Three-Halves Rule**\n\nThe second part of the problem asks for the unaliased, true wavenumber of the sum-harmonic. The context provided is the \"three-halves\" de-aliasing rule, a procedure designed to compute nonlinear products without aliasing. The procedure involves padding the spectral representation of the functions with zeros to increase the resolution, performing the product on a finer physical grid ($P=\\frac{3N}{2}$ points), and then transforming back.\n\nThe question is: \"identify the unaliased high-frequency wavenumber index of the sum-harmonic prior to truncation (that is, the true sum-harmonic index on the integer wavenumber line)\". The parenthetical part of this question explicitly defines the desired quantity: it is the true wavenumber of the sum-harmonic component as it exists in the analytical product, before any discrete grid effects (like aliasing) are considered. This de-aliasing procedure is the tool one would use to attempt to compute this true value numerically. The question asks for the theoretical target of this computation.\n\nAs determined from the product-to-sum identity, the true sum-harmonic is $m_{\\text{sum}} = k+\\ell$.\n$$ m_{\\text{true}} = k+\\ell = \\left(\\frac{N}{2}-1\\right) + \\left(\\frac{N}{2}-2\\right) = N-3 $$\nThis is the wavenumber of the high-frequency component in the exact solution. The purpose of the de-aliasing rule is to accurately capture this component. While for the specific high wavenumbers given, the $P=\\frac{3N}{2}$ grid may not be sufficient to prevent aliasing if $N \\ge 12$ (since the true wavenumber $N-3$ would exceed the padded grid's Nyquist limit of $P/2 = 3N/4$), the question is asking for the value that this procedure *intends* to find, which is the true analytical wavenumber.\n\nTherefore, the true high-frequency sum-harmonic index is $m_{\\text{true}} = N-3$.\n\n**Summary of Results**\nThe aliased wavenumber index on the $N$-point grid is $m_{\\text{alias}} = -3$.\nThe true high-frequency sum-harmonic index is $m_{\\text{true}} = N-3$.\n\nThe final answer is requested as a row matrix $\\begin{pmatrix} m_{\\text{alias}} & m_{\\text{true}} \\end{pmatrix}$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} -3 & N-3 \\end{pmatrix} } $$"
        },
        {
            "introduction": "Moving from analytical theory to practical implementation is a critical step in mastering numerical methods. This hands-on coding practice challenges you to build a numerical experiment from the ground up to observe aliasing directly . You will generate aliasing errors for a simple quadratic nonlinearity in a one-dimensional setting and then implement the classic Orszag 2/3-rule, a cornerstone of spectral modeling, to demonstrate its effectiveness in cleaning the spectrum and restoring numerical accuracy.",
            "id": "4011188",
            "problem": "Construct a complete, runnable program that implements a numerical experiment to demonstrate aliasing of triad interactions in a quadratic nonlinearity on a one-dimensional periodic transform grid and shows how applying the two-thirds truncation rule alters energy transfer. The experiment must use a Discrete Fourier Transform (DFT) grid with an even number of points $N$ on a periodic domain, and it must start from foundational principles of spectral transforms, convolution, and sampling.\n\nStart from the following base facts and definitions:\n- The Discrete Fourier Transform (DFT) on a periodic grid of $N$ points supports integer Fourier modes $k$ with $|k| \\leq k_{\\max}$, where the Nyquist wavenumber is $k_{\\max} = N/2$ for even $N$.\n- The Fast Fourier Transform (FFT) and Inverse Fast Fourier Transform (IFFT) implement the DFT efficiently. In standard practice, the IFFT includes a factor of $1/N$.\n- For a real scalar field $u(x)$ on the periodic grid, a quadratic nonlinearity such as $q(x) = u(x)^2$ produces spectral triad interactions: the Fourier spectrum $\\widehat{q}(k)$ is a discrete convolution of $\\widehat{u}(k)$ with itself, generating components at sum and difference wavenumbers, including $k = k_1 + k_2$ and $k = k_1 - k_2$.\n- In a truncated discrete spectrum, any interaction producing a wavenumber $k$ with $|k| > k_{\\max}$ is aliased back into the representable range by modular wrapping, which contaminates lower wavenumbers. For sums with $k_1 + k_2 \\leq N$, the aliased magnitude can be represented by $k_{\\text{alias}} = |(k_1 + k_2) - N|$ when $k_1 + k_2 > k_{\\max}$, and $k_{\\text{alias}} = k_1 + k_2$ when $k_1 + k_2 \\leq k_{\\max}$.\n- The two-thirds truncation rule (also known as the Orszag $2/3$-rule) for quadratic nonlinearities removes aliasing errors by zeroing Fourier modes above a cutoff $K_c \\approx (2/3)k_{\\max}$ before forming products in physical space and then re-truncating after the nonlinear operation. To strictly avoid boundary issues, use $K_c = \\lfloor (2/3)k_{\\max} \\rfloor - 1$.\n\nProgram specification:\n1. Use a one-dimensional periodic grid with $N$ points. Construct a real-valued initial field $u(x)$ consisting of the sum of two cosine Fourier modes with wavenumbers $k_1$ and $k_2$ and amplitudes $A_1$ and $A_2$, respectively. Implement $u(x)$ by constructing the Fourier coefficients $\\widehat{u}(k)$ explicitly so that the inverse transform yields $u(x) = A_1 \\cos(2\\pi k_1 j/N) + A_2 \\cos(2\\pi k_2 j/N)$ at grid index $j$.\n2. Compute $q(x) = u(x)^2$ pointwise in physical space and transform to the spectrum $\\widehat{q}(k)$ using an FFT to obtain the non-dealiased result. Let $E_{\\text{naive}}$ be the spectral energy associated with the triad sum at the aliased magnitude $k_{\\text{alias}}$, defined as the sum of squared magnitudes of $\\widehat{q}(k)$ at the positive and negative indices corresponding to $k_{\\text{alias}}$ (for $k_{\\text{alias}} \\neq 0$), or the squared magnitude at zero if $k_{\\text{alias}} = 0$.\n3. Apply the two-thirds truncation rule by zeroing all Fourier coefficients of $u$ with $|k| > K_c$ prior to computing $q(x)$, then form $q(x) = u(x)^2$, transform to $\\widehat{q}(k)$, and re-apply the truncation by zeroing all modes above $K_c$ in $\\widehat{q}(k)$. Let $E_{2/3}$ be the energy at $k_{\\text{alias}}$ defined as in step $2$ for the de-aliased spectrum.\n4. For each test case, return the pair $\\left[E_{\\text{naive}}, E_{2/3}\\right]$.\n\nYour program must hard-code and evaluate the following test suite, which probes distinct facets including a general case, a boundary case, and a non-aliasing case:\n- Test case $1$: $N = 96$, $k_1 = 40$, $k_2 = 20$, $A_1 = 1.0$, $A_2 = 1.0$.\n- Test case $2$: $N = 96$, $k_1 = 32$, $k_2 = 32$, $A_1 = 0.8$, $A_2 = 0.8$.\n- Test case $3$: $N = 96$, $k_1 = 10$, $k_2 = 12$, $A_1 = 1.2$, $A_2 = 0.7$.\n- Test case $4$: $N = 128$, $k_1 = 41$, $k_2 = 41$, $A_1 = 0.9$, $A_2 = 0.9$.\n\nFinal output requirement:\n- Your program should produce a single line of output containing the results as a comma-separated list of pairs, with no spaces, enclosed in square brackets. For example: $[[e_{1,\\text{naive}},e_{1,2/3}],[e_{2,\\text{naive}},e_{2,2/3}],\\dots]$. Each $e$ must be a floating-point number.\n\nAll quantities are dimensionless; do not attach any physical units or angle units. The answers for each test case must be numerical floats. The program must be fully self-contained and require no input.",
            "solution": "The problem statement is scientifically sound, well-posed, and provides a complete specification for a numerical experiment. It is a valid inquiry into the nature of aliasing in spectral methods for nonlinear systems and the application of the two-thirds truncation rule for de-aliasing. We may therefore proceed with a solution.\n\nThe core of this problem lies in understanding how discrete Fourier transforms represent nonlinear interactions and how wavenumbers outside the resolved range, $|k| \\leq k_{\\max}$, are misrepresented as different, lower wavenumbers, a phenomenon known as aliasing. We will demonstrate this contamination and its removal using the specified numerical experiment.\n\n**1. Theoretical Foundation**\n\nA real-valued function $u(x)$ on a periodic domain can be represented by a Fourier series. On a discrete grid of $N$ points, $x_j=j\\Delta x$ for $j=0, 1, \\dots, N-1$, this becomes a Discrete Fourier Transform (DFT). A real function $u(x_j)$ composed of cosine waves is defined as:\n$$\nu(x_j) = A_1 \\cos\\left(\\frac{2\\pi k_1 j}{N}\\right) + A_2 \\cos\\left(\\frac{2\\pi k_2 j}{N}\\right)\n$$\nUsing Euler's formula, $\\cos(\\theta) = \\frac{1}{2}(e^{i\\theta} + e^{-i\\theta})$, we can express $u(x_j)$ in terms of complex exponentials, which form the basis of the DFT. The standard forward and inverse DFT pair (as implemented in `numpy`) is:\n$$\n\\widehat{u}(k) = \\sum_{j=0}^{N-1} u(x_j) e^{-i 2\\pi kj/N} \\quad \\text{(FFT)}\n$$\n$$\nu(x_j) = \\frac{1}{N} \\sum_{k=0}^{N-1} \\widehat{u}(k) e^{i 2\\pi kj/N} \\quad \\text{(IFFT)}\n$$\nTo construct the specified $u(x_j)$ from its spectral coefficients, we must set the coefficients $\\widehat{u}(k)$ such that the IFFT yields the desired function. For a single term $A \\cos(2\\pi k_0 j/N)$, the corresponding non-zero spectral coefficients are $\\widehat{u}(k_0) = A N/2$ and $\\widehat{u}(-k_0) = A N/2$. In the discrete index range $0, \\dots, N-1$, the coefficient for wavenumber $-k_0$ is stored at index $N-k_0$.\n\nThe quadratic nonlinearity $q(x) = u(x)^2$ in physical space corresponds to a convolution of the spectrum with itself in Fourier space:\n$$\n\\widehat{q}(k) = (\\widehat{u} * \\widehat{u})(k) = \\sum_{k'=0}^{N-1} \\widehat{u}(k') \\widehat{u}(k-k')\n$$\nThis convolution generates new modes at sum and difference wavenumbers. For an initial field with modes $k_1$ and $k_2$, the product $u(x)^2$ will generate modes at $2k_1$, $2k_2$, $k_1+k_2$, and $k_1-k_2$ (and their negatives), as well as a zero-frequency component ($k=0$).\n\n**2. Aliasing**\n\nThe DFT grid can only represent a finite range of wavenumbers, up to the Nyquist limit $k_{\\max} = N/2$. If an interaction creates a mode with magnitude greater than $k_{\\max}$, e.g., $k_{true} = k_1+k_2 > k_{\\max}$, this mode is erroneously `aliased` to a representable wavenumber $k_{alias}$. For interactions where $k_1+k_2 \\leq N$, the aliased wavenumber is given by the problem as $k_{alias} = |(k_1+k_2) - N|$ if $k_1+k_2>k_{\\max}$, and $k_{alias}=k_1+k_2$ otherwise. This is a direct consequence of the periodicity of the discrete exponential basis functions, $e^{i 2\\pi k_{true} j/N} = e^{i 2\\pi (k_{true} \\pmod N) j/N}$. The energy that should be in the high-wavenumber mode $k_{true}$ contaminates the mode $k_{alias}$.\n\n**3. The Two-Thirds Truncation Rule**\n\nTo prevent this contamination, the two-thirds truncation rule is applied. The strategy is to create a \"padded\" region in the upper part of the spectrum.\n1. All Fourier coefficients $\\widehat{u}(k)$ for which $|k|$ exceeds a truncation wavenumber $K_c$ are set to zero. The problem specifies $K_c = \\lfloor (2/3) k_{\\max} \\rfloor - 1$.\n2. This truncated spectrum, $\\widehat{u}_{\\text{trunc}}(k)$, is transformed back to physical space to get $u_{\\text{trunc}}(x)$.\n3. The quadratic product $q_{\\text{trunc}}(x) = u_{\\text{trunc}}(x)^2$ is computed. Interactions between modes $|k'|, |k''| \\le K_c$ can at most produce modes with wavenumber $|k'|+|k''| \\le 2K_c$.\n4. The de-aliasing condition is that the highest generated wavenumber, $2K_c$, should not be large enough to alias back into the trusted spectral region $[-K_c, K_c]$. This requires $2K_c < N-K_c$, or $K_c < N/3$. Since $k_{\\max}=N/2$, this is equivalent to $K_c < (2/3)k_{\\max}$, which our chosen $K_c$ satisfies.\n5. After computing $q_{\\text{trunc}}(x)$, it is transformed back to get $\\widehat{q}_{\\text{trunc}}(k)$. Critically, any modes with $|k|>K_c$ are again zeroed out. This removes any legitimate high-wavenumber power, but more importantly, it ensures there is no aliased power contaminating modes within $|k| \\le K_c$.\n\n**4. Experimental Procedure**\n\nFor each test case, we perform two parallel computations.\n\n**Computation A: Naive (Aliased) Case**\n1. Construct the full spectral representation $\\widehat{u}(k)$ with modes at $\\pm k_1$ and $\\pm k_2$.\n2. Compute $u(x) = \\text{IFFT}[\\widehat{u}(k)]$.\n3. Compute $q(x) = u(x)^2$.\n4. Compute $\\widehat{q}_{\\text{naive}}(k) = \\text{FFT}[q(x)]$.\n5. Determine the target wavenumber $k_{alias}$ from $k_1+k_2$.\n6. Calculate the energy $E_{\\text{naive}} = |\\widehat{q}_{\\text{naive}}(k_{alias})|^2 + |\\widehat{q}_{\\text{naive}}(-k_{alias})|^2$.\n\n**Computation B: De-aliased (2/3-Rule) Case**\n1. Construct the full spectral representation $\\widehat{u}(k)$ as before.\n2. Create a truncated copy $\\widehat{u}_{\\text{trunc}}(k)$ by zeroing all coefficients where $|k| > K_c = \\lfloor (2/3)N/2 \\rfloor - 1$.\n3. Compute $u_{\\text{trunc}}(x) = \\text{IFFT}[\\widehat{u}_{\\text{trunc}}(k)]$.\n4. Compute $q_{\\text{trunc}}(x) = u_{\\text{trunc}}(x)^2$.\n5. Compute $\\widehat{q}_{\\text{trunc}}(k) = \\text{FFT}[q_{\\text{trunc}}(x)]$.\n6. Create the final de-aliased spectrum $\\widehat{q}_{2/3}(k)$ by zeroing all coefficients of $\\widehat{q}_{\\text{trunc}}(k)$ where $|k| > K_c$.\n7. Calculate the energy $E_{2/3} = |\\widehat{q}_{2/3}(k_{alias})|^2 + |\\widehat{q}_{2/3}(-k_{alias})|^2$.\n\nThis procedure will demonstrate that in cases where aliasing occurs (e.g., test cases $1, 2, 4$), $E_{\\text{naive}}$ is non-zero while $E_{2/3}$ is zero, as the de-aliasing procedure correctly removes the spurious energy. In the non-aliasing case (test case $3$), both will be non-zero and should be equal because the interacting modes and their product all fall within the truncated region $|k| \\le K_c$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a numerical experiment to demonstrate aliasing in a quadratic\n    nonlinearity on a 1D periodic grid and its removal via the 2/3-rule.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, k1, k2, A1, A2)\n        (96, 40, 20, 1.0, 1.0),\n        (96, 32, 32, 0.8, 0.8),\n        (96, 10, 12, 1.2, 0.7),\n        (128, 41, 41, 0.9, 0.9),\n    ]\n\n    results = []\n    for N, k1, k2, A1, A2 in test_cases:\n        # --- Common setup for this test case ---\n        k_max = N // 2\n        \n        # Calculate target wavenumber k_alias from the sum k1+k2\n        k_sum = k1 + k2\n        if k_sum > k_max:\n            k_alias = abs(k_sum - N)\n        else:\n            k_alias = k_sum\n            \n        # Construct the initial field in spectral space\n        u_hat = np.zeros(N, dtype=np.complex128)\n        if k1 == k2:\n            # If wavenumbers are the same, sum their amplitudes\n            # Special cases k=0 or k=N/2 not needed for these test cases\n            if k1 > 0 and k1  k_max:\n                u_hat[k1] = (A1 + A2) * N / 2.0\n                u_hat[N - k1] = (A1 + A2) * N / 2.0\n        else:\n            # Different wavenumbers get their own coefficients\n            if k1 > 0 and k1  k_max:\n                u_hat[k1] = A1 * N / 2.0\n                u_hat[N - k1] = A1 * N / 2.0\n            if k2 > 0 and k2  k_max:\n                u_hat[k2] += A2 * N / 2.0\n                u_hat[N - k2] += A2 * N / 2.0\n\n        # --- 1. Naive (Aliased) Computation ---\n        # Transform to physical space\n        u_naive = np.fft.ifft(u_hat).real\n        \n        # Compute quadratic nonlinearity\n        q_naive = u_naive**2\n        \n        # Transform back to spectral space\n        q_hat_naive = np.fft.fft(q_naive)\n        \n        # Calculate energy at the aliased wavenumber\n        # The sum of squared magnitudes at +k_alias and -k_alias\n        # Note: k_alias=0 or k_alias=k_max are not hit by the tests\n        E_naive = np.abs(q_hat_naive[k_alias])**2 + np.abs(q_hat_naive[N - k_alias])**2\n\n        # --- 2. De-aliased Computation (2/3-Rule) ---\n        # Calculate the truncation wavenumber Kc\n        # Using the specified conservative definition\n        Kc = int(np.floor(2.0/3.0 * k_max)) - 1\n        \n        # Apply truncation to the initial field spectrum\n        u_hat_trunc = u_hat.copy()\n        u_hat_trunc[Kc + 1 : N - Kc] = 0\n        \n        # Transform truncated spectrum to physical space\n        u_trunc = np.fft.ifft(u_hat_trunc).real\n        \n        # Compute quadratic nonlinearity\n        q_trunc = u_trunc**2\n        \n        # Transform back to spectral space\n        q_hat_trunc = np.fft.fft(q_trunc)\n        \n        # Re-apply truncation to the resulting spectrum\n        q_hat_dealiased = q_hat_trunc.copy()\n        q_hat_dealiased[Kc + 1 : N - Kc] = 0\n        \n        # Calculate energy at the aliased wavenumber from the de-aliased spectrum\n        E_23 = np.abs(q_hat_dealiased[k_alias])**2 + np.abs(q_hat_dealiased[N - k_alias])**2\n\n        results.append(f\"[{E_naive},{E_23}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In complex geophysical fluid dynamics simulations, aliasing does more than introduce abstract numerical errors; it corrupts the representation of fundamental physical processes like the transfer of energy across different scales. This advanced practice applies your understanding of aliasing control to a two-dimensional incompressible flow, a scenario highly relevant to atmospheric and oceanic modeling . By comparing simulations with and without de-aliasing, you will quantify how aliasing pollutes the spectral energy flux, a critical diagnostic for the cascade of energy in turbulent systems.",
            "id": "4011152",
            "problem": "Consider a two-dimensional, doubly periodic domain of side length $L = 2\\pi$ with uniform grid of $N \\times N$ points. Let the incompressible velocity field $\\boldsymbol{u}(x,y)$ be derived from a streamfunction $\\psi(x,y)$ via $\\boldsymbol{u} = (u,v) = (\\partial_y \\psi, -\\partial_x \\psi)$. The kinetic energy per mode is defined as $E_{\\boldsymbol{k}} = \\tfrac{1}{2} \\left| \\hat{\\boldsymbol{u}}(\\boldsymbol{k}) \\right|^2$ where $\\hat{\\boldsymbol{u}}(\\boldsymbol{k})$ is the spatial Fourier transform of $\\boldsymbol{u}(x,y)$ and $\\boldsymbol{k} = (k_x, k_y)$ is the angular wavenumber vector. In a pseudo-spectral discretization, the nonlinear advective term is $(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}$. The corresponding projected divergence-free nonlinear tendency in Fourier space is $\\widehat{\\boldsymbol{N}}(\\boldsymbol{k}) = \\mathcal{P}\\left[ \\widehat{(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}}(\\boldsymbol{k}) \\right]$, where the Helmholtz projection $\\mathcal{P}$ is defined by $\\mathcal{P}(\\widehat{\\boldsymbol{a}}) = \\widehat{\\boldsymbol{a}} - \\boldsymbol{k} \\, \\frac{\\boldsymbol{k} \\cdot \\widehat{\\boldsymbol{a}}}{|\\boldsymbol{k}|^2}$ for $\\boldsymbol{k} \\neq \\boldsymbol{0}$ and $\\mathcal{P}(\\widehat{\\boldsymbol{a}}) = \\boldsymbol{0}$ at $\\boldsymbol{k} = \\boldsymbol{0}$.\n\nAliasing arises in discrete Fourier transforms because the product of two band-limited functions produces modes beyond the Nyquist wavenumber that fold back (wrap) into lower modes. A standard control technique is the two-thirds truncation rule, which retains only Fourier modes satisfying $\\max(|k_x|,|k_y|) \\leq K_c$, with $K_c = \\lfloor N/3 \\rfloor$, prior to forming nonlinear products. Define the shell-averaged nonlinear energy transfer density per mode by $T(\\boldsymbol{k}) = \\operatorname{Re}\\left[ \\hat{\\boldsymbol{u}}(\\boldsymbol{k})^* \\cdot \\widehat{\\boldsymbol{N}}(\\boldsymbol{k}) \\right]$, and define the isotropic spectral flux across a cutoff wavenumber $K$ by\n$$\n\\Pi(K) = - \\sum_{|\\boldsymbol{k}| \\leq K} T(\\boldsymbol{k}),\n$$\nexcluding the zero mode $\\boldsymbol{k} = \\boldsymbol{0}$.\n\nYour task is to quantify the impact of aliasing on the kinetic energy spectrum by computing the differences in spectral flux across specified wavenumber bands between runs performed with and without two-thirds de-aliasing. For each run:\n- Construct $\\psi(x,y)$ as a sum of two separable trigonometric modes with specified amplitudes and wavenumber pairs,\n$$\n\\psi(x,y) = A_1 \\sin(k_{1x} x) \\sin(k_{1y} y) + A_2 \\cos(k_{2x} x) \\cos(k_{2y} y).\n$$\n- Compute the corresponding velocity $\\boldsymbol{u}$ via the streamfunction relationship, and then compute the nonlinear term $(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}$ using a pseudo-spectral approach: take spectral derivatives to obtain gradients, form products in physical space, and transform back to Fourier space.\n- For the de-aliased case, apply the two-thirds truncation to the velocity spectra before computing gradients and products, and also truncate the resulting nonlinear tendency spectra; for the non-de-aliased case, apply no truncation at any step.\n- Project the nonlinear tendency to its divergence-free part in Fourier space using the Helmholtz projection.\n- Compute $T(\\boldsymbol{k})$ and then $\\Pi(K)$ for each specified cutoff $K$.\n- Report the differences $\\Delta \\Pi(K_i) = \\Pi_{\\text{no-dealias}}(K_i) - \\Pi_{\\text{dealias}}(K_i)$ across all specified bands $\\{K_i\\}$.\n\nAngle units are angular wavenumbers (radians per unit length); there are no physical units required for the output. The spectral flux differences should be computed as floating-point numbers.\n\nUse the following test suite of parameter sets, where each case is given by the tuple $(N, A_1, A_2, (k_{1x},k_{1y}), (k_{2x},k_{2y}), [K_1,K_2,K_3])$:\n- Case $1$: $(64, 1.0, 0.5, (4,5), (8,2), [10,20,30])$.\n- Case $2$ (boundary resolution): $(16, 1.0, 1.0, (2,3), (3,2), [4,6,8])$.\n- Case $3$ (higher amplitude): $(64, 2.0, 1.5, (6,3), (9,4), [12,24,32])$.\n- Case $4$ (non-power-of-two size): $(96, 0.8, 0.6, (5,7), (12,9), [16,32,48])$.\n\nYour program should produce a single line of output containing the concatenated list of spectral flux differences across the $3$ bands for each of the $4$ cases, in order, as a comma-separated list enclosed in square brackets. For example, for hypothetical values $a_{1,1}, a_{1,2}, a_{1,3}$ for case $1$, $a_{2,1}, a_{2,2}, a_{2,3}$ for case $2$, etc., the output format must be\n$[a_{1,1},a_{1,2},a_{1,3},a_{2,1},a_{2,2},a_{2,3},a_{3,1},a_{3,2},a_{3,3},a_{4,1},a_{4,2},a_{4,3}]$,\nwhere all entries are floating-point numbers.",
            "solution": "The user wants me to solve a numerical problem about aliasing in pseudo-spectral simulations of 2D incompressible fluid flow.\n\n### Step 1: Validation of the Problem Statement\n\n#### Extraction of Givens\n- **Domain**: A two-dimensional, doubly periodic domain with side length $L = 2\\pi$.\n- **Grid**: A uniform $N \\times N$ grid.\n- **Velocity Field**: Incompressible velocity field $\\boldsymbol{u}(x,y) = (u,v)$ derived from a streamfunction $\\psi(x,y)$ via $\\boldsymbol{u} = (\\partial_y \\psi, -\\partial_x \\psi)$.\n- **Streamfunction**: $\\psi(x,y) = A_1 \\sin(k_{1x} x) \\sin(k_{1y} y) + A_2 \\cos(k_{2x} x) \\cos(k_{2y} y)$, with specified parameters $A_1$, $A_2$, $(k_{1x}, k_{1y})$, and $(k_{2x}, k_{2y})$.\n- **Fourier Transform**: $\\hat{\\boldsymbol{u}}(\\boldsymbol{k})$ is the spatial Fourier transform of $\\boldsymbol{u}(x,y)$, where $\\boldsymbol{k}=(k_x, k_y)$ is the angular wavenumber vector.\n- **Nonlinear Term**: The advective term in the Navier-Stokes equation is $(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}$. Its Fourier transform is $\\widehat{(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}}(\\boldsymbol{k})$.\n- **Helmholtz Projection**: The projection operator $\\mathcal{P}$ enforces the divergence-free condition in Fourier space. $\\mathcal{P}(\\widehat{\\boldsymbol{a}}) = \\widehat{\\boldsymbol{a}} - \\boldsymbol{k} \\, \\frac{\\boldsymbol{k} \\cdot \\widehat{\\boldsymbol{a}}}{|\\boldsymbol{k}|^2}$ for $\\boldsymbol{k} \\neq \\boldsymbol{0}$, and $\\mathcal{P}(\\widehat{\\boldsymbol{a}}) = \\boldsymbol{0}$ for $\\boldsymbol{k} = \\boldsymbol{0}$.\n- **Projected Nonlinear Tendency**: $\\widehat{\\boldsymbol{N}}(\\boldsymbol{k}) = \\mathcal{P}\\left[ \\widehat{(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}}(\\boldsymbol{k}) \\right]$.\n- **De-aliasing Rule**: The two-thirds truncation rule, which retains Fourier modes satisfying $\\max(|k_x|,|k_y|) \\leq K_c$, where $K_c = \\lfloor N/3 \\rfloor$.\n- **Nonlinear Energy Transfer**: $T(\\boldsymbol{k}) = \\operatorname{Re}\\left[ \\hat{\\boldsymbol{u}}(\\boldsymbol{k})^* \\cdot \\widehat{\\boldsymbol{N}}(\\boldsymbol{k}) \\right]$.\n- **Spectral Flux**: $\\Pi(K) = - \\sum_{|\\boldsymbol{k}| \\leq K, \\boldsymbol{k} \\neq \\boldsymbol{0}} T(\\boldsymbol{k})$.\n- **Task**: For each test case, compute the difference in spectral flux $\\Delta \\Pi(K_i) = \\Pi_{\\text{no-dealias}}(K_i) - \\Pi_{\\text{dealias}}(K_i)$ for a given set of cutoff wavenumbers $\\{K_i\\}$.\n- **Test Cases**:\n    - Case 1: $(N=64, A_1=1.0, A_2=0.5, (k_{1x},k_{1y})=(4,5), (k_{2x},k_{2y})=(8,2), K=[10,20,30])$.\n    - Case 2: $(N=16, A_1=1.0, A_2=1.0, (k_{1x},k_{1y})=(2,3), (k_{2x},k_{2y})=(3,2), K=[4,6,8])$.\n    - Case 3: $(N=64, A_1=2.0, A_2=1.5, (k_{1x},k_{1y})=(6,3), (k_{2x},k_{2y})=(9,4), K=[12,24,32])$.\n    - Case 4: $(N=96, A_1=0.8, A_2=0.6, (k_{1x},k_{1y})=(5,7), (k_{2x},k_{2y})=(12,9), K=[16,32,48])$.\n- **Output Format**: A single line containing a comma-separated list of all computed $\\Delta \\Pi(K_i)$ values for all cases, enclosed in square brackets.\n\n#### Validation\n1.  **Scientific or Factual Unsoundness**: The problem is firmly grounded in the principles of computational fluid dynamics, specifically the pseudo-spectral method for solving the incompressible Navier-Stokes equations. The concepts of aliasing, the two-thirds de-aliasing rule, Helmholtz projection, and spectral energy transfer are standard and well-established in the field. There are no violations of scientific principles.\n2.  **Non-Formalizable or Irrelevant**: The problem is highly formal and directly relevant to the topic of aliasing control in numerical modeling.\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained. All necessary parameters ($N, A_1, A_2, \\boldsymbol{k}_1, \\boldsymbol{k}_2, K_i$), equations (for $\\psi, \\boldsymbol{u}, \\mathcal{P}, T, \\Pi$), and procedures (pseudo-spectral method, two-thirds rule) are explicitly provided. There are no contradictions.\n4.  **Unrealistic or Infeasible**: The parameters and setup are standard for idealized numerical experiments in turbulence research. The computational task is feasible.\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed. The described procedure leads to a unique, deterministic result for each test case. All terms are clearly defined.\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem is a non-trivial computational task that requires a careful implementation of standard numerical algorithms to investigate a genuine numerical artifact (aliasing). It is not pseudo-profound or trivial.\n7.  **Outside Scientific Verifiability**: The results are computationally verifiable.\n\n#### Verdict\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Solution Design\n\nThe core of the problem is to implement a pseudo-spectral calculation of the nonlinear advection term $(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}$ for a 2D incompressible flow, both with and without an aliasing control procedure, and to quantify the difference in the resulting spectral energy flux.\n\n**Step 1: Spectral Representation**\nThe simulation is performed in Fourier space. The domain is a $2\\pi \\times 2\\pi$ square, so the integer wavenumbers $(k_x, k_y)$ directly correspond to the angular wavenumbers. We define a grid of $N \\times N$ wavenumbers, $(k_x, k_y)$, where $k_x, k_y \\in \\{0, \\pm 1, \\dots, \\pm(N/2-1), N/2\\}$ (with special handling for $N/2$ depending on FFT conventions). We will use `numpy.fft.fftfreq` to generate these wavenumbers correctly.\n\n**Step 2: Initial Field Construction**\nThe streamfunction $\\psi(x,y)$ is given as a sum of real-valued trigonometric functions. Its Fourier transform, $\\hat{\\psi}(\\boldsymbol{k})$, can be computed analytically. For a real function $f(x,y)$, its Fourier transform $\\hat{f}(\\boldsymbol{k})$ must satisfy the conjugate symmetry property $\\hat{f}(-\\boldsymbol{k}) = \\hat{f}(\\boldsymbol{k})^*$.\nThe Fourier transform of a function like $\\cos(k_{x0} x + k_{y0} y)$ on the discrete grid is non-zero only at $\\boldsymbol{k} = \\pm(k_{x0}, k_{y0})$. Using trigonometric identities, we decompose the given $\\sin \\cdot \\sin$ and $\\cos \\cdot \\cos$ terms into sums of cosines and find their spectral coefficients. For a term like $A \\sin(k_x x) \\sin(k_y y)$, the transform $\\hat{\\psi}(\\boldsymbol{k})$ will have four non-zero components. Similarly for the $A \\cos(k_x x) \\cos(k_y y)$ term. We construct the initial $\\hat{\\psi}(\\boldsymbol{k})$ array by adding these analytically determined coefficients at the corresponding wavenumber indices. This is more accurate than performing a numerical FFT on the physical-space representation of $\\psi$.\n\n**Step 3: Velocity Field in Fourier Space**\nThe velocity components in Fourier space are derived from the streamfunction as $\\hat{u}(\\boldsymbol{k}) = i k_y \\hat{\\psi}(\\boldsymbol{k})$ and $\\hat{v}(\\boldsymbol{k}) = -i k_x \\hat{\\psi}(\\boldsymbol{k})$. These serve as the \"true\" velocity spectra, $\\hat{\\boldsymbol{u}}_{\\text{base}}$.\n\n**Step 4: Pseudo-spectral Calculation of the Nonlinear Term**\nThe pseudo-spectral method computes the nonlinear term by evaluating products in physical space to avoid expensive convolutions in spectral space.\n1.  **De-aliasing (if applicable)**: For the de-aliased run, we apply a low-pass filter to the velocity spectra. The two-thirds rule requires zeroing out all modes where $\\max(|k_x|, |k_y|)  K_c = \\lfloor N/3 \\rfloor$. Let the filtered velocity spectra be $\\hat{\\boldsymbol{u}}_{\\text{eff}}$. For the non-de-aliased run, $\\hat{\\boldsymbol{u}}_{\\text{eff}} = \\hat{\\boldsymbol{u}}_{\\text{base}}$.\n2.  **Gradients**: The spatial derivatives required for $(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}$ are computed spectrally. For example, the spectrum of $\\partial u / \\partial x$ is $i k_x \\hat{u}_{\\text{eff}}(\\boldsymbol{k})$.\n3.  **Transform to Physical Space**: We perform an inverse 2D FFT on the spectral representations of the velocity components ($\\hat{\\boldsymbol{u}}_{\\text{eff}}$) and their gradients to obtain their physical-space values on the $N \\times N$ grid.\n4.  **Pointwise Products**: In physical space, we compute the components of the nonlinear term: $N_x = u \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y}$ and $N_y = u \\frac{\\partial v}{\\partial x} + v \\frac{\\partial v}{\\partial y}$. This product generation is where aliasing occurs if the input fields are not sufficiently padded or truncated.\n5.  **Transform to Fourier Space**: We apply a forward 2D FFT to $(N_x, N_y)$ to obtain the spectral representation of the nonlinear term, $\\widehat{(\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}}$.\n6.  **De-aliasing of Result (if applicable)**: For the de-aliased run, the same two-thirds truncation mask is applied to the resulting nonlinear term spectrum.\n\n**Step 5: Helmholtz Projection**\nThe computed nonlinear term is not guaranteed to be divergence-free due to aliasing and numerical errors. We project it onto the space of divergence-free vector fields using the Helmholtz operator $\\mathcal{P}$. This involves calculating the dot product of the wavenumber vector $\\boldsymbol{k}$ with the unprojected tendency spectrum and $|\\boldsymbol{k}|^2$ for all modes and applying the given formula. Special care is taken for the $\\boldsymbol{k}=\\boldsymbol{0}$ mode, where the projection is zero and division by $|\\boldsymbol{k}|^2$ is undefined.\n\n**Step 6: Energy Transfer and Spectral Flux**\nThe nonlinear energy transfer per mode, $T(\\boldsymbol{k})$, is calculated as the real part of the dot product between the conjugate of the base velocity spectrum, $\\hat{\\boldsymbol{u}}_{\\text{base}}^*$, and the projected nonlinear tendency, $\\widehat{\\boldsymbol{N}}(\\boldsymbol{k})$. Note that we use the original, untruncated velocity spectrum here as we are interested in the tendency acting on the true state.\nThe spectral flux, $\\Pi(K)$, is the cumulative rate of energy transfer out of all modes with magnitude $|\\boldsymbol{k}| \\le K$. It is calculated by summing $-T(\\boldsymbol{k})$ over all modes within a disk of radius $K$ in wavenumber space, excluding the $\\boldsymbol{k}=\\boldsymbol{0}$ mode.\n\n**Step 7: Final Computation**\nThe entire process from Step 4 to Step 6 is performed twice for each test case: once with `dealias=True` and once with `dealias=False`. The final result for each specified cutoff $K_i$ is the difference $\\Delta \\Pi(K_i) = \\Pi_{\\text{no-dealias}}(K_i) - \\Pi_{\\text{dealias}}(K_i)$. The results for all $K_i$ across all test cases are collected and formatted into the required output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_pi_for_run(N, A1, A2, k1, k2, K_list, dealias):\n    \"\"\"\n    Core function to calculate spectral flux for a single run (de-aliased or not).\n    \"\"\"\n    # 1. Setup grids and wavenumbers\n    kx_vals = np.fft.fftfreq(N) * N\n    ky_vals = np.fft.fftfreq(N) * N\n    kx, ky = np.meshgrid(kx_vals, ky_vals)\n\n    # 2. Construct initial psi_hat analytically\n    psi_hat = np.zeros((N, N), dtype=np.complex128)\n    k1x, k1y = k1\n    k2x, k2y = k2\n    N_sq = float(N * N)\n\n    # sin(k1x*x)sin(k1y*y) term = -1/4 * [cos((k1x+k1y)x) - cos((k1x-k1y)x) - cos((k1x+k1y)y) + cos((k1x-k1y)y)]\n    # after re-writing with complex exponentials, we get 4 delta functions in spectrum\n    if A1 != 0:\n        val = A1 * N_sq / (4.0j * 1.0j) # (1/4) * N^2 * A1\n        psi_hat[k1y % N, k1x % N] += val\n        psi_hat[(-k1y) % N, (-k1x) % N] += val\n        psi_hat[k1y % N, (-k1x) % N] -= val\n        psi_hat[(-k1y) % N, k1x % N] -= val\n\n    # cos(k2x*x)cos(k2y*y) term\n    if A2 != 0:\n        val = A2 * N_sq / 4.0\n        psi_hat[k2y % N, k2x % N] += val\n        psi_hat[(-k2y) % N, (-k2x) % N] += val\n        psi_hat[k2y % N, (-k2x) % N] += val\n        psi_hat[(-k2y) % N, k2x % N] += val\n\n    # 3. Base velocity spectra from streamfunction\n    u_hat_base = 1j * ky * psi_hat\n    v_hat_base = -1j * kx * psi_hat\n\n    # 4. Apply 2/3 truncation to velocity if dealiasing\n    u_hat_eff = u_hat_base\n    v_hat_eff = v_hat_base\n    trunc_mask = None\n    if dealias:\n        Kc = N // 3\n        trunc_mask = (np.abs(kx) = Kc)  (np.abs(ky) = Kc)\n        u_hat_eff = u_hat_base * trunc_mask\n        v_hat_eff = v_hat_base * trunc_mask\n    \n    # 5. Compute gradients spectrally and transform fields to physical space\n    dudx_hat = 1j * kx * u_hat_eff\n    dudy_hat = 1j * ky * u_hat_eff\n    dvdx_hat = 1j * kx * v_hat_eff\n    dvdy_hat = 1j * ky * v_hat_eff\n\n    u = np.fft.ifft2(u_hat_eff)\n    v = np.fft.ifft2(v_hat_eff)\n    dudx = np.fft.ifft2(dudx_hat)\n    dudy = np.fft.ifft2(dudy_hat)\n    dvdx = np.fft.ifft2(dvdx_hat)\n    dvdy = np.fft.ifft2(dvdy_hat)\n\n    # 6. Form nonlinear products in physical space\n    N_x_phys = np.real(u) * np.real(dudx) + np.real(v) * np.real(dudy)\n    N_y_phys = np.real(u) * np.real(dvdx) + np.real(v) * np.real(dvdy)\n\n    # 7. Transform nonlinear term back to spectral space\n    N_x_hat = np.fft.fft2(N_x_phys)\n    N_y_hat = np.fft.fft2(N_y_phys)\n\n    # 8. Apply 2/3 truncation to nonlinear term if dealiasing\n    if dealias:\n        if trunc_mask is None: \n            Kc = N // 3\n            trunc_mask = (np.abs(kx) = Kc)  (np.abs(ky) = Kc)\n        N_x_hat *= trunc_mask\n        N_y_hat *= trunc_mask\n    \n    # 9. Apply Helmholtz projection to enforce non-divergence\n    k_sq = kx**2 + ky**2\n    k_sq_inv = np.divide(1.0, k_sq, out=np.zeros_like(k_sq), where=k_sq!=0)\n    \n    k_dot_N_hat = kx * N_x_hat + ky * N_y_hat\n    \n    N_hat_proj_x = N_x_hat - kx * k_dot_N_hat * k_sq_inv\n    N_hat_proj_y = N_y_hat - ky * k_dot_N_hat * k_sq_inv\n\n    # Explicitly set k=0 contribution to zero as per definition\n    N_hat_proj_x[0, 0] = 0.0\n    N_hat_proj_y[0, 0] = 0.0\n\n    # 10. Compute nonlinear energy transfer T(k)\n    T_k = np.real(np.conj(u_hat_base) * N_hat_proj_x + np.conj(v_hat_base) * N_hat_proj_y)\n\n    # 11. Compute spectral flux Pi(K) for each cutoff K\n    pi_results = []\n    k_mag = np.sqrt(k_sq)\n    for K in K_list:\n        flux_mask = (k_mag > 1e-9)  (k_mag = K)\n        pi = -np.sum(T_k[flux_mask])\n        pi_results.append(pi)\n    \n    return pi_results\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the simulation for all test cases.\n    \"\"\"\n    test_cases = [\n        (64, 1.0, 0.5, (4, 5), (8, 2), [10, 20, 30]),\n        (16, 1.0, 1.0, (2, 3), (3, 2), [4, 6, 8]),\n        (64, 2.0, 1.5, (6, 3), (9, 4), [12, 24, 32]),\n        (96, 0.8, 0.6, (5, 7), (12, 9), [16, 32, 48]),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        N, A1, A2, k1, k2, K_list = case\n        \n        pi_no_dealias = calculate_pi_for_run(N, A1, A2, k1, k2, K_list, dealias=False)\n        pi_dealias = calculate_pi_for_run(N, A1, A2, k1, k2, K_list, dealias=True)\n        \n        delta_pi = [p_nd - p_d for p_nd, p_d in zip(pi_no_dealias, pi_dealias)]\n        all_results.extend(delta_pi)\n\n    print(f\"[{','.join(f'{x:.8f}' for x in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}