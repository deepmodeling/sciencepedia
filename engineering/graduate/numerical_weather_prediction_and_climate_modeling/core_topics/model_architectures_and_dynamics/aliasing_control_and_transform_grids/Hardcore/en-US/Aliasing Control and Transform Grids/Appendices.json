{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a rigorous, pen-and-paper demonstration of aliasing. By calculating the exact error that arises when evaluating a simple quadratic product on a grid with insufficient resolution, you will gain a concrete understanding of how unresolved interactions corrupt the solution. This foundational analysis  reveals the mathematical origin of aliasing contamination and sets the stage for the numerical practices to follow.",
            "id": "4011150",
            "problem": "Consider a one-dimensional, doubly periodic domain of length $2\\pi$ used in a spectral transform model typical of numerical weather prediction and climate modeling. A scalar field $u(x)$ is represented spectrally with a triangular truncation at total wavenumber $K$, and nonlinear products are evaluated on a transform grid and then projected back to spectral space. The transform grid consists of $N$ equally spaced collocation points $x_{j} = \\frac{2\\pi j}{N}$ for $j = 0, 1, \\dots, N-1$. The spectral projection back to wavenumber space uses the Discrete Fourier Transform (DFT), with the forward and inverse transforms defined by\n$$\n\\hat{f}_{k} = \\frac{1}{N} \\sum_{j=0}^{N-1} f(x_{j}) \\exp(-\\mathrm{i} k x_{j}), \\quad f(x_{j}) = \\sum_{k=-\\frac{N}{2}}^{\\frac{N}{2}-1} \\hat{f}_{k} \\exp(\\mathrm{i} k x_{j}).\n$$\nAssume a truncation wavenumber $K = 10$ and a transform grid size $N = 24$, so that $K > \\frac{N}{3}$ (insufficient collocation resolution for quadratic products). Let the resolved field be the single retained Fourier mode\n$$\nu(x) = a \\cos(10 x),\n$$\nwith real amplitude $a \\in \\mathbb{R}$, and consider the quadratic product $q(x) = u(x)^{2}$. The product $q(x)$ is evaluated pointwise on the $N$-point grid and then projected back to spectral space with the DFT, followed by truncation to $|k| \\le K$. Define the reconstruction error $E$ as the mean-square difference in physical space between the projected-truncated pseudo-spectral representation of $q(x)$ and the exact spectral representation of $q(x)$ truncated to $|k| \\le K$:\n$$\nE = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\left| q_{\\mathrm{ps}}(x) - q_{\\mathrm{ex}}(x) \\right|^{2} \\, dx,\n$$\nwhere $q_{\\mathrm{ps}}(x)$ is obtained by evaluating $u(x)^{2}$ on the grid, transforming to spectral space via the DFT, and truncating to $|k| \\le K$, and $q_{\\mathrm{ex}}(x)$ is obtained by forming the continuous spectral convolution for $u(x)^{2}$ and then truncating to $|k| \\le K$. Compute $E$ and express it as a closed-form analytic expression in terms of $a$, and explain how the resulting error is related to aliasing of quadratic interactions under the given ($K$, $N$) configuration. Express your final answer as an exact analytic expression. No rounding is required, and no physical units are needed.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Problem Validation\n\n#### Step 1: Extract Givens\n-   Domain: One-dimensional, doubly periodic, length $2\\pi$.\n-   Field representation: Spectral transform model with triangular truncation at total wavenumber $K$.\n-   Truncation wavenumber: $K = 10$.\n-   Transform grid: $N$ equally spaced collocation points $x_{j} = \\frac{2\\pi j}{N}$ for $j = 0, 1, \\dots, N-1$.\n-   Grid size: $N = 24$.\n-   Constraint: $K > \\frac{N}{3}$ is noted (specifically $10 > \\frac{24}{3} = 8$).\n-   Forward DFT: $\\hat{f}_{k} = \\frac{1}{N} \\sum_{j=0}^{N-1} f(x_{j}) \\exp(-\\mathrm{i} k x_{j})$.\n-   Inverse DFT: $f(x_{j}) = \\sum_{k=-\\frac{N}{2}}^{\\frac{N}{2}-1} \\hat{f}_{k} \\exp(\\mathrm{i} k x_{j})$.\n-   Resolved field: $u(x) = a \\cos(10 x)$, with real amplitude $a \\in \\mathbb{R}$.\n-   Nonlinear product: $q(x) = u(x)^{2}$.\n-   Pseudo-spectral product, $q_{\\mathrm{ps}}(x)$: obtained by evaluating $u(x)^{2}$ on the grid, transforming via DFT, and truncating to $|k| \\le K$.\n-   Exact truncated product, $q_{\\mathrm{ex}}(x)$: obtained by forming the continuous spectral convolution for $u(x)^{2}$ and truncating to $|k| \\le K$.\n-   Reconstruction error definition: $E = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\left| q_{\\mathrm{ps}}(x) - q_{\\mathrm{ex}}(x) \\right|^{2} \\, dx$.\n\n#### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective.\n1.  **Scientific or Factual Soundness**: The problem is a standard exercise in the theory of spectral methods, a core topic in numerical analysis for fluid dynamics and climate modeling. The concepts of aliasing, spectral truncation, and transform grids are fundamental and correctly presented.\n2.  **Formalizability and Relevance**: The problem is directly and rigorously formalizable using Fourier analysis and the theory of Discrete Fourier Transforms. It is highly relevant to the specified topic of aliasing control in numerical weather prediction.\n3.  **Completeness and Consistency**: The problem is self-contained. All necessary parameters ($K$, $N$), definitions (DFT, error $E$), and the functional form of the field $u(x)$ are provided. There are no contradictions. The condition $K > N/3$ is intentionally included to ensure that aliasing occurs and pollutes the resolved spectrum, which is the central point of the exercise.\n4.  **Realism and Feasibility**: The setup is a simplified but conceptually accurate representation of how nonlinear terms are handled in spectral models. The values for $K$ and $N$ are chosen to illustrate a specific numerical artifact, which is a standard pedagogical approach.\n5.  **Well-Posedness**: The problem is well-posed, leading to a unique, stable, and meaningful solution for the error $E$ as a function of the amplitude $a$.\n6.  **Triviality/Tautology**: The problem is not trivial; it requires a step-by-step application of Fourier analysis and an understanding of the aliasing phenomenon in pseudo-spectral methods.\n\n#### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full solution will be provided.\n\n### Solution\n\nThe goal is to compute the reconstruction error $E$, which requires finding the exact truncated product $q_{\\mathrm{ex}}(x)$ and the pseudo-spectral product $q_{\\mathrm{ps}}(x)$.\n\n**1. Determine the exact truncated product, $q_{\\mathrm{ex}}(x)$**\n\nThe scalar field is $u(x) = a \\cos(10x)$. The exact quadratic product is $q(x) = u(x)^2$.\nUsing the trigonometric identity $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$, we have:\n$$\nq(x) = (a \\cos(10x))^2 = a^2 \\cos^2(10x) = a^2 \\left( \\frac{1 + \\cos(20x)}{2} \\right) = \\frac{a^2}{2} + \\frac{a^2}{2} \\cos(20x).\n$$\nTo represent this in terms of its spectral components (continuous Fourier series), we use $\\cos(\\theta) = \\frac{1}{2}(\\exp(\\mathrm{i}\\theta) + \\exp(-\\mathrm{i}\\theta))$:\n$$\nq(x) = \\frac{a^2}{2} + \\frac{a^2}{4} (\\exp(\\mathrm{i}20x) + \\exp(-\\mathrm{i}20x)).\n$$\nThe spectral representation of the exact product $q(x)$ has non-zero coefficients at wavenumbers $k=0$, $k=20$, and $k=-20$.\nThe function $q_{\\mathrm{ex}}(x)$ is defined as the exact product $q(x)$ spectrally truncated to $|k| \\le K$. Given the truncation wavenumber $K=10$, we must discard all components with $|k|>10$. The components at $k=\\pm 20$ are thus removed. The only remaining component is the one at $k=0$.\nTherefore, the exact truncated product is:\n$$\nq_{\\mathrm{ex}}(x) = \\frac{a^2}{2}.\n$$\n\n**2. Determine the pseudo-spectral product, $q_{\\mathrm{ps}}(x)$**\n\nThe pseudo-spectral method evaluates the product $q(x)=u(x)^2$ on the grid points $x_j = \\frac{2\\pi j}{N}$ with $N=24$. The function values on the grid are:\n$$\nq(x_j) = \\frac{a^2}{2} + \\frac{a^2}{2} \\cos(20x_j) = \\frac{a^2}{2} + \\frac{a^2}{2} \\cos\\left(20 \\frac{2\\pi j}{24}\\right).\n$$\nOn a discrete grid of $N$ points, a wavenumber $k$ is indistinguishable from any wavenumber $k' = k + mN$ for any integer $m$. This phenomenon is aliasing. The principal wavenumbers for a DFT on a grid of size $N=24$ are in the range $k \\in [-12, 11]$. The wavenumber $k=20$ from the term $\\cos(20x)$ is outside this range. It is aliased to a wavenumber $k'$ within this range. We find $k'$ by choosing $m=-1$:\n$$\nk' = 20 + (-1) \\times 24 = -4.\n$$\nThus, on the grid, the component $\\cos(20x_j)$ is aliased to $\\cos(-4x_j) = \\cos(4x_j)$. We can verify this:\n$$\n\\cos\\left(20 \\frac{2\\pi j}{24}\\right) = \\cos\\left((24-4) \\frac{2\\pi j}{24}\\right) = \\cos\\left(2\\pi j - 4 \\frac{2\\pi j}{24}\\right) = \\cos\\left(-4 \\frac{2\\pi j}{24}\\right) = \\cos(4x_j).\n$$\nSo, the function evaluated on the grid is effectively:\n$$\nq(x_j) = \\frac{a^2}{2} + \\frac{a^2}{2} \\cos(4x_j).\n$$\nNext, we perform the DFT on $q(x_j)$ to get the spectral coefficients $\\hat{q}_k$. By linearity and orthogonality of the discrete Fourier basis, the coefficients are:\n-   For the constant term $\\frac{a^2}{2}$, the only non-zero coefficient is at $k=0$: $\\hat{q}_0 = \\frac{a^2}{2}$.\n-   For the term $\\frac{a^2}{2} \\cos(4x_j) = \\frac{a^2}{4}(\\exp(\\mathrm{i}4x_j) + \\exp(-\\mathrm{i}4x_j))$, the non-zero coefficients are at $k=4$ and $k=-4$: $\\hat{q}_4 = \\frac{a^2}{4}$ and $\\hat{q}_{-4} = \\frac{a^2}{4}$.\n\nSo the spectral coefficients of the grid-point product are $\\hat{q}_0 = \\frac{a^2}{2}$, $\\hat{q}_4 = \\frac{a^2}{4}$, $\\hat{q}_{-4} = \\frac{a^2}{4}$, and $\\hat{q}_k=0$ for all other $k$.\nThe function $q_{\\mathrm{ps}}(x)$ is formed by taking these coefficients, truncating to $|k| \\le K=10$, and reconstructing a continuous function. Since the non-zero coefficients are at $k=0, \\pm 4$, all of which are within the truncation band $|k| \\le 10$, no coefficients are removed by truncation.\nThe reconstructed function $q_{\\mathrm{ps}}(x)$ is:\n$$\nq_{\\mathrm{ps}}(x) = \\sum_{k=-10}^{10} \\hat{q}_k \\exp(\\mathrm{i}kx) = \\hat{q}_0 + \\hat{q}_4 \\exp(\\mathrm{i}4x) + \\hat{q}_{-4} \\exp(-\\mathrm{i}4x)\n$$\n$$\nq_{\\mathrm{ps}}(x) = \\frac{a^2}{2} + \\frac{a^2}{4} \\exp(\\mathrm{i}4x) + \\frac{a^2}{4} \\exp(-\\mathrm{i}4x) = \\frac{a^2}{2} + \\frac{a^2}{2} \\cos(4x).\n$$\n\n**3. Compute the reconstruction error, $E$**\n\nThe error $E$ is the mean-square difference between $q_{\\mathrm{ps}}(x)$ and $q_{\\mathrm{ex}}(x)$:\n$$\nE = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\left| q_{\\mathrm{ps}}(x) - q_{\\mathrm{ex}}(x) \\right|^{2} \\, dx.\n$$\nThe difference is:\n$$\nq_{\\mathrm{ps}}(x) - q_{\\mathrm{ex}}(x) = \\left(\\frac{a^2}{2} + \\frac{a^2}{2} \\cos(4x)\\right) - \\frac{a^2}{2} = \\frac{a^2}{2} \\cos(4x).\n$$\nSubstituting this into the error integral:\n$$\nE = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\left| \\frac{a^2}{2} \\cos(4x) \\right|^{2} \\, dx = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{a^4}{4} \\cos^2(4x) \\, dx = \\frac{a^4}{8\\pi} \\int_{0}^{2\\pi} \\cos^2(4x) \\, dx.\n$$\nThe integral of $\\cos^2(kx)$ over a period of $2\\pi$ for any non-zero integer $k$ is $\\pi$. We can show this using $\\cos^2(4x) = \\frac{1}{2}(1 + \\cos(8x))$:\n$$\n\\int_{0}^{2\\pi} \\cos^2(4x) \\, dx = \\int_{0}^{2\\pi} \\frac{1}{2}(1 + \\cos(8x)) \\, dx = \\left[ \\frac{x}{2} + \\frac{\\sin(8x)}{16} \\right]_{0}^{2\\pi} = \\left(\\frac{2\\pi}{2} + 0\\right) - (0+0) = \\pi.\n$$\nTherefore, the error $E$ is:\n$$\nE = \\frac{a^4}{8\\pi} (\\pi) = \\frac{a^4}{8}.\n$$\n\n**Explanation of Aliasing**\nThe error arises directly from aliasing. The exact quadratic product $u(x)^2$ generates a high-wavenumber component $\\cos(20x)$. The grid, with $N=24$ points, has a Nyquist wavenumber of $N/2 = 12$. Since the product wavenumber $k=20$ is greater than the Nyquist wavenumber $k_{Nyquist}=12$, the grid sampling cannot correctly represent this component. The discrete sampling process misinterprets the $\\cos(20x)$ wave as a lower-wavenumber wave, $\\cos(4x)$, because $20$ is aliased to $20-24=-4$. The resulting spurious component, $\\frac{a^2}{2}\\cos(4x)$, has a wavenumber $|k|=4$ which lies within the resolved spectral range ($|k| \\le K=10$). Consequently, this aliased term contaminates the spectrally truncated pseudo-spectral product $q_{\\mathrm{ps}}(x)$. The exact truncated calculation, $q_{\\mathrm{ex}}(x)$, correctly discards the $k=\\pm 20$ components. The error $E$ is precisely the mean-square value of the aliased, spurious component that pollutes the final result. The given condition $K > N/3$ ($10 > 8$) correctly predicts this contaminative aliasing, as the standard condition to avoid it for quadratic products is $N \\ge 3K+1$.",
            "answer": "$$\\boxed{\\frac{a^{4}}{8}}$$"
        },
        {
            "introduction": "Building on the analytical insight from the previous exercise, this practice challenges you to create a numerical simulation that demonstrates aliasing in action. You will implement the pseudospectral method for a quadratic nonlinearity and then apply the classic two-thirds de-aliasing rule, a cornerstone of aliasing control developed by Orszag. This hands-on experiment  allows you to observe the effectiveness of this rule in removing spurious energy and bridges the gap between theoretical understanding and practical implementation in spectral codes.",
            "id": "4011188",
            "problem": "Construct a complete, runnable program that implements a numerical experiment to demonstrate aliasing of triad interactions in a quadratic nonlinearity on a one-dimensional periodic transform grid and shows how applying the two-thirds truncation rule alters energy transfer. The experiment must use a Discrete Fourier Transform (DFT) grid with an even number of points $N$ on a periodic domain, and it must start from foundational principles of spectral transforms, convolution, and sampling.\n\nStart from the following base facts and definitions:\n- The Discrete Fourier Transform (DFT) on a periodic grid of $N$ points supports integer Fourier modes $k$ with $|k| \\leq k_{\\max}$, where the Nyquist wavenumber is $k_{\\max} = N/2$ for even $N$.\n- The Fast Fourier Transform (FFT) and Inverse Fast Fourier Transform (IFFT) implement the DFT efficiently. In standard practice, the IFFT includes a factor of $1/N$.\n- For a real scalar field $u(x)$ on the periodic grid, a quadratic nonlinearity such as $q(x) = u(x)^2$ produces spectral triad interactions: the Fourier spectrum $\\widehat{q}(k)$ is a discrete convolution of $\\widehat{u}(k)$ with itself, generating components at sum and difference wavenumbers, including $k = k_1 + k_2$ and $k = k_1 - k_2$.\n- In a truncated discrete spectrum, any interaction producing a wavenumber $k$ with $|k| > k_{\\max}$ is aliased back into the representable range by modular wrapping, which contaminates lower wavenumbers. For sums with $k_1 + k_2 \\leq N$, the aliased magnitude can be represented by $k_{\\text{alias}} = |(k_1 + k_2) - N|$ when $k_1 + k_2 > k_{\\max}$, and $k_{\\text{alias}} = k_1 + k_2$ when $k_1 + k_2 \\leq k_{\\max}$.\n- The two-thirds truncation rule (also known as the Orszag $2/3$-rule) for quadratic nonlinearities removes aliasing errors by zeroing Fourier modes above a cutoff $K_c \\approx (2/3)k_{\\max}$ before forming products in physical space and then re-truncating after the nonlinear operation. To strictly avoid boundary issues, use $K_c = \\lfloor (2/3)k_{\\max} \\rfloor - 1$.\n\nProgram specification:\n1. Use a one-dimensional periodic grid with $N$ points. Construct a real-valued initial field $u(x)$ consisting of the sum of two cosine Fourier modes with wavenumbers $k_1$ and $k_2$ and amplitudes $A_1$ and $A_2$, respectively. Implement $u(x)$ by constructing the Fourier coefficients $\\widehat{u}(k)$ explicitly so that the inverse transform yields $u(x) = A_1 \\cos(2\\pi k_1 j/N) + A_2 \\cos(2\\pi k_2 j/N)$ at grid index $j$.\n2. Compute $q(x) = u(x)^2$ pointwise in physical space and transform to the spectrum $\\widehat{q}(k)$ using an FFT to obtain the non-dealiased result. Let $E_{\\text{naive}}$ be the spectral energy associated with the triad sum at the aliased magnitude $k_{\\text{alias}}$, defined as the sum of squared magnitudes of $\\widehat{q}(k)$ at the positive and negative indices corresponding to $k_{\\text{alias}}$ (for $k_{\\text{alias}} \\neq 0$), or the squared magnitude at zero if $k_{\\text{alias}} = 0$.\n3. Apply the two-thirds truncation rule by zeroing all Fourier coefficients of $u$ with $|k| > K_c$ prior to computing $q(x)$, then form $q(x) = u(x)^2$, transform to $\\widehat{q}(k)$, and re-apply the truncation by zeroing all modes above $K_c$ in $\\widehat{q}(k)$. Let $E_{2/3}$ be the energy at $k_{\\text{alias}}$ defined as in step $2$ for the de-aliased spectrum.\n4. For each test case, return the pair $\\left[E_{\\text{naive}}, E_{2/3}\\right]$.\n\nYour program must hard-code and evaluate the following test suite, which probes distinct facets including a general case, a boundary case, and a non-aliasing case:\n- Test case $1$: $N = 96$, $k_1 = 40$, $k_2 = 20$, $A_1 = 1.0$, $A_2 = 1.0$.\n- Test case $2$: $N = 96$, $k_1 = 32$, $k_2 = 32$, $A_1 = 0.8$, $A_2 = 0.8$.\n- Test case $3$: $N = 96$, $k_1 = 10$, $k_2 = 12$, $A_1 = 1.2$, $A_2 = 0.7$.\n- Test case $4$: $N = 128$, $k_1 = 41$, $k_2 = 41$, $A_1 = 0.9$, $A_2 = 0.9$.\n\nFinal output requirement:\n- Your program should produce a single line of output containing the results as a comma-separated list of pairs, with no spaces, enclosed in square brackets. For example: $[[e_{1,\\text{naive}},e_{1,2/3}],[e_{2,\\text{naive}},e_{2,2/3}],\\dots]$. Each $e$ must be a floating-point number.\n\nAll quantities are dimensionless; do not attach any physical units or angle units. The answers for each test case must be numerical floats. The program must be fully self-contained and require no input.",
            "solution": "The problem statement is scientifically sound, well-posed, and provides a complete specification for a numerical experiment. It is a valid inquiry into the nature of aliasing in spectral methods for nonlinear systems and the application of the two-thirds truncation rule for de-aliasing. We may therefore proceed with a solution.\n\nThe core of this problem lies in understanding how discrete Fourier transforms represent nonlinear interactions and how wavenumbers outside the resolved range, $|k| \\leq k_{\\max}$, are misrepresented as different, lower wavenumbers, a phenomenon known as aliasing. We will demonstrate this contamination and its removal using the specified numerical experiment.\n\n**1. Theoretical Foundation**\n\nA real-valued function $u(x)$ on a periodic domain can be represented by a Fourier series. On a discrete grid of $N$ points, $x_j=j\\Delta x$ for $j=0, 1, \\dots, N-1$, this becomes a Discrete Fourier Transform (DFT). A real function $u(x_j)$ composed of cosine waves is defined as:\n$$\nu(x_j) = A_1 \\cos\\left(\\frac{2\\pi k_1 j}{N}\\right) + A_2 \\cos\\left(\\frac{2\\pi k_2 j}{N}\\right)\n$$\nUsing Euler's formula, $\\cos(\\theta) = \\frac{1}{2}(e^{i\\theta} + e^{-i\\theta})$, we can express $u(x_j)$ in terms of complex exponentials, which form the basis of the DFT. The standard forward and inverse DFT pair (as implemented in `numpy`) is:\n$$\n\\widehat{u}(k) = \\sum_{j=0}^{N-1} u(x_j) e^{-i 2\\pi kj/N} \\quad \\text{(FFT)}\n$$\n$$\nu(x_j) = \\frac{1}{N} \\sum_{k=0}^{N-1} \\widehat{u}(k) e^{i 2\\pi kj/N} \\quad \\text{(IFFT)}\n$$\nTo construct the specified $u(x_j)$ from its spectral coefficients, we must set the coefficients $\\widehat{u}(k)$ such that the IFFT yields the desired function. For a single term $A \\cos(2\\pi k_0 j/N)$, the corresponding non-zero spectral coefficients are $\\widehat{u}(k_0) = A N/2$ and $\\widehat{u}(-k_0) = A N/2$. In the discrete index range $0, \\dots, N-1$, the coefficient for wavenumber $-k_0$ is stored at index $N-k_0$.\n\nThe quadratic nonlinearity $q(x) = u(x)^2$ in physical space corresponds to a convolution of the spectrum with itself in Fourier space:\n$$\n\\widehat{q}(k) = (\\widehat{u} * \\widehat{u})(k) = \\sum_{k'=0}^{N-1} \\widehat{u}(k') \\widehat{u}(k-k')\n$$\nThis convolution generates new modes at sum and difference wavenumbers. For an initial field with modes $k_1$ and $k_2$, the product $u(x)^2$ will generate modes at $2k_1$, $2k_2$, $k_1+k_2$, and $k_1-k_2$ (and their negatives), as well as a zero-frequency component ($k=0$).\n\n**2. Aliasing**\n\nThe DFT grid can only represent a finite range of wavenumbers, up to the Nyquist limit $k_{\\max} = N/2$. If an interaction creates a mode with magnitude greater than $k_{\\max}$, e.g., $k_{true} = k_1+k_2 > k_{\\max}$, this mode is erroneously `aliased` to a representable wavenumber $k_{alias}$. For interactions where $k_1+k_2 \\leq N$, the aliased wavenumber is given by the problem as $k_{alias} = |(k_1+k_2) - N|$ if $k_1+k_2>k_{\\max}$, and $k_{alias}=k_1+k_2$ otherwise. This is a direct consequence of the periodicity of the discrete exponential basis functions, $e^{i 2\\pi k_{true} j/N} = e^{i 2\\pi (k_{true} \\pmod N) j/N}$. The energy that should be in the high-wavenumber mode $k_{true}$ contaminates the mode $k_{alias}$.\n\n**3. The Two-Thirds Truncation Rule**\n\nTo prevent this contamination, the two-thirds truncation rule is applied. The strategy is to create a \"padded\" region in the upper part of the spectrum.\n1. All Fourier coefficients $\\widehat{u}(k)$ for which $|k|$ exceeds a truncation wavenumber $K_c$ are set to zero. The problem specifies $K_c = \\lfloor (2/3) k_{\\max} \\rfloor - 1$.\n2. This truncated spectrum, $\\widehat{u}_{\\text{trunc}}(k)$, is transformed back to physical space to get $u_{\\text{trunc}}(x)$.\n3. The quadratic product $q_{\\text{trunc}}(x) = u_{\\text{trunc}}(x)^2$ is computed. Interactions between modes $|k'|, |k''| \\le K_c$ can at most produce modes with wavenumber $|k'|+|k''| \\le 2K_c$.\n4. The de-aliasing condition is that the highest generated wavenumber, $2K_c$, should not be large enough to alias back into the trusted spectral region $[-K_c, K_c]$. This requires $2K_c < N-K_c$, or $K_c < N/3$. Since $k_{\\max}=N/2$, this is equivalent to $K_c < (2/3)k_{\\max}$, which our chosen $K_c$ satisfies.\n5. After computing $q_{\\text{trunc}}(x)$, it is transformed back to get $\\widehat{q}_{\\text{trunc}}(k)$. Critically, any modes with $|k|>K_c$ are again zeroed out. This removes any legitimate high-wavenumber power, but more importantly, it ensures there is no aliased power contaminating modes within $|k| \\le K_c$.\n\n**4. Experimental Procedure**\n\nFor each test case, we perform two parallel computations.\n\n**Computation A: Naive (Aliased) Case**\n1. Construct the full spectral representation $\\widehat{u}(k)$ with modes at $\\pm k_1$ and $\\pm k_2$.\n2. Compute $u(x) = \\text{IFFT}[\\widehat{u}(k)]$.\n3. Compute $q(x) = u(x)^2$.\n4. Compute $\\widehat{q}_{\\text{naive}}(k) = \\text{FFT}[q(x)]$.\n5. Determine the target wavenumber $k_{alias}$ from $k_1+k_2$.\n6. Calculate the energy $E_{\\text{naive}} = |\\widehat{q}_{\\text{naive}}(k_{alias})|^2 + |\\widehat{q}_{\\text{naive}}(-k_{alias})|^2$.\n\n**Computation B: De-aliased (2/3-Rule) Case**\n1. Construct the full spectral representation $\\widehat{u}(k)$ as before.\n2. Create a truncated copy $\\widehat{u}_{\\text{trunc}}(k)$ by zeroing all coefficients where $|k| > K_c = \\lfloor (2/3)N/2 \\rfloor - 1$.\n3. Compute $u_{\\text{trunc}}(x) = \\text{IFFT}[\\widehat{u}_{\\text{trunc}}(k)]$.\n4. Compute $q_{\\text{trunc}}(x) = u_{\\text{trunc}}(x)^2$.\n5. Compute $\\widehat{q}_{\\text{trunc}}(k) = \\text{FFT}[q_{\\text{trunc}}(x)]$.\n6. Create the final de-aliased spectrum $\\widehat{q}_{2/3}(k)$ by zeroing all coefficients of $\\widehat{q}_{\\text{trunc}}(k)$ where $|k| > K_c$.\n7. Calculate the energy $E_{2/3} = |\\widehat{q}_{2/3}(k_{alias})|^2 + |\\widehat{q}_{2/3}(-k_{alias})|^2$.\n\nThis procedure will demonstrate that in cases where aliasing occurs (e.g., test cases $1, 2, 4$), $E_{\\text{naive}}$ is non-zero while $E_{2/3}$ is zero, as the de-aliasing procedure correctly removes the spurious energy. In the non-aliasing case (test case $3$), both will be non-zero and should be equal because the interacting modes and their product all fall within the truncated region $|k| \\le K_c$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a numerical experiment to demonstrate aliasing in a quadratic\n    nonlinearity on a 1D periodic grid and its removal via the 2/3-rule.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, k1, k2, A1, A2)\n        (96, 40, 20, 1.0, 1.0),\n        (96, 32, 32, 0.8, 0.8),\n        (96, 10, 12, 1.2, 0.7),\n        (128, 41, 41, 0.9, 0.9),\n    ]\n\n    results = []\n    for N, k1, k2, A1, A2 in test_cases:\n        # --- Common setup for this test case ---\n        k_max = N // 2\n        \n        # Calculate target wavenumber k_alias from the sum k1+k2\n        k_sum = k1 + k2\n        if k_sum > k_max:\n            k_alias = abs(k_sum - N)\n        else:\n            k_alias = k_sum\n            \n        # Construct the initial field in spectral space\n        u_hat = np.zeros(N, dtype=np.complex128)\n        if k1 == k2:\n            # If wavenumbers are the same, sum their amplitudes\n            # Special cases k=0 or k=N/2 not needed for these test cases\n            if k1 > 0 and k1  k_max:\n                u_hat[k1] = (A1 + A2) * N / 2.0\n                u_hat[N - k1] = (A1 + A2) * N / 2.0\n        else:\n            # Different wavenumbers get their own coefficients\n            if k1 > 0 and k1  k_max:\n                u_hat[k1] = A1 * N / 2.0\n                u_hat[N - k1] = A1 * N / 2.0\n            if k2 > 0 and k2  k_max:\n                u_hat[k2] += A2 * N / 2.0\n                u_hat[N - k2] += A2 * N / 2.0\n\n        # --- 1. Naive (Aliased) Computation ---\n        # Transform to physical space\n        u_naive = np.fft.ifft(u_hat).real\n        \n        # Compute quadratic nonlinearity\n        q_naive = u_naive**2\n        \n        # Transform back to spectral space\n        q_hat_naive = np.fft.fft(q_naive)\n        \n        # Calculate energy at the aliased wavenumber\n        # The sum of squared magnitudes at +k_alias and -k_alias\n        # Note: k_alias=0 or k_alias=k_max are not hit by the tests\n        E_naive = np.abs(q_hat_naive[k_alias])**2 + np.abs(q_hat_naive[N - k_alias])**2\n\n        # --- 2. De-aliased Computation (2/3-Rule) ---\n        # Calculate the truncation wavenumber Kc\n        # Using the specified conservative definition\n        Kc = int(np.floor(2.0/3.0 * k_max)) - 1\n        \n        # Apply truncation to the initial field spectrum\n        u_hat_trunc = u_hat.copy()\n        u_hat_trunc[Kc + 1 : N - Kc] = 0\n        \n        # Transform truncated spectrum to physical space\n        u_trunc = np.fft.ifft(u_hat_trunc).real\n        \n        # Compute quadratic nonlinearity\n        q_trunc = u_trunc**2\n        \n        # Transform back to spectral space\n        q_hat_trunc = np.fft.fft(q_trunc)\n        \n        # Re-apply truncation to the resulting spectrum\n        q_hat_dealiased = q_hat_trunc.copy()\n        q_hat_dealiased[Kc + 1 : N - Kc] = 0\n        \n        # Calculate energy at the aliased wavenumber from the de-aliased spectrum\n        E_23 = np.abs(q_hat_dealiased[k_alias])**2 + np.abs(q_hat_dealiased[N - k_alias])**2\n\n        results.append(f\"[{E_naive},{E_23}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice applies aliasing control techniques to the advective nonlinearity $u u_x$ from the Burgers' equation, a model often used to study fluid dynamics. You will compare a naive pseudospectral evaluation against both the two-thirds de-aliasing rule  and an oversampling method, which provides an alias-free benchmark. This exercise  demonstrates how to diagnose and manage aliasing errors for the types of nonlinear terms that are central to numerical weather and climate models.",
            "id": "3446513",
            "problem": "Consider the one-dimensional viscous Burgers partial differential equation (PDE) on the periodic domain $[0,2\\pi)$,\n$$\nu_t + u\\,u_x = \\nu\\,u_{xx},\n$$\nand focus on the evaluation of the nonlinear term $u\\,u_x$ by spectral methods with global basis functions (complex exponentials). On a uniform grid with $N$ equispaced points $x_j = 2\\pi j/N$, $j=0,\\dots,N-1$, let $\\mathcal{F}_N$ denote the length-$N$ Discrete Fourier Transform (DFT) and $\\mathcal{F}_N^{-1}$ its inverse computed via the Fast Fourier Transform (FFT). The Fourier wavenumbers associated with the $2\\pi$-periodic basis are the integers $\\{k\\}$ consistent with $\\mathcal{F}_N$ ordering, and the spectral derivative operator maps a Fourier mode $e^{ikx}$ to $ik\\,e^{ikx}$.\n\nAliasing arises when evaluating nonlinear products in physical space at finite resolution and then transforming back to Fourier space, due to the discrete convolution wrapping high wavenumbers into the resolved band. A standard mitigation procedure for quadratic nonlinearities is the $2/3$-dealiasing rule, which discards or zeroes the top one-third of resolved Fourier modes so that, when forming products, no aliasing contaminates the retained spectrum. Another approach to quantify aliasing is to evaluate products on a higher-resolution grid and then spectrally truncate, which serves as an alias-free reference for the resolved band.\n\nYour task is to implement and compare three pseudospectral evaluations of the nonlinear term $u\\,u_x$:\n- A naive method at resolution $N$ (compute $u_x$ spectrally at resolution $N$, multiply $u$ and $u_x$ in physical space on the $N$-grid, transform back).\n- A $2/3$-dealiased method at resolution $N$ (zero out all modes with $|k|  \\lfloor N/3 \\rfloor$ in $u$ before forming the product, then after forming the product zero out the same high band in its Fourier coefficients).\n- An alias-free reference via $3/2$-oversampling: use a higher resolution $M = 3N/2$ grid to compute $u\\,u_x$ and then spectrally truncate to the $N$-grid (keep the central $N$ Fourier modes) for comparison.\n\nFor any length-$n$ Fourier coefficient array $\\widehat{f}^{(n)}$, use the normalization $\\widehat{f}^{(n)}_k/n$ when computing energies so that modal energies are comparable across resolutions. Define the high-wavenumber band $\\mathcal{H}_N$ as the set of indices $k$ satisfying $\\lfloor N/3 \\rfloor  |k| \\leq N/2$, where $N/2$ denotes the Nyquist wavenumber for even $N$ (include it if present). For each method, define the high-band energy of the nonlinear term as\n$$\nE_{\\text{high}}^{(n)} = \\sum_{k \\in \\mathcal{H}_N} \\left|\\frac{\\widehat{\\,u\\,u_x\\,}^{(n)}_k}{n}\\right|^2.\n$$\nHere, $\\widehat{\\,u\\,u_x\\,}^{(n)}$ denotes the DFT of $u\\,u_x$ computed at resolution $n$ using the specified method; for the alias-free reference, truncate the length-$M$ spectrum to the central $N$ modes before evaluating the sum. Quantify the aliasing energy transfer to high modes as\n$$\n\\Delta E_{\\text{high}} = E_{\\text{high, naive}} - E_{\\text{high, alias-free}}.\n$$\n\nImplement a program that evaluates $E_{\\text{high, naive}}$, $E_{\\text{high, dealiased}}$, and $\\Delta E_{\\text{high}}$ for each of the following test cases, using the exact $2\\pi$-periodic functions specified:\n- Test 1 (happy path): $N=64$, with\n$$\nu(x) = \\sin(x) + 0.5\\,\\sin(7x) + 0.25\\,\\cos(9x).\n$$\n- Test 2 (richer spectrum): $N=96$, with\n$$\nu(x) = \\cos(5x) + 0.8\\,\\sin(12x) + 0.3\\,\\cos(18x) + 0.2\\,\\sin(20x).\n$$\n- Test 3 (near-cutoff structure): $N=48$, with\n$$\nu(x) = 1.2\\,\\sin(10x + 0.5) + 0.7\\,\\cos(14x) + 0.4\\,\\sin(15x).\n$$\n\nAngle units for trigonometric functions are radians. No physical units are required. For each test case, output a list of three floating-point numbers\n$$\n\\left[E_{\\text{high, naive}},\\; E_{\\text{high, dealiased}},\\; \\Delta E_{\\text{high}}\\right],\n$$\nin this order. Your program should produce a single line of output containing the results as a comma-separated list of these three-element lists enclosed in square brackets (e.g., [[a,b,c],[d,e,f],[g,h,i]]). All floating-point results must be produced in decimal form. To ensure numerical robustness across platforms, it is acceptable to round each reported float to a fixed number of decimal places (e.g., $10$ to $12$ decimals).",
            "solution": "The problem requires the implementation and comparison of three pseudospectral methods for evaluating the nonlinear term $u\\,u_x$ from the one-dimensional viscous Burgers' equation. The comparison is based on the energy content in the high-wavenumber band of the resulting spectrum of $u\\,u_x$, which serves to quantify aliasing error. We will first outline the mathematical and algorithmic foundation for each method before presenting the final implementation.\n\nLet the domain be $2\\pi$-periodic, discretized by $N$ equispaced points $x_j = 2\\pi j/N$ for $j=0, \\dots, N-1$. A function $f(x)$ on this grid is represented by its discrete values $f_j = f(x_j)$. The Discrete Fourier Transform (DFT) of $f_j$ is denoted by $\\hat{f}_k = \\mathcal{F}_N(f)_k = \\sum_{j=0}^{N-1} f_j e^{-i k x_j}$, and its inverse (IDFT) is $f_j = \\mathcal{F}_N^{-1}(\\hat{f})_j = \\frac{1}{N} \\sum_{k} \\hat{f}_k e^{i k x_j}$. The integer wavenumbers $k$ are defined by the `numpy.fft.fftfreq` convention for a length-$N$ transform, scaled by $N$. The spectral derivative of $f(x)$ is computed in Fourier space by multiplying each coefficient $\\hat{f}_k$ by $ik$.\n\nThe nonlinear term $u\\,u_x$ is evaluated pseudospectrally: $u$ and $u_x$ are computed on the physical grid, multiplied point-wise, and the result is transformed back to Fourier space. The core of the problem lies in how aliasing errors, which arise from this nonlinear multiplication at finite resolution, are handled.\n\nThe three methods to be compared are:\n1.  A naive method at resolution $N$.\n2.  A $2/3$-rule dealiased method at resolution $N$.\n3.  An alias-free reference method using $3/2$-oversampling.\n\nLet's detail the algorithm for each.\n\n**1. Naive Pseudospectral Method**\nThis method directly implements the pseudospectral algorithm on the $N$-point grid without any explicit treatment for aliasing.\n-   Step 1: Given $u(x)$, evaluate it on the grid $x_j$ to get $u_j$.\n-   Step 2: Compute the DFT of $u_j$ to obtain $\\hat{u}_k = \\mathcal{F}_N(u)_k$.\n-   Step 3: Compute the spectral derivative in Fourier space: $(\\widehat{u_x})_k = ik\\,\\hat{u}_k$.\n-   Step 4: Transform the derivative back to physical space: $(u_x)_j = \\mathcal{F}_N^{-1}(\\widehat{u_x})_j$.\n-   Step 5: Form the product in physical space: $P_j = u_j \\cdot (u_x)_j$.\n-   Step 6: Compute the DFT of the product: $\\widehat{(uu_x)}_{\\text{naive},k} = \\mathcal{F}_N(P)_k$.\n\n**2. The $2/3$-Dealiased Method**\nThis method applies a low-pass filter to the function's spectrum before and after the nonlinear multiplication to control aliasing. The cutoff wavenumber is $k_{cut} = \\lfloor N/3 \\rfloor$.\n-   Step 1: Obtain $\\hat{u}_k$ as in the naive method.\n-   Step 2: Create a filtered spectrum $\\hat{u}_{\\text{filt},k}$ by setting to zero all modes of $\\hat{u}_k$ for which $|k|  k_{cut}$.\n-   Step 3: Compute the filtered function and its derivative in physical space: $u_{\\text{filt}} = \\mathcal{F}_N^{-1}(\\hat{u}_{\\text{filt}})$ and $(u_x)_{\\text{filt}} = \\mathcal{F}_N^{-1}(ik\\,\\hat{u}_{\\text{filt}})$.\n-   Step 4: Form the product of the filtered quantities: $P_{\\text{filt},j} = (u_{\\text{filt}})_j \\cdot ((u_x)_{\\text{filt}})_j$.\n-   Step 5: Transform the product to Fourier space: $\\widehat{P}_{\\text{filt},k} = \\mathcal{F}_N(P_{\\text{filt}})_k$.\n-   Step 6: Apply the filter again to the resulting spectrum: $\\widehat{(uu_x)}_{\\text{dealiased},k}$ is obtained by setting to zero all modes of $\\widehat{P}_{\\text{filt},k}$ for which $|k|  k_{cut}$.\n\n**3. Alias-Free Reference via $3/2$-Oversampling**\nThis method computes the product on a finer grid to avoid aliasing effects within the desired band of wavenumbers. The resolution is increased to $M = 3N/2$. For the quadratic nonlinearity $u\\,u_x$, if the spectrum of $u$ is contained within $|k| \\leq K$, the spectrum of the product is contained within $|k| \\leq 2K$. By choosing $M$ such that $2K  M/2$, aliasing is avoided. The $3/2$ rule ensures this for $K \\leq N/2$.\n-   Step 1: Evaluate $u(x)$ on a finer grid with $M=3N/2$ points.\n-   Step 2: Compute the product $u\\,u_x$ pseudospectrally on this $M$-point grid, yielding $\\widehat{(uu_x)}^{(M)}$.\n-   Step 3: To compare with the $N$-point methods, the resulting $M$-length spectrum is truncated to its central $N$ modes. This is done by taking the modes corresponding to wavenumbers $k$ such that $|k| \\le N/2$. This yields the truncated spectrum $\\widehat{(uu_x)}_{\\text{alias-free},k}^{(N)}$.\n\n**Energy Calculation and Comparison**\nThe analysis focuses on the energy in the high-wavenumber band $\\mathcal{H}_N = \\{k \\mid \\lfloor N/3 \\rfloor  |k| \\leq N/2 \\}$. The high-band energy for a given method resulting in a spectrum $\\hat{P}^{(n)}$ from a length-$n$ transform is:\n$$\nE_{\\text{high}} = \\sum_{k \\in \\mathcal{H}_N} \\left|\\frac{\\hat{P}_k}{n}\\right|^2\n$$\n-   For the naive method, $\\hat{P}_k = \\widehat{(uu_x)}_{\\text{naive},k}$ and $n=N$.\n-   For the dealiased method, $\\hat{P}_k = \\widehat{(uu_x)}_{\\text{dealiased},k}$ and $n=N$. By construction, all modes in $\\mathcal{H}_N$ are zeroed out, so $E_{\\text{high, dealiased}} = 0$.\n-   For the alias-free reference, we use the truncated spectrum $\\widehat{(uu_x)}_{\\text{alias-free},k}^{(N)}$, but the normalization factor corresponds to the transform length where the product was computed without aliasing, i.e., $n=M=3N/2$.\n\nThe aliasing energy transfer is quantified by the difference:\n$$\n\\Delta E_{\\text{high}} = E_{\\text{high, naive}} - E_{\\text{high, alias-free}}\n$$\nThis value represents the energy that erroneously appears in the high-wavenumber band of the naive method due to aliasing. A positive $\\Delta E_{\\text{high}}$ indicates that aliasing has contaminated the high modes.",
            "answer": "```python\nimport numpy as np\n\ndef u_test1(x):\n    \"\"\"Function for Test 1.\"\"\"\n    return np.sin(x) + 0.5 * np.sin(7*x) + 0.25 * np.cos(9*x)\n\ndef u_test2(x):\n    \"\"\"Function for Test 2.\"\"\"\n    return np.cos(5*x) + 0.8 * np.sin(12*x) + 0.3 * np.cos(18*x) + 0.2 * np.sin(20*x)\n\ndef u_test3(x):\n    \"\"\"Function for Test 3.\"\"\"\n    return 1.2 * np.sin(10*x + 0.5) + 0.7 * np.cos(14*x) + 0.4 * np.sin(15*x)\n\ndef compute_analysis(N, u_func):\n    \"\"\"\n    Implements and compares three pseudospectral evaluations of the nonlinear term u*u_x.\n\n    Args:\n        N (int): The number of grid points for the base resolution.\n        u_func (callable): The function u(x) to be analyzed.\n\n    Returns:\n        list: A list containing [E_high_naive, E_high_dealiased, Delta_E_high].\n    \"\"\"\n    # 1. Setup grids, wavenumbers, and initial function values\n    M = 3 * N // 2\n\n    # Physical grids\n    x_N = np.linspace(0, 2 * np.pi, N, endpoint=False)\n    x_M = np.linspace(0, 2 * np.pi, M, endpoint=False)\n\n    # Wavenumbers (integer convention for 2pi domain)\n    k_N = np.fft.fftfreq(N) * N\n    k_M = np.fft.fftfreq(M) * M\n\n    # Evaluate function on grids\n    u_vals_N = u_func(x_N)\n    u_vals_M = u_func(x_M)\n\n    # 2. Naive Method (Resolution N)\n    u_hat_N = np.fft.fft(u_vals_N)\n    ux_hat_N = 1j * k_N * u_hat_N\n    ux_vals_N = np.fft.ifft(ux_hat_N)\n    product_naive = u_vals_N * ux_vals_N.real\n    product_hat_naive = np.fft.fft(product_naive)\n\n    # 3. 2/3 Dealiased Method (Resolution N)\n    k_cut = N // 3\n    dealias_mask_N = np.abs(k_N) = k_cut\n    \n    u_hat_N_dealiased = u_hat_N * dealias_mask_N\n    ux_hat_N_dealiased = 1j * k_N * u_hat_N_dealiased\n    u_vals_N_dealiased = np.fft.ifft(u_hat_N_dealiased)\n    ux_vals_N_dealiased = np.fft.ifft(ux_hat_N_dealiased)\n    \n    product_dealiased = u_vals_N_dealiased.real * ux_vals_N_dealiased.real\n    product_hat_temp = np.fft.fft(product_dealiased)\n    product_hat_dealiased = product_hat_temp * dealias_mask_N\n\n    # 4. Alias-Free Reference (Resolution M = 3N/2)\n    u_hat_M = np.fft.fft(u_vals_M)\n    ux_hat_M = 1j * k_M * u_hat_M\n    ux_vals_M = np.fft.ifft(ux_hat_M)\n    \n    product_alias_free = u_vals_M * ux_vals_M.real\n    product_hat_M_alias_free = np.fft.fft(product_alias_free)\n\n    # Truncate M-spectrum to N-spectrum using fftshift for clarity\n    product_hat_M_shifted = np.fft.fftshift(product_hat_M_alias_free)\n    start_idx = (M - N) // 2\n    end_idx = start_idx + N\n    product_hat_trunc_shifted = product_hat_M_shifted[start_idx:end_idx]\n    product_hat_trunc = np.fft.ifftshift(product_hat_trunc_shifted)\n    \n    # 5. Energy Calculations\n    high_k_mask = np.abs(k_N) > k_cut\n\n    # E_high_naive\n    E_high_naive = np.sum(np.abs(product_hat_naive[high_k_mask] / N)**2)\n    \n    # E_high_dealiased (zero by construction)\n    E_high_dealiased = np.sum(np.abs(product_hat_dealiased[high_k_mask] / N)**2)\n    \n    # E_high_alias-free (note normalization by M)\n    E_high_alias_free = np.sum(np.abs(product_hat_trunc[high_k_mask] / M)**2)\n\n    # Aliasing energy transfer\n    Delta_E_high = E_high_naive - E_high_alias_free\n    \n    return [E_high_naive, E_high_dealiased, Delta_E_high]\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the final results.\n    \"\"\"\n    test_cases = [\n        (64, u_test1),\n        (96, u_test2),\n        (48, u_test3),\n    ]\n\n    all_results = []\n    for N, u_func in test_cases:\n        energies = compute_analysis(N, u_func)\n        # Format output to a fixed number of decimal places for robustness\n        formatted_energies = [f\"{e:.12f}\" for e in energies]\n        all_results.append(f\"[{','.join(formatted_energies)}]\")\n\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}