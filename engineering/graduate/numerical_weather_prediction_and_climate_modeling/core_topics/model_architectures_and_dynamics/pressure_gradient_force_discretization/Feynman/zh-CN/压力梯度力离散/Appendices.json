{
    "hands_on_practices": [
        {
            "introduction": "数值建模的第一步是将连续的物理定律转化为离散的代数方程。本练习  将通过一个“纸笔”实践，带你从一个解析的压力场出发，推导其有限差分近似，并至关重要地，通过推导截断误差来量化其精度。理解这种误差的来源和量级，是评估和改进数值方法的基石。",
            "id": "4078188",
            "problem": "在数值天气预报（NWP）的背景下，考虑一个连续层结、无粘性的干大气。其解析压力场由 $p(x,y,z)=p_0 \\exp(-\\alpha x - \\beta y - \\gamma z)$ 给出，其中 $p_0>0$ 且 $\\alpha>0$, $\\beta>0$, $\\gamma>0$ 是常数。质量密度是一个光滑的、严格为正的高度函数，$\\rho(z)>0$。假设唯一的内应力是各向同性的压力，由应力张量 $-p \\mathbf{I}$ 表示。\n\n从应用于流体质点的牛顿第二定律和无粘性流体的柯西动量方程出发，推导该大气的单位质量气压梯度加速度矢量场。利用你的结果，计算其分量大小 $|a_{p,x}|$、 $|a_{p,y}|$ 和 $|a_{p,z}|$，并确定它们的比值。然后，在一个均匀的笛卡尔网格上，使用网格间距 $\\Delta x>0$，为一个网格点 $(x,y,z)$ 处的压力 $x$ 方向导数构建一个二阶中心有限差分近似，并通过在中心高度 $z$ 处计算 $1/\\rho$ 来形成离散气压梯度加速度 $a_{p,x}^{(d)}(x,y,z)$。\n\n推导 $a_{p,x}^{(d)}(x,y,z)$ 的主阶截断误差项及其大小。最后，报告 $a_{p,x}^{(d)}(x,y,z)$ 中主阶截断误差的大小与连续 $x$ 分量 $a_{p,x}(x,y,z)$ 大小的比值 $E_x$。将最终比值 $E_x$ 表示为仅含 $\\alpha$ 和 $\\Delta x$ 的单个闭式解析表达式。气压梯度加速度的单位是 $\\mathrm{m\\,s^{-2}}$，但报告的比值 $E_x$ 必须表示为无量纲量。不需要进行数值近似。",
            "solution": "该问题要求进行几项与特定大气模型中气压梯度加速度相关的推导。验证过程确认了问题陈述具有科学依据、问题适定，并包含了完整求解所需的所有信息。\n\n首先，我们推导单位质量气压梯度加速度矢量场 $\\mathbf{a}_p$。根据流体动力学原理，特别是无粘性流体的柯西动量方程，由压力产生的单位体积力由气压梯度的负值给出，即 $-\\nabla p$。单位质量的力，即加速度，是通过除以质量密度 $\\rho$ 得到的。因此，气压梯度加速度为：\n$$\n\\mathbf{a}_p(x,y,z) = -\\frac{1}{\\rho(z)} \\nabla p(x,y,z)\n$$\n压力场由 $p(x,y,z) = p_0 \\exp(-\\alpha x - \\beta y - \\gamma z)$ 给出。我们计算 $p$ 的梯度，即其偏导数组成的矢量：\n$$\n\\nabla p = \\frac{\\partial p}{\\partial x}\\mathbf{i} + \\frac{\\partial p}{\\partial y}\\mathbf{j} + \\frac{\\partial p}{\\partial z}\\mathbf{k}\n$$\n偏导数是：\n$$\n\\frac{\\partial p}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[p_0 \\exp(-\\alpha x - \\beta y - \\gamma z)\\right] = p_0 (-\\alpha) \\exp(-\\alpha x - \\beta y - \\gamma z) = -\\alpha p(x,y,z)\n$$\n$$\n\\frac{\\partial p}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[p_0 \\exp(-\\alpha x - \\beta y - \\gamma z)\\right] = p_0 (-\\beta) \\exp(-\\alpha x - \\beta y - \\gamma z) = -\\beta p(x,y,z)\n$$\n$$\n\\frac{\\partial p}{\\partial z} = \\frac{\\partial}{\\partial z} \\left[p_0 \\exp(-\\alpha x - \\beta y - \\gamma z)\\right] = p_0 (-\\gamma) \\exp(-\\alpha x - \\beta y - \\gamma z) = -\\gamma p(x,y,z)\n$$\n因此，压力场的梯度可以紧凑地写为：\n$$\n\\nabla p(x,y,z) = -(\\alpha\\mathbf{i} + \\beta\\mathbf{j} + \\gamma\\mathbf{k}) p(x,y,z)\n$$\n将此代入 $\\mathbf{a}_p$ 的表达式中：\n$$\n\\mathbf{a}_p(x,y,z) = -\\frac{1}{\\rho(z)} \\left[-(\\alpha\\mathbf{i} + \\beta\\mathbf{j} + \\gamma\\mathbf{k}) p(x,y,z)\\right] = \\frac{p(x,y,z)}{\\rho(z)}(\\alpha\\mathbf{i} + \\beta\\mathbf{j} + \\gamma\\mathbf{k})\n$$\n加速度矢量的分量为：\n$$\na_{p,x}(x,y,z) = \\frac{\\alpha p(x,y,z)}{\\rho(z)}\n$$\n$$\na_{p,y}(x,y,z) = \\frac{\\beta p(x,y,z)}{\\rho(z)}\n$$\n$$\na_{p,z}(x,y,z) = \\frac{\\gamma p(x,y,z)}{\\rho(z)}\n$$\n鉴于 $p_0>0$、$\\alpha>0$、$\\beta>0$、$\\gamma>0$ 且 $\\rho(z)>0$，压力 $p(x,y,z)$ 始终为正。因此，各分量的大小为：\n$$\n|a_{p,x}| = \\frac{\\alpha p}{\\rho}, \\quad |a_{p,y}| = \\frac{\\beta p}{\\rho}, \\quad |a_{p,z}| = \\frac{\\gamma p}{\\rho}\n$$\n这些大小的比值为：\n$$\n|a_{p,x}| : |a_{p,y}| : |a_{p,z}| = \\frac{\\alpha p}{\\rho} : \\frac{\\beta p}{\\rho} : \\frac{\\gamma p}{\\rho} = \\alpha : \\beta : \\gamma\n$$\n接下来，我们构建压力 $x$ 方向导数 $\\frac{\\partial p}{\\partial x}$ 的二阶中心有限差分近似。对于网格间距为 $\\Delta x$ 的点 $(x,y,z)$，该近似的公式为：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)^{(d)} = \\frac{p(x+\\Delta x, y, z) - p(x-\\Delta x, y, z)}{2\\Delta x}\n$$\n我们在移位点上计算压力函数的值：\n$$\np(x+\\Delta x, y, z) = p_0 \\exp(-\\alpha(x+\\Delta x) - \\beta y - \\gamma z) = p(x,y,z) \\exp(-\\alpha \\Delta x)\n$$\n$$\np(x-\\Delta x, y, z) = p_0 \\exp(-\\alpha(x-\\Delta x) - \\beta y - \\gamma z) = p(x,y,z) \\exp(\\alpha \\Delta x)\n$$\n将这些代入有限差分公式中：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)^{(d)} = \\frac{p(x,y,z) \\exp(-\\alpha \\Delta x) - p(x,y,z) \\exp(\\alpha \\Delta x)}{2\\Delta x} = p(x,y,z) \\frac{\\exp(-\\alpha \\Delta x) - \\exp(\\alpha \\Delta x)}{2\\Delta x}\n$$\n使用双曲正弦函数的定义 $\\sinh(u) = (\\exp(u) - \\exp(-u))/2$，我们可以简化这个表达式：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)^{(d)} = - p(x,y,z) \\frac{\\exp(\\alpha \\Delta x) - \\exp(-\\alpha \\Delta x)}{2\\Delta x} = - p(x,y,z) \\frac{\\sinh(\\alpha \\Delta x)}{\\Delta x}\n$$\n$x$ 方向的离散气压梯度加速度 $a_{p,x}^{(d)}$ 是通过使用这个离散导数形成的：\n$$\na_{p,x}^{(d)}(x,y,z) = -\\frac{1}{\\rho(z)} \\left(\\frac{\\partial p}{\\partial x}\\right)^{(d)} = -\\frac{1}{\\rho(z)} \\left(-p(x,y,z) \\frac{\\sinh(\\alpha \\Delta x)}{\\Delta x}\\right) = \\frac{p(x,y,z)}{\\rho(z)} \\frac{\\sinh(\\alpha \\Delta x)}{\\Delta x}\n$$\n现在，我们求主阶截断误差。截断误差是离散近似与精确连续量之间的差值，即 $T_{a,x} = a_{p,x}^{(d)} - a_{p,x}$。我们可以通过将 $a_{p,x}^{(d)}$ 对小的 $\\Delta x$ 进行泰勒级数展开来求得此误差。$\\sinh(u)$ 在 $u=0$ 附近的泰勒级数为 $\\sinh(u) = u + \\frac{u^3}{3!} + \\frac{u^5}{5!} + \\dots$。\n令 $u = \\alpha \\Delta x$。则：\n$$\n\\frac{\\sinh(\\alpha \\Delta x)}{\\Delta x} = \\frac{1}{\\Delta x} \\left(\\alpha \\Delta x + \\frac{(\\alpha \\Delta x)^3}{6} + O(\\Delta x^5)\\right) = \\alpha + \\frac{\\alpha^3 \\Delta x^2}{6} + O(\\Delta x^4)\n$$\n将此展开式代回 $a_{p,x}^{(d)}$ 的表达式中：\n$$\na_{p,x}^{(d)} = \\frac{p}{\\rho} \\left(\\alpha + \\frac{\\alpha^3 \\Delta x^2}{6} + O(\\Delta x^4)\\right) = \\frac{\\alpha p}{\\rho} + \\frac{\\alpha^3 p \\Delta x^2}{6\\rho} + O(\\Delta x^4)\n$$\n第一项 $\\frac{\\alpha p}{\\rho}$ 正是连续加速度分量 $a_{p,x}$。余下的项代表截断误差。主阶截断误差项是这些项中的第一项：\n$$\nT_{a,x, \\text{leading}} = \\frac{\\alpha^3 p(x,y,z) \\Delta x^2}{6\\rho(z)}\n$$\n由于所有参数和函数均为正，该误差的大小就是该项本身：\n$$\n|T_{a,x, \\text{leading}}| = \\frac{\\alpha^3 p \\Delta x^2}{6\\rho}\n$$\n最后，我们计算主阶截断误差的大小与加速度连续 $x$ 分量的大小的比值 $E_x$。\n$$\n|a_{p,x}| = \\left|\\frac{\\alpha p}{\\rho}\\right| = \\frac{\\alpha p}{\\rho}\n$$\n$$\nE_x = \\frac{|T_{a,x, \\text{leading}}|}{|a_{p,x}|} = \\frac{\\frac{\\alpha^3 p \\Delta x^2}{6\\rho}}{\\frac{\\alpha p}{\\rho}}\n$$\n$p(x,y,z)$ 和 $\\rho(z)$ 项相互抵消：\n$$\nE_x = \\frac{\\alpha^3 \\Delta x^2}{6\\alpha} = \\frac{\\alpha^2 \\Delta x^2}{6}\n$$\n该表达式是无量纲的，因为 $\\alpha$ 的单位是长度的倒数，而 $\\Delta x$ 的单位是长度。结果是按要求给出的，一个仅含 $\\alpha$ 和 $\\Delta x$ 的闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{\\alpha^{2} \\Delta x^{2}}{6}}\n$$"
        },
        {
            "introduction": "在掌握了基本的离散化概念后，我们将其应用于大气模型的一个基石——静力平衡关系。本练习  探讨了在交错网格上，如何使用不同的数值积分（求积）方法来计算层与层之间的位势高度差。通过分析不同方法在特定大气廓线下的精度，你将理解离散化方案的选择如何直接影响模型对垂直结构的刻画。",
            "id": "4078170",
            "problem": "在气压坐标下的Boussinesq近似中，流体静力平衡关系下，位势 $\\Phi(p)$ 满足关系式 $\\frac{\\partial \\Phi}{\\partial p}=-\\alpha(p)$，其中 $\\alpha(p)$ 是比容。考虑用于数值天气预报(NWP)和气候模式中的一个垂直气柱中的单个垂直层，该层在气压 $p$ 的交错网格上表示，位势存储在半层 $p_{k-\\frac{1}{2}}$ 和 $p_{k+\\frac{1}{2}}$ 上，代表层为 $p_k=\\frac{p_{k-\\frac{1}{2}}+p_{k+\\frac{1}{2}}}{2}$。设该层的气压厚度为 $\\Delta p=p_{k+\\frac{1}{2}}-p_{k-\\frac{1}{2}}$，为分析目的，假设其为常数。静力平衡关系意味着该层的位势增量为\n$$\n\\Delta \\Phi_k \\equiv \\Phi_{k+\\frac{1}{2}}-\\Phi_{k-\\frac{1}{2}}=-\\int_{p_{k-\\frac{1}{2}}}^{p_{k+\\frac{1}{2}}}\\alpha(p)\\,dp.\n$$\n任务：\n- 仅从基本关系式 $\\frac{\\partial \\Phi}{\\partial p}=-\\alpha(p)$ 和上述层位势增量的定义出发，推导在此交错网格上计算 $\\Delta \\Phi_k$ 的两种离散求积公式：\n  (i) 使用半层 $p_{k-\\frac{1}{2}}$ 和 $p_{k+\\frac{1}{2}}$ 上的 $\\alpha$ 值的梯形公式，以及\n  (ii) 使用 $p_{k-\\frac{1}{2}}$、$p_k$ 和 $p_{k+\\frac{1}{2}}$ 上的 $\\alpha$ 值的辛普森公式。\n- 对于每种求积方法，当 $\\alpha(p)$ 分别为以下情况时，解析地确定其截断误差 $E=\\Delta \\Phi_{\\text{approx}}-\\Delta \\Phi_{\\text{exact}}$：\n  (a) 线性函数，$\\alpha(p)=a+b\\,p$，以及\n  (b) 二次函数，$\\alpha(p)=a+b\\,p+c\\,p^{2}$，其中 $a$、$b$ 和 $c$ 是常数。\n- 将所有误差表示为系数和 $\\Delta p$ 的闭合形式函数，并尽可能消除对 $p_k$ 的依赖。\n\n提供行向量 $\\big[E_T^{\\text{lin}},\\;E_T^{\\text{quad}},\\;E_S^{\\text{lin}},\\;E_S^{\\text{quad}}\\big]$ 作为最终答案，其中下标 $T$ 表示梯形法则，$S$ 表示辛普森法则。不需要进行数值舍入，必须提供精确的代数表达式。最终答案中不要包含单位。",
            "solution": "任务是为静力平衡积分推导两种数值求积公式，并确定它们在线性和二次比容廓线下的精确截断误差。该问题在数值大气模拟的背景下是适定的，并具有科学依据。\n\n基本的静力平衡关系由 $\\frac{\\partial \\Phi}{\\partial p}=-\\alpha(p)$ 给出，其中 $\\Phi$ 是位势，$p$ 是气压，$\\alpha$ 是比容。跨越从气压 $p_{k-\\frac{1}{2}}$ 到 $p_{k+\\frac{1}{2}}$ 的一个层的精确位势增量为\n$$\n\\Delta \\Phi_{k, \\text{exact}} = \\Phi_{k+\\frac{1}{2}}-\\Phi_{k-\\frac{1}{2}} = -\\int_{p_{k-\\frac{1}{2}}}^{p_{k+\\frac{1}{2}}}\\alpha(p)\\,dp\n$$\n我们定义层的中点气压为 $p_k = \\frac{p_{k-\\frac{1}{2}}+p_{k+\\frac{1}{2}}}{2}$，层厚度为 $\\Delta p = p_{k+\\frac{1}{2}}-p_{k-\\frac{1}{2}}$。积分上下限可以表示为 $p_{k-\\frac{1}{2}} = p_k - \\frac{\\Delta p}{2}$ 和 $p_{k+\\frac{1}{2}} = p_k + \\frac{\\Delta p}{2}$。\n\n首先，我们推导两种指定的用于 $\\Delta \\Phi_k$ 的离散求积公式。\n\n(i) 梯形公式：\n对于积分 $\\int_{A}^{B} f(x) \\, dx$，标准的梯形法则是 $\\frac{B-A}{2}(f(A) + f(B))$。将其应用于 $\\Delta\\Phi_k$ 的积分，其中 $A = p_{k-\\frac{1}{2}}$，$B = p_{k+\\frac{1}{2}}$，以及 $f(p) = \\alpha(p)$，我们得到积分的近似值为 $\\frac{\\Delta p}{2}(\\alpha(p_{k-\\frac{1}{2}}) + \\alpha(p_{k+\\frac{1}{2}}))$。考虑负号，位势增量的梯形近似为：\n$$\n\\Delta \\Phi_{k, \\text{approx}, T} = -\\frac{\\Delta p}{2}(\\alpha_{k-\\frac{1}{2}} + \\alpha_{k+\\frac{1}{2}})\n$$\n其中我们使用简写 $\\alpha_{i} = \\alpha(p_{i})$。\n\n(ii) 辛普森公式：\n辛普森法则将 $\\int_{A}^{B} f(x) \\, dx$ 近似为 $\\frac{B-A}{6}(f(A) + 4f(\\frac{A+B}{2}) + f(B))$。对于我们的积分，中点是 $p_k$。因此积分的近似值为 $\\frac{\\Delta p}{6}(\\alpha(p_{k-\\frac{1}{2}}) + 4\\alpha(p_k) + \\alpha(p_{k+\\frac{1}{2}}))$。相应的位势增量近似为：\n$$\n\\Delta \\Phi_{k, \\text{approx}, S} = -\\frac{\\Delta p}{6}(\\alpha_{k-\\frac{1}{2}} + 4\\alpha_k + \\alpha_{k+\\frac{1}{2}})\n$$\n\n接下来，我们针对每种法则和两种 $\\alpha(p)$ 的廓线确定截断误差 $E = \\Delta \\Phi_{\\text{approx}} - \\Delta \\Phi_{\\text{exact}}$。\n\n为此，我们首先计算精确积分 $\\Delta \\Phi_{k, \\text{exact}}$。进行变量替换会很方便，令 $p = p_k + q$，则 $dp = dq$。积分上下限变为 $q = \\pm \\frac{\\Delta p}{2}$。\n$$\n\\Delta \\Phi_{k, \\text{exact}} = -\\int_{-\\Delta p/2}^{\\Delta p/2} \\alpha(p_k+q) \\, dq\n$$\n\n(a) 对于线性函数 $\\alpha(p) = a+b\\,p$：\n$\\alpha(p_k+q) = a + b(p_k+q) = (a+bp_k) + bq$。\n$$\n\\Delta \\Phi_{k, \\text{exact}}^{\\text{lin}} = -\\int_{-\\Delta p/2}^{\\Delta p/2} ((a+bp_k) + bq) \\, dq = - \\left[ (a+bp_k)q + \\frac{b}{2}q^2 \\right]_{-\\Delta p/2}^{\\Delta p/2}\n$$\n$$\n= - \\left( (a+bp_k)\\Delta p + \\frac{b}{2}((\\frac{\\Delta p}{2})^2 - (-\\frac{\\Delta p}{2})^2) \\right) = -(a+bp_k)\\Delta p\n$$\n\n(b) 对于二次函数 $\\alpha(p) = a+b\\,p+c\\,p^2$：\n$\\alpha(p_k+q) = a + b(p_k+q) + c(p_k+q)^2 = (a+bp_k+cp_k^2) + (b+2cp_k)q + cq^2$。\n$$\n\\Delta \\Phi_{k, \\text{exact}}^{\\text{quad}} = -\\int_{-\\Delta p/2}^{\\Delta p/2} ((a+bp_k+cp_k^2)+(b+2cp_k)q+cq^2) \\, dq\n$$\n关于 $q$ 的线性项在对称区间上的积分为零。\n$$\n= - \\left[ (a+bp_k+cp_k^2)q + \\frac{c}{3}q^3 \\right]_{-\\Delta p/2}^{\\Delta p/2} = - \\left( (a+bp_k+cp_k^2)\\Delta p + \\frac{c}{3}(2(\\frac{\\Delta p}{2})^3) \\right)\n$$\n$$\n= -(a+bp_k+cp_k^2)\\Delta p - \\frac{c}{3}\\frac{\\Delta p^3}{4} = -(a+bp_k+cp_k^2)\\Delta p - \\frac{c}{12}\\Delta p^3\n$$\n\n现在我们计算误差。误差为 $E = \\Delta \\Phi_{\\text{approx}} - \\Delta \\Phi_{\\text{exact}}$。\n\n**梯形法则误差：**\n\n对于线性函数 $\\alpha(p) = a+bp$：\n$\\alpha_{k-\\frac{1}{2}} = a + b(p_k-\\frac{\\Delta p}{2})$\n$\\alpha_{k+\\frac{1}{2}} = a + b(p_k+\\frac{\\Delta p}{2})$\n$\\alpha_{k-\\frac{1}{2}} + \\alpha_{k+\\frac{1}{2}} = 2a + 2bp_k = 2(a+bp_k)$。\n$$\n\\Delta \\Phi_{k, \\text{approx}, T}^{\\text{lin}} = -\\frac{\\Delta p}{2} (2(a+bp_k)) = -(a+bp_k)\\Delta p\n$$\n$E_T^{\\text{lin}} = \\Delta \\Phi_{k, \\text{approx}, T}^{\\text{lin}} - \\Delta \\Phi_{k, \\text{exact}}^{\\text{lin}} = -(a+bp_k)\\Delta p - (-(a+bp_k)\\Delta p) = 0$。\n\n对于二次函数 $\\alpha(p) = a+b\\,p+c\\,p^2$：\n$\\alpha_{k-\\frac{1}{2}} = a+b(p_k-\\frac{\\Delta p}{2}) + c(p_k-\\frac{\\Delta p}{2})^2$\n$\\alpha_{k+\\frac{1}{2}} = a+b(p_k+\\frac{\\Delta p}{2}) + c(p_k+\\frac{\\Delta p}{2})^2$\n将它们相加：\n$\\alpha_{k-\\frac{1}{2}} + \\alpha_{k+\\frac{1}{2}} = 2(a+bp_k) + c \\left[ (p_k-\\frac{\\Delta p}{2})^2 + (p_k+\\frac{\\Delta p}{2})^2 \\right]$\n$= 2(a+bp_k) + c \\left[ (p_k^2-p_k\\Delta p+\\frac{\\Delta p^2}{4}) + (p_k^2+p_k\\Delta p+\\frac{\\Delta p^2}{4}) \\right]$\n$= 2(a+bp_k) + c(2p_k^2+\\frac{\\Delta p^2}{2}) = 2(a+bp_k+cp_k^2) + c\\frac{\\Delta p^2}{2}$。\n$$\n\\Delta \\Phi_{k, \\text{approx}, T}^{\\text{quad}} = -\\frac{\\Delta p}{2} \\left[ 2(a+bp_k+cp_k^2) + c\\frac{\\Delta p^2}{2} \\right] = -(a+bp_k+cp_k^2)\\Delta p - \\frac{c}{4}\\Delta p^3\n$$\n误差为：\n$E_T^{\\text{quad}} = \\Delta \\Phi_{k, \\text{approx}, T}^{\\text{quad}} - \\Delta \\Phi_{k, \\text{exact}}^{\\text{quad}} = \\left(-(a+bp_k+cp_k^2)\\Delta p - \\frac{c}{4}\\Delta p^3\\right) - \\left(-(a+bp_k+cp_k^2)\\Delta p - \\frac{c}{12}\\Delta p^3\\right)$\n$E_T^{\\text{quad}} = -\\frac{c}{4}\\Delta p^3 + \\frac{c}{12}\\Delta p^3 = c\\Delta p^3(-\\frac{1}{4}+\\frac{1}{12}) = c\\Delta p^3(-\\frac{3}{12}+\\frac{1}{12}) = -\\frac{2c}{12}\\Delta p^3 = -\\frac{c}{6}\\Delta p^3$。\n\n**辛普森法则误差：**\n\n对于线性函数 $\\alpha(p) = a+bp$：\n辛普森法则对最高3次的多项式是精确的，所以对于线性函数，误差必须为零。我们来验证一下。\n$\\alpha_k = a+bp_k$。\n该法则的求和项为 $\\alpha_{k-\\frac{1}{2}} + 4\\alpha_k + \\alpha_{k+\\frac{1}{2}} = (2a+2bp_k) + 4(a+bp_k) = 6(a+bp_k)$。\n$$\n\\Delta \\Phi_{k, \\text{approx}, S}^{\\text{lin}} = -\\frac{\\Delta p}{6} (6(a+bp_k)) = -(a+bp_k)\\Delta p\n$$\n$E_S^{\\text{lin}} = \\Delta \\Phi_{k, \\text{approx}, S}^{\\text{lin}} - \\Delta \\Phi_{k, \\text{exact}}^{\\text{lin}} = -(a+bp_k)\\Delta p - (-(a+bp_k)\\Delta p) = 0$。\n\n对于二次函数 $\\alpha(p) = a+b\\,p+c\\,p^2$：\n基于二次拟合，辛普森法则对二次多项式是精确的。我们来验证一下。\n$\\alpha_k = a+bp_k+cp_k^2$。\n求和项为 $(\\alpha_{k-\\frac{1}{2}} + \\alpha_{k+\\frac{1}{2}}) + 4\\alpha_k$。从梯形法则的计算中，我们有 $\\alpha_{k-\\frac{1}{2}} + \\alpha_{k+\\frac{1}{2}} = 2(a+bp_k+cp_k^2) + c\\frac{\\Delta p^2}{2}$。\n求和 = $2(a+bp_k+cp_k^2) + c\\frac{\\Delta p^2}{2} + 4(a+bp_k+cp_k^2) = 6(a+bp_k+cp_k^2) + c\\frac{\\Delta p^2}{2}$。\n$$\n\\Delta \\Phi_{k, \\text{approx}, S}^{\\text{quad}} = -\\frac{\\Delta p}{6} \\left[ 6(a+bp_k+cp_k^2) + c\\frac{\\Delta p^2}{2} \\right] = -(a+bp_k+cp_k^2)\\Delta p - \\frac{c}{12}\\Delta p^3\n$$\n这与 $\\Delta \\Phi_{k, \\text{exact}}^{\\text{quad}}$ 完全相同。\n$E_S^{\\text{quad}} = \\Delta \\Phi_{k, \\text{approx}, S}^{\\text{quad}} - \\Delta \\Phi_{k, \\text{exact}}^{\\text{quad}} = 0$。\n\n四个误差分别为：\n$E_T^{\\text{lin}} = 0$\n$E_T^{\\text{quad}} = -\\frac{c}{6}\\Delta p^3$\n$E_S^{\\text{lin}} = 0$\n$E_S^{\\text{quad}} = 0$\n\n最终答案是这四个量的行向量。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & -\\frac{c}{6}\\Delta p^{3} & 0 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从理想化的垂直坐标转向复杂的现实世界，本练习  将直面一个天气预报中的经典且关键的难题：在地形追随坐标系下计算压力梯度力时产生的虚假水平力。通过结合解析推导与数值编程，你将亲手量化这一误差，并深刻理解为何需要更复杂的离散化方案来确保大气模拟的真实性。",
            "id": "4078195",
            "problem": "考虑一个二维、干燥、静力平衡的大气，它位于一个由地形表面 $z_s(x)$ 代表的缓坡山脉之上，其坡度是恒定的，由 $\\mathrm{d}z_s/\\mathrm{d}x = \\epsilon$ 给出。假设温度 $T_0$ 水平均匀，重力加速度 $g$ 恒定。静力平衡由基本定律 $\\frac{\\partial p}{\\partial z} = -\\rho g$ 和理想气体定律 $p = \\rho R T_0$ 定义，其中 $p$ 是压力，$\\rho$ 是密度，$R$ 是干空气的比气体常数，$T_0$ 是恒定温度。定义标高 $H = \\frac{R T_0}{g}$。设大气层顶高度为 $H_{\\mathrm{top}}$，并引入地形追随坐标 $\\sigma \\in [0,1]$，其通过 $z(x,\\sigma) = z_s(x) + \\sigma H_{\\mathrm{top}}$ 映射到物理高度。精确的静力压力廓线为 $p(x,\\sigma) = p_0 \\exp\\!\\left(-\\frac{z(x,\\sigma)}{H}\\right)$，其中 $p_0$ 为参考海平面气压。\n\n水平气压梯度力 (PGF) 在地形追随层上的一种非一致离散化方法，计算固定 $\\sigma_j$ 上的水平加速度为\n$$\na_x(x_i,\\sigma_j) = -\\frac{1}{\\rho(x_i,\\sigma_j)} \\frac{p(x_{i+1},\\sigma_j) - p(x_{i-1},\\sigma_j)}{2\\Delta x},\n$$\n其中 $\\Delta x$ 是水平网格间距，且 $\\rho(x_i,\\sigma_j) = \\frac{p(x_i,\\sigma_j)}{R T_0}$。\n\n您的任务是：\n1. 从给定的基本关系出发，推导这种非一致离散化在倾斜地形上产生的虚假水平加速度 $a_x$ 的主阶表达式。在适当的地方使用泰勒展开，表达 $a_x$ 对坡度 $\\epsilon$ 和网格间距 $\\Delta x$ 的依赖关系。解释为什么主阶项与 $\\sigma_j$ 无关，并给出次阶项随 $\\epsilon$ 和 $\\Delta x$ 变化的标度关系。\n2. 实现一个程序，使用指定的离散化方法，对区域中心（$x$ 位于水平网格中点）和中间层 $\\sigma = 0.5$ 的 $a_x$ 进行数值计算。使用精确的静力压力场 $p(x,\\sigma) = p_0 \\exp\\!\\left(-\\frac{z_s(x) + \\sigma H_{\\mathrm{top}}}{H}\\right)$，其中 $z_s(x) = \\epsilon x$，以及 $\\rho(x,\\sigma) = \\frac{p(x,\\sigma)}{R T_0}$。\n\n使用以下物理和数值参数：\n- $g = 9.81$ 单位 $\\mathrm{m/s^2}$，\n- $R = 287$ 单位 $\\mathrm{J/(kg\\cdot K)}$，\n- $T_0 = 300$ 单位 $\\mathrm{K}$，\n- $p_0 = 100000$ 单位 $\\mathrm{Pa}$，\n- $H_{\\mathrm{top}} = 9000$ 单位 $\\mathrm{m}$，\n- 区域长度 $L = 10000$ 单位 $\\mathrm{m}$。\n\n将水平网格定义为 $x_i = i \\Delta x$，其中 $i = 0,1,\\dots,N_x-1$，$N_x = \\left\\lfloor \\frac{L}{\\Delta x} \\right\\rfloor + 1$。在中心点索引 $i_{\\mathrm{mid}} = \\left\\lfloor \\frac{N_x}{2} \\right\\rfloor$ 处计算中心有限差分近似。\n\n对以下每个测试用例（$(\\epsilon,\\Delta x)$ 对）计算 $a_x$（单位：$\\mathrm{m/s^2}$）：\n- 测试 1 (正常情况): $(\\epsilon,\\Delta x) = (0.01, 1000)$,\n- 测试 2 (加密网格): $(\\epsilon,\\Delta x) = (0.01, 250)$,\n- 测试 3 (小坡度): $(\\epsilon,\\Delta x) = (0.001, 1000)$,\n- 测试 4 (小坡度范围内的较大坡度): $(\\epsilon,\\Delta x) = (0.1, 1000)$,\n- 测试 5 (边界情况): $(\\epsilon,\\Delta x) = (0.0, 1000)$.\n\n将每个得到的 $a_x$ 以 $\\mathrm{m/s^2}$ 为单位表示，并四舍五入到六位小数。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[$a_1$,$a_2$,$a_3$,$a_4$,$a_5$]”），其中每个 $a_k$ 按上述顺序列出了对应测试用例的结果。",
            "solution": "该问题是有效的。它提出了一个大气建模数值方法中的标准、适定问题，为解析推导和数值实现提供了所有必要的物理和数值参数。其基本原理在科学上是合理的，目标清晰且可形式化。\n\n任务是分析在地形追随坐标系中，一种常见但有缺陷的气压梯度力 (PGF) 有限差分近似所产生的虚假水平加速度。在给定的倾斜地形上静止的静力平衡大气情景中，真实的水平加速度为零，因为在等几何高度 $z$ 的表面上不存在水平气压梯度。任何计算出的非零加速度 $a_x$ 都是一种数值误差。\n\n首先，我们推导这个虚假加速度 $a_x$ 的解析表达式。给定的数值格式为：\n$$\na_x(x_i,\\sigma_j) = -\\frac{1}{\\rho(x_i,\\sigma_j)} \\frac{p(x_{i+1},\\sigma_j) - p(x_{i-1},\\sigma_j)}{2\\Delta x}\n$$\n使用理想气体定律 $p = \\rho R T_0$，我们可以将密度表示为 $\\rho = p / (R T_0)$。将此代入 $a_x$ 的表达式中得到：\n$$\na_x(x_i,\\sigma_j) = -\\frac{R T_0}{p(x_i,\\sigma_j)} \\frac{p(x_{i+1},\\sigma_j) - p(x_{i-1},\\sigma_j)}{2\\Delta x}\n$$\n该有限差分项是在恒定 $\\sigma$ 层上压力对 $x$ 的偏导数的二阶近似：\n$$\n\\frac{p(x_{i+1},\\sigma_j) - p(x_{i-1},\\sigma_j)}{2\\Delta x} \\approx \\left(\\frac{\\partial p}{\\partial x}\\right)_{\\sigma}\n$$\n然而，物理上的 PGF 是由等几何高度 $z$ 面上的气压梯度定义的，而不是等 $\\sigma$ 面。真实的水平 PGF 加速度为 $-\\frac{1}{\\rho} (\\frac{\\partial p}{\\partial x})_z$。对于给定的静止状态，$(\\frac{\\partial p}{\\partial x})_z = 0$。误差的产生是因为有限差分是沿着倾斜的 $\\sigma$ 面计算的。我们可以使用链式法则将沿 $\\sigma$ 的导数与 $(x,z)$ 坐标系中的导数联系起来：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{\\sigma} = \\left(\\frac{\\partial p}{\\partial x}\\right)_{z} + \\left(\\frac{\\partial p}{\\partial z}\\right)_{x} \\left(\\frac{\\partial z}{\\partial x}\\right)_{\\sigma}\n$$\n根据问题陈述，我们有以下关系：\n1.  大气处于静止状态，因此等高面上的水平气压梯度为零：$\\left(\\frac{\\partial p}{\\partial x}\\right)_{z} = 0$。\n2.  静力平衡：$\\frac{\\partial p}{\\partial z} = -\\rho g$。\n3.  坐标变换 $z(x,\\sigma) = z_s(x) + \\sigma H_{\\mathrm{top}}$（其中 $z_s(x)=\\epsilon x$）给出了 $\\sigma$ 面的坡度：$\\left(\\frac{\\partial z}{\\partial x}\\right)_{\\sigma} = \\frac{\\mathrm{d}z_s}{\\mathrm{d}x} = \\epsilon$。\n\n将这些代入链式法则表达式中得到：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{\\sigma} = 0 + (-\\rho g)(\\epsilon) = -\\rho g \\epsilon\n$$\n因此，离散化的加速度 $a_x$ 近似为：\n$$\na_x \\approx -\\frac{1}{\\rho} \\left( -\\rho g \\epsilon \\right) = g\\epsilon\n$$\n这揭示了主阶虚假加速度就是 $g\\epsilon$。\n\n为了按要求进行更严谨的推导并找到次阶项，我们使用泰勒展开。精确压力由 $p(x,\\sigma) = p_0 \\exp\\left(-\\frac{z(x,\\sigma)}{H}\\right)$ 给出。当 $z(x,\\sigma) = \\epsilon x + \\sigma H_{\\mathrm{top}}$ 时，这变为：\n$$\np(x,\\sigma) = p_0 \\exp\\left(-\\frac{\\epsilon x + \\sigma H_{\\mathrm{top}}}{H}\\right) = p_0 \\exp\\left(-\\frac{\\sigma H_{\\mathrm{top}}}{H}\\right) \\exp\\left(-\\frac{\\epsilon x}{H}\\right)\n$$\n让我们在固定层 $\\sigma_j$ 上计算点 $x_{i+1} = x_i + \\Delta x$ 和 $x_{i-1} = x_i - \\Delta x$ 处的压力：\n$$\np(x_i \\pm \\Delta x, \\sigma_j) = p(x_i, \\sigma_j) \\exp\\left(\\mp \\frac{\\epsilon \\Delta x}{H}\\right)\n$$\n现在我们对小的 $u = \\mp \\frac{\\epsilon \\Delta x}{H}$ 展开指数项 $\\exp(u)$，假设坡度 $\\epsilon$ 很小：\n$$\n\\exp(u) = 1 + u + \\frac{u^2}{2!} + \\frac{u^3}{3!} + \\dots\n$$\n这给出：\n$$\np(x_{i+1}, \\sigma_j) = p(x_i, \\sigma_j) \\left( 1 - \\frac{\\epsilon \\Delta x}{H} + \\frac{1}{2}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^2 - \\frac{1}{6}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^3 + \\mathcal{O}\\left((\\Delta x)^4\\right) \\right)\n$$\n$$\np(x_{i-1}, \\sigma_j) = p(x_i, \\sigma_j) \\left( 1 + \\frac{\\epsilon \\Delta x}{H} + \\frac{1}{2}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^2 + \\frac{1}{6}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^3 + \\mathcal{O}\\left((\\Delta x)^4\\right) \\right)\n$$\n压力差为：\n$$\np(x_{i+1}, \\sigma_j) - p(x_{i-1}, \\sigma_j) = p(x_i, \\sigma_j) \\left( -2\\frac{\\epsilon \\Delta x}{H} - \\frac{1}{3}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^3 + \\dots \\right)\n$$\n将此代回 $a_x(x_i, \\sigma_j)$ 的公式中：\n$$\na_x = -\\frac{R T_0}{p(x_i, \\sigma_j)} \\frac{p(x_i, \\sigma_j) \\left( -2\\frac{\\epsilon \\Delta x}{H} - \\frac{1}{3}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^3 + \\dots \\right)}{2\\Delta x}\n$$\n$p(x_i, \\sigma_j)$ 项被消掉了。\n$$\na_x = \\frac{R T_0}{2\\Delta x} \\left( 2\\frac{\\epsilon \\Delta x}{H} + \\frac{1}{3}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^3 + \\dots \\right) = \\frac{R T_0 \\epsilon}{H} \\left( 1 + \\frac{1}{6}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^2 + \\dots \\right)\n$$\n回顾标高的定义 $H = \\frac{R T_0}{g}$，我们得到虚假加速度的最终表达式：\n$$\na_x = g\\epsilon \\left( 1 + \\frac{1}{6}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^2 + \\dots \\right)\n$$\n虚假加速度的主阶表达式为 $a_x \\approx g\\epsilon$。该项与网格间距 $\\Delta x$ 无关。\n\n主阶项 $g\\epsilon$ 与 $\\sigma_j$（以及 $x_i$）无关，因为局部压力 $p(x_i, \\sigma_j)$ 同时作为乘法因子出现在分子（压力差）和分母（密度 $\\rho(x_i, \\sigma_j) = p(x_i, \\sigma_j) / (R T_0)$）中。这个因子完全抵消，留下的表达式仅依赖于基本常数（$g$）和地形坡度（$\\epsilon$）。\n\n展开式中的次阶项是 $g\\epsilon \\cdot \\frac{1}{6}\\left(\\frac{\\epsilon \\Delta x}{H}\\right)^2 = \\frac{g}{6H^2}\\epsilon^3 \\Delta x^2$。这是针对此特定压力场的有限差分格式的主截断误差项。此次阶项的标度关系为 $\\mathcal{O}(\\epsilon^3 \\Delta x^2)$。它同时依赖于坡度 $\\epsilon$ 和网格间距 $\\Delta x$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the spurious horizontal acceleration for a set of test cases\n    using a non-consistent discretization of the Pressure Gradient Force on\n    a terrain-following coordinate system.\n    \"\"\"\n    # Physical and numerical parameters\n    g = 9.81  # m/s^2\n    R = 287.0  # J/(kg.K)\n    T0 = 300.0  # K\n    p0 = 100000.0  # Pa\n    H_top = 9000.0  # m\n    L = 10000.0  # m\n    \n    # Vertical coordinate for evaluation\n    sigma = 0.5\n    \n    # Derived physical constant: scale height\n    H = (R * T0) / g\n\n    # Test cases: (epsilon, delta_x)\n    test_cases = [\n        (0.01, 1000.0),   # Test 1 (happy path)\n        (0.01, 250.0),    # Test 2 (refined grid)\n        (0.001, 1000.0),  # Test 3 (small slope)\n        (0.1, 1000.0),    # Test 4 (larger slope)\n        (0.0, 1000.0)     # Test 5 (boundary case, zero slope)\n    ]\n\n    results = []\n    \n    # Helper functions for clarity\n    def get_z(x, sigma_val, epsilon, h_top_val):\n        \"\"\"Calculates physical height z.\"\"\"\n        z_s = epsilon * x\n        return z_s + sigma_val * h_top_val\n\n    def get_p(x, sigma_val, epsilon, h_top_val, p0_val, h_val):\n        \"\"\"Calculates hydrostatic pressure p.\"\"\"\n        z = get_z(x, sigma_val, epsilon, h_top_val)\n        return p0_val * np.exp(-z / h_val)\n\n    for epsilon, delta_x in test_cases:\n        # Set up the horizontal grid\n        # Nx: Number of grid points\n        # i_mid: Index for the central grid point\n        Nx = int(L / delta_x) + 1\n        i_mid = Nx // 2\n        \n        # Coordinates of the central point and its neighbors\n        x_mid = i_mid * delta_x\n        x_prev = (i_mid - 1) * delta_x\n        x_next = (i_mid + 1) * delta_x\n        \n        # Calculate pressure at the three required grid points on the constant sigma level\n        p_mid = get_p(x_mid, sigma, epsilon, H_top, p0, H)\n        p_prev = get_p(x_prev, sigma, epsilon, H_top, p0, H)\n        p_next = get_p(x_next, sigma, epsilon, H_top, p0, H)\n        \n        # Calculate density at the central point using the Ideal Gas Law\n        rho_mid = p_mid / (R * T0)\n        \n        # Calculate the spurious horizontal acceleration using the finite-difference formula\n        # a_x = -(1/rho) * (p(i+1) - p(i-1)) / (2*dx)\n        if rho_mid == 0:\n            # Avoid division by zero, though unlikely with these parameters\n            a_x = 0.0\n        else:\n            a_x = - (1.0 / rho_mid) * (p_next - p_prev) / (2.0 * delta_x)\n            \n        # Round the result to six decimal places and append to the list\n        results.append(round(a_x, 6))\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}