{
    "hands_on_practices": [
        {
            "introduction": "This practice explores the fundamental reason for using staggered grids in numerical models. By comparing the behavior of gravity waves on a collocated Arakawa A-grid and a staggered Arakawa C-grid , you will uncover why the former can lead to unphysical, stationary noise known as \"checkerboarding.\" This analysis is crucial for understanding how grid choice impacts the fidelity of a simulation, especially for the shortest resolvable waves.",
            "id": "4052177",
            "problem": "Consider the one-dimensional linearized shallow-water equations, which serve as a foundational model in numerical weather prediction and climate modeling for analyzing wave propagation and numerical stability,\n$$\n\\frac{\\partial u}{\\partial t} \\;=\\; -\\,g\\,\\frac{\\partial \\eta}{\\partial x}\n\\quad\\text{and}\\quad\n\\frac{\\partial \\eta}{\\partial t} \\;=\\; -\\,H\\,\\frac{\\partial u}{\\partial x},\n$$\nwhere $u$ is the horizontal velocity, $\\eta$ is the free-surface height (or pressure proxy), $g$ is gravitational acceleration, and $H$ is mean fluid depth. Let $c \\equiv \\sqrt{gH}$ denote the continuum phase speed of shallow-water gravity waves derived from these equations under plane-wave solutions.\n\nDefine a uniform grid of spacing $\\Delta x$ and consider two horizontal grid staggering choices:\n- The Arakawa A-grid, where $u$ and $\\eta$ are collocated at positions $x_i = i\\,\\Delta x$.\n- The Arakawa C-grid, where $\\eta$ is defined at $x_i = i\\,\\Delta x$ and $u$ is defined at staggered locations $x_{i+\\frac{1}{2}} = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$.\n\nOn each grid, approximate spatial derivatives using second-order finite differences consistent with the grid staggering:\n- On the A-grid, approximate $\\partial \\eta/\\partial x$ and $\\partial u/\\partial x$ at $x_i$ by centered differences $[\\eta_{i+1} - \\eta_{i-1}]/(2\\Delta x)$ and $[u_{i+1} - u_{i-1}]/(2\\Delta x)$.\n- On the C-grid, approximate $\\partial \\eta/\\partial x$ at $x_{i+\\frac{1}{2}}$ by the stagger-consistent difference $[\\eta_{i+1} - \\eta_i]/\\Delta x$, and approximate $\\partial u/\\partial x$ at $x_i$ by $[u_{i+\\frac{1}{2}} - u_{i-\\frac{1}{2}}]/\\Delta x$.\n\nAssume temporally continuous solutions of plane-wave form,\n$$\n\\eta_i(t) \\;=\\; \\hat{\\eta}\\,\\exp\\!\\bigl(i\\,k\\,x_i - i\\,\\omega\\,t\\bigr),\n\\qquad\nu_i(t) \\;=\\; \\hat{u}\\,\\exp\\!\\bigl(i\\,k\\,x_i - i\\,\\omega\\,t\\bigr)\n\\quad\\text{(A-grid)},\n$$\nand\n$$\n\\eta_i(t) \\;=\\; \\hat{\\eta}\\,\\exp\\!\\bigl(i\\,k\\,x_i - i\\,\\omega\\,t\\bigr),\n\\qquad\nu_{i+\\frac{1}{2}}(t) \\;=\\; \\hat{u}\\,\\exp\\!\\bigl(i\\,k\\,x_{i+\\frac{1}{2}} - i\\,\\omega\\,t\\bigr)\n\\quad\\text{(C-grid)}.\n$$\n\nStarting only from these governing equations, grid definitions, and finite-difference operators, derive the semi-discrete dispersion relation on each grid and analyze the behavior at the shortest resolvable horizontal wavelength (the Nyquist mode) characterized by $k\\,\\Delta x = \\pi$. Explain from first principles how grid staggering influences the coupling between $u$ and $\\eta$ and the emergence of spurious computational modes and checkerboarding.\n\nFinally, compute the nondimensional phase-speed ratio on the Arakawa C-grid at the Nyquist wavenumber,\n$$\n\\frac{\\omega}{c\\,|k|},\n$$\nexpressed as an exact analytic expression in terms of $\\pi$. No rounding is required, and no physical units should be included in the final answer. The final answer must be a single real-valued expression.",
            "solution": "We begin by deriving the semi-discrete dispersion relation for each grid configuration.\n\n**Arakawa A-grid Analysis**\nThe semi-discretized equations on the A-grid are:\n$$\n\\frac{d u_i}{dt} = -g \\frac{\\eta_{i+1} - \\eta_{i-1}}{2\\Delta x}\n$$\n$$\n\\frac{d \\eta_i}{dt} = -H \\frac{u_{i+1} - u_{i-1}}{2\\Delta x}\n$$\nWe substitute the plane-wave solutions $u_i(t) = \\hat{u}\\,\\exp(i\\,k\\,x_i - i\\,\\omega\\,t)$ and $\\eta_i(t) = \\hat{\\eta}\\,\\exp(i\\,k\\,x_i - i\\,\\omega\\,t)$. The time derivative becomes multiplication by $-i\\,\\omega$. For the spatial differences, we use the relations $\\eta_{i\\pm1} = \\eta_i \\exp(\\pm i\\,k\\,\\Delta x)$ and similarly for $u$.\nSubstituting these into the equations yields:\n$$\n-i\\,\\omega\\,\\hat{u} = -g\\,\\hat{\\eta} \\frac{\\exp(i\\,k\\,\\Delta x) - \\exp(-i\\,k\\,\\Delta x)}{2\\Delta x}\n$$\n$$\n-i\\,\\omega\\,\\hat{\\eta} = -H\\,\\hat{u} \\frac{\\exp(i\\,k\\,\\Delta x) - \\exp(-i\\,k\\,\\Delta x)}{2\\Delta x}\n$$\nUsing the identity $\\sin(\\theta) = \\frac{\\exp(i\\theta) - \\exp(-i\\theta)}{2i}$, the system becomes:\n$$\n\\omega\\,\\hat{u} = g \\frac{\\sin(k\\,\\Delta x)}{\\Delta x} \\hat{\\eta}\n$$\n$$\n\\omega\\,\\hat{\\eta} = H \\frac{\\sin(k\\,\\Delta x)}{\\Delta x} \\hat{u}\n$$\nFor a non-trivial solution, we combine these equations to find the dispersion relation for the A-grid:\n$$\n\\omega^2 = g\\,H \\left( \\frac{\\sin(k\\,\\Delta x)}{\\Delta x} \\right)^2\n$$\nRecalling $c^2 = gH$, the discrete frequency is $\\omega = \\pm c \\frac{|\\sin(k\\,\\Delta x)|}{\\Delta x}$.\nAt the Nyquist mode, $k\\,\\Delta x = \\pi$. Here, $\\sin(k\\,\\Delta x) = \\sin(\\pi) = 0$. This implies $\\omega = 0$. The shortest resolvable waves on the A-grid are stationary. The numerical group velocity, $c_g = d\\omega/dk = \\pm c \\cos(k\\Delta x)$, becomes $c_g = \\pm c \\cos(\\pi) = \\mp c$. A wave with zero frequency and non-zero group velocity is unphysical. This indicates a spurious computational mode.\nThe reason is that a wave with $k\\Delta x = \\pi$ has values proportional to $(-1)^i$ at grid points $x_i$. The centered difference operator is blind to this $2\\Delta x$ \"checkerboard\" pattern: $\\frac{\\eta_{i+1}-\\eta_{i-1}}{2\\Delta x} \\propto \\frac{(-1)^{i+1}-(-1)^{i-1}}{2\\Delta x} = \\frac{-(-1)^i - (-(-1)^i)}{2\\Delta x} = 0$. Therefore, the pressure gradient force on the velocity field is zero, and the velocity divergence acting on the height field is also zero. The $u$ and $\\eta$ fields are completely decoupled, allowing for stationary, grid-scale noise to exist as a solution.\n\n**Arakawa C-grid Analysis**\nThe semi-discretized equations on the C-grid are:\n$$\n\\frac{d u_{i+\\frac{1}{2}}}{dt} = -g \\frac{\\eta_{i+1} - \\eta_i}{\\Delta x}\n$$\n$$\n\\frac{d \\eta_i}{dt} = -H \\frac{u_{i+\\frac{1}{2}} - u_{i-\\frac{1}{2}}}{\\Delta x}\n$$\nWe substitute the corresponding plane-wave solutions. The first equation becomes:\n$$\n-i\\,\\omega\\,\\hat{u}\\,\\exp(i\\,k\\,x_{i+\\frac{1}{2}}) = -g \\frac{\\hat{\\eta}\\,\\exp(i\\,k\\,x_{i+1}) - \\hat{\\eta}\\,\\exp(i\\,k\\,x_{i})}{\\Delta x}\n$$\n$$\n\\implies -i\\,\\omega\\,\\hat{u}\\,\\exp(i\\,k\\,\\Delta x/2) = -g \\frac{\\hat{\\eta}\\,(\\exp(i\\,k\\,\\Delta x) - 1)}{\\Delta x}\n$$\nThe second equation becomes:\n$$\n-i\\,\\omega\\,\\hat{\\eta}\\,\\exp(i\\,k\\,x_i) = -H \\frac{\\hat{u}\\,\\exp(i\\,k\\,x_{i+\\frac{1}{2}}) - \\hat{u}\\,\\exp(i\\,k\\,x_{i-\\frac{1}{2}})}{\\Delta x}\n$$\n$$\n\\implies -i\\,\\omega\\,\\hat{\\eta} = -H \\frac{\\hat{u}\\,(\\exp(i\\,k\\,\\Delta x/2) - \\exp(-i\\,k\\,\\Delta x/2))}{\\Delta x}\n$$\nUsing the identities $\\exp(i\\theta) - 1 = \\exp(i\\theta/2) \\cdot 2i\\sin(\\theta/2)$ and $\\exp(i\\theta/2) - \\exp(-i\\theta/2) = 2i\\sin(\\theta/2)$, the system of equations for the amplitudes $(\\hat{u}, \\hat{\\eta})$ simplifies to:\n$$\n\\omega\\,\\hat{u} = g \\frac{2\\sin(k\\,\\Delta x/2)}{\\Delta x} \\hat{\\eta}\n$$\n$$\n\\omega\\,\\hat{\\eta} = H \\frac{2\\sin(k\\,\\Delta x/2)}{\\Delta x} \\hat{u}\n$$\nCombining these equations gives the dispersion relation for the C-grid:\n$$\n\\omega^2 = g\\,H \\left( \\frac{2\\sin(k\\,\\Delta x/2)}{\\Delta x} \\right)^2\n$$\nThe discrete frequency is $\\omega = \\pm c \\frac{|2\\sin(k\\,\\Delta x/2)|}{\\Delta x}$.\nAt the Nyquist mode, $k\\,\\Delta x = \\pi$, so $k\\,\\Delta x/2 = \\pi/2$. The frequency becomes $\\omega = \\pm c \\frac{2|\\sin(\\pi/2)|}{\\Delta x} = \\pm \\frac{2c}{\\Delta x}$. This is the maximum frequency supported by the grid. The numerical group velocity is $c_g = d\\omega/dk = \\pm c \\cos(k\\Delta x/2)$. At $k\\Delta x=\\pi$, $c_g = \\pm c \\cos(\\pi/2) = 0$. The C-grid correctly represents the shortest wave as a stationary wave packet (standing wave) with maximum frequency, which is physically correct.\nThe staggered arrangement ensures that a checkerboard pattern in $\\eta$ (e.g., $\\eta_i \\sim (-1)^i$) results in a maximum possible pressure gradient $(\\eta_{i+1} - \\eta_i)/\\Delta x \\sim ((-1)^{i+1} - (-1)^i)/\\Delta x = -2(-1)^i/\\Delta x \\neq 0$. This maintains a strong coupling between the mass and momentum fields at all wavenumbers, suppressing the spurious computational mode seen on the A-grid.\n\n**Final Calculation**\nWe are asked to compute the nondimensional phase-speed ratio $\\frac{\\omega}{c\\,|k|}$ on the C-grid at the Nyquist wavenumber.\nThe numerical phase speed is $c_p = \\frac{\\omega}{|k|}$. The ratio is $\\frac{c_p}{c} = \\frac{\\omega}{c\\,|k|}$.\nFrom the C-grid dispersion relation, taking the positive root for $\\omega$:\n$$\n\\omega = c \\frac{2\\sin(k\\,\\Delta x/2)}{\\Delta x} \\quad (\\text{for } 0 \\le k\\Delta x \\le \\pi)\n$$\nSo the ratio is:\n$$\n\\frac{\\omega}{c\\,|k|} = \\frac{1}{|k|} \\frac{2\\sin(k\\,\\Delta x/2)}{\\Delta x} = \\frac{2\\sin(k\\,\\Delta x/2)}{|k|\\Delta x}\n$$\nAt the Nyquist wavenumber, we are given $k\\,\\Delta x = \\pi$. Assuming $k>0$, this means $|k|\\Delta x = \\pi$.\nSubstituting this into the expression for the ratio gives:\n$$\n\\frac{\\omega}{c\\,|k|} = \\frac{2\\sin(\\pi/2)}{\\pi} = \\frac{2(1)}{\\pi} = \\frac{2}{\\pi}\n$$\nThis is the required exact analytic expression.",
            "answer": "$$\n\\boxed{\\frac{2}{\\pi}}\n$$"
        },
        {
            "introduction": "Having established the benefits of staggering, we now tackle a common operational challenge: computing terms that involve variables from different locations. This exercise focuses on the discretization of the Coriolis force on an Arakawa C-grid, a key component in geophysical fluid dynamics . You will derive how the necessary interpolation of velocity components affects the frequency of inertial oscillations, providing insight into how numerical schemes can modify physical wave properties.",
            "id": "4052171",
            "problem": "Consider the linearized momentum equations of the rotating shallow-water system on a plane with constant Coriolis parameter (an $f$-plane) and uniform layer depth, restricted to the horizontal Coriolis acceleration only. The continuous equations for the horizontal velocity components are\n$$\n\\frac{\\partial u}{\\partial t} - f v = 0, \\qquad \\frac{\\partial v}{\\partial t} + f u = 0,\n$$\nwhere $u$ and $v$ are the zonal and meridional velocity components, respectively, and $f$ is the constant Coriolis parameter. Assume the free surface is spatially uniform and time-invariant so that there is no pressure-gradient force.\n\nDiscretize the horizontal plane using an Arakawa C-grid: place $u$ at points $(x_{i+\\frac{1}{2}}, y_{j}) = \\big((i+\\frac{1}{2})\\Delta x,\\, j \\Delta y\\big)$ and $v$ at points $(x_{i}, y_{j+\\frac{1}{2}}) = \\big(i \\Delta x,\\, (j+\\frac{1}{2})\\Delta y\\big)$, with uniform spacings $\\Delta x$ and $\\Delta y$. To evaluate the Coriolis terms at the appropriate staggered locations, use bilinear interpolation of the neighboring values:\n- At $u$-points $(i+\\frac{1}{2}, j)$, approximate $v$ by the average of the four nearest $v$-points,\n$$\nv\\big|_{i+\\frac{1}{2},\\, j} \\equiv \\frac{1}{4}\\left( v_{i,\\, j+\\frac{1}{2}} + v_{i,\\, j-\\frac{1}{2}} + v_{i+1,\\, j+\\frac{1}{2}} + v_{i+1,\\, j-\\frac{1}{2}} \\right).\n$$\n- At $v$-points $(i, j+\\frac{1}{2})$, approximate $u$ by the average of the four nearest $u$-points,\n$$\nu\\big|_{i,\\, j+\\frac{1}{2}} \\equiv \\frac{1}{4}\\left( u_{i+\\frac{1}{2},\\, j} + u_{i-\\frac{1}{2},\\, j} + u_{i+\\frac{1}{2},\\, j+1} + u_{i-\\frac{1}{2},\\, j+1} \\right).\n$$\n\nAssume spatially periodic boundary conditions and consider a single horizontal plane-wave mode with wavenumbers $k_{x}$ and $k_{y}$,\n$$\nu_{i+\\frac{1}{2},\\, j}(t) = U \\exp\\!\\left(-\\mathrm{i}\\,\\omega t\\right)\\exp\\!\\left(\\mathrm{i}\\,k_{x} x_{i+\\frac{1}{2}} + \\mathrm{i}\\,k_{y} y_{j}\\right), \\qquad\nv_{i,\\, j+\\frac{1}{2}}(t) = V \\exp\\!\\left(-\\mathrm{i}\\,\\omega t\\right)\\exp\\!\\left(\\mathrm{i}\\,k_{x} x_{i} + \\mathrm{i}\\,k_{y} y_{j+\\frac{1}{2}}\\right),\n$$\nwith complex amplitudes $U$ and $V$ and unknown angular frequency $\\omega$.\n\nUsing only the information above and first principles of Fourier-mode analysis and linear interpolation on staggered grids, derive the exact analytic expression for the discrete inertial-oscillation angular frequency $\\omega$ as a function of $f$, $k_{x}$, $k_{y}$, $\\Delta x$, and $\\Delta y$. Express your final answer as a single closed-form analytic expression. No numerical approximation is required; do not round. No units are required in the final expression, but interpret $\\omega$ physically as an angular frequency in radians per second.",
            "solution": "The problem is to find the angular frequency $\\omega$ in the discrete representation of inertial oscillations on an Arakawa C-grid. The continuous governing equations are:\n$$\n\\frac{\\partial u}{\\partial t} - f v = 0\n$$\n$$\n\\frac{\\partial v}{\\partial t} + f u = 0\n$$\nWe discretize these equations on the staggered grid. The $u$-component equation is evaluated at the $u$-points $(x_{i+\\frac{1}{2}}, y_j)$ and the $v$-component equation is evaluated at the $v$-points $(x_i, y_{j+\\frac{1}{2}})$. This yields a system of ordinary differential equations for the grid-point values:\n$$\n\\frac{d u_{i+\\frac{1}{2}, j}}{dt} - f v\\big|_{i+\\frac{1}{2}, j} = 0\n$$\n$$\n\\frac{d v_{i, j+\\frac{1}{2}}}{dt} + f u\\big|_{i, j+\\frac{1}{2}} = 0\n$$\nThe terms $v\\big|_{i+\\frac{1}{2}, j}$ and $u\\big|_{i, j+\\frac{1}{2}}$ represent the velocity components evaluated at locations where they are not natively defined, requiring the specified bilinear interpolation.\n\nWe assume solutions in the form of a single plane-wave mode:\n$$\nu_{i+\\frac{1}{2},\\, j}(t) = U \\exp\\!\\left(-\\mathrm{i}\\,\\omega t\\right)\\exp\\!\\left(\\mathrm{i}\\,k_{x} x_{i+\\frac{1}{2}} + \\mathrm{i}\\,k_{y} y_{j}\\right)\n$$\n$$\nv_{i,\\, j+\\frac{1}{2}}(t) = V \\exp\\!\\left(-\\mathrm{i}\\,\\omega t\\right)\\exp\\!\\left(\\mathrm{i}\\,k_{x} x_{i} + \\mathrm{i}\\,k_{y} y_{j+\\frac{1}{2}}\\right)\n$$\nThe time derivatives are straightforward:\n$$\n\\frac{d u_{i+\\frac{1}{2}, j}}{dt} = -\\mathrm{i}\\,\\omega\\, u_{i+\\frac{1}{2}, j}\n$$\n$$\n\\frac{d v_{i, j+\\frac{1}{2}}}{dt} = -\\mathrm{i}\\,\\omega\\, v_{i, j+\\frac{1}{2}}\n$$\nSubstituting these into the semi-discretized equations gives:\n$$\n-\\mathrm{i}\\,\\omega\\, u_{i+\\frac{1}{2}, j} - f v\\big|_{i+\\frac{1}{2}, j} = 0\n$$\n$$\n-\\mathrm{i}\\,\\omega\\, v_{i, j+\\frac{1}{2}} + f u\\big|_{i, j+\\frac{1}{2}} = 0\n$$\nNext, we evaluate the interpolated terms. The Coriolis term in the $u$-equation requires $v$ at the $u$-point $(i+\\frac{1}{2}, j)$. Using the provided bilinear interpolation:\n$$\nv\\big|_{i+\\frac{1}{2},\\, j} = \\frac{1}{4}\\left( v_{i,\\, j+\\frac{1}{2}} + v_{i,\\, j-\\frac{1}{2}} + v_{i+1,\\, j+\\frac{1}{2}} + v_{i+1,\\, j-\\frac{1}{2}} \\right)\n$$\nLet's substitute the plane-wave form of $v_{i', j'+\\frac{1}{2}} = V e^{-\\mathrm{i}\\omega t} e^{\\mathrm{i}k_x x_{i'}} e^{\\mathrm{i}k_y y_{j'+\\frac{1}{2}}}$ into this expression. The spatial part of the sum is:\n$$\n\\left( e^{\\mathrm{i}k_x x_i} + e^{\\mathrm{i}k_x x_{i+1}} \\right) \\left( e^{\\mathrm{i}k_y y_{j+\\frac{1}{2}}} + e^{\\mathrm{i}k_y y_{j-\\frac{1}{2}}} \\right)\n$$\nFactoring out the central point phase factors and using the identity $e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta} = 2\\cos(\\theta)$ gives:\n$$\n\\left( e^{\\mathrm{i}k_x (i+\\frac{1}{2})\\Delta x} \\cdot 2\\cos\\left(\\frac{k_x\\Delta x}{2}\\right) \\right) \\left( e^{\\mathrm{i}k_y j\\Delta y} \\cdot 2\\cos\\left(\\frac{k_y\\Delta y}{2}\\right) \\right)\n$$\n$$\n= 4 e^{\\mathrm{i}(k_x x_{i+\\frac{1}{2}} + k_y y_j)} \\cos\\left(\\frac{k_x\\Delta x}{2}\\right) \\cos\\left(\\frac{k_y\\Delta y}{2}\\right)\n$$\nThus, the interpolated value is:\n$$\nv\\big|_{i+\\frac{1}{2},\\, j} = V e^{-\\mathrm{i}\\omega t} e^{\\mathrm{i}(k_x x_{i+\\frac{1}{2}} + k_y y_j)} \\cos\\left(\\frac{k_x\\Delta x}{2}\\right) \\cos\\left(\\frac{k_y\\Delta y}{2}\\right) = \\frac{V}{U} \\cos\\left(\\frac{k_x\\Delta x}{2}\\right) \\cos\\left(\\frac{k_y\\Delta y}{2}\\right) u_{i+\\frac{1}{2}, j}\n$$\nBy symmetry, the calculation for $u\\big|_{i, j+\\frac{1}{2}}$ is analogous:\n$$\nu\\big|_{i,\\, j+\\frac{1}{2}} = \\frac{U}{V} \\cos\\left(\\frac{k_x\\Delta x}{2}\\right) \\cos\\left(\\frac{k_y\\Delta y}{2}\\right) v_{i, j+\\frac{1}{2}}\n$$\nLet's define the factor $\\alpha = \\cos\\left(\\frac{k_x\\Delta x}{2}\\right) \\cos\\left(\\frac{k_y\\Delta y}{2}\\right)$. The equations for the wave amplitudes ($U, V$) become:\n$$\n-\\mathrm{i}\\,\\omega\\, U - f \\alpha V = 0\n$$\n$$\nf \\alpha U -\\mathrm{i}\\,\\omega\\, V = 0\n$$\nThis is a homogeneous linear system for the amplitudes $(U, V)$:\n$$\n\\begin{pmatrix}\n-\\mathrm{i}\\,\\omega & -f\\alpha \\\\\nf\\alpha & -\\mathrm{i}\\,\\omega\n\\end{pmatrix}\n\\begin{pmatrix}\nU \\\\\nV\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0\n\\end{pmatrix}\n$$\nFor a non-trivial solution to exist, the determinant of the coefficient matrix must be zero.\n$$\n\\det \\begin{pmatrix}\n-\\mathrm{i}\\,\\omega & -f\\alpha \\\\\nf\\alpha & -\\mathrm{i}\\,\\omega\n\\end{pmatrix} = (-\\mathrm{i}\\,\\omega)(-\\mathrm{i}\\,\\omega) - (-f\\alpha)(f\\alpha) = 0\n$$\n$$\n-\\omega^2 + f^2\\alpha^2 = 0\n$$\n$$\n\\omega^2 = f^2\\alpha^2\n$$\nTaking the positive root for the angular frequency gives $\\omega = f |\\alpha|$. Since the wavenumbers are limited by the grid resolution ($|k_x\\Delta x| \\le \\pi$, $|k_y\\Delta y| \\le \\pi$), the arguments of the cosines are in $[-\\pi/2, \\pi/2]$, ensuring $\\alpha \\ge 0$. Therefore, the discrete angular frequency is:\n$$\n\\omega = f \\alpha = f \\cos\\left(\\frac{k_x\\Delta x}{2}\\right) \\cos\\left(\\frac{k_y\\Delta y}{2}\\right)\n$$\nThis expression represents the frequency of the numerically modeled inertial oscillations as a function of the Coriolis parameter $f$, the wavenumbers $k_x$ and $k_y$, and the grid spacings $\\Delta x$ and $\\Delta y$.",
            "answer": "$$\n\\boxed{f \\cos\\left(\\frac{k_x \\Delta x}{2}\\right) \\cos\\left(\\frac{k_y \\Delta y}{2}\\right)}\n$$"
        },
        {
            "introduction": "This final practice bridges the gap between theoretical analysis and computational practice by implementing a projection method for incompressible flow. You will write code to enforce the divergence-free constraint $\\nabla \\cdot \\mathbf{u} = 0$ on both A- and C-grids, using a Fast Fourier Transform (FFT) based Poisson solver . This exercise highlights the practical differences in defining discrete operators like divergence and gradient on different grids and demonstrates the superior numerical properties of the C-grid in a core fluid dynamics algorithm.",
            "id": "3862986",
            "problem": "Consider the incompressible momentum equations under the Boussinesq approximation with constant density, where the velocity field is constrained by the divergence-free condition. The core constraint is that the velocity field $\\mathbf{u} = (u, v)$ must satisfy $\\nabla \\cdot \\mathbf{u} = 0$. In projection methods for incompressible flow, one computes an intermediate velocity $\\mathbf{u}^{\\ast}$ that does not necessarily satisfy the divergence-free constraint, and then projects it onto the space of divergence-free fields using a scalar pressure field $p$ such that the corrected velocity $\\mathbf{u}^{n+1}$ is divergence-free. The projection step enforces $\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\Delta t \\nabla p$ together with $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$, implying the discrete Poisson equation for the pressure,\n$$\n\\nabla^2 p = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast},\n$$\nwith periodic boundary conditions. In Arakawa grid staggering, there are two canonical layouts: the Arakawa A-grid (all prognostic variables at cell centers) and the Arakawa C-grid (pressure at cell centers, the $u$-velocity at vertical cell faces, and the $v$-velocity at horizontal cell faces). For a uniform, two-dimensional, periodic rectangular domain with $N_x \\times N_y$ cells, spacings $\\Delta x$ and $\\Delta y$, and time step $\\Delta t$, implement the projection method on both the Arakawa A-grid and the Arakawa C-grid using discrete operators that respect the layout of each grid:\n- On the Arakawa C-grid, define the discrete divergence at cell centers as differences of face-normal fluxes, and define the discrete gradient as face-normal differences of cell-centered pressure consistent with the divergence operator.\n- On the Arakawa A-grid, define the discrete divergence and gradient at cell centers using second-order central differences consistent with periodic boundary conditions.\n\nUse a periodic discrete Poisson solver to obtain the pressure $p$ at cell centers. The solver must handle the discrete Poisson equation under periodic boundary conditions, including the null space associated with constant modes. Your program must compute, for each test case, the ratio\n$$\nR = \\frac{\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_2}{\\|\\nabla \\cdot \\mathbf{u}^{\\ast}\\|_2},\n$$\nwhere $\\|\\cdot\\|_2$ denotes the discrete $\\ell^2$ norm over the set of cell centers. If the denominator is zero, define $R = 0$.\n\nConstruct the intermediate velocities $\\mathbf{u}^{\\ast}$ deterministically and in a way that respects periodicity based on the grid type. For each test, use the following manufactured fields:\n- Arakawa C-grid: $u^{\\ast}$ defined on vertical faces indexed by $(i,j)$ with $i = 0, \\ldots, N_x$ and $j = 0, \\ldots, N_y-1$, and $v^{\\ast}$ defined on horizontal faces indexed by $(i,j)$ with $i = 0, \\ldots, N_x-1$ and $j = 0, \\ldots, N_y$, as\n$$\nu^{\\ast}_{i,j} = \\sin\\left( \\frac{2\\pi i}{N_x} \\right) + 0.3 \\cos\\left( \\frac{2\\pi j}{N_y} \\right), \\quad v^{\\ast}_{i,j} = 0.7 \\cos\\left( \\frac{2\\pi i}{N_x} \\right) - \\sin\\left( \\frac{2\\pi j}{N_y} \\right).\n$$\n- Arakawa A-grid: $u^{\\ast}$ and $v^{\\ast}$ defined at cell centers indexed by $(i,j)$ with $i = 0, \\ldots, N_x-1$ and $j = 0, \\ldots, N_y-1$, as\n$$\nu^{\\ast}_{i,j} = \\sin\\left( \\frac{2\\pi i}{N_x} \\right) + 0.3 \\cos\\left( \\frac{2\\pi j}{N_y} \\right), \\quad v^{\\ast}_{i,j} = 0.7 \\cos\\left( \\frac{2\\pi i}{N_x} \\right) - \\sin\\left( \\frac{2\\pi j}{N_y} \\right).\n$$\nThese definitions ensure periodicity. The discrete operators and the projection step must be formulated in a manner that they are adjoint-consistent on the chosen grid, so that $\\nabla^2$ is the divergence of the gradient.\n\nImplement a periodic discrete Poisson solver for cell-centered $p$ using the Fast Fourier Transform (FFT) approach. The solver must explicitly handle the zero wavenumber by choosing the pressure mean to be zero.\n\nTest Suite:\nProvide results for the following four parameter sets. Each test case is a tuple $(\\text{grid\\_type}, N_x, N_y, \\Delta x, \\Delta y, \\Delta t)$ where $\\text{grid\\_type} \\in \\{\\text{\"C\"}, \\text{\"A\"}\\}$:\n1. $(\\text{\"C\"}, 16, 12, 1.0, 2.0, 0.2)$\n2. $(\\text{\"A\"}, 16, 12, 1.0, 2.0, 0.15)$\n3. $(\\text{\"C\"}, 3, 3, 1.3, 0.9, 0.25)$\n4. $(\\text{\"A\"}, 8, 2, 0.8, 1.2, 0.05)$\n\nFinal Output Format:\nYour program should produce a single line of output containing the values of $R$ for the four test cases, as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3,r4]\"). No physical units are required; all quantities are dimensionless. All angles, where present in trigonometric functions, are in radians by construction of the discrete operators. The output values must be floating-point numbers.",
            "solution": "The problem requires the implementation of a projection method to enforce the incompressibility constraint on a velocity field in a two-dimensional, periodic domain. This is a fundamental technique in computational fluid dynamics for simulating incompressible flows. The method's efficacy is to be evaluated on two different grid staggering arrangements: the Arakawa A-grid (collocated) and the Arakawa C-grid (staggered). The performance metric is the ratio $R$ of the $\\ell^2$ norm of the velocity divergence after the projection to its norm before the projection.\n\nThe projection method is a fractional step algorithm. Given an intermediate velocity field $\\mathbf{u}^{\\ast}$, which is not necessarily divergence-free, the goal is to find a correction involving a scalar pressure field $p$ such that the final velocity field $\\mathbf{u}^{n+1}$ is divergence-free. This is achieved by projecting $\\mathbf{u}^{\\ast}$ onto the space of divergence-free vector fields. The projection is defined by two conditions:\n1. The velocity is updated via a pressure gradient:\n$$ \\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\Delta t \\nabla p $$\nwhere $\\Delta t$ is the time step.\n2. The final velocity field must be divergence-free:\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = 0 $$\nTaking the divergence of the first equation and substituting the second gives:\n$$ \\nabla \\cdot (\\mathbf{u}^{\\ast} - \\Delta t \\nabla p) = 0 $$\n$$ \\nabla \\cdot \\mathbf{u}^{\\ast} - \\Delta t \\nabla^2 p = 0 $$\nThis yields a Poisson equation for the pressure field $p$:\n$$ \\nabla^2 p = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\nThe solution of this equation provides the pressure required to project the velocity field onto the divergence-free subspace. The problem specifies periodic boundary conditions for a rectangular domain of size $N_x \\times N_y$ cells with grid spacings $\\Delta x$ and $\\Delta y$.\n\nThe discretization of the divergence ($\\nabla \\cdot$), gradient ($\\nabla$), and Laplacian ($\\nabla^2$) operators depends on the grid layout.\n\nOn the Arakawa A-grid, all variables ($u, v, p$) are collocated at the cell centers, indexed by $(i,j)$ for $i=0, \\dots, N_x-1$ and $j=0, \\dots, N_y-1$. We use second-order central finite differences for the operators:\nThe divergence of a velocity field $\\mathbf{u}=(u,v)$ at cell $(i,j)$ is:\n$$ (\\nabla \\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2 \\Delta x} + \\frac{v_{i,j+1} - v_{i,j-1}}{2 \\Delta y} $$\nThe gradient of a scalar pressure field $p$ at cell $(i,j)$ is:\n$$ (\\nabla p)_{x, i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad (\\nabla p)_{y, i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta y} $$\nAll indices are handled periodically (e.g., $u_{N_x, j} = u_{0, j}$, $u_{-1, j} = u_{N_x-1, j}$).\n\nOn the Arakawa C-grid, variables are staggered. Pressure $p$ is at cell centers $(i,j)$. The horizontal velocity component $u$ is on vertical cell faces, indexed here such that $u_{i,j}$ is at the face between cells $(i-1,j)$ and $(i,j)$. The vertical velocity component $v$ is on horizontal cell faces, where $v_{i,j}$ is at the face between cells $(i,j-1)$ and $(i,j)$.\nThe discrete divergence at cell center $(i,j)$ is defined as the net flux from the cell:\n$$ (\\nabla \\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1,j} - u_{i,j}}{\\Delta x} + \\frac{v_{i,j+1} - v_{i,j}}{\\Delta y} $$\nThe discrete gradient of the cell-centered pressure $p$ produces components on the cell faces, consistent with the velocity locations:\n$$ (\\nabla p)_{x, i,j} = \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x}, \\quad (\\nabla p)_{y, i,j} = \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y} $$\nAn important property of the C-grid staggering is that the discrete Laplacian, formed by composing the divergence and gradient operators ($\\nabla^2 = \\nabla \\cdot \\nabla$), results in the standard five-point stencil:\n$$ (\\nabla^2 p)_{i,j} = \\frac{p_{i+1,j} - 2 p_{i,j} + p_{i-1,j}}{(\\Delta x)^2} + \\frac{p_{i,j+1} - 2 p_{i,j} + p_{i,j-1}}{(\\Delta y)^2} $$\nThis adjoint consistency is a key advantage of the C-grid.\n\nFor both grids, the intermediate velocity field $\\mathbf{u}^{\\ast}$ is given by a manufactured solution.\nFor the A-grid, $u^{\\ast}$ and $v^{\\ast}$ are defined at cell centers $(i,j)$:\n$$ u^{\\ast}_{i,j} = \\sin\\left( \\frac{2\\pi i}{N_x} \\right) + 0.3 \\cos\\left( \\frac{2\\pi j}{N_y} \\right), \\quad v^{\\ast}_{i,j} = 0.7 \\cos\\left( \\frac{2\\pi i}{N_x} \\right) - \\sin\\left( \\frac{2\\pi j}{N_y} \\right) $$\nFor the C-grid, $u^{\\ast}$ is defined on vertical faces and $v^{\\ast}$ on horizontal faces, using the same functional forms.\n\nThe discrete Poisson equation, $\\hat{L}p = f$ where $\\hat{L}$ is the discrete Laplacian and $f = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast}$, is solved efficiently using the Fast Fourier Transform (FFT). Applying a 2D discrete Fourier transform to the equation converts the spatial convolution of the Laplacian into a simple multiplication in Fourier space:\n$$ \\tilde{L}_{m,n} \\tilde{p}_{m,n} = \\tilde{f}_{m,n} $$\nwhere $\\tilde{\\cdot}$ denotes the Fourier transform and $(m, n)$ are the integer wavenumber indices. The Fourier symbol $\\tilde{L}_{m,n}$ of the five-point Laplacian is:\n$$ \\tilde{L}_{m,n} = -\\frac{4}{(\\Delta x)^2} \\sin^2\\left(\\frac{\\pi m}{N_x}\\right) - \\frac{4}{(\\Delta y)^2} \\sin^2\\left(\\frac{\\pi n}{N_y}\\right) $$\nFor the zero-wavenumber mode $(m,n)=(0,0)$, $\\tilde{L}_{0,0} = 0$. This reflects the fact that the pressure solution is unique only up to an arbitrary constant. We resolve this ambiguity by enforcing a zero-mean pressure, which corresponds to setting $\\tilde{p}_{0,0} = 0$. For all other modes $(m,n) \\neq (0,0)$, the pressure in Fourier space is $\\tilde{p}_{m,n} = \\tilde{f}_{m,n} / \\tilde{L}_{m,n}$. The pressure field $p$ is then recovered by applying an inverse 2D FFT.\n\nThe overall algorithm for each test case is as follows:\n1. Construct the intermediate velocity fields $u^{\\ast}$ and $v^{\\ast}$ on the appropriate grid (A or C).\n2. Compute the initial divergence field $D^{\\ast} = \\nabla \\cdot \\mathbf{u}^{\\ast}$.\n3. Calculate the denominator of the ratio: $\\|\\nabla \\cdot \\mathbf{u}^{\\ast}\\|_2 = \\|D^{\\ast}\\|_2$. If this norm is zero, $R=0$.\n4. Solve the discrete Poisson equation $\\nabla^2 p = \\frac{1}{\\Delta t} D^{\\ast}$ for $p$ using the FFT-based solver.\n5. Compute the pressure gradient $\\nabla p$.\n6. Calculate the projected velocity field: $\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\Delta t \\nabla p$.\n7. Compute the final divergence field $D^{n+1} = \\nabla \\cdot \\mathbf{u}^{n+1}$.\n8. Calculate the numerator of the ratio: $\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_2 = \\|D^{n+1}\\|_2$.\n9. Compute the final ratio $R = \\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_2 / \\|\\nabla \\cdot \\mathbf{u}^{\\ast}\\|_2$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that iterates through test cases and prints the results.\n    \"\"\"\n    test_cases = [\n        (\"C\", 16, 12, 1.0, 2.0, 0.2),\n        (\"A\", 16, 12, 1.0, 2.0, 0.15),\n        (\"C\", 3, 3, 1.3, 0.9, 0.25),\n        (\"A\", 8, 2, 0.8, 1.2, 0.05),\n    ]\n\n    results = []\n    for case in test_cases:\n        grid_type, Nx, Ny, dx, dy, dt = case\n        \n        # --- 1. Construct intermediate velocity fields u* ---\n        if grid_type == \"A\":\n            # Collocated grid: u*, v*, p are at cell centers (Nx, Ny)\n            i_coords, j_coords = np.mgrid[0:Nx, 0:Ny]\n            u_star = np.sin(2 * np.pi * i_coords / Nx) + 0.3 * np.cos(2 * np.pi * j_coords / Ny)\n            v_star = 0.7 * np.cos(2 * np.pi * i_coords / Nx) - np.sin(2 * np.pi * j_coords / Ny)\n        elif grid_type == \"C\":\n            # Staggered grid: p at centers, u on vertical faces, v on horizontal faces\n            # u* on vertical faces: (Nx+1, Ny) with u[0,:]=u[Nx,:]\n            i_u, j_u = np.mgrid[0:Nx + 1, 0:Ny]\n            u_star = np.sin(2 * np.pi * i_u / Nx) + 0.3 * np.cos(2 * np.pi * j_u / Ny)\n            # v* on horizontal faces: (Nx, Ny+1) with v[:,0]=v[:,Ny]\n            i_v, j_v = np.mgrid[0:Nx, 0:Ny + 1]\n            v_star = 0.7 * np.cos(2 * np.pi * i_v / Nx) - np.sin(2 * np.pi * j_v / Ny)\n\n        # --- 2. Compute initial divergence div(u*) ---\n        if grid_type == \"A\":\n            du_dx = (np.roll(u_star, -1, axis=0) - np.roll(u_star, 1, axis=0)) / (2 * dx)\n            dv_dy = (np.roll(v_star, -1, axis=1) - np.roll(v_star, 1, axis=1)) / (2 * dy)\n            div_u_star = du_dx + dv_dy\n        elif grid_type == \"C\":\n            du_dx = (u_star[1:, :] - u_star[:-1, :]) / dx\n            dv_dy = (v_star[:, 1:] - v_star[:, :-1]) / dy\n            div_u_star = du_dx + dv_dy\n\n        # --- 3. Compute L2 norm of initial divergence ---\n        norm_div_u_star = np.linalg.norm(div_u_star)\n        if norm_div_u_star  1e-15:\n            results.append(0.0)\n            continue\n            \n        # --- 4. Solve Poisson equation for pressure p ---\n        # Right-hand side of the Poisson equation\n        rhs = div_u_star / dt\n        \n        # FFT of the RHS\n        rhs_tilde = np.fft.fft2(rhs)\n        \n        # Wavenumbers for the FFT\n        m = np.fft.fftfreq(Nx) * Nx\n        n = np.fft.fftfreq(Ny) * Ny\n        mm, nn = np.meshgrid(m, n, indexing='ij')\n\n        # Fourier symbol of the Laplacian operator\n        laplacian_tilde = (-4 / (dx**2)) * np.sin(np.pi * mm / Nx)**2 \\\n                        + (-4 / (dy**2)) * np.sin(np.pi * nn / Ny)**2\n        \n        # Avoid division by zero for the zero-wavenumber mode\n        laplacian_tilde[0, 0] = 1.0\n        \n        # Solve for p in Fourier space\n        p_tilde = rhs_tilde / laplacian_tilde\n        \n        # Enforce zero mean pressure\n        p_tilde[0, 0] = 0.0\n        \n        # Inverse FFT to get pressure in physical space\n        p = np.fft.ifft2(p_tilde).real\n\n        # --- 5. Compute pressure gradient grad(p) ---\n        if grid_type == \"A\":\n            grad_p_x = (np.roll(p, -1, axis=0) - np.roll(p, 1, axis=0)) / (2 * dx)\n            grad_p_y = (np.roll(p, -1, axis=1) - np.roll(p, 1, axis=1)) / (2 * dy)\n        elif grid_type == \"C\":\n            # Gradient on x-faces\n            grad_p_x = (p - np.roll(p, 1, axis=0)) / dx\n            # Extend to be periodic with shape (Nx+1, Ny)\n            grad_p_x = np.concatenate((grad_p_x, grad_p_x[0:1, :]), axis=0)\n\n            # Gradient on y-faces\n            grad_p_y = (p - np.roll(p, 1, axis=1)) / dy\n            # Extend to be periodic with shape (Nx, Ny+1)\n            grad_p_y = np.concatenate((grad_p_y, grad_p_y[:, 0:1]), axis=1)\n\n        # --- 6. Update velocity to be u_new = u_star - dt*grad(p) ---\n        u_new = u_star - dt * grad_p_x\n        v_new = v_star - dt * grad_p_y\n\n        # --- 7. Compute final divergence div(u_new) ---\n        if grid_type == \"A\":\n            du_dx_new = (np.roll(u_new, -1, axis=0) - np.roll(u_new, 1, axis=0)) / (2 * dx)\n            dv_dy_new = (np.roll(v_new, -1, axis=1) - np.roll(v_new, 1, axis=1)) / (2 * dy)\n            div_u_new = du_dx_new + dv_dy_new\n        elif grid_type == \"C\":\n            du_dx_new = (u_new[1:, :] - u_new[:-1, :]) / dx\n            dv_dy_new = (v_new[:, 1:] - v_new[:, :-1]) / dy\n            div_u_new = du_dx_new + dv_dy_new\n\n        # --- 8. Compute L2 norm of final divergence ---\n        norm_div_u_new = np.linalg.norm(div_u_new)\n\n        # --- 9. Compute the ratio R ---\n        ratio = norm_div_u_new / norm_div_u_star\n        results.append(ratio)\n        \n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}