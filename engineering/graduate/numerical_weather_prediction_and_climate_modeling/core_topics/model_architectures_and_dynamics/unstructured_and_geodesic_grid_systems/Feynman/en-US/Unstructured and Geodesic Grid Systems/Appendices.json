{
    "hands_on_practices": [
        {
            "introduction": "Before analyzing an entire geodesic grid, we must first master the geometric properties of its fundamental building blocks: the polygonal cells. This exercise focuses on a single spherical triangle, a common cell type, and asks you to compute its area from its vertex coordinates. You will apply Girard's theorem, which elegantly connects the cell's internal angles to its area via the concept of spherical excess, reinforcing a crucial principle from spherical trigonometry . Mastering this calculation is essential, as cell areas are fundamental weights in discrete integral formulations, ensuring the conservation of physical quantities like mass and energy in a numerical model.",
            "id": "4107667",
            "problem": "In an icosahedral geodesic discretization used for Numerical Weather Prediction (NWP) and climate modeling, control-volume cell boundaries are taken to be great-circle arcs to ensure metric consistency. Consider the spherical triangular cell on a sphere of radius $R$ whose vertices are given in latitude–longitude coordinates $(\\phi,\\lambda)$, ordered counterclockwise when viewed from outside the sphere: $(\\phi_{1},\\lambda_{1})=(90^{\\circ},0^{\\circ})$, $(\\phi_{2},\\lambda_{2})=(0^{\\circ},0^{\\circ})$, $(\\phi_{3},\\lambda_{3})=(0^{\\circ},90^{\\circ})$. Assume all edges are along the unique great-circle arcs connecting adjacent vertices. Using only first-principles geometric definitions on the sphere—namely, great circles as intersections of planes through the origin with the sphere, unit normal vectors to those planes obtained from cross products of adjacent vertex position vectors, and internal angles at a vertex defined by the angle between the two tangent directions of the incident great-circle arcs—derive how to obtain each internal angle $\\alpha_{i}$ from the vertex unit vectors and the normals of the incident great-circle planes. Then compute the area of the cell by the spherical excess principle and express the final area in square meters. Use radians for all angular computations, take $R=6.371\\times 10^{6}$ meters, and round your numerical answer to four significant figures.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and complete. It describes a solvable problem in spherical geometry with direct applications in numerical modeling.\n\nThe solution proceeds in four stages:\n1.  Convert the given latitude-longitude vertex coordinates into Cartesian unit vectors.\n2.  Derive a general formula for the internal angle of a spherical triangle at a vertex using the cross product of vertex vectors to define plane normals, and the cross product of these normals with the vertex vector to define tangents.\n3.  Apply this formula to compute the three internal angles of the specified spherical triangle cell.\n4.  Calculate the spherical excess and, subsequently, the area of the cell.\n\n**1. Vertex Coordinates**\nThe position of a point on a sphere of unit radius can be described by a Cartesian vector $\\mathbf{v} = (x,y,z)$ which is related to latitude $\\phi$ and longitude $\\lambda$ by:\n$x = \\cos(\\phi)\\cos(\\lambda)$\n$y = \\cos(\\phi)\\sin(\\lambda)$\n$z = \\sin(\\phi)$\n\nAll angular measures must be converted from degrees to radians for computation.\n-   Vertex $1$: $(\\phi_{1},\\lambda_{1})=(90^{\\circ},0^{\\circ}) = (\\frac{\\pi}{2}, 0)$ radians.\n    $\\mathbf{v}_1 = (\\cos(\\frac{\\pi}{2})\\cos(0), \\cos(\\frac{\\pi}{2})\\sin(0), \\sin(\\frac{\\pi}{2})) = (0 \\cdot 1, 0 \\cdot 0, 1) = (0, 0, 1)$.\n-   Vertex $2$: $(\\phi_{2},\\lambda_{2})=(0^{\\circ},0^{\\circ}) = (0, 0)$ radians.\n    $\\mathbf{v}_2 = (\\cos(0)\\cos(0), \\cos(0)\\sin(0), \\sin(0)) = (1 \\cdot 1, 1 \\cdot 0, 0) = (1, 0, 0)$.\n-   Vertex $3$: $(\\phi_{3},\\lambda_{3})=(0^{\\circ},90^{\\circ}) = (0, \\frac{\\pi}{2})$ radians.\n    $\\mathbf{v}_3 = (\\cos(0)\\cos(\\frac{\\pi}{2}), \\cos(0)\\sin(\\frac{\\pi}{2}), \\sin(0)) = (1 \\cdot 0, 1 \\cdot 1, 0) = (0, 1, 0)$.\nThe three vertex vectors $\\mathbf{v}_1, \\mathbf{v}_2, \\mathbf{v}_3$ form a right-handed orthonormal basis.\n\n**2. Derivation of the Internal Angle Formula**\nThe problem requires deriving the formula for an internal angle $\\alpha_i$ at a vertex $\\mathbf{v}_i$ from first principles. The internal angle is defined as the angle between the tangent directions of the two incident great-circle arcs. These arcs are formed by the vertex pairs $(\\mathbf{v}_{i-1}, \\mathbf{v}_i)$ and $(\\mathbf{v}_i, \\mathbf{v}_{i+1})$, where indices are taken modulo $3$ in a counter-clockwise sense.\n\n-   A great-circle arc connecting vertices $\\mathbf{v}_j$ and $\\mathbf{v}_k$ lies in a plane passing through the origin. The unit normal vector to this plane is given by $\\mathbf{n}_{jk} = \\frac{\\mathbf{v}_j \\times \\mathbf{v}_k}{|\\mathbf{v}_j \\times \\mathbf{v}_k|}$.\n-   The tangent vector to a great circle at a point $\\mathbf{v}$ on it lies in the tangent plane of the sphere at $\\mathbf{v}$ and also in the plane of the great circle. Thus, the tangent vector is orthogonal to both the position vector $\\mathbf{v}$ and the great circle's normal vector $\\mathbf{n}$.\n-   The two incident arcs at vertex $\\mathbf{v}_i$ are the arcs from $\\mathbf{v}_{i-1}$ to $\\mathbf{v}_i$ and from $\\mathbf{v}_i$ to $\\mathbf{v}_{i+1}$. We define the internal angle as the angle between the two outgoing tangent vectors from $\\mathbf{v}_i$.\n    -   The outgoing tangent vector from $\\mathbf{v}_i$ towards $\\mathbf{v}_{i+1}$ is $\\mathbf{t}_{i \\to i+1}$. Its direction is given by the cross product of the normal to the great circle plane of $(\\mathbf{v}_i, \\mathbf{v}_{i+1})$ and the position vector $\\mathbf{v}_i$. Let $\\mathbf{n}_{i,i+1} = \\frac{\\mathbf{v}_i \\times \\mathbf{v}_{i+1}}{|\\mathbf{v}_i \\times \\mathbf{v}_{i+1}|}$. The unit tangent is $\\mathbf{u}_{i \\to i+1} = \\mathbf{n}_{i,i+1} \\times \\mathbf{v}_i$.\n    -   Similarly, the outgoing tangent vector from $\\mathbf{v}_i$ towards $\\mathbf{v}_{i-1}$ is $\\mathbf{t}_{i \\to i-1}$. The normal to the plane of $(\\mathbf{v}_i, \\mathbf{v}_{i-1})$ is $\\mathbf{n}_{i,i-1} = \\frac{\\mathbf{v}_i \\times \\mathbf{v}_{i-1}}{|\\mathbf{v}_i \\times \\mathbf{v}_{i-1}|}$. The unit tangent is $\\mathbf{u}_{i \\to i-1} = \\mathbf{n}_{i,i-1} \\times \\mathbf{v}_i$.\n\nThe cosine of the internal angle $\\alpha_i$ is given by the dot product of these two unit tangent vectors:\n$\\cos(\\alpha_i) = \\mathbf{u}_{i \\to i+1} \\cdot \\mathbf{u}_{i \\to i-1} = (\\mathbf{n}_{i,i+1} \\times \\mathbf{v}_i) \\cdot (\\mathbf{n}_{i,i-1} \\times \\mathbf{v}_i)$.\n\nUsing the vector identity $(\\mathbf{a} \\times \\mathbf{b}) \\cdot (\\mathbf{c} \\times \\mathbf{d}) = (\\mathbf{a} \\cdot \\mathbf{c})(\\mathbf{b} \\cdot \\mathbf{d}) - (\\mathbf{a} \\cdot \\mathbf{d})(\\mathbf{b} \\cdot \\mathbf{c})$, we set $\\mathbf{a}=\\mathbf{n}_{i,i+1}$, $\\mathbf{c}=\\mathbf{n}_{i,i-1}$, and $\\mathbf{b}=\\mathbf{d}=\\mathbf{v}_i$:\n$\\cos(\\alpha_i) = (\\mathbf{n}_{i,i+1} \\cdot \\mathbf{n}_{i,i-1})(\\mathbf{v}_i \\cdot \\mathbf{v}_i) - (\\mathbf{n}_{i,i+1} \\cdot \\mathbf{v}_i)(\\mathbf{n}_{i,i-1} \\cdot \\mathbf{v}_i)$.\n\nSince $\\mathbf{v}_i$ is a unit vector, $\\mathbf{v}_i \\cdot \\mathbf{v}_i = 1$. By definition, the normal vector $\\mathbf{n}_{i,k}$ is orthogonal to $\\mathbf{v}_i$, so their dot product is zero: $\\mathbf{n}_{i,i+1} \\cdot \\mathbf{v}_i = 0$ and $\\mathbf{n}_{i,i-1} \\cdot \\mathbf{v}_i = 0$.\nThe expression simplifies to:\n$\\cos(\\alpha_i) = \\mathbf{n}_{i,i+1} \\cdot \\mathbf{n}_{i,i-1}$.\n\nThis general formula allows computation of any internal angle from the normal vectors of the incident great-circle planes.\n\n**3. Calculation of Internal Angles**\nWe now apply this formula to the specific vertices. Note that since $|\\mathbf{v}_j \\times \\mathbf{v}_k| = 1$ for any pair of the orthonormal vertices, the normalization factor is $1$.\n\n-   **Angle $\\alpha_1$ (at $\\mathbf{v}_1$):**\n    $\\mathbf{n}_{1,2} = \\mathbf{v}_1 \\times \\mathbf{v}_2 = (0,0,1) \\times (1,0,0) = (0,1,0)$.\n    $\\mathbf{n}_{1,3} = \\mathbf{v}_1 \\times \\mathbf{v}_3 = (0,0,1) \\times (0,1,0) = (-1,0,0)$.\n    $\\cos(\\alpha_1) = \\mathbf{n}_{1,2} \\cdot \\mathbf{n}_{1,3} = (0,1,0) \\cdot (-1,0,0) = 0$.\n    Thus, $\\alpha_1 = \\arccos(0) = \\frac{\\pi}{2}$ radians.\n\n-   **Angle $\\alpha_2$ (at $\\mathbf{v}_2$):**\n    $\\mathbf{n}_{2,3} = \\mathbf{v}_2 \\times \\mathbf{v}_3 = (1,0,0) \\times (0,1,0) = (0,0,1)$.\n    $\\mathbf{n}_{2,1} = \\mathbf{v}_2 \\times \\mathbf{v}_1 = (1,0,0) \\times (0,0,1) = (0,-1,0)$.\n    $\\cos(\\alpha_2) = \\mathbf{n}_{2,3} \\cdot \\mathbf{n}_{2,1} = (0,0,1) \\cdot (0,-1,0) = 0$.\n    Thus, $\\alpha_2 = \\arccos(0) = \\frac{\\pi}{2}$ radians.\n\n-   **Angle $\\alpha_3$ (at $\\mathbf{v}_3$):**\n    $\\mathbf{n}_{3,1} = \\mathbf{v}_3 \\times \\mathbf{v}_1 = (0,1,0) \\times (0,0,1) = (1,0,0)$.\n    $\\mathbf{n}_{3,2} = \\mathbf{v}_3 \\times \\mathbf{v}_2 = (0,1,0) \\times (1,0,0) = (0,0,-1)$.\n    $\\cos(\\alpha_3) = \\mathbf{n}_{3,1} \\cdot \\mathbf{n}_{3,2} = (1,0,0) \\cdot (0,0,-1) = 0$.\n    Thus, $\\alpha_3 = \\arccos(0) = \\frac{\\pi}{2}$ radians.\n\nAll three internal angles of this spherical triangle are right angles.\n\n**4. Spherical Excess and Area**\nThe area $A$ of a spherical triangle is determined by its spherical excess $E$, according to Girard's theorem, via the formula $A = E R^2$. The spherical excess is the sum of the internal angles (in radians) minus $\\pi$:\n$E = \\alpha_1 + \\alpha_2 + \\alpha_3 - \\pi$.\n$E = \\frac{\\pi}{2} + \\frac{\\pi}{2} + \\frac{\\pi}{2} - \\pi = \\frac{3\\pi}{2} - \\pi = \\frac{\\pi}{2}$ radians.\n\nThe specified spherical triangle constitutes one octant of the sphere surface, for which the spherical excess is indeed $\\frac{\\pi}{2}$.\nThe radius of the sphere is given as $R = 6.371 \\times 10^6$ meters. The area is:\n$A = E R^2 = \\frac{\\pi}{2} (6.371 \\times 10^6 \\text{ m})^2$.\n$A = \\frac{\\pi}{2} (6.371^2 \\times 10^{12}) \\text{ m}^2$.\n$A = \\frac{\\pi}{2} (40.589641 \\times 10^{12}) \\text{ m}^2$.\n$A \\approx 6.3755314 \\times 10^{13} \\text{ m}^2$.\n\nRounding this to four significant figures, we get:\n$A \\approx 6.376 \\times 10^{13} \\text{ m}^2$.",
            "answer": "$$\\boxed{6.376 \\times 10^{13}}$$"
        },
        {
            "introduction": "High-quality unstructured grids are not arbitrary; they are carefully designed to optimize numerical accuracy and stability. This practice introduces you to a cornerstone of modern grid generation: Lloyd's algorithm, a method for producing Centroidal Voronoi Tessellations (CVTs). By performing a single iterative update, you will partition the sphere into Voronoi cells based on geodesic distance and then calculate the geometric centroid of each cell . This exercise provides direct, hands-on experience with the computational mechanics of grid optimization, clarifying how an abstract desire for grid uniformity translates into a concrete and powerful algorithm.",
            "id": "4107679",
            "problem": "Consider the unit sphere $S^{2} \\subset \\mathbb{R}^{3}$ used as a geodesic discretization surface in numerical weather prediction and climate modeling. Three distinct seed points lie on the equator at longitudes $\\lambda_{1} = 0$, $\\lambda_{2} = \\frac{2\\pi}{3}$, and $\\lambda_{3} = \\frac{4\\pi}{3}$. Their Cartesian coordinates are $s_{k} = (\\cos \\lambda_{k}, \\sin \\lambda_{k}, 0)$ for $k \\in \\{1,2,3\\}$. The sphere is partitioned into three spherical Voronoi cells defined by geodesic proximity: a point $p \\in S^{2}$ belongs to the cell of $s_{k}$ if its great-circle distance to $s_{k}$ is less than or equal to its great-circle distance to each of the other two seeds. The great-circle distance between unit vectors $u$ and $v$ is given by $\\arccos(u \\cdot v)$, where $\\cdot$ denotes the Euclidean dot product.\n\nDefine the area element on $S^{2}$ in standard spherical coordinates $(\\theta,\\lambda)$, where $\\theta \\in [0,\\pi]$ is the colatitude measured from the north pole and $\\lambda \\in [0,2\\pi)$ is the longitude, by $\\mathrm{d}A = \\sin \\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\lambda$. For any spherical surface patch $R \\subset S^{2}$, define its area-weighted centroid vector by\n$$\nm(R) = \\frac{1}{A(R)} \\int_{R} r(\\theta,\\lambda) \\,\\mathrm{d}A,\n$$\nwhere $r(\\theta,\\lambda) = (\\sin \\theta \\cos \\lambda, \\sin \\theta \\sin \\lambda, \\cos \\theta)$ and $A(R) = \\int_{R} \\mathrm{d}A$. For a Lloyd update constrained to $S^{2}$, the updated seed is taken as the unit-normalized centroid $m(R)/\\|m(R)\\|$ of its own spherical Voronoi cell $R$.\n\nStarting from the three seeds $s_{k}$ specified above, use the fundamental definitions provided to determine one Lloyd update: explicitly compute the area-weighted centroid of each spherical Voronoi cell and then normalize it to obtain the updated seed positions. Express the final updated seed positions as a single row matrix of Cartesian components in the order $(x_{1}, y_{1}, z_{1}, x_{2}, y_{2}, z_{2}, x_{3}, y_{3}, z_{3})$. No rounding is required.",
            "solution": "The initial seed points $s_k = (\\cos \\lambda_k, \\sin \\lambda_k, 0)$ for $k \\in \\{1,2,3\\}$ are given by their longitudes $\\lambda_1 = 0$, $\\lambda_2 = \\frac{2\\pi}{3}$, and $\\lambda_3 = \\frac{4\\pi}{3}$. Their Cartesian coordinates are:\n$$s_1 = (\\cos(0), \\sin(0), 0) = (1, 0, 0)$$\n$$s_2 = (\\cos(\\frac{2\\pi}{3}), \\sin(\\frac{2\\pi}{3}), 0) = (-\\frac{1}{2}, \\frac{\\sqrt{3}}{2}, 0)$$\n$$s_3 = (\\cos(\\frac{4\\pi}{3}), \\sin(\\frac{4\\pi}{3}), 0) = (-\\frac{1}{2}, -\\frac{\\sqrt{3}}{2}, 0)$$\nThese three points lie on the equator and form the vertices of an equilateral triangle inscribed in the equatorial great circle.\n\nThe spherical Voronoi cell $R_k$ corresponding to seed $s_k$ is the set of all points $p \\in S^2$ that are closer to $s_k$ than to any other seed $s_j$. Since the great-circle distance $d(p, s_k) = \\arccos(p \\cdot s_k)$ is a monotonically decreasing function of the dot product $p \\cdot s_k$, the condition for $p$ being in $R_k$ is $p \\cdot s_k \\ge p \\cdot s_j$ for all $j \\neq k$.\n\nThe boundary between two cells $R_i$ and $R_j$ is the set of points equidistant to $s_i$ and $s_j$, defined by the equation $p \\cdot s_i = p \\cdot s_j$, or $p \\cdot (s_i - s_j) = 0$. This equation describes a plane passing through the origin of the sphere, which intersects the sphere in a great circle. Since all seeds lie on the equator (the $z=0$ plane), the vectors $s_i - s_j$ also lie in the $z=0$ plane. The great circles defined by these planes are therefore meridians, passing through the North and South Poles.\n\nLet's determine the longitude of these meridian boundaries for cell $R_1$:\n1.  Boundary between $R_1$ and $R_2$:\n    $p \\cdot s_1 = p \\cdot s_2$. Let $p = (x,y,z)$.\n    $x = -\\frac{1}{2}x + \\frac{\\sqrt{3}}{2}y \\implies \\frac{3}{2}x = \\frac{\\sqrt{3}}{2}y \\implies y = \\sqrt{3}x$.\n    In spherical coordinates, $x = \\sin\\theta\\cos\\lambda$ and $y = \\sin\\theta\\sin\\lambda$. For $\\sin\\theta \\neq 0$, this gives $\\tan\\lambda = \\sqrt{3}$. This corresponds to longitudes $\\lambda = \\frac{\\pi}{3}$ and $\\lambda = \\frac{4\\pi}{3}$. The boundary is the meridian at $\\lambda = \\frac{\\pi}{3}$.\n\n2.  Boundary between $R_1$ and $R_3$:\n    $p \\cdot s_1 = p \\cdot s_3$.\n    $x = -\\frac{1}{2}x - \\frac{\\sqrt{3}}{2}y \\implies \\frac{3}{2}x = -\\frac{\\sqrt{3}}{2}y \\implies y = -\\sqrt{3}x$.\n    This gives $\\tan\\lambda = -\\sqrt{3}$, which corresponds to longitudes $\\lambda = -\\frac{\\pi}{3}$ (or $\\frac{5\\pi}{3}$) and $\\lambda = \\frac{2\\pi}{3}$. The boundary is the meridian at $\\lambda = -\\frac{\\pi}{3}$.\n\nThus, the Voronoi cell $R_1$ is the spherical wedge (lune) defined by the longitude range $\\lambda \\in [-\\frac{\\pi}{3}, \\frac{\\pi}{3}]$ and the full colatitude range $\\theta \\in [0, \\pi]$.\nBy symmetry, the other cells are identical wedges rotated about the z-axis:\n- $R_1$: $\\lambda \\in [-\\frac{\\pi}{3}, \\frac{\\pi}{3}]$, $\\theta \\in [0, \\pi]$\n- $R_2$: $\\lambda \\in [\\frac{\\pi}{3}, \\pi]$, $\\theta \\in [0, \\pi]$\n- $R_3$: $\\lambda \\in [\\pi, \\frac{5\\pi}{3}]$, $\\theta \\in [0, \\pi]$\n\nWe first compute the Lloyd update for $s_1$ by finding the centroid of $R_1$.\nThe area of the cell $R_1$ is:\n$$A(R_1) = \\int_{R_1} \\mathrm{d}A = \\int_{-\\pi/3}^{\\pi/3} \\int_0^{\\pi} \\sin\\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\lambda$$\n$$A(R_1) = \\left(\\int_{-\\pi/3}^{\\pi/3} \\mathrm{d}\\lambda\\right) \\left(\\int_0^{\\pi} \\sin\\theta \\,\\mathrm{d}\\theta\\right) = \\left[\\lambda\\right]_{-\\pi/3}^{\\pi/3} \\left[-\\cos\\theta\\right]_0^{\\pi} = \\left(\\frac{\\pi}{3} - (-\\frac{\\pi}{3})\\right) (-\\cos\\pi - (-\\cos0)) = \\frac{2\\pi}{3} (1+1) = \\frac{4\\pi}{3}$$\nThis is indeed one-third of the total surface area of the unit sphere, $4\\pi$.\n\nNext, we compute the un-normalized centroid vector $M_1 = \\int_{R_1} r(\\theta,\\lambda) \\,\\mathrm{d}A$.\nThe components of $M_1 = (M_{1x}, M_{1y}, M_{1z})$ are:\n$$M_{1x} = \\int_{-\\pi/3}^{\\pi/3} \\int_0^{\\pi} (\\sin\\theta\\cos\\lambda) \\sin\\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\lambda = \\left(\\int_{-\\pi/3}^{\\pi/3} \\cos\\lambda \\,\\mathrm{d}\\lambda\\right) \\left(\\int_0^{\\pi} \\sin^2\\theta \\,\\mathrm{d}\\theta\\right)$$\nThe integral over $\\lambda$ is $[\\sin\\lambda]_{-\\pi/3}^{\\pi/3} = \\sin(\\frac{\\pi}{3}) - \\sin(-\\frac{\\pi}{3}) = \\frac{\\sqrt{3}}{2} - (-\\frac{\\sqrt{3}}{2}) = \\sqrt{3}$.\nThe integral over $\\theta$ is $\\int_0^{\\pi} \\frac{1-\\cos(2\\theta)}{2} \\,\\mathrm{d}\\theta = \\frac{1}{2}\\left[\\theta - \\frac{\\sin(2\\theta)}{2}\\right]_0^{\\pi} = \\frac{\\pi}{2}$.\nSo, $M_{1x} = \\sqrt{3} \\cdot \\frac{\\pi}{2} = \\frac{\\pi\\sqrt{3}}{2}$.\n\n$$M_{1y} = \\int_{-\\pi/3}^{\\pi/3} \\int_0^{\\pi} (\\sin\\theta\\sin\\lambda) \\sin\\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\lambda = \\left(\\int_{-\\pi/3}^{\\pi/3} \\sin\\lambda \\,\\mathrm{d}\\lambda\\right) \\left(\\int_0^{\\pi} \\sin^2\\theta \\,\\mathrm{d}\\theta\\right)$$\nThe integral over $\\lambda$ is $[-\\cos\\lambda]_{-\\pi/3}^{\\pi/3} = -\\cos(\\frac{\\pi}{3}) - (-\\cos(-\\frac{\\pi}{3})) = 0$. So, $M_{1y} = 0$.\n\n$$M_{1z} = \\int_{-\\pi/3}^{\\pi/3} \\int_0^{\\pi} (\\cos\\theta) \\sin\\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\lambda = \\left(\\int_{-\\pi/3}^{\\pi/3} \\mathrm{d}\\lambda\\right) \\left(\\int_0^{\\pi} \\sin\\theta\\cos\\theta \\,\\mathrm{d}\\theta\\right)$$\nThe integral over $\\theta$ is $\\int_0^{\\pi} \\frac{\\sin(2\\theta)}{2} \\,\\mathrm{d}\\theta = \\left[-\\frac{\\cos(2\\theta)}{4}\\right]_0^{\\pi} = -\\frac{1}{4}(\\cos(2\\pi) - \\cos(0)) = 0$. So, $M_{1z} = 0$.\n\nThe un-normalized centroid vector for $R_1$ is $M_1 = (\\frac{\\pi\\sqrt{3}}{2}, 0, 0)$.\nThe area-weighted centroid is $m(R_1) = \\frac{M_1}{A(R_1)} = \\frac{1}{4\\pi/3} (\\frac{\\pi\\sqrt{3}}{2}, 0, 0) = (\\frac{3\\sqrt{3}}{8}, 0, 0)$.\nThe updated seed $s'_1$ is the unit-normalized centroid:\n$$s'_1 = \\frac{m(R_1)}{\\|m(R_1)\\|} = \\frac{(\\frac{3\\sqrt{3}}{8}, 0, 0)}{| \\frac{3\\sqrt{3}}{8} |} = (1, 0, 0)$$\nThis is identical to the original seed, $s'_1=s_1$.\n\nDue to the symmetry of the initial configuration, the Voronoi cells $R_2$ and $R_3$ are rotations of $R_1$ by $\\frac{2\\pi}{3}$ and $\\frac{4\\pi}{3}$ respectively around the z-axis. The centroids will be similarly rotated, and the normalized centroids will also follow this rotation. As a result, the updated seeds $s'_2$ and $s'_3$ will be identical to the original seeds $s_2$ and $s_3$.\nLet's verify for $s'_2$. The centroid $m(R_2)$ is obtained by rotating $m(R_1)$ by $\\phi = \\frac{2\\pi}{3}$:\n$$m(R_2) = (m(R_1)_x \\cos\\phi - m(R_1)_y \\sin\\phi, m(R_1)_x \\sin\\phi + m(R_1)_y \\cos\\phi, m(R_1)_z)$$\n$$m(R_2) = (\\frac{3\\sqrt{3}}{8} \\cos(\\frac{2\\pi}{3}), \\frac{3\\sqrt{3}}{8} \\sin(\\frac{2\\pi}{3}), 0) = (\\frac{3\\sqrt{3}}{8}(-\\frac{1}{2}), \\frac{3\\sqrt{3}}{8}(\\frac{\\sqrt{3}}{2}), 0) = (-\\frac{3\\sqrt{3}}{16}, \\frac{9}{16}, 0)$$\nThe norm is $\\|m(R_2)\\| = \\sqrt{(-\\frac{3\\sqrt{3}}{16})^2 + (\\frac{9}{16})^2} = \\sqrt{\\frac{27}{256} + \\frac{81}{256}} = \\sqrt{\\frac{108}{256}} = \\frac{6\\sqrt{3}}{16} = \\frac{3\\sqrt{3}}{8}$.\nThe updated seed $s'_2$ is:\n$$s'_2 = \\frac{m(R_2)}{\\|m(R_2)\\|} = \\frac{1}{3\\sqrt{3}/8} (-\\frac{3\\sqrt{3}}{16}, \\frac{9}{16}, 0) = (\\frac{8}{3\\sqrt{3}} \\cdot -\\frac{3\\sqrt{3}}{16}, \\frac{8}{3\\sqrt{3}} \\cdot \\frac{9}{16}, 0) = (-\\frac{1}{2}, \\frac{3}{\\sqrt{3}} \\cdot \\frac{1}{2}, 0) = (-\\frac{1}{2}, \\frac{\\sqrt{3}}{2}, 0)$$\nThis is identical to $s_2$.\nBy the same rotational symmetry, $s'_3 = s_3 = (-\\frac{1}{2}, -\\frac{\\sqrt{3}}{2}, 0)$.\n\nThe configuration of seeds is a fixed point of the Lloyd iteration, representing a centroidal Voronoi tessellation. The updated seed positions are the same as the initial positions.\n\nThe final updated seed positions $(x'_{1}, y'_{1}, z'_{1}, x'_{2}, y'_{2}, z'_{2}, x'_{3}, y'_{3}, z'_{3})$ are:\n$(1, 0, 0, -\\frac{1}{2}, \\frac{\\sqrt{3}}{2}, 0, -\\frac{1}{2}, -\\frac{\\sqrt{3}}{2}, 0)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 0 & 0 & -\\frac{1}{2} & \\frac{\\sqrt{3}}{2} & 0 & -\\frac{1}{2} & -\\frac{\\sqrt{3}}{2} & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The ultimate purpose of a grid is to faithfully support the simulation of physical dynamics. This practice delves into one of the most important aspects of a grid's performance: how its discrete structure affects the propagation of waves. You will investigate the numerical dispersion of inertia-gravity waves on a regular hexagonal grid, a structure that locally approximates many geodesic grids . By comparing the discrete wave phase speed to its continuous counterpart, you will quantify how the grid resolution and wave orientation introduce non-physical dispersion, a critical source of error in weather and climate simulations.",
            "id": "4107621",
            "problem": "You are asked to quantify the dispersion of inertia–gravity waves in the linearized shallow water system discretized on a locally uniform geodesic icosahedral grid. Away from pentagonal defects, the dual of an icosahedral geodesic grid is well-approximated by a uniform hexagonal tiling. In a local tangent plane, this tiling is generated by the equilateral triangular Bravais lattice with primitive vectors $\\mathbf{a}_{1} = (\\Delta, 0)$ and $\\mathbf{a}_{2} = \\left(\\frac{\\Delta}{2}, \\frac{\\sqrt{3}\\,\\Delta}{2}\\right)$, where $\\Delta$ is the nearest-neighbor distance between dual cell centers. Consider the linearized shallow water equations on an $f$-plane about rest:\n- $\\partial_{t} u - f v = - g \\,\\partial_{x} \\eta$,\n- $\\partial_{t} v + f u = - g \\,\\partial_{y} \\eta$,\n- $\\partial_{t} \\eta + H \\left(\\partial_{x} u + \\partial_{y} v\\right) = 0$,\nwhere $u$ and $v$ are horizontal velocity components, $\\eta$ is free-surface height perturbation, $g$ is gravitational acceleration, $H$ is mean depth, and $f$ is the Coriolis parameter. In the continuous case with plane wave solutions of the form $\\exp\\left(i(\\mathbf{k}\\cdot \\mathbf{x} - \\omega t)\\right)$, the well-known dispersion relation for inertia–gravity waves on the $f$-plane is $\\omega^{2} = f^{2} + g H \\, \\|\\mathbf{k}\\|^{2}$, giving the gravity wave phase speed $c = \\sqrt{gH}$ in the limit $f \\to 0$ or $\\|\\mathbf{k}\\| \\to \\infty$.\n\nIn the discrete case on the local hexagonal dual mesh, adopt the symmetric six-point finite-volume Laplacian with normalization chosen to be second-order accurate in space:\n$$\n\\Delta_{\\mathrm{hex}} \\phi(\\mathbf{x}) \\equiv \\frac{2}{3\\,\\Delta^{2}} \\sum_{m=1}^{6} \\left[\\phi(\\mathbf{x} + \\mathbf{d}_{m}) - \\phi(\\mathbf{x})\\right],\n$$\nwhere the six nearest-neighbor displacement vectors are $\\{\\pm \\mathbf{a}_{1}, \\pm \\mathbf{a}_{2}, \\pm (\\mathbf{a}_{1} - \\mathbf{a}_{2})\\}$. Using a plane wave ansatz, the symbol of this operator is $-\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k})$, where\n$$\n\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k}) = \\frac{4}{3\\,\\Delta^{2}} \\left[3 - \\cos(\\mathbf{k}\\cdot \\mathbf{a}_{1}) - \\cos(\\mathbf{k}\\cdot \\mathbf{a}_{2}) - \\cos\\left(\\mathbf{k}\\cdot (\\mathbf{a}_{1} - \\mathbf{a}_{2})\\right)\\right].\n$$\nIn a standard energy-conserving linearization on this locally uniform mesh, the discrete inertia–gravity wave dispersion relation consistent with the above Laplacian symbol is\n$$\n\\omega_{\\mathrm{d}}^{2}(\\mathbf{k}) = f^{2} + c^{2}\\,\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k}), \\quad \\text{with} \\quad c = \\sqrt{gH}.\n$$\nDefine the discrete phase speed as $c_{\\mathrm{p,d}}(\\mathbf{k}) = \\omega_{\\mathrm{d}}(\\mathbf{k}) / \\|\\mathbf{k}\\|$. Your task is to compute the ratio $R(\\mathbf{k}) = c_{\\mathrm{p,d}}(\\mathbf{k})/c$ for a prescribed set of test cases and produce the results in a single line.\n\nFundamental base for derivation and implementation:\n- Linearized shallow water equations on the $f$-plane,\n- Plane wave analysis with $\\exp\\left(i(\\mathbf{k}\\cdot \\mathbf{x} - \\omega t)\\right)$,\n- Second-order consistent symmetric six-point Laplacian on the hexagonal dual mesh as defined above.\n\nNumerical and physical details:\n- Use $\\Delta$ in $\\mathrm{m}$, $g$ in $\\mathrm{m}\\,\\mathrm{s}^{-2}$, $H$ in $\\mathrm{m}$, $f$ in $\\mathrm{s}^{-1}$, and wavevector components in $\\mathrm{rad}\\,\\mathrm{m}^{-1}$.\n- Specify the wavevector via wavelength $\\lambda$ (in $\\mathrm{m}$) and orientation angle $\\theta$ (in radians) with $\\mathbf{k} = \\left(\\frac{2\\pi}{\\lambda}\\cos\\theta, \\frac{2\\pi}{\\lambda}\\sin\\theta\\right)$.\n- Angles must be treated in radians.\n- The outputs must be dimensionless real numbers.\n\nTest suite:\n- Global parameters: $\\Delta = 5.0\\times 10^{4}\\ \\mathrm{m}$, $g = 9.81\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$, $H = 1.0\\times 10^{4}\\ \\mathrm{m}$.\n- Case $1$ (happy path, weak rotation limit): $f = 0$, $\\lambda = 2.0\\times 10^{6}\\ \\mathrm{m}$, $\\theta = 0$.\n- Case $2$ (moderate wavenumber, rotated, high-symmetry direction): $f = 1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$, $\\lambda = 2.0\\times 10^{5}\\ \\mathrm{m}$, $\\theta = \\pi/3$.\n- Case $3$ (near-grid scale, no rotation, anisotropy exposure): $f = 0$, $\\lambda = 1.0\\times 10^{5}\\ \\mathrm{m}$, $\\theta = \\pi/6$.\n- Case $4$ (moderate grid scale, rotated, orthogonal direction): $f = 1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$, $\\lambda = 1.5\\times 10^{5}\\ \\mathrm{m}$, $\\theta = \\pi/2$.\n\nYour program must:\n- Compute $c = \\sqrt{gH}$.\n- For each test case, form $\\mathbf{k}$ from $\\lambda$ and $\\theta$, compute $\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k})$ using the formula above, then compute $\\omega_{\\mathrm{d}}(\\mathbf{k}) = \\sqrt{f^{2} + c^{2}\\,\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k})}$ and the ratio $R(\\mathbf{k}) = \\dfrac{\\omega_{\\mathrm{d}}(\\mathbf{k})}{\\|\\mathbf{k}\\|\\,c}$.\n- Express the final result as a single line containing a comma-separated list of the four ratios in the order of the test suite, enclosed in square brackets, for example, $\\left[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4}\\right]$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4}\\right]$). The values must be decimal floating-point numbers.",
            "solution": "The objective is to compute the ratio $R(\\mathbf{k}) = \\frac{\\omega_{\\mathrm{d}}(\\mathbf{k})}{\\|\\mathbf{k}\\|\\,c}$ for four distinct test cases. This ratio compares the discrete phase speed of inertia-gravity waves to the continuous gravity wave phase speed in the non-rotating, short-wave limit. A value of $R(\\mathbf{k})$ deviating from $1$ indicates numerical dispersion effects due to the grid discretization.\n\nFirst, we establish the constant values and expressions used across all test cases. The global parameters are $\\Delta = 5.0\\times 10^{4}\\,\\mathrm{m}$, $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, and $H = 1.0\\times 10^{4}\\,\\mathrm{m}$.\n\nThe continuous gravity wave phase speed, $c$, is calculated as:\n$$\nc = \\sqrt{gH} = \\sqrt{(9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}) \\times (1.0\\times 10^{4}\\,\\mathrm{m})} = \\sqrt{98100}\\,\\mathrm{m}\\,\\mathrm{s}^{-1} \\approx 313.209195\\,\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\n\nThe hexagonal lattice is defined by the primitive vectors:\n$$\n\\mathbf{a}_{1} = (\\Delta, 0) = (5.0 \\times 10^4, 0)\\,\\mathrm{m}\n$$\n$$\n\\mathbf{a}_{2} = \\left(\\frac{\\Delta}{2}, \\frac{\\sqrt{3}\\,\\Delta}{2}\\right) = (2.5 \\times 10^4, 2.5\\sqrt{3} \\times 10^4)\\,\\mathrm{m}\n$$\nAnother required vector is:\n$$\n\\mathbf{a}_{1} - \\mathbf{a}_{2} = \\left(\\frac{\\Delta}{2}, -\\frac{\\sqrt{3}\\,\\Delta}{2}\\right) = (2.5 \\times 10^4, -2.5\\sqrt{3} \\times 10^4)\\,\\mathrm{m}\n$$\n\nFor each test case, we follow a systematic procedure:\n\n1.  Given the wavelength $\\lambda$ and angle $\\theta$, construct the wavevector $\\mathbf{k} = (k_x, k_y)$. The magnitude is $\\|\\mathbf{k}\\| = \\frac{2\\pi}{\\lambda}$, and the components are $k_x = \\|\\mathbf{k}\\|\\cos\\theta$ and $k_y = \\|\\mathbf{k}\\|\\sin\\theta$.\n\n2.  Compute the scalar products of the wavevector with the lattice vectors: $\\mathbf{k}\\cdot\\mathbf{a}_1$, $\\mathbf{k}\\cdot\\mathbf{a}_2$, and $\\mathbf{k}\\cdot(\\mathbf{a}_1 - \\mathbf{a}_2)$. These are the arguments to the cosine functions in the expression for $\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k})$.\n\n3.  Calculate the effective squared wavenumber, $\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k})$, using the provided formula:\n    $$\n    \\kappa_{\\mathrm{d}}^{2}(\\mathbf{k}) = \\frac{4}{3\\,\\Delta^{2}} \\left[3 - \\cos(\\mathbf{k}\\cdot \\mathbf{a}_{1}) - \\cos(\\mathbf{k}\\cdot \\mathbf{a}_{2}) - \\cos\\left(\\mathbf{k}\\cdot (\\mathbf{a}_{1} - \\mathbf{a}_{2})\\right)\\right]\n    $$\n\n4.  With the Coriolis parameter $f$ for the specific case, calculate the squared discrete frequency $\\omega_{\\mathrm{d}}^{2}(\\mathbf{k})$:\n    $$\n    \\omega_{\\mathrm{d}}^{2}(\\mathbf{k}) = f^{2} + c^{2}\\,\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k})\n    $$\n\n5.  Take the square root to find the discrete frequency $\\omega_{\\mathrm{d}}(\\mathbf{k}) = \\sqrt{\\omega_{\\mathrm{d}}^{2}(\\mathbf{k})}$.\n\n6.  Finally, compute the desired ratio $R(\\mathbf{k})$:\n    $$\n    R(\\mathbf{k}) = \\frac{\\omega_{\\mathrm{d}}(\\mathbf{k})}{\\|\\mathbf{k}\\|\\,c}\n    $$\nThis procedure is now applied to each of the four test cases.\n\n**Case 1**: $f = 0$, $\\lambda = 2.0\\times 10^{6}\\ \\mathrm{m}$, $\\theta = 0$.\nThe wavelength is large ($\\lambda = 40\\Delta$), so we expect the discrete solution to closely approximate the continuous one, i.e., $R(\\mathbf{k}) \\approx 1$.\n*   $\\|\\mathbf{k}\\| = \\frac{2\\pi}{2.0 \\times 10^6} = \\pi \\times 10^{-6}\\,\\mathrm{rad}\\,\\mathrm{m}^{-1}$.\n*   $\\mathbf{k} = (\\pi \\times 10^{-6}, 0)$.\n*   $\\mathbf{k}\\cdot\\mathbf{a}_1 = 0.05\\pi$, $\\mathbf{k}\\cdot\\mathbf{a}_2 = 0.025\\pi$, $\\mathbf{k}\\cdot(\\mathbf{a}_1-\\mathbf{a}_2) = 0.025\\pi$.\n*   As $f=0$, $R(\\mathbf{k}) = \\sqrt{\\kappa_{\\mathrm{d}}^{2}(\\mathbf{k})} / \\|\\mathbf{k}\\|$.\n*   The calculation yields $R(\\mathbf{k}) \\approx 0.999229$.\n\n**Case 2**: $f = 1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$, $\\lambda = 2.0\\times 10^{5}\\ \\mathrm{m}$, $\\theta = \\pi/3$.\nThe wavelength is shorter ($\\lambda = 4\\Delta$) and aligned with a lattice symmetry direction. Numerical dispersion is expected.\n*   $\\|\\mathbf{k}\\| = \\frac{2\\pi}{2.0 \\times 10^5} = \\pi \\times 10^{-5}\\,\\mathrm{rad}\\,\\mathrm{m}^{-1}$.\n*   $\\mathbf{k}$ is proportional to $\\mathbf{a}_2$.\n*   $\\mathbf{k}\\cdot\\mathbf{a}_1 = \\pi/4$, $\\mathbf{k}\\cdot\\mathbf{a}_2 = \\pi/2$, $\\mathbf{k}\\cdot(\\mathbf{a}_1-\\mathbf{a}_2) = -\\pi/4$.\n*   The calculation yields $R(\\mathbf{k}) \\approx 0.926315$.\n\n**Case 3**: $f = 0$, $\\lambda = 1.0\\times 10^{5}\\ \\mathrm{m}$, $\\theta = \\pi/6$.\nThe wavelength is at the grid scale ($\\lambda = 2\\Delta$), which is near the Nyquist limit of the grid. We expect very strong numerical dispersion and anisotropy. The phase speed will be significantly reduced.\n*   $\\|\\mathbf{k}\\| = \\frac{2\\pi}{1.0 \\times 10^5} = 2\\pi \\times 10^{-5}\\,\\mathrm{rad}\\,\\mathrm{m}^{-1}$.\n*   $\\mathbf{k}\\cdot\\mathbf{a}_1 = \\pi\\sqrt{3}/2$, $\\mathbf{k}\\cdot\\mathbf{a}_2 = \\pi\\sqrt{3}/2$, $\\mathbf{k}\\cdot(\\mathbf{a}_1-\\mathbf{a}_2) = 0$.\n*   The calculation yields $R(\\mathbf{k}) \\approx 0.718049$.\n\n**Case 4**: $f = 1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$, $\\lambda = 1.5\\times 10^{5}\\ \\mathrm{m}$, $\\theta = \\pi/2$.\nThe wavelength is short ($\\lambda = 3\\Delta$), and the wave propagates along the $y$-axis, an intermediate direction relative to the lattice vectors.\n*   $\\|\\mathbf{k}\\| = \\frac{2\\pi}{1.5 \\times 10^5}\\,\\mathrm{rad}\\,\\mathrm{m}^{-1}$.\n*   $\\mathbf{k} = (0, \\|\\mathbf{k}\\|)$.\n*   $\\mathbf{k}\\cdot\\mathbf{a}_1 = 0$, $\\mathbf{k}\\cdot\\mathbf{a}_2 = \\pi/\\sqrt{3}$, $\\mathbf{k}\\cdot(\\mathbf{a}_1-\\mathbf{a}_2) = -\\pi/\\sqrt{3}$.\n*   The calculation yields $R(\\mathbf{k}) \\approx 0.901416$.\n\nThe implementation combines these steps into a program that iterates through the test cases and formats the results as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the phase speed ratio for inertia-gravity waves on a discrete\n    hexagonal grid for a given set of test cases.\n    \"\"\"\n\n    # Global physical and grid parameters\n    delta = 5.0e4  # Nearest-neighbor distance (m)\n    g = 9.81       # Gravitational acceleration (m/s^2)\n    H = 1.0e4      # Mean fluid depth (m)\n\n    # Test suite: (f, lambda, theta)\n    # f: Coriolis parameter (s^-1)\n    # lambda: wavelength (m)\n    # theta: wavevector orientation (rad)\n    test_cases = [\n        (0.0, 2.0e6, 0.0),                               # Case 1\n        (1.0e-4, 2.0e5, np.pi / 3),                      # Case 2\n        (0.0, 1.0e5, np.pi / 6),                         # Case 3\n        (1.0e-4, 1.5e5, np.pi / 2),                      # Case 4\n    ]\n\n    # Calculate continuous gravity wave phase speed\n    c = np.sqrt(g * H)\n\n    # Define the primitive lattice vectors for the dual hexagonal grid\n    a1 = np.array([delta, 0.0])\n    a2 = np.array([delta / 2.0, np.sqrt(3.0) * delta / 2.0])\n    a1_minus_a2 = a1 - a2\n\n    results = []\n    for f, lam, theta in test_cases:\n        # 1. Construct the wavevector k\n        k_mag = 2.0 * np.pi / lam\n        k_vec = np.array([k_mag * np.cos(theta), k_mag * np.sin(theta)])\n\n        # 2. Compute dot products\n        k_dot_a1 = np.dot(k_vec, a1)\n        k_dot_a2 = np.dot(k_vec, a2)\n        k_dot_a1_minus_a2 = np.dot(k_vec, a1_minus_a2)\n\n        # 3. Calculate the effective squared wavenumber kappa_d^2\n        term_cos = np.cos(k_dot_a1) + np.cos(k_dot_a2) + np.cos(k_dot_a1_minus_a2)\n        kappa_d_sq = (4.0 / (3.0 * delta**2)) * (3.0 - term_cos)\n\n        # 4. Calculate the squared discrete frequency omega_d^2\n        omega_d_sq = f**2 + c**2 * kappa_d_sq\n\n        # 5. Calculate the discrete frequency omega_d\n        omega_d = np.sqrt(omega_d_sq)\n\n        # 6. Compute the final ratio R(k)\n        # R(k) = c_pd / c = (omega_d / k_mag) / c\n        ratio = omega_d / (k_mag * c)\n        \n        results.append(ratio)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}