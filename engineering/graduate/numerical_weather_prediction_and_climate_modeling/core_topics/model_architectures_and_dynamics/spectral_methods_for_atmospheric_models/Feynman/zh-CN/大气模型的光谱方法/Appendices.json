{
    "hands_on_practices": [
        {
            "introduction": "我们通过一个基础练习开启我们的动手实践之旅。通过计算一个简单常数场的谱系数，我们将直接探究最低阶球谐函数 $Y_{00}$ 的物理意义，并理解它在表示全球平均量和确保模式质量守恒中的关键作用。这个练习将为理解更复杂的谱分析奠定坚实的基础 。",
            "id": "4091678",
            "problem": "考虑一个在数值天气预报（NWP）中的全球示踪场，它在球面上是空间常数。设地球用一个半径为 $R$ 的球面表示，其球坐标为 $(\\theta,\\phi)$，其中 $\\theta \\in [0,\\pi]$ 是余纬，$\\phi \\in [0,2\\pi)$ 是经度。该示踪场是无量纲的，由 $f(\\theta,\\phi) = c$ 给出，其中 $c$ 是一个常数。球谐函数 $Y_{\\ell m}(\\theta,\\phi)$ 在单位球面 $S^{2}$ 上构成一个完备正交基，其内积满足 $\\int_{S^{2}} Y_{\\ell m}(\\theta,\\phi) Y_{\\ell' m'}^{*}(\\theta,\\phi) \\,\\mathrm{d}\\Omega = \\delta_{\\ell \\ell'} \\delta_{m m'}$，其中 $\\mathrm{d}\\Omega = \\sin\\theta \\,\\mathrm{d}\\theta \\,\\mathrm{d}\\phi$，星号表示复共轭。$f$ 在该基上的谱投影由以下系数定义：\n$$\na_{\\ell m} = \\int_{S^{2}} f(\\theta,\\phi) \\, Y_{\\ell m}^{*}(\\theta,\\phi) \\,\\mathrm{d}\\Omega.\n$$\n从这些基本定义和性质出发，完成以下任务：\n1. 根据正交归一性以及 $Y_{00}$ 在球面上是常数这一事实，推导出 $Y_{00}(\\theta,\\phi)$ 的值。\n2. 使用正交归一性证明，对于常数场 $f(\\theta,\\phi)=c$，除了 $a_{00}$ 可能不为零外，所有谱系数 $a_{\\ell m}$ 都为零。\n3. 以 $c$ 和普适常数的形式，明确计算 $a_{00}$ 的闭式表达式。\n4. 使用面积元 $\\mathrm{d}A = R^{2} \\mathrm{d}\\Omega$，证明直接从 $f$ 计算出的总示踪物质量 $M$ 等于从其谱表示计算出的质量，从而证明对于该常数场，在谱截断下质量是守恒的。\n\n提交 $a_{00}$ 的闭式表达式作为你的最终答案。示踪物是无量纲的；用无量纲单位表示 $a_{00}$。无需四舍五入。",
            "solution": "所述问题具有科学依据、是良定的，并包含了进行严格推导所需的所有必要信息。这是谱方法应用于地球物理流体动力学中的一个基本问题。我们将按顺序解答所要求的四个部分。\n\n这个问题的基础是将球面上的标量场 $f(\\theta, \\phi)$ 表示为球谐函数 $Y_{\\ell m}(\\theta, \\phi)$ 的展开式：\n$$\nf(\\theta, \\phi) = \\sum_{\\ell=0}^{\\infty} \\sum_{m=-\\ell}^{\\ell} a_{\\ell m} Y_{\\ell m}(\\theta, \\phi)\n$$\n其中系数 $a_{\\ell m}$ 通过将 $f$ 投影到基函数上得到：\n$$\na_{\\ell m} = \\int_{S^{2}} f(\\theta,\\phi) \\, Y_{\\ell m}^{*}(\\theta,\\phi) \\,\\mathrm{d}\\Omega\n$$\n球谐函数构成一个正交归一基，满足：\n$$\n\\int_{S^{2}} Y_{\\ell m}(\\theta,\\phi) Y_{\\ell' m'}^{*}(\\theta,\\phi) \\,\\mathrm{d}\\Omega = \\delta_{\\ell \\ell'} \\delta_{m m'}\n$$\n其中 $\\mathrm{d}\\Omega = \\sin\\theta \\,\\mathrm{d}\\theta \\,\\mathrm{d}\\phi$ 是立体角元。\n\n**1. $Y_{00}(\\theta,\\phi)$ 的推导**\n\n给定 $Y_{00}(\\theta, \\phi)$ 是一个常数。我们将其记为 $K$，因此 $Y_{00}(\\theta, \\phi) = K$。根据物理学中的惯例，$K$ 是一个实正数，所以 $Y_{00}^{*} = Y_{00} = K$。我们使用 $\\ell = \\ell' = 0$ 和 $m = m' = 0$ 情况下的正交归一性条件：\n$$\n\\int_{S^{2}} Y_{00}(\\theta,\\phi) Y_{00}^{*}(\\theta,\\phi) \\,\\mathrm{d}\\Omega = \\delta_{00} \\delta_{00} = 1\n$$\n代入 $Y_{00} = K$，我们有：\n$$\n\\int_{S^{2}} K \\cdot K \\,\\mathrm{d}\\Omega = 1 \\implies K^{2} \\int_{S^{2}} \\,\\mathrm{d}\\Omega = 1\n$$\n积分 $\\int_{S^{2}} \\,\\mathrm{d}\\Omega$ 代表球面的总立体角。我们在球坐标中显式地计算这个积分：\n$$\n\\int_{S^{2}} \\,\\mathrm{d}\\Omega = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\sin\\theta \\,\\mathrm{d}\\theta \\,\\mathrm{d}\\phi\n$$\n对 $\\theta$ 的积分得到：\n$$\n\\int_{0}^{\\pi} \\sin\\theta \\,\\mathrm{d}\\theta = [-\\cos\\theta]_{0}^{\\pi} = -(\\cos\\pi - \\cos 0) = -(-1 - 1) = 2\n$$\n将此结果代回到对 $\\phi$ 的积分中：\n$$\n\\int_{0}^{2\\pi} 2 \\,\\mathrm{d}\\phi = 2[\\phi]_{0}^{2\\pi} = 2(2\\pi - 0) = 4\\pi\n$$\n因此，球面的总立体角是 $4\\pi$。现在我们可以解出 $K$：\n$$\nK^{2} (4\\pi) = 1 \\implies K^{2} = \\frac{1}{4\\pi} \\implies K = \\frac{1}{\\sqrt{4\\pi}}\n$$\n按惯例我们取正根。因此，常数球谐函数 $Y_{00}$ 是：\n$$\nY_{00}(\\theta,\\phi) = \\frac{1}{\\sqrt{4\\pi}}\n$$\n\n**2. 证明当 $(\\ell, m) \\neq (0, 0)$ 时 $a_{\\ell m}$ 为零**\n\n示踪场被给定为一个常数 $f(\\theta, \\phi) = c$。我们可以用基函数 $Y_{00}$ 来表示这个常数场。根据第一部分的结果，我们知道 $1 = \\sqrt{4\\pi} Y_{00}(\\theta, \\phi)$。因此，我们可以将场 $f$ 写成：\n$$\nf(\\theta, \\phi) = c = c \\cdot 1 = c \\sqrt{4\\pi} Y_{00}(\\theta, \\phi)\n$$\n现在，我们使用其定义来计算谱系数 $a_{\\ell m}$：\n$$\na_{\\ell m} = \\int_{S^{2}} f(\\theta,\\phi) \\, Y_{\\ell m}^{*}(\\theta,\\phi) \\,\\mathrm{d}\\Omega\n$$\n代入 $f(\\theta, \\phi)$ 的表达式：\n$$\na_{\\ell m} = \\int_{S^{2}} \\left( c \\sqrt{4\\pi} Y_{00}(\\theta, \\phi) \\right) Y_{\\ell m}^{*}(\\theta, \\phi) \\,\\mathrm{d}\\Omega\n$$\n项 $c \\sqrt{4\\pi}$ 是一个常数，可以提到积分外面：\n$$\na_{\\ell m} = c \\sqrt{4\\pi} \\int_{S^{2}} Y_{00}(\\theta, \\phi) Y_{\\ell m}^{*}(\\theta, \\phi) \\,\\mathrm{d}\\Omega\n$$\n这个积分正是 $Y_{00}$ 和 $Y_{\\ell m}$ 的内积。根据正交归一关系，该积分的值为 $\\delta_{0\\ell}\\delta_{0m}$：\n$$\na_{\\ell m} = c \\sqrt{4\\pi} \\, \\delta_{0\\ell} \\delta_{0m}\n$$\n克罗内克δ函数 $\\delta_{ij}$ 在 $i=j$ 时等于1，否则等于0。对于任何满足 $\\ell \\neq 0$ 或 $m \\neq 0$ 的数对 $(\\ell, m)$，至少有一个克罗内克δ函数为零。因此，对于所有 $(\\ell, m) \\neq (0, 0)$，都有 $a_{\\ell m} = 0$。这证明了对于一个常数场，只有系数 $a_{00}$ 可以是非零的。\n\n**3. $a_{00}$ 的计算**\n\n我们可以通过在第二部分推导出的 $a_{\\ell m}$ 通用表达式中令 $\\ell=0$ 和 $m=0$ 来求得 $a_{00}$：\n$$\na_{00} = c \\sqrt{4\\pi} \\, \\delta_{00} \\delta_{00} = c \\sqrt{4\\pi} \\cdot 1 \\cdot 1 = c \\sqrt{4\\pi}\n$$\n或者，我们可以直接从其定义计算 $a_{00}$：\n$$\na_{00} = \\int_{S^{2}} f(\\theta,\\phi) Y_{00}^{*}(\\theta,\\phi) \\,\\mathrm{d}\\Omega\n$$\n当 $f(\\theta,\\phi) = c$ 且 $Y_{00}^{*} = Y_{00} = \\frac{1}{\\sqrt{4\\pi}}$ 时：\n$$\na_{00} = \\int_{S^{2}} c \\left( \\frac{1}{\\sqrt{4\\pi}} \\right) \\,\\mathrm{d}\\Omega = \\frac{c}{\\sqrt{4\\pi}} \\int_{S^{2}} \\,\\mathrm{d}\\Omega\n$$\n如第一部分所确立，积分 $\\int_{S^{2}} \\,\\mathrm{d}\\Omega = 4\\pi$。代入这个值：\n$$\na_{00} = \\frac{c}{\\sqrt{4\\pi}} (4\\pi) = c\\sqrt{4\\pi}\n$$\n两种方法得出了相同的结果。\n\n**4. 质量守恒的证明**\n\n术语“质量”指的是无量纲示踪物的总量，通过将场在球表面积上积分得到。表面积元是 $\\mathrm{d}A = R^{2} \\mathrm{d}\\Omega$。\n\n首先，我们直接从场 $f(\\theta, \\phi) = c$ 计算总质量 $M_{\\text{direct}}$：\n$$\nM_{\\text{direct}} = \\int_{\\text{surface}} f(\\theta, \\phi) \\,\\mathrm{d}A = \\int_{S^{2}} c \\, (R^{2} \\,\\mathrm{d}\\Omega)\n$$\n由于 $c$ 和 $R^{2}$ 是常数，我们可以将它们提取出来：\n$$\nM_{\\text{direct}} = c R^{2} \\int_{S^{2}} \\,\\mathrm{d}\\Omega = c R^{2} (4\\pi) = 4\\pi R^{2} c\n$$\n这是预期的结果：球的表面积 $4\\pi R^{2}$ 乘以恒定的示踪物密度 $c$。\n\n接下来，我们从场的谱表示计算质量 $M_{\\text{spec}}$。对于常数场，由于所有其他系数都为零，谱级数在第一项后就截断了。该谱表示是精确的：\n$$\nf(\\theta, \\phi) = a_{00} Y_{00}(\\theta, \\phi) \n$$\n我们来验证这个表示是正确的：$f(\\theta, \\phi) = (c \\sqrt{4\\pi}) \\left( \\frac{1}{\\sqrt{4\\pi}} \\right) = c$。它确实是正确的。现在，我们从这个表示计算质量：\n$$\nM_{\\text{spec}} = \\int_{\\text{surface}} \\left( a_{00} Y_{00}(\\theta, \\phi) \\right) \\,\\mathrm{d}A = \\int_{S^{2}} a_{00} Y_{00}(\\theta, \\phi) \\, (R^{2} \\,\\mathrm{d}\\Omega)\n$$\n提出常数 $a_{00}$ 和 $R^2$：\n$$\nM_{\\text{spec}} = a_{00} R^{2} \\int_{S^{2}} Y_{00}(\\theta, \\phi) \\,\\mathrm{d}\\Omega\n$$\n代入 $Y_{00}(\\theta, \\phi) = \\frac{1}{\\sqrt{4\\pi}}$：\n$$\nM_{\\text{spec}} = a_{00} R^{2} \\int_{S^{2}} \\frac{1}{\\sqrt{4\\pi}} \\,\\mathrm{d}\\Omega = \\frac{a_{00} R^{2}}{\\sqrt{4\\pi}} \\int_{S^{2}} \\,\\mathrm{d}\\Omega\n$$\n该积分再次为 $4\\pi$：\n$$\nM_{\\text{spec}} = \\frac{a_{00} R^{2}}{\\sqrt{4\\pi}} (4\\pi) = a_{00} R^{2} \\sqrt{4\\pi}\n$$\n最后，代入第三部分得到的 $a_{00} = c\\sqrt{4\\pi}$ 的值：\n$$\nM_{\\text{spec}} = (c\\sqrt{4\\pi}) R^{2} \\sqrt{4\\pi} = c R^{2} (4\\pi) = 4\\pi R^{2} c\n$$\n我们发现 $M_{\\text{direct}} = M_{\\text{spec}}$。这证明了在使用谱表示时，总示踪物质量是守恒的。对于一个常数场，即使对于一个在最低阶（只保留 $\\ell=0$ 模态）截断的谱模型，这一点也成立，因为关于场的所有信息都包含在 $a_{00}$ 系数中。",
            "answer": "$$\\boxed{c\\sqrt{4\\pi}}$$"
        },
        {
            "introduction": "虽然谱方法非常强大，但使用有限数量的平滑波函数来表示尖锐或局地化特征会引入特定的截断误差。本练习提供了一个计算试验平台，用于研究吉布斯现象（Gibbs phenomenon），让您能够可视化并量化谱截断所产生的“振铃”误差 。通过这个实践，您将对谱方法在实际应用中的优势与局限有更深刻的认识。",
            "id": "4091659",
            "problem": "考虑一种常用于数值天气预报和气候建模的一维经向谱表示，用于在固定纬度上近似球体上的场。经向坐标用 $\\lambda \\in [0,2\\pi)$ 表示，角度以弧度为单位。假定该场在 $\\lambda$ 上是 $2\\pi$ 周期的。其基本基是傅里叶级数表示，这源于复指数在圆上的正交性。设基函数为 $e^{\\mathrm{i} m \\lambda}$（其中 $m$ 为整数），并将在均匀网格上的离散傅里叶变换（DFT）定义为连续傅里叶系数的数值积分近似。在波数极限 $L$ 处的截断级数通过对 $m \\in \\{-L,-L+1,\\dots,L-1,L\\}$ 的模态求和来定义。\n\n要求您设计一个测试，使用一个局域化的高斯凸起（Gaussian bump）来测量作为截断数 $L$ 的函数的重构误差和振铃效应。高斯凸起由圆上的周期性距离定义。对于选定的中心经度 $\\lambda_0$ 和宽度 $\\sigma$，通过将差值包裹到 $[-\\pi,\\pi)$ 区间内并取绝对值，来定义最小角距离函数 $\\Delta(\\lambda,\\lambda_0)$。高斯凸起则为\n$$\nf(\\lambda) = \\exp\\left( - \\left( \\frac{\\Delta(\\lambda,\\lambda_0)}{\\sigma} \\right)^2 \\right).\n$$\n$f(\\lambda)$ 是光滑且局域化的；其截断傅里叶重构将因谱截断而表现出近似误差和微小的振铃效应。在 $\\lambda$ 上的 $N$ 个点的均匀网格上使用 DFT，数值计算傅里叶系数，并仅使用 $|m| \\le L$ 的模态重构 $f(\\lambda)$，得到 $f_L(\\lambda)$。\n\n从复指数 $e^{\\mathrm{i} m \\lambda}$ 的正交性和圆上傅里叶级数的定义出发，推导一个计算过程以实现以下目标：\n- 在均匀网格上构造具有指定 $\\lambda_0$ 和 $\\sigma$ 的周期性高斯凸起 $f(\\lambda)$。\n- 计算其 DFT 以获得离散傅里叶系数。\n- 通过将所有 $|m| > L$ 的系数置零，在波数极限 $L$ 处进行截断。\n- 反转 DFT 以获得截断重构 $f_L(\\lambda)$。\n\n为每个截断数 $L$ 测量以下量：\n1. 相对 $L^2$ 误差，\n$$\nE_{L^2}(L) = \\frac{\\left( \\frac{1}{N} \\sum_{j=0}^{N-1} \\left( f_L(\\lambda_j) - f(\\lambda_j) \\right)^2 \\right)^{1/2}}{\\left( \\frac{1}{N} \\sum_{j=0}^{N-1} f(\\lambda_j)^2 \\right)^{1/2}},\n$$\n其中 $\\lambda_j = \\frac{2\\pi j}{N}$。\n2. 正振铃振幅（超过真实最大值的过冲），\n$$\nR_{+}(L) = \\max\\left( \\max_{j} f_L(\\lambda_j) - \\max_{j} f(\\lambda_j), \\, 0 \\right).\n$$\n3. 负振铃振幅（低于真实最小值的下冲），\n$$\nR_{-}(L) = \\max\\left( \\min_{j} f(\\lambda_j) - \\min_{j} f_L(\\lambda_j), \\, 0 \\right).\n$$\n\n角度必须以弧度为单位。所有输出必须表示为十进制数（浮点数）。您的程序必须实现上述步骤，并为每个指定的测试用例生成所要求的指标。\n\n测试套件：\n- 在 $\\lambda$ 上使用具有 $N = 4096$ 个点的均匀网格。\n- 使用位于 $\\lambda_0 = 0$ 的凸起中心。\n- 使用 $\\sigma = 0.2$ 的凸起宽度。\n- 评估截断级别 $L \\in \\{0, 4, 16, 64, 256, 1023\\}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，其本身是一个包含三个浮点数 $[E_{L^2}(L), R_{+}(L), R_{-}(L)]$ 的列表，顺序与测试套件中 $L$ 值的顺序相同。例如，包含两个用例的输出应如下所示：$[[e_1,rp_1,rn_1],[e_2,rp_2,rn_2]]$。此问题的最终输出必须遵循此确切格式。",
            "solution": "用户提供的问题已经过验证且是合理的。以下解决方案介绍了分析周期性高斯函数谱重构的理论基础和计算过程。\n\n### 理论基础与数值方法\n\n该问题探讨了使用截断傅里叶级数来近似一个 $2\\pi$ 周期的函数 $f(\\lambda)$。函数 $f(\\lambda)$ 可以用其无穷傅里叶级数表示：\n$$\nf(\\lambda) = \\sum_{m=-\\infty}^{\\infty} c_m e^{\\mathrm{i} m \\lambda}\n$$\n其中 $m$ 是整数波数，$c_m$ 是复傅里叶系数。基函数 $\\{e^{\\mathrm{i} m \\lambda}\\}_{m \\in \\mathbb{Z}}$ 在区间 $[0, 2\\pi)$ 上是正交的，满足：\n$$\n\\int_0^{2\\pi} e^{\\mathrm{i} m \\lambda} (e^{\\mathrm{i} n \\lambda})^* \\,d\\lambda = \\int_0^{2\\pi} e^{\\mathrm{i} (m-n) \\lambda} \\,d\\lambda = 2\\pi \\delta_{mn}\n$$\n其中 $\\delta_{mn}$ 是克罗内克 δ (Kronecker delta)。这种正交性允许通过投影来计算系数 $c_m$：\n$$\nc_m = \\frac{1}{2\\pi} \\int_0^{2\\pi} f(\\lambda) e^{-\\mathrm{i} m \\lambda} \\,d\\lambda\n$$\n在数值计算的背景下，连续函数 $f(\\lambda)$ 在一个包含 $N$ 个点的离散均匀网格上进行采样：\n$$\n\\lambda_j = \\frac{2\\pi j}{N}, \\quad j = 0, 1, \\dots, N-1\n$$\n$c_m$ 的积分随后通过数值积分来近似，具体来说，是在网格点上进行黎曼和 (Riemann sum)。采样值表示为 $f_j = f(\\lambda_j)$。\n$$\nc_m \\approx \\frac{1}{2\\pi} \\sum_{j=0}^{N-1} f(\\lambda_j) e^{-\\mathrm{i} m \\lambda_j} \\Delta\\lambda = \\frac{1}{2\\pi} \\sum_{j=0}^{N-1} f_j e^{-\\mathrm{i} m \\frac{2\\pi j}{N}} \\frac{2\\pi}{N} = \\frac{1}{N} \\sum_{j=0}^{N-1} f_j e^{-\\frac{2\\pi \\mathrm{i} m j}{N}}\n$$\n该表达式与离散傅里叶变换（DFT）直接相关。序列 $\\{f_j\\}_{j=0}^{N-1}$ 的正向 DFT 定义为：\n$$\n\\hat{f}_k = \\sum_{j=0}^{N-1} f_j e^{-\\frac{2\\pi \\mathrm{i} k j}{N}}, \\quad k = 0, 1, \\dots, N-1\n$$\n通过比较这两个表达式，我们可以看到傅里叶系数 $c_m$ 由缩放后的 DFT 系数 $\\hat{f}_k$ 近似，其中 DFT 频率指数 $k$ 对应于波数 $m$。具体而言，$c_m \\approx \\frac{1}{N}\\hat{f}_m$。由于混叠效应，DFT 指数 $k \\in \\{0, \\dots, N-1\\}$ 对应于以零为中心的一系列物理波数，对于偶数 $N$，通常为 $m \\in \\{-N/2, \\dots, N/2 - 1\\}$。\n\n### 谱截断与重构\n\n$f(\\lambda)$ 在最大波数 $L$ 处截断的谱近似由下式给出：\n$$\nf_L(\\lambda) = \\sum_{m=-L}^{L} c_m e^{\\mathrm{i} m \\lambda}\n$$\n在离散网格 $\\lambda_j$ 上对此式求值，并代入基于 DFT 的 $c_m$ 近似，可得：\n$$\nf_L(\\lambda_j) \\approx \\sum_{m=-L}^{L} \\left( \\frac{1}{N} \\hat{f}_m \\right) e^{\\mathrm{i} m \\lambda_j} = \\frac{1}{N} \\sum_{m=-L}^{L} \\hat{f}_m e^{\\frac{2\\pi \\mathrm{i} m j}{N}}\n$$\n这正是一组修改后的系数 $\\hat{f}_{L,k}$ 的离散傅里叶逆变换（IDFT），当波数 $|m| \\le L$ 时，这些系数等于 $\\hat{f}_k$，否则为零。IDFT 定义为：\n$$\nf_j = \\frac{1}{N} \\sum_{k=0}^{N-1} \\hat{f}_k e^{\\frac{2\\pi \\mathrm{i} k j}{N}}\n$$\n因此，可以通过对经过谱滤波的傅里叶系数数组执行 IDFT 来高效地计算重构场 $f_L(\\lambda_j)$。\n\n### 计算步骤\n\n计算所需指标的程序步骤如下：\n\n1.  **网格与函数构造**：\n    - 为 $\\lambda \\in [0, 2\\pi)$ 构建一个包含 $N=4096$ 个点的均匀网格 $\\lambda_j = \\frac{2\\pi j}{N}$。\n    - 对每个网格点计算 $\\lambda_0=0$ 时的周期性距离函数 $\\Delta(\\lambda, \\lambda_0)$。这是圆上的最短距离，由 $\\Delta(\\lambda_j, 0) = \\min(\\lambda_j, 2\\pi - \\lambda_j)$ 给出。一个更通用的公式是 $|\\text{mod}(\\lambda - \\lambda_0 + \\pi, 2\\pi) - \\pi|$。\n    - 在每个网格点上计算高斯凸起函数 $f(\\lambda_j) = \\exp\\left( - \\left( \\frac{\\Delta(\\lambda_j, \\lambda_0=0)}{\\sigma=0.2} \\right)^2 \\right)$ 的值。\n\n2.  **正向变换**：\n    - 使用快速傅里叶变换（FFT）算法计算离散信号 $\\{f_j\\}$ 的 DFT，得到复系数 $\\hat{f}_k$。\n\n3.  **谱截断**：\n    - 确定与每个 DFT 系数指数 $k$ 对应的整数波数 $m$。对于长度为 $N$ 的 DFT，波数为 $m \\in \\{0, 1, \\dots, N/2-1, -N/2, \\dots, -1\\}$。\n    - 对于每个给定的截断级别 $L$，创建一个新的系数数组 $\\hat{f}_{L,k}$。这是通过复制 $\\hat{f}_k$ 并将所有对应绝对波数 $|m|$ 大于 $L$ 的系数设置为零来完成的。\n\n4.  **逆变换（重构）**：\n    - 通过计算截断系数数组 $\\{\\hat{f}_{L,k}\\}$ 的 IDFT 来获得截断重构 $\\{f_{L,j}\\}$。由于原始函数是实数，IDFT 的结果也应该是实数；任何微小的虚部分量都作为数值噪声被丢弃。\n\n5.  **指标计算**：\n    - 利用原始场 $f_j$ 和重构场 $f_{L,j}$，为每个 $L$ 值计算三个指定的指标：\n      - 相对 $L^2$ 误差 $E_{L^2}(L)$，用于测量归一化的均方根差。\n      - 正振铃振幅 $R_{+}(L)$，用于量化重构的最大过冲。\n      - 负振铃振幅 $R_{-}(L)$，用于量化重构的最大下冲。\n\n对每个截断级别 $L \\in \\{0, 4, 16, 64, 256, 1023\\}$ 重复此过程。",
            "answer": "```python\nimport numpy as np\nimport scipy.fft\n\ndef solve():\n    \"\"\"\n    Computes spectral reconstruction error and ringing for a periodic Gaussian bump.\n    \"\"\"\n    # Test Suite Parameters\n    N = 4096\n    lambda_0 = 0.0\n    sigma = 0.2\n    L_values = [0, 4, 16, 64, 256, 1023]\n\n    # Step 1: Construct the grid and the function f(lambda)\n    # Create a uniform grid in lambda from 0 to 2*pi (exclusive of 2*pi)\n    lambda_grid = np.linspace(0, 2 * np.pi, N, endpoint=False)\n\n    # Calculate the periodic distance Delta(lambda, lambda_0)\n    # This finds the shortest angle between lambda_grid and lambda_0 on a circle.\n    # The expression wraps the difference into [-pi, pi) and takes the absolute value.\n    diff = lambda_grid - lambda_0\n    wrapped_diff = (diff + np.pi) % (2 * np.pi) - np.pi\n    delta = np.abs(wrapped_diff)\n\n    # Define the Gaussian bump function\n    f_values = np.exp(-(delta / sigma)**2)\n\n    # Pre-calculate values needed for metric computation\n    max_f = np.max(f_values)\n    min_f = np.min(f_values)\n    # The factors of 1/N in the L2 error definition cancel, so we can use linalg.norm\n    norm_f = np.linalg.norm(f_values)\n\n    # Step 2: Compute the DFT of the function\n    f_hat = scipy.fft.fft(f_values)\n\n    # Determine the integer wavenumbers 'm' corresponding to the DFT coefficients\n    # scipy.fft.fftfreq(N) returns frequency bins k/N. Multiplying by N gives integer k.\n    # These correspond to the wavenumbers m.\n    wavenumbers_m = scipy.fft.fftfreq(N) * N\n\n    results = []\n    for L in L_values:\n        # Step 3: Apply spectral truncation\n        # Create a copy of the coefficients\n        f_hat_truncated = f_hat.copy()\n        # Create a mask for wavenumbers to be zeroed out\n        truncation_mask = np.abs(wavenumbers_m) > L\n        # Apply the mask\n        f_hat_truncated[truncation_mask] = 0.0\n\n        # Step 4: Invert the DFT to get the reconstructed function f_L(lambda)\n        # The result of ifft on a real signal's spectrum should be real.\n        # We take the real part to discard small imaginary noise from floating point errors.\n        f_L = np.real(scipy.fft.ifft(f_hat_truncated))\n\n        # Step 5: Measure the required quantities\n        \n        # 1. Relative L2 error\n        # E_L2(L) = norm(f_L - f) / norm(f)\n        error_norm = np.linalg.norm(f_L - f_values)\n        E_L2 = error_norm / norm_f if norm_f > 0 else 0.0\n\n        # 2. Positive ringing amplitude (overshoot)\n        # R_+(L) = max( max(f_L) - max(f), 0 )\n        R_plus = np.maximum(np.max(f_L) - max_f, 0.0)\n\n        # 3. Negative ringing amplitude (undershoot)\n        # R_-(L) = max( min(f) - min(f_L), 0 )\n        R_minus = np.maximum(min_f - np.min(f_L), 0.0)\n        \n        results.append([E_L2, R_plus, R_minus])\n\n    # Final print statement in the exact required format\n    # The format is a list of lists of floats, represented as a string.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在探究了谱表示的基础之后，我们现在将这些技术应用于解决一个动力学问题。这个高级练习将指导您构建一个用于示踪物平流和扩散的二维谱方法模型，这是大气建模中的一项核心任务，您还将接触并实现超扩散（hyperdiffusion）这一维持数值稳定性的重要概念 。",
            "id": "4091581",
            "problem": "您需要设计并实现一个在双周期正方形域上的二维示踪剂平流-超扩散方程的谱方法实验。目标是通过将数值谱方法时间积分与不同超扩散阶数的解析谱解进行比较来计算误差范数。该实验必须完全自洽，并在具有周期性边界条件的正方形域上以无量纲单位进行操作。\n\n从周期性域上均匀、无散速度场中被动标量示踪剂的守恒开始。控制方程为\n$$\n\\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} + v \\frac{\\partial q}{\\partial y} = - \\nu \\left( - \\nabla^2 \\right)^p q,\n$$\n其中 $q(x,y,t)$ 是示踪剂浓度，$u$ 和 $v$ 是恒定速度，$\\nu$ 是超扩散系数，$p$ 是正整数超扩散阶数。空间域是边长为 $L=2\\pi$ 的正方形 $[0,L)\\times[0,L)$，并且所有场在两个方向上都是 $L$-周期的。\n\n使用谱方法中以下经过充分检验的数学事实和定义：\n- 快速傅里叶变换 (FFT) 将 $N\\times N$ 网格上的离散周期场 $q(x,y)$ 映射到其离散傅里叶系数 $\\hat{q}(k_x,k_y)$，其中角波数由 $k_x = 2\\pi f_x$ 和 $k_y = 2\\pi f_y$ 给出，而 $f_x$ 和 $f_y$ 是由离散傅里叶变换网格间距计算出的FFT频率。\n- 在谱空间中，对于离散傅里叶表示，空间微分是精确的：$\\widehat{\\partial_x q} = i k_x \\hat{q}$ 和 $\\widehat{\\partial_y q} = i k_y \\hat{q}$，拉普拉斯算子为 $\\widehat{\\nabla^2 q} = -\\left(k_x^2 + k_y^2\\right)\\hat{q}$。\n- 对于常系数和线性算子，每个离散傅里叶模态都作为时间上的常微分方程独立演化。\n\n在这些基础上，推导每个傅里叶模态的精确离散谱-时间演化，然后实现一个数值时间积分器。具体来说：\n1. 将初始示踪剂场表示为一个以 $(x_0,y_0)$ 为中心的高斯斑：\n$$\nq(x,y,0) = \\exp\\left( - \\frac{(x-x_0)^2 + (y-y_0)^2}{2\\sigma^2} \\right),\n$$\n其周期性由域决定。使用 $x_0 = \\pi/2$，$y_0 = \\pi$ 和 $\\sigma = 0.30$。\n2. 在谱空间中，证明每个模态满足\n$$\n\\frac{d \\hat{q}}{dt} = \\left( - i \\left( u k_x + v k_y \\right) - \\nu \\left( k_x^2 + k_y^2 \\right)^p \\right) \\hat{q},\n$$\n因此，在时间 $t$ 的精确离散解是\n$$\n\\hat{q}(t) = \\hat{q}(0) \\exp\\left( - i \\left( u k_x + v k_y \\right) t - \\nu \\left( k_x^2 + k_y^2 \\right)^p t \\right).\n$$\n3. 使用经典的四阶龙格-库塔 (RK4) 方法，对谱常微分方程进行数值时间积分，步数为 $N_t$，步长为 $\\Delta t$，使得 $t = N_t \\Delta t$。计算数值近似解 $\\hat{q}_{\\text{num}}(t)$ 并通过其逆傅里叶变换得到 $q_{\\text{num}}(x,y,t)$。\n4. 通过将精确的谱演化应用于初始谱并进行逆变换，计算解析基准解 $q_{\\text{exact}}(x,y,t)$。\n5. 在网格上计算 $q_{\\text{num}}(x,y,t)$ 和 $q_{\\text{exact}}(x,y,t)$ 之间的误差范数：\n   - $L^2$ 误差为\n   $$\n   E_{2} = \\sqrt{ \\frac{1}{N^2} \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} \\left( q_{\\text{num}}(x_i,y_j,t) - q_{\\text{exact}}(x_i,y_j,t) \\right)^2 }.\n   $$\n   - $L^{\\infty}$ 误差为\n   $$\n   E_{\\infty} = \\max_{0 \\le i,j  N} \\left| q_{\\text{num}}(x_i,y_j,t) - q_{\\text{exact}}(x_i,y_j,t) \\right|.\n   $$\n\n数值实现要求：\n- 使用 $N \\times N$ 网格，$N$ 由各测试用例给出，域长度 $L = 2\\pi$，网格间距为 $\\Delta x = L/N$ 和 $\\Delta y = L/N$。\n- 使用基于 FFT 的谱微分，角波数为 $k_x = 2\\pi \\, \\text{fftfreq}(N, d=\\Delta x)$ 和 $k_y = 2\\pi \\, \\text{fftfreq}(N, d=\\Delta y)$。\n- 在谱空间中使用 RK4 方法对每个傅里叶模态的线性常微分方程进行时间步进。\n- 速度分量和超扩散参数由各测试用例指定。\n- 所有量都是无量纲的；不需要物理单位。\n\n测试套件：\n对于每个测试用例，使用 $x_0 = \\pi/2$，$y_0 = \\pi$，总积分时间 $T = 0.50$，时间步长 $\\Delta t = 0.005$，因此步数为 $N_t = 100$。速度分量为 $u = 1.0$ 和 $v = 0.5$。测试用例通过改变网格大小和超扩散参数来探测不同的体系：\n- 用例 1：$N = 64$，$p = 1$，$\\nu = 0.010$。\n- 用例 2：$N = 64$，$p = 2$，$\\nu = 0.00050$。\n- 用例 3：$N = 64$，$p = 4$，$\\nu = 1.0 \\times 10^{-12}$。\n- 用例 4：$N = 64$，$p = 1$，$\\nu = 0.0$ (纯平流)。\n\n答案规范：\n- 对于每个测试用例，计算并返回一个列表 $[E_{2}, E_{\\infty}]$，其中两个条目都是浮点数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果也用方括号括起来，并严格按照测试套件的顺序排列。例如：\n$$\n\\text{[}[E_{2}^{(1)},E_{\\infty}^{(1)}],[E_{2}^{(2)},E_{\\infty}^{(2)}],[E_{2}^{(3)},E_{\\infty}^{(3)}],[E_{2}^{(4)},E_{\\infty}^{(4)}]\\text{]}.\n$$",
            "solution": "该问题被验证为具有科学依据、适定且内部一致。它为使用谱方法的线性偏微分方程数值求解器提供了一个标准的验证测试。我们将继续提供一个完整的解决方案。\n\n问题的核心是在双周期域 $[0, L) \\times [0, L)$（其中 $L=2\\pi$）上求解被动标量示踪剂 $q(x,y,t)$ 的平流-超扩散方程。控制方程为：\n$$\n\\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} + v \\frac{\\partial q}{\\partial y} = - \\nu \\left( - \\nabla^2 \\right)^p q\n$$\n此处，$u$ 和 $v$ 是恒定速度分量，$\\nu$ 是超扩散系数，$p$ 是超扩散的整数阶数。由于周期性边界条件和常系数线性算子，谱方法是解决此问题的理想选择。\n\n**1. 变换到谱空间**\n\n我们在一个离散的 $N \\times N$ 网格上表示场 $q(x,y,t)$。其谱表示 $\\hat{q}(k_x, k_y, t)$ 是通过二维离散傅里叶变换 (DFT) 获得的，该变换使用快速傅里叶变换 (FFT) 算法实现。傅里叶变换的关键特性是它将微分算子转换成代数乘法。偏导数 $\\partial/\\partial x$ 和 $\\partial/\\partial y$ 分别变换为乘以 $i k_x$ 和 $i k_y$，其中 $k_x$ 和 $k_y$ 是对应于网格的角波数。\n\n对控制偏微分方程逐项应用傅里叶变换，我们得到：\n$$\n\\frac{d \\hat{q}}{dt} + u (i k_x \\hat{q}) + v (i k_y \\hat{q}) = - \\nu \\left( - (-(k_x^2 + k_y^2)) \\right)^p \\hat{q}\n$$\n拉普拉斯算子 $\\nabla^2 = \\partial^2/\\partial x^2 + \\partial^2/\\partial y^2$ 变换为乘以 $-(k_x^2 + k_y^2)$。因此，超扩散算子 $(-\\nabla^2)^p$ 变为乘以 $(k_x^2 + k_y^2)^p$。\n\n重新整理方程，得到每个傅里叶模态 $\\hat{q}(k_x, k_y, t)$ 的一个独立常微分方程组 (ODEs)：\n$$\n\\frac{d \\hat{q}}{dt} = \\left( -i(u k_x + v k_y) - \\nu(k_x^2 + k_y^2)^p \\right) \\hat{q}\n$$\n这是一个形式为 $d\\hat{q}/dt = \\mathcal{L}\\hat{q}$ 的线性常微分方程，其中 $\\mathcal{L}$ 是一个复数值标量（谱算子），它取决于波数 $(k_x, k_y)$ 和物理参数 $(u, v, \\nu, p)$。\n\n**2. 离散化和初始条件**\n\n空间域 $[0, 2\\pi) \\times [0, 2\\pi)$ 在一个 $N \\times N$ 网格上进行离散化，其中 $N=64$。网格间距为 $\\Delta x = \\Delta y = L/N = 2\\pi/N$。物理坐标为 $x_j = j \\Delta x$ 和 $y_l = l \\Delta y$，其中 $j, l \\in \\{0, 1, \\dots, N-1\\}$。离散波数计算为 $k = 2\\pi f$，其中 $f$ 是由 `numpy.fft.fftfreq(N, d=2\\pi/N)` 返回的频率。这会得到整数波数 $k_x, k_y \\in \\{0, 1, \\dots, N/2-1, -N/2, \\dots, -1\\}$。我们构建 $k_x$ 和 $k_y$ 的二维数组，以对应傅里叶系数的二维数组。\n\n初始条件是一个高斯斑：\n$$\nq(x,y,0) = \\exp\\left( - \\frac{(x-x_0)^2 + (y-y_0)^2}{2\\sigma^2} \\right)\n$$\n其中 $x_0 = \\pi/2$，$y_0 = \\pi$，$\\sigma = 0.30$。此函数在二维物理网格上求值以获得初始状态 $q_0$。其谱表示 $\\hat{q}_0 = \\text{FFT2D}(q_0)$ 作为常微分方程组的初始条件。\n\n**3. 数值时间积分 (RK4)**\n\n数值解是通过使用经典的四阶龙格-库塔 (RK4) 方法对谱常微分方程进行时间上的向前积分得到的。对于给定时间 $t_n$ 的状态 $\\hat{q}_n$，在时间 $t_n + \\Delta t$ 的状态 $\\hat{q}_{n+1}$ 计算如下，其中 $f(\\hat{q}) = \\mathcal{L}\\hat{q}$：\n\\begin{align*}\n    K_1 = \\mathcal{L} \\, \\hat{q}_n \\\\\n    K_2 = \\mathcal{L} \\, (\\hat{q}_n + \\frac{\\Delta t}{2} K_1) \\\\\n    K_3 = \\mathcal{L} \\, (\\hat{q}_n + \\frac{\\Delta t}{2} K_2) \\\\\n    K_4 = \\mathcal{L} \\, (\\hat{q}_n + \\Delta t K_3) \\\\\n    \\hat{q}_{n+1} = \\hat{q}_n + \\frac{\\Delta t}{6} (K_1 + 2K_2 + 2K_3 + K_4)\n\\end{align*}\n此过程重复 $N_t = 100$ 步，时间步长为 $\\Delta t=0.005$，以达到最终时间 $T=0.5$。结果是在时间 $T$ 的谱的数值近似，记为 $\\hat{q}_{\\text{num}}(T)$。通过应用二维逆傅里叶变换并取实部，可以恢复物理空间解 $q_{\\text{num}}(x,y,T)$。\n\n**4. 解析解**\n\n由于每个模态的常微分方程是线性的且系数 $\\mathcal{L}$ 为常数，其精确解由下式给出：\n$$\n\\hat{q}(T) = \\hat{q}(0) \\exp(\\mathcal{L} T)\n$$\n这个解析解 $\\hat{q}_{\\text{exact}}(T)$ 是通过将初始谱 $\\hat{q}_0$ 乘以指数因子一步计算得到的。相应的物理场 $q_{\\text{exact}}(x,y,T)$ 通过二维逆傅里叶变换获得。此解作为与 RK4 数值解进行比较的“基准真相”。\n\n**5. 误差计算**\n\n数值模拟的准确性通过计算物理网格上数值解 $q_{\\text{num}}$ 和精确解 $q_{\\text{exact}}$ 之间的误差来量化。使用两种标准的误差范数：\n- $L^2$ 误差，它衡量均方根差：\n$$\nE_{2} = \\sqrt{ \\frac{1}{N^2} \\sum_{i,j} \\left( q_{\\text{num}}(x_i,y_j,T) - q_{\\text{exact}}(x_i,y_j,T) \\right)^2 }\n$$\n- $L^{\\infty}$ 误差，它衡量任意网格点上的最大绝对差：\n$$\nE_{\\infty} = \\max_{i,j} \\left| q_{\\text{num}}(x_i,y_j,T) - q_{\\text{exact}}(x_i,y_j,T) \\right|\n$$\n对问题陈述中指定的四个测试用例中的每一个都执行这些步骤。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 2D advection-hyperdiffusion equation using a spectral method\n    and computes error norms against an analytical solution.\n    \"\"\"\n\n    def run_simulation(N, p, nu, u, v, L, x0, y0, sigma, T, dt):\n        \"\"\"\n        Runs a single simulation case.\n        \"\"\"\n        # 1. Setup Grid and Wavenumbers\n        dx = L / N\n        dy = L / N\n        x = np.arange(0, N) * dx\n        y = np.arange(0, N) * dy\n        xx, yy = np.meshgrid(x, y)\n\n        kx_vec = 2 * np.pi * np.fft.fftfreq(N, d=dx)\n        ky_vec = 2 * np.pi * np.fft.fftfreq(N, d=dy)\n        kx, ky = np.meshgrid(kx_vec, ky_vec)\n\n        # 2. Initial Condition\n        q0 = np.exp(-(((xx - x0)**2 + (yy - y0)**2) / (2 * sigma**2)))\n        q0_hat = np.fft.fft2(q0)\n\n        # 3. Define Spectral Operator and RHS for ODE\n        advection_op = -1j * (u * kx + v * ky)\n        k_sq = kx**2 + ky**2\n        \n        # Avoid issues with k=0 for p=0, though p is a positive integer here.\n        # Zero-wavenumber mode should not be diffused.\n        k_sq[0, 0] = 0\n        diffusion_op = -nu * (k_sq)**p\n        \n        spectral_op = advection_op + diffusion_op\n\n        def rhs(q_hat):\n            return spectral_op * q_hat\n\n        # 4. Time Integration (RK4) for Numerical Solution\n        q_num_hat = q0_hat.copy()\n        Nt = int(round(T / dt))\n        for _ in range(Nt):\n            k1 = rhs(q_num_hat)\n            k2 = rhs(q_num_hat + 0.5 * dt * k1)\n            k3 = rhs(q_num_hat + 0.5 * dt * k2)\n            k4 = rhs(q_num_hat + dt * k3)\n            q_num_hat += (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n        \n        q_num = np.real(np.fft.ifft2(q_num_hat))\n\n        # 5. Compute Analytical Solution\n        q_exact_hat = q0_hat * np.exp(spectral_op * T)\n        q_exact = np.real(np.fft.ifft2(q_exact_hat))\n\n        # 6. Compute Error Norms\n        diff = q_num - q_exact\n        e2 = np.sqrt(np.mean(diff**2))\n        e_inf = np.max(np.abs(diff))\n\n        return [e2, e_inf]\n\n    # Shared parameters for all test cases\n    L = 2.0 * np.pi\n    x0 = np.pi / 2.0\n    y0 = np.pi\n    sigma = 0.30\n    T = 0.50\n    dt = 0.005\n    u = 1.0\n    v = 0.5\n\n    # Test suite from the problem statement\n    test_cases = [\n        {'N': 64, 'p': 1, 'nu': 0.010},       # Case 1\n        {'N': 64, 'p': 2, 'nu': 0.00050},     # Case 2\n        {'N': 64, 'p': 4, 'nu': 1.0e-12},     # Case 3\n        {'N': 64, 'p': 1, 'nu': 0.0},         # Case 4 (p is irrelevant when nu=0)\n    ]\n\n    results = []\n    for case in test_cases:\n        e2, e_inf = run_simulation(\n            N=case['N'], p=case['p'], nu=case['nu'],\n            u=u, v=v, L=L, x0=x0, y0=y0, sigma=sigma, T=T, dt=dt\n        )\n        results.append(f\"[{e2},{e_inf}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}