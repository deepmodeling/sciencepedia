{
    "hands_on_practices": [
        {
            "introduction": "Fully compressible atmospheric models are fundamentally grounded in the principles of thermodynamics. Before discretizing the governing equations, it is essential to have a firm grasp of the relationships between thermodynamic state variables. This first exercise reinforces the connection between pressure ($p$), density ($\\rho$), temperature ($T$), and internal energy density ($e$) for an ideal gas, which serves as the standard thermodynamic closure. By working through this problem, you will practice applying the ideal gas law and the definition of internal energy, and derive a key relationship that links the energy content of the fluid to its pressure .",
            "id": "4046732",
            "problem": "In a conservative finite-volume discretization of the fully compressible Euler equations used in Numerical Weather Prediction (NWP), consider a single control volume at a given time step. The cell-averaged density is $\\rho = 1.2\\ \\mathrm{kg\\,m^{-3}}$ and the cell-averaged temperature is $T = 290\\ \\mathrm{K}$. The fluid is modeled as an ideal gas with specific gas constant $R = 287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$ and ratio of specific heats $\\gamma = 1.4$. Using only fundamental relations for an ideal gas, namely the ideal gas equation of state and the definition of internal energy density for an ideal gas, proceed as follows:\n\n1. From first principles, write down the ideal gas relation connecting pressure, density, temperature, and the specific gas constant. Use it to compute the cell-averaged pressure $p$.\n2. Using the thermodynamic identity for an ideal gas that connects the specific heat at constant volume and the ratio of specific heats, express the specific heat at constant volume $c_v$ in terms of $R$ and $\\gamma$. Then determine the internal energy density $e$ in the control volume from its fundamental definition involving $\\rho$, $c_v$, and $T$.\n3. Show that, for an ideal gas, the ratio $e/p$ depends only on $\\gamma$, and evaluate this ratio numerically for the given $\\gamma$.\n\nProvide as your final answer the single numerical value of the dimensionless ratio $e/p$. Express the final numerical value as an exact decimal without rounding.",
            "solution": "The problem statement has been critically examined and found to be valid. It is scientifically grounded in the principles of thermodynamics for an ideal gas, well-posed with sufficient and consistent data, and objectively formulated. I will now proceed with a complete solution, following the specified steps.\n\nThe provided parameters are:\n- Cell-averaged density: $\\rho = 1.2\\ \\mathrm{kg\\,m^{-3}}$\n- Cell-averaged temperature: $T = 290\\ \\mathrm{K}$\n- Specific gas constant: $R = 287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- Ratio of specific heats: $\\gamma = 1.4$\n\nThe fluid is treated as an ideal gas.\n\n**Step 1: Calculation of Pressure ($p$)**\n\nFrom first principles, the ideal gas equation of state relates pressure ($p$), density ($\\rho$), and temperature ($T$) through the specific gas constant ($R$). The equation is:\n$$p = \\rho R T$$\nSubstituting the given numerical values:\n$$p = (1.2\\ \\mathrm{kg\\,m^{-3}}) \\times (287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}) \\times (290\\ \\mathrm{K})$$\nThe product of these values gives the cell-averaged pressure:\n$$p = 99912\\ \\mathrm{J\\,m^{-3}} = 99912\\ \\mathrm{Pa}$$\n\n**Step 2: Calculation of Internal Energy Density ($e$)**\n\nFirst, we determine the specific heat at constant volume, $c_v$. For a calorically perfect ideal gas, the specific heats at constant pressure ($c_p$) and constant volume ($c_v$) are related to the specific gas constant ($R$) by Mayer's relation:\n$$c_p - c_v = R$$\nThe ratio of specific heats, $\\gamma$, is defined as:\n$$\\gamma = \\frac{c_p}{c_v}$$\nFrom this definition, we can express $c_p$ as $c_p = \\gamma c_v$. Substituting this into Mayer's relation yields:\n$$\\gamma c_v - c_v = R$$\nFactoring out $c_v$:\n$$c_v(\\gamma - 1) = R$$\nSolving for $c_v$, we obtain the required expression:\n$$c_v = \\frac{R}{\\gamma - 1}$$\nNow, we determine the internal energy density, $e$. The specific internal energy (internal energy per unit mass), $u$, for an ideal gas is given by $u = c_v T$. The internal energy density, $e$, is the internal energy per unit volume, which is obtained by multiplying the specific internal energy by the density:\n$$e = \\rho u = \\rho c_v T$$\nSubstituting the expression for $c_v$ that we derived:\n$$e = \\rho \\left( \\frac{R}{\\gamma - 1} \\right) T$$\nUsing the given numerical values to first calculate $c_v$:\n$$c_v = \\frac{287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}}{1.4 - 1} = \\frac{287}{0.4}\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}} = 717.5\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$$\nNow, we can compute the internal energy density $e$:\n$$e = (1.2\\ \\mathrm{kg\\,m^{-3}}) \\times (717.5\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}) \\times (290\\ \\mathrm{K})$$\n$$e = 249690\\ \\mathrm{J\\,m^{-3}}$$\n\n**Step 3: Derivation and Evaluation of the Ratio $e/p$**\n\nThe problem requires showing that the ratio $e/p$ depends only on $\\gamma$. We use the symbolic expressions for $p$ and $e$ derived in the previous steps:\n$$p = \\rho R T$$\n$$e = \\frac{\\rho R T}{\\gamma - 1}$$\nNow, we form the ratio of these two quantities:\n$$\\frac{e}{p} = \\frac{\\left( \\frac{\\rho R T}{\\gamma - 1} \\right)}{\\rho R T}$$\nThe terms $\\rho$, $R$, and $T$ are present in both the numerator and the denominator, and since $\\rho \\neq 0$, $R \\neq 0$, and $T \\neq 0$, we can cancel them:\n$$\\frac{e}{p} = \\frac{1}{\\gamma - 1}$$\nThis result confirms that for an ideal gas, the ratio of internal energy density to pressure is a function solely of the ratio of specific heats, $\\gamma$.\n\nFinally, we evaluate this ratio numerically using the provided value of $\\gamma = 1.4$:\n$$\\frac{e}{p} = \\frac{1}{1.4 - 1} = \\frac{1}{0.4}$$\nThe final numerical value is an exact decimal:\n$$\\frac{e}{p} = 2.5$$\nAs a consistency check, we can also compute the ratio using the numerical values we calculated for $p$ and $e$:\n$$\\frac{e}{p} = \\frac{249690\\ \\mathrm{J\\,m^{-3}}}{99912\\ \\mathrm{J\\,m^{-3}}} = 2.5$$\nThe results are consistent. The dimensionless ratio is $2.5$.",
            "answer": "$$\\boxed{2.5}$$"
        },
        {
            "introduction": "Conservative formulations evolve prognostic variables like mass density ($\\rho$), momentum density ($\\rho \\mathbf{u}$), and total energy density ($E$) to ensure that fundamental quantities are conserved numerically. However, the variables we often want to analyze, such as pressure and temperature, are 'primitive' variables that must be diagnosed from the conserved state. This practice provides a crucial hands-on example of this 'inversion' process, where you will partition total energy into its internal, kinetic, and potential components to recover the thermodynamic state . This exercise highlights a core computational step in any model based on conservative equations and introduces the important check for physical realizability.",
            "id": "4046690",
            "problem": "Consider a single finite-volume cell in a fully compressible atmospheric model advanced with a strictly conservative formulation for mass, momentum, and energy in the presence of gravity. The model stores the conserved variables mass density $\\rho$, momentum density $\\rho \\mathbf{u}$, and total energy density $E$. Gravity is represented by a gravitational potential per unit mass $\\Phi = g z$, where $g$ is the gravitational acceleration and $z$ is the geopotential height. The thermodynamic closure is an ideal-gas model for dry air, with ratio of specific heats $\\gamma$ and specific gas constant $R$.\n\nGiven the following cell-averaged data:\n- $\\rho = 1.18~\\mathrm{kg}\\,\\mathrm{m}^{-3}$,\n- $\\rho \\mathbf{u} = (5.0,\\,-2.0,\\,0.5)~\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$,\n- $E = 2.2987016 \\times 10^{5}~\\mathrm{J}\\,\\mathrm{m}^{-3}$,\n- $g = 9.80665~\\mathrm{m}\\,\\mathrm{s}^{-2}$,\n- $z = 1500~\\mathrm{m}$,\n- $\\gamma = 1.4$,\n- $R = 287~\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n\ncompute the primitive thermodynamic state $(p, T)$ in this cell, where $p$ is the pressure and $T$ is the temperature. Treat the stored energy density $E$ as the total energy per unit volume including internal, kinetic, and gravitational potential contributions. Then assess realizability by verifying the positivity conditions $p>0$ and $T>0$.\n\nExpress $p$ in Pascals and $T$ in Kelvin. Round your final answers to four significant figures. Provide your final numerical answers as a single row matrix $(p, T)$.",
            "solution": "The problem statement gives a set of cell-averaged conserved variables from a fully compressible atmospheric model and asks for the corresponding primitive thermodynamic variables, pressure $p$ and temperature $T$. The problem is well-posed, scientifically sound, and contains all necessary information for a unique solution.\n\nThe total energy density $E$ in the presence of gravity is the sum of the internal energy density $\\rho e$, the kinetic energy density $E_k$, and the gravitational potential energy density $E_p$:\n$$E = \\rho e + E_k + E_p$$\nThe kinetic energy density is $E_k = \\frac{1}{2}\\rho |\\mathbf{u}|^2$, and the gravitational potential energy density is $E_p = \\rho \\Phi = \\rho g z$. Substituting these into the total energy equation gives:\n$$E = \\rho e + \\frac{1}{2}\\rho |\\mathbf{u}|^2 + \\rho g z$$\nThe thermodynamic state is described by the ideal gas law for dry air, $p = \\rho R T$, where $p$ is the pressure, $\\rho$ is the mass density, $R$ is the specific gas constant, and $T$ is the temperature. The specific internal energy $e$ for an ideal gas is a function of temperature only, given by $e = c_v T$, where $c_v$ is the specific heat at constant volume. The constant $c_v$ is related to $R$ and the ratio of specific heats $\\gamma$ by the relation $c_v = \\frac{R}{\\gamma - 1}$.\n\nOur goal is to invert the given conserved state $(\\rho, \\rho\\mathbf{u}, E)$ to find the primitive state $(p, T)$.\n\nFirst, we calculate the kinetic energy density $E_k$. It is most directly calculated from the given momentum density $\\rho \\mathbf{u}$ and mass density $\\rho$ as:\n$$E_k = \\frac{|\\rho \\mathbf{u}|^2}{2\\rho}$$\nGiven $\\rho \\mathbf{u} = (5.0, -2.0, 0.5)~\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$, the squared magnitude of the momentum density is:\n$$|\\rho \\mathbf{u}|^2 = (5.0)^2 + (-2.0)^2 + (0.5)^2 = 25.0 + 4.0 + 0.25 = 29.25~(\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1})^2$$\nWith $\\rho = 1.18~\\mathrm{kg}\\,\\mathrm{m}^{-3}$, the kinetic energy density is:\n$$E_k = \\frac{29.25}{2 \\times 1.18} = \\frac{29.25}{2.36}~\\mathrm{J}\\,\\mathrm{m}^{-3} \\approx 12.394068~\\mathrm{J}\\,\\mathrm{m}^{-3}$$\n\nSecond, we calculate the gravitational potential energy density $E_p$:\n$$E_p = \\rho g z$$\nUsing the provided values $g = 9.80665~\\mathrm{m}\\,\\mathrm{s}^{-2}$ and $z = 1500~\\mathrm{m}$:\n$$E_p = 1.18~\\mathrm{kg}\\,\\mathrm{m}^{-3} \\times 9.80665~\\mathrm{m}\\,\\mathrm{s}^{-2} \\times 1500~\\mathrm{m} = 17357.7705~\\mathrm{J}\\,\\mathrm{m}^{-3}$$\n\nThird, we isolate the internal energy density $\\rho e$ by rearranging the total energy equation:\n$$\\rho e = E - E_k - E_p$$\nSubstituting the value for total energy $E = 2.2987016 \\times 10^{5}~\\mathrm{J}\\,\\mathrm{m}^{-3}$ and our calculated values for $E_k$ and $E_p$:\n$$\\rho e = 229870.16 - 12.394068 - 17357.7705 \\approx 212499.995432~\\mathrm{J}\\,\\mathrm{m}^{-3}$$\n\nFourth, we determine the temperature $T$. The internal energy density is related to temperature by $\\rho e = \\rho c_v T$. First, we compute $c_v$:\n$$c_v = \\frac{R}{\\gamma - 1} = \\frac{287~\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}}{1.4 - 1.0} = \\frac{287}{0.4} = 717.5~\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$$\nNow we solve for $T$:\n$$T = \\frac{\\rho e}{\\rho c_v} = \\frac{212499.995432~\\mathrm{J}\\,\\mathrm{m}^{-3}}{1.18~\\mathrm{kg}\\,\\mathrm{m}^{-3} \\times 717.5~\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}} = \\frac{212499.995432}{846.65}~\\mathrm{K} \\approx 250.99757~\\mathrm{K}$$\n\nFifth, we calculate the pressure $p$ using the ideal gas law:\n$$p = \\rho R T$$\n$$p = 1.18~\\mathrm{kg}\\,\\mathrm{m}^{-3} \\times 287~\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1} \\times 250.99757~\\mathrm{K} \\approx 85003.58~\\mathrm{Pa}$$\n\nThe problem requires rounding the final answers to four significant figures.\nPressure: $p = 85003.58~\\mathrm{Pa} \\to 8.500 \\times 10^4~\\mathrm{Pa}$.\nTemperature: $T = 250.99757~\\mathrm{K} \\to 251.0~\\mathrm{K}$.\n\nFinally, we assess the physical realizability of the computed state. The conditions are $p>0$ and $T>0$. Our results $p \\approx 8.5 \\times 10^4~\\mathrm{Pa}$ and $T \\approx 251~\\mathrm{K}$ are both positive, so the state is realizable.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n8.500 \\times 10^4 & 251.0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "One of the most significant challenges in numerical weather prediction is accurately representing atmospheric flow over complex terrain. In a hydrostatic atmosphere at rest, a delicate balance exists between the vertical pressure gradient force and gravity. This exercise demonstrates how a naive numerical approximation of the pressure gradient in a terrain-following coordinate system can break this balance, generating large, spurious horizontal forces . By comparing this flawed approach to a 'well-balanced' scheme, you will gain insight into a critical aspect of modern model design that is essential for producing accurate forecasts in mountainous regions.",
            "id": "4046693",
            "problem": "Consider a two-dimensional, dry, fully compressible atmosphere in hydrostatic equilibrium over terrain represented by a bottom boundary elevation that varies with horizontal position. The fluid is at rest and the hydrostatic balance is given by the fundamental law $dp/dz = - \\rho g$, where $p$ is pressure in $\\mathrm{Pa}$, $\\rho$ is density in $\\mathrm{kg\\,m^{-3}}$, $z$ is geometric height in $\\mathrm{m}$, and $g$ is gravitational acceleration in $\\mathrm{m\\,s^{-2}}$. Assume an isothermal ideal gas with constant temperature $T$ and gas constant $R$, so that $p(z) = p_0 \\exp(-z/H)$ and $\\rho(z) = \\rho_0 \\exp(-z/H)$, where $H = RT/g$ is the pressure scale height, $p_0$ is the sea-level pressure, and $\\rho_0 = p_0/(RT)$ is the sea-level density. The horizontal domain is periodic in the $x$ direction with length $L_x$.\n\nLet the terrain-following vertical coordinate be defined by $\\sigma \\in [0,1]$ with a mapping to geometric height\n$$\nz(x,\\sigma) = z_b(x) + \\sigma \\left( z_\\mathrm{top} - z_b(x) \\right),\n$$\nwhere $z_b(x)$ is the bottom boundary elevation and $z_\\mathrm{top}$ is the constant top height. The bottom is given by a cosine hill\n$$\nz_b(x) = A \\cos\\!\\left( \\frac{2\\pi x}{L_x} \\right),\n$$\nwith amplitude $A$ in $\\mathrm{m}$. The computational grid consists of $N_x$ uniformly spaced horizontal points $x_i = i \\Delta x$ for $i \\in \\{0,\\dots,N_x-1\\}$ with $\\Delta x = L_x/N_x$, and $N_z$ uniformly spaced full levels in $\\sigma$, $\\sigma_j = (j + 1/2)/N_z$ for $j \\in \\{0,\\dots,N_z-1\\}$.\n\nDefine the discrete hydrostatic base state by sampling $p$ and $\\rho$ at the grid points: $p_{i,j} = p\\!\\left( z(x_i,\\sigma_j) \\right)$ and $\\rho_{i,j} = \\rho\\!\\left( z(x_i,\\sigma_j) \\right)$. Consider the discrete horizontal acceleration due to the Pressure Gradient Force (PGF), which in physical coordinates is $a_x = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x}$.\n\nYour task is to compute, for each of the following test cases, the maximum-norm residual acceleration $R$ in $\\mathrm{m\\,s^{-2}}$ over the grid for two different discrete formulations:\n\n1. A naive, non-well-balanced formulation that approximates the PGF at constant $\\sigma$ using a centered finite difference,\n$a_{x,\\mathrm{naive}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x},$\nwith periodic indexing in $i$. The residual $R_\\mathrm{naive}$ is defined as\n$R_\\mathrm{naive} = \\max_{i,j} \\left| a_{x,\\mathrm{naive}}(i,j) \\right|.$\n\n2. A well-balanced, height-interpolated formulation that approximates the PGF at constant geometric height. For each $(i,j)$, let $z_{i,j} = z(x_i,\\sigma_j)$. Construct linear interpolants of the profiles $p$ as functions of $z$ in columns $i-1$ and $i+1$ from the sampled pairs $\\{(z_{k}, p_{k})\\}$ for those columns. Evaluate these interpolants at the target height $z_{i,j}$ to obtain $p_{i-1 \\rightarrow i}(z_{i,j})$ and $p_{i+1 \\rightarrow i}(z_{i,j})$, i.e., the pressures in columns $i-1$ and $i+1$ mapped to the height $z_{i,j}$ by linear interpolation in $z$. Allow linear extrapolation when $z_{i,j}$ lies outside the sampled range in a neighboring column. Then define\n$a_{x,\\mathrm{wb}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1 \\rightarrow i}(z_{i,j}) - p_{i-1 \\rightarrow i}(z_{i,j})}{2\\Delta x},$\nand\n$R_\\mathrm{wb} = \\max_{i,j} \\left| a_{x,\\mathrm{wb}}(i,j) \\right|.$\n\nFor each test case, compute the error-reduction factor\n$$\n\\mathcal{Q} = \n\\begin{cases}\nR_\\mathrm{naive} / R_\\mathrm{wb}, & \\text{if } R_\\mathrm{wb} > 0,\\\\\n1.0, & \\text{if } R_\\mathrm{wb} = 0,\n\\end{cases}\n$$\nas a dimensionless float.\n\nAll physical constants and parameters must be used in International System of Units (SI units). Use $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $R = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $T = 280\\,\\mathrm{K}$, $p_0 = 10^5\\,\\mathrm{Pa}$. The top is at $z_\\mathrm{top} = 12000\\,\\mathrm{m}$. The following test suite specifies the remaining parameters for four cases:\n- Case 1 (flat terrain baseline): $L_x = 100000\\,\\mathrm{m}$, $N_x = 64$, $N_z = 40$, $A = 0\\,\\mathrm{m}$.\n- Case 2 (moderate slope): $L_x = 100000\\,\\mathrm{m}$, $N_x = 64$, $N_z = 40$, $A = 1000\\,\\mathrm{m}$.\n- Case 3 (steeper terrain, coarser vertical grid): $L_x = 50000\\,\\mathrm{m}$, $N_x = 64$, $N_z = 20$, $A = 2000\\,\\mathrm{m}$.\n- Case 4 (steeper terrain, finer vertical grid): $L_x = 50000\\,\\mathrm{m}$, $N_x = 64$, $N_z = 80$, $A = 2000\\,\\mathrm{m}$.\n\nYour program must compute, for each case, the triple $(R_\\mathrm{naive}, R_\\mathrm{wb}, \\mathcal{Q})$ with $R_\\mathrm{naive}$ and $R_\\mathrm{wb}$ in $\\mathrm{m\\,s^{-2}}$ and $\\mathcal{Q}$ dimensionless, and then print a single line containing all twelve results as a comma-separated list of floats enclosed in square brackets, ordered by cases and within each case ordered as $(R_\\mathrm{naive}, R_\\mathrm{wb}, \\mathcal{Q})$. Each float must be rounded to six significant digits. For example, the output format must be\n$[r_{1,\\mathrm{naive}},r_{1,\\mathrm{wb}},q_1,r_{2,\\mathrm{naive}},r_{2,\\mathrm{wb}},q_2,r_{3,\\mathrm{naive}},r_{3,\\mathrm{wb}},q_3,r_{4,\\mathrmnaive}},r_{4,\\mathrm{wb}},q_4]$,\nwhere each $r$ is in $\\mathrm{m\\,s^{-2}}$ and each $q$ is dimensionless, all as decimal floats.",
            "solution": "The central challenge of this problem is to quantify the numerical error arising from the computation of the horizontal Pressure Gradient Force (PGF) in a terrain-following coordinate system and to demonstrate the superior accuracy of a well-balanced discretization scheme over a naive one. The physical scenario is an atmosphere at rest in perfect hydrostatic equilibrium, where the true horizontal acceleration is exactly zero. Any non-zero acceleration computed by a numerical scheme is therefore purely a result of discretization error.\n\nThe continuous horizontal PGF in the $x$-direction is given by\n$$\na_x = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x}\n$$\nIn a hydrostatic atmosphere at rest, pressure $p$ is solely a function of geometric height $z$, i.e., $p = p(z)$. Consequently, the partial derivative of pressure with respect to the horizontal coordinate $x$ at a constant height $z$ is zero:\n$$\n\\left( \\frac{\\partial p}{\\partial x} \\right)_z = 0\n$$\nThis implies that the true horizontal acceleration $a_x$ is identically zero everywhere. The problem, therefore, asks for the computation of spurious, numerically-generated accelerations.\n\nFirst, we establish the computational domain and the physical state. The physical constants are gravitational acceleration $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, the specific gas constant for dry air $R = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$, the constant temperature $T = 280\\,\\mathrm{K}$, and the sea-level pressure $p_0 = 10^5\\,\\mathrm{Pa}$. From these, we derive the pressure scale height $H = RT/g$ and the sea-level density $\\rho_0 = p_0/(RT)$. The hydrostatic pressure and density profiles are given by the exponential functions:\n$$\np(z) = p_0 \\exp(-z/H)\n$$\n$$\n\\rho(z) = \\rho_0 \\exp(-z/H)\n$$\nThe computational grid is defined over a horizontal domain of length $L_x$ and a vertical domain extending to height $z_\\mathrm{top} = 12000\\,\\mathrm{m}$. The horizontal grid has $N_x$ points $x_i = i \\Delta x$ for $i \\in \\{0, \\dots, N_x-1\\}$, where $\\Delta x = L_x/N_x$. The vertical direction is discretized using a terrain-following coordinate $\\sigma \\in [0,1]$ with $N_z$ levels located at $\\sigma_j = (j + 0.5)/N_z$ for $j \\in \\{0, \\dots, N_z-1\\}$. The geometric height $z$ at each grid point $(i,j)$ is determined by the mapping:\n$$\nz(x_i, \\sigma_j) = z_b(x_i) + \\sigma_j (z_\\mathrm{top} - z_b(x_i))\n$$\nwhere the terrain height $z_b(x)$ is given by a cosine hill with amplitude $A$:\n$$\nz_b(x_i) = A \\cos\\left( \\frac{2\\pi x_i}{L_x} \\right)\n$$\nUsing this grid of $z_{i,j}$ values, we sample the continuous pressure and density fields to obtain the discrete base state arrays $p_{i,j} = p(z_{i,j})$ and $\\rho_{i,j} = \\rho(z_{i,j})$.\n\nThe core of the task is to compute the maximum residual acceleration for two different PGF formulations.\n\n1.  **Naive, Non-Well-Balanced Formulation**\n    This method approximates the pressure gradient at constant $\\sigma$-levels. The partial derivative $(\\partial p / \\partial x)$ is approximated using a centered finite difference along the grid lines of constant $j$:\n    $$\n    a_{x,\\mathrm{naive}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\n    $$\n    The horizontal indices $i+1$ and $i-1$ are handled periodically. When the terrain is not flat ($A > 0$), a surface of constant $\\sigma_j$ is not a surface of constant geometric height $z$. Therefore, $z_{i+1,j} \\neq z_{i-1,j}$, leading to $p_{i+1,j} \\neq p_{i-1,j}$. This results in a non-zero, spurious PGF, which is a well-known source of error in terrain-following models. The residual is the maximum absolute value of this spurious acceleration over the entire grid: $R_\\mathrm{naive} = \\max_{i,j} |a_{x,\\mathrm{naive}}(i,j)|$.\n\n2.  **Well-Balanced, Height-Interpolated Formulation**\n    This method is designed to be \"well-balanced\", meaning it can exactly or with high accuracy balance the PGF and gravity terms to maintain a state of rest. It correctly approximates the PGF on a constant geometric height surface, $(\\partial p / \\partial x)_z$. To do this at a grid point $(i,j)$, we must estimate the pressures in the neighboring columns $i-1$ and $i+1$ at the same geometric height as the point $(i,j)$, which is $z_{i,j} = z(x_i, \\sigma_j)$.\n    The procedure is as follows:\n    -   For each grid point $(i,j)$, identify the target height $z_{i,j}$.\n    -   In the neighboring columns $i-1$ and $i+1$ (with periodic indexing), we have the discrete vertical profiles of pressure versus height, i.e., the sets of pairs $\\{ (z_{i-1,k}, p_{i-1,k}) \\}_{k=0}^{N_z-1}$ and $\\{ (z_{i+1,k}, p_{i+1,k}) \\}_{k=0}^{N_z-1}$.\n    -   We construct a linear interpolant for pressure as a function of height for each of these neighboring columns. Since the target height $z_{i,j}$ may lie outside the range of heights in a neighboring column (e.g., a point deep in a valley next to a high mountain), linear extrapolation is permitted as specified. We use SciPy's `interp1d` function with `fill_value='extrapolate'` for this purpose.\n    -   We evaluate these two interpolants at the target height $z_{i,j}$ to obtain the horizontally-mapped pressures, $p_{i-1 \\rightarrow i}(z_{i,j})$ and $p_{i+1 \\rightarrow i}(z_{i,j})$.\n    -   The well-balanced PGF is then computed as:\n    $$\n    a_{x,\\mathrm{wb}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1 \\rightarrow i}(z_{i,j}) - p_{i-1 \\rightarrow i}(z_{i,j})}{2\\Delta x}\n    $$\n    The residual error for this scheme, $R_\\mathrmwb = \\max_{i,j} |a_{x,\\mathrm{wb}}(i,j)|$, arises from the inaccuracy of the linear interpolation of the exponential pressure profile. This error is expected to be much smaller than the error of the naive scheme.\n\nFinally, for each test case, we compute the error-reduction factor $\\mathcal{Q}$:\n$$\n\\mathcal{Q} = \n\\begin{cases}\nR_\\mathrm{naive} / R_\\mathrm{wb}, & \\text{if } R_\\mathrm{wb} > 0,\\\\\n1.0, & \\text{if } R_\\mathrm{wb} = 0,\n\\end{cases}\n$$\nThis factor quantifies the improvement gained by using the well-balanced formulation. The entire procedure is implemented for the four specified test cases, and the results are formatted to six significant digits.",
            "answer": "```python\nimport numpy as np\nfrom scipy.interpolate import interp1d\n\ndef solve():\n    \"\"\"\n    Computes the residual pressure gradient force accelerations for naive and\n    well-balanced schemes in a terrain-following coordinate system.\n    \"\"\"\n\n    # Physical constants (SI units)\n    g = 9.81  # m/s^2\n    R_gas = 287.0  # J/(kg*K)\n    T = 280.0  # K\n    p0 = 1.0e5  # Pa\n    z_top = 12000.0  # m\n\n    # Derived constants\n    H = R_gas * T / g  # Pressure scale height\n    rho0 = p0 / (R_gas * T)  # Sea-level density\n\n    # Analytical hydrostatic profiles\n    def p_func(z):\n        return p0 * np.exp(-z / H)\n\n    def rho_func(z):\n        return rho0 * np.exp(-z / H)\n\n    # Test case parameters\n    test_cases = [\n        # (Lx, Nx, Nz, A)\n        (100000.0, 64, 40, 0.0),    # Case 1: Flat terrain\n        (100000.0, 64, 40, 1000.0), # Case 2: Moderate slope\n        (50000.0, 64, 20, 2000.0),  # Case 3: Steeper, coarser grid\n        (50000.0, 64, 80, 2000.0),  # Case 4: Steeper, finer grid\n    ]\n\n    all_results = []\n    \n    for Lx, Nx, Nz, A in test_cases:\n        # 1. Setup Grids\n        dx = Lx / Nx\n        x_i = np.arange(Nx) * dx\n        sigma_j = (np.arange(Nz) + 0.5) / Nz\n\n        # 2. Compute Geometric Heights z(x, sigma)\n        zb_i = A * np.cos(2 * np.pi * x_i / Lx)\n        # Reshape for broadcasting: zb_i (Nx,1), sigma_j (1,Nz)\n        z_grid = zb_i[:, np.newaxis] + sigma_j[np.newaxis, :] * (z_top - zb_i[:, np.newaxis])\n\n        # 3. Sample Hydrostatic State on the Grid\n        p_grid = p_func(z_grid)\n        rho_grid = rho_func(z_grid)\n\n        # 4. Compute Naive PGF Residual (R_naive)\n        p_i_plus_1 = np.roll(p_grid, -1, axis=0)\n        p_i_minus_1 = np.roll(p_grid, 1, axis=0)\n        \n        a_naive = - (1.0 / rho_grid) * (p_i_plus_1 - p_i_minus_1) / (2.0 * dx)\n        R_naive = np.max(np.abs(a_naive))\n\n        # 5. Compute Well-Balanced PGF Residual (R_wb)\n        a_wb = np.zeros_like(p_grid)\n        for i in range(Nx):\n            i_prev = (i - 1 + Nx) % Nx\n            i_next = (i + 1) % Nx\n            \n            # Get neighbor column profiles (z and p)\n            # z-profiles are guaranteed to be monotonic, so sorting is not needed.\n            z_prev_col = z_grid[i_prev, :]\n            p_prev_col = p_grid[i_prev, :]\n            z_next_col = z_grid[i_next, :]\n            p_next_col = p_grid[i_next, :]\n\n            # Create linear interpolators with linear extrapolation\n            interp_prev = interp1d(z_prev_col, p_prev_col, kind='linear', fill_value='extrapolate', assume_sorted=True)\n            interp_next = interp1d(z_next_col, p_next_col, kind='linear', fill_value='extrapolate', assume_sorted=True)\n            \n            for j in range(Nz):\n                z_target = z_grid[i, j]\n                \n                # Interpolate neighbor pressures to target height\n                p_interp_prev = interp_prev(z_target)\n                p_interp_next = interp_next(z_target)\n                \n                a_wb[i, j] = - (1.0 / rho_grid[i, j]) * (p_interp_next - p_interp_prev) / (2.0 * dx)\n\n        R_wb = np.max(np.abs(a_wb))\n\n        # 6. Compute Error Reduction Factor (Q)\n        if R_wb > 0:\n            Q = R_naive / R_wb\n        else:\n            Q = 1.0\n\n        all_results.extend([R_naive, R_wb, Q])\n\n    # 7. Format and print output\n    # Format each float to 6 significant digits as a string\n    formatted_results = [f\"{v:.6g}\" for v in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}