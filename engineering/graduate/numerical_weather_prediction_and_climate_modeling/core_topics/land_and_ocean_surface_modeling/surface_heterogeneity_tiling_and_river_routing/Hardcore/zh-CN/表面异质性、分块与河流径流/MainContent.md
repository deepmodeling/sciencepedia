## 引言
在现代[地球系统科学](@entry_id:175035)中，准确模拟陆地与大气之间的物质和能量交换，以及[全球水循环](@entry_id:189722)的闭合，是数值天气预报（NWP）和气候模型的基石。然而，这些模型在相对粗糙的网格上运行，无法直接解析地表覆盖、土壤类型和地形等在更小尺度上的复杂变异。这种次网格的非均匀性对水文和能量通量有着深刻的[非线性](@entry_id:637147)影响，若简单平均处理则会导致严重偏差。

为解决这一知识鸿沟，本文将深入剖析两种核心技术：表面非均匀性瓦片方案（surface heterogeneity tiling）和河流路径汇流（river routing）。我们将系统地阐明，这些方法如何让模型在保持[计算效率](@entry_id:270255)的同时，以物理上一致的方式捕捉次网格尺度的关键过程。

读者将通过本文学习到：在“原理与机制”一章，我们将探讨瓦片方法背后的非[线性原理](@entry_id:170988)、其状态变量和通量的计算与聚合机制，以及河流汇流模型从物理方程到概念性方法的演进；在“应用与跨学科联系”一章，我们将展示这些技术如何应用于城市化[影响评估](@entry_id:896910)、生态系统演替、[疾病生态学](@entry_id:203732)甚至药理学等多样化领域；最后，通过“动手实践”部分，读者将有机会将理论知识应用于解决具体的建模问题。

让我们首先进入第一部分，深入探索这些强大建模工具的核心科学原理与实现机制。

## 原理与机制

在上一章介绍的基础上，本章将深入探讨在[数值天气预报](@entry_id:191656)（NWP）和气候模型中用于表示陆面过程的两个关键组成部分——表面非均匀性瓦片方案（surface heterogeneity tiling）和河流路径汇流（river routing）——的核心科学原理与实现机制。我们将从基本概念出发，系统地阐述这些技术为何必要，它们如何工作，以及在实际应用中需要考虑的关键物理和数值问题。

### 表面非均匀性的瓦片方法

大气模型通常在数十到数百公里尺度的网格上进行计算。然而，在这样一个网格单元内部，下垫面（陆地表面）的特性可能表现出极大的[空间变异性](@entry_id:755146)，例如，森林、农田、城市和水体可能并存。这种**次网格非均匀性 (subgrid heterogeneity)** 对地气间的物质和能量交换有着深刻的[非线性](@entry_id:637147)影响。瓦片方法，或称“马赛克”方法，是解决这一挑战的主流策略。

#### 瓦片、网格单元与水文响应单元

在[陆面模型](@entry_id:1127054)中，**瓦片 (tile)** 的核心概念是指在一个大气网格单元内，代表一类特定且均质的陆面覆盖类型（如特定植被、土壤质地或土地利用类型）的次网格区域。每个大气网格单元被分割成若干个不重叠的瓦片，每个瓦片占据该网格的一定**面积分数 (area fraction)** $a_i$，且所有瓦片面积分数之和为1，即 $\sum_{i=1}^n a_i = 1$。

理解瓦片与相关概念的区别至关重要 ：
- **大气网格单元 (Atmospheric Grid Cell)**：这是大气模型的计算单元。模型在此尺度上提供统一的大气强迫（如降水、辐射），并需要陆面模型返回一个聚合的、代表整个网格单元平均响应的通量（如感热、潜热通量）。
- **陆面瓦片 (Land-Surface Tile)**：这是陆面模型的计算单元。它接收来自大气网格单元的强迫，并根据其自身的独特属性（如[反照率](@entry_id:188373)、粗糙度）和预报状态变量（如土壤湿度、地表温度）独立计算通量。
- **水文响应单元 (Hydrologic Response Unit, HRU)**：这是一个源于流域水文学的概念，通常由地形（如坡度、坡向）和土壤属性定义，代表水文响应行为相似的区域。HRU的边界由分水岭决定，不一定与大气模型的规则网格对齐。在与河流汇流模型耦合时，可能需要将来自不同网格或瓦片的径流重新映射到基于HRU或河网结构的汇流单元上。

瓦片方法的一个基本原则是**广延量 (extensive quantities)** 的守恒，如总水量或总能量。通量（如[蒸散](@entry_id:180694)发）通常以**强度量 (intensive quantities)** 的形式计算，即单位面积的通量（例如，$W\,m^{-2}$ 或 $mm\,day^{-1}$）。为了得到整个网格单元的总通量，我们必须将每个瓦片的强度量通量 $\mathcal{F}_i$ 乘以其物理面积（即网格总面积 $A$ 乘以瓦片面积分数 $a_i$），然后求和。提供给大气模型的有效网格平均通量 $\mathcal{F}_{\text{grid}}$ 则是这个总通量除以总面积 $A$：
$$
\mathcal{F}_{\text{grid}} = \frac{\sum_{i=1}^n (\mathcal{F}_i \cdot a_i A)}{A} = \sum_{i=1}^n a_i \mathcal{F}_i
$$
这种**面积加权聚合 (area-weighted aggregation)** 确保了在向上尺度传递信息的过程中，质量和能量是守恒的。

#### 状态平均的谬误：[非线性](@entry_id:637147)通量[参数化](@entry_id:265163)的必要性

为什么要采用计算上更昂贵的瓦片方法，而不是简单地先平均次网格的表面参数（如土壤湿度），然后用这个平均状态计算一个网格平均通量呢？答案在于地-气交换过程中普遍存在的**[非线性](@entry_id:637147) (non-linearity)**。

许多关键的陆面过程，如蒸散发和[径流生成](@entry_id:1131147)，都是状态变量（如土壤湿度）的强[非线性](@entry_id:637147)函数。对于这[类函数](@entry_id:146970)，**函数的平均值不等于平均值的函数**。这一原理在数学上由**[詹森不等式](@entry_id:144269) (Jensen's inequality)** 描述。如果一个函数 $F(x)$ 是[凸函数](@entry_id:143075)（其二阶导数非负），那么 $F(\overline{x}) \le \overline{F(x)}$。这意味着，使用平均状态计算出的通量会系统性地偏离（通常是偏低）真实通量的平均值。

我们通过两个例子来说明这一点：

1.  **蒸散发 (Evapotranspiration)**：植物的蒸腾作用通常在一个“凋萎点”($\theta_w$) 以下停止，并在“田间持水量”($\theta_{fc}$) 以上达到最大潜能。两者之间的响应通常是凸函数。假设[蒸散](@entry_id:180694)发通量 $E(\theta)$ 与一个与土壤湿度 $\theta$ 相关的胁迫因子 $s(\theta)$ 成正比，该因子在 $(\theta_w, \theta_{fc})$ 区间内形如 $(\frac{\theta - \theta_w}{\theta_{fc} - \theta_w})^\beta$，其中 $\beta > 1$。考虑一个由两个面积相等的瓦片组成的网格单元，一个极干 ($\theta_1 = \theta_w = 0.1$)，一个极湿 ($\theta_2 = \theta_{fc} = 0.4$) 。
    - 正确的方法（先计算通量，再平均）：干瓦片的[蒸散](@entry_id:180694)发 $E(\theta_1) = 0$，湿瓦片的[蒸散](@entry_id:180694)发达到最大值，如 $E(\theta_2) = 5 \, \text{mm day}^{-1}$。网格平均[蒸散](@entry_id:180694)发为 $\overline{E} = \frac{1}{2}(0+5) = 2.5 \, \text{mm day}^{-1}$。
    - 错误的方法（先平均状态，再计算通量）：平均土壤湿度为 $\overline{\theta} = \frac{1}{2}(0.1+0.4) = 0.25$。以此平均值计算出的通量 $E(\overline{\theta})$ 将远小于最大值（在该问题中为 $1.25 \, \text{mm day}^{-1}$），仅为正确计算值的一半。

2.  **[径流生成](@entry_id:1131147) (Runoff Generation)**：渗透过量径流只有在土壤湿度超过某个阈值 $S_c$ 时才会发生，并且其大小通常是超额湿度的[非线性](@entry_id:637147)（例如，二次方）函数，形如 $Q(S) = \alpha \max(0, S - S_c)^\beta$。这是一个典型的凸函数。考虑一个包含干、湿和极湿三个瓦片的网格，其中只有一个瓦片（$S_1 = 0.65$）的湿度低于径流阈值 $S_c=0.70$ 。
    - 正确的方法：只有湿度超过阈值的两个瓦片产生径流，其中最湿的瓦片贡献了大部分径流。将各瓦片的径流按面积加权平均，得到一个真实的网格平均径流量（在该问题中为 $0.90 \, \text{mm day}^{-1}$）。
    - 错误的方法：先计算网格平均土壤湿度 $\bar{S}$（在该问题中为 $0.74$），该值略高于阈值。用这个平均湿度计算出的径流量非常小（$0.16 \, \text{mm day}^{-1}$），严重低估了由次网格湿润区域贡献的真实径流。

这两个例子清楚地表明，忽略次网格非均匀性而直接使用平均[状态变量](@entry_id:138790)会导致对水文和能量通量的严重偏差。瓦片方法通过在更精细的尺度上（即瓦片尺度）计算[非线性](@entry_id:637147)过程，然后线性地聚合结果，从而正确地表达了次网格[异质性](@entry_id:275678)的整体效应。

### 瓦片方案的机制

理解了瓦片方法的必要性后，我们来探讨其具体的运作机制，即如何在每个瓦片上求解物理方程，以及如何将结果整合。

#### 单个瓦片的[水平衡](@entry_id:140465)与能量平衡

为了实现对每个瓦片 $i$ 的完整物理描述，[陆面模型](@entry_id:1127054)必须为之追踪一套独立的**预报[状态变量](@entry_id:138790) (prognostic state variables)** 并计算相关的**通量 (fluxes)**。一个功能完备的陆面模型，至少需要为每个瓦片定义以下分量以确保质量和能量守恒闭合 ：

- **水文[状态变量](@entry_id:138790)**：
    - $S_i$：土壤水储量（通常为多层）。
    - $C_i$：冠层截留水量。
    - $W_{s,i}$：[雪水当量](@entry_id:1131816)（积雪的水含量）。
    - $W_{p,i}$：地表洼蓄水量。

- **热力状态变量**：
    - $T_{g,i}$：地表/土壤温度（通常为多层）。
    - $T_{c,i}$：冠层温度。
    - $T_{s,i}$：积雪温度。

基于这些[状态变量](@entry_id:138790)，每个瓦片的时间演变由其自身的质量守恒和[能量守恒方程](@entry_id:748978)决定：

- **水量平衡方程**：
$$
\frac{d}{dt}(S_i + C_i + W_{s,i} + W_{p,i}) = (P_{r,i} + P_{s,i}) - (E_{c,i} + E_{g,i} + \text{Tr}_i) - (R_{\text{surf},i} + Q_{\text{sub},i})
$$
其中，输入项是液态 ($P_r$) 和固态 ($P_s$) 降水。输出项包括冠层蒸发 ($E_c$)、地表蒸发/[升华](@entry_id:139006) ($E_g$)、植被蒸腾 ($\text{Tr}$)，以及两种提供给汇流模型的径流：[地表径流](@entry_id:1132694) ($R_{\text{surf}}$) 和地下径流 ($Q_{\text{sub}}$)。

- **能量平衡方程**：
$$
\frac{dU_{total,i}}{dt} = R_{n,i} - H_i - LE_i - G_i
$$
其中 $U_{total,i}$ 是瓦片的总内能。能量的来源是净辐射 ($R_n$)，它被分配到感热通量 ($H$)、[潜热通量](@entry_id:1127093) ($LE$) 和地热通量 ($G$) 中。[潜热通量](@entry_id:1127093) $LE_i$ 直接与水循环耦合，因为它等于总[蒸散](@entry_id:180694)发量乘以汽化/[升华潜热](@entry_id:187184)。

#### 通量聚合与能量平衡闭合

在每个瓦片上独立求解了上述方程后，需要将计算出的通量聚合，以提供给大气模型一个单一的网格尺度值。

对于[反照率](@entry_id:188373)这类属性，最简单的聚合方式是线性混合。在忽略瓦片间相互作用的理想情况下，网格的有效[反照率](@entry_id:188373) $\alpha$ 就是各瓦片[反照率](@entry_id:188373) $\alpha_i$ 的面积加权平均 ：
$$
\alpha = \sum_{i=1}^{N} a_i \alpha_i
$$
同样，湍流通量（感热和潜热）也通过面积加权平均进行聚合。然而，在实际模型中，由于[参数化](@entry_id:265163)方案的简化和不确定性，每个瓦片上计算出的通量之和（$H_i + LE_i$）可能不等于该瓦片的[有效能](@entry_id:139794)量（$R_{n,i} - G_i$）。为了确保整个网格单元的总能量守恒，通常需要进行**能量平衡闭合 (energy balance closure)** 调整。

一种常见的闭合方法是，首先[计算网格](@entry_id:168560)平均的有效能量 $A_{\text{grid}} = \sum a_i (R_{n,i} - G_i)$ 和初始计算的网格平均总[湍流通量](@entry_id:1133513) $\sum a_i (H_i^{(0)} + \lambda E_i^{(0)})$。然后计算一个统一的校正因子 $c$，并将其应用于所有瓦片的湍流通量上 ：
$$
c = \frac{\sum a_i (R_{n,i} - G_i)}{\sum a_i (H_i^{(0)} + \lambda E_i^{(0)})}
$$
校正后的通量为 $H_i^{\text{(corr)}} = c \cdot H_i^{(0)}$ 和 $\lambda E_i^{\text{(corr)}} = c \cdot \lambda E_i^{(0)}$。这种方法在强制闭合网格能量平衡的同时，保持了每个瓦片上感热和潜热的[分配比](@entry_id:183708)例，即**波文比 (Bowen ratio)** $B_i = H_i / \lambda E_i$ 不变。最终，聚合后的校正通量 $\lambda E_{\text{grid}}^{\text{(corr)}} = \sum a_i \lambda E_i^{\text{(corr)}}$ 被传递给大气模型。

#### 高级主题：瓦片间辐射相互作用

上述简单的[反照率](@entry_id:188373)[线性混合模型](@entry_id:895469)基于一个关键假设：瓦片之间没有辐射相互作用。在现实世界中，尤其是在地表属性对比强烈的区域（如雪地旁的森林），这个假设会失效 。

当从一个瓦片（如明亮的雪地）反射的光子照射到相邻的另一个瓦片（如黑暗的森林）上时，就发生了**邻近效应 (adjacency effects)** 或三维（3D）辐射传输效应。这使得黑暗瓦片接收到的下行辐射不仅来自大气，还额外来自邻居的反射，从而改变了它的[能量收支](@entry_id:201027)和表观[反照率](@entry_id:188373)。这个过程引入了[非线性](@entry_id:637147)耦合，可以用一个耦合算子 $\mathbf{C}$ 来描述，其中元素 $C_{jk}$ 代表从瓦片 $k$ 出射的辐射被瓦片 $j$ 截获的比例。最终，网格的有效[反照率](@entry_id:188373)不再是简单的[线性组合](@entry_id:154743)，而是依赖于一个更复杂的、涉及[矩阵求逆](@entry_id:636005)的表达式，它同时考虑了各瓦片自身的[反照率](@entry_id:188373)及其空间排列。

这种耦合效应的强度取决于：
- **非均匀性的空间尺度**：当瓦片尺寸相对于大气中光子的平均自由程较小时，效应最强。
- **反射的各向异性 (BRDF)**：真实地表的非[朗伯反射](@entry_id:1127019)特性会影响能量的传输方向。
- **地形**：山谷等地形特征能通过多次反射“捕获”辐射，显著降低区域的有效[反照率](@entry_id:188373)。

### 河流路径汇流的原理与机制

陆面模型计算出的径流（地表和地下）并不会停留在原地，而是通过[地表径流](@entry_id:1132694)和[地下水流](@entry_id:1125820)进入河网系统，最终汇入海洋。河流路径汇流模型的作用就是模拟这一过程。

#### 从陆面到河流：径流耦合

汇流模型的第一步是将陆面模型产生的径流作为其输入。陆面模型在瓦片或网格尺度上产生径流，而汇流模型则在河网结构上运作。这两者之间的“胶水”是**径流耦合 (runoff coupling)** 模块。

这个模块利用高分辨率的地形数据，预先计算出每个陆面瓦片产生的径流有多少比例会流入特定的河段。假设瓦片 $i$ 产生的径流为 $Q_i$（单位 $\text{m}^3 \text{s}^{-1}$），而流入河段 $r$ 的比例为 $a_{ir}$（称为**排水权重 (drainage fraction)**），那么河段 $r$ 的总入流量 $I_r$ 就是所有瓦片对其贡献的总和 ：
$$
I_r = \sum_{i=1}^{N} a_{ir} Q_i
$$
这个[线性映射](@entry_id:185132)关系确保了从陆面传递到河网的水量是守恒的，因为对于每个瓦片 $i$，其全部径流都被分配到某个河段，即 $\sum_r a_{ir} = 1$。

#### 河流动力学的基础：[圣维南方程](@entry_id:1131187)及其近似

一旦径流进入河道，其在河网中的运动遵循[流体动力](@entry_id:750449)学原理，通常由**[圣维南方程](@entry_id:1131187) (Saint-Venant equations)** 描述。这是一对描述一维[明渠流](@entry_id:267863)的[偏微分](@entry_id:194612)方程，包括连续性方程（[质量守恒](@entry_id:204015)）和[动量方程](@entry_id:197225)。

- **连续性方程**:
$$
\frac{\partial A}{\partial t} + \frac{\partial q}{\partial x} = 0
$$

- **[动量方程](@entry_id:197225)**:
$$
\underbrace{\frac{\partial q}{\partial t}}_{\text{局地加速度}} + \underbrace{\frac{\partial}{\partial x} \left(\frac{q^2}{A}\right)}_{\text{对流加速度}} + \underbrace{gA \frac{\partial h}{\partial x}}_{\text{压力梯度}} = \underbrace{gA(S_0 - S_f)}_{\text{重力 - 摩擦}}
$$

其中 $A$ 是过水断面面积，$q$ 是流量，$h$ 是水面高程，$S_0$ 是河床坡度，$S_f$ 是摩擦坡度。求解完整的[圣维南方程](@entry_id:1131187)（也称**[动力波模型](@entry_id:1124078), dynamic wave model**）计算成本高昂，但在许多情况下，可以通过忽略动量方程中的某些项来简化，从而得到一系列近似模型 ：

1.  **[扩散波模型](@entry_id:1123723) (Diffusive Wave Model)**：当水流变化缓慢，惯性力（局地和[对流加速度](@entry_id:263153)项）远小于压力、重力和摩擦力时，可以忽略它们。动量方程简化为压力梯度、重力和摩擦力之间的平衡。该模型能模拟洪水[波的衰减](@entry_id:271778)过程。

2.  **[运动波模型](@entry_id:1126919) (Kinematic Wave Model)**：在坡度较陡的河流中，重力项远大于压力梯度项，因此可以进一步忽略压力梯度项。[动量方程](@entry_id:197225)简化为河床坡度与摩擦坡度之间的简单平衡，$S_0 = S_f$。这意味着流量 $q$ 是过水断面面积 $A$ 的单值函数，即 $q=q(A)$。该模型只能描述洪水波的平移，不能描述其变形。

在[地球系统模型](@entry_id:1124096)中，由于计算效率的要求，常采用[运动波](@entry_id:200331)或扩散波近似。这些模型捕捉了径流在大陆尺度上传输的主要特征，即传播时延。

#### 概念性汇流模型：马斯京根法

除了基于物理方程简化的模型外，还有许多**概念性汇流模型 (conceptual routing models)**，它们通过简化的数学关系来模拟河道演算过程。**马斯京根法 (Muskingum method)** 是其中最经典的一种。

该方法基于两个基本假设 ：
1.  **连续性方程**：河段的储水量变化率等于入流量减去出流量，$\frac{dS}{dt} = I - Q$。
2.  **线性储量关系**：河段储水量 $S$ 被假设为入流量 $I$ 和出流量 $Q$ 的[线性组合](@entry_id:154743)：
    $$
    S(t) = K \big[ X I(t) + (1-X) Q(t) \big]
    $$
    其中 $K$ 是一个具有时间量纲的**槽蓄系数**，与洪水波在河段中的传播时间有关；$X$ 是一个无量纲的**流量[比重](@entry_id:184864)因子**，反映了入流和出流对河段槽蓄的相对影响。

将这两个方程结合并进行[时间离散化](@entry_id:169380)（例如，使用梯形法则），可以得到一个关于下一时刻出流量 $Q^{n+1}$ 的显式[递推关系](@entry_id:189264)：
$$
Q^{n+1} = C_0 I^{n+1} + C_1 I^n + C_2 Q^n
$$
其中系数 $C_0, C_1, C_2$ 是 $K, X$ 和时间步长 $\Delta t$ 的函数。这个公式计算简单，能有效模拟洪水波的传播和衰减，因此在许多大规模水文模型中得到广泛应用。

### 汇流模型中的数值与实践问题

实现汇流模型不仅需要正确的物理和概念公式，还必须面对实际的数值计算挑战。

#### [数值稳定性](@entry_id:175146)：[CFL条件](@entry_id:178032)

许多汇流模型，特别是基于物理方程的显式差分格式，都受到**数值稳定性 (numerical stability)** 的约束。以最简单的显式[迎风格式](@entry_id:756378)求解线性平流方程 $\frac{\partial q}{\partial t} + u \frac{\partial q}{\partial x} = 0$ 为例，其数值解的稳定性要求必须满足**Courant–Friedrichs–Lewy (CFL) 条件** 。

该条件要求在一个时间步 $\Delta t$ 内，信息在物理上传播的距离（$u \Delta t$）不能超过其在数值网格上传播的距离（$\Delta x$）。这可以表示为：
$$
C = \frac{u \Delta t}{\Delta x} \le 1
$$
其中 $C$ 称为**库朗数 (Courant number)**。这意味着，为了维持计算稳定，时间步长必须足够小：
$$
\Delta t \le \frac{\Delta x}{u}
$$
在包含多个不同河段（具有不同长度 $\Delta x_i$ 和流速 $u_i$）的汇[流网络](@entry_id:262675)中，如果使用一个全局统一的时间步长，那么该步长必须满足所有河段中最严格的约束，即：
$$
\Delta t_{\text{global}} \le \min_{i} \left( \frac{\Delta x_i}{u_i} \right)
$$
流速最快、河段最短的区域（如山区小溪）通常是决定整个模型时间步长的瓶颈。

#### [模型验证](@entry_id:141140)：全网络质量守恒诊断

对于任何模拟物质输运的模型，**质量守恒 (mass conservation)** 是其正确性的首要保证。一个可靠的汇流模型必须确保在整个模拟过程中，总出流量与总入流量之差等于系统总储水量的变化。

从单个河段的[连续性方程](@entry_id:195013)出发，通过对整个河网的所有河段求和，可以证明所有内部交换通量 $F_{i \to j}$ 会相互抵消。因此，整个网络的质量平衡方程简化为 ：
$$
\frac{d}{dt} \sum_{j=1}^{J} S_j(t) = \sum_{j=1}^{J} I_j(t) - \sum_{j=1}^{J} Q_j(t)
$$
即总储水量的变化率等于总外部入流量减去总外部出流量。

在离散的数值模型中，我们可以设计一个**守恒诊断 (conservation diagnostic)** 来随时监控这一点。在任意时间步 $k$，我们可以计算一个**瞬时残差 (instantaneous residual)** $r_k$：
$$
r_k = \left( \sum_{j=1}^{J} I_j(t_k) - \sum_{j=1}^{J} Q_j(t_k) \right) - \frac{\sum_{j=1}^{J} S_j(t_{k+1}) - \sum_{j=1}^{J} S_j(t_k)}{\Delta t}
$$
在一个完美守恒的方案中，$r_k$ 应始终为零（在[机器精度](@entry_id:756332)范围内）。任何非零的残差都表示在该时间步内发生了质量的非物理性增加或减少。通过追踪模拟过程中的最大瞬时残差 $|r_k|$ 和累积总误差 $E_{\text{cum}} = \sum_k r_k \Delta t$，开发者和使用者可以定量地评估模型的守恒性能，确保其模拟结果的物理可靠性。