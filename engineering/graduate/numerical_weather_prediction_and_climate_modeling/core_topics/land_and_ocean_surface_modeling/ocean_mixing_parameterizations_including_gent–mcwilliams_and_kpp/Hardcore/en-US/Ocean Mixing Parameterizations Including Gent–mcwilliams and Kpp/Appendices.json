{
    "hands_on_practices": [
        {
            "introduction": "To build a solid understanding of ocean mixing parameterizations, we begin with the fundamental principle behind the K-Profile Parameterization (KPP). This exercise strips the problem down to a one-dimensional, steady-state scenario to clearly illustrate how enhanced mixing within the surface boundary layer impacts the vertical temperature structure. By deriving the temperature profile from first principles, you will directly quantify how an increased vertical diffusivity, representing turbulent mixing, allows the ocean to sustain a given surface heat flux with a significantly weaker, more realistic vertical temperature gradient .",
            "id": "4072900",
            "problem": "In a one-dimensional vertical ocean column of depth $H$ with vertical coordinate $z$ measured positive downward from the surface (so $z=0$ at the surface and $z=H$ at the bottom), consider temperature $T(z,t)$ evolving under vertical diffusion. Let the in situ seawater density be constant and equal to $\\rho_{0}$ and the specific heat capacity at constant pressure be $c_{p}$. A prescribed net surface heat flux $Q_{0}$ (taken positive downward into the ocean) is applied at $z=0$. Assume no internal sources or sinks of heat within the water column. At the bottom, the temperature is fixed at $T(H,t)=T_{b}$, where $T_{b}$ is a given constant.\n\nYou are to derive steady-state temperature profiles by starting only from (i) conservation of heat in a control volume and (ii) Fickian diffusive heat flux closure. Do not assume any target formulas a priori.\n\n(a) For a case with uniform background vertical diffusivity $K_{v}(z)=K_{bg}$ everywhere in the column, derive the steady-state temperature profile $T(z)$ consistent with the surface flux and the bottom boundary condition.\n\n(b) Now consider a K-Profile Parameterization (KPP)-like enhanced boundary layer mixing, modeled as a two-layer piecewise-constant diffusivity:\n$$\nK_{v}(z)=\n\\begin{cases}\nK_{bl},  0 \\le z \\le h_{b},\\\\\nK_{bg},  h_{b}  z \\le H,\n\\end{cases}\n$$\nwith $0h_{b}H$ and $K_{bl}K_{bg}$. Under the same surface flux $Q_{0}$ and bottom temperature $T_{b}$, derive the steady-state temperature profile $T(z)$, ensuring continuity of $T(z)$ at $z=h_{b}$ and consistency with a constant vertical diffusive heat flux.\n\n(c) Define the magnitude of the surface-layer temperature gradient in the enhanced-mixing case as $G_{bl}=|\\partial T/\\partial z|_{z=0^{+}}$ and in the uniform background case as $G_{bg}=|\\partial T/\\partial z|$ (constant in $z$) under the same $Q_{0}$. Derive the gradient-reduction factor\n$$\nR=\\frac{G_{bl}}{G_{bg}}\n$$\nin terms of $K_{bl}$ and $K_{bg}$. Express $R$ as a single closed-form analytic expression. This will be your final reported answer.\n\nYour derivations must begin from conservation of heat and the Fickian closure for vertical diffusive heat flux. In your reasoning, briefly interpret how enhanced boundary layer mixing (as in K-Profile Parameterization (KPP)) reduces near-surface vertical temperature gradients relative to the background case, and relate this physical effect to the role of adiabatic isopycnal stirring in the Gent–McWilliams parameterization. No numerical values are required, and no rounding is needed. The final answer to report is $R$ and should be dimensionless.",
            "solution": "The problem requires the derivation of steady-state temperature profiles in a one-dimensional vertical ocean column under different vertical diffusivity scenarios, starting from fundamental principles.\n\nFirst, we establish the governing equation for temperature $T(z,t)$ from the conservation of heat. Consider an infinitesimal control volume of horizontal area $A$ and thickness $dz$, located between depths $z$ and $z+dz$. The total heat content in this volume is $A \\cdot dz \\cdot \\rho_0 c_p T$. The rate of change of this heat content is given by:\n$$\n\\frac{d}{dt} (A \\cdot dz \\cdot \\rho_0 c_p T) = A \\rho_0 c_p \\frac{\\partial T}{\\partial t} dz\n$$\nThis change is caused by the net heat flux into the volume. Let $J(z,t)$ be the downward vertical heat flux (in units of W/m$^2$). The heat entering the top surface at $z$ is $A \\cdot J(z,t)$, and the heat leaving the bottom surface at $z+dz$ is $A \\cdot J(z+dz,t)$. With no internal sources or sinks, the net rate of heat gain is:\n$$\nA J(z,t) - A J(z+dz,t) \\approx -A \\frac{\\partial J}{\\partial z} dz\n$$\nEquating the rate of change of heat content to the net heat flux, we get:\n$$\nA \\rho_0 c_p \\frac{\\partial T}{\\partial t} dz = -A \\frac{\\partial J}{\\partial z} dz\n$$\n$$\n\\rho_0 c_p \\frac{\\partial T}{\\partial t} = -\\frac{\\partial J}{\\partial z}\n$$\nNext, we invoke the Fickian diffusive heat flux closure, which relates the flux to the temperature gradient. The flux $J$ is proportional to the negative of the temperature gradient:\n$$\nJ(z,t) = - \\rho_0 c_p K_v(z) \\frac{\\partial T}{\\partial z}\n$$\nHere, $K_v(z)$ is the vertical turbulent diffusivity. The constants $\\rho_0$ and $c_p$ convert the kinematic flux to a heat flux. The negative sign ensures that heat flows down the gradient (from warmer to colder regions).\nSubstituting the flux closure into the conservation equation yields the one-dimensional heat diffusion equation:\n$$\n\\rho_0 c_p \\frac{\\partial T}{\\partial t} = \\frac{\\partial}{\\partial z} \\left( \\rho_0 c_p K_v(z) \\frac{\\partial T}{\\partial z} \\right)\n$$\nSince $\\rho_0$ and $c_p$ are constants, they can be cancelled:\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{\\partial}{\\partial z} \\left( K_v(z) \\frac{\\partial T}{\\partial z} \\right)\n$$\nFor a steady-state solution, $\\frac{\\partial T}{\\partial t} = 0$, so the governing equation for the steady-state temperature profile $T(z)$ becomes:\n$$\n\\frac{d}{dz} \\left( K_v(z) \\frac{dT}{dz} \\right) = 0\n$$\nIntegrating this equation once with respect to $z$ gives:\n$$\nK_v(z) \\frac{dT}{dz} = C\n$$\nwhere $C$ is a constant of integration. We can relate this to the heat flux. From the Fickian closure, the steady-state flux is $J(z) = -\\rho_0 c_p K_v(z) \\frac{dT}{dz} = -\\rho_0 c_p C$. This implies that the vertical heat flux is constant with depth, which is expected in a steady state with no internal sources. This constant flux must be equal to the prescribed surface heat flux $Q_0$. Therefore, $J(z) = Q_0$ for all $z \\in [0, H]$.\nThis gives us the central working equation:\n$$\n-\\rho_0 c_p K_v(z) \\frac{dT}{dz} = Q_0 \\implies K_v(z) \\frac{dT}{dz} = -\\frac{Q_0}{\\rho_0 c_p}\n$$\n\n(a) Uniform background vertical diffusivity $K_v(z) = K_{bg}$\nFor this case, the governing equation is:\n$$\nK_{bg} \\frac{dT}{dz} = -\\frac{Q_0}{\\rho_0 c_p}\n$$\nThe temperature gradient is constant:\n$$\n\\frac{dT}{dz} = -\\frac{Q_0}{\\rho_0 c_p K_{bg}}\n$$\nIntegrating this with respect to $z$ yields the temperature profile:\n$$\nT(z) = -\\frac{Q_0}{\\rho_0 c_p K_{bg}} z + C_1\n$$\nwhere $C_1$ is an integration constant. We determine $C_1$ using the bottom boundary condition $T(H) = T_b$:\n$$\nT_b = -\\frac{Q_0 H}{\\rho_0 c_p K_{bg}} + C_1 \\implies C_1 = T_b + \\frac{Q_0 H}{\\rho_0 c_p K_{bg}}\n$$\nSubstituting $C_1$ back, the steady-state temperature profile is:\n$$\nT(z) = T_b + \\frac{Q_0 H}{\\rho_0 c_p K_{bg}} - \\frac{Q_0 z}{\\rho_0 c_p K_{bg}} = T_b + \\frac{Q_0}{\\rho_0 c_p K_{bg}}(H-z)\n$$\n\n(b) KPP-like two-layer diffusivity\nThe diffusivity is given by a piecewise function. We solve for the temperature profile in each layer and then match the solutions at the interface $z=h_b$. The downward heat flux $Q_0$ is constant throughout the entire column.\nFor the upper layer ($0 \\le z \\le h_b$), $K_v(z) = K_{bl}$. Let the temperature profile be $T_{upper}(z)$.\n$$\nK_{bl} \\frac{dT_{upper}}{dz} = -\\frac{Q_0}{\\rho_0 c_p} \\implies \\frac{dT_{upper}}{dz} = -\\frac{Q_0}{\\rho_0 c_p K_{bl}}\n$$\nIntegrating gives:\n$$\nT_{upper}(z) = -\\frac{Q_0}{\\rho_0 c_p K_{bl}} z + C_2\n$$\nFor the lower layer ($h_b  z \\le H$), $K_v(z) = K_{bg}$. Let the temperature profile be $T_{lower}(z)$.\n$$\nK_{bg} \\frac{dT_{lower}}{dz} = -\\frac{Q_0}{\\rho_0 c_p} \\implies \\frac{dT_{lower}}{dz} = -\\frac{Q_0}{\\rho_0 c_p K_{bg}}\n$$\nIntegrating gives:\n$$\nT_{lower}(z) = -\\frac{Q_0}{\\rho_0 c_p K_{bg}} z + C_3\n$$\nWe have two constants, $C_2$ and $C_3$, to determine from the boundary and matching conditions.\nFirst, apply the bottom boundary condition $T(H) = T_b$, which applies to the lower layer solution:\n$$\nT_{lower}(H) = T_b \\implies T_b = -\\frac{Q_0 H}{\\rho_0 c_p K_{bg}} + C_3 \\implies C_3 = T_b + \\frac{Q_0 H}{\\rho_0 c_p K_{bg}}\n$$\nThus, the solution in the lower layer is:\n$$\nT_{lower}(z) = T_b + \\frac{Q_0}{\\rho_0 c_p K_{bg}}(H-z)\n$$\nNext, apply the condition of temperature continuity at the interface $z=h_b$: $T_{upper}(h_b) = T_{lower}(h_b)$.\n$$\n-\\frac{Q_0 h_b}{\\rho_0 c_p K_{bl}} + C_2 = T_b + \\frac{Q_0}{\\rho_0 c_p K_{bg}}(H-h_b)\n$$\nSolving for $C_2$:\n$$\nC_2 = T_b + \\frac{Q_0(H-h_b)}{\\rho_0 c_p K_{bg}} + \\frac{Q_0 h_b}{\\rho_0 c_p K_{bl}} = T_b + \\frac{Q_0}{\\rho_0 c_p} \\left( \\frac{H-h_b}{K_{bg}} + \\frac{h_b}{K_{bl}} \\right)\n$$\nSubstituting $C_2$ back into the upper layer solution:\n$$\nT_{upper}(z) = T_b + \\frac{Q_0}{\\rho_0 c_p} \\left( \\frac{H-h_b}{K_{bg}} + \\frac{h_b}{K_{bl}} \\right) - \\frac{Q_0 z}{\\rho_0 c_p K_{bl}} = T_b + \\frac{Q_0}{\\rho_0 c_p} \\left( \\frac{H-h_b}{K_{bg}} + \\frac{h_b-z}{K_{bl}} \\right)\n$$\nThe complete steady-state temperature profile $T(z)$ is therefore:\n$$\nT(z) = \\begin{cases} T_b + \\frac{Q_0}{\\rho_0 c_p} \\left( \\frac{H-h_b}{K_{bg}} + \\frac{h_b-z}{K_{bl}} \\right),  0 \\le z \\le h_b \\\\ T_b + \\frac{Q_0}{\\rho_0 c_p K_{bg}}(H-z),  h_b  z \\le H \\end{cases}\n$$\nThe condition of a constant vertical heat flux is inherently satisfied by our derivation, as it led to a piecewise constant gradient.\n\n(c) Gradient-reduction factor\nFor the uniform background case (a), the temperature gradient is constant throughout the column:\n$$\n\\frac{dT}{dz} = -\\frac{Q_0}{\\rho_0 c_p K_{bg}}\n$$\nThe magnitude of this gradient is:\n$$\nG_{bg} = \\left| \\frac{dT}{dz} \\right| = \\frac{Q_0}{\\rho_0 c_p K_{bg}}\n$$\nWe assume $Q_0, \\rho_0, c_p, K_{bg}$ are all positive.\n\nFor the enhanced-mixing case (b), the surface-layer temperature gradient is the gradient in the upper layer, which is constant for $0 \\le z \\le h_b$:\n$$\n\\frac{dT}{dz} = -\\frac{Q_0}{\\rho_0 c_p K_{bl}}\n$$\nThe magnitude of the gradient at the surface ($z=0^+$) is:\n$$\nG_{bl} = \\left| \\frac{\\partial T}{\\partial z} \\right|_{z=0^+} = \\frac{Q_0}{\\rho_0 c_p K_{bl}}\n$$\n\nThe gradient-reduction factor $R$ is the ratio of these two gradient magnitudes:\n$$\nR = \\frac{G_{bl}}{G_{bg}} = \\frac{\\frac{Q_0}{\\rho_0 c_p K_{bl}}}{\\frac{Q_0}{\\rho_0 c_p K_{bg}}} = \\frac{K_{bg}}{K_{bl}}\n$$\nThis expression is dimensionless, as required.\n\nInterpretation: The K-Profile Parameterization (KPP) scheme is designed to represent the enhanced vertical mixing that occurs in the ocean's surface boundary layer due to wind stress and surface buoyancy forcing. Our simplified model captures this by setting $K_{bl}  K_{bg}$. The result $R = K_{bg}/K_{bl}$ shows that since $K_{bl}  K_{bg}$, we have $R  1$. This means the magnitude of the near-surface temperature gradient is reduced by the enhanced mixing. Physically, to sustain a fixed surface heat flux $Q_0$, a larger turbulent diffusivity $K_v$ allows for a smaller temperature gradient $|\\frac{dT}{dz}|$, as shown by the relation $| \\frac{dT}{dz} | = \\frac{Q_0}{\\rho_0 c_p K_v}$. Enhanced mixing is more efficient at transporting heat downward, thus homogenizing the surface layer and weakening the vertical temperature stratification.\n\nThis principle is conceptually analogous to the effect of the Gent–McWilliams (GM) parameterization. GM accounts for the adiabatic stirring by mesoscale eddies, which are not resolved in coarse-resolution climate models. This eddy-induced transport acts to flatten isopycnals (surfaces of constant density). For a tracer like temperature, this process is often parameterized as an additional \"thickness diffusion\" or an effective vertical mixing. Just like the enhanced boundary-layer mixing in KPP, the eddy-induced mixing in GM leads to a more efficient vertical transport of heat and other tracers in the ocean interior. This enhanced transport reduces the large-scale vertical gradients of these tracers, bringing the modeled stratification closer to what is observed in the real ocean. Therefore, both KPP and GM, despite representing different physical mixing processes at different scales, share the common effect of reducing mean vertical tracer gradients by parameterizing subgrid-scale transport.",
            "answer": "$$\n\\boxed{\\frac{K_{bg}}{K_{bl}}}\n$$"
        },
        {
            "introduction": "While KPP addresses vertical mixing, the Gent–McWilliams parameterization tackles the effect of unresolved mesoscale eddies, which primarily stir tracers along surfaces of constant density (isopycnals). This practice moves from the physical concept to the numerical implementation, guiding you through the construction of the isoneutral diffusion tensor that lies at the heart of the Gent–McWilliams/Redi scheme. You will see how the geometry of isopycnal slopes is translated into a mathematical operator and why properties like symmetry are critical for a stable and physically consistent numerical model .",
            "id": "4072895",
            "problem": "Consider isoneutral tracer diffusion in a stratified ocean represented on a $z$-level Arakawa C-grid, where tracer concentrations are defined at cell centers and fluxes are evaluated at cell faces. The isoneutral direction at a point is tangent to the surface with local normal proportional to $\\left(-r_{x},-r_{y},1\\right)$, where $r_{x}$ and $r_{y}$ are the neutral slopes in the $x$ and $y$ directions defined at cell centers. The physics of anisotropic diffusion states that diffusive flux acts to remove only the component of the tracer gradient tangent to the isoneutral surface, i.e., the normal component is removed by projecting the gradient onto the tangent plane. In the two-dimensional $x$–$z$ slice (ignore $y$), the local neutral slope reduces to a scalar $r \\equiv r_{x}$, and the isoneutral diffusion tensor at a cell center is determined by this projection principle together with a locally isotropic isoneutral diffusivity $K$.\n\nYou are given two adjacent tracer cells sharing an east face. In the left cell, the isoneutral diffusivity and neutral slope are $K_{L}$ and $r_{L}$; in the right cell, they are $K_{R}$ and $r_{R}$. To maintain monotonic slopes and avoid excessive cross-isoneutral mixing in the discrete operator, each cell’s slope is tapered by $r^{\\star} = T(r)\\,r$ with $T(r) = \\min\\left(1, r_{\\max}/|r|\\right)$ and prescribed $r_{\\max}  0$. The east-face diffusion tensor is constructed as the arithmetic mean of the two tapered cell-center tensors. This face-averaging choice is required to maintain a symmetric discrete operator on the C-grid. \n\nTasks:\n1. Starting from the projection principle described above, derive the $2\\times 2$ isoneutral diffusion tensor at a cell center in the $x$–$z$ plane in terms of $K$ and the tapered slope $r^{\\star}$. Show that it is symmetric and positive semidefinite for any real $r^{\\star}$ and $K \\ge 0$. \n2. Using the requirement that face tensors be symmetric means of neighboring cell tensors on a C-grid, write down the east-face tensor components explicitly in terms of $\\left(K_{L}, r_{L}^{\\star}\\right)$ and $\\left(K_{R}, r_{R}^{\\star}\\right)$. \n3. With the numerical values $K_{L} = 1.5 \\times 10^{3}$, $K_{R} = 2.0 \\times 10^{3}$, $r_{L} = 2.0 \\times 10^{-2}$, $r_{R} = -3.0 \\times 10^{-2}$, and $r_{\\max} = 5.0 \\times 10^{-2}$, compute the east-face off-diagonal coefficient $A^{e}_{xz}$ of the discrete Redi tensor. Express your final answer in $\\mathrm{m^{2}\\,s^{-1}}$ and round your answer to four significant figures.\n\nYour final answer must be the single numerical value of $A^{e}_{xz}$.",
            "solution": "The solution proceeds in three parts as requested by the problem statement.\n\n### Part 1: Cell-Center Isoneutral Diffusion Tensor\n\nThe problem states that in a two-dimensional $x$–$z$ slice, the isoneutral direction is tangent to a surface whose normal vector $\\mathbf{n}$ is proportional to $(-r, 1)$, where $r$ is the isoneutral slope. Let the tracer concentration be $C$. Its gradient in the $x$–$z$ plane is $\\nabla C = \\begin{pmatrix} \\partial_x C \\\\ \\partial_z C \\end{pmatrix}$.\n\nThe normalized normal vector, using the tapered slope $r^\\star$, is:\n$$ \\hat{\\mathbf{n}} = \\frac{1}{\\sqrt{1 + (r^\\star)^2}} \\begin{pmatrix} -r^\\star \\\\ 1 \\end{pmatrix} $$\nThe diffusion acts only along the isoneutral surface. This is achieved by using the component of the tracer gradient projected onto the isoneutral tangent plane. The projection tensor $\\mathbf{P}$ that projects a vector onto this plane is given by $\\mathbf{P} = \\mathbf{I} - \\hat{\\mathbf{n}} \\otimes \\hat{\\mathbf{n}}$, where $\\mathbf{I}$ is the $2 \\times 2$ identity tensor and $\\otimes$ denotes the outer product.\n\nLet's compute the outer product $\\hat{\\mathbf{n}} \\otimes \\hat{\\mathbf{n}}$:\n$$ \\hat{\\mathbf{n}} \\otimes \\hat{\\mathbf{n}} = \\frac{1}{1 + (r^\\star)^2} \\begin{pmatrix} -r^\\star \\\\ 1 \\end{pmatrix} \\begin{pmatrix} -r^\\star  1 \\end{pmatrix} = \\frac{1}{1 + (r^\\star)^2} \\begin{pmatrix} (r^\\star)^2  -r^\\star \\\\ -r^\\star  1 \\end{pmatrix} $$\nThe projection tensor $\\mathbf{P}$ is then:\n$$ \\mathbf{P} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\frac{1}{1 + (r^\\star)^2} \\begin{pmatrix} (r^\\star)^2  -r^\\star \\\\ -r^\\star  1 \\end{pmatrix} = \\frac{1}{1 + (r^\\star)^2} \\left[ \\begin{pmatrix} 1 + (r^\\star)^2  0 \\\\ 0  1 + (r^\\star)^2 \\end{pmatrix} - \\begin{pmatrix} (r^\\star)^2  -r^\\star \\\\ -r^\\star  1 \\end{pmatrix} \\right] $$\n$$ \\mathbf{P} = \\frac{1}{1 + (r^\\star)^2} \\begin{pmatrix} 1  r^\\star \\\\ r^\\star  (r^\\star)^2 \\end{pmatrix} $$\nThe diffusive flux $\\mathbf{F}$ is given by Fick's law, with the diffusion acting along the isoneutral plane with an isotropic diffusivity $K$.\n$$ \\mathbf{F} = -K (\\mathbf{P} \\nabla C) $$\nThe general form of the flux law is $\\mathbf{F} = -\\mathbf{A} \\nabla C$, where $\\mathbf{A}$ is the diffusion tensor. By comparison, we identify the isoneutral diffusion tensor at a cell center as:\n$$ \\mathbf{A} = K \\mathbf{P} = \\frac{K}{1 + (r^\\star)^2} \\begin{pmatrix} 1  r^\\star \\\\ r^\\star  (r^\\star)^2 \\end{pmatrix} $$\nThe components of the tensor are:\n$A_{xx} = \\frac{K}{1 + (r^\\star)^2}$\n$A_{xz} = \\frac{K r^\\star}{1 + (r^\\star)^2}$\n$A_{zx} = \\frac{K r^\\star}{1 + (r^\\star)^2}$\n$A_{zz} = \\frac{K (r^\\star)^2}{1 + (r^\\star)^2}$\n\nNow, we must show that this tensor is symmetric and positive semidefinite for any real $r^\\star$ and $K \\ge 0$.\n\n**Symmetry:**\nBy inspection, $A_{xz} = A_{zx}$, so the tensor $\\mathbf{A}$ is symmetric.\n\n**Positive Semidefiniteness:**\nA symmetric matrix is positive semidefinite if all its eigenvalues are non-negative. We find the eigenvalues $\\lambda$ by solving the characteristic equation $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$.\n$$ \\det \\begin{pmatrix} \\frac{K}{1+(r^\\star)^2} - \\lambda  \\frac{K r^\\star}{1+(r^\\star)^2} \\\\ \\frac{K r^\\star}{1+(r^\\star)^2}  \\frac{K (r^\\star)^2}{1+(r^\\star)^2} - \\lambda \\end{pmatrix} = 0 $$\n$$ \\left( \\frac{K}{1+(r^\\star)^2} - \\lambda \\right) \\left( \\frac{K (r^\\star)^2}{1+(r^\\star)^2} - \\lambda \\right) - \\left( \\frac{K r^\\star}{1+(r^\\star)^2} \\right)^2 = 0 $$\nExpanding the terms:\n$$ \\frac{K^2 (r^\\star)^2}{(1+(r^\\star)^2)^2} - \\lambda \\left( \\frac{K}{1+(r^\\star)^2} + \\frac{K (r^\\star)^2}{1+(r^\\star)^2} \\right) + \\lambda^2 - \\frac{K^2 (r^\\star)^2}{(1+(r^\\star)^2)^2} = 0 $$\n$$ \\lambda^2 - \\lambda \\frac{K(1+(r^\\star)^2)}{1+(r^\\star)^2} = 0 $$\n$$ \\lambda^2 - K \\lambda = 0 \\implies \\lambda(\\lambda - K) = 0 $$\nThe eigenvalues are $\\lambda_1 = 0$ and $\\lambda_2 = K$. Since it is given that $K \\ge 0$, both eigenvalues are non-negative. Therefore, the tensor $\\mathbf{A}$ is positive semidefinite.\n\n### Part 2: East-Face Diffusion Tensor\n\nThe diffusion tensors for the left (L) and right (R) cells are given by the formula derived in Part 1, using their respective parameters $(K_L, r_L^\\star)$ and $(K_R, r_R^\\star)$.\n$$ \\mathbf{A}_L = \\frac{K_L}{1+(r_L^\\star)^2} \\begin{pmatrix} 1  r_L^\\star \\\\ r_L^\\star  (r_L^\\star)^2 \\end{pmatrix} $$\n$$ \\mathbf{A}_R = \\frac{K_R}{1+(r_R^\\star)^2} \\begin{pmatrix} 1  r_R^\\star \\\\ r_R^\\star  (r_R^\\star)^2 \\end{pmatrix} $$\nThe diffusion tensor at the east face, $\\mathbf{A}^e$, is the arithmetic mean of the two cell-center tensors:\n$$ \\mathbf{A}^e = \\frac{1}{2} (\\mathbf{A}_L + \\mathbf{A}_R) $$\nThe components of $\\mathbf{A}^e = \\begin{pmatrix} A^e_{xx}  A^e_{xz} \\\\ A^e_{zx}  A^e_{zz} \\end{pmatrix}$ are explicitly:\n$$ A^e_{xx} = \\frac{1}{2} \\left( \\frac{K_L}{1+(r_L^\\star)^2} + \\frac{K_R}{1+(r_R^\\star)^2} \\right) $$\n$$ A^e_{xz} = \\frac{1}{2} \\left( \\frac{K_L r_L^\\star}{1+(r_L^\\star)^2} + \\frac{K_R r_R^\\star}{1+(r_R^\\star)^2} \\right) $$\n$$ A^e_{zx} = A^e_{xz} $$\n$$ A^e_{zz} = \\frac{1}{2} \\left( \\frac{K_L (r_L^\\star)^2}{1+(r_L^\\star)^2} + \\frac{K_R (r_R^\\star)^2}{1+(r_R^\\star)^2} \\right) $$\n\n### Part 3: Numerical Calculation of $A^e_{xz}$\n\nWe are given the following numerical values:\n$K_L = 1.5 \\times 10^3 \\, \\mathrm{m^2\\,s^{-1}}$\n$K_R = 2.0 \\times 10^3 \\, \\mathrm{m^2\\,s^{-1}}$\n$r_L = 2.0 \\times 10^{-2}$\n$r_R = -3.0 \\times 10^{-2}$\n$r_{\\max} = 5.0 \\times 10^{-2}$\n\nFirst, we must compute the tapered slopes $r_L^\\star$ and $r_R^\\star$ using the rule $r^\\star = \\min(1, r_{\\max}/|r|) \\cdot r$.\n\nFor the left cell:\n$|r_L| = |2.0 \\times 10^{-2}| = 0.02$.\nThe ratio $r_{\\max}/|r_L| = (5.0 \\times 10^{-2}) / (2.0 \\times 10^{-2}) = 2.5$.\nThe tapering factor is $T(r_L) = \\min(1, 2.5) = 1$.\nThus, $r_L^\\star = 1 \\cdot r_L = 2.0 \\times 10^{-2}$.\n\nFor the right cell:\n$|r_R| = |-3.0 \\times 10^{-2}| = 0.03$.\nThe ratio $r_{\\max}/|r_R| = (5.0 \\times 10^{-2}) / (3.0 \\times 10^{-2}) = 5/3 \\approx 1.67$.\nThe tapering factor is $T(r_R) = \\min(1, 5/3) = 1$.\nThus, $r_R^\\star = 1 \\cdot r_R = -3.0 \\times 10^{-2}$.\n\nNow we substitute these values into the expression for $A^e_{xz}$:\n$$ A^e_{xz} = \\frac{1}{2} \\left( \\frac{K_L r_L^\\star}{1+(r_L^\\star)^2} + \\frac{K_R r_R^\\star}{1+(r_R^\\star)^2} \\right) $$\nWith $K_L = 1500$, $r_L^\\star = 0.02$, $K_R = 2000$, and $r_R^\\star = -0.03$:\n$$ A^e_{xz} = \\frac{1}{2} \\left( \\frac{1500 \\cdot (0.02)}{1+(0.02)^2} + \\frac{2000 \\cdot (-0.03)}{1+(-0.03)^2} \\right) $$\n$$ A^e_{xz} = \\frac{1}{2} \\left( \\frac{30}{1+0.0004} + \\frac{-60}{1+0.0009} \\right) $$\n$$ A^e_{xz} = \\frac{1}{2} \\left( \\frac{30}{1.0004} - \\frac{60}{1.0009} \\right) $$\nCalculating the values of the fractions:\n$$ \\frac{30}{1.0004} \\approx 29.9880048 $$\n$$ \\frac{60}{1.0009} \\approx 59.9460486 $$\n$$ A^e_{xz} \\approx \\frac{1}{2} (29.9880048 - 59.9460486) = \\frac{1}{2} (-29.9580438) $$\n$$ A^e_{xz} \\approx -14.9790219 \\, \\mathrm{m^2\\,s^{-1}} $$\nRounding the result to four significant figures gives:\n$$ A^e_{xz} = -14.98 \\, \\mathrm{m^2\\,s^{-1}} $$\nThe units are correct as $K$ is in $\\mathrm{m^2\\,s^{-1}}$ and the slope $r$ is dimensionless.",
            "answer": "$$\\boxed{-14.98}$$"
        },
        {
            "introduction": "Our final practice returns to the vertical diffusion central to schemes like KPP, but now we focus on the challenges of its numerical implementation. This exercise explores how the continuous diffusion equation is discretized and solved over time, revealing the critical trade-offs between computational stability, accuracy, and efficiency. By deriving the stability condition for a semi-implicit scheme, you will gain practical insight into how numerical choices, such as the time step $\\Delta t$, are constrained by the physical parameters of the system, like the maximum diffusivity .",
            "id": "4072907",
            "problem": "Consider one-dimensional vertical diffusion of a passive tracer $T(z,t)$ in an ocean column of depth $H$ used in large-scale numerical weather prediction and climate modeling. The vertical turbulent diffusivity $K_{v}(z)$ represents diapycnal mixing and follows the K-Profile Parameterization (KPP) in the surface boundary layer, while large-scale eddy stirring is represented through the Gent–McWilliams parameterization elsewhere; here, we focus solely on the vertical (diapycnal) diffusion component. The governing equation is the conservation of tracer under Fickian diffusion,\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{\\partial}{\\partial z}\\left(K_{v}(z)\\,\\frac{\\partial T}{\\partial z}\\right)\n$$\nwith zero-flux (Neumann) boundary conditions $\\frac{\\partial T}{\\partial z}=0$ at $z=0$ (surface) and $z=H$ (bottom). Let the vertical coordinate $z$ increase downward.\n\nDiscretize the column on a uniform grid $z_{i}=i\\,\\Delta z$ for $i=0,1,\\dots,N$ with spacing $\\Delta z=H/N$. Denote $T_{i}^{n}\\approx T(z_{i},t^{n})$ and approximate interface diffusivities by arithmetic averages $K_{i+\\frac{1}{2}}=\\frac{1}{2}(K_{i}+K_{i+1})$. Consider the semi-implicit one-parameter $\\theta$-scheme:\n$$\n\\frac{T_{i}^{n+1}-T_{i}^{n}}{\\Delta t} = \\theta\\,\\mathcal{L}\\!\\left[T^{n+1}\\right]_{i} + (1-\\theta)\\,\\mathcal{L}\\!\\left[T^{n}\\right]_{i}\n$$\nwhere the discrete diffusion operator is\n$$\n\\mathcal{L}\\!\\left[T\\right]_{i} = \\frac{1}{\\Delta z^{2}}\\left[\\,K_{i+\\frac{1}{2}}\\left(T_{i+1}-T_{i}\\right) - K_{i-\\frac{1}{2}}\\left(T_{i}-T_{i-1}\\right)\\,\\right]\n$$\nfor interior indices $i=1,\\dots,N-1$, with the boundary conditions enforced consistently by zero-flux.\n\nTask:\n1. Derive the tridiagonal linear system for the unknowns $\\{T_{i}^{n+1}\\}_{i=0}^{N}$, writing the interior row $i$ in the form $a_{i}\\,T_{i-1}^{n+1}+b_{i}\\,T_{i}^{n+1}+c_{i}\\,T_{i+1}^{n+1}=r_{i}$, and give $a_{i}$, $b_{i}$, $c_{i}$, and $r_{i}$ explicitly in terms of $\\theta$, $\\Delta t$, $\\Delta z$, $K_{i\\pm\\frac{1}{2}}$ and $T^{n}$. State the sign pattern of the coefficients and the row sum property needed for an $M$-matrix.\n2. Using first principles (mass conservation and the discrete form of Fickian diffusion), provide sufficient conditions under which the coefficient matrix is strictly diagonally dominant and an $M$-matrix (with positive diagonal and nonpositive off-diagonals), and then derive a sufficient bound on $\\Delta t$ that ensures monotonicity preservation of the update $T^{n}\\mapsto T^{n+1}$ for $\\theta\\in[1/2,1]$.\n3. Let the diffusivity follow a K-Profile Parameterization (KPP)-like vertical structure: in the surface boundary layer of depth $h=50\\,\\text{m}$, $K_{v}(z)=K_{0}$ is constant, and below it transitions to the background value $K_{b}$ exponentially,\n$$\nK_{v}(z) = \\begin{cases}\nK_{0},  0 \\le z \\le h \\\\\nK_{b} + (K_{0}-K_{b})\\,\\exp\\!\\left(-\\frac{z-h}{z_{*}}\\right),  zh\n\\end{cases}\n$$\nwith $K_{0}=1.0\\times 10^{-2}\\,\\text{m}^{2}\\,\\text{s}^{-1}$, $K_{b}=1.0\\times 10^{-5}\\,\\text{m}^{2}\\,\\text{s}^{-1}$, and $z_{*}=200\\,\\text{m}$. Consider a column of depth $H=1000\\,\\text{m}$, uniform grid spacing $\\Delta z=10\\,\\text{m}$, and choose $\\theta=0.7$. Using your sufficient condition, compute the maximum allowable time step $\\Delta t_{\\max}$ that guarantees diagonal dominance and monotonicity preservation for this semi-implicit scheme. Express $\\Delta t_{\\max}$ in seconds and round your answer to four significant figures.",
            "solution": "### Task 1: Derivation of the Tridiagonal System\n\nThe semi-implicit scheme is given by:\n$$ \\frac{T_{i}^{n+1}-T_{i}^{n}}{\\Delta t} = \\theta\\,\\mathcal{L}[T^{n+1}]_{i} + (1-\\theta)\\,\\mathcal{L}[T^{n}]_{i} $$\nTo obtain the linear system for the unknown vector $T^{n+1}$, we rearrange the equation to place all terms involving $T^{n+1}$ on the left-hand side (LHS) and all known terms (involving $T^n$) on the right-hand side (RHS).\n$$ T_{i}^{n+1} - \\theta\\,\\Delta t\\,\\mathcal{L}[T^{n+1}]_{i} = T_{i}^{n} + (1-\\theta)\\,\\Delta t\\,\\mathcal{L}[T^{n}]_{i} $$\nLet's substitute the definition of the discrete operator $\\mathcal{L}[\\cdot]_{i}$:\n$$ T_{i}^{n+1} - \\theta\\,\\frac{\\Delta t}{\\Delta z^2} \\left[ K_{i+\\frac{1}{2}}(T_{i+1}^{n+1}-T_{i}^{n+1}) - K_{i-\\frac{1}{2}}(T_{i}^{n+1}-T_{i-1}^{n+1}) \\right] = \\text{RHS} $$\nGrouping the terms on the LHS by their spatial index gives:\n$$ \\left( -\\theta\\,\\frac{\\Delta t}{\\Delta z^2} K_{i-\\frac{1}{2}} \\right) T_{i-1}^{n+1} + \\left( 1 + \\theta\\,\\frac{\\Delta t}{\\Delta z^2} (K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}}) \\right) T_{i}^{n+1} + \\left( -\\theta\\,\\frac{\\Delta t}{\\Delta z^2} K_{i+\\frac{1}{2}} \\right) T_{i+1}^{n+1} = \\text{RHS} $$\nThis equation is in the desired form $a_{i}\\,T_{i-1}^{n+1}+b_{i}\\,T_{i}^{n+1}+c_{i}\\,T_{i+1}^{n+1}=r_{i}$. The coefficients for the interior grid points ($i=1, \\dots, N-1$) are:\n- $a_{i} = -\\theta\\,\\frac{\\Delta t}{\\Delta z^2}\\,K_{i-\\frac{1}{2}}$\n- $b_{i} = 1 + \\theta\\,\\frac{\\Delta t}{\\Delta z^2}\\,(K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}})$\n- $c_{i} = -\\theta\\,\\frac{\\Delta t}{\\Delta z^2}\\,K_{i+\\frac{1}{2}}$\nThe right-hand side, $r_i$, consists of all terms evaluated at time step $n$:\n- $r_{i} = T_{i}^{n} + (1-\\theta)\\,\\Delta t\\,\\mathcal{L}[T^{n}]_{i} = T_{i}^{n} + (1-\\theta)\\frac{\\Delta t}{\\Delta z^2}\\left[ K_{i+\\frac{1}{2}}(T_{i+1}^{n}-T_{i}^{n}) - K_{i-\\frac{1}{2}}(T_{i}^{n}-T_{i-1}^{n}) \\right]$\n\nThe zero-flux boundary conditions are enforced by setting the flux across the physical boundaries to zero. This is equivalent to setting $K_{-1/2}=0$ at the surface ($i=0$) and $K_{N+1/2}=0$ at the bottom ($i=N$).\n\nFor the coefficient matrix of the LHS to be an M-matrix, it must be a Z-matrix (non-positive off-diagonal elements, $a_i \\le 0, c_i \\le 0$) with positive diagonal elements ($b_i > 0$).\n- **Sign Pattern**: Since diffusivity $K_v(z)0$, we have $K_{i\\pm\\frac{1}{2}}0$. Given $\\theta0$ and $\\Delta t0$, the signs of the coefficients are:\n  - $a_i  0$\n  - $c_i  0$\n  - $b_i = 1 + (\\text{positive term})  1  0$\n  This corresponds to the required sign pattern for an M-matrix (positive diagonal, non-positive off-diagonals).\n\n- **Row Sum Property**: A sufficient condition for a Z-matrix to be an M-matrix is strict diagonal dominance. This property is related to the row sum of the matrix. For an interior row $i$, the sum of coefficients is:\n  $$ a_i + b_i + c_i = \\left(-\\theta\\,\\frac{\\Delta t}{\\Delta z^2}\\,K_{i-\\frac{1}{2}}\\right) + \\left(1 + \\theta\\,\\frac{\\Delta t}{\\Delta z^2}\\,(K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}})\\right) + \\left(-\\theta\\,\\frac{\\Delta t}{\\Delta z^2}\\,K_{i+\\frac{1}{2}}\\right) = 1 $$\n  Since the row sum is $1  0$, and the off-diagonal elements $a_i, c_i$ are negative, we have $b_i = 1-a_i-c_i = 1+|a_i|+|c_i|  |a_i|+|c_i|$. Thus, the matrix is strictly diagonally dominant. Similar analysis at the boundaries ($i=0, N$) also yields a row sum of $1$.\n\n### Task 2: Monotonicity Conditions and Time Step Bound\n\nThe linear system can be written in matrix form as $A\\,T^{n+1} = B\\,T^n$, where $A = I - \\theta\\,\\Delta t\\,\\mathcal{L}$ and $B = I + (1-\\theta)\\,\\Delta t\\,\\mathcal{L}$. The solution update is $T^{n+1} = A^{-1}B\\,T^n$.\n\nA sufficient condition for the coefficient matrix $A$ to be a strictly diagonally dominant M-matrix is that it is a Z-matrix and it is strictly diagonally dominant. As established in Task 1, for any $\\theta > 0$ and $\\Delta t > 0$, and given $K_v(z) > 0$, matrix $A$ has positive diagonal elements and non-positive off-diagonal elements, and it is strictly diagonally dominant. Therefore, $A$ is an M-matrix under the very general condition that $\\theta > 0$, and no upper bound on $\\Delta t$ is required for this property. A key property of M-matrices is that their inverse, $A^{-1}$, has all non-negative entries, i.e., $A^{-1} \\ge 0$.\n\nFor monotonicity preservation, which ensures that no new extrema are created (e.g., if $T^n \\ge 0$, then $T^{n+1} \\ge 0$), the update matrix $A^{-1}B$ must have all non-negative entries. Since we have already established $A^{-1} \\ge 0$, a sufficient condition for monotonicity is that the matrix $B$ also has all non-negative entries ($B \\ge 0$).\n\nThe matrix $B$ has entries derived from the expression for $r_i$:\n$r_i = \\underbrace{\\left((1-\\theta)\\frac{\\Delta t}{\\Delta z^2} K_{i-\\frac{1}{2}}\\right)}_{B_{i, i-1}} T_{i-1}^{n} + \\underbrace{\\left(1-(1-\\theta)\\frac{\\Delta t}{\\Delta z^2}(K_{i+\\frac{1}{2}}+K_{i-\\frac{1}{2}})\\right)}_{B_{i, i}} T_{i}^{n} + \\underbrace{\\left((1-\\theta)\\frac{\\Delta t}{\\Delta z^2} K_{i+\\frac{1}{2}}\\right)}_{B_{i, i+1}} T_{i+1}^{n}$.\n\n- **Off-diagonal elements:** $B_{i, j}$ for $j \\ne i$. These are of the form $(1-\\theta)\\frac{\\Delta t}{\\Delta z^2} K_{k}$. Since $K_k0$, $\\Delta t0$, $\\Delta z^20$, these elements are non-negative if and only if $1-\\theta \\ge 0$, i.e., $\\theta \\le 1$.\n\n- **Diagonal elements:** $B_{i, i}$. We require $B_{i,i} \\ge 0$. This leads to the condition:\n$$ 1 - (1-\\theta)\\frac{\\Delta t}{\\Delta z^2}(K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}}) \\ge 0 $$\nThis must hold for all interior points $i=1, \\dots, N-1$. For the boundary points $i=0$ and $i=N$, the respective conditions are $1 - (1-\\theta)\\frac{\\Delta t}{\\Delta z^2}K_{1/2} \\ge 0$ and $1 - (1-\\theta)\\frac{\\Delta t}{\\Delta z^2}K_{N-1/2} \\ge 0$. Since $K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}}  K_{1/2}$ (for $i=1$), the condition for interior points is more restrictive than for the boundaries.\n\nFor $\\theta \\in [1/2, 1)$, we can rearrange the inequality to find a bound on $\\Delta t$:\n$$ \\Delta t \\le \\frac{\\Delta z^2}{(1-\\theta)(K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}})} $$\nThis must hold for all $i$. Therefore, we must satisfy the most restrictive case, which corresponds to the maximum value of the denominator term:\n$$ \\Delta t \\le \\frac{\\Delta z^2}{(1-\\theta)\\,\\max_{i=1,\\dots,N-1}(K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}})} $$\nIf $\\theta=1$, the scheme is fully implicit. Then $1-\\theta=0$, so $B=I$ (the identity matrix), which trivially has non-negative elements. The scheme is unconditionally monotone for $\\theta=1$. The derived bound is the sufficient condition for monotonicity for $\\theta \\in [1/2, 1)$.\n\n### Task 3: Calculation of the Maximum Allowable Time Step\n\nTo calculate $\\Delta t_{\\max}$, we use the derived bound:\n$$ \\Delta t_{\\max} = \\frac{\\Delta z^2}{(1-\\theta)\\,\\max_{i=1,\\dots,N-1}\\left(K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}}\\right)} $$\nWe need to find the maximum value of the term $S_i = K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}}$.\nThe diffusivity profile $K_v(z)$ is constant at its maximum value $K_0$ for $0 \\le z \\le h=50\\,\\text{m}$, and non-increasing for $zh$. The grid spacing is $\\Delta z = 10\\,\\text{m}$, so the grid points $z_0, z_1, z_2, z_3, z_4, z_5$ are at depths $0, 10, 20, 30, 40, 50\\,\\text{m}$ respectively. For all these points, $K_v(z_i) = K_0$.\n\nLet's evaluate $S_i$ for an index $i$ where $z_{i-1}, z_i, z_{i+1}$ are all within the surface layer (i.e., $z_{i+1} \\le h$). This is true for $i=1, 2, 3, 4$. For these indices, $K_{i-1}=K_i=K_{i+1}=K_0$.\nThen $K_{i-\\frac{1}{2}} = \\frac{1}{2}(K_{i-1}+K_i) = \\frac{1}{2}(K_0+K_0) = K_0$.\nAnd $K_{i+\\frac{1}{2}} = \\frac{1}{2}(K_i+K_{i+1}) = \\frac{1}{2}(K_0+K_0) = K_0$.\nThe sum is $S_i = K_0 + K_0 = 2K_0$.\n\nFor any $i$ where at least one of the points $z_{i-1}, z_i, z_{i+1}$ is below the mixed layer depth $h$, the corresponding $K$ value will be less than or equal to $K_0$, with at least one strictly smaller value. This will result in a sum $S_i  2K_0$. For example, at $i=5$, $z_4=40, z_5=50, z_6=60$. $K_4=K_5=K_0$ but $K_6K_0$. So $S_5 = K_{4.5}+K_{5.5} = K_0 + \\frac{1}{2}(K_5+K_6)  2K_0$.\nTherefore, the maximum value is:\n$$ \\max_{i=1,\\dots,N-1}(K_{i+\\frac{1}{2}} + K_{i-\\frac{1}{2}}) = 2K_0 $$\nNow we can compute $\\Delta t_{\\max}$:\n$$ \\Delta t_{\\max} = \\frac{\\Delta z^2}{2K_0(1-\\theta)} $$\nSubstituting the given values:\n- $\\Delta z = 10\\,\\text{m}$\n- $K_0 = 1.0 \\times 10^{-2}\\,\\text{m}^2\\,\\text{s}^{-1}$\n- $\\theta = 0.7$\n$$ \\Delta t_{\\max} = \\frac{(10\\,\\text{m})^2}{2 \\times (1.0 \\times 10^{-2}\\,\\text{m}^2\\,\\text{s}^{-1}) \\times (1 - 0.7)} $$\n$$ \\Delta t_{\\max} = \\frac{100}{2 \\times 10^{-2} \\times 0.3} \\,\\text{s} = \\frac{100}{0.6 \\times 10^{-2}} \\,\\text{s} = \\frac{100}{0.006} \\,\\text{s} $$\n$$ \\Delta t_{\\max} = 16666.666... \\,\\text{s} $$\nRounding to four significant figures, we get $16670\\,\\text{s}$.",
            "answer": "$$\\boxed{16670}$$"
        }
    ]
}