{
    "hands_on_practices": [
        {
            "introduction": "The Penman-Monteith equation is a cornerstone of hydrology and climate science, providing a physically-based method to estimate evapotranspiration. This practice guides you through its derivation, revealing how canopy resistance ($r_c$) acts as a crucial bottleneck controlling water vapor flux in response to available energy and atmospheric demand. By working through this problem , you will gain a quantitative understanding of how vegetation partitions energy into latent and sensible heat, a key process in land-surface modeling.",
            "id": "4109220",
            "problem": "A horizontally homogeneous vegetated canopy is in steady state during a mid-day period, with vertically well-mixed air above the canopy. Under these conditions, the surface energy balance equates the available energy to turbulent heat fluxes. Turbulent exchanges of heat and water vapor between the canopy source and the atmosphere are represented by a resistance network, with an aerodynamic resistance $r_a$ governing transfer through the canopy air space and a canopy (surface) resistance $r_c$ governing stomatal control of vapor flow from leaf interior to the canopy air. Assume the aerodynamic resistance for heat and water vapor is equal. The atmospheric demand for evaporation is quantified by the Vapor Pressure Deficit (VPD), defined as the difference $e_s - e_a$ between the saturation vapor pressure at air temperature and the actual air vapor pressure. The slope of the saturation vapor pressure curve with temperature is $\\Delta$, and the psychrometric constant is $\\gamma$. The air thermal capacity per unit volume is $\\rho c_p$, where $\\rho$ is air density and $c_p$ is the specific heat at constant pressure.\n\nStarting from the surface energy balance and physically based expressions for the sensible and latent turbulent fluxes built upon Fick’s law and linearization of the saturation vapor pressure about air temperature, derive an expression for the latent heat flux $\\lambda E$ over the canopy in terms of the fundamental quantities $R_n - G$, $\\Delta$, $\\gamma$, $\\rho c_p$, $\\mathrm{VPD}$, $r_a$, and $r_c$. Then, evaluate $\\lambda E$ for the following parameters: $R_n - G = 200\\,\\mathrm{W\\,m^{-2}}$, $\\Delta = 0.15\\,\\mathrm{kPa\\,K^{-1}}$, $\\gamma = 0.066\\,\\mathrm{kPa\\,K^{-1}}$, $\\rho c_p = 1200\\,\\mathrm{J\\,m^{-3}\\,K^{-1}}$, $\\mathrm{VPD} = 1\\,\\mathrm{kPa}$, $r_a = 40\\,\\mathrm{s\\,m^{-1}}$, and $r_c = 100\\,\\mathrm{s\\,m^{-1}}$. Use physically consistent units throughout and any necessary unit conversions. Express your final answer for $\\lambda E$ in $\\mathrm{W\\,m^{-2}}$ and round your answer to four significant figures. Briefly interpret how the computed $\\lambda E$ partitions the available energy with the sensible heat flux $H$ implied by the surface energy balance.",
            "solution": "The problem requires the derivation of the Penman-Monteith equation for latent heat flux ($\\lambda E$) over a vegetated canopy, followed by a numerical evaluation and interpretation of the result. The derivation starts from the principles of surface energy balance and turbulent flux transport using a resistance analogy.\n\nThe surface energy balance for a steady-state system is given by the equation:\n$$R_n - G = H + \\lambda E$$\nwhere $R_n$ is the net radiation, $G$ is the ground heat flux, $H$ is the sensible heat flux, and $\\lambda E$ is the latent heat flux. The term $R_n - G$ represents the total available energy at the surface.\n\nThe turbulent fluxes, $H$ and $\\lambda E$, are modeled using flux-gradient relationships based on a resistance network. For a \"big-leaf\" model of the canopy, the source of heat and vapor is a hypothetical surface at temperature $T_s$.\n\nThe sensible heat flux, $H$, represents the transfer of heat from the canopy surface at temperature $T_s$ to the air at a reference height, which has temperature $T_a$. This transfer is governed by the aerodynamic resistance, $r_a$:\n$$H = \\rho c_p \\frac{T_s - T_a}{r_a}$$\nHere, $\\rho c_p$ is the volumetric heat capacity of air.\n\nThe latent heat flux, $\\lambda E$, represents the energy used for evapotranspiration. This involves water vapor moving from the saturated interior of leaves (at temperature $T_s$, with saturation vapor pressure $e^*(T_s)$) to the atmosphere at a reference height (with vapor pressure $e_a$). This transfer encounters two resistances in series: the canopy resistance $r_c$ (representing stomatal control) and the aerodynamic resistance $r_a$. The expression for $\\lambda E$ can be written in terms of vapor pressure gradients and the psychrometric constant, $\\gamma$:\n$$\\lambda E = \\frac{\\rho c_p}{\\gamma} \\frac{e^*(T_s) - e_a}{r_a + r_c}$$\n\nThe derivation proceeds by eliminating the unmeasured surface temperature $T_s$ from these equations.\nFirst, we rearrange the equation for $H$ to solve for the temperature difference $T_s - T_a$:\n$$T_s - T_a = \\frac{H r_a}{\\rho c_p}$$\n\nNext, we linearize the saturation vapor pressure function $e^*(T)$ around the air temperature $T_a$. The slope of the saturation vapor pressure curve at $T_a$ is given by $\\Delta = \\frac{de^*}{dT}|_{T_a}$. The first-order Taylor expansion is:\n$$e^*(T_s) \\approx e^*(T_a) + \\Delta (T_s - T_a)$$\n\nSubstitute the expression for $T_s - T_a$ into this linearization:\n$$e^*(T_s) \\approx e^*(T_a) + \\Delta \\frac{H r_a}{\\rho c_p}$$\n\nNow, substitute this expression for $e^*(T_s)$ into the equation for $\\lambda E$:\n$$\\lambda E = \\frac{\\rho c_p}{\\gamma(r_a + r_c)} \\left[ \\left( e^*(T_a) + \\Delta \\frac{H r_a}{\\rho c_p} \\right) - e_a \\right]$$\n\nWe can group the vapor pressure terms. The difference $e^*(T_a) - e_a$ is the Vapor Pressure Deficit of the air, denoted as $\\mathrm{VPD}$:\n$$\\lambda E = \\frac{\\rho c_p}{\\gamma(r_a + r_c)} \\left[ \\mathrm{VPD} + \\frac{\\Delta H r_a}{\\rho c_p} \\right]$$\n\nTo obtain an equation solely in terms of $\\lambda E$ and known atmospheric quantities, we substitute $H$ from the surface energy balance, $H = R_n - G - \\lambda E$:\n$$\\lambda E = \\frac{\\rho c_p \\mathrm{VPD}}{\\gamma(r_a + r_c)} + \\frac{\\Delta r_a}{\\gamma(r_a + r_c)}(R_n - G - \\lambda E)$$\n\nWe now solve this equation for $\\lambda E$. First, distribute the second term on the right-hand side:\n$$\\lambda E = \\frac{\\rho c_p \\mathrm{VPD}}{\\gamma(r_a + r_c)} + \\frac{\\Delta r_a (R_n - G)}{\\gamma(r_a + r_c)} - \\frac{\\Delta r_a \\lambda E}{\\gamma(r_a + r_c)}$$\n\nGroup all terms containing $\\lambda E$ on the left-hand side:\n$$\\lambda E + \\frac{\\Delta r_a \\lambda E}{\\gamma(r_a + r_c)} = \\frac{\\Delta r_a (R_n - G) + \\rho c_p \\mathrm{VPD}}{\\gamma(r_a + r_c)}$$\n\nFactor out $\\lambda E$ on the left-hand side:\n$$\\lambda E \\left( 1 + \\frac{\\Delta r_a}{\\gamma(r_a + r_c)} \\right) = \\frac{\\Delta r_a (R_n - G) + \\rho c_p \\mathrm{VPD}}{\\gamma(r_a + r_c)}$$\n\nCombine the terms in the parenthesis on the left:\n$$\\lambda E \\left( \\frac{\\gamma(r_a + r_c) + \\Delta r_a}{\\gamma(r_a + r_c)} \\right) = \\frac{\\Delta r_a (R_n - G) + \\rho c_p \\mathrm{VPD}}{\\gamma(r_a + r_c)}$$\n\nFinally, by canceling the common factor of $\\frac{1}{\\gamma(r_a + r_c)}$ from both sides, we isolate $\\lambda E$:\n$$\\lambda E = \\frac{\\Delta r_a (R_n - G) + \\rho c_p \\mathrm{VPD}}{\\Delta r_a + \\gamma(r_a + r_c)}$$\nTo obtain the more conventional form of the Penman-Monteith equation, we can divide the numerator and denominator of the derived form by $r_a$:\n$$\\lambda E = \\frac{\\Delta (R_n - G) + \\frac{\\rho c_p \\mathrm{VPD}}{r_a}}{\\Delta + \\gamma \\left(1 + \\frac{r_c}{r_a}\\right)}$$\nThis is the required expression.\n\nNow, we evaluate $\\lambda E$ using the provided parameters:\n$R_n - G = 200\\,\\mathrm{W\\,m^{-2}}$\n$\\Delta = 0.15\\,\\mathrm{kPa\\,K^{-1}}$\n$\\gamma = 0.066\\,\\mathrm{kPa\\,K^{-1}}$\n$\\rho c_p = 1200\\,\\mathrm{J\\,m^{-3}\\,K^{-1}}$\n$\\mathrm{VPD} = 1\\,\\mathrm{kPa}$\n$r_a = 40\\,\\mathrm{s\\,m^{-1}}$\n$r_c = 100\\,\\mathrm{s\\,m^{-1}}$\n\nFirst, calculate the resistance ratio:\n$$\\frac{r_c}{r_a} = \\frac{100\\,\\mathrm{s\\,m^{-1}}}{40\\,\\mathrm{s\\,m^{-1}}} = 2.5$$\n\nNext, calculate the denominator of the equation:\n$$Denominator = \\Delta + \\gamma \\left(1 + \\frac{r_c}{r_a}\\right) = 0.15\\,\\mathrm{kPa\\,K^{-1}} + (0.066\\,\\mathrm{kPa\\,K^{-1}})(1 + 2.5)$$\n$$Denominator = 0.15 + (0.066)(3.5) = 0.15 + 0.231 = 0.381\\,\\mathrm{kPa\\,K^{-1}}$$\n\nNext, calculate the numerator. The two terms are:\n$$Term\\,1 = \\Delta(R_n - G) = (0.15\\,\\mathrm{kPa\\,K^{-1}})(200\\,\\mathrm{W\\,m^{-2}}) = 30\\,\\mathrm{kPa\\,K^{-1}\\,W\\,m^{-2}}$$\n$$Term\\,2 = \\rho c_p \\frac{\\mathrm{VPD}}{r_a} = (1200\\,\\mathrm{J\\,m^{-3}\\,K^{-1}}) \\frac{1\\,\\mathrm{kPa}}{40\\,\\mathrm{s\\,m^{-1}}}$$\nRecalling that $1\\,\\mathrm{J} = 1\\,\\mathrm{W\\,s}$, we can write the units of $\\rho c_p$ as $1200\\,\\mathrm{W\\,s\\,m^{-3}\\,K^{-1}}$.\n$$Term\\,2 = (1200\\,\\mathrm{W\\,s\\,m^{-3}\\,K^{-1}}) \\frac{1\\,\\mathrm{kPa}}{40\\,\\mathrm{s\\,m^{-1}}} = 30\\,\\mathrm{W\\,m^{-2}\\,K^{-1}\\,kPa}$$\nThe numerator is the sum of these two terms:\n$$Numerator = 30\\,\\mathrm{kPa\\,K^{-1}\\,W\\,m^{-2}} + 30\\,\\mathrm{kPa\\,W\\,m^{-2}\\,K^{-1}} = 60\\,\\mathrm{kPa\\,K^{-1}\\,W\\,m^{-2}}$$\n\nFinally, calculate $\\lambda E$ by dividing the numerator by the denominator:\n$$\\lambda E = \\frac{60\\,\\mathrm{kPa\\,K^{-1}\\,W\\,m^{-2}}}{0.381\\,\\mathrm{kPa\\,K^{-1}}} \\approx 157.4803\\,\\mathrm{W\\,m^{-2}}$$\nRounding to four significant figures, the latent heat flux is $157.5\\,\\mathrm{W\\,m^{-2}}$.\n\nFor the interpretation, we calculate the sensible heat flux $H$ from the energy balance:\n$$H = (R_n - G) - \\lambda E = 200\\,\\mathrm{W\\,m^{-2}} - 157.5\\,\\mathrm{W\\,m^{-2}} = 42.5\\,\\mathrm{W\\,m^{-2}}$$\nOf the $200\\,\\mathrm{W\\,m^{-2}}$ of available energy, approximately $157.5\\,\\mathrm{W\\,m^{-2}}$ is consumed by evapotranspiration (latent heat flux), while the remaining $42.5\\,\\mathrm{W\\,m^{-2}}$ heats the air (sensible heat flux). This corresponds to a partition of approximately $78.8\\%$ of the available energy to latent heat and $21.2\\%$ to sensible heat. The prevalence of latent heat flux over sensible heat flux is characteristic of a well-watered, actively transpiring vegetated surface under midday solar radiation. The Bowen ratio, $B = H / \\lambda E = 42.5 / 157.5 \\approx 0.27$, being significantly less than $1$, confirms that evaporation is the dominant mechanism for dissipating the available surface energy in this scenario.",
            "answer": "$$\\boxed{157.5}$$"
        },
        {
            "introduction": "Canopy resistance is not a fixed property but a dynamic variable that reflects plant physiological responses to environmental stress. This exercise  delves into the critical link between soil moisture and stomatal behavior, a key feedback in the climate system. You will construct a stress function by combining standard models for soil water retention and plant hydraulics, providing a hands-on understanding of how drought conditions are parameterized to regulate transpiration in land surface models.",
            "id": "4109288",
            "problem": "A single-source canopy layer in the Penman–Monteith equation (Penman–Monteith) is represented by a canopy resistance $r_c$ that is the inverse of the canopy conductance $g_c$. Under midday conditions where radiation and vapor pressure deficit are held fixed, assume that the only variability in $g_c$ arises from soil moisture stress. Consider a vegetation canopy whose stomata regulate transpiration via plant hydraulics: as the soil dries, the leaf water potential decreases, inducing xylem vulnerability and stomatal closure. Adopt the following scientifically standard foundations:\n\n- A monotonic xylem vulnerability response that reduces hydraulic conductance as the magnitude of water potential increases, characterized by a mid-point potential $|\\psi_{50}|$ and a shape exponent $b$.\n- A soil water retention relationship linking volumetric water content $\\theta$ to matric suction head $|h|$, parametrized by saturated and residual water contents $(\\theta_s,\\theta_r)$ and shape parameters $(\\alpha,n)$ with $m=1-1/n$.\n- The conversion between matric potential magnitude $|\\psi|$ and suction head $|h|$ by $|h|=|\\psi|/(\\rho_w g)$, where $\\rho_w$ is water density and $g$ is gravitational acceleration.\n\nLet the parameters be $\\theta_s=0.43$, $\\theta_r=0.078$, $\\alpha=0.036\\,\\mathrm{cm}^{-1}$, $n=1.56$ (so $m=1-1/n$), $|\\psi_{50}|=1.5\\,\\mathrm{MPa}$, $b=3$, $\\rho_w=1000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, $g=9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, and a well-watered canopy conductance $g_{c,\\max}=0.020\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n\nTasks:\n1. Starting from the stated foundations, derive an analytic expression for the soil moisture stress function $f_{\\theta}(\\theta)$, defined as the fractional reduction in canopy conductance due to soil drying, by composing the xylem vulnerability response with the soil water retention curve to express $f_{\\theta}$ explicitly as a function of $\\theta$.\n2. For drought stress characterized by soil matric potential $\\psi_m=-1\\,\\mathrm{MPa}$, use the soil water retention relationship to determine the corresponding $\\theta$, then evaluate your $f_{\\theta}(\\theta)$ at that $\\theta$. Using $r_c=1/g_c$ and $g_c=g_{c,\\max} f_{\\theta}$, compute the multiplicative increase factor $r_c/r_{c,\\mathrm{wet}}$, where $r_{c,\\mathrm{wet}}=1/g_{c,\\max}$. Express your final answer as a dimensionless number and round your answer to four significant figures.",
            "solution": "#### Task 1: Derivation of the soil moisture stress function $f_{\\theta}(\\theta)$\nThe soil moisture stress function, $f_{\\theta}(\\theta)$, represents the fractional reduction in canopy conductance due to soil water limitation. This reduction is modeled based on plant hydraulics, specifically xylem vulnerability to increasing water potential magnitude. A standard sigmoidal function is used to represent this vulnerability, where the stress function is expressed in terms of soil matric potential, $\\psi_m$:\n$$f_{\\psi}(\\psi_m) = \\frac{1}{1 + \\left(\\frac{|\\psi_m|}{|\\psi_{50}|}\\right)^b}$$\nOur goal is to express this function in terms of volumetric soil moisture content, $\\theta$, by finding the relationship $|\\psi_m|(\\theta)$.\n\nFirst, we relate the magnitude of the matric potential, $|\\psi_m|$, to the matric suction head, $|h|$, using the hydrostatic equation:\n$$|\\psi_m| = \\rho_w g |h|$$\nNext, we use the van Genuchten soil water retention model to relate $|h|$ to $\\theta$. The model is given by:\n$$\\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r} = \\left( 1 + (\\alpha|h|)^n \\right)^{-m}$$\nwhere $m = 1 - 1/n$. We invert this equation to solve for $|h|$ as a function of $\\theta$. Let $S_e = \\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r}$ be the effective saturation.\n$$S_e = \\left( 1 + (\\alpha|h|)^n \\right)^{-m}$$\n$$S_e^{-1/m} = 1 + (\\alpha|h|)^n$$\n$$(\\alpha|h|)^n = S_e^{-1/m} - 1$$\n$$|h|(\\theta) = \\frac{1}{\\alpha} \\left[ S_e^{-1/m} - 1 \\right]^{1/n} = \\frac{1}{\\alpha} \\left[ \\left( \\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r} \\right)^{-1/m} - 1 \\right]^{1/n}$$\nNow, we substitute this expression for $|h|(\\theta)$ into the equation for $|\\psi_m|$:\n$$|\\psi_m|(\\theta) = \\frac{\\rho_w g}{\\alpha} \\left[ \\left( \\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r} \\right)^{-1/m} - 1 \\right]^{1/n}$$\nFinally, we substitute this expression for $|\\psi_m|(\\theta)$ into the vulnerability function to obtain the desired stress function $f_{\\theta}(\\theta)$:\n$$f_{\\theta}(\\theta) = \\left( 1 + \\left( \\frac{|\\psi_m|(\\theta)}{|\\psi_{50}|} \\right)^b \\right)^{-1}$$\nSubstituting the full expression for $|\\psi_m|(\\theta)$ yields the final analytical form:\n$$f_{\\theta}(\\theta) = \\left( 1 + \\left( \\frac{\\rho_w g}{\\alpha |\\psi_{50}|} \\left[ \\left( \\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r} \\right)^{-\\frac{1}{m}} - 1 \\right]^{\\frac{1}{n}} \\right)^b \\right)^{-1}$$\n\n#### Task 2: Calculation of the resistance increase factor\nWe need to compute the multiplicative increase factor $r_c/r_{c,\\text{wet}}$ for a soil matric potential $\\psi_m=-1\\,\\mathrm{MPa}$.\n\nThe canopy resistance under stressed conditions is $r_c = 1/g_c = 1/(g_{c,\\max} f_{\\theta})$. The well-watered canopy resistance occurs when the stress function $f_{\\theta}=1$, so $r_{c,\\text{wet}} = 1/g_{c,\\max}$. The ratio is:\n$$\\frac{r_c}{r_{c,\\text{wet}}} = \\frac{1/(g_{c,\\max}f_{\\theta})}{1/g_{c,\\max}} = \\frac{1}{f_{\\theta}}$$\nWe must evaluate $f_{\\theta}$ for the condition $\\psi_m = -1\\,\\mathrm{MPa}$, which means $|\\psi_m| = 1\\,\\mathrm{MPa}$.\n\nAlthough the problem asks to first find the corresponding $\\theta$, it is more direct to evaluate the stress function using the given potential value directly in the vulnerability function, as $f_{\\theta}(\\theta(\\psi_m)) = f_{\\psi}(\\psi_m)$.\n$$f_{\\theta} = f_{\\psi}(|\\psi_m| = 1\\,\\mathrm{MPa}) = \\frac{1}{1 + \\left(\\frac{1\\,\\mathrm{MPa}}{|\\psi_{50}|}\\right)^b}$$\nUsing the given parameters $|\\psi_{50}|=1.5\\,\\mathrm{MPa}$ and $b=3$:\n$$f_{\\theta} = \\frac{1}{1 + \\left(\\frac{1}{1.5}\\right)^3} = \\frac{1}{1 + \\left(\\frac{2}{3}\\right)^3} = \\frac{1}{1 + \\frac{8}{27}} = \\frac{1}{\\frac{35}{27}} = \\frac{27}{35}$$\n(For completeness, the volumetric water content $\\theta$ corresponding to $|\\psi_m|=1\\,\\mathrm{MPa}$ is approximately 0.0836, which, if plugged into the full expression for $f_\\theta(\\theta)$, would yield the same result.)\n\nThe multiplicative increase factor for canopy resistance is the reciprocal of the stress function:\n$$\\frac{r_c}{r_{c,\\text{wet}}} = \\frac{1}{f_{\\theta}} = \\frac{1}{27/35} = \\frac{35}{27}$$\nTo provide the final numerical answer, we compute the value and round to four significant figures:\n$$\\frac{35}{27} \\approx 1.296296...$$\nRounding to four significant figures gives $1.296$.",
            "answer": "$$\\boxed{1.296}$$"
        },
        {
            "introduction": "While process models describe how canopy resistance should behave, data assimilation provides a framework for estimating its actual value by integrating observations into models. This practice  introduces you to this concept using a simplified but powerful linear inference method analogous to a Kalman filter. By assimilating observations of Solar-Induced Fluorescence (SIF), you will see how a prior estimate of $r_c$ is updated, and you will explore how the confidence in our observations influences the final result.",
            "id": "4109225",
            "problem": "You are given a Bayesian data assimilation task to update canopy stomatal resistance using a linear Gaussian inference consistent with a one-step Kalman Filter (KF). The objective is to compute the posterior mean of canopy stomatal resistance based on a prior from a Jarvis-type model and observations of Solar-Induced Fluorescence (SIF). The sensitivity of the posterior estimate to the assumed observation error covariance must be assessed by varying the observation error variance across multiple test cases.\n\nBase assumptions and modeling framework to be used:\n- The canopy stomatal resistance, denoted by $r_c$ (unit: $\\mathrm{s\\,m^{-1}}$), is modeled as a scalar state with a Gaussian prior $r_c \\sim \\mathcal{N}(x_b, P_b)$, where $x_b$ is the prior mean and $P_b$ is the prior variance. The prior $x_b$ is provided by a Jarvis-type resistance formulation evaluated using independent environmental inputs (not part of this problem), and $P_b$ summarizes prior uncertainty in $r_c$.\n- Observations are Solar-Induced Fluorescence (SIF), denoted by $y$ (unit: $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$), which we approximate as a linear function of $r_c$ around the operating point of the prior through a linearization of the radiative-fluorescence response: \n  $$ y = H\\,r_c + c + v, $$\n  where $H$ has unit $\\mathrm{(W\\,m^{-2}\\,sr^{-1}\\,nm^{-1})/(s\\,m^{-1})}$, $c$ has unit $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$, and $v \\sim \\mathcal{N}(0, R)$ is Gaussian observation noise with variance $R$ (unit: $\\mathrm{(W\\,m^{-2}\\,sr^{-1}\\,nm^{-1})^2}$). For midday conditions, $H$ is negative because increasing $r_c$ reduces photosynthetic activity and thus SIF.\n- You must work in the scalar linear Gaussian setting and derive the posterior mean of $r_c$ and discuss sensitivity to the choice of $R$.\n\nTasks:\n1. Starting only from the definitions of a Gaussian prior for $r_c$ and a linear Gaussian observation model, derive the closed-form posterior mean $x_a$ for $r_c$ (units: $\\mathrm{s\\,m^{-1}}$) as a function of $x_b$, $P_b$, $H$, $c$, $y$, and $R$. Do not assume any specialized assimilation formulas as given; begin from the standard linear Gaussian conditioning identities. \n2. Implement a program that computes $x_a$ for each provided test case and returns the posterior mean $r_c$ for each case, expressed in $\\mathrm{s\\,m^{-1}}$, rounded to six decimal places.\n3. Discuss (qualitatively in your solution) how the posterior mean depends on the observation error variance $R$, keeping all other parameters fixed.\n\nTest suite (all quantities must be treated in the specified units; every test case uses the same prior and observation operator except where noted):\n- Prior mean and variance: $x_b = 150\\,\\mathrm{s\\,m^{-1}}$, $P_b = 2500\\,\\mathrm{(s\\,m^{-1})^2}$.\n- Observation operator parameters: $H = -0.004\\,\\mathrm{(W\\,m^{-2}\\,sr^{-1}\\,nm^{-1})/(s\\,m^{-1})}$, $c = 2.0\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n- The following five test cases specify $(y, R)$:\n  1. $(y, R) = (1.2, 0.01)$,\n  2. $(y, R) = (1.2, 0.1)$,\n  3. $(y, R) = (1.2, 1.0)$,\n  4. $(y, R) = (1.2, 100.0)$,\n  5. $(y, R) = (1.4, 0.5)$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the posterior means for $r_c$ from the five test cases, in order, as a comma-separated list enclosed in square brackets, with each value rounded to six decimal places, in units of $\\mathrm{s\\,m^{-1}}$. For example: \n  \"[150.000000,151.000000,152.000000,153.000000,154.000000]\".",
            "solution": "This problem requires the derivation and application of the one-dimensional Kalman filter update equation to find the posterior mean of canopy stomatal resistance, $r_c$.\n\n#### Derivation of the Posterior Mean\n\nWe are given a scalar state variable, the canopy stomatal resistance $r_c$, with a Gaussian prior distribution $p(r_c) = \\mathcal{N}(r_c; x_b, P_b)$, where $x_b$ is the prior mean and $P_b$ is the prior variance. We are also given a linear observation model for Solar-Induced Fluorescence (SIF), $y = H r_c + c + v$, where the observation noise $v$ is from a Gaussian distribution $v \\sim \\mathcal{N}(0, R)$. This defines the likelihood of observing $y$ given a state $r_c$ as $p(y | r_c) = \\mathcal{N}(y; H r_c + c, R)$.\n\nAccording to Bayes' theorem, the posterior probability distribution $p(r_c | y)$ is proportional to the product of the likelihood and the prior:\n$$ p(r_c | y) \\propto p(y | r_c) p(r_c) $$\n$$ p(r_c | y) \\propto \\exp\\left( -\\frac{1}{2} \\left[ \\frac{(y - c - H r_c)^2}{R} + \\frac{(r_c - x_b)^2}{P_b} \\right] \\right) $$\nSince the posterior is the product of two Gaussians, it is also a Gaussian. Its mean, $x_a$, is the value of $r_c$ that maximizes the posterior probability, which is equivalent to minimizing the cost function $J(r_c)$ in the exponent:\n$$ J(r_c) = \\frac{(y - c - H r_c)^2}{R} + \\frac{(r_c - x_b)^2}{P_b} $$\nTo find the minimum, we take the derivative of $J(r_c)$ with respect to $r_c$ and set it to zero:\n$$ \\frac{dJ}{dr_c} = \\frac{2(y - c - H r_c)(-H)}{R} + \\frac{2(r_c - x_b)}{P_b} = 0 $$\nSolving for $r_c$ (which is our posterior mean $x_a$):\n$$ r_c \\left( \\frac{H^2}{R} + \\frac{1}{P_b} \\right) = \\frac{H(y - c)}{R} + \\frac{x_b}{P_b} $$\n$$ r_c \\left( \\frac{H^2 P_b + R}{R P_b} \\right) = \\frac{H P_b (y - c) + R x_b}{R P_b} $$\n$$ x_a = r_c = \\frac{R x_b + P_b H (y - c)}{R + P_b H^2} $$\nThis expression provides the closed-form solution for the posterior mean.\n\n#### Sensitivity to Observation Error Variance $R$\n\nThe derived formula can be rearranged into the form of a weighted average:\n$$ x_a = \\left( \\frac{R}{R + P_b H^2} \\right) x_b + \\left( \\frac{P_b H^2}{R + P_b H^2} \\right) \\left( \\frac{y-c}{H} \\right) $$\nThis shows that the posterior mean $x_a$ is a weighted average of the prior estimate ($x_b$) and the observation-implied estimate ($(y-c)/H$). The observation error variance $R$ controls the weights.\n\n- As $R \\to 0$, the observation is trusted completely. The weight on the prior goes to zero, and the weight on the observation-implied estimate goes to one. The posterior $x_a$ converges to $(y-c)/H$.\n- As $R \\to \\infty$, the observation is considered worthless. The weight on the prior goes to one, and the weight on the observation-implied estimate goes to zero. The posterior $x_a$ converges to the prior $x_b$.\n\nIn summary, the observation error variance $R$ dictates the influence of the new observation. A small $R$ pulls the estimate strongly towards the value implied by the observation, while a large $R$ results in an estimate that remains close to the original prior belief. This behavior is demonstrated by the numerical results for test cases 1-4, where increasing $R$ for a fixed observation causes the posterior mean to shift from a value near the observation-implied state back toward the prior mean.\n\n#### Numerical Implementation\nThe Python code below implements the derived formula for $x_a$ to compute the posterior mean of $r_c$ for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the posterior mean of canopy stomatal resistance using a \n    linear Gaussian inference framework for a series of test cases.\n    \"\"\"\n    \n    # Define problem constants from the problem statement.\n    # Prior mean of canopy stomatal resistance (s/m)\n    x_b = 150.0\n    # Prior variance of canopy stomatal resistance ((s/m)^2)\n    P_b = 2500.0\n    # Sensitivity of SIF to stomatal resistance ((W/m^2/sr/nm)/(s/m))\n    H = -0.004\n    # Intercept term in the linear observation model (W/m^2/sr/nm)\n    c = 2.0\n\n    # Test cases provided in the problem statement.\n    # Each tuple contains (y, R) where:\n    # y is the SIF observation (W/m^2/sr/nm)\n    # R is the observation error variance ((W/m^2/sr/nm)^2)\n    test_cases = [\n        (1.2, 0.01),\n        (1.2, 0.1),\n        (1.2, 1.0),\n        (1.2, 100.0),\n        (1.4, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        y, R = case\n        \n        # Derived formula for the posterior mean (analysis state) x_a:\n        # x_a = (R * x_b + P_b * H * (y - c)) / (R + P_b * H^2)\n        \n        numerator = R * x_b + P_b * H * (y - c)\n        denominator = R + P_b * H**2\n        \n        x_a = numerator / denominator\n        \n        results.append(x_a)\n\n    # Format the results as a comma-separated list of strings, with each value\n    # rounded to six decimal places, enclosed in square brackets.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(output_string)\n\nsolve()\n```"
        }
    ]
}