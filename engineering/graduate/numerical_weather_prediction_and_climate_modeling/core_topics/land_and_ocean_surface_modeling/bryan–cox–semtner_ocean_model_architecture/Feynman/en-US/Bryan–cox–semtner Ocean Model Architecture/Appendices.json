{
    "hands_on_practices": [
        {
            "introduction": "The hallmark of the Bryan-Cox-Semtner (BCS) architecture is its 'mode-splitting' approach, which computationally separates the fast-moving, depth-independent barotropic mode from the slower, depth-dependent baroclinic mode. This design is a direct response to a fundamental numerical stability constraint. This exercise will guide you through a stability analysis to derive the Courant-Friedrichs-Lewy (CFL) condition for the explicit treatment of external gravity waves . By calculating this limit, you will gain a first-hand understanding of why these fast waves pose a significant computational bottleneck and motivate the model's use of an implicit solver for the barotropic component.",
            "id": "4019553",
            "problem": "Consider the linearized one-dimensional barotropic subsystem of the Bryan–Cox–Semtner (BCS) ocean model architecture with constant depth $H$, gravity $g$, and uniform grid spacing $\\Delta x$ on an Arakawa C-grid. The prognostic variables are the along-channel velocity $u(x,t)$ staggered at cell faces and the free-surface displacement $\\eta(x,t)$ staggered at cell centers. Neglect planetary rotation, bottom friction, and any forcing, and assume periodic boundary conditions. The continuous governing equations are the linear shallow-water equations\n$$\n\\frac{\\partial u}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial x}, \\qquad \\frac{\\partial \\eta}{\\partial t} = - H \\frac{\\partial u}{\\partial x}.\n$$\nThe barotropic mode in many BCS implementations is advanced explicitly with a forward–backward time-differencing scheme and centered spatial differences on the C-grid:\n$$\nu^{n+\\frac{1}{2}}_{j+\\frac{1}{2}} = u^{n-\\frac{1}{2}}_{j+\\frac{1}{2}} - g \\,\\Delta t \\,\\frac{\\eta^{n}_{j+1} - \\eta^{n}_{j}}{\\Delta x},\n$$\n$$\n\\eta^{n+1}_{j} = \\eta^{n}_{j} - H \\,\\Delta t \\,\\frac{u^{n+\\frac{1}{2}}_{j+\\frac{1}{2}} - u^{n+\\frac{1}{2}}_{j-\\frac{1}{2}}}{\\Delta x},\n$$\nwhere $j$ indexes grid cells, $n$ indexes integer time levels for $\\eta$, and $n \\pm \\tfrac{1}{2}$ index half time levels for $u$. Using a von Neumann normal mode analysis with trial solutions $u^{n+\\frac{1}{2}}_{j+\\frac{1}{2}} = \\hat{u}^{n+\\frac{1}{2}} \\exp\\!\\big(i k (j+\\tfrac{1}{2}) \\Delta x\\big)$ and $\\eta^{n}_{j} = \\hat{\\eta}^{n} \\exp\\!\\big(i k j \\Delta x\\big)$, determine the closed-form stability limit for the explicit barotropic time step $\\Delta t_{\\max}$ as a function of $H$, $\\Delta x$, and $g$. Express the final time-step limit in seconds. Do not approximate your final expression.\n\nFinally, briefly explain, based on your derived condition, how the implicit or elliptic treatment of the barotropic mode in the Bryan–Cox–Semtner (BCS) ocean model circumvents this explicit stability constraint without altering the physical wave speed.\n\nYour final answer must be a single analytical expression. No rounding is required.",
            "solution": "The starting point is the linear shallow-water system,\n$$\n\\frac{\\partial u}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial x}, \\qquad \\frac{\\partial \\eta}{\\partial t} = - H \\frac{\\partial u}{\\partial x},\n$$\nwhich supports non-dispersive barotropic gravity waves with phase speed $c = \\sqrt{g H}$. On an Arakawa C-grid, we discretize with the forward–backward time-stepping scheme and centered spatial differences:\n$$\nu^{n+\\frac{1}{2}}_{j+\\frac{1}{2}} = u^{n-\\frac{1}{2}}_{j+\\frac{1}{2}} - g \\,\\Delta t \\,\\frac{\\eta^{n}_{j+1} - \\eta^{n}_{j}}{\\Delta x},\n$$\n$$\n\\eta^{n+1}_{j} = \\eta^{n}_{j} - H \\,\\Delta t \\,\\frac{u^{n+\\frac{1}{2}}_{j+\\frac{1}{2}} - u^{n+\\frac{1}{2}}_{j-\\frac{1}{2}}}{\\Delta x}.\n$$\nWe perform a von Neumann (Fourier) stability analysis by substituting normal modes:\n$$\n\\eta^{n}_{j} = A^{n} \\exp\\!\\big(i k j \\Delta x\\big), \\qquad u^{n+\\frac{1}{2}}_{j+\\frac{1}{2}} = B^{n+\\frac{1}{2}} \\exp\\!\\big(i k (j+\\tfrac{1}{2}) \\Delta x\\big).\n$$\nDefine $\\kappa \\equiv \\frac{k \\Delta x}{2}$ and $s \\equiv \\sin(\\kappa)$. The discrete staggered gradient and divergence operators acting on these modes yield the common factor\n$$\n\\frac{\\eta^{n}_{j+1} - \\eta^{n}_{j}}{\\Delta x} = \\frac{2 i s}{\\Delta x}\\,A^{n} \\exp\\!\\big(i k (j+\\tfrac{1}{2}) \\Delta x\\big),\n$$\n$$\n\\frac{u^{n+\\frac{1}{2}}_{j+\\frac{1}{2}} - u^{n+\\frac{1}{2}}_{j-\\frac{1}{2}}}{\\Delta x} = \\frac{2 i s}{\\Delta x}\\,B^{n+\\frac{1}{2}} \\exp\\!\\big(i k j \\Delta x\\big).\n$$\nHence the modal amplitude recurrences become\n$$\nB^{n+\\frac{1}{2}} = B^{n-\\frac{1}{2}} - g \\,\\Delta t \\,\\alpha \\,A^{n}, \\qquad \\alpha \\equiv \\frac{2 i s}{\\Delta x},\n$$\n$$\nA^{n+1} = A^{n} - H \\,\\Delta t \\,\\alpha \\,B^{n+\\frac{1}{2}}.\n$$\nTo eliminate $B$, we use the continuity update at consecutive times $n$ and $n+1$. From the continuity equation at time $n$,\n$$\nA^{n} = A^{n-1} - H \\,\\Delta t \\,\\alpha \\,B^{n-\\frac{1}{2}}.\n$$\nSubtracting the two continuity equations gives\n$$\nA^{n+1} - A^{n} = \\left(A^{n} - A^{n-1}\\right) - H \\,\\Delta t \\,\\alpha \\left( B^{n+\\frac{1}{2}} - B^{n-\\frac{1}{2}} \\right).\n$$\nUsing the momentum update,\n$$\nB^{n+\\frac{1}{2}} - B^{n-\\frac{1}{2}} = - g \\,\\Delta t \\,\\alpha \\,A^{n},\n$$\nwe obtain the second-order scalar recurrence for $A^{n}$:\n$$\nA^{n+1} - 2 A^{n} + A^{n-1} = g H \\,(\\Delta t)^{2} \\,\\alpha^{2} \\,A^{n}.\n$$\nSince $\\alpha = \\frac{2 i s}{\\Delta x}$, we have $\\alpha^{2} = - \\frac{4 s^{2}}{\\Delta x^{2}}$. Introducing the external gravity wave speed $c \\equiv \\sqrt{g H}$ and the Courant number\n$$\nC \\equiv \\frac{c \\,\\Delta t}{\\Delta x},\n$$\nthe recurrence becomes\n$$\nA^{n+1} - 2 A^{n} + A^{n-1} = - 4 C^{2} s^{2} \\,A^{n}.\n$$\nSeek solutions of the form $A^{n} = A^{0} \\,\\zeta^{n}$. Substitution yields\n$$\n\\zeta + \\zeta^{-1} - 2 = - 4 C^{2} s^{2}.\n$$\nLet $\\zeta = \\exp(i \\theta)$, corresponding to neutral oscillations; then\n$$\n\\zeta + \\zeta^{-1} = 2 \\cos\\theta \\quad \\Rightarrow \\quad 2 \\cos\\theta = 2 - 4 C^{2} s^{2},\n$$\nso\n$$\n\\cos\\theta = 1 - 2 C^{2} s^{2}.\n$$\nFor stability in the von Neumann sense, we require that $\\theta$ be real for all resolved wavenumbers, which demands\n$$\n-1 \\le 1 - 2 C^{2} s^{2} \\le 1.\n$$\nThe upper bound is automatically satisfied; the lower bound gives\n$$\n1 - 2 C^{2} s^{2} \\ge -1 \\quad \\Rightarrow \\quad 2 C^{2} s^{2} \\le 2 \\quad \\Rightarrow \\quad C^{2} s^{2} \\le 1.\n$$\nBecause $s^{2} = \\sin^{2}(\\kappa) \\le 1$ for all $\\kappa$, the most restrictive condition occurs at the shortest resolved scale where $\\sin^{2}(\\kappa) \\to 1$. Therefore,\n$$\nC \\le 1 \\quad \\Rightarrow \\quad \\Delta t \\le \\frac{\\Delta x}{c} = \\frac{\\Delta x}{\\sqrt{g H}}.\n$$\nHence, the explicit stability limit for the barotropic time step on this C-grid forward–backward scheme is\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x}{\\sqrt{g H}}.\n$$\nThis expression is the required closed form in terms of $H$, $\\Delta x$, and $g$. Since the requested unit is seconds, the expression represents seconds when $\\Delta x$ is in meters, $g$ in meters per second squared, and $H$ in meters.\n\nRelation to the implicit or elliptic treatment in the Bryan–Cox–Semtner (BCS) ocean model: The BCS architecture often advances the barotropic mode implicitly by solving an elliptic (Helmholtz-type) equation for the free-surface or barotropic streamfunction at each baroclinic step, which removes the explicit Courant–Friedrichs–Lewy constraint $\\Delta t \\le \\Delta x/\\sqrt{g H}$ derived above; the physical gravity wave speed $c = \\sqrt{g H}$ is preserved, but the numerical stability is decoupled from $c$ because the implicit solve enforces the wave dynamics without requiring the explicit time step to resolve the fastest external mode.",
            "answer": "$$\\boxed{\\frac{\\Delta x}{\\sqrt{g H}}}$$"
        },
        {
            "introduction": "While stability dictates the maximum permissible time step, the accuracy of a simulation depends critically on the spatial discretization of processes like tracer advection. Different numerical schemes can introduce non-physical artifacts, such as numerical diffusion, which can erroneously damp important physical features. In this practice, you will use Taylor series analysis to derive the 'modified equation' for a first-order upwind advection scheme, allowing you to quantify its inherent numerical diffusion . This analysis is a powerful tool for diagnosing and understanding the behavior of numerical models, revealing how the choice of discretization directly impacts the fidelity of the simulated physics.",
            "id": "4019544",
            "problem": "In the Bryan–Cox–Semtner (BCS) ocean model architecture, tracer advection is formulated in flux form on the Arakawa C-grid, with tracer concentration $C$ at cell centers and normal velocity $u$ at cell faces. Consider a one-dimensional, periodic domain with constant positive velocity $u>0$ and uniform grid spacing $\\Delta x$, and let the semi-discrete tracer tendency be written as\n$$\n\\frac{d C_i}{d t} \\;=\\; -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x},\n$$\nwhere $F_{i+\\frac{1}{2}}$ is the advective flux at the right face of cell $i$. Two common discrete flux choices are:\n- First-order upwind flux: $F_{i+\\frac{1}{2}} = u\\,C_i$ for $u>0$.\n- Centered flux: $F_{i+\\frac{1}{2}} = u\\,\\frac{C_{i+1} + C_i}{2}$.\n\nStarting from the continuous tracer advection equation in one dimension, $\\frac{\\partial C}{\\partial t} + u\\,\\frac{\\partial C}{\\partial x} = 0$, and from the semi-discrete flux-form above, perform the following:\n\n1. Using a Taylor expansion about $x_i$, derive the leading-order modified equation corresponding to the first-order upwind flux. Identify the coefficient multiplying $\\frac{\\partial^2 C}{\\partial x^2}$ and interpret it as the numerical diffusion coefficient $\\kappa_{\\mathrm{num}}$ implied by first-order upwind advection on the BCS C-grid.\n2. Derive the spatial variance budget for the modified equation, defined as the evolution of $\\int C^2/2\\,dx$ over one periodic domain. Quantify the dissipative impact of $\\kappa_{\\mathrm{num}}$ on tracer variance and show the variance decay for a single Fourier mode $C(x,0) = A_0 \\cos(kx)$.\n3. For a coarse-resolution climate configuration with parameters $u = 0.15\\,\\mathrm{m\\,s^{-1}}$, $\\Delta x = 80\\,\\mathrm{km}$, a tracer mode wavelength $L_{\\mathrm{mode}} = 320\\,\\mathrm{km}$, and an integration time $T = 10\\,\\mathrm{days}$, compute the fraction of tracer variance remaining under first-order upwind advection relative to centered advection after time $T$. Express your final answer as a decimal and round to four significant figures.\n\nNote: Use the physically consistent relations $k = \\frac{2\\pi}{L_{\\mathrm{mode}}}$ and the definition of days in seconds. Assume periodic boundary conditions and neglect any physical diffusion or sources/sinks.",
            "solution": "The problem statement is a well-posed exercise in the numerical analysis of advection schemes, a fundamental topic in computational fluid dynamics and climate modeling. The concepts, equations, and parameters are scientifically grounded and internally consistent. The problem is therefore valid.\n\nThe solution is divided into three parts as requested.\n\n### Part 1: Modified Equation and Numerical Diffusion for First-Order Upwind Scheme\n\nThe continuous one-dimensional tracer advection equation is given as:\n$$\n\\frac{\\partial C}{\\partial t} + u\\,\\frac{\\partial C}{\\partial x} = 0\n$$\nThe semi-discrete form on a grid with spacing $\\Delta x$ is:\n$$\n\\frac{d C_i}{d t} = -\\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x}\n$$\nwhere $C_i(t)$ represents the tracer concentration in cell $i$ at time $t$. For the first-order upwind scheme with constant positive velocity $u>0$, the fluxes are defined as $F_{i+\\frac{1}{2}} = u\\,C_i$ and $F_{i-\\frac{1}{2}} = u\\,C_{i-1}$. Substituting these into the semi-discrete equation yields:\n$$\n\\frac{d C_i}{d t} = -\\frac{u\\,C_i - u\\,C_{i-1}}{\\Delta x} = -u\\,\\frac{C_i - C_{i-1}}{\\Delta x}\n$$\nTo derive the modified equation, we interpret the discrete terms as approximations of continuous derivatives at the location $x_i$ of cell $i$. The left-hand side, $\\frac{d C_i}{dt}$, becomes the partial time derivative $\\frac{\\partial C}{\\partial t}$ evaluated at $x_i$. For the right-hand side, we use a Taylor series expansion for $C_{i-1} = C(x_i - \\Delta x)$ around $x_i$:\n$$\nC_{i-1} = C(x_i - \\Delta x) = C(x_i) - \\Delta x \\left.\\frac{\\partial C}{\\partial x}\\right|_{x_i} + \\frac{(\\Delta x)^2}{2} \\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{x_i} - \\frac{(\\Delta x)^3}{6} \\left.\\frac{\\partial^3 C}{\\partial x^3}\\right|_{x_i} + \\mathcal{O}((\\Delta x)^4)\n$$\nSubstituting this into the right-hand side of the semi-discrete equation:\n$$\n-u\\,\\frac{C_i - C_{i-1}}{\\Delta x} = -u\\,\\frac{1}{\\Delta x} \\left( C_i - \\left[ C_i - \\Delta x \\frac{\\partial C}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\dots \\right] \\right)\n$$\n$$\n= -u\\,\\frac{1}{\\Delta x} \\left( \\Delta x \\frac{\\partial C}{\\partial x} - \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 C}{\\partial x^2} + \\dots \\right)\n$$\n$$\n= -u\\,\\frac{\\partial C}{\\partial x} + \\frac{u\\,\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\mathcal{O}((\\Delta x)^2)\n$$\nEquating the time derivative with this expression, we obtain the modified partial differential equation that the discrete scheme actually solves:\n$$\n\\frac{\\partial C}{\\partial t} = -u\\,\\frac{\\partial C}{\\partial x} + \\frac{u\\,\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2}\n$$\nRearranging to match the form of a canonical advection-diffusion equation:\n$$\n\\frac{\\partial C}{\\partial t} + u\\,\\frac{\\partial C}{\\partial x} = \\frac{u\\,\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2}\n$$\nThe term on the right-hand side is the leading-order truncation error of the scheme. It has the form of a diffusion term, $\\kappa \\frac{\\partial^2 C}{\\partial x^2}$. By comparison, the numerical diffusion coefficient $\\kappa_{\\mathrm{num}}$ is the coefficient of this term.\n$$\n\\kappa_{\\mathrm{num}} = \\frac{u\\,\\Delta x}{2}\n$$\nThis artificial diffusion is inherent to the first-order upwind scheme and is responsible for its dissipative nature.\n\n### Part 2: Spatial Variance Budget and Fourier Mode Decay\n\nThe spatial variance of the tracer field over one periodic domain of length $L$ is defined as $V(t) = \\frac{1}{2} \\int_0^L C^2(x,t) \\,dx$. The rate of change of the total variance is:\n$$\n\\frac{dV}{dt} = \\frac{d}{dt} \\left( \\frac{1}{2} \\int_0^L C^2 \\,dx \\right) = \\int_0^L C \\frac{\\partial C}{\\partial t} \\,dx\n$$\nWe substitute the modified equation for $\\frac{\\partial C}{\\partial t}$ derived in Part 1:\n$$\n\\frac{dV}{dt} = \\int_0^L C \\left( -u\\,\\frac{\\partial C}{\\partial x} + \\kappa_{\\mathrm{num}} \\frac{\\partial^2 C}{\\partial x^2} \\right) \\,dx\n$$\nWe analyze the integral of each term separately. The advective term is:\n$$\n\\int_0^L -u\\,C\\,\\frac{\\partial C}{\\partial x} \\,dx = -u \\int_0^L \\frac{1}{2} \\frac{\\partial (C^2)}{\\partial x} \\,dx = -\\frac{u}{2} \\left[ C^2 \\right]_0^L = 0\n$$\nThe term vanishes due to the periodic boundary conditions, $C(0,t) = C(L,t)$. The advection term conserves variance.\nThe diffusive term is analyzed using integration by parts, $\\int_a^b u \\, dv = [uv]_a^b - \\int_a^b v \\, du$. Let $u=C$ and $dv = \\frac{\\partial^2 C}{\\partial x^2} dx$.\n$$\n\\int_0^L \\kappa_{\\mathrm{num}} \\, C \\frac{\\partial^2 C}{\\partial x^2} \\,dx = \\kappa_{\\mathrm{num}} \\left[ C \\frac{\\partial C}{\\partial x} \\right]_0^L - \\kappa_{\\mathrm{num}} \\int_0^L \\left( \\frac{\\partial C}{\\partial x} \\right)^2 \\,dx\n$$\nThe boundary term $\\left[ C \\frac{\\partial C}{\\partial x} \\right]_0^L$ also vanishes due to periodic boundary conditions. The remaining term quantifies the dissipation:\n$$\n\\frac{dV}{dt} = -\\kappa_{\\mathrm{num}} \\int_0^L \\left( \\frac{\\partial C}{\\partial x} \\right)^2 \\,dx\n$$\nSince $\\kappa_{\\mathrm{num}} > 0$ and $\\left( \\frac{\\partial C}{\\partial x} \\right)^2 \\geq 0$, it follows that $\\frac{dV}{dt} \\leq 0$. The numerical diffusion introduced by the upwind scheme monotonically dissipates tracer variance.\n\nNow consider a single Fourier mode, $C(x,t)$. We can represent this using complex notation as $C(x,t) = \\text{Re}\\{A(t) e^{ikx}\\}$, where $k$ is the wavenumber. Substituting this into the modified equation:\n$$\n\\frac{\\partial}{\\partial t} (A(t) e^{ikx}) + u \\frac{\\partial}{\\partial x} (A(t) e^{ikx}) = \\kappa_{\\mathrm{num}} \\frac{\\partial^2}{\\partial x^2} (A(t) e^{ikx})\n$$\n$$\n\\frac{dA}{dt} e^{ikx} + u A(t) (ik) e^{ikx} = \\kappa_{\\mathrm{num}} A(t) (ik)^2 e^{ikx}\n$$\nDividing by $e^{ikx}$ gives an ordinary differential equation for the amplitude $A(t)$:\n$$\n\\frac{dA}{dt} + ikuA = -k^2 \\kappa_{\\mathrm{num}} A \\quad \\implies \\quad \\frac{dA}{dt} = -(k^2 \\kappa_{\\mathrm{num}} + iku) A\n$$\nThe solution is $A(t) = A(0) e^{-(k^2 \\kappa_{\\mathrm{num}} + iku)t} = A(0) e^{-k^2 \\kappa_{\\mathrm{num}} t} e^{-ikut}$. The physical solution is $C(x,t) = \\text{Re}\\{A(t)e^{ikx}\\}$. If we start with $C(x,0) = A_0 \\cos(kx)$ where $A_0$ is real, then $A(0) = A_0$ and the solution is:\n$$\nC(x,t) = A_0 e^{-k^2 \\kappa_{\\mathrm{num}} t} \\cos(k(x - ut))\n$$\nThe amplitude of the mode decays exponentially as $|A_0| e^{-k^2 \\kappa_{\\mathrm{num}} t}$. Since variance $V$ is proportional to the amplitude squared, its decay is given by:\n$$\nV(t) = V(0) e^{-2 k^2 \\kappa_{\\mathrm{num}} t}\n$$\n\n### Part 3: Numerical Calculation of Variance Fraction\n\nWe need to compute the fraction of variance remaining after time $T$ for the upwind scheme, relative to the centered scheme. First, we analyze the centered scheme, where $F_{i+\\frac{1}{2}} = u\\,\\frac{C_{i+1} + C_i}{2}$. The discrete equation becomes:\n$$\n\\frac{dC_i}{dt} = -u \\frac{C_{i+1} - C_{i-1}}{2\\Delta x}\n$$\nUsing Taylor expansions for $C_{i+1}$ and $C_{i-1}$ shows that this is a second-order accurate approximation to $-u \\frac{\\partial C}{\\partial x}$. The leading error term is dispersive, not diffusive:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = -\\frac{u (\\Delta x)^2}{6} \\frac{\\partial^3 C}{\\partial x^3} + \\mathcal{O}((\\Delta x)^4)\n$$\nSince there is no $\\frac{\\partial^2 C}{\\partial x^2}$ term, the centered scheme is non-dissipative to this order of approximation. Therefore, for an analytic solution, it conserves variance: $V_{\\mathrm{centered}}(T) = V_{\\mathrm{centered}}(0)$.\nThe requested fraction is $f = \\frac{V_{\\mathrm{upwind}}(T)}{V_{\\mathrm{centered}}(T)}$. Assuming both start with the same initial variance $V(0)$, this simplifies to:\n$$\nf = \\frac{V_{\\mathrm{upwind}}(T)}{V(0)} = e^{-2 k^2 \\kappa_{\\mathrm{num}} T}\n$$\nWe are given the following parameters:\n- Velocity $u = 0.15\\,\\mathrm{m\\,s^{-1}}$\n- Grid spacing $\\Delta x = 80\\,\\mathrm{km} = 8 \\times 10^4\\,\\mathrm{m}$\n- Wavelength $L_{\\mathrm{mode}} = 320\\,\\mathrm{km} = 3.2 \\times 10^5\\,\\mathrm{m}$\n- Time $T = 10\\,\\mathrm{days} = 10 \\times 24 \\times 3600\\,\\mathrm{s} = 8.64 \\times 10^5\\,\\mathrm{s}$\n\nWe compute the terms in the exponent:\n1.  Numerical diffusion coefficient $\\kappa_{\\mathrm{num}}$:\n    $$\n    \\kappa_{\\mathrm{num}} = \\frac{u\\,\\Delta x}{2} = \\frac{(0.15\\,\\mathrm{m\\,s^{-1}})(8 \\times 10^4\\,\\mathrm{m})}{2} = 6 \\times 10^3\\,\\mathrm{m^2\\,s^{-1}}\n    $$\n2.  Wavenumber $k$:\n    $$\n    k = \\frac{2\\pi}{L_{\\mathrm{mode}}} = \\frac{2\\pi}{3.2 \\times 10^5\\,\\mathrm{m}}\n    $$\nNow, we compute the dimensionless exponent $-2 k^2 \\kappa_{\\mathrm{num}} T$:\n$$\n\\text{Exponent} = -2 \\left( \\frac{2\\pi}{3.2 \\times 10^5} \\right)^2 (6 \\times 10^3) (8.64 \\times 10^5)\n$$\n$$\n= -2 \\left( \\frac{4\\pi^2}{10.24 \\times 10^{10}} \\right) (6 \\times 10^3) (8.64 \\times 10^5)\n$$\n$$\n= -\\frac{8 \\pi^2 \\times (5.184 \\times 10^9)}{10.24 \\times 10^{10}} = -\\frac{41.472 \\pi^2}{102.4}\n$$\n$$\n= -0.405 \\pi^2\n$$\nThe fraction of remaining variance is:\n$$\nf = e^{-0.405 \\pi^2}\n$$\nUsing $\\pi^2 \\approx 9.8696044$:\n$$\nf \\approx e^{-0.405 \\times 9.8696044} = e^{-3.99718978} \\approx 0.0183674\n$$\nRounding to four significant figures, the result is $0.01837$.",
            "answer": "$$\\boxed{0.01837}$$"
        },
        {
            "introduction": "Ultimately, the theoretical principles of numerical modeling must be translated into robust, working code. A non-negotiable requirement for climate models is the strict conservation of fundamental quantities like mass, heat, and salt over long integrations. This is achieved in the BCS model through a finite-volume, flux-form discretization. This hands-on coding challenge asks you to implement a simple 2D diffusion model that is conservative by construction . By building a verification test that tracks the domain-integrated tracer mass against the prescribed boundary fluxes, you will gain practical experience with the flux-based methods that ensure the physical integrity of large-scale ocean simulations.",
            "id": "4019583",
            "problem": "You are asked to design and implement a discrete tracer conservation verification, aligned with the Bryan–Cox–Semtner (BCS) ocean model architecture. In the BCS architecture, scalar tracers reside at cell centers on a uniform horizontal grid in a level (constant thickness) layer, and conservation is enforced through a flux-form finite-volume update. Your program must implement a two-dimensional, depth-integrated, passive tracer undergoing horizontal diffusion in a rectangular domain with uniform layer thickness. Velocities are zero, so there is no advection. The only source of tracer mass is a specified diffusive boundary flux on the western boundary; all other boundaries are impermeable to diffusion. The test is to verify that the domain-integrated tracer mass changes only due to this prescribed boundary flux over a long integration.\n\nFundamental base to use:\n- Conservation of mass and the divergence theorem: if the depth-integrated diffusive flux vector is denoted by $\\mathbf{F} = - K H \\nabla C$, where $K$ is the constant horizontal diffusivity, $H$ is the constant layer thickness, and $C$ is the tracer concentration, then for any control volume $V$,\n$$\n\\frac{d}{dt} \\int_V H C \\, dA \\;=\\; - \\int_{\\partial V} \\mathbf{F} \\cdot \\mathbf{n} \\, d\\ell,\n$$\nwith $\\mathbf{n}$ the outward unit normal and $d\\ell$ the boundary line element. This is the foundation for a flux-form, finite-volume discretization. You must not use any unstated formulas beyond this base; derive any discrete updates you need from this principle.\n\nDiscrete computational setting and constraints:\n- Geometry: a rectangular domain discretized into $N_x \\times N_y$ uniform cells, with grid spacings $\\Delta x$ and $\\Delta y$ (in meters), and a constant layer thickness $H$ (in meters).\n- Tracer: the prognostic variable is the depth-averaged concentration $C$ with units $\\mathrm{kg}\\,\\mathrm{m}^{-3}$; the cell mass is $M = H \\, C \\, \\Delta x \\, \\Delta y$ in $\\mathrm{kg}$.\n- Physics: no advection; pure horizontal diffusion with constant diffusivity $K$ (in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$). The depth-integrated diffusive flux per unit boundary length is $\\mathbf{F} = - K H \\nabla C$ with units $\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}$.\n- Boundary conditions:\n  - West boundary ($x = 0$): impose a specified depth-integrated diffusive flux per unit length $f_W(t)$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}$) into the domain. This is a Neumann condition implemented through the normal gradient consistent with Fick’s law. The total imposed influx across the west boundary at time $t$ is $B_W(t) = f_W(t) \\, L_y$, where $L_y = N_y \\, \\Delta y$ is the meridional boundary length.\n  - East, South, North boundaries: no diffusive flux, that is, zero normal gradient of $C$.\n- Time stepping: explicit forward time-stepping with step $\\Delta t$ (in seconds), observing the stability constraint for horizontal diffusion on a uniform grid. You must discretize the divergence of fluxes in a way consistent with finite volumes, so that the discrete global mass budget is the sum of boundary fluxes.\n\nDiagnostic and verification requirement:\n- At each time step, compute the domain-integrated tracer mass $M_{\\mathrm{tot}}(t)$ and the cumulative time integral of the net boundary influx $I_B(t) = \\int_0^t B(\\tau)\\, d\\tau$, where $B(t)$ is the sum of diffusive boundary influxes into the domain at time $t$ across all four sides. Because only the west boundary has a specified influx, but the other boundaries enforce zero diffusive flux, $B(t)$ reduces to the west boundary contribution up to numerical round-off. After integrating to the final time $T$, report the conservation residual defined as the absolute relative error\n$$\n\\mathcal{R} \\;=\\; \\frac{\\left| \\left(M_{\\mathrm{tot}}(T) - M_{\\mathrm{tot}}(0)\\right) - I_B(T) \\right|}{\\max\\left( \\left| M_{\\mathrm{tot}}(0) \\right|, \\left| I_B(T) \\right|, 1 \\right)}.\n$$\nThis is a dimensionless quantity. The numerator has units of $\\mathrm{kg}$, and the denominator balances the scaling to avoid division by $0$ when both initial mass and total boundary input are small.\n\nImplementation details to respect the Bryan–Cox–Semtner ocean model architecture:\n- Use a flux-form finite-volume discretization with tracer values located at cell centers. Compute face-normal diffusive fluxes from cell-center gradients using one ghost-cell layer to enforce the Neumann boundary conditions, including the specified western boundary flux. Update cell masses by summing fluxes times the corresponding face lengths. Then update concentrations from the updated masses by dividing by $H \\, \\Delta x \\, \\Delta y$.\n- Use explicit time stepping. You must ensure the choice of $\\Delta t$ in the provided tests is numerically stable for diffusion on a uniform grid.\n\nTest suite you must implement:\nFor each test, initialize $C(\\mathbf{x}, 0)$ and integrate to final time $T$ using the given parameters. Angles are not involved. Always use the units specified above; in particular, lengths in meters and times in seconds. The program must compute and return the dimensionless residual $\\mathcal{R}$ for each test.\n\n- Test 1 (closed domain, no mass change expected):\n  - $N_x = 24$, $N_y = 16$, $\\Delta x = 10^5\\,\\mathrm{m}$, $\\Delta y = 10^5\\,\\mathrm{m}$, $H = 100\\,\\mathrm{m}$, $K = 200\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $\\Delta t = 1800\\,\\mathrm{s}$, $T = 15 \\times 86400\\,\\mathrm{s}$.\n  - Initial concentration $C(\\mathbf{x}, 0) = 10^{-6}\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$ everywhere.\n  - Western boundary flux $f_W(t) = 0$ for all $t$.\n  - Expected: $\\mathcal{R}$ should be small because $M_{\\mathrm{tot}}(T) \\approx M_{\\mathrm{tot}}(0)$ and $I_B(T) = 0$.\n\n- Test 2 (constant specified western influx):\n  - $N_x = 30$, $N_y = 18$, $\\Delta x = 5 \\times 10^4\\,\\mathrm{m}$, $\\Delta y = 5 \\times 10^4\\,\\mathrm{m}$, $H = 200\\,\\mathrm{m}$, $K = 50\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $\\Delta t = 1200\\,\\mathrm{s}$, $T = 10 \\times 86400\\,\\mathrm{s}$.\n  - Initial concentration $C(\\mathbf{x}, 0) = 0\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$ everywhere.\n  - Western boundary flux $f_W(t) = 2 \\times 10^{-5}\\,\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}$ for all $t$.\n  - Expected: $M_{\\mathrm{tot}}(T) - M_{\\mathrm{tot}}(0)$ matches $I_B(T) \\approx f_W \\, L_y \\, T$, hence small $\\mathcal{R}$.\n\n- Test 3 (edge case with $N_x = 1$ and time-varying flux):\n  - $N_x = 1$, $N_y = 7$, $\\Delta x = 5 \\times 10^4\\,\\mathrm{m}$, $\\Delta y = 5 \\times 10^4\\,\\mathrm{m}$, $H = 400\\,\\mathrm{m}$, $K = 500\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $\\Delta t = 600\\,\\mathrm{s}$, $T = 36000\\,\\mathrm{s}$.\n  - Initial concentration $C(\\mathbf{x}, 0) = 0\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$ everywhere.\n  - Western boundary flux ramp $f_W(t) = a \\, t$ with $a = 10^{-9}\\,\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}$ for $t \\in [0, T]$.\n  - Expected: $I_B(T) \\approx \\int_0^T a t \\, dt \\times L_y = \\frac{1}{2} a T^2 L_y$, and $\\mathcal{R}$ is small.\n\nRequired program output:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the tests above. Each entry must be the scalar floating-point value of $\\mathcal{R}$ for that test, for example, \"[0.0,0.0,0.0]\". The numbers are dimensionless.\n\nYour implementation must be fully self-contained, require no input, and must adhere to the constraints stated here. The numerical scheme must be derived from the stated conservation law and must be demonstrably conservative in the sense specified by the diagnostic.",
            "solution": "The problem presented is a well-posed initial-boundary value problem for the two-dimensional diffusion equation, to be solved on a rectangular domain using a finite-volume method. All necessary parameters, physical laws, and boundary conditions are provided, and they are scientifically and internally consistent. The parameters for the numerical scheme are chosen such that the stability criterion for explicit time-stepping is satisfied. The problem is therefore deemed valid.\n\nThe solution is derived from the fundamental principle of mass conservation for a passive tracer and implemented using a flux-form finite-volume method, consistent with the Bryan–Cox–Semtner (BCS) ocean model architecture.\n\nThe governing principle is the conservation of a tracer with concentration $C$ in a layer of constant thickness $H$. The rate of change of total tracer mass, $\\int_V H C \\, dA$, within a control volume $V$ is equal to the net flux of the tracer across its boundary $\\partial V$. For a purely diffusive process, this is expressed by the divergence theorem:\n$$\n\\frac{d}{dt} \\int_V H C \\, dA \\;=\\; - \\int_{\\partial V} \\mathbf{F} \\cdot \\mathbf{n} \\, d\\ell\n$$\nwhere $\\mathbf{F} = - K H \\nabla C$ is the depth-integrated diffusive flux vector, $K$ is the constant horizontal diffusivity, and $\\mathbf{n}$ is the outward unit normal vector.\n\nWe discretize the domain into a uniform grid of $N_x \\times N_y$ cells, each of size $\\Delta x \\times \\Delta y$. The tracer concentration $C_{i,j}$ is defined at the center of each cell $(i, j)$, for $i \\in [1, N_x]$ and $j \\in [1, N_y]$. The mass in cell $(i,j)$ is $M_{i,j} = H C_{i,j} \\Delta x \\Delta y$.\n\nApplying the conservation law to a single grid cell $(i,j)$, the rate of change of mass is the sum of fluxes across its four faces:\n$$\n\\frac{dM_{i,j}}{dt} = \\mathcal{F}^x_{i-1/2, j} - \\mathcal{F}^x_{i+1/2, j} + \\mathcal{F}^y_{i, j-1/2} - \\mathcal{F}^y_{i, j+1/2}\n$$\nHere, $\\mathcal{F}^x_{i+1/2, j}$ is the total mass flux rate (in $\\mathrm{kg}\\,\\mathrm{s}^{-1}$) across the eastern face of cell $(i,j)$ (at $x=x_{i+1/2}$), and $\\mathcal{F}^y_{i, j+1/2}$ is the flux rate across the northern face.\n\nThese fluxes are approximated using centered finite differences. The flux across the face between cell $(i,j)$ and $(i+1,j)$ is:\n$$\n\\mathcal{F}^x_{i+1/2, j} = \\left. \\left( -K H \\frac{\\partial C}{\\partial x} \\right) \\right|_{i+1/2,j} \\Delta y \\approx -K H \\frac{C_{i+1,j} - C_{i,j}}{\\Delta x} \\Delta y\n$$\nSimilarly, the flux across the face between cell $(i,j)$ and $(i,j+1)$ is:\n$$\n\\mathcal{F}^y_{i, j+1/2} = \\left. \\left( -K H \\frac{\\partial C}{\\partial y} \\right) \\right|_{i,j+1/2} \\Delta x \\approx -K H \\frac{C_{i,j+1} - C_{i,j}}{\\Delta y} \\Delta x\n$$\nThe problem specifies an explicit forward time-stepping scheme. The mass in each cell is updated from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ as follows:\n$$\nM_{i,j}^{n+1} = M_{i,j}^{n} + \\Delta t \\left( \\mathcal{F}^x_{i-1/2, j} - \\mathcal{F}^x_{i+1/2, j} + \\mathcal{F}^y_{i, j-1/2} - \\mathcal{F}^y_{i, j+1/2} \\right)^n\n$$\nwhere the fluxes are computed using concentrations at time $t_n$. After updating the mass, the new concentration is found via $C_{i,j}^{n+1} = M_{i,j}^{n+1} / (H \\Delta x \\Delta y)$.\n\nThe Neumann boundary conditions are implemented using a layer of ghost cells around the perimeter of the computational domain.\n- For the East, North, and South boundaries, the no-flux condition ($\\nabla C \\cdot \\mathbf{n} = 0$) is enforced. For the eastern boundary at $i=N_x$, this means $\\mathcal{F}^x_{N_x+1/2, j} = 0$. This condition is satisfied by setting the concentration in the eastern ghost cell $C_{N_x+1, j}$ equal to the concentration in the adjacent interior cell, $C_{N_x, j}$. Similar logic applies to the north and south boundaries, i.e., $C_{i, N_y+1} = C_{i, N_y}$ and $C_{i, 0} = C_{i, 1}$.\n\n- For the West boundary at $i=1$, a specified depth-integrated influx per unit length, $f_W(t)$, is imposed. This means the flux across the western face of cell $(1,j)$ is $\\mathcal{F}^x_{1/2, j} = f_W(t_n) \\Delta y$. Equating this to the discretized flux expression yields a condition on the western ghost cell $C_{0,j}$:\n$$\nf_W(t_n) \\Delta y = -K H \\frac{C_{1,j}^n - C_{0,j}^n}{\\Delta x} \\Delta y \\implies C_{0,j}^n = C_{1,j}^n + \\frac{f_W(t_n) \\Delta x}{K H}\n$$\n\nThe verification test relies on the perfect conservation property of this finite-volume scheme. When the mass update equation is summed over all interior cells, all internal fluxes cancel out in a telescoping sum. The rate of change of the total domain-integrated mass, $M_{\\mathrm{tot}} = \\sum_{i,j} M_{i,j}$, is exactly equal to the sum of the fluxes across the domain's outer boundaries, $B(t)$:\n$$\n\\frac{dM_{\\mathrm{tot}}}{dt} = B(t) = \\sum_{j=1}^{N_y} \\mathcal{F}^x_{1/2,j} - \\sum_{j=1}^{N_y} \\mathcal{F}^x_{N_x+1/2,j} + \\sum_{i=1}^{N_x} \\mathcal{F}^y_ {i,1/2} - \\sum_{i=1}^{N_x} \\mathcal{F}^y_{i,N_y+1/2}\n$$\nWith our boundary conditions, this simplifies to $B(t) = \\sum_{j=1}^{N_y} f_W(t) \\Delta y = f_W(t) L_y$.\n Integrating from $t=0$ to $t=T$ gives the analytical identity $M_{\\mathrm{tot}}(T) - M_{\\mathrm{tot}}(0) = \\int_0^T B(\\tau) d\\tau$.\nIn our discrete simulation, we compute the change in total mass, $\\Delta M = M_{\\mathrm{tot}}(T) - M_{\\mathrm{tot}}(0)$, by summing the final cell masses. We also compute the total mass that entered through the boundaries, $I_B(T)$, by accumulating the boundary flux at each time step: $I_B(T) = \\sum_{n=0}^{N_{steps}-1} B(t_n) \\Delta t$.\nThe numerical scheme is conservative, so we expect $\\Delta M \\approx I_B(T)$, with any difference arising from floating-point round-off error. The conservation residual $\\mathcal{R}$ quantifies this difference:\n$$\n\\mathcal{R} \\;=\\; \\frac{\\left| \\left(M_{\\mathrm{tot}}(T) - M_{\\mathrm{tot}}(0)\\right) - I_B(T) \\right|}{\\max\\left( \\left| M_{\\mathrm{tot}}(0) \\right|, \\left| I_B(T) \\right|, 1 \\right)}\n$$\nA small value of $\\mathcal{R}$ verifies that the implementation conserves the tracer mass as intended.\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(Nx, Ny, dx, dy, H, K, dt, T, C0_val, fW_func):\n    \"\"\"\n    Implements a 2D finite-volume model for tracer diffusion and\n    verifies mass conservation.\n\n    Args:\n        Nx (int): Number of cells in x-direction.\n        Ny (int): Number of cells in y-direction.\n        dx (float): Grid spacing in x (meters).\n        dy (float): Grid spacing in y (meters).\n        H (float): Layer thickness (meters).\n        K (float): Diffusivity (m^2/s).\n        dt (float): Time step (seconds).\n        T (float): Total integration time (seconds).\n        C0_val (float): Initial tracer concentration (kg/m^3).\n        fW_func (callable): Function f(t) for western boundary flux (kg/m/s).\n\n    Returns:\n        float: The dimensionless conservation residual R.\n    \"\"\"\n    # 1. Initialization\n    # Use a padded grid for ghost cells. C[1:-1, 1:-1] is the interior.\n    # Using float64 for better precision is crucial for this test.\n    C = np.zeros((Nx + 2, Ny + 2), dtype=np.float64)\n    if C0_val != 0:\n        C[1:-1, 1:-1] = C0_val\n\n    cell_volume = H * dx * dy\n    M_tot_0 = np.sum(C[1:-1, 1:-1]) * cell_volume\n\n    I_B = 0.0\n    num_steps = int(round(T / dt))\n\n    # Pre-calculate factors for efficiency inside the loop\n    if K > 0 and H > 0:\n        ghost_cell_factor = dx / (K * H)\n    else:\n        ghost_cell_factor = 0 # No flux if K or H is zero\n\n    # 2. Main Time-Stepping Loop\n    for n in range(num_steps):\n        current_t = n * dt\n\n        # a. Set Ghost Cell values to enforce boundary conditions\n        # North/South: No flux (dC/dy = 0)\n        C[:, 0] = C[:, 1]\n        C[:, -1] = C[:, -2]\n        \n        # East: No flux (dC/dx = 0)\n        C[-1, :] = C[-2, :]\n        \n        # West: Specified flux\n        fW_t = fW_func(current_t)\n        C[0, 1:-1] = C[1, 1:-1] + fW_t * ghost_cell_factor\n        \n        # Corner ghost cells are not strictly needed for this 5-point stencil's\n        # interior update but are set for completeness.\n        C[0, 0] = C[1, 1]\n        C[0, -1] = C[1, -2]\n        C[-1, 0] = C[-2, 1]\n        C[-1, -1] = C[-2, -2]\n\n        # b. Calculate mass fluxes across cell faces (in kg/s)\n        # flux_x[i, j] is flux across face between cell (i, j) and (i+1, j)\n        # of the interior grid. Array shape is (Nx+1, Ny).\n        flux_x = -K * H * (C[1:, 1:-1] - C[:-1, 1:-1]) / dx * dy\n\n        # flux_y[i, j] is flux across face between cell (i, j) and (i, j+1).\n        # Array shape is (Nx, Ny+1).\n        flux_y = -K * H * (C[1:-1, 1:] - C[1:-1, :-1]) / dy * dx\n\n        # c. Calculate rate of mass change for interior cells\n        # dM_dt has shape (Nx, Ny)\n        dM_dt = (flux_x[:-1, :] - flux_x[1:, :]) + \\\n                (flux_y[:, :-1] - flux_y[:, 1:])\n\n        # d. Update mass and then concentration\n        M_interior = C[1:-1, 1:-1] * cell_volume\n        M_interior += dM_dt * dt\n        C[1:-1, 1:-1] = M_interior / cell_volume\n\n        # e. Update diagnostics for conservation check\n        # Total boundary influx B(t) is computed by summing the boundary fluxes.\n        # Due to the no-flux BCs, only the western boundary contributes.\n        # The flux into the westernmost cells is flux_x[0, :].\n        B_t = np.sum(flux_x[0, :])\n        I_B += B_t * dt\n\n    # 3. Final Calculation\n    M_tot_T = np.sum(C[1:-1, 1:-1]) * cell_volume\n    \n    change_in_mass = M_tot_T - M_tot_0\n    \n    numerator = abs(change_in_mass - I_B)\n    denominator = max(abs(M_tot_0), abs(I_B), 1.0)\n    \n    residual = numerator / denominator\n    \n    return residual\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite for the tracer conservation verification.\n    \"\"\"\n    test_cases = [\n        # Test 1: Closed domain\n        {\n            \"Nx\": 24, \"Ny\": 16, \"dx\": 1e5, \"dy\": 1e5, \"H\": 100.0, \"K\": 200.0,\n            \"dt\": 1800.0, \"T\": 15 * 86400.0, \"C0_val\": 1e-6,\n            \"fW_func\": lambda t: 0.0\n        },\n        # Test 2: Constant western influx\n        {\n            \"Nx\": 30, \"Ny\": 18, \"dx\": 5e4, \"dy\": 5e4, \"H\": 200.0, \"K\": 50.0,\n            \"dt\": 1200.0, \"T\": 10 * 86400.0, \"C0_val\": 0.0,\n            \"fW_func\": lambda t: 2e-5\n        },\n        # Test 3: Edge case with Nx=1 and time-varying flux\n        {\n            \"Nx\": 1, \"Ny\": 7, \"dx\": 5e4, \"dy\": 5e4, \"H\": 400.0, \"K\": 500.0,\n            \"dt\": 600.0, \"T\": 36000.0, \"C0_val\": 0.0,\n            \"fW_func\": lambda t, a=1e-9: a * t\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        residual = run_simulation(**params)\n        results.append(residual)\n    \n    return f\"[{','.join(map(str, results))}]\"\n\n# The answer is the output of the solve function.\n# print(solve())\n```",
            "answer": "[2.641662884433157e-16,1.0360662235940455e-16,2.164834279515438e-17]"
        }
    ]
}