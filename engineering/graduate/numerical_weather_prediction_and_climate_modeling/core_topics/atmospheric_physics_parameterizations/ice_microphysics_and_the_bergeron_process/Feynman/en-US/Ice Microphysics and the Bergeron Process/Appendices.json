{
    "hands_on_practices": [
        {
            "introduction": "The efficiency of the Bergeron process is governed by the saturation vapor pressure difference between supercooled water, $e_s^w$, and ice, $e_s^i$. This practice moves beyond a qualitative understanding by tasking you to quantify this thermodynamic driver. By applying the Clausius-Clapeyron relation, you will derive the temperature sensitivity $S(T)$ of the ratio $e_s^i/e_s^w$, revealing how the potential for ice growth changes within different regions of a mixed-phase cloud .",
            "id": "4053787",
            "problem": "In a mixed-phase cloud, the Bergeron process arises because the saturation vapor pressure over ice, $e_s^i(T)$, is lower than that over supercooled liquid water, $e_s^w(T)$, for $T  273.15\\,\\mathrm{K}$, which drives net deposition onto ice crystals and evaporation from liquid droplets. Consider the temperature sensitivity of the ratio $e_s^i/e_s^w$ as a controlling thermodynamic factor in this process. Using the Clausius–Clapeyron differential form $d\\ln e_s/dT = L/(R_v T^2)$, where $L$ is the appropriate latent heat and $R_v$ is the gas constant for water vapor, derive the sensitivity $S(T) \\equiv d\\ln\\!\\left(e_s^i/e_s^w\\right)/dT$ from first principles and evaluate it at $T=263\\,\\mathrm{K}$ using the constants $R_v = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$, latent heat of vaporization $L_w = 2.50 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, and latent heat of sublimation $L_i = 2.835 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$. Treat $L_w$ and $L_i$ as temperature-independent near the evaluation point. Then, briefly explain the sign and magnitude of $S(T)$ in terms of the thermodynamic driving of the Bergeron process in numerical weather prediction and climate models.\n\nRound your final numerical answer for $S(T)$ to four significant figures. Express the final sensitivity in $\\mathrm{K}^{-1}$.",
            "solution": "The problem statement is critically validated before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **Process:** Bergeron process in a mixed-phase cloud.\n- **Physical Principle:** The saturation vapor pressure over ice, $e_s^i(T)$, is lower than that over supercooled liquid water, $e_s^w(T)$, for temperatures $T  273.15\\,\\mathrm{K}$.\n- **Quantity to Derive:** The temperature sensitivity $S(T) \\equiv d\\ln(e_s^i/e_s^w)/dT$.\n- **Governing Equation:** The Clausius–Clapeyron differential form, $d\\ln e_s/dT = L/(R_v T^2)$, where $L$ is the appropriate latent heat and $R_v$ is the gas constant for water vapor.\n- **Evaluation Temperature:** $T = 263\\,\\mathrm{K}$.\n- **Constants:**\n  - Gas constant for water vapor, $R_v = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$.\n  - Latent heat of vaporization, $L_w = 2.50 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$.\n  - Latent heat of sublimation, $L_i = 2.835 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$.\n- **Assumption:** $L_w$ and $L_i$ are treated as temperature-independent.\n- **Additional Task:** Briefly explain the sign and magnitude of $S(T)$ in the context of the Bergeron process in numerical models.\n- **Final Answer Precision:** Round the numerical value of $S(T)$ to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is based on fundamental principles of atmospheric thermodynamics, specifically the Clausius–Clapeyron relation and its application to phase changes of water in clouds (the Bergeron process). All concepts and constants are standard in meteorology and physics. The premise that $e_s^i  e_s^w$ for $T  273.15\\,\\mathrm{K}$ is factually correct.\n2.  **Well-Posed:** The problem provides a clear definition for the quantity to be derived, $S(T)$, the governing equation, all necessary constants, and a specific temperature for evaluation. The task is unambiguous and leads to a unique solution.\n3.  **Objective:** The problem is stated in precise, technical language with no subjective or qualitative claims.\n4.  **Consistency and Feasibility:** The given values for latent heats are physically realistic. The latent heat of fusion can be inferred as $L_f = L_i - L_w = (2.835 - 2.50) \\times 10^6 = 0.335 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, which is a standard value. There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, self-contained, and well-posed. It is deemed **valid**. A full solution will be developed.\n\n### Derivation of the Sensitivity $S(T)$\nThe sensitivity $S(T)$ is defined as:\n$$S(T) \\equiv \\frac{d}{dT}\\left[\\ln\\left(\\frac{e_s^i}{e_s^w}\\right)\\right]$$\nUsing the properties of the natural logarithm, we can rewrite the expression as the difference of two logarithms:\n$$S(T) = \\frac{d}{dT}\\left[\\ln(e_s^i) - \\ln(e_s^w)\\right]$$\nApplying the derivative with respect to temperature $T$:\n$$S(T) = \\frac{d\\ln(e_s^i)}{dT} - \\frac{d\\ln(e_s^w)}{dT}$$\nThe problem provides the Clausius–Clapeyron relation in the form $d\\ln e_s/dT = L/(R_v T^2)$. We apply this relation to each term.\n\nFor the saturation vapor pressure over ice, $e_s^i$, the relevant phase transition is sublimation (solid to vapor). Therefore, the appropriate latent heat is the latent heat of sublimation, $L_i$.\n$$\\frac{d\\ln(e_s^i)}{dT} = \\frac{L_i}{R_v T^2}$$\nFor the saturation vapor pressure over liquid water, $e_s^w$, the relevant phase transition is vaporization (liquid to vapor). The appropriate latent heat is the latent heat of vaporization, $L_w$.\n$$\\frac{d\\ln(e_s^w)}{dT} = \\frac{L_w}{R_v T^2}$$\nSubstituting these expressions back into the equation for $S(T)$:\n$$S(T) = \\frac{L_i}{R_v T^2} - \\frac{L_w}{R_v T^2}$$\nFactoring out the common terms, we arrive at the final analytical expression for the sensitivity:\n$$S(T) = \\frac{L_i - L_w}{R_v T^2}$$\nThe term $L_i - L_w$ represents the latent heat of fusion, $L_f$, which is the energy difference between sublimation and vaporization at a given temperature.\n\n### Numerical Evaluation at $T = 263\\,\\mathrm{K}$\nWe now substitute the given numerical values into the derived expression for $S(T)$.\n- $L_i = 2.835 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$\n- $L_w = 2.50 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$\n- $R_v = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n- $T = 263\\,\\mathrm{K}$\n\n$$S(263\\,\\mathrm{K}) = \\frac{(2.835 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}) - (2.50 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1})}{(461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}) \\times (263\\,\\mathrm{K})^2}$$\n$$S(263\\,\\mathrm{K}) = \\frac{0.335 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}}{461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1} \\times 69169\\,\\mathrm{K}^2}$$\n$$S(263\\,\\mathrm{K}) = \\frac{335000}{31886909}\\,\\mathrm{K}^{-1}$$\n$$S(263\\,\\mathrm{K}) \\approx 0.01050591\\,\\mathrm{K}^{-1}$$\nRounding the result to four significant figures as requested:\n$$S(263\\,\\mathrm{K}) \\approx 1.051 \\times 10^{-2}\\,\\mathrm{K}^{-1}$$\n\n### Explanation of Sign and Magnitude\nThe derived sensitivity, $S(T) = (L_i - L_w)/(R_v T^2)$, has a clear physical interpretation.\n\n**Sign:** The sign of $S(T)$ is determined by the numerator, $L_i - L_w = L_f$. Since sublimation ($L_i$) always requires more energy than vaporization ($L_w$) because it includes the energy for the solid-to-liquid phase change, $L_i > L_w$ and the numerator is positive. The denominator, $R_v T^2$, is also always positive. Thus, $S(T)$ is positive for all temperatures. A positive sign for $S(T) = d\\ln(e_s^i/e_s^w)/dT$ indicates that the ratio $e_s^i/e_s^w$ increases with temperature. This is physically consistent: for $T  273.15\\,\\mathrm{K}$, the ratio is less than $1$, and as $T$ rises towards $273.15\\,\\mathrm{K}$, the ratio approaches $1$ from below. A function increasing towards a limit has a positive derivative. The Bergeron process is driven by the supersaturation with respect to ice, which is proportional to $e_s^w/e_s^i - 1$. The fact that $S(T) > 0$ is equivalent to $d\\ln(e_s^w/e_s^i)/dT  0$, meaning the supersaturation that drives the process becomes stronger as the temperature falls further below freezing.\n\n**Magnitude:** The magnitude of $S(263\\,\\mathrm{K}) \\approx 1.051 \\times 10^{-2}\\,\\mathrm{K}^{-1}$ quantifies the temperature sensitivity of the thermodynamic forcing for the Bergeron process near $-10\\,^{\\circ}\\mathrm{C}$. This value implies that the logarithmic ratio of the saturation vapor pressures changes by approximately $1.051\\%$ per Kelvin change in temperature. In numerical weather prediction (NWP) and climate models, this sensitivity is a critical parameter. It dictates how rapidly the rate of ice crystal growth at the expense of supercooled droplets (glaciation) will change in response to small temperature fluctuations within a mixed-phase cloud. The temperature $263\\,\\mathrm{K}$ is near the range where the absolute difference $e_s^w - e_s^i$ is maximal, making the Bergeron process most efficient. An accurate representation of this sensitivity in a model's microphysics scheme is essential for correctly simulating cloud phase partitioning, precipitation formation, and the cloud radiative properties, which are all crucial for accurate weather forecasts and climate projections.",
            "answer": "$$\n\\boxed{1.051 \\times 10^{-2}}\n$$"
        },
        {
            "introduction": "In atmospheric models, the net change in liquid water content, $q_l$, often results from competition between multiple microphysical pathways. This exercise places you in the role of a model developer, evaluating two processes that consume supercooled liquid: the Bergeron process (via vapor deposition onto ice) and riming. You will model the mass depletion rates, $R_{\\mathrm{Bergeron}}$ and $R_{\\mathrm{rime}}$, to determine which pathway is dominant under specific cloud conditions, a crucial step in correctly simulating precipitation formation .",
            "id": "4053809",
            "problem": "Consider a well-mixed, shallow stratiform cloud at temperature $T = 263\\,\\mathrm{K}$ in which both vapor deposition onto ice (the Bergeron-Findeisen process) and riming act to deplete liquid water. Assume monodisperse, spherical ice particles of radius $r_i = 1.0 \\times 10^{-4}\\,\\mathrm{m}$ with terminal fall speed $V_i = 0.5\\,\\mathrm{m\\,s^{-1}}$, and that ventilation effects are negligible (ventilation factor equal to $1$). The ambient air density is $\\rho_{\\mathrm{air}} = 1.2\\,\\mathrm{kg\\,m^{-3}}$, the diffusivity of water vapor in air is $D_v = 2.1 \\times 10^{-5}\\,\\mathrm{m^2\\,s^{-1}}$, and the saturation water vapor density over ice at $T = 263\\,\\mathrm{K}$ is $\\rho_{v,i}^{*} = 2.145 \\times 10^{-3}\\,\\mathrm{kg\\,m^{-3}}$. Let the liquid water mass mixing ratio be $q_l = 2.0 \\times 10^{-4}$, the collection efficiency for riming be $E_c = 0.7$, and the supersaturation over ice be $S_i = 0.01$.\n\nStarting from fundamental transport principles, model the Bergeron-Findeisen deposition onto a single spherical ice particle as diffusion-limited with mass growth rate $\\dot{m}_d$ proportional to the product of geometric conductance and the excess vapor mass density, and model riming on a single spherical ice particle as geometric sweep-out of liquid mass with collision efficiency. Specifically, use:\n- Fick's law for diffusion to a spherical sink and small-supersaturation linearization to relate the deposition rate to $D_v$, $r_i$, and $\\rho_{v,i}^{*} S_i$.\n- Geometric collection for riming to relate the mass accretion rate to $E_c$, $\\pi r_i^2$, $V_i$, and the ambient liquid mass per unit volume $\\rho_{\\mathrm{air}} q_l$.\n\nAssume the cloud volume contains $N_i$ ice particles per unit volume but note that $N_i$ cancels in the required fraction. Derive an expression for the fraction of total liquid water depletion accomplished by riming,\n$$\nf_{\\mathrm{rime}} = \\frac{R_{\\mathrm{rime}}}{R_{\\mathrm{rime}} + R_{\\mathrm{Bergeron}}},\n$$\nwhere $R_{\\mathrm{rime}}$ and $R_{\\mathrm{Bergeron}}$ are the volumetric depletion rates of liquid water due to riming and the Bergeron-Findeisen process, respectively, and then compute its numerical value using the given parameters. Express your final answer as a decimal number rounded to four significant figures. No percentage sign is permitted.",
            "solution": "This problem requires us to compare the rates of two competing microphysical processes that deplete liquid water in a mixed-phase cloud: riming (direct collection of liquid droplets by ice particles) and the Bergeron-Findeisen process (indirect depletion via evaporation of droplets to feed vapor deposition onto ice). We will model the volumetric rate of each process, derive an expression for the fraction of depletion due to riming, and calculate its value.\n\n### Step 1: Model the Liquid Water Depletion Rates\n\nThe problem asks for volumetric depletion rates, $R$, which have units of $\\mathrm{kg}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$. These are found by multiplying the rate of mass gain for a single ice particle by the number concentration of ice particles, $N_i$.\n\n**Bergeron-Findeisen Process (Deposition)**\nThe Bergeron process depletes liquid water indirectly. The rate of liquid water depletion is equal to the rate of mass growth of ice particles by vapor deposition. For a single spherical particle, the diffusion-limited mass growth rate ($\\dot{m}_d$) is given by:\n$$ \\dot{m}_d = 4 \\pi r_i D_v (\\rho_{v, \\infty} - \\rho_{v,i}^{*}) $$\nwhere $r_i$ is the particle radius, $D_v$ is the vapor diffusivity, $\\rho_{v, \\infty}$ is the ambient vapor density, and $\\rho_{v,i}^{*}$ is the saturation vapor density at the ice particle's surface. The excess vapor density is related to the supersaturation with respect to ice, $S_i$, by $(\\rho_{v, \\infty} - \\rho_{v,i}^{*}) = S_i \\rho_{v,i}^{*}$. Thus:\n$$ \\dot{m}_d = 4 \\pi r_i D_v S_i \\rho_{v,i}^{*} $$\nThe volumetric rate of depletion, $R_{\\mathrm{Bergeron}}$, is then:\n$$ R_{\\mathrm{Bergeron}} = N_i \\dot{m}_d = N_i (4 \\pi r_i D_v S_i \\rho_{v,i}^{*}) $$\n\n**Riming Process (Accretion)**\nRiming is the direct collection of supercooled liquid droplets by falling ice particles. The mass accretion rate for a single particle ($\\dot{m}_r$) is modeled by the geometric sweep-out principle:\n$$ \\dot{m}_r = A_c V_i \\rho_l E_c $$\nwhere $A_c = \\pi r_i^2$ is the particle's cross-sectional area, $V_i$ is its terminal velocity, $\\rho_l$ is the liquid water content (mass of liquid per unit volume of air), and $E_c$ is the dimensionless collection efficiency. The liquid water content is given by $\\rho_l = \\rho_{\\mathrm{air}} q_l$. So:\n$$ \\dot{m}_r = (\\pi r_i^2) V_i (\\rho_{\\mathrm{air}} q_l) E_c $$\nThe volumetric rate of depletion, $R_{\\mathrm{rime}}$, is:\n$$ R_{\\mathrm{rime}} = N_i \\dot{m}_r = N_i (E_c \\pi r_i^2 V_i \\rho_{\\mathrm{air}} q_l) $$\n\n### Step 2: Derive the Fraction due to Riming, $f_{\\mathrm{rime}}$\n\nThe fraction of total liquid water depletion accomplished by riming is defined as:\n$$ f_{\\mathrm{rime}} = \\frac{R_{\\mathrm{rime}}}{R_{\\mathrm{rime}} + R_{\\mathrm{Bergeron}}} $$\nSubstituting the expressions from Step 1:\n$$ f_{\\mathrm{rime}} = \\frac{N_i (E_c \\pi r_i^2 V_i \\rho_{\\mathrm{air}} q_l)}{N_i (E_c \\pi r_i^2 V_i \\rho_{\\mathrm{air}} q_l) + N_i (4 \\pi r_i D_v S_i \\rho_{v,i}^{*})} $$\nAs noted in the problem, the ice particle number concentration, $N_i$, cancels. We can also cancel a common factor of $\\pi r_i$:\n$$ f_{\\mathrm{rime}} = \\frac{E_c r_i V_i \\rho_{\\mathrm{air}} q_l}{E_c r_i V_i \\rho_{\\mathrm{air}} q_l + 4 D_v S_i \\rho_{v,i}^{*}} $$\nThis is the final analytical expression.\n\n### Step 3: Numerical Calculation\n\nWe now substitute the given parameter values into the derived expression.\n- $E_c = 0.7$\n- $r_i = 1.0 \\times 10^{-4}\\,\\mathrm{m}$\n- $V_i = 0.5\\,\\mathrm{m\\,s^{-1}}$\n- $\\rho_{\\mathrm{air}} = 1.2\\,\\mathrm{kg\\,m^{-3}}$\n- $q_l = 2.0 \\times 10^{-4}$\n- $D_v = 2.1 \\times 10^{-5}\\,\\mathrm{m^2\\,s^{-1}}$\n- $S_i = 0.01$\n- $\\rho_{v,i}^{*} = 2.145 \\times 10^{-3}\\,\\mathrm{kg\\,m^{-3}}$\n\nFirst, calculate the numerator term, which corresponds to the riming process:\n$$ \\text{Term}_{\\mathrm{rime}} = E_c r_i V_i \\rho_{\\mathrm{air}} q_l = (0.7) \\times (1.0 \\times 10^{-4}\\,\\mathrm{m}) \\times (0.5\\,\\mathrm{m\\,s^{-1}}) \\times (1.2\\,\\mathrm{kg\\,m^{-3}}) \\times (2.0 \\times 10^{-4}) $$\n$$ \\text{Term}_{\\mathrm{rime}} = 0.84 \\times 10^{-8}\\,\\mathrm{kg\\,m^{-1}\\,s^{-1}} $$\n\nNext, calculate the term in the denominator corresponding to the Bergeron process:\n$$ \\text{Term}_{\\mathrm{Bergeron}} = 4 D_v S_i \\rho_{v,i}^{*} = 4 \\times (2.1 \\times 10^{-5}\\,\\mathrm{m^2\\,s^{-1}}) \\times (0.01) \\times (2.145 \\times 10^{-3}\\,\\mathrm{kg\\,m^{-3}}) $$\n$$ \\text{Term}_{\\mathrm{Bergeron}} = 1.8018 \\times 10^{-9}\\,\\mathrm{kg\\,m^{-1}\\,s^{-1}} = 0.18018 \\times 10^{-8}\\,\\mathrm{kg\\,m^{-1}\\,s^{-1}} $$\n\nFinally, compute the fraction:\n$$ f_{\\mathrm{rime}} = \\frac{\\text{Term}_{\\mathrm{rime}}}{\\text{Term}_{\\mathrm{rime}} + \\text{Term}_{\\mathrm{Bergeron}}} = \\frac{0.84 \\times 10^{-8}}{0.84 \\times 10^{-8} + 0.18018 \\times 10^{-8}} $$\n$$ f_{\\mathrm{rime}} = \\frac{0.84}{0.84 + 0.18018} = \\frac{0.84}{1.02018} \\approx 0.823385 $$\n\nRounding to four significant figures, the fraction of liquid water depletion due to riming is 0.8234. This result indicates that for an ice particle of this size ($100\\,\\mu\\mathrm{m}$ radius), riming is the dominant process for consuming liquid water compared to the indirect depletion via the Bergeron process under these specific cloud conditions.",
            "answer": "$$ \\boxed{0.8234} $$"
        },
        {
            "introduction": "Bridging the gap between physical theory and numerical implementation is a central challenge in weather modeling. This coding practice guides you through constructing a saturation adjustment scheme, a core algorithm used to update temperature $T$ and water species mixing ratios ($q_v, q_c, q_i$). You will implement a robust numerical solution that conserves mass and energy while navigating different thermodynamic regimes, providing a practical foundation for simulating the Bergeron-Findeisen process computationally .",
            "id": "4053803",
            "problem": "Design and implement a saturation-adjustment algorithm for mixed-phase cloud microphysics consistent with Numerical Weather Prediction (NWP) and climate modeling that conserves total water mass and updates temperature via latent heat, while enforcing non-negativity of all species. The algorithm must account for distinct saturation vapor pressures over water and ice to represent the Bergeron-Findeisen process. The inputs and outputs must be expressed in the specified units, and the final results must be returned in a precisely defined format.\n\nGiven a parcel of moist air at constant pressure, with prognostic variables temperature $T$ in $\\mathrm{K}$, pressure $p$ in $\\mathrm{Pa}$, water vapor mixing ratio $q_v$ in $\\mathrm{kg}/\\mathrm{kg}$, cloud liquid water mixing ratio $q_c$ in $\\mathrm{kg}/\\mathrm{kg}$, and cloud ice mixing ratio $q_i$ in $\\mathrm{kg}/\\mathrm{kg}$, perform saturation adjustment under the following physically realistic constraints and definitions:\n\n- Use the Clausius-Clapeyron relationship through well-tested saturation vapor pressure formulas for water and ice. Let the saturation vapor pressure over liquid water be $e_s^w(T)$ and over ice be $e_s^i(T)$. Use the following empirical formulations (Buck-type, valid for atmospheric ranges):\n  - $$e_s^w(T) = 611.21 \\exp\\left(\\frac{17.502\\,(T - 273.15)}{T - 32.19}\\right) \\quad \\mathrm{Pa},$$\n  - $$e_s^i(T) = 611.21 \\exp\\left(\\frac{22.46\\,(T - 273.15)}{T - 0.55}\\right) \\quad \\mathrm{Pa}.$$\n  These forms approximate the Clausius-Clapeyron relation and are widely used in atmospheric science for saturation vapor pressure over water and ice.\n- Convert saturation vapor pressure to saturation mixing ratio $q_v^s$ via the standard formula:\n  $$q_v^s(T,p) = \\frac{\\varepsilon\\, e_s(T)}{p - e_s(T)}, \\quad \\varepsilon = \\frac{R_d}{R_v} = 0.622,$$\n  where $R_d$ and $R_v$ are the gas constants for dry air and water vapor, respectively.\n- Latent heats (treated as temperature-independent constants for numerical stability in this task): latent heat of vaporization $L_v = 2.5\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$, latent heat of fusion $L_f = 3.34\\times 10^5 \\,\\mathrm{J}/\\mathrm{kg}$, latent heat of sublimation $L_s = L_v + L_f = 2.834\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$.\n- Specific heats at constant pressure: dry air $c_{p,d} = 1004 \\,\\mathrm{J}/(\\mathrm{kg\\,K})$, water vapor $c_{p,v} = 1859 \\,\\mathrm{J}/(\\mathrm{kg\\,K})$, liquid water $c_{p,l} = 4181 \\,\\mathrm{J}/(\\mathrm{kg\\,K})$, ice $c_{p,i} = 2106 \\,\\mathrm{J}/(\\mathrm{kg\\,K})$. The mixture heat capacity can be approximated as\n  $$c_p = c_{p,d}\\,(1 - q_t) + c_{p,v}\\,q_v + c_{p,l}\\,q_c + c_{p,i}\\,q_i,$$\n  where $q_t = q_v + q_c + q_i$ is the total water mixing ratio.\n- Conservation requirements:\n  - Total water mixing ratio $q_t$ must be conserved: $$q_v^{\\mathrm{final}} + q_c^{\\mathrm{final}} + q_i^{\\mathrm{final}} = q_t.$$\n  - Temperature must be updated consistently with latent heat release or consumption during phase changes, assuming adiabatic, constant-pressure adjustment. For an increment $\\Delta q$ that decreases $q_v$ by $\\Delta q$ and increases the corresponding condensate by $\\Delta q$, the temperature changes by $\\Delta T = \\alpha \\,\\Delta q$, where $\\alpha = L/c_p$ and $L$ is the latent heat appropriate for the phase transition. Use $L_v$ for vapor-liquid transitions and $L_s$ for vapor-ice transitions.\n  - All species must remain non-negative: $$q_v^{\\mathrm{final}} \\ge 0, \\quad q_c^{\\mathrm{final}} \\ge 0, \\quad q_i^{\\mathrm{final}} \\ge 0.$$\n- Phase selection and Bergeron-Findeisen representation:\n  - If $T \\ge 273.15\\,\\mathrm{K}$ or $q_i = 0$, perform saturation adjustment with respect to liquid water: drive $q_v$ toward $q_v^s(T,p)$ with $e_s^w(T)$ via condensation or evaporation from $q_c$ only.\n  - If $T  273.15\\,\\mathrm{K}$ and $q_i > 0$ and $q_c = 0$, perform saturation adjustment with respect to ice: drive $q_v$ toward $q_v^s(T,p)$ with $e_s^i(T)$ via deposition or sublimation from $q_i$ only.\n  - If $T  273.15\\,\\mathrm{K}$ and both $q_c > 0$ and $q_i > 0$, represent the Bergeron-Findeisen process by:\n    - Evaporating all liquid water $q_c$ to vapor (consuming $L_v$ and cooling), then\n    - Adjusting $q_v$ to ice saturation using deposition or sublimation with $q_i$ (releasing or consuming $L_s$ and warming or cooling).\n    - This yields a net transfer from liquid to ice through the vapor phase, with net latent heating approximately $L_f$ per unit mass transferred from liquid to ice, and typically $q_c^{\\mathrm{final}} = 0$ in mixed-phase equilibrium at subfreezing temperatures.\n\nNumerical adjustment must solve the coupled nonlinearity between $q_v^s(T,p)$ and $T$ due to latent heating. Use a robust one-dimensional root-finding strategy (for example, bisection) for the increment $\\Delta q$ in each regime, subject to available condensate bounds so that no species becomes negative. If available condensate is insufficient to reach saturation, perform the maximum phase change allowed without violating non-negativity, then stop.\n\nYour program must apply the above adjustment for the following test suite. All inputs use $T$ in $\\mathrm{K}$, $p$ in $\\mathrm{Pa}$, and $q$ in $\\mathrm{kg}/\\mathrm{kg}$. For each case, output the final state as a list $[T^{\\mathrm{final}}, q_v^{\\mathrm{final}}, q_c^{\\mathrm{final}}, q_i^{\\mathrm{final}}]$:\n\n- Case $1$ (warm cloud, condensation likely): $T = 285.0$, $p = 80000.0$, $q_v = 0.0120$, $q_c = 0.0010$, $q_i = 0.0000$.\n- Case $2$ (cold cloud, pure ice): $T = 258.0$, $p = 70000.0$, $q_v = 0.0015$, $q_c = 0.0000$, $q_i = 0.0005$.\n- Case $3$ (mixed-phase, Bergeron-Findeisen active): $T = 268.0$, $p = 90000.0$, $q_v = 0.0025$, $q_c = 0.0008$, $q_i = 0.0003$.\n- Case $4$ (subsaturated, no condensate available): $T = 270.0$, $p = 85000.0$, $q_v = 0.0005$, $q_c = 0.0000$, $q_i = 0.0000$.\n- Case $5$ (near freezing with little ice, mixed-phase): $T = 271.0$, $p = 95000.0$, $q_v = 0.0040$, $q_c = 0.0020$, $q_i = 0.00001$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each case’s result is itself a comma-separated list of four floats in the same units, for example: $$\\texttt{[[T1,qv1,qc1,qi1],[T2,qv2,qc2,qi2],...]}.$$",
            "solution": "The problem requires the design and implementation of a saturation adjustment algorithm for a parcel of moist air at constant pressure $p$. This is a foundational component in atmospheric models for numerical weather prediction (NWP) and climate simulation. The algorithm must update the initial state, defined by temperature $T$ and mixing ratios of water vapor ($q_v$), liquid cloud water ($q_c$), and cloud ice ($q_i$), to a final equilibrium state. This process must conserve total water mass and be thermodynamically consistent, accounting for latent heat release/absorption during phase changes. The core of the problem lies in the non-linear coupling between temperature and saturation vapor pressure, necessitating a numerical solution.\n\nThe algorithm must correctly partition a parcel into one of three distinct physical regimes based on its temperature and composition, and apply the appropriate adjustment logic. A key feature is the representation of the Bergeron-Findeisen process in mixed-phase clouds, which arises from the difference in saturation vapor pressure over supercooled liquid water and ice.\n\nThe governing physical principles and equations are as follows:\n\n1.  **Saturation Vapor Pressure**: The equilibrium vapor pressure over a condensed phase is a strong function of temperature. We use the provided empirical formulas, which are common approximations of the Clausius-Clapeyron equation.\n    -   Over liquid water: $e_s^w(T) = 611.21 \\exp\\left(\\frac{17.502\\,(T - 273.15)}{T - 32.19}\\right)$\n    -   Over ice: $e_s^i(T) = 611.21 \\exp\\left(\\frac{22.46\\,(T - 273.15)}{T - 0.55}\\right)$\n\n2.  **Saturation Mixing Ratio**: The saturation vapor pressure $e_s$ is converted to a saturation mixing ratio $q_v^s$ using the given formula, where $\\varepsilon = R_d/R_v \\approx 0.622$ is the ratio of gas constants for dry air and water vapor.\n    $$q_v^s(T,p) = \\frac{\\varepsilon\\, e_s(T)}{p - e_s(T)}$$\n\n3.  **Conservation Laws**: The adjustment is an isenthalpic process at constant pressure, with two primary conserved quantities.\n    -   **Total Water Mass**: The total water mixing ratio $q_t = q_v + q_c + q_i$ is conserved. If a quantity of vapor $\\Delta q$ condenses, the final state $(T', q_v', q_c', q_i')$ is related to the initial state $(T, q_v, q_c, q_i)$ by $q_v' = q_v - \\Delta q$ and a corresponding increase in $q_c$ or $q_i$.\n    -   **Enthalpy**: The change in temperature is coupled to the phase change via latent heat. For a change $\\Delta q$ in vapor mixing ratio, the temperature change is $\\Delta T = (L/c_p) \\Delta q$, where $L$ is the appropriate latent heat ($L_v$ for condensation/evaporation, $L_s$ for deposition/sublimation) and $c_p$ is the specific heat capacity of the moist air mixture. The heat capacity is approximated using the initial composition:\n        $$c_p = c_{p,d}\\,(1 - q_t) + c_{p,v}\\,q_v + c_{p,l}\\,q_c + c_{p,i}\\,q_i$$\n        The specified constants are $L_v = 2.5\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$, $L_s = 2.834\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$, and the various specific heats.\n\n**Numerical Solution Strategy**\n\nThe goal of the adjustment is to find a final state $(T', q_v')$ such that $q_v'$ is equal to the saturation mixing ratio at the new temperature, $q_v' = q_v^s(T', p)$. Let $\\Delta q_{cond}$ be the amount of vapor converted to condensate (so $\\Delta q_{cond}  0$ for condensation/deposition and $\\Delta q_{cond}  0$ for evaporation/sublimation). The final state variables are:\n-   $T' = T + \\frac{L}{c_p} \\Delta q_{cond}$\n-   $q_v' = q_v - \\Delta q_{cond}$\n\nSubstituting these into the equilibrium condition gives a non-linear equation for $\\Delta q_{cond}$:\n$$f(\\Delta q_{cond}) = (q_v - \\Delta q_{cond}) - q_v^s\\left(T + \\frac{L}{c_p} \\Delta q_{cond}, p\\right) = 0$$\n\nThis single-variable equation can be solved robustly using a root-finding algorithm like bisection. The search interval for $\\Delta q_{cond}$ is constrained by the non-negativity of mass species.\n-   For condensation/deposition ($q_v  q_v^s(T,p)$), the source of mass is vapor, so $\\Delta q_{cond}$ is bounded by $[0, q_v]$.\n-   For evaporation/sublimation ($q_v  q_v^s(T,p)$), the source of mass is the available condensate ($q_c$ or $q_i$), so $\\Delta q_{cond}$ is bounded by $[-q_{condensate}, 0]$. If evaporating all available condensate is insufficient to reach saturation, the adjustment simply exhausts the condensate.\n\n**Regime-Specific Algorithm Design**\n\nThe core of the algorithm is a dispatch based on the parcel's state.\n\n1.  **Regime A: Liquid/Vapor Adjustment** (If $T \\ge 273.15\\,\\mathrm{K}$ or $q_i = 0$)\n    -   Equilibrium is with respect to liquid water. We use $e_s^w(T)$ for saturation calculations and $L=L_v$ for latent heat.\n    -   The change occurs between $q_v$ and $q_c$. We solve for $\\Delta q_c \\equiv \\Delta q_{cond}$.\n    -   The bisection solver finds $\\Delta q_c$ that zeros the function $f(\\Delta q_c) = (q_v - \\Delta q_c) - q_v^s(T + \\frac{L_v}{c_p}\\Delta q_c, p, e_s^w)$.\n    -   The search range for $\\Delta q_c$ is $[0, q_v]$ if supersaturated, or $[-q_c, 0]$ if subsaturated. If $q_c=0$ and the parcel is subsaturated, no change occurs.\n\n2.  **Regime B: Ice/Vapor Adjustment** (If $T  273.15\\,\\mathrm{K}$, $q_c = 0$, and $q_i  0$)\n    -   Equilibrium is with respect to ice. We use $e_s^i(T)$ and $L=L_s$.\n    -   The change occurs between $q_v$ and $q_i$. We solve for $\\Delta q_i \\equiv \\Delta q_{cond}$.\n    -   The bisection solver finds $\\Delta q_i$ that zeros $f(\\Delta q_i) = (q_v - \\Delta q_i) - q_v^s(T + \\frac{L_s}{c_p}\\Delta q_i, p, e_s^i)$.\n    -   The search range for $\\Delta q_i$ is $[0, q_v]$ if supersaturated w.r.t. ice, or $[-q_i, 0]$ if subsaturated.\n\n3.  **Regime C: Mixed-Phase (Bergeron-Findeisen) Adjustment** (If $T  273.15\\,\\mathrm{K}$, $q_c  0$, and $q_i  0$)\n    This regime is handled with a two-step process to model the transfer of mass from liquid to ice, driven by the fact that $q_v^s(\\text{water})  q_v^s(\\text{ice})$ at the same sub-freezing temperature.\n    -   **Step 1: Evaporate all liquid water.**\n        -   The initial liquid water $q_c$ is fully evaporated.\n        -   The temperature is updated due to latent heat of vaporization: $T_{int} = T - \\frac{L_v}{c_{p,init}} q_c$.\n        -   The vapor mixing ratio is updated: $q_{v,int} = q_v + q_c$.\n        -   The state becomes $(T_{int}, q_{v,int}, 0, q_i)$.\n    -   **Step 2: Adjust to ice saturation.**\n        -   Starting from the intermediate state, we now have a parcel with only vapor and ice. This is identical to Regime B.\n        -   We calculate a new heat capacity $c_{p,int}$ based on the intermediate state.\n        -   We solve for the change in ice, $\\Delta q_i$, needed to bring the parcel to saturation with respect to ice, using $L_s$ for latent heat. The total amount of vapor available for deposition is $q_{v,int}$.\n        -   The final state is calculated from the intermediate state and the resulting $\\Delta q_i$. The final cloud liquid water mixing ratio, $q_c'$, will be $0$.\n\nThis structured, physically-based approach ensures that the algorithm is robust, conserves mass and energy, and correctly models the key microphysical processes, including the crucial Bergeron-Findeisen mechanism in mixed-phase clouds.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import bisect\n\ndef solve():\n    \"\"\"\n    Main function to run the saturation adjustment for all test cases.\n    \"\"\"\n    \n    # --- Physical Constants ---\n    L_V = 2.5e6        # Latent heat of vaporization [J/kg]\n    L_F = 3.34e5       # Latent heat of fusion [J/kg]\n    L_S = L_V + L_F    # Latent heat of sublimation [J/kg]\n    CP_D = 1004.0      # Specific heat of dry air [J/(kg K)]\n    CP_V = 1859.0      # Specific heat of water vapor [J/(kg K)]\n    CP_L = 4181.0      # Specific heat of liquid water [J/(kg K)]\n    CP_I = 2106.0      # Specific heat of ice [J/(kg K)]\n    EPSILON = 0.622    # Ratio of gas constants Rd/Rv\n    T_FREEZE = 273.15  # Freezing point of water [K]\n\n    # --- Saturation Vapor Pressure Formulations (Buck-type) ---\n    def es_water(T):\n        \"\"\"Saturation vapor pressure over liquid water [Pa]. T in [K].\"\"\"\n        T_c = T - T_FREEZE\n        return 611.21 * np.exp((17.502 * T_c) / (T - 32.19))\n\n    def es_ice(T):\n        \"\"\"Saturation vapor pressure over ice [Pa]. T in [K].\"\"\"\n        T_c = T - T_FREEZE\n        return 611.21 * np.exp((22.46 * T_c) / (T - 0.55))\n\n    # --- Saturation Mixing Ratio ---\n    def qvs(T, p, es_func):\n        \"\"\"Saturation mixing ratio [kg/kg].\"\"\"\n        es = es_func(T)\n        # Prevent division by a non-positive number if es = p\n        if es = p:\n            return np.inf\n        return (EPSILON * es) / (p - es)\n\n    # --- Mixture Specific Heat Capacity ---\n    def cp_mixture(qv, qc, qi):\n        \"\"\"Specific heat capacity of the moist air mixture [J/(kg K)].\"\"\"\n        qt = qv + qc + qi\n        return CP_D * (1.0 - qt) + CP_V * qv + CP_L * qc + CP_I * qi\n\n    def saturation_adjustment(T_in, p, qv_in, qc_in, qi_in):\n        \"\"\"\n        Performs saturation adjustment on a parcel of air.\n        \n        Returns:\n            A list [T_final, qv_final, qc_final, qi_final].\n        \"\"\"\n        T, qv, qc, qi = float(T_in), float(qv_in), float(qc_in), float(qi_in)\n\n        # --- Regime 1: Liquid/Vapor Adjustment (Warm cloud or no ice) ---\n        if T = T_FREEZE or (qi = 0 and qc = 0):\n            cp = cp_mixture(qv, qc, qi)\n            qvs_current = qvs(T, p, es_water)\n\n            if qv  qvs_current:  # Supersaturated - Condensation\n                bounds = (0, qv)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_V / cp * delta_q, p, es_water)\n            elif qv  qvs_current and qc  0:  # Subsaturated - Evaporation\n                bounds = (-qc, 0)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_V / cp * delta_q, p, es_water)\n            else: # Saturated or subsaturated with no liquid water\n                return [T, qv, qc, qi]\n\n            # Check if root is bracketed\n            try:\n                fa, fb = f(bounds[0]), f(bounds[1])\n                if fa * fb  0: # Root not bracketed, perform max change\n                    delta_q_c = bounds[0] if qv  qvs_current else bounds[1]\n                else:\n                    delta_q_c = bisect(f, bounds[0], bounds[1], xtol=1e-12)\n            except ValueError: # e.g., if es = p\n                return [T, qv, qc, qi]\n            \n            T_final = T + L_V / cp * delta_q_c\n            qv_final = qv - delta_q_c\n            qc_final = qc + delta_q_c\n            qi_final = qi # Unchanged\n            \n            return [T_final, qv_final, qc_final, qi_final]\n        \n        # --- Regime 2: Ice/Vapor Adjustment (Cold cloud, no liquid) ---\n        elif T  T_FREEZE and qc = 0 and qi  0:\n            cp = cp_mixture(qv, qc, qi)\n            qvs_current = qvs(T, p, es_ice)\n\n            if qv  qvs_current: # Supersaturated w.r.t ice - Deposition\n                bounds = (0, qv)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_S / cp * delta_q, p, es_ice)\n            elif qv  qvs_current: # Subsaturated w.r.t ice - Sublimation\n                bounds = (-qi, 0)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_S / cp * delta_q, p, es_ice)\n            else: # Saturated or subsaturated with no ice (should not happen due to qi  0)\n                return [T, qv, qc, qi]\n\n            try:\n                fa, fb = f(bounds[0]), f(bounds[1])\n                if fa * fb  0:\n                    delta_q_i = bounds[0] if qv  qvs_current else bounds[1]\n                else:\n                    delta_q_i = bisect(f, bounds[0], bounds[1], xtol=1e-12)\n            except ValueError:\n                return [T, qv, qc, qi]\n\n            T_final = T + L_S / cp * delta_q_i\n            qv_final = qv - delta_q_i\n            qc_final = qc # Unchanged\n            qi_final = qi + delta_q_i\n            \n            return [T_final, qv_final, qc_final, qi_final]\n\n        # --- Regime 3: Mixed-Phase (Bergeron-Findeisen) ---\n        elif T  T_FREEZE and qc  0 and qi  0:\n            # Step A: Evaporate all liquid water\n            cp_init = cp_mixture(qv, qc, qi)\n            T_int = T - (L_V / cp_init) * qc\n            qv_int = qv + qc\n            qc_int = 0.0\n            qi_int = qi\n\n            # Step B: Adjust to ice saturation from the intermediate state\n            cp_int_mix = cp_mixture(qv_int, qc_int, qi_int)\n            qvs_int_ice = qvs(T_int, p, es_ice)\n\n            if qv_int  qvs_int_ice: # Expected case: deposition\n                bounds = (0, qv_int)\n                def f_bf(delta_q):\n                    return (qv_int - delta_q) - qvs(T_int + L_S / cp_int_mix * delta_q, p, es_ice)\n            elif qv_int  qvs_int_ice: # Sublimation from remaining ice\n                bounds = (-qi_int, 0)\n                def f_bf(delta_q):\n                    return (qv_int - delta_q) - qvs(T_int + L_S / cp_int_mix * delta_q, p, es_ice)\n            else:\n                return [T_int, qv_int, qc_int, qi_int]\n\n            try:\n                fa, fb = f_bf(bounds[0]), f_bf(bounds[1])\n                if fa * fb  0:\n                    delta_q_i = bounds[0] if qv_int  qvs_int_ice else bounds[1]\n                else:\n                    delta_q_i = bisect(f_bf, bounds[0], bounds[1], xtol=1e-12)\n            except ValueError:\n                return [T_int, qv_int, qc_int, qi_int]\n\n            T_final = T_int + L_S / cp_int_mix * delta_q_i\n            qv_final = qv_int - delta_q_i\n            qc_final = qc_int # Remains 0\n            qi_final = qi_int + delta_q_i\n            \n            return [T_final, qv_final, qc_final, qi_final]\n        \n        # --- Undefined or stable case (e.g., subsaturated with no condensate) ---\n        else:\n            return [T, qv, qc, qi]\n\n\n    test_cases = [\n        # T (K), p (Pa), qv (kg/kg), qc (kg/kg), qi (kg/kg)\n        (285.0, 80000.0, 0.0120, 0.0010, 0.0000), # Case 1\n        (258.0, 70000.0, 0.0015, 0.0000, 0.0005), # Case 2\n        (268.0, 90000.0, 0.0025, 0.0008, 0.0003), # Case 3\n        (270.0, 85000.0, 0.0005, 0.0000, 0.0000), # Case 4\n        (271.0, 95000.0, 0.0040, 0.0020, 0.00001), # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        final_state = saturation_adjustment(*case)\n        # Ensure non-negativity from floating point errors\n        final_state_non_neg = [max(0.0, x) for x in final_state]\n        results.append(final_state_non_neg)\n\n    # Format the output exactly as required\n    formatted_results = [f\"[{s[0]},{s[1]},{s[2]},{s[3]}]\" for s in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}