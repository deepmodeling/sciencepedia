{
    "hands_on_practices": [
        {
            "introduction": "Directly integrating the radiative transfer equation across the thousands of absorption lines in the electromagnetic spectrum is computationally prohibitive for climate and weather models. The correlated-k distribution method offers an elegant and efficient solution by re-sorting the complex spectrum according to the absorption coefficient, creating a smooth, monotonic function that is well-suited for numerical quadrature. This exercise provides hands-on practice with the core calculation of the correlated-k method, allowing you to compute the band-mean transmissivity for a gas layer using a predefined quadrature, a fundamental skill in parameterization development .",
            "id": "4014096",
            "problem": "In the context of parameterizing atmospheric absorption in numerical weather prediction and climate modeling, consider a homogeneous isothermal layer containing a single absorbing gas over a specified spectral band. Let the monochromatic transmissivity be governed by the Beer–Lambert law, where the monochromatic absorption coefficient $k(\\nu)$ yields a monochromatic transmissivity $T_{\\nu}=\\exp(-k(\\nu)\\,u)$, with $u$ denoting the absorber mass path along the line of sight. To obtain the band-mean transmissivity under the $k$-distribution (correlated-$k$) approach, change variables from wavenumber $\\nu$ to the cumulative probability variable $g$ of $k$ within the band under a normalized weighting, so that the band-mean transmissivity can be expressed as an integral over $g \\in [0,1]$. Under the standard assumption that the ranking of $k$ by $g$ is approximately preserved across the layer, approximate the integral using a finite quadrature with $N$ nodes characterized by pairs $\\{(w_i,k_i)\\}_{i=1}^{N}$, where $w_i$ are quadrature weights satisfying $\\sum_{i=1}^{N} w_i=1$ and $k_i$ are representative absorption coefficients at the nodes in $g$-space. \n\nGiven a six-point quadrature for a mid-infrared band at layer temperature and pressure, with absorber mass path $u=0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}$ and the following nodes,\n- weights: $w_1=0.10$, $w_2=0.15$, $w_3=0.20$, $w_4=0.20$, $w_5=0.20$, $w_6=0.15$,\n- absorption coefficients: $k_1=0.80\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $k_2=2.50\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $k_3=5.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $k_4=8.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $k_5=12.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $k_6=20.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$,\n\nderive from first principles the band-mean layer transmissivity under the correlated-$k$ approximation and then evaluate it using the provided quadrature. Express the final transmissivity as a dimensionless number rounded to six significant figures.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It describes a standard application of the correlated-$k$ method, a cornerstone of radiative transfer parameterization in atmospheric models.\n\nThe band-mean transmissivity, $\\bar{T}$, over a spectral band $\\Delta\\nu = [\\nu_a, \\nu_b]$ is the spectrally averaged monochromatic transmissivity. Assuming a simple unweighted average for the purpose of this derivation, it is defined as:\n$$\n\\bar{T} = \\frac{1}{\\Delta\\nu} \\int_{\\nu_a}^{\\nu_b} T_{\\nu} \\, d\\nu\n$$\nwhere $T_{\\nu}$ is the monochromatic transmissivity at wavenumber $\\nu$.\n\nThe Beer–Lambert law for a homogeneous layer relates $T_{\\nu}$ to the monochromatic absorption coefficient $k(\\nu)$ and the absorber mass path $u$:\n$$\nT_{\\nu} = \\exp(-k(\\nu)u)\n$$\nSubstituting this into the definition of $\\bar{T}$ gives:\n$$\n\\bar{T} = \\frac{1}{\\Delta\\nu} \\int_{\\nu_a}^{\\nu_b} \\exp(-k(\\nu)u) \\, d\\nu\n$$\nThe integral over wavenumber $\\nu$ is often complex due to the highly structured and rapidly varying nature of $k(\\nu)$. The correlated-$k$ (or simply $k$-distribution) method simplifies this by reordering the integration. Instead of integrating over wavenumber, we integrate over the values of the absorption coefficient $k$.\n\nLet $f(k)$ be the probability distribution function of the absorption coefficient $k(\\nu)$ within the spectral band $\\Delta\\nu$. This function represents the fraction of the spectral band for which the absorption coefficient has a value between $k$ and $k+dk$. The band-mean transmissivity can then be expressed as an expectation value over this distribution:\n$$\n\\bar{T} = \\int_0^\\infty \\exp(-ku) f(k) \\, dk\n$$\nThe next step is to introduce a new variable, $g$, which is the cumulative distribution function (CDF) of $k$. The variable $g$ is defined as the fraction of the band where the absorption coefficient is less than or equal to a given value $k$:\n$$\ng(k) = \\int_0^k f(k') \\, dk'\n$$\nBy definition, $g$ is a monotonically increasing function of $k$, ranging from $g=0$ at $k=0$ to $g=1$ as $k \\to \\infty$. The differential relationship is $dg = f(k)dk$. We can now change the variable of integration from $k$ to $g$. This yields the fundamental expression for the band-mean transmissivity in the $k$-distribution framework:\n$$\n\\bar{T} = \\int_0^1 \\exp(-k(g)u) \\, dg\n$$\nwhere $k(g)$ is the inverse of the function $g(k)$, giving the absorption coefficient as a function of the cumulative probability variable $g$. This integral is much smoother and more suitable for numerical quadrature than the original integral over $\\nu$. The \"correlated-$k$\" assumption, that the ordering of $k$ values is the same throughout an inhomogeneous atmospheric column, is what allows this method to be extended to multiple layers; for a single homogeneous layer as specified here, the method is simply a $k$-distribution.\n\nThe problem requires approximating this integral using a finite quadrature with $N$ points. The integral is replaced by a weighted sum:\n$$\n\\bar{T} = \\int_0^1 \\exp(-k(g)u) \\, dg \\approx \\sum_{i=1}^{N} w_i \\exp(-k_i u)\n$$\nHere, $\\{w_i\\}_{i=1}^{N}$ are the quadrature weights satisfying $\\sum_{i=1}^{N} w_i = 1$, and $\\{k_i\\}_{i=1}^{N}$ are the representative absorption coefficients at the quadrature nodes (which correspond to specific values of $g$).\n\nThe problem provides the necessary data for a six-point quadrature ($N=6$). The absorber mass path is $u=0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}$. The weights and absorption coefficients are:\n- $w_1=0.10$, $k_1=0.80\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$\n- $w_2=0.15$, $k_2=2.50\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$\n- $w_3=0.20$, $k_3=5.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$\n- $w_4=0.20$, $k_4=8.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$\n- $w_5=0.20$, $k_5=12.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$\n- $w_6=0.15$, $k_6=20.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$\n\nFirst, we calculate the dimensionless optical depth, $\\tau_i = k_i u$, for each node:\n- $\\tau_1 = k_1 u = (0.80\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1})(0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}) = 0.20$\n- $\\tau_2 = k_2 u = (2.50\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1})(0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}) = 0.625$\n- $\\tau_3 = k_3 u = (5.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1})(0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}) = 1.25$\n- $\\tau_4 = k_4 u = (8.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1})(0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}) = 2.00$\n- $\\tau_5 = k_5 u = (12.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1})(0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}) = 3.00$\n- $\\tau_6 = k_6 u = (20.00\\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1})(0.25\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}) = 5.00$\n\nNow, we can compute the band-mean transmissivity by evaluating the sum:\n$$\n\\bar{T} \\approx w_1 \\exp(-\\tau_1) + w_2 \\exp(-\\tau_2) + w_3 \\exp(-\\tau_3) + w_4 \\exp(-\\tau_4) + w_5 \\exp(-\\tau_5) + w_6 \\exp(-\\tau_6)\n$$\nSubstituting the numerical values:\n$$\n\\bar{T} \\approx 0.10 \\exp(-0.20) + 0.15 \\exp(-0.625) + 0.20 \\exp(-1.25) + 0.20 \\exp(-2.00) + 0.20 \\exp(-3.00) + 0.15 \\exp(-5.00)\n$$\nEvaluating each term:\n- $0.10 \\times \\exp(-0.20) \\approx 0.10 \\times 0.81873075 = 0.081873075$\n- $0.15 \\times \\exp(-0.625) \\approx 0.15 \\times 0.53526143 = 0.080289214$\n- $0.20 \\times \\exp(-1.25) \\approx 0.20 \\times 0.28650480 = 0.057300960$\n- $0.20 \\times \\exp(-2.00) \\approx 0.20 \\times 0.13533528 = 0.027067056$\n- $0.20 \\times \\exp(-3.00) \\approx 0.20 \\times 0.04978707 = 0.009957414$\n- $0.15 \\times \\exp(-5.00) \\approx 0.15 \\times 0.00673795 = 0.001010693$\n\nSumming these values gives the final approximation for the band-mean transmissivity:\n$$\n\\bar{T} \\approx 0.081873075 + 0.080289214 + 0.057300960 + 0.027067056 + 0.009957414 + 0.001010693 = 0.257498412\n$$\nRounding the result to six significant figures, as requested:\n$$\n\\bar{T} \\approx 0.257498\n$$\nThis is the band-mean layer transmissivity, a dimensionless quantity.",
            "answer": "$$\n\\boxed{0.257498}\n$$"
        },
        {
            "introduction": "Once we can parameterize the transmissivity of an atmospheric layer, the next step is to determine its impact on the atmospheric energy budget. The divergence of the net radiative flux through a layer directly translates to atmospheric heating or cooling, a primary driver of atmospheric dynamics. This exercise applies these concepts within a simplified 'grey-gas' framework, where the absorptive properties of the atmosphere are averaged over the entire longwave spectrum, to calculate the net fluxes and the resulting radiative heating rate for an idealized atmospheric slab .",
            "id": "4014053",
            "problem": "Consider a plane-parallel, isothermal atmospheric slab that is grey in the thermal infrared (longwave) band and free of scattering. The slab lies between pressures $p_{\\text{bottom}} = 80000$ Pa and $p_{\\text{top}} = 70000$ Pa, has temperature $T_{\\text{a}} = 280$ K, and has hemispheric longwave emissivity $\\varepsilon = 0.6$ (so its hemispheric transmissivity is $\\tau = 1 - \\varepsilon$). The surface below is a blackbody at temperature $T_{\\text{s}} = 300$ K. Space above is effectively at $0$ K. Assume hemispheric, diffuse, Lambertian emission consistent with Kirchhoff’s law (absorptivity equals emissivity) and no reflection at the surface.\n\n- Let the net upward longwave flux be defined as $F = F^{\\uparrow} - F^{\\downarrow}$, where $F^{\\uparrow}$ and $F^{\\downarrow}$ are the hemispheric upward and downward longwave fluxes, respectively.\n- Use the Stefan–Boltzmann constant $\\sigma = 5.670374419 \\times 10^{-8}$ W m$^{-2}$ K$^{-4}$, gravitational acceleration $g = 9.81$ m s$^{-2}$, and the specific heat at constant pressure for dry air $c_p = 1004$ J kg$^{-1}$ K$^{-1}$.\n- Treat the vertical derivative in pressure as a layer-average finite difference, i.e., $\\partial F / \\partial p \\approx \\left[F(p_{\\text{top}}) - F(p_{\\text{bottom}})\\right] / \\left(p_{\\text{top}} - p_{\\text{bottom}}\\right)$.\n\nUsing the above assumptions and only fundamental principles of radiative transfer (energy conservation, Kirchhoff’s law for a grey, isothermal slab, and hemispheric blackbody emission), compute the longwave flux divergence and the corresponding radiative heating rate\n$$\nQ \\;=\\; \\frac{g}{c_p}\\,\\frac{\\partial F}{\\partial p}\n$$\nfor this slab. Express your final heating rate in K day$^{-1}$ and round your answer to four significant figures.",
            "solution": "The user wants to solve for the radiative heating rate of an atmospheric slab.\n\n### Step 1: Extract Givens\n- Atmospheric slab pressures: $p_{\\text{bottom}} = 80000$ Pa, $p_{\\text{top}} = 70000$ Pa\n- Slab temperature: $T_{\\text{a}} = 280$ K\n- Slab hemispheric longwave emissivity: $\\varepsilon = 0.6$\n- Slab hemispheric longwave transmissivity: $\\tau = 1 - \\varepsilon = 0.4$\n- Surface temperature: $T_{\\text{s}} = 300$ K\n- Surface property: Blackbody (emissivity is $1$)\n- Space temperature: $0$ K\n- Net upward longwave flux definition: $F = F^{\\uparrow} - F^{\\downarrow}$\n- Stefan–Boltzmann constant: $\\sigma = 5.670374419 \\times 10^{-8}$ W m$^{-2}$ K$^{-4}$\n- Gravitational acceleration: $g = 9.81$ m s$^{-2}$\n- Specific heat at constant pressure for dry air: $c_p = 1004$ J kg$^{-1}$ K$^{-1}$\n- Finite difference approximation: $\\partial F / \\partial p \\approx \\left[F(p_{\\text{top}}) - F(p_{\\text{bottom}})\\right] / \\left(p_{\\text{top}} - p_{\\text{bottom}}\\right)$\n- Radiative heating rate definition: $Q = \\frac{g}{c_p}\\,\\frac{\\partial F}{\\partial p}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, rooted in the fundamental principles of radiative transfer in a plane-parallel atmosphere. It is a standard, simplified problem in atmospheric physics. All terms are defined, and the necessary physical constants and boundary conditions are provided, making the problem self-contained and well-posed. The language is objective and precise. The physical values are realistic for an atmospheric layer. The setup is free from internal contradictions, scientific inaccuracies, or other flaws listed in the validation criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. A reasoned solution will be formulated.\n\n### Solution Formulation\nThe objective is to compute the radiative heating rate $Q$ of the atmospheric slab, defined as:\n$$\nQ = \\frac{g}{c_p} \\frac{\\partial F}{\\partial p}\n$$\nThe problem specifies using a finite difference approximation for the flux divergence with respect to pressure:\n$$\n\\frac{\\partial F}{\\partial p} \\approx \\frac{F(p_{\\text{top}}) - F(p_{\\text{bottom}})}{p_{\\text{top}} - p_{\\text{bottom}}}\n$$\nHere, $F(p) = F^{\\uparrow}(p) - F^{\\downarrow}(p)$ is the net upward longwave flux at pressure level $p$. We must determine the fluxes at the top and bottom of the slab.\n\n**1. Fluxes at the bottom of the slab ($p_{\\text{bottom}}$):**\nThe upward flux at the bottom of the slab, $F^{\\uparrow}(p_{\\text{bottom}})$, is the radiation emitted by the blackbody surface below it. The surface is at temperature $T_{\\text{s}}$.\n$$\nF^{\\uparrow}(p_{\\text{bottom}}) = \\sigma T_{\\text{s}}^4\n$$\nThe downward flux at the bottom of the slab, $F^{\\downarrow}(p_{\\text{bottom}})$, is the radiation emitted downward by the isothermal slab itself. According to Kirchhoff's law, the slab's absorptivity equals its emissivity $\\varepsilon$. The slab is at temperature $T_{\\text{a}}$. The incoming radiation from space above is zero, so transmitted radiation from above is zero.\n$$\nF^{\\downarrow}(p_{\\text{bottom}}) = \\varepsilon \\sigma T_{\\text{a}}^4\n$$\nThe net upward flux at the bottom of the slab is therefore:\n$$\nF(p_{\\text{bottom}}) = F^{\\uparrow}(p_{\\text{bottom}}) - F^{\\downarrow}(p_{\\text{bottom}}) = \\sigma T_{\\text{s}}^4 - \\varepsilon \\sigma T_{\\text{a}}^4\n$$\n\n**2. Fluxes at the top of the slab ($p_{\\text{top}}$):**\nThe upward flux at the top of the slab, $F^{\\uparrow}(p_{\\text{top}})$, consists of two components: the radiation from the surface transmitted through the slab, and the radiation emitted upward by the slab itself.\n$$\nF^{\\uparrow}(p_{\\text{top}}) = \\tau (\\sigma T_{\\text{s}}^4) + \\varepsilon \\sigma T_{\\text{a}}^4\n$$\nSince $\\tau = 1 - \\varepsilon$, this becomes:\n$$\nF^{\\uparrow}(p_{\\text{top}}) = (1 - \\varepsilon) \\sigma T_{\\text{s}}^4 + \\varepsilon \\sigma T_{\\text{a}}^4\n$$\nThe downward flux at the top of the slab, $F^{\\downarrow}(p_{\\text{top}})$, is the radiation from space. Since space is at $0$ K, this flux is zero.\n$$\nF^{\\downarrow}(p_{\\text{top}}) = \\sigma (0 \\text{ K})^4 = 0\n$$\nThe net upward flux at the top of the slab is:\n$$\nF(p_{\\text{top}}) = F^{\\uparrow}(p_{\\text{top}}) - F^{\\downarrow}(p_{\\text{top}}) = (1 - \\varepsilon) \\sigma T_{\\text{s}}^4 + \\varepsilon \\sigma T_{\\text{a}}^4\n$$\n\n**3. Flux Divergence:**\nNow, we calculate the difference in net flux across the slab, $\\Delta F = F(p_{\\text{top}}) - F(p_{\\text{bottom}})$.\n$$\n\\Delta F = \\left[ (1 - \\varepsilon) \\sigma T_{\\text{s}}^4 + \\varepsilon \\sigma T_{\\text{a}}^4 \\right] - \\left[ \\sigma T_{\\text{s}}^4 - \\varepsilon \\sigma T_{\\text{a}}^4 \\right]\n$$\n$$\n\\Delta F = \\sigma T_{\\text{s}}^4 - \\varepsilon \\sigma T_{\\text{s}}^4 + \\varepsilon \\sigma T_{\\text{a}}^4 - \\sigma T_{\\text{s}}^4 + \\varepsilon \\sigma T_{\\text{a}}^4\n$$\n$$\n\\Delta F = 2 \\varepsilon \\sigma T_{\\text{a}}^4 - \\varepsilon \\sigma T_{\\text{s}}^4 = \\varepsilon \\sigma (2 T_{\\text{a}}^4 - T_{\\text{s}}^4)\n$$\nThe pressure difference is $\\Delta p = p_{\\text{top}} - p_{\\text{bottom}}$.\nThe flux divergence term is:\n$$\n\\frac{\\partial F}{\\partial p} \\approx \\frac{\\Delta F}{\\Delta p} = \\frac{\\varepsilon \\sigma (2 T_{\\text{a}}^4 - T_{\\text{s}}^4)}{p_{\\text{top}} - p_{\\text{bottom}}}\n$$\n\n**4. Radiative Heating Rate:**\nSubstitute this expression into the formula for $Q$:\n$$\nQ = \\frac{g}{c_p} \\frac{\\varepsilon \\sigma (2 T_{\\text{a}}^4 - T_{\\text{s}}^4)}{p_{\\text{top}} - p_{\\text{bottom}}}\n$$\nNow, we insert the numerical values:\n- $g = 9.81$ m s$^{-2}$\n- $c_p = 1004$ J kg$^{-1}$ K$^{-1}$\n- $\\varepsilon = 0.6$\n- $\\sigma = 5.670374419 \\times 10^{-8}$ W m$^{-2}$ K$^{-4}$\n- $T_{\\text{a}} = 280$ K\n- $T_{\\text{s}} = 300$ K\n- $p_{\\text{top}} = 70000$ Pa\n- $p_{\\text{bottom}} = 80000$ Pa\n\nFirst, calculate the temperature term:\n$$\n2 T_{\\text{a}}^4 - T_{\\text{s}}^4 = 2 (280)^4 - (300)^4 = 2(6.14656 \\times 10^9) - 8.1 \\times 10^9 = 1.229312 \\times 10^{10} - 8.1 \\times 10^9 = 4.19312 \\times 10^9 \\text{ K}^4\n$$\nNext, calculate the flux difference $\\Delta F$:\n$$\n\\Delta F = (0.6)(5.670374419 \\times 10^{-8} \\text{ W m}^{-2} \\text{K}^{-4})(4.19312 \\times 10^9 \\text{ K}^4) \\approx 142.673 \\text{ W m}^{-2}\n$$\nThe pressure difference is:\n$$\n\\Delta p = 70000 \\text{ Pa} - 80000 \\text{ Pa} = -10000 \\text{ Pa}\n$$\nThe flux divergence is:\n$$\n\\frac{\\partial F}{\\partial p} \\approx \\frac{142.673 \\text{ W m}^{-2}}{-10000 \\text{ Pa}} = -0.0142673 \\text{ W m}^{-2} \\text{Pa}^{-1}\n$$\nThe ratio of physical constants is:\n$$\n\\frac{g}{c_p} = \\frac{9.81 \\text{ m s}^{-2}}{1004 \\text{ J kg}^{-1} \\text{K}^{-1}} \\approx 0.0097709 \\text{ m}^2 \\text{K J}^{-1}\n$$\nThe heating rate in K s$^{-1}$ is:\n$$\nQ = \\left(\\frac{g}{c_p}\\right) \\left(\\frac{\\partial F}{\\partial p}\\right) \\approx (0.0097709 \\text{ m}^2 \\text{K J}^{-1})(-0.0142673 \\text{ W m}^{-2} \\text{Pa}^{-1}) \\approx -0.000139396 \\text{ K s}^{-1}\n$$\n(Unit check: J$^{-1}$ Pa$^{-1}$ m$^2$ W = J$^{-1}$ (N m$^{-2})^{-1}$ m$^2$ (J s$^{-1}$) = N$^{-1}$ s$^{-1}$ = (kg m s$^{-2})^{-1}$ s$^{-1}$ = kg$^{-1}$ m$^{-1}$ s. Multiplied by $g/c_p$ which has units m K (J kg$^{-1})^{-1}$... this is confusing. Let's use the check from the scratchpad: the units for $Q$ are indeed K s⁻¹).\n\nTo express the heating rate in K day$^{-1}$, we multiply by the number of seconds in a day ($24 \\times 60 \\times 60 = 86400$ s/day).\n$$\nQ_{\\text{day}} = (-0.000139396 \\text{ K s}^{-1}) \\times (86400 \\text{ s day}^{-1}) \\approx -12.0438 \\text{ K day}^{-1}\n$$\nRounding to four significant figures, the final result is $-12.04$. The negative sign indicates radiative cooling.",
            "answer": "$$\n\\boxed{-12.04}\n$$"
        },
        {
            "introduction": "While the grey-gas model from the previous exercise provides valuable intuition, it makes a significant simplification by ignoring the detailed spectral nature of absorption. Real atmospheres have spectral 'windows' that are highly transparent, allowing radiation to escape to space, alongside highly opaque regions. This coding practice delves into this critical issue by asking you to compare the outgoing longwave radiation (OLR) from a grey-gas model to that from a more realistic two-band model, quantifying the error introduced by the grey-gas assumption and demonstrating why spectral partitioning is essential for accurate climate modeling .",
            "id": "4014055",
            "problem": "Consider a clear-sky, plane-parallel, one-dimensional atmospheric column relevant to numerical weather prediction and climate modeling, in which longwave radiation is absorbed and emitted by water vapor without scattering. Assume an isothermal atmosphere of temperature $T_{\\mathrm{atm}}$ overlies a Lambertian surface of temperature $T_{\\mathrm{sfc}}$. The goal is to parameterize the outgoing longwave radiation (OLR) at the top of atmosphere using a spectrally partitioned representation that explicitly includes a spectral window and a water vapor continuum, and to compare this to a single-band grey-gas parameterization.\n\nUse the following fundamental base:\n- The Schwarzschild equation for thermal radiation in a non-scattering, absorbing medium, $ \\dfrac{dI_{\\nu}}{d\\tau_{\\nu}} = I_{\\nu} - B_{\\nu}(T) $, where $I_{\\nu}$ is monochromatic intensity, $\\tau_{\\nu}$ is monochromatic optical depth along the path, and $B_{\\nu}(T)$ is the Planck function at temperature $T$.\n- Beer–Lambert law for transmission, $ \\mathcal{T}_{\\nu} = e^{-\\tau_{\\nu}/\\mu} $ for a beam with direction cosine $\\mu$ relative to the zenith.\n- Stefan–Boltzmann law for blackbody emission integrated over frequency, $ F = \\sigma T^{4} $, where $\\sigma$ is the Stefan–Boltzmann constant.\n\nAdopt a two-band approximation for the longwave spectrum:\n- A window band that occupies a fraction $f_{w}$ of the Planck-weighted spectrum.\n- An opaque band occupying the complementary fraction $1 - f_{w}$.\n\nAssume the source function $B_{\\nu}(T)$ is well represented, after spectral integration within each band, by $ \\sigma T^{4}$ weighted by the band fraction. Thus, the band-integrated blackbody flux in band $i \\in \\{\\mathrm{w}, \\mathrm{o}\\}$ is $ w_{i} \\sigma T^{4}$, with $w_{\\mathrm{w}} = f_{w}$ and $w_{\\mathrm{o}} = 1 - f_{w}$.\n\nFor each band $i$, model the vertical, band-mean optical depth as a function of the water vapor path $W$ (expressed in $\\mathrm{kg}\\,\\mathrm{m}^{-2}$) using\n$$\n\\tau_{\\mathrm{o}} = k_{\\ell} W + \\alpha_{\\mathrm{o}} k_{c} W,\n\\qquad\n\\tau_{\\mathrm{w}} = \\alpha_{\\mathrm{w}} k_{c} W + \\tau_{\\min},\n$$\nwhere $k_{\\ell}$ is a line absorption coefficient (units chosen such that $k_{\\ell} W$ is dimensionless), $k_{c}$ is a continuum absorption coefficient (units chosen such that $k_{c} W$ is dimensionless), $\\alpha_{\\mathrm{o}}$ and $\\alpha_{\\mathrm{w}}$ are band-specific continuum scaling factors that reflect the differing strength of the continuum across bands, and $\\tau_{\\min}$ is a small positive baseline optical depth for the window band. The optical depths $\\tau_{\\mathrm{o}}$ and $\\tau_{\\mathrm{w}}$ are dimensionless.\n\nTo approximate the angular integration, use a fixed effective mean direction cosine $ \\bar{\\mu} = 1 / 1.66 $ (dimensionless), consistent with the diffusivity approximation for longwave radiative transfer in a plane-parallel atmosphere.\n\nDefine the two-band OLR as the sum of the band contributions and define the grey-gas OLR by collapsing the spectrum to a single optical depth $ \\tau_{\\mathrm{g}} $ equal to the Planck-weighted average optical depth of the two bands, $ \\tau_{\\mathrm{g}} = w_{\\mathrm{w}} \\tau_{\\mathrm{w}} + w_{\\mathrm{o}} \\tau_{\\mathrm{o}} $. Quantify the deviation between the two-band OLR and the grey-gas OLR using both the difference and the relative deviation, where the relative deviation is the difference divided by the grey-gas OLR.\n\nImplement a program that, starting from the above fundamentals and assumptions, computes:\n- The two-band OLR, expressed in $\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n- The grey-gas OLR, expressed in $\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n- The relative deviation (dimensionless), defined as the two-band OLR minus the grey-gas OLR, divided by the grey-gas OLR.\n\nUse the Stefan–Boltzmann constant $ \\sigma = 5.670374419 \\times 10^{-8} \\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{K}^{-4} $ and ensure all temperatures $T_{\\mathrm{sfc}}$ and $T_{\\mathrm{atm}}$ are provided in $\\mathrm{K}$. Your program should round the two OLR values to $3$ decimal places and the relative deviation to $6$ decimal places.\n\nTest suite parameter values:\n- Case $1$ (general humid case with moderate continuum): $T_{\\mathrm{sfc}} = 300$, $T_{\\mathrm{atm}} = 260$, $f_{w} = 0.2$, $W = 20$, $k_{\\ell} = 0.25$, $k_{c} = 0.015$, $\\alpha_{\\mathrm{w}} = 1.5$, $\\alpha_{\\mathrm{o}} = 1.0$, $\\tau_{\\min} = 0.02$.\n- Case $2$ (no continuum, highlighting window effect): $T_{\\mathrm{sfc}} = 300$, $T_{\\mathrm{atm}} = 260$, $f_{w} = 0.2$, $W = 20$, $k_{\\ell} = 0.25$, $k_{c} = 0.0$, $\\alpha_{\\mathrm{w}} = 1.5$, $\\alpha_{\\mathrm{o}} = 1.0$, $\\tau_{\\min} = 0.02$.\n- Case $3$ (very humid with strong continuum, reducing window transparency): $T_{\\mathrm{sfc}} = 300$, $T_{\\mathrm{atm}} = 260$, $f_{w} = 0.2$, $W = 60$, $k_{\\ell} = 0.25$, $k_{c} = 0.03$, $\\alpha_{\\mathrm{w}} = 1.5$, $\\alpha_{\\mathrm{o}} = 1.0$, $\\tau_{\\min} = 0.02$.\n- Case $4$ (dry atmosphere with larger window fraction): $T_{\\mathrm{sfc}} = 290$, $T_{\\mathrm{atm}} = 250$, $f_{w} = 0.3$, $W = 5$, $k_{\\ell} = 0.25$, $k_{c} = 0.01$, $\\alpha_{\\mathrm{w}} = 1.5$, $\\alpha_{\\mathrm{o}} = 1.0$, $\\tau_{\\min} = 0.02$.\n- Case $5$ (equal surface and atmospheric temperatures boundary): $T_{\\mathrm{sfc}} = 280$, $T_{\\mathrm{atm}} = 280$, $f_{w} = 0.2$, $W = 20$, $k_{\\ell} = 0.25$, $k_{c} = 0.015$, $\\alpha_{\\mathrm{w}} = 1.5$, $\\alpha_{\\mathrm{o}} = 1.0$, $\\tau_{\\min} = 0.02$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered by cases, with three numbers per case: $[\\text{OLR}_{\\text{bands},1}, \\text{OLR}_{\\text{grey},1}, r_{1}, \\text{OLR}_{\\text{bands},2}, \\text{OLR}_{\\text{grey},2}, r_{2}, \\ldots, \\text{OLR}_{\\text{bands},5}, \\text{OLR}_{\\text{grey},5}, r_{5}]$. The two OLR values must be reported in $\\mathrm{W}\\,\\mathrm{m}^{-2}$, rounded to $3$ decimal places, and the relative deviation must be reported as a decimal rounded to $6$ decimal places.",
            "solution": "The problem is valid as it is scientifically grounded in established principles of atmospheric radiative transfer, is well-posed with all necessary information provided, and is expressed using objective and formal language. We proceed with the solution.\n\nThe objective is to derive expressions for the Outgoing Longwave Radiation (OLR) at the top of the atmosphere for a two-band spectral model and a single-band grey-gas model, and to compare them. The atmosphere is modeled as a plane-parallel, isothermal slab at temperature $T_{\\mathrm{atm}}$ overlying a Lambertian surface at temperature $T_{\\mathrm{sfc}}$.\n\nFirst, we derive the general expression for the upward longwave flux for a single spectral band $i$. The upward intensity at the top of the atmosphere (TOA) is the sum of surface emission transmitted through the atmosphere and the integrated emission from the atmosphere itself. For an isothermal atmosphere, the upward intensity $I_i^{\\uparrow}$ along a path with direction cosine $\\mu$ (relative to the zenith) is:\n$$\nI_i^{\\uparrow}(\\mu) = (w_i B(T_{\\mathrm{sfc}})) e^{-\\tau_i/\\mu} + (w_i B(T_{\\mathrm{atm}})) (1 - e^{-\\tau_i/\\mu})\n$$\nwhere $w_i$ is the fraction of the Planck function spectrum occupied by band $i$, $B(T)$ is the spectrally integrated Planck function, $\\tau_i$ is the vertical optical depth of the atmosphere in band $i$, and $e^{-\\tau_i/\\mu}$ is the transmittance along the slant path. The problem states that the band-integrated blackbody flux is $w_i \\sigma T^4$, which corresponds to $\\pi w_i B(T)$.\n\nThe upward flux (OLR) is the integral of the vertical component of intensity, $I_i^{\\uparrow}(\\mu)\\mu$, over the upward hemisphere. The problem specifies using the diffusivity approximation, which replaces the angular integration with an evaluation at a single effective mean direction cosine $\\bar{\\mu} = 1/1.66$. This simplifies the flux transmittance to $\\mathcal{T}_i = e^{-\\tau_i / \\bar{\\mu}}$. The upward flux for band $i$ is thus:\n$$\nF_i^{\\uparrow} = (w_i \\sigma T_{\\mathrm{sfc}}^4) e^{-\\tau_i / \\bar{\\mu}} + (w_i \\sigma T_{\\mathrm{atm}}^4) (1 - e^{-\\tau_i / \\bar{\\mu}})\n$$\nThis equation can be rearranged to:\n$$\nF_i^{\\uparrow} = w_i \\sigma \\left[ T_{\\mathrm{sfc}}^4 e^{-\\tau_i / \\bar{\\mu}} + T_{\\mathrm{atm}}^4 (1 - e^{-\\tau_i / \\bar{\\mu}}) \\right]\n$$\nThis is the fundamental expression for the upward flux from a single band.\n\nThe optical depths for the two bands, opaque ($\\mathrm{o}$) and window ($\\mathrm{w}$), are given as functions of the water vapor path $W$:\n$$\n\\tau_{\\mathrm{o}} = k_{\\ell} W + \\alpha_{\\mathrm{o}} k_{c} W\n$$\n$$\n\\tau_{\\mathrm{w}} = \\alpha_{\\mathrm{w}} k_{c} W + \\tau_{\\min}\n$$\n\nThe spectral weights for the bands are $w_{\\mathrm{w}} = f_w$ and $w_{\\mathrm{o}} = 1 - f_w$.\n\nThe two-band OLR, denoted $OLR_{\\mathrm{bands}}$, is the sum of the fluxes from the two bands:\n$$\nOLR_{\\mathrm{bands}} = F_{\\mathrm{w}}^{\\uparrow} + F_{\\mathrm{o}}^{\\uparrow}\n$$\nSubstituting the flux expression for each band:\n$$\nOLR_{\\mathrm{bands}} = w_{\\mathrm{w}} \\sigma \\left[ T_{\\mathrm{sfc}}^4 e^{-\\tau_{\\mathrm{w}} / \\bar{\\mu}} + T_{\\mathrm{atm}}^4 (1 - e^{-\\tau_{\\mathrm{w}} / \\bar{\\mu}}) \\right] + w_{\\mathrm{o}} \\sigma \\left[ T_{\\mathrm{sfc}}^4 e^{-\\tau_{\\mathrm{o}} / \\bar{\\mu}} + T_{\\mathrm{atm}}^4 (1 - e^{-\\tau_{\\mathrm{o}} / \\bar{\\mu}}) \\right]\n$$\n\nThe grey-gas OLR, denoted $OLR_{\\mathrm{grey}}$, is formulated by collapsing the spectrum into a single band ($w=1$) with a Planck-weighted average optical depth, $\\tau_{\\mathrm{g}}$:\n$$\n\\tau_{\\mathrm{g}} = w_{\\mathrm{w}} \\tau_{\\mathrm{w}} + w_{\\mathrm{o}} \\tau_{\\mathrm{o}}\n$$\nUsing this grey optical depth in the fundamental flux expression, we get:\n$$\nOLR_{\\mathrm{grey}} = \\sigma \\left[ T_{\\mathrm{sfc}}^4 e^{-\\tau_{\\mathrm{g}} / \\bar{\\mu}} + T_{\\mathrm{atm}}^4 (1 - e^{-\\tau_{\\mathrm{g}} / \\bar{\\mu}}) \\right]\n$$\n\nA deviation between the two models is expected due to the non-linear relationship between optical depth and transmittance. The Planck-weighted average of transmittances is not equal to the transmittance of the Planck-weighted average optical depth. By Jensen's inequality, since the function $f(x) = e^{-x}$ is convex, the weighted average of the function values is greater than or equal to the function value of the weighted average:\n$$\nw_{\\mathrm{w}} e^{-\\tau_{\\mathrm{w}}/\\bar{\\mu}} + w_{\\mathrm{o}} e^{-\\tau_{\\mathrm{o}}/\\bar{\\mu}} \\ge e^{-(w_{\\mathrm{w}}\\tau_{\\mathrm{w}} + w_{\\mathrm{o}}\\tau_{\\mathrm{o}})/\\bar{\\mu}}\n$$\nThis implies that the total transmittance of the two-band model is greater than or equal to that of the grey-gas model. When $T_{\\mathrm{sfc}}  T_{\\mathrm{atm}}$, this leads to $OLR_{\\mathrm{bands}} \\ge OLR_{\\mathrm{grey}}$. The grey-gas model effectively \"smears\" the transparency of the window regions across the entire spectrum, underestimating the radiative cooling to space.\n\nThe relative deviation, $r$, is defined as:\n$$\nr = \\frac{OLR_{\\mathrm{bands}} - OLR_{\\mathrm{grey}}}{OLR_{\\mathrm{grey}}}\n$$\n\nThe computational procedure is as follows:\n$1$. For each set of input parameters, calculate the band optical depths $\\tau_{\\mathrm{w}}$ and $\\tau_{\\mathrm{o}}$.\n$2$. Calculate the total two-band OLR, $OLR_{\\mathrm{bands}}$, by summing the contributions from each band.\n$3$. Calculate the grey-gas optical depth $\\tau_{\\mathrm{g}}$ and the corresponding grey-gas OLR, $OLR_{\\mathrm{grey}}$.\n$4$. Compute the relative deviation $r$.\n$5$. Round the values to the specified precision and format the output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares Outgoing Longwave Radiation (OLR) using two-band\n    and grey-gas models for a series of atmospheric test cases.\n    \"\"\"\n    # Stefan-Boltzmann constant (W m^-2 K^-4)\n    SIGMA = 5.670374419e-8\n    # Effective mean direction cosine (diffusivity approximation)\n    MU_BAR = 1.0 / 1.66\n\n    # Test suite parameter values\n    # (T_sfc, T_atm, f_w, W, k_l, k_c, alpha_w, alpha_o, tau_min)\n    test_cases = [\n        (300.0, 260.0, 0.2, 20.0, 0.25, 0.015, 1.5, 1.0, 0.02),\n        (300.0, 260.0, 0.2, 20.0, 0.25, 0.0, 1.5, 1.0, 0.02),\n        (300.0, 260.0, 0.2, 60.0, 0.25, 0.03, 1.5, 1.0, 0.02),\n        (290.0, 250.0, 0.3, 5.0, 0.25, 0.01, 1.5, 1.0, 0.02),\n        (280.0, 280.0, 0.2, 20.0, 0.25, 0.015, 1.5, 1.0, 0.02),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        T_sfc, T_atm, f_w, W, k_l, k_c, alpha_w, alpha_o, tau_min = case\n\n        # Weights for window and opaque bands\n        w_w = f_w\n        w_o = 1.0 - f_w\n\n        # Calculate band-mean optical depths\n        tau_o = k_l * W + alpha_o * k_c * W\n        tau_w = alpha_w * k_c * W + tau_min\n\n        # Blackbody emission fluxes from surface and atmosphere\n        B_sfc = SIGMA * T_sfc**4\n        B_atm = SIGMA * T_atm**4\n\n        # --- Two-Band OLR Calculation ---\n        # Transmittances for each band\n        trans_w = np.exp(-tau_w / MU_BAR)\n        trans_o = np.exp(-tau_o / MU_BAR)\n\n        # Flux for each band\n        F_w = w_w * (B_sfc * trans_w + B_atm * (1.0 - trans_w))\n        F_o = w_o * (B_sfc * trans_o + B_atm * (1.0 - trans_o))\n\n        olr_bands = F_w + F_o\n\n        # --- Grey-Gas OLR Calculation ---\n        # Planck-weighted average optical depth\n        tau_g = w_w * tau_w + w_o * tau_o\n\n        # Transmittance for the grey gas\n        trans_g = np.exp(-tau_g / MU_BAR)\n\n        olr_grey = B_sfc * trans_g + B_atm * (1.0 - trans_g)\n        \n        # --- Relative Deviation Calculation ---\n        # Avoid division by zero in the theoretical (but unlikely) case of olr_grey being 0\n        if olr_grey != 0:\n            relative_deviation = (olr_bands - olr_grey) / olr_grey\n        else:\n            # This case occurs if T_sfc = T_atm = 0, or if the atmosphere is infinitely opaque\n            # and T_atm = 0. If olr_bands is also 0, deviation is 0. Otherwise it's infinite.\n            # For the given test cases, this branch is not taken.\n            relative_deviation = 0.0 if olr_bands == 0.0 else np.inf\n\n        # Append rounded results for the current case\n        results.extend([\n            round(olr_bands, 3),\n            round(olr_grey, 3),\n            round(relative_deviation, 6)\n        ])\n    \n    # Format and print the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}