{
    "hands_on_practices": [
        {
            "introduction": "要掌握暖雨过程参数化，第一步是理解其核心机制的计算。本练习将通过经典的Kessler方案，指导你动手计算自转换和碰并这两个关键过程的速率。更进一步，你还将量化这些相变过程所伴随的潜热加热或冷却效应，从而将微物理过程与模式中的热力学变化直接联系起来。",
            "id": "3906208",
            "problem": "一个暖云微物理模块的单个网格单元使用 Kessler 型的暖雨参数化方案来表示水的相变。预报变量是云液水混合比 $q_{c}$、雨水混合比 $q_{r}$ 和水汽混合比 $q_{v}$，单位均为 $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$。云液水向雨水的自动转化以及下落雨水对云液水的碰并被建模为 $q_{r}$ 的源趋势项（以及 $q_{c}$ 的等量汇项），使用经过充分检验的 Kessler 形式：\n- 自动转化：$P_{\\mathrm{auto}} = c_{\\mathrm{auto}} \\,\\max\\!\\left(q_{c} - q_{c,0},\\, 0\\right)$，\n- 碰并：$P_{\\mathrm{accr}} = c_{\\mathrm{accr}} \\, q_{c} \\, q_{r}$，\n其中 $c_{\\mathrm{auto}}$ 和 $c_{\\mathrm{accr}}$ 是速率系数，单位为 $\\mathrm{s}^{-1}$，$q_{c,0}$ 是自动转化阈值。\n\n雨水的蒸发以如下速率增加 $q_{v}$ 并减少 $q_{r}$\n$$E = c_{\\mathrm{evap}} \\left(1 - \\mathcal{H}\\right) q_{r},$$\n其中 $c_{\\mathrm{evap}}$ 是一个速率系数，单位为 $\\mathrm{s}^{-1}$，$\\mathcal{H}$ 是以小数表示的相对湿度 (RH)。假设没有同时凝结成云液水，并在所考虑的瞬间忽略沉降和湍流输送。\n\n从水物质守恒和湿空气块的热力学第一定律出发，由汽液相变引起的潜热造成的比温度趋势项为\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = \\frac{L_{v}}{c_{p}}\\left(\\dot{q}_{\\mathrm{cond}} - \\dot{q}_{\\mathrm{evap}}\\right),$$\n其中 $L_{v}$ 是蒸发潜热，$c_{p}$ 是定压下空气的比热容。在所述假设下，$\\dot{q}_{\\mathrm{cond}} = 0$ 且 $\\dot{q}_{\\mathrm{evap}} = E$。\n\n给定以下瞬时状态和参数：\n- $q_{c} = 1.8 \\times 10^{-3}$,\n- $q_{r} = 4.0 \\times 10^{-4}$,\n- $q_{c,0} = 1.0 \\times 10^{-3}$,\n- $\\mathcal{H} = 0.85$,\n- $c_{\\mathrm{auto}} = 1.0 \\times 10^{-3}\\ \\mathrm{s}^{-1}$,\n- $c_{\\mathrm{accr}} = 2.2 \\times 10^{-3}\\ \\mathrm{s}^{-1}$,\n- $c_{\\mathrm{evap}} = 4.0 \\times 10^{-3}\\ \\mathrm{s}^{-1}$,\n- $L_{v} = 2.5 \\times 10^{6}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$,\n- $c_{p} = 1.004 \\times 10^{3}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n\n请执行以下操作：\n1. 计算 $P_{\\mathrm{auto}}$ 和 $P_{\\mathrm{accr}}$ 作为 $q_{r}$ 的瞬时源趋势项，单位为 $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$。\n2. 计算 $E$，单位为 $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$。\n3. 使用上述热力学关系，量化由降雨形成（自动转化和碰并）和降雨蒸发引起的瞬时网格平均潜热加热（温度趋势）$\\left(\\mathrm{d}T/\\mathrm{d}t\\right)_{\\mathrm{lat}}$。清楚说明每个过程的贡献，并报告净值。\n\n将最终答案表示为一个以 $\\mathrm{K}\\,\\mathrm{s}^{-1}$ 为单位的数字，并四舍五入至四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于大气模型中常用的云微物理学和热力学原理。问题提法恰当，为获得唯一解提供了所有必要的数据和方程。语言客观，数据在物理上是一致的。\n\n该问题要求计算单个网格单元中微物理过程的瞬时速率以及由此产生的潜热加热率。步骤如下：\n\n1.  计算云液水向雨水自动转化的速率 $P_{\\mathrm{auto}}$。\n2.  计算雨水对云液水的碰并速率 $P_{\\mathrm{accr}}$。\n3.  计算雨水的蒸发速率 $E$。\n4.  通过考虑这些相变的热力学效应，计算净潜热加热率 $(\\mathrm{d}T/\\mathrm{d}t)_{\\mathrm{lat}}$。\n\n给定的参数如下：\n-   云液水混合比：$q_{c} = 1.8 \\times 10^{-3}$\n-   雨水混合比：$q_{r} = 4.0 \\times 10^{-4}$\n-   自动转化阈值：$q_{c,0} = 1.0 \\times 10^{-3}$\n-   相对湿度：$\\mathcal{H} = 0.85$\n-   自动转化速率系数：$c_{\\mathrm{auto}} = 1.0 \\times 10^{-3}\\ \\mathrm{s}^{-1}$\n-   碰并速率系数：$c_{\\mathrm{accr}} = 2.2 \\times 10^{-3}\\ \\mathrm{s}^{-1}$\n-   蒸发速率系数：$c_{\\mathrm{evap}} = 4.0 \\times 10^{-3}\\ \\mathrm{s}^{-1}$\n-   蒸发潜热：$L_{v} = 2.5 \\times 10^{6}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$\n-   空气比热容：$c_{p} = 1.004 \\times 10^{3}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n\n首先，我们计算自动转化速率 $P_{\\mathrm{auto}}$。公式为：\n$$P_{\\mathrm{auto}} = c_{\\mathrm{auto}} \\,\\max\\!\\left(q_{c} - q_{c,0},\\, 0\\right)$$\n代入给定值：\n$$q_{c} - q_{c,0} = (1.8 \\times 10^{-3}) - (1.0 \\times 10^{-3}) = 0.8 \\times 10^{-3}$$\n由于该值为正，最大值为 $0.8 \\times 10^{-3}$。\n$$P_{\\mathrm{auto}} = (1.0 \\times 10^{-3}\\ \\mathrm{s}^{-1}) \\times (0.8 \\times 10^{-3}) = 8.0 \\times 10^{-7}\\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$$\n\n其次，我们计算碰并速率 $P_{\\mathrm{accr}}$。公式为：\n$$P_{\\mathrm{accr}} = c_{\\mathrm{accr}} \\, q_{c} \\, q_{r}$$\n代入给定值：\n$$P_{\\mathrm{accr}} = (2.2 \\times 10^{-3}\\ \\mathrm{s}^{-1}) \\times (1.8 \\times 10^{-3}) \\times (4.0 \\times 10^{-4})$$\n$$P_{\\mathrm{accr}} = (2.2 \\times 1.8 \\times 4.0) \\times 10^{(-3-3-4)} = 15.84 \\times 10^{-10} = 1.584 \\times 10^{-9}\\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$$\n\n第三，我们计算雨水的蒸发速率 $E$。公式为：\n$$E = c_{\\mathrm{evap}} \\left(1 - \\mathcal{H}\\right) q_{r}$$\n代入给定值：\n$$E = (4.0 \\times 10^{-3}\\ \\mathrm{s}^{-1}) \\times (1 - 0.85) \\times (4.0 \\times 10^{-4})$$\n$$E = (4.0 \\times 10^{-3}\\ \\mathrm{s}^{-1}) \\times (0.15) \\times (4.0 \\times 10^{-4})$$\n$$E = (4.0 \\times 0.15 \\times 4.0) \\times 10^{(-3-4)} = 2.4 \\times 10^{-7}\\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$$\n\n最后，我们计算由潜热加热引起的瞬时温度趋势 $(\\mathrm{d}T/\\mathrm{d}t)_{\\mathrm{lat}}$。控制方程为：\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = \\frac{L_{v}}{c_{p}}\\left(\\dot{q}_{\\mathrm{cond}} - \\dot{q}_{\\mathrm{evap}}\\right)$$\n该方程将温度变化与汽相和液相之间的净质量传输速率联系起来。\n-   $\\dot{q}_{\\mathrm{cond}}$ 是凝结速率（水汽到液体），它释放潜热并导致增温。\n-   $\\dot{q}_{\\mathrm{evap}}$ 是蒸发速率（液体到水汽），它消耗潜热并导致降温。\n\n我们必须评估每个微物理过程如何对这些项产生贡献。\n-   自动转化 ($P_{\\mathrm{auto}}$) 和碰并 ($P_{\\mathrm{accr}}$) 表示云水（液体）向雨水（液体）的转化。由于在水汽和液体之间没有发生相变，这些过程对潜热加热没有贡献。因此，它们对 $\\dot{q}_{\\mathrm{cond}}$ 或 $\\dot{q}_{\\mathrm{evap}}$ 没有影响。\n-   雨水蒸发 ($E$) 表示从液体（雨水）到水汽的相变。此过程直接对应于蒸发项，因此 $\\dot{q}_{\\mathrm{evap}} = E$。\n-   问题陈述假设没有同时凝结成云液水，这意味着 $\\dot{q}_{\\mathrm{cond}} = 0$。\n\n因此，温度趋势方程简化为：\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = \\frac{L_{v}}{c_{p}}\\left(0 - E\\right) = -\\frac{L_{v}}{c_{p}} E$$\n负号表示蒸发导致温度下降（潜热冷却）。\n\n代入 $L_{v}$、$c_{p}$ 和我们计算出的 $E$ 的值：\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = -\\frac{2.5 \\times 10^{6}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}}{1.004 \\times 10^{3}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}} \\times (2.4 \\times 10^{-7}\\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1})$$\n首先，计算物理常数的比率：\n$$\\frac{L_{v}}{c_{p}} = \\frac{2.5 \\times 10^{6}}{1.004 \\times 10^{3}} \\approx 2490.04\\ \\mathrm{K}$$\n现在，乘以 $-E$：\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} \\approx -(2490.04\\ \\mathrm{K}) \\times (2.4 \\times 10^{-7}\\ \\mathrm{s}^{-1})$$\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} \\approx -597.609... \\times 10^{-6}\\ \\mathrm{K}\\,\\mathrm{s}^{-1} = -5.97609... \\times 10^{-4}\\ \\mathrm{K}\\,\\mathrm{s}^{-1}$$\n问题要求答案四舍五入到四位有效数字。\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = -5.976 \\times 10^{-4}\\ \\mathrm{K}\\,\\mathrm{s}^{-1}$$\n这个净结果是一个降温趋势，完全是由在指定未饱和条件下的雨水蒸发引起的。在此公式中，降雨形成的过程（自动转化和碰并）对潜热加热没有贡献。",
            "answer": "$$\\boxed{-5.976 \\times 10^{-4}}$$"
        },
        {
            "introduction": "现代微物理方案通常不仅预测水物质的质量（单矩），还预测其数浓度（双矩），以更精细地刻画粒子尺度谱的演变。这个练习要求你基于质量和粒子数守恒的物理约束，为一个双矩方案推导出云水向雨水转换过程的源汇项。通过此练习，你将深入理解，在参数化方案的设计中，如何确保质量和数浓度倾向项在数学上是协调的，以维持所假设的伽马（Gamma）尺度谱分布形状。",
            "id": "4111348",
            "problem": "考虑一个嵌入在数值天气预报框架中的暖雨双参数微物理方案。预报了两种水凝物类别：云滴和雨滴。设预报矩为质量混合比 $q_{c}$ 和 $q_{r}$（单位质量湿空气中的液态水质量），以及数浓度 $N_{c}$ 和 $N_{r}$（单位质量湿空气中的粒子数）。每个类别由一个关于粒子质量 $m$ 的滴谱分布（DSD）表示，其形状为 Gamma 分布，并受限于一个给定的形状参数：对于云滴，\n$$\nn_{c}(m) \\;=\\; \\frac{N_{c}}{\\Gamma(k_{c})\\, m_{*c}^{k_{c}}}\\, m^{k_{c}-1}\\, \\exp\\!\\left(-\\frac{m}{m_{*c}}\\right),\n$$\n对于雨滴，\n$$\nn_{r}(m) \\;=\\; \\frac{N_{r}}{\\Gamma(k_{r})\\, m_{*r}^{k_{r}}}\\, m^{k_{r}-1}\\, \\exp\\!\\left(-\\frac{m}{m_{*r}}\\right),\n$$\n其中 $k_{c}>0$ 和 $k_{r}>0$ 是给定的（固定的）形状参数，$\\Gamma(\\cdot)$ 是 Gamma 函数，$m_{*c}$ 和 $m_{*r}$ 是尺度参数。$n_{c}(m)$ 和 $n_{r}(m)$ 的 0 阶矩和 1 阶矩分别给出 $N_{x}$ 和 $q_{x}$（对于 $x\\in\\{c,r\\}$），这意味着平均粒子质量为\n$$\n\\bar{m}_{c} \\;=\\; \\frac{q_{c}}{N_{c}} \\;=\\; k_{c}\\, m_{*c}, \\qquad\n\\bar{m}_{r} \\;=\\; \\frac{q_{r}}{N_{r}} \\;=\\; k_{r}\\, m_{*r}.\n$$\n\n云向雨的转化通过两个过程发生：\n- 自动转化，源于云滴间的二元碰撞，形成质量超过雨滴阈值质量 $m_{t}$ 的滴。\n- 碰并，源于雨滴-云滴碰撞，将云水质量转移给雨水。\n\n设从云到雨的自动转化质量转化率表示为 $A(q_{c},N_{c})$，碰并质量转化率表示为 $C(q_{c},q_{r},N_{r})$。这些率可以从动力学碰并方程（KCE）通过对 $n_{c}(m)$ 和 $n_{r}(m)$ 积分适当的碰撞核来正式导出；此处不需要它们的显式形式，但它们满足 $A\\ge 0$ 和 $C\\ge 0$ 并且量纲为 $q$ 每单位时间。\n\n从液态水质量守恒和 Gamma-DSD 矩结构出发，在以下物理上一致的约束条件下，为预报矩向量 $(q_{c},N_{c},q_{r},N_{r})$ 推导由自动转化和碰并引起的源项（趋势项）的解析表达式：\n1. 液态水质量在类别间守恒：自动转化和碰并过程从云中移除质量并将其增加到雨中。\n2. 给定的形状参数 $k_{c}$ 和 $k_{r}$ 随时间保持不变。此约束要求每个类别中 $(q_{x},N_{x})$ 的隐含变化与 Gamma-DSD 矩关系一致，即，变化反映了在当前 DSD 意义上的谱均匀移除或注入。\n3. 自动转化过程减少的云滴数与移除的云质量相对于 $\\bar{m}_{c}$ 的比值成正比，并注入的雨滴数与增加的雨水质量相对于 $\\bar{m}_{r}$ 的比值成正比。碰并过程减少的云滴数与移除的云质量相对于 $\\bar{m}_{c}$ 的比值成正比，并增加雨水质量但不改变雨滴数（即，碰并过程使现有雨滴增长而不产生新的雨滴）。\n\n请将你的最终答案表示为由四个源项 $(S_{q_{c}},S_{N_{c}},S_{q_{r}},S_{N_{r}})$ 组成的单一封闭形式的符号行向量，用 $A$、$C$、$q_{c}$、$N_{c}$、$q_{r}$ 和 $N_{r}$ 表示。不需要进行数值计算。在最终的方框表达式中不要包含单位。",
            "solution": "用户希望在一个暖雨微物理参数化方案中，找到预报变量的源项。\n\n这个问题是**有效**的，因为它科学地基于云微物理学的既定原则，问题阐述清晰，具有明确的目标和充分的约束条件，并使用标准术语进行了客观陈述。推导过程是所提供规则的直接应用。\n\n预报矩的向量是 $(q_{c},N_{c},q_{r},N_{r})$。我们的任务是找到由自动转化和碰并这两个微物理过程引起的源项向量，或称为趋势项向量。设此向量为 $(S_{q_{c}}, S_{N_{c}}, S_{q_{r}}, S_{N_{r}})$，其中每一项代表相应变量的时间变化率。每个变量的总源项是来自自动转化（速率为 $A$）和碰并（速率为 $C$）的贡献之和。我们将根据给定的约束条件分析每个过程。\n\n首先，我们来处理质量混合比的趋势项 $S_{q_{c}}$ 和 $S_{q_{r}}$。约束条件1指出，液态水质量是守恒的，并且自动转化和碰并过程将质量从云类别转移到雨类别。\n由于自动转化，从云到雨的质量转化率是 $A$。\n由于碰并，从云到雨的质量转化率是 $C$。\n因此，云类别总的质量损失率是这两个率的总和。\n$$\nS_{q_{c}} = -A - C = -(A+C)\n$$\n根据质量守恒，雨类别必须获得等量的质量。\n$$\nS_{q_{r}} = A + C\n$$\n快速检查可以证实质量守恒：$S_{q_{c}} + S_{q_{r}} = -(A+C) + (A+C) = 0$。\n\n接下来，我们处理数浓度的趋势项 $S_{N_{c}}$ 和 $S_{N_{r}}$。这些由约束条件3确定，该约束指定了每个过程中粒子数如何变化。我们分别考虑每个过程。\n\n对于自动转化：\n- 约束条件3指出：“自动转化过程减少的云滴数与移除的云质量相对于 $\\bar{m}_{c}$ 的比值成正比”。由自动转化移除的云水质量为 $A$。云滴的平均质量是 $\\bar{m}_{c} = q_{c}/N_{c}$。因此，由自动转化引起的云数浓度的变化率是：\n$$\nS_{N_{c}}^{\\text{auto}} = -\\frac{A}{\\bar{m}_{c}} = -\\frac{A}{q_{c}/N_{c}} = -A\\frac{N_{c}}{q_{c}}\n$$\n- 约束条件3还指出：自动转化过程“注入的雨滴数与增加的雨水质量相对于 $\\bar{m}_{r}$ 的比值成正比”。增加到雨类别的质量是 $A$。雨滴的平均质量是 $\\bar{m}_{r} = q_{r}/N_{r}$。因此，由自动转化产生新雨滴的速率是：\n$$\nS_{N_{r}}^{\\text{auto}} = +\\frac{A}{\\bar{m}_{r}} = +\\frac{A}{q_{r}/N_{r}} = +A\\frac{N_{r}}{q_{r}}\n$$\n这种建模选择意味着自动转化增加了与原有雨滴群体具有相同平均质量的新雨滴，这确保了仅由自动转化过程引起的平均质量 $\\bar{m}_{r}$ 不变。\n\n对于碰并：\n- 约束条件3指出：“碰并过程减少的云滴数与移除的云质量相对于 $\\bar{m}_{c}$ 的比值成正比”。由碰并移除的云水质量是 $C$。这与自动转化对云滴数的影响是类似的。由碰并引起的云数浓度的变化率是：\n$$\nS_{N_{c}}^{\\text{accr}} = -\\frac{C}{\\bar{m}_{c}} = -\\frac{C}{q_{c}/N_{c}} = -C\\frac{N_{c}}{q_{c}}\n$$\n- 约束条件3还指出：碰并过程“增加雨水质量但不改变雨滴数”。这是一个明确的陈述，即碰并过程使现有雨滴增长而不产生新的雨滴。\n$$\nS_{N_{r}}^{\\text{accr}} = 0\n$$\n\n现在，我们将两个过程的贡献相加，以求得数浓度的总趋势项。\n云数浓度 $S_{N_{c}}$ 的总趋势项是自动转化和碰并部分的总和：\n$$\nS_{N_{c}} = S_{N_{c}}^{\\text{auto}} + S_{N_{c}}^{\\text{accr}} = -A\\frac{N_{c}}{q_{c}} - C\\frac{N_{c}}{q_{c}} = -(A+C)\\frac{N_{c}}{q_{c}}\n$$\n雨数浓度 $S_{N_{r}}$ 的总趋势项是自动转化和碰并部分的总和：\n$$\nS_{N_{r}} = S_{N_{r}}^{\\text{auto}} + S_{N_{r}}^{\\text{accr}} = A\\frac{N_{r}}{q_{r}} + 0 = A\\frac{N_{r}}{q_{r}}\n$$\n\n最后，我们按照要求将四个推导出的源项组合成一个单一的行向量。\n源项向量 $(S_{q_{c}}, S_{N_{c}}, S_{q_{r}}, S_{N_{r}})$ 是：\n$S_{q_{c}} = -(A+C)$\n$S_{N_{c}} = -(A+C)\\frac{N_{c}}{q_{c}}$\n$S_{q_{r}} = A+C$\n$S_{N_{r}} = A\\frac{N_{r}}{q_{r}}$\n\n最终的向量是 $\\left( -(A+C), -(A+C)\\frac{N_{c}}{q_{c}}, A+C, A\\frac{N_{r}}{q_{r}} \\right)$。这些表达式与所给的约束条件在物理上是一致的。例如，在这些变换下，平均云滴质量 $\\bar{m}_{c}=q_{c}/N_{c}$ 保持不变，因为 $\\frac{d\\bar{m}_{c}}{dt} \\propto \\frac{S_{q_{c}}}{q_{c}} - \\frac{S_{N_{c}}}{N_{c}} = \\frac{-(A+C)}{q_{c}} - \\frac{-(A+C)}{q_{c}} = 0$。这与约束条件2一致。相反地，平均雨滴质量 $\\bar{m}_{r}=q_{r}/N_{r}$ 由于碰并而增加，因为 $\\frac{d\\bar{m}_{r}}{dt} \\propto \\frac{S_{q_{r}}}{q_{r}} - \\frac{S_{N_{r}}}{N_{r}} = \\frac{A+C}{q_{r}} - \\frac{A}{q_{r}} = \\frac{C}{q_{r}} > 0$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} -(A+C)  -(A+C)\\frac{N_{c}}{q_{c}}  A+C  A\\frac{N_{r}}{q_{r}} \\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在实际的大气模拟中，多种参数化方案并存，它们之间的差异构成了模型不确定性的一个重要来源，即“结构不确定性”。本练习模拟了一项真实的研究任务：在一个简化的“箱式模型”中，对比三种经典的暖雨参数化方案（Kessler、Khairoutdinov–Kogan 2000 和 Seifert–Beheng）。你将学习如何通过标准化处理，剥离各方案因参数整定带来的幅度差异，从而专注分析其内在的结构性差异，并最终量化这种不确定性。",
            "id": "4111354",
            "problem": "您需要实现一个零维暖雨微物理试验平台，该平台用于在相同的环境和热力学条件下，比较三种暖雨参数化方案——Kessler、Khairoutdinov–Kogan 2000（在首次提及后将使用缩写）和 Seifert–Beheng——的结构行为。目标是通过隔离自动转化和碰并过程中的过程级差异，而不是由参数调整引起的差异，来评估结构不确定性。您的程序必须生成单行输出，包含一个浮点数列表，每个测试用例对应一个浮点数，该浮点数是下文定义的复合结构差异度量。在适用情况下，所有结果的单位必须是 $\\mathrm{s^{-1}}$，所有输入的混合比单位必须是 $\\mathrm{kg\\,kg^{-1}}$。\n\n从以下基本且经过充分检验的事实出发：\n- 对于混合比的质量守恒意味着，在一个包含云水混合比 $q_c$ 和雨水混合比 $q_r$ 的封闭暖雨箱中，由自动转化、碰并和蒸发引起的过程级趋势满足\n$$\n\\frac{dq_c}{dt} = -\\left(P_{\\mathrm{aut}} + P_{\\mathrm{accr}}\\right),\\quad\n\\frac{dq_r}{dt} = +\\left(P_{\\mathrm{aut}} + P_{\\mathrm{accr}}\\right) - P_{\\mathrm{evap}},\n$$\n其中，当 $P_{\\mathrm{aut}}$、$P_{\\mathrm{accr}}$ 和 $P_{\\mathrm{evap}}$ 应用于无量纲的混合比 $q_c$ 和 $q_r$（单位为 $\\mathrm{kg\\,kg^{-1}}$）时，它们的单位为 $\\mathrm{s^{-1}}$。\n- 碰撞-合并通过自动转化（一个仅涉及云的过程）和碰并（雨对云的收集）增加雨水质量，而蒸发在次饱和空气中按比例于饱和亏损因子移除雨水。\n- 云滴数浓度 $N_c$ 和雨滴数浓度 $N_r$（单位均为 $\\mathrm{m^{-3}}$）编码了微物理结构；在双矩方案中，质量传输率取决于从 $q_c$、$q_r$、$N_c$ 和 $N_r$ 推断出的特征尺度。\n\n使用以下数学上明确的过程率公式实现三种参数化方案。所有符号和常量必须严格按照给定的使用。\n\n通用环境和物理常量（在指定处使用）：\n- 空气密度：$\\rho_a = 1.2\\,\\mathrm{kg\\,m^{-3}}$。\n- 液态水密度：$\\rho_w = 1000\\,\\mathrm{kg\\,m^{-3}}$。\n- 参考云滴数浓度：$N_{\\mathrm{ref}} = 1.0\\times 10^{8}\\,\\mathrm{m^{-3}}$。\n- 通用蒸发系数：$E_0 = 2.0\\times 10^{-3}\\,\\mathrm{s^{-1}}$（所有方案共享，以隔离收集过程的结构差异）。\n- 蒸发率：\n$$\nP_{\\mathrm{evap}} = E_0\\, q_r \\,\\max\\left(1 - \\mathrm{RH},\\, 0\\right),\n$$\n其中 $\\mathrm{RH}$ 是相对湿度，为 $[0,1]$ 范围内的分数。\n\nKessler 方案（单矩）：\n- 阈值自动转化：\n$$\nP_{\\mathrm{aut}}^{\\mathrm{Kes}} = A_{\\mathrm{Kes}} \\,\\max\\left(q_c - q_{0},\\, 0\\right),\n$$\n其中 $A_{\\mathrm{Kes}} = 1.0\\times 10^{-3}\\,\\mathrm{s^{-1}}$，$q_{0} = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,kg^{-1}}$。\n- 碰并：\n$$\nP_{\\mathrm{accr}}^{\\mathrm{Kes}} = B_{\\mathrm{Kes}}\\, q_c\\, q_r,\n$$\n其中 $B_{\\mathrm{Kes}} = 1.6\\,\\mathrm{s^{-1}}$。\n\nKhairoutdinov–Kogan 2000 方案（在 $q_c$ 和 $q_r$ 中为单矩，在自动转化中具有明确的 $N_c$ 依赖性）：\n- 自动转化（含 $N_c$ 的幂律）：\n$$\nP_{\\mathrm{aut}}^{\\mathrm{KK}} = A_{\\mathrm{KK}}\\, q_c^{p}\\,\\left(\\frac{N_c}{N_{\\mathrm{ref}}}\\right)^{-r},\n$$\n其中 $A_{\\mathrm{KK}} = 5.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$，$p = 2.2$，$r = 0.5$。\n- 碰并（在 $q_r$ 中为非线性）：\n$$\nP_{\\mathrm{accr}}^{\\mathrm{KK}} = B_{\\mathrm{KK}}\\, q_c\\, q_r^{\\delta},\n$$\n其中 $B_{\\mathrm{KK}} = 2.2\\,\\mathrm{s^{-1}}$，$\\delta = 0.875$。\n\nSeifert–Beheng 方案（雨水为双矩；通过特征尺度体现结构依赖性）：\n- 云有效半径（从 $q_c$ 和 $N_c$ 诊断）：\n$$\nr_{\\mathrm{eff},c} = \\left(\\frac{3\\, \\rho_a\\, q_c}{4\\pi\\, \\rho_w\\, N_c}\\right)^{1/3}\\ \\mathrm{m}.\n$$\n- 雨水质量加权平均直径（从 $q_r$ 和 $N_r$ 诊断）：\n$$\nD_m = \\left(\\frac{6\\, \\rho_a\\, q_r}{\\pi\\, \\rho_w\\, N_r}\\right)^{1/3}\\ \\mathrm{m}.\n$$\n- 自动转化（尺度调制的 $q_c$ 二次型）：\n$$\nP_{\\mathrm{aut}}^{\\mathrm{SB}} = A_{\\mathrm{SB}}\\, q_c^{2}\\, \\left(\\frac{r_{\\mathrm{eff},c}}{r_0}\\right)^{s},\\quad A_{\\mathrm{SB}} = 8.0\\times 10^{-4}\\,\\mathrm{s^{-1}},\\ r_0 = 10\\times 10^{-6}\\,\\mathrm{m},\\ s = 0.5.\n$$\n- 碰并（尺度调制的近线性 $q_r$ 型）：\n$$\nP_{\\mathrm{accr}}^{\\mathrm{SB}} = B_{\\mathrm{SB}}\\, q_c\\, q_r^{\\eta}\\, \\left(\\frac{D_m}{D_0}\\right)^{\\beta},\\quad B_{\\mathrm{SB}} = 1.8\\,\\mathrm{s^{-1}},\\ \\eta = 0.95,\\ D_0 = 1.0\\times 10^{-3}\\,\\mathrm{m},\\ \\beta = 0.5.\n$$\n\n幅度对齐以隔离结构差异：\n- 对于一个指定的参考测试用例（如下文所述），计算每个方案的未缩放总雨水质量生成（源），\n$$\nR^{X}_{\\mathrm{ref}} = P_{\\mathrm{aut}}^{X} + P_{\\mathrm{accr}}^{X},\\quad X\\in\\{\\mathrm{Kes},\\mathrm{KK},\\mathrm{SB}\\}.\n$$\n- 将参考用例下的共同目标生成量定义为\n$$\n\\overline{R}_{\\mathrm{ref}} = \\frac{1}{3}\\left(R^{\\mathrm{Kes}}_{\\mathrm{ref}} + R^{\\mathrm{KK}}_{\\mathrm{ref}} + R^{\\mathrm{SB}}_{\\mathrm{ref}}\\right).\n$$\n- 为每个方案计算一个标量幅度因子：\n$$\ns_X = \\frac{\\overline{R}_{\\mathrm{ref}}}{R^{X}_{\\mathrm{ref}}}.\n$$\n- 对于每个测试用例（包括参考用例），仅将每个方案的自动转化和碰并乘以其对应的 $s_X$ 进行缩放：\n$$\n\\widetilde{P}_{\\mathrm{aut}}^{X} = s_X\\, P_{\\mathrm{aut}}^{X},\\quad \\widetilde{P}_{\\mathrm{accr}}^{X} = s_X\\, P_{\\mathrm{accr}}^{X},\n$$\n并保持所有方案的 $P_{\\mathrm{evap}}$ 相同（使用上述的 $E_0$）。这样可以隔离结构（形状）差异，而非简单的幅度调整。\n\n为每个方案 $X$ 和测试用例定义以下诊断量：\n- 总缩放生成量：\n$$\n\\widetilde{R}^{X} = \\widetilde{P}_{\\mathrm{aut}}^{X} + \\widetilde{P}_{\\mathrm{accr}}^{X}.\n$$\n- 归一化生成分裂向量（构成），\n$$\n\\mathbf{c}^{X} =\n\\begin{cases}\n\\left[\\dfrac{\\widetilde{P}_{\\mathrm{aut}}^{X}}{\\widetilde{R}^{X}},\\ \\dfrac{\\widetilde{P}_{\\mathrm{accr}}^{X}}{\\widetilde{R}^{X}}\\right],  \\text{if } \\widetilde{R}^{X} > 0 \\\\\n[0,0],  \\text{if } \\widetilde{R}^{X} = 0\n\\end{cases}\n$$\n- 相对于生成的蒸发分数（蒸发限制响应），\n$$\ne^{X} = \\frac{P_{\\mathrm{evap}}}{\\widetilde{R}^{X} + \\varepsilon},\\quad \\varepsilon = 10^{-30}.\n$$\n\n对于每个测试用例，计算方案 $X$ 和 $Y$ 之间的成对结构距离：\n- 构成距离：\n$$\nd_1(X,Y) = \\left\\|\\mathbf{c}^{X} - \\mathbf{c}^{Y}\\right\\|_2.\n$$\n- 蒸发分数距离：\n$$\nd_2(X,Y) = \\left|e^{X} - e^{Y}\\right|.\n$$\n- 相对生成形状距离：\n$$\nd_3(X,Y) = \\left|\\log_{10}\\left(\\frac{\\widetilde{R}^{X} + \\varepsilon}{\\widetilde{R}^{Y} + \\varepsilon}\\right)\\right|.\n$$\n- 复合对度量：\n$$\nm_{\\mathrm{pair}}(X,Y) = \\frac{d_1(X,Y) + d_2(X,Y) + d_3(X,Y)}{3}.\n$$\n将测试用例的结构不确定性度量定义为三对度量的平均值：\n$$\nM_{\\mathrm{case}} = \\frac{1}{3}\\left[m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{KK}) + m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{SB}) + m_{\\mathrm{pair}}(\\mathrm{KK},\\mathrm{SB})\\right].\n$$\n\n测试套件（五个物理上合理的箱状态）。每个测试用例是一个元组 $\\left(q_c, q_r, \\mathrm{RH}, N_c, N_r\\right)$，其中 $q_c$ 和 $q_r$ 的单位是 $\\mathrm{kg\\,kg^{-1}}$，$\\mathrm{RH}$ 是一个在 $[0,1]$ 范围内的无单位分数，$N_c, N_r$ 的单位是 $\\mathrm{m^{-3}}$：\n- 用例 1（次阈值云，无雨）：$\\left(2.0\\times 10^{-4},\\ 0.0,\\ 0.90,\\ 1.0\\times 10^{8},\\ 5.0\\times 10^{5}\\right)$。\n- 用例 2（中等云量，初生雨）：$\\left(8.0\\times 10^{-4},\\ 1.0\\times 10^{-5},\\ 0.80,\\ 1.5\\times 10^{8},\\ 1.0\\times 10^{6}\\right)$。\n- 用例 3（用于幅度对齐的参考）：$\\left(1.5\\times 10^{-3},\\ 5.0\\times 10^{-4},\\ 0.85,\\ 1.0\\times 10^{8},\\ 5.0\\times 10^{5}\\right)$。\n- 用例 4（雨水主导）：$\\left(2.0\\times 10^{-4},\\ 1.5\\times 10^{-3},\\ 0.70,\\ 8.0\\times 10^{7},\\ 2.0\\times 10^{5}\\right)$。\n- 用例 5（近饱和，弱蒸发）：$\\left(1.0\\times 10^{-3},\\ 2.0\\times 10^{-4},\\ 0.98,\\ 1.0\\times 10^{8},\\ 1.0\\times 10^{6}\\right)$。\n\n实现要求：\n- 严格按照上述公式为每个方案和测试用例计算 $P_{\\mathrm{aut}}$、$P_{\\mathrm{accr}}$ 和 $P_{\\mathrm{evap}}$。\n- 仅使用用例 3 来计算幅度因子 $s_{\\mathrm{Kes}}$、$s_{\\mathrm{KK}}$、$s_{\\mathrm{SB}}$，然后将这些因子应用于所有五个用例的自动转化和碰并的缩放。\n- 对于每个用例，计算定义的 $M_{\\mathrm{case}}$。\n- 最终输出必须是单行，包含一个 Python 风格的五个浮点数列表 $\\left[M_1,M_2,M_3,M_4,M_5\\right]$，顺序如此，每个浮点数四舍五入到六位小数。\n- 不涉及角度；不需要角度单位。\n- 所有计算都必须使用提供的单位进行；不需要进行所示之外的单位转换。\n\n您的程序必须是自包含的，不得读取任何输入，也不得访问外部资源。它应该严格按照所述格式生成一行输出（例如，$\\left[\\mathrm{result1},\\mathrm{result2},\\mathrm{result3},\\mathrm{result4},\\mathrm{result5}\\right]$）。",
            "solution": "该问题要求实现一个零维箱模型，以比较三种不同的暖雨参数化方案：Kessler、Khairoutdinov–Kogan 2000 (KK) 和 Seifert–Beheng (SB)。目标是通过在一组标准化条件下分析它们的过程级行为，来量化这些方案之间的结构不确定性。解决方案分为三个主要阶段：(1) 实现每个方案的物理过程率；(2) 基于一个参考用例对方案的生成幅度进行归一化，以隔离结构差异；(3) 为一组测试用例计算结构相异性的复合度量。\n\n首先，我们按规定定义基本物理常量和模型参数。这些包括环境常量，如空气密度 $\\rho_a = 1.2\\,\\mathrm{kg\\,m^{-3}}$ 和液态水密度 $\\rho_w = 1000\\,\\mathrm{kg\\,m^{-3}}$，以及每个方案特定的过程参数。\n\n模型的核心由代表微物理过程率的函数组成。对于每个方案 $X \\in \\{\\mathrm{Kes},\\mathrm{KK},\\mathrm{SB}\\}$，我们实现了自动转化率 $P_{\\mathrm{aut}}^{X}$ 和碰并率 $P_{\\mathrm{accr}}^{X}$。这些率决定了从云水（$q_c$）到雨水（$q_r$）的质量转移。一个单一、通用的蒸发公式 $P_{\\mathrm{evap}}$ 被应用于所有方案，以确保差异仅源于降雨形成过程（自动转化和碰并）。\n\nKessler 方案是一个单矩总体参数化，其特征是基于阈值的自动转化和线性碰并：\n$$\nP_{\\mathrm{aut}}^{\\mathrm{Kes}} = A_{\\mathrm{Kes}} \\,\\max\\left(q_c - q_{0},\\, 0\\right)\n$$\n$$\nP_{\\mathrm{accr}}^{\\mathrm{Kes}} = B_{\\mathrm{Kes}}\\, q_c\\, q_r\n$$\n其常量为 $A_{\\mathrm{Kes}} = 1.0\\times 10^{-3}\\,\\mathrm{s^{-1}}$，$q_{0} = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,kg^{-1}}$ 和 $B_{\\mathrm{Kes}} = 1.6\\,\\mathrm{s^{-1}}$。\n\nKhairoutdinov–Kogan 方案在自动转化率中引入了对云滴数浓度 $N_c$ 的依赖，这代表了与 Kessler 方案的一个重要结构差异。其过程率由幂律给出：\n$$\nP_{\\mathrm{aut}}^{\\mathrm{KK}} = A_{\\mathrm{KK}}\\, q_c^{p}\\,\\left(\\frac{N_c}{N_{\\mathrm{ref}}}\\right)^{-r}\n$$\n$$\nP_{\\mathrm{accr}}^{\\mathrm{KK}} = B_{\\mathrm{KK}}\\, q_c\\, q_r^{\\delta}\n$$\n其参数为 $A_{\\mathrm{KK}} = 5.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$，$p = 2.2$，$r = 0.5$，$N_{\\mathrm{ref}} = 1.0\\times 10^{8}\\,\\mathrm{m^{-3}}$，$B_{\\mathrm{KK}} = 2.2\\,\\mathrm{s^{-1}}$ 和 $\\delta = 0.875$。\n\nSeifert–Beheng 方案是一个更复杂的雨水双矩方案，其中过程率不仅取决于质量混合比，还取决于特征粒子尺度，这些尺度是从质量和数浓度（$q_c, N_c, q_r, N_r$）共同诊断得出的。\n首先，诊断云有效半径 $r_{\\mathrm{eff},c}$ 和雨水质量加权平均直径 $D_m$：\n$$\nr_{\\mathrm{eff},c} = \\left(\\frac{3\\, \\rho_a\\, q_c}{4\\pi\\, \\rho_w\\, N_c}\\right)^{1/3}\n$$\n$$\nD_m = \\left(\\frac{6\\, \\rho_a\\, q_r}{\\pi\\, \\rho_w\\, N_r}\\right)^{1/3}\n$$\n这些尺度对过程率进行调制：\n$$\nP_{\\mathrm{aut}}^{\\mathrm{SB}} = A_{\\mathrm{SB}}\\, q_c^{2}\\, \\left(\\frac{r_{\\mathrm{eff},c}}{r_0}\\right)^{s}\n$$\n$$\nP_{\\mathrm{accr}}^{\\mathrm{SB}} = B_{\\mathrm{SB}}\\, q_c\\, q_r^{\\eta}\\, \\left(\\frac{D_m}{D_0}\\right)^{\\beta}\n$$\n其参数集包括用于自动转化的 $A_{\\mathrm{SB}} = 8.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$，$r_0 = 10\\times 10^{-6}\\,\\mathrm{m}$ 和 $s=0.5$，以及用于碰并的 $B_{\\mathrm{SB}} = 1.8\\,\\mathrm{s^{-1}}$，$\\eta=0.95$，$D_0=1.0\\times 10^{-3}\\,\\mathrm{m}$ 和 $\\beta=0.5$。如果 $q_r=0$ 或 $N_r=0$，$D_m$ 为零，并且由于 $\\eta0$，$P_{\\mathrm{accr}}^{\\mathrm{SB}}$ 会正确地计算为零。\n\n一个关键步骤是幅度对齐。为了比较方案的*结构*而不是它们可以调整的基线量级，我们对它们进行归一化。使用指定的参考用例（用例3），我们为每个方案计算未缩放的总降雨生成量 $R^{X}_{\\mathrm{ref}} = P_{\\mathrm{aut}}^{X} + P_{\\mathrm{accr}}^{X}$。目标生成率是它们的平均值 $\\overline{R}_{\\mathrm{ref}}$。由此，我们为每个方案推导出唯一的缩放因子 $s_X = \\overline{R}_{\\mathrm{ref}} / R^{X}_{\\mathrm{ref}}$。然后将这些因子应用于所有测试用例的自动转化和碰并率：\n$$\n\\widetilde{P}_{\\mathrm{aut}}^{X} = s_X\\, P_{\\mathrm{aut}}^{X}, \\quad \\widetilde{P}_{\\mathrm{accr}}^{X} = s_X\\, P_{\\mathrm{accr}}^{X}\n$$\n这确保了在参考点，所有方案都以相同的总速率 $\\widetilde{R}^X = \\overline{R}_{\\mathrm{ref}}$ 产生雨水。在其他测试用例中与此等式的任何偏离都是由于它们公式中的结构差异造成的。\n\n利用缩放后的速率，我们为每个方案 $X$ 和测试用例计算一组诊断量。这些诊断量旨在探究方案结构的不同方面：\n1.  归一化生成分裂向量 $\\mathbf{c}^{X} = \\left[\\widetilde{P}_{\\mathrm{aut}}^{X}/\\widetilde{R}^{X}, \\widetilde{P}_{\\mathrm{accr}}^{X}/\\widetilde{R}^{X}\\right]$（对于 $\\widetilde{R}^{X}0$），捕捉了质量通量在自动转化和碰并之间的分配。\n2.  蒸发分数 $e^{X} = P_{\\mathrm{evap}}/(\\widetilde{R}^{X} + \\varepsilon)$，量化了雨水生成和蒸发之间的平衡，其中一个小数 $\\varepsilon = 10^{-30}$ 确保了数值稳定性。\n3.  总缩放生成量本身 $\\widetilde{R}^{X}$，揭示了总生成响应如何作为输入状态变量的函数偏离参考用例。\n\n最后，我们使用一个复合度量来量化任意两个方案 $X$ 和 $Y$ 之间的结构差异。该度量由三个成对距离构成：\n-   $d_1(X,Y) = \\left\\|\\mathbf{c}^{X} - \\mathbf{c}^{Y}\\right\\|_2$，它们构成向量之间的欧几里得距离。\n-   $d_2(X,Y) = \\left|e^{X} - e^{Y}\\right|$，它们蒸发限制响应的差异。\n-   $d_3(X,Y) = \\left|\\log_{10}\\left((\\widetilde{R}^{X} + \\varepsilon)/(\\widetilde{R}^{Y} + \\varepsilon)\\right)\\right|$，它们总生成率的对数比率，这捕捉了它们响应函数形状的差异。\n\n复合对度量是这三个距离的平均值：$m_{\\mathrm{pair}}(X,Y) = (d_1+d_2+d_3)/3$。对于给定的测试用例，最终的结构不确定性度量 $M_{\\mathrm{case}}$ 是三个可能的成对度量：$m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{KK})$、$m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{SB})$ 和 $m_{\\mathrm{pair}}(\\mathrm{KK},\\mathrm{SB})$ 的平均值。对所有五个测试用例重复此过程，得出一个包含五个 $M_{\\mathrm{case}}$ 值的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Implements a zero-dimensional warm-rain microphysics testbed to compare\n    Kessler, Khairoutdinov-Kogan 2000, and Seifert-Beheng parameterizations.\n    \"\"\"\n\n    # ----------------------------------------------------------------------\n    # 1. Define Constants and Parameters\n    # ----------------------------------------------------------------------\n\n    # Common environmental and physical constants\n    RHO_A = 1.2         # Air density (kg/m^3)\n    RHO_W = 1000.0      # Liquid water density (kg/m^3)\n    N_REF = 1.0e8       # Reference cloud droplet number (m^-3)\n    E0 = 2.0e-3         # Common evaporation coefficient (s^-1)\n    EPSILON = 1.0e-30   # Small number for numerical stability\n\n    # Kessler scheme parameters\n    A_KES = 1.0e-3      # s^-1\n    Q0_KES = 5.0e-4     # kg/kg\n    B_KES = 1.6         # s^-1\n\n    # Khairoutdinov-Kogan 2000 (KK) parameters\n    A_KK = 5.0e-4       # s^-1\n    P_KK = 2.2\n    R_KK = 0.5\n    B_KK = 2.2          # s^-1\n    DELTA_KK = 0.875\n\n    # Seifert-Beheng (SB) parameters\n    A_SB = 8.0e-4       # s^-1\n    R0_SB = 10.0e-6     # m\n    S_SB = 0.5\n    B_SB = 1.8          # s^-1\n    ETA_SB = 0.95\n    D0_SB = 1.0e-3      # m\n    BETA_SB = 0.5\n\n    # ----------------------------------------------------------------------\n    # 2. Define Process Rate Functions\n    # ----------------------------------------------------------------------\n\n    def p_evap(qr, rh):\n        return E0 * qr * max(1.0 - rh, 0.0)\n\n    # Kessler\n    def p_aut_kes(qc):\n        return A_KES * max(qc - Q0_KES, 0.0)\n\n    def p_accr_kes(qc, qr):\n        return B_KES * qc * qr\n\n    # Khairoutdinov-Kogan\n    def p_aut_kk(qc, nc):\n        if qc == 0: return 0.0\n        return A_KK * (qc**P_KK) * ((nc / N_REF)**(-R_KK))\n\n    def p_accr_kk(qc, qr):\n        if qc == 0 or qr == 0: return 0.0\n        return B_KK * qc * (qr**DELTA_KK)\n\n    # Seifert-Beheng\n    def r_eff_c_sb(qc, nc):\n        if qc == 0 or nc == 0: return 0.0\n        return np.cbrt((3.0 * RHO_A * qc) / (4.0 * np.pi * RHO_W * nc))\n\n    def d_m_sb(qr, nr):\n        if qr == 0 or nr == 0: return 0.0\n        return np.cbrt((6.0 * RHO_A * qr) / (np.pi * RHO_W * nr))\n\n    def p_aut_sb(qc, nc):\n        if qc == 0: return 0.0\n        reff_c = r_eff_c_sb(qc, nc)\n        return A_SB * (qc**2) * ((reff_c / R0_SB)**S_SB)\n\n    def p_accr_sb(qc, qr, nr):\n        if qc == 0 or qr == 0: return 0.0\n        dm = d_m_sb(qr, nr)\n        return B_SB * qc * (qr**ETA_SB) * ((dm / D0_SB)**BETA_SB)\n\n    # ----------------------------------------------------------------------\n    # 3. Define Test Cases\n    # ----------------------------------------------------------------------\n    # (qc, qr, RH, Nc, Nr)\n    test_cases = [\n        (2.0e-4, 0.0,    0.90, 1.0e8, 5.0e5), # Case 1\n        (8.0e-4, 1.0e-5, 0.80, 1.5e8, 1.0e6), # Case 2\n        (1.5e-3, 5.0e-4, 0.85, 1.0e8, 5.0e5), # Case 3 (Reference)\n        (2.0e-4, 1.5e-3, 0.70, 8.0e7, 2.0e5), # Case 4\n        (1.0e-3, 2.0e-4, 0.98, 1.0e8, 1.0e6), # Case 5\n    ]\n    ref_case = test_cases[2]\n\n    # ----------------------------------------------------------------------\n    # 4. Amplitude Alignment\n    # ----------------------------------------------------------------------\n    qc_ref, qr_ref, _, nc_ref, nr_ref = ref_case\n\n    # Kessler\n    R_kes_ref = p_aut_kes(qc_ref) + p_accr_kes(qc_ref, qr_ref)\n    # Khairoutdinov-Kogan\n    R_kk_ref = p_aut_kk(qc_ref, nc_ref) + p_accr_kk(qc_ref, qr_ref)\n    # Seifert-Beheng\n    R_sb_ref = p_aut_sb(qc_ref, nc_ref) + p_accr_sb(qc_ref, qr_ref, nr_ref)\n\n    R_bar_ref = (R_kes_ref + R_kk_ref + R_sb_ref) / 3.0\n\n    s_kes = R_bar_ref / R_kes_ref if R_kes_ref > 0 else 1.0\n    s_kk = R_bar_ref / R_kk_ref if R_kk_ref > 0 else 1.0\n    s_sb = R_bar_ref / R_sb_ref if R_sb_ref > 0 else 1.0\n\n    # ----------------------------------------------------------------------\n    # 5. Main Calculation Loop\n    # ----------------------------------------------------------------------\n    M_cases_results = []\n    \n    scheme_funcs = {\n        'Kes': {'aut': p_aut_kes, 'accr': p_accr_kes, 's': s_kes},\n        'KK':  {'aut': p_aut_kk,  'accr': p_accr_kk,  's': s_kk},\n        'SB':  {'aut': p_aut_sb,  'accr': p_accr_sb,  's': s_sb},\n    }\n    \n    for case in test_cases:\n        qc, qr, rh, nc, nr = case\n        \n        # Calculate diagnostics for each scheme\n        diags = {}\n        for name, funcs in scheme_funcs.items():\n            \n            # Pass only required arguments\n            aut_args = {'qc': qc, 'nc': nc}\n            accr_args = {'qc': qc, 'qr': qr, 'nr': nr}\n            \n            p_aut_unscaled = funcs['aut'](**{k: v for k, v in aut_args.items() if k in funcs['aut'].__code__.co_varnames})\n            p_accr_unscaled = funcs['accr'](**{k: v for k, v in accr_args.items() if k in funcs['accr'].__code__.co_varnames})\n            \n            p_aut_scaled = funcs['s'] * p_aut_unscaled\n            p_accr_scaled = funcs['s'] * p_accr_unscaled\n            \n            R_scaled = p_aut_scaled + p_accr_scaled\n            \n            if R_scaled > 0:\n                c_vec = np.array([p_aut_scaled / R_scaled, p_accr_scaled / R_scaled])\n            else:\n                c_vec = np.array([0.0, 0.0])\n\n            evap_rate = p_evap(qr, rh)\n            e_frac = evap_rate / (R_scaled + EPSILON)\n            \n            diags[name] = {'R': R_scaled, 'c': c_vec, 'e': e_frac}\n\n        # Calculate pairwise metrics\n        pairs = [('Kes', 'KK'), ('Kes', 'SB'), ('KK', 'SB')]\n        m_pair_values = []\n        for X, Y in pairs:\n            # d1: Composition distance\n            d1 = np.linalg.norm(diags[X]['c'] - diags[Y]['c'])\n            # d2: Evaporation-fraction distance\n            d2 = abs(diags[X]['e'] - diags[Y]['e'])\n            # d3: Relative production shape distance\n            d3 = abs(np.log10((diags[X]['R'] + EPSILON) / (diags[Y]['R'] + EPSILON)))\n            \n            m_pair = (d1 + d2 + d3) / 3.0\n            m_pair_values.append(m_pair)\n            \n        # Calculate final case metric\n        M_case = np.mean(m_pair_values)\n        M_cases_results.append(M_case)\n\n    # ----------------------------------------------------------------------\n    # 6. Final Output\n    # ----------------------------------------------------------------------\n    formatted_results = [f\"{r:.6f}\" for r in M_cases_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nsolve()\n```"
        }
    ]
}