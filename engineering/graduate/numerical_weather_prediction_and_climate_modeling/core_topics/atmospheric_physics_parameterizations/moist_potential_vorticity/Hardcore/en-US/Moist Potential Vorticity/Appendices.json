{
    "hands_on_practices": [
        {
            "introduction": "Before applying a complex concept like Moist Potential Vorticity (MPV), it is essential to build a physical intuition for its nature. This first practice grounds the abstract definition of MPV by tasking you with a fundamental analysis of its dimensions and a \"back-of-the-envelope\" calculation of its typical magnitude in the mid-latitude troposphere. Completing this exercise  will provide a tangible sense of scale for the values you might encounter in weather charts and model outputs.",
            "id": "4066898",
            "problem": "A dry-air reversible analogue of moist Ertel potential vorticity is defined by projecting the absolute vorticity onto the gradient of a materially conserved moist potential temperature, and normalizing by mass density. Let the materially conserved scalar be a moist potential temperature, denoted by $\\theta_{m}$, and define the scalar quantity $q$ as the volume-specific projection of the absolute vorticity vector onto $\\nabla \\theta_{m}$. \n\nTask 1 (dimensions): Using only base dimensions mass $M$, length $L$, time $T$, and thermodynamic temperature $\\Theta$, determine the physical dimensions of $q$.\n\nTask 2 (typical magnitude): Evaluate a representative midlatitude magnitude of $q$ in the free troposphere by assuming the following scientifically plausible conditions and using only fundamental relations:\n- Latitude $\\phi = 45^\\circ$; Earth’s rotation rate $\\Omega = 7.292 \\times 10^{-5}\\ \\mathrm{s}^{-1}$; take the vertical component of absolute vorticity to be dominated by the Coriolis parameter $f = 2 \\Omega \\sin \\phi$.\n- Static stability characterized by the Brunt–Väisälä frequency (BVF) $N = 1.0 \\times 10^{-2}\\ \\mathrm{s}^{-1}$ and a representative reference moist potential temperature $\\theta_{0} = 300\\ \\mathrm{K}$, so that the vertical potential temperature gradient satisfies $N^{2} = \\frac{g}{\\theta_{0}} \\frac{\\partial \\theta_{m}}{\\partial z}$ under hydrostatic, stably stratified conditions, with gravitational acceleration $g = 9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$. Assume horizontal gradients are small relative to vertical, so that $|\\nabla \\theta_{m}| \\approx \\left|\\frac{\\partial \\theta_{m}}{\\partial z}\\right|$ and the vertical projection dominates.\n- Mid-tropospheric thermodynamic state representative of $p = 700\\ \\mathrm{hPa}$ and $T = 270\\ \\mathrm{K}$; use the Ideal Gas Law $p = \\rho R_{d} T$ with $R_{d} = 287\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$ to determine the density $\\rho$.\n\nUnder these assumptions, treat $q$’s magnitude as $|q| \\approx \\frac{1}{\\rho}\\,|f|\\,\\left|\\frac{\\partial \\theta_{m}}{\\partial z}\\right|$. Express the final numerical magnitude in potential vorticity units, where one Potential Vorticity Unit (PVU) is $1\\ \\mathrm{PVU} = 10^{-6}\\ \\mathrm{K}\\ \\mathrm{m}^{2}\\ \\mathrm{kg}^{-1}\\ \\mathrm{s}^{-1}$. Round the numerical magnitude to three significant figures.\n\nAnswer formatting: Return your final answer as a single row matrix with two entries in this order: \n1) the base-dimension monomial for $q$ written using $M$, $L$, $T$, and $\\Theta$; \n2) the numerical magnitude in PVU. Do not include any units inside the matrix. Angles are given in degrees as stated.",
            "solution": "The problem is validated as self-contained, scientifically grounded, and well-posed. The described quantity is a variant of Ertel's potential vorticity (PV), a fundamental concept in geophysical fluid dynamics. All provided constants and physical conditions are standard and plausible. The calculation proceeds in two parts as requested.\n\n### Task 1: Determination of Physical Dimensions\n\nThe quantity $q$ is defined as the projection of the absolute vorticity vector, $\\vec{\\zeta}_a$, onto the gradient of the moist potential temperature, $\\nabla \\theta_m$, normalized by the mass density, $\\rho$. The mathematical expression is:\n$$\nq = \\frac{1}{\\rho} (\\vec{\\zeta}_a \\cdot \\nabla \\theta_m)\n$$\nTo determine the physical dimensions of $q$, we analyze the dimensions of each component using the base dimensions of mass ($M$), length ($L$), time ($T$), and thermodynamic temperature ($\\Theta$).\n\n1.  **Mass Density ($\\rho$)**: Density is mass per unit volume. Its dimensions are:\n    $$\n    [\\rho] = \\frac{M}{L^3} = M L^{-3}\n    $$\n\n2.  **Absolute Vorticity ($\\vec{\\zeta}_a$)**: Absolute vorticity is the sum of the relative vorticity ($\\nabla \\times \\vec{u}$) and the planetary vorticity ($2\\vec{\\Omega}$). Both terms have dimensions of frequency (inverse time), as velocity $\\vec{u}$ has dimensions $L T^{-1}$ and the gradient operator $\\nabla$ has dimensions $L^{-1}$, making $[\\nabla \\times \\vec{u}] = L^{-1} \\cdot L T^{-1} = T^{-1}$. The Earth's rotation rate $\\vec{\\Omega}$ also has dimensions of frequency, $T^{-1}$. Therefore, the dimensions of absolute vorticity are:\n    $$\n    [\\vec{\\zeta}_a] = T^{-1}\n    $$\n\n3.  **Moist Potential Temperature ($\\theta_m$)**: This is a thermodynamic temperature quantity. Its dimension is:\n    $$\n    [\\theta_m] = \\Theta\n    $$\n\n4.  **Gradient of Moist Potential Temperature ($\\nabla \\theta_m$)**: The gradient operator, $\\nabla$, has dimensions of inverse length, $L^{-1}$. Thus, the dimensions of the gradient of $\\theta_m$ are:\n    $$\n    [\\nabla \\theta_m] = [\\nabla] [\\theta_m] = L^{-1} \\Theta\n    $$\n\nCombining these, the dimensions of the dot product $\\vec{\\zeta}_a \\cdot \\nabla \\theta_m$ are the product of the dimensions of the two vectors:\n$$\n[\\vec{\\zeta}_a \\cdot \\nabla \\theta_m] = [\\vec{\\zeta}_a] [\\nabla \\theta_m] = (T^{-1}) (L^{-1} \\Theta) = L^{-1} T^{-1} \\Theta\n$$\n\nFinally, we find the dimensions of $q$ by dividing by the dimensions of density:\n$$\n[q] = \\frac{[\\vec{\\zeta}_a \\cdot \\nabla \\theta_m]}{[\\rho]} = \\frac{L^{-1} T^{-1} \\Theta}{M L^{-3}} = M^{-1} L^{2} T^{-1} \\Theta\n$$\nThis dimensional form corresponds to the standard units of potential vorticity, $\\mathrm{K}\\ \\mathrm{m}^{2}\\ \\mathrm{kg}^{-1}\\ \\mathrm{s}^{-1}$.\n\n### Task 2: Evaluation of a Representative Magnitude\n\nThe problem provides an approximation for the magnitude of $q$ under typical midlatitude conditions:\n$$\n|q| \\approx \\frac{1}{\\rho}\\,|f|\\,\\left|\\frac{\\partial \\theta_{m}}{\\partial z}\\right|\n$$\nWe will evaluate each term in this expression using the provided data, ensuring all units are in the SI system.\n\n1.  **Coriolis Parameter ($f$)**: The Coriolis parameter is given by $f = 2 \\Omega \\sin \\phi$.\n    Given: $\\Omega = 7.292 \\times 10^{-5}\\ \\mathrm{s}^{-1}$ and $\\phi = 45^\\circ$.\n    $$\n    f = 2 \\times (7.292 \\times 10^{-5}\\ \\mathrm{s}^{-1}) \\times \\sin(45^\\circ) = 2 \\times (7.292 \\times 10^{-5}) \\times \\frac{\\sqrt{2}}{2} = \\sqrt{2} \\times 7.292 \\times 10^{-5}\\ \\mathrm{s}^{-1} \\approx 1.03125 \\times 10^{-4}\\ \\mathrm{s}^{-1}\n    $$\n\n2.  **Vertical Gradient of Moist Potential Temperature ($\\frac{\\partial \\theta_{m}}{\\partial z}$)**: This is derived from the definition of the Brunt–Väisälä frequency, $N^2 = \\frac{g}{\\theta_{0}} \\frac{\\partial \\theta_{m}}{\\partial z}$.\n    Given: $N = 1.0 \\times 10^{-2}\\ \\mathrm{s}^{-1}$, $\\theta_0 = 300\\ \\mathrm{K}$, and $g = 9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$.\n    Rearranging for the gradient gives:\n    $$\n    \\frac{\\partial \\theta_{m}}{\\partial z} = \\frac{N^2 \\theta_0}{g} = \\frac{(1.0 \\times 10^{-2}\\ \\mathrm{s}^{-1})^2 \\times (300\\ \\mathrm{K})}{9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}} = \\frac{1.0 \\times 10^{-4}\\ \\mathrm{s}^{-2} \\times 300\\ \\mathrm{K}}{9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}} = \\frac{0.03}{9.81}\\ \\mathrm{K}\\ \\mathrm{m}^{-1} \\approx 0.0030581\\ \\mathrm{K}\\ \\mathrm{m}^{-1}\n    $$\n\n3.  **Mass Density ($\\rho$)**: Density is determined from the Ideal Gas Law, $p = \\rho R_{d} T$.\n    Given: $p = 700\\ \\mathrm{hPa} = 700 \\times 100\\ \\mathrm{Pa} = 7 \\times 10^{4}\\ \\mathrm{Pa}$, $T = 270\\ \\mathrm{K}$, and $R_d = 287\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$. Note that $1\\ \\mathrm{J} = 1\\ \\mathrm{N}\\ \\mathrm{m}$ and $1\\ \\mathrm{Pa} = 1\\ \\mathrm{N}\\ \\mathrm{m}^{-2}$, so the units are consistent.\n    Rearranging for density gives:\n    $$\n    \\rho = \\frac{p}{R_d T} = \\frac{7 \\times 10^4\\ \\mathrm{Pa}}{(287\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}) \\times (270\\ \\mathrm{K})} = \\frac{70000}{77490}\\ \\mathrm{kg}\\ \\mathrm{m}^{-3} \\approx 0.90334\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\n    $$\n\nNow, we substitute these values into the expression for $|q|$:\n$$\n|q| \\approx \\frac{1}{0.90334\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}} \\times (1.03125 \\times 10^{-4}\\ \\mathrm{s}^{-1}) \\times (0.0030581\\ \\mathrm{K}\\ \\mathrm{m}^{-1})\n$$\n$$\n|q| \\approx (1.10699\\ \\mathrm{m}^3\\ \\mathrm{kg}^{-1}) \\times (1.03125 \\times 10^{-4}\\ \\mathrm{s}^{-1}) \\times (0.0030581\\ \\mathrm{K}\\ \\mathrm{m}^{-1})\n$$\n$$\n|q| \\approx 3.4926 \\times 10^{-7}\\ \\mathrm{K}\\ \\mathrm{m}^{2}\\ \\mathrm{kg}^{-1}\\ \\mathrm{s}^{-1}\n$$\n\nFinally, we convert this magnitude to Potential Vorticity Units (PVU), where $1\\ \\mathrm{PVU} = 10^{-6}\\ \\mathrm{K}\\ \\mathrm{m}^{2}\\ \\mathrm{kg}^{-1}\\ \\mathrm{s}^{-1}$.\n$$\n|q|_{\\mathrm{PVU}} = \\frac{3.4926 \\times 10^{-7}}{10^{-6}} = 0.34926\n$$\nRounding to three significant figures, the magnitude is $0.349$ PVU.\n\nThe final answer requires a matrix containing the dimensional formula from Task 1 and the numerical result from Task 2.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nM^{-1} L^{2} T^{-1} \\Theta  0.349\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While Moist Potential Vorticity is conserved under adiabatic, frictionless conditions, its true power in diagnostics comes from understanding how and where it is generated or destroyed. This exercise  guides you through a first-principles derivation of the MPV tendency equation to identify its physical sources: diabatic heating and friction. By performing a scaling analysis with realistic atmospheric parameters, you will quantify and compare the roles these processes play in shaping weather systems, a crucial skill for both forecasting and climate analysis.",
            "id": "4066835",
            "problem": "Consider a moist baroclinic zone in midlatitudes within the framework of Numerical Weather Prediction (NWP) and climate modeling. Let the moist Ertel potential vorticity be defined using equivalent potential temperature as $q_{m} = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta_{e}$, where $\\rho$ is air density, $\\boldsymbol{\\omega}_{a}$ is absolute vorticity, and $\\theta_{e}$ is equivalent potential temperature. Starting from the rotating, compressible Navier–Stokes momentum equation with a nonconservative specific force $\\boldsymbol{F}$, the mass continuity equation, and the thermodynamic energy equation for $\\theta_{e}$, derive from first principles the form of the material tendency of $q_{m}$, clearly identifying the separate contributions associated with diabatic heating and friction. Then, under the scientifically consistent scaling assumptions below, quantify the relative magnitude of the diabatic versus frictional $q_{m}$ tendencies, defined as the ratio\n$$\nR \\equiv \\frac{\\text{magnitude of diabatic } \\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t}}{\\text{magnitude of frictional } \\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t}}.\n$$\nAssume:\n- The air density is $\\rho = 1.0~\\mathrm{kg\\,m^{-3}}$ and the absolute vorticity vector $\\boldsymbol{\\omega}_{a}$ is dominated by its vertical component with magnitude $|\\boldsymbol{\\omega}_{a}| = f + \\zeta$, where the Coriolis parameter is $f = 1.0\\times 10^{-4}~\\mathrm{s^{-1}}$ and the vertical component of relative vorticity is $\\zeta = 0.5\\times 10^{-4}~\\mathrm{s^{-1}}$.\n- The vertical gradient of equivalent potential temperature is $|\\partial \\theta_{e}/\\partial z| = 4.0~\\mathrm{K\\,km^{-1}}$ and this vertical gradient dominates $|\\nabla\\theta_{e}|$.\n- The diabatic heating rate profile satisfies $|\\partial \\dot{\\theta}_{e}/\\partial z| \\approx \\Delta\\dot{\\theta}_{e}/H$, where the heating decreases from $\\Delta\\dot{\\theta}_{e} = 3.0~\\mathrm{K\\,hour^{-1}}$ at the bottom of the heating layer to approximately zero at the top over a depth $H = 2.0~\\mathrm{km}$.\n- The frictional specific force magnitude near the surface is $|\\boldsymbol{F}| \\approx \\tau/(\\rho h)$, with surface stress $\\tau = 0.3~\\mathrm{N\\,m^{-2}}$ and boundary-layer depth $h = 1.0~\\mathrm{km}$. Its spatial curl is estimated by $|\\nabla\\times\\boldsymbol{F}| \\approx |\\boldsymbol{F}|/L$ over a horizontal scale $L = 300~\\mathrm{km}$.\n- Geometric alignment is such that the relevant dot products are maximized by projection onto the dominant vertical components (i.e., take the cosines of the angles between the paired vectors to be unity for the magnitude estimates).\n\nExpress the final ratio $R$ as a pure number. Round your answer to three significant figures. No units are required for the ratio.",
            "solution": "The problem requires a two-part solution: first, the derivation of the material tendency of moist Ertel potential vorticity, $q_m$, and second, the quantification of the ratio of diabatic to frictional tendencies based on provided scaling assumptions.\n\nFirst, we derive the governing equation for the material tendency of moist potential vorticity, $q_m$. The moist Ertel potential vorticity is defined as:\n$$\nq_{m} = \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta_{e}\n$$\nwhere $\\rho$ is the air density, $\\boldsymbol{\\omega}_{a}$ is the three-dimensional absolute vorticity vector, and $\\theta_{e}$ is the equivalent potential temperature.\n\nTo find the material tendency, we take the material derivative, $\\frac{\\mathrm{D}}{\\mathrm{D}t} \\equiv \\frac{\\partial}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla$, of $q_m$:\n$$\n\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t} = \\frac{\\mathrm{D}}{\\mathrm{D}t} \\left( \\frac{1}{\\rho}\\,\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta_{e} \\right)\n$$\nUsing the product rule, we expand this expression into three terms:\n$$\n\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t} = \\frac{\\mathrm{D}(1/\\rho)}{\\mathrm{D}t} (\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta_{e}) + \\frac{1}{\\rho}\\frac{\\mathrm{D}\\boldsymbol{\\omega}_{a}}{\\mathrm{D}t}\\cdot\\nabla\\theta_{e} + \\frac{1}{\\rho}\\boldsymbol{\\omega}_{a}\\cdot\\frac{\\mathrm{D}(\\nabla\\theta_{e})}{\\mathrm{D}t}\n$$\nWe evaluate each of these terms.\n\nTerm 1: From the mass continuity equation, $\\frac{\\mathrm{D}\\rho}{\\mathrm{D}t} + \\rho(\\nabla \\cdot \\boldsymbol{u}) = 0$, we can write $\\frac{\\mathrm{D}(1/\\rho)}{\\mathrm{D}t} = -\\frac{1}{\\rho^2}\\frac{\\mathrm{D}\\rho}{\\mathrm{D}t} = -\\frac{1}{\\rho^2}(-\\rho(\\nabla \\cdot \\boldsymbol{u})) = \\frac{1}{\\rho}(\\nabla \\cdot \\boldsymbol{u})$.\n\nTerm 2: The evolution of absolute vorticity, $\\boldsymbol{\\omega}_{a} = \\nabla\\times\\boldsymbol{u} + 2\\boldsymbol{\\Omega}$, is described by the vorticity equation, which is derived by taking the curl of the Navier-Stokes momentum equation, $\\frac{\\mathrm{D}\\boldsymbol{u}}{\\mathrm{D}t} + 2\\boldsymbol{\\Omega}\\times\\boldsymbol{u} = -\\frac{1}{\\rho}\\nabla p - \\nabla\\Phi + \\boldsymbol{F}$. The resulting vorticity equation is:\n$$\n\\frac{\\mathrm{D}\\boldsymbol{\\omega}_{a}}{\\mathrm{D}t} = (\\boldsymbol{\\omega}_{a}\\cdot\\nabla)\\boldsymbol{u} - \\boldsymbol{\\omega}_{a}(\\nabla\\cdot\\boldsymbol{u}) + \\frac{1}{\\rho^2}(\\nabla\\rho \\times \\nabla p) + \\nabla\\times\\boldsymbol{F}\n$$\nHere, $(\\boldsymbol{\\omega}_{a}\\cdot\\nabla)\\boldsymbol{u}$ is the stretching/tilting term, $-\\boldsymbol{\\omega}_{a}(\\nabla\\cdot\\boldsymbol{u})$ is the divergence term, $\\frac{1}{\\rho^2}(\\nabla\\rho \\times \\nabla p)$ is the solenoidal (baroclinic) term, and $\\nabla\\times\\boldsymbol{F}$ is the frictional term.\n\nTerm 3: The material derivative of a gradient of a scalar $\\theta_e$ is given by the identity $\\frac{\\mathrm{D}(\\nabla \\theta_e)}{\\mathrm{D}t} = \\nabla\\left(\\frac{\\mathrm{D}\\theta_{e}}{\\mathrm{D}t}\\right) - (\\nabla\\boldsymbol{u})^T \\cdot \\nabla\\theta_{e}$. Let $\\dot{\\theta}_{e} = \\frac{\\mathrm{D}\\theta_{e}}{\\mathrm{D}t}$ be the diabatic source term for $\\theta_e$. Then:\n$$\n\\frac{\\mathrm{D}(\\nabla\\theta_{e})}{\\mathrm{D}t} = \\nabla\\dot{\\theta}_{e} - (\\nabla\\boldsymbol{u})^T \\cdot \\nabla\\theta_{e}\n$$\n\nSubstituting these expressions back into the equation for $\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t}$:\n$$\n\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t} = \\frac{1}{\\rho}(\\nabla \\cdot \\boldsymbol{u}) (\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta_{e}) + \\frac{1}{\\rho}\\left[ (\\boldsymbol{\\omega}_{a}\\cdot\\nabla)\\boldsymbol{u} - \\boldsymbol{\\omega}_{a}(\\nabla\\cdot\\boldsymbol{u}) + \\frac{\\nabla\\rho \\times \\nabla p}{\\rho^2} + \\nabla\\times\\boldsymbol{F} \\right]\\cdot\\nabla\\theta_{e} + \\frac{1}{\\rho}\\boldsymbol{\\omega}_{a}\\cdot\\left[\\nabla\\dot{\\theta}_{e} - (\\nabla\\boldsymbol{u})^T \\cdot \\nabla\\theta_{e} \\right]\n$$\nSeveral terms cancel. The divergence terms cancel: $\\frac{1}{\\rho}(\\nabla \\cdot \\boldsymbol{u}) (\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\theta_{e}) - \\frac{1}{\\rho}(\\boldsymbol{\\omega}_{a}(\\nabla\\cdot\\boldsymbol{u}))\\cdot\\nabla\\theta_{e} = 0$. The terms involving the velocity gradient tensor $\\nabla\\boldsymbol{u}$ also cancel: $\\frac{1}{\\rho}((\\boldsymbol{\\omega}_{a}\\cdot\\nabla)\\boldsymbol{u})\\cdot\\nabla\\theta_{e} - \\frac{1}{\\rho}\\boldsymbol{\\omega}_{a}\\cdot((\\nabla\\boldsymbol{u})^T \\cdot \\nabla\\theta_{e}) = 0$. The solenoidal term, $\\frac{1}{\\rho^3}(\\nabla\\rho \\times \\nabla p) \\cdot\\nabla\\theta_{e}$, vanishes if pressure is a function of density and $\\theta_e$ only, i.e., $p=p(\\rho, \\theta_e)$, which is a standard assumption. This leaves the terms related to diabatic heating ($\\dot{\\theta}_{e}$) and friction ($\\boldsymbol{F}$).\n\nThe final form of the moist potential vorticity tendency equation is:\n$$\n\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t} = \\frac{1}{\\rho}\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\dot{\\theta}_{e} + \\frac{1}{\\rho}(\\nabla\\times\\boldsymbol{F})\\cdot\\nabla\\theta_{e}\n$$\nThe first term on the right-hand side, $(\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t})_{\\text{dia}} = \\frac{1}{\\rho}\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\dot{\\theta}_{e}$, represents the generation of $q_m$ by diabatic processes. The second term, $(\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t})_{\\text{fric}} = \\frac{1}{\\rho}(\\nabla\\times\\boldsymbol{F})\\cdot\\nabla\\theta_{e}$, represents the generation/dissipation of $q_m$ by friction.\n\nNext, we quantify the ratio $R$ of the magnitudes of these two terms:\n$$\nR = \\frac{\\left| \\left(\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t}\\right)_{\\text{dia}} \\right|}{\\left| \\left(\\frac{\\mathrm{D}q_{m}}{\\mathrm{D}t}\\right)_{\\text{fric}} \\right|} = \\frac{\\left| \\frac{1}{\\rho}\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\dot{\\theta}_{e} \\right|}{\\left| \\frac{1}{\\rho}(\\nabla\\times\\boldsymbol{F})\\cdot\\nabla\\theta_{e} \\right|} = \\frac{|\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\dot{\\theta}_{e}|}{|(\\nabla\\times\\boldsymbol{F})\\cdot\\nabla\\theta_{e}|}\n$$\nWe use the provided scaling assumptions to estimate the magnitudes of the numerator and denominator. The problem states that the dot products are maximized by alignment of the dominant vertical components, so we can approximate the dot products by the product of the magnitudes of the vectors.\n\nNumerator: $|\\boldsymbol{\\omega}_{a}\\cdot\\nabla\\dot{\\theta}_{e}| \\approx |\\boldsymbol{\\omega}_{a}||\\nabla\\dot{\\theta}_{e}|$\n-   Absolute vorticity magnitude: $|\\boldsymbol{\\omega}_{a}| = f + \\zeta = 1.0\\times 10^{-4}~\\mathrm{s^{-1}} + 0.5\\times 10^{-4}~\\mathrm{s^{-1}} = 1.5\\times 10^{-4}~\\mathrm{s^{-1}}$.\n-   Gradient of diabatic heating: $|\\nabla\\dot{\\theta}_{e}| \\approx |\\partial \\dot{\\theta}_{e}/\\partial z| \\approx \\Delta\\dot{\\theta}_{e}/H$.\n-   First, convert units to SI:\n    -   $\\Delta\\dot{\\theta}_{e} = 3.0~\\mathrm{K\\,hour^{-1}} = \\frac{3.0~\\mathrm{K}}{3600~\\mathrm{s}} = \\frac{1}{1200}~\\mathrm{K\\,s^{-1}}$.\n    -   $H = 2.0~\\mathrm{km} = 2000~\\mathrm{m}$.\n-   So, $|\\nabla\\dot{\\theta}_{e}| \\approx \\frac{1/1200~\\mathrm{K\\,s^{-1}}}{2000~\\mathrm{m}} = \\frac{1}{2.4 \\times 10^6}~\\mathrm{K\\,m^{-1}\\,s^{-1}}$.\n-   Numerator magnitude $\\approx (1.5\\times 10^{-4}~\\mathrm{s^{-1}}) \\times (\\frac{1}{2.4 \\times 10^6}~\\mathrm{K\\,m^{-1}\\,s^{-1}}) = \\frac{1.5}{2.4} \\times 10^{-10}~\\mathrm{K\\,m^{-1}\\,s^{-2}} = 6.25 \\times 10^{-11}~\\mathrm{K\\,m^{-1}\\,s^{-2}}$.\n\nDenominator: $|(\\nabla\\times\\boldsymbol{F})\\cdot\\nabla\\theta_{e}| \\approx |\\nabla\\times\\boldsymbol{F}||\\nabla\\theta_{e}|$\n-   Gradient of equivalent potential temperature: $|\\nabla\\theta_{e}| \\approx |\\partial\\theta_{e}/\\partial z|$.\n    -   $|\\partial\\theta_{e}/\\partial z| = 4.0~\\mathrm{K\\,km^{-1}} = \\frac{4.0~\\mathrm{K}}{1000~\\mathrm{m}} = 4.0 \\times 10^{-3}~\\mathrm{K\\,m^{-1}}$.\n-   Curl of frictional force: $|\\nabla\\times\\boldsymbol{F}| \\approx |\\boldsymbol{F}|/L$.\n    -   Frictional force magnitude: $|\\boldsymbol{F}| \\approx \\tau/(\\rho h)$.\n    -   Convert units to SI:\n        -   $\\tau = 0.3~\\mathrm{N\\,m^{-2}} = 0.3~\\mathrm{kg\\,m^{-1}\\,s^{-2}}$.\n        -   $\\rho = 1.0~\\mathrm{kg\\,m^{-3}}$.\n        -   $h = 1.0~\\mathrm{km} = 1000~\\mathrm{m}$.\n    -   $|\\boldsymbol{F}| \\approx \\frac{0.3~\\mathrm{kg\\,m^{-1}\\,s^{-2}}}{(1.0~\\mathrm{kg\\,m^{-3}})(1000~\\mathrm{m})} = 3.0 \\times 10^{-4}~\\mathrm{m\\,s^{-2}}$.\n    -   Now, we calculate the curl magnitude:\n        -   $L = 300~\\mathrm{km} = 3.0 \\times 10^5~\\mathrm{m}$.\n        -   $|\\nabla\\times\\boldsymbol{F}| \\approx \\frac{3.0 \\times 10^{-4}~\\mathrm{m\\,s^{-2}}}{3.0 \\times 10^5~\\mathrm{m}} = 1.0 \\times 10^{-9}~\\mathrm{s^{-2}}$.\n-   Denominator magnitude $\\approx (1.0 \\times 10^{-9}~\\mathrm{s^{-2}}) \\times (4.0 \\times 10^{-3}~\\mathrm{K\\,m^{-1}}) = 4.0 \\times 10^{-12}~\\mathrm{K\\,m^{-1}\\,s^{-2}}$.\n\nFinally, we compute the ratio $R$:\n$$\nR = \\frac{6.25 \\times 10^{-11}~\\mathrm{K\\,m^{-1}\\,s^{-2}}}{4.0 \\times 10^{-12}~\\mathrm{K\\,m^{-1}\\,s^{-2}}} = \\frac{6.25}{0.40} = 15.625\n$$\nThe problem asks to round the answer to three significant figures.\n$$\nR \\approx 15.6\n$$\nThis result indicates that, for the given typical mid-latitude storm parameters, diabatic heating is over an order of magnitude more significant than boundary layer friction in generating moist potential vorticity anomalies.",
            "answer": "$$\n\\boxed{15.6}\n$$"
        },
        {
            "introduction": "Perhaps the most powerful aspect of potential vorticity is the \"invertibility principle,\" which states that the entire balanced wind and mass field can be deduced from the PV distribution alone. This capstone practice  demonstrates this principle by having you invert a localized moist potential vorticity anomaly to recover its associated balanced flow. By implementing a spectral inversion algorithm, you will transform a simple anomaly into a full-fledged vortex, gaining hands-on experience with a core diagnostic technique in modern meteorology.",
            "id": "4066831",
            "problem": "Consider a two-dimensional, horizontally periodic domain representing a midlatitude tropospheric layer with effective moist stratification. You are given a localized anomaly of moist potential vorticity, denoted $q_m'$, and asked to invert it to obtain balanced horizontal wind and mass fields under the assumptions of hydrostatic balance and small Rossby number. The inversion must be framed on an $f$-plane with constant Coriolis parameter and carried out in a single vertical mode representation that captures moist static stability via an effective moist deformation radius.\n\nStart from first principles appropriate for Numerical Weather Prediction (NWP) and climate modeling: the hydrostatic primitive equations, the small Rossby number geostrophic balance, mass continuity, the definition of Ertel moist potential vorticity, and a single-mode vertical reduction justified by moist static stability. From this base, deduce the elliptic inversion required to map a given $q_m'$ to a balanced streamfunction field $\\psi$ consistent with hydrostatic and geostrophic constraints, and use it to compute the geostrophic wind and the hydrostatic mass (height) field.\n\nDefinitions and assumptions to use:\n- Hydrostatic balance: $\\partial p/\\partial z = -\\rho g$, where $p$ is pressure, $\\rho$ is density, and $g$ is gravitational acceleration.\n- Small Rossby number geostrophic balance: $f_0 \\boldsymbol{k} \\times \\boldsymbol{v}_g = -\\frac{1}{\\rho_0} \\nabla_h p$, where $f_0$ is the constant Coriolis parameter, $\\boldsymbol{v}_g$ is the geostrophic wind, and $\\rho_0$ is a constant reference density, with horizontal gradient operator $\\nabla_h$.\n- Moist potential vorticity definition (Ertel form): $q_m = \\frac{\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta_e}{\\rho}$, where $\\boldsymbol{\\omega}_a$ is absolute vorticity, $\\theta_e$ is Equivalent Potential Temperature (EPT), and $\\rho$ is density.\n- One vertical mode reduction with moist static stability encapsulated by an effective moist deformation radius $L_{dm}$.\n- Quasi-geostrophic scaling and linearization appropriate for small Rossby number, mapping the moist potential vorticity anomaly $q_m'$ to a streamfunction field $\\psi$ through an elliptic operator determined by the hydrostatic and geostrophic constraints and the moist deformation radius.\n\nDomain, constants, and discretization:\n- Horizontally periodic square domain with side lengths $L_x = 2.0 \\times 10^6$ meters and $L_y = 2.0 \\times 10^6$ meters.\n- Grid resolution $N_x = 256$, $N_y = 256$, evenly spaced.\n- Coriolis parameter $f_0 = 1.0 \\times 10^{-4}$ s$^{-1}$ (constant).\n- Gravitational acceleration $g = 9.81$ m s$^{-2}$ (constant).\n\nA localized moist potential vorticity anomaly is prescribed as a Gaussian:\n$q_m'(x,y) = A \\exp\\left(-\\frac{(x-x_0)^2 + (y-y_0)^2}{2 \\sigma^2}\\right)$,\nwhere $A$ is the amplitude in s$^{-1}$, $(x_0,y_0)$ is the center in meters, and $\\sigma$ is the horizontal scale in meters. You must assume horizontally periodic boundary conditions.\n\nYour tasks:\n1. Using the hydrostatic primitive equations, small Rossby number geostrophic balance, the definition of moist potential vorticity, and a single vertical mode reduction, derive the balanced inversion operator that maps $q_m'$ to the streamfunction $\\psi$ for a moist environment characterized by $L_{dm}$.\n2. Implement an inversion algorithm suitable for a periodic domain using a spectral method based on the Fast Fourier Transform (FFT) to solve the resulting elliptic problem for $\\psi$.\n3. Compute the geostrophic wind components $(u_g, v_g)$ from $\\psi$ and the hydrostatic mass (height) anomaly $\\eta$ from $\\psi$ under hydrostatic balance.\n4. For each test case below, compute the maximum horizontal wind speed $U_{\\max} = \\max \\sqrt{u_g^2 + v_g^2}$ in meters per second and the maximum absolute height anomaly $\\eta_{\\max} = \\max |\\eta|$ in meters. Express $U_{\\max}$ in m/s and $\\eta_{\\max}$ in m. Report each test case’s results as a pair $(U_{\\max}, \\eta_{\\max})$.\n\nTest suite (four cases spanning general, narrow anomaly, weak stability, and near-boundary localization):\n- Case 1 (general, moist midlatitude): $L_{dm} = 8.0 \\times 10^5$ m, $A = 2.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 1.5 \\times 10^5$ m, $(x_0,y_0) = (L_x/2, L_y/2)$.\n- Case 2 (narrow anomaly, stronger amplitude): $L_{dm} = 6.0 \\times 10^5$ m, $A = 5.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 5.0 \\times 10^4$ m, $(x_0,y_0) = (0.6 L_x, 0.7 L_y)$.\n- Case 3 (weaker static stability, larger moist deformation radius): $L_{dm} = 1.5 \\times 10^6$ m, $A = 2.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 2.0 \\times 10^5$ m, $(x_0,y_0) = (0.5 L_x, 0.2 L_y)$.\n- Case 4 (near-boundary localization to test periodic wrap-around): $L_{dm} = 5.0 \\times 10^5$ m, $A = 3.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 1.2 \\times 10^5$ m, $(x_0,y_0) = (0.95 L_x, 0.95 L_y)$.\n\nFinal output format:\nYour program should produce a single line of output containing the eight computed floats in the order $[U_{\\max}^{(1)}, \\eta_{\\max}^{(1)}, U_{\\max}^{(2)}, \\eta_{\\max}^{(2)}, U_{\\max}^{(3)}, \\eta_{\\max}^{(3)}, U_{\\max}^{(4)}, \\eta_{\\max}^{(4)}]$, where superscripts denote the test case number. Output each float as a decimal number with units implied by the definitions above. No additional text should be printed. Angles are not involved in this problem. No percentages are used. The program must be self-contained and rely only on the given parameters.",
            "solution": "The user wants a solution to a moist potential vorticity inversion problem.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n\n- **Physical System:** A two-dimensional, horizontally periodic domain representing a midlatitude tropospheric layer.\n- **Governing Assumptions:** Hydrostatic balance, small Rossby number, $f$-plane approximation.\n- **Key Fields:** Moist potential vorticity anomaly ($q_m'$), horizontal wind ($\\boldsymbol{v}_g=(u_g, v_g)$), streamfunction ($\\psi$), mass/height anomaly ($\\eta$).\n- **Core Equations (Principles):**\n    - Hydrostatic balance: $\\partial p/\\partial z = -\\rho g$.\n    - Small Rossby number geostrophic balance: $f_0 \\boldsymbol{k} \\times \\boldsymbol{v}_g = -\\frac{1}{\\rho_0} \\nabla_h p$.\n    - Ertel moist potential vorticity: $q_m = \\frac{\\boldsymbol{\\omega}_a \\cdot \\nabla \\theta_e}{\\rho}$.\n    - Single vertical mode reduction with effective moist deformation radius $L_{dm}$.\n- **Domain and Discretization:**\n    - Side lengths: $L_x = 2.0 \\times 10^6$ m, $L_y = 2.0 \\times 10^6$ m.\n    - Grid resolution: $N_x = 256$, $N_y = 256$.\n    - Boundary conditions: Horizontally periodic.\n- **Physical Constants:**\n    - Coriolis parameter: $f_0 = 1.0 \\times 10^{-4}$ s$^{-1}$.\n    - Gravitational acceleration: $g = 9.81$ m s$^{-2}$.\n- **Input Anomaly:**\n    - Functional form: $q_m'(x,y) = A \\exp\\left(-\\frac{(x-x_0)^2 + (y-y_0)^2}{2 \\sigma^2}\\right)$.\n- **Tasks:**\n    1. Derive the balanced inversion operator linking $q_m'$ to $\\psi$.\n    2. Implement a spectral inversion algorithm using FFT.\n    3. Compute geostrophic wind components $(u_g, v_g)$ and height anomaly $\\eta$.\n    4. For four test cases, calculate and report the maximum horizontal wind speed $U_{\\max}$ and maximum absolute height anomaly $\\eta_{\\max}$.\n- **Test Cases:**\n    - Case 1: $L_{dm} = 8.0 \\times 10^5$ m, $A = 2.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 1.5 \\times 10^5$ m, $(x_0,y_0) = (L_x/2, L_y/2)$.\n    - Case 2: $L_{dm} = 6.0 \\times 10^5$ m, $A = 5.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 5.0 \\times 10^4$ m, $(x_0,y_0) = (0.6 L_x, 0.7 L_y)$.\n    - Case 3: $L_{dm} = 1.5 \\times 10^6$ m, $A = 2.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 2.0 \\times 10^5$ m, $(x_0,y_0) = (0.5 L_x, 0.2 L_y)$.\n    - Case 4: $L_{dm} = 5.0 \\times 10^5$ m, $A = 3.0 \\times 10^{-6}$ s$^{-1}$, $\\sigma = 1.2 \\times 10^5$ m, $(x_0,y_0) = (0.95 L_x, 0.95 L_y)$.\n\n**Step 2: Validate Using Extracted Givens**\n\n- **Scientifically Grounded:** The problem is firmly rooted in the principles of geophysical fluid dynamics, specifically quasi-geostrophic theory and potential vorticity dynamics. The concepts of PV inversion, moist deformation radius, and spectral methods are standard tools in atmospheric science and numerical modeling. All physical assumptions and equations are standard and correct.\n- **Well-Posed:** The task is to solve a linear elliptic partial differential equation (a Helmholtz equation) on a periodic domain with a well-behaved source term (a Gaussian). This is a classic well-posed problem that admits a unique and stable solution. The use of Fourier transforms is the standard and most robust method for this setup.\n- **Objective:** The problem is defined with precise mathematical formulations, numerical parameters, and unambiguous objectives. It is free of any subjective or opinion-based content.\n- The setup is **complete and consistent**, with all necessary information provided. The parameters are **physically realistic** for mid-latitude atmospheric systems. The problem structure is logical and leads to a meaningful, verifiable numerical solution. It is a non-trivial but standard exercise in dynamic meteorology.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. A full solution will be provided.\n\n---\n**Solution**\n\n**1. Derivation of the Moist Potential Vorticity Inversion Operator**\n\nThe objective is to derive a relationship between the moist potential vorticity anomaly, $q_m'$, and a streamfunction, $\\psi$, under the specified approximations.\n\nWe begin with the quasi-geostrophic (QG) form of the Ertel moist potential vorticity, linearized about a state of rest with a mean vertical profile of equivalent potential temperature, $\\bar{\\theta}_e(z)$. The QG potential vorticity anomaly $q_m'$ is given by:\n$$\nq_m' = \\nabla_h^2 \\psi + \\frac{\\partial}{\\partial z}\\left(\\frac{f_0^2}{N_m^2(z)} \\frac{\\partial \\psi}{\\partial z}\\right)\n$$\nwhere $\\psi(x,y,z)$ is the three-dimensional geostrophic streamfunction, $\\nabla_h^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ is the horizontal Laplacian operator, $f_0$ is the constant Coriolis parameter, and $N_m^2(z) = \\frac{g}{\\theta_{e0}} \\frac{d\\bar{\\theta}_e}{dz}$ is the moist Brunt-Väisälä frequency squared, which parameterizes the static stability of the background state.\n\nThe problem specifies a reduction to a single vertical mode. This is achieved by assuming a separation of variables for the streamfunction:\n$$\n\\psi(x,y,z) = \\psi(x,y) F(z)\n$$\nHere, $\\psi(x,y)$ represents the horizontal structure of the streamfunction (which we aim to solve for), and $F(z)$ is the vertical structure function corresponding to a single dominant vertical mode. The vertical structure function $F(z)$ is an eigenfunction of the vertical operator in the PV equation:\n$$\n\\frac{d}{dz}\\left(\\frac{f_0^2}{N_m^2(z)} \\frac{dF}{dz}\\right) = \\frac{1}{L_{dm}^2} F(z)\n$$\nwhere $L_{dm}$ is the effective moist Rossby deformation radius for that mode, a parameter given in the problem. The sign of the eigenvalue $1/L_{dm}^2$ is chosen consistent with the standard form of the Helmholtz equation that results.\n\nSubstituting the separated form back into the PV equation, and assuming the anomaly $q_m'$ projects onto this same vertical mode, we obtain a two-dimensional equation for the horizontal structure $\\psi(x,y)$:\n$$\n\\nabla_h^2 \\psi(x,y) - \\frac{1}{L_{dm}^2} \\psi(x,y) = q_m'(x,y)\n$$\nThis is a linear, second-order elliptic partial differential equation of the Helmholtz type. This equation represents the balanced inversion operator that maps a given moist PV anomaly $q_m'$ to the corresponding balanced streamfunction $\\psi$.\n\n**2. Spectral Solution on a Periodic Domain**\n\nThe domain is horizontally periodic, which makes spectral methods based on the Fourier series highly efficient and accurate. We represent the fields $\\psi(x,y)$ and $q_m'(x,y)$ by their discrete Fourier transforms:\n$$\n\\psi(x,y) = \\sum_{k_x, k_y} \\hat{\\psi}(k_x, k_y) e^{i(k_x x + k_y y)}\n$$\n$$\nq_m'(x,y) = \\sum_{k_x, k_y} \\hat{q}_m'(k_x, k_y) e^{i(k_x x + k_y y)}\n$$\nwhere $\\hat{\\psi}$ and $\\hat{q}_m'$ are the complex Fourier coefficients, and $k_x$ and $k_y$ are the zonal and meridional wavenumbers, respectively. The wavenumbers are given by $k_x = 2\\pi m/L_x$ and $k_y = 2\\pi n/L_y$ for integers $m \\in [-N_x/2, N_x/2-1]$ and $n \\in [-N_y/2, N_y/2-1]$.\n\nIn Fourier space, differential operators become algebraic multiplications. The Laplacian operator $\\nabla_h^2$ transforms as:\n$$\n\\mathcal{F}(\\nabla_h^2 \\psi) = ((ik_x)^2 + (ik_y)^2)\\hat{\\psi} = -(k_x^2 + k_y^2)\\hat{\\psi} = -K^2\\hat{\\psi}\n$$\nwhere $K^2 = k_x^2 + k_y^2$. Applying the Fourier transform to the entire Helmholtz equation yields:\n$$\n-(k_x^2 + k_y^2)\\hat{\\psi}(k_x, k_y) - \\frac{1}{L_{dm}^2} \\hat{\\psi}(k_x, k_y) = \\hat{q}_m'(k_x, k_y)\n$$\nThis is an algebraic equation for $\\hat{\\psi}$ for each wavenumber pair $(k_x, k_y)$. Solving for $\\hat{\\psi}$:\n$$\n\\hat{\\psi}(k_x, k_y) = \\frac{\\hat{q}_m'(k_x, k_y)}{-(k_x^2 + k_y^2) - \\frac{1}{L_{dm}^2}}\n$$\nThe inversion algorithm is as follows:\n$1$.  Compute the $q_m'(x,y)$ field on the numerical grid.\n$2$.  Apply a $2$D Fast Fourier Transform (FFT) to $q_m'(x,y)$ to obtain its spectral coefficients $\\hat{q}_m'(k_x, k_y)$.\n$3$.  For each wavenumber pair, divide $\\hat{q}_m'$ by the spectral representation of the Helmholtz operator, $-(K^2 + L_{dm}^{-2})$, to find $\\hat{\\psi}(k_x, k_y)$. The denominator is always non-zero, so the problem is well-defined for all wavenumbers.\n$4$.  Apply a $2$D inverse FFT to $\\hat{\\psi}(k_x, k_y)$ to recover the streamfunction field $\\psi(x,y)$ in physical space.\n\n**3. Computation of Wind and Height Fields**\n\nOnce the streamfunction $\\psi$ is found, the geostrophic wind components $(u_g, v_g)$ and the hydrostatic height anomaly $\\eta$ can be computed.\n\nThe geostrophic wind is related to the streamfunction by:\n$$\nu_g = -\\frac{\\partial \\psi}{\\partial y} \\quad , \\quad v_g = \\frac{\\partial \\psi}{\\partial x}\n$$\nThese derivatives are most accurately computed in spectral space:\n$$\n\\hat{u}_g(k_x, k_y) = -i k_y \\hat{\\psi}(k_x, k_y)\n$$\n$$\n\\hat{v}_g(k_x, k_y) = +i k_x \\hat{\\psi}(k_x, k_y)\n$$\nInverse FFTs on $\\hat{u}_g$ and $\\hat{v}_g$ yield the physical-space wind fields $u_g(x,y)$ and $v_g(x,y)$. The maximum horizontal wind speed is then $U_{\\max} = \\max\\sqrt{u_g^2 + v_g^2}$ over the entire domain.\n\nThe height anomaly $\\eta$ is hydrostatically related to the pressure anomaly $p'$, which in QG theory is related to the streamfunction by $p' = \\rho_0 f_0 \\psi$. The height anomaly is given by $\\eta = p'/(\\rho_0 g)$. Therefore:\n$$\n\\eta(x,y) = \\frac{f_0}{g} \\psi(x,y)\n$$\nThe maximum absolute height anomaly is $\\eta_{\\max} = \\max|\\eta|$ over the domain.\n\nThe implementation will now follow these derived steps.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the moist potential vorticity inversion problem for a series of test cases.\n    \"\"\"\n\n    # --- Global Parameters ---\n    Lx = 2.0e6  # Domain length in x-direction [m]\n    Ly = 2.0e6  # Domain length in y-direction [m]\n    Nx = 256    # Number of grid points in x\n    Ny = 256    # Number of grid points in y\n    f0 = 1.0e-4 # Coriolis parameter [s^-1]\n    g = 9.81    # Gravitational acceleration [m s^-2]\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case 1: General, moist midlatitude\n        {'Ldm': 8.0e5, 'A': 2.0e-6, 'sigma': 1.5e5, 'x0_frac': 0.5, 'y0_frac': 0.5},\n        # Case 2: Narrow anomaly, stronger amplitude\n        {'Ldm': 6.0e5, 'A': 5.0e-6, 'sigma': 5.0e4, 'x0_frac': 0.6, 'y0_frac': 0.7},\n        # Case 3: Weaker static stability\n        {'Ldm': 1.5e6, 'A': 2.0e-6, 'sigma': 2.0e5, 'x0_frac': 0.5, 'y0_frac': 0.2},\n        # Case 4: Near-boundary localization\n        {'Ldm': 5.0e5, 'A': 3.0e-6, 'sigma': 1.2e5, 'x0_frac': 0.95, 'y0_frac': 0.95}\n    ]\n\n    results = []\n    \n    # --- Grid and Wavenumber Setup ---\n    # Physical grid\n    dx = Lx / Nx\n    dy = Ly / Ny\n    x = np.arange(Nx) * dx\n    y = np.arange(Ny) * dy\n    xx, yy = np.meshgrid(x, y, indexing='xy')\n\n    # Wavenumber grid\n    kx_vec = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky_vec = 2 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    kxx, kyy = np.meshgrid(kx_vec, ky_vec, indexing='xy')\n    K2 = kxx**2 + kyy**2 # Squared total wavenumber\n\n    for case in test_cases:\n        # --- Unpack Case Parameters ---\n        Ldm = case['Ldm']\n        A = case['A']\n        sigma = case['sigma']\n        x0 = case['x0_frac'] * Lx\n        y0 = case['y0_frac'] * Ly\n\n        # --- 1. Define Moist PV Anomaly Field ---\n        # Gaussian anomaly q_m'\n        qm_prime = A * np.exp(-((xx - x0)**2 + (yy - y0)**2) / (2 * sigma**2))\n\n        # --- 2. Solve for Streamfunction (psi) using Spectral Method ---\n        # Fourier transform the PV anomaly\n        qm_hat = np.fft.fft2(qm_prime)\n\n        # Define the spectral inversion operator (denominator)\n        # Operator: -(K^2 + 1/Ldm^2)\n        helmholtz_operator_spectral = -K2 - (1 / Ldm**2)\n        \n        # Solve for psi in spectral space\n        # Note: No division by zero since Ldm  0\n        psi_hat = qm_hat / helmholtz_operator_spectral\n\n        # Inverse Fourier transform to get psi in physical space\n        # Take the real part to discard negligible imaginary components due to numerical error\n        psi = np.fft.ifft2(psi_hat).real\n\n        # --- 3. Compute Geostrophic Wind and Height Anomaly ---\n        # Compute wind components in spectral space for accuracy\n        # ug_hat = -i*ky*psi_hat\n        # vg_hat = i*kx*psi_hat\n        ug_hat = -1j * kyy * psi_hat\n        vg_hat = 1j * kxx * psi_hat\n\n        # Inverse transform to get wind fields in physical space\n        ug = np.fft.ifft2(ug_hat).real\n        vg = np.fft.ifft2(vg_hat).real\n\n        # Compute total horizontal wind speed\n        U = np.sqrt(ug**2 + vg**2)\n        \n        # Compute height anomaly eta = (f0/g) * psi\n        eta = (f0 / g) * psi\n\n        # --- 4. Calculate and Store Maximum Values ---\n        U_max = np.max(U)\n        eta_max = np.max(np.abs(eta))\n\n        results.append(U_max)\n        results.append(eta_max)\n\n    # --- Final Output Formatting ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}