{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握地形阻力和重力波拖曳，我们必须将理论与实践相结合。第一个练习将引导你完成一个具体的计算，旨在连接波浪动量通量这一抽象概念与一个真实世界的大气现象——副热带急流的减速。通过解决这个设定明确的理想化问题 ，你将直接应用动量通量垂直散度与平均流加速度之间的核心关系，从而深刻理解波致阻力如何塑造大尺度环流。",
            "id": "4056240",
            "problem": "考虑一个干燥、静力平衡、稳定分层的大气，其中纬向平均的副热带急流位于 $200\\,\\mathrm{hPa}$ 附近，对应的几何高度为 $z=12\\,\\mathrm{km}$。假设非弹性密度廓线由 $\\rho(z)=\\rho_{s}\\exp\\!\\big(-z/H\\big)$ 给出，其中 $\\rho_{s}=1.2\\,\\mathrm{kg\\,m^{-3}}$，标高 $H=7.5\\,\\mathrm{km}$。在副热带地区，一个理想化的纬向对称山脉在源高度 $z_{0}=2\\,\\mathrm{km}$ 处激发了一系列定常地形重力波。纬向动量的垂直通量（即二维静力重力波的 Eliassen–Palm 通量的垂直分量）定义为 $F(z)\\equiv \\rho(z)\\,\\overline{u'w'}(z)$，其中上划线表示平均，撇号表示扰动。在激发时，该通量为负值，因为它与平均西风气流方向相反。源波谱由两个不重叠的波段组成：\n- 波段 $\\mathcal{A}$ 携带总源通量的 $0.60$ 部分，由于波的饱和与破碎，其动量在 $z\\in[10\\,\\mathrm{km},\\,14\\,\\mathrm{km}]$ 层内随高度均匀沉积。\n- 波段 $\\mathcal{B}$ 携带剩余的 $0.40$ 部分，并在 $z\\in[16\\,\\mathrm{km},\\,22\\,\\mathrm{km}]$ 层内均匀沉积。\n\n在源高度 $z_{0}$ 处，谱积分的纬向动量垂直通量为 $F(z_{0})=-M_{\\mathrm{tot}}$，其中 $M_{\\mathrm{tot}}=0.05\\,\\mathrm{N\\,m^{-2}}$。在源高度之上且沉积层之外，传播是无损的，因此 $F(z)$ 随高度保持不变。在每个沉积层内，随着动量不可逆地传递给平均流，$F(z)$ 线性增加（负值减小）。\n\n从非弹性质量连续性条件下的雷诺平均纬向动量方程出发，在关心的时间尺度上忽略经向通量散度和平均流的平流，推导纬向平均加速度与纬向动量垂直通量的垂直散度之间的关系。然后，利用指定的波谱和沉积层，分段构建 $F(z)$，并计算在 $z=12\\,\\mathrm{km}$（急流核心高度）处纬向风的瞬时纬向平均趋势。将最终结果以 $\\mathrm{m\\,s^{-1}\\,day^{-1}}$ 为单位表示，并四舍五入到三位有效数字。",
            "solution": "首先根据既定标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n- 大气：干燥、静力平衡、稳定分层。\n- 急流位置：$200\\,\\mathrm{hPa}$ 附近，对应于 $z=12\\,\\mathrm{km}$。\n- 非弹性密度廓线：$\\rho(z)=\\rho_{s}\\exp(-z/H)$。\n- 地表密度：$\\rho_{s}=1.2\\,\\mathrm{kg\\,m^{-3}}$。\n- 标高：$H=7.5\\,\\mathrm{km}$。\n- 波源：纬向对称山脉。\n- 波类型：定常地形重力波。\n- 源高度：$z_{0}=2\\,\\mathrm{km}$。\n- 纬向动量的垂直通量：$F(z)\\equiv \\rho(z)\\,\\overline{u'w'}(z)$。\n- 谱积分源通量：$F(z_{0})=-M_{\\mathrm{tot}}$，其中 $M_{\\mathrm{tot}}=0.05\\,\\mathrm{N\\,m^{-2}}$。\n- 源波谱波段 $\\mathcal{A}$：占总源通量的 $0.60$，动量在 $z\\in[10\\,\\mathrm{km},\\,14\\,\\mathrm{km}]$ 上均匀沉积。\n- 源波谱波段 $\\mathcal{B}$：占总源通量的 $0.40$，动量在 $z\\in[16\\,\\mathrm{km},\\,22\\,\\mathrm{km}]$ 上均匀沉积。\n- 在沉积层外传播是无损的（$F(z)$ 是常数）。\n- 层内沉积意味着 $F(z)$ 随高度线性增加。\n- 动量方程的简化：忽略经向通量散度和平均流的平流。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 该问题牢固地植根于大气动力学原理，特别是重力波的生成、传播和动量沉积（波阻）理论。非弹性近似、雷诺平均和 Eliassen-Palm 通量概念的使用是该领域的标准做法。给定的物理参数（$\\rho_s, H, M_{\\mathrm{tot}}$）对于地球大气是符合实际的。\n- **适定性：** 该问题定义明确。它提供了推导唯一解所需的所有数据和一组清晰的物理假设。动量通量廓线 $F(z)$ 的分段定义是明确的。最终目标，即计算特定高度上的风场趋势，是该设定的直接结果。\n- **客观性：** 问题以精确、定量和无偏见的科学语言陈述。没有主观因素。\n\n### 步骤 3：结论与行动\n该问题被认为是有效的。将提供解答。\n\n### 控制方程的推导\n问题要求从雷诺平均的纬向动量方程出发。在一个由非弹性质量连续性方程 $\\nabla \\cdot (\\rho \\vec{v}) = 0$ 描述的流体中，纬向动量方程可以写成通量形式。经过纬向和时间平均（由上划线表示）后，方程为：\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} + \\bar{\\vec{v}} \\cdot \\nabla \\bar{u} + \\frac{1}{\\rho}\\nabla \\cdot (\\rho \\overline{\\vec{v}'u'}) - f\\bar{v} = 0\n$$\n其中 $\\bar{u}$ 是纬向平均的纬向风，$\\bar{\\vec{v}}$ 是平均速度矢量，$\\rho \\overline{\\vec{v}'u'}$ 是涡动动量通量矢量，$f$ 是科里奥利参数。问题陈述要求忽略“平均流的平流”（$\\bar{\\vec{v}} \\cdot \\nabla \\bar{u}$）和“经向通量散度”。对于一个纬向对称的平均态，涡动动量通量矢量的散度展开为：\n$$\n\\frac{1}{\\rho}\\nabla \\cdot (\\rho \\overline{\\vec{v}'u'}) = \\frac{1}{\\rho}\\frac{\\partial}{\\partial y}(\\rho \\overline{v'u'}) + \\frac{1}{\\rho}\\frac{\\partial}{\\partial z}(\\rho \\overline{w'u'})\n$$\n忽略经向通量散度项 $\\frac{1}{\\rho}\\frac{\\partial}{\\partial y}(\\rho \\overline{v'u'})$，以及与平均经圈环流相关的其他项（这些项被隐含地与被忽略的平流项捆绑在一起），纬向动量趋势完全由纬向动量垂直通量的垂直散度驱动：\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{1}{\\rho(z)}\\frac{\\partial}{\\partial z}(\\rho(z) \\overline{u'w'})\n$$\n纬向动量的垂直通量定义为 $F(z) \\equiv \\rho(z)\\overline{u'w'}(z)$。由于问题设定意味着 $F$ 仅是高度 $z$ 的函数，因此偏导数变为全导数。因此，控制方程为：\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{1}{\\rho(z)}\\frac{dF}{dz}\n$$\n该关系表明，给定高度上的平均流加速度由当地密度和波动量通量的垂直梯度决定。一个正的（向上的）梯度，$dF/dz > 0$，对应于通量辐合（因为通量变得不那么负），并导致负加速度，即对平均流的拖曳作用。\n\n### 动量通量廓线 $F(z)$ 的构建\n源高度 $z_0 = 2\\,\\mathrm{km}$ 处的总动量通量为 $F(z_0) = -M_{\\mathrm{tot}} = -0.05\\,\\mathrm{N\\,m^{-2}}$。我们分段构建 $F(z)$。\n\n1.  **区域 $z_0 \\le z  10\\,\\mathrm{km}$**：传播是无损的。\n    $F(z) = F(z_0) = -0.05\\,\\mathrm{N\\,m^{-2}}$。\n\n2.  **区域 $10\\,\\mathrm{km} \\le z \\le 14\\,\\mathrm{km}$**：波段 $\\mathcal{A}$ 沉积其动量。来自该波段的通量为 $0.60 \\times F(z_0) = -0.03\\,\\mathrm{N\\,m^{-2}}$。这部分负通量从总通量中移除并传递给平均流。因此，总通量 $F(z)$ 在该层内增加了 $0.03\\,\\mathrm{N\\,m^{-2}}$。\n    - 该层底部的通量：$F(10\\,\\mathrm{km}) = -0.05\\,\\mathrm{N\\,m^{-2}}$。\n    - 该层顶部的通量：$F(14\\,\\mathrm{km}) = F(10\\,\\mathrm{km}) + 0.03\\,\\mathrm{N\\,m^{-2}} = -0.02\\,\\mathrm{N\\,m^{-2}}$。\n    由于沉积是均匀的，在该层内 $dF/dz$ 是一个常数：\n    $$\n    \\frac{dF}{dz} = \\frac{F(14\\,\\mathrm{km}) - F(10\\,\\mathrm{km})}{14\\,\\mathrm{km} - 10\\,\\mathrm{km}} = \\frac{-0.02 - (-0.05)}{14000 - 10000}\\,\\frac{\\mathrm{N\\,m^{-2}}}{\\mathrm{m}} = \\frac{0.03}{4000}\\,\\mathrm{N\\,m^{-3}} = 7.5 \\times 10^{-6}\\,\\mathrm{N\\,m^{-3}}\n    $$\n    这是与急流核心高度相关的通量散度。\n\n3.  **区域 $14\\,\\mathrm{km}  z  16\\,\\mathrm{km}$**：传播是无损的。\n    $F(z) = F(14\\,\\mathrm{km}) = -0.02\\,\\mathrm{N\\,m^{-2}}$。\n\n4.  **区域 $16\\,\\mathrm{km} \\le z \\le 22\\,\\mathrm{km}$**：波段 $\\mathcal{B}$ 沉积剩余的动量。剩余通量为 $-0.02\\,\\mathrm{N\\,m^{-2}}$，该通量被完全耗散。\n    - 该层顶部的通量：$F(22\\,\\mathrm{km})=0$。\n    - 通量梯度为 $\\frac{dF}{dz} = \\frac{0 - (-0.02)}{22000 - 16000} = \\frac{0.02}{6000}\\,\\mathrm{N\\,m^{-3}}$。\n\n5.  **区域 $z > 22\\,\\mathrm{km}$**：所有动量均已沉积。$F(z) = 0$。\n\n### 在 $z = 12\\,\\mathrm{km}$ 处计算纬向风趋势\n急流核心位于 $z_{jet} = 12\\,\\mathrm{km}$，该高度落在第一个沉积层内（$10\\,\\mathrm{km} \\le 12\\,\\mathrm{km} \\le 14\\,\\mathrm{km}$）。\n\n首先，我们使用给定的非弹性廓线 $\\rho(z) = \\rho_s \\exp(-z/H)$ 计算该高度的空气密度 $\\rho(z)$：\n$$\n\\rho(12\\,\\mathrm{km}) = (1.2\\,\\mathrm{kg\\,m^{-3}}) \\exp\\left(-\\frac{12\\,\\mathrm{km}}{7.5\\,\\mathrm{km}}\\right) = 1.2 \\exp(-1.6)\\,\\mathrm{kg\\,m^{-3}}\n$$\n\n接下来，我们使用为该层计算的 $dF/dz$ 的常数值：\n$$\n\\frac{dF}{dz} = 7.5 \\times 10^{-6}\\,\\mathrm{N\\,m^{-3}}\n$$\n\n现在，我们使用推导出的控制方程计算纬向风趋势：\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{1}{\\rho(12\\,\\mathrm{km})} \\frac{dF}{dz} = -\\frac{7.5 \\times 10^{-6}\\,\\mathrm{N\\,m^{-3}}}{1.2 \\exp(-1.6)\\,\\mathrm{kg\\,m^{-3}}}\n$$\n单位是 $\\mathrm{N\\,m^{-3} / (kg\\,m^{-3})} = (\\mathrm{kg\\,m\\,s^{-2}})\\mathrm{m^{-3} / (kg\\,m^{-3})} = \\mathrm{m\\,s^{-2}}$，这是一个加速度，符合预期。\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{7.5 \\times 10^{-6}}{1.2} \\exp(1.6)\\,\\mathrm{m\\,s^{-2}} = -6.25 \\times 10^{-6} \\exp(1.6)\\,\\mathrm{m\\,s^{-2}}\n$$\n数值上，$\\exp(1.6) \\approx 4.95303$。\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} \\approx -6.25 \\times 10^{-6} \\times 4.95303\\,\\mathrm{m\\,s^{-2}} \\approx -3.0956 \\times 10^{-5}\\,\\mathrm{m\\,s^{-2}}\n$$\n问题要求结果以 $\\mathrm{m\\,s^{-1}\\,day^{-1}}$ 为单位。我们通过乘以一天中的秒数来进行单位换算：$1\\,\\mathrm{day} = 24 \\times 60 \\times 60 = 86400\\,\\mathrm{s}$。\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} \\approx (-3.0956 \\times 10^{-5}\\,\\mathrm{m\\,s^{-2}}) \\times (86400\\,\\mathrm{s\\,day^{-1}})\n$$\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} \\approx -2.6746\\,\\mathrm{m\\,s^{-1}\\,day^{-1}}\n$$\n四舍五入到三位有效数字，急流核心处纬向风的瞬时纬向平均趋势为 $-2.67\\,\\mathrm{m\\,s^{-1}\\,day^{-1}}$。负号正确地表示了对西风气流的减速或拖曳作用。",
            "answer": "$$\\boxed{-2.67}$$"
        },
        {
            "introduction": "在掌握了基本计算之后，我们现在将挑战升级，从理论计算转向实际的建模实现。这项练习  将让你亲手构建一个简化的地形阻力参数化方案，这是数值天气预报和气候模型中的关键组成部分。你将从基本物理定律出发，编写一个能够模拟重力波垂直传播、破碎（饱和）以及在临界层被吸收的算法，从而计算出动量在垂直方向上的沉积剖面。对于任何有志于模型开发的学习者来说，这都是一次至关重要的实践，它揭示了如何将复杂的次网格物理过程转化为可计算的程序。",
            "id": "3904213",
            "problem": "考虑在线性 Boussinesq 近似下，针对二维定常山地波，在垂直变化的大气中地形拖曳的参数化问题。给定层结廓线 $N(z)$、与水平波数矢量对齐的背景风廓线 $U(z)$，以及由水平波数 $k$ 和地形振幅 $h_0$ 表征的一组离散地形谱分量。从包含 (i) Boussinesq 连续性方程和动量方程，(ii) 二维定常波的内重力波频散关系，以及 (iii) 缓变介质中波作用量守恒的基本理论出发，推导计算垂直波数 $m(z)$、水平动量的垂直通量（也称为 Eliassen-Palm 通量）和饱和判据所需的表达式。利用这些表达式，实现一个算法，将每个谱分量从下边界开始，通过一个离散网格向上垂直传播，直到遇到波破碎（饱和）或临界层，并计算由此产生的动量沉积的垂直分布。\n\n算法要求如下：\n\n- 从基本定律和核心定义出发，推导地形强迫的定常内重力波垂直传播所需的控制关系。不要使用未经基本理论推导的、现成的或简化的公式。\n- 假设参考密度 $\\rho_0$ 为常数，并使用适用于山地波的 Boussinesq 框架的二维、无旋转、静力平衡一致的极限。\n- 在一个从 $z=0$ 到 $z=10000$ 米、间距为 $1000$ 米的均匀网格 $z_i$ 上实现垂直传播。在每个层级，判断内重力波是否能够传播（$m^2(z_i) > 0$），是否遇到转向层（$m^2(z_i) \\le 0$），是否根据一个有物理动机的非线性阈值达到饱和，或者是否遇到临界层（定义为当 $|U(z_i)|$ 降至一个小的阈值以下时，内禀相速消失）。\n- 对于每个具有参数 $k$ 和 $h_0$ 的谱分量，使用从基本理论推导出的关系，在下边界初始化向上的水平动量垂直通量。在没有破碎或临界层的绝热传播假设下，该通量随高度守恒。当发生饱和（基于一个推导出的非线性参数达到1），或遇到临界层（基于 $|U(z)|$ 的阈值），或到达转向层（$m^2(z) \\le 0$）时，将剩余的向上通量局地沉积在该层级。将所有谱分量的动量沉积贡献相加，得到净垂直廓线。\n- 所有动量沉积值均以牛顿/平方米（$\\mathrm{N}\\,\\mathrm{m}^{-2}$）为单位表示。对于最终的程序输出，将每个报告的浮点数四舍五入到六位小数。\n\n使用以下常数和测试套件。所有数学实体（符号、变量、函数和数字）都应根据其物理意义进行一致处理：\n\n- 参考密度：$\\rho_0 = 1.0 \\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n- 临界层阈值：$U_{\\mathrm{crit}} = 0.5 \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n\n垂直网格：\n- 层级位于 $z_i = 0, 1000, 2000, \\dots, 10000$ 米。\n\n测试套件（三个案例），每个案例由 $N(z)$、$U(z)$ 和一组离散谱分量 $\\{(k,h_0)\\}$ 定义：\n\n- 案例 A（可能导致饱和的单调切变）：\n  - 层结：对于所有 $z$，$N(z) = 0.01 \\,\\mathrm{s}^{-1}$。\n  - 风场：$U(z) = 10 + 1.2 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n  - 谱分量：$(k_1,h_{0,1}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$，$(k_2,h_{0,2}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$，$(k_3,h_{0,3}) = (8\\times 10^{-4}\\,\\mathrm{m}^{-1}, 100\\,\\mathrm{m})$。\n\n- 案例 B（因风随高度反向而产生的临界层）：\n  - 层结：对于所有 $z$，$N(z) = 0.01 \\,\\mathrm{s}^{-1}$。\n  - 风场：$U(z) = 12 - 3 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n  - 谱分量：$(k_1,h_{0,1}) = (4\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$，$(k_2,h_{0,2}) = (6\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$，$(k_3,h_{0,3}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$。\n\n- 案例 C（层结减弱导致转向层）：\n  - 层结：$N(z) = 0.014 - 0.0008 \\times (z/1000) \\,\\mathrm{s}^{-1}$。\n  - 风场：对于所有 $z$，$U(z) = 15 \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n  - 谱分量：$(k_1,h_{0,1}) = (7\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$，$(k_2,h_{0,2}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 180\\,\\mathrm{m})$，$(k_3,h_{0,3}) = (9\\times 10^{-4}\\,\\mathrm{m}^{-1}, 80\\,\\mathrm{m})$。\n\n数值和物理处理指南：\n- 垂直波数 $m(z)$ 必须根据适用于 Boussinesq 流体中具有水平对齐平均流的二维定常内重力波的频散关系来确定。\n- 必须使用极化关系来关联垂直速度振幅与水平速度扰动，并计算水平动量的垂直通量。\n- 使用波作用量守恒来推断在没有破碎或临界层的情况下振幅如何随 $z$ 演变，从而能够计算非线性参数及其饱和阈值。\n- 在饱和、遇到临界层或到达转向层时，将剩余的向上通量沉积在当前层级，并停止该谱分量的传播。\n\n最终输出规范：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个条目对应一个测试案例，并且本身是一个包含11个浮点数的列表，代表在11个垂直层级 $z_i$（从 $z=0$ 到 $z=10000$ 米）的净动量沉积，单位为 $\\mathrm{N}\\,\\mathrm{m}^{-2}$，四舍五入到六位小数。例如：\"[[x_0,x_1,...,x_{10}],[y_0,y_1,...,y_{10}],[z_0,z_1,...,z_{10}]]\"。",
            "solution": "该问题要求推导一个地形重力波拖曳的模型并加以实现。推导将从指定近似下的流体动力学基本方程开始。\n\n**1. 基本方程与线性化**\n\n我们从分层流体的二维、定常、无旋转、无粘性 Boussinesq 方程组开始，围绕具有水平速度 $U(z)$ 和密度廓线 $\\bar{\\rho}(z)$ 的背景态进行线性化。扰动量为速度分量 $(u', w')$、压强 $p'$ 和密度 $\\rho'$。参考密度 $\\rho_0$ 是一个常数。\n\n线性化的动量方程为：\n$$ U \\frac{\\partial u'}{\\partial x} + w' \\frac{dU}{dz} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial x} \\quad (1) $$\n$$ U \\frac{\\partial w'}{\\partial x} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial z} - \\frac{\\rho' g}{\\rho_0} \\quad (2) $$\n连续性方程为：\n$$ \\frac{\\partial u'}{\\partial x} + \\frac{\\partial w'}{\\partial z} = 0 \\quad (3) $$\n热力学方程，代表流体质点密度的守恒，为：\n$$ U \\frac{\\partial \\rho'}{\\partial x} + w' \\frac{d\\bar{\\rho}}{dz} = 0 \\quad (4) $$\n我们通过 $N^2(z) = -\\frac{g}{\\rho_0}\\frac{d\\bar{\\rho}}{dz}$ 定义 Brunt-Väisälä 频率 $N$。利用此定义，方程(4)变为：\n$$ U \\frac{\\partial}{\\partial x} \\left(-\\frac{\\rho' g}{\\rho_0}\\right) - w' N^2 = 0 \\quad (5) $$\n\n**2. Taylor-Goldstein 方程的推导**\n\n我们寻找形如 $\\psi'(x,z) = \\Re\\{\\hat{\\psi}(z) e^{ikx}\\}$ 的波动解，其中 $\\psi'$ 是任意扰动变量，$k$ 是水平波数。将此形式代入线性化方程，得到关于复振幅 $\\hat{u}(z), \\hat{w}(z), \\hat{p}(z), \\hat{\\rho}(z)$ 的常微分方程组（ODEs）：\n$$ ikU\\hat{u} + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\quad (6) $$\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0}\\frac{d\\hat{p}}{dz} - \\frac{\\hat{\\rho}g}{\\rho_0} \\quad (7) $$\n$$ ik\\hat{u} + \\frac{d\\hat{w}}{dz} = 0 \\quad (8) $$\n$$ ikU\\left(-\\frac{\\hat{\\rho}g}{\\rho_0}\\right) - \\hat{w} N^2 = 0 \\quad (9) $$\n\n从(8)式，我们用 $\\hat{w}$ 表示 $\\hat{u}$：$\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$。\n从(9)式，我们用 $\\hat{w}$ 表示浮力项：$-\\frac{\\hat{\\rho}g}{\\rho_0} = \\frac{N^2}{ikU}\\hat{w}$。\n\n将 $\\hat{u}$ 代入(6)式求解 $\\hat{p}$：\n$$ ikU\\left(\\frac{i}{k}\\frac{d\\hat{w}}{dz}\\right) + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\implies \\hat{p} = \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) $$\n现在，对 $\\hat{p}$ 求关于 $z$ 的导数，并将其与浮力项的表达式一起代入(7)式：\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0} \\frac{d}{dz} \\left[ \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) \\right] + \\frac{N^2}{ikU}\\hat{w} $$\n展开导数并重新整理各项后，我们得到 Taylor-Goldstein 方程：\n$$ \\frac{d^2\\hat{w}}{dz^2} + \\left( \\frac{N^2}{U^2} - k^2 - \\frac{U_{zz}}{U} \\right) \\hat{w} = 0 $$\n其中 $U_{zz} = d^2U/dz^2$。\n\n**3. 垂直波数 $m(z)$**\n\n问题指定对“缓变介质”进行分析，这对应于 WKB 近似。在此极限下，涉及风廓线曲率的项 $U_{zz}/U$ 与其他项相比可以忽略不计。控制方程简化为：\n$$ \\frac{d^2\\hat{w}}{dz^2} + m^2(z)\\hat{w} = 0 $$\n这是一个具有空间变化频率的谐振子方程。局地垂直波数 $m(z)$ 由以下公式定义：\n$$ m^2(z) = \\frac{N(z)^2}{U(z)^2} - k^2 $$\n要使波能够垂直传播，其解在 $z$ 方向必须是振荡的，这要求 $m^2(z) > 0$。如果 $m^2(z) \\le 0$，解是衰减的，波无法传播。这个条件 $m^2(z) \\le 0$ 定义了一个**转向层**。\n\n**4. 水平动量的垂直通量**\n\n单位面积的水平动量垂直通量由 $F_m = \\rho_0 \\overline{u'w'}$ 给出，其中上划线表示在一个波长范围内的水平平均。我们引入垂直气块位移 $\\eta'(x, z)$。对于小位移，垂直速度是位移的全导数：$w' = \\frac{D\\eta'}{Dt} = (\\frac{\\partial}{\\partial t} + U\\frac{\\partial}{\\partial x})\\eta'$。对于定常波（$\\partial/\\partial t = 0$），这简化为 $w' = U\\frac{\\partial \\eta'}{\\partial x}$。对于单个傅里叶模式 $\\eta'(x,z) = \\Re\\{\\hat{\\eta}(z) e^{ikx}\\}$，我们有 $\\hat{w}(z) = ikU(z)\\hat{\\eta}(z)$。\n\n在地面（$z=0$）的运动学边界条件迫使气流跟随地形 $h(x)$。因此，$\\eta'(x,0) = h(x)$。对于谱分量 $h(x) = h_0 \\cos(kx)$，地表位移的复振幅为 $\\hat{\\eta}(0) = h_0$。\n\n为了求得动量通量，我们需要关联 $u'$ 和 $\\eta'$。结合连续性方程(3)和 $w'$ 与 $\\eta'$ 之间的关系：\n$$ \\frac{\\partial u'}{\\partial x} = -\\frac{\\partial w'}{\\partial z} = -\\frac{\\partial}{\\partial z}\\left(U\\frac{\\partial \\eta'}{\\partial x}\\right) = -U\\frac{\\partial^2 \\eta'}{\\partial x \\partial z} - \\frac{dU}{dz}\\frac{\\partial \\eta'}{\\partial x} $$\n对 $x$ 积分得到 $u' = -U\\frac{\\partial \\eta'}{\\partial z} - \\frac{dU}{dz}\\eta'$。对于向上传播的能量，$\\eta'$ 的垂直结构与 $e^{imz}$ 成正比。在 WKB 近似下（$\\partial_z \\gg \\frac{1}{U}\\frac{dU}{dz}$ 等），我们有 $\\frac{\\partial \\eta'}{\\partial z} \\approx im\\eta'$，从而得到 $\\hat{u} \\approx -imU\\hat{\\eta}$。\n\n动量通量则为：\n$F_m = \\rho_0 \\overline{u'w'} = \\frac{1}{2}\\rho_0 \\Re\\{\\hat{u}(ikU\\hat{\\eta})^*\\} = \\frac{1}{2}\\rho_0 \\Re\\{(-imU\\hat{\\eta})(-ikU\\hat{\\eta}^*)\\} = \\frac{1}{2}\\rho_0 \\Re\\{-mkU^2|\\hat{\\eta}|^2\\}$。\n$$ F_m(z) = -\\frac{1}{2} \\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2 $$\n负号表示向下的水平动量通量，这对应于对地表的拖曳力。对于从地面发出的向上传播的波，其在地表（$z=0$）的通量大小，记为 $J_0$，为：\n$$ J_0 = |F_m(0)| = \\frac{1}{2}\\rho_0 k U_0^2 h_0^2 m_0 $$\n其中 $U_0 = U(0)$，$N_0 = N(0)$，以及 $m_0 = \\sqrt{N_0^2/U_0^2 - k^2}$。\n对于一个稳定、无耗散的波，水平动量的垂直通量随高度守恒，即 $F_m(z) = F_m(0)$。因此，其大小 $J(z) = J_0$ 保持不变，直到波遇到临界层、转向层或发生破碎。\n\n**5. 饱和判据**\n\n当波的振幅变得过大时，会发生波破碎（饱和），导致对流不稳定性。这发生在总位温梯度 $\\partial\\theta/\\partial z$ 变为非正值时。这等效于浮力 $b = \\bar{b}(z)+b'(x,z)$ 满足条件 $\\partial b/\\partial z \\le 0$。起始判据为 $\\partial b'/\\partial z \\ge N^2$。\n\n从热力学方程(5)，我们得到 $b' = -N^2\\eta'$。因此饱和判据为：\n$$ \\frac{\\partial}{\\partial z}(-N^2 \\eta') \\ge N^2 \\implies -N^2 \\frac{\\partial \\eta'}{\\partial z} \\ge N^2 \\implies \\frac{\\partial \\eta'}{\\partial z} \\le -1 $$\n位移垂直梯度的振幅为 $|\\frac{\\partial \\eta'}{\\partial z}| \\approx |im\\eta'| = m|\\hat{\\eta}|$。因此，当非线性参数 $S(z) = m(z)|\\hat{\\eta}(z)|$ 达到1的量级时，发生饱和。我们将阈值设为 $S(z) \\ge 1$。\n\n为了评估 $S(z)$，我们从动量通量大小守恒中求出 $|\\hat{\\eta}(z)|$：$J_0 = \\frac{1}{2}\\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2$。\n$$ |\\hat{\\eta}(z)|^2 = \\frac{2 J_0}{\\rho_0 k m(z) U(z)^2} $$\n将此代入 $S(z)$ 的表达式中：\n$$ S(z) = m(z) \\sqrt{\\frac{2 J_0}{\\rho_0 k m(z) U(z)^2}} = \\sqrt{\\frac{2 J_0 m(z)}{\\rho_0 k U(z)^2}} $$\n如果 $S(z_i) \\ge 1$，则认为波在层级 $z_i$ 处破碎。\n\n**6. 算法流程**\n\n计算动量沉积垂直廓线的算法如下。\n对于每种大气廓线案例：\n1.  初始化一个总沉积数组 $D[z_i]$，对所有网格层级 $z_i$ 置为零。\n2.  对于每个谱分量 $(k, h_0)$：\n    a. 计算背景状态 $U_0=U(0)$，$N_0=N(0)$。\n    b. 计算地表垂直波数的平方：$m_0^2 = N_0^2/U_0^2 - k^2$。\n    c. 如果 $m_0^2 \\le 0$，波在源头即为衰减波。动量通量 $J_0$ 为零。处理下一个分量。\n    d. 否则，计算地表向上的动量通量大小：$J_0 = \\frac{1}{2}\\rho_0 k U_0^2 h_0^2 m_0$。\n    e. 垂直传播此通量。从层级 $i=1$ 到顶层进行迭代（$z_i = 1000, 2000, ..., 10000$ 米）。\n       i. 在层级 $z_i$ 处，计算 $U_i=U(z_i)$ 和 $N_i=N(z_i)$。\n       ii. **临界层检查：** 如果 $|U_i|  U_{\\mathrm{crit}}$，波被吸收。将 $J_0$ 加到该层的沉积中，$D[z_i] += J_0$，并终止此分量的传播（跳出垂直循环）。\n       iii. **转向层检查：** 计算 $m_i^2 = N_i^2/U_i^2 - k^2$。如果 $m_i^2 \\le 0$，波被反射/捕获。向上的通量终止。将 $J_0$ 加到 $D[z_i]$ 中并跳出循环。\n       iv. **饱和检查：** 如果波仍在传播，计算饱和参数 $S_i^2 = \\frac{2 J_0 m_i}{\\rho_0 k U_i^2}$，其中 $m_i=\\sqrt{m_i^2}$。如果 $S_i^2 \\ge 1$，波发生破碎。将 $J_0$ 加到 $D[z_i]$ 中并跳出循环。\n    f. 如果循环完成而未中断，则波的动量通量逃离了模型域的顶部，没有被沉积。\n3.  最终的数组 $D$ 代表该案例的总动量沉积廓线。\n对所有测试案例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes orographic gravity wave drag deposition profiles for given atmospheric conditions.\n    \"\"\"\n    # Define constants\n    rho_0 = 1.0  # kg/m^3\n    U_crit = 0.5  # m/s\n\n    # Define vertical grid\n    z_levels = np.linspace(0, 10000, 11)  # 0, 1000, ..., 10000 meters\n\n    # Define Test Suite\n    test_suite = {\n        \"A\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 10.0 + 1.2 * (z / 1000.0),\n            \"components\": [\n                (5e-4, 200.0),\n                (3e-4, 150.0),\n                (8e-4, 100.0),\n            ]\n        },\n        \"B\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 12.0 - 3.0 * (z / 1000.0),\n            \"components\": [\n                (4e-4, 150.0),\n                (6e-4, 120.0),\n                (3e-4, 200.0),\n            ]\n        },\n        \"C\": {\n            \"N_func\": lambda z: 0.014 - 0.0008 * (z / 1000.0),\n            \"U_func\": lambda z: 15.0,\n            \"components\": [\n                (7e-4, 120.0),\n                (5e-4, 180.0),\n                (9e-4, 80.0),\n            ]\n        }\n    }\n\n    all_results = []\n\n    for case_id in [\"A\", \"B\", \"C\"]:\n        case_data = test_suite[case_id]\n        N_func = case_data[\"N_func\"]\n        U_func = case_data[\"U_func\"]\n        components = case_data[\"components\"]\n\n        total_deposition = np.zeros(len(z_levels))\n\n        for k, h0 in components:\n            # 1. Initialization at the lower boundary (z=0)\n            z0 = z_levels[0]\n            U0 = U_func(z0)\n            N0 = N_func(z0)\n            \n            # Ensure U0 is not at a critical level for flux calculation\n            if abs(U0)  1e-9:\n                continue # No wave launched\n\n            m_squared_0 = (N0**2 / U0**2) - k**2\n\n            # Check if the wave is propagating at the surface\n            if m_squared_0 = 0:\n                # Evanescent wave, no upward flux\n                continue\n\n            m0 = np.sqrt(m_squared_0)\n            \n            # Calculate magnitude of momentum flux at the surface\n            J0 = 0.5 * rho_0 * k * m0 * (U0 * h0)**2\n            \n            # 2. Vertical Propagation\n            flux_deposited = False\n            for i in range(1, len(z_levels)):\n                zi = z_levels[i]\n                Ui = U_func(zi)\n                Ni = N_func(zi)\n                \n                # Check for critical level\n                if abs(Ui)  U_crit:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n\n                # Ensure Ui is not zero before calculating m_squared\n                if abs(Ui)  1e-9:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n\n                m_squared_i = (Ni**2 / Ui**2) - k**2\n\n                # Check for turning level\n                if m_squared_i = 0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n                \n                mi = np.sqrt(m_squared_i)\n\n                # Check for saturation (wave breaking)\n                # Saturation criterion S^2 >= 1, where S^2 = (2 * J0 * m_i) / (rho_0 * k * U_i^2)\n                saturation_param_sq = (2.0 * J0 * mi) / (rho_0 * k * Ui**2)\n                if saturation_param_sq >= 1.0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n            \n            # The problem implies that if a wave reaches the top without breaking,\n            # its momentum is not deposited in the specified domain.\n            \n        # Format results for the current case\n        case_results_rounded = [round(val, 6) for val in total_deposition]\n        all_results.append(case_results_rounded)\n    \n    # Format the final output string as specified\n    formatted_case_results = []\n    for res_list in all_results:\n        formatted_list = f\"[{','.join(f'{x:.6f}' for x in res_list)}]\"\n        formatted_case_results.append(formatted_list)\n    \n    final_output_string = f\"[{','.join(formatted_case_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "当一个参数化方案被植入模型后，验证其正确性并诊断其总体效应变得至关重要。这个最后的练习  将指导你使用两种源于基本守恒定律的独立方法，从模型输出数据中诊断整层平均的拖曳力。你将分别实施“通量散度法”和“动量收支残差法”来计算平均拖曳加速度，并验证两者的一致性。这不仅是一项宝贵的模型评估与验证技巧，更提供了一种深刻的视角，帮助你理解模型内部的动量收支平衡。",
            "id": "4073087",
            "problem": "您将设计并实现一种诊断程序，用以从垂直气柱的大气数据中推断整层平均的地形和重力波拖曳加速度。该程序将使用两种独立的原理：一种是基于水平动量垂直通量的通量散度法，另一种是基于纬向动量收支的剩余法。其目标是展示拖曳如何与基本守恒定律相关联，并产生数值上一致的估计。背景设定为一个地形上的一维垂直气柱，适用于数值天气预报（NWP）和气候模式，具有指定的高度、密度、动量通量和解析的倾向项的廓线。您的程序必须使用两种诊断方法为每个测试用例计算质量加权的整层平均拖曳加速度，并验证其一致性。\n\n推导基于以下普遍适用的物理和数学原理：\n- 对于旋转、分层、垂直静力平衡的大气，雷诺平均的高度坐标系下的纬向动量方程指出，解析的平均纬向风 $u$ 的演变涉及平流、科里奥利力、水平气压梯度力、动量的垂直扩散，以及未解析（次网格）的拖曳过程（如重力波拖曳），这些过程表现为单位质量的体积力加速度。\n- 纬向动量的垂直通量为 $F(z) \\equiv \\rho(z)\\,\\overline{u'(z) w'(z)}$，其中 $\\rho$ 是密度，$\\overline{\\cdot}$ 是平均，$(u',w')$ 是湍流或波动扰动。与垂直通量散度相关的单位质量体积力是 $a(z) = -\\rho(z)^{-1}\\,\\partial F/\\partial z$。\n- 在 $z \\in [z_{\\mathrm{bot}}, z_{\\mathrm{top}}]$ 范围内，任何量 $q(z)$ 的整层质量加权平均为\n$$\n\\bar{q} = \\dfrac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,q(z)\\,dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}\n$$\n- 使用乘法法则和微积分基本定理，从垂直通量散度诊断出的质量加权平均拖曳加速度简化为\n$$\n\\bar{a}_{\\mathrm{flux}} = \\dfrac{F(z_{\\mathrm{bot}}) - F(z_{\\mathrm{top}})}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}\n$$\n这与气柱内部的垂直结构无关。\n- 质量加权平均的未解析拖曳加速度也可以通过纬向动量收支的剩余项（单位质量）来诊断：$a_{\\mathrm{res}}(z) \\equiv \\partial u/\\partial t - A - C - P - V$，其中 $A$ 是平流项，$C$ 是科里奥利项，$P$ 是水平气压梯度项，$V$ 是垂直扩散项。整层质量加权平均为\n$$\n\\bar{a}_{\\mathrm{res}} = \\dfrac{\\int \\rho\\,a_{\\mathrm{res}}\\,dz}{\\int \\rho\\,dz}\n$$\n\n您的程序必须：\n- 对每个测试用例，使用提供的身高网格上的梯形法则计算质量柱 $\\int \\rho\\,dz$。\n- 仅使用 $F$ 的顶部和底部值以及上述的质量柱，通过通量法计算整层平均拖曳加速度 $\\bar{a}_{\\mathrm{flux}}$。\n- 通过剩余法计算整层平均拖曳加速度 $\\bar{a}_{\\mathrm{res}}$，首先根据提供的倾向项在每个高度层上计算 $a_{\\mathrm{res}}(z)$，然后使用梯形法则积分 $\\rho\\,a_{\\mathrm{res}}$，最后除以质量柱。\n- 返回两个加速度和一个布尔值，该布尔值指示绝对差 $|\\bar{a}_{\\mathrm{flux}} - \\bar{a}_{\\mathrm{res}}|$ 是否小于或等于 $\\varepsilon = 10^{-12}$ 的容差。\n\n物理单位和数值要求：\n- 高度 $z$ 以米（$\\mathrm{m}$）为单位，密度 $\\rho$ 以千克每立方米（$\\mathrm{kg}\\,\\mathrm{m}^{-3}$）为单位，动量通量 $F$ 以帕斯卡（$\\mathrm{Pa}$）为单位，加速度以米每平方秒（$\\mathrm{m}\\,\\mathrm{s}^{-2}$）为单位。\n- 所有报告的加速度均以 $\\mathrm{m}\\,\\mathrm{s}^{-2}$ 表示，四舍五入到 $9$ 位小数。\n\n测试套件：\n对于每个测试用例，数组在 $z_k$（$k=0,\\dots,N$）层级上给出，包括顶部和底部。请完全按照提供的数组使用。\n\n- 测试用例 1（理想情况：通量随高度减小）：\n  - 高度 $z$（单位：$\\mathrm{m}$）：[$0$, $2000$, $5000$, $10000$]。\n  - 密度 $\\rho$（单位：$\\mathrm{kg}\\,\\mathrm{m}^{-3}$）：[$1.2$, $1.0$, $0.7$, $0.4$]。\n  - 纬向动量通量 $F$（单位：$\\mathrm{Pa}$）：[$0.05$, $0.03$, $0.01$, $0.00$]。\n  - 相同高度层上的纬向动量收支项（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$）：\n    - $\\partial u/\\partial t$：[$6.666666666666667 \\times 10^{-6}$, $6.666666666666667 \\times 10^{-6}$, $6.666666666666667 \\times 10^{-6}$, $6.666666666666667 \\times 10^{-6}$]。\n    - $A$：[$0$, $0$, $0$, $0$], $C$：[$0$, $0$, $0$, $0$], $P$：[$0$, $0$, $0$, $0$], $V$：[$0$, $0$, $0$, $0$]。\n\n- 测试用例 2（边界条件：净通量为零且剩余项为零）：\n  - 高度 $z$（单位：$\\mathrm{m}$）：[$0$, $1000$, $3000$, $7000$]。\n  - 密度 $\\rho$（单位：$\\mathrm{kg}\\,\\mathrm{m}^{-3}$）：[$1.1$, $1.0$, $0.8$, $0.5$]。\n  - 纬向动量通量 $F$（单位：$\\mathrm{Pa}$）：[$0.02$, $0.02$, $0.02$, $0.02$]。\n  - 纬向动量收支项（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$）：\n    - $\\partial u/\\partial t$：[$0$, $0$, $0$, $0$]。\n    - $A$：[$0$, $0$, $0$, $0$], $C$：[$0$, $0$, $0$, $0$], $P$：[$0$, $0$, $0$, $0$], $V$：[$0$, $0$, $0$, $0$]。\n\n- 测试用例 3（边界情况：符号相反且密度可变）：\n  - 高度 $z$（单位：$\\mathrm{m}$）：[$0$, $1000$, $3000$, $6000$, $9000$, $12000$]。\n  - 密度 $\\rho$（单位：$\\mathrm{kg}\\,\\mathrm{m}^{-3}$）：[$1.2$, $1.1$, $0.9$, $0.7$, $0.5$, $0.35$]。\n  - 纬向动量通量 $F$（单位：$\\mathrm{Pa}$）：[$-0.01$, $-0.005$, $0.0$, $0.015$, $0.025$, $0.03$]。\n  - 纬向动量收支项（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$）：\n    - $\\partial u/\\partial t$：[$-4.637681159420289 \\times 10^{-6}$, $-4.637681159420289 \\times 10^{-6}$, $-4.637681159420289 \\times 10^{-6}$, $-4.637681159420289 \\times 10^{-6}$, $-4.637681159420289 \\times 10^{-6}$, $-4.637681159420289 \\times 10^{-6}$]。\n    - $A$：[$0$, $0$, $0$, $0$, $0$, $0$], $C$：[$0$, $0$, $0$, $0$, $0$, $0$], $P$：[$0$, $0$, $0$, $0$, $0$, $0$], $V$：[$0$, $0$, $0$, $0$, $0$, $0$]。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的、由逗号分隔的三个测试用例的结果列表。每个测试用例的结果本身必须是一个包含三个元素的列表：通过通量诊断的整层平均加速度 $\\bar{a}_{\\mathrm{flux}}$（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$，四舍五入到9位小数），通过剩余法诊断的整层平均加速度 $\\bar{a}_{\\mathrm{res}}$（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$，四舍五入到9位小数），以及一个指示绝对差是否小于或等于 $\\varepsilon = 10^{-12}$ 的布尔值。例如，输出格式为 [[a1_flux,a1_resid,ok1],[a2_flux,a2_resid,ok2],[a3_flux,a3_resid,ok3]]，不含其他文本。",
            "solution": "该问题要求设计一个诊断程序，用于计算大气柱中整层平均的次网格尺度（SGS）拖曳加速度。这是评估数值天气预报（NWP）和气候模式时的常见任务，在这些模式中，像地形拖曳和重力波拖曳这样的过程发生在比模式网格更小的尺度上，必须进行参数化。我们被要求基于基本物理原理实现两种独立的方法，并验证它们的一致性。第一种方法使用动量通量的垂直散度，而第二种方法将拖曳诊断为纬向动量收支中的剩余项。\n\n物理背景是一个一维垂直气柱，其中大气属性仅是高度 $z$ 的函数。分析基于雷诺平均的纬向动量方程。\n\n**方法一：通量散度诊断法**\n\n此方法直接计算由未解析的波和湍流引起的动量垂直输送效应。纬向动量的垂直通量为 $F(z) = \\rho(z)\\,\\overline{u'(z) w'(z)}$，其中 $\\rho$ 是空气密度，$u'$ 和 $w'$ 分别是纬向和垂直速度的扰动。该通量的散度对平均流起到体积力的作用。给定高度 $z$ 处的加速度（单位质量的力）为：\n$$a(z) = -\\frac{1}{\\rho(z)} \\frac{\\partial F(z)}{\\partial z}$$\n我们关心的是整个大气柱（从底部高度 $z_{\\mathrm{bot}}$ 到顶部高度 $z_{\\mathrm{top}}$）的质量加权平均加速度。任何量 $q(z)$ 的质量加权平均定义为：\n$$\\bar{q} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,q(z)\\,dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}$$\n将此定义应用于拖曳加速度 $a(z)$，我们得到平均通量散度加速度 $\\bar{a}_{\\mathrm{flux}}$：\n$$\\bar{a}_{\\mathrm{flux}} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z) \\left( -\\frac{1}{\\rho(z)} \\frac{\\partial F}{\\partial z} \\right) dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz} = \\frac{-\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\frac{\\partial F}{\\partial z} dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}$$\n根据微积分基本定理，导数 $\\partial F/\\partial z$ 的积分简化为积分域边界上 $F$ 的差值：\n$$\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\frac{\\partial F}{\\partial z} dz = F(z_{\\mathrm{top}}) - F(z_{\\mathrm{bot}})$$\n将其代入 $\\bar{a}_{\\mathrm{flux}}$ 的表达式，得到最终的简洁公式：\n$$\\bar{a}_{\\mathrm{flux}} = \\frac{-(F(z_{\\mathrm{top}}) - F(z_{\\mathrm{bot}}))}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz} = \\frac{F(z_{\\mathrm{bot}}) - F(z_{\\mathrm{top}})}{M}$$\n其中 $M = \\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz$ 是单位水平面积上大气柱的总质量。\n\n在数值上，这个计算很简单。分子 $F(z_{\\mathrm{bot}}) - F(z_{\\mathrm{top}})$ 从提供的动量通量数组 $F$ 的第一个和最后一个元素获得。分母，即气柱质量 $M$，通过对提供的高度 $z$ 和密度 $\\rho$ 数组应用梯形法则来计算。\n\n**方法二：动量收支剩余诊断法**\n\n此方法依赖于动量守恒原理。解析的纬向动量的时间变化率 $\\partial u/\\partial t$ 由所有解析的强迫项和我们可表示为 $a(z)$ 的未解析（SGS）拖曳加速度之和来平衡。纬向动量方程可以写成：\n$$\\frac{\\partial u}{\\partial t} = A + C + P + V + a(z)$$\n其中 $A$ 是平流，$C$ 是科里奥利力，$P$ 是水平气压梯度力，$V$ 是垂直扩散。通过重新排列方程，我们可以将此拖曳诊断为动量收支的剩余项，我们称之为 $a_{\\mathrm{res}}(z)$：\n$$a_{\\mathrm{res}}(z) = \\frac{\\partial u}{\\partial t}(z) - A(z) - C(z) - P(z) - V(z)$$\n为了找到整层平均拖曳，我们计算 $a_{\\mathrm{res}}(z)$ 的质量加权平均：\n$$\\bar{a}_{\\mathrm{res}} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,a_{\\mathrm{res}}(z)\\,dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,a_{\\mathrm{res}}(z)\\,dz}{M}$$\n分母中的气柱质量 $M$ 与为通量散度法计算的质量相同。\n\n数值实现包括两个步骤。首先，我们通过从倾向数组 $\\partial u/\\partial t$ 中按元素减去给定的强迫项数组，计算出每个垂直层次 $k$ 上的剩余加速度廓线 $a_{\\mathrm{res}}(z_k)$。其次，我们通过对密度数组 $\\rho$ 和新计算的剩余加速度数组 $a_{\\mathrm{res}}$ 的乘积应用梯形法则，来计算 $\\bar{a}_{\\mathrm{res}}$ 表达式的分子。然后将结果除以先前计算的气柱质量 $M$。\n\n**一致性验证**\n\n这两种方法产生的 $\\bar{a}_{\\mathrm{flux}}$ 和 $\\bar{a}_{\\mathrm{res}}$ 均源于相同的动量守恒基本原理。因此，如果提供的数据在物理上是一致的，并且数值方法实现正确，那么这两种诊断方法必须得出相同的结果。问题陈述中提供的测试用例是专门构造成一致的。验证步骤 $|\\bar{a}_{\\mathrm{flux}} - \\bar{a}_{\\mathrm{res}}| \\le \\varepsilon$（使用一个小的容差 $\\varepsilon = 10^{-12}$）是对实现正确性的关键检查。这个小的非零容差考虑了两种计算路径之间可能存在的浮点数表示差异。\n\n实现将利用 `numpy` 库进行高效的数组操作，并使用其 `trapz` 函数进行精确的梯形积分。对于每个测试用例，程序将计算 $\\bar{a}_{\\mathrm{flux}}$ 和 $\\bar{a}_{\\mathrm{res}}$，并执行一致性检查，然后将结果格式化为指定精度。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes column-mean orographic and gravity wave drag accelerations\n    from atmospheric data using two independent methods and verifies\n    their consistency.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"z\": np.array([0, 2000, 5000, 10000], dtype=float),\n            \"rho\": np.array([1.2, 1.0, 0.7, 0.4], dtype=float),\n            \"F\": np.array([0.05, 0.03, 0.01, 0.00], dtype=float),\n            \"du_dt\": np.array([6.666666666666667e-6] * 4, dtype=float),\n            \"A\": np.array([0.0] * 4, dtype=float), \n            \"C\": np.array([0.0] * 4, dtype=float), \n            \"P\": np.array([0.0] * 4, dtype=float), \n            \"V\": np.array([0.0] * 4, dtype=float)\n        },\n        {\n            \"z\": np.array([0, 1000, 3000, 7000], dtype=float),\n            \"rho\": np.array([1.1, 1.0, 0.8, 0.5], dtype=float),\n            \"F\": np.array([0.02, 0.02, 0.02, 0.02], dtype=float),\n            \"du_dt\": np.array([0.0] * 4, dtype=float),\n            \"A\": np.array([0.0] * 4, dtype=float), \n            \"C\": np.array([0.0] * 4, dtype=float), \n            \"P\": np.array([0.0] * 4, dtype=float), \n            \"V\": np.array([0.0] * 4, dtype=float)\n        },\n        {\n            \"z\": np.array([0, 1000, 3000, 6000, 9000, 12000], dtype=float),\n            \"rho\": np.array([1.2, 1.1, 0.9, 0.7, 0.5, 0.35], dtype=float),\n            \"F\": np.array([-0.01, -0.005, 0.0, 0.015, 0.025, 0.03], dtype=float),\n            \"du_dt\": np.array([-4.637681159420289e-6] * 6, dtype=float),\n            \"A\": np.array([0.0] * 6, dtype=float), \n            \"C\": np.array([0.0] * 6, dtype=float), \n            \"P\": np.array([0.0] * 6, dtype=float), \n            \"V\": np.array([0.0] * 6, dtype=float)\n        },\n    ]\n\n    results = []\n    tolerance = 1e-12\n\n    for case in test_cases:\n        z, rho, F = case[\"z\"], case[\"rho\"], case[\"F\"]\n        du_dt, A, C, P, V = case[\"du_dt\"], case[\"A\"], case[\"C\"], case[\"P\"], case[\"V\"]\n\n        # Calculate total column mass M using the trapezoidal rule.\n        # M = integral(rho * dz)\n        column_mass = np.trapz(rho, z)\n        \n        # Method 1: Flux-Divergence Diagnostic\n        # a_flux = (F_bot - F_top) / M\n        F_bot = F[0]\n        F_top = F[-1]\n        a_flux = (F_bot - F_top) / column_mass\n        \n        # Method 2: Momentum Budget Residual Diagnostic\n        # a_res(z) = du/dt - A - C - P - V\n        # a_res_mean = integral(rho * a_res(z) * dz) / M\n        a_res_profile = du_dt - A - C - P - V\n        \n        # Numerator is the integrated total force on the column\n        total_residual_force = np.trapz(rho * a_res_profile, z)\n        a_res = total_residual_force / column_mass\n        \n        # Consistency Check\n        is_consistent = np.abs(a_flux - a_res) = tolerance\n        \n        # Store results for final formatting\n        results.append([a_flux, a_res, is_consistent])\n\n    # Final print statement in the exact required format.\n    # Format accelerations to 9 decimal places and boolean as True/False.\n    result_strings = []\n    for res_list in results:\n        # Format numbers to 9 decimal places, and boolean to standard string\n        str_list = [\n            f\"{res_list[0]:.9f}\",\n            f\"{res_list[1]:.9f}\",\n            str(res_list[2])\n        ]\n        result_strings.append(f\"[{','.join(str_list)}]\")\n        \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}