{
    "hands_on_practices": [
        {
            "introduction": "Turbulence closure models provide a necessary bridge between the resolved mean flow and the unresolved turbulent eddies. This practice demonstrates a foundational method for parameterizing the eddy viscosity, $K_m$, which quantifies the efficiency of turbulent mixing. By applying dimensional analysis to link $K_m$ to characteristic scales of turbulence like the turbulent kinetic energy and a mixing length, you will gain a tangible understanding of how these parameterizations are constructed and applied in practice .",
            "id": "4034408",
            "problem": "In numerical weather prediction and climate modeling, the parameterization of subgrid-scale turbulent momentum transport is commonly based on the gradient-diffusion hypothesis (also known as the Boussinesq approximation), which relates the Reynolds shear stress to mean velocity gradients through an eddy viscosity. Starting from the Reynolds-Averaged Navier–Stokes (RANS) equations, the turbulent shear stress in the vertical is written as the kinematic stress, defined by $-\\overline{u^{\\prime} w^{\\prime}}$, where $\\overline{u^{\\prime} w^{\\prime}}$ is the covariance of the horizontal and vertical velocity fluctuations. Under the gradient-diffusion hypothesis, the kinematic stress is modeled as $-\\overline{u^{\\prime} w^{\\prime}} = K_{m} \\, \\partial_{z} \\bar{u}$, where $K_{m}$ is the eddy viscosity and $\\partial_{z} \\bar{u}$ is the vertical gradient of the mean horizontal wind.\n\nUsing dimensional analysis and Prandtl’s mixing-length argument, one may relate the eddy viscosity $K_{m}$ to a mixing length $l$ and a turbulent velocity scale derived from the turbulent kinetic energy $k$, with a dimensionless closure coefficient $c_{\\mu}$ accounting for model uncertainty and anisotropy. Derive an expression for $K_{m}$ in terms of $k$, $l$, and $c_{\\mu}$, and then use it to compute the eddy viscosity and the corresponding kinematic turbulent shear stress for a neutral atmospheric boundary layer case with the following quantities:\n- turbulent kinetic energy $k = 0.5 \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}$,\n- mixing length $l = 30 \\,\\mathrm{m}$,\n- closure coefficient $c_{\\mu} = 0.1$,\n- mean vertical shear $\\partial_{z} \\bar{u} = 0.02 \\,\\mathrm{s}^{-1}$.\n\nExpress the eddy viscosity $K_{m}$ in $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$ and the kinematic turbulent shear stress $-\\overline{u^{\\prime} w^{\\prime}}$ in $\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}$. Round your numerical answers to four significant figures. Report your final answer as a two-entry row vector $\\big[K_{m},\\; -\\overline{u^{\\prime} w^{\\prime}}\\big]$.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\nThe following quantities and definitions are provided:\n- The kinematic turbulent shear stress in the vertical is defined as $-\\overline{u^{\\prime} w^{\\prime}}$.\n- The gradient-diffusion hypothesis relates the shear stress to the mean velocity gradient: $-\\overline{u^{\\prime} w^{\\prime}} = K_{m} \\, \\partial_{z} \\bar{u}$.\n- $K_{m}$ is the eddy viscosity.\n- $\\partial_{z} \\bar{u}$ is the vertical gradient of the mean horizontal wind.\n- The eddy viscosity $K_{m}$ is to be expressed in terms of the turbulent kinetic energy $k$, mixing length $l$, and a closure coefficient $c_{\\mu}$.\n- Turbulent kinetic energy: $k = 0.5 \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}$.\n- Mixing length: $l = 30 \\,\\mathrm{m}$.\n- Closure coefficient: $c_{\\mu} = 0.1$.\n- Mean vertical shear: $\\partial_{z} \\bar{u} = 0.02 \\,\\mathrm{s}^{-1}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is subjected to rigorous validation.\n- **Scientific Grounding**: The problem is built upon the Reynolds-Averaged Navier–Stokes (RANS) equations and the Boussinesq approximation for turbulent stress, which are cornerstone concepts in turbulence modeling within fluid dynamics and atmospheric science. The use of Prandtl's mixing-length theory and a turbulent kinetic energy (TKE) based velocity scale is a standard and well-established method for parameterizing eddy viscosity. The provided numerical values are physically realistic for a neutral atmospheric boundary layer.\n- **Well-Posedness**: The problem clearly asks for the derivation of an expression and subsequent calculation of two physical quantities. All necessary data and relationships are provided, ensuring that a unique and stable solution can be determined.\n- **Objectivity**: The problem is articulated using precise, technical terminology, free of any subjective or ambiguous language.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is scientifically sound, self-contained, and well-posed. The solution process may proceed.\n\n### Derivation and Calculation\nThe first step is to derive an expression for the eddy viscosity $K_{m}$ based on dimensional analysis, as instructed. The eddy viscosity, by definition, has units of kinematic viscosity, which are length squared per time, $[\\mathrm{L}]^{2} [\\mathrm{T}]^{-1}$. We are asked to construct this quantity from the turbulent kinetic energy $k$, the mixing length $l$, and a dimensionless coefficient $c_{\\mu}$.\n\nThe dimensions of the given quantities are:\n- Turbulent kinetic energy, $k$: $[k] = [\\mathrm{L}]^{2} [\\mathrm{T}]^{-2}$ (energy per unit mass, or velocity squared).\n- Mixing length, $l$: $[l] = [\\mathrm{L}]$.\n- Closure coefficient, $c_{\\mu}$: dimensionless, $[c_{\\mu}] = 1$.\n\nIn Prandtl's mixing-length theory, the eddy viscosity is parameterized as the product of a characteristic turbulent velocity scale, $v_{turb}$, and a characteristic length scale of the turbulent eddies, the mixing length $l$.\n$$\nK_{m} \\propto v_{turb} \\cdot l\n$$\nThe problem specifies that the turbulent velocity scale should be derived from the turbulent kinetic energy $k$. The TKE, $k$, is defined as half the trace of the Reynolds stress tensor, representing the mean kinetic energy of the turbulent velocity fluctuations per unit mass. It has the dimensions of velocity squared. Therefore, a natural choice for the turbulent velocity scale is the square root of $k$:\n$$\nv_{turb} \\propto \\sqrt{k}\n$$\nThe dimensions of $\\sqrt{k}$ are $(\\sqrt{[\\mathrm{L}]^{2} [\\mathrm{T}]^{-2}}) = [\\mathrm{L}] [\\mathrm{T}]^{-1}$, which are indeed the dimensions of velocity.\n\nCombining these elements, the eddy viscosity $K_{m}$ can be expressed as:\n$$\nK_{m} = c_{\\mu} \\cdot v_{turb} \\cdot l = c_{\\mu} l \\sqrt{k}\n$$\nwhere $c_{\\mu}$ is the dimensionless closure coefficient that serves as the constant of proportionality. This expression is dimensionally consistent:\n$$\n[K_{m}] = [c_{\\mu}] [l] [\\sqrt{k}] = (1) \\cdot ([\\mathrm{L}]) \\cdot ([\\mathrm{L}][\\mathrm{T}]^{-1}) = [\\mathrm{L}]^{2}[\\mathrm{T}]^{-1}\n$$\nThis matches the required dimensions for eddy viscosity.\n\nNow, we can compute the numerical value of $K_{m}$ using the provided data:\n$k = 0.5 \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}$\n$l = 30 \\,\\mathrm{m}$\n$c_{\\mu} = 0.1$\n\nSubstituting these values into the derived expression for $K_{m}$:\n$$\nK_{m} = (0.1) \\cdot (30 \\,\\mathrm{m}) \\cdot \\sqrt{0.5 \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}}\n$$\n$$\nK_{m} = 3 \\,\\mathrm{m} \\cdot \\sqrt{0.5} \\,\\mathrm{m}\\,\\mathrm{s}^{-1} = 3 \\sqrt{0.5} \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}\n$$\n$$\nK_{m} = \\frac{3}{\\sqrt{2}} \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1} \\approx 2.12132034... \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}\n$$\nRounding to four significant figures, we get:\n$$\nK_{m} \\approx 2.121 \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}\n$$\n\nNext, we compute the kinematic turbulent shear stress, $-\\overline{u^{\\prime} w^{\\prime}}$, using the gradient-diffusion hypothesis:\n$$\n-\\overline{u^{\\prime} w^{\\prime}} = K_{m} \\, \\partial_{z} \\bar{u}\n$$\nWe use the unrounded value of $K_{m}$ for this calculation to maintain precision. The given mean vertical shear is $\\partial_{z} \\bar{u} = 0.02 \\,\\mathrm{s}^{-1}$.\n$$\n-\\overline{u^{\\prime} w^{\\prime}} = (2.12132034... \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}) \\cdot (0.02 \\,\\mathrm{s}^{-1})\n$$\n$$\n-\\overline{u^{\\prime} w^{\\prime}} = 0.042426406... \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}\n$$\nThe units are $(\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}) \\cdot (\\mathrm{s}^{-1}) = \\mathrm{m}^{2}\\,\\mathrm{s}^{-2}$, which are the correct units for a kinematic stress (velocity squared).\n\nRounding this result to four significant figures:\n$$\n-\\overline{u^{\\prime} w^{\\prime}} \\approx 0.04243 \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-2}\n$$\n\nThe final answer is composed of the two calculated quantities, $K_{m}$ and $-\\overline{u^{\\prime} w^{\\prime}}$, presented as a row vector.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.121  0.04243 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The concept of eddy diffusivity is most useful when it is incorporated into the governing equations for mean quantities like temperature or tracer concentration. This exercise guides you through the crucial theoretical step of deriving the one-dimensional mean transport equation from first principles using Reynolds averaging, revealing how the turbulent flux term $\\overline{w'c'}$ arises and is closed using an eddy-diffusivity model . By then solving for the steady-state profile, you will connect the abstract derivation to a concrete, physically interpretable solution.",
            "id": "4034446",
            "problem": "Consider a one-dimensional vertical column representative of the atmospheric boundary layer in a Numerical Weather Prediction and climate modeling context, with height coordinate $z \\in [0,H]$ and horizontal homogeneity. A passive tracer with instantaneous concentration $c(\\mathbf{x},z,t)$ is transported by an incompressible flow $\\mathbf{u}(\\mathbf{x},z,t)$ under the Boussinesq approximation. Assume:\n- No internal sources or sinks of tracer, so the source term is $S=0$.\n- Molecular diffusivity is negligible compared to turbulent transport at the resolved scales.\n- The mean vertical velocity is zero, $\\overline{w}=0$, and horizontal gradients of mean quantities vanish by homogeneity.\n- Reynolds decomposition $c=\\overline{c}+c'$, $w=\\overline{w}+w'$, with an overbar denoting a horizontal (Reynolds) average and a prime denoting fluctuations, is applicable.\n- The turbulent vertical flux is represented by the gradient-diffusion (eddy-diffusivity) closure $\\overline{w'c'}=-K_c(z,t)\\,\\partial_z \\overline{c}$, where $K_c(z,t)\\ge 0$ is the eddy diffusivity of the tracer.\n\nStarting from the instantaneous passive-scalar conservation law and the above assumptions, derive the one-dimensional mean transport equation governing $\\overline{c}(z,t)$. Then, under steady conditions $\\partial_t \\overline{c}=0$ and for constant eddy diffusivity $K_c=\\text{const}$, solve for the mean steady-state profile $\\overline{c}(z)$ in the finite column $z\\in[0,H]$ subject to Dirichlet boundary conditions $\\overline{c}(0)=c_0$ and $\\overline{c}(H)=c_H$, where $c_0$ and $c_H$ are given constants. Express your final answer as a single closed-form analytic expression for $\\overline{c}(z)$ in terms of $z$, $H$, $c_0$, and $c_H$. Do not include units in your final expression.",
            "solution": "The user wants me to solve the problem statement.\n\n### Step 1: Problem Validation\n\nI will first validate the problem statement according to the specified criteria.\n\n#### Givens Extraction\n- **System**: One-dimensional vertical column, height coordinate $z \\in [0,H]$. Assumed horizontal homogeneity.\n- **Tracer**: Passive, with instantaneous concentration $c(\\mathbf{x},z,t)$.\n- **Flow**: Incompressible, $\\mathbf{u}(\\mathbf{x},z,t)$, under the Boussinesq approximation.\n- **Sources/Sinks**: Internal source term $S=0$.\n- **Diffusivity**: Molecular diffusivity is negligible.\n- **Mean Flow**: Mean vertical velocity $\\overline{w}=0$. Horizontal gradients of mean quantities vanish.\n- **Decomposition**: Reynolds decomposition is applicable: $c=\\overline{c}+c'$ and $w=\\overline{w}+w'$, where the overbar denotes a horizontal (Reynolds) average and the prime denotes fluctuations.\n- **Turbulence Closure**: The turbulent vertical flux is given by the eddy-diffusivity closure $\\overline{w'c'}=-K_c(z,t)\\,\\partial_z \\overline{c}$, where $K_c(z,t)\\ge 0$ is the eddy diffusivity.\n- **Steady-State Conditions**: For the second part of the problem, one must assume steady conditions, $\\partial_t \\overline{c}=0$, and constant eddy diffusivity, $K_c=\\text{const}$.\n- **Boundary Conditions**: Dirichlet boundary conditions $\\overline{c}(0)=c_0$ and $\\overline{c}(H)=c_H$ are imposed on the domain $z\\in[0,H]$.\n- **Objective**: Derive the one-dimensional mean transport equation for $\\overline{c}(z,t)$ and then solve for the steady-state profile $\\overline{c}(z)$.\n\n#### Validation Assessment\n- **Scientific Grounding**: The problem is well-grounded in the principles of geophysical fluid dynamics, specifically turbulence modeling in the atmospheric boundary layer. The use of Reynolds averaging, the Boussinesq approximation, and gradient-diffusion (K-theory) closure are standard techniques in this field.\n- **Well-Posedness**: The problem is well-posed. The first part is a derivation based on fundamental principles. The second part requires solving a second-order linear ordinary differential equation with two specified Dirichlet boundary conditions, which constitutes a well-posed boundary value problem that admits a unique solution.\n- **Objectivity**: The problem is stated in precise, objective, and formal mathematical language. All terms are standard within the discipline, and all assumptions are explicitly listed.\n- **Consistency and Completeness**: The problem is self-contained and internally consistent. All necessary physical assumptions, mathematical relations, and boundary conditions are provided to arrive at the desired solution.\n\n#### Verdict\nThe problem is **valid**. It is a standard, scientifically sound problem in atmospheric physics and does not violate any of the specified invalidity criteria. I will now proceed with the solution.\n\n### Step 2: Derivation and Solution\n\n#### Part 1: Derivation of the Mean Transport Equation\n\nThe conservation law for a passive tracer with concentration $c$ in an incompressible flow with velocity field $\\mathbf{u}$ is given by the advection-diffusion equation. In flux form, this is:\n$$\n\\frac{\\partial c}{\\partial t} + \\nabla \\cdot (\\mathbf{u}c) = S + \\mathcal{D}_{mol}\n$$\nwhere $S$ is the source/sink term and $\\mathcal{D}_{mol}$ represents molecular diffusion.\n\nBased on the problem statement, we apply the following assumptions:\n1.  No internal sources or sinks: $S=0$.\n2.  Molecular diffusivity is negligible compared to turbulent transport: $\\mathcal{D}_{mol} \\approx 0$.\n\nThe equation simplifies to:\n$$\n\\frac{\\partial c}{\\partial t} + \\nabla \\cdot (\\mathbf{u}c) = 0\n$$\nIn Cartesian coordinates $(x,y,z)$, with velocity components $(u,v,w)$, this is:\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial(uc)}{\\partial x} + \\frac{\\partial(vc)}{\\partial y} + \\frac{\\partial(wc)}{\\partial z} = 0\n$$\nWe now apply a horizontal Reynolds average, denoted by an overbar, to each term. The averaging operator commutes with partial derivatives:\n$$\n\\overline{\\frac{\\partial c}{\\partial t}} + \\overline{\\frac{\\partial(uc)}{\\partial x}} + \\overline{\\frac{\\partial(vc)}{\\partial y}} + \\overline{\\frac{\\partial(wc)}{\\partial z}} = 0\n$$\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} + \\frac{\\partial \\overline{uc}}{\\partial x} + \\frac{\\partial \\overline{vc}}{\\partial y} + \\frac{\\partial \\overline{wc}}{\\partial z} = 0\n$$\nThe problem states horizontal homogeneity, which implies that the average of any quantity does not vary in the horizontal directions, $x$ and $y$. Therefore, the horizontal flux divergence terms vanish:\n$$\n\\frac{\\partial \\overline{uc}}{\\partial x} = 0 \\quad \\text{and} \\quad \\frac{\\partial \\overline{vc}}{\\partial y} = 0\n$$\nThe averaged equation simplifies to a one-dimensional form in the vertical coordinate $z$:\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} + \\frac{\\partial \\overline{wc}}{\\partial z} = 0\n$$\nNext, we apply the Reynolds decomposition to the quantities $w$ and $c$: $w = \\overline{w} + w'$ and $c = \\overline{c} + c'$. The term $\\overline{wc}$ becomes:\n$$\n\\overline{wc} = \\overline{(\\overline{w} + w')(\\overline{c} + c')} = \\overline{\\overline{w}\\overline{c} + \\overline{w}c' + w'\\overline{c} + w'c'}\n$$\nUsing the properties of Reynolds averaging (e.g., $\\overline{A'} = 0$ and $\\overline{\\overline{A}B} = \\overline{A}\\overline{B}$), we get:\n$$\n\\overline{wc} = \\overline{w}\\overline{c} + \\overline{\\overline{w}c'} + \\overline{w'\\overline{c}} + \\overline{w'c'} = \\overline{w}\\overline{c} + \\overline{w}\\overline{c'} + \\overline{c}\\overline{w'} + \\overline{w'c'} = \\overline{w}\\overline{c} + \\overline{w'c'}\n$$\nThe mean transport equation is now:\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} + \\frac{\\partial}{\\partial z}(\\overline{w}\\overline{c} + \\overline{w'c'}) = 0\n$$\nWe are given that the mean vertical velocity is zero, $\\overline{w}=0$. This simplifies the equation further:\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} + \\frac{\\partial (\\overline{w'c'})}{\\partial z} = 0\n$$\nThis equation states that the time rate of change of the mean concentration is balanced by the vertical divergence of the turbulent tracer flux, $\\overline{w'c'}$. To close the system, we use the provided eddy-diffusivity (K-theory) closure:\n$$\n\\overline{w'c'} = -K_c(z,t) \\frac{\\partial \\overline{c}}{\\partial z}\n$$\nSubstituting this closure into the mean transport equation yields the final one-dimensional equation for $\\overline{c}(z,t)$:\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} - \\frac{\\partial}{\\partial z}\\left(K_c(z,t) \\frac{\\partial \\overline{c}}{\\partial z}\\right) = 0\n$$\nThis is a one-dimensional, parabolic partial differential equation of the diffusion type.\n\n#### Part 2: Solution for the Steady-State Profile\n\nWe are asked to solve for the mean steady-state profile $\\overline{c}(z)$ under two additional conditions:\n1.  Steady conditions: $\\partial_t \\overline{c} = 0$.\n2.  Constant eddy diffusivity: $K_c=\\text{const}$.\n\nUnder steady conditions, the mean transport equation becomes:\n$$\n-\\frac{d}{dz}\\left(K_c \\frac{d \\overline{c}}{dz}\\right) = 0\n$$\nNote the use of ordinary derivatives as $\\overline{c}$ now depends only on $z$. Since $K_c$ is a non-zero constant, we can divide by it to obtain:\n$$\n\\frac{d}{dz}\\left(\\frac{d \\overline{c}}{dz}\\right) = 0 \\quad \\implies \\quad \\frac{d^2\\overline{c}}{dz^2} = 0\n$$\nThis is a simple second-order ordinary differential equation. We find the general solution by integrating twice with respect to $z$:\nFirst integration:\n$$\n\\frac{d\\overline{c}}{dz} = C_1\n$$\nSecond integration:\n$$\n\\overline{c}(z) = C_1 z + C_2\n$$\nwhere $C_1$ and $C_2$ are constants of integration determined by the boundary conditions. The boundary conditions are given as:\n- At $z=0$: $\\overline{c}(0) = c_0$\n- At $z=H$: $\\overline{c}(H) = c_H$\n\nApplying the first boundary condition at $z=0$:\n$$\n\\overline{c}(0) = C_1(0) + C_2 = c_0 \\quad \\implies \\quad C_2 = c_0\n$$\nApplying the second boundary condition at $z=H$:\n$$\n\\overline{c}(H) = C_1 H + C_2 = c_H\n$$\nSubstituting the value of $C_2=c_0$ into this equation:\n$$\nC_1 H + c_0 = c_H\n$$\nSolving for $C_1$:\n$$\nC_1 = \\frac{c_H - c_0}{H}\n$$\nFinally, we substitute the expressions for the constants $C_1$ and $C_2$ back into the general solution $\\overline{c}(z) = C_1 z + C_2$:\n$$\n\\overline{c}(z) = \\left(\\frac{c_H - c_0}{H}\\right)z + c_0\n$$\nThis expression represents a linear profile of the mean tracer concentration with height. We can rearrange it into a form that clearly shows a weighted average of the boundary values:\n$$\n\\overline{c}(z) = c_0 + (c_H - c_0)\\frac{z}{H} = c_0\\left(1 - \\frac{z}{H}\\right) + c_H\\frac{z}{H}\n$$\nThis is the final analytical expression for the steady-state mean concentration profile.",
            "answer": "$$\n\\boxed{c_0\\left(1 - \\frac{z}{H}\\right) + c_H\\frac{z}{H}}\n$$"
        },
        {
            "introduction": "The final step in applying our physical understanding is to translate the continuous diffusion equation into a robust algorithm that a computer can solve. This advanced practice addresses the numerical implementation of a vertical diffusion scheme, a core component of all atmospheric models, focusing on the critical details of ensuring conservation on a non-uniform grid with variable diffusivity . Successfully implementing this finite-volume scheme and its solver provides deep insight into the practical challenges and solutions used in modern numerical weather prediction and climate modeling.",
            "id": "4034469",
            "problem": "Consider a one-dimensional vertical column discretized into $N$ finite-volume cells with cell thicknesses $\\Delta z_i$ for $i \\in \\{1,\\dots,N\\}$. Let $z$ denote the vertical coordinate in meters. A passive scalar $q(z,t)$ (for example, potential temperature in Kelvin) evolves under vertical turbulent diffusion characterized by a variable eddy diffusivity $K(z)$ in meters squared per second. Starting from conservation of the scalar and Fick's law of diffusion, the governing equation is the parabolic partial differential equation\n$$\n\\frac{\\partial q}{\\partial t} = \\frac{\\partial}{\\partial z}\\left( K(z) \\frac{\\partial q}{\\partial z} \\right).\n$$\nAssume piecewise constant $K$ per cell, zero-flux (Neumann) boundary conditions at the top and bottom boundaries, and backward Euler time discretization. Your task is to derive, from first principles and without using any pre-provided shortcut formulas, a conservative finite-volume implicit scheme on a non-uniform grid that:\n- Enforces discrete flux continuity at cell interfaces so that the diffusive flux crossing each interior face is uniquely defined and continuous.\n- Assembles a tridiagonal linear system for the unknown cell-centered values $q_i^{n+1}$ at the new time level $t^{n+1}$ given known values $q_i^n$ at time $t^n$.\n- Solves the tridiagonal system using an in-place Thomas algorithm (tri-diagonal matrix algorithm).\n\nThe derivation must begin from the conservation statement over a control volume and Fick's law. The discrete interface treatment must follow from matching fluxes from the left and right sides of each interior face, leading to an expression for a unique face flux consistent with piecewise constant $K$ in adjacent cells. After deriving the scheme, implement it as a complete, runnable program that constructs the tridiagonal matrix coefficients and solves for $q^{n+1}$.\n\nTo demonstrate correctness and conservation, for each provided test case, compute:\n- The relative change of the column-integrated scalar between the old and new time levels, defined as\n$$\nR = \\frac{\\sum_{i=1}^{N} q_i^{n+1} \\Delta z_i - \\sum_{i=1}^{N} q_i^n \\Delta z_i}{\\sum_{i=1}^{N} q_i^n \\Delta z_i},\n$$\nwhich is dimensionless and must be reported as a decimal.\n- The maximum absolute discrete flux continuity residual across all interior faces at the new time level, defined as\n$$\n\\max_{i \\in \\{1,\\dots,N-1\\}} \\left| F_{i+\\frac{1}{2}, \\text{left}}^{n+1} - F_{i+\\frac{1}{2}, \\text{right}}^{n+1} \\right|,\n$$\nwith each face flux computed from the adjacent cell-centered values by enforcing continuity at the interface. This residual must be expressed in Kelvin·meters per second if $q$ is in Kelvin and reported in those units. You must use zero-flux (Neumann) boundary conditions at the top and bottom in all tests.\n\nYour program must implement the solver and output, for each test case, a two-element list containing $[R, \\text{max\\_residual}]$, and aggregate the results of all test cases into a single line.\n\nTest Suite:\nUse the following scientifically realistic and self-consistent parameter sets. In all cases, $z$ is in meters, $K$ is in meters squared per second, and $\\Delta t$ is in seconds. The scalar $q$ is in Kelvin. Angle units are not involved.\n\n- Test Case $1$ (happy path, non-uniform grid and strongly varying eddy diffusivity):\n    - $N = 6$\n    - $\\Delta z = [20, 30, 50, 100, 200, 300]\\,\\mathrm{m}$\n    - $K = [0.1, 0.5, 2.0, 0.8, 0.2, 0.1]\\,\\mathrm{m}^2/\\mathrm{s}$\n    - $\\Delta t = 600\\,\\mathrm{s}$\n    - $q^n = [10, 8, 6, 5, 4, 3]\\,\\mathrm{K}$\n\n- Test Case $2$ (uniform grid and weak diffusivity with small time step):\n    - $N = 10$\n    - $\\Delta z = [100, 100, 100, 100, 100, 100, 100, 100, 100, 100]\\,\\mathrm{m}$\n    - $K = [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01]\\,\\mathrm{m}^2/\\mathrm{s}$\n    - $\\Delta t = 1\\,\\mathrm{s}$\n    - $q^n = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\\,\\mathrm{K}$\n\n- Test Case $3$ (edge case with very thin end cells and zero eddy diffusivity at boundaries):\n    - $N = 4$\n    - $\\Delta z = [1, 1000, 1000, 1]\\,\\mathrm{m}$\n    - $K = [0.0, 1.0, 0.1, 0.0]\\,\\mathrm{m}^2/\\mathrm{s}$\n    - $\\Delta t = 100\\,\\mathrm{s}$\n    - $q^n = [0, 10, 0, 10]\\,\\mathrm{K}$\n\n- Test Case $4$ (alternating high-low eddy diffusivity to test interface treatment robustness):\n    - $N = 5$\n    - $\\Delta z = [50, 50, 50, 50, 50]\\,\\mathrm{m}$\n    - $K = [0.01, 10.0, 0.01, 10.0, 0.01]\\,\\mathrm{m}^2/\\mathrm{s}$\n    - $\\Delta t = 300\\,\\mathrm{s}$\n    - $q^n = [1, 0, 1, 0, 1]\\,\\mathrm{K}$\n\nFinal Output Format:\nYour program should produce a single line of output containing the results for the four test cases as a comma-separated list of per-case two-element lists, with no spaces, enclosed in square brackets. For example, the output must look like\n$$\n\\texttt{[[R_1,\\text{max\\_residual}_1],[R_2,\\text{max\\_residual}_2],[R_3,\\text{max\\_residual}_3],[R_4,\\text{max\\_residual}_4]]}\n$$\nwhere each $R_i$ is the dimensionless decimal relative change, and each $\\text{max\\_residual}_i$ is the maximum absolute flux continuity residual in Kelvin·meters per second.",
            "solution": "We begin from the conservation of a scalar quantity $q$ over a finite-volume control volume. Integrating the governing equation\n$$\n\\frac{\\partial q}{\\partial t} = \\frac{\\partial}{\\partial z}\\left( K(z) \\frac{\\partial q}{\\partial z} \\right)\n$$\nover a cell $i$ bounded by faces at $z_{i-\\frac{1}{2}}$ and $z_{i+\\frac{1}{2}}$, with thickness $\\Delta z_i = z_{i+\\frac{1}{2}} - z_{i-\\frac{1}{2}}$, and applying the divergence theorem yields\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\left( q_i \\Delta z_i \\right) = F_{i-\\frac{1}{2}} - F_{i+\\frac{1}{2}},\n$$\nwhere $q_i$ denotes the cell-averaged value and $F_{i\\pm\\frac{1}{2}}$ is the diffusive flux through the respective face. Under backward Euler time discretization from $t^n$ to $t^{n+1}$ with time step $\\Delta t$, this becomes\n$$\n\\frac{q_i^{n+1} - q_i^n}{\\Delta t} = \\frac{F_{i-\\frac{1}{2}}^{n+1} - F_{i+\\frac{1}{2}}^{n+1}}{\\Delta z_i}.\n$$\nFick's law gives the instantaneous diffusive flux at a face\n$$\nF = -K \\frac{\\partial q}{\\partial z}.\n$$\nOn a nonuniform grid with piecewise constant eddy diffusivity per cell, the gradient at an interior face must be approximated in a way that enforces flux continuity across the interface, consistent with conservation. Consider the interface between cells $i$ and $i+1$. Let $d_\\text{R} = \\frac{\\Delta z_i}{2}$ denote the distance from the center of cell $i$ to the interface, and $d_\\text{L} = \\frac{\\Delta z_{i+1}}{2}$ denote the distance from the center of cell $i+1$ to the interface. Let $q_f$ denote the interface value of $q$ at $z_{i+\\frac{1}{2}}$ at time $t^{n+1}$. The left and right flux expressions are\n$$\nF_{i+\\frac{1}{2}, \\text{left}}^{n+1} = -K_i \\frac{q_f - q_i^{n+1}}{d_\\text{R}}, \\quad\nF_{i+\\frac{1}{2}, \\text{right}}^{n+1} = -K_{i+1} \\frac{q_{i+1}^{n+1} - q_f}{d_\\text{L}}.\n$$\nFlux continuity at the interface requires\n$$\nF_{i+\\frac{1}{2}, \\text{left}}^{n+1} = F_{i+\\frac{1}{2}, \\text{right}}^{n+1}.\n$$\nSolving for the interface value $q_f$ yields\n$$\nq_f = \\frac{\\left( \\frac{K_i}{d_\\text{R}} \\right) q_i^{n+1} + \\left( \\frac{K_{i+1}}{d_\\text{L}} \\right) q_{i+1}^{n+1}}{\\left( \\frac{K_i}{d_\\text{R}} \\right) + \\left( \\frac{K_{i+1}}{d_\\text{L}} \\right)}.\n$$\nInserting this $q_f$ into either flux expression yields a unique, continuous interface flux. By algebraic manipulation using the concept of resistances in series, one may express the same flux equivalently as\n$$\nF_{i+\\frac{1}{2}}^{n+1} = -K_{i+\\frac{1}{2}} \\frac{q_{i+1}^{n+1} - q_i^{n+1}}{d_\\text{R} + d_\\text{L}},\n$$\nwhere the effective face eddy diffusivity $K_{i+\\frac{1}{2}}$ is given by the weighted harmonic average\n$$\nK_{i+\\frac{1}{2}} = \\frac{d_\\text{R} + d_\\text{L}}{\\frac{d_\\text{R}}{K_i} + \\frac{d_\\text{L}}{K_{i+1}}}.\n$$\nIf either $K_i$ or $K_{i+1}$ is zero (or extremely small), the denominator becomes large (or infinite), and the effective $K_{i+\\frac{1}{2}}$ tends to zero, correctly reducing the interface flux.\n\nSubstituting the face fluxes into the backward Euler conservation equation for cell $i$ gives\n$$\n\\frac{q_i^{n+1} - q_i^n}{\\Delta t} = \\frac{-K_{i-\\frac{1}{2}} \\frac{q_i^{n+1} - q_{i-1}^{n+1}}{d_\\text{L}^{(i)} + d_\\text{R}^{(i-1)}} + K_{i+\\frac{1}{2}} \\frac{q_{i+1}^{n+1} - q_i^{n+1}}{d_\\text{R}^{(i)} + d_\\text{L}^{(i+1)}}}{\\Delta z_i},\n$$\nwhere $d_\\text{L}^{(i)} = \\frac{\\Delta z_i}{2}$ and $d_\\text{R}^{(i)} = \\frac{\\Delta z_i}{2}$ denote the left and right half-thicknesses for cell $i$. Rearranging terms, we obtain the tridiagonal system of the form\n$$\na_i q_{i-1}^{n+1} + b_i q_i^{n+1} + c_i q_{i+1}^{n+1} = q_i^n,\n$$\nwith coefficients\n$$\na_i = -\\frac{\\Delta t}{\\Delta z_i} \\frac{K_{i-\\frac{1}{2}}}{\\frac{\\Delta z_i}{2} + \\frac{\\Delta z_{i-1}}{2}}, \\quad\nc_i = -\\frac{\\Delta t}{\\Delta z_i} \\frac{K_{i+\\frac{1}{2}}}{\\frac{\\Delta z_i}{2} + \\frac{\\Delta z_{i+1}}{2}},\n$$\n$$\nb_i = 1 - a_i - c_i = 1 + \\frac{\\Delta t}{\\Delta z_i}\\left( \\frac{K_{i-\\frac{1}{2}}}{\\frac{\\Delta z_i}{2} + \\frac{\\Delta z_{i-1}}{2}} + \\frac{K_{i+\\frac{1}{2}}}{\\frac{\\Delta z_i}{2} + \\frac{\\Delta z_{i+1}}{2}} \\right).\n$$\nZero-flux boundaries at the bottom and top imply $F_{1-\\frac{1}{2}}^{n+1} = 0$ and $F_{N+\\frac{1}{2}}^{n+1} = 0$, which remove the coupling to ghost cells and reduce the first and last rows to\n$$\nb_1 q_1^{n+1} + c_1 q_2^{n+1} = q_1^n, \\quad\na_N q_{N-1}^{n+1} + b_N q_N^{n+1} = q_N^n,\n$$\nwith $a_1 = 0$ and $c_N = 0$. The assembled matrix is strictly diagonally dominant for nonnegative $K$ and $\\Delta t  0$, guaranteeing a unique solution. The resulting linear system is tridiagonal and can be solved efficiently using the Thomas algorithm:\n- Forward elimination: modify the upper diagonal and right-hand side to eliminate the lower diagonal.\n- Back substitution: recover the solution vector $q^{n+1}$.\n\nConservation follows from the telescoping property of the flux differences: summing the discretized conservation equations over all cells yields\n$$\n\\sum_{i=1}^{N} \\frac{q_i^{n+1} - q_i^n}{\\Delta t} \\Delta z_i = \\sum_{i=1}^{N} \\left(F_{i-\\frac{1}{2}}^{n+1} - F_{i+\\frac{1}{2}}^{n+1}\\right) = F_{1-\\frac{1}{2}}^{n+1} - F_{N+\\frac{1}{2}}^{n+1} = 0,\n$$\nbecause of the zero-flux boundary conditions. Hence the column-integrated scalar is conserved, and the relative change $R$ should be near zero up to numerical round-off.\n\nTo quantify interface flux continuity after solving, compute for each interior face $i+\\frac{1}{2}$ the interface value $q_f$ using\n$$\nq_f = \\frac{\\left( \\frac{K_i}{\\frac{\\Delta z_i}{2}} \\right) q_i^{n+1} + \\left( \\frac{K_{i+1}}{\\frac{\\Delta z_{i+1}}{2}} \\right) q_{i+1}^{n+1}}{\\left( \\frac{K_i}{\\frac{\\Delta z_i}{2}} \\right) + \\left( \\frac{K_{i+1}}{\\frac{\\Delta z_{i+1}}{2}} \\right)},\n$$\nthen evaluate\n$$\nF_{i+\\frac{1}{2}, \\text{left}}^{n+1} = -K_i \\frac{q_f - q_i^{n+1}}{\\frac{\\Delta z_i}{2}}, \\quad\nF_{i+\\frac{1}{2}, \\text{right}}^{n+1} = -K_{i+1} \\frac{q_{i+1}^{n+1} - q_f}{\\frac{\\Delta z_{i+1}}{2}}.\n$$\nBy construction these fluxes match exactly in exact arithmetic; therefore the maximum absolute residual over all interior faces,\n$$\n\\max_{i \\in \\{1,\\dots,N-1\\}} \\left| F_{i+\\frac{1}{2}, \\text{left}}^{n+1} - F_{i+\\frac{1}{2}, \\text{right}}^{n+1} \\right|,\n$$\nshould be near machine precision (effectively zero) in Kelvin·meters per second, with special handling when either adjacent $K$ equals zero, in which case the residual is defined to be zero.\n\nAlgorithmic steps for implementation:\n- For each interior interface, compute $K_{i+\\frac{1}{2}}$ via the weighted harmonic average using half-cell distances.\n- Assemble $a_i$, $b_i$, and $c_i$ according to the implicit finite-volume discretization with zero-flux boundaries.\n- Solve the tridiagonal system using the Thomas algorithm to obtain $q^{n+1}$.\n- Compute $R$ using the column integrals at $t^n$ and $t^{n+1}$.\n- Compute the maximum flux continuity residual using the interface $q_f$ reconstruction.\n- Report per-test-case results as $[R, \\text{max\\_residual}]$ in the specified single-line output format.\n\nThis design integrates the underlying physical principles (conservation and Fick's law) with a robust numerical discretization that ensures conservation and respects interface physics through flux continuity.",
            "answer": "$$\n\\texttt{[[-2.220446049250e-16,8.881784197001e-16],[-2.422839953331e-16,0.000000000000e+00],[0.000000000000e+00,0.000000000000e+00],[1.776356839400e-15,4.440892098501e-16]]}\n$$"
        }
    ]
}