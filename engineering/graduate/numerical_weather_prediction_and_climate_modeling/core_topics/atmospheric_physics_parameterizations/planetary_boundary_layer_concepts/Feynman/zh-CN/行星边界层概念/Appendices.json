{
    "hands_on_practices": [
        {
            "introduction": "此练习将可直接观测的地表湍流脉动通量与莫宁-奥布霍夫相似性理论（Monin-Obukhov Similarity Theory, MOST）中的基本尺度参数联系起来。通过计算摩擦速度 $u_*$、特征温度尺度 $\\theta_*$ 和奥布霍夫长度 $L$，您将学习如何表征近地层的稳定性并预测垂直梯度。这是解读微气象数据和在模式中参数化地表过程的一项核心技能 。",
            "id": "4075668",
            "problem": "在平坦地形上，一个水平均一、稳定的白天近地表层通过位于 $z=\\;10\\,\\mathrm{m}$ 高度的涡动相关系统进行观测。测得的湍流地表应力大小为 $\\tau=\\;0.30\\,\\mathrm{N}\\,\\mathrm{m}^{-2}$，空气密度为 $\\rho=\\;1.20\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，运动感热通量为 $w'\\theta'=\\;0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，运动水汽通量（以比湿 $q$ 表示）为 $w'q'=\\;1.0\\times 10^{-5}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。测量高度处的平均位温和比湿分别为 $\\bar{\\theta}=\\;300\\,\\mathrm{K}$ 和 $\\bar{q}=\\;0.010$。取 von Kármán 常数 $\\kappa=\\;0.40$，重力加速度 $g=\\;9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$。假设空气为干空气，液态水含量可忽略不计，并用 $\\bar{\\theta}_{v}\\approx \\bar{\\theta}\\left(1+0.61\\,\\bar{q}\\right)$ 和 $w'\\theta_{v}'\\approx w'\\theta'+0.61\\,\\bar{\\theta}\\,w'q'$ 来近似虚位温及其运动通量。\n\n使用 Monin–Obukhov 相似性理论 (MOST)，从第一性原理出发：\n- 从 $\\tau=\\rho\\,u_{*}^{2}$ 计算摩擦速度 $u_{*}$，\n- 从测得的运动通量计算温度和湿度特征尺度 $\\theta_{*}$ 和 $q_{*}$，\n- 从包含 $u_{*}$ 和 $w'\\theta_{v}'$ 的定义推导出 Obukhov 长度 $L$，\n- 使用通量-梯度关系预测 $z=\\;5\\,\\mathrm{m}$ 高度处的局地位温梯度。\n\n对于稳定度函数，采用经过充分检验的 Businger–Dyer 形式：对于不稳定层结，$\\phi_{h}(\\zeta)=\\left(1-16\\,\\zeta\\right)^{-1/2}$；对于稳定层结，$\\phi_{h}(\\zeta)=1+5\\,\\zeta$，其中 $\\zeta=z/L$。\n\n只需报告 $z=\\;5\\,\\mathrm{m}$ 处预测的局地位温梯度 $\\mathrm{d}\\theta/\\mathrm{d}z$。答案保留三位有效数字。最终梯度以 $\\mathrm{K}\\,\\mathrm{m}^{-1}$ 为单位表示。",
            "solution": "问题陈述经核实具有科学依据、适定、客观且自洽。它展示了 Monin-Obukhov 相似性理论 (MOST) 的一个标准应用，使用了真实的物理参数和已建立的经验公式。唯一解所需的所有数据和定义均已提供。因此，我将开始解答。\n\n本题要求计算白天大气近地表层中 $z=5\\,\\mathrm{m}$ 高度处的局地位温梯度 $\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z}$。求解过程包括几个步骤，从给定的 $z=10\\,\\mathrm{m}$ 处的测量值开始。在近地表层内，假定湍流通量和 MOST 标度参数（$u_{*}$、$\\theta_{*}$、$L$）不随高度变化。\n\n首先，根据湍流地表应力大小 $\\tau$ 和空气密度 $\\rho$，使用定义 $\\tau = \\rho u_{*}^{2}$ 计算摩擦速度 $u_{*}$。\n$$u_{*} = \\sqrt{\\frac{\\tau}{\\rho}}$$\n代入给定值 $\\tau = 0.30\\,\\mathrm{N}\\,\\mathrm{m}^{-2}$ 和 $\\rho = 1.20\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$：\n$$u_{*} = \\sqrt{\\frac{0.30}{1.20}} \\,\\mathrm{m}\\,\\mathrm{s}^{-1} = \\sqrt{0.25} \\,\\mathrm{m}\\,\\mathrm{s}^{-1} = 0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\n\n第二，根据温度特征尺度 $\\theta_{*}$ 和湿度特征尺度 $q_{*}$ 与运动通量的关系来确定它们。一个标量的通量与其特征尺度和摩擦速度的关系为 $(w's')_s = -u_{*} s_{*}$，其中 $s$ 是标量，下标 $s$ 表示地表值。假设在 $z=10\\,\\mathrm{m}$ 处测得的通量代表地表通量：\n$$\\theta_{*} = -\\frac{w'\\theta'}{u_{*}}$$\n$$q_{*} = -\\frac{w'q'}{u_{*}}$$\n使用测得的运动感热通量 $w'\\theta' = 0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ 和计算出的 $u_{*} = 0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$：\n$$\\theta_{*} = -\\frac{0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} = -0.24\\,\\mathrm{K}$$\n使用测得的运动水汽通量 $w'q' = 1.0 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$：\n$$q_{*} = -\\frac{1.0 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} = -2.0 \\times 10^{-5}$$\n\n第三，我们推导 Obukhov 长度 $L$，它表征了近地表层的稳定度。其定义为：\n$$L = - \\frac{u_{*}^3}{\\kappa \\frac{g}{\\bar{\\theta}_v} w'\\theta_{v}'}$$\n为了使用这个公式，我们首先需要计算运动虚位温通量 $w'\\theta_{v}'$ 和一个参考虚位温 $\\bar{\\theta}_v$。题目中提供了近似式 $w'\\theta_{v}' \\approx w'\\theta' + 0.61\\,\\bar{\\theta}\\,w'q'$。\n使用 $\\bar{\\theta}=300\\,\\mathrm{K}$，$w'\\theta' = 0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ 和 $w'q' = 1.0 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$：\n$$w'\\theta_{v}' \\approx 0.12 + 0.61 \\times 300 \\times (1.0 \\times 10^{-5}) = 0.12 + 0.00183 = 0.12183\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\n$w'\\theta_{v}'$ 的正号表示湍流的浮力生成，这是不稳定（对流）层的特征。\n参考虚位温 $\\bar{\\theta}_v$ 通过 $\\bar{\\theta}_{v} \\approx \\bar{\\theta}(1+0.61\\,\\bar{q})$ 近似计算。使用 $\\bar{\\theta}=300\\,\\mathrm{K}$ 和 $\\bar{q}=0.010$：\n$$\\bar{\\theta}_{v} \\approx 300(1 + 0.61 \\times 0.010) = 300(1.0061) = 301.83\\,\\mathrm{K}$$\n现在，我们可以使用 $u_{*} = 0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，$\\kappa=0.40$ 和 $g=9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$ 来计算 $L$：\n$$L = - \\frac{(0.50)^3}{0.40 \\times \\frac{9.81}{301.83} \\times 0.12183} = - \\frac{0.125}{0.40 \\times (0.03250\\,\\mathrm{K}^{-1}) \\times 0.12183\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} \\approx -78.92\\,\\mathrm{m}$$\n$L$ 的负值证实了层结是不稳定的。\n\n第四，我们使用位温的通量-梯度关系来求出指定高度 $z=5\\,\\mathrm{m}$ 处的局地梯度。该关系由下式给出：\n$$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z} = \\frac{\\theta_{*}}{\\kappa z} \\phi_{h}(\\zeta)$$\n其中 $\\phi_h$ 是无量纲热量稳定度函数，$\\zeta = z/L$ 是稳定度参数。在 $z=5\\,\\mathrm{m}$ 处：\n$$\\zeta = \\frac{5\\,\\mathrm{m}}{-78.92\\,\\mathrm{m}} \\approx -0.06335$$\n由于 $\\zeta  0$，我们使用适用于不稳定条件的 Businger-Dyer 形式：$\\phi_{h}(\\zeta) = (1 - 16\\zeta)^{-1/2}$。\n$$\\phi_{h}(-0.06335) = (1 - 16 \\times (-0.06335))^{-1/2} = (1 + 1.0136)^{-1/2} = (2.0136)^{-1/2} \\approx 0.7047$$\n最后，我们将所有计算出的值代入梯度方程：\n$$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z} = \\frac{-0.24\\,\\mathrm{K}}{0.40 \\times 5\\,\\mathrm{m}} \\times 0.7047 = \\frac{-0.24\\,\\mathrm{K}}{2.0\\,\\mathrm{m}} \\times 0.7047 = -0.12\\,\\mathrm{K}\\,\\mathrm{m}^{-1} \\times 0.7047$$\n$$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z} \\approx -0.08456\\,\\mathrm{K}\\,\\mathrm{m}^{-1}$$\n将结果四舍五入到三位有效数字，我们得到 $-0.0846\\,\\mathrm{K}\\,\\mathrm{m}^{-1}$。",
            "answer": "$$\\boxed{-0.0846}$$"
        },
        {
            "introduction": "从近地层向上扩展到整个行星边界层，本练习旨在探索日间对流边界层（Convective Boundary Layer, CBL）的宏观结构。您将应用第一性原理的能量平衡论证来估算对流边界层的高度，通过平衡地表加热产生的湍流动能（Turbulent Kinetic Energy, TKE）与夹卷自由对流层稳定气团所需的功。这项实践有助于建立关于日间边界层发展主要控制因素的物理直觉 。",
            "id": "4075704",
            "problem": "一个水平均匀、干燥的白天对流边界层（CBL）在陆地上形成，其垂直风切变可忽略不计，无大尺度下沉运动，并有一个陡峭的逆温盖。逆温层下方的空气在位温上近似均匀混合。逆温层上方，背景层结近似均匀，其布伦特-维萨拉频率的平方（静力稳定度）由 $N^{2}$ 给出。地表感热通量在空间上均匀且稳定，其协方差为 $w^{\\prime}\\theta^{\\prime}_{0}$。令 $g$ 表示重力加速度，$\\theta_{0}$ 表示一个有代表性的参考位温。\n\n从适用于行星边界层的数值天气预报和气候模拟的第一性原理出发，使用夹卷通量能量学论证，通过平衡由地表浮力强迫产生的湍流动能与夹卷空气穿过以 $N^{2}$ 为特征的稳定层结逆温盖所需的功，来获得对流边界层高度 $h$ 的量级估计。你的推導应明确指出地表的浮力通量以及与 $N^{2}$ 相关的势能垒，并通过一致的标度律分析进行，不要引入无根据的经验参数。\n\n将以下数值视为已知：\n- 重力加速度 $g = 9.81\\,\\mathrm{m\\,s^{-2}}$，\n- 参考位温 $\\theta_{0} = 300\\,\\mathrm{K}$，\n- 地表感熱通量协方差 $w^{\\prime}\\theta^{\\prime}_{0} = 0.28\\,\\mathrm{K\\,m\\,s^{-1}}$，\n- 自由对流层静力稳定度 $N^{2} = 3.0\\times 10^{-6}\\,\\mathrm{s^{-2}}$。\n\n计算得出的边界层高度 $h$，结果为一个实数。你的最终答案以米为单位，并四舍五入到三位有效数字。",
            "solution": "本题要求基于第一性原理，通过能量平衡论证来估算对流边界层的高度 $h$。其核心思想是，驱动湍流的能量来源与消耗湍流的能量（用于夹卷稳定空气）之间达到平衡。\n\n1.  **湍流能量来源**：在纯对流的边界层中，湍流的主要能量来源是地表的浮力通量，其定义为 $B_s = \\frac{g}{\\theta_0} (w'\\theta')_s$。这个浮力通量驱动了整个边界层的湍流运动。\n\n2.  **特征速度与频率尺度**：这些湍流运动的特征速度尺度是对流速度尺度 $w_*$，其定义为 $w_*^3 = B_s h$。这些遍布整个边界层的大涡旋的特征翻转频率（或周转频率）可以标度为 $w_*/h$。\n\n3.  **能量消耗与稳定频率**：湍流能量的一个主要汇（消耗项）是用于克服边界层顶部的稳定层结所做的功。当湍流涡旋冲击上方的稳定逆温层时，它们会激发重力内波。这个稳定层的特征振荡频率是布伦特-维萨拉频率 $N$。\n\n4.  **建立平衡**：一个物理上合理的标度论证是，当对流边界层达到一种准平衡状态时，其内部湍流涡旋的翻转频率 $w_*/h$ 应该与它所冲击的稳定层的自然频率 $N$ 相当。\n    $$ \\frac{w_*}{h} \\sim N $$\n    将 $w_* = (B_s h)^{1/3}$ 代入：\n    $$ \\frac{(B_s h)^{1/3}}{h} \\sim N $$\n    整理此式以求解 $h$：\n    $$ B_s^{1/3} h^{-2/3} \\sim N $$\n    $$ B_s^{1/3} \\sim N h^{2/3} $$\n    $$ B_s \\sim (N h^{2/3})^3 = N^3 h^2 $$\n    $$ h^2 \\sim \\frac{B_s}{N^3} $$\n    因此，我们得到边界层高度的标度关系：\n    $$ h \\sim \\frac{\\sqrt{B_s}}{N^{3/2}} $$\n    在这个量级估计中，我们假设比例常数为1。\n\n5.  **数值计算**：\n    - 首先，计算地表浮力通量 $B_s$：\n      $$ B_s = \\frac{g}{\\theta_0} (w'\\theta')_0 = \\frac{9.81\\,\\mathrm{m\\,s^{-2}}}{300\\,\\mathrm{K}} \\times 0.28\\,\\mathrm{K\\,m\\,s^{-1}} = 0.009156\\,\\mathrm{m^2\\,s^{-3}} $$\n    - 其次，计算稳定度项 $N^{3/2}$：\n      $$ N^{3/2} = (N^2)^{3/4} = (3.0 \\times 10^{-6}\\,\\mathrm{s^{-2}})^{3/4} \\approx 7.209 \\times 10^{-5}\\,\\mathrm{s^{-3/2}} $$\n    - 最后，计算 $h$：\n      $$ h = \\frac{\\sqrt{B_s}}{N^{3/2}} = \\frac{\\sqrt{0.009156\\,\\mathrm{m^2\\,s^{-3}}}}{7.209 \\times 10^{-5}\\,\\mathrm{s^{-3/2}}} = \\frac{0.095687\\,\\mathrm{m\\,s^{-3/2}}}{7.209 \\times 10^{-5}\\,\\mathrm{s^{-3/2}}} \\approx 1327.3\\,\\mathrm{m} $$\n\n6.  **四舍五入**：将结果四舍五入到三位有效数字，得到 $h = 1330\\,\\mathrm{m}$。",
            "answer": "$$\n\\boxed{1330}\n$$"
        },
        {
            "introduction": "与浮力驱动的日间边界层不同，稳定边界层（Stable Boundary Layer, SBL）的演变受控于风切变产生的湍流与浮力抑制作用之间的精细平衡。这个实践性的编程练习将引入整体理查森数（bulk Richardson number, $Ri_b$），这是一个在数值模式中用于诊断稳定边界层高度的关键无量纲参数。通过实施该方法，您将亲身体验一种广泛用于确定稳定条件下湍流层顶高度的技术 。",
            "id": "4075671",
            "problem": "给定稳定层结条件下的高度、虚位温和水平风的垂直廓线。您的任务是通过识别整体理查森数达到或超过指定临界阈值的最低模式层来确定行星边界层高度。您的程序必须以基于基本原理的方式实现该方法，而不是使用现成的快捷公式。\n\n从以下基本定义和经过充分检验的事实开始：\n- 行星边界层（PBL）是大气层的最低部分，在一小时或更短的时间尺度上受地表直接影响，在稳定条件下，其深度受到浮力对湍流的抑制作用的限制。\n- 虚位温（VPT），记为 $\\theta_v$，是一个与浮力相关的热力学变量；在地表，记为 $\\theta_{v,0} = \\theta_v(z=0)$。\n- 重力加速度为 $g$，单位为 $\\mathrm{m\\,s^{-2}}$。\n- 相对于地表，高度 $z$ 处的浮力 $b(z)$ 定义为 $b(z) = g\\,(\\theta_v(z) - \\theta_{v,0})/\\theta_{v,0}$。\n- 水平风矢量为 $\\mathbf{U}(z) = (u(z), v(z))$，地表风为 $\\mathbf{U}_0 = (u(0), v(0))$；高度 $z$ 上的风矢量差的大小为 $U_\\Delta(z) = \\|\\mathbf{U}(z) - \\mathbf{U}_0\\| = \\sqrt{(u(z) - u(0))^2 + (v(z) - v(0))^2}$。\n\n使用量纲分析和第一性原理推导来构建一个无量纲比，该比值表征了从地表到高度 $z$ 的气层中，稳定化浮力与失稳化切变之间的竞争。将此整体理查森数记为 $Ri_b(z)$，并用它在稳定条件下诊断PBL高度 $h$，即 $h$ 是满足 $Ri_b(z) \\ge Ri_{cr}$ 的最低高度 $z$，其中 $Ri_{cr}$ 是指定的临界整体理查森数（CBRN）。如果 $U_\\Delta(z) = 0$ 且 $(\\theta_v(z) - \\theta_{v,0})  0$，为了进行阈值测试，将 $Ri_b(z)$ 解释为 $+\\infty$；如果 $(\\theta_v(z) - \\theta_{v,0}) = 0$ 和 $U_\\Delta(z) = 0$ 同时成立，则将 $Ri_b(z)$ 视为 $0$。如果在给定的廓线内没有层级满足 $Ri_b(z) \\ge Ri_{cr}$，则返回 $-1.0$。\n\n科学真实性要求：\n- 使用国际单位制（SI）：高度单位为 $\\mathrm{m}$，风分量单位为 $\\mathrm{m\\,s^{-1}}$，重力加速度 $g$ 单位为 $\\mathrm{m\\,s^{-2}}$，虚位温单位为 $\\mathrm{K}$。\n- 对每个测试用例，将最终的行星边界层高度 $h$ 以 $\\mathrm{m}$ 为单位表示，并四舍五入到一位小数的浮点数。\n\n算法要求：\n- 对于地表以上的每个层级 $z_k$（$k \\ge 1$），根据定义计算 $Ri_b(z_k)$，并判断是否 $Ri_b(z_k) \\ge Ri_{cr}$；所需的高度 $h$ 是满足该阈值的最小 $z_k$。\n- 使用 $\\theta_{v,0} = \\theta_v(z=0)$ 作为地表虚位温，$\\mathbf{U}_0$ 作为地表风。\n- 您的程序必须是自包含的，并以下面指定的格式生成输出。\n\n测试套件（四个案例）：\n- 案例 1（典型的稳定层，在接近顶部处达到阈值）：\n  - $z = [0, 50, 100, 150, 200, 250, 300]\\,\\mathrm{m}$\n  - $\\theta_v = [295.0, 295.05, 295.1, 295.2, 295.5, 296.0, 297.0]\\,\\mathrm{K}$\n  - $u = [2.0, 4.0, 6.0, 7.0, 7.5, 8.0, 8.2]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [0.0, 1.0, 2.0, 2.5, 2.8, 3.0, 3.1]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n- 案例 2（边界情况，高空零切变导致立即达到阈值）：\n  - $z = [0, 50, 100, 200]\\,\\mathrm{m}$\n  - $\\theta_v = [292.0, 292.1, 292.2, 292.6]\\,\\mathrm{K}$\n  - $u = [3.0, 3.0, 3.0, 3.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [1.0, 1.0, 1.0, 1.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n- 案例 3（强切变和弱层结；未达到阈值）：\n  - $z = [0, 100, 200, 300, 400]\\,\\mathrm{m}$\n  - $\\theta_v = [290.0, 290.05, 290.1, 290.2, 290.4]\\,\\mathrm{K}$\n  - $u = [3.0, 8.0, 12.0, 15.0, 20.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [0.0, 2.0, 4.0, 6.0, 8.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n- 案例 4（构造为在中间层级恰好达到阈值）：\n  - $z = [0, 50, 100, 150, 200]\\,\\mathrm{m}$\n  - $\\theta_v = [300.0, 300.015, 300.03, 300.051, 300.08]\\,\\mathrm{K}$\n  - $u = [5.0, 5.6, 6.0, 6.0, 6.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [0.0, 0.0, 0.0, 0.0, 0.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个计算出的行星边界层高度，格式为逗号分隔的列表，并用方括号括起来，例如 $[h_1,h_2,h_3,h_4]$，其中每个 $h_i$ 的单位是 $\\mathrm{m}$，并四舍五入到一位小数。不应打印任何其他文本。",
            "solution": "所述问题具有科学依据，提法恰当，客观，并包含足够的信息以获得唯一解。它基于大气边界层物理学的既定原理。因此，该问题被认为是有效的。我们可以着手进行合理的求解。\n\n目标是确定稳定行星边界层的高度，记为 $h$。指定的方法是识别一个无量纲稳定性参数，即整体理查森数 $Ri_b(z)$，首次达到或超过临界值 $Ri_{cr}$ 的最低垂直高度 $z$。这种方法植根于流体动力学的基础物理学，特别是浮力和机械切变在产生或抑制湍流方面的竞争。\n\n首先，我们必须按要求从第一性原理推导整体理查森数 $Ri_b(z)$ 的表达式。理查森数代表了浮力对湍流的抑制作用与风切变对湍流的机械生成作用之比。\n\n1.  **浮力对湍流的抑制**：在稳定层结的流体中，一个垂直位移的流体质块会受到一个恢复浮力的作用。这种效应会衰减湍涡并抑制垂直混合。将一个质块抵抗这个恢复力抬升高度 $z$ 所需做的功会消耗湍流动能（TKE）。层获得的势能，或被浮力消耗的TKE的度量，与层深 $z$ 和该高度处的浮力 $b(z)$ 的乘积成正比。问题将相对于地表的浮力定义为：\n    $$\n    b(z) = g \\frac{\\theta_v(z) - \\theta_{v,0}}{\\theta_{v,0}}\n    $$\n    这里，$g$ 是重力加速度，单位为 $\\mathrm{m\\,s^{-2}}$；$\\theta_v(z)$ 是高度 $z$ 处的虚位温，单位为 $\\mathrm{K}$；$\\theta_{v,0}$ 是地表值。代表深度为 $z$ 的层上的浮力抑制的项，在量纲上是单位质量的能量，与 $z \\cdot b(z)$ 成正比。该项的单位是 $(\\mathrm{m/s})^2$。\n    $$\n    \\text{浮力抑制项} \\propto z \\cdot g \\frac{\\theta_v(z) - \\theta_{v,0}}{\\theta_{v,0}}\n    $$\n\n2.  **切变生成湍流**：风切变，即风速随高度的变化，是TKE机械生成的主要来源。对于从地表（高度 $z=0$）到高度 $z$ 的整体层，与切变相关的速度尺度是高度 $z$ 处的风与地表风的矢量差的大小。设水平风矢量为 $\\mathbf{U}(z) = (u(z), v(z))$。地表风为 $\\mathbf{U}_0 = (u(0), v(0))$。风差的大小为：\n    $$\n    U_\\Delta(z) = \\|\\mathbf{U}(z) - \\mathbf{U}_0\\| = \\sqrt{(u(z) - u(0))^2 + (v(z) - v(0))^2}\n    $$\n    由切变产生的TKE生成速率与该速度差的平方 $U_\\Delta(z)^2$ 成正比。该项也代表单位质量的能量，单位为 $(\\mathrm{m/s})^2$。\n\n3.  **构建整体理查森数**：无量纲的整体理查森数 $Ri_b(z)$ 是浮力抑制项与切变生成项之比：\n    $$\n    Ri_b(z) = \\frac{z \\cdot g \\frac{\\theta_v(z) - \\theta_{v,0}}{\\theta_{v,0}}}{U_\\Delta(z)^2} = \\frac{g \\cdot z \\cdot (\\theta_v(z) - \\theta_{v,0})}{\\theta_{v,0} \\cdot \\left( (u(z) - u(0))^2 + (v(z) - v(0))^2 \\right)}\n    $$\n    其单位为 $(\\mathrm{m} \\cdot \\mathrm{m\\,s^{-2}} \\cdot \\mathrm{K}) / (\\mathrm{K} \\cdot (\\mathrm{m\\,s^{-1}})^2) = (\\mathrm{m^2\\,s^{-2}}) / (\\mathrm{m^2\\,s^{-2}})$，是无量纲的，符合要求。当 $Ri_b(z)$ 很小时，切变占主导，湍流可能得以维持。当 $Ri_b(z)$ 很大时，浮力占主导，湍流被抑制。临界值 $Ri_{cr}$ 代表了湍流预期停止的阈值。因此，稳定PBL高度 $h$ 是湍流层的高度，被确定为满足 $Ri_b(z) \\ge Ri_{cr}$ 的最低层级。\n\n寻找 $h$ 的算法流程如下：\n\n1.  对于每个测试用例，获取高度 $z_k$、虚位温 $\\theta_{v,k}$ 以及风分量 $u_k$ 和 $v_k$ 的离散垂直廓线。索引 $k=0$ 对应于地表。\n2.  确定地表值：$\\theta_{v,0} = \\theta_{v,k=0}$，$u_0 = u_{k=0}$，$v_0 = v_{k=0}$。\n3.  初始化PBL高度为未找到状态，例如，设置 $h = -1.0$。\n4.  从地表以上开始，遍历大气层级，对于 $k = 1, 2, 3, \\ldots$ 直到最高可用层级。对于每个层级 $z_k$：\n    a.  计算与浮力相关的分子项：$N = g \\cdot z_k \\cdot (\\theta_{v,k} - \\theta_{v,0})$。\n    b.  计算与切变相关的分母项：$D = \\theta_{v,0} \\cdot \\left( (u_k - u_0)^2 + (v_k - v_0)^2 \\right)$。注意，风差的平方即为 $U_\\Delta(z_k)^2$。\n    c.  按规定评估特殊条件：\n        i.  如果 $U_\\Delta(z_k)^2 = 0$：如果浮力项 $(\\theta_{v,k} - \\theta_{v,0})$ 为正，则 $Ri_b(z_k)$ 被视为无穷大。由于 $\\infty \\ge Ri_{cr}$，条件满足。如果 $(\\theta_{v,k} - \\theta_{v,0})$ 为零，则 $Ri_b(z_k)$ 被视为 $0$，条件不满足（假设 $Ri_{cr} > 0$）。\n        ii. 否则，如果 $U_\\Delta(z_k)^2 \\ne 0$，则计算 $Ri_b(z_k) = N / D$。\n    d.  检查是否 $Ri_b(z_k) \\ge Ri_{cr}$。\n    e.  如果条件满足，则PBL高度为 $h = z_k$。因为我们寻找的是*最低*的此类层级，所以我们终止对此测试用例的搜索并记录结果。\n5.  如果循环完成而没有找到任何满足条件的层级，则该测试用例的结果保持为 $h = -1.0$。\n6.  收集所有测试用例的最终结果，并以要求的格式呈现。此过程将应用于给定的测试套件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the Planetary Boundary Layer (PBL) height for stable conditions\n    based on the bulk Richardson number method.\n    \"\"\"\n\n    # Test suite (four cases)\n    test_cases = [\n        {\n            \"z\": np.array([0, 50, 100, 150, 200, 250, 300]),  # m\n            \"theta_v\": np.array([295.0, 295.05, 295.1, 295.2, 295.5, 296.0, 297.0]),  # K\n            \"u\": np.array([2.0, 4.0, 6.0, 7.0, 7.5, 8.0, 8.2]),  # m/s\n            \"v\": np.array([0.0, 1.0, 2.0, 2.5, 2.8, 3.0, 3.1]),  # m/s\n            \"g\": 9.81,  # m/s^2\n            \"Ri_cr\": 0.25\n        },\n        {\n            \"z\": np.array([0, 50, 100, 200]),\n            \"theta_v\": np.array([292.0, 292.1, 292.2, 292.6]),\n            \"u\": np.array([3.0, 3.0, 3.0, 3.0]),\n            \"v\": np.array([1.0, 1.0, 1.0, 1.0]),\n            \"g\": 9.81,\n            \"Ri_cr\": 0.25\n        },\n        {\n            \"z\": np.array([0, 100, 200, 300, 400]),\n            \"theta_v\": np.array([290.0, 290.05, 290.1, 290.2, 290.4]),\n            \"u\": np.array([3.0, 8.0, 12.0, 15.0, 20.0]),\n            \"v\": np.array([0.0, 2.0, 4.0, 6.0, 8.0]),\n            \"g\": 9.81,\n            \"Ri_cr\": 0.25\n        },\n        {\n            \"z\": np.array([0, 50, 100, 150, 200]),\n            \"theta_v\": np.array([300.0, 300.015, 300.03, 300.051, 300.08]),\n            \"u\": np.array([5.0, 5.6, 6.0, 6.0, 6.0]),\n            \"v\": np.array([0.0, 0.0, 0.0, 0.0, 0.0]),\n            \"g\": 9.81,\n            \"Ri_cr\": 0.25\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        heights = case[\"z\"]\n        theta_v_profile = case[\"theta_v\"]\n        u_profile = case[\"u\"]\n        v_profile = case[\"v\"]\n        g = case[\"g\"]\n        Ri_cr = case[\"Ri_cr\"]\n\n        # Extract surface values (at index 0)\n        theta_v_0 = theta_v_profile[0]\n        u_0 = u_profile[0]\n        v_0 = v_profile[0]\n\n        pbl_height = -1.0 # Default if threshold is not met\n\n        # Iterate over levels above the surface (k = 1)\n        for k in range(1, len(heights)):\n            z_k = heights[k]\n            theta_v_k = theta_v_profile[k]\n            u_k = u_profile[k]\n            v_k = v_profile[k]\n\n            # Calculate difference in virtual potential temperature\n            delta_theta_v = theta_v_k - theta_v_0\n            \n            # Calculate squared magnitude of wind difference (shear term)\n            u_delta_sq = (u_k - u_0)**2 + (v_k - v_0)**2\n\n            Ri_b = 0.0\n            \n            # Handle special cases based on the problem description\n            if u_delta_sq == 0:\n                # If shear is zero, but stratification is positive, Ri_b is infinite.\n                if delta_theta_v  0:\n                    Ri_b = float('inf')\n                # If shear is zero and stratification is also zero, Ri_b is zero.\n                else:\n                    Ri_b = 0.0\n            else:\n                # Standard calculation for the bulk Richardson number\n                # Ri_b = (g * z * delta_theta_v) / (theta_v_0 * U_delta^2)\n                numerator = g * z_k * delta_theta_v\n                denominator = theta_v_0 * u_delta_sq\n                Ri_b = numerator / denominator\n\n            # Check if the critical threshold is met or exceeded\n            if Ri_b = Ri_cr:\n                pbl_height = z_k\n                break # Found the lowest level, so exit the loop\n\n        results.append(pbl_height)\n\n    # Format the results for the final print statement\n    formatted_results = [f\"{r:.1f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}