{
    "hands_on_practices": [
        {
            "introduction": "本练习是任何质量通量方案的核心。我们将把质量和能量守恒的物理原理转化为一种数值算法，用以计算对流云羽如何加热和湿润其周围环境。通过这个实践，你将巩固对离散化大气柱中对流输送和卷出过程如何表示的理解。",
            "id": "4062651",
            "problem": "给定一个适用于数值天气预报 (NWP) 的一维大气柱，该大气柱被离散化为多个层次。每个层次代表环境，并且存在一个单一的上升气流羽流，其上升气流温度和上升气流比湿的廓线是已知的。该羽流的特征在于其向上的质量通量和夹出率，夹出率作为环境标量的局地源。您的任务是，从第一性原理（在控制体积中使用质量和标量守恒）出发，推导出一个用于计算由对流输送和夹出引起的温度和比湿环境倾向项的离散算法，然后实现此算法，为提供的测试套件计算倾向项。\n\n使用的基本原理：\n- 控制体积中的标量守恒：对于任意标量 $\\chi$，在厚度为 $\\Delta z$ 的层次中 $\\rho \\chi$ 的变化率等于通过其界面流入该层次的净通量加上任何层内源。此处 $\\rho$ 是空气密度。\n- 对流输送由一个基于质量通量羽流构建的参数化垂直通量 $F_{\\chi}$ 表示，该通量使用上升气流羽流属性与环境之间的差异。\n- 夹出在每个层次内作为环境标量的局地源，其大小与夹出率和羽流质量通量的乘积成正比。\n\n待应用的定义和模型选择：\n- 设层次索引为 $k \\in \\{0,1,\\dots,N-1\\}$，层次厚度为 $\\Delta z_k$，密度为 $\\rho_k$，环境温度为 $T_{e,k}$，环境比湿为 $q_{e,k}$。\n- 上升气流羽流的层中心值为 $T_{u,k}$ 和 $q_{u,k}$，以及层中心质量通量 $M_k$。\n- 层中心的夹出率为 $\\delta_k$，单位为 $\\mathrm{m}^{-1}$。\n- 在层界面上标量的对流通量被建模为 $F_{\\chi} = M (\\chi_u - \\chi_e)$，并在该界面上求值。\n- 对于任何变量 $\\psi_k$，其从层中心到层 $k$ 和 $k+1$ 之间界面的映射应通过算术平均值计算：$\\psi_{k+1/2} = \\frac{1}{2}(\\psi_k + \\psi_{k+1})$。\n- 边界条件：在底边界（$k=-1/2$）的 $F_{\\chi}$ 必须设置为 $0$，在顶边界（$k=N-1/2$）的 $F_{\\chi}$ 必须设置为 $0$。\n- 层内标量 $\\chi$ 的夹出源应建模为 $S_{\\chi,k} = \\delta_k M_k (\\chi_{u,k} - \\chi_{e,k})$。\n\n根据以上原理，基于净界面通量和层内夹出源，推导一个由对流引起的温度和比湿环境倾向项的离散表达式。实现所推导的算法，为以下测试套件计算倾向项。将温度倾向项以 $\\mathrm{K/s}$ 表示，比湿倾向项以 $\\mathrm{s}^{-1}$ 表示，并将每个倾向项四舍五入到六位小数。\n\n测试套件：\n- 案例A（正常路径，四个层次）：\n  - $N = 4$\n  - $\\Delta z = [1000, 1000, 1000, 1000]$ 米\n  - $\\rho = [1.2, 1.1, 1.0, 0.9]$ 千克/立方米\n  - $T_e = [300.0, 296.0, 292.0, 288.0]$ 开尔文\n  - $T_u = [302.0, 298.0, 294.0, 290.0]$ 开尔文\n  - $q_e = [0.016, 0.012, 0.009, 0.005]$ 千克/千克\n  - $q_u = [0.018, 0.014, 0.010, 0.006]$ 千克/千克\n  - $M = [0.30, 0.25, 0.20, 0.10]$ 千克/(平方米·秒)\n  - $\\delta = [0.0010, 0.0015, 0.0020, 0.0025]$ /米\n- 案例B（零通量边界情况，三个层次）：\n  - $N = 3$\n  - $\\Delta z = [800, 1200, 1500]$ 米\n  - $\\rho = [1.22, 1.05, 0.85]$ 千克/立方米\n  - $T_e = [298.0, 295.0, 285.0]$ 开尔文\n  - $T_u = [298.0, 295.0, 285.0]$ 开尔文\n  - $q_e = [0.017, 0.012, 0.004]$ 千克/千克\n  - $q_u = [0.017, 0.012, 0.004]$ 千克/千克\n  - $M = [0.0, 0.0, 0.0]$ 千克/(平方米·秒)\n  - $\\delta = [0.0010, 0.0020, 0.0030]$ /米\n- 案例C（混合符号差异和可变层次，五个层次）：\n  - $N = 5$\n  - $\\Delta z = [500, 700, 1000, 1200, 1500]$ 米\n  - $\\rho = [1.25, 1.18, 1.05, 0.95, 0.80]$ 千克/立方米\n  - $T_e = [299.0, 297.0, 294.0, 290.0, 285.0]$ 开尔文\n  - $T_u = [300.0, 297.5, 293.5, 289.0, 284.0]$ 开尔文\n  - $q_e = [0.0165, 0.0135, 0.0090, 0.0060, 0.0030]$ 千克/千克\n  - $q_u = [0.0175, 0.0140, 0.0085, 0.0050, 0.0025]$ 千克/千克\n  - $M = [0.20, 0.22, 0.18, 0.12, 0.05]$ 千克/(平方米·秒)\n  - $\\delta = [0.0008, 0.0012, 0.0020, 0.0030, 0.0040]$ /米\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。\n- 对于每个案例，输出一个嵌套列表，其中包含两个列表：分层的温度倾向项（单位为 $\\mathrm{K/s}$）和分层的比湿倾向项（单位为 $\\mathrm{s}^{-1}$），两者均四舍五入到六位小数。\n- 因此，最终输出应为以下形式：\n  - `[[[T_A],[q_A]],[[T_B],[q_B]],[[T_C],[q_C]]]`\n  其中 `[T_A]` 表示案例A的温度倾向项列表，`[q_A]` 表示案例A的比湿倾向项列表，案例B和C同理。",
            "solution": "## 问题验证\n\n### 步骤1：提取给定条件\n\n问题为离散化为 $N$ 个层次（索引为 $k \\in \\{0, 1, \\dots, N-1\\}$）的一维大气柱提供了以下定义、参数和条件。\n\n**物理量和廓线：**\n- 层次厚度: $\\Delta z_k$ [m]\n- 空气密度: $\\rho_k$ [kg/m$^3$]\n- 环境温度: $T_{e,k}$ [K]\n- 环境比湿: $q_{e,k}$ [kg/kg]\n- 上升气流羽流温度: $T_{u,k}$ [K]\n- 上升气流羽流比湿: $q_{u,k}$ [kg/kg]\n- 上升气流羽流质量通量（在层中心）: $M_k$ [kg/(m$^2 \\cdot$ s)]\n- 夹出率（在层中心）: $\\delta_k$ [m$^{-1}$]\n\n**建模原理和定义：**\n1.  **标量守恒**：对于标量 $\\chi$，在厚度为 $\\Delta z$ 的层次中，$\\rho \\chi$ 的变化率是跨界面的净通量和层内源之和。\n2.  **对流通量**：在层界面上标量 $\\chi$ 的通量被建模为 $F_{\\chi} = M (\\chi_u - \\chi_e)$。\n3.  **夹出源**：在层 k 内标量 $\\chi$ 的源是 $S_{\\chi,k} = \\delta_k M_k (\\chi_{u,k} - \\chi_{e,k})$。\n4.  **界面插值**：在层 $k$ 和 $k+1$ 之间的界面（表示为 $k+1/2$）上的变量 $\\psi_k$ 是算术平均值：$\\psi_{k+1/2} = \\frac{1}{2}(\\psi_k + \\psi_{k+1})$。\n5.  **边界条件：**\n    - 底部边界（$k=-1/2$）的通量：$F_{\\chi, -1/2} = 0$。\n    - 顶部边界（$k=N-1/2$）的通量：$F_{\\chi, N-1/2} = 0$。\n\n**测试套件数据：**\n- **案例 A ($N=4$):**\n  - $\\Delta z = [1000, 1000, 1000, 1000]$ m\n  - $\\rho = [1.2, 1.1, 1.0, 0.9]$ kg/m$^3$\n  - $T_e = [300.0, 296.0, 292.0, 288.0]$ K\n  - $T_u = [302.0, 298.0, 294.0, 290.0]$ K\n  - $q_e = [0.016, 0.012, 0.009, 0.005]$ kg/kg\n  - $q_u = [0.018, 0.014, 0.010, 0.006]$ kg/kg\n  - $M = [0.30, 0.25, 0.20, 0.10]$ kg/(m$^2 \\cdot$ s)\n  - $\\delta = [0.0010, 0.0015, 0.0020, 0.0025]$ m$^{-1}$\n- **案例 B ($N=3$):**\n  - $\\Delta z = [800, 1200, 1500]$ m\n  - $\\rho = [1.22, 1.05, 0.85]$ kg/m$^3$\n  - $T_e = [298.0, 295.0, 285.0]$ K\n  - $T_u = [298.0, 295.0, 285.0]$ K\n  - $q_e = [0.017, 0.012, 0.004]$ kg/kg\n  - $q_u = [0.017, 0.012, 0.004]$ kg/kg\n  - $M = [0.0, 0.0, 0.0]$ kg/(m$^2 \\cdot$ s)\n  - $\\delta = [0.0010, 0.0020, 0.0030]$ m$^{-1}$\n- **案例 C ($N=5$):**\n  - $\\Delta z = [500, 700, 1000, 1200, 1500]$ m\n  - $\\rho = [1.25, 1.18, 1.05, 0.95, 0.80]$ kg/m$^3$\n  - $T_e = [299.0, 297.0, 294.0, 290.0, 285.0]$ K\n  - $T_u = [300.0, 297.5, 293.5, 289.0, 284.0]$ K\n  - $q_e = [0.0165, 0.0135, 0.0090, 0.0060, 0.0030]$ kg/kg\n  - $q_u = [0.0175, 0.0140, 0.0085, 0.0050, 0.0025]$ kg/kg\n  - $M = [0.20, 0.22, 0.18, 0.12, 0.05]$ kg/(m$^2 \\cdot$ s)\n  - $\\delta = [0.0008, 0.0012, 0.0020, 0.0030, 0.0040]$ m$^{-1}$\n\n### 步骤2：使用提取的给定条件进行验证\n\n根据验证标准评估问题：\n- **科学依据**：问题描述了次网格尺度对流的质量通量参数化，这是现代数值天气预报和气候模型的标准和基本组成部分。该公式基于质量和一个通用标量的守恒，这是一个核心物理原理。虽然直接使用温度 $T$ 作为输送标量是一种简化（通常使用如位温或静力能等保守热力学变量），但这是一个常见的教学选择，并不构成根本性的科学缺陷。\n- **良态的**：问题是良态的。它提供了所有必要的输入数据（$\\Delta z_k, \\rho_k, T_{e,k}, T_{u,k}, q_{e,k}, q_{u,k}, M_k, \\delta_k$），定义了所有必需的模型（通量、源、插值），指定了边界条件，并要求一个唯一可确定的输出（倾向项）。\n- **客观性**：问题以精确的数学语言陈述，没有主观或模糊的术语。\n- **其他缺陷**：问题是自洽、一致的，并且没有表现出任何列出的缺陷，例如不可形式化、不完整、矛盾或琐碎。\n\n### 步骤3：结论和行动\n\n问题陈述是**有效**的。将提供一个完整的解决方案。\n\n## 离散算法的推导\n\n推导从层 $k$ 环境中通用标量 $\\chi_e$ 的基本守恒定律开始。\n\n1.  **层的守恒定律：**\n    问题陈述，层内标量属性 $\\rho \\chi$ 总量的随时间变化率等于流入该层的净通量加上任何层内源。对于一个厚度为 $\\Delta z_k$ 且单位水平面积的层 $k$，环境标量总量为 $\\rho_k \\chi_{e,k} \\Delta z_k$。因此守恒定律为：\n    $$ \\frac{\\partial}{\\partial t} \\left( \\rho_k \\chi_{e,k} \\Delta z_k \\right) = F_{\\chi, k-1/2} - F_{\\chi, k+1/2} + S_{\\chi,k}^{\\text{total}} $$\n    其中 $F_{\\chi, k-1/2}$ 和 $F_{\\chi, k+1/2}$ 分别是层 $k$ 底部和顶部界面的通量。问题给出的源项 $S_{\\chi,k} = \\delta_k M_k (\\chi_{u,k} - \\chi_{e,k})$ 的单位是 $\\mathrm{kg} \\cdot \\mathrm{m}^{-3} \\cdot \\mathrm{s}^{-1} \\cdot (\\chi \\text{的单位})$，这是一个单位体积的源。层中的总源（每单位面积）是 $S_{\\chi,k}^{\\text{total}} = S_{\\chi,k} \\Delta z_k$。\n    假设在倾向项计算中 $\\rho_k$ 和 $\\Delta z_k$ 不随时间变化，我们可以写出：\n    $$ \\rho_k \\Delta z_k \\frac{\\partial \\chi_{e,k}}{\\partial t} = F_{\\chi, k-1/2} - F_{\\chi, k+1/2} + S_{\\chi,k} \\Delta z_k $$\n    求解倾向项 $\\frac{\\partial \\chi_{e,k}}{\\partial t}$，得到主方程：\n    $$ \\frac{\\partial \\chi_{e,k}}{\\partial t} = \\frac{1}{\\rho_k \\Delta z_k} \\left( F_{\\chi, k-1/2} - F_{\\chi, k+1/2} \\right) + \\frac{S_{\\chi,k}}{\\rho_k} $$\n\n2.  **界面通量的离散化：**\n    界面上的通量由 $F_{\\chi} = M (\\chi_u - \\chi_e)$ 给出。为了在层 $k$ 和 $k+1$ 之间的界面 $k+1/2$ 上计算该值，我们对所有变量使用指定的算术平均值：\n    $$ M_{k+1/2} = \\frac{1}{2}(M_k + M_{k+1}) $$\n    $$ \\chi_{u, k+1/2} = \\frac{1}{2}(\\chi_{u,k} + \\chi_{u,k+1}) $$\n    $$ \\chi_{e, k+1/2} = \\frac{1}{2}(\\chi_{e,k} + \\chi_{e,k+1}) $$\n    将这些代入通量方程得到：\n    $$ F_{\\chi, k+1/2} = \\left(\\frac{M_k + M_{k+1}}{2}\\right) \\left[ \\left(\\frac{\\chi_{u,k} + \\chi_{u,k+1}}{2}\\right) - \\left(\\frac{\\chi_{e,k} + \\chi_{e,k+1}}{2}\\right) \\right] $$\n    $$ F_{\\chi, k+1/2} = \\frac{1}{4} (M_k + M_{k+1}) \\left( (\\chi_{u,k} - \\chi_{e,k}) + (\\chi_{u,k+1} - \\chi_{e,k+1}) \\right) $$\n    我们将层内的差值定义为 $\\Delta\\chi_k = \\chi_{u,k} - \\chi_{e,k}$。界面通量变为：\n    $$ F_{\\chi, k+1/2} = \\frac{1}{4} (M_k + M_{k+1}) (\\Delta\\chi_k + \\Delta\\chi_{k+1}) $$\n    此公式对内部界面有效，即对于 $k = 0, 1, \\dots, N-2$。\n\n3.  **最终离散倾向项方程：**\n    我们将通量 $F_\\chi$ 和源 $S_\\chi$ 的表达式代入主倾向项方程。\n    源项的贡献是：\n    $$ \\frac{S_{\\chi,k}}{\\rho_k} = \\frac{\\delta_k M_k (\\chi_{u,k} - \\chi_{e,k})}{\\rho_k} = \\frac{\\delta_k M_k}{\\rho_k} \\Delta\\chi_k $$\n    层 $k$ 中倾向项的最终离散算法，表示为 $(\\frac{\\partial \\chi_e}{\\partial t})_k$，是：\n    $$ \\left(\\frac{\\partial \\chi_e}{\\partial t}\\right)_k = \\frac{F_{\\chi, k-1/2} - F_{\\chi, k+1/2}}{\\rho_k \\Delta z_k} + \\frac{\\delta_k M_k}{\\rho_k} \\Delta\\chi_k $$\n    其中：\n    - 对于内部层 $k \\in \\{1, \\dots, N-2\\}$：\n        $F_{\\chi, k-1/2} = \\frac{1}{4} (M_{k-1} + M_k) (\\Delta\\chi_{k-1} + \\Delta\\chi_k)$\n        $F_{\\chi, k+1/2} = \\frac{1}{4} (M_k + M_{k+1}) (\\Delta\\chi_k + \\Delta\\chi_{k+1})$\n    - 对于底层 $k=0$：\n        $F_{\\chi, -1/2} = 0$ (根据边界条件)\n        $F_{\\chi, 1/2} = \\frac{1}{4} (M_0 + M_1) (\\Delta\\chi_0 + \\Delta\\chi_1)$\n    - 对于顶层 $k=N-1$：\n        $F_{\\chi, N-3/2} = \\frac{1}{4} (M_{N-2} + M_{N-1}) (\\Delta\\chi_{N-2} + \\Delta\\chi_{N-1})$\n        $F_{\\chi, N-1/2} = 0$ (根据边界条件)\n\n这个完整的算法被独立地应用于温度（$T$）和比湿（$q$），以计算它们各自在大气柱中每一层的环境倾向项。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all given test cases.\n    It defines the test cases, computes the tendencies for each,\n    and prints the formatted results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 4,\n            \"delta_z\": np.array([1000.0, 1000.0, 1000.0, 1000.0]),\n            \"rho\": np.array([1.2, 1.1, 1.0, 0.9]),\n            \"T_e\": np.array([300.0, 296.0, 292.0, 288.0]),\n            \"T_u\": np.array([302.0, 298.0, 294.0, 290.0]),\n            \"q_e\": np.array([0.016, 0.012, 0.009, 0.005]),\n            \"q_u\": np.array([0.018, 0.014, 0.010, 0.006]),\n            \"M\": np.array([0.30, 0.25, 0.20, 0.10]),\n            \"delta\": np.array([0.0010, 0.0015, 0.0020, 0.0025]),\n        },\n        {\n            \"N\": 3,\n            \"delta_z\": np.array([800.0, 1200.0, 1500.0]),\n            \"rho\": np.array([1.22, 1.05, 0.85]),\n            \"T_e\": np.array([298.0, 295.0, 285.0]),\n            \"T_u\": np.array([298.0, 295.0, 285.0]),\n            \"q_e\": np.array([0.017, 0.012, 0.004]),\n            \"q_u\": np.array([0.017, 0.012, 0.004]),\n            \"M\": np.array([0.0, 0.0, 0.0]),\n            \"delta\": np.array([0.0010, 0.0020, 0.0030]),\n        },\n        {\n            \"N\": 5,\n            \"delta_z\": np.array([500.0, 700.0, 1000.0, 1200.0, 1500.0]),\n            \"rho\": np.array([1.25, 1.18, 1.05, 0.95, 0.80]),\n            \"T_e\": np.array([299.0, 297.0, 294.0, 290.0, 285.0]),\n            \"T_u\": np.array([300.0, 297.5, 293.5, 289.0, 284.0]),\n            \"q_e\": np.array([0.0165, 0.0135, 0.0090, 0.0060, 0.0030]),\n            \"q_u\": np.array([0.0175, 0.0140, 0.0085, 0.0050, 0.0025]),\n            \"M\": np.array([0.20, 0.22, 0.18, 0.12, 0.05]),\n            \"delta\": np.array([0.0008, 0.0012, 0.0020, 0.0030, 0.0040]),\n        }\n    ]\n\n    def calculate_tendencies(N, delta_z, rho, M, delta, chi_e, chi_u):\n        \"\"\"\n        Computes environmental tendencies for a generic scalar chi.\n\n        Args:\n            N (int): Number of layers.\n            delta_z (np.array): Layer thicknesses.\n            rho (np.array): Layer densities.\n            M (np.array): Mass flux at layer centers.\n            delta (np.array): Detrainment rates at layer centers.\n            chi_e (np.array): Environmental scalar at layer centers.\n            chi_u (np.array): Updraft scalar at layer centers.\n\n        Returns:\n            np.array: Scalar tendencies for each layer.\n        \"\"\"\n        # Calculate the difference between updraft and environment scalar\n        delta_chi = chi_u - chi_e\n\n        # Initialize fluxes at interfaces. Size N+1 for N layers.\n        # fluxes[k] corresponds to interface k-1/2.\n        # fluxes[0] is bottom boundary, fluxes[N] is top boundary.\n        fluxes = np.zeros(N + 1)\n\n        # Calculate fluxes at internal interfaces (k+1/2 for k=0 to N-2)\n        # These are stored in fluxes[1] through fluxes[N-1]\n        for k in range(N - 1):\n            # Interface k+1/2 is between layers k and k+1\n            fluxes[k + 1] = 0.25 * (M[k] + M[k + 1]) * (delta_chi[k] + delta_chi[k + 1])\n\n        # Initialize tendencies for each layer\n        tendencies = np.zeros(N)\n\n        for k in range(N):\n            # Flux divergence term: (flux_in - flux_out) / (rho * dz)\n            # flux_in is at k-1/2 (fluxes[k]), flux_out is at k+1/2 (fluxes[k+1])\n            flux_divergence_term = (fluxes[k] - fluxes[k + 1]) / (rho[k] * delta_z[k])\n\n            # Source term from detrainment: S_chi / rho\n            source_term = (delta[k] * M[k] / rho[k]) * delta_chi[k]\n\n            tendencies[k] = flux_divergence_term + source_term\n\n        return tendencies\n\n    # Store results for all cases\n    final_results_str_list = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        \n        # Calculate temperature tendencies\n        T_tendencies = calculate_tendencies(\n            N, case[\"delta_z\"], case[\"rho\"], case[\"M\"], case[\"delta\"],\n            case[\"T_e\"], case[\"T_u\"]\n        )\n\n        # Calculate specific humidity tendencies\n        q_tendencies = calculate_tendencies(\n            N, case[\"delta_z\"], case[\"rho\"], case[\"M\"], case[\"delta\"],\n            case[\"q_e\"], case[\"q_u\"]\n        )\n        \n        # Format results to strings with 6 decimal places\n        T_tend_str = [f'{t:.6f}' for t in T_tendencies]\n        q_tend_str = [f'{q:.6f}' for q in q_tendencies]\n\n        # Format lists into the required string format\n        T_list_str = f\"[{','.join(T_tend_str)}]\"\n        q_list_str = f\"[{','.join(q_tend_str)}]\"\n\n        # Combine into the case-specific string format [[T_list],[q_list]]\n        case_str = f\"[{T_list_str},{q_list_str}]\"\n        final_results_str_list.append(case_str)\n\n    # Join all case strings into the final output format\n    final_output = f\"[{','.join(final_results_str_list)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "对流云羽代表了强烈的向上运动，但为了使大尺度大气柱保持平衡，这种向上的通量必须由其他地方的向下运动来补偿。本练习利用非弹性连续性方程来推导这一基本约束，并计算环境中为平衡集中对流而产生的平缓、大尺度的下沉运动。这个概念对于理解对流如何与更大尺度的环流相互作用至关重要。",
            "id": "4062680",
            "problem": "在一个用于数值天气预报的非弹性大气模式的水平均匀网格柱中，某一固定高度的次网格对流场被划分为三个不相交的子域：上升气流羽、下沉气流羽及其环境场。设它们对应的水平面积分数分别为 $a_u$、$a_d$ 和 $a_e$，其中 $a_e = 1 - a_u - a_d$。假设该模式使用非弹性近似，并具有水平周期性区域以及不可穿透的上下边界，因此区域平均的垂直质量通量受到边界条件的约束。\n\n在高度 $z = 2~\\mathrm{km}$ 处，假设诊断出以下数据：\n- 上升气流面积分数 $a_u = 0.02$，\n- 下沉气流面积分数 $a_d = 0.01$，\n- 上升气流平均垂直速度 $w_u = 5.0~\\mathrm{m\\,s^{-1}}$（向上为正），\n- 下沉气流平均垂直速度 $w_d = -2.0~\\mathrm{m\\,s^{-1}}$（向下为负），\n- 环境场气压 $p = 800~\\mathrm{hPa}$，\n- 环境场温度 $T = 290~\\mathrm{K}$。\n\n将空气视为理想气体，干空气比气体常数为 $R_d = 287~\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。从非弹性连续性方程 $\\nabla \\cdot (\\rho \\boldsymbol{v}) = 0$ 和三个子域上的水平平均定义出发，推导出在给定高度上联系这三个子域的面积分数加权垂直质量通量的约束条件。然后，利用此约束条件以及 $a_e$ 的恒等式，计算在 $z=2~\\mathrm{km}$ 处的环境场平均垂直速度 $\\overline{w}_e$。\n\n请以 $\\mathrm{m\\,s^{-1}}$ 为单位表示 $\\overline{w}_e$ 的最终答案，并将结果四舍五入到四位有效数字。",
            "solution": "该问题要求推导一个次网格尺度对流方案中垂直速度的约束条件，并随后计算环境场的垂直速度 $\\overline{w}_e$。推导始于非弹性连续性方程，并应用了特定边界条件下的水平平均原理。\n\n### 第一步：平均垂直质量通量约束的推导\n\n所给定的控制方程是非弹性连续性方程：\n$$ \\nabla \\cdot (\\rho \\boldsymbol{v}) = 0 $$\n在笛卡尔坐标系中，$\\boldsymbol{v} = (u, v, w)$，该方程为：\n$$ \\frac{\\partial (\\rho u)}{\\partial x} + \\frac{\\partial (\\rho v)}{\\partial y} + \\frac{\\partial (\\rho w)}{\\partial z} = 0 $$\n我们对整个网格柱面积 $A$ 进行水平平均，记作 $\\langle \\cdot \\rangle$。平均算子定义为 $\\langle f \\rangle = \\frac{1}{A} \\iint_A f(x, y) \\,dx\\,dy$。\n对连续性方程进行平均，得到：\n$$ \\left\\langle \\frac{\\partial (\\rho u)}{\\partial x} + \\frac{\\partial (\\rho v)}{\\partial y} \\right\\rangle + \\left\\langle \\frac{\\partial (\\rho w)}{\\partial z} \\right\\rangle = 0 $$\n第一项是水平质量通量散度 $\\nabla_h \\cdot (\\rho \\boldsymbol{v}_h)$ 的水平平均。对于题目中声明的水平周期性区域，水平散度的平均值为零。这可以通过二维散度定理证明，其中区域相对边界上的边界积分相互抵消。\n因此，平均后的方程简化为：\n$$ \\left\\langle \\frac{\\partial (\\rho w)}{\\partial z} \\right\\rangle = 0 $$\n由于平均区域在水平方向上是固定的，平均算子和垂直偏导数可以交换次序：\n$$ \\frac{\\partial}{\\partial z} \\langle \\rho w \\rangle = 0 $$\n这个结果意味着区域平均的垂直质量通量 $\\langle \\rho w \\rangle$ 不随高度 $z$ 变化。\n\n问题指定了不可穿透的下边界和上边界。在这些边界上（例如，在 $z=0$ 和 $z=z_{top}$ 处），对于所有的 $(x, y)$，垂直速度 $w$ 必须为零。因此，在这些边界上的平均垂直质量通量也为零：\n$$ \\langle \\rho w \\rangle \\big|_{z=0, z_{top}} = \\langle \\rho \\cdot 0 \\rangle = 0 $$\n由于 $\\langle \\rho w \\rangle$ 不随高度变化，它在所有高度上都必须为零。因此，我们得到了在任意高度 $z$ 对整个网格柱的基本约束：\n$$ \\langle \\rho w \\rangle = 0 $$\n\n### 第二步：应用非弹性近似和子域划分\n\n非弹性近似的一个关键特征，特别是在此处的应用背景下，是连续性方程中的密度 $\\rho$ 由一个仅随高度变化且水平均匀的参考态密度 $\\rho_0(z)$ 来表示。问题陈述中使用的 $\\rho$ 应被解释为这个参考态密度，即 $\\rho = \\rho_0(z)$。这是一个标准的表述方式，它能滤掉声波，同时通过动量和热力学方程（此处未使用）中的密度扰动来保留浮力效应。\n\n当 $\\rho = \\rho_0(z)$ 时，密度在任何水平面上都是常数。因此，它可以从水平平均中提出来：\n$$ \\langle \\rho_0(z) w \\rangle = \\rho_0(z) \\langle w \\rangle = 0 $$\n由于 $\\rho_0(z)$ 不为零，这导出了一个关于垂直体积通量的简化但有力的约束：区域平均的垂直速度在所有高度上都必须为零。\n$$ \\langle w \\rangle = 0 $$\n问题陈述，水平网格柱被划分为三个子域：上升气流（$u$）、下沉气流（$d$）和环境场（$e$）。任何物理量的水平平均可以表示为每个子域的平均值由其各自面积分数（$a_u, a_d, a_e$）加权后的总和。将此分解应用于垂直速度 $w$：\n$$ \\langle w \\rangle = a_u \\overline{w}_u + a_d \\overline{w}_d + a_e \\overline{w}_e $$\n其中 $\\overline{w}_u$、$\\overline{w}_d$ 和 $\\overline{w}_e$ 分别是上升气流、下沉气流和环境子域内的平均垂直速度。\n\n结合最后两个方程，得到联系这三个子域垂直速度的约束的最终形式：\n$$ a_u \\overline{w}_u + a_d \\overline{w}_d + a_e \\overline{w}_e = 0 $$\n这个方程代表了网格柱内垂直体积通量的守恒，这是非弹性连续性方程在给定边界条件下的直接结果。环境场气压 $p$、温度 $T$ 和气体常数 $R_d$ 在此计算中并不需要，因为密度项 $\\rho_0(z)$ 已被提出并消去。\n\n### 第三步：环境场垂直速度的计算\n\n我们的任务是计算 $\\overline{w}_e$。我们可以重排约束方程来解出 $\\overline{w}_e$：\n$$ a_e \\overline{w}_e = - (a_u \\overline{w}_u + a_d \\overline{w}_d) $$\n$$ \\overline{w}_e = - \\frac{a_u \\overline{w}_u + a_d \\overline{w}_d}{a_e} $$\n我们还给出了面积分数的恒等式：\n$$ a_e = 1 - a_u - a_d $$\n给定的值为：\n- 上升气流面积分数 $a_u = 0.02$\n- 下沉气流面积分数 $a_d = 0.01$\n- 上升气流平均垂直速度 $\\overline{w}_u = 5.0~\\mathrm{m\\,s^{-1}}$\n- 下沉气流平均垂直速度 $\\overline{w}_d = -2.0~\\mathrm{m\\,s^{-1}}$\n\n首先，我们计算环境场的面积分数 $a_e$：\n$$ a_e = 1 - 0.02 - 0.01 = 0.97 $$\n接下来，我们计算分子项，即气流羽对垂直速度的净贡献：\n$$ a_u \\overline{w}_u + a_d \\overline{w}_d = (0.02)(5.0~\\mathrm{m\\,s^{-1}}) + (0.01)(-2.0~\\mathrm{m\\,s^{-1}}) $$\n$$ a_u \\overline{w}_u + a_d \\overline{w}_d = 0.10~\\mathrm{m\\,s^{-1}} - 0.02~\\mathrm{m\\,s^{-1}} = 0.08~\\mathrm{m\\,s^{-1}} $$\n最后，我们将这些值代入 $\\overline{w}_e$ 的表达式中：\n$$ \\overline{w}_e = - \\frac{0.08~\\mathrm{m\\,s^{-1}}}{0.97} $$\n$$ \\overline{w}_e \\approx -0.0824742268~\\mathrm{m\\,s^{-1}} $$\n题目要求将结果四舍五入到四位有效数字。\n$$ \\overline{w}_e \\approx -0.08247~\\mathrm{m\\,s^{-1}} $$\n这个结果表明，环境场中存在微弱的大尺度下沉运动，这在物理上是必要的，用以补偿对流羽内部强烈的、局地的垂直运动，从而确保整个网格柱上的净垂直输送为零。",
            "answer": "$$ \\boxed{-0.08247} $$"
        },
        {
            "introduction": "对流方案需要一个“闭合”假设——一个决定对流总强度的规则。最后的这个练习将探讨并对比两种常见的闭合类型：一种基于平衡大尺度水汽收支，另一种基于消耗对流有效位能（CAPE）。通过从这两种不同的物理论证中计算云底质量通量，你将深入了解对流参数化中最具挑战性和最关键的方面之一。",
            "id": "4062682",
            "problem": "在一个数值天气预报模型中，一个海洋热带网格框表现出有组织的深对流。您的任务是使用两种源于质量通量对流方案和夹卷羽流模型的不同闭合概念来预测云底质量通量，并对它们进行比较。\n\n假设以下环境和羽流属性，它们对于一个对流边界层都具有代表性且物理上是合理的：\n\n- 云底气压 $p_b = 9.0 \\times 10^{4}~\\mathrm{Pa}$，温度 $T_b = 2.99 \\times 10^{2}~\\mathrm{K}$，以及比湿 $q_b = 1.4 \\times 10^{-2}$。\n- 大尺度、整层积分的天气尺度水汽辐合 $\\mathcal{C}_q = 1.20 \\times 10^{-4}~\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$。\n- 云顶（砧状云）出流比湿 $q_d = 1.0 \\times 10^{-3}$。\n- 降水效率 $\\varepsilon = 0.70$（凝结水中形成降水的部分）。\n- 入流羽流的边界层湿静力能 $h_b = 3.53 \\times 10^{5}~\\mathrm{J} \\, \\mathrm{kg}^{-1}$ 和云底的环境湿静力能 $h_{e,b} = 3.47 \\times 10^{5}~\\mathrm{J} \\, \\mathrm{kg}^{-1}$。\n- 从自由对流高度到中性浮力高度的深度 $\\Delta z = 3.50 \\times 10^{3}~\\mathrm{m}$，以及云底上升气流面积分数 $\\sigma_b = 4.0 \\times 10^{-3}$。\n- 从浮力功到上升气流动能的能量转换效率 $\\eta = 0.15$。\n- 干空气气体常数 $R_d = 2.87 \\times 10^{2}~\\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$，定压比热 $c_p = 1.004 \\times 10^{3}~\\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$，重力加速度 $g = 9.81~\\mathrm{m} \\, \\mathrm{s}^{-2}$。\n\n使用以下基于物理的依据：\n\n1. 统计稳态下的整层水汽收支将对流凝结率与大尺度天气尺度水汽辐合联系起来。\n2. 对流有效位能（CAPE）定义为气块浮力的垂直积分，它衡量了可用于加速上升气流的浮力功，从而能够通过能量转换估算云底上升气流速度的动能。\n3. 虚温 $T_v$ 通过 $T_v = T_b (1 + 0.61 \\, q_b )$ 来解释湿空气密度的影响，云底密度为 $\\rho_b = p_b / (R_d \\, T_v)$。\n\n假设羽流从云底近似湿绝热上升，使得气块湿静力能 $h_b$ 在达到饱和之前近似守恒，且云底的初始气块浮力与相对于环境的湿静力能过剩成正比。为简单起见，假设浮力在 $\\Delta z$ 深度上线性减小到零。\n\n任务：\n\n- 根据整层水汽收支，推导并计算由Tiedtke型水汽辐合闭合预测的云底质量通量，答案以 $\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$ 为单位表示。\n- 根据CAPE的定义和能量转换，推导并计算一个基于CAPE的云底质量通量估算值，答案以 $\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$ 为单位表示。\n- 最后，将Tiedtke型质量通量与基于CAPE的质量通量之比作为一个无量纲数报告。将最终比值四舍五入至三位有效数字。",
            "solution": "该问题要求计算和比较源自两种不同对流参数化闭合假设的云底质量通量：一种是水汽辐合闭合，另一种是基于CAPE的闭合。\n\n首先，我们处理Tiedtke型水汽辐合闭合。该闭合基于大气柱的稳态水汽收支。在此框架中，大尺度水汽辐合（给定为 $\\mathcal{C}_q = 1.20 \\times 10^{-4}~\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$）由降水率 $P$ 平衡。\n$$P = \\mathcal{C}_q$$\n降水率与对流系统内的总凝结率 $C$ 通过降水效率 $\\varepsilon = 0.70$ 相关联。\n$$P = \\varepsilon C$$\n通过结合这两个方程，我们可以用已知的大尺度水汽辐合来表示总凝结率：\n$$C = \\frac{\\mathcal{C}_q}{\\varepsilon}$$\n在一个简单的羽流模型中，总凝结量是对流上升气流处理过的空气中去除的水蒸气量。这可以表示为云底质量通量（我们记为 $M_{b, \\text{Tiedtke}}$）与进入云底的空气（$q_b = 1.4 \\times 10^{-2}$）和从云顶出流的空气（$q_d = 1.0 \\times 10^{-3}$）之间的比湿变化量的乘积。\n$$C = M_{b, \\text{Tiedtke}} (q_b - q_d)$$\n通过将 $C$ 的两个表达式相等，我们可以推导出云底质量通量的公式：\n$$\\frac{\\mathcal{C}_q}{\\varepsilon} = M_{b, \\text{Tiedtke}} (q_b - q_d)$$\n$$M_{b, \\text{Tiedtke}} = \\frac{\\mathcal{C}_q}{\\varepsilon (q_b - q_d)}$$\n代入所提供的数值：\n$$M_{b, \\text{Tiedtke}} = \\frac{1.20 \\times 10^{-4}}{0.70 \\times (1.4 \\times 10^{-2} - 1.0 \\times 10^{-3})} = \\frac{1.20 \\times 10^{-4}}{0.70 \\times 0.013} = \\frac{1.20 \\times 10^{-4}}{0.0091} \\approx 0.013187~\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$$\n\n其次，我们确定基于CAPE的云底质量通量估算值，记为 $M_{b, \\text{CAPE}}$。网格平均质量通量的定义由云内密度 $\\rho_b$、上升气流面积分数 $\\sigma_b$ 和上升气流垂直速度 $w_b$ 的乘积给出，所有这些都在云底进行评估。\n$$M_{b, \\text{CAPE}} = \\rho_b \\sigma_b w_b$$\n我们必须首先计算密度 $\\rho_b$ 和上升气流速度 $w_b$。密度是使用湿空气的理想气体定律确定的，这需要虚温 $T_v$。给定 $p_b = 9.0 \\times 10^{4}~\\mathrm{Pa}$，$T_b = 2.99 \\times 10^{2}~\\mathrm{K}$ 和 $q_b = 1.4 \\times 10^{-2}$：\n$$T_v = T_b (1 + 0.61 q_b) = (2.99 \\times 10^{2}) \\times (1 + 0.61 \\times 1.4 \\times 10^{-2}) = 299 \\times 1.00854 = 301.55346~\\mathrm{K}$$\n使用干空气气体常数 $R_d = 2.87 \\times 10^{2}~\\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$，密度为：\n$$\\rho_b = \\frac{p_b}{R_d T_v} = \\frac{9.0 \\times 10^4}{2.87 \\times 10^2 \\times 301.55346} \\approx 1.0399~\\mathrm{kg} \\, \\mathrm{m}^{-3}$$\n上升气流速度 $w_b$ 是从羽流的动能中推导出来的，该动能被假定为对流有效位能（CAPE）的一部分，比例为 $\\eta = 0.15$。\n$$\\frac{1}{2} w_b^2 = \\eta \\, \\mathrm{CAPE}$$\nCAPE本身是气块浮力 $B(z)$ 的垂直积分。问题指明浮力从其云底值 $B_b$ 在对流深度 $\\Delta z = 3.50 \\times 10^{3}~\\mathrm{m}$ 上线性减小到零。这意味着 $\\mathrm{CAPE} = \\frac{1}{2} B_b \\Delta z$。云底的浮力被认为与羽流的湿静力能过剩（$h_b = 3.53 \\times 10^{5}~\\mathrm{J} \\, \\mathrm{kg}^{-1}$）相对于其环境（$h_{e,b} = 3.47 \\times 10^{5}~\\mathrm{J} \\, \\mathrm{kg}^{-1}$）成正比，使用以下近似：\n$$B_b \\approx \\frac{g}{c_p T_v} (h_b - h_{e,b})$$\n在 $g = 9.81~\\mathrm{m} \\, \\mathrm{s}^{-2}$ 和 $c_p = 1.004 \\times 10^{3}~\\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$ 的条件下：\n$$B_b \\approx \\frac{9.81}{1.004 \\times 10^3 \\times 301.55346} (3.53 \\times 10^5 - 3.47 \\times 10^5) = \\frac{9.81 \\times 6000}{302760} \\approx 0.19451~\\mathrm{m} \\, \\mathrm{s}^{-2}$$\n现在我们通过代入CAPE的表达式来找到上升气流速度 $w_b$：\n$$w_b = \\sqrt{2 \\eta \\, \\mathrm{CAPE}} = \\sqrt{2 \\eta \\left(\\frac{1}{2} B_b \\Delta z\\right)} = \\sqrt{\\eta B_b \\Delta z}$$\n$$w_b = \\sqrt{0.15 \\times 0.19451 \\times 3.50 \\times 10^3} \\approx \\sqrt{102.12} \\approx 10.105~\\mathrm{m} \\, \\mathrm{s}^{-1}$$\n最后，我们组合这些分量，以求得基于CAPE的质量通量，使用 $\\sigma_b = 4.0 \\times 10^{-3}$：\n$$M_{b, \\text{CAPE}} = \\rho_b \\sigma_b w_b \\approx 1.0399 \\times (4.0 \\times 10^{-3}) \\times 10.105 \\approx 0.042035~\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$$\n\n最后的任务是计算Tiedtke型质量通量与基于CAPE的质量通量之比。\n$$\\text{比值} = \\frac{M_{b, \\text{Tiedtke}}}{M_{b, \\text{CAPE}}} \\approx \\frac{0.013187}{0.042035} \\approx 0.3137$$\n根据问题陈述的要求，将此结果四舍五入至三位有效数字：\n$$\\text{比值} \\approx 0.314$$",
            "answer": "$$\\boxed{0.314}$$"
        }
    ]
}