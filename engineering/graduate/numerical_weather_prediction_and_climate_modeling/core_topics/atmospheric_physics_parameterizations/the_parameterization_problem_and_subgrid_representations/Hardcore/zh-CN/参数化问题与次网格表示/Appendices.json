{
    "hands_on_practices": [
        {
            "introduction": "参数化方案的核心思想之一是用可解尺度上的量来表示次网格尺度过程的影响。Smagorinsky模型是湍流大涡模拟(LES)中一个经典且基础的涡粘性参数化方案。通过这个练习，你将亲手计算涡粘性系数，并将其与空气的分子粘性进行比较，从而直观地理解为什么在天气和气候模型中，湍流输运的参数化是不可或缺的，以及它在量级上意味着什么。",
            "id": "4102407",
            "problem": "在数值天气预报和气候模拟中，小于计算网格尺度的未解析湍流运动通过次网格尺度参数化来表示。一种常见的方法是涡粘性闭合，它将次网格湍流输送与解析的应变率大小进行缩放。一个被广泛使用且经过充分检验的公式是用于大涡模拟（LES）的Smagorinsky模型，它规定运动涡粘性系数为 $\\nu_t = (C_s \\Delta)^2 |S|$，其中 $C_s$ 是一个无量纲模型系数，$\\Delta$ 是取为网格间距的滤波宽度，而 $|S|$ 是解析的应变率张量的大小。\n\n考虑一个大气模型，其水平网格间距为 $\\Delta = 1\\,\\text{km}$，Smagorinsky系数为 $C_s = 0.17$，解析的切变大小为 $|S| = 10^{-2}\\,\\text{s}^{-1}$。使用Smagorinsky公式，计算运动涡粘性系数 $\\nu_t$ 并以 $\\text{m}^2\\,\\text{s}^{-1}$ 为单位表示您的最终结果。将您的答案四舍五入到四位有效数字。然后，基于第一性原理和物理上已确定的分子输运尺度，简要评论所计算的 $\\nu_t$ 相对于空气的分子运动粘性系数是否合理。",
            "solution": "该问题陈述被评估为有效。它在科学上基于计算流体力学和大气科学的原理，特别是大涡模拟（LES）和湍流模拟。该问题是适定的，提供了计算涡粘性系数唯一值所需的所有信息——Smagorinsky模型方程、模型系数、网格间距和应变率大小。所提供的值对于中尺度大气模拟是物理上现实的。量纲一致性是合理的。问题是客观的，没有歧义。\n\n该问题要求使用Smagorinsky模型公式计算运动涡粘性系数 $\\nu_t$：\n$$\n\\nu_t = (C_s \\Delta)^2 |S|\n$$\n提供的参数如下：\n- Smagorinsky系数，$C_s = 0.17$ (无量纲)。\n- 滤波宽度，由水平网格间距表示，$\\Delta = 1\\,\\text{km}$。\n- 解析的应变率张量的大小，$|S| = 10^{-2}\\,\\text{s}^{-1}$。\n\n$\\nu_t$ 的最终结果要求以 $\\text{m}^2\\,\\text{s}^{-1}$ 为单位。因此，必须首先将网格间距 $\\Delta$ 从千米转换为米。\n$$\n\\Delta = 1\\,\\text{km} = 1000\\,\\text{m}\n$$\n现在，我们将给定值代入Smagorinsky方程：\n$$\n\\nu_t = (0.17 \\times 1000\\,\\text{m})^2 \\times (10^{-2}\\,\\text{s}^{-1})\n$$\n首先，计算括号内的项，它代表混合长度 $l_s = C_s \\Delta$：\n$$\nl_s = 0.17 \\times 1000\\,\\text{m} = 170\\,\\text{m}\n$$\n接下来，对这个值进行平方：\n$$\n(l_s)^2 = (170\\,\\text{m})^2 = 28900\\,\\text{m}^2\n$$\n最后，乘以应变率大小 $|S|$：\n$$\n\\nu_t = 28900\\,\\text{m}^2 \\times 10^{-2}\\,\\text{s}^{-1} = 289\\,\\text{m}^2\\,\\text{s}^{-1}\n$$\n问题要求答案四舍五入到四位有效数字。计算出的值 $289$ 有三位有效数字。为了用四位有效数字表示，我们将其写为 $289.0$。\n$$\n\\nu_t = 289.0\\,\\text{m}^2\\,\\text{s}^{-1}\n$$\n\n问题的第二部分要求评论这个值相对于空气的分子运动粘性系数 $\\nu_{\\text{air}}$ 是否合理。在标准温度和压力下，空气的分子运动粘性系数约为 $\\nu_{\\text{air}} \\approx 1.5 \\times 10^{-5}\\,\\text{m}^2\\,\\text{s}^{-1}$。\n\n为了比较两者，我们可以考察它们的比率：\n$$\n\\frac{\\nu_t}{\\nu_{\\text{air}}} = \\frac{289.0\\,\\text{m}^2\\,\\text{s}^{-1}}{1.5 \\times 10^{-5}\\,\\text{m}^2\\,\\text{s}^{-1}} \\approx 1.93 \\times 10^7\n$$\n计算出的涡粘性系数 $\\nu_t$ 比分子运动粘性系数 $\\nu_{\\text{air}}$ 大七个数量级以上。这个结果不仅是合理的，而且在物理上是必要和预期的。“涡粘性”的概念之所以出现，是因为湍流涡在输送动量（以及热量和水分等其他量）方面远比分子扩散有效。分子粘性系数 $\\nu_{\\text{air}}$ 是与通过分子碰撞进行动量传递相关的流体内禀属性。相比之下，涡粘性系数 $\\nu_t$ 是流动本身的属性，而不是流体的属性。它参数化了小于模型网格所能解析的尺度上湍流运动的净效应。地球物理流中湍流模拟的基本前提是湍流输送主导分子输送。$\\nu_t$ 的巨大数值证实了未解析的湍流涡在次网格尺度上提供了动量扩散的主要机制，从而验证了参数化的使用。对于 $\\Delta = 1\\,\\text{km}$ 的网格分辨率，量级为 $10^2\\,\\text{m}^2\\,\\text{s}^{-1}$ 的 $\\nu_t$ 值是大气湍流中一个非常典型和现实的量值。",
            "answer": "$$\n\\boxed{289.0}\n$$"
        },
        {
            "introduction": "参数化不仅限于处理大气内部的湍流，它同样是表示地球表面次网格非均匀性的关键工具。在现代模型中，“瓦片”或“马赛克”方案被广泛用于在单个网格单元内描述不同的地表类型（如森林、水体、城市等）。这个练习将指导你如何通过面积加权平均来整合来自不同瓦片的地表通量，并检验网格尺度的能量平衡，这让你能够深入理解模型如何处理地表过程以及能量闭合这一重要概念。",
            "id": "4102396",
            "problem": "在一个陆-气耦合方案中，单个大气模式网格单元使用次网格瓦片表示法来参数化未解析的非均匀性。该网格单元被划分为 $N=5$ 个陆面瓦片，其面积分数 $\\{a_{i}\\}_{i=1}^{5}$ 满足 $\\sum_{i=1}^{5} a_{i} = 1$。对于每个瓦片 $i$，其瓦片平均感热通量 $H_{i}$ 和潜热通量 $LE_{i}$ 由陆面参数化方案提供。该模式使用以下符号约定：向上的湍流通量（$H$，$LE$）向上为正，地表热通量 $G$ 向下为正，地表净辐射 $R_{n}$ 向下为正。网格平均地表的地表能量平衡遵循能量守恒定律，即在网格尺度上，净辐射应平衡湍流通量和传导通量之和（忽略任何显式存储项），即 $R_{n} = H + LE + G$。\n\n使用以下针对夏季午间情况的物理上合理的数据：\n- 瓦片分数和瓦片湍流通量：\n  - 水体：$a_{1}=0.12$，$H_{1}=20\\,\\mathrm{W\\,m^{-2}}$，$LE_{1}=350\\,\\mathrm{W\\,m^{-2}}$。\n  - 短草：$a_{2}=0.35$，$H_{2}=180\\,\\mathrm{W\\,m^{-2}}$，$LE_{2}=220\\,\\mathrm{W\\,m^{-2}}$。\n  - 森林：$a_{3}=0.28$，$H_{3}=120\\,\\mathrm{W\\,m^{-2}}$，$LE_{3}=300\\,\\mathrm{W\\,m^{-2}}$。\n  - 裸土：$a_{4}=0.15$，$H_{4}=250\\,\\mathrm{W\\,m^{-2}}$，$LE_{4}=80\\,\\mathrm{W\\,m^{-2}}$。\n  - 城市：$a_{5}=0.10$，$H_{5}=300\\,\\mathrm{W\\,m^{-2}}$，$LE_{5}=40\\,\\mathrm{W\\,m^{-2}}$。\n- 网格单元地表辐射通量分量：\n  - 向下短波辐射：$S_{\\downarrow} = 800\\,\\mathrm{W\\,m^{-2}}$。\n  - 向上短波辐射：$S_{\\uparrow} = 200\\,\\mathrm{W\\,m^{-2}}$。\n  - 向下长波辐射：$L_{\\downarrow} = 380\\,\\mathrm{W\\,m^{-2}}$。\n  - 向上长波辐射：$L_{\\uparrow} = 570\\,\\mathrm{W\\,m^{-2}}$。\n- 网格单元地表热通量（向地下传导）：$G = 24.0\\,\\mathrm{W\\,m^{-2}}$。\n\n任务：\n1. 从空间平均的定义（面积积分除以总面积）和次网格瓦片表示法出发，通过对各瓦片进行面积加权，计算网格单元平均感热通量 $H$ 和潜热通量 $LE$。\n2. 使用辐射分量，计算地表净辐射 $R_{n}$。\n3. 在网格尺度上，使用守恒关系 $R_{n} = H + LE + G$，计算能量不平衡残差\n$$\n\\mathcal{E} = R_{n} - \\left( H + LE + G \\right).\n$$\n从地表能量守恒的角度解释 $\\mathcal{E}$ 的符号。\n\n最终答案只提供 $\\mathcal{E}$ 的值。最终答案以 $\\mathrm{W\\,m^{-2}}$ 为单位，并四舍五入到四位有效数字。",
            "solution": "在尝试求解之前，将首先根据指定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n问题陈述中提供的数据、变量、定义和条件如下：\n- 陆面瓦片数量：$N=5$。\n- 瓦片面积分数：$\\{a_{i}\\}_{i=1}^{5}$，满足 $\\sum_{i=1}^{5} a_{i} = 1$。\n- 瓦片平均感热通量：$H_{i}$。\n- 瓦片平均潜热通量：$LE_{i}$。\n- 符号约定：\n  - 向上的湍流通量（$H$，$LE$）向上为正。\n  - 地表热通量 $G$ 向下为正。\n  - 净辐射 $R_{n}$ 向下为正。\n- 网格尺度地表能量平衡方程：$R_{n} = H + LE + G$（忽略显式存储项）。\n- 瓦片1（水体）：$a_{1}=0.12$，$H_{1}=20\\,\\mathrm{W\\,m^{-2}}$，$LE_{1}=350\\,\\mathrm{W\\,m^{-2}}$。\n- 瓦片2（短草）：$a_{2}=0.35$，$H_{2}=180\\,\\mathrm{W\\,m^{-2}}$，$LE_{2}=220\\,\\mathrm{W\\,m^{-2}}$。\n- 瓦片3（森林）：$a_{3}=0.28$，$H_{3}=120\\,\\mathrm{W\\,m^{-2}}$，$LE_{3}=300\\,\\mathrm{W\\,m^{-2}}$。\n- 瓦片4（裸土）：$a_{4}=0.15$，$H_{4}=250\\,\\mathrm{W\\,m^{-2}}$，$LE_{4}=80\\,\\mathrm{W\\,m^{-2}}$。\n- 瓦片5（城市）：$a_{5}=0.10$，$H_{5}=300\\,\\mathrm{W\\,m^{-2}}$，$LE_{5}=40\\,\\mathrm{W\\,m^{-2}}$。\n- 网格单元向下短波辐射：$S_{\\downarrow} = 800\\,\\mathrm{W\\,m^{-2}}$。\n- 网格单元向上短波辐射：$S_{\\uparrow} = 200\\,\\mathrm{W\\,m^{-2}}$。\n- 网格单元向下长波辐射：$L_{\\downarrow} = 380\\,\\mathrm{W\\,m^{-2}}$。\n- 网格单元向上长波辐射：$L_{\\uparrow} = 570\\,\\mathrm{W\\,m^{-2}}$。\n- 网格单元地表热通量：$G = 24.0\\,\\mathrm{W\\,m^{-2}}$。\n- 能量不平衡残差的定义：$\\mathcal{E} = R_{n} - \\left( H + LE + G \\right)$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估：\n- **科学依据充分**：该问题描述了次网格瓦片（或镶嵌）参数化方案和地表能量平衡，这些是大气科学中的标准和基本概念，尤其是在用于数值天气预报和气候模式的陆面模拟中。所有原理和方程在科学上都是合理的。\n- **适定性**：问题是适定的。它提供了所有必要的数据和清晰的、能导出唯一解的顺序任务。面积分数之和为 $a_1+a_2+a_3+a_4+a_5 = 0.12+0.35+0.28+0.15+0.10 = 1.00$，这与约束条件 $\\sum a_i = 1$ 一致。对于所描述的情景，数据值是物理上合理的。\n- **客观性**：问题以精确、定量和无偏见的语言陈述。\n\n该问题不存在所列出的任何缺陷：\n1. 它在科学上是合理的。\n2. 这是一个与所述主题直接相关的可形式化问题。\n3. 设置是完整且一致的。\n4. 条件和数据在物理上是现实的。\n5. 结构确保了唯一解。\n6. 该问题是原理的标准应用，不是琐碎或同义反复的。\n7. 结果在数学上是可验证的。\n\n### 步骤3：结论与行动\n问题是**有效的**。将提供解答。\n\n### 解答\n该问题要求基于陆面的次网格瓦片表示法，计算网格单元的能量不平衡 $\\mathcal{E}$。解答过程如问题陈述中所述，分为三个步骤。\n\n**1. 计算网格单元平均感热通量（$H$）和潜热通量（$LE$）。**\n\n一个通量的网格单元平均值是来自各个次网格瓦片的通量的面积加权平均值。对于一个通用通量 $X$，其网格平均值（为简单起见，我们记为 $X$）由对 $N$ 个瓦片的求和给出：\n$$\nX = \\sum_{i=1}^{N} a_{i} X_{i}\n$$\n其中 $a_{i}$ 是瓦片 $i$ 的面积分数，$X_{i}$ 是该瓦片的平均通量。\n\n使用提供的感热通量 $H$ 的数据：\n$$\nH = \\sum_{i=1}^{5} a_{i} H_{i} = a_{1}H_{1} + a_{2}H_{2} + a_{3}H_{3} + a_{4}H_{4} + a_{5}H_{5}\n$$\n代入数值：\n$$\nH = (0.12)(20) + (0.35)(180) + (0.28)(120) + (0.15)(250) + (0.10)(300)\n$$\n$$\nH = 2.4 + 63.0 + 33.6 + 37.5 + 30.0 = 166.5\\,\\mathrm{W\\,m^{-2}}\n$$\n\n类似地，对于潜热通量 $LE$：\n$$\nLE = \\sum_{i=1}^{5} a_{i} LE_{i} = a_{1}LE_{1} + a_{2}LE_{2} + a_{3}LE_{3} + a_{4}LE_{4} + a_{5}LE_{5}\n$$\n代入数值：\n$$\nLE = (0.12)(350) + (0.35)(220) + (0.28)(300) + (0.15)(80) + (0.10)(40)\n$$\n$$\nLE = 42.0 + 77.0 + 84.0 + 12.0 + 4.0 = 219.0\\,\\mathrm{W\\,m^{-2}}\n$$\n\n**2. 计算地表净辐射 $R_{n}$。**\n\n净辐射 $R_{n}$ 是净短波辐射通量和净长波辐射通量之和。约定是向下的通量对地表能量收支有正贡献，向上的通量有负贡献。鉴于问题陈述 $R_n$ 向下为正，我们可以写出：\n$$\nR_{n} = (S_{\\downarrow} - S_{\\uparrow}) + (L_{\\downarrow} - L_{\\uparrow})\n$$\n其中 $S_{\\downarrow}$ 和 $L_{\\downarrow}$ 是向下短波和长波分量，而 $S_{\\uparrow}$ 和 $L_{\\uparrow}$ 是向上分量。\n代入给定的网格单元辐射通量分量：\n$$\nR_{n} = (800\\,\\mathrm{W\\,m^{-2}} - 200\\,\\mathrm{W\\,m^{-2}}) + (380\\,\\mathrm{W\\,m^{-2}} - 570\\,\\mathrm{W\\,m^{-2}})\n$$\n$$\nR_{n} = 600\\,\\mathrm{W\\,m^{-2}} - 190\\,\\mathrm{W\\,m^{-2}} = 410\\,\\mathrm{W\\,m^{-2}}\n$$\n\n**3. 计算能量不平衡残差 $\\mathcal{E}$ 并解释其符号。**\n\n问题将能量不平衡残差定义为 $\\mathcal{E} = R_{n} - \\left( H + LE + G \\right)$。地表能量平衡方程 $R_{n} = H + LE + G$ 代表能量守恒，其中 $R_{n}$ 是来自辐射的地表净能量输入，而 $H$、$LE$ 和 $G$ 是通过向大气的湍流输送和向地下的传导从地表输出的能量。给定的符号约定（$R_n$ 和 $G$ 向下为正；$H$ 和 $LE$ 向上为正）与此物理诠释一致。非零的 $\\mathcal{E}$ 表明参数化的通量未能完美地使能量收支闭合。\n\n使用前面步骤计算出的值以及给定的 $G$ 值：\n$$\nH = 166.5\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\nLE = 219.0\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\nR_{n} = 410\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\nG = 24.0\\,\\mathrm{W\\,m^{-2}}\n$$\n我们计算输出通量之和：\n$$\nH + LE + G = 166.5 + 219.0 + 24.0 = 409.5\\,\\mathrm{W\\,m^{-2}}\n$$\n现在，我们计算残差 $\\mathcal{E}$：\n$$\n\\mathcal{E} = R_{n} - (H + LE + G) = 410 - 409.5 = 0.5\\,\\mathrm{W\\,m^{-2}}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n\\mathcal{E} = 0.5000\\,\\mathrm{W\\,m^{-2}}\n$$\n\n**符号解释：**\n残差 $\\mathcal{E}$ 为正。这意味着输入到地表的能量（$R_{n}$）大于从地表输出的能量总和（$H + LE + G$）。\n$$\nR_{n}  H + LE + G\n$$\n这种正的不平衡表明地表存在净能量盈余。在一个物理系统中，这部分多余的能量会用于地表自身的升温，这个过程由一个在所提供的理想化能量平衡方程中被忽略的显式存储项来表示。非零残差 $\\mathcal{E}$ 是数值模式中的一个常见问题，通常被称为“能量不闭合”问题。",
            "answer": "$$\n\\boxed{0.5000}\n$$"
        },
        {
            "introduction": "除了湍流和地表过程，对流是另一个必须进行参数化的关键次网格过程，因为它对大气的垂直热量和水分输送至关重要。这个综合性练习要求你从头开始构建一个一维的卷夹湿羽流模型。通过实现这个模型，你将把热力学、动力学和数值方法结合起来，模拟一个完整的次网格对流过程，这不仅能加深你对对流参数化物理基础的理解，还能锻炼你的科学计算和编程能力。",
            "id": "4102434",
            "problem": "一个垂直上升的、夹带水汽的湿羽流被表示为一个整体上升气流，其热力学状态因与环境混合而随高度演变。考虑一个在 $z=0$ 处初始化的上升气流，其温度为 $T_0$（单位 $\\mathrm{K}$），总水比湿为 $q_{t0}$（单位 $\\mathrm{kg/kg}$）。环境由温度廓线 $T_e(z)$（单位 $\\mathrm{K}$）、压力廓线 $p(z)$（单位 $\\mathrm{Pa}$）和环境总水比湿 $q_{te}(z)$（单位 $\\mathrm{kg/kg}$）指定。混合通过单位高度的夹带率 $\\epsilon(z)$（单位 $\\mathrm{m^{-1}}$）进行参数化，其遵循 $\\epsilon(z)=\\epsilon_0 \\exp(-z/H)$，其中 $\\epsilon_0$（单位 $\\mathrm{m^{-1}}$）和 $H$（单位 $\\mathrm{m}$）是给定的常数。\n\n羽流状态由湿静力能 $m(z)$（单位 $\\mathrm{J/kg}$）和总水比湿 $q_t(z)$（单位 $\\mathrm{kg/kg}$）描述。湿静力能定义为 $m(z)=c_p T(z)+g z + L_v q_v(z)$，其中 $c_p$ 是干空气的定压比热（单位 $\\mathrm{J/(kg\\,K)}$），$g$ 是重力加速度（单位 $\\mathrm{m/s^2}$），$L_v$ 是汽化潜热（单位 $\\mathrm{J/kg}$），$q_v(z)$ 是水汽比湿（单位 $\\mathrm{kg/kg}$）。假设羽流在每个高度层都进行饱和调整：如果 $q_t(z)\\le q_{\\mathrm{sat}}(T(z),p(z))$，则羽流未饱和，此时 $q_v(z)=q_t(z)$ 且液态水含量 $q_\\ell(z)=0$；否则，羽流饱和，此时 $q_v(z)=q_{\\mathrm{sat}}(T(z),p(z))$ 且 $q_\\ell(z)=q_t(z)-q_v(z)$。\n\n在夹带假设下，羽流的整体演变方程为\n$$\n\\frac{d m}{dz}=\\epsilon(z)\\left[m_e(z)-m(z)\\right], \\qquad \\frac{d q_t}{dz}=\\epsilon(z)\\left[q_{te}(z)-q_t(z)\\right],\n$$\n其中环境湿静力能 $m_e(z)$ 在 $m_e(z)=c_p T_e(z)+g z + L_v q_{ve}(z)$ 中使用 $q_{ve}(z)=\\min\\left(q_{te}(z),\\,q_{\\mathrm{sat}}(T_e(z),p(z))\\right)$。\n\n压力廓线由测高指数形式 $p(z)=p_0 \\exp(-z/H_p)$ 近似，其中 $p_0$ 是地面压力（单位 $\\mathrm{Pa}$），$H_p$ 是给定的压力标高（单位 $\\mathrm{m}$）。环境温度廓线为 $T_e(z)=T_{e0}-\\Gamma z$，其中 $\\Gamma$ 是一个常数递减率（单位 $\\mathrm{K/m}$），环境总水含量为 $q_{te}(z)=\\mathrm{RH}_e \\, q_{\\mathrm{sat}}(T_e(z),p(z))$，其中 $\\mathrm{RH}_e$ 是环境相对湿度（一个在 $[0,1]$ 范围内的无量纲分数）。饱和比湿 $q_{\\mathrm{sat}}(T,p)$ 由饱和水汽压 $e_s(T)$ 通过 Clausius–Clapeyron 方程定义：\n$$\ne_s(T)=e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0^{\\mathrm{ref}}}-\\frac{1}{T}\\right)\\right), \\qquad q_{\\mathrm{sat}}(T,p)=\\frac{\\epsilon_{\\mathrm{mv}}\\, e_s(T)}{p-\\left(1-\\epsilon_{\\mathrm{mv}}\\right) e_s(T)},\n$$\n其中 $e_0$ 是在参考温度 $T_0^{\\mathrm{ref}}$ 时的参考饱和水汽压， $R_v$ 是水汽的气体常数（单位 $\\mathrm{J/(kg\\,K)}$），$\\epsilon_{\\mathrm{mv}}=R_d/R_v$，其中 $R_d$ 是干空气的气体常数（单位 $\\mathrm{J/(kg\\,K)}$）。\n\n$z=0$ 处的初始化如下。上升气流的总水含量 $q_{t0}$ 由上升气流相对湿度 $\\mathrm{RH}_u$ 设定为 $q_{t0}=\\min\\left(\\mathrm{RH}_u \\, q_{\\mathrm{sat}}(T_0,p_0),\\, q_{\\mathrm{sat}}(T_0,p_0)\\right)$（单位 $\\mathrm{kg/kg}$），初始湿静力能为 $m(0)=c_p T_0 + L_v q_v(0)$，其中 $q_v(0)=\\min\\left(q_{t0}, q_{\\mathrm{sat}}(T_0,p_0)\\right)$。\n\n将云底高度 $z_b$（单位 $\\mathrm{m}$）定义为羽流中首次出现液态水 $q_\\ell(z)0$ 的高度。将云顶高度 $z_t$（单位 $\\mathrm{m}$）定义为在 $z_b$ 之上，由于夹带稀释作用，$q_\\ell(z)$ 首次返回零的高度，即 $q_t(z)\\le q_{\\mathrm{sat}}(T(z),p(z))$。云深为 $D=z_t-z_b$（单位 $\\mathrm{m}$）。如果羽流从未达到饱和，则设 $D=0$。如果羽流达到饱和但 $q_\\ell(z)0$ 的状态一直持续到计算域顶部 $z_{\\max}$，则设 $D=z_{\\max}-z_b$。\n\n从上述基本定义和方程出发，推导一个算法，使用均匀步长 $\\Delta z$（单位 $\\mathrm{m}$）的显式垂直离散化方法计算羽流随高度的演变，并通过求解与 $m(z)=c_p T(z)+g z + L_v q_v(z)$ 和饱和约束一致的温度 $T(z)$，在每个高度层实施饱和调整。在饱和情况下，这需要在每个高度求解标量非线性方程\n$$\nf(T;z)=c_p T + L_v q_{\\mathrm{sat}}(T,p(z)) + g z - m(z)=0\n$$\n以得到 $T$。使用一个稳健的、基于区间法的求根方法，在一个物理上合理的温度区间内求解 $f(T;z)=0$。\n\n所有物理量均使用上述指定单位表示。最终要求的输出是每个测试用例的云深 $D$（单位 $\\mathrm{m}$），四舍五入到最近的米并以整数形式返回。\n\n您的程序应产生单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,result3]”）。\n\n测试套件。使用以下五个测试用例，每个用例由 $(\\epsilon_0, H, T_0, \\mathrm{RH}_u, \\mathrm{RH}_e, \\Gamma, z_{\\max})$ 指定：\n1. $(1.0\\times 10^{-4}\\ \\mathrm{m^{-1}},\\ 1500\\ \\mathrm{m},\\ 301\\ \\mathrm{K},\\ 0.95,\\ 0.70,\\ 6.5\\times 10^{-3}\\ \\mathrm{K/m},\\ 5000\\ \\mathrm{m})$\n2. $(2.0\\times 10^{-5}\\ \\mathrm{m^{-1}},\\ 2000\\ \\mathrm{m},\\ 303\\ \\mathrm{K},\\ 0.95,\\ 0.60,\\ 6.0\\times 10^{-3}\\ \\mathrm{K/m},\\ 6000\\ \\mathrm{m})$\n3. $(5.0\\times 10^{-4}\\ \\mathrm{m^{-1}},\\ 800\\ \\mathrm{m},\\ 300.5\\ \\mathrm{K},\\ 0.90,\\ 0.70,\\ 6.5\\times 10^{-3}\\ \\mathrm{K/m},\\ 3000\\ \\mathrm{m})$\n4. $(1.0\\times 10^{-4}\\ \\mathrm{m^{-1}},\\ 1500\\ \\mathrm{m},\\ 300\\ \\mathrm{K},\\ 0.80,\\ 0.30,\\ 7.0\\times 10^{-3}\\ \\mathrm{K/m},\\ 4000\\ \\mathrm{m})$\n5. $(1.0\\times 10^{-5}\\ \\mathrm{m^{-1}},\\ 3000\\ \\mathrm{m},\\ 302\\ \\mathrm{K},\\ 0.98,\\ 0.90,\\ 5.0\\times 10^{-3}\\ \\mathrm{K/m},\\ 6000\\ \\mathrm{m})$\n\n使用均匀的垂直步长 $\\Delta z=20\\ \\mathrm{m}$、地面压力 $p_0=101325\\ \\mathrm{Pa}$ 和压力标高 $H_p=8000\\ \\mathrm{m}$。常数为 $c_p=1004\\ \\mathrm{J/(kg\\,K)}$，$g=9.81\\ \\mathrm{m/s^2}$，$L_v=2.5\\times 10^{6}\\ \\mathrm{J/kg}$，$R_d=287\\ \\mathrm{J/(kg\\,K)}$，$R_v=461\\ \\mathrm{J/(kg\\,K)}$，$e_0=611.2\\ \\mathrm{Pa}$，以及用于 Clausius–Clapeyron 关系的 $T_0^{\\mathrm{ref}}=273.15\\ \\mathrm{K}$。本问题不使用角度。相对湿度等百分比必须以 $[0,1]$ 范围内的无量纲分数形式提供和解释。",
            "solution": "在通过标准物理假设解决了两个次要的模糊之处后，该问题被认为是有效的。首先，环境温度廓线给出为 $T_e(z)=T_{e0}-\\Gamma z$，但并未明确提供地面环境温度 $T_{e0}$。在此类理想化模型中，一个标准的惯例是假设地表环境与初始羽流处于热平衡状态，因此我们对每个测试用例都设置 $T_{e0} = T_0$，其中 $T_0$ 是给定的初始羽流温度。其次，Clausius-Clapeyron 方程使用了符号 $T_0$ 书写，该符号也用于表示可变的初始羽流温度。常数列表提供了一个特定的参考温度 $T_0^{\\mathrm{ref}}=273.15\\ \\mathrm{K}$ 和参考压力 $e_0=611.2\\ \\mathrm{Pa}$，它们是水凝固点的标准参考值。使用变量 $T_0$ 在物理上是不一致的。因此，我们解释该方程应使用常数参考温度 $T_0^{\\mathrm{ref}}$，即 $e_s(T)=e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0^{\\mathrm{ref}}}-\\frac{1}{T}\\right)\\right)$。经过这些澄清，该问题是适定的且科学上是合理的。\n\n解决方案涉及对一维夹带羽流模型的一组常微分方程（ODEs）进行数值积分。羽流的状态由其湿静力能 $m(z)$ 和总水比湿 $q_t(z)$ 作为高度 $z$ 的函数来描述。我们使用显式前向欧拉方法，垂直步长为 $\\Delta z = 20\\ \\mathrm{m}$。\n\n首先，我们根据问题陈述定义所有物理常数和辅助函数。\n常数为：$c_p=1004\\ \\mathrm{J/(kg\\,K)}$，$g=9.81\\ \\mathrm{m/s^2}$，$L_v=2.5\\times 10^{6}\\ \\mathrm{J/kg}$，$R_d=287\\ \\mathrm{J/(kg\\,K)}$，$R_v=461\\ \\mathrm{J/(kg\\,K)}$，$e_0=611.2\\ \\mathrm{Pa}$，和 $T_0^{\\mathrm{ref}}=273.15\\ \\mathrm{K}$。由此我们推导出 $\\epsilon_{\\mathrm{mv}}=R_d/R_v$。\n大气廓线和物理关系为：\n压力：$p(z)=p_0 \\exp(-z/H_p)$，其中 $p_0=101325\\ \\mathrm{Pa}$ 且 $H_p=8000\\ \\mathrm{m}$。\n饱和水汽压：$e_s(T)=e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0^{\\mathrm{ref}}}-\\frac{1}{T}\\right)\\right)$。\n饱和比湿：$q_{\\mathrm{sat}}(T,p)=\\frac{\\epsilon_{\\mathrm{mv}}\\, e_s(T)}{p-\\left(1-\\epsilon_{\\mathrm{mv}}\\right) e_s(T)}$。\n夹带率：$\\epsilon(z)=\\epsilon_0 \\exp(-z/H)$。\n环境温度：$T_e(z)=T_0-\\Gamma z$。\n环境总水含量：$q_{te}(z)=\\mathrm{RH}_e \\, q_{\\mathrm{sat}}(T_e(z),p(z))$。\n环境湿静力能：$m_e(z)=c_p T_e(z)+g z + L_v q_{te}(z)$，因为当 $\\mathrm{RH}_e \\le 1$ 时，环境水汽 $q_{ve}(z)$ 等于 $q_{te}(z)$。\n\n对于每个测试用例，算法按以下步骤进行：\n\n1.  **在 $z=0$ 处初始化**：\n    羽流从 $z=0$ 开始，温度为 $T_0$，地面压力为 $p_0=p(0)$。\n    计算地面的饱和比湿：$q_{\\mathrm{sat},0} = q_{\\mathrm{sat}}(T_0, p_0)$。\n    初始总水比湿由上升气流相对湿度 $\\mathrm{RH}_u$ 设定：$q_t(0) = \\mathrm{RH}_u \\cdot q_{\\mathrm{sat},0}$。由于 $\\mathrm{RH}_u \\le 1$，羽流初始未饱和，因此液态水含量 $q_\\ell(0)=0$，水汽比湿为 $q_v(0) = q_t(0)$。\n    初始湿静力能为 $m(0) = c_p T_0 + L_v q_v(0)$。$gz$ 项为零。\n\n2.  **垂直积分与饱和调整**：\n    我们从 $z=0$ 到 $z_{\\max}$ 以 $\\Delta z$ 为步长进行迭代。设高度 $z_{i-1}$ 处的状态为 $(m_{i-1}, q_{t,i-1})$。下一层 $z_i=z_{i-1}+\\Delta z$ 处的状态分两个阶段求得。\n\n    a. **显式积分**：我们首先使用前向欧拉法对控制性常微分方程进行更新，以更新守恒变量 $m$ 和 $q_t$：\n    $$m_i = m_{i-1} + \\Delta z \\cdot \\epsilon(z_{i-1})\\left[m_e(z_{i-1}) - m_{i-1}\\right]$$\n    $$q_{t,i} = q_{t,i-1} + \\Delta z \\cdot \\epsilon(z_{i-1})\\left[q_{te}(z_{i-1}) - q_{t,i-1}\\right]$$\n    其中环境属性和夹带率在上一高度 $z_{i-1}$ 处进行评估。\n\n    b. **饱和调整**：利用在高度 $z_i$ 处的新值 $m_i$ 和 $q_{t,i}$，我们诊断羽流的热力学状态（$T_i, q_{v,i}, q_{\\ell,i}$）。\n    首先，我们测试羽流是否未饱和。如果是这样，所有总水将都是水汽（$q_{v,i} = q_{t,i}$），温度 $T_i^{\\text{unsat}}$ 将由湿静力能的定义给出：$T_i^{\\text{unsat}} = (m_i - g z_i - L_v q_{t,i}) / c_p$。\n    然后我们通过计算在这个假设温度下的饱和比湿 $q_{\\mathrm{sat}}(T_i^{\\text{unsat}}, p_i)$ 来检查此假设的一致性。\n    - 如果 $q_{t,i} \\le q_{\\mathrm{sat}}(T_i^{\\text{unsat}}, p_i)$，则未饱和假设是正确的。状态为 $T_i = T_i^{\\text{unsat}}$，$q_{v,i} = q_{t,i}$，以及 $q_{\\ell,i} = 0$。\n    - 如果 $q_{t,i}  q_{\\mathrm{sat}}(T_i^{\\text{unsat}}, p_i)$，则气块在 $T_i^{\\text{unsat}}$ 时是过饱和的，并且必须凝结水以达到平衡。因此，它是饱和的。我们必须通过求解将两种 MSE 表达式等同起来的非线性标量方程来找到新的平衡温度 $T_i$：\n    $$f(T_i; z_i) = c_p T_i + L_v q_{\\mathrm{sat}}(T_i, p_i) + g z_i - m_i = 0$$\n    该方程在一个物理上合理的温度区间（例如 $[150\\ \\mathrm{K}, 350\\ \\mathrm{K}]$）内，使用一个稳健的求根算法（Brent 法）进行数值求解以得到 $T_i$。\n    一旦找到饱和温度 $T_i$，水汽由饱和值给出，$q_{v,i} = q_{\\mathrm{sat}}(T_i, p_i)$，液态水含量是剩余部分，$q_{\\ell,i} = q_{t,i} - q_{v,i}$。\n\n3.  **云边界检测**：\n    在垂直积分过程中，我们监测液态水含量 $q_\\ell(z)$。\n    - **云底** $z_b$ 定义为第一个使 $q_{\\ell,i}$ 变为正值（大于一个小的数值公差）的高度 $z_i  0$。\n    - **云顶** $z_t$ 定义为第一个在 $z_b$ 之上，使 $q_{\\ell,i}$ 返回到零的高度 $z_i$。\n\n4.  **云深计算**：\n    在整个垂直域的积分完成后，云深 $D$ 的计算如下：\n    - 如果没有找到云底（$q_\\ell(z)$ 始终为零），则 $D=0$。\n    - 如果找到了云底 $z_b$ 但在达到 $z_{\\max}$ 之前没有找到云顶 $z_t$（即 $q_\\ell(z_{\\max})  0$），则 $D=z_{\\max}-z_b$。\n    - 如果云底 $z_b$ 和云顶 $z_t$ 都找到了，则 $D=z_t-z_b$。\n    $D$ 的最终值四舍五入到最近的整数。对每个测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves for the cloud depth of a moist entraining plume for several test cases.\n    \"\"\"\n\n    # --- Physical Constants ---\n    CP = 1004.0      # J/(kg K), specific heat of dry air at constant pressure\n    G = 9.81         # m/s^2, gravitational acceleration\n    LV = 2.5e6       # J/kg, latent heat of vaporization\n    RD = 287.0       # J/(kg K), gas constant for dry air\n    RV = 461.0       # J/(kg K), gas constant for water vapor\n    EPS_MV = RD / RV # Ratio of gas constants\n    E0 = 611.2       # Pa, reference saturation vapor pressure\n    T0_REF = 273.15  # K, reference temperature for Clausius-Clapeyron\n\n    # --- Model Parameters ---\n    P0 = 101325.0    # Pa, surface pressure\n    HP = 8000.0      # m, pressure scale height\n    DZ = 20.0        # m, vertical step size\n\n    # --- Test Cases ---\n    # (epsilon_0 [m-1], H [m], T_0 [K], RH_u, RH_e, Gamma [K/m], z_max [m])\n    test_cases = [\n        (1.0e-4, 1500, 301, 0.95, 0.70, 6.5e-3, 5000),\n        (2.0e-5, 2000, 303, 0.95, 0.60, 6.0e-3, 6000),\n        (5.0e-4, 800, 300.5, 0.90, 0.70, 6.5e-3, 3000),\n        (1.0e-4, 1500, 300, 0.80, 0.30, 7.0e-3, 4000),\n        (1.0e-5, 3000, 302, 0.98, 0.90, 5.0e-3, 6000),\n    ]\n\n    # --- Helper Functions ---\n    def pressure(z):\n        return P0 * np.exp(-z / HP)\n\n    def saturation_vapor_pressure(T):\n        return E0 * np.exp((LV / RV) * (1 / T0_REF - 1 / T))\n\n    def saturation_specific_humidity(T, p):\n        es = saturation_vapor_pressure(T)\n        denom = p - (1 - EPS_MV) * es\n        if denom = 0:\n            return np.inf\n        return (EPS_MV * es) / denom\n\n    def entrainment_rate(z, epsilon_0, H):\n        return epsilon_0 * np.exp(-z / H)\n\n    def environmental_temperature(z, T0_env, Gamma):\n        return T0_env - Gamma * z\n\n    def environmental_total_water(z, T0_env, Gamma, RH_e):\n        Te_z = environmental_temperature(z, T0_env, Gamma)\n        p_z = pressure(z)\n        q_sat_e = saturation_specific_humidity(Te_z, p_z)\n        return RH_e * q_sat_e\n\n    def environmental_mse(z, T0_env, Gamma, RH_e):\n        Te_z = environmental_temperature(z, T0_env, Gamma)\n        qte_z = environmental_total_water(z, T0_env, Gamma, RH_e)\n        return CP * Te_z + G * z + LV * qte_z\n\n    def sat_adj_func(T, z, p_z, m_z):\n        q_sat = saturation_specific_humidity(T, p_z)\n        return CP * T + LV * q_sat + G * z - m_z\n\n    def solve_plume_evolution(params):\n        epsilon_0, H, T0, RH_u, RH_e, Gamma, z_max = params\n        \n        z_levels = np.arange(0, z_max + DZ, DZ)\n        num_levels = len(z_levels)\n        \n        m = np.zeros(num_levels)\n        qt = np.zeros(num_levels)\n        ql = np.zeros(num_levels)\n        \n        # Initialization at z = 0\n        z0 = 0.0\n        p0_val = pressure(z0)\n        q_sat_0 = saturation_specific_humidity(T0, p0_val)\n        qt[0] = RH_u * q_sat_0\n        qv0 = qt[0]\n        ql[0] = 0.0\n        m[0] = CP * T0 + LV * qv0\n        \n        z_b, z_t = 0.0, 0.0\n        cloud_base_found = False\n        ql_threshold = 1e-12\n\n        for i in range(1, num_levels):\n            z_prev, z_curr = z_levels[i-1], z_levels[i]\n            \n            # Use T0 as environmental surface temperature\n            me_prev = environmental_mse(z_prev, T0, Gamma, RH_e)\n            qte_prev = environmental_total_water(z_prev, T0, Gamma, RH_e)\n            eps_prev = entrainment_rate(z_prev, epsilon_0, H)\n            \n            # Forward Euler step\n            m[i] = m[i-1] + DZ * eps_prev * (me_prev - m[i-1])\n            qt[i] = qt[i-1] + DZ * eps_prev * (qte_prev - qt[i-1])\n            \n            p_curr = pressure(z_curr)\n            \n            # Assume unsaturated\n            T_unsat = (m[i] - G * z_curr - LV * qt[i]) / CP\n            q_sat_at_T_unsat = saturation_specific_humidity(T_unsat, p_curr)\n            \n            if qt[i] = q_sat_at_T_unsat:\n                ql[i] = 0.0\n            else: # Saturated\n                T_low, T_high = 150.0, 350.0\n                try:\n                    T_sat = optimize.brentq(sat_adj_func, T_low, T_high, args=(z_curr, p_curr, m[i]))\n                    qv_sat = saturation_specific_humidity(T_sat, p_curr)\n                    ql[i] = max(0, qt[i] - qv_sat)\n                except ValueError:\n                    ql[i] = 0.0\n\n            if not cloud_base_found and ql[i]  ql_threshold:\n                z_b = z_curr\n                cloud_base_found = True\n            \n            if cloud_base_found and ql[i] = ql_threshold and z_t == 0.0:\n                z_t = z_curr\n        \n        if not cloud_base_found:\n            D = 0.0\n        elif z_t == 0.0:\n            D = z_max - z_b\n        else:\n            D = z_t - z_b\n            \n        return int(round(D))\n\n    results = []\n    for params in test_cases:\n        depth = solve_plume_evolution(params)\n        results.append(depth)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}