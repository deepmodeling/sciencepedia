{
    "hands_on_practices": [
        {
            "introduction": "The correlated-k method's core strength lies in its ability to transform the complex, rapidly varying structure of gaseous absorption spectra into a smooth, monotonic function. This exercise guides you through the fundamental algorithm for this transformation: re-sorting monochromatic absorption coefficients to build a numerical representation of the k-distribution, $k(g)$. By implementing this process and using the resulting function to compute band transmittance, you will gain a concrete understanding of how high-resolution spectral data is made computationally tractable for radiative transfer models .",
            "id": "4028159",
            "problem": "You are given a discrete set of monochromatic absorption coefficients $k_{\\nu}$ sampled across a single spectral band for a homogeneous atmospheric layer. Starting from the Beer–Lambert law and the definition of a cumulative distribution over the monochromatic absorption coefficients, you must design and implement an algorithm to construct a numerical approximation of the $k$-distribution function $k(g)$ and then compute the band transmittance using $N$ equally spaced $g$-points.\n\nUse the following fundamental base:\n- The Beer–Lambert law relates monochromatic transmittance $T_{\\nu}$ to absorption coefficient $k_{\\nu}$ and absorber path amount $u$ by $T_{\\nu}=\\exp\\!\\left(-k_{\\nu}\\,u\\right)$.\n- The band transmittance may be represented as an average over the cumulative probability space of $k_{\\nu}$ values, using the cumulative distribution function (CDF) of absorption coefficients across the band.\n\nYour task is to:\n- Treat the set $\\{k_{\\nu}\\}$ as samples drawn from the absorption coefficient distribution across the band.\n- Construct a monotone approximation $k(g)$ by rank-ordering the samples and defining an associated cumulative coordinate $g\\in(0,1)$.\n- Use $N$ equally spaced $g$-points in the open interval $(0,1)$ to evaluate $\\exp\\!\\left(-k(g)\\,u\\right)$ and form the arithmetic mean as the band transmittance.\n\nNumerical and unit requirements:\n- Absorption coefficients $k_{\\nu}$ are provided in square meters per kilogram ($\\mathrm{m^2\\,kg^{-1}}$).\n- The absorber path amount $u$ is provided in kilograms per square meter ($\\mathrm{kg\\,m^{-2}}$).\n- The band transmittance is dimensionless and must be expressed as a decimal rounded to eight digits after the decimal point.\n- Angles are not involved in this problem.\n\nAlgorithmic constraints:\n- Define the cumulative coordinate for the sorted samples using midpoints so that for $M$ samples, the sorted cumulative positions are $g_{j}=\\dfrac{j+1/2}{M}$ for $j\\in\\{0,1,\\dots,M-1\\}$.\n- Approximate $k(g)$ by piecewise-linear interpolation on the points $\\{(g_{j}, k_{(j)})\\}$, where $k_{(j)}$ is the $j$-th element of the ascending sort of $\\{k_{\\nu}\\}$.\n- Evaluate at $N$ equally spaced midpoints $g_{i}=\\dfrac{i+1/2}{N}$ for $i\\in\\{0,1,\\dots,N-1\\}$.\n- Compute the band transmittance as the arithmetic mean over these $N$ evaluations.\n\nTest suite:\nCompute the band transmittance for each of the following parameter sets. Each result must be a single float (rounded to eight digits after the decimal point).\n\n- Case $1$ (general, multi-scale distribution): $k_{\\nu}=\\left[1.0\\times 10^{-3},\\,5.0\\times 10^{-3},\\,2.0\\times 10^{-2},\\,4.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,2.0\\times 10^{-1},\\,5.0\\times 10^{-1},\\,1.0,\\,2.0,\\,5.0,\\,10.0,\\,20.0\\right]$ in $\\mathrm{m^2\\,kg^{-1}}$, $u=0.01$ in $\\mathrm{kg\\,m^{-2}}$, $N=10$.\n- Case $2$ (boundary in quadrature size): $k_{\\nu}=\\left[1.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,1.0,\\,10.0,\\,100.0\\right]$ in $\\mathrm{m^2\\,kg^{-1}}$, $u=0.1$ in $\\mathrm{kg\\,m^{-2}}$, $N=1$.\n- Case $3$ (uniform absorption coefficients): $k_{\\nu}=\\left[5.0\\times 10^{-2},\\,5.0\\times 10^{-2},\\,5.0\\times 10^{-2},\\,5.0\\times 10^{-2},\\,5.0\\times 10^{-2},\\,5.0\\times 10^{-2},\\,5.0\\times 10^{-2},\\,5.0\\times 10^{-2}\\right]$ in $\\mathrm{m^2\\,kg^{-1}}$, $u=1.0$ in $\\mathrm{kg\\,m^{-2}}$, $N=4$.\n- Case $4$ (including zeros and strong lines): $k_{\\nu}=\\left[0.0,\\,0.0,\\,0.0,\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,1.0,\\,10.0\\right]$ in $\\mathrm{m^2\\,kg^{-1}}$, $u=10.0$ in $\\mathrm{kg\\,m^{-2}}$, $N=7$.\n- Case $5$ (highly skewed distribution): $k_{\\nu}=\\left[1.0\\times 10^{-6},\\,2.0\\times 10^{-6},\\,5.0\\times 10^{-6},\\,1.0\\times 10^{-5},\\,2.0\\times 10^{-5},\\,5.0\\times 10^{-5},\\,1.0\\times 10^{-4},\\,2.0\\times 10^{-4},\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-1}\\right]$ in $\\mathrm{m^2\\,kg^{-1}}$, $u=2.0$ in $\\mathrm{kg\\,m^{-2}}$, $N=16$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The five band transmittance values must appear in the order of the test suite above. For example: $[t_{1},t_{2},t_{3},t_{4},t_{5}]$, where each $t_{i}$ is a decimal rounded to eight digits after the decimal point.",
            "solution": "The user-provided problem has been rigorously validated and is deemed to be scientifically sound, well-posed, objective, and complete. All necessary data and algorithmic specifications are provided, and the problem is grounded in established principles of atmospheric radiative transfer. We may therefore proceed with a complete solution.\n\nThe core of this problem is to approximate the spectrally-averaged transmittance over a band, $\\bar{T}$, using the correlated-$k$ distribution method. The fundamental principle is a transformation of the integration variable from spectral frequency, $\\nu$, to the absorption coefficient, $k$.\n\nThe monochromatic transmittance, $T_\\nu$, through a homogeneous atmospheric layer with absorber path amount $u$ is given by the Beer–Lambert law:\n$$ T_\\nu = \\exp(-k_\\nu u) $$\nwhere $k_\\nu$ is the monochromatic absorption coefficient.\n\nThe band-averaged transmittance, $\\bar{T}$, is the arithmetic mean of $T_\\nu$ over the spectral band $\\Delta\\nu$:\n$$ \\bar{T} = \\frac{1}{\\Delta\\nu} \\int_{\\Delta\\nu} T_\\nu \\,d\\nu = \\frac{1}{\\Delta\\nu} \\int_{\\Delta\\nu} \\exp(-k_\\nu u) \\,d\\nu $$\nThe correlated-$k$ method reformulates this integral by considering the statistical distribution of $k_\\nu$ values across the band. We introduce a cumulative distribution function (CDF), $g(k)$, defined as the fraction of the spectral band where the absorption coefficient is less than or equal to a value $k$. The inverse of this function, $k(g)$, maps a cumulative probability $g \\in (0,1)$ to a specific absorption coefficient value. Since $g$ is uniformly distributed over the interval $(0,1)$, the integral for the band transmittance can be rewritten as:\n$$ \\bar{T} = \\int_0^1 \\exp(-k(g) u) \\,dg $$\nThis formulation is exact. The problem requires us to construct a numerical approximation to this integral based on a discrete set of $M$ absorption coefficients, $\\{k_{\\nu, m}\\}_{m=1}^M$.\n\nThe specified algorithm proceeds in the following steps:\n\n1.  **Construct a Discrete Approximation of $k(g)$**: The provided set of $M$ absorption coefficients $\\{k_\\nu\\}$ is treated as a representative sample of the underlying distribution.\n    -   First, these samples are sorted in ascending order to create a monotonic sequence, denoted $\\{k_{(j)}\\}_{j=0}^{M-1}$.\n    -   Next, a cumulative coordinate $g_j$ is assigned to each sorted value $k_{(j)}$. The problem specifies using the midpoint of each bin in the cumulative probability space:\n        $$ g_j = \\frac{j + 1/2}{M} \\quad \\text{for } j=0, 1, \\dots, M-1 $$\n    -   The resulting pairs $\\{(g_j, k_{(j)})\\}$ form a discrete representation of the function $k(g)$. The problem then requires that the continuous function $k(g)$ be approximated by piecewise-linear interpolation over these points.\n\n2.  **Approximate the Transmittance Integral**: The integral over $g$ is approximated using a numerical quadrature scheme.\n    -   The integration domain $(0,1)$ is divided into $N$ equally spaced intervals. The quadrature points are chosen as the midpoints of these intervals:\n        $$ g^*_i = \\frac{i + 1/2}{N} \\quad \\text{for } i=0, 1, \\dots, N-1 $$\n    -   For each quadrature point $g^*_i$, the corresponding absorption coefficient $k(g^*_i)$ is determined by linearly interpolating the function defined by the points $\\{(g_j, k_{(j)})\\}$.\n    -   The integral is then approximated as the arithmetic mean of the transmittance values evaluated at these $N$ quadrature points. This is equivalent to a midpoint rule for numerical integration:\n        $$ \\bar{T} \\approx \\frac{1}{N} \\sum_{i=0}^{N-1} \\exp(-k(g^*_i) u) $$\n\nThe final implementation will encapsulate this logic. Given a set of raw absorption coefficients $\\{k_\\nu\\}$, the path amount $u$, and the number of quadrature points $N$, the algorithm will:\n1.  Determine the number of input samples, $M$.\n2.  Sort $\\{k_\\nu\\}$ to obtain $\\{k_{(j)}\\}$.\n3.  Generate the cumulative coordinates $g_j = (j+0.5)/M$.\n4.  Generate the quadrature points $g^*_i = (i+0.5)/N$.\n5.  Use a standard linear interpolation routine (such as `numpy.interp`) to find the values of $k(g^*_i)$ based on the data points $(g_j, k_{(j)})$. This function will handle cases where a $g^*_i$ falls between two $g_j$ points. For evaluation points outside the range $[g_0, g_{M-1}]$, constant extrapolation is a standard and justifiable choice, equivalent to setting $k(g)=k_{(0)}$ for $g<g_0$ and $k(g)=k_{(M-1)}$ for $g>g_{M-1}$.\n6.  Calculate the transmittance $\\exp(-k(g^*_i)u)$ for each of the $N$ points.\n7.  Compute the arithmetic mean of these $N$ transmittance values.\n8.  Round the final result to the specified precision of eight decimal places.\n\nThis procedure provides a robust and well-defined method for estimating band-averaged transmittance from a discrete spectrum, forming a practical application of the correlated-$k$ distribution principle.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It computes band transmittance using the correlated-k method for several cases.\n    \"\"\"\n\n    def calculate_band_transmittance(k_nu: list[float], u: float, N: int) -> float:\n        \"\"\"\n        Calculates the band transmittance using the specified correlated-k algorithm.\n\n        Args:\n            k_nu: A list of monochromatic absorption coefficients [m^2 kg^-1].\n            u: The absorber path amount [kg m^-2].\n            N: The number of equally spaced quadrature points for g-space integration.\n\n        Returns:\n            The dimensionless band transmittance, rounded to 8 decimal places.\n        \"\"\"\n        # Ensure k_nu is a numpy array for vectorized operations.\n        k_nu_arr = np.array(k_nu, dtype=np.float64)\n        M = len(k_nu_arr)\n\n        if M == 0:\n            # Handle empty k_nu list: transmittance is 1.\n            return 1.0\n\n        # Step 1: Create the monotone function k(g) by rank-ordering the samples.\n        # This gives the k_(j) values.\n        k_sorted = np.sort(k_nu_arr)\n\n        # Step 2: Define the associated cumulative coordinate g_j for the sorted samples.\n        # g_j = (j + 0.5) / M for j in {0, 1, ..., M-1}\n        g_j = (np.arange(M) + 0.5) / M\n\n        # Step 3: Define the N equally spaced quadrature midpoints g_i*.\n        # g_i* = (i + 0.5) / N for i in {0, 1, ..., N-1}\n        g_i_star = (np.arange(N) + 0.5) / N\n\n        # Step 4: Approximate k(g) by piecewise-linear interpolation.\n        # Evaluate k at the quadrature points g_i_star using the discrete\n        # (g_j, k_sorted) representation. numpy.interp handles this efficiently.\n        # It uses constant extrapolation by default for points outside the g_j range,\n        # which is a reasonable choice here.\n        k_at_g_i_star = np.interp(g_i_star, g_j, k_sorted)\n\n        # Step 5: Evaluate exp(-k(g)u) at each quadrature point.\n        # This is an array of transmittance values, one for each g-point.\n        transmittances_at_g_i_star = np.exp(-k_at_g_i_star * u)\n\n        # Step 6: Form the arithmetic mean as the band transmittance.\n        # This approximates the integral integral(exp(-k(g)u) dg) from 0 to 1.\n        band_transmittance = np.mean(transmittances_at_g_i_star)\n\n        # Return the final value rounded to the specified precision.\n        return round(band_transmittance, 8)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general, multi-scale distribution)\n        {'k_nu': [1.0e-3, 5.0e-3, 2.0e-2, 4.0e-2, 1.0e-1, 2.0e-1, 5.0e-1, 1.0, 2.0, 5.0, 10.0, 20.0], 'u': 0.01, 'N': 10},\n        # Case 2 (boundary in quadrature size)\n        {'k_nu': [1.0e-2, 1.0e-1, 1.0, 10.0, 100.0], 'u': 0.1, 'N': 1},\n        # Case 3 (uniform absorption coefficients)\n        {'k_nu': [5.0e-2, 5.0e-2, 5.0e-2, 5.0e-2, 5.0e-2, 5.0e-2, 5.0e-2, 5.0e-2], 'u': 1.0, 'N': 4},\n        # Case 4 (including zeros and strong lines)\n        {'k_nu': [0.0, 0.0, 0.0, 1.0e-2, 1.0e-1, 1.0, 10.0], 'u': 10.0, 'N': 7},\n        # Case 5 (highly skewed distribution)\n        {'k_nu': [1.0e-6, 2.0e-6, 5.0e-6, 1.0e-5, 2.0e-5, 5.0e-5, 1.0e-4, 2.0e-4, 1.0e-3, 1.0e-2, 1.0e-1], 'u': 2.0, 'N': 16}\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_band_transmittance(case['k_nu'], case['u'], case['N'])\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The power of the correlated-k method in multilayer atmospheres rests on the critical assumption that the rank order of absorption coefficients is the same in each layer. This practice challenges you to investigate a scenario where this \"perfect correlation\" assumption breaks down due to temperature-dependent spectral line strengths that \"cross\" between layers . By constructing a clear counterexample and quantifying the resulting error in transmittance, you will develop a crucial understanding of the method's physical limitations, particularly in atmospheres with strong vertical temperature gradients.",
            "id": "4028133",
            "problem": "You are asked to formalize and quantify a well-known failure mode of the correlated-absorption-coefficient (correlated-k) approximation used in radiation schemes for numerical weather prediction and climate modeling. The failure occurs when the rank order of absorption coefficients across frequency is not preserved across layers because spectral line strengths cross as temperature changes. Your task is to construct a concrete counterexample, compute exact composite-layer band-mean transmittances from first principles, compute the corresponding perfectly correlated-k approximation, and report the induced fractional error.\n\nStart from the Beer–Lambert law and a minimal spectroscopy model:\n\n- Monochromatic transmittance through a stack of layers is given by $T(\\nu) = \\exp\\left(-\\sum_{\\ell} k_{\\ell}(\\nu)\\, u_{\\ell}\\right)$, where $k_{\\ell}(\\nu)$ is the monochromatic absorption coefficient in layer $\\ell$, and $u_{\\ell}$ is the absorber column amount in layer $\\ell$. Transmittance $T(\\nu)$ is dimensionless.\n\n- Assume a narrow spectral band containing two isolated lines with centers at $ \\nu_A $ and $ \\nu_B $. The monochromatic absorption coefficient in layer $\\ell$ is modeled as a superposition of two lines,\n  $$k_{\\ell}(\\nu) = S_A(T_{\\ell})\\,\\phi(\\nu-\\nu_A;\\sigma) + S_B(T_{\\ell})\\,\\phi(\\nu-\\nu_B;\\sigma),$$\n  where $\\phi$ is a normalized Gaussian line shape with full normalization,\n  $$\\phi(\\nu-\\nu_0;\\sigma) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{(\\nu-\\nu_0)^2}{2\\sigma^2}\\right), \\quad \\int_{-\\infty}^{\\infty}\\phi(\\nu-\\nu_0;\\sigma)\\,d\\nu = 1,$$\n  and $\\sigma$ is the standard deviation of the Gaussian. Treat $\\nu$ as a dimensionless frequency-like variable for numerical convenience.\n\n- Use a simplified, physically motivated line-strength model (Boltzmann scaling with energy measured in Kelvin units so that the Boltzmann constant is absorbed):\n  $$S_i(T) = C_i\\,\\exp\\!\\left(-\\frac{E_i}{T}\\right), \\quad i\\in\\{A,B\\},$$\n  where $C_i$ is a positive constant, $E_i$ is an effective lower-state energy in Kelvin, and $T$ is temperature in Kelvin. This model captures line-strength crossing when $S_A(T)$ and $S_B(T)$ exchange order between two temperatures.\n\n- The exact band-mean transmittance over a discrete uniform grid $\\{\\nu_j\\}_{j=1}^{N}$ is\n  $$\\overline{T}_{\\mathrm{exact}} = \\frac{1}{N}\\sum_{j=1}^{N} \\exp\\!\\left( - \\sum_{\\ell} k_{\\ell}(\\nu_j)\\,u_{\\ell} \\right).$$\n\n- The perfectly correlated-k composite-layer approximation is constructed by sorting the absorption coefficient samples $\\{k_{\\ell}(\\nu_j)\\}_{j=1}^{N}$ independently for each layer into nondecreasing sequences $\\{k_{\\ell}^{\\ast}(g_j)\\}_{j=1}^{N}$ with $g_j = \\frac{j-1/2}{N}$, and then pairing across layers at equal $g_j$:\n  $$\\overline{T}_{\\mathrm{corr}} = \\frac{1}{N}\\sum_{j=1}^{N} \\exp\\!\\left( - \\sum_{\\ell} k_{\\ell}^{\\ast}(g_j)\\,u_{\\ell} \\right).$$\n  This embodies the assumption of perfect rank correlation of absorption coefficients across layers. When line strengths cross, the mapping from $g$ to frequency differs by layer, violating the assumption and inducing error.\n\nConstruct a discretized counterexample and quantify the induced fractional error\n$$\\epsilon = \\frac{\\overline{T}_{\\mathrm{corr}} - \\overline{T}_{\\mathrm{exact}}}{\\overline{T}_{\\mathrm{exact}}}.$$\nTransmittances and $\\epsilon$ are dimensionless numbers and must be reported as decimals.\n\nImplementation details required for numerical realization:\n\n- For each test, use a uniform grid of $N$ points in $\\nu$ spanning from $\\min(\\nu_A,\\nu_B) - 6\\sigma$ to $\\max(\\nu_A,\\nu_B) + 6\\sigma$ so that Gaussian tails are captured. Use the discrete arithmetic mean to approximate the band integral.\n\n- Temperatures $T$ must be specified in Kelvin, energies $E_i$ in Kelvin (that is, $E_i/k_B$), and the Gaussian width $\\sigma$ in the same dimensionless units as $\\nu$. Column amounts $u_{\\ell}$ are dimensionless in this construction. All outputs are dimensionless.\n\nYour program must compute $\\epsilon$ for each of the following test cases and print them as a single list. Each output value must be rounded to $8$ decimal places.\n\nTest Suite (each line is one case):\n\n1. Crossing, moderate optical depth:\n   - $T_1 = 250$, $T_2 = 300$, $u_1 = 1.0$, $u_2 = 1.0$, $N = 4001$,\n   - $\\nu_A = -2.0$, $\\nu_B = 2.0$, $\\sigma = 0.5$,\n   - $C_A = 50.0$, $E_A = 1500.0$, $C_B = 1.0$, $E_B = 500.0$.\n\n2. No crossing, moderate optical depth:\n   - $T_1 = 250$, $T_2 = 300$, $u_1 = 1.0$, $u_2 = 1.0$, $N = 4001$,\n   - $\\nu_A = -2.0$, $\\nu_B = 2.0$, $\\sigma = 0.5$,\n   - $C_A = 1.0$, $E_A = 400.0$, $C_B = 0.8$, $E_B = 800.0$.\n\n3. Identical layers (perfect correlation), mixed optical depth:\n   - $T_1 = 275$, $T_2 = 275$, $u_1 = 1.3$, $u_2 = 0.7$, $N = 4001$,\n   - $\\nu_A = -2.0$, $\\nu_B = 2.0$, $\\sigma = 0.5$,\n   - $C_A = 50.0$, $E_A = 1500.0$, $C_B = 1.0$, $E_B = 500.0$.\n\n4. Crossing, strong optical depth (saturation tendency):\n   - $T_1 = 250$, $T_2 = 300$, $u_1 = 5.0$, $u_2 = 5.0$, $N = 4001$,\n   - $\\nu_A = -2.0$, $\\nu_B = 2.0$, $\\sigma = 0.5$,\n   - $C_A = 50.0$, $E_A = 1500.0$, $C_B = 1.0$, $E_B = 500.0$.\n\n5. Crossing with overlapping lines:\n   - $T_1 = 260$, $T_2 = 290$, $u_1 = 1.0$, $u_2 = 1.0$, $N = 4001$,\n   - $\\nu_A = -0.3$, $\\nu_B = 0.3$, $\\sigma = 0.4$,\n   - $C_A = 50.0$, $E_A = 1500.0$, $C_B = 1.0$, $E_B = 500.0$.\n\n6. Boundary case, zero path (trivial transmittance):\n   - $T_1 = 250$, $T_2 = 300$, $u_1 = 0.0$, $u_2 = 0.0$, $N = 4001$,\n   - $\\nu_A = -2.0$, $\\nu_B = 2.0$, $\\sigma = 0.5$,\n   - $C_A = 50.0$, $E_A = 1500.0$, $C_B = 1.0$, $E_B = 500.0$.\n\nFinal output format:\n\n- Your program should produce a single line containing a Python-style list of the six rounded fractional errors in the same order as the test cases. For example, an acceptable format is\n  $$[\\epsilon_1,\\epsilon_2,\\epsilon_3,\\epsilon_4,\\epsilon_5,\\epsilon_6],$$\n  where each $\\epsilon_i$ is a decimal rounded to $8$ places and no additional text is printed.",
            "solution": "The goal is to create and quantify a counterexample to the correlated-absorption-coefficient (correlated-k) approximation by inducing a violation of cross-layer rank correlation in monochromatic absorption coefficients due to temperature-dependent line-strength crossing.\n\nPrinciples and definitions:\n\n- The Beer–Lambert law states that, assuming no scattering and a fixed absorber path amount, the monochromatic transmittance through a stack of layers is $T(\\nu) = \\exp\\!\\left(-\\sum_{\\ell} k_{\\ell}(\\nu)\\, u_{\\ell}\\right)$. This follows from the fundamental law that infinitesimal attenuation is proportional to the current intensity and the absorber amount, $dI/I = -k(\\nu)\\,dm$, integrated over the path to obtain an exponential.\n\n- For a narrow spectral interval containing isolated lines, line-by-line theory models the monochromatic absorption coefficient as a superposition of line contributions. A line with strength $S(T)$ and normalized line shape $\\phi(\\nu-\\nu_0)$ contributes $S(T)\\,\\phi(\\nu-\\nu_0)$ to the absorption coefficient. The shape $\\phi$ is normalized so that $\\int \\phi\\,d\\nu = 1$; thus the line strength $S(T)$ has the meaning of the area under the absorption coefficient curve and is the quantity that carries the thermodynamic dependence.\n\n- A physically motivated and widely used approximation for the temperature dependence of line strength invokes Boltzmann populations of lower states, $S(T) \\propto \\exp(-E/k_B T)$, with additional factors due to partition functions and stimulated emission. Over a modest temperature range and for constructing a specific counterexample, we may model\n  $$S_i(T) = C_i\\,\\exp\\!\\left(-\\frac{E_i}{T}\\right), \\quad i\\in\\{A,B\\},$$\n  where $E_i$ is expressed in Kelvin ($E_i/k_B$), and $C_i$ is a positive scaling constant. Because the exponential is monotone in $T$, different pairs $(C_i,E_i)$ can cause the order $S_A(T)$ versus $S_B(T)$ to flip between two temperatures.\n\n- The band-mean transmittance is the average of monochromatic transmittance across the band. For a uniform grid $\\{\\nu_j\\}_{j=1}^N$,\n  $$\\overline{T}_{\\mathrm{exact}} = \\frac{1}{N}\\sum_{j=1}^N \\exp\\!\\left(-\\sum_{\\ell} k_{\\ell}(\\nu_j)\\,u_{\\ell}\\right).$$\n  Because the grid is uniform and the Gaussian tails decay rapidly, choosing bounds at $\\pm 6\\sigma$ from the extreme line centers captures essentially all line area.\n\n- The correlated-absorption-coefficient (correlated-k) approximation transforms from the native frequency variable $\\nu$ to a cumulative-probability variable $g$ by sorting the set of absorption coefficients at discrete quadrature frequencies for each layer to construct nondecreasing sequences $k_{\\ell}^\\ast(g_j)$. The composite-layer correlated-k band-mean is then approximated by pairing equal-$g$ points across layers:\n  $$\\overline{T}_{\\mathrm{corr}} = \\frac{1}{N}\\sum_{j=1}^{N} \\exp\\!\\left(-\\sum_{\\ell} k_{\\ell}^\\ast(g_j)\\,u_{\\ell}\\right).$$\n  This assumes that the mapping from $g$ to $\\nu$ is identical across layers, i.e., perfect rank correlation of absorption coefficients. When the rank order changes between layers, this assumption fails.\n\nConstructing the counterexample:\n\n- Choose two line centers $\\nu_A$ and $\\nu_B$ that are well separated relative to $\\sigma$, and define a Gaussian line shape\n  $$\\phi(\\nu-\\nu_0;\\sigma) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{(\\nu-\\nu_0)^2}{2\\sigma^2}\\right),$$\n  common to both layers (a simplification to isolate rank-order effects).\n\n- Select $(C_A,E_A)$ and $(C_B,E_B)$ so that\n  $$S_A(T_1) > S_B(T_1) \\quad \\text{and} \\quad S_A(T_2) < S_B(T_2) \\quad \\text{or vice versa},$$\n  ensuring a crossing of line strengths between temperatures $T_1$ and $T_2$. The first test case uses $C_A=50$, $E_A=1500$, $C_B=1$, $E_B=500$ with $T_1=250$ and $T_2=300$, which yields\n  $$S_A(250) = 50\\,e^{-1500/250} \\approx 50\\,e^{-6} \\approx 0.124, \\quad S_B(250) = 1\\,e^{-500/250} \\approx e^{-2} \\approx 0.135,$$\n  $$S_A(300) = 50\\,e^{-1500/300} \\approx 50\\,e^{-5} \\approx 0.337, \\quad S_B(300) = 1\\,e^{-500/300} \\approx e^{-5/3} \\approx 0.189,$$\n  so the stronger line flips from B at $T_1$ to A at $T_2$. This necessarily changes the rank order of $k_{\\ell}(\\nu)$ across $\\nu$ when moving from layer $1$ to layer $2$.\n\nQuantifying the error:\n\n- Compute $\\overline{T}_{\\mathrm{exact}}$ by direct averaging of $T(\\nu_j)$ across the uniform grid spanning the lines.\n\n- Compute $\\overline{T}_{\\mathrm{corr}}$ by sorting $\\{k_1(\\nu_j)\\}$ and $\\{k_2(\\nu_j)\\}$ independently and pairing at equal $g_j$ indices.\n\n- Report the fractional error\n  $$\\epsilon = \\frac{\\overline{T}_{\\mathrm{corr}} - \\overline{T}_{\\mathrm{exact}}}{\\overline{T}_{\\mathrm{exact}}}.$$\n\nExpected qualitative behavior:\n\n- For crossing cases, the perfect-correlation pairing tends to match large absorption coefficients in one layer with large absorption coefficients in the other layer even when, at a given frequency, a large coefficient in one layer coincides with a smaller coefficient in the other. Because the map $x\\mapsto \\exp(-x)$ is convex and decreasing, such like-with-like pairing typically yields a smaller mean transmittance than the true frequency-by-frequency pairing (a manifestation akin to the rearrangement inequality combined with convexity), so $\\overline{T}_{\\mathrm{corr}}$ is often biased low and $\\epsilon$ tends to be negative.\n\n- When there is no crossing or when the two layers are identical, rank order is preserved, the $g$-to-$\\nu$ mapping is the same across layers, and $\\overline{T}_{\\mathrm{corr}}=\\overline{T}_{\\mathrm{exact}}$ so $\\epsilon=0$ up to numerical discretization error.\n\n- In the strong optical-depth regime, saturation reduces sensitivity to detailed correlation structure, but nonzero errors may persist depending on overlap.\n\nNumerical procedure:\n\n- Use $N=4001$ uniformly spaced points in $\\nu$, with domain boundaries at $\\min(\\nu_A,\\nu_B)-6\\sigma$ and $\\max(\\nu_A,\\nu_B)+6\\sigma$, to represent the band.\n\n- For each test case, evaluate $S_A(T_{\\ell})$ and $S_B(T_{\\ell})$ per the exponential model, build $k_{\\ell}(\\nu_j)$, compute both $\\overline{T}_{\\mathrm{exact}}$ and $\\overline{T}_{\\mathrm{corr}}$, and then compute and round $\\epsilon$ to $8$ decimal places.\n\n- Return the list $[\\epsilon_1,\\epsilon_2,\\epsilon_3,\\epsilon_4,\\epsilon_5,\\epsilon_6]$ on a single line with no extra text.\n\nThe provided program implements these steps exactly as specified, ensuring that the counterexample is explicit, the induced error is quantified, and edge cases (no crossing, identical layers, zero path) confirm expected limiting behavior. Running the program yields six dimensionless decimal outputs corresponding to the fractional errors for the six tests, each rounded to $8$ places.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef gaussian_phi(nu, center, sigma):\n    \"\"\"Normalized Gaussian line shape.\"\"\"\n    inv_norm = 1.0 / (np.sqrt(2.0 * np.pi) * sigma)\n    x = (nu - center) / sigma\n    return inv_norm * np.exp(-0.5 * x * x)\n\ndef line_strength(T, C, E_K):\n    \"\"\"\n    Simplified line strength S(T) = C * exp(-E/T),\n    where E is expressed in Kelvin units (i.e., E/k_B).\n    \"\"\"\n    return C * np.exp(-E_K / T)\n\ndef compute_band_errors(params):\n    \"\"\"\n    Compute exact and correlated-k band-mean transmittances and return fractional error.\n    params is a dict with keys:\n        T1, T2, u1, u2, nuA, nuB, sigma, CA, EA, CB, EB, N\n    \"\"\"\n    T1 = params[\"T1\"]\n    T2 = params[\"T2\"]\n    u1 = params[\"u1\"]\n    u2 = params[\"u2\"]\n    nuA = params[\"nuA\"]\n    nuB = params[\"nuB\"]\n    sigma = params[\"sigma\"]\n    CA = params[\"CA\"]\n    EA = params[\"EA\"]\n    CB = params[\"CB\"]\n    EB = params[\"EB\"]\n    N = int(params[\"N\"])\n\n    # Grid in frequency-like variable nu\n    nu_min = min(nuA, nuB) - 6.0 * sigma\n    nu_max = max(nuA, nuB) + 6.0 * sigma\n    nu = np.linspace(nu_min, nu_max, N)\n\n    # Line strengths in each layer\n    SA1 = line_strength(T1, CA, EA)\n    SB1 = line_strength(T1, CB, EB)\n    SA2 = line_strength(T2, CA, EA)\n    SB2 = line_strength(T2, CB, EB)\n\n    # Line shapes (same sigma in both layers by construction)\n    phiA = gaussian_phi(nu, nuA, sigma)\n    phiB = gaussian_phi(nu, nuB, sigma)\n\n    # Absorption coefficients in each layer\n    k1 = SA1 * phiA + SB1 * phiB\n    k2 = SA2 * phiA + SB2 * phiB\n\n    # Exact band-mean transmittance\n    tau_total = k1 * u1 + k2 * u2\n    T_exact = np.mean(np.exp(-tau_total, dtype=np.float64))\n\n    # Correlated-k band-mean transmittance: sort each layer independently, pair by index\n    k1_sorted = np.sort(k1)\n    k2_sorted = np.sort(k2)\n    tau_corr = k1_sorted * u1 + k2_sorted * u2\n    T_corr = np.mean(np.exp(-tau_corr, dtype=np.float64))\n\n    # Fractional error\n    if T_exact == 0.0:\n        # Avoid division by zero; if exact transmittance is 0, treat error as 0 if both are zero, else inf\n        if T_corr == 0.0:\n            frac_error = 0.0\n        else:\n            frac_error = np.inf\n    else:\n        frac_error = (T_corr - T_exact) / T_exact\n\n    return float(frac_error)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # 1. Crossing, moderate optical depth\n        dict(T1=250.0, T2=300.0, u1=1.0, u2=1.0, nuA=-2.0, nuB=2.0, sigma=0.5,\n             CA=50.0, EA=1500.0, CB=1.0, EB=500.0, N=4001),\n        # 2. No crossing, moderate optical depth\n        dict(T1=250.0, T2=300.0, u1=1.0, u2=1.0, nuA=-2.0, nuB=2.0, sigma=0.5,\n             CA=1.0, EA=400.0, CB=0.8, EB=800.0, N=4001),\n        # 3. Identical layers (perfect correlation), mixed optical depth\n        dict(T1=275.0, T2=275.0, u1=1.3, u2=0.7, nuA=-2.0, nuB=2.0, sigma=0.5,\n             CA=50.0, EA=1500.0, CB=1.0, EB=500.0, N=4001),\n        # 4. Crossing, strong optical depth\n        dict(T1=250.0, T2=300.0, u1=5.0, u2=5.0, nuA=-2.0, nuB=2.0, sigma=0.5,\n             CA=50.0, EA=1500.0, CB=1.0, EB=500.0, N=4001),\n        # 5. Crossing with overlapping lines\n        dict(T1=260.0, T2=290.0, u1=1.0, u2=1.0, nuA=-0.3, nuB=0.3, sigma=0.4,\n             CA=50.0, EA=1500.0, CB=1.0, EB=500.0, N=4001),\n        # 6. Boundary case: zero path\n        dict(T1=250.0, T2=300.0, u1=0.0, u2=0.0, nuA=-2.0, nuB=2.0, sigma=0.5,\n             CA=50.0, EA=1500.0, CB=1.0, EB=500.0, N=4001),\n    ]\n\n    results = []\n    for case in test_cases:\n        err = compute_band_errors(case)\n        # Round to 8 decimal places\n        if not np.isfinite(err):\n            # In practice shouldn't happen for given cases; still handle\n            rounded = \"inf\"\n        else:\n            rounded = f\"{err:.8f}\"\n        results.append(rounded)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "After reformulating the band transmittance integral in terms of the cumulative probability variable $g$, the next challenge is its efficient numerical evaluation. This theoretical exercise explores the design of optimized quadrature rules tailored to the statistical properties of the $k(g)$ function. You will derive an optimal single-point quadrature for a simplified $k(g)$ model by matching the moments of the exact and approximate transmittance, a technique central to developing fast and accurate radiation codes .",
            "id": "4028074",
            "problem": "Consider a homogeneous layer in a numerical weather prediction and climate modeling context containing a single well-mixed gas whose spectrally varying absorption coefficients have been mapped into cumulative probability space using the correlated-$k$ method. In this representation, the absorption coefficient $k(g)$ is a monotonic function of the cumulative probability variable $g \\in [0,1]$ arising from sorted Line-By-Line (LBL) gaseous spectroscopy. The layer transmittance for a fixed mass path $u$ is given by the Beer–Lambert law expressed in correlated-$k$ form,\n$$\nT(u) = \\int_{0}^{1} \\exp\\!\\big(-k(g)\\,u\\big)\\,dg.\n$$\nAssume that within the spectral band of interest, the cumulative distribution of absorption coefficients is well-approximated by a linear model\n$$\nk(g) = k_{\\min} + \\Delta k\\, g,\n$$\nwith $k_{\\min} > 0$ and $\\Delta k > 0$ constants for the band and atmospheric state.\n\nYou are tasked with designing a single-node quadrature approximation to $T(u)$ of the form\n$$\nT_{1}(u) = w\\,\\exp\\!\\big(-k^{\\star} u\\big),\n$$\nwhere $w$ and $k^{\\star}$ are constants independent of $u$, chosen to minimize the leading-order transmittance error over an optically thin range defined by\n$$\n\\Delta k\\,u \\le \\varepsilon,\\quad \\text{with } 0 < \\varepsilon \\ll 1.\n$$\nStarting from the Beer–Lambert law and the correlated-$k$ definition above, derive the optimal placement $(w,k^{\\star})$ that eliminates the error through first order in $u$ and minimizes the dominant second-order error uniformly over the specified thin-optical-depth range. Your derivation must start from first principles (Beer–Lambert law and Taylor expansion of the exponential), proceed via moment matching in cumulative probability space, and explicitly compute any needed moments of $k(g)$.\n\nExpress your final answers for the optimal node $k^{\\star}$ in $\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$ and the optimal weight $w$ as dimensionless. No rounding is required; provide exact symbolic expressions. If multiple final values are required, present them as a single row using the LaTeX $pmatrix$ environment.",
            "solution": "The problem requires the derivation of an optimal single-node quadrature approximation, $T_{1}(u) = w\\,\\exp(-k^{\\star} u)$, for the correlated-$k$ transmittance, $T(u) = \\int_{0}^{1} \\exp(-k(g)\\,u)\\,dg$. The optimization criterion is to eliminate the approximation error through first order in the mass path $u$ and to minimize the dominant second-order error, under the assumption of an optically thin regime where $\\Delta k\\,u \\ll 1$. The absorption coefficient is given by a linear model in the cumulative probability variable $g$: $k(g) = k_{\\min} + \\Delta k\\, g$.\n\nThe derivation proceeds by matching the Taylor series expansion of the exact transmittance $T(u)$ with that of the approximation $T_{1}(u)$ around $u=0$.\n\nFirst, we expand the exact transmittance $T(u)$. The exponential function within the integral can be expanded as a series in $u$:\n$$\n\\exp(-k(g)\\,u) = \\sum_{n=0}^{\\infty} \\frac{(-k(g)\\,u)^{n}}{n!} = 1 - k(g)u + \\frac{1}{2}k(g)^{2}u^{2} - O(u^{3})\n$$\nSubstituting this into the definition of $T(u)$ and integrating term-by-term with respect to $g$ from $0$ to $1$ yields:\n$$\nT(u) = \\int_{0}^{1} \\left( 1 - k(g)u + \\frac{1}{2}k(g)^{2}u^{2} - \\dots \\right) dg\n$$\n$$\nT(u) = \\int_{0}^{1} dg - u \\int_{0}^{1} k(g) dg + \\frac{u^{2}}{2} \\int_{0}^{1} k(g)^{2} dg - O(u^{3})\n$$\nThis expression can be written in terms of the moments of the absorption coefficient distribution, $\\langle k^{n} \\rangle = \\int_{0}^{1} k(g)^{n} dg$:\n$$\nT(u) = \\langle k^{0} \\rangle - u\\langle k^{1} \\rangle + \\frac{u^{2}}{2}\\langle k^{2} \\rangle - O(u^{3})\n$$\nSince $\\langle k^{0} \\rangle = \\int_{0}^{1} 1\\,dg = 1$, the expansion is:\n$$\nT(u) = 1 - u\\langle k \\rangle + \\frac{u^{2}}{2}\\langle k^{2} \\rangle - O(u^{3})\n$$\n\nNext, we expand the single-node approximation $T_{1}(u) = w\\,\\exp(-k^{\\star} u)$ in a Taylor series around $u=0$:\n$$\nT_{1}(u) = w \\left( 1 - k^{\\star}u + \\frac{1}{2}(k^{\\star})^{2}u^{2} - O(u^{3}) \\right)\n$$\n$$\nT_{1}(u) = w - w k^{\\star} u + \\frac{w}{2}(k^{\\star})^{2}u^{2} - O(u^{3})\n$$\n\nThe problem states that the approximation must eliminate the error through first order in $u$. This means that the error, $\\mathcal{E}(u) = T(u) - T_{1}(u)$, must be of order $O(u^{2})$. This requires the coefficients of the $u^{0}$ and $u^{1}$ terms in the expansions of $T(u)$ and $T_{1}(u)$ to be equal.\n\nMatching the zeroth-order terms ($u^{0}$):\n$$\n1 = w\n$$\nThe optimal weight $w$ must be $1$.\n\nMatching the first-order terms ($u^{1}$), and using $w=1$:\n$$\n- \\langle k \\rangle = -w k^{\\star} \\implies -\\langle k \\rangle = -k^{\\star}\n$$\n$$\nk^{\\star} = \\langle k \\rangle\n$$\nThe optimal absorption coefficient $k^{\\star}$ for the quadrature node is the mean absorption coefficient, $\\langle k \\rangle$.\n\nNow, we must compute $\\langle k \\rangle$ for the given linear model $k(g) = k_{\\min} + \\Delta k\\, g$.\n$$\n\\langle k \\rangle = \\int_{0}^{1} k(g)\\,dg = \\int_{0}^{1} (k_{\\min} + \\Delta k\\, g)\\,dg\n$$\nPerforming the integration:\n$$\n\\langle k \\rangle = \\left[ k_{\\min} g + \\frac{\\Delta k}{2} g^{2} \\right]_{0}^{1} = (k_{\\min}(1) + \\frac{\\Delta k}{2}(1)^{2}) - (k_{\\min}(0) + \\frac{\\Delta k}{2}(0)^{2})\n$$\n$$\n\\langle k \\rangle = k_{\\min} + \\frac{\\Delta k}{2}\n$$\nTherefore, the optimal node is $k^{\\star} = k_{\\min} + \\frac{\\Delta k}{2}$.\n\nWith these choices, $w=1$ and $k^{\\star}=\\langle k \\rangle$, the error through first order is eliminated. The leading-order error is now the second-order term:\n$$\n\\mathcal{E}(u) = \\left(\\frac{\\langle k^{2} \\rangle}{2}\\right) u^{2} - \\left(\\frac{w(k^{\\star})^{2}}{2}\\right) u^{2} + O(u^{3})\n$$\n$$\n\\mathcal{E}(u) = \\frac{u^{2}}{2} \\left( \\langle k^{2} \\rangle - \\langle k \\rangle^{2} \\right) + O(u^{3})\n$$\nThe term $\\langle k^{2} \\rangle - \\langle k \\rangle^{2}$ is the variance of $k(g)$, denoted $\\sigma_{k}^{2}$. The choice to match the zeroth and first moments ($w=1, k^{\\star}=\\langle k \\rangle$) is what is meant by a moment-matching quadrature that is accurate to first order. This choice uniquely determines the parameters $w$ and $k^{\\star}$. Consequently, the resulting second-order error term is also uniquely determined. The problem's phrasing \"minimizes the dominant second-order error\" is satisfied in the sense that any other choice of $w$ or $k^{\\star}$ would introduce a non-zero error at zeroth or first order, which is a lower-order (and thus more significant in the optically thin limit) error. Therefore, enforcing first-order accuracy implicitly defines the parameters that leave the minimal possible residual error, which is of second order.\n\nThe optimal parameters are $w=1$ and $k^{\\star} = k_{\\min} + \\frac{\\Delta k}{2}$. The problem asks for the answer for $k^{\\star}$ in units of $\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$ and $w$ as dimensionless. Since $k(g)$ is an absorption coefficient, its units are already $\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$, so $k^{\\star}$ will have the correct units. The weight $w$ is a ratio of transmittances and is correctly dimensionless.\n\nThe final values are:\nOptimal node: $k^{\\star} = k_{\\min} + \\frac{\\Delta k}{2}$\nOptimal weight: $w = 1$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} k_{\\min} + \\frac{\\Delta k}{2} & 1 \\end{pmatrix}}\n$$"
        }
    ]
}