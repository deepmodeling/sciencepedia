## 引言
云是地球气候系统中最多变且影响最深远的组成部分之一，它们通过反射太阳辐射和吸收地表长波辐射，深刻地调节着地球的能量平衡。然而，在数值天气预报（NWP）和气候模式中，云的尺度往往远小于模型的网格分辨率，这构成了大气建模中最核心的挑战之一。我们无法直接解析单个云体的形成与消散，因此必须依赖“[参数化](@entry_id:265163)”方案来表征它们对大尺度气流的集体效应。本文旨在系统性地阐述云[参数化](@entry_id:265163)中的两个基石：云分数和垂直重叠。

本文旨在填补理论与实践之间的鸿沟，为读者提供一个关于云分数和重叠[参数化](@entry_id:265163)的全面视角。我们将从基本原理出发，逐步深入到前沿应用和挑战。在“原理和机制”部分，您将学习云分数的定义、基于统计[概率密度函数](@entry_id:140610)（PDF）的诊断方法，以及描述云层垂直排列的最大、[随机和](@entry_id:266003)广义重叠假设。接着，在“应用与跨学科联系”部分，我们将探讨这些[参数化](@entry_id:265163)如何直接影响辐射计算和[地球能量收支](@entry_id:1124092)，如何与对流、微物理等其他关键物理过程相互作用，以及它们在数据同化和模式评估中的核心作用。最后，“动手实践”部分将提供具体问题，让您亲手应用所学知识，加深对这些复杂概念的理解。通过本章的学习，您将掌握现代大气模式如何应对次网格云这一关键挑战的核心技术和思想。

## 原理和机制

在[数值天气预报](@entry_id:191656)（NWP）和气候模式中，云的正确表示是决定模式性能的关键因素之一。由于云的形成和演化发生在远小于典型模式网格尺度的空间和时间尺度上，因此必须通过“[参数化](@entry_id:265163)”来表示它们的次网格效应。本章深入探讨了两个核心的[参数化](@entry_id:265163)问题：云分数和垂直重叠。我们将从基本定义出发，系统地介绍用于诊断和预报云分数的统计方案，然后转向描述云在垂直方向上空间分布的重叠假设。

### 云分数的定义与诊断

#### 基本概念：网格箱云分数

在欧拉模式的框架下，大气被划分为一系列三维网格箱。在任何给定时刻，一个网格箱内可能部分有云，部分晴空。**网格箱云分数**（grid-box cloud fraction），记为 $f_c$，被定义为网格箱内被云占据的体积（或面积）与网格箱总体积（或总面积）之比。

为了更精确地定义这一点，我们可以引入一个[指示函数](@entry_id:186820) $I(\mathbf{x}, t)$。假设我们有一个物理上有意义的云凝结物阈值 $q_*$（例如，一个非常小的[混合比](@entry_id:1127970)），当次网格点 $\mathbf{x}$ 的云凝结物[混合比](@entry_id:1127970) $q_c(\mathbf{x}, t)$ 超过这个阈值时，该点被认为是“有云的”。于是，[指示函数](@entry_id:186820)可以定义为：当 $q_c(\mathbf{x}, t) > q_*$ 时，$I(\mathbf{x}, t) = 1$；否则 $I(\mathbf{x}, t) = 0$。网格箱云分数 $f_c(t)$ 便是该[指示函数](@entry_id:186820)在整个网格箱体积 $V$ 上的平均值 ：
$$
f_c(t) = \frac{1}{V} \int_V I(\mathbf{x}, t) \, dV
$$
根据这一定义，云分数 $f_c$ 是一个无量纲的比例，其值严格地被限定在 $[0, 1]$ 区间内。$f_c = 0$ 表示完全晴空，$f_c = 1$ 表示网格箱完全被云覆盖。

必须将云分数与其他相关但截然不同的量区分开来。一个常见的混淆是**云内凝结物混合比**（in-cloud condensate mixing ratio），记为 $\overline{q_c}^{(\mathrm{in})}$。这个量是在网格箱内*有云*的部分对 $q_c$ 进行的条件平均。它表示云的“浓度”或“厚度”，是一个具有单位（如 g/kg）的物理量，其值不受 $1$ 的限制。网格箱的平均凝结物混合比 $\overline{q_c}$ 与这两者通过以下关系联系起来：
$$
\overline{q_c}(t) = f_c(t) \, \overline{q_c}^{(\mathrm{in})}(t)
$$
这个关系基于一个普遍的假设，即晴空区域的凝结物含量为零或可忽略不计 。

另一个需要区分的概念是**云出现频率**（cloud occurrence frequency）。云出现频率是在一个固定地理位置上，在一段时间内观测到云的频率，是一个[时间平均](@entry_id:267915)量。而云分数是在一个固定时刻，在一个空间区域内的[空间平均](@entry_id:203499)量。只有在遍历平稳的统计假设下，即时间平均等于空间平均时，这两个量才可能相等，但这在真实大气中通常不成立 。

#### 基于[假定概率密度函数](@entry_id:753720)（PDF）的诊断方法

模式如何在一个网格箱内计算云分数 $f_c$ 呢？一种强大而广泛应用的方法是**[假定概率密度函数](@entry_id:753720)（assumed-PDF）方法**。这种方法的核心思想是，虽然我们无法解析次网格尺度上所有点的状态，但我们可以假定某个关键[热力学变量](@entry_id:160587)的次网格 variability 遵循一个特定的概率分布。

一个常见的变量是**饱和亏损**（saturation deficit），定义为 $X = q_t - q_s$，其中 $q_t$ 是总水汽混合比（水汽 + 云水），$q_s$ 是饱和水汽混合比。在次网格尺度上，当 $X > 0$ 时，存在液态水，即形成云。因此，云分数可以被定义为 $X$ 超过 $0$ 的概率 ：
$$
f_c = P(X > 0)
$$
如果我们假定 $X$ 在网格箱内服从一个均值为 $\mu$、标准差为 $\sigma$ 的高斯分布 $X \sim \mathcal{N}(\mu, \sigma^2)$，那么云分数可以通过标准正态[累积分布函数](@entry_id:143135)（CDF）$\Phi$ 来计算。通过标准化变量 $Z = (X - \mu)/\sigma$，条件 $X > 0$ 变为 $Z > -\mu/\sigma$。因此，云分数为：
$$
f_c = P(Z > -\mu/\sigma) = 1 - \Phi(-\mu/\sigma) = \Phi(\mu/\sigma)
$$
同样地，网格平均凝结物含量 $\ell$（通常假定等于 $q_t - q_s$ 在云区内的平均值）可以计算为 $\ell = \mathbb{E}[\max(X, 0)]$。对于高斯分布，这可以推导为 ：
$$
\ell = \sigma \phi(\mu/\sigma) + \mu \Phi(\mu/\sigma)
$$
其中 $\phi$ 是标准正态PDF。

另一种类似的方法是基于**临界相对湿度**（critical relative humidity）的[闭包](@entry_id:148169)方案。该方法假定总水汽 $q_t$ 服从某个PDF（例如，均值为 $\bar{q}_t$、方差为 $\sigma_q^2$ 的高斯分布），并设定一个临界相对湿度阈值 $r_c$。当次网格点的相对湿度 $RH = q_t/q_s$ 超过 $r_c$ 时，就形成云。此时，云分数的表达式为 ：
$$
C = P(q_t/q_s > r_c) = P(q_t > r_c q_s) = \Phi\left(\frac{\bar{q}_t - r_c q_s}{\sigma_q}\right)
$$
这些基于PDF的方法的优越性在于，它们不仅能诊断云分数，还能一致地诊断出云中水量，并且能够捕捉到即使网格平均状态是次饱和的（例如 $\mu  0$ 或 $\bar{q}_t  q_s$），由于次网格的湿度波动也可能产生云（即 $f_c > 0$）的物理现实。

### 云分数的演变与耦合

云分数不是静态的。它的变化受到大气动力学、[热力学](@entry_id:172368)和微物理过程的共同驱动。模式中表示云分数演变的方式主要分为两大类：诊断方案和预报方案 。

#### 诊断方案 vs. 预报方案

**诊断云分数方案**（diagnostic cloud fraction scheme）在每个时间步都根据当前模式解析的预报量（如温度、湿度、垂直速度等）瞬时地计算云分数。即 $c(z,t) = \mathcal{F}(X(z,t))$，其中 $X$ 是预报量集合。这种方案的优点是简单且计算成本低，但它没有“记忆”。云场的存在完全依赖于当前时刻的解析尺度状态。这在快速演变的对流（其生命周期 $T_c$ 可能远小于模式辐射计算的时间步长 $\Delta t$）中可能导致云场的剧烈“闪烁”，从而产生不切实际的辐射通量波动 。

相比之下，**预报云分数方案**（prognostic cloud fraction scheme）将云分数本身作为一个独立的预报变量，并为其建立一个倾向方程。这个方程描述了云分数如何因平流、[湍流](@entry_id:151300)输送、凝结/蒸发等源汇项而随时间演变。一个典型的结构可能包含一个弛豫项，以确保云分数有界并具有有限的记忆 ：
$$
\frac{\partial c}{\partial t} = \text{Advection} + \text{Transport} + S_c(z,t) - \frac{c}{\tau(z,t)}
$$
其中 $S_c$ 代表云的生成项，$\tau$ 是一个特征[弛豫时间](@entry_id:191572)。这种方案通过将云的历史状态信息带到下一个时间步，增加了模式状态的信息含量，并赋予了云场时间上的连贯性，从而能够更平滑、更真实地模拟云与辐射的相互作用  。

#### 云分数倾向与物理过程的耦合

在基于PDF的框架下，云分数的演变与驱动PDF参数变化的物理过程紧密耦合。我们可以通过对云分数的表达式求时间导数来揭示这种耦合关系。以 $c = 1 - \Phi(x)$ 且 $x = (q_s - \mu)/\sigma$ 为例，应用链式法则，可以得到云分数的倾向方程 ：
$$
\frac{\partial c}{\partial t} = \frac{\phi(x)}{\sigma} \left( \frac{\partial \mu}{\partial t} + x \frac{\partial \sigma}{\partial t} - \frac{\partial q_s}{\partial t} \right)
$$
这个简洁优美的表达式清楚地表明，云分数的倾向 $\partial c / \partial t$ 直接取决于三个关键物理倾向：
1.  **平均湿度的倾向** $\partial \mu / \partial t$：由大尺度平流和湍流混合驱动。
2.  **次网格湿度方差的倾向** $\partial \sigma / \partial t$：由[湍流生成](@entry_id:189980)和耗散驱动。
3.  **饱和湿度的倾向** $\partial q_s / \partial t$：主要由温度变化（例如，绝热抬升/下沉或潜热释放）驱动。

通过这种方式，云分数的演变与模式的动力学和[热力学](@entry_id:172368)核心实现了完全耦合。此外，这还揭示了云分数对不同参数的敏感性。例如，当网格平均状态是次饱和的（$\mu  q_s$, $x > 0$），增加次网格方差（$\partial \sigma / \partial t > 0$）会导致云分数增加（$\partial c / \partial t > 0$）。这解释了为什么即使在平均相对湿度低于100%的区域，[湍流](@entry_id:151300)也能有效地生成云 。

### 垂直重叠[参数化](@entry_id:265163)

一个三维大气模式柱包含多个层次的云。为了正确计算柱内的总辐射传输（例如，到达地面的太阳辐射或射出到太空的长波辐射），仅仅知道每一层的云分数是不够的；我们还必须知道这些云层在垂直方向上是如何排列的。这就是**垂直重叠**（vertical overlap）[参数化](@entry_id:265163)的任务：它将各层的云分数 $c_k$ 组合成一个总的柱云覆盖率 $C_{tot}$。

#### 基本重叠假设

主要存在两种极限的、基础的重叠假设 ：

1.  **最大重叠**（Maximum Overlap）：此假设认为不同层次的云在垂直方向上尽可能地对齐。这物理上对应于由单一、垂直连贯的系统（如[深对流](@entry_id:1123472)云塔或大规模抬升形成的云系）产生的云。在这种情况下，总的柱云覆盖率等于所有层次中云分数最大的那个值：
    $$
    C_{tot, max} = \max(c_1, c_2, \dots, c_K)
    $$
    最大重叠假设给出了对于给定层云分数的最小可能总云覆盖率。

2.  **随机重叠**（Random Overlap）：此假设认为不同层次的云的水平位置是统计独立的。这物理上对应于由完全不相关的过程（例如，一个低空的边界层云和一个高空的卷云）形成的、垂直间隔很远的云层。在这种情况下，整个柱子晴空的概率是每一层都晴空的概率的乘积。总云覆盖率是“非晴空”的概率：
    $$
    C_{tot, rand} = 1 - \prod_{k=1}^K (1 - c_k)
    $$
    对于两层云，这个公式简化为 $C_{tot, rand} = c_1 + c_2 - c_1 c_2$。随机重叠假设给出了最大可能的总云覆盖率。

#### 广义重叠与混合方案

现实中的云重叠行为介于最大和随机重叠之间。云层之间的相关性通常随着它们[垂直距离](@entry_id:176279)的增加而减弱。为了模拟这种行为，发展出了**广义重叠**（generalized overlap）或混合方案。

一种常见的方法是引入一个依赖于垂直分离 $\Delta z$ 的**重叠参数** $\alpha(\Delta z)$，该参数在 $[0, 1]$ 区间内变化，用于线性混合最大和随机重叠的[联合概率](@entry_id:266356) 。对于两层云，其重叠部分（即两层都有云的概率）可以表示为：
$$
\mathbb{E}[I_1 I_2] = \alpha(\Delta z) \min(f_1, f_2) + (1 - \alpha(\Delta z)) f_1 f_2
$$
这里，$\mathbb{E}[I_1 I_2]$ 是两层云指示函数的期望，即联合概率。$\alpha(\Delta z)$ 可被解释为云出现事件的归一化垂直协方差。它通常被建模为一个随 $\Delta z$ 指数衰减的函数，例如 $\alpha(\Delta z) = \exp(-\Delta z / L_d)$，其中 $L_d$ 是一个**去相关长度**（decorrelation length）。当 $\Delta z \to 0$ 时，$\alpha \to 1$，恢复最大重叠；当 $\Delta z \to \infty$ 时，$\alpha \to 0$，恢复随机重叠。

另一种等价的表述是直接混合总云覆盖率 ：
$$
C_{tot} = \alpha(\Delta z) C_{tot, max} + (1 - \alpha(\Delta z)) C_{tot, rand}
$$

**最大-随机重叠**（Maximum-Random Overlap）是一种更简单的混合方案，它不进行平滑混合，而是使用一个阈值：当云层间距小于去相关长度 $L_d$ 时，采用最大重叠；当间距大于或等于 $L_d$ 时，采用随机重叠 。

### 高级主题与应用

#### 尺度感知与分辨率依赖性

一个理想的[参数化](@entry_id:265163)方案应该具有**尺度感知**（scale-aware）能力，即其行为应能适应模式分辨率的变化。在[云重叠参数化](@entry_id:1122522)中，这意味着去相关长度 $L_d$ 可能本身就依赖于水平网格间距 $\Delta$。物理直觉是，在更高分辨率的模式中（$\Delta$ 较小），解析出的云结构本身更加连贯，因此次网格的垂直相[干性](@entry_id:900268)应该更强（即 $L_d$ 更大）。

例如，一个尺度感知的去[相关长度](@entry_id:143364)可以这样建模 ：
$$
L_d(\Delta) = L_{\mathrm{ref}} \frac{\Delta_c}{\Delta_c + \Delta}
$$
其中 $L_{\mathrm{ref}}$ 和 $\Delta_c$ 是参考常数。在这个公式中，当分辨率变粗（$\Delta$ 增大）时，$L_d$ 会减小，导致云的垂直相关性减弱，重叠行为更趋向于随机。忽略这种[尺度依赖性](@entry_id:197044)，而在所有分辨率下都使用一个固定的 $L_d$ 会引入偏差，尤其是在粗分辨率下，可能会错误地高估云的垂直连贯性，从而低估总云量 。

#### 特定云系的重叠行为

最佳的重叠假设取决于所模拟的云的物理类型 。
- **层积云**（Stratocumulus）：通常是薄而水平广阔的云层，内部的[湍流](@entry_id:151300)运动使得云顶和云底紧密耦合。因此，最大重叠是描述层积云内部垂直结构的一个很好的近似。
- **[浅对流](@entry_id:1131529)云**（Shallow Cumulus）：由离散的、[浮力](@entry_id:154088)的热泡组成，这些热泡的生命周期相对较短，水平位置也较为随机。因此，随机重叠更适合描述分離的[浅对流](@entry_id:1131529)云层之间的关系。
- **深对流云**（Deep Convection）：具有垂直深厚发展的云核，但在高空常常伴随着广阔分离的云砧。云核部分可能表现出最大重叠，但云核与远处的云砧之间的重叠更接近于随机。因此，广义重叠对于描述整个深对流系统至关重要。

#### 在辐射计算中的应用：McICA

云的垂直重叠对辐射计算有直接且重要的影响。**[蒙特卡洛](@entry_id:144354)独立柱近似**（Monte Carlo Independent Column Approximation, McICA）是一种高效的辐射计算方法，它通过在一个谱段（$g$-point）内多次调用一维辐射传输模型来考虑次网格云的异质性。每一次调用都使用一个随机生成的、垂直方向上云的有无剖面，即一个“子柱” 。

生成这些子柱的**子柱生成器**（subcolumn generator）必须能够准确地重现模式所预测的每层云分数 $c_k$ 以及层与层之间的垂直相关性（即重叠假设）。一个先进的方法是使用**高斯 Copula**。该方法首先生成一个服从特定[协方差矩阵](@entry_id:139155) $R$（该矩阵编码了预期的重叠相关性）的多元正态随机向量，然后通过[概率积分变换](@entry_id:262799)将其转换为一组相关的均匀分布随机数，最后根据每层的云分数阈值生成云的有无剖面。通过为每个 $g$-point 生成一个独立的子柱，McICA能够有效减少辐射计算的方差，同时忠实地反映复杂的云重叠物理 。

#### 数值属性的重要性

最后，[参数化](@entry_id:265163)方案的数学和数值属性对其在模式中的成功实施至关重要 。一个健壮的方案应具备：
- **有界性（Boundedness）**：云分数必须始终保持在物理区间 $[0, 1]$ 内。采用如[指数积分器](@entry_id:170113)或隐式格式的时间积分方案，可以无条件地保证这一点。
- **[可微性](@entry_id:140863)（Differentiability）**：方案的输出（如总云量）对输入的平滑依赖性（连续可微）对于现代资料同化（如4D-Var）和[模型调优](@entry_id:1128055)至关重要。使用如 "soft-max" 这类平滑函数来替代非光滑的 `min` 或 `max` 函数可以确保[可微性](@entry_id:140863)。
- **稳定性（Stability）**：数值方案应在各种时间步长下都保持稳定，避免产生非物理性的振荡。隐式或半隐式的[时间积分](@entry_id:267413)方案通常比显式方案具有更好的稳定性。

总之，云分数和重叠[参数化](@entry_id:265163)是大气建模中的一个复杂而 crucial 的领域，它连接了次网格的物理过程与模式可解析的动力学和辐射。从基本的统计定义到先进的尺度感知和数值稳定的方案，这一领域的研究仍在不断发展，以期更准确地捕捉云在地球气候系统中的多样化作用。