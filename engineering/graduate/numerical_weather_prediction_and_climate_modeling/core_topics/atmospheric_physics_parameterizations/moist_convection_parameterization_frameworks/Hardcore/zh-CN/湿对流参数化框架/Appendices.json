{
    "hands_on_practices": [
        {
            "introduction": "浮力是驱动对流上升运动的根本动力，但在一个真实的对流云体中，浮力不仅取决于温度和湿度的差异，还受到悬浮的液态水或冰晶（即凝结物）的拖曳作用。这个练习通过一个简化的模型，定量地计算凝结物负载如何影响浮力，并最终降低中性浮力层的高度，从而帮助我们理解这一关键物理过程在参数化方案中的重要性。",
            "id": "4066668",
            "problem": "一个整体羽流湿对流参数化方案正在一个数值天气预报（NWP）和气候模拟框架内进行测试。考虑一个在环境中的上升云块，其中该云块相对于环境的虚温盈余分数被模拟为高度 $z$ 的线性函数：\n$$\\delta(z) \\equiv \\frac{T_{v,\\mathrm{parcel}}(z)-T_{v,\\mathrm{env}}(z)}{T_{v,\\mathrm{env}}(z)} = \\Delta_{0} - \\mu z,$$\n其中 $T_{v}$ 表示虚温，$\\Delta_{0}$ 是云底的虚温盈余分数，$\\mu$ 是一个与夹卷相关的、随高度变化的常数衰减率。羽流中的悬浮凝结物通过一个附加项 $-g q_{c}(z)$ 对浮力产生拖曳效应，其中 $g$ 是重力加速度，$q_{c}(z)$ 是凝结物质量混合比。假设在达到中性浮力层（LNB）的高度层内，凝结物含量可以近似为随高度线性递减，\n$$q_{c}(z) = q_{c0} - s z,$$\n其中 $q_{c0}$ 是云底凝结物混合比，$s$ 是一个以高度为单位的常数降落率。那么云块的浮力为\n$$B(z) = g\\left[\\delta(z) - q_{c}(z)\\right].$$\n在没有凝结物拖曳的情况下，浮力将是 $B_{\\mathrm{nc}}(z) = g\\,\\delta(z)$。\n\n使用这组物理上合理的参数 $\\Delta_{0} = 0.032$，$\\mu = 2.3\\times 10^{-5}\\ \\text{m}^{-1}$，$q_{c0} = 1.8\\times 10^{-3}$，$s = 1.0\\times 10^{-6}\\ \\text{m}^{-1}$，以及 $g = 9.81\\ \\text{m}\\ \\text{s}^{-2}$，计算由凝结物拖曳引起的 LNB 高度的降低量，定义为\n$$\\Delta z \\equiv z_{\\mathrm{LNB,nc}} - z_{\\mathrm{LNB,cl}},$$\n其中 $z_{\\mathrm{LNB,nc}}$ 是没有凝结物拖曳时的 LNB，$z_{\\mathrm{LNB,cl}}$ 是有凝结物拖曳时的 LNB。最终答案以米为单位表示，并四舍五入到四位有效数字。",
            "solution": "问题要求计算由凝结物拖曳引起的中性浮力层（LNB）高度的降低量。LNB 被定义为云块浮力 $B(z)$ 变为零时的高度，记为 $z_{\\mathrm{LNB}}$。\n\n首先，我们考虑没有凝结物拖曳的情况。浮力由 $B_{\\mathrm{nc}}(z) = g\\,\\delta(z)$ 给出。代入虚温盈余分数的表达式 $\\delta(z) = \\Delta_{0} - \\mu z$，我们得到：\n$$B_{\\mathrm{nc}}(z) = g(\\Delta_{0} - \\mu z)$$\n在这种情况下，LNB 高度 $z_{\\mathrm{LNB,nc}}$ 通过设置 $B_{\\mathrm{nc}}(z_{\\mathrm{LNB,nc}}) = 0$ 来求得。由于重力加速度 $g$ 不为零，这要求：\n$$\\Delta_{0} - \\mu z_{\\mathrm{LNB,nc}} = 0$$\n解出 $z_{\\mathrm{LNB,nc}}$ 可得：\n$$z_{\\mathrm{LNB,nc}} = \\frac{\\Delta_{0}}{\\mu}$$\n\n接下来，我们考虑有凝结物拖曳的情况。浮力由 $B(z) = g\\left[\\delta(z) - q_{c}(z)\\right]$ 给出。我们代入 $\\delta(z)$ 和凝结物质量混合比 $q_{c}(z) = q_{c0} - s z$ 的表达式：\n$$B(z) = g\\left[(\\Delta_{0} - \\mu z) - (q_{c0} - s z)\\right]$$\n合并含 $z$ 的项，我们得到：\n$$B(z) = g\\left[(\\Delta_{0} - q_{c0}) - (\\mu - s)z\\right]$$\n在这种情况下，LNB 高度 $z_{\\mathrm{LNB,cl}}$ 通过设置 $B(z_{\\mathrm{LNB,cl}}) = 0$ 来求得。同样，由于 $g \\neq 0$：\n$$(\\Delta_{0} - q_{c0}) - (\\mu - s)z_{\\mathrm{LNB,cl}} = 0$$\n解出 $z_{\\mathrm{LNB,cl}}$ 可得：\n$$z_{\\mathrm{LNB,cl}} = \\frac{\\Delta_{0} - q_{c0}}{\\mu - s}$$\n\n问题要求我们计算 LNB 高度的降低量 $\\Delta z \\equiv z_{\\mathrm{LNB,nc}} - z_{\\mathrm{LNB,cl}}$。使用上面推导出的表达式：\n$$\\Delta z = \\frac{\\Delta_{0}}{\\mu} - \\frac{\\Delta_{0} - q_{c0}}{\\mu - s}$$\n为了进行数值计算，我们代入给定的参数值：$\\Delta_{0} = 0.032$，$\\mu = 2.3\\times 10^{-5}\\ \\text{m}^{-1}$，$q_{c0} = 1.8\\times 10^{-3}$，以及 $s = 1.0\\times 10^{-6}\\ \\text{m}^{-1}$。计算 $\\Delta z$ 不需要 $g$ 的值，因为它在确定 LNB 高度时被消去了。\n\n首先，我们计算 $z_{\\mathrm{LNB,nc}}$：\n$$z_{\\mathrm{LNB,nc}} = \\frac{0.032}{2.3\\times 10^{-5}\\ \\text{m}^{-1}} \\approx 1391.3043\\ \\text{m}$$\n\n接下来，我们计算 $z_{\\mathrm{LNB,cl}}$：\n$$z_{\\mathrm{LNB,cl}} = \\frac{0.032 - 1.8\\times 10^{-3}}{2.3\\times 10^{-5}\\ \\text{m}^{-1} - 1.0\\times 10^{-6}\\ \\text{m}^{-1}} = \\frac{0.0302}{2.2\\times 10^{-5}\\ \\text{m}^{-1}} \\approx 1372.7273\\ \\text{m}$$\n\n最后，我们计算差值 $\\Delta z$：\n$$\\Delta z = z_{\\mathrm{LNB,nc}} - z_{\\mathrm{LNB,cl}} \\approx 1391.3043\\ \\text{m} - 1372.7273\\ \\text{m} \\approx 18.5770\\ \\text{m}$$\n\n问题要求答案四舍五入到四位有效数字。计算出的值约为 $18.5770\\ \\text{m}$。第五位有效数字是 $7$，大于或等于 $5$，所以我们将第四位有效数字向上取整。\n$$\\Delta z \\approx 18.58\\ \\text{m}$$",
            "answer": "$$\\boxed{18.58}$$"
        },
        {
            "introduction": "质量通量方案的核心是模拟对流云如何垂直输送热量、水汽和其他物理量。要深入理解其工作原理，最好的方式就是亲手实现其核心算法。这个练习将指导你通过求解标量守恒方程，来计算上升气流中的物理量廓线及其对环境场的反馈，这是掌握对流参数化内部动力学机制的关键一步。",
            "id": "4066603",
            "problem": "考虑一个用于数值天气预报（NWP）和气候模拟的单羽流质量通量湿对流参数化框架。一股上升气流将一个守恒标量混合比 $\\phi$（例如，水汽混合比）从云底向上输送。环境具有该标量的已知垂直廓线 $\\phi_e(z)$。上升气流质量通量 $M(z)$（单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$）通过夹卷 $\\epsilon(z)$（单位为 $\\mathrm{m}^{-1}$）和夹出 $\\delta(z)$（单位为 $\\mathrm{m}^{-1}$）与环境进行质量交换。空气密度廓线 $\\rho(z)$（单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$）也已指定。\n\n基本控制关系如下：\n- 上升气流质量连续性： $$\\frac{d M}{d z} = \\left(\\epsilon(z) - \\delta(z)\\right) M(z).$$\n- 守恒混合比的上升气流标量收支： $$\\frac{d}{d z}\\left(M(z)\\,\\phi_u(z)\\right) = \\epsilon(z)\\,M(z)\\,\\phi_e(z) - \\delta(z)\\,M(z)\\,\\phi_u(z),$$ 其中 $\\phi_u(z)$ 是上升气流标量廓线（单位为 $\\mathrm{kg}/\\mathrm{kg}$）。\n- 由上升气流通量辐散引起的标量的网格平均对流趋势： $$\\frac{\\partial \\bar{\\phi}}{\\partial t}(z) = -\\frac{1}{\\rho(z)}\\,\\frac{d}{d z}\\left(M(z)\\,\\left[\\phi_u(z) - \\phi_e(z)\\right]\\right),$$ 其单位为 $\\mathrm{s}^{-1}$。\n\n假设一个离散化的垂直网格，其层级为 $z_i$（$i = 0,\\dots,N-1$），海拔高度以米为单位单调递增。云底的边界条件为 $\\phi_u(z_0) = \\phi_e(z_0) + \\Delta\\phi_0$，其中 $\\Delta\\phi_0$ 是一个指定的初始上升气流超量，单位为 $\\mathrm{kg}/\\mathrm{kg}$。使用数值上一致的一阶精度有限差分积分在垂直方向上计算从云底到云顶的 $\\phi_u(z)$，然后使用对流通量 $M(z)\\,(\\phi_u(z)-\\phi_e(z))$ 的一致离散垂直导数计算网格平均对流趋势廓线 $\\partial \\bar{\\phi}/\\partial t$。在计算离散导数时，边界处使用单边差分，内部使用中心差分。\n\n答案要求：\n- 所有 $\\phi_u(z)$ 值以 $\\mathrm{kg}/\\mathrm{kg}$ 为单位表示，并四舍五入到六位小数。\n- 所有网格平均趋势值 $\\partial \\bar{\\phi}/\\partial t$ 以 $\\mathrm{s}^{-1}$ 为单位表示，并四舍五入到六位小数。\n- 不涉及角度，因此不需要角度单位。\n- 不涉及百分比。\n\n您的程序必须实现以下包含三个测试用例的测试套件的计算。在所有情况下，空气密度由静力平衡指数形式 $\\rho(z) = \\rho_0 \\exp\\left(-\\frac{z}{H}\\right)$ 指定，其中 $\\rho_0 = 1.2\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，标高 $H = 8000\\,\\mathrm{m}$。\n\n情况 A (一般情况)：\n- 层级： $z = [0, 1000, 2000, 3000, 4000, 5000]\\,\\mathrm{m}$。\n- 上升气流质量通量： $M(z) = [0.060, 0.080, 0.100, 0.080, 0.050, 0.020]\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。\n- 夹卷： $\\epsilon(z) = [1.0\\times 10^{-4}, 1.5\\times 10^{-4}, 2.0\\times 10^{-4}, 2.0\\times 10^{-4}, 1.5\\times 10^{-4}, 1.0\\times 10^{-4}]\\,\\mathrm{m}^{-1}$。\n- 夹出： $\\delta(z) = [2.0\\times 10^{-4}, 2.5\\times 10^{-4}, 3.0\\times 10^{-4}, 3.0\\times 10^{-4}, 2.5\\times 10^{-4}, 2.0\\times 10^{-4}]\\,\\mathrm{m}^{-1}$。\n- 环境标量： $\\phi_e(z) = [0.018, 0.016, 0.013, 0.010, 0.007, 0.005]\\,\\mathrm{kg}/\\mathrm{kg}$。\n- 云底超量： $\\Delta\\phi_0 = 0.004\\,\\mathrm{kg}/\\mathrm{kg}$，因此 $\\phi_u(z_0) = 0.022\\,\\mathrm{kg}/\\mathrm{kg}$。\n\n情况 B (边界条件：零夹卷)：\n- 层级： $z = [0, 1500, 3000, 4500]\\,\\mathrm{m}$。\n- 上升气流质量通量： $M(z) = [0.050, 0.060, 0.040, 0.010]\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。\n- 夹卷： $\\epsilon(z) = [0.0, 0.0, 0.0, 0.0]\\,\\mathrm{m}^{-1}$。\n- 夹出： $\\delta(z) = [1.0\\times 10^{-4}, 2.0\\times 10^{-4}, 3.0\\times 10^{-4}, 4.0\\times 10^{-4}]\\,\\mathrm{m}^{-1}$。\n- 环境标量： $\\phi_e(z) = [0.020, 0.015, 0.010, 0.006]\\,\\mathrm{kg}/\\mathrm{kg}$。\n- 云底超量： $\\Delta\\phi_0 = 0.000\\,\\mathrm{kg}/\\mathrm{kg}$，因此 $\\phi_u(z_0) = 0.020\\,\\mathrm{kg}/\\mathrm{kg}$。\n\n情况 C (边缘情况：强夹卷伴随高层质量通量衰减)：\n- 层级： $z = [0, 800, 1600, 2400, 3200, 4000]\\,\\mathrm{m}$。\n- 上升气流质量通量： $M(z) = [0.070, 0.090, 0.070, 0.050, 0.030, 0.010]\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。\n- 夹卷： $\\epsilon(z) = [2.0\\times 10^{-4}, 3.0\\times 10^{-4}, 4.0\\times 10^{-4}, 5.0\\times 10^{-4}, 6.0\\times 10^{-4}, 7.0\\times 10^{-4}]\\,\\mathrm{m}^{-1}$。\n- 夹出： $\\delta(z) = [1.5\\times 10^{-4}, 2.5\\times 10^{-4}, 3.5\\times 10^{-4}, 4.5\\times 10^{-4}, 5.5\\times 10^{-4}, 6.5\\times 10^{-4}]\\,\\mathrm{m}^{-1}$。\n- 环境标量： $\\phi_e(z) = [0.019, 0.017, 0.014, 0.012, 0.010, 0.009]\\,\\mathrm{kg}/\\mathrm{kg}$。\n- 云底超量： $\\Delta\\phi_0 = 0.003\\,\\mathrm{kg}/\\mathrm{kg}$，因此 $\\phi_u(z_0) = 0.022\\,\\mathrm{kg}/\\mathrm{kg}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。对于每个测试用例，输出一个包含两个元素的列表：第一个元素是在所有给定的 $z$ 层级上 $\\phi_u(z)$ 值的列表（单位为 $\\mathrm{kg}/\\mathrm{kg}$，四舍五入到六位小数），第二个元素是在所有给定的 $z$ 层级上 $\\partial \\bar{\\phi}/\\partial t$ 值的列表（单位为 $\\mathrm{s}^{-1}$，四舍五入到六位小数）。因此，整体输出必须如下所示：\n$$[\\,[\\,[\\phi_{u,0},\\dots,\\phi_{u,N-1}],\\,[T_0,\\dots,T_{N-1}]\\,],\\,\\text{情况 2 结果},\\,\\text{情况 3 结果}\\,],$$\n不得包含任何附加文本。数值必须与使用指定输入进行上述计算的结果完全一致。",
            "solution": "问题陈述已经过严格验证，被认为是自洽、有科学依据、适定且客观的。它提出了一个大气对流参数化中的标准简化问题，为获得唯一解提供了所有必要的控制方程、边界条件和数据。数值方法已明确指定。因此，将提供一个解答。\n\n目标是为一个单羽流质量通量对流方案，计算上升气流标量混合比的垂直廓线 $\\phi_u(z)$，以及该标量产生的网格平均趋势 $\\frac{\\partial \\bar{\\phi}}{\\partial t}(z)$。解决方案涉及离散化并求解控制微分方程。\n\n首先，我们简化上升气流标量收支方程。给定的方程是：\n1. 上升气流质量连续性：\n$$ \\frac{d M}{d z} = \\left(\\epsilon(z) - \\delta(z)\\right) M(z) $$\n2. 上升气流标量收支：\n$$ \\frac{d}{d z}\\left(M(z)\\,\\phi_u(z)\\right) = \\epsilon(z)\\,M(z)\\,\\phi_e(z) - \\delta(z)\\,M(z)\\,\\phi_u(z) $$\n\n对标量收支方程的左侧应用乘积法则求导，得到：\n$$ M(z)\\,\\frac{d\\phi_u}{dz} + \\phi_u(z)\\,\\frac{dM}{dz} = \\epsilon(z)\\,M(z)\\,\\phi_e(z) - \\delta(z)\\,M(z)\\,\\phi_u(z) $$\n\n将质量连续性方程代入 $\\frac{dM}{dz}$：\n$$ M(z)\\,\\frac{d\\phi_u}{dz} + \\phi_u(z)\\,\\left[\\left(\\epsilon(z) - \\delta(z)\\right) M(z)\\right] = \\epsilon(z)\\,M(z)\\,\\phi_e(z) - \\delta(z)\\,M(z)\\,\\phi_u(z) $$\n\n展开左侧的项：\n$$ M(z)\\,\\frac{d\\phi_u}{dz} + \\epsilon(z)\\,M(z)\\,\\phi_u(z) - \\delta(z)\\,M(z)\\,\\phi_u(z) = \\epsilon(z)\\,M(z)\\,\\phi_e(z) - \\delta(z)\\,M(z)\\,\\phi_u(z) $$\n\n项 $-\\delta(z)\\,M(z)\\,\\phi_u(z)$ 出现在两侧，可以消去。假设上升气流质量通量 $M(z)$ 非零，我们可以将整个方程除以 $M(z)$：\n$$ \\frac{d\\phi_u}{dz} + \\epsilon(z)\\,\\phi_u(z) = \\epsilon(z)\\,\\phi_e(z) $$\n\n这简化为关于 $\\phi_u(z)$ 的一阶线性常微分方程：\n$$ \\frac{d\\phi_u}{dz} = \\epsilon(z)\\,\\left(\\phi_e(z) - \\phi_u(z)\\right) $$\n\n该方程描述了由于夹卷了环境空气，上升气流标量值如何随高度变化。它必须从云底 $z_0$ 开始进行垂直积分。问题指定了一阶精度的有限差分积分。我们使用前向欧拉法。给定一个离散的垂直网格 $z_i$ ($i = 0,\\dots,N-1$)，我们可以将导数近似为 $\\frac{d\\phi_u}{dz} \\approx \\frac{\\phi_{u,i+1} - \\phi_{u,i}}{z_{i+1} - z_i}$。离散化后的方程变为：\n$$ \\frac{\\phi_{u,i+1} - \\phi_{u,i}}{z_{i+1} - z_i} = \\epsilon_i (\\phi_{e,i} - \\phi_{u,i}) $$\n\n求解 $\\phi_{u,i+1}$，我们得到计算上升气流标量廓线的迭代公式：\n$$ \\phi_{u,i+1} = \\phi_{u,i} + (z_{i+1} - z_i)\\,\\epsilon_i\\,(\\phi_{e,i} - \\phi_{u,i}) $$\n\n从给定的边界条件 $\\phi_{u,0} = \\phi_{e,0} + \\Delta\\phi_0$ 开始，对 $i = 0, 1, \\dots, N-2$ 迭代应用此公式，以找到完整的廓线 $\\phi_u(z_i)$。\n\n接下来，我们计算网格平均对流趋势 $\\frac{\\partial \\bar{\\phi}}{\\partial t}(z)$。控制方程为：\n$$ \\frac{\\partial \\bar{\\phi}}{\\partial t}(z) = -\\frac{1}{\\rho(z)}\\,\\frac{d}{d z}\\left(M(z)\\,\\left[\\phi_u(z) - \\phi_e(z)\\right]\\right) $$\n令对流标量通量为 $F(z) = M(z)\\,(\\phi_u(z) - \\phi_e(z))$。则趋势为 $\\frac{\\partial \\bar{\\phi}}{\\partial t}(z) = -\\frac{1}{\\rho(z)}\\,\\frac{dF}{dz}$。\n\n首先，我们在每个网格层级 $i$ 计算通量廓线 $F_i = M_i\\,(\\phi_{u,i} - \\phi_{e,i})$。然后，我们使用指定的有限差分格式计算通量的离散垂直导数 $(\\frac{dF}{dz})_i$：\n- 在下边界 ($i=0$)：一阶前向差分。\n$$ \\left(\\frac{dF}{dz}\\right)_0 = \\frac{F_1 - F_0}{z_1 - z_0} $$\n- 在内部 ($0  i  N-1$)：二阶中心差分。\n$$ \\left(\\frac{dF}{dz}\\right)_i = \\frac{F_{i+1} - F_{i-1}}{z_{i+1} - z_{i-1}} $$\n- 在上边界 ($i=N-1$)：一阶后向差分。\n$$ \\left(\\frac{dF}{dz}\\right)_{N-1} = \\frac{F_{N-1} - F_{N-2}}{z_{N-1} - z_{N-2}} $$\n\n最后，每个层级 $i$ 的趋势计算如下：\n$$ \\left(\\frac{\\partial \\bar{\\phi}}{\\partial t}\\right)_i = -\\frac{1}{\\rho_i}\\,\\left(\\frac{dF}{dz}\\right)_i $$\n其中空气密度 $\\rho_i$ 由静力平衡廓线 $\\rho_i = \\rho_0 \\exp\\left(-\\frac{z_i}{H}\\right)$ 给出，其中 $\\rho_0 = 1.2\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$ 且 $H = 8000\\,\\mathrm{m}$。\n\n$\\phi_u$ 和 $\\frac{\\partial \\bar{\\phi}}{\\partial t}$ 的最终结果按要求四舍五入到六位小数。该算法将应用于三个测试用例中的每一个。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the moist convection parameterization problem\n    for the given test suite.\n    \"\"\"\n\n    # Constants\n    RHO_0 = 1.2  # kg/m^3\n    H_SCALE = 8000.0  # m\n\n    def calculate_profiles(z, M, epsilon, delta, phi_e, delta_phi_0):\n        \"\"\"\n        Calculates the updraft scalar profile phi_u and the grid-mean\n        convective tendency for a single case.\n\n        Args:\n            z (np.ndarray): Vertical levels in meters.\n            M (np.ndarray): Updraft mass flux profile.\n            epsilon (np.ndarray): Entrainment rate profile.\n            delta (np.ndarray): Detrainment rate profile.\n            phi_e (np.ndarray): Environmental scalar profile.\n            delta_phi_0 (float): Cloud-base updraft scalar excess.\n\n        Returns:\n            tuple: A tuple containing two lists:\n                   - The rounded phi_u profile.\n                   - The rounded tendency profile.\n        \"\"\"\n        N = len(z)\n        \n        # 1. Compute updraft scalar profile phi_u\n        phi_u = np.zeros(N)\n        phi_u[0] = phi_e[0] + delta_phi_0\n        \n        for i in range(N - 1):\n            dz = z[i+1] - z[i]\n            # First-order forward Euler integration\n            phi_u[i+1] = phi_u[i] + dz * epsilon[i] * (phi_e[i] - phi_u[i])\n\n        # 2. Compute air density profile rho\n        rho = RHO_0 * np.exp(-z / H_SCALE)\n\n        # 3. Compute convective scalar flux F\n        F = M * (phi_u - phi_e)\n\n        # 4. Compute vertical derivative of the flux, dF/dz\n        dFdz = np.zeros(N)\n        \n        # Lower boundary: forward difference\n        dFdz[0] = (F[1] - F[0]) / (z[1] - z[0])\n        \n        # Interior: centered difference\n        for i in range(1, N - 1):\n            dFdz[i] = (F[i+1] - F[i-1]) / (z[i+1] - z[i-1])\n            \n        # Upper boundary: backward difference\n        dFdz[N-1] = (F[N-1] - F[N-2]) / (z[N-1] - z[N-2])\n\n        # 5. Compute grid-mean tendency\n        tendency = -1.0 / rho * dFdz\n\n        # 6. Round results to 6 decimal places\n        phi_u_rounded = np.round(phi_u, 6).tolist()\n        tendency_rounded = np.round(tendency, 6).tolist()\n\n        return phi_u_rounded, tendency_rounded\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"z\": np.array([0, 1000, 2000, 3000, 4000, 5000], dtype=float),\n            \"M\": np.array([0.060, 0.080, 0.100, 0.080, 0.050, 0.020], dtype=float),\n            \"epsilon\": np.array([1.0e-4, 1.5e-4, 2.0e-4, 2.0e-4, 1.5e-4, 1.0e-4], dtype=float),\n            \"delta\": np.array([2.0e-4, 2.5e-4, 3.0e-4, 3.0e-4, 2.5e-4, 2.0e-4], dtype=float),\n            \"phi_e\": np.array([0.018, 0.016, 0.013, 0.010, 0.007, 0.005], dtype=float),\n            \"delta_phi_0\": 0.004\n        },\n        # Case B\n        {\n            \"z\": np.array([0, 1500, 3000, 4500], dtype=float),\n            \"M\": np.array([0.050, 0.060, 0.040, 0.010], dtype=float),\n            \"epsilon\": np.array([0.0, 0.0, 0.0, 0.0], dtype=float),\n            \"delta\": np.array([1.0e-4, 2.0e-4, 3.0e-4, 4.0e-4], dtype=float),\n            \"phi_e\": np.array([0.020, 0.015, 0.010, 0.006], dtype=float),\n            \"delta_phi_0\": 0.000\n        },\n        # Case C\n        {\n            \"z\": np.array([0, 800, 1600, 2400, 3200, 4000], dtype=float),\n            \"M\": np.array([0.070, 0.090, 0.070, 0.050, 0.030, 0.010], dtype=float),\n            \"epsilon\": np.array([2.0e-4, 3.0e-4, 4.0e-4, 5.0e-4, 6.0e-4, 7.0e-4], dtype=float),\n            \"delta\": np.array([1.5e-4, 2.5e-4, 3.5e-4, 4.5e-4, 5.5e-4, 6.5e-4], dtype=float),\n            \"phi_e\": np.array([0.019, 0.017, 0.014, 0.012, 0.010, 0.009], dtype=float),\n            \"delta_phi_0\": 0.003\n        }\n    ]\n\n    all_results_str = []\n    for case in test_cases:\n        phi_u, tendency = calculate_profiles(\n            case[\"z\"], case[\"M\"], case[\"epsilon\"], case[\"delta\"], case[\"phi_e\"], case[\"delta_phi_0\"]\n        )\n        \n        phi_u_str = f\"[{','.join(map(str, phi_u))}]\"\n        tendency_str = f\"[{','.join(map(str, tendency))}]\"\n        \n        case_result_str = f\"[{phi_u_str},{tendency_str}]\"\n        all_results_str.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在定义了对流的输送机制之后，参数化方案还需要一个“闭合”假设来确定对流的强度。CAPE弛豫闭合是一种经典的准平衡思想，它将对流质量通量与大尺度环境产生对流不稳定性的速率联系起来。通过本练习，你将学习如何应用这一闭合方案，根据大气不稳定性（以CAPE衡量）的消耗来反推所需的对流活动强度。",
            "id": "4066653",
            "problem": "考虑一个数值天气预报（NWP）模式中的单柱对流参数化方案，该方案采用湿对流质量通量框架。气柱不稳定性由对流有效位能（CAPE）来衡量，其定义为自由对流高度和平衡高度之间浮力的垂直积分，\n$$\nC \\equiv \\int_{z_b}^{z_t} g \\,\\frac{\\theta_{v}'(z)}{\\theta_{v}(z)}\\,dz,\n$$\n其中 $g$ 是重力加速度，$\\theta_{v}'$ 是气块相对于环境的虚位温扰动，$\\theta_{v}$ 是环境虚位温。在一种准平衡类型的CAPE弛豫闭合方案中，对流趋势被约束在指定的时间尺度 $\\tau$ 内将CAPE减小到一个平衡值，因此模拟的CAPE趋势反映了气柱浮力库的弛豫过程。\n\n假设与夹卷羽流相关的对流加热可以用云底质量通量 $M_b$（单位 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$）来总体表示，并且该质量通量在一段时间内降低CAPE的气柱积分效率由一个加热效率参数 $\\epsilon$（单位 $\\mathrm{J\\,m^2\\,kg^{-2}}$）来表征，它将云底质量通量（单位 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$）关联到CAPE的减少速率（单位 $\\mathrm{J\\,kg^{-1}\\,s^{-1}}$）。对于本问题，取 $\\epsilon = 50\\,\\mathrm{J\\,m^2\\,kg^{-2}}$。CAPE弛豫闭合方案的时间尺度为 $\\tau = 1\\,\\mathrm{h}$。\n\n从初始CAPE值 $C_0 = 2000\\,\\mathrm{J\\,kg^{-1}}$ 开始，确定在一个模式时间步长 $\\Delta t = 600\\,\\mathrm{s}$ 内，将CAPE降低到 $C_1 = 1000\\,\\mathrm{J\\,kg^{-1}}$ 所需的恒定云底质量通量 $M_b$。假设在该时间步长内，CAPE的减少完全由与 $M_b$ 相关的对流加热产生，并且其他过程（例如，大尺度平流、辐射、微物理）在 $\\Delta t$ 期间可以忽略不计。\n\n你的答案必须根据上述定义给出一个有理有据的推导过程，证明 $M_b$、$\\epsilon$ 和实现所需有限CAPE变化的CAPE趋势之间的关系是合理的。将最终数值结果四舍五入到四位有效数字。最终的 $M_b$ 以 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$ 为单位表示。",
            "solution": "对流有效位能（CAPE）的定义为\n$$\nC \\equiv \\int_{z_b}^{z_t} g \\,\\frac{\\theta_{v}'(z)}{\\theta_{v}(z)}\\,dz,\n$$\n其由对流加热引起的时间趋势可以与积分内的浮力趋势相关联。作为一阶近似，含云层中的温度趋势 $\\partial T/\\partial t$ 会改变浮力 $B \\equiv g\\,\\theta_{v}'/\\theta_{v}$，其改变幅度与虚位温的分数变化近似成比例。这启发我们将CAPE趋势写为由加热引起的浮力趋势的垂直积分，\n$$\n\\frac{dC}{dt} \\approx \\int_{z_b}^{z_t} g\\,\\frac{1}{\\theta_{v}(z)}\\,\\frac{\\partial \\theta_{v}'(z)}{\\partial t}\\,dz,\n$$\n其中 $\\partial \\theta_{v}'/\\partial t$ 是由对流加热和增湿引起的。\n\n在总体质量通量参数化方案中，对流加热对CAPE的气柱积分影响可以用一个加热效率 $\\epsilon$ 来概括，它将云底质量通量 $M_b$ 映射到CAPE趋势的大小。具体来说，我们假设存在以下形式的比例关系：\n$$\n\\left|\\frac{dC}{dt}\\right| \\approx \\epsilon\\,M_b,\n$$\n其中 $\\epsilon$ 的单位是 $\\mathrm{J\\,m^2\\,kg^{-2}}$。这确保了量纲一致性：$\\epsilon\\,M_b$ 的单位是 $(\\mathrm{J\\,m^2\\,kg^{-2}}) \\times (\\mathrm{kg\\,m^{-2}\\,s^{-1}}) = \\mathrm{J\\,kg^{-1}\\,s^{-1}}$，与 $dC/dt$ 的单位相匹配。这种比例关系将对流加热和夹卷的垂直结构聚合到一个单一的有效参数中。\n\n根据前述假设，时间步长 $\\Delta t$ 内的CAPE减少完全由与恒定云底质量通量 $M_b$ 相关的对流加热产生，那么 $\\Delta t$ 内CAPE的有限变化就是时间积分的趋势：\n$$\n\\Delta C \\equiv C_1 - C_0 \\approx \\left(\\frac{dC}{dt}\\right)\\,\\Delta t \\approx -\\,\\epsilon\\,M_b\\,\\Delta t,\n$$\n其中负号表示CAPE的减少。解出 $M_b$ 可得\n$$\nM_b \\approx \\frac{C_0 - C_1}{\\epsilon\\,\\Delta t}.\n$$\n这个关系式给出了所需的恒定云底质量通量，它通过相关的对流加热，在 $\\Delta t$ 时间内产生所需的有限CAPE减少量 $C_0 \\to C_1$。\n\n现在我们代入给定的数值。CAPE变化的大小为\n$$\nC_0 - C_1 = 2000\\,\\mathrm{J\\,kg^{-1}} - 1000\\,\\mathrm{J\\,kg^{-1}} = 1000\\,\\mathrm{J\\,kg^{-1}}.\n$$\n加热效率为 $\\epsilon = 50\\,\\mathrm{J\\,m^2\\,kg^{-2}}$，时间步长为 $\\Delta t = 600\\,\\mathrm{s}$。因此，\n$$\nM_b = \\frac{1000}{50 \\times 600} = \\frac{1000}{30000} = \\frac{1}{30}.\n$$\n数值上，\n$$\nM_b = 0.033333\\ldots\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}}.\n$$\n四舍五入到四位有效数字，结果是\n$$\nM_b = 0.03333\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}}.\n$$\n\n作为背景信息，我们可以将此所需的质量通量与时间步开始时的准平衡CAPE弛豫闭合方案趋势进行比较。该闭合方案规定了一个大小为 $|dC/dt|_{\\tau} = C/\\tau$ 的瞬时趋势，初始时得到\n$$\n\\left|\\frac{dC}{dt}\\right|_{\\tau} = \\frac{2000\\,\\mathrm{J\\,kg^{-1}}}{3600\\,\\mathrm{s}} \\approx 0.5556\\,\\mathrm{J\\,kg^{-1}\\,s^{-1}}.\n$$\n实现指定减少量所需的趋势为\n$$\n\\left|\\frac{dC}{dt}\\right|_{\\mathrm{req}} = \\frac{C_0 - C_1}{\\Delta t} = \\frac{1000}{600} \\approx 1.6667\\,\\mathrm{J\\,kg^{-1}\\,s^{-1}},\n$$\n这恰好是 $C_0$ 时闭合方案趋势的三倍。与此一致地，由于 $\\epsilon$ 是固定的，所需的质量通量是闭合方案所隐含的质量通量 $M_b^{(\\tau)} = (C/\\tau)/\\epsilon$ 的三倍。尽管如此，要求的最终答案是使用给定的 $\\epsilon$ 在 $\\Delta t$ 时间内产生指定有限减少量所需的 $M_b$ 值，正如上面所推导的那样。",
            "answer": "$$\\boxed{0.03333}$$"
        }
    ]
}