{
    "hands_on_practices": [
        {
            "introduction": "Nudging 是一种将模型状态向观测或分析场“轻推”的强大技术，但其效果严重依赖于所选的 Nudging 系数 $\\alpha$。如果 $\\alpha$ 太小，数据同化的效果会微乎其微；如果太大，则可能过度压制模型自身的物理过程，甚至引入不必要的噪声。本练习提供了一个寻找 $\\alpha$ 最优值的方法，通过一个简化的线性误差动力学模型，推导预报误差如何响应 $\\alpha$ 的变化，并利用一组假设的实验数据来拟合响应曲线，从而确定能使预报误差最小化的最佳 Nudging 强度 。",
            "id": "4069123",
            "problem": "考虑一个用于数值天气预报 (NWP) 的一维线性预报误差模型，其中增量分析更新 (IAU) 通过连续松弛（逼近）的方式实现。设在离散模型时间 $t_k = k \\Delta t$ 时的预报误差为 $e_k$，同化时间步长为 $\\Delta t$。假设可解的线性模型动力学产生稳定的误差传播，其特征是每个时间步长的实数放大因子 $0  \\rho  1$，并且 IAU 逼近以与误差成比例的松弛项形式引入，强度为 $\\alpha$（单位为时间的倒数）。组合的离散时间误差更新可表示为\n$$\ne_{k+1} = \\left(\\rho - \\alpha \\Delta t\\right) e_k + \\xi_k,\n$$\n其中 $\\xi_k$ 是零均值、时间上不相关的过程噪声，其方差为 $\\sigma^2$，代表模型和未解过程的扰动。设预报时效为 $T = N \\Delta t$，并将预报均方根误差 (RMSE) 定义为\n$$\n\\mathrm{RMSE}(T;\\alpha) = \\sqrt{\\mathbb{E}\\left[e_N^2\\right]}。\n$$\n\n从上述动力学和统计假设出发，并使用在 $\\alpha \\Delta t$ 相对于 $\\rho$ 较小时有效的线性化方法，推导预报时效 $T$ 时预报误差方差 $\\mathbb{E}\\left[e_N^2\\right]$ 关于 $\\alpha$ 的二阶泰勒近似，表示为关于 $\\alpha$ 的二次响应曲线，\n$$\n\\mathbb{E}\\left[e_N^2\\right] \\approx \\beta_0 + \\beta_1 \\alpha + \\beta_2 \\alpha^2,\n$$\n其中系数 $\\beta_0$、$\\beta_1$ 和 $\\beta_2$ 是 $\\rho$、$\\Delta t$、$N$、初始二阶矩 $v_0 = \\mathbb{E}\\left[e_0^2\\right]$ 以及过程噪声方差 $\\sigma^2$ 的函数。通过对 $\\mathbb{E}\\left[e_N^2\\right]$ 的依赖于 $\\alpha$ 的精确表达式关于 $\\alpha$ 求导，并在 $\\alpha = 0$ 处求值，从第一性原理出发明确地确定这些系数。\n\n接着，假设一组在预报时效 $T$、同化时间步长 $\\Delta t = 600$ 秒且 $N = 36$ 的条件下进行的受控预报实验，对于三种逼近强度，得出以下测量的 RMSE 值（单位：开尔文）：\n- $\\alpha_0 = 0$ 时，$\\mathrm{RMSE}(T; \\alpha_0) = 1.80$，\n- $\\alpha_1 = 2.0 \\times 10^{-4}$ 时，$\\mathrm{RMSE}(T; \\alpha_1) = 1.55$，\n- $\\alpha_2 = 6.0 \\times 10^{-4}$ 时，$\\mathrm{RMSE}(T; \\alpha_2) = 1.62$。\n\n将 $\\mathrm{RMSE}^2(T;\\alpha)$ 视为二次响应 $\\beta_0 + \\beta_1 \\alpha + \\beta_2 \\alpha^2$，将 $\\beta_0$、$\\beta_1$ 和 $\\beta_2$ 拟合到这三个数据点，并使用拟合曲线选择使预报时效 $T$ 时的预报方差最小化的逼近强度 $\\alpha^\\star$。\n\n将最终的 $\\alpha^\\star$ 值四舍五入到三位有效数字，并以 $\\mathrm{s}^{-1}$ 为单位表示。最终答案必须是一个实数。",
            "solution": "用户提供了一个由两部分组成的问题。第一部分要求推导预报误差方差的二次近似系数。第二部分要求将此二次模型拟合到实验数据并找到最优的逼近强度。\n\n### 问题验证\n问题陈述已经过验证，被认为是具有科学依据、良定、客观且自洽的。该模型是数值天气预报 (NWP) 中带逼近的误差动力学的标准简化表示。这些任务在数学上是严谨的，不需要外部信息。所提供的数据对于要求的分析是一致且充分的。因此，该问题被认为是有效的，并将提供完整的解决方案。\n\n### 第一部分：泰勒级数系数的推导\n\n时间步长 $k$ 处的预报误差 $e_k$ 由以下线性递推关系决定：\n$$\ne_{k+1} = (\\rho - \\alpha \\Delta t) e_k + \\xi_k\n$$\n让我们定义有效放大因子为 $R(\\alpha) = \\rho - \\alpha \\Delta t$。方程变为 $e_{k+1} = R(\\alpha) e_k + \\xi_k$。\n为了找到预报时效 $T = N \\Delta t$ 时的误差 $e_N$，我们可以从初始误差 $e_0$ 开始展开递推关系：\n$$\ne_1 = R(\\alpha) e_0 + \\xi_0 \\\\\ne_2 = R(\\alpha) e_1 + \\xi_1 = R(\\alpha) \\left(R(\\alpha) e_0 + \\xi_0\\right) + \\xi_1 = R(\\alpha)^2 e_0 + R(\\alpha) \\xi_0 + \\xi_1\n$$\n通过归纳法，第 $N$ 步的误差由以下公式给出：\n$$\ne_N = R(\\alpha)^N e_0 + \\sum_{j=0}^{N-1} R(\\alpha)^{N-1-j} \\xi_j\n$$\n问题要求的是预报误差方差 $V(\\alpha) = \\mathbb{E}[e_N^2]$。我们对 $e_N$ 的表达式进行平方并取期望。\n$$\ne_N^2 = \\left(R(\\alpha)^N e_0 + \\sum_{j=0}^{N-1} R(\\alpha)^{N-1-j} \\xi_j\\right)^2 = R(\\alpha)^{2N} e_0^2 + 2 R(\\alpha)^N e_0 \\sum_{j=0}^{N-1} R(\\alpha)^{N-1-j} \\xi_j + \\left(\\sum_{j=0}^{N-1} R(\\alpha)^{N-1-j} \\xi_j\\right)^2\n$$\n取期望 $\\mathbb{E}[\\cdot]$，我们使用给定的统计特性：$\\mathbb{E}[\\xi_k] = 0$，$\\mathbb{E}[\\xi_j \\xi_k] = \\sigma^2 \\delta_{jk}$（其中 $\\delta_{jk}$ 是克罗内克 $\\delta$），并且初始误差 $e_0$ 与过程噪声 $\\xi_k$ 不相关，因此 $\\mathbb{E}[e_0 \\xi_k] = \\mathbb{E}[e_0] \\mathbb{E}[\\xi_k] = 0$。\n交叉项的期望为零：\n$$\n\\mathbb{E}\\left[2 R(\\alpha)^N e_0 \\sum_{j=0}^{N-1} R(\\alpha)^{N-1-j} \\xi_j\\right] = 2 R(\\alpha)^N \\sum_{j=0}^{N-1} R(\\alpha)^{N-1-j} \\mathbb{E}[e_0 \\xi_j] = 0\n$$\n由于 $\\xi_k$ 的不相关性，噪声项平方和的期望简化为：\n$$\n\\mathbb{E}\\left[\\left(\\sum_{j=0}^{N-1} R(\\alpha)^{N-1-j} \\xi_j\\right)^2\\right] = \\sum_{j=0}^{N-1} \\sum_{l=0}^{N-1} R(\\alpha)^{N-1-j} R(\\alpha)^{N-1-l} \\mathbb{E}[\\xi_j \\xi_l] = \\sum_{j=0}^{N-1} (R(\\alpha)^{N-1-j})^2 \\sigma^2 \\delta_{jj} = \\sigma^2 \\sum_{j=0}^{N-1} R(\\alpha)^{2(N-1-j)}\n$$\n令 $k = N-1-j$，该和变为 $\\sigma^2 \\sum_{k=0}^{N-1} R(\\alpha)^{2k}$。这是一个几何级数。\n合并各项，并使用 $v_0 = \\mathbb{E}[e_0^2]$，方差的精确表达式为：\n$$\nV(\\alpha) = \\mathbb{E}[e_N^2] = v_0 R(\\alpha)^{2N} + \\sigma^2 \\sum_{k=0}^{N-1} R(\\alpha)^{2k}\n$$\n问题要求的是 $V(\\alpha)$ 在 $\\alpha=0$ 附近的二阶泰勒近似：\n$$\nV(\\alpha) \\approx V(0) + V'(0)\\alpha + \\frac{1}{2}V''(0)\\alpha^2 = \\beta_0 + \\beta_1 \\alpha + \\beta_2 \\alpha^2\n$$\n系数为 $\\beta_0 = V(0)$、$\\beta_1 = V'(0)$ 和 $\\beta_2 = \\frac{1}{2}V''(0)$。我们通过求导来找到它们。\n\n**系数 $\\beta_0$**：\n设 $\\alpha=0$，则 $R(0) = \\rho$。\n$$\n\\beta_0 = V(0) = v_0 \\rho^{2N} + \\sigma^2 \\sum_{k=0}^{N-1} \\rho^{2k} = v_0 \\rho^{2N} + \\sigma^2 \\frac{1-\\rho^{2N}}{1-\\rho^2}\n$$\n\n**系数 $\\beta_1$**：\n首先，我们求导数 $V'(\\alpha)$。我们使用链式法则，注意 $\\frac{dR}{d\\alpha} = -\\Delta t$。\n$$\nV'(\\alpha) = \\frac{d}{d\\alpha}\\left(v_0 R(\\alpha)^{2N} + \\sigma^2 \\sum_{k=0}^{N-1} R(\\alpha)^{2k}\\right) = v_0 \\cdot 2N R(\\alpha)^{2N-1} \\frac{dR}{d\\alpha} + \\sigma^2 \\sum_{k=1}^{N-1} 2k R(\\alpha)^{2k-1} \\frac{dR}{d\\alpha}\n$$\n（注意，和中 $k=0$ 的项是常数 $1$，所以其导数为零）。\n$$\nV'(\\alpha) = -\\Delta t \\left( 2N v_0 R(\\alpha)^{2N-1} + 2\\sigma^2 \\sum_{k=1}^{N-1} k R(\\alpha)^{2k-1} \\right)\n$$\n在 $\\alpha=0$ 处求值（因此 $R(0)=\\rho$）：\n$$\n\\beta_1 = V'(0) = -2\\Delta t \\left( N v_0 \\rho^{2N-1} + \\sigma^2 \\sum_{k=1}^{N-1} k \\rho^{2k-1} \\right)\n$$\n\n**系数 $\\beta_2$**：\n接下来，我们通过对 $V'(\\alpha)$ 求导来找到二阶导数 $V''(\\alpha)$：\n$$\nV''(\\alpha) = \\frac{d}{d\\alpha} V'(\\alpha) = (-\\Delta t) \\frac{d}{d\\alpha} \\left( 2N v_0 R(\\alpha)^{2N-1} + 2\\sigma^2 \\sum_{k=1}^{N-1} k R(\\alpha)^{2k-1} \\right)\n$$\n再次应用链式法则：\n$$\nV''(\\alpha) = (-\\Delta t)^2 \\left( 2N v_0 (2N-1) R(\\alpha)^{2N-2} + 2\\sigma^2 \\sum_{k=1}^{N-1} k(2k-1)R(\\alpha)^{2k-2} \\right)\n$$\n在 $\\alpha=0$ 处求值：\n$$\nV''(0) = (\\Delta t)^2 \\left( 2N(2N-1)v_0 \\rho^{2N-2} + 2\\sigma^2 \\sum_{k=1}^{N-1} k(2k-1)\\rho^{2k-2} \\right)\n$$\n系数 $\\beta_2$ 是 $\\frac{1}{2}V''(0)$：\n$$\n\\beta_2 = \\frac{1}{2}V''(0) = (\\Delta t)^2 \\left( N(2N-1)v_0 \\rho^{2N-2} + \\sigma^2 \\sum_{k=1}^{N-1} k(2k-1)\\rho^{2k-2} \\right)\n$$\n这些就是系数 $\\beta_0$、$\\beta_1$ 和 $\\beta_2$ 的表达式。\n\n### 第二部分：数据拟合与优化\n\n给定三个数据点 $(\\alpha_i, \\mathrm{RMSE}_i)$，要求拟合模型 $\\mathbb{E}[e_N^2] = \\beta_0 + \\beta_1 \\alpha + \\beta_2 \\alpha^2$。令 $y_i = \\mathrm{RMSE}_i^2$。数据点如下：\n\\begin{itemize}\n    \\item 对于 $\\alpha_0 = 0 \\text{ s}^{-1}$，$y_0 = (1.80)^2 = 3.24 \\text{ K}^2$。\n    \\item 对于 $\\alpha_1 = 2.0 \\times 10^{-4} \\text{ s}^{-1}$，$y_1 = (1.55)^2 = 2.4025 \\text{ K}^2$。\n    \\item 对于 $\\alpha_2 = 6.0 \\times 10^{-4} \\text{ s}^{-1}$，$y_2 = (1.62)^2 = 2.6244 \\text{ K}^2$。\n\\end{itemize}\n我们建立一个包含三个线性方程的方程组来求解系数 $\\beta_0$、$\\beta_1$ 和 $\\beta_2$：\n\\begin{align*}\ny_0 = \\beta_0 + \\beta_1 \\alpha_0 + \\beta_2 \\alpha_0^2 \\quad (1) \\\\\ny_1 = \\beta_0 + \\beta_1 \\alpha_1 + \\beta_2 \\alpha_1^2 \\quad (2) \\\\\ny_2 = \\beta_0 + \\beta_1 \\alpha_2 + \\beta_2 \\alpha_2^2 \\quad (3)\n\\end{align*}\n代入数值：\n\\begin{align*}\n3.24 = \\beta_0 + \\beta_1(0) + \\beta_2(0)^2 \\\\\n2.4025 = \\beta_0 + \\beta_1(2.0 \\times 10^{-4}) + \\beta_2(2.0 \\times 10^{-4})^2 \\\\\n2.6244 = \\beta_0 + \\beta_1(6.0 \\times 10^{-4}) + \\beta_2(6.0 \\times 10^{-4})^2\n\\end{align*}\n从方程 (1)，我们立即得到 $\\beta_0$：\n$$\n\\beta_0 = 3.24\n$$\n将此值代入方程 (2) 和 (3)，得到一个关于 $\\beta_1$ 和 $\\beta_2$ 的 $2 \\times 2$ 方程组：\n\\begin{align*}\n2.4025 - 3.24 = (2.0 \\times 10^{-4})\\beta_1 + (4.0 \\times 10^{-8})\\beta_2 \\implies -0.8375 = (2.0 \\times 10^{-4})\\beta_1 + (4.0 \\times 10^{-8})\\beta_2 \\quad (2') \\\\\n2.6244 - 3.24 = (6.0 \\times 10^{-4})\\beta_1 + (36.0 \\times 10^{-8})\\beta_2 \\implies -0.6156 = (6.0 \\times 10^{-4})\\beta_1 + (3.6 \\times 10^{-7})\\beta_2 \\quad (3')\n\\end{align*}\n为了解这个方程组，我们可以将方程 $(2')$ 乘以 $3$：\n$$\n-2.5125 = (6.0 \\times 10^{-4})\\beta_1 + (1.2 \\times 10^{-7})\\beta_2 \\quad (2'')\n$$\n将 $(3')$ 减去 $(2'')$ 以消去 $\\beta_1$：\n$$\n-0.6156 - (-2.5125) = ((3.6 \\times 10^{-7}) - (1.2 \\times 10^{-7}))\\beta_2 \\\\\n1.8969 = (2.4 \\times 10^{-7})\\beta_2\n$$\n求解 $\\beta_2$：\n$$\n\\beta_2 = \\frac{1.8969}{2.4 \\times 10^{-7}} = 7903750\n$$\n现在，将 $\\beta_2$ 代回方程 $(2')$ 来求解 $\\beta_1$：\n$$\n-0.8375 = (2.0 \\times 10^{-4})\\beta_1 + (4.0 \\times 10^{-8})(7903750) \\\\\n-0.8375 = (2.0 \\times 10^{-4})\\beta_1 + 0.31615 \\\\\n-0.8375 - 0.31615 = (2.0 \\times 10^{-4})\\beta_1 \\\\\n-1.15365 = (2.0 \\times 10^{-4})\\beta_1\n$$\n求解 $\\beta_1$：\n$$\n\\beta_1 = \\frac{-1.15365}{2.0 \\times 10^{-4}} = -5768.25\n$$\n拟合得到的方差二次函数为 $y(\\alpha) = 7903750 \\alpha^2 - 5768.25 \\alpha + 3.24$。\n为了找到使该方差最小化的逼近强度 $\\alpha^\\star$，我们将关于 $\\alpha$ 的导数设为零：\n$$\n\\frac{dy}{d\\alpha} = 2\\beta_2 \\alpha + \\beta_1 = 0\n$$\n最优值 $\\alpha^\\star$ 为：\n$$\n\\alpha^\\star = -\\frac{\\beta_1}{2\\beta_2}\n$$\n代入拟合值：\n$$\n\\alpha^\\star = -\\frac{-5768.25}{2 \\times 7903750} = \\frac{5768.25}{15807500} \\approx 0.000364906... \\text{ s}^{-1}\n$$\n四舍五入到三位有效数字，我们得到：\n$$\n\\alpha^\\star \\approx 3.65 \\times 10^{-4} \\text{ s}^{-1}\n$$\n二阶导数 $\\frac{d^2y}{d\\alpha^2} = 2\\beta_2 = 2 \\times 7903750 > 0$，证实了 $\\alpha^\\star$ 的这个值对应一个最小值。",
            "answer": "$$\n\\boxed{3.65 \\times 10^{-4}}\n$$"
        },
        {
            "introduction": "在地球物理流体系统中，并非所有运动都应同等对待，我们可以将大气状态分解为缓慢演变的“平衡”部分（如大尺度天气系统）和快速传播的“非平衡”波动（如惯性重力波）。直接对整个状态进行 Nudging 或增量分析更新（IAU）可能会激发虚假的非平衡波，从而污染预报结果。本练习将演示一种更精妙的技术，即利用正规模分解，仅将分析增量应用于流场的平衡部分，从而有效地避免产生这些虚假的噪音波 。",
            "id": "4069131",
            "problem": "考虑在科里奥利参数为常数的平面（通常称为$f$平面）上，线性化旋转浅水方程的单个傅里叶波数表示。设状态向量为 $\\delta x = [\\hat{u}, \\hat{v}, \\hat{\\eta}]^\\top$，其中 $\\hat{u}$ 和 $\\hat{v}$ 是纬向和经向速度分量的复傅里叶振幅（单位为 $\\mathrm{m/s}$），$\\hat{\\eta}$ 是自由面高度扰动的复傅里叶振幅（单位为 $\\mathrm{m}$）。对于给定的实数波数 $k$（单位为 $\\mathrm{rad/m}$）、平均深度 $H$（单位为 $\\mathrm{m}$）、重力加速度 $g$（单位为 $\\mathrm{m/s^2}$）和科里奥利参数 $f$（单位为 $\\mathrm{s^{-1}}$），控制傅里叶振幅时间倾向的线性算子是由线性化动量守恒和质量守恒定律定义的 $3 \\times 3$ 复矩阵 $L(k)$：\n$$\n\\frac{d}{dt}\n\\begin{bmatrix}\n\\hat{u} \\\\ \\hat{v} \\\\ \\hat{\\eta}\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n0  f  -\\, i\\, g\\, k \\\\\n-\\, f  0  0 \\\\\n-\\, i\\, H\\, k  0  0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\hat{u} \\\\ \\hat{v} \\\\ \\hat{\\eta}\n\\end{bmatrix}\n\\equiv L(k)\\, \\delta x,\n$$\n其中 $i$ 是虚数单位。$L(k)$ 的简正模分解产生一个平衡（零频率）本征模和两个具有纯虚数频率的惯性重力快模。增量分析更新（Incremental Analysis Updating, IAU）在一个持续时间为 $\\Delta t$（单位为 $\\mathrm{s}$）的有限窗口内，将分析增量作为一个随时不变的倾向引入，而不是瞬时变化。为减轻快模的伪激励，一种策略是利用模态分解将分析增量 $\\delta x$ 分解为平衡和非平衡分量，并仅对平衡分量应用IAU。\n\n您的任务是：\n- 从上述给定的线性系统及其谱表示出发，推导出将任意增量 $\\delta x$ 分解为一个平衡分量和两个快模分量的简正模分解。使用 $L(k)$ 的右本征向量和左本征向量的双正交集来定义模态系数。\n- 从线性时不变系统的第一性原理出发，推导每个模态对在窗口 $[0,\\Delta t]$ 上施加的随时不变强迫的响应。利用此结果设计两种IAU策略：（i）对完整增量应用IAU；（ii）仅对平衡分量应用IAU。同时考虑直接瞬时插入（无IAU）的基准策略。\n- 通过计算由下式定义的快模分数 $\\phi$ 来量化窗口结束后的快模含量：\n$$\n\\phi = \\frac{\\sum_{i \\in \\mathcal{F}} \\left| \\tilde{c}_i \\right|^2}{\\sum_{j} \\left| \\tilde{c}_j \\right|^2},\n$$\n其中 $\\tilde{c}$ 是对应于给定策略的最终状态的模态系数，$\\mathcal{F}$ 索引两个快模。将 $\\phi$ 表示为十进制数。\n\n使用以下科学上真实的参数值和测试套件。在所有情况下，使用 $g = 9.81\\,\\mathrm{m/s^2}$，$H = 10000\\,\\mathrm{m}$，$f = 1.0 \\times 10^{-4}\\,\\mathrm{s^{-1}}$，以及IAU窗口 $\\Delta t = 6000\\,\\mathrm{s}$。对于每个测试用例，$k$ 以 $\\mathrm{rad/m}$ 为单位指定，$\\delta x$ 由其分量 $(\\hat{u}, \\hat{v}, \\hat{\\eta})$ 给出，其中 $\\hat{u}$ 和 $\\hat{v}$ 的单位为 $\\mathrm{m/s}$，$\\hat{\\eta}$ 的单位为 $\\mathrm{m}$：\n- 测试用例1（一般混合增量，理想情况）：$k = 1.0 \\times 10^{-6}$，$\\delta x = (1.0, 0.5, 0.1)$。\n- 测试用例2（为满足地转相位关系而构造的纯平衡增量）：$k = 1.0 \\times 10^{-6}$，$\\delta x = \\left(0.0, i \\frac{g k}{f} \\times 1.0,\\ 1.0\\right)$。\n- 测试用例3（纯快模类增量）：$k = 3.0 \\times 10^{-6}$，$\\delta x = (2.0, 0.0, 0.0)$。\n- 测试用例4（$k=0$ 的边界情况）：$k = 0.0$，$\\delta x = (0.0, 0.0, 1.0)$。\n\n您的程序必须：\n1. 为每个测试用例构建 $L(k)$。\n2. 计算 $L(k)$ 的右本征向量 $V$ 和左本征向量 $W$，并将它们双正交化，使得 $W^\\top V = I$，并识别大小最接近 $0$ 的本征值所对应的平衡模。\n3. 计算模态增量 $\\delta c = W^\\top \\delta x$。\n4. 对于三种策略，计算IAU窗口后的最终模态系数：\n   - 直接插入（无IAU）：$\\tilde{c}^{\\mathrm{dir}} = \\delta c$。\n   - 完整IAU：$\\tilde{c}^{\\mathrm{full}}$ 通过对每个模态在持续时间 $\\Delta t$ 内应用精确的常数强迫响应得到。\n   - 仅平衡IAU：$\\tilde{c}^{\\mathrm{bal}}$ 等于 $\\delta c$ 的平衡分量，所有快模分量设置为零。\n5. 为每个测试用例计算 $\\phi^{\\mathrm{dir}}$、$\\phi^{\\mathrm{full}}$ 和 $\\phi^{\\mathrm{bal}}$，结果为无量纲十进制数。\n\n$k$ 的角度单位是弧度。所有物理量必须以国际单位制（SI）处理。您的程序应生成一行输出，包含一个由四个列表组成的逗号分隔列表，每个列表对应一个测试用例，其中包含三个十进制数，顺序为 $[\\phi^{\\mathrm{dir}}, \\phi^{\\mathrm{full}}, \\phi^{\\mathrm{bal}}]$。例如，输出格式必须严格为：\n$$\n\\texttt{[[\\phi_{1,\\mathrm{dir}},\\phi_{1,\\mathrm{full}},\\phi_{1,\\mathrm{bal}}],[\\phi_{2,\\mathrm{dir}},\\phi_{2,\\mathrm{full}},\\phi_{2,\\mathrm{bal}}],[\\phi_{3,\\mathrm{dir}},\\phi_{3,\\mathrm{full}},\\phi_{3,\\mathrm{bal}}],[\\phi_{4,\\mathrm{dir}},\\phi_{4,\\mathrm{full}},\\phi_{4,\\mathrm{bal}}]]}\n$$\n其中每个 $\\phi$ 都表示为十进制数。",
            "solution": "该问题要求在$f$平面上的线性化旋转浅水方程框架内，对三种数据同化策略——直接插入、完整增量分析更新（IAU）和仅平衡IAU——进行定量比较。比较的依据是每种策略产生的伪快模能量。这通过快模分数 $\\phi$ 来量化。解决方案首先推导系统的简正模分解，然后推导每个模态对IAU特有的常数强迫的响应，最后应用这些结果计算每种策略和每个测试用例的 $\\phi$。\n\n**1. 线性算子的简正模分解**\n\n控制线性系统由 $\\frac{d}{dt}\\delta x = L(k) \\delta x$ 给出，其中 $\\delta x = [\\hat{u}, \\hat{v}, \\hat{\\eta}]^\\top$ 是傅里叶振幅的状态向量，$L(k)$ 是线性算子：\n$$\nL(k) =\n\\begin{bmatrix}\n0  f  -\\, i\\, g\\, k \\\\\n-\\, f  0  0 \\\\\n-\\, i\\, H\\, k  0  0\n\\end{bmatrix}\n$$\n系统的简正模对应于 $L(k)$ 的本征向量。相关的本征值 $\\lambda$ 是这些模态的复频率。通过求解特征方程 $\\det(L(k) - \\lambda I) = 0$ 来找到它们：\n$$\n\\det \\begin{bmatrix} -\\lambda  f  -igk \\\\ -f  -\\lambda  0 \\\\ -iHk  0  -\\lambda \\end{bmatrix} = -\\lambda(\\lambda^2) - f(f\\lambda) - igk(i\\lambda Hk) = -\\lambda(\\lambda^2 + f^2 + gHk^2) = 0\n$$\n对于 $k>0$ 和 $f>0$，这会产生三个不同的本征值：\n1.  $\\lambda_1 = 0$：这对应一个静止的、零频率的模态，称为平衡模或地转模。\n2.  $\\lambda_{2,3} = \\pm i \\sqrt{f^2 + gHk^2} \\equiv \\pm i\\omega_{igw}$：这对应一对反向传播的高频惯性重力波（快模），其频率为 $\\omega_{igw}$。\n\n系统可以使用右本征向量矩阵 $V$ 和左本征向量矩阵 $W$ 进行对角化。右本征向量 $V_j$ 是 $V$ 的列，满足 $L(k)V_j = \\lambda_j V_j$。左本征向量 $W_j$ 是 $W^\\top$ 的相应行，满足 $W_j^\\top L(k) = \\lambda_j W_j^\\top$。这些本征向量集是双正交的。它们可以被缩放以使得 $W^\\top V = I$，其中 $I$ 是单位矩阵。这个关系意味着 $W^\\top = V^{-1}$。\n\n任意状态向量 $\\delta x$ 可以投影到这个模态基上：\n$$\n\\delta x = \\sum_j (\\delta c_j) V_j = V \\delta c\n$$\n其中 $\\delta c = [\\delta c_1, \\delta c_2, \\delta c_3]^\\top$ 是模态系数向量。利用双正交性，这些系数可通过以下方式找到：\n$$\n\\delta c = V^{-1} \\delta x = W^\\top \\delta x\n$$\n系数 $\\delta c_1$ 表示 $\\delta x$ 的平衡模分量的振幅，而 $\\delta c_2$ 和 $\\delta c_3$ 表示两个快模分量的振幅。\n\n**2. 对常数强迫（IAU）的响应**\n\nIAU将分析增量 $\\delta x$ 作为一个在持续时间为 $\\Delta t$ 的时间窗口内的常数强迫项。从 $x(0)=0$ 开始，状态 $x(t)$ 的控制微分方程为：\n$$\n\\frac{d x}{dt} = L(k) x + \\frac{\\delta x}{\\Delta t}, \\quad \\text{对于 } t \\in [0, \\Delta t]\n$$\n将此方程投影到模态基上，我们得到一组关于模态系数 $c_j(t)$ 的解耦常微分方程：\n$$\n\\frac{d c_j}{dt} = \\lambda_j c_j + \\frac{\\delta c_j}{\\Delta t}\n$$\n这个方程在初始条件 $c_j(0) = 0$ 下的解可以通过标准方法找到。对于 $\\lambda_j \\neq 0$：\n$$\nc_j(t) = \\frac{\\delta c_j}{\\lambda_j \\Delta t} (e^{\\lambda_j t} - 1)\n$$\n对于平衡模，其中 $\\lambda_1 = 0$，方程简化为 $\\frac{d c_1}{dt} = \\frac{\\delta c_1}{\\Delta t}$，积分得到 $c_1(t) = \\frac{\\delta c_1}{\\Delta t} t$。\n\n在IAU窗口结束时，$t=\\Delta t$，最终的模态系数 $\\tilde{c}_j = c_j(\\Delta t)$ 为：\n-   对于快模（$j=2,3$）：$\\tilde{c}_j = \\frac{\\delta c_j}{\\lambda_j \\Delta t} (e^{\\lambda_j \\Delta t} - 1)$。\n-   对于平衡模（$j=1$）：$\\tilde{c}_1 = \\frac{\\delta c_1}{\\Delta t} \\Delta t = \\delta c_1$。\n\n我们可以为每个模态定义一个响应因子 $R_j$，使得 $\\tilde{c}_j = R_j \\delta c_j$。\n$$\nR_j = \\begin{cases} \\frac{e^{\\lambda_j \\Delta t} - 1}{\\lambda_j \\Delta t}  \\text{如果 } \\lambda_j \\neq 0 \\\\ 1  \\text{如果 } \\lambda_j = 0 \\end{cases}\n$$\n极限 $\\lim_{\\lambda \\to 0} (e^{\\lambda \\Delta t}-1)/(\\lambda \\Delta t) = 1$，所以该公式是一致的。快模的响应因子 $|R_{2,3}| = |\\mathrm{sinc}(\\omega_{igw} \\Delta t / 2)|$ 起到低通滤波器的作用。对于自变量 $\\omega_{igw} \\Delta t$ 较大的快波，响应被显著抑制。\n\n**3. 同化策略的比较**\n\n我们现在可以为三种策略中的每一种定义最终的模态状态 $\\tilde{c}$。\n\n-   **直接插入 (dir)**：增量被瞬时添加。最终状态为 $\\delta x$。相应的模态系数就是增量本身的系数：\n    $$\n    \\tilde{c}^{\\mathrm{dir}} = \\delta c\n    $$\n-   **完整IAU (full)**：增量作为常数强迫在 $\\Delta t$ 时间内施加。最终的模态系数通过对每个模态应用响应因子得到：\n    $$\n    \\tilde{c}^{\\mathrm{full}}_j = R_j \\delta c_j\n    $$\n-   **仅平衡IAU (bal)**：IAU过程仅应用于增量的平衡部分，快模分量被舍弃。这意味着最终状态只包含原始增量的平衡分量。\n    $$\n    \\tilde{c}^{\\mathrm{bal}}_1 = \\delta c_1, \\quad \\tilde{c}^{\\mathrm{bal}}_{2,3} = 0\n    $$\n\n**4. 快模分数计算**\n\n快模分数 $\\phi$ 是快模中的能量与所有模态总能量的比率。能量与模态系数的平方模之和成正比。设 $\\mathcal{F} = \\{2,3\\}$ 为快模指数的集合。\n$$\n\\phi = \\frac{\\sum_{j \\in \\mathcal{F}} \\left| \\tilde{c}_j \\right|^2}{\\sum_{j=1}^3 \\left| \\tilde{c}_j \\right|^2}\n$$\n-   对于直接插入：$\\phi^{\\mathrm{dir}} = \\frac{|\\delta c_2|^2 + |\\delta c_3|^2}{|\\delta c_1|^2 + |\\delta c_2|^2 + |\\delta c_3|^2}$。\n-   对于完整IAU：$\\phi^{\\mathrm{full}} = \\frac{|R_2 \\delta c_2|^2 + |R_3 \\delta c_3|^2}{|R_1 \\delta c_1|^2 + |R_2 \\delta c_2|^2 + |R_3 \\delta c_3|^2}$。因为 $|\\lambda_2|=|\\lambda_3|$，所以 $|R_2|=|R_3|=|R_{fast}|$，且 $R_1=1$。因此：\n    $$\n    \\phi^{\\mathrm{full}} = \\frac{|R_{fast}|^2 (|\\delta c_2|^2 + |\\delta c_3|^2)}{|\\delta c_1|^2 + |R_{fast}|^2 (|\\delta c_2|^2 + |\\delta c_3|^2)}\n    $$\n-   对于仅平衡IAU：$\\phi^{\\mathrm{bal}} = \\frac{|0|^2 + |0|^2}{|\\delta c_1|^2 + |0|^2 + |0|^2} = 0$（假设 $\\delta c_1 \\neq 0$；如果 $\\delta c_1 = 0$，结果为 $0/0$，自然解释为 $0$）。\n\n**5. 特殊情况：$k=0$**\n\n当 $k=0$ 时，算子 $L(0)$ 简化，得到的本征值为 $\\lambda_1=0$，$\\lambda_{2,3}=\\pm if$。平衡模的本征向量变为 $[0, 0, 1]^\\top$，代表纯高度扰动。快模变为纯惯性振荡，其本征向量为 $[1, \\pm i, 0]^\\top$。计算 $\\phi$ 的过程保持不变，只是使用这些特定的模态。使用通用本征求解器的数值实现可以处理这种情况，除了在矩阵 $L$ 中设置 $k=0$ 外，无需单独的逻辑。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the fast-mode fraction for three data assimilation strategies\n    based on a linearized rotating shallow-water model.\n    \"\"\"\n    # Define constants\n    g = 9.81  # m/s^2\n    H = 10000.0  # m\n    f = 1.0e-4  # s^-1\n    dt = 6000.0  # s\n\n    # Define test cases: (k, delta_x)\n    # delta_x is given as (u, v, eta)\n    test_cases = [\n        (1.0e-6, np.array([1.0, 0.5, 0.1], dtype=complex)),\n        (1.0e-6, np.array([0.0, 1j * g * 1.0e-6 / f * 1.0, 1.0], dtype=complex)),\n        (3.0e-6, np.array([2.0, 0.0, 0.0], dtype=complex)),\n        (0.0, np.array([0.0, 0.0, 1.0], dtype=complex)),\n    ]\n\n    results = []\n    \n    for k, delta_x in test_cases:\n        # 1. Construct the linear operator L(k)\n        L = np.array([\n            [0, f, -1j * g * k],\n            [-f, 0, 0],\n            [-1j * H * k, 0, 0]\n        ], dtype=complex)\n\n        # 2. Compute eigenvalues, right eigenvectors (V), and left eigenvectors (W^T)\n        eigvals, V = np.linalg.eig(L)\n        \n        # W.T = V^-1\n        try:\n            W_T = np.linalg.inv(V)\n        except np.linalg.LinAlgError:\n            # For rank-deficient matrices, use pseudo-inverse\n            W_T = np.linalg.pinv(V)\n\n        # Identify balanced mode index\n        bal_idx = np.argmin(np.abs(eigvals))\n        fast_indices = [i for i in range(3) if i != bal_idx]\n\n        # 3. Compute the modal increment vector\n        delta_c = W_T @ delta_x\n\n        # Calculate squared magnitudes of modal coefficients\n        delta_c_sq_mag = np.abs(delta_c)**2\n        \n        # Numerator and denominator for direct insertion phi\n        fast_c_sq_mag_dir = np.sum(delta_c_sq_mag[fast_indices])\n        total_c_sq_mag_dir = np.sum(delta_c_sq_mag)\n\n        # 4. Compute phi for each strategy\n\n        # Strategy 1: Direct insertion\n        if total_c_sq_mag_dir  1e-15:\n            phi_dir = 0.0\n        else:\n            phi_dir = fast_c_sq_mag_dir / total_c_sq_mag_dir\n\n        # Strategy 2: Full IAU\n        R = np.ones_like(eigvals, dtype=complex)\n        for i in range(3):\n            if np.abs(eigvals[i]) > 1e-12:  # Avoid division by zero\n                R[i] = (np.exp(eigvals[i] * dt) - 1) / (eigvals[i] * dt)\n        \n        c_tilde_full = R * delta_c\n        c_tilde_full_sq_mag = np.abs(c_tilde_full)**2\n        \n        fast_c_sq_mag_full = np.sum(c_tilde_full_sq_mag[fast_indices])\n        total_c_sq_mag_full = np.sum(c_tilde_full_sq_mag)\n\n        if total_c_sq_mag_full  1e-15:\n            phi_full = 0.0\n        else:\n            phi_full = fast_c_sq_mag_full / total_c_sq_mag_full\n            \n        # Strategy 3: Balanced-only IAU\n        # By definition, fast components are zero.\n        phi_bal = 0.0\n\n        results.append([phi_dir, phi_full, phi_bal])\n\n    # Final print statement in the exact required format.\n    # Using f-string for a compact representation.\n    formatted_results = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个先进的数值模式不仅包含流体动力学核心，还集成了复杂的物理过程参数化方案，例如云的形成和消散，而这些物理过程有其自身的自然时间尺度。标准 IAU 中固定的同化窗口可能与这些物理时间尺度不匹配，从而导致物理不协调。本练习探讨一种先进的 IAU 策略，它根据模式中水汽的饱和状态动态调整同化窗口的时间长度，从而展示这种更“智能”的同化方法如何有效减少因强制改变水汽而产生的虚假冷池等不切实际的副作用 。",
            "id": "4069139",
            "problem": "考虑一个在数值天气预报和气候模拟中使用的单柱理想化模型，用于研究在存在饱和度调整和潜热加热的情况下，增量分析更新（IAU）对湿度的影响。目标是推导并实现一种水汽混合比的 IAU 策略，该策略通过在过饱和条件下使用更短的 IAU 窗口来考虑饱和度调整的时间尺度，并在此模型中展示伪冷池的减少。\n\n模型状态包括温度 $T$（单位 $\\mathrm{K}$）、水汽混合比 $q_v$（单位 $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$）、云水混合比 $q_c$（单位 $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$）以及恒定气压 $p$（单位 $\\mathrm{Pa}$）。设环境参考温度为 $T_{\\mathrm{env}}$（单位 $\\mathrm{K}$），取为初始温度。\n\n湿度饱和度通过饱和水汽压 $e_s(T)$ 和饱和混合比 $q_{vs}(T,p)$ 来定义。使用 Clausius–Clapeyron 关系式，其中参考饱和压力在 $T_0$ 时给出：\n$$\ne_s(T) = e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right),\n$$\n饱和混合比为：\n$$\nq_{vs}(T,p) = \\frac{\\epsilon \\, e_s(T)}{p - e_s(T)},\n$$\n其中 $L_v$ 是汽化潜热（单位 $\\mathrm{J}\\,\\mathrm{kg}^{-1}$），$R_v$ 是水汽的比气体常数（单位 $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$），$T_0$ 是参考温度（单位 $\\mathrm{K}$），$e_0$ 是在 $T_0$ 时的饱和水汽压（单位 $\\mathrm{Pa}$），$\\epsilon$ 是气体常数之比 $\\epsilon = R_d/R_v$，其中 $R_d$ 是干空气的比气体常数（单位 $\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$）。使用 $L_v = 2.5 \\times 10^6 \\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$，$R_v = 461 \\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$，$T_0 = 273.15 \\ \\mathrm{K}$，$e_0 = 611.2 \\ \\mathrm{Pa}$，以及 $\\epsilon = 0.622$。设定压比热为 $c_p = 1004 \\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$。\n\n定义过饱和度 $S$ 为\n$$\nS = \\frac{q_v}{q_{vs}(T,p)} - 1.\n$$\n饱和度调整表现为 $q_v$ 和 $q_c$ 之间保持质量守恒的交换，受时间尺度约束，并伴有潜热加热或冷却：\n- 如果 $q_v > q_{vs}$（过饱和），凝结以一定速率将水从水汽转移到云中\n$$\n\\frac{dq_{\\mathrm{cond}}}{dt} = \\frac{q_v - q_{vs}(T,p)}{\\tau_{\\mathrm{sat}}(S)},\n$$\n其中 $\\tau_{\\mathrm{sat}}(S) = \\dfrac{\\tau_0}{1 + \\max(S,0)/S_{\\mathrm{ref}}}$，$\\tau_0$ 和 $S_{\\mathrm{ref}}$ 是正常数。潜热加热使温度变化\n$$\n\\frac{dT}{dt} = \\frac{L_v}{c_p} \\frac{dq_{\\mathrm{cond}}}{dt}.\n$$\n- 如果 $q_v  q_{vs}$（未饱和）且 $q_c > 0$，蒸发以一定速率将水从云转移到水汽中\n$$\n\\frac{dq_{\\mathrm{evap}}}{dt} = \\min\\left(\\frac{q_{vs}(T,p) - q_v}{\\tau_{\\mathrm{evap}}}, \\frac{q_c}{\\Delta t}\\right),\n$$\n其中蒸发时间尺度 $\\tau_{\\mathrm{evap}} > 0$ 是固定的，$\\Delta t$ 是数值时间步长。潜热冷却使温度变化\n$$\n\\frac{dT}{dt} = -\\frac{L_v}{c_p} \\frac{dq_{\\mathrm{evap}}}{dt}.\n$$\n湿度 IAU 在一个有限窗口 $W$（单位 $\\mathrm{s}$）内施加一个预设的分析增量 $\\Delta q_v$（单位 $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$）。固定窗口 IAU 使用\n$$\nW_{\\mathrm{fixed}} = W_f,\n$$\n其中 $W_f > 0$ 为常数，并将增量作为强迫项均匀分布\n$$\nF_{\\mathrm{IAU}}(t) = \\begin{cases}\n\\dfrac{\\Delta q_v}{W_{\\mathrm{fixed}}},  0 \\le t  W_{\\mathrm{fixed}}, \\\\\n0,  t \\ge W_{\\mathrm{fixed}}.\n\\end{cases}\n$$\n待推导的湿度 IAU 必须通过在过饱和条件下选择更短的窗口来考虑饱和度调整的时间尺度。具体来说，定义\n$$\nW_{\\mathrm{dyn}} = \\begin{cases}\n\\min\\left(W_{\\mathrm{fixed}}, \\kappa \\, \\tau_{\\mathrm{sat}}(S_0)\\right),  S_0 > 0, \\\\\nW_{\\mathrm{fixed}},  S_0 \\le 0,\n\\end{cases}\n$$\n其中 $S_0$ 是根据初始条件计算的初始过饱和度，$\\kappa > 0$ 是一个常数。动态 IAU 强迫项则为\n$$\nF_{\\mathrm{IAU}}(t) = \\begin{cases}\n\\dfrac{\\Delta q_v}{W_{\\mathrm{dyn}}},  0 \\le t  W_{\\mathrm{dyn}}, \\\\\n0,  t \\ge W_{\\mathrm{dyn}}.\n\\end{cases}\n$$\n两种 IAU 都必须守恒总施加增量 $\\Delta q_v$。\n\n任务是实现一个时间步进模拟，时间步长 $\\Delta t = 1 \\ \\mathrm{s}$，总时长 $H = 3600 \\ \\mathrm{s}$，分别针对上述的固定窗口 IAU 和动态窗口 IAU。在每个时间步，首先对 $q_v$ 施加 IAU 强迫，然后执行给定的饱和度调整趋势和温度更新，同时约束 $q_c$ 保持非负。环境参考温度 $T_{\\mathrm{env}}$ 是每个测试用例的初始 $T$。\n\n定义伪冷池强度度量 $C$ 为相对于环境的负温差对时间的积分：\n$$\nC = \\int_0^H \\max\\left(0, T_{\\mathrm{env}} - T(t)\\right) \\, dt,\n$$\n单位为 $\\mathrm{K} \\cdot \\mathrm{s}$。此度量随低于 $T_{\\mathrm{env}}$ 的冷却幅度和持续时间的增加而增加。对于每个测试用例，计算固定窗口 IAU 的 $C_{\\mathrm{fixed}}$ 和动态窗口 IAU 的 $C_{\\mathrm{dyn}}$，并报告其减少量\n$$\nR = C_{\\mathrm{fixed}} - C_{\\mathrm{dyn}}\n$$\n单位为 $\\mathrm{K} \\cdot \\mathrm{s}$。正值 $R$ 表示使用动态窗口 IAU 时伪冷池强度有所降低。\n\n使用常数 $\\tau_0 = 300 \\ \\mathrm{s}$，$S_{\\mathrm{ref}} = 0.2$，$\\tau_{\\mathrm{evap}} = 1200 \\ \\mathrm{s}$，$\\kappa = 4$ 和 $W_f = 1800 \\ \\mathrm{s}$。\n\n实现程序以运行以下测试套件，每个测试由 $(T, p, q_v, q_c, \\Delta q_v)$ 定义：\n- 测试 $1$：$(292.0 \\ \\mathrm{K}, 90000 \\ \\mathrm{Pa}, 0.0190 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, 0.0010 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, -1.0 \\times 10^{-4} \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1})$。\n- 测试 $2$：$(292.0 \\ \\mathrm{K}, 90000 \\ \\mathrm{Pa}, 0.0190 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, 0.0010 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, +1.0 \\times 10^{-4} \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1})$。\n- 测试 $3$：$(289.0 \\ \\mathrm{K}, 95000 \\ \\mathrm{Pa}, 0.0150 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, 0.0005 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, -2.0 \\times 10^{-4} \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1})$。\n- 测试 $4$：$(295.0 \\ \\mathrm{K}, 95000 \\ \\mathrm{Pa}, 0.0205 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, 0.0015 \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1}, -2.5 \\times 10^{-4} \\ \\mathrm{kg}\\,\\mathrm{kg}^{-1})$。\n\n您的程序应生成单行输出，其中包含所有给定测试用例的减少值 $R$，格式为逗号分隔的列表并用方括号括起来（例如，$[R_1,R_2,R_3,R_4]$）。每个 $R$ 必须是浮点数，单位为 $\\mathrm{K} \\cdot \\mathrm{s}$。\n\n所有角度测量（如果有）必须以弧度为单位。所有物理量必须以上述指定单位表示。不允许用户输入；常数和测试用例必须内置于程序中。",
            "solution": "该问题要求实现一个单柱大气模型，以比较两种用于水汽混合比 $q_v$ 的增量分析更新（IAU）策略。目标是量化在使用动态窗口 IAU 相对于固定窗口 IAU 时，“伪冷池”度量的减少量。伪冷池是资料同化过程中的一种人为现象，其中强制去除水分会导致过度蒸发和不切实际的冷却。\n\n解决方案涉及使用前向欧拉法进行时间步进模拟。系统状态由温度 $T$、水汽混合比 $q_v$ 和云水混合比 $q_c$ 描述。在每次模拟中，气压 $p$ 保持恒定。\n\n### 1. 物理模型构建\n\n模型的核心是饱和度调整过程，该过程控制水汽和云水之间的相变，并伴随潜热交换。\n\n**饱和特性：** 饱和状态由饱和水汽压 $e_s(T)$ 决定，其由 Clausius–Clapeyron 方程给出：\n$$\ne_s(T) = e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right)\n$$\n其中 $e_0$ 是在参考温度 $T_0$ 时的饱和水汽压，$L_v$ 是汽化潜热，$R_v$ 是水汽的比气体常数。由此，可以计算出饱和混合比 $q_{vs}(T,p)$：\n$$\nq_{vs}(T,p) = \\frac{\\epsilon \\, e_s(T)}{p - e_s(T)}\n$$\n其中 $\\epsilon = R_d/R_v$ 是干空气和水汽的气体常数之比。过饱和度 $S$ 定义为水汽的相对超额量：\n$$\nS = \\frac{q_v}{q_{vs}(T,p)} - 1\n$$\n\n**饱和度调整过程：**\n模型将凝结和蒸发模拟为向饱和状态的张弛过程。\n\n-   **凝结：** 如果空气过饱和（$q_v > q_{vs}$），水汽会凝结成云水。凝结速率由下式给出：\n    $$\n    \\frac{dq_{\\mathrm{cond}}}{dt} = \\frac{q_v - q_{vs}(T,p)}{\\tau_{\\mathrm{sat}}(S)}\n    $$\n    调整时间尺度 $\\tau_{\\mathrm{sat}}(S)$ 依赖于状态，随过饱和度的增高而减小：\n    $$\n    \\tau_{\\mathrm{sat}}(S) = \\frac{\\tau_0}{1 + \\max(S,0)/S_{\\mathrm{ref}}}\n    $$\n    凝结释放潜热，使空气升温，其速率为：\n    $$\n    \\frac{dT}{dt} = \\frac{L_v}{c_p} \\frac{dq_{\\mathrm{cond}}}{dt}\n    $$\n    其中 $c_p$ 是空气的定压比热容。\n\n-   **蒸发：** 如果空气未饱和（$q_v  q_{vs}$）且存在云水（$q_c > 0$），云水会蒸发以增加水汽。蒸发速率受未饱和度和可用云水的限制：\n    $$\n    \\frac{dq_{\\mathrm{evap}}}{dt} = \\min\\left(\\frac{q_{vs}(T,p) - q_v}{\\tau_{\\mathrm{evap}}}, \\frac{q_c}{\\Delta t}\\right)\n    $$\n    其中 $\\tau_{\\mathrm{evap}}$ 是一个恒定的蒸发时间尺度，而项 $q_c/\\Delta t$ 确保云水在单个时间步 $\\Delta t$ 内不会变为负值。蒸发吸收潜热，使空气冷却：\n    $$\n    \\frac{dT}{dt} = -\\frac{L_v}{c_p} \\frac{dq_{\\mathrm{evap}}}{dt}\n    $$\n\n### 2. 数值实现与 IAU 方案\n\n模型使用前向欧拉法在时间上推进，时间步长为 $\\Delta t=1 \\ \\mathrm{s}$，总时长为 $H=3600 \\ \\mathrm{s}$。在每个时间步 $t_i$，状态变量 $(T_i, q_{v,i}, q_{c,i})$ 被更新为 $(T_{i+1}, q_{v,i+1}, q_{c,i+1})$。\n\n**增量分析更新 (IAU)：** 分析增量 $\\Delta q_v$ 在一个 IAU 窗口 $W$ 内逐渐施加，引入一个恒定的强迫项 $F_{\\mathrm{IAU}} = \\Delta q_v / W$（对于 $t \\in [0, W)$）。在窗口内的每个时间步，水汽混合比首先由 IAU 强迫更新：\n$$\nq_{v}' = q_{v,i} + F_{\\mathrm{IAU}} \\cdot \\Delta t\n$$\n其中 $q_{v}'$ 是一个中间值。这个更新后的值随后用于该时间步的饱和度调整计算。\n\n两种 IAU 策略在窗口 $W$ 的选择上有所不同：\n1.  **固定窗口 IAU：** 无论大气状态如何，都使用一个恒定的窗口 $W_{\\mathrm{fixed}} = W_f = 1800 \\ \\mathrm{s}$。\n2.  **动态窗口 IAU：** 窗口 $W_{\\mathrm{dyn}}$ 根据初始过饱和度 $S_0$ 进行调整。其原理是将强迫时间尺度与模型的内在调整时间尺度 $\\tau_{\\mathrm{sat}}$ 对齐。\n    $$\n    W_{\\mathrm{dyn}} = \\begin{cases}\n    \\min\\left(W_f, \\kappa \\, \\tau_{\\mathrm{sat}}(S_0)\\right),  S_0 > 0 \\\\\n    W_f,  S_0 \\le 0\n    \\end{cases}\n    $$\n    这里，$\\kappa$ 是一个比例因子。如果初始状态是高度过饱和的，$\\tau_{\\mathrm{sat}}(S_0)$ 会很短，导致 IAU 窗口也较短。这会更迅速地施加增量，据推测可以减少伪模型调整。\n\n**离散化方程：** 从 $i$ 到 $i+1$ 的单个时间步的完整更新过程如下：\n1.  施加 IAU 强迫：如果 $t_i  W$，则 $q_{v}' = q_{v,i} + (\\Delta q_v/W) \\cdot \\Delta t$，否则 $q_{v}' = q_{v,i}$。\n2.  计算饱和特性：$q_{vs,i} = q_{vs}(T_i, p)$。\n3.  对 $(T_i, q_{v}', q_{c,i})$ 执行饱和度调整：\n    -   如果 $q_{v}' > q_{vs,i}$：\n        -   $\\Delta q_{\\mathrm{cond}} = \\frac{q_{v}' - q_{vs,i}}{\\tau_{\\mathrm{sat}}(S_i)} \\Delta t$\n        -   $q_{v,i+1} = q_{v}' - \\Delta q_{\\mathrm{cond}}$\n        -   $q_{c,i+1} = q_{c,i} + \\Delta q_{\\mathrm{cond}}$\n        -   $T_{i+1} = T_i + \\frac{L_v}{c_p} \\Delta q_{\\mathrm{cond}}$\n    -   如果 $q_{v}'  q_{vs,i}$ 且 $q_{c,i} > 0$：\n        -   $\\Delta q_{\\mathrm{evap}} = \\min\\left(\\frac{q_{vs,i} - q_{v}'}{\\tau_{\\mathrm{evap}}}, \\frac{q_{c,i}}{\\Delta t}\\right) \\Delta t$\n        -   $q_{v,i+1} = q_{v}' + \\Delta q_{\\mathrm{evap}}$\n        -   $q_{c,i+1} = q_{c,i} - \\Delta q_{\\mathrm{evap}}$\n        -   $T_{i+1} = T_i - \\frac{L_v}{c_p} \\Delta q_{\\mathrm{evap}}$\n    -   否则，状态不受饱和度调整影响：$(T_{i+1}, q_{v,i+1}, q_{c,i+1}) = (T_i, q_{v}', q_{c,i})$。\n\n### 3. 分析与最终计算\n\n“伪冷池强度” $C$ 是一个旨在衡量低于初始环境温度 $T_{\\mathrm{env}} = T(t=0)$ 的总累积冷却量的度量。它通过在模拟时域上对温度异常进行数值积分来计算：\n$$\nC = \\int_0^H \\max\\left(0, T_{\\mathrm{env}} - T(t)\\right) \\, dt \\approx \\sum_{i=1}^{H/\\Delta t} \\max(0, T_{\\mathrm{env}} - T_i) \\Delta t\n$$\n对于每个测试用例，我们使用固定窗口 IAU 计算 $C_{\\mathrm{fixed}}$，使用动态窗口 IAU 计算 $C_{\\mathrm{dyn}}$。最终结果是减少量 $R = C_{\\mathrm{fixed}} - C_{\\mathrm{dyn}}$，它量化了动态策略的有效性。$R$ 的正值表示动态窗口 IAU 成功地减少了伪冷却。对所有测试用例运行模拟，并报告所得的 $R$ 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Incremental Analysis Updating (IAU) problem for a single-column model.\n    \"\"\"\n    \n    # Physical and model constants\n    L_v = 2.5e6  # Latent heat of vaporization (J/kg)\n    R_v = 461.0  # Specific gas constant for water vapor (J/kg/K)\n    T_0 = 273.15 # Reference temperature (K)\n    e_0 = 611.2  # Saturation vapor pressure at T0 (Pa)\n    epsilon = 0.622 # Ratio of gas constants Rd/Rv\n    c_p = 1004.0 # Specific heat at constant pressure (J/kg/K)\n    \n    # Saturation adjustment parameters\n    tau_0 = 300.0       # Base condensation timescale (s)\n    S_ref = 0.2         # Reference supersaturation\n    tau_evap = 1200.0   # Evaporation timescale (s)\n\n    # IAU parameters\n    kappa = 4.0   # Dynamic window scaling factor\n    W_f = 1800.0  # Fixed IAU window (s)\n    \n    # Simulation parameters\n    dt = 1.0  # Time step (s)\n    H = 3600.0 # Simulation horizon (s)\n\n    def get_es(T):\n        \"\"\"Computes saturation vapor pressure using Clausius-Clapeyron relation.\"\"\"\n        return e_0 * np.exp((L_v / R_v) * (1.0/T_0 - 1.0/T))\n\n    def get_qvs(T, p):\n        \"\"\"Computes saturation mixing ratio.\"\"\"\n        es = get_es(T)\n        if p - es = 0:\n            return np.inf  # Avoid division by zero or negative pressure\n        return (epsilon * es) / (p - es)\n\n    def run_one_simulation(T_init, p, qv_init, qc_init, delta_qv, W_iau):\n        \"\"\"\n        Runs a single time-stepping simulation for a given IAU window.\n        \n        Returns:\n            float: The spurious cold pool strength metric C (K*s).\n        \"\"\"\n        T = T_init\n        qv = qv_init\n        qc = qc_init\n        T_env = T_init # Environmental reference temperature\n        \n        # Pre-calculate constant IAU forcing\n        F_iau = delta_qv / W_iau if W_iau > 0 else 0.0\n        \n        C = 0.0\n        num_steps = int(H / dt)\n        \n        for i in range(num_steps):\n            current_time = i * dt\n            \n            # Step 1: Apply IAU forcing\n            if current_time  W_iau:\n                qv += F_iau * dt\n            \n            # Step 2: Saturation adjustment\n            qvs = get_qvs(T, p)\n            \n            if qv > qvs:  # Supersaturated -> Condensation\n                S = qv / qvs - 1.0\n                tau_sat = tau_0 / (1.0 + max(S, 0) / S_ref)\n                dq_cond = ((qv - qvs) / tau_sat) * dt\n                \n                qv -= dq_cond\n                qc += dq_cond\n                T += (L_v / c_p) * dq_cond\n            elif qv  qvs and qc > 0:  # Subsaturated with cloud -> Evaporation\n                dq_evap_rate = (qvs - qv) / tau_evap\n                qc_avail_rate = qc / dt\n                \n                dq_evap = min(dq_evap_rate, qc_avail_rate) * dt\n                \n                qv += dq_evap\n                qc -= dq_evap\n                T -= (L_v / c_p) * dq_evap\n\n            # Step 3: Update cold pool metric C\n            C += max(0, T_env - T) * dt\n            \n        return C\n\n    test_cases = [\n        # (T [K], p [Pa], q_v [kg/kg], q_c [kg/kg], delta_qv [kg/kg])\n        (292.0, 90000.0, 0.0190, 0.0010, -1.0e-4),\n        (292.0, 90000.0, 0.0190, 0.0010, 1.0e-4),\n        (289.0, 95000.0, 0.0150, 0.0005, -2.0e-4),\n        (295.0, 95000.0, 0.0205, 0.0015, -2.5e-4),\n    ]\n\n    results = []\n    for T_init, p, qv_init, qc_init, delta_qv in test_cases:\n        # Run with fixed-window IAU\n        W_fixed = W_f\n        C_fixed = run_one_simulation(T_init, p, qv_init, qc_init, delta_qv, W_fixed)\n        \n        # Determine and run with dynamic-window IAU\n        qvs_init = get_qvs(T_init, p)\n        S0 = qv_init / qvs_init - 1.0\n        \n        if S0 > 0:\n            tau_sat0 = tau_0 / (1.0 + S0 / S_ref)\n            W_dyn = min(W_f, kappa * tau_sat0)\n        else:\n            W_dyn = W_f\n            \n        C_dyn = run_one_simulation(T_init, p, qv_init, qc_init, delta_qv, W_dyn)\n        \n        R = C_fixed - C_dyn\n        results.append(R)\n\n    # Print results in the specified format\n    print(f\"[{','.join(f'{r:.4f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}