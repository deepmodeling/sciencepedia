{
    "hands_on_practices": [
        {
            "introduction": "在数据同化中，新息向量（观测与预报之差）是一个至关重要的诊断工具。它的统计特性直接反映了关于预报误差和观测误差所做假设的有效性。本练习将引导您推导新息的理论均值和协方差，并利用它们构建一个卡方（$\\chi^2$）检验，为您提供一种评估卡尔曼滤波器统计一致性的强有力方法。",
            "id": "4057079",
            "problem": "考虑一个在数值天气预报（NWP）中使用卡尔曼滤波器（KF）或扩展卡尔曼滤波器（EKF）的数据同化循环，其中，一个预报状态 $x^{f} \\in \\mathbb{R}^{n}$ 通过观测算子 $\\mathcal{H}(\\cdot)$ 映射到观测空间。新息定义为 $d = y - \\mathcal{H}(x^{f})$，其中 $y \\in \\mathbb{R}^{m}$ 是观测向量。假设以下在地球物理数据同化中标准的基础建模假设：\n- 预报（背景）误差 $e^{f} = x^{t} - x^{f}$，其中 $x^{t}$ 是真实状态，是无偏的，其期望 $\\mathbb{E}[e^{f}] = 0$，协方差为 $\\mathcal{P}^{f}$，且服从高斯分布。\n- 观测误差 $e^{o} = y - \\mathcal{H}(x^{t})$ 是无偏的，其期望 $\\mathbb{E}[e^{o}] = 0$，协方差为 $R$，服从高斯分布，且与 $e^{f}$ 独立。\n- 对于 EKF，观测算子在 $x^{f}$ 处是可微的且被线性化，因此 $\\mathcal{H}(x^{t}) \\approx \\mathcal{H}(x^{f}) + H (x^{t} - x^{f})$，其中 $H$ 是在 $x^{f}$ 处求值的雅可比矩阵。\n\n在这些假设下，从第一性原理推导新息 $d$ 的期望值和协方差。然后，提出一个基于卡方分布的检验，以检测 $(\\mathcal{P}^{f}, R)$ 与观测到的新息统计量之间的不一致性。\n\n现在，将您的推导应用于以下科学上合理的配置，该配置涉及 $m = 2$ 个观测值（一个近地面温度和一个水平风分量）和 $n = 3$ 个预报状态变量：\n- 预报状态 $x^{f} = \\begin{pmatrix} 290 \\\\ 12 \\\\ 0.8 \\end{pmatrix}$。\n- 线性化观测算子 $H = \\begin{pmatrix} 1  0  0 \\\\ 0  0  1 \\end{pmatrix}$，因此 $H x^{f} = \\begin{pmatrix} 290 \\\\ 0.8 \\end{pmatrix}$。\n- 观测值 $y = \\begin{pmatrix} 289.5 \\\\ 1.1 \\end{pmatrix}$。\n- 预报误差协方差\n$$\n\\mathcal{P}^{f} = \\begin{pmatrix}\n0.25  0.05  0.03 \\\\\n0.05  1.00  0.02 \\\\\n0.03  0.02  0.16\n\\end{pmatrix}.\n$$\n- 观测误差协方差\n$$\nR = \\begin{pmatrix}\n0.09  0.012 \\\\\n0.012  0.04\n\\end{pmatrix}.\n$$\n\n使用您推导出的表达式，计算该循环中实现的新息的卡方检验统计量。您应该计算的检验统计量是在一致性零假设下，由新息及其协方差构成的二次型。将您的最终数值答案表示为单个实数。将您的答案四舍五入到四位有效数字。该检验统计量是无量纲的，因此最终答案中不需要物理单位。",
            "solution": "该问题要求在数据同化背景下推导新息向量的期望值和协方差，构建用于统计一致性的卡方检验，并将这些结果应用于一个具体的数值例子。该问题表述清晰，并在状态估计和数据同化的原理上有坚实的科学基础。\n\n首先，我们推导新息 $d$ 的统计特性。新息被定义为观测向量 $y \\in \\mathbb{R}^{m}$ 与投影到观测空间中的预报状态之差，即 $d = y - \\mathcal{H}(x^{f})$。\n\n观测向量 $y$ 通过观测误差 $e^o$ 与真实状态 $x^t$ 相关，即 $y = \\mathcal{H}(x^t) + e^o$。真实状态 $x^t$ 通过预报误差 $e^f$ 与预报状态 $x^f$ 相关，即 $x^t = x^f + e^f$。\n\n对于扩展卡尔曼滤波器（EKF），观测算子 $\\mathcal{H}$ 在预报状态 $x^f$ 附近进行线性化：\n$$\n\\mathcal{H}(x^t) = \\mathcal{H}(x^f + e^f) \\approx \\mathcal{H}(x^f) + H e^f\n$$\n其中 $H$ 是 $\\mathcal{H}$ 在 $x^f$ 处求值的雅可比矩阵。\n\n将这些关系代入新息 $d$ 的定义中：\n$$\nd = y - \\mathcal{H}(x^f) = (\\mathcal{H}(x^t) + e^o) - \\mathcal{H}(x^f)\n$$\n使用线性化，我们得到：\n$$\nd \\approx (\\mathcal{H}(x^f) + H e^f + e^o) - \\mathcal{H}(x^f) = H e^f + e^o\n$$\n这个表达式将新息与底层的模式误差和观测误差联系起来。\n\n现在，我们计算新息的期望值 $\\mathbb{E}[d]$。利用期望算子的线性性质：\n$$\n\\mathbb{E}[d] \\approx \\mathbb{E}[H e^f + e^o] = \\mathbb{E}[H e^f] + \\mathbb{E}[e^o] = H \\mathbb{E}[e^f] + \\mathbb{E}[e^o]\n$$\n问题陈述预报误差和观测误差都是无偏的，即 $\\mathbb{E}[e^f] = 0$ 和 $\\mathbb{E}[e^o] = 0$。因此，新息的期望值为：\n$$\n\\mathbb{E}[d] \\approx H(0) + 0 = 0\n$$\n在给定假设下，新息的期望值为零。\n\n接下来，我们推导新息的协方差，记为 $S$。协方差定义为 $S = \\text{Cov}(d) = \\mathbb{E}[(d - \\mathbb{E}[d])(d - \\mathbb{E}[d])^T]$。由于 $\\mathbb{E}[d] \\approx 0$，这可以简化为 $S \\approx \\mathbb{E}[d d^T]$。\n$$\nS \\approx \\mathbb{E}[(H e^f + e^o)(H e^f + e^o)^T]\n$$\n展开期望内的项：\n$$\nS \\approx \\mathbb{E}[ (H e^f + e^o) ((e^f)^T H^T + (e^o)^T) ] = \\mathbb{E}[ H e^f (e^f)^T H^T + H e^f (e^o)^T + e^o (e^f)^T H^T + e^o (e^o)^T ]\n$$\n根据期望的线性性质：\n$$\nS \\approx \\mathbb{E}[H e^f (e^f)^T H^T] + \\mathbb{E}[H e^f (e^o)^T] + \\mathbb{E}[e^o (e^f)^T H^T] + \\mathbb{E}[e^o (e^o)^T]\n$$\n我们可以将常数矩阵 $H$ 提取出来：\n$$\nS \\approx H \\mathbb{E}[e^f (e^f)^T] H^T + H \\mathbb{E}[e^f (e^o)^T] + \\mathbb{E}[e^o (e^f)^T] H^T + \\mathbb{E}[e^o (e^o)^T]\n$$\n问题给出了协方差矩阵 $\\mathcal{P}^f = \\mathbb{E}[e^f (e^f)^T]$ 和 $R = \\mathbb{E}[e^o (e^o)^T]$。它还指出预报误差和观测误差是独立的。这意味着它们的互协方差为零：$\\mathbb{E}[e^f (e^o)^T] = \\mathbb{E}[e^f]\\mathbb{E}[(e^o)^T] = 0 \\cdot 0^T = 0$。项 $\\mathbb{E}[e^o (e^f)^T]$ 是前者的转置，因此也是一个零矩阵。\n将这些代入 $S$ 的表达式中：\n$$\nS \\approx H \\mathcal{P}^f H^T + H(0) + (0)H^T + R = H \\mathcal{P}^f H^T + R\n$$\n这就是新息向量的理论协方差。\n\n为了提出一个一致性检验，我们利用 $e^f$ 和 $e^o$ 服从高斯分布这一事实。由于 $d \\approx H e^f + e^o$ 是高斯随机向量的线性组合， $d$ 本身也近似服从均值为 $0$、协方差为 $S$ 的高斯分布。即，$d \\sim \\mathcal{N}(0, S)$。对于一个服从多元正态分布 $\\mathcal{N}(0, \\Sigma)$ 的随机向量 $z \\in \\mathbb{R}^m$，其二次型 $z^T \\Sigma^{-1} z$ 服从自由度为 $m$ 的卡方分布，记为 $\\chi^2_m$。\n因此，我们可以构建检验统计量 $\\chi^2 = d^T S^{-1} d$。在指定的协方差 $\\mathcal{P}^f$ 和 $R$ 是正确的零假设下，该统计量应服从 $\\chi^2_m$ 分布，其中 $m$ 是观测空间的维数。一个观测到的 $\\chi^2$ 值如果大得不太可能（例如，位于 $\\chi^2_m$ 分布的上尾部），则表明关于 $\\mathcal{P}^f$ 和 $R$ 的基本假设与观测到的新息不一致。\n\n现在，我们将这些结果应用于给定的数值案例。\n观测向量为 $y = \\begin{pmatrix} 289.5 \\\\ 1.1 \\end{pmatrix}$，映射后的预报为 $H x^f = \\begin{pmatrix} 290 \\\\ 0.8 \\end{pmatrix}$。\n实现的新息 $d$ 是：\n$$\nd = y - Hx^f = \\begin{pmatrix} 289.5 - 290 \\\\ 1.1 - 0.8 \\end{pmatrix} = \\begin{pmatrix} -0.5 \\\\ 0.3 \\end{pmatrix}\n$$\n接下来，我们计算理论新息协方差 $S = H \\mathcal{P}^f H^T + R$。\n给定 $H = \\begin{pmatrix} 1  0  0 \\\\ 0  0  1 \\end{pmatrix}$ 和 $\\mathcal{P}^{f} = \\begin{pmatrix} 0.25  0.05  0.03 \\\\ 0.05  1.00  0.02 \\\\ 0.03  0.02  0.16 \\end{pmatrix}$。\n$$\nH \\mathcal{P}^f = \\begin{pmatrix} 1  0  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 0.25  0.05  0.03 \\\\ 0.05  1.00  0.02 \\\\ 0.03  0.02  0.16 \\end{pmatrix} = \\begin{pmatrix} 0.25  0.05  0.03 \\\\ 0.03  0.02  0.16 \\end{pmatrix}\n$$\n$$\nH \\mathcal{P}^f H^T = \\begin{pmatrix} 0.25  0.05  0.03 \\\\ 0.03  0.02  0.16 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 0.25  0.03 \\\\ 0.03  0.16 \\end{pmatrix}\n$$\n现在我们加上观测误差协方差 $R = \\begin{pmatrix} 0.09  0.012 \\\\ 0.012  0.04 \\end{pmatrix}$：\n$$\nS = H \\mathcal{P}^f H^T + R = \\begin{pmatrix} 0.25  0.03 \\\\ 0.03  0.16 \\end{pmatrix} + \\begin{pmatrix} 0.09  0.012 \\\\ 0.012  0.04 \\end{pmatrix} = \\begin{pmatrix} 0.34  0.042 \\\\ 0.042  0.20 \\end{pmatrix}\n$$\n为了计算 $\\chi^2$ 统计量，我们需要 $S$ 的逆矩阵。对于一个 $2 \\times 2$ 矩阵 $\\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$，其逆矩阵为 $\\frac{1}{ad-bc} \\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}$。\n$S$ 的行列式是：\n$$\n\\det(S) = (0.34)(0.20) - (0.042)^2 = 0.068 - 0.001764 = 0.066236\n$$\n逆矩阵 $S^{-1}$ 是：\n$$\nS^{-1} = \\frac{1}{0.066236} \\begin{pmatrix} 0.20  -0.042 \\\\ -0.042  0.34 \\end{pmatrix}\n$$\n最后，我们计算检验统计量 $\\chi^2 = d^T S^{-1} d$：\n$$\n\\chi^2 = \\begin{pmatrix} -0.5  0.3 \\end{pmatrix} \\frac{1}{0.066236} \\begin{pmatrix} 0.20  -0.042 \\\\ -0.042  0.34 \\end{pmatrix} \\begin{pmatrix} -0.5 \\\\ 0.3 \\end{pmatrix}\n$$\n分子中的二次型是：\n$$\n\\begin{pmatrix} -0.5  0.3 \\end{pmatrix} \\begin{pmatrix} 0.20  -0.042 \\\\ -0.042  0.34 \\end{pmatrix} \\begin{pmatrix} -0.5 \\\\ 0.3 \\end{pmatrix} = \\begin{pmatrix} -0.5  0.3 \\end{pmatrix} \\begin{pmatrix} (0.20)(-0.5) + (-0.042)(0.3) \\\\ (-0.042)(-0.5) + (0.34)(0.3) \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} -0.5  0.3 \\end{pmatrix} \\begin{pmatrix} -0.1 - 0.0126 \\\\ 0.021 + 0.102 \\end{pmatrix} = \\begin{pmatrix} -0.5  0.3 \\end{pmatrix} \\begin{pmatrix} -0.1126 \\\\ 0.123 \\end{pmatrix}\n$$\n$$\n= (-0.5)(-0.1126) + (0.3)(0.123) = 0.0563 + 0.0369 = 0.0932\n$$\n除以行列式得到 $\\chi^2$ 值：\n$$\n\\chi^2 = \\frac{0.0932}{0.066236} \\approx 1.4069925...\n$$\n四舍五入到四位有效数字，检验统计量为 $1.407$。该值将与 $\\chi^2_2$ 分布进行比较以评估一致性。",
            "answer": "$$\\boxed{1.407}$$"
        },
        {
            "introduction": "卡尔曼滤波器的性能对其误差协方差矩阵的设定高度敏感，特别是模型误差协方差 $Q_k$。本练习深入探讨滤波器调优的理论层面，要求您推导分析不确定性对 $Q_k$ 变化的敏感度。通过掌握这个矩阵微积分练习，您将更深刻地理解滤波器参数如何控制其行为，这是向系统化滤波器优化迈出的关键一步。",
            "id": "4057007",
            "problem": "考虑一个与数值天气预报（NWP）相关的线性高斯设定下的单次数据同化循环。设状态维数为 $n$，观测维数为 $m$。单个时间步长上的线性化模型传播算子是矩阵 $M \\in \\mathbb{R}^{n \\times n}$，先验分析误差协方差是 $P_{k-1}^{a} \\in \\mathbb{R}^{n \\times n}$，模型误差协方差（也称为过程噪声协方差）是 $Q_{k} \\in \\mathbb{R}^{n \\times n}$，线性观测算子是 $H \\in \\mathbb{R}^{m \\times n}$，观测误差协方差是 $R \\in \\mathbb{R}^{m \\times m}$。假设 $P_{k-1}^{a}$、$Q_{k}$ 和 $R$ 是对称正定的，并且 $M$ 和 $H$ 在卡尔曼滤波器（KF）假设的通常意义下是满秩的。\n\n在时间 $k$ 的预报误差协方差为 $P_{k}^{f} = M P_{k-1}^{a} M^{\\top} + Q_{k}$。对于线性高斯模型，在时间 $k$ 的分析误差协方差由标准信息形式表达式给出\n$$\nP_{k}^{a} = \\big( (P_{k}^{f})^{-1} + H^{\\top} R^{-1} H \\big)^{-1}.\n$$\n考虑标量目标函数 $J(Q_{k}) = \\mathrm{tr}(P_{k}^{a})$，它被解释为总分析不确定性的度量。将 $M$、$P_{k-1}^{a}$、$H$ 和 $R$ 视为固定的，并通过 $P_{k}^{f}$ 将 $J$ 仅看作是 $Q_{k}$ 中元素的函数。\n\n使用矩阵微积分、矩阵逆的导数恒等式以及迹的循环性质，从第一性原理出发，推导在弗罗贝尼乌斯内积下 $J$ 关于 $Q_{k}$ 的偏导数矩阵的闭式解析表达式，即梯度矩阵\n$$\n\\nabla_{Q_{k}} \\, \\mathrm{tr}(P_{k}^{a}) \\in \\mathbb{R}^{n \\times n}.\n$$\n的表达式。请仅用 $P_{k}^{f}$ 和 $P_{k}^{a}$ 表示您的最终结果。您的最终答案必须是单个闭式解析表达式。不需要进行数值评估，也无需四舍五入。陈述最终表达式时无需单位。",
            "solution": "所述问题是在应用于状态估计和数据同化的矩阵微积分领域中一个有效且适定的问题。所有术语都有正式定义，背景科学合理，目标明确。因此，我们可以进行推导。\n\n目标是计算标量函数 $J(Q_k) = \\mathrm{tr}(P_{k}^{a})$ 相对于矩阵 $Q_k$ 的梯度。这些量之间的关系通过给定的方程建立：\n$$\nP_{k}^{f} = M P_{k-1}^{a} M^{\\top} + Q_{k}\n$$\n$$\nP_{k}^{a} = \\big( (P_{k}^{f})^{-1} + H^{\\top} R^{-1} H \\big)^{-1}\n$$\n梯度矩阵，记为 $\\nabla_{Q_{k}} J$，是关于弗罗贝尼乌斯内积定义的。如果 $J$ 是矩阵变量 $X$ 的标量函数，其微分 $dJ$ 可以用变量的微分 $dX$ 表示为：\n$$\ndJ = \\mathrm{tr}\\big( (\\nabla_{X} J)^{\\top} dX \\big)\n$$\n我们的目标是找到微分 $dJ$ 的一个表达式，其形式为 $\\mathrm{tr}(G^{\\top} dQ_k)$（对于某个矩阵 $G$），从中我们可以确定 $G = \\nabla_{Q_{k}} J$。我们将通过应用微分的链式法则来实现这一目标。\n\n我们首先计算目标函数 $J = \\mathrm{tr}(P_{k}^{a})$ 的微分。利用迹算子和微分算子的线性性质，我们有：\n$$\ndJ = d\\big(\\mathrm{tr}(P_{k}^{a})\\big) = \\mathrm{tr}\\big(d(P_{k}^{a})\\big)\n$$\n接下来，我们求 $P_{k}^{a}$ 的微分。令矩阵 $Y$ 定义为 $Y = (P_{k}^{f})^{-1} + H^{\\top} R^{-1} H$。则 $P_{k}^{a} = Y^{-1}$。我们使用矩阵逆的微分的标准恒等式，$d(Y^{-1}) = -Y^{-1} (dY) Y^{-1}$。\n$$\nd(P_{k}^{a}) = -Y^{-1} (dY) Y^{-1} = -P_{k}^{a} (dY) P_{k}^{a}\n$$\n现在我们必须求微分 $dY$。矩阵 $Y$ 是两项之和，$Y = (P_{k}^{f})^{-1} + H^{\\top} R^{-1} H$。矩阵 $H$ 和 $R$ 是固定的，因此第二项 $H^{\\top} R^{-1} H$ 是一个常数矩阵。常数矩阵的微分是零矩阵。因此，\n$$\ndY = d\\big((P_{k}^{f})^{-1} + H^{\\top} R^{-1} H\\big) = d\\big((P_{k}^{f})^{-1}\\big) + d\\big(H^{\\top} R^{-1} H\\big) = d\\big((P_{k}^{f})^{-1}\\big)\n$$\n我们再次应用逆的微分法则：\n$$\ndY = -(P_{k}^{f})^{-1} \\big(d(P_{k}^{f})\\big) (P_{k}^{f})^{-1}\n$$\n将 $dY$ 的这个表达式代入 $d(P_{k}^{a})$ 的方程中：\n$$\nd(P_{k}^{a}) = -P_{k}^{a} \\Big( -(P_{k}^{f})^{-1} \\big(d(P_{k}^{f})\\big) (P_{k}^{f})^{-1} \\Big) P_{k}^{a} = P_{k}^{a} (P_{k}^{f})^{-1} \\big(d(P_{k}^{f})\\big) (P_{k}^{f})^{-1} P_{k}^{a}\n$$\n下一步是求 $P_{k}^{f}$ 的微分。预报误差协方差由 $P_{k}^{f} = M P_{k-1}^{a} M^{\\top} + Q_{k}$ 给出。矩阵 $M$ 和 $P_{k-1}^{a}$ 是固定的，因此项 $M P_{k-1}^{a} M^{\\top}$ 是常数。$P_k^f$ 的微分因此是：\n$$\nd(P_{k}^{f}) = d\\big(M P_{k-1}^{a} M^{\\top} + Q_{k}\\big) = d\\big(M P_{k-1}^{a} M^{\\top}\\big) + d(Q_{k}) = 0 + d(Q_{k}) = dQ_{k}\n$$\n我们现在将 $d(P_{k}^{f}) = dQ_k$ 代回到 $d(P_{k}^{a})$ 的表达式中：\n$$\nd(P_{k}^{a}) = P_{k}^{a} (P_{k}^{f})^{-1} (dQ_{k}) (P_{k}^{f})^{-1} P_{k}^{a}\n$$\n最后，我们将其代入 $dJ$ 的表达式中：\n$$\ndJ = \\mathrm{tr}\\big(d(P_{k}^{a})\\big) = \\mathrm{tr}\\Big( P_{k}^{a} (P_{k}^{f})^{-1} (dQ_{k}) (P_{k}^{f})^{-1} P_{k}^{a} \\Big)\n$$\n为了将其与典范形式 $dJ = \\mathrm{tr}(G^{\\top} dQ_k)$ 相匹配，我们使用迹算子的循环性质，$\\mathrm{tr}(ABCD) = \\mathrm{tr}(DABC)$。令 $A = P_{k}^{a}$，$B = (P_{k}^{f})^{-1}$，$C = dQ_{k}$，以及 $D = (P_{k}^{f})^{-1} P_{k}^{a}$。应用循环性质得到：\n$$\ndJ = \\mathrm{tr}\\Big( \\big((P_{k}^{f})^{-1} P_{k}^{a}\\big) \\big(P_{k}^{a}\\big) \\big((P_{k}^{f})^{-1}\\big) (dQ_{k}) \\Big)\n$$\n$$\ndJ = \\mathrm{tr}\\Big( \\big( (P_{k}^{f})^{-1} (P_{k}^{a})^{2} (P_{k}^{f})^{-1} \\big) dQ_{k} \\Big)\n$$\n将此与定义 $dJ = \\mathrm{tr}\\big( (\\nabla_{Q_{k}} J)^{\\top} dQ_{k} \\big)$进行比较，我们可以识别出迹内部左乘 $dQ_k$ 的项：\n$$\n(\\nabla_{Q_{k}} J)^{\\top} = (P_{k}^{f})^{-1} (P_{k}^{a})^{2} (P_{k}^{f})^{-1}\n$$\n为了求梯度 $\\nabla_{Q_{k}} J$，我们对两边取转置：\n$$\n\\nabla_{Q_{k}} J = \\Big( (P_{k}^{f})^{-1} (P_{k}^{a})^{2} (P_{k}^{f})^{-1} \\Big)^{\\top}\n$$\n根据定义，协方差矩阵 $P_{k}^{a}$ 和 $P_{k}^{f}$ 是对称的。对称矩阵的逆也是对称的，所以 $(P_{k}^{f})^{-1}$ 是对称的。对称矩阵的平方也是对称的，所以 $(P_{k}^{a})^{2}$ 是对称的。该表达式的形式为 $(ABA)^{\\top}$，其中 $A = (P_{k}^{f})^{-1}$ 和 $B = (P_{k}^{a})^{2}$ 都是对称矩阵。使用性质 $(XYX)^{\\top} = X^{\\top}Y^{\\top}X^{\\top}$，我们发现：\n$$\n\\nabla_{Q_{k}} J = \\big((P_{k}^{f})^{-1}\\big)^{\\top} \\big((P_{k}^{a})^{2}\\big)^{\\top} \\big((P_{k}^{f})^{-1}\\big)^{\\top} = (P_{k}^{f})^{-1} (P_{k}^{a})^{2} (P_{k}^{f})^{-1}\n$$\n所得表达式是对称的，这与标量函数关于对称矩阵变量的梯度应该是一个对称矩阵的事实相一致。该表达式仅用 $P_{k}^{f}$ 和 $P_{k}^{a}$ 表示，符合要求。",
            "answer": "$$\\boxed{(P_{k}^{f})^{-1} (P_{k}^{a})^{2} (P_{k}^{f})^{-1}}$$"
        },
        {
            "introduction": "扩展卡尔曼滤波器（EKF）通过线性化，将卡尔曼滤波的强大功能扩展到非线性系统，例如天气和气候模型。这种线性化处理的准确性至关重要。本动手编码练习要求您为一个简化的正压涡度模型（地球物理流体动力学中的一个经典模型）实现线性化，并将您的解析雅可比矩阵与数值近似进行验证——这是任何开发或使用 EKF 的实践者都应具备的一项基本技能。",
            "id": "4057052",
            "problem": "考虑一个在周期性方形域上的简化的、无量纲的正压涡度模型。设状态向量为离散时间索引 $k$ 处的离散相对涡度场 $\\boldsymbol{\\zeta}_k \\in \\mathbb{R}^{N}$，其中 $N = n_x n_y$，$n_x$ 是 $x$ 方向的网格点数，$n_y$ 是 $y$ 方向的网格点数。在β平面上，无行星涡度梯度、无摩擦或强迫的连续正压涡度方程简化为\n$$\n\\frac{\\partial \\zeta}{\\partial t} = - J(\\psi, \\zeta),\n$$\n其中 $\\zeta = \\nabla^2 \\psi$，$\\psi$ 是流函数，而 $J(\\psi, \\zeta) = \\frac{\\partial \\psi}{\\partial x} \\frac{\\partial \\zeta}{\\partial y} - \\frac{\\partial \\psi}{\\partial y} \\frac{\\partial \\zeta}{\\partial x}$ 是雅可比行列式（平流非线性项）。在周期性边界条件和均匀网格下，定义离散中心有限差分算子 $D_x$ 和 $D_y$ 分别近似 $\\partial/\\partial x$ 和 $\\partial/\\partial y$，以及一个离散逆拉普拉斯算子 $P$，使得 $\\boldsymbol{\\psi} = P \\boldsymbol{\\zeta}$ 是离散泊松方程 $\\nabla^2 \\psi = \\zeta$ 的解，其中零均值约束在谱空间中强制执行。设离散速度分量为\n$$\n\\boldsymbol{u} = - D_y \\boldsymbol{\\psi}, \\quad \\boldsymbol{v} = D_x \\boldsymbol{\\psi},\n$$\n离散涡度空间导数为\n$$\n\\boldsymbol{\\zeta}_x = D_x \\boldsymbol{\\zeta}, \\quad \\boldsymbol{\\zeta}_y = D_y \\boldsymbol{\\zeta}.\n$$\n则离散的右端项为\n$$\n\\mathbf{F}(\\boldsymbol{\\zeta}) = \\boldsymbol{u} \\circ \\boldsymbol{\\zeta}_x + \\boldsymbol{v} \\circ \\boldsymbol{\\zeta}_y,\n$$\n其中 $\\circ$ 表示逐元素乘法。考虑单个前向欧拉时间步长，\n$$\n\\boldsymbol{\\zeta}_{k+1} = \\boldsymbol{\\zeta}_k + \\Delta t \\, \\mathbf{F}(\\boldsymbol{\\zeta}_k),\n$$\n其用于扩展卡尔曼滤波器（EKF）的状态转移雅可比矩阵为\n$$\nA_k = I + \\Delta t \\, J_{\\mathbf{F}}(\\boldsymbol{\\zeta}_k),\n$$\n其中 $I$ 是单位矩阵，$J_{\\mathbf{F}}(\\boldsymbol{\\zeta}_k)$ 是 $\\mathbf{F}$ 在 $\\boldsymbol{\\zeta}_k$ 处求值的雅可比矩阵。\n\n您的任务是：\n- 将 $D_x$ 和 $D_y$ 构建为中心有限差分矩阵，在长度为 $L_x$（$x$方向）和 $L_y$（$y$方向）的域上使用周期性边界条件和均匀网格。使用间距 $d_x = L_x / n_x$ 和 $d_y = L_y / n_y$。\n- 使用离散傅里叶变换在谱空间中实现 $P$，使得对于非零波数 $\\widehat{\\psi}(\\boldsymbol{k}) = - \\widehat{\\zeta}(\\boldsymbol{k}) / \\|\\boldsymbol{k}\\|^2$ 且 $\\widehat{\\psi}(\\boldsymbol{0}) = 0$，其中 $\\boldsymbol{k}$ 汇集了 $x$ 和 $y$ 方向的波数。\n- 推导并实现解析雅可比矩阵 $J_{\\mathbf{F}}(\\boldsymbol{\\zeta})$，作为一个作用于扰动 $\\delta \\boldsymbol{\\zeta}$ 的线性算子，\n$$\n\\delta \\mathbf{F} = \\left[ \\operatorname{diag}(\\boldsymbol{\\zeta}_x) \\left( - D_y P \\right) + \\operatorname{diag}(\\boldsymbol{u}) D_x + \\operatorname{diag}(\\boldsymbol{\\zeta}_y) \\left( D_x P \\right) + \\operatorname{diag}(\\boldsymbol{v}) D_y \\right] \\delta \\boldsymbol{\\zeta},\n$$\n因此\n$$\nJ_{\\mathbf{F}}(\\boldsymbol{\\zeta}) = \\operatorname{diag}(\\boldsymbol{\\zeta}_x) \\left( - D_y P \\right) + \\operatorname{diag}(\\boldsymbol{u}) D_x + \\operatorname{diag}(\\boldsymbol{\\zeta}_y) \\left( D_x P \\right) + \\operatorname{diag}(\\boldsymbol{v}) D_y.\n$$\n- 通过 $A_k^{(\\text{ana})} = I + \\Delta t \\, J_{\\mathbf{F}}(\\boldsymbol{\\zeta}_k)$ 解析地计算 $A_k$。\n- 通过有限差分法数值计算雅可比矩阵，从而计算 $A_k$，使用大小为 $\\varepsilon$ 的对称扰动作用于 $\\boldsymbol{\\zeta}_k$ 的每个分量，即\n$$\n\\left[J_{\\mathbf{F}}(\\boldsymbol{\\zeta}_k)\\right]_{:,i} \\approx \\frac{\\mathbf{F}(\\boldsymbol{\\zeta}_k + \\varepsilon \\mathbf{e}_i) - \\mathbf{F}(\\boldsymbol{\\zeta}_k - \\varepsilon \\mathbf{e}_i)}{2 \\varepsilon},\n$$\n然后 $A_k^{(\\text{num})} = I + \\Delta t \\, J_{\\mathbf{F}}^{(\\text{num})}(\\boldsymbol{\\zeta}_k)$。\n\n通过计算两者之差的弗罗贝尼乌斯范数来比较 $A_k^{(\\text{ana})}$ 和 $A_k^{(\\text{num})}$，\n$$\n\\| A_k^{(\\text{num})} - A_k^{(\\text{ana})} \\|_F.\n$$\n\n测试套件：\n- 案例1：$n_x = 4$, $n_y = 4$, $L_x = 2\\pi$, $L_y = 2\\pi$, $\\Delta t = 0.01$, $\\boldsymbol{\\zeta}_k$ 是零场，$\\varepsilon = 10^{-6}$。\n- 案例2：$n_x = 4$, $n_y = 4$, $L_x = 2\\pi$, $L_y = 2\\pi$, $\\Delta t = 0.01$, $\\boldsymbol{\\zeta}_k$ 是从固定种子生成的零均值随机场，振幅缩放至 $0.1$，$\\varepsilon = 10^{-5}$。\n- 案例3：$n_x = 5$, $n_y = 5$, $L_x = 2\\pi$, $L_y = 2\\pi$, $\\Delta t = 0.05$, $\\boldsymbol{\\zeta}_k(i,j) = \\sin(k_x x_j) \\sin(k_y y_i)$，其中 $k_x = 1$, $k_y = 2$，振幅为 $1.0$，$\\varepsilon = 10^{-6}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，每个浮点数四舍五入到 $8$ 位小数，并按测试用例的顺序排列：$[\\|A_1^{(\\text{num})} - A_1^{(\\text{ana})}\\|_F,\\|A_2^{(\\text{num})} - A_2^{(\\text{ana})}\\|_F,\\|A_3^{(\\text{num})} - A_3^{(\\text{ana})}\\|_F]$。",
            "solution": "用户提供了一个问题，要求将一个离散动力系统的解析雅可比矩阵与数值计算的雅可比矩阵进行验证。该系统模拟了周期性域上的正压涡度方程。任务涉及构建几个离散算子，实现系统动力学，然后计算并比较雅可比矩阵。\n\n### 步骤1：提取已知信息\n\n-   **状态向量**：在时间 $k$ 的离散相对涡度 $\\boldsymbol{\\zeta}_k \\in \\mathbb{R}^{N}$，其中 $N = n_x n_y$。\n-   **控制方程（连续）**：$\\frac{\\partial \\zeta}{\\partial t} = - J(\\psi, \\zeta)$，其中 $\\zeta = \\nabla^2 \\psi$ 且 $J(\\psi, \\zeta) = \\frac{\\partial \\psi}{\\partial x} \\frac{\\partial \\zeta}{\\partial y} - \\frac{\\partial \\psi}{\\partial y} \\frac{\\partial \\zeta}{\\partial x}$。\n-   **域**：尺寸为 $L_x \\times L_y$ 的周期性方形（或矩形）域。\n-   **网格**：具有 $n_x \\times n_y$ 个点的均匀网格。间距为 $d_x = L_x / n_x$ 和 $d_y = L_y / n_y$。\n-   **离散算子**：\n    -   $D_x, D_y$：用于 $\\partial/\\partial x, \\partial/\\partial y$ 的中心有限差分矩阵，具有周期性边界。\n    -   $P$：谱逆拉普拉斯算子，$\\boldsymbol{\\psi} = P \\boldsymbol{\\zeta}$，求解 $\\nabla^2 \\psi = \\zeta$。在傅里叶空间中，对于 $\\boldsymbol{k} \\neq \\boldsymbol{0}$，$\\widehat{\\psi}(\\boldsymbol{k}) = - \\widehat{\\zeta}(\\boldsymbol{k}) / \\|\\boldsymbol{k}\\|^2$ 且 $\\widehat{\\psi}(\\boldsymbol{0}) = 0$。\n-   **离散速度和涡度梯度**：\n    -   $\\boldsymbol{u} = - D_y \\boldsymbol{\\psi}$, $\\boldsymbol{v} = D_x \\boldsymbol{\\psi}$。\n    -   $\\boldsymbol{\\zeta}_x = D_x \\boldsymbol{\\zeta}$, $\\boldsymbol{\\zeta}_y = D_y \\boldsymbol{\\zeta}$。\n-   **离散动力学函数**：$\\mathbf{F}(\\boldsymbol{\\zeta}) = \\boldsymbol{u} \\circ \\boldsymbol{\\zeta}_x + \\boldsymbol{v} \\circ \\boldsymbol{\\zeta}_y$，其中 $\\circ$ 是逐元素乘法。\n-   **时间步进方案**：前向欧拉法，$\\boldsymbol{\\zeta}_{k+1} = \\boldsymbol{\\zeta}_k + \\Delta t \\, \\mathbf{F}(\\boldsymbol{\\zeta}_k)$。\n-   **状态转移雅可比矩阵**：$A_k = I + \\Delta t \\, J_{\\mathbf{F}}(\\boldsymbol{\\zeta}_k)$。\n-   **F的解析雅可比矩阵**：$J_{\\mathbf{F}}(\\boldsymbol{\\zeta}) = \\operatorname{diag}(\\boldsymbol{\\zeta}_x) \\left( - D_y P \\right) + \\operatorname{diag}(\\boldsymbol{u}) D_x + \\operatorname{diag}(\\boldsymbol{\\zeta}_y) \\left( D_x P \\right) + \\operatorname{diag}(\\boldsymbol{v}) D_y$。\n-   **F的数值雅可比矩阵**：第 $i$ 列由 $\\frac{\\mathbf{F}(\\boldsymbol{\\zeta}_k + \\varepsilon \\mathbf{e}_i) - \\mathbf{F}(\\boldsymbol{\\zeta}_k - \\varepsilon \\mathbf{e}_i)}{2 \\varepsilon}$ 给出。\n-   **比较度量**：差的弗罗贝尼乌斯范数，$\\| A_k^{(\\text{num})} - A_k^{(\\text{ana})} \\|_F$。\n-   **测试用例**：\n    1.  $n_x = 4, n_y = 4, L_x = 2\\pi, L_y = 2\\pi, \\Delta t = 0.01, \\boldsymbol{\\zeta}_k = \\mathbf{0}, \\varepsilon = 10^{-6}$。\n    2.  $n_x = 4, n_y = 4, L_x = 2\\pi, L_y = 2\\pi, \\Delta t = 0.01$，$\\boldsymbol{\\zeta}_k$ 是一个均值为零、振幅为 $0.1$ 的随机场（来自固定种子），$\\varepsilon = 10^{-5}$。\n    3.  $n_x = 5, n_y = 5, L_x = 2\\pi, L_y = 2\\pi, \\Delta t = 0.05, \\boldsymbol{\\zeta}_k(i,j) = \\sin(k_x x_j) \\sin(k_y y_i)$，其中 $k_x = 1, k_y = 2$，振幅为 $1.0$，$\\varepsilon = 10^{-6}$。\n\n### 步骤2：使用提取的已知信息进行验证\n\n-   **科学依据**：该问题设置在地球物理流体动力学和数据同化（EKF）的背景下，这些是成熟的科学领域。该模型是浅水方程的标准简化。平流项 $\\mathbf{F}$ 的离散形式与标准正压涡度方程 ($u\\zeta_x - v\\zeta_y$) 存在符号差异，因为它被给出为 $u\\zeta_x + v\\zeta_y$。然而，这个问题是自洽的：它定义了一个函数 $\\mathbf{F}$ 并要求其雅可比矩阵。该任务是一个数学和数值分析练习，而不是对物理保真度的测试。该设置在内部是一致的且在数学上是严谨的。\n-   **适定性**：任务是计算一个标量值（矩阵差的弗罗贝尼乌斯范数）。所有必需的函数、参数和方法都已明确定义。对于每个测试用例，存在一个唯一的、稳定的、有意义的解。\n-   **客观性**：问题使用精确的数学语言和定量数据进行说明。没有主观或含糊的陈述。\n\n该问题没有无效性缺陷。它在数值方法的背景下具有科学依据，是适定的和客观的。\n\n### 步骤3：结论与行动\n\n问题陈述是**有效的**。将提供一个解决方案。\n\n### 基于原则的解决方案设计\n\n问题的核心是实现几个线性算子和一个非线性函数，然后计算和比较该函数雅可比矩阵的两种不同表示。解决方案将系统地构建每个组件。\n\n1.  **离散化与索引**：我们将二维涡度场 $\\zeta(y,x)$ 表示为一个形状为 $(n_y, n_x)$ 的二维 `numpy` 数组。第一个索引对应于 $y$ 方向（行），第二个索引对应于 $x$ 方向（列）。当需要一维状态向量 $\\boldsymbol{\\zeta}$ 时，这个二维数组将以行主序（'C' order）被展平。所有线性算子（$D_x, D_y, P$）都将构建为与此展平方案一致的 $N \\times N$ 稠密矩阵，其中 $N=n_x n_y$。\n\n2.  **有限差分算子（$D_x, D_y$）**：这些矩阵表示周期性网格上的中心差分。对于一个 $N$ 点网格，矩阵的第 $k$ 行将有对应于第 $k$ 个网格点邻居的非零项。对于我们展平为一维的二维网格，点 $(i,j)$（其展平索引为 $k=i \\cdot n_x + j$）的邻居对于 $D_x$ 是 $(i, j \\pm 1)$，对于 $D_y$ 是 $(i \\pm 1, j)$。周期性边界条件通过对索引使用模运算来处理。\n\n3.  **谱逆拉普拉斯算子（$P$）**：该算子最自然地实现为一个将其输入向量转换到傅里叶空间的函数。\n    -   输入向量 $\\boldsymbol{\\zeta}$ 被重塑为二维场。\n    -   应用二维快速傅里叶变换（FFT）得到 $\\widehat{\\boldsymbol{\\zeta}}$。\n    -   构建一个波数平方的网格，$\\|\\boldsymbol{k}\\|^2 = k_x^2 + k_y^2$。\n    -   通过将 $\\widehat{\\boldsymbol{\\zeta}}$ 除以 $-\\|\\boldsymbol{k}\\|^2$（对于所有非零波数）来计算 $\\widehat{\\boldsymbol{\\psi}}$。$\\widehat{\\boldsymbol{\\psi}}$ 的零波数分量被设置为零，从而对流函数强制施加零均值。\n    -   逆二维FFT产生二维流函数场 $\\boldsymbol{\\psi}$，然后将其展平。\n    -   为了获得矩阵形式 $P_{\\text{mat}}$，将此函数应用于每个标准基向量 $\\mathbf{e}_i$，结果构成 $P_{\\text{mat}}$ 的第 $i$ 列。\n\n4.  **非线性动力学函数（$\\mathbf{F}$）**：此函数接受 $\\boldsymbol{\\zeta}$ 并计算 $\\mathbf{F}(\\boldsymbol{\\zeta}) = (\\boldsymbol{-D_y P \\zeta}) \\circ (\\boldsymbol{D_x \\zeta}) + (\\boldsymbol{D_x P \\zeta}) \\circ (\\boldsymbol{D_y \\zeta})$。这涉及将预先计算的算子矩阵应用于 $\\boldsymbol{\\zeta}$ 并执行逐元素的向量乘积。\n\n5.  **解析雅可比矩阵（$J_{\\mathbf{F}}^{(\\text{ana})}$）**：该矩阵根据问题中提供的公式构建。这需要状态相关的向量 $\\boldsymbol{u}, \\boldsymbol{v}, \\boldsymbol{\\zeta}_x, \\boldsymbol{\\zeta}_y$，这些向量在给定的状态 $\\boldsymbol{\\zeta}_k$ 下计算。然后将这些向量形成为对角矩阵，并与适当的算子矩阵（$D_x, D_y, P_{\\text{mat}}$ 及其乘积）相乘。\n\n6.  **数值雅可比矩阵（$J_{\\mathbf{F}}^{(\\text{num})}$）**：使用中心有限差分公式逐列计算。对于每一列 $i$，函数 $\\mathbf{F}$ 在两个扰动状态 $\\boldsymbol{\\zeta}_k \\pm \\varepsilon \\mathbf{e}_i$ 下求值，并对差值进行缩放。这是数值微分定义的直接实现。\n\n7.  **比较**：最后，为解析和数值雅可比矩阵形成状态转移矩阵 $A_k = I + \\Delta t J_{\\mathbf{F}}$。计算它们差的弗罗贝尼乌斯范数 $\\|A_k^{(\\text{num})} - A_k^{(\\text{ana})}\\|_F$，这量化了差异。对于 $\\boldsymbol{\\zeta}_k = \\mathbf{0}$ 的情况，函数 $\\mathbf{F}$ 是一个齐次二次多项式，导致 $J_{\\mathbf{F}}(\\mathbf{0}) = \\mathbf{0}$。二次函数在零点的数值有限差分也为零，所以我们期望差的范数恰好为零。对于非零状态，范数应该很小，与数值微分的截断误差（$O(\\varepsilon^2)$ 阶）一致。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that iterates through test cases and prints the results.\n    \"\"\"\n\n    def compute_norm_diff(nx, ny, Lx, Ly, dt, zeta_k, eps):\n        \"\"\"\n        Computes the Frobenius norm of the difference between numerical and\n        analytical state transition Jacobians for a given test case.\n        \"\"\"\n        N = nx * ny\n        dx = Lx / nx\n        dy = Ly / ny\n\n        # 1. Construct discrete finite difference operators Dx and Dy\n        Dx = np.zeros((N, N))\n        Dy = np.zeros((N, N))\n        for i in range(ny):\n            for j in range(nx):\n                k = i * nx + j\n                # Dx (periodic)\n                k_xp1 = i * nx + (j + 1) % nx\n                k_xm1 = i * nx + (j - 1 + nx) % nx\n                Dx[k, k_xp1] = 1.0 / (2.0 * dx)\n                Dx[k, k_xm1] = -1.0 / (2.0 * dx)\n                # Dy (periodic)\n                k_yp1 = ((i + 1) % ny) * nx + j\n                k_ym1 = ((i - 1 + ny) % ny) * nx + j\n                Dy[k, k_yp1] = 1.0 / (2.0 * dy)\n                Dy[k, k_ym1] = -1.0 / (2.0 * dy)\n\n        # 2. Define the spectral inverse-Laplacian operator P as a function\n        kx_vec = 2.0 * np.pi * np.fft.fftfreq(nx, d=dx)\n        ky_vec = 2.0 * np.pi * np.fft.fftfreq(ny, d=dy)\n        kx_grid, ky_grid = np.meshgrid(kx_vec, ky_vec, indexing='xy')\n        ksq = kx_grid**2 + ky_grid**2\n        \n        def P_op(zeta_flat):\n            zeta_2d = zeta_flat.reshape(ny, nx)\n            zeta_hat = np.fft.fft2(zeta_2d)\n            psi_hat = np.zeros_like(zeta_hat, dtype=complex)\n            \n            nonzero_idx = ksq != 0\n            # Broadcasted division\n            psi_hat[nonzero_idx] = -zeta_hat[nonzero_idx] / ksq[nonzero_idx]\n\n            psi_2d = np.real(np.fft.ifft2(psi_hat))\n            return psi_2d.flatten()\n\n        # 3. Construct the matrix form of P\n        P_mat = np.zeros((N, N))\n        I_N = np.identity(N)\n        for j in range(N):\n            P_mat[:, j] = P_op(I_N[:, j])\n            \n        # 4. Define the nonlinear dynamics function F\n        def F_func(zeta_flat):\n            psi_flat = P_op(zeta_flat)\n            u_flat = -Dy @ psi_flat\n            v_flat = Dx @ psi_flat\n            zetax_flat = Dx @ zeta_flat\n            zetay_flat = Dy @ zeta_flat\n            return u_flat * zetax_flat + v_flat * zetay_flat\n\n        # 5. Compute the analytical Jacobian J_ana\n        psi_k = P_op(zeta_k)\n        u_k = -Dy @ psi_k\n        v_k = Dx @ psi_k\n        zetax_k = Dx @ zeta_k\n        zetay_k = Dy @ zeta_k\n\n        term1 = np.diag(zetax_k) @ (-Dy @ P_mat)\n        term2 = np.diag(u_k) @ Dx\n        term3 = np.diag(zetay_k) @ (Dx @ P_mat)\n        term4 = np.diag(v_k) @ Dy\n        J_ana = term1 + term2 + term3 + term4\n\n        # 6. Compute the numerical Jacobian J_num\n        J_num = np.zeros((N, N))\n        for j in range(N):\n            ej = I_N[:, j]\n            zeta_plus = zeta_k + eps * ej\n            zeta_minus = zeta_k - eps * ej\n            F_plus = F_func(zeta_plus)\n            F_minus = F_func(zeta_minus)\n            J_num[:, j] = (F_plus - F_minus) / (2.0 * eps)\n            \n        # 7. Compute state transition matrices and their difference norm\n        A_ana = I_N + dt * J_ana\n        A_num = I_N + dt * J_num\n        norm_diff = np.linalg.norm(A_num - A_ana, 'fro')\n        \n        return norm_diff\n\n    # Define test cases\n    test_cases_params = [\n        {'nx': 4, 'ny': 4, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'dt': 0.01, 'eps': 1e-6, 'case_id': 1},\n        {'nx': 4, 'ny': 4, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'dt': 0.01, 'eps': 1e-5, 'case_id': 2},\n        {'nx': 5, 'ny': 5, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'dt': 0.05, 'eps': 1e-6, 'case_id': 3},\n    ]\n\n    results = []\n    for params in test_cases_params:\n        nx, ny = params['nx'], params['ny']\n        Lx, Ly = params['Lx'], params['Ly']\n        dx, dy = Lx / nx, Ly / ny\n\n        if params['case_id'] == 1:\n            zeta_2d = np.zeros((ny, nx))\n        elif params['case_id'] == 2:\n            rng = np.random.default_rng(seed=0)\n            zeta_2d = rng.random((ny, nx))\n            zeta_2d -= np.mean(zeta_2d)\n            max_abs = np.max(np.abs(zeta_2d))\n            if max_abs > 0:\n                zeta_2d = 0.1 * zeta_2d / max_abs\n        elif params['case_id'] == 3:\n            kx, ky = 1.0, 2.0\n            x_coords = np.arange(nx) * dx\n            y_coords = np.arange(ny) * dy\n            yy_grid, xx_grid = np.meshgrid(y_coords, x_coords, indexing='ij')\n            zeta_2d = np.sin(kx * xx_grid) * np.sin(ky * yy_grid)\n        \n        zeta_k = zeta_2d.flatten()\n        \n        norm_val = compute_norm_diff(params['nx'], params['ny'], params['Lx'], params['Ly'], \n                                     params['dt'], zeta_k, params['eps'])\n        results.append(norm_val)\n\n    # Format and print the final result\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}