## 引言
[线性二次调节器](@entry_id:267871)（LQR）是现代控制理论的基石，为设计兼顾性能与成本的[最优控制](@entry_id:138479)器提供了一个系统化的数学框架。尽管其概念优雅，但如何精确构建其数学问题，理解其内在假设，并认识其解的存在性与稳定性条件，是初学者和工程师面临的关键挑战。本文旨在填补理论与实践之间的这一认知鸿沟，为读者提供一个关于[LQR问题](@entry_id:267315)公式化的全面而深入的指南。

在接下来的内容中，我们将分三个章节展开：第一章“原理与机制”将深入剖析[LQR问题](@entry_id:267315)的核心，从二次型性能指标的构建到保证稳定解存在的能稳性与能检性条件；第二章“应用与交叉学科联系”将展示LQR理论如何扩展以解决伺服跟踪、随机噪声等实际问题，并揭示其与LQG、MPC等先进控制方法的深刻联系；最后，第三章“动手实践”将通过具体的计算和仿真练习，帮助读者将理论知识转化为实践能力。通过本次学习，您将掌握[LQR问题](@entry_id:267315)构建的完整图景，并理解其在[现代控制系统](@entry_id:269478)设计中的核心地位。

## 原理与机制

本章旨在深入探讨[线性二次调节器](@entry_id:267871)（Linear Quadratic Regulator, LQR）问题的数学构建及其内在机制。我们将从其核心——二次型性能指标——出发，逐步剖析其构成、基本性质，以及确保问题[适定性](@entry_id:148590)（well-posedness）和存在稳定最优解的根本条件。最终，我们将阐明最优控制器在不同问题设定下的结构，包括其增益的推导过程。

### 二次型性能指标的构建

LQR 问题的核心是最小化一个二次型性能指标（或称成本函数），该指标旨在[量化控制](@entry_id:168852)系统在执行任务过程中的“性能”与“代价”之间的权衡。对于一个由[状态方程](@entry_id:274378)描述的线性时不变（LTI）系统，无论是连续时间还是离散时间，其 LQR 性能指标都具有相似的结构。

对于[连续时间系统](@entry_id:276553) $\dot{x}(t) = A x(t) + B u(t)$，在无限时间域 $[0, \infty)$ 上的典型性能指标 $J$ 定义为：
$$
J = \int_{0}^{\infty} \left( x(t)^{\top} Q x(t) + u(t)^{\top} R u(t) \right) dt
$$
而对于[离散时间系统](@entry_id:263935) $x_{k+1} = A x_{k} + B u_{k}$，在无限时间域上的性能指标则为：
$$
J = \sum_{k=0}^{\infty} \left( x_{k}^{\top} Q x_{k} + u_{k}^{\top} R u_{k} \right)
$$
在这两个表达式中：
-   $x(t)$ 或 $x_k$ 是系统的 $n$ 维状态向量，代表了系统的动态特性，如位置、速度、角度等。
-   $u(t)$ 或 $u_k$ 是系统的 $m$ 维控制输入向量，代表了施加给系统的外部作用，如力、力矩、电压等。
-   $x^{\top} Q x$ 这一项被称为 **状态惩罚项**。它度量了系统状态偏离原点（即期望的[平衡点](@entry_id:272705)）的程度。矩阵 $Q \in \mathbb{R}^{n \times n}$ 是一个 **状态权重矩阵**，用于指定对不同状态分量的关注程度。
-   $u^{\top} R u$ 这一项被称为 **控制输入惩罚项**。它度量了为实现控制目标所付出的“努力”或“代价”，例如能量消耗。矩阵 $R \in \mathbb{R}^{m \times m}$ 是一个 **控制输入权重矩阵**，用于量化不同控制输入的相对成本。

值得注意的是，在二次型 $v^{\top} M v$ 中，只有矩阵 $M$ 的对称部分 $\frac{1}{2}(M+M^{\top})$ 对其值有贡献，因为反对称部分产生的项 $v^{\top} \left( \frac{1}{2}(M-M^{\top}) \right) v$ 恒等于零。因此，在 LQR 的标准构建中，我们通常不失[一般性](@entry_id:161765)地假设 $Q$ 和 $R$ 均为对称矩阵。

### 性能指标的基本性质与权重矩阵的选择

为了使 LQR 问题具有数学上的意义和良好的优化特性，权重矩阵 $Q$ 和 $R$ 必须满足特定的条件。这些条件确保了[成本函数](@entry_id:138681)是凸的且有下界，从而保证了最优解的存在性和唯一性。

#### 非负性与凸性

一个有意义的[优化问题](@entry_id:266749)通常要求其目标函数有下界，以避免成本趋向于负无穷。在 LQR 问题中，我们希望总成本 $J$ 是非负的。要实现这一点，积分或求和的每一项（即“阶段成本”）$x^{\top}Qx + u^{\top}Ru$ 都必须是非负的。这自然引出对 $Q$ 和 $R$ 的第一个要求：它们必须是 **正半定 (positive semidefinite)** 的。

一个对称矩阵 $M$ 被称为正半定，记作 $M \succeq 0$，如果对于所有非零向量 $z$，都有 $z^{\top}Mz \ge 0$。因此，为保证成本非负，我们要求：
$$
Q = Q^{\top} \succeq 0 \quad \text{且} \quad R = R^{\top} \succeq 0
$$
这个条件不仅保证了成本函数的非负性，也保证了 LQR 问题是一个 **凸[优化问题](@entry_id:266749)**。由于[系统动力学](@entry_id:136288)是线性的，状态 $x$ 是控制输入 $u$ 的线性（或仿射）函数。一个关于 $x$ 和 $u$ 的二次型成本函数，如果其对应的二次型矩阵是正半定的，那么该[成本函数](@entry_id:138681)就是凸的。LQR 问题的[目标函数](@entry_id:267263)是凸的，约束是线性的，这使其成为一个凸[优化问题](@entry_id:266749)，为求解带来了极大的便利。

#### [严格凸性](@entry_id:193965)与[解的唯一性](@entry_id:143619)

虽然 $R \succeq 0$ 足以保证[凸性](@entry_id:138568)，但在标准 LQR 构建中，我们通常采用一个更强的条件：$R$ 是 **正定 (positive definite)** 的。一个对称矩阵 $M$ 被称为正定，记作 $M \succ 0$，如果对于所有非[零向量](@entry_id:156189) $z$，都有 $z^{\top}Mz > 0$。

要求 $R = R^{\top} \succ 0$ 的核心原因在于确保 **[解的唯一性](@entry_id:143619)**。当 $R \succ 0$ 时，[成本函数](@entry_id:138681) $J$ 对于控制输入序列 $\{u_k\}$ 或函数 $u(t)$ 是 **严格凸 (strictly convex)** 的。这意味着任何非零的控制输入都会产生严格为正的成本。一个严格凸的[优化问题](@entry_id:266749)，如果存在最优解，那么该解是唯一的。如果 $R$ 仅仅是正半定，那么可能存在某些方向的控制输入（即 $R$ 的零空间中的向量），它们不产生任何直接的控制成本，这可能导致[最优控制](@entry_id:138479)策略不唯一。

此外，$R \succ 0$ 还确保了成本函数的 **[矫顽性](@entry_id:159399) (coercivity)**。这意味着当控制输入的范数（例如 $L^2$ 范数）趋于无穷时，总成本 $J$ 也趋于无穷。具体而言，由于 $x^{\top}Qx \ge 0$ 且 $u^{\top}Ru \ge \lambda_{\min}(R)\|u\|^2$（其中 $\lambda_{\min}(R) > 0$ 是 $R$ 的最小特征值），我们可以得到 $J \ge \lambda_{\min}(R) \int_0^{\infty} \|u(t)\|^2 dt$。这个性质排除了存在具有无限“能量”但成本有限的控制序列的可能性，这在理论分析和求解中至关重要。

综上所述，LQR 问题的标准提法所依赖的最小假设集为：
$$
Q = Q^{\top} \succeq 0 \quad \text{且} \quad R = R^{\top} \succ 0
$$

### 状态-代价权衡：调节器的调校

权重矩阵 $Q$ 和 $R$ 不仅是数学上的符号，它们在工程实践中扮演着“调校旋钮”的关键角色，直接决定了控制器的性能表现。通过调整 $Q$ 和 $R$ 的相对大小，工程师可以在 **状态调节性能**（即状态收敛到零的速度和精度）与 **控制代价**（即执行控制所需的能量或资源）之间进行权衡。

-   **增大 $Q$**：如果我们将 $Q$ 替换为 $\alpha Q$（其中 $\alpha > 1$），相当于加大了对状态偏离的惩罚。为了最小化总成本，最优控制器会变得更加“激进”，使用更大的控制输入来更快地将状态驱动回原点。这通常会导致更快的[系统响应](@entry_id:264152)速度，但代价是消耗更多的控制能量。

-   **增大 $R$**：反之，如果我们将 $R$ 替换为 $\beta R$（其中 $\beta > 1$），相当于加大了对控制输入的惩罚。最优控制器会变得更加“保守”，倾向于使用较小的控制输入以节约成本，即使这意味着状态收敛到原点的速度会变慢。

-   **等比例缩放 $Q$ 和 $R$**：一个非常重要的性质是，如果将 $Q$ 和 $R$ 同时乘以一个正常数 $\sigma > 0$，即替换为 $\sigma Q$ 和 $\sigma R$，那么最优[反馈增益](@entry_id:271155) $K$ 以及由此产生的闭环系统轨迹将保持不变。改变的仅仅是最终的最优成本值 $J^*$，它会变为 $\sigma J^*$。这是因为最小化 $\sigma J$ 与最小化 $J$ 是等价的。这个不变性意味着，在 LQR 设计中，真正重要的是 $Q$ 和 $R$ 的 **相对大小**，而不是它们的[绝对值](@entry_id:147688)。

### 稳定最优解的存在性条件

一个数学上适定的 LQR 问题并不能自动保证其最优解是一个能使[闭环系统](@entry_id:270770)稳定的控制器。为了确保 LQR 设计能够成功地稳定一个（可能不稳定的）开环系统，系统本身必须满足两个基本的系统理论条件：**能稳性 (stabilizability)** 和 **能检性 (detectability)**。

#### 能稳性

首先，我们定义 **能控性 (controllability)**。一个系统 $(A,B)$ 被认为是能控的，如果对于任意初始状态 $x_0$ 和任意目标状态 $x_f$，都存在一个控制输入能在有限时间内将系统从 $x_0$ 驱动到 $x_f$。这是一个非常强的条件，意味着控制输入可以完全主宰系统的所有动态模式。

**能稳性** 是一个比能控性更弱但更具实际意义的概念。一个系统 $(A,B)$ 被认为是能稳的，如果所有不稳定的系统模式（即对应于 $A$ 矩阵中具有非负实部[特征值](@entry_id:154894)的模式）都是能控的。换言之，我们不需要能控制所有模式，只需要能控制那些自身不稳定的模式即可。稳定的模式可以任其自行收敛。

能稳性是存在任何形式的镇定[状态反馈控制](@entry_id:271611)（包括 LQR）的 **必要条件**。其根本原因在于，[状态反馈](@entry_id:151441) $u = -Kx$ 无法改变系统中的不能控模式。如果一个系统存在一个不能控且不稳定的模式，那么无论[反馈增益](@entry_id:271155) $K$ 如何选择，闭环矩阵 $A-BK$ 都会保留这个不稳定的[特征值](@entry_id:154894)，从而导致闭环系统不稳定。LQR 控制器也无法克服这一结构性限制。因此，如果系统 $(A,B)$ 本身不是能稳的，就不可能找到一个镇定的 LQR 控制器。这一要求与权重矩阵 $Q$ 和 $R$ 的选择无关，是系统固有的先决条件。

#### 能检性

能检性是与能稳性对偶的概念。首先，我们定义 **能观性 (observability)**。一个系统与某个输出 $y = Cx$ 的组合 $(C, A)$ 被认为是能观的，如果通过在有限时间内观测输出 $y(t)$，可以唯一确定系统的初始状态 $x(0)$。

在 LQR 的语境下，我们关心的“输出”是状态惩罚项 $x^{\top}Qx$ 所“看到”的系统状态。这可以形式化为与虚拟输出 $y = Q^{1/2}x$ 相关联的能观性，其中 $Q^{1/2}$ 是 $Q$ 的一个平方根（例如，通过 Cholesky 分解得到，使得 $Q = (Q^{1/2})^{\top}Q^{1/2}$）。

**能检性 (detectability)** 是一个比能观性更弱的条件。一对矩阵 $(A, Q^{1/2})$ 被认为是能检的，如果所有不能观的系统模式（即对应于 $A$ 的[特征向量](@entry_id:151813) $v$ 满足 $Q^{1/2}v=0$）都是稳定的（即对应[特征值](@entry_id:154894)具有负实部）。换言之，任何不稳定的模式都必须能够被成本函数“检测”到。

能检性是存在镇定 LQR 解的另一个 **必要条件**。其背后的直觉是：LQR 控制器通过最小化成本来工作。如果系统存在一个不稳定的模式，但这个模式的增长并不会增加[成本函数](@entry_id:138681)中的状态惩罚项（即该模式对于 $Q^{1/2}$ 是不可观测的），那么最优控制器将“无视”这个模式，不会分配任何控制能量去抑制它。这将导致系统状态沿着这个不稳定模式发散，而控制器却认为自己已经找到了成本为零（或很小）的“最优”策略。能检性条件正是为了杜绝这种情况的发生。

综上所述，我们可以陈述 LQR 理论中的一个核心定理：
对于无限时间域 LQR 问题，存在一个唯一的、能使闭环系统稳定的最优[状态反馈控制器](@entry_id:203349)的充要条件是：**系统对 $(A,B)$ 是能稳的，且系统对 $(A, Q^{1/2})$ 是能检的**。

### 最优控制器的结构

在满足上述先决条件后，我们可以进一步探究[最优控制](@entry_id:138479)器的具体形式和推导机制。

#### 无限时间域问题与代数 Riccati 方程

对于无限时间域 LTI LQR 问题，最优控制器是一个 **[线性时不变](@entry_id:276287)[状态反馈](@entry_id:151441)律**：
$$
u^*(t) = -K x(t)
$$
其中 $K \in \mathbb{R}^{m \times n}$ 是一个常数增益矩阵。这个增益矩阵由下式给出：
$$
K = R^{-1} B^{\top} P
$$
这里的矩阵 $P \in \mathbb{R}^{n \times n}$ 是一个对称、正半定的矩阵，它是下述 **代数 Riccati 方程 (Algebraic Riccati Equation, ARE)** 的唯一稳定解：
$$
A^{\top} P + P A - P B R^{-1} B^{\top} P + Q = 0
$$
这个结果可以通过两种主要方法推导，例如哈密顿-雅可比-贝尔曼（HJB）方程或“[配方法](@entry_id:265480)”。以 HJB 方法为例，我们假设最优成本（值函数）具有二次型形式 $V(x) = x^{\top} P x$。根据最优性原理，值函数必须满足 HJB 方程。通过对 HJB 方程中的[哈密顿量](@entry_id:172864)关于 $u$ 进行最小化，可以直接导出最优控制 $u^*$ 的表达式。将此表达式代回 HJB 方程，即可得到 ARE。ARE 中的[非线性](@entry_id:637147)项 $-PBR^{-1}B^{\top}P$ 体现了状态调节与控制成本之间的优化权衡。

#### 有限时间域问题与[微分](@entry_id:158718) Riccati 方程

当 LQR 问题定义在有限时间域 $[t_0, T]$ 上时，情况有所不同。这类问题通常包含一个 **终端惩罚项** $x(T)^{\top} S x(T)$，其中 $S \succeq 0$ 是一个终端权重矩阵。完整的[成本函数](@entry_id:138681)为：
$$
J = x(T)^{\top} S x(T) + \int_{t_{0}}^{T} \left( x(t)^{\top} Q x(t) + u(t)^{\top} R u(t) \right) dt
$$
在有限时间域问题中，最优控制策略取决于“剩余时间” $T-t$。因此，[最优控制](@entry_id:138479)器不再是时不变的，而是一个 **线性时变[状态反馈](@entry_id:151441)律**：
$$
u^*(t) = -K(t) x(t)
$$
时变增益矩阵由下式给出：
$$
K(t) = R^{-1} B^{\top} P(t)
$$
这里的矩阵 $P(t)$ 不再是一个常数矩阵，而是下述 **[微分](@entry_id:158718) Riccati 方程 (Differential Riccati Equation, DRE)** 的解：
$$
-\dot{P}(t) = A^{\top} P(t) + P(t) A - P(t) B R^{-1} B^{\top} P(t) + Q
$$
此[微分方程](@entry_id:264184)需要一个终端条件来求解，该条件由终端惩罚项提供：$P(T) = S$。通过从终端时刻 $T$ 向后积分 DRE，我们可以得到在整个时间区间 $[t_0, T]$ 上的 $P(t)$，进而得到时变的最优增益 $K(t)$。

### 包含[交叉](@entry_id:147634)项的 LQR 提法

标准的 LQR 提法可以扩展到包含状态与控制输入的交叉惩罚项：
$$
J = \int_{0}^{\infty} \left( x^{\top}Qx + 2x^{\top}Su + u^{\top}Ru \right) dt
$$
这个[交叉](@entry_id:147634)项 $2x^{\top}Su$ 在某些应用中是有意义的。为了分析此问题的[凸性](@entry_id:138568)，我们将阶段成本写成一个统一的二次型：
$$
\begin{pmatrix} x \\ u \end{pmatrix}^{\top}
\begin{pmatrix} Q  S \\ S^{\top}  R \end{pmatrix}
\begin{pmatrix} x \\ u \end{pmatrix}
$$
为了使整个[优化问题](@entry_id:266749)是凸的，需要这个大的[分块矩阵](@entry_id:148435)是正半定的：
$$
\begin{pmatrix} Q  S \\ S^{\top}  R \end{pmatrix} \succeq 0
$$
通过"[配方法](@entry_id:265480)"，我们可以将交叉项吸收掉。这导致对系统模型进行一个等效变换，并相应地修改 ARE 和增益表达式。具体而言，最优[反馈增益](@entry_id:271155)变为 $K = R^{-1}(B^{\top}P + S^{\top})$，而 $P$ 满足一个修正后的 ARE。这表明 LQR 的基本原理和框架具有很强的灵活性，可以适应更复杂的成本函数结构。