{
    "hands_on_practices": [
        {
            "introduction": "要想真正理解复杂的集体行为是如何涌现的，我们必须首先掌握其底层的微观力学机制。第一个练习将提供一个直接的动手实践机会，让你为一个小型群体实现一次完整的 Boids 模型单步更新。通过亲手计算分离、对齐和聚集这三种力，你将对这些局部规则如何相互作用以驱动系统动力学获得具体而深刻的理解。",
            "id": "4123912",
            "problem": "考虑平面上经典的 Boids 基于智能体的模型 (ABM)，用于模拟集群行为。其中每个智能体 $i \\in \\{1,\\dots,N\\}$ 在时间 $t$ 具有位置 $x_i(t) \\in \\mathbb{R}^2$ 和速度 $v_i(t) \\in \\mathbb{R}^2$。该模型结合了三种转向影响：分离、对齐和聚集，每种影响都是根据由固定半径定义的局部邻域计算得出的。设智能体 $i$ 和 $j$ 之间的欧几里得距离为 $d_{ij}(t) = \\|x_i(t) - x_j(t)\\|$。在时间 $t$ 定义三个邻域集合，\n$$\nS_i(t) = \\{ j \\neq i : d_{ij}(t) \\leq r_s \\}, \\quad\nA_i(t) = \\{ j \\neq i : d_{ij}(t) \\leq r_a \\}, \\quad\nC_i(t) = \\{ j \\neq i : d_{ij}(t) \\leq r_c \\},\n$$\n其分离半径为 $r_s$，对齐半径为 $r_a$，聚集半径为 $r_c$。经典的转向矢量为：\n1. 分离：$s_i(t) = \\sum_{j \\in S_i(t)} \\dfrac{x_i(t) - x_j(t)}{\\|x_i(t) - x_j(t)\\|}$。\n2. 对齐：$a_i(t) = \\left(\\dfrac{1}{|A_i(t)|}\\sum_{j \\in A_i(t)} v_j(t)\\right) - v_i(t)$，如果 $|A_i(t)| \\geq 1$，否则 $a_i(t) = (0,0)$。\n3. 聚集：$c_i(t) = \\left(\\dfrac{1}{|C_i(t)|}\\sum_{j \\in C_i(t)} x_j(t)\\right) - x_i(t)$，如果 $|C_i(t)| \\geq 1$，否则 $c_i(t) = (0,0)$。\n\n假设瞬时转向加速度为 $u_i(t) = \\alpha s_i(t) + \\beta a_i(t) + \\gamma c_i(t)$，其中 $\\alpha, \\beta, \\gamma \\in \\mathbb{R}$ 为固定权重。在一个时间步长 $\\Delta t$ 内，速度的前向欧拉更新由 $v_i'(t+\\Delta t) = v_i(t) + \\Delta t\\, u_i(t)$ 给出。通过设置以下规则来强制执行速度上限 $v_{\\max} > 0$\n$$\nv_i(t+\\Delta t) =\n\\begin{cases}\nv_i'(t+\\Delta t),   \\text{如果 } \\|v_i'(t+\\Delta t)\\| \\leq v_{\\max}, \\\\\n\\dfrac{v_{\\max}}{\\|v_i'(t+\\Delta t)\\|}\\, v_i'(t+\\Delta t),   \\text{如果 } \\|v_i'(t+\\Delta t)\\| > v_{\\max},\n\\end{cases}\n$$\n并通过 $x_i(t+\\Delta t) = x_i(t) + \\Delta t\\, v_i(t+\\Delta t)$ 更新位置。\n\n对于一个由 $N = 3$ 个智能体组成的系统，其在时间 $t$ 的初始条件为：\n$$\nx_1(t) = (0,0), \\quad x_2(t) = (1,0), \\quad x_3(t) = (4,3),\n$$\n$$\nv_1(t) = (1,0), \\quad v_2(t) = (0,1), \\quad v_3(t) = (-1,0),\n$$\n以及参数\n$$\n\\Delta t = \\frac{1}{2}, \\quad v_{\\max} = 1, \\quad \\alpha = \\frac{1}{2}, \\quad \\beta = \\frac{1}{3}, \\quad \\gamma = \\frac{1}{4}, \\quad r_s = \\frac{3}{2}, \\quad r_a = 4, \\quad r_c = 6,\n$$\n请使用上述规则计算 $i \\in \\{1,2,3\\}$ 的单步更新 $(x_i(t+\\Delta t), v_i(t+\\Delta t))$。精确表示最终值（在出现有理数和根式时使用它们）。将最终答案表示为一个单行矩阵，按顺序包含以下分量\n$$\nx_{1,x}(t+\\Delta t), \\ x_{1,y}(t+\\Delta t), \\ v_{1,x}(t+\\Delta t), \\ v_{1,y}(t+\\Delta t), \\ x_{2,x}(t+\\Delta t), \\ x_{2,y}(t+\\Delta t), \\ v_{2,x}(t+\\Delta t), \\ v_{2,y}(t+\\Delta t), \\ x_{3,x}(t+\\Delta t), \\ x_{3,y}(t+\\Delta t), \\ v_{3,x}(t+\\Delta t), \\ v_{3,y}(t+\\Delta t).\n$$\n无需四舍五入。",
            "solution": "问题要求计算一个由 $N=3$ 个智能体组成的系统的位置和速度的单步更新。我们将按照 Boids 模型的规则，逐个智能体地进行计算。\n\n首先，我们根据给定的初始位置计算所有智能体对之间的距离：\n$x_1(t) = (0,0)$, $x_2(t) = (1,0)$, $x_3(t) = (4,3)$\n$d_{12} = \\|x_1 - x_2\\| = \\|(-1,0)\\| = 1$\n$d_{13} = \\|x_1 - x_3\\| = \\|(-4,-3)\\| = \\sqrt{16+9} = 5$\n$d_{23} = \\|x_2 - x_3\\| = \\|(-3,-3)\\| = \\sqrt{18} = 3\\sqrt{2} \\approx 4.24$\n\n现在，我们为每个智能体计算更新后的状态。\n\n### 智能体 1 的更新\n\n1.  **邻域**:\n    *   分离 ($r_s=1.5$): $d_{12}=1 \\le 1.5$, 所以 $S_1(t) = \\{2\\}$。\n    *   对齐 ($r_a=4$): $d_{12}=1 \\le 4$, 所以 $A_1(t) = \\{2\\}$。\n    *   聚集 ($r_c=6$): $d_{12}=1 \\le 6$ 且 $d_{13}=5 \\le 6$, 所以 $C_1(t) = \\{2, 3\\}$。\n\n2.  **转向矢量**:\n    *   $s_1 = \\frac{x_1-x_2}{d_{12}} = \\frac{(-1,0)}{1} = (-1,0)$。\n    *   $a_1 = v_2 - v_1 = (0,1) - (1,0) = (-1,1)$。\n    *   $c_1 = \\frac{1}{2}(x_2+x_3) - x_1 = \\frac{1}{2}(5,3) = (2.5, 1.5)$。\n\n3.  **加速度**: $u_1 = \\frac{1}{2}s_1 + \\frac{1}{3}a_1 + \\frac{1}{4}c_1 = \\frac{1}{2}(-1,0) + \\frac{1}{3}(-1,1) + \\frac{1}{4}(2.5, 1.5) = (-\\frac{1}{2}-\\frac{1}{3}+\\frac{5}{8}, \\frac{1}{3}+\\frac{3}{8}) = (-\\frac{5}{24}, \\frac{17}{24})$。\n\n4.  **速度更新**:\n    $v_1' = v_1 + \\Delta t \\, u_1 = (1,0) + \\frac{1}{2}(-\\frac{5}{24}, \\frac{17}{24}) = (\\frac{43}{48}, \\frac{17}{48})$。\n    $\\|v_1'\\|^2 = \\frac{43^2+17^2}{48^2} = \\frac{1849+289}{2304} = \\frac{2138}{2304}  1$。速度无需裁剪。\n    $v_1(t+\\Delta t) = (\\frac{43}{48}, \\frac{17}{48})$。\n\n5.  **位置更新**: $x_1(t+\\Delta t) = x_1 + \\Delta t \\, v_1(t+\\Delta t) = (0,0) + \\frac{1}{2}(\\frac{43}{48}, \\frac{17}{48}) = (\\frac{43}{96}, \\frac{17}{96})$。\n\n### 智能体 2 的更新\n\n1.  **邻域**:\n    *   分离 ($r_s=1.5$): $d_{21}=1 \\le 1.5$, 所以 $S_2(t) = \\{1\\}$。\n    *   对齐 ($r_a=4$): $d_{21}=1 \\le 4$, 所以 $A_2(t) = \\{1\\}$。\n    *   聚集 ($r_c=6$): $d_{21}=1 \\le 6$ 且 $d_{23}=3\\sqrt{2} \\le 6$, 所以 $C_2(t) = \\{1, 3\\}$。\n\n2.  **转向矢量**:\n    *   $s_2 = \\frac{x_2-x_1}{d_{21}} = (1,0)$。\n    *   $a_2 = v_1 - v_2 = (1,-1)$。\n    *   $c_2 = \\frac{1}{2}(x_1+x_3) - x_2 = (2, 1.5) - (1,0) = (1, 1.5)$。\n\n3.  **加速度**: $u_2 = \\frac{1}{2}s_2 + \\frac{1}{3}a_2 + \\frac{1}{4}c_2 = (\\frac{1}{2}+\\frac{1}{3}+\\frac{1}{4}, -\\frac{1}{3}+\\frac{3}{8}) = (\\frac{13}{12}, \\frac{1}{24})$。\n\n4.  **速度更新**:\n    $v_2' = v_2 + \\Delta t \\, u_2 = (0,1) + \\frac{1}{2}(\\frac{13}{12}, \\frac{1}{24}) = (\\frac{13}{24}, \\frac{49}{48})$。\n    $\\|v_2'\\|^2 = (\\frac{26}{48})^2 + (\\frac{49}{48})^2 = \\frac{676+2401}{2304} = \\frac{3077}{2304} > 1$。速度需要裁剪。\n    $v_2(t+\\Delta t) = \\frac{1}{\\|v_2'\\|}v_2' = \\frac{48}{\\sqrt{3077}}(\\frac{13}{24}, \\frac{49}{48}) = (\\frac{26}{\\sqrt{3077}}, \\frac{49}{\\sqrt{3077}})$。\n\n5.  **位置更新**: $x_2(t+\\Delta t) = x_2 + \\Delta t \\, v_2(t+\\Delta t) = (1,0) + \\frac{1}{2}(\\frac{26}{\\sqrt{3077}}, \\frac{49}{\\sqrt{3077}}) = (1 + \\frac{13}{\\sqrt{3077}}, \\frac{49}{2\\sqrt{3077}})$。\n\n### 智能体 3 的更新\n\n1.  **邻域**:\n    *   分离 ($r_s=1.5$): $d_{31}=5 > 1.5$ 且 $d_{32}=3\\sqrt{2} > 1.5$, 所以 $S_3(t) = \\emptyset$。\n    *   对齐 ($r_a=4$): $d_{31}=5 > 4$ 且 $d_{32}=3\\sqrt{2} > 4$, 所以 $A_3(t) = \\emptyset$。\n    *   聚集 ($r_c=6$): $d_{31}=5 \\le 6$ 且 $d_{32}=3\\sqrt{2} \\le 6$, 所以 $C_3(t) = \\{1, 2\\}$。\n\n2.  **转向矢量**: $s_3=(0,0)$, $a_3=(0,0)$。\n    $c_3 = \\frac{1}{2}(x_1+x_2) - x_3 = (\\frac{1}{2},0) - (4,3) = (-\\frac{7}{2}, -3)$。\n\n3.  **加速度**: $u_3 = \\frac{1}{4}c_3 = (-\\frac{7}{8}, -\\frac{3}{4})$。\n\n4.  **速度更新**:\n    $v_3' = v_3 + \\Delta t \\, u_3 = (-1,0) + \\frac{1}{2}(-\\frac{7}{8}, -\\frac{3}{4}) = (-\\frac{23}{16}, -\\frac{6}{16})$。\n    $\\|v_3'\\|^2 = \\frac{23^2+6^2}{16^2} = \\frac{529+36}{256} = \\frac{565}{256} > 1$。速度需要裁剪。\n    $v_3(t+\\Delta t) = \\frac{1}{\\|v_3'\\|}v_3' = \\frac{16}{\\sqrt{565}}(-\\frac{23}{16}, -\\frac{6}{16}) = (-\\frac{23}{\\sqrt{565}}, -\\frac{6}{\\sqrt{565}})$。\n\n5.  **位置更新**: $x_3(t+\\Delta t) = x_3 + \\Delta t \\, v_3(t+\\Delta t) = (4,3) + \\frac{1}{2}(-\\frac{23}{\\sqrt{565}}, -\\frac{6}{\\sqrt{565}}) = (4 - \\frac{23}{2\\sqrt{565}}, 3 - \\frac{3}{\\sqrt{565}})$。\n\n### 最终组合答案\n\n将所有计算出的分量按指定顺序组合，得到最终答案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{43}{96}  \\frac{17}{96}  \\frac{43}{48}  \\frac{17}{48}  1 + \\frac{13}{\\sqrt{3077}}  \\frac{49}{2\\sqrt{3077}}  \\frac{26}{\\sqrt{3077}}  \\frac{49}{\\sqrt{3077}}  4 - \\frac{23}{2\\sqrt{565}}  3 - \\frac{3}{\\sqrt{565}}  -\\frac{23}{\\sqrt{565}}  -\\frac{6}{\\sqrt{565}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Boids 模型的魅力在于它能从简单的局部规则中生成可识别的大尺度模式。为了超越定性描述，我们需要定量的分析工具。本练习将引入一些关键的宏观序参数——极化度和转圈（milling）参数，它们使我们能够对集体运动进行分类，从而将微观的智能体状态与宏观的涌现现象（如集群或转圈）联系起来。",
            "id": "4123893",
            "problem": "考虑一个由类似 Boids 的相互作用规则（对齐、内聚和分离）控制的自驱动个体二维聚集体，在固定时间 $t=t_{0}$ 进行观察。设有 $N$ 个个体，其位置为 $\\{\\mathbf{r}_{i}(t)\\}_{i=1}^{N} \\subset \\mathbb{R}^{2}$，速度为 $\\{\\mathbf{v}_{i}(t)\\}_{i=1}^{N} \\subset \\mathbb{R}^{2}$。在时间 $t$ 定义以下序参量：\n- 极化度（对齐序参量）\n$$\n\\Phi(t) \\equiv \\frac{\\left\\|\\sum_{i=1}^{N} \\mathbf{v}_{i}(t)\\right\\|}{\\sum_{i=1}^{N} \\|\\mathbf{v}_{i}(t)\\|},\n$$\n其取值范围在 $[0,1]$ 内，用于量化全局速度对齐程度。\n- 环绕参数（关于质心的归一化角动量）\n$$\n\\kappa(t) \\equiv \\frac{\\left\\|\\sum_{i=1}^{N} \\left(\\boldsymbol{\\rho}_{i}(t) \\times \\mathbf{v}_{i}(t)\\right)\\right\\|}{\\sum_{i=1}^{N} \\|\\boldsymbol{\\rho}_{i}(t)\\| \\,\\|\\mathbf{v}_{i}(t)\\|},\n$$\n其中 $\\boldsymbol{\\rho}_{i}(t) \\equiv \\mathbf{r}_{i}(t)-\\mathbf{r}_{\\mathrm{cm}}(t)$，而 $\\mathbf{r}_{\\mathrm{cm}}(t) \\equiv \\frac{1}{N}\\sum_{i=1}^{N}\\mathbf{r}_{i}(t)$ 是质心。在二维空间中，$\\boldsymbol{\\rho}_{i}(t) \\times \\mathbf{v}_{i}(t)$ 表示将 $\\mathbb{R}^{2}$ 嵌入 $\\mathbb{R}^{3}$ 后所得三维叉积的标量z分量。参数 $\\kappa(t)\\in[0,1]$ 量化了围绕质心的相干旋转。\n- 由回转半径测量的空间广延\n$$\nL(t) \\equiv \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}\\|\\boldsymbol{\\rho}_{i}(t)\\|^{2}},\n$$\n其单位为长度。\n\n在时间 $t=t_{0}$，考虑位于以原点为中心、半径为 $R=10\\,\\mathrm{m}$ 的圆上的 $N=6$ 个个体。它们的位置和速度由角度 $\\theta_{k} \\in \\{0, \\frac{\\pi}{3}, \\frac{2\\pi}{3}, \\pi, \\frac{4\\pi}{3}, \\frac{5\\pi}{3}\\}$（角度以弧度为单位）给出，其中\n$$\n\\mathbf{r}_{k}(t_{0}) = R\\begin{pmatrix}\\cos\\theta_{k} \\\\ \\sin\\theta_{k}\\end{pmatrix}, \\qquad \\mathbf{v}_{k}(t_{0}) = V\\begin{pmatrix}-\\sin\\theta_{k} \\\\ \\cos\\theta_{k}\\end{pmatrix},\n$$\n对于 $k=1,\\dots,6$，其中 $V=1\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ 是共同速率，运动方向为逆时针切向。仅使用上述定义和标准向量微积分，计算 $\\Phi(t_{0})$、$\\kappa(t_{0})$ 和 $L(t_{0})$。然后，根据以下定性标准解释该构型对应于集群（flocking）、簇拥（swarming）还是环绕（milling）：集群表现为高 $\\Phi(t)$ 和低 $\\kappa(t)$，环绕表现为低 $\\Phi(t)$ 和高 $\\kappa(t)$，而无序簇拥表现为低 $\\Phi(t)$ 和低 $\\kappa(t)$。\n\n将最终数值结果以行矩阵 $\\left(\\Phi(t_{0}),\\,\\kappa(t_{0}),\\,L(t_{0})\\right)$ 的形式报告。如果需要取整，将最终数值结果四舍五入到四位有效数字。将 $L(t_{0})$ 以米为单位表示。",
            "solution": "目标是计算在时间 $t_0$ 时，一个由 $N=6$ 个个体组成的系统的极化度 $\\Phi(t_0)$、环绕参数 $\\kappa(t_0)$ 和回转半径 $L(t_0)$。这些个体的位置构成一个正六边形。\n\n1.  **计算质心和回转半径 $L(t_0)$**:\n    个体的配置具有高度对称性（正六边形）。因此，位置向量之和为零：$\\sum_{k=1}^{6}\\mathbf{r}_{k}(t_0) = \\mathbf{0}$。这意味着质心位于原点 $\\mathbf{r}_{\\mathrm{cm}}(t_0) = \\mathbf{0}$。\n    因此，相对位置向量 $\\boldsymbol{\\rho}_{k}(t_0) = \\mathbf{r}_{k}(t_0)$。每个个体到中心的距离为 $\\|\\boldsymbol{\\rho}_{k}(t_0)\\| = R$。\n    回转半径为：\n    $$\n    L(t_0) = \\sqrt{\\frac{1}{N}\\sum_{k=1}^{N}\\|\\boldsymbol{\\rho}_{k}(t_0)\\|^{2}} = \\sqrt{\\frac{1}{6}\\sum_{k=1}^{6}R^{2}} = \\sqrt{\\frac{6R^2}{6}} = R = 10\\,\\mathrm{m}\n    $$\n\n2.  **计算极化度 $\\Phi(t_0)$**:\n    所有个体的速率为 $\\|\\mathbf{v}_{k}(t_0)\\| = V = 1$。因此，分母为 $\\sum_{k=1}^{N} \\|\\mathbf{v}_{k}(t_0)\\| = NV = 6$。\n    对于分子，我们计算速度向量之和：$\\sum_{k=1}^{6}\\mathbf{v}_{k}(t_0) = V \\sum_{k=1}^{6}\\begin{pmatrix}-\\sin\\theta_{k} \\\\ \\cos\\theta_{k}\\end{pmatrix}$。\n    由于角度 $\\theta_k$ 在一个周期内均匀分布，正弦和余弦函数在一个周期内的和为零。因此，$\\sum \\sin\\theta_k = 0$ 且 $\\sum \\cos\\theta_k = 0$。\n    速度向量之和为零向量 $\\mathbf{0}$，其范数为 $0$。\n    所以，极化度为：\n    $$\n    \\Phi(t_0) = \\frac{0}{6} = 0\n    $$\n\n3.  **计算环绕参数 $\\kappa(t_0)$**:\n    分母为 $\\sum_{k=1}^{N} \\|\\boldsymbol{\\rho}_{k}(t_0)\\| \\,\\|\\mathbf{v}_{k}(t_0)\\| = \\sum_{k=1}^{6} R \\cdot V = NRV = 6 \\cdot 10 \\cdot 1 = 60$。\n    对于分子，我们计算每个个体的标量叉积 $\\boldsymbol{\\rho}_{k} \\times \\mathbf{v}_{k}$。\n    $$\n    \\boldsymbol{\\rho}_{k} \\times \\mathbf{v}_{k} = (R\\cos\\theta_{k})(V\\cos\\theta_{k}) - (R\\sin\\theta_{k})(-V\\sin\\theta_{k}) = RV(\\cos^2\\theta_{k} + \\sin^2\\theta_{k}) = RV\n    $$\n    对于所有个体，叉积都是一个恒定的正标量 $RV = 10 \\cdot 1 = 10$。\n    叉积之和为 $\\sum_{k=1}^{6} RV = NRV = 60$。分子的范数是 $|60|=60$。\n    所以，环绕参数为：\n    $$\n    \\kappa(t_0) = \\frac{60}{60} = 1\n    $$\n\n**结果与解释**:\n计算出的序参量为 $\\Phi(t_0) = 0$、$\\kappa(t_0) = 1$ 和 $L(t_0) = 10\\,\\mathrm{m}$。\n根据问题中给出的标准，低 $\\Phi(t)$ 和高 $\\kappa(t)$ 的组合（此处为极值0和1）明确地表明系统处于 **环绕（milling）** 状态。这描述了一个完美的涡旋，其中所有个体围绕共同的中心进行相干旋转，而没有整体的平移运动。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  1  10\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "一个能运行的模型只是第一步；一个具有科学价值的模型必须是可调节的，并且能用数据进行验证。这个高级练习将带你进入一个研究级别的问题：使用可微的目标函数来优化 Boids 的参数 $\\alpha$、$\\beta$ 和 $\\gamma$。你将探索如何利用自动微分等现代计算技术来分析模型的参数空间，这为模型校准和系统辨识奠定了基础。",
            "id": "4123914",
            "problem": "考虑一个由 $N$ 个点智能体（boid）组成的种群，其索引为 $i \\in \\{1,\\dots,N\\}$，位置为 $\\mathbf{x}_i \\in \\mathbb{R}^2$，速度为 $\\mathbf{v}_i \\in \\mathbb{R}^2$。时间更新由一个单步离散时间的 Boids 规则定义，该规则结合了对齐、内聚和分离的影响。设参数 $\\alpha$、$\\beta$ 和 $\\gamma$ 分别是控制对齐、内聚和分离大小的实标量，并设 $\\Delta t$ 为时间步长。更新规则为\n$$\n\\mathbf{v}_i' = \\mathbf{v}_i + \\alpha \\,\\mathbf{A}_i + \\beta\\,\\mathbf{C}_i + \\gamma\\,\\mathbf{S}_i,\\quad\n\\mathbf{x}_i' = \\mathbf{x}_i + \\Delta t\\,\\mathbf{v}_i',\n$$\n其中，对齐项 $\\mathbf{A}_i$、内聚项 $\\mathbf{C}_i$ 和分离项 $\\mathbf{S}_i$ 是根据当前 $(\\mathbf{x}_i,\\mathbf{v}_i)$ 和一个固定的邻域半径 $R$ 计算得出的，使用以下定义，其中 $\\mathcal{N}_i = \\{ j \\neq i : \\|\\mathbf{x}_j - \\mathbf{x}_i\\| \\le R\\}$：\n- 对齐：\n$$\n\\mathbf{A}_i = \n\\begin{cases}\n\\displaystyle \\frac{1}{|\\mathcal{N}_i|}\\sum_{j \\in \\mathcal{N}_i} \\mathbf{v}_j \\;-\\; \\mathbf{v}_i,  \\text{if } |\\mathcal{N}_i|  0 \\\\\n\\mathbf{0},  \\text{if } |\\mathcal{N}_i| = 0\n\\end{cases}\n$$\n- 内聚：\n$$\n\\mathbf{C}_i = \n\\begin{cases}\n\\displaystyle \\frac{1}{|\\mathcal{N}_i|}\\sum_{j \\in \\mathcal{N}_i} \\mathbf{x}_j \\;-\\; \\mathbf{x}_i,  \\text{if } |\\mathcal{N}_i|  0 \\\\\n\\mathbf{0},  \\text{if } |\\mathcal{N}_i| = 0\n\\end{cases}\n$$\n- 分离 (带有一个小的平滑参数 $\\varepsilon  0$):\n$$\n\\mathbf{S}_i = \\sum_{j \\in \\mathcal{N}_i} \\frac{\\mathbf{x}_i - \\mathbf{x}_j}{\\|\\mathbf{x}_i - \\mathbf{x}_j\\|^2 + \\varepsilon}.\n$$\n\n将更新后的群体极化定义为\n$$\nP(\\alpha,\\beta,\\gamma) = \\frac{\\left\\| \\sum_{i=1}^N \\mathbf{v}_i' \\right\\|}{\\sum_{i=1}^N \\|\\mathbf{v}_i'\\| + \\varepsilon_P},\n$$\n其中 $\\varepsilon_P$ 是一个确保数值稳定性的小的正常数。使用 softplus 函数 $\\operatorname{softplus}(z) = \\log(1 + e^{z})$ 为最小间距 $d_{\\min}  0$ 定义一个平滑碰撞惩罚：\n$$\n\\Phi(\\alpha,\\beta,\\gamma) = \\sum_{1 \\le i  j \\le N} \\operatorname{softplus}\\left(d_{\\min} - \\|\\mathbf{x}_i' - \\mathbf{x}_j'\\|\\right).\n$$\n\n设总体目标为\n$$\nJ(\\alpha,\\beta,\\gamma) = \\lambda_{\\text{pol}}\\left(1 - P(\\alpha,\\beta,\\gamma)\\right) + \\lambda_{\\text{col}}\\,\\Phi(\\alpha,\\beta,\\gamma),\n$$\n其中 $\\lambda_{\\text{pol}}$ 和 $\\lambda_{\\text{col}}$ 是固定的正权重。在本问题中，假设以下为固定的常数和初始条件（下面所有的数值都已指定，必须完全按照给定的值使用）：\n- 智能体数量: $N = 6$。\n- 时间步长: $\\Delta t = 0.1$。\n- 邻域半径: $R = 1.2$。\n- 平滑参数: $\\varepsilon = 10^{-3}$ 和 $\\varepsilon_P = 10^{-12}$。\n- 碰撞最小间距: $d_{\\min} = 0.3$。\n- 目标权重: $\\lambda_{\\text{pol}} = 1.0$ 和 $\\lambda_{\\text{col}} = 2.0$。\n- 初始位置（每行为 $\\mathbf{x}_i$）:\n$$\n\\begin{bmatrix}\n0.0  0.0\\\\\n1.0  0.2\\\\\n2.0  -0.1\\\\\n0.5  1.0\\\\\n1.5  1.2\\\\\n2.5  0.9\n\\end{bmatrix}\n$$\n- 初始速度（每行为 $\\mathbf{v}_i$）:\n$$\n\\begin{bmatrix}\n0.5  0.0\\\\\n0.4  0.1\\\\\n0.3  -0.2\\\\\n0.0  0.5\\\\\n0.1  0.4\\\\\n-0.2  0.3\n\\end{bmatrix}\n$$\n\n任务：\n1. 从以上定义和基本运动学关系（$\\mathbf{x}_i' = \\mathbf{x}_i + \\Delta t\\,\\mathbf{v}_i'$）出发，推导目标 $J(\\alpha,\\beta,\\gamma)$ 如何通过更新依赖于 $(\\alpha,\\beta,\\gamma)$，并论证使用自动微分计算梯度 $\\nabla J(\\alpha,\\beta,\\gamma)$ 的计算方法的合理性。\n2. 实现一个完整、可运行的程序，使用反向模式或正向模式自动微分，为下面测试套件中的每个参数集计算梯度向量\n$$\n\\nabla J(\\alpha,\\beta,\\gamma) = \\left[\\frac{\\partial J}{\\partial \\alpha},\\; \\frac{\\partial J}{\\partial \\beta},\\; \\frac{\\partial J}{\\partial \\gamma}\\right]\n$$\n。您的自动微分必须精确地按照规定对 Boids 更新以及 $P(\\alpha,\\beta,\\gamma)$ 和 $\\Phi(\\alpha,\\beta,\\gamma)$ 的定义进行微分，不得使用有限差分。\n3. 讨论在给定目标 $J(\\alpha,\\beta,\\gamma)$ 和单步数据的情况下，$(\\alpha,\\beta,\\gamma)$ 的可辨识性，重点关注参数可能变得不可辨识或弱可辨识的条件。\n\n测试套件（为以下各项计算 $\\nabla J(\\alpha,\\beta,\\gamma)$）：\n- 案例 $1$: $(\\alpha,\\beta,\\gamma) = (0.8, 0.3, 0.05)$。\n- 案例 $2$: $(\\alpha,\\beta,\\gamma) = (0.0, 0.0, 0.0)$。\n- 案例 $3$: $(\\alpha,\\beta,\\gamma) = (0.0, 0.0, 5.0)$。\n- 案例 $4$: $(\\alpha,\\beta,\\gamma) = (10^{-6}, 10^{-6}, 10^{-6})$。\n\n最终输出规范：\n- 您的程序应生成单行输出，包含一个逗号分隔的 Python 风格嵌套列表形式的结果，其中每个梯度分量四舍五入到六位小数，格式如下\n$$\n[\\,[g_{\\alpha}^{(1)}, g_{\\beta}^{(1)}, g_{\\gamma}^{(1)}],\\,[g_{\\alpha}^{(2)}, g_{\\beta}^{(2)}, g_{\\gamma}^{(2)}],\\,[g_{\\alpha}^{(3)}, g_{\\beta}^{(3)}, g_{\\gamma}^{(3)}],\\,[g_{\\alpha}^{(4)}, g_{\\beta}^{(4)}, g_{\\gamma}^{(4)}]\\,]\n$$\n其中 $g_{\\alpha}^{(k)} = \\frac{\\partial J}{\\partial \\alpha}$，$g_{\\beta}^{(k)} = \\frac{\\partial J}{\\partial \\beta}$ 和 $g_{\\gamma}^{(k)} = \\frac{\\partial J}{\\partial \\gamma}$ 是在案例 $k$ 下计算的值。不涉及单位；所有输出均为无量纲的标量浮点数。",
            "solution": "此问题要求我们计算一个复合目标函数 $J(\\alpha, \\beta, \\gamma)$ 关于 Boids 模型参数的梯度。该过程可分为以下几个步骤：\n\n1.  **计算图的构建**: 目标函数 $J$ 是参数 $(\\alpha, \\beta, \\gamma)$ 的函数，其依赖关系通过 Boids 模型的一个时间步更新来建立。首先，更新后的速度 $\\mathbf{v}_i'$ 是参数的线性函数。接着，更新后的位置 $\\mathbf{x}_i'$ 也是参数的线性函数。最后，极化项 $P$ 和碰撞惩罚项 $\\Phi$ 是这些更新后状态的非线性函数，它们共同构成了 $J$。由于所有函数（线性运算、范数、softplus）都是可微的，因此可以使用链式法则计算 $J$ 的梯度。这种逐层构建的计算过程非常适合采用自动微分（AD）来精确计算梯度。\n\n2.  **前向传播**:\n    *   **预计算**: 对于给定的初始状态，交互项 $\\mathbf{A}_i$ (对齐), $\\mathbf{C}_i$ (内聚), 和 $\\mathbf{S}_i$ (分离) 是固定的向量。在计算梯度之前，可以首先计算并存储这些向量。\n    *   **状态更新**: 使用当前参数 $(\\alpha, \\beta, \\gamma)$，计算出更新后的速度 $\\mathbf{v}_i'$ 和位置 $\\mathbf{x}_i'$。\n\n3.  **梯度计算 (前向模式自动微分)**: 通过逐步累积导数来计算最终梯度 $\\nabla J$。\n    *   **速度和位置的梯度**: $\\mathbf{v}_i'$ 和 $\\mathbf{x}_i'$ 对参数的梯度 (雅可比矩阵) 被直接计算出来。例如，$\\frac{\\partial \\mathbf{v}_i'}{\\partial \\alpha} = \\mathbf{A}_i$。\n    *   **极化项梯度 $\\nabla P$**: 使用商式法则和链式法则计算。这涉及到计算 $\\sum_i \\mathbf{v}_i'$ 的范数的梯度和 $\\sum_i \\|\\mathbf{v}_i'\\|$ 的梯度。\n    *   **碰撞项梯度 $\\nabla \\Phi$**: 梯度是通过对所有智能体对 $(i,j)$ 的惩罚项求和得到的。每一项的梯度都通过链式法则计算，即对 softplus 函数、距离范数和位置 $\\mathbf{x}'$ 求导。$\\operatorname{softplus}(z)$ 的导数是 sigmoid 函数 $\\sigma(z)$。\n    *   **总梯度 $\\nabla J$**: 最终梯度是各部分梯度的加权和：$\\nabla J = -\\lambda_{\\text{pol}} \\nabla P + \\lambda_{\\text{col}} \\nabla \\Phi$。\n\n4.  **执行与输出**: 针对测试套件中的每一组 $(\\alpha, \\beta, \\gamma)$ 参数执行以上计算，得到相应的梯度向量。",
            "answer": "[[-3.229158,-1.940509,-2.434079],[-3.541452,-2.408470,-2.671047],[5.187841,13.911364,25.541012],[-3.541451,-2.408470,-2.671047]]"
        }
    ]
}