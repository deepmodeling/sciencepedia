{
    "hands_on_practices": [
        {
            "introduction": "在研究文化演化的驱动力之前，我们必须首先理解一个基准情形：在没有选择、偏见或突变的情况下，文化变异的频率会发生什么变化。这个随机过程被称为“文化漂变”，而赖特-费舍尔模型是理解它的基石。这个练习将通过推导一个中性文化变异的最终固定概率，来揭示随机复制过程的一个深刻而简洁的基本结果。",
            "id": "2699390",
            "problem": "考虑一个大小恒定为 $N$ 的有限种群，该种群在没有创新的情况下，根据用于文化传播的 Wright–Fisher 复制模型进行演化。时间是离散的，由 $t \\in \\{0,1,2,\\dots\\}$ 索引，每一代 $t+1$ 都是通过从第 $t$ 代中有放回地抽样 $N$ 个文化亲本形成的，每次抽样都从第 $t$ 代的 $N$ 个个体中均匀选择一个亲本。存在两种文化变体，记为 $A$ 和 $B$。设 $X_t \\in \\{0,1,\\dots,N\\}$ 为第 $t$ 代中 $A$ 变体携带者的数量，并设 $x_t = X_t/N$ 为其对应的频率。假设中性和无创新：在每次抽样中，亲本都是独立且均匀地选择的，因此在 $X_t=i$ 的条件下，$X_{t+1}$ 的分布是 $\\mathrm{Binomial}(N, i/N)$。\n\n定义固定概率 $\\phi(i;N)$ 为变体 $A$ 从初始状态 $X_0=i$ 出发，最终达到频率 $1$（即 $X_t$ 到达吸收态 $N$）的概率。等价地，用 $x_0=i/N$ 定义 $\\phi(x_0;N)$。\n\n仅使用上述基本定义，推导固定概率 $\\phi(x_0;N)$ 作为初始频率 $x_0 \\in [0,1]$ 和种群大小 $N$ 的函数的闭式表达式。请将最终答案表示为单个解析表达式。无需四舍五入，也不涉及单位。",
            "solution": "该问题要求计算在一个大小为 $N$ 的有限种群中，一个中性文化变体在 Wright–Fisher 模型下演化时的固定概率。设 $X_t$ 为第 $t$ 代携带变体 $A$ 的个体数量，设 $x_t = X_t/N$ 为该变体的频率。该过程从初始数量 $X_0=i$ 开始，对应的初始频率为 $x_0 = i/N$。我们的任务是找到变体 $A$ 最终被固定的概率，即其频率达到 $1$ 的概率。该概率记为 $\\phi(x_0;N)$。\n\n该过程的状态空间为 $\\{0, 1, \\dots, N\\}$。状态 $0$ 和 $N$ 是吸收态，分别对应变体 $A$ 的丢失和固定。该过程根据转移规则演化，即在 $X_t=k$ 的条件下，下一代中 $A$ 变体携带者的数量 $X_{t+1}$ 服从二项分布：\n$$ X_{t+1} | (X_t = k) \\sim \\mathrm{Binomial}(N, k/N) $$\n\n解决此问题的一个直接而严谨的方法是分析频率过程 $\\{x_t\\}_{t \\geq 0}$ 的性质。我们将证明，在指定的中性模型下，该变体的频率是一个鞅。如果一个过程 $\\{Y_t\\}$ 满足 $\\mathbb{E}[Y_{t+1} | Y_t, Y_{t-1}, \\dots, Y_0] = Y_t$，那么它就是一个鞅。\n\n让我们计算在给定时间 $t$ 状态的情况下，$x_{t+1}$ 的条件期望。假设在时间 $t$，状态为 $X_t = i$。频率为 $x_t = i/N$。在时间 $t+1$ 时 $A$ 变体携带者的期望数量是一个 $\\mathrm{Binomial}(N, p=i/N)$ 随机变量的期望。二项分布 $\\mathrm{Binomial}(n,p)$ 的期望是 $np$。因此，\n$$ \\mathbb{E}[X_{t+1} | X_t = i] = N \\cdot \\left(\\frac{i}{N}\\right) = i $$\n现在我们可以求出时间 $t+1$ 的期望频率：\n$$ \\mathbb{E}[x_{t+1} | X_t = i] = \\mathbb{E}\\left[\\frac{X_{t+1}}{N} \\Big| X_t = i\\right] = \\frac{1}{N} \\mathbb{E}[X_{t+1} | X_t = i] = \\frac{i}{N} $$\n因为我们定义了 $x_t = i/N$，这表明 $\\mathbb{E}[x_{t+1} | x_t] = x_t$。这个等式证实了频率过程 $\\{x_t\\}$ 是一个鞅。\n\n当过程达到吸收边界之一时，即 $x_t=0$（丢失）或 $x_t=1$（固定）时，过程停止。设 $T$ 为此过程的停时，定义为：\n$$ T = \\inf\\{t \\geq 0 : x_t = 0 \\text{ or } x_t = 1\\} $$\n对于有限种群 $N$，最终必被这些状态之一吸收，这意味着停时 $T$ 几乎必然是有限的。鞅 $\\{x_t\\}$ 是有界的，因为其值始终在区间 $[0,1]$ 内。\n\n这些条件——有界鞅和几乎必然有限的停时——使我们能够应用可选停止定理。该定理指出，鞅在停时的期望值等于其初始值：\n$$ \\mathbb{E}[x_T] = x_0 $$\n过程在停时 $x_T$ 的值是一个随机变量，只能取两个值之一：如果变体 $A$ 固定，则为 $1$；如果丢失，则为 $0$。固定的概率正是我们要找的 $\\phi(x_0;N)$。因此，\n$$ P(x_T = 1) = \\phi(x_0;N) $$\n而丢失的概率是：\n$$ P(x_T = 0) = 1 - \\phi(x_0;N) $$\n期望 $\\mathbb{E}[x_T]$ 可以根据其定义计算：\n$$ \\mathbb{E}[x_T] = (1) \\cdot P(x_T = 1) + (0) \\cdot P(x_T = 0) = 1 \\cdot \\phi(x_0;N) + 0 \\cdot (1 - \\phi(x_0;N)) = \\phi(x_0;N) $$\n通过令 $\\mathbb{E}[x_T]$ 的两个表达式相等，我们得到最终结果：\n$$ \\phi(x_0;N) = x_0 $$\n这个结果展示了群体遗传学的一个基本原理：在没有选择、突变或迁移的情况下，一个中性等位基因或文化变体最终在种群中固定的概率等于其初始频率。该结果与种群大小 $N$ 无关。给定初始频率 $x_0 = i/N$，固定概率就是 $i/N$。",
            "answer": "$$\\boxed{x_{0}}$$"
        },
        {
            "introduction": "文化演化很少是完全中性的，个体在学习时往往会表现出各种偏见。“从众偏见”，即不成比例地模仿多数人的行为，是一种强大且心理上合理的学习策略。本练习探讨了这种简单的个体学习规则如何产生复杂的群体动态，通过分析一个非线性动力系统的不动点及其稳定性，你将发现从众如何导致文化趋同和多样化共存。",
            "id": "2699333",
            "problem": "一个大的、充分混合的种群携带两种相互排斥的文化变体，标记为 $A$ 和 $B$。令 $q \\in [0,1]$ 表示变体 $A$ 的种群频率。社会传播发生在离散的、不重叠的学习轮次中，每个学习者以如下概率采纳 $A$：\n$$\nP(C \\mid q) \\;=\\; \\frac{q^{s}}{q^{s} + (1 - q)^{s}},\n$$\n其中 $s > 0$ 是参数，表示从众偏见的强度。假设种群足够大以忽略漂变，并且在每一轮中，频率根据映射 $q_{t+1} = P(C \\mid q_t)$ 进行确定性更新。仅使用一维离散时间动力系统的基本原理和发生比的基本性质。\n\n任务：\n- 对于 $s > 1$ 的情况，通过推导一个条件来建立正频率依赖性，该条件表明采纳概率偏向多数派，即当 $q > \\tfrac{1}{2}$ 时 $P(C \\mid q) > q$ 且当 $q  \\tfrac{1}{2}$ 时 $P(C \\mid q)  q$。\n- 识别内部不动点 $q^{\\ast} \\in (0,1)$，并通过计算在 $q^{\\ast}$ 处的雅可比特征值（更新映射的斜率）来确定其局部稳定性，该特征值是 $s$ 的函数。\n\n答案规格：\n- 最终答案请提供内部不动点处雅可比特征值作为 $s$ 的函数的精确解析表达式。\n- 不包括任何单位。",
            "solution": "该问题描述了一个关于文化变体 $A$ 频率 $q$ 的一维离散时间动力系统。假设种群足够大，频率的更新是确定性的。更新映射给出了下一代的频率 $q_{t+1}$ 作为当前频率 $q_t$ 的函数，该映射由采纳变体 $A$ 的概率给出。让我们将此函数定义为 $f(q)$：\n$$\nq_{t+1} = f(q_t) = \\frac{q_t^s}{q_t^s + (1 - q_t)^s}\n$$\n其中 $q_t \\in [0, 1]$ 且参数 $s  0$ 表示从众偏见的强度。我们的分析将依赖于此函数 $f(q)$ 的性质。\n\n第一个任务是证明当 $s  1$ 时，动力学表现出正频率依赖性。这意味着在种群中更常见的文化传播变体有更高的被采纳概率。具体来说，我们必须证明当 $q  \\frac{1}{2}$ 时 $f(q)  q$ 且当 $q  \\frac{1}{2}$ 时 $f(q)  q$。问题建议使用发生比。\n\n令种群中变体 $A$ 的发生比定义为 $O_q = \\frac{q}{1-q}$。相应地，采纳变体 $A$ 的发生比由 $\\frac{f(q)}{1-f(q)}$ 给出。我们计算这个量：\n$$\n1 - f(q) = 1 - \\frac{q^s}{q^s + (1-q)^s} = \\frac{q^s + (1-q)^s - q^s}{q^s + (1-q)^s} = \\frac{(1-q)^s}{q^s + (1-q)^s}\n$$\n因此，采纳的发生比为：\n$$\n\\frac{f(q)}{1-f(q)} = \\frac{\\frac{q^s}{q^s + (1-q)^s}}{\\frac{(1-q)^s}{q^s + (1-q)^s}} = \\frac{q^s}{(1-q)^s} = \\left(\\frac{q}{1-q}\\right)^s = O_q^s\n$$\n对于 $q \\in (0,1)$，条件 $f(q) > q$ 等价于条件 $\\frac{f(q)}{1-f(q)} > \\frac{q}{1-q}$，因为函数 $g(x) = \\frac{x}{1-x}$ 在区间 $(0,1)$ 上是严格递增的。这意味着我们必须分析不等式 $O_q^s > O_q$。\n\n令 $x = O_q$。我们关心的是不等式 $x^s > x$。\n如果 $q > \\frac{1}{2}$，则 $q > 1-q$，这意味着 $x = \\frac{q}{1-q} > 1$。对于 $x > 1$ 和给定的指数 $s > 1$，一个基本性质是 $x^s > x$。因此，对于 $s > 1$ 和 $q > \\frac{1}{2}$，我们有 $O_q^s > O_q$，这证明了 $f(q) > q$。\n如果 $q  \\frac{1}{2}$，则 $q  1-q$，这意味着 $0  x = \\frac{q}{1-q}  1$。对于 $0  x  1$ 和指数 $s > 1$，一个基本性质是 $x^s  x$。因此，对于 $s > 1$ 和 $q  \\frac{1}{2}$，我们有 $O_q^s  O_q$，这证明了 $f(q)  q$。\n这就完成了对 $s > 1$ 时正频率依赖性的证明。\n\n第二个任务是识别内部不动点 $q^* \\in (0,1)$，并通过计算该点处的雅可比特征值来确定其局部稳定性。一个不动点 $q^*$ 满足方程 $f(q^*) = q^*$。\n使用我们的发生比公式，这等价于 $O_{q^*}^s = O_{q^*}$。这个方程可以写成 $O_{q^*}^s - O_{q^*} = 0$，或 $O_{q^*} (O_{q^*}^{s-1} - 1) = 0$。\n对于一个内部不动点 $q^* \\in (0,1)$，其发生比 $O_{q^*}$ 必须为正，因此我们必须有 $O_{q^*}^{s-1} - 1 = 0$，即 $O_{q^*}^{s-1} = 1$。\n只要 $s \\neq 1$，唯一的正实数解是 $O_{q^*} = 1$。\n条件 $O_{q^*} = 1$ 意味着 $\\frac{q^*}{1-q^*} = 1$，解得 $q^* = 1 - q^*$，即 $2q^* = 1$。\n因此，唯一的内部不动点是 $q^* = \\frac{1}{2}$。这个不动点对所有 $s > 0$ 都存在。\n\n为了确定这个不动点的稳定性，我们必须计算雅可比特征值，对于一维映射，这即为更新函数在不动点 $q^* = \\frac{1}{2}$ 处的导数 $\\lambda = f'(q)$。\n我们来计算导数 $f'(q)$。一个方便的方法是利用表达式 $f(q)(1-f(q)) = \\frac{q^s(1-q)^s}{(q^s+(1-q)^s)^2}$ 和关系式 $\\frac{d}{dq}\\ln(O_q) = \\frac{1}{q(1-q)}$。由于 $\\ln(O_{f(q)}) = s \\ln(O_q)$，对 $q$ 求导得出 $\\frac{f'(q)}{f(q)(1-f(q))} = \\frac{s}{q(1-q)}$。\n由此，我们得到导数：\n$$\nf'(q) = \\frac{s \\cdot f(q)(1-f(q))}{q(1-q)}\n$$\n现在，我们在不动点 $q^* = \\frac{1}{2}$ 处计算这个表达式的值。在该点，我们知道 $f(\\frac{1}{2}) = \\frac{1}{2}$。\n代入这些值：\n$$\n\\lambda = f'\\left(\\frac{1}{2}\\right) = \\frac{s \\cdot f(\\frac{1}{2})(1-f(\\frac{1}{2}))}{\\frac{1}{2}(1-\\frac{1}{2})} = \\frac{s \\cdot \\frac{1}{2}(\\frac{1}{2})}{\\frac{1}{4}} = \\frac{s \\cdot \\frac{1}{4}}{\\frac{1}{4}}\n$$\n这可以简化为：\n$$\n\\lambda = s\n$$\n因此，在内部不动点 $q^* = \\frac{1}{2}$ 处的雅可比特征值等于参数 $s$。这个不动点的稳定性取决于 $s$ 的值：当 $0  s  1$ 时它是稳定的（因为 $\\lambda  1$），当 $s > 1$ 时它是不稳定的（因为 $\\lambda > 1$），这与我们对从众和反从众动力学的分析是一致的。然而，问题只要求给出特征值本身的表达式。",
            "answer": "$$\n\\boxed{s}\n$$"
        },
        {
            "introduction": "理论模型为我们提供了洞见，但分析真实的文化变迁数据则需要更普适的工具。普莱斯方程是演化生物学中的一个基本框架，它能将观察到的群体平均性状变化精确地分解为“选择”和“传播”两个部分。本练习将让你亲手应用这一强大的分析工具，通过计算一个给定的数据集，你将学会如何从个体层面的数据中量化选择压力和传播偏见各自对文化演化的贡献。",
            "id": "2699362",
            "problem": "给定多种群中单个代际步骤的个体层面文化数据，该种群包含一组文化模型（父代）和一组学习者。每个学习者选择一个模型进行学习，并获得一个可能经过修改的特征值。您的任务是计算种群层面文化变迁的两个分量，这两个分量将平均特征值的变化分解为一个可归因于文化选择（模型的差异化影响）的分量和一个可归因于传递偏差（学习过程中谱系内的系统性变化）的分量。\n\n基本原理与定义：\n- 设有 $N$ 个模型，索引为 $i \\in \\{1,\\dots,N\\}$，每个模型具有特征值 $z_i \\in \\mathbb{R}$。设平均模型特征为 $\\bar{z} = \\frac{1}{N} \\sum_{i=1}^N z_i$。\n- 设有 $M$ 个学习者，索引为 $j \\in \\{1,\\dots,M\\}$。每个学习者 $j$ 只选择一个模型 $m(j) \\in \\{1,\\dots,N\\}$，并在学习后获得特征 $z'_j \\in \\mathbb{R}$。\n- 模型 $i$ 的文化影响力（学习者数量）为 $w_i = \\left| \\{ j : m(j) = i \\} \\right|$。平均影响力为 $\\bar{w} = \\frac{1}{N} \\sum_{i=1}^N w_i$。请注意，$\\sum_{i=1}^N w_i = M$ 意味着 $\\bar{w} = M / N$。\n- 定义每个模型的学习者平均值 $\\mu_i$ 如下：如果 $w_i  0$，则 $\\mu_i = \\frac{1}{w_i} \\sum_{j : m(j) = i} z'_j$；如果 $w_i = 0$，则采用约定 $\\mu_i = z_i$，这样 $\\mu_i - z_i = 0$ 对传递偏差没有贡献。\n\n您的程序必须为每个提供的数据集计算：\n1. 文化选择协方差项 $S$，定义为相对影响力和模型特征之间的协方差，\n$$\nS \\equiv \\operatorname{Cov}\\!\\left(\\frac{w_i}{\\bar{w}}, z_i\\right) \\;=\\; \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}} - 1\\right)\\left(z_i - \\bar{z}\\right).\n$$\n2. 传递偏差项 $T$，定义为由相对影响力加权的谱系内预期变化，\n$$\nT \\equiv \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right)\\left(\\mu_i - z_i\\right).\n$$\n3. 跨代际步骤的平均特征总变化，\n$$\n\\Delta \\bar{z} \\equiv \\left(\\frac{1}{M}\\sum_{j=1}^M z'_j\\right) - \\bar{z}.\n$$\n4. 一个指示哪个分量大小更大的判别代码。设 $\\varepsilon = 10^{-9}$。定义\n$$\nd \\equiv \\left|S\\right| - \\left|T\\right|.\n$$\n为每个数据集返回一个整数代码，规则如下：如果 $d  \\varepsilon$，返回 $1$（选择分量的大小超过传递分量）；如果 $d  -\\varepsilon$，返回 $-1$（传递分量的大小超过选择分量）；否则返回 $0$（在容差范围内，二者大小相当）。\n\n每个数据集的输入规范：\n- $N$ 和模型特征向量 $\\mathbf{z} = [z_1,\\dots,z_N]$。\n- 学习者到模型的索引向量 $\\mathbf{m} = [m(1),\\dots,m(M)]$，使用从零开始的索引，范围在 $\\{0,\\dots,N-1\\}$。\n- 学习后的学习者特征向量 $\\mathbf{z}' = [z'_1,\\dots,z'_M]$。\n所有量均为无量纲实数。\n\n测试套件：\n为以下四个数据集提供结果。$\\mathbf{m}$ 中的索引是从零开始的。\n\n- 数据集 A:\n  - $N = 4$。\n  - $\\mathbf{z} = [0.0, 1.0, 2.0, 3.0]$。\n  - $\\mathbf{m} = [0, 1, 1, 2, 2, 3, 3, 3, 3, 3]$。\n  - $\\mathbf{z}' = [0.2, 1.0, 1.0, 1.9, 1.9, 2.8, 2.8, 2.8, 2.9, 2.9]$。\n\n- 数据集 B:\n  - $N = 3$。\n  - $\\mathbf{z} = [1.0, 2.0, 3.0]$。\n  - $\\mathbf{m} = [0, 0, 1, 1, 2, 2]$。\n  - $\\mathbf{z}' = [1.3, 1.3, 2.0, 2.0, 2.8, 2.8]$。\n\n- 数据集 C:\n  - $N = 3$。\n  - $\\mathbf{z} = [0.0, 1.0, 3.0]$。\n  - $\\mathbf{m} = [0, 1, 1, 2, 2, 2]$。\n  - $\\mathbf{z}' = [0.0, 1.0, 1.0, 3.0, 3.0, 3.0]$。\n\n- 数据集 D:\n  - $N = 4$。\n  - $\\mathbf{z} = [1.0, 2.0, 3.0, 4.0]$。\n  - $\\mathbf{m} = [1, 2, 3, 3]$。\n  - $\\mathbf{z}' = [1.9, 3.2, 3.7, 3.9]$。\n\n输出规范：\n- 对于每个数据集，输出一个形式为 $[S, T, \\Delta\\bar{z}, \\text{code}]$ 的列表，其中 $S$、$T$ 和 $\\Delta\\bar{z}$ 是四舍五入到六位小数的浮点数，$\\text{code}$ 是如上定义的整数。\n- 您的程序应生成单行输出，其中包含所有数据集的结果，形式为方括号括起来的、由这些列表组成的逗号分隔列表。例如，输出格式必须是\n$[[S_A,T_A,\\Delta\\bar{z}_A,\\text{code}_A],[S_B,T_B,\\Delta\\bar{z}_B,\\text{code}_B],[S_C,T_C,\\Delta\\bar{z}_C,\\text{code}_C],[S_D,T_D,\\Delta\\bar{z}_D,\\text{code}_D]]$\n并应用了所需的四舍五入。",
            "solution": "所述问题已经过严格验证。该问题被认为是一个有效、适定且具有科学依据的练习。所要求的定义和计算是Price方程框架的直接应用，该框架是演化分析的基石，并被改编用于文化演化研究。所有术语都经过数学上的精确定义，提供的数据是自洽的，目标是明确的。不存在逻辑矛盾或事实错误。我们将着手推导解决方案。\n\n核心任务是将种群平均特征值的总变化 $\\Delta\\bar{z}$ 分解为两个分量：一个选择分量 $S$ 和一个传递偏差分量 $T$。问题为这三个量提供了定义。一个基本的检验是一致性，即证明总变化实际上是这两个分量的和，即 $\\Delta\\bar{z} = S + T$。这个恒等式构成了我们分析的基础。\n\n让我们从提供的定义开始。$N$ 个模型的平均特征是 $\\bar{z} = \\frac{1}{N} \\sum_{i=1}^N z_i$。下一代 $M$ 个学习者的平均特征是 $\\bar{z}' = \\frac{1}{M}\\sum_{j=1}^M z'_j$。总变化为 $\\Delta\\bar{z} = \\bar{z}' - \\bar{z}$。\n\n我们可以通过根据学习者选择的模型 $m(j)$ 对学习者进行分组来表达 $\\bar{z}'$。选择模型 $i$ 的学习者数量是其影响力 $w_i$。选择模型 $i$ 的学习者的特征值之和是 $\\sum_{j : m(j) = i} z'_j$。根据定义，对于 $w_i  0$，每个模型的学习者平均值为 $\\mu_i = \\frac{1}{w_i} \\sum_{j : m(j) = i} z'_j$。因此，$\\sum_{j : m(j) = i} z'_j = w_i \\mu_i$。即使对于 $w_i=0$ 的情况，这个关系也成立，因为两边都为零。学习者特征的总和是 $\\sum_{j=1}^M z'_j = \\sum_{i=1}^N \\sum_{j : m(j) = i} z'_j = \\sum_{i=1}^N w_i \\mu_i$。\n\n将此代入 $\\bar{z}'$ 的表达式中：\n$$\n\\bar{z}' = \\frac{1}{M} \\sum_{i=1}^N w_i \\mu_i\n$$\n平均影响力为 $\\bar{w} = \\sum_{i=1}^N w_i / N = M/N$。因此，$M = N\\bar{w}$。将此代入 $M$：\n$$\n\\bar{z}' = \\frac{1}{N\\bar{w}} \\sum_{i=1}^N w_i \\mu_i = \\frac{1}{N} \\sum_{i=1}^N \\frac{w_i}{\\bar{w}} \\mu_i\n$$\n现在，我们可以将总变化 $\\Delta\\bar{z}$ 写为：\n$$\n\\Delta\\bar{z} = \\bar{z}' - \\bar{z} = \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) \\mu_i - \\bar{z}\n$$\n为了分解这个变化，我们通过加上和减去 $\\frac{1}{N} \\sum_{i=1}^N (\\frac{w_i}{\\bar{w}}) z_i$ 来引入这一项：\n$$\n\\Delta\\bar{z} = \\left( \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) \\mu_i - \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) z_i \\right) + \\left( \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) z_i - \\bar{z} \\right)\n$$\n让我们分析这两个括号中的项。第一项可以写为：\n$$\n\\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) (\\mu_i - z_i)\n$$\n这正是传递偏差项 $T$ 的定义。它表示从模型到学习者的平均特征值变化，按每个模型的相对影响力加权。当 $w_i = 0$ 时，约定 $\\mu_i = z_i$ 确保没有学习者的模型对该项没有贡献。\n\n第二项可以被识别为相对影响力 $\\frac{w_i}{\\bar{w}}$ 和模型特征 $z_i$ 之间的协方差。模型种群上变量 $X_i$ 的期望是 $E[X] = \\frac{1}{N}\\sum_{i=1}^N X_i$。协方差是 $\\operatorname{Cov}(X, Y) = E[(X-E[X])(Y-E[Y])]$。\n令 $X_i = \\frac{w_i}{\\bar{w}}$ 和 $Y_i = z_i$。则 $E[Y] = \\bar{z}$。$X_i$ 的期望是 $E[X] = \\frac{1}{N}\\sum_{i=1}^N \\frac{w_i}{\\bar{w}} = \\frac{1}{N\\bar{w}}\\sum_{i=1}^N w_i = \\frac{M}{N(M/N)} = 1$。\n第二项是 $E[XY] - \\bar{z} = E[XY] - E[X]E[Y]$，也就是 $\\operatorname{Cov}(X,Y)$。展开它得到：\n$$\n\\operatorname{Cov}\\left(\\frac{w_i}{\\bar{w}}, z_i\\right) = \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}} - 1\\right) (z_i - \\bar{z})\n$$\n这正是文化选择项 $S$ 的定义。它衡量了模型的特征值与其文化影响力之间的统计关联。\n\n因此，我们证明了恒等式 $\\Delta\\bar{z} = S + T$。总变化被完美地分解了。计算步骤如下：\n\n对于每个数据集（$N$、$\\mathbf{z}$、$\\mathbf{m}$、$\\mathbf{z}'$）：\n1.  计算平均模型特征 $\\bar{z} = \\frac{1}{N}\\sum z_i$。\n2.  从 $\\mathbf{m}$ 的长度确定学习者数量 $M$。\n3.  计算影响力向量 $\\mathbf{w}$，其中 $w_i$ 是模型索引 $i$ 在 $\\mathbf{m}$ 中出现的次数。$\\mathbf{m}$ 中的索引是从零开始的，为 $\\{0, \\dots, N-1\\}$。\n4.  计算平均影响力 $\\bar{w} = M/N$。\n5.  确定每个模型的学习者平均值向量 $\\boldsymbol{\\mu}$。对于每个模型 $i$，如果 $w_i > 0$，则 $\\mu_i$ 是所有选择模型 $i$ 的学习者 $j$ 的 $z'_j$ 的平均值。如果 $w_i = 0$，则将 $\\mu_i$ 设置为 $z_i$。\n6.  计算选择项 $S = \\frac{1}{N}\\sum_{i=0}^{N-1} (\\frac{w_i}{\\bar{w}} - 1)(z_i - \\bar{z})$。\n7.  计算传递偏差项 $T = \\frac{1}{N}\\sum_{i=0}^{N-1} (\\frac{w_i}{\\bar{w}})(\\mu_i - z_i)$。\n8.  计算总变化 $\\Delta\\bar{z} = (\\frac{1}{M}\\sum z'_j) - \\bar{z}$。作为验证，必须确认 $S + T$ 近似等于 $\\Delta\\bar{z}$。\n9.  计算大小差异 $d = |S| - |T|$，并根据给定的容差 $\\varepsilon = 10^{-9}$ 确定判别代码。如果 $d > \\varepsilon$，代码为 $1$；如果 $d  -\\varepsilon$，代码为 $-1$；否则，代码为 $0$。\n10. 将结果格式化为列表 $[S, T, \\Delta\\bar{z}, \\text{code}]$，浮点数四舍五入到六位小数。\n\n此算法将被实现以处理提供的测试套件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the cultural evolution problem for all given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Dataset A\n        {\n            \"N\": 4,\n            \"z_models\": [0.0, 1.0, 2.0, 3.0],\n            \"m_learners\": [0, 1, 1, 2, 2, 3, 3, 3, 3, 3],\n            \"z_prime_learners\": [0.2, 1.0, 1.0, 1.9, 1.9, 2.8, 2.8, 2.8, 2.9, 2.9],\n        },\n        # Dataset B\n        {\n            \"N\": 3,\n            \"z_models\": [1.0, 2.0, 3.0],\n            \"m_learners\": [0, 0, 1, 1, 2, 2],\n            \"z_prime_learners\": [1.3, 1.3, 2.0, 2.0, 2.8, 2.8],\n        },\n        # Dataset C\n        {\n            \"N\": 3,\n            \"z_models\": [0.0, 1.0, 3.0],\n            \"m_learners\": [0, 1, 1, 2, 2, 2],\n            \"z_prime_learners\": [0.0, 1.0, 1.0, 3.0, 3.0, 3.0],\n        },\n        # Dataset D\n        {\n            \"N\": 4,\n            \"z_models\": [1.0, 2.0, 3.0, 4.0],\n            \"m_learners\": [1, 2, 3, 3],\n            \"z_prime_learners\": [1.9, 3.2, 3.7, 3.9],\n        },\n    ]\n\n    results_str_list = []\n    for case in test_cases:\n        s, t, delta_z, code = calculate_components(\n            case[\"N\"],\n            case[\"z_models\"],\n            case[\"m_learners\"],\n            case[\"z_prime_learners\"]\n        )\n        \n        # Format the output for the current case\n        s_str = f\"{s:.6f}\"\n        t_str = f\"{t:.6f}\"\n        delta_z_str = f\"{delta_z:.6f}\"\n        \n        result_str = f\"[{s_str},{t_str},{delta_z_str},{code}]\"\n        results_str_list.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str_list)}]\")\n\ndef calculate_components(N_models, z_models_list, m_learners_list, z_prime_learners_list):\n    \"\"\"\n    Computes S, T, delta_z, and the interpretation code for a single dataset.\n    \"\"\"\n    \n    # Convert lists to numpy arrays for vectorized operations\n    z_models = np.array(z_models_list, dtype=float)\n    m_learners = np.array(m_learners_list, dtype=int)\n    z_prime_learners = np.array(z_prime_learners_list, dtype=float)\n    \n    # Number of learners\n    M_learners = len(m_learners)\n\n    # 1. Compute model-level quantities\n    z_bar = np.mean(z_models)\n\n    # 2. Compute learner-level and linking quantities\n    # Influence of each model (number of learners choosing each model)\n    w = np.bincount(m_learners, minlength=N_models)\n    \n    # Mean influence\n    if N_models > 0:\n        w_bar = M_learners / N_models\n    else:\n        w_bar = 0\n\n    # 3. Calculate per-model learner mean mu\n    mu = np.zeros(N_models, dtype=float)\n    for i in range(N_models):\n        if w[i] > 0:\n            learners_of_model_i = z_prime_learners[m_learners == i]\n            mu[i] = np.mean(learners_of_model_i)\n        else:\n            # Convention: if w_i = 0, mu_i = z_i\n            mu[i] = z_models[i]\n\n    # Handle case where all models have zero influence\n    if w_bar == 0:\n        rel_w = np.zeros(N_models, dtype=float)\n    else:\n        rel_w = w / w_bar\n\n    # 4. Calculate S (Selection)\n    # S = (1/N) * sum((w_i/w_bar - 1) * (z_i - z_bar))\n    s_term_per_model = (rel_w - 1) * (z_models - z_bar)\n    S = np.mean(s_term_per_model)\n\n    # 5. Calculate T (Transmission)\n    # T = (1/N) * sum((w_i/w_bar) * (mu_i - z_i))\n    t_term_per_model = rel_w * (mu - z_models)\n    T = np.mean(t_term_per_model)\n\n    # 6. Calculate Delta z_bar (Total Change)\n    if M_learners > 0:\n        z_prime_bar = np.mean(z_prime_learners)\n    else:\n        z_prime_bar = z_bar # No learners, no change\n    delta_z_bar = z_prime_bar - z_bar\n\n    # 7. Calculate the interpretation code\n    epsilon = 1e-9\n    d = abs(S) - abs(T)\n    if d > epsilon:\n        code = 1\n    elif d  -epsilon:\n        code = -1\n    else:\n        code = 0\n        \n    return S, T, delta_z_bar, code\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}