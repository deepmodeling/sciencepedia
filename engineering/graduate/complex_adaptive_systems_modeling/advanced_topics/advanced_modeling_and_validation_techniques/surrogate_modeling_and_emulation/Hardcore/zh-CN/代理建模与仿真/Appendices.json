{
    "hands_on_practices": [
        {
            "introduction": "构建可靠代理模型的第一步是正确处理来自原始复杂系统模拟器数据中的噪声。本练习深入探讨高斯过程回归的核心，推导当观测数据含有噪声时的后验预测分布。掌握这个推导过程  对于理解高斯过程模拟器如何将潜在函数与测量误差分离开来至关重要，这也是准确量化不确定性的基础。",
            "id": "4145539",
            "problem": "一个研究团队正在为一个用于复杂适应性系统（CAS）建模的随机基于代理的模拟器构建一个代理模型。设未知响应函数由一个高斯过程（GP）先验建模，具体为一个均值函数为 $m(x)$、协方差函数为 $k(x, x')$ 的高斯过程（GP），记为 $f(\\cdot) \\sim \\text{GP}(m(\\cdot), k(\\cdot, \\cdot))$。该模拟器在输入 $x_i$ 处返回带噪声的观测值 $y_i$，其观测模型为 $y_i = f(x_i) + \\epsilon_i$，其中 $\\epsilon_i$ 是独立同分布（i.i.d.）的高斯噪声，方差为 $\\tau^2$，即对 $i = 1, \\dots, n$ 有 $\\epsilon_i \\sim \\mathcal{N}(0, \\tau^2)$ 且相互独立。假设 $\\tau^2$ 已知。\n\n定义训练输入 $X = [x_1, \\dots, x_n]$，训练输出 $y = [y_1, \\dots, y_n]^\\top$，均值向量 $m = [m(x_1), \\dots, m(x_n)]^\\top$，格拉姆矩阵 $K \\in \\mathbb{R}^{n \\times n}$ 其元素为 $K_{ij} = k(x_i, x_j)$，交叉协方差向量 $k_* = [k(x_1, x_*), \\dots, k(x_n, x_*)]^\\top$，以及在测试输入 $x_*$ 处的先验方差为 $k_{**} = k(x_*, x_*)$。\n\n仅使用高斯过程的定义、多元高斯分布的性质以及高斯随机变量的基本贝叶斯条件化，确定在新输入 $x_*$ 处的带噪声观测值 $y_*$ 的后验预测分布。然后，定性和定量地解释与无噪声情况相比，观测噪声方差 $\\tau^2$ 如何改变预测方差。\n\n选择正确指定后验预测分布 $p(y_* \\mid x_*, X, y)$ 并准确解释 $\\tau^2$ 在预测方差中作用的选项。\n\nA. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top (K + \\tau^2 I)^{-1} (y - m)$，方差为 $k_{**} - k_*^\\top (K + \\tau^2 I)^{-1} k_* + \\tau^2$。方差通过两种方式增加：$\\tau^2$ 作为 $x_*$ 处的观测噪声以加法形式出现，而 $(K + \\tau^2 I)^{-1}$ 中的 $\\tau^2$ 降低了数据的杠杆作用（缩小了减去项），从而增大了潜在的预测不确定性。\n\nB. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top (K + \\tau^2 I)^{-1} (y - m)$，方差为 $k_{**} - k_*^\\top (K + \\tau^2 I)^{-1} k_*$。在预测时，方差不受 $\\tau^2$ 的影响，因为噪声在训练中已经被考虑。\n\nC. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top (K + \\tau^2 I)^{-1} (y - m)$，方差为 $k_{**} + \\tau^2 - k_*^\\top K^{-1} k_*$。$\\tau^2$ 的作用仅仅是将先验方差增加 $\\tau^2$，而没有改变数据如何减少不确定性。\n\nD. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top K^{-1} (y - m)$，方差为 $k_{**} + \\tau^2$。方差简单地等于先验方差加上噪声，与训练数据无关，因为观测噪声冲掉了所有获得的信息。",
            "solution": "首先将验证问题陈述的科学合理性、完整性和清晰性。\n\n### 第一步：提取已知条件\n- 未知函数 $f(\\cdot)$ 由一个高斯过程先验建模：$f(\\cdot) \\sim \\text{GP}(m(\\cdot), k(\\cdot, \\cdot))$。\n- 均值函数为 $m(x)$。\n- 协方差函数为 $k(x, x')$。\n- 观测模型为 $y_i = f(x_i) + \\epsilon_i$，对于 $i = 1, \\dots, n$。\n- 观测噪声为 $\\epsilon_i \\sim \\mathcal{N}(0, \\tau^2)$，独立同分布。\n- 噪声方差 $\\tau^2$ 已知。\n- 训练输入：$X = [x_1, \\dots, x_n]$。\n- 训练输出：$y = [y_1, \\dots, y_n]^\\top$。\n- 训练输入处的均值向量：$m = [m(x_1), \\dots, m(x_n)]^\\top$。\n- 格拉姆矩阵：$K \\in \\mathbb{R}^{n \\times n}$，其中 $K_{ij} = k(x_i, x_j)$。\n- 交叉协方差向量：对于新输入 $x_*$，$k_* = [k(x_1, x_*), \\dots, k(x_n, x_*)]^\\top$。\n- 测试输入处的先验方差：$k_{**} = k(x_*, x_*)$。\n\n### 第二步：使用提取的已知条件进行验证\n- **科学性：** 该问题描述了带噪声观测的高斯过程回归的标准公式。这是机器学习、统计学和代理建模中一个基础且广泛使用的技术。所有定义和整体设置在科学和数学上都是合理的。\n- **适定性：** 该问题是适定的。它提供了唯一推导后验预测分布所需的所有必要定义和假设。目标陈述清晰。\n- **客观性：** 语言正式、数学化，没有任何主观或模糊的术语。\n\n### 第三步：结论与行动\n问题陈述是有效的。这是高斯过程领域的一个标准推导。我将继续进行推导和评估。\n\n### 后验预测分布的推导\n\n目标是找到后验预测分布 $p(y_* \\mid x_*, X, y)$，其中 $y_* = f(x_*) + \\epsilon_*$ 是在测试点 $x_*$ 处的一个新的带噪声观测值。假设噪声项 $\\epsilon_*$ 与训练噪声来自同一分布，即 $\\epsilon_* \\sim \\mathcal{N}(0, \\tau^2)$，并且独立于所有训练数据和噪声。\n\n我们可以通过考虑训练观测值 $y$ 和新观测值 $y_*$ 的联合分布来推导这个分布。根据高斯过程的定义和观测模型，向量 $[y^\\top, y_*]^\\top$ 是从一个多元高斯分布中抽取的样本。\n\n我们来确定这个联合分布的均值和协方差。\n均值向量由期望给出：\n$$\nE \\begin{pmatrix} y \\\\ y_* \\end{pmatrix} = E \\begin{pmatrix} [f(x_1)+\\epsilon_1, \\dots, f(x_n)+\\epsilon_n]^\\top \\\\ f(x_*) + \\epsilon_* \\end{pmatrix} = \\begin{pmatrix} [m(x_1), \\dots, m(x_n)]^\\top \\\\ m(x_*) \\end{pmatrix} = \\begin{pmatrix} m \\\\ m(x_*) \\end{pmatrix}\n$$\n协方差矩阵由四个块组成：$\\text{Cov}(y, y)$、$\\text{Cov}(y, y_*)$、$\\text{Cov}(y_*, y)$ 和 $\\text{Cov}(y_*, y_*)$。\n\n1.  $\\text{Cov}(y,y)$: 其元素为 $\\text{Cov}(y_i, y_j) = \\text{Cov}(f(x_i)+\\epsilon_i, f(x_j)+\\epsilon_j)$。由于函数值 $f$ 和噪声项 $\\epsilon$ 是独立的，并且当 $i \\neq j$ 时噪声项 $\\epsilon_i, \\epsilon_j$ 是独立的：\n    $$ \\text{Cov}(y_i, y_j) = \\text{Cov}(f(x_i), f(x_j)) + \\text{Cov}(\\epsilon_i, \\epsilon_j) = k(x_i, x_j) + \\delta_{ij}\\tau^2 $$\n    用矩阵形式表示，即为 $\\text{Cov}(y, y) = K + \\tau^2 I$，其中 $I$ 是 $n \\times n$ 的单位矩阵。\n\n2.  $\\text{Cov}(y, y_*)$: 其元素为 $\\text{Cov}(y_i, y_*) = \\text{Cov}(f(x_i)+\\epsilon_i, f(x_*)+\\epsilon_*)$。由于 $\\epsilon_i$ 和 $\\epsilon_*$ 彼此独立，并且也独立于函数值：\n    $$ \\text{Cov}(y_i, y_*) = \\text{Cov}(f(x_i), f(x_*)) = k(x_i, x_*) $$\n    用向量形式表示，即为 $\\text{Cov}(y, y_*) = k_*$。根据对称性，$\\text{Cov}(y_*, y) = k_*^\\top$。\n\n3.  $\\text{Cov}(y_*, y_*)$: 这是 $y_*$ 的方差。\n    $$ \\text{Var}(y_*) = \\text{Var}(f(x_*) + \\epsilon_*) = \\text{Var}(f(x_*)) + \\text{Var}(\\epsilon_*) = k(x_*, x_*) + \\tau^2 = k_{**} + \\tau^2 $$\n\n所以，联合分布为：\n$$\n\\begin{pmatrix} y \\\\ y_* \\end{pmatrix} \\sim \\mathcal{N} \\left( \\begin{pmatrix} m \\\\ m(x_*) \\end{pmatrix}, \\begin{pmatrix} K + \\tau^2 I  k_* \\\\ k_*^\\top  k_{**} + \\tau^2 \\end{pmatrix} \\right)\n$$\n使用条件高斯分布的标准公式，如果 $[x_a^\\top, x_b^\\top]^\\top \\sim \\mathcal{N}(\\mu, \\Sigma)$ 且 $\\Sigma = \\begin{pmatrix} \\Sigma_{aa}  \\Sigma_{ab} \\\\ \\Sigma_{ba}  \\Sigma_{bb} \\end{pmatrix}$，那么条件分布 $p(x_a \\mid x_b)$ 是一个高斯分布，其均值为 $\\mu_{a|b} = \\mu_a + \\Sigma_{ab}\\Sigma_{bb}^{-1}(x_b - \\mu_b)$，协方差为 $\\Sigma_{a|b} = \\Sigma_{aa} - \\Sigma_{ab}\\Sigma_{bb}^{-1}\\Sigma_{ba}$。\n\n在我们的情境中，$x_a = y_*$ 且 $x_b = y$。我们可以代入相应的项：\n-   $\\mu_a \\rightarrow m(x_*)$\n-   $\\mu_b \\rightarrow m$\n-   $\\Sigma_{aa} \\rightarrow k_{**} + \\tau^2$\n-   $\\Sigma_{ab} \\rightarrow k_*^\\top$\n-   $\\Sigma_{bb} \\rightarrow K + \\tau^2 I$\n-   $\\Sigma_{ba} \\rightarrow k_*$\n\n$y_*$ 的后验预测均值为：\n$$ \\mu_\\text{post}(y_*) = m(x_*) + k_*^\\top (K + \\tau^2 I)^{-1} (y - m) $$\n$y_*$ 的后验预测方差为：\n$$ \\sigma^2_\\text{post}(y_*) = (k_{**} + \\tau^2) - k_*^\\top (K + \\tau^2 I)^{-1} k_* $$\n这可以重写为：\n$$ \\sigma^2_\\text{post}(y_*) = k_{**} - k_*^\\top (K + \\tau^2 I)^{-1} k_* + \\tau^2 $$\n因此，后验预测分布为 $p(y_* \\mid x_*, X, y) = \\mathcal{N}(\\mu_\\text{post}(y_*), \\sigma^2_\\text{post}(y_*))$。\n\n### 对 $\\tau^2$ 作用的分析\n观测噪声方差 $\\tau^2$ 以两种不同的方式影响预测方差 $\\sigma^2_\\text{post}(y_*)$：\n\n1.  **预测时的加性噪声：** 项 `+ \\tau^2` 明确出现。这反映了由于测量噪声 $\\epsilon_*$ 导致的新观测值 $y_*$ 中固有的不确定性。即使我们完全知道真实的函数值 $f(x_*)$，带噪声的观测值 $y_*$ 的方差仍然为 $\\tau^2$。\n\n2.  **正则化与数据影响：** 项 $\\tau^2$ 被加到格拉姆矩阵 $K$ 的对角线上，得到 $(K + \\tau^2 I)$。这一项被求逆。将正值 $\\tau^2$ 加到 $K$ 的对角线上具有正则化效应，确保矩阵可逆且良态。从概念上讲，它告知模型观测值 $y$ 是带噪声的，并不完全落在潜在函数 $f$ 上。更大的 $\\tau^2$ 意味着数据点不太可靠。在数学上，对于给定的 $k_*$，随着 $\\tau^2$ 的增加，矩阵 $(K + \\tau^2 I)^{-1}$ 会变得“更小”（在诱导矩阵范数或勒夫纳序的意义上）。这减小了被减去的项 $k_*^\\top (K + \\tau^2 I)^{-1} k_*$ 的大小，该项代表从数据中获得的不确定性的减少量。不确定性减少得越小，潜在函数 $f(x_*)$ 的后验方差就越大。\n\n总而言之，$\\tau^2$ 通过新观测的加性噪声直接增加预测方差，并通过使模型减少对训练数据的“信任”，从而减少从该数据中获得的不确定性减少量，间接增加预测方差。\n\n### 逐项分析选项\n\n**A. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top (K + \\tau^2 I)^{-1} (y - m)$，方差为 $k_{**} - k_*^\\top (K + \\tau^2 I)^{-1} k_* + \\tau^2$。方差通过两种方式增加：$\\tau^2$ 作为 $x_*$ 处的观测噪声以加法形式出现，而 $(K + \\tau^2 I)^{-1}$ 中的 $\\tau^2$ 降低了数据的杠杆作用（缩小了减去项），从而增大了潜在的预测不确定性。**\n-   均值公式正确。\n-   方差公式正确。\n-   定性解释正确地指出了 $\\tau^2$ 的两个作用：预测点处的加性噪声以及对不确定性减少项（数据杠杆作用）的影响。\n-   **结论：正确**\n\n**B. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top (K + \\tau^2 I)^{-1} (y - m)$，方差为 $k_{**} - k_*^\\top (K + \\tau^2 I)^{-1} k_*$。在预测时，方差不受 $\\tau^2$ 的影响，因为噪声在训练中已经被考虑。**\n-   均值公式正确。\n-   方差公式不正确。它代表了潜在函数 $f(x_*)$ 的方差，而不是带噪声的观测值 $y_*$ 的方差。它缺少了 `+ \\tau^2` 项。\n-   解释在事实上是不正确的。预测方差显然是 $\\tau^2$ 的函数。\n-   **结论：不正确**\n\n**C. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top (K + \\tau^2 I)^{-1} (y - m)$，方差为 $k_{**} + \\tau^2 - k_*^\\top K^{-1} k_*$。$\\tau^2$ 的作用仅仅是将先验方差增加 $\\tau^2$，而没有改变数据如何减少不确定性。**\n-   均值公式正确。\n-   方差公式不正确。它错误地使用了 $K^{-1}$ 而不是 $(K + \\tau^2 I)^{-1}$。这将无噪声数据推断与带噪声预测混为一谈。\n-   解释不正确；$\\tau^2$ 通过 $(K + \\tau^2 I)^{-1}$ 项关键地改变了数据如何减少不确定性。\n-   **结论：不正确**\n\n**D. $p(y_* \\mid x_*, X, y)$ 是高斯分布，其均值为 $m(x_*) + k_*^\\top K^{-1} (y - m)$，方差为 $k_{**} + \\tau^2$。方差简单地等于先验方差加上噪声，与训练数据无关，因为观测噪声冲掉了所有获得的信息。**\n-   均值公式不正确。它使用了 $K^{-1}$，这仅在训练数据 $y$ 无噪声时才适用。\n-   方差公式不正确。它忽略了从训练数据中减少的不确定性，即 $k_*^\\top (K + \\tau^2 I)^{-1} k_*$。\n-   这个解释是严重夸大的。噪声降低了数据的信息含量，但并未完全消除它。\n-   **结论：不正确**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "定义了代理模型的结构之后，其性能关键取决于选择合适的超参数，例如核函数的长度尺度。本练习探讨了留一法交叉验证（LOO-CV），这是一种用于超参数优化的强大技术。通过为留一法误差推导一个计算上高效的公式 ，你将掌握一项实用技能，能够在不产生高昂计算成本的情况下，对高斯过程模拟器进行调优以达到最佳预测性能。",
            "id": "4145548",
            "problem": "考虑一个复杂自适应系统模拟器，它将一个$d$维输入向量$\\mathbf{x} \\in \\mathbb{R}^{d}$映射到一个标量输出$y \\in \\mathbb{R}$。您希望使用高斯过程（GP）模拟器来模拟该模拟器，以便通过交叉验证实现对输入空间的有效探索和超参数调整。假设基于标准定义的以下建模设置：\n\n- 在潜函数$f(\\mathbf{x})$上设一个高斯过程（GP）先验，其均值为零，并采用各向异性平方指数协方差核，\n$$\nk_{\\boldsymbol{\\ell}}(\\mathbf{x}, \\mathbf{x}') \\;=\\; \\sigma_{f}^{2} \\exp\\!\\left(-\\frac{1}{2} \\sum_{m=1}^{d} \\left(\\frac{x_{m} - x'_{m}}{\\ell_{m}}\\right)^{2}\\right),\n$$\n其中 $\\sigma_{f}^{2}  0$ 是信号方差，$\\boldsymbol{\\ell} = (\\ell_{1}, \\ldots, \\ell_{d})$ 是严格为正的长度尺度。\n\n- 一个同方差观测噪声模型 $y_{i} = f(\\mathbf{x}_{i}) + \\epsilon_{i}$，其中 $\\epsilon_{i} \\sim \\mathcal{N}(0, \\sigma^{2})$ 独立同分布，对于某个 $\\sigma^{2}  0$。\n\n令 $\\mathbf{X} = [\\mathbf{x}_{1}, \\ldots, \\mathbf{x}_{n}]^{\\top} \\in \\mathbb{R}^{n \\times d}$ 表示训练输入，$\\mathbf{y} = [y_{1}, \\ldots, y_{n}]^{\\top} \\in \\mathbb{R}^{n}$ 表示训练输出。定义核矩阵 $\\mathbf{K}_{\\boldsymbol{\\ell}} \\in \\mathbb{R}^{n \\times n}$，其元素为 $[\\mathbf{K}_{\\boldsymbol{\\ell}}]_{ij} = k_{\\boldsymbol{\\ell}}(\\mathbf{x}_{i}, \\mathbf{x}_{j})$，以及协方差矩阵 $\\mathbf{C}(\\boldsymbol{\\ell}, \\sigma^{2}) = \\mathbf{K}_{\\boldsymbol{\\ell}} + \\sigma^{2} \\mathbf{I}_{n}$。\n\n您将使用留一法交叉验证（LOO-CV），这是交叉验证（CV）的一种特殊情况，通过最小化一个目标函数来选择长度尺度$\\boldsymbol{\\ell}$（以及可选地选择$\\sigma^{2}$）。该目标函数概括了当每个训练点被排除在外时，在该点上的预测性能。从多元正态分布、条件高斯恒等式的核心事实以及上述GP回归公式出发，推导所有$n$个训练点的留一法负对数预测密度（NLPD）的可计算闭式表达式。该表达式应仅依赖于$\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^{2})$和$\\mathbf{y}$，并且对于任何给定的$\\boldsymbol{\\ell}$和$\\sigma^{2}$，都可以通过单次矩阵求逆来计算。\n\n您的最终答案必须是LOO-CV NLPD的闭式解析表达式，该表达式是$\\boldsymbol{\\ell}$和$\\sigma^{2}$的函数，且仅用$\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^{2})$和$\\mathbf{y}$来表示。最终答案中不要包含任何中间推导过程。该表达式必须是单个解析公式，而不是不等式或待解方程。您无需提供数值。如果您引入任何额外的符号，请确保对其进行明确定义。最终表达式不需要单位。",
            "solution": "用户要求给出高斯过程（GP）回归模型的留一法交叉验证（LOO-CV）负对数预测密度（NLPD）的闭式表达式。该表达式必须在计算上是高效的，依赖于对完整的$n \\times n$协方差矩阵的单次求逆。\n\n该问题已经过验证，被认为是具有科学依据、良构且客观的。我们可以开始推导。\n\n设GP模型的超参数统称为$\\boldsymbol{\\theta}$，其中包括核长度尺度$\\boldsymbol{\\ell}$和观测噪声方差$\\sigma^2$。信号方差$\\sigma_f^2$隐式地包含在核矩阵$\\mathbf{K}_{\\boldsymbol{\\ell}}$的定义中。目标是计算LOO-CV NLPD，其定义为每个训练点的负对数预测密度之和，其中每个点都是使用在其余$n-1$个点上训练的模型进行评估的：\n$$\n\\text{NLPD}_{\\text{LOO}}(\\boldsymbol{\\theta}) = - \\sum_{i=1}^{n} \\log p(y_i | \\mathbf{X}, \\mathbf{y}_{-i}, \\boldsymbol{\\theta})\n$$\n其中$\\mathbf{y}_{-i}$代表移除了第$i$个元素的训练输出向量。\n\n对于每一折$i \\in \\{1, \\ldots, n\\}$，训练数据为$\\mathcal{D}_{-i} = (\\mathbf{X}_{-i}, \\mathbf{y}_{-i})$，测试点为$(\\mathbf{x}_i, y_i)$。根据标准的GP回归公式，测试输出$y_i$的预测分布是一个高斯分布，$p(y_i | \\mathcal{D}_{-i}, \\boldsymbol{\\theta}) = \\mathcal{N}(y_i | \\mu_i^{(-i)}, v_i^{(-i)})$。预测均值$\\mu_i^{(-i)}$和预测方差$v_i^{(-i)}$由下式给出：\n$$\n\\mu_i^{(-i)} = \\mathbf{k}_i^{(-i)\\top} (\\mathbf{C}_{-i})^{-1} \\mathbf{y}_{-i}\n$$\n$$\nv_i^{(-i)} = k_{ii} - \\mathbf{k}_i^{(-i)\\top} (\\mathbf{C}_{-i})^{-1} \\mathbf{k}_i^{(-i)} + \\sigma^2\n$$\n此处，$\\mathbf{C}_{-i} = \\mathbf{K}_{-i,-i} + \\sigma^2 \\mathbf{I}_{n-1}$是$\\mathcal{D}_{-i}$中$n-1$个训练点的协方差矩阵，$\\mathbf{k}_i^{(-i)}$是$\\mathbf{x}_i$与$\\mathbf{X}_{-i}$中各点之间的协方差向量，而$k_{ii} = k_{\\boldsymbol{\\ell}}(\\mathbf{x}_i, \\mathbf{x}_i)$。\n\n单个点$i$的NLPD为：\n$$\n\\text{NLPD}_i = -\\log p(y_i | \\mathcal{D}_{-i}, \\boldsymbol{\\theta}) = \\frac{1}{2} \\log(2\\pi) + \\frac{1}{2}\\log(v_i^{(-i)}) + \\frac{(y_i - \\mu_i^{(-i)})^2}{2v_i^{(-i)}}\n$$\n$\\text{NLPD}_{\\text{LOO}} = \\sum_{i=1}^{n} \\text{NLPD}_i$的朴素计算方法需要对$(n-1) \\times (n-1)$大小的矩阵进行$n$次独立的求逆运算，导致总计算复杂度为$O(n^4)$。目标是推导一个等价表达式，该表达式仅需要对完整的$n \\times n$协方差矩阵$\\mathbf{C} = \\mathbf{C}(\\boldsymbol{\\ell}, \\sigma^{2}) = \\mathbf{K}_{\\boldsymbol{\\ell}} + \\sigma^{2} \\mathbf{I}_{n}$进行单次求逆。\n\n这可以通过将留一法中的量$\\mu_i^{(-i)}$和$v_i^{(-i)}$与$\\mathbf{C}^{-1}$的元素联系起来实现。我们使用从分块矩阵求逆公式推导出的恒等式。对于任意$i$，我们可以（通过置换）将矩阵$\\mathbf{C}$分块如下：\n$$\n\\mathbf{C} = \\begin{pmatrix} \\mathbf{C}_{-i}  \\mathbf{k}_i^{(-i)} \\\\ (\\mathbf{k}_i^{(-i)})^\\top  C_{ii} \\end{pmatrix}\n$$\n其中$C_{ii} = k_{ii} + \\sigma^2$。逆矩阵的块对角元素公式给出：\n$$\n[\\mathbf{C}^{-1}]_{ii} = (C_{ii} - (\\mathbf{k}_i^{(-i)})^\\top (\\mathbf{C}_{-i})^{-1} \\mathbf{k}_i^{(-i)})^{-1}\n$$\n通过重新整理，我们发现了与预测方差$v_i^{(-i)}$的关系：\n$$\n\\frac{1}{[\\mathbf{C}^{-1}]_{ii}} = C_{ii} - (\\mathbf{k}_i^{(-i)})^\\top (\\mathbf{C}_{-i})^{-1} \\mathbf{k}_i^{(-i)} = (k_{ii} + \\sigma^2) - (\\mathbf{k}_i^{(-i)})^\\top (\\mathbf{C}_{-i})^{-1} \\mathbf{k}_i^{(-i)} = v_i^{(-i)}\n$$\n因此，我们得到第一个关键恒等式：\n$$\nv_i^{(-i)} = \\frac{1}{[\\mathbf{C}^{-1}]_{ii}}\n$$\n\n为了找到均值$\\mu_i^{(-i)}$的表达式，我们定义$\\boldsymbol{\\alpha} = \\mathbf{C}^{-1}\\mathbf{y}$。线性系统$\\mathbf{C}\\boldsymbol{\\alpha} = \\mathbf{y}$可以写成分块形式：\n$$\n\\begin{pmatrix} \\mathbf{C}_{-i}  \\mathbf{k}_i^{(-i)} \\\\ (\\mathbf{k}_i^{(-i)})^\\top  C_{ii} \\end{pmatrix} \\begin{pmatrix} \\boldsymbol{\\alpha}_{-i} \\\\ \\alpha_i \\end{pmatrix} = \\begin{pmatrix} \\mathbf{y}_{-i} \\\\ y_i \\end{pmatrix}\n$$\n这代表了两个方程。第二个方程是$(\\mathbf{k}_i^{(-i)})^\\top \\boldsymbol{\\alpha}_{-i} + C_{ii} \\alpha_i = y_i$。从第一个方程$\\mathbf{C}_{-i}\\boldsymbol{\\alpha}_{-i} + \\mathbf{k}_i^{(-i)}\\alpha_i = \\mathbf{y}_{-i}$，我们解出$\\boldsymbol{\\alpha}_{-i} = (\\mathbf{C}_{-i})^{-1}(\\mathbf{y}_{-i} - \\mathbf{k}_i^{(-i)}\\alpha_i)$。将此代入第二个方程：\n$$\n(\\mathbf{k}_i^{(-i)})^\\top (\\mathbf{C}_{-i})^{-1}(\\mathbf{y}_{-i} - \\mathbf{k}_i^{(-i)}\\alpha_i) + C_{ii} \\alpha_i = y_i\n$$\n认识到$\\mu_i^{(-i)} = (\\mathbf{k}_i^{(-i)})^\\top (\\mathbf{C}_{-i})^{-1} \\mathbf{y}_{-i}$，我们有：\n$$\n\\mu_i^{(-i)} - \\left( (\\mathbf{k}_i^{(-i)})^\\top (\\mathbf{C}_{-i})^{-1} \\mathbf{k}_i^{(-i)} \\right) \\alpha_i + C_{ii} \\alpha_i = y_i\n$$\n$$\n\\mu_i^{(-i)} + \\left( C_{ii} - (\\mathbf{k}_i^{(-i)})^\\top (\\mathbf{C}_{-i})^{-1} \\mathbf{k}_i^{(-i)} \\right) \\alpha_i = y_i\n$$\n括号中的项正是$([\\mathbf{C}^{-1}]_{ii})^{-1}$。因此：\n$$\n\\mu_i^{(-i)} + \\frac{\\alpha_i}{[\\mathbf{C}^{-1}]_{ii}} = y_i\n$$\n这就得出了留一法残差的第二个关键恒等式：\n$$\ny_i - \\mu_i^{(-i)} = \\frac{\\alpha_i}{[\\mathbf{C}^{-1}]_{ii}} = \\frac{[\\mathbf{C}^{-1}\\mathbf{y}]_i}{[\\mathbf{C}^{-1}]_{ii}}\n$$\n现在我们将$v_i^{(-i)}$和残差的这些高效表达式代入点$i$的NLPD公式中：\n$$\n\\text{NLPD}_i = \\frac{1}{2}\\log(2\\pi) + \\frac{1}{2}\\log\\left(\\frac{1}{[\\mathbf{C}^{-1}]_{ii}}\\right) + \\frac{\\left( \\frac{[\\mathbf{C}^{-1}\\mathbf{y}]_i}{[\\mathbf{C}^{-1}]_{ii}} \\right)^2}{2 \\left( \\frac{1}{[\\mathbf{C}^{-1}]_{ii}} \\right)}\n$$\n$$\n\\text{NLPD}_i = \\frac{1}{2}\\log(2\\pi) - \\frac{1}{2}\\log([\\mathbf{C}^{-1}]_{ii}) + \\frac{([\\mathbf{C}^{-1}\\mathbf{y}]_i)^2}{2[\\mathbf{C}^{-1}]_{ii}}\n$$\n总的LOO-CV NLPD是对所有$n$个点的求和。令$\\mathbf{C}$为$\\mathbf{C}(\\boldsymbol{\\ell}, \\sigma^2)$的简写。\n$$\n\\text{NLPD}_{\\text{LOO}} = \\sum_{i=1}^{n} \\text{NLPD}_i = \\sum_{i=1}^{n} \\left( \\frac{1}{2}\\log(2\\pi) - \\frac{1}{2}\\log([\\mathbf{C}^{-1}]_{ii}) + \\frac{([\\mathbf{C}^{-1}\\mathbf{y}]_i)^2}{2[\\mathbf{C}^{-1}]_{ii}} \\right)\n$$\n这可以简化为最终的闭式表达式：\n$$\n\\text{NLPD}_{\\text{LOO}}(\\boldsymbol{\\ell}, \\sigma^2) = \\frac{n}{2}\\log(2\\pi) - \\frac{1}{2}\\sum_{i=1}^{n} \\log([\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^2)]_{ii}) + \\frac{1}{2}\\sum_{i=1}^{n} \\frac{([\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^2)\\mathbf{y}]_i)^2}{[\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^2)]_{ii}}\n$$\n该表达式仅依赖于完整协方差矩阵的逆$\\mathbf{C}^{-1}$和训练输出$\\mathbf{y}$，并且可以在$O(n^3)$时间内计算，其主要计算开销来自单次矩阵求逆。",
            "answer": "$$\n\\boxed{\\frac{n}{2}\\log(2\\pi) - \\frac{1}{2}\\sum_{i=1}^{n} \\log\\left([\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^2)]_{ii}\\right) + \\frac{1}{2}\\sum_{i=1}^{n} \\frac{\\left([\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^2) \\mathbf{y}]_i\\right)^2}{[\\mathbf{C}^{-1}(\\boldsymbol{\\ell}, \\sigma^2)]_{ii}}}\n$$"
        },
        {
            "introduction": "高斯过程模拟器的一个关键优势是其能够提供有原则的不确定性估计，但这些估计只有在模型假设得到满足时才是可信的。本练习侧重于模型诊断，特别是使用标准化残差和分位数-分位数（Q-Q）图来评估预测分布的正态性。这项动手分析  为你提供了验证模拟器的基本工具，以确保其预测及相关的不确定性是可靠且在统计上是合理的。",
            "id": "4145517",
            "problem": "考虑一个复杂自适应系统，其模拟器输出是在输入设置 $x \\in \\mathcal{X}$ 下观测到的实值响应 $Y$。使用高斯过程 (GP) 先验构建了一个模拟器，以近似模拟器或随机系统的输出。对于一个留出测试集 $\\{(x_i, y_i)\\}_{i=1}^n$，该模拟器在每个 $x_i$ 处提供一个后验预测分布，其预测均值为 $\\mu_i = \\mu(x_i)$，预测方差为 $v_i = v(x_i)$。在许多复杂自适应系统中，观测到的 $Y$ 结合了一个潜在的平滑过程和内在随机性，因此后验预测方差 $v_i$ 是模拟器的潜在过程方差与估计的观测或内在噪声方差之和。\n\n您希望评估模拟器的预测分布的正态性假设是否合理。两个标准工具是标准化残差和分位数-分位数 (Q-Q) 图。从条件期望和方差的定义，以及分布的分位数函数的定义出发，推导应如何为模拟器预测构建标准化残差，以及应如何构建和解释 Q-Q 图以评估标准化残差的正态性假设。\n\n以下哪个陈述正确定义了用于模拟器预测的标准化残差，并正确描述了在此背景下 Q-Q 图的构建和解释？\n\nA. 标准化残差为 $r_i = \\dfrac{y_i - \\mu_i}{\\sqrt{v_i}}$，其中 $v_i$ 是 $Y_i$ 在 $x_i$ 处的后验预测方差，如果存在，则包括内在随机性（观测噪声）。通过将排序后的 $r_i$ 绘制在纵轴上，将标准正态分布的理论分位数绘制在横轴上，来构建用于检验正态性的 Q-Q 图；若点大致沿着直线 $y = x$ 排列，则支持预测的正态性假设。\n\nB. 用于正态性评估的标准化残差可以取为原始残差 $r_i = y_i - \\mu_i$ 而不进行缩放，因为异方差的预测方差不影响评估。对于 Q-Q 绘图，如果形状大致呈钟形，将残差直方图与核密度估计进行比较就足以确认正态性。\n\nC. 如果模拟器在 $x_i$ 处的后验预测分布是均值为 $\\mu_i$、方差为 $v_i$ 的高斯分布，则在该模型下，标准化残差 $r_i = \\dfrac{y_i - \\mu_i}{\\sqrt{v_i}}$ 边际上服从标准正态分布。Q-Q 图使用标准正态分布的理论分位数 $q_i = \\Phi^{-1}\\!\\left(\\dfrac{i - 0.5}{n}\\right)$ 和排序后的标准化残差构建；在两端尾部与参考线的对称偏离表示尾部厚重度的不匹配（重尾或轻尾）而非偏度，而非对称偏离表示偏度。\n\nD. 为了构建标准化残差，最好除以方差的后验均值 $\\bar{v} = \\dfrac{1}{n}\\sum_{i=1}^n v_i$，而不是逐点的预测方差 $v_i$，因为这能稳定输入间的变异性，并确保无论是否存在异方差性，Q-Q 参考线的斜率都为 1。\n\n选择所有适用项。",
            "solution": "### 问题验证\n\n**步骤 1：提取已知条件**\n\n*   **系统：** 一个复杂自适应系统。\n*   **模拟器输出：** 在输入设置 $x \\in \\mathcal{X}$ 下的实值响应 $Y$。\n*   **模拟器：** 使用高斯过程 (GP) 先验来近似模拟器或系统输出。\n*   **测试数据：** 一个留出测试集 $\\{(x_i, y_i)\\}_{i=1}^n$。\n*   **模拟器预测：** 在每个 $x_i$ 处，模拟器提供一个后验预测分布。\n    *   预测均值：$\\mu_i = \\mu(x_i)$。\n    *   预测方差：$v_i = v(x_i)$。\n*   **方差构成：** 后验预测方差 $v_i$ 是模拟器的潜在过程方差与估计的观测或内在噪声方差之和。\n*   **目标：** 评估模拟器的预测分布的正态性假设是否合理。\n*   **工具：** 标准化残差和分位数-分位数 (Q-Q) 图。\n*   **问题：** 推导标准化残差的形成以及用于评估正态性的 Q-Q 图的构建/解释，然后评估给定的选项。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n1.  **科学依据：** 该问题牢固地植根于贝叶斯建模的统计理论，特别是高斯过程，它是代理建模和不确定性量化的基石。后验预测分布、标准化残差和 Q-Q 图的概念是模型诊断的标准统计工具。\n2.  **定义明确：** 该问题是定义明确的。它要求在一个清晰定义的统计背景（GP 回归）下推导和应用标准诊断程序。基于既定的统计原则，该问题导向一个唯一的、正确的答案。\n3.  **客观性：** 问题陈述是客观的，并使用了统计学和机器学习中精确、标准的术语。没有主观或模棱两可的陈述。\n4.  **完整性与一致性：** 该问题提供了推导所需定义和解释的所有必要信息。设置是自洽的，并且是计算机实验和模拟应用中的典型情况。\n5.  **可行性：** 所描述的场景不仅可行，而且是复杂系统建模和不确定性下工程设计领域中一个常见而实际的任务。\n6.  **其他缺陷：** 该问题没有表现出任何其他缺陷，如琐碎、同义反复或不可证伪。总预测方差和潜在过程方差之间的区别，以及 GP 预测的异方差性质，使得这个问题不简单。\n\n**步骤 3：结论与行动**\n\n问题陈述是 **有效的**。分析将继续进行。\n\n### 推导与求解\n\n问题的核心是验证模型假设，即在新输入 $x_i$ 处的新观测值 $Y$ 的后验预测分布是高斯分布。根据问题陈述，这个假设是：\n$$ Y_i | x_i, \\text{training data} \\sim \\mathcal{N}(\\mu_i, v_i) $$\n其中 $\\mu_i$ 是后验预测均值，$v_i$ 是后验预测方差。问题正确地指出 $v_i$ 是 **总** 预测方差，对于带有加性噪声的 GP 模型，它由两部分组成：底层潜在函数的后验方差和观测噪声的方差（通常称为“块金”）。我们将潜在函数方差表示为 $\\sigma^2_f(x_i)$，噪声方差表示为 $\\sigma_n^2$。那么 $v_i = \\sigma^2_f(x_i) + \\sigma_n^2$。对于随机模拟器，$\\sigma_n^2$ 代表内在随机性。\n\n**1. 标准化残差的推导**\n\n正态分布的一个基本性质是，任何服从正态分布的随机变量都可以转换为标准正态随机变量。如果一个随机变量 $Z$ 服从分布 $\\mathcal{N}(m, s^2)$，那么变换后的变量 $Z' = (Z - m)/s$ 服从标准正态分布 $\\mathcal{N}(0, 1)$。\n\n将此原理应用于我们的问题，如果模型的假设是正确的，那么测试集中的每个观测值 $y_i$ 都是来自分布 $\\mathcal{N}(\\mu_i, v_i)$ 的一个实现。为了检验这一点，我们将每个观测值转换为一个在模型下应为来自标准正态分布 $\\mathcal{N}(0, 1)$ 的实现的值。这个转换后的值就是标准化残差 $r_i$。\n\n从条件期望 $E[Y_i | x_i] = \\mu_i$ 和条件方差 $\\text{Var}(Y_i | x_i) = v_i$ 出发，观测值 $(x_i, y_i)$ 的标准化残差定义为：\n$$ r_i = \\frac{y_i - E[Y_i | x_i]}{\\sqrt{\\text{Var}(Y_i | x_i)}} = \\frac{y_i - \\mu_i}{\\sqrt{v_i}} $$\n如果模型被正确指定，标准化残差集 $\\{r_i\\}_{i=1}^n$ 的行为应像一个来自标准正态分布 $\\mathcal{N}(0, 1)$ 的 $n$ 个独立抽样的样本。至关重要的是对每个点使用其特定的预测方差 $v_i$，因为 GP 模型本质上是异方差的（即预测方差 $v_i$ 取决于输入 $x_i$）。\n\n**2. Q-Q 图的构建与解释**\n\n分位数-分位数 (Q-Q) 图是一种图形工具，用于评估一组数据是否可能来自某个特定的理论分布。为了评估标准化残差 $\\{r_i\\}_{i=1}^n$ 是否来自标准正态分布，我们将它们的经验分位数与 $\\mathcal{N}(0, 1)$ 的理论分位数进行比较。\n\n*   **构建：**\n    1.  计算所有 $i=1, \\dots, n$ 的标准化残差 $r_i$。\n    2.  将残差按升序排序：$r_{(1)} \\leq r_{(2)} \\leq \\dots \\leq r_{(n)}$。这些是样本分位数。\n    3.  计算来自标准正态分布的相应理论分位数。理论分位数由 $q_p = \\Phi^{-1}(p)$ 给出，其中 $\\Phi^{-1}$ 是标准正态累积分布函数 (CDF) 的反函数（也称为概率单位函数），$p$ 是一个概率。我们需要选择 $n$ 个概率，或“绘图位置” $p_1, \\dots, p_n$。一个常见且稳健的选择是 $p_i = (i - a)/(n - 2a + 1)$，其中 $a \\in [0, 1]$。一个简单且广泛使用的公式是 $p_i = (i - 0.5)/n$，这对应于 $a=0.5$。因此，理论分位数为 $q_i = \\Phi^{-1}\\left(\\frac{i - 0.5}{n}\\right)$。\n    4.  创建一个散点图，以理论分位数为横轴，排序后的样本残差为纵轴，绘制点 $(q_i, r_{(i)})$。\n\n*   **解释：**\n    1.  **良好拟合：** 如果标准化残差确实是来自 $\\mathcal{N}(0, 1)$ 的样本，那么点 $(q_i, r_{(i)})$ 将大致位于参考线 $y=x$ 上。\n    2.  **偏差：** 与 $y=x$ 线的系统性偏差表明残差的经验分布与理论正态分布之间存在不匹配。\n        *   **尾部行为：** 如果点形成 'S' 形，即最左边的点在线下方，最右边的点在线上方，则经验分布比正态分布具有 **更重的尾部（重尾）**。反向的 'S' 形表示 **更轻的尾部（轻尾）**。如果这些偏差在两端尾部类似地发生，则它们是对称偏差。\n        *   **偏度：** 如果点形成一条曲线，在一侧持续位于参考线上方，在另一侧持续位于下方，这表明存在偏度。例如，如果点从参考线向上弯曲（即正残差比预期的更极端，而负残差则不然），则分布是 **正偏的（右偏）**。相反的模式表示 **负偏度（左偏）**。因此，与参考线的非对称偏离表示偏度。\n\n### 逐项分析\n\n**A. 标准化残差为 $r_i = \\dfrac{y_i - \\mu_i}{\\sqrt{v_i}}$，其中 $v_i$ 是 $Y_i$ 在 $x_i$ 处的后验预测方差，如果存在，则包括内在随机性（观测噪声）。通过将排序后的 $r_i$ 绘制在纵轴上，将标准正态分布的理论分位数绘制在横轴上，来构建用于检验正态性的 Q-Q 图；若点大致沿着直线 $y = x$ 排列，则支持预测的正态性假设。**\n这个陈述完全正确。标准化残差的公式是正确的，并恰当地强调了使用总预测方差 $v_i$。Q-Q 图的构建描述（经验分位数 vs. 理论分位数）及其基本解释（沿 $y=x$ 线对齐）是准确的。\n**结论：正确**\n\n**B. 用于正态性评估的标准化残差可以取为原始残差 $r_i = y_i - \\mu_i$ 而不进行缩放，因为异方差的预测方差不影响评估。对于 Q-Q 绘图，如果形状大致呈钟形，将残差直方图与核密度估计进行比较就足以确认正态性。**\n这个陈述是错误的，主要有两个原因。首先，不对原始残差进行缩放是一个关键错误。在像 GP 这样的异方差模型中，方差 $v_i$ 是不同的，因此原始残差 $y_i - \\mu_i$ 来自不同的分布 $\\mathcal{N}(0, v_i)$。这样一组残差并不来自单一的正态分布，这使得针对任何单一 $\\sigma^2$ 的标准 Q-Q 图 $\\mathcal{N}(0, \\sigma^2)$ 无效。异方差性不影响评估的说法是根本错误的。其次，将直方图与核密度估计进行比较是检查分布形状的一种有效方法，但它不是 Q-Q 图的定义。\n**结论：错误**\n\n**C. 如果模拟器在 $x_i$ 处的后验预测分布是均值为 $\\mu_i$、方差为 $v_i$ 的高斯分布，则在该模型下，标准化残差 $r_i = \\dfrac{y_i - \\mu_i}{\\sqrt{v_i}}$ 边际上服从标准正态分布。Q-Q 图使用标准正态分布的理论分位数 $q_i = \\Phi^{-1}\\!\\left(\\dfrac{i - 0.5}{n}\\right)$ 和排序后的标准化残差构建；在两端尾部与参考线的对称偏离表示尾部厚重度的不匹配（重尾或轻尾）而非偏度，而非对称偏离表示偏度。**\n这个陈述也是正确的，并且比选项 A 提供了更多的技术细节。$r_i$ 的公式以及它们边际上服从标准正态分布的结论是正确的。使用 $p_i = (i - 0.5)/n$ 的理论分位数具体公式是一个标准且有效的选择。对 Q-Q 图上对称与非对称偏离的解释是诊断特定类型分布不匹配（尾部厚重度 vs. 偏度）的标准、细致的方法。\n**结论：正确**\n\n**D. 为了构建标准化残差，最好除以方差的后验均值 $\\bar{v} = \\dfrac{1}{n}\\sum_{i=1}^n v_i$，而不是逐点的预测方差 $v_i$，因为这能稳定输入间的变异性，并确保无论是否存在异方差性，Q-Q 参考线的斜率都为 1。**\n这个陈述是错误的。在异方差设置中使用平均方差 $\\bar{v}$ 进行标准化是一个方法论上的错误。它忽略了模型本身关于不确定性如何随输入 $x_i$ 变化的预测。对于模型非常不确定（$v_j \\gg \\bar{v}$）的点 $x_j$，得到的残差 $(y_j - \\mu_j)/\\sqrt{\\bar{v}}$ 会被人为地夸大。相反，在模型非常确定（$v_k \\ll \\bar{v}$）的地方，残差会被人为地减弱。即使模型被完美指定，这个过程也不会产生服从标准正态分布的残差。标准化的目的在于考虑每个点的特定方差，而不是将其平均掉。\n**结论：错误**",
            "answer": "$$\\boxed{AC}$$"
        }
    ]
}