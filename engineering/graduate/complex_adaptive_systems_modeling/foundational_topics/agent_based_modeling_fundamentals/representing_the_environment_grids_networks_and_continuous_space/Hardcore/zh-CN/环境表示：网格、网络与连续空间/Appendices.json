{
    "hands_on_practices": [
        {
            "introduction": "将连续的环境动态（如流体流动或信号传播）在离散网格上进行仿真是科学计算中的一项核心任务。本练习通过研究线性平流方程，探讨了将连续偏微分方程离散化为有限差分格式时遇到的基本挑战。通过推导和分析两种经典的数值格式——一阶迎风格式和二阶Lax–Wendroff格式，您将亲身体验如何评估数值解的稳定性和准确性，并理解数值耗散与色散等重要概念。",
            "id": "4140822",
            "problem": "考虑用均匀空间网格表示一维连续环境，用于求解由 $\\partial_{t} u(x,t) + c\\,\\partial_{x} u(x,t) = 0$ 给出的线性平流偏微分方程（PDE），其中 $c0$ 是一个常数信号速度。设该环境在长度为 $L$ 的区间上是周期的，并将空间离散为 $x_{j} = j\\,\\Delta x$（对于整数 $j$），将时间离散为 $t^{n} = n\\,\\Delta t$（对于整数 $n$）。定义无量纲的 Courant–Friedrichs–Lewy (CFL) 数为 $\\nu = \\dfrac{c\\,\\Delta t}{\\Delta x}$。假设基于网格的模型适当地近似了连续平流动力学。\n\n从核心定义和微积分出发，推导：\n1. 与平流方向 $c0$ 一致的一阶显式迎风有限差分格式。\n2. 通过时间上的二阶泰勒展开，利用 PDE 将时间导数用空间导数重写，并用与网格表示一致的中心有限差分来近似空间导数，从而推导出一个二阶显式 Lax–Wendroff 有限差分格式。\n\n然后，在周期网格上使用傅里叶模态的 von Neumann 分析法来分析这两种离散格式。对于每种格式，假设一个形式为 $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$ 的离散傅里叶模态，其中 $\\theta = k\\,\\Delta x$ 是与连续波数 $k$ 相关的无量纲波数。推导精确的放大因子 $G(\\theta,\\nu)$，使得 $\\hat{u}^{n+1} = G(\\theta,\\nu)\\,\\hat{u}^{n}$。\n\n使用放大因子，比较两种格式的色散和耗散特性：\n- 以闭合形式表示其模 $|G(\\theta,\\nu)|$ 和辐角 $\\arg(G(\\theta,\\nu))$。\n- 对于小的 $\\theta$，求出 $|G(\\theta,\\nu)|$ 的主阶展开式，以及数值相速度与物理相速度之比 $c_{\\mathrm{num}}/c$ 的主阶展开式，其中 $c_{\\mathrm{num}}$ 通过每个时间步的数值相移由 $G(\\theta,\\nu) = |G(\\theta,\\nu)|\\,\\exp\\!\\big(-i\\,\\omega_{\\mathrm{num}}\\,\\Delta t\\big)$ 定义，且 $c_{\\mathrm{num}} = \\omega_{\\mathrm{num}}/k$。\n- 使用关于放大因子的 von Neumann 准则，陈述每种格式保持稳定的关于 $\\nu$ 的稳定性条件。\n\n答案规格：\n将你的最终答案表示为迎风格式和 Lax–Wendroff 格式的精确放大因子对 $G_{\\mathrm{up}}(\\theta,\\nu)$ 和 $G_{\\mathrm{LW}}(\\theta,\\nu)$。将它们表示为关于 $\\theta$ 和 $\\nu$ 的单行矩阵。无需四舍五入。最终答案中无需单位。",
            "solution": "线性平流方程由下式给出：\n$$\n\\partial_{t} u(x,t) + c\\,\\partial_{x} u(x,t) = 0\n$$\n其中 $c>0$ 是常数平流速度。我们用网格间距 $\\Delta x$ 将空间离散化，使得 $x_j = j\\,\\Delta x$，用步长 $\\Delta t$ 将时间离散化，使得 $t^n = n\\,\\Delta t$。$u(x_j, t^n)$ 的数值近似值记为 $u_j^n$。Courant–Friedrichs–Lewy (CFL) 数为 $\\nu = \\frac{c\\,\\Delta t}{\\Delta x}$。\n\n**1. 一阶迎风格式的推导**\n\n我们使用有限差分来近似时间和空间导数。对于时间导数，我们使用一阶向前差分：\n$$\n\\partial_{t} u(x_j, t^n) \\approx \\frac{u_j^{n+1} - u_j^n}{\\Delta t}\n$$\n对于空间导数，由于波速 $c$ 是正的（$c>0$），信息从左向右传播（从较小的 $x$ 到较大的 $x$）。因此，一个“物理驱动”或“迎风”的格式应该使用来自上游方向的信息，这对应于索引小于 $j$ 的网格点。我们对空间导数使用一阶向后差分：\n$$\n\\partial_{x} u(x_j, t^n) \\approx \\frac{u_j^n - u_{j-1}^n}{\\Delta x}\n$$\n将这些近似代入 PDE，$\\partial_t u = -c\\,\\partial_x u$，我们得到：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} = -c \\left(\\frac{u_j^n - u_{j-1}^n}{\\Delta x}\\right)\n$$\n求解 $u_j^{n+1}$：\n$$\nu_j^{n+1} = u_j^n - \\frac{c\\,\\Delta t}{\\Delta x} (u_j^n - u_{j-1}^n)\n$$\n使用 CFL 数 $\\nu$ 的定义：\n$$\nu_j^{n+1} = u_j^n - \\nu (u_j^n - u_{j-1}^n) = (1-\\nu)u_j^n + \\nu u_{j-1}^n\n$$\n这就是一阶显式迎风有限差分格式。\n\n**2. 二阶 Lax–Wendroff 格式的推导**\n\n我们从 $u(x, t+\\Delta t)$ 在时间上的二阶泰勒级数展开开始：\n$$\nu(x, t+\\Delta t) = u(x,t) + \\Delta t\\,\\partial_t u(x,t) + \\frac{(\\Delta t)^2}{2}\\,\\partial_{tt} u(x,t) + O((\\Delta t)^3)\n$$\n从 PDE 中，我们可以用空间导数来表示时间导数：\n$$\n\\partial_t u = -c\\,\\partial_x u\n$$\n$$\n\\partial_{tt} u = \\partial_t(\\partial_t u) = \\partial_t(-c\\,\\partial_x u) = -c\\,\\partial_{xt} u = -c\\,\\partial_x(\\partial_t u) = -c\\,\\partial_x(-c\\,\\partial_x u) = c^2\\,\\partial_{xx} u\n$$\n将这些代入泰勒展开式：\n$$\nu(x, t+\\Delta t) \\approx u(x,t) - c\\,\\Delta t\\,\\partial_x u(x,t) + \\frac{c^2\\,(\\Delta t)^2}{2}\\,\\partial_{xx} u(x,t)\n$$\n现在，我们在 $(x_j, t^n)$ 处离散化这个表达式。我们使用二阶中心有限差分来近似空间导数：\n$$\n(\\partial_x u)_j^n \\approx \\frac{u_{j+1}^n - u_{j-1}^n}{2\\,\\Delta x}\n$$\n$$\n(\\partial_{xx} u)_j^n \\approx \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2}\n$$\n将这些代入离散化的时间展开方程得到：\n$$\nu_j^{n+1} = u_j^n - c\\,\\Delta t \\left(\\frac{u_{j+1}^n - u_{j-1}^n}{2\\,\\Delta x}\\right) + \\frac{c^2\\,(\\Delta t)^2}{2} \\left(\\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2}\\right)\n$$\n引入 CFL 数 $\\nu = \\frac{c\\,\\Delta t}{\\Delta x}$：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\nu}{2}(u_{j+1}^n - u_{j-1}^n) + \\frac{\\nu^2}{2}(u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\n这就是显式 Lax–Wendroff 格式。我们可以按空间索引对各项进行分组，以查看模板系数：\n$$\nu_j^{n+1} = \\left(\\frac{\\nu^2}{2} - \\frac{\\nu}{2}\\right) u_{j+1}^n + (1 - \\nu^2) u_j^n + \\left(\\frac{\\nu^2}{2} + \\frac{\\nu}{2}\\right) u_{j-1}^n\n$$\n\n**3. Von Neumann 稳定性分析**\n\n我们通过考察这些格式对单个傅里叶模态 $u_j^n = \\hat{u}^n\\,\\exp(i\\,j\\,\\theta)$ 的影响来分析它们的稳定性和传播特性，其中 $\\theta = k\\,\\Delta x$ 是无量纲波数。放大因子 $G(\\theta,\\nu)$ 由关系式 $\\hat{u}^{n+1} = G(\\theta,\\nu)\\,\\hat{u}^n$ 定义。\n\n**迎风格式的分析：**\n将傅里叶模态代入迎风格式 $u_j^{n+1} = (1-\\nu)u_j^n + \\nu u_{j-1}^n$：\n$$\n\\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta) = (1-\\nu)\\hat{u}^n\\,\\exp(i\\,j\\,\\theta) + \\nu\\hat{u}^n\\,\\exp(i\\,(j-1)\\,\\theta)\n$$\n两边同除以 $\\hat{u}^n\\,\\exp(i\\,j\\,\\theta)$：\n$$\nG_{\\mathrm{up}}(\\theta, \\nu) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^n} = (1-\\nu) + \\nu\\,\\exp(-i\\,\\theta)\n$$\n这就是迎风格式的精确放大因子。\n$G_{\\mathrm{up}}(\\theta, \\nu) = 1-\\nu + \\nu(\\cos\\theta - i\\sin\\theta) = (1-\\nu+\\nu\\cos\\theta) - i\\nu\\sin\\theta$。\n其模的平方是：\n$$\n|G_{\\mathrm{up}}|^2 = (1-\\nu+\\nu\\cos\\theta)^2 + (-\\nu\\sin\\theta)^2 = 1 - 2\\nu(1-\\nu)(1-\\cos\\theta) = 1 - 4\\nu(1-\\nu)\\sin^2(\\theta/2)\n$$\n为了保证稳定性，我们需要对所有 $\\theta$ 满足 $|G_{\\mathrm{up}}| \\le 1$。这意味着 $|G_{\\mathrm{up}}|^2 \\le 1$，所以 $-4\\nu(1-\\nu)\\sin^2(\\theta/2) \\le 0$。由于 $\\sin^2(\\theta/2) \\ge 0$ 且 $\\nu > 0$，我们需要 $1-\\nu \\ge 0$。稳定性条件是 $0  \\nu \\le 1$。\n\n**Lax-Wendroff 格式的分析：**\n将傅里叶模态代入 Lax-Wendroff 更新法则 $u_j^{n+1} = u_j^n - \\frac{\\nu}{2}(u_{j+1}^n - u_{j-1}^n) + \\frac{\\nu^2}{2}(u_{j+1}^n - 2u_j^n + u_{j-1}^n)$：\n$$\n\\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta) = \\hat{u}^n\\,\\exp(i\\,j\\,\\theta) - \\frac{\\nu}{2}\\hat{u}^n(\\exp(i(j+1)\\theta) - \\exp(i(j-1)\\theta)) + \\frac{\\nu^2}{2}\\hat{u}^n(\\exp(i(j+1)\\theta) - 2\\exp(ij\\theta) + \\exp(i(j-1)\\theta))\n$$\n两边同除以 $\\hat{u}^n\\,\\exp(i\\,j\\,\\theta)$：\n$$\nG_{\\mathrm{LW}}(\\theta, \\nu) = 1 - \\frac{\\nu}{2}(\\exp(i\\theta) - \\exp(-i\\theta)) + \\frac{\\nu^2}{2}(\\exp(i\\theta) - 2 + \\exp(-i\\theta))\n$$\n使用欧拉恒等式 $\\sin\\theta = \\frac{\\exp(i\\theta)-\\exp(-i\\theta)}{2i}$ 和 $\\cos\\theta = \\frac{\\exp(i\\theta)+\\exp(-i\\theta)}{2}$：\n$$\nG_{\\mathrm{LW}}(\\theta, \\nu) = 1 - i\\nu\\sin\\theta + \\nu^2(\\cos\\theta - 1)\n$$\n这就是 Lax-Wendroff 格式的精确放大因子。\n其模的平方是：\n$$\n|G_{\\mathrm{LW}}|^2 = (1+\\nu^2(\\cos\\theta-1))^2 + (-\\nu\\sin\\theta)^2 = (1-\\nu^2(1-\\cos\\theta))^2 + \\nu^2\\sin^2\\theta\n$$\n$$\n|G_{\\mathrm{LW}}|^2 = 1 - 2\\nu^2(1-\\cos\\theta) + \\nu^4(1-\\cos\\theta)^2 + \\nu^2(1-\\cos^2\\theta)\n$$\n由于 $1-\\cos^2\\theta = (1-\\cos\\theta)(1+\\cos\\theta)$,\n$$\n|G_{\\mathrm{LW}}|^2 = 1 - 2\\nu^2(1-\\cos\\theta) + \\nu^4(1-\\cos\\theta)^2 + \\nu^2(1-\\cos\\theta)(1+\\cos\\theta)\n$$\n$$\n|G_{\\mathrm{LW}}|^2 = 1 - \\nu^2(1-\\cos\\theta)^2 + \\nu^4(1-\\cos\\theta)^2 = 1 - \\nu^2(1-\\nu^2)(1-\\cos\\theta)^2\n$$\n$$\n|G_{\\mathrm{LW}}|^2 = 1 - 4\\nu^2(1-\\nu^2)\\sin^4(\\theta/2)\n$$\n为了保证稳定性，需满足 $|G_{\\mathrm{LW}}|^2 \\le 1$，这要求 $\\nu^2(1-\\nu^2) \\ge 0$。由于 $\\nu > 0$，这意味着 $1-\\nu^2 \\ge 0$，即 $\\nu^2 \\le 1$。稳定性条件是 $0  \\nu \\le 1$。\n\n**对于小的 $\\theta$ 的色散和耗散比较**\n- **耗散（振幅误差）：**\n对于迎风格式， $|G_{\\mathrm{up}}|^2 \\approx 1 - 4\\nu(1-\\nu)(\\theta/2)^2 = 1 - \\nu(1-\\nu)\\theta^2$。因此， $|G_{\\mathrm{up}}| \\approx 1 - \\frac{1}{2}\\nu(1-\\nu)\\theta^2$。振幅减小是 $\\mathcal{O}(\\theta^2)$ 阶的，表明存在显著的数值扩散。\n对于 Lax-Wendroff 格式， $|G_{\\mathrm{LW}}|^2 \\approx 1 - 4\\nu^2(1-\\nu^2)(\\theta/2)^4 = 1 - \\frac{1}{4}\\nu^2(1-\\nu^2)\\theta^4$。因此， $|G_{\\mathrm{LW}}| \\approx 1 - \\frac{1}{8}\\nu^2(1-\\nu^2)\\theta^4$。振幅减小是 $\\mathcal{O}(\\theta^4)$ 阶的，对于小的 $\\theta$，这个值要小得多，表明这是一个耗散性小得多的格式。\n- **色散（相位误差）：**\n数值相速度 $c_{\\mathrm{num}}$ 通过 $c_{\\mathrm{num}}/c = -\\arg(G)/(\\nu\\theta)$ 与物理速度 $c$ 相关联。\n对于迎风格式， $c_{\\mathrm{num}}/c \\approx 1 - \\frac{1}{6}(1-\\nu)(1-2\\nu)\\theta^2$。其相位误差取决于 $\\nu$。当 $\\nu  0.5$ 时，数值相速度小于物理速度（相位滞后）；当 $\\nu > 0.5$ 时，数值相速度大于物理速度（相位超前）；当 $\\nu=0.5$ 时，$\\mathcal{O}(\\theta^2)$ 阶的相位误差项消失。\n对于 Lax-Wendroff 格式， $c_{\\mathrm{num}}/c \\approx 1 - \\frac{1-\\nu^2}{6}\\theta^2$。由于 $0  \\nu \\le 1$，对于 $\\nu  1$，Lax-Wendroff 格式总是色散的且伴有相位滞后（$c_{\\mathrm{num}}  c$）。\n两种格式的相位误差都是 $\\mathcal{O}(\\theta^2)$ 阶的，这与它们在空间上是二阶精确的（隐式或显式地使用中心差分）相一致。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1 - \\nu + \\nu\\,\\exp(-i\\,\\theta)  1 - i\\,\\nu\\,\\sin(\\theta) + \\nu^2(\\cos(\\theta)-1) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "网络为表示节点间的复杂关系提供了一个强大的框架，从社交网络到基因调控网络无不如此。本练习聚焦于一个基本的随机网络模型——Erdős–Rényi图，并探索其宏观结构如何从微观连接规则中涌现。您将通过分析一个连通分支的探索过程，推导出“巨型组件”出现的临界阈值，从而深入理解复杂系统中相变这一核心概念。",
            "id": "4140762",
            "problem": "一个由互动主体构成的群体嵌入一个用于表示环境的随机网络中，该网络被建模为 Erdős–Rényi (ER) 随机图 $G(n,p)$：图中共有 $n$ 个带标签的顶点，$\\frac{n(n-1)}{2}$ 条可能的无向边中的每一条都以概率 $p$ 独立存在。均匀选择一个顶点的度分布为 $\\mathrm{Binomial}(n-1,p)$，并且对于大的 $n$，该图在有限距离内以高概率局部呈树状。令 $p = p(n)$ 并定义 $c_{n} \\equiv n p(n)$。在 $n \\to \\infty$ 的渐近状态下，仅使用这些基础性质来确定精确的阈值 $c^{\\star}$，使得如果 $c_{n} \\to c  c^{\\star}$，则最大连通分量的大小以高概率为 $o(n)$；而如果 $c_{n} \\to c > c^{\\star}$，则该图以高概率包含一个大小为 $\\Theta(n)$ 的连通分量。请将 $c^{\\star}$ 的值表示为单个精确实数。最终答案需表示为无舍入的精确值。",
            "solution": "该问题要求解 Erdős–Rényi 随机图 $G(n,p)$ 中“巨”连通分量出现的临界阈值。从所有分量都很小（大小为 $o(n)$）的状态，过渡到一个具有单个大分量（大小为 $\\Theta(n)$）的状态，是一种经典的相变现象。我们可以将连通分量的探索过程建模为分支过程，从而确定阈值 $c^{\\star}$。这种方法是合理的，因为给定性质表明对于大的 $n$，图是局部呈树状的。\n\n让我们考虑探索包含一个随机选择的顶点的连通分量的过程。这可以看作是广度优先搜索。我们从单个顶点（第 $0$ 代）开始。它的邻居构成第 $1$ 代。第 $1$ 代顶点的邻居（尚未被发现的）构成第 $2$ 代，依此类推。在极限 $n \\to \\infty$ 时，对于有限步数，遇到一个已经被访问过的顶点的概率可以忽略不计。这使我们能够将分量探索近似为一个 Galton-Watson 分支过程，其中顶点是“个体”，连接到新顶点的边代表“后代”。\n\n分支过程的命运（灭绝还是无限存续）由每个个体的平均后代数决定，我们记为 $\\mu$。分支过程的一个基本定理指出，如果 $\\mu > 1$，则有非零的存续概率；而如果 $\\mu  1$，则过程以概率 $1$ 灭绝。在我们的图论背景下，“存续”对应于一个大小为 $\\Theta(n)$ 的巨分量，而“灭绝”对应于一个大小为 $o(n)$ 的小分量。因此，相变发生在 $\\mu=1$ 处。\n\n我们的任务简化为计算平均后代数 $\\mu$ 作为参数 $c = \\lim_{n \\to \\infty} c_n = \\lim_{n \\to \\infty} n p(n)$ 的函数。在探索过程中，顶点 $v$ 的“后代”是它的邻居，不包括发现 $v$ 的那个顶点。因此，这样的后代数量为 $d(v) - 1$，其中 $d(v)$ 是 $v$ 的度。\n\n首先，我们确定一个随机均匀选择的顶点的度分布。问题陈述这是一种二项分布，$D \\sim \\mathrm{Binomial}(n-1, p)$。在 $n \\to \\infty$ 且 $p = c_n/n$（其中 $c_n \\to c$）的渐近状态下，该二项分布收敛于均值为 $c$ 的泊松分布。一个顶点度为 $k$ 的概率质量函数变为：\n$$ \\mathbb{P}(D=k) \\to \\frac{c^k e^{-c}}{k!} $$\n平均度为 $\\langle D \\rangle = \\sum_{k=0}^{\\infty} k \\, \\mathbb{P}(D=k) = c$。\n\n接下来，我们必须找到后代数量的分布。对于分支过程中除根节点外的任何顶点，我们都是通过遍历一条边到达它的。沿着一条随机边到达的顶点的度不遵循相同的 $\\mathrm{Poisson}(c)$ 分布。度高的顶点连接的边更多，因此它们更有可能被选中。一条边通向度为 $k$ 的顶点的概率与 $k \\mathbb{P}(D=k)$ 成正比。因此，随机边末端顶点的度 $D_{\\text{edge}}$ 的分布为：\n$$ \\mathbb{P}(D_{\\text{edge}}=k) = \\frac{k \\mathbb{P}(D=k)}{\\sum_j j \\mathbb{P}(D=j)} = \\frac{k \\mathbb{P}(D=k)}{\\langle D \\rangle} $$\n这样一个顶点的后代数量是其度减一，即 $D_{\\text{edge}} - 1$。平均后代数 $\\mu$ 是该量的期望值：\n$$ \\mu = \\mathbb{E}[D_{\\text{edge}} - 1] = \\mathbb{E}[D_{\\text{edge}}] - 1 $$\n期望值 $\\mathbb{E}[D_{\\text{edge}}]$ 为：\n$$ \\mathbb{E}[D_{\\text{edge}}] = \\sum_{k=1}^{\\infty} k \\, \\mathbb{P}(D_{\\text{edge}}=k) = \\sum_{k=1}^{\\infty} k \\frac{k \\mathbb{P}(D=k)}{\\langle D \\rangle} = \\frac{1}{\\langle D \\rangle} \\sum_{k=0}^{\\infty} k^2 \\mathbb{P}(D=k) = \\frac{\\langle D^2 \\rangle}{\\langle D \\rangle} $$\n对于参数为 $c$ 的泊松分布，均值为 $\\langle D \\rangle = c$，方差为 $\\mathrm{Var}(D) = c$。二阶矩由 $\\langle D^2 \\rangle = \\mathrm{Var}(D) + \\langle D \\rangle^2 = c + c^2$ 给出。\n代入这些值，我们得到平均后代数：\n$$ \\mu = \\frac{\\langle D^2 \\rangle}{\\langle D \\rangle} - 1 = \\frac{c + c^2}{c} - 1 = (1+c) - 1 = c $$\n在分支过程近似中，平均后代数等于 $c$，即图的渐近平均度。\n\n相变的临界阈值对应于平均后代数恰好为 $1$ 的点。\n$$ \\mu = 1 $$\n$$ c = 1 $$\n因此，阈值为 $c^{\\star} = 1$。如果 $c_n \\to c  1$，分支过程会灭绝，意味着最大分量的大小为 $o(n)$。如果 $c_n \\to c > 1$，分支过程以非零概率存续，意味着存在一个大小为 $\\Theta(n)$ 的巨分量。这与问题陈述中给出的条件完全一致。精确的阈值为 $1$。",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "在许多基于主体的模型中，环境是连续的空间，而主体或事件的分布往往是不均匀的。本练习介绍了一种强大而通用的“稀疏算法”（thinning algorithm），用于在连续域中生成非均匀泊松点过程。通过从第一性原理证明该算法的正确性并完成编程实现，您将掌握一项在计算生态学、流行病学和空间统计学中至关重要的模拟技术。",
            "id": "4140718",
            "problem": "您的任务是设计并实现一种稀疏算法，用于在连续域上模拟非齐次泊松点过程，并附上基于第一性原理的正确性论证。一个在可测域 $\\Omega \\subset \\mathbb{R}^{d}$ 上，具有非负可积强度函数 $\\lambda(x)$ 的非齐次泊松点过程由以下两个性质定义：对于每个有界可测子集 $A \\subset \\Omega$，点数 $N(A)$ 服从均值为 $\\int_{A} \\lambda(x)\\,dx$ 的泊松分布；对于两两不交的可测子集 $A_{1}, \\dots, A_{k}$，随机变量 $N(A_{1}), \\dots, N(A_{k})$ 是独立的。\n\n您必须从一个在相同域上具有恒定速率 $\\Lambda_{\\max}$（其中 $\\Lambda_{\\max} \\ge \\sup_{x \\in \\Omega} \\lambda(x)$）的齐次泊松点过程出发，推导并实现一个基于稀疏法的模拟器。该算法必须纯粹用数学术语表达，并用代码实现。角度必须解释为弧度。\n\n您可以假设的基本前提包括泊松点过程的定义、泊松分布的性质以及标准的独立性和条件概率法则。目标稀疏算法不能被假设；它必须从基本前提推导得出。您还必须通过证明您的模拟器输出满足非齐次泊松点过程的定义性质来论证其正确性。\n\n算法任务：为代表连续空间的两种环境实现以下稀疏模拟器。\n\n1. 对于区间 $[0, T]$ 上的一维时间，强度为 $\\lambda(t)$，上界为 $\\Lambda_{\\max}$：\n   - 通过抽取泊松数 $N \\sim \\mathrm{Poisson}(\\Lambda_{\\max} T)$ 个候选时间，并将它们独立均匀地放置在 $[0, T]$ 中，生成一个速率为 $\\Lambda_{\\max}$ 的齐次泊松过程。\n   - 对于每个候选时间 $t$，以概率 $p(t) = \\lambda(t)/\\Lambda_{\\max}$ 独立地保留它，否则丢弃它。\n   - 对保留的时间进行排序，以获得模拟的非齐次过程。\n\n2. 对于矩形 $[a_{x}, b_{x}] \\times [a_{y}, b_{y}]$ 上的二维空间，强度为 $\\lambda(x,y)$，上界为 $\\Lambda_{\\max}$：\n   - 通过抽取 $N \\sim \\mathrm{Poisson}(\\Lambda_{\\max} |[a_{x}, b_{x}] \\times [a_{y}, b_{y}]|)$ 个候选点，并将它们独立均匀地放置在矩形中，生成一个速率为 $\\Lambda_{\\max}$ 的齐次泊松点过程。\n   - 对于每个候选点 $(x, y)$，以概率 $p(x,y) = \\lambda(x,y)/\\Lambda_{\\max}$ 独立地保留它，否则丢弃它。\n\n对于一维情况，定义积分强度 $\\Lambda(t) = \\int_{0}^{t} \\lambda(s)\\,ds$。对于一个保留时间为 $0  t_{1}  \\cdots  t_{n} \\le T$ 的实现，定义变换后的增量 $e_{i} = \\Lambda(t_{i}) - \\Lambda(t_{i-1})$，并约定 $t_{0} = 0$。时间重标度定理指出，如果 $(t_{i})$ 是一个强度为 $\\lambda(t)$ 的非齐次泊松过程，那么 $(e_{i})$ 是独立同分布于 $\\mathrm{Exponential}(1)$ 的随机变量。\n\n您的实现必须使用上述算法和以下固定的测试套件来产生确定性输出。为了保证可复现性，您必须为伪随机数生成器使用指定的种子。所有角度都以弧度为单位。不涉及任何物理单位。\n\n测试套件：\n\n- 测试 $1$（一维正弦强度）：在 $[0, T]$ 上模拟，其中 $T = 10$，$\\lambda(t) = 2 + \\sin(t)$，$\\Lambda_{\\max} = 3$。使用伪随机种子 $314159$。令 $n_{1}$ 为保留事件的数量，令 $D_{1}$ 为通过单样本柯尔莫哥洛夫-斯米尔诺夫检验，比较 $(e_{i})$ 的经验分布与 $\\mathrm{Exponential}(1)$ 分布的柯尔莫哥洛夫-斯米尔诺夫统计量。\n\n- 测试 $2$（二维$x$方向线性强度）：在 $[a_{x}, b_{x}] \\times [a_{y}, b_{y}] = [0, 1] \\times [0, 1]$ 上模拟，其中 $\\lambda(x,y) = 10 (1 + x)$，$\\Lambda_{\\max} = 20$。使用伪随机种子 $271828$。令 $n_{2}$ 为保留点的数量，令 $\\bar{x}_{2}$ 为保留点 $x$ 坐标的样本均值，令 $\\delta_{2} = \\bar{x}_{2} - \\frac{5}{9}$，其中 $\\frac{5}{9}$ 是在 $[0,1]$ 上与 $1+x$ 成正比的归一化密度下，$x$ 均值的精确期望值。\n\n- 测试 $3$（带零值区域的一维分段强度）：在 $[0, T]$ 上模拟，其中 $T = 5$，当 $t \\in [0, 2.5]$ 时 $\\lambda(t) = 0$，当 $t \\in (2.5, 5]$ 时 $\\lambda(t) = 4$，且 $\\Lambda_{\\max} = 4$。使用伪随机种子 $161803$。令 $n_{3}^{(L)}$ 为在 $[0, 2.5]$ 中保留的事件数，令 $n_{3}^{(R)}$ 为在 $(2.5, 5]$ 中保留的事件数。\n\n- 测试 $4$（一维极低齐次强度）：在 $[0, T]$ 上模拟，其中 $T = 10$，$\\lambda(t) = 10^{-3}$，$\\Lambda_{\\max} = 10^{-3}$。使用伪随机种子 $141421$。令 $n_{4}$ 为保留事件的总数。\n\n答案规格：\n\n- 您的程序必须输出一行，包含测试套件的结果，顺序和类型如下：$[n_{1}, D_{1}, n_{2}, \\bar{x}_{2}, \\delta_{2}, n_{3}^{(L)}, n_{3}^{(R)}, n_{4}]$。\n- 浮点数 $D_{1}$、$\\bar{x}_{2}$ 和 $\\delta_{2}$ 必须四舍五入到小数点后恰好六位。整数必须不经四舍五入直接打印。输出必须是单行，形式为用方括号括起来的逗号分隔列表，且不含空格，例如 $[42,0.123456,17,0.555556,0.000000,0,9,0]$。",
            "solution": "一个在域 $\\Omega \\subset \\mathbb{R}^{d}$ 上，具有非负可积强度函数 $\\lambda(x)$ 的非齐次泊松点过程（IPPP）由两个定义性质刻画：\n1. 对于任何有界可测子集 $A \\subset \\Omega$，点数 $N(A)$ 服从均值为 $\\mu(A) = \\int_{A} \\lambda(x)\\,dx$ 的泊松分布。\n2. 对于任何有限个两两不交的可测子集 $A_{1}, \\dots, A_{k} \\subset \\Omega$，随机变量 $N(A_{1}), \\dots, N(A_{k})$ 是独立的。\n\n稀疏算法模拟了这样一个过程。它始于一个在相同域 $\\Omega$ 上的齐次泊松点过程（HPPP），记为 $\\mathcal{P}_{\\text{hom}}$，其速率为常数 $\\Lambda_{\\max}$，其中 $\\Lambda_{\\max}$ 是强度函数的上界，即 $\\Lambda_{\\max} \\ge \\sup_{x \\in \\Omega} \\lambda(x)$。然后，通过以位置相关的概率 $p(x) = \\lambda(x) / \\Lambda_{\\max}$ 独立地保留来自 $\\mathcal{P}_{\\text{hom}}$ 的每个点 $x$，生成一个新的点过程 $\\mathcal{P}_{\\text{thin}}$。此过程称为稀疏化。我们现在必须证明，得到的点过程 $\\mathcal{P}_{\\text{thin}}$ 确实是一个强度为 $\\lambda(x)$ 的 IPPP。\n\n**正确性证明**\n\n我们必须验证 $\\mathcal{P}_{\\text{thin}}$ 满足 IPPP 的两个定义性质。\n\n**1. 点数分布**\n设 $A$ 是 $\\Omega$ 的一个有界可测子集。我们需要证明，在 $A$ 内来自稀疏过程的点数，记为 $N_{\\text{thin}}(A)$，服从均值为 $\\int_{A} \\lambda(x)\\,dx$ 的泊松分布。\n\nHPPP 在集合 $A$ 内的点数，记为 $N_{\\text{hom}}(A)$，是一个服从均值为 $\\Lambda_{\\max} |A|$ 的泊松分布的随机变量，其中 $|A|$ 是 $A$ 的勒贝格测度。其概率质量函数为 $P(N_{\\text{hom}}(A)=k) = e^{-\\Lambda_{\\max} |A|} \\frac{(\\Lambda_{\\max} |A|)^k}{k!}$，其中 $k \\in \\{0, 1, 2, \\dots\\}$。\n\n给定 $N_{\\text{hom}}(A) = k$，HPPP 的 $k$ 个点在集合 $A$ 内是独立均匀分布的。设这些点为 $\\{Y_1, \\dots, Y_k\\}$。每个点 $Y_j$ 以概率 $p(Y_j) = \\lambda(Y_j) / \\Lambda_{\\max}$ 被保留。设 $I_j$ 是一个指示变量，如果点 $Y_j$ 被保留则为 $1$，否则为 $0$。在 $A$ 中被保留的点的总数是 $N_{\\text{thin}}(A) = \\sum_{j=1}^k I_j$。\n\n一个更正式的推导如下。我们在 $N_{\\text{hom}}(A)=k$ 的条件下进行计算，然后对 $k$ 的泊松分布求平均。给定 $k$ 个在 $A$ 中均匀分布的点，保留一个点的平均概率是 $\\bar{p}_A = E[p(Y_j)] = \\int_A p(y) f_Y(y)\\,dy = \\int_A \\frac{\\lambda(y)}{\\Lambda_{\\max}} \\frac{1}{|A|}\\,dy = \\frac{1}{\\Lambda_{\\max} |A|} \\int_A \\lambda(y)\\,dy$。由于点是独立稀疏化的，在 $k$ 次试验中被保留点的数量 $N_{\\text{thin}}(A)$ 服从二项分布 $B(k, \\bar{p}_A)$。因此，$P(N_{\\text{thin}}(A)=n | N_{\\text{hom}}(A)=k) = \\binom{k}{n} (\\bar{p}_A)^n (1-\\bar{p}_A)^{k-n}$。\n\n使用全概率定律，$N_{\\text{thin}}(A)$ 的无条件概率质量函数是：\n$$ P(N_{\\text{thin}}(A)=n) = \\sum_{k=n}^{\\infty} P(N_{\\text{thin}}(A)=n | N_{\\text{hom}}(A)=k) P(N_{\\text{hom}}(A)=k) $$\n$$ P(N_{\\text{thin}}(A)=n) = \\sum_{k=n}^{\\infty} \\left[ \\binom{k}{n} (\\bar{p}_A)^n (1-\\bar{p}_A)^{k-n} \\right] \\left[ e^{-\\Lambda_{\\max} |A|} \\frac{(\\Lambda_{\\max} |A|)^k}{k!} \\right] $$\n通过重新整理各项：\n$$ P(N_{\\text{thin}}(A)=n) = \\frac{(\\bar{p}_A \\Lambda_{\\max} |A|)^n}{n!} e^{-\\Lambda_{\\max} |A|} \\sum_{k=n}^{\\infty} \\frac{1}{(k-n)!} \\left( (1-\\bar{p}_A) \\Lambda_{\\max} |A| \\right)^{k-n} $$\n令 $j=k-n$。求和部分变为 $\\sum_{j=0}^{\\infty} \\frac{1}{j!} ((1-\\bar{p}_A)\\Lambda_{\\max} |A|)^j$，这是 $e^{(1-\\bar{p}_A)\\Lambda_{\\max} |A|}$ 的泰勒级数。\n将其代回，我们得到：\n$$ P(N_{\\text{thin}}(A)=n) = \\frac{(\\bar{p}_A \\Lambda_{\\max} |A|)^n}{n!} e^{-\\Lambda_{\\max} |A|} e^{(1-\\bar{p}_A)\\Lambda_{\\max} |A|} $$\n$$ P(N_{\\text{thin}}(A)=n) = \\frac{(\\bar{p}_A \\Lambda_{\\max} |A|)^n}{n!} e^{-\\bar{p}_A \\Lambda_{\\max} |A|} $$\n这是均值为 $\\mu_{\\text{thin}} = \\bar{p}_A \\Lambda_{\\max} |A|$ 的泊松分布的概率质量函数。代入 $\\bar{p}_A$ 的表达式：\n$$ \\mu_{\\text{thin}} = \\left( \\frac{1}{\\Lambda_{\\max} |A|} \\int_A \\lambda(y)\\,dy \\right) \\Lambda_{\\max} |A| = \\int_A \\lambda(y)\\,dy $$\n因此，$N_{\\text{thin}}(A) \\sim \\text{Poisson}(\\int_A \\lambda(x)\\,dx)$，满足第一个性质。\n\n**2. 计数的独立性**\n设 $A_1, \\dots, A_k$ 是 $\\Omega$ 的两两不交的可测子集。我们必须证明计数 $N_{\\text{thin}}(A_1), \\dots, N_{\\text{thin}}(A_k)$ 是独立的随机变量。\n\nHPPP $\\mathcal{P}_{\\text{hom}}$ 的一个基本性质是，限制在不相交集合上的点过程是独立的。这意味着随机点集 $\\mathcal{P}_{\\text{hom}} \\cap A_1, \\dots, \\mathcal{P}_{\\text{hom}} \\cap A_k$ 是相互独立的。\n\n稀疏化操作是独立地对 $\\mathcal{P}_{\\text{hom}}$ 的每个点进行的，与其他所有点无关。保留点 $x \\in A_i$ 的决定仅取决于其位置 $x$ 和一次独立的随机抽取（例如，将 $\\lambda(x)/\\Lambda_{\\max}$ 与从 $U(0,1)$ 中抽取的值进行比较）。这个决定不受任何在另一集合 $A_j$（其中 $j \\neq i$）中的点的存在或保留情况的影响。\n\n由于不相交集合 $A_i$ 中的初始点构型是独立的，并且每个集合内的稀疏化操作与其他集合的操作是独立的，因此得到的稀疏点构型 $\\mathcal{P}_{\\text{thin}} \\cap A_1, \\dots, \\mathcal{P}_{\\text{thin}} \\cap A_k$ 也是相互独立的。因此，它们各自的计数 $N_{\\text{thin}}(A_1), \\dots, N_{\\text{thin}}(A_k)$ 是独立的随机变量。这就确立了第二个性质。\n\nIPPP 的两个定义性质都得到了满足。因此，稀疏算法正确地生成了具有所需强度函数 $\\lambda(x)$ 的非齐次泊松点过程的一个实现。条件 $\\Lambda_{\\max} \\ge \\sup \\lambda(x)$ 至关重要，因为它保证了保留概率 $p(x) = \\lambda(x)/\\Lambda_{\\max}$ 是有良好定义且位于区间 $[0, 1]$ 内的。\n\n**代码实现**\n```python\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the thinning algorithm simulator.\n    \"\"\"\n    \n    def test_1(seed):\n        \"\"\"\n        Test 1: 1D sinusoidal intensity.\n        Simulates on [0, T] with T = 10, lambda(t) = 2 + sin(t), and Lambda_max = 3.\n        Calculates number of events and KS statistic vs. Exponential(1).\n        \"\"\"\n        rng = np.random.default_rng(seed)\n        T = 10.0\n        Lambda_max = 3.0\n        \n        lambda_t = lambda t: 2 + np.sin(t)\n        \n        # 1. Generate homogeneous Poisson process candidates\n        num_candidates = rng.poisson(Lambda_max * T)\n        candidate_times = rng.uniform(0, T, num_candidates)\n        \n        # 2. Thin the candidates\n        retention_probs = lambda_t(candidate_times) / Lambda_max\n        retained_mask = rng.uniform(0, 1, num_candidates)  retention_probs\n        retained_times = candidate_times[retained_mask]\n        \n        n1 = len(retained_times)\n        \n        # 3. Sort times and perform time-rescaling\n        retained_times.sort()\n        \n        # Integrated intensity: Lambda(t) = integral_0^t (2+sin(s))ds = 2t - cos(t) + 1\n        Lambda_of_t = lambda t: 2 * t - np.cos(t) + 1\n        \n        if n1 >= 1:\n            Lambda_vals = Lambda_of_t(retained_times)\n            # Transformed increments e_i = Lambda(t_i) - Lambda(t_{i-1})\n            e_values = np.diff(Lambda_vals, prepend=Lambda_of_t(0))\n            # 4. Compare with Exponential(1) using KS test\n            ks_result = stats.kstest(e_values, 'expon')\n            D1 = ks_result.statistic\n        else:\n            D1 = 0.0\n        \n        return n1, D1\n\n    def test_2(seed):\n        \"\"\"\n        Test 2: 2D linear intensity in x.\n        Simulates on [0, 1]x[0, 1] with lambda(x,y) = 10(1+x), Lambda_max = 20.\n        Calculates number of points, sample mean of x, and its deviation from theoretical mean.\n        \"\"\"\n        rng = np.random.default_rng(seed)\n        ax, bx = 0.0, 1.0\n        ay, by = 0.0, 1.0\n        Lambda_max = 20.0\n        \n        area = (bx - ax) * (by - ay)\n        lambda_xy = lambda x, y: 10 * (1 + x)\n        \n        # 1. Generate homogeneous Poisson process candidates\n        num_candidates = rng.poisson(Lambda_max * area)\n        candidate_points_x = rng.uniform(ax, bx, num_candidates)\n        candidate_points_y = rng.uniform(ay, by, num_candidates)\n        \n        # 2. Thin the candidates\n        retention_probs = lambda_xy(candidate_points_x, candidate_points_y) / Lambda_max\n        retained_mask = rng.uniform(0, 1, num_candidates)  retention_probs\n        retained_points_x = candidate_points_x[retained_mask]\n        \n        n2 = len(retained_points_x)\n        \n        if n2 == 0:\n            x_bar_2 = 0.0\n        else:\n            x_bar_2 = np.mean(retained_points_x)\n            \n        # Theoretical mean E[X] for density proportional to 1+x on [0,1] is 5/9\n        delta_2 = x_bar_2 - 5/9\n        \n        return n2, x_bar_2, delta_2\n\n    def test_3(seed):\n        \"\"\"\n        Test 3: 1D piecewise intensity.\n        Simulates on [0, 5] with lambda(t) = 0 for t in [0, 2.5] and 4 for t in (2.5, 5].\n        Lambda_max = 4. Counts events in each part of the interval.\n        \"\"\"\n        rng = np.random.default_rng(seed)\n        T = 5.0\n        Lambda_max = 4.0\n        \n        def lambda_t(t):\n            return np.piecewise(t, [t = 2.5], [0, 4])\n\n        # 1. Generate homogeneous Poisson process candidates\n        num_candidates = rng.poisson(Lambda_max * T)\n        candidate_times = rng.uniform(0, T, num_candidates)\n        \n        # 2. Thin the candidates\n        retention_probs = lambda_t(candidate_times) / Lambda_max\n        retained_mask = rng.uniform(0, 1, num_candidates)  retention_probs\n        retained_times = candidate_times[retained_mask]\n        \n        # 3. Count events in specified intervals\n        n3_L = np.sum(retained_times = 2.5)\n        n3_R = np.sum(retained_times > 2.5)\n        \n        return n3_L, n3_R\n\n    def test_4(seed):\n        \"\"\"\n        Test 4: 1D very low homogeneous intensity.\n        Simulates on [0, 10] with lambda(t) = 1e-3, Lambda_max = 1e-3.\n        Calculates total number of events.\n        \"\"\"\n        rng = np.random.default_rng(seed)\n        T = 10.0\n        lambda_val = 1e-3\n        Lambda_max = 1e-3 # This implies retention probability is 1\n        \n        # Since lambda/Lambda_max = 1, all candidates are retained.\n        # The number of events is just a draw from Poisson(lambda * T).\n        n4 = rng.poisson(lambda_val * T)\n        \n        return n4\n\n    # Run all tests with specified seeds\n    n1, D1 = test_1(seed=314159)\n    n2, x_bar_2, delta_2 = test_2(seed=271828)\n    n3_L, n3_R = test_3(seed=161803)\n    n4 = test_4(seed=141421)\n\n    # Assemble results and format them as specified\n    output_list = [\n        str(n1),\n        f'{D1:.6f}',\n        str(n2),\n        f'{x_bar_2:.6f}',\n        f'{delta_2:.6f}',\n        str(n3_L),\n        str(n3_R),\n        str(n4)\n    ]\n    \n    # Print statement to generate the answer\n    # print(f\"[{','.join(output_list)}]\")\n\nsolve()\n```",
            "answer": "[24,0.155703,12,0.551733,-0.003822,0,11,0]"
        }
    ]
}