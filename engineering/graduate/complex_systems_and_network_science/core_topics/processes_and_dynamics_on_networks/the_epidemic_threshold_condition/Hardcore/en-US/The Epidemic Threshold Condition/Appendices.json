{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of network epidemiology is understanding how network structure governs the potential for widespread contagion. A powerful first-principles approach involves analyzing the stability of the disease-free state through linearization of the governing dynamical equations. This exercise  guides you through this fundamental derivation, showing that the epidemic threshold is inversely related to the largest eigenvalue of the network's adjacency matrix, $\\lambda_{\\max}$. By applying this general result to the special case of a $k$-regular graph, you will establish a crucial baseline result and gain proficiency in the spectral analysis of epidemic dynamics.",
            "id": "4309101",
            "problem": "Consider a continuous-time Susceptible–Infected–Susceptible (SIS) epidemic process on a finite, simple, undirected, connected, $k$-regular graph with $n$ nodes, where the adjacency matrix is denoted by $A \\in \\mathbb{R}^{n \\times n}$. Each infected node recovers at rate $\\delta  0$, and each susceptible node becomes infected by each infected neighbor at rate $\\beta  0$. Let the effective spreading rate be $\\tau = \\beta / \\delta$. Under the $N$-intertwined mean-field approximation (NIMFA), let $p_{i}(t)$ denote the probability that node $i$ is infected at time $t$, and collect these into the vector $p(t) \\in \\mathbb{R}^{n}$. By linearizing the NIMFA dynamics around the disease-free equilibrium $p(t) = 0$, analyze the stability of this equilibrium in terms of the spectrum of the adjacency matrix $A$. From first principles and using only well-tested facts about spectra of nonnegative matrices, derive the epidemic threshold $\\tau_{c}$ as a function of the largest eigenvalue of $A$ and then specialize your result to the given $k$-regular graph. Your final answer must be a single closed-form analytic expression in terms of $k$ only. Do not provide intermediate threshold inequalities. Express the final answer exactly, with no rounding, and do not include any units.",
            "solution": "### Derivation\n\nThe dynamics of the probability $p_i(t)$ that node $i$ is infected at time $t$ are modeled under the $N$-intertwined mean-field approximation (NIMFA). The rate of change of $p_i(t)$ is given by the balance between the rate of infection and the rate of recovery.\n\nA node $i$ that is infected (with probability $p_i$) recovers at a constant rate $\\delta$. This contributes a term $-\\delta p_i$ to the rate of change.\n\nA node $i$ that is susceptible (with probability $1 - p_i$) becomes infected through contact with its infected neighbors. Under a common formulation of the NIMFA, which is appropriate for linearization, the infection pressure from neighbors is treated as additive. The rate at which susceptible node $i$ becomes infected is $\\beta (1-p_i) \\sum_{j=1}^{n} A_{ij} p_j$, where $A_{ij}=1$ if nodes $i$ and $j$ are connected and $A_{ij}=0$ otherwise.\n\nCombining these terms, the NIMFA dynamical system is described by the set of $n$ coupled ordinary differential equations:\n$$\n\\frac{dp_i}{dt} = \\beta (1 - p_i) \\sum_{j=1}^{n} A_{ij} p_j - \\delta p_i, \\quad \\text{for } i = 1, \\dots, n.\n$$\nThe disease-free equilibrium (DFE) is the state where all nodes are susceptible, i.e., $p_i = 0$ for all $i$. We can verify that $p = 0$ is indeed an equilibrium point by substituting it into the equations, which yields $\\frac{dp_i}{dt} = 0$.\n\nTo analyze the stability of the DFE, we linearize the system around $p = 0$. Let $f_i(p) = \\beta (1 - p_i) \\sum_{j=1}^{n} A_{ij} p_j - \\delta p_i$. The linearized system is $\\frac{dp}{dt} = J p$, where $J$ is the Jacobian matrix evaluated at the DFE, with entries $J_{ij} = \\frac{\\partial f_i}{\\partial p_j}|_{p=0}$.\n\nWe compute the partial derivatives:\nFor $i \\neq j$:\n$$\n\\frac{\\partial f_i}{\\partial p_j} = \\frac{\\partial}{\\partial p_j} \\left[ \\beta (1 - p_i) \\sum_{k=1}^{n} A_{ik} p_k - \\delta p_i \\right] = \\beta (1 - p_i) A_{ij}.\n$$\nEvaluating at $p = 0$ (so $p_i=0$), we get $J_{ij} = \\beta A_{ij}$.\n\nFor $i = j$:\n$$\n\\frac{\\partial f_i}{\\partial p_i} = \\frac{\\partial}{\\partial p_i} \\left[ \\beta (1 - p_i) \\sum_{k=1}^{n} A_{ik} p_k - \\delta p_i \\right] = -\\beta \\sum_{k=1}^{n} A_{ik} p_k + \\beta(1-p_i)A_{ii} - \\delta.\n$$\nSince the graph is simple, $A_{ii}=0$. Evaluating at $p = 0$, we get $J_{ii} = -\\delta$.\n\nThe Jacobian matrix at the DFE is therefore $J = \\beta A - \\delta I$, where $I$ is the $n \\times n$ identity matrix. The linearized system is $\\frac{dp}{dt} = (\\beta A - \\delta I) p$.\n\nThe stability of the DFE is determined by the eigenvalues of $J$. The DFE is stable if all eigenvalues of $J$ have negative real parts, and unstable if at least one eigenvalue has a positive real part. The epidemic threshold is the condition where the largest real part of any eigenvalue of $J$ is zero.\n\nLet $\\lambda_m$ be an eigenvalue of the adjacency matrix $A$ with corresponding eigenvector $v_m$. Since the graph is undirected, $A$ is a real symmetric matrix, and all its eigenvalues $\\lambda_m$ are real.\nThe eigenvalues $\\mu_m$ of $J$ are related to the eigenvalues of $A$:\n$$\nJ v_m = (\\beta A - \\delta I) v_m = \\beta (A v_m) - \\delta v_m = \\beta \\lambda_m v_m - \\delta v_m = (\\beta \\lambda_m - \\delta) v_m.\n$$\nThus, the eigenvalues of $J$ are $\\mu_m = \\beta \\lambda_m - \\delta$.\n\nThe stability is governed by the largest eigenvalue of $J$, denoted $\\mu_{\\max}$:\n$$\n\\mu_{\\max} = \\max_{m} (\\mu_m) = \\max_{m} (\\beta \\lambda_m - \\delta) = \\beta (\\max_m \\lambda_m) - \\delta = \\beta \\lambda_{\\max} - \\delta.\n$$\nHere, $\\lambda_{\\max}$ is the largest eigenvalue of the adjacency matrix $A$. Since the graph is connected, its adjacency matrix $A$ is irreducible and non-negative. By the Perron-Frobenius theorem, $\\lambda_{\\max}$ is real, positive, and simple.\n\nAn epidemic can emerge and persist if the DFE is unstable, which corresponds to $\\mu_{\\max} > 0$:\n$$\n\\beta \\lambda_{\\max} - \\delta > 0 \\implies \\frac{\\beta}{\\delta} \\lambda_{\\max} > 1.\n$$\nUsing the definition of the effective spreading rate, $\\tau = \\beta / \\delta$, the condition for an epidemic outbreak is $\\tau \\lambda_{\\max} > 1$.\n\nThe epidemic threshold, $\\tau_c$, is the critical value of $\\tau$ at which the stability changes. This occurs when $\\mu_{\\max} = 0$, which gives:\n$$\n\\tau_c \\lambda_{\\max} = 1 \\implies \\tau_c = \\frac{1}{\\lambda_{\\max}}.\n$$\nThis is the general epidemic threshold for the NIMFA model on any network, expressed in terms of the largest eigenvalue of its adjacency matrix.\n\nThe problem requires us to specialize this result for a $k$-regular graph. A graph is $k$-regular if every node has degree $k$. This property implies that each row sum of the adjacency matrix $A$ is equal to $k$:\n$$\n\\sum_{j=1}^{n} A_{ij} = k \\quad \\text{for all } i=1, \\dots, n.\n$$\nConsider the vector of all ones, $\\mathbf{1} = (1, 1, \\dots, 1)^T$. The action of $A$ on $\\mathbf{1}$ is:\n$$\n(A\\mathbf{1})_i = \\sum_{j=1}^{n} A_{ij} (1) = k.\n$$\nThus, $A\\mathbf{1} = k\\mathbf{1}$. This shows that $k$ is an eigenvalue of $A$ with eigenvector $\\mathbf{1}$.\n\nFor any graph, the largest eigenvalue is bounded by the maximum degree, $\\lambda_{\\max} \\leq k_{\\max}$. For a $k$-regular graph, $k_{\\max} = k$. Since we have found an eigenvalue equal to $k$, it must be the largest eigenvalue. Therefore, for a $k$-regular graph, $\\lambda_{\\max} = k$.\n\nSubstituting this result into the general expression for the epidemic threshold:\n$$\n\\tau_c = \\frac{1}{k}.\n$$\nThis is the final expression for the epidemic threshold on a $k$-regular graph under the NIMFA.",
            "answer": "$$\\boxed{\\frac{1}{k}}$$"
        },
        {
            "introduction": "The adjacency matrix spectral radius provides a good estimate for the epidemic threshold in dense or regular graphs, but its accuracy can degrade in sparse, heterogeneous networks where local tree-like structures dominate. To achieve greater precision, we can turn to more refined models that better capture the non-backtracking nature of early-stage transmission paths. This advanced practice  asks you to derive the threshold for an SIR process on an Erdős–Rényi graph using two powerful, modern techniques: a Galton-Watson branching process approximation and an analysis of the non-backtracking matrix. Successfully completing this exercise will not only equip you with advanced tools but also reveal the deep theoretical link between microscopic cascade dynamics and the spectra of more sophisticated network operators.",
            "id": "4309002",
            "problem": "Consider a susceptible–infectious–removed (SIR) process on an Erdős–Rényi random graph $G(n,p)$ in the sparse regime, where $p = c/(n-1)$ so that the mean degree $c$ remains $O(1)$ as $n \\to \\infty$. Each infectious node transmits to each susceptible neighbor independently with a single-edge transmissibility $T \\in [0,1]$. Define the epidemic threshold $T_c$ as the infimum of $T$ such that, in the limit $n \\to \\infty$, a macroscopic outbreak (a giant infected component) occurs with nonzero probability.\n\nUsing only fundamental definitions and first principles appropriate to locally tree-like random graphs, perform the following two independent computations and reconcile them:\n\n- Starting from the definition of the size-biased (excess) degree distribution and a Galton–Watson branching-process approximation of early-time spread on a locally tree-like configuration model, derive the condition for emergence of a giant infected cluster as a function of $T$ and the degree-distribution moments of $G(n,p)$. Specialize your derivation to the Erdős–Rényi case in the sparse regime to obtain $T_c$ as a closed-form function of the mean degree $c$.\n\n- Define the non-backtracking (Hashimoto) matrix $\\mathbf{B}$ on the set of directed edges of the graph, and write the edge-based message-passing fixed-point equations for the SIR process that express the probability that infection does not traverse a directed edge. Linearize these equations about the disease-free fixed point and express the instability condition in terms of the spectral radius $\\rho(\\mathbf{B})$. Evaluate the leading-order asymptotic of $\\rho(\\mathbf{B})$ for $G(n,p)$ in the sparse regime, and obtain $T_c$ as a closed-form function of $c$.\n\nExplain why the two expressions you obtain for $T_c$ agree in the limit $n \\to \\infty$ under the assumptions stated. Provide your final answer for $T_c$ as a single closed-form expression in terms of $c$. No numerical evaluation is required, and no units are involved. The final answer must be a single analytic expression.",
            "solution": "### Derivation\n\nWe will proceed by first deriving the epidemic threshold using the branching process approximation, followed by the derivation using the non-backtracking matrix formalism. Finally, we will demonstrate their equivalence.\n\n#### Derivation 1: Branching Process Approximation\n\nIn the early stages of an epidemic on a large, sparse random graph (which is locally tree-like), the spread of the disease from an initial seed node can be modeled as a Galton-Watson branching process. An outbreak becomes macroscopic if and only if this branching process has a non-zero probability of surviving indefinitely. This occurs when the expected number of offspring of an individual exceeds $1$.\n\nLet $P(k)$ be the degree distribution of the graph. The mean degree is $\\langle k \\rangle = \\sum_k k P(k)$.\nThe initial infected node is chosen uniformly at random. Let's assume it infects its neighbors. The \"offspring\" are the newly infected nodes in the next generation. A node that becomes infected was reached by traversing an edge from its infector. The degree distribution of a node reached by following a random edge is not $P(k)$, but the size-biased or excess degree distribution, denoted $q_k$. The probability of choosing an edge connected to a node of degree $k$ is proportional to $k P(k)$. Normalizing gives:\n$$q_k = \\frac{k P(k)}{\\sum_j j P(j)} = \\frac{k P(k)}{\\langle k \\rangle}$$\nSuch a node, having been reached via one of its edges, has $k-1$ \"other\" edges through which it can propagate the infection. This is the excess degree.\n\nThe branching process we consider is that of infected edges. An infected node `u` that was infected from a neighbor `v` will attempt to transmit the infection to its $k_u-1$ other neighbors. The probability of successful transmission along any single edge is $T$. The expected number of new successful transmissions originating from node `u` is $T(k_u-1)$.\n\nTo determine if the epidemic spreads, we need the average of this quantity over all possible nodes `u` that could be at the second step of the chain. The degree $k_u$ of such a node follows the distribution $q_k$. Therefore, the expected number of subsequent infections, which we call the branching ratio $R_*$, is:\n$$R_* = \\sum_{k=1}^{\\infty} T(k-1)q_k = T \\sum_{k=1}^{\\infty} (k-1) \\frac{k P(k)}{\\langle k \\rangle}$$\n$$R_* = \\frac{T}{\\langle k \\rangle} \\sum_{k=1}^{\\infty} (k^2 - k) P(k) = \\frac{T}{\\langle k \\rangle} \\left( \\sum_{k=1}^{\\infty} k^2 P(k) - \\sum_{k=1}^{\\infty} k P(k) \\right)$$\nUsing the definitions of the first and second moments of the degree distribution, $\\langle k \\rangle = \\sum_k k P(k)$ and $\\langle k^2 \\rangle = \\sum_k k^2 P(k)$, we have:\n$$R_* = T \\frac{\\langle k^2 \\rangle - \\langle k \\rangle}{\\langle k \\rangle}$$\nA macroscopic outbreak occurs if $R_* > 1$. The epidemic threshold $T_c$ corresponds to the critical point $R_* = 1$.\n$$T_c \\frac{\\langle k^2 \\rangle - \\langle k \\rangle}{\\langle k \\rangle} = 1 \\implies T_c = \\frac{\\langle k \\rangle}{\\langle k^2 \\rangle - \\langle k \\rangle}$$\nThis is the general result for a network described by the configuration model.\n\nNow, we specialize this result to the Erdős–Rényi graph $G(n,p)$ in the sparse limit ($p = c/(n-1)$, $n \\to \\infty$). In this limit, the degree distribution $P(k)$ converges to a Poisson distribution with mean $c$:\n$$P(k) = \\frac{\\exp(-c) c^k}{k!}$$\nFor a Poisson distribution, the moments are well-known:\n-   First moment (mean): $\\langle k \\rangle = c$.\n-   Second moment: $\\langle k^2 \\rangle = \\text{Var}(k) + \\langle k \\rangle^2 = c + c^2$.\n\nSubstituting these moments into the expression for $T_c$:\n$$T_c = \\frac{c}{(c + c^2) - c} = \\frac{c}{c^2} = \\frac{1}{c}$$\n\n#### Derivation 2: Non-Backtracking Matrix Method\n\nThis method analyzes the stability of the disease-free state using edge-based message-passing equations. Let $P_{u \\to v}$ be the probability that node $u$ does *not* transmit the infection to its neighbor $v$ over the entire course of the epidemic, starting from a vanishingly small seed of infection.\n\nFor $u$ not to infect $v$, one of two mutually exclusive events must occur:\n1.  Node $u$ itself is never infected by any of its neighbors other than $v$. The probability of this is $\\prod_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} P_{w \\to u}$, assuming independence on the locally tree-like structure.\n2.  Node $u$ is infected by at least one neighbor other than $v$ (with probability $1 - \\prod_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} P_{w \\to u}$), but the transmission from $u$ to $v$ fails (with probability $1-T$).\n\nCombining these gives the self-consistent fixed-point equation for $P_{u \\to v}$:\n$$P_{u \\to v} = \\left( \\prod_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} P_{w \\to u} \\right) \\cdot 1 + \\left( 1 - \\prod_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} P_{w \\to u} \\right) (1-T)$$\n$$P_{u \\to v} = (1-T) + T \\prod_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} P_{w \\to u}$$\nThe disease-free state corresponds to no infection transmission, so $P_{u \\to v} = 1$ for all directed edges $u \\to v$. This is a trivial fixed point: $1 = (1-T) + T \\cdot 1$.\n\nTo find the epidemic threshold, we analyze the stability of this fixed point. Let's introduce a small perturbation: $P_{u \\to v} = 1 - \\epsilon_{u \\to v}$, where $\\epsilon_{u \\to v} > 0$ is infinitesimal. Substituting this into the fixed-point equation and linearizing:\n$$1 - \\epsilon_{u \\to v} = (1-T) + T \\prod_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} (1 - \\epsilon_{w \\to u})$$\nFor small $\\epsilon$, we use the approximation $\\prod(1-\\epsilon_i) \\approx 1 - \\sum \\epsilon_i$:\n$$1 - \\epsilon_{u \\to v} \\approx (1-T) + T \\left( 1 - \\sum_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} \\epsilon_{w \\to u} \\right)$$\n$$1 - \\epsilon_{u \\to v} \\approx 1 - T + T - T \\sum_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} \\epsilon_{w \\to u}$$\n$$\\epsilon_{u \\to v} = T \\sum_{w \\in \\mathcal{N}(u) \\setminus \\{v\\}} \\epsilon_{w \\to u}$$\nThis is a linear system of equations for the perturbations $\\epsilon_{u \\to v}$. We can write this in matrix form. Let $\\vec{\\epsilon}$ be a vector stacking all the $\\epsilon_{u \\to v}$ values for the $2|E|$ directed edges of the graph. The equation becomes:\n$$\\vec{\\epsilon} = T \\mathbf{B} \\vec{\\epsilon}$$\nwhere $\\mathbf{B}$ is the non-backtracking (or Hashimoto) matrix of the graph. Its elements are defined as $B_{(u \\to v), (w \\to u)} = 1$ if $w \\neq v$ and $0$ otherwise. That is, it maps incoming non-backtracking edges to an outgoing edge.\n\nThe disease-free fixed point is unstable if the perturbation $\\vec{\\epsilon}$ can grow. This occurs if the linear operator $T\\mathbf{B}$ has an eigenvalue greater than $1$. The condition for the onset of instability is when the largest eigenvalue (the spectral radius) of the operator equals $1$:\n$$\\rho(T\\mathbf{B}) = 1 \\implies T \\rho(\\mathbf{B}) = 1$$\nThis gives the epidemic threshold as $T_c = 1/\\rho(\\mathbf{B})$.\n\nThe final step is to determine the spectral radius $\\rho(\\mathbf{B})$ for a sparse ER graph. It is a known result in random matrix theory that for a random graph from the configuration model with degree distribution $P(k)$ in the large $n$ limit, the spectral radius of the non-backtracking matrix converges to the mean excess degree:\n$$\\rho(\\mathbf{B}) \\to \\frac{\\langle k^2 \\rangle - \\langle k \\rangle}{\\langle k \\rangle}$$\nAs this result applies to the ER graph case, we can again use the moments of the limiting Poisson degree distribution, $\\langle k \\rangle = c$ and $\\langle k^2 \\rangle = c+c^2$:\n$$\\rho(\\mathbf{B}) \\to \\frac{(c+c^2) - c}{c} = \\frac{c^2}{c} = c$$\nTherefore, the epidemic threshold from this method is:\n$$T_c = \\frac{1}{\\rho(\\mathbf{B})} = \\frac{1}{c}$$\n\n#### Reconciliation of the Two Methods\n\nBoth methods yield the identical result, $T_c = 1/c$. The agreement is not coincidental; it reflects a deep connection between the two formalisms when applied to locally tree-like graphs.\n\n1.  **Shared Core Concept**: Both methods identify the same critical quantity governing the explosion of an epidemic cascade: the branching factor of infection along the paths of the network. The local tree-like structure of a large sparse random graph is central to both approaches.\n\n2.  **Branching Process Perspective**: Method 1 explicitly models the epidemic as a tree-like branching process. The condition for growth, $R_* > 1$, is based on the expected number of new infections ($T \\times$ number of neighbors) generated by a node that was itself just infected. The average number of available \"forward\" neighbors is the mean excess degree, $\\frac{\\langle k^2 \\rangle - \\langle k \\rangle}{\\langle k \\rangle}$.\n\n3.  **Spectral Perspective**: Method 2 analyzes the propagation of infection \"messages\" or probabilities along directed edges. The non-backtracking matrix $\\mathbf{B}$ is the adjacency matrix of a graph whose nodes are directed edges and whose links represent non-backtracking paths of length $2$. The spectral radius $\\rho(\\mathbf{B})$ governs the exponential growth rate of the number of non-backtracking walks on the graph. On a tree, this growth rate is simply the average branching factor at each node. For a large random graph that is locally a tree, $\\rho(\\mathbf{B})$ converges to the average branching factor for paths, which is precisely the mean excess degree, $\\frac{\\langle k^2 \\rangle - \\langle k \\rangle}{\\langle k \\rangle}$.\n\nIn essence, the branching factor of the Galton-Watson process in Method 1 is the physical manifestation of the mathematical quantity that emerges as the spectral radius of the non-backtracking matrix in Method 2. The instability condition $T \\rho(\\mathbf{B}) > 1$ is a restatement of the supercritical condition for the branching process, $T \\frac{\\langle k^2 \\rangle - \\langle k \\rangle}{\\langle k \\rangle} > 1$. Both methods are thus equivalent ways of capturing the condition for perennial infective spread on a sparse network.",
            "answer": "$$\\boxed{\\frac{1}{c}}$$"
        },
        {
            "introduction": "With several theoretical approximations at our disposal—from simple degree-based estimates to more complex spectral methods—a crucial practical question arises: which one should we use for a given network? The answer lies in the network's structural features, as different models rely on different underlying assumptions about the network topology, such as the prevalence of loops or degree heterogeneity. This final practice  is a hands-on coding exercise where you will analyze a suite of networks by computing key structural properties. By implementing a set of decision rules, you will gain practical experience in diagnosing network structures and making informed choices about which theoretical model is most appropriate for predicting the epidemic threshold.",
            "id": "4309023",
            "problem": "Consider the Susceptible-Infected-Susceptible (SIS) process on undirected, simple graphs. The objective is to decide, for each given network, which approximation to the epidemic threshold is most appropriate based on measurable structural properties. You must write a complete program that, for each test case, computes the following quantities on the undirected adjacency matrix $A$ of the network:\n\n- The degree sequence $\\{k_i\\}_{i=1}^n$ with $k_i = \\sum_{j=1}^n A_{ij}$.\n- The degree heterogeneity $H = \\dfrac{\\langle k^2 \\rangle}{\\langle k \\rangle^2}$, where $\\langle \\cdot \\rangle$ denotes the average over nodes.\n- The degree-degree Pearson assortativity $r$ across edges, defined as the Pearson correlation coefficient of the degrees at the two ends of each edge. If there are no edges or the variance of degrees at edge ends is zero, take $r = 0$.\n- The average clustering coefficient $C$, defined as the average of the local clustering coefficients $C_i$ over all nodes, where for node $i$ with degree $k_i \\ge 2$, $C_i = \\dfrac{\\text{number of edges among neighbors of }i}{\\binom{k_i}{2}}$, and if $k_i  2$, take $C_i = 0$.\n- The spectral radius $\\rho(A)$ of the adjacency matrix $A$, defined as the maximum absolute value of the eigenvalues of $A$.\n- The spectral radius $\\rho(B)$ of the non-backtracking matrix $B$, constructed from the set of directed edges of $A$ as follows: for each undirected edge $\\{u,v\\}$ include directed edges $(u \\to v)$ and $(v \\to u)$; then $B_{(u \\to v),(x \\to y)} = 1$ if and only if $v = x$ and $y \\ne u$, and $B_{(u \\to v),(x \\to y)} = 0$ otherwise.\n\nYour program must then recommend one of three threshold approximations according to the following decision rules, expressed purely in terms of the computed network metrics:\n\n- If $C \\ge 0.1$, recommend the non-backtracking operator approximation (code $2$).\n- Else, if $|r| \\ge 0.2$ or $H \\ge 3.0$, recommend the adjacency operator (quenched mean-field) approximation (code $0$).\n- Else, recommend the degree-based (heterogeneous mean-field) approximation (code $1$).\n\nFor each test case, output only the integer code corresponding to the recommended approximation, using the mapping: adjacency operator $0$, degree-based $1$, non-backtracking operator $2$.\n\nYour program must handle the following test suite of undirected networks, given by their adjacency matrices. For each matrix $A^{(t)}$, nodes are indexed from $0$ to $n-1$, and $A^{(t)}_{ij} = 1$ if there is an edge between nodes $i$ and $j$, and $A^{(t)}_{ij} = 0$ otherwise; all $A^{(t)}$ are symmetric with zero diagonal.\n\n- Test case $1$ (a star on $6$ nodes with center at node $0$):\n$$\nA^{(1)} =\n\\begin{pmatrix}\n0  1  1  1  1  1 \\\\\n1  0  0  0  0  0 \\\\\n1  0  0  0  0  0 \\\\\n1  0  0  0  0  0 \\\\\n1  0  0  0  0  0 \\\\\n1  0  0  0  0  0\n\\end{pmatrix}.\n$$\n\n- Test case $2$ (an $8$-node ring lattice, each node connected to two nearest neighbors):\n$$\nA^{(2)}_{ij} = \n\\begin{cases}\n1  \\text{if } j = (i-1) \\bmod 8 \\text{ or } j = (i+1) \\bmod 8, \\\\\n0  \\text{otherwise}.\n\\end{cases}\n$$\n\n- Test case $3$ (a $3$-node triangle):\n$$\nA^{(3)} =\n\\begin{pmatrix}\n0  1  1 \\\\\n1  0  1 \\\\\n1  1  0\n\\end{pmatrix}.\n$$\n\n- Test case $4$ (a complete graph on $5$ nodes):\n$$\nA^{(4)}_{ij} =\n\\begin{cases}\n0  \\text{if } i = j, \\\\\n1  \\text{if } i \\ne j.\n\\end{cases}\n$$\n\nFinal output format requirement: Your program should produce a single line of output containing the results for the test cases in order, as a comma-separated list enclosed in square brackets, for example, $[a_1,a_2,a_3,a_4]$, where each $a_t$ is the integer code for test case $t$.",
            "solution": "The task is to recommend an appropriate approximation for the epidemic threshold in a Susceptible-Infected-Susceptible (SIS) model on a given network. The recommendation is determined by a set of heuristic rules based on calculated structural properties of the network. For each provided adjacency matrix $A$, we must compute several network metrics and apply the decision rules in the specified order.\n\nThe required metrics for the decision logic are the degree heterogeneity $H$, the degree-degree assortativity $r$, and the average clustering coefficient $C$. The decision rules are as follows:\n1.  If $C \\ge 0.1$, recommend the non-backtracking operator approximation (code $2$).\n2.  Otherwise, if $|r| \\ge 0.2$ or $H \\ge 3.0$, recommend the adjacency operator approximation (code $0$).\n3.  Otherwise, recommend the degree-based approximation (code $1$).\n\nWe will systematically calculate these metrics for each of the four test cases and apply the rules to determine the appropriate recommendation code. The problem also asks to compute the spectral radii $\\rho(A)$ and $\\rho(B)$, which will be done in the accompanying program, but these values are not used in the decision logic itself.\n\n**1. Metric Definitions**\n\nLet $A$ be the adjacency matrix of a simple, undirected graph with $n$ nodes.\n- **Degree sequence**: The degree of node $i$ is $k_i = \\sum_{j=1}^n A_{ij}$.\n- **Degree heterogeneity $H$**: $H = \\dfrac{\\langle k^2 \\rangle}{\\langle k \\rangle^2}$, where $\\langle k^m \\rangle = \\frac{1}{n} \\sum_{i=1}^n k_i^m$.\n- **Assortativity $r$**: The Pearson correlation coefficient of the degrees at the endpoints of all edges in the network. Let $E$ be the set of edges. We construct two lists, $K_1$ and $K_2$, containing the degrees of the nodes at each end of every edge. Then $r = \\text{PearsonCorr}(K_1, K_2)$. If the number of edges is zero or the variance of degrees at the edge ends is zero, $r=0$.\n- **Average Clustering Coefficient $C$**: $C = \\frac{1}{n} \\sum_{i=1}^n C_i$. The local clustering coefficient for node $i$ is $C_i = \\frac{T_i}{\\binom{k_i}{2}}$, where $T_i$ is the number of triangles connected to node $i$ (or edges between its neighbors). $T_i$ can be calculated as $\\frac{1}{2} \\sum_{j,l} A_{ij}A_{jl}A_{li} = \\frac{(A^3)_{ii}}{2}$. If $k_i  2$, we take $C_i=0$.\n\n**2. Analysis of Test Cases**\n\n**Test Case 1: 6-node Star Graph**\n- The adjacency matrix $A^{(1)}$ represents a star graph with node $0$ as the center.\n- **Degrees**: The central node has degree $k_0 = 5$. The five peripheral nodes each have degree $k_i = 1$ for $i \\in \\{1, ..., 5\\}$.\n- **Degree Heterogeneity $H$**:\n  $$ \\langle k \\rangle = \\frac{5 + 5 \\times 1}{6} = \\frac{10}{6} = \\frac{5}{3} $$\n  $$ \\langle k^2 \\rangle = \\frac{5^2 + 5 \\times 1^2}{6} = \\frac{25 + 5}{6} = 5 $$\n  $$ H = \\frac{\\langle k^2 \\rangle}{\\langle k \\rangle^2} = \\frac{5}{(5/3)^2} = \\frac{5}{25/9} = \\frac{45}{25} = 1.8 $$\n- **Assortativity $r$**: All edges connect the central node (degree $5$) to a peripheral node (degree $1$). The degree pairs for all edges are $(5,1)$. The list of degrees at both ends of the edges has zero variance. Therefore, as per the problem definition, $r=0$.\n- **Clustering Coefficient $C$**:\n  - For the central node ($i=0$), $k_0=5$. Its neighbors are $\\{1,2,3,4,5\\}$. There are no edges between these neighbors. Thus, $C_0=0$.\n  - For the peripheral nodes ($i \\in \\{1,...,5\\}$), $k_i=1$. Since $k_i  2$, $C_i=0$.\n  - The average clustering coefficient is $C = \\frac{1}{6}\\sum_i C_i = 0$.\n- **Decision**:\n  1. Is $C \\ge 0.1$? No ($0  0.1$).\n  2. Is $|r| \\ge 0.2$ or $H \\ge 3.0$? No ($|0|  0.2$ and $1.8  3.0$).\n  3. Else: Recommend code $1$.\n- **Result for Case 1**: $1$.\n\n**Test Case 2: 8-node Ring Lattice**\n- The graph is a cycle graph $C_8$, which is a $2$-regular graph.\n- **Degrees**: Every node has degree $k_i = 2$.\n- **Degree Heterogeneity $H$**: For any regular graph, all degrees are identical, so $\\langle k^2 \\rangle = k^2$ and $\\langle k \\rangle = k$. Thus, $H = \\frac{k^2}{k^2} = 1$.\n- **Assortativity $r$**: This is a regular graph, so the degrees at both ends of any edge are $(2,2)$. The variance is zero, so $r=0$.\n- **Clustering Coefficient $C$**: For any node $i$, its neighbors are not connected to each other. The number of triangles is $0$. Thus, $C_i=0$ for all $i$, and the average is $C=0$.\n- **Decision**:\n  1. Is $C \\ge 0.1$? No ($0  0.1$).\n  2. Is $|r| \\ge 0.2$ or $H \\ge 3.0$? No ($|0|  0.2$ and $1  3.0$).\n  3. Else: Recommend code $1$.\n- **Result for Case 2**: $1$.\n\n**Test Case 3: 3-node Triangle**\n- The graph is a complete graph $K_3$, which is a $2$-regular graph.\n- **Degrees**: Every node has degree $k_i = 2$.\n- **Degree Heterogeneity $H$**: The graph is regular, so $H=1$.\n- **Assortativity $r$**: The graph is regular, so $r=0$.\n- **Clustering Coefficient $C$**: For any node $i$, its two neighbors are connected, forming the triangle.\n  $$ C_i = \\frac{\\text{number of edges among neighbors}}{\\binom{k_i}{2}} = \\frac{1}{\\binom{2}{2}} = 1 $$\n  The average clustering coefficient is $C=1$.\n- **Decision**:\n  1. Is $C \\ge 0.1$? Yes ($1 \\ge 0.1$).\n  2. Recommend code $2$.\n- **Result for Case 3**: $2$.\n\n**Test Case 4: 5-node Complete Graph**\n- The graph is a complete graph $K_5$, which is a $4$-regular graph.\n- **Degrees**: Every node has degree $k_i = 4$.\n- **Degree Heterogeneity $H$**: The graph is regular, so $H=1$.\n- **Assortativity $r$**: The graph is regular, so $r=0$.\n- **Clustering Coefficient $C$**: For any node $i$, its $k_i=4$ neighbors form a complete graph $K_4$. The number of edges among them is $\\binom{4}{2} = 6$.\n  $$ C_i = \\frac{\\text{number of edges among neighbors}}{\\binom{k_i}{2}} = \\frac{6}{\\binom{4}{2}} = \\frac{6}{6} = 1 $$\n  The average clustering coefficient is $C=1$.\n- **Decision**:\n  1. Is $C \\ge 0.1$? Yes ($1 \\ge 0.1$).\n  2. Recommend code $2$.\n- **Result for Case 4**: $2$.\n\nThe final list of recommendation codes for the test cases in order is $[1, 1, 2, 2]$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef analyze_network(A):\n    \"\"\"\n    Computes network metrics and returns the recommended approximation code.\n\n    The function computes all metrics specified in the problem, though not all\n    are used in the final decision logic.\n    \"\"\"\n    n = A.shape[0]\n    if n == 0:\n        return 1 # Default for an empty graph\n\n    # --- Compute Degree-based metrics ---\n    k = A.sum(axis=1)\n    \n    # Degree Heterogeneity H\n    mean_k = k.mean()\n    if mean_k == 0:\n        H = 0.0 # Graph with no edges\n    else:\n        mean_k2 = (k**2).mean()\n        H = mean_k2 / (mean_k**2)\n\n    # --- Compute Assortativity r ---\n    edges = np.where(np.triu(A, 1))\n    num_edges = len(edges[0])\n\n    if num_edges == 0:\n        r = 0.0\n    else:\n        deg_u = k[edges[0]]\n        deg_v = k[edges[1]]\n        \n        # As per problem, if variance is zero, r=0.\n        if deg_u.std() == 0 or deg_v.std() == 0:\n            r = 0.0\n        else:\n            # Pearson correlation coefficient calculation\n            mean_u, mean_v = deg_u.mean(), deg_v.mean()\n            numerator = np.sum((deg_u - mean_u) * (deg_v - mean_v))\n            denominator = np.sqrt(np.sum((deg_u - mean_u)**2) * np.sum((deg_v - mean_v)**2))\n            if denominator == 0:\n                 r = 0.0\n            else:\n                 r = numerator / denominator\n\n    # --- Compute Average Clustering Coefficient C ---\n    C_i_list = []\n    # Using the A^3 formula for triangles is efficient for small, dense graphs.\n    A_cubed = np.linalg.matrix_power(A, 3)\n    for i in range(n):\n        ki = k[i]\n        if ki  2:\n            C_i = 0.0\n        else:\n            # num_triangles is half the diagonal of A^3\n            num_triangles = A_cubed[i, i] / 2.0\n            # num_possible_triangles is k_i choose 2\n            num_possible_triangles = ki * (ki - 1) / 2.0\n            C_i = num_triangles / num_possible_triangles\n        C_i_list.append(C_i)\n    \n    C = np.mean(C_i_list) if C_i_list else 0.0\n\n    # --- Compute Spectral Radii (not used in decision logic, but required) ---\n    # Spectral Radius of Adjacency Matrix A\n    if n  0:\n        eigenvalues_A = np.linalg.eigvals(A)\n        rho_A = np.max(np.abs(eigenvalues_A))\n    else:\n        rho_A = 0.0\n\n    # Spectral Radius of Non-backtracking Matrix B\n    if num_edges == 0:\n        rho_B = 0.0\n    else:\n        # Construct the non-backtracking matrix B\n        dir_edges = []\n        rows, cols = np.where(A == 1)\n        for u, v in zip(rows, cols):\n            dir_edges.append((u, v))\n        \n        num_dir_edges = len(dir_edges)\n        edge_to_idx = {edge: i for i, edge in enumerate(dir_edges)}\n        \n        # B can be large, use integer type for efficiency\n        B = np.zeros((num_dir_edges, num_dir_edges), dtype=np.int8)\n\n        for i, edge1 in enumerate(dir_edges):\n            u, v = edge1\n            # Find all outgoing edges from node v\n            successors = np.where(A[v, :] == 1)[0]\n            for y in successors:\n                # Non-backtracking condition: y != u\n                if y != u:\n                    j = edge_to_idx[(v, y)]\n                    B[i, j] = 1\n\n        eigenvalues_B = np.linalg.eigvals(B)\n        rho_B = np.max(np.abs(eigenvalues_B))\n\n    # --- Apply Decision Rules ---\n    if C = 0.1:\n        return 2  # Non-backtracking operator approximation\n    elif abs(r) = 0.2 or H = 3.0:\n        return 0  # Adjacency operator (quenched mean-field) approximation\n    else:\n        return 1  # Degree-based (heterogeneous mean-field) approximation\n\ndef solve():\n    # Test Case 1: 6-node star graph\n    A1 = np.array([\n        [0, 1, 1, 1, 1, 1],\n        [1, 0, 0, 0, 0, 0],\n        [1, 0, 0, 0, 0, 0],\n        [1, 0, 0, 0, 0, 0],\n        [1, 0, 0, 0, 0, 0],\n        [1, 0, 0, 0, 0, 0]\n    ])\n\n    # Test Case 2: 8-node ring lattice\n    n2 = 8\n    A2 = np.zeros((n2, n2), dtype=int)\n    for i in range(n2):\n        A2[i, (i - 1) % n2] = 1\n        A2[i, (i + 1) % n2] = 1\n\n    # Test Case 3: 3-node triangle\n    A3 = np.array([\n        [0, 1, 1],\n        [1, 0, 1],\n        [1, 1, 0]\n    ])\n\n    # Test Case 4: 5-node complete graph\n    n4 = 5\n    A4 = np.ones((n4, n4), dtype=int) - np.eye(n4, dtype=int)\n\n    test_cases = [A1, A2, A3, A4]\n    \n    results = []\n    for A in test_cases:\n        result = analyze_network(A)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}