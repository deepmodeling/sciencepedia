{
    "hands_on_practices": [
        {
            "introduction": "在基于主体的建模中，一个最基本的设计决策是更新调度，它决定了主体执行其规则的顺序。在同步（所有主体同时更新）和异步（主体逐个更新）更新之间的选择，看似是一个次要的技术细节。然而，本练习将揭示这一个选择如何导致截然不同的涌现动态，例如导致系统剧烈振荡或稳定在某个固定状态。通过手动追踪一个简单的双主体系统，您将对这个关键概念获得深刻、直观的理解。",
            "id": "4113495",
            "problem": "考虑一个复杂自适应系统建模领域中的基于主体的模型（Agent-Based Model, ABM），该模型包含两个主体，标记为 $i \\in \\{1,2\\}$，它们位于一个由一条连接这两个主体的边组成的无向网络上。在离散时间 $t \\in \\mathbb{Z}_{\\ge 0}$，每个主体都有一个二元状态 $x_i(t) \\in \\{0,1\\}$。该ABM采用确定性阈值决策规则：当且仅当一个主体的邻居中处于活跃状态的比例达到或超过其阈值时，该主体才会在下一个时间步变为活跃状态。形式上，对于任何主体 $i$，令 $N_i$ 表示 $i$ 的邻居集合，令 $m_i(\\tau) = \\frac{1}{|N_i|} \\sum_{j \\in N_i} x_j(\\tau)$ 为在更新参考时间 $\\tau$ 时邻居中处于活跃状态的比例。主体 $i$ 的阈值参数为 $\\theta_i \\in [0,1]$，其个体更新规则为\n$$\nx_i(\\text{next}) = \n\\begin{cases}\n1,  \\text{if } m_i(\\tau) \\ge \\theta_i, \\\\\n0,  \\text{if } m_i(\\tau)  \\theta_i.\n\\end{cases}\n$$\n考虑两种更新机制：\n\n- 同步更新：两个主体都使用时间 $t$ 的状态计算 $m_i(t)$，并根据阈值规则同时设置 $x_i(t+1)$。\n- 按固定顺序 $(1,2)$ 的序贯更新：主体1首先使用 $m_1(t)$ 更新以设置 $x_1(t+1)$，然后主体2使用 $m_2(t+1)$ 更新，其中 $m_2(t+1)$ 是根据主体1更新后最新的可用邻居状态计算的。\n\n假设初始条件为 $x_1(0) = 0$ 和 $x_2(0) = 1$，阈值为 $\\theta_1 = \\frac{1}{2}$ 和 $\\theta_2 = 1$。由于网络只有一条边，每个主体的 $m_i(\\tau)$ 等于其邻居在指定参考时间的状态。将有限时间范围 $T$ 内的轨迹差异定义为两种机制轨迹之间的累积汉明距离，\n$$\nD(T) = \\sum_{t=0}^{T} \\left( \\left| x_1^{\\text{sync}}(t) - x_1^{\\text{seq}}(t) \\right| + \\left| x_2^{\\text{sync}}(t) - x_2^{\\text{seq}}(t) \\right| \\right),\n$$\n其中 $x_i^{\\text{sync}}(t)$ 和 $x_i^{\\text{seq}}(t)$ 分别表示在同步和序贯更新下，主体 $i$ 在时间 $t$ 的状态。\n\n计算时间范围 $T = 10$ 时的 $D(T)$。请以单个实数形式提供最终答案。本题无需进行四舍五入。",
            "solution": "该问题定义明确，科学上基于基于主体的模型（ABM）和复杂自适应系统理论，并包含得出唯一解所需的所有信息。验证标准已满足。\n\n任务是计算在同步和序贯更新机制下，一个双主体系统在时间范围 $T=10$ 内的状态轨迹之间的累积汉明距离 $D(T)$。我们首先分析主体的更新规则，然后模拟两种机制下的轨迹，最后计算所需的总和。\n\n首先，我们为阈值为 $\\theta_1 = \\frac{1}{2}$ 和 $\\theta_2 = 1$ 的主体 $i \\in \\{1, 2\\}$ 形式化更新规则。网络由一条连接两个主体的边组成，因此主体1的邻居集合为 $N_1 = \\{2\\}$，主体2的邻居集合为 $N_2 = \\{1\\}$。主体 $i$ 的活跃邻居比例为 $m_i(\\tau) = \\frac{1}{|N_i|} \\sum_{j \\in N_i} x_j(\\tau)$。这可以简化为 $m_1(\\tau) = x_2(\\tau)$ 和 $m_2(\\tau) = x_1(\\tau)$。\n\n个体更新规则为：若 $m_i(\\tau) \\ge \\theta_i$，则 $x_i(\\text{next}) = 1$，否则 $x_i(\\text{next}) = 0$。鉴于二元状态空间 $x_i \\in \\{0, 1\\}$，每个主体的规则变为：\n- 对于主体1：当且仅当 $x_2(\\tau) \\ge \\theta_1 = \\frac{1}{2}$ 时，$x_1(\\text{next}) = 1$。这意味着只有当 $x_2(\\tau)=1$ 时，$x_1(\\text{next}) = 1$。因此，规则为 $x_1(\\text{next}) = x_2(\\tau)$。\n- 对于主体2：当且仅当 $x_1(\\tau) \\ge \\theta_2 = 1$ 时，$x_2(\\text{next}) = 1$。这意味着只有当 $x_1(\\tau)=1$ 时，$x_2(\\text{next}) = 1$。因此，规则为 $x_2(\\text{next}) = x_1(\\tau)$。\n\n现在我们从初始条件 $(x_1(0), x_2(0)) = (0, 1)$ 开始，生成两种更新机制下的轨迹。\n\n**1. 同步更新轨迹**\n在同步更新下，两个主体的下一状态都是基于系统在时间 $t$ 的当前状态计算的。规则是：\n$$\n\\begin{cases}\nx_1^{\\text{sync}}(t+1) = x_2^{\\text{sync}}(t) \\\\\nx_2^{\\text{sync}}(t+1) = x_1^{\\text{sync}}(t)\n\\end{cases}\n$$\n我们计算 $t \\in \\{0, 1, \\dots, 10\\}$ 时的状态向量 $(x_1^{\\text{sync}}(t), x_2^{\\text{sync}}(t))$：\n- $t=0$：$(0, 1)$ (初始条件)\n- $t=1$：$(x_1(1), x_2(1)) = (x_2(0), x_1(0)) = (1, 0)$\n- $t=2$：$(x_1(2), x_2(2)) = (x_2(1), x_1(1)) = (0, 1)$\n- $t=3$：$(x_1(3), x_2(3)) = (x_2(2), x_1(2)) = (1, 0)$\n系统以周期为 $2$ 进行振荡。当 $t$ 为偶数时，状态为 $(0, 1)$；当 $t$ 为奇数时，状态为 $(1, 0)$。\n\n**2. 序贯更新轨迹（顺序 1, 2）**\n在顺序为 $(1, 2)$ 的序贯更新下，主体1首先根据时间 $t$ 的状态更新其在时间 $t+1$ 的状态。然后，主体2使用最新的状态更新其在时间 $t+1$ 的状态，这包括主体1刚刚更新过的状态。\n从 $t$ 到 $t+1$ 的一个时间步的规则是：\n$$\n\\begin{cases}\nx_1^{\\text{seq}}(t+1) = x_2^{\\text{seq}}(t) \\\\\nx_2^{\\text{seq}}(t+1) = x_1^{\\text{seq}}(t+1)\n\\end{cases}\n$$\n我们计算 $t \\in \\{0, 1, \\dots, 10\\}$ 时的状态向量 $(x_1^{\\text{seq}}(t), x_2^{\\text{seq}}(t))$：\n- $t=0$：$(0, 1)$ (初始条件)\n- $t=1$：\n  - 主体1更新：$x_1^{\\text{seq}}(1) = x_2^{\\text{seq}}(0) = 1$。\n  - 主体2更新：$x_2^{\\text{seq}}(1) = x_1^{\\text{seq}}(1) = 1$。\n  - 在 $t=1$ 时的状态是 $(1, 1)$。\n- $t=2$：\n  - 主体1更新：$x_1^{\\text{seq}}(2) = x_2^{\\text{seq}}(1) = 1$。\n  - 主体2更新：$x_2^{\\text{seq}}(2) = x_1^{\\text{seq}}(2) = 1$。\n  - 在 $t=2$ 时的状态是 $(1, 1)$。\n系统在 $t=1$ 时达到不动点 $(1, 1)$。因此，对于所有 $t \\ge 1$，状态为 $(x_1^{\\text{seq}}(t), x_2^{\\text{seq}}(t)) = (1, 1)$。\n\n**3. 计算轨迹差异 $D(10)$**\n轨迹差异定义为 $D(T) = \\sum_{t=0}^{T} d(t)$，其中每步的汉明距离为 $d(t) = |x_1^{\\text{sync}}(t) - x_1^{\\text{seq}}(t)| + |x_2^{\\text{sync}}(t) - x_2^{\\text{seq}}(t)|$。我们计算从 $t=0$ 到 $10$ 的每个 $t$ 对应的 $d(t)$。\n\n- 对于 $t=0$：\n  - $x^{\\text{sync}}(0) = (0, 1)$ 且 $x^{\\text{seq}}(0) = (0, 1)$。\n  - $d(0) = |0-0| + |1-1| = 0$。\n\n- 对于 $t \\ge 1$：\n  - 序贯轨迹是固定的：$x^{\\text{seq}}(t) = (1, 1)$。\n  - 同步轨迹是交替的。\n  - 对于奇数 $t \\in \\{1, 3, 5, 7, 9\\}$：\n    - $x^{\\text{sync}}(t) = (1, 0)$。\n    - $d(t) = |1-1| + |0-1| = 0 + 1 = 1$。\n  - 对于偶数 $t \\in \\{2, 4, 6, 8, 10\\}$：\n    - $x^{\\text{sync}}(t) = (0, 1)$。\n    - $d(t) = |0-1| + |1-1| = 1 + 0 = 1$。\n\n所以，我们得到 $d(0)=0$ 以及对于所有 $t \\in \\{1, 2, \\dots, 10\\}$ 都有 $d(t)=1$。\n\n最后，我们将这些值相加来求得 $D(10)$：\n$$\nD(10) = \\sum_{t=0}^{10} d(t) = d(0) + \\sum_{t=1}^{10} d(t)\n$$\n$$\nD(10) = 0 + (d(1) + d(2) + \\dots + d(10))\n$$\n$$\nD(10) = 0 + \\sum_{t=1}^{10} 1 = 10 \\times 1 = 10\n$$\n在时间范围 $T=10$ 内的累积汉明距离是 $10$。",
            "answer": "$$\n\\boxed{10}\n$$"
        },
        {
            "introduction": "一个稳健可靠的基于主体的模型，其实现必须经过严格的验证。一种强大的验证技术是识别并测试模型的不变量——如果规则被正确实现，这些属性（例如某个总量的守恒）在整个模拟过程中必须保持为真。本实践将指导您设计单元测试，这些测试不仅检查特定结果，还确认这些基本不变量是否得以保持。掌握这项技能对于建立对模型结果的信心和确保其科学诚信至关重要。",
            "id": "4284335",
            "problem": "考虑一个环形网络上的基于主体的模型，其中每个主体由 $i \\in \\{0,1,\\dots,N-1\\}$ 索引，并在离散时间 $t \\in \\mathbb{N}$ 具有状态 $s_i(t) = (w_i(t), x_i(t))$。该网络在主体 $i$ 和主体 $(i+1) \\bmod N$ 之间存在无向边。每个时间步包含对所有 $N$ 条边的一次完整遍历成对交互，顺序为 $i=0$ 到 $i=N-1$，其中每对 $(i, (i+1) \\bmod N)$ 在每次遍历中交互一次。状态更新使用以下关于主体 $i$ 和 $j$（其中 $j = (i+1) \\bmod N$）之间成对交互的基本定义：\n\n- 财富交换规则，参数为 $\\gamma \\in [0,1]$：\n  - 如果 $\\gamma = 0$，则 $(w_i', w_j') = (w_i, w_j)$。\n  - 否则如果 $w_i = w_j$，则 $(w_i', w_j') = (w_i, w_j)$。\n  - 否则如果 $\\gamma = 1$，则 $(w_i', w_j') = (w_j, w_i)$。\n  - 否则，$(w_i', w_j') = \\left(w_i + \\gamma (w_j - w_i),\\ w_j - \\gamma (w_j - w_i)\\right)$。\n\n- 观点更新规则，参数为 $\\mu \\in [0,1]$ 且阈值为 $\\theta \\ge 0$：\n  - 如果 $\\mu = 0$，则 $(x_i', x_j') = (x_i, x_j)$。\n  - 否则如果 $|x_i - x_j| \\le \\theta$，则 $(x_i', x_j') = (x_i, x_j)$。\n  - 否则，$(x_i', x_j') = \\left(x_i + \\mu (x_j - x_i),\\ x_j + \\mu (x_i - x_j)\\right)$。\n\n您必须为这些主体状态更新和交互规则设计单元测试，以实现指定的分支覆盖率和不变性属性。对您的更新实现进行插桩，以记录在整个测试套件中，以下哪些不同分支至少被执行了一次：\n\n- 财富分支：“gamma为零无操作”、“财富相等无操作”、“gamma为一完全交换”、“常规交换”。\n- 观点分支：“mu为零无操作”、“阈值无操作”、“常规更新”。\n\n根据以上定义，推导并验证以下在任何单次完整遍历（$T=1$）中的不变性属性：\n- 总财富不变性：$\\sum_{i=0}^{N-1} w_i(1) = \\sum_{i=0}^{N-1} w_i(0)$。\n- 财富非负不变性：给定所有 $i$ 的 $w_i(0) \\ge 0$，则所有 $i$ 的 $w_i(1) \\ge 0$。\n- 观点边界不变性：给定所有 $i$ 的 $x_i(0) \\in [-1,1]$，则所有 $i$ 的 $x_i(1) \\in [-1,1]$。\n\n您的程序必须完全按照所述实现更新规则，并对分支执行进行插桩，以计算定义如下的分支覆盖率：\n$$\n\\text{覆盖率} = \\frac{\\text{在套件中命中的不同分支数量}}{\\text{枚举的所有不同分支总数}}\n$$\n\n测试套件：\n使用以下参数集。对于每个测试用例 $k$，在环形网络上使用给定的初始状态和参数执行恰好一次完整遍历（$T=1$）。所有数组均按主体索引 $i=0,1,\\dots,N-1$ 的顺序列出。\n\n- 用例 $\\mathrm{A}$ (正常路径)：$N=4$, $\\gamma=0.5$, $\\mu=0.5$, $\\theta=0.0$, $w(0)=[1,0,2,3]$, $x(0)=[-0.5,0.5,-1.0,1.0]$。\n- 用例 $\\mathrm{B}$ (财富gamma为零，观点阈值无操作)：$N=4$, $\\gamma=0.0$, $\\mu=0.4$, $\\theta=0.5$, $w(0)=[1,2,3,4]$, $x(0)=[0.1,0.1,0.1,0.1]$。\n- 用例 $\\mathrm{C}$ (财富相等分支，mu为零无操作)：$N=4$, $\\gamma=0.5$, $\\mu=0.0$, $\\theta=0.0$, $w(0)=[2,2,3,4]$, $x(0)=[-0.2,0.6,-0.6,0.2]$。\n- 用例 $\\mathrm{D}$ (gamma为一完全交换，观点极端更新)：$N=4$, $\\gamma=1.0$, $\\mu=1.0$, $\\theta=0.0$, $w(0)=[5,1,5,1]$, $x(0)=[-1.0,1.0,-1.0,1.0]$。\n- 用例 $\\mathrm{E}$ (网络规模边界情况)：$N=1$, $\\gamma=0.7$, $\\mu=0.3$, $\\theta=0.1$, $w(0)=[3.0]$, $x(0)=[0.0]$。\n\n每个测试用例所需的布尔结果：当且仅当该用例的所有三个不变性（总财富不变性、财富非负不变性、观点边界不变性）同时成立时，不变性属性才被视为满足。每个用例返回一个布尔值表示此结果。\n\n必需的覆盖率目标：对于整个测试套件，计算如上定义的覆盖率，并四舍五入到3位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须包含五个布尔值（每个测试用例一个），后跟一个等于实现的整个套件的分支覆盖率的浮点数，四舍五入到三位小数。例如：$[b_A,b_B,b_C,b_D,b_E,c]$，其中每个 $b_\\cdot$ 是一个布尔值，$c$ 是一个四舍五入到3位小数的浮点数。不应打印任何额外文本。",
            "solution": "该问题要求在一个环形网络上实现并测试一个特定的基于主体的模型。任务的核心是编写一个程序，该程序能为给定的测试套件模拟该模型，验证某些不变性属性，并计算实现的后验分支覆盖率。\n\n首先，我将对指定的不变性属性进行形式化分析，以确认其在给定更新规则下的数学有效性。这为后续的计算验证提供了理论基础。系统在时间 $t$ 的状态由财富向量 $w(t) = [w_0(t), \\dots, w_{N-1}(t)]$ 和观点向量 $x(t) = [x_0(t), \\dots, x_{N-1}(t)]$ 给出。单个时间步 $t=1$ 包含对主体 $(i, (i+1) \\bmod N)$（其中 $i=0, 1, \\dots, N-1$）之间的一系列 $N$ 次成对交互。\n\n**不变性属性分析**\n\n1.  **总财富不变性：** $\\sum_{k=0}^{N-1} w_k(1) = \\sum_{k=0}^{N-1} w_k(0)$。\n    让我们考虑主体 $i$ 和 $j$ 之间的一次成对交互。设它们交互前的财富为 $w_i$ 和 $w_j$，交互后为 $w_i'$ 和 $w_j'$。\n    - 如果 $\\gamma = 0$ 或 $w_i = w_j$，则 $w_i' = w_i$ 且 $w_j' = w_j$。因此，$w_i' + w_j' = w_i + w_j$。\n    - 如果 $\\gamma = 1$，则 $w_i' = w_j$ 且 $w_j' = w_i$。因此，$w_i' + w_j' = w_j + w_i = w_i + w_j$。\n    - 对于常规交换情况，$w_i' = w_i + \\gamma (w_j - w_i)$ 且 $w_j' = w_j - \\gamma (w_j - w_i)$。将它们相加得到：\n    $$w_i' + w_j' = \\left(w_i + \\gamma (w_j - w_i)\\right) + \\left(w_j - \\gamma (w_j - w_i)\\right) = w_i + w_j.$$\n    在所有情况下，交互对的财富总和是守恒的。从 $t=0$ 到 $t=1$ 的一次完整遍历是这样一系列成对交互。由于每次交互都保持局部总和不变，因此在整个遍历过程中，所有主体的总财富必须是守恒的。因此，总财富不变性属性成立。\n\n2.  **财富非负不变性：** 给定所有 $k$ 的 $w_k(0) \\ge 0$，则所有 $k$ 的 $w_k(1) \\ge 0$。\n    所有测试用例的初始条件都提供了 $w_k(0) \\ge 0$。我们需要证明在任何交互后财富都保持非负。\n    - 无操作和交换情况显然保持非负性。\n    - 对于常规交换，新的财富为：\n    $$w_i' = w_i + \\gamma (w_j - w_i) = (1-\\gamma)w_i + \\gamma w_j$$\n    $$w_j' = w_j - \\gamma (w_j - w_i) = w_j + \\gamma (w_i - w_j) = (1-\\gamma)w_j + \\gamma w_i$$\n    由于 $\\gamma \\in [0,1]$，因此 $(1-\\gamma) \\in [0,1]$。因此，$w_i'$ 和 $w_j'$ 是 $w_i$ 和 $w_j$ 的凸组合。如果 $w_i, w_j \\ge 0$，它们的任何凸组合都必须是非负的。因此，$w_i', w_j' \\ge 0$。由于这在遍历中的每次交互都成立，所以财富非负性是系统的一个不变量。\n\n3.  **观点边界不变性：** 给定所有 $k$ 的 $x_k(0) \\in [-1,1]$，则所有 $k$ 的 $x_k(1) \\in [-1,1]$。\n    初始条件提供了 $x_k(0) \\in [-1,1]$。我们分析主体 $i$ 和 $j$ 之间的一次观点更新。\n    - 无操作情况显然保持边界。\n    - 对于常规更新，新的观点为：\n    $$x_i' = x_i + \\mu (x_j - x_i) = (1-\\mu)x_i + \\mu x_j$$\n    $$x_j' = x_j + \\mu (x_i - x_j) = (1-\\mu)x_j + \\mu x_i$$\n    由于 $\\mu \\in [0,1]$，所以 $(1-\\mu) \\in [0,1]$。与财富类似，$x_i'$ 和 $x_j'$ 是 $x_i$ 和 $x_j$ 的凸组合。凸组合的一个众所周知的性质是它们受其分量的最小值和最大值所限制。设 $m = \\min(x_i, x_j)$ 且 $M = \\max(x_i, x_j)$。则 $m \\le x_i', x_j' \\le M$。给定 $x_i, x_j \\in [-1,1]$，我们有 $-1 \\le m \\le M \\le 1$。因此，$x_i', x_j' \\in [m, M] \\subseteq [-1,1]$。观点边界在每次交互中都得以保持，因此在整个遍历过程中也是如此。\n\n所有三个不变性属性在数学上都是合理的。现在，实现必须对给定的测试用例进行计算验证。\n\n**实现设计**\n\n程序的核心将是一个函数，用于为给定的测试用例模拟一个完整的时间步。该函数将模型参数（$N, \\gamma, \\mu, \\theta$）和初始状态（$w(0), x(0)$）作为输入。\n\n将使用一个全局集合 `hit_branches` 来记录在整个测试套件中每个不同逻辑分支的执行情况。财富更新规则有4个分支（“gamma为零无操作”、“财富相等无操作”、“gamma为一完全交换”、“常规交换”），观点更新规则有3个分支（“mu为零无操作”、“阈值无操作”、“常规更新”），总共有7个不同的分支需要监控。\n\n一次完整遍历的模拟通过迭代 $i$ 从 $0$ 到 $N-1$ 进行。对于每个 $i$，交互的主体对是 $(i, j)$，其中 $j = (i+1) \\bmod N$。主体 $i$ 和 $j$ 的状态被顺序更新。主体 $i$ 从 $(i-1, i)$ 交互（模 $N$）的状态更新成为 $(i, i+1)$ 交互的输入。这种顺序更新必须通过在遍历过程中就地修改状态数组来正确处理。\n\n在给定测试用例的完整遍历之后，将最终状态 $w(1)$ 和 $x(1)$ 与初始状态 $w(0)$ 和 $x(0)$ 进行比较，以验证三个不变性属性。\n- **总财富：** 使用 `np.isclose` 进行验证，以考虑潜在的浮点数不精确性，即 `np.isclose(np.sum(w(1)), np.sum(w(0)))`。\n- **财富非负性：** 通过检查 $w(1)$ 的所有元素是否大于或等于 $0$ 来验证。\n- **观点边界：** 通过检查 $x(1)$ 的所有元素是否位于闭区间 $[-1,1]$ 内来验证。\n\n为每个测试用例生成一个布尔结果，当且仅当所有三个属性都成立时，该结果为 `True`。处理完所有测试用例后，分支覆盖率计算为 `hit_branches` 中唯一分支的数量除以总分支数（$7$）。该比率四舍五入到3位小数。最终输出是一个列表，包含五个布尔结果和计算出的覆盖率。",
            "answer": "[True,True,True,True,True,1.0]"
        },
        {
            "introduction": "大多数基于主体的模型都包含数值不确定的参数。为了全面理解您的模型，确定哪些参数对结果影响最大至关重要——这个过程被称为敏感性分析。本练习向您介绍局部和全局敏感性的正式概念，并提供莫里斯筛选方法的动手实践，这是一种有效探索参数空间的技术。通过完成这个例子，您将学会如何系统地识别模型行为中最具影响力的驱动因素，这是模型分析和验证的关键一步。",
            "id": "4284337",
            "problem": "考虑一个程式化的基于代理的模型 (Agent-Based Model, ABM)，其定义为一组相互作用的代理的集合，这些代理的微观层面规则产生宏观层面的涌现结果。令宏观层面的结果由一个代理映射 $f:\\,[0,1]^3\\to \\mathbb{R}$ 概括，该映射从一个与 ABM 模拟数据拟合的回归元模型中获得。三个归一化参数分别为 $x_1$（接触倾向）、$x_2$（行为依从性）和 $x_3$（网络重连趋势）。对于本练习，设代理响应为\n$$\nf(x_1,x_2,x_3)=x_1+2\\,x_2+3\\,x_3+x_1\\,x_2.\n$$\n为了进行全局敏感性推理，假设所有参数在 $[0,1]$ 上独立且均匀分布。\n\n从 (i) 局部敏感性的定义（输出在指定点上对各参数的无穷小变化率）和 (ii) 全局敏感性的定义（在参数不确定性下各参数对输出方差的贡献）出发，完成以下任务：\n\n1. 使用基于微积分的全微分概念，推导代理模型 $f$ 在一个通用点 $x=(x_1,x_2,x_3)$ 处的局部敏感性向量。清晰阐述这是如何从导数的基本定义得出的。\n\n2. 对于独立输入 $x_1, x_2, x_3 \\sim \\mathrm{Uniform}(0,1)$，使用全方差定律，用方差和条件期望来定义一阶全局敏感性度量。解释这些度量作为量化单个参数贡献的方差的理由。\n\n3. 在参数空间中，为 $p=4$ 个网格水平和步长 $\\Delta=\\frac{1}{3}$ 推导一条 Morris 筛选轨迹。从基点 $x^{(0)}=\\left(\\frac{1}{3},\\,0,\\,\\frac{2}{3}\\right)$ 开始，按 $\\{x_1,\\,x_2,\\,x_3\\}$ 的顺序，每次将一个参数扰动 $+\\Delta$，确保轨迹保持在网格上，从而构建该轨迹。然后，计算沿此轨迹的每个参数对应的基本效应，其定义为单参数扰动下 $f$ 的有限差分变化量除以 $\\Delta$。\n\n4. 令 $\\mu^{\\star}$ 表示从第 3 步中的单条轨迹获得的基本效应绝对值向量。计算该向量的欧几里得范数 $\\|\\mu^{\\star}\\|_2$。将最终答案表示为单个精确的封闭形式表达式，不要四舍五入。\n\n你的最终答案必须是一个单一的精确解析表达式。不需要单位。不要四舍五入；不要使用百分号。",
            "solution": "### 第 1 部分：局部敏感性向量\n\n局部敏感性衡量在参数空间中的一个固定点上，输入参数的无穷小变化对输出的影响。这由输出函数对该参数的偏导数来捕捉。\n\n函数 $f(x_1, x_2, x_3)$ 的全微分提供了由参数的无穷小变化 $dx_1, dx_2, dx_3$ 引起的 $f$ 变化的主线性部分：\n$$\ndf = \\frac{\\partial f}{\\partial x_1}dx_1 + \\frac{\\partial f}{\\partial x_2}dx_2 + \\frac{\\partial f}{\\partial x_3}dx_3\n$$\n微分 $dx_i$ 的系数是偏导数，代表局部敏感性。由这些偏导数组成的向量是 $f$ 的梯度 $\\nabla f$，它作为局部敏感性向量。\n\n代理响应函数由下式给出：\n$$\nf(x_1, x_2, x_3) = x_1 + 2x_2 + 3x_3 + x_1x_2\n$$\n我们计算关于每个参数的偏导数：\n1.  对 $x_1$ 的敏感性：\n    $$\n    \\frac{\\partial f}{\\partial x_1} = \\frac{\\partial}{\\partial x_1}(x_1 + 2x_2 + 3x_3 + x_1x_2) = 1 + x_2\n    $$\n2.  对 $x_2$ 的敏感性：\n    $$\n    \\frac{\\partial f}{\\partial x_2} = \\frac{\\partial}{\\partial x_2}(x_1 + 2x_2 + 3x_3 + x_1x_2) = 2 + x_1\n    $$\n3.  对 $x_3$ 的敏感性：\n    $$\n    \\frac{\\partial f}{\\partial x_3} = \\frac{\\partial}{\\partial x_3}(x_1 + 2x_2 + 3x_3 + x_1x_2) = 3\n    $$\n$f$ 在一个通用点 $x = (x_1, x_2, x_3)$ 处的局部敏感性向量是 $f$ 的梯度：\n$$\n\\nabla f(x_1, x_2, x_3) = \\left( \\frac{\\partial f}{\\partial x_1}, \\frac{\\partial f}{\\partial x_2}, \\frac{\\partial f}{\\partial x_3} \\right) = (1+x_2, 2+x_1, 3)\n$$\n\n### 第 2 部分：一阶全局敏感性度量\n\n全局敏感性分析评估参数在其整个不确定性范围内的影响。基于方差的方法，如 Sobol 方法，将模型输出的总方差分解为来自单个参数及其相互作用的贡献。\n\n令 $Y = f(X_1, X_2, \\dots, X_k)$ 为模型输出，其中 $X_i$ 是独立的随机输入变量。全方差定律允许分解总输出方差 $\\mathrm{Var}(Y)$。参数 $X_i$ 的一阶敏感性指数 $S_i$ 定义为由 $X_i$ 自身的方差引起的 $Y$ 的总方差的分数。\n\n在数学上，它定义为：\n$$\nS_i = \\frac{V_i}{\\mathrm{Var}(Y)}\n$$\n其中 $\\mathrm{Var}(Y)$ 是输出的总方差：\n$$\n\\mathrm{Var}(Y) = E[Y^2] - (E[Y])^2\n$$\n而 $V_i$ 是在给定 $X_i$ 的情况下 $Y$ 的条件期望的方差：\n$$\nV_i = \\mathrm{Var}(E[Y|X_i]) = E[(E[Y|X_i])^2] - (E[E[Y|X_i]])^2\n$$\n根据全期望定律，$E[E[Y|X_i]] = E[Y]$，因此 $V_i$ 的表达式简化为：\n$$\nV_i = \\mathrm{Var}(E[Y|X_i])\n$$\n项 $E[Y|X_i=x_i^*]$ 表示当参数 $X_i$ 固定在值 $x_i^*$ 时，而所有其他参数 $X_{j \\neq i}$ 在其分布上变化时，输出 $Y$ 的期望值。这个量的方差 $\\mathrm{Var}(E[Y|X_i])$ 衡量了当 $X_i$ 在其定义域内变化时，期望输出平均变化多少。因此，$S_i$ 量化了 $X_i$ 对输出方差的主效应，表示如果 $X_i$ 的真实值已知，输出方差的预期减少量。\n\n### 第 3 部分：Morris 筛选轨迹与基本效应\n\nMorris 方法使用基本效应来筛选重要参数。一个参数的基本效应是其导数的有限差分近似，该近似是沿参数空间中的特定轨迹计算的。\n\n给定 $p=4$ 个网格水平，得出每个参数的网格为 $\\{0, \\frac{1}{3}, \\frac{2}{3}, 1\\}$。步长为 $\\Delta = \\frac{1}{3}$。基点为 $x^{(0)} = (\\frac{1}{3}, 0, \\frac{2}{3})$。扰动顺序为 $\\{x_1, x_2, x_3\\}$。\n\n首先，我们计算函数在基点 $x^{(0)}$ 处的值：\n$$\nf(x^{(0)}) = f\\left(\\frac{1}{3}, 0, \\frac{2}{3}\\right) = \\frac{1}{3} + 2(0) + 3\\left(\\frac{2}{3}\\right) + \\left(\\frac{1}{3}\\right)(0) = \\frac{1}{3} + 2 = \\frac{7}{3}\n$$\n\n**第 1 步：扰动 $x_1$**\n我们通过将 $\\Delta$ 加到 $x^{(0)}$ 的第一个分量上来创建下一个点 $x^{(1)}$：\n$$\nx^{(1)} = x^{(0)} + (\\Delta, 0, 0) = \\left(\\frac{1}{3}+\\frac{1}{3}, 0, \\frac{2}{3}\\right) = \\left(\\frac{2}{3}, 0, \\frac{2}{3}\\right)\n$$\n计算 $f$ 在 $x^{(1)}$ 处的值：\n$$\nf(x^{(1)}) = f\\left(\\frac{2}{3}, 0, \\frac{2}{3}\\right) = \\frac{2}{3} + 2(0) + 3\\left(\\frac{2}{3}\\right) + \\left(\\frac{2}{3}\\right)(0) = \\frac{2}{3} + 2 = \\frac{8}{3}\n$$\n$x_1$ 的基本效应为：\n$$\nEE_1 = \\frac{f(x^{(1)}) - f(x^{(0)})}{\\Delta} = \\frac{\\frac{8}{3} - \\frac{7}{3}}{\\frac{1}{3}} = \\frac{\\frac{1}{3}}{\\frac{1}{3}} = 1\n$$\n\n**第 2 步：扰动 $x_2$**\n我们通过将 $\\Delta$ 加到 $x^{(1)}$ 的第二个分量上来创建 $x^{(2)}$：\n$$\nx^{(2)} = x^{(1)} + (0, \\Delta, 0) = \\left(\\frac{2}{3}, 0+\\frac{1}{3}, \\frac{2}{3}\\right) = \\left(\\frac{2}{3}, \\frac{1}{3}, \\frac{2}{3}\\right)\n$$\n计算 $f$ 在 $x^{(2)}$ 处的值：\n$$\nf(x^{(2)}) = f\\left(\\frac{2}{3}, \\frac{1}{3}, \\frac{2}{3}\\right) = \\frac{2}{3} + 2\\left(\\frac{1}{3}\\right) + 3\\left(\\frac{2}{3}\\right) + \\left(\\frac{2}{3}\\right)\\left(\\frac{1}{3}\\right) = \\frac{2}{3} + \\frac{2}{3} + 2 + \\frac{2}{9} = \\frac{6+6+18+2}{9} = \\frac{32}{9}\n$$\n$x_2$ 的基本效应为：\n$$\nEE_2 = \\frac{f(x^{(2)}) - f(x^{(1)})}{\\Delta} = \\frac{\\frac{32}{9} - \\frac{8}{3}}{\\frac{1}{3}} = \\frac{\\frac{32 - 24}{9}}{\\frac{1}{3}} = \\frac{\\frac{8}{9}}{\\frac{1}{3}} = \\frac{8}{9} \\times 3 = \\frac{8}{3}\n$$\n\n**第 3 步：扰动 $x_3$**\n我们通过将 $\\Delta$ 加到 $x^{(2)}$ 的第三个分量上来创建 $x^{(3)}$：\n$$\nx^{(3)} = x^{(2)} + (0, 0, \\Delta) = \\left(\\frac{2}{3}, \\frac{1}{3}, \\frac{2}{3}+\\frac{1}{3}\\right) = \\left(\\frac{2}{3}, \\frac{1}{3}, 1\\right)\n$$\n计算 $f$ 在 $x^{(3)}$ 处的值：\n$$\nf(x^{(3)}) = f\\left(\\frac{2}{3}, \\frac{1}{3}, 1\\right) = \\frac{2}{3} + 2\\left(\\frac{1}{3}\\right) + 3(1) + \\left(\\frac{2}{3}\\right)\\left(\\frac{1}{3}\\right) = \\frac{2}{3} + \\frac{2}{3} + 3 + \\frac{2}{9} = \\frac{6+6+27+2}{9} = \\frac{41}{9}\n$$\n$x_3$ 的基本效应为：\n$$\nEE_3 = \\frac{f(x^{(3)}) - f(x^{(2)})}{\\Delta} = \\frac{\\frac{41}{9} - \\frac{32}{9}}{\\frac{1}{3}} = \\frac{\\frac{9}{9}}{\\frac{1}{3}} = \\frac{1}{\\frac{1}{3}} = 3\n$$\n沿此轨迹计算出的基本效应为 $\\{EE_1, EE_2, EE_3\\} = \\{1, \\frac{8}{3}, 3\\}$。\n\n### 第 4 部分：基本效应绝对值的欧几里得范数\n\n问题将 $\\mu^{\\star}$ 定义为第 3 部分中单条轨迹得到的基本效应绝对值向量。由于基本效应均为正数，它们的绝对值不变。\n$$\n\\mu^{\\star} = (|EE_1|, |EE_2|, |EE_3|) = \\left(1, \\frac{8}{3}, 3\\right)\n$$\n该向量的欧几里得范数（或 $L_2$-范数）由 $\\|\\mu^{\\star}\\|_2 = \\sqrt{\\sum_{i=1}^3 (\\mu^{\\star}_i)^2}$ 给出。\n$$\n\\|\\mu^{\\star}\\|_2 = \\sqrt{1^2 + \\left(\\frac{8}{3}\\right)^2 + 3^2}\n$$\n$$\n\\|\\mu^{\\star}\\|_2 = \\sqrt{1 + \\frac{64}{9} + 9}\n$$\n$$\n\\|\\mu^{\\star}\\|_2 = \\sqrt{10 + \\frac{64}{9}}\n$$\n为了对平方根下的各项求和，我们找到一个公分母：\n$$\n\\|\\mu^{\\star}\\|_2 = \\sqrt{\\frac{10 \\times 9}{9} + \\frac{64}{9}} = \\sqrt{\\frac{90}{9} + \\frac{64}{9}} = \\sqrt{\\frac{154}{9}}\n$$\n将分数的平方根分开：\n$$\n\\|\\mu^{\\star}\\|_2 = \\frac{\\sqrt{154}}{\\sqrt{9}} = \\frac{\\sqrt{154}}{3}\n$$\n数字 $154$ 的质因数分解为 $2 \\times 7 \\times 11$，因此其平方根无法进一步简化。",
            "answer": "$$\n\\boxed{\\frac{\\sqrt{154}}{3}}\n$$"
        }
    ]
}