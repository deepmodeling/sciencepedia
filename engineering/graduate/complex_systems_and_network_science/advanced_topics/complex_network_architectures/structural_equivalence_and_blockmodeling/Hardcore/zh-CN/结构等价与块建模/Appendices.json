{
    "hands_on_practices": [
        {
            "introduction": "结构等价性是网络分析中一个严格的概念，它要求节点具有完全相同的连接模式。本练习通过一个具体的计算任务，帮助你量化地理解这一严格定义与更宽泛的“相似性”概念之间的区别。你将通过计算皮尔逊相关系数（$PCC$）来探索两个节点的连接模式有多相似，并思考为什么高度相关不一定意味着结构等价。",
            "id": "4305881",
            "problem": "考虑一个包含五个节点且无自环的二元有向网络。设其邻接矩阵为\n$$\nA=\\begin{pmatrix}\n0  1  1  0  0 \\\\\n1  0  1  0  1 \\\\\n1  1  0  0  0 \\\\\n0  1  0  0  1 \\\\\n1  0  1  0  0\n\\end{pmatrix},\n$$\n其中条目 $A_{ij}=1$ 表示从节点 $i$ 到节点 $j$ 有一条有向边，而 $A_{ij}=0$ 表示没有边。在结构对等和块模型理论中，两个节点是结构对等的，当且仅当它们与其他所有节点的连接关系以及从其他所有节点接收的连接关系完全相同。定义节点 $i$ 的邻接剖面为长度为10的向量\n$$\n\\mathbf{x}^{(i)}=\\big(A_{i1},A_{i2},A_{i3},A_{i4},A_{i5},A_{1i},A_{2i},A_{3i},A_{4i},A_{5i}\\big),\n$$\n该向量拼接了节点 $i$ 的出边（其在 $A$ 中的行）和入边（其在 $A$ 中的列）。从结构对等的核心定义和皮尔逊相关系数（PCC）的标准定义出发，计算节点2和节点5的邻接剖面之间的PCC。然后，根据第一性原理，解释在此情境下，高的PCC是否必然意味着结构对等，并明确地将您的推理与所提供的定义联系起来。将最终的PCC值表示为一个精确数；无需四舍五入，答案也无需单位。",
            "solution": "该问题需要一个由两部分组成的答案：首先，计算网络中两个指定节点的邻接剖面之间的皮尔逊相关系数（PCC）；其次，解释高PCC与结构对等概念之间的关系。\n\n### 步骤1：问题验证\n\n该问题被认为是有效的。它在网络科学这一成熟领域有坚实的科学基础，特别是关于结构对等和块模型。所有术语，如邻接矩阵、有向边、结构对等和皮尔逊相关系数，都有明确的定义并且是标准术语。所提供的数据，即邻接矩阵 $A$，是自包含的，并且与一个无自环的5节点有向网络的描述相符（所有对角线元素均为0）。任务清晰、客观且可形式化，从而能够得出一个唯一的、可验证的解。该问题是适定问题，不包含验证标准中列出的任何缺陷。\n\n### 步骤2：计算皮尔逊相关系数（PCC）\n\n第一个任务是计算节点2和节点5的邻接剖面之间的PCC。给定的邻接矩阵是：\n$$\nA=\\begin{pmatrix}\n0  1  1  0  0 \\\\\n1  0  1  0  1 \\\\\n1  1  0  0  0 \\\\\n0  1  0  0  1 \\\\\n1  0  1  0  0\n\\end{pmatrix}\n$$\n节点 $i$ 的邻接剖面定义为从邻接矩阵 $A$ 中拼接其对应的行和列：\n$$\n\\mathbf{x}^{(i)}=\\big(A_{i1},A_{i2},A_{i3},A_{i4},A_{i5},A_{1i},A_{2i},A_{3i},A_{4i},A_{5i}\\big)\n$$\n对于节点2，剖面向量 $\\mathbf{x}^{(2)}$ 由 $A$ 的第二行和第二列构成：\n$A$ 的第2行是 $(1, 0, 1, 0, 1)$。\n$A$ 的第2列是 $(1, 0, 1, 1, 0)$。\n因此，节点2的邻接剖面是：\n$$\n\\mathbf{x}^{(2)} = (1, 0, 1, 0, 1, 1, 0, 1, 1, 0)\n$$\n对于节点5，剖面向量 $\\mathbf{x}^{(5)}$ 由 $A$ 的第五行和第五列构成：\n$A$ 的第5行是 $(1, 0, 1, 0, 0)$。\n$A$ 的第5列是 $(0, 1, 0, 1, 0)$。\n因此，节点5的邻接剖面是：\n$$\n\\mathbf{x}^{(5)} = (1, 0, 1, 0, 0, 0, 1, 0, 1, 0)\n$$\n两个向量 $X=(X_1, \\dots, X_n)$ 和 $Y=(Y_1, \\dots, Y_n)$ 的皮尔逊相关系数 $\\rho$ 由以下公式给出：\n$$\n\\rho_{X,Y} = \\frac{\\sum_{k=1}^{n} (X_k - \\bar{X})(Y_k - \\bar{Y})}{\\sqrt{\\sum_{k=1}^{n} (X_k - \\bar{X})^2} \\sqrt{\\sum_{k=1}^{n} (Y_k - \\bar{Y})^2}}\n$$\n设 $X = \\mathbf{x}^{(2)}$ 且 $Y = \\mathbf{x}^{(5)}$。向量的长度为 $n=10$。\n\n首先，我们计算均值 $\\bar{X}$ 和 $\\bar{Y}$：\n$$\n\\bar{X} = \\frac{1}{10}\\sum_{k=1}^{10} X_k = \\frac{1+0+1+0+1+1+0+1+1+0}{10} = \\frac{6}{10} = 0.6\n$$\n$$\n\\bar{Y} = \\frac{1}{10}\\sum_{k=1}^{10} Y_k = \\frac{1+0+1+0+0+0+1+0+1+0}{10} = \\frac{4}{10} = 0.4\n$$\n接下来，我们计算分子，即协方差项 $\\sum (X_k - \\bar{X})(Y_k - \\bar{Y})$。\n$$\n\\sum_{k=1}^{10} (X_k - \\bar{X})(Y_k - \\bar{Y}) = 0.6\n$$\n接下来，我们计算分母中的项。对于一个二元向量，离差平方和 $\\sum(X_k - \\bar{X})^2$ 等于 $n \\bar{X} (1-\\bar{X})$。\n对于 $\\mathbf{x}^{(2)}$:\n$$\n\\sum_{k=1}^{10} (X_k - \\bar{X})^2 = 10 \\times 0.6 \\times (1-0.6) = 10 \\times 0.6 \\times 0.4 = 2.4\n$$\n对于 $\\mathbf{x}^{(5)}$:\n$$\n\\sum_{k=1}^{10} (Y_k - \\bar{Y})^2 = 10 \\times 0.4 \\times (1-0.4) = 10 \\times 0.4 \\times 0.6 = 2.4\n$$\n现在，我们可以计算PCC：\n$$\n\\rho_{\\mathbf{x}^{(2)},\\mathbf{x}^{(5)}} = \\frac{0.6}{\\sqrt{2.4} \\sqrt{2.4}} = \\frac{0.6}{2.4} = \\frac{1}{4}\n$$\n节点2和节点5的邻接剖面之间的PCC恰好是 $0.25$。\n\n### 步骤3：PCC与结构对等的解释\n\n第二个任务是解释高的PCC是否必然意味着结构对等。\n\n根据所提供的定义，“两个节点是结构对等的，当且仅当它们与其他所有节点的连接关系以及从其他所有节点接收的连接关系完全相同。” 这意味着它们的邻接剖面 $\\mathbf{x}^{(i)}$ 和 $\\mathbf{x}^{(j)}$ 必须完全相同。\n\n让我们分析这个条件与PCC之间的关系。\n如果两个节点 $i$ 和 $j$ 是结构对等的，它们的邻接剖面是相同的：$\\mathbf{x}^{(i)} = \\mathbf{x}^{(j)}$。如果该向量不是常数（即节点不是孤立的或与所有其他节点都相连），其方差为非零。那么PCC公式变为：\n$$\n\\rho = \\frac{\\sum (X_k - \\bar{X})(X_k - \\bar{X})}{\\sqrt{\\sum (X_k - \\bar{X})^2} \\sqrt{\\sum (X_k - \\bar{X})^2}} = \\frac{\\sum (X_k - \\bar{X})^2}{\\sum (X_k - \\bar{X})^2} = 1\n$$\n因此，结构对等意味着PCC为1。\n\n现在，考虑反过来的情况：高的PCC是否意味着结构对等？PCC等于1当且仅当一个向量是另一个向量的完美正线性函数：$Y_k = a X_k + b$，其中常数 $a > 0$。由于我们的剖面向量是二元的（元素为0或1）并且不是常数向量，一个 $a>0$ 的完美线性关系只可能在 $b=0$ 和 $a=1$ 时发生，这意味着对所有 $k$ 都有 $Y_k = X_k$。在二元剖面这个特定情境下，PCC为1等价于剖面完全相同，因此意味着结构对等。\n\n然而，问题问的是*高*PCC，而不是PCC恰好为1。一个小于1的PCC值，无论多高（例如，$\\rho=0.999$），在数学上都意味着这两个向量不相同。因此，一个不完全等于1的高PCC意味着节点不是结构对等的。\n\n在我们具体的问题中，节点2和节点5的PCC为0.25。它们的剖面不相同，所以这两个节点不是结构对等的。0.25的PCC值反映了一种相似度，这种相似度远弱于结构对等所要求的绝对同一性。\n\n总之，邻接剖面之间的高皮尔逊相关系数表示连接模式的高度相似性，但并不必然意味着结构对等。结构对等要求连接剖面的严格同一性，这对应于PCC恰好为1。任何小于1的值，即使很高，也表示与这种要求的同一性存在偏差。",
            "answer": "$$\n\\boxed{\\frac{1}{4}}\n$$"
        },
        {
            "introduction": "在理解了等价性的基本概念后，下一步是将其应用于实际的块模型分析中。本练习将指导你完成块建模的核心步骤：将网络中的节点划分成块，然后通过计算块间连接的密度来生成一个简化的“图像矩阵”。这个过程揭示了网络的宏观结构，让你能够识别不同节点组在网络中所扮演的角色。",
            "id": "4305866",
            "problem": "考虑一个由二元邻接矩阵 $A \\in \\{0,1\\}^{6 \\times 5}$ 表示的二分隶属网络，其中行对应于 $6$ 个行动者，列对应于 $5$ 个事件。矩阵元素 $A_{ij} = 1$ 表示行动者 $i$ 参与了事件 $j$，否则 $A_{ij} = 0$。矩阵 $A$ 由下式给出：\n$$\nA = \\begin{bmatrix}\n1  1  1  1  0 \\\\\n1  1  0  1  0 \\\\\n1  0  0  0  0 \\\\\n1  0  0  0  0 \\\\\n1  1  0  1  1 \\\\\n1  0  0  1  0\n\\end{bmatrix}.\n$$\n假设行动者（行）被划分为三个区块 $R_1 = \\{1,2\\}$, $R_2 = \\{3,4\\}$, $R_3 = \\{5,6\\}$，事件（列）被划分为两个区块 $C_1 = \\{1,2,3\\}$, $C_2 = \\{4,5\\}$。使用结构对等性和块模型的核心定义，将第 $(p,q)$ 区块的协同区块密度 $B_{p,q}$ 定义为由 $R_p \\times C_q$ 导出的子矩阵中值为 $1$ 的元素的比例：\n$$\nB_{p,q} = \\frac{\\sum_{i \\in R_p} \\sum_{j \\in C_q} A_{ij}}{|R_p| \\cdot |C_q|}.\n$$\n精确计算完整的 $3 \\times 2$ 协同区块密度矩阵 $B$（将每个元素表示为精确分数），然后以 $\\tau = \\frac{1}{2}$ 为阈值对其进行处理，生成二元映像矩阵 $I \\in \\{0,1\\}^{3 \\times 2}$，其元素为\n$$\nI_{p,q} = \\begin{cases}\n1,  \\text{if } B_{p,q} \\ge \\tau, \\\\\n0,  \\text{if } B_{p,q}  \\tau.\n\\end{cases}\n$$\n最后，根据行动者区块和事件区块间的结构对等性，简要解释由映像矩阵 $I$ 所揭示的角色。对于计算出的密度，使用精确分数，不要四舍五入。对于最终答案，仅提供按行主序 $(I_{1,1}, I_{1,2}, I_{2,1}, I_{2,2}, I_{3,1}, I_{3,2})$ 展平的阈值化映像矩阵元素，形式为单个行矩阵。",
            "solution": "用户想要为一个给定的二分隶属网络计算一个块模型。该问题定义明确，并使用了网络科学和线性代数的标准概念。\n\n### 步骤 1：提取给定条件\n-   一个二分隶属网络由一个二元邻接矩阵 $A \\in \\{0,1\\}^{6 \\times 5}$ 表示。\n-   矩阵 $A$ 由下式给出：\n    $$\n    A = \\begin{bmatrix}\n    1  1  1  1  0 \\\\\n    1  1  0  1  0 \\\\\n    1  0  0  0  0 \\\\\n    1  0  0  0  0 \\\\\n    1  1  0  1  1 \\\\\n    1  0  0  1  0\n    \\end{bmatrix}\n    $$\n-   行动者（行）被划分为三个区块：$R_1 = \\{1,2\\}$, $R_2 = \\{3,4\\}$, $R_3 = \\{5,6\\}$。\n-   事件（列）被划分为两个区块：$C_1 = \\{1,2,3\\}$, $C_2 = \\{4,5\\}$。\n-   第 $(p,q)$ 区块的协同区块密度 $B_{p,q}$ 定义为：\n    $$\n    B_{p,q} = \\frac{\\sum_{i \\in R_p} \\sum_{j \\in C_q} A_{ij}}{|R_p| \\cdot |C_q|}\n    $$\n-   给定阈值 $\\tau = \\frac{1}{2}$。\n-   二元映像矩阵 $I \\in \\{0,1\\}^{3 \\times 2}$ 由其元素定义：\n    $$\n    I_{p,q} = \\begin{cases}\n    1,  \\text{if } B_{p,q} \\ge \\tau, \\\\\n    0,  \\text{if } B_{p,q}  \\tau.\n    \\end{cases}\n    $$\n\n### 步骤 2：使用提取的给定条件进行验证\n该问题具有科学依据、定义明确且客观。\n-   **具有科学依据**：该问题使用了块模型的核心标准定义，这是社会网络分析和复杂系统中一种成熟的技术。隶属网络、划分、区块密度和映像矩阵等概念都是教科书级别的材料。\n-   **定义明确**：该问题提供了所有必要的数据（矩阵 $A$、划分 $R_p$ 和 $C_q$），对要计算的量（$B_{p,q}$）有清晰的定义，以及对最终输出（$I_{p,q}$）有确定性的规则。存在唯一解，并且可以从给定条件直接计算得出。\n-   **客观性**：该问题使用精确的数学语言和定义进行陈述。没有主观或含糊不清的术语。\n-   提供了所有必要信息，且没有矛盾之处。该问题是有效的。\n\n### 步骤 3：进行求解\n\n任务是首先计算 $3 \\times 2$ 的协同区块密度矩阵 $B$，然后对其元素进行阈值处理以获得 $3 \\times 2$ 的映像矩阵 $I$。\n\n首先，我们确定划分的大小：\n-   $|R_1| = 2$, $|R_2| = 2$, $|R_3| = 2$。\n-   $|C_1| = 3$, $|C_2| = 2$。\n\n现在，我们使用提供的公式计算密度矩阵 $B$ 的每个元素。\n\n**区块 (1,1)：$p=1, q=1$**\n该区块对应于行动者划分 $R_1=\\{1,2\\}$ 和事件划分 $C_1=\\{1,2,3\\}$。\n分母为 $|R_1| \\cdot |C_1| = 2 \\cdot 3 = 6$。\n分子是 $A$ 中由行 $1,2$ 和列 $1,2,3$ 定义的子矩阵的元素之和：\n$$ A(R_1, C_1) = \\begin{bmatrix} 1  1  1 \\\\ 1  1  0 \\end{bmatrix} $$\n和为 $\\sum_{i \\in R_1} \\sum_{j \\in C_1} A_{ij} = 1+1+1+1+1+0 = 5$。\n所以，$B_{1,1} = \\frac{5}{6}$。\n\n**区块 (1,2)：$p=1, q=2$**\n该区块对应于 $R_1=\\{1,2\\}$ 和 $C_2=\\{4,5\\}$。\n分母为 $|R_1| \\cdot |C_2| = 2 \\cdot 2 = 4$。\n子矩阵为 $A(R_1, C_2) = \\begin{bmatrix} 1  0 \\\\ 1  0 \\end{bmatrix}$。\n和为 $\\sum_{i \\in R_1} \\sum_{j \\in C_2} A_{ij} = 1+0+1+0 = 2$。\n所以，$B_{1,2} = \\frac{2}{4} = \\frac{1}{2}$。\n\n**区块 (2,1)：$p=2, q=1$**\n该区块对应于 $R_2=\\{3,4\\}$ 和 $C_1=\\{1,2,3\\}$。\n分母为 $|R_2| \\cdot |C_1| = 2 \\cdot 3 = 6$。\n子矩阵为 $A(R_2, C_1) = \\begin{bmatrix} 1  0  0 \\\\ 1  0  0 \\end{bmatrix}$。\n和为 $\\sum_{i \\in R_2} \\sum_{j \\in C_1} A_{ij} = 1+0+0+1+0+0 = 2$。\n所以，$B_{2,1} = \\frac{2}{6} = \\frac{1}{3}$。\n\n**区块 (2,2)：$p=2, q=2$**\n该区块对应于 $R_2=\\{3,4\\}$ 和 $C_2=\\{4,5\\}$。\n分母为 $|R_2| \\cdot |C_2| = 2 \\cdot 2 = 4$。\n子矩阵为 $A(R_2, C_2) = \\begin{bmatrix} 0  0 \\\\ 0  0 \\end{bmatrix}$。\n和为 $\\sum_{i \\in R_2} \\sum_{j \\in C_2} A_{ij} = 0+0+0+0 = 0$。\n所以，$B_{2,2} = \\frac{0}{4} = 0$。\n\n**区块 (3,1)：$p=3, q=1$**\n该区块对应于 $R_3=\\{5,6\\}$ 和 $C_1=\\{1,2,3\\}$。\n分母为 $|R_3| \\cdot |C_1| = 2 \\cdot 3 = 6$。\n子矩阵为 $A(R_3, C_1) = \\begin{bmatrix} 1  1  0 \\\\ 1  0  0 \\end{bmatrix}$。\n和为 $\\sum_{i \\in R_3} \\sum_{j \\in C_1} A_{ij} = 1+1+0+1+0+0 = 3$。\n所以，$B_{3,1} = \\frac{3}{6} = \\frac{1}{2}$。\n\n**区块 (3,2)：$p=3, q=2$**\n该区块对应于 $R_3=\\{5,6\\}$ 和 $C_2=\\{4,5\\}$。\n分母为 $|R_3| \\cdot |C_2| = 2 \\cdot 2 = 4$。\n子矩阵为 $A(R_3, C_2) = \\begin{bmatrix} 1  1 \\\\ 1  0 \\end{bmatrix}$。\n和为 $\\sum_{i \\in R_3} \\sum_{j \\in C_2} A_{ij} = 1+1+1+0 = 3$。\n所以，$B_{3,2} = \\frac{3}{4}$。\n\n完整的协同区块密度矩阵 $B$ 是：\n$$\nB = \\begin{bmatrix}\n\\frac{5}{6}  \\frac{1}{2} \\\\\n\\frac{1}{3}  0 \\\\\n\\frac{1}{2}  \\frac{3}{4}\n\\end{bmatrix}\n$$\n\n接下来，我们以 $\\tau = \\frac{1}{2}$ 为阈值对此矩阵进行处理，得到映像矩阵 $I$。\n-   $I_{1,1} = 1$ 因为 $B_{1,1} = \\frac{5}{6} \\ge \\frac{1}{2}$。\n-   $I_{1,2} = 1$ 因为 $B_{1,2} = \\frac{1}{2} \\ge \\frac{1}{2}$。\n-   $I_{2,1} = 0$ 因为 $B_{2,1} = \\frac{1}{3}  \\frac{1}{2}$。\n-   $I_{2,2} = 0$ 因为 $B_{2,2} = 0  \\frac{1}{2}$。\n-   $I_{3,1} = 1$ 因为 $B_{3,1} = \\frac{1}{2} \\ge \\frac{1}{2}$。\n-   $I_{3,2} = 1$ 因为 $B_{3,2} = \\frac{3}{4} \\ge \\frac{1}{2}$。\n\n最终的映像矩阵 $I$ 是：\n$$\nI = \\begin{bmatrix}\n1  1 \\\\\n0  0 \\\\\n1  1\n\\end{bmatrix}\n$$\n\n最后，我们简要解释所发现的角色。映像矩阵 $I$ 揭示了隶属关系的宏观结构。$I$ 的每一行是对应行动者区块的“角色签名”。\n-   行动者区块 $R_1$（行动者 $\\{1,2\\}$）和 $R_3$（行动者 $\\{5,6\\}$）具有相同的角色签名 $(1, 1)$。这表明它们在区块级别上是结构对等的。它们都与事件区块 $C_1$ 和 $C_2$ 有高密度的联系。它们代表了广泛参与的“多面手”型行动者。\n-   行动者区块 $R_2$（行动者 $\\{3,4\\}$）的角色签名为 $(0, 0)$。这意味着它与两个事件区块的联系密度都很低，使其成为一个“边缘”区块，其行动者相对脱离于网络中的事件。\n-   从列来看，两个事件区块 $C_1$ 和 $C_2$ 具有相同的签名 $(1, 0, 1)^T$。它们在区块级别上也是结构对等的，都与多面手型行动者区块（$R_1, R_3$）有强连接，而与边缘区块（$R_2$）的连接较弱。\n\n最终答案要求提供 $I$ 的行主序展平表示：$(I_{1,1}, I_{1,2}, I_{2,1}, I_{2,2}, I_{3,1}, I_{3,2})$。\n这对应于序列 $(1, 1, 0, 0, 1, 1)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1  1  0  0  1  1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在真实世界的研究中，我们通常不知道网络的最优划分方式，而需要通过计算方法去发现它。这个高级练习将带你进入块建模的实践核心：解决寻找最优划分这一计算难题。你将通过实现一种启发式搜索算法（禁忌搜索），来学习如何通过最小化一个定义好的误差函数，从而自动地从数据中发现潜在的网络结构。",
            "id": "4305864",
            "problem": "考虑一个包含 $n$ 个节点的无向简单图，由一个二元邻接矩阵 $A \\in \\{0,1\\}^{n \\times n}$ 表示，其中 $A$ 是对称的，且对所有 $i$ 都有 $A_{ii} = 0$。块模型将节点划分到 $K$ 个位置中。令 $\\pi : \\{1,\\dots,n\\} \\to \\{1,\\dots,K\\}$ 为一个划分函数，它将每个节点分配到一个块中。一个理想映像矩阵 $M \\in \\{0,1\\}^{K \\times K}$ 为每个有序块对 $(r,s)$ 指定了块 $r$ 和 $s$ 之间的理想关系是 $1$（完全连接）还是 $0$（无连接）。广义块模型准则 $E(A,\\pi,M)$ 定义为在所有有序节点对中，观测到的连接与理想连接之间的不匹配总数，即：\n$$\nE(A,\\pi,M) = \\sum_{i=1}^{n}\\sum_{\\substack{j=1 \\\\ j \\neq i}}^{n} \\left| A_{ij} - M_{\\pi(i), \\pi(j)} \\right|.\n$$\n该准则对任何偏离理想映像的情况进行惩罚：一个在完全连接块区域内的 $0$ 和一个在无连接块区域内的 $1$ 各对总和贡献 $1$。\n\n您的任务是实现一种启发式搜索策略，该策略在禁忌搜索 (TS) 下使用贪心局部移动来最小化 $E(A,\\pi,M)$。从一个初始划分 $\\pi^{(0)}$ 开始。在每次迭代中，考虑将单个节点 $u$ 从其当前块 $r = \\pi(u)$ 重新分配到另一个目标块 $t \\in \\{1,\\dots,K\\} \\setminus \\{r\\}$ 的局部移动。对于每个候选移动，评估执行该移动所引起的准则变化量 $\\Delta E$，而无需从头重新计算 $E$。搜索应：\n- 通过根据 $E$ 的定义计算出的精确 $\\Delta E$ 来评估移动。\n- 使用一个禁忌移动 $(u,t)$ 的禁忌表，禁忌长度为 $\\tau$。在节点 u 从其先前的块移动到 t 的来源后，(u,t) 会被立即禁忌 $\\tau$ 次迭代。采用标准的特赦准则：如果一个禁忌移动能产生一个严格优于迄今为止所见最优解的目标值，则允许该移动。\n- 在每次迭代中，选择能产生最小移动后目标值 $E_{\\text{new}} = E_{\\text{current}} + \\Delta E$ 的可接受移动；通过最小的 $\\Delta E$ 来确定性地打破平局，然后通过字典序最小的 $(u,t)$ 来打破平局。\n- 当不存在可接受的移动或已耗尽固定的迭代预算 $T$ 时终止。\n\n从第一性原理出发，推导如何仅使用节点 $u$ 对应在 $A$ 中的局部行和列以及 $M$ 中的相应条目来计算单节点重新分配的 $\\Delta E$。明确说明接受规则以及如何确定禁忌状态和特赦覆盖。\n\n实现该算法并将其应用于以下测试套件。在下面的每个案例中，$A$ 都是对称的，所有列出的 $M$ 也都是对称的。\n\n测试用例 1 (类社团结构):\n- $n = 8$, $K = 2$,\n- $$A_1 = \\begin{bmatrix}\n0  1  1  1  0  0  0  0 \\\\\n1  0  1  1  0  0  0  0 \\\\\n1  1  0  1  0  0  0  0 \\\\\n1  1  1  0  0  0  0  0 \\\\\n0  0  0  0  0  1  1  1 \\\\\n0  0  0  0  1  0  1  1 \\\\\n0  0  0  0  1  1  0  1 \\\\\n0  0  0  0  1  1  1  0\n\\end{bmatrix},\\quad M_1 = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix},\\quad \\pi^{(0)}_1 = [0,0,1,1,0,0,1,1],\\quad T = 50,\\quad \\tau = 5.$$\n\n测试用例 2 (单块边界):\n- $n = 5$, $K = 1$,\n- $$A_2 = \\begin{bmatrix}\n0  0  0  0  0 \\\\\n0  0  0  0  0 \\\\\n0  0  0  0  0 \\\\\n0  0  0  0  0 \\\\\n0  0  0  0  0\n\\end{bmatrix},\\quad M_2 = \\begin{bmatrix} 1 \\end{bmatrix},\\quad \\pi^{(0)}_2 = [0,0,0,0,0],\\quad T = 10,\\quad \\tau = 3.$$\n\n测试用例 3 (类二分结构):\n- $n = 6$, $K = 2$,\n- $$A_3 = \\begin{bmatrix}\n0  0  0  1  1  1 \\\\\n0  0  0  1  1  1 \\\\\n0  0  0  1  1  1 \\\\\n1  1  1  0  0  0 \\\\\n1  1  1  0  0  0 \\\\\n1  1  1  0  0  0\n\\end{bmatrix},\\quad M_3 = \\begin{bmatrix} 0  1 \\\\ 1  0 \\end{bmatrix},\\quad \\pi^{(0)}_3 = [0,1,0,1,0,1],\\quad T = 50,\\quad \\tau = 4.$$\n\n测试用例 4 (需要禁忌规避的模糊边界):\n- $n = 7$, $K = 2$,\n- $$A_4 = \\begin{bmatrix}\n0  1  1  1  0  0  0 \\\\\n1  0  1  1  0  0  0 \\\\\n1  1  0  0  0  0  0 \\\\\n1  1  0  0  1  1  0 \\\\\n0  0  0  1  0  1  1 \\\\\n0  0  0  1  1  0  1 \\\\\n0  0  0  0  1  1  0\n\\end{bmatrix},\\quad M_4 = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix},\\quad \\pi^{(0)}_4 = [0,0,0,1,1,1,1],\\quad T = 100,\\quad \\tau = 7.$$\n\n您的程序应生成单行输出，其中包含一个位于方括号内的逗号分隔列表形式的结果。对于每个测试用例，结果必须是一个包含最终目标值和最终划分的列表，即 $[\\text{objective},[\\text{labels}]]$。因此，总输出必须为以下形式\n$$\n[\\,[E_1,[\\pi_1]],\\,[E_2,[\\pi_2]],\\,[E_3,[\\pi_3]],\\,[E_4,[\\pi_4]]\\,],\n$$\n其中每个 $E_k$ 是一个整数，每个列表 $[\\pi_k]$ 包含 $n$ 个在 $\\{0,1,\\dots,K-1\\}$ 中的整数。",
            "solution": "该问题要求实现一种禁忌搜索(TS)启发式算法，用以对给定的图邻接矩阵 $A$、初始划分 $\\pi^{(0)}$ 和理想映像矩阵 $M$，最小化广义块模型准则 $E(A,\\pi,M)$。搜索通过单节点重新分配的方式进行。\n\n首先，对问题陈述进行验证。核心概念——块模型、指定的误差准则和禁忌搜索——在网络科学和优化领域都是公认的，这使得该问题建立在坚实的科学原理之上。该问题是适定的、客观的且可形式化的。在禁忌表更新规则的定义中存在一个微小但关键的歧义：“在 u 从其先前的块移动到 t 的来源后，将 (u,t) 禁忌 $\\tau$ 次迭代。” 标准的禁忌搜索实践是禁止逆向移动以避免循环。即，如果节点 u 从块 r 移动到 t，则将 u 移回 r 的移动被禁止。我们将根据这一标准解释和实施该规则。因此，在该解释下，该问题被认为是有效的。\n\n解决方案分为两部分：局部移动下目标函数变化的推导，以及禁忌搜索算法的规范。\n\n### 目标函数变化量 ($\\Delta E$) 的推导\n\n目标函数由下式给出：\n$$\nE(A,\\pi,M) = \\sum_{i=1}^{n}\\sum_{\\substack{j=1 \\\\ j \\neq i}}^{n} \\left| A_{ij} - M_{\\pi(i), \\pi(j)} \\right|\n$$\n我们需要计算当单个节点 $u$ 从其当前块 $r = \\pi(u)$ 移动到一个新块 $t$ 时的变化量 $\\Delta E$。令 $\\pi_{old}$ 为移动前的划分，$\\pi_{new}$ 为移动后的划分。因此，$\\pi_{new}(u) = t$，$\\pi_{old}(u) = r$，且对于任何其他节点 $v \\neq u$，$\\pi_{new}(v) = \\pi_{old}(v) = \\pi(v)$。\n\n目标函数的变化量为 $\\Delta E = E(A,\\pi_{new},M) - E(A,\\pi_{old},M)$。\n$$\n\\Delta E = \\sum_{i=1}^{n}\\sum_{\\substack{j=1 \\\\ j \\neq i}}^{n} \\left( \\left| A_{ij} - M_{\\pi_{new}(i), \\pi_{new}(j)} \\right| - \\left| A_{ij} - M_{\\pi_{old}(i), \\pi_{old}(j)} \\right| \\right)\n$$\n仅当 $i$ 或 $j$ 的划分分配发生变化时，此求和中的项才非零。这只在 $i=u$ 或 $j=u$ 时发生。因此，我们可以分离出涉及节点 $u$ 的项：\n$$\n\\Delta E = \\sum_{j \\neq u} \\left( |A_{uj} - M_{\\pi_{new}(u),\\pi_{new}(j)}| - |A_{uj} - M_{\\pi_{old}(u),\\pi_{old}(j)}| \\right) + \\sum_{i \\neq u} \\left( |A_{iu} - M_{\\pi_{new}(i),\\pi_{new}(u)}| - |A_{iu} - M_{\\pi_{old}(i),\\pi_{old}(u)}| \\right)\n$$\n代入 $\\pi_{new}(u)=t$, $\\pi_{old}(u)=r$, 以及对于 $v \\neq u$ 的 $\\pi_{new}(v)=\\pi_{old}(v)=\\pi(v)$：\n$$\n\\Delta E = \\sum_{j \\neq u} \\left( |A_{uj} - M_{t, \\pi(j)}| - |A_{uj} - M_{r, \\pi(j)}| \\right) + \\sum_{i \\neq u} \\left( |A_{iu} - M_{\\pi(i), t}| - |A_{iu} - M_{\\pi(i), r}| \\right)\n$$\n由于图是无向的 ($A_{iu} = A_{uj}$) 且映像矩阵 $M$ 是对称的 ($M_{ab} = M_{ba}$)，第二个和式中的索引 $i$ 重命名为 $j$ 可以让我们合并这些项：\n$$\n\\Delta E = 2 \\sum_{j=1, j \\neq u}^{n} \\left( \\left| A_{uj} - M_{t, \\pi(j)} \\right| - \\left| A_{uj} - M_{r, \\pi(j)} \\right| \\right)\n$$\n该公式允许通过仅迭代节点 $u$ 的邻居来高效计算候选移动的误差变化，而无需重新计算整个 $n(n-1)$ 对的总和。\n\n### 禁忌搜索算法\n\n禁忌搜索算法的实现如下：\n1.  **初始化**: 从初始划分 $\\pi^{(0)}$ 开始。计算初始目标值 $E^{(0)} = E(A, \\pi^{(0)}, M)$。初始化已知最优划分和最优值，$\\pi_{best} = \\pi^{(0)}$ 和 $E_{best} = E^{(0)}$。禁忌表初始化为空。\n2.  **迭代**: 搜索最多进行 $T$ 次迭代。在每次迭代中：\n    a. **邻域探索**: 生成所有可能的移动。一个移动包括将单个节点 $u \\in \\{1, \\dots, n\\}$ 从其当前块 $\\pi(u)$ 重新分配到一个不同的块 $t \\in \\{1, \\dots, K\\} \\setminus \\{\\pi(u)\\}$。\n    b. **移动评估**: 对于每个候选移动 $(u, t)$，使用推导出的公式计算 $\\Delta E$。潜在的新目标值为 $E_{new} = E_{current} + \\Delta E$。\n    c. **可接受性检查**: 一个移动 $(u, t)$ 是可接受的，如果：\n        i. 它不是禁忌的。如果将节点 $u$ 移回其最近 $\\tau$ 次迭代内从中移出的块，则该移动是禁忌的。\n        ii. 或者它是禁忌的，但满足特赦准则，即 $E_{new}  E_{best}$。\n    d. **最佳移动选择**: 在所有可接受的移动中，选择导致最低 $E_{new}$ 的那一个。通过选择具有最小 $\\Delta E$ 的移动来打破平局。如果仍然存在平局，则通过选择字典序最小的对 $(u, t)$ 来打破。\n    e. **终止条件**: 如果找不到可接受的移动，搜索终止。\n    f. **状态更新**: 执行选定的最佳移动 $(u^*, t^*)$。设 $u^*$ 的前一个块为 $r^*$。\n        - 更新划分: $\\pi(u^*) \\leftarrow t^*$。\n        - 更新目标值: $E_{current} \\leftarrow E_{new}^*$。\n        - 更新禁忌表：任何现有的禁忌任期减 1。将逆向移动 $(u^*, r^*)$ 添加到禁忌表中，任期为 $\\tau$。\n        - 更新迄今为止的最优解：如果 $E_{current}  E_{best}$，则更新 $E_{best} \\leftarrow E_{current}$ 和 $\\pi_{best} \\leftarrow \\pi$。\n3.  **终止**: 当迭代预算 $T$ 耗尽或无法进行可接受的移动时，算法终止。最终结果是找到的最佳解 $(\\pi_{best}, E_{best})$。",
            "answer": "[[0,[0,0,0,0,1,1,1,1]],[20,[0,0,0,0,0]],[0,[0,0,0,1,1,1]],[4,[0,0,0,0,1,1,1]]]"
        }
    ]
}