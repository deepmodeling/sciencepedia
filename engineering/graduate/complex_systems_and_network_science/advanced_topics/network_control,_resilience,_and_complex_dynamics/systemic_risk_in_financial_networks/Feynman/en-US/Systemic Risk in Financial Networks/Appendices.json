{
    "hands_on_practices": [
        {
            "introduction": "Understanding systemic risk begins with the fundamental mechanics of how financial obligations are settled in a network. This first exercise provides a direct, hands-on calculation of a clearing vector within the seminal Eisenberg-Noe framework. By working through the hypothetical three-bank system presented in this problem , you will gain a concrete understanding of how limited liability and interbank exposures can lead to default contagion when an institution's assets are insufficient.",
            "id": "4306720",
            "problem": "Consider a financial system of three banks indexed by $i \\in \\{1,2,3\\}$ modeled by the Eisenberg–Noe (EN) framework. Each bank $i$ has total nominal liabilities $\\bar{p}_{i} \\ge 0$ to the system and faces external assets $a_{i} \\ge 0$. The relative liabilities matrix $\\Pi$ has entries $\\Pi_{ij} \\in [0,1]$ that represent the fraction of bank $i$’s total nominal liabilities owed to creditor $j$, with $\\sum_{j=1}^{3} \\Pi_{ij} = 1$ whenever $\\bar{p}_{i} > 0$. Let $p \\in \\mathbb{R}_{+}^{3}$ denote the realized payments vector at clearing.\n\nAssume limited liability and proportionality of repayments, so that each bank’s realized payment equals the minimum of its total nominal liabilities and its available resources (external assets plus realized interbank inflows). Formally, the clearing payments must satisfy, for each $i$,\n$$\n0 \\le p_{i} \\le \\bar{p}_{i}, \\quad p_{i} = \\min\\!\\left\\{ \\bar{p}_{i},\\ a_{i} + \\sum_{j=1}^{3} \\Pi_{j i}\\, p_{j} \\right\\}.\n$$\n\nYou are given the following instance (all quantities are in the same monetary unit):\n- Total nominal liabilities vector $\\bar{p} = (\\bar{p}_{1}, \\bar{p}_{2}, \\bar{p}_{3}) = (100, 90, 80)$.\n- Relative liabilities matrix\n$$\n\\Pi \\;=\\;\n\\begin{pmatrix}\n0 & 0.5 & 0.5 \\\\\n0.4 & 0 & 0.6 \\\\\n0.5 & 0.5 & 0\n\\end{pmatrix}.\n$$\n- External assets vector $a = (a_{1}, a_{2}, a_{3}) = (20, 30, 35)$.\n\nStarting from the definitions of limited liability and proportional repayment embedded in the Eisenberg–Noe framework, derive the fixed point equations for the clearing problem and solve explicitly for the clearing vector $p$. Identify the default set $D = \\{\\, i \\in \\{1,2,3\\} : p_{i} < \\bar{p}_{i} \\,\\}$ at the fixed point. \n\nAnswer format requirement: Report your final answer as a single row matrix containing six entries in the order $(p_{1}, p_{2}, p_{3}, d_{1}, d_{2}, d_{3})$, where $d_{i} = 1$ if bank $i$ defaults and $d_{i} = 0$ otherwise. No rounding is required. Do not include units in your final boxed answer.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard application of the Eisenberg–Noe financial clearing model, with all necessary data provided.\n\nThe clearing vector $p=(p_1, p_2, p_3)$ is determined by the fixed-point condition for each bank $i \\in \\{1,2,3\\}$:\n$$\np_{i} = \\min\\!\\left\\{ \\bar{p}_{i},\\ a_{i} + \\sum_{j=1}^{3} \\Pi_{j i}\\, p_{j} \\right\\}\n$$\nwhere $\\bar{p} = (100, 90, 80)$ is the vector of total nominal liabilities, $a = (20, 30, 35)$ is the vector of external assets, and $\\Pi$ is the relative liabilities matrix. The term $\\sum_{j=1}^{3} \\Pi_{j i}\\, p_{j}$ represents the total interbank assets received by bank $i$. This sum can be expressed using the transpose of $\\Pi$, denoted $\\Pi^T$, where $(\\Pi^T)_{ij} = \\Pi_{ji}$. The system of equations is:\n$$\n\\begin{pmatrix} p_1 \\\\ p_2 \\\\ p_3 \\end{pmatrix} = \\min\\!\\left\\{ \\begin{pmatrix} \\bar{p}_1 \\\\ \\bar{p}_2 \\\\ \\bar{p}_3 \\end{pmatrix}, \\begin{pmatrix} a_1 \\\\ a_2 \\\\ a_3 \\end{pmatrix} + \\Pi^T \\begin{pmatrix} p_1 \\\\ p_2 \\\\ p_3 \\end{pmatrix} \\right\\}\n$$\nGiven the matrix $\\Pi$, its transpose is:\n$$\n\\Pi^T =\n\\begin{pmatrix}\n0 & 0.4 & 0.5 \\\\\n0.5 & 0 & 0.5 \\\\\n0.5 & 0.6 & 0\n\\end{pmatrix}\n$$\nThe system of equations for the clearing payments becomes:\n$$\np_1 = \\min\\{100,\\, 20 + 0.4 p_2 + 0.5 p_3\\} \\\\\np_2 = \\min\\{90,\\, 30 + 0.5 p_1 + 0.5 p_3\\} \\\\\np_3 = \\min\\{80,\\, 35 + 0.5 p_1 + 0.6 p_2\\}\n$$\nTo solve this system, we can partition the set of banks into two disjoint sets: the set of defaulting banks, $D = \\{i : p_i < \\bar{p}_i\\}$, and the set of solvent banks, $S = \\{i : p_i = \\bar{p}_i\\}$. For a bank $i \\in D$, its realized payment equals its available resources. For a bank $i \\in S$, its realized payment equals its nominal liabilities, and its available resources must be sufficient to cover these liabilities.\nThis leads to the following system of equations and inequalities based on a hypothetical partition $(D, S)$:\nFor $i \\in D$: $p_i = a_i + \\sum_{j=1}^{3} \\Pi_{ji} p_j$\nFor $i \\in S$: $p_i = \\bar{p}_i$ and $a_i + \\sum_{j=1}^{3} \\Pi_{ji} p_j \\ge \\bar{p}_i$\n\nLet's first test the hypothesis that no bank defaults, i.e., $D = \\emptyset$ and $S = \\{1, 2, 3\\}$. This would mean $p = \\bar{p} = (100, 90, 80)$. We must check if the resource constraint is satisfied for all banks.\nFor bank $1$: $a_1 + \\sum_{j=1}^{3} \\Pi_{j1} p_j = 20 + 0.4(90) + 0.5(80) = 20 + 36 + 40 = 96$.\nThe condition for solvency is $96 \\ge \\bar{p}_1 = 100$, which is false. Therefore, the hypothesis $D = \\emptyset$ is incorrect. At least bank $1$ must default.\n\nLet's test the hypothesis $D = \\{1\\}$ and $S = \\{2, 3\\}$. This implies:\n1. Bank $1$ defaults: $p_1 < 100$, so $p_1 = 20 + 0.4 p_2 + 0.5 p_3$.\n2. Bank $2$ is solvent: $p_2 = \\bar{p}_2 = 90$.\n3. Bank $3$ is solvent: $p_3 = \\bar{p}_3 = 80$.\n\nWe substitute the values of $p_2$ and $p_3$ into the equation for $p_1$:\n$$\np_1 = 20 + 0.4(90) + 0.5(80) = 20 + 36 + 40 = 96\n$$\nThis gives a candidate solution vector $p = (96, 90, 80)$. Now, we must verify the consistency of this solution with our initial hypothesis for the partition $(D,S)$.\n- For bank $1 \\in D$: Is $p_1 < \\bar{p}_1$? We have $96 < 100$. This is consistent.\n- For bank $2 \\in S$: Is $p_2 = \\bar{p}_2$ and are its resources sufficient? We set $p_2=90$. We must check if $a_2 + \\sum_{j=1}^{3} \\Pi_{j2} p_j \\ge \\bar{p}_2$.\n$$\n30 + 0.5 p_1 + 0.5 p_3 = 30 + 0.5(96) + 0.5(80) = 30 + 48 + 40 = 118\n$$\nThe condition is $118 \\ge 90$, which is true. This is consistent.\n- For bank $3 \\in S$: Is $p_3 = \\bar{p}_3$ and are its resources sufficient? We set $p_3=80$. We must check if $a_3 + \\sum_{j=1}^{3} \\Pi_{j3} p_j \\ge \\bar{p}_3$.\n$$\n35 + 0.5 p_1 + 0.6 p_2 = 35 + 0.5(96) + 0.6(90) = 35 + 48 + 54 = 137\n$$\nThe condition is $137 \\ge 80$, which is true. This is also consistent.\n\nSince all conditions for the partition $D=\\{1\\}, S=\\{2,3\\}$ are satisfied, this partition is correct, and the unique clearing vector is $p = (96, 90, 80)$.\n\nThe default set is $D = \\{i : p_i < \\bar{p}_i\\}$.\n- Bank $1$: $p_1 = 96 < \\bar{p}_1 = 100$, so bank $1$ defaults. The default indicator is $d_1 = 1$.\n- Bank $2$: $p_2 = 90 = \\bar{p}_2 = 90$, so bank $2$ does not default. The default indicator is $d_2 = 0$.\n- Bank $3$: $p_3 = 80 = \\bar{p}_3 = 80$, so bank $3$ does not default. The default indicator is $d_3 = 0$.\n\nThe resulting clearing vector is $p=(p_1, p_2, p_3) = (96, 90, 80)$, and the default indicator vector is $d=(d_1, d_2, d_3) = (1, 0, 0)$. The final answer must be reported as the single row matrix $(p_1, p_2, p_3, d_1, d_2, d_3)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n96 & 90 & 80 & 1 & 0 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Intuition can sometimes be misleading when assessing risk in complex networks. This exercise uses a hypothetical core-periphery banking system to challenge the simple assumption that core institutions are always the most systemically important. By tracing the default cascade from two different initial shocks, you will discover how a node's specific liability structure, not just its label, determines its potential to destabilize the system .",
            "id": "2435839",
            "problem": "Consider a static interbank network with six banks in a core-periphery architecture: core banks $C_{1}, C_{2}, C_{3}$ and peripheral banks $P_{1}, P_{2}, P_{3}$. Let $L_{ij}$ denote the nominal interbank liability of bank $i$ to bank $j$ (so that $j$ is a creditor of $i$). The only nonzero interbank liabilities are:\n- $L_{P_{1},C_{1}} = 4$, $L_{P_{1},C_{2}} = 4$, $L_{P_{1},C_{3}} = 4$,\n- $L_{P_{2},C_{1}} = 4$,\n- $L_{P_{3},C_{2}} = 4$,\n- $L_{C_{1},C_{2}} = 4$, $L_{C_{2},C_{3}} = 4$, $L_{C_{3},C_{1}} = 4$.\n\nAll banks begin solvent with the same equity (capital) buffer $E_{i} = 3$ monetary units for every bank $i$. The recovery rate on interbank assets is $0$ (equivalently, Loss Given Default (LGD) equals $1$): if a borrower $i$ defaults, each creditor $j$ immediately marks down its interbank asset by $L_{ij}$. A bank $k$ defaults if and only if its equity becomes strictly negative. Contagion unfolds in discrete rounds: in each round, losses from any newly defaulted borrowers are passed to their creditors; the process stops when no new defaults occur. Equity beyond zero is not counted (limited liability).\n\nTwo experiments are considered, each initiated by an idiosyncratic external-asset shock at time $0$ large enough to force the targeted bank to default immediately:\n- Scenario S1 (high-degree peripheral shock): shock $P_{1}$ so that $P_{1}$ defaults at time $0$.\n- Scenario S2 (low-degree core shock): shock $C_{3}$ so that $C_{3}$ defaults at time $0$.\n\nDefine destabilization as the total number of bank defaults at the fixed point of the cascade (including the initially shocked bank). Which statement is correct for this network under the stated rules?\n\nA. Shocking the high-degree peripheral bank $P_{1}$ (Scenario S1) is more destabilizing than shocking the low-degree core bank $C_{3}$ (Scenario S2).\n\nB. Shocking the low-degree core bank $C_{3}$ (Scenario S2) is more destabilizing than shocking the high-degree peripheral bank $P_{1}$ (Scenario S1).\n\nC. Both scenarios are equally destabilizing.\n\nD. Neither scenario produces any contagion beyond the initially shocked bank.",
            "solution": "The problem statement shall first be validated for scientific and logical integrity.\n\n### Step 1: Extract Givens\nThe necessary information provided in the problem statement is as follows:\n- **Network Structure**: Six banks, categorized as core ($C_{1}, C_{2}, C_{3}$) and peripheral ($P_{1}, P_{2}, P_{3}$).\n- **Interbank Liabilities ($L_{ij}$)**: The nonzero liabilities are:\n  - $L_{P_{1},C_{1}} = 4$\n  - $L_{P_{1},C_{2}} = 4$\n  - $L_{P_{1},C_{3}} = 4$\n  - $L_{P_{2},C_{1}} = 4$\n  - $L_{P_{3},C_{2}} = 4$\n  - $L_{C_{1},C_{2}} = 4$\n  - $L_{C_{2},C_{3}} = 4$\n  - $L_{C_{3},C_{1}} = 4$\n- **Initial Conditions**: Every bank $i$ has an initial equity of $E_{i} = 3$ monetary units.\n- **Default Mechanics**:\n  - Recovery rate on interbank assets is $0$. This means Loss Given Default (LGD) is $1$.\n  - A bank $k$ defaults if its equity becomes strictly negative, i.e., $E_{k} < 0$.\n  - Contagion propagates in discrete rounds.\n- **Scenarios**:\n  - **Scenario S1**: Bank $P_{1}$ is shocked and defaults at time $t=0$.\n  - **Scenario S2**: Bank $C_{3}$ is shocked and defaults at time $t=0$.\n- **Metric**: Destabilization is defined as the total number of bank defaults in the final state.\n\n### Step 2: Validate Using Extracted Givens\nThe problem describes a contagion process on a financial network, a standard topic in computational economics and finance.\n- **Scientifically Grounded**: The model is a simplified form of established contagion models like those of Furfine or Eisenberg-Noe. It is based on accepted principles of balance sheet mechanics and default propagation.\n- **Well-Posed**: The network structure, initial conditions, and dynamic rules for contagion are explicitly and unambiguously defined. This allows for a unique, deterministic outcome for each scenario.\n- **Objective**: The problem is stated in precise, quantitative terms. The definitions of default and destabilization are clear and objective.\n- **Flaw Check**: The problem does not violate any of the invalidity criteria. It is self-contained, logically consistent, and computationally tractable. The descriptions \"high-degree\" and \"low-degree\" can be interpreted based on the out-degree of the nodes, which is relevant for contagion propagation. The out-degree of $P_1$ is $3$, while the out-degree of $C_3$ is $1$, making the terminology reasonable in this context.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will now be derived.\n\n### Derivation of Solution\nThe contagion process for each scenario is simulated round by round. The initial equity of every bank is $E_i = 3$. A bank $k$ defaults if its equity $E_k$ falls below $0$.\n\n**Scenario S1: Shocking peripheral bank $P_{1}$**\n\n- **Time $t=0$**: Bank $P_{1}$ is shocked and defaults.\n  - Set of defaulted banks, $D = \\{P_{1}\\}$.\n  - The creditors of $P_{1}$ are banks $j$ for which $L_{P_{1},j} > 0$. From the givens, these are $C_{1}$, $C_{2}$, and $C_{3}$.\n\n- **Time $t=1$**: Losses from $P_{1}$'s default are propagated to its creditors. The loss for each creditor is the full value of the liability, as the recovery rate is $0$.\n  - Equity of $C_{1}$ becomes: $E_{C_{1}}' = E_{C_{1}} - L_{P_{1},C_{1}} = 3 - 4 = -1$.\n  - Equity of $C_{2}$ becomes: $E_{C_{2}}' = E_{C_{2}} - L_{P_{1},C_{2}} = 3 - 4 = -1$.\n  - Equity of $C_{3}$ becomes: $E_{C_{3}}' = E_{C_{3}} - L_{P_{1},C_{3}} = 3 - 4 = -1$.\n  - We check for new defaults:\n    - $E_{C_{1}}' < 0 \\implies C_{1}$ defaults.\n    - $E_{C_{2}}' < 0 \\implies C_{2}$ defaults.\n    - $E_{C_{3}}' < 0 \\implies C_{3}$ defaults.\n  - New defaults in this round are $\\{C_{1}, C_{2}, C_{3}\\}$.\n  - The set of defaulted banks is now $D = \\{P_{1}, C_{1}, C_{2}, C_{3}\\}$.\n\n- **Time $t=2$**: Losses from the defaults of $C_{1}$, $C_{2}$, and $C_{3}$ (from round $t=1$) are propagated. We must check which currently solvent banks are creditors to these newly defaulted banks.\n  - The only solvent banks are $P_{2}$ and $P_{3}$.\n  - We check if $P_2$ or $P_3$ are creditors of $C_1, C_2, C_3$. There are no liabilities of the form $L_{C_{k}, P_{j}}$, so they are not. Their equity remains at $3$.\n  - The creditors of $C_{1}$ is $C_{2}$ ($L_{C_{1},C_{2}}=4$), of $C_{2}$ is $C_{3}$ ($L_{C_{2},C_{3}}=4$), and of $C_{3}$ is $C_{1}$ ($L_{C_{3},C_{1}}=4$). However, all these creditors ($C_1, C_2, C_3$) are already defaulted. Thus, their default does not trigger any *new* defaults among the solvent population.\n  - No new banks default in this round.\n\n- **Fixed Point**: Since no new defaults occurred in round $t=2$, the cascade has stopped.\n  - The final set of defaulted banks for Scenario S1 is $\\{P_{1}, C_{1}, C_{2}, C_{3}\\}$.\n  - The total destabilization is $4$ defaults.\n\n**Scenario S2: Shocking core bank $C_{3}$**\n\n- **Time $t=0$**: Bank $C_{3}$ is shocked and defaults.\n  - Set of defaulted banks, $D = \\{C_{3}\\}$.\n  - The creditors of $C_{3}$ are banks $j$ for which $L_{C_{3},j} > 0$. From the givens, the only creditor is $C_{1}$ ($L_{C_{3},C_{1}} = 4$).\n\n- **Time $t=1$**: The loss from $C_{3}$'s default is propagated to its creditor, $C_{1}$.\n  - Equity of $C_{1}$ becomes: $E_{C_{1}}' = E_{C_{1}} - L_{C_{3},C_{1}} = 3 - 4 = -1$.\n  - We check for new defaults: $E_{C_{1}}' < 0 \\implies C_{1}$ defaults.\n  - New defaults in this round: $\\{C_{1}\\}$.\n  - The set of defaulted banks is now $D = \\{C_{3}, C_{1}\\}$.\n\n- **Time $t=2$**: The loss from $C_{1}$'s default (from round $t=1$) is propagated.\n  - The creditor of $C_{1}$ is $C_{2}$ ($L_{C_{1},C_{2}} = 4$). Bank $C_2$ is currently solvent ($E_{C_{2}} = 3$).\n  - Equity of $C_{2}$ becomes: $E_{C_{2}}' = E_{C_{2}} - L_{C_{1},C_{2}} = 3 - 4 = -1$.\n  - We check for new defaults: $E_{C_{2}}' < 0 \\implies C_{2}$ defaults.\n  - New defaults in this round: $\\{C_{2}\\}$.\n  - The set of defaulted banks is now $D = \\{C_{3}, C_{1}, C_{2}\\}$.\n\n- **Time $t=3$**: The loss from $C_{2}$'s default (from round $t=2$) is propagated.\n  - The creditor of $C_{2}$ is $C_{3}$ ($L_{C_{2},C_{3}} = 4$).\n  - Bank $C_{3}$ is already in the set of defaulted banks. No new default is triggered.\n  - No solvent banks are creditors of $C_{2}$.\n  - No new banks default in this round.\n\n- **Fixed Point**: Since no new defaults occurred in round $t=3$, the cascade has stopped.\n  - The final set of defaulted banks for Scenario S2 is $\\{C_{3}, C_{1}, C_{2}\\}$.\n  - The total destabilization is $3$ defaults.\n\n**Comparison of Scenarios**\n- Destabilization in Scenario S1: $4$ defaults.\n- Destabilization in Scenario S2: $3$ defaults.\nSince $4 > 3$, Scenario S1 is more destabilizing than Scenario S2.\n\n### Option-by-Option Analysis\n\n**A. Shocking the high-degree peripheral bank $P_{1}$ (Scenario S1) is more destabilizing than shocking the low-degree core bank $C_{3}$ (Scenario S2).**\nAs calculated, S1 results in $4$ defaults and S2 results in $3$ defaults. $4 > 3$. Thus, S1 is more destabilizing. The labels \"high-degree\" and \"low-degree\" are consistent if \"degree\" refers to the out-degree (number of creditors to whom the bank is indebted), which is the channel for initiating contagion. The out-degree of $P_1$ is $3$, and the out-degree of $C_3$ is $1$. This statement is consistent with the derivations.\n**Verdict: Correct.**\n\n**B. Shocking the low-degree core bank $C_{3}$ (Scenario S2) is more destabilizing than shocking the high-degree peripheral bank $P_{1}$ (Scenario S1).**\nThis statement claims that $3 > 4$, which is mathematically false.\n**Verdict: Incorrect.**\n\n**C. Both scenarios are equally destabilizing.**\nThis statement claims that $4 = 3$, which is mathematically false.\n**Verdict: Incorrect.**\n\n**D. Neither scenario produces any contagion beyond the initially shocked bank.**\nIn S1, banks $C_{1}, C_{2}, C_{3}$ default due to contagion. In S2, banks $C_{1}, C_{2}$ default due to contagion. In both cases, contagion clearly occurs.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Beyond describing and predicting contagion, financial network models provide powerful tools for designing interventions. This practice problem shifts our perspective from analysis to policy, asking a critical question: what is the minimum capital injection required to stabilize a system after a shock? By solving for this optimal intervention, you will apply the principles of the Eisenberg-Noe model to a practical problem of financial regulation and crisis management .",
            "id": "2435808",
            "problem": "Consider a financial system with $n$ institutions, represented by a directed weighted liability network. Let $L \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$ be the nominal liability matrix where $L_{ij}$ is the obligation of institution $i$ to institution $j$. Define the total nominal liabilities vector $\\bar{p} \\in \\mathbb{R}_{\\ge 0}^{n}$ by\n$$\n\\bar{p}_i \\equiv \\sum_{j=1}^{n} L_{ij}.\n$$\nDefine the relative liability matrix $\\Pi \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$ by\n$$\n\\Pi_{ij} \\equiv \n\\begin{cases}\n\\dfrac{L_{ij}}{\\bar{p}_i}, & \\text{if } \\bar{p}_i > 0, \\\\\n0, & \\text{if } \\bar{p}_i = 0,\n\\end{cases}\n$$\nso that each row of $\\Pi$ sums to at most $1$. Let $x \\in \\mathbb{R}_{\\ge 0}^{n}$ be the vector of external assets prior to any shock.\n\nAn initial shock of size $S_0 \\ge 0$ to a designated node $i \\in \\{1,\\dots,n\\}$ reduces its external assets to $x_i' = \\max\\{x_i - S_0, 0\\}$, while $x_k' = x_k$ for all $k \\ne i$. A non-negative capital injection $\\Delta C \\ge 0$ may then be allocated exclusively to the shocked node $i$, yielding post-injection external assets $x_i'' = x_i' + \\Delta C$ and $x_k'' = x_k'$ for all $k \\ne i$.\n\nPayments clear according to the Eisenberg–Noe fixed-point model: a clearing payment vector $p \\in \\mathbb{R}_{\\ge 0}^{n}$ must satisfy\n$$\np = \\min\\left\\{\\bar{p},\\, \\Pi^\\top p + x''\\right\\},\n$$\nwhere the minimum is taken componentwise and $x''$ is the post-injection external assets vector.\n\nDefine “stabilize the network” to mean that all institutions pay in full, i.e., the clearing payments equal the total nominal liabilities: $p = \\bar{p}$. In other words, stabilization requires that full repayment by all institutions is feasible under the Eisenberg–Noe model with the given shock and the capital injection applied only to node $i$.\n\nTask. For each test case below, compute the minimum capital injection $\\Delta C_{\\min}$ (in the same capital units as $x$ and $L$) required to stabilize the network after the initial shock of size $S_0$ to the specified node $i$. If no finite non-negative $\\Delta C$ allocated exclusively to node $i$ can achieve full repayment by all institutions, return the value $-1.0$ for that test case.\n\nYour program must produce a single line of output containing all results as a comma-separated list enclosed in square brackets, with each number rounded to exactly $6$ decimals. For example, a valid output for four results is of the form $[r_1,r_2,r_3,r_4]$ with each $r_k$ displayed to $6$ decimals.\n\nUse the following test suite. In each case, the network size is $n = 3$.\n\nTest case $1$ (general case):\n- Node index shocked: $i = 1$ (using $1$-based indexing; your program may use $0$-based internally but must respect the data as given here).\n- Initial shock: $S_0 = 1.5$.\n- Liability matrix:\n$$\nL = \\begin{bmatrix}\n0 & 2 & 0 \\\\\n0 & 0 & 1 \\\\\n1 & 0 & 0\n\\end{bmatrix}.\n$$\n- External assets:\n$$\nx = \\begin{bmatrix}\n2 \\\\\n1 \\\\\n0.5\n\\end{bmatrix}.\n$$\n\nTest case $2$ (already stable after shock, requiring zero injection):\n- Node index shocked: $i = 1$.\n- Initial shock: $S_0 = 0.2$.\n- Liability matrix:\n$$\nL = \\begin{bmatrix}\n0 & 2 & 0 \\\\\n0 & 0 & 1 \\\\\n1 & 0 & 0\n\\end{bmatrix}.\n$$\n- External assets:\n$$\nx = \\begin{bmatrix}\n2 \\\\\n1 \\\\\n0.5\n\\end{bmatrix}.\n$$\n\nTest case $3$ (impossible to stabilize by injecting only at the shocked node):\n- Node index shocked: $i = 3$.\n- Initial shock: $S_0 = 0$.\n- Liability matrix:\n$$\nL = \\begin{bmatrix}\n0 & 1 & 0 \\\\\n0 & 0 & 1 \\\\\n0 & 0 & 0\n\\end{bmatrix}.\n$$\n- External assets:\n$$\nx = \\begin{bmatrix}\n0.1 \\\\\n0.1 \\\\\n0.1\n\\end{bmatrix}.\n$$\n\nTest case $4$ (boundary case with a zero-liability node being shocked):\n- Node index shocked: $i = 1$.\n- Initial shock: $S_0 = 10.0$.\n- Liability matrix:\n$$\nL = \\begin{bmatrix}\n0 & 0 & 0 \\\\\n1 & 0 & 0 \\\\\n0 & 1 & 0\n\\end{bmatrix}.\n$$\n- External assets:\n$$\nx = \\begin{bmatrix}\n0.5 \\\\\n0.5 \\\\\n1.0\n\\end{bmatrix}.\n$$\n\nFinal output format requirement. Your program should produce a single line of output containing the results in order for Test cases $1$ through $4$ as a comma-separated list enclosed in square brackets, with each value rounded to exactly $6$ decimals, for example\n$$\n[\\Delta C_{\\min}^{(1)},\\Delta C_{\\min}^{(2)},\\Delta C_{\\min}^{(3)},\\Delta C_{\\min}^{(4)}].\n$$\nIf stabilization is impossible by injecting only at the shocked node, print $-1.000000$ for that case.",
            "solution": "The problem statement is subjected to validation.\n\nStep 1: Extract Givens\n- The number of institutions is $n$.\n- The nominal liability matrix is $L \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$, where $L_{ij}$ is the debt of institution $i$ to $j$.\n- The total nominal liabilities vector is $\\bar{p} \\in \\mathbb{R}_{\\ge 0}^{n}$, defined by $\\bar{p}_i \\equiv \\sum_{j=1}^{n} L_{ij}$.\n- The relative liability matrix is $\\Pi \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$, defined by $\\Pi_{ij} \\equiv L_{ij}/\\bar{p}_i$ if $\\bar{p}_i > 0$, and $\\Pi_{ij} = 0$ if $\\bar{p}_i = 0$.\n- The vector of external assets is $x \\in \\mathbb{R}_{\\ge 0}^{n}$.\n- An initial shock of size $S_0 \\ge 0$ is applied to a designated node $i$.\n- The post-shock external assets vector $x'$ is defined by $x_i' = \\max\\{x_i - S_0, 0\\}$ and $x_k' = x_k$ for $k \\ne i$.\n- A capital injection $\\Delta C \\ge 0$ is allocated to the shocked node $i$.\n- The post-injection external assets vector $x''$ is defined by $x_i'' = x_i' + \\Delta C$ and $x_k'' = x_k'$ for $k \\ne i$.\n- The clearing payment vector $p \\in \\mathbb{R}_{\\ge 0}^{n}$ satisfies the fixed-point equation $p = \\min\\left\\{\\bar{p},\\, \\Pi^\\top p + x''\\right\\}$.\n- Network stabilization is defined as the condition where all institutions pay in full, i.e., $p = \\bar{p}$.\n- The task is to find the minimum capital injection $\\Delta C_{\\min}$ to stabilize the network. If stabilization by injecting only at node $i$ is not possible, the value is $-1.0$.\n- Four test cases are provided with specific values for $n$, $L$, $x$, $i$, and $S_0$.\n\nStep 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on the Eisenberg–Noe model of financial clearing, a cornerstone of systemic risk analysis in computational economics. The model is mathematically rigorous and widely accepted. The premises are factually sound within this framework.\n- **Well-Posed**: The problem asks for the minimum of a non-negative quantity, $\\Delta C$, subject to a set of linear inequalities. This structure is well-posed. The conditions for existence and uniqueness of a solution are well-defined by the problem's constraints.\n- **Objective**: All terms are defined with mathematical precision. The instructions are clear and unambiguous, free of subjective language.\n- **Completeness and Consistency**: The problem provides all necessary data ($L, x, i, S_0$) and definitions to formulate a solution. There are no internal contradictions.\n\nStep 3: Verdict and Action\nThe problem is valid. It is a well-defined mathematical exercise in the context of a recognized economic model. A solution will now be formulated.\n\nThe core of the problem is to determine the minimum non-negative capital injection, $\\Delta C_{\\min}$, required to achieve network stabilization. Stabilization is defined by the clearing payment vector $p$ being equal to the total nominal liabilities vector $\\bar{p}$, that is, $p = \\bar{p}$.\n\nThe clearing process is governed by the fixed-point equation:\n$$\np = \\min\\left\\{\\bar{p}, \\Pi^\\top p + x''\\right\\}\n$$\nwhere the minimum is taken component-wise. For stabilization to occur, we must have $p = \\bar{p}$. Substituting this condition into the equation yields:\n$$\n\\bar{p} = \\min\\left\\{\\bar{p}, \\Pi^\\top \\bar{p} + x''\\right\\}\n$$\nThis equality holds if and only if for every institution $k \\in \\{1, \\dots, n\\}$, the following inequality is satisfied:\n$$\n\\bar{p}_k \\le (\\Pi^\\top \\bar{p})_k + x''_k\n$$\nThis system of $n$ linear inequalities represents the condition that each institution's total available funds (incoming payments from other institutions, $\\Pi^\\top \\bar{p}$, plus its own post-injection external assets, $x''$) are sufficient to cover its total nominal liabilities, $\\bar{p}$. Let us expand the matrix-vector product term:\n$$\n(\\Pi^\\top \\bar{p})_k = \\sum_{j=1}^{n} (\\Pi^\\top)_{kj} \\bar{p}_j = \\sum_{j=1}^{n} \\Pi_{jk} \\bar{p}_j\n$$\nThe post-injection external assets vector $x''$ depends on the initial shock $S_0$ and the capital injection $\\Delta C$, both applied to a single node $i$. The components of $x''$ are:\n$$\nx''_k = \\begin{cases}\n\\max\\{x_i - S_0, 0\\} + \\Delta C, & \\text{if } k=i \\\\\nx_k, & \\text{if } k \\ne i \\text{ and } k \\text{ is not the shocked node}\n\\end{cases}\n$$\nMore precisely, the shock is applied to node $i$, after which the injection is applied to the same node $i$. Let the shocked node have index $i_{shock}$.\nThen for any node $k$:\n$$\nx'_k = \\begin{cases}\n\\max\\{x_{i_{shock}} - S_0, 0\\}, & \\text{if } k=i_{shock} \\\\\nx_k, & \\text{if } k \\ne i_{shock}\n\\end{cases}\n$$\nAnd the post-injection assets are:\n$$\nx''_k = \\begin{cases}\nx'_{i_{shock}} + \\Delta C, & \\text{if } k=i_{shock} \\\\\nx'_k, & \\text{if } k \\ne i_{shock}\n\\end{cases}\n$$\nWe substitute this into our system of inequalities.\n\nFor any institution $k \\ne i_{shock}$, the stability condition is:\n$$\n\\bar{p}_k \\le \\sum_{j=1}^{n} \\Pi_{jk} \\bar{p}_j + x_k\n$$\nThis inequality does not depend on $\\Delta C$ or $S_0$ (as the shock is not on node $k$). If this condition is violated for any $k \\ne i_{shock}$, then institution $k$ is insolvent even before any shock is considered on node $i_{shock}$. Let's re-read the problem statement carefully: \"An initial shock...reduces its external assets...while $x_k' = x_k$ for all $k \\ne i$\". So all non-shocked nodes retain their original assets. The condition for $k \\ne i_{shock}$ is:\n$$\n\\bar{p}_k \\le \\sum_{j=1}^{n} \\Pi_{jk} \\bar{p}_j + x_k\n$$\nHowever, my initial reading was slightly imprecise. The shock hits node $i$, so $x_i$ is affected. My asset vectors should be defined relative to the initial vector $x$. The post-shock, pre-injection vector is $x'$.\n$$\nx'_k = x_k \\text{ for } k \\ne i_{shock} \\text{ and } x'_{i_{shock}} = \\max(x_{i_{shock}}-S_0, 0).\n$$\nThe post-injection vector is $x''$.\n$$\nx''_k = x'_k \\text{ for } k \\ne i_{shock} \\text{ and } x''_{i_{shock}} = x'_{i_{shock}} + \\Delta C.\n$$\nThe system of stability inequalities is $\\bar{p} \\le \\Pi^\\top \\bar{p} + x''$.\n\nFor any node $k \\ne i_{shock}$:\n$$\n\\bar{p}_k \\le \\sum_{j=1}^{n} \\Pi_{jk} \\bar{p}_j + x'_k = \\sum_{j=1}^{n} \\Pi_{jk} \\bar{p}_j + x_k\n$$\nThis condition is independent of the shock $S_0$ and the injection $\\Delta C$. Let us define the \"solvency gap\" for each node $k$, pre-injection, as:\n$$\nG_k = \\bar{p}_k - \\left( \\sum_{j=1}^{n} \\Pi_{jk} \\bar{p}_j + x'_k \\right)\n$$\nFor stabilization to be possible by only injecting capital into node $i_{shock}$, all other nodes $k \\ne i_{shock}$ must be solvent on their own. That is, for all $k \\ne i_{shock}$, it must be that $G_k \\le 0$. If there exists any $k \\ne i_{shock}$ such that $G_k > 0$, then no amount of capital injected into node $i_{shock}$ can remedy the shortfall at node $k$. In this case, stabilization is impossible, and the result is $-1.0$.\n\nFor the shocked node $k = i_{shock}$, the stability condition is:\n$$\n\\bar{p}_{i_{shock}} \\le \\sum_{j=1}^{n} \\Pi_{j,i_{shock}} \\bar{p}_j + x''_{i_{shock}}\n$$\nSubstituting $x''_{i_{shock}} = x'_{i_{shock}} + \\Delta C$:\n$$\n\\bar{p}_{i_{shock}} \\le \\sum_{j=1}^{n} \\Pi_{j,i_{shock}} \\bar{p}_j + x'_{i_{shock}} + \\Delta C\n$$\nWe can rearrange this inequality to solve for the required injection $\\Delta C$:\n$$\n\\Delta C \\ge \\bar{p}_{i_{shock}} - \\left( \\sum_{j=1}^{n} \\Pi_{j,i_{shock}} \\bar{p}_j + x'_{i_{shock}} \\right) = G_{i_{shock}}\n$$\nSince the capital injection must be non-negative ($\\Delta C \\ge 0$), the minimum capital injection required is $\\Delta C_{\\min} = \\max\\{0, G_{i_{shock}}\\}$.\n\nThe complete algorithm is as follows:\n1.  Given $L$, $x$, $i_{shock}$ (1-based), and $S_0$. Convert $i_{shock}$ to a 0-based index.\n2.  Compute the vector of total nominal liabilities $\\bar{p}$ from $L$: $\\bar{p}_i = \\sum_j L_{ij}$.\n3.  Compute the relative liability matrix $\\Pi$. For each row $i$: if $\\bar{p}_i > 0$, $\\Pi_{ij} = L_{ij} / \\bar{p}_i$; otherwise $\\Pi_{ij} = 0$.\n4.  Compute the post-shock external asset vector $x'$. Let $i_{idx} = i_{shock} - 1$.\n    - $x'_{i_{idx}} = \\max\\{x_{i_{idx}} - S_0, 0\\}$.\n    - For all $k \\ne i_{idx}$, $x'_k = x_k$.\n5.  Compute the vector of total expected incoming payments from other institutions, assuming full repayment: $v = \\Pi^\\top \\bar{p}$.\n6.  For each institution $k=0, \\dots, n-1$, compute the solvency gap $G_k = \\bar{p}_k - (v_k + x'_k)$.\n7.  Check for impossibility. For each $k \\ne i_{idx}$, if $G_k > 0$, stabilization is impossible. Return $-1.0$.\n8.  If the check in step 7 passes, calculate the minimum required injection: $\\Delta C_{\\min} = \\max\\{0, G_{i_{idx}}\\}$. Return this value.\n\nThis procedure correctly addresses all aspects of the problem statement.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the minimum capital injection to stabilize a financial network\n    for a series of test cases.\n    \"\"\"\n\n    # Test cases defined in the problem statement.\n    test_cases = [\n        {\n            \"shocked_node_idx\": 1,\n            \"S0\": 1.5,\n            \"L\": np.array([\n                [0, 2, 0],\n                [0, 0, 1],\n                [1, 0, 0]\n            ]),\n            \"x\": np.array([2, 1, 0.5])\n        },\n        {\n            \"shocked_node_idx\": 1,\n            \"S0\": 0.2,\n            \"L\": np.array([\n                [0, 2, 0],\n                [0, 0, 1],\n                [1, 0, 0]\n            ]),\n            \"x\": np.array([2, 1, 0.5])\n        },\n        {\n            \"shocked_node_idx\": 3,\n            \"S0\": 0.0,\n            \"L\": np.array([\n                [0, 1, 0],\n                [0, 0, 1],\n                [0, 0, 0]\n            ]),\n            \"x\": np.array([0.1, 0.1, 0.1])\n        },\n        {\n            \"shocked_node_idx\": 1,\n            \"S0\": 10.0,\n            \"L\": np.array([\n                [0, 0, 0],\n                [1, 0, 0],\n                [0, 1, 0]\n            ]),\n            \"x\": np.array([0.5, 0.5, 1.0])\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        L = case[\"L\"]\n        x = case[\"x\"]\n        # Convert 1-based shocked_node_idx to 0-based index\n        shocked_node_idx_0based = case[\"shocked_node_idx\"] - 1\n        S0 = case[\"S0\"]\n        n = L.shape[0]\n\n        # Step 2: Compute total nominal liabilities p_bar\n        p_bar = np.sum(L, axis=1)\n\n        # Step 3: Compute relative liability matrix Pi\n        Pi = np.zeros_like(L, dtype=float)\n        # Use np.divide to handle division by zero where p_bar_i is 0\n        non_zero_liabilities = p_bar > 1e-12 # Use tolerance for float comparison\n        Pi[non_zero_liabilities] = np.divide(\n            L[non_zero_liabilities], \n            p_bar[non_zero_liabilities, np.newaxis]\n        )\n\n        # Step 4: Compute post-shock external asset vector x_prime\n        x_prime = x.copy().astype(float)\n        x_prime[shocked_node_idx_0based] = np.maximum(\n            x[shocked_node_idx_0based] - S0, 0\n        )\n\n        # Step 5: Compute expected incoming payments v = Pi^T * p_bar\n        v = Pi.T @ p_bar\n\n        # Step 6: Compute solvency gaps G_k\n        # G_k = p_bar_k - (v_k + x_prime_k)\n        gaps = p_bar - (v + x_prime)\n\n        # Step 7: Check for impossibility\n        is_impossible = False\n        for k in range(n):\n            if k != shocked_node_idx_0based:\n                # If any non-shocked node has a positive gap, stabilization is impossible.\n                # A small tolerance is used for floating point comparisons.\n                if gaps[k] > 1e-9:\n                    is_impossible = True\n                    break\n        \n        if is_impossible:\n            results.append(-1.0)\n            continue\n\n        # Step 8: Calculate minimum injection for the shocked node\n        # delta_C_min = max(0, G_{i_shock})\n        delta_C_min = np.maximum(0.0, gaps[shocked_node_idx_0based])\n        results.append(delta_C_min)\n\n    # Format the final output according to problem specification\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}