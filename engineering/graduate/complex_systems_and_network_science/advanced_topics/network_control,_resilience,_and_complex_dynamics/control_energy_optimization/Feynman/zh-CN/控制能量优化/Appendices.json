{
    "hands_on_practices": [
        {
            "introduction": "理论学习的最佳方式是从最简单的模型开始。本练习将引导你从第一性原理出发，为一个标量（单节点）离散时间线性系统计算最小控制能量。通过运用拉格朗日乘子法，你将亲手推导出驱动系统达到期望状态所需的精确能量，并探索系统不稳定性对控制成本的有趣影响。",
            "id": "4270331",
            "problem": "考虑一个离散时间标量线性时不变 (LTI) 系统，其动态由 $x_{k+1} = a x_{k} + b u_{k}$ 给出，其中 $a \\in \\mathbb{R}$ 且 $|a| \\neq 1$，$b \\in \\mathbb{R} \\setminus \\{0\\}$，$u_{k} \\in \\mathbb{R}$ 是控制输入。假设初始条件为 $x_{0} \\in \\mathbb{R}$，在有限时域 $N \\in \\mathbb{N}$ 的目标终端状态为 $x_{N} = 0$。在所有能使 $x_{N} = 0$ 的输入序列 $\\{u_{k}\\}_{k=0}^{N-1}$ 中，定义有限时域控制能量为 $E = \\sum_{k=0}^{N-1} u_{k}^{2}$。\n\n仅使用离散时间线性系统的基本原理、带线性等式约束的优化以及几何级数的性质（不使用任何预先给定的控制能量公式），推导在 $N$ 步内将系统从 $x_{0}$ 驱动到 $x_{N} = 0$ 所需的精确最小能量 $E^{\\ast}(N)$。然后，在 $|a| > 1$ 的假设下，通过计算极限 $E_{\\infty} = \\lim_{N \\to \\infty} E^{\\ast}(N)$，解析地研究当时间范围 $N$ 增加时 $|a| > 1$ 对 $E^{\\ast}(N)$ 的影响。\n\n您的最终答案必须包含两个并列呈现的闭式表达式：首先是 $E^{\\ast}(N)$ 作为 $a$、$b$、$x_{0}$ 和 $N$ 的显式函数；其次是当 $|a| > 1$ 时的极限 $E_{\\infty}$。不需要进行数值四舍五入，也无需指定物理单位。请以精确形式表示两个结果。",
            "solution": "所述问题具有科学依据，是适定的、客观且自洽的。这是线性系统最优控制理论中的一个基本问题，因此是有效的。我们将进行完整的推导。\n\n离散时间标量LTI系统的动态由下式给出：\n$$x_{k+1} = a x_{k} + b u_{k}$$\n其中 $x_k \\in \\mathbb{R}$ 是状态，$u_k \\in \\mathbb{R}$ 是控制输入，参数 $a, b \\in \\mathbb{R}$ 满足 $|a| \\neq 1$ 和 $b \\neq 0$。初始状态为 $x_0$，时域为有限整数 $N$。\n\n首先，我们通过迭代应用状态更新方程来确定在时间 $N$ 的状态，记为 $x_N$：\n$x_1 = a x_0 + b u_0$\n$x_2 = a x_1 + b u_1 = a(a x_0 + b u_0) + b u_1 = a^2 x_0 + a b u_0 + b u_1$\n$x_3 = a x_2 + b u_2 = a(a^2 x_0 + a b u_0 + a b u_1) + b u_2 = a^3 x_0 + a^2 b u_0 + a b u_1 + b u_2$\n\n通过归纳法，在时间 $N$ 的状态可以表示为初始状态 $x_0$ 和控制输入序列 $\\{u_k\\}_{k=0}^{N-1}$ 的函数：\n$$x_N = a^N x_0 + \\sum_{k=0}^{N-1} a^{N-1-k} b u_k$$\n\n问题要求将系统驱动到目标状态 $x_N = 0$。这对控制输入施加了一个线性约束：\n$$a^N x_0 + \\sum_{k=0}^{N-1} a^{N-1-k} b u_k = 0$$\n可以重写为：\n$$\\sum_{k=0}^{N-1} \\left( a^{N-1-k} b \\right) u_k = -a^N x_0$$\n\n目标是找到满足此约束同时最小化控制能量的输入序列 $\\{u_k\\}_{k=0}^{N-1}$，能量定义为：\n$$E = \\sum_{k=0}^{N-1} u_k^2$$\n\n这是一个约束优化问题。我们可以使用拉格朗日乘子法来求解。我们定义拉格朗日函数 $\\mathcal{L}$ 为：\n$$\\mathcal{L}(\\{u_k\\}, \\lambda) = \\sum_{k=0}^{N-1} u_k^2 + \\lambda \\left( \\sum_{k=0}^{N-1} a^{N-1-k} b u_k + a^N x_0 \\right)$$\n其中 $\\lambda$ 是拉格朗日乘子。\n\n为了求最小值，我们将 $\\mathcal{L}$ 对每个控制输入 $u_j$ （对于 $j = 0, 1, \\dots, N-1$）的偏导数设为零：\n$$\\frac{\\partial \\mathcal{L}}{\\partial u_j} = 2u_j + \\lambda \\left( a^{N-1-j} b \\right) = 0$$\n求解 $u_j$，我们得到最优控制输入的形式，记为 $u_j^*$：\n$$u_j^* = -\\frac{\\lambda b}{2} a^{N-1-j}$$\n\n接下来，我们将 $u_j^*$ 的表达式代回线性约束方程，以确定 $\\lambda$ 的值：\n$$\\sum_{j=0}^{N-1} a^{N-1-j} b \\left( -\\frac{\\lambda b}{2} a^{N-1-j} \\right) = -a^N x_0$$\n$$-\\frac{\\lambda b^2}{2} \\sum_{j=0}^{N-1} a^{2(N-1-j)} = -a^N x_0$$\n我们来计算这个求和。通过将求和索引改为 $m = N-1-j$，当 $j$ 从 $0$ 变为 $N-1$ 时，$m$ 从 $N-1$ 变为 $0$。该和是一个几何级数：\n$$\\sum_{j=0}^{N-1} a^{2(N-1-j)} = \\sum_{m=0}^{N-1} (a^2)^m$$\n由于问题陈述 $|a| \\neq 1$，因此 $a^2 \\neq 1$。于是，我们可以应用有限几何级数的求和公式：\n$$\\sum_{m=0}^{N-1} (a^2)^m = \\frac{(a^2)^N - 1}{a^2 - 1} = \\frac{a^{2N} - 1}{a^2 - 1}$$\n将此结果代回我们关于 $\\lambda$ 的方程中：\n$$\\frac{\\lambda b^2}{2} \\left( \\frac{a^{2N} - 1}{a^2 - 1} \\right) = a^N x_0$$\n求解 $\\lambda$：\n$$\\lambda = \\frac{2 a^N x_0}{b^2} \\left( \\frac{a^2 - 1}{a^{2N} - 1} \\right)$$\n\n现在我们可以通过将最优输入 $u_j^*$ 代入能量定义方程来计算最小控制能量 $E^*(N)$：\n$$E^*(N) = \\sum_{j=0}^{N-1} (u_j^*)^2 = \\sum_{j=0}^{N-1} \\left( -\\frac{\\lambda b}{2} a^{N-1-j} \\right)^2 = \\left( \\frac{\\lambda b}{2} \\right)^2 \\sum_{j=0}^{N-1} a^{2(N-1-j)}$$\n我们已经计算过这个和，所以：\n$$E^*(N) = \\left( \\frac{\\lambda b}{2} \\right)^2 \\left( \\frac{a^{2N} - 1}{a^2 - 1} \\right)$$\n代入 $\\lambda$ 的表达式：\n$$\\frac{\\lambda b}{2} = \\frac{b}{2} \\left[ \\frac{2 a^N x_0}{b^2} \\left( \\frac{a^2 - 1}{a^{2N} - 1} \\right) \\right] = \\frac{a^N x_0}{b} \\left( \\frac{a^2 - 1}{a^{2N} - 1} \\right)$$\n因此，最小能量为：\n$$E^*(N) = \\left[ \\frac{a^N x_0}{b} \\left( \\frac{a^2 - 1}{a^{2N} - 1} \\right) \\right]^2 \\left( \\frac{a^{2N} - 1}{a^2 - 1} \\right)$$\n$$E^*(N) = \\frac{a^{2N} x_0^2}{b^2} \\frac{(a^2 - 1)^2}{(a^{2N} - 1)^2} \\frac{a^{2N} - 1}{a^2 - 1}$$\n简化此表达式得到第一个结果：\n$$E^*(N) = \\frac{a^{2N} x_0^2 (a^2 - 1)}{b^2 (a^{2N} - 1)}$$\n\n问题的第二部分是计算在 $|a| > 1$ 的情况下 $E_\\infty = \\lim_{N \\to \\infty} E^*(N)$ 的极限。为了便于极限计算，我们可以通过将分子和分母同除以 $a^{2N}$ 来重写 $E^*(N)$：\n$$E^*(N) = \\frac{x_0^2 (a^2 - 1)}{b^2 (1 - a^{-2N})}$$\n现在，我们取 $N \\to \\infty$ 的极限。在条件 $|a| > 1$ 下，可得 $a^2 > 1$。因此，项 $a^{-2N} = (a^2)^{-N}$ 趋近于零：\n$$\\lim_{N \\to \\infty} a^{-2N} = \\lim_{N \\to \\infty} \\frac{1}{(a^2)^N} = 0$$\n将此极限应用于 $E^*(N)$ 的表达式：\n$$E_\\infty = \\lim_{N \\to \\infty} E^*(N) = \\lim_{N \\to \\infty} \\frac{x_0^2 (a^2 - 1)}{b^2 (1 - a^{-2N})} = \\frac{x_0^2 (a^2 - 1)}{b^2 (1 - 0)}$$\n这给出了第二个结果：\n$$E_\\infty = \\frac{x_0^2 (a^2 - 1)}{b^2}$$\n这个有限的极限表明，将一个不稳定系统的轨迹“轻推”到一条在无限时域内自然收敛于原点的路径上所需的能量。",
            "answer": "$$\n\\boxed{ E^*(N) = \\frac{a^{2N} x_0^2 (a^2 - 1)}{b^2 (a^{2N} - 1)}, \\quad E_\\infty = \\frac{x_0^2 (a^2 - 1)}{b^2} }\n$$"
        },
        {
            "introduction": "在实际网络中，我们通常更关心控制系统的特定输出（如几个关键节点的平均活动），而非整个网络的状态。本练习将场景从状态控制推广到更普遍的输出控制，要求你为一个多节点连续时间系统计算最小控制能量。你将推导出一个“降维”的目标度量 $C W_{c}(T) C^{\\top}$，它精确地刻画了实现输出目标的能量代价，这对于理解和设计大规模系统的控制策略至关重要。",
            "id": "4270307",
            "problem": "一个具有 $3$ 个节点的网络系统被建模为一个线性时不变（LTI）系统，其状态动力学为 $\\dot{x}(t) = A x(t) + B u(t)$，初始条件为 $x(0) = 0$，输出为 $y(t) = C x(t)$。需要选择控制信号 $u(t)$，以在有限时域 $[0, T]$ 上最小化二次控制能量 $J = \\int_{0}^{T} u(t)^{\\top} u(t) \\, dt$，并满足在由 $y = C x$ 定义的输出子空间中达到指定输出目标 $y(T) = y_T$ 的约束。假设矩阵为\n$$\nA = \\begin{pmatrix} -1  0  0 \\\\ 0  -2  0 \\\\ 0  0  -3 \\end{pmatrix}, \\quad B = I_{3}, \\quad C = \\begin{pmatrix} 2  -1  1 \\end{pmatrix},\n$$\n其中 $I_{3}$ 是 $3 \\times 3$ 单位矩阵。\n\n从基本原理出发，推导满足终端输出约束 $y(T) = y_T$ 所需的最小控制能量的表达式，并证明输出空间中的相关简化目标度量由 $C W_{c}(T) C^{\\top}$ 给出，其中有限时域能控性格拉姆矩阵 $W_{c}(T)$ 定义为\n$$\nW_{c}(T) = \\int_{0}^{T} \\exp(A t) B B^{\\top} \\exp(A^{\\top} t) \\, dt.\n$$\n对于给定的 $A$、$B$ 和 $C$ 矩阵，显式计算 $C W_{c}(T) C^{\\top}$，并将最小控制能量表示为关于 $T$ 和 $y_T$ 的闭式解析表达式。无需四舍五入。最终答案无需单位。",
            "solution": "所述问题是在线性系统最优控制领域中一个适定、有科学依据的问题。所有必要的数据和定义均已提供，不存在内部矛盾或违反物理或数学原理的情况。因此，我将进行形式化的求解。\n\n问题是找到由代价泛函 $J = \\int_{0}^{T} u(t)^{\\top} u(t) \\, dt$ 定义的最小控制能量，以将一个线性时不变（LTI）系统从指定的初始状态驱动到指定的终端输出。\n\n系统动力学由下式给出：\n$$\n\\dot{x}(t) = A x(t) + B u(t)\n$$\n初始条件为 $x(0) = 0$，输出为 $y(t) = C x(t)$。目标是找到在区间 $[0, T]$ 上的一个控制输入 $u(t)$，使得 $J$ 最小化，同时满足终端约束 $y(T) = y_T$。\n\n首先，我们求解状态方程。LTI系统方程的解由常数变易法公式给出：\n$$\nx(t) = \\exp(At) x(0) + \\int_{0}^{t} \\exp(A(t - \\tau)) B u(\\tau) \\, d\\tau\n$$\n应用初始条件 $x(0) = 0$，在最终时刻 $T$ 的状态为：\n$$\nx(T) = \\int_{0}^{T} \\exp(A(T - \\tau)) B u(\\tau) \\, d\\tau\n$$\n输出约束为 $y(T) = C x(T) = y_T$。代入 $x(T)$ 的表达式，我们得到对控制输入 $u(t)$ 的约束：\n$$\ny_T = C \\int_{0}^{T} \\exp(A(T - \\tau)) B u(\\tau) \\, d\\tau\n$$\n该方程可以看作一个线性算子方程 $y_T = \\mathcal{L}(u)$，其中算子 $\\mathcal{L}$ 将一个函数 $u \\in L_2([0, T], \\mathbb{R}^3)$ 映射到一个向量 $y_T \\in \\mathbb{R}$。问题是找到一个满足此约束且具有最小 $L_2$ 范数的函数 $u(t)$，其中 $\\|u\\|_{L_2}^2 = \\int_{0}^{T} u(\\tau)^{\\top} u(\\tau) \\, d\\tau = J$。\n\n这是一个希尔伯特空间中的标准最小范数问题。解由 $u_{opt} = \\mathcal{L}^*(\\mathcal{L}\\mathcal{L}^*)^{-1}y_T$ 给出，其中 $\\mathcal{L}^*$ 是算子 $\\mathcal{L}$ 的伴随算子。我们从其定义性质确定伴随算子 $\\mathcal{L}^*$：对于任意 $v \\in \\mathbb{R}$ 和 $u \\in L_2([0, T], \\mathbb{R}^3)$，有 $\\langle v, \\mathcal{L}(u) \\rangle_{\\mathbb{R}} = \\langle \\mathcal{L}^*(v), u \\rangle_{L_2}$。\n\n左边是：\n$$\n\\langle v, \\mathcal{L}(u) \\rangle = v^{\\top} y_T = v^{\\top} C \\int_{0}^{T} \\exp(A(T - \\tau)) B u(\\tau) \\, d\\tau = \\int_{0}^{T} \\left( v^{\\top} C \\exp(A(T - \\tau)) B \\right) u(\\tau) \\, d\\tau\n$$\n右边是：\n$$\n\\langle \\mathcal{L}^*(v), u \\rangle = \\int_{0}^{T} (\\mathcal{L}^*(v))(\\tau)^{\\top} u(\\tau) \\, d\\tau\n$$\n通过比较被积函数，我们确定伴随算子的作用：\n$$\n(\\mathcal{L}^*(v))(\\tau)^{\\top} = v^{\\top} C \\exp(A(T - \\tau)) B\n$$\n对两边取转置，我们得到：\n$$\n(\\mathcal{L}^*(v))(\\tau) = B^{\\top} \\exp(A^{\\top}(T - \\tau)) C^{\\top} v\n$$\n接下来，我们计算复合算子 $\\mathcal{L}\\mathcal{L}^*$，它将 $\\mathbb{R}$ 映射到 $\\mathbb{R}$：\n$$\n\\mathcal{L}\\mathcal{L}^*(v) = \\mathcal{L}((\\mathcal{L}^*(v))(\\cdot)) = C \\int_{0}^{T} \\exp(A(T - \\tau)) B \\left( B^{\\top} \\exp(A^{\\top}(T - \\tau)) C^{\\top} v \\right) \\, d\\tau\n$$\n$$\n\\mathcal{L}\\mathcal{L}^*(v) = \\left( C \\left[ \\int_{0}^{T} \\exp(A(T - \\tau)) B B^{\\top} \\exp(A^{\\top}(T - \\tau)) \\, d\\tau \\right] C^{\\top} \\right) v\n$$\n我们在积分中进行变量替换，令 $t = T - \\tau$。则 $dt = -d\\tau$。积分限从 $\\tau=0 \\to t=T$ 和 $\\tau=T \\to t=0$ 变化。\n$$\n\\int_{T}^{0} \\exp(At) B B^{\\top} \\exp(A^{\\top} t) \\, (-dt) = \\int_{0}^{T} \\exp(At) B B^{\\top} \\exp(A^{\\top} t) \\, dt\n$$\n这个积分恰好是有限时域能控性格拉姆矩阵 $W_c(T)$ 的定义。因此：\n$$\n\\mathcal{L}\\mathcal{L}^* = C W_c(T) C^{\\top}\n$$\n最优控制输入则为：\n$$\nu_{opt}(\\tau) = \\mathcal{L}^* ((\\mathcal{L}\\mathcal{L}^*)^{-1} y_T) = B^{\\top} \\exp(A^{\\top}(T - \\tau)) C^{\\top} (C W_c(T) C^{\\top})^{-1} y_T\n$$\n最小控制能量 $J_{min}$ 是 $u_{opt}$ 的范数平方：\n$$\nJ_{min} = \\langle u_{opt}, u_{opt} \\rangle_{L_2} = \\langle \\mathcal{L}^* ((\\mathcal{L}\\mathcal{L}^*)^{-1} y_T), \\mathcal{L}^* ((\\mathcal{L}\\mathcal{L}^*)^{-1} y_T) \\rangle_{L_2}\n$$\n利用伴随算子的性质，这变为：\n$$\nJ_{min} = \\langle (\\mathcal{L}\\mathcal{L}^*)^{-1} y_T, \\mathcal{L}\\mathcal{L}^* ((\\mathcal{L}\\mathcal{L}^*)^{-1} y_T) \\rangle_{\\mathbb{R}} = \\langle (\\mathcal{L}\\mathcal{L}^*)^{-1} y_T, y_T \\rangle_{\\mathbb{R}}\n$$\n由于 $y_T$ 是一个标量（一个 $1 \\times 1$ 向量），其转置是其自身，内积即为标准乘法。代入 $\\mathcal{L}\\mathcal{L}^* = C W_c(T) C^{\\top}$，我们得到最小能量的表达式：\n$$\nJ_{min} = y_T^{\\top} (C W_c(T) C^{\\top})^{-1} y_T\n$$\n此推导表明，矩阵 $C W_c(T) C^{\\top}$ 是决定在输出空间中达到目标所需控制能量的关键度量。\n\n现在，我们为给定的系统矩阵计算这个度量：\n$$\nA = \\begin{pmatrix} -1  0  0 \\\\ 0  -2  0 \\\\ 0  0  -3 \\end{pmatrix}, \\quad B = I_{3}, \\quad C = \\begin{pmatrix} 2  -1  1 \\end{pmatrix}\n$$\n由于 $A$ 是对角矩阵，其指数函数很简单：\n$$\n\\exp(At) = \\begin{pmatrix} \\exp(-t)  0  0 \\\\ 0  \\exp(-2t)  0 \\\\ 0  0  \\exp(-3t) \\end{pmatrix}\n$$\n此外，$A$ 是对称的，所以 $A^{\\top} = A$。并且 $B = I_3$，所以 $B B^{\\top} = I_3 I_3^{\\top} = I_3$。\n能控性格拉姆矩阵为：\n$$\nW_{c}(T) = \\int_{0}^{T} \\exp(At) I_3 \\exp(At) \\, dt = \\int_{0}^{T} \\exp(2At) \\, dt\n$$\n矩阵 $\\exp(2At)$ 为：\n$$\n\\exp(2At) = \\begin{pmatrix} \\exp(-2t)  0  0 \\\\ 0  \\exp(-4t)  0 \\\\ 0  0  \\exp(-6t) \\end{pmatrix}\n$$\n我们将该矩阵从 $0$ 到 $T$ 逐元素积分：\n$$\n(W_{c}(T))_{11} = \\int_{0}^{T} \\exp(-2t) dt = \\left[-\\frac{1}{2}\\exp(-2t)\\right]_{0}^{T} = \\frac{1}{2}(1 - \\exp(-2T))\n$$\n$$\n(W_{c}(T))_{22} = \\int_{0}^{T} \\exp(-4t) dt = \\left[-\\frac{1}{4}\\exp(-4t)\\right]_{0}^{T} = \\frac{1}{4}(1 - \\exp(-4T))\n$$\n$$\n(W_{c}(T))_{33} = \\int_{0}^{T} \\exp(-6t) dt = \\left[-\\frac{1}{6}\\exp(-6t)\\right]_{0}^{T} = \\frac{1}{6}(1 - \\exp(-6T))\n$$\n非对角元素为零。因此，$W_c(T)$ 是一个对角矩阵：\n$$\nW_{c}(T) = \\begin{pmatrix} \\frac{1}{2}(1 - \\exp(-2T))  0  0 \\\\ 0  \\frac{1}{4}(1 - \\exp(-4T))  0 \\\\ 0  0  \\frac{1}{6}(1 - \\exp(-6T)) \\end{pmatrix}\n$$\n现在我们计算标量 $C W_c(T) C^{\\top}$：\n$$\nC W_c(T) C^{\\top} = \\begin{pmatrix} 2  -1  1 \\end{pmatrix} W_c(T) \\begin{pmatrix} 2 \\\\ -1 \\\\ 1 \\end{pmatrix}\n$$\n由于 $W_c(T)$ 是对角的，这等于 $\\sum_{i=1}^{3} C_{i}^2 (W_c(T))_{ii}$：\n$$\nC W_c(T) C^{\\top} = (2)^2 \\left( \\frac{1}{2}(1 - \\exp(-2T)) \\right) + (-1)^2 \\left( \\frac{1}{4}(1 - \\exp(-4T)) \\right) + (1)^2 \\left( \\frac{1}{6}(1 - \\exp(-6T)) \\right)\n$$\n$$\nC W_c(T) C^{\\top} = 4 \\cdot \\frac{1}{2}(1 - \\exp(-2T)) + 1 \\cdot \\frac{1}{4}(1 - \\exp(-4T)) + 1 \\cdot \\frac{1}{6}(1 - \\exp(-6T))\n$$\n$$\nC W_c(T) C^{\\top} = 2(1 - \\exp(-2T)) + \\frac{1}{4}(1 - \\exp(-4T)) + \\frac{1}{6}(1 - \\exp(-6T))\n$$\n$$\nC W_c(T) C^{\\top} = \\left(2 + \\frac{1}{4} + \\frac{1}{6}\\right) - 2\\exp(-2T) - \\frac{1}{4}\\exp(-4T) - \\frac{1}{6}\\exp(-6T)\n$$\n常数项为 $2 + \\frac{1}{4} + \\frac{1}{6} = \\frac{24}{12} + \\frac{3}{12} + \\frac{2}{12} = \\frac{29}{12}$。\n所以，该度量的显式表达式为：\n$$\nC W_c(T) C^{\\top} = \\frac{29}{12} - 2\\exp(-2T) - \\frac{1}{4}\\exp(-4T) - \\frac{1}{6}\\exp(-6T)\n$$\n最后，最小控制能量为 $J_{min} = y_T^2 (C W_c(T) C^{\\top})^{-1}$。由于 $y_T$ 是一个标量：\n$$\nJ_{min} = \\frac{y_T^2}{\\frac{29}{12} - 2\\exp(-2T) - \\frac{1}{4}\\exp(-4T) - \\frac{1}{6}\\exp(-6T)}\n$$\n为了简化表达式，我们可以将分子和分母同乘以 $12$：\n$$\nJ_{min} = \\frac{12 y_T^2}{29 - 24\\exp(-2T) - 3\\exp(-4T) - 2\\exp(-6T)}\n$$\n这就是最小控制能量的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{12 y_T^2}{29 - 24\\exp(-2T) - 3\\exp(-4T) - 2\\exp(-6T)}}\n$$"
        },
        {
            "introduction": "线性模型是强大的分析工具，但现实世界充满非线性。本练习旨在让你直面这一挑战，通过编程比较一个非线性系统与其线性化近似的最小控制能量。你将首先为线性化模型推导能量的解析解，然后运用庞特里亚金最小值原理（PMP）和数值“打靶法”为原始非线性系统寻找最优控制。这项练习不仅能让你深刻理解线性化假设的适用边界，还将为你装备解决更复杂、更真实控制问题的计算能力。",
            "id": "4270303",
            "problem": "考虑一个带有三次非线性的标量受控动力系统，由常微分方程 (ODE) $ \\dot{x}(t) = a x(t) + \\alpha x(t)^3 + b u(t) $ 给出，其中 $ x(t) \\in \\mathbb{R} $ 是状态，$ u(t) \\in \\mathbb{R} $ 是控制输入，$ a \\in \\mathbb{R} $ 是线性漂移系数，$ \\alpha \\in \\mathbb{R} $ 是三次非线性系数，$ b \\in \\mathbb{R} $ 是输入增益。目标是在一个固定的时间范围 $ T > 0 $ 内，将系统从初始状态 $ x(0) = x_0 $ 驱动到终端状态 $ x(T) = x_f $，同时最小化由 $ J = \\int_0^T u(t)^2 \\, dt $ 定义的控制能量。\n\n您将比较两种最小能量的概念：\n- 通过线性化计算的最小能量：通过忽略三次项来线性化系统，得到线性时不变 (LTI) 系统 $ \\dot{x}(t) = a x(t) + b u(t) $，并计算在区间 $ [0, T] $ 上将状态从 $ x_0 $ 驱动到 $ x_f $ 所需的最小能量。\n- 精确的非线性最优控制能量：使用最优控制的第一性原理，计算非线性系统 $ \\dot{x}(t) = a x(t) + \\alpha x(t)^3 + b u(t) $ 的最小能量。\n\n您的推导和算法必须基于基本原理：\n- 对于 LTI 情况，使用线性系统的解表示和可控性格拉姆矩阵的概念来确定满足端点约束的最小能量。\n- 对于非线性情况，使用庞特里亚金最小值原理 (PMP)，构建哈密顿量 $ H(x,u,p) $ 并推导最优性条件。庞特里亚金最小值原理 (PMP) 指出，对于受系统动力学和固定端点约束的最小化 $ J = \\int_0^T u(t)^2 \\, dt $ 问题，最优控制在时间上逐点最小化哈密顿量 $ H(x,u,p) = u^2 + p \\left(a x + \\alpha x^3 + b u\\right) $，其中 $ p(t) $ 是协态。必要条件包括 $ \\dot{x}(t) = \\frac{\\partial H}{\\partial p} $，$ \\dot{p}(t) = -\\frac{\\partial H}{\\partial x} $ 和 $ \\frac{\\partial H}{\\partial u} = 0 $。\n\n您的程序必须实现以下任务：\n1. 对于线性化系统 $ \\dot{x}(t) = a x(t) + b u(t) $，计算在时间 $ T $ 内将系统从 $ x_0 $ 驱动到 $ x_f $ 所需的精确最小能量 $ J_{\\text{lin}} $。\n2. 对于非线性系统 $ \\dot{x}(t) = a x(t) + \\alpha x(t)^3 + b u(t) $，通过庞特里亚金最小值原理和数值两点边值方法（对于标量系统，这简化为对协态初值的打靶法），计算精确的最小能量 $ J_{\\text{nl}} $。\n3. 通过报告相对误差 $ \\varepsilon = \\left|J_{\\text{lin}} - J_{\\text{nl}}\\right| / J_{\\text{nl}} $ 来量化线性化的近似误差。\n\n所有计算都是纯数学的；不涉及物理单位。不使用角度。\n\n测试套件：\n使用以下参数集 $ (a, b, \\alpha, x_0, x_f, T) $：\n- 情况 1（通用情况，稳定的线性漂移，中等非线性）：$ a = -0.2 $，$ b = 1.0 $，$ \\alpha = 0.1 $，$ x_0 = 0.2 $，$ x_f = -0.2 $，$ T = 2.0 $。\n- 情况 2（边界情况 $ a = 0 $）：$ a = 0.0 $，$ b = 1.5 $，$ \\alpha = 0.05 $，$ x_0 = 0.0 $，$ x_f = 0.1 $，$ T = 1.0 $。\n- 情况 3（不稳定的线性漂移与起稳定作用的三次非线性）：$ a = 0.1 $，$ b = 2.0 $，$ \\alpha = -0.2 $，$ x_0 = 0.1 $，$ x_f = 0.0 $，$ T = 1.5 $。\n- 情况 4（更长的时间范围，更强的非线性）：$ a = -0.05 $，$ b = 1.0 $，$ \\alpha = 0.2 $，$ x_0 = -0.3 $，$ x_f = 0.3 $，$ T = 3.0 $。\n- 情况 5（近线性区域）：$ a = 0.0 $，$ b = 1.0 $，$ \\alpha = 10^{-3} $，$ x_0 = 0.5 $，$ x_f = -0.5 $，$ T = 1.0 $。\n\n输出规范：\n您的程序应生成单行输出，其中包含所有五个情况的结果，格式为一个由方括号括起来的逗号分隔列表，其中每个元素本身是一个包含三个十进制表示的实数的列表 $ [J_{\\text{lin}}, J_{\\text{nl}}, \\varepsilon] $。例如，输出格式必须类似于 $ [[J_{\\text{lin},1},J_{\\text{nl},1},\\varepsilon_1],[J_{\\text{lin},2},J_{\\text{nl},2},\\varepsilon_2],\\dots] $。\n\n您的实现必须是自包含的，并且不需要用户输入。",
            "solution": "该问题是一个最优控制问题，其目标是找到一个控制输入 $u(t)$，在固定的时间范围内将一个动力系统从初始状态引导到最终状态，同时最小化一个成本泛函，本例中为控制能量 $J = \\int_0^T u(t)^2 \\, dt$。我们被要求比较非线性系统与其线性化系统的最小能量。\n\n该问题是有效的，因为它在科学上基于最优控制理论，在数学上是适定的，并且所有定义和参数都已提供，从而可以计算出唯一且有意义的解。\n\n我们将首先推导线性化系统最小能量的解析解。随后，我们将对非线性系统应用庞特里亚金最小值原理 (PMP) 来推导必要的最优性条件，这些条件构成一个两点边值问题 (TPBVP)。该 TPBVP 将使用打靶法进行数值求解，以找到非线性系统的精确最小能量。\n\n### 第 1 部分：线性化系统的最小能量 ($J_{\\text{lin}}$)\n\n给定的非线性系统为\n$$\n\\dot{x}(t) = a x(t) + \\alpha x(t)^3 + b u(t)\n$$\n通过忽略三次项 ($\\alpha x(t)^3$)，我们得到线性化的线性时不变 (LTI) 系统：\n$$\n\\dot{x}(t) = a x(t) + b u(t)\n$$\n边界条件为 $x(0) = x_0$ 和 $x(T) = x_f$。目标是最小化控制能量 $J = \\int_0^T u(t)^2 \\, dt$。\n\nLTI 系统在时间 $t=T$ 的解由常数变易法公式给出：\n$$\nx(T) = x_f = e^{aT} x_0 + \\int_0^T e^{a(T-\\tau)} b u(\\tau) \\, d\\tau\n$$\n整理后得到对控制输入的约束：\n$$\nx_f - e^{aT} x_0 = \\int_0^T e^{a(T-\\tau)} b u(\\tau) \\, d\\tau\n$$\n问题在于找到满足此积分约束且具有最小 $L_2$ 范数的函数 $u(t)$。控制理论的标准结果以可控性格拉姆矩阵的形式给出了最小能量。对于这个标量系统，格拉姆矩阵是一个标量：\n$$\nW(T) = \\int_0^T \\left(e^{a\\tau} b\\right) \\left(e^{a\\tau} b\\right)^T \\, d\\tau = b^2 \\int_0^T e^{2a\\tau} \\, d\\tau\n$$\n我们根据 $a$ 的值来计算积分：\n1.  如果 $a \\neq 0$：\n    $$\n    W(T) = b^2 \\left[ \\frac{e^{2a\\tau}}{2a} \\right]_0^T = b^2 \\frac{e^{2aT} - 1}{2a}\n    $$\n2.  如果 $a = 0$：\n    $$\n    W(T) = b^2 \\int_0^T 1 \\, d\\tau = b^2 T\n    $$\nLTI 系统的最小控制能量 $J_{\\text{lin}}$ 由以下公式给出：\n$$\nJ_{\\text{lin}} = \\left(x_f - e^{aT}x_0\\right)^T W(T)^{-1} \\left(x_f - e^{aT}x_0\\right) = \\frac{\\left(x_f - e^{aT}x_0\\right)^2}{W(T)}\n$$\n假设系统是可控的（即 $b \\neq 0$ 且 $T > 0$），则 $W(T)$ 是正的，能量是良定义的。\n\n### 第 2 部分：非线性系统的最小能量 ($J_{\\text{nl}}$)\n\n现在我们考虑原始的非线性系统：\n$$\n\\dot{x}(t) = a x(t) + \\alpha x(t)^3 + b u(t)\n$$\n其中 $x(0) = x_0$，$x(T) = x_f$，成本为 $J = \\int_0^T u(t)^2 \\, dt$。我们应用庞特里亚金最小值原理 (PMP)。首先，我们构建哈密顿量 $H(x, u, p)$，其中 $p(t)$ 是协态变量：\n$$\nH(x, u, p) = u(t)^2 + p(t) \\left(a x(t) + \\alpha x(t)^3 + b u(t)\\right)\n$$\n最优性的必要条件是：\n1.  **状态方程：** $\\dot{x}(t) = \\frac{\\partial H}{\\partial p} = a x(t) + \\alpha x(t)^3 + b u(t)$\n2.  **协态方程：** $\\dot{p}(t) = -\\frac{\\partial H}{\\partial x} = -p(t) \\left(a + 3\\alpha x(t)^2\\right)$\n3.  **最优性条件：** $\\frac{\\partial H}{\\partial u} = 2u(t) + p(t)b = 0$\n\n从最优性条件，我们找到用协态 $p(t)$ 表示的最优控制 $u^*(t)$ 的表达式：\n$$\nu^*(t) = -\\frac{b}{2} p(t)\n$$\n将此最优控制代入状态方程，得到一个关于状态 $x(t)$ 和协态 $p(t)$ 的耦合一阶常微分方程 (ODE) 组：\n$$\n\\begin{cases}\n\\dot{x}(t) = a x(t) + \\alpha x(t)^3 - \\frac{b^2}{2} p(t) \\\\\n\\dot{p}(t) = -p(t) \\left(a + 3\\alpha x(t)^2\\right)\n\\end{cases}\n$$\n这些 ODE 受分离边界条件 $x(0) = x_0$ 和 $x(T) = x_f$ 的约束。这构成了一个两点边值问题 (TPBVP)。\n\n为求解此 TPBVP，我们采用数值打靶法。我们将未知的初始协态 $p(0) = p_0$ 视为一个待求参数。对于给定的 $p_0$ 猜测值，我们可以将该 ODE 系统作为一个初值问题 (IVP) 求解，其初始条件为 $(x(0), p(0)) = (x_0, p_0)$。从 $t=0$ 到 $t=T$ 积分，得到终端状态 $x(T; p_0)$。正确的 $p_0$ 值是满足终端约束的那个，即 $x(T; p_0) = x_f$。我们可以定义一个误差函数 $E(p_0) = x(T; p_0) - x_f$，并使用数值求根算法找到 $p_0^*$ 使得 $E(p_0^*) = 0$。\n\n一旦找到最优初始协态 $p_0^*$，就将该系统作为 IVP 最后求解一次，以获得完整的状态和协态最优轨迹 $x^*(t)$ 和 $p^*(t)$。然后通过对最优控制的平方进行积分来计算非线性系统的最小控制能量 $J_{\\text{nl}}$：\n$$\nJ_{\\text{nl}} = \\int_0^T \\left(u^*(t)\\right)^2 \\, dt = \\int_0^T \\left(-\\frac{b}{2} p^*(t)\\right)^2 \\, dt = \\frac{b^2}{4} \\int_0^T \\left(p^*(t)\\right)^2 \\, dt\n$$\n这个最终的积分是使用获得的协态轨迹进行数值计算的。\n\n### 第 3 部分：相对误差计算\n\n线性化方法的相对误差 $\\varepsilon$ 按规定量化：\n$$\n\\varepsilon = \\frac{\\left|J_{\\text{lin}} - J_{\\text{nl}}\\right|}{J_{\\text{nl}}}\n$$\n该指标表明从简化线性模型计算出的能量在多大程度上近似于非线性系统的真实最优能量。一个小的 $\\varepsilon$ 值表明，对于给定的参数和状态转移，线性化是一个合理的近似，当非线性系数 $\\alpha$ 很小或状态轨迹 $x(t)$ 保持在原点附近时，这是符合预期的。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp, simpson\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Solves the optimal control problem for five test cases, calculating\n    linearized energy, nonlinear energy, and the relative error.\n    \"\"\"\n    test_cases = [\n        # (a, b, alpha, x0, xf, T)\n        (-0.2, 1.0, 0.1, 0.2, -0.2, 2.0),\n        (0.0, 1.5, 0.05, 0.0, 0.1, 1.0),\n        (0.1, 2.0, -0.2, 0.1, 0.0, 1.5),\n        (-0.05, 1.0, 0.2, -0.3, 0.3, 3.0),\n        (0.0, 1.0, 1e-3, 0.5, -0.5, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, b, alpha, x0, xf, T = case\n\n        # Task 1: Compute minimal energy for the linearized system (J_lin)\n        if np.abs(a)  1e-9:  # Handle the a=0 case numerically\n            gramian = b**2 * T\n        else:\n            gramian = b**2 * (np.exp(2 * a * T) - 1) / (2 * a)\n        \n        if np.abs(gramian)  1e-12:\n            # This case corresponds to an uncontrollable system (b=0 or T=0),\n            # which is not in the test suite.\n            j_lin = np.inf\n        else:\n            numerator = (xf - x0 * np.exp(a * T))**2\n            j_lin = numerator / gramian\n\n        # Task 2: Compute minimal energy for the nonlinear system (J_nl)\n        \n        # Define the coupled ODE system for state (x) and costate (p)\n        def ode_system(t, y, a, b, alpha):\n            x, p = y\n            x_dot = a * x + alpha * x**3 - (b**2 / 2.0) * p\n            p_dot = -(a + 3.0 * alpha * x**2) * p\n            return [x_dot, p_dot]\n\n        # Define the objective function for the shooting method.\n        # Its root is the p0 that makes x(T) = xf.\n        def objective(p0, a, b, alpha, x0, xf, T):\n            y0 = [x0, p0]\n            # Integrate the ODEs from t=0 to t=T\n            sol = solve_ivp(\n                ode_system, [0, T], y0, args=(a, b, alpha),\n                rtol=1e-9, atol=1e-9\n            )\n            # Return the difference between the final state and the target state\n            x_T = sol.y[0, -1]\n            return x_T - xf\n\n        # Use a root-finding algorithm to find the optimal initial costate p0.\n        # We use brentq, which requires a bracket [p_min, p_max] where\n        # objective(p_min) and objective(p_max) have opposite signs.\n        # Heuristically, a wide bracket should work.\n        p0_opt = 0.0\n        try:\n            bracket = [-100.0, 100.0]\n            if np.sign(objective(bracket[0], a, b, alpha, x0, xf, T)) == \\\n               np.sign(objective(bracket[1], a, b, alpha, x0, xf, T)):\n                raise ValueError(\"The function values at the bracket endpoints have the same sign.\")\n            \n            res = root_scalar(\n                objective, args=(a, b, alpha, x0, xf, T),\n                bracket=bracket, method='brentq', xtol=1e-12, rtol=1e-12\n            )\n            p0_opt = res.root\n        except ValueError:\n            # Fallback if brentq bracket fails: use a secant method with an initial\n            # guess from the linear system's optimal control.\n            p0_lin_est = -2.0 * (1.0/gramian) * (xf - np.exp(a*T) * x0) * np.exp(a*T)\n            res = root_scalar(\n                objective, args=(a, b, alpha, x0, xf, T),\n                x0=p0_lin_est, x1=p0_lin_est + 0.1, method='secant', xtol=1e-12, rtol=1e-12\n            )\n            if not res.converged:\n                raise RuntimeError(f\"Shooting method failed to converge for case {case}\")\n            p0_opt = res.root\n\n        # With the optimal p0_opt, solve the IVP one last time for the full trajectory\n        y0_opt = [x0, p0_opt]\n        sol_opt = solve_ivp(\n            ode_system, [0, T], y0_opt, args=(a, b, alpha),\n            dense_output=True, rtol=1e-9, atol=1e-9\n        )\n\n        # Compute the nonlinear control energy J_nl by integrating (b/2 * p(t))^2\n        t_eval = np.linspace(0, T, 1000)\n        p_traj = sol_opt.sol(t_eval)[1]\n        integrand = (b / 2.0 * p_traj)**2\n        j_nl = simpson(integrand, t_eval)\n\n        # Task 3: Quantify the relative error\n        if np.abs(j_nl)  1e-12:\n            epsilon = np.inf if np.abs(j_lin)  1e-12 else 0.0\n        else:\n            epsilon = np.abs(j_lin - j_nl) / j_nl\n        \n        results.append([j_lin, j_nl, epsilon])\n\n    # Format the final output string as specified\n    output_str = \"[\" + \",\".join(map(str, results)) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}