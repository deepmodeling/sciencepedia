{
    "hands_on_practices": [
        {
            "introduction": "为了真正掌握同配系数，我们首先将其应用于最基本的图结构。这个练习要求你为路径图和环形图推导同配系数，这两种图是更复杂网络的基础构建模块。通过这个实践 ，你不仅将执行计算，还将学会处理正则图这种重要特殊情况，此时标准公式会变得不确定。",
            "id": "4262697",
            "problem": "考虑具有 $n$ 个节点的简单无向连通图：圈图 $C_{n}$ 和路图 $P_{n}$。令 $M$ 表示边的数量，令 $\\{(j_{e},k_{e})\\}_{e=1}^{M}$ 表示每条边 $e$ 两端有序度对的多重集。度匹配系数 $r$ 定义为边集中端点度之间的 Pearson 相关系数，也就是两个随机变量 $J$ 和 $K$ 的相关性，这两个变量以相等的边权重取值 $\\{j_{e}\\}$ 和 $\\{k_{e}\\}$。\n\n从两个实值随机变量的 Pearson 相关系数的定义（协方差除以其标准差的乘积）出发，推导出一个用 $\\{(j_{e},k_{e})\\}_{e=1}^{M}$ 的和表示的 $r$ 的精确表达式，并用它来计算 $C_{n}$ 和 $P_{n}$ 的 $r$ 值，对于路图，处理 $n\\geq 3$ 的情况。在 $C_{n}$ 的端点度方差为零的退化情况下，使用基于离散度类别的匹配混合概念的连续性论证，来确定当所有实现的边都连接等度顶点时 $r$ 的极限值。\n\n然后，通过提取 $r(C_{n})$ 和 $r(P_{n})$ 的主要渐近行为，比较当 $n\\to\\infty$ 时 $r$ 的有限尺寸标度。\n\n无需四舍五入。将最终答案表示为单个行矩阵中的两个无量纲值，第一个条目为 $r(C_{n})$，第二个条目为 $r(P_{n})$，表示为 $n$ 的闭式函数。",
            "solution": "问题要求推导圈图 $C_n$ 和路图 $P_n$ (对于 $n \\geq 3$) 的度匹配系数 $r$。推导必须从 Pearson 相关系数的定义开始。\n\n### 步骤 1：问题验证\n\n首先，我将验证问题陈述。\n\n#### 提取的已知条件\n- **图**：简单、无向、连通图：圈图 $C_{n}$ 和路图 $P_{n}$。\n- **节点**：节点数为 $n$。\n- **边**：边数为 $M$。\n- **度对**：每条边两端的有序度对的多重集为 $\\{(j_{e},k_{e})\\}_{e=1}^{M}$。\n- **匹配性定义**：度匹配系数 $r$ 是端点度的 Pearson 相关系数，由随机变量 $J$ 和 $K$ 表示，这两个变量从边的均匀随机样本中取值 $\\{j_e\\}$ 和 $\\{k_e\\}$。\n- **约束**：对于路图，$n \\geq 3$。\n- **特殊说明**：\n    1. 从 Pearson 相关系数的定义推导出 $r$ 的精确表达式。\n    2. 对于 $C_n$，使用基于匹配混合的连续性论证来处理零方差的退化情况，并指定一个极限值。\n    3. 当 $n \\to \\infty$ 时，比较 $r(C_n)$ 和 $r(P_n)$ 的有限尺寸标度。\n- **最终答案格式**：包含 $r(C_n)$ 和 $r(P_n)$ 的单个行矩阵。\n\n#### 验证与结论\n该问题在科学上和数学上是合理的。这是网络科学中的一个标准问题，将一个明确定义的度量（匹配系数）应用于基本的图结构（$C_n$ 和 $P_n$）。其概念植根于图论和统计学。问题提法清晰，提供了所有必要的定义和约束。对于正则图 $C_n$ 使用极限论证的说明，表明了对 Pearson 系数公式在方差为零时可能出现不确定性的正确理解。该问题是客观、正式的，需要实质性的推导和分析。它没有违反任何无效标准。\n因此，该问题是**有效的**。\n\n### 步骤 2：求解推导\n\n#### 匹配系数 $r$ 的通用公式\n两个随机变量 $J$ 和 $K$ 的 Pearson 相关系数 $r$ 定义为：\n$$ r = \\frac{\\text{Cov}(J, K)}{\\sigma_{J}\\sigma_{K}} $$\n其中 $\\text{Cov}(J, K) = E[JK] - E[J]E[K]$ 是协方差，$\\sigma_{J} = \\sqrt{E[J^2] - (E[J])^2}$ 和 $\\sigma_{K} = \\sqrt{E[K^2] - (E[K])^2}$ 是标准差。\n\n随机变量 $J$ 和 $K$ 表示随机选择的边的两端顶点的度。由于图是无向的，哪个端点是“第一”（对于 $J$）和哪个是“第二”（对于 $K$）的选择是任意的。我们可以将样本空间定义为 $M$ 条边的集合，每条边被选择的概率为 $1/M$。对于一条边 $e$，$J$ 和 $K$ 的取值为 $j_e$ 和 $k_e$。\n\n期望值通过对所有边求和来计算：\n$$ E[J] = \\frac{1}{M} \\sum_{e=1}^{M} j_e $$\n$$ E[K] = \\frac{1}{M} \\sum_{e=1}^{M} k_e $$\n$$ E[JK] = \\frac{1}{M} \\sum_{e=1}^{M} j_e k_e $$\n$$ E[J^2] = \\frac{1}{M} \\sum_{e=1}^{M} j_e^2 $$\n$$ E[K^2] = \\frac{1}{M} \\sum_{e=1}^{M} k_e^2 $$\n对于无向图，边一端的度多重集 $\\{j_e\\}_{e=1}^M$ 与另一端的度多重集 $\\{k_e\\}_{e=1}^M$ 相同。这意味着 $E[J] = E[K]$ 和 $E[J^2] = E[K^2]$，这又意味着 $\\sigma_J = \\sigma_K$。\n\n将这些代入 $r$ 的公式：\n$$ r = \\frac{E[JK] - E[J]E[K]}{\\sqrt{E[J^2] - (E[J])^2} \\sqrt{E[K^2] - (E[K])^2}} = \\frac{E[JK] - (E[J])^2}{E[J^2] - (E[J])^2} $$\n现在，代入求和式：\n$$ r = \\frac{\\frac{1}{M} \\sum_{e=1}^{M} j_e k_e - \\left(\\frac{1}{M} \\sum_{e=1}^{M} j_e\\right)^2}{\\frac{1}{M} \\sum_{e=1}^{M} j_e^2 - \\left(\\frac{1}{M} \\sum_{e=1}^{M} j_e\\right)^2} $$\n将分子和分母乘以 $M^2$ 得到匹配系数的标准公式：\n$$ r = \\frac{M \\sum_{e=1}^{M} j_e k_e - \\left(\\sum_{e=1}^{M} j_e\\right)^2}{M \\sum_{e=1}^{M} j_e^2 - \\left(\\sum_{e=1}^{M} j_e\\right)^2} $$\n\n#### 圈图 $C_n$ 的匹配性\n对于 $n \\geq 3$ 的圈图 $C_n$，每个节点的度都为 $2$。该图是 $2$-正则图。\n- 节点数：$n$。\n- 边数：$M = n$。\n- 对于每条边 $e$，其端点的度为 $(j_e, k_e) = (2, 2)$。\n\n我们计算公式所需的和：\n- $\\sum_{e=1}^{n} j_e k_e = \\sum_{e=1}^{n} (2 \\times 2) = \\sum_{e=1}^{n} 4 = 4n$。\n- $\\sum_{e=1}^{n} j_e = \\sum_{e=1}^{n} 2 = 2n$。\n- $\\sum_{e=1}^{n} j_e^2 = \\sum_{e=1}^{n} 2^2 = \\sum_{e=1}^{n} 4 = 4n$。\n\n将这些值代入 $r$ 的公式：\n$$ r(C_n) = \\frac{n(4n) - (2n)^2}{n(4n) - (2n)^2} = \\frac{4n^2 - 4n^2}{4n^2 - 4n^2} = \\frac{0}{0} $$\n这个表达式是不确定的。分母对应于端点度分布的方差，由于所有端点度都相同，因此分母为零。\n\n根据问题陈述，我们必须使用连续性论证。匹配系数衡量节点连接到其他相似度节点的偏好。在正则图中，每条边都连接两个度完全相同的节点。这代表了完美匹配的状态。如果一个网络有多个度类别，并且边只连接相同度的节点（例如，度为 $k_1$ 的节点连接到度为 $k_1$ 的节点，度为 $k_2$ 的节点连接到度为 $k_2$ 的节点，等等），那么对于所有边 $e$，都有 $j_e = k_e$。在这种情况下，$r$ 公式中的分子和分母变得相同，从而得到 $r=1$（前提是方差不为零）。正则图是这种情况的极端极限，其中只有一个度类别。因此，通过连续性或作为极限情况，匹配性是最大的。我们赋值 $r=1$。\n\n因此，$r(C_n) = 1$。\n\n#### 路图 $P_n$ 的匹配性\n对于 $n \\geq 3$ 的路图 $P_n$：\n- 节点数：$n$。\n- 边数：$M = n-1$。\n- 节点度：\n    - 两个端点节点的度为 $1$。\n    - $n-2$ 个内部节点的度为 $2$。\n\n设节点标记为 $v_1, v_2, \\dots, v_n$，其度分别为 $d(v_1)=1$，$d(v_n)=1$，以及对于 $i \\in \\{2, \\dots, n-1\\}$ 有 $d(v_i)=2$。边为 $e_i = (v_i, v_{i+1})$，其中 $i \\in \\{1, \\dots, n-1\\}$。边 $e_i$ 的度对为 $(d(v_i), d(v_{i+1}))$。\n\n对 $M=n-1$ 条边计算求和：\n- $\\sum_{e=1}^{M} j_e = \\sum_{i=1}^{n-1} d(v_i) = d(v_1) + \\sum_{i=2}^{n-1} d(v_i) = 1 + (n-2) \\times 2 = 2n - 3$。\n- $\\sum_{e=1}^{M} j_e^2 = \\sum_{i=1}^{n-1} d(v_i)^2 = d(v_1)^2 + \\sum_{i=2}^{n-1} d(v_i)^2 = 1^2 + (n-2) \\times 2^2 = 1 + 4(n-2) = 4n - 7$。\n- $\\sum_{e=1}^{M} j_e k_e = \\sum_{i=1}^{n-1} d(v_i)d(v_{i+1}) = d(v_1)d(v_2) + \\sum_{i=2}^{n-2} d(v_i)d(v_{i+1}) + d(v_{n-1})d(v_n)$。这种分解对 $n \\geq 4$ 有效。\n对于 $n=3$，和为 $d(v_1)d(v_2) + d(v_2)d(v_3) = 1 \\times 2 + 2 \\times 1 = 4$。\n对于 $n \\geq 4$，和为 $(1 \\times 2) + \\sum_{i=2}^{n-2} (2 \\times 2) + (2 \\times 1) = 2 + 4(n-3) + 2 = 4n - 8$。\n公式 $4n-8$ 在 $n=3$ 时给出 $4(3)-8=4$，因此它对所有 $n \\geq 3$ 都成立。\n\n现在我们将这些和与 $M=n-1$ 一起代入 $r$ 的公式：\n$$ r(P_n) = \\frac{M \\sum j_e k_e - (\\sum j_e)^2}{M \\sum j_e^2 - (\\sum j_e)^2} = \\frac{(n-1)(4n-8) - (2n-3)^2}{(n-1)(4n-7) - (2n-3)^2} $$\n分子：\n$$ (n-1)(4n-8) - (2n-3)^2 = 4(n-1)(n-2) - (4n^2 - 12n + 9) $$\n$$ = 4(n^2 - 3n + 2) - 4n^2 + 12n - 9 = 4n^2 - 12n + 8 - 4n^2 + 12n - 9 = -1 $$\n分母：\n$$ (n-1)(4n-7) - (2n-3)^2 = (4n^2 - 11n + 7) - (4n^2 - 12n + 9) $$\n$$ = 4n^2 - 11n + 7 - 4n^2 + 12n - 9 = n - 2 $$\n所以，路图的匹配系数为：\n$$ r(P_n) = \\frac{-1}{n-2} $$\n\n#### 渐近行为\n- 对于 $C_n$，$r(C_n) = 1$，是常数。当 $n \\to \\infty$ 时，$r(C_n) \\to 1$。\n- 对于 $P_n$，$r(P_n) = -\\frac{1}{n-2}$。当 $n \\to \\infty$ 时，$r(P_n) \\to 0$。其主要渐近行为是 $r(P_n) \\sim -n^{-1}$。\n\n在大的 $n$ 极限下，圈图保持完美的匹配性。路图渐近地变为中性 ($r \\to 0$)，因为两个度为 $1$ 的节点的边界效应与大量度为 $2$ 的节点相比变得可以忽略不计，使其在结构上类似于圈图。负号表示对于任何有限的 $n$ 都存在轻微的异配倾向，这是由低度端点连接到高度内部节点所驱动的。\n\n### 最终答案总结\n- 对于圈图 $C_n$，$r(C_n) = 1$。\n- 对于路图 $P_n$ ($n \\geq 3$)，$r(P_n) = -\\frac{1}{n-2}$。",
            "answer": "$$ \\boxed{\\begin{pmatrix} 1 & -\\frac{1}{n-2} \\end{pmatrix}} $$"
        },
        {
            "introduction": "在掌握了基本情况后，我们现在转向一个极端的例子，以加深我们对异配性的直观理解。星形图以其中心枢纽和外围叶子节点的结构，是异配网络的典型模型。这个练习  将引导你计算其同配性，验证其完美的异配特性 ($r=-1$)，并探讨该系数在不同度定义下的行为。",
            "id": "4262726",
            "problem": "考虑一个无向简单星形图 $K_{1,n-1}$（其中 $n \\ge 3$），该图由1个度为 $n-1$ 的中心节点和 $n-1$ 个分别与中心节点相连的叶节点组成，每个叶节点的度为1。度的同配系数定义为一条均匀随机选择的有向边两端节点的度之间的皮尔逊相关系数。从皮尔逊相关的这个定义出发（不使用其他专门公式），完成以下任务：\n\n(a) 使用边两端的全度，推导 $K_{1,n-1}$ 的同配系数 $r_{\\mathrm{full}}$，将其表示为 $n$ 的函数。\n\n(b) 使用剩余度（定义为每个端点的全度减1），推导 $K_{1,n-1}$ 的同配系数 $r_{\\mathrm{rem}}$，将其表示为 $n$ 的函数。\n\n(c) 结合 $K_{1,n-1}$ 的结构特性以及皮尔逊相关系数在对两个变量施加相同仿射变换下的不变性，对每个结果的符号和大小提供一个简洁的数学解释。明确论证这两种定义得到的值是不同还是相同，并解释原因。\n\n答案规格：将你的最终结果以单个行向量 $(r_{\\mathrm{full}},\\, r_{\\mathrm{rem}})$ 的形式给出，使用精确值（不进行四舍五入）。无需单位。",
            "solution": "该问题要求在两种不同的度定义下，推导星形图 $K_{1,n-1}$ 的同配系数，并对结果进行解释。问题陈述经核实是科学上合理的、定义明确且客观的。它包含了所有必要信息，没有矛盾或歧义。\n\n一个星形图 $K_{1,n-1}$（其中 $n \\ge 3$）包含 $n$ 个顶点和 $M=n-1$ 条边。有一个度为 $k_c = n-1$ 的中心“枢纽”顶点和 $n-1$ 个度为 $k_l = 1$ 的外围“叶”顶点。每条边都连接中心节点和一个叶节点。\n\n同配系数 $r$ 定义为一条均匀选择的有向边两端节点的度之间的皮尔逊相关系数。对于一组配对数据 $(x_i, y_i)$，皮尔逊相关系数由以下公式给出：\n$$\nr = \\frac{\\sum (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum (x_i - \\bar{x})^2}\\sqrt{\\sum (y_i - \\bar{y})^2}} = \\frac{E[XY] - E[X]E[Y]}{\\sqrt{E[X^2] - (E[X])^2} \\sqrt{E[Y^2] - (E[Y])^2}}\n$$\n其中 $X$ 和 $Y$ 是随机有向边的源节点和目标节点的度的随机变量。对于无向图，有向边集合由每条无向边对应的两条方向相反的有向边组成，总共有 $2M$ 条有向边。根据对称性，$X$ 的分布与 $Y$ 的分布相同，因此 $E[X] = E[Y]$ 且 $\\sigma_X = \\sigma_Y$。公式简化为：\n$$\nr = \\frac{E[XY] - (E[X])^2}{E[X^2] - (E[X])^2}\n$$\n用于计算期望的总体由对应于所有有向边的 $2M = 2(n-1)$ 个度对组成。由于每条边都连接中心节点（度为 $n-1$）和一个叶节点（度为 $1$），因此有 $n-1$ 条从中心节点指向叶节点的有向边，贡献了 $n-1$ 对形式为 $(n-1, 1)$ 的度对；同时有 $n-1$ 条从叶节点指向中心节点的有向边，贡献了 $n-1$ 对形式为 $(1, n-1)$ 的度对。\n\n(a) 使用全度推导 $r_{\\mathrm{full}}$。\n\n令 $X$ 和 $Y$ 为随机选择的有向边两端的全度。$X$ 的取值集合为 $\\{ \\underbrace{n-1, \\dots, n-1}_{n-1 \\text{ 次}}, \\underbrace{1, \\dots, 1}_{n-1 \\text{ 次}} \\}$。配对值 $(X,Y)$ 的集合为 $\\{ \\underbrace{(n-1, 1), \\dots, (n-1, 1)}_{n-1 \\text{ 次}}, \\underbrace{(1, n-1), \\dots, (1, n-1)}_{n-1 \\text{ 次}} \\}$。\n\n我们基于这个包含 $2(n-1)$ 个个体的总体来计算所需的期望值。\n$X$的期望 $E[X]$ 为：\n$$\nE[X] = \\frac{1}{2(n-1)} \\left( \\sum_{i=1}^{n-1} (n-1) + \\sum_{i=1}^{n-1} 1 \\right) = \\frac{1}{2(n-1)} \\left( (n-1)(n-1) + (n-1)(1) \\right) = \\frac{(n-1)n}{2(n-1)} = \\frac{n}{2}\n$$\n$X^2$的期望 $E[X^2]$ 为：\n$$\nE[X^2] = \\frac{1}{2(n-1)} \\left( \\sum_{i=1}^{n-1} (n-1)^2 + \\sum_{i=1}^{n-1} 1^2 \\right) = \\frac{1}{2(n-1)} \\left( (n-1)(n-1)^2 + (n-1)(1) \\right) = \\frac{(n-1)((n-1)^2+1)}{2(n-1)} = \\frac{n^2 - 2n + 1 + 1}{2} = \\frac{n^2 - 2n + 2}{2}\n$$\n$XY$ 乘积的期望 $E[XY]$ 为：\n$$\nE[XY] = \\frac{1}{2(n-1)} \\left( \\sum_{i=1}^{n-1} (n-1) \\times 1 + \\sum_{i=1}^{n-1} 1 \\times (n-1) \\right) = \\frac{1}{2(n-1)} \\left( (n-1)(n-1) + (n-1)(n-1) \\right) = \\frac{2(n-1)^2}{2(n-1)} = n-1\n$$\n\n现在，我们计算协方差项和方差项。\n协方差项（分子）：\n$$\nE[XY] - (E[X])^2 = (n-1) - \\left(\\frac{n}{2}\\right)^2 = n-1 - \\frac{n^2}{4} = \\frac{4n-4-n^2}{4} = -\\frac{n^2-4n+4}{4} = -\\frac{(n-2)^2}{4}\n$$\n方差项（分母）：\n$$\nE[X^2] - (E[X])^2 = \\frac{n^2-2n+2}{2} - \\left(\\frac{n}{2}\\right)^2 = \\frac{2(n^2-2n+2)}{4} - \\frac{n^2}{4} = \\frac{2n^2-4n+4-n^2}{4} = \\frac{n^2-4n+4}{4} = \\frac{(n-2)^2}{4}\n$$\n同配系数 $r_{\\mathrm{full}}$ 是这两个量的比值：\n$$\nr_{\\mathrm{full}} = \\frac{-\\frac{(n-2)^2}{4}}{\\frac{(n-2)^2}{4}} = -1\n$$\n该结果对于 $n \\ge 3$ 成立，因为当 $n \\ge 3$ 时，$n-2 \\neq 0$。\n\n(b) 使用剩余度推导 $r_{\\mathrm{rem}}$。\n\n剩余度定义为 $k' = k - 1$。\n对于中心节点，剩余度为 $k'_c = k_c - 1 = (n-1)-1 = n-2$。\n对于叶节点，剩余度为 $k'_l = k_l - 1 = 1-1 = 0$。\n每条边都连接中心节点和叶节点，因此任意一条边两端的剩余度对都是 $(n-2, 0)$。\n\n令 $X'$ 和 $Y'$ 为剩余度。度对 $(X', Y')$ 的总体为 $\\{ \\underbrace{(n-2, 0), \\dots, (n-2, 0)}_{n-1 \\text{ 次}}, \\underbrace{(0, n-2), \\dots, (0, n-2)}_{n-1 \\text{ 次}} \\}$。\n\n我们计算这些新变量的期望值。\n$$\nE[X'] = \\frac{1}{2(n-1)} \\left( \\sum_{i=1}^{n-1} (n-2) + \\sum_{i=1}^{n-1} 0 \\right) = \\frac{(n-1)(n-2)}{2(n-1)} = \\frac{n-2}{2}\n$$\n$$\nE[X'^2] = \\frac{1}{2(n-1)} \\left( \\sum_{i=1}^{n-1} (n-2)^2 + \\sum_{i=1}^{n-1} 0^2 \\right) = \\frac{(n-1)(n-2)^2}{2(n-1)} = \\frac{(n-2)^2}{2}\n$$\n$$\nE[X'Y'] = \\frac{1}{2(n-1)} \\left( \\sum_{i=1}^{n-1} (n-2)(0) + \\sum_{i=1}^{n-1} (0)(n-2) \\right) = \\frac{0}{2(n-1)} = 0\n$$\n现在，我们计算相关系数 $r_{\\mathrm{rem}}$ 的各项。\n协方差项（分子）：\n$$\nE[X'Y'] - (E[X'])^2 = 0 - \\left(\\frac{n-2}{2}\\right)^2 = -\\frac{(n-2)^2}{4}\n$$\n方差项（分母）：\n$$\nE[X'^2] - (E[X'])^2 = \\frac{(n-2)^2}{2} - \\left(\\frac{n-2}{2}\\right)^2 = \\frac{2(n-2)^2}{4} - \\frac{(n-2)^2}{4} = \\frac{(n-2)^2}{4}\n$$\n同配系数 $r_{\\mathrm{rem}}$ 为：\n$$\nr_{\\mathrm{rem}} = \\frac{-\\frac{(n-2)^2}{4}}{\\frac{(n-2)^2}{4}} = -1\n$$\n这个结果也对 $n \\ge 3$ 成立。\n\n(c) 对结果的解释。\n\n$r_{\\mathrm{full}}$ 和 $r_{\\mathrm{rem}}$ 的值均为 $-1$，表示完全异配性。这直接源于星形图的结构。在 $K_{1,n-1}$ 中，只存在一种类型的连接：高度节点（单个中心节点）与低度节点（某个叶节点）之间的连接。度相似的节点之间（中心-中心或叶-叶）不存在连接。这种极端结构，即每条边都确定性地将高度与低度配对，导致了可能的最强负相关，即 $r=-1$。\n\n两种定义产生相同的值 $r_{\\mathrm{full}} = r_{\\mathrm{rem}} = -1$，这是由于皮尔逊相关系数的一个基本性质。该系数对于同时施加于两个变量的相同仿射变换具有不变性。设 $(X, Y)$ 为原始变量（全度），$(X', Y')$ 为变换后的变量（剩余度）。该变换为 $X' = 1 \\cdot X - 1$ 和 $Y' = 1 \\cdot Y - 1$。\n一般来说，对于 $X' = aX+b$ 和 $Y' = aY+b$（其中 $a \\ne 0$）：\n$$\n\\mathrm{Cov}(X', Y') = \\mathrm{Cov}(aX+b, aY+b) = a^2 \\mathrm{Cov}(X, Y)\n$$\n$$\n\\sigma_{X'} = \\sqrt{\\mathrm{Var}(aX+b)} = \\sqrt{a^2 \\mathrm{Var}(X)} = |a|\\sigma_X\n$$\n$$\n\\sigma_{Y'} = |a|\\sigma_Y\n$$\n新的相关系数为：\n$$\nr(X', Y') = \\frac{\\mathrm{Cov}(X', Y')}{\\sigma_{X'}\\sigma_{Y'}} = \\frac{a^2 \\mathrm{Cov}(X, Y)}{(|a|\\sigma_X)(|a|\\sigma_Y)} = \\frac{a^2 \\mathrm{Cov}(X, Y)}{a^2 \\sigma_X \\sigma_Y} = r(X, Y)\n$$\n在本问题中，从全度 $k$ 到剩余度 $k'$ 的变换是 $k' = k - 1$，这是一个 $a=1$ 和 $b=-1$ 的仿射变换。由于这个变换被应用于边两端的度，皮尔逊相关系数必然是不变的。(a) 和 (b) 部分的直接计算是对这一理论性质的具体验证。度的数值的平移不会改变星形图拓扑结构所固有的潜在完全负相关性。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-1 & -1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论公式是基础，但它们在大型动态网络中的实际应用要求计算效率。这最后一个实践通过挑战你为同配系数开发一个在线更新算法，从而将理论与实践联系起来。通过为边的添加和删除推导并编码更新规则 ，你将在网络动态分析方面获得实践经验，这是现代网络科学中的一项关键技能。",
            "id": "4262715",
            "problem": "给定一个有限、无向、无自环、无重边的简单图。设 $V$ 为节点集，$E$ 为边集，且 $|V| = n$，$|E| = M$。对于一条边 $e = \\{u,v\\} \\in E$，定义 $j_e = d_u$ 和 $k_e = d_v$，其中 $d_x$ 是节点 $x$ 的度。图的度相关性系数 $\\hat r$ 定义为从 $E$ 中均匀随机选择一条边，并读取其两端点的度所得到的随机变量 $J$ 和 $K$ 之间的样本 Pearson 相关系数。使用样本 Pearson 相关系数的此定义，并从关于样本均值、方差和协方差的第一性原理出发，推导一个实现，该实现支持在边的插入和删除操作下，计算 $\\hat r$ 所需的充分统计量的在线更新。在线更新的运行时间必须仅依赖于被修改边的端点的度及其邻居集合，并且必须避免对所有边进行重新计算。\n\n你的任务分为两部分：\n1. 从上述基本定义出发，推导在单条边 $\\{u,v\\}$ 插入后和单条边 $\\{u,v\\}$ 删除后计算 $\\hat r$ 所需的充分统计量的显式在线更新表达式。表达式应使用变化前 $u$ 和 $v$ 的度及邻居集合来表示。你的推导应从样本 Pearson 相关系数的定义和求和的线性性质开始，不应调用任何关于相关性的预封装公式。明确描述每个充分统计量如何变化，并证明这些变化仅依赖于 $u$ 和 $v$ 周围的局部量。\n\n2. 实现一个完整的、可运行的程序，该程序：\n   - 维护图和计算 $\\hat r$ 所需的充分统计量。\n   - 使用你推导的表达式支持边的插入和删除的在线更新。\n   - 每次更新后仅使用维护的统计量计算 $\\hat r$。\n   - 每次更新后通过从头开始批量重新计算来计算 $\\hat r$。\n   - 验证在线更新结果与批量重新计算结果在 $10^{-12}$ 的数值公差范围内相等，并为每个测试用例返回一个布尔值，指示该用例中的所有更新是否满足相等性检查。\n\n如果在任何时候边的数量 $M = 0$，或者 Pearson 相关性分母中所需的样本方差等于 $0$（例如，在所有度都相等的正则图中），则按惯例将 $\\hat r$ 定义为实数 $0.0$。\n\n使用以下测试套件。每个测试用例由 $(n, E_0, \\mathcal{O})$ 指定，其中 $n$ 是标记为 $0,1,\\dots,n-1$ 的节点数，$E_0$ 是初始边集，$\\mathcal{O}$ 是一个有序的操作列表，每个操作的形式为 $\\text{insert}(u,v)$ 或 $\\text{delete}(u,v)$:\n- 测试用例 1 (一般情况):\n  - $n = 5$\n  - $E_0 = \\{(0,1),(1,2),(2,3),(3,4)\\}$\n  - $\\mathcal{O} = [\\text{insert}(0,4), \\text{delete}(1,2), \\text{insert}(1,4)]$\n- 测试用例 2 (包含空图转换的边界情况):\n  - $n = 3$\n  - $E_0 = \\emptyset$\n  - $\\mathcal{O} = [\\text{insert}(0,1), \\text{insert}(1,2), \\text{delete}(0,1), \\text{delete}(1,2)]$\n- 测试用例 3 (正则图到非正则图的转换):\n  - $n = 6$\n  - $E_0 = \\{(0,1),(1,2),(2,3),(3,4),(4,5),(5,0)\\}$\n  - $\\mathcal{O} = [\\text{insert}(0,3), \\text{delete}(2,3)]$\n- 测试用例 4 (通过星形图和局部重连实现高度异质性):\n  - $n = 7$\n  - $E_0 = \\{(0,1),(0,2),(0,3),(0,4),(0,5),(0,6)\\}$\n  - $\\mathcal{O} = [\\text{delete}(0,6), \\text{insert}(1,2), \\text{insert}(2,3), \\text{delete}(0,1)]$\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3,result4]\"）。每个结果必须是一个布尔值，指示对于该测试用例，每次操作的在线更新和批量重新计算是否在指定的公差范围内一致。不涉及物理单位或角度单位。所有数值输出必须是指定的小数或布尔值。",
            "solution": "该问题要求推导度相关性系数 $\\hat{r}$ 的充分统计量的在线更新规则，并实现一个程序来验证这些规则。我将首先从第一性原理出发进行推导。\n\n度相关性系数 $\\hat{r}$ 被定义为图中边集合上，相邻节点度的样本 Pearson 相关系数。设图为 $G=(V, E)$，有 $n=|V|$ 个节点和 $M=|E|$ 条边。对于一条边 $\\{u,v\\} \\in E$，其端点的度为 $d_u$ 和 $d_v$。\n\n为了为相关系数构建一个定义明确的样本，我们将每条无向边 $\\{u,v\\}$ 视为两条有向边 $(u,v)$ 和 $(v,u)$。这样就创建了一个包含 $N=2M$ 个度对的样本。设 $J$ 和 $K$ 是表示随机选择的有向边的源节点和目标节点度的随机变量。样本由 $i=1, \\dots, 2M$ 的度对 $(J_i, K_i)$ 组成。对于 $E$ 中的一条边 $\\{u,v\\}$，我们向样本中添加两个度对：$(d_u, d_v)$ 和 $(d_v, d_u)$。\n\n样本 Pearson 相关系数 $\\hat{r}$ 由以下公式给出：\n$$\n\\hat{r} = \\frac{ \\sum_{i=1}^{N} (J_i - \\bar{J})(K_i - \\bar{K}) }{ \\sqrt{ \\sum_{i=1}^{N} (J_i - \\bar{J})^2 \\sum_{i=1}^{N} (K_i - \\bar{K})^2 } }\n$$\n一个计算上更方便的形式是：\n$$\n\\hat{r} = \\frac{N \\sum J_i K_i - (\\sum J_i)(\\sum K_i)}{\\sqrt{[N \\sum J_i^2 - (\\sum J_i)^2][N \\sum K_i^2 - (\\sum K_i)^2]}}\n$$\n由于我们样本的对称构造，$\\sum J_i = \\sum K_i$ 且 $\\sum J_i^2 = \\sum K_i^2$，因此分母得以简化。我们根据图结构上的求和定义四个充分统计量：\n1. 有向边的数量，$N = 2M$。\n2. 每条有向边起始点度之和：$\\sum J_i = \\sum_{\\{u,v\\}\\in E} (d_u + d_v) = \\sum_{w \\in V} d_w^2$。我们将此和表示为 $S_2$。\n3. 每条有向边起始点度平方之和：$\\sum J_i^2 = \\sum_{\\{u,v\\}\\in E} (d_u^2 + d_v^2) = \\sum_{w \\in V} d_w \\cdot d_w^2 = \\sum_{w \\in V} d_w^3$。我们将其表示为 $S_3$。\n4. 每条有向边度之积的和：$\\sum J_i K_i = \\sum_{\\{u,v\\}\\in E} (d_u d_v + d_v d_u) = 2 \\sum_{\\{u,v\\}\\in E} d_u d_v$。我们记 $S_{jk} = \\sum_{\\{u,v\\}\\in E} d_u d_v$。\n\n将这些代入 $\\hat{r}$ 的公式中：\n$$\n\\hat{r} = \\frac{(2M)(2 S_{jk}) - (S_2)(S_2)}{\\sqrt{[(2M)S_3 - S_2^2][(2M)S_3 - S_2^2]}} = \\frac{4M S_{jk} - S_2^2}{2M S_3 - S_2^2}\n$$\n如果 $M=0$ 或分母 $2M S_3 - S_2^2 = 0$（这在正则图中发生），则 $\\hat{r}$ 定义为 $0.0$。\n为了执行在线更新，我们必须推导在加边或删边时 $M$、$S_2$、$S_3$ 和 $S_{jk}$ 如何变化。设更新前的量为不带撇号的（例如 $d_w$），更新后的量为带撇号的（例如 $d'_w$）。更新公式中的所有度都是更新前的度。\n\n**插入边 $\\{u,v\\}$**\n一条边 $\\{u,v\\}$ 被添加到 $E$ 中。我们假设 $\\{u,v\\} \\notin E$。\n-   $M' = M+1$。\n-   节点 $u$ 和 $v$ 的度各增加一：$d'_u = d_u+1, d'_v = d_v+1$。对于任何其他节点 $w \\neq u,v$，$d'_w = d_w$。\n-   **$S_2 = \\sum_{w \\in V} d_w^2$ 的更新**：\n    $S'_2 = \\sum_{w \\in V} (d'_w)^2 = \\left(\\sum_{w \\neq u,v} d_w^2\\right) + (d'_u)^2 + (d'_v)^2 = (S_2 - d_u^2 - d_v^2) + (d_u+1)^2 + (d_v+1)^2 = S_2 + 2(d_u+d_v) + 2$。\n    变化量为 $\\Delta S_2 = 2(d_u+d_v+1)$。\n-   **$S_3 = \\sum_{w \\in V} d_w^3$ 的更新**：\n    $S'_3 = \\sum_{w \\in V} (d'_w)^3 = (S_3 - d_u^3 - d_v^3) + (d_u+1)^3 + (d_v+1)^3 = S_3 + 3(d_u^2+d_v^2) + 3(d_u+d_v) + 2$。\n    变化量为 $\\Delta S_3 = 3(d_u^2+d_v^2) + 3(d_u+d_v) + 2$。\n-   **$S_{jk} = \\sum_{\\{a,b\\}\\in E} d_a d_b$ 的更新**：\n    $S'_{jk} = \\sum_{\\{a,b\\} \\in E \\cup \\{\\{u,v\\}\\}} d'_a d'_b = \\sum_{\\{a,b\\} \\in E} d'_a d'_b + d'_u d'_v$。\n    对现有边集 $E$ 的求和变化源于 $u$ 和 $v$ 的度变化。对于一条边 $\\{a,b\\} \\in E$，只有当其端点之一是 $u$ 或 $v$ 时，项 $d_a d_b$ 才会改变。\n    - 对于每个邻居 $w \\in N(u)$，边 $\\{u,w\\}$ 的项从 $d_u d_w$ 变为 $d'_u d'_w = (d_u+1)d_w$。增量为 $d_w$。\n    - 对于每个邻居 $w \\in N(v)$，边 $\\{v,w\\}$ 的项从 $d_v d_w$ 变为 $d'_v d'_w = (d_v+1)d_w$。增量为 $d_w$。\n    现有边上的总变化量为 $\\sum_{w \\in N(u)} d_w + \\sum_{w \\in N(v)} d_w$。新边 $\\{u,v\\}$ 增加了一个项 $d'_u d'_v = (d_u+1)(d_v+1)$。\n    因此，$S'_{jk} = S_{jk} + \\left( \\sum_{w \\in N(u)} d_w + \\sum_{w \\in N(v)} d_w \\right) + (d_u+1)(d_v+1)$。\n    变化量 $\\Delta S_{jk} = \\sum_{w \\in N(u)} d_w + \\sum_{w \\in N(v)} d_w + (d_u+1)(d_v+1)$。\n\n**删除边 $\\{u,v\\}$**\n一条边 $\\{u,v\\}$ 从 $E$ 中移除。\n-   $M' = M-1$。\n-   度变化：$d'_u = d_u-1, d'_v = d_v-1$。其他节点度保持不变。\n-   **$S_2$ 的更新**：\n    $S'_2 = (S_2 - d_u^2 - d_v^2) + (d_u-1)^2 + (d_v-1)^2 = S_2 - 2(d_u+d_v) + 2$。\n    变化量为 $\\Delta S_2 = -2(d_u+d_v-1)$。\n-   **$S_3$ 的更新**：\n    $S'_3 = (S_3 - d_u^3 - d_v^3) + (d_u-1)^3 + (d_v-1)^3 = S_3 - (3(d_u^2+d_v^2) - 3(d_u+d_v) + 2)$。\n    变化量为 $\\Delta S_3 = -[3(d_u^2+d_v^2) - 3(d_u+d_v) + 2]$。\n-   **$S_{jk}$ 的更新**：\n    $S'_{jk} = \\sum_{\\{a,b\\}\\in E\\setminus\\{\\{u,v\\}\\}} d'_a d'_b$。我们计算变化量 $S'_{jk} - S_{jk}$。\n    $S_{jk} = \\sum_{\\{a,b\\}\\in E\\setminus\\{\\{u,v\\}\\}} d_a d_b + d_u d_v$。\n    $S'_{jk} - S_{jk} = \\left(\\sum_{\\{a,b\\}\\in E\\setminus\\{\\{u,v\\}\\}} d'_a d'_b\\right) - \\left(\\sum_{\\{a,b\\}\\in E\\setminus\\{\\{u,v\\}\\}} d_a d_b + d_u d_v\\right) = \\sum_{\\{a,b\\}\\in E\\setminus\\{\\{u,v\\}\\}} (d'_a d'_b - d_a d_b) - d_u d_v$。\n    - 对于一条边 $\\{u,w\\}$ 且 $w \\in N(u)\\setminus\\{v\\}$，其项的变化为 $(d_u-1)d_w - d_u d_w = -d_w$。\n    - 对于一条边 $\\{v,w\\}$ 且 $w \\in N(v)\\setminus\\{u\\}$，相应的变化为 $-d_w$。\n    $S_{jk}$ 的总变化量为 $\\Delta S_{jk} = - \\left(d_u d_v + \\sum_{w \\in N(u)\\setminus\\{v\\}} d_w + \\sum_{w \\in N(v)\\setminus\\{u\\}} d_w \\right)$。\n\n所有推导出的更新规则仅依赖于修改前边端点 $u, v$ 的度及其邻居。这证实了复杂度为 $O(d_u+d_v)$ 的在线更新是可行的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of verifying online updates for the degree assortativity coefficient.\n    \"\"\"\n\n    class DynamicAssortativity:\n        \"\"\"\n        Maintains graph sufficient statistics for online assortativity calculation.\n        \"\"\"\n        def __init__(self, n, initial_edges):\n            self.n = n\n            self.adj = [set() for _ in range(n)]\n            self.degrees = np.zeros(n, dtype=np.int64)\n            \n            num_edges = 0\n            for u, v in initial_edges:\n                self.adj[u].add(v)\n                self.adj[v].add(u)\n                self.degrees[u] += 1\n                self.degrees[v] += 1\n                num_edges += 1\n            \n            # Initialize sufficient statistics from the initial graph state\n            self.M = np.int64(num_edges)\n            self.S2 = np.sum(self.degrees**2, dtype=np.int64)\n            self.S3 = np.sum(self.degrees**3, dtype=np.int64)\n            s_jk = np.int64(0)\n            for u in range(self.n):\n                for v in self.adj[u]:\n                    if u  v:\n                        s_jk += self.degrees[u] * self.degrees[v]\n            self.S_jk = s_jk\n            \n        def get_r_online(self):\n            \"\"\"Computes assortativity from maintained statistics.\"\"\"\n            if self.M == 0:\n                return 0.0\n            \n            numerator = 4 * self.M * self.S_jk - self.S2**2\n            denominator = 2 * self.M * self.S3 - self.S2**2\n            \n            if abs(denominator)  1e-12: # Handle zero variance\n                return 0.0\n            \n            return float(numerator) / float(denominator)\n\n        def get_r_batch(self):\n            \"\"\"Computes assortativity by recomputing stats from scratch.\"\"\"\n            current_M = np.sum(self.degrees) // 2\n            if current_M == 0:\n                return 0.0\n            \n            current_S2 = np.sum(self.degrees**2)\n            current_S3 = np.sum(self.degrees**3)\n            \n            current_S_jk = 0\n            for u in range(self.n):\n                for v in self.adj[u]:\n                    if u  v:\n                        current_S_jk += self.degrees[u] * self.degrees[v]\n\n            numerator = 4 * current_M * current_S_jk - current_S2**2\n            denominator = 2 * current_M * current_S3 - current_S2**2\n\n            if abs(denominator)  1e-12:\n                return 0.0\n            \n            return float(numerator) / float(denominator)\n\n        def insert_edge(self, u, v):\n            \"\"\"Online update for edge insertion.\"\"\"\n            du, dv = self.degrees[u], self.degrees[v]\n\n            # Update S_jk\n            sum_deg_nu = np.sum(self.degrees[list(self.adj[u])])\n            sum_deg_nv = np.sum(self.degrees[list(self.adj[v])])\n            self.S_jk += sum_deg_nu + sum_deg_nv + (du + 1) * (dv + 1)\n            \n            # Update S2\n            self.S2 += 2 * (du + dv + 1)\n            \n            # Update S3\n            self.S3 += 3 * (du**2 + dv**2) + 3 * (du + dv) + 2\n            \n            # Update M\n            self.M += 1\n\n            # Update graph state\n            self.adj[u].add(v)\n            self.adj[v].add(u)\n            self.degrees[u] += 1\n            self.degrees[v] += 1\n\n        def delete_edge(self, u, v):\n            \"\"\"Online update for edge deletion.\"\"\"\n            du, dv = self.degrees[u], self.degrees[v]\n\n            # Update S_jk\n            sum_deg_nu_minus_v = np.sum(self.degrees[list(self.adj[u] - {v})])\n            sum_deg_nv_minus_u = np.sum(self.degrees[list(self.adj[v] - {u})])\n            self.S_jk -= du * dv + sum_deg_nu_minus_v + sum_deg_nv_minus_u\n\n            # Update S2\n            self.S2 -= 2 * (du + dv - 1)\n            \n            # Update S3\n            self.S3 -= 3 * (du**2 + dv**2) - 3 * (du + dv) + 2\n            \n            # Update M\n            self.M -= 1\n\n            # Update graph state\n            self.adj[u].remove(v)\n            self.adj[v].remove(u)\n            self.degrees[u] -= 1\n            self.degrees[v] -= 1\n\n    test_cases = [\n        (5, [(0,1),(1,2),(2,3),(3,4)], [(\"insert\", (0,4)), (\"delete\", (1,2)), (\"insert\", (1,4))]),\n        (3, [], [(\"insert\", (0,1)), (\"insert\", (1,2)), (\"delete\", (0,1)), (\"delete\", (1,2))]),\n        (6, [(0,1),(1,2),(2,3),(3,4),(4,5),(5,0)], [(\"insert\", (0,3)), (\"delete\", (2,3))]),\n        (7, [(0,1),(0,2),(0,3),(0,4),(0,5),(0,6)], [(\"delete\", (0,6)), (\"insert\", (1,2)), (\"insert\", (2,3)), (\"delete\", (0,1))])\n    ]\n\n    results = []\n    for n, e0, ops in test_cases:\n        graph_manager = DynamicAssortativity(n, e0)\n        all_updates_correct = True\n        \n        for op_type, edge in ops:\n            if op_type == \"insert\":\n                graph_manager.insert_edge(edge[0], edge[1])\n            elif op_type == \"delete\":\n                graph_manager.delete_edge(edge[0], edge[1])\n\n            r_online = graph_manager.get_r_online()\n            r_batch = graph_manager.get_r_batch()\n            \n            if not np.isclose(r_online, r_batch, atol=1e-12, rtol=0):\n                all_updates_correct = False\n                break\n        \n        results.append(all_updates_correct)\n\n    print(f\"[{','.join(map(str, results)).replace('True', 'true').replace('False', 'false')}]\")\n\nsolve()\n```"
        }
    ]
}