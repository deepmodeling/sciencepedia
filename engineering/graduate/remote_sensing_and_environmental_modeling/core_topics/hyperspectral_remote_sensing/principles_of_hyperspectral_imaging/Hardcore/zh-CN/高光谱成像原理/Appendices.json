{
    "hands_on_practices": [
        {
            "introduction": "原始的传感器数据，即数字编号（DN），本身没有物理意义。为了进行定量科学研究，我们必须将其转换为具有明确物理单位的量，例如光谱辐亮度（$L_{\\lambda}$）。本练习将通过模拟实验室数据，引导你亲手实践高光谱成像中最基本也是最关键的一步：辐射定标。你将从第一性原理出发，推导并应用最小二乘法来确定定标系数，并学习如何评估传感器的线性度。",
            "id": "3835414",
            "problem": "高光谱成像系统必须进行辐射定标，以将测量的数字量（DN）计数转换为光谱辐亮度。考虑通过一个提供已知光谱辐亮度水平的积分球观测到的波长为 $\\lambda$ 的单个光谱通道。假设传感器在工作范围内的响应可以很好地用每个波长的线性模型来描述：在波长 $\\lambda$ 处测得的数字量（表示为 $D_{\\lambda}$）与光谱辐亮度 $L_{\\lambda}$ 之间的关系为 $D_{\\lambda} = a_{\\lambda} L_{\\lambda} + b_{\\lambda} + \\varepsilon$，其中 $a_{\\lambda}$ 和 $b_{\\lambda}$ 是未知的定标系数，$\\varepsilon$ 聚合了噪声源。积分球提供的辐亮度水平是已知的，单位为 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n\n从基本定义出发：\n- 光子探测的线性系统响应意味着，在足够窄的动态范围和固定的仪器状态下，$D_{\\lambda}$ 与输入辐亮度 $L_{\\lambda}$ 成正比，并加上一个偏移量。\n- 最小二乘法原理通过最小化模型预测与观测值之间残差的平方和来估计未知的线性系数。\n\n您的任务是编写一个程序，针对每个提供的测试用例，执行以下操作，而不使用本问题陈述中任何预先指定的公式：\n1. 通过使用从第一性原理推导的普通最小二乘法（即通过最小化残差平方和），将线性模型 $D_{\\lambda} = a_{\\lambda} L_{\\lambda} + b_{\\lambda}$ 拟合到所提供的数据，从而估计定标系数 $a_{\\lambda}$（单位为 $\\mathrm{DN}/\\mathrm{(W\\,m^{-2}\\,sr^{-1}\\,nm^{-1})}$）和 $b_{\\lambda}$（单位为 $\\mathrm{DN}$）。\n2. 计算拟合模型的决定系数 $R^2$，作为已解释方差的度量。\n3. 使用如下定义的非线性度指标评估线性度。设每个辐亮度水平 $L_i$ 的拟合预测值为 $\\hat{D}_i = \\hat{a}_{\\lambda} L_i + \\hat{b}_{\\lambda}$，残差为 $r_i = D_i - \\hat{D}_i$。定义满量程拟合范围 $S = \\max_i(\\hat{D}_i) - \\min_i(\\hat{D}_i)$。非线性度指标为 $\\eta = \\max_i |r_i| / S$，以小数形式表示。如果 $R^2 \\geq 0.999$ 和 $\\eta \\leq 0.005$（两个阈值均以小数表示）同时满足，则将线性度测试声明为布尔值“通过”(pass)。\n\n物理单位：输入辐亮度必须以 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$ 为单位处理，程序返回的估计斜率 $a_{\\lambda}$ 必须解释为 $\\mathrm{DN}/\\mathrm{(W\\,m^{-2}\\,sr^{-1}\\,nm^{-1})}$，而截距 $b_{\\lambda}$ 必须解释为 $\\mathrm{DN}$。决定系数 $R^2$ 和非线性度指标阈值是无单位的小数。\n\n测试套件（每个案例提供辐亮度水平和相应的测量数字量）：\n- 案例1（带有小噪声的标称线性响应）：辐亮度水平 [$0.0, 1.0, 2.0, 4.0, 6.0, 8.0, 10.0]$，单位为 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$；测量的 $D_{\\lambda}$ 值为 [$50.0, 353.0, 650.0, 1251.0, 1856.0, 2448.0, 3054.0]$。\n- 案例2（较高辐亮度下有轻微二次偏差）：辐亮度水平 [$0.0, 0.5, 1.0, 3.0, 6.0, 9.0, 12.0]$，单位为 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$；测量的 $D_{\\lambda}$ 值为 [$100.0, 240.2, 380.8, 947.2, 1808.8, 2684.8, 3575.2]$。\n- 案例3（噪声较大的低水平定标）：辐亮度水平 [$0.0, 0.2, 0.4, 0.6]$，单位为 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$；测量的 $D_{\\lambda}$ 值为 [$17.0, 122.0, 215.0, 324.0]$。\n\n数值要求：\n- 对于每个测试用例，将估计的 $a_{\\lambda}$、$b_{\\lambda}$ 和 $R^2$ 作为浮点数输出，四舍五入到6位小数。\n- 线性度“通过”(pass)必须是使用阈值 $R^2 \\geq 0.999$ 和 $\\eta \\leq 0.005$ 计算出的布尔值。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素是形如 [$a_{\\lambda}, b_{\\lambda}, R^2, \\text{pass}$] 的子列表，不含任何空格。例如，输出必须看起来像 [[$a_1, b_1, R^2_1$, True], [$a_2, b_2, R^2_2$, False], [\\dots]]，但任何地方都不能有空格。浮点数必须四舍五入到6位小数。",
            "solution": "问题陈述经评估有效。它具有科学依据，问题提出得当，客观且自成体系。它描述了实验物理学和遥感领域中一个标准且基本的过程：使用线性模型对传感器进行辐射定标。所提供的数据是一致的，足以执行所要求的计算。任务定义清晰，具有明确的数学和逻辑要求。因此，我们可以着手解决问题。\n\n这个问题的核心是确定最能拟合一组实验数据的线性模型的参数。该模型通过方程 $D_{\\lambda} = a_{\\lambda} L_{\\lambda} + b_{\\lambda}$ 将输入的光谱辐亮度 $L_{\\lambda}$ 与传感器测量的输出——数字量 $D_{\\lambda}$ 联系起来。系数 $a_{\\lambda}$（增益或斜率）和 $b_{\\lambda}$（偏移或暗电流响应）是未知的。完整模型 $D_{\\lambda} = a_{\\lambda} L_{\\lambda} + b_{\\lambda} + \\varepsilon$ 中的 $\\varepsilon$ 项代表随机噪声，假定其均值为零。\n\n为了从一组 $n$ 个测量对 $(L_i, D_i)$（其中 $i=1, \\dots, n$）中估计系数 $\\hat{a}_{\\lambda}$ 和 $\\hat{b}_{\\lambda}$，我们采用普通最小二乘法（OLS）的原理。该方法寻找一条直线，使得观测数据点与拟合直线之间的垂直距离（残差）的平方和最小。\n\n对于给定的辐亮度 $L_i$，预测的数字量为 $\\hat{D}_i = \\hat{a}_{\\lambda} L_i + \\hat{b}_{\\lambda}$。该数据点的残差是观测值与预测值之差：$r_i = D_i - \\hat{D}_i$。需要最小化的函数是残差平方和（$SSR$）：\n$$ SSR(\\hat{a}_{\\lambda}, \\hat{b}_{\\lambda}) = \\sum_{i=1}^{n} r_i^2 = \\sum_{i=1}^{n} (D_i - \\hat{D}_i)^2 = \\sum_{i=1}^{n} (D_i - (\\hat{a}_{\\lambda} L_i + \\hat{b}_{\\lambda}))^2 $$\n\n为了找到使此函数最小化的 $\\hat{a}_{\\lambda}$ 和 $\\hat{b}_{\\lambda}$ 的值，我们对 $SSR$ 关于每个参数求偏导数，并令其为零。这是取得最小值的必要条件。\n\n首先，关于 $\\hat{b}_{\\lambda}$ 的偏导数：\n$$ \\frac{\\partial SSR}{\\partial \\hat{b}_{\\lambda}} = \\sum_{i=1}^{n} \\frac{\\partial}{\\partial \\hat{b}_{\\lambda}} (D_i - \\hat{a}_{\\lambda} L_i - \\hat{b}_{\\lambda})^2 = \\sum_{i=1}^{n} 2(D_i - \\hat{a}_{\\lambda} L_i - \\hat{b}_{\\lambda})(-1) = 0 $$\n$$ -2 \\left( \\sum_{i=1}^{n} D_i - \\hat{a}_{\\lambda} \\sum_{i=1}^{n} L_i - n \\hat{b}_{\\lambda} \\right) = 0 $$\n两边除以 $n$ 并重新整理，得到 $\\hat{b}_{\\lambda}$ 的表达式：\n$$ \\frac{1}{n} \\sum_{i=1}^{n} D_i - \\hat{a}_{\\lambda} \\frac{1}{n} \\sum_{i=1}^{n} L_i - \\hat{b}_{\\lambda} = 0 $$\n$$ \\bar{D} - \\hat{a}_{\\lambda} \\bar{L} - \\hat{b}_{\\lambda} = 0 \\implies \\hat{b}_{\\lambda} = \\bar{D} - \\hat{a}_{\\lambda} \\bar{L} $$\n其中 $\\bar{L} = \\frac{1}{n}\\sum L_i$ 和 $\\bar{D} = \\frac{1}{n}\\sum D_i$ 分别是辐亮度值和数字量值的平均值。\n\n接下来，关于 $\\hat{a}_{\\lambda}$ 的偏导数：\n$$ \\frac{\\partial SSR}{\\partial \\hat{a}_{\\lambda}} = \\sum_{i=1}^{n} \\frac{\\partial}{\\partial \\hat{a}_{\\lambda}} (D_i - \\hat{a}_{\\lambda} L_i - \\hat{b}_{\\lambda})^2 = \\sum_{i=1}^{n} 2(D_i - \\hat{a}_{\\lambda} L_i - \\hat{b}_{\\lambda})(-L_i) = 0 $$\n$$ \\sum_{i=1}^{n} (D_i L_i - \\hat{a}_{\\lambda} L_i^2 - \\hat{b}_{\\lambda} L_i) = 0 $$\n代入 $\\hat{b}_{\\lambda} = \\bar{D} - \\hat{a}_{\\lambda} \\bar{L}$ 的表达式：\n$$ \\sum_{i=1}^{n} (D_i L_i - \\hat{a}_{\\lambda} L_i^2 - (\\bar{D} - \\hat{a}_{\\lambda} \\bar{L}) L_i) = 0 $$\n$$ \\sum D_i L_i - \\hat{a}_{\\lambda} \\sum L_i^2 - \\bar{D} \\sum L_i + \\hat{a}_{\\lambda} \\bar{L} \\sum L_i = 0 $$\n现在，我们求解 $\\hat{a}_{\\lambda}$：\n$$ \\hat{a}_{\\lambda} (\\sum L_i^2 - \\bar{L} \\sum L_i) = \\sum D_i L_i - \\bar{D} \\sum L_i $$\n$$ \\hat{a}_{\\lambda} = \\frac{\\sum D_i L_i - \\bar{D} \\sum L_i}{\\sum L_i^2 - \\bar{L} \\sum L_i} $$\n这个表达式可以使用协方差和方差的定义写得更紧凑。分子等价于 $\\sum_{i=1}^{n} (L_i - \\bar{L})(D_i - \\bar{D})$，分母等价于 $\\sum_{i=1}^{n} (L_i - \\bar{L})^2$。因此，最终的估计量是：\n$$ \\hat{a}_{\\lambda} = \\frac{\\sum_{i=1}^{n} (L_i - \\bar{L})(D_i - \\bar{D})}{\\sum_{i=1}^{n} (L_i - \\bar{L})^2} $$\n$$ \\hat{b}_{\\lambda} = \\bar{D} - \\hat{a}_{\\lambda} \\bar{L} $$\n\n一旦确定了系数，我们使用决定系数 $R^2$ 来评估拟合优度。它量化了因变量（$D$）的总方差中可由线性模型解释的比例。其定义为：\n$$ R^2 = 1 - \\frac{SSR}{SST} $$\n其中 $SSR = \\sum_{i=1}^{n} (D_i - \\hat{D}_i)^2$ 是残差平方和，而 $SST = \\sum_{i=1}^{n} (D_i - \\bar{D})^2$ 是总平方和，代表观测数据中的总方差。$R^2$ 值为 $1.0$ 表示完美拟合。\n\n最后，我们使用指定的指标 $\\eta$ 来评估线性度。该指标捕获了任何数据点与拟合线之间的最大偏差，并用拟合模型输出的动态范围进行归一化。其组成部分是：\n- 拟合值：对每个 $i$ 有 $\\hat{D}_i = \\hat{a}_{\\lambda} L_i + \\hat{b}_{\\lambda}$。\n- 残差：$r_i = D_i - \\hat{D}_i$。\n- 满量程拟合范围：$S = \\max_i(\\hat{D}_i) - \\min_i(\\hat{D}_i)$。\n- 非线性度指标：$\\eta = \\frac{\\max_i |r_i|}{S}$。\n\n如果 $R^2 \\ge 0.999$ 和 $\\eta \\le 0.005$ 同时满足，则通过线性度测试。\n\n该实现将对每个测试用例应用这些推导出的公式，计算所需的指标，并执行线性度测试。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs radiometric calibration analysis for hyperspectral sensor data.\n\n    For each test case, this function:\n    1. Estimates linear calibration coefficients (a_lambda, b_lambda) using\n       ordinary least squares derived from first principles.\n    2. Computes the coefficient of determination (R^2).\n    3. Calculates a nonlinearity metric (eta) and assesses linearity\n       based on given thresholds for R^2 and eta.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\n            np.array([0.0, 1.0, 2.0, 4.0, 6.0, 8.0, 10.0]),\n            np.array([50.0, 353.0, 650.0, 1251.0, 1856.0, 2448.0, 3054.0])\n        ),\n        (\n            np.array([0.0, 0.5, 1.0, 3.0, 6.0, 9.0, 12.0]),\n            np.array([100.0, 240.2, 380.8, 947.2, 1808.8, 2684.8, 3575.2])\n        ),\n        (\n            np.array([0.0, 0.2, 0.4, 0.6]),\n            np.array([17.0, 122.0, 215.0, 324.0])\n        )\n    ]\n\n    results = []\n    for L_data, D_data in test_cases:\n        # Calculate means of the input data L (radiance) and D (digital number).\n        L_bar = np.mean(L_data)\n        D_bar = np.mean(D_data)\n\n        # 1. Estimate calibration coefficients a_lambda and b_lambda from first principles.\n        #    a_lambda = sum((L_i - L_bar) * (D_i - D_bar)) / sum((L_i - L_bar)^2)\n        #    b_lambda = D_bar - a_lambda * L_bar\n        numerator = np.sum((L_data - L_bar) * (D_data - D_bar))\n        denominator = np.sum((L_data - L_bar)**2)\n        \n        # Handle potential division by zero if all L_data are the same, though not expected here.\n        if denominator == 0:\n            # If all L are same, slope is ill-defined. This case is not in the test suite.\n            # We would typically raise an error or return NaN.\n            # For this problem, we can assume valid inputs leading to a non-zero denominator.\n            a_lambda = 0.0\n        else:\n            a_lambda = numerator / denominator\n\n        b_lambda = D_bar - a_lambda * L_bar\n\n        # 2. Compute the coefficient of determination R^2.\n        #    R^2 = 1 - (SSR / SST)\n        #    SSR = sum of squared residuals = sum((D_i - D_hat_i)^2)\n        #    SST = total sum of squares = sum((D_i - D_bar)^2)\n        D_hat = a_lambda * L_data + b_lambda\n        \n        ssr = np.sum((D_data - D_hat)**2)\n        sst = np.sum((D_data - D_bar)**2)\n        \n        # Handle case where all D_data are the same (SST=0), resulting in R^2 being undefined.\n        if sst == 0:\n            # If all observed D are identical, they are perfectly predicted by their mean.\n            # If residuals are also zero, R^2 is 1, otherwise it's undefined or 0.\n            # Here assuming if SST is 0 and SSR is also 0, fit is perfect.\n             R_squared = 1.0 if ssr == 0 else 0.0\n        else:\n            R_squared = 1 - (ssr / sst)\n\n        # 3. Assess linearity using the nonlinearity metric eta.\n        #    eta = max|r_i| / S\n        #    r_i = D_i - D_hat_i\n        #    S = max(D_hat_i) - min(D_hat_i)\n        residuals = D_data - D_hat\n        \n        S = np.max(D_hat) - np.min(D_hat)\n        \n        # Handle case where S=0 (if a_lambda is 0, D_hat is constant).\n        # In this case, nonlinearity is undefined, or can be considered 0 if all residuals are 0.\n        if S == 0:\n            eta = 0.0 if np.all(residuals == 0) else float('inf')\n        else:\n            eta = np.max(np.abs(residuals)) / S\n\n        # Perform the linearity test.\n        # Pass if R^2 >= 0.999 AND eta = 0.005\n        linearity_pass = (R_squared >= 0.999) and (eta = 0.005)\n\n        # Append rounded results to the list\n        results.append([\n            round(a_lambda, 6),\n            round(b_lambda, 6),\n            round(R_squared, 6),\n            linearity_pass\n        ])\n\n    # Final print statement in the exact required format.\n    # e.g., [[a1,b1,R2_1,True],[a2,b2,R2_2,False]]\n    output_str = \",\".join([f\"[{item[0]},{item[1]},{item[2]},{str(item[3])}]\" for item in results])\n    print(f\"[{output_str}]\".replace(\" \", \"\").replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\nsolve()\n```"
        },
        {
            "introduction": "获取了经过定标的辐亮度数据后，我们常常需要对其进行后处理以提升数据质量。本练习探讨了在数据处理中一个核心的权衡关系：信噪比（SNR）与光谱分辨率之间的平衡。通过推导光谱合并（spectral binning）对数据的影响，你将定量地理解牺牲部分光谱细节如何能够显著改善信号质量，这是传感器设计和数据处理流程中的一个关键考量。",
            "id": "3835489",
            "problem": "一台具有均匀间隔光谱通道的推扫式高光谱成像光谱仪被用于观测一个在小波长区间内辐射率近似恒定的目标。每个光谱通道具有顶帽形光谱响应，其半峰全宽等于一个记为 $\\Delta \\lambda_{1}$ 的带宽，且通道之间不重叠。对于单个通道，期望探测信号（以光电子为单位）为 $S$，噪声为零均值，标准差为 $\\sigma$，其中不同通道间的噪声贡献不相关。信噪比 (SNR) 定义为 $\\mathrm{SNR} \\equiv \\text{信号均值} \\,/\\, \\text{噪声标准差}$。光谱合并是在后处理中通过对 $n$ 个相邻通道求和来形成一个输出波段。\n\n仅从 $\\mathrm{SNR}$ 的定义和独立随机变量求和的方差相加法则出发，推导以下表达式：\n- 当合并 $n$ 个相邻通道时，$\\mathrm{SNR}$ 相对于未合并的单通道 $\\mathrm{SNR}$ 的变化因子。\n- 在上述顶帽形和不重叠的假设下，并假设目标辐射率在 $n$ 个被合并的通道上是恒定的，有效光谱分辨率降低的因子，量化为合并后的有效带宽 $\\Delta \\lambda_{n}$ 与原始带宽 $\\Delta \\lambda_{1}$ 的比值。\n\n然后，计算当 $n=3$ 时这两个因子。将 $\\mathrm{SNR}$ 变化因子和光谱分辨率降低因子报告为无量纲量。不要近似；提供精确值。最终的数值对应以无单位形式报告。如果进行任何中间舍入，则仅将最终值舍入到四位有效数字；否则，以精确形式保留它们。",
            "solution": "该问题提法明确且具有科学依据。我们将根据给定的条件和原理进行推导。\n\n设 $S$ 为单个未合并光谱通道的平均信号（以光电子为单位），$\\sigma$ 为相关零均值噪声的标准差。单通道信噪比，记为 $\\mathrm{SNR}_{1}$，定义为：\n$$ \\mathrm{SNR}_{1} = \\frac{S}{\\sigma} $$\n\n问题陈述，光谱合并是通过对 $n$ 个相邻、不重叠的通道求和来执行的。我们需要推导合并后通道的新信噪比 $\\mathrm{SNR}_{n}$ 以及光谱分辨率的相应变化。\n\n**1. 信噪比变化因子的推导**\n\n设 $S_{i}$ 为第 $i$ 个通道的信号随机变量，其中 $i=1, 2, \\dots, n$。问题陈述目标辐射率在 $n$ 个被合并的通道上是恒定的。由于通道是相同的（均匀间隔，相同带宽），这意味着每个通道的期望信号是相同的。设 $\\mathbb{E}[S_{i}] = S$。合并后通道的总信号 $S_{n}$ 是 $n$ 个独立通道信号的总和：\n$$ S_{n} = \\sum_{i=1}^{n} S_{i} $$\n合并后信号的均值是各个均值的总和：\n$$ \\text{mean}(S_{n}) = \\mathbb{E}[S_{n}] = \\mathbb{E}\\left[\\sum_{i=1}^{n} S_{i}\\right] = \\sum_{i=1}^{n} \\mathbb{E}[S_{i}] = \\sum_{i=1}^{n} S = nS $$\n\n设 $N_{i}$ 为第 $i$ 个通道的噪声随机变量。问题陈述噪声是零均值，标准差为 $\\sigma$。因此，$\\mathbb{E}[N_i] = 0$，标准差为 $\\mathrm{StdDev}(N_i) = \\sigma$。单个通道噪声的方差为 $\\mathrm{Var}(N_i) = \\sigma^2$。\n\n合并后通道的总噪声 $N_{n}$ 是 $n$ 个独立通道噪声的总和：\n$$ N_{n} = \\sum_{i=1}^{n} N_{i} $$\n问题指明不同通道间的噪声贡献不相关。根据不相关随机变量的方差相加法则，这些变量之和的方差等于它们方差的和。因此，合并后噪声的方差 $\\mathrm{Var}(N_{n})$ 为：\n$$ \\mathrm{Var}(N_{n}) = \\mathrm{Var}\\left(\\sum_{i=1}^{n} N_{i}\\right) = \\sum_{i=1}^{n} \\mathrm{Var}(N_{i}) $$\n由于每个通道的噪声标准差相同，因此方差也相同，为 $\\sigma^2$。\n$$ \\mathrm{Var}(N_{n}) = \\sum_{i=1}^{n} \\sigma^2 = n\\sigma^2 $$\n合并后噪声的标准差 $\\sigma_{n}$ 是其方差的平方根：\n$$ \\sigma_{n} = \\sqrt{\\mathrm{Var}(N_{n})} = \\sqrt{n\\sigma^2} = \\sqrt{n}\\,\\sigma $$\n合并后通道的信噪比 $\\mathrm{SNR}_{n}$ 是合并后信号的均值与合并后噪声的标准差之比：\n$$ \\mathrm{SNR}_{n} = \\frac{\\text{mean}(S_{n})}{\\sigma_{n}} = \\frac{nS}{\\sqrt{n}\\,\\sigma} = \\frac{\\sqrt{n}\\,S}{\\sigma} $$\nSNR 变化的因子是 $\\mathrm{SNR}_{n}$ 与 $\\mathrm{SNR}_{1}$ 的比值：\n$$ \\text{Factor}_{\\mathrm{SNR}} = \\frac{\\mathrm{SNR}_{n}}{\\mathrm{SNR}_{1}} = \\frac{\\frac{\\sqrt{n}\\,S}{\\sigma}}{\\frac{S}{\\sigma}} = \\sqrt{n} $$\n\n**2. 光谱分辨率降低因子的推导**\n\n光谱分辨率与光谱通道的带宽有关。单个通道的初始带宽给定为 $\\Delta\\lambda_{1}$。通道被描述为具有顶帽形光谱响应且不重叠。合并是通过对 $n$ 个相邻通道求和来执行的。\n\n考虑一组 $n$ 个相邻、不重叠的通道，每个通道的顶帽形响应宽度为 $\\Delta\\lambda_{1}$。由于它们相邻且不重叠，它们覆盖的总光谱区间是它们各自宽度的总和。因此，合并后通道的有效带宽 $\\Delta\\lambda_{n}$ 是 $n$ 个组成通道的带宽之和：\n$$ \\Delta\\lambda_{n} = \\sum_{i=1}^{n} \\Delta\\lambda_{1,i} $$\n其中 $\\Delta\\lambda_{1,i}$ 是第 $i$ 个通道的带宽。由于所有通道具有相同的带宽 $\\Delta\\lambda_1$，这可以简化为：\n$$ \\Delta\\lambda_{n} = n \\Delta\\lambda_{1} $$\n光谱分辨率的降低由因子 $\\frac{\\Delta\\lambda_{n}}{\\Delta\\lambda_{1}}$ 量化：\n$$ \\text{Factor}_{\\text{Res}} = \\frac{\\Delta\\lambda_{n}}{\\Delta\\lambda_{1}} = \\frac{n \\Delta\\lambda_{1}}{\\Delta\\lambda_{1}} = n $$\n\n**3. 对 $n=3$ 的情况进行计算**\n\n我们现在必须为合并 $n=3$ 个相邻通道的情况计算这两个推导出的因子。问题要求精确值。\n\nSNR 变化因子是 $\\sqrt{n}$。对于 $n=3$，该因子是：\n$$ \\text{Factor}_{\\mathrm{SNR}} = \\sqrt{3} $$\n光谱分辨率降低因子是 $n$。对于 $n=3$，该因子是：\n$$ \\text{Factor}_{\\text{Res}} = 3 $$\n这两个因子是无量纲量。所要求的数值对，按顺序（SNR 变化因子，光谱分辨率降低因子）为 $(\\sqrt{3}, 3)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sqrt{3}  3 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "遥感应用的最终目标通常是从传感器接收的辐亮度中反演地表物理属性，例如地表反射率（$\\rho$）。这个过程不仅需要精确地移除大气效应，还需要深刻理解最终产品的不确定性。本练习整合了前面所学的概念，要求你为地表反射率的估算构建一个完整的误差预算。你将实践如何将从传感器定标到大气参数等多个环节的误差，一步步传递到最终产品中，从而对其可靠性进行定量评估。",
            "id": "3835411",
            "problem": "考虑对水平均匀朗伯表面的高光谱成像观测中的一个单一光谱波段。平行平面大气中的辐射传输通过地表下行太阳辐照度 $E_{\\downarrow}$、从地表到传感器的上行透射率 $T_{u}$、路径辐亮度 $L_{p}$ 以及由大气球面反照率 $S$ 参数化的大气多次散射反馈的组合，将传感器处的光谱辐亮度 $L$ 与地表双向反射率 $\\rho$（等于漫反射朗伯反射率）联系起来。使用以下经过充分检验的基本关系：(i) 对于朗伯表面，$L_{\\mathrm{surf}} = \\rho E_{\\downarrow}/\\pi$；(ii) $E_{\\downarrow} = E_{0} \\cos(\\theta_{s}) T_{d}$，其中 $E_{0}$ 是大气外光谱太阳辐照度，$\\theta_{s}$ 是太阳天顶角，$T_{d}$ 是下行透射率；(iii) 大气增加了路径辐亮度 $L_{p}$；(iv) 由 $S$ 表征的多次散射反馈以 $\\rho$ 的几何级数形式修正了耦合关系，产生了乘以离地项的因子 $1/(1 - S \\rho)$。传感器的辐射定标引入了乘性增益误差 $\\epsilon_{g}$ 和加性偏移误差 $\\epsilon_{o}$，因此进入反演的定标后辐亮度为 $L_{c} = (1 + \\epsilon_{g}) L + \\epsilon_{o}$。假设任何非朗伯双向反射分布函数（BRDF）不匹配在一阶上贡献一个加性反射率误差 $\\delta_{m}$。\n\n1. 从上述基本关系出发，推导 $\\rho$ 关于 $L_{c}$、$L_{p}$、$T_{u}$、$T_{d}$、$E_{0}$、$\\theta_{s}$ 和 $S$ 的闭式表达式。如果需要，可以将结果写成 $\\rho = f(L_{c}, L_{p}, T_{u}, T_{d}, E_{0}, \\theta_{s}, S)$ 的形式，并明确定义中间变量。\n\n2. 通过对标称值使用一阶泰勒展开对 $f$ 进行线性化，为反演得到的 $\\rho$ 构建一阶误差预算。将独立误差源视为不相关、零均值的高斯扰动。包括来自定标增益 $\\epsilon_{g}$、定标偏移 $\\epsilon_{o}$、大气参数 $T_{u}$、$T_{d}$、$S$、$L_{p}$、$E_{0}$、太阳天顶角 $\\theta_{s}$ 和模型不匹配 $\\delta_{m}$ 的贡献。对 $\\theta_{s}$ 求导时使用弧度；$\\theta_{s}$ 的不确定度以度为单位给出，在传播前必须转换为弧度。\n\n3. 在以下科学上合理的标称条件和一西格玛不确定度下，对以波长 $\\lambda$ 为中心的一个可见光波段，数值计算标准不确定度 $\\sigma_{\\rho}$：\n- $L = 56.0\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$，\n- $L_{p} = 6.0\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$，其 $\\sigma_{L_{p}} = 0.5\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$，\n- $T_{u} = 0.82$，其 $\\sigma_{T_{u}} = 0.01$，\n- $T_{d} = 0.78$，其 $\\sigma_{T_{d}} = 0.01$，\n- $E_{0} = 1600\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$，其 $\\sigma_{E_{0}} = 5\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$，\n- $\\theta_{s} = 40^\\circ$，其 $\\sigma_{\\theta_{s}} = 0.2^\\circ$，\n- $S = 0.10$，其 $\\sigma_{S} = 0.02$，\n- 定标误差：$\\sigma_{\\epsilon_{g}} = 0.01$（无量纲），$\\sigma_{\\epsilon_{o}} = 0.5\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$，\n- 模型不匹配：$\\sigma_{\\delta_{m}} = 0.01$（无量纲反射率）。\n\n假设标称 $\\epsilon_{g} = 0$ 且 $\\epsilon_{o} = 0$。将最终的 $\\sigma_{\\rho}$ 报告为无量纲的十进制反射率。将答案四舍五入到四位有效数字。",
            "solution": "该问题经评估具有科学依据、适定、客观且内部一致。这是一个关于大气校正和误差分析的定量遥感标准问题。所有必要的数据和物理关系都已提供。因此，有必要提供完整解法。\n\n解答分为三个部分，对应问题描述中的三个任务。\n\n第一部分：反射率 $\\rho$ 的闭式表达式推导。\n\n首先，我们建立传感器处光谱辐亮度 $L$ 的完整模型。传感器接收来自两个来源的辐亮度：被大气散射但未到达地表的辐亮度（路径辐亮度, $L_p$），以及从地表反射并穿过大气传输到传感器的辐亮度。\n\n地表是朗伯体，因此离开地表的辐亮度 $L'_{\\mathrm{surf}}$ 在所有方向上都是均匀的。它由 $L'_{\\mathrm{surf}} = \\rho E'_{\\mathrm{tot}} / \\pi$ 给出，其中 $E'_{\\mathrm{tot}}$ 是入射到地表的总光谱辐照度，$\\rho$ 是地表反射率。\n\n总辐照度 $E'_{\\mathrm{tot}}$ 是先前未与地表相互作用的直射太阳和散射天空辐照度 $E_{\\downarrow}$，以及从地表反射并被大气向下散射回来的辐照度之和。后一个分量通过大气球面反照率 $S$ 来建模。从地表总的上行通量是 $\\rho E'_{\\mathrm{tot}}$。这个通量中被散射回地表的部分是 $S$。因此，被反射并返回的辐照度是 $S \\rho E'_{\\mathrm{tot}}$。\n总辐照度为 $E'_{\\mathrm{tot}} = E_{\\downarrow} + S \\rho E'_{\\mathrm{tot}}$。\n解出 $E'_{\\mathrm{tot}}$ 得到 $E'_{\\mathrm{tot}}(1 - S\\rho) = E_{\\downarrow}$，这意味着 $E'_{\\mathrm{tot}} = \\frac{E_{\\downarrow}}{1 - S\\rho}$。\n\n因此，离开地表的辐亮度为 $L'_{\\mathrm{surf}} = \\frac{\\rho}{\\pi} \\frac{E_{\\downarrow}}{1 - S\\rho}$。\n到达传感器的地表反射辐亮度被上行透射率 $T_u$ 衰减。因此，传感器处来自地表的辐亮度分量是 $T_u L'_{\\mathrm{surf}} = \\frac{T_u \\rho E_{\\downarrow}}{\\pi(1 - S\\rho)}$。\n\n传感器处的总辐亮度 $L$ 是路径辐亮度与源自地表的分量之和：\n$$L = L_p + \\frac{T_u \\rho E_{\\downarrow}}{\\pi(1 - S\\rho)}$$\n使用给定的下行辐照度表达式 $E_{\\downarrow} = E_{0} \\cos(\\theta_{s}) T_{d}$，我们得到：\n$$L = L_p + \\frac{T_u E_{0} \\cos(\\theta_{s}) T_{d} \\rho}{\\pi(1 - S\\rho)}$$\n问题指出反演算法使用定标后的辐亮度 $L_c$。因此，$\\rho$ 的反演算法是通过对上述方程求解 $\\rho$ 得到的，其中 $L_c$ 替代了 $L$。\n$$L_c - L_p = \\frac{T_u E_{0} \\cos(\\theta_{s}) T_{d} \\rho}{\\pi(1 - S\\rho)}$$\n为简化起见，我们为从黑色表面反射的辐亮度分量 ($L_c - L_p$) 定义一个中间变量，并为大气和几何项定义另一个中间变量。令 $y = L_c - L_p$ 并令 $A = \\frac{T_u E_{0} \\cos(\\theta_{s}) T_{d}}{\\pi}$。方程变为：\n$$y = \\frac{A \\rho}{1 - S\\rho}$$\n现在我们求解 $\\rho$：\n$$y(1 - S\\rho) = A\\rho$$\n$$y - yS\\rho = A\\rho$$\n$$y = A\\rho + yS\\rho$$\n$$y = \\rho(A + yS)$$\n$$\\rho = \\frac{y}{A + yS}$$\n将 $y$ 和 $A$ 的定义代回表达式中，我们得到反演反射率 $\\rho$ 作为输入变量函数的闭式表达式：\n$$\\rho = f(L_{c}, L_{p}, T_{u}, T_{d}, E_{0}, \\theta_{s}, S) = \\frac{L_c - L_p}{\\frac{T_u E_{0} \\cos(\\theta_{s}) T_{d}}{\\pi} + (L_c - L_p)S}$$\n\n第二部分：构建一阶误差预算。\n\n反演反射率 $\\rho$ 的不确定度是通过将输入参数的不确定度通过导出的函数 $f$ 进行传播来找到的。$\\rho$ 的总误差有两个主要组成部分：辐射传输模型反演的误差和加性模型不匹配误差 $\\delta_m$。假设所有误差源都不相关且均值为零，总误差的方差是各个方差之和。\n反演得到的反射率记为 $\\rho_{ret}$。总误差为 $\\Delta\\rho_{total} = \\rho_{ret} - \\rho_{true} + \\delta_m$。“测量”的反射率误差为 $(\\rho_{ret}-\\rho_{true}) + \\delta_m$，其中 $\\rho_{ret}-\\rho_{true}$ 源于反演输入中的误差。\n设反演函数为 $\\rho = f(x_1, x_2, ..., x_n)$。$\\rho$ 的方差 $\\sigma_\\rho^2$ 由一阶泰勒展开给出：\n$$\\sigma_{\\rho,ret}^2 = \\sum_{i} \\left(\\frac{\\partial \\rho}{\\partial x_i}\\right)^2 \\sigma_{x_i}^2$$\n总方差为 $\\sigma_\\rho^2 = \\sigma_{\\rho,ret}^2 + \\sigma_{\\delta_m}^2$。\n输入测量值 $L_c$ 存在由定标增益 $\\epsilon_g$ 和偏移 $\\epsilon_o$ 引起的误差：$L_c = (1+\\epsilon_g)L + \\epsilon_o$。标称情况下，$\\epsilon_g=0$ 且 $\\epsilon_o=0$，因此标称 $L_c$ 就是 $L$。$L_c$ 的扰动为 $\\Delta L_c = L_c - L = \\epsilon_g L + \\epsilon_o$。其方差为 $\\sigma_{L_c}^2 = \\mathrm{Var}(\\epsilon_g L + \\epsilon_o) = L^2 \\sigma_{\\epsilon_g}^2 + \\sigma_{\\epsilon_o}^2$。\n$\\sigma_\\rho^2$ 的完整误差预算为：\n$$\\sigma_\\rho^2 = \\left(\\frac{\\partial \\rho}{\\partial L_c}\\right)^2 (L^2\\sigma_{\\epsilon_g}^2 + \\sigma_{\\epsilon_o}^2) + \\left(\\frac{\\partial \\rho}{\\partial L_p}\\right)^2 \\sigma_{L_p}^2 + \\left(\\frac{\\partial \\rho}{\\partial T_u}\\right)^2 \\sigma_{T_u}^2 + \\left(\\frac{\\partial \\rho}{\\partial T_d}\\right)^2 \\sigma_{T_d}^2 + \\left(\\frac{\\partial \\rho}{\\partial E_0}\\right)^2 \\sigma_{E_0}^2 + \\left(\\frac{\\partial \\rho}{\\partial \\theta_s}\\right)^2 \\sigma_{\\theta_s}^2 + \\left(\\frac{\\partial \\rho}{\\partial S}\\right)^2 \\sigma_S^2 + \\sigma_{\\delta_m}^2$$\n我们必须计算 $\\rho = \\frac{y}{A + yS}$ 的偏导数，其中 $y = L_c - L_p$ 且 $A = \\frac{T_u E_{0} \\cos(\\theta_{s}) T_{d}}{\\pi}$。所有导数都在标称参数值处计算。\n\n- $\\frac{\\partial \\rho}{\\partial L_c} = \\frac{\\partial}{\\partial L_c}\\left(\\frac{L_c-L_p}{A+(L_c-L_p)S}\\right) = \\frac{(A+(L_c-L_p)S) - (L_c-L_p)S}{(A+(L_c-L_p)S)^2} = \\frac{A}{(A+yS)^2}$\n- $\\frac{\\partial \\rho}{\\partial L_p} = \\frac{\\partial}{\\partial L_p}\\left(\\frac{L_c-L_p}{A+(L_c-L_p)S}\\right) = \\frac{-1(A+(L_c-L_p)S) - (L_c-L_p)(-S)}{(A+(L_c-L_p)S)^2} = \\frac{-A}{(A+yS)^2}$\n- $\\frac{\\partial \\rho}{\\partial A} = \\frac{\\partial}{\\partial A}\\left(\\frac{y}{A+yS}\\right) = \\frac{-y}{(A+yS)^2}$\n- 对 $A$ 中的参数使用链式法则：\n  - $\\frac{\\partial \\rho}{\\partial T_u} = \\frac{\\partial \\rho}{\\partial A}\\frac{\\partial A}{\\partial T_u} = \\frac{-y}{(A+yS)^2} \\frac{A}{T_u} = -\\frac{yA}{T_u(A+yS)^2}$\n  - $\\frac{\\partial \\rho}{\\partial T_d} = \\frac{\\partial \\rho}{\\partial A}\\frac{\\partial A}{\\partial T_d} = \\frac{-y}{(A+yS)^2} \\frac{A}{T_d} = -\\frac{yA}{T_d(A+yS)^2}$\n  - $\\frac{\\partial \\rho}{\\partial E_0} = \\frac{\\partial \\rho}{\\partial A}\\frac{\\partial A}{\\partial E_0} = \\frac{-y}{(A+yS)^2} \\frac{A}{E_0} = -\\frac{yA}{E_0(A+yS)^2}$\n  - $\\frac{\\partial \\rho}{\\partial \\theta_s} = \\frac{\\partial \\rho}{\\partial A}\\frac{\\partial A}{\\partial \\theta_s} = \\frac{-y}{(A+yS)^2} \\left(-\\frac{T_u E_0 \\sin(\\theta_s) T_d}{\\pi}\\right) = \\frac{yA\\tan(\\theta_s)}{(A+yS)^2}$ （注意：$\\theta_s$ 必须以弧度为单位）\n- $\\frac{\\partial \\rho}{\\partial S} = \\frac{\\partial}{\\partial S}\\left(\\frac{y}{A+yS}\\right) = \\frac{-y(y)}{(A+yS)^2} = -\\frac{y^2}{(A+yS)^2}$\n\n这些表达式构成了一阶误差预算。\n\n第三部分：标准不确定度 $\\sigma_{\\rho}$ 的数值计算。\n\n首先，我们计算中间量的标称值。\n- 标称条件：$L=56.0$, $L_p=6.0$, $T_u=0.82$, $T_d=0.78$, $E_0=1600$, $\\theta_s=40^\\circ$, $S=0.10$。\n- 不确定度：$\\sigma_{L_p}=0.5$, $\\sigma_{T_u}=0.01$, $\\sigma_{T_d}=0.01$, $\\sigma_{E_0}=5$, $\\sigma_{\\theta_s}=0.2^\\circ$, $\\sigma_S=0.02$, $\\sigma_{\\epsilon_g}=0.01$, $\\sigma_{\\epsilon_o}=0.5$, $\\sigma_{\\delta_m}=0.01$。\n\n我们对角度度量使用弧度：\n- $\\theta_s = 40^\\circ \\times \\frac{\\pi}{180^\\circ} \\approx 0.69813$ rad\n- $\\sigma_{\\theta_s} = 0.2^\\circ \\times \\frac{\\pi}{180^\\circ} \\approx 0.0034907$ rad\n\n现在，我们计算标称中间变量：\n- $L_c = L = 56.0\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$ (因为标称 $\\epsilon_g, \\epsilon_o$ 为 $0$)\n- $y = L_c - L_p = 56.0 - 6.0 = 50.0\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$\n- $A = \\frac{T_u E_0 \\cos(\\theta_s) T_d}{\\pi} = \\frac{0.82 \\times 1600 \\times \\cos(40^\\circ) \\times 0.78}{\\pi} \\approx 249.46\\ \\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$\n- $A + yS = 249.46 + 50.0 \\times 0.10 = 254.46$\n- 标称反射率：$\\rho = \\frac{y}{A+yS} = \\frac{50.0}{254.46} \\approx 0.1965$\n\n接下来，我们计算偏导数：\n- $\\frac{\\partial \\rho}{\\partial L_c} = \\frac{249.46}{(254.46)^2} \\approx 0.003853$\n- $\\frac{\\partial \\rho}{\\partial L_p} = -0.003853$\n- $\\frac{\\partial \\rho}{\\partial T_u} = -\\frac{50.0 \\times 249.46}{0.82 \\times (254.46)^2} \\approx -0.2349$\n- $\\frac{\\partial \\rho}{\\partial T_d} = -\\frac{50.0 \\times 249.46}{0.78 \\times (254.46)^2} \\approx -0.2470$\n- $\\frac{\\partial \\rho}{\\partial E_0} = -\\frac{50.0 \\times 249.46}{1600 \\times (254.46)^2} \\approx -0.0001204$\n- $\\frac{\\partial \\rho}{\\partial \\theta_s} = \\frac{50.0 \\times 249.46 \\times \\tan(40^\\circ)}{(254.46)^2} \\approx 0.1616$\n- $\\frac{\\partial \\rho}{\\partial S} = -\\frac{50.0^2}{(254.46)^2} \\approx -0.03861$\n\n现在，我们计算方差和中的每一项：\n- 定标方差：$\\sigma_{\\rho,cal}^2 = (0.003853)^2 (56.0^2 \\times 0.01^2 + 0.5^2) \\approx (1.484 \\times 10^{-5})(0.3136 + 0.25) \\approx 8.36 \\times 10^{-6}$\n- 路径辐亮度方差：$\\sigma_{\\rho,L_p}^2 = (-0.003853)^2 (0.5)^2 \\approx 3.71 \\times 10^{-6}$\n- 上行透射率方差：$\\sigma_{\\rho,T_u}^2 = (-0.2349)^2 (0.01)^2 \\approx 5.52 \\times 10^{-6}$\n- 下行透射率方差：$\\sigma_{\\rho,T_d}^2 = (-0.2470)^2 (0.01)^2 \\approx 6.10 \\times 10^{-6}$\n- 太阳辐照度方差：$\\sigma_{\\rho,E_0}^2 = (-0.0001204)^2 (5)^2 \\approx 3.62 \\times 10^{-7}$\n- 太阳角度方差：$\\sigma_{\\rho,\\theta_s}^2 = (0.1616)^2 (0.0034907)^2 \\approx 3.18 \\times 10^{-7}$\n- 球面反照率方差：$\\sigma_{\\rho,S}^2 = (-0.03861)^2 (0.02)^2 \\approx 5.96 \\times 10^{-7}$\n- 模型不匹配方差：$\\sigma_{\\delta_m}^2 = (0.01)^2 = 1.00 \\times 10^{-4} = 100 \\times 10^{-6}$\n\n将方差相加：\n$\\sigma_\\rho^2 = (8.36 + 3.71 + 5.52 + 6.10 + 0.362 + 0.318 + 0.596 + 100) \\times 10^{-6}$\n$\\sigma_\\rho^2 = 124.966 \\times 10^{-6}$\n\n标准不确定度 $\\sigma_\\rho$ 是总方差的平方根：\n$\\sigma_\\rho = \\sqrt{124.966 \\times 10^{-6}} \\approx 0.0111788$\n\n四舍五入到四位有效数字，结果是 $0.01118$。",
            "answer": "$$\n\\boxed{0.01118}\n$$"
        }
    ]
}