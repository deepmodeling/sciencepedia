{
    "hands_on_practices": [
        {
            "introduction": "A deep understanding of any scientific model begins not with memorizing its formula, but with deriving it from first principles. This exercise challenges you to construct the Soil-Adjusted Vegetation Index (SAVI) from a set of fundamental design requirements, revealing the logic embedded in its structure. By then using calculus to analyze the index's sensitivity to the soil adjustment parameter $L$, you will gain crucial insights into how, and under what conditions, this parameter influences the index's behavior—a key step in mastering its application .",
            "id": "3849021",
            "problem": "Consider a passive optical remote sensing observation of a heterogeneous land surface where the apparent bidirectional reflectance factor in the red band is denoted by $R$ and in the near-infrared band is denoted by $N$, with both $R$ and $N$ treated as dimensionless reflectances satisfying $0 \\leq R \\leq 1$ and $0 \\leq N \\leq 1$. The Normalized Difference Vegetation Index (NDVI) is defined as $\\mathrm{NDVI} = \\frac{N - R}{N + R}$ and is known to be sensitive to soil background under sparse vegetation cover due to additive soil brightness contributions.\n\nTo mitigate soil background influence, suppose you seek a modified, soil-adjusted vegetation index whose structure generalizes the normalized difference by adding a nonnegative soil adjustment parameter $L$ to the denominator and includes a scalar normalization factor that is allowed to depend on $L$. The design requirements are:\n1. The index should reduce to the normalized difference structure when $L = 0$.\n2. The index should attain a maximum value of $1$ under the idealized vegetation endmember condition $N = 1$ and $R = 0$, for any $L \\geq 0$.\n3. The index should be symmetric in the sense that it evaluates to $0$ when $N = R$ for any $L \\geq 0$.\n\nStarting from these requirements and the definition of NDVI, derive the explicit analytical form of the Soil-Adjusted Vegetation Index (SAVI) as a function of $N$, $R$, and $L$. Then, compute the partial derivative $\\frac{\\partial \\mathrm{SAVI}}{\\partial L}$ and simplify it to a closed-form expression in terms of $N$, $R$, and $L$. Finally, based on the derivative, discuss physically meaningful regimes in terms of $N$, $R$, and $L$ under which the index becomes insensitive to the choice of $L$ (i.e., the magnitude of $\\frac{\\partial \\mathrm{SAVI}}{\\partial L}$ is small or zero). Express the final derivative in a single closed-form analytic expression. No rounding is required, and no units are needed because reflectances are dimensionless.",
            "solution": "The problem requires the derivation of the Soil-Adjusted Vegetation Index (SAVI) based on a set of design requirements, followed by the calculation and interpretation of its partial derivative with respect to the soil adjustment parameter $L$.\n\nFirst, we validate the problem statement.\nThe givens are:\n-   Red band reflectance: $R$, where $0 \\leq R \\leq 1$.\n-   Near-infrared band reflectance: $N$, where $0 \\leq N \\leq 1$.\n-   Normalized Difference Vegetation Index: $\\mathrm{NDVI} = \\frac{N - R}{N + R}$.\n-   Soil adjustment parameter: $L \\geq 0$.\n-   Design Requirement 1: The index reduces to the NDVI structure for $L = 0$.\n-   Design Requirement 2: The index is $1$ for $N=1, R=0$ for any $L \\geq 0$.\n-   Design Requirement 3: The index is $0$ for $N=R$ for any $L \\geq 0$.\nThe problem is scientifically grounded in the principles of remote sensing, specifically vegetation index theory. It is well-posed, providing sufficient constraints to derive a unique solution. The language is objective and the setup is consistent. Therefore, the problem is deemed valid and we may proceed with the solution.\n\n**Part 1: Derivation of the SAVI formula**\n\nWe start by proposing a general form for the new index that incorporates the given structural modifications. The problem states that the index generalizes the normalized difference by adding $L$ to the denominator and includes a scalar normalization factor, which we denote as $K(L)$. A plausible general form is:\n$$\n\\mathrm{SAVI} = K(L) \\frac{N - R}{N + R + L}\n$$\nNow, we apply the three design requirements to determine the function $K(L)$.\n\nRequirement 3 states that the index must be $0$ when $N = R$. Substituting $N=R$ into our proposed form gives:\n$$\n\\mathrm{SAVI} = K(L) \\frac{R - R}{R + R + L} = K(L) \\frac{0}{2R + L} = 0\n$$\nThis condition is satisfied for any function $K(L)$, provided the denominator $2R+L$ is not zero. Since $R \\ge 0$ and $L \\ge 0$, the denominator is only zero if $R=0$ and $L=0$. In this special case ($N=R=L=0$), the expression is an indeterminate form $0/0$, which we define as $0$ to satisfy the requirement universally. Thus, the factor $(N-R)$ in the numerator correctly implements this requirement.\n\nRequirement 2 states that the index must attain a value of $1$ for the ideal vegetation endmember, where $N=1$ and $R=0$. This must hold for any $L \\geq 0$. We substitute these values into the expression for SAVI:\n$$\n1 = K(L) \\frac{1 - 0}{1 + 0 + L} = K(L) \\frac{1}{1 + L}\n$$\nSolving for $K(L)$, we find the explicit form of the normalization factor:\n$$\nK(L) = 1 + L\n$$\nSubstituting this expression for $K(L)$ back into our general form, we obtain the analytical form of the Soil-Adjusted Vegetation Index:\n$$\n\\mathrm{SAVI} = (1 + L) \\frac{N - R}{N + R + L}\n$$\nFinally, we check Requirement 1, which states that the index should reduce to the NDVI structure when $L=0$. Setting $L=0$ in our derived formula:\n$$\n\\mathrm{SAVI}|_{L=0} = (1 + 0) \\frac{N - R}{N + R + 0} = \\frac{N - R}{N + R} = \\mathrm{NDVI}\n$$\nThis confirms that our derived expression for SAVI satisfies all three design requirements.\n\n**Part 2: Calculation of the partial derivative $\\frac{\\partial \\mathrm{SAVI}}{\\partial L}$**\n\nWe now compute the partial derivative of SAVI with respect to $L$, treating $N$ and $R$ as constants. The expression for SAVI is:\n$$\n\\mathrm{SAVI}(L) = (N - R) \\left( \\frac{1 + L}{N + R + L} \\right)\n$$\nWe can use the quotient rule for differentiation, $\\frac{d}{dx}\\left(\\frac{u(x)}{v(x)}\\right) = \\frac{u'(x)v(x) - u(x)v'(x)}{[v(x)]^2}$, on the term in the parentheses.\nLet $u(L) = 1 + L$ and $v(L) = N + R + L$.\nThe derivatives with respect to $L$ are $u'(L) = 1$ and $v'(L) = 1$.\n\nApplying the quotient rule:\n$$\n\\frac{\\partial}{\\partial L} \\left( \\frac{1 + L}{N + R + L} \\right) = \\frac{(1)(N + R + L) - (1 + L)(1)}{(N + R + L)^2}\n$$\nSimplifying the numerator:\n$$\n(N + R + L) - (1 + L) = N + R + L - 1 - L = N + R - 1\n$$\nSo, the derivative of the fractional term is:\n$$\n\\frac{\\partial}{\\partial L} \\left( \\frac{1 + L}{N + R + L} \\right) = \\frac{N + R - 1}{(N + R + L)^2}\n$$\nMultiplying by the constant factor $(N-R)$ gives the final partial derivative of SAVI:\n$$\n\\frac{\\partial \\mathrm{SAVI}}{\\partial L} = (N - R) \\frac{N + R - 1}{(N + R + L)^2}\n$$\n\n**Part 3: Discussion of insensitivity to $L$**\n\nThe index SAVI becomes insensitive to the choice of the parameter $L$ when its partial derivative $\\frac{\\partial \\mathrm{SAVI}}{\\partial L}$ is zero or close to zero. We analyze the expression for the derivative to identify such regimes.\n$$\n\\frac{\\partial \\mathrm{SAVI}}{\\partial L} = \\frac{(N - R)(N + R - 1)}{(N + R + L)^2}\n$$\nThe derivative is exactly zero when its numerator is zero. This occurs under two distinct conditions:\n1.  $N - R = 0$, which means $N = R$. This corresponds to the \"grey line\" in the $N-R$ spectral space, representing surfaces with no dominant spectral difference between the red and near-infrared bands. Physically, this includes non-vegetated surfaces like bare soil, rocks, and man-made structures. For these surfaces, $\\mathrm{SAVI} = 0$ regardless of $L$, so the index is perfectly insensitive to the soil adjustment parameter, which is a desirable property.\n\n2.  $N + R - 1 = 0$, which means $N + R = 1$. This defines a line in the $N-R$ spectral space. For any pixel whose reflectances satisfy this condition, the SAVI becomes insensitive to $L$. To see this, substituting $N+R=1$ into the SAVI formula gives $\\mathrm{SAVI} = (1+L)\\frac{N-R}{1+L} = N-R$, which is independent of $L$.\n\nThe magnitude of the derivative, $|\\frac{\\partial \\mathrm{SAVI}}{\\partial L}|$, is small in the following physically meaningful regimes:\n-   **Low vegetation cover or non-vegetated surfaces**: Here, $N \\approx R$, so the term $(N-R)$ is close to zero, making the derivative small.\n-   **Dense vegetation canopies**: For dense, healthy vegetation, reflectance in the red band is very low ($R \\to 0$) and reflectance in the near-infrared is very high ($N \\to 1$). As this ideal condition is approached, the sum $N+R$ approaches $1$. Therefore, the term $(N+R-1)$ approaches $0$, causing the derivative $\\frac{\\partial \\mathrm{SAVI}}{\\partial L}$ to approach $0$. This is also a desirable property, as the influence of the soil background diminishes to zero under a full canopy, and thus the soil adjustment parameter should have a negligible effect.\n\nIn summary, the SAVI is insensitive to the soil parameter $L$ for non-vegetated surfaces and for very dense vegetation canopies, which are the two extremes of vegetation cover.",
            "answer": "$$\n\\boxed{(N - R) \\frac{N + R - 1}{(N + R + L)^{2}}}\n$$"
        },
        {
            "introduction": "Having established the mathematical form of SAVI, we now test its performance in a practical, physical context. This practice presents a controlled hypothetical scenario where soil moisture changes alter the spectral signature of bare ground, a common challenge in remote sensing. By calculating and comparing the response of both NDVI and SAVI to this change, you will directly observe and quantify SAVI's primary advantage: its enhanced stability and reduced sensitivity to variations in the soil background, demonstrating why it is a more robust tool for monitoring vegetation in sparsely covered areas .",
            "id": "3849016",
            "problem": "A nadir-viewing multispectral sensor measures top-of-canopy bidirectional reflectance factors over a large, homogeneous, vegetation-free bare-soil field before and after a rainfall event that increases volumetric soil water content from $0.05$ to $0.25$ (dimensionless). Laboratory characterizations for this soil indicate that, under the illumination and viewing geometry of the acquisitions, wetting leads to a slight increase in the red-band reflectance due to thin-film specular enhancement while simultaneously decreasing the near-infrared reflectance due to water absorption features. The measured surface reflectances are:\n- Dry state: red-band reflectance $R_{\\mathrm{Red,dry}} = 0.20$, near-infrared reflectance $R_{\\mathrm{NIR,dry}} = 0.25$.\n- Wet state: red-band reflectance $R_{\\mathrm{Red,wet}} = 0.22$, near-infrared reflectance $R_{\\mathrm{NIR,wet}} = 0.18$.\n\nAssume no vegetation is present in either acquisition and the geometry and calibration are otherwise identical. Consider the behavior of the Normalized Difference Vegetation Index (NDVI) and the Soil-Adjusted Vegetation Index (SAVI; with soil-adjustment factor $L = 0.50$) computed from these bands.\n\nWhich statement best characterizes the sign and relative magnitude of the index changes induced by this moisture-driven spectral shift?\n\nA. Both NDVI and SAVI decrease from dry to wet, but the magnitude of the decrease is smaller for SAVI than for NDVI, reflecting reduced sensitivity to soil background.\n\nB. NDVI decreases from dry to wet, but SAVI increases because the soil-adjustment factor cancels the red-band increase.\n\nC. Both NDVI and SAVI decrease by identical amounts because soil adjustment has no effect for bare soils.\n\nD. NDVI increases from dry to wet while SAVI decreases, indicating opposite sensitivities to the soil spectral change.\n\nE. Both NDVI and SAVI decrease from dry to wet, but the magnitude of the decrease is larger for SAVI than for NDVI because adding $L$ in the denominator amplifies sensitivity to soil moisture.",
            "solution": "We begin from the definitions of reflectance and the indices. Let $R_{\\mathrm{Red}}$ and $R_{\\mathrm{NIR}}$ denote the top-of-canopy surface reflectances in the red and near-infrared bands, respectively. For any indices built as band combinations, their sensitivity to changes in $R_{\\mathrm{Red}}$ and $R_{\\mathrm{NIR}}$ can be established from their definitional forms.\n\nThe Normalized Difference Vegetation Index (NDVI) is defined as\n$$\n\\mathrm{NDVI} = \\frac{R_{\\mathrm{NIR}} - R_{\\mathrm{Red}}}{R_{\\mathrm{NIR}} + R_{\\mathrm{Red}}}.\n$$\nThe Soil-Adjusted Vegetation Index (SAVI) with soil-adjustment factor $L$ is defined as\n$$\n\\mathrm{SAVI} = \\left(1+L\\right)\\,\\frac{R_{\\mathrm{NIR}} - R_{\\mathrm{Red}}}{R_{\\mathrm{NIR}} + R_{\\mathrm{Red}} + L}.\n$$\n\nFirst, we analyze the sign of the changes using partial derivatives. Let $N \\equiv R_{\\mathrm{NIR}}$ and $R \\equiv R_{\\mathrm{Red}}$ for brevity.\n\nFor NDVI, define\n$$\nf(N,R) = \\frac{N - R}{N + R}.\n$$\nIts partial derivatives are\n$$\n\\frac{\\partial f}{\\partial N} = \\frac{(N+R) - (N-R)}{(N+R)^2} = \\frac{2R}{(N+R)^2} > 0,\n$$\n$$\n\\frac{\\partial f}{\\partial R} = \\frac{-(N+R) - (N-R)}{(N+R)^2} = -\\frac{2N}{(N+R)^2} < 0.\n$$\nThus, an increase in $R$ decreases NDVI, and a decrease in $N$ also decreases NDVI. Under the stated moisture change, $\\Delta R > 0$ and $\\Delta N < 0$, so both effects act to reduce NDVI.\n\nFor SAVI, define\n$$\ng(N,R) = \\left(1+L\\right)\\,\\frac{N - R}{N + R + L}.\n$$\nIts partial derivatives are\n$$\n\\frac{\\partial g}{\\partial N} = \\left(1+L\\right)\\,\\frac{(N+R+L) - (N-R)}{(N+R+L)^2} = \\left(1+L\\right)\\,\\frac{2R + L}{(N+R+L)^2} > 0,\n$$\n$$\n\\frac{\\partial g}{\\partial R} = \\left(1+L\\right)\\,\\frac{-(N+R+L) - (N-R)}{(N+R+L)^2} = -\\left(1+L\\right)\\,\\frac{2N + L}{(N+R+L)^2} < 0.\n$$\nAs with NDVI, an increase in $R$ and a decrease in $N$ both reduce SAVI. Therefore, both indices must decrease in response to the specified changes.\n\nNext, we compare relative magnitudes. The sensitivity coefficients for NDVI and SAVI differ in two ways: SAVI’s denominators include $L$, which enlarges the squared denominator $(N+R+L)^2$, and SAVI’s numerators include terms $2R+L$ and $2N+L$ scaled by $(1+L)$. For typical bare-soil reflectances and a moderate $L$ (e.g., $L=0.50$), the increase in denominator dominates, reducing the magnitude of SAVI’s sensitivity to soil-driven band changes relative to NDVI.\n\nWe can confirm with the provided numbers.\n\nDry state:\n- $R_{\\mathrm{Red,dry}} = 0.20$,\n- $R_{\\mathrm{NIR,dry}} = 0.25$.\n\nWet state:\n- $R_{\\mathrm{Red,wet}} = 0.22$,\n- $R_{\\mathrm{NIR,wet}} = 0.18$.\n\nCompute NDVI:\n$$\n\\mathrm{NDVI}_{\\mathrm{dry}} = \\frac{0.25 - 0.20}{0.25 + 0.20} = \\frac{0.05}{0.45} \\approx 0.111111,\n$$\n$$\n\\mathrm{NDVI}_{\\mathrm{wet}} = \\frac{0.18 - 0.22}{0.18 + 0.22} = \\frac{-0.04}{0.40} = -0.10.\n$$\nChange:\n$$\n\\Delta \\mathrm{NDVI} = \\mathrm{NDVI}_{\\mathrm{wet}} - \\mathrm{NDVI}_{\\mathrm{dry}} \\approx -0.10 - 0.111111 \\approx -0.211111.\n$$\n\nCompute SAVI with $L=0.50$:\n$$\n\\mathrm{SAVI}_{\\mathrm{dry}} = \\left(1+0.50\\right)\\frac{0.25 - 0.20}{0.25 + 0.20 + 0.50} = 1.50\\,\\frac{0.05}{0.95} \\approx 1.50 \\times 0.0526316 \\approx 0.078947,\n$$\n$$\n\\mathrm{SAVI}_{\\mathrm{wet}} = \\left(1+0.50\\right)\\frac{0.18 - 0.22}{0.18 + 0.22 + 0.50} = 1.50\\,\\frac{-0.04}{0.90} \\approx 1.50 \\times \\left(-0.0444444\\right) \\approx -0.0666667.\n$$\nChange:\n$$\n\\Delta \\mathrm{SAVI} = \\mathrm{SAVI}_{\\mathrm{wet}} - \\mathrm{SAVI}_{\\mathrm{dry}} \\approx -0.0666667 - 0.078947 \\approx -0.145614.\n$$\n\nBoth indices decrease, and the magnitude of the decrease is smaller for SAVI than for NDVI (approximately $0.1456$ versus $0.2111$), consistent with SAVI’s design to mitigate soil background effects by introducing $L$.\n\nOption-by-option analysis:\n\n- Option A: States both indices decrease and SAVI’s decrease is smaller in magnitude than NDVI’s. This matches both the derivative-based reasoning and the explicit computations. Correct.\n\n- Option B: Claims NDVI decreases but SAVI increases due to the soil-adjustment factor. The sign analysis shows both $\\partial g/\\partial N > 0$ and $\\partial g/\\partial R < 0$, so with $\\Delta N < 0$ and $\\Delta R > 0$, SAVI must decrease. Incorrect.\n\n- Option C: Claims identical decreases. The formulas differ, and the numerical results show different magnitudes. Incorrect.\n\n- Option D: Claims NDVI increases while SAVI decreases. The given band changes reduce both indices. Incorrect.\n\n- Option E: Claims both decrease, but SAVI decreases more than NDVI due to $L$. The computations and sensitivity analysis show the opposite: $L$ reduces sensitivity to soil background, yielding a smaller magnitude change for SAVI. Incorrect.\n\nTherefore, the best characterization is given by Option A.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Moving from theory to implementation, this final practice addresses a critical question for any modeler: how to select the optimal parameter values for a specific application. While a generic value for the soil adjustment factor $L$ (such as $L=0.5$) is often suggested, the ideal value depends on local soil characteristics. This advanced, code-based exercise guides you through developing a stability analysis to empirically determine the optimal $L$ from bare soil reflectance data, providing you with a powerful, data-driven methodology for customizing and refining vegetation indices for real-world environmental monitoring .",
            "id": "3849008",
            "problem": "You are tasked with deriving and implementing a stability analysis for the Soil-Adjusted Vegetation Index (SAVI) in the context of remote sensing and environmental modeling. Begin from fundamental principles and well-tested facts relevant to reflectance-based vegetation indices. Specifically, use the following bases:\n\n- Spectral reflectance is a dimensionless quantity measured as a decimal fraction between $0$ and $1$, representing the ratio of reflected to incident radiation.\n- In sparse canopies, the red and near-infrared reflectances can be approximated as linear mixtures of vegetation and soil components: $R = f R^{v} + (1-f) R^{s}$ and $N = f N^{v} + (1-f) N^{s}$, where $R$ is the red reflectance, $N$ is the near-infrared reflectance, $f$ is the fractional vegetation cover, $R^{v},N^{v}$ are vegetation reflectances, and $R^{s},N^{s}$ are soil reflectances.\n- Bare soil ($f=0$) reflectances commonly align along an empirical “soil line,” modeled as $N^{s} \\approx \\alpha R^{s} + \\beta$ with $\\alpha$ and $\\beta$ constants estimated by linear regression.\n\nUsing these bases, perform the following:\n\n1. Derive a vegetation index $V(N,R;L)$ that explicitly contains a scalar soil-adjustment parameter $L \\in [0,1]$ and reduces soil-background sensitivity relative to the Normalized Difference Vegetation Index (NDVI), while maintaining appropriate scaling of the vegetation signal. Your derivation must make clear what the index is, why it reduces soil influence, and how $L$ enters the expression from first principles with the mixture model and soil-line concept, without assuming any pre-given formulas for the target index.\n\n2. Define a composite stability functional for bare soils as\n$$\nJ(L) = \\operatorname{MAD}_0(L) + \\left|m(L)\\right|,\n$$\nwhere $\\operatorname{MAD}_0(L)$ is the median of the absolute values of $V(N_i,R_i;L)$ across measured bare-soil samples $(N_i,R_i)$, and $m(L)$ is the ordinary least squares slope of $V(N_i,R_i;L)$ regressed on soil brightness $B_i = (N_i + R_i)/2$. The regression slope is computed as $m(L)=\\operatorname{Cov}(B,V)/\\operatorname{Var}(B)$ when $\\operatorname{Var}(B) > 0$, and set to $0$ when $\\operatorname{Var}(B) = 0$.\n\n3. For a given set of bare-soil spectra, choose $L$ to minimize $J(L)$ over the closed interval $[0,1]$. The choice of $L$ should be expressed as a decimal, rounded to three decimals.\n\nYour program must implement the derived index $V(N,R;L)$ and the stability functional $J(L)$, evaluate $J(L)$ on a dense grid of $L$ values in $[0,1]$, and return the minimizing $L$ for each test case.\n\nTest Suite. Use the following measured bare-soil reflectance datasets. Each pair is $(N,R)$ with both entries in decimal fractions between $0$ and $1$:\n\n- Set $\\mathcal{A}$ (moderate variability):\n  $(\\,$$0.12$$,$$0.08$$)$, $(\\,$$0.13$$,$$0.10$$)$, $(\\,$$0.16$$,$$0.12$$)$, $(\\,$$0.22$$,$$0.15$$)$, $(\\,$$0.25$$,$$0.18$$)$, $(\\,$$0.27$$,$$0.20$$)$, $(\\,$$0.29$$,$$0.22$$)$, $(\\,$$0.31$$,$$0.24$$)$, $(\\,$$0.33$$,$$0.26$$)$, $(\\,$$0.35$$,$$0.28$$)$, $(\\,$$0.36$$,$$0.30$$)$, $(\\,$$0.38$$,$$0.32$$)$.\n\n- Set $\\mathcal{B}$ (high variability, including dark humic and bright sandy soils):\n  $(\\,$$0.05$$,$$0.03$$)$, $(\\,$$0.08$$,$$0.06$$)$, $(\\,$$0.12$$,$$0.10$$)$, $(\\,$$0.21$$,$$0.20$$)$, $(\\,$$0.24$$,$$0.22$$)$, $(\\,$$0.30$$,$$0.28$$)$, $(\\,$$0.42$$,$$0.39$$)$, $(\\,$$0.45$$,$$0.40$$)$, $(\\,$$0.50$$,$$0.45$$)$, $(\\,$$0.55$$,$$0.50$$)$, $(\\,$$0.58$$,$$0.52$$)$, $(\\,$$0.60$$,$$0.55$$)$.\n\n- Set $\\mathcal{C}$ (low variability boundary case):\n  $(\\,$$0.25$$,$$0.18$$)$, $(\\,$$0.26$$,$$0.18$$)$, $(\\,$$0.25$$,$$0.19$$)$, $(\\,$$0.26$$,$$0.19$$)$, $(\\,$$0.24$$,$$0.18$$)$, $(\\,$$0.24$$,$$0.19$$)$, $(\\,$$0.25$$,$$0.18$$)$, $(\\,$$0.25$$,$$0.19$$)$.\n\nNumerical Requirements:\n\n- All reflectances are dimensionless and must be treated as decimal fractions between $0$ and $1$.\n- Angles are not involved.\n- Your program must output the chosen soil-adjustment parameters for the sets $\\mathcal{A}$, $\\mathcal{B}$, and $\\mathcal{C}$ as decimals rounded to three decimals.\n\nAlgorithmic Requirements:\n\n- Evaluate $J(L)$ on a uniform grid $L_k$ over $[0,1]$ with step size $\\Delta L = 0.001$ (i.e., $L_k = 0.000, 0.001, 0.002, \\dots, 1.000$).\n- For each dataset, select $L^\\star$ minimizing $J(L)$; if multiple values tie, choose the smallest $L$ among minimizers.\n- Express the final selection criteria for $L$ in regions with high soil variability using the composite stability functional $J(L)$ defined above.\n\nFinal Output Format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[L^\\star_{\\mathcal{A}},L^\\star_{\\mathcal{B}},L^\\star_{\\mathcal{C}}]$, with each entry rounded to three decimals, for example: $[\\,$$0.375$$,$$0.512$$,$$0.100$$]$.",
            "solution": "**1. Derivation of the Vegetation Index $V(N,R;L)$**\n\nA primary goal of a vegetation index is to provide a measure that is strongly correlated with vegetation properties (e.g., fractional cover $f$, leaf area index) while being minimally affected by other factors, such as soil background, illumination, and atmospheric conditions.\n\nThe Normalized Difference Vegetation Index (NDVI), defined as $NDVI = \\frac{N-R}{N+R}$, is a widely used index. However, it suffers from a known sensitivity to the soil background. For bare soil ($f=0$), the canopy reflectances are identical to the soil reflectances, $N=N^s$ and $R=R^s$. These soil reflectances often cluster along an empirical \"soil line\" in the $N-R$ spectral space, described by $N^s \\approx \\alpha R^s + \\beta$. Substituting this into the NDVI formula for bare soil gives:\n$$\nNDVI_{\\text{soil}} = \\frac{N^s - R^s}{N^s + R^s} = \\frac{(\\alpha R^s + \\beta) - R^s}{(\\alpha R^s + \\beta) + R^s} = \\frac{(\\alpha-1)R^s + \\beta}{(\\alpha+1)R^s + \\beta}\n$$\nThis expression demonstrates that $NDVI_{\\text{soil}}$ is a function of the red reflectance $R^s$ (a proxy for soil brightness). As $R^s$ varies from dark to bright soils, the NDVI value for bare soil changes, which confounds the interpretation of the index, especially in areas of sparse vegetation where the soil signal is significant. Ideally, an index value for bare soil should be constant (e.g., zero).\n\nTo mitigate this soil-induced variation, we can modify the NDVI formula. The core idea is to introduce a correction term that accounts for the non-zero intercept $\\beta$ and the slope $\\alpha \\neq 1$ of the soil line. A simple and effective approach is to add a constant adjustment factor to the denominator, which serves as a brightness term. Let us define a new index, $V$, with a soil adjustment parameter, which we will call $L_{abs}$:\n$$\nV' = \\frac{N - R}{N + R + L_{abs}}\n$$\nFor this index to be constant along the soil line, its value must be independent of $R^s$:\n$$\nV'_{\\text{soil}} = \\frac{(\\alpha-1)R^s + \\beta}{(\\alpha+1)R^s + \\beta + L_{abs}}\n$$\nFor $V'_{\\text{soil}}$ to be independent of $R^s$, the ratio of the coefficients of $R^s$ in the numerator and denominator must equal the ratio of the constant terms. This would require $\\frac{\\alpha-1}{\\alpha+1} = \\frac{\\beta}{\\beta + L_{abs}}$, which implies $L_{abs}(\\alpha-1)=2\\beta$. This shows that a perfect correction is theoretically possible if the soil line parameters $\\alpha$ and $\\beta$ are known precisely.\n\nIn practice, soil properties vary spatially, so a single set of $(\\alpha, \\beta)$ is not universally applicable. A more robust approach is to introduce a general-purpose adjustment parameter, a dimensionless quantity $L \\in [0,1]$, that is not tied to a specific soil line but is optimized to minimize soil-induced noise across a range of expected soil types. This leads to the formulation of the Soil-Adjusted Vegetation Index (SAVI) and related indices. We can construct such an index by setting the adjustment term to be this parameter $L$.\nThe problem does not require matching the scaling of NDVI, only maintaining appropriate scaling of the vegetation signal and reducing soil influence. Thus, a direct and sufficient candidate for our index $V(N,R;L)$ is:\n$$\nV(N,R;L) = \\frac{N - R}{N + R + L}\n$$\nHere, $L$ is the scalar soil-adjustment parameter. When $L=0$, this index is proportional to NDVI (specifically, it is $NDVI / (1+NDVI)$). As $L$ increases, it helps to buffer the index against variations in the denominator $N+R$ for bare soils, thus stabilizing its value. The optimal value of $L$ is one that best minimizes soil-related variations for a given dataset, which is the objective of the subsequent tasks.\n\n**2. The Stability Functional and Optimization Procedure**\n\nThe problem defines a composite stability functional $J(L)$ to find the optimal $L$:\n$$\nJ(L) = \\operatorname{MAD}_0(L) + \\left|m(L)\\right|\n$$\nThis functional is designed to find an $L$ that makes the index $V$ for bare soil simultaneously close to zero and uncorrelated with soil brightness.\n-   $\\operatorname{MAD}_0(L) = \\operatorname{median}_{i}(\\{|V(N_i,R_i;L)|\\})$: The Median Absolute Deviation from zero measures the typical magnitude of the index value for bare soil. An ideal index would yield $V=0$ for all bare soils, so minimizing this term forces the index values towards zero.\n-   $m(L) = \\operatorname{Cov}(B,V)/\\operatorname{Var}(B)$: The slope of the regression of $V$ against soil brightness $B = (N+R)/2$ measures the residual systematic trend of the index with soil brightness. Minimizing its absolute value, $|m(L)|$, removes this residual dependency.\n\nThe optimization is performed by a grid search. We evaluate $J(L)$ for a sequence of $L$ values from $0.000$ to $1.000$ in steps of $\\Delta L = 0.001$. For each of the provided bare-soil datasets ($\\mathcal{A}$, $\\mathcal{B}$, and $\\mathcal{C}$), we compute the vector of index values $V_i$, the soil brightness values $B_i$, and then the functional $J(L)$. The value $L^{\\star}$ that results in the minimum $J(L)$ is selected as the optimal parameter for that dataset. If a tie occurs, the smallest $L$ value is chosen, which is handled naturally by iterating $L$ in increasing order and updating the minimum only on a strict inequality.\n\n**3. Numerical Implementation**\n\nThe algorithm is implemented as follows for each dataset:\n1.  Parse the $(N, R)$ reflectance pairs into numerical arrays.\n2.  Compute the soil brightness array $B_i = (N_i + R_i)/2$.\n3.  Initialize `min_J` to a large value and `best_L` to a default.\n4.  Loop through $L_k$ from $0.000$ to $1.000$ with step $0.001$.\n5.  In each iteration, calculate the array of index values $V_i(L_k) = \\frac{N_i - R_i}{N_i + R_i + L_k}$.\n6.  Calculate $\\operatorname{MAD}_0(L_k) = \\operatorname{median}(\\{|V_i(L_k)|\\})$.\n7.  Calculate the variance of brightness, $\\operatorname{Var}(B)$. If it is zero, set the slope $m(L_k) = 0$. Otherwise, calculate the covariance $\\operatorname{Cov}(B, V(L_k))$ and the slope $m(L_k) = \\operatorname{Cov}(B, V(L_k)) / \\operatorname{Var}(B)$. These statistical quantities are computed using population formulas (denominator $n$).\n8.  Calculate the stability functional $J(L_k) = \\operatorname{MAD}_0(L_k) + |m(L_k)|$.\n9.  If $J(L_k)$ is less than the current `min_J`, update `min_J = J(L_k)` and `best_L = L_k`.\n10. After the loop completes, `best_L` contains the optimal parameter $L^{\\star}$ for the dataset.\n11. The final results for all datasets are collected and formatted as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a stability analysis for the Soil-Adjusted \n    Vegetation Index (SAVI) to find the optimal soil-adjustment parameter L.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Set A (moderate variability)\n        np.array([\n            [0.12, 0.08], [0.13, 0.10], [0.16, 0.12], [0.22, 0.15],\n            [0.25, 0.18], [0.27, 0.20], [0.29, 0.22], [0.31, 0.24],\n            [0.33, 0.26], [0.35, 0.28], [0.36, 0.30], [0.38, 0.32]\n        ]),\n        # Set B (high variability)\n        np.array([\n            [0.05, 0.03], [0.08, 0.06], [0.12, 0.10], [0.21, 0.20],\n            [0.24, 0.22], [0.30, 0.28], [0.42, 0.39], [0.45, 0.40],\n            [0.50, 0.45], [0.55, 0.50], [0.58, 0.52], [0.60, 0.55]\n        ]),\n        # Set C (low variability boundary case)\n        np.array([\n            [0.25, 0.18], [0.26, 0.18], [0.25, 0.19], [0.26, 0.19],\n            [0.24, 0.18], [0.24, 0.19], [0.25, 0.18], [0.25, 0.19]\n        ])\n    ]\n\n    results = []\n    \n    # Define the grid for L\n    L_grid = np.arange(0.0, 1.001, 0.001)\n\n    for soil_data in test_cases:\n        N = soil_data[:, 0]\n        R = soil_data[:, 1]\n        \n        # Calculate soil brightness B\n        B = (N + R) / 2.0\n        \n        min_J = float('inf')\n        best_L = -1.0\n        \n        # Calculate Var(B) once. ddof=0 for population variance.\n        var_B = np.var(B, ddof=0)\n        \n        # Grid search for L\n        for L in L_grid:\n            # Calculate the vegetation index V for the current L\n            # Using a small epsilon to avoid division by zero if N+R+L is somehow zero,\n            # though not expected with the given positive reflectances and L>=0.\n            denominator = N + R + L\n            V = (N - R) / (denominator + 1e-12)\n            \n            # Calculate MAD_0(L)\n            mad_0 = np.median(np.abs(V))\n            \n            # Calculate m(L)\n            m_L = 0.0\n            if var_B > 0:\n                # Calculate Cov(B, V). ddof=0 for population covariance.\n                cov_matrix = np.cov(B, V, ddof=0)\n                cov_BV = cov_matrix[0, 1]\n                m_L = cov_BV / var_B\n            \n            # Calculate the stability functional J(L)\n            J = mad_0 + np.abs(m_L)\n            \n            # Check for new minimum\n            if J  min_J:\n                min_J = J\n                best_L = L\n\n        results.append(best_L)\n\n    # Format the final output as specified.\n    # The f-string formatting with .3f handles rounding.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}