{
    "hands_on_practices": [
        {
            "introduction": "土壤颗粒的物理特性，如其大小，是决定其如何反射光线的根本因素。本实践将引导您使用一个基于比尔-朗伯定律 (Beer-Lambert law) 的简化模型来探索这一关键关系。通过理解光子路径长度如何随颗粒直径变化，您将为“为何在吸收性矿物中，较大的颗粒通常在光谱数据中显得更暗”这一问题建立起基础的物理直觉。",
            "id": "3854166",
            "problem": "一个高光谱传感器在近红外波段观测干燥的颗粒状矿物土壤时，记录到反射率随着平均粒径的增大而减小，这与较大颗粒中光子路径长度增加和吸收作用更强相符。考虑一个颗粒床，其颗粒可以理想化为厚度等于平均粒径 $d$ 的均匀平面平行板，且内部散射可忽略不计。假设对观测到的反射率有贡献的光子，在颗粒的远端界面经历一次镜面反射，并在射出前两次穿过平板（一次进入，一次射出）。设材料在感兴趣波长的吸收由吸收系数 $\\alpha$（单位为 $\\mathrm{cm}^{-1}$）表征，并假设任何菲涅耳反射因子和几何收集常数都与 $d$ 无关。\n\n从比尔-朗伯定律和反射率定义为出射与入射辐射功率之比出发，根据所述假设，推导反射率 $R(d)$ 作为 $d$ 和 $\\alpha$ 的函数表达式。然后，对于一种吸收系数为 $\\alpha = 100\\,\\mathrm{cm}^{-1}$ 的矿物，当其平均粒径从 $100\\,\\mu\\mathrm{m}$ 增加一倍至 $200\\,\\mu\\mathrm{m}$ 时，计算表示为比值 $R(200\\,\\mu\\mathrm{m})/R(100\\,\\mu\\mathrm{m})$ 的反射率变化。在代入数值时，请仔细考虑单位换算。将最终结果表示为一个无量纲数，并四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 系统是一个干燥的颗粒状矿物土壤，理想化为由均匀平面平行板组成的颗粒床。\n- 每个平板的厚度等于平均粒径 $d$。\n- 颗粒内部的散射可忽略不计。\n- 观测到的光子在颗粒的远端界面经历一次镜面反射。\n- 光子在颗粒内部的总路径长度是平板厚度的两倍。\n- 材料的吸收系数为 $\\alpha$，单位是 $\\mathrm{cm}^{-1}$。\n- 菲涅耳反射因子和几何收集常数与 $d$ 无关。\n- 任务是推导反射率 $R(d)$ 作为 $d$ 和 $\\alpha$ 的函数。\n- 第二个任务是计算当 $d_1 = 100\\,\\mu\\mathrm{m}$ 和 $d_2 = 200\\,\\mu\\mathrm{m}$ 时的比值 $R(d_2)/R(d_1)$。\n- 给定的吸收系数值为 $\\alpha = 100\\,\\mathrm{cm}^{-1}$。\n- 最终数值结果必须四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于吸收光谱学的基本原理——比尔-朗伯定律。该模型尽管简化（平面平行板，无散射），但是一个常见且有效的理想化模型，用于介绍颗粒介质中光子路径长度的概念，这也是行星遥感中更高级模型（如 Hapke 理论）的基石。对于吸收性材料，反射率随粒径增大而减小的前提是符合事实的。\n- **适定性：** 该问题提供了一套清晰的假设和足够的信息来推导所需的表达式并计算数值比。存在一个唯一、稳定且有意义的解。\n- **客观性：** 问题以精确、定量和无偏见的语言陈述。\n- **完整性和一致性：** 该问题是自洽的。假设（例如路径长度为 $2d$ 以及其他因素与 $d$ 无关）都已明确说明，并为求解创建了一个一致的框架。\n- **真实性：** 给定的粒径值（$100\\,\\mu\\mathrm{m}$ 到 $200\\,\\mu\\mathrm{m}$，对应于细沙）和吸收系数值（$\\alpha = 100\\,\\mathrm{cm}^{-1}$）对于近红外光谱范围内的矿物而言，在物理上是现实的。\n- **结论：** 该问题科学上合理，适定，且没有明显的缺陷或不一致之处。\n\n### 步骤3：结论与行动\n问题被认为是有效的。将提供解答。\n\n### 解答推导与计算\n该问题要求基于比尔-朗伯定律和一个简化的光与矿物颗粒相互作用的模型，推导反射率 $R(d)$ 的表达式。\n\n比尔-朗伯定律描述了辐射功率在穿过吸收介质时的衰减。辐射功率 $P(x)$ 在具有吸收系数 $\\alpha$ 的介质中传播距离 $x$ 后，由下式给出：\n$$P(x) = P_0 \\exp(-\\alpha x)$$\n其中 $P_0$ 是进入介质的初始辐射功率。\n\n根据问题陈述，对测量的反射率有贡献的光子两次穿过厚度为 $d$ 的颗粒（一次是进入到远端界面，一次是反射后射出）。因此，光在吸收介质中的总路径长度为 $x = 2d$。\n\n设 $P_{inc}$ 为传感器视场上的入射辐射功率，设 $P_{emerge}(d)$ 为被传感器收集的出射辐射功率。反射率定义为这两个量的比值：\n$$R(d) = \\frac{P_{emerge}(d)}{P_{inc}}$$\n\n对 $P_{emerge}(d)$ 有贡献的光子所经历的过程包括几个阶段：\n1. 入射光必须进入颗粒。\n2. 它传播距离 $d$ 到达远端界面，期间发生吸收。\n3. 它在远端界面发生镜面反射。\n4. 它传播距离 $d$ 返回到前端界面，期间进一步发生吸收。\n5. 它射出颗粒并被传感器收集。\n\n由于在总路径长度 $2d$ 上的吸收，辐射功率被因子 $\\exp(-\\alpha \\cdot 2d)$ 衰减。所有其他因素——例如最初进入颗粒的光的分数、远端界面的反射系数、射出颗粒的分数以及与收集效率相关的任何几何因素——都明确说明与粒径 $d$ 无关。我们可以将这些因素组合成一个单一的常数 $C_0$。\n因此，出射功率可以写为：\n$$P_{emerge}(d) = C_0 \\cdot P_{inc} \\cdot \\exp(-2\\alpha d)$$\n其中 $C_0$ 是一个无量纲比例常数，它包含了所有与 $d$ 无关的光学和几何效应。\n\n将此代入反射率的定义，我们得到：\n$$R(d) = \\frac{C_0 \\cdot P_{inc} \\cdot \\exp(-2\\alpha d)}{P_{inc}} = C_0 \\exp(-2\\alpha d)$$\n这就是所求的反射率作为 $d$ 和 $\\alpha$ 的函数表达式。\n\n接下来，我们必须计算比值 $\\frac{R(200\\,\\mu\\mathrm{m})}{R(100\\,\\mu\\mathrm{m})}$。设 $d_1 = 100\\,\\mu\\mathrm{m}$ 和 $d_2 = 200\\,\\mu\\mathrm{m}$。\n使用我们推导出的 $R(d)$ 表达式：\n$$R(d_1) = C_0 \\exp(-2\\alpha d_1)$$\n$$R(d_2) = C_0 \\exp(-2\\alpha d_2)$$\n该比值为：\n$$\\frac{R(d_2)}{R(d_1)} = \\frac{C_0 \\exp(-2\\alpha d_2)}{C_0 \\exp(-2\\alpha d_1)} = \\exp(-2\\alpha d_2 - (-2\\alpha d_1)) = \\exp(-2\\alpha(d_2-d_1))$$\n常数 $C_0$ 被消掉，正如预期。\n\n现在我们代入数值：\n$\\alpha = 100\\,\\mathrm{cm}^{-1}$\n$d_1 = 100\\,\\mu\\mathrm{m}$\n$d_2 = 200\\,\\mu\\mathrm{m}$\n\n乘积 $\\alpha d$ 必须是无量纲的，所以我们必须使用一致的单位。我们将粒径从微米 ($\\mu\\mathrm{m}$) 转换为厘米 ($\\mathrm{cm}$) 以匹配 $\\alpha$ 的单位。\n我们知道 $1\\,\\mathrm{cm} = 10^4\\,\\mu\\mathrm{m}$，或者 $1\\,\\mu\\mathrm{m} = 10^{-4}\\,\\mathrm{cm}$。\n$$d_1 = 100\\,\\mu\\mathrm{m} = 100 \\times 10^{-4}\\,\\mathrm{cm} = 1 \\times 10^{-2}\\,\\mathrm{cm}$$\n$$d_2 = 200\\,\\mu\\mathrm{m} = 200 \\times 10^{-4}\\,\\mathrm{cm} = 2 \\times 10^{-2}\\,\\mathrm{cm}$$\n路径长度的差值为：\n$$d_2 - d_1 = (2 \\times 10^{-2} - 1 \\times 10^{-2})\\,\\mathrm{cm} = 1 \\times 10^{-2}\\,\\mathrm{cm}$$\n现在，我们计算指数：\n$$-2\\alpha(d_2-d_1) = -2 \\cdot (100\\,\\mathrm{cm}^{-1}) \\cdot (1 \\times 10^{-2}\\,\\mathrm{cm}) = -2 \\cdot 100 \\cdot 10^{-2} = -2$$\n指数是无量纲的，符合要求。\n\n因此，反射率比值为：\n$$\\frac{R(200\\,\\mu\\mathrm{m})}{R(100\\,\\mu\\mathrm{m})} = \\exp(-2)$$\n计算数值并四舍五入到四位有效数字：\n$$\\exp(-2) \\approx 0.13533528...$$\n四舍五入到四位有效数字，结果是 $0.1353$。",
            "answer": "$$\\boxed{0.1353}$$"
        },
        {
            "introduction": "从理论模型转向实际应用，精确的野外测量构成了遥感科学的基石。本练习模拟了一个标准化的野外操作流程，即使用经过校准的参考板将被测物体的辐射亮度信号转换为其固有的地表反射率。这项实践不仅巩固了辐射度学原理，还引入了在任何定量科学中都至关重要的技能——不确定性传播。",
            "id": "3854199",
            "problem": "一台野外光谱辐射计被用于反演富铁土壤在波长 $\\lambda = 650\\,\\mathrm{nm}$ 处的双向反射因子，其方法是通过参考一个经过校准的漫反射板的测量值。该仪器在晴空条件下运行，观测和照明几何角度固定，对反射板和土壤使用的传感器积分时间和增益相同，并且大气路径贡献对于两次测量而言均可忽略且相同。假设表面足够接近朗伯体，以使比率法有效，且仪器响应是线性的。\n\n从朗伯表面在相同辐照度下出射辐亮度与反射率成正比这一观察出发，使用基本辐射度学关系推导如何从测量的辐亮度和一个已知的反射板反射率中获得土壤反射率 $R(\\lambda)$。然后根据以下测量和校准信息计算 $R(\\lambda)$：\n- 参考板在 $\\lambda$ 处的反射率：$R_{r}(\\lambda) = 0.500$，绝对不确定度为 $\\pm 0.010$。\n- 测得的参考板在 $\\lambda$ 处的辐亮度：$L_{r}(\\lambda) = 3.10 \\times 10^{-3}\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n- 测得的土壤在 $\\lambda$ 处的辐亮度：$L_{s}(\\lambda) = 1.27 \\times 10^{-3}\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n\n仅将 $R_{r}(\\lambda)$ 中给出的不确定度传播到反演出的 $R(\\lambda)$，并将 $L_{s}(\\lambda)$ 和 $L_{r}(\\lambda)$ 的不确定度视为可忽略。使用一阶不确定度传播。\n\n将最终结果以行矩阵的形式报告，其中包含土壤反射率及其在 $\\lambda$ 处的传播绝对不确定度，四舍五入到四位有效数字。将反射率表示为无量纲分数。",
            "solution": "目标是通过参考一个已校准的漫反射板来反演土壤反射率 $R(\\lambda)$，测量条件为相同的照明和观测几何角度，并使用线性响应的仪器。基本依据是朗伯反射体的辐射度学关系，该关系通过辐照度将辐亮度与反射率联系起来。对于一个在辐照度 $E(\\lambda)$ 下，反射率为 $R(\\lambda)$ 的朗伯表面，其在任何观测方向上的出射辐亮度 $L(\\lambda)$ 由下式给出：\n$$\nL(\\lambda) = \\frac{E(\\lambda)}{\\pi}\\,R(\\lambda).\n$$\n该关系源于朗伯表面的定义，其双向反射分布函数（BRDF）为常数且等于 $R(\\lambda)/\\pi$，从而得到 $L(\\lambda) = f_{r}(\\lambda)\\,E(\\lambda)$，其中 $f_{r}(\\lambda) = R(\\lambda)/\\pi$。\n\n在对土壤和参考板进行测量的几何与照明条件完全相同的情况下，辐照度 $E(\\lambda)$ 相同，并且由于仪器的线性响应，仪器因子在比率中被抵消。因此，对于土壤和参考板，我们有：\n$$\nL_{s}(\\lambda) = \\frac{E(\\lambda)}{\\pi}\\,R(\\lambda), \\qquad L_{r}(\\lambda) = \\frac{E(\\lambda)}{\\pi}\\,R_{r}(\\lambda).\n$$\n两式相除消去了 $E(\\lambda)$ 和 $\\pi$：\n$$\n\\frac{L_{s}(\\lambda)}{L_{r}(\\lambda)} = \\frac{R(\\lambda)}{R_{r}(\\lambda)}.\n$$\n解出土壤反射率可得：\n$$\nR(\\lambda) = \\frac{L_{s}(\\lambda)}{L_{r}(\\lambda)}\\,R_{r}(\\lambda).\n$$\n\n根据所提供的测量值，\n$$\nL_{s}(\\lambda) = 1.27 \\times 10^{-3}, \\qquad L_{r}(\\lambda) = 3.10 \\times 10^{-3},\n$$\n单位为 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$；其比值为：\n$$\n\\frac{L_{s}(\\lambda)}{L_{r}(\\lambda)} = \\frac{1.27 \\times 10^{-3}}{3.10 \\times 10^{-3}} = \\frac{1.27}{3.10} = \\frac{127}{310}.\n$$\n因此，\n$$\nR(\\lambda) = \\left(\\frac{127}{310}\\right) R_{r}(\\lambda).\n$$\n使用 $R_{r}(\\lambda) = 0.500$，\n$$\nR(\\lambda) = \\frac{127}{310} \\times 0.500 = \\frac{127}{620}.\n$$\n\n接下来，使用一阶不确定度传播方法，将 $R_{r}(\\lambda)$ 的不确定度传播到 $R(\\lambda)$。相对于反射板的不确定度，将 $L_{s}(\\lambda)$ 和 $L_{r}(\\lambda)$ 视为精确值。定义比例因子\n$$\na \\equiv \\frac{L_{s}(\\lambda)}{L_{r}(\\lambda)} = \\frac{127}{310}.\n$$\n反演得到的反射率为 $R(\\lambda) = a\\,R_{r}(\\lambda)$。对于 $y = a\\,x$，其中 $a$ 是常数，只有 $x$ 具有不确定性，标准不确定度按如下方式传播：\n$$\n\\sigma_{y} = |a|\\,\\sigma_{x}.\n$$\n在此，$\\sigma_{x} = \\sigma_{R_{r}} = 0.010$，因此\n$$\n\\sigma_{R} = \\left|\\frac{127}{310}\\right| \\times 0.010 = \\frac{127}{31000}.\n$$\n\n计算数值并将结果四舍五入至四位有效数字。土壤反射率为：\n$$\nR(\\lambda) = \\frac{127}{620} \\approx 0.2048387097 \\quad \\Rightarrow \\quad R(\\lambda) \\approx 0.2048 \\text{ (四位有效数字)}.\n$$\n传播的绝对不确定度为：\n$$\n\\sigma_{R} = \\frac{127}{31000} \\approx 0.004096774 \\quad \\Rightarrow \\quad \\sigma_{R} \\approx 0.004097 \\text{ (四位有效数字)}.\n$$\n\n按照要求，将土壤反射率及其在 $\\lambda$ 处的传播绝对不确定度以行矩阵的形式报告，矩阵元素为无量纲值，并四舍五入到四位有效数字。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.2048  0.004097 \\end{pmatrix}}$$"
        },
        {
            "introduction": "我们从微观到宏观之旅的最后一步，是从卫星的视角分析数据。卫星测量的是大气层顶（Top-of-Atmosphere, TOA）的辐射亮度，这是一个混合信号，包含了来自地球表面和大气本身的贡献。本实践将指导您完成大气校正的基本过程，应用辐射传输原理来解开大气效应的纠缠，从而反演得到真实的地表反射率。",
            "id": "3854178",
            "problem": "一位遥感分析师旨在通过应用基于物理的辐射传输关系，从大气层顶（TOA）辐亮度测量值中反演碳酸盐岩露头的地表反射率。任务是计算每个光谱波段的地表反射率，并评估其对大气透过率误差的敏感度。分析必须基于以下基本原理和定义：TOA辐亮度是大气路径辐亮度与经透过率衰减的离地辐亮度之和；对于朗伯体表面，离地辐亮度通过一个因子 $\\pi$ 与向下的辐照度相关联；地表的向下辐照度是地外太阳辐照度经太阳天顶角的余弦和向下大气透过率衰减后的结果。具体来说，使用以下基础：在给定光谱波段观测到的TOA辐亮度 $L_\\mathrm{TOA}$ 是大气路径辐亮度 $L_\\mathrm{path}$ 和经向上透过率 $T_\\uparrow$ 衰减的向上透射的离地辐亮度 $L_\\mathrm{surf}$ 之和，即 $L_\\mathrm{TOA} = L_\\mathrm{path} + T_\\uparrow L_\\mathrm{surf}$；对于朗伯体表面，离地辐亮度 $L_\\mathrm{surf}$ 通过 $L_\\mathrm{surf} = \\rho E_\\downarrow / \\pi$ 与向下辐照度 $E_\\downarrow$ 及地表反射率 $\\rho$ 相关联；向下辐照度为 $E_\\downarrow = E_0 \\cos(\\theta_0) T_\\downarrow$，其中 $E_0$ 是地外太阳辐照度，$\\theta_0$ 是太阳天顶角，而 $T_\\downarrow$ 是向下大气透过率。假设双向反射分布函数（BRDF）是各向同性的（朗伯体），忽略邻近效应和大气多次散射对地表的反馈。使用这些基础来推导从 $L_\\mathrm{TOA}$、$E_0$、$\\theta_0$、$T_\\downarrow$、$T_\\uparrow$ 和 $L_\\mathrm{path}$ 反演 $\\rho$ 的算法，并评估其对 $T_\\downarrow$ 和 $T_\\uparrow$ 中误差的敏感度。\n\n计算一个碳酸盐岩露头场景在代表可见光和短波红外的四个光谱波段的地表反射率，并评估反演得到的反射率对透过率中小偏差的敏感度。所有物理量必须使用其常规单位：$L_\\mathrm{TOA}$ 和 $L_\\mathrm{path}$ 的单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$，$E_0$ 的单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$，角度单位为度（在三角函数计算时需转换为弧度），反射率 $\\rho$ 是无量纲的，敏感度必须表示为小数（而非百分比）。\n\n对于敏感度评估，使用一阶微扰分析，考虑 $T_\\downarrow$ 和 $T_\\uparrow$ 中分别存在微小的绝对偏差 $\\delta_\\downarrow$ 和 $\\delta_\\uparrow$ 的情况，并报告当两个偏差同方向作用时 $\\rho$ 的绝对相对变化，每个测试案例计算为一个小数。\n\n实现一个程序，对于下述每个测试案例，返回每个波段反演的反射率列表，后跟敏感度小数。将所有测试案例的结果聚合到最终输出的单个扁平化列表中。\n\n使用以下测试套件，包含四个光谱波段，波长约为 $[0.55, 0.65, 0.86, 2.33]\\,\\mu\\mathrm{m}$：\n\n每个波段的通用地外太阳辐照度矢量（所有案例通用）：\n$E_0 = [1900.0, 1850.0, 1600.0, 250.0]$。\n\n测试案例1（理想路径，晴空，中等太阳天顶角）：\n- $L_\\mathrm{TOA} = [215.979943, 191.475069, 147.029243, 16.721288]$,\n- $L_\\mathrm{path} = [20.0, 18.0, 12.0, 5.0]$,\n- $\\theta_0 = 30.0$ 度,\n- $T_\\downarrow = 0.80$,\n- $T_\\uparrow = 0.85$,\n- $\\delta_\\downarrow = 0.01$,\n- $\\delta_\\uparrow = 0.01$。\n\n测试案例2（天底处的边界太阳天顶角，高透过率）：\n- $L_\\mathrm{TOA} = [327.153700, 293.073588, 232.564000, 25.865375]$,\n- $L_\\mathrm{path} = [10.0, 10.0, 10.0, 5.0]$,\n- $\\theta_0 = 0.0$ 度,\n- $T_\\downarrow = 0.95$,\n- $T_\\uparrow = 0.92$,\n- $\\delta_\\downarrow = 0.02$,\n- $\\delta_\\uparrow = 0.02$。\n\n测试案例3（边缘低太阳高度角，较低透过率，较大路径辐亮度）：\n- $L_\\mathrm{TOA} = [69.192725, 59.692125, 47.003600, 10.344063]$,\n- $L_\\mathrm{path} = [30.0, 25.0, 20.0, 8.0]$,\n- $\\theta_0 = 75.0$ 度,\n- $T_\\downarrow = 0.65$,\n- $T_\\uparrow = 0.70$,\n- $\\delta_\\downarrow = 0.03$,\n- $\\delta_\\uparrow = 0.03$。\n\n您的程序必须：\n- 对于每个测试案例，使用从所述基础物理关系推导出的公式，计算各波段的地表反射率 $\\rho$。\n- 对于每个测试案例，计算敏感度小数 $s = \\left|\\dfrac{\\delta_\\downarrow}{T_\\downarrow} + \\dfrac{\\delta_\\uparrow}{T_\\uparrow}\\right|$。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，排序如下：测试案例1的四个反射率值后跟其$s$值，测试案例2的四个反射率值后跟其$s$值，测试案例3的四个反射率值后跟其$s$值。所有输出均为无量纲浮点数。\n- 程序不应打印任何其他文本或格式。",
            "solution": "目标是从大气层顶（TOA）辐亮度测量值中计算一系列光谱波段的地表反射率 $\\rho$，并量化此反演反射率对大气透过率值不确定性的敏感度。解决方案包括两个主要步骤：首先，从基本辐射传输原理推导出 $\\rho$ 的解析表达式；其次，应用一阶误差传播来确定敏感度。\n\n问题提供了以下一组方程，用于描述简化的平面平行大气，假设地表为朗伯体并忽略邻近效应：\n1. TOA辐亮度 $L_\\mathrm{TOA}$ 是大气路径辐亮度 $L_\\mathrm{path}$ 与经向上大气透过率 $T_\\uparrow$ 衰减的离地辐亮度 $L_\\mathrm{surf}$ 之和：\n$$L_\\mathrm{TOA} = L_\\mathrm{path} + T_\\uparrow L_\\mathrm{surf}$$\n2. 对于朗伯体表面，离地辐亮度与地表反射率 $\\rho$ 及地表总向下辐照度 $E_\\downarrow$ 的关系如下：\n$$L_\\mathrm{surf} = \\frac{\\rho E_\\downarrow}{\\pi}$$\n3. 地表的向下辐照度是地外太阳辐照度 $E_0$ 经太阳天顶角 $\\theta_0$ 的余弦和向下大气透过率 $T_\\downarrow$ 衰减后的结果：\n$$E_\\downarrow = E_0 \\cos(\\theta_0) T_\\downarrow$$\n\n为了推导反演 $\\rho$ 的算法，我们必须对这些方程进行代数组合。\n\n首先，我们对方程（1）进行变形，以分离出离地辐亮度项 $L_\\mathrm{surf}$：\n$$L_\\mathrm{surf} = \\frac{L_\\mathrm{TOA} - L_\\mathrm{path}}{T_\\uparrow}$$\n该方程通过校正加性大气路径辐亮度和乘性向上透过率，来估算源自地表的辐亮度。\n\n接下来，我们将此 $L_\\mathrm{surf}$ 的表达式代入方程（2）：\n$$\\frac{L_\\mathrm{TOA} - L_\\mathrm{path}}{T_\\uparrow} = \\frac{\\rho E_\\downarrow}{\\pi}$$\n\n然后，我们将方程（3）中 $E_\\downarrow$ 的表达式代入上述关系式：\n$$\\frac{L_\\mathrm{TOA} - L_\\mathrm{path}}{T_\\uparrow} = \\frac{\\rho (E_0 \\cos(\\theta_0) T_\\downarrow)}{\\pi}$$\n\n最后，我们整理该方程以求解地表反射率 $\\rho$：\n$$\\rho = \\frac{\\pi (L_\\mathrm{TOA} - L_\\mathrm{path})}{T_\\uparrow T_\\downarrow E_0 \\cos(\\theta_0)}$$\n这就是将用于计算每个光谱波段 $\\rho$ 的最终解析表达式。在实现时，给定的太阳天顶角 $\\theta_0$（单位为度）必须在应用余弦函数前转换为弧度。\n\n任务的第二部分是评估反演的反射率 $\\rho$ 对向下和向上透过率 $T_\\downarrow$ 和 $T_\\uparrow$ 中微小绝对偏差 $\\delta_\\downarrow$ 和 $\\delta_\\uparrow$ 的敏感度。敏感度指标 $s$ 定义为 $\\rho$ 的绝对相对变化。我们使用一阶微扰分析。将 $\\rho$ 视为 $T_\\downarrow$ 和 $T_\\uparrow$ 的函数，我们可以写为 $\\rho(T_\\downarrow, T_\\uparrow) = K \\cdot (T_\\downarrow T_\\uparrow)^{-1}$，其中 $K = \\frac{\\pi (L_\\mathrm{TOA} - L_\\mathrm{path})}{E_0 \\cos(\\theta_0)}$ 是一个相对于透过率的常数项。\n\n使用 $\\rho$ 的全微分来近似由微小变化 $\\delta_\\downarrow$ 和 $\\delta_\\uparrow$ 引起的 $\\rho$ 的变化（记为 $\\delta \\rho$）：\n$$\\delta\\rho \\approx \\frac{\\partial\\rho}{\\partial T_\\downarrow}\\delta_\\downarrow + \\frac{\\partial\\rho}{\\partial T_\\uparrow}\\delta_\\uparrow$$\n所需的偏导数是：\n$$\\frac{\\partial\\rho}{\\partial T_\\downarrow} = -K (T_\\downarrow^{-2} T_\\uparrow^{-1}) = -\\frac{K}{T_\\downarrow^2 T_\\uparrow} = -\\frac{\\rho}{T_\\downarrow}$$\n$$\\frac{\\partial\\rho}{\\partial T_\\uparrow} = -K (T_\\downarrow^{-1} T_\\uparrow^{-2}) = -\\frac{K}{T_\\downarrow T_\\uparrow^2} = -\\frac{\\rho}{T_\\uparrow}$$\n将这些偏导数代回到 $\\delta\\rho$ 的表达式中：\n$$\\delta\\rho \\approx \\left(-\\frac{\\rho}{T_\\downarrow}\\right)\\delta_\\downarrow + \\left(-\\frac{\\rho}{T_\\uparrow}\\right)\\delta_\\uparrow = -\\rho\\left(\\frac{\\delta_\\downarrow}{T_\\downarrow} + \\frac{\\delta_\\uparrow}{T_\\uparrow}\\right)$$\n因此，反射率的相对变化 $\\frac{\\delta\\rho}{\\rho}$ 为：\n$$\\frac{\\delta\\rho}{\\rho} \\approx -\\left(\\frac{\\delta_\\downarrow}{T_\\downarrow} + \\frac{\\delta_\\uparrow}{T_\\uparrow}\\right)$$\n问题将敏感度 $s$ 定义为该相对变化的绝对值：\n$$s = \\left|\\frac{\\delta\\rho}{\\rho}\\right| = \\left| -\\left(\\frac{\\delta_\\downarrow}{T_\\downarrow} + \\frac{\\delta_\\uparrow}{T_\\uparrow}\\right) \\right| = \\left|\\frac{\\delta_\\downarrow}{T_\\downarrow} + \\frac{\\delta_\\uparrow}{T_\\uparrow}\\right|$$\n这证实了问题陈述中提供的敏感度公式的有效性。由于所有透过率和偏差值均为正数，该公式可简化为 $s = \\frac{\\delta_\\downarrow}{T_\\downarrow} + \\frac{\\delta_\\uparrow}{T_\\uparrow}$。\n\n实现将把这些推导出的公式应用于所提供的测试案例。对于每个案例，通过对输入数组执行矢量化操作来计算每个波段的反射率。敏感度作为每个测试案例的单个标量值进行计算，因为在给定案例中，透过率值在所有波段上是恒定的。然后，将所有测试案例的结果（每个案例包含四个反射率值和一个敏感度值）聚合成一个单一的扁平化列表作为最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes surface reflectance and its sensitivity to transmittance errors\n    for given remote sensing parameters.\n    \"\"\"\n    # Common extraterrestrial solar irradiance vector per band.\n    E0 = np.array([1900.0, 1850.0, 1600.0, 250.0])\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"L_toa\": np.array([215.979943, 191.475069, 147.029243, 16.721288]),\n            \"L_path\": np.array([20.0, 18.0, 12.0, 5.0]),\n            \"theta0_deg\": 30.0,\n            \"T_down\": 0.80,\n            \"T_up\": 0.85,\n            \"delta_down\": 0.01,\n            \"delta_up\": 0.01,\n        },\n        {\n            \"L_toa\": np.array([327.153700, 293.073588, 232.564000, 25.865375]),\n            \"L_path\": np.array([10.0, 10.0, 10.0, 5.0]),\n            \"theta0_deg\": 0.0,\n            \"T_down\": 0.95,\n            \"T_up\": 0.92,\n            \"delta_down\": 0.02,\n            \"delta_up\": 0.02,\n        },\n        {\n            \"L_toa\": np.array([69.192725, 59.692125, 47.003600, 10.344063]),\n            \"L_path\": np.array([30.0, 25.0, 20.0, 8.0]),\n            \"theta0_deg\": 75.0,\n            \"T_down\": 0.65,\n            \"T_up\": 0.70,\n            \"delta_down\": 0.03,\n            \"delta_up\": 0.03,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract parameters for the current case\n        L_toa = case[\"L_toa\"]\n        L_path = case[\"L_path\"]\n        theta0_deg = case[\"theta0_deg\"]\n        T_down = case[\"T_down\"]\n        T_up = case[\"T_up\"]\n        delta_down = case[\"delta_down\"]\n        delta_up = case[\"delta_up\"]\n\n        # --- Reflectance Calculation ---\n        # Convert solar zenith angle from degrees to radians\n        theta0_rad = np.deg2rad(theta0_deg)\n        cos_theta0 = np.cos(theta0_rad)\n\n        # Calculate the numerator of the reflectance equation\n        # Numerator = pi * (L_TOA - L_path)\n        numerator = np.pi * (L_toa - L_path)\n\n        # Calculate the denominator of the reflectance equation\n        # Denominator = T_up * T_down * E0 * cos(theta0)\n        denominator = T_up * T_down * E0 * cos_theta0\n\n        # Compute bandwise surface reflectance\n        rho = numerator / denominator\n        \n        # --- Sensitivity Calculation ---\n        # s = |delta_down/T_down + delta_up/T_up|\n        # Since all values are positive, abs() is formally correct but not strictly necessary here.\n        sensitivity = abs((delta_down / T_down) + (delta_up / T_up))\n        \n        # Aggregate results for this case into a flat list\n        case_results = list(rho)\n        case_results.append(sensitivity)\n        results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}