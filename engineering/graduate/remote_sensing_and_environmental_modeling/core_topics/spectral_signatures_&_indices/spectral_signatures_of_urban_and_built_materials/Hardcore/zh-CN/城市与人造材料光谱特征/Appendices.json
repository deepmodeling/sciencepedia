{
    "hands_on_practices": [
        {
            "introduction": "遥感传感器无法记录地物完整的连续光谱，而是通过其光谱响应函数（SRF）对特定波段内的光谱信息进行积分。本练习将通过一个解析计算，带您实践如何从一个给定的材料连续光谱反射率模型和简化的传感器SRF，推导出传感器最终记录的波段平均反射率。掌握这一基本原理是理解和模拟传感器响应、以及连接地物物理属性与遥感数据的关键第一步。",
            "id": "3854653",
            "problem": "一个针对城市地表的垂直观测多光谱成像光谱辐射计记录了可见光区域和短波红外（SWIR）区域的波段。对于光谱均匀的光照和朗伯（Lambertian）混凝土表面，每个波段的波段平均反射率定义为地表反射光谱在该波段支撑域上的光谱响应加权平均值。考虑一个假设的混凝土反射光谱 $R(\\lambda)$，由下式给出\n$$\nR(\\lambda) = r_{0} + m\\,\\frac{\\lambda - 560}{1000} - \\beta\\,S_{\\mathrm{SWIR2}}(\\lambda),\n$$\n其中，$\\lambda$ 是以纳米为单位的波长，$r_{0}$ 和 $m$ 是表征基线可见光反射率和干燥混凝土典型的向红外缓慢上升特性的常数，而 $\\beta\\,S_{\\mathrm{SWIR2}}(\\lambda)$ 通过SWIR2波段的光谱响应函数编码了在 $2.2\\,\\mu\\mathrm{m}$ 附近的含羟基粘土吸收特征。该仪器有三个波段，其光谱响应函数定义为对称三角形函数：\n- 绿光（Green）波段，中心位于 $c_{\\mathrm{G}} = 560$ nm，完整支撑域为 $[520, 600]$ nm，\n$$\nS_{\\mathrm{G}}(\\lambda) = \\begin{cases}\n1 - \\dfrac{|\\lambda - 560|}{40},  520 \\le \\lambda \\le 600 \\\\\n0,  \\text{其他情况}\n\\end{cases}\n$$\n- SWIR1波段，中心位于 $c_{\\mathrm{SWIR1}} = 1650$ nm，完整支撑域为 $[1550, 1750]$ nm，\n$$\nS_{\\mathrm{SWIR1}}(\\lambda) = \\begin{cases}\n1 - \\dfrac{|\\lambda - 1650|}{100},  1550 \\le \\lambda \\le 1750 \\\\\n0,  \\text{其他情况}\n\\end{cases}\n$$\n- SWIR2波段，中心位于 $c_{\\mathrm{SWIR2}} = 2200$ nm，完整支撑域为 $[2100, 2300]$ nm，\n$$\nS_{\\mathrm{SWIR2}}(\\lambda) = \\begin{cases}\n1 - \\dfrac{|\\lambda - 2200|}{100},  2100 \\le \\lambda \\le 2300 \\\\\n0,  \\text{其他情况}\n\\end{cases}\n$$\n使用 $r_{0} = 0.32$，$m = 0.09$ 和 $\\beta = 0.09$。根据所述定义，计算每个波段（绿光、SWIR1、SWIR2）的波段平均反射率。将最终反射率表示为无单位小数，并将答案四舍五入到四位有效数字。",
            "solution": "用户希望我在验证其前提后解决一个遥感问题。\n\n### 问题验证\n\n#### 第一步：提取已知条件\n\n1.  **定义**：波段平均反射率 $\\bar{R}$ 是地表反射光谱 $R(\\lambda)$ 在波段支撑域上的光谱响应加权平均值。\n2.  **反射光谱**：\n    $$\n    R(\\lambda) = r_{0} + m\\,\\frac{\\lambda - 560}{1000} - \\beta\\,S_{\\mathrm{SWIR2}}(\\lambda)\n    $$\n    其中 $\\lambda$ 是以纳米为单位的波长。\n3.  **常数**：\n    -   $r_{0} = 0.32$\n    -   $m = 0.09$\n    -   $\\beta = 0.09$\n4.  **光谱响应函数 ($S_i(\\lambda)$)**：\n    -   **绿光 (G)**：中心位于 $c_{\\mathrm{G}} = 560$ nm，支撑域 $[520, 600]$ nm。\n        $$\n        S_{\\mathrm{G}}(\\lambda) = 1 - \\dfrac{|\\lambda - 560|}{40}, \\quad \\lambda \\in [520, 600]\n        $$\n    -   **SWIR1**：中心位于 $c_{\\mathrm{SWIR1}} = 1650$ nm，支撑域 $[1550, 1750]$ nm。\n        $$\n        S_{\\mathrm{SWIR1}}(\\lambda) = 1 - \\dfrac{|\\lambda - 1650|}{100}, \\quad \\lambda \\in [1550, 1750]\n        $$\n    -   **SWIR2**：中心位于 $c_{\\mathrm{SWIR2}} = 2200$ nm，支撑域 $[2100, 2300]$ nm。\n        $$\n        S_{\\mathrm{SWIR2}}(\\lambda) = 1 - \\dfrac{|\\lambda - 2200|}{100}, \\quad \\lambda \\in [2100, 2300]\n        $$\n5.  **任务**：计算绿光、SWIR1和SWIR2波段的波段平均反射率。\n6.  **格式要求**：将最终答案四舍五入到四位有效数字。\n\n#### 第二步：使用提取的已知条件进行验证\n\n-   **科学依据**：该问题在光学遥感和光谱学原理上有坚实的基础。波段平均反射率的概念是标准的。混凝土的反射率模型 $R(\\lambda)$ 是一个合理的简化，代表了恒定的基线 ($r_0$)、在可见光到红外范围内线性增加（$m$ 项），以及一个特定的吸收特征（$\\beta\\,S_{\\mathrm{SWIR2}}(\\lambda)$ 项）。在 $2.2\\,\\mu\\mathrm{m}$（或 $2200\\,$nm）附近的吸收特征是含有羟基（OH）基团的矿物的特征，这些矿物存在于混凝土的水化水泥相中。使用对称三角形光谱响应函数是仪器建模中常见且有效的简化方法。\n-   **适定性**：该问题在数学上是适定的。“光谱响应加权平均值”由加权平均的公式明确定义，该公式涉及积分。所有函数（$R(\\lambda)$ 和 $S_i(\\lambda)$）在指定域上都是分段连续且可积的。该问题提供了计算每个波段唯一解所需的所有数据和常数。\n-   **客观性**：该问题以客观的数学语言陈述，没有歧义或主观论断。\n\n该问题没有表现出验证标准中列出的任何缺陷。它是科学合理的、适定的和客观的。\n\n#### 第三步：结论与行动\n\n该问题是**有效的**。我将继续进行解答。\n\n### 解题过程\n\n对于波段 $i$，其波段平均反射率（记为 $\\bar{R}_i$）是地表反射光谱 $R(\\lambda)$ 的光谱响应加权平均值。其计算公式为：\n$$\n\\bar{R}_i = \\frac{\\int_{-\\infty}^{\\infty} R(\\lambda) S_i(\\lambda) d\\lambda}{\\int_{-\\infty}^{\\infty} S_i(\\lambda) d\\lambda}\n$$\n积分仅在光谱响应函数 $S_i(\\lambda)$ 的支撑域上非零。设 $A_i = \\int S_i(\\lambda) d\\lambda$ 为响应函数下的面积。函数 $S_i(\\lambda)$ 是高度为 $h=1$、底宽为 $w_i$ 的三角形。其面积为 $A_i = \\frac{1}{2} w_i h = \\frac{1}{2} w_i$。\n\n我们来计算每个波段的面积：\n-   **绿光 (G)**：$w_{\\mathrm{G}} = 600 - 520 = 80\\,$nm。$A_{\\mathrm{G}} = \\frac{1}{2}(80) = 40$。\n-   **SWIR1**：$w_{\\mathrm{SWIR1}} = 1750 - 1550 = 200\\,$nm。$A_{\\mathrm{SWIR1}} = \\frac{1}{2}(200) = 100$。\n-   **SWIR2**：$w_{\\mathrm{SWIR2}} = 2300 - 2100 = 200\\,$nm。$A_{\\mathrm{SWIR2}} = \\frac{1}{2}(200) = 100$。\n\n反射光谱为 $R(\\lambda) = r_{0} + m\\frac{\\lambda - 560}{1000} - \\beta\\,S_{\\mathrm{SWIR2}}(\\lambda)$，其中 $r_0=0.32$, $m=0.09$, $\\beta=0.09$。\n$$\nR(\\lambda) = 0.32 + 0.09\\left(\\frac{\\lambda - 560}{1000}\\right) - 0.09\\,S_{\\mathrm{SWIR2}}(\\lambda)\n$$\n\n我们将使用一个关键性质：对于线性函数 $f(\\lambda) = a + b\\lambda$ 和一个关于中心点 $c$ 对称的权重函数 $W(\\lambda)$，其加权平均值就是该线性函数在中心点的值：$\\bar{f} = f(c)$。\n\n**1. 绿光波段反射率 ($\\bar{R}_{\\mathrm{G}}$)**\n\n$S_{\\mathrm{G}}(\\lambda)$ 的支撑域是 $[520, 600]\\,$nm。在此区间内，未进入 $S_{\\mathrm{SWIR2}}(\\lambda)$ 的支撑域，因此 $S_{\\mathrm{SWIR2}}(\\lambda) = 0$。反射光谱简化为：\n$$\nR(\\lambda) = 0.32 + 0.09\\left(\\frac{\\lambda - 560}{1000}\\right)\n$$\n这是关于 $\\lambda$ 的线性函数。光谱响应函数 $S_{\\mathrm{G}}(\\lambda)$ 关于其中心 $c_{\\mathrm{G}} = 560\\,$nm 对称。因此，波段平均反射率是 $R(\\lambda)$ 在 $\\lambda = c_{\\mathrm{G}} = 560\\,$nm 处的值。\n$$\n\\bar{R}_{\\mathrm{G}} = R(560) = 0.32 + 0.09\\left(\\frac{560 - 560}{1000}\\right) - 0 = 0.32\n$$\n四舍五入到四位有效数字，$\\bar{R}_{\\mathrm{G}} = 0.3200$。\n\n**2. SWIR1波段反射率 ($\\bar{R}_{\\mathrm{SWIR1}}$)**\n\n$S_{\\mathrm{SWIR1}}(\\lambda)$ 的支撑域是 $[1550, 1750]\\,$nm。在此区间内，同样有 $S_{\\mathrm{SWIR2}}(\\lambda) = 0$。反射光谱同样是线性函数：\n$$\nR(\\lambda) = 0.32 + 0.09\\left(\\frac{\\lambda - 560}{1000}\\right)\n$$\n光谱响应函数 $S_{\\mathrm{SWIR1}}(\\lambda)$ 关于其中心 $c_{\\mathrm{SWIR1}} = 1650\\,$nm 对称。波段平均反射率是 $R(\\lambda)$ 在 $\\lambda = c_{\\mathrm{SWIR1}} = 1650\\,$nm 处的值。\n$$\n\\bar{R}_{\\mathrm{SWIR1}} = R(1650) = 0.32 + 0.09\\left(\\frac{1650 - 560}{1000}\\right) = 0.32 + 0.09\\left(\\frac{1090}{1000}\\right)\n$$\n$$\n\\bar{R}_{\\mathrm{SWIR1}} = 0.32 + 0.09 \\times 1.09 = 0.32 + 0.0981 = 0.4181\n$$\n这个值已经有四位有效数字。\n\n**3. SWIR2波段反射率 ($\\bar{R}_{\\mathrm{SWIR2}}$)**\n\n支撑域是 $[2100, 2300]\\,$nm，这与 $S_{\\mathrm{SWIR2}}(\\lambda)$ 的支撑域相同。\n$$\n\\bar{R}_{\\mathrm{SWIR2}} = \\frac{1}{A_{\\mathrm{SWIR2}}} \\int_{2100}^{2300} R(\\lambda) S_{\\mathrm{SWIR2}}(\\lambda) d\\lambda\n$$\n代入 $R(\\lambda)$ 的完整表达式：\n$$\n\\bar{R}_{\\mathrm{SWIR2}} = \\frac{1}{A_{\\mathrm{SWIR2}}} \\int_{2100}^{2300} \\left[ 0.32 + 0.09\\left(\\frac{\\lambda - 560}{1000}\\right) - 0.09\\,S_{\\mathrm{SWIR2}}(\\lambda) \\right] S_{\\mathrm{SWIR2}}(\\lambda) d\\lambda\n$$\n我们可以将积分分成两部分：\n$$\n\\bar{R}_{\\mathrm{SWIR2}} = \\frac{\\int_{2100}^{2300} \\left( 0.32 + 0.09\\frac{\\lambda - 560}{1000} \\right) S_{\\mathrm{SWIR2}}(\\lambda) d\\lambda}{A_{\\mathrm{SWIR2}}} - \\frac{\\int_{2100}^{2300} 0.09\\left(S_{\\mathrm{SWIR2}}(\\lambda)\\right)^2 d\\lambda}{A_{\\mathrm{SWIR2}}}\n$$\n第一项是反射率线性部分 $R_{\\mathrm{lin}}(\\lambda) = 0.32 + 0.09\\frac{\\lambda-560}{1000}$ 在以 $c_{\\mathrm{SWIR2}} = 2200\\,$nm 为中心的对称响应函数 $S_{\\mathrm{SWIR2}}(\\lambda)$ 上的加权平均值。其结果为 $R_{\\mathrm{lin}}(2200)$：\n$$\nR_{\\mathrm{lin}}(2200) = 0.32 + 0.09\\left(\\frac{2200 - 560}{1000}\\right) = 0.32 + 0.09\\left(\\frac{1640}{1000}\\right) = 0.32 + 0.09 \\times 1.64 = 0.32 + 0.1476 = 0.4676\n$$\n第二项需要计算 $\\int (S_{\\mathrm{SWIR2}}(\\lambda))^2 d\\lambda$。令 $u = \\lambda - 2200$，则 $d\\lambda = du$。积分范围变为 $[-100, 100]$。\n$$\nS_{\\mathrm{SWIR2}}(\\lambda) \\to 1 - \\frac{|u|}{100}\n$$\n$$\n\\int_{2100}^{2300} (S_{\\mathrm{SWIR2}}(\\lambda))^2 d\\lambda = \\int_{-100}^{100} \\left(1 - \\frac{|u|}{100}\\right)^2 du = 2 \\int_{0}^{100} \\left(1 - \\frac{u}{100}\\right)^2 du\n$$\n$$\n= 2 \\int_{0}^{100} \\left(1 - \\frac{2u}{100} + \\frac{u^2}{10000}\\right) du = 2 \\left[ u - \\frac{u^2}{100} + \\frac{u^3}{30000} \\right]_0^{100}\n$$\n$$\n= 2 \\left( 100 - \\frac{100^2}{100} + \\frac{100^3}{30000} \\right) = 2 \\left( 100 - 100 + \\frac{1000000}{30000} \\right) = 2 \\left( \\frac{100}{3} \\right) = \\frac{200}{3}\n$$\n$\\bar{R}_{\\mathrm{SWIR2}}$ 的第二项是：\n$$\n- \\frac{0.09 \\times \\frac{200}{3}}{A_{\\mathrm{SWIR2}}} = - \\frac{0.09 \\times \\frac{200}{3}}{100} = - 0.09 \\times \\frac{2}{3} = -0.03 \\times 2 = -0.06\n$$\n合并 $\\bar{R}_{\\mathrm{SWIR2}}$ 的两项：\n$$\n\\bar{R}_{\\mathrm{SWIR2}} = 0.4676 - 0.06 = 0.4076\n$$\n这个值有四位有效数字。\n\n最终的波段平均反射率是：\n-   绿光：$\\bar{R}_{\\mathrm{G}} = 0.3200$\n-   SWIR1：$\\bar{R}_{\\mathrm{SWIR1}} = 0.4181$\n-   SWIR2：$\\bar{R}_{\\mathrm{SWIR2}} = 0.4076$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.3200  0.4181  0.4076 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在理论计算的基础上，实际的遥感应用常常需要将高分辨率的实验室光谱数据转换为卫星传感器的波段等效观测值。本练习要求您通过编写代码，将上一练习中的解析概念应用于数值计算，模拟从实验室测量的混凝土光谱到卫星波段反射率的转换过程。这项实践模拟了遥感定标与验证（cal/val）中的核心任务，让您深入理解理论与实际数据产品之间的桥梁。",
            "id": "3854629",
            "problem": "一颗卫星仪器使用由光谱响应函数（Spectral Response Function, SRF）定义的波段积分测量来观测城市地表，而实验室测量则提供了混凝土作为波长函数的高分辨率光谱反射率。从第一性原理出发，一个无源光学传感器在太阳天顶角为 $\\,\\theta\\,$、地外太阳辐照度为 $\\,E_0(\\lambda)\\,$ 的条件下，观测一个光谱反射率为 $\\,\\rho(\\lambda)\\,$ 的朗伯表面的辐射率 $\\,L(\\lambda)\\,$ 关系为 $\\,L(\\lambda) = \\frac{E_0(\\lambda)\\cos\\theta}{\\pi}\\,\\rho(\\lambda)\\,$。仪器的SRF $\\,S_b(\\lambda)\\,$ 决定了波段积分测量值。一个大气校正算法为每个波段输出地表反射率。您的任务是利用实验室光谱和传感器的SRF来模拟混凝土的预期波段反射率，然后将这些模拟结果与观测到的、经大气校正的波段反射率进行比较，以评估各波段的偏差。\n\n您必须使用从辐射测量方程推导出的、物理上一致的SRF加权波段平均法来设计您的计算。您必须通过对波长进行数值积分来获得波段平均量。离散化必须实现为采用适当数值求积的黎曼积分近似。所有波长必须以纳米（nm）为单位处理，反射率必须作为无量纲小数处理。偏差必须以无量纲小数报告。所有报告的偏差都应四舍五入到小数点后四位。\n\n请使用以下科学上合理且自洽的输入：\n\n- 波长采样网格：从 $\\,400\\,$ nm到 $\\,1000\\,$ nm（含），步长为 $\\,1\\,$ nm。\n- 实验室混凝土光谱 $\\,\\rho_{\\text{lab}}(\\lambda)\\,$ 被指定为一个平滑、缓增的基线，并带有一个与水化相关的吸收特征：\n  1. 基线：$\\,\\rho_{\\text{base}}(\\lambda) = 0.30 + 0.0004\\,(\\lambda - 400)\\,$。\n  2. 在 $\\,850\\,$ nm附近的吸收谷：减去一个振幅为 $\\,0.04\\,$、标准差为 $\\,25\\,$ nm、中心位于 $\\,850\\,$ nm的高斯特征，即 $\\,\\rho_{\\text{lab}}(\\lambda) = \\rho_{\\text{base}}(\\lambda) - 0.04\\,\\exp\\!\\big(-\\tfrac{1}{2}\\big(\\tfrac{\\lambda-850}{25}\\big)^2\\big)\\,$。构建后，将 $\\,\\rho_{\\text{lab}}(\\lambda)\\,$ 裁剪到区间 $[0,1]$ 内。\n- 传感器SRF为高斯函数，由中心波长 $\\,c_b\\,$ 和半峰全宽（FWHM）$\\,\\text{FWHM}_b\\,$ 表征。高斯SRF为 $\\,S_b(\\lambda) = \\exp\\!\\big(-\\tfrac{1}{2}\\big(\\tfrac{\\lambda-c_b}{\\sigma_b}\\big)^2\\big)\\,$，其中 $\\,\\sigma_b = \\tfrac{\\text{FWHM}_b}{2\\sqrt{2\\ln 2}}\\,$。使用以下基线波段：\n  - 蓝色：$\\,c_{\\text{B}} = 490\\,$ nm, $\\,\\text{FWHM}_{\\text{B}} = 65\\,$ nm。\n  - 绿色：$\\,c_{\\text{G}} = 560\\,$ nm, $\\,\\text{FWHM}_{\\text{G}} = 35\\,$ nm。\n  - 红色：$\\,c_{\\text{R}} = 665\\,$ nm, $\\,\\text{FWHM}_{\\text{R}} = 30\\,$ nm。\n  - 近红外（NIR）：$\\,c_{\\text{NIR}} = 842\\,$ nm, $\\,\\text{FWHM}_{\\text{NIR}} = 115\\,$ nm。\n- 用于与模拟进行比较的、观测到的、经大气校正的波段反射率，分为三个测试用例：\n  1. 测试用例 $\\,1\\,$（理想路径）：对于 $[\\text{蓝色},\\,\\text{绿色},\\,\\text{红色},\\,\\text{NIR}]$，其值为 $[0.345,\\,0.375,\\,0.405,\\,0.465]$。\n  2. 测试用例 $\\,2\\,$（边界条件——窄红光SRF）：观测反射率与测试用例 $\\,1\\,$ 相同，但红色波段为 $\\,0.400\\,$；在此测试中，将红色SRF的FWHM替换为 $\\,5\\,$ nm，其他波段保持不变。\n  3. 测试用例 $\\,3\\,$（边缘情况——由于过度校正，蓝色波段观测到轻微负值）：对于 $[\\text{蓝色},\\,\\text{绿色},\\,\\text{红色},\\,\\text{NIR}]$，其值为 $[-0.005,\\,0.370,\\,0.410,\\,0.470]$，使用基线SRF。\n\n从辐射测量关系和SRF加权波段积分的定义出发，推导出合适的反射率波段平均表达式，并在给定的波长网格上进行数值实现。对于每个测试用例，计算模拟的波段反射率，然后计算每个波段 $\\,b\\,$ 的偏差，定义为 $\\,\\text{bias}_b = R_{\\text{obs},b} - R_{\\text{sim},b}\\,$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个元素对应一个测试用例，本身是一个按波段顺序 $[\\text{蓝色},\\,\\text{绿色},\\,\\text{红色},\\,\\text{NIR}]$ 排列的各波段偏差列表，每个偏差都四舍五入到小数点后四位。例如，格式必须为 $[[b_{\\text{B},1},b_{\\text{G},1},b_{\\text{R},1},b_{\\text{NIR},1}],[b_{\\text{B},2},\\dots],[b_{\\text{B},3},\\dots]]$，其中所有 $\\,b\\,$ 均为无量纲小数。",
            "solution": "用户提供的问题已经过分析并被确定为有效。该问题科学地基于光学遥感原理，问题设定良好，具有一套完整且一致的参数，并且表述客观。该问题要求推导和实现一个波段平均方案，以根据高分辨率的实验室光谱模拟卫星传感器的测量值，这是传感器定标/验证和光谱分析中的标准流程。\n\n对于给定的波段 $b$，模拟的波段平均地表反射率（表示为 $R_{\\text{sim},b}$）的推导始于波段积分测量的基本原理。传感器在波段 $b$ 测得的辐射率 $L_b$ 是传感器处的光谱辐射率 $L(\\lambda)$ 按传感器的光谱响应函数（SRF）$S_b(\\lambda)$ 加权后的积分：\n$$\nL_b = \\int_{0}^{\\infty} L(\\lambda) S_b(\\lambda) \\,d\\lambda\n$$\n问题指出，对于朗伯表面，离开目标的地表光谱辐射率是 $L_{\\text{surf}}(\\lambda) = \\frac{E_g(\\lambda)}{\\pi} \\rho(\\lambda)$，其中 $E_g(\\lambda)$ 是入射到地表的全局太阳辐照度，$\\rho(\\lambda)$ 是光谱反射率。大气校正算法旨在从传感器处的辐射率中反演出地表反射率。模拟的波段反射率是从实验室光谱 $\\rho_{\\text{lab}}(\\lambda)$ 计算出的有效反射率，假设它代表被观测的地表。\n\n波段平均反射率 $R_b$ 的定义是满足以下关系的值，该关系将光谱变化表面的波段积分辐射率与一个具有反射率 $R_b$ 的理想化、光谱平坦表面的波段积分辐射率联系起来：\n$$\n\\int \\frac{E_g(\\lambda)}{\\pi} \\rho_{\\text{lab}}(\\lambda) S_b(\\lambda) \\,d\\lambda = R_b \\int \\frac{E_g(\\lambda)}{\\pi} S_b(\\lambda) \\,d\\lambda\n$$\n解出 $R_b$ 可得：\n$$\nR_b = \\frac{\\int E_g(\\lambda) \\rho_{\\text{lab}}(\\lambda) S_b(\\lambda) \\,d\\lambda}{\\int E_g(\\lambda) S_b(\\lambda) \\,d\\lambda}\n$$\n问题在初始辐射率方程中提供了大气顶层太阳辐照度 $E_0(\\lambda)$，但并未提供该函数本身，也未提供用于推导地表入射全局辐照度 $E_g(\\lambda)$ 的大气透过率模型。由于问题必须仅使用提供的信息来解决，我们必须假设辐照度项 $E_g(\\lambda)$ 在任何给定波段内的光谱变化与 $\\rho_{\\text{lab}}(\\lambda)$ 和 $S_b(\\lambda)$ 的变化相比可以忽略不计。根据这个常见的简化假设，$E_g(\\lambda)$ 可以被视为一个常数，从分子和分母中约去。这得到了纯粹由SRF加权的波段平均反射率：\n$$\nR_{\\text{sim},b} = \\frac{\\int \\rho_{\\text{lab}}(\\lambda) S_b(\\lambda) \\,d\\lambda}{\\int S_b(\\lambda) \\,d\\lambda}\n$$\n这是我们将要实现的表达式。问题要求使用黎曼和近似进行数值积分。给定步长恒为 $\\Delta\\lambda = 1\\,\\text{nm}$ 的离散波长网格，积分可用求和来近似。对于任意函数 $f(\\lambda)$，积分 $\\int f(\\lambda) \\,d\\lambda$ 近似为 $\\sum_{i} f(\\lambda_i) \\Delta\\lambda$。由于 $\\Delta\\lambda$ 是分子和分母中的一个常数因子，它可以被约去。\n\n因此，模拟反射率的离散形式为：\n$$\nR_{\\text{sim},b} \\approx \\frac{\\sum_{i} \\rho_{\\text{lab}}(\\lambda_i) S_b(\\lambda_i)}{\\sum_{i} S_b(\\lambda_i)}\n$$\n其中求和是在指定的波长网格 $\\lambda_i$（从 $400\\,\\text{nm}$ 到 $1000\\,\\text{nm}$）上进行的。\n\n计算步骤如下：\n1.  定义波长网格 $\\lambda_i$，其中 $i \\in [400, 401, \\dots, 1000]$。\n2.  使用提供的公式为网格上的每个波长 $\\lambda_i$ 计算高分辨率实验室混凝土光谱 $\\rho_{\\text{lab}}(\\lambda_i)$：$\\rho_{\\text{lab}}(\\lambda) = \\max\\Big(0, \\min\\Big(1, \\big(0.30 + 0.0004(\\lambda - 400)\\big) - 0.04\\exp\\big(-\\frac{1}{2}(\\frac{\\lambda-850}{25})^2\\big)\\Big)\\Big)$。\n3.  对于三个测试用例中的每一个，遍历四个光谱波段（蓝色、绿色、红色、近红外）。\n4.  对于每个波段 $b$：\n    a. 确定SRF参数：中心波长 $c_b$ 和半峰全宽 $\\text{FWHM}_b$。\n    b. 计算高斯SRF的标准差：$\\sigma_b = \\frac{\\text{FWHM}_b}{2\\sqrt{2\\ln 2}}$。\n    c. 为网格上的所有 $\\lambda_i$ 计算SRF值 $S_b(\\lambda_i) = \\exp\\big(-\\frac{1}{2}\\big(\\frac{\\lambda_i-c_b}{\\sigma_b}\\big)^2\\big)$。\n    d. 计算分子和，$N_b = \\sum_i \\rho_{\\text{lab}}(\\lambda_i) S_b(\\lambda_i)$。\n    e. 计算分母和，$D_b = \\sum_i S_b(\\lambda_i)$。\n    f. 计算模拟的波段反射率，$R_{\\text{sim},b} = N_b / D_b$。\n5.  计算出 $R_{\\text{sim},b}$ 后，使用当前测试用例的观测反射率 $R_{\\text{obs},b}$ 计算每个波段的偏差：$\\text{bias}_b = R_{\\text{obs},b} - R_{\\text{sim},b}$。\n6.  将每个偏差四舍五入到小数点后四位，并按指定的列表的列表格式收集每个测试用例的结果。\n\n此过程将应用于每个测试用例，并根据规定对测试用例2中红色波段的SRF进行修改。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes per-band biases between observed and simulated satellite measurements\n    of concrete surface reflectance.\n    \"\"\"\n    \n    # 1. Define the wavelength grid and laboratory concrete spectrum\n    wavelengths = np.arange(400, 1001, 1)\n    \n    def get_lab_spectrum(lmbda):\n        \"\"\"\n        Calculates the laboratory concrete spectrum rho_lab at given wavelengths.\n        lmbda: numpy array of wavelengths in nm.\n        \"\"\"\n        # Baseline reflectance\n        rho_base = 0.30 + 0.0004 * (lmbda - 400)\n        \n        # Hydration-related absorption feature (Gaussian dip)\n        absorption_amplitude = 0.04\n        absorption_center = 850.0\n        absorption_stddev = 25.0\n        absorption_dip = absorption_amplitude * np.exp(\n            -0.5 * ((lmbda - absorption_center) / absorption_stddev)**2\n        )\n        \n        # Combine baseline and absorption\n        rho_lab = rho_base - absorption_dip\n        \n        # Clip reflectance to the physically valid interval [0, 1]\n        return np.clip(rho_lab, 0, 1)\n\n    rho_lab_spectrum = get_lab_spectrum(wavelengths)\n\n    # 2. Define sensor band characteristics\n    baseline_srf_params = {\n        'Blue': {'c': 490.0, 'fwhm': 65.0},\n        'Green': {'c': 560.0, 'fwhm': 35.0},\n        'Red': {'c': 665.0, 'fwhm': 30.0},\n        'NIR': {'c': 842.0, 'fwhm': 115.0}\n    }\n    \n    band_order = ['Blue', 'Green', 'Red', 'NIR']\n\n    # 3. Define test cases\n    test_cases = [\n        {\n            'name': 'Test Case 1 (happy path)',\n            'observed_reflectances': [0.345, 0.375, 0.405, 0.465],\n            'srf_params': baseline_srf_params\n        },\n        {\n            'name': 'Test Case 2 (boundary condition - narrow red SRF)',\n            'observed_reflectances': [0.345, 0.375, 0.400, 0.465],\n            'srf_params': {\n                **baseline_srf_params,\n                'Red': {'c': 665.0, 'fwhm': 5.0}\n            }\n        },\n        {\n            'name': 'Test Case 3 (edge case - slight negative observed)',\n            'observed_reflectances': [-0.005, 0.370, 0.410, 0.470],\n            'srf_params': baseline_srf_params\n        }\n    ]\n\n    all_results = []\n\n    # 4. Process each test case\n    for i, case in enumerate(test_cases):\n        case_biases = []\n        observed_reflectances = dict(zip(band_order, case['observed_reflectances']))\n        \n        for band_name in band_order:\n            params = case['srf_params'][band_name]\n            c_b = params['c']\n            fwhm_b = params['fwhm']\n            \n            # Calculate standard deviation sigma from FWHM\n            # FWHM = 2 * sqrt(2 * ln(2)) * sigma\n            sigma_b = fwhm_b / (2.0 * np.sqrt(2.0 * np.log(2.0)))\n            \n            # Calculate the SRF values over the wavelength grid\n            srf_b = np.exp(-0.5 * ((wavelengths - c_b) / sigma_b)**2)\n            \n            # Numerically integrate to find the simulated band reflectance\n            # R_sim = sum(rho * S) / sum(S)\n            numerator = np.sum(rho_lab_spectrum * srf_b)\n            denominator = np.sum(srf_b)\n            \n            r_sim_b = numerator / denominator if denominator != 0 else 0\n            \n            # Retrieve the observed reflectance for the band\n            r_obs_b = observed_reflectances[band_name]\n            \n            # Calculate the bias\n            bias_b = r_obs_b - r_sim_b\n            \n            # Round to four decimal places and append to the list\n            case_biases.append(round(bias_b, 4))\n            \n        all_results.append(case_biases)\n\n    # 5. Format and print the final output\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}