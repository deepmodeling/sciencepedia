{
    "hands_on_practices": [
        {
            "introduction": "Understanding water indices begins with their fundamental mathematical construction and physical basis. This exercise challenges you to derive the Normalized Difference Water Index (NDWI) and the Modified Normalized Difference Water Index (MNDWI) from first principles for a typical water pixel . By calculating and comparing their values, you will gain direct insight into how the choice of spectral bands—specifically, substituting the Near-Infrared (NIR) with the Shortwave-Infrared (SWIR)—enhances the spectral signature of water, leading to a more robust detection.",
            "id": "3865928",
            "problem": "A single pixel in an atmospherically corrected multispectral image has surface reflectances in the green, near-infrared, and shortwave-infrared channels given by $\\rho_{\\text{green}}=0.08$, $\\rho_{\\text{NIR}}=0.02$, and $\\rho_{\\text{SWIR}}=0.01$, respectively. Assume that these reflectances represent bidirectional reflectance factors for a Lambertian surface under uniform illumination and that adjacency and topographic effects are negligible. Starting from the design principle that a robust two-band spectral index for material discrimination should (i) respond monotonically to spectral contrast between a band where the target is relatively bright and a band where it is relatively dark, and (ii) be invariant to multiplicative illumination or gain changes, construct the appropriate normalized form of such an index. Using this construction and the well-established physical fact that liquid water exhibits relatively higher reflectance in the green portion of the spectrum than in the near-infrared and especially the shortwave-infrared due to strong molecular absorption, derive expressions for the Normalized Difference Water Index (NDWI) and the Modified Normalized Difference Water Index (MNDWI) for this pixel, evaluate both indices for the given reflectances, and then, based on the resulting magnitudes, justify which index would yield a stronger contrast for open water against non-water backgrounds under multiplicative illumination variability. Round the two numerical index values to four significant figures. Express the final numerical values without units.",
            "solution": "The problem is subjected to validation and is deemed valid as it is scientifically grounded, well-posed, and objective, with all necessary data and definitions provided for a unique and meaningful solution within the domain of remote sensing.\n\nThe task is approached by first deriving the general form of a normalized difference index based on the provided design principles, then applying this form to define the Normalized Difference Water Index (NDWI) and the Modified Normalized Difference Water Index (MNDWI), calculating their values for the given pixel reflectances, and finally comparing their magnitudes to determine which provides stronger contrast for water.\n\nFirst, we construct the general form of a robust spectral index. Let the reflectances in two different spectral bands be $\\rho_1$ and $\\rho_2$. The first design principle states that the index should respond monotonically to the spectral contrast between a band where the target is bright (e.g., $\\rho_1$) and a band where it is dark (e.g., $\\rho_2$). A simple difference, $\\rho_1 - \\rho_2$, satisfies this criterion, as it increases with the contrast.\n\nThe second design principle requires the index to be invariant to multiplicative changes in illumination or sensor gain. Let such a multiplicative factor be $k$, where $k > 0$. The observed radiances, and consequently the derived reflectances, would scale to $k \\rho_1$ and $k \\rho_2$. The simple difference becomes $k(\\rho_1 - \\rho_2)$, which is not invariant as it scales with $k$. To achieve invariance, we must normalize this difference by a factor that also scales linearly with $k$. A natural choice for normalization is the sum of the reflectances, $\\rho_1 + \\rho_2$, which scales to $k(\\rho_1 + \\rho_2)$.\n\nConstructing the index $I$ as the ratio of the difference to the sum, we get:\n$$I = \\frac{k\\rho_1 - k\\rho_2}{k\\rho_1 + k\\rho_2} = \\frac{k(\\rho_1 - \\rho_2)}{k(\\rho_1 + \\rho_2)} = \\frac{\\rho_1 - \\rho_2}{\\rho_1 + \\rho_2}$$\nThis is the general form of a Normalized Difference Index (NDI). It is bounded between $-1$ and $1$, and it is dimensionless and invariant to linear scaling of the input reflectances, thus satisfying both design principles.\n\nNext, we apply this NDI form to the specific case of water detection. The problem states that liquid water has a relatively higher reflectance in the green portion of the spectrum compared to the near-infrared (NIR) and shortwave-infrared (SWIR) portions due to strong molecular absorption at longer wavelengths.\n\nThe Normalized Difference Water Index (NDWI), as originally proposed by McFeeters (1996), uses the green and NIR bands. The green band is selected as the \"bright\" band ($\\rho_1$) and the NIR band as the \"dark\" band ($\\rho_2$) to maximize the contrast for water against terrestrial features. The expression for NDWI is therefore:\n$$\\text{NDWI} = \\frac{\\rho_{\\text{green}} - \\rho_{\\text{NIR}}}{\\rho_{\\text{green}} + \\rho_{\\text{NIR}}}$$\n\nThe Modified Normalized Difference Water Index (MNDWI), proposed by Xu (2006), aims to enhance this contrast further. It is based on the physical principle that water absorption is even stronger in the SWIR band than in the NIR band. Thus, replacing the NIR band with a SWIR band should increase the spectral separability of water. In this formulation, the green band remains the \"bright\" band ($\\rho_1$), and the SWIR band becomes the \"dark\" band ($\\rho_2$). The expression for MNDWI is:\n$$\\text{MNDWI} = \\frac{\\rho_{\\text{green}} - \\rho_{\\text{SWIR}}}{\\rho_{\\text{green}} + \\rho_{\\text{SWIR}}}$$\n\nNow, we evaluate these indices using the given reflectance values for the pixel: $\\rho_{\\text{green}} = 0.08$, $\\rho_{\\text{NIR}} = 0.02$, and $\\rho_{\\text{SWIR}} = 0.01$.\n\nFor NDWI:\n$$\\text{NDWI} = \\frac{0.08 - 0.02}{0.08 + 0.02} = \\frac{0.06}{0.10} = 0.6$$\nRounding to four significant figures, we get $0.6000$.\n\nFor MNDWI:\n$$\\text{MNDWI} = \\frac{0.08 - 0.01}{0.08 + 0.01} = \\frac{0.07}{0.09} = \\frac{7}{9} \\approx 0.77777...$$\nRounding to four significant figures, we get $0.7778$.\n\nFinally, we must justify which index yields a stronger contrast. The magnitude of a normalized difference index value is a measure of the relative dominance of one band over the other. For water, a higher positive index value indicates a stronger, more distinct water signal. Our calculated values are $\\text{NDWI} = 0.6000$ and $\\text{MNDWI} = 0.7778$.\n\nSince $0.7778 > 0.6000$, the MNDWI produces a significantly higher value for this water pixel than the NDWI. This implies that MNDWI provides a stronger contrast for open water. The reason for this enhanced contrast lies in the spectral properties of water and the mathematical structure of the index. The difference in reflectance between green and SWIR ($0.08 - 0.01 = 0.07$) is greater than the difference between green and NIR ($0.08 - 0.02 = 0.06$). Concurrently, the sum of reflectances in the denominator is smaller for MNDWI ($0.08 + 0.01 = 0.09$) than for NDWI ($0.08 + 0.02 = 0.10$). Both the larger numerator and the smaller denominator contribute to a larger resulting index value for MNDWI. This greater magnitude enhances the separability of water pixels from non-water pixels (which typically have lower or negative index values), thus yielding a stronger contrast for detection and mapping of open water bodies.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6000 & 0.7778\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A key challenge in remote sensing is not only identifying the target of interest but also correctly rejecting features with similar spectral characteristics. This practice explores a common source of error in water mapping: the misclassification of built-up urban areas . By computing both NDWI and MNDWI for a hypothetical urban rooftop pixel, you will investigate how these indices respond to non-water surfaces and understand why the MNDWI is often superior at reducing false positives in complex, human-modified landscapes.",
            "id": "3865877",
            "problem": "An urban-vegetation-water mapping workflow employs normalized-difference style indices constructed from at-surface reflectance. Consider a single urban rooftop pixel with spectrally plausible, sensor-calibrated reflectances in the green, near-infrared, and shortwave infrared bands: $\\rho_{\\text{green}}=0.12$, $\\rho_{\\text{NIR}}=0.30$, and $\\rho_{\\text{SWIR}}=0.25$. Open water typically exhibits strong absorption in the near-infrared and shortwave infrared relative to the green, whereas most built-up materials exhibit moderate to high reflectance in the near-infrared and shortwave infrared.\n\nThe Normalized Difference Water Index (NDWI) and the Modified Normalized Difference Water Index (MNDWI) are both constructed by applying a normalized-difference operator to a pair of bands chosen to maximize relative water contrast. In the case of NDWI, this operator contrasts the green band against the near-infrared band, while in the case of MNDWI, it contrasts the green band against the shortwave infrared band.\n\nWorking from the general principles of normalized-difference constructions and the stated spectral behaviors (without assuming any specific thresholds beyond the common practice that water is identified by values greater than zero), do the following for the rooftop pixel described above:\n- Construct the functional forms of the NDWI and the MNDWI from first principles of normalized differences between the appropriate band pairs, and compute their values for the given reflectances.\n- Define the scalar quantity $\\Delta$ as the difference between the modified and original index values, $\\Delta=\\mathrm{MNDWI}-\\mathrm{NDWI}$, and compute $\\Delta$.\n- Based on the sign and magnitude of $\\Delta$, explain which index reduces false positives for built-up pixels when a zero threshold is used to delineate water.\n\nExpress the final answer as the exact value of $\\Delta$ in rational form. Do not round.",
            "solution": "We begin from the general normalized-difference construction widely used in remote sensing. For any two bands $a$ and $b$, a normalized-difference index $I$ designed to reflect relative contrast is written as\n$$\nI(a,b) \\equiv \\frac{\\rho_{a}-\\rho_{b}}{\\rho_{a}+\\rho_{b}},\n$$\nwhere $\\rho_{a}$ and $\\rho_{b}$ are at-surface reflectances in bands $a$ and $b$. This construction yields values in $(-1,1)$ and emphasizes the sign and relative magnitude of the difference between the two bands.\n\nThe Normalized Difference Water Index (NDWI) is intended to highlight water by contrasting the green band, where open water can have relatively higher reflectance than in the near-infrared due to strong near-infrared absorption by water, against the near-infrared band. Using the normalized-difference construction with $a=\\text{green}$ and $b=\\text{NIR}$,\n$$\n\\mathrm{NDWI}=\\frac{\\rho_{\\text{green}}-\\rho_{\\text{NIR}}}{\\rho_{\\text{green}}+\\rho_{\\text{NIR}}}.\n$$\nThe Modified Normalized Difference Water Index (MNDWI) replaces the near-infrared band with the shortwave infrared band, leveraging even stronger water absorption in the shortwave infrared and typically stronger reflectance of built-up materials in the shortwave infrared. Thus,\n$$\n\\mathrm{MNDWI}=\\frac{\\rho_{\\text{green}}-\\rho_{\\text{SWIR}}}{\\rho_{\\text{green}}+\\rho_{\\text{SWIR}}}.\n$$\n\nFor the given rooftop pixel, we compute these values using $\\rho_{\\text{green}}=0.12$, $\\rho_{\\text{NIR}}=0.30$, and $\\rho_{\\text{SWIR}}=0.25$.\n\nFirst, compute $\\mathrm{NDWI}$:\n$$\n\\mathrm{NDWI}=\\frac{0.12-0.30}{0.12+0.30}=\\frac{-0.18}{0.42}=-\\frac{18}{42}=-\\frac{3}{7}.\n$$\n\nNext, compute $\\mathrm{MNDWI}$:\n$$\n\\mathrm{MNDWI}=\\frac{0.12-0.25}{0.12+0.25}=\\frac{-0.13}{0.37}=-\\frac{13}{37}.\n$$\n\nNow define the scalar quantity $\\Delta$ as the difference $\\Delta=\\mathrm{MNDWI}-\\mathrm{NDWI}$ and compute it exactly:\n$$\n\\Delta=\\left(-\\frac{13}{37}\\right)-\\left(-\\frac{3}{7}\\right)=\\frac{3}{7}-\\frac{13}{37}=\\frac{3\\cdot 37-13\\cdot 7}{259}=\\frac{111-91}{259}=\\frac{20}{259}.\n$$\n\nTo interpret which index reduces false positives for built-up surfaces under a zero threshold, we examine the sign and magnitude. A zero threshold means water is indicated when the index is greater than zero. Both computed values are negative for the rooftop pixel, so neither would be misclassified as water at this threshold. However, the index with the more negative value is farther from zero on the negative side and thus has a larger safety margin against false positives for built-up pixels.\n\nWe can formalize this by considering the difference directly:\n$$\n\\Delta=\\mathrm{MNDWI}-\\mathrm{NDWI}=\\frac{20}{259}>0,\n$$\nwhich implies $\\mathrm{MNDWI}>\\mathrm{NDWI}$ for this pixel. Since both are negative, this means $\\mathrm{MNDWI}$ is closer to zero (less negative) than $\\mathrm{NDWI}$. Therefore, at a zero threshold, $\\mathrm{NDWI}$ provides a larger negative margin and thus reduces false positives for the given rooftop more than $\\mathrm{MNDWI}$.\n\nThis pixel-specific conclusion can also be linked to a general expression for the difference. Let $g=\\rho_{\\text{green}}$, $n=\\rho_{\\text{NIR}}$, and $s=\\rho_{\\text{SWIR}}$. Then\n$$\n\\mathrm{MNDWI}-\\mathrm{NDWI}=\\frac{g-s}{g+s}-\\frac{g-n}{g+n}=\\frac{2g(n-s)}{(g+s)(g+n)}.\n$$\nThe denominator is positive, so the sign of $\\Delta$ is the sign of $n-s$. For the given rooftop, $n-s=0.30-0.25>0$, hence $\\Delta>0$, confirming that $\\mathrm{MNDWI}$ is less negative than $\\mathrm{NDWI}$ and thus affords a smaller safety margin against false positives at zero threshold. Conversely, for built-up materials where $\\rho_{\\text{SWIR}}$ exceeds $\\rho_{\\text{NIR}}$, one would have $\\Delta<0$, and $\\mathrm{MNDWI}$ would yield more negative values and reduce false positives relative to $\\mathrm{NDWI}$—a common motivation for the modified index in urban contexts.",
            "answer": "$$\\boxed{\\frac{20}{259}}$$"
        },
        {
            "introduction": "Creating a water map is only half the task; rigorously evaluating its performance is equally critical. This exercise moves from index calculation to the statistical validation of a classified map using a confusion matrix . You will calculate several key performance metrics—overall accuracy, precision, recall, and the F1 score—to learn how each provides a different perspective on model performance, particularly in the realistic scenario of strong class imbalance where water is a minority class.",
            "id": "3865867",
            "problem": "A floodplain mapping study used the Modified Normalized Difference Water Index (MNDWI) computed from multispectral satellite imagery to produce a binary water mask by thresholding. An independent stratified random sample of validation pixels was collected and visually labeled as water or non-water. Consider the following confusion matrix counts (treat water as the positive class):\n\n- Reference water pixels: predicted water $=$ $900$, predicted non-water $=$ $300$.\n- Reference non-water pixels: predicted water $=$ $700$, predicted non-water $=$ $18{,}100$.\n\nAssume all validation pixels are mutually independent draws from the underlying spatial process. Using only fundamental definitions from statistical classification based on the confusion matrix, compute the following performance metrics for the water class: overall accuracy, precision, recall, and the F1 score. Return your results in the order $\\big[$overall accuracy, precision, recall, F1 score$\\big]$. Round each value to four significant figures. Finally, based on first principles and without invoking any domain-specific shortcuts, discuss which of these metrics is most informative for evaluating MNDWI-derived water maps under strong class imbalance, and justify your reasoning from the definitions of the metrics and the provided counts.",
            "solution": "The problem requires the calculation of four standard performance metrics for a binary classification task and a critical discussion of their utility in a scenario with strong class imbalance. The first step is to formalize the given counts from the confusion matrix.\n\nLet the \"water\" class be the positive class and the \"non-water\" class be the negative class. The provided counts can be defined as follows:\n- True Positives ($TP$): Reference is water, prediction is water. $TP = 900$.\n- False Negatives ($FN$): Reference is water, prediction is non-water. $FN = 300$.\n- False Positives ($FP$): Reference is non-water, prediction is water. $FP = 700$.\n- True Negatives ($TN$): Reference is non-water, prediction is non-water. $TN = 18{,}100$.\n\nThe total number of validation pixels, $N$, is the sum of these counts:\n$$N = TP + FN + FP + TN = 900 + 300 + 700 + 18{,}100 = 20{,}000$$\n\nWith these fundamental quantities, we can compute the required metrics.\n\n**1. Overall Accuracy (OA)**\nOverall accuracy measures the proportion of all predictions that were correct. The formula is:\n$$OA = \\frac{TP + TN}{TP + FN + FP + TN} = \\frac{TP + TN}{N}$$\nSubstituting the given values:\n$$OA = \\frac{900 + 18{,}100}{20{,}000} = \\frac{19{,}000}{20{,}000} = 0.95$$\nRounded to four significant figures, this is $0.9500$.\n\n**2. Precision (P)**\nPrecision, for the positive class, measures the proportion of positive predictions that were actually correct. It is also known as user's accuracy. The formula is:\n$$P = \\frac{TP}{TP + FP}$$\nSubstituting the given values:\n$$P = \\frac{900}{900 + 700} = \\frac{900}{1{,}600} = \\frac{9}{16} = 0.5625$$\nThis value already has four significant figures.\n\n**3. Recall (R)**\nRecall, for the positive class, measures the proportion of actual positives that were correctly identified. It is also known as sensitivity or producer's accuracy. The formula is:\n$$R = \\frac{TP}{TP + FN}$$\nSubstituting the given values:\n$$R = \\frac{900}{900 + 300} = \\frac{900}{1{,}200} = \\frac{3}{4} = 0.75$$\nRounded to four significant figures, this is $0.7500$.\n\n**4. F1 Score (F1)**\nThe F1 score is the harmonic mean of precision and recall. It provides a single score that balances both metrics. The formula is:\n$$F1 = 2 \\times \\frac{P \\times R}{P + R}$$\nAn equivalent formula using the fundamental counts is:\n$$F1 = \\frac{2 \\cdot TP}{2 \\cdot TP + FP + FN}$$\nUsing the latter formula for direct calculation:\n$$F1 = \\frac{2 \\times 900}{2 \\times 900 + 700 + 300} = \\frac{1{,}800}{1{,}800 + 1{,}000} = \\frac{1{,}800}{2{,}800} = \\frac{18}{28} = \\frac{9}{14}$$\nAs a decimal, this is approximately $0.64285714...$. Rounded to four significant figures, the F1 score is $0.6429$.\n\nThe computed metrics are: Overall Accuracy $= 0.9500$, Precision $= 0.5625$, Recall $= 0.7500$, and F1 Score $= 0.6429$.\n\n**Discussion on Metric Informativeness under Class Imbalance**\n\nThe problem exhibits a strong class imbalance. The number of actual water pixels (positive class) is $P_{actual} = TP + FN = 900 + 300 = 1{,}200$. The number of actual non-water pixels (negative class) is $N_{actual} = FP + TN = 700 + 18{,}100 = 18{,}800$. The ratio of the negative class to the positive class is $18{,}800 / 1{,}200 \\approx 15.7$.\n\n- **Overall Accuracy (OA)**: The OA is $0.9500$, which appears very high. However, this metric is misleading in cases of class imbalance. The formula $OA = (TP + TN) / N$ is heavily influenced by the performance on the majority class. In this problem, the number of true negatives ($TN = 18{,}100$) dominates the numerator. A naive model that always predicts the majority class (\"non-water\") would achieve an accuracy of $N_{actual} / N = 18{,}800 / 20{,}000 = 0.94$. The MNDWI model's accuracy of $0.95$ is only a marginal improvement over this trivial baseline. Therefore, overall accuracy is not an informative metric for assessing the model's ability to identify the minority \"water\" class.\n\n- **Precision (P) and Recall (R)**: These metrics evaluate performance exclusively on the positive class, making them insensitive to the large number of true negatives. \n    - Precision ($P = 0.5625$) answers the question: \"Of all the pixels predicted as water, what fraction is actually water?\" It penalizes false positives ($FP$). A low precision indicates a high number of false alarms.\n    - Recall ($R = 0.7500$) answers the question: \"Of all the actual water pixels, what fraction did the model identify?\" It penalizes false negatives ($FN$). A low recall indicates that many actual water pixels were missed.\n    Both metrics are highly informative but describe different aspects of performance. The choice between prioritizing precision or recall depends on the relative costs of false positives versus false negatives for a specific application (e.g., flood risk assessment vs. emergency response).\n\n- **F1 Score**: The F1 score is the harmonic mean of precision and recall. The harmonic mean gives more weight to lower values. Therefore, the F1 score will be high only if both precision and recall are high. It synthesizes the information from both false positives and false negatives into a single number. In this case, there is a trade-off between a modest precision ($0.5625$) and a better recall ($0.7500$). The F1 score ($0.6429$) provides a more balanced and realistic assessment of the model's performance on the water class than the overly optimistic overall accuracy.\n\n**Conclusion of Discussion**: In the presence of strong class imbalance, overall accuracy is a poor and misleading indicator of performance. Precision and recall are far more informative as they focus on the minority class of interest. The **F1 score** is arguably the most informative single metric for a general evaluation, as it combines precision and recall into a balanced measure that is robust to class imbalance. It effectively summarizes the model's ability to handle the positive class, considering both types of classification errors ($FP$ and $FN$) associated with it.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.9500 & 0.5625 & 0.7500 & 0.6429\n\\end{pmatrix}\n}\n$$"
        }
    ]
}