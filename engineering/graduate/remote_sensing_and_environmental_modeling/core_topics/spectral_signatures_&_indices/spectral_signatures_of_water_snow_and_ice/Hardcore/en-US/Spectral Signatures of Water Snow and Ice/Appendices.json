{
    "hands_on_practices": [
        {
            "introduction": "Spectral indices provide a powerful and efficient way to distill complex multispectral data into a single, meaningful value that tracks a specific physical property. The Normalized Difference Snow Index ($ \\mathrm{NDSI} $) is a cornerstone of global snow cover mapping. This exercise  provides a direct, quantitative practice in understanding its sensitivity, asking you to calculate the expected change in $ \\mathrm{NDSI} $ as a snowpack begins to melt. By applying a simplified linear model for reflectance change, you will gain hands-on experience in how the physical introduction of liquid water propagates through the index calculation, a fundamental skill for interpreting time-series of remote sensing data.",
            "id": "3855145",
            "problem": "A snow-covered pixel is observed with a multispectral sensor using a visible green band centered at wavelength $\\lambda_{\\mathrm{G}} = 0.55~\\mu\\mathrm{m}$ and a shortwave infrared band centered at $\\lambda_{\\mathrm{S}} = 1.6~\\mu\\mathrm{m}$. The Normalized Difference Snow Index (NDSI) is defined as\n$$\n\\mathrm{NDSI} = \\frac{R_{\\mathrm{G}} - R_{\\mathrm{S}}}{R_{\\mathrm{G}} + R_{\\mathrm{S}}},\n$$\nwhere $R_{\\mathrm{G}}$ and $R_{\\mathrm{S}}$ are the bidirectional reflectances in the green and shortwave infrared bands, respectively. Consider fine-grained, clean, dry snow with baseline reflectances $R_{\\mathrm{G},0} = 0.90$ and $R_{\\mathrm{S},0} = 0.10$ under nadir illumination and viewing. When a small volumetric liquid water fraction $w$ is introduced into the snowpack, the reflectance at each band is modeled, to first order in $w$, by a linear sensitivity\n$$\nR_{\\lambda}(w) \\approx R_{\\lambda,0} - k_{\\lambda}\\, w,\n$$\nwith $k_{\\mathrm{G}} = 3.0$ for the green band and $k_{\\mathrm{S}} = 0.20$ for the shortwave infrared band. Assume the liquid water fraction increases from $w = 0$ to $w = 0.05$.\n\nUsing only the definition of $\\mathrm{NDSI}$ and the first-order sensitivity model above, compute the expected decrease in $\\mathrm{NDSI}$ attributable to the increase in liquid water fraction from $0$ to $5$ percent. Express your final answer as a single dimensionless number equal to the magnitude of the decrease (dry minus wet), and round your result to four significant figures.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and self-contained. The model provided is a first-order linear approximation, which is a standard method for analyzing small perturbations, and the given parameters do not lead to physical or mathematical contradictions within the specified domain.\n\nThe objective is to compute the decrease in the Normalized Difference Snow Index ($\\mathrm{NDSI}$) when the volumetric liquid water fraction, $w$, increases from $w=0$ to $w=0.05$. Let this decrease be denoted by $\\Delta\\mathrm{NDSI}$.\n$$\n\\Delta\\mathrm{NDSI} = \\mathrm{NDSI}(w=0) - \\mathrm{NDSI}(w=0.05)\n$$\nThe $\\mathrm{NDSI}$ is defined as:\n$$\n\\mathrm{NDSI} = \\frac{R_{\\mathrm{G}} - R_{\\mathrm{S}}}{R_{\\mathrm{G}} + R_{\\mathrm{S}}}\n$$\nwhere $R_{\\mathrm{G}}$ and $R_{\\mathrm{S}}$ are the reflectances in the green and shortwave infrared bands, respectively. The problem provides a linear model for the dependence of reflectance on the liquid water fraction $w$:\n$$\nR_{\\lambda}(w) \\approx R_{\\lambda,0} - k_{\\lambda}\\, w\n$$\nHere, $R_{\\lambda,0}$ is the baseline reflectance for dry snow ($w=0$), and $k_{\\lambda}$ is the sensitivity coefficient.\n\nThe given values are:\nBaseline reflectances: $R_{\\mathrm{G},0} = 0.90$ and $R_{\\mathrm{S},0} = 0.10$.\nSensitivity coefficients: $k_{\\mathrm{G}} = 3.0$ and $k_{\\mathrm{S}} = 0.20$.\n\nFirst, we calculate the $\\mathrm{NDSI}$ for dry snow, which corresponds to the case where $w=0$. In this case, the reflectances are simply the baseline reflectances, $R_{\\mathrm{G}} = R_{\\mathrm{G},0}$ and $R_{\\mathrm{S}} = R_{\\mathrm{S},0}$.\n$$\n\\mathrm{NDSI}(w=0) = \\frac{R_{\\mathrm{G},0} - R_{\\mathrm{S},0}}{R_{\\mathrm{G},0} + R_{\\mathrm{S},0}}\n$$\nSubstituting the given baseline values:\n$$\n\\mathrm{NDSI}(w=0) = \\frac{0.90 - 0.10}{0.90 + 0.10} = \\frac{0.80}{1.00} = 0.8\n$$\nNext, we calculate the reflectances for wet snow, where the liquid water fraction is $w=0.05$.\nFor the green band, the reflectance $R_{\\mathrm{G}}(w=0.05)$ is:\n$$\nR_{\\mathrm{G}}(w=0.05) = R_{\\mathrm{G},0} - k_{\\mathrm{G}} w = 0.90 - (3.0)(0.05) = 0.90 - 0.15 = 0.75\n$$\nFor the shortwave infrared band, the reflectance $R_{\\mathrm{S}}(w=0.05)$ is:\n$$\nR_{\\mathrm{S}}(w=0.05) = R_{\\mathrm{S},0} - k_{\\mathrm{S}} w = 0.10 - (0.20)(0.05) = 0.10 - 0.01 = 0.09\n$$\nNow, we calculate the $\\mathrm{NDSI}$ for this wet snow condition:\n$$\n\\mathrm{NDSI}(w=0.05) = \\frac{R_{\\mathrm{G}}(0.05) - R_{\\mathrm{S}}(0.05)}{R_{\\mathrm{G}}(0.05) + R_{\\mathrm{S}}(0.05)}\n$$\nSubstituting the calculated wet snow reflectances:\n$$\n\\mathrm{NDSI}(w=0.05) = \\frac{0.75 - 0.09}{0.75 + 0.09} = \\frac{0.66}{0.84}\n$$\nThis fraction simplifies to:\n$$\n\\mathrm{NDSI}(w=0.05) = \\frac{66}{84} = \\frac{11}{14}\n$$\nFinally, we compute the required decrease in $\\mathrm{NDSI}$, $\\Delta\\mathrm{NDSI}$:\n$$\n\\Delta\\mathrm{NDSI} = \\mathrm{NDSI}(w=0) - \\mathrm{NDSI}(w=0.05) = 0.8 - \\frac{11}{14}\n$$\nTo perform the subtraction, we express $0.8$ as a fraction, $0.8 = \\frac{8}{10} = \\frac{4}{5}$:\n$$\n\\Delta\\mathrm{NDSI} = \\frac{4}{5} - \\frac{11}{14} = \\frac{4 \\times 14}{5 \\times 14} - \\frac{11 \\times 5}{14 \\times 5} = \\frac{56 - 55}{70} = \\frac{1}{70}\n$$\nThe problem requires the final answer as a single dimensionless number rounded to four significant figures. We convert the fraction to its decimal representation:\n$$\n\\Delta\\mathrm{NDSI} = \\frac{1}{70} \\approx 0.0142857...\n$$\nRounding this value to $4$ significant figures gives $0.01429$. This is the magnitude of the decrease in $\\mathrm{NDSI}$ as the liquid water fraction increases from $0$ to $0.05$.",
            "answer": "$$\\boxed{0.01429}$$"
        },
        {
            "introduction": "A common challenge in automated image classification is the existence of 'spectral confusers'—distinct surface types that appear similar in certain spectral bands. This practice  addresses a classic example: the misclassification of shallow, sandy-bottom lakes as snow due to their high reflectance in the visible spectrum. You will use a simplified radiative transfer model to understand why this confusion occurs and then leverage the fundamental optical properties of water—specifically its strong absorption in the near-infrared (NIR)—to design a robust spectral ratio that can successfully disambiguate these two features.",
            "id": "3855196",
            "problem": "A passive optical satellite sensor acquires nadir imagery over a heterogeneous alpine region with numerous small lakes. The sensor has bands centered at $0.48\\,\\mu\\mathrm{m}$ (blue), $0.55\\,\\mu\\mathrm{m}$ (green), $0.66\\,\\mu\\mathrm{m}$ (red), $0.86\\,\\mu\\mathrm{m}$ (near infrared, NIR), and $1.6\\,\\mu\\mathrm{m}$ (shortwave infrared, SWIR). An analyst applies a simple green-band reflectance threshold to map snow: pixels with green-band bidirectional reflectance factor $\\rho(0.55\\,\\mu\\mathrm{m}) > 0.40$ are labeled as snow. Unexpectedly, some shallow, sandy-bottom lakes are labeled as snow in the green band.\n\nConstruct a physically grounded argument for how a shallow, sandy-bottom lake can exhibit high apparent reflectance in the visible bands and thus be misclassified as snow, and propose a spectral ratio that robustly disambiguates snow from shallow sandy-bottom water using the available bands. Your argument must start from first principles of radiative transfer and material optical properties.\n\nFor the shallow lake case, assume a minimal two-stream approximation in which the top-of-atmosphere water-leaving reflectance is dominated by the sum of a small surface-water term and a bottom-reflection term attenuated by two-way passage through the water column. Let the shallow-lake reflectance be approximated by\n$$\nR_{\\mathrm{lake}}(\\lambda) \\approx R_{w}(\\lambda) + \\rho_{b}(\\lambda)\\,\\exp\\!\\left(-2\\,c(\\lambda)\\,z\\right),\n$$\nwhere $\\lambda$ is wavelength, $R_{w}(\\lambda)$ is the small surface water-leaving reflectance, $\\rho_{b}(\\lambda)$ is the bottom albedo (sandy substrate), $c(\\lambda)$ is an effective diffuse attenuation coefficient (accounting for absorption and scattering), and $z$ is the water depth. Consider a representative shallow, sandy-bottom lake with $z = 1.0\\,\\mathrm{m}$ and $\\rho_{b}(\\lambda) \\approx 0.60$ across the visible and near infrared, and use the following physically plausible values for the water column and surface term under low-glint, clear-sky conditions:\n- $c(0.55\\,\\mu\\mathrm{m}) = 0.30\\,\\mathrm{m}^{-1}$, $c(0.86\\,\\mu\\mathrm{m}) = 4.00\\,\\mathrm{m}^{-1}$,\n- $R_{w}(0.55\\,\\mu\\mathrm{m}) = 0.02$, $R_{w}(0.86\\,\\mu\\mathrm{m}) = 0.01$.\n\nFor clean, fine-grained snow under similar illumination, adopt representative reflectances $\\rho_{\\mathrm{snow}}(0.55\\,\\mu\\mathrm{m}) = 0.85$, $\\rho_{\\mathrm{snow}}(0.86\\,\\mu\\mathrm{m}) = 0.75$, and $\\rho_{\\mathrm{snow}}(1.6\\,\\mu\\mathrm{m}) = 0.30$.\n\nUsing these values and first principles:\n- Explain why $R_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m})$ can exceed $0.40$ in shallow sandy-bottom lakes, while $R_{\\mathrm{lake}}(0.86\\,\\mu\\mathrm{m})$ remains low, whereas snow maintains high reflectance in both the green and NIR bands.\n- Propose and justify a single-band ratio using the available bands that separates snow and shallow sandy-bottom water, including the direction of a threshold (greater-than or less-than) that would classify snow, based on the physics and the computed magnitudes.\n\nSelect the best choice among the following options for a discriminative spectral ratio and threshold rule:\n\nA. Use the near infrared to green ratio $R(0.86\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.86\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m}) > 0.50$.\n\nB. Use the blue to near infrared ratio $R(0.48\\,\\mu\\mathrm{m}) / R(0.86\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.48\\,\\mu\\mathrm{m}) / R(0.86\\,\\mu\\mathrm{m}) > 2.00$.\n\nC. Use the red to green ratio $R(0.66\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.66\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m}) > 1.00$.\n\nD. Use the shortwave infrared to green ratio $R(1.6\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(1.6\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m}) < 0.40$.\n\nE. Use the green to shortwave infrared ratio $R(0.55\\,\\mu\\mathrm{m}) / R(1.6\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.55\\,\\mu\\mathrm{m}) / R(1.6\\,\\mu\\mathrm{m}) > 3.00$.\n\nAnswer by selecting the single best option and be prepared to justify the choice from the physics and the computed reflectance magnitudes.",
            "solution": "The problem statement is subjected to validation before proceeding to a solution.\n\n### Step 1: Extract Givens\n\n-   **Sensor Bands**: $0.48\\,\\mu\\mathrm{m}$ (blue), $0.55\\,\\mu\\mathrm{m}$ (green), $0.66\\,\\mu\\mathrm{m}$ (red), $0.86\\,\\mu\\mathrm{m}$ (NIR), $1.6\\,\\mu\\mathrm{m}$ (SWIR).\n-   **Initial Snow Classification Rule**: Green-band reflectance $\\rho(0.55\\,\\mu\\mathrm{m}) > 0.40$.\n-   **Observed Anomaly**: Shallow, sandy-bottom lakes are misclassified as snow.\n-   **Shallow Lake Reflectance Model**: $R_{\\mathrm{lake}}(\\lambda) \\approx R_{w}(\\lambda) + \\rho_{b}(\\lambda)\\,\\exp\\!\\left(-2\\,c(\\lambda)\\,z\\right)$.\n    -   $R_{w}(\\lambda)$: surface water-leaving reflectance.\n    -   $\\rho_{b}(\\lambda)$: bottom albedo.\n    -   $c(\\lambda)$: effective diffuse attenuation coefficient.\n    -   $z$: water depth.\n-   **Shallow Lake Parameters**:\n    -   $z = 1.0\\,\\mathrm{m}$.\n    -   $\\rho_{b}(\\lambda) \\approx 0.60$ for visible and NIR.\n    -   $c(0.55\\,\\mu\\mathrm{m}) = 0.30\\,\\mathrm{m}^{-1}$.\n    -   $c(0.86\\,\\mu\\mathrm{m}) = 4.00\\,\\mathrm{m}^{-1}$.\n    -   $R_{w}(0.55\\,\\mu\\mathrm{m}) = 0.02$.\n    -   $R_{w}(0.86\\,\\mu\\mathrm{m}) = 0.01$.\n-   **Clean Snow Parameters**:\n    -   $\\rho_{\\mathrm{snow}}(0.55\\,\\mu\\mathrm{m}) = 0.85$.\n    -   $\\rho_{\\mathrm{snow}}(0.86\\,\\mu\\mathrm{m}) = 0.75$.\n    -   $\\rho_{\\mathrm{snow}}(1.6\\,\\mu\\mathrm{m}) = 0.30$.\n-   **Task**:\n    1.  Explain the misclassification using first principles and the provided model.\n    2.  Propose and justify a spectral ratio to disambiguate snow from these lakes.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientifically Grounded**: The problem is based on established principles of aquatic optics and radiative transfer. The reflectance model is a standard simplified representation for optically shallow waters. The spectral properties cited for water (low attenuation in the green, high in the NIR), sand (bright substrate), and snow (high VIS/NIR reflectance, lower SWIR reflectance) are factually correct and physically realistic.\n-   **Well-Posed**: The problem is well-defined. It provides a mathematical model, all necessary parameters for calculation, and a clear objective. A unique, tractable solution can be derived from the information given.\n-   **Objective**: The problem is stated in precise, quantitative, and objective language, free from subjective or ambiguous terms.\n-   **Conclusion of Validation**: The problem statement is scientifically sound, well-posed, and objective. It does not violate any of the invalidity criteria.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. A full solution will be derived.\n\n### Solution Derivation\n\nThe task is to explain the misclassification of shallow, sandy-bottom lakes as snow and then to propose a method for their disambiguation.\n\n**Part 1: Explanation of Misclassification**\n\nThe initial classification is based on a simple threshold in the green band: pixels with reflectance $\\rho(0.55\\,\\mu\\mathrm{m}) > 0.40$ are labeled as snow. We must explain why a shallow lake can meet this criterion.\n\nThe apparent reflectance of the shallow lake, $R_{\\mathrm{lake}}(\\lambda)$, is the sum of reflectance from the water body itself, $R_w(\\lambda)$, and the reflectance from the bottom, $\\rho_b(\\lambda)$, which is attenuated on its path down through the water and back up. The two-way attenuation is described by the exponential term $\\exp(-2\\,c(\\lambda)\\,z)$.\n\nFirst, we calculate the apparent reflectance of the lake in the green band ($0.55\\,\\mu\\mathrm{m}$) using the provided representative values:\n$z = 1.0\\,\\mathrm{m}$, $\\rho_b(0.55\\,\\mu\\mathrm{m}) = 0.60$, $c(0.55\\,\\mu\\mathrm{m}) = 0.30\\,\\mathrm{m}^{-1}$, and $R_w(0.55\\,\\mu\\mathrm{m}) = 0.02$.\n$$\nR_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m}) = 0.02 + 0.60 \\times \\exp(-2 \\times 0.30\\,\\mathrm{m}^{-1} \\times 1.0\\,\\mathrm{m})\n$$\n$$\nR_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m}) = 0.02 + 0.60 \\times \\exp(-0.60)\n$$\nUsing the approximation $\\exp(-0.60) \\approx 0.5488$:\n$$\nR_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m}) \\approx 0.02 + 0.60 \\times 0.5488 = 0.02 + 0.3293 = 0.3493\n$$\nThe calculated reflectance $R_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m}) \\approx 0.35$. This value is high and approaches the classification threshold of $0.40$. The problem states that the lakes *are* misclassified and asks how this *can* happen. The provided values are \"representative\". Minor, physically plausible variations, such as slightly shallower water (e.g., $z=0.7\\,\\mathrm{m}$), slightly clearer water (lower $c(\\lambda)$), or a brighter sandy bottom (higher $\\rho_b(\\lambda)$), would cause the lake's reflectance to exceed $0.40$. For instance, if $z = 0.7\\,\\mathrm{m}$, $R_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m}) \\approx 0.02 + 0.60 \\times \\exp(-0.42) \\approx 0.02 + 0.60 \\times 0.657 = 0.414$, which is greater than $0.40$. The physical reason is that water's attenuation coefficient is at a minimum in the blue-green portion of the spectrum. This \"oceanic window\" allows significant light penetration, interaction with the bright bottom, and exitance from the water column, resulting in a high apparent reflectance that can be confused with other bright surfaces like snow.\n\nNext, we evaluate the lake's reflectance in the near-infrared (NIR) band ($0.86\\,\\mu\\mathrm{m}$):\n$z = 1.0\\,\\mathrm{m}$, $\\rho_b(0.86\\,\\mu\\mathrm{m}) = 0.60$, $c(0.86\\,\\mu\\mathrm{m}) = 4.00\\,\\mathrm{m}^{-1}$, and $R_w(0.86\\,\\mu\\mathrm{m}) = 0.01$.\n$$\nR_{\\mathrm{lake}}(0.86\\,\\mu\\mathrm{m}) = 0.01 + 0.60 \\times \\exp(-2 \\times 4.00\\,\\mathrm{m}^{-1} \\times 1.0\\,\\mathrm{m})\n$$\n$$\nR_{\\mathrm{lake}}(0.86\\,\\mu\\mathrm{m}) = 0.01 + 0.60 \\times \\exp(-8.0)\n$$\nUsing the approximation $\\exp(-8.0) \\approx 0.000335$:\n$$\nR_{\\mathrm{lake}}(0.86\\,\\mu\\mathrm{m}) \\approx 0.01 + 0.60 \\times 0.000335 = 0.01 + 0.0002 = 0.0102\n$$\nThe reflectance in the NIR is extremely low. This is because liquid water is a very strong absorber of NIR radiation, as reflected by the high attenuation coefficient $c(0.86\\,\\mu\\mathrm{m}) = 4.00\\,\\mathrm{m}^{-1}$. The term $\\exp(-8)$ is nearly zero, meaning that virtually no NIR light penetrates to the bottom and returns to the sensor. The reflectance is therefore dominated by the small surface term, $R_w(0.86\\,\\mu\\mathrm{m})$.\n\nIn contrast, snow exhibits high reflectance in both bands: $\\rho_{\\mathrm{snow}}(0.55\\,\\mu\\mathrm{m}) = 0.85$ and $\\rho_{\\mathrm{snow}}(0.86\\,\\mu\\mathrm{m}) = 0.75$.\n\nThe key spectral difference is:\n-   **Shallow Lake**: High green reflectance ($R \\approx 0.35$), very low NIR reflectance ($R \\approx 0.01$).\n-   **Snow**: High green reflectance ($R = 0.85$), high NIR reflectance ($R = 0.75$).\n\nThis difference forms the basis for a robust classification algorithm.\n\n**Part 2: Propose and Evaluate a Spectral Ratio**\n\nA ratio using the green and NIR bands should effectively separate these two surface types. We now evaluate the provided options.\n\n**A. Use the near infrared to green ratio $R(0.86\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.86\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m}) > 0.50$.**\n-   For snow: Ratio = $\\rho_{\\mathrm{snow}}(0.86\\,\\mu\\mathrm{m}) / \\rho_{\\mathrm{snow}}(0.55\\,\\mu\\mathrm{m}) = 0.75 / 0.85 \\approx 0.882$. Since $0.882 > 0.50$, snow is correctly classified.\n-   For the shallow lake: Ratio = $R_{\\mathrm{lake}}(0.86\\,\\mu\\mathrm{m}) / R_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m}) \\approx 0.0102 / 0.3493 \\approx 0.029$. Since $0.029 < 0.50$, the shallow lake is correctly rejected (not classified as snow).\nThis ratio robustly exploits the strong NIR absorption by water, which makes the lake's ratio very low, while snow's ratio remains high (close to $1$). The threshold is well-posed.\n**Verdict: Correct.**\n\n**B. Use the blue to near infrared ratio $R(0.48\\,\\mu\\mathrm{m}) / R(0.86\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.48\\,\\mu\\mathrm{m}) / R(0.86\\,\\mu\\mathrm{m}) > 2.00$.**\n-   No data are given for $R(0.48\\,\\mu\\mathrm{m})$. However, for snow, reflectance in the blue is high and comparable to the NIR. Let's assume $\\rho_{\\mathrm{snow}}(0.48\\,\\mu\\mathrm{m}) \\approx 0.80$. The ratio would be $\\approx 0.80 / 0.75 \\approx 1.07$. Since $1.07 < 2.00$, this rule would fail to classify snow.\n**Verdict: Incorrect.**\n\n**C. Use the red to green ratio $R(0.66\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.66\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m}) > 1.00$.**\n-   No data are given for $R(0.66\\,\\mu\\mathrm{m})$. For snow, reflectance peaks in the visible spectrum and is typically flat or slightly decreasing from green to red. Therefore, the $R(\\text{red})/R(\\text{green})$ ratio for snow is expected to be $\\le 1.00$. The rule would fail to classify snow.\n**Verdict: Incorrect.**\n\n**D. Use the shortwave infrared to green ratio $R(1.6\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(1.6\\,\\mu\\mathrm{m}) / R(0.55\\,\\mu\\mathrm{m}) < 0.40$.**\n-   For snow: Ratio = $\\rho_{\\mathrm{snow}}(1.6\\,\\mu\\mathrm{m}) / \\rho_{\\mathrm{snow}}(0.55\\,\\mu\\mathrm{m}) = 0.30 / 0.85 \\approx 0.353$. Since $0.353 < 0.40$, snow is correctly classified.\n-   For the shallow lake: We must estimate $R_{\\mathrm{lake}}(1.6\\,\\mu\\mathrm{m})$. Water absorption at $1.6\\,\\mu\\mathrm{m}$ is extremely high (absorption coefficient $a_w \\gg 100\\,\\mathrm{m}^{-1}$), so the attenuation coefficient $c(1.6\\,\\mu\\mathrm{m})$ is very large. The bottom-reflected term is effectively zero. Thus, $R_{\\mathrm{lake}}(1.6\\,\\mu\\mathrm{m}) \\approx R_{w}(1.6\\,\\mu\\mathrm{m})$, which is a small surface reflectance term, typically around $0.01-0.02$. Using a value of $0.015$, the ratio is $R_{\\mathrm{lake}}(1.6\\,\\mu\\mathrm{m}) / R_{\\mathrm{lake}}(0.55\\,\\mu\\mathrm{m}) \\approx 0.015 / 0.3493 \\approx 0.043$. Since $0.043 < 0.40$, the shallow lake is incorrectly classified as snow. The threshold fails to separate the two classes.\n**Verdict: Incorrect.**\n\n**E. Use the green to shortwave infrared ratio $R(0.55\\,\\mu\\mathrm{m}) / R(1.6\\,\\mu\\mathrm{m})$ and classify a pixel as snow if $R(0.55\\,\\mu\\mathrm{m}) / R(1.6\\,\\mu\\mathrm{m}) > 3.00$.**\n-   This is the reciprocal of the ratio in D.\n-   For snow: Ratio = $\\rho_{\\mathrm{snow}}(0.55\\,\\mu\\mathrm{m}) / \\rho_{\\mathrm{snow}}(1.6\\,\\mu\\mathrm{m}) = 0.85 / 0.30 \\approx 2.83$. Since $2.83$ is not greater than $3.00$, this rule fails to classify snow.\n-   For the shallow lake: Ratio $\\approx 0.3493 / 0.015 \\approx 23.3$. Since $23.3 > 3.00$, this rule incorrectly classifies the lake as snow.\n**Verdict: Incorrect.**\n\nBased on the analysis, only Option A provides a physically sound and numerically verified method for discriminating between snow and shallow, sandy-bottom lakes. This approach is conceptually similar to the use of a Normalized Difference Water Index (NDWI), which is designed to highlight water bodies based on this very principle.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Many critical environmental features, such as melt ponds on sea ice, are often smaller than a satellite sensor's pixel resolution, creating mixed pixels. Detecting these 'subpixel' targets requires moving beyond simple indices to more sophisticated statistical detection methods. This advanced exercise  guides you through the design of a powerful subpixel detector based on linear spectral unmixing and matched filtering. You will learn to formulate the problem in a signal processing framework, separating the target water signature from a background of snow and ice, and to establish a decision threshold based on a statistically principled false-alarm rate.",
            "id": "3855151",
            "problem": "You are provided with a physically sound scenario for detecting subpixel melt ponds on sea ice using multi-band residual analysis grounded in spectral unmixing. The measurement is of unitless directional surface reflectance across a set of discrete wavelengths observed by a nadir-viewing passive optical sensor. The task is to derive, implement, and evaluate a detector for melt pond presence from first principles of spectral mixing and noise modeling, and to justify a statistically principled thresholding rule based on a prescribed false-alarm rate.\n\nAssume a linear mixing model for top-of-atmosphere reflectance in each band driven by surface components and small additive measurement-modeling noise. Let $\\mathbf{y} \\in \\mathbb{R}^B$ denote the measured reflectance vector over $B$ spectral bands. Under the null hypothesis of no water, the reflectance can be modeled as a linear combination of snow and ice endmembers plus noise. Under the alternative, an additional melt pond (open water) component contributes to the reflectance. The endmember spectra for snow, ice, and water are fixed and known. Assume additive noise is Gaussian with zero mean and known diagonal covariance.\n\nFundamental base and assumptions to use:\n- The spectral measurement in each band is modeled as a linear combination of endmember reflectances plus additive noise: the linearity assumption arises from areal mixture of Lambertian components and is widely used for optically thin conditions and moderate illumination geometry.\n- The additive noise is independent across bands, zero mean, Gaussian distributed, with known variances; the measurement covariance is diagonal.\n- The water endmember has a distinct spectral signature characterized by low near-infrared and short-wave infrared reflectance relative to snow and ice.\n\nYour task:\n1. Formulate a residual-based detection method that fits the snow and ice contributions to the measured reflectance using a statistically appropriate least-squares criterion under the given noise model to produce a residual vector. Then propose a noise-aware scalar detection statistic that measures the alignment of the residual with the direction of the water spectral signature in a noise-whitened sense.\n2. Justify a threshold selection criterion that achieves a specified false-alarm probability under the null hypothesis using appropriate distributional arguments, and apply it as a one-sided test for melt pond presence.\n3. Implement the detector for the provided test suite and report boolean detection outcomes.\n\nUse the following fixed spectral band centers (for interpretability only): $[0.48, 0.56, 0.66, 0.86, 1.60, 2.20]$ micrometers. All reflectances are unitless. The endmember reflectance spectra for water, snow, and ice are given as:\n- Water $\\mathbf{w}$: $[0.060, 0.050, 0.040, 0.020, 0.010, 0.005]$\n- Snow $\\mathbf{s}$: $[0.950, 0.900, 0.850, 0.650, 0.350, 0.250]$\n- Ice $\\mathbf{i}$: $[0.700, 0.650, 0.600, 0.400, 0.200, 0.150]$\n\nAssume a diagonal noise covariance matrix $\\boldsymbol{\\Sigma} = \\mathrm{diag}(\\sigma^2, \\sigma^2, \\sigma^2, \\sigma^2, \\sigma^2, \\sigma^2)$ with $\\sigma = 0.01$ (unitless reflectance). The false-alarm probability under the null hypothesis must be set to the decimal value $\\alpha = 0.05$.\n\nTest suite:\nConstruct the measured reflectance vectors $\\mathbf{y}$ (unitless) for the following five cases, each formed as a deterministic linear mixture of the endmembers plus an additive deterministic perturbation vector to represent small fixed measurement-modeling error. In each case, the mixture coefficients are nonnegative and sum to one.\n- Case $1$ (no melt pond, snow-ice mixture): $\\mathbf{y}_1 = 0.60\\,\\mathbf{s} + 0.40\\,\\mathbf{i} + \\mathbf{n}_1$ where $\\mathbf{n}_1 = [0.0000, -0.0010, 0.0010, -0.0005, 0.0005, -0.0003]$.\n- Case $2$ (small subpixel melt pond): $\\mathbf{y}_2 = 0.10\\,\\mathbf{w} + 0.55\\,\\mathbf{s} + 0.35\\,\\mathbf{i} + \\mathbf{n}_2$ where $\\mathbf{n}_2 = [0.0005, -0.0005, 0.0003, -0.0002, 0.0002, -0.0001]$.\n- Case $3$ (near-threshold melt pond): $\\mathbf{y}_3 = 0.03\\,\\mathbf{w} + 0.60\\,\\mathbf{s} + 0.37\\,\\mathbf{i} + \\mathbf{n}_3$ where $\\mathbf{n}_3 = [-0.0003, 0.0002, -0.0002, 0.0001, -0.0001, 0.0001]$.\n- Case $4$ (adjacency effect in visible, no true pond): $\\mathbf{y}_4 = 0.58\\,\\mathbf{s} + 0.42\\,\\mathbf{i} + \\mathbf{a} + \\mathbf{n}_4$ where $\\mathbf{a} = [0.0100, 0.0100, 0.0000, 0.0000, 0.0000, 0.0000]$ and $\\mathbf{n}_4 = [0.0002, -0.0002, 0.0001, -0.0001, 0.0001, -0.0001]$.\n- Case $5$ (pronounced melt pond): $\\mathbf{y}_5 = 0.25\\,\\mathbf{w} + 0.50\\,\\mathbf{s} + 0.25\\,\\mathbf{i} + \\mathbf{n}_5$ where $\\mathbf{n}_5 = [0.0003, -0.0004, 0.0003, -0.0003, 0.0002, -0.0002]$.\n\nProgram requirements:\n- Using only the information above, implement the residual-based detector with statistically justified thresholding for the specified $\\alpha$.\n- For each test case, return a boolean value indicating whether a subpixel melt pond is detected.\n- Final output format: your program should produce a single line of output containing the five boolean results as a comma-separated list enclosed in square brackets, in order of Cases $1$ through $5$ (for example, $[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{False},\\mathrm{True}]$).",
            "solution": "The problem requires the formulation and implementation of a statistically principled detector for subpixel melt ponds on sea ice. The approach will be based on a linear spectral mixing model and residual analysis. The core of the task is to derive a detection statistic, determine its distribution under the null hypothesis (no melt pond), and establish a decision threshold corresponding to a specified false-alarm probability.\n\n### Step 1: Mathematical Model Formulation\n\nThe measured directional surface reflectance vector over $B$ spectral bands, denoted $\\mathbf{y} \\in \\mathbb{R}^B$, is modeled as a linear combination of constituent endmember spectra plus additive noise. The endmembers are water ($\\mathbf{w}$), snow ($\\mathbf{s}$), and ice ($\\mathbf{i}$), all in $\\mathbb{R}^B$. The noise vector $\\boldsymbol{\\epsilon}$ is assumed to be zero-mean Gaussian with a diagonal covariance matrix $\\boldsymbol{\\Sigma}$, i.e., $\\boldsymbol{\\epsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\boldsymbol{\\Sigma})$.\n\nWe formulate two competing hypotheses:\n1.  The null hypothesis, $H_0$, posits that no water is present. The observed reflectance is a mixture of only snow and ice.\n    $$H_0: \\mathbf{y} = c_s \\mathbf{s} + c_i \\mathbf{i} + \\boldsymbol{\\epsilon}$$\n    In matrix form, this is $\\mathbf{y} = \\mathbf{M}\\mathbf{c} + \\boldsymbol{\\epsilon}$, where $\\mathbf{M} = [\\mathbf{s}\\ \\mathbf{i}]$ is a $B \\times 2$ matrix of background endmembers and $\\mathbf{c} = [c_s, c_i]^T$ is the vector of their fractional abundances.\n\n2.  The alternative hypothesis, $H_1$, posits that water is present in addition to snow and ice.\n    $$H_1: \\mathbf{y} = a_w \\mathbf{w} + c_s \\mathbf{s} + c_i \\mathbf{i} + \\boldsymbol{\\epsilon}$$\n    In matrix form, this is $\\mathbf{y} = a_w \\mathbf{w} + \\mathbf{M}\\mathbf{c} + \\boldsymbol{\\epsilon}$, where $a_w > 0$ is the abundance of the water component.\n\nThe noise covariance matrix is given as $\\boldsymbol{\\Sigma} = \\mathrm{diag}(\\sigma^2, \\ldots, \\sigma^2) = \\sigma^2\\mathbf{I}$, where $\\mathbf{I}$ is the $B \\times B$ identity matrix and $\\sigma = 0.01$.\n\n### Step 2: Derivation of the Detection Statistic\n\nThe detection strategy is to first remove the contribution of the known background components (snow and ice) and then to test the residual for the presence of the water signature. This is a classic matched filter detection problem.\n\nTo properly account for the noise statistics, we transform the model into a \"whitened\" space where the noise is identity-covariance. The whitening transformation is multiplication by $\\boldsymbol{\\Sigma}^{-1/2}$. Let $\\tilde{\\mathbf{z}} = \\boldsymbol{\\Sigma}^{-1/2}\\mathbf{z}$ for any vector $\\mathbf{z}$. The hypotheses become:\n$$ \\tilde{H}_0: \\tilde{\\mathbf{y}} = \\tilde{\\mathbf{M}}\\mathbf{c} + \\tilde{\\boldsymbol{\\epsilon}} $$\n$$ \\tilde{H}_1: \\tilde{\\mathbf{y}} = a_w \\tilde{\\mathbf{w}} + \\tilde{\\mathbf{M}}\\mathbf{c} + \\tilde{\\boldsymbol{\\epsilon}} $$\nwhere the whitened noise $\\tilde{\\boldsymbol{\\epsilon}} = \\boldsymbol{\\Sigma}^{-1/2}\\boldsymbol{\\epsilon}$ has the distribution $\\tilde{\\boldsymbol{\\epsilon}} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I})$.\n\nThe influence of the background term $\\tilde{\\mathbf{M}}\\mathbf{c}$ is removed by projecting the data onto the subspace orthogonal to the column space of $\\tilde{\\mathbf{M}}$. The operator for this projection is $\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} = \\mathbf{I} - \\tilde{\\mathbf{M}}(\\tilde{\\mathbf{M}}^T\\tilde{\\mathbf{M}})^{-1}\\tilde{\\mathbf{M}}^T$. Applying this projector to the whitened data vector $\\tilde{\\mathbf{y}}$ yields the whitened residual vector $\\tilde{\\mathbf{r}}$:\n$$ \\tilde{\\mathbf{r}} = \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{y}} $$\nUnder the two hypotheses, the whitened residual becomes:\n$$ H_0: \\tilde{\\mathbf{r}} = \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\boldsymbol{\\epsilon}} $$\n$$ H_1: \\tilde{\\mathbf{r}} = a_w \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}} + \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\boldsymbol{\\epsilon}} $$\nThe detection problem is now reduced to finding the signal $a_w \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}$ in noise $\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\boldsymbol{\\epsilon}}$. The optimal detector for a known signal shape in Gaussian noise is a matched filter, which projects the observed data onto the known signal direction. The signal direction is $\\mathbf{d} = \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}$.\n\nThe detection statistic $T$ is the projection of the whitened residual $\\tilde{\\mathbf{r}}$ onto the normalized signal vector $\\hat{\\mathbf{d}} = \\mathbf{d} / \\|\\mathbf{d}\\|_2$:\n$$ T = \\hat{\\mathbf{d}}^T \\tilde{\\mathbf{r}} = \\frac{(\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}})^T \\tilde{\\mathbf{r}}}{\\|\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}\\|_2} $$\nSince $\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp}$ is a symmetric and idempotent projection matrix, i.e., $(\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp})^T = \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp}$ and $\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} = \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp}$, the numerator can be simplified:\n$$ (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}})^T \\tilde{\\mathbf{r}} = (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}})^T (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{y}}) = \\tilde{\\mathbf{w}}^T (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp})^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{y}} = \\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{y}} $$\nThe squared norm in the denominator is $\\|\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}\\|_2^2 = (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}})^T (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}) = \\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}$.\nThus, the detection statistic is:\n$$ T = \\frac{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{y}}}{\\sqrt{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}}} $$\n\n### Step 3: Distributional Analysis and Threshold Selection\n\nTo set a threshold, we must determine the probability distribution of $T$ under the null hypothesis $H_0$. Under $H_0$, we have $\\tilde{\\mathbf{r}} = \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\boldsymbol{\\epsilon}}$. Substituting into the definition of $T$:\n$$ T | H_0 = \\frac{(\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}})^T (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\boldsymbol{\\epsilon}})}{\\|\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}\\|_2} = \\frac{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\boldsymbol{\\epsilon}}}{\\sqrt{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}}} $$\nThis statistic is a linear combination of the components of $\\tilde{\\boldsymbol{\\epsilon}}$, which are independent standard normal random variables. Therefore, $T$ is itself normally distributed.\nThe mean of $T$ under $H_0$ is:\n$$ E[T|H_0] = \\frac{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} E[\\tilde{\\boldsymbol{\\epsilon}}]}{\\sqrt{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}}} = 0 $$\nsince $E[\\tilde{\\boldsymbol{\\epsilon}}] = \\mathbf{0}$.\nThe variance of $T$ under $H_0$ is:\n$$ \\mathrm{Var}(T|H_0) = \\frac{(\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp}) \\mathrm{Cov}(\\tilde{\\boldsymbol{\\epsilon}}) (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}})}{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}} = \\frac{(\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp}) \\mathbf{I} (\\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}})}{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}} = \\frac{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}}{\\tilde{\\mathbf{w}}^T \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} \\tilde{\\mathbf{w}}} = 1 $$\nThus, under the null hypothesis, the detection statistic follows a standard normal distribution: $T | H_0 \\sim \\mathcal{N}(0, 1)$.\n\nWe require a one-sided test for the presence of water ($a_w > 0$), which will correspond to large positive values of $T$. The threshold $\\tau$ is set to achieve a specified false-alarm probability $\\alpha$.\n$$ P(T > \\tau | H_0) = \\alpha $$\nFor $T \\sim \\mathcal{N}(0, 1)$, $\\tau$ is the upper $\\alpha$-quantile of the standard normal distribution, commonly denoted $z_\\alpha$. This is the value such that $\\Phi(\\tau) = 1 - \\alpha$, where $\\Phi$ is the standard normal cumulative distribution function. For the specified $\\alpha = 0.05$, the threshold is $\\tau = z_{0.05} \\approx 1.64485$. The decision rule is: a melt pond is detected if $T > \\tau$.\n\n### Step 4: Implementation Details\n\nFor the given problem, the noise is homoscedastic: $\\boldsymbol{\\Sigma} = \\sigma^2\\mathbf{I}$. This simplifies the calculations.\n$$ \\boldsymbol{\\Sigma}^{-1/2} = \\frac{1}{\\sigma}\\mathbf{I} $$\nTherefore, $\\tilde{\\mathbf{w}} = \\frac{1}{\\sigma}\\mathbf{w}$, $\\tilde{\\mathbf{y}} = \\frac{1}{\\sigma}\\mathbf{y}$, and $\\tilde{\\mathbf{M}} = \\frac{1}{\\sigma}\\mathbf{M}$.\nThe projection matrix is:\n$$ \\mathbf{P}_{\\tilde{\\mathbf{M}}}^{\\perp} = \\mathbf{I} - (\\frac{1}{\\sigma}\\mathbf{M})\\left((\\frac{1}{\\sigma}\\mathbf{M})^T(\\frac{1}{\\sigma}\\mathbf{M})\\right)^{-1}(\\frac{1}{\\sigma}\\mathbf{M})^T = \\mathbf{I} - \\mathbf{M}(\\mathbf{M}^T\\mathbf{M})^{-1}\\mathbf{M}^T = \\mathbf{P}_{\\mathbf{M}}^{\\perp} $$\nThe projection matrix is independent of $\\sigma$. Substituting these into the formula for $T$:\n$$ T = \\frac{(\\frac{1}{\\sigma}\\mathbf{w})^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} (\\frac{1}{\\sigma}\\mathbf{y})}{\\sqrt{(\\frac{1}{\\sigma}\\mathbf{w})^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} (\\frac{1}{\\sigma}\\mathbf{w})}} = \\frac{\\frac{1}{\\sigma^2} \\mathbf{w}^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} \\mathbf{y}}{\\frac{1}{\\sigma}\\sqrt{\\mathbf{w}^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} \\mathbf{w}}} = \\frac{1}{\\sigma} \\frac{\\mathbf{w}^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} \\mathbf{y}}{\\sqrt{\\mathbf{w}^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} \\mathbf{w}}} $$\nThis is the final expression to be implemented. The algorithm proceeds as follows:\n1.  Construct the background matrix $\\mathbf{M}=[\\mathbf{s}, \\mathbf{i}]$.\n2.  Compute the projection matrix $\\mathbf{P}_{\\mathbf{M}}^{\\perp} = \\mathbf{I} - \\mathbf{M}(\\mathbf{M}^T\\mathbf{M})^{-1}\\mathbf{M}^T$.\n3.  Compute the constant denominator term $D = \\sqrt{\\mathbf{w}^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} \\mathbf{w}}$.\n4.  Calculate the threshold $\\tau = z_{0.05}$ from the standard normal distribution.\n5.  For each test case $\\mathbf{y}_k$:\n    a. Compute the numerator term $N_k = \\mathbf{w}^T \\mathbf{P}_{\\mathbf{M}}^{\\perp} \\mathbf{y}_k$.\n    b. Compute the statistic $T_k = \\frac{1}{\\sigma} \\frac{N_k}{D}$.\n    c. The detection result is $\\mathrm{True}$ if $T_k > \\tau$, and $\\mathrm{False}$ otherwise.\nThis structured approach provides a robust, statistically justified method for detecting the subpixel water signature.",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Implements a residual-based detector for subpixel melt ponds on sea ice.\n\n    The method uses a matched filter approach on the residual signal after\n    projecting out the background signatures of snow and ice in a noise-whitened\n    space. A detection threshold is determined from the null distribution of the\n    test statistic for a specified false-alarm rate.\n    \"\"\"\n\n    # --- Step 1: Define Givens and Constants ---\n\n    # Endmember reflectance spectra (unitless)\n    w = np.array([0.060, 0.050, 0.040, 0.020, 0.010, 0.005])  # Water\n    s = np.array([0.950, 0.900, 0.850, 0.650, 0.350, 0.250])  # Snow\n    i = np.array([0.700, 0.650, 0.600, 0.400, 0.200, 0.150])  # Ice\n\n    # Noise model parameters\n    sigma = 0.01  # Standard deviation of noise (unitless reflectance)\n    \n    # Statistical test parameters\n    alpha = 0.05  # False-alarm probability\n\n    # --- Step 2: Construct Test Cases ---\n\n    test_cases_defs = [\n        {'mix': {'s': 0.60, 'i': 0.40}, 'n': [0.0000, -0.0010, 0.0010, -0.0005, 0.0005, -0.0003]},\n        {'mix': {'w': 0.10, 's': 0.55, 'i': 0.35}, 'n': [0.0005, -0.0005, 0.0003, -0.0002, 0.0002, -0.0001]},\n        {'mix': {'w': 0.03, 's': 0.60, 'i': 0.37}, 'n': [-0.0003, 0.0002, -0.0002, 0.0001, -0.0001, 0.0001]},\n        {'mix': {'s': 0.58, 'i': 0.42}, 'n': [0.0002, -0.0002, 0.0001, -0.0001, 0.0001, -0.0001], 'a': [0.0100, 0.0100, 0.0000, 0.0000, 0.0000, 0.0000]},\n        {'mix': {'w': 0.25, 's': 0.50, 'i': 0.25}, 'n': [0.0003, -0.0004, 0.0003, -0.0003, 0.0002, -0.0002]},\n    ]\n    \n    test_vectors_y = []\n    for case in test_cases_defs:\n        y = np.zeros_like(w)\n        if 'w' in case['mix']: y += case['mix']['w'] * w\n        if 's' in case['mix']: y += case['mix']['s'] * s\n        if 'i' in case['mix']: y += case['mix']['i'] * i\n        if 'a' in case: y += np.array(case['a'])\n        y += np.array(case['n'])\n        test_vectors_y.append(y)\n\n    # --- Step 3: Formulate and Apply the Detector ---\n\n    # Background endmember matrix M = [s, i]\n    # np.vstack stacks arrays row-wise, so we transpose to get column vectors.\n    M = np.vstack((s, i)).T\n    \n    # Number of spectral bands\n    B = w.shape[0]\n    \n    # Identity matrix\n    I_B = np.identity(B)\n    \n    # Projection matrix onto the subspace orthogonal to the background\n    # P_perp = I - M * inv(M.T * M) * M.T\n    P_perp = I_B - M @ np.linalg.inv(M.T @ M) @ M.T\n\n    # The residual target signature is the part of w orthogonal to the M-subspace\n    w_res = P_perp @ w\n    \n    # The denominator of the test statistic T, a constant term.\n    # It is the L2-norm of the residual target signature.\n    # D_term = sqrt(w.T * P_perp * w)\n    D_term = np.linalg.norm(w_res)\n\n    # Calculate the detection threshold from the standard normal cdf\n    # tau is the value such that P(Z > tau) = alpha for Z ~ N(0,1)\n    tau = norm.ppf(1 - alpha)\n    \n    detection_results = []\n    for y in test_vectors_y:\n        # The residual of the measurement y is the part orthogonal to the M-subspace\n        y_res = P_perp @ y\n        \n        # The numerator of the test statistic T is related to the dot product\n        # of the residual measurement and the residual target signature.\n        # N_term = w.T * P_perp * y\n        N_term = w_res.T @ y_res\n\n        # Calculate the test statistic T\n        T = (1 / sigma) * (N_term / D_term)\n        \n        # Apply the one-sided test\n        is_detected = T > tau\n        detection_results.append(is_detected)\n\n    # --- Step 4: Format and Print the Final Output ---\n    # The final output must be a single-line string representation of the list.\n    # e.g., [True,False,True,False,True]\n    result_str = f\"[{','.join(map(str, detection_results))}]\"\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}