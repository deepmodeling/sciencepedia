{
    "hands_on_practices": [
        {
            "introduction": "The first and most critical step in continuum removal is defining the continuum itself, a task that requires careful consideration when dealing with real-world data. A valid continuum must act as an upper envelope for the absorption feature, and local spectral curvature, measured by the second derivative, provides a quantitative way to distinguish the feature from the smoother background. This exercise  challenges you to formalize the criteria for robustly selecting these anchor points, a crucial skill for developing automated and reliable spectral analysis workflows.",
            "id": "3801808",
            "problem": "A hyperspectral reflectance spectrum $R(\\lambda)$ measured from a vegetated canopy exhibits a target absorption band centered at wavelength $\\lambda_0$ associated with liquid water. Continuum removal will be performed by fitting a linear continuum across the band using two anchor points at wavelengths $\\lambda_L$ and $\\lambda_R$ that lie on either side of $\\lambda_0$. Consider the following fundamental base:\n\n- In a scattering-dominated medium with a localized absorber, the reflectance can be modeled as $R(\\lambda) = B(\\lambda) - A\\,g(\\lambda - \\lambda_0)$, where $B(\\lambda)$ is a slowly varying baseline (the continuum), $A > 0$ is the band amplitude, and $g(\\cdot)$ is a nonnegative bell-shaped function peaked at $0$ (for example, a Gaussian). Under this model, the absorption band produces a local depression in $R(\\lambda)$ around $\\lambda_0$.\n- Derivative spectroscopy identifies local shape changes through the first derivative $R'(\\lambda)$ (slope) and the second derivative $R''(\\lambda)$ (curvature). At the band center, $R'(\\lambda_0) \\approx 0$ and $R''(\\lambda_0) > 0$ (concave up), while the slowly varying baseline has comparatively small curvature, i.e., $|B''(\\lambda)|$ is small across spectral neighborhoods without sharp features.\n- A valid linear continuum for continuum removal must form an upper envelope across the band interval, so that $R(\\tilde{\\lambda}) \\le R_{\\text{cont}}(\\tilde{\\lambda})$ for all $\\tilde{\\lambda}$ between $\\lambda_L$ and $\\lambda_R$, where $R_{\\text{cont}}(\\tilde{\\lambda})$ is the straight line passing through $(\\lambda_L, R(\\lambda_L))$ and $(\\lambda_R, R(\\lambda_R))$. This requirement prevents the fitted continuum from intersecting the depression caused by the absorption feature.\n\nSuppose the second derivative $R''(\\lambda)$ is estimated with sufficient spectral resolution using a smoothing operator whose noise in $R''$ is characterized by a standard deviation $\\sigma_{R''}$. For robust continuum placement, one must ensure that band-induced curvature is excluded while the baseline is well represented. Based on these fundamentals, which set of criteria correctly specifies how to select and justify the placement of the anchor points $(\\lambda_L, \\lambda_R)$ using local spectral curvature and related constraints?\n\nA. Select the nearest wavelengths on either side of $\\lambda_0$ such that $|R''(\\lambda)| < \\tau$ with $\\tau$ chosen as a small multiple of $\\sigma_{R''}$ (for example, $\\tau = 3\\sigma_{R''}$), and ensure that $(\\lambda_L, R(\\lambda_L))$ and $(\\lambda_R, R(\\lambda_R))$ lie on the convex hull of $R(\\lambda)$ in the neighborhood of the band. Verify the upper-envelope condition $R(\\tilde{\\lambda}) \\le R_{\\text{cont}}(\\tilde{\\lambda})$ for all $\\tilde{\\lambda} \\in [\\lambda_L, \\lambda_R]$, exclude wavelengths contaminated by atmospheric lines or sensor artifacts, and prefer anchors with high signal-to-noise ratio. The curvature threshold filters out the concave-up band interior (where $R''(\\lambda) > 0$) and favors baseline regions where the continuum is approximately linear.\n\nB. Select the two inflection points flanking $\\lambda_0$, defined by $R''(\\lambda) = 0$ on either side, and require $|R'(\\lambda)|$ to be maximal at those points so that the shoulders of the band are captured. This guarantees the continuum anchors are located at the most rapidly changing parts of the spectrum and therefore bracket the band.\n\nC. Select the two nearest local minima of $R(\\lambda)$ surrounding $\\lambda_0$ so that the continuum is fit through the deepest parts of the absorption. This minimizes the chance that the continuum line sits above the data and thus avoids over-normalizing the band depth upon continuum removal.\n\nD. Select anchors symmetrically positioned about $\\lambda_0$ so that $\\lambda_R - \\lambda_0 = \\lambda_0 - \\lambda_L$, regardless of the behavior of $R''(\\lambda)$ or the convex hull. Symmetry ensures the linear continuum does not introduce bias from baseline slope and removes the need for curvature-based checks.\n\nAssume the instrument spectral sampling is sufficiently fine that $R'(\\lambda)$ and $R''(\\lambda)$ are reliable wherever the signal-to-noise ratio is high, and that standard atmospheric absorption windows are known a priori.",
            "solution": "The user has provided a problem statement regarding the selection of anchor points for continuum removal in hyperspectral analysis and a set of options outlining potential criteria.\n\n### Problem Statement Validation\n\nFirst, I will validate the problem statement according to the specified procedure.\n\n**Step 1: Extract Givens**\n-   The subject is a hyperspectral reflectance spectrum, denoted as $R(\\lambda)$.\n-   There is a target absorption band centered at wavelength $\\lambda_0$.\n-   Continuum removal is to be performed by fitting a linear continuum, $R_{\\text{cont}}(\\tilde{\\lambda})$, using two anchor points at wavelengths $\\lambda_L$ and $\\lambda_R$ where $\\lambda_L < \\lambda_0 < \\lambda_R$.\n-   A conceptual model for reflectance is given: $R(\\lambda) = B(\\lambda) - A\\,g(\\lambda - \\lambda_0)$.\n    -   $B(\\lambda)$ is a slowly varying baseline.\n    -   $A > 0$ is the band amplitude.\n    -   $g(\\cdot)$ is a nonnegative bell-shaped function peaked at $0$.\n-   Derivative spectroscopy properties are provided:\n    -   At the band center $\\lambda_0$, $R'(\\lambda_0) \\approx 0$ and $R''(\\lambda_0) > 0$ (concave up).\n    -   The baseline's second derivative, $|B''(\\lambda)|$, is small.\n-   A critical validity condition for the continuum is stated: $R(\\tilde{\\lambda}) \\le R_{\\text{cont}}(\\tilde{\\lambda})$ for all $\\tilde{\\lambda}$ in the interval $[\\lambda_L, \\lambda_R]$. This defines an \"upper envelope\".\n-   The second derivative $R''(\\lambda)$ is estimated with noise characterized by a standard deviation $\\sigma_{R''}$.\n-   The objective is to identify the correct criteria for selecting the anchor points $(\\lambda_L, \\lambda_R)$ using local spectral curvature and other constraints.\n-   Assumptions: The spectral sampling is fine enough for reliable derivative calculation, and atmospheric absorption windows are known.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem statement is firmly grounded in the principles of optical spectroscopy, remote sensing, and numerical analysis. The model $R(\\lambda) = B(\\lambda) - A\\,g(\\lambda - \\lambda_0)$ is a standard representation of an absorption feature superimposed on a continuum background. The analysis of derivatives to characterize the feature's shape (slope $R'$ and curvature $R''$) is a fundamental technique in derivative spectroscopy. Specifically, a local minimum (an absorption band in reflectance) must have a positive second derivative ($R''(\\lambda_0) > 0$) at its center, which is correctly stated. The requirement for the continuum to be an upper envelope is a cornerstone of valid continuum removal for analyzing absorption band depth and area. All concepts are standard and scientifically sound.\n-   **Well-Posed:** The problem is well-posed. It provides a clear objective and sufficient theoretical background (the \"fundamental base\") to logically deduce which set of criteria is superior for achieving a robust continuum fit. A unique, best answer among the options can be determined through rigorous application of these principles.\n-   **Objective:** The language is formal, precise, and devoid of subjective claims. All terms like \"continuum,\" \"curvature,\" \"convex hull,\" and \"upper envelope\" have well-defined mathematical or physical meanings in this context.\n\n**Step 3: Verdict and Action**\nThe problem statement is scientifically sound, well-posed, and objective. It contains no contradictions, ambiguities, or factual errors. Therefore, the problem is **valid**. I will proceed with the detailed solution and evaluation of the options.\n\n### Solution Derivation and Option Analysis\n\nThe core task is to identify a robust set of criteria for placing the continuum anchor points $(\\lambda_L, R(\\lambda_L))$ and $(\\lambda_R, R(\\lambda_R))$. The provided fundamentals establish three primary requirements for these anchors:\n1.  **Location on the Baseline**: The anchors should be placed in regions where the spectral shape is dominated by the slowly varying baseline $B(\\lambda)$, not the absorption feature itself. The problem states this corresponds to regions of low curvature, i.e., where $|R''(\\lambda)|$ is small. Conversely, the interior of the absorption band is characterized by large positive curvature, $R''(\\lambda) > 0$.\n2.  **Upper Envelope Constraint**: The linear continuum $R_{\\text{cont}}(\\tilde{\\lambda})$ connecting the anchors must lie on or above the reflectance spectrum $R(\\tilde{\\lambda})$ for all wavelengths $\\tilde{\\lambda}$ between $\\lambda_L$ and $\\lambda_R$.\n3.  **Practical Robustness**: The selection process must account for real-world data imperfections, such as noise, sensor artifacts, and atmospheric interference.\n\nUsing these requirements, I will now evaluate each option.\n\n**A. Select the nearest wavelengths on either side of $\\lambda_0$ such that $|R''(\\lambda)| < \\tau$ with $\\tau$ chosen as a small multiple of $\\sigma_{R''}$ (for example, $\\tau = 3\\sigma_{R''}$), and ensure that $(\\lambda_L, R(\\lambda_L))$ and $(\\lambda_R, R(\\lambda_R))$ lie on the convex hull of $R(\\lambda)$ in the neighborhood of the band. Verify the upper-envelope condition $R(\\tilde{\\lambda}) \\le R_{\\text{cont}}(\\tilde{\\lambda})$ for all $\\tilde{\\lambda} \\in [\\lambda_L, \\lambda_R]$, exclude wavelengths contaminated by atmospheric lines or sensor artifacts, and prefer anchors with high signal-to-noise ratio. The curvature threshold filters out the concave-up band interior (where $R''(\\lambda) > 0$) and favors baseline regions where the continuum is approximately linear.**\n\n-   **Analysis**: This option presents a multi-faceted, robust strategy.\n    -   The criterion $|R''(\\lambda)| < \\tau$, with $\\tau$ based on the noise level $\\sigma_{R''}$, directly implements Requirement 1. It provides a statistically meaningful way to distinguish the significant curvature of the absorption feature from the near-zero curvature of the baseline plus noise. This correctly identifies the \"shoulders\" or baseline regions adjacent to the band.\n    -   The requirement that the anchors lie on the convex hull of the spectrum in that neighborhood is a mathematically direct and elegant way to satisfy Requirement 2. A line segment connecting two points on the upper convex hull of a function's graph cannot intersect the graph between those points. This guarantees the upper-envelope condition.\n    -   The explicit inclusion of checks for atmospheric contamination and signal-to-noise ratio addresses Requirement 3, ensuring the procedure is practical and reliable for real data.\n    -   The justification provided within the option—that the curvature threshold filters out the band's interior—is correct.\n-   **Verdict**: **Correct**. This option cohesively integrates all the necessary theoretical and practical considerations for robust continuum anchor selection as laid out in the problem's fundamental base.\n\n**B. Select the two inflection points flanking $\\lambda_0$, defined by $R''(\\lambda) = 0$ on either side, and require $|R'(\\lambda)|$ to be maximal at those points so that the shoulders of the band are captured. This guarantees the continuum anchors are located at the most rapidly changing parts of the spectrum and therefore bracket the band.**\n\n-   **Analysis**: This option proposes using the inflection points as anchors. An inflection point is where the curvature $R''(\\lambda)$ is zero. For an absorption feature superimposed on a flat baseline, this is where the concavity changes. These points are, by definition, part of the absorption feature's structure, not the adjacent baseline. Placing the anchors at the inflection points means the straight line connecting them will necessarily \"cut through\" the shoulders of the absorption feature, as the reflectance between the inflection point and the edge of the feature is typically higher. This fundamentally violates the upper-envelope constraint (Requirement 2). While these points bracket the central part of the band, they do not define its full extent on the baseline.\n-   **Verdict**: **Incorrect**. This method fails to produce a valid continuum that acts as an upper envelope for the entire absorption feature.\n\n**C. Select the two nearest local minima of $R(\\lambda)$ surrounding $\\lambda_0$ so that the continuum is fit through the deepest parts of the absorption. This minimizes the chance that the continuum line sits above the data and thus avoids over-normalizing the band depth upon continuum removal.**\n\n-   **Analysis**: This option is based on a fundamental misunderstanding of continuum removal. The feature of interest at $\\lambda_0$ is itself a local minimum in reflectance. Selecting other local minima (which would likely correspond to other absorption features) as anchors is irrelevant to bracketing the feature at $\\lambda_0$. Furthermore, the explicit goal stated is to \"minimize the chance that the continuum line sits above the data.\" This is the exact opposite of the required upper-envelope constraint (Requirement 2). A continuum must be an upper bound to properly normalize the band depth. Fitting a line through local minima would create a lower envelope, which is not a valid continuum for this purpose.\n-   **Verdict**: **Incorrect**. This procedure is conceptually flawed and directly contradicts the definition of a valid continuum for absorption analysis.\n\n**D. Select anchors symmetrically positioned about $\\lambda_0$ so that $\\lambda_R - \\lambda_0 = \\lambda_0 - \\lambda_L$, regardless of the behavior of $R''(\\lambda)$ or the convex hull. Symmetry ensures the linear continuum does not introduce bias from baseline slope and removes the need for curvature-based checks.**\n\n-   **Analysis**: This approach imposes an arbitrary symmetry constraint. Real-world reflectance spectra rarely exhibit perfect symmetry. Baselines are typically sloped (e.g., the vegetation red edge), and absorption features can be asymmetric due to overlapping bands or other physical processes. Forcing symmetric anchor placement in wavelength ($\\lambda$) space on an asymmetric feature or a sloped baseline will almost certainly lead to an incorrect continuum slope and an invalid fit, likely violating the upper-envelope constraint. The claim that this \"removes the need for curvature-based checks\" is a fallacy; it advocates for ignoring the most pertinent information (the spectral shape) in favor of a simplistic assumption that is generally not met in practice.\n-   **Verdict**: **Incorrect**. This rigid, data-agnostic approach is not robust and will fail in most realistic scenarios. It disregards the essential information provided by the spectrum's local curvature.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Once a spectrum has been normalized by continuum removal, the focus shifts to extracting quantitative information from the isolated absorption features. These features are often approximated by mathematical functions, like a Gaussian, whose parameters relate directly to physical properties of the material being observed. In this practice , you will derive the analytical link between the parameters of a Gaussian model ($A$ and $\\sigma$) and the observable metrics of Full Width at Half Maximum (FWHM) and band area, a fundamental skill for converting spectral shapes into meaningful physical measurements.",
            "id": "3801842",
            "problem": "A laboratory reflectance spectrum of a mineral sample has been continuum-removed, yielding a single, isolated absorption feature modeled by the function $R_{c}(\\lambda)=1-A\\exp\\!\\big(-(\\lambda-\\lambda_{0})^{2}/(2\\sigma^{2})\\big)$, where $\\lambda$ is wavelength, $A$ is the continuum-removed band depth with $0<A<1$, $\\lambda_{0}$ is the band center, and $\\sigma>0$ characterizes the Gaussian width. In remote sensing and environmental modeling, continuum removal normalizes local slope to unity, and derivative spectroscopy (DS) locates and characterizes absorptions by analyzing derivatives of $R_{c}(\\lambda)$.\n\nStarting from first principles and core definitions used in absorption analysis:\n- Define the absorption depth as $D(\\lambda)=1-R_{c}(\\lambda)$.\n- Define the Full Width at Half Maximum (FWHM) as the wavelength separation between the two points where $D(\\lambda)$ equals one-half of its maximum value.\n- Define the band area (also called equivalent width in continuum-removed space) as the integral over wavelength of $D(\\lambda)$, taken across the entire feature.\n\nDerive closed-form analytic expressions for the FWHM and the band area in terms of $A$ and $\\sigma$. Express the FWHM and the area in the same wavelength unit as $\\lambda$ (for example, nanometers). Provide your final answer as two expressions, with no rounding and no units, written in a single row matrix.",
            "solution": "The problem is validated against the required criteria before proceeding to a solution.\n\n### Step 1: Extract Givens\n- The continuum-removed reflectance spectrum is modeled by the function: $R_{c}(\\lambda)=1-A\\exp\\!\\big(-(\\lambda-\\lambda_{0})^{2}/(2\\sigma^{2})\\big)$.\n- $\\lambda$ is the wavelength.\n- $A$ is the continuum-removed band depth, with the constraint $0<A<1$.\n- $\\lambda_{0}$ is the band center.\n- $\\sigma$ is a parameter characterizing the Gaussian width, with the constraint $\\sigma>0$.\n- The absorption depth is defined as $D(\\lambda)=1-R_{c}(\\lambda)$.\n- The Full Width at Half Maximum (FWHM) is defined as the wavelength separation between the two points where $D(\\lambda)$ equals one-half of its maximum value.\n- The band area is defined as the integral of $D(\\lambda)$ over the entire wavelength range of the feature.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity.\n- **Scientifically Grounded**: The problem statement is based on established principles of spectroscopy and remote sensing. Modeling an absorption feature with a Gaussian function after continuum removal is a standard and scientifically sound technique. The definitions of absorption depth, FWHM, and band area (equivalent width) are fundamental concepts in this field. All premises are factually and scientifically sound.\n- **Well-Posed**: The problem provides a clear functional form, precise definitions, and unambiguous constraints on the parameters. The task is to derive two quantities, FWHM and band area, which are uniquely determined by the given information. Thus, a unique and meaningful solution exists.\n- **Objective**: The problem is stated in precise, technical language, free of any subjectivity, ambiguity, or opinion-based claims.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and objective. It does not violate any of the invalidity criteria. Therefore, the problem is **valid**. A full derivation of the solution will be provided.\n\n### Solution Derivation\n\nFirst, we derive the expression for the absorption depth, $D(\\lambda)$, using its definition and the given function for $R_c(\\lambda)$.\n$$D(\\lambda) = 1 - R_{c}(\\lambda)$$\nSubstituting the expression for $R_c(\\lambda)$:\n$$D(\\lambda) = 1 - \\left(1-A\\exp\\!\\left(-\\frac{(\\lambda-\\lambda_{0})^{2}}{2\\sigma^{2}}\\right)\\right)$$\n$$D(\\lambda) = A\\exp\\!\\left(-\\frac{(\\lambda-\\lambda_{0})^{2}}{2\\sigma^{2}}\\right)$$\nThis function, $D(\\lambda)$, is a Gaussian function with amplitude $A$, centered at $\\lambda = \\lambda_0$.\n\n**1. Derivation of the Full Width at Half Maximum (FWHM)**\n\nThe FWHM is determined based on the absorption depth $D(\\lambda)$.\nFirst, we find the maximum value of $D(\\lambda)$. The exponential term is maximal when its argument is $0$, which occurs at $\\lambda = \\lambda_0$. The maximum value of the exponential is $\\exp(0) = 1$.\nTherefore, the maximum absorption depth is:\n$$D_{\\text{max}} = D(\\lambda_0) = A \\cdot 1 = A$$\nThe half-maximum value is half of this, which is $\\frac{D_{\\text{max}}}{2} = \\frac{A}{2}$.\n\nNext, we find the wavelengths, let's call them $\\lambda_{\\text{half}}$, at which the absorption depth is equal to this half-maximum value. We set $D(\\lambda_{\\text{half}}) = \\frac{A}{2}$:\n$$A\\exp\\!\\left(-\\frac{(\\lambda_{\\text{half}}-\\lambda_{0})^{2}}{2\\sigma^{2}}\\right) = \\frac{A}{2}$$\nSince $A>0$, we can divide both sides by $A$:\n$$\\exp\\!\\left(-\\frac{(\\lambda_{\\text{half}}-\\lambda_{0})^{2}}{2\\sigma^{2}}\\right) = \\frac{1}{2}$$\nTaking the natural logarithm of both sides:\n$$-\\frac{(\\lambda_{\\text{half}}-\\lambda_{0})^{2}}{2\\sigma^{2}} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)$$\nMultiplying by $-1$ and rearranging to solve for $(\\lambda_{\\text{half}}-\\lambda_{0})^{2}$:\n$$(\\lambda_{\\text{half}}-\\lambda_{0})^{2} = 2\\sigma^{2}\\ln(2)$$\nTaking the square root of both sides yields two solutions for $(\\lambda_{\\text{half}}-\\lambda_{0})$:\n$$\\lambda_{\\text{half}}-\\lambda_{0} = \\pm\\sqrt{2\\sigma^{2}\\ln(2)} = \\pm\\sigma\\sqrt{2\\ln(2)}$$\nThis gives two wavelengths, $\\lambda_1$ and $\\lambda_2$, on either side of the center $\\lambda_0$:\n$$\\lambda_1 = \\lambda_0 - \\sigma\\sqrt{2\\ln(2)}$$\n$$\\lambda_2 = \\lambda_0 + \\sigma\\sqrt{2\\ln(2)}$$\nThe FWHM is defined as the separation between these two wavelengths:\n$$\\text{FWHM} = \\lambda_2 - \\lambda_1 = \\left(\\lambda_0 + \\sigma\\sqrt{2\\ln(2)}\\right) - \\left(\\lambda_0 - \\sigma\\sqrt{2\\ln(2)}\\right)$$\n$$\\text{FWHM} = 2\\sigma\\sqrt{2\\ln(2)}$$\n\n**2. Derivation of the Band Area**\n\nThe band area, which we denote as $\\mathcal{A}$, is the integral of the absorption depth $D(\\lambda)$ over all wavelengths. Mathematically, this is an integral from $-\\infty$ to $+\\infty$.\n$$\\mathcal{A} = \\int_{-\\infty}^{\\infty} D(\\lambda) \\, d\\lambda = \\int_{-\\infty}^{\\infty} A\\exp\\!\\left(-\\frac{(\\lambda-\\lambda_{0})^{2}}{2\\sigma^{2}}\\right) \\, d\\lambda$$\nSince $A$ is a constant, it can be taken outside the integral:\n$$\\mathcal{A} = A \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{(\\lambda-\\lambda_{0})^{2}}{2\\sigma^{2}}\\right) \\, d\\lambda$$\nThis is a standard Gaussian integral. We can solve it using a change of variables. Let $u = \\frac{\\lambda - \\lambda_0}{\\sigma\\sqrt{2}}$. Then $\\lambda - \\lambda_0 = u\\sigma\\sqrt{2}$, and $d\\lambda = \\sigma\\sqrt{2} \\, du$. The limits of integration from $-\\infty$ to $+\\infty$ are unchanged for $u$.\nThe exponent becomes:\n$$-\\frac{(\\lambda-\\lambda_{0})^{2}}{2\\sigma^{2}} = -\\frac{(u\\sigma\\sqrt{2})^2}{2\\sigma^2} = -\\frac{u^2 \\sigma^2 \\cdot 2}{2\\sigma^2} = -u^2$$\nSubstituting into the integral:\n$$\\mathcal{A} = A \\int_{-\\infty}^{\\infty} \\exp(-u^2) (\\sigma\\sqrt{2} \\, du)$$\n$$\\mathcal{A} = A\\sigma\\sqrt{2} \\int_{-\\infty}^{\\infty} \\exp(-u^2) \\, du$$\nThe definite integral $\\int_{-\\infty}^{\\infty} \\exp(-x^2) \\, dx$ is the well-known Gaussian integral, which evaluates to $\\sqrt{\\pi}$.\nTherefore, the band area is:\n$$\\mathcal{A} = A\\sigma\\sqrt{2} \\cdot \\sqrt{\\pi} = A\\sigma\\sqrt{2\\pi}$$\n\nThe two derived expressions are:\n- FWHM = $2\\sigma\\sqrt{2\\ln(2)}$\n- Band Area = $A\\sigma\\sqrt{2\\pi}$\n\nThese are the closed-form analytic expressions for the FWHM and the band area in terms of the given parameters $A$ and $\\sigma$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 2\\sigma\\sqrt{2\\ln(2)} & A\\sigma\\sqrt{2\\pi} \\end{pmatrix}}$$"
        },
        {
            "introduction": "Derivative spectroscopy is a powerful tool for pinpointing band centers and analyzing subtle shape variations, but calculating derivatives numerically can amplify noise present in the data. The Savitzky-Golay filter elegantly solves this by fitting a local polynomial to a window of data points and then analytically differentiating the smooth polynomial. This exercise  guides you through the first-principles derivation of the filter coefficients, demystifying the method and revealing how the choice of filter parameters directly impacts the accuracy and noise-suppression of your derivative estimates.",
            "id": "3801850",
            "problem": "A hyperspectral imaging spectrometer acquires top-of-atmosphere reflectance $R(\\lambda)$ at evenly spaced wavelengths with sampling interval $\\Delta \\lambda$. To quantify the slope of a shallow mineral absorption feature centered at $\\lambda_{0}$ in a remote sensing and environmental modeling workflow, a continuum removal step is performed locally: the continuum $C(\\lambda)$ over the window $\\{\\lambda_{0}-2\\Delta \\lambda,\\ldots,\\lambda_{0}+2\\Delta \\lambda\\}$ is modeled as linear in $\\lambda$ using the two endpoints of the window, and the continuum-removed spectrum is defined by $R_{c}(\\lambda)=R(\\lambda)/C(\\lambda)$. To suppress instrument noise while estimating the local spectral derivative $\\frac{d}{d\\lambda}R_{c}(\\lambda)$ at $\\lambda_{0}$ for derivative spectroscopy in absorption analysis, a Savitzky–Golay approach is adopted: fit a polynomial of order $2$ in $\\lambda$ to the five samples $\\{R_{c}(\\lambda_{0}+k\\Delta \\lambda)\\}_{k=-2}^{2}$ by least squares, then evaluate the first derivative of the fitted polynomial at $\\lambda_{0}$.\n\nUsing only the fundamentals of least squares regression, polynomial basis functions, and properties of symmetric sampling, derive the filter weights $w_{k}$, for $k=-2,-1,0,1,2$, such that the Savitzky–Golay first-derivative estimate at $\\lambda_{0}$ can be written as\n$$\\widehat{\\frac{d R_{c}}{d\\lambda}}(\\lambda_{0})=\\sum_{k=-2}^{2}w_{k}\\,R_{c}(\\lambda_{0}+k\\Delta \\lambda).$$\nYour derivation must start from first principles and arrive at a closed-form expression for the $w_{k}$ in terms of $\\Delta \\lambda$ only. Explain why these weights exactly reproduce the derivative of any quadratic function and how their structure provides noise smoothing compared to a two-point central difference.\n\nExpress your final answer as a single row vector of five symbolic entries in terms of $\\Delta \\lambda$, using exact rational numbers. No rounding is required. Do not include units in your final answer; write the weights as a function of $\\Delta \\lambda$.",
            "solution": "The problem requires the derivation of Savitzky-Golay filter weights for estimating the first derivative of a function from $5$ discrete samples using a $2$nd-order polynomial fit. The estimate is to be evaluated at the central point of a symmetric sampling window. The derivation must proceed from the first principles of least squares.\n\nLet the continuum-removed reflectance data points be denoted by $y_{k} = R_{c}(\\lambda_{0}+k\\Delta \\lambda)$ for $k \\in \\{-2, -1, 0, 1, 2\\}$. We wish to find a set of weights $w_{k}$ such that the derivative estimate at $\\lambda_{0}$ is given by the linear combination:\n$$ \\widehat{\\frac{d R_{c}}{d\\lambda}}(\\lambda_{0})=\\sum_{k=-2}^{2}w_{k}\\,y_{k} $$\nTo simplify the algebra, we introduce a local, normalized coordinate $u = (\\lambda - \\lambda_{0})/\\Delta\\lambda$. At the sampling points $\\lambda_{k} = \\lambda_{0}+k\\Delta\\lambda$, this coordinate takes integer values $u_k = k$. We fit a polynomial of order $2$ in this new coordinate, $P(u) = a_{0} + a_{1}u + a_{2}u^{2}$, to the data points $(u_k, y_k)$.\n\nThe least squares method minimizes the sum of squared residuals, $S = \\sum_{k=-2}^{2} (y_k - P(u_k))^2$. The system of equations for this fit can be written in matrix form as $\\mathbf{y} \\approx \\mathbf{A}\\mathbf{c}$, where $\\mathbf{y}$ is the vector of measurements, $\\mathbf{c}$ is the vector of polynomial coefficients, and $\\mathbf{A}$ is the design matrix.\n$$ \\mathbf{y} = \\begin{pmatrix} y_{-2} \\\\ y_{-1} \\\\ y_{0} \\\\ y_{1} \\\\ y_{2} \\end{pmatrix}, \\quad \\mathbf{c} = \\begin{pmatrix} a_{0} \\\\ a_{1} \\\\ a_{2} \\end{pmatrix} $$\nThe design matrix $\\mathbf{A}$ has entries $A_{ik} = u_i^{k-1}$, for $i \\in \\{-2, \\ldots, 2\\}$ and $k \\in \\{1, 2, 3\\}$.\n$$ \\mathbf{A} = \\begin{pmatrix} u_{-2}^{0} & u_{-2}^{1} & u_{-2}^{2} \\\\ u_{-1}^{0} & u_{-1}^{1} & u_{-1}^{2} \\\\ u_{0}^{0} & u_{0}^{1} & u_{0}^{2} \\\\ u_{1}^{0} & u_{1}^{1} & u_{1}^{2} \\\\ u_{2}^{0} & u_{2}^{1} & u_{2}^{2} \\end{pmatrix} = \\begin{pmatrix} 1 & -2 & 4 \\\\ 1 & -1 & 1 \\\\ 1 & 0 & 0 \\\\ 1 & 1 & 1 \\\\ 1 & 2 & 4 \\end{pmatrix} $$\nThe least squares solution for the coefficient vector $\\mathbf{c}$ is given by the normal equations:\n$$ \\hat{\\mathbf{c}} = (\\mathbf{A}^{T}\\mathbf{A})^{-1}\\mathbf{A}^{T}\\mathbf{y} $$\nFirst, we compute the matrix $\\mathbf{A}^{T}\\mathbf{A}$. Due to the symmetric choice of sampling points $u_k$, the sums of odd powers of $u_k$ are zero.\n$$ \\sum_{k=-2}^{2} u_k = 0, \\quad \\sum_{k=-2}^{2} u_k^3 = 0 $$\nThe sums of even powers are:\n$$ \\sum_{k=-2}^{2} u_k^0 = \\sum_{k=-2}^{2} 1 = 5 $$\n$$ \\sum_{k=-2}^{2} u_k^2 = (-2)^2 + (-1)^2 + 0^2 + 1^2 + 2^2 = 4+1+0+1+4 = 10 $$\n$$ \\sum_{k=-2}^{2} u_k^4 = (-2)^4 + (-1)^4 + 0^4 + 1^4 + 2^4 = 16+1+0+1+16 = 34 $$\nSo, the matrix $\\mathbf{A}^{T}\\mathbf{A}$ is:\n$$ \\mathbf{A}^{T}\\mathbf{A} = \\begin{pmatrix} \\sum u_k^0 & \\sum u_k^1 & \\sum u_k^2 \\\\ \\sum u_k^1 & \\sum u_k^2 & \\sum u_k^3 \\\\ \\sum u_k^2 & \\sum u_k^3 & \\sum u_k^4 \\end{pmatrix} = \\begin{pmatrix} 5 & 0 & 10 \\\\ 0 & 10 & 0 \\\\ 10 & 0 & 34 \\end{pmatrix} $$\nThis matrix is block-diagonal, which simplifies its inversion. The inverse is:\n$$ (\\mathbf{A}^{T}\\mathbf{A})^{-1} = \\begin{pmatrix} \\begin{pmatrix} 5 & 10 \\\\ 10 & 34 \\end{pmatrix}^{-1} & \\mathbf{0} \\\\ \\mathbf{0}^{T} & 10^{-1} \\end{pmatrix} $$\nThe determinant of the $2 \\times 2$ block is $(5)(34) - (10)(10) = 170 - 100 = 70$.\n$$ \\begin{pmatrix} 5 & 10 \\\\ 10 & 34 \\end{pmatrix}^{-1} = \\frac{1}{70} \\begin{pmatrix} 34 & -10 \\\\ -10 & 5 \\end{pmatrix} = \\begin{pmatrix} \\frac{34}{70} & -\\frac{10}{70} \\\\ -\\frac{10}{70} & \\frac{5}{70} \\end{pmatrix} = \\begin{pmatrix} \\frac{17}{35} & -\\frac{1}{7} \\\\ -\\frac{1}{7} & \\frac{1}{14} \\end{pmatrix} $$\nThus, the inverse of $\\mathbf{A}^{T}\\mathbf{A}$ is:\n$$ (\\mathbf{A}^{T}\\mathbf{A})^{-1} = \\begin{pmatrix} \\frac{17}{35} & 0 & -\\frac{1}{7} \\\\ 0 & \\frac{1}{10} & 0 \\\\ -\\frac{1}{7} & 0 & \\frac{1}{14} \\end{pmatrix} $$\nThe derivative of the fitted polynomial $P(\\lambda)$ with respect to $\\lambda$ is found using the chain rule:\n$$ \\frac{dP}{d\\lambda} = \\frac{dP}{du} \\frac{du}{d\\lambda} = (a_{1} + 2a_{2}u) \\frac{1}{\\Delta\\lambda} $$\nWe need to evaluate this derivative at the center point $\\lambda = \\lambda_{0}$, which corresponds to $u=0$.\n$$ \\widehat{\\frac{d R_{c}}{d\\lambda}}(\\lambda_{0}) = \\left.\\frac{dP}{d\\lambda}\\right|_{u=0} = \\frac{\\hat{a}_{1}}{\\Delta\\lambda} $$\nThe coefficient $\\hat{a}_{1}$ is the second element of the vector $\\hat{\\mathbf{c}} = (\\mathbf{A}^{T}\\mathbf{A})^{-1}\\mathbf{A}^{T}\\mathbf{y}$. So, $\\hat{a}_{1}$ is the dot product of the second row of $(\\mathbf{A}^{T}\\mathbf{A})^{-1}\\mathbf{A}^{T}$ with $\\mathbf{y}$. The weights for $\\hat{a}_{1}$ are given by the second row of $(\\mathbf{A}^{T}\\mathbf{A})^{-1}\\mathbf{A}^{T}$. Let's compute this row vector, which we'll call $\\mathbf{w}_{\\hat{a}_{1}}^{T}$:\n$$ \\mathbf{w}_{\\hat{a}_{1}}^{T} = \\begin{pmatrix} 0 & \\frac{1}{10} & 0 \\end{pmatrix} \\mathbf{A}^{T} = \\begin{pmatrix} 0 & \\frac{1}{10} & 0 \\end{pmatrix} \\begin{pmatrix} 1 & 1 & 1 & 1 & 1 \\\\ -2 & -1 & 0 & 1 & 2 \\\\ 4 & 1 & 0 & 1 & 4 \\end{pmatrix} $$\n$$ \\mathbf{w}_{\\hat{a}_{1}}^{T} = \\frac{1}{10} \\begin{pmatrix} -2 & -1 & 0 & 1 & 2 \\end{pmatrix} $$\nSo, $\\hat{a}_{1} = \\sum_{k=-2}^{2} \\frac{k}{10} y_k$. The derivative estimate is:\n$$ \\widehat{\\frac{d R_{c}}{d\\lambda}}(\\lambda_{0}) = \\frac{\\hat{a}_{1}}{\\Delta\\lambda} = \\frac{1}{\\Delta\\lambda} \\sum_{k=-2}^{2} \\frac{k}{10} y_k = \\sum_{k=-2}^{2} \\left( \\frac{k}{10\\Delta\\lambda} \\right) y_k $$\nThe filter weights $w_k$ are therefore $w_k = \\frac{k}{10\\Delta\\lambda}$. Explicitly, the weights are:\n$w_{-2} = \\frac{-2}{10\\Delta\\lambda} = -\\frac{1}{5\\Delta\\lambda}$\n$w_{-1} = -\\frac{1}{10\\Delta\\lambda}$\n$w_{0} = 0$\n$w_{1} = \\frac{1}{10\\Delta\\lambda}$\n$w_{2} = \\frac{2}{10\\Delta\\lambda} = \\frac{1}{5\\Delta\\lambda}$\n\nThe filter weights exactly reproduce the derivative of any quadratic function because the filter is derived from a quadratic model. If the input data points $y_k$ lie exactly on a quadratic curve, $y(\\lambda) = c_0 + c_1(\\lambda-\\lambda_0) + c_2(\\lambda-\\lambda_0)^2$, the least squares fit will recover this function perfectly, i.e., $P(\\lambda) = y(\\lambda)$. The derivative of the fitted polynomial at $\\lambda_0$ will then be identical to the true derivative. The true derivative at $\\lambda_0$ is $c_1$. Applying the filter to the data points $y_k = c_0 + c_1(k\\Delta\\lambda) + c_2(k\\Delta\\lambda)^2$:\n$$ \\sum_{k=-2}^{2} w_k y_k = \\sum_{k=-2}^{2} \\frac{k}{10\\Delta\\lambda} (c_0 + c_1 k\\Delta\\lambda + c_2 (k\\Delta\\lambda)^2) $$\n$$ = \\frac{c_0}{10\\Delta\\lambda}\\sum k + \\frac{c_1}{10}\\sum k^2 + \\frac{c_2\\Delta\\lambda}{10}\\sum k^3 $$\nUsing the sums $\\sum k=0$, $\\sum k^2=10$, and $\\sum k^3=0$:\n$$ = \\frac{c_0}{10\\Delta\\lambda}(0) + \\frac{c_1}{10}(10) + \\frac{c_2\\Delta\\lambda}{10}(0) = c_1 $$\nThis is the exact true derivative at $\\lambda_0$. This property extends to any polynomial of order up to $2$.\n\nThe Savitzky-Golay filter provides noise smoothing compared to a simple two-point central difference because it uses a wider aperture of points. A two-point central difference, $\\frac{y_1 - y_{-1}}{2\\Delta\\lambda}$, uses weights $w_{-1}=-\\frac{1}{2\\Delta\\lambda}$, $w_1=\\frac{1}{2\\Delta\\lambda}$, and $w_k=0$ otherwise. If each measurement $y_k$ has independent, additive noise with variance $\\sigma^2$, the variance of the resulting derivative estimate $\\hat{d} = \\sum w_k y_k$ is $\\text{Var}(\\hat{d}) = \\sigma^2 \\sum w_k^2$.\nFor the two-point central difference:\n$$ \\sum w_k^2 = \\left(-\\frac{1}{2\\Delta\\lambda}\\right)^2 + \\left(\\frac{1}{2\\Delta\\lambda}\\right)^2 = \\frac{1}{4(\\Delta\\lambda)^2} + \\frac{1}{4(\\Delta\\lambda)^2} = \\frac{2}{4(\\Delta\\lambda)^2} = \\frac{1}{2(\\Delta\\lambda)^2} $$\nFor the $5$-point Savitzky-Golay filter derived here:\n$$ \\sum w_k^2 = \\left(\\frac{1}{10\\Delta\\lambda}\\right)^2 ((-2)^2 + (-1)^2 + 0^2 + 1^2 + 2^2) = \\frac{1}{100(\\Delta\\lambda)^2}(10) = \\frac{1}{10(\\Delta\\lambda)^2} $$\nSince $\\frac{1}{10(\\Delta\\lambda)^2} < \\frac{1}{2(\\Delta\\lambda)^2}$, the Savitzky-Golay estimate has a lower variance, meaning it is less susceptible to noise. The least-squares fit over $5$ points effectively performs an averaging operation that smooths out random fluctuations, resulting in a more robust derivative estimate.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{1}{5\\Delta\\lambda} & -\\frac{1}{10\\Delta\\lambda} & 0 & \\frac{1}{10\\Delta\\lambda} & \\frac{1}{5\\Delta\\lambda} \\end{pmatrix}}\n$$"
        }
    ]
}