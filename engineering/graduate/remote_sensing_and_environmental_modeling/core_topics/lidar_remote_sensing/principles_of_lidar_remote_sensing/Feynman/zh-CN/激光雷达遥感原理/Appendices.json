{
    "hands_on_practices": [
        {
            "introduction": "我们实践的第一步是理解激光雷达（Lidar）测量的最基本单元：激光光斑。光斑在地面上覆盖的区域，即“足迹”（footprint），直接决定了Lidar系统的空间分辨率。本练习将引导您运用基础的几何光学原理，推导在给定飞行高度和光束发散角的情况下，如何计算地面光斑的直径，这是理解Lidar数据空间特征的基石。",
            "id": "3835764",
            "problem": "一个脉冲式激光雷达（LiDAR）系统从一个机载平台发射一束近高斯激光束。在远场中，光束包络可以通过几何光学建模为一个圆锥体，其轴线与传播方向对齐。光束发散角由 $1/\\exp(2)$ 辐照度等值线处的全角定义，记为 $\\theta$，因此圆锥半角为 $\\theta/2$。假设地面截取平面垂直于光束轴线，并且大气折射可以忽略不计。\n\n从正切函数的几何定义和圆锥几何出发，推导在轴向距离 $R$ 处的截取平面上的光斑直径表达式，该表达式是 $R$ 和 $\\theta$ 的函数。然后计算当 $R = 1850\\,\\mathrm{m}$ 和 $\\theta = 0.7 \\times 10^{-3}\\,\\mathrm{rad}$ 时该直径的值。当 $\\theta$ 的量级合理时，您可以使用正切函数的小角度展开式。\n\n将您的数值答案四舍五入到四位有效数字。以米为单位表示最终直径。最终答案必须是一个实数。",
            "solution": "远场中的激光雷达光束可以近似为一个圆锥，其顶点在发射器处，相对于轴线的半角为 $\\theta/2$。在距离顶点 $R$ 处，一个垂直于圆锥轴线的平面与该圆锥的截面是一个半径为 $r$ 的圆。由圆锥轴线、半径和斜边光线构成的直角三角形的几何关系给出\n$$\n\\tan\\!\\left(\\frac{\\theta}{2}\\right) \\;=\\; \\frac{r}{R}.\n$$\n解出 $r$ 可得\n$$\nr \\;=\\; R \\,\\tan\\!\\left(\\frac{\\theta}{2}\\right).\n$$\n光斑直径 $D$ 是半径的两倍：\n$$\nD \\;=\\; 2\\,r \\;=\\; 2\\,R\\,\\tan\\!\\left(\\frac{\\theta}{2}\\right).\n$$\n对于小角度，可以使用一阶小角度近似 $\\tan x \\approx x$（其中 $x$ 以弧度为单位），但我们将计算精确的正切值并验证该近似是否有效。\n\n代入给定值 $R = 1850\\,\\mathrm{m}$ 和 $\\theta = 0.7 \\times 10^{-3}\\,\\mathrm{rad}$：\n$$\n\\frac{\\theta}{2} \\;=\\; 0.35 \\times 10^{-3}\\,\\mathrm{rad} \\;=\\; 3.5 \\times 10^{-4}\\,\\mathrm{rad}.\n$$\n计算正切值：\n$$\n\\tan\\!\\left(3.5 \\times 10^{-4}\\right) \\approx 3.5 \\times 10^{-4} + \\frac{\\left(3.5 \\times 10^{-4}\\right)^{3}}{3}.\n$$\n三次修正项为\n$$\n\\frac{\\left(3.5 \\times 10^{-4}\\right)^{3}}{3} \\;=\\; \\frac{(3.5)^{3} \\times 10^{-12}}{3} \\;=\\; \\frac{42.875 \\times 10^{-12}}{3} \\;\\approx\\; 1.429 \\times 10^{-11},\n$$\n与 $3.5 \\times 10^{-4}$ 相比可以忽略不计。因此，\n$$\n\\tan\\!\\left(3.5 \\times 10^{-4}\\right) \\approx 3.5 \\times 10^{-4}.\n$$\n因此，\n$$\nD \\;=\\; 2 \\times 1850 \\times \\tan\\!\\left(3.5 \\times 10^{-4}\\right) \\;\\approx\\; 3700 \\times 3.5 \\times 10^{-4} \\;=\\; 1.295.\n$$\n精确到四位有效数字，直径为 $1.295\\,\\mathrm{m}$。作为一致性检查，使用一阶小角度表达式可得 $D \\approx R \\theta = 1850 \\times 0.7 \\times 10^{-3} = 1.295$，这与上面计算的值一致。",
            "answer": "$$\\boxed{1.295}$$"
        },
        {
            "introduction": "在掌握了单个脉冲的特性后，我们将视野扩展到整个Lidar勘测项目的设计。为了确保数据质量和覆盖范围，精确规划相邻航带之间的重叠度至关重要。本练习将引导您从基本统计模型出发，综合考虑点云密度、高程精度和数据冗余等多重目标，计算出满足项目需求的最小航带重叠度。这项实践将理论知识与Lidar项目规划中的经济和质量控制要求紧密结合。",
            "id": "3835744",
            "problem": "计划使用一套机载激光雷达（LiDAR）系统，在一个广阔平坦的农业区域上空采集数据以生成数字地面模型（DTM）。该平台沿平行、笔直的航线飞行，相邻航带之间有旁向重叠。为便于规划，假设单条航线的基准参数如下：名义全回波点密度为 $d_{0} = 3.0\\,\\text{points}\\,\\text{m}^{-2}$，地面回波比例为 $f_{g} = 0.50$，单次回波高程测量噪声独立同分布，其标准差为 $\\sigma_{e} = 0.15\\,\\text{m}$。DTM是通过对半径为 $r = 1.5\\,\\text{m}$ 的圆形核内的地面回波点高程进行局部平均而生成的。\n\n本次测量必须同时满足以下三个规划要求：\n- 整个区块的最低平均地面点密度为 $d_{\\min} = 2.5\\,\\text{points}\\,\\text{m}^{-2}$。\n- 当通过核内地面回波点高程的算术平均值估算时，目标局部DTM标准差不大于 $\\sigma_{\\text{DTM}} = 0.035\\,\\text{m}$。\n- 冗余度要求：至少有 $r_{\\min} = 0.70$ 比例的区域被两条航线覆盖（以便进行跨航带检查，发现航带间的系统偏差）。\n\n假设每条航线中的地面回波点可以被建模为一个空间泊松过程，其强度为 $\\lambda_{g0} = d_{g0}$，其中 $d_{g0} = f_{g}\\,d_{0}$，并且不同航线产生独立的实现。假设相邻航带的旁向重叠度为航带宽度的一个比例 $o \\in [0,1]$，因此有比例为 $o$ 的区域被两条航带覆盖，比例为 $1-o$ 的区域被一条航带覆盖。目标是确定能同时满足所有三个要求的最小重叠度 $o$。您的推导必须从空间点过程的基本概率建模和样本均值方差出发，而不是使用任何简化的规划公式。\n\n请将最终的航线重叠度以小数形式表示，并将答案四舍五入到三位有效数字。不要使用百分号。",
            "solution": "我们从基准量和基本建模假设开始。对于单个航带，平均地面回波点密度为 $d_{g0} = f_{g}\\,d_{0}$。已知 $f_{g} = 0.50$ 且 $d_{0} = 3.0\\,\\text{points}\\,\\text{m}^{-2}$，我们有\n$$\nd_{g0} = 0.50 \\times 3.0 = 1.5\\,\\text{points}\\,\\text{m}^{-2}.\n$$\n设局部DTM估计量为半径为 $r$ 的圆形核内地面回波点高程的算术平均值。核面积为\n$$\nA_{w} = \\pi r^{2} = \\pi \\times (1.5\\,\\text{m})^{2} = \\pi \\times 2.25\\,\\text{m}^{2}.\n$$\n因此，\n$$\nA_{w} = 7.0685834705770345\\,\\text{m}^{2}.\n$$\n在单个航带内的地面回波点是强度为 $\\lambda_{g0} = d_{g0}$ 的空间泊松过程的假设下，来自单个航带的核内期望地面点数为\n$$\nN_{0} = d_{g0}\\,A_{w} = 1.5 \\times 7.0685834705770345 = 10.602875205865552.\n$$\n\n接下来，考虑两个旁向重叠比例为 $o$ 的相邻航带。根据几何关系，比例为 $o$ 的区域被两条航带覆盖，比例为 $1-o$ 的区域被一条航带覆盖。由于独立的泊松过程是可加叠加的，整个区块的期望平均地面点密度变为\n$$\nd_{g} = (1-o)\\,d_{g0} + o\\,(2\\,d_{g0}) = (1+o)\\,d_{g0}.\n$$\n因此，核内的期望地面点数为\n$$\nN = d_{g}\\,A_{w} = (1+o)\\,d_{g0}\\,A_{w} = (1+o)\\,N_{0}.\n$$\n\n我们现在从这三个要求中推导对 $o$ 的约束条件。\n\n密度要求。整个区块的最低平均地面点密度必须满足 $d_{g} \\ge d_{\\min}$。使用 $d_{g} = (1+o)\\,d_{g0}$，\n$$\n(1+o)\\,d_{g0} \\ge d_{\\min} \\quad \\Longrightarrow \\quad 1+o \\ge \\frac{d_{\\min}}{d_{g0}} \\quad \\Longrightarrow \\quad o \\ge \\frac{d_{\\min}}{d_{g0}} - 1.\n$$\n已知 $d_{\\min} = 2.5\\,\\text{points}\\,\\text{m}^{-2}$ 和 $d_{g0} = 1.5\\,\\text{points}\\,\\text{m}^{-2}$，\n$$\no_{\\text{dens}} = \\frac{2.5}{1.5} - 1 = 1.\\overline{6} - 1 = 0.\\overline{6} = 0.666666\\ldots\n$$\n\n冗余度要求。被两条航带覆盖的区域比例恰好是 $o$，所以\n$$\no \\ge r_{\\min} \\quad \\Longrightarrow \\quad o_{\\text{red}} = r_{\\min} = 0.70.\n$$\n\nDTM均值的方差要求。对于方差为 $\\sigma_{e}^{2}$ 的独立同分布高程误差，其 $N$ 个样本的算术平均值的方差为\n$$\n\\operatorname{Var}(\\bar{Z}) = \\frac{\\sigma_{e}^{2}}{N},\n$$\n其标准差为\n$$\n\\sigma_{\\text{DTM}} = \\frac{\\sigma_{e}}{\\sqrt{N}}.\n$$\n为实现 $\\sigma_{\\text{DTM}} \\le \\sigma_{\\text{DTM,target}}$，我们需要\n$$\nN \\ge \\left(\\frac{\\sigma_{e}}{\\sigma_{\\text{DTM,target}}}\\right)^{2}.\n$$\n将 $N = (1+o)\\,N_{0}$ 代入，可得\n$$\n(1+o)\\,N_{0} \\ge \\left(\\frac{\\sigma_{e}}{\\sigma_{\\text{DTM}}}\\right)^{2} \\quad \\Longrightarrow \\quad 1+o \\ge \\frac{\\left(\\frac{\\sigma_{e}}{\\sigma_{\\text{DTM}}}\\right)^{2}}{N_{0}} \\quad \\Longrightarrow \\quad o \\ge \\frac{\\left(\\frac{\\sigma_{e}}{\\sigma_{\\text{DTM}}}\\right)^{2}}{N_{0}} - 1.\n$$\n代入 $\\sigma_{e} = 0.15\\,\\text{m}$ 和 $\\sigma_{\\text{DTM}} = 0.035\\,\\text{m}$，\n$$\n\\left(\\frac{\\sigma_{e}}{\\sigma_{\\text{DTM}}}\\right)^{2} = \\left(\\frac{0.15}{0.035}\\right)^{2} = \\left(4.285714285714286\\right)^{2} = 18.36734693877551.\n$$\n因此，\n$$\no_{\\text{var}} = \\frac{18.36734693877551}{10.602875205865552} - 1.\n$$\n计算该比率：\n$$\n\\frac{18.36734693877551}{10.602875205865552} \\approx 1.7323,\n$$\n所以\n$$\no_{\\text{var}} \\approx 1.7323 - 1 = 0.7323.\n$$\n\n所需的重叠度必须同时满足所有三个约束，因此最小可行 $o$ 为\n$$\no_{\\text{req}} = \\max\\left\\{o_{\\text{dens}},\\,o_{\\text{red}},\\,o_{\\text{var}}\\right\\} = \\max\\left\\{0.666666\\ldots,\\,0.70,\\,0.7323\\right\\} = 0.7323.\n$$\n\n最后，将 $o_{\\text{req}}$ 四舍五入到三位有效数字并以小数形式表示：\n$$\no_{\\text{req}} \\approx 0.732.\n$$\n\n基于方差减小的合理解释。选择 $o \\approx 0.732$ 将核内的期望样本数量从 $N_{0} \\approx 10.60$ 增加到 $N \\approx (1+o)\\,N_{0} \\approx 1.732 \\times 10.60 \\approx 18.37$，这将DTM均值的方差从 $\\sigma_{e}^{2}/N_{0}$ 减小到 $\\sigma_{e}^{2}/N$，减小因子约为 $N/N_{0} \\approx 1.732$。这使得DTM标准差降低到 $\\sigma_{\\text{DTM}} \\approx \\sigma_{e}/\\sqrt{N} \\approx 0.035\\,\\text{m}$，满足了目标要求，同时也满足了最低密度和冗余度约束。",
            "answer": "$$\\boxed{0.732}$$"
        },
        {
            "introduction": "数据采集完成后，由于传感器定位和姿态的残余误差，不同航带之间常存在系统性的高程偏差。本练习聚焦于数据后处理中的一个核心环节：航带拼接与调整。您将学习如何利用航带重叠区域的高程差异，建立一个约束加权最小二乘模型，从而精确估计并校正每个航带的垂直偏差。掌握这项技能对于生成一个几何上无缝、高精度的最终Lidar产品至关重要。",
            "id": "3835709",
            "problem": "您的任务是为激光雷达 (LiDAR) 遥感技术推导并实现一个基于重叠扫描带差异的逐航带高程偏差估算器，并为各航带的校正量构建一个最小二乘解。该估算器必须基于激光雷达距离测量的第一性原理和一个具有物理意义的误差模型。接着，您必须实现一个程序，该程序能够处理多个带有可选锚点约束的重叠航带差异测试用例，并使用约束加权最小二乘法解算出以米为单位的各航带高程校正量。\n\n从以下基本原理开始：\n\n- 激光雷达（LiDAR）采用基于激光（LASER，即受激辐射光放大）的双程飞行时间测量法。对于每个脉冲，其距离由 $$R = \\frac{c \\, \\Delta t}{2},$$ 确定，其中 $c$ 是光速，$\\Delta t$ 是脉冲的往返传播时间。当使用全球导航卫星系统 (GNSS) 和惯性测量单元 (IMU) 数据将其参考到大地测量框架中时，来自航带 $s$ 的地面点 $(x,y)$ 处的回波高程可表示为\n  $$h_s(x,y) = h_{\\text{true}}(x,y) + b_s + \\varepsilon_s(x,y),$$\n  其中 $b_s$ 是一个未知的逐航带高程偏差（假定在航带 $s$ 上为常数），由 GNSS/IMU 残余误差或定标误差引起，而 $\\varepsilon_s(x,y)$ 是一个零均值噪声项。\n- 在两个航带 $i$ 和 $j$ 的重叠区域，当地形效应被抵消或模型化至残差可忽略不计时，观测到的高程差异简化为\n  $$d_k \\approx b_i - b_j + \\eta_k,$$\n  此为航带 $i$ 和 $j$ 之间的观测 $k$，$ \\eta_k $ 是一个零均值误差。每个 $d_k$ 都关联一个严格为正的权重 $w_k$，反映其置信度（例如，点数、入射几何形状或质量度量）。\n\n您必须为未知的航带偏差向量 $\\mathbf{b} = [b_0, b_1, \\dots, b_{n-1}]^\\top$ 推导一个约束加权最小二乘估算器。从形式为\n$$b_i - b_j = d_k,$$\n的重叠方程（由 $w_k$ 加权）构建一个线性系统，并添加约束以解决差异中固有的基准自由度问题：\n- 如果航带重叠图的一个连通分量中没有锚定航带（即没有已知 $b_s$ 的航带），则对该分量强制施加零均值约束，\n  $$\\sum_{s \\in \\mathcal{C}} b_s = 0.$$\n- 如果提供了锚定航带，则对任意分量中的每个锚定索引 $s$ 强制施加 $b_s = \\text{已知值}$。\n\n通过 Karush–Kuhn–Tucker (KKT) 系统构建约束加权最小二乘解。设 $\\mathbf{A}$ 是由所有差异方程构建的关联矩阵，$\\mathbf{W}$ 是权重对角矩阵，$\\mathbf{d}$ 是观测差异向量。设 $\\mathbf{C}\\mathbf{b} = \\mathbf{g}$ 代表所有线性等式约束（每个非锚定分量的零均值约束和锚点约束）。推导法方程和 KKT 系统\n$$\n\\begin{bmatrix}\n\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A} & \\mathbf{C}^\\top \\\\\n\\mathbf{C} & \\mathbf{0}\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{b} \\\\ \\boldsymbol{\\lambda}\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\mathbf{A}^\\top \\mathbf{W} \\mathbf{d} \\\\ \\mathbf{g}\n\\end{bmatrix},\n$$\n其中 $\\boldsymbol{\\lambda}$ 是拉格朗日乘子向量。解释为什么当约束充分固定了每个连通分量中的基准时，该系统会产生唯一解。\n\n您必须实现一个程序，该程序接受一组固定的测试用例（如下），构建 $\\mathbf{A}$、$\\mathbf{W}$、$\\mathbf{d}$，检测连通分量以构建 $\\mathbf{C}$ 和 $\\mathbf{g}$，使用 KKT 系统求解 $\\mathbf{b}$，并输出以米为单位的各航带校正量。\n\n规格说明：\n\n- 用从 0 开始的索引表示航带：$s \\in \\{0, 1, \\dots, n-1\\}$。\n- 每个测试用例是一个元组：$(n, \\text{overlaps}, \\text{anchors})$，其中：\n  - $n$ 是航带数量（整数）。\n  - $\\text{overlaps}$ 是一个元组列表 $(i, j, d, w)$，其中整数 $i, j$ 表示航带索引，浮点数 $d$ 表示观测到的差异 $b_i - b_j$（单位：米），浮点数 $w$ 表示一个严格为正的权重。\n  - $\\text{anchors}$ 是一个元组列表 $(s, v)$，其中整数 $s$ 表示航带索引，浮点数 $v$ 表示其已知偏差 $b_s$（单位：米）。如果没有锚点，则使用空列表。\n- 您必须构建约束系统以确保可解性，为缺少锚点的每个连通分量添加零均值约束。\n- 您必须为每个测试用例求解并返回偏差向量 $\\mathbf{b}$。将每个偏差 $b_s$ 以米为单位表示为浮点数，并四舍五入到 $4$ 位小数。\n\n本问题不涉及角度单位。所有物理输出必须以米为单位表示。\n\n测试套件：\n\n为以下四个测试用例提供解决方案：\n\n- 案例 $1$ (理想情况，连通图，来自重叠的冗余约束): $n = 3$, overlaps $= [(0,1,0.15,1.0), (1,2,-0.05,2.0), (0,2,0.10,1.0)]$, anchors $=[]$。\n- 案例 $2$ (边界情况，单个航带，无重叠): $n = 1$, overlaps $=[]$, anchors $=[]$。\n- 案例 $3$ (边缘情况，不连通分量，无锚点): $n = 4$, overlaps $= [(0,1,0.20,1.0), (2,3,-0.10,1.0)]$, anchors $=[]$。\n- 案例 $4$ (存在锚点，连通图): $n = 3$, overlaps $= [(0,1,0.08,3.0), (1,2,-0.12,1.0)]$, anchors $=[(0,0.0)]$。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含所有测试用例的结果，格式为 Python 风格的浮点数列表的列表。每个内部列表按航带索引顺序列出以米为单位的各航带校正量，四舍五入到 4 位小数。例如，输出应如下所示：\n$$\\texttt{[[b\\_0,b\\_1,\\dots],[b\\_0,b\\_1,\\dots],\\dots]}.$$",
            "solution": "问题要求推导并实现一个用于 LiDAR 数据的逐航带高程偏差估算器。该任务基于大地测量平差的原理，可以构建为一个约束加权最小二乘问题。\n\n### 1. 物理与数学模型\n\n用于描述来自航带 $s$ 的地面点 $(x,y)$ 处的 LiDAR 回波高程 $h_s(x,y)$ 的基础模型如下：\n$$h_s(x,y) = h_{\\text{true}}(x,y) + b_s + \\varepsilon_s(x,y)$$\n其中 $h_{\\text{true}}(x,y)$ 是真实地面高程，$b_s$ 是航带 $s$ 的一个系统性、恒定的高程偏差，而 $\\varepsilon_s(x,y)$ 是一个零均值随机噪声项。\n\n当两个航带 $i$ 和 $j$ 重叠时，我们可以在一个公共位置 $k$ 测量高程差 $d_k$。假设真实地形高程被抵消，则差异观测值为：\n$$d_k = h_i(x_k, y_k) - h_j(x_k, y_k) = (h_{\\text{true}} + b_i + \\varepsilon_i) - (h_{\\text{true}} + b_j + \\varepsilon_j)$$\n$$d_k = b_i - b_j + (\\varepsilon_i - \\varepsilon_j)$$\n这可以为每个差异测量 $k$ 写成一个线性观测方程：\n$$d_k = b_i - b_j + \\eta_k$$\n其中 $\\eta_k$ 是组合的零均值噪声项。我们可以将所有 $m$ 个此类观测的集合表示为矩阵形式：\n$$\\mathbf{A}\\mathbf{b} \\approx \\mathbf{d}$$\n此处，$\\mathbf{b} = [b_0, b_1, \\dots, b_{n-1}]^\\top$ 是 $n$ 个航带的未知偏差组成的 $n \\times 1$ 向量。$\\mathbf{d}$ 是观测到的差异组成的 $m \\times 1$ 向量。$\\mathbf{A}$ 是 $m \\times n$ 的设计矩阵（或关联矩阵）。对于给定的观测值 $d_k = b_i - b_j$，$\\mathbf{A}$ 的第 $k$ 行在第 $i$ 列包含 $+1$，在第 $j$ 列包含 $-1$，其他位置为 $0$。\n\n### 2. 加权最小二乘法公式\n\n每个观测值 $d_k$ 都关联一个权重 $w_k > 0$，反映我们对该测量的置信度。我们可以将这些权重收集到一个对角矩阵 $\\mathbf{W} = \\text{diag}(w_1, w_2, \\dots, w_m)$ 中。加权最小二乘的目标是找到一个向量 $\\mathbf{b}$，使得加权残差平方和最小：\n$$\\text{最小化 } \\Phi(\\mathbf{b}) = \\sum_{k=1}^{m} w_k ( (b_i - b_j)_k - d_k )^2 = (\\mathbf{A}\\mathbf{b} - \\mathbf{d})^\\top \\mathbf{W} (\\mathbf{A}\\mathbf{b} - \\mathbf{d})$$\n\n### 3. 基准自由度与约束需求\n\n无约束最小化问题是不适定的。矩阵 $\\mathbf{N} = \\mathbf{A}^\\top \\mathbf{W} \\mathbf{A}$，即法方程矩阵，是秩亏的。这是“基准自由度”的一种表现：如果向量 $\\mathbf{b}$ 是一个解，那么任何向量 $\\mathbf{b}' = \\mathbf{b} + c\\mathbf{1}$（其中 $c$ 是一个常数，$\\mathbf{1}$ 是一个全为 1 的向量）也是一个解。这是因为 $\\mathbf{A}$ 的每一行之和都为零（由于其包含 1 和 -1 的结构），这意味着 $\\mathbf{A}\\mathbf{1} = \\mathbf{0}$。因此，目标函数值不变：\n$$\\Phi(\\mathbf{b} + c\\mathbf{1}) = (\\mathbf{A}(\\mathbf{b} + c\\mathbf{1}) - \\mathbf{d})^\\top \\mathbf{W} (\\mathbf{A}(\\mathbf{b} + c\\mathbf{1}) - \\mathbf{d}) = (\\mathbf{A}\\mathbf{b} - \\mathbf{d})^\\top \\mathbf{W} (\\mathbf{A}\\mathbf{b} - \\mathbf{d}) = \\Phi(\\mathbf{b})$$\n$\\mathbf{N}$ 的零空间包含向量 $\\mathbf{1}$。如果航带重叠图有多个不连通的分量，则零空间由在每个分量上为常数而在其他地方为零的向量所张成。为了获得唯一解，我们必须引入约束来消除这种模糊性。这些约束采用一般线性形式：\n$$\\mathbf{C}\\mathbf{b} = \\mathbf{g}$$\n问题规定了两种类型的约束：\n1.  **锚点约束**：如果航带 $s$ 的偏差 $b_s$ 已知为值 $v$，我们强制 $b_s = v$。这对应于 $\\mathbf{C}$ 中的一行，在索引 $s$ 处为 $1$，其他位置为 $0$，而在 $\\mathbf{g}$ 中对应的值为 $v$。\n2.  **零均值约束**：对于航带图中没有任何锚定航带的任意连通分量 $\\mathcal{C}$，我们强制施加零均值条件：$\\sum_{s \\in \\mathcal{C}} b_s = 0$。这对应于 $\\mathbf{C}$ 中的一行，对于所有索引 $s \\in \\mathcal{C}$ 处为 $1$，其他位置为 $0$，而在 $\\mathbf{g}$ 中对应的值为 $0$。\n\n### 4. Karush–Kuhn–Tucker (KKT) 系统\n\n为了求解带线性等式约束的加权最小二乘问题，我们使用拉格朗日乘子法。我们基于一个标准目标函数 $J(\\mathbf{b}) = \\frac{1}{2}\\Phi(\\mathbf{b})$ 来定义拉格朗日函数 $\\mathcal{L}$，以匹配问题描述中提供的形式：\n$$\\mathcal{L}(\\mathbf{b}, \\boldsymbol{\\lambda}) = \\frac{1}{2}(\\mathbf{A}\\mathbf{b} - \\mathbf{d})^\\top \\mathbf{W} (\\mathbf{A}\\mathbf{b} - \\mathbf{d}) + \\boldsymbol{\\lambda}^\\top (\\mathbf{C}\\mathbf{b} - \\mathbf{g})$$\n其中 $\\boldsymbol{\\lambda}$ 是拉格朗日乘子向量。为了找到最小值，我们将关于 $\\mathbf{b}$ 和 $\\boldsymbol{\\lambda}$ 的偏导数设为零。\n\n关于 $\\mathbf{b}$ 的导数是：\n$$\\frac{\\partial \\mathcal{L}}{\\partial \\mathbf{b}} = \\mathbf{A}^\\top \\mathbf{W} (\\mathbf{A}\\mathbf{b} - \\mathbf{d}) + \\mathbf{C}^\\top \\boldsymbol{\\lambda} = \\mathbf{0}$$\n整理后得到 KKT 系统的第一个块行：\n$$(\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A}) \\mathbf{b} + \\mathbf{C}^\\top \\boldsymbol{\\lambda} = \\mathbf{A}^\\top \\mathbf{W} \\mathbf{d}$$\n\n关于 $\\boldsymbol{\\lambda}$ 的导数恢复了约束方程：\n$$\\frac{\\partial \\mathcal{L}}{\\partial \\boldsymbol{\\lambda}} = \\mathbf{C}\\mathbf{b} - \\mathbf{g} = \\mathbf{0}$$\n这给出了第二个块行：\n$$\\mathbf{C} \\mathbf{b} = \\mathbf{g}$$\n\n将这两个结果合并成一个块矩阵方程，便得到 KKT 系统：\n$$\n\\begin{bmatrix}\n\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A} & \\mathbf{C}^\\top \\\\\n\\mathbf{C} & \\mathbf{0}\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{b} \\\\ \\boldsymbol{\\lambda}\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\mathbf{A}^\\top \\mathbf{W} \\mathbf{d} \\\\ \\mathbf{g}\n\\end{bmatrix}\n$$\n只要约束被正确地构建，该系统就能为 $(\\mathbf{b}, \\boldsymbol{\\lambda})$ 提供一个唯一解。具体来说，对于 $\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A}$ 中的每一个秩亏（对应于每个未锚定的连通分量），都会通过 $\\mathbf{C}$ 添加一个相应的独立约束。这使得整个 KKT 矩阵非奇异，从而“固定了基准”，并使系统对于唯一的偏差向量 $\\mathbf{b}$ 可解。\n\n### 5. 算法流程\n\n对于每个测试用例 $(n, \\text{overlaps}, \\text{anchors})$，实现将遵循以下步骤：\n1.  初始化一个空的 $m \\times n$ 矩阵 $\\mathbf{A}$、一个 $m \\times 1$ 的向量 $\\mathbf{d}$ 以及一个权重列表，其中 $m$ 是重叠记录的数量，$n$ 是航带的数量。\n2.  根据 `overlaps` 数据填充 $\\mathbf{A}$、$\\mathbf{d}$ 和权重矩阵 $\\mathbf{W}$。\n3.  根据 `overlaps` 构建航带图的邻接表表示。\n4.  执行图遍历（例如，广度优先或深度优先搜索）以识别不相交的航带连通分量。\n5.  遍历每个连通分量以构建约束矩阵 $\\mathbf{C}$ 和向量 $\\mathbf{g}$：\n    a. 检查分量内是否有任何航带被列在 `anchors` 中。\n    b. 如果存在锚点，则为该分量中的每个锚定航带 $(s, v)$ 添加一个约束行 $b_s = v$。\n    c. 如果该分量没有锚点，则添加一个单一的零均值约束行 $\\sum_{s \\in \\mathcal{C}} b_s = 0$。\n6.  按照推导的系统组装完整的 KKT 矩阵 $\\mathbf{K}$ 和右侧向量 $\\mathbf{y}$。处理不存在重叠的边缘情况，此时 $\\mathbf{A}^\\top \\mathbf{W} \\mathbf{A} = \\mathbf{0}$ 且 $\\mathbf{A}^\\top \\mathbf{W} \\mathbf{d} = \\mathbf{0}$。\n7.  求解线性系统 $\\mathbf{K} \\mathbf{x} = \\mathbf{y}$ 以获得解向量 $\\mathbf{x} = [\\mathbf{b}^\\top, \\boldsymbol{\\lambda}^\\top]^\\top$。\n8.  提取 $\\mathbf{x}$ 的前 $n$ 个元素以获得所需的偏差向量 $\\mathbf{b}$。\n9.  将 $\\mathbf{b}$ 的元素四舍五入并格式化以供输出。",
            "answer": "$$\\texttt{[[0.0833, -0.0667, -0.0167], [0.0], [0.1, -0.1, -0.05, 0.05], [0.0, -0.08, 0.04]]}$$"
        }
    ]
}