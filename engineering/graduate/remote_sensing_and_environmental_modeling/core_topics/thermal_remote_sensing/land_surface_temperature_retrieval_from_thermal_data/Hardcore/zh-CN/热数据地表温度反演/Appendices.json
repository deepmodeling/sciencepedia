{
    "hands_on_practices": [
        {
            "introduction": "地表比辐射率（$\\epsilon$）是地表温度反演中的一个关键但变化剧烈的参数。真实地表通常是土壤和植被等多种成分的混合体，使用单一的比辐射率值是不够的。本理论练习  将指导您从第一性原理出发，推导混合像元的有效比辐射率模型，其中将考虑由地表组分间多次反射引起的“腔体效应”，该效应会增强辐射捕获并提高整体比辐射率。",
            "id": "3823903",
            "problem": "一个正方形卫星像元包含一个空间异质的地表，其植被覆盖度为 $f_v \\in [0,1]$，裸土覆盖度为 $1 - f_v$。假设植被和土壤组分都是不透明、等温的，并且在热红外波段表现为漫射朗伯发射体和反射体。设植被的组分发射率为 $\\epsilon_v$，土壤的为 $\\epsilon_s$，根据不透明材料的基尔霍夫热辐射定律，相应的方向半球反射率表示为 $\\rho_v = 1 - \\epsilon_v$ 和 $\\rho_s = 1 - \\epsilon_s$。\n\n使用一个对称的、无量纲的几何参数 $\\Gamma \\in [0,1]$ 来模拟植被和土壤之间的像元内多次反射，其解释如下：对于从植被反射的通量，一部分 $\\Gamma(1 - f_v)$ 被土壤截获，另一部分 $1 - \\Gamma(1 - f_v)$ 逸出像元进入半球空间；对于从土壤反射的通量，一部分 $\\Gamma f_v$ 被植被截获，另一部分 $1 - \\Gamma f_v$ 逸出像元。忽略像元内的任何大气效应以及通过介质的任何透射。\n\n仅使用上述物理假设以及不透明表面的发射率与吸收率相等的原理，从第一性原理推导像元有效发射率 $\\epsilon_{\\mathrm{eff}}$ 作为 $f_v$、$\\epsilon_v$、$\\epsilon_s$ 和 $\\Gamma$ 的函数的闭合形式表达式，并考虑植被-土壤间无限次相互反射（“空腔效应”）。请用 $f_v$、$\\epsilon_v$、$\\epsilon_s$ 和 $\\Gamma$ 将你的最终答案表示为 $\\epsilon_{\\mathrm{eff}}$ 的单一闭合形式解析表达式。不需要进行数值计算。请提供精确表达式；不要对级数进行近似或截断。",
            "solution": "该问题要求计算由植被和裸土组成的混合像元的有效发射率 $\\epsilon_{\\mathrm{eff}}$。根据基尔霍夫热辐射定律，对于处于热平衡状态的不透明物体，其发射率等于其吸收率。因此，我们将推导像元的有效吸收率 $\\alpha_{\\mathrm{eff}}$，它等于 $\\epsilon_{\\mathrm{eff}}$。\n\n有效吸收率 $\\alpha_{\\mathrm{eff}}$ 定义为像元吸收的入射辐射的比例。为了计算这个值，我们可以模拟入射到像元上的外部均匀半球辐照度 $E_{in}$ 的去向。$\\alpha_{\\mathrm{eff}}$ 的值与 $E_{in}$ 无关，因此为简单起见，我们可以将入射辐照度设为单位1，即 $E_{in} = 1$。这样，像元吸收的总功率在数值上就等于 $\\alpha_{\\mathrm{eff}}$。\n\n像元由两个组分组成：面积分数为 $f_v$ 的植被和面积分数为 $1 - f_v$ 的土壤。设 $H_v$ 和 $H_s$ 分别是入射到植被和土壤表面的总辐照度（单位面积通量）。这个总辐照度是外部辐照度与土壤和植被组分之间多次反射产生的辐照度之和。\n\n两个表面上的外部辐照度均为 $E_{in} = 1$。\n来自土壤表面反射的、到达植被表面的辐照度记为 $H_{v \\leftarrow s}$。\n来自植被表面反射的、到达土壤表面的辐照度记为 $H_{s \\leftarrow v}$。\n\n因此，每个组分上的总辐照度为：\n$$ H_v = E_{in} + H_{v \\leftarrow s} = 1 + H_{v \\leftarrow s} $$\n$$ H_s = E_{in} + H_{s \\leftarrow v} = 1 + H_{s \\leftarrow v} $$\n\n为了确定 $H_{v \\leftarrow s}$ 和 $H_{s \\leftarrow v}$，我们使用问题陈述中提供的模型。植被组分（面积为 $f_v A_{pix}$，其中 $A_{pix}$ 是像元面积）反射的总功率为 $P_{refl, v} = (H_v A_v) \\rho_v = H_v f_v A_{pix} \\rho_v$，其中 $\\rho_v = 1 - \\epsilon_v$ 是植被的反射率。问题陈述指出，从植被反射的通量中，有 $\\Gamma(1-f_v)$ 的部分被土壤截获。因此，被土壤截获的功率为 $P_{v \\to s} = P_{refl, v} \\Gamma(1-f_v)$。由于这个截获功率，土壤表面（面积为 $(1-f_v)A_{pix}$）上的辐照度为：\n$$ H_{s \\leftarrow v} = \\frac{P_{v \\to s}}{A_s} = \\frac{H_v f_v A_{pix} \\rho_v \\Gamma(1-f_v)}{(1-f_v)A_{pix}} = \\Gamma f_v \\rho_v H_v $$\n\n类似地，土壤组分（面积为 $(1-f_v)A_{pix}$）反射的总功率为 $P_{refl, s} = (H_s A_s) \\rho_s = H_s(1-f_v)A_{pix}\\rho_s$，其中 $\\rho_s = 1 - \\epsilon_s$。该通量中有 $\\Gamma f_v$ 的部分被植被截获。被植被截获的功率为 $P_{s \\to v} = P_{refl, s} \\Gamma f_v$。植被表面（面积为 $f_v A_{pix}$）上的辐照度为：\n$$ H_{v \\leftarrow s} = \\frac{P_{s \\to v}}{A_v} = \\frac{H_s(1-f_v)A_{pix}\\rho_s \\Gamma f_v}{f_v A_{pix}} = \\Gamma(1-f_v)\\rho_s H_s $$\n\n现在我们可以写出关于总辐照度 $H_v$ 和 $H_s$ 的两个耦合线性方程组：\n$$ H_v = 1 + \\Gamma(1-f_v)\\rho_s H_s $$\n$$ H_s = 1 + \\Gamma f_v \\rho_v H_v $$\n\n我们可以解这个方程组。将第二个方程代入第一个方程：\n$$ H_v = 1 + \\Gamma(1-f_v)\\rho_s (1 + \\Gamma f_v \\rho_v H_v) $$\n$$ H_v = 1 + \\Gamma(1-f_v)\\rho_s + \\Gamma^2 f_v(1-f_v)\\rho_v\\rho_s H_v $$\n$$ H_v(1 - \\Gamma^2 f_v(1-f_v)\\rho_v\\rho_s) = 1 + \\Gamma(1-f_v)\\rho_s $$\n设分母为 $D = 1 - \\Gamma^2 f_v(1-f_v)\\rho_v\\rho_s$。则：\n$$ H_v = \\frac{1 + \\Gamma(1-f_v)\\rho_s}{D} $$\n\n根据对称性，我们可以求得 $H_s$：\n$$ H_s = \\frac{1 + \\Gamma f_v \\rho_v}{D} $$\n\n现在我们有了每个组分上的总辐照度，就可以计算像元吸收的总功率。吸收的功率是植被吸收的功率和土壤吸收的功率之和。每个组分的吸收率等于其发射率（$\\alpha_v = \\epsilon_v$, $\\alpha_s = \\epsilon_s$）。\n单位像元面积吸收的功率是：\n$$ P_{abs} = \\frac{H_v \\epsilon_v A_v + H_s \\epsilon_s A_s}{A_{pix}} = H_v \\epsilon_v f_v + H_s \\epsilon_s (1-f_v) $$\n\n有效吸收率为 $\\alpha_{\\mathrm{eff}} = P_{abs} / E_{in}$。因为我们设定 $E_{in}=1$，所以 $\\alpha_{\\mathrm{eff}} = P_{abs}$。\n$$ \\alpha_{\\mathrm{eff}} = f_v \\epsilon_v H_v + (1-f_v) \\epsilon_s H_s $$\n代入 $H_v$ 和 $H_s$ 的表达式：\n$$ \\alpha_{\\mathrm{eff}} = \\frac{f_v \\epsilon_v (1 + \\Gamma(1-f_v)\\rho_s) + (1-f_v) \\epsilon_s (1 + \\Gamma f_v \\rho_v)}{D} $$\n展开分子：\n$$ \\text{Numerator} = f_v \\epsilon_v + f_v \\epsilon_v \\Gamma(1-f_v)\\rho_s + (1-f_v)\\epsilon_s + (1-f_v)\\epsilon_s \\Gamma f_v \\rho_v $$\n$$ \\text{Numerator} = f_v \\epsilon_v + (1-f_v)\\epsilon_s + f_v(1-f_v)\\Gamma(\\epsilon_v\\rho_s + \\epsilon_s\\rho_v) $$\n所以有效吸收率为：\n$$ \\alpha_{\\mathrm{eff}} = \\frac{f_v \\epsilon_v + (1-f_v)\\epsilon_s + f_v(1-f_v)\\Gamma(\\epsilon_v\\rho_s + \\epsilon_s\\rho_v)}{1 - \\Gamma^2 f_v(1-f_v)\\rho_v\\rho_s} $$\n\n最后，我们通过代入 $\\rho_v = 1 - \\epsilon_v$ 和 $\\rho_s = 1 - \\epsilon_s$，用给定的参数 $f_v, \\epsilon_v, \\epsilon_s, \\Gamma$ 来表示结果。\n$\\epsilon_v\\rho_s + \\epsilon_s\\rho_v$ 项变为：\n$$ \\epsilon_v(1-\\epsilon_s) + \\epsilon_s(1-\\epsilon_v) = \\epsilon_v - \\epsilon_v\\epsilon_s + \\epsilon_s - \\epsilon_s\\epsilon_v = \\epsilon_v + \\epsilon_s - 2\\epsilon_v\\epsilon_s $$\n$\\rho_v\\rho_s$ 项变为 $(1-\\epsilon_v)(1-\\epsilon_s)$。\n\n将这些代入 $\\alpha_{\\mathrm{eff}}$ 的表达式中，得到有效发射率 $\\epsilon_{\\mathrm{eff}} = \\alpha_{\\mathrm{eff}}$ 的最终闭合形式表达式：\n$$ \\epsilon_{\\mathrm{eff}} = \\frac{f_v \\epsilon_v + (1-f_v)\\epsilon_s + f_v(1-f_v)\\Gamma(\\epsilon_v + \\epsilon_s - 2\\epsilon_v\\epsilon_s)}{1 - \\Gamma^2 f_v(1-f_v)(1-\\epsilon_v)(1-\\epsilon_s)} $$\n该表达式代表了像元的总发射率，它考虑了单次散射的贡献（线性混合项 $f_v \\epsilon_v + (1-f_v)\\epsilon_s$）以及由植被和土壤组分之间无限次多次反射引起的增强效应（“空腔效应”）。",
            "answer": "$$\\boxed{\\frac{f_v \\epsilon_v + (1-f_v)\\epsilon_s + f_v(1-f_v)\\Gamma(\\epsilon_v + \\epsilon_s - 2\\epsilon_v\\epsilon_s)}{1 - \\Gamma^{2} f_v(1-f_v)(1-\\epsilon_v)(1-\\epsilon_s)}}$$"
        },
        {
            "introduction": "在探讨了比辐射率建模之后，我们现在可以解决完整的地表温度反演问题。本编程练习  涉及构建一个从模拟到反演的完整工作流程，您将使用辐射传输方程生成合成的卫星观测数据，然后反演该模型以估算地表温度。这个练习有力地展示了不准确的比辐射率假设（我们上一个练习的主题）如何直接传递并在最终的温度产品中造成显著误差。",
            "id": "3823833",
            "problem": "要求您基于物理原理，通过双通道分裂窗算法从热红外辐射中反演陆地表面温度（LST），并在使用朴素发射率假设时量化由发射率驱动的偏差。该反演必须基于第一性原理：普朗克定律和热红外辐射传输方程。您将根据真实地表温度、大气透过率、大气路径辐射、下行大气辐射和地表发射率，为两个热通道显式模拟大气层顶（TOA）辐射。然后，您将在两种发射率设置下（真实发射率和朴素恒定发射率假设）同时拟合两个通道来反演LST。由发射率驱动的偏差定义为使用朴素发射率反演的LST与使用真实发射率反演的LST之间的差值。\n\n基本原理：\n- 普朗克定律（单位波长的光谱辐射）：对于波长 $\\lambda$（单位：米）和物理温度 $T$（单位：开尔文），\n$$\nB_\\lambda(\\lambda, T) = \\frac{2 h c^2}{\\lambda^5} \\left( \\exp\\left(\\frac{h c}{\\lambda k_B T}\\right) - 1 \\right)^{-1},\n$$\n其中 $h$ 是普朗克常数，$c$ 是光速，$k_B$ 是玻尔兹曼常数。\n- 热红外（TIR）大气层顶辐射，对于通道 $i$，其大气透过率为 $\\tau_i$，上行路径辐射为 $L_{\\text{up},i}$，下行大气辐射为 $L_{\\text{down},i}$，地表发射率为 $\\varepsilon_i$，地表温度为 $T_s$，通道中心波长为 $\\lambda_i$（窄带近似），\n$$\nL_{\\text{TOA},i}(T_s) = \\tau_i \\left[ \\varepsilon_i B_\\lambda(\\lambda_i, T_s) + (1 - \\varepsilon_i) L_{\\text{down},i} \\right] + L_{\\text{up},i}.\n$$\n\n反演设计要求：\n- 联合使用两个通道。给定由真实参数生成的观测双通道TOA辐射 $L_{\\text{TOA},1}^{\\text{obs}}$ 和 $L_{\\text{TOA},2}^{\\text{obs}}$，通过最小化跨通道的残差平方和来反演 $T_s$，\n$$\nJ(T_s;\\,\\varepsilon_1,\\varepsilon_2) = \\sum_{i=1}^{2} \\left( L_{\\text{TOA},i}(T_s) - L_{\\text{TOA},i}^{\\text{obs}} \\right)^2,\n$$\n在物理上合理的区间内对 $T_s$ 进行最小化。执行此最小化两次：一次使用真实发射率 $(\\varepsilon_1,\\varepsilon_2)$，另一次使用朴素发射率假设 $(\\hat{\\varepsilon}_1,\\hat{\\varepsilon}_2)$。\n- 将一个案例中由发射率驱动的偏差 $\\Delta T$ 定义为\n$$\n\\Delta T = T_s^{\\text{naive}} - T_s^{\\text{true-fit}},\n$$\n其中 $T_s^{\\text{naive}}$ 是在 $(\\hat{\\varepsilon}_1,\\hat{\\varepsilon}_2)$ 下的最小化结果，$T_s^{\\text{true-fit}}$ 是在真实 $(\\varepsilon_1,\\varepsilon_2)$ 下的最小化结果。所有偏差均以开尔文表示。\n\n通道：\n- 使用两个热红外（TIR）通道，中心波长分别为 $\\lambda_1 = 10.8\\,\\mu\\text{m}$ 和 $\\lambda_2 = 12.0\\,\\mu\\text{m}$，即 $\\lambda_1 = 10.8 \\times 10^{-6}\\,\\text{m}$ 和 $\\lambda_2 = 12.0 \\times 10^{-6}\\,\\text{m}$。\n\n朴素发射率假设：\n- 对所有地表使用 $(\\hat{\\varepsilon}_1, \\hat{\\varepsilon}_2) = (0.98, 0.98)$。\n\n测试套件：\n- 对于每个案例，指定 $(T_s^{\\text{true}}, \\varepsilon_1, \\varepsilon_2, \\tau_1, \\tau_2, L_{\\text{up},1}, L_{\\text{up},2}, L_{\\text{down},1}, L_{\\text{down},2})$；使用正向模型和真实参数模拟 $L_{\\text{TOA},i}^{\\text{obs}}$。\n\n案例1（沙漠，干燥）：\n- $T_s^{\\text{true}} = 320\\,\\text{K}$，\n- $(\\varepsilon_1, \\varepsilon_2) = (0.92, 0.89)$,\n- $(\\tau_1, \\tau_2) = (0.85, 0.80)$,\n- $(L_{\\text{up},1}, L_{\\text{up},2}) = (1.2, 1.6)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$,\n- $(L_{\\text{down},1}, L_{\\text{down},2}) = (3.0, 3.5)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$。\n\n案例2（沙漠，湿润）：\n- $T_s^{\\text{true}} = 320\\,\\text{K}$，\n- $(\\varepsilon_1, \\varepsilon_2) = (0.92, 0.89)$,\n- $(\\tau_1, \\tau_2) = (0.65, 0.55)$,\n- $(L_{\\text{up},1}, L_{\\text{up},2}) = (2.5, 3.2)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$,\n- $(L_{\\text{down},1}, L_{\\text{down},2}) = (6.0, 7.0)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$。\n\n案例3（植被，干燥）：\n- $T_s^{\\text{true}} = 300\\,\\text{K}$，\n- $(\\varepsilon_1, \\varepsilon_2) = (0.98, 0.98)$,\n- $(\\tau_1, \\tau_2) = (0.85, 0.80)$,\n- $(L_{\\text{up},1}, L_{\\text{up},2}) = (1.2, 1.6)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$,\n- $(L_{\\text{down},1}, L_{\\text{down},2}) = (3.0, 3.5)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$。\n\n案例4（植被，湿润）：\n- $T_s^{\\text{true}} = 300\\,\\text{K}$，\n- $(\\varepsilon_1, \\varepsilon_2) = (0.98, 0.98)$,\n- $(\\tau_1, \\tau_2) = (0.65, 0.55)$,\n- $(L_{\\text{up},1}, L_{\\text{up},2}) = (2.5, 3.2)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$,\n- $(L_{\\text{down},1}, L_{\\text{down},2}) = (6.0, 7.0)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$。\n\n案例5（沙漠，极低发射率，极湿润；边缘案例）：\n- $T_s^{\\text{true}} = 330\\,\\text{K}$，\n- $(\\varepsilon_1, \\varepsilon_2) = (0.85, 0.80)$,\n- $(\\tau_1, \\tau_2) = (0.50, 0.40)$,\n- $(L_{\\text{up},1}, L_{\\text{up},2}) = (3.0, 4.0)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$,\n- $(L_{\\text{down},1}, L_{\\text{down},2}) = (8.0, 9.5)\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$。\n\n实现要求：\n- 对每个案例，使用正向模型和真实参数模拟 $L_{\\text{TOA},i}^{\\text{obs}}$。\n- 对每个案例，执行两次拟合：\n  1. 使用真实发射率 $(\\varepsilon_1, \\varepsilon_2)$ 进行最小化，以获得 $T_s^{\\text{true-fit}}$。\n  2. 使用朴素发射率 $(\\hat{\\varepsilon}_1, \\hat{\\varepsilon}_2)$ 进行最小化，以获得 $T_s^{\\text{naive}}$。\n- 计算每个案例中由发射率驱动的偏差 $\\Delta T$（单位：开尔文），并将每个值四舍五入到三位小数。\n\n单位：\n- 温度必须以开尔文为单位。\n- 辐射必须以 $\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$ 为单位。\n- 在计算中，波长必须以米为单位，通道定义中给出的微米单位需转换为米。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有五个测试案例中由发射率驱动的偏差，格式为方括号内的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是一个浮点数（单位：开尔文），四舍五入到三位小数。",
            "solution": "问题陈述具有科学依据，提法恰当且完整。它描述了在定量热红外遥感中反演陆地表面温度（LST）和评估发射率不确定性影响的标准流程。物理模型基于基本原理，即普朗克黑体辐射定律和热红外波段非散射大气的简化辐射传输方程。所有必需的参数、常数和程序步骤都已明确提供。因此，该问题是有效的。\n\n解决方案主要分三个阶段进行：\n1.  **正向模拟**：我们首先模拟卫星传感器在两个热通道上将测量到的大气层顶（TOA）辐射。这是通过使用提供的辐射传输模型和每个测试案例的“真实”参数来实现的。\n2.  **反演**：然后我们反转此过程以反演LST（$T_s$）。该反演被表述为一个非线性优化问题。我们寻求一个温度 $T_s$，该温度能够最小化模型预测的辐射与第一步中模拟的“观测”辐射之间的残差平方和。\n3.  **偏差量化**：对每个案例执行两次反演。第一次反演使用真实的地表发射率 $(\\varepsilon_1, \\varepsilon_2)$，得到参考LST $T_s^{\\text{true-fit}}$。第二次反演使用朴素的恒定发射率假设 $(\\hat{\\varepsilon}_1, \\hat{\\varepsilon}_2)$，得到有偏差的LST $T_s^{\\text{naive}}$。由发射率驱动的偏差即为差值 $\\Delta T = T_s^{\\text{naive}} - T_s^{\\text{true-fit}}$。\n\n**1. 物理和数学公式**\n\n模型的基础是普朗克定律，它给出了黑体在温度 $T$ 下的光谱辐射 $B_\\lambda$ 作为波长 $\\lambda$ 的函数。公式为：\n$$\nB_\\lambda(\\lambda, T) = \\frac{2 h c^2}{\\lambda^5} \\left( \\exp\\left(\\frac{h c}{\\lambda k_B T}\\right) - 1 \\right)^{-1}\n$$\n其中 $h$ 是普朗克常数（$6.62607015 \\times 10^{-34}\\,\\text{J}\\,\\text{s}$），$c$ 是光速（$2.99792458 \\times 10^{8}\\,\\text{m}\\,\\text{s}^{-1}$），$k_B$ 是玻尔兹曼常数（$1.380649 \\times 10^{-23}\\,\\text{J}\\,\\text{K}^{-1}$）。该公式提供的辐射单位为 $\\text{W}\\,\\text{m}^{-3}\\,\\text{sr}^{-1}$。由于问题指定的辐射单位是 $\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$，因此需要对普朗克函数的输出应用 $10^{-6}$ 的转换因子以匹配单位。\n\n给定通道 $i$ 的TOA辐射 $L_{\\text{TOA},i}$ 由辐射传输方程（RTE）建模：\n$$\nL_{\\text{TOA},i}(T_s) = \\tau_i \\left[ \\varepsilon_i B_\\lambda(\\lambda_i, T_s) + (1 - \\varepsilon_i) L_{\\text{down},i} \\right] + L_{\\text{up},i}\n$$\n此处，$\\tau_i$ 是大气透过率，$\\varepsilon_i$ 是地表发射率，$L_{\\text{down},i}$ 是下行大气辐射，$L_{\\text{up},i}$ 是通道 $i$ 的上行大气路径辐射。两个通道的中心波长为 $\\lambda_1 = 10.8 \\times 10^{-6}\\,\\text{m}$ 和 $\\lambda_2 = 12.0 \\times 10^{-6}\\,\\text{m}$。\n\n**2. 算法实现**\n\n对于五个测试案例中的每一个，我们首先通过应用RTE以及该案例提供的所有真实参数（包括真实地表温度 $T_s^{\\text{true}}$），来模拟“观测”到的辐射 $L_{\\text{TOA},1}^{\\text{obs}}$ 和 $L_{\\text{TOA},2}^{\\text{obs}}$。\n\n接下来，我们建立用于反演的成本函数 $J(T_s)$：\n$$\nJ(T_s;\\,\\varepsilon_1,\\varepsilon_2) = \\sum_{i=1}^{2} \\left( L_{\\text{TOA},i}(T_s; \\varepsilon_i, \\tau_i, L_{\\text{up},i}, L_{\\text{down},i}) - L_{\\text{TOA},i}^{\\text{obs}} \\right)^2\n$$\n$T_s$ 的反演涉及找到使此成本函数最小化的温度。由于 $L_{\\text{TOA},i}(T_s)$ 是 $T_s$ 的严格单调函数，成本函数 $J(T_s)$ 是凸函数并且有唯一的最小值。我们可以使用数值优化算法找到这个最小值。一维有界最小化器，例如 `scipy.optimize.minimize_scalar`，非常适合此任务。我们为 $T_s$ 定义一个物理上合理的搜索区间，例如 [$200\\,\\text{K}$, $400\\,\\text{K}$]。\n\n这个最小化过程执行两次：\n1.  **真实拟合反演**：我们使用测试案例中的真实发射率 $(\\varepsilon_1, \\varepsilon_2)$ 来最小化 $J(T_s; \\varepsilon_1, \\varepsilon_2)$。得到的温度是 $T_s^{\\text{true-fit}}$。在没有数值误差的理想情况下，这应该等于 $T_s^{\\text{true}}$。\n2.  **朴素拟合反演**：我们使用朴素发射率 $(\\hat{\\varepsilon}_1, \\hat{\\varepsilon}_2) = (0.98, 0.98)$ 来最小化 $J(T_s; \\hat{\\varepsilon}_1, \\hat{\\varepsilon}_2)$。得到的温度是 $T_s^{\\text{naive}}$。\n\n最后，该案例中由发射率驱动的偏差计算为 $\\Delta T = T_s^{\\text{naive}} - T_s^{\\text{true-fit}}$。收集所有五个案例的结果，四舍五入到三位小数，并按指定格式化。对于真实发射率等于朴素假设的案例（案例3和4），偏差 $\\Delta T$ 预期为 $0$。对于真实发射率低于朴素假设的案例（案例1、2、5），反演算法将通过找到一个较低的温度 $T_s^{\\text{naive}}$ 来补偿被高估的发射率 $\\hat{\\varepsilon}_i$，从而导致负偏差。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the LST retrieval problem for all test cases and prints the results.\n    \"\"\"\n    # Physical Constants\n    H = 6.62607015e-34  # Planck's constant (J s)\n    C = 2.99792458e8    # Speed of light (m/s)\n    KB = 1.380649e-23   # Boltzmann constant (J/K)\n    \n    # Channel Wavelengths (m)\n    LAMBDA_1 = 10.8e-6\n    LAMBDA_2 = 12.0e-6\n\n    # Naive Emissivity Assumption\n    EPS_NAIVE = (0.98, 0.98)\n\n    # Test cases data\n    test_cases = [\n        # Case 1 (desert, dry)\n        {\n            \"Ts_true\": 320.0,\n            \"eps_true\": (0.92, 0.89),\n            \"tau\": (0.85, 0.80),\n            \"L_up\": (1.2, 1.6),\n            \"L_down\": (3.0, 3.5),\n        },\n        # Case 2 (desert, humid)\n        {\n            \"Ts_true\": 320.0,\n            \"eps_true\": (0.92, 0.89),\n            \"tau\": (0.65, 0.55),\n            \"L_up\": (2.5, 3.2),\n            \"L_down\": (6.0, 7.0),\n        },\n        # Case 3 (vegetation, dry)\n        {\n            \"Ts_true\": 300.0,\n            \"eps_true\": (0.98, 0.98),\n            \"tau\": (0.85, 0.80),\n            \"L_up\": (1.2, 1.6),\n            \"L_down\": (3.0, 3.5),\n        },\n        # Case 4 (vegetation, humid)\n        {\n            \"Ts_true\": 300.0,\n            \"eps_true\": (0.98, 0.98),\n            \"tau\": (0.65, 0.55),\n            \"L_up\": (2.5, 3.2),\n            \"L_down\": (6.0, 7.0),\n        },\n        # Case 5 (desert, very low emissivity, very humid)\n        {\n            \"Ts_true\": 330.0,\n            \"eps_true\": (0.85, 0.80),\n            \"tau\": (0.50, 0.40),\n            \"L_up\": (3.0, 4.0),\n            \"L_down\": (8.0, 9.5),\n        },\n    ]\n\n    def planck_function(lam, T):\n        \"\"\"\n        Calculates spectral radiance using Planck's law.\n        Args:\n            lam (float): Wavelength in meters.\n            T (float): Temperature in Kelvin.\n        Returns:\n            float: Spectral radiance in W m^-2 sr^-1 um^-1.\n        \"\"\"\n        c1 = 2 * H * C**2\n        c2 = H * C / KB\n        val = c1 / (lam**5 * (np.exp(c2 / (lam * T)) - 1))\n        return val * 1e-6  # Convert from W m^-3 sr^-1 to W m^-2 sr^-1 um^-1\n\n    def forward_model(Ts, lam, eps, tau, L_up, L_down):\n        \"\"\"\n        Calculates Top-of-Atmosphere (TOA) radiance for a single channel.\n        \"\"\"\n        B_lambda = planck_function(lam, Ts)\n        L_toa = tau * (eps * B_lambda + (1 - eps) * L_down) + L_up\n        return L_toa\n\n    biases = []\n    for case in test_cases:\n        Ts_true = case[\"Ts_true\"]\n        eps_true_1, eps_true_2 = case[\"eps_true\"]\n        tau_1, tau_2 = case[\"tau\"]\n        L_up_1, L_up_2 = case[\"L_up\"]\n        L_down_1, L_down_2 = case[\"L_down\"]\n\n        # 1. Simulate \"observed\" TOA radiances using true parameters\n        L_toa_obs_1 = forward_model(Ts_true, LAMBDA_1, eps_true_1, tau_1, L_up_1, L_down_1)\n        L_toa_obs_2 = forward_model(Ts_true, LAMBDA_2, eps_true_2, tau_2, L_up_2, L_down_2)\n\n        # 2. Define the cost function for minimization\n        def cost_function(T, eps1, eps2):\n            L_mod_1 = forward_model(T, LAMBDA_1, eps1, tau_1, L_up_1, L_down_1)\n            L_mod_2 = forward_model(T, LAMBDA_2, eps2, tau_2, L_up_2, L_down_2)\n            \n            residual_1 = L_mod_1 - L_toa_obs_1\n            residual_2 = L_mod_2 - L_toa_obs_2\n            \n            return residual_1**2 + residual_2**2\n\n        # 3. Retrieve LST with true emissivities\n        res_true_fit = minimize_scalar(\n            lambda T: cost_function(T, eps_true_1, eps_true_2),\n            bounds=(200, 400),\n            method='bounded'\n        )\n        Ts_true_fit = res_true_fit.x\n        \n        # 4. Retrieve LST with naive emissivities\n        res_naive = minimize_scalar(\n            lambda T: cost_function(T, EPS_NAIVE[0], EPS_NAIVE[1]),\n            bounds=(200, 400),\n            method='bounded'\n        )\n        Ts_naive = res_naive.x\n\n        # 5. Calculate and store the bias\n        bias = Ts_naive - Ts_true_fit\n        biases.append(round(bias, 3))\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, biases))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "尽管完全基于物理的反演能提供深刻的洞察，但业务化的地表温度算法通常依赖于更快速、基于经验定标的“分裂窗”方法。本练习  侧重于这类算法的实际应用。通过使用为湿润热带大气设计的系数来处理来自干燥中纬度场景的数据，您将量化一个关键的业务化误差来源，并理解为何算法必须在其特定的定标范围内应用。",
            "id": "3823837",
            "problem": "一颗卫星使用中心波长在 $11\\,\\mu\\mathrm{m}$ 和 $12\\,\\mu\\mathrm{m}$ 附近的两个相邻波段，在热红外（TIR）大气窗口观测一个有植被的半干旱地表。您需要利用一种广义二阶分裂窗法，从这两个波段的亮温中反演地表温度（LST）。该方法植根于热辐射传输方程（RTE）和普朗克定律，并结合一种具有物理依据的线性化方法，通过利用波段间亮温差来消除主要的大气项。该方法必须包含以下主导阶的、基于物理的校正：对波段间亮温差的线性和二次依赖关系，与平均发射率亏损成比例的校正，与波段发射率差异成比例的校正，以及由总水汽柱含量对发射率亏损的一阶调制。假设为天底观测。\n\n使用为单个像元测量的以下符合物理现实的场景参数：\n- 亮温：$T_{11} = 303.4\\,\\mathrm{K}$ 和 $T_{12} = 301.9\\,\\mathrm{K}$。\n- 地表发射率：$\\varepsilon_{11} = 0.982$ 和 $\\varepsilon_{12} = 0.976$。\n- 总水汽柱含量：$W = 2.3\\,\\mathrm{g\\,cm^{-2}}$。\n\n定义平均发射率和发射率差异为 $\\varepsilon = (\\varepsilon_{11} + \\varepsilon_{12})/2$ 和 $\\Delta \\varepsilon = \\varepsilon_{11} - \\varepsilon_{12}$。\n\n提供了两组不同的系数组，每组对应广义分裂窗近似在不同大气气候学条件下的不同训练结果：\n- 一组“真实”的中纬度干旱系数组：$(a_{0}, a_{1}, a_{2}, a_{3}, a_{4}, a_{5}) = (-0.268,\\, 1.378,\\, 0.183,\\, 54.3,\\, -2.238,\\, 0.146)$。\n- 一组误用的湿热带系数组：$(\\tilde{a}_{0}, \\tilde{a}_{1}, \\tilde{a}_{2}, \\tilde{a}_{3}, \\tilde{a}_{4}, \\tilde{a}_{5}) = (-0.463,\\, 1.892,\\, 0.271,\\, 62.7,\\, -3.125,\\, 0.180)$。\n\n从热辐射传输方程和普朗克定律出发，并围绕晴空参考态使用一阶线性化，以获得一个保留了上述校正的二阶分裂窗近似，推导出LST的显式反演公式，并应用两次：一次使用“真实”系数，一次使用误用系数。然后通过计算有符号偏差来量化系数误用的影响\n$$\n\\Delta T \\equiv \\widehat{T}_{s}^{(\\text{mis})} - \\widehat{T}_{s}^{(\\text{true})}.\n$$\n报告以开尔文为单位的 $\\Delta T$，并四舍五入到四位有效数字。您的最终答案必须是一个实数。不要在最终的方框答案中包含单位，但在您的推导过程中要用适当的单位表示所有中间量。",
            "solution": "根据指定标准对问题进行验证。\n\n### 问题验证\n\n**第1步：提取已知条件**\n-   卫星观测波段：中心波长在 $11\\,\\mu\\mathrm{m}$ 和 $12\\,\\mu\\mathrm{m}$ 附近。\n-   亮温：$T_{11} = 303.4\\,\\mathrm{K}$ 和 $T_{12} = 301.9\\,\\mathrm{K}$。\n-   地表发射率：$\\varepsilon_{11} = 0.982$ 和 $\\varepsilon_{12} = 0.976$。\n-   总水汽柱含量：$W = 2.3\\,\\mathrm{g\\,cm^{-2}}$。\n-   平均发射率定义：$\\varepsilon = (\\varepsilon_{11} + \\varepsilon_{12})/2$。\n-   发射率差异定义：$\\Delta \\varepsilon = \\varepsilon_{11} - \\varepsilon_{12}$。\n-   “真实”的中纬度干旱系数组：$(a_{0}, a_{1}, a_{2}, a_{3}, a_{4}, a_{5}) = (-0.268,\\, 1.378,\\, 0.183,\\, 54.3,\\, -2.238,\\, 0.146)$。\n-   误用的湿热带系数组：$(\\tilde{a}_{0}, \\tilde{a}_{1}, \\tilde{a}_{2}, \\tilde{a}_{3}, \\tilde{a}_{4}, \\tilde{a}_{5}) = (-0.463,\\, 1.892,\\, 0.271,\\, 62.7,\\, -3.125,\\, 0.180)$。\n-   偏差定义：$\\Delta T \\equiv \\widehat{T}_{s}^{(\\text{mis})} - \\widehat{T}_{s}^{(\\text{true})}$。\n-   要求输出：以开尔文为单位的 $\\Delta T$，四舍五入到四位有效数字。\n\n**第2步：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于热遥感的既定原理，特别是辐射传输理论及其在分裂窗算法中用于地表温度（LST）反演的应用。所提供的参数（温度、发射率、水汽）对于半干旱环境是符合物理现实的。\n-   **适定性**：该问题是适定的。它提供了计算唯一解所需的所有必要数据和模型结构的完整描述。目标定义明确。\n-   **客观性**：该问题以精确、客观的科学语言陈述，没有歧义或主观论斷。\n\n该问题没有表现出验证清单中列出的任何缺陷。它是环境遥感领域一个标准的、科学上有效的计算问题。\n\n**第3步：结论与行动**\n-   **结论**：问题有效。\n-   **行动**：继续解答。\n\n### 解题过程\n\n从卫星测量的热红外亮温中反演地表温度（$T_s$）的过程由辐射传输方程（RTE）控制。对于晴空下的非黑体热发射表面，传感器在光谱波段 $i$ 中测量的辐亮度 $L_i$ 可以近似表示为：\n$$L_i(\\lambda) = \\varepsilon_i B_i(T_s)\\tau_i(W) + L_{path,i}^\\uparrow (W) + (1-\\varepsilon_i)L_{atm,i}^\\downarrow(W)\\tau_i(W)$$\n其中 $\\varepsilon_i$ 是波段 $i$ 的地表发射率，$B_i(T_s)$ 是温度为 $T_s$ 的普朗克函数在该波段上的积分，$\\tau_i$ 是大气透过率，$L_{path,i}^\\uparrow$ 是上行大气路径辐射，$L_{atm,i}^\\downarrow$ 是下行大气辐射。大气透过率和辐亮度都是总水汽柱含量 $W$ 的强函数。\n\n分裂窗技术利用两个相邻热红外波段（这里是 $11\\,\\mu\\mathrm{m}$ 和 $12\\,\\mu\\mathrm{m}$）的吸收差异来校正大气效应，主要是水汽的影响。该问题描述了一种广义二阶分裂窗算法。根据指定的依赖关系，可以构建LST反演的函数形式。该描述要求：\n1.  一个基准温度（通常是亮温之一，$T_{11}$ 是合适的，因为它受大气影响较小）。\n2.  基于常数偏移（$a_0$）的校正。\n3.  亮温差（$T_{11} - T_{12}$）的线性和二次项，用于参数化大气校正。\n4.  针对地表非黑体的校正，与平均发射率亏损（$1-\\varepsilon$）和波段发射率差异（$\\Delta\\varepsilon$）成比例。\n5.  一个交叉项，用于模拟水汽对发射率亏损效应的调制，与 $(1-\\varepsilon)W$ 成比例。\n\n这导出了LST（$\\widehat{T}_s$）的以下显式公式：\n$$\\widehat{T}_s = T_{11} + a_0 + a_1(T_{11} - T_{12}) + a_2(T_{11} - T_{12})^2 + a_3(1 - \\varepsilon) + a_4\\Delta\\varepsilon + a_5(1 - \\varepsilon)W$$\n我们需要计算由于使用误用的系数组 $(\\tilde{a}_i)$ 而不是真实系数组 $(a_i)$ 所产生的偏差 $\\Delta T$。分别使用真实系数和误用系数的LST估算值为：\n$$\\widehat{T}_{s}^{(\\text{true})} = T_{11} + a_0 + a_1(T_{11} - T_{12}) + a_2(T_{11} - T_{12})^2 + a_3(1 - \\varepsilon) + a_4\\Delta\\varepsilon + a_5(1 - \\varepsilon)W$$\n$$\\widehat{T}_{s}^{(\\text{mis})} = T_{11} + \\tilde{a}_0 + \\tilde{a}_1(T_{11} - T_{12}) + \\tilde{a}_2(T_{11} - T_{12})^2 + \\tilde{a}_3(1 - \\varepsilon) + \\tilde{a}_4\\Delta\\varepsilon + \\tilde{a}_5(1 - \\varepsilon)W$$\n偏差 $\\Delta T$ 是这两个估算值之间的差：\n$$\\Delta T = \\widehat{T}_{s}^{(\\text{mis})} - \\widehat{T}_{s}^{(\\text{true})}$$\n从 $\\widehat{T}_{s}^{(\\text{mis})}$ 的表达式中减去 $\\widehat{T}_{s}^{(\\text{true})}$ 的表达式，公共项 $T_{11}$ 被消掉，我们可以按系数差异对各项进行分组：\n$$\\Delta T = (\\tilde{a}_0-a_0) + (\\tilde{a}_1-a_1)(T_{11}-T_{12}) + (\\tilde{a}_2-a_2)(T_{11}-T_{12})^2 + (\\tilde{a}_3-a_3)(1-\\varepsilon) + (\\tilde{a}_4-a_4)\\Delta\\varepsilon + (\\tilde{a}_5-a_5)(1-\\varepsilon)W$$\n\n首先，我们根据给定数据计算所需的中间物理量：\n-   亮温差：$T_{11} - T_{12} = 303.4\\,\\mathrm{K} - 301.9\\,\\mathrm{K} = 1.5\\,\\mathrm{K}$\n-   亮温差的平方：$(T_{11} - T_{12})^2 = (1.5\\,\\mathrm{K})^2 = 2.25\\,\\mathrm{K}^2$\n-   平均发射率：$\\varepsilon = \\frac{\\varepsilon_{11} + \\varepsilon_{12}}{2} = \\frac{0.982 + 0.976}{2} = 0.979$\n-   平均发射率亏损：$1 - \\varepsilon = 1 - 0.979 = 0.021$\n-   发射率差异：$\\Delta\\varepsilon = \\varepsilon_{11} - \\varepsilon_{12} = 0.982 - 0.976 = 0.006$\n-   发射率-水汽相互作用项：$(1-\\varepsilon)W = 0.021 \\times 2.3\\,\\mathrm{g\\,cm^{-2}} = 0.0483\\,\\mathrm{g\\,cm^{-2}}$\n\n接下来，我们计算误用系数与真实系数之间的差异，$\\Delta a_i = \\tilde{a}_i - a_i$：\n-   $\\Delta a_0 = -0.463 - (-0.268) = -0.195$\n-   $\\Delta a_1 = 1.892 - 1.378 = 0.514$\n-   $\\Delta a_2 = 0.271 - 0.183 = 0.088\\,\\mathrm{K^{-1}}$\n-   $\\Delta a_3 = 62.7 - 54.3 = 8.4\\,\\mathrm{K}$\n-   $\\Delta a_4 = -3.125 - (-2.238) = -0.887\\,\\mathrm{K}$\n-   $\\Delta a_5 = 0.180 - 0.146 = 0.034\\,\\mathrm{K\\,(g\\,cm^{-2})^{-1}}$\n\n现在，我们将这些值代入 $\\Delta T$ 的表达式中：\n$$\\Delta T = \\Delta a_0 + \\Delta a_1 (T_{11}-T_{12}) + \\Delta a_2 (T_{11}-T_{12})^2 + \\Delta a_3 (1-\\varepsilon) + \\Delta a_4 \\Delta\\varepsilon + \\Delta a_5 (1-\\varepsilon)W$$\n$$\\Delta T = -0.195 + (0.514)(1.5) + (0.088)(2.25) + (8.4)(0.021) + (-0.887)(0.006) + (0.034)(0.0483)$$\n计算各项对偏差的贡献（单位：开尔文）：\n-   来自 $\\Delta a_0$ 的贡献：$-0.195$\n-   来自 $\\Delta a_1$ 的贡献：$0.514 \\times 1.5 = 0.771$\n-   来自 $\\Delta a_2$ 的贡献：$0.088 \\times 2.25 = 0.198$\n-   来自 $\\Delta a_3$ 的贡献：$8.4 \\times 0.021 = 0.1764$\n-   来自 $\\Delta a_4$ 的贡献：$-0.887 \\times 0.006 = -0.005322$\n-   来自 $\\Delta a_5$ 的贡献：$0.034 \\times 0.0483 = 0.0016422$\n\n将这些贡献相加：\n$$\\Delta T = -0.195 + 0.771 + 0.198 + 0.1764 - 0.005322 + 0.0016422 = 0.9467202\\,\\mathrm{K}$$\n问题要求答案四舍五入到四位有效数字。计算值为 $0.9467202\\,\\mathrm{K}$。前四位有效数字是 $9, 4, 6, 7$。第五位有效数字是 $2$，因此向下取整。\n$$\\Delta T \\approx 0.9467\\,\\mathrm{K}$$\n这个正偏差表明，将为湿热带大气（通常需要更强的大气校正）导出的系数用于较干燥的中纬度场景，会导致地表温度的过高估计。",
            "answer": "$$\\boxed{0.9467}$$"
        }
    ]
}