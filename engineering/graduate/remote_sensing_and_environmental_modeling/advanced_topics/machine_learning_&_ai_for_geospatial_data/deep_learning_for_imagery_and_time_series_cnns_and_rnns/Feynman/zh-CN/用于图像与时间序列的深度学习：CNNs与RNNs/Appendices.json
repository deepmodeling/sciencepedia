{
    "hands_on_practices": [
        {
            "introduction": "在处理高光谱等高维遥感数据时，模型的计算效率是一个核心挑战。本练习从第一性原理出发，引导你量化和比较标准三维卷积与可分离卷积的参数量和计算成本。通过这项实践，你将掌握评估和优化网络架构效率的关键技能，为设计适用于大规模环境建模的轻量化、高效率深度学习模型奠定基础。",
            "id": "3805474",
            "problem": "考虑一个高光谱图像立方体，表示为三维张量 $X \\in \\mathbb{R}^{H \\times W \\times C}$，其中 $H$ 和 $W$ 是空间高度和宽度，而 $C$ 是光谱带的数量。您设计一个层，该层使用 $F$ 个输出滤波器执行三维卷积，所有维度的步长为 $1$，并选择填充（padding）以使输出具有与输入相同的空间和光谱维度（通常称为“same”填充）。每个滤波器使用一个大小为 $(k_{s}, k_{s}, k_{\\lambda})$ 的空间-光谱核（kernel），并且在卷积之后为每个输出滤波器添加一个标量偏置（bias）。您需要从第一性原理出发，量化模型的复杂度和计算负担。\n\n从离散卷积的定义（即在核支撑域上的乘积之和）开始，并将计算成本定义为在单个输入立方体 $X$ 上单次前向传播中执行的标量乘法-累加对（一次乘法后跟一次加法，通常缩写为乘加运算（MAC））的总数。在计算 MAC 时，将偏置的加法视为可忽略不计。\n\n现在考虑一种替代设计，其中每个输出滤波器的三维核被限制为空间-光谱可分离的，即该核等于一个空间二维核 $A \\in \\mathbb{R}^{k_{s} \\times k_{s}}$ 和一个光谱一维核 $b \\in \\mathbb{R}^{k_{\\lambda}}$ 的外积。将此可分离核实现为两个连续的卷积：首先，在每个光谱索引处独立地应用与 $A$ 的二维卷积；然后，在每个空间位置处独立地沿光谱维度应用与 $b$ 的一维卷积；最后为每个输出滤波器添加一个标量偏置。假设在每个阶段，步长为 $1$ 并且选择填充以保持维度不变。\n\n对于密集三维卷积和可分离空间-光谱设计，请推导出单次前向传播中可训练参数的总数和 MAC 的总数的符号表达式，用 $H$、$W$、$C$、$F$、$k_{s}$ 和 $k_{\\lambda}$ 表示。最后，以闭式解析表达式的形式给出两个比率：密集卷积与可分离卷积的参数数量之比，以及密集卷积与可分离卷积的 MAC 数量之比。请仅以这两个比率作为最终答案，形式为精确的符号表达式，不进行任何数值代入或四舍五入。",
            "solution": "此问题要求从第一性原理出发，推导应用于高光谱数据立方体的两种三维卷积层的可训练参数数量和计算复杂度（以乘加运算或 MAC 为单位）。输入是一个张量 $X \\in \\mathbb{R}^{H \\times W \\times C}$，其中 $H$ 和 $W$ 是空间维度， $C$ 是光谱维度。该层有 $F$ 个输出滤波器。在这两种情况下，步长均为 $1$，并选择填充以保持每个输出特征图的输入维度 $H, W, C$ 不变。\n\n首先，我们分析标准（密集）三维卷积。\n\n一个具有 $F$ 个滤波器的密集三维卷积层有 $F$ 个不同的核。对于滤波器 $f \\in \\{1, \\dots, F\\}$，我们将其核表示为 $K_f$，它是一个大小为 $k_s \\times k_s \\times k_\\lambda$ 的三维张量。此外，每个滤波器 $f$ 都有一个标量偏置项 $b_f$。\n\n单个滤波器 $f$ 的可训练参数数量是其核中元素数量与偏置之和。核 $K_f$ 有 $k_s \\times k_s \\times k_\\lambda = k_s^2 k_\\lambda$ 个权重参数。偏置 $b_f$ 是 $1$ 个参数。因此，一个滤波器有 $(k_s^2 k_\\lambda + 1)$ 个参数。由于有 $F$ 个这样的滤波器，每个滤波器都有一套独立的参数，所以密集卷积层的可训练参数总数 $P_{\\text{dense}}$ 为：\n$$P_{\\text{dense}} = F \\cdot (k_s^2 k_\\lambda + 1)$$\n\n接下来，我们计算单次前向传播的 MAC 数量。一个 MAC 定义为一次乘法后跟一次加法。输出特征图中每个元素的计算涉及核与输入张量相应区域的点积。对于一个大小为 $k_s \\times k_s \\times k_\\lambda$ 的核，这个点积需要 $k_s^2 k_\\lambda$ 次乘法。根据问题的定义，这对应于 $k_s^2 k_\\lambda$ 次 MAC（因为在计算 MAC 时，偏置的加法被视为可忽略不计）。\n\n该层产生 $F$ 个输出特征图。由于“same”填充和步长为 $1$，每个特征图的维度为 $H \\times W \\times C$。因此，输出张量中元素的总数为 $F \\times H \\times W \\times C$。由于计算这些元素中的每一个都需要 $k_s^2 k_\\lambda$ 次 MAC，因此密集卷积层的 MAC 总数 $M_{\\text{dense}}$ 为：\n$$M_{\\text{dense}} = (F \\cdot H \\cdot W \\cdot C) \\cdot (k_s^2 k_\\lambda) = F \\cdot HWC \\cdot k_s^2 k_\\lambda$$\n\n其次，我们分析空间-光谱可分离卷积。\n\n在此设计中，$F$ 个滤波器中的每一个都不是由一个密集的三维核来参数化，而是由一对较小的核来参数化：一个空间核 $A_f \\in \\mathbb{R}^{k_s \\times k_s}$ 和一个光谱核 $b_f \\in \\mathbb{R}^{k_\\lambda}$。密集三维核被隐式地定义为 $A_f$ 和 $b_f$ 的外积。\n\n单个滤波器 $f$ 的可训练参数数量是 $A_f$ 中的元素数量、$b_f$ 中的元素数量以及单个标量偏置之和。空间核 $A_f$ 有 $k_s^2$ 个参数。光谱核 $b_f$ 有 $k_\\lambda$ 个参数。偏置是 $1$ 个参数。因此，一个可分离滤波器有 $(k_s^2 + k_\\lambda + 1)$ 个参数。对于 $F$ 个滤波器，参数总数 $P_{\\text{sep}}$ 为：\n$$P_{\\text{sep}} = F \\cdot (k_s^2 + k_\\lambda + 1)$$\n\n计算成本是通过分析所描述的两阶段过程来计算的。\n阶段 1：应用二维空间卷积。对于 $F$ 个滤波器中的每一个，其空间核 $A_f$ 与输入张量 $X$ 的 $C$ 个光谱切片中的每一个进行卷积。为了为滤波器 $f$ 生成一个大小为 $H \\times W \\times C$ 的中间特征图，我们执行 $C$ 次独立的二维卷积（每个切片一次）。在这些二维卷积中计算一个像素的成本是 $k_s^2$ 次 MAC。对于单个滤波器 $f$，在 $H \\times W$ 空间维度和 $C$ 个切片上的成本是 $H \\cdot W \\cdot C \\cdot k_s^2$。对于所有 $F$ 个滤波器，阶段 1 的 MAC 总数 $M_1$ 是：\n$$M_1 = F \\cdot HWC \\cdot k_s^2$$\n\n阶段 2：应用一维光谱卷积。对于每个滤波器 $f$，其光谱核 $b_f$ 与阶段 1 生成的中间特征图进行卷积。该卷积沿光谱维度执行，对于 $H \\times W$ 个空间位置中的每一个都是独立的。计算一个最终输出像素的成本是一次长度为 $k_\\lambda$ 的一维卷积，需要 $k_\\lambda$ 次 MAC。最终输出有 $F \\cdot H \\cdot W \\cdot C$ 个元素。因此，阶段 2 的 MAC 总数 $M_2$ 是：\n$$M_2 = F \\cdot HWC \\cdot k_\\lambda$$\n\n可分离设计的 MAC 总数 $M_{\\text{sep}}$ 是两个阶段 MAC 数量的总和：\n$$M_{\\text{sep}} = M_1 + M_2 = F \\cdot HWC \\cdot k_s^2 + F \\cdot HWC \\cdot k_\\lambda = F \\cdot HWC \\cdot (k_s^2 + k_\\lambda)$$\n\n最后，我们计算所需的比率。\n\n参数数量之比为：\n$$\\text{Ratio}_P = \\frac{P_{\\text{dense}}}{P_{\\text{sep}}} = \\frac{F (k_s^2 k_\\lambda + 1)}{F (k_s^2 + k_\\lambda + 1)} = \\frac{k_s^2 k_\\lambda + 1}{k_s^2 + k_\\lambda + 1}$$\n\nMAC 数量之比为：\n$$\\text{Ratio}_M = \\frac{M_{\\text{dense}}}{M_{\\text{sep}}} = \\frac{F \\cdot HWC \\cdot k_s^2 k_\\lambda}{F \\cdot HWC \\cdot (k_s^2 + k_\\lambda)} = \\frac{k_s^2 k_\\lambda}{k_s^2 + k_\\lambda}$$\n\n这两个表达式分别代表了使用可分离卷积替代密集卷积所实现的模型复杂度和计算成本的降低。",
            "answer": "$$\n\\boxed{\n\\frac{k_s^2 k_\\lambda + 1}{k_s^2 + k_\\lambda + 1}, \\quad \\frac{k_s^2 k_\\lambda}{k_s^2 + k_\\lambda}\n}\n$$"
        },
        {
            "introduction": "一个设计精良的模型架构必须经过严格且无偏的验证，才能在科学研究中得到可靠应用，尤其是在处理具有空间自相关性的地理空间数据时。标准交叉验证方法因违反独立同分布假设而常常导致过于乐观的性能评估。本练习将指导你推导一种空间分块交叉验证方案，这对于在遥感和环境科学中获得可信的模型泛化误差估计至关重要。",
            "id": "3805490",
            "problem": "一个土地覆盖分类模型在多光谱卫星影像和月度时间序列上进行训练，用于在一个大型农业区域内以像素尺度预测离散的土地覆盖类别。输入是从 Sentinel-2 数据中提取的二维空间图块和十二个月的时间序列。该模型架构是一个混合卷积神经网络（CNN, Convolutional Neural Network）和循环神经网络（RNN, Recurrent Neural Network）：三个卷积层的卷积核大小分别为 $5$、$3$ 和 $3$，步幅为 $1$，其输出被送入一个处理 $12$ 个时间步的门控循环单元。像素在 $x$ 和 $y$ 方向上的分辨率均为 $10\\ \\mathrm{m}$。研究区域在光谱特征和标签上都表现出各向同性、平稳的空间自相关性，其相关函数为 $\\rho(d) = \\exp\\!\\left(-d/\\lambda\\right)$，其中 $d$ 是以米为单位的欧几里得距离，$\\lambda = 150\\ \\mathrm{m}$ 是根据经验半变异图估计的相关长度。用于分类中泛化误差的交叉验证风险估计器定义为在留出折上的平均损失。\n\n请从第一性原理出发，解释为什么当存在正空间自相关且模型具有非零空间感受野时，像素级别的随机K折交叉验证会导致对泛化误差的估计产生乐观偏差。然后，推导一个二维空间分块交叉验证方案，通过确保训练集和测试集在边界处近似独立来减少这种乐观偏差。推导必须从独立性、空间自相关和CNN的有效感受野的定义开始。具体而言：\n\n- 根据指定的架构和像素分辨率，推导CNN的有效空间感受野半径 $r$（以米为单位），将感受野解释为输入像素可以影响中心像素预测的最大半径。\n- 使用自相关函数 $\\rho(d)$ 和独立性阈值 $\\epsilon = 0.05$，推导测试块周围足够的缓冲宽度 $h$（以米为单位），使得任何可能影响测试预测的训练像素与测试像素本身之间的最大互相关满足 $\\rho(h - r) \\le \\epsilon$ 的界限。\n- 说明应如何构建块并将其分配到折中，以便在给定的自相关模型下产生近似无偏的交叉验证风险估计。提供块大小相对于 $\\lambda$ 和 $r$ 的任何必要条件，并解释如何在折中处理时间序列。\n\n计算满足该界限的 $r$ 和最小 $h$ 的数值。然后选择一个正确描述了与您的推导一致的空间分块方案的选项。\n\n选项：\nA. 执行像素级别的随机K折交叉验证，并采用类别分层抽样以确保每折的类别平衡；不使用空间块或缓冲区。这能保持样本的独立同分布并产生无偏的风险估计。\n\nB. 将地图划分为边长等于相关长度 $\\lambda$ 的不重叠方形测试瓦片；对于每一折，在测试瓦片外的所有像素上进行训练，不设缓冲区。保持瓦片内所有时间序列的完整性。\n\nC. 使用二维空间h-分块交叉验证：定义边长至少为 $3\\lambda$ 的方形测试块，将块分配到K个折中，对于每一折，仅在距离任何测试块至少 $h$ 米的像素上进行训练，其中 $h \\ge r + \\lambda \\ln(1/\\epsilon)$ 是根据感受野半径 $r$ 和相关函数 $\\rho(d)$ 计算得出的；在训练块和测试块中都保持完整的12个月序列。这在各向同性自相关模型下能产生近似无偏的风险估计。\n\nD. 通过在整个区域内留出交替的月份并在其余月份上进行训练来执行时间分块交叉验证。训练和测试月份共享空间位置；不应用空间缓冲。\n\nE. 使用空间分块交叉验证，块的边长至少为 $3\\lambda$，缓冲区的宽度仅等于感受野半径 $r$；将块分配到折中并保持时间序列完整。这确保了训练和测试像素永远不会在一个感受野之内，并且足以消除乐观偏差。",
            "solution": "用户提供的问题陈述是有效的。它在科学上基于地理统计学和机器学习的原理，问题提出得很好，目标明确，信息充分，并使用了客观、精确的语言。所描述的场景是深度学习应用于地理空间数据的典型问题。我现在将开始解答。\n\n### 1. 随机像素级交叉验证的乐观偏差\n\nK折交叉验证的基本假设是，每一折的训练和测试数据集都是从潜在数据分布中独立抽取的。当这个假设成立时，各折的平均误差为模型泛化误差提供了一个无偏估计。\n\n问题指出数据中存在正空间自相关，由函数 $\\rho(d) = \\exp(-d/\\lambda)$ 描述，其中 $d$ 是距离。这意味着彼此靠近的像素不是独立的；它们的特征值和类别标签是相关的。两个像素越近，它们的相关性就越高。\n\n当在像素级别执行随机K折交叉验证时，每个像素被分配到某个折中，而这与其空间位置无关。因此，对于一个折的测试集中的任何给定像素，其紧邻区域几乎肯定会有来自训练集的像素。\n\n模型的卷积神经网络（CNN）组件基于输入像素的空间邻域（由其感受野定义）进行预测。由于空间自相关，靠近测试像素的训练像素所携带的信息与测试像素及其邻域中的信息高度冗余。因此，模型是在与测试数据并非真正独立的数据上进行训练的。这种现象通常被称为“信息泄露”。\n\n结果，模型在留出测试数据上的表现会被人为地抬高，因为它没有在真正未见过、独立的样本上进行评估。由此产生的泛化误差估计会系统性地低于在地理上分离的独立数据集上观察到的真实误差。这种向下的偏差被称为“乐观偏差”。\n\n### 2. 空间分块交叉验证方案的推导\n\n为了获得更准确的泛化误差估计，必须使训练集和测试集近似独立。这可以通过在它们之间强制施加一个最小的空间间隔来实现。\n\n#### 2.1. 有效感受野半径 ($r$)\n\nCNN的感受野是影响单个输出单元的输入区域的大小。中心像素的预测受到特定半径内输入像素的影响。我们必须首先计算这个感受野的大小（以像素为单位），然后将其转换为米。\n\n该网络有三个连续的卷积层，步幅为 $s=1$。第 $i$ 层之后的感受野大小（$RF$）由以下递归公式给出：\n$$RF_i = RF_{i-1} + (k_i - 1) \\prod_{j=1}^{i-1} s_j$$\n鉴于所有步幅均为 $s_j = 1$，该公式简化为 $RF_i = RF_{i-1} + (k_i - 1)$。输入层的感受野为 $RF_0 = 1$。\n\n- 经过第1层（卷积核大小 $k_1 = 5$）：\n  $RF_1 = RF_0 + (k_1 - 1) = 1 + (5 - 1) = 5$\n- 经过第2层（卷积核大小 $k_2 = 3$）：\n  $RF_2 = RF_1 + (k_2 - 1) = 5 + (3 - 1) = 7$\n- 经过第3层（卷积核大小 $k_3 = 3$）：\n  $RF_3 = RF_2 + (k_3 - 1) = 7 + (3 - 1) = 9$\n\n最终的感受野是一个 $9 \\times 9$ 的像素块。问题将半径 $r$ 定义为从中心像素到有影响的输入像素的最大半径。对于一个 $9 \\times 9$ 的区域，该区域从中心沿主轴延伸 $(9-1)/2 = 4$ 个像素。\n像素分辨率为 $10\\ \\mathrm{m}$。因此，以米为单位的感受野半径 $r$ 为：\n$r = 4\\ \\text{pixels} \\times 10\\ \\mathrm{m/pixel} = 40\\ \\mathrm{m}$\n\n#### 2.2. 足够的缓冲宽度 ($h$)\n\n空间分块交叉验证方案在任何训练像素和任何测试像素之间引入一个宽度为 $h$ 的缓冲区。设 $p_{test}$ 是测试块中的一个像素，$p_{train}$ 是训练集中的一个像素。它们之间的最小距离是 $h$。\n\n$p_{test}$ 处的预测受到其感受野内输入像素的影响，即距离 $p_{test}$ 最多为 $r$ 的像素。设 $p_{input}$ 是这样一个输入像素。我们希望对训练数据和用于进行测试预测的数据之间的相关性设置一个界限。“最坏情况”场景，即相关性最大化的情况，发生在训练像素和用于测试预测的输入像素之间的距离最小时。\n\n根据三角不等式，任何影响 $p_{test}$ 处预测的输入像素 $p_{input}$ 与任何训练像素 $p_{train}$ 之间的距离为：\n$$\\text{dist}(p_{input}, p_{train}) \\ge \\text{dist}(p_{test}, p_{train}) - \\text{dist}(p_{test}, p_{input})$$\n当 $p_{test}$ 位于测试块的边缘，而 $p_{input}$ 和 $p_{train}$ 位于从 $p_{test}$ 延伸出的一条直线上，其中 $p_{input}$ 在感受野内，$p_{train}$ 在缓冲区外时，距离最小。最小距离为 $\\text{dist}(p_{test}, p_{train}) \\ge h$。最大距离为 $\\text{dist}(p_{test}, p_{input}) \\le r$。因此，用于测试预测的任何输入像素与任何训练像素之间的最小距离是 $h - r$。\n\n问题要求最大互相关受 $\\epsilon = 0.05$ 的限制。自相关函数是单调递减的，因此，如果在可能的最小距离处的相关性小于或等于 $\\epsilon$，则此条件得到满足：\n$$\\rho(h - r) \\le \\epsilon$$\n将给定的自相关函数 $\\rho(d) = \\exp(-d/\\lambda)$ 代入：\n$$\\exp\\left(-\\frac{h - r}{\\lambda}\\right) \\le \\epsilon$$\n为了解出 $h$，我们对两边取自然对数：\n$$-\\frac{h - r}{\\lambda} \\le \\ln(\\epsilon)$$\n乘以 $-\\lambda$（一个正常数）会反转不等式：\n$$h - r \\ge -\\lambda \\ln(\\epsilon)$$\n$$h - r \\ge \\lambda \\ln\\left(\\frac{1}{\\epsilon}\\right)$$\n$$h \\ge r + \\lambda \\ln\\left(\\frac{1}{\\epsilon}\\right)$$\n这是推导出的足够缓冲宽度 $h$ 的条件。\n\n#### 2.3. $r$ 和 $h$ 的数值计算\n\n根据上一节，感受野半径为：\n$$r = 40\\ \\mathrm{m}$$\n\n现在，我们计算满足不等式的最小 $h$。给定：\n- $r = 40\\ \\mathrm{m}$\n- $\\lambda = 150\\ \\mathrm{m}$\n- $\\epsilon = 0.05$\n\n$$h \\ge 40\\ \\mathrm{m} + (150\\ \\mathrm{m}) \\ln\\left(\\frac{1}{0.05}\\right)$$\n$$h \\ge 40 + 150 \\ln(20)$$\n使用 $\\ln(20) \\approx 2.9957$:\n$$h \\ge 40 + 150 \\times 2.9957$$\n$$h \\ge 40 + 449.355$$\n$$h \\ge 489.355\\ \\mathrm{m}$$\n一个最小的足够缓冲宽度约为 $h = 490\\ \\mathrm{m}$。\n\n#### 2.4. 块的构建与分配\n\n推导出的方案是一种空间h-分块交叉验证。其步骤如下：\n1.  **分区**：研究区域被划分为不重叠的空间块。为了最小化在缓冲区中丢弃的数据比例，这些块应相对于相关长度 $\\lambda$ 和缓冲区 $h$ 而言较大。边长至少为 $3\\lambda$ 是一个合理的启发式规则。\n2.  **折分配**：这些块被分配到 K 个折中。对于给定的折 k，测试集由分配给折 k 的块内的所有像素组成。\n3.  **训练集定义**：折 k 的训练集包括所有来自未分配给折 k 的块、*并且*距离折 k 中任何测试块至少为 h 的像素。缓冲区内的像素在该折中既不用于训练也不用于测试。\n4.  **时间数据处理**：模型使用一个12个月的时间序列。空间分区不能破坏这些时间序列。因此，对于任何给定的像素，其完整的12个月序列作为一个单元被分配到训练集、测试集或缓冲区。\n\n### 3. 选项评估\n\n**A. 执行像素级别的随机K折交叉验证，并采用类别分层抽样...**\n该方法明确忽略了空间自相关这个核心问题。它错误地声称能保持独立同分布（IID）样本并产生无偏估计。如第1节所述，这会导致乐观偏差。\n**结论：错误。**\n\n**B. 将地图划分为边长等于相关长度 $\\lambda$ 的不重叠方形测试瓦片；对于每一折，在测试瓦片外的所有像素上进行训练，不设缓冲区...**\n该方法使用空间分块，但关键是省略了缓冲区。没有缓冲区，训练像素可以与测试像素相邻，由于模型的感受野和近距离的高度空间相关性，会导致严重的信息泄露，违反了独立性假设。\n**结论：错误。**\n\n**C. 使用二维空间h-分块交叉验证：定义边长至少为 $3\\lambda$ 的方形测试块，将块分配到K个折中，对于每一折，仅在距离任何测试块至少 $h$ 米的像素上进行训练，其中 $h \\ge r + \\lambda \\ln(1/\\epsilon)$ 是根据感受野半径 $r$ 和相关函数 $\\rho(d)$ 计算得出的；在训练块和测试块中都保持完整的12个月序列...**\n该选项正确地描述了整个推导过程。它指定了使用h-分块交叉验证，为块大小提供了一个合理的条件（至少 $3\\lambda$），使用缓冲区 $h$ 正确定义了训练集，提供了从第一性原理推导出的 $h$ 的精确公式（$h \\ge r + \\lambda \\ln(1/\\epsilon)$），并正确处理了时间序列。该过程将产生近似无偏的风险估计。\n**结论：正确。**\n\n**D. 通过在整个区域内留出交替的月份并在其余月份上进行训练来执行时间分块交叉验证...**\n该方法解决的是时间自相关问题，而不是题目所述的空间自相关问题。这种方法没有进行任何空间分离，会遭受严重的信息泄露，使得误差估计高度偏差。\n**结论：错误。**\n\n**E. 使用空间分块交叉验证，块的边长至少为 $3\\lambda$，缓冲区的宽度仅等于感受野半径 $r$...**\n该方法使用了缓冲区，但缓冲区宽度设置为 $h=r$。这是不够的。宽度为 $r$ 的缓冲区仅能防止测试预测的感受野包含训练像素。它没有考虑在更长距离上仍然存在的空间相关性。当 $h=r=40\\ \\mathrm{m}$ 且 $\\lambda=150\\ \\mathrm{m}$ 时，缓冲区边缘的训练像素与块边缘的测试像素之间的相关性为 $\\rho(40) = \\exp(-40/150) \\approx 0.766$，这是非常高的。声称这足以消除偏差是错误的。\n**结论：错误。**",
            "answer": "$$\\boxed{C}$$"
        },
        {
            "introduction": "在构建并验证了一个有效的模型之后，理解其决策过程是迈向可信人工智能的关键一步。基于梯度的显著性分析是一种强大的技术，它能够揭示模型在进行预测时关注输入的哪些部分。本练习不仅要求你推导显著性图的计算方法，更重要的是通过分析激活函数饱和区间的极限情况，让你深刻理解模型内部机制如何影响其可解释性及其潜在的局限。",
            "id": "3805429",
            "problem": "一台星载多光谱成像仪获取了 $B$ 个光谱带上的逐像素反射率，其值被归一化到单位区间 $[0,1]$。考虑一个二元积雪探测器，它使用一个简化的单步循环公式来结合线性光谱投影、饱和非线性以及逻辑斯蒂读出。其设计动机源于卷积神经网络 (CNN) 的特征提取，以及随后的循环神经网络 (RNN) 的时间聚合，该聚合在最后一步简化为双曲正切状态。在给定的像素和最终的时间步，定义预激活值为 $z = \\mathbf{w}^{\\top}\\mathbf{x} + b$，隐藏状态为 $h = \\tanh(z)$，类别对数几率 (logit) 为 $y = u\\,h + c$，积雪概率为 $p(\\mathbf{x}) = \\sigma(y)$，其中 $\\mathbf{x} \\in [0,1]^B$ 是反射率向量，$\\mathbf{w} \\in \\mathbb{R}^B$ 是学习到的光谱权重向量，$b \\in \\mathbb{R}$ 是一个偏置，$u \\in \\mathbb{R}$ 和 $c \\in \\mathbb{R}$ 是读出参数，$\\tanh(\\cdot)$ 是双曲正切函数，$\\sigma(\\cdot)$ 是逻辑斯蒂 S 型函数。对于波段 $k$，基于梯度的显著性定义为 $S_k(\\mathbf{x}) = \\left|\\frac{\\partial p(\\mathbf{x})}{\\partial x_k}\\right|$。\n\n从链式法则以及 $\\tanh(\\cdot)$ 和 $\\sigma(\\cdot)$ 的定义出发，推导 $S_k(\\mathbf{x})$ 的闭式表达式，该表达式应以 $\\mathbf{x}$ 和模型参数表示。然后，考虑一个理想化的高反照率积雪情景，其中所有波段具有相同的反射率和相同的权重：设所有 $i \\in \\{1,\\dots,B\\}$ 都有 $x_i = r$，其中 $r \\in (0,1]$；设所有 $i \\in \\{1,\\dots,B\\}$ 都有 $w_i = \\beta$，其中 $\\beta > 0$；并取 $b = 0$，$u > 0$ 以及有限的 $c \\in \\mathbb{R}$。计算当 $\\beta \\to +\\infty$ 且 $r \\to 1$ 时，任意固定波段 $k$ 的显著性的极限，并将结果作为最终答案。您必须将最终答案以单个不带单位的实数形式呈现。无需进行四舍五入。",
            "solution": "首先对问题陈述进行严格的验证。\n\n**问题验证**\n\n**第 1 步：提取已知条件**\n- 逐像素反射率：$\\mathbf{x} \\in [0,1]^B$，对于 $B$ 个光谱带。\n- 模型定义：\n  - 预激活值：$z = \\mathbf{w}^{\\top}\\mathbf{x} + b$\n  - 隐藏状态：$h = \\tanh(z)$\n  - 类别对数几率 (logit)：$y = u\\,h + c$\n  - 积雪概率：$p(\\mathbf{x}) = \\sigma(y)$\n- 参数定义：$\\mathbf{w} \\in \\mathbb{R}^B$，$b \\in \\mathbb{R}$，$u \\in \\mathbb{R}$，$c \\in \\mathbb{R}$。\n- 函数定义：$\\tanh(\\cdot)$ 是双曲正切函数，$\\sigma(\\cdot)$ 是逻辑斯蒂 S 型函数。\n- 显著性定义：$S_k(\\mathbf{x}) = \\left|\\frac{\\partial p(\\mathbf{x})}{\\partial x_k}\\right|$，对于波段 $k$。\n- 任务 1：推导 $S_k(\\mathbf{x})$ 的闭式表达式。\n- 任务 2：在以下条件下计算极限：\n  - 对所有 $i \\in \\{1,\\dots,B\\}$，$x_i = r$，其中 $r \\in (0,1]$。\n  - 对所有 $i \\in \\{1,\\dots,B\\}$，$w_i = \\beta$，其中 $\\beta > 0$。\n  - $b = 0$。\n  - $u > 0$。\n  - $c \\in \\mathbb{R}$ (有限)。\n- 需要计算的极限是 $\\lim_{\\beta \\to +\\infty, r \\to 1} S_k(\\mathbf{x})$。\n\n**第 2 步：使用提取的已知条件进行验证**\n根据验证标准对问题进行评估。\n- **科学上成立**：该问题基础扎实。它描述了一个用于标准遥感任务（积雪探测）的简化但结构上有效的神经网络模型。其数学组件（线性层、$\\tanh$ 和 $\\sigma$ 激活函数）和分析技术（基于梯度的显著性）都是机器学习中的基本概念。\n- **适定性**：该问题是适定的。它要求先进行推导，再进行极限计算，这二者都是标准的数学过程。所涉及的函数是可微的，极限的定义也明确无误。预期会有一个唯一且有意义的解。\n- **客观性**：该问题以精确、客观的数学语言陈述，没有歧义或主观断言。\n- **缺陷清单**：该问题未违反任何指定的缺陷。它在科学上是合理的，可形式化且相关的，完整且一致，提出了一个貌似可信的理想化模型，结构良好，非平凡，并且可通过数学验证。\n\n**第 3 步：结论与行动**\n该问题被判定为**有效**。现在开始求解过程。\n\n**求解推导**\n\n按照要求，求解过程分为两部分：首先，推导显著性表达式；其次，在指定条件下计算其极限。\n\n**第 1 部分：显著性表达式的推导**\n\n积雪概率 $p(\\mathbf{x})$ 是输入反射率向量 $\\mathbf{x}$ 的一个复合函数。我们可以将这种复合关系表示为 $p(y(h(z(\\mathbf{x})))))$。为了求出 $p$ 关于单个输入分量 $x_k$ 的偏导数，我们应用链式法则：\n$$\n\\frac{\\partial p}{\\partial x_k} = \\frac{dp}{dy} \\cdot \\frac{\\partial y}{\\partial h} \\cdot \\frac{dh}{dz} \\cdot \\frac{\\partial z}{\\partial x_k}\n$$\n我们逐项计算每个导数：\n1.  逻辑斯蒂 S 型函数 $\\sigma(y) = (1 + \\exp(-y))^{-1}$ 的导数是 $\\sigma'(y) = \\sigma(y)(1-\\sigma(y))$。由于 $p=\\sigma(y)$，我们有：\n    $$\n    \\frac{dp}{dy} = p(1-p)\n    $$\n2.  类别对数几率 $y = u\\,h + c$ 关于隐藏状态 $h$ 的导数是：\n    $$\n    \\frac{\\partial y}{\\partial h} = u\n    $$\n3.  双曲正切函数 $h = \\tanh(z)$ 的导数是 $\\tanh'(z) = 1 - \\tanh^2(z)$。由于 $h = \\tanh(z)$，我们有：\n    $$\n    \\frac{dh}{dz} = 1 - h^2\n    $$\n4.  预激活值 $z = \\mathbf{w}^{\\top}\\mathbf{x} + b = \\sum_{j=1}^{B} w_j x_j + b$ 关于输入向量的第 $k$ 个分量 $x_k$ 的导数是：\n    $$\n    \\frac{\\partial z}{\\partial x_k} = w_k\n    $$\n综合这些项，我们得到偏导数的表达式：\n$$\n\\frac{\\partial p(\\mathbf{x})}{\\partial x_k} = p(1-p) \\cdot u \\cdot (1-h^2) \\cdot w_k = u w_k (1-h^2) p (1-p)\n$$\n显著性 $S_k(\\mathbf{x})$ 定义为该导数的绝对值：\n$$\nS_k(\\mathbf{x}) = \\left| u w_k (1-h^2) p (1-p) \\right|\n$$\n项 $p = \\sigma(y)$ 的值总是在区间 $(0,1)$ 内，所以 $p(1-p) > 0$。项 $h=\\tanh(z)$ 的值总是在区间 $(-1,1)$ 内，所以 $1-h^2 > 0$。因此，符号仅由 $u$ 和 $w_k$ 决定，表达式可简化为：\n$$\nS_k(\\mathbf{x}) = |u| |w_k| (1 - \\tanh^2(z)) \\sigma(y) (1-\\sigma(y))\n$$\n其中 $z=\\mathbf{w}^{\\top}\\mathbf{x}+b$ 且 $y=u \\tanh(z)+c$。这就是所要求的闭式表达式。\n\n**第 2 部分：极限的计算**\n\n现在我们在指定条件下计算 $S_k(\\mathbf{x})$ 的极限：对所有 $i$ 有 $x_i = r$，对所有 $i$ 有 $w_i = \\beta$，$b=0$，$u>0$ 且 $\\beta>0$。\n首先，我们将这些条件代入中间变量和显著性表达式。\n预激活值 $z$ 变为：\n$$\nz = \\mathbf{w}^{\\top}\\mathbf{x} + b = \\sum_{i=1}^{B} (\\beta)(r) + 0 = B \\beta r\n$$\n使用 $|u|=u$ 和 $|w_k|=|\\beta|=\\beta$ 后，显著性表达式变为：\n$$\nS_k = u \\beta (1 - \\tanh^2(B \\beta r)) \\sigma(u \\tanh(B \\beta r) + c) (1 - \\sigma(u \\tanh(B \\beta r) + c))\n$$\n我们需要求解当 $\\beta \\to +\\infty$ 且 $r \\to 1$ 时 $S_k$ 的极限。\n设 $L = \\lim_{\\beta \\to +\\infty, r \\to 1} S_k$。\n我们分析表达式中各项在趋近极限时的行为。函数的自变量 $z = B \\beta r$ 趋向于无穷大：\n$$\n\\lim_{\\beta \\to +\\infty, r \\to 1} (B \\beta r) = +\\infty\n$$\n双曲正切项趋向于 $1$：\n$$\n\\lim_{\\beta \\to +\\infty, r \\to 1} \\tanh(B \\beta r) = \\lim_{z \\to +\\infty} \\tanh(z) = 1\n$$\nS 型函数的自变量 $y = u \\tanh(B \\beta r) + c$ 趋向于 $u+c$：\n$$\n\\lim_{\\beta \\to +\\infty, r \\to 1} y = u(1) + c = u+c\n$$\n由于 $u$ 和 $c$ 是有限的，$u+c$ 也是一个有限值。相应的 S 型函数项收敛到一个有限常数：\n$$\n\\lim_{\\beta \\to +\\infty, r \\to 1} \\sigma(y)(1-\\sigma(y)) = \\sigma(u+c)(1-\\sigma(u+c))\n$$\n设此常数为 $C = \\sigma(u+c)(1-\\sigma(u+c))$。现在极限 $L$ 可以写为：\n$$\nL = u \\cdot C \\cdot \\lim_{\\beta \\to +\\infty, r \\to 1} \\left[ \\beta(1 - \\tanh^2(B \\beta r)) \\right]\n$$\n剩下的极限是 $\\infty \\cdot 0$ 类型的不定式。我们使用恒等式 $1 - \\tanh^2(z) = \\text{sech}^2(z)$：\n$$\n\\lim_{\\beta \\to +\\infty, r \\to 1} \\beta \\, \\text{sech}^2(B \\beta r)\n$$\n使用定义 $\\text{sech}(z) = \\frac{2}{\\exp(z) + \\exp(-z)}$，极限内的表达式为：\n$$\n\\beta \\left( \\frac{2}{\\exp(B \\beta r) + \\exp(-B \\beta r)} \\right)^2 = \\frac{4\\beta}{(\\exp(B \\beta r) + \\exp(-B \\beta r))^2}\n$$\n当 $\\beta \\to +\\infty$ 且 $r \\to 1$ 时，自变量 $B \\beta r \\to +\\infty$。分母的增长与 $(\\exp(B \\beta r))^2 = \\exp(2 B \\beta r)$ 成正比，这是 $\\beta$ 的指数函数。分子的增长与 $\\beta$ 成正比，这是 $\\beta$ 的线性函数。分母的指数增长主导了分子的线性增长。\n为了形式化地证明这一点，我们可以应用 L'Hôpital's rule。我们固定 $r=1$ 并考虑 $\\beta \\to \\infty$ 时的极限：\n$$\n\\lim_{\\beta \\to \\infty} \\frac{4\\beta}{(\\exp(B \\beta) + \\exp(-B \\beta))^2}\n$$\n这是 $\\frac{\\infty}{\\infty}$ 的形式。对分子和分母分别关于 $\\beta$ 求导：\n_分子导数_：$\\frac{d}{d\\beta}(4\\beta) = 4$。\n_分母导数_：$\\frac{d}{d\\beta}(\\exp(B \\beta) + \\exp(-B \\beta))^2 = 2(\\exp(B \\beta) + \\exp(-B \\beta)) \\cdot (B\\exp(B \\beta) - B\\exp(-2B\\beta))$。\n导数之比的极限是：\n$$\n\\lim_{\\beta \\to \\infty} \\frac{4}{2B(\\exp(B \\beta) + \\exp(-B \\beta))(\\exp(B \\beta) - \\exp(-B \\beta))} = \\lim_{\\beta \\to \\infty} \\frac{2}{B(\\exp(2B\\beta) - \\exp(-2B\\beta))}\n$$\n当 $\\beta \\to \\infty$ 时，分母趋向于 $+\\infty$，所以极限为 $0$。\n该结果对任何 $\\beta r \\to \\infty$ 的路径都成立，对于 $\\beta \\to +\\infty, r \\to 1$ 的同时极限情况也是如此。\n因此，不定式部分的极限为 $0$：\n$$\n\\lim_{\\beta \\to +\\infty, r \\to 1} \\left[ \\beta(1 - \\tanh^2(B \\beta r)) \\right] = 0\n$$\n将此结果代回到总极限 $L$ 的表达式中：\n$$\nL = u \\cdot C \\cdot 0 = 0\n$$\n在给定条件下，显著性的极限为 $0$。",
            "answer": "$$\\boxed{0}$$"
        }
    ]
}