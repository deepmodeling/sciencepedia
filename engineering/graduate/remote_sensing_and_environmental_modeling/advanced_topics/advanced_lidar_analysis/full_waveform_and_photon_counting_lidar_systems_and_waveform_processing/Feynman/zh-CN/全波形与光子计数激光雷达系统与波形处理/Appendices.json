{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您探索全波形激光雷达（LiDAR）系统的核心工作原理之一：模拟信号的数字化过程。通过从基本物理原理出发，您将亲手推导并计算系统的距离分辨率，这直接关系到系统区分目标细节的能力。此项实践旨在建立起数字化仪采样率与最终数据产品中可分辨的最小距离（即距离分辨率）之间的直观联系，并探讨其在数据存储和处理方面的权衡考量。",
            "id": "3813872",
            "problem": "一个机载激光雷达（LiDAR）系统记录来自森林冠层的全波形回波。其数字化仪以速率 $f_s$ 对反向散射的模拟信号进行均匀采样，并以固定的比特深度存储每个样本。系统参数如下：\n- 采样率 $f_s = 2.5\\,\\mathrm{GHz}$，\n- 每次激光发射的记录时长 $T = 20\\,\\mu\\mathrm{s}$，\n- 每个样本的比特深度 $b = 12\\,\\mathrm{bits}$，\n- 光速 $c = 2.99792458 \\times 10^{8}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n\n从传播时间与距离之间的双程飞行时间关系以及均匀采样的定义出发，推导此全波形数字化的距离库（range-bin）大小，并计算其数值。将最终的距离库大小以厘米表示，并将答案四舍五入到四位有效数字。\n\n此外，从第一性原理出发，分析在固定波形持续时间 $T$ 的情况下，提高采样率 $f_s$ 与由此产生的内存占用之间的权衡。您的分析应涵盖样本数量、总存储比特数和记录时长如何影响存储需求，并应将这些考量与光子计数激光雷达进行对比，后者是对单个光子探测事件进行时间戳记录，而不是对模拟波形进行均匀采样。不需要对内存进行数值评估；仅提供符号评估和定性讨论。",
            "solution": "该问题陈述被评估为有效。它在科学上基于遥感和数字信号处理的原理，问题提出得很好，有足够的信息得到唯一解，并以客观、精确的语言表达。所有参数在物理上都是现实的。该问题需要一个标准的推导、一个数值计算和一个概念分析，所有这些都适合该领域。\n\n根据要求，该问题分两部分解决：首先，推导和计算距离库大小；其次，对存储权衡进行定性分析。\n\n**第一部分：距离库大小的推导与计算**\n\nLiDAR的基本原理是测量光脉冲的飞行时间。光从传感器传播到目标再返回传感器的总距离 $d$ 由光速 $c$ 和双程传播时间 $\\Delta t$ 的乘积给出。\n$$d = c \\Delta t$$\n到目标的距离 $R$ 是这个总距离的一半，因为它代表了单程路径。\n$$R = \\frac{d}{2} = \\frac{c \\Delta t}{2}$$\n这就是双程飞行时间关系。\n\n全波形LiDAR系统的数字化仪以均匀的采样率 $f_s$ 对反向散射的模拟信号进行采样。任意两个连续样本之间的时间间隔是采样周期 $\\Delta t_s$，它是采样频率的倒数：\n$$\\Delta t_s = \\frac{1}{f_s}$$\n这个采样周期 $\\Delta t_s$ 代表了数字化波形中可以分辨的最小时间特征。因此，它决定了可能的最精细的距离分辨率，称为距离库大小 $\\Delta R$。距离库大小是对应于连续样本之间时间间隔 $\\Delta t_s$ 的距离变化量 $\\Delta R$。\n\n通过在距离方程中用 $\\Delta t_s$ 替代 $\\Delta t$，我们可以推导出距离库大小的表达式：\n$$\\Delta R = \\frac{c \\Delta t_s}{2}$$\n将 $\\Delta t_s$ 关于 $f_s$ 的表达式代入，我们得到距离库大小的最终公式：\n$$\\Delta R = \\frac{c}{2 f_s}$$\n现在，我们使用给定的参数计算 $\\Delta R$ 的数值：\n- 光速 $c = 2.99792458 \\times 10^{8}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 采样率 $f_s = 2.5\\,\\mathrm{GHz} = 2.5 \\times 10^{9}\\,\\mathrm{s}^{-1}$\n\n将这些值代入推导出的方程：\n$$\\Delta R = \\frac{2.99792458 \\times 10^{8}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{2 \\times (2.5 \\times 10^{9}\\,\\mathrm{s}^{-1})} = \\frac{2.99792458 \\times 10^{8}}{5.0 \\times 10^{9}}\\,\\mathrm{m}$$\n$$\\Delta R = 0.0599584916\\,\\mathrm{m}$$\n问题要求答案以厘米表示。我们使用换算关系 $1\\,\\mathrm{m} = 100\\,\\mathrm{cm}$：\n$$\\Delta R = 0.0599584916 \\times 100\\,\\mathrm{cm} = 5.99584916\\,\\mathrm{cm}$$\n最后，我们将结果四舍五入到四位有效数字：\n$$\\Delta R \\approx 5.996\\,\\mathrm{cm}$$\n\n**第二部分：存储权衡分析**\n\n本节分析了全波形系统中与采样率相关的权衡，并将其与光子计数系统进行对比。\n\n对于全波形激光雷达（FWL）系统，单次激光发射的数据存储需求是确定性的。对于固定的记录时长 $T$ 和采样率 $f_s$，总样本数 $N_{\\text{samples}}$ 由下式给出：\n$$N_{\\text{samples}} = f_s \\times T$$\n每个样本以 $b$ 比特的比特深度进行量化。因此，每个波形的总内存占用 $M_{\\text{FWL}}$ 为：\n$$M_{\\text{FWL}} = N_{\\text{samples}} \\times b = f_s \\times T \\times b$$\n从这个关系中，保持时长 $T$ 不变而提高采样率 $f_s$ 的权衡是显而易见的。内存占用 $M_{\\text{FWL}}$ 与 $f_s$ 成正比。增加 $f_s$ 会产生更小的距离库大小 $\\Delta R = c/(2f_s)$，这提高了纵向分辨率和区分近距离物体的能力。然而，这种分辨率的提升是以数据量、内存需求以及随之而来的数据传输和处理开销的线性增加为直接代价的。对于每一次激光发射，无论是否返回有意义的信号，系统都必须存储一个庞大而密集的样本值数组。\n\n相比之下，光子计数激光雷达（PCL）系统的工作原理不同。它不记录连续的波形，而是探测离散的光子到达事件，并以高精度记录其时间戳。因此，每次发射的数据量不是固定的。设 $N_{\\text{photons}}$ 为单次激光发射在观测窗口内探测到的光子数，设 $b_{\\text{ts}}$ 为存储单个时间戳所需的比特数。PCL系统的内存占用 $M_{\\text{PCL}}$ 近似为：\n$$M_{\\text{PCL}} \\approx N_{\\text{photons}} \\times b_{\\text{ts}}$$\n关键区别在于，$N_{\\text{photons}}$ 不是一个固定的系统参数；它是一个随机变量，取决于信号强度，而信号强度又是目标反射率、距离、大气衰减和背景光照的函数。\n\n这导致了存储考量上的以下对比：\n1.  **数据结构：** FWL生成密集的、规则结构的数据。PCL生成稀疏的、事件驱动的数据。\n2.  **对信号的依赖性：** FWL的存储需求与返回信号强度无关。即使波形只包含噪声，也会被完整存储。PCL的存储需求与探测到的光子数量成正比。在低信号或稀疏回波环境（例如，水面、暗目标、高海拔）中，PCL的数据效率极高。\n3.  **分辨率的影响：** 在FWL中，提高距离分辨率需要更高的 $f_s$，这会统一增加所有采集的数据量。在PCL中，提高时间分辨率意味着使用更精确的时间标记单元（实际上是增加 $b_{\\text{ts}}$ 或底层的时钟频率），这会增加每个探测到的光子的数据大小，但总数据量仍然取决于 $N_{\\text{photons}}$。\n4.  **系统局限性：** FWL通过记录高幅度信号来平稳地处理高功率回波。PCL系统在高信号或高背景噪声条件下可能会出现探测器饱和，此时入射光子的速率超过了探测器分辨单个事件的能力。在这种情况下，记录的事件数量可能不能代表真实信号，并且数据量可能会变得很大。\n\n总之，FWL的权衡是距离分辨率和数据量之间的直接成本关系。PCL的权衡更为复杂，涉及单光子灵敏度、稀疏条件下的数据效率以及高信号条件下对饱和的敏感性之间的平衡。系统之间的选择根本上取决于应用和预期的信号环境。",
            "answer": "$$\n\\boxed{5.996}\n$$"
        },
        {
            "introduction": "在了解了系统的基本分辨率后，下一个关键问题是：我们能够以多高的精度确定目标的距离？本练习将带您深入探讨测距精度的理论极限，即克拉美-罗下界（CRLB）。通过推导CRLB，您将理解信噪比（$SNR$）和激光脉冲宽度等关键参数如何从根本上决定了任何测距算法所能达到的最佳性能，这为评估和优化LiDAR系统性能提供了坚实的理论基础。",
            "id": "3813803",
            "problem": "一个激光雷达（LiDAR）接收器观测到一个被加性高斯白噪声（AWGN）破坏的时间平移脉冲。接收到的波形模型为 $y(t) = s(t - \\tau) + n(t)$，其中 $s(t)$ 是一个已知的确定性模板，$\\tau$ 是待估计的未知到达时间参数，而 $n(t)$ 是零均值加性高斯白噪声，其双边功率谱密度为 $N_0/2$。假设发射的脉冲在时间上是高斯脉冲，$s(t) = A \\exp\\!\\big(-t^2/(2\\sigma^2)\\big)$，其振幅 $A$ 和时间标准差 $\\sigma$ 均为已知。脉冲的能量为 $E_s = \\int_{-\\infty}^{\\infty} s^2(t)\\,dt$，信噪比定义为 $\\mathrm{SNR} = E_s/N_0$。高斯脉冲的半峰全宽为 $T_{\\mathrm{FWHM}} = 2\\sqrt{2\\ln 2}\\,\\sigma$。\n\n从参数族 $p(y|\\tau)$ 的 Fisher 信息定义和任意无偏估计量 $\\hat{\\tau}$ 的 Cramér–Rao 下界 (CRLB) 出发，推导在此加性高斯白噪声中，对该 LiDAR 波形进行无偏到达时间估计的方差的 CRLB。将最终的界表示为 $\\mathrm{SNR}$ 和 $T_{\\mathrm{FWHM}}$ 的闭合形式函数。以平方秒为单位提供最终的界。无需中间或数值近似，答案应为单一的解析表达式。",
            "solution": "问题要求推导在加性高斯白噪声（AWGN）中，对高斯脉冲的到达时间参数 $\\tau$ 的任意无偏估计量的方差的 Cramér–Rao 下界（CRLB）。最终结果必须表示为信噪比（$\\mathrm{SNR}$）和脉冲半峰全宽（$T_{\\mathrm{FWHM}}$）的函数。\n\n接收到的波形由以下模型给出：\n$$y(t) = s(t - \\tau) + n(t)$$\n其中 $s(t)$ 是确定性信号模板，$\\tau$ 是未知的到达时间，而 $n(t)$ 是一个零均值高斯白噪声过程，其常数双边功率谱密度为 $\\frac{N_0}{2}$。\n\n对于参数 $\\tau$ 的任意无偏估计量 $\\hat{\\tau}$，CRLB 指出其方差的下界是 Fisher 信息 $I(\\tau)$ 的倒数：\n$$\\mathrm{var}(\\hat{\\tau}) \\ge \\frac{1}{I(\\tau)}$$\n对于给定的加性高斯白噪声中的信号模型，时间延迟参数 $\\tau$ 的 Fisher 信息由以下公式给出：\n$$I(\\tau) = \\frac{2}{N_0} \\int_{-\\infty}^{\\infty} \\left[ \\frac{\\partial s(t - \\tau)}{\\partial \\tau} \\right]^2 dt$$\n信号模板是一个高斯脉冲：\n$$s(t) = A \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right)$$\n首先，我们计算时间平移信号 $s(t - \\tau)$ 对 $\\tau$ 的偏导数。令 $u = t - \\tau$，则 $\\frac{\\partial u}{\\partial \\tau} = -1$。\n$$\\frac{\\partial s(t - \\tau)}{\\partial \\tau} = \\frac{d}{d(t-\\tau)} \\left[ A \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right) \\right] \\cdot \\frac{\\partial(t-\\tau)}{\\partial \\tau}$$\n$$\\frac{\\partial s(t - \\tau)}{\\partial \\tau} = \\left[ A \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right) \\cdot \\left(-\\frac{2(t-\\tau)}{2\\sigma^2}\\right) \\right] \\cdot (-1)$$\n$$\\frac{\\partial s(t - \\tau)}{\\partial \\tau} = A \\frac{(t-\\tau)}{\\sigma^2} \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right)$$\n这可以被识别为 $-s'(t-\\tau)$，其中 $s'(t)$ 是 $s(t)$ 对其自变量 $t$ 的导数。Fisher 信息积分变为：\n$$I(\\tau) = \\frac{2}{N_0} \\int_{-\\infty}^{\\infty} \\left[ A \\frac{(t-\\tau)}{\\sigma^2} \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right) \\right]^2 dt$$\n由于积分是在从 $-\\infty$ 到 $\\infty$ 的整个时间范围内进行的，积分的值与平移量 $\\tau$ 无关。我们可以通过设置 $\\tau=0$ 来简化计算：\n$$I(\\tau) = I = \\frac{2}{N_0} \\int_{-\\infty}^{\\infty} \\left[ A \\frac{t}{\\sigma^2} \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right) \\right]^2 dt$$\n$$I = \\frac{2A^2}{N_0 \\sigma^4} \\int_{-\\infty}^{\\infty} t^2 \\exp\\left(-\\frac{t^2}{\\sigma^2}\\right) dt$$\n这是一个标准的高斯积分，形式为 $\\int_{-\\infty}^{\\infty} x^{2n} \\exp(-ax^2) dx = \\frac{(2n-1)!!}{2^n a^n} \\sqrt{\\frac{\\pi}{a}}$。在我们的例子中，$n=1$ 且 $a = \\frac{1}{\\sigma^2}$。\n该积分的计算结果为：\n$$\\int_{-\\infty}^{\\infty} t^2 \\exp\\left(-\\frac{t^2}{\\sigma^2}\\right) dt = \\frac{1}{2(1/\\sigma^2)} \\sqrt{\\frac{\\pi}{1/\\sigma^2}} = \\frac{\\sigma^2}{2} \\sqrt{\\pi\\sigma^2} = \\frac{\\sigma^3\\sqrt{\\pi}}{2}$$\n将此结果代入 $I$ 的表达式中：\n$$I = \\frac{2A^2}{N_0 \\sigma^4} \\left( \\frac{\\sigma^3\\sqrt{\\pi}}{2} \\right) = \\frac{A^2 \\sqrt{\\pi}}{N_0 \\sigma}$$\n为了用信号能量 $E_s$ 和信噪比 SNR 来表示它，我们首先计算 $E_s$：\n$$E_s = \\int_{-\\infty}^{\\infty} s^2(t) dt = \\int_{-\\infty}^{\\infty} \\left[ A \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right) \\right]^2 dt = A^2 \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{t^2}{\\sigma^2}\\right) dt$$\n这是另一个标准的高斯积分，$\\int_{-\\infty}^{\\infty} \\exp(-ax^2) dx = \\sqrt{\\frac{\\pi}{a}}$。当 $a=\\frac{1}{\\sigma^2}$ 时，积分为 $\\sqrt{\\pi\\sigma^2} = \\sigma\\sqrt{\\pi}$。\n因此，信号能量为：\n$$E_s = A^2 \\sigma \\sqrt{\\pi}$$\n我们可以重新整理这个表达式，得到 $A^2\\sqrt{\\pi} = \\frac{E_s}{\\sigma}$。将此代入我们的 Fisher 信息 $I$ 的表达式中：\n$$I = \\frac{1}{N_0 \\sigma} (A^2 \\sqrt{\\pi}) = \\frac{1}{N_0 \\sigma} \\left( \\frac{E_s}{\\sigma} \\right) = \\frac{E_s}{N_0 \\sigma^2}$$\nCRLB 是 Fisher 信息的倒数：\n$$\\mathrm{CRLB}(\\tau) = \\frac{1}{I} = \\frac{N_0 \\sigma^2}{E_s}$$\n问题将信噪比定义为 $\\mathrm{SNR} = \\frac{E_s}{N_0}$。代入此定义：\n$$\\mathrm{CRLB}(\\tau) = \\frac{\\sigma^2}{E_s/N_0} = \\frac{\\sigma^2}{\\mathrm{SNR}}$$\n最后，我们必须用 $T_{\\mathrm{FWHM}}$ 而不是 $\\sigma$ 来表示结果。它们之间的关系如下：\n$$T_{\\mathrm{FWHM}} = 2\\sqrt{2\\ln 2}\\,\\sigma$$\n求解 $\\sigma^2$：\n$$\\sigma^2 = \\left( \\frac{T_{\\mathrm{FWHM}}}{2\\sqrt{2\\ln 2}} \\right)^2 = \\frac{T_{\\mathrm{FWHM}}^2}{4(2\\ln 2)} = \\frac{T_{\\mathrm{FWHM}}^2}{8\\ln 2}$$\n将 $\\sigma^2$ 的这个表达式代入 CRLB 公式，得到最终答案：\n$$\\mathrm{CRLB}(\\tau) = \\frac{1}{\\mathrm{SNR}} \\left( \\frac{T_{\\mathrm{FWHM}}^2}{8\\ln 2} \\right) = \\frac{T_{\\mathrm{FWHM}}^2}{8 (\\ln 2) (\\mathrm{SNR})}$$\n此结果代表了对脉冲到达时间的任何无偏估计量的最小可能方差，单位为平方秒。",
            "answer": "$$\\boxed{\\frac{T_{\\mathrm{FWHM}}^2}{8 (\\ln 2) (\\mathrm{SNR})}}$$"
        },
        {
            "introduction": "实际的测量系统并非完美，其数据往往会受到各种物理效应的干扰。本练习将聚焦于光子计数LiDAR系统中的一个典型挑战——“堆积效应”（pile-up effect），它会导致对早期到达光子的探测偏好，从而引入测量偏差。您将学习如何从统计学角度为这种系统性偏差建模，并推导一种逆概率加权（IPW）校正算法来恢复真实的信号波形，这代表了从理想化模型迈向真实数据处理的重要一步。",
            "id": "3813801",
            "problem": "一个采用单光子雪崩二极管（SPAD）的时间相关单光子计数（TCSPC）激光雷达（LiDAR）系统，在持续时间为 $T$ 的重复门控内运行。该门控被划分为 $M$ 个宽度为 $\\Delta$ 的相等时间仓，使得 $M \\Delta = T$。在每个门控内，来自场景的光子（包括信号和背景）的到达过程可以很好地用一个瞬时率为 $r(t)$（对于 $t \\in [0,T]$）的非齐次泊松过程来建模。由于探测器死时间和计时电子设备的限制，系统在每个门控中最多只记录第一个被探测到的光子（首光子堆积效应）。经过多个门控，系统形成一个首光子到达时间的直方图。假设有 $N$ 个门控产生了至少一次探测，并令 $H_i$ 表示落在时间仓 $i$（其区间为 $[t_i, t_i+\\Delta)$，其中 $t_i = i \\Delta$，对于 $i = 0,1,\\dots,M-1$）内的已记录首光子时间的数量。定义经验性单位时间仓比例 $\\hat{p}_i = H_i/N$ 和经验性生存（尾部）比例 $\\hat{q}_i = \\sum_{k=i}^{M-1} H_k/N$。\n\n从非齐次泊松过程的定义性质出发，即到时间 $t$ 为止没有光子到达的概率为 $\\exp\\!\\left(-\\int_{0}^{t} r(u)\\,du\\right)$，且首次到达时间密度是风险率 $r(t)$ 乘以生存函数值，推导条件首光子时间分布 $f_{\\text{cond}}(t)$（以在 $[0,T]$ 内发生至少一次到达为条件）与潜在率 $r(t)$ 之间的关系。利用此关系构建一个逆概率加权（IPW）校正，通过除以适当的生存概率，来消除在时间仓 $i$ 处对 $r(t)$ 的基于直方图的朴素估计量的偏差。然后，将这 $N$ 个有探测的门控视为来自 $f_{\\text{cond}}(t)$ 的独立样本，通过一阶delta方法量化IPW估计量在时间仓 $i$ 处的大样本方差，并将结果用 $r(t_i)$、时间仓宽度 $\\Delta$、真实条件生存概率 $q_i = S_{\\text{cond}}(t_i)$ 和 $N$ 来表示。\n\n为保持推导的自洽性和科学一致性，您可以假设以下内容：\n- 无条件首次到达时间密度为 $f_{\\text{first}}(t) = r(t)\\,\\exp\\!\\left(-\\int_{0}^{t} r(u)\\,du\\right)$。\n- 在 $[0,T]$ 内至少有一次到达的条件下，可得 $f_{\\text{cond}}(t) = f_{\\text{first}}(t) / \\left(1 - \\exp\\!\\left(-\\int_{0}^{T} r(u)\\,du\\right)\\right)$，对于 $t \\in [0,T]$。\n- 条件生存函数 $S_{\\text{cond}}(t)$ 是在 $[0,T]$ 内至少有一次到达的条件下，首光子时间大于或等于 $t$ 的概率。\n\n请使用 $\\hat{p}_i$ 和 $\\hat{q}_i$ 定义您在时间仓 $i$ 处的IPW估计量，将所有常数保持为符号形式，并推导该估计量在 $1/N$ 的主导阶上有效的渐近方差的闭式解析表达式。为确保一致性，请将所有速率以 $\\mathrm{s}^{-1}$ 为单位，所有时间以 $\\mathrm{s}$ 为单位表示。最终答案必须是单一的闭式解析表达式；无需进行数值计算。",
            "solution": "首先验证问题，以确保其科学上合理、定义明确且客观。\n\n### 第1步：提取已知条件\n- **系统**：带有单光子雪崩二极管（SPAD）的时间相关单光子计数（TCSPC）LiDAR。\n- **操作**：持续时间为 $T$ 的重复门控，划分为 $M$ 个宽度为 $\\Delta$ 的时间仓，其中 $M \\Delta = T$。\n- **模型**：光子到达遵循瞬时率为 $r(t)$ 的非齐次泊松过程，对于 $t \\in [0,T]$。\n- **约束**：系统每个门控最多记录第一个探测到的光子（首光子堆积效应）。\n- **数据**：从 $N$ 个有至少一次探测的门控形成直方图。\n- **变量**：\n    - $H_i$：在时间仓 $i$（$[t_i, t_i+\\Delta)$，其中 $t_i = i \\Delta$）内记录到的首光子次数。\n    - $\\hat{p}_i = H_i/N$：经验性单位时间仓比例。\n    - $\\hat{q}_i = \\sum_{k=i}^{M-1} H_k/N$：经验性生存（尾部）比例。\n- **假设/定义**：\n    - 无条件首次到达时间密度：$f_{\\text{first}}(t) = r(t)\\,\\exp\\!\\left(-\\int_{0}^{t} r(u)\\,du\\right)$。\n    - 条件首次到达时间密度（给定在 $[0,T]$ 内有 $\\ge 1$ 次到达）：$f_{\\text{cond}}(t) = f_{\\text{first}}(t) / \\left(1 - \\exp\\!\\left(-\\int_{0}^{T} r(u)\\,du\\right)\\right)$，对于 $t \\in [0,T]$。\n    - 条件生存函数：$S_{\\text{cond}}(t) = P(\\text{首光子时间} \\ge t \\mid \\text{在 } [0,T] \\text{ 内有 } \\ge 1 \\text{ 次到达})$。\n- **任务**：\n    1. 推导 $f_{\\text{cond}}(t)$ 与 $r(t)$ 之间的关系。\n    2. 通过对朴素直方图估计进行偏差校正，构建 $r(t_i)$ 的逆概率加权（IPW）估计量。\n    3. 使用一阶delta方法量化该估计量在时间仓 $i$ 处的大样本方差。\n    4. 用 $r(t_i)$、$\\Delta$、真实条件生存概率 $q_i$ 和 $N$ 来表示该方差。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据充分**：这个问题在光子探测物理学和泊松过程统计学方面有充分的科学依据。TCSPC模型、首光子堆积效应以及用于LiDAR返回信号的非齐次泊松过程是遥感领域中标准且科学上正确的表示方法。\n- **定义明确**：该问题为推导估计量及其方差的唯一解析表达式提供了足够的信息和明确的目标。\n- **客观**：语言精确且定量。所有术语都经过数学定义。没有主观或基于观点的陈述。\n- **完整性和一致性**：所提供的定义和假设是自洽的，并为推导构成了完整的基础。问题不包含相互矛盾的约束。\n- **真实性**：该设置是一个常见LiDAR测量场景的真实（尽管简化了）模型。\n- **结构**：问题结构逻辑清晰，要求先推导一个估计量，然后分析其统计特性。\n\n### 第3步：结论与行动\n该问题有效。将提供完整的解答推导过程。\n\n### IPW估计量的推导\n泊松过程的潜在率 $r(t)$ 是首次光子到达的瞬时风险率。也就是说，对于一个微小的时间间隔 $dt$，在 $t$ 之前没有光子到达的条件下，首个光子在 $[t, t+dt)$ 内到达的概率是 $r(t)dt$。因此，$r(t_i)$ 的估计量应该估计这个风险率。\n\n让我们考虑风险率的离散时间版本。首个光子在时间仓 $i$ 内到达的无条件概率是，在时间仓 $0, 1, \\dots, i-1$ 内没有光子到达，并且在时间仓 $i$ 内至少有一个光子到达的概率。\n令 $\\Lambda_i = \\int_{t_i}^{t_i+\\Delta} r(u)du$ 为时间仓 $i$ 内的期望光子数。在时间仓 $i$ 内至少有一次到达的概率是 $1 - \\exp(-\\Lambda_i)$。对于较小的 $\\Delta$，我们可以近似为 $\\Lambda_i \\approx r(t_i)\\Delta$。\n在 $t_i$ 之前没有到达的概率是 $\\exp(-\\int_0^{t_i} r(u)du)$。\n因此，首次到达在时间仓 $i$ 内的无条件概率是：\n$$ P_{\\text{uncond}}(i) = \\exp\\left(-\\int_0^{t_i} r(u)du\\right) \\left(1 - \\exp\\left(-\\int_{t_i}^{t_i+\\Delta} r(u)du\\right)\\right) $$\n对于较小的 $\\Delta$，这可以近似为：\n$$ P_{\\text{uncond}}(i) \\approx \\exp\\left(-\\int_0^{t_i} r(u)du\\right) \\left(r(t_i)\\Delta\\right) $$\n首次到达时间在 $t_i$ 或之后（即在时间仓 $i$ 或更晚）的无条件概率，是在 $t_i$ 之前没有到达的概率：\n$$ P_{\\text{uncond}}(\\ge i) = \\exp\\left(-\\int_0^{t_i} r(u)du\\right) $$\n时间仓 $i$ 的无条件离散风险率 $h_i$ 是在时间仓 $i$ 之前没有首次到达的条件下，首次到达发生在时间仓 $i$ 内的概率。\n$$ h_i = \\frac{P_{\\text{uncond}}(i)}{P_{\\text{uncond}}(\\ge i)} \\approx \\frac{\\exp(-\\int_0^{t_i} r(u)du) (r(t_i)\\Delta)}{\\exp(-\\int_0^{t_i} r(u)du)} = r(t_i)\\Delta $$\n这表明 $r(t_i) \\approx h_i/\\Delta$。我们的目标是从观测到的条件数据中找到 $h_i$ 的估计量。\n\n观测到的计数 $H_i$ 是来自一个条件分布的样本，其中我们已知在门控 $[0,T]$ 内至少有一个光子到达。\n令 $p_i$ 为一个记录到的首光子落在时间仓 $i$ 内的真实条件概率。那么 $\\hat{p}_i = H_i/N$ 是其经验估计量。\n令 $q_i$ 为真实条件生存概率，即一个记录到的首光子落在时间仓 $i$ 或更晚的概率。那么 $q_i = \\sum_{k=i}^{M-1} p_k$，其估计量为 $\\hat{q}_i = \\sum_{k=i}^{M-1} \\hat{p}_k$。\n条件概率 $p_i$ 通过一个归一化常数 $C = \\sum_{k=0}^{M-1} P_{\\text{uncond}}(k) = 1 - \\exp(-\\int_0^T r(u)du)$ 与无条件概率 $P_{\\text{uncond}}(k)$ 相关联。\n$$ p_i = \\frac{P_{\\text{uncond}}(i)}{C} $$\n而条件生存概率是：\n$$ q_i = \\sum_{k=i}^{M-1} p_k = \\frac{\\sum_{k=i}^{M-1} P_{\\text{uncond}}(k)}{C} = \\frac{P_{\\text{uncond}}(\\ge i)}{C} $$\n现在，我们构建这些条件概率的比率：\n$$ \\frac{p_i}{q_i} = \\frac{P_{\\text{uncond}}(i)/C}{P_{\\text{uncond}}(\\ge i)/C} = \\frac{P_{\\text{uncond}}(i)}{P_{\\text{uncond}}(\\ge i)} = h_i $$\n这是一个关键结果：条件概率质量与条件生存概率的比率等于无条件离散风险率。\n结合我们的发现，我们有 $r(t_i) \\approx h_i/\\Delta = \\frac{1}{\\Delta} \\frac{p_i}{q_i}$。这个关系启发我们通过用经验估计值 $\\hat{p}_i$ 和 $\\hat{q}_i$ 替换真实概率 $p_i$ 和 $q_i$ 来得到 $r(t_i)$ 的估计量：\n$$ \\hat{r}_i = \\frac{1}{\\Delta} \\frac{\\hat{p}_i}{\\hat{q}_i} = \\frac{1}{\\Delta} \\frac{H_i/N}{(\\sum_{k=i}^{M-1} H_k)/N} = \\frac{1}{\\Delta} \\frac{H_i}{\\sum_{k=i}^{M-1} H_k} $$\n这就是IPW估计量。时间仓 $i$ 内的计数 $H_i$ 被生存到时间仓 $i$ 的经验概率的倒数 $\\hat{q}_i$ 进行了有效加权。这校正了只有在之前没有探测到光子的情况下，光子才可能在时间仓 $i$ 被探测到的事实。\n\n### IPW估计量的方差\n我们使用一阶delta方法来求 $\\hat{r}_i = g(\\hat{p}_i, \\hat{q}_i) = \\frac{1}{\\Delta}\\frac{\\hat{p}_i}{\\hat{q}_i}$ 的大样本方差。\n令随机变量向量为 $\\mathbf{v} = [\\hat{p}_i, \\hat{q}_i]^T$。$g(\\mathbf{v})$ 的方差近似为：\n$$ \\text{Var}(\\hat{r}_i) \\approx \\nabla g^T \\Sigma_{\\mathbf{v}} \\nabla g $$\n其中 $\\nabla g$ 是 $g$ 的梯度，$\\Sigma_{\\mathbf{v}}$ 是 $\\mathbf{v}$ 的协方差矩阵，两者都在真值 $\\mathbf{v}_{\\text{true}}=[p_i, q_i]^T$ 处求值。\n\n首先，我们计算 $g(x,y) = \\frac{1}{\\Delta} \\frac{x}{y}$ 的偏导数：\n$$ \\frac{\\partial g}{\\partial x} = \\frac{1}{\\Delta y} \\implies \\left. \\frac{\\partial g}{\\partial \\hat{p}_i} \\right|_{p_i, q_i} = \\frac{1}{\\Delta q_i} $$\n$$ \\frac{\\partial g}{\\partial y} = -\\frac{x}{\\Delta y^2} \\implies \\left. \\frac{\\partial g}{\\partial \\hat{q}_i} \\right|_{p_i, q_i} = -\\frac{p_i}{\\Delta q_i^2} $$\n接下来，我们计算协方差矩阵 $\\Sigma_{\\mathbf{v}}$ 的元素。计数 $(H_0, \\dots, H_{M-1})$ 服从多项分布 Multinomial$(N, p_0, \\dots, p_{M-1})$。比例 $\\hat{p}_j = H_j/N$ 的方差和协方差为：\n$$ \\text{Var}(\\hat{p}_j) = \\frac{p_j(1-p_j)}{N}, \\quad \\text{Cov}(\\hat{p}_j, \\hat{p}_k) = -\\frac{p_j p_k}{N} \\text{ for } j \\neq k $$\n$\\hat{q}_i = \\sum_{k=i}^{M-1} \\hat{p}_k$ 的方差是一个二项比例的方差，因为 $N$ 次试验中的每一次要么落在时间仓集合 $\\{i, \\dots, M-1\\}$ 内（概率为 $q_i$），要么不落在其中。\n$$ \\text{Var}(\\hat{q}_i) = \\frac{q_i(1-q_i)}{N} $$\n$\\hat{p}_i$ 和 $\\hat{q}_i$ 之间的协方差是：\n$$ \\text{Cov}(\\hat{p}_i, \\hat{q}_i) = \\text{Cov}\\left(\\hat{p}_i, \\hat{p}_i + \\sum_{k=i+1}^{M-1}\\hat{p}_k\\right) = \\text{Var}(\\hat{p}_i) + \\sum_{k=i+1}^{M-1}\\text{Cov}(\\hat{p}_i, \\hat{p}_k) $$\n$$ = \\frac{p_i(1-p_i)}{N} + \\sum_{k=i+1}^{M-1}\\left(-\\frac{p_i p_k}{N}\\right) = \\frac{p_i}{N} - \\frac{p_i^2}{N} - \\frac{p_i}{N}\\sum_{k=i+1}^{M-1}p_k $$\n$$ = \\frac{p_i}{N} - \\frac{p_i}{N}\\left(p_i + \\sum_{k=i+1}^{M-1}p_k\\right) = \\frac{p_i}{N} - \\frac{p_i q_i}{N} = \\frac{p_i(1-q_i)}{N} $$\n现在我们使用delta方法关于两个相关变量的函数的公式来组装方差：\n$$ \\text{Var}(\\hat{r}_i) \\approx \\left(\\frac{\\partial g}{\\partial \\hat{p}_i}\\right)^2 \\text{Var}(\\hat{p}_i) + \\left(\\frac{\\partial g}{\\partial \\hat{q}_i}\\right)^2 \\text{Var}(\\hat{q}_i) + 2\\left(\\frac{\\partial g}{\\partial \\hat{p}_i}\\right)\\left(\\frac{\\partial g}{\\partial \\hat{q}_i}\\right)\\text{Cov}(\\hat{p}_i, \\hat{q}_i) $$\n代入各项：\n$$ \\text{Var}(\\hat{r}_i) \\approx \\left(\\frac{1}{\\Delta q_i}\\right)^2 \\frac{p_i(1-p_i)}{N} + \\left(-\\frac{p_i}{\\Delta q_i^2}\\right)^2 \\frac{q_i(1-q_i)}{N} + 2\\left(\\frac{1}{\\Delta q_i}\\right)\\left(-\\frac{p_i}{\\Delta q_i^2}\\right)\\frac{p_i(1-q_i)}{N} $$\n$$ = \\frac{1}{N\\Delta^2}\\left[ \\frac{p_i(1-p_i)}{q_i^2} + \\frac{p_i^2(1-q_i)}{q_i^3} - \\frac{2p_i^2(1-q_i)}{q_i^3} \\right] $$\n$$ = \\frac{1}{N\\Delta^2}\\left[ \\frac{p_i-p_i^2}{q_i^2} - \\frac{p_i^2(1-q_i)}{q_i^3} \\right] $$\n我们找到公分母 $q_i^3$：\n$$ = \\frac{1}{N\\Delta^2 q_i^3}\\left[ (p_i-p_i^2)q_i - p_i^2(1-q_i) \\right] $$\n$$ = \\frac{1}{N\\Delta^2 q_i^3}\\left[ p_i q_i - p_i^2 q_i - p_i^2 + p_i^2 q_i \\right] = \\frac{p_i q_i - p_i^2}{N\\Delta^2 q_i^3} = \\frac{p_i(q_i-p_i)}{N\\Delta^2 q_i^3} $$\n这是用 $p_i$ 和 $q_i$ 表示的方差。最后一步是将其用 $r(t_i)$、$\\Delta$、$q_i$ 和 $N$ 来表示。\n从估计量的推导中，我们得到近似关系 $p_i \\approx (r(t_i)\\Delta)q_i$。将此代入方差表达式中：\n$$ \\text{Var}(\\hat{r}_i) \\approx \\frac{(r(t_i)\\Delta q_i)(q_i - r(t_i)\\Delta q_i)}{N\\Delta^2 q_i^3} $$\n$$ = \\frac{r(t_i)\\Delta q_i \\cdot q_i(1-r(t_i)\\Delta)}{N\\Delta^2 q_i^3} $$\n$$ = \\frac{r(t_i)\\Delta q_i^2(1-r(t_i)\\Delta)}{N\\Delta^2 q_i^3} $$\n$$ = \\frac{r(t_i)(1-r(t_i)\\Delta)}{N\\Delta q_i} $$\n这就是 $r(t_i)$ 的IPW估计量的大样本方差的最终闭式表达式。",
            "answer": "$$ \\boxed{\\frac{r(t_i)(1-r(t_i)\\Delta)}{N \\Delta q_i}} $$"
        }
    ]
}