{
    "hands_on_practices": [
        {
            "introduction": "Understanding the relationship between a LiDAR system's digitization process and its resulting spatial resolution is a cornerstone of remote sensing analysis. This exercise connects the abstract concept of a digitizer's sampling rate, $f_s$, directly to the physical range resolution of a full-waveform system. By working through this derivation, you will gain a practical appreciation for the critical design trade-off between achieving high-resolution data and managing the resulting data volume and storage costs.",
            "id": "3813872",
            "problem": "An airborne Light Detection and Ranging (LiDAR) system records full-waveform returns from forest canopies. The digitizer uniformly samples the backscattered analog signal at a rate $f_s$ and stores each sample with a fixed bit depth. The system parameters are:\n- Sampling rate $f_s = 2.5\\,\\mathrm{GHz}$,\n- Record duration per laser shot $T = 20\\,\\mu\\mathrm{s}$,\n- Bit depth per sample $b = 12\\,\\mathrm{bits}$,\n- Speed of light $c = 2.99792458 \\times 10^{8}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n\nStarting from the two-way time-of-flight relationship between travel time and range, and the definition of uniform sampling, derive the range-bin size for this full-waveform digitization and compute its numerical value. Express the final range-bin size in centimeters and round your answer to four significant figures.\n\nAdditionally, analyze, from first principles, the trade-offs between increasing the sampling rate $f_s$ and the resulting memory footprint for a fixed waveform duration $T$. Your analysis should cover how the number of samples, the total stored bits, and the record duration drive storage requirements, and should contrast these considerations with those of photon-counting LiDAR, where individual photon detection events are timestamped rather than the analog waveform being uniformly sampled. No numerical evaluation of memory is required; provide a symbolic assessment and qualitative discussion only.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the principles of remote sensing and digital signal processing, is well-posed with sufficient information for a unique solution, and is expressed in objective, precise language. All parameters are physically realistic. The problem requires a standard derivation, a numerical calculation, and a conceptual analysis, all of which are appropriate for the domain.\n\nThe problem is addressed in two parts as requested: first, the derivation and calculation of the range-bin size, and second, the qualitative analysis of storage trade-offs.\n\n**Part 1: Derivation and Calculation of Range-Bin Size**\n\nThe fundamental principle of LiDAR is the measurement of the time-of-flight of a pulse of light. The total distance, $d$, travelled by the light from the sensor to a target and back to the sensor is given by the product of the speed of light, $c$, and the two-way travel time, $\\Delta t$.\n$$d = c \\Delta t$$\nThe range, $R$, to the target is one-half of this total distance, as it represents a one-way path.\n$$R = \\frac{d}{2} = \\frac{c \\Delta t}{2}$$\nThis is the two-way time-of-flight relationship.\n\nA full-waveform LiDAR system's digitizer samples the analog backscattered signal at a uniform sampling rate, $f_s$. The time interval between any two consecutive samples is the sampling period, $\\Delta t_s$, which is the reciprocal of the sampling frequency:\n$$\\Delta t_s = \\frac{1}{f_s}$$\nThis sampling period, $\\Delta t_s$, represents the smallest temporal feature that can be resolved in the digitized waveform. Consequently, it determines the finest possible range resolution, known as the range-bin size, $\\Delta R$. The range-bin size is the change in range, $\\Delta R$, that corresponds to the time interval between consecutive samples, $\\Delta t_s$.\n\nBy substituting $\\Delta t_s$ for $\\Delta t$ in the range equation, we can derive the expression for the range-bin size:\n$$\\Delta R = \\frac{c \\Delta t_s}{2}$$\nSubstituting the expression for $\\Delta t_s$ in terms of $f_s$, we arrive at the final formula for the range-bin size:\n$$\\Delta R = \\frac{c}{2 f_s}$$\nNow, we compute the numerical value for $\\Delta R$ using the provided parameters:\n- Speed of light, $c = 2.99792458 \\times 10^{8}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- Sampling rate, $f_s = 2.5\\,\\mathrm{GHz} = 2.5 \\times 10^{9}\\,\\mathrm{s}^{-1}$\n\nSubstituting these values into the derived equation:\n$$\\Delta R = \\frac{2.99792458 \\times 10^{8}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{2 \\times (2.5 \\times 10^{9}\\,\\mathrm{s}^{-1})} = \\frac{2.99792458 \\times 10^{8}}{5.0 \\times 10^{9}}\\,\\mathrm{m}$$\n$$\\Delta R = 0.0599584916\\,\\mathrm{m}$$\nThe problem requires the answer to be expressed in centimeters. We use the conversion $1\\,\\mathrm{m} = 100\\,\\mathrm{cm}$:\n$$\\Delta R = 0.0599584916 \\times 100\\,\\mathrm{cm} = 5.99584916\\,\\mathrm{cm}$$\nFinally, we round the result to four significant figures:\n$$\\Delta R \\approx 5.996\\,\\mathrm{cm}$$\n\n**Part 2: Analysis of Storage Trade-offs**\n\nThis section analyzes the trade-offs associated with the sampling rate in full-waveform systems and contrasts them with photon-counting systems.\n\nFor a full-waveform LiDAR (FWL) system, the data storage requirement for a single laser shot is deterministic. For a fixed record duration, $T$, and a sampling rate, $f_s$, the total number of samples, $N_{\\text{samples}}$, is given by:\n$$N_{\\text{samples}} = f_s \\times T$$\nEach sample is quantized with a bit depth of $b$ bits. Therefore, the total memory footprint per waveform, $M_{\\text{FWL}}$, is:\n$$M_{\\text{FWL}} = N_{\\text{samples}} \\times b = f_s \\times T \\times b$$\nFrom this relationship, the trade-off of increasing the sampling rate, $f_s$, while keeping the duration $T$ fixed, is clear. The memory footprint, $M_{\\text{FWL}}$, is directly proportional to $f_s$. An increase in $f_s$ yields a smaller range-bin size, $\\Delta R = c/(2f_s)$, which improves the longitudinal resolution and the ability to distinguish closely spaced objects. However, this enhanced resolution comes at the direct cost of a linear increase in data volume, memory requirements, and subsequently, data transmission and processing overhead. For every laser shot, the system must store a large, dense array of sample values, regardless of whether a meaningful signal was returned.\n\nIn contrast, a photon-counting LiDAR (PCL) system operates on a different principle. It does not record a continuous waveform but rather detects discrete photon arrival events and records their timestamps with high precision. The data volume is therefore not fixed per shot. Let $N_{\\text{photons}}$ be the number of photons detected within the observation window for a single laser shot, and let $b_{\\text{ts}}$ be the number of bits required to store a single timestamp. The memory footprint for a PCL system, $M_{\\text{PCL}}$, is approximately:\n$$M_{\\text{PCL}} \\approx N_{\\text{photons}} \\times b_{\\text{ts}}$$\nThe key distinction is that $N_{\\text{photons}}$ is not a fixed system parameter; it is a stochastic variable that depends on the signal strength, which in turn is a function of target reflectivity, range, atmospheric attenuation, and background illumination.\n\nThis leads to the following contrast in storage considerations:\n1.  **Data Structure:** FWL generates dense, regularly structured data. PCL generates sparse, event-driven data.\n2.  **Dependence on Signal:** FWL storage requirements are independent of the returned signal strength. A full waveform is stored even if it contains only noise. PCL storage requirements are directly proportional to the number of detected photons. In low-signal or sparse-return environments (e.g., over water, dark targets, high altitudes), PCL is exceptionally data-efficient.\n3.  **Effect of Resolution:** In FWL, increasing range resolution requires a higher $f_s$, which uniformly increases the data volume for all acquisitions. In PCL, increasing temporal resolution means using a more precise time-tagging unit (effectively increasing $b_{\\text{ts}}$ or the underlying clockrate), which increases the data size per detected photon, but the total data volume remains dependent on $N_{\\text{photons}}$.\n4.  **System Limitations:** FWL gracefully handles high-power returns by recording a high-amplitude signal. PCL systems can suffer from detector saturation in high-signal or high-background-noise conditions, where the rate of incoming photons exceeds the detector's ability to resolve individual events. In such cases, the number of recorded events may not be representative of the true signal, and the data volume could potentially become large.\n\nIn summary, the trade-off for FWL is a direct-cost relationship between range resolution and data volume. The trade-off for PCL is more complex, involving a balance between single-photon sensitivity, data efficiency in sparse conditions, and susceptibility to saturation in high-signal conditions. The choice between the systems depends fundamentally on the application and the expected signal environment.",
            "answer": "$$\n\\boxed{5.996}\n$$"
        },
        {
            "introduction": "After establishing how a system's sampling rate determines its resolution, we can ask a more fundamental question: what is the ultimate limit on measurement precision? This practice delves into the heart of estimation theory by introducing the Cramér–Rao Lower Bound (CRLB). You will derive the CRLB for time-of-arrival estimation, revealing how factors like signal-to-noise ratio ($\\mathrm{SNR}$) and pulse shape dictate the best possible accuracy any ideal processor can achieve, providing a benchmark against which real-world algorithms can be measured.",
            "id": "3813803",
            "problem": "A Light Detection and Ranging (LiDAR) receiver observes a temporally shifted pulse corrupted by Additive White Gaussian Noise (AWGN). The received waveform is modeled as $y(t) = s(t - \\tau) + n(t)$, where $s(t)$ is a known deterministic template, $\\tau$ is the unknown time-of-arrival parameter to be estimated, and $n(t)$ is zero-mean AWGN with two-sided power spectral density $N_0/2$. Suppose the transmitted pulse is Gaussian in time, $s(t) = A \\exp\\!\\big(-t^2/(2\\sigma^2)\\big)$, with known amplitude $A$ and temporal standard deviation $\\sigma$. The energy of the pulse is $E_s = \\int_{-\\infty}^{\\infty} s^2(t)\\,dt$, and the signal-to-noise ratio is defined as $\\mathrm{SNR} = E_s/N_0$. The full width at half maximum of the Gaussian pulse is $T_{\\mathrm{FWHM}} = 2\\sqrt{2\\ln 2}\\,\\sigma$.\n\nStarting from the definition of Fisher information for a parametric family $p(y|\\tau)$ and the Cramér–Rao lower bound (CRLB) for any unbiased estimator $\\hat{\\tau}$, derive the CRLB on the variance of unbiased time-of-arrival estimators for this LiDAR waveform in AWGN. Express your final bound in closed form as a function of $\\mathrm{SNR}$ and $T_{\\mathrm{FWHM}}$. Provide the final bound in units of seconds squared. No intermediate or numerical approximations are required, and the answer should be a single analytic expression.",
            "solution": "The problem asks for the Cramér–Rao Lower Bound (CRLB) on the variance of any unbiased estimator for the time-of-arrival parameter $\\tau$ of a Gaussian pulse in Additive White Gaussian Noise (AWGN). The final result must be expressed as a function of the signal-to-noise ratio ($\\mathrm{SNR}$) and the pulse's full width at half maximum ($T_{\\mathrm{FWHM}}$).\n\nThe received waveform is given by the model:\n$$y(t) = s(t - \\tau) + n(t)$$\nwhere $s(t)$ is the deterministic signal template, $\\tau$ is the unknown time-of-arrival, and $n(t)$ is a zero-mean white Gaussian noise process with a constant two-sided power spectral density of $\\frac{N_0}{2}$.\n\nFor any unbiased estimator $\\hat{\\tau}$ of the parameter $\\tau$, the CRLB states that its variance is lower-bounded by the reciprocal of the Fisher information, $I(\\tau)$:\n$$\\mathrm{var}(\\hat{\\tau}) \\ge \\frac{1}{I(\\tau)}$$\nFor the given signal model in AWGN, the Fisher information for the time-delay parameter $\\tau$ is given by the formula:\n$$I(\\tau) = \\frac{2}{N_0} \\int_{-\\infty}^{\\infty} \\left[ \\frac{\\partial s(t - \\tau)}{\\partial \\tau} \\right]^2 dt$$\nThe signal template is a Gaussian pulse:\n$$s(t) = A \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right)$$\nFirst, we compute the partial derivative of the time-shifted signal $s(t - \\tau)$ with respect to $\\tau$. Let $u = t - \\tau$, so $\\frac{\\partial u}{\\partial \\tau} = -1$.\n$$\\frac{\\partial s(t - \\tau)}{\\partial \\tau} = \\frac{d}{d(t-\\tau)} \\left[ A \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right) \\right] \\cdot \\frac{\\partial(t-\\tau)}{\\partial \\tau}$$\n$$\\frac{\\partial s(t - \\tau)}{\\partial \\tau} = \\left[ A \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right) \\cdot \\left(-\\frac{2(t-\\tau)}{2\\sigma^2}\\right) \\right] \\cdot (-1)$$\n$$\\frac{\\partial s(t - \\tau)}{\\partial \\tau} = A \\frac{(t-\\tau)}{\\sigma^2} \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right)$$\nThis can be recognized as $-s'(t-\\tau)$, where $s'(t)$ is the derivative of $s(t)$ with respect to its argument $t$. The Fisher information integral becomes:\n$$I(\\tau) = \\frac{2}{N_0} \\int_{-\\infty}^{\\infty} \\left[ A \\frac{(t-\\tau)}{\\sigma^2} \\exp\\left(-\\frac{(t-\\tau)^2}{2\\sigma^2}\\right) \\right]^2 dt$$\nSince the integration is over all time from $-\\infty$ to $\\infty$, the value of the integral is independent of the shift $\\tau$. We can simplify the calculation by setting $\\tau=0$:\n$$I(\\tau) = I = \\frac{2}{N_0} \\int_{-\\infty}^{\\infty} \\left[ A \\frac{t}{\\sigma^2} \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right) \\right]^2 dt$$\n$$I = \\frac{2A^2}{N_0 \\sigma^4} \\int_{-\\infty}^{\\infty} t^2 \\exp\\left(-\\frac{t^2}{\\sigma^2}\\right) dt$$\nThis is a standard Gaussian integral of the form $\\int_{-\\infty}^{\\infty} x^{2n} \\exp(-ax^2) dx = \\frac{(2n-1)!!}{2^n a^n} \\sqrt{\\frac{\\pi}{a}}$. For our case, $n=1$ and $a = \\frac{1}{\\sigma^2}$.\nThe integral evaluates to:\n$$\\int_{-\\infty}^{\\infty} t^2 \\exp\\left(-\\frac{t^2}{\\sigma^2}\\right) dt = \\frac{1}{2(1/\\sigma^2)} \\sqrt{\\frac{\\pi}{1/\\sigma^2}} = \\frac{\\sigma^2}{2} \\sqrt{\\pi\\sigma^2} = \\frac{\\sigma^3\\sqrt{\\pi}}{2}$$\nSubstituting this back into the expression for $I$:\n$$I = \\frac{2A^2}{N_0 \\sigma^4} \\left( \\frac{\\sigma^3\\sqrt{\\pi}}{2} \\right) = \\frac{A^2 \\sqrt{\\pi}}{N_0 \\sigma}$$\nTo express this in terms of the signal energy $E_s$ and SNR, we first calculate $E_s$:\n$$E_s = \\int_{-\\infty}^{\\infty} s^2(t) dt = \\int_{-\\infty}^{\\infty} \\left[ A \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right) \\right]^2 dt = A^2 \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{t^2}{\\sigma^2}\\right) dt$$\nThis is another standard Gaussian integral, $\\int_{-\\infty}^{\\infty} \\exp(-ax^2) dx = \\sqrt{\\frac{\\pi}{a}}$. With $a=\\frac{1}{\\sigma^2}$, the integral is $\\sqrt{\\pi\\sigma^2} = \\sigma\\sqrt{\\pi}$.\nThus, the signal energy is:\n$$E_s = A^2 \\sigma \\sqrt{\\pi}$$\nWe can rearrange this to find an expression for $A^2\\sqrt{\\pi} = \\frac{E_s}{\\sigma}$. Substituting this into our expression for Fisher information $I$:\n$$I = \\frac{1}{N_0 \\sigma} (A^2 \\sqrt{\\pi}) = \\frac{1}{N_0 \\sigma} \\left( \\frac{E_s}{\\sigma} \\right) = \\frac{E_s}{N_0 \\sigma^2}$$\nThe CRLB is the inverse of the Fisher information:\n$$\\mathrm{CRLB}(\\tau) = \\frac{1}{I} = \\frac{N_0 \\sigma^2}{E_s}$$\nThe problem defines the signal-to-noise ratio as $\\mathrm{SNR} = \\frac{E_s}{N_0}$. Substituting this definition:\n$$\\mathrm{CRLB}(\\tau) = \\frac{\\sigma^2}{E_s/N_0} = \\frac{\\sigma^2}{\\mathrm{SNR}}$$\nFinally, we must express the result in terms of $T_{\\mathrm{FWHM}}$ instead of $\\sigma$. The relationship is given as:\n$$T_{\\mathrm{FWHM}} = 2\\sqrt{2\\ln 2}\\,\\sigma$$\nSolving for $\\sigma^2$:\n$$\\sigma^2 = \\left( \\frac{T_{\\mathrm{FWHM}}}{2\\sqrt{2\\ln 2}} \\right)^2 = \\frac{T_{\\mathrm{FWHM}}^2}{4(2\\ln 2)} = \\frac{T_{\\mathrm{FWHM}}^2}{8\\ln 2}$$\nSubstituting this expression for $\\sigma^2$ into the CRLB formula yields the final answer:\n$$\\mathrm{CRLB}(\\tau) = \\frac{1}{\\mathrm{SNR}} \\left( \\frac{T_{\\mathrm{FWHM}}^2}{8\\ln 2} \\right) = \\frac{T_{\\mathrm{FWHM}}^2}{8 (\\ln 2) (\\mathrm{SNR})}$$\nThis result represents the minimum possible variance for any unbiased estimator of the pulse's time of arrival, given in units of seconds squared.",
            "answer": "$$\\boxed{\\frac{T_{\\mathrm{FWHM}}^2}{8 (\\ln 2) (\\mathrm{SNR})}}$$"
        },
        {
            "introduction": "Ultimately, LiDAR systems are used not just to measure, but to detect. This culminating practice moves from theoretical precision to the practical task of designing and evaluating a detection algorithm that distinguishes a faint echo from background noise. By constructing Receiver Operating Characteristic (ROC) curves for both full-waveform and photon-counting models, you will learn to quantify and visualize detector performance, providing a robust framework for comparing different LiDAR technologies and processing strategies.",
            "id": "3813798",
            "problem": "You are tasked with constructing and evaluating a detection algorithm for Light Detection and Ranging (LiDAR) echo detection under two system models: full-waveform LiDAR and photon-counting LiDAR. For both systems, derive the true positive rate and false positive rate as functions of a decision threshold and assemble the Receiver Operating Characteristic (ROC) curve. Then, compute the area under the ROC curve (AUC) using numerical integration. The final output of the program must be a list of floating point values, each being the AUC for a specified test case.\n\nThe problem must be solved from first principles of detection theory, using the following base models.\n\nFor the full-waveform LiDAR model, consider a sampled voltage waveform where the received signal is modeled as a known template embedded in additive noise. Let the signal template be a Gaussian pulse centered at zero time defined on a uniform time grid. Denote the template samples by $g_i$ at times $t_i$, and the noise samples by $n_i$. The observed waveform samples under the null hypothesis (no echo) are $v_i = n_i$, and under the alternative hypothesis (echo present) are $v_i = s_i + n_i$ where $s_i = A g_i$ with $A$ being a nonnegative amplitude in volts. Assume $n_i$ are independent and identically distributed zero-mean Gaussian random variables with standard deviation $\\sigma_n$ in volts, and that the decision statistic is a matched-filter inner product using the template $g_i$ on the same grid. Your task is to deduce the distribution of the matched-filter decision statistic under both hypotheses and, from that, to compute the false positive rate and true positive rate for a given decision threshold.\n\nFor the photon-counting LiDAR model, consider count data collected in a single time bin (or gate), where the observed count under the null hypothesis is a Poisson random variable with mean background rate $\\lambda_b$ (counts per gate), and under the alternative hypothesis is a Poisson random variable with mean $\\lambda_b + \\lambda_s$ where $\\lambda_s$ is the mean signal contribution (counts per gate). Use a count threshold (an integer number of counts) as the decision threshold and derive the false positive rate and true positive rate as functions of this threshold.\n\nScientific realism requires the following choices to be used in the computations:\n- The template $g_i$ is a Gaussian pulse $g(t) = \\exp\\!\\left(-\\frac{t^2}{2 \\sigma_p^2}\\right)$ sampled on a uniform time grid $t_i$ covering a symmetric window $[-T,T]$ with uniform spacing $\\Delta t$. Pulse width $\\sigma_p$ is in nanoseconds, $T$ is in nanoseconds, and $\\Delta t$ is in nanoseconds. The amplitude $A$ is in volts, and the noise standard deviation $\\sigma_n$ is in volts.\n- For photon-counting, the threshold is an integer number of counts, and the rates $\\lambda_b$ and $\\lambda_s$ are in counts per gate.\n\nYou must compute, for a sequence of thresholds spanning values from always-accept (very low threshold) to always-reject (very high threshold), the pairs $(\\text{FPR}, \\text{TPR})$ and the corresponding ROC curve. Express the area under the ROC curve (AUC) as a floating point number. All outputs are unitless.\n\nYour program must implement the following test suite. Each test case defines the system type and parameters. For the full-waveform LiDAR cases, the template is as above sampled on $t_i$ from $-T$ to $T$ inclusive with uniform spacing $\\Delta t$, and detection thresholds are chosen over a range that fully spans practical decision behavior. For photon-counting LiDAR cases, the count thresholds are a contiguous integer range starting at $0$ up to a sufficiently large maximum count. The four test cases are:\n\n- Test case $1$ (full-waveform LiDAR, moderate signal-to-noise): $A = 0.15$ volts, $\\sigma_n = 0.05$ volts, $\\sigma_p = 2.0$ nanoseconds, $T = 10.0$ nanoseconds, $\\Delta t = 0.1$ nanoseconds, number of thresholds $N_\\theta = 201$.\n- Test case $2$ (full-waveform LiDAR, low signal-to-noise): $A = 0.05$ volts, $\\sigma_n = 0.05$ volts, $\\sigma_p = 2.0$ nanoseconds, $T = 10.0$ nanoseconds, $\\Delta t = 0.1$ nanoseconds, number of thresholds $N_\\theta = 201$.\n- Test case $3$ (photon-counting LiDAR, moderate signal contribution): $\\lambda_b = 0.5$ counts per gate, $\\lambda_s = 2.0$ counts per gate, use integer thresholds from $0$ up to a maximum count that covers the practical range.\n- Test case $4$ (photon-counting LiDAR, no signal edge case): $\\lambda_b = 1.0$ counts per gate, $\\lambda_s = 0.0$ counts per gate, use integer thresholds from $0$ up to a maximum count that covers the practical range.\n\nFor each test case, you must:\n- Derive the distribution of the decision statistic under both hypotheses from the stated models and compute $\\text{FPR}(\\theta)$ and $\\text{TPR}(\\theta)$ as functions of threshold $\\theta$.\n- Assemble the ROC curve as the set of $(\\text{FPR}, \\text{TPR})$ pairs over the threshold sweep.\n- Compute the area under the ROC curve (AUC) using the trapezoidal rule applied to $\\text{TPR}$ as a function of $\\text{FPR}$.\n\nYour program should produce a single line of output containing the AUC values for the four test cases as a comma-separated list enclosed in square brackets. For example, the output format must be exactly like $[\\text{auc}_1,\\text{auc}_2,\\text{auc}_3,\\text{auc}_4]$, where each $\\text{auc}_k$ is a floating point number. No physical units are required in the output.",
            "solution": "The problem requires the derivation and computation of the Receiver Operating Characteristic (ROC) curve and the Area Under the Curve (AUC) for two distinct LiDAR detection scenarios: a full-waveform system and a photon-counting system. This is a classic problem in statistical decision theory applied to signal processing. The solution proceeds by first validating the problem statement, which is found to be valid, scientifically grounded, and well-posed. We then derive the necessary theoretical models for both systems from first principles.\n\n### Full-Waveform LiDAR Echo Detection\n\nIn the full-waveform model, we are tasked with detecting a deterministic signal of known shape embedded in additive white Gaussian noise. This is a signal-known-exactly (SKE) detection problem.\n\n**1. Model Formulation**\n\nThe discrete-time observed voltage waveform is represented by a vector $\\mathbf{v}$ of length $N$. The two hypotheses are:\n-   Null Hypothesis ($H_0$, no echo): The received waveform consists only of noise.\n    $$H_0: v_i = n_i$$\n-   Alternative Hypothesis ($H_1$, echo present): The received waveform consists of a signal plus noise.\n    $$H_1: v_i = s_i + n_i = A g_i + n_i$$\nHere, $g_i$ are the samples of the known Gaussian pulse template $g(t) = \\exp(-t^2 / (2\\sigma_p^2))$ on a uniform time grid $t_i$. $A$ is the signal amplitude, and $n_i$ are independent and identically distributed (i.i.d.) random noise samples from a zero-mean Gaussian distribution, $n_i \\sim \\mathcal{N}(0, \\sigma_n^2)$.\n\n**2. Decision Statistic: The Matched Filter**\n\nThe optimal detector for a known signal in additive white Gaussian noise is the matched filter. The decision statistic, $\\Lambda$, is formed by taking the inner product of the observed waveform vector $\\mathbf{v}$ with the signal template vector $\\mathbf{g}$:\n$$\\Lambda = \\mathbf{g}^T \\mathbf{v} = \\sum_{i=0}^{N-1} g_i v_i$$\nSince $\\Lambda$ is a linear combination of Gaussian random variables ($v_i$), $\\Lambda$ itself is a Gaussian random variable under both hypotheses. We now determine its parameters.\n\n**3. Distribution of the Decision Statistic**\n\n-   **Under $H_0$**: $\\mathbf{v} = \\mathbf{n}$.\n    The statistic is $\\Lambda_0 = \\sum_i g_i n_i$.\n    The mean of $\\Lambda_0$ is:\n    $$\\mu_0 = E[\\Lambda_0] = E\\left[\\sum_i g_i n_i\\right] = \\sum_i g_i E[n_i] = 0$$\n    The variance of $\\Lambda_0$ is:\n    $$\\sigma_\\Lambda^2 = \\text{Var}(\\Lambda_0) = \\text{Var}\\left(\\sum_i g_i n_i\\right) = \\sum_i g_i^2 \\text{Var}(n_i) = \\sigma_n^2 \\sum_i g_i^2$$\n    Let $E_g = \\sum_i g_i^2$ be the energy of the discrete template. Then, $\\sigma_\\Lambda^2 = \\sigma_n^2 E_g$.\n    Thus, under $H_0$, the decision statistic follows the distribution $\\Lambda \\sim \\mathcal{N}(0, \\sigma_n^2 E_g)$.\n\n-   **Under $H_1$**: $\\mathbf{v} = A\\mathbf{g} + \\mathbf{n}$.\n    The statistic is $\\Lambda_1 = \\sum_i g_i (A g_i + n_i) = A\\sum_i g_i^2 + \\sum_i g_i n_i = A E_g + \\Lambda_0$.\n    The mean of $\\Lambda_1$ is:\n    $$\\mu_1 = E[\\Lambda_1] = E[A E_g + \\Lambda_0] = A E_g + E[\\Lambda_0] = A E_g$$\n    The variance of $\\Lambda_1$ is:\n    $$\\text{Var}(\\Lambda_1) = \\text{Var}(A E_g + \\Lambda_0) = \\text{Var}(\\Lambda_0) = \\sigma_n^2 E_g = \\sigma_\\Lambda^2$$\n    Thus, under $H_1$, the decision statistic follows the distribution $\\Lambda \\sim \\mathcal{N}(A E_g, \\sigma_n^2 E_g)$.\n\n**4. False Positive and True Positive Rates**\n\nA decision is made by comparing the statistic $\\Lambda$ to a threshold $\\theta$. We declare $H_1$ if $\\Lambda > \\theta$.\n\n-   **False Positive Rate (FPR)**: The probability of incorrectly deciding $H_1$ when $H_0$ is true.\n    $$\\text{FPR}(\\theta) = P(\\Lambda > \\theta | H_0) = \\int_\\theta^\\infty \\frac{1}{\\sqrt{2\\pi}\\sigma_\\Lambda} \\exp\\left(-\\frac{x^2}{2\\sigma_\\Lambda^2}\\right) dx$$\n    This is expressed using the complementary cumulative distribution function (or Q-function) of a standard normal distribution, $Q(z) = \\frac{1}{\\sqrt{2\\pi}} \\int_z^\\infty e^{-u^2/2} du$.\n    $$\\text{FPR}(\\theta) = Q\\left(\\frac{\\theta - \\mu_0}{\\sigma_\\Lambda}\\right) = Q\\left(\\frac{\\theta}{\\sigma_n \\sqrt{E_g}}\\right)$$\n\n-   **True Positive Rate (TPR)**: The probability of correctly deciding $H_1$ when $H_1$ is true.\n    $$\\text{TPR}(\\theta) = P(\\Lambda > \\theta | H_1) = \\int_\\theta^\\infty \\frac{1}{\\sqrt{2\\pi}\\sigma_\\Lambda} \\exp\\left(-\\frac{(x - \\mu_1)^2}{2\\sigma_\\Lambda^2}\\right) dx$$\n    $$\\text{TPR}(\\theta) = Q\\left(\\frac{\\theta - \\mu_1}{\\sigma_\\Lambda}\\right) = Q\\left(\\frac{\\theta - A E_g}{\\sigma_n \\sqrt{E_g}}\\right)$$\nThe Q-function can be computed using the complementary error function, $\\text{erfc}(z) = \\frac{2}{\\sqrt{\\pi}}\\int_z^\\infty e^{-u^2}du$, via the relation $Q(z) = \\frac{1}{2}\\text{erfc}(z/\\sqrt{2})$.\n\n### Photon-Counting LiDAR Echo Detection\n\nIn the photon-counting model, the observation is an integer number of detected photons, $K$, in a given time gate. The statistics are governed by the Poisson distribution.\n\n**1. Model Formulation**\n\n-   Null Hypothesis ($H_0$, background only): The photon count follows a Poisson distribution with mean rate $\\lambda_b$.\n    $$H_0: K \\sim \\text{Poisson}(\\lambda_b)$$\n-   Alternative Hypothesis ($H_1$, signal plus background): The photon count follows a Poisson distribution with mean rate $\\lambda_b + \\lambda_s$.\n    $$H_1: K \\sim \\text{Poisson}(\\lambda_b + \\lambda_s)$$\n\n**2. Decision Rule and Rates**\n\nThe decision is based on comparing the observed count $K$ to an integer threshold $k_{th}$. We decide $H_1$ if $K \\ge k_{th}$.\n\n-   **False Positive Rate (FPR)**:\n    $$\\text{FPR}(k_{th}) = P(K \\ge k_{th} | H_0) = \\sum_{k=k_{th}}^\\infty \\frac{e^{-\\lambda_b} \\lambda_b^k}{k!} = 1 - P(K \\le k_{th}-1 | H_0)$$\n    This is the survival function of the Poisson distribution evaluated at $k_{th}-1$.\n\n-   **True Positive Rate (TPR)**:\n    $$\\text{TPR}(k_{th}) = P(K \\ge k_{th} | H_1) = \\sum_{k=k_{th}}^\\infty \\frac{e^{-(\\lambda_b+\\lambda_s)} (\\lambda_b+\\lambda_s)^k}{k!} = 1 - P(K \\le k_{th}-1 | H_1)$$\n\n### ROC Curve and AUC Calculation\n\nThe ROC curve is a plot of TPR versus FPR for all possible threshold values. For the continuous-valued statistic $\\Lambda$, sweeping $\\theta$ from $+\\infty$ to $-\\infty$ traces a smooth curve from $(0,0)$ to $(1,1)$. For the discrete count $K$, varying the integer threshold $k_{th}$ produces a series of points that form a staircase-like curve.\n\nThe Area Under the Curve (AUC) is a summary measure of the detector's performance. An AUC of $1.0$ represents a perfect classifier, while an AUC of $0.5$ indicates performance no better than random chance. The problem specifies computing the AUC numerically using the trapezoidal rule. For a set of ROC points $(x_i, y_i) = (\\text{FPR}_i, \\text{TPR}_i)$ sorted by increasing $x_i$, the AUC is approximated by:\n$$\\text{AUC} \\approx \\sum_{i=1}^{M-1} \\frac{1}{2}(y_i + y_{i-1})(x_i - x_{i-1})$$\nwhere $M$ is the number of points. This is implemented by `numpy.trapz`. For the photon-counting case, we generate the ROC points by sweeping the integer threshold $k_{th}$ from a sufficiently large maximum value down to $0$. For the waveform case, we sweep the continuous threshold $\\theta$ over a range that covers the bulk of both probability distributions, ensuring the generated (FPR, TPR) pairs span the curve from near $(0,0)$ to near $(1,1)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erfc\nfrom scipy.stats import poisson\n\ndef solve_waveform_auc(A, sigma_n, sigma_p, T, dt, N_theta):\n    \"\"\"\n    Computes the AUC for a full-waveform LiDAR system.\n\n    Args:\n        A (float): Signal amplitude in volts.\n        sigma_n (float): Noise standard deviation in volts.\n        sigma_p (float): Gaussian pulse width in nanoseconds.\n        T (float): Half-width of the time window in nanoseconds.\n        dt (float): Time grid spacing in nanoseconds.\n        N_theta (int): Number of thresholds for the ROC curve.\n\n    Returns:\n        float: The calculated Area Under the ROC Curve (AUC).\n    \"\"\"\n    # 1. Generate template and compute its energy\n    t = np.arange(-T, T + dt / 2, dt)\n    g = np.exp(-t**2 / (2 * sigma_p**2))\n    E_g = np.sum(g**2)\n\n    # 2. Derive parameters of the decision statistic distributions\n    mu_0 = 0.0\n    mu_1 = A * E_g\n    sigma_lambda = sigma_n * np.sqrt(E_g)\n\n    # 3. Define a threshold range that spans from always-reject to always-accept\n    # A wide range ensures the ROC curve covers the full [0, 1] range.\n    # The range is chosen to cover several standard deviations around both means.\n    # We sweep from high to low theta to get an ascending FPR/TPR curve.\n    theta_max = mu_1 + 6 * sigma_lambda\n    theta_min = mu_0 - 6 * sigma_lambda\n    theta = np.linspace(theta_max, theta_min, N_theta)\n\n    # 4. Calculate FPR and TPR arrays\n    # The Q-function Q(x) is 0.5 * erfc(x / sqrt(2))\n    arg_fpr = (theta - mu_0) / (np.sqrt(2) * sigma_lambda)\n    arg_tpr = (theta - mu_1) / (np.sqrt(2) * sigma_lambda)\n    fpr = 0.5 * erfc(arg_fpr)\n    tpr = 0.5 * erfc(arg_tpr)\n\n    # 5. Compute AUC using the trapezoidal rule\n    # Since theta is swept from high to low, fpr is already sorted in increasing order.\n    auc = np.trapz(tpr, fpr)\n    \n    return auc\n\n\ndef solve_photon_auc(lambda_b, lambda_s):\n    \"\"\"\n    Computes the AUC for a photon-counting LiDAR system.\n\n    Args:\n        lambda_b (float): Mean background count rate per gate.\n        lambda_s (float): Mean signal count rate per gate.\n\n    Returns:\n        float: The calculated Area Under the ROC Curve (AUC).\n    \"\"\"\n    # 1. Define mean count rates for both hypotheses\n    lambda_0 = lambda_b\n    lambda_1 = lambda_b + lambda_s\n\n    # 2. Define the range of integer thresholds\n    # The maximum threshold must be large enough to make the survival function\n    # practically zero for both distributions.\n    # The '+1' term in max handles the case where rates are < 1.\n    max_rate = max(lambda_0, lambda_1, 1.0)\n    k_max = int(max_rate + 15 * np.sqrt(max_rate)) + 15\n    k_th_values = np.arange(k_max, -1, -1)  # Sweep from k_max down to 0\n\n    # 3. Calculate FPR and TPR for each threshold\n    # P(K >= k_th) = 1 - P(K <= k_th - 1), which is the survival function sf(k_th - 1)\n    fpr = poisson.sf(k_th_values - 1, lambda_0)\n    tpr = poisson.sf(k_th_values - 1, lambda_1)\n\n    # 4. Compute AUC using the trapezoidal rule\n    # As k_th decreases, FPR and TPR increase, so the arrays are correctly ordered.\n    # The points cover the range from near (0,0) to exactly (1,1).\n    auc = np.trapz(tpr, fpr)\n    \n    return auc\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Test cases defined in the problem statement.\n    test_cases = [\n        {'type': 'waveform', 'params': {'A': 0.15, 'sigma_n': 0.05, 'sigma_p': 2.0, 'T': 10.0, 'dt': 0.1, 'N_theta': 201}},\n        {'type': 'waveform', 'params': {'A': 0.05, 'sigma_n': 0.05, 'sigma_p': 2.0, 'T': 10.0, 'dt': 0.1, 'N_theta': 201}},\n        {'type': 'photon', 'params': {'lambda_b': 0.5, 'lambda_s': 2.0}},\n        {'type': 'photon', 'params': {'lambda_b': 1.0, 'lambda_s': 0.0}}\n    ]\n\n    results = []\n    for case in test_cases:\n        if case['type'] == 'waveform':\n            auc = solve_waveform_auc(**case['params'])\n        elif case['type'] == 'photon':\n            auc = solve_photon_auc(**case['params'])\n        results.append(auc)\n\n    # Format the output as a comma-separated list in brackets.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}