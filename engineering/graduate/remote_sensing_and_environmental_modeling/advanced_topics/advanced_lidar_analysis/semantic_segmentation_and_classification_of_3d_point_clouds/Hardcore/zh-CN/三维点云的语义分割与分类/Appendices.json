{
    "hands_on_practices": [
        {
            "introduction": "在许多三维点云分类算法中，局部几何特征的提取是至关重要的一步，而这些特征是在每个点的局部邻域内计算的。然而，真实的激光雷达（LiDAR）数据通常具有空间上不均匀的点密度。为了确保从点云中提取的特征在不同区域具有可比性和鲁棒性，我们必须根据局部点密度动态调整邻域的大小。 这项练习将指导您基于基本的统计原理，设计一个自适应邻域半径选择规则，以在邻域内保持恒定期望的点数，这是构建稳健点云处理流程的一项关键技能。",
            "id": "3844909",
            "problem": "您正在为一处点密度在空间上变化的地面采集的三维点云设计一种自适应邻域选择方案，用于语义分割和分类。假设在任何查询位置附近，点的采样可以被一个非齐次空间泊松过程很好地在局部进行建模，其局部强度（单位：点/立方米）表示为 $\\hat{\\lambda}(p)$，这是真实强度 $\\lambda(p)$ 的一个局部估计量。您的目标是为每个查询位置 $p$ 选择一个半径为 $r(p)$ 的球形邻域，使得球体内的期望点数等于一个预设的目标值 $m_{\\mathrm{target}}$。其基本原理是，对于三维点云语义分割和分类中常用的基于主成分分析（PCA）的局部几何描述符，样本协方差项的方差近似地与 $1/(n-1)$ 成比例，其中 $n$ 是邻域大小。在整个空间中保持期望的 $n$ 值近似恒定，有助于在空间变化的密度下维持鲁棒的特征统计量。\n\n此问题的基本事实：\n- 对于三维空间中强度为 $\\lambda$ 的齐次空间泊松过程，半径为 $r$ 的球体内的期望点数为 $\\mathbb{E}[N(B_{r})] = \\lambda \\, V(B_{r})$，其中 $V(B_{r})$ 是球体的体积。\n- 在三维空间中，半径为 $r$ 的球体的体积是 $V(B_{r}) = \\frac{4}{3}\\pi r^{3}$。\n\n请设计一个自适应半径规则 $r(p)$，使其作为 $\\hat{\\lambda}(p)$ 和 $m_{\\mathrm{target}}$ 的函数，以满足 $\\mathbb{E}[N(B_{r(p)}) \\mid \\hat{\\lambda}(p)] = m_{\\mathrm{target}}$。为保持方法的数值稳定性和物理合理性，请应用以下钳制（clamping）方法来处理边界情况：\n- 将 $\\hat{\\lambda}(p)$ 替换为 $\\hat{\\lambda}_{\\mathrm{eff}}(p) = \\min\\{\\max\\{\\hat{\\lambda}(p), \\lambda_{\\min}\\}, \\lambda_{\\max}\\}$，其中 $\\lambda_{\\min} > 0$ 和 $\\lambda_{\\max} > 0$ 是用户选择的界限。\n- 通过 $r_{\\mathrm{final}}(p) = \\min\\{\\max\\{r(p), r_{\\min}\\}, r_{\\max}\\}$，将最终半径钳制在 $[r_{\\min}, r_{\\max}]$ 范围内。\n\n实现一个程序，为一组给定的查询位置及其 $\\hat{\\lambda}(p)$ 值计算 $r_{\\mathrm{final}}(p)$。请使用以下常量和测试套件。所有强度单位均为“点/立方米”，所有半径必须以“米”表示。\n\n常量：\n- $m_{\\mathrm{target}} = 50$\n- $r_{\\min} = 0.05$\n- $r_{\\max} = 10.0$\n- $\\lambda_{\\min} = 10^{-3}$\n- $\\lambda_{\\max} = 10^{5}$\n\n测试套件（每个测试用例提供一个 $\\hat{\\lambda}(p)$）：\n- 用例 A: $\\hat{\\lambda}(p) = 10^{-1}$\n- 用例 B: $\\hat{\\lambda}(p) = 1$\n- 用例 C: $\\hat{\\lambda}(p) = 10$\n- 用例 D: $\\hat{\\lambda}(p) = 10^{-6}$\n- 用例 E: $\\hat{\\lambda}(p) = 10^{4}$\n\n您的程序必须：\n- 基于上述基本事实和设计目标，从第一性原理推导出 $r(p)$。\n- 按所述方式对 $\\hat{\\lambda}(p)$ 和 $r(p)$ 进行钳制。\n- 生成一行输出，包含五个半径的列表 $[r_{\\mathrm{final}}^{A}, r_{\\mathrm{final}}^{B}, r_{\\mathrm{final}}^{C}, r_{\\mathrm{final}}^{D}, r_{\\mathrm{final}}^{E}]$，以逗号分隔，并用方括号括起来，每个半径以米为单位表示，并四舍五入到 $6$ 位小数。例如，输出格式必须与 $[x_{A},x_{B},x_{C},x_{D},x_{E}]$ 完全一致，其中每个 $x_{\\cdot}$ 是小数点后有 $6$ 位数字的十进制数。\n\n注意：此任务不涉及角度；不需要角度单位。所有数值答案必须如上所述以米为单位。",
            "solution": "所提出的问题具有科学依据、提法恰当且客观。它呈现了三维点云数据分析中的一个标准任务，植根于空间泊松过程的统计特性以及特征提取算法的实际需求。所有必要的数据、模型和约束都已提供，并且它们内部一致且物理上合理。因此，该问题被认为是有效的，可以推导出一个完整的解决方案。\n\n核心目标是为一个以查询点 $p$ 为中心的球形邻域确定一个自适应半径 $r(p)$，使得该球体内的期望点数 $\\mathbb{E}[N(B_{r(p)})]$ 等于一个目标值 $m_{\\mathrm{target}}$。点云被建模为一个非齐次空间泊松过程，其局部估计强度为 $\\hat{\\lambda}(p)$。\n\n对于强度恒为 $\\lambda$ 的齐次空间泊松过程，其基本原理是体积 $V$ 内的期望点数由 $\\lambda V$ 给出。对于自适应半径选择，一个标准且有效的假设是，在足够小的球体内，可以用一个强度等于局部估计值 $\\hat{\\lambda}(p)$ 的齐次过程来近似该非齐次过程。因此，我们可以写出：\n$$\n\\mathbb{E}[N(B_{r(p)}) \\mid \\hat{\\lambda}(p)] \\approx \\hat{\\lambda}(p) \\, V(B_{r(p)})\n$$\n半径为 $r(p)$ 的三维球体的体积是 $V(B_{r(p)}) = \\frac{4}{3}\\pi [r(p)]^3$。将期望点数设为目标值 $m_{\\mathrm{target}}$，得到控制方程：\n$$\nm_{\\mathrm{target}} = \\hat{\\lambda}(p) \\left( \\frac{4}{3}\\pi [r(p)]^3 \\right)\n$$\n必须求解此方程以获得半径 $r(p)$。\n\n完整的算法包括三个主要步骤：强度钳制、半径计算和半径钳制。\n\n步骤1：有效强度计算\n为确保数值稳定并处理极低或极高点密度的物理上不切实际的情景，首先将估计强度 $\\hat{\\lambda}(p)$ 钳制在预定义范围 $[\\lambda_{\\min}, \\lambda_{\\max}]$ 内。有效强度 $\\hat{\\lambda}_{\\mathrm{eff}}(p)$ 由下式给出：\n$$\n\\hat{\\lambda}_{\\mathrm{eff}}(p) = \\min\\{\\max\\{\\hat{\\lambda}(p), \\lambda_{\\min}\\}, \\lambda_{\\max}\\}\n$$\n此步骤避免了除以一个接近零的强度（这会产生无限大的半径），并限制了过高密度区域的影响。\n\n步骤2：理想半径计算\n我们将 $\\hat{\\lambda}_{\\mathrm{eff}}(p)$ 代入我们的控制方程，并求解理想半径，我们将其简记为 $r(p)$：\n$$\nm_{\\mathrm{target}} = \\hat{\\lambda}_{\\mathrm{eff}}(p) \\left( \\frac{4}{3}\\pi [r(p)]^3 \\right)\n$$\n重新整理各项以分离出 $[r(p)]^3$：\n$$\n[r(p)]^3 = \\frac{3 \\, m_{\\mathrm{target}}}{4 \\pi \\hat{\\lambda}_{\\mathrm{eff}}(p)}\n$$\n对两边取立方根，得到理想半径的表达式：\n$$\nr(p) = \\left( \\frac{3 \\, m_{\\mathrm{target}}}{4 \\pi \\hat{\\lambda}_{\\mathrm{eff}}(p)} \\right)^{1/3}\n$$\n\n步骤3：最终半径钳制\n计算出的理想半径 $r(p)$ 可能仍然小于或大于后续处理步骤（例如PCA）的实际需求。因此，应用最后的钳制步骤，将半径约束在范围 $[r_{\\min}, r_{\\max}]$ 内。最终的自适应半径 $r_{\\mathrm{final}}(p)$ 为：\n$$\nr_{\\mathrm{final}}(p) = \\min\\{\\max\\{r(p), r_{\\min}\\}, r_{\\max}\\}\n$$\n\n应用于测试用例\n给定的常量为 $m_{\\mathrm{target}} = 50$，$r_{\\min} = 0.05$ 米，$r_{\\max} = 10.0$ 米，$\\lambda_{\\min} = 10^{-3}$ 点/立方米，以及 $\\lambda_{\\max} = 10^{5}$ 点/立方米。\n\n用例 A: $\\hat{\\lambda}(p) = 10^{-1}$\n1. $\\hat{\\lambda}_{\\mathrm{eff}}(p) = \\min\\{\\max\\{0.1, 10^{-3}\\}, 10^{5}\\} = 0.1$。\n2. $r(p) = \\left( \\frac{3 \\cdot 50}{4 \\pi \\cdot 0.1} \\right)^{1/3} = \\left( \\frac{150}{0.4\\pi} \\right)^{1/3} \\approx 4.923970$ 米。\n3. $r_{\\mathrm{final}}(p) = \\min\\{\\max\\{4.923970, 0.05\\}, 10.0\\} = 4.923970$ 米。\n\n用例 B: $\\hat{\\lambda}(p) = 1$\n1. $\\hat{\\lambda}_{\\mathrm{eff}}(p) = \\min\\{\\max\\{1, 10^{-3}\\}, 10^{5}\\} = 1$。\n2. $r(p) = \\left( \\frac{3 \\cdot 50}{4 \\pi \\cdot 1} \\right)^{1/3} = \\left( \\frac{150}{4\\pi} \\right)^{1/3} \\approx 2.285580$ 米。\n3. $r_{\\mathrm{final}}(p) = \\min\\{\\max\\{2.285580, 0.05\\}, 10.0\\} = 2.285580$ 米。\n\n用例 C: $\\hat{\\lambda}(p) = 10$\n1. $\\hat{\\lambda}_{\\mathrm{eff}}(p) = \\min\\{\\max\\{10, 10^{-3}\\}, 10^{5}\\} = 10$。\n2. $r(p) = \\left( \\frac{3 \\cdot 50}{4 \\pi \\cdot 10} \\right)^{1/3} = \\left( \\frac{150}{40\\pi} \\right)^{1/3} \\approx 1.060790$ 米。\n3. $r_{\\mathrm{final}}(p) = \\min\\{\\max\\{1.060790, 0.05\\}, 10.0\\} = 1.060790$ 米。\n\n用例 D: $\\hat{\\lambda}(p) = 10^{-6}$\n1. 初始值低于 $\\lambda_{\\min}$。$\\hat{\\lambda}_{\\mathrm{eff}}(p) = \\min\\{\\max\\{10^{-6}, 10^{-3}\\}, 10^{5}\\} = 10^{-3}$。\n2. $r(p) = \\left( \\frac{3 \\cdot 50}{4 \\pi \\cdot 10^{-3}} \\right)^{1/3} = \\left( \\frac{150}{0.004\\pi} \\right)^{1/3} \\approx 22.855802$ 米。\n3. 计算出的半径超过了 $r_{\\max}$。$r_{\\mathrm{final}}(p) = \\min\\{\\max\\{22.855802, 0.05\\}, 10.0\\} = 10.0$ 米。\n\n用例 E: $\\hat{\\lambda}(p) = 10^{4}$\n1. $\\hat{\\lambda}_{\\mathrm{eff}}(p) = \\min\\{\\max\\{10^{4}, 10^{-3}\\}, 10^{5}\\} = 10^{4}$。\n2. $r(p) = \\left( \\frac{3 \\cdot 50}{4 \\pi \\cdot 10^{4}} \\right)^{1/3} = \\left( \\frac{150}{40000\\pi} \\right)^{1/3} \\approx 0.106079$ 米。\n3. $r_{\\mathrm{final}}(p) = \\min\\{\\max\\{0.106079, 0.05\\}, 10.0\\} = 0.106079$ 米。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the adaptive neighborhood radius for 3D point clouds based on local density.\n    \"\"\"\n    # Define the constants from the problem statement.\n    m_target = 50\n    r_min = 0.05\n    r_max = 10.0\n    lambda_min = 1e-3\n    lambda_max = 1e5\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        1e-1,  # Case A\n        1.0,   # Case B\n        10.0,  # Case C\n        1e-6,  # Case D\n        1e4,   # Case E\n    ]\n\n    results = []\n    for lambda_hat in test_cases:\n        # Step 1: Apply clamping to the estimated intensity lambda_hat.\n        # This gives the effective intensity lambda_eff.\n        lambda_eff = min(max(lambda_hat, lambda_min), lambda_max)\n        \n        # Step 2: Calculate the ideal radius r(p) that yields m_target expected points.\n        # The formula is r(p) = (3 * m_target / (4 * pi * lambda_eff))^(1/3).\n        # Numerator of the fraction inside the cube root.\n        numerator = 3 * m_target\n        # Denominator of the fraction inside the cube root.\n        denominator = 4 * np.pi * lambda_eff\n        # The ideal radius calculation.\n        r_ideal = (numerator / denominator)**(1/3)\n        \n        # Step 3: Clamp the final radius to the range [r_min, r_max].\n        r_final = min(max(r_ideal, r_min), r_max)\n        \n        # Format the result to 6 decimal places and add to the list.\n        results.append(f\"{r_final:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在定义了局部邻域之后，下一步通常是计算几何特征，例如表面法向量，这通常通过主成分分析（PCA）来实现。然而，现实世界的数据并非完美无缺，遮挡等问题会导致邻域数据不完整。 该练习旨在探讨由数据采集过程中的系统性缺失（例如遮挡）如何导致基于PCA的法向量估计产生可预测的偏差。通过对这种偏差进行解析推导，您将更深刻地理解数据采集中的瑕疵如何传递并影响特征的准确性，这对于算法的误差分析和改进至关重要。",
            "id": "3844932",
            "problem": "一个激光雷达 (LiDAR) 点云在一个参考点附近对一个平滑的地形表面进行采样，该参考点的真实法线沿 $z$ 轴方向。在以该参考点为中心的一个局部标准正交坐标系中，表面高度可以很好地通过二阶泰勒展开 $z(x,y) = \\frac{1}{2} k x^{2}$ 来近似，其中 $k$ 是沿 $x$ 方向的主曲率，而在感兴趣的邻域内，沿 $y$ 方向的曲率可以忽略不计。主成分分析 (PCA) 被用来根据切平面 $(x,y)$ 上半径为 $R$ 的邻域内的点来估计局部法线，但该邻域因遮挡而被截断：点在极坐标下的一个扇形区域 $\\mathcal{D} = \\{(r,\\theta): 0 \\le r \\le R, -\\pi + \\phi \\le \\theta \\le \\pi - \\phi\\}$ 上被均匀采样，该区域排除了一个以 $x$ 轴负方向为中心、角宽度为 $2\\phi$ 的楔形区域（即，靠近 $\\theta = \\pi$ 的方向被遮挡）。PCA 使用距离权重 $w_{j} = w(\\rho_{j})$ 进行计算，该权重仅取决于每个点到参考原点的平面径向距离 $\\rho_{j}$；具体来说，设 $w(r) = r^{-\\alpha}$，其中 $0 \\le \\alpha  2$。\n\n从加权主成分分析 (WPCA) 中使用的协方差基本定义和平滑表面近似出发，推导因遮挡引起的截断而在参考点处产生的估计法线与真实法线之间的主阶小斜率偏置角 $\\theta_{b}$（以弧度为单位）。假设在曲率引起的斜率的主阶上，WPCA 法线与加权质心处的表面法线对齐。请将您的最终答案表示为关于 $k$、$R$、$\\phi$ 和 $\\alpha$ 的单个闭式解析表达式 $\\theta_{b}$，并以弧度为单位说明该角度。无需进行数值计算。",
            "solution": "该问题被认为是有效的，因为它具有科学依据、问题明确、客观且内部一致。\n\n问题的核心是确定由遮挡采样域引起的法向量估计偏差。该问题提供了一个关键的简化：通过加权主成分分析 (WPCA) 得到的估计法线，与在采样点的加权质心处计算的真实表面法线对齐。这使我们能够规避完整的 WPCA 计算，而专注于寻找该质心。\n\n表面局部近似为 $z(x,y) = \\frac{1}{2} k x^{2}$。原点 $(0,0,0)$ 处的真实法线沿 $z$ 轴方向，即 $\\vec{n}_{true} = (0, 0, 1)$。\n加权质心 $(\\bar{x}, \\bar{y}, \\bar{z})$ 由采样域 $\\mathcal{D}$ 上的积分定义。我们关心的是平面坐标 $(\\bar{x}, \\bar{y})$：\n$$ \\bar{x} = \\frac{\\iint_{\\mathcal{D}} x \\, w(x,y) \\, dA}{\\iint_{\\mathcal{D}} w(x,y) \\, dA} $$\n$$ \\bar{y} = \\frac{\\iint_{\\mathcal{D}} y \\, w(x,y) \\, dA}{\\iint_{\\mathcal{D}} w(x,y) \\, dA} $$\n采样域是一个扇形区域，在极坐标中给出为 $\\mathcal{D} = \\{(r,\\theta): 0 \\le r \\le R, -\\pi + \\phi \\le \\theta \\le \\pi - \\phi\\}$。权重函数仅取决于径向距离 $r$，即 $w(x,y) = w(r) = r^{-\\alpha}$。面积元为 $dA = r \\,dr\\,d\\theta$。\n\n首先，我们计算分母，即域 $\\mathcal{D}$ 上的总权重 $W_{tot}$。\n$$ W_{tot} = \\iint_{\\mathcal{D}} w(r) \\, dA = \\int_{-\\pi+\\phi}^{\\pi-\\phi} \\int_{0}^{R} r^{-\\alpha} \\cdot r \\, dr \\, d\\theta $$\n关于 $r$ 的积分为：\n$$ \\int_{0}^{R} r^{1-\\alpha} \\, dr = \\left[ \\frac{r^{2-\\alpha}}{2-\\alpha} \\right]_{0}^{R} = \\frac{R^{2-\\alpha}}{2-\\alpha} $$\n该积分收敛，因为问题指定 $0 \\le \\alpha  2$。\n关于 $\\theta$ 的积分为：\n$$ \\int_{-\\pi+\\phi}^{\\pi-\\phi} d\\theta = (\\pi-\\phi) - (-\\pi+\\phi) = 2\\pi - 2\\phi = 2(\\pi-\\phi) $$\n因此，总权重为：\n$$ W_{tot} = 2(\\pi-\\phi) \\frac{R^{2-\\alpha}}{2-\\alpha} $$\n\n接下来，我们计算 $\\bar{x}$ 和 $\\bar{y}$ 的分子。对于 $\\bar{y}$，我们代入 $y = r\\sin\\theta$：\n$$ N_y = \\iint_{\\mathcal{D}} y \\, w(r) \\, dA = \\int_{-\\pi+\\phi}^{\\pi-\\phi} \\int_{0}^{R} (r\\sin\\theta) \\, r^{-\\alpha} \\cdot r \\, dr \\, d\\theta $$\n$$ N_y = \\left( \\int_{0}^{R} r^{2-\\alpha} \\, dr \\right) \\left( \\int_{-\\pi+\\phi}^{\\pi-\\phi} \\sin\\theta \\, d\\theta \\right) $$\n$\\sin\\theta$ 的积分为 $[-\\cos\\theta]_{-\\pi+\\phi}^{\\pi-\\phi} = -\\cos(\\pi-\\phi) - (-\\cos(-\\pi+\\phi))$。因为 $\\cos$ 是偶函数，$\\cos(-\\pi+\\phi) = \\cos(\\pi-\\phi)$，所以结果为 $0$。因此，$N_y=0$ 且 $\\bar{y}=0$。由于域 $\\mathcal{D}$ 相对于 x 轴的对称性，这是预料之中的。\n\n对于 $\\bar{x}$，我们代入 $x = r\\cos\\theta$：\n$$ N_x = \\iint_{\\mathcal{D}} x \\, w(r) \\, dA = \\int_{-\\pi+\\phi}^{\\pi-\\phi} \\int_{0}^{R} (r\\cos\\theta) \\, r^{-\\alpha} \\cdot r \\, dr \\, d\\theta $$\n$$ N_x = \\left( \\int_{0}^{R} r^{2-\\alpha} \\, dr \\right) \\left( \\int_{-\\pi+\\phi}^{\\pi-\\phi} \\cos\\theta \\, d\\theta \\right) $$\n关于 $r$ 的积分为 $\\frac{R^{3-\\alpha}}{3-\\alpha}$，这对 $\\alpha  3$ 成立，而条件 $0 \\le \\alpha  2$ 满足该要求。关于 $\\theta$ 的积分为：\n$$ \\int_{-\\pi+\\phi}^{\\pi-\\phi} \\cos\\theta \\, d\\theta = [\\sin\\theta]_{-\\pi+\\phi}^{\\pi-\\phi} = \\sin(\\pi-\\phi) - \\sin(-\\pi+\\phi) $$\n使用三角恒等式，$\\sin(\\pi-\\phi) = \\sin\\phi$ 和 $\\sin(-\\pi+\\phi) = -\\sin(\\pi-\\phi) = -\\sin\\phi$。所以积分计算结果为 $\\sin\\phi - (-\\sin\\phi) = 2\\sin\\phi$。\n因此，$\\bar{x}$ 的分子为：\n$$ N_x = \\frac{R^{3-\\alpha}}{3-\\alpha} \\cdot 2\\sin\\phi $$\n\n现在我们可以计算加权质心的坐标 $\\bar{x}$：\n$$ \\bar{x} = \\frac{N_x}{W_{tot}} = \\frac{2\\sin\\phi \\frac{R^{3-\\alpha}}{3-\\alpha}}{2(\\pi-\\phi) \\frac{R^{2-\\alpha}}{2-\\alpha}} = R \\left( \\frac{2-\\alpha}{3-\\alpha} \\right) \\left( \\frac{\\sin\\phi}{\\pi-\\phi} \\right) $$\n加权质心位于 $xy$ 平面中的 $(\\bar{x}, 0) = \\left(R \\frac{2-\\alpha}{3-\\alpha} \\frac{\\sin\\phi}{\\pi-\\phi}, 0\\right)$。\n\n估计法线 $\\vec{n}_{est}$ 是在该点 $(\\bar{x}, \\bar{y})$ 处的表面法线。该表面可由水平集函数 $S(x,y,z) = z - \\frac{1}{2} k x^2 = 0$ 定义。法向量由梯度 $\\nabla S$ 给出：\n$$ \\vec{N}(x,y,z) = \\nabla S = \\left(\\frac{\\partial S}{\\partial x}, \\frac{\\partial S}{\\partial y}, \\frac{\\partial S}{\\partial z}\\right) = (-kx, 0, 1) $$\n在 $(x,y) = (\\bar{x}, 0)$ 处计算该值，我们得到估计的法向量：\n$$ \\vec{n}_{est} = (-k\\bar{x}, 0, 1) $$\n\n偏置角 $\\theta_b$ 是估计法线 $\\vec{n}_{est}$ 与真实法线 $\\vec{n}_{true} = (0,0,1)$ 之间的夹角。\n向量与 $z$ 轴的夹角可以用正切函数找到。向量 $\\vec{n}_{est}$ 位于 $xz$ 平面内。\n$$ \\tan(\\theta_b) = \\frac{|\\text{component perpendicular to } \\vec{n}_{true}|}{|\\text{component parallel to } \\vec{n}_{true}|} = \\frac{\\sqrt{(-k\\bar{x})^2 + 0^2}}{1} = |k\\bar{x}| $$\n问题要求的是主阶小斜率偏置角。小斜率对应于小曲率 $k$。对于小的 $|k\\bar{x}|$，我们可以使用近似 $\\tan(\\theta_b) \\approx \\theta_b$。\n因此，以弧度表示的偏置角由下式给出：\n$$ \\theta_b \\approx |k\\bar{x}| = \\left| k \\cdot R \\frac{2-\\alpha}{3-\\alpha} \\frac{\\sin\\phi}{\\pi-\\phi} \\right| $$\n由于 $R0$，$0 \\le \\phi  \\pi$，且 $0 \\le \\alpha  2$，除 $k$ 以外的所有项都是非负的。偏置角作为一个几何角度，是一个非负量。因此我们用 $|k|$ 来表示该表达式。\n\n$$ \\theta_b = |k| R \\frac{2-\\alpha}{3-\\alpha} \\frac{\\sin\\phi}{\\pi-\\phi} $$\n这是以弧度表示的主阶偏置角的最终表达式。",
            "answer": "$$ \\boxed{|k| R \\frac{2-\\alpha}{3-\\alpha} \\frac{\\sin(\\phi)}{\\pi - \\phi}} $$"
        },
        {
            "introduction": "任何语义分割任务的最后一步都是对分类器的性能进行严格评估。混淆矩阵是进行此类分析的基础工具，它详细展示了模型在不同类别上的预测表现。 这项实践将引导您超越简单的总体准确率计算，深入推导每个类别的精确率（precision）、召回率（recall）和 $F1$ 分数，这些指标对于理解模型在类别不平衡数据集上的行为至关重要。您将构建并分析一个考虑了真实世界中常见的边界模糊效应的混淆矩阵，从而学会如何剖析模型在不同语义类别上的优缺点。",
            "id": "3844924",
            "problem": "部署了一个光学雷达（LiDAR）语义分割流程，用于对在混合城市-河口地貌上采集的三维点云进行分类，分为四个语义类别：地面、植被、建筑和水体。考虑一次时间上一致的采集，使得采样密度和遮挡模式在整个场景中保持稳定。给定以下基于分类事件标准定义的科学上合理的设置：\n\n- 共有 $4$ 个类别：$C_{1}$（地面）、$C_{2}$（植被）、$C_{3}$（建筑）和 $C_{4}$（水体）。\n- 真实的类别计数为：$N_{1} = 5000$， $N_{2} = 8000$， $N_{3} = 3000$， $N_{4} = 4000$。\n- 一个基线分类器为每个真实类别生成了以下预测标签的计数（行索引表示真实类别，列索引按 $C_{1},C_{2},C_{3},C_{4}$ 的顺序表示预测类别）：\n  - 对于 $C_{1}$：$[4600, 200, 150, 50]$。\n  - 对于 $C_{2}$：$[300, 7200, 200, 300]$。\n  - 对于 $C_{3}$：$[100, 120, 2700, 80]$。\n  - 对于 $C_{4}$：$[50, 250, 100, 3600]$。\n\n环境边界（例如，植被-水体过渡带、地面-建筑边缘）会为那些局部邻域跨越异质材料的点带来额外的标签模糊性。经验性实地测绘表明，边界效应表现为将一些对角线（正确）预测重新分布到最易混淆的相邻类别中。将这种由边界引起的重新分布建模为以下从基线矩阵对角线到其非对角线的逐行重新分配：\n\n- 从被正确预测的 $C_{1}$ 点中，将 $60$ 个重新分配给 $C_{2}$，将 $40$ 个重新分配给 $C_{3}$，将 $20$ 个重新分配给 $C_{4}$。\n- 从被正确预测的 $C_{2}$ 点中，将 $80$ 个重新分配给 $C_{1}$，将 $60$ 个重新分配给 $C_{3}$，将 $60$ 个重新分配给 $C_{4}$。\n- 从被正确预测的 $C_{3}$ 点中，将 $30$ 个重新分配给 $C_{1}$，将 $40$ 个重新分配给 $C_{2}$，将 $20$ 个重新分配给 $C_{4}$。\n- 从被正确预测的 $C_{4}$ 点中，将 $40$ 个重新分配给 $C_{1}$，将 $80$ 个重新分配给 $C_{2}$，将 $40$ 个重新分配给 $C_{3}$。\n\n任务：\n1. 构建基线混淆矩阵和受边界影响的混淆矩阵，确保每行的总和等于相应的真实类别计数 $N_{k}$，并且总计数等于 $N_{1}+N_{2}+N_{3}+N_{4}$。\n2. 仅使用分类事件和度量指标的核心定义，为受边界影响的混淆矩阵推导出每个类别 $C_{k}$ 的精确率、召回率和 $F1$-分数，其中精确率、召回率和 $F1$-分数由真正例、假正例和假反例定义。\n3. 利用混淆矩阵的结构，解释边界点如何通过增加非对角线项以及假正例和假反例的相应变化来改变每个类别的这些度量指标。\n4. 最后，计算受边界影响混淆矩阵的宏平均 $F1$-分数（各类别 $F1$-分数的算术平均值）。将你的最终答案表示为单个精确分数或封闭形式的解析表达式。不要四舍五入。最终答案必须是这个宏平均 $F1$-分数。",
            "solution": "对问题陈述进行验证。\n\n提取给定的信息如下：\n- 共有 $4$ 个类别，表示为 $C_{k}$，其中 $k \\in \\{1, 2, 3, 4\\}$。\n- 真实的类别计数（每个类别的点数）为 $N_{1} = 5000$， $N_{2} = 8000$， $N_{3} = 3000$ 和 $N_{4} = 4000$。总点数为 $N = N_{1}+N_{2}+N_{3}+N_{4} = 20000$。\n- 基线分类器的性能由混淆矩阵的行给出，其中行是真实类别，列是预测类别：\n  - 对于真实类别 $C_{1}$：$[4600, 200, 150, 50]$。行和：$4600+200+150+50 = 5000 = N_{1}$。\n  - 对于真实类别 $C_{2}$：$[300, 7200, 200, 300]$。行和：$300+7200+200+300 = 8000 = N_{2}$。\n  - 对于真实类别 $C_{3}$：$[100, 120, 2700, 80]$。行和：$100+120+2700+80 = 3000 = N_{3}$。\n  - 对于真实类别 $C_{4}$：$[50, 250, 100, 3600]$。行和：$50+250+100+3600 = 4000 = N_{4}$。\n- 边界效应导致正确分类的点（对角线元素）重新分布到同一行内的非对角线元素：\n  - 从 $C_{1}$：$60$ 个点到 $C_{2}$， $40$ 个到 $C_{3}$， $20$ 个到 $C_{4}$。总移动数：$120$。\n  - 从 $C_{2}$：$80$ 个点到 $C_{1}$， $60$ 个到 $C_{3}$， $60$ 个到 $C_{4}$。总移动数：$200$。\n  - 从 $C_{3}$：$30$ 个点到 $C_{1}$， $40$ 个到 $C_{2}$， $20$ 个到 $C_{4}$。总移动数：$90$。\n  - 从 $C_{4}$：$40$ 个点到 $C_{1}$， $80$ 个到 $C_{2}$， $40$ 个到 $C_{3}$。总移动数：$160$。\n\n验证检查确认该问题在遥感和机器学习分类领域具有科学依据。所提供的数据是自洽的，因为基线预测的行和与真实类别计数相匹配。边界效应被描述为一组保持行和不变的操作，这在逻辑上是一致的。该问题定义明确、客观，并包含足够的信息以得出唯一解。未检测到任何缺陷。该问题被认为是有效的。\n\n解题过程如下。\n\n**1. 构建混淆矩阵**\n\n对于一个 $K$ 类问题，混淆矩阵 $M$ 是一个大小为 $K \\times K$ 的方阵，其中条目 $M_{ij}$ 是真实类别为 $C_i$ 但被预测为类别 $C_j$ 的观测数量。\n\n基线混淆矩阵 $M_{base}$ 直接由提供的计数构建：\n$$\nM_{base} = \\begin{pmatrix}\n4600  200  150  50 \\\\\n300  7200  200  300 \\\\\n100  120  2700  80 \\\\\n50  250  100  3600\n\\end{pmatrix}\n$$\n如验证期间所核实，每行 $k$ 的和等于相应的真实类别计数 $N_k$。所有条目的总和为 $N = 20000$。\n\n受边界影响的混淆矩阵 $M_{bound}$ 是通过将指定的重新分布应用于 $M_{base}$ 得到的。对于每一行 $k$，我们从对角线元素 $M_{kk}$ 中减去重新分配的总点数，并将它们加到相应的非对角线元素 $M_{kj}$ ($j \\neq k$) 上。\n\n对于第 1 行 (真实 $C_1$):\n- 对角线：$4600 - (60+40+20) = 4600 - 120 = 4480$。\n- 非对角线：$M_{12} \\to 200+60=260$；$M_{13} \\to 150+40=190$；$M_{14} \\to 50+20=70$。\n- 新的第 1 行：$[4480, 260, 190, 70]$。行和：$5000 = N_1$。\n\n对于第 2 行 (真实 $C_2$):\n- 对角线：$7200 - (80+60+60) = 7200 - 200 = 7000$。\n- 非对角线：$M_{21} \\to 300+80=380$；$M_{23} \\to 200+60=260$；$M_{24} \\to 300+60=360$。\n- 新的第 2 行：$[380, 7000, 260, 360]$。行和：$8000 = N_2$。\n\n对于第 3 行 (真实 $C_3$):\n- 对角线：$2700 - (30+40+20) = 2700 - 90 = 2610$。\n- 非对角线：$M_{31} \\to 100+30=130$；$M_{32} \\to 120+40=160$；$M_{34} \\to 80+20=100$。\n- 新的第 3 行：$[130, 160, 2610, 100]$。行和：$3000 = N_3$。\n\n对于第 4 行 (真实 $C_4$):\n- 对角线：$3600 - (40+80+40) = 3600 - 160 = 3440$。\n- 非对角线：$M_{41} \\to 50+40=90$；$M_{42} \\to 250+80=330$；$M_{43} \\to 100+40=140$。\n- 新的第 4 行：$[90, 330, 140, 3440]$。行和：$4000 = N_4$。\n\n得到的受边界影响的混淆矩阵是：\n$$\nM_{bound} = \\begin{pmatrix}\n4480  260  190  70 \\\\\n380  7000  260  360 \\\\\n130  160  2610  100 \\\\\n90  330  140  3440\n\\end{pmatrix}\n$$\n行和保持不变，总和仍为 $20000$。\n\n**2. $M_{bound}$ 的各类别分类度量**\n\n对于每个类别 $C_k$，我们计算真正例 ($TP_k$)、假正例 ($FP_k$) 和假反例 ($FN_k$)。\n- $TP_k = M_{bound, kk}$ (对角线元素)。\n- $FP_k = (\\sum_{i=1}^{4} M_{bound, ik}) - TP_k$ (列和减去对角线元素)。\n- $FN_k = (\\sum_{j=1}^{4} M_{bound, kj}) - TP_k = N_k - TP_k$ (行和减去对角线元素)。\n\n度量指标定义如下：\n- 精确率：$P_k = \\frac{TP_k}{TP_k + FP_k}$\n- 召回率：$R_k = \\frac{TP_k}{TP_k + FN_k}$\n- $F1$-分数：$F1_k = 2 \\frac{P_k R_k}{P_k + R_k} = \\frac{2TP_k}{2TP_k + FP_k + FN_k}$\n\n首先，我们计算 $M_{bound}$ 的列和：\n- 第 1 列和：$4480+380+130+90 = 5080$。\n- 第 2 列和：$260+7000+160+330 = 7750$。\n- 第 3 列和：$190+260+2610+140 = 3200$。\n- 第 4 列和：$70+360+100+3440 = 3970$。\n\n现在，我们计算每个类别的度量指标：\n\n- **类别 $C_1$ (地面):**\n  $TP_1 = 4480$。\n  $FP_1 = 5080 - 4480 = 600$。\n  $FN_1 = 5000 - 4480 = 520$。\n  $P_1 = \\frac{4480}{5080} = \\frac{112}{127}$。\n  $R_1 = \\frac{4480}{5000} = \\frac{112}{125}$。\n  $F1_1 = \\frac{2 \\times 4480}{2 \\times 4480 + 600 + 520} = \\frac{8960}{8960 + 1120} = \\frac{8960}{10080} = \\frac{896}{1008} = \\frac{8}{9}$。\n\n- **类别 $C_2$ (植被):**\n  $TP_2 = 7000$。\n  $FP_2 = 7750 - 7000 = 750$。\n  $FN_2 = 8000 - 7000 = 1000$。\n  $P_2 = \\frac{7000}{7750} = \\frac{28}{31}$。\n  $R_2 = \\frac{7000}{8000} = \\frac{7}{8}$。\n  $F1_2 = \\frac{2 \\times 7000}{2 \\times 7000 + 750 + 1000} = \\frac{14000}{14000 + 1750} = \\frac{14000}{15750} = \\frac{1400}{1575} = \\frac{56}{63} = \\frac{8}{9}$。\n\n- **类别 $C_3$ (建筑):**\n  $TP_3 = 2610$。\n  $FP_3 = 3200 - 2610 = 590$。\n  $FN_3 = 3000 - 2610 = 390$。\n  $P_3 = \\frac{2610}{3200} = \\frac{261}{320}$。\n  $R_3 = \\frac{2610}{3000} = \\frac{261}{300} = \\frac{87}{100}$。\n  $F1_3 = \\frac{2 \\times 2610}{2 \\times 2610 + 590 + 390} = \\frac{5220}{5220 + 980} = \\frac{5220}{6200} = \\frac{522}{620} = \\frac{261}{310}$。\n\n- **类别 $C_4$ (水体):**\n  $TP_4 = 3440$。\n  $FP_4 = 3970 - 3440 = 530$。\n  $FN_4 = 4000 - 3440 = 560$。\n  $P_4 = \\frac{3440}{3970} = \\frac{344}{397}$。\n  $R_4 = \\frac{3440}{4000} = \\frac{344}{400} = \\frac{43}{50}$。\n  $F1_4 = \\frac{2 \\times 3440}{2 \\times 3440 + 530 + 560} = \\frac{6880}{6880 + 1090} = \\frac{6880}{7970} = \\frac{688}{797}$。\n\n**3. 解释边界效应对度量指标变化的影响**\n\n边界引起的重新分布仅将点从正确的分类移动到不正确的分类。让我们对任意类别 $C_k$ 进行分析。\n- **真正例** ($TP_k=M_{kk}$) 的计数被明确减少，因为点从对角线被重新分配。\n- **假反例** ($FN_k$) 的计数是第 $k$ 行中非对角线元素的总和 ($FN_k = \\sum_{j \\neq k} M_{kj}$)。由于点从 $M_{kk}$ 移动到 $M_{kj}$ ($j \\neq k$)， $FN_k$ 的增加量恰好等于 $TP_k$ 的减少量。\n- **假正例** ($FP_k$) 的计数是第 $k$ 列中非对角线元素的总和 ($FP_k = \\sum_{i \\neq k} M_{ik}$)。问题陈述指出，对于每个类别 $C_i$，其部分正确分类的点被重新分配给其他类别，包括 $C_k$。这意味着对于 $i \\neq k$ 的条目 $M_{ik}$ 会增加。因此，所有类别的 $FP_k$ 都会增加。\n\n这些变化直接影响度量指标：\n- **召回率**，$R_k = \\frac{TP_k}{TP_k + FN_k} = \\frac{TP_k}{N_k}$。由于 $TP_k$ 减少而分母 $N_k$ 是常数，所以每个类别的召回率都会下降。\n- **精确率**，$P_k = \\frac{TP_k}{TP_k + FP_k}$。分子 $TP_k$ 减少，而分母项 $FP_k$ 增加。这两个因素都导致比率减小，所以每个类别的精确率都会下降。\n- **$F1$-分数**，$F1_k$，是精确率和召回率的调和平均值。由于 $P_k$ 和 $R_k$ 都下降，它们的调和平均值也必然下降。所建模的边界效应明确地降低了分类器对每个类别的性能。\n\n**4. 宏平均 F1-分数**\n\n宏平均 $F1$-分数 $F1_{macro}$ 是各类别 $F1$-分数的算术平均值。\n$$\nF1_{macro} = \\frac{1}{4} \\sum_{k=1}^{4} F1_k = \\frac{1}{4} (F1_1 + F1_2 + F1_3 + F1_4)\n$$\n代入计算出的值：\n$$\nF1_{macro} = \\frac{1}{4} \\left( \\frac{8}{9} + \\frac{8}{9} + \\frac{261}{310} + \\frac{688}{797} \\right) = \\frac{1}{4} \\left( \\frac{16}{9} + \\frac{261}{310} + \\frac{688}{797} \\right)\n$$\n为了将它们合并成一个单独的分数，我们找到一个公分母。分母是 $9=3^2$，$310=2 \\times 5 \\times 31$，和 $797$（这是一个素数）。最小公倍数是 $9 \\times 310 \\times 797 = 2223630$。\n$$\nF1_{macro} = \\frac{1}{4} \\left( \\frac{16 \\times (310 \\times 797)}{2223630} + \\frac{261 \\times (9 \\times 797)}{2223630} + \\frac{688 \\times (9 \\times 310)}{2223630} \\right)\n$$\n$$\nF1_{macro} = \\frac{1}{4} \\left( \\frac{16 \\times 247070}{2223630} + \\frac{261 \\times 7173}{2223630} + \\frac{688 \\times 2790}{2223630} \\right)\n$$\n$$\nF1_{macro} = \\frac{1}{4} \\left( \\frac{3953120 + 1872153 + 1919520}{2223630} \\right)\n$$\n$$\nF1_{macro} = \\frac{1}{4} \\left( \\frac{7744793}{2223630} \\right)\n$$\n$$\nF1_{macro} = \\frac{7744793}{4 \\times 2223630} = \\frac{7744793}{8894520}\n$$\n分子和分母没有共同的素数因子，所以这个分数是最简形式。",
            "answer": "$$\n\\boxed{\\frac{7744793}{8894520}}\n$$"
        }
    ]
}