{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将回归基本原理。我们将从达西定律（Darcy's Law）和质量守恒等第一性原理出发，推导用于计算积水时间的格林-安普特（Green-Ampt）模型。这项实践旨在巩固关于土壤特性和降雨强度如何相互作用并引发地表积水这一过程的理论基础，而地表积水是形成径流的关键第一步。",
            "id": "3843274",
            "problem": "一个小型农业像元（$30\\,\\mathrm{m} \\times 30\\,\\mathrm{m}$）由多个遥感平台和产品进行监测。需要一个基于物理的入渗模型来确定在恒定降雨事件下地表积水的开始时间。假设入渗发生在均质土壤中，遵循 Green-Ampt (GA) 锐利湿润锋假设。以下参数是根据遥感输入估算的：通过合成孔径雷达（SAR）后向散射反演得到的初始体积含水量 $\\theta_i$，通过土地覆盖约束的孔隙度图得到的饱和体积含水量 $\\theta_s$，通过高光谱影像反演的土壤质地类别结合土壤转换函数得到的有效湿润鋒毛管吸力水头 $\\psi_f$，以及通过同化了基于激光雷达（LiDAR）地形指标的数字土壤图得到的饱和导水率 $K_s$。恒定的降雨强度 $i$ 由天气雷达产品提供。\n\n在 GA 假设下，将入渗视为进入均匀土壤的一维垂直流，在深度 $z_f(t)$ 处有一个锐利湿润锋，它将上方的饱和层与下方初始非饱和层分开，并假设在积水瞬间之前的地表积水水头为零。从饱和流的达西通量表达式和水量守恒出发，从第一性原理推导在恒定降雨强度 $i$ 下，积水时间 $t_p$ 作为 $K_s$、$\\psi_f$、$\\theta_s$、$\\theta_i$ 和 $i$ 的函数表达式。请明确说明推导中所需的任何中间物理关系。\n\n然后，使用遥感输入（以一致单位表示）：\n- $K_s = 12\\,\\mathrm{mm\\,h^{-1}}$，\n- $\\psi_f = 120\\,\\mathrm{mm}$，\n- $\\theta_s = 0.45$，\n- $\\theta_i = 0.15$，\n- $i = 20\\,\\mathrm{mm\\,h^{-1}}$，\n\n计算 $t_p$ 的数值。\n\n最后，在积水前地表水头为零的相同 GA 假设下，评估条件 $i > K_s$ 对于积水是否是必要的。设 $N$ 为该陈述的数值真值，如果陈述“$i > K_s$ 是积水发生的必要条件”在这些假设下为真，则 $N=1$，否则 $N=0$。计算 $N$。\n\n答案规格：\n- 以小时为单位表示最终的积水时间。\n- 将所有数值答案四舍五入到三位有效数字。\n- 将您的最终答案报告为两个数字：积水时间 $t_p$ 和指示符 $N$。",
            "solution": "该问题要求一个三部分的解答：首先，从第一性原理出发，推导 Green-Ampt (GA) 模型下的积水时间 $t_p$ 的表达式；其次，根据一组给定的参数计算 $t_p$ 的数值；第三，评估条件 $i > K_s$ 对于发生积水是否是必要的。\n\n### 第1部分：积水时间 ($t_p$) 的推导\n\n推导从将达西定律应用于湿润土柱开始，并结合质量守恒原理。\n\n**1. 达西定律和入渗能力**\n\nGreen-Ampt 模型将入渗过程概念化为活塞流，其中一个锐利湿润锋以深度 $z_f(t)$ 向下移动到均质土壤中。湿润锋上方的土层假定为完全饱和。根据达西定律，并考虑重力梯度和湿润锋处的毛管吸力梯度，入渗能力 $f_c(t)$（即土壤吸收水分的最大速率）可以表示为：\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{z_f(t)}\\right)$$\n其中 $z_f(t)$ 是时间 $t$ 的湿润锋深度。该公式表明，入渗能力由重力驱动的部分（由 $K_s$ 体现）和毛管吸力驱动的部分（由 $\\psi_f/z_f(t)$ 体现）组成。\n\n**2. 质量守恒**\n\n单位面积的累积入渗水量 $F(t)$ 必须等于土壤剖面中直到湿润锋深度的储水量增加。这由体积含水量的变化与湿润锋深度的乘积给出：\n$$F(t) = (\\theta_s - \\theta_i) z_f(t)$$\n令 $\\Delta\\theta = \\theta_s - \\theta_i$。然后我们可以用累积入渗量 $F(t)$ 来表示湿润锋深度 $z_f(t)$：\n$$z_f(t) = \\frac{F(t)}{\\Delta\\theta}$$\n\n**3. 组合与求解积水时间**\n\n通过将质量守恒得到的 $z_f(t)$ 表达式代入入渗能力 $f_c(t)$ 的方程，我们得到：\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{F(t) / \\Delta\\theta}\\right) = K_s \\left(1 + \\frac{\\psi_f \\Delta\\theta}{F(t)}\\right)$$\n该方程将土壤的入渗能力与已经入渗的总水量联系起来。\n\n积水在时间 $t_p$ 开始，此时恒定的降雨强度 $i$ 首次等于土壤递减的入渗能力。对于任何时间 $t  t_p$，土壤可以吸收所有降雨，所以实际入渗率是 $f(t) = i$。因此，在任何时间 $t \\le t_p$ 的累积入渗量为：\n$$F(t) = \\int_0^t f(\\tau) d\\tau = \\int_0^t i \\, d\\tau = i t$$\n在积水发生的特定时刻 $t = t_p$，我们有两个条件：\n1. 入渗率等于降雨强度：$f(t_p) = i$。\n2. 入渗率等于入渗能力：$f(t_p) = f_c(t_p)$。\n\n将这些结合起来得到积水条件：$i = f_c(t_p)$。\n将此条件和 $F(t_p) = i t_p$ 代入我们关于 $f_c(t)$ 的表达式：\n$$i = K_s \\left(1 + \\frac{\\psi_f \\Delta\\theta}{F(t_p)}\\right) = K_s \\left(1 + \\frac{\\psi_f \\Delta\\theta}{i t_p}\\right)$$\n现在我们可以解出积水时间 $t_p$：\n$$\\frac{i}{K_s} = 1 + \\frac{\\psi_f \\Delta\\theta}{i t_p}$$\n$$\\frac{i}{K_s} - 1 = \\frac{\\psi_f \\Delta\\theta}{i t_p}$$\n$$\\frac{i - K_s}{K_s} = \\frac{\\psi_f \\Delta\\theta}{i t_p}$$\n$$t_p = \\frac{K_s \\psi_f \\Delta\\theta}{i (i - K_s)}$$\n这是推导出的积水时间 $t_p$ 作为给定参数的函数表达式。\n\n### 第2部分：$t_p$ 的数值计算\n\n问题提供了以下数值：\n- $K_s = 12\\,\\mathrm{mm\\,h^{-1}}$\n- $\\psi_f = 120\\,\\mathrm{mm}$\n- $\\theta_s = 0.45$\n- $\\theta_i = 0.15$\n- $i = 20\\,\\mathrm{mm\\,h^{-1}}$\n\n首先，我们计算体积含水量的变化 $\\Delta\\theta$：\n$$\\Delta\\theta = \\theta_s - \\theta_i = 0.45 - 0.15 = 0.30$$\n所有参数的单位都是一致的（$\\mathrm{mm}$, $\\mathrm{h}$）。将这些值代入推导出的 $t_p$ 表达式中：\n$$t_p = \\frac{(12\\,\\mathrm{mm\\,h^{-1}}) \\cdot (120\\,\\mathrm{mm}) \\cdot (0.30)}{(20\\,\\mathrm{mm\\,h^{-1}}) \\cdot (20\\,\\mathrm{mm\\,h^{-1}} - 12\\,\\mathrm{mm\\,h^{-1}})}$$\n$$t_p = \\frac{12 \\cdot 120 \\cdot 0.3}{20 \\cdot 8} \\, \\mathrm{h}$$\n$$t_p = \\frac{432}{160} \\, \\mathrm{h}$$\n$$t_p = 2.7 \\, \\mathrm{h}$$\n四舍五入到三位有效数字，积水时间为 $t_p = 2.70 \\, \\mathrm{h}$。\n\n### 第3部分：条件 $i > K_s$ 的评估\n\n问题询问在指定的 GA 假设下，条件 $i > K_s$ 是否是积水发生的必要条件。\n\n土壤的入渗能力由下式给出：\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{z_f(t)}\\right)$$\n随着入渗的进行，湿润锋深度 $z_f(t)$ 随时间增加。项 $\\psi_f / z_f(t)$ 始终为正，并随着 $t$ 的增加而减小。\n因此，入渗能力 $f_c(t)$ 是时间的单调递减函数。\n\n让我们检查它的极限：\n- 当 $t \\to 0^+$ 时，$z_f \\to 0^+$，且 $f_c(t) \\to \\infty$。初始入渗能力理论上是无限的。\n- 当 $t \\to \\infty$ 时，$z_f \\to \\infty$，且 $f_c(t) \\to K_s \\left(1 + 0\\right) = K_s$。入渗能力从上方渐近趋近于饱和导水率。\n\n当降雨供给率 $i$ 超过土壤的入渗能力 $f_c(t)$ 时，发生积水。\n\n**情况1：$i > K_s$**\n降雨率 $i$ 是一个恒定值，大于渐进入渗能力 $K_s$。由于 $f_c(t)$ 从一个大于 $i$ 的值（理论上是无限的）开始，并减小到一个小于 $i$ 的值（渐近于 $K_s$），因此必然存在一个有限的时间 $t_p$，使得 $f_c(t_p) = i$。对于所有 $t > t_p$，我们将有 $f_c(t)  i$，导致水在地表积聚。因此，发生积水。\n\n**情况2：$i \\le K_s$**\n降雨率 $i$ 小于或等于最小可能的入渗能力 $K_s$。对于任何有限时间 $t > 0$，湿润深度 $z_f(t)$ 是有限的，这意味着 $\\psi_f/z_f(t) > 0$。因此，入渗能力总是严格大于 $K_s$：\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{z_f(t)}\\right) > K_s$$\n既然我们给定 $i \\le K_s$，那么对于所有时间 $t$，$f_c(t) > i$。土壤吸水的能力总是大于供给率。积水将永远不会发生。\n\n因此，在 Green-Ampt 土壤中，在恒定降雨率 $i$ 下要发生积水，条件 $i > K_s$ 是必要的。问题中的陈述是正确的。数值真值为 $N=1$。这也与推导出的 $t_p$ 公式一致，因为 $i \\le K_s$ 会导致 $t_p$ 为非正值或无定义，这在物理上没有意义，并表明没有积水。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.70  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在之前练习的基础上，我们现在引入另一个关键的景观要素：植被冠层。本练习将演示如何将一个简单的冠层截留模型（使用遥感反演的叶面积指数 $LAI$ 进行参数化）与我们的入渗模型相结合。你将通过计算来量化森林如何延迟径流的产生，这是一种至关重要的生态系统服务。",
            "id": "3843182",
            "problem": "一个森林像元的特征是，从星载多光谱观测中反演得到的叶面积指数 (LAI) 为 $\\mathrm{LAI} = 5.2$。对于短历时风暴，假设冠层的行为如同一个桶，其最大蓄水能力与 LAI 成正比，使得冠层蓄水能力为 $S_{c}$（单位：毫米），且 $S_{c}$ 与 LAI 呈线性关系，比例系数为 $\\alpha = 0.4$ 毫米/单位LAI。忽略降雨事件期间的蒸发和茎流，并假设在冠层蓄水饱和之前没有穿透雨；一旦饱和，穿透雨量即等于入射降雨强度。\n\n一场强度恒为 $i = 30$ 毫米/小时的风暴持续了 $40$ 分钟。下伏土壤在潜在积水条件下的入渗过程遵循 Green-Ampt 概念模型，其饱和导水率为 $K_{s} = 12$ 毫米/小时，湿润锋毛管吸力水头为 $\\psi_{f} = 60$ 毫米，湿润锋前后的含水量变化为 $\\Delta \\theta = 0.18$。土壤表面初始未积水，在积水发生前，入渗率等于到达土壤表面的供水速率。\n\n仅使用冠层水量平衡的质量守恒原理和 Green-Ampt 入渗与积水概念模型，计算：\n- 经截留后，整个事件期间到达地面的总有效降雨深度，以及\n- 相对于接收相同降雨过程线的裸土表面，相应的积水时间变化。\n\n给出所有必要的推导过程，并说明您进行的任何额外的一致性检查。以分钟为单位表示积水时间的变化作为最终答案，并将最终答案四舍五入至四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是具有科学依据、良定且自洽的。所有必要的参数和概念模型（冠层截留桶模型，Green-Ampt 入渗）均已提供，并且是水文学中的标准模型。参数值在物理上是现实的。该问题按所述是可解的。\n\n求解过程分为两个主要部分：首先，分析冠层水量平衡，以确定到达土壤表面的有效降雨；其次，应用 Green-Ampt 模型，计算裸土表面和森林覆盖表面的积水时间。\n\n**第 1 部分：冠层截留与有效降雨**\n\n此部分的已知条件是：\n- 叶面积指数：$\\mathrm{LAI} = 5.2$\n- 冠层蓄水比例系数：$\\alpha = 0.4$ 毫米/单位LAI\n- 降雨强度：$i = 30$ 毫米/小时\n- 风暴历时：$T_{d} = 40$ 分钟\n\n首先，我们计算冠层蓄水能力 $S_{c}$。它被给定为 LAI 的线性函数。\n$$S_{c} = \\alpha \\times \\mathrm{LAI}$$\n$$S_{c} = 0.4 \\frac{\\text{mm}}{\\mathrm{LAI}} \\times 5.2 = 2.08 \\text{ mm}$$\n\n问题陈述表明，在冠层蓄水被填满之前没有穿透雨发生。在恒定降雨强度 $i$ 下，填满该蓄水所需的时间 $t_{\\text{fill}}$ 为：\n$$t_{\\text{fill}} = \\frac{S_{c}}{i} = \\frac{2.08 \\text{ mm}}{30 \\text{ mm/hr}} = 0.069333... \\text{ hr}$$\n\n风暴历时给定为 $T_{d} = 40$ 分钟，相当于 $\\frac{40}{60} = \\frac{2}{3}$ 小时，或约 $0.6667$ 小时。由于 $t_{\\text{fill}}  T_{d}$，冠层将会饱和，并在风暴的剩余时间里发生穿透雨。\n\n事件期间的总降雨深度 $P_{\\text{total}}$ 为：\n$$P_{\\text{total}} = i \\times T_{d} = 30 \\frac{\\text{mm}}{\\text{hr}} \\times \\left(\\frac{40}{60} \\text{ hr}\\right) = 20 \\text{ mm}$$\n\n到达地面的总有效降雨深度 $P_{e}$ 是总降雨量减去被截留并储存在冠层中的水量（因为蒸发被忽略）。\n$$P_{e} = P_{\\text{total}} - S_{c} = 20 \\text{ mm} - 2.08 \\text{ mm} = 17.92 \\text{ mm}$$\n这是问题要求计算的第一个量。\n\n**第 2 部分：入渗与积水时间**\n\nGreen-Ampt 模型的已知条件是：\n- 饱和导水率：$K_{s} = 12$ 毫米/小时\n- 湿润锋毛管吸力水头：$\\psi_{f} = 60$ 毫米\n- 湿润锋处的含水量变化：$\\Delta\\theta = 0.18$\n\nGreen-Ampt 方程中，潜入渗率 $f_{p}(t)$ 作为累积入渗量 $F(t)$ 的函数表示为：\n$$f_{p}(t) = K_{s} \\left(1 + \\frac{\\psi_{f} \\Delta\\theta}{F(t)}\\right)$$\n\n当潜入渗率下降至地表供水速率时，积水在时间 $t_{p}$ 发生。积水前，实际入渗率 $f(t)$ 等于供水速率，累积入渗量为 $F(t) = \\int_{0}^{t} f(\\tau) d\\tau$。\n\n**情况 A：裸土**\n对于裸土表面，从 $t=0$ 开始，供水速率即为降雨强度 $i = 30$ 毫米/小时。只有当 $i > K_{s}$ 时才可能发生积水。此处，$30 \\text{ 毫米/小时} > 12 \\text{ 毫米/小时}$，因此会发生积水。\n在积水发生的时刻 $t_{p, \\text{bare}}$，潜入渗率等于供水速率：\n$$f_{p}(t_{p, \\text{bare}}) = i$$\n积水前，$F(t) = i \\times t$。因此，在积水时，$F(t_{p, \\text{bare}}) = i \\times t_{p, \\text{bare}}$。将此代入 Green-Ampt 方程：\n$$i = K_{s} \\left(1 + \\frac{\\psi_{f} \\Delta\\theta}{i \\times t_{p, \\text{bare}}}\\right)$$\n求解 $t_{p, \\text{bare}}$：\n$$\\frac{i}{K_{s}} - 1 = \\frac{\\psi_{f} \\Delta\\theta}{i \\times t_{p, \\text{bare}}}$$\n$$t_{p, \\text{bare}} = \\frac{\\psi_{f} \\Delta\\theta}{i \\left(\\frac{i}{K_{s}} - 1\\right)} = \\frac{K_{s} \\psi_{f} \\Delta\\theta}{i(i - K_{s})}$$\n代入数值：\n$$t_{p, \\text{bare}} = \\frac{(12 \\text{ mm/hr})(60 \\text{ mm})(0.18)}{(30 \\text{ mm/hr})(30 \\text{ mm/hr} - 12 \\text{ mm/hr})} = \\frac{129.6}{30 \\times 18} = \\frac{129.6}{540} = 0.24 \\text{ hr}$$\n以分钟为单位，$t_{p, \\text{bare}} = 0.24 \\text{ 小时} \\times 60 \\text{ 分钟/小时} = 14.4 \\text{ 分钟}$。\n\n**情况 B：森林土壤**\n对于森林土壤，在最初的 $t_{\\text{fill}}$ 时段内，水不会到达地面。对土壤表面的供水从 $t = t_{\\text{fill}}$ 开始，供水速率为有效降雨强度，即等于降雨强度 $i = 30$ 毫米/小时。\n土壤表面的入渗过程与裸土情况相同，但延迟了 $t_{\\text{fill}}$。因此，从有效降雨开始到发生积水所需的时间与 $t_{p, \\text{bare}}$ 相同。\n设 $t_{p, \\text{forested}}$ 为从风暴开始（$t=0$）算起的绝对积水时间。这将是填满冠层的时间与水到达地表后发生积水所需时间的总和。\n$$t_{p, \\text{forested}} = t_{\\text{fill}} + t_{p, \\text{bare}}$$\n$$t_{p, \\text{forested}} = 0.069333... \\text{ hr} + 0.24 \\text{ hr} = 0.309333... \\text{ hr}$$\n以分钟为单位，即 $t_{p, \\text{forested}} \\approx 18.56 \\text{ 分钟}$。\n\n**积水时间的变化**\n问题要求计算相对于裸土表面的积水时间变化 $\\Delta t_{p}$。\n$$\\Delta t_{p} = t_{p, \\text{forested}} - t_{p, \\text{bare}}$$\n代入上面推导出的表达式：\n$$\\Delta t_{p} = (t_{\\text{fill}} + t_{p, \\text{bare}}) - t_{p, \\text{bare}} = t_{\\text{fill}}$$\n积水时间的变化就是填满冠层蓄水所需的时间。\n我们以分钟为单位计算 $\\Delta t_{p}$ 的数值：\n$$\\Delta t_{p} = t_{\\text{fill}} = 0.069333... \\text{ hr} \\times 60 \\frac{\\text{min}}{\\text{hr}} = \\frac{2.08}{30} \\times 60 \\text{ min} = 2.08 \\times 2 \\text{ min} = 4.16 \\text{ min}$$\n\n问题要求最终答案四舍五入到四位有效数字。\n$$\\Delta t_{p} = 4.160 \\text{ min}$$\n\n森林冠层的存在截留了初始降雨，从而延迟了土壤表面入渗过程的开始。这个延迟时间恰好等于使冠层蓄水饱和所需的时间，此后土壤便承受与裸土情况相同的降雨强度。因此，积水时间正好延迟了这段冠层填充时间。",
            "answer": "$$\\boxed{4.160}$$"
        },
        {
            "introduction": "我们的最后一个练习将尺度从单个像元扩展到整个流域。你将实现一个完整的工作流程，从数字高程模型（DEM）计算地形湿度指数（Topographic Wetness Index, TWI），并用它来识别易于产生饱和超渗径流的区域。这项练习整合了地形分析与遥感输入数据（如 $NDVI$ 和土壤湿度），以创建一幅空间显式的地表水文脆弱性地图，充分展示了遥感在环境建模中的强大能力。",
            "id": "3843236",
            "problem": "您的任务是实现一个算法，使用数字高程模型（DEM）和遥感输入数据，计算地形湿度指数（TWI），并推断在特定降雨事件中易于发生饱和超渗产流的区域。该算法必须被完整地指定，并能够作为一个完整的程序实现。本陈述中的所有数学实体均以LaTeX格式编写。\n\n基本原理和定义：\n- 数字高程模型（Digital Elevation Model, DEM）是一个高程的栅格网格。每个单元格都是边长为 $s$（单位：米）的正方形。定义 $N$ 为单元格总数。\n- 使用最陡下降流向路径（D8方案），每个至少有一个下坡邻居的单元格将其流量精确地导向一个相邻单元格（即沿平面距离具有最大高程降的邻居）。设单元格 $i$ 选择的下游邻居索引为 $r(i)$；如果没有邻居的海拔更低，则该单元格是一个洼地或出口，不将流量导向任何邻居。\n- 对每个单元格 $i$，定义局部坡度角 $\\beta_i$ 为朝向 $r(i)$ 的最大下坡坡度所对应的角度。在小角度坡度近似下，$\\tan \\beta_i$ 等于沿最陡下降方向的高程降与平面距离之比。如果一个单元格没有下坡邻居，则将 $\\tan \\beta_i$ 设置为一个小的正常数 $\\varepsilon$，以避免除以零。角度严格以弧度处理。\n- 设比汇水面积 $a_i$（单位：米）为单元格 $i$ 的单位等高线宽度上的上坡汇水面积。在方形网格上的D8算法下，将 $a_i$ 近似为 $a_i = s \\cdot \\text{FA}_i$，其中 $\\text{FA}_i$ 是通过D8网络最终汇入单元格 $i$ 的单元格（包括 $i$ 本身）的流量累积计数。\n- 地形湿度指数定义为\n$$\n\\mathrm{TWI}_i = \\ln\\!\\left(\\frac{a_i}{\\tan \\beta_i}\\right).\n$$\n- 归一化植被指数（Normalized Difference Vegetation Index, NDVI）是一种遥感产品，我们用它来参数化饱和导水率的空间变异性。设 $K_{0}$ 为参考饱和导水率（单位：毫米/小时），$\\gamma$ 为一个无量纲的敏感性参数；定义局部饱和导水率为\n$$\nK_{\\mathrm{sat},i} = K_{0} \\, \\exp(\\gamma \\cdot \\mathrm{NDVI}_i)\n$$\n（单位：毫米/小时）。\n- 来自遥感（例如，土壤湿度主动被动探测卫星(SMAP)）的土壤湿度提供了体积含水量 $\\theta_i$（无量纲）。设 $z_s$ 为有效土层厚度（单位：米），$n$ 为土壤孔隙度（无量纲）。事件发生前的局部非饱和蓄水亏缺近似为\n$$\nD^{\\mathrm{base}}_i = z_s \\, \\max(n - \\theta_i, 0).\n$$\n- 遵循TOPMODEL系列模型的核心思想，局部地下水埋深通过指数 transmissivity 剖面与 $\\mathrm{TWI}$ 相关。一个实用的局部亏缺诊断表示法将TWI納入其中，形式为\n$$\nD_i = D^{\\mathrm{base}}_i - m \\left(\\mathrm{TWI}_i - \\overline{\\mathrm{TWI}}\\right),\n$$\n其中 $m$（单位：米）是一个反映侧向导水能力随深度衰减的比例参数，$\\overline{\\mathrm{TWI}}$ 是研究区域内 $\\mathrm{TWI}$ 的空间平均值。高的 $\\mathrm{TWI}$ 意味着较小的局部亏缺 $D_i$（即较浅的地下水位）。\n- 设降雨强度为 $I$（单位：毫米/小时），暴雨持续时间为 $t$（单位：小时）。降雨深度为 $P = I \\cdot t$（单位：毫米），相当于 $P_m = P / 1000$（单位：米）。事件期间的入渗能力为 $K_{\\mathrm{sat},i} \\cdot t$（单位：毫米），相当于 $(K_{\\mathrm{sat},i} \\cdot t)/1000$（单位：米）。如果满足以下条件，则一个单元格易于发生饱和超渗产流：\n$$\nP_m \\ge \\max(D_i, 0) + \\frac{K_{\\mathrm{sat},i} \\cdot t}{1000}.\n$$\n\n您的任务：\n1. 给定一个DEM和正方形单元格尺寸 $s$（单位：米），计算最陡下降D8流向路径、沿选定流向的局部坡度代理值 $\\tan \\beta_i$、比汇水面积 $a_i = s \\cdot \\text{FA}_i$ 和所有单元格的 $\\mathrm{TWI}_i = \\ln\\!\\left(\\frac{a_i}{\\tan \\beta_i}\\right)$。当不存在下坡邻居时，使用 $\\varepsilon = 10^{-6}$（无量纲）作为 $\\tan \\beta_i$ 的下限。\n2. 给定与DEM形状相同的NDVI和土壤湿度场，以及参数 $K_{0}$、$\\gamma$、$z_s$、$n$ 和 $m$，计算 $K_{\\mathrm{sat},i}$、$D^{\\mathrm{base}}_i$、$D_i$，并使用上述准则确定在强度为 $I$、持续时间为 $t$ 的降雨下，每个单元格是否易于发生饱和超渗产流。\n3. 对每个测试案例，报告易于发生饱和超渗产流的单元格比例，计算公式为 $\\frac{\\text{易发生产流的单元格数量}}{N}$，以十进制数形式表示。不允许使用百分比；请表示为小数。\n\n单位和角度约定：\n- 在DEM数组中，高程是无单位的（相对单位），但 $s$ 的单位是米，并决定了 $a_i$ 的单位。\n- 降雨强度 $I$ 和饱和导水率 $K_{\\mathrm{sat},i}$ 必须以毫米/小时为单位处理，持续时间 $t$ 以小时为单位；在与蓄水亏缺 $D_i$（米）进行比较时，深度应在内部转换为米。\n- 土层厚度 $z_s$ 的单位是米；孔隙度 $n$ 和土壤湿度 $\\theta_i$ 是无量纲分数。\n- 角度通过 $\\tan \\beta$ 处理；不要转换为度。如果显式计算 $\\beta$，它必须是弧度，但此处直接使用高程降与距离之比作为 $\\tan \\beta$。\n\n测试套件：\n为以下三种情况实现算法。所有数组均为 $5 \\times 5$。所有情况的单元格尺寸均为 $s = 30$ 米。\n\n情况 A（中等起伏，中等降雨）：\n- DEM:\n$$\n\\begin{bmatrix}\n120  118  117  118  120 \\\\\n115  110  108  110  115 \\\\\n112  105  100  105  112 \\\\\n110  104  99  104  110 \\\\\n108  102  98  102  108\n\\end{bmatrix}\n$$\n- NDVI:\n$$\n\\begin{bmatrix}\n0.40  0.45  0.50  0.45  0.40 \\\\\n0.45  0.55  0.60  0.55  0.45 \\\\\n0.50  0.60  0.70  0.60  0.50 \\\\\n0.45  0.55  0.60  0.55  0.45 \\\\\n0.40  0.45  0.50  0.45  0.40\n\\end{bmatrix}\n$$\n- 土壤湿度 $\\theta$:\n$$\n\\begin{bmatrix}\n0.20  0.22  0.24  0.22  0.20 \\\\\n0.22  0.26  0.28  0.26  0.22 \\\\\n0.24  0.28  0.30  0.28  0.24 \\\\\n0.22  0.26  0.28  0.26  0.22 \\\\\n0.20  0.22  0.24  0.22  0.20\n\\end{bmatrix}\n$$\n- 参数: $K_{0} = 10$ 毫米/小时, $\\gamma = 1.0$, $z_s = 0.5$ 米, $n = 0.45$, $m = 0.08$ 米, 降雨强度 $I = 15$ 毫米/小时, 持续时间 $t = 2$ 小时。\n\n情况 B（近乎平坦，低降雨，湿润前期条件）：\n- DEM:\n$$\n\\begin{bmatrix}\n100  100  99.9  100  100 \\\\\n100  100  99.8  100  100 \\\\\n100  100  99.7  100  100 \\\\\n100  100  99.6  100  100 \\\\\n100  100  99.5  100  100\n\\end{bmatrix}\n$$\n- NDVI:\n$$\n\\begin{bmatrix}\n0.30  0.30  0.30  0.30  0.30 \\\\\n0.30  0.35  0.35  0.35  0.30 \\\\\n0.30  0.35  0.40  0.35  0.30 \\\\\n0.30  0.35  0.35  0.35  0.30 \\\\\n0.30  0.30  0.30  0.30  0.30\n\\end{bmatrix}\n$$\n- 土壤湿度 $\\theta$:\n$$\n\\begin{bmatrix}\n0.42  0.42  0.42  0.42  0.42 \\\\\n0.42  0.43  0.43  0.43  0.42 \\\\\n0.42  0.43  0.44  0.43  0.42 \\\\\n0.42  0.43  0.43  0.43  0.42 \\\\\n0.42  0.42  0.42  0.42  0.42\n\\end{bmatrix}\n$$\n- 参数: $K_{0} = 12$ 毫米/小时, $\\gamma = 0.8$, $z_s = 0.4$ 米, $n = 0.45$, $m = 0.06$ 米, 降雨强度 $I = 5$ 毫米/小时, 持续时间 $t = 1$ 小时。\n\n情况 C（陡峭地形，强降雨）：\n- DEM:\n$$\n\\begin{bmatrix}\n200  190  180  190  200 \\\\\n180  170  160  170  180 \\\\\n160  150  140  150  160 \\\\\n150  140  130  140  150 \\\\\n140  130  120  130  140\n\\end{bmatrix}\n$$\n- NDVI:\n$$\n\\begin{bmatrix}\n0.50  0.55  0.60  0.55  0.50 \\\\\n0.55  0.60  0.65  0.60  0.55 \\\\\n0.60  0.65  0.70  0.65  0.60 \\\\\n0.55  0.60  0.65  0.60  0.55 \\\\\n0.50  0.55  0.60  0.55  0.50\n\\end{bmatrix}\n$$\n- 土壤湿度 $\\theta$:\n$$\n\\begin{bmatrix}\n0.28  0.29  0.30  0.29  0.28 \\\\\n0.29  0.30  0.31  0.30  0.29 \\\\\n0.30  0.31  0.32  0.31  0.30 \\\\\n0.29  0.30  0.31  0.30  0.29 \\\\\n0.28  0.29  0.30  0.29  0.28\n\\end{bmatrix}\n$$\n- 参数: $K_{0} = 10$ 毫米/小时, $\\gamma = 1.2$, $z_s = 0.5$ 米, $n = 0.45$, $m = 0.10$ 米, 降雨强度 $I = 50$ 毫米/小时, 持续时间 $t = 3$ 小时。\n\n要求的输出格式：\n- 您的程序应为每种情况计算易于发生饱和超渗产流的单元格比例（一个浮点数）。将这三个比例汇总到一行输出中，格式为逗号分隔的列表，并用方括号括起来，不含空格，顺序为情况A、情况B、情况C。例如：\"[0.12,0.34,0.56]\"。",
            "solution": "该问题陈述已经过严格验证，被确定为一个有效、定义明确且具有科学依据的计算问题。它提供了一套完整的定义、数据和参数，用于实现一个简化但概念上连贯的水文模型，以识别易于发生饱和超渗产流的区域。该模型基于成熟的D8流向算法以及地形湿度指数（TWI）和TOPMODEL的基本原理。所有必需的输入都已提供，算法步骤也已明确定义。因此，我们可以着手解决问题。\n\n解决方案的实现遵循了问题中规定的任务顺序。该算法的核心包括两个主要阶段：首先，对数字高程模型（DEM）进行地形分析，以确定由地貌驱动的水文属性；其次，整合遥感数据和事件特征，以评估产流条件。\n\n**1. 地形分析（D8、坡度、流量累积和TWI）**\n\n第一阶段量化了地形如何控制水的运动和积聚。\n\n-   **D8流向算法与坡度 ($\\tan \\beta_i$)**：我们首先处理DEM，一个高程值的网格。对每个单元格 $i$，我们应用D8算法，该算法确定了通往其八个相邻邻居之一的最陡下降路径。坡度，表示为 $\\tan \\beta_i$，计算为高程差与平面距离之比。对于正交邻居，距离为 $s$；对于对角邻居，距离为 $s\\sqrt{2}$，其中 $s$ 是单元格边长。如果一个单元格没有任何海拔严格更低的邻居，它就是一个洼地或平坦区域的汇流点。根据问题的规则，对于这类单元格，我们将 $\\tan \\beta_i$ 设置为一个小的正常数 $\\varepsilon = 10^{-6}$，以确保后续计算的数值稳定性。同时，我们计算出一个流向栅格，其中每个单元格指向其指定的下游邻居。\n\n-   **流量累积 ($\\text{FA}_i$)**：流量累积确定了汇入任何给定单元格的总单元格数量。为正确计算此值，必须按照特定的拓扑顺序，即从最高高程到最低高程，来处理单元格。我们首先创建一个包含所有单元格的列表，并按其高程降序排列。我们初始化一个流量累积网格 $\\text{FA}$，所有值均设为1，代表每个单元格自身的贡献。然后，我们遍历排序后的单元格列表。对于每个单元格，我们将其当前的流量累积值加到其下游邻居（在上一步中确定）的值上。这确保了在处理一个单元格时，其所有上坡单元格的贡献都已被计入。\n\n-   **比汇水面积 ($a_i$) 和 TWI ($\\mathrm{TWI}_i$)**：利用每个单元格的流量累积值 $\\text{FA}_i$，我们计算比汇水面积 $a_i = s \\cdot \\text{FA}_i$。该值代表了贡献流量的总上坡面积，并按等高线长度（此处近似为单个单元格宽度 $s$）进行了归一化。最后，使用其定义方程计算每个单元格的地形湿度指数：\n    $$\n    \\mathrm{TWI}_i = \\ln\\!\\left(\\frac{a_i}{\\tan \\beta_i}\\right)\n    $$\n    TWI是一个无量纲指数，较高的值表示地形上更易于湿润的位置（汇水面积大和/或局部坡度小）。\n\n**2. 水文参数化与产流计算**\n\n第二阶段整合了来自遥感的土壤和植被属性，以及降雨特征，以评估每个单元格的产流潜力。\n\n-   **饱和导水率 ($K_{\\mathrm{sat},i}$)**：土壤传输水分能力的空间变异性使用归一化植被指数（NDVI）进行参数化。每个单元格 $i$ 的局部饱和导水率 $K_{\\mathrm{sat},i}$（单位：mm/h）计算如下：\n    $$\n    K_{\\mathrm{sat},i} = K_{0} \\, \\exp(\\gamma \\cdot \\mathrm{NDVI}_i)\n    $$\n    其中 $K_{0}$ 是参考导水率，$\\gamma$ 是一个敏感性参数。\n\n-   **蓄水亏缺 ($D_i$)**：模型估算土壤水分亏缺，即充满土壤柱所需的水量。首先，根据遥感土壤湿度 $\\theta_i$、土壤孔隙度 $n$ 和有效土层深度 $z_s$ 计算基准亏缺 $D^{\\mathrm{base}}_i$（单位：米）：\n    $$\n    D^{\\mathrm{base}}_i = z_s \\, \\max(n - \\theta_i, 0)\n    $$\n    然后，使用先前计算的TWI，根据单元格的地形位置对此基准值进行调整。这一步是类TOPMODEL框架的核心，将静态地形与动态土壤湿度状态联系起来。最终的局部亏缺 $D_i$（单位：米）为：\n    $$\n    D_i = D^{\\mathrm{base}}_i - m \\left(\\mathrm{TWI}_i - \\overline{\\mathrm{TWI}}\\right)\n    $$\n    其中 $\\overline{\\mathrm{TWI}}$ 是整个区域的平均TWI，而 $m$ 是一个比例参数。此方程意味着TWI高于平均值的单元格其亏缺将减少，代表地下水位较浅。\n\n-   **饱和超渗产流准则**：如果总降雨量超过了土壤储存和入渗的能力，则认为该单元格易于产生饱和超渗产流。总降雨深度 $P_m$ 为 $I \\cdot t / 1000$（单位：米）。在暴雨持续时间 $t$ 内的总潜在入渗深度为 $(K_{\\mathrm{sat},i} \\cdot t) / 1000$（单位：米）。可用蓄水容量是局部亏缺的非负部分 $\\max(D_i, 0)$，因为负亏缺意味着土壤已经饱和。因此，产流的条件是：\n    $$\n    P_m \\ge \\max(D_i, 0) + \\frac{K_{\\mathrm{sat},i} \\cdot t}{1000}\n    $$\n\n**3. 最终计算与报告**\n\n对于每个测试案例，算法将产流准则应用于网格中的每个单元格，得到一个易发生产流与否的布尔图。将易发生产流的单元格总数除以研究区域的总单元格数 $N$，得到易于发生饱和超渗产流的面积比例。对所提供的三个测试案例中的每一个重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_runoff_fraction(dem, ndvi, theta, s, K0, gamma, zs, n, m, I, t):\n    \"\"\"\n    Computes the fraction of cells prone to saturation-excess runoff.\n\n    This function implements the full algorithm as described in the problem statement,\n    including D8 flow routing, TWI calculation, and the final runoff criterion.\n    \"\"\"\n    rows, cols = dem.shape\n    N = rows * cols\n    epsilon = 1e-6\n\n    # --- Part 1: Topographic Analysis ---\n\n    # 1a. D8 flow direction and slope (tan_beta)\n    flow_dir_rc = -np.ones((rows, cols, 2), dtype=int)\n    tan_beta = np.full((rows, cols), epsilon, dtype=np.float64)\n\n    # Neighbor offsets (dr, dc) and distances\n    # Ordered for consistent tie-breaking, though not strictly needed for test data.\n    neighbors = [\n        (-1, 0, 1.0), (-1, 1, np.sqrt(2)), (0, 1, 1.0), (1, 1, np.sqrt(2)),\n        (1, 0, 1.0), (1, -1, np.sqrt(2)), (0, -1, 1.0), (-1, -1, np.sqrt(2))\n    ]\n\n    for r in range(rows):\n        for c in range(cols):\n            max_slope = 0.0\n            steepest_neighbor = None\n\n            for dr, dc, dist_factor in neighbors:\n                nr, nc = r + dr, c + dc\n\n                if 0 = nr  rows and 0 = nc  cols:\n                    elev_drop = dem[r, c] - dem[nr, nc]\n                    if elev_drop  0:\n                        distance = s * dist_factor\n                        slope = elev_drop / distance\n\n                        if slope  max_slope:\n                            max_slope = slope\n                            steepest_neighbor = (nr, nc)\n            \n            if steepest_neighbor is not None:\n                tan_beta[r, c] = max_slope\n                flow_dir_rc[r, c] = [steepest_neighbor[0], steepest_neighbor[1]]\n\n    # 1b. Flow Accumulation (FA)\n    FA = np.ones((rows, cols), dtype=np.float64)\n    \n    cell_indices = [(r, c) for r in range(rows) for c in range(cols)]\n    sorted_cells = sorted(cell_indices, key=lambda p: dem[p], reverse=True)\n\n    for r, c in sorted_cells:\n        receiver_r, receiver_c = flow_dir_rc[r, c]\n        if receiver_r != -1:\n            FA[receiver_r, receiver_c] += FA[r, c]\n\n    # --- Part 2: Hydrological Calculations ---\n\n    a = s * FA\n    twi = np.log(a / tan_beta)\n    mean_twi = np.mean(twi)\n\n    K_sat = K0 * np.exp(gamma * ndvi)\n    D_base = zs * np.maximum(0, n - theta)\n    D = D_base - m * (twi - mean_twi)\n\n    P_m = (I * t) / 1000.0\n    Infil_m = (K_sat * t) / 1000.0\n\n    runoff_potential = np.maximum(0, D) + Infil_m\n    prone_cells_mask = P_m = runoff_potential\n\n    num_prone_cells = np.sum(prone_cells_mask)\n    fraction_prone = num_prone_cells / N\n\n    return fraction_prone\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and run the simulation.\n    \"\"\"\n    s = 30.0\n\n    # Case A: Moderate relief, moderate rainfall\n    case_A_params = {\n        'dem': np.array([\n            [120, 118, 117, 118, 120],\n            [115, 110, 108, 110, 115],\n            [112, 105, 100, 105, 112],\n            [110, 104, 99,  104, 110],\n            [108, 102, 98,  102, 108]\n        ], dtype=np.float64),\n        'ndvi': np.array([\n            [0.40, 0.45, 0.50, 0.45, 0.40],\n            [0.45, 0.55, 0.60, 0.55, 0.45],\n            [0.50, 0.60, 0.70, 0.60, 0.50],\n            [0.45, 0.55, 0.60, 0.55, 0.45],\n            [0.40, 0.45, 0.50, 0.45, 0.40]\n        ], dtype=np.float64),\n        'theta': np.array([\n            [0.20, 0.22, 0.24, 0.22, 0.20],\n            [0.22, 0.26, 0.28, 0.26, 0.22],\n            [0.24, 0.28, 0.30, 0.28, 0.24],\n            [0.22, 0.26, 0.28, 0.26, 0.22],\n            [0.20, 0.22, 0.24, 0.22, 0.20]\n        ], dtype=np.float64),\n        's': s, 'K0': 10.0, 'gamma': 1.0, 'zs': 0.5, 'n': 0.45, 'm': 0.08, 'I': 15.0, 't': 2.0\n    }\n\n    # Case B: Near-flat relief, low rainfall\n    case_B_params = {\n        'dem': np.array([\n            [100, 100, 99.9, 100, 100],\n            [100, 100, 99.8, 100, 100],\n            [100, 100, 99.7, 100, 100],\n            [100, 100, 99.6, 100, 100],\n            [100, 100, 99.5, 100, 100]\n        ], dtype=np.float64),\n        'ndvi': np.array([\n            [0.30, 0.30, 0.30, 0.30, 0.30],\n            [0.30, 0.35, 0.35, 0.35, 0.30],\n            [0.30, 0.35, 0.40, 0.35, 0.30],\n            [0.30, 0.35, 0.35, 0.35, 0.30],\n            [0.30, 0.30, 0.30, 0.30, 0.30]\n        ], dtype=np.float64),\n        'theta': np.array([\n            [0.42, 0.42, 0.42, 0.42, 0.42],\n            [0.42, 0.43, 0.43, 0.43, 0.42],\n            [0.42, 0.43, 0.44, 0.43, 0.42],\n            [0.42, 0.43, 0.43, 0.43, 0.42],\n            [0.42, 0.42, 0.42, 0.42, 0.42]\n        ], dtype=np.float64),\n        's': s, 'K0': 12.0, 'gamma': 0.8, 'zs': 0.4, 'n': 0.45, 'm': 0.06, 'I': 5.0, 't': 1.0\n    }\n\n    # Case C: Steep relief, heavy rainfall\n    case_C_params = {\n        'dem': np.array([\n            [200, 190, 180, 190, 200],\n            [180, 170, 160, 170, 180],\n            [160, 150, 140, 150, 160],\n            [150, 140, 130, 140, 150],\n            [140, 130, 120, 130, 140]\n        ], dtype=np.float64),\n        'ndvi': np.array([\n            [0.50, 0.55, 0.60, 0.55, 0.50],\n            [0.55, 0.60, 0.65, 0.60, 0.55],\n            [0.60, 0.65, 0.70, 0.65, 0.60],\n            [0.55, 0.60, 0.65, 0.60, 0.55],\n            [0.50, 0.55, 0.60, 0.55, 0.50]\n        ], dtype=np.float64),\n        'theta': np.array([\n            [0.28, 0.29, 0.30, 0.29, 0.28],\n            [0.29, 0.30, 0.31, 0.30, 0.29],\n            [0.30, 0.31, 0.32, 0.31, 0.30],\n            [0.29, 0.30, 0.31, 0.30, 0.29],\n            [0.28, 0.29, 0.30, 0.29, 0.28]\n        ], dtype=np.float64),\n        's': s, 'K0': 10.0, 'gamma': 1.2, 'zs': 0.5, 'n': 0.45, 'm': 0.10, 'I': 50.0, 't': 3.0\n    }\n\n    test_cases = [case_A_params, case_B_params, case_C_params]\n    results = []\n\n    for case_params in test_cases:\n        result = calculate_runoff_fraction(**case_params)\n        results.append(result)\n\n    print(f\"[{results[0]},{results[1]},{results[2]}]\")\n\nsolve()\n```"
        }
    ]
}