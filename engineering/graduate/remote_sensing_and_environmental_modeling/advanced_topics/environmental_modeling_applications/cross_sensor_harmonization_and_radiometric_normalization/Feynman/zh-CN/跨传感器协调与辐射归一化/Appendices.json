{
    "hands_on_practices": [
        {
            "introduction": "在比较不同传感器的数据之前，我们必须将其原始测量值转换为标准化的物理量。大气层顶（TOA）反射率就是这样一个基本量，因为它对太阳光照强度和几何形状进行了归一化。本练习将指导您从基本物理原理推导出TOA反射率公式，从而巩固您对这一关键变量所代表含义的理解。",
            "id": "3804140",
            "problem": "一个区域性水体由两台具有不同辐射定标和光谱响应函数的在轨成像光谱仪进行准同步观测。为了实现跨传感器协调，两台仪器的观测值都被转换为大气层顶（TOA）反射率。该反射率被定义为一个无量纲量，用于归一化太阳几何形状和日地距离的影响。假设一个中心位于 $0.65\\,\\mathrm{\\mu m}$ 的光谱窄带，在该波段上地外太阳光谱辐照度的变化可以忽略不计，并假设水面局部近似为朗伯体，因此在推导中可以忽略由双向反射分布函数（BRDF）描述的方向性效应。\n\n仅从以下经过充分检验的基础出发：\n- 光谱辐亮度 $L_{\\lambda}$ 和光谱辐照度 $E_{\\lambda}$ 的定义，以及反射率的定义，即朗伯表面的上行通量与下行通量之比。\n- 朗伯表面的能量守恒，它通过对半球的角度积分将 $L_{\\lambda}$、$E_{\\lambda}$ 和反射率关联起来。\n- 太阳辐射的平方反比定律，该定律指出辐照度随日地距离 $d$（以天文单位计）的变化与 $1/d^{2}$ 成比例。\n\n推导用于根据光谱辐亮度 $L_{\\lambda}$、一个天文单位处的地外光谱辐照度 $E_{0,\\lambda}$、太阳天顶角 $\\theta_{s}$ 和日地距离 $d$ 计算 TOA 反射率 $R_{\\mathrm{TOA}}$ 的表达式，然后根据传感器 A 的以下观测数据，数值计算 $R_{\\mathrm{TOA}}$：\n- $L_{\\lambda} = 7.5\\,\\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1}}$，\n- $E_{0,\\lambda} = 1850\\,\\mathrm{W \\cdot m^{-2} \\cdot \\mu m^{-1}}$，\n- $\\theta_{s} = 31^{\\circ}$（角度以度为单位），\n- $d = 0.989$（无量纲，以天文单位计）。\n\n接下来，通过报告分数变化 $(R' - R)/R$ 来量化日地距离 $1\\%$ 的误差对计算出的反射率的影响，其中 $R'$ 是用 $d' = 1.01\\,d$ 计算的反射率。\n\n将 $R_{\\mathrm{TOA}}$ 表示为 0 到 1 之间的无量纲小数，并将分数变化表示为无量纲小数。将两个报告的数值都四舍五入到四位有效数字。",
            "solution": "**第 1 部分：TOA 反射率表达式的推导**\n\nTOA 反射率 $R_{\\mathrm{TOA}}$ 定义为地球-大气系统反射的太阳辐射通量与入射到其上的太阳辐射通量之比。由于问题指定了一个窄光谱带，我们使用光谱量。\n\n1.  大气层顶的下行光谱辐照度 $E_{\\lambda, \\text{down}}$ 是入射到水平表面上的太阳通量。它由平均日地距离为一个天文单位（$1$ AU）时的地外太阳光谱辐照度 $E_{0,\\lambda}$ 推导而来。我们必须考虑两个因素：\n    *   实际的日地距离 $d$（以天文单位计）。根据平方反比定律，辐照度与 $1/d^2$ 成正比。因此，距离 $d$ 处的太阳通量为 $\\frac{E_{0,\\lambda}}{d^2}$。这是垂直于太阳光线的表面上的通量。\n    *   太阳天顶角 $\\theta_s$。为了求得 TOA 处水平表面上的辐照度，我们必须使用入射角的余弦（即 $\\theta_s$）来投射这个垂直通量。\n    结合这些，入射光谱辐照度为：\n    $$E_{\\lambda, \\text{down}} = \\frac{E_{0,\\lambda}}{d^2} \\cos(\\theta_s)$$\n\n2.  上行通量的特征是卫星传感器测量的上行光谱辐亮度 $L_{\\lambda}$。为了计算反射率，必须将此辐亮度转换为光谱出射度 $M_{\\lambda}$（单位面积通量）。问题指出我们可以将地球-大气系统建模为朗伯表面。对于朗伯辐射体/反射体，辐亮度 $L_{\\lambda}$ 是各向同性的（在所有方向上均匀），光谱出射度与光谱辐亮度之间的关系为：\n    $$M_{\\lambda} = \\pi L_{\\lambda}$$\n    该关系通过在整个观测半球上对辐亮度进行积分得出：$M_{\\lambda} = \\int_{\\Omega} L_{\\lambda} \\cos(\\theta) d\\Omega = L_{\\lambda} \\int_{0}^{2\\pi} \\int_{0}^{\\pi/2} \\cos(\\theta)\\sin(\\theta)d\\theta d\\phi = \\pi L_{\\lambda}$。\n\n3.  TOA 反射率 $R_{\\mathrm{TOA}}$ 是上行光谱出射度与下行光谱辐照度之比。由于问题针对的是单个窄带，为简化符号，我们可以省略下标 $\\lambda$。\n    $$R_{\\mathrm{TOA}} = \\frac{M_{\\lambda}}{E_{\\lambda, \\text{down}}}$$\n    代入第 1 步和第 2 步的表达式：\n    $$R_{\\mathrm{TOA}} = \\frac{\\pi L_{\\lambda}}{\\frac{E_{0,\\lambda}}{d^2} \\cos(\\theta_s)}$$\n    整理后得到 TOA 反射率的最终推导表达式：\n    $$R_{\\mathrm{TOA}} = \\frac{\\pi L_{\\lambda} d^2}{E_{0,\\lambda} \\cos(\\theta_s)}$$\n\n**第 2 部分：TOA 反射率的数值计算**\n\n我们现在使用传感器 A 的提供数据计算 $R_{\\mathrm{TOA}}$：\n*   $L_{\\lambda} = 7.5\\,\\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1}}$\n*   $E_{0,\\lambda} = 1850\\,\\mathrm{W \\cdot m^{-2} \\cdot \\mu m^{-1}}$\n*   $\\theta_{s} = 31^{\\circ}$\n*   $d = 0.989$\n\n将这些值代入我们推导的公式中：\n$$R_{\\mathrm{TOA}} = \\frac{\\pi (7.5) (0.989)^2}{(1850) \\cos(31^{\\circ})}$$\n我们进行计算：\n$$R_{\\mathrm{TOA}} = \\frac{(3.14159...) \\times (7.5) \\times (0.978121)}{(1850) \\times (0.857167...)}$$\n$$R_{\\mathrm{TOA}} = \\frac{23.0454...}{1585.759...} \\approx 0.0145326$$\n四舍五入到四位有效数字，我们得到：\n$$R_{\\mathrm{TOA}} \\approx 0.01453$$\n\n**第 3 部分：量化日地距离误差的影响**\n\n题目要求我们求出分数变化 $\\frac{R' - R}{R}$，其中 $R$ 是距离为 $d$ 时的反射率，$R'$ 是新距离 $d' = 1.01\\,d$ 时的反射率。\n\n从推导出的公式可以看出，$R_{\\mathrm{TOA}}$ 与距离的平方 $d^2$ 成正比。设 $C$ 为比例常数，使得 $C = \\frac{\\pi L_{\\lambda}}{E_{0,\\lambda} \\cos(\\theta_s)}$。\n那么，原始反射率为 $R = C d^2$。\n在距离 $d' = 1.01\\,d$ 处的新反射率 $R'$ 是：\n$$R' = C (d')^2 = C (1.01\\,d)^2 = C (1.01)^2 d^2 = (1.01)^2 (C d^2) = (1.01)^2 R$$\n现在，我们计算分数变化：\n$$\\frac{R' - R}{R} = \\frac{(1.01)^2 R - R}{R} = \\frac{R((1.01)^2 - 1)}{R} = (1.01)^2 - 1$$\n计算数值：\n$$(1.01)^2 - 1 = 1.0201 - 1 = 0.0201$$\n问题要求该结果报告为四位有效数字。为了将 $0.0201$ 表示为四位有效数字，我们添加一个尾随零。\n$$\\text{分数变化} = 0.02010$$\n这表示，由于假定的日地距离增加了 $1\\%$，计算出的反射率增加了 $2.01\\%$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.01453 & 0.02010 \\end{pmatrix}}$$"
        },
        {
            "introduction": "基于大气层顶反射率的概念，本实践解决了一个常见的现实世界问题：由于其独特的辐射定标（增益和偏移），两个传感器观测同一目标会产生不同的结果。通过计算具有略微不同定标参数的两个传感器的反射率，您将直接量化这种偏差。这个练习凸显了为创建一致的数据记录而进行相对辐射归一化的必要性。",
            "id": "3804105",
            "problem": "两台星载推扫式辐射计，传感器 A（参考）和传感器 B（目标），在相同的观测和光照条件下，观测同一均一、时间上稳定的陆地目标的可见光波段。每个传感器记录一个数字量（DN），记为 $DN$，它通过一个仿射辐射定标与大气层顶光谱辐亮度 $L_{\\lambda}$ 相关联，该定标具有特定波段的增益 $G$ 和偏移量 $O$，使得 $L_{\\lambda} = G \\, DN + O$。假设目标为朗伯体，大气路径辐亮度和邻近效应可忽略不计，波段内的光谱响应函数相同，且两个传感器的采集时间相同。\n\n观测与环境参数如下：\n- 记录的数字量：$DN = 500$。\n- 传感器 A 定标参数：$G_A = 0.105 \\, \\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1} \\cdot DN^{-1}}$，$O_A = -2.10 \\, \\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1}}$。\n- 传感器 B 定标参数（定标有误）：$G_B = 0.102 \\, \\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1} \\cdot DN^{-1}}$，$O_B = -1.60 \\, \\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1}}$。\n- 在波段有效波长处的大气外太阳光谱辐照度：$E_{\\sun,\\lambda} = 1850 \\, \\mathrm{W \\cdot m^{-2} \\cdot \\mu m^{-1}}$（定义于 $1$ 天文单位（AU）处）。\n- 地日距离：$d = 0.983$ AU。\n- 太阳天顶角：$\\theta_s = 30^\\circ$（度）。\n\n任务：\n1) 仅使用所述的物理定义，计算传感器 A 和传感器 B 的 $L_{\\lambda}$。\n2) 使用大气层顶反射率的标准定义（即一个无量纲比率，通过经地日距离和太阳天顶角余弦投影校正后的大气外太阳辐照度来归一化辐亮度），计算每个传感器的大气层顶反射率 $R_{\\mathrm{TOA}}$。\n3) 为了进行跨传感器协调，将由传感器 B 定标误差引起的乘性偏差因子 $b$ 定义为比率 $b = R_{\\mathrm{TOA}}^{(B)} / R_{\\mathrm{TOA}}^{(A)}$。报告 $b$ 的值。\n\n将最终的乘性偏差因子 $b$ 表示为一个无量纲数，并将最终答案四舍五入至四位有效数字。太阳天顶角按给定的度数使用。",
            "solution": "解答分为三部分，对应于题目中定义的任务。\n\n**步骤 1：计算大气层顶 (TOA) 光谱辐亮度 $L_{\\lambda}$**\n\n传感器记录的数字量 $DN$ 与 TOA 光谱辐亮度 $L_{\\lambda}$ 之间的关系由标准线性定标模型给出：\n$$L_{\\lambda} = G \\cdot DN + O$$\n其中 $G$ 代表传感器的辐射增益，$O$ 代表其偏移量。题目指定两个传感器观测同一均一目标时记录到的 $DN = 500$。\n\n对于传感器 A，给出的定标系数为 $G_A = 0.105$ 和 $O_A = -2.10$，单位分别为 $\\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1} \\cdot DN^{-1}}$ 和 $\\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1}}$。传感器 A 测得的光谱辐亮度为：\n$$L_{\\lambda}^{(A)} = G_A \\cdot DN + O_A$$\n$$L_{\\lambda}^{(A)} = (0.105)(500) + (-2.10) = 52.5 - 2.10 = 50.4$$\n得到的辐亮度单位为 $\\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1}}$。\n\n对于传感器 B，给出的定标系数为 $G_B = 0.102$ 和 $O_B = -1.60$，单位相同。传感器 B 测得的光谱辐亮度为：\n$$L_{\\lambda}^{(B)} = G_B \\cdot DN + O_B$$\n$$L_{\\lambda}^{(B)} = (0.102)(500) + (-1.60) = 51.0 - 1.60 = 49.4$$\n得到的辐亮度单位也为 $\\mathrm{W \\cdot m^{-2} \\cdot sr^{-1} \\cdot \\mu m^{-1}}$。\n\n**步骤 2：构建大气层顶 (TOA) 反射率 $R_{\\mathrm{TOA}}$**\n\n题目将 TOA 反射率 $R_{\\mathrm{TOA}}$ 定义为一个无量纲量，用于归一化测量的光谱辐亮度。具体来说，它是观测到的辐亮度 $L_{\\lambda}$ 与一个完美的、理想的朗伯面（100% 反射）在相同光照条件下所反射的辐亮度之比。\n\n大气层顶的入射太阳光谱辐照度是大气外太阳光谱辐照度 $E_{\\sun,\\lambda}$，并根据与地日距离 $d$ 的平方反比关系进行了校正。垂直于太阳光线的表面上的辐照度为 $E_{\\sun,\\lambda} / d^2$。大气层顶水平面上的辐照度是该值按太阳天顶角 $\\theta_s$ 的余弦投影得到的：\n$$E_{\\mathrm{TOA}} = \\frac{E_{\\sun,\\lambda} \\cos(\\theta_s)}{d^2}$$\n对于一个完美的朗伯反射体，出射辐亮度均匀分布在半球空间（$2\\pi$ 球面度立体角）内，反射出射度（对于完美反射体，其值等于入射辐照度）与辐亮度之间的关系是 $E = \\pi L$。因此，来自这个理想表面的辐亮度为：\n$$L_{\\lambda, \\mathrm{perfect}} = \\frac{E_{\\mathrm{TOA}}}{\\pi} = \\frac{E_{\\sun,\\lambda} \\cos(\\theta_s)}{\\pi d^2}$$\nTOA 反射率是观测到的辐亮度与此理想辐亮度的比值：\n$$R_{\\mathrm{TOA}} = \\frac{L_{\\lambda}}{L_{\\lambda, \\mathrm{perfect}}} = \\frac{L_{\\lambda}}{\\left(\\frac{E_{\\sun,\\lambda} \\cos(\\theta_s)}{\\pi d^2}\\right)} = \\frac{\\pi L_{\\lambda} d^2}{E_{\\sun,\\lambda} \\cos(\\theta_s)}$$\n给定的参数是 $d=0.983$，$E_{\\sun,\\lambda} = 1850 \\, \\mathrm{W \\cdot m^{-2} \\cdot \\mu m^{-1}}$，以及 $\\theta_s = 30^\\circ$。虽然我们可以计算 $R_{\\mathrm{TOA}}^{(A)}$ 和 $R_{\\mathrm{TOA}}^{(B)}$，但这对最后一步来说不是必需的。\n\n**步骤 3：计算乘性偏差因子 $b$**\n\n由传感器 B 定标误差引起的乘性偏差因子 $b$ 定义为从传感器 B 得到的 TOA 反射率与从传感器 A 得到的 TOA 反射率之比：\n$$b = \\frac{R_{\\mathrm{TOA}}^{(B)}}{R_{\\mathrm{TOA}}^{(A)}}$$\n将 $R_{\\mathrm{TOA}}$ 的完整表达式代入此比率：\n$$b = \\frac{\\left(\\frac{\\pi L_{\\lambda}^{(B)} d^2}{E_{\\sun,\\lambda} \\cos(\\theta_s)}\\right)}{\\left(\\frac{\\pi L_{\\lambda}^{(A)} d^2}{E_{\\sun,\\lambda} \\cos(\\theta_s)}\\right)}$$\n由于观测是在相同条件下对同一目标进行的，因此与地日距离 ($d$)、太阳辐照度 ($E_{\\sun,\\lambda}$) 和太阳天顶角 ($\\theta_s$) 相关的项，以及常数 $\\pi$，在分子和分母中是共有的。这些项相互抵消，从而得到一个更简单的偏差因子表达式：\n$$b = \\frac{L_{\\lambda}^{(B)}}{L_{\\lambda}^{(A)}}$$\n这表明，对于这种特定的偏差定义，它就是传感器处得到的辐亮度的比值。使用步骤 1 中计算的值：\n$$b = \\frac{49.4}{50.4}$$\n进行除法计算：\n$$b \\approx 0.98015873...$$\n题目要求结果四舍五入到四位有效数字。\n$$b \\approx 0.9802$$\n这个无量纲因子代表了需要对传感器 B 的反射率值进行的乘性校正，以便在这个特定的辐亮度水平上将其与传感器 A 进行协调。",
            "answer": "$$\\boxed{0.9802}$$"
        },
        {
            "introduction": "传感器的协调不仅限于辐射特性，还必须考虑观测和光照角度的几何差异。这个动手编码实践演示了如何使用双向反射分布函数（BRDF）模型来校正这些效应。通过将一个传感器的测量值调整到另一个传感器的几何结构，您将学习一项关键技术，以减少时间序列数据中的伪影并创建真正可比的表面反射率产品。",
            "id": "3804144",
            "problem": "给定同一地表目标的两个分别对应于 Landsat 和 Sentinel-2 的卫星观测几何，以及一个半经验双向反射分布函数 (BRDF) 参数化。任务是使用核驱动模型，估算将 Landsat 测量的地表反射率归一化到 Sentinel-2 的观测和光照几何所需的加性 BRDF 校正。这种归一化是跨传感器辐射定标归一化的一部分。\n\n基本原理和定义：\n- 双向反射分布函数 (BRDF) $f_r(\\theta_s,\\theta_v,\\phi)$ 表征了地表反射率的方向依赖性，其中 $\\theta_s$ 是太阳天顶角，$\\theta_v$ 是观测天顶角，$\\phi$ 是太阳和观测方向之间的相对方位角。\n- 在核驱动线性 BRDF 模型中，给定几何 $(\\theta_s,\\theta_v,\\phi)$ 的地表反射率因子 $R$ 可近似表示为：\n$$\nR(\\theta_s,\\theta_v,\\phi) = f_{\\text{iso}} + f_{\\text{vol}}\\,K_{\\text{vol}}(\\theta_s,\\theta_v,\\phi),\n$$\n其中 $f_{\\text{iso}}$ 是各向同性（朗伯）系数，$f_{\\text{vol}}$ 是体散射系数。体散射核 $K_{\\text{vol}}$ 采用 Ross–Thick 核：\n$$\n\\cos \\xi = \\cos \\theta_s \\cos \\theta_v + \\sin \\theta_s \\sin \\theta_v \\cos \\phi,\n$$\n$$\n\\xi = \\arccos(\\cos \\xi),\n$$\n$$\nK_{\\text{vol}}(\\theta_s,\\theta_v,\\phi) = \\left(\\frac{\\pi}{2} - \\xi\\right)\\cos \\xi + \\sin \\xi - \\frac{\\pi}{4}.\n$$\n该核函数源于将球面余弦定律应用于太阳与观测方向之间的相角 $\\xi$，并被广泛用于模拟植被冠层中的体散射。\n\n目标：\n- 对每个测试用例，通过对 Landsat 测量的反射率 $R^{L}_{\\text{meas}}$ 应用加性 BRDF 校正，将其转换到 Sentinel-2 的几何下，从而计算归一化反射率 $R^{\\text{harm}}$。利用各向同性项 $f_{\\text{iso}}$ 与几何无关，而各向异性（体散射）依赖性由 $K_{\\text{vol}}$ 捕捉这一事实。\n\n输入和单位：\n- 角度 $\\theta_s$、$\\theta_v$ 和 $\\phi$ 以度为单位提供。使用 $\\text{弧度} = \\text{度} \\times \\pi/180$ 将度转换为弧度。\n- 反射率是无量纲比率，必须表示为小数。\n- 最终的归一化反射率值必须报告为浮点数，并四舍五入到 $6$ 位小数。\n\n计算要求：\n- 对于每个具有 Landsat 几何 $(\\theta_s^L,\\theta_v^L,\\phi^L)$、Sentinel-2 几何 $(\\theta_s^S,\\theta_v^S,\\phi^S)$、系数 $(f_{\\text{iso}}, f_{\\text{vol}})$ 和 Landsat 测量反射率 $R_{\\text{meas}}^{L}$ 的测试用例，计算：\n  1. $K_{\\text{vol}}^L = K_{\\text{vol}}(\\theta_s^L,\\theta_v^L,\\phi^L)$，\n  2. $K_{\\text{vol}}^S = K_{\\text{vol}}(\\theta_s^S,\\theta_v^S,\\phi^S)$，\n  3. $R_{\\text{model}}^L = f_{\\text{iso}} + f_{\\text{vol}}\\,K_{\\text{vol}}^L$，\n  4. $R_{\\text{model}}^S = f_{\\text{iso}} + f_{\\text{vol}}\\,K_{\\text{vol}}^S$，\n  5. $R^{\\text{harm}} = R_{\\text{meas}}^{L} + (R_{\\text{model}}^S - R_{\\text{model}}^L)$。\n\n测试套件：\n为以下五个测试用例提供计算。所有角度都以度为单位，反射率是无量纲的：\n\n- 测试用例 $1$（一般情况）：$\\theta_s^L = 30$, $\\theta_v^L = 7$, $\\phi^L = 20$；$\\theta_s^S = 32$, $\\theta_v^S = 5$, $\\phi^S = 25$；$f_{\\text{iso}} = 0.05$, $f_{\\text{vol}} = 0.10$；$R_{\\text{meas}}^{L} = 0.18$。\n- 测试用例 $2$（边界情况，几何相同）：$\\theta_s^L = 35$, $\\theta_v^L = 10$, $\\phi^L = 60$；$\\theta_s^S = 35$, $\\theta_v^S = 10$, $\\phi^S = 60$；$f_{\\text{iso}} = 0.03$, $f_{\\text{vol}} = 0.08$；$R_{\\text{meas}}^{L} = 0.20$。\n- 测试用例 $3$（边缘情况，天底与离天底对比）：$\\theta_s^L = 10$, $\\theta_v^L = 20$, $\\phi^L = 180$；$\\theta_s^S = 10$, $\\theta_v^S = 0$, $\\phi^S = 180$；$f_{\\text{iso}} = 0.04$, $f_{\\text{vol}} = 0.12$；$R_{\\text{meas}}^{L} = 0.10$。\n- 测试用例 $4$（边缘情况，大太阳天顶角）：$\\theta_s^L = 70$, $\\theta_v^L = 15$, $\\phi^L = 120$；$\\theta_s^S = 65$, $\\theta_v^S = 10$, $\\phi^S = 100$；$f_{\\text{iso}} = 0.06$, $f_{\\text{vol}} = 0.09$；$R_{\\text{meas}}^{L} = 0.15$。\n- 测试用例 $5$（边缘情况，极端相对方位角变化）：$\\theta_s^L = 45$, $\\theta_v^L = 10$, $\\phi^L = 0$；$\\theta_s^S = 45$, $\\theta_v^S = 10$, $\\phi^S = 180$；$f_{\\text{iso}} = 0.05$, $f_{\\text{vol}} = 0.11$；$R_{\\text{meas}}^{L} = 0.22$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含五个测试用例的归一化反射率结果，格式为逗号分隔的列表，并用方括号括起来，每个值四舍五入到 $6$ 位小数（例如，$\\text{[result1,result2,result3,result4,result5]}$）。",
            "solution": "目标是计算 BRDF（双向反射分布函数）校正，以将 Landsat 传感器测量的地表反射率（$R_{\\text{meas}}^{L}$）归一化到 Sentinel-2 传感器的观测和光照几何。这是通过一个简化的线性核驱动 BRDF 模型实现的。\n\n该模型将地表反射率因子 $R$ 近似为各向同性分量和体散射分量之和：\n$$\nR(\\theta_s, \\theta_v, \\phi) = f_{\\text{iso}} + f_{\\text{vol}}\\,K_{\\text{vol}}(\\theta_s, \\theta_v, \\phi)\n$$\n这里，$f_{\\text{iso}}$ 是各向同性散射系数，代表朗伯反射；$f_{\\text{vol}}$ 是体散射系数，用于加权体散射核 $K_{\\text{vol}}$ 的贡献。角度 $\\theta_s$、$\\theta_v$ 和 $\\phi$ 分别代表太阳天顶角、观测天顶角和相对方位角。\n\n体散射由 Ross–Thick 核描述，该核源自均质植被冠层的辐射传输理论。其公式取决于光照和观测矢量之间的相角 $\\xi$。相角的余弦由球面余弦定律给出：\n$$\n\\cos \\xi = \\cos \\theta_s \\cos \\theta_v + \\sin \\theta_s \\sin \\theta_v \\cos \\phi\n$$\n然后，相角 $\\xi$ 为 $\\xi = \\arccos(\\cos \\xi)$。问题中使用的 Ross–Thick 核 $K_{\\text{vol}}$ 的具体形式为：\n$$\nK_{\\text{vol}}(\\theta_s,\\theta_v,\\phi) = \\left(\\frac{\\pi}{2} - \\xi\\right)\\cos \\xi + \\sin \\xi - \\frac{\\pi}{4}\n$$\n所有角度输入均以度为单位，在使用三角函数时必须通过关系式：$\\text{弧度} = \\text{度} \\times (\\pi / 180)$ 转换为弧度。\n\n归一化过程基于加性校正。其核心假设是，即使模型不能完美预测绝对反射率，它也能准确地捕捉由于几何变化引起的反射率*变化*。归一化反射率 $R^{\\text{harm}}$ 是通过用 Sentinel-2 几何和 Landsat 几何之间模型化反射率的差异来调整测量的 Landsat 反射率 $R_{\\text{meas}}^{L}$ 计算得出的。\n设 Landsat 和 Sentinel-2 的几何分别为 $(\\theta_s^L, \\theta_v^L, \\phi^L)$ 和 $(\\theta_s^S, \\theta_v^S, \\phi^S)$。每种几何的模型预测反射率为：\n$$\nR_{\\text{model}}^L = f_{\\text{iso}} + f_{\\text{vol}}\\,K_{\\text{vol}}(\\theta_s^L, \\theta_v^L, \\phi^L)\n$$\n$$\nR_{\\text{model}}^S = f_{\\text{iso}} + f_{\\text{vol}}\\,K_{\\text{vol}}(\\theta_s^S, \\theta_v^S, \\phi^S)\n$$\n归一化反射率则由下式给出：\n$$\nR^{\\text{harm}} = R_{\\text{meas}}^{L} + (R_{\\text{model}}^S - R_{\\text{model}}^L)\n$$\n通过代入模型方程，我们可以简化此表达式。与几何无关的各向同性项 $f_{\\text{iso}}$ 会被消掉：\n$$\nR^{\\text{harm}} = R_{\\text{meas}}^{L} + (f_{\\text{iso}} + f_{\\text{vol}}K_{\\text{vol}}^S) - (f_{\\text{iso}} + f_{\\text{vol}}K_{\\text{vol}}^L)\n$$\n$$\nR^{\\text{harm}} = R_{\\text{meas}}^{L} + f_{\\text{vol}}(K_{\\text{vol}}^S - K_{\\text{vol}}^L)\n$$\n这个简化公式在计算上更直接，并用于求解。每个测试用例的步骤如下：\n1.  对于给定的 Landsat 几何 $(\\theta_s^L, \\theta_v^L, \\phi^L)$，计算核值 $K_{\\text{vol}}^L$。\n2.  对于给定的 Sentinel-2 几何 $(\\theta_s^S, \\theta_v^S, \\phi^S)$，计算核值 $K_{\\text{vol}}^S$。\n3.  使用提供的系数 $f_{\\text{vol}}$ 和测量的 Landsat 反射率 $R_{\\text{meas}}^L$，使用上述简化公式计算归一化反射率 $R^{\\text{harm}}$。\n4.  按要求将最终结果四舍五入到 $6$ 位小数。\n此过程将系统地应用于所提供的五个测试用例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the harmonized surface reflectance for a series of test cases based on a kernel-driven BRDF model.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: ((theta_s_L, theta_v_L, phi_L), (theta_s_S, theta_v_S, phi_S), f_iso, f_vol, R_meas_L)\n    test_cases = [\n        # Test case 1 (general case)\n        ((30, 7, 20), (32, 5, 25), 0.05, 0.10, 0.18),\n        # Test case 2 (boundary, identical geometries)\n        ((35, 10, 60), (35, 10, 60), 0.03, 0.08, 0.20),\n        # Test case 3 (edge, nadir vs off-nadir)\n        ((10, 20, 180), (10, 0, 180), 0.04, 0.12, 0.10),\n        # Test case 4 (edge, large solar zenith)\n        ((70, 15, 120), (65, 10, 100), 0.06, 0.09, 0.15),\n        # Test case 5 (edge, extreme relative azimuth change)\n        ((45, 10, 0), (45, 10, 180), 0.05, 0.11, 0.22),\n    ]\n\n    def calculate_k_vol(theta_s_deg, theta_v_deg, phi_deg):\n        \"\"\"\n        Calculates the Ross–Thick volumetric kernel K_vol.\n\n        Args:\n            theta_s_deg (float): Solar zenith angle in degrees.\n            theta_v_deg (float): View zenith angle in degrees.\n            phi_deg (float): Relative azimuth angle in degrees.\n\n        Returns:\n            float: The value of the K_vol kernel.\n        \"\"\"\n        # Convert degrees to radians\n        theta_s = np.deg2rad(theta_s_deg)\n        theta_v = np.deg2rad(theta_v_deg)\n        phi = np.deg2rad(phi_deg)\n\n        # Calculate the cosine of the phase angle (xi)\n        cos_xi = np.cos(theta_s) * np.cos(theta_v) + np.sin(theta_s) * np.sin(theta_v) * np.cos(phi)\n        \n        # Clamp cos_xi to the valid range [-1, 1] for arccos to avoid floating point issues\n        cos_xi = np.clip(cos_xi, -1.0, 1.0)\n        \n        # Calculate the phase angle (xi)\n        xi = np.arccos(cos_xi)\n\n        # Calculate the Ross–Thick kernel as defined in the problem\n        k_vol = (np.pi / 2 - xi) * cos_xi + np.sin(xi) - (np.pi / 4)\n        \n        return k_vol\n\n    results = []\n    for case in test_cases:\n        geom_L, geom_S, f_iso, f_vol, R_meas_L = case\n        theta_s_L, theta_v_L, phi_L = geom_L\n        theta_s_S, theta_v_S, phi_S = geom_S\n\n        # 1. Compute K_vol for Landsat geometry\n        k_vol_L = calculate_k_vol(theta_s_L, theta_v_L, phi_L)\n        \n        # 2. Compute K_vol for Sentinel-2 geometry\n        k_vol_S = calculate_k_vol(theta_s_S, theta_v_S, phi_S)\n        \n        # 3. Compute the harmonized reflectance R_harm\n        # R_harm = R_meas_L + (R_model_S - R_model_L)\n        # R_harm = R_meas_L + (f_iso + f_vol*k_vol_S) - (f_iso + f_vol*k_vol_L)\n        # This simplifies to:\n        r_harm = R_meas_L + f_vol * (k_vol_S - k_vol_L)\n        \n        results.append(r_harm)\n\n    # Format the final output as a comma-separated list of strings,\n    # with each value rounded to 6 decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}