{
    "hands_on_practices": [
        {
            "introduction": "To truly master the SCS-CN method, it's essential to move beyond simply using the final runoff formula and understand its conceptual origins. This first practice guides you through deriving the runoff equation from the fundamental principles of mass conservation and the key proportionality postulate that underpins the entire framework . By working through the derivation and applying it to a basic scenario, you will solidify your understanding of how precipitation is partitioned into runoff and abstractions, and learn to interpret the results through the runoff ratio.",
            "id": "3844595",
            "problem": "A medium-sized watershed has been delineated using multispectral satellite imagery and a digital soil map. A supervised land-cover classification combined with hydrologic soil group information yields a weighted composite Curve Number (CN) of $78$ under Antecedent Moisture Condition II (AMC II). Consider a spatially uniform storm with total precipitation depth $P=60$ millimeters over the watershed. For the Soil Conservation Service (SCS) Curve Number method, the potential maximum retention $S$ in millimeters can be parameterized from the Curve Number by $S=\\dfrac{25400}{CN}-254$, and the initial abstraction $I_{a}$ is parameterized as $I_{a}=0.2\\,S$. Assume the standard SCS conceptualization that, after initial abstraction is satisfied, the cumulative actual retention is proportional to the potential maximum retention and the cumulative direct runoff is proportional to the effective rainfall.\n\nUsing only conservation of mass and the proportionality postulate described above, derive the runoff depth $Q$ as a function of $P$, $I_{a}$, and $S$, and then evaluate $Q$ for $CN=78$ and $P=60$ millimeters. Finally, based on the computed $Q$, interpret the runoff ratio as a dimensionless decimal equal to $Q/P$ (no percentage sign) and briefly comment on what it implies about partitioning between runoff and abstractions for this event. Round your final numerical value of $Q$ to four significant figures and express it in millimeters. The interpretive discussion does not require rounding.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the established principles of the Soil Conservation Service (SCS) Curve Number (CN) method, a standard empirical model in surface-water hydrology. The problem is well-posed, self-contained, and objective, providing all necessary data ($CN=78$, $P=60 \\text{ mm}$), definitions (parameterizations for $S$ and $I_a$), and conceptual relationships (conservation of mass and the proportionality postulate) to derive a unique solution without ambiguity or contradiction.\n\nThe primary task is to derive the SCS runoff equation and apply it. The derivation is based on two fundamental principles for precipitation events where total precipitation $P$ exceeds the initial abstraction $I_a$.\n\nFirst, the principle of conservation of mass dictates the water balance for the event. The total precipitation $P$ is partitioned into three components: initial abstraction $I_a$ (water that does not contribute to runoff, such as interception by vegetation, depression storage, and infiltration before runoff begins), direct runoff $Q$, and cumulative infiltration (or actual retention) after runoff begins, denoted by $F$. The mass balance equation is:\n$$P = I_a + F + Q \\quad (\\text{for } P > I_a)$$\nIf $P \\le I_a$, no runoff occurs, so $Q = 0$. For the case where runoff occurs, we can express the actual retention $F$ as:\n$$F = P - I_a - Q$$\n\nSecond, the core conceptual postulate of the SCS method establishes a proportionality. It assumes that the ratio of the actual direct runoff $Q$ to the potential maximum runoff is equal to the ratio of the actual retention $F$ to the potential maximum retention $S$. The potential maximum runoff is the effective rainfall, which is the precipitation available for either runoff or continued infiltration after the initial abstraction is satisfied, i.e., $P - I_a$. Thus, the proportionality is written as:\n$$\\frac{Q}{P - I_a} = \\frac{F}{S}$$\n\nTo derive the runoff depth $Q$ as a function of $P$, $I_a$, and $S$, we substitute the expression for $F$ from the mass balance equation into the proportionality equation:\n$$\\frac{Q}{P - I_a} = \\frac{P - I_a - Q}{S}$$\nWe now solve this equation for $Q$. Multiplying both sides by $S$ and $(P - I_a)$ yields:\n$$Q \\cdot S = (P - I_a)(P - I_a - Q)$$\n$$Q \\cdot S = (P - I_a)^2 - Q(P - I_a)$$\nTo isolate $Q$, we gather all terms containing $Q$ on one side of the equation:\n$$Q \\cdot S + Q(P - I_a) = (P - I_a)^2$$\nFactoring out $Q$:\n$$Q(S + P - I_a) = (P - I_a)^2$$\nFinally, dividing by the term in parentheses gives the explicit formula for runoff depth $Q$:\n$$Q = \\frac{(P - I_a)^2}{P - I_a + S}$$\nThis equation is valid for $P > I_a$. For $P \\le I_a$, $Q=0$.\n\nNow, we evaluate $Q$ for the given conditions.\nFirst, we calculate the potential maximum retention $S$ from the given Curve Number $CN=78$:\n$$S = \\frac{25400}{CN} - 254 = \\frac{25400}{78} - 254$$\n$$S \\approx 325.6410256 - 254 = 71.6410256 \\text{ mm}$$\nNext, we calculate the initial abstraction $I_a$ based on the standard parameterization $I_a = 0.2S$:\n$$I_a = 0.2 \\times S \\approx 0.2 \\times 71.6410256 = 14.3282051 \\text{ mm}$$\nThe total precipitation is given as $P=60 \\text{ mm}$. We must check if runoff will occur by comparing $P$ to $I_a$:\n$$P = 60 \\text{ mm} > I_a \\approx 14.33 \\text{ mm}$$\nSince $P > I_a$, runoff is generated, and we can use the derived formula for $Q$. Substituting the values for $P$, $I_a$, and $S$:\n$$Q = \\frac{(60 - 14.3282051)^2}{60 - 14.3282051 + 71.6410256}$$\n$$Q = \\frac{(45.6717949)^2}{45.6717949 + 71.6410256} = \\frac{2085.91130}{117.3128205}$$\n$$Q \\approx 17.78084 \\text{ mm}$$\nRounding the result to four significant figures as requested:\n$$Q \\approx 17.78 \\text{ mm}$$\n\nFinally, we interpret the runoff ratio, $Q/P$.\n$$ \\frac{Q}{P} = \\frac{17.78084}{60} \\approx 0.2963 $$\nA runoff ratio of approximately $0.296$ implies that for this storm event, about $29.6\\%$ of the total precipitation depth was converted into direct surface runoff. The majority of the rainfall, approximately $1 - 0.296 = 0.704$ or $70.4\\%$, was abstracted from the runoff process. These abstractions are composed of the initial abstraction $I_a \\approx 14.33$ mm (approximately $23.9\\%$ of $P$) and the continuing infiltration after runoff began, $F = P - I_a - Q \\approx 60 - 14.33 - 17.78 = 27.89$ mm (approximately $46.5\\%$ of $P$). This indicates a watershed condition and storm characteristic where a significant portion of the rainfall was retained within the watershed, primarily through infiltration into the soil, rather than rapidly running off the surface.",
            "answer": "$$\n\\boxed{17.78}\n$$"
        },
        {
            "introduction": "Real-world watersheds are rarely uniform; they are complex mosaics of different land covers and soil types. This practice addresses the crucial step of parameterizing the SCS-CN model for such heterogeneous landscapes, a common task when working with land cover maps derived from satellite imagery . You will learn the standard approach of calculating an area-weighted composite Curve Number ($CN_{\\text{comp}}$) to represent the watershed as a single, lumped unit, enabling the estimation of runoff at the basin scale.",
            "id": "3844533",
            "problem": "A watershed has been delineated and its land cover proportions have been mapped from a supervised multispectral satellite classification. The resulting fractions of hydrologically homogeneous response units are $0.4$ forest with good cover, $0.3$ pasture with fair cover, and $0.3$ row crop with poor cover. The entire watershed is on Hydrologic Soil Group (HSG) $B$. Under Antecedent Moisture Condition (AMC) $II$, the corresponding tabulated Curve Numbers ($CN$) for these land cover–soil group combinations are $55$ (forest good, $B$), $69$ (pasture fair, $B$), and $78$ (row crop poor, $B$). Use the United States Department of Agriculture Soil Conservation Service (USDA-SCS) runoff framework to parameterize the watershed as a lumped unit.\n\nStarting from the water balance concept and the definitions that lead to the USDA-SCS runoff relation, and using only well-tested relationships between the Curve Number and the potential maximum retention, derive how to:\n- compute the composite Curve Number, $CN_{\\text{comp}}$, from the mapped land cover fractions and the tabulated $CN$ values;\n- obtain the composite potential maximum retention, $S_{\\text{comp}}$ (in millimeters), from $CN_{\\text{comp}}$;\n- compute the direct runoff depth, $Q$ (in millimeters), for a storm event of total precipitation $P=50$ mm, assuming the standard initial abstraction ratio is used in the USDA-SCS framework.\n\nCarry out the calculations for the given fractions and $CN$ values, and provide the numerical values of $S_{\\text{comp}}$ (in mm), $CN_{\\text{comp}}$ (dimensionless), and $Q$ (in mm). Round all three reported values to four significant figures. Express $S_{\\text{comp}}$ and $Q$ in millimeters.",
            "solution": "The United States Department of Agriculture Soil Conservation Service (USDA-SCS) runoff method is grounded in a conceptual water balance for a storm event,\n$$\nP = I_{a} + F + Q,\n$$\nwhere $P$ is precipitation depth, $I_{a}$ is the initial abstraction (all losses before runoff begins), $F$ is the actual infiltration/retention during the event, and $Q$ is the direct runoff depth. The method assumes that the fraction of excess $P$ that becomes runoff is governed by a catchment-specific potential maximum retention, $S$, with the constitutive assumptions\n- proportionality of actual retention to potential retention once runoff begins,\n- a fixed ratio between the initial abstraction and potential maximum retention, $I_{a} = \\lambda S$, with the standard choice $\\lambda = 0.2$ in the USDA-SCS method,\nleading to the well-tested runoff relation\n$$\nQ = \n\\begin{cases}\n\\displaystyle \\frac{\\left(P - I_{a}\\right)^{2}}{P + S - I_{a}}, & P > I_{a},\\\n$$6pt]\n0, & P \\leq I_{a}.\n\\end{cases}\n$$\nThe potential maximum retention $S$ is linked to the Curve Number $CN$ by a one-to-one mapping derived originally in imperial units,\n$$\nS_{\\text{in}} = \\frac{1000}{CN} - 10 \\quad \\text{(inches)},\n$$\nwhich, upon unit conversion using $1$ inch $=25.4$ mm, gives the metric relationship\n$$\nS_{\\text{mm}} = 25.4\\,S_{\\text{in}} = 25.4\\left(\\frac{1000}{CN} - 10\\right) = \\frac{25400}{CN} - 254 \\quad \\text{(millimeters)}.\n$$\n\nRemote sensing provides the fractional areas of land cover classes, which, together with Hydrologic Soil Group (HSG) and cover condition, map to tabulated Curve Numbers. For a lumped parameterization, a standard and widely used aggregation is the area-weighted Curve Number,\n$$\nCN_{\\text{comp}} = \\sum_{i} w_{i}\\,CN_{i},\n$$\nwhere $w_{i}$ are the fractional areas and $CN_{i}$ are the class-specific Curve Numbers under the same AMC and HSG.\n\nGiven the data:\n- fractions $w_{\\text{forest}} = 0.4$, $w_{\\text{pasture}} = 0.3$, $w_{\\text{row crop}} = 0.3$,\n- $CN_{\\text{forest}} = 55$, $CN_{\\text{pasture}} = 69$, $CN_{\\text{row crop}} = 78$,\nwe compute\n$$\nCN_{\\text{comp}} = 0.4\\cdot 55 + 0.3\\cdot 69 + 0.3\\cdot 78.\n$$\nEvaluate each term:\n$$\n0.4\\cdot 55 = 22,\\quad 0.3\\cdot 69 = 20.7,\\quad 0.3\\cdot 78 = 23.4,\n$$\nhence\n$$\nCN_{\\text{comp}} = 22 + 20.7 + 23.4 = 66.1.\n$$\n\nNext, use the metric $CN$–$S$ mapping to obtain $S_{\\text{comp}}$:\n$$\nS_{\\text{comp}} = \\frac{25400}{CN_{\\text{comp}}} - 254 = \\frac{25400}{66.1} - 254.\n$$\nCompute the quotient $\\frac{25400}{66.1}$:\n$$\n\\frac{25400}{66.1} \\approx 384.2662,\n$$\nso\n$$\nS_{\\text{comp}} \\approx 384.2662 - 254 = 130.2662 \\quad \\text{mm}.\n$$\n\nFor the runoff, adopt the standard initial abstraction ratio $\\lambda = 0.2$ and $P=50$ mm. First check whether $P > I_{a}$:\n$$\nI_{a} = \\lambda S_{\\text{comp}} = 0.2 \\times 130.2662 \\approx 26.0532 \\quad \\text{mm},\n$$\nand $P - I_{a} \\approx 50 - 26.0532 = 23.9468$ mm $> 0$, so runoff occurs. Then\n$$\nQ = \\frac{\\left(P - I_{a}\\right)^{2}}{P + S_{\\text{comp}} - I_{a}} = \\frac{\\left(50 - 0.2\\,S_{\\text{comp}}\\right)^{2}}{50 + S_{\\text{comp}} - 0.2\\,S_{\\text{comp}}} = \\frac{\\left(50 - 26.0532\\right)^{2}}{50 + 130.2662 - 26.0532}.\n$$\nCompute the denominator:\n$$\n50 + 130.2662 - 26.0532 = 154.2130,\n$$\nand the numerator:\n$$\n\\left(23.9468\\right)^{2} \\approx 573.4471.\n$$\nTherefore,\n$$\nQ \\approx \\frac{573.4471}{154.2130} \\approx 3.7185 \\quad \\text{mm}.\n$$\n\nFinally, apply the rounding rule (four significant figures):\n- $CN_{\\text{comp}} = 66.10$,\n- $S_{\\text{comp}} = 130.3$ mm,\n- $Q = 3.719$ mm.\n\nThe requested outputs are $S_{\\text{comp}}$ (mm), $CN_{\\text{comp}}$ (dimensionless), and $Q$ (mm), in that order.",
            "answer": "$$\\boxed{\\begin{pmatrix}130.3 & 66.10 & 3.719\\end{pmatrix}}$$"
        },
        {
            "introduction": "The true power of combining remote sensing and hydrology lies in creating dynamic models that capture changes in the landscape over time. This advanced practice challenges you to build a computational model that links satellite-derived vegetation indices (NDVI) to seasonal changes in a watershed's runoff potential . By parameterizing monthly Curve Numbers based on vegetation phenology, you will simulate a more realistic, time-varying hydrologic response and analyze the resulting seasonality in runoff generation.",
            "id": "3844573",
            "problem": "You are given a monthly Normalized Difference Vegetation Index (NDVI) climatology time series for cropland mapped onto Hydrologic Soil Group (HSG) C. The goal is to parameterize monthly Soil Conservation Service (SCS; now Natural Resources Conservation Service) curve number values from land cover and compute event runoff for a prescribed two-year sequence of design storm depths, then assess seasonality in runoff ratios. Build a program that performs these steps for multiple parameter sets and aggregates the results in a single-line output format.\n\nStart from fundamental base relationships and well-tested facts, and do not assume or use shortcut formulas as given. Use the following foundational bases:\n- Remote sensing reflectance-based vegetation index definition: the Normalized Difference Vegetation Index (NDVI) is defined from spectral reflectance as $$\\mathrm{NDVI} = \\frac{\\rho_{\\mathrm{NIR}} - \\rho_{\\mathrm{R}}}{\\rho_{\\mathrm{NIR}} + \\rho_{\\mathrm{R}}}$$ where $\\rho_{\\mathrm{NIR}}$ is near-infrared reflectance and $\\rho_{\\mathrm{R}}$ is red reflectance. NDVI is a monotonic indicator of green vegetation amount and fractional vegetative cover under typical cropland conditions.\n- Hydrologic abstraction framework: the event water balance can be conceptualized as $$P = I_{\\mathrm{a}} + F + Q$$ where $P$ is precipitation depth, $I_{\\mathrm{a}}$ is initial abstraction, $F$ is actual infiltration plus other abstractions, and $Q$ is direct runoff depth. Under the SCS curve number method, the potential maximum retention and initial abstraction are related to land cover and soil properties. Adopt a standard initial abstraction coefficient $\\lambda$ equal to $0.2$.\n- Parameterization principle from land cover: fractional vegetative cover can be estimated from NDVI via a physically consistent linear mapping bounded by representative minimum and maximum NDVI for cropland. Use $\\mathrm{NDVI}_{\\min} = 0.15$ and $\\mathrm{NDVI}_{\\max} = 0.85$. Map NDVI to a fractional vegetation cover that is constrained to the interval $[0,1]$, and use this fractional vegetation cover to linearly interpolate monthly curve numbers between dormant-season and growing-season reference curve numbers for cropland on HSG C.\n- Reference curve numbers for cropland on HSG C under Antecedent Moisture Condition II (AMC II): use a dormant-season curve number $CN_{\\mathrm{d}} = 82$ and a growing-season curve number $CN_{\\mathrm{g}} = 74$.\n\nFor each parameter set, complete the following tasks:\n1. Convert the monthly NDVI climatology to monthly fractional vegetation cover using the specified bounds, then parameterize monthly curve numbers for cropland on HSG C via linear interpolation between $CN_{\\mathrm{d}}$ and $CN_{\\mathrm{g}}$ using the fractional vegetation cover. Ensure the resulting monthly curve numbers are bounded within physically plausible limits for HSG C cropland.\n2. For each monthly design storm depth in the two-year sequence, compute event runoff depth using the SCS curve number method under AMC II, with units in millimeters. If an event yields no runoff consistent with the method’s conditions, return zero runoff for that event. Express all event runoff depths in $\\mathrm{mm}$, rounded to three decimal places.\n3. Compute the runoff ratio for each event as $Q/P$ (dimensionless) and assess seasonality via a threshold on NDVI. Classify months into growing-season if the monthly NDVI is greater than or equal to $0.5$, and dormant-season otherwise. Define the seasonality index as the difference between the mean runoff ratio over all events whose months fall into growing-season minus the mean runoff ratio over all events whose months fall into dormant-season. Round this seasonality index to three decimal places.\n4. Output, for each parameter set, the following in order: the $12$ monthly curve numbers (rounded to one decimal place), the $24$ event runoff depths in $\\mathrm{mm}$ (rounded to three decimal places), and the single seasonality index (rounded to three decimal places).\n\nPhysical units and rounding requirements:\n- Precipitation depths $P$ and runoff depths $Q$ must be in $\\mathrm{mm}$.\n- Monthly curve numbers must be rounded to one decimal place.\n- Event runoff depths must be rounded to three decimal places.\n- Seasonality index must be rounded to three decimal places.\n\nTest suite and parameter sets:\nUse three parameter sets representing different cropland NDVI climatologies and two-year monthly design storm sequences. Each parameter set provides a $12$-month NDVI climatology and a $24$-event sequence of monthly precipitation depths (two consecutive years).\n\nParameter set A (summer row crop climatology):\n- Monthly NDVI (dimensionless): $[0.20,0.22,0.30,0.50,0.65,0.75,0.80,0.78,0.70,0.50,0.35,0.25]$.\n- Two-year monthly precipitation depths in $\\mathrm{mm}$: $[10,20,35,60,90,120,80,70,60,40,25,15,12,18,30,55,95,110,85,65,50,38,22,16]$.\n\nParameter set B (sparser vegetation, more intense storms):\n- Monthly NDVI (dimensionless): $[0.15,0.18,0.20,0.30,0.45,0.55,0.60,0.58,0.50,0.35,0.25,0.18]$.\n- Two-year monthly precipitation depths in $\\mathrm{mm}$: $[5,25,50,80,120,160,140,100,90,60,40,20,8,30,45,85,130,170,150,110,95,70,45,25]$.\n\nParameter set C (winter crop climatology):\n- Monthly NDVI (dimensionless): $[0.60,0.62,0.58,0.50,0.40,0.35,0.30,0.28,0.30,0.40,0.50,0.55]$.\n- Two-year monthly precipitation depths in $\\mathrm{mm}$: $[20,25,30,40,70,90,80,60,50,40,30,25,22,28,32,38,75,95,85,62,52,42,32,26]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list should contain exactly three elements, each corresponding to one parameter set (A, B, C). Each element must itself be a list of three elements: the $12$ rounded monthly curve numbers, the $24$ rounded event runoff depths in $\\mathrm{mm}$, and the rounded seasonality index. For example, the structure is like $[[\\text{CNs}_A,\\text{Qs}_A,\\text{SI}_A],[\\text{CNs}_B,\\text{Qs}_B,\\text{SI}_B],[\\text{CNs}_C,\\text{Qs}_C,\\text{SI}_C]]$ with actual numeric values filled in according to the computations described above.",
            "solution": "The problem is valid. It is scientifically grounded in established principles of remote sensing and hydrology, is well-posed with a complete and consistent set of data and instructions, and is expressed in objective, formal language. The provided parameters and relationships, such as the Normalized Difference Vegetation Index (NDVI), the Soil Conservation Service Curve Number (SCS-CN) method, and the parameterization linkage between them, are standard and widely accepted in environmental modeling. All conditions for a valid problem are met.\n\nThe solution requires a systematic, multi-step calculation for each parameter set, integrating concepts from remote sensing, land cover characterization, and rainfall-runoff modeling. The procedure is detailed below.\n\n**Part 1: Parameterization of Monthly Curve Numbers ($CN$)**\n\nThe first step is to derive a monthly climatology of curve numbers ($CN_i$) from a given monthly NDVI climatology. This is achieved through a two-step process: converting NDVI to fractional vegetation cover ($f_v$), and then interpolating the curve number based on $f_v$.\n\n1.  **From NDVI to Fractional Vegetation Cover ($f_v$)**: The problem posits a linear relationship between NDVI and $f_v$. Given a minimum NDVI value corresponding to bare soil ($\\mathrm{NDVI}_{\\min} = 0.15$) and a maximum NDVI value for full vegetation cover ($\\mathrm{NDVI}_{\\max} = 0.85$), the fractional cover $f_{v,i}$ for a given month $i$ is calculated as:\n    $$f_{v,i} = \\frac{\\mathrm{NDVI}_i - \\mathrm{NDVI}_{\\min}}{\\mathrm{NDVI}_{\\max} - \\mathrm{NDVI}_{\\min}}$$\n    Substituting the given constants, the equation becomes:\n    $$f_{v,i} = \\frac{\\mathrm{NDVI}_i - 0.15}{0.85 - 0.15} = \\frac{\\mathrm{NDVI}_i - 0.15}{0.70}$$\n    The problem specifies that $f_{v,i}$ must be constrained to the interval $[0, 1]$. The provided NDVI data for all test cases fall within the $[\\mathrm{NDVI}_{\\min}, \\mathrm{NDVI}_{\\max}]$ range, so the calculated $f_v$ will naturally be within $[0, 1]$ without explicit clamping.\n\n2.  **From Fractional Cover to Curve Number ($CN$)**: The monthly curve number, $CN_i$, is determined by linearly interpolating between a reference dormant-season curve number ($CN_{\\mathrm{d}} = 82$) and a growing-season curve number ($CN_{\\mathrm{g}} = 74$). The fractional cover, $f_{v,i}$, serves as the interpolation weight. The dormant season corresponds to $f_v = 0$ and the peak growing season to $f_v = 1$. The interpolation formula is:\n    $$CN_i = CN_{\\mathrm{d}} (1 - f_{v,i}) + CN_{\\mathrm{g}} f_{v,i} = CN_{\\mathrm{d}} + f_{v,i} (CN_{\\mathrm{g}} - CN_{\\mathrm{d}})$$\n    Substituting the reference values for cropland on Hydrologic Soil Group (HSG) C:\n    $$CN_i = 82 + f_{v,i} (74 - 82) = 82 - 8 f_{v,i}$$\n    This equation reflects the fact that for the specified cropland, increased vegetation cover (higher $f_v$) leads to a lower curve number, implying higher infiltration and lower runoff potential. The resulting $12$ monthly $CN_i$ values are rounded to one decimal place for the final output.\n\n**Part 2: Computation of Event Runoff Depth ($Q$)**\n\nWith a monthly $CN_i$ climatology, event runoff depth ($Q_j$) can be computed for a given sequence of $24$ monthly precipitation events ($P_j$) using the SCS-CN method.\n\n1.  **Potential Maximum Retention ($S$)**: The curve number is an index that is functionally related to the potential maximum soil moisture retention, $S$. The standard formula, with $S$ in inches, is $S = \\frac{1000}{CN} - 10$. Since precipitation is given in millimeters, we must convert $S$ to millimeters using the conversion factor $1 \\text{ inch} = 25.4 \\text{ mm}$.\n    $$S_i \\text{ [mm]} = 25.4 \\left( \\frac{1000}{CN_i} - 10 \\right)$$\n    This calculation is performed for each of the $12$ monthly curve numbers, using the unrounded $CN_i$ values to maintain precision. The 12-month climatology of $S_i$ is used for both years of the precipitation sequence.\n\n2.  **Initial Abstraction ($I_a$)**: Before runoff can occur, initial abstractions ($I_a$), which include interception, surface storage, and initial infiltration, must be satisfied. $I_a$ is modeled as a fraction of $S$.\n    $$I_{a,i} = \\lambda S_i$$\n    The problem specifies a standard initial abstraction coefficient $\\lambda = 0.2$.\n\n3.  **Runoff Depth ($Q$)**: The SCS-CN equation calculates the direct runoff depth $Q$ from precipitation $P$. Runoff is generated only when precipitation exceeds the initial abstraction, $P > I_a$.\n    $$Q_j = \\begin{cases} \\frac{(P_j - I_{a,i})^2}{P_j - I_{a,i} + S_i} & \\text{if } P_j > I_{a,i} \\\\ 0 & \\text{if } P_j \\le I_{a,i} \\end{cases}$$\n    where $i = (j-1) \\pmod{12}$ for a 1-indexed event $j \\in \\{1, ..., 24\\}$. Substituting $I_{a,i} = 0.2 S_i$:\n    $$Q_j = \\frac{(P_j - 0.2 S_i)^2}{P_j + 0.8 S_i} \\quad \\text{for } P_j > 0.2 S_i$$\n    This calculation is performed for each of the $24$ precipitation events, using the $S_i$ value corresponding to the event's month. The resulting $24$ runoff depths $Q_j$ are rounded to three decimal places.\n\n**Part 3: Calculation of the Seasonality Index ($SI$)**\n\nThe final task is to quantify the seasonal difference in runoff response.\n\n1.  **Runoff Ratio ($R$)**: For each event, the runoff ratio $R_j$ is the dimensionless fraction of precipitation that becomes runoff:\n    $$R_j = \\frac{Q_j}{P_j}$$\n    This calculation is performed for all $24$ events.\n\n2.  **Seasonal Classification**: Months are classified based on their NDVI values.\n    -   Growing Season: if $\\mathrm{NDVI}_i \\ge 0.5$\n    -   Dormant Season: if $\\mathrm{NDVI}_i < 0.5$\n\n3.  **Seasonality Index ($SI$)**: The $SI$ is the difference between the mean runoff-ratio of all growing-season events and the mean runoff-ratio of all dormant-season events.\n    Let $G_E$ be the set of runoff ratios for events occurring in growing-season months and $D_E$ be the set for events in dormant-season months.\n    $$\\overline{R}_{\\text{growing}} = \\frac{1}{|G_E|} \\sum_{R_j \\in G_E} R_j$$\n    $$\\overline{R}_{\\text{dormant}} = \\frac{1}{|D_E|} \\sum_{R_j \\in D_E} R_j$$\n    The seasonality index is then:\n    $$SI = \\overline{R}_{\\text{growing}} - \\overline{R}_{\\text{dormant}}$$\n    This final value is rounded to three decimal places.\n\nThis comprehensive procedure is applied to each of the three parameter sets provided, and the results are compiled into the specified output format.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process all parameter sets and print the final output.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"ndvi_climatology\": [0.20, 0.22, 0.30, 0.50, 0.65, 0.75, 0.80, 0.78, 0.70, 0.50, 0.35, 0.25],\n            \"precipitation_2yr\": [10, 20, 35, 60, 90, 120, 80, 70, 60, 40, 25, 15, 12, 18, 30, 55, 95, 110, 85, 65, 50, 38, 22, 16],\n        },\n        {\n            \"name\": \"B\",\n            \"ndvi_climatology\": [0.15, 0.18, 0.20, 0.30, 0.45, 0.55, 0.60, 0.58, 0.50, 0.35, 0.25, 0.18],\n            \"precipitation_2yr\": [5, 25, 50, 80, 120, 160, 140, 100, 90, 60, 40, 20, 8, 30, 45, 85, 130, 170, 150, 110, 95, 70, 45, 25],\n        },\n        {\n            \"name\": \"C\",\n            \"winter_crop\": True,\n            \"ndvi_climatology\": [0.60, 0.62, 0.58, 0.50, 0.40, 0.35, 0.30, 0.28, 0.30, 0.40, 0.50, 0.55],\n            \"precipitation_2yr\": [20, 25, 30, 40, 70, 90, 80, 60, 50, 40, 30, 25, 22, 28, 32, 38, 75, 95, 85, 62, 52, 42, 32, 26],\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = process_case(\n            case[\"ndvi_climatology\"],\n            case[\"precipitation_2yr\"]\n        )\n        all_results.append(result)\n\n    # Format the final output string to be compact, without spaces within lists.\n    results_str_list = []\n    for res in all_results:\n        cn_str = f\"[{','.join(map(str, res[0]))}]\"\n        qs_str = f\"[{','.join(map(str, res[1]))}]\"\n        si_str = str(res[2])\n        case_str = f\"[{cn_str},{qs_str},{si_str}]\"\n        results_str_list.append(case_str)\n    \n    final_output_str = f\"[{','.join(results_str_list)}]\"\n    print(final_output_str)\n\n\ndef process_case(ndvi_climatology, precipitation_2yr):\n    \"\"\"\n    Processes a single parameter set to calculate CNs, runoff depths, and seasonality index.\n    \"\"\"\n    # --- Constants and Lookups ---\n    NDVI_MIN = 0.15\n    NDVI_MAX = 0.85\n    CN_D = 82.0  # Dormant-season CN for cropland, HSG C, AMC II\n    CN_G = 74.0  # Growing-season CN for cropland, HSG C, AMC II\n    LAMBDA_IA = 0.2  # Initial abstraction coefficient\n    MM_PER_INCH = 25.4\n\n    # Use numpy arrays for vectorized operations\n    ndvi_array = np.array(ndvi_climatology)\n    precip_array = np.array(precipitation_2yr)\n    \n    # --- Task 1: Parameterize Monthly Curve Numbers (CN) ---\n    \n    # Calculate fractional vegetation cover (fv) from NDVI\n    # fv = (NDVI - NDVI_min) / (NDVI_max - NDVI_min)\n    # The problem data for NDVI is within [NDVI_MIN, NDVI_MAX], so no clipping is needed.\n    fv = (ndvi_array - NDVI_MIN) / (NDVI_MAX - NDVI_MIN)\n    \n    # Linearly interpolate to get monthly CN\n    # CN = CN_d + fv * (CN_g - CN_d)\n    cn_monthly_unrounded = CN_D + fv * (CN_G - CN_D)\n    \n    # Round CNs to one decimal place for output\n    cn_monthly_rounded = [round(cn, 1) for cn in cn_monthly_unrounded]\n\n    # --- Task 2: Compute Event Runoff (Q) ---\n    \n    # Calculate potential maximum retention (S) in mm for each month\n    # S_inches = 1000/CN - 10\n    # S_mm = S_inches * 25.4\n    # Using unrounded CN for precision\n    s_monthly_mm = MM_PER_INCH * (1000.0 / cn_monthly_unrounded - 10.0)\n\n    # Calculate initial abstraction (Ia) in mm for each month\n    ia_monthly_mm = LAMBDA_IA * s_monthly_mm\n\n    runoff_depths_q = []\n    runoff_ratios = []\n\n    for i in range(24):\n        month_idx = i % 12\n        P = precip_array[i]\n        S = s_monthly_mm[month_idx]\n        Ia = ia_monthly_mm[month_idx]\n        \n        Q = 0.0\n        if P > Ia:\n            Q = (P - Ia)**2 / (P - Ia + S)\n        \n        runoff_depths_q.append(round(Q, 3))\n        \n        if P > 0:\n            runoff_ratios.append(Q / P)\n        else:\n            runoff_ratios.append(0.0)\n\n    # --- Task 3: Compute Seasonality Index (SI) ---\n\n    # Classify months and events by season\n    growing_season_ratios = []\n    dormant_season_ratios = []\n    \n    for i in range(24):\n        month_idx = i % 12\n        if ndvi_array[month_idx] >= 0.5:\n            growing_season_ratios.append(runoff_ratios[i])\n        else:\n            dormant_season_ratios.append(runoff_ratios[i])\n            \n    # Calculate mean runoff ratios for each season\n    mean_growing_ratio = np.mean(growing_season_ratios) if growing_season_ratios else 0.0\n    mean_dormant_ratio = np.mean(dormant_season_ratios) if dormant_season_ratios else 0.0\n\n    # Calculate Seasonality Index (SI) and round\n    seasonality_index = round(mean_growing_ratio - mean_dormant_ratio, 3)\n\n    return [cn_monthly_rounded, runoff_depths_q, seasonality_index]\n\nsolve()\n```"
        }
    ]
}