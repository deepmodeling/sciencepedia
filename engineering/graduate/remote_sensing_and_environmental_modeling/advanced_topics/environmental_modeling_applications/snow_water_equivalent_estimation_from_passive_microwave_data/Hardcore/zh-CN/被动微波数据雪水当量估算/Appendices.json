{
    "hands_on_practices": [
        {
            "introduction": "在尝试从观测数据中反演雪水当量（SWE）之前，构建一个能够预测给定雪况下微波亮温的正向模型是至关重要的一步。本练习将指导你基于辐射传输的基本原理，一步步建立起这样一个模型，将雪的物理属性（如密度和厚度）与最终的电磁信号联系起来 。通过这个过程，你将深入理解微波与雪相互作用的物理机制，并为更复杂的反演和数据同化任务奠定基础。",
            "id": "3847393",
            "problem": "您的任务是使用基本的辐射传输原理和基于物理的本构关系，设计并实现一个用于观测积雪覆盖地表微波亮度温度（BT）的正向模型。目标是为一组由小型测试套件表示的特定条件，计算大气层顶部的向上亮度温度。建模的场景是一个平面平行、水平均质的干雪层覆盖在土壤之上，在指定的微波频率和观测角度下进行观测。\n\n使用以下基础和定义来推导您将要实现的模型：\n\n- 平面平行吸收介质中的辐射传输：在吸收系数为 $\\kappa_a$、源函数由瑞利-金斯近似给出的介质中，沿路径坐标 $s$ 的比辐射强度由以下微分方程控制\n$$\\frac{dI}{ds} = -\\kappa_a I + \\kappa_a B(T),$$\n其中 $B(T)$ 是普朗克函数在微波频率下通过瑞利-金斯表达式近似的值。\n\n- 亮度温度（BT）定义：在微波频率下，瑞利-金斯近似允许将强度表示为 $I = \\alpha(f) T$，其中 $\\alpha(f)$ 是一个已知的频率相关常数。在此近似下，测量量等效地表示为亮度温度 $T_B$，使得有效发射与 $T_B$ 成正比，并且辐射传输方程可以直接用 $T_B$ 写为\n$$\\frac{d T_B}{ds} = -\\kappa_a T_B + \\kappa_a T(s),$$\n对于温度为 $T(s) = T_{\\text{snow}}$ 的均匀介质。\n\n- 雪-地界面处的边界条件：土壤的特征是地面发射率 $e_g$ 和物理温度 $T_{\\text{ground}}$，因此雪堆底部的向上边界条件是\n$$T_{B,\\text{ground}} = e_g \\, T_{\\text{ground}}.$$\n\n- 被动微波辐射测量（PMR）观测几何：对于一个观测角 $\\theta$（从本地天顶测量），通过物理厚度为 $h$ 的层的路径长度是 $h / \\cos(\\theta)$。\n\n- 雪水当量（SWE）和厚度：雪水当量（SWE）定义为如果雪融化并均匀铺开后所形成的液态水的厚度。设雪的密度为 $\\rho_s$，液态水的密度为 $\\rho_w$。利用单位面积质量守恒，从给定的 SWE 和 $\\rho_s$ 推导出物理雪厚 $h$。\n\n- 电磁衰减和介电特性：对于一个复相对介电常数为 $\\varepsilon = \\varepsilon' + i \\varepsilon''$ 的非磁性、弱损耗介电材料，在低损耗极限下，其复折射率为 $n = \\sqrt{\\varepsilon} \\approx \\sqrt{\\varepsilon'} + i \\left(\\frac{\\varepsilon''}{2\\sqrt{\\varepsilon'}}\\right)$。功率衰减系数（单位为 $\\text{m}^{-1}$）为\n$$\\alpha(f) = \\frac{2\\pi f}{c} \\, \\operatorname{Im}(n) \\approx \\frac{\\pi f}{c} \\frac{\\varepsilon''}{\\sqrt{\\varepsilon'}},$$\n其中 $f$ 是以 $\\text{Hz}$ 为单位的频率，$c$ 是真空中的光速。\n\n- 干雪有效介电常数参数化：使用冰相的体积分数来模拟干雪的有效介电常数。设 $\\rho_i$ 表示纯冰的密度。定义冰体积分数 $\\phi = \\rho_s / \\rho_i$。在微波频率下，对干雪使用以下参数化方法：\n$$\\varepsilon' = 1 + a \\, \\phi, \\quad \\varepsilon'' = b \\, \\phi \\, f_{\\text{GHz}},$$\n其中 $f_{\\text{GHz}}$ 是以 $\\text{GHz}$ 表示的频率，常数 $a = 1.7$，$b = 5 \\times 10^{-4}$。\n\n使用的常数：\n- 光速：$c = 2.99792458 \\times 10^8 \\, \\text{m}\\,\\text{s}^{-1}$。\n- 水的密度：$\\rho_w = 1000 \\, \\text{kg}\\,\\text{m}^{-3}$。\n- 冰的密度：$\\rho_i = 917 \\, \\text{kg}\\,\\text{m}^{-3}$。\n\n采用的假设：\n- 雪层在所考虑的频率下是等温的，且以吸收为主。忽略散射。\n- 忽略空气-雪界面的反射；只有层内吸收和地面发射率对模型有贡献。\n- 瑞利-金斯近似在指定的微波频率下有效。\n\n任务：\n- 从上述基础出发，推导雪层顶部的向上亮度温度 $T_{B,\\text{top}}$ 的正向模型，并实现该模型以计算每个测试用例的 $T_{B,\\text{top}}$。\n- 所有角度均以度为单位指定；根据需要转换为弧度，并一致地使用 $\\cos(\\theta)$。\n- 最终的亮度温度值以 $\\text{K}$ 为单位表示，并四舍五入到三位小数。\n\n测试套件：\n为以下五个案例计算 $T_{B,\\text{top}}$，每个案例定义为一个元组 $(f_{\\text{GHz}}, \\theta_{\\text{deg}}, \\text{SWE}_{\\text{m}}, \\rho_s, T_{\\text{snow}}, T_{\\text{ground}}, e_g)$，单位如注：\n\n1. $(19.35, 0, 0.15, 300, 263, 273, 0.90)$\n2. $(19.35, 0, 0.00, 300, 268, 270, 0.95)$\n3. $(37.00, 0, 0.40, 400, 258, 265, 0.85)$\n4. $(19.35, 0, 0.25, 350, 260, 273, 0.60)$\n5. $(37.00, 50, 0.20, 300, 265, 272, 0.92)$\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,result3,result4,result5]”）。每个结果必须是对应测试用例的亮度温度（单位为 $\\text{K}$），并四舍五入到三位小数。",
            "solution": "该问题要求推导并实现一个用于计算覆盖在土壤上的干雪堆的向上微波亮度温度的正向模型。问题陈述在科学上是合理的、适定的和自洽的，提供了所有必要的物理原理、本构关系、参数和常数。因此，它被认为是一个有效的问题。\n\n推导过程如下。\n\n**步骤 1：从雪水当量（SWE）确定物理雪厚**\n雪水当量 $\\text{SWE}$ 表示雪堆融化后形成的水的高度。单位面积的雪质量由雪密度 $\\rho_s$ 和雪厚 $h$ 的乘积给出。这个质量必须等于等效水柱的质量，即水密度 $\\rho_w$ 和 $\\text{SWE}$ 的乘积。\n$$ \\text{mass per unit area} = \\rho_s h = \\rho_w \\text{SWE} $$\n根据这个质量守恒定律，我们可以将物理雪厚 $h$ 表示为：\n$$ h = \\text{SWE} \\frac{\\rho_w}{\\rho_s} $$\n\n**步骤 2：表征雪堆的介电和吸收特性**\n干雪的电磁特性由其有效复介电常数 $\\varepsilon = \\varepsilon' + i \\varepsilon''$ 决定。问题提供了一个基于冰体积分数 $\\phi$ 的参数化方法。\n冰体积分数是雪密度 $\\rho_s$ 与纯冰密度 $\\rho_i$ 的比值：\n$$ \\phi = \\frac{\\rho_s}{\\rho_i} $$\n有效介电常数的实部（$\\varepsilon'$）和虚部（$\\varepsilon''$）由下式给出：\n$$ \\varepsilon' = 1 + a \\phi $$\n$$ \\varepsilon'' = b \\phi f_{\\text{GHz}} $$\n其中 $f_{\\text{GHz}}$ 是以千兆赫兹为单位的微波频率，$a=1.7$ 和 $b=5 \\times 10^{-4}$ 是经验常数。\n\n雪中微波的吸收由功率吸收系数 $\\kappa_a$ 决定。对于弱损耗介电介质，这与复折射率 $n = \\sqrt{\\varepsilon}$ 的虚部有关。吸收系数由下式给出：\n$$ \\kappa_a = \\frac{\\pi f}{c} \\frac{\\varepsilon''}{\\sqrt{\\varepsilon'}} $$\n这里，$f$ 是以赫兹为单位的频率（$f = f_{\\text{GHz}} \\times 10^9$），$c$ 是真空中的光速。\n\n**步骤 3：求解辐射传输方程（RTE）**\n问题通过忽略散射并假设雪堆在温度 $T_{\\text{snow}}$ 下是等温的，从而简化了辐射传输过程。沿着路径坐标 $s$ 的亮度温度 $T_B$ 的辐射传输方程（RTE）如下：\n$$ \\frac{dT_B}{ds} = -\\kappa_a T_B + \\kappa_a T_{\\text{snow}} $$\n这是一个一阶线性常微分方程。我们可以通过定义一个坐标系来求解它，其中 $s=0$ 位于雪-地界面，并沿观测路径向上增加。路径与天顶的夹角为 $\\theta$，因此穿过厚度为 $h$ 的雪堆的总路径长度 $L$ 为 $L = h / \\cos(\\theta)$。\n\nRTE 的通解是：\n$$ T_B(s) = T_{\\text{snow}} + C e^{-\\kappa_a s} $$\n其中 $C$ 是由雪堆底部（$s=0$）的边界条件决定的积分常数。\n\n雪-地界面处的边界条件是从地面向上发射的亮度温度 $T_{B,\\text{ground}}$，由下式给出：\n$$ T_B(0) = T_{B,\\text{ground}} = e_g T_{\\text{ground}} $$\n其中 $e_g$ 是地面发射率，$T_{\\text{ground}}$ 是地面的物理温度。\n\n在 $s=0$ 处将此边界条件应用于通解：\n$$ T_B(0) = T_{\\text{snow}} + C e^{-\\kappa_a (0)} = T_{\\text{snow}} + C $$\n$$ \\implies C = T_B(0) - T_{\\text{snow}} = e_g T_{\\text{ground}} - T_{\\text{snow}} $$\n将 $C$ 代回通解，得到雪堆内的亮度温度分布：\n$$ T_B(s) = T_{\\text{snow}} + (e_g T_{\\text{ground}} - T_{\\text{snow}}) e^{-\\kappa_a s} $$\n\n**步骤 4：计算雪-气界面处的向上亮度温度**\n所求的量是雪层顶部的向上亮度温度 $T_{B,\\text{top}}$，它对应于 $T_B(s=L)$。我们将 $s=L$ 代入方程：\n$$ T_{B,\\text{top}} = T_B(L) = T_{\\text{snow}} + (e_g T_{\\text{ground}} - T_{\\text{snow}}) e^{-\\kappa_a L} $$\n代入 $L = h / \\cos(\\theta)$，我们得到：\n$$ T_{B,\\text{top}} = T_{\\text{snow}} + (e_g T_{\\text{ground}} - T_{\\text{snow}}) e^{-\\kappa_a h / \\cos(\\theta)} $$\n设雪堆的透射率为 $\\tau(\\theta) = e^{-\\kappa_a h / \\cos(\\theta)}$。该方程可以重排成一个更符合物理直觉的形式：\n$$ T_{B,\\text{top}} = T_{\\text{snow}} (1 - e^{-\\kappa_a h / \\cos(\\theta)}) + (e_g T_{\\text{ground}}) e^{-\\kappa_a h / \\cos(\\theta)} $$\n$$ T_{B,\\text{top}} = T_{\\text{snow}}(1-\\tau(\\theta)) + T_{B,\\text{ground}} \\tau(\\theta) $$\n该表达式表明，观测到的亮度温度是两个分量的总和：雪堆自身的发射，$T_{\\text{snow}}(1-\\tau(\\theta))$，以及被雪堆衰减的下方地面的发射，$T_{B,\\text{ground}} \\tau(\\theta)$。项 $(1-\\tau(\\theta))$ 代表雪层的有效发射率。\n\n因此，完整的正向模型是通过依次计算 $h$、$\\phi$、$\\varepsilon'$、$\\varepsilon''$、$\\kappa_a$，并最终使用推导出的表达式计算 $T_{B,\\text{top}}$ 来构建的。对于 $\\text{SWE} = 0$ 的特殊情况，雪厚 $h=0$，路径长度 $L=0$，透射率 $\\tau(\\theta)=1$，模型正确地简化为 $T_{B,\\text{top}} = e_g T_{\\text{ground}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the upward brightness temperature (BT) at the top of a snow layer\n    for a given set of environmental and observational parameters.\n    \"\"\"\n\n    # Define physical and model constants\n    C_LIGHT = 2.99792458e8  # Speed of light in vacuum, m/s\n    RHO_WATER = 1000.0      # Density of liquid water, kg/m^3\n    RHO_ICE = 917.0         # Density of pure ice, kg/m^3\n    A_PERMITTIVITY = 1.7    # Empirical constant for real part of permittivity\n    B_PERMITTIVITY = 5.0e-4 # Empirical constant for imaginary part of permittivity\n\n    # Test suite: (f_GHz, theta_deg, SWE_m, rho_s, T_snow, T_ground, e_g)\n    test_cases = [\n        (19.35, 0, 0.15, 300, 263, 273, 0.90),\n        (19.35, 0, 0.00, 300, 268, 270, 0.95),\n        (37.00, 0, 0.40, 400, 258, 265, 0.85),\n        (19.35, 0, 0.25, 350, 260, 273, 0.60),\n        (37.00, 50, 0.20, 300, 265, 272, 0.92),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_ghz, theta_deg, swe_m, rho_s, t_snow, t_ground, e_g = case\n\n        # Handle the trivial case of no snow\n        if swe_m == 0.0:\n            tb_top = e_g * t_ground\n            results.append(round(tb_top, 3))\n            continue\n\n        # Step 1: Calculate physical snow thickness (h) from SWE\n        # rho_s * h = rho_w * SWE  =>  h = SWE * (rho_w / rho_s)\n        h = swe_m * (RHO_WATER / rho_s)\n\n        # Step 2: Characterize snowpack dielectric and absorption properties\n        # Ice volume fraction\n        phi = rho_s / RHO_ICE\n\n        # Real and imaginary parts of relative permittivity\n        eps_prime = 1 + A_PERMITTIVITY * phi\n        eps_double_prime = B_PERMITTIVITY * phi * f_ghz\n\n        # Absorption coefficient (kappa_a) in Np/m\n        f_hz = f_ghz * 1e9\n        kappa_a = (np.pi * f_hz / C_LIGHT) * (eps_double_prime / np.sqrt(eps_prime))\n\n        # Step 3  4: Calculate final brightness temperature at the top\n        # Convert viewing angle to radians\n        theta_rad = np.deg2rad(theta_deg)\n        \n        # Calculate cos(theta). Handle theta=90 to avoid division by zero, though not in test cases.\n        cos_theta = np.cos(theta_rad)\n        if cos_theta == 0:\n            # Path length is infinite, so transmissivity is zero\n            transmissivity = 0.0\n        else:\n            # Optical depth along the slant path\n            optical_depth = kappa_a * h / cos_theta\n            \n            # Transmissivity of the snowpack\n            transmissivity = np.exp(-optical_depth)\n\n        # Brightness temperature from the ground\n        tb_ground_up = e_g * t_ground\n\n        # Final brightness temperature at the top of the snowpack\n        # T_B_top = T_snow * (1 - tau) + T_B_ground * tau\n        tb_top = t_snow * (1 - transmissivity) + tb_ground_up * transmissivity\n\n        results.append(round(tb_top, 3))\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) is robust for different number types\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "卫星在太空接收到的微波信号不仅包含来自雪层的信息，还混杂了大气自身的发射和衰减效应。本练习将引导你完成大气校正这一关键的预处理步骤，运用辐射传输原理，从卫星观测的顶层大气（TOA）亮温中剥离大气的影响，还原出地表真实的微波辐射特征 。掌握这一技能对于确保雪水当量反演的准确性至关重要，是连接遥感观测与地表真实物理过程的桥梁。",
            "id": "3847382",
            "problem": "一个被积雪覆盖的陆地像素由星载被动微波辐射计在两个频率 $18.7\\,\\mathrm{GHz}$ 和 $36.5\\,\\mathrm{GHz}$ 上以垂直极化方式进行观测。任务是使用第一性原理辐射传输对测量到的大气层顶（TOA）亮温进行大气校正，然后使用经验校准的线性映射将校正后的地表发射亮温转换为雪水当量（SWE）。\n\n从平面平行、非散射大气的标量辐射传输方程和瑞利-金斯近似（亮温形式）出发，结合雪-气界面的基尔霍夫定律，推导将大气层顶亮温与地表出射亮温及大气项联系起来的前向表达式。由此表达式，解析求解出每个频率下作为大气层顶亮温、单向大气透射率和有效上行大气温度函数的地表出射亮温。然后，利用地表边界条件去除反射的下行大气贡献，从而获得每个频率下纯粹由地表发射的亮温。\n\n使用以下物理上合理且自洽的参数：\n- 测得的大气层顶亮温：$T_{B,\\mathrm{toa}}(18.7\\,\\mathrm{GHz}) = 240.5\\,\\mathrm{K}$，$T_{B,\\mathrm{toa}}(36.5\\,\\mathrm{GHz}) = 226.7\\,\\mathrm{K}$。\n- 单向大气透射率：$\\tau(18.7\\,\\mathrm{GHz}) = 0.90$，$\\tau(36.5\\,\\mathrm{GHz}) = 0.80$。\n- 有效上行大气温度：$T_{\\mathrm{atm}}^{\\uparrow}(18.7\\,\\mathrm{GHz}) = 260\\,\\mathrm{K}$，$T_{\\mathrm{atm}}^{\\uparrow}(36.5\\,\\mathrm{GHz}) = 265\\,\\mathrm{K}$。\n- 入射到地表的有效下行大气亮温：$T_{\\mathrm{atm}}^{\\downarrow}(18.7\\,\\mathrm{GHz}) = 30\\,\\mathrm{K}$，$T_{\\mathrm{atm}}^{\\downarrow}(36.5\\,\\mathrm{GHz}) = 40\\,\\mathrm{K}$。\n- 雪的有效天底发射率（垂直极化）：$\\epsilon(18.7\\,\\mathrm{GHz}) = 0.95$，$\\epsilon(36.5\\,\\mathrm{GHz}) = 0.85$。\n\n假设 $T_{\\mathrm{atm}}^{\\downarrow}$ 已包含宇宙微波背景辐射的贡献。在获得地表发射亮温 $T_{B,\\mathrm{emit}}(18.7\\,\\mathrm{GHz})$ 和 $T_{B,\\mathrm{emit}}(36.5\\,\\mathrm{GHz})$ 后，使用区域校准的一阶线性映射将其转换为雪水当量（SWE）：\n$$\n\\mathrm{SWE} = \\gamma_{1}\\,\\big[T_{B,\\mathrm{emit}}(18.7\\,\\mathrm{GHz}) - T_{B,\\mathrm{emit}}(36.5\\,\\mathrm{GHz})\\big] + \\gamma_{0},\n$$\n其中系数为 $\\gamma_{1} = 1.20\\,\\mathrm{mm}\\,\\mathrm{K}^{-1}$ 和 $\\gamma_{0} = 5.0\\,\\mathrm{mm}$。\n\n计算最终的 $\\mathrm{SWE}$，并以毫米水当量表示（记为等效深度，其中 $1\\,\\mathrm{mm} \\equiv 1\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}$）。将最终数值答案四舍五入至四位有效数字。",
            "solution": "该问题基于辐射传输的科学原理，设定良好，数据充分且一致，语言客观正式。我们可以开始求解。\n\n任务是首先对被动微波亮温数据进行大气校正，然后使用校正后的数据估算雪水当量（SWE）。这将通过以下三个主要步骤完成：\n1.  推导大气校正的关系式。\n2.  将该校正应用于给定两个频率的数据。\n3.  使用校正后的亮温计算SWE。\n\n令 $\\nu$ 表示频率。对于非散射的平面平行大气，在瑞利-金斯近似下，以亮温表示的辐射传输方程将大气层顶（TOA）亮温 $T_{B,\\mathrm{toa}}(\\nu)$ 与地表出射亮温 $T_{B,\\mathrm{surf}}(\\nu)$ 及大气属性联系起来。该方程为：\n$$\nT_{B,\\mathrm{toa}}(\\nu) = T_{B,\\mathrm{surf}}(\\nu) \\tau(\\nu) + T_{\\mathrm{atm}}^{\\uparrow}(\\nu) (1 - \\tau(\\nu))\n$$\n其中 $\\tau(\\nu)$ 是单向大气透射率，$T_{\\mathrm{atm}}^{\\uparrow}(\\nu)$ 是有效上行大气温度。\n\n首先，我们必须求解此方程以得到地表出射亮温 $T_{B,\\mathrm{surf}}(\\nu)$。这个量相当于位于地表向上看的传感器所测量到的值。整理该方程：\n$$\nT_{B,\\mathrm{surf}}(\\nu) \\tau(\\nu) = T_{B,\\mathrm{toa}}(\\nu) - T_{\\mathrm{atm}}^{\\uparrow}(\\nu) (1 - \\tau(\\nu))\n$$\n$$\nT_{B,\\mathrm{surf}}(\\nu) = \\frac{T_{B,\\mathrm{toa}}(\\nu) - T_{\\mathrm{atm}}^{\\uparrow}(\\nu) (1 - \\tau(\\nu))}{\\tau(\\nu)}\n$$\n这就是从地表正上方看到的大气校正后的亮温。\n\n接下来，我们必须去除被雪面反射的下行大气辐射的贡献。地表出射亮温 $T_{B,\\mathrm{surf}}(\\nu)$ 是两个分量的和：地表发射的辐射和地表反射的辐射。\n$$\nT_{B,\\mathrm{surf}}(\\nu) = T_{B,\\mathrm{emit}}(\\nu) + T_{B,\\mathrm{refl}}(\\nu)\n$$\n发射分量为 $T_{B,\\mathrm{emit}}(\\nu) = \\epsilon(\\nu) T_s$，其中 $\\epsilon(\\nu)$ 是地表发射率，$T_s$ 是雪面的物理温度。反射分量为 $T_{B,\\mathrm{refl}}(\\nu) = \\rho(\\nu) T_{\\mathrm{atm}}^{\\downarrow}(\\nu)$，其中 $\\rho(\\nu)$ 是地表反射率，$T_{\\mathrm{atm}}^{\\downarrow}(\\nu)$ 是入射到地表的下行大气亮温。\n\n根据热平衡状态下不透明物体的基尔霍夫定律，有 $\\epsilon(\\nu) + \\rho(\\nu) = 1$。因此，反射率为 $\\rho(\\nu) = 1 - \\epsilon(\\nu)$。将此代入 $T_{B,\\mathrm{surf}}(\\nu)$ 的表达式中：\n$$\nT_{B,\\mathrm{surf}}(\\nu) = T_{B,\\mathrm{emit}}(\\nu) + (1 - \\epsilon(\\nu)) T_{\\mathrm{atm}}^{\\downarrow}(\\nu)\n$$\n我们的目标是求出纯粹由地表发射的亮温 $T_{B,\\mathrm{emit}}(\\nu)$。整理上述方程可得：\n$$\nT_{B,\\mathrm{emit}}(\\nu) = T_{B,\\mathrm{surf}}(\\nu) - (1 - \\epsilon(\\nu)) T_{\\mathrm{atm}}^{\\downarrow}(\\nu)\n$$\n通过合并两个推导出的表达式，我们得到以测得的大气层顶亮温和其他参数表示的 $T_{B,\\mathrm{emit}}(\\nu)$ 的完整公式：\n$$\nT_{B,\\mathrm{emit}}(\\nu) = \\frac{T_{B,\\mathrm{toa}}(\\nu) - T_{\\mathrm{atm}}^{\\uparrow}(\\nu) (1 - \\tau(\\nu))}{\\tau(\\nu)} - (1 - \\epsilon(\\nu)) T_{\\mathrm{atm}}^{\\downarrow}(\\nu)\n$$\n现在我们将此公式应用于两个给定频率 $\\nu_1 = 18.7\\,\\mathrm{GHz}$ 和 $\\nu_2 = 36.5\\,\\mathrm{GHz}$ 的数据。\n\n对于 $\\nu_1 = 18.7\\,\\mathrm{GHz}$：\n-   $T_{B,\\mathrm{toa}}(18.7\\,\\mathrm{GHz}) = 240.5\\,\\mathrm{K}$\n-   $\\tau(18.7\\,\\mathrm{GHz}) = 0.90$\n-   $T_{\\mathrm{atm}}^{\\uparrow}(18.7\\,\\mathrm{GHz}) = 260\\,\\mathrm{K}$\n-   $T_{\\mathrm{atm}}^{\\downarrow}(18.7\\,\\mathrm{GHz}) = 30\\,\\mathrm{K}$\n-   $\\epsilon(18.7\\,\\mathrm{GHz}) = 0.95$\n\n首先，计算地表出射亮温：\n$$\nT_{B,\\mathrm{surf}}(18.7\\,\\mathrm{GHz}) = \\frac{240.5 - 260 \\cdot (1 - 0.90)}{0.90} = \\frac{240.5 - 260 \\cdot 0.10}{0.90} = \\frac{240.5 - 26}{0.90} = \\frac{214.5}{0.90} = 238.\\overline{3}\\,\\mathrm{K}\n$$\n接下来，计算地表发射亮温：\n$$\nT_{B,\\mathrm{emit}}(18.7\\,\\mathrm{GHz}) = 238.\\overline{3} - (1 - 0.95) \\cdot 30 = 238.\\overline{3} - 0.05 \\cdot 30 = 238.\\overline{3} - 1.5 = 236.8\\overline{3}\\,\\mathrm{K}\n$$\n\n对于 $\\nu_2 = 36.5\\,\\mathrm{GHz}$：\n-   $T_{B,\\mathrm{toa}}(36.5\\,\\mathrm{GHz}) = 226.7\\,\\mathrm{K}$\n-   $\\tau(36.5\\,\\mathrm{GHz}) = 0.80$\n-   $T_{\\mathrm{atm}}^{\\uparrow}(36.5\\,\\mathrm{GHz}) = 265\\,\\mathrm{K}$\n-   $T_{\\mathrm{atm}}^{\\downarrow}(36.5\\,\\mathrm{GHz}) = 40\\,\\mathrm{K}$\n-   $\\epsilon(36.5\\,\\mathrm{GHz}) = 0.85$\n\n首先，计算地表出射亮温：\n$$\nT_{B,\\mathrm{surf}}(36.5\\,\\mathrm{GHz}) = \\frac{226.7 - 265 \\cdot (1 - 0.80)}{0.80} = \\frac{226.7 - 265 \\cdot 0.20}{0.80} = \\frac{226.7 - 53}{0.80} = \\frac{173.7}{0.80} = 217.125\\,\\mathrm{K}\n$$\n接下来，计算地表发射亮温：\n$$\nT_{B,\\mathrm{emit}}(36.5\\,\\mathrm{GHz}) = 217.125 - (1 - 0.85) \\cdot 40 = 217.125 - 0.15 \\cdot 40 = 217.125 - 6 = 211.125\\,\\mathrm{K}\n$$\n\n最后，我们使用所提供的线性映射计算雪水当量（SWE）：\n$$\n\\mathrm{SWE} = \\gamma_{1}\\,\\big[T_{B,\\mathrm{emit}}(18.7\\,\\mathrm{GHz}) - T_{B,\\mathrm{emit}}(36.5\\,\\mathrm{GHz})\\big] + \\gamma_{0}\n$$\n系数为 $\\gamma_{1} = 1.20\\,\\mathrm{mm}\\,\\mathrm{K}^{-1}$ 和 $\\gamma_{0} = 5.0\\,\\mathrm{mm}$。\n\n首先，计算亮温差：\n$$\n\\Delta T_B = T_{B,\\mathrm{emit}}(18.7\\,\\mathrm{GHz}) - T_{B,\\mathrm{emit}}(36.5\\,\\mathrm{GHz}) = 236.8\\overline{3}\\,\\mathrm{K} - 211.125\\,\\mathrm{K}\n$$\n为保持精度，我们可以使用分数：$236.8\\overline{3} = 236 + \\frac{5}{6}$ 和 $211.125 = 211 + \\frac{1}{8}$。\n$$\n\\Delta T_B = \\left(236 + \\frac{5}{6}\\right) - \\left(211 + \\frac{1}{8}\\right) = 25 + \\left(\\frac{5}{6} - \\frac{1}{8}\\right) = 25 + \\left(\\frac{20 - 3}{24}\\right) = 25 + \\frac{17}{24} = \\frac{617}{24}\\,\\mathrm{K}\n$$\n以小数形式表示，$\\Delta T_B \\approx 25.708\\overline{3}\\,\\mathrm{K}$。\n\n现在将此值代入SWE方程：\n$$\n\\mathrm{SWE} = 1.20 \\cdot \\left(\\frac{617}{24}\\right) + 5.0\n$$\n$$\n\\mathrm{SWE} = \\frac{1.20}{24} \\cdot 617 + 5.0 = \\frac{1}{20} \\cdot 617 + 5.0 = 30.85 + 5.0 = 35.85\\,\\mathrm{mm}\n$$\n题目要求将最终答案四舍五入至四位有效数字。计算出的值 $35.85$ 已经有四位有效数字。",
            "answer": "$$\n\\boxed{35.85}\n$$"
        },
        {
            "introduction": "在实际应用中，我们不仅有卫星观测，还常常有来自陆面过程模型的“背景”预测值，数据同化技术能够以统计最优的方式融合这两者。本练习将你带入一维变分（1D-Var）数据同化的世界，你将通过构建并最小化一个成本函数，来找到综合了模型预测和卫星观测信息的最优雪水当量（SWE）估计 。这项实践模拟了现代环境监测与预报系统中的核心流程，让你掌握如何根据不同信息源的置信度进行加权，从而获得比单一来源更可靠的分析结果。",
            "id": "3847379",
            "problem": "你的任务是实现一个一维变分数据同化方法，使用一个简单的陆面雪模式，通过单个陆地像元上两个频率的被动微波亮度温度（BT）观测值来估算雪水当量（SWE）。该估算应基于晴空天底观测条件下微波遥感辐射传输的第一性原理和经过充分检验的公式。\n\n基本出发点：\n- 对于平面平行、无发射的大气和天底观测条件，频率为 $f$ 的观测微波亮度温度（BT），记为 $T_{B,f}$，可近似为 $T_{B,f} \\approx \\epsilon_f T_s$，其中 $\\epsilon_f$ 是频率 $f$ 下的有效表面发射率，$T_s$ 是积雪表层的整体物理温度。\n- 对于干雪，随着光程的增加，体散射会降低有效发射率。一个与光程和散射相关的关键状态变量是雪水当量（SWE），记为 $x$，单位为毫米（$\\mathrm{mm}$）。在参考背景值 $x_b$ 附近，频率 $f$ 下的发射率可以使用一阶泰勒展开进行线性化，即 $\\epsilon_f(x) \\approx \\epsilon_{0,f} - k_f x$，其中 $\\epsilon_{0,f} \\in (0,1)$ 是零雪水当量时的发射率，$k_f > 0$ 是一个散射斜率系数，单位为 $\\mathrm{mm}^{-1}$。\n\n模型与数据同化框架：\n- 将 SWE $x$ 映射到两个微波频率 $f_1$ 和 $f_2$ 上的 BT 的观测算子是一个向量函数 $H(x)$，其第 $i$ 个分量为 $H_i(x) = T_s \\epsilon_{f_i}(x)$，其中 $\\epsilon_{f_i}(x)$ 通过上述线性化方法近似。\n- 分析过程被表述为一个一维变分（1D-Var）问题。设背景场 SWE 为 $x_b$，背景误差方差为 $B > 0$，观测 BT 为 $y = [y_1, y_2]^T$，观测误差协方差为 $R = \\mathrm{diag}(\\sigma_{y_1}^2, \\sigma_{y_2}^2)$，其中 $\\sigma_{y_i}^2 > 0$。假设误差服从高斯分布，待最小化的代价函数为\n$$\nJ(x) = (x - x_b)^2 B^{-1} + (y - H(x))^T R^{-1} (y - H(x)).\n$$\n- 你必须从给定的物理基础和定义出发，推导出标量 $x$ 的梯度 $\\nabla J(x)$ 和 Hessian 矩阵，并在线性化观测算子下获得 $x$ 的闭式解分析。你必须实现得到的后验平均 SWE（分析值）$x_a$ 的计算，并施加其非负物理约束（即，如果需要，通过投影强制 $x_a \\geq 0$）。你无需输出后验方差，但推导过程应与所设定的统计模型一致。\n\n单位与输出：\n- 所有亮度温度 $T_{B,f}$ 和物理温度 $T_s$ 的单位均为开尔文 $\\mathrm{K}$。\n- 雪水当量 $x$ 必须以毫米 $\\mathrm{mm}$ 为单位。\n- 你的程序应生成一行输出，其中包含每个测试用例的后验 SWE 估算值 $x_a$，单位为 $\\mathrm{mm}$，四舍五入到三位小数，格式为方括号内以逗号分隔的列表（例如，`[12.345,67.890,0.000]`）。\n\n测试套件：\n为以下五个测试用例实现你的解决方案。每个用例都指定了 $T_s$、发射率参数 $\\epsilon_{0,f}$、散射斜率 $k_f$、观测 BT $y$、背景值 $x_b$、背景方差 $B$ 以及两个通道的观测误差方差。\n\n- 用例 1（理想路径，中等 SWE，中等误差）：\n  - $T_s = 260\\,\\mathrm{K}$\n  - 频率：$f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.95$，$\\epsilon_{0,f_2} = 0.92$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [241.1\\,\\mathrm{K}, 227.4\\,\\mathrm{K}]$\n  - $x_b = 100\\,\\mathrm{mm}$，$B = 900\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 9.0\\,\\mathrm{K}^2)$\n\n- 用例 2（近零 SWE，背景场和观测值置信度较高）：\n  - $T_s = 260\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.95$，$\\epsilon_{0,f_2} = 0.92$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [246.8\\,\\mathrm{K}, 238.8\\,\\mathrm{K}]$\n  - $x_b = 20\\,\\mathrm{mm}$，$B = 400\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 4.0\\,\\mathrm{K}^2)$\n\n- 用例 3（高 SWE，背景不确定性较大，中等观测误差）：\n  - $T_s = 260\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.95$，$\\epsilon_{0,f_2} = 0.92$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [235.1\\,\\mathrm{K}, 216.2\\,\\mathrm{K}]$\n  - $x_b = 250\\,\\mathrm{mm}$，$B = 1600\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(9.0\\,\\mathrm{K}^2, 9.0\\,\\mathrm{K}^2)$\n\n- 用例 4（较冷地表，中等 SWE，混合观测误差）：\n  - $T_s = 240\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.96$，$\\epsilon_{0,f_2} = 0.93$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [226.1\\,\\mathrm{K}, 214.7\\,\\mathrm{K}]$\n  - $x_b = 130\\,\\mathrm{mm}$，$B = 900\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 9.0\\,\\mathrm{K}^2)$\n\n- 用例 5（较暖地表，中高 SWE，第二通道高度不确定）：\n  - $T_s = 265\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.94$，$\\epsilon_{0,f_2} = 0.91$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [241.9\\,\\mathrm{K}, 226.9\\,\\mathrm{K}]$\n  - $x_b = 160\\,\\mathrm{mm}$，$B = 900\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 25.0\\,\\mathrm{K}^2)$\n\n实现要求：\n- 从上面描述的辐射传输基础出发，使用指定的观测算子和线性化假设，从代价函数 $J(x)$ 推导出后验平均值 $x_a$ 的解析表达式。\n- 为每个测试用例实现 $x_a$ 的计算，并在必要时通过投影到可行集上来强制 $x_a \\geq 0$。\n- 你的程序必须生成一行输出，其中包含五个测试用例的后验 SWE 估算值，单位为 $\\mathrm{mm}$，四舍五入到三位小数，格式为方括号内以逗号分隔的列表。",
            "solution": "该问题已经过验证，被认为是具有科学依据、适定、客观和完整的。它构成了基于雪的微波辐射传输物理学，带线性观测算子的一维变分数据同化（1D-Var）的一个标准练习。所有必要的参数和条件均已提供，可得出唯一解。\n\n目标是找到雪水当量（SWE），由标量状态变量 $x$ 表示，该值能够最小化以下代价函数 $J(x)$:\n$$\nJ(x) = (x - x_b)^2 B^{-1} + (y - H(x))^T R^{-1} (y - H(x))\n$$\n其中 $x_b$ 是 SWE 的背景估算值，其误差方差为 $B$，$y$ 是两个频率上的观测亮度温度（BT）向量，$R$ 是对角观测误差协方差矩阵，$H(x)$ 是将状态 $x$ 映射到观测空间的观测算子。\n\n首先，我们必须明确定义观测算子 $H(x)$ 及其雅可比矩阵。问题陈述，频率 $f$ 下的 BT，$T_{B,f}$，可近似为 $T_{B,f} \\approx \\epsilon_f T_s$，其中 $T_s$ 是雪的物理温度，$\\epsilon_f$ 是发射率。发射率相对于 SWE $x$ 线性化为 $\\epsilon_f(x) \\approx \\epsilon_{0,f} - k_f x$。\n对于两个频率 $f_1$ 和 $f_2$，向量观测算子 $H(x)$ 为：\n$$\nH(x) = \\begin{pmatrix} T_s (\\epsilon_{0,f_1} - k_{f_1} x) \\\\ T_s (\\epsilon_{0,f_2} - k_{f_2} x) \\end{pmatrix}\n$$\n这是一个关于 $x$ 的线性算子。我们可以将其表示为 $H(x) = \\mathbf{h}_0 - \\mathbf{h}x$ 的形式，其中：\n$$\n\\mathbf{h}_0 = T_s \\begin{pmatrix} \\epsilon_{0,f_1} \\\\ \\epsilon_{0,f_2} \\end{pmatrix} \\quad \\text{和} \\quad \\mathbf{h} = T_s \\begin{pmatrix} k_{f_1} \\\\ k_{f_2} \\end{pmatrix}\n$$\n$\\mathbf{h}_0$ 表示零积雪（$x=0$）时的 BT，向量 $\\mathbf{h}$ 表示 BT 对 SWE 的敏感度。\n\n为了找到代价函数 $J(x)$ 的最小值，我们必须计算其关于 $x$ 的梯度并将其设为零。\n$$\nJ(x) = B^{-1}(x - x_b)^2 + (y - (\\mathbf{h}_0 - \\mathbf{h}x))^T R^{-1} (y - (\\mathbf{h}_0 - \\mathbf{h}x))\n$$\n让我们定义新息向量（观测值减去 $x=0$ 时的预报值）为 $\\mathbf{d} = y - \\mathbf{h}_0$。代价函数变为：\n$$\nJ(x) = B^{-1}(x - x_b)^2 + (\\mathbf{d} + \\mathbf{h}x)^T R^{-1} (\\mathbf{d} + \\mathbf{h}x)\n$$\n展开观测项：\n$$\n(\\mathbf{d} + \\mathbf{h}x)^T R^{-1} (\\mathbf{d} + \\mathbf{h}x) = \\mathbf{d}^T R^{-1} \\mathbf{d} + \\mathbf{d}^T R^{-1} \\mathbf{h}x + x\\mathbf{h}^T R^{-1} \\mathbf{d} + x^2\\mathbf{h}^T R^{-1} \\mathbf{h}\n$$\n由于所有项都是标量，且 $R^{-1}$ 是对称的，所以 $\\mathbf{d}^T R^{-1} \\mathbf{h}x = x\\mathbf{h}^T R^{-1} \\mathbf{d}$。表达式简化为：\n$$\nJ(x) = B^{-1}(x^2 - 2x_b x + x_b^2) + \\mathbf{d}^T R^{-1} \\mathbf{d} + 2x(\\mathbf{h}^T R^{-1} \\mathbf{d}) + x^2(\\mathbf{h}^T R^{-1} \\mathbf{h})\n$$\n关于 $x$ 的梯度（一阶导数）是：\n$$\n\\frac{dJ}{dx} = 2B^{-1}(x - x_b) + 2(\\mathbf{h}^T R^{-1} \\mathbf{d}) + 2x(\\mathbf{h}^T R^{-1} \\mathbf{h})\n$$\n将梯度设为 0 以求最小值：\n$$\nB^{-1}(x_a - x_b) + \\mathbf{h}^T R^{-1} \\mathbf{d} + x_a(\\mathbf{h}^T R^{-1} \\mathbf{h}) = 0\n$$\n其中 $x_a$ 是 $x$ 的分析（最优）值。我们求解 $x_a$：\n$$\nx_a(B^{-1} + \\mathbf{h}^T R^{-1} \\mathbf{h}) = x_b B^{-1} - \\mathbf{h}^T R^{-1} \\mathbf{d}\n$$\n将 $\\mathbf{d} = y - \\mathbf{h}_0$ 代回方程：\n$$\nx_a(B^{-1} + \\mathbf{h}^T R^{-1} \\mathbf{h}) = x_b B^{-1} - \\mathbf{h}^T R^{-1} (y - \\mathbf{h}_0)\n$$\n这就给出了分析 SWE $x_a$ 的闭式解：\n$$\nx_a = \\frac{x_b B^{-1} - \\mathbf{h}^T R^{-1} (y - \\mathbf{h}_0)}{B^{-1} + \\mathbf{h}^T R^{-1} \\mathbf{h}}\n$$\n二阶导数（Hessian 矩阵）为 $\\frac{d^2J}{dx^2} = 2(B^{-1} + \\mathbf{h}^T R^{-1}\\mathbf{h})$。由于 $B > 0$ 且 $R$ 是一个正定协方差矩阵，所以 $R^{-1}$ 也是正定的。项 $\\mathbf{h}^T R^{-1}\\mathbf{h}$ 是一个二次型，它是非负的，并且如果 $\\mathbf{h} \\neq 0$（由于 $k_f > 0$ 这是成立的），它就是正的。因此，Hessian 矩阵是正的，这证实了我们的解对应一个唯一的最小值。\n\n公式中的各项可以显式写出。给定 $R = \\mathrm{diag}(\\sigma_{y_1}^2, \\sigma_{y_2}^2)$，其逆为 $R^{-1} = \\mathrm{diag}(1/\\sigma_{y_1}^2, 1/\\sigma_{y_2}^2)$。标量积为：\n$$\n\\mathbf{h}^T R^{-1} \\mathbf{h} = \\frac{(T_s k_{f_1})^2}{\\sigma_{y_1}^2} + \\frac{(T_s k_{f_2})^2}{\\sigma_{y_2}^2}\n$$\n$$\n\\mathbf{h}^T R^{-1} (y - \\mathbf{h}_0) = \\frac{T_s k_{f_1}}{\\sigma_{y_1}^2}(y_1 - T_s \\epsilon_{0,f_1}) + \\frac{T_s k_{f_2}}{\\sigma_{y_2}^2}(y_2 - T_s \\epsilon_{0,f_2})\n$$\n因此，用于实现的最终方程是：\n$$\nx_a = \\frac{\\frac{x_b}{B} - \\left[ \\frac{T_s k_{f_1}(y_1 - T_s \\epsilon_{0,f_1})}{\\sigma_{y_1}^2} + \\frac{T_s k_{f_2}(y_2 - T_s \\epsilon_{0,f_2})}{\\sigma_{y_2}^2} \\right]}{\\frac{1}{B} + \\frac{(T_s k_{f_1})^2}{\\sigma_{y_1}^2} + \\frac{(T_s k_{f_2})^2}{\\sigma_{y_2}^2}}\n$$\n最后，由于 SWE 在物理上必须是非负的，结果被投影到可行集上：\n$$\nx_a \\leftarrow \\max(0, x_a)\n$$\n对每个测试用例应用此步骤。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the posterior Snow Water Equivalent (SWE) using a 1D-Var assimilation scheme.\n    \"\"\"\n\n    # Test cases are provided as tuples with the following structure:\n    # (Ts, e0_f1, e0_f2, k_f1, k_f2, y1, y2, xb, B, R11, R22)\n    test_cases = [\n        # Case 1\n        (260.0, 0.95, 0.92, 1.5e-4, 3.0e-4, 241.1, 227.4, 100.0, 900.0, 4.0, 9.0),\n        # Case 2\n        (260.0, 0.95, 0.92, 1.5e-4, 3.0e-4, 246.8, 238.8, 20.0, 400.0, 4.0, 4.0),\n        # Case 3\n        (260.0, 0.95, 0.92, 1.5e-4, 3.0e-4, 235.1, 216.2, 250.0, 1600.0, 9.0, 9.0),\n        # Case 4\n        (240.0, 0.96, 0.93, 1.5e-4, 3.0e-4, 226.1, 214.7, 130.0, 900.0, 4.0, 9.0),\n        # Case 5\n        (265.0, 0.94, 0.91, 1.5e-4, 3.0e-4, 241.9, 226.9, 160.0, 900.0, 4.0, 25.0)\n    ]\n\n    results = []\n\n    for case in test_cases:\n        Ts, e0_f1, e0_f2, k_f1, k_f2, y1, y2, xb, B, sy1_sq, sy2_sq = case\n\n        # Numerator calculation for the analysis SWE formula\n        # Numerator = xb*B^-1 - h^T * R^-1 * (y - h0)\n        \n        # Background term in numerator\n        num_bg_term = xb / B\n\n        # h^T * R^-1 * (y - h0) term\n        # First component: h1 * R11^-1 * (y1 - h0_1)\n        h0_1 = Ts * e0_f1\n        h1 = Ts * k_f1\n        innov_term1 = (h1 * (y1 - h0_1)) / sy1_sq\n        \n        # Second component: h2 * R22^-1 * (y2 - h0_2)\n        h0_2 = Ts * e0_f2\n        h2 = Ts * k_f2\n        innov_term2 = (h2 * (y2 - h0_2)) / sy2_sq\n        \n        # Full numerator\n        numerator = num_bg_term - (innov_term1 + innov_term2)\n\n        # Denominator calculation for the analysis SWE formula\n        # Denominator = B^-1 + h^T * R^-1 * h\n        \n        # Background term in denominator\n        den_bg_term = 1.0 / B\n        \n        # h^T * R^-1 * h term\n        hRh_term = (h1**2 / sy1_sq) + (h2**2 / sy2_sq)\n        \n        # Full denominator\n        denominator = den_bg_term + hRh_term\n\n        # Calculate analysis SWE (xa)\n        if denominator == 0:\n            # This case shouldn't happen with the given problem constraints\n            # (B > 0, R positive definite, k_f > 0)\n            xa_unconstrained = 0.0\n        else:\n            xa_unconstrained = numerator / denominator\n\n        # Apply non-negativity constraint by projection\n        xa = max(0.0, xa_unconstrained)\n        \n        results.append(f\"{xa:.3f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        }
    ]
}