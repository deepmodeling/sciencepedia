{
    "hands_on_practices": [
        {
            "introduction": "在环境遥感中，我们构建的贝叶斯模型通常具有复杂的层次结构，包含多个参数和条件依赖关系。为这类模型设计高效的马尔可夫链蒙特卡洛（MCMC）采样器是一项核心技能。本练习将指导您构建一个混合采样器，它巧妙地结合了吉布斯采样（Gibbs sampling）处理共轭部分的快捷性与哈密顿蒙特卡洛（HMC）处理非共轭部分的强大能力，这对于高效求解复杂的真实世界模型至关重要。",
            "id": "3798778",
            "problem": "一个遥感团队正在校准一个简化的大气层顶辐射模型，以从 $n$ 个像素的卫星观测中反演潜在的地表反射率和气溶胶光学厚度。对于每个像素 $i \\in \\{1,\\dots,n\\}$，观测模型为\n$$\ny_i \\mid s_i, a_i, c, \\sigma^2 \\sim \\mathcal{N}\\Big(s_i \\,\\exp(-\\kappa\\, a_i) + c\\, a_i,\\ \\sigma^2\\Big),\n$$\n其中 $y_i$ 是观测到的辐射，$s_i$ 是潜在的地表反射率，$a_i$ 是潜在的气溶胶光学厚度，$c$ 是路径辐射的未知校准系数，$\\sigma^2$ 是噪声方差，$\\kappa>0$ 是辐射传输中的一个已知衰减常数。先验结构是分层的：\n$$\ns_i \\mid \\mu_s,\\tau_s \\sim \\mathcal{N}(\\mu_s,\\ \\tau_s^{-1}),\\quad \\mu_s \\sim \\mathcal{N}(m_0,\\ \\kappa_0^{-1}),\\quad \\tau_s \\sim \\mathrm{Gamma}(\\alpha_0,\\ \\beta_0),\n$$\n$$\n\\log a_i \\equiv z_i \\mid \\mu_a,\\tau_a \\sim \\mathcal{N}(\\mu_a,\\ \\tau_a^{-1}),\\quad \\mu_a \\sim \\mathcal{N}(m_a,\\ \\kappa_a^{-1}),\\quad \\tau_a \\sim \\mathrm{Gamma}(\\alpha_a,\\ \\beta_a),\n$$\n$$\nc \\sim \\mathcal{N}(m_c,\\ v_c),\\quad \\sigma^2 \\sim \\mathrm{Inv}\\text{-}\\mathrm{Gamma}(\\alpha_\\sigma,\\ \\beta_\\sigma),\n$$\n所有先验在给定其超参数的情况下条件独立。此处 $\\mathrm{Gamma}(\\cdot,\\cdot)$ 使用形状-率参数化，而 $\\mathrm{Inv}\\text{-}\\mathrm{Gamma}(\\cdot,\\cdot)$ 使用形状-尺度参数化。目标是构建一个混合马尔可夫链蒙特卡洛 (MCMC) 算法，该算法对条件共轭分量使用吉布斯采样，对非共轭分量使用 Metropolis–Hastings (MH) 或哈密顿蒙特卡洛 (HMC)。缩写定义：马尔可夫链蒙特卡洛 (Markov chain Monte Carlo, MCMC)，Metropolis–Hastings (MH)，哈密顿蒙特卡洛 (Hamiltonian Monte Carlo, HMC)。\n\n下列哪种设计正确地将吉布斯更新应用于所有条件共轭块，并仅为非共轭块保留 MH 或 HMC，同时保持相对于精确联合后验的细致平衡，并在适用的情况下使用正确的条件分布和梯度？\n\nA. 使用吉布斯更新 $s_{1:n}$，通过\n$$\np(s_i \\mid \\text{rest}) = \\mathcal{N}\\Big(\\ \\big(\\tau_s + \\sigma^{-2}e^{-2\\kappa a_i}\\big)^{-1}\\big(\\tau_s \\mu_s + \\sigma^{-2} e^{-\\kappa a_i}\\big(y_i - c a_i\\big)\\big),\\ \\big(\\tau_s + \\sigma^{-2}e^{-2\\kappa a_i}\\big)^{-1}\\ \\Big),\n$$\n将 $c$ 作为高斯回归通过吉布斯更新，其后验精度为 $v_c^{-1} + \\sigma^{-2}\\sum_{i=1}^n a_i^2$，均值为 $\\big(v_c^{-1} + \\sigma^{-2}\\sum a_i^2\\big)^{-1}\\big(v_c^{-1} m_c + \\sigma^{-2}\\sum a_i(y_i - s_i e^{-\\kappa a_i})\\big)$，使用吉布斯更新 $\\mu_s \\mid s_{1:n},\\tau_s$，通过\n$$\np(\\mu_s \\mid \\text{rest}) = \\mathcal{N}\\Big(\\ (\\kappa_0 + n \\tau_s)^{-1}\\big(\\kappa_0 m_0 + \\tau_s \\sum_{i=1}^n s_i\\big),\\ (\\kappa_0 + n \\tau_s)^{-1}\\Big),\n$$\n使用吉布斯更新 $\\tau_s \\mid s_{1:n},\\mu_s$，作为 $\\mathrm{Gamma}\\big(\\alpha_0 + \\tfrac{n}{2},\\ \\beta_0 + \\tfrac{1}{2}\\sum_{i=1}^n (s_i - \\mu_s)^2\\big)$，使用吉布斯更新 $\\mu_a \\mid z_{1:n},\\tau_a$，通过\n$$\np(\\mu_a \\mid \\text{rest}) = \\mathcal{N}\\Big(\\ (\\kappa_a + n \\tau_a)^{-1}\\big(\\kappa_a m_a + \\tau_a \\sum_{i=1}^n z_i\\big),\\ (\\kappa_a + n \\tau_a)^{-1}\\Big),\n$$\n使用吉布斯更新 $\\tau_a \\mid z_{1:n},\\mu_a$，作为 $\\mathrm{Gamma}\\big(\\alpha_a + \\tfrac{n}{2},\\ \\beta_a + \\tfrac{1}{2}\\sum_{i=1}^n (z_i - \\mu_a)^2\\big)$，使用吉布斯更新 $\\sigma^2$，作为 $\\mathrm{Inv}\\text{-}\\mathrm{Gamma}\\big(\\alpha_\\sigma + \\tfrac{n}{2},\\ \\beta_\\sigma + \\tfrac{1}{2}\\sum_{i=1}^n r_i^2\\big)$，其中 $r_i = y_i - s_i e^{-\\kappa a_i} - c a_i$，并使用 HMC 联合更新 $z_{1:n}$，目标为 $p(z_{1:n}\\mid \\text{rest}) \\propto \\prod_{i=1}^n \\mathcal{N}\\big(y_i \\mid s_i e^{-\\kappa e^{z_i}} + c e^{z_i},\\ \\sigma^2\\big)\\ \\mathcal{N}(z_i \\mid \\mu_a,\\ \\tau_a^{-1})$，使用逐元素梯度\n$$\n\\frac{\\partial}{\\partial z_i} \\log p(z_{1:n}\\mid \\text{rest}) = \\frac{y_i - \\big(s_i e^{-\\kappa e^{z_i}} + c e^{z_i}\\big)}{\\sigma^2}\\,\\Big(e^{z_i}\\big(-\\kappa s_i e^{-\\kappa e^{z_i}} + c\\big)\\Big)\\ -\\ \\tau_a (z_i - \\mu_a),\n$$\n以及一个 MH 接受-拒绝步骤，其接受概率为 $\\min\\{1,\\ \\exp(H_{\\text{old}} - H_{\\text{new}})\\}$，其中哈密顿量 $H$ 由负对数后验和二次动能构建。\n\nB. 从对数正态全条件分布通过吉布斯更新 $a_{1:n}$，因为 $\\log a_i$ 具有高斯先验，通过 MH 随机游走提议更新 $s_{1:n}$，通过吉布斯更新 $c,\\mu_s,\\tau_s,\\mu_a,\\tau_a,\\sigma^2$。任何更新都不需要梯度，因为所有先验都与高斯似然共轭。\n\nC. 通过 MH 随机游走提议更新所有 $s_{1:n},c,\\mu_s,\\tau_s,\\mu_a,\\tau_a,\\sigma^2$，以避免计算条件分布，在 $a_{1:n}$ 上通过 HMC 更新 $a_{1:n}$，梯度为\n$$\n\\frac{\\partial}{\\partial a_i} \\log p(a_{1:n}\\mid \\text{rest}) = \\frac{y_i - \\big(s_i e^{-\\kappa a_i} + c a_i\\big)}{\\sigma^2}\\,\\big(-\\kappa s_i e^{-\\kappa a_i} + c\\big)\\ -\\ \\tau_a (a_i - \\mu_a),\n$$\n并根据 HMC 接受概率进行接受。\n\nD. 通过 HMC 更新 $z_{1:n}$，梯度为\n$$\n\\frac{\\partial}{\\partial z_i} \\log p(z_{1:n}\\mid \\text{rest}) = \\frac{y_i - \\big(s_i e^{-\\kappa e^{z_i}} + c e^{z_i}\\big)}{\\sigma^2}\\,\\big(-\\kappa s_i e^{-\\kappa e^{z_i}} + c\\big)\\ -\\ \\tau_a (z_i - \\mu_a) + 1,\n$$\n其中额外的 $+1$ 是为了解释对数正态先验的雅可比行列式，通过 MH 更新 $c$，因为它与 $a_i$ 相乘，使用标准共轭形式通过吉布斯更新 $s_{1:n},\\mu_s,\\tau_s,\\mu_a,\\tau_a,\\sigma^2$。\n\n选择唯一最佳选项。",
            "solution": "问题陈述是一个构建用于分层贝叶斯模型的混合马尔可夫链蒙特卡洛 (MCMC) 采样器的有效的、定义明确的练习。该模型是大气层顶辐射的一个简化但有物理动机的表示，这是遥感中的一个常见问题。模型的所有组成部分——似然、分层先验以及算法设计的目标——都有清晰和数学上的定义。该问题是自洽的，没有科学或逻辑上的缺陷。\n\n### 步骤 1：提取给定条件\n分层贝叶斯模型的组成部分如下：\n- **观测模型（似然）**：对于每个像素 $i \\in \\{1,\\dots,n\\}$，观测到的辐射 $y_i$ 被建模为正态分布：\n$$\ny_i \\mid s_i, a_i, c, \\sigma^2 \\sim \\mathcal{N}\\Big(s_i \\,\\exp(-\\kappa\\, a_i) + c\\, a_i,\\ \\sigma^2\\Big)\n$$\n其中 $y_i$ 是观测值，$s_i$ 是地表反射率，$a_i$ 是气溶胶光学厚度，$c$ 是路径辐射系数，$\\sigma^2$ 是噪声方差，$\\kappa > 0$ 是一个已知的常数。\n\n- **先验分布**：\n    - 对于地表反射率 $s_i$：\n    $$\n    s_i \\mid \\mu_s,\\tau_s \\sim \\mathcal{N}(\\mu_s,\\ \\tau_s^{-1}),\\quad \\mu_s \\sim \\mathcal{N}(m_0,\\ \\kappa_0^{-1}),\\quad \\tau_s \\sim \\mathrm{Gamma}(\\alpha_0,\\ \\beta_0)\n    $$\n    - 对于气溶胶光学厚度 $a_i$，通过对数变换 $z_i = \\log a_i$：\n    $$\n    z_i \\mid \\mu_a,\\tau_a \\sim \\mathcal{N}(\\mu_a,\\ \\tau_a^{-1}),\\quad \\mu_a \\sim \\mathcal{N}(m_a,\\ \\kappa_a^{-1}),\\quad \\tau_a \\sim \\mathrm{Gamma}(\\alpha_a,\\ \\beta_a)\n    $$\n    - 对于其余参数：\n    $$\n    c \\sim \\mathcal{N}(m_c,\\ v_c),\\quad \\sigma^2 \\sim \\mathrm{Inv}\\text{-}\\mathrm{Gamma}(\\alpha_\\sigma,\\ \\beta_\\sigma)\n    $$\n- **参数化**：伽马分布是形状-率参数化。逆伽马分布是形状-尺度参数化。所有先验在给定其超参数的情况下条件独立。\n\n- **任务**：构建一个混合 MCMC 采样器，对所有条件共轭参数块使用吉布斯采样，对任何非共轭块使用基于梯度的方法（Metropolis-Hastings 或哈密顿蒙特卡洛）。\n\n### 步骤 2：问题验证\n问题陈述是有效的。它提出了一个标准的分层贝叶斯模型，并要求设计一个合适的 MCMC 采样器。这是计算统计学中一个定义明确的任务。该模型虽然是对真实辐射传输的简化，但其结构在物理上是合理的。所选择的先验分布是贝叶斯分析中的标准分布。该问题内部一致，在其领域内有科学依据，且陈述客观。\n\n### 步骤 3：推导与选项分析\n任务的核心是为每个参数（或参数块）推导全条件后验分布，并确定它是否是我们能轻易采样的标准分布（即先验是否共轭）。参数 $\\theta$ 的全条件分布是 $p(\\theta \\mid \\text{data}, \\text{所有其他参数})$。\n\n联合后验正比于似然乘以所有先验：\n$$\np(\\cdot \\mid y_{1:n}) \\propto \\left[\\prod_{i=1}^{n} p(y_i \\mid s_i, a_i, c, \\sigma^2)\\right] \\left[\\prod_{i=1}^{n} p(s_i \\mid \\mu_s, \\tau_s) p(a_i \\mid \\mu_a, \\tau_a)\\right] p(c) p(\\sigma^2) p(\\mu_s) p(\\tau_s) p(\\mu_a) p(\\tau_a)\n$$\n我们将分析每个参数块的全条件分布。\n\n**$s_i$ 的条件分布**：涉及 $s_i$ 的项是 $y_i$ 的似然和 $s_i$ 的先验。\n$p(s_i \\mid \\text{rest}) \\propto p(y_i \\mid s_i, \\dots) \\times p(s_i \\mid \\mu_s, \\tau_s) \\propto \\mathcal{N}\\big(y_i \\mid s_i e^{-\\kappa a_i} + c a_i, \\sigma^2\\big) \\times \\mathcal{N}(s_i \\mid \\mu_s, \\tau_s^{-1})$。\n这是两个（关于 $s_i$ 的）高斯密度的乘积，其结果是一个高斯后验。让我们将似然项重写为关于 $s_i$ 的高斯分布。令 $Y_i' = y_i - c a_i$。似然均值为 $s_i e^{-\\kappa a_i}$。这意味着 $Y_i' \\sim \\mathcal{N}(s_i e^{-\\kappa a_i}, \\sigma^2)$，这等价于 $s_i \\sim \\mathcal{N}(Y_i' e^{\\kappa a_i}, \\sigma^2 e^{2\\kappa a_i})$。为了采样，使用精度来处理更好。$s_i$ 的对数后验（忽略常数项）为：\n$$\n-\\frac{1}{2\\sigma^2}(y_i - s_i e^{-\\kappa a_i} - c a_i)^2 - \\frac{\\tau_s}{2}(s_i - \\mu_s)^2\n$$\n展开关于 $s_i$ 的二次项：\n$s_i^2$: $-\\frac{s_i^2}{2}(\\sigma^{-2} e^{-2\\kappa a_i} + \\tau_s)$\n$s_i$: $s_i(\\sigma^{-2} e^{-\\kappa a_i}(y_i - c a_i) + \\tau_s \\mu_s)$\n这是一个高斯分布的二次型。后验精度为 $\\tau_{s, \\text{post}} = \\tau_s + \\sigma^{-2}e^{-2\\kappa a_i}$。后验均值为 $\\mu_{s, \\text{post}} = (\\tau_{s, \\text{post}})^{-1} (\\tau_s \\mu_s + \\sigma^{-2}e^{-\\kappa a_i}(y_i - c a_i))$。\n这是一个共轭更新，因此吉布斯采样是合适的。选项 A 中关于 $p(s_i \\mid \\text{rest})$ 的公式与此推导相符。\n\n**$c$ 的条件分布**：涉及 $c$ 的项是似然和 $c$ 的先验。\n$p(c \\mid \\text{rest}) \\propto \\left( \\prod_i \\mathcal{N}\\big(y_i \\mid s_i e^{-\\kappa a_i} + c a_i, \\sigma^2\\big) \\right) \\times \\mathcal{N}(c \\mid m_c, v_c)$。\n令 $Y_i'' = y_i - s_i e^{-\\kappa a_i}$。整个数据集的似然部分是 $\\prod_i \\mathcal{N}(Y_i'' \\mid c a_i, \\sigma^2)$。这是一个标准的贝叶斯线性回归设置。$c$ 的后验是高斯分布。$c$ 的对数后验（忽略常数项）为：\n$$\n-\\frac{1}{2\\sigma^2} \\sum_{i=1}^n (Y_i'' - c a_i)^2 - \\frac{1}{2v_c}(c - m_c)^2\n$$\n后验精度为 $\\tau_{c, \\text{post}} = v_c^{-1} + \\sigma^{-2}\\sum_i a_i^2$。后验均值为 $\\mu_{c, \\text{post}} = (\\tau_{c, \\text{post}})^{-1} (v_c^{-1}m_c + \\sigma^{-2}\\sum_i a_i Y_i'')$。这是一个共轭更新。选项 A 中关于 $c$ 的后验分布的公式与此推导相符。\n\n**$\\mu_s, \\tau_s, \\mu_a, \\tau_a$ 的条件分布**：这些是具有正态-伽马先验的正态分布参数的标准更新。\n- $p(\\mu_s \\mid \\text{rest}) \\propto p(s_{1:n} \\mid \\mu_s, \\tau_s) p(\\mu_s) \\propto \\mathcal{N}(\\mu_s \\mid \\bar{s}, (n\\tau_s)^{-1}) \\times \\mathcal{N}(\\mu_s \\mid m_0, \\kappa_0^{-1})$。后验是 $\\mathcal{N}((\\kappa_0+n\\tau_s)^{-1}(\\kappa_0 m_0 + n\\tau_s \\bar{s}), (\\kappa_0+n\\tau_s)^{-1})$，其中 $n\\tau_s \\bar{s} = \\tau_s \\sum s_i$。这是共轭的，与选项 A 相符。\n- $p(\\tau_s \\mid \\text{rest}) \\propto p(s_{1:n} \\mid \\mu_s, \\tau_s) p(\\tau_s) \\propto \\tau_s^{n/2} \\exp(-\\frac{\\tau_s}{2}\\sum(s_i-\\mu_s)^2) \\times \\tau_s^{\\alpha_0-1} \\exp(-\\beta_0\\tau_s)$。后验是 $\\mathrm{Gamma}(\\alpha_0 + n/2, \\beta_0 + \\frac{1}{2}\\sum(s_i-\\mu_s)^2)$。这是共轭的，与选项 A 相符。\n- $\\mu_a$ 和 $\\tau_a$ 的更新形式相同，只是用 $z_i = \\log a_i$ 替换 $s_i$。条件分布是共轭的，与选项 A 相符。\n\n**$\\sigma^2$ 的条件分布**：涉及 $\\sigma^2$ 的项是似然及其逆伽马先验。这是一个标准的共轭情况。\n$p(\\sigma^2 \\mid \\text{rest}) \\propto (\\sigma^2)^{-n/2}\\exp(-\\frac{1}{2\\sigma^2}\\sum r_i^2) \\times (\\sigma^2)^{-(\\alpha_\\sigma+1)}\\exp(-\\beta_\\sigma/\\sigma^2)$，其中 $r_i=y_i - s_i e^{-\\kappa a_i} - ca_i$。后验是 $\\mathrm{Inv}\\text{-}\\mathrm{Gamma}(\\alpha_\\sigma + n/2, \\beta_\\sigma + \\frac{1}{2}\\sum r_i^2)$。这是共轭的，与选项 A 相符。\n\n**$a_i$ (或 $z_i = \\log a_i$) 的条件分布**：使用无约束变量 $z_i=\\log a_i$ 更可取。$z_i$ 的全条件分布涉及似然及其先验：\n$p(z_i \\mid \\text{rest}) \\propto p(y_i \\mid z_i, \\dots) \\times p(z_i \\mid \\mu_a, \\tau_a)$。\n$p(z_i \\mid \\text{rest}) \\propto \\exp\\left(-\\frac{1}{2\\sigma^2}\\left(y_i - \\left(s_i e^{-\\kappa e^{z_i}} + c e^{z_i}\\right)\\right)^2\\right) \\times \\exp\\left(-\\frac{\\tau_a}{2}(z_i - \\mu_a)^2\\right)$。\n似然中的均值函数 $\\mu_i(z_i) = s_i e^{-\\kappa e^{z_i}} + c e^{z_i}$ 是一个关于 $z_i$ 的高度非线性函数。因此，$z_i$ 的后验分布不是一个标准分布。因此，这个块是非共轭的，需要像 Metropolis-Hastings 或 HMC 这样的方法。\n对于 HMC，我们需要对数后验相对于 $z_i$ 的梯度。令 $L(z_i) = \\log p(z_i \\mid \\text{rest})$。\n$$\n\\frac{\\partial L}{\\partial z_i} = \\frac{\\partial}{\\partial z_i}\\left[-\\frac{1}{2\\sigma^2}(y_i - \\mu_i(z_i))^2 - \\frac{\\tau_a}{2}(z_i - \\mu_a)^2\\right]\n$$\n$$\n= -\\frac{1}{\\sigma^2}(y_i - \\mu_i(z_i))(-\\frac{\\partial \\mu_i(z_i)}{\\partial z_i}) - \\tau_a(z_i - \\mu_a)\n$$\n均值函数的导数是：\n$$\n\\frac{\\partial \\mu_i(z_i)}{\\partial z_i} = s_i \\frac{d}{dz_i}(e^{-\\kappa e^{z_i}}) + c \\frac{d}{dz_i}(e^{z_i}) = s_i e^{-\\kappa e^{z_i}}(-\\kappa e^{z_i}) + c e^{z_i} = e^{z_i} (c - \\kappa s_i e^{-\\kappa e^{z_i}})\n$$\n将此代入梯度表达式：\n$$\n\\frac{\\partial L}{\\partial z_i} = \\frac{y_i - \\mu_i(z_i)}{\\sigma^2} \\left[ e^{z_i} (c - \\kappa s_i e^{-\\kappa e^{z_i}}) \\right] - \\tau_a(z_i - \\mu_a)\n$$\n重新排列以匹配选项 A 中的格式：\n$$\n\\frac{\\partial L}{\\partial z_i} = \\frac{y_i - (s_i e^{-\\kappa e^{z_i}} + c e^{z_i})}{\\sigma^2} \\left( e^{z_i} (-\\kappa s_i e^{-\\kappa e^{z_i}} + c) \\right) - \\tau_a(z_i - \\mu_a)\n$$\n这与选项 A 中给出的梯度表达式完全匹配。对此非共轭块使用 HMC 是合适的，接受概率 $\\min\\{1, \\exp(H_{\\text{old}} - H_{\\text{new}})\\}$ 是标准形式。\n\n---\n### 逐项分析\n\n**选项 A**：此选项正确地识别了所有具有共轭全条件分布的参数块（$s_{1:n}$, $c$, $\\mu_s$, $\\tau_s$, $\\mu_a$, $\\tau_a$, $\\sigma^2$），并建议通过吉布斯采样来更新它们。对于其中的每一个，它都提供了条件后验分布的正确形式。它正确地将 $z_{1:n}$（或 $a_{1:n}$）块识别为非共轭块，并建议使用 HMC 来更新它。HMC 的目标密度被正确地表述为 $z_{1:n}$ 的全条件后验，并且所需的目标对数密度的梯度也被正确地推导出来。对 HMC 接受步骤的描述也是正确的。此选项提出了一个有效且高效的混合 MCMC 方案。\n**结论：正确**\n\n**选项 B**：此选项声称可以从对数正态全条件分布通过吉布斯更新 $a_{1:n}$。这是错误的；似然与 $a_i$ 的对数正态先验不是共轭的。然后它建议对 $s_{1:n}$ 使用 MH，这是低效的，因为这个块是共轭的，吉布斯更新是可能且更可取的。最后的陈述“任何更新都不需要梯度...因为所有先验都与高斯似然共轭”是不正确的。似然相对于 $a_i$ 不是高斯的。\n**结论：不正确**\n\n**选项 C**：此选项建议对除 $a_{1:n}$ 之外的所有参数使用 MH，未能满足对共轭块使用吉布斯更新的要求。这是一个低效的采样器设计选择。更关键的是，它建议直接在 $a_{1:n}$ 上使用 HMC，但提供了一个数学上不正确的梯度。给出的梯度公式仅考虑了 $a_i$ 本身的高斯先验，即 $\\mathcal{N}(\\mu_a, \\tau_a^{-1})$，而不是正确的对数正态先验，其密度为 $p(a_i) \\propto a_i^{-1} \\exp(-\\frac{\\tau_a}{2}(\\log a_i - \\mu_a)^2)$。对数先验项的导数是错误的。\n**结论：不正确**\n\n**选项 D**：此选项建议对 $z_{1:n}$ 使用 HMC，这是一个合理的选择，但梯度表达式不正确。它包含一个伪项“$+1$”，并错误地解释为“对数正态先验的雅可比行列式”。当对重参数化的变量 $z_i$ 进行采样时，我们的目标是其后验 $p(z_i|\\text{rest}) \\propto p(y_i|z_i, \\text{rest})p(z_i|\\text{rest})$，在其对数密度的导数中不会出现这样的雅可比项。此外，它错误地建议必须通过 MH 更新 $c$。如前所示，$c$ 的全条件分布是高斯分布，使其成为一个适合吉布斯更新的共轭块。\n**结论：不正确**\n\n根据详细分析，只有选项 A 描述了针对给定模型的正确且有原则的混合 MCMC 算法。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "一个设计正确的MCMC采样器在实际应用中仍可能效率低下，尤其是在分层模型中，不同层级的参数之间强烈的后验相关性会形成所谓的“漏斗”几何形状，从而困住采样器。本练习将探讨一种名为“重参数化”的关键技术来解决此问题。您将对比“中心化”与“非中心化”参数化的优劣，并理解如何根据数据提供的信息量来选择最佳策略，这是构建稳健贝叶斯模型的关键一步。",
            "id": "3798901",
            "problem": "一种基于卫星的像素级地球物理量（如土壤湿度）反演，将测量值 $x$ 建模为对潜在真实状态 $\\theta$ 的带噪声观测。一个基于过程的环境模型为 $\\theta$ 提供了先验均值 $\\mu$ 和先验变异性 $\\tau^2$。考虑分层高斯模型，其中 $x \\mid \\theta \\sim \\mathcal{N}(\\theta, \\sigma^2)$ 且 $\\theta \\sim \\mathcal{N}(\\mu, \\tau^2)$，$\\sigma^2$ 代表传感器噪声方差，$\\tau^2$ 代表跨像素或时间的先验变异性。假设我们希望通过马尔可夫链蒙特卡洛（MCMC），特别是哈密顿蒙特卡洛（HMC），在适当的超先验 $p(\\tau)$ 下，对 $(\\theta, \\tau)$ 的联合后验进行贝叶斯推断并采样。\n\n考虑两种参数化方法：\n\n- 中心化参数化（CP）：在 $(\\theta, \\tau)$ 中直接采样，其中 $\\theta \\sim \\mathcal{N}(\\mu, \\tau^2)$ 且 $x \\mid \\theta \\sim \\mathcal{N}(\\theta, \\sigma^2)$。\n\n- 非中心化参数化（NCP）：通过引入 $z \\sim \\mathcal{N}(0,1)$ 并设置 $\\theta = \\mu + \\tau z$ 来重新参数化，因此似然函数变为 $x \\mid (z, \\tau) \\sim \\mathcal{N}(\\mu + \\tau z, \\sigma^2)$。\n\n从贝叶斯定理和高斯分布族的共轭性出发，在中心化参数化中推导给定 $\\tau$ 和 $x$ 时 $\\theta$ 的条件后验，并用此来分析在两种相反的数据情景下，潜在状态和尺度参数之间的后验依赖结构：\n\n- 强似然情景：$\\sigma^2 \\ll \\tau^2$（或者，等效地，对于具有相同方差的 $n$ 次独立重复观测，$\\sigma^2/n \\ll \\tau^2$）。\n\n- 弱似然情景：$\\sigma^2 \\gg \\tau^2$（或 $\\sigma^2/n \\gg \\tau^2$）。\n\n然后，基于这些情景所暗示的后验几何形状，选择最能描述哪种参数化方法更适合高效 MCMC 采样的陈述。\n\n选择一项：\n\nA. 当似然很强（$\\sigma^2$ 小或 $n$ 大）时，中心化参数化更可取；而当似然很弱（$\\sigma^2$ 大或 $n$ 小）时，非中心化参数化更可取，因为潜在状态和尺度参数之间的后验依赖性在这些情景下会反转。\n\nB. 当似然很强（$\\sigma^2$ 小或 $n$ 大）时，非中心化参数化更可取；而当似然很弱（$\\sigma^2$ 大或 $n$ 小）时，中心化参数化更可取，因为变换 $\\theta = \\mu + \\tau z$ 总是能减少后验相关性。\n\nC. 参数化的选择对 MCMC 效率没有影响，因为两种参数化通过线性变换相关联，因此具有相同的后验几何形状。\n\nD. 无论 $\\sigma^2$、$\\tau^2$ 或 $n$ 的值如何，中心化参数化总是更可取，因为它将先验和似然对齐在同一个参数空间中。\n\nE. 无论 $\\sigma^2$、$\\tau^2$ 或 $n$ 的值如何，非中心化参数化总是更可取，因为它将潜在状态与尺度参数解耦。",
            "solution": "问题要求在 MCMC 采样的背景下，对分层高斯模型的两种不同参数化方法——中心化（CP）和非中心化（NCP）——进行分析。目标是确定在哪种数据情景下哪种参数化方法更有效。这需要推导潜在状态 $\\theta$ 的条件后验，并分析其产生的后验几何形状。\n\n### 步骤 1：问题验证\n\n在继续之前，对问题陈述进行严格验证。\n\n**1. 提取给定条件：**\n- **模型：** 关于地球物理量 $\\theta$ 的分层高斯模型。\n- **似然：** 测量值 $x$ 被建模为 $x \\mid \\theta \\sim \\mathcal{N}(\\theta, \\sigma^2)$，其中 $\\sigma^2$ 是传感器噪声方差。\n- **先验：** 潜在真实状态 $\\theta$ 被建模为 $\\theta \\sim \\mathcal{N}(\\mu, \\tau^2)$，其中 $\\mu$ 是先验均值，$\\tau^2$ 是先验变异性。\n- **超先验：** 为尺度参数 $\\tau$ 假设一个适当的超先验 $p(\\tau)$。\n- **推断目标：** 使用哈密顿蒙特卡洛（HMC）从联合后验 $p(\\theta, \\tau | x)$ 中采样。\n- **中心化参数化（CP）：** 模型直接用 $(\\theta, \\tau)$ 进行参数化。联合先验为 $p(\\theta, \\tau) = p(\\theta | \\tau) p(\\tau) = \\mathcal{N}(\\theta; \\mu, \\tau^2) p(\\tau)$。\n- **非中心化参数化（NCP）：** 通过引入一个标准正态潜在变量 $z \\sim \\mathcal{N}(0,1)$ 并设置 $\\theta = \\mu + \\tau z$ 来重新参数化。采样在 $(z, \\tau)$ 空间中进行。似然函数为 $x \\mid (z, \\tau) \\sim \\mathcal{N}(\\mu + \\tau z, \\sigma^2)$。\n- **数据情景：**\n    - 强似然情景：$\\sigma^2 \\ll \\tau^2$（或对于 $n$ 个观测值，$\\sigma^2/n \\ll \\tau^2$）。\n    - 弱似然情景：$\\sigma^2 \\gg \\tau^2$（或对于 $n$ 个观测值，$\\sigma^2/n \\gg \\tau^2$）。\n\n**2. 验证分析：**\n- **科学依据：** 该问题坚实地基于贝叶斯统计和计算方法。在分层模型的 MCMC 背景下，中心化和非中心化参数化之间的比较是一个标准且重要的主题。其在遥感领域的应用是现实且恰当的。该模型是一个基本、有效的统计结构。\n- **良定性：** 该问题是良定的。它要求进行特定的推导，并基于该推导进行分析，从而得出关于 MCMC 效率的结论。模型的所有必要组成部分都已定义。\n- **客观性：** 问题以精确、客观、标准的数学和统计语言陈述。\n- **结论：** 问题陈述有效。它在科学上是合理的、良定的、客观的，并且不包含任何模糊或矛盾之处。\n\n### 步骤 2：推导 $\\theta$ 的条件后验\n\n我们推导给定数据 $x$ 和超参数 $\\tau$ 时 $\\theta$ 的条件后验分布，记为 $p(\\theta | x, \\tau)$。根据贝叶斯定理，后验与似然和先验的乘积成正比：\n$$\np(\\theta | x, \\tau) \\propto p(x | \\theta) p(\\theta | \\tau)\n$$\n似然和先验均以高斯分布的形式给出：\n- 似然：$p(x | \\theta) = \\mathcal{N}(x; \\theta, \\sigma^2) \\propto \\exp\\left( -\\frac{(x - \\theta)^2}{2\\sigma^2} \\right)$\n- 先验：$p(\\theta | \\tau) = \\mathcal{N}(\\theta; \\mu, \\tau^2) \\propto \\exp\\left( -\\frac{(\\theta - \\mu)^2}{2\\tau^2} \\right)$\n\n乘积为：\n$$\np(\\theta | x, \\tau) \\propto \\exp\\left( -\\frac{(x - \\theta)^2}{2\\sigma^2} - \\frac{(\\theta - \\mu)^2}{2\\tau^2} \\right)\n$$\n为了找到后验的形式，我们展开指数中的项，并对 $\\theta$ 进行配方。指数的参数为：\n$$\n-\\frac{1}{2} \\left[ \\frac{\\theta^2 - 2x\\theta + x^2}{\\sigma^2} + \\frac{\\theta^2 - 2\\mu\\theta + \\mu^2}{\\tau^2} \\right]\n$$\n我们收集包含 $\\theta^2$ 和 $\\theta$ 的项：\n$$\n-\\frac{1}{2} \\left[ \\theta^2 \\left( \\frac{1}{\\sigma^2} + \\frac{1}{\\tau^2} \\right) - 2\\theta \\left( \\frac{x}{\\sigma^2} + \\frac{\\mu}{\\tau^2} \\right) + \\text{const} \\right]\n$$\n$\\theta$ 的后验也是一个高斯分布 $\\mathcal{N}(\\theta; \\mu_{\\text{post}}, \\sigma^2_{\\text{post}})$，其密度与 $\\exp\\left( -\\frac{(\\theta - \\mu_{\\text{post}})^2}{2\\sigma^2_{\\text{post}}} \\right)$ 成正比，展开为 $\\exp\\left( -\\frac{1}{2} \\left[ \\frac{\\theta^2}{\\sigma^2_{\\text{post}}} - \\frac{2\\theta\\mu_{\\text{post}}}{\\sigma^2_{\\text{post}}} \\right] + \\text{const} \\right)$。\n\n通过比较 $\\theta^2$ 和 $\\theta$ 的系数，我们可以确定后验方差和均值。\n后验方差的倒数（精度）是先验精度和似然精度的和：\n$$\n\\frac{1}{\\sigma^2_{\\text{post}}} = \\frac{1}{\\sigma^2} + \\frac{1}{\\tau^2} \\implies \\sigma^2_{\\text{post}} = \\left( \\frac{1}{\\sigma^2} + \\frac{1}{\\tau^2} \\right)^{-1} = \\frac{\\sigma^2 \\tau^2}{\\sigma^2 + \\tau^2}\n$$\n后验均值是数据和先验均值的精度加权平均：\n$$\n\\frac{\\mu_{\\text{post}}}{\\sigma^2_{\\text{post}}} = \\frac{x}{\\sigma^2} + \\frac{\\mu}{\\tau^2} \\implies \\mu_{\\text{post}} = \\sigma^2_{\\text{post}} \\left( \\frac{x}{\\sigma^2} + \\frac{\\mu}{\\tau^2} \\right) = \\frac{\\sigma^2 \\tau^2}{\\sigma^2 + \\tau^2} \\left( \\frac{x\\tau^2 + \\mu\\sigma^2}{\\sigma^2 \\tau^2} \\right) = \\frac{x\\tau^2 + \\mu\\sigma^2}{\\sigma^2 + \\tau^2}\n$$\n所以，条件后验为：\n$$\n\\theta | x, \\tau \\sim \\mathcal{N}\\left( \\frac{x\\tau^2 + \\mu\\sigma^2}{\\sigma^2 + \\tau^2}, \\frac{\\sigma^2 \\tau^2}{\\sigma^2 + \\tau^2} \\right)\n$$\n对于 $n$ 个独立观测值，我们将 $x$ 替换为样本均值 $\\bar{x}$，将 $\\sigma^2$ 替换为样本均值的方差 $\\sigma^2/n$。逻辑保持不变。\n\n### 步骤 3：后验几何形状和 MCMC 效率分析\n\nHMC 的效率高度依赖于后验分布的几何形状。参数之间的强相关性会产生具有挑战性的地貌特征（例如，“漏斗形”或“香蕉形”），这会阻碍有效的探索。CP 和 NCP 之间的选择是一种将模型重新参数化到后验几何形状更简单（即相关性更低）的空间的策略。\n\n**中心化参数化（CP）**\n在 CP 中，我们从联合后验 $p(\\theta, \\tau | x)$ 中采样。推导出的条件后验 $p(\\theta | x, \\tau)$ 揭示了 $\\theta$ 和 $\\tau$ 是如何耦合的。$\\theta$ 的均值和方差都依赖于 $\\tau$。\n\n- **弱似然情景（$\\sigma^2 \\gg \\tau^2$）：** 与先验相比，数据提供的信息很少。\n    - 当 $\\sigma^2 \\to \\infty$（或 $\\sigma^2/\\tau^2 \\to \\infty$）时，后验参数变为：\n    $$\n    \\mu_{\\text{post}} = \\frac{x(\\tau^2/\\sigma^2) + \\mu}{1 + (\\tau^2/\\sigma^2)} \\approx \\mu\n    $$\n    $$\n    \\sigma^2_{\\text{post}} = \\frac{\\tau^2}{1 + (\\tau^2/\\sigma^2)} \\approx \\tau^2\n    $$\n    - 在这种情景下，条件后验 $p(\\theta | x, \\tau)$ 趋近于先验 $p(\\theta | \\tau) = \\mathcal{N}(\\mu, \\tau^2)$。\n    - 这在 $\\theta$ 和 $\\tau$ 之间产生了强烈的依赖关系：当 $\\tau$ 趋近于 $0$ 时，$\\theta$ 的方差也趋近于 $0$，迫使 $\\theta$ 非常接近 $\\mu$。这在 $(\\theta, \\tau)$ 空间中产生了经典的“Neal 漏斗”几何形状，对于 HMC 来说，从中进行高效采样是极其困难的。因此，CP 在弱似然情景下是低效的。\n\n- **强似然情景（$\\sigma^2 \\ll \\tau^2$）：** 数据提供的信息非常丰富。\n    - 当 $\\sigma^2 \\to 0$（或 $\\sigma^2/\\tau^2 \\to 0$）时，后验参数变为：\n    $$\n    \\mu_{\\text{post}} = \\frac{x + \\mu(\\sigma^2/\\tau^2)}{1 + (\\sigma^2/\\tau^2)} \\approx x\n    $$\n    $$\n    \\sigma^2_{\\text{post}} = \\frac{\\sigma^2}{1 + (\\sigma^2/\\tau^2)} \\approx \\sigma^2\n    $$\n    - 在这种情景下，条件后验 $p(\\theta | x, \\tau)$ 趋近于 $\\mathcal{N}(x, \\sigma^2)$。\n    - 重要的是，$\\theta$ 的分布变得几乎独立于 $\\tau$。这意味着联合后验 $p(\\theta, \\tau | x) = p(\\theta | x, \\tau) p(\\tau | x)$ 大致可以分解为 $p(\\theta | x) p(\\tau | x)$。参数 $\\theta$ 和 $\\tau$ 在后验中几乎不相关。这种几何形状对于 HMC 来说是理想的。因此，CP 在强似然情景下是高效的。\n\n**非中心化参数化（NCP）**\n在 NCP 中，我们从联合后验 $p(z, \\tau | x)$ 中采样，其中 $\\theta = \\mu + \\tau z$。先验是 $p(z, \\tau) = p(z)p(\\tau)$，所以 $z$ 和 $\\tau$ 在先验上是独立的。后验依赖性是由似然函数 $p(x | z, \\tau) = \\mathcal{N}(x; \\mu + \\tau z, \\sigma^2)$ 引起的。\n\n- **弱似然情景（$\\sigma^2 \\gg \\tau^2$）：**\n    - 似然函数非常平坦，提供的信息很少。因此，后验 $p(z, \\tau | x)$ 主要由先验 $p(z, \\tau)$ 主导。\n    - 由于 $z$ 和 $\\tau$ 在先验中是独立的，它们在后验中也保持近乎独立。这种去相关的几何形状很容易让 HMC 采样。因此，NCP 在弱似然情景下是高效的。\n\n- **强似然情景（$\\sigma^2 \\ll \\tau^2$）：**\n    - 似然函数呈尖峰状，并强烈约束 $\\theta = \\mu + \\tau z$ 接近 $x$。这意味着关系 $\\tau z \\approx x - \\mu$。\n    - 这在后验中产生了 $z$ 和 $\\tau$ 之间的强反比关系。例如，如果 $\\tau$ 很小，为了满足约束，$z$ 必须很大，反之亦然。这在 $(z, \\tau)$ 空间中产生了一个“香蕉形”或漏斗状的几何形状，这对于 HMC 来说是困难的。因此，NCP 在强似然情景下是低效的。\n\n**研究结果总结：**\n- **弱似然（$\\sigma^2 \\gg \\tau^2$ 或 $n$ 小）：** CP 低效（漏斗形）；NCP 高效（去相关）。**NCP 更可取。**\n- **强似然（$\\sigma^2 \\ll \\tau^2$ 或 $n$ 大）：** CP 高效（去相关）；NCP 低效（漏斗形）。**CP 更可取。**\n\n### 步骤 4：评估选项\n\n基于以上分析，我们评估每个陈述。\n\n**A. 当似然很强（$\\sigma^2$ 小或 $n$ 大）时，中心化参数化更可取；而当似然很弱（$\\sigma^2$ 大或 $n$ 小）时，非中心化参数化更可取，因为潜在状态和尺度参数之间的后验依赖性在这些情景下会反转。**\n这个陈述正确地指出，CP 在强似然下更可取，NCP 在弱似然下更可取。其理由是，导致较低后验依赖性的参数化方法会根据数据情景而改变。具体来说，当数据很强时，CP 具有低依赖性，而当数据很弱时，NCP 具有低依赖性。这与我们的推导完全吻合。\n**结论：正确。**\n\n**B. 当似然很强（$\\sigma^2$ 小或 $n$ 大）时，非中心化参数化更可取；而当似然很弱（$\\sigma^2$ 大或 $n$ 小）时，中心化参数化更可取，因为变换 $\\theta = \\mu + \\tau z$ 总是能减少后验相关性。**\n这个陈述的说法与我们的发现完全相反。此外，其理由“变换总是能减少后验相关性”是错误的；在强似然情景下，它会引入强相关性。\n**结论：错误。**\n\n**C. 参数化的选择对 MCMC 效率没有影响，因为两种参数化通过线性变换相关联，因此具有相同的后验几何形状。**\n变换 $\\theta = \\mu + \\tau z$ 在联合参数空间中是非线性的，因为它涉及到参数的乘积 $\\tau z$。重新参数化明确地改变了采样空间的几何形状。几何形状相同的前提是错误的，因此效率不受影响的结论也是错误的。\n**结论：错误。**\n\n**D. 无论 $\\sigma^2$、$\\tau^2$ 或 $n$ 的值如何，中心化参数化总是更可取，因为它将先验和似然对齐在同一个参数空间中。**\n我们的分析表明，CP 在弱似然情景下表现不佳。因此，它并非总是更可取。所提供的理由含糊不清，不是计算效率的有效论据。\n**结论：错误。**\n\n**E. 无论 $\\sigma^2$、$\\tau^2$ 或 $n$ 的值如何，非中心化参数化总是更可取，因为它将潜在状态与尺度参数解耦。**\n我们的分析表明，NCP 在强似然情景下表现不佳。NCP 仅在先验中解耦参数，而不一定在后验中。在某些情景下，似然函数可以并且确实会引入强的后验耦合。\n**结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "MCMC算法生成的是一个自相关的样本序列，因此，样本链的长度并不能真实反映我们从后验分布中获取的信息量。为了准确评估采样结果的质量，我们需要一个更精细的度量标准。本练习将向您介绍有效样本量（effective sample size, $n_{\\mathrm{eff}}$）这一关键诊断指标，通过从第一性原理推导其公式并将其应用于一个常见场景，您将学会如何量化MCMC输出的真实价值。",
            "id": "3798729",
            "problem": "一项卫星气溶胶反演研究使用贝叶斯分层反演模型来估计一个单一的校准参数 $\\theta$，该参数将大气层顶反射率与气溶胶光学厚度（AOD）联系起来。在收敛性诊断表明其达到平稳性之后，运行一个 Metropolis–Hastings 马尔可夫链蒙特卡洛（MCMC）算法，生成一个长度为 $n$ 的预烧期后链 $\\{\\theta_t\\}_{t=1}^{n}$。假设该链是严平稳、可逆且几何遍历的，并具有有限二阶矩，因此马尔可夫链中心极限定理（CLT）适用于样本均值 $\\bar{\\theta}_n$。\n\n1) 从二阶平稳随机过程的自协方差函数定义出发，用其自协方差函数和边际方差来精确定义平稳 MCMC 链 $\\{\\theta_t\\}$ 的滞后 $k$ 自相关函数 $\\rho_k$。\n\n2) 仅使用马尔可夫链中心极限定理所蕴含的相依序列中心极限定理以及积分自相关时间的定义，推导样本均值 $\\bar{\\theta}_n$ 相对于独立同分布样本情况下的方差膨胀，并定义有效样本量 $n_{\\mathrm{eff}}$，该样本量使得相依情况下 $\\bar{\\theta}_n$ 的方差与大小为 $n_{\\mathrm{eff}}$ 的独立样本的方差相等。\n\n3) 在本研究中，后验相关性可以由一阶自回归结构很好地近似，其滞后 $k$ 自相关为 $\\rho_k=\\phi^k$，其中 $|\\phi|1$。假设 $n=10{,}000$ 且 $\\phi=0.85$。计算相应的有效样本量 $n_{\\mathrm{eff}}$。将你的数值答案四舍五入到四位有效数字。",
            "solution": "该问题是有效的，因为它科学地基于马尔可夫链蒙特卡洛（MCMC）方法的标准统计理论，问题陈述清晰且提供了所有必要信息，并且表述客观。我们将继续解答，依次解决三个部分。\n\n1) 滞后 $k$ 自相关函数 $\\rho_k$ 的定义。\n\n设 $\\{\\theta_t\\}_{t=1}^{n}$ 为参数 $\\theta$ 的预烧期后 MCMC 链。问题陈述该链可以被视为一个二阶平稳随机过程的实现。\n\n对于一个二阶平稳过程，其一阶矩和二阶矩是时不变的。该过程的边际均值对所有 $t$ 都是常数：\n$$\n\\mu = E[\\theta_t]\n$$\n该过程的边际方差对所有 $t$ 也都是常数：\n$$\n\\sigma^2 = \\text{Var}(\\theta_t) = E[(\\theta_t - \\mu)^2]\n$$\n滞后 $k$ 的自协方差函数，记作 $\\gamma_k$，衡量过程中相隔 $k$ 个时间步长的值之间的协方差。由于平稳性，它仅取决于滞后 $k$ 而非具体的时间 $t$：\n$$\n\\gamma_k = \\text{Cov}(\\theta_t, \\theta_{t+k}) = E[(\\theta_t - \\mu)(\\theta_{t+k} - \\mu)]\n$$\n方差是滞后 $k=0$ 时自协方差的一个特例：\n$$\n\\gamma_0 = \\text{Cov}(\\theta_t, \\theta_t) = \\text{Var}(\\theta_t) = \\sigma^2\n$$\n滞后 $k$ 自相关函数 $\\rho_k$ 定义为由过程方差归一化的滞后 $k$ 自协方差。这种归一化确保 $\\rho_k$ 是一个范围在 -1 到 1 之间的无量纲量。精确地说，它是滞后 $k$ 自协方差与滞后 0 自协方差的比值：\n$$\n\\rho_k = \\frac{\\gamma_k}{\\gamma_0} = \\frac{\\text{Cov}(\\theta_t, \\theta_{t+k})}{\\text{Var}(\\theta_t)}\n$$\n根据定义，$\\rho_0 = \\frac{\\gamma_0}{\\gamma_0} = 1$。对于平稳过程，自相关函数是对称的，即 $\\rho_k = \\rho_{-k}$。\n\n2) 方差膨胀和有效样本量 $n_{\\mathrm{eff}}$ 的推导。\n\nMCMC 链的样本均值为 $\\bar{\\theta}_n = \\frac{1}{n} \\sum_{t=1}^{n} \\theta_t$。我们希望求其方差 $\\text{Var}(\\bar{\\theta}_n)$。\n$$\n\\text{Var}(\\bar{\\theta}_n) = \\text{Var}\\left(\\frac{1}{n} \\sum_{t=1}^{n} \\theta_t\\right) = \\frac{1}{n^2} \\text{Var}\\left(\\sum_{t=1}^{n} \\theta_t\\right)\n$$\n随机变量之和的方差是其协方差矩阵中所有元素的总和：\n$$\n\\text{Var}\\left(\\sum_{t=1}^{n} \\theta_t\\right) = \\sum_{t=1}^{n} \\sum_{s=1}^{n} \\text{Cov}(\\theta_t, \\theta_s)\n$$\n使用平稳过程的自协方差函数定义，$\\text{Cov}(\\theta_t, \\theta_s) = \\gamma_{|t-s|} = \\sigma^2 \\rho_{|t-s|}$。双重求和变为：\n$$\n\\text{Var}\\left(\\sum_{t=1}^{n} \\theta_t\\right) = \\sum_{t=1}^{n} \\sum_{s=1}^{n} \\gamma_{|t-s|}\n$$\n这个和可以按滞后 $k = |t-s|$ 进行重组。当 $s=t$ 时，有 $n$ 个滞后为 $k=0$ 的项；对于每个 $k \\in \\{1, 2, \\dots, n-1\\}$，有 $2(n-k)$ 对 $(t,s)$ 使得 $|t-s|=k$。\n$$\n\\text{Var}\\left(\\sum_{t=1}^{n} \\theta_t\\right) = n \\gamma_0 + \\sum_{k=1}^{n-1} 2(n-k)\\gamma_k\n$$\n将此代回 $\\text{Var}(\\bar{\\theta}_n)$ 的表达式中：\n$$\n\\text{Var}(\\bar{\\theta}_n) = \\frac{1}{n^2} \\left( n\\gamma_0 + 2\\sum_{k=1}^{n-1} (n-k)\\gamma_k \\right) = \\frac{\\gamma_0}{n} + \\frac{2}{n^2} \\sum_{k=1}^{n-1} (n-k)\\gamma_k\n$$\n提出因子 $\\frac{\\gamma_0}{n} = \\frac{\\sigma^2}{n}$ 并使用 $\\gamma_k = \\gamma_0 \\rho_k$：\n$$\n\\text{Var}(\\bar{\\theta}_n) = \\frac{\\sigma^2}{n} \\left( 1 + 2\\sum_{k=1}^{n-1} \\frac{n-k}{n} \\rho_k \\right) = \\frac{\\sigma^2}{n} \\left( 1 + 2\\sum_{k=1}^{n-1} \\left(1-\\frac{k}{n}\\right)\\rho_k \\right)\n$$\n问题陈述马尔可夫链中心极限定理适用，这在 $n$ 很大时成立。几何遍历性假设确保了自相关 $\\rho_k$ 足够快地（指数级）衰减，从而使得和 $\\sum_{k=1}^{\\infty} \\rho_k$ 收敛。对于大的 $n$，对于 $\\rho_k$ 不可忽略的滞后 $k$，项 $(1 - \\frac{k}{n}) \\approx 1$，因此我们可以用无穷级数来近似这个有限和：\n$$\n\\text{Var}(\\bar{\\theta}_n) \\approx \\frac{\\sigma^2}{n} \\left( 1 + 2\\sum_{k=1}^{\\infty} \\rho_k \\right) \\quad \\text{对于大的 } n\n$$\n在假设样本 $\\{\\theta_t\\}$ 是独立同分布（i.i.d.）的情况下，对于所有 $k \\ge 1$，自相关 $\\rho_k$ 将为 0。均值的方差将简化为 $\\text{Var}(\\bar{\\theta}_{n, \\text{iid}}) = \\frac{\\sigma^2}{n}$。\n\n由自相关引起的方差膨胀是指均值的方差相对于 i.i.d. 情况增加的因子。这个因子是括号中的量，称为**积分自相关时间** $\\tau$：\n$$\n\\tau = 1 + 2\\sum_{k=1}^{\\infty} \\rho_k\n$$\n因此，方差膨胀因子是 $\\tau$，样本均值的渐近方差为 $\\text{Var}(\\bar{\\theta}_n) \\approx \\frac{\\sigma^2}{n}\\tau$。\n\n**有效样本量** $n_{\\mathrm{eff}}$ 定义为与大小为 $n$ 的相关样本产生相同样本均值方差的等效 i.i.d. 样本的大小。数学上，我们设：\n$$\n\\text{Var}(\\bar{\\theta}_n) = \\frac{\\sigma^2}{n_{\\mathrm{eff}}}\n$$\n令我们关于 $\\text{Var}(\\bar{\\theta}_n)$ 的两个表达式相等：\n$$\n\\frac{\\sigma^2}{n_{\\mathrm{eff}}} = \\frac{\\sigma^2}{n} \\tau = \\frac{\\sigma^2}{n} \\left( 1 + 2\\sum_{k=1}^{\\infty} \\rho_k \\right)\n$$\n求解 $n_{\\mathrm{eff}}$ 得：\n$$\nn_{\\mathrm{eff}} = \\frac{n}{\\tau} = \\frac{n}{1 + 2\\sum_{k=1}^{\\infty} \\rho_k}\n$$\n这表明有效独立样本数从总链长 $n$ 减少了，减少的因子等于积分自相关时间 $\\tau$。\n\n3) AR(1) 过程的 $n_{\\mathrm{eff}}$ 计算。\n\n我们已知自相关结构可以由一阶自回归模型（AR(1)）很好地近似：$\\rho_k = \\phi^k$ 对于 $k \\ge 0$，且 $|\\phi|  1$。具体数值为 $n=10,000$ 和 $\\phi=0.85$。\n\n首先，我们计算该过程的积分自相关时间 $\\tau$。我们需要计算这个无穷级数：\n$$\n\\sum_{k=1}^{\\infty} \\rho_k = \\sum_{k=1}^{\\infty} \\phi^k\n$$\n这是一个首项为 $\\phi$、公比为 $\\phi$ 的几何级数。因为 $|\\phi| = |0.85|  1$，该级数收敛于：\n$$\n\\sum_{k=1}^{\\infty} \\phi^k = \\frac{\\phi}{1-\\phi}\n$$\n现在，将此结果代入 $\\tau$ 的公式中：\n$$\n\\tau = 1 + 2\\sum_{k=1}^{\\infty} \\phi^k = 1 + 2\\left(\\frac{\\phi}{1-\\phi}\\right) = \\frac{1-\\phi+2\\phi}{1-\\phi} = \\frac{1+\\phi}{1-\\phi}\n$$\n使用给定值 $\\phi=0.85$：\n$$\n\\tau = \\frac{1+0.85}{1-0.85} = \\frac{1.85}{0.15} = \\frac{185}{15} = \\frac{37}{3}\n$$\n积分自相关时间为 $\\tau = \\frac{37}{3} \\approx 12.33$。\n\n最后，我们使用 $n=10,000$ 计算有效样本量 $n_{\\mathrm{eff}}$：\n$$\nn_{\\mathrm{eff}} = \\frac{n}{\\tau} = \\frac{10,000}{\\frac{37}{3}} = \\frac{30,000}{37}\n$$\n进行除法运算：\n$$\nn_{\\mathrm{eff}} \\approx 810.810810...\n$$\n问题要求将数值答案四舍五入到四位有效数字。\n$$\nn_{\\mathrm{eff}} \\approx 810.8\n$$",
            "answer": "$$\\boxed{810.8}$$"
        }
    ]
}