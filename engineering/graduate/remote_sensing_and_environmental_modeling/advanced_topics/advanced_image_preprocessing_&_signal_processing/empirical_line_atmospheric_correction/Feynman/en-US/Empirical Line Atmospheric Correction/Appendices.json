{
    "hands_on_practices": [
        {
            "introduction": "The Empirical Line Method (ELM) begins with a simple yet powerful premise: for a given spectral band, a linear relationship exists between at-sensor radiance and surface reflectance. This first exercise provides a direct application of this principle by using two reference targets—one dark and one bright—to define this line. By calculating the slope and intercept of this empirical line, you will perform the fundamental task of converting a measured Top-of-Atmosphere (TOA) radiance into a physically meaningful surface reflectance value .",
            "id": "3808707",
            "problem": "An imaging spectrometer measures Top-of-Atmosphere (TOA) radiance in a narrow spectral band at wavelength $\\lambda$. Under clear, spatially homogeneous atmospheric conditions, negligible adjacency effects, and Lambertian surface behavior, the bandwise radiative transfer for TOA radiance can be decomposed into a path component and a surface-leaving component transmitted to the sensor. For a fixed observation and illumination geometry, and for sufficiently narrow spectral response, this yields an affine dependence of TOA radiance on surface reflectance in that band. The Empirical Line Method (ELM) leverages two reference targets of known surface reflectance to determine the intercept (path radiance) and slope (system gain) of this affine mapping.\n\nYou are given two reference targets observed in the same acquisition:\n- Target $1$: reflectance $\\rho_{1} = 0.04$, measured TOA radiance $L_{1} = 12.6$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n- Target $2$: reflectance $\\rho_{2} = 0.56$, measured TOA radiance $L_{2} = 48.2$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n\nAssume the empirical affine mapping between TOA radiance and surface reflectance in this band is valid and constant across the scene. Using only fundamental principles and definitions appropriate to radiative transfer and remote sensing, derive the intercept $a_{\\lambda}$ and slope $b_{\\lambda}$ of the empirical line relating TOA radiance $L_{\\lambda}$ to reflectance $\\rho_{\\lambda}$, and then compute the reflectance $\\rho_{\\lambda}$ for a third pixel with measured TOA radiance $L_{\\lambda} = 30.0$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n\nExpress $a_{\\lambda}$ and $b_{\\lambda}$ in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$ and $\\rho_{\\lambda}$ as a unitless decimal. Round all three numerical results to four significant figures. Provide your final numerical results only.",
            "solution": "The problem is subjected to validation.\n\n### Step 1: Extract Givens\n-   The relationship between Top-of-Atmosphere (TOA) radiance, $L_{\\lambda}$, and surface reflectance, $\\rho_{\\lambda}$, is an affine mapping.\n-   Target $1$: reflectance $\\rho_{1} = 0.04$, measured TOA radiance $L_{1} = 12.6$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n-   Target $2$: reflectance $\\rho_{2} = 0.56$, measured TOA radiance $L_{2} = 48.2$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n-   A third pixel has a measured TOA radiance $L_{\\lambda} = 30.0$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n-   The task is to find the intercept $a_{\\lambda}$ and slope $b_{\\lambda}$ of the empirical line, and the reflectance $\\rho_{\\lambda}$ of the third pixel.\n-   All three numerical results must be rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on the Empirical Line Method (ELM), a standard and physically-based technique in remote sensing for atmospheric correction. The affine model $L_{\\lambda} \\approx a_{\\lambda} + b_{\\lambda}\\rho_{\\lambda}$ is a valid first-order approximation of the radiative transfer equation for an optically thin, homogeneous atmosphere over a Lambertian surface, which is consistent with the problem's stated conditions.\n-   **Well-Posed**: The problem provides two distinct points $(\\rho_1, L_1)$ and $(\\rho_2, L_2)$ which are necessary and sufficient to uniquely define a line, and thus determine its slope $b_{\\lambda}$ and intercept $a_{\\lambda}$. Subsequently, given a radiance $L_{\\lambda}$ for a third pixel, the reflectance $\\rho_{\\lambda}$ can be uniquely determined. The problem is self-contained and has a unique, stable solution.\n-   **Objective**: The problem is stated using precise, quantitative language and established scientific terminology. It is free of subjective or ambiguous phrasing.\n-   **Consistency and Realism**: The reflectance values ($\\rho_{1} = 0.04$ and $\\rho_{2} = 0.56$) are physically realistic, falling within the valid range of $[0, 1]$. The radiance values are also plausible for typical Earth observation sensors. There are no internal contradictions.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and objective. It is deemed **valid**. A solution will be derived.\n\nThe fundamental principle of the Empirical Line Method is the affine relationship between the at-sensor (or TOA) spectral radiance $L_{\\lambda}$ and the surface spectral reflectance $\\rho_{\\lambda}$. This relationship can be expressed as a linear equation:\n$$L_{\\lambda} = b_{\\lambda} \\rho_{\\lambda} + a_{\\lambda}$$\nHere, $b_{\\lambda}$ is the slope, which incorporates factors like total downwelling solar irradiance and atmospheric transmittance, and $a_{\\lambda}$ is the intercept, which primarily represents the atmospheric path radiance. The subscript $\\lambda$ denotes that these parameters are specific to the given spectral band. For notational simplicity in the derivation, the subscript $\\lambda$ will be omitted and reintroduced in the final expressions.\n\nWe are given two reference points $(\\rho_1, L_1)$ and $(\\rho_2, L_2)$, which must satisfy the linear equation. This yields a system of two linear equations with two unknowns, $a$ and $b$:\n$$L_1 = b \\rho_1 + a \\quad (1)$$\n$$L_2 = b \\rho_2 + a \\quad (2)$$\n\nTo find the slope $b$, we subtract equation $(1)$ from equation $(2)$:\n$$L_2 - L_1 = (b \\rho_2 + a) - (b \\rho_1 + a)$$\n$$L_2 - L_1 = b \\rho_2 - b \\rho_1 = b (\\rho_2 - \\rho_1)$$\nSolving for $b$ gives:\n$$b = \\frac{L_2 - L_1}{\\rho_2 - \\rho_1}$$\nReintroducing the spectral dependence, the slope $b_{\\lambda}$ is:\n$$b_{\\lambda} = \\frac{L_2 - L_1}{\\rho_2 - \\rho_1}$$\n\nTo find the intercept $a$, we can rearrange equation $(1)$:\n$$a = L_1 - b \\rho_1$$\nSubstituting the expression for $b$:\n$$a = L_1 - \\left( \\frac{L_2 - L_1}{\\rho_2 - \\rho_1} \\right) \\rho_1$$\nWe can find a common denominator to simplify this expression:\n$$a = \\frac{L_1(\\rho_2 - \\rho_1) - (L_2 - L_1)\\rho_1}{\\rho_2 - \\rho_1} = \\frac{L_1\\rho_2 - L_1\\rho_1 - L_2\\rho_1 + L_1\\rho_1}{\\rho_2 - \\rho_1}$$\n$$a = \\frac{L_1\\rho_2 - L_2\\rho_1}{\\rho_2 - \\rho_1}$$\nReintroducing the spectral dependence, the intercept $a_{\\lambda}$ is:\n$$a_{\\lambda} = \\frac{L_1 \\rho_2 - L_2 \\rho_1}{\\rho_2 - \\rho_1}$$\n\nNow, we substitute the given numerical values:\n$\\rho_1 = 0.04$, $L_1 = 12.6 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n$\\rho_2 = 0.56$, $L_2 = 48.2 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n\nCalculating the slope $b_{\\lambda}$:\n$$b_{\\lambda} = \\frac{48.2 - 12.6}{0.56 - 0.04} = \\frac{35.6}{0.52} \\approx 68.461538... \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$$\nRounding to four significant figures, $b_{\\lambda} = 68.46 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n\nCalculating the intercept $a_{\\lambda}$:\n$$a_{\\lambda} = \\frac{(12.6)(0.56) - (48.2)(0.04)}{0.56 - 0.04} = \\frac{7.056 - 1.928}{0.52} = \\frac{5.128}{0.52} \\approx 9.861538... \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$$\nRounding to four significant figures, $a_{\\lambda} = 9.862 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n\nThe final task is to compute the reflectance $\\rho_{\\lambda}$ for a pixel with a measured TOA radiance of $L_{\\lambda} = 30.0 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$. We start with the primary equation and solve for $\\rho_{\\lambda}$:\n$$L_{\\lambda} = b_{\\lambda} \\rho_{\\lambda} + a_{\\lambda}$$\n$$b_{\\lambda} \\rho_{\\lambda} = L_{\\lambda} - a_{\\lambda}$$\n$$\\rho_{\\lambda} = \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}}$$\n\nTo maintain precision, we use the unrounded values of $a_{\\lambda}$ and $b_{\\lambda}$ for this calculation:\n$$\\rho_{\\lambda} = \\frac{30.0 - 9.861538...}{68.461538...} = \\frac{20.138461...}{68.461538...} \\approx 0.294166...$$\nRounding the final result to four significant figures, the reflectance is $\\rho_{\\lambda} = 0.2942$. This is a unitless quantity.\n\nThe requested values are the intercept $a_{\\lambda}$, the slope $b_{\\lambda}$, and the target reflectance $\\rho_{\\lambda}$.\n-   $a_{\\lambda} \\approx 9.862 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n-   $b_{\\lambda} \\approx 68.46 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n-   $\\rho_{\\lambda} \\approx 0.2942$ (unitless)",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n9.862 & 68.46 & 0.2942\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While two points are sufficient to define a line, real-world atmospheric correction benefits from the statistical power of multiple calibration targets. This practice elevates the ELM from simple algebra to robust statistical estimation using Ordinary Least Squares (OLS) regression. You will not only determine the atmospheric correction parameters, $a_\\lambda$ and $b_\\lambda$, from a set of calibration points but also evaluate the quality of your linear model using the coefficient of determination ($R^2$), a critical step in validating the assumptions of the ELM .",
            "id": "3808740",
            "problem": "You are tasked with designing and implementing the Empirical Line Method (ELM) for atmospheric correction in the solar-reflective domain, framed from first principles and applied to calibration targets. The Empirical Line Method (ELM) assumes a Lambertian surface and a narrow spectral band, and that, over a small scene, atmospheric path contributions and transmittances can be treated as band-specific constants. Under these conditions, the band-specific at-sensor spectral radiance is an affine function of the band-specific surface reflectance. Starting from this physical basis, derive the appropriate affine model for a single wavelength band, and then estimate its parameters by Ordinary Least Squares (OLS), using calibration data consisting of pairs of surface reflectance and at-sensor radiance.\n\nScientific base to be used:\n- The radiative transfer in the solar-reflective domain combines atmospheric path radiance and surface-reflected radiance that has traversed the atmosphere. Under the Lambertian assumption and narrowband approximation, the surface-reflected contribution is proportional to surface reflectance and the proportionality constants collect terms of downwelling irradiance, atmospheric transmittance, and geometric factors.\n- Ordinary Least Squares (OLS) estimation minimizes the sum of squared differences between observations and model predictions for an affine model.\n- The Coefficient of Determination ($R^2$) quantifies the fraction of variance in the dependent variable explained by the model.\n\nTask:\n- For each provided test case, you are given $5$ calibration pairs $\\left(\\rho_i, L_i\\right)$, where $\\rho_i$ is unitless surface reflectance and $L_i$ is at-sensor spectral radiance in $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$ for a single wavelength band $\\lambda$ measured over calibration targets in a single acquisition.\n- Using the physically justified affine model, estimate the band-specific intercept $a_\\lambda$ and slope $b_\\lambda$ by Ordinary Least Squares (OLS).\n- Compute the residuals for the $5$ calibration pairs as the differences between the measured radiances and the model-predicted radiances.\n- Compute the Coefficient of Determination ($R^2$) for the fit.\n- Report, for each test case, a list containing the estimated $a_\\lambda$ (in $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$), the estimated $b_\\lambda$ (in $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$ per unit reflectance), the scalar $R^2$ (unitless), and the list of $5$ residuals (each in $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$). All floating-point outputs must be rounded to $6$ decimal places.\n\nUnits:\n- $L_i$: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$.\n- $\\rho_i$: unitless.\n- $a_\\lambda$: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$.\n- $b_\\lambda$: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$ per unit reflectance.\n- $R^2$: unitless.\n- Residuals: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$.\n\nTest suite:\n- Case $1$ (well-conditioned, modest noise):\n  - $\\rho$: $[0.02, 0.10, 0.20, 0.35, 0.50]$\n  - $L$: $[7.5, 16.95, 29.2, 46.85, 65.0]$\n- Case $2$ (small reflectance span, tests numerical stability):\n  - $\\rho$: $[0.30, 0.305, 0.310, 0.315, 0.320]$\n  - $L$: $[34.02, 34.39, 34.8, 35.215, 35.58]$\n- Case $3$ (outlier in one calibration pair):\n  - $\\rho$: $[0.05, 0.15, 0.25, 0.35, 0.45]$\n  - $L$: $[9.0, 19.0, 39.0, 39.0, 49.0]$\n- Case $4$ (perfect affine relationship):\n  - $\\rho$: $[0.00, 0.12, 0.24, 0.36, 0.48]$\n  - $L$: $[6.0, 16.8, 27.6, 38.4, 49.2]$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a nested list of the form $[a_\\lambda, b_\\lambda, R^2, [r_1, r_2, r_3, r_4, r_5]]$. For example: $[[a_1,b_1,R^2_1,[r_{1,1},\\dots,r_{1,5}]],[a_2,b_2,R^2_2,[r_{2,1},\\dots,r_{2,5}]],\\dots]$. All floating-point values must be rounded to $6$ decimal places.",
            "solution": "The problem is valid. It presents a well-defined task in the field of remote sensing, grounded in established physical principles of radiative transfer and standard statistical methods. All necessary data and conditions for a unique solution are provided, and no scientific or logical contradictions are present.\n\nThe Empirical Line Method (ELM) provides a robust, data-driven approach for atmospheric correction. It leverages in-situ measurements of surface reflectance from calibration targets to establish a direct, empirical relationship between surface properties and at-sensor measurements. This method is predicated on a set of simplifying yet physically justified assumptions for a single spectral band $\\lambda$ and a spatially limited scene.\n\n**1. Physical Model Derivation**\n\nThe fundamental principle is that the at-sensor spectral radiance, $L_\\lambda$, is an affine function of the surface reflectance, $\\rho$. This relationship arises from a simplified model of radiative transfer in the solar-reflective domain, assuming a homogeneous atmosphere over the scene and Lambertian (perfectly diffuse) reflectance from the surface targets. The model is expressed as:\n\n$$ L_\\lambda = a_\\lambda + b_\\lambda \\rho $$\n\nIn this equation:\n- $L_\\lambda$ is the at-sensor spectral radiance in units of $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$.\n- $\\rho$ is the unitless surface reflectance of a target.\n- $a_\\lambda$ is the model intercept, representing the atmospheric path radiance, $L_{path, \\lambda}$. This is the radiance scattered by the atmosphere into the sensor's view without interacting with the surface. It is the value of $L_\\lambda$ when $\\rho = 0$.\n- $b_\\lambda$ is the model slope. This term combines multiple physical factors: the total downwelling solar irradiance at the surface, $E_{down, \\lambda}$, and the atmospheric transmittance along the path from the surface to the sensor, $T_\\lambda^{\\uparrow}$. For a Lambertian surface, this relationship is encapsulated as $b_\\lambda = \\frac{E_{down, \\lambda} T_\\lambda^{\\uparrow}}{\\pi}$.\n\nThe goal is to estimate the band-specific atmospheric constants $a_\\lambda$ and $b_\\lambda$ using a set of $n$ calibration pairs $(\\rho_i, L_i)$.\n\n**2. Parameter Estimation by Ordinary Least Squares (OLS)**\n\nWe employ Ordinary Least Squares (OLS) to find the parameters $a_\\lambda$ and $b_\\lambda$ that best fit the calibration data. OLS minimizes the Sum of Squared Residuals (SSR), which is the sum of the squared differences between the measured radiances $L_i$ and the radiances predicted by the model, $\\hat{L_i} = a_\\lambda + b_\\lambda \\rho_i$.\n\n$$ SSR = \\sum_{i=1}^{n} (L_i - \\hat{L_i})^2 = \\sum_{i=1}^{n} (L_i - (a_\\lambda + b_\\lambda \\rho_i))^2 $$\n\nTo minimize $SSR$, we take the partial derivatives with respect to $a_\\lambda$ and $b_\\lambda$ and set them to zero. This procedure yields the following analytical solutions for the parameters:\n\nThe slope $b_\\lambda$ is given by the ratio of the covariance of $\\rho$ and $L$ to the variance of $\\rho$:\n$$ b_\\lambda = \\frac{\\sum_{i=1}^{n} (\\rho_i - \\bar{\\rho})(L_i - \\bar{L})}{\\sum_{i=1}^{n} (\\rho_i - \\bar{\\rho})^2} $$\n\nThe intercept $a_\\lambda$ is then determined to ensure the line passes through the point of averages $(\\bar{\\rho}, \\bar{L})$:\n$$ a_\\lambda = \\bar{L} - b_\\lambda \\bar{\\rho} $$\n\nHere, $\\bar{\\rho} = \\frac{1}{n}\\sum_{i=1}^{n}\\rho_i$ and $\\bar{L} = \\frac{1}{n}\\sum_{i=1}^{n}L_i$ are the sample means of the reflectance and radiance data, respectively.\n\n**3. Model Evaluation**\n\nOnce the parameters are estimated, the model's performance must be quantified.\n\n- **Residuals**: The residual for each calibration point, $r_i$, is the difference between the observed and predicted radiance. It quantifies the error of the model for that specific point.\n  $$ r_i = L_i - \\hat{L_i} = L_i - (a_\\lambda + b_\\lambda \\rho_i) $$\n  A list of these $n$ residuals provides a detailed view of the fit.\n\n- **Coefficient of Determination ($R^2$)**: The $R^2$ value provides a comprehensive measure of the goodness of fit. It represents the proportion of the variance in the dependent variable ($L$) that is explained by the independent variable ($\\rho$) via the affine model. It is calculated as:\n  $$ R^2 = 1 - \\frac{SSR}{SST} $$\n  where $SSR$ is the sum of squared residuals as defined previously, and $SST$ is the Total Sum of Squares, which measures the total variance in the observed radiance data:\n  $$ SST = \\sum_{i=1}^{n} (L_i - \\bar{L})^2 $$\n  An $R^2$ value close to $1$ indicates a very strong linear relationship and a good model fit, while a value close to $0$ suggests no linear relationship.\n\n**4. Algorithmic Implementation**\n\nFor each test case provided, the following computational steps are performed:\n1.  The input sets of $n=5$ calibration pairs $(\\rho_i, L_i)$ are defined.\n2.  The sample means, $\\bar{\\rho}$ and $\\bar{L}$, are computed.\n3.  The slope $b_\\lambda$ and intercept $a_\\lambda$ are calculated using the OLS formulas derived above.\n4.  The predicted radiance $\\hat{L_i}$ is calculated for each calibration point.\n5.  The residuals $r_i = L_i - \\hat{L_i}$ are computed for all $i=1, \\dots, 5$.\n6.  The $SST$ and $SSR$ are calculated to determine the $R^2$ value.\n7.  The final results—the estimated parameters $a_\\lambda$ and $b_\\lambda$, the $R^2$ statistic, and the list of residuals—are rounded to $6$ decimal places as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases for the Empirical Line Method.\n    \"\"\"\n\n    def perform_elm_ols(rho_data, l_data):\n        \"\"\"\n        Performs OLS regression for the Empirical Line Method.\n\n        Args:\n            rho_data (list): A list of surface reflectance values.\n            l_data (list): A list of corresponding at-sensor radiance values.\n\n        Returns:\n            list: A list containing [a, b, R2, [residuals]], all rounded to 6 decimal places.\n        \"\"\"\n        # Convert inputs to numpy arrays for vectorized operations, using 64-bit floats for precision.\n        rho = np.array(rho_data, dtype=np.float64)\n        L = np.array(l_data, dtype=np.float64)\n\n        # Calculate the sample means\n        rho_bar = np.mean(rho)\n        L_bar = np.mean(L)\n\n        # Calculate the slope (b_lambda) and intercept (a_lambda) using the OLS formulas.\n        # This form, using deviations from the mean, is generally more numerically stable.\n        # b = Cov(rho, L) / Var(rho)\n        numerator = np.sum((rho - rho_bar) * (L - L_bar))\n        denominator = np.sum((rho - rho_bar)**2)\n        \n        # Avoid division by zero if all rho values are identical (denominator would be 0).\n        # In such a case, the slope is undefined. For the given problem, this is not an issue.\n        if denominator == 0:\n            # This case is not expected based on the problem's test suite.\n            # A vertical line has an infinite slope. We return NaN for b and a.\n            # R^2 would be undefined.\n            b = np.nan\n            a = np.nan\n        else:\n            b = numerator / denominator\n            a = L_bar - b * rho_bar\n\n        # Calculate the predicted radiance values\n        L_hat = a + b * rho\n\n        # Calculate the residuals\n        residuals = L - L_hat\n\n        # Calculate the Coefficient of Determination (R^2)\n        # R^2 = 1 - (Sum of Squared Residuals / Total Sum of Squares)\n        ssr = np.sum(residuals**2)\n        sst = np.sum((L - L_bar)**2)\n        \n        # Avoid division by zero if all L values are identical (SST would be 0).\n        if sst == 0:\n            # If SST is 0, all L are the same. If SSR is also 0, fit is perfect, so R^2 is 1.\n            # Otherwise, the model has no explanatory power, and R^2 would be 0.\n            r2 = 1.0 if ssr == 0 else 0.0\n        else:\n            r2 = 1 - (ssr / sst)\n\n        # Round all floating-point results to 6 decimal places as required.\n        a_rounded = round(a, 6)\n        b_rounded = round(b, 6)\n        r2_rounded = round(r2, 6)\n        residuals_rounded = [round(res, 6) for res in residuals]\n        \n        return [a_rounded, b_rounded, r2_rounded, residuals_rounded]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (well-conditioned, modest noise)\n        {'rho': [0.02, 0.10, 0.20, 0.35, 0.50], 'L': [7.5, 16.95, 29.2, 46.85, 65.0]},\n        # Case 2 (small reflectance span, tests numerical stability)\n        {'rho': [0.30, 0.305, 0.310, 0.315, 0.320], 'L': [34.02, 34.39, 34.8, 35.215, 35.58]},\n        # Case 3 (outlier in one calibration pair)\n        {'rho': [0.05, 0.15, 0.25, 0.35, 0.45], 'L': [9.0, 19.0, 39.0, 39.0, 49.0]},\n        # Case 4 (perfect affine relationship)\n        {'rho': [0.00, 0.12, 0.24, 0.36, 0.48], 'L': [6.0, 16.8, 27.6, 38.4, 49.2]}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = perform_elm_ols(case['rho'], case['L'])\n        all_results.append(result)\n\n    # Format the final output string according to the specified format.\n    # Floating-point values are formatted to ensure 6 decimal places are shown.\n    def format_case_result(res):\n        a_str = f\"{res[0]:.6f}\"\n        b_str = f\"{res[1]:.6f}\"\n        r2_str = f\"{res[2]:.6f}\"\n        residuals_list_str = [f\"{r:.6f}\" for r in res[3]]\n        residuals_str = f\"[{','.join(residuals_list_str)}]\"\n        return f\"[{a_str},{b_str},{r2_str},{residuals_str}]\"\n\n    final_output_string = f\"[{','.join([format_case_result(res) for res in all_results])}]\"\n\n    # The final print statement must produce only the single-line formatted output.\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "A calculated reflectance value is of limited use without an understanding of its reliability. This final practice addresses the crucial topic of uncertainty, a cornerstone of quantitative science. Starting with the derived ELM equation, you will apply the principles of first-order uncertainty propagation to determine how errors in the calibration parameters, $a_\\lambda$ and $b_\\lambda$, and the measured radiance, $L_\\lambda$, combine to affect the final uncertainty of the retrieved surface reflectance .",
            "id": "3808679",
            "problem": "A narrowband imaging spectrometer operating in the solar reflective domain measures at-sensor radiance $L_{\\lambda}$ from a surface of unknown spectral reflectance $\\rho_{\\lambda}$ under a clear atmosphere. The Empirical Line Method (ELM) is a field-calibrated linearization of radiative transfer in which the instrument response at wavelength $\\lambda$ is represented as an affine mapping between surface reflectance and radiance, with parameters determined from field targets of known reflectance and their concurrently measured radiances. Let $a_{\\lambda}$ denote the atmospheric path radiance offset and $b_{\\lambda}$ the wavelength-dependent gain that encapsulates illumination, atmospheric transmission along the solar and sensor paths, and instrument throughput, all assumed constant over the calibration and acquisition interval.\n\nStarting from the physical premise that, over a sufficiently narrowband channel and restricted range of surface reflectances, the mapping between $L_{\\lambda}$ and $\\rho_{\\lambda}$ is linear with offset $a_{\\lambda}$ and gain $b_{\\lambda}$, derive the expression for $\\rho_{\\lambda}$ in terms of $L_{\\lambda}$, $a_{\\lambda}$, and $b_{\\lambda}$. Then, using first-order uncertainty propagation based on total differentials and assuming independence among $L_{\\lambda}$, $a_{\\lambda}$, and $b_{\\lambda}$, derive the expression for the standard uncertainty $\\sigma_{\\rho,\\lambda}$ of $\\rho_{\\lambda}$ in terms of $\\sigma_{L,\\lambda}$, $\\sigma_{a,\\lambda}$, and $\\sigma_{b,\\lambda}$.\n\nEvaluate your expressions for the following calibrated band:\n- $a_{\\lambda} = 10.0 \\pm 0.3$,\n- $b_{\\lambda} = 70.0 \\pm 3.0$,\n- $L_{\\lambda} = 35.0 \\pm 0.5$,\n\nwhere radiances are in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$ and $\\rho_{\\lambda}$ is dimensionless. Express $\\rho_{\\lambda}$ and $\\sigma_{\\rho,\\lambda}$ as pure decimals (no percent sign). Round both numerical values to four significant figures.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of radiative transfer and remote sensing, specifically the Empirical Line Method (ELM), and employs standard statistical uncertainty propagation. The problem is well-posed, objective, and contains all necessary information to derive a unique solution.\n\nThe relationship between at-sensor radiance $L_{\\lambda}$, surface reflectance $\\rho_{\\lambda}$, path radiance $a_{\\lambda}$, and gain $b_{\\lambda}$ is described as an affine mapping, specifically a linear function with an offset. This is formally expressed as:\n$$L_{\\lambda} = a_{\\lambda} + b_{\\lambda} \\rho_{\\lambda}$$\nwhere $a_{\\lambda}$ is the radiance offset corresponding to the atmospheric path radiance (the signal for a zero-reflectance target), and $b_{\\lambda}$ is the gain factor that incorporates the effects of solar illumination, two-way atmospheric transmittance, and sensor response.\n\nFirst, we derive the expression for the surface reflectance $\\rho_{\\lambda}$ by algebraically rearranging the equation:\n$$L_{\\lambda} - a_{\\lambda} = b_{\\lambda} \\rho_{\\lambda}$$\n$$\\rho_{\\lambda} = \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}}$$\nThis equation allows for the retrieval of surface reflectance from the measured at-sensor radiance, given the calibration coefficients $a_{\\lambda}$ and $b_{\\lambda}$.\n\nNext, we derive the expression for the standard uncertainty of the retrieved reflectance, $\\sigma_{\\rho,\\lambda}$. We use the formula for first-order uncertainty propagation for a function $f(x_1, x_2, \\dots, x_n)$ with independent variables $x_i$ having standard uncertainties $\\sigma_{x_i}$:\n$$\\sigma_f^2 = \\sum_{i=1}^{n} \\left( \\frac{\\partial f}{\\partial x_i} \\right)^2 \\sigma_{x_i}^2$$\nIn our case, the function is $\\rho_{\\lambda}(L_{\\lambda}, a_{\\lambda}, b_{\\lambda})$, and the independent variables are $L_{\\lambda}$, $a_{\\lambda}$, and $b_{\\lambda}$. We compute the partial derivatives of $\\rho_{\\lambda}$ with respect to each variable:\n$$\\frac{\\partial \\rho_{\\lambda}}{\\partial L_{\\lambda}} = \\frac{\\partial}{\\partial L_{\\lambda}} \\left( \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}} \\right) = \\frac{1}{b_{\\lambda}}$$\n$$\\frac{\\partial \\rho_{\\lambda}}{\\partial a_{\\lambda}} = \\frac{\\partial}{\\partial a_{\\lambda}} \\left( \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}} \\right) = -\\frac{1}{b_{\\lambda}}$$\n$$\\frac{\\partial \\rho_{\\lambda}}{\\partial b_{\\lambda}} = \\frac{\\partial}{\\partial b_{\\lambda}} \\left( (L_{\\lambda} - a_{\\lambda}) b_{\\lambda}^{-1} \\right) = (L_{\\lambda} - a_{\\lambda})(-1)b_{\\lambda}^{-2} = -\\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}^2}$$\n\nSubstituting these partial derivatives into the uncertainty propagation formula, we get the squared uncertainty $\\sigma_{\\rho,\\lambda}^2$:\n$$\\sigma_{\\rho,\\lambda}^2 = \\left(\\frac{\\partial \\rho_{\\lambda}}{\\partial L_{\\lambda}}\\right)^2 \\sigma_{L,\\lambda}^2 + \\left(\\frac{\\partial \\rho_{\\lambda}}{\\partial a_{\\lambda}}\\right)^2 \\sigma_{a,\\lambda}^2 + \\left(\\frac{\\partial \\rho_{\\lambda}}{\\partial b_{\\lambda}}\\right)^2 \\sigma_{b,\\lambda}^2$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\left(\\frac{1}{b_{\\lambda}}\\right)^2 \\sigma_{L,\\lambda}^2 + \\left(-\\frac{1}{b_{\\lambda}}\\right)^2 \\sigma_{a,\\lambda}^2 + \\left(-\\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}^2}\\right)^2 \\sigma_{b,\\lambda}^2$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{1}{b_{\\lambda}^2} \\sigma_{L,\\lambda}^2 + \\frac{1}{b_{\\lambda}^2} \\sigma_{a,\\lambda}^2 + \\frac{(L_{\\lambda} - a_{\\lambda})^2}{b_{\\lambda}^4} \\sigma_{b,\\lambda}^2$$\nTaking the square root gives the standard uncertainty $\\sigma_{\\rho,\\lambda}$:\n$$\\sigma_{\\rho,\\lambda} = \\sqrt{\\frac{\\sigma_{L,\\lambda}^2 + \\sigma_{a,\\lambda}^2}{b_{\\lambda}^2} + \\frac{(L_{\\lambda} - a_{\\lambda})^2}{b_{\\lambda}^4} \\sigma_{b,\\lambda}^2}$$\nThis is the general expression for the uncertainty in the retrieved reflectance.\n\nFinally, we evaluate these expressions using the provided numerical data:\n- $a_{\\lambda} = 10.0$ with uncertainty $\\sigma_{a,\\lambda} = 0.3$\n- $b_{\\lambda} = 70.0$ with uncertainty $\\sigma_{b,\\lambda} = 3.0$\n- $L_{\\lambda} = 35.0$ with uncertainty $\\sigma_{L,\\lambda} = 0.5$\n\nWe first calculate the value of the reflectance $\\rho_{\\lambda}$:\n$$\\rho_{\\lambda} = \\frac{35.0 - 10.0}{70.0} = \\frac{25.0}{70.0} = \\frac{5}{14} \\approx 0.3571428...$$\nRounding to four significant figures, we get $\\rho_{\\lambda} = 0.3571$.\n\nNow, we calculate the standard uncertainty $\\sigma_{\\rho,\\lambda}$. We substitute the numerical values into the derived uncertainty formula:\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{(0.5)^2 + (0.3)^2}{(70.0)^2} + \\frac{(35.0 - 10.0)^2}{(70.0)^4} (3.0)^2$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{0.25 + 0.09}{4900} + \\frac{(25.0)^2}{(2.401 \\times 10^7)} (9.0)$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{0.34}{4900} + \\frac{625 \\times 9.0}{2.401 \\times 10^7}$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{0.34}{4900} + \\frac{5625}{24010000}$$\n$$\\sigma_{\\rho,\\lambda}^2 \\approx 6.93877... \\times 10^{-5} + 2.34277... \\times 10^{-4}$$\n$$\\sigma_{\\rho,\\lambda}^2 \\approx 3.03665... \\times 10^{-4}$$\nTaking the square root to find the standard uncertainty:\n$$\\sigma_{\\rho,\\lambda} = \\sqrt{3.03665... \\times 10^{-4}} \\approx 0.01742599...$$\nRounding to four significant figures, we get $\\sigma_{\\rho,\\lambda} = 0.01743$.\n\nThus, the retrieved reflectance is $\\rho_{\\lambda} = 0.3571$ and its standard uncertainty is $\\sigma_{\\rho,\\lambda} = 0.01743$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.3571 & 0.01743\n\\end{pmatrix}\n}\n$$"
        }
    ]
}