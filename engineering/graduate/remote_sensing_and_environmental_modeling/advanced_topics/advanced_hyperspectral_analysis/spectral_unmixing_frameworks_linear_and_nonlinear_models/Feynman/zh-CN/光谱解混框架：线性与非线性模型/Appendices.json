{
    "hands_on_practices": [
        {
            "introduction": "光谱解混最直接的数学方法是应用无约束最小二乘法（Unconstrained Least Squares, ULS）。这个练习将此作为我们实践的起点，通过求解一个简化的线性系统来估算丰度。通过这个计算，我们将揭示为什么这种无约束的方法在物理上往往是不可行的，因为它可能违反非负性和“和为一”等基本约束，从而强调了在光谱解混中引入约束的必要性 。",
            "id": "3855536",
            "problem": "考虑遥感中光谱解混的线性混合模型 (LMM)：一个观测到的光谱 $x \\in \\mathbb{R}^{L}$ 表示为 $P$ 个端元光谱的线性组合，这些端元光谱收集在矩阵 $M \\in \\mathbb{R}^{L \\times P}$ 中，因此 $x = M a + n$，其中 $a \\in \\mathbb{R}^{P}$ 是丰度向量，$n \\in \\mathbb{R}^{L}$ 是测量噪声。在没有约束的情况下，无约束最小二乘 (ULS) 丰度估计旨在最小化平方重构误差 $\\|x - M a\\|_{2}^{2}$。\n\n一个高光谱像素在 $L = 3$ 个波段上进行测量，有 $P = 3$ 个候选端元。端元矩阵和像素光谱由下式给出\n$$\nM =\n\\begin{bmatrix}\n0.2 & 0.7 & 0.1 \\\\\n0.3 & 0.1 & 0.6 \\\\\n0.5 & 0.2 & 0.4\n\\end{bmatrix},\n\\quad\nx =\n\\begin{bmatrix}\n0.35 \\\\\n0.25 \\\\\n0.4\n\\end{bmatrix},\n\\quad\nn = 0.\n$$\n从 LMM 下的 ULS 问题定义出发，且不引入任何丰度约束，推导正规方程并计算 ULS 丰度估计 $\\hat{a} \\in \\mathbb{R}^{3}$。然后，使用线性光谱解混的标准物理丰度约束（非负性和和为一），判断 $\\hat{a}$ 是否违反了这些约束，并以小数形式量化任何违规。将 $\\hat{a}$ 的分量四舍五入到 $4$ 位有效数字，并以小数表示。最终答案必须仅为丰度向量（无单位）。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n*   **模型**：线性混合模型 (LMM)，$x = M a + n$。\n*   $x \\in \\mathbb{R}^{L}$ 是观测光谱。\n*   $M \\in \\mathbb{R}^{L \\times P}$ 是端元矩阵。\n*   $a \\in \\mathbb{R}^{P}$ 是丰度向量。\n*   $n \\in \\mathbb{R}^{L}$ 是测量噪声。\n*   **估计量**：无约束最小二乘 (ULS)，它最小化成本函数 $J(a) = \\|x - M a\\|_{2}^{2}$。\n*   **维度**：光谱波段数 $L=3$，端元数 $P=3$。\n*   **端元矩阵**：\n    $$\n    M =\n    \\begin{bmatrix}\n    0.2 & 0.7 & 0.1 \\\\\n    0.3 & 0.1 & 0.6 \\\\\n    0.5 & 0.2 & 0.4\n    \\end{bmatrix}\n    $$\n*   **观测光谱**：\n    $$\n    x =\n    \\begin{bmatrix}\n    0.35 \\\\\n    0.25 \\\\\n    0.4\n    \\end{bmatrix}\n    $$\n*   **噪声向量**：$n = 0$。\n*   **任务**：\n    1.  推导正规方程。\n    2.  计算 ULS 丰度估计 $\\hat{a}$。\n    3.  检查是否违反非负性 ($a_i \\ge 0$) 和和为一 ($\\sum a_i = 1$) 约束。\n    4.  量化任何违规。\n    5.  将 $\\hat{a}$ 的分量四舍五入到 4 位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n*   **科学依据**：该问题是线性代数在遥感领域，特别是高光谱解混中的一个标准应用。LMM 和 ULS 是基础且广泛使用的概念。该问题在科学上是合理的。\n*   **适定性**：该问题需要求解一个线性方程组。由于端元矩阵 $M$ 是一个方阵 ($L=P=3$)，当且仅当 $M$ 可逆时，丰度向量 $a$ 存在唯一解。$M$ 的行列式为 $\\det(M) = 0.2(0.1 \\cdot 0.4 - 0.6 \\cdot 0.2) - 0.7(0.3 \\cdot 0.4 - 0.6 \\cdot 0.5) + 0.1(0.3 \\cdot 0.2 - 0.1 \\cdot 0.5) = 0.2(-0.08) - 0.7(-0.18) + 0.1(0.01) = -0.016 + 0.126 + 0.001 = 0.111$。由于 $\\det(M) \\neq 0$，矩阵 $M$ 是可逆的，存在唯一解。该问题是适定的。\n*   **客观性**：该问题使用精确的数学语言和定义进行陈述，没有任何主观性或模糊性。\n*   **其他缺陷**：该问题不违反任何其他标准。它是自包含的、一致的，并且可以科学地形式化。\n\n**步骤 3：结论与行动**\n\n该问题是**有效的**。将提供完整的解答。\n\n### 解\n\n无约束最小二乘 (ULS) 问题定义为找到丰度向量 $\\hat{a}$，以最小化残差的平方欧几里得范数：\n$$\n\\hat{a} = \\arg\\min_{a} \\|x - Ma\\|_{2}^{2}\n$$\n要最小化的成本函数是 $J(a) = \\|x - Ma\\|_{2}^{2}$。我们可以展开这个表达式：\n$$\nJ(a) = (x - Ma)^{T}(x - Ma) = (x^T - a^T M^T)(x - Ma) = x^T x - x^T Ma - a^T M^T x + a^T M^T M a\n$$\n由于 $x^T Ma$ 是一个标量，它等于其转置，即 $(x^T Ma)^T = a^T M^T x$。因此，成本函数简化为：\n$$\nJ(a) = x^T x - 2a^T M^T x + a^T M^T M a\n$$\n为了找到最小值，我们计算 $J(a)$ 关于 $a$ 的梯度并将其设为零：\n$$\n\\nabla_{a} J(a) = \\nabla_{a} (x^T x - 2a^T M^T x + a^T M^T M a) = 0 - 2M^T x + 2M^T M a\n$$\n将梯度设为零可得：\n$$\n2M^T M a = 2M^T x\n$$\n这导出了**正规方程**：\n$$\nM^T M a = M^T x\n$$\nULS 估计的通解是 $\\hat{a} = (M^T M)^{-1} M^T x$。\n\n在这个具体问题中，给定噪声项 $n$ 为零，且矩阵 $M$ 是一个方阵（$3 \\times 3$）且可逆。模型 $x = Ma + n$ 简化为 $x = Ma$。我们可以通过左乘 $M$ 的逆矩阵直接求解 $a$：\n$$\n\\hat{a} = M^{-1}x\n$$\n这等价于在 $M$ 可逆时求解正规方程：$M^T M a = M^T x \\implies (M^T)^{-1}M^T M a = (M^T)^{-1}M^T x \\implies Ma = x \\implies a = M^{-1}x$。\n\n我们继续计算 $M^{-1}$。矩阵 $M$ 的逆由 $M^{-1} = \\frac{1}{\\det(M)}\\text{adj}(M)$ 给出，其中 $\\text{adj}(M)$ 是 $M$ 的伴随矩阵。\n前面计算出行列式为 $\\det(M) = 0.111$。\n代数余子式矩阵 $C$ 为：\n$$\nC_{11} = +(0.1 \\cdot 0.4 - 0.6 \\cdot 0.2) = -0.08 \\\\\nC_{12} = -(0.3 \\cdot 0.4 - 0.6 \\cdot 0.5) = 0.18 \\\\\nC_{13} = +(0.3 \\cdot 0.2 - 0.1 \\cdot 0.5) = 0.01 \\\\\nC_{21} = -(0.7 \\cdot 0.4 - 0.1 \\cdot 0.2) = -0.26 \\\\\nC_{22} = +(0.2 \\cdot 0.4 - 0.1 \\cdot 0.5) = 0.03 \\\\\nC_{23} = -(0.2 \\cdot 0.2 - 0.7 \\cdot 0.5) = 0.31 \\\\\nC_{31} = +(0.7 \\cdot 0.6 - 0.1 \\cdot 0.1) = 0.41 \\\\\nC_{32} = -(0.2 \\cdot 0.6 - 0.1 \\cdot 0.3) = -0.09 \\\\\nC_{33} = +(0.2 \\cdot 0.1 - 0.7 \\cdot 0.3) = -0.19\n$$\n所以，代数余子式矩阵是 $C = \\begin{bmatrix} -0.08 & 0.18 & 0.01 \\\\ -0.26 & 0.03 & 0.31 \\\\ 0.41 & -0.09 & -0.19 \\end{bmatrix}$。\n伴随矩阵是代数余子式矩阵的转置，$\\text{adj}(M) = C^T$：\n$$\n\\text{adj}(M) = \\begin{bmatrix} -0.08 & -0.26 & 0.41 \\\\ 0.18 & 0.03 & -0.09 \\\\ 0.01 & 0.31 & -0.19 \\end{bmatrix}\n$$\n逆矩阵是：\n$$\nM^{-1} = \\frac{1}{0.111} \\begin{bmatrix} -0.08 & -0.26 & 0.41 \\\\ 0.18 & 0.03 & -0.09 \\\\ 0.01 & 0.31 & -0.19 \\end{bmatrix}\n$$\n现在我们计算丰度向量 $\\hat{a} = M^{-1}x$：\n$$\n\\hat{a} = \\frac{1}{0.111} \\begin{bmatrix} -0.08 & -0.26 & 0.41 \\\\ 0.18 & 0.03 & -0.09 \\\\ 0.01 & 0.31 & -0.19 \\end{bmatrix} \\begin{bmatrix} 0.35 \\\\ 0.25 \\\\ 0.4 \\end{bmatrix}\n$$\n$$\n\\hat{a} = \\frac{1}{0.111} \\begin{bmatrix} (-0.08)(0.35) + (-0.26)(0.25) + (0.41)(0.4) \\\\ (0.18)(0.35) + (0.03)(0.25) + (-0.09)(0.4) \\\\ (0.01)(0.35) + (0.31)(0.25) + (-0.19)(0.4) \\end{bmatrix}\n$$\n$$\n\\hat{a} = \\frac{1}{0.111} \\begin{bmatrix} -0.028 - 0.065 + 0.164 \\\\ 0.063 + 0.0075 - 0.036 \\\\ 0.0035 + 0.0775 - 0.076 \\end{bmatrix} = \\frac{1}{0.111} \\begin{bmatrix} 0.071 \\\\ 0.0345 \\\\ 0.005 \\end{bmatrix} = \\begin{bmatrix} \\frac{0.071}{0.111} \\\\ \\frac{0.0345}{0.111} \\\\ \\frac{0.005}{0.111} \\end{bmatrix}\n$$\n计算各分量：\n$$\n\\hat{a}_1 = 0.63963963... \\\\\n\\hat{a}_2 = 0.31081081... \\\\\n\\hat{a}_3 = 0.04504504...\n$$\n四舍五入到 4 位有效数字，我们得到：\n$$\n\\hat{a} \\approx \\begin{bmatrix} 0.6396 \\\\ 0.3108 \\\\ 0.04505 \\end{bmatrix}\n$$\n\n接下来，我们检查是否违反了物理丰度约束。\n1.  **非负性约束 (ANC)**: 对所有 $i=1, 2, 3$，$a_i \\ge 0$。\n    *   $\\hat{a}_1 \\approx 0.6396 > 0$\n    *   $\\hat{a}_2 \\approx 0.3108 > 0$\n    *   $\\hat{a}_3 \\approx 0.04505 > 0$\n    此约束对所有分量都满足。没有违反非负性。\n\n2.  **和为一约束 (ASC)**: $\\sum_{i=1}^{3} a_i = 1$。\n    为了获得更好的精度，使用未四舍五入的值，其和为：\n    $$\n    \\sum_{i=1}^{3} \\hat{a}_i = \\frac{0.071 + 0.0345 + 0.005}{0.111} = \\frac{0.1105}{0.111} \\approx 0.995495...\n    $$\n    和不等于 $1$。此约束被违反。\n    违规量是和与 $1$ 之间的差值：\n    $$\n    \\text{Violation} = \\sum_{i=1}^{3} \\hat{a}_i - 1 = \\frac{0.1105}{0.111} - 1 = \\frac{0.1105 - 0.111}{0.111} = \\frac{-0.0005}{0.111} \\approx -0.0045045...\n    $$\n    丰度之和约为 $0.9955$，相对于和为一的要求，存在约 $0.0045$ 的差额。\n\n要求的最终答案是丰度向量 $\\hat{a}$，其分量四舍五入到 4 位有效数字。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6396 \\\\\n0.3108 \\\\\n0.04505\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在理论模型应用于真实遥感数据时，我们必须考虑大气等环境因素的影响。本练习引入了一个常见的实际问题：大气程辐射，它会在观测信号中引入一个加性偏移。您将学习如何利用场景中的“暗像元”来估计并校正这个偏移，并通过定量分析证明，这一校正步骤对于恢复丰度估计的物理有效性（特别是“和为一”约束）至关重要 。",
            "id": "3855570",
            "problem": "在一个从 $0.65\\,\\mu\\mathrm{m}$ 到 $0.70\\,\\mu\\mathrm{m}$ 的窄可见光谱窗口内，大气剩余路径辐射近似波段不变。在此条件下，考虑一个三波段像素和一个三端元库，并应用线性混合模型 (LMM)。LMM 假设，在不考虑大气剩余的情况下，观测到的反射率是各端元反射率的线性组合，其丰度为非负且总和为一。具体来说，设端元反射率矩阵 $M \\in \\mathbb{R}^{3 \\times 3}$ 的列分别对应植被、土壤和水：\n$$\nM \\;=\\; \\begin{pmatrix}\n0.12 & 0.32 & 0.01 \\\\\n0.10 & 0.28 & 0.01 \\\\\n0.11 & 0.26 & 0.01\n\\end{pmatrix}.\n$$\n假设在此窗口内，真实的水体端元反射率为 $w = \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix}$。观测到两个被目视识别为深水的暗像素，其传感器处反射率向量为\n$$\ny^{(1)}_{\\mathrm{dark}} = \\begin{pmatrix}0.044 \\\\ 0.043 \\\\ 0.045\\end{pmatrix}, \n\\quad\ny^{(2)}_{\\mathrm{dark}} = \\begin{pmatrix}0.042 \\\\ 0.043 \\\\ 0.041\\end{pmatrix}.\n$$\n一个目标像素的传感器处观测反射率为\n$$\ny_{\\mathrm{obs}} = \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix}.\n$$\n在此光谱窗口内，剩余的大气路径辐射为每个波段均等地增加一个偏移量 $c \\in \\mathbb{R}$，因此观测反射率与真实反射率的关系为\n$$\ny_{\\mathrm{obs}} \\;=\\; y_{\\mathrm{true}} + c\\,\\mathbf{1},\n$$\n其中 $\\mathbf{1} = \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix}$，且 $y_{\\mathrm{true}} = M a_{\\mathrm{true}}$，其中 $a_{\\mathrm{true}}$ 是一个丰度向量，其分量在 LMM 下总和为一。\n\n从 LMM 的核心定义出发，利用暗像素和已知的水体反射率 $w$ 对 $c$ 进行最小二乘估计，完成以下任务：\n\n1. 利用两个暗像素和 $w$ 推导并计算标量大气偏移量 $c$ 的最小二乘估计值 $\\hat{c}$。\n\n2. 使用不去除偏移量的线性混合方法（即，对 $y_{\\mathrm{obs}}$ 直接使用 $M$ 的逆矩阵），确定目标像素获得的丰度之和，并解释为何这违反了 LMM 的和为一约束。\n\n3. 从概念上和定量上证明，在解混前减去估计的偏移量 $\\hat{c}\\,\\mathbf{1}$ 可以恢复丰度的和为一性质。\n\n你最终报告的量必须是当对 $y_{\\mathrm{obs}}$ 进行不去除偏移量的直接解混时，目标像素的丰度之和。将此最终量表示为一个无量纲小数，并四舍五入到四位有效数字。",
            "solution": "所述问题具有科学依据，提法明确，并包含了唯一解所需的所有信息。其基础模型是线性混合模型 (LMM) 在遥感领域结合简化大气校正的一个标准应用。因此，我们可以着手求解。\n\n问题需要进行三部分分析。我们将依次处理每个部分。\n\n首先，我们推导并计算大气路径辐射偏移量 $c$ 的最小二乘估计值 $\\hat{c}$。问题指出该偏移量是一个波段不变的标量。观测反射率向量 $y_{\\mathrm{obs}}$ 的模型由 $y_{\\mathrm{obs}} = y_{\\mathrm{true}} + c\\,\\mathbf{1}$ 给出，其中 $y_{\\mathrm{true}}$ 是真实地表反射率，$\\mathbf{1}$ 是全一向量。两个暗像素 $y^{(1)}_{\\mathrm{dark}}$ 和 $y^{(2)}_{\\mathrm{dark}}$ 被识别为深水。这意味着它们的真实地表反射率是水体端元光谱 $w = \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix}$。因此，对于这些像素，模型为 $y^{(i)}_{\\mathrm{dark}} = w + c\\,\\mathbf{1} + \\epsilon^{(i)}$，其中 $\\epsilon^{(i)}$ 是第 $i$ 个像素观测的随机误差向量。\n\n为了找到最小二乘估计值 $\\hat{c}$，我们需要最小化来自暗像素的所有可用测量的平方误差之和。单个暗像素 $i$ 的单个波段 $j$ 的误差为 $(y^{(i)}_{\\mathrm{dark}, j} - (w_j + c))$。两个像素（每个像素有3个波段）的总平方误差和 $S(c)$ 为：\n$$\nS(c) = \\sum_{i=1}^{2} \\sum_{j=1}^{3} \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j - c \\right)^2\n$$\n为了最小化 $S(c)$，我们对其关于 $c$求导并令其为零：\n$$\n\\frac{dS}{dc} = \\sum_{i=1}^{2} \\sum_{j=1}^{3} 2 \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j - c \\right) (-1) = 0\n$$\n$$\n\\sum_{i=1}^{2} \\sum_{j=1}^{3} \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j \\right) = \\sum_{i=1}^{2} \\sum_{j=1}^{3} c = 6c\n$$\n这给出了估计量 $\\hat{c}$，即观测到的暗像素反射率与已知水体反射率之差的平均值：\n$$\n\\hat{c} = \\frac{1}{6} \\sum_{i=1}^{2} \\sum_{j=1}^{3} \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j \\right)\n$$\n让我们计算差值 $d^{(i)} = y^{(i)}_{\\mathrm{dark}} - w$:\n$$\nd^{(1)} = y^{(1)}_{\\mathrm{dark}} - w = \\begin{pmatrix}0.044 \\\\ 0.043 \\\\ 0.045\\end{pmatrix} - \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix} = \\begin{pmatrix}0.034 \\\\ 0.033 \\\\ 0.035\\end{pmatrix}\n$$\n$$\nd^{(2)} = y^{(2)}_{\\mathrm{dark}} - w = \\begin{pmatrix}0.042 \\\\ 0.043 \\\\ 0.041\\end{pmatrix} - \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix} = \\begin{pmatrix}0.032 \\\\ 0.033 \\\\ 0.031\\end{pmatrix}\n$$\n$d^{(1)}$ 和 $d^{(2)}$ 所有分量的总和为 $0.034 + 0.033 + 0.035 + 0.032 + 0.033 + 0.031 = 0.198$。\n因此，$c$ 的最小二乘估计值为：\n$$\n\\hat{c} = \\frac{0.198}{6} = 0.033\n$$\n\n第二，我们通过将 LMM 直接应用于未经大气校正的观测反射率 $y_{\\mathrm{obs}}$ 来确定目标像素的丰度之和。这种方法错误地假设 $y_{\\mathrm{obs}} = M a_{\\mathrm{naive}}$，其中 $a_{\\mathrm{naive}}$ 是“朴素”丰度向量。解为 $a_{\\mathrm{naive}} = M^{-1} y_{\\mathrm{obs}}$。端元矩阵给出如下：\n$$\nM = \\begin{pmatrix}\n0.12 & 0.32 & 0.01 \\\\\n0.10 & 0.28 & 0.01 \\\\\n0.11 & 0.26 & 0.01\n\\end{pmatrix}\n$$\n$M$ 的行列式为 $\\det(M) = 8 \\times 10^{-6}$，因此该矩阵是可逆的。其逆矩阵为：\n$$\nM^{-1} = \\frac{1}{8 \\times 10^{-6}} \\begin{pmatrix}\n0.0002 & -0.0006 & 0.0004 \\\\\n0.0001 & 0.0001 & -0.0002 \\\\\n-0.0048 & 0.0040 & 0.0016\n\\end{pmatrix} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix}\n$$\n现在我们使用 $y_{\\mathrm{obs}} = \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix}$ 计算朴素丰度向量 $a_{\\mathrm{naive}}$：\n$$\na_{\\mathrm{naive}} = M^{-1} y_{\\mathrm{obs}} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix} \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix}\n$$\n$$\na_{\\mathrm{naive}} = \\begin{pmatrix}\n25(0.242) - 75(0.214) + 50(0.208) \\\\\n12.5(0.242) + 12.5(0.214) - 25(0.208) \\\\\n-600(0.242) + 500(0.214) + 200(0.208)\n\\end{pmatrix} = \\begin{pmatrix}\n6.05 - 16.05 + 10.4 \\\\\n3.025 + 2.675 - 5.2 \\\\\n-145.2 + 107 + 41.6\n\\end{pmatrix} = \\begin{pmatrix}0.4 \\\\ 0.5 \\\\ 3.4\\end{pmatrix}\n$$\n这些丰度的总和为 $0.4 + 0.5 + 3.4 = 4.3$。LMM 要求丰度总和为一 ($\\sum_k a_k = 1$)。总和为 $4.3$ 明显违反了这一基本约束，使得朴素解混的结果在物理上无意义。这种差异是由于忽略了大气加性项 $c\\mathbf{1}$ 造成的。\n\n第三，我们证明减去估计的偏移量可以恢复和为一的性质。观测反射率的正确模型是 $y_{\\mathrm{obs}} = M a_{\\mathrm{true}} + c\\,\\mathbf{1}$。应用朴素求逆法可得：\n$$\na_{\\mathrm{naive}} = M^{-1} y_{\\mathrm{obs}} = M^{-1} (M a_{\\mathrm{true}} + c\\,\\mathbf{1}) = M^{-1} M a_{\\mathrm{true}} + c M^{-1} \\mathbf{1} = a_{\\mathrm{true}} + c M^{-1} \\mathbf{1}\n$$\n朴素丰度的总和，设 $\\mathbf{1}_R = \\begin{pmatrix}1 & 1 & 1\\end{pmatrix}$，则为：\n$$\n\\mathbf{1}_R a_{\\mathrm{naive}} = \\mathbf{1}_R a_{\\mathrm{true}} + c (\\mathbf{1}_R M^{-1} \\mathbf{1})\n$$\n根据定义，$\\mathbf{1}_R a_{\\mathrm{true}} = 1$。与1的偏差是 $c (\\mathbf{1}_R M^{-1} \\mathbf{1})$ 这一项。我们来计算这一项：\n$$\nM^{-1} \\mathbf{1} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix} = \\begin{pmatrix}0 \\\\ 0 \\\\ 100\\end{pmatrix}\n$$\n$$\n\\mathbf{1}_R M^{-1} \\mathbf{1} = \\begin{pmatrix}1 & 1 & 1\\end{pmatrix} \\begin{pmatrix}0 \\\\ 0 \\\\ 100\\end{pmatrix} = 100\n$$\n因此，理论上朴素丰度的总和为 $1 + 100c$。使用我们的估计值 $\\hat{c} = 0.033$，预期的总和为 $1 + 100(0.033) = 1 + 3.3 = 4.3$。这与我们的数值计算结果完全一致，证实了该概念框架的正确性。\n\n为了恢复和为一的性质，必须首先通过减去估计的大气贡献来校正观测反射率：$y_{\\mathrm{corr}} = y_{\\mathrm{obs}} - \\hat{c}\\,\\mathbf{1}$。然后对 $y_{\\mathrm{corr}}$ 进行解混：\n$$\ny_{\\mathrm{corr}} = \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix} - 0.033 \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix} = \\begin{pmatrix}0.209 \\\\ 0.181 \\\\ 0.175\\end{pmatrix}\n$$\n校正后的丰度向量 $a_{\\mathrm{corr}}$ 为：\n$$\na_{\\mathrm{corr}} = M^{-1} y_{\\mathrm{corr}} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix} \\begin{pmatrix}0.209 \\\\ 0.181 \\\\ 0.175\\end{pmatrix} = \\begin{pmatrix}\n5.225 - 13.575 + 8.75 \\\\\n2.6125 + 2.2625 - 4.375 \\\\\n-125.4 + 90.5 + 35\n\\end{pmatrix} = \\begin{pmatrix}0.4 \\\\ 0.5 \\\\ 0.1\\end{pmatrix}\n$$\n校正后丰度的总和为 $0.4 + 0.5 + 0.1 = 1.0$。这在定量上证明了，去除估计的大气偏移量通过满足和为一约束，恢复了 LMM 的物理一致性。\n\n要求作为最终答案的具体量是朴素解混得到的丰度之和。\n朴素丰度之和 = $4.3$。\n四舍五入到四位有效数字得到 $4.300$。",
            "answer": "$$\\boxed{4.300}$$"
        },
        {
            "introduction": "理论知识的最终目的是解决实际问题，这通常需要借助计算方法。本练习将引导您从理论转向实践，通过编程实现一个强大的优化算法——投影梯度下降法，来求解完全约束的最小二乘光谱解混问题。这项实践将理论与应用联系起来，让您掌握开发和验证光谱解混工具的核心计算技能 。",
            "id": "3855511",
            "problem": "考虑在遥感和环境建模中常见的线性光谱混合场景。一个具有 $L$ 个光谱波段的单一像素被建模为 $p$ 个端元光谱的线性组合，并带有加性测量噪声，其物理约束条件是丰度为非负且总和为一。令 $\\boldsymbol{y} \\in \\mathbb{R}^{L}$ 表示观测到的光谱向量，令 $\\boldsymbol{E} \\in \\mathbb{R}^{L \\times p}$ 表示端元矩阵，其列为端元光谱。未知丰度向量为 $\\boldsymbol{a} \\in \\mathbb{R}^{p}$，其约束集为 $\\mathcal{S} = \\left\\{ \\boldsymbol{a} \\in \\mathbb{R}^{p} \\,\\middle|\\, \\boldsymbol{a} \\ge \\boldsymbol{0}, \\ \\boldsymbol{1}^{\\top}\\boldsymbol{a} = 1 \\right\\}$。数据模型是经过充分检验的线性混合模型 $\\boldsymbol{y} = \\boldsymbol{E}\\boldsymbol{a} + \\boldsymbol{n}$，其中 $\\boldsymbol{n}$ 是加性噪声。\n\n以此为基础，推导并实现一种投影梯度下降迭代方法，通过最小化受约束的平方数据失配来估计 $\\boldsymbol{a}$，即求解优化问题 $\\min_{\\boldsymbol{a} \\in \\mathcal{S}} \\tfrac{1}{2}\\lVert \\boldsymbol{E}\\boldsymbol{a} - \\boldsymbol{y} \\rVert_{2}^{2}$。使用一个由光滑凸优化的基本原理保证收敛的恒定步长，并使用到单位单纯形上的欧几里得投影来强制执行约束 $\\mathcal{S}$。基于通过投影梯度映射定义的投影残差范数建立收敛准则，当满足此准则时终止。\n\n您必须生成一个单一程序，为以下参数值的测试套件计算丰度估计值，并打印包含结果的单行输出：\n\n该测试套件包含 4 个情况，具有 $L = 5$ 个光谱波段和 $p = 3$ 个端元。所有反射率和丰度都是无量纲分数，必须表示为小数（而不是百分比）。\n\n情况 1（“理想情况”，内部解）：\n$$\n\\boldsymbol{E}^{(1)} = \\begin{bmatrix}\n0.52 & 0.31 & 0.10 \\\\\n0.48 & 0.35 & 0.12 \\\\\n0.50 & 0.40 & 0.15 \\\\\n0.55 & 0.45 & 0.20 \\\\\n0.53 & 0.42 & 0.18\n\\end{bmatrix}, \\quad\n\\boldsymbol{a}_{\\text{true}}^{(1)} = \\begin{bmatrix} 0.20 \\\\ 0.50 \\\\ 0.30 \\end{bmatrix}, \\quad\n\\boldsymbol{y}^{(1)} = \\boldsymbol{E}^{(1)}\\boldsymbol{a}_{\\text{true}}^{(1)} + \\begin{bmatrix} 0.001 \\\\ -0.002 \\\\ 0.000 \\\\ 0.001 \\\\ -0.001 \\end{bmatrix}.\n$$\n\n情况 2（边界解，带有激活的非负约束）：\n$$\n\\boldsymbol{E}^{(2)} = \\boldsymbol{E}^{(1)}, \\quad\n\\boldsymbol{a}_{\\text{true}}^{(2)} = \\begin{bmatrix} 0.00 \\\\ 0.60 \\\\ 0.40 \\end{bmatrix}, \\quad\n\\boldsymbol{y}^{(2)} = \\boldsymbol{E}^{(2)}\\boldsymbol{a}_{\\text{true}}^{(2)} + \\begin{bmatrix} 0.0005 \\\\ 0.0000 \\\\ -0.0005 \\\\ 0.0005 \\\\ -0.0005 \\end{bmatrix}.\n$$\n\n情况 3（由于高反射率导致数据向量不一致且位于凸包之外；约束最小二乘解位于 $\\mathcal{S}$ 的边界上）：\n$$\n\\boldsymbol{E}^{(3)} = \\boldsymbol{E}^{(1)}, \\quad\n\\boldsymbol{y}^{(3)} = \\begin{bmatrix} 0.60 \\\\ 0.62 \\\\ 0.66 \\\\ 0.70 \\\\ 0.75 \\end{bmatrix}.\n$$\n\n情况 4（病态端元集，其列近似共线，用于测试数值稳定性）：\n$$\n\\boldsymbol{E}^{(4)} = \\begin{bmatrix}\n0.50 & 0.50 & 0.20 \\\\\n0.52 & 0.51 & 0.22 \\\\\n0.54 & 0.53 & 0.24 \\\\\n0.56 & 0.55 & 0.26 \\\\\n0.58 & 0.57 & 0.28\n\\end{bmatrix}, \\quad\n\\boldsymbol{a}_{\\text{true}}^{(4)} = \\begin{bmatrix} 0.10 \\\\ 0.70 \\\\ 0.20 \\end{bmatrix}, \\quad\n\\boldsymbol{y}^{(4)} = \\boldsymbol{E}^{(4)}\\boldsymbol{a}_{\\text{true}}^{(4)} + \\begin{bmatrix} -0.001 \\\\ 0.001 \\\\ 0.000 \\\\ -0.001 \\\\ 0.001 \\end{bmatrix}.\n$$\n\n源于基本原理的实现要求：\n您必须使用一个恒定步长 $\\gamma$，该步长取决于目标函数梯度的 Lipschitz 连续性。将 $\\boldsymbol{a}$ 在 $\\mathcal{S}$ 中均匀初始化为 $\\boldsymbol{a}^{(0)} = \\tfrac{1}{p}\\boldsymbol{1}$。在每次迭代中，对光滑目标函数执行一次梯度步进，然后投影到 $\\mathcal{S}$ 上。对 $\\mathcal{S}$ 使用到单位单纯形上的欧几里得投影。通过投影梯度映射定义投影残差，当残差范数除以 $\\max\\!\\left(1, \\lVert \\boldsymbol{a}^{(k)} \\rVert_{2}\\right)$ 小于预定容差时终止。\n\n对于所有情况，将容差设置为 $10^{-8}$，最大迭代次数设置为 $5000$。将每个丰度分量以小数形式打印到 6 位小数。您的程序应生成一个单行输出，其中包含用方括号括起来的逗号分隔的结果列表，其中每个项目本身是表示一个情况的丰度向量的 $p$ 个小数列表，例如 $[[\\dots],[\\dots],[\\dots],[\\dots]]$，不带空格。",
            "solution": "该问题要求推导并实现一个投影梯度下降算法，以解决源于线性光谱解混模型的约束最小二乘问题。优化问题是找到丰度向量 $\\boldsymbol{a}$，在满足物理约束的同时最小化数据失配。\n\n要最小化的目标函数是数据残差的平方欧几里得范数：\n$$\nf(\\boldsymbol{a}) = \\frac{1}{2}\\lVert \\boldsymbol{E}\\boldsymbol{a} - \\boldsymbol{y} \\rVert_{2}^{2}\n$$\n约束条件是丰度非负且总和为一。这个约束集 $\\mathcal{S} = \\left\\{ \\boldsymbol{a} \\in \\mathbb{R}^{p} \\,\\middle|\\, \\boldsymbol{a} \\ge \\boldsymbol{0}, \\ \\boldsymbol{1}^{\\top}\\boldsymbol{a} = 1 \\right\\}$ 是单位单纯形，它是一个闭合的凸集。目标函数 $f(\\boldsymbol{a})$ 是 $\\boldsymbol{a}$ 的二次函数，因此是凸且连续可微的。在凸集上最小化凸函数是一个凸优化问题，对于这类问题，像投影梯度下降这样的标准方法可以保证收敛到全局最小值。\n\n投影梯度下降法是一种迭代算法，它通过首先沿无约束目标函数的负梯度方向移动一步，然后将结果投影回可行集 $\\mathcal{S}$ 来更新当前估计值 $\\boldsymbol{a}^{(k)}$。更新规则是：\n$$\n\\boldsymbol{a}^{(k+1)} = \\mathcal{P}_{\\mathcal{S}}\\left(\\boldsymbol{a}^{(k)} - \\gamma \\nabla f(\\boldsymbol{a}^{(k)})\\right)\n$$\n其中 $\\boldsymbol{a}^{(k)}$ 是第 $k$ 次迭代的估计值，$\\gamma > 0$ 是步长，$\\nabla f(\\boldsymbol{a}^{(k)})$ 是在 $\\boldsymbol{a}^{(k)}$ 处计算的目标函数梯度，而 $\\mathcal{P}_{\\mathcal{S}}(\\cdot)$ 是到单纯形 $\\mathcal{S}$ 上的欧几里得投影算子。\n\n首先，我们推导 $f(\\boldsymbol{a})$ 的梯度。目标函数可以展开为：\n$$\nf(\\boldsymbol{a}) = \\frac{1}{2}(\\boldsymbol{E}\\boldsymbol{a} - \\boldsymbol{y})^{\\top}(\\boldsymbol{E}\\boldsymbol{a} - \\boldsymbol{y}) = \\frac{1}{2}(\\boldsymbol{a}^{\\top}\\boldsymbol{E}^{\\top}\\boldsymbol{E}\\boldsymbol{a} - 2\\boldsymbol{y}^{\\top}\\boldsymbol{E}\\boldsymbol{a} + \\boldsymbol{y}^{\\top}\\boldsymbol{y})\n$$\n关于向量 $\\boldsymbol{a}$ 的梯度是：\n$$\n\\nabla f(\\boldsymbol{a}) = \\boldsymbol{E}^{\\top}\\boldsymbol{E}\\boldsymbol{a} - \\boldsymbol{E}^{\\top}\\boldsymbol{y} = \\boldsymbol{E}^{\\top}(\\boldsymbol{E}\\boldsymbol{a} - \\boldsymbol{y})\n$$\n\n接下来，我们确定一个能保证收敛的步长 $\\gamma$。对于具有 Lipschitz 连续梯度的凸函数，如果步长 $\\gamma$ 的选择满足 $0 < \\gamma < 2/L_f$，则投影梯度下降的收敛性得到保证，其中 $L_f$ 是梯度 $\\nabla f(\\boldsymbol{a})$ 的 Lipschitz 常数。如果存在一个常数 $L_f$ 使得对于任意两个向量 $\\boldsymbol{a}_1, \\boldsymbol{a}_2$ 都满足以下条件，则梯度 $\\nabla f(\\boldsymbol{a})$ 是 Lipschitz 连续的：\n$$\n\\lVert \\nabla f(\\boldsymbol{a}_1) - \\nabla f(\\boldsymbol{a}_2) \\rVert_2 \\le L_f \\lVert \\boldsymbol{a}_1 - \\boldsymbol{a}_2 \\rVert_2\n$$\n对于我们的梯度，我们有：\n$$\n\\lVert \\nabla f(\\boldsymbol{a}_1) - \\nabla f(\\boldsymbol{a}_2) \\rVert_2 = \\lVert (\\boldsymbol{E}^{\\top}\\boldsymbol{E}\\boldsymbol{a}_1 - \\boldsymbol{E}^{\\top}\\boldsymbol{y}) - (\\boldsymbol{E}^{\\top}\\boldsymbol{E}\\boldsymbol{a}_2 - \\boldsymbol{E}^{\\top}\\boldsymbol{y}) \\rVert_2 = \\lVert \\boldsymbol{E}^{\\top}\\boldsymbol{E}(\\boldsymbol{a}_1 - \\boldsymbol{a}_2) \\rVert_2 \\le \\lVert \\boldsymbol{E}^{\\top}\\boldsymbol{E} \\rVert_2 \\lVert \\boldsymbol{a}_1 - \\boldsymbol{a}_2 \\rVert_2\n$$\n因此，Lipschitz 常数为 $L_f = \\lVert \\boldsymbol{E}^{\\top}\\boldsymbol{E} \\rVert_2$，其中 $\\lVert \\cdot \\rVert_2$ 表示谱范数（最大奇异值）。由于 $\\boldsymbol{E}^{\\top}\\boldsymbol{E}$ 是一个半正定矩阵，其谱范数等于其最大特征值 $\\lambda_{\\max}(\\boldsymbol{E}^{\\top}\\boldsymbol{E})$。这也等于 $\\boldsymbol{E}$ 的最大奇异值 $\\sigma_{\\max}(\\boldsymbol{E})$ 的平方。一个能保证收敛的安全且标准步长选择是 $\\gamma = 1/L_f = 1/\\sigma_{\\max}(\\boldsymbol{E})^2$。\n\n到单位单纯形上的投影 $\\boldsymbol{x} = \\mathcal{P}_{\\mathcal{S}}(\\boldsymbol{v})$ 是二次规划问题 $\\min_{\\boldsymbol{x} \\in \\mathcal{S}} \\frac{1}{2}\\lVert \\boldsymbol{x} - \\boldsymbol{v} \\rVert_2^2$ 的解。这个问题可以被高效地解决。一种标准算法包括将 $\\boldsymbol{v}$ 的分量降序排序，并找到一个阈值 $\\theta$，使得投影由 $x_i = \\max(v_i - \\theta, 0)$ 给出。\n\n该算法流程如下：\n1. 初始化 $\\boldsymbol{a}^{(0)} = \\frac{1}{p}\\boldsymbol{1}$。\n2. 计算步长 $\\gamma = 1 / \\sigma_{\\max}(\\boldsymbol{E})^2$。\n3. 对于 $k = 0, 1, 2, \\dots$ 直到收敛或达到最大迭代次数：\n    a. 计算梯度：$\\boldsymbol{g}^{(k)} = \\boldsymbol{E}^{\\top}(\\boldsymbol{E}\\boldsymbol{a}^{(k)} - \\boldsymbol{y})$。\n    b. 更新估计值：$\\boldsymbol{a}^{(k+1)} = \\mathcal{P}_{\\mathcal{S}}(\\boldsymbol{a}^{(k)} - \\gamma \\boldsymbol{g}^{(k)})$。\n    c. 检查收敛性。\n\n终止准则基于投影梯度的范数，对于一个稳定点 $\\boldsymbol{a}^*$，该范数必须为零。一个点 $\\boldsymbol{a}^*$ 是解的充要条件是它满足不动点方程 $\\boldsymbol{a}^* = \\mathcal{P}_{\\mathcal{S}}(\\boldsymbol{a}^* - \\gamma \\nabla f(\\boldsymbol{a}^*))$。投影梯度映射定义为 $\\nabla f_{\\text{proj}}(\\boldsymbol{a}) = \\frac{1}{\\gamma}(\\boldsymbol{a} - \\mathcal{P}_{\\mathcal{S}}(\\boldsymbol{a} - \\gamma \\nabla f(\\boldsymbol{a})))$。当该量的相对范数低于容差 $\\epsilon$ 时，我们终止迭代：\n$$\n\\frac{\\lVert \\nabla f_{\\text{proj}}(\\boldsymbol{a}^{(k)}) \\rVert_2}{\\max(1, \\lVert \\boldsymbol{a}^{(k)} \\rVert_2)} = \\frac{\\frac{1}{\\gamma} \\lVert \\boldsymbol{a}^{(k)} - \\boldsymbol{a}^{(k+1)} \\rVert_2}{\\max(1, \\lVert \\boldsymbol{a}^{(k)} \\rVert_2)} < \\epsilon\n$$\n对于此实现，我们使用指定的容差 $\\epsilon = 10^{-8}$ 和最大迭代次数 $5000$ 次。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the spectral unmixing problem for all test cases.\n    \"\"\"\n\n    def project_to_simplex(v):\n        \"\"\"\n        Projects a vector v onto the unit simplex using the algorithm\n        by Duchi et al. (2008).\n        \n        Args:\n            v (np.ndarray): The vector to project.\n        \n        Returns:\n            np.ndarray: The projected vector.\n        \"\"\"\n        p = len(v)\n        u = np.sort(v)[::-1]\n        cssv = np.cumsum(u)\n        \n        ind = np.arange(1, p + 1)\n        cond = u - (cssv - 1.0) / ind\n        \n        rho_candidates = np.where(cond > 0)[0]\n        if len(rho_candidates) == 0:\n            rho = p \n        else:\n            rho = rho_candidates[-1] + 1\n        \n        theta = (cssv[rho - 1] - 1.0) / rho\n        x = np.maximum(v - theta, 0)\n        \n        return x\n\n    def solve_abundances(E, y, tol=1e-8, max_iter=5000):\n        \"\"\"\n        Solves the constrained least squares problem for spectral unmixing\n        using projected gradient descent.\n        \n        Args:\n            E (np.ndarray): The endmember matrix (L x p).\n            y (np.ndarray): The observed pixel vector (L).\n            tol (float): The convergence tolerance.\n            max_iter (int): The maximum number of iterations.\n            \n        Returns:\n            np.ndarray: The estimated abundance vector (p).\n        \"\"\"\n        L, p = E.shape\n        \n        L_f = np.linalg.norm(E, 2)**2\n        gamma = 1.0 / L_f\n        \n        a = np.full(p, 1.0 / p)\n        \n        for k in range(max_iter):\n            grad_f = E.T @ (E @ a - y)\n            \n            a_unproj = a - gamma * grad_f\n            \n            a_next = project_to_simplex(a_unproj)\n            \n            projected_gradient_norm = np.linalg.norm(a - a_next) / gamma\n            norm_a = np.linalg.norm(a)\n            \n            if projected_gradient_norm / max(1.0, norm_a) < tol:\n                a = a_next\n                break\n            \n            a = a_next\n\n        return a\n\n    E1 = np.array([\n        [0.52, 0.31, 0.10],\n        [0.48, 0.35, 0.12],\n        [0.50, 0.40, 0.15],\n        [0.55, 0.45, 0.20],\n        [0.53, 0.42, 0.18]\n    ])\n    \n    # Case 1\n    a_true1 = np.array([0.20, 0.50, 0.30])\n    n1 = np.array([0.001, -0.002, 0.000, 0.001, -0.001])\n    y1 = E1 @ a_true1 + n1\n\n    # Case 2\n    E2 = E1\n    a_true2 = np.array([0.00, 0.60, 0.40])\n    n2 = np.array([0.0005, 0.0000, -0.0005, 0.0005, -0.0005])\n    y2 = E2 @ a_true2 + n2\n    \n    # Case 3\n    E3 = E1\n    y3 = np.array([0.60, 0.62, 0.66, 0.70, 0.75])\n\n    # Case 4\n    E4 = np.array([\n        [0.50, 0.50, 0.20],\n        [0.52, 0.51, 0.22],\n        [0.54, 0.53, 0.24],\n        [0.56, 0.55, 0.26],\n        [0.58, 0.57, 0.28]\n    ])\n    a_true4 = np.array([0.10, 0.70, 0.20])\n    n4 = np.array([-0.001, 0.001, 0.000, -0.001, 0.001])\n    y4 = E4 @ a_true4 + n4\n    \n    test_cases = [\n        (E1, y1),\n        (E2, y2),\n        (E3, y3),\n        (E4, y4),\n    ]\n\n    results = []\n    for E, y in test_cases:\n        a_est = solve_abundances(E, y)\n        results.append(a_est)\n        \n    formatted_results = []\n    for res_vec in results:\n        formatted_vec = ','.join([f'{x:.6f}' for x in res_vec])\n        formatted_results.append(f'[{formatted_vec}]')\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}