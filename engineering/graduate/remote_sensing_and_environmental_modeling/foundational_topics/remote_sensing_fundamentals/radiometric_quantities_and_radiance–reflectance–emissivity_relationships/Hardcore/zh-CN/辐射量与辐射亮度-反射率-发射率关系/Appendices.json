{
    "hands_on_practices": [
        {
            "introduction": "本练习将黑体辐射的基本理论与热遥感的实际应用联系起来。通过直接从普朗克定律推导维恩位移定律，您将更深刻地理解为何选择特定光谱波段来监测地表温度。这项实践旨在巩固您对温度 ($T$) 与峰值发射波长 ($\\lambda_{\\text{max}}$) 之间关系的理解，这是热红外遥感领域的基石。",
            "id": "3839634",
            "problem": "一个温度为 $T=300\\ \\mathrm{K}$ 的等温地表，被一个在热红外（TIR）大气窗口工作的星载辐射计观测。为确定其光谱辐射率峰值所在的波长，将该地表视为理想黑体发射体。仅从普朗克单位波长光谱辐射率公式\n$$B_{\\lambda}(T)=\\frac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T}\\right)-1\\right]^{-1},$$\n出发，通过第一性原理微积分，推导出决定峰值位置的超越条件，并获得满足 $\\lambda_{\\mathrm{max}} T=b$ 的位移常数 $b$ 的闭式表达式。然后，对于 $T=300\\ \\mathrm{K}$，数值计算 $\\lambda_{\\mathrm{max}}$。使用基本常数 $h=6.62607015\\times 10^{-34}\\ \\mathrm{J\\,s}$，$c=2.99792458\\times 10^{8}\\ \\mathrm{m\\,s^{-1}}$ 和 $k_{B}=1.380649\\times 10^{-23}\\ \\mathrm{J\\,K^{-1}}$。以微米为单位表示最终波长，并将答案四舍五入至四位有效数字。\n\n最后，在不使用任何简化公式的情况下，解释热发射峰的位置如何与辐射率-反射率-发射率关系相关联，包括对光谱均匀发射率 $\\varepsilon(\\lambda)=\\text{常数}$ 是否会改变发射光谱辐射率 $L_{\\lambda}=\\varepsilon(\\lambda) B_{\\lambda}(T)$ 在 $8$–$12\\ \\mathrm{\\mu m}$ 窗口内的峰值位置进行定性评估。",
            "solution": "该问题是有效的，因为它科学地基于黑体辐射原理，提法恰当、信息充分，并且表述客观。\n\n问题要求找到使普朗克单位波长光谱辐射率 $B_{\\lambda}(T)$ 达到最大值时的波长 $\\lambda_{\\mathrm{max}}$。函数给出为：\n$$B_{\\lambda}(T)=\\frac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T}\\right)-1\\right]^{-1}$$\n为求最大值，我们必须找到使 $B_{\\lambda}(T)$ 对 $\\lambda$ 的导数为零的 $\\lambda$ 值，即 $\\frac{d B_{\\lambda}(T)}{d \\lambda} = 0$。\n\n我们定义常数 $C_1 = 2 h c^2$ 和 $C_2 = \\frac{h c}{k_B}$ 来简化表达式。方程变为：\n$$B_{\\lambda}(T) = C_1 \\lambda^{-5} \\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right) - 1\\right]^{-1}$$\n我们使用乘法法则 $(uv)' = u'v + uv'$ 进行求导：\n$$\\frac{dB_{\\lambda}}{d\\lambda} = C_1 \\left( (-5\\lambda^{-6})\\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^{-1} + \\lambda^{-5} \\frac{d}{d\\lambda}\\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^{-1} \\right)$$\n对第二项的导数使用链式法则：\n$$\\frac{d}{d\\lambda}\\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^{-1} = -1 \\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^{-2} \\cdot \\exp\\left(\\frac{C_2}{\\lambda T}\\right) \\cdot \\left(-\\frac{C_2}{\\lambda^2 T}\\right)$$\n$$= \\frac{C_2}{\\lambda^2 T} \\frac{\\exp\\left(\\frac{C_2}{\\lambda T}\\right)}{\\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^2}$$\n将此代回 $B_{\\lambda}$ 的导数中：\n$$\\frac{dB_{\\lambda}}{d\\lambda} = C_1 \\left( -5\\lambda^{-6}\\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^{-1} + \\lambda^{-5} \\frac{C_2}{\\lambda^2 T} \\frac{\\exp\\left(\\frac{C_2}{\\lambda T}\\right)}{\\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^2} \\right)$$\n将导数设为零，并提出公因子（非零项）$C_1 \\lambda^{-6} \\left[\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1\\right]^{-1}$：\n$$-5 + \\lambda \\left(\\frac{C_2}{\\lambda^2 T} \\frac{\\exp\\left(\\frac{C_2}{\\lambda T}\\right)}{\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1}\\right) = 0$$\n$$-5 + \\frac{C_2}{\\lambda T} \\frac{\\exp\\left(\\frac{C_2}{\\lambda T}\\right)}{\\exp\\left(\\frac{C_2}{\\lambda T}\\right)-1} = 0$$\n为简化此方程，我们引入无量纲变量 $x = \\frac{C_2}{\\lambda T} = \\frac{hc}{\\lambda k_B T}$。方程变为：\n$$x \\frac{\\exp(x)}{\\exp(x)-1} = 5$$\n这可以被重新整理为所要求的超越条件。假设 $x \\neq 0$（对应于非无限波长），我们可以两边同乘以 $\\exp(x)-1$：\n$$x \\exp(x) = 5(\\exp(x)-1)$$\n$$x \\exp(x) = 5\\exp(x) - 5$$\n$$5 = (5-x)\\exp(x)$$\n这就是决定峰值位置的超越条件。\n\n接下来，我们求维恩位移定律 $\\lambda_{\\mathrm{max}} T = b$ 中位移常数 $b$ 的表达式。设 $x_0$ 为超越方程 $(5-x)\\exp(x)=5$ 的非零解。根据 $x$ 的定义，在峰值波长 $\\lambda_{\\mathrm{max}}$ 处，我们有：\n$$x_0 = \\frac{hc}{\\lambda_{\\mathrm{max}} k_B T}$$\n对乘积 $\\lambda_{\\mathrm{max}} T$ 进行整理：\n$$\\lambda_{\\mathrm{max}} T = \\frac{hc}{x_0 k_B}$$\n这就给出了位移常数 $b$ 的闭式表达式：\n$$b = \\frac{hc}{x_0 k_B}$$\n其中 $x_0$ 是 $(5-x)\\exp(x) = 5$ 的非零根。\n\n现在，我们对 $T=300\\ \\mathrm{K}$ 数值计算 $\\lambda_{\\mathrm{max}}$。首先，必须求解超越方程以得到 $x_0$。这需要使用数值方法（例如，牛顿-拉夫逊法或图形求解器）。其非零解被求得为：\n$$x_0 \\approx 4.96511423174$$\n使用给定的基本常数值：\n$h=6.62607015\\times 10^{-34}\\ \\mathrm{J\\,s}$\n$c=2.99792458\\times 10^{8}\\ \\mathrm{m\\,s^{-1}}$\n$k_{B}=1.380649\\times 10^{-23}\\ \\mathrm{J\\,K^{-1}}$\n我们首先计算常数 $b$：\n$$b = \\frac{(6.62607015\\times 10^{-34}\\ \\mathrm{J\\,s}) \\times (2.99792458\\times 10^{8}\\ \\mathrm{m\\,s^{-1}})}{4.96511423174 \\times (1.380649\\times 10^{-23}\\ \\mathrm{J\\,K^{-1}})}$$\n$$b \\approx \\frac{1.98644586 \\times 10^{-25}\\ \\mathrm{J\\,m}}{6.855309 \\times 10^{-23}\\ \\mathrm{J\\,K^{-1}}} \\approx 0.00289777\\ \\mathrm{m\\,K}$$\n现在，我们可以求出 $T=300\\ \\mathrm{K}$ 时的 $\\lambda_{\\mathrm{max}}$：\n$$\\lambda_{\\mathrm{max}} = \\frac{b}{T} = \\frac{0.00289777\\ \\mathrm{m\\,K}}{300\\ \\mathrm{K}} \\approx 9.65923 \\times 10^{-6}\\ \\mathrm{m}$$\n问题要求答案以微米（$\\mu\\mathrm{m}$）为单位。由于 $1\\ \\mathrm{\\mu m} = 10^{-6}\\ \\mathrm{m}$：\n$$\\lambda_{\\mathrm{max}} \\approx 9.65923\\ \\mathrm{\\mu m}$$\n四舍五入到四位有效数字，我们得到 $9.659\\ \\mathrm{\\mu m}$。\n\n最后，我们讨论发射峰与辐射度量之间的关系。对于一个处于热平衡状态的不透明表面，基尔霍夫热辐射定律指出，其光谱发射率 $\\varepsilon(\\lambda)$ 等于其光谱吸收率 $\\alpha(\\lambda)$。此外，由于入射到不透明表面上的辐射要么被吸收，要么被反射，因此吸收率和光谱反射率 $\\rho(\\lambda)$ 之和为1：$\\alpha(\\lambda) + \\rho(\\lambda) = 1$。结合这些可得基本关系式：\n$$\\varepsilon(\\lambda) + \\rho(\\lambda) = 1$$\n真实表面发射的光谱辐射率 $L_{\\lambda}$ 是其发射率与黑体光谱辐射率的乘积：$L_{\\lambda}(\\lambda, T) = \\varepsilon(\\lambda) B_{\\lambda}(T)$。$L_{\\lambda}$ 的峰值位置可以通过将其导数设为零来找到：\n$$\\frac{d L_{\\lambda}}{d \\lambda} = \\frac{d}{d\\lambda}[\\varepsilon(\\lambda) B_{\\lambda}(T)] = \\frac{d\\varepsilon}{d\\lambda} B_{\\lambda}(T) + \\varepsilon(\\lambda) \\frac{d B_{\\lambda}}{d \\lambda} = 0$$\n如果发射率在热窗口（$8\\ \\mathrm{\\mu m}$ 到 $12\\ \\mathrm{\\mu m}$）内是光谱均匀的（常数），即 $\\varepsilon(\\lambda) = \\varepsilon_0 = \\text{常数}$，那么其导数 $\\frac{d\\varepsilon}{d\\lambda}$ 为零。那么 $L_{\\lambda}$ 峰值的条件简化为：\n$$\\varepsilon_0 \\frac{d B_{\\lambda}}{d \\lambda} = 0$$\n由于 $\\varepsilon_0 > 0$，这等价于 $\\frac{d B_{\\lambda}}{d \\lambda} = 0$。这与用于寻找黑体函数 $B_{\\lambda}(T)$ 峰值的条件相同。因此，对于一个具有恒定发射率的表面（“灰体”），其发射的光谱辐射率峰值出现在与相同温度下完美黑体峰值完全相同的波长处。我们计算出的值 $\\lambda_{\\mathrm{max}} \\approx 9.659\\ \\mathrm{\\mu m}$ 落在 $8$–$12\\ \\mathrm{\\mu m}$ 窗口内，证实了此分析的相关性。光谱均匀的发射率不会移动峰值位置。然而，光谱变化的发射率会因为非零的 $\\frac{d\\varepsilon}{d\\lambda}$ 项而使峰值发生偏移。",
            "answer": "$$\\boxed{9.659}$$"
        },
        {
            "introduction": "在定量遥感中，我们常常简化复杂的地表特性以使反演算法易于处理。本实践探讨了一种常见简化的后果：将非朗伯体表面当作理想的各向同性表面处理。您将推导并实现一个模型，用以量化由此假设引入的反射率 ($\\rho$) 反演偏差，从而亲身体会模型误差如何传递到最终的数据产品中。",
            "id": "3839583",
            "problem": "一台遥感仪器在来自太阳的平行光照明下观测一个表面。向下辐照度为 $E_0$，单位是 $\\mathrm{W}\\,\\mathrm{m}^{-2}$，以太阳天顶角 $\\theta_i$ 和太阳方位角 $\\phi_i$ 入射。该仪器在观测天顶角 $\\theta_v$ 和观测方位角 $\\phi_v$ 处测量反射辐亮度 $L_r(\\theta_v,\\phi_v)$，单位是 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}$。双向反射分布函数 (BRDF) 的定义是，对于平行光照明，反射辐亮度满足 $L_r(\\theta_v,\\phi_v) = f_r(\\theta_i,\\phi_i;\\theta_v,\\phi_v)\\,E_0$，其中 $f_r$ 的单位是 $\\mathrm{sr}^{-1}$。\n\n基本上，一个朗伯体表面的 BRDF 是常数 $f_r = \\rho/\\pi$，其中 $\\rho$ 是无量纲的方向-半球反射率。对于一个弱各向异性的表面，考虑以下核驱动的 BRDF：\n$$\nf_r(\\theta_i,\\phi_i;\\theta_v,\\phi_v) = \\frac{\\rho}{\\pi}\\left[1 + \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi)\\right],\n$$\n其中 $\\Delta\\phi = \\phi_v - \\phi_i$，$\\alpha$ 和 $\\beta$ 是满足 $|\\alpha| \\leq 0.2$ 和 $|\\beta| \\leq 0.2$ 的无量纲各向异性系数，所有角度均以度为单位。假设在此弱各向异性范围内，互易性和能量守恒的考虑均得到满足。\n\n假设一个反演算法错误地假定表面为朗伯体，并使用 $f_r = \\rho/\\pi$ 从测量的辐亮度 $L_r$ 中反演估算 $\\rho$。仅从上述核心定义出发，推导由这一错误假设引起的 $\\rho$ 的反演偏差表达式，该表达式是 $\\theta_i$、$\\theta_v$、$\\Delta\\phi$、$\\alpha$ 和 $\\beta$ 的函数。将偏差表示为反演得到的 $\\rho$ 与真实的 $\\rho$ 之间的差值（无量纲，无单位），其符号表示高估（> 0）或低估（ 0）。\n\n然后，实现一个程序，为以下每个测试用例计算此偏差。所有角度均以度为单位提供，计算余弦和正弦时必须使用内部转换为弧度的角度。将每个偏差报告为四舍五入到六位小数的浮点数。程序必须产生单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,...]”）。\n\n测试套组（角度单位：度，辐照度单位：$\\mathrm{W}\\,\\mathrm{m}^{-2}$，反射率：无量纲）：\n- 案例 A（一般后向散射，弱各向异性）：$E_0 = 800$，$\\rho = 0.2$，$\\theta_i = 30$，$\\theta_v = 20$，$\\Delta\\phi = 0$，$\\alpha = 0.1$，$\\beta = 0.05$。\n- 案例 B（朗伯边界）：$E_0 = 800$，$\\rho = 0.2$，$\\theta_i = 30$，$\\theta_v = 20$，$\\Delta\\phi = 0$，$\\alpha = 0$，$\\beta = 0$。\n- 案例 C（前向散射，近掠射角观测）：$E_0 = 600$，$\\rho = 0.3$，$\\theta_i = 40$，$\\theta_v = 75$，$\\Delta\\phi = 180$，$\\alpha = 0.1$，$\\beta = 0.1$。\n- 案例 D（横截面，各向异性由 $\\alpha$ 主导）：$E_0 = 900$，$\\rho = 0.25$，$\\theta_i = 50$，$\\theta_v = 40$，$\\Delta\\phi = 90$，$\\alpha = 0.12$，$\\beta = 0.2$。\n- 案例 E（高太阳天顶角，天底观测）：$E_0 = 1000$，$\\rho = 0.1$，$\\theta_i = 80$，$\\theta_v = 0$，$\\Delta\\phi = 0$，$\\alpha = 0.05$，$\\beta = 0.05$。\n- 案例 F（混合各向异性符号）：$E_0 = 700$，$\\rho = 0.22$，$\\theta_i = 55$，$\\theta_v = 65$，$\\Delta\\phi = 45$，$\\alpha = -0.05$，$\\beta = 0.07$。\n\n您的程序应生成单行输出，其中包含按 A 到 F 顺序排列的六个偏差值，格式为用方括号括起来的逗号分隔列表，并四舍五入到六位小数。",
            "solution": "该问题要求推导当一个各向异性表面被错误地当作朗伯体处理时，表面反射率 $\\rho$ 的反演偏差。偏差定义为反演得到的反射率 $\\rho_{\\text{retrieved}}$ 与真实反射率 $\\rho_{\\text{true}}$ 之间的差值。\n\n令真实的表面反射率为 $\\rho_{\\text{true}}$。该表面由给定的核驱动双向反射分布函数 (BRDF) 来表征，我们将其记为 $f_{r, \\text{true}}$。此 BRDF 将向下的平行光辐照度 $E_0$ 与仪器测量的反射辐亮度 $L_r$ 联系起来。照明方向由太阳天顶角 $\\theta_i$ 和太阳方位角 $\\phi_i$ 给出，观测方向由观测天顶角 $\\theta_v$ 和观测方位角 $\\phi_v$ 给出。相对方位角为 $\\Delta\\phi = \\phi_v - \\phi_i$。\n\n首先，我们写出从表面反射的真实辐亮度的表达式，这是仪器所测量的量。根据问题描述，这表示为：\n$$\nL_r = f_{r, \\text{true}}(\\theta_i, \\phi_i; \\theta_v, \\phi_v) E_0\n$$\n给定的各向异性 BRDF 的具体模型是：\n$$\nf_{r, \\text{true}}(\\theta_i, \\phi_i; \\theta_v, \\phi_v) = \\frac{\\rho_{\\text{true}}}{\\pi}\\left[1 + \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi)\\right]\n$$\n此处，$\\alpha$ 和 $\\beta$ 是无量纲的各向异性系数。将此式代入辐亮度方程，得到测量的辐亮度：\n$$\nL_r = \\frac{\\rho_{\\text{true}}}{\\pi}\\left[1 + \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi)\\right] E_0\n$$\n\n接下来，我们考虑反演过程。该算法错误地假设表面是朗伯体。朗伯体表面具有恒定的 BRDF，$f_{r, \\text{Lambert}}$，由下式给出：\n$$\nf_{r, \\text{Lambert}} = \\frac{\\rho}{\\pi}\n$$\n反演算法使用此朗伯模型对测量的辐亮度 $L_r$ 进行反演，以找到反射率的估计值，我们称之为 $\\rho_{\\text{retrieved}}$。该算法的基本模型方程是：\n$$\nL_r = f_{r, \\text{Lambert}} E_0 = \\frac{\\rho_{\\text{retrieved}}}{\\pi} E_0\n$$\n为了求得 $\\rho_{\\text{retrieved}}$ 的值，算法对其求解：\n$$\n\\rho_{\\text{retrieved}} = \\frac{L_r \\pi}{E_0}\n$$\n\n现在，我们将实际测量的辐亮度 $L_r$（来自真实的各向异性表面）的表达式代入算法的反演方程中：\n$$\n\\rho_{\\text{retrieved}} = \\frac{\\pi}{E_0} \\left( \\frac{\\rho_{\\text{true}}}{\\pi}\\left[1 + \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi)\\right] E_0 \\right)\n$$\n分子和分母中的项 $\\pi$ 消掉了，向下的辐照度 $E_0$ 也同样消掉了。这表明，对于这个特定的问题表述，反演得到的反射率以及偏差与入射辐照度水平无关。反演反射率的简化表达式为：\n$$\n\\rho_{\\text{retrieved}} = \\rho_{\\text{true}}\\left[1 + \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi)\\right]\n$$\n\n最后，我们推导反演偏差，其定义为 $\\rho_{\\text{retrieved}} - \\rho_{\\text{true}}$。正偏差表示高估，负偏差表示低估。\n$$\n\\text{Bias} = \\rho_{\\text{retrieved}} - \\rho_{\\text{true}}\n$$\n代入 $\\rho_{\\text{retrieved}}$ 的表达式：\n$$\n\\text{Bias} = \\left( \\rho_{\\text{true}}\\left[1 + \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi)\\right] \\right) - \\rho_{\\text{true}}\n$$\n我们可以从两项中提出公因子 $\\rho_{\\text{true}}$：\n$$\n\\text{Bias} = \\rho_{\\text{true}} \\left( [1 + \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi)] - 1 \\right)\n$$\n项 $1$ 和 $-1$ 相消，得到反演偏差的最终表达式：\n$$\n\\text{Bias} = \\rho_{\\text{true}} \\left[ \\alpha \\cos\\theta_i \\cos\\theta_v + \\beta \\sin\\theta_i \\sin\\theta_v \\cos(\\Delta\\phi) \\right]\n$$\n将实施此表达式来计算每个测试用例的偏差。以度为单位给出的角度 $\\theta_i$、$\\theta_v$ 和 $\\Delta\\phi$ 必须转换为弧度，才能在三角函数 $\\cos$ 和 $\\sin$ 中使用。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the retrieval bias in surface reflectance for a series of test cases.\n    \n    The bias results from assuming a Lambertian surface model to invert radiance\n    measurements from a surface that is actually mildly anisotropic.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (E0, rho_true, theta_i, theta_v, delta_phi, alpha, beta)\n    # E0 is not needed for the bias calculation, but included for completeness.\n    test_cases = [\n        # Case A\n        (800, 0.2, 30, 20, 0, 0.1, 0.05),\n        # Case B\n        (800, 0.2, 30, 20, 0, 0, 0),\n        # Case C\n        (600, 0.3, 40, 75, 180, 0.1, 0.1),\n        # Case D\n        (900, 0.25, 50, 40, 90, 0.12, 0.2),\n        # Case E\n        (1000, 0.1, 80, 0, 0, 0.05, 0.05),\n        # Case F\n        (700, 0.22, 55, 65, 45, -0.05, 0.07),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current test case\n        # E0 is case[0], which we can ignore as it cancels out in the bias derivation.\n        rho_true = case[1]\n        theta_i_deg = case[2]\n        theta_v_deg = case[3]\n        delta_phi_deg = case[4]\n        alpha = case[5]\n        beta = case[6]\n\n        # Convert angles from degrees to radians for trigonometric functions\n        theta_i_rad = np.deg2rad(theta_i_deg)\n        theta_v_rad = np.deg2rad(theta_v_deg)\n        delta_phi_rad = np.deg2rad(delta_phi_deg)\n\n        # Calculate the bias using the derived formula:\n        # Bias = rho_true * [alpha * cos(theta_i) * cos(theta_v) + \n        #                   beta * sin(theta_i) * sin(theta_v) * cos(delta_phi)]\n        term1 = alpha * np.cos(theta_i_rad) * np.cos(theta_v_rad)\n        term2 = beta * np.sin(theta_i_rad) * np.sin(theta_v_rad) * np.cos(delta_phi_rad)\n        \n        bias = rho_true * (term1 + term2)\n\n        # Round the result to six decimal places as required\n        results.append(round(bias, 6))\n\n    # Format the final output as a comma-separated list in square brackets\n    # The map(str,...) ensures correct string conversion for all float values.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the main function\nsolve()\n```"
        },
        {
            "introduction": "我们使用的理论模型通常是单色的，而真实世界的传感器则在有限的光谱范围内测量辐射。本练习通过量化温度反演中的偏差，展示了这种差异的实际影响。通过比较波段平均辐射率测量与单色普朗克函数反演的结果，您将了解传感器特性如何引入系统误差 ($\\Delta T$)，并认识到考虑完整光谱响应函数的重要性。",
            "id": "3839559",
            "problem": "您需要实现一个程序，量化因对有限带宽传感器的光谱辐射率使用单色近似而引起的温度反演偏差。该场景属于热红外遥感，其中一个在中心波长附近具有有限光谱响应的辐射计测量一个在真实物理温度下发射表面的波段平均光谱辐射率。然后，反演算法错误地假设在中心波长处为单色普朗克光谱辐射率来推断温度。您的任务是针对指定的测试案例，计算由该近似引起的偏差。\n\n从以下与上下文相符的基本和核心定义开始：\n\n- 理想黑体单位波长的光谱辐射率由普朗克定律给出，\n$$\nB_{\\lambda}(T) = \\frac{2 h c^2}{\\lambda^5}\\,\\frac{1}{\\exp\\!\\left(\\frac{h c}{\\lambda k T}\\right)-1},\n$$\n其中 $h$ 是普朗克常数，$c$ 是真空中的光速，$k$ 是玻尔兹曼常数，$\\lambda$ 是波长，$T$ 是以开尔文为单位的绝对温度。\n\n- 真实表面的发射光谱辐射率为 $L_{\\lambda}(T) = \\varepsilon(\\lambda)\\,B_{\\lambda}(T)$，其中 $\\varepsilon(\\lambda)$ 是光谱发射率，假设为各向同性的朗伯发射，并且在热红外波段中忽略不计的反射贡献。\n\n- 辐射计在有限带宽上的波段平均光谱辐射率为\n$$\n\\overline{L}(T) = \\frac{\\int_{\\lambda_0 - \\Delta\\lambda/2}^{\\lambda_0 + \\Delta\\lambda/2} S(\\lambda)\\,\\varepsilon(\\lambda)\\,B_{\\lambda}(T)\\,\\mathrm{d}\\lambda}{\\int_{\\lambda_0 - \\Delta\\lambda/2}^{\\lambda_0 + \\Delta\\lambda/2} S(\\lambda)\\,\\mathrm{d}\\lambda},\n$$\n其中 $S(\\lambda)$ 是光谱响应函数。在此问题中，$S(\\lambda)$ 是一个以 $\\lambda_0$ 为中心、宽度为 $\\Delta\\lambda$ 的矩形“顶帽”响应，因此 $S(\\lambda)$ 是恒定的，归一化平均值简化为在该区间上的均值。\n\n- 单色反演算法假定\n$$\n\\overline{L}(T) \\approx \\varepsilon(\\lambda_0)\\,B_{\\lambda_0}(T_{\\mathrm{ret}}),\n$$\n并通过使用 $\\overline{L}(T)$ 除以 $\\varepsilon(\\lambda_0)$ 的值，在 $\\lambda_0$ 处反演普朗克函数来反演出 $T_{\\mathrm{ret}}$。偏差则为\n$$\n\\Delta T = T_{\\mathrm{ret}} - T_{\\mathrm{true}}.\n$$\n\n从第一性原理出发，实现以下步骤：\n\n1. 对每个测试案例，通过在区间 $[\\lambda_0 - \\Delta\\lambda/2,\\,\\lambda_0 + \\Delta\\lambda/2]$ 上对 $L_{\\lambda}(T_{\\mathrm{true}}) = \\varepsilon(\\lambda)\\,B_{\\lambda}(T_{\\mathrm{true}})$ 进行数值积分，并用带宽 $\\Delta\\lambda$ 进行归一化，来计算波段平均光谱辐射率 $\\overline{L}(T_{\\mathrm{true}})$。\n\n2. 通过使用普朗克定律的解析反演，求解 $B_{\\lambda_0}(T_{\\mathrm{ret}}) = \\overline{L}(T_{\\mathrm{true}})/\\varepsilon(\\lambda_0)$ 来推导 $T_{\\mathrm{ret}}$。\n\n3. 计算偏差 $\\Delta T = T_{\\mathrm{ret}} - T_{\\mathrm{true}}$。\n\n所有物理量必须使用国际单位制处理：波长单位为米，光谱辐射率单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mathrm{m}^{-1}$，温度单位为开尔文。您的程序必须为每个案例生成以开尔文为单位的偏差，并四舍五入到六位小数。\n\n使用以下测试套件，其设计旨在覆盖一般情况、近单色边界、宽带边缘情况、发射率变化以及高温维恩区情况。在所有案例中，均按规定使用矩形顶帽光谱响应。\n\n- 案例 $1$（通用热红外）：$T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 11\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 1\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 0.98$（常数）。\n\n- 案例 $2$（近单色边界）：$T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 11\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 0.01\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 0.98$（常数）。\n\n- 案例 $3$（宽带边缘）：$T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 11\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 3\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 1.0$（常数）。\n\n- 案例 $4$（波段内发射率斜坡）：$T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 8\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 2\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = \\varepsilon_0 + s \\, \\frac{\\lambda - \\lambda_0}{\\Delta\\lambda/2}$，其中 $\\varepsilon_0 = 0.96$，$s = 0.02$，值被裁剪到区间 $[0,1]$。\n\n- 案例 $5$（中波红外，高温）：$T_{\\mathrm{true}} = 1000\\,\\mathrm{K}$，$\\lambda_0 = 3.9\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 0.6\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 1.0$（常数）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按案例 $1$ 到 $5$ 的顺序排列结果，每个偏差都以浮点数形式四舍五入到六位小数。例如，输出格式必须类似于 $[\\Delta T_1,\\Delta T_2,\\Delta T_3,\\Delta T_4,\\Delta T_5]$，其中每个 $\\Delta T_i$ 的单位为开尔文。不应打印任何其他文本。",
            "solution": "在尝试任何解决方案之前，问题陈述都经过了严格的验证过程。\n\n### 步骤1：提取给定信息\n- **普朗克定律：** 理想黑体的光谱辐射率由 $B_{\\lambda}(T) = \\frac{2 h c^2}{\\lambda^5}\\,\\frac{1}{\\exp\\!\\left(\\frac{h c}{\\lambda k T}\\right)-1}$ 给出，其中 $h$ 是普朗克常数，$c$ 是光速，$k$ 是玻尔兹曼常数，$\\lambda$ 是波长，$T$ 是绝对温度。\n- **发射光谱辐射率：** $L_{\\lambda}(T) = \\varepsilon(\\lambda)\\,B_{\\lambda}(T)$，其中 $\\varepsilon(\\lambda)$ 是光谱发射率。\n- **波段平均光谱辐射率：** 对于一个以 $\\lambda_0$ 为中心、宽度为 $\\Delta\\lambda$ 的矩形“顶帽”光谱响应函数 $S(\\lambda)$，这简化为区间上的均值：$\\overline{L}(T) = \\frac{1}{\\Delta\\lambda} \\int_{\\lambda_0 - \\Delta\\lambda/2}^{\\lambda_0 + \\Delta\\lambda/2} \\varepsilon(\\lambda)\\,B_{\\lambda}(T)\\,\\mathrm{d}\\lambda$。\n- **单色反演假设：** $\\overline{L}(T) \\approx \\varepsilon(\\lambda_0)\\,B_{\\lambda_0}(T_{\\mathrm{ret}})$。反演温度 $T_{\\mathrm{ret}}$ 是通过反演此关系得到的。\n- **偏差定义：** $\\Delta T = T_{\\mathrm{ret}} - T_{\\mathrm{true}}$。\n- **单位：** 所有量都必须使用国际单位制。输出偏差 $\\Delta T$ 的单位是开尔文。\n- **测试案例：**\n    - **案例1：** $T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 11\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 1\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 0.98$（常数）。\n    - **案例2：** $T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 11\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 0.01\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 0.98$（常数）。\n    - **案例3：** $T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 11\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 3\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 1.0$（常数）。\n    - **案例4：** $T_{\\mathrm{true}} = 300\\,\\mathrm{K}$，$\\lambda_0 = 8\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 2\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = \\varepsilon_0 + s \\, \\frac{\\lambda - \\lambda_0}{\\Delta\\lambda/2}$，其中 $\\varepsilon_0 = 0.96$，$s = 0.02$，裁剪到 $[0,1]$。\n    - **案例5：** $T_{\\mathrm{true}} = 1000\\,\\mathrm{K}$，$\\lambda_0 = 3.9\\,\\mu\\mathrm{m}$，$\\Delta\\lambda = 0.6\\,\\mu\\mathrm{m}$，$\\varepsilon(\\lambda) = 1.0$（常数）。\n\n### 步骤2：使用提取的给定信息进行验证\n- **科学基础：** 该问题牢固地建立在黑体辐射（普朗克定律）和辐射测量的基本原理之上。所描述的场景——由于传感器带宽有限而导致的温度反演偏差——是热红外遥感中一个公认且具有实际意义的问题。其物理学原理是可靠的。\n- **适定性：** 提供了所有必需的方程、参数和条件。程序被明确定义：通过数值积分求得真实的波段平均辐射率，然后通过近似模型的解析反演求得反演温度。对于每个测试案例，该问题都有一个唯一且稳定的解。\n- **客观性：** 问题陈述使用了精确、正式的语言和量化定义。没有主观或模糊的术语。\n- **其他缺陷：**\n    - 该问题是可形式化的，并且与指定主题直接相关。\n    - 设置是完整且一致的。\n    - 参数（$T$, $\\lambda_0$, $\\Delta\\lambda$）对于环境和工业遥感应用是物理上现实的。\n    - 问题结构逻辑清晰，能够得出有意义的结果。\n    - 该问题是物理原理的一个非平凡应用，需要数值和解析两方面的步骤。\n    - 结果可以通过独立计算进行科学验证。\n\n### 步骤3：结论与行动\n该问题是**有效的**。它科学上可靠、适定、无歧义且计算上是可行的。将提供一个解决方案。\n\n### 解决方案\n该问题要求计算由于使用单色模型近似波段平均辐射率测量而产生的温度偏差 $\\Delta T = T_{\\mathrm{ret}} - T_{\\mathrm{true}}$。解决方案按规定从第一性原理推导。\n\n**理论公式**\n\n问题的核心在于真实波段平均辐射率与用于温度反演的简化单色模型之间的相互作用。\n\n首先，我们用国际单位制定义物理常数：\n- 普朗克常数：$h \\approx 6.62607015 \\times 10^{-34}\\,\\mathrm{J} \\cdot \\mathrm{s}$\n- 真空中光速：$c \\approx 2.99792458 \\times 10^{8}\\,\\mathrm{m} \\cdot \\mathrm{s}^{-1}$\n- 玻尔兹曼常数：$k \\approx 1.380649 \\times 10^{-23}\\,\\mathrm{J} \\cdot \\mathrm{K}^{-1}$\n\n为方便计算，我们定义两个复合常数，即第一和第二辐射常数，$C_1$ 和 $C_2$：\n- $C_1 = 2 h c^2$\n- $C_2 = h c / k$\n\n于是，光谱辐射率 $B_{\\lambda}(T)$（单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mathrm{m}^{-1}$）的普朗克定律可以写成：\n$$\nB_{\\lambda}(\\lambda, T) = \\frac{C_1}{\\lambda^5} \\frac{1}{\\exp\\left(\\frac{C_2}{\\lambda T}\\right) - 1}\n$$\n\n对每个测试案例，该过程包括三个主要步骤。\n\n**步骤1：计算真实的波段平均光谱辐射率 $\\overline{L}(T_{\\mathrm{true}})**$\n\n传感器测量由一个处于真实温度 $T_{\\mathrm{true}}$ 的表面发射的辐射。此辐射率 $L_{\\lambda}(T) = \\varepsilon(\\lambda) B_{\\lambda}(T)$ 在传感器的光谱带上进行平均。对于指定的顶帽光谱响应，波段平均辐射率是 $L_{\\lambda}(T_{\\mathrm{true}})$ 在区间 $[\\lambda_1, \\lambda_2]$ 上的平均值，其中 $\\lambda_1 = \\lambda_0 - \\Delta\\lambda/2$ 且 $\\lambda_2 = \\lambda_0 + \\Delta\\lambda/2$：\n$$\n\\overline{L}(T_{\\mathrm{true}}) = \\frac{1}{\\Delta\\lambda} \\int_{\\lambda_1}^{\\lambda_2} \\varepsilon(\\lambda) B_{\\lambda}(\\lambda, T_{\\mathrm{true}}) \\, \\mathrm{d}\\lambda\n$$\n该积分没有通用的解析解，必须进行数值计算。\n\n**步骤2：计算反演温度 $T_{\\mathrm{ret}}$**\n\n反演算法错误地假设测量的波段平均辐射率 $\\overline{L}(T_{\\mathrm{true}})$ 等于在中心波长 $\\lambda_0$ 处，由一个处于反演温度 $T_{\\mathrm{ret}}$、发射率为 $\\varepsilon(\\lambda_0)$ 的物体发射的单色辐射率：\n$$\n\\overline{L}(T_{\\mathrm{true}}) \\approx \\varepsilon(\\lambda_0) B_{\\lambda_0}(\\lambda_0, T_{\\mathrm{ret}})\n$$\n为了求得 $T_{\\mathrm{ret}}$，我们首先计算算法假定其已测得的黑体的等效单色辐射率：\n$$\nL_{\\mathrm{mono}} = \\frac{\\overline{L}(T_{\\mathrm{true}})}{\\varepsilon(\\lambda_0)}\n$$\n然后我们求解方程 $L_{\\mathrm{mono}} = B_{\\lambda_0}(\\lambda_0, T_{\\mathrm{ret}})$ 以得到 $T_{\\mathrm{ret}}$。这涉及到反演普朗克定律：\n$$\nL_{\\mathrm{mono}} = \\frac{C_1}{\\lambda_0^5} \\frac{1}{\\exp\\left(\\frac{C_2}{\\lambda_0 T_{\\mathrm{ret}}}\\right) - 1}\n$$\n整理以求解 $T_{\\mathrm{ret}}$，得到解析解：\n$$\n\\exp\\left(\\frac{C_2}{\\lambda_0 T_{\\mathrm{ret}}}\\right) = \\frac{C_1}{\\lambda_0^5 L_{\\mathrm{mono}}} + 1\n$$\n$$\n\\frac{C_2}{\\lambda_0 T_{\\mathrm{ret}}} = \\ln\\left(\\frac{C_1}{\\lambda_0^5 L_{\\mathrm{mono}}} + 1\\right)\n$$\n$$\nT_{\\mathrm{ret}} = \\frac{C_2}{\\lambda_0} \\left[ \\ln\\left(\\frac{C_1}{\\lambda_0^5 L_{\\mathrm{mono}}} + 1\\right) \\right]^{-1}\n$$\n\n**步骤3：计算偏差 $\\Delta T$**\n\n最后一步是计算反演温度与真实温度之间的偏差：\n$$\n\\Delta T = T_{\\mathrm{ret}} - T_{\\mathrm{true}}\n$$\n\n这个三步程序将对五个测试案例中的每一个实施。发射率函数 $\\varepsilon(\\lambda)$ 将根据每个案例的规范定义，需要注意的是，对于案例4，$\\varepsilon(\\lambda)$ 是 $\\lambda$ 的线性函数，其在中心波长 $\\lambda_0$ 处的值就是 $\\varepsilon(\\lambda_0) = \\varepsilon_0 = 0.96$。所有计算都将以国际单位制进行，波长从微米转换为米。每个案例的最终结果将是以开尔文为单位的偏差 $\\Delta T$，四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Computes the temperature retrieval bias caused by using a monochromatic\n    approximation for a sensor with a finite bandwidth.\n    \"\"\"\n\n    # Physical constants from scipy.constants in SI units\n    h = constants.h  # Planck constant (J.s)\n    c = constants.c  # Speed of light (m/s)\n    k = constants.k  # Boltzmann constant (J/K)\n\n    # Derived radiation constants\n    C1 = 2 * h * c**2  # First radiation constant (W.m^2)\n    C2 = h * c / k     # Second radiation constant (m.K)\n\n    def planck_radiance(wavelength, temp):\n        \"\"\"\n        Calculates spectral radiance using Planck's law.\n        :param wavelength: Wavelength in meters.\n        :param temp: Temperature in Kelvin.\n        :return: Spectral radiance in W.m^-2.sr^-1.m^-1.\n        \"\"\"\n        # Ensure inputs are numpy arrays for vectorization\n        wavelength = np.asarray(wavelength)\n        temp = np.asarray(temp)\n        \n        # Avoid division by zero or overflow\n        # The exponential term is large, so exp(...) - 1 is approx exp(...)\n        # We handle this by checking if the argument is large.\n        arg = C2 / (wavelength * temp)\n        # For large arguments, exp(arg) is very large, so 1/exp(arg) is near zero.\n        # np.exp handles large arguments by returning inf, so we don't need special handling here.\n        radiance = (C1 / wavelength**5) / (np.exp(arg) - 1.0)\n        return radiance\n\n    def invert_planck(radiance, wavelength):\n        \"\"\"\n        Inverts Planck's law to find temperature.\n        :param radiance: Spectral radiance in W.m^-2.sr^-1.m^-1.\n        :param wavelength: Wavelength in meters.\n        :return: Temperature in Kelvin.\n        \"\"\"\n        # T_ret = (C2 / lambda_0) / ln( (C1 / (lambda_0^5 * L_mono)) + 1 )\n        temp = C2 / (wavelength * np.log(C1 / (wavelength**5 * radiance) + 1.0))\n        return temp\n\n    # Define test cases as a list of dictionaries for clarity\n    test_cases = [\n        {\n            \"name\": \"Case 1\",\n            \"T_true\": 300.0,\n            \"lambda_0_um\": 11.0,\n            \"delta_lambda_um\": 1.0,\n            \"emissivity_func\": lambda l, l0, dl: 0.98,\n            \"emissivity_at_lambda0\": 0.98,\n        },\n        {\n            \"name\": \"Case 2\",\n            \"T_true\": 300.0,\n            \"lambda_0_um\": 11.0,\n            \"delta_lambda_um\": 0.01,\n            \"emissivity_func\": lambda l, l0, dl: 0.98,\n            \"emissivity_at_lambda0\": 0.98,\n        },\n        {\n            \"name\": \"Case 3\",\n            \"T_true\": 300.0,\n            \"lambda_0_um\": 11.0,\n            \"delta_lambda_um\": 3.0,\n            \"emissivity_func\": lambda l, l0, dl: 1.0,\n            \"emissivity_at_lambda0\": 1.0,\n        },\n        {\n            \"name\": \"Case 4\",\n            \"T_true\": 300.0,\n            \"lambda_0_um\": 8.0,\n            \"delta_lambda_um\": 2.0,\n            \"emissivity_func\": lambda l, l0, dl: np.clip(0.96 + 0.02 * (l - l0) / (dl / 2), 0, 1),\n            \"emissivity_at_lambda0\": 0.96, # At l = l0, the second term is 0\n        },\n        {\n            \"name\": \"Case 5\",\n            \"T_true\": 1000.0,\n            \"lambda_0_um\": 3.9,\n            \"delta_lambda_um\": 0.6,\n            \"emissivity_func\": lambda l, l0, dl: 1.0,\n            \"emissivity_at_lambda0\": 1.0,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters and convert to SI units\n        T_true = case[\"T_true\"]\n        lambda_0 = case[\"lambda_0_um\"] * 1e-6\n        delta_lambda = case[\"delta_lambda_um\"] * 1e-6\n\n        # Define integration limits\n        lambda_1 = lambda_0 - delta_lambda / 2.0\n        lambda_2 = lambda_0 + delta_lambda / 2.0\n\n        # Define the integrand: L_lambda(T_true) = eps(lambda) * B_lambda(T_true)\n        def integrand(wavelength):\n            eps = case[\"emissivity_func\"](wavelength, lambda_0, delta_lambda)\n            B = planck_radiance(wavelength, T_true)\n            return eps * B\n\n        # Step 1: Numerically integrate to find band-integrated radiance\n        # quad returns a tuple (result, error_estimate)\n        integrated_radiance, _ = integrate.quad(integrand, lambda_1, lambda_2)\n        \n        # Calculate band-averaged radiance\n        L_bar = integrated_radiance / delta_lambda\n\n        # Step 2: Compute retrieved temperature\n        # First, find the monochromatic-equivalent blackbody radiance\n        eps_lambda0 = case[\"emissivity_at_lambda0\"]\n        L_mono = L_bar / eps_lambda0\n        \n        # Invert Planck's law to get the retrieved temperature\n        T_ret = invert_planck(L_mono, lambda_0)\n\n        # Step 3: Compute the bias\n        delta_T = T_ret - T_true\n        \n        # Round to 6 decimal places and store\n        results.append(round(delta_T, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}