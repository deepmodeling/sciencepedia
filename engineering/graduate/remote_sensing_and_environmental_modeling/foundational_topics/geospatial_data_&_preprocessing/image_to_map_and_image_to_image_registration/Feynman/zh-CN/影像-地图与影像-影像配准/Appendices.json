{
    "hands_on_practices": [
        {
            "introduction": "仿射变换是校正遥感影像中常见的几何畸变（如缩放、旋转和切变）的基本工具。本练习将通过一个具体案例，演示如何利用最少数量的地面控制点（GCPs）来唯一确定一个二维仿射变换矩阵。掌握这一方法是理解图像到地图配准几何基础的关键一步。",
            "id": "3821081",
            "problem": "为了进行洪泛区生境建模，一幅小型无人机（UAV）图像必须与局部地图进行配准。有三个非共线的地面控制点（GCPs）可用，它们在图像中的像素坐标以及在局部地图参考框架中的相应坐标是已知的。图像坐标（单位：像素）为：$\\mathbf{p}_{I,1} = \\begin{pmatrix}120 \\\\ 80\\end{pmatrix}$，$\\mathbf{p}_{I,2} = \\begin{pmatrix}420 \\\\ 80\\end{pmatrix}$，以及 $\\mathbf{p}_{I,3} = \\begin{pmatrix}120 \\\\ 380\\end{pmatrix}$。相应的地图坐标（单位：米）为：$\\mathbf{p}_{M,1} = \\begin{pmatrix}325 \\\\ -44\\end{pmatrix}$，$\\mathbf{p}_{M,2} = \\begin{pmatrix}925 \\\\ -344\\end{pmatrix}$，以及 $\\mathbf{p}_{M,3} = \\begin{pmatrix}625 \\\\ 256\\end{pmatrix}$。\n\n假设一个平面仿射图像到地图模型为 $\\mathbf{p}_{M} = A\\,\\mathbf{p}_{I} + \\mathbf{t}$，其中 $A \\in \\mathbb{R}^{2 \\times 2}$ 且 $\\mathbf{t} \\in \\mathbb{R}^{2}$。仅使用仿射图的核心定义以及由非共线性所蕴含的点差的线性无关性，推导出将这三个图像点映射到其相应地图点的唯一仿射变换 $(A,\\mathbf{t})$。然后，通过计算 $\\det(A)$ 来正式验证其可逆性，并将其解释为配准下的局部面积缩放因子。\n\n请提供 $\\det(A)$ 的精确数值作为您的最终答案。将行列式表示为一个对应于平方米每平方像素的纯数，答案中不要包含任何单位符号。无需四舍五入；请报告精确值。",
            "solution": "问题要求确定一个唯一的仿射变换 $(A, \\mathbf{t})$，该变换将一组三个非共线的图像点映射到一组相应的地图点。该变换由方程 $\\mathbf{p}_{M} = A\\,\\mathbf{p}_{I} + \\mathbf{t}$ 定义，其中 $\\mathbf{p}_{I}$ 是图像坐标，$\\mathbf{p}_{M}$ 是地图坐标，$A \\in \\mathbb{R}^{2 \\times 2}$ 是线性变换矩阵，$\\mathbf{t} \\in \\mathbb{R}^{2}$ 是平移向量。\n\n给定的对应点如下：\n图像坐标（单位：像素）：\n$$ \\mathbf{p}_{I,1} = \\begin{pmatrix}120 \\\\ 80\\end{pmatrix}, \\quad \\mathbf{p}_{I,2} = \\begin{pmatrix}420 \\\\ 80\\end{pmatrix}, \\quad \\mathbf{p}_{I,3} = \\begin{pmatrix}120 \\\\ 380\\end{pmatrix} $$\n地图坐标（单位：米）：\n$$ \\mathbf{p}_{M,1} = \\begin{pmatrix}325 \\\\ -44\\end{pmatrix}, \\quad \\mathbf{p}_{M,2} = \\begin{pmatrix}925 \\\\ -344\\end{pmatrix}, \\quad \\mathbf{p}_{M,3} = \\begin{pmatrix}625 \\\\ 256\\end{pmatrix} $$\n\n仿射关系对每一对对应点都成立：\n$1.$ $\\mathbf{p}_{M,1} = A\\mathbf{p}_{I,1} + \\mathbf{t}$\n$2.$ $\\mathbf{p}_{M,2} = A\\mathbf{p}_{I,2} + \\mathbf{t}$\n$3.$ $\\mathbf{p}_{M,3} = A\\mathbf{p}_{I,3} + \\mathbf{t}$\n\n为了分离出矩阵 $A$，我们可以通过考虑点之间的差来消除平移向量 $\\mathbf{t}$。从方程（2）和（3）中减去方程（1）得到：\n$$ \\mathbf{p}_{M,2} - \\mathbf{p}_{M,1} = (A\\mathbf{p}_{I,2} + \\mathbf{t}) - (A\\mathbf{p}_{I,1} + \\mathbf{t}) = A(\\mathbf{p}_{I,2} - \\mathbf{p}_{I,1}) $$\n$$ \\mathbf{p}_{M,3} - \\mathbf{p}_{M,1} = (A\\mathbf{p}_{I,3} + \\mathbf{t}) - (A\\mathbf{p}_{I,1} + \\mathbf{t}) = A(\\mathbf{p}_{I,3} - \\mathbf{p}_{I,1}) $$\n\n让我们定义差分向量：\n在图像空间中：\n$$ \\Delta\\mathbf{p}_{I,21} = \\mathbf{p}_{I,2} - \\mathbf{p}_{I,1} = \\begin{pmatrix}420 - 120 \\\\ 80 - 80\\end{pmatrix} = \\begin{pmatrix}300 \\\\ 0\\end{pmatrix} $$\n$$ \\Delta\\mathbf{p}_{I,31} = \\mathbf{p}_{I,3} - \\mathbf{p}_{I,1} = \\begin{pmatrix}120 - 120 \\\\ 380 - 80\\end{pmatrix} = \\begin{pmatrix}0 \\\\ 300\\end{pmatrix} $$\n在地图空间中：\n$$ \\Delta\\mathbf{p}_{M,21} = \\mathbf{p}_{M,2} - \\mathbf{p}_{M,1} = \\begin{pmatrix}925 - 325 \\\\ -344 - (-44)\\end{pmatrix} = \\begin{pmatrix}600 \\\\ -300\\end{pmatrix} $$\n$$ \\Delta\\mathbf{p}_{M,31} = \\mathbf{p}_{M,3} - \\mathbf{p}_{M,1} = \\begin{pmatrix}625 - 325 \\\\ 256 - (-44)\\end{pmatrix} = \\begin{pmatrix}300 \\\\ 300\\end{pmatrix} $$\n\n这两个向量方程 $\\Delta\\mathbf{p}_{M,21} = A \\Delta\\mathbf{p}_{I,21}$ 和 $\\Delta\\mathbf{p}_{M,31} = A \\Delta\\mathbf{p}_{I,31}$，可以通过将这些差分向量作为列来构成矩阵，从而合并成一个单一的矩阵方程：\n$$ \\begin{pmatrix} \\Delta\\mathbf{p}_{M,21}  \\Delta\\mathbf{p}_{M,31} \\end{pmatrix} = A \\begin{pmatrix} \\Delta\\mathbf{p}_{I,21}  \\Delta\\mathbf{p}_{I,31} \\end{pmatrix} $$\n令 $P_M = \\begin{pmatrix} \\Delta\\mathbf{p}_{M,21}  \\Delta\\mathbf{p}_{M,31} \\end{pmatrix}$ 且 $P_I = \\begin{pmatrix} \\Delta\\mathbf{p}_{I,21}  \\Delta\\mathbf{p}_{I,31} \\end{pmatrix}$。方程为 $P_M = A P_I$。\n代入计算出的值：\n$$ \\begin{pmatrix} 600  300 \\\\ -300  300 \\end{pmatrix} = A \\begin{pmatrix} 300  0 \\\\ 0  300 \\end{pmatrix} $$\n问题说明了这些点是非共线的，这意味着在每个空间中的差分向量都是线性无关的。这保证了矩阵 $P_I$ 是可逆的。我们可以通过右乘 $P_I$ 的逆矩阵来求解 $A$：\n$$ A = P_M P_I^{-1} $$\n首先，我们求 $P_I^{-1}$：\n$$ P_I = \\begin{pmatrix} 300  0 \\\\ 0  300 \\end{pmatrix} = 300 \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = 300 I $$\n其逆矩阵为：\n$$ P_I^{-1} = \\frac{1}{300} I^{-1} = \\frac{1}{300} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{300}  0 \\\\ 0  \\frac{1}{300} \\end{pmatrix} $$\n现在，我们计算 $A$：\n$$ A = \\begin{pmatrix} 600  300 \\\\ -300  300 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{300}  0 \\\\ 0  \\frac{1}{300} \\end{pmatrix} = \\begin{pmatrix} 600 \\cdot \\frac{1}{300}  300 \\cdot \\frac{1}{300} \\\\ -300 \\cdot \\frac{1}{300}  300 \\cdot \\frac{1}{300} \\end{pmatrix} = \\begin{pmatrix} 2  1 \\\\ -1  1 \\end{pmatrix} $$\n求出 $A$ 后，我们可以使用第一对对应点来求出 $\\mathbf{t}$：$\\mathbf{t} = \\mathbf{p}_{M,1} - A\\mathbf{p}_{I,1}$。\n$$ \\mathbf{t} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 2  1 \\\\ -1  1 \\end{pmatrix} \\begin{pmatrix} 120 \\\\ 80 \\end{pmatrix} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 2(120) + 1(80) \\\\ -1(120) + 1(80) \\end{pmatrix} $$\n$$ \\mathbf{t} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 240 + 80 \\\\ -120 + 80 \\end{pmatrix} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 320 \\\\ -40 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ -4 \\end{pmatrix} $$\n因此，唯一的仿射变换由 $A = \\begin{pmatrix} 2  1 \\\\ -1  1 \\end{pmatrix}$ 和 $\\mathbf{t} = \\begin{pmatrix} 5 \\\\ -4 \\end{pmatrix}$ 指定。\n\n最后一步是验证变换的可逆性并解释 $A$ 的行列式。一个变换是可逆的，当且仅当其线性部分（由矩阵 $A$ 表示）是可逆的。这成立的条件是当且仅当 $\\det(A) \\ne 0$。\n我们来计算 $A$ 的行列式：\n$$ \\det(A) = \\det\\begin{pmatrix} 2  1 \\\\ -1  1 \\end{pmatrix} = (2)(1) - (1)(-1) = 2 + 1 = 3 $$\n由于 $\\det(A) = 3 \\ne 0$，矩阵 $A$ 是可逆的，因此仿射变换也是可逆的。存在一个唯一的逆变换，可以将点从地图映射回图像。\n\n变换矩阵 $A$ 的行列式表示输出空间（地图）和输入空间（图像）之间面积元素的比率。在此背景下，图像空间的单位是像素（px），地图空间的单位是米（m）。行列式 $\\det(A)$ 的单位是平方米每平方像素，即 $\\text{m}^2/\\text{px}^2$。\n值 $\\det(A) = 3$ 表示图像中 $1$ 平方像素的单位面积对应于地图上 $3$ 平方米的面积。行列式的正号表示该变换是保向的，意味着它不包含反射。\n所要求的最终答案是 $\\det(A)$ 的数值。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "在从简单的全局模型过渡到现代卫星影像所采用的复杂传感器模型时，有理函数模型（RPC）是核心。本练习提供了一个使用RPC正向模型（从地面到图像）进行地理参照的实践机会，并引入了敏感性分析。通过计算图像坐标对高程误差的敏感度，我们可以量化数字高程模型（DEM）中的不确定性如何影响最终产品的配准精度。",
            "id": "3821027",
            "problem": "一幅卫星图像使用有理多项式相机 (RPC) 模型进行地理配准。数字高程模型 (DEM) 提供地面高程。给定以下行坐标映射的设置。归一化地面坐标定义为 $$L=\\frac{\\phi-\\phi_{0}}{\\phi_{\\mathrm{scale}}},\\quad S=\\frac{\\lambda-\\lambda_{0}}{\\lambda_{\\mathrm{scale}}},\\quad H=\\frac{Z-Z_{0}}{Z_{\\mathrm{scale}}},$$ 其中 $\\phi$ 是纬度（单位：度），$\\lambda$ 是经度（单位：度），$Z$ 是高程（单位：米）。归一化行坐标由两个多项式的比值给出 $$l_{n}(L,S,H)=\\frac{P(L,S,H)}{Q(L,S,H)},$$ 其中 $$P(L,S,H)=a_{0}+a_{1}L+a_{2}S+a_{3}H+a_{4}LS+a_{5}LH+a_{6}SH+a_{7}L^{2}+a_{8}S^{2}+a_{9}H^{2},$$ $$Q(L,S,H)=1+b_{1}L+b_{2}S+b_{3}H+b_{4}L^{2}+b_{5}S^{2}。$$ 以像素为单位的实际行坐标为 $$\\text{line}=\\text{line}_{\\mathrm{offset}}+\\text{line}_{\\mathrm{scale}}\\;l_{n}(L,S,H)。$$ 用于行坐标映射的有理多项式相机 (RPC) 系数和归一化参数如下：\n$$a_{0}=0.001,\\;a_{1}=0.020,\\;a_{2}=-0.015,\\;a_{3}=0.010,\\;a_{4}=0.005,\\;a_{5}=-0.004,\\;a_{6}=0.003,\\;a_{7}=0.010,\\;a_{8}=-0.008,\\;a_{9}=0.002,$$\n$$b_{1}=0.010,\\;b_{2}=-0.020,\\;b_{3}=0.005,\\;b_{4}=0.003,\\;b_{5}=0.002,$$\n$$\\phi_{0}=37.5,\\;\\phi_{\\mathrm{scale}}=0.05,\\;\\lambda_{0}=-122.2,\\;\\lambda_{\\mathrm{scale}}=0.05,\\;Z_{0}=100,\\;Z_{\\mathrm{scale}}=100,$$\n$$\\text{line}_{\\mathrm{offset}}=5000,\\;\\text{line}_{\\mathrm{scale}}=5000。$$\n考虑一个地面点，其纬度和经度为 $$\\phi=37.52,\\quad \\lambda=-122.18,$$ 高程为 $$Z=150。$$ 从上述归一化坐标和有理多项式相机 (RPC) 映射的标准定义出发，计算：\n- 以像素为单位的行图像坐标，以及\n- 在给定地面点处评估的行坐标对 DEM 高程误差的局部灵敏度，即偏导数 $$\\frac{\\partial\\,\\text{line}}{\\partial Z}$$。\n\n将最终的行坐标以像素表示，导数以像素/米表示。将您的数值结果四舍五入至四位有效数字。将包含这两个量的最终答案以单行矩阵的形式提供，顺序为：行坐标，然后是 $\\frac{\\partial\\,\\text{line}}{\\partial Z}$。",
            "solution": "有理多项式相机 (RPC) 模型通过一个有理函数将归一化地面坐标映射到归一化图像坐标，而图像行坐标是通过应用所提供的偏移量和比例因子得到的。根据定义 $$L=\\frac{\\phi-\\phi_{0}}{\\phi_{\\mathrm{scale}}},\\quad S=\\frac{\\lambda-\\lambda_{0}}{\\lambda_{\\mathrm{scale}}},\\quad H=\\frac{Z-Z_{0}}{Z_{\\mathrm{scale}}},$$ 我们首先计算指定地面点的归一化坐标。使用给定的值 $$\\phi=37.52,\\;\\phi_{0}=37.5,\\;\\phi_{\\mathrm{scale}}=0.05,$$ $$\\lambda=-122.18,\\;\\lambda_{0}=-122.2,\\;\\lambda_{\\mathrm{scale}}=0.05,$$ $$Z=150,\\;Z_{0}=100,\\;Z_{\\mathrm{scale}}=100,$$ 我们得到\n$$L=\\frac{37.52-37.5}{0.05}=\\frac{0.02}{0.05}=0.4,$$\n$$S=\\frac{-122.18-(-122.2)}{0.05}=\\frac{0.02}{0.05}=0.4,$$\n$$H=\\frac{150-100}{100}=\\frac{50}{100}=0.5。$$\n接下来，使用以下公式计算分子多项式 $P(L,S,H)$\n$$P(L,S,H)=a_{0}+a_{1}L+a_{2}S+a_{3}H+a_{4}LS+a_{5}LH+a_{6}SH+a_{7}L^{2}+a_{8}S^{2}+a_{9}H^{2}。$$\n计算所需的单项式：\n$$LS=0.4\\times 0.4=0.16,\\quad LH=0.4\\times 0.5=0.2,\\quad SH=0.4\\times 0.5=0.2,$$\n$$L^{2}=0.4^{2}=0.16,\\quad S^{2}=0.4^{2}=0.16,\\quad H^{2}=0.5^{2}=0.25。$$\n使用给定的系数，\n\n$$\n\\begin{aligned}\nP=0.001+0.020(0.4)+(-0.015)(0.4)+0.010(0.5)+0.005(0.16)+(-0.004)(0.2)+0.003(0.2)\\\\\n\\quad+0.010(0.16)+(-0.008)(0.16)+0.002(0.25)\\\\\n=0.001+0.008-0.006+0.005+0.0008-0.0008+0.0006+0.0016-0.00128+0.0005\\\\\n=0.00942.\n\\end{aligned}\n$$\n\n现在使用以下公式计算分母多项式 $Q(L,S,H)$\n$$Q(L,S,H)=1+b_{1}L+b_{2}S+b_{3}H+b_{4}L^{2}+b_{5}S^{2}。$$\n代入可得\n\n$$\n\\begin{aligned}\nQ=1+0.010(0.4)+(-0.020)(0.4)+0.005(0.5)+0.003(0.16)+0.002(0.16)\\\\\n=1+0.004-0.008+0.0025+0.00048+0.00032\\\\\n=0.9993.\n\\end{aligned}\n$$\n\n那么归一化行坐标为\n$$l_{n}=\\frac{P}{Q}=\\frac{0.00942}{0.9993}。$$\n为了计算以像素为单位的图像行坐标，\n$$\\text{line}=\\text{line}_{\\mathrm{offset}}+\\text{line}_{\\mathrm{scale}}\\,l_{n}=5000+5000\\left(\\frac{0.00942}{0.9993}\\right)。$$\n对于 DEM 高程误差的灵敏度，我们计算在给定点处的偏导数 $\\frac{\\partial\\,\\text{line}}{\\partial Z}$。使用链式法则和定义 $H=(Z-Z_{0})/Z_{\\mathrm{scale}}$，我们有\n$$\\frac{\\partial\\,\\text{line}}{\\partial Z}=\\text{line}_{\\mathrm{scale}}\\;\\frac{\\partial l_{n}}{\\partial Z}=\\text{line}_{\\mathrm{scale}}\\;\\frac{\\partial l_{n}}{\\partial H}\\;\\frac{\\partial H}{\\partial Z}=\\text{line}_{\\mathrm{scale}}\\;\\frac{\\partial l_{n}}{\\partial H}\\;\\frac{1}{Z_{\\mathrm{scale}}}。$$\n剩下的任务是从商 $l_{n}=P/Q$ 计算 $\\frac{\\partial l_{n}}{\\partial H}$。求导，\n$$\\frac{\\partial l_{n}}{\\partial H}=\\frac{Q\\,\\frac{\\partial P}{\\partial H}-P\\,\\frac{\\partial Q}{\\partial H}}{Q^{2}}。$$\n从 $P$ 中，关于 $H$ 的导数是\n$$\\frac{\\partial P}{\\partial H}=a_{3}+a_{5}L+a_{6}S+2a_{9}H。$$\n代入数值：\n\n$$\n\\begin{aligned}\n\\frac{\\partial P}{\\partial H}=0.010+(-0.004)(0.4)+0.003(0.4)+2(0.002)(0.5)\\\\\n=0.010-0.0016+0.0012+0.002\\\\\n=0.0116.\n\\end{aligned}\n$$\n\n从 $Q$ 中，关于 $H$ 的导数是\n$$\\frac{\\partial Q}{\\partial H}=b_{3}=0.005。$$\n现在数值计算 $\\frac{\\partial l_{n}}{\\partial H}$：\n\n$$\n\\begin{aligned}\nQ\\,\\frac{\\partial P}{\\partial H}=0.9993\\times 0.0116=0.01159188,\\\\\nP\\,\\frac{\\partial Q}{\\partial H}=0.00942\\times 0.005=0.0000471,\\\\\n\\text{numerator}=0.01159188-0.0000471=0.01154478,\\\\\nQ^{2}=(0.9993)^{2}=0.99860049,\\\\\n\\frac{\\partial l_{n}}{\\partial H}=\\frac{0.01154478}{0.99860049}\\approx 0.011562.\n\\end{aligned}\n$$\n\n因此，\n\n$$\n\\begin{aligned}\n\\frac{\\partial\\,\\text{line}}{\\partial Z}=\\text{line}_{\\mathrm{scale}}\\;\\frac{1}{Z_{\\mathrm{scale}}}\\;\\frac{\\partial l_{n}}{\\partial H}=5000\\times \\frac{1}{100}\\times 0.011562\\\\\n=5000\\times 0.00011562\\\\\n\\approx 0.5781\\;\\text{像素/米}.\n\\end{aligned}\n$$\n\n最后计算行坐标：\n\n$$\n\\begin{aligned}\nl_{n}=\\frac{0.00942}{0.9993}\\approx 0.0094266,\\\\\n\\text{line}=5000+5000(0.0094266)\\approx 5000+47.133\\approx 5047.133.\n\\end{aligned}\n$$\n\n四舍五入到四位有效数字，行坐标为 $5047$ 像素，灵敏度为 $0.5781$ 像素/米。我们按要求将这些值呈现在一个单行矩阵中。",
            "answer": "$$\\boxed{\\begin{pmatrix}5047  0.5781\\end{pmatrix}}$$"
        },
        {
            "introduction": "前面的练习依赖于预先确定的控制点，而现代配准流程通常自动检测这些对应点。本练习深入探讨了尺度不变特征变换（SIFT）算法的核心机制，特别是如何为关键点分配一个主方向。通过计算并归一化该方向，我们可以构建对旋转不变的特征描述子，从而在不同视角或时间的图像之间实现稳健的自动配准。",
            "id": "3820994",
            "problem": "在一块经过正射校正的卫星影像片上，使用尺度不变特征变换（SIFT）检测到了一个关键点。该影像片将用于同一区域的两个多光谱场景的影像配准。给定参考影像中关键点周围的一组局部影像梯度样本。每个样本都位于关键点周围半径为 $r=1$ 像素的圆上，因此所有样本与关键点的空间距离相同。对于每个样本 $i$，提供了梯度幅值 $m_i$ 和梯度方向 $\\theta_i$（单位为度，从正 $x$ 轴逆时针测量，范围为 $[0,360)$）：\n- $i=1$: $m_1=9$, $\\theta_1=34$\n- $i=2$: $m_2=8$, $\\theta_2=29$\n- $i=3$: $m_3=7$, $\\theta_3=41$\n- $i=4$: $m_4=5$, $\\theta_4=213$\n- $i=5$: $m_5=4$, $\\theta_5=220$\n- $i=6$: $m_6=3$, $\\theta_6=120$\n- $i=7$: $m_7=2$, $\\theta_7=300$\n- $i=8$: $m_8=1$, $\\theta_8=85$\n\n仅使用基本定义，执行以下步骤以确定关键点的主 SIFT 方向：\n\n1. 构建一个包含 $K=36$ 个 bin 的方向直方图，均匀覆盖 $[0,360)$ 度。在关键点处使用标准差为 $\\sigma=1$ 像素的高斯空间加权，每个样本对直方图的幅值贡献乘以权重 $w_i=\\exp\\!\\big(-r^2/(2\\sigma^2)\\big)$。根据每个样本的方向，将其加权幅值分配到单个 bin 中，具体方法是将其放入方向 $\\theta_i$ 所在的区间 $[10b,10(b+1))$ 度对应的 bin 中，其中 $b\\in\\{0,1,\\dots,35\\}$ 是 bin 的索引。不要在 bin 之间使用投票插值。\n\n2. 对直方图进行一次循环三点平滑，用每个 bin 的值及其两个直接循环相邻 bin 的值之和替换该 bin 的值。\n\n3. 找出平滑后直方图中的最大 bin。然后，为了将主方向精细化到 bin 中心之外，使用最大 bin 索引 $b$ 及其两个相邻 bin 的三个平滑值，拟合一个二次多项式 $p(x)=ax^2+bx+c$，其中索引 $b-1,b,b+1$ 分别对应 $x=-1,0,+1$。从第一性原理出发，推导 $p(x)$ 的顶点位置 $x^{\\star}$，并用它计算一个相对于 bin $b$ 中心的子 bin 偏移量。将插值得到的主方向转换为弧度。\n\n4. 基于平面内旋转下影像梯度的变换，解释为什么在形成描述子之前从所有局部梯度方向中减去这个主方向，会使 SIFT 描述子在影像配准的背景下具有旋转不变性。\n\n仅报告在步骤 3 中获得的主方向角，以弧度为单位（用 $\\pi$ 表示）的单一封闭形式解析表达式。最终的数值表达式不要包含单位。如果您的结果不是 $\\pi$ 的有理倍数，请四舍五入到四位有效数字。角度必须以弧度为单位。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于尺度不变特征变换（SIFT）算法的原理，问题提出得当，数据充分且一致，表述客观。解答过程将遵循指定的四个步骤进行。\n\n该问题要求进行一系列计算以确定 SIFT 关键点的主方向，然后进行概念性解释。\n\n**步骤 1：构建方向直方图**\n\n首先，计算每个样本幅值贡献的空间高斯权重。所有样本都位于距离关键点半径为 $r=1$ 像素的位置。高斯标准差给定为 $\\sigma=1$ 像素。所有样本的权重 $w$ 相同，由下式给出：\n$$w = \\exp\\left(-\\frac{r^2}{2\\sigma^2}\\right) = \\exp\\left(-\\frac{1^2}{2 \\cdot 1^2}\\right) = \\exp\\left(-\\frac{1}{2}\\right)$$\n接下来，我们构建一个有 $K=36$ 个 bin 的方向直方图，每个 bin 覆盖 $10^\\circ$ 的区间。对于给定的角度 $\\theta$（以度为单位），其 bin 索引 $b \\in \\{0, 1, \\dots, 35\\}$ 由 $b = \\lfloor \\theta / 10 \\rfloor$ 确定。对 bin $b$ 的贡献是样本的幅值 $m_i$ 乘以权重 $w$。\n\n给定的样本是：\n- $i=1$: $m_1=9$, $\\theta_1=34^\\circ \\implies b_1 = \\lfloor 34 / 10 \\rfloor = 3$。贡献：$9w$。\n- $i=2$: $m_2=8$, $\\theta_2=29^\\circ \\implies b_2 = \\lfloor 29 / 10 \\rfloor = 2$。贡献：$8w$。\n- $i=3$: $m_3=7$, $\\theta_3=41^\\circ \\implies b_3 = \\lfloor 41 / 10 \\rfloor = 4$。贡献：$7w$。\n- $i=4$: $m_4=5$, $\\theta_4=213^\\circ \\implies b_4 = \\lfloor 213 / 10 \\rfloor = 21$。贡献：$5w$。\n- $i=5$: $m_5=4$, $\\theta_5=220^\\circ \\implies b_5 = \\lfloor 220 / 10 \\rfloor = 22$。贡献：$4w$。\n- $i=6$: $m_6=3$, $\\theta_6=120^\\circ \\implies b_6 = \\lfloor 120 / 10 \\rfloor = 12$。贡献：$3w$。\n- $i=7$: $m_7=2$, $\\theta_7=300^\\circ \\implies b_7 = \\lfloor 300 / 10 \\rfloor = 30$。贡献：$2w$。\n- $i=8$: $m_8=1$, $\\theta_8=85^\\circ \\implies b_8 = \\lfloor 85 / 10 \\rfloor = 8$。贡献：$1w$。\n\n初始方向直方图（记为 $H$）具有以下非零 bin 值。设权重因子为 $W = \\exp(-1/2)$。\n- $H_2 = 8W$\n- $H_3 = 9W$\n- $H_4 = 7W$\n- $H_8 = 1W$\n- $H_{12} = 3W$\n- $H_{21} = 5W$\n- $H_{22} = 4W$\n- $H_{30} = 2W$\n所有其他 bin $H_b$ 的值为 0。\n\n**步骤 2：平滑直方图**\n\n应用一次循环三点平滑。每个新 bin $H'_b$ 的值是其原始值及其两个循环相邻 bin 的值之和：$H'_b = H_{b-1} + H_b + H_{b+1}$，其中索引按模 36 计算。我们计算最显著峰值周围的平滑值：\n- $H'_2 = H_1 + H_2 + H_3 = 0 + 8W + 9W = 17W$\n- $H'_3 = H_2 + H_3 + H_4 = 8W + 9W + 7W = 24W$\n- $H'_{4} = H_3 + H_4 + H_5 = 9W + 7W + 0 = 16W$\n通过观察，平滑后直方图中的最大值为 $H'_3 = 24W$。\n\n**步骤 3：精细化主方向**\n\n通过将二次多项式 $p(x) = ax^2+bx+c$ 拟合到以峰值 bin $b_{max}=3$ 为中心的三个平滑直方图值，来精细化主方向。我们使用局部坐标 $x \\in \\{-1, 0, 1\\}$ 对应于 bin 索引 $\\{b_{max}-1, b_{max}, b_{max}+1\\}$，即 $\\{2, 3, 4\\}$。用于拟合的点是：\n- $(x, y) = (-1, H'_2) = (-1, 17W)$\n- $(x, y) = (0, H'_3) = (0, 24W)$\n- $(x, y) = (1, H'_4) = (1, 16W)$\n\n我们求解系数 $a$、$b$ 和 $c$：\n- 对于 $x=0$：$p(0) = c = 24W$。\n- 对于 $x=1$：$p(1) = a+b+c = 16W \\implies a+b = 16W - 24W = -8W$。\n- 对于 $x=-1$：$p(-1) = a-b+c = 17W \\implies a-b = 17W - 24W = -7W$。\n\n我们得到关于 $a$ 和 $b$ 的两个线性方程组：\n1. $a+b = -8W$\n2. $a-b = -7W$\n\n两方程相加得到 $2a = -15W \\implies a = - \\frac{15}{2}W$。\n第一个方程减去第二个方程得到 $2b = -W \\implies b = - \\frac{1}{2}W$。\n\n抛物线的顶点代表插值后的峰值，其位置 $x^{\\star}$ 在多项式导数为零处。根据第一性原理，$p'(x) = 2ax+b$。令 $p'(x^{\\star})=0$ 得到 $2ax^{\\star}+b=0$，因此顶点位置为 $x^{\\star} = - \\frac{b}{2a}$。\n代入推导出的 $a$ 和 $b$ 的值：\n$$x^{\\star} = - \\frac{- \\frac{1}{2}W}{2 \\left(- \\frac{15}{2}W\\right)} = - \\frac{- \\frac{1}{2}W}{-15W} = - \\frac{1}{30}$$\n子 bin 偏移量 $x^{\\star}$ 的单位是 bin 间距。bin $b_{max}=3$ 中心的方向是 $10^\\circ \\times 3 + 10^\\circ/2 = 35^\\circ$。bin 宽度为 $10^\\circ$。插值得到的主方向 $\\theta_{dom}$ 为：\n$$\\theta_{dom} = 35^\\circ + x^{\\star} \\times 10^\\circ = 35^\\circ + \\left(-\\frac{1}{30}\\right) \\times 10^\\circ = 35^\\circ - \\frac{1}{3}^\\circ = \\frac{105-1}{3}^\\circ = \\frac{104}{3}^\\circ$$\n最后，我们将此角度转换为弧度。转换公式为 $\\theta_{rad} = \\theta_{deg} \\times \\frac{\\pi}{180}$。\n$$\\theta_{dom, rad} = \\frac{104}{3} \\times \\frac{\\pi}{180} = \\frac{104\\pi}{540} = \\frac{26\\pi}{135}$$\n\n**步骤 4：旋转不变性的解释**\n\n主方向的指定是为 SIFT 描述子提供旋转不变性的基本机制。当一幅影像围绕一个关键点进行角度为 $\\phi$ 的平面内旋转时，每个局部样本点的梯度向量也旋转相同的角度 $\\phi$。因此，所有局部梯度方向 $\\theta_i$ 都变换为 $\\theta'_i = (\\theta_i + \\phi) \\pmod{360^\\circ}$。这导致整个方向直方图循环平移 $\\phi$。峰值查找和插值过程对于这种平移是等变的，这意味着如果原始主方向是 $\\theta_{dom}$，则新的主方向将是 $\\theta'_{dom} = (\\theta_{dom} + \\phi) \\pmod{360^\\circ}$。\n\nSIFT 描述子是使用相对于这个主方向表示的局部梯度方向构建的。对于未旋转影像中的一个给定样本，其相对方向为 $\\Delta\\theta_i = (\\theta_i - \\theta_{dom}) \\pmod{360^\\circ}$。在旋转后的影像中，新的相对方向为 $\\Delta\\theta'_i = (\\theta'_i - \\theta'_{dom}) \\pmod{360^\\circ}$。代入变换后的角度：$\\Delta\\theta'_i = ((\\theta_i + \\phi) - (\\theta_{dom} + \\phi)) \\pmod{360^\\circ} = (\\theta_i - \\theta_{dom}) \\pmod{360^\\circ} = \\Delta\\theta_i$。由于用于构建描述子的所有梯度样本的相对方向在影像旋转下保持不变，因此最终的 SIFT 描述子本身是旋转不变的。在诸如影像配准等应用中，这一特性对于鲁棒的特征匹配至关重要，因为在这些应用中，对应的场景可能会相互旋转。",
            "answer": "$$\\boxed{\\frac{26\\pi}{135}}$$"
        }
    ]
}