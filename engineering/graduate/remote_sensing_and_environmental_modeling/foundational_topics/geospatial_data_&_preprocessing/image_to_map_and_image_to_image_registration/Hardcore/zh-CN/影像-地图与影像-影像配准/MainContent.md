## 引言
影像配准是遥感数据处理流程中的一个基础且至关重要的步骤，它将原始的、无序的像素数据转化为具有精确地理坐标和空间意义的信息。无论是进行变化检测、数据融合还是[三维重建](@entry_id:176509)，精确的[配准](@entry_id:1122567)都是所有后续定量分析的基石，直接决定了最终科学结论的可靠性。然而，影像配准并非一个简单的“一键式”操作，它涉及复杂的几何学、传感器物理、统计学和计算机视觉知识。从业者和研究人员常常面临一个挑战：如何在多样的应用场景下，从众多配准模型和算法中做出最优选择？这需要对[配准](@entry_id:1122567)技术背后的科学原理及其适用边界有深刻的理解。

本文旨在系统性地梳理影像到地图与影像到影像[配准](@entry_id:1122567)的核心知识体系。第一章“原理与机制”将深入剖析配准的几何基础、传感器模型、核心算法和统计评估方法，为读者构建坚实的理论框架。第二章“应用与跨学科连接”将通过丰富的案例，展示配准技术如何在地球科学、[环境监测](@entry_id:196500)等领域解决实际问题，并探讨其在[多模态数据](@entry_id:635386)和复杂场景下的挑战与对策。最后，“动手实践”部分将提供具体的计算问题，帮助读者将理论知识应用于实践。通过这三个层次的递进学习，本文将引导您全面掌握影像[配准](@entry_id:1122567)的理论精髓与实践要领，从根本上提升您处理和分析遥感数据的能力。

## 原理与机制

本章深入探讨影像到地图和影像到影像配准的核心科学原理与技术机制。我们将从定义[配准](@entry_id:1122567)问题所涉及的基本几何框架开始，然后介绍用以连接影[像空间](@entry_id:918062)与现实世界坐标的各[类数](@entry_id:156164)学模型，最后讨论实现这些模型的具体算法以及评估其精度的统计方法。本章内容假定读者已对遥感影像预处理有基本了解。

### 几何基础

精确的影像[配准](@entry_id:1122567)始于对几何参考系的严格理解。无论是将影像[配准](@entry_id:1122567)到现有地图（影像到地图），还是对齐两幅或多幅影像（影像到影像），我们都必须在一个共享的、明确定义的坐标系中操作。

#### [大地基准](@entry_id:1125591)与坐标系统

任何地理[空间数据](@entry_id:924273)，无论是地图还是经过地理编码的影像，其空间位置的意义都取决于其所采用的**[大地基准](@entry_id:1125591)（geodetic datum）**。一个完整的[大地基准](@entry_id:1125591)包括一个数学上定义的**参考椭球（reference ellipsoid）**，用以近似地球的整体形状，以及一个定义原点、方向和尺度的**地面参考框架（terrestrial reference frame）**。例如，广泛使用的世界大地测量系统1984（[WGS84](@entry_id:1134054)）就定义了一个特定的[椭球体](@entry_id:165811)（由半长轴 $a$ 和扁率 $f$ [参数化](@entry_id:265163)）和一个地心坐标系。

在垂直维度上，情况更为复杂。卫星遥感系统，如全球定位系统（GPS）或通过物理传感器模型直接进行地理定位的航天影像，通常提供的是**椭球高（ellipsoidal height）**，记为 $h$。这是指地面点沿参考椭球[法线](@entry_id:167651)方向到椭球面的距离。然而，传统的[地形图](@entry_id:202940)和高程数据，如环境模型中使用的数字高程模型（DEM），通常采用**正高（orthometric height）**，记为 $H$。正高更为直观，它表示地面点沿重力线方向到**大地水准面（geoid）**的距离，后者是一个与全球平均海平面大致重合的重力[等势面](@entry_id:158674)。

参考椭球是一个光滑的数学表面，而大地水准面则是一个不规则的物理表面，它反映了地球内部[质量分布](@entry_id:158451)的不均匀性。这两者之间的[垂直距离](@entry_id:176279)被称为**大地水准面差距（geoid separation）**或**大地水准面起伏（geoid undulation）**，记为 $N$。这三个高程量之间的基本关系式为：

$h = H + N$

这个关系式对于精确的影像到地图[配准](@entry_id:1122567)至关重要。例如，当需要将一幅以[WGS84](@entry_id:1134054)椭球高为基准的[卫星影像](@entry_id:1131212)配准到一个采用国家垂直基准（如基于特定[大地水准面](@entry_id:749836)模型的北美垂直基准1988，NAVD88）的地图时，必须进行高程转换。忽略大地水准面差距将导致系统性的垂直偏差，其量级可达数十米 。假设在某个[地面控制点](@entry_id:1125825)（GCP）上，影像导出的椭球高 $h = 52.3\,\mathrm{m}$，而当地的大地水准面差距为 $N = -28.7\,\mathrm{m}$（负号表示[大地水准面](@entry_id:749836)位于参考椭球之下），那么该点在地图上对应的正高应为：

$H = h - N = 52.3\,\mathrm{m} - (-28.7\,\mathrm{m}) = 81.0\,\mathrm{m}$

此外，不同水平基准之间的转换，如从[WGS84](@entry_id:1134054)转换到北美基准1983（NAD83），由于涉及不同参考框架的定义和实现（包括因板块构造运动产生的随时间变化），通常需要一个更为复杂的变换，例如顾及了三维平移、旋转和尺度缩放的七参数赫尔默特（Helmert）变换 。

#### [几何变换](@entry_id:150649)模型

在许多应用中，尤其是在处理已经过预处理或者地形起伏较小的影像时，可以用简单的二维（2D）数学变换来近似影像与地图（或另一幅影像）之间的几何关系。这些变换模型构成了一个层次结构，其复杂性和灵活性依次递增 。

*   **相似（或保形）变换 (Similarity/Conformal Transform)**：该变换由平移（2个参数）、旋转（1个参数）和[均匀缩放](@entry_id:267671)（1个参数）组成，共拥有 **4个自由度 (DoF)**。它保持了角度和形状不变，因此称为[保角变换](@entry_id:261284)。直线变换后仍为直线，[平行线](@entry_id:169007)依然平行，并且距离的比率也保持不变。由于每个[地面控制点](@entry_id:1125825)（GCP）提供两个[约束方程](@entry_id:138140)（$x$ 和 $y$ 坐标），因此理论上仅需 **2个** 不同的GCP即可唯一确定一个[相似变换](@entry_id:152935)。

*   **[仿射变换](@entry_id:144885) (Affine Transform)**：[仿射变换](@entry_id:144885)比[相似变换](@entry_id:152935)更通用，它允许在不同方向上进行不同的缩放和剪切。它由一个[线性变换](@entry_id:149133)（4个参数）和一个平移（2个参数）组成，共拥有 **6个自由度**。[仿射变换](@entry_id:144885)保持**[共线性](@entry_id:270224)**（直线变换后仍为直线）和**平行性**（[平行线](@entry_id:169007)变换后依然平行）。它还保持了沿同一直线上各线段的长度比。然而，[仿射变换](@entry_id:144885)一般不保持角度。求解一个[仿射变换](@entry_id:144885)至少需要 **3个非共线** 的GCP。

*   **投影变换（或单应性）(Projective Transform/Homography)**：这是最通用的二维[线性变换](@entry_id:149133)，能够描述中心投影相机在两个不同姿态下对同一平面的成像关系。它在[齐次坐标](@entry_id:154569)下由一个 $3 \times 3$ [矩阵表示](@entry_id:146025)，该矩阵有9个元素，但由于可以进行任意尺度缩放，因此它拥有 **8个自由度**。投影变换只保持**[共线性](@entry_id:270224)**和**[交比](@entry_id:176420)（cross-ratio）**——即同一直线上四点的距离比率的比值。[平行线](@entry_id:169007)在投影变换后可能变为相交线（汇聚于灭点）。求解一个投影变换至少需要 **4个** GCP，且其中任意三点不共线。

选择哪种变换模型取决于传感器、成像几何以及场景地形的复杂性。对于经过良好几何校正的影像，或者小范围内的航空影像，[仿射变换](@entry_id:144885)通常是一个足够精确且鲁棒的模型。

### 传感器模型：从影像到地面

二维变换模型本质上是对成像过程的简化。为了实现最高精度的配准，特别是对于原始的、未经校正的遥感影像，必须使用能够精确描述传感器成像物理过程的**传感器模型（sensor model）**。

#### 严格物理模型：共线方程

对于大多数采用中心投影方式的[光学遥感](@entry_id:1129164)器（如框幅式相机），其成像几何可以用**共线方程（collinearity equations）**来精确描述。该方程表达了一个基本物理原理：物方点、相机镜头的光心（投影中心）以及该物方点在影像上的像点，这三点位于同一直线上 。

要建立这些方程，我们需要定义几个坐标系和参数：
*   **物方坐标系**：一个固定的地面坐标系 $(X, Y, Z)$。
*   **相机坐标系**：一个附着在相机上的[三维坐标系](@entry_id:163946) $(x_c, y_c, z_c)$，其原点位于投影中心，通常$z_c$轴与[光轴](@entry_id:175875)重合。
*   **影像坐标系**：定义在影像平面上的二维坐标系 $(x, y)$。

连接这些坐标系的是相机的**外方位元素（extrinsic parameters）**和**内方位元素（intrinsic parameters）**。
*   **外方位元素** 描述了相机在物方坐标系中的位置 $(X_s, Y_s, Z_s)$ 和姿态。姿态由一个[旋转矩阵](@entry_id:140302) $\mathbf{R}$ 表示，它将向量从物方[坐标系转换](@entry_id:263003)到相机坐标系。
*   **内方位元素** 描述了相机自身的几何特性，主要包括**主距** $f$（投影中心到像平面的距离）和**[主点](@entry_id:173969)坐标** $(x_0, y_0)$（[光轴](@entry_id:175875)与像平面的交点）。

根据共线原理，从投影中心指向物方点 $(X,Y,Z)$ 的向量与指向其像点 $(x,y)$ 的向量方向相同。通过[坐标变换](@entry_id:172727)和相似三角形原理，可以导出如下的共线方程 ：

$x = x_{0} - f \frac{r_{11}(X - X_{s}) + r_{12}(Y - Y_{s}) + r_{13}(Z - Z_{s})}{r_{31}(X - X_{s}) + r_{32}(Y - Y_{s}) + r_{33}(Z - Z_{s})}$

$y = y_{0} - f \frac{r_{21}(X - X_{s}) + r_{22}(Y - Y_{s}) + r_{23}(Z - Z_{s})}{r_{31}(X - X_{s}) + r_{32}(Y - Y_{s}) + r_{33}(Z - Z_{s})}$

其中 $r_{ij}$ 是[旋转矩阵](@entry_id:140302) $\mathbf{R}$ 的元素。这些方程构成了从物方三维坐标到影像二维坐标的精确映射，是所有严格摄影测量处理的基础。

#### [畸变校正](@entry_id:168603)：[正射校正](@entry_id:1129216)

原始遥感影像包含由传感器姿态、地球曲率和地形起伏引起的各种[几何畸变](@entry_id:914706)。其中，由地形起伏引起的像点位移被称为**地形[视差](@entry_id:918439)（terrain parallax）**。对于非垂直下视的成像，一个较高的物体（如山顶）会比一个较低的物体（如山谷）更靠近影像的边缘，即使它们在地图上的平面位置相同。

**正射校正（Orthorectification）**是一个关键的处理步骤，其目标是消除这些畸变，生成一幅具有地图几何特性的正射影像。在正射影像上，所有像元的坐标都对应其在地面上的真实平面位置，就好像从每个点的正上方垂直观察一样。

实现正射校正的物理过程是，对影像中的每一个像元 $(r,c)$，利用严格的传感器模型（如共线方程或类似的推扫式成像模型）来确定其对应的**视线（line-of-sight）**。这条视线是从传感器投影中心出发，穿过该像元的一条空间射线。然后，通过迭代计算，找到这条射[线与](@entry_id:177118)**[数字高程模型](@entry_id:1123727)（DEM）**所代表的真实地球表面的交点 $\mathbf{X}$。这个交点 $\mathbf{X}$ 的三维坐标 $(X,Y,Z)$ 就是该像元在地面上的真实位置。最后，将这个三维坐标通过[地图投影](@entry_id:149968)，转换到二维地图坐标 $(x_m, y_m)$ 上，并将原始像元的灰度值赋给这个新的位置。通过对影像中的所有像元重复此过程，就生成了一幅无[地形位移](@entry_id:1130831)的正射影像 。

#### 通用传感器模型：有理多项式相机模型

严格物理传感器模型的参数通常很复杂，有时甚至是保密的。因此，遥感界开发了**通用传感器模型（generic sensor models）**作为替代，其中应用最广泛的是**有理多项式相机模型（Rational Polynomial Camera, RPC）**。

RPC模型并不直接描述成像的物理过程，而是用一个[有理函数](@entry_id:154279)（即两个多项式的比值）来近似地模拟从物方三维坐标 $(X,Y,Z)$ 到影像坐标（行号 $l$，列号 $s$）的映射关系 。为了提高数值稳定性和适用性，所有输入和输出坐标都首先进行归一化处理，将其缩放到 $[-1, 1]$ 的范围内。

RPC模型通常表示为：

$r = \frac{N_r(x,y,z)}{D_r(x,y,z)}$

$c = \frac{N_c(x,y,z)}{D_c(x,y,z)}$

其中，$(x,y,z)$ 是归一化后的物方坐标，$(r,c)$ 是归一化后的影像坐标。$N_r, D_r, N_c, D_c$ 是关于 $(x,y,z)$ 的多项式，通常为三次多项式。一个完整的三变量三次多项式包含20个项（从常数项到 $xyz$ 这样的三次交叉项）。由于[有理函数](@entry_id:154279)存在固有的尺度模糊性（分子分母同乘一个非零常数，函数值不变），通常会通过约束分母的常数项为1来消除这种模糊性，从而得到一组唯一的RPC系数。这些系数作为影像元数据的一部分提供给用户，使其能够在没有严格物理模型的情况下，依然能实现高精度的地理定位和正射校正。

### [配准](@entry_id:1122567)方法论

建立了连接影像与地图的几何模型后，下一步就是确定模型的具体参数。这可以通过不同的配准方法来实现。在此之前，我们先讨论一旦确定了变换关系，如何生成新的影像。

#### [重采样](@entry_id:142583)过程：正向与反向地理编码

将一幅影像根据[几何变换](@entry_id:150649)生成一幅新影像的过程称为**重采样（resampling）**。存在两种主要策略：正向地理编码和反向地理编码 。

*   **正向地理编码（Forward Geocoding）**：该方法遍历源影像的每一个像元，利用变换函数 $T$ 计算其在目标（地图）坐标系中的位置 $(x,y) = T(u,v)$。然后将源像元的灰度值“放置”到目标栅格的相应位置。这种方法的直观性强，但存在一个严重问题：由于源栅格的像元中心经变换后，在目标栅格中的位置通常是非整数的、不规则的，这会导致目标影像中出现**空洞（holes）**（某些目标像元没有被赋予任何值）和**重叠（overlaps）**（某些目标像元被赋予了多个值）。虽然可以通过更复杂的面元“溅射”（splatting）技术来缓解，但实现起来较为复杂。

*   **反向地理编码（Inverse Geocoding）**：这是目前遥感软件和工作流中更为常用和推荐的方法。它遍历目标栅格的每一个像元中心 $(x,y)$，利用逆变换函数 $T^{-1}$ 计算该位置对应于源影像中的坐标 $(u,v) = T^{-1}(x,y)$。这个计算出的源坐标 $(u,v)$ 通常也位于像元之间（即亚像元位置）。然后，通过**插值（interpolation）**方法（如最近邻、[双线性](@entry_id:146819)或三次卷积插值）来估算该亚像元位置的灰度值，并将其赋给当前的目标像元。由于每个目标像元都被主动赋予了一个值，这种方法从根本上避免了空洞问题，并且易于实现。

在进行重采样时，尤其要注意**辐射度保持（radiometric preservation）**。简单的点插值忽略了一个事实，即变换会引起局部面积的缩放。一个目标像元在源影像中对应的区域面积可能变大或变小。为了精确地保持如地表反射率这类物理量的均值，需要考虑变换的**雅可比行列式（Jacobian determinant）**，它描述了局部面积的变化率。此外，当进行[降采样](@entry_id:265757)（生成更粗分辨率的影像）时，为避免**[混叠](@entry_id:146322)（aliasing）**现象，必须在采样前对源影像进行低通滤波，这符合[奈奎斯特-香农采样定理](@entry_id:262499) 。

#### 基于区域的匹[配方法](@entry_id:265480)

这类方法通过在影像上滑动一个小窗口（patch），直接比较两幅影像的灰度值或强度信息来寻找最佳匹配。它通过优化一个**[相似性度量](@entry_id:896637)（similarity metric）**或**代价函数（cost function）**来确定变换参数。选择合适的代价函数对于[配准](@entry_id:1122567)的鲁棒性至关重要，尤其是在处理不同时间（如季节变化）或不同传感器（如光学与热红外）获取的影像时 。

*   **差值平方和 (Sum of Squared Differences, SSD)**：$C_{SSD} = \sum (I_2 - I_1)^2$。SSD假设两幅影像的强度值应该几乎完全相同。它对辐射差异非常敏感，即使是简单的线性的亮度、对比度变化（$I_2 = aI_1 + b$）也会导致其失效。因此，它只适用于传感器和[成像条件](@entry_id:750526)几乎完全相同的影像。

*   **归一化互相关 (Normalized Cross-Correlation, NCC)**：NCC通过将每个窗口内的强度值减去均值并除以标准差，来计算两个窗口之间的线性相关系数。这个归一化过程使其对线性的辐射度变化（增益 $a$ 和偏置 $b$）保持**[不变性](@entry_id:140168)**。因此，NCC对于处理来自不同传感器或在不同光照条件下获取的同类影像非常鲁棒。

*   **互信息 (Mutual Information, MI)**：MI源于信息论，它衡量的是两个影像窗口强度值分布之间的统计依赖性，而不假设它们之间存在任何特定的函数关系（如线性关系）。如果两幅影像对齐，那么一个窗口中的强度值可以很好地预测另一个窗口中的强度值，它们的联合直方图会呈现出清晰的结构，互信息值就高。MI的这种特性使其不仅对线性变化不敏感，而且对**[非线性](@entry_id:637147)的、单调的**[辐射度](@entry_id:156534)变化也同样鲁棒。这使得MI成为多模态影像[配准](@entry_id:1122567)（如光学影像与雷达影像、或CT与MRI影像）的黄金标准。

#### 基于特征的匹[配方法](@entry_id:265480)

与基于区域的方法不同，基于特征的方法不直接比较所有像元的灰度值，而是分三步进行：
1.  **特征点检测**：在两幅影像中独立地检测出稳定、显著的角点、斑点等关键点。
2.  **特征描述**：在每个关键点周围提取一个紧凑的、具有区分性的**描述子（descriptor）**向量。这个描述子应该对预期的几何和辐射变化具有[不变性](@entry_id:140168)。
3.  **特征匹配**：在两幅影像的描述子集合中寻找相互匹配的对，然后利用这些匹配点对来稳健地估计[几何变换](@entry_id:150649)模型。

几种经典的特征描述子包括 SIFT、SURF 和 ORB，它们在[不变性](@entry_id:140168)方面各有千秋 。

*   **尺度不变特征变换 (Scale-Invariant Feature Transform, SIFT)**：SIFT通过在**高斯尺度空间**中寻找差分高斯（DoG）的极值点来检测关键点，从而实现**尺度不变性**。然后，它计算关键点邻域的梯度方向[主方向](@entry_id:276187)，并将描述子坐标系旋转至该方向，从而实现**旋转不变性**。其128维的描述子是梯度方向的[直方图](@entry_id:178776)，对光照变化具有很强的鲁棒性。

*   **加速稳健特征 (Speeded-Up Robust Features, SURF)**：SURF可以看作是SIFT的一个快速近似。它使用积分影像和盒子滤波器来快速计算Hessian[矩阵行列式](@entry_id:194066)的近似值以检测关键点，并使用[Haar小波](@entry_id:273598)响应来确定[主方向](@entry_id:276187)和生成描述子。它同样具有尺度和[旋转不变性](@entry_id:137644)。

*   **ORB (Oriented FAST and Rotated BRIEF)**：ORB是一个速度极快的[特征检测](@entry_id:265858)与描述算法。它使用FAST进行角点检测（速度快但不具备尺度不变性，通过图像金字塔来弥补），并使用BRIEF作为描述子。BRIEF是一个**二[进制](@entry_id:634389)描述子**，它通过比较关键点邻域内一对对像元的强度大小来生成一个二[进制](@entry_id:634389)串。ORB通过计算强度[质心](@entry_id:138352)来确定关键点方向，并对BRIEF的采样模式进行旋转，从而实现了[旋转不变性](@entry_id:137644)。

在选择描述子时，必须考虑应用场景。对于光学影像之间的配准，SIFT和SURF因其优越的尺度不变性而表现出色。ORB速度极快，但在大尺度变化下性能会下降。对于多模态影像[配准](@entry_id:1122567)（如光学-SAR），情况则大不相同。SAR影像的成像机理和统计特性（如乘性散斑噪声）与光学影像截然不同，两者像素强度之间不存在简单的单调关系。基于强度大小比较的二进制描述子（如ORB中的BRIEF）在这种情况下会完全失效。而基于梯度结构（如SIFT和SURF）的方法则更为鲁棒，因为尽管强度值本身不相关，但影像中的边缘和角点等几何结构在不同模态下往往是共通的 。

### 统计评估与优化

确定了变换模型并计算出其参数后，一个关键的步骤是评估[配准](@entry_id:1122567)的精度和可靠性。这需要对误差的来源和传播有深刻的理解。

#### 不确定性传播

通过[地面控制点](@entry_id:1125825)（GCP）计算变换参数时，GCP自身的坐标测量就存在不确定性。这种不确定性会传播到最终计算出的变换参数上。我们可以用统计方法来量化这种传播。

以一个二维[仿射变换](@entry_id:144885)为例，其参数可以写成一个向量 $\boldsymbol{\theta} = [a, b, c, d, e, f]^{\top}$。观测方程可以线性化为 $\mathbf{z} = \mathbf{H} \boldsymbol{\theta} + \boldsymbol{\varepsilon}$，其中 $\mathbf{z}$ 是GCP的观测[坐标向量](@entry_id:153319)，$\mathbf{H}$ 是由GCP影像坐标构成的**设计矩阵**，$\boldsymbol{\varepsilon}$ 是[观测误差](@entry_id:752871)。

如果GCP的[观测误差](@entry_id:752871)是不相关的且方差相同，可以使用**[普通最小二乘法](@entry_id:137121)（OLS）**来估计 $\boldsymbol{\theta}$。但在更普遍的情况下，GCP的测量误差可能在不同方向上不同（各向异性），甚至在不同点之间也可能相关。这时，我们需要使用**[加权最小二乘法](@entry_id:177517)（WLS）**。假设我们知道观测误差的**协方差矩阵** $\operatorname{Cov}(\boldsymbol{\varepsilon}) = \boldsymbol{\Sigma}$，WLS估计量为：

$\hat{\boldsymbol{\theta}} = (\mathbf{H}^{\top} \boldsymbol{\Sigma}^{-1} \mathbf{H})^{-1} \mathbf{H}^{\top} \boldsymbol{\Sigma}^{-1} \mathbf{z}$

根据[误差传播](@entry_id:147381)定律，这个估计量的协方差矩阵（即参数的不确定性）为 ：

$\operatorname{Cov}(\hat{\boldsymbol{\theta}}) = (\mathbf{H}^{\top} \boldsymbol{\Sigma}^{-1} \mathbf{H})^{-1}$

这个矩阵的对角[线元](@entry_id:196833)素给出了每个参数的方差，非对角线元素则给出了参数之间的协方差。这是评估[配准](@entry_id:1122567)模型可靠性的基础。

#### 空间[相关误差](@entry_id:268558)的处理

在遥感影像[配准](@entry_id:1122567)中，一个经典的统计假设——[观测误差](@entry_id:752871)是**[独立同分布](@entry_id:169067)（i.i.d.）**的——常常被违背。由于未建模的系统性影响（如DEM误差、[大气折射](@entry_id:202193)），邻近的GCP的残差往往会表现出**[空间相关性](@entry_id:203497)**，即一个点的误差大小和方向会与其邻近点的误差相关 。

这种[空间相关性](@entry_id:203497)（即[协方差矩阵](@entry_id:139155) $\boldsymbol{\Sigma}$ 不再是对角阵）对[最小二乘估计](@entry_id:262764)有重要影响：
*   **[普通最小二乘法](@entry_id:137121)（OLS）**的估计结果虽然仍然是**无偏**的，但不再是**最优**的。也就是说，它不再是所有线性[无偏估计](@entry_id:756289)中方差最小的（不再是BLUE - Best Linear Unbiased Estimator）。
*   使用OLS的标准方差公式 $\sigma^2(\mathbf{H}^{\top}\mathbf{H})^{-1}$ 会严重低估参数的真实不确定性，导致过于乐观的精度评估。

正确的处理方法是采用**[广义最小二乘法](@entry_id:272590)（Generalized Least Squares, GLS）**。GLS本质上就是使用完整的[协方差矩阵](@entry_id:139155) $\boldsymbol{\Sigma}$ 进行加权的WLS。然而，在实际操作中，$\boldsymbol{\Sigma}$ 通常是未知的。**[可行广义最小二乘法](@entry_id:634462)（Feasible GLS, FGLS）**提供了一个实用的解决方案 ：
1.  首先，进行一次OLS回归，得到一组初始残差。
2.  然后，利用这些[空间分布](@entry_id:188271)的残差，通过地理统计学方法计算其**经验半变异函数（empirical semivariogram）**，该函数描述了残差的方差随距离的变化规律。
3.  对经验半变异函数拟合一个理论模型（如指数模型或高斯模型），从而得到一个能够描述任意两点间[误差协方差](@entry_id:194780)的函数。
4.  利用这个[协方差函数](@entry_id:265031)构建出整个误差协方差矩阵的估计值 $\hat{\boldsymbol{\Sigma}}$。
5.  最后，使用 $\hat{\boldsymbol{\Sigma}}$ 作为权重矩阵，执行GLS估计。

通过这种方式，GLS能够正确地考虑误差的空间结构，从而得到更精确、更可靠的变换参数估计及其不确定性评估。这对于需要高精度地理定位的下游环境建模应用尤为重要。