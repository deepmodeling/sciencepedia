{
    "hands_on_practices": [
        {
            "introduction": "The foundation of image-to-map registration lies in defining a precise mathematical transformation between image pixels and real-world map coordinates. This first practice challenges you to derive a 2D affine transformation using a small set of Ground Control Points (GCPs), a common task in georeferencing aerial or UAV imagery . By solving for the transformation matrix and vector, you will solidify your understanding of how linear algebra underpins geometric correction and learn to interpret key parameters like the determinant as a physical scaling factor.",
            "id": "3821081",
            "problem": "A small Unmanned Aerial Vehicle (UAV) image must be registered to a local map for floodplain habitat modeling. Three non-collinear Ground Control Points (GCPs) are available as pixel coordinates in the image and corresponding coordinates in a local map reference frame. The image coordinates (in pixels) are: $\\mathbf{p}_{I,1} = \\begin{pmatrix}120 \\\\ 80\\end{pmatrix}$, $\\mathbf{p}_{I,2} = \\begin{pmatrix}420 \\\\ 80\\end{pmatrix}$, and $\\mathbf{p}_{I,3} = \\begin{pmatrix}120 \\\\ 380\\end{pmatrix}$. The corresponding map coordinates (in meters) are: $\\mathbf{p}_{M,1} = \\begin{pmatrix}325 \\\\ -44\\end{pmatrix}$, $\\mathbf{p}_{M,2} = \\begin{pmatrix}925 \\\\ -344\\end{pmatrix}$, and $\\mathbf{p}_{M,3} = \\begin{pmatrix}625 \\\\ 256\\end{pmatrix}$.\n\nAssume a planar affine image-to-map model $\\mathbf{p}_{M} = A\\,\\mathbf{p}_{I} + \\mathbf{t}$, where $A \\in \\mathbb{R}^{2 \\times 2}$ and $\\mathbf{t} \\in \\mathbb{R}^{2}$. Using only the core definition of an affine map and the linear independence of point differences implied by non-collinearity, derive the unique affine transform $(A,\\mathbf{t})$ that maps the three image points to their corresponding map points. Then, formally validate invertibility by evaluating $\\det(A)$ and interpreting it as the local area-scaling factor under the registration.\n\nProvide as your final answer the exact numerical value of $\\det(A)$. Express the determinant as a pure number corresponding to meter squared per pixel squared, and do not include any unit symbol in your answer. No rounding is required; report the exact value.",
            "solution": "The problem requires the determination of a unique affine transformation $(A, \\mathbf{t})$ that maps a set of three non-collinear image points to a corresponding set of map points. The transformation is defined by the equation $\\mathbf{p}_{M} = A\\,\\mathbf{p}_{I} + \\mathbf{t}$, where $\\mathbf{p}_{I}$ are image coordinates, $\\mathbf{p}_{M}$ are map coordinates, $A \\in \\mathbb{R}^{2 \\times 2}$ is the linear transformation matrix, and $\\mathbf{t} \\in \\mathbb{R}^{2}$ is the translation vector.\n\nThe given corresponding points are:\nImage coordinates (in pixels):\n$$ \\mathbf{p}_{I,1} = \\begin{pmatrix}120 \\\\ 80\\end{pmatrix}, \\quad \\mathbf{p}_{I,2} = \\begin{pmatrix}420 \\\\ 80\\end{pmatrix}, \\quad \\mathbf{p}_{I,3} = \\begin{pmatrix}120 \\\\ 380\\end{pmatrix} $$\nMap coordinates (in meters):\n$$ \\mathbf{p}_{M,1} = \\begin{pmatrix}325 \\\\ -44\\end{pmatrix}, \\quad \\mathbf{p}_{M,2} = \\begin{pmatrix}925 \\\\ -344\\end{pmatrix}, \\quad \\mathbf{p}_{M,3} = \\begin{pmatrix}625 \\\\ 256\\end{pmatrix} $$\n\nThe affine relationship holds for each pair of corresponding points:\n$1.$ $\\mathbf{p}_{M,1} = A\\mathbf{p}_{I,1} + \\mathbf{t}$\n$2.$ $\\mathbf{p}_{M,2} = A\\mathbf{p}_{I,2} + \\mathbf{t}$\n$3.$ $\\mathbf{p}_{M,3} = A\\mathbf{p}_{I,3} + \\mathbf{t}$\n\nTo isolate the matrix $A$, we can eliminate the translation vector $\\mathbf{t}$ by considering the differences between points. Subtracting equation ($1$) from equation ($2$) and ($3$) yields:\n$$ \\mathbf{p}_{M,2} - \\mathbf{p}_{M,1} = (A\\mathbf{p}_{I,2} + \\mathbf{t}) - (A\\mathbf{p}_{I,1} + \\mathbf{t}) = A(\\mathbf{p}_{I,2} - \\mathbf{p}_{I,1}) $$\n$$ \\mathbf{p}_{M,3} - \\mathbf{p}_{M,1} = (A\\mathbf{p}_{I,3} + \\mathbf{t}) - (A\\mathbf{p}_{I,1} + \\mathbf{t}) = A(\\mathbf{p}_{I,3} - \\mathbf{p}_{I,1}) $$\n\nLet us define the difference vectors:\nIn the image space:\n$$ \\Delta\\mathbf{p}_{I,21} = \\mathbf{p}_{I,2} - \\mathbf{p}_{I,1} = \\begin{pmatrix}420 - 120 \\\\ 80 - 80\\end{pmatrix} = \\begin{pmatrix}300 \\\\ 0\\end{pmatrix} $$\n$$ \\Delta\\mathbf{p}_{I,31} = \\mathbf{p}_{I,3} - \\mathbf{p}_{I,1} = \\begin{pmatrix}120 - 120 \\\\ 380 - 80\\end{pmatrix} = \\begin{pmatrix}0 \\\\ 300\\end{pmatrix} $$\nIn the map space:\n$$ \\Delta\\mathbf{p}_{M,21} = \\mathbf{p}_{M,2} - \\mathbf{p}_{M,1} = \\begin{pmatrix}925 - 325 \\\\ -344 - (-44)\\end{pmatrix} = \\begin{pmatrix}600 \\\\ -300\\end{pmatrix} $$\n$$ \\Delta\\mathbf{p}_{M,31} = \\mathbf{p}_{M,3} - \\mathbf{p}_{M,1} = \\begin{pmatrix}625 - 325 \\\\ 256 - (-44)\\end{pmatrix} = \\begin{pmatrix}300 \\\\ 300\\end{pmatrix} $$\n\nThese two vector equations, $\\Delta\\mathbf{p}_{M,21} = A \\Delta\\mathbf{p}_{I,21}$ and $\\Delta\\mathbf{p}_{M,31} = A \\Delta\\mathbf{p}_{I,31}$, can be combined into a single matrix equation by forming matrices whose columns are these difference vectors:\n$$ \\begin{pmatrix} \\Delta\\mathbf{p}_{M,21} & \\Delta\\mathbf{p}_{M,31} \\end{pmatrix} = A \\begin{pmatrix} \\Delta\\mathbf{p}_{I,21} & \\Delta\\mathbf{p}_{I,31} \\end{pmatrix} $$\nLet $P_M = \\begin{pmatrix} \\Delta\\mathbf{p}_{M,21} & \\Delta\\mathbf{p}_{M,31} \\end{pmatrix}$ and $P_I = \\begin{pmatrix} \\Delta\\mathbf{p}_{I,21} & \\Delta\\mathbf{p}_{I,31} \\end{pmatrix}$. The equation is $P_M = A P_I$.\nSubstituting the calculated values:\n$$ \\begin{pmatrix} 600 & 300 \\\\ -300 & 300 \\end{pmatrix} = A \\begin{pmatrix} 300 & 0 \\\\ 0 & 300 \\end{pmatrix} $$\nThe problem states that the points are non-collinear, which implies that the difference vectors in each space are linearly independent. This ensures that the matrix $P_I$ is invertible. We can solve for $A$ by post-multiplying by the inverse of $P_I$:\n$$ A = P_M P_I^{-1} $$\nFirst, we find $P_I^{-1}$:\n$$ P_I = \\begin{pmatrix} 300 & 0 \\\\ 0 & 300 \\end{pmatrix} = 300 \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} = 300 I $$\nThe inverse is:\n$$ P_I^{-1} = \\frac{1}{300} I^{-1} = \\frac{1}{300} \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{300} & 0 \\\\ 0 & \\frac{1}{300} \\end{pmatrix} $$\nNow, we compute $A$:\n$$ A = \\begin{pmatrix} 600 & 300 \\\\ -300 & 300 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{300} & 0 \\\\ 0 & \\frac{1}{300} \\end{pmatrix} = \\begin{pmatrix} 600 \\cdot \\frac{1}{300} & 300 \\cdot \\frac{1}{300} \\\\ -300 \\cdot \\frac{1}{300} & 300 \\cdot \\frac{1}{300} \\end{pmatrix} = \\begin{pmatrix} 2 & 1 \\\\ -1 & 1 \\end{pmatrix} $$\nHaving found $A$, we can find $\\mathbf{t}$ using the first point correspondence: $\\mathbf{t} = \\mathbf{p}_{M,1} - A\\mathbf{p}_{I,1}$.\n$$ \\mathbf{t} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 2 & 1 \\\\ -1 & 1 \\end{pmatrix} \\begin{pmatrix} 120 \\\\ 80 \\end{pmatrix} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 2(120) + 1(80) \\\\ -1(120) + 1(80) \\end{pmatrix} $$\n$$ \\mathbf{t} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 240 + 80 \\\\ -120 + 80 \\end{pmatrix} = \\begin{pmatrix} 325 \\\\ -44 \\end{pmatrix} - \\begin{pmatrix} 320 \\\\ -40 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ -4 \\end{pmatrix} $$\nThus, the unique affine transformation is specified by $A = \\begin{pmatrix} 2 & 1 \\\\ -1 & 1 \\end{pmatrix}$ and $\\mathbf{t} = \\begin{pmatrix} 5 \\\\ -4 \\end{pmatrix}$.\n\nThe final step is to validate the invertibility of the transformation and interpret the determinant of $A$. A transformation is invertible if and only if its linear part, represented by matrix $A$, is invertible. This is true if and only if $\\det(A) \\ne 0$.\nLet's compute the determinant of $A$:\n$$ \\det(A) = \\det\\begin{pmatrix} 2 & 1 \\\\ -1 & 1 \\end{pmatrix} = (2)(1) - (1)(-1) = 2 + 1 = 3 $$\nSince $\\det(A) = 3 \\ne 0$, the matrix $A$ is invertible, and therefore the affine transformation is invertible. There exists a unique inverse transformation that maps points from the map back to the image.\n\nThe determinant of the transformation matrix $A$ represents the ratio of area elements between the output space (map) and the input space (image). In this context, the units of the image space are pixels (px) and the units of the map space are meters (m). The determinant, $\\det(A)$, has units of (meters squared) per (pixel squared), i.e., $\\text{m}^2/\\text{px}^2$.\nThe value $\\det(A) = 3$ signifies that a unit area of $1$ square pixel in the image corresponds to an area of $3$ square meters on the map. The positive sign of the determinant indicates that the transformation is orientation-preserving, meaning it does not include a reflection.\nThe final answer required is the numerical value of $\\det(A)$.",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "While simple geometric models are useful, modern satellite remote sensing relies on sophisticated sensor models to achieve high geolocational accuracy. This practice moves into the realm of rigorous sensor modeling by using the Rational Polynomial Camera (RPC) model, an industry standard for georeferencing high-resolution satellite imagery . You will calculate the image location of a ground point and, more importantly, analyze the registration's sensitivity to elevation errors, a critical skill for assessing the impact of DEM quality on orthorectification.",
            "id": "3821027",
            "problem": "A satellite image is georeferenced using the Rational Polynomial Camera (RPC) model. The Digital Elevation Model (DEM) provides ground elevation. You are given the following setup for the line coordinate mapping. The normalized ground coordinates are defined by $$L=\\frac{\\phi-\\phi_{0}}{\\phi_{\\mathrm{scale}}},\\quad S=\\frac{\\lambda-\\lambda_{0}}{\\lambda_{\\mathrm{scale}}},\\quad H=\\frac{Z-Z_{0}}{Z_{\\mathrm{scale}}},$$ where $\\phi$ is latitude (in degrees), $\\lambda$ is longitude (in degrees), and $Z$ is orthometric height (in meters). The normalized line coordinate is given by the ratio of two polynomials $$l_{n}(L,S,H)=\\frac{P(L,S,H)}{Q(L,S,H)},$$ with $$P(L,S,H)=a_{0}+a_{1}L+a_{2}S+a_{3}H+a_{4}LS+a_{5}LH+a_{6}SH+a_{7}L^{2}+a_{8}S^{2}+a_{9}H^{2},$$ $$Q(L,S,H)=1+b_{1}L+b_{2}S+b_{3}H+b_{4}L^{2}+b_{5}S^{2}.$$ The actual line coordinate in pixels is $$\\text{line}=\\text{line}_{\\mathrm{offset}}+\\text{line}_{\\mathrm{scale}}\\;l_{n}(L,S,H).$$ The Rational Polynomial Camera (RPC) coefficients and normalization parameters for the line mapping are:\n$$a_{0}=0.001,\\;a_{1}=0.020,\\;a_{2}=-0.015,\\;a_{3}=0.010,\\;a_{4}=0.005,\\;a_{5}=-0.004,\\;a_{6}=0.003,\\;a_{7}=0.010,\\;a_{8}=-0.008,\\;a_{9}=0.002,$$\n$$b_{1}=0.010,\\;b_{2}=-0.020,\\;b_{3}=0.005,\\;b_{4}=0.003,\\;b_{5}=0.002,$$\n$$\\phi_{0}=37.5,\\;\\phi_{\\mathrm{scale}}=0.05,\\;\\lambda_{0}=-122.2,\\;\\lambda_{\\mathrm{scale}}=0.05,\\;Z_{0}=100,\\;Z_{\\mathrm{scale}}=100,$$\n$$\\text{line}_{\\mathrm{offset}}=5000,\\;\\text{line}_{\\mathrm{scale}}=5000.$$\nConsider the ground point with latitude and longitude $$\\phi=37.52,\\quad \\lambda=-122.18,$$ and elevation $$Z=150.$$ Starting from the standard definitions of normalized coordinates and the Rational Polynomial Camera (RPC) mapping described above, compute:\n- the line image coordinate in pixels, and\n- the local sensitivity of the line coordinate to DEM elevation error as the partial derivative $$\\frac{\\partial\\,\\text{line}}{\\partial Z}$$ evaluated at the given ground point.\n\nExpress the final line coordinate in pixels and the derivative in pixels per meter. Round your numerical results to four significant figures. Provide the single final answer containing both quantities in a single row matrix in the order: line coordinate, then $\\frac{\\partial\\,\\text{line}}{\\partial Z}$.",
            "solution": "The Rational Polynomial Camera (RPC) model maps normalized ground coordinates to normalized image coordinates through a rational function, and the image line coordinate is obtained by applying the provided offset and scale. Given the definitions $$L=\\frac{\\phi-\\phi_{0}}{\\phi_{\\mathrm{scale}}},\\quad S=\\frac{\\lambda-\\lambda_{0}}{\\lambda_{\\mathrm{scale}}},\\quad H=\\frac{Z-Z_{0}}{Z_{\\mathrm{scale}}},$$ we first compute the normalized coordinates at the specified ground point. With the given values $$\\phi=37.52,\\;\\phi_{0}=37.5,\\;\\phi_{\\mathrm{scale}}=0.05,$$ $$\\lambda=-122.18,\\;\\lambda_{0}=-122.2,\\;\\lambda_{\\mathrm{scale}}=0.05,$$ $$Z=150,\\;Z_{0}=100,\\;Z_{\\mathrm{scale}}=100,$$ we obtain\n$$L=\\frac{37.52-37.5}{0.05}=\\frac{0.02}{0.05}=0.4,$$\n$$S=\\frac{-122.18-(-122.2)}{0.05}=\\frac{0.02}{0.05}=0.4,$$\n$$H=\\frac{150-100}{100}=\\frac{50}{100}=0.5.$$\nNext, evaluate the numerator polynomial $P(L,S,H)$ using\n$$P(L,S,H)=a_{0}+a_{1}L+a_{2}S+a_{3}H+a_{4}LS+a_{5}LH+a_{6}SH+a_{7}L^{2}+a_{8}S^{2}+a_{9}H^{2}.$$\nCompute the required monomials:\n$$LS=0.4\\times 0.4=0.16,\\quad LH=0.4\\times 0.5=0.2,\\quad SH=0.4\\times 0.5=0.2,$$\n$$L^{2}=0.4^{2}=0.16,\\quad S^{2}=0.4^{2}=0.16,\\quad H^{2}=0.5^{2}=0.25.$$\nWith the given coefficients,\n\n$$\n\\begin{aligned}\nP&=0.001+0.020(0.4)+(-0.015)(0.4)+0.010(0.5)+0.005(0.16)+(-0.004)(0.2)+0.003(0.2)\\\\\n&\\quad+0.010(0.16)+(-0.008)(0.16)+0.002(0.25)\\\\\n&=0.001+0.008-0.006+0.005+0.0008-0.0008+0.0006+0.0016-0.00128+0.0005\\\\\n&=0.00942.\n\\end{aligned}\n$$\n\nNow evaluate the denominator polynomial $Q(L,S,H)$ using\n$$Q(L,S,H)=1+b_{1}L+b_{2}S+b_{3}H+b_{4}L^{2}+b_{5}S^{2}.$$\nSubstitution yields\n\n$$\n\\begin{aligned}\nQ&=1+0.010(0.4)+(-0.020)(0.4)+0.005(0.5)+0.003(0.16)+0.002(0.16)\\\\\n&=1+0.004-0.008+0.0025+0.00048+0.00032\\\\\n&=0.9993.\n\\end{aligned}\n$$\n\nThe normalized line coordinate is then\n$$l_{n}=\\frac{P}{Q}=\\frac{0.00942}{0.9993}.$$\nTo compute the image line coordinate in pixels,\n$$\\text{line}=\\text{line}_{\\mathrm{offset}}+\\text{line}_{\\mathrm{scale}}\\,l_{n}=5000+5000\\left(\\frac{0.00942}{0.9993}\\right).$$\nFor sensitivity to DEM elevation error, we compute the partial derivative $\\frac{\\partial\\,\\text{line}}{\\partial Z}$ at the given point. Using the chain rule and the definition $H=(Z-Z_{0})/Z_{\\mathrm{scale}}$, we have\n$$\\frac{\\partial\\,\\text{line}}{\\partial Z}=\\text{line}_{\\mathrm{scale}}\\;\\frac{\\partial l_{n}}{\\partial Z}=\\text{line}_{\\mathrm{scale}}\\;\\frac{\\partial l_{n}}{\\partial H}\\;\\frac{\\partial H}{\\partial Z}=\\text{line}_{\\mathrm{scale}}\\;\\frac{\\partial l_{n}}{\\partial H}\\;\\frac{1}{Z_{\\mathrm{scale}}}.$$\nIt remains to compute $\\frac{\\partial l_{n}}{\\partial H}$ from the quotient $l_{n}=P/Q$. Differentiating,\n$$\\frac{\\partial l_{n}}{\\partial H}=\\frac{Q\\,\\frac{\\partial P}{\\partial H}-P\\,\\frac{\\partial Q}{\\partial H}}{Q^{2}}.$$\nFrom $P$, the derivative with respect to $H$ is\n$$\\frac{\\partial P}{\\partial H}=a_{3}+a_{5}L+a_{6}S+2a_{9}H.$$\nSubstitute values:\n\n$$\n\\begin{aligned}\n\\frac{\\partial P}{\\partial H}&=0.010+(-0.004)(0.4)+0.003(0.4)+2(0.002)(0.5)\\\\\n&=0.010-0.0016+0.0012+0.002\\\\\n&=0.0116.\n\\end{aligned}\n$$\n\nFrom $Q$, the derivative with respect to $H$ is\n$$\\frac{\\partial Q}{\\partial H}=b_{3}=0.005.$$\nNow evaluate $\\frac{\\partial l_{n}}{\\partial H}$ numerically:\n\n$$\n\\begin{aligned}\nQ\\,\\frac{\\partial P}{\\partial H}&=0.9993\\times 0.0116=0.01159188,\\\\\nP\\,\\frac{\\partial Q}{\\partial H}&=0.00942\\times 0.005=0.0000471,\\\\\n\\text{numerator}&=0.01159188-0.0000471=0.01154478,\\\\\nQ^{2}&=(0.9993)^{2}=0.99860049,\\\\\n\\frac{\\partial l_{n}}{\\partial H}&=\\frac{0.01154478}{0.99860049}\\approx 0.011562.\n\\end{aligned}\n$$\n\nTherefore,\n\n$$\n\\begin{aligned}\n\\frac{\\partial\\,\\text{line}}{\\partial Z}&=\\text{line}_{\\mathrm{scale}}\\;\\frac{1}{Z_{\\mathrm{scale}}}\\;\\frac{\\partial l_{n}}{\\partial H}=5000\\times \\frac{1}{100}\\times 0.011562\\\\\n&=5000\\times 0.00011562\\\\\n&\\approx 0.5781\\;\\text{pixels per meter}.\n\\end{aligned}\n$$\n\nFinally compute the line coordinate:\n\n$$\n\\begin{aligned}\nl_{n}&=\\frac{0.00942}{0.9993}\\approx 0.0094266,\\\\\n\\text{line}&=5000+5000(0.0094266)\\approx 5000+47.133\\approx 5047.133.\n\\end{aligned}\n$$\n\nRounded to four significant figures, the line coordinate is $5047$ pixels and the sensitivity is $0.5781$ pixels per meter. We present these in a single row matrix as required.",
            "answer": "$$\\boxed{\\begin{pmatrix}5047 & 0.5781\\end{pmatrix}}$$"
        },
        {
            "introduction": "Effective image-to-image registration, especially in automated workflows, depends on algorithms that can reliably identify and match corresponding features despite differences in rotation, scale, and illumination. This exercise takes you inside one of the most celebrated feature detection algorithms, the Scale-Invariant Feature Transform (SIFT), to understand how it achieves rotation invariance . By constructing an orientation histogram and interpolating its peak, you will demystify a core component of modern feature descriptors and appreciate the principles behind robust, automated image matching.",
            "id": "3820994",
            "problem": "A keypoint has been detected using the Scale-Invariant Feature Transform (SIFT) in an ortho-rectified satellite image patch that will be used for image-to-image registration of two multispectral scenes of the same area. You are given a set of local image gradient samples around the keypoint in the reference image. Each sample is located on a circle of radius $r=1$ pixel around the keypoint, so that all samples are at the same spatial distance from the keypoint. For each sample $i$, you are provided the gradient magnitude $m_i$ and gradient orientation $\\theta_i$ (in degrees, measured counterclockwise from the positive $x$-axis, wrapped into $[0,360)$):\n- $i=1$: $m_1=9$, $\\theta_1=34$\n- $i=2$: $m_2=8$, $\\theta_2=29$\n- $i=3$: $m_3=7$, $\\theta_3=41$\n- $i=4$: $m_4=5$, $\\theta_4=213$\n- $i=5$: $m_5=4$, $\\theta_5=220$\n- $i=6$: $m_6=3$, $\\theta_6=120$\n- $i=7$: $m_7=2$, $\\theta_7=300$\n- $i=8$: $m_8=1$, $\\theta_8=85$\n\nUsing only fundamental definitions, perform the following steps to determine the dominant SIFT orientation of the keypoint:\n\n1. Construct an orientation histogram with $K=36$ bins uniformly covering $[0,360)$ degrees. Use a Gaussian spatial weighting at the keypoint with standard deviation $\\sigma=1$ pixel, with weight $w_i=\\exp\\!\\big(-r^2/(2\\sigma^2)\\big)$ multiplying each sample’s magnitude contribution to the histogram. Assign each sample’s weighted magnitude to a single bin determined by its orientation, by placing it in the bin whose interval $[10b,10(b+1))$ degrees contains $\\theta_i$, where $b\\in\\{0,1,\\dots,35\\}$ is the bin index. Do not use vote interpolation between bins.\n\n2. Apply one pass of circular three-point smoothing to the histogram, replacing each bin value by the sum of itself and its two immediate circular neighbors.\n\n3. Identify the maximum bin in the smoothed histogram. Then, to refine the dominant orientation beyond the bin center, fit a quadratic polynomial $p(x)=ax^2+bx+c$ through the three smoothed values at the maximum bin’s index $b$ and its two neighbors, using $x=-1,0,+1$ for indices $b-1,b,b+1$ respectively. From first principles, derive the vertex location $x^{\\star}$ of $p(x)$ and use it to compute a sub-bin offset from the center of bin $b$. Convert the interpolated dominant orientation to radians.\n\n4. Based on the transformation of image gradients under in-plane rotation, explain why subtracting this dominant orientation from all local gradient orientations before forming the descriptor renders the SIFT descriptor rotation invariant in the context of image-to-image registration.\n\nReport only the dominant orientation angle obtained in step 3 as a single closed-form analytic expression in radians (in terms of $\\pi$). Do not include units with your final numeric expression. If your result is not a rational multiple of $\\pi$, round to four significant figures. Angles must be in radians.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of the Scale-Invariant Feature Transform (SIFT) algorithm, well-posed with sufficient and consistent data, and objectively formulated. The solution proceeds by following the four specified steps.\n\nThe problem requires a series of calculations to determine the dominant orientation of a SIFT keypoint, followed by a conceptual explanation.\n\n**Step 1: Construct the Orientation Histogram**\n\nFirst, the spatial Gaussian weight for each sample's magnitude contribution is calculated. All samples are located at a radius of $r=1$ pixel from the keypoint. The Gaussian standard deviation is given as $\\sigma=1$ pixel. The weight $w$ is the same for all samples and is given by:\n$$w = \\exp\\left(-\\frac{r^2}{2\\sigma^2}\\right) = \\exp\\left(-\\frac{1^2}{2 \\cdot 1^2}\\right) = \\exp\\left(-\\frac{1}{2}\\right)$$\nNext, we construct an orientation histogram with $K=36$ bins, where each bin covers a $10^\\circ$ interval. The bin index $b \\in \\{0, 1, \\dots, 35\\}$ for a given orientation $\\theta$ in degrees is determined by $b = \\lfloor \\theta / 10 \\rfloor$. The contribution to bin $b$ is the sample's magnitude $m_i$ multiplied by the weight $w$.\n\nThe given samples are:\n- $i=1$: $m_1=9$, $\\theta_1=34^\\circ \\implies b_1 = \\lfloor 34 / 10 \\rfloor = 3$. Contribution: $9w$.\n- $i=2$: $m_2=8$, $\\theta_2=29^\\circ \\implies b_2 = \\lfloor 29 / 10 \\rfloor = 2$. Contribution: $8w$.\n- $i=3$: $m_3=7$, $\\theta_3=41^\\circ \\implies b_3 = \\lfloor 41 / 10 \\rfloor = 4$. Contribution: $7w$.\n- $i=4$: $m_4=5$, $\\theta_4=213^\\circ \\implies b_4 = \\lfloor 213 / 10 \\rfloor = 21$. Contribution: $5w$.\n- $i=5$: $m_5=4$, $\\theta_5=220^\\circ \\implies b_5 = \\lfloor 220 / 10 \\rfloor = 22$. Contribution: $4w$.\n- $i=6$: $m_6=3$, $\\theta_6=120^\\circ \\implies b_6 = \\lfloor 120 / 10 \\rfloor = 12$. Contribution: $3w$.\n- $i=7$: $m_7=2$, $\\theta_7=300^\\circ \\implies b_7 = \\lfloor 300 / 10 \\rfloor = 30$. Contribution: $2w$.\n- $i=8$: $m_8=1$, $\\theta_8=85^\\circ \\implies b_8 = \\lfloor 85 / 10 \\rfloor = 8$. Contribution: $1w$.\n\nThe initial orientation histogram, denoted by $H$, has the following non-zero bin values. Let the weight factor be $W = \\exp(-1/2)$.\n- $H_2 = 8W$\n- $H_3 = 9W$\n- $H_4 = 7W$\n- $H_8 = 1W$\n- $H_{12} = 3W$\n- $H_{21} = 5W$\n- $H_{22} = 4W$\n- $H_{30} = 2W$\nAll other bins $H_b$ are $0$.\n\n**Step 2: Smooth the Histogram**\n\nA single pass of circular three-point smoothing is applied. The value of each new bin $H'_b$ is the sum of its original value and its two circular neighbors: $H'_b = H_{b-1} + H_b + H_{b+1}$, where indices are taken modulo $36$. We compute the smoothed values around the most significant peak:\n- $H'_2 = H_1 + H_2 + H_3 = 0 + 8W + 9W = 17W$\n- $H'_3 = H_2 + H_3 + H_4 = 8W + 9W + 7W = 24W$\n- $H'_{4} = H_3 + H_4 + H_5 = 9W + 7W + 0 = 16W$\nBy inspection, the maximum value in the smoothed histogram is $H'_3 = 24W$.\n\n**Step 3: Refine the Dominant Orientation**\n\nThe dominant orientation is refined by fitting a quadratic polynomial $p(x) = ax^2+bx+c$ to the three smoothed histogram values centered at the peak bin $b_{max}=3$. We use local coordinates $x \\in \\{-1, 0, 1\\}$ corresponding to bin indices $\\{b_{max}-1, b_{max}, b_{max}+1\\}$, i.e., $\\{2, 3, 4\\}$. The points for the fit are:\n- $(x, y) = (-1, H'_2) = (-1, 17W)$\n- $(x, y) = (0, H'_3) = (0, 24W)$\n- $(x, y) = (1, H'_4) = (1, 16W)$\n\nWe solve for the coefficients $a$, $b$, and $c$:\n- For $x=0$: $p(0) = c = 24W$.\n- For $x=1$: $p(1) = a+b+c = 16W \\implies a+b = 16W - 24W = -8W$.\n- For $x=-1$: $p(-1) = a-b+c = 17W \\implies a-b = 17W - 24W = -7W$.\n\nWe have a system of two linear equations for $a$ and $b$:\n1. $a+b = -8W$\n2. $a-b = -7W$\n\nAdding the two equations gives $2a = -15W \\implies a = - \\frac{15}{2}W$.\nSubtracting the second from the first gives $2b = -W \\implies b = - \\frac{1}{2}W$.\n\nThe vertex of the parabola, which represents the interpolated peak, occurs at $x^{\\star}$ where the derivative of the polynomial is zero. From first principles, $p'(x) = 2ax+b$. Setting $p'(x^{\\star})=0$ gives $2ax^{\\star}+b=0$, so the vertex location is $x^{\\star} = - \\frac{b}{2a}$.\nSubstituting the derived values of $a$ and $b$:\n$$x^{\\star} = - \\frac{- \\frac{1}{2}W}{2 \\left(- \\frac{15}{2}W\\right)} = - \\frac{- \\frac{1}{2}W}{-15W} = - \\frac{1}{30}$$\nThe sub-bin offset $x^{\\star}$ is in units of bin spacings. The orientation of the center of bin $b_{max}=3$ is $10^\\circ \\times 3 + 10^\\circ/2 = 35^\\circ$. The bin width is $10^\\circ$. The interpolated dominant orientation $\\theta_{dom}$ is:\n$$\\theta_{dom} = 35^\\circ + x^{\\star} \\times 10^\\circ = 35^\\circ + \\left(-\\frac{1}{30}\\right) \\times 10^\\circ = 35^\\circ - \\frac{1}{3}^\\circ = \\frac{105-1}{3}^\\circ = \\frac{104}{3}^\\circ$$\nFinally, we convert this angle to radians. The conversion is $\\theta_{rad} = \\theta_{deg} \\times \\frac{\\pi}{180}$.\n$$\\theta_{dom, rad} = \\frac{104}{3} \\times \\frac{\\pi}{180} = \\frac{104\\pi}{540} = \\frac{26\\pi}{135}$$\n\n**Step 4: Explanation of Rotation Invariance**\n\nThe assignment of a dominant orientation is the fundamental mechanism that provides the SIFT descriptor with rotational invariance. When an image is subjected to an in-plane rotation by an angle $\\phi$ around a keypoint, the gradient vector at every local sample point also rotates by the same angle $\\phi$. Consequently, all local gradient orientations $\\theta_i$ are transformed to $\\theta'_i = (\\theta_i + \\phi) \\pmod{360^\\circ}$. This causes the entire orientation histogram to be cyclically shifted by $\\phi$. The peak-finding and interpolation process is equivariant with this shift, meaning that if the original dominant orientation was $\\theta_{dom}$, the new dominant orientation will be $\\theta'_{dom} = (\\theta_{dom} + \\phi) \\pmod{360^\\circ}$.\n\nThe SIFT descriptor is constructed using local gradient orientations expressed relative to this dominant orientation. For a given sample in the unrotated image, its relative orientation is $\\Delta\\theta_i = (\\theta_i - \\theta_{dom}) \\pmod{360^\\circ}$. In the rotated image, the new relative orientation is $\\Delta\\theta'_i = (\\theta'_i - \\theta'_{dom}) \\pmod{360^\\circ}$. Substituting the transformed angles: $\\Delta\\theta'_i = ((\\theta_i + \\phi) - (\\theta_{dom} + \\phi)) \\pmod{360^\\circ} = (\\theta_i - \\theta_{dom}) \\pmod{360^\\circ} = \\Delta\\theta_i$. Since the relative orientations of all gradient samples used to build the descriptor remain unchanged under image rotation, the final SIFT descriptor is itself rotation-invariant. This property is critical for robust feature matching in applications like image-to-image registration, where corresponding scenes may be rotated relative to one another.",
            "answer": "$$\\boxed{\\frac{26\\pi}{135}}$$"
        }
    ]
}