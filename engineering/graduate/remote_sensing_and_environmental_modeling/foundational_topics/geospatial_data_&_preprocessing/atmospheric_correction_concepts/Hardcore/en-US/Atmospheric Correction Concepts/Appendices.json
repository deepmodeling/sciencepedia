{
    "hands_on_practices": [
        {
            "introduction": "To accurately retrieve surface properties, we must first characterize the light added by the atmosphere itself, known as path radiance. This exercise () delves into the fundamental process of Rayleigh scattering by molecules in a clean atmosphere. By deriving the path radiance from first principles and demonstrating its characteristic $\\lambda^{-4}$ spectral dependence, you will gain a core understanding of why the sky appears blue and how this predictable signal forms the baseline for atmospheric correction.",
            "id": "3796588",
            "problem": "A satellite observes a black ocean surface ($\\text{surface reflectance} = 0$) through a horizontally homogeneous, plane-parallel, dry molecular atmosphere. Neglect aerosols and all gaseous absorption; assume only molecular (Rayleigh) scattering with single-scattering albedo equal to unity. Consider unpolarized light and use the scalar approximation. The Sun-sensor geometry is fixed with solar zenith angle $\\theta_{0} = 30^{\\circ}$, sensor zenith angle $\\theta_{v} = 20^{\\circ}$, and relative azimuth $\\Delta \\varphi = 180^{\\circ}$ (backscattering plane). The scattering angle $\\Theta$ satisfies $\\cos \\Theta = \\cos \\theta_{0} \\cos \\theta_{v} + \\sin \\theta_{0} \\sin \\theta_{v} \\cos \\Delta \\varphi$. The Rayleigh phase function for unpolarized light is $P_{R}(\\Theta) = \\tfrac{3}{4}\\left(1 + \\cos^{2}\\Theta\\right)$.\n\nLet the vertical Rayleigh optical thickness at the reference wavelength $\\lambda_{0} = 0.55\\,\\mu\\text{m}$ be $\\tau_{0}$, and assume the leading-order spectral dependence $\\tau_{R}(\\lambda) = \\tau_{0} \\left(\\dfrac{\\lambda_{0}}{\\lambda}\\right)^{4}$. Let $\\mu_{0} = \\cos \\theta_{0}$ and $\\mu = \\cos \\theta_{v}$. The extraterrestrial spectral irradiance per unit wavelength is $E_{0}(\\lambda)$.\n\nStarting from the Beer–Lambert law and the scalar radiative transfer equation under the single-scattering approximation in a plane-parallel atmosphere:\n- Derive the downward and upward Rayleigh transmittances along the direct solar and sensor lines of sight, $T_{R,\\downarrow}(\\lambda)$ and $T_{R,\\uparrow}(\\lambda)$, in terms of $\\tau_{R}(\\lambda)$, $\\mu_{0}$, and $\\mu$.\n- Derive the first-order top-of-atmosphere path radiance $L_{p}(\\lambda)$ received by the sensor due to Rayleigh scattering of the direct solar beam, as a function of $E_{0}(\\lambda)$, $\\mu_{0}$, $\\mu$, $P_{R}(\\Theta)$, and $\\tau_{R}(\\lambda)$.\n\nThen, using the optically thin limit where $\\tau_{R}(\\lambda) \\ll 1$, evaluate the ratio\n$$\nR \\equiv \\frac{L_{p}(\\lambda_{1})/E_{0}(\\lambda_{1})}{L_{p}(\\lambda_{2})/E_{0}(\\lambda_{2})}\n$$\nfor $\\lambda_{1} = 0.44\\,\\mu\\text{m}$ and $\\lambda_{2} = 0.66\\,\\mu\\text{m}$, assuming $E_{0}(\\lambda_{1}) = E_{0}(\\lambda_{2})$ over this narrow visible range. Use degrees for all angles. Provide the numerical value of $R$ rounded to four significant figures, expressed as a dimensionless number.",
            "solution": "We begin from fundamental elements: the Beer–Lambert law for direct-beam attenuation in a plane-parallel atmosphere and the scalar radiative transfer equation under the single-scattering approximation. Let $\\mu_{0} = \\cos \\theta_{0}$ and $\\mu = \\cos \\theta_{v}$ denote the cosines of solar and view zenith angles, respectively. The vertical Rayleigh optical thickness is $\\tau_{R}(\\lambda) = \\tau_{0}\\left(\\dfrac{\\lambda_{0}}{\\lambda}\\right)^{4}$, which encodes the Rayleigh cross-section spectral scaling $\\propto \\lambda^{-4}$.\n\nDownward and upward transmittances:\n- Along the direct solar line of sight (downward), the direct-beam transmittance through a vertical optical thickness $\\tau_{R}(\\lambda)$ over a slant path characterized by $\\mu_{0}$ is given by the Beer–Lambert law:\n$$\nT_{R,\\downarrow}(\\lambda) = \\exp\\!\\left(-\\frac{\\tau_{R}(\\lambda)}{\\mu_{0}}\\right).\n$$\n- Along the sensor line of sight (upward) through the same vertical optical thickness but with slant path characterized by $\\mu$:\n$$\nT_{R,\\uparrow}(\\lambda) = \\exp\\!\\left(-\\frac{\\tau_{R}(\\lambda)}{\\mu}\\right).\n$$\n\nRayleigh phase function and scattering geometry:\nThe unpolarized Rayleigh phase function is\n$$\nP_{R}(\\Theta) = \\frac{3}{4}\\left(1 + \\cos^{2}\\Theta\\right),\n$$\nwith the scattering angle $\\Theta$ set by\n$$\n\\cos \\Theta = \\cos \\theta_{0}\\cos \\theta_{v} + \\sin \\theta_{0}\\sin \\theta_{v}\\cos \\Delta \\varphi.\n$$\nWith $\\theta_{0} = 30^{\\circ}$, $\\theta_{v} = 20^{\\circ}$, and $\\Delta \\varphi = 180^{\\circ}$ (so $\\cos \\Delta \\varphi = -1$), one obtains\n$$\n\\cos \\Theta = \\cos 30^{\\circ}\\cos 20^{\\circ} - \\sin 30^{\\circ}\\sin 20^{\\circ} = \\cos\\!\\left(50^{\\circ}\\right),\n$$\nso $\\Theta = 50^{\\circ}$. This angle is fixed by the geometry and is independent of wavelength, so $P_{R}(\\Theta)$ is constant with respect to $\\lambda$ for this geometry.\n\nSingle-scattering path radiance:\nUnder single scattering, the top-of-atmosphere path radiance $L_{p}(\\lambda)$ received by the sensor in direction $\\mu$ due to scattering of the direct solar beam can be derived by integrating the source term along the atmospheric column. Let $t$ be the vertical optical depth measured from the top of the atmosphere downward. The direct beam is attenuated to level $t$ by $\\exp\\!\\left(-\\dfrac{t}{\\mu_{0}}\\right)$, and the scattered radiance is then attenuated on the upward path from depth $t$ to space by $\\exp\\!\\left(-\\dfrac{t}{\\mu}\\right)$. The single-scattering source term includes the phase function factor and the normalization by $4\\pi$. The extraterrestrial spectral irradiance per unit wavelength is $E_{0}(\\lambda)$, so the collimated direct-beam irradiance projected onto a horizontal plane is $E_{0}(\\lambda)\\mu_{0}$. The single-scattering albedo for Rayleigh is unity. Therefore, the first-order path radiance at the top of the atmosphere is\n$$\nL_{p}(\\lambda) \\;=\\; E_{0}(\\lambda)\\,\\mu_{0}\\,\\frac{1}{4\\pi}\\,P_{R}(\\Theta)\\,\\int_{0}^{\\tau_{R}(\\lambda)} \\exp\\!\\left(-t\\left(\\frac{1}{\\mu_{0}} + \\frac{1}{\\mu}\\right)\\right)\\,\\mathrm{d}t.\n$$\nPerforming the integral yields\n$$\nL_{p}(\\lambda) \\;=\\; E_{0}(\\lambda)\\,\\mu_{0}\\,\\frac{1}{4\\pi}\\,P_{R}(\\Theta)\\,\\frac{1 - \\exp\\!\\left(-\\tau_{R}(\\lambda)\\left(\\frac{1}{\\mu_{0}} + \\frac{1}{\\mu}\\right)\\right)}{\\frac{1}{\\mu_{0}} + \\frac{1}{\\mu}}.\n$$\nDefine $S \\equiv \\dfrac{1}{\\mu_{0}} + \\dfrac{1}{\\mu}$ for compactness, so\n$$\nL_{p}(\\lambda) \\;=\\; E_{0}(\\lambda)\\,\\mu_{0}\\,\\frac{1}{4\\pi}\\,P_{R}(\\Theta)\\,\\frac{1 - \\exp\\!\\left(-\\tau_{R}(\\lambda) S\\right)}{S}.\n$$\n\nOptically thin limit and $\\lambda^{-4}$ dependence:\nIn the visible range for clear molecular atmospheres, the Rayleigh optical thickness can be sufficiently small that the optically thin approximation applies for the single-scattering contribution, i.e., $\\tau_{R}(\\lambda) S \\ll 1$. Using the expansion $\\exp(-x) \\approx 1 - x$ for small $x$, we obtain\n$$\n\\frac{1 - \\exp\\!\\left(-\\tau_{R}(\\lambda) S\\right)}{S} \\;\\approx\\; \\frac{\\tau_{R}(\\lambda) S}{S} \\;=\\; \\tau_{R}(\\lambda).\n$$\nThus\n$$\nL_{p}(\\lambda) \\;\\approx\\; E_{0}(\\lambda)\\,\\mu_{0}\\,\\frac{1}{4\\pi}\\,P_{R}(\\Theta)\\,\\tau_{R}(\\lambda).\n$$\nBecause $P_{R}(\\Theta)$, $\\mu_{0}$, and the geometry are independent of wavelength for the fixed observational setup, the spectral dependence of $L_{p}(\\lambda)$ in this limit is governed by $\\tau_{R}(\\lambda)$:\n$$\n\\frac{L_{p}(\\lambda)}{E_{0}(\\lambda)} \\;\\propto\\; \\tau_{R}(\\lambda) \\;=\\; \\tau_{0}\\left(\\frac{\\lambda_{0}}{\\lambda}\\right)^{4}.\n$$\n\nRequested ratio:\nWe are asked to evaluate\n$$\nR \\equiv \\frac{L_{p}(\\lambda_{1})/E_{0}(\\lambda_{1})}{L_{p}(\\lambda_{2})/E_{0}(\\lambda_{2})},\n$$\nfor $\\lambda_{1} = 0.44\\,\\mu\\text{m}$ and $\\lambda_{2} = 0.66\\,\\mu\\text{m}$, under the assumption $E_{0}(\\lambda_{1}) = E_{0}(\\lambda_{2})$. In the optically thin single-scattering limit,\n$$\nR \\;\\approx\\; \\frac{\\tau_{R}(\\lambda_{1})}{\\tau_{R}(\\lambda_{2})} \\;=\\; \\left(\\frac{\\lambda_{2}}{\\lambda_{1}}\\right)^{4}.\n$$\nSubstituting the wavelengths,\n$$\n\\frac{\\lambda_{2}}{\\lambda_{1}} \\;=\\; \\frac{0.66}{0.44} \\;=\\; 1.5,\n$$\nso\n$$\nR \\;=\\; (1.5)^{4} \\;=\\; 5.0625.\n$$\nRounded to four significant figures, the value is $5.063$.\n\nSummary of transmittances and path radiance expressions:\n- $T_{R,\\downarrow}(\\lambda) = \\exp\\!\\left(-\\dfrac{\\tau_{R}(\\lambda)}{\\mu_{0}}\\right)$,\n- $T_{R,\\uparrow}(\\lambda) = \\exp\\!\\left(-\\dfrac{\\tau_{R}(\\lambda)}{\\mu}\\right)$,\n- $L_{p}(\\lambda) \\approx E_{0}(\\lambda)\\,\\mu_{0}\\,\\dfrac{1}{4\\pi}\\,P_{R}(\\Theta)\\,\\tau_{R}(\\lambda)$ in the optically thin limit,\nand the visible-band spectral dependence is $\\propto \\lambda^{-4}$, as demonstrated by the computed ratio.",
            "answer": "$$\\boxed{5.063}$$"
        },
        {
            "introduction": "Atmospheric correction models often assume a horizontally uniform surface, but in reality, light scatters from bright areas into the field of view of adjacent dark targets, a phenomenon known as the adjacency effect. This practice () models this complex three-dimensional process using a linear systems framework based on an atmospheric Point Spread Function (PSF). By calculating the contamination of a dark pixel's signal by a bright neighbor, you will learn to quantify a significant source of error that, if ignored, leads to substantial overestimation of surface reflectance in heterogeneous environments.",
            "id": "3796553",
            "problem": "Consider a monochromatic remote sensing observation at wavelength $550\\,\\mathrm{nm}$ over a horizontal, plane-parallel atmosphere that is horizontally homogeneous. A dark target occupies the half-plane $\\{x0\\}$ with constant surface reflectance $\\rho_{\\mathrm{d}}=0.050$ (dimensionless), while a bright neighbor occupies the half-plane $\\{x0\\}$ with constant surface reflectance $\\rho_{\\mathrm{b}}=0.500$ (dimensionless). The sensor views near nadir, and the instrument’s optical blur is negligible compared to the atmospheric mixing. Assume surfaces are Lambertian and the atmosphere’s surface-to-sensor mapping of surface-exiting radiance is linear and described by a radially symmetric, normalized Point Spread Function (PSF), defined as\n$$\nh(r)=\\frac{1}{2\\pi\\sigma^{2}}\\exp\\!\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right),\n$$\nwhere $r$ is horizontal distance on the ground. The upward atmospheric transmittance along the line of sight is spatially uniform with value $T_{u}=0.80$. The ground-level downwelling irradiance at $550\\,\\mathrm{nm}$ is $E_{\\mathrm{d}}=1.20\\,\\mathrm{W\\,m^{-2}\\,nm^{-1}}$, and the wavelength-specific path radiance at the sensor is $L_{\\mathrm{path}}=0.010\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$. The PSF scale is $\\sigma=60\\,\\mathrm{m}$. Consider the dark pixel centered at position $(x_{0},y_{0})=(d,0)$ with $d=30\\,\\mathrm{m}$ from the bright–dark edge.\n\nUsing first-principles definitions for Lambertian radiance and linear atmospheric mixing, do the following:\n- Compute the adjacency radiance contribution at the sensor, $\\Delta L_{\\mathrm{adj}}$, at the dark pixel due solely to the bright half-plane $\\{x0\\}$, in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$.\n- Then quantify the apparent reflectance of the dark pixel, $\\rho_{\\mathrm{app}}$, that would be retrieved by an atmospheric correction algorithm which ignores adjacency and uses the inversion formula\n$$\n\\rho_{\\mathrm{app}}=\\frac{\\pi\\big(L_{\\mathrm{sensor}}-L_{\\mathrm{path}}\\big)}{T_{u}E_{\\mathrm{d}}},\n$$\nwhere $L_{\\mathrm{sensor}}$ is the total at-sensor radiance.\n\nExpress the final reported quantity as the dimensionless apparent reflectance $\\rho_{\\mathrm{app}}$ and round your answer to four significant figures. The computed $\\Delta L_{\\mathrm{adj}}$ must be shown in your work and expressed in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$, but do not include it in your final reported value.",
            "solution": "The total radiance at the sensor, $L_{\\mathrm{sensor}}$, is the sum of the atmospheric path radiance, $L_{\\mathrm{path}}$, and the surface-originating radiance that reaches the sensor, $L_{\\mathrm{sfc \\to sen}}$:\n$$\nL_{\\mathrm{sensor}} = L_{\\mathrm{path}} + L_{\\mathrm{sfc \\to sen}}\n$$\nThe surface is Lambertian, so the radiance exiting the surface at any point $(x,y)$ is given by $L_{\\mathrm{sfc}}(x,y) = \\frac{\\rho(x,y)E_{\\mathrm{d}}}{\\pi}$. The surface reflectance field $\\rho(x,y)$ is a step function:\n$$\n\\rho(x,y) = \\begin{cases} \\rho_{\\mathrm{b}}  \\text{if } x  0 \\\\ \\rho_{\\mathrm{d}}  \\text{if } x \\ge 0 \\end{cases}\n$$\nThe surface-originating radiance at the sensor is obtained by convolving the surface-exiting radiance field $L_{\\mathrm{sfc}}(x,y)$ with the atmospheric Point Spread Function (PSF) $h(r)$, and then attenuating by the upward transmittance $T_{u}$. For a pixel centered at $(x_0, y_0)$:\n$$\nL_{\\mathrm{sfc \\to sen}}(x_0, y_0) = T_u \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} L_{\\mathrm{sfc}}(x,y) h(x_0 - x, y_0 - y) \\,dx\\,dy\n$$\nWe can decompose the surface reflectance field into a uniform background of the target's reflectance, $\\rho_{\\mathrm{d}}$, and a perturbation term: $\\rho(x,y) = \\rho_{\\mathrm{d}} + (\\rho_{\\mathrm{b}} - \\rho_{\\mathrm{d}})$ for $x0$ and $\\rho(x,y) = \\rho_{\\mathrm{d}}$ for $x \\ge 0$. The corresponding radiance field decomposition is $L_{\\mathrm{sfc}}(x,y) = \\frac{\\rho_{\\mathrm{d}}E_{\\mathrm{d}}}{\\pi} + \\Delta L(x,y)$, where $\\Delta L(x,y) = \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{\\pi}$ for $x0$ and $0$ otherwise.\nSubstituting this into the convolution integral:\n$$\nL_{\\mathrm{sfc \\to sen}} = T_u \\int\\int \\left( \\frac{\\rho_{\\mathrm{d}}E_{\\mathrm{d}}}{\\pi} \\right) h \\,dx\\,dy + T_u \\int_{x0}\\int \\left( \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{\\pi} \\right) h \\,dx\\,dy\n$$\nSince the PSF $h$ is normalized, its integral over the entire domain is $1$. The first term represents the radiance from a uniform surface of reflectance $\\rho_{\\mathrm{d}}$, which is $T_u \\frac{\\rho_{\\mathrm{d}}E_{\\mathrm{d}}}{\\pi}$. The second term is the adjacency radiance contribution, $\\Delta L_{\\mathrm{adj}}$, due to the excess brightness of the neighboring half-plane.\n$$\n\\Delta L_{\\mathrm{adj}} = T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{\\pi} \\int_{x=-\\infty}^{0} \\int_{y=-\\infty}^{\\infty} h(x_0-x, y_0-y) \\,dy\\,dx\n$$\nWe are given $h(r) = \\frac{1}{2\\pi\\sigma^{2}}\\exp(-\\frac{r^{2}}{2\\sigma^{2}})$ with $r^2=(x_0-x)^2+(y_0-y)^2$. The pixel is at $(x_0, y_0) = (d,0)$.\n$$\n\\Delta L_{\\mathrm{adj}} = T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{\\pi} \\frac{1}{2\\pi\\sigma^2} \\int_{-\\infty}^{0} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{(d-x)^2 + y^2}{2\\sigma^2}\\right) \\,dy\\,dx\n$$\nFirst, we evaluate the integral over $y$: $\\int_{-\\infty}^{\\infty} \\exp(-\\frac{y^2}{2\\sigma^2}) \\,dy = \\sqrt{2\\pi\\sigma^2} = \\sigma\\sqrt{2\\pi}$.\n$$\n\\Delta L_{\\mathrm{adj}} = T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{\\pi} \\frac{\\sigma\\sqrt{2\\pi}}{2\\pi\\sigma^2} \\int_{-\\infty}^{0} \\exp\\left(-\\frac{(x-d)^2}{2\\sigma^2}\\right) \\,dx\n$$\n$$\n\\Delta L_{\\mathrm{adj}} = T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{\\pi} \\frac{1}{\\sigma\\sqrt{2\\pi}} \\int_{-\\infty}^{0} \\exp\\left(-\\frac{(x-d)^2}{2\\sigma^2}\\right) \\,dx\n$$\nLet $v = \\frac{x-d}{\\sigma}$. The integral becomes $\\sigma \\int_{-\\infty}^{-d/\\sigma} \\exp(-\\frac{v^2}{2}) \\,dv$. This integral is related to the complementary error function, $\\mathrm{erfc}(z) = \\frac{2}{\\sqrt{\\pi}}\\int_z^{\\infty} \\exp(-t^2)dt$.\nLet $t = v/\\sqrt{2}$. The integral is $\\sigma\\sqrt{2}\\int_{-\\infty}^{-d/(\\sigma\\sqrt{2})} \\exp(-t^2)dt$.\nUsing the property $\\int_{-\\infty}^{-a} \\exp(-t^2)dt = \\int_{a}^{\\infty} \\exp(-t^2)dt = \\frac{\\sqrt{\\pi}}{2}\\mathrm{erfc}(a)$, the integral evaluates to $\\sigma\\sqrt{2} \\frac{\\sqrt{\\pi}}{2}\\mathrm{erfc}(\\frac{d}{\\sigma\\sqrt{2}})$.\nSubstituting this back:\n$$\n\\Delta L_{\\mathrm{adj}} = T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{\\pi} \\frac{1}{\\sigma\\sqrt{2\\pi}} \\left(\\sigma\\sqrt{2\\pi} \\frac{1}{2} \\mathrm{erfc}\\left(\\frac{d}{\\sigma\\sqrt{2}}\\right)\\right)\n$$\n$$\n\\Delta L_{\\mathrm{adj}} = T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{2\\pi} \\mathrm{erfc}\\left(\\frac{d}{\\sqrt{2}\\sigma}\\right)\n$$\nNow we compute the numerical value for $\\Delta L_{\\mathrm{adj}}$.\nThe argument of the erfc function is $z = \\frac{d}{\\sqrt{2}\\sigma} = \\frac{30}{\\sqrt{2} \\times 60} = \\frac{1}{2\\sqrt{2}} = \\frac{\\sqrt{2}}{4} \\approx 0.35355$.\nUsing a standard library, $\\mathrm{erfc}(0.35355339...) \\approx 0.61707513$.\nThe pre-factor is $T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{2\\pi} = 0.80 \\times \\frac{(0.500-0.050) \\times 1.20}{2\\pi} = \\frac{0.80 \\times 0.450 \\times 1.20}{2\\pi} = \\frac{0.432}{2\\pi}$.\n$$\n\\Delta L_{\\mathrm{adj}} = \\frac{0.432}{2\\pi} \\times 0.61707513 \\approx 0.0424275\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}\n$$\nThis is the first required quantity. Now, we compute the apparent reflectance $\\rho_{\\mathrm{app}}$.\nThe total radiance at the sensor is $L_{\\mathrm{sensor}} = L_{\\mathrm{path}} + L_{\\mathrm{sfc \\to sen}}$, where $L_{\\mathrm{sfc \\to sen}} = T_u \\frac{\\rho_{\\mathrm{d}}E_{\\mathrm{d}}}{\\pi} + \\Delta L_{\\mathrm{adj}}$.\nThe apparent reflectance is given by $\\rho_{\\mathrm{app}}=\\frac{\\pi(L_{\\mathrm{sensor}}-L_{\\mathrm{path}})}{T_{u}E_{\\mathrm{d}}}$.\nSubstituting for $L_{\\mathrm{sensor}}$, we get $\\rho_{\\mathrm{app}}=\\frac{\\pi(L_{\\mathrm{path}} + L_{\\mathrm{sfc \\to sen}}-L_{\\mathrm{path}})}{T_{u}E_{\\mathrm{d}}} = \\frac{\\pi L_{\\mathrm{sfc \\to sen}}}{T_{u}E_{\\mathrm{d}}}$.\nNow, we substitute the expression for $L_{\\mathrm{sfc \\to sen}}$:\n$$\n\\rho_{\\mathrm{app}} = \\frac{\\pi}{T_u E_d} \\left( T_u \\frac{\\rho_{\\mathrm{d}}E_{\\mathrm{d}}}{\\pi} + \\Delta L_{\\mathrm{adj}} \\right) = \\rho_{\\mathrm{d}} + \\frac{\\pi \\Delta L_{\\mathrm{adj}}}{T_u E_d}\n$$\nSubstituting the expression for $\\Delta L_{\\mathrm{adj}}$:\n$$\n\\rho_{\\mathrm{app}} = \\rho_{\\mathrm{d}} + \\frac{\\pi}{T_u E_d} \\left( T_u \\frac{(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}})E_{\\mathrm{d}}}{2\\pi} \\mathrm{erfc}\\left(\\frac{d}{\\sqrt{2}\\sigma}\\right) \\right)\n$$\n$$\n\\rho_{\\mathrm{app}} = \\rho_{\\mathrm{d}} + \\frac{1}{2}(\\rho_{\\mathrm{b}}-\\rho_{\\mathrm{d}}) \\mathrm{erfc}\\left(\\frac{d}{\\sqrt{2}\\sigma}\\right)\n$$\nThis elegant result shows that the apparent reflectance is the true target reflectance plus an error term proportional to the reflectance contrast and a factor describing the geometric configuration and atmospheric blur.\nPlugging in the numerical values:\n$$\n\\rho_{\\mathrm{app}} = 0.050 + \\frac{1}{2}(0.500-0.050) \\times \\mathrm{erfc}\\left(\\frac{30}{\\sqrt{2} \\times 60}\\right)\n$$\n$$\n\\rho_{\\mathrm{app}} = 0.050 + 0.225 \\times \\mathrm{erfc}\\left(\\frac{\\sqrt{2}}{4}\\right)\n$$\n$$\n\\rho_{\\mathrm{app}} = 0.050 + 0.225 \\times 0.61707513...\n$$\n$$\n\\rho_{\\mathrm{app}} = 0.050 + 0.13884190...\n$$\n$$\n\\rho_{\\mathrm{app}} = 0.18884190...\n$$\nRounding to four significant figures, the apparent reflectance is $0.1888$. Due to the adjacency effect, the sensor \"sees\" the dark pixel as being significantly brighter than its true reflectance of $0.050$.",
            "answer": "$$\\boxed{0.1888}$$"
        },
        {
            "introduction": "The ultimate goal of modeling atmospheric radiative transfer is often to invert the process: to retrieve atmospheric properties from a measured satellite signal. This requires understanding how sensitive the top-of-atmosphere radiance is to changes in each atmospheric constituent. This exercise () bridges the gap between forward modeling and practical inversion by having you compute the Jacobian matrix from a pre-computed Lookup Table (LUT). By calculating these partial derivatives numerically, you will gain insight into the core mechanism of many retrieval algorithms, which use these sensitivities to iteratively solve for aerosol optical thickness, water vapor, and other key parameters.",
            "id": "3796627",
            "problem": "A passive multispectral satellite sensor measures top-of-atmosphere (TOA) spectral radiance $L_{\\lambda}$ at wavelength $\\lambda = 0.86\\,\\mu\\mathrm{m}$ over a horizontally homogeneous Lambertian surface with reflectance $\\rho_{s} = 0.20$. The TOA spectral radiance $L_{\\lambda}$ is a differentiable function of the atmospheric state parameters aerosol optical thickness $\\tau_{a}$, column water vapor $w$ (in $\\mathrm{cm}$ of precipitable water), and solar zenith angle $\\theta_{0}$ (in radians): $L_{\\lambda} = \\mathcal{R}(\\tau_{a}, w, \\theta_{0}; \\rho_{s}, \\mathrm{geom})$, where $\\mathcal{R}$ denotes the radiative transfer operator and $\\mathrm{geom}$ denotes fixed viewing geometry (view zenith angle $\\theta_{v} = 0^{\\circ}$ and relative azimuth $\\phi = 0^{\\circ}$). A high-fidelity radiative transfer model was used to generate a Lookup Table (LUT) of $L_{\\lambda}$ values at the following triplet of operating points centered at $(\\tau_{a}, w, \\theta_{0}) = (0.12, 1.7\\,\\mathrm{cm}, 32^{\\circ})$:\n- At fixed $w = 1.7\\,\\mathrm{cm}$ and $\\theta_{0} = 32^{\\circ}$: $L_{\\lambda}(0.10, 1.7, 32^{\\circ}) = 51.60\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$, $L_{\\lambda}(0.12, 1.7, 32^{\\circ}) = 52.30\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$, $L_{\\lambda}(0.14, 1.7, 32^{\\circ}) = 53.10\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$.\n- At fixed $\\tau_{a} = 0.12$ and $\\theta_{0} = 32^{\\circ}$: $L_{\\lambda}(0.12, 1.5\\,\\mathrm{cm}, 32^{\\circ}) = 52.50\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$, $L_{\\lambda}(0.12, 1.7\\,\\mathrm{cm}, 32^{\\circ}) = 52.30\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$, $L_{\\lambda}(0.12, 1.9\\,\\mathrm{cm}, 32^{\\circ}) = 52.10\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$.\n- At fixed $\\tau_{a} = 0.12$ and $w = 1.7\\,\\mathrm{cm}$: $L_{\\lambda}(0.12, 1.7\\,\\mathrm{cm}, 30^{\\circ}) = 53.00\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$, $L_{\\lambda}(0.12, 1.7\\,\\mathrm{cm}, 32^{\\circ}) = 52.30\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$, $L_{\\lambda}(0.12, 1.7\\,\\mathrm{cm}, 34^{\\circ}) = 51.65\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$.\n\nUsing only the LUT values above and the fundamental definition of a derivative as a limit of difference quotients, approximate the Jacobian entries $\\frac{\\partial L_{\\lambda}}{\\partial \\tau_{a}}$, $\\frac{\\partial L_{\\lambda}}{\\partial w}$, and $\\frac{\\partial L_{\\lambda}}{\\partial \\theta_{0}}$ at the central state $(0.12, 1.7\\,\\mathrm{cm}, 32^{\\circ})$ via second-order central differences. Treat $\\theta_{0}$ in radians when forming the derivative with respect to $\\theta_{0}$. Express each derivative in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$ per unit of the respective variable (per radian for $\\theta_{0}$). Round your three Jacobian entries to four significant figures. Provide your final answer as a single row matrix containing $\\left( \\frac{\\partial L_{\\lambda}}{\\partial \\tau_{a}}, \\frac{\\partial L_{\\lambda}}{\\partial w}, \\frac{\\partial L_{\\lambda}}{\\partial \\theta_{0}} \\right)$.\n\nIn your solution, explain from first principles how such Jacobians are computed from a Lookup Table (LUT) and briefly discuss how these Jacobians are used in inversion of atmospheric parameters in remote sensing.",
            "solution": "The core of this problem is the numerical approximation of partial derivatives of the top-of-atmosphere (TOA) spectral radiance function, $L_{\\lambda}(\\tau_{a}, w, \\theta_{0})$, with respect to its state variables. The collection of these partial derivatives forms the Jacobian of the system, which quantifies the sensitivity of the measured radiance to changes in the atmospheric state.\n\nFrom first principles, the partial derivative of a multivariable function $f(x_1, x_2, ..., x_n)$ with respect to one of its variables, say $x_i$, at a point $\\mathbf{a} = (a_1, a_2, ..., a_n)$ is defined by the limit:\n$$\n\\frac{\\partial f}{\\partial x_i}\\bigg|_{\\mathbf{a}} = \\lim_{h \\to 0} \\frac{f(a_1, ..., a_i + h, ..., a_n) - f(a_1, ..., a_i, ..., a_n)}{h}\n$$\nIn practical applications such as remote sensing, the function $L_{\\lambda}$ is often too complex to be differentiated analytically. Instead, its values are pre-computed using a high-fidelity radiative transfer model for a discrete grid of input parameters, forming a Lookup Table (LUT). The derivatives can then be approximated from these discrete values using finite difference formulas.\n\nThe problem specifies the use of a second-order central difference approximation. For a single-variable function $g(x)$, the derivative at $x_0$ is approximated as:\n$$\ng'(x_0) \\approx \\frac{g(x_0 + h) - g(x_0 - h)}{2h}\n$$\nThis formula is derived from the Taylor series expansions of $g(x_0+h)$ and $g(x_0-h)$ and has a truncation error of order $h^2$, denoted $O(h^2)$, making it more accurate than first-order forward or backward differences, whose errors are $O(h)$.\n\nTo find the Jacobian entries, we apply this formula to $L_{\\lambda}$ for each variable, holding the other variables constant at the central operating point $(\\tau_{a,c}, w_c, \\theta_{0,c}) = (0.12, 1.7\\,\\mathrm{cm}, 32^{\\circ})$.\n\nThe Jacobian (in this scalar function case, the gradient row vector) is given by:\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial L_{\\lambda}}{\\partial \\tau_{a}}  \\frac{\\partial L_{\\lambda}}{\\partial w}  \\frac{\\partial L_{\\lambda}}{\\partial \\theta_{0}} \\end{pmatrix}\n$$\nThese Jacobians are fundamental to inversion algorithms (e.g., in atmospheric correction) which seek to retrieve the atmospheric state vector $\\mathbf{x} = (\\tau_a, w, \\theta_0)^T$ from a measured radiance $L_{\\lambda}^{\\text{obs}}$. Many inversion methods are iterative and rely on linearizing the radiative transfer model $\\mathcal{R}$ around a current guess $\\mathbf{x}_k$:\n$$\nL_{\\lambda}(\\mathbf{x}) \\approx L_{\\lambda}(\\mathbf{x}_k) + \\mathbf{J}(\\mathbf{x}_k) (\\mathbf{x} - \\mathbf{x}_k)\n$$\nThe algorithm then solves for an update step $\\Delta\\mathbf{x} = \\mathbf{x} - \\mathbf{x}_k$ that minimizes the discrepancy $|L_{\\lambda}^{\\text{obs}} - L_{\\lambda}(\\mathbf{x})|$. The Jacobian $\\mathbf{J}$ is the critical component that relates changes in radiance to changes in the state parameters, thus guiding the solution toward the true atmospheric state.\n\nWe now compute the three Jacobian entries using the provided LUT data.\n\n1.  **Partial derivative with respect to aerosol optical thickness $\\tau_{a}$**:\n    The central point is $\\tau_{a,c} = 0.12$. The LUT provides values for a perturbation of $h_{\\tau_a} = 0.02$. The other parameters are fixed at $w = 1.7\\,\\mathrm{cm}$ and $\\theta_0 = 32^{\\circ}$.\n    The required radiance values are:\n    $L_{\\lambda}(\\tau_{a,c} + h_{\\tau_a}) = L_{\\lambda}(0.14, 1.7, 32^{\\circ}) = 53.10\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$\n    $L_{\\lambda}(\\tau_{a,c} - h_{\\tau_a}) = L_{\\lambda}(0.10, 1.7, 32^{\\circ}) = 51.60\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$\n    Applying the central difference formula:\n    $$\n    \\frac{\\partial L_{\\lambda}}{\\partial \\tau_{a}} \\approx \\frac{L_{\\lambda}(0.14, ...) - L_{\\lambda}(0.10, ...)}{2 h_{\\tau_a}} = \\frac{53.10 - 51.60}{2 \\times 0.02} = \\frac{1.50}{0.04} = 37.5\n    $$\n    Rounding to four significant figures gives $37.50\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$.\n\n2.  **Partial derivative with respect to column water vapor $w$**:\n    The central point is $w_c = 1.7\\,\\mathrm{cm}$. The LUT provides values for a perturbation of $h_w = 0.2\\,\\mathrm{cm}$. The other parameters are fixed at $\\tau_a = 0.12$ and $\\theta_0 = 32^{\\circ}$.\n    The required radiance values are:\n    $L_{\\lambda}(w_c + h_w) = L_{\\lambda}(0.12, 1.9, 32^{\\circ}) = 52.10\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$\n    $L_{\\lambda}(w_c - h_w) = L_{\\lambda}(0.12, 1.5, 32^{\\circ}) = 52.50\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$\n    Applying the central difference formula:\n    $$\n    \\frac{\\partial L_{\\lambda}}{\\partial w} \\approx \\frac{L_{\\lambda}(..., 1.9, ...) - L_{\\lambda}(..., 1.5, ...)}{2 h_w} = \\frac{52.10 - 52.50}{2 \\times 0.2} = \\frac{-0.40}{0.4} = -1.0\n    $$\n    Rounding to four significant figures gives $-1.000\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}\\,cm^{-1}}$.\n\n3.  **Partial derivative with respect to solar zenith angle $\\theta_{0}$**:\n    The central point is $\\theta_{0,c} = 32^{\\circ}$. The perturbation is $h_{\\theta_0, \\text{deg}} = 2^{\\circ}$. The problem requires the derivative with respect to $\\theta_0$ in radians. We must convert the perturbation step $h_{\\theta_0}$ to radians.\n    $$\n    h_{\\theta_0, \\text{rad}} = 2^{\\circ} \\times \\frac{\\pi}{180^{\\circ}} = \\frac{\\pi}{90}\\,\\text{radians}\n    $$\n    The other parameters are fixed at $\\tau_a = 0.12$ and $w = 1.7\\,\\mathrm{cm}$.\n    The required radiance values are:\n    $L_{\\lambda}(\\theta_{0,c} + h_{\\theta_0}) = L_{\\lambda}(..., 34^{\\circ}) = 51.65\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$\n    $L_{\\lambda}(\\theta_{0,c} - h_{\\theta_0}) = L_{\\lambda}(..., 30^{\\circ}) = 53.00\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$\n    Applying the central difference formula with the denominator in radians:\n    $$\n    \\frac{\\partial L_{\\lambda}}{\\partial \\theta_{0}} \\approx \\frac{L_{\\lambda}(..., 34^{\\circ}) - L_{\\lambda}(..., 30^{\\circ})}{2 h_{\\theta_0, \\text{rad}}} = \\frac{51.65 - 53.00}{2 \\times \\frac{\\pi}{90}} = \\frac{-1.35}{\\frac{\\pi}{45}} = \\frac{-60.75}{\\pi} \\approx -19.3364...\n    $$\n    Rounding to four significant figures gives $-19.34\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}\\,rad^{-1}}$.\n\nThe approximated Jacobian entries at the central point are $(37.50, -1.000, -19.34)$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 37.50  -1.000  -19.34 \\end{pmatrix}}\n$$"
        }
    ]
}