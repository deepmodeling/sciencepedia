{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的数据驱动增强技术之前，掌握线性对比度拉伸的基础至关重要。本练习 () 提供了一个将高位深度传感器数据重新映射到标准显示范围的实践场景，要求您推导精确的线性变换系数。完成此练习将巩固您对动态范围操控和图像显示基础数学的理解。",
            "id": "3802072",
            "problem": "一幅经过校准的机载多光谱图像有一个单波段被量化为 $10$ 位，因此每个数字值 (DN) $x$ 位于整数集合 $\\{0,1,\\dots,1023\\}$ 中。为了在环境建模工作流中进行可视化，该波段必须被线性对比度拉伸到一个具有 $L'=256$ 个输出级别的 $8$ 位显示范围。为避免过度强调异常值，线性拉伸锚定于经验估计的场景下界 $x_{\\min}=120$ 和上界 $x_{\\max}=1023$，使得该变换将 $x_{\\min}$ 映射到最暗的输出级别，并将 $x_{\\max}$ 映射到最亮的输出级别。显示映射实现为整数值函数 $y=\\mathrm{round}(a x + b)$，其中 $\\mathrm{round}(\\cdot)$ 表示四舍五入到最近的整数。\n\n从量化、动态范围和保持 DN 排序并完全占据目标范围的线性映射的核心定义出发，推导在模型 $y=\\mathrm{round}(a x + b)$ 下满足端点约束 $y(x_{\\min})=0$ 和 $y(x_{\\max})=L'-1$ 的系数 $a$ 和 $b$。然后，在 $x=512$ 处评估得到的映射以确定 $y$。\n\n将 $a$ 和 $b$ 表示为精确分数形式，将 $y$ 表示为整数。将您的最终结果以行矩阵的形式提供，其中的条目按 $a, b, y$ 的顺序排列。除了 $\\mathrm{round}(\\cdot)$ 函数之外，不需要进行其他舍入，也不涉及物理单位。",
            "solution": "该问题定义明确，科学上合理，并包含唯一解所需的所有信息。量化、数字值（DN）和线性对比度拉伸的概念是数字图像处理和遥感领域的标准概念。该问题是有效的。\n\n任务是确定线性映射的系数 $a$ 和 $b$，然后将此映射应用于特定的输入值。该映射根据函数 $y = \\mathrm{round}(ax + b)$ 将输入 DN 值 $x$ 转换为输出级别 $y$，其中 $\\mathrm{round}(\\cdot)$ 表示四舍五入到最近的整数。\n\n输入 DN 值 $x$ 来自一个 $10$ 位传感器，因此其范围从 $0$ 到 $2^{10}-1 = 1023$。输出范围用于一个 $8$ 位显示器，有 $L' = 256$ 个级别，从 $0$ 到 $255$。线性拉伸通过将输入范围钳制在指定的边界 $x_{\\min} = 120$ 和 $x_{\\max} = 1023$ 来定义。\n\n端点约束条件是 $x_{\\min}$ 映射到最暗的输出级别（$0$），$x_{\\max}$ 映射到最亮的输出级别（$L'-1 = 255$）。形式上，这给了我们：\n$1.$ $y(x_{\\min}) = \\mathrm{round}(a \\cdot x_{\\min} + b) = 0$\n$2.$ $y(x_{\\max}) = \\mathrm{round}(a \\cdot x_{\\max} + b) = L' - 1$\n\n满足这些约束的一个标准且稳健的方法是，设置函数的线性部分（我们称之为 $y'(x) = ax+b$）在四舍五入之前将端点精确映射到目标整数值。由于 $\\mathrm{round}(0) = 0$ 和 $\\mathrm{round}(255) = 255$，这种方法与问题陈述一致。\n因此，我们求解以下二元一次方程组：\n$1.$ $a \\cdot x_{\\min} + b = 0$\n$2.$ $a \\cdot x_{\\max} + b = L' - 1$\n\n代入给定值 $x_{\\min} = 120$、$x_{\\max} = 1023$ 和 $L' = 256$：\n$1.$ $a \\cdot 120 + b = 0$\n$2.$ $a \\cdot 1023 + b = 255$\n\n为了求系数 $a$，我们将第二个方程减去第一个方程：\n$$a \\cdot 1023 + b - (a \\cdot 120 + b) = 255 - 0$$\n$$a(1023 - 120) = 255$$\n$$a(903) = 255$$\n$$a = \\frac{255}{903}$$\n为了化简这个分数，我们求分子和分母的最大公约数。$255$ 的各位数字之和是 $2+5+5=12$，$903$ 的各位数字之和是 $9+0+3=12$，所以两者都能被 $3$ 整除。\n$$a = \\frac{255 \\div 3}{903 \\div 3} = \\frac{85}{301}$$\n分子的质因数分解是 $85 = 5 \\times 17$。分母 $301$ 不能被 $5$ 整除。检查是否能被 $17$ 整除，我们发现 $301 = 17 \\times 17.7...$，所以它不能被 $17$ 整除。让我们检查 $301$ 的其他小质因数：$301 \\div 7 = 43$。所以，$301 = 7 \\times 43$。$85$ 和 $301$ 之间没有公因数。因此，该分数已是最简形式。\n$$a = \\frac{85}{301}$$\n现在，我们使用第一个方程 $b = -120a$ 来求系数 $b$：\n$$b = -120 \\left(\\frac{85}{301}\\right) = -\\frac{120 \\times 85}{301} = -\\frac{10200}{301}$$\n这个分数也已是最简形式，因为 $10200 = 102 \\times 100 = (2 \\times 3 \\times 17) \\times (10^2)$ 与 $301 = 7 \\times 43$ 没有共同的质因数。\n\n系数为 $a=\\frac{85}{301}$ 和 $b=-\\frac{10200}{301}$。\n\n最后一步是计算输入 DN 值为 $x = 512$ 时的输出值 $y$。\n$$y(512) = \\mathrm{round}(a \\cdot 512 + b)$$\n$$y(512) = \\mathrm{round}\\left(\\frac{85}{301} \\cdot 512 - \\frac{10200}{301}\\right)$$\n$$y(512) = \\mathrm{round}\\left(\\frac{85 \\times 512 - 10200}{301}\\right)$$\n首先，我们计算分子：\n$$85 \\times 512 = 43520$$\n$$y(512) = \\mathrm{round}\\left(\\frac{43520 - 10200}{301}\\right) = \\mathrm{round}\\left(\\frac{33320}{301}\\right)$$\n现在我们进行除法运算：\n$$\\frac{33320}{301} \\approx 110.69767...$$\n将该值四舍五入到最近的整数：\n$$y(512) = \\mathrm{round}(110.69767...) = 111$$\n对于 $x=512$，得到的映射值为 $111$。\n\n所要求的三个值是系数 $a$、系数 $b$ 和映射值 $y$。\n$a = \\frac{85}{301}$\n$b = -\\frac{10200}{301}$\n$y = 111$",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{85}{301} & -\\frac{10200}{301} & 111 \\end{pmatrix}}$$"
        },
        {
            "introduction": "与线性拉伸不同，直方图均衡化是一种强大的非线性技术，它利用图像自身的统计分布来优化对比度。本练习 () 将指导您完成从给定直方图计算均衡化值的完整步骤，包括计算累积计数和应用基于累积分布函数 (CDF) 的映射函数。此练习揭示了最常见的自动对比度增强方法之一背后的工作机制。",
            "id": "3802113",
            "problem": "一台用于植被冠层遥感的机载多光谱成像辐射计在进行机载线性量化后，将辐射亮度记录为8位数字数（DN）。在环境建模工作流中，一个常见的预处理步骤是全局直方图均衡化，用以增强对比度，同时保持DN值的顺序。考虑一条航线的一个小子集，在单个波段中仅存在以下DN值及其对应的像素数（其余256个可能的DN值均未出现在此子集中）：\n\n- $DN=12$ 有 $184$ 个像素。\n- $DN=35$ 有 $792$ 个像素。\n- $DN=87$ 有 $115$ 个像素。\n- $DN=123$ 有 $58$ 个像素。\n- $DN=156$ 有 $1610$ 个像素。\n- $DN=201$ 有 $927$ 个像素。\n- $DN=245$ 有 $1214$ 个像素。\n\n假设对该子集应用全局直方图均衡化，输出动态范围为 $L'=256$ 个灰度级，并将由所列计数形成的经验分布视为图像直方图。仅使用直方图、累积分布以及由归一化累积分布定义的单调映射的定义，完成以下操作：\n\n- 按DN值升序计算所列灰度级的累积计数。\n- 从第一性原理出发，基于累积分布推导离散均衡化映射，并应用该映射计算每个所列DN灰度级的均衡化输出灰度级。\n\n最后，报告$DN=201$灰度级的均衡化输出灰度级，作为您唯一的数值答案。最终答案是一个整数灰度级；除了均衡化映射中固有的常规舍入外，不需要指定单位或进行有效数字舍入。",
            "solution": "该问题要求基于一个遥感图像子集的稀疏直方图，为一个特定的输入数字数（DN）计算其均衡化后的输出DN。该过程涉及直方图均衡化，这是图像处理中用于增强对比度的一种标准技术。\n\n首先，我们必须从第一性原理出发，通过定义直方图均衡化的各个组成部分来将问题形式化。\n\n设图像中存在的DN值集合为 $\\{r_j\\}$，其中 $j$ 是不同且有序的灰度级的索引。设 $n(r_j)$ 为每个灰度级 $r_j$ 的像素数（像素计数）。图像被描述为8位，因此完整的动态范围是 $L=256$ 个灰度级，从0到255。问题指定输出动态范围为 $L' = 256$ 个灰度级，这对应于输出范围 $[0, 255]$。\n\n图像子集中的总像素数 $N$ 是所有像素数的总和：\n$$N = \\sum_{j} n(r_j)$$\n\n非零DN灰度级的给定数据如下：\n- $r_1 = 12$, $n(r_1) = 184$\n- $r_2 = 35$, $n(r_2) = 792$\n- $r_3 = 87$, $n(r_3) = 115$\n- $r_4 = 123$, $n(r_4) = 58$\n- $r_5 = 156$, $n(r_5) = 1610$\n- $r_6 = 201$, $n(r_6) = 927$\n- $r_7 = 245$, $n(r_7) = 1214$\n\n首先，我们计算总像素数 $N$：\n$$N = 184 + 792 + 115 + 58 + 1610 + 927 + 1214 = 4900$$\n\n接下来，按要求计算累积计数。对于给定的DN值 $r_k$，其累积计数记为 $C(r_k)$，是所有小于或等于 $r_k$ 的灰度级的像素数之和。\n$$C(r_k) = \\sum_{j: r_j \\le r_k} n(r_j)$$\n\n我们按升序为每个存在的DN值计算累积计数：\n- 对于 $r_1=12$：$C(12) = n(12) = 184$\n- 对于 $r_2=35$：$C(35) = n(12) + n(35) = 184 + 792 = 976$\n- 对于 $r_3=87$：$C(87) = C(35) + n(87) = 976 + 115 = 1091$\n- 对于 $r_4=123$：$C(123) = C(87) + n(123) = 1091 + 58 = 1149$\n- 对于 $r_5=156$：$C(156) = C(123) + n(156) = 1149 + 1610 = 2759$\n- 对于 $r_6=201$：$C(201) = C(156) + n(201) = 2759 + 927 = 3686$\n- 对于 $r_7=245$：$C(245) = C(201) + n(245) = 3686 + 1214 = 4900$\n\n最高DN值的累积计数等于总像素数 $N$，这可作为一致性检查。\n\n直方图均衡化的原理是应用一个单调映射 $T(r)$，将输入像素灰度级 $r$ 转换为输出灰度级 $s$，使得输出灰度级的直方图尽可能平坦（均匀）。对于离散灰度级，此变换使用归一化累积分布函数（CDF）来定义。在灰度级 $r_k$ 处的CDF由 $C(r_k)/N$ 给出。映射函数将此CDF缩放到新的动态范围 $[0, L'-1]$。\n\n因此，离散均衡化映射为：\n$$s_k = T(r_k) = \\text{round}\\left( (L' - 1) \\times \\frac{C(r_k)}{N} \\right)$$\n其中 `round` 表示四舍五入到最接近的整数。\n\n给定 $L' = 256$，最大输出灰度级为 $L'-1 = 255$。总像素数为 $N=4900$。变换公式变为：\n$$s_k = \\text{round}\\left( 255 \\times \\frac{C(r_k)}{4900} \\right)$$\n\n问题要求计算 $DN=201$ 灰度级的均衡化输出灰度级。我们使用输入灰度级 $r_k = 201$。根据我们之前的计算，该灰度级的累积计数为 $C(201) = 3686$。\n\n将这些值代入变换函数中：\n$$s_{201} = \\text{round}\\left( 255 \\times \\frac{3686}{4900} \\right)$$\n\n我们进行计算：\n$$s_{201} = \\text{round}\\left( 255 \\times 0.75224489... \\right)$$\n$$s_{201} = \\text{round}\\left( 191.82244897... \\right)$$\n\n应用常规的四舍五入到最接近的整数，我们得到：\n$$s_{201} = 192$$\n\n因此，经过直方图均衡化后，输入DN值201被映射到输出DN值192。",
            "answer": "$$\\boxed{192}$$"
        },
        {
            "introduction": "在真实的遥感应用中，图像常常包含代表云、阴影或掩膜区域的“无数据”像素。这个高级练习 () 挑战您批判性地思考数据完整性问题，通过量化在基于直方图的计算中不当包含此类特殊值所引入的偏差。通过推导期望误差，您将深刻体会到在任何稳健的处理流程中，进行掩膜处理的必要性。",
            "id": "3802037",
            "problem": "一个遥感生产流程创建了一幅 $8$-位地表反射率图像，其具有 $L=256$ 个离散数字级别 $r \\in \\{0,1,2,\\dots,255\\}$，其中 $r=0$ 被保留为表示云和饱和辐射的无数据代码。在某个特定瓦片中，无数据像素部分占所有像素的 $f_{0}=0.35$，而有效反射率像素在级别 $r \\in \\{1,2,\\dots,255\\}$ 上均匀分布。\n\n将两种直方图均衡化流程应用于有效像素：\n\n- 流程 A 通过在计数中包含无数据代码 $r=0$ 来计算用于均衡化的累积质量，将所有像素都视为累积质量的一部分。\n- 流程 B 通过掩膜排除无数据代码来计算累积质量，因此只有有效像素对累积质量有贡献。\n\n对于一个级别为 $r \\in \\{1,2,\\dots,255\\}$ 的有效像素，令 $z_{\\text{A}}(r)$ 表示流程 A 的输出级别，$z_{\\text{B}}(r)$ 表示流程 B 的输出级别，两者均通过经典的直方图均衡化获得，该方法将 $r$ 映射到一个与截至 $r$ 的累积质量成正比的输出级别。令 $R$ 为一个从 $\\{1,2,\\dots,255\\}$ 的均匀分布中抽取的随机有效像素级别。\n\n仅使用概率质量、累积分布和直方图均衡化映射原理的基本定义，计算在累积质量中包含无数据值所引入的期望偏差，即量 $\\mathbb{E}\\left[z_{\\text{A}}(R)-z_{\\text{B}}(R)\\right]$。以输出数字级别的数值表示您的最终答案。无需单位，也无需四舍五入。\n\n最后，基于推导过程，简要说明为什么在对包含无数据值的图像执行基于直方图的对比度调整时，遥感生产流程中需要使用掩膜。",
            "solution": "该问题经确认具有科学依据、提法恰当、客观且完整。它是一个可形式化的统计图像处理问题。我们可以开始求解。\n\n问题要求计算在直方图均衡化计算中包含无数据值所引入的期望偏差 $\\mathbb{E}\\left[z_{\\text{A}}(R)-z_{\\text{B}}(R)\\right]$。我们首先对每个流程的概率分布和变换进行形式化。\n\n图像是 $8$ 位的，因此有 $L=256$ 个数字级别，$r \\in \\{0, 1, 2, \\dots, 255\\}$。级别 $r=0$ 是一个无数据代码，其占总像素的比例为 $f_0 = 0.35$。剩余的像素比例 $1-f_0 = 0.65$ 是有效的，并在级别 $r \\in \\{1, 2, \\dots, 255\\}$ 上均匀分布。\n\n令 $p(r)$ 为从整个图像中随机选择一个像素的概率质量函数 (PMF)。\n一个像素是无数据值的概率为 $p(0) = f_0 = 0.35$。\n对于 $L-1 = 255$ 个有效级别，剩余的概率 $1-f_0$ 是均匀分布的。因此，对于任何 $r \\in \\{1, 2, \\dots, L-1\\}$：\n$$p(r) = \\frac{1-f_0}{L-1} = \\frac{0.65}{255}$$\n\n标准的直方图均衡化变换将输入级别 $r$ 映射到输出级别 $z(r)$，该输出级别与像素级别的累积质量函数 (CMF) 成正比。该映射由 $z(r) = (L-1) \\times CMF(r)$ 给出。\n\n首先，我们分析流程 B，该流程正确地排除了无数据像素。\n**流程 B：排除无数据值**\n此流程仅考虑有效像素，其级别在 $\\{1, 2, \\dots, 255\\}$ 上均匀分布。此条件分布的 PMF，我们称之为 $p_v(r)$，是：\n$$p_v(r) = \\frac{1}{L-1} \\quad \\text{for } r \\in \\{1, 2, \\dots, L-1\\}$$\n有效像素的 CMF，$CMF_{\\text{B}}(r)$，是截至级别 $r$ 的概率之和：\n$$CMF_{\\text{B}}(r) = \\sum_{k=1}^{r} p_v(k) = \\sum_{k=1}^{r} \\frac{1}{L-1} = \\frac{r}{L-1}$$\n那么输出级别 $z_{\\text{B}}(r)$ 为：\n$$z_{\\text{B}}(r) = (L-1) \\times CMF_{\\text{B}}(r) = (L-1) \\left(\\frac{r}{L-1}\\right) = r$$\n这个结果是符合预期的：对一个已经是均匀分布的数据应用直方图均衡化会得到一个恒等映射，因为数据已经是“均衡的”。\n\n**流程 A：包含无数据值**\n此流程错误地将其统计基础建立在包括无数据值在内的所有像素上。其 CMF，$CMF_{\\text{A}}(r)$，是根据总 PMF，$p(r)$ 计算的。我们关心的是对有效输入像素的变换，因此我们对 $r \\in \\{1, 2, \\dots, L-1\\}$ 进行评估：\n$$CMF_{\\text{A}}(r) = \\sum_{k=0}^{r} p(k) = p(0) + \\sum_{k=1}^{r} p(k) = f_0 + \\sum_{k=1}^{r} \\frac{1-f_0}{L-1} = f_0 + \\frac{r(1-f_0)}{L-1}$$\n输出级别 $z_{\\text{A}}(r)$ 为：\n$$z_{\\text{A}}(r) = (L-1) \\times CMF_{\\text{A}}(r) = (L-1) \\left( f_0 + \\frac{r(1-f_0)}{L-1} \\right) = (L-1)f_0 + r(1-f_0)$$\n\n**期望偏差计算**\n对于一个特定的有效像素级别 $r$，偏差是差值 $\\Delta(r) = z_{\\text{A}}(r) - z_{\\text{B}}(r)$。\n$$\\Delta(r) = \\left( (L-1)f_0 + r(1-f_0) \\right) - r = (L-1)f_0 + r - rf_0 - r = f_0(L-1-r)$$\n我们需要计算这个偏差的期望值 $\\mathbb{E}[\\Delta(R)]$，其中 $R$ 是一个代表有效像素级别的随机变量。问题陈述 $R$ 是从 $\\{1, 2, \\dots, 255\\}$，即 $\\{1, 2, \\dots, L-1\\}$ 上的均匀分布中抽取的。\n期望值为：\n$$\\mathbb{E}[\\Delta(R)] = \\mathbb{E}[f_0(L-1-R)] = f_0 \\mathbb{E}[L-1-R] = f_0 \\left( (L-1) - \\mathbb{E}[R] \\right)$$\n对于在整数 $\\{a, b\\}$ 上的离散均匀随机变量，其期望值为 $\\frac{a+b}{2}$。这里，$R$ 在 $\\{1, L-1\\}$ 上是均匀的，所以其期望值为：\n$$\\mathbb{E}[R] = \\frac{1 + (L-1)}{2} = \\frac{L}{2}$$\n将此代入期望偏差的表达式中：\n$$\\mathbb{E}[\\Delta(R)] = f_0 \\left( (L-1) - \\frac{L}{2} \\right) = f_0 \\left( \\frac{2L-2-L}{2} \\right) = f_0 \\left( \\frac{L-2}{2} \\right)$$\n现在，我们代入给定的数值，$L=256$ 和 $f_0=0.35$：\n$$\\mathbb{E}[\\Delta(R)] = 0.35 \\left( \\frac{256}{2} - 1 \\right) = 0.35 (128 - 1) = 0.35 \\times 127$$\n$$0.35 \\times 127 = 44.45$$\n期望偏差为 $44.45$ 个数字级别。\n\n**在遥感中使用掩膜的理由**\n推导过程为使用掩膜提供了清晰、定量的理由。流程 A 中的变换，$z_{\\text{A}}(r) = (L-1)f_0 + (1-f_0)r$，表明无数据值的存在从根本上改变了对比度拉伸。\n当 $f_0 = 0.35$ 且 $L=256$ 时，映射为 $z_{\\text{A}}(r) = 255 \\times 0.35 + (1-0.35)r = 89.25 + 0.65r$。\n正确的映射 $z_{\\text{B}}(r)=r$ 保留了有效数据的完整动态范围 $[1, 255]$。相比之下，流程 A 将相同的输入范围 $[1, 255]$ 映射到输出范围 $[89.25 + 0.65, 89.25 + 0.65 \\times 255] = [89.9, 255]$。\n这意味着所有有效像素，特别是较暗的像素，都被显著提亮，并且整个数据信号被压缩到可用动态范围中一个较小的上部区域（宽度从 $254$ 减少到 $255-89.9 \\approx 165.1$）。这会破坏场景较暗部分的对比度，从而掩盖细节。这种失真是因为在无数据级别 $r=0$ 处的大量像素计数导致了 CMF 的一个巨大初始跳跃，$CMF_{\\text{A}}(0) = f_0 = 0.35$。因此，最暗的有效像素 $r=1$ 被映射到一个很亮的级别 $z_A(1) \\approx (L-1)f_0 \\approx 89.9$。\n因此，需要使用掩膜将有效像素与无数据值隔离，以确保基于直方图的调整所依赖的统计基础能反映真实的数据分布。这使得有意义的对比度增强成为可能，从而揭示实际地表反射率在整个动态范围内的特征，而这正是该技术的主要目标。计算出的期望偏差 $44.45$ 量化了这种不良失真的平均幅度。",
            "answer": "$$\n\\boxed{44.45}\n$$"
        }
    ]
}