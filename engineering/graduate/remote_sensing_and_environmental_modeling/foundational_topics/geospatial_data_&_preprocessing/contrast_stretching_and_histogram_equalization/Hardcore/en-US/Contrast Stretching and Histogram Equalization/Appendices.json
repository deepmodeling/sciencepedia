{
    "hands_on_practices": [
        {
            "introduction": "Linear contrast stretching is a foundational technique for improving the visual quality of remote sensing imagery. This exercise focuses on the precise mathematical translation between sensor data and display values, a crucial step in any visualization workflow. By deriving the coefficients for a linear mapping, you will solidify your understanding of how to control the brightness and contrast of an image to reveal important features. ",
            "id": "3802072",
            "problem": "A calibrated airborne multispectral image has a single band quantized to 10 bits, so each Digital Number (DN) $x$ lies in the integer set $\\{0,1,\\dots,1023\\}$. For visualization in an environmental modeling workflow, the band must be linearly contrast-stretched to an 8-bit display range with $L'=256$ output levels. To avoid overemphasis of outliers, the linear stretch is anchored at the empirically estimated lower and upper scene bounds $x_{\\min}=120$ and $x_{\\max}=1023$, respectively, so that the transformation maps $x_{\\min}$ to the darkest output level and $x_{\\max}$ to the brightest output level. The display mapping is implemented as the integer-valued function $y=\\mathrm{round}(a x + b)$, where $\\mathrm{round}(\\cdot)$ denotes rounding to the nearest integer.\n\nStarting from the core definitions of quantization, dynamic range, and linear mappings that preserve the ordering of DNs and fully occupy the target range, derive the coefficients $a$ and $b$ that satisfy the endpoint constraints $y(x_{\\min})=0$ and $y(x_{\\max})=L'-1$ under the model $y=\\mathrm{round}(a x + b)$. Then, evaluate the resulting mapping at $x=512$ to determine $y$.\n\nExpress $a$ and $b$ in exact fractional form and $y$ as an integer. Provide your final result as a row matrix with entries ordered as $a$, $b$, $y$. No rounding beyond the $\\mathrm{round}(\\cdot)$ function is required, and no physical units are involved.",
            "solution": "The problem asks to find the coefficients $a$ and $b$ for a linear contrast stretch mapping, and then to apply this mapping to a specific input Digital Number (DN). The mapping is defined as $y = \\mathrm{round}(ax + b)$, where $\\mathrm{round}(\\cdot)$ rounds to the nearest integer.\n\nThe input DN values are bounded by $x_{\\min} = 120$ and $x_{\\max} = 1023$. The output display levels are in the range $[0, L'-1]$, where $L'=256$. Thus, the output range is $[0, 255]$.\nThe constraints for the mapping are:\n1. $y(x_{\\min}) = y(120) = 0$\n2. $y(x_{\\max}) = y(1023) = 255$\n\nTo satisfy these constraints with the rounding function, we can set the linear part of the function, $y'(x) = ax+b$, to equal the target integer values at the endpoints. Since rounding an integer returns the integer itself (e.g., $\\mathrm{round}(0) = 0$), this approach is valid.\nThis gives us a system of two linear equations:\n1. $a \\cdot 120 + b = 0$\n2. $a \\cdot 1023 + b = 255$\n\nSubtracting the first equation from the second gives:\n$$a(1023 - 120) = 255$$\n$$903a = 255$$\n$$a = \\frac{255}{903}$$\nTo simplify the fraction, we find the greatest common divisor. Both numbers are divisible by 3:\n$$a = \\frac{255 \\div 3}{903 \\div 3} = \\frac{85}{301}$$\nThe prime factors of the numerator are $85 = 5 \\times 17$. The prime factors of the denominator are $301 = 7 \\times 43$. Since there are no common factors, the fraction is in its simplest form.\n\nNow we solve for $b$ using the first equation, $b = -120a$:\n$$b = -120 \\left( \\frac{85}{301} \\right) = -\\frac{120 \\times 85}{301} = -\\frac{10200}{301}$$\nThis fraction is also in simplest form.\n\nSo, the coefficients are $a = \\frac{85}{301}$ and $b = -\\frac{10200}{301}$.\n\nFinally, we calculate the output value $y$ for an input DN of $x = 512$:\n$$y(512) = \\mathrm{round}(a \\cdot 512 + b)$$\n$$y(512) = \\mathrm{round}\\left( \\frac{85}{301} \\cdot 512 - \\frac{10200}{301} \\right)$$\n$$y(512) = \\mathrm{round}\\left( \\frac{85 \\times 512 - 10200}{301} \\right)$$\n$$y(512) = \\mathrm{round}\\left( \\frac{43520 - 10200}{301} \\right)$$\n$$y(512) = \\mathrm{round}\\left( \\frac{33320}{301} \\right)$$\nPerforming the division:\n$$\\frac{33320}{301} \\approx 110.69767...$$\nRounding to the nearest integer gives:\n$$y(512) = 111$$\n\nThe requested values are $a=\\frac{85}{301}$, $b=-\\frac{10200}{301}$, and $y=111$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{85}{301} & -\\frac{10200}{301} & 111 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Unlike linear stretching, histogram equalization is a non-linear, data-driven method that aims to spread pixel intensities uniformly across the entire dynamic range. This practice demystifies the process by requiring you to compute the transformation from a given image histogram step-by-step. Working through these calculations will build a strong intuition for how the cumulative distribution function (CDF) reshapes an image's tonal landscape to maximize global contrast. ",
            "id": "3802113",
            "problem": "An airborne multispectral imaging radiometer used in remote sensing of vegetation canopies records radiance as an 8-bit Digital Number (DN) after on-board linear quantization. In environmental modeling workflows, a common pre-processing step is global histogram equalization to enhance contrast while preserving the order of DN levels. Consider a small subset of a flightline where only the following DN levels are present in a single band, with their corresponding pixel counts (the rest of the $256$ possible DN levels do not occur in this subset):\n\n- $DN=12$ has $184$ pixels.\n- $DN=35$ has $792$ pixels.\n- $DN=87$ has $115$ pixels.\n- $DN=123$ has $58$ pixels.\n- $DN=156$ has $1610$ pixels.\n- $DN=201$ has $927$ pixels.\n- $DN=245$ has $1214$ pixels.\n\nAssume global histogram equalization to an output dynamic range of $L'=256$ levels is applied to this subset, treating the empirical distribution formed by the listed counts as the image histogram. Using only the definitions of the histogram, the cumulative distribution, and a monotone mapping defined by the normalized cumulative distribution, do the following:\n\n- Compute the cumulative counts in ascending DN order for the listed bins.\n- From first principles, derive the discrete equalization mapping based on the cumulative distribution and apply it to compute the equalized output level for each listed DN bin.\n\nFinally, report the equalized output level for the bin at $DN=201$ as your single numerical answer. The final answer is a single integer level; no unit specification or significant-figure rounding is required beyond the conventional rounding inherent to the equalization mapping.",
            "solution": "The problem requires the computation of an equalized output Digital Number (DN) for a specific input DN, based on a provided sparse histogram from a remote sensing image subset. The process involves histogram equalization, a standard technique for contrast enhancement in image processing.\n\nFirst, we must formalize the problem by defining the components of histogram equalization from first principles.\n\nLet the set of DN levels present in the image be $\\{r_j\\}$, where $j$ indexes the distinct, ordered levels. Let $n(r_j)$ be the number of pixels (pixel count) for each level $r_j$. The image is described as 8-bit, so the full dynamic range is $L=256$ levels, from $0$ to $255$. The problem specifies an output dynamic range of $L' = 256$ levels, which corresponds to an output range of $[0, 255]$.\n\nThe total number of pixels in the image subset, $N$, is the sum of all pixel counts:\n$$N = \\sum_{j} n(r_j)$$\n\nThe provided data for the non-zero DN bins are:\n- $r_1 = 12$, $n(r_1) = 184$\n- $r_2 = 35$, $n(r_2) = 792$\n- $r_3 = 87$, $n(r_3) = 115$\n- $r_4 = 123$, $n(r_4) = 58$\n- $r_5 = 156$, $n(r_5) = 1610$\n- $r_6 = 201$, $n(r_6) = 927$\n- $r_7 = 245$, $n(r_7) = 1214$\n\nFirst, we calculate the total number of pixels, $N$:\n$$N = 184 + 792 + 115 + 58 + 1610 + 927 + 1214 = 4900$$\n\nThe next step, as requested, is to compute the cumulative counts. The cumulative count for a given DN level $r_k$, denoted $C(r_k)$, is the sum of pixel counts for all levels less than or equal to $r_k$.\n$$C(r_k) = \\sum_{j: r_j \\le r_k} n(r_j)$$\n\nWe calculate the cumulative counts for each present DN level in ascending order:\n- For $r_1=12$: $C(12) = n(12) = 184$\n- For $r_2=35$: $C(35) = n(12) + n(35) = 184 + 792 = 976$\n- For $r_3=87$: $C(87) = C(35) + n(87) = 976 + 115 = 1091$\n- For $r_4=123$: $C(123) = C(87) + n(123) = 1091 + 58 = 1149$\n- For $r_5=156$: $C(156) = C(123) + n(156) = 1149 + 1610 = 2759$\n- For $r_6=201$: $C(201) = C(156) + n(201) = 2759 + 927 = 3686$\n- For $r_7=245$: $C(245) = C(201) + n(245) = 3686 + 1214 = 4900$\n\nThe cumulative count for the highest DN level equals the total number of pixels $N$, which serves as a consistency check.\n\nThe principle of histogram equalization is to apply a monotone mapping $T(r)$ that transforms the input pixel levels $r$ to output levels $s$ such that the histogram of the output levels is as flat (uniform) as possible. For discrete levels, this transformation is defined using the normalized cumulative distribution function (CDF). The CDF at a level $r_k$ is given by $C(r_k)/N$. The mapping function scales this CDF to the new dynamic range $[0, L'-1]$.\n\nThe discrete equalization mapping is therefore:\n$$s_k = T(r_k) = \\mathrm{round}\\left( (L' - 1) \\times \\frac{C(r_k)}{N} \\right)$$\nwhere `round` denotes rounding to the nearest integer.\n\nGiven $L' = 256$, the maximum output level is $L'-1 = 255$. The total number of pixels is $N=4900$. The transformation becomes:\n$$s_k = \\mathrm{round}\\left( 255 \\times \\frac{C(r_k)}{4900} \\right)$$\n\nThe problem asks for the equalized output level for the bin at $DN=201$. We use the input level $r_k = 201$. From our prior calculation, the cumulative count for this level is $C(201) = 3686$.\n\nSubstituting these values into the transformation function:\n$$s_{201} = \\mathrm{round}\\left( 255 \\times \\frac{3686}{4900} \\right)$$\n\nWe perform the calculation:\n$$s_{201} = \\mathrm{round}\\left( 255 \\times 0.75224489... \\right)$$\n$$s_{201} = \\mathrm{round}\\left( 191.82244897... \\right)$$\n\nApplying conventional rounding to the nearest integer, we get:\n$$s_{201} = 192$$\n\nThus, the input DN level of $201$ is mapped to the output DN level of $192$ after histogram equalization.",
            "answer": "$$\\boxed{192}$$"
        },
        {
            "introduction": "The integrity of a statistical enhancement depends entirely on the integrity of the input data. This advanced practice explores a critical pitfall in automated remote sensing pipelines: the incorrect handling of \"nodata\" values, which can severely skew image statistics. By quantitatively deriving the bias introduced by including these non-data pixels, you will gain a profound appreciation for why data masking is essential for producing scientifically valid and visually meaningful results. ",
            "id": "3802037",
            "problem": "A remote sensing production pipeline creates an 8-bit surface reflectance image with $L=256$ discrete digital levels $r \\in \\{0,1,2,\\dots,255\\}$, where $r=0$ is reserved as a nodata code representing clouds and saturated radiances. In a particular tile, the nodata fraction is $f_{0}=0.35$ of all pixels, and the valid reflectance pixels are uniformly distributed across the levels $r \\in \\{1,2,\\dots,255\\}$.\n\nTwo histogram equalization pipelines are applied to the valid pixels:\n\n- Pipeline A computes the cumulative mass for equalization by including the nodata code $r=0$ among the counts, treating all pixels as part of the cumulative mass.\n- Pipeline B computes the cumulative mass by excluding the nodata code through a mask, so only valid pixels contribute to the cumulative mass.\n\nFor a valid pixel with level $r \\in \\{1,2,\\dots,255\\}$, let $z_{\\text{A}}(r)$ denote the output level from Pipeline A and $z_{\\text{B}}(r)$ denote the output level from Pipeline B, both obtained by classic histogram equalization that maps $r$ to an output level proportional to the cumulative mass up to $r$. Let $R$ be a random valid pixel level drawn from the uniform distribution on $\\{1,2,\\dots,255\\}$.\n\nUsing only fundamental definitions of probability mass, cumulative distribution, and the mapping principle of histogram equalization, compute the expected bias introduced by including nodata in the cumulative mass, namely the quantity $\\mathbb{E}\\left[z_{\\text{A}}(R)-z_{\\text{B}}(R)\\right]$. Express your final answer as a number of output digital levels. No units are required, and no rounding is necessary.\n\nFinally, provide a brief justification, grounded in the derivation, for why masks are required in remote sensing production pipelines when performing histogram-based contrast adjustments on images that contain nodata values.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and complete. It is a formalizable problem in statistical image processing. We may proceed with the solution.\n\nThe problem asks for the expected bias $\\mathbb{E}\\left[z_{\\text{A}}(R)-z_{\\text{B}}(R)\\right]$ introduced by including nodata values in a histogram equalization calculation. We begin by formalizing the probability distributions and transformations for each pipeline.\n\nThe image is 8-bit, so there are $L=256$ digital levels, $r \\in \\{0, 1, 2, \\dots, 255\\}$. The level $r=0$ is a nodata code, and its fraction of the total pixels is $f_0 = 0.35$. The remaining fraction of pixels, $1-f_0 = 0.65$, are valid and are uniformly distributed across the levels $r \\in \\{1, 2, \\dots, 255\\}$.\n\nLet $p(r)$ be the probability mass function (PMF) for a randomly selected pixel from the entire image.\nThe probability of a pixel being nodata is $p(0) = f_0 = 0.35$.\nFor the $L-1 = 255$ valid levels, the remaining probability $1-f_0$ is distributed uniformly. Thus, for any $r \\in \\{1, 2, \\dots, L-1\\}$:\n$$p(r) = \\frac{1-f_0}{L-1} = \\frac{0.65}{255}$$\n\nThe standard histogram equalization transformation maps an input level $r$ to an output level $z(r)$ that is proportional to the cumulative mass function (CMF) of the pixel levels. The mapping is given by $z(r) = (L-1) \\times CMF(r)$.\n\nFirst, we analyze Pipeline B, which correctly excludes the nodata pixels.\n**Pipeline B: Nodata Excluded**\nThis pipeline considers only the valid pixels, for which the levels are uniformly distributed on $\\{1, 2, \\dots, 255\\}$. The PMF for this conditional distribution, let's call it $p_v(r)$, is:\n$$p_v(r) = \\frac{1}{L-1} \\quad \\text{for } r \\in \\{1, 2, \\dots, L-1\\}$$\nThe CMF for the valid pixels, $CMF_{\\text{B}}(r)$, is the sum of probabilities up to level $r$:\n$$CMF_{\\text{B}}(r) = \\sum_{k=1}^{r} p_v(k) = \\sum_{k=1}^{r} \\frac{1}{L-1} = \\frac{r}{L-1}$$\nThe output level $z_{\\text{B}}(r)$ is then:\n$$z_{\\text{B}}(r) = (L-1) \\times CMF_{\\text{B}}(r) = (L-1) \\left(\\frac{r}{L-1}\\right) = r$$\nThis result is expected: applying histogram equalization to an already uniform distribution results in an identity mapping, as the data is already \"equalized\".\n\n**Pipeline A: Nodata Included**\nThis pipeline incorrectly includes all pixels, including nodata, in its statistical basis. The CMF, $CMF_{\\text{A}}(r)$, is calculated from the overall PMF, $p(r)$. We are interested in the transformation for valid input pixels, so we evaluate for $r \\in \\{1, 2, \\dots, L-1\\}$:\n$$CMF_{\\text{A}}(r) = \\sum_{k=0}^{r} p(k) = p(0) + \\sum_{k=1}^{r} p(k) = f_0 + \\sum_{k=1}^{r} \\frac{1-f_0}{L-1} = f_0 + \\frac{r(1-f_0)}{L-1}$$\nThe output level $z_{\\text{A}}(r)$ is:\n$$z_{\\text{A}}(r) = (L-1) \\times CMF_{\\text{A}}(r) = (L-1) \\left( f_0 + \\frac{r(1-f_0)}{L-1} \\right) = (L-1)f_0 + r(1-f_0)$$\n\n**Expected Bias Calculation**\nThe bias for a specific valid pixel level $r$ is the difference $\\Delta(r) = z_{\\text{A}}(r) - z_{\\text{B}}(r)$.\n$$\\Delta(r) = \\left( (L-1)f_0 + r(1-f_0) \\right) - r = (L-1)f_0 + r - rf_0 - r = f_0(L-1-r)$$\nWe need to find the expected value of this bias, $\\mathbb{E}[\\Delta(R)]$, where $R$ is a random variable representing a valid pixel level. The problem states $R$ is drawn from the uniform distribution on $\\{1, 2, \\dots, 255\\}$, i.e., $\\{1, 2, \\dots, L-1\\}$.\nThe expectation is:\n$$\\mathbb{E}[\\Delta(R)] = \\mathbb{E}[f_0(L-1-R)] = f_0 \\mathbb{E}[L-1-R] = f_0 \\left( (L-1) - \\mathbb{E}[R] \\right)$$\nFor a discrete uniform random variable on the integers $\\{a, b\\}$, the expected value is $\\frac{a+b}{2}$. Here, $R$ is uniform on $\\{1, L-1\\}$, so its expectation is:\n$$\\mathbb{E}[R] = \\frac{1 + (L-1)}{2} = \\frac{L}{2}$$\nSubstituting this into the expression for the expected bias:\n$$\\mathbb{E}[\\Delta(R)] = f_0 \\left( (L-1) - \\frac{L}{2} \\right) = f_0 \\left( \\frac{2L-2-L}{2} \\right) = f_0 \\left( \\frac{L-2}{2} \\right) = f_0 \\left( \\frac{L}{2} - 1 \\right)$$\nNow, we substitute the given numerical values, $L=256$ and $f_0=0.35$:\n$$\\mathbb{E}[\\Delta(R)] = 0.35 \\left( \\frac{256}{2} - 1 \\right) = 0.35 (128 - 1) = 0.35 \\times 127$$\n$$0.35 \\times 127 = 44.45$$\nThe expected bias is $44.45$ digital levels.\n\n**Justification for Masks in Remote Sensing**\nThe derivation provides a clear, quantitative justification for using masks. The transformation in Pipeline A, $z_{\\text{A}}(r) = (L-1)f_0 + (1-f_0)r$, shows that the presence of nodata values fundamentally alters the contrast stretch.\nWith $f_0 = 0.35$ and $L=256$, the mapping is $z_{\\text{A}}(r) = 255 \\times 0.35 + (1-0.35)r = 89.25 + 0.65r$.\nThe correct mapping, $z_{\\text{B}}(r)=r$, preserves the full dynamic range $[1, 255]$ of the valid data. In contrast, Pipeline A maps the same input range $[1, 255]$ to the output range $[89.25 + 0.65, 89.25 + 0.65 \\times 255] = [89.9, 255]$.\nThis means that all valid pixels, particularly the darker ones, are significantly brightened, and the entire data signal is compressed into a smaller upper portion of the available dynamic range (from a width of $254$ to $255-89.9 \\approx 165.1$). This crushes the contrast in the darker parts of the scene, obscuring details. This artifact arises because the large pixel count at the nodata level $r=0$ creates a large initial jump in the CMF, $CMF_{\\text{A}}(0) = f_0 = 0.35$. Consequently, the dimmest valid pixel $r=1$ is mapped to a bright level of $z_A(1) \\approx (L-1)f_0 \\approx 89.9$.\nMasks are therefore required to isolate the valid pixels from nodata, ensuring that the statistical basis for histogram-based adjustments reflects the true data distribution. This allows for a meaningful contrast enhancement that reveals features across the full dynamic range of the actual surface reflectances, which is the primary goal of the technique. The calculated expected bias of $44.45$ quantifies the average magnitude of this undesirable distortion.",
            "answer": "$$\n\\boxed{44.45}\n$$"
        }
    ]
}