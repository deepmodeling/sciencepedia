{
    "hands_on_practices": [
        {
            "introduction": "线性对比度拉伸是一种通过将原始像素值映射到新的、更宽的动态范围来增强图像可见性的基本技术。本练习将提供动手实践，帮助您推导精确的线性变换参数——即 $y = ax + b$ 中的 $a$ 和 $b$——以将特定的输入数据边界映射到期望的输出范围。掌握这一过程对于遥感数据的可视化解译准备工作至关重要。",
            "id": "3802072",
            "problem": "一幅经过标定的机载多光谱图像有一个单波段被量化为 $10$ 比特，因此每个数字量 (DN) $x$ 都在整数集合 $\\{0,1,\\dots,1023\\}$ 中。为了在环境建模工作流中进行可视化，该波段必须被线性对比度拉伸到一个具有 $L'=256$ 个输出级别的 $8$ 比特显示范围。为避免过度强调异常值，线性拉伸分别锚定在经验估计的场景下界 $x_{\\min}=120$ 和上界 $x_{\\max}=1023$，从而该变换将 $x_{\\min}$ 映射到最暗的输出级别，并将 $x_{\\max}$ 映射到最亮的输出级别。显示映射被实现为整值函数 $y=\\mathrm{round}(a x + b)$，其中 $\\mathrm{round}(\\cdot)$ 表示四舍五入到最近的整数。\n\n从量化、动态范围和线性映射（这些映射保留DN的顺序并完全占据目标范围）的核心定义出发，推导在模型 $y=\\mathrm{round}(a x + b)$ 下满足端点约束 $y(x_{\\min})=0$ 和 $y(x_{\\max})=L'-1$ 的系数 $a$ 和 $b$。然后，在 $x=512$ 处评估得到的映射以确定 $y$。\n\n将 $a$ 和 $b$ 表示为精确的分数形式，将 $y$ 表示为整数。以行矩阵的形式提供您的最终结果，其中条目按 $a, b, y$ 的顺序排列。除了 $\\mathrm{round}(\\cdot)$ 函数外，不需要进行其他舍入，也不涉及物理单位。",
            "solution": "该问题要求确定线性映射 $y = \\mathrm{round}(ax + b)$ 的系数 $a$ 和 $b$，然后使用此映射来变换一个特定的输入值。\n\n我们给定的参数如下：\n- 输入DN范围：$10$比特，$\\{0, 1, \\dots, 1023\\}$\n- 输出DN范围：$8$比特，$L'=256$个级别，$\\{0, 1, \\dots, 255\\}$\n- 用于拉伸的输入边界：$x_{\\min} = 120$，$x_{\\max} = 1023$\n- 对应的输出边界：$y_{\\min} = 0$，$y_{\\max} = L'-1 = 255$\n\n变换函数为 $y(x) = \\mathrm{round}(ax + b)$。为了满足边界条件 $y(120) = 0$ 和 $y(1023) = 255$，一个直接的方法是设置函数的线性部分 $y'(x) = ax+b$ 在舍入前就精确地等于目标整数值。\n因此，我们得到一个二元一次方程组：\n1. $a \\cdot 120 + b = 0$\n2. $a \\cdot 1023 + b = 255$\n\n为了求解系数 $a$，我们将第二个方程减去第一个方程：\n$$a \\cdot 1023 + b - (a \\cdot 120 + b) = 255 - 0$$\n$$a(1023 - 120) = 255$$\n$$a(903) = 255$$\n$$a = \\frac{255}{903}$$\n通过找到分子和分母的最大公约数来化简该分数。$255 = 3 \\times 85$，$903 = 3 \\times 301$。\n$$a = \\frac{85}{301}$$\n由于 $85 = 5 \\times 17$ 且 $301 = 7 \\times 43$，该分数已是最简形式。\n\n接下来，我们使用第一个方程 $b = -120a$ 来求解系数 $b$：\n$$b = -120 \\left(\\frac{85}{301}\\right) = -\\frac{120 \\times 85}{301} = -\\frac{10200}{301}$$\n此分数也为最简形式。\n\n现在我们有了系数 $a=\\frac{85}{301}$ 和 $b=-\\frac{10200}{301}$。\n\n最后一步是计算当输入DN为 $x = 512$ 时的输出值 $y$：\n$$y(512) = \\mathrm{round}(a \\cdot 512 + b)$$\n$$y(512) = \\mathrm{round}\\left(\\frac{85}{301} \\cdot 512 - \\frac{10200}{301}\\right)$$\n$$y(512) = \\mathrm{round}\\left(\\frac{85 \\times 512 - 10200}{301}\\right)$$\n$$y(512) = \\mathrm{round}\\left(\\frac{43520 - 10200}{301}\\right)$$\n$$y(512) = \\mathrm{round}\\left(\\frac{33320}{301}\\right)$$\n进行除法运算：\n$$\\frac{33320}{301} \\approx 110.69767...$$\n将此值四舍五入到最近的整数：\n$$y(512) = 111$$\n\n因此，所求的三个值分别为：\n$a = \\frac{85}{301}$\n$b = -\\frac{10200}{301}$\n$y = 111$",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{85}{301} & -\\frac{10200}{301} & 111 \\end{pmatrix}}$$"
        },
        {
            "introduction": "与线性拉伸不同，直方图均衡化是一种非线性方法，它通过基于像素强度的频率重新分布来增强对比度。本练习将引导您了解均衡化的核心机制，要求您从一个样本直方图中计算累积分布函数(CDF)，并用它来推导新的、均衡化后的像素值。这种分步计算揭示了该算法的神秘面纱，并为您建立关于它如何重塑图像色调分布的深刻直觉。",
            "id": "3802113",
            "problem": "一种用于植被冠层遥感的机载多光谱成像辐射计，在经过机上线性量化后，将辐射亮度记录为 $8$ 位数字值 (DN)。在环境建模工作流程中，一个常见的预处理步骤是全局直方图均衡化，以增强对比度，同时保留 DN 级别的顺序。考虑某航线的一个小子集，在单个波段中仅存在以下 DN 级别及其对应的像素计数（其余 $256$ 个可能的 DN 级别在此子集中未出现）：\n\n- $DN=12$ 有 $184$ 个像素。\n- $DN=35$ 有 $792$ 个像素。\n- $DN=87$ 有 $115$ 个像素。\n- $DN=123$ 有 $58$ 个像素。\n- $DN=156$ 有 $1610$ 个像素。\n- $DN=201$ 有 $927$ 个像素。\n- $DN=245$ 有 $1214$ 个像素。\n\n假设对该子集应用全局直方图均衡化，输出动态范围为 $L'=256$ 个级别，并将由所列计数形成的经验分布视为图像直方图。仅使用直方图、累积分布和由归一化累积分布定义的单调映射的定义，完成以下操作：\n\n- 按 DN 升序计算所列 DN 级别的累积计数。\n- 从基本原理出发，推导基于累积分布的离散均衡化映射，并应用它来计算每个所列 DN 级别的均衡化输出级别。\n\n最后，报告 $DN=201$ 处级别的均衡化输出级别作为您的单一数值答案。最终答案是一个整数级别；除了均衡化映射中固有的常规四舍五入外，不需要指定单位或进行有效数字舍入。",
            "solution": "该问题要求根据一个稀疏的图像直方图，为一个特定的输入DN值计算其经过直方图均衡化后的输出值。\n\n首先，我们整理给定的数据。输入DN级别为 $r_j$，对应的像素数为 $n(r_j)$：\n- $r_1 = 12$, $n(r_1) = 184$\n- $r_2 = 35$, $n(r_2) = 792$\n- $r_3 = 87$, $n(r_3) = 115$\n- $r_4 = 123$, $n(r_4) = 58$\n- $r_5 = 156$, $n(r_5) = 1610$\n- $r_6 = 201$, $n(r_6) = 927$\n- $r_7 = 245$, $n(r_7) = 1214$\n\n第一步是计算图像子集中的总像素数 $N$：\n$$N = 184 + 792 + 115 + 58 + 1610 + 927 + 1214 = 4900$$\n\n第二步是按DN升序计算累积计数 $C(r_k)$，即所有小于或等于 $r_k$ 的DN级别的像素数之和：\n- $C(12) = 184$\n- $C(35) = 184 + 792 = 976$\n- $C(87) = 976 + 115 = 1091$\n- $C(123) = 1091 + 58 = 1149$\n- $C(156) = 1149 + 1610 = 2759$\n- $C(201) = 2759 + 927 = 3686$\n- $C(245) = 3686 + 1214 = 4900$\n\n直方图均衡化的离散映射函数 $T(r_k)$ 将输入级别 $r_k$ 变换为输出级别 $s_k$。该函数将归一化的累积分布函数（CDF）值 $\\frac{C(r_k)}{N}$ 缩放到输出动态范围 $[0, L'-1]$。问题中指定输出范围为 $L'=256$ 个级别（即$[0, 255]$），并使用常规四舍五入。\n因此，映射函数为：\n$$s_k = T(r_k) = \\text{round}\\left( (L' - 1) \\times \\frac{C(r_k)}{N} \\right)$$\n代入 $L'-1 = 255$ 和 $N=4900$：\n$$s_k = \\text{round}\\left( 255 \\times \\frac{C(r_k)}{4900} \\right)$$\n\n问题要求计算输入DN为 $201$ 时的均衡化输出级别。我们使用 $r_k = 201$。从之前的计算可知，该级别的累积计数为 $C(201) = 3686$。\n\n将这些值代入变换函数：\n$$s_{201} = \\text{round}\\left( 255 \\times \\frac{3686}{4900} \\right)$$\n$$s_{201} = \\text{round}\\left( 255 \\times 0.75224489... \\right)$$\n$$s_{201} = \\text{round}\\left( 191.82244897... \\right)$$\n\n应用四舍五入到最近的整数，我们得到：\n$$s_{201} = 192$$\n\n因此，经过直方图均衡化后，输入DN级别 $201$ 被映射到输出DN级别 $192$。",
            "answer": "$$\\boxed{192}$$"
        },
        {
            "introduction": "在真实的遥感应用中，图像常常包含“无数据”像素，必须正确处理这些像素以确保分析的完整性。这个高级练习超越了简单的计算机制，旨在探讨在基于直方图的增强中不当包含“无数据”值所带来的定量影响。通过计算预期偏差，您将更深刻地理解掩膜（masking）在生产流程中的关键作用，以及视觉增强与定量分析之间的区别。",
            "id": "3802037",
            "problem": "一个遥感生产流程创建一幅8比特地表反射率影像，其具有$L=256$个离散数字级别$r \\in \\{0,1,2,\\dots,255\\}$，其中$r=0$被保留作为表示云和饱和辐射度的无数据代码。在某个特定瓦片中，无数据部分占所有像素的比例为$f_{0}=0.35$，而有效的反射率像素在级别$r \\in \\{1,2,\\dots,255\\}$上均匀分布。\n\n对有效像素应用两种直方图均衡化流程：\n\n- 流程A在计算用于均衡化的累积分布时，将无数据代码$r=0$包含在计数中，将所有像素都视为累积分布的一部分。\n- 流程B通过掩膜排除无数据代码来计算累积分布，因此只有有效像素对累积分布有贡献。\n\n对于一个级别为$r \\in \\{1,2,\\dots,255\\}$的有效像素，设$z_{\\text{A}}(r)$表示流程A的输出级别，$z_{\\text{B}}(r)$表示流程B的输出级别，两者都通过经典的直方图均衡化获得，该方法将$r$映射到一个与截至$r$的累积分布成比例的输出级别。设$R$是从$\\{1,2,\\dots,255\\}$上的均匀分布中抽取的随机有效像素级别。\n\n仅使用概率质量、累积分布和直方图均衡化映射原理的基本定义，计算因在累积分布中包含无数据值而引入的期望偏差，即量$\\mathbb{E}\\left[z_{\\text{A}}(R)-z_{\\text{B}}(R)\\right]$。将您的最终答案表示为输出数字级别的数量。不需要单位，也无需四舍五入。\n\n最后，基于推导过程，简要说明为什么在遥感生产流程中，对包含无数据值的影像进行基于直方图的对比度调整时，需要使用掩膜。",
            "solution": "该问题要求计算在直方图均衡化过程中，不当包含无数据值所引入的期望偏差。我们首先为两个流程分别建立数学模型。\n\n影像具有 $L=256$ 个级别 ($r \\in \\{0, \\dots, 255\\}$)。$r=0$ 是无数据代码，其比例为 $f_0 = 0.35$。有效像素（$r \\in \\{1, \\dots, 255\\}$）的比例为 $1-f_0=0.65$，并且它们在 $L-1=255$ 个级别上均匀分布。\n\n设 $p(r)$ 是从整个影像（包括无数据像素）中随机选取一个像素的概率质量函数 (PMF)。\n- $p(0) = f_0 = 0.35$\n- 对于 $r \\in \\{1, \\dots, 255\\}$，$p(r) = \\frac{1-f_0}{L-1} = \\frac{0.65}{255}$\n\n标准的直方图均衡化映射函数为 $z(r) = (L-1) \\times CMF(r)$，其中 $CMF(r)$ 是截至级别 $r$ 的累积分布函数。\n\n**流程B：正确流程（使用掩膜）**\n此流程仅考虑有效像素。对于这个子集，其条件概率分布 $p_v(r)$ 在 $\\{1, \\dots, 255\\}$ 上是均匀的：\n$$p_v(r) = \\frac{1}{L-1} = \\frac{1}{255} \\quad \\text{for } r \\in \\{1, \\dots, 255\\}$$\n其累积分布函数 $CMF_{\\text{B}}(r)$ 为：\n$$CMF_{\\text{B}}(r) = \\sum_{k=1}^{r} p_v(k) = \\sum_{k=1}^{r} \\frac{1}{L-1} = \\frac{r}{L-1}$$\n因此，流程B的输出级别 $z_{\\text{B}}(r)$ 是：\n$$z_{\\text{B}}(r) = (L-1) \\times CMF_{\\text{B}}(r) = (L-1) \\left(\\frac{r}{L-1}\\right) = r$$\n这表明对于一个已经均匀的分布，均衡化是一个恒等映射，保留了原始值。\n\n**流程A：错误流程（包含无数据值）**\n此流程基于包含无数据值的整个像素集。其累半积分布函数 $CMF_{\\text{A}}(r)$ 是从 $p(r)$ 计算得出的。我们计算对有效像素 ($r \\ge 1$) 的变换：\n$$CMF_{\\text{A}}(r) = \\sum_{k=0}^{r} p(k) = p(0) + \\sum_{k=1}^{r} p(k) = f_0 + \\sum_{k=1}^{r} \\frac{1-f_0}{L-1} = f_0 + \\frac{r(1-f_0)}{L-1}$$\n对应的输出级别 $z_{\\text{A}}(r)$ 是：\n$$z_{\\text{A}}(r) = (L-1) \\times CMF_{\\text{A}}(r) = (L-1) \\left( f_0 + \\frac{r(1-f_0)}{L-1} \\right) = (L-1)f_0 + r(1-f_0)$$\n\n**计算期望偏差**\n偏差 $\\Delta(r)$ 是 $z_{\\text{A}}(r) - z_{\\text{B}}(r)$：\n$$\\Delta(r) = \\left( (L-1)f_0 + r(1-f_0) \\right) - r = (L-1)f_0 - rf_0 = f_0(L-1-r)$$\n我们需要计算此偏差的期望值 $\\mathbb{E}[\\Delta(R)]$，其中随机变量 $R$ 在 $\\{1, \\dots, 255\\}$ 上均匀分布。\n$$\\mathbb{E}[\\Delta(R)] = \\mathbb{E}[f_0(L-1-R)] = f_0 \\mathbb{E}[L-1-R] = f_0 \\left( (L-1) - \\mathbb{E}[R] \\right)$$\n对于一个在 $\\{1, \\dots, L-1\\}$ 上均匀分布的离散随机变量 $R$，其期望值为 $\\mathbb{E}[R] = \\frac{1 + (L-1)}{2} = \\frac{L}{2}$。\n代入期望偏差的表达式：\n$$\\mathbb{E}[\\Delta(R)] = f_0 \\left( (L-1) - \\frac{L}{2} \\right) = f_0 \\left( \\frac{2L-2-L}{2} \\right) = f_0 \\left( \\frac{L-2}{2} \\right)$$\n现在代入数值 $L=256$ 和 $f_0=0.35$：\n$$\\mathbb{E}[\\Delta(R)] = 0.35 \\times \\left( \\frac{256-2}{2} \\right) = 0.35 \\times \\left( \\frac{254}{2} \\right) = 0.35 \\times 127 = 44.45$$\n因此，期望偏差为 $44.45$ 个数字级别。\n\n**使用掩膜的理由**\n推导过程表明，不当包含无数据值 ($r=0$) 会严重扭曲均衡化映射。由于在 $r=0$ 处存在一个很大的概率质量 ($f_0=0.35$)，CMF在起点就跳跃到了一个很高的值 ($0.35$)。这导致所有有效像素（无论其原始亮度如何）都被非线性地向上平移和压缩。具体来说，正确的映射 $z_{\\text{B}}(r)=r$ 利用了整个输出动态范围 $[1, 255]$。而错误的映射 $z_{\\text{A}}(r) = (L-1)f_0 + r(1-f_0) = 89.25 + 0.65r$，将有效输入范围 $[1, 255]$ 压缩并平移到了输出范围 $[89.9, 255]$。\n这种效应有两个主要负面后果：\n1.  **对比度压缩**：有效数据的动态范围被从254个级别压缩到大约165个级别，降低了图像的整体对比度，这与均衡化的初衷背道而驰。\n2.  **信息损失**：场景中较暗部分的细节被严重压缩，所有原本在 $[1, 137]$ 之间的暗像素都被映射到了比中间灰度128更亮的级别。\n因此，必须使用掩膜来排除无数据值，确保均衡化所依据的统计数据仅反映真实的地表反射率分布。这才能实现有意义的对比度增强，忠实地展现数据中的信息。计算出的期望偏差 $44.45$ 定量地揭示了这种系统性偏差的严重性。",
            "answer": "$$\n\\boxed{44.45}\n$$"
        }
    ]
}