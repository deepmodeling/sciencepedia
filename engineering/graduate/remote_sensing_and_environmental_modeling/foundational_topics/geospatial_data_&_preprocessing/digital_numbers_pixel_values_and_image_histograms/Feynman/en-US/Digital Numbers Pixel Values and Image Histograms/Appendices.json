{
    "hands_on_practices": [
        {
            "introduction": "A pixel's digital number (DN) is not just a measure of scene radiance but also includes noise inherent to the sensing process. Understanding these noise components is a foundational step in quantitative remote sensing, as it allows us to assess data quality and model measurement uncertainty. This practice  provides a hands-on method to dissect the signal, using the relationship between the mean and variance of DNs—a technique known as Photon Transfer Curve (PTC) analysis—to estimate a sensor's fundamental read noise and shot noise characteristics from empirical data.",
            "id": "3806017",
            "problem": "A spaceborne sensor operating in pushbroom mode records Digital Number (DN) images of a uniform radiance target across multiple exposure settings in a laboratory radiometric sweep. Assume the following fundamental base for the stochastic image formation process and its measurement in the context of remote sensing and environmental modeling:\n\n- Photon arrivals are modeled as a Poisson process, so the number of photoelectrons $E$ generated in a pixel has variance equal to its mean, i.e., $\\mathrm{Var}(E) = \\mathbb{E}[E]$.\n- Electronic read noise in the detector is modeled as an independent, additive Gaussian random variable $R$ with zero mean and variance $\\sigma_r^2$ in electrons, i.e., $R \\sim \\mathcal{N}(0, \\sigma_r^2)$, independent of $E$.\n- The system response is linear after bias correction, such that the DN value $D$ is related to total electrons $T = E + R$ by $D = \\alpha T$, where $\\alpha$ is the system gain (in $\\mathrm{DN/e^-}$), and the bias offset has been removed so that the mean relationship is $\\mathbb{E}[D] = \\alpha \\mathbb{E}[E]$.\n\nFrom these base principles, derive a relationship between the variance of the DN values and the mean DN across the radiance sweep, suitable for estimation by fitting a straight line to variance versus mean DN. Then, design an algorithm that, given measured histogram widths (standard deviations in DN) and mean DN values from uniform-target patches across different exposures, estimates the shot noise scaling (the gain $\\alpha$ in $\\mathrm{DN/e^-}$) and the read noise magnitude in electrons $\\sigma_r$.\n\nYour program must implement this estimation by performing a linear fit of DN variance versus mean DN for each provided test case, then converting the fitted parameters into the required physical quantities. The program must not require any user input.\n\nExpress the final estimated read noise in electrons $\\sigma_r$ and the gain $\\alpha$ with no physical units attached in the numeric output; however, the interpretation must be in $\\mathrm{e^-}$ for $\\sigma_r$ and $\\mathrm{DN/e^-}$ for $\\alpha$. Round each reported numeric value to six decimal places.\n\nTest Suite. For each case, you are given arrays of mean DN values and corresponding histogram widths (standard deviations) in DN for uniform-target patches. All measurements are bias-corrected and taken under linear response conditions. Use only the given values.\n\n- Case 1 (general happy path, mid to high radiance):\n  - Mean DN: [$475$, $1425$, $2850$, $5700$, $8550$, $11400$]\n  - Histogram widths (DN): [$21.536$, $36.958$, $52.153$, $73.671$, $90.196$, $104.136$]\n\n- Case 2 (low-light regime, read noise dominated boundary):\n  - Mean DN: [$0$, $47.5$, $95$, $190$]\n  - Histogram widths (DN): [$3.515$, $7.585$, $10.130$, $13.889$]\n\n- Case 3 (presence of a mild outlier in one exposure):\n  - Mean DN: [$600$, $1800$, $3600$, $7200$, $10800$]\n  - Histogram widths (DN): [$27.495$, $46.872$, $66.0$, $102.442$, $114.0$]\n\n- Case 4 (different sensor gain and read noise, moderate radiance range):\n  - Mean DN: [$350$, $1400$, $2800$, $4900$]\n  - Histogram widths (DN): [$15.716$, $31.352$, $44.333$, $58.600$]\n\nRequired output format. Your program should produce a single line of output containing the results for all cases as a comma-separated list enclosed in square brackets. Each case’s result must be a list of two floats [$\\alpha$, $\\sigma_r$], rounded to six decimals, in the order of the cases above. For example, the output should look like [$[$a$,$b$],[$c$,$d$],[$e$,$f$],[$g$,$h$]$], where each symbol is a float. No additional text should be printed.\n\nThe final answers for all cases must be numeric floats only (no units, no percentage signs), aggregated exactly as specified.",
            "solution": "The user-provided problem has been evaluated and is determined to be **valid**. It is scientifically grounded in the established principles of sensor noise modeling, is well-posed, and its components are complete and internally consistent. We may therefore proceed with a formal solution.\n\nThe problem requires the derivation of a relationship between the mean and variance of a sensor's digital number (DN) output, based on a physical model of photon sensing and electronic noise. This relationship is then to be used to estimate key sensor parameters: the system gain $\\alpha$ and the read noise $\\sigma_r$.\n\nThe physical model is defined by three core principles:\n1.  The number of photoelectrons, $E$, generated at a pixel is a random variable following a Poisson distribution. A fundamental property of the Poisson distribution is that its variance is equal to its mean: $\\mathrm{Var}(E) = \\mathbb{E}[E]$. Let us denote the mean number of photoelectrons as $\\mu_E$. Thus, $\\mathrm{Var}(E) = \\mu_E$.\n2.  The electronic read noise, $R$, is an independent, additive Gaussian random variable with a mean of zero and a variance of $\\sigma_r^2$. That is, $\\mathbb{E}[R] = 0$ and $\\mathrm{Var}(R) = \\sigma_r^2$. The units of both the mean and variance of $R$ are in terms of electrons.\n3.  The total number of electrons, $T$, accumulated at a pixel is the sum of the photoelectrons and the read noise: $T = E + R$. The final digital number, $D$, is linearly proportional to the total electrons, $T$, with a system gain of $\\alpha$ (in units of $\\mathrm{DN/e^-}$). The relationship is given as $D = \\alpha T$. The problem specifies that a bias offset has already been removed.\n\nOur objective is to find a relationship between the mean of the digital number, $\\mathbb{E}[D]$, and the variance of the digital number, $\\mathrm{Var}(D)$.\n\nFirst, let's derive the expression for the mean digital number, which we denote as $\\mu_D$:\n$\\mu_D = \\mathbb{E}[D] = \\mathbb{E}[\\alpha T] = \\alpha \\mathbb{E}[T]$\nUsing the linearity of expectation and the definition of $T$:\n$\\mathbb{E}[T] = \\mathbb{E}[E + R] = \\mathbb{E}[E] + \\mathbb{E}[R]$\nSubstituting the given mean values for $E$ and $R$:\n$\\mathbb{E}[T] = \\mu_E + 0 = \\mu_E$\nTherefore, the mean digital number is directly proportional to the mean number of photoelectrons:\n$$\n\\mu_D = \\alpha \\mu_E\n$$\n\nNext, we derive the expression for the variance of the digital number, which we denote as $\\sigma_D^2$:\n$\\sigma_D^2 = \\mathrm{Var}(D) = \\mathrm{Var}(\\alpha T)$\nUsing the properties of variance, $\\mathrm{Var}(cX) = c^2 \\mathrm{Var}(X)$:\n$\\sigma_D^2 = \\alpha^2 \\mathrm{Var}(T)$\nSince $E$ and $R$ are stated to be independent random variables, the variance of their sum is the sum of their variances:\n$\\mathrm{Var}(T) = \\mathrm{Var}(E + R) = \\mathrm{Var}(E) + \\mathrm{Var}(R)$\nSubstituting the known variances for $E$ and $R$:\n$\\mathrm{Var}(T) = \\mu_E + \\sigma_r^2$\nTherefore, the variance of the digital number is:\n$$\n\\sigma_D^2 = \\alpha^2 (\\mu_E + \\sigma_r^2) = \\alpha^2 \\mu_E + \\alpha^2 \\sigma_r^2\n$$\n\nNow, we must establish a relationship that connects the observables $\\mu_D$ and $\\sigma_D^2$. We can eliminate the unobserved variable $\\mu_E$ by using the expression for the mean. From $\\mu_D = \\alpha \\mu_E$, we can write $\\mu_E = \\mu_D / \\alpha$. Substituting this into the variance equation:\n$$\n\\sigma_D^2 = \\alpha^2 \\left(\\frac{\\mu_D}{\\alpha}\\right) + \\alpha^2 \\sigma_r^2\n$$\nThis simplifies to the final linear relationship:\n$$\n\\sigma_D^2 = \\alpha \\mu_D + \\alpha^2 \\sigma_r^2\n$$\nThis equation is of the form $y = mx + c$, where:\n-   The dependent variable $y$ is the variance of the digital number, $\\sigma_D^2$.\n-   The independent variable $x$ is the mean of the digital number, $\\mu_D$.\n-   The slope of the line, $m$, is the system gain, $\\alpha$.\n-   The y-intercept of the line, $c$, is the term $\\alpha^2 \\sigma_r^2$.\n\nThe problem provides sets of measured mean DN values ($\\mu_D$) and their corresponding histogram widths, which are standard deviations ($\\sigma_D$). To use the derived linear model, we must first square the standard deviations to obtain the variances ($\\sigma_D^2$). Then, a linear regression (least-squares fit) can be performed on the $(\\mu_D, \\sigma_D^2)$ data points to estimate the slope $m$ and the y-intercept $c$.\n\nOnce the fit parameters $m$ and $c$ are determined, the physical sensor parameters $\\alpha$ and $\\sigma_r$ can be calculated as follows:\n1.  The gain $\\alpha$ is equal to the slope of the fitted line:\n    $$\n    \\alpha = m\n    $$\n2.  The read noise $\\sigma_r$ is determined from the y-intercept. We have $c = \\alpha^2 \\sigma_r^2$. Substituting $\\alpha=m$, we get $c = m^2 \\sigma_r^2$. Solving for $\\sigma_r$:\n    $$\n    \\sigma_r^2 = \\frac{c}{m^2} \\implies \\sigma_r = \\frac{\\sqrt{c}}{m}\n    $$\n    Physical constraints demand that variance $c$ must be non-negative and gain $m$ must be positive. In practice, measurement noise can lead to a small negative intercept from the fit; in such cases, the physically meaningful interpretation is that the read noise is zero or below the measurement threshold, so we should treat any negative $c$ as $0$.\n\nThe algorithm is thus as follows:\n1.  For each test case, take the input arrays of mean DNs and standard deviations.\n2.  Create a corresponding array of DN variances by squaring each standard deviation.\n3.  Perform a linear least-squares fit of DN variance versus mean DN to obtain the slope $m$ and y-intercept $c$.\n4.  Calculate the gain $\\alpha = m$.\n5.  Calculate the read noise $\\sigma_r = \\sqrt{\\max(0, c)} / m$.\n6.  Round both $\\alpha$ and $\\sigma_r$ to six decimal places and format the output as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the sensor characterization problem for all test cases.\n    The method is based on the Photon Transfer Curve (PTC) analysis,\n    where a linear relationship between signal variance and signal mean is exploited.\n    The derived relationship is Var(DN) = alpha * Mean(DN) + (alpha * sigma_r)^2.\n    A linear fit of Var(DN) vs. Mean(DN) yields a slope `m` and intercept `c`.\n    The physical parameters are then:\n    - Gain (alpha) = m\n    - Read Noise (sigma_r) = sqrt(c) / m\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general happy path, mid to high radiance)\n        (\n            np.array([475, 1425, 2850, 5700, 8550, 11400], dtype=float),\n            np.array([21.536, 36.958, 52.153, 73.671, 90.196, 104.136], dtype=float),\n        ),\n        # Case 2 (low-light regime, read noise dominated boundary)\n        (\n            np.array([0, 47.5, 95, 190], dtype=float),\n            np.array([3.515, 7.585, 10.130, 13.889], dtype=float),\n        ),\n        # Case 3 (presence of a mild outlier in one exposure)\n        (\n            np.array([600, 1800, 3600, 7200, 10800], dtype=float),\n            np.array([27.495, 46.872, 66.0, 102.442, 114.0], dtype=float),\n        ),\n        # Case 4 (different sensor gain and read noise, moderate radiance range)\n        (\n            np.array([350, 1400, 2800, 4900], dtype=float),\n            np.array([15.716, 31.352, 44.333, 58.600], dtype=float),\n        ),\n    ]\n\n    results = []\n    for mean_dn, std_dev_dn in test_cases:\n        # The independent variable x is the mean DN\n        x = mean_dn\n        \n        # The dependent variable y is the variance of the DN, which is the square of the histogram width (std dev)\n        y = np.square(std_dev_dn)\n        \n        # Perform a linear least-squares fit (polynomial of degree 1)\n        # This returns the slope (m) and y-intercept (c) of the fitted line y = mx + c\n        m, c = np.polyfit(x, y, 1)\n        \n        # From the derived model, the gain alpha is the slope of the line\n        alpha = m\n        \n        # The read noise sigma_r is derived from the intercept c = (alpha * sigma_r)^2\n        # So, sigma_r = sqrt(c) / alpha.\n        # Intercept c must be non-negative for a physical interpretation.\n        # Fit errors on noisy data can result in a small negative intercept.\n        # In such a case, the physically meaningful interpretation is a read noise of zero.\n        if alpha > 0:\n            sigma_r = np.sqrt(max(0, c)) / alpha\n        else:\n            # A non-positive gain is physically unrealistic. In this unlikely event, read noise is undefined.\n            # Handle this gracefully, e.g., by setting it to 0 or NaN.\n            # For this problem's context, with valid data, alpha should be positive.\n            sigma_r = 0.0\n\n        # Round the results to six decimal places as required\n        alpha_rounded = round(alpha, 6)\n        sigma_r_rounded = round(sigma_r, 6)\n        \n        results.append([alpha_rounded, sigma_r_rounded])\n\n    # Format the final output string to exactly match the required format: [[a,b],[c,d],...]\n    case_strings = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output = f\"[{','.join(case_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Raw Digital Numbers are sensor-specific and lack direct physical meaning, making them unsuitable for direct use in scientific models or comparisons across different instruments. To perform quantitative science, we must convert these arbitrary units into a standardized physical quantity such as reflectance. This exercise  guides you through the essential process of absolute radiometric calibration, demonstrating how to transform DNs into Top-of-Atmosphere (TOA) reflectance and how to use information theory to analyze the way this crucial conversion alters the statistical distribution of pixel values.",
            "id": "3806065",
            "problem": "A passive multispectral satellite sensor acquires a small subset of pixels over a homogeneous agricultural field at solar zenith angle $\\theta_s = 30^{\\circ}$, and the platform reports raw Digital Numbers (DN) for three spectral bands: band $1$ (blue), band $2$ (green), and band $3$ (near-infrared). The radiometric calibration for each band $b$ is linear, characterized by a gain $\\alpha_b$ and offset $\\beta_b$, with band-specific extraterrestrial solar irradiance $E_{0,\\lambda_b}$. Assume negligible atmospheric effects for the purpose of Top-of-Atmosphere (TOA) reflectance and that the offsets are zero, i.e., $\\beta_b = 0$ for all bands. The parameters are:\n- Band $1$ (blue): $\\alpha_1 = 1.2$ ($\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}\\,\\text{per DN}$), $E_{0,\\lambda_1} = 1900$ ($\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$).\n- Band $2$ (green): $\\alpha_2 = 1.0$ ($\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}\\,\\text{per DN}$), $E_{0,\\lambda_2} = 1850$ ($\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$).\n- Band $3$ (near-infrared): $\\alpha_3 = 0.8$ ($\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}\\,\\text{per DN}$), $E_{0,\\lambda_3} = 1600$ ($\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$).\n\nFor each band, the sensor records the following raw DN values over $10$ spatial pixels:\n- Band $1$: $\\{50, 55, 60, 65, 70, 80, 90, 100, 120, 150\\}$.\n- Band $2$: $\\{60, 65, 75, 85, 90, 95, 110, 130, 160, 180\\}$.\n- Band $3$: $\\{110, 120, 130, 140, 150, 170, 190, 210, 230, 250\\}$.\n\nStarting from the definitions of radiance, linear radiometric calibration, and TOA reflectance, derive the expression that maps DN to TOA reflectance $\\rho_{\\lambda_b}$, and compute the reflectance for each pixel in each band. Construct two $3$-bin histograms per band:\n- Pre-calibration DN histograms using DN bins $[0, 80)$, $[80, 120)$, $[120, \\infty)$.\n- Post-calibration reflectance histograms using reflectance bins $[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$.\n\nNormalize each histogram to a discrete probability mass function over the $3$ bins. For each band $b$, compute the Kullback–Leibler divergence (KLD) from the pre-calibration distribution $p^{(b)}$ to the post-calibration distribution $q^{(b)}$ using $D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right) = \\sum_{i=1}^{3} p^{(b)}_i \\,\\ln\\!\\left(\\frac{p^{(b)}_i}{q^{(b)}_i}\\right)$, with the convention that terms with $p^{(b)}_i = 0$ contribute $0$. Finally, report the multi-band histogram divergence metric defined as the sum $\\sum_{b=1}^{3} D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right)$. Round your final answer to four significant figures. Express the final metric as a dimensionless decimal number.",
            "solution": "The problem is assessed to be scientifically grounded, well-posed, objective, and self-contained. All necessary data, definitions, and constraints are provided, and they are consistent with established principles of remote sensing and information theory. The problem is therefore deemed **valid**, and a complete solution follows.\n\nThe analysis proceeds in five sequential steps:\n1.  Derivation of the formula for Top-of-Atmosphere (TOA) reflectance from Digital Number (DN).\n2.  Calculation of reflectance values for each pixel in all three spectral bands.\n3.  Construction of normalized histograms (Probability Mass Functions, PMFs) for DN values (pre-calibration) and reflectance values (post-calibration).\n4.  Computation of the Kullback–Leibler Divergence (KLD) for each band.\n5.  Summation of the KLD values to obtain the final multi-band histogram divergence metric.\n\n**Step 1: Derivation of TOA Reflectance from DN**\nThe at-sensor spectral radiance, $L_{\\lambda_b}$, for band $b$ is given by the linear radiometric calibration equation:\n$$L_{\\lambda_b} = \\alpha_b \\cdot \\text{DN}_b + \\beta_b$$\nwhere $\\alpha_b$ is the gain, $\\beta_b$ is the offset, and $\\text{DN}_b$ is the Digital Number. The problem states that the offsets are zero, $\\beta_b = 0$. Thus, the equation simplifies to:\n$$L_{\\lambda_b} = \\alpha_b \\cdot \\text{DN}_b$$\n\nThe TOA reflectance, $\\rho_{\\lambda_b}$, assuming a Lambertian surface and negligible atmospheric effects, relates the measured upwelling radiance $L_{\\lambda_b}$ to the incident solar irradiance. The solar irradiance on a horizontal surface at the top of the atmosphere is given by $E_{0,\\lambda_b} \\cos(\\theta_s)$, where $E_{0,\\lambda_b}$ is the band-specific mean extraterrestrial solar irradiance and $\\theta_s$ is the solar zenith angle. The radiance reflected from an ideal Lambertian surface is distributed uniformly in all directions, and the relationship is:\n$$L_{\\lambda_b} = \\frac{\\rho_{\\lambda_b} E_{0,\\lambda_b} \\cos(\\theta_s)}{\\pi}$$\nSolving for $\\rho_{\\lambda_b}$ yields:\n$$\\rho_{\\lambda_b} = \\frac{\\pi L_{\\lambda_b}}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\nSubstituting the expression for $L_{\\lambda_b}$ in terms of $\\text{DN}_b$:\n$$\\rho_{\\lambda_b} = \\frac{\\pi \\alpha_b \\text{DN}_b}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\nThis expression can be simplified by defining a band-specific conversion factor, $C_b$:\n$$C_b = \\frac{\\pi \\alpha_b}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\nsuch that $\\rho_{\\lambda_b} = C_b \\cdot \\text{DN}_b$.\n\n**Step 2: Calculation of Conversion Factors and Reflectances**\nGiven the solar zenith angle $\\theta_s = 30^{\\circ}$, we have $\\cos(30^{\\circ}) = \\frac{\\sqrt{3}}{2}$. We can now compute the conversion factor $C_b$ for each band.\nFor Band $1$: $C_1 = \\frac{\\pi(1.2)}{1900 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0022911$\nFor Band $2$: $C_2 = \\frac{\\pi(1.0)}{1850 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0019609$\nFor Band $3$: $C_3 = \\frac{\\pi(0.8)}{1600 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0018138$\n\nUsing these factors, we convert the DN values for each pixel to reflectance values.\n- **Band 1 Reflectances ($\\rho_1$):**\n  DNs: $\\{50, 55, 60, 65, 70, 80, 90, 100, 120, 150\\}$\n  Reflectances: $\\{0.1146, 0.1260, 0.1375, 0.1489, 0.1604, 0.1833, 0.2062, 0.2291, 0.2749, 0.3437\\}$\n- **Band 2 Reflectances ($\\rho_2$):**\n  DNs: $\\{60, 65, 75, 85, 90, 95, 110, 130, 160, 180\\}$\n  Reflectances: $\\{0.1177, 0.1275, 0.1471, 0.1667, 0.1765, 0.1863, 0.2157, 0.2549, 0.3137, 0.3530\\}$\n- **Band 3 Reflectances ($\\rho_3$):**\n  DNs: $\\{110, 120, 130, 140, 150, 170, 190, 210, 230, 250\\}$\n  Reflectances: $\\{0.1995, 0.2177, 0.2358, 0.2539, 0.2721, 0.3083, 0.3446, 0.3809, 0.4171, 0.4534\\}$\n\n**Step 3: Construction of Normalized Histograms (PMFs)**\nWe construct the histograms for both DNs and reflectances for each band, using the specified bins, and normalize them by the total number of pixels ($N=10$) to get the PMFs $p^{(b)}$ (pre-calibration) and $q^{(b)}$ (post-calibration).\n\n- **Band 1:**\n  - DN Bins: $[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    Counts: $\\{5, 3, 2\\}$\n    PMF $p^{(1)} = \\{0.5, 0.3, 0.2\\}$\n  - Reflectance Bins: $[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    Counts: $\\{4, 5, 1\\}$\n    PMF $q^{(1)} = \\{0.4, 0.5, 0.1\\}$\n\n- **Band 2:**\n  - DN Bins: $[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    Counts: $\\{3, 4, 3\\}$\n    PMF $p^{(2)} = \\{0.3, 0.4, 0.3\\}$\n  - Reflectance Bins: $[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    Counts: $\\{3, 5, 2\\}$\n    PMF $q^{(2)} = \\{0.3, 0.5, 0.2\\}$\n\n- **Band 3:**\n  - DN Bins: $[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    Counts: $\\{0, 1, 9\\}$\n    PMF $p^{(3)} = \\{0.0, 0.1, 0.9\\}$\n  - Reflectance Bins: $[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    Counts: $\\{0, 5, 5\\}$\n    PMF $q^{(3)} = \\{0.0, 0.5, 0.5\\}$\n\n**Step 4: Computation of Kullback–Leibler Divergence (KLD)**\nThe KLD from distribution $p$ to $q$ is given by $D_{\\mathrm{KL}}\\!\\left(p \\parallel q\\right) = \\sum_{i} p_i \\,\\ln\\!\\left(\\frac{p_i}{q_i}\\right)$. We apply this to each band.\n\n- **Band 1:**\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = p^{(1)}_1 \\ln\\left(\\frac{p^{(1)}_1}{q^{(1)}_1}\\right) + p^{(1)}_2 \\ln\\left(\\frac{p^{(1)}_2}{q^{(1)}_2}\\right) + p^{(1)}_3 \\ln\\left(\\frac{p^{(1)}_3}{q^{(1)}_3}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = 0.5 \\ln\\left(\\frac{0.5}{0.4}\\right) + 0.3 \\ln\\left(\\frac{0.3}{0.5}\\right) + 0.2 \\ln\\left(\\frac{0.2}{0.1}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = 0.5 \\ln(1.25) + 0.3 \\ln(0.6) + 0.2 \\ln(2)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) \\approx 0.5(0.22314) + 0.3(-0.51083) + 0.2(0.69315) \\approx 0.11157 - 0.15325 + 0.13863 \\approx 0.09695$\n\n- **Band 2:**\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) = 0.3 \\ln\\left(\\frac{0.3}{0.3}\\right) + 0.4 \\ln\\left(\\frac{0.4}{0.5}\\right) + 0.3 \\ln\\left(\\frac{0.3}{0.2}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) = 0.3 \\ln(1) + 0.4 \\ln(0.8) + 0.3 \\ln(1.5)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) \\approx 0 + 0.4(-0.22314) + 0.3(0.40547) \\approx -0.08926 + 0.12164 \\approx 0.03238$\n\n- **Band 3:**\n  The first bin has $p^{(3)}_1 = 0$ and $q^{(3)}_1 = 0$. By the stated convention, terms with $p^{(b)}_i = 0$ contribute $0$ to the sum.\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) = 0 + 0.1 \\ln\\left(\\frac{0.1}{0.5}\\right) + 0.9 \\ln\\left(\\frac{0.9}{0.5}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) = 0.1 \\ln(0.2) + 0.9 \\ln(1.8)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) \\approx 0.1(-1.60944) + 0.9(0.58779) \\approx -0.16094 + 0.52901 \\approx 0.36807$\n\n**Step 5: Summation and Final Answer**\nThe multi-band histogram divergence metric is the sum of the individual KLD values.\n$$ \\sum_{b=1}^{3} D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right) \\approx 0.09695 + 0.03238 + 0.36807 \\approx 0.49740 $$\nRounding the final answer to four significant figures gives $0.4974$.",
            "answer": "$$\n\\boxed{0.4974}\n$$"
        },
        {
            "introduction": "Comparing images acquired at different times or with different sensors presents a significant challenge, as variations in illumination and atmospheric conditions can obscure true surface changes. Relative radiometric normalization is a critical procedure for creating a consistent time-series suitable for applications like land cover change detection. This exercise  demonstrates a robust, histogram-based technique that uses the median—a statistic resilient to outliers like clouds or sensor saturation—to align the radiometric properties of a target image to a reference image.",
            "id": "3806073",
            "problem": "A single spectral band from a passive optical satellite sensor with $12$-bit quantization records Digital Numbers (DNs) for two coregistered images over the same land surface mosaic: a target image to be normalized and a reference image defining the radiometric baseline. The target image has a histogram measured at the following DN support $\\{d_i\\}$ with counts $\\{h_T(d_i)\\}$:\n- $d_i \\in \\{0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3800, 4095\\}$,\n- $h_T(d_i) \\in \\{50, 200, 500, 800, 1200, 2000, 4000, 6000, 8000, 9000, 9500, 8000, 6000, 4000, 2500, 1500, 900, 600, 400, 300, 250, 150, 100, 80, 60, 30\\}$ in the same order.\n\nThe reference image has a histogram measured at the same DN support with counts $\\{h_R(d_i)\\}$:\n- $h_R(d_i) \\in \\{100, 400, 800, 1200, 2200, 3000, 5000, 7000, 9000, 10000, 9500, 7000, 5000, 3000, 1800, 1100, 700, 500, 300, 250, 200, 120, 90, 70, 50, 20\\}$ in the same order.\n\nAssume a linear sensor response over the dynamic range with fixed black-level offsets $b_T$ and $b_R$ for the target and reference images, respectively, and unknown multiplicative gain $a$ applied to the target to achieve radiometric normalization. Let the offsets be $b_T = 64$ and $b_R = 60$, expressed in DNs. Under monotone illumination changes without significant atmospheric path radiance differences, a robust normalization aligns the median-centered DNs via\n$$y = a(x - b_T) + b_R,$$\nwhere $x$ is the target DN and $y$ is the normalized DN expected to be statistically consistent with the reference DN.\n\nUsing the empirical cumulative distribution function (CDF) definition $F(d) = \\frac{1}{N}\\sum_{d_i \\leq d} h(d_i)$ for a histogram with total count $N = \\sum_i h(d_i)$, compute:\n1. The empirical CDF $F_T(d)$ for the target image over the provided DN support and determine the median DN $m_T$ as the smallest $d$ such that $F_T(d) \\geq 0.5$.\n2. The median DN $m_R$ for the reference image, using the same definition.\n3. The robust gain $a$ that aligns medians under the given offsets, using\n$$a = \\frac{m_R - b_R}{m_T - b_T}.$$\n\nExplain why the median is preferred to the mean in the presence of saturated bright outliers at high DNs, and finally provide the numerical value of $a$.\n\nRound your final answer for $a$ to four significant figures. Express the final answer as a dimensionless scalar with no units.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and complete.\n\n### Step 1: Problem Validation\nThe given information is:\n- A sensor with $12$-bit quantization ($0$ to $4095$ DN range).\n- Target image histogram: DN support $\\{d_i\\}$ and counts $\\{h_T(d_i)\\}$.\n- Reference image histogram: same DN support $\\{d_i\\}$ and counts $\\{h_R(d_i)\\}$.\n- Target image black-level offset: $b_T = 64$.\n- Reference image black-level offset: $b_R = 60$.\n- Linear normalization model: $y = a(x - b_T) + b_R$.\n- Empirical CDF definition: $F(d) = \\frac{1}{N}\\sum_{d_i \\leq d} h(d_i)$ with $N = \\sum_i h(d_i)$.\n- Median definition: smallest $d$ such that $F(d) \\geq 0.5$.\n- Gain calculation formula: $a = \\frac{m_R - b_R}{m_T - b_T}$.\n\nThe problem is scientifically sound, as it describes a standard method for relative radiometric normalization in remote sensing. All data and definitions required for the calculation are provided, making the problem well-posed and self-contained. The assumptions (linear sensor response, monotone illumination changes) are typical for simplifying such problems. No contradictions or ambiguities are present. The problem is deemed valid.\n\n### Step 2: Solution Derivation\n\nThe solution requires a three-part calculation followed by a conceptual explanation.\n\n**1. Calculation of the Target Image Median ($m_T$)**\n\nFirst, we must compute the total number of pixels, $N_T$, for the target image by summing the histogram counts $h_T(d_i)$:\n$N_T = \\sum_i h_T(d_i)$\n$N_T = 50 + 200 + 500 + 800 + 1200 + 2000 + 4000 + 6000 + 8000 + 9000 + 9500 + 8000 + 6000 + 4000 + 2500 + 1500 + 900 + 600 + 400 + 300 + 250 + 150 + 100 + 80 + 60 + 30 = 66120$.\nThe total number of pixels in the target image is $N_T = 66120$.\n\nThe median $m_T$ is the smallest digital number $d$ for which the cumulative distribution function $F_T(d) \\geq 0.5$. This is equivalent to finding the smallest $d_i$ where the cumulative count $H_T(d_i) = \\sum_{j \\le i} h_T(d_j)$ is greater than or equal to half the total number of pixels, which is $N_T/2 = 33060$.\n\nWe compute the cumulative histogram counts $H_T(d_i)$:\n- $H_T(0) = 50$\n- $H_T(100) = 50 + 200 = 250$\n- $H_T(200) = 250 + 500 = 750$\n- $H_T(300) = 750 + 800 = 1550$\n- $H_T(400) = 1550 + 1200 = 2750$\n- $H_T(500) = 2750 + 2000 = 4750$\n- $H_T(600) = 4750 + 4000 = 8750$\n- $H_T(700) = 8750 + 6000 = 14750$\n- $H_T(800) = 14750 + 8000 = 22750$\n- $H_T(900) = 22750 + 9000 = 31750$\n- $H_T(1000) = 31750 + 9500 = 41250$\n\nThe cumulative count at $d_i = 900$ is $31750$, which is less than $33060$. The cumulative count at the next DN support value, $d_i = 1000$, is $41250$, which is greater than or equal to $33060$. According to the definition, the median is the smallest $d$ for which the condition is met.\nTherefore, the median of the target image is $m_T = 1000$.\n\n**2. Calculation of the Reference Image Median ($m_R$)**\n\nSimilarly, we compute the total number of pixels, $N_R$, for the reference image:\n$N_R = \\sum_i h_R(d_i)$\n$N_R = 100 + 400 + 800 + 1200 + 2200 + 3000 + 5000 + 7000 + 9000 + 10000 + 9500 + 7000 + 5000 + 3000 + 1800 + 1100 + 700 + 500 + 300 + 250 + 200 + 120 + 90 + 70 + 50 + 20 = 68400$.\nThe total number of pixels in the reference image is $N_R = 68400$.\n\nThe median condition is to find the smallest $d_i$ where the cumulative count $H_R(d_i)$ is greater than or equal to $N_R/2 = 34200$.\n\nWe compute the cumulative histogram counts $H_R(d_i)$:\n- $H_R(0) = 100$\n- $H_R(100) = 100 + 400 = 500$\n- $H_R(200) = 500 + 800 = 1300$\n- $H_R(300) = 1300 + 1200 = 2500$\n- $H_R(400) = 2500 + 2200 = 4700$\n- $H_R(500) = 4700 + 3000 = 7700$\n- $H_R(600) = 7700 + 5000 = 12700$\n- $H_R(700) = 12700 + 7000 = 19700$\n- $H_R(800) = 19700 + 9000 = 28700$\n- $H_R(900) = 28700 + 10000 = 38700$\n\nThe cumulative count at $d_i = 800$ is $28700$, which is less than $34200$. The cumulative count at the next DN support value, $d_i = 900$, is $38700$, which exceeds $34200$.\nTherefore, the median of the reference image is $m_R = 900$.\n\n**3. Calculation of the Robust Gain ($a$)**\n\nThe gain factor $a$ is computed using the provided formula and the calculated medians:\n$$a = \\frac{m_R - b_R}{m_T - b_T}$$\nSubstituting the known values: $m_T = 1000$, $m_R = 900$, $b_T = 64$, and $b_R = 60$.\n$$a = \\frac{900 - 60}{1000 - 64} = \\frac{840}{936}$$\nPerforming the division gives:\n$$a \\approx 0.897435897...$$\nRounding to four significant figures, we get:\n$$a \\approx 0.8974$$\n\n**4. Explanation of Median vs. Mean**\n\nThe median is preferred to the mean for tasks like radiometric normalization, especially in the presence of outliers, for reasons related to its robustness as a statistical measure of central tendency.\n\nThe mean of a dataset is the sum of all values divided by the count of values. It is highly sensitive to the magnitude of every single data point. Outliers, which are values that are unusually high or low compared to the rest of the data, can disproportionately influence the mean. In satellite imagery, \"saturated bright outliers\" refer to pixels that record the maximum possible digital number (e.g., $4095$ for a $12$-bit sensor) because the incoming radiance exceeded the sensor's capacity. These saturated values are not a true measure of the surface radiance but an artifact of sensor limitation. A small number of such pixels, for example from clouds or specular reflection, can significantly increase the calculated mean brightness of an image, making it an unrepresentative statistic for the bulk of the scene.\n\nThe median, by contrast, is the value that separates the higher half from the lower half of a data sample. Its value depends on the rank-order of the data, not the specific magnitudes of the extreme values. If the highest DN in the image were artificially doubled, the mean would increase, but the median would remain unchanged. Because the median is not skewed by extreme values, it is considered a robust statistic.\n\nIn the context of aligning two images, using the mean would cause the normalization to be biased by any saturated pixels present in either image. This could lead to an incorrect gain factor that poorly matches the radiometric characteristics of the majority of the non-saturated pixels. By using the median, the normalization is based on the central tendency of the bulk of the data, ignoring the biasing effects of outliers at the tails of the distribution. This results in a more stable and reliable (\"robust\") alignment of the images.",
            "answer": "$$\\boxed{0.8974}$$"
        }
    ]
}