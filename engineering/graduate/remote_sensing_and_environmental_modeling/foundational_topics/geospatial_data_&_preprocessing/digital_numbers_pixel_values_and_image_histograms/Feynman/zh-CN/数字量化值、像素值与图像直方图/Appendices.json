{
    "hands_on_practices": [
        {
            "introduction": "在解读像素值之前，理解其基本构成——信号与噪声——至关重要。本练习将引导您分析传感器的光子传输曲线（Photon Transfer Curve, PTC），这是一种区分散粒噪声（源于信号本身）和读出噪声（源于电子器件）的标准技术。通过将模型拟合到实测数据，您将学习如何提取传感器的基本性能特征，这是对遥感影像进行任何定量分析的关键技能。",
            "id": "3806017",
            "problem": "一个以推扫模式工作的星载传感器，在实验室辐射测量扫描中，记录了在多种曝光设置下均匀辐射目标的数字量化值（DN）图像。在遥感和环境建模的背景下，假设随机图像形成过程及其测量具有以下基本基础：\n\n- 光子到达被建模为泊松过程，因此一个像素中产生的光电子数 $E$ 的方差等于其均值，即 $\\mathrm{Var}(E) = \\mathbb{E}[E]$。\n- 探测器中的电子读出噪声被建模为一个独立的、加性的高斯随机变量 $R$，其均值为零，方差为 $\\sigma_r^2$（单位为电子），即 $R \\sim \\mathcal{N}(0, \\sigma_r^2)$，且独立于 $E$。\n- 系统响应在偏置校正后是线性的，因此 DN 值 $D$ 通过 $D = \\alpha T$ 与总电子数 $T = E + R$ 相关，其中 $\\alpha$ 是系统增益（单位为 $\\mathrm{DN/e^-}$），并且偏置偏移已被移除，使得均值关系为 $\\mathbb{E}[D] = \\alpha \\mathbb{E}[E]$。\n\n基于这些基本原理，推导在辐射扫描中 DN 直方图宽度的方差与 DN 均值之间的关系，该关系应适合通过对 DN 方差与 DN 均值的关系进行直线拟合来进行估计。然后，设计一个算法，该算法根据在不同曝光下从均匀目标区域测得的直方图宽度（DN 标准差）和 DN 均值，估算散粒噪声的尺度（增益 $\\alpha$，单位为 $\\mathrm{DN/e^-}$）和读出噪声的大小（$\\sigma_r$，单位为电子）。\n\n您的程序必须通过对每个提供的测试用例的 DN 方差与 DN 均值进行线性拟合来实现此估计，然后将拟合参数转换为所需的物理量。程序不得要求任何用户输入。\n\n在数值输出中，最终估算的读出噪声（单位为电子）$\\sigma_r$ 和增益 $\\alpha$ 不附加任何物理单位；但是，其解释必须是 $\\sigma_r$ 的单位为 $\\mathrm{e^-}$，$\\alpha$ 的单位为 $\\mathrm{DN/e^-}$。将每个报告的数值四舍五入到六位小数。\n\n测试套件。对于每种情况，您将获得均匀目标区域的 DN 均值数组和相应的直方图宽度（DN 标准差）。所有测量值都经过偏置校正，并在线性响应条件下进行。仅使用给定值。\n\n- 情况 1（一般理想情况，中到高辐射度）：\n  - DN 均值：[$475$, $1425$, $2850$, $5700$, $8550$, $11400$]\n  - 直方图宽度 (DN)：[$21.536$, $36.958$, $52.153$, $73.671$, $90.196$, $104.136$]\n- 情况 2（低光照条件，读出噪声主导边界）：\n  - DN 均值：[$0$, $47.5$, $95$, $190$]\n  - 直方图宽度 (DN)：[$3.515$, $7.585$, $10.130$, $13.889$]\n- 情况 3（一次曝光中存在轻微离群值）：\n  - DN 均值：[$600$, $1800$, $3600$, $7200$, $10800$]\n  - 直方图宽度 (DN)：[$27.495$, $46.872$, $66.0$, $102.442$, $114.0$]\n- 情况 4（不同的传感器增益和读出噪声，中等辐射度范围）：\n  - DN 均值：[$350$, $1400$, $2800$, $4900$]\n  - 直方图宽度 (DN)：[$15.716$, $31.352$, $44.333$, $58.600$]\n\n所需输出格式。您的程序应生成单行输出，其中包含所有情况的结果，格式为方括号括起来的逗号分隔列表。每种情况的结果必须是包含两个浮点数 [$\\alpha$, $\\sigma_r$] 的列表，四舍五入到六位小数，并按上述情况的顺序排列。例如，输出应类似于 [$[$a$,$b$],[$c$,$d$],[$e$,$f$],[$g$,$h$]$]，其中每个符号都是一个浮点数。不应打印任何其他文本。\n\n所有情况的最终答案必须仅为数值浮点数（无单位，无百分号），并完全按照指定方式聚合。",
            "solution": "用户提供的问题已经过评估，并被确定为 **有效**。它在科学上基于传感器噪声建模的既定原则，问题阐述清晰，其组成部分完整且内部一致。因此，我们可以进行正式的求解。\n\n该问题要求基于光子传感和电子噪声的物理模型，推导传感器数字量化值（DN）输出的均值与方差之间的关系。然后，利用此关系来估计关键的传感器参数：系统增益 $\\alpha$ 和读出噪声 $\\sigma_r$。\n\n该物理模型由三个核心原则定义：\n1.  在一个像素处产生的光电子数 $E$ 是一个遵循泊松分布的随机变量。泊松分布的一个基本性质是其方差等于其均值：$\\mathrm{Var}(E) = \\mathbb{E}[E]$。我们用 $\\mu_E$ 表示光电子的平均数量。因此，$\\mathrm{Var}(E) = \\mu_E$。\n2.  电子读出噪声 $R$ 是一个独立的、加性的高斯随机变量，其均值为零，方差为 $\\sigma_r^2$。即 $\\mathbb{E}[R] = 0$ 且 $\\mathrm{Var}(R) = \\sigma_r^2$。$R$ 的均值和方差的单位都是电子数。\n3.  在一个像素处累积的总电子数 $T$ 是光电子和读出噪声之和：$T = E + R$。最终的数字量化值 $D$ 与总电子数 $T$ 成线性比例，系统增益为 $\\alpha$（单位为 $\\mathrm{DN/e^-}$）。该关系式为 $D = \\alpha T$。问题指明偏置偏移已被移除。\n\n我们的目标是找到数字量化值均值 $\\mathbb{E}[D]$ 与数字量化值方差 $\\mathrm{Var}(D)$ 之间的关系。\n\n首先，我们推导数字量化值均值的表达式，记为 $\\mu_D$：\n$\\mu_D = \\mathbb{E}[D] = \\mathbb{E}[\\alpha T] = \\alpha \\mathbb{E}[T]$\n利用期望的线性性质和 $T$ 的定义：\n$\\mathbb{E}[T] = \\mathbb{E}[E + R] = \\mathbb{E}[E] + \\mathbb{E}[R]$\n代入给定的 $E$ 和 $R$ 的均值：\n$\\mathbb{E}[T] = \\mu_E + 0 = \\mu_E$\n因此，数字量化值均值与光电子均值成正比：\n$$\n\\mu_D = \\alpha \\mu_E\n$$\n\n接下来，我们推导数字量化值方差的表达式，记为 $\\sigma_D^2$：\n$\\sigma_D^2 = \\mathrm{Var}(D) = \\mathrm{Var}(\\alpha T)$\n利用方差的性质 $\\mathrm{Var}(cX) = c^2 \\mathrm{Var}(X)$：\n$\\sigma_D^2 = \\alpha^2 \\mathrm{Var}(T)$\n由于 $E$ 和 $R$ 被声明为独立随机变量，它们的和的方差等于它们方差的和：\n$\\mathrm{Var}(T) = \\mathrm{Var}(E + R) = \\mathrm{Var}(E) + \\mathrm{Var}(R)$\n代入已知的 $E$ 和 $R$ 的方差：\n$\\mathrm{Var}(T) = \\mu_E + \\sigma_r^2$\n因此，数字量化值的方差为：\n$$\n\\sigma_D^2 = \\alpha^2 (\\mu_E + \\sigma_r^2) = \\alpha^2 \\mu_E + \\alpha^2 \\sigma_r^2\n$$\n\n现在，我们必须建立一个连接可观测值 $\\mu_D$ 和 $\\sigma_D^2$ 的关系。我们可以通过使用均值的表达式来消除未观测变量 $\\mu_E$。由 $\\mu_D = \\alpha \\mu_E$，我们可以写出 $\\mu_E = \\mu_D / \\alpha$。将此代入方差方程：\n$$\n\\sigma_D^2 = \\alpha^2 \\left(\\frac{\\mu_D}{\\alpha}\\right) + \\alpha^2 \\sigma_r^2\n$$\n这可以简化为最终的线性关系：\n$$\n\\sigma_D^2 = \\alpha \\mu_D + \\alpha^2 \\sigma_r^2\n$$\n这个方程的形式是 $y = mx + c$，其中：\n-   因变量 $y$ 是数字量化值的方差 $\\sigma_D^2$。\n-   自变量 $x$ 是数字量化值的均值 $\\mu_D$。\n-   直线的斜率 $m$ 是系统增益 $\\alpha$。\n-   直线的 y 截距 $c$ 是 $\\alpha^2 \\sigma_r^2$。\n\n问题提供了测量的 DN 均值（$\\mu_D$）集及其对应的直方图宽度，即标准差（$\\sigma_D$）。要使用推导出的线性模型，我们必须首先将标准差平方以获得方差（$\\sigma_D^2$）。然后，可以对 $(\\mu_D, \\sigma_D^2)$ 数据点进行线性回归（最小二乘拟合），以估计斜率 $m$ 和 y 截距 $c$。\n\n一旦确定了拟合参数 $m$ 和 $c$，就可以如下计算物理传感器参数 $\\alpha$ 和 $\\sigma_r$：\n1.  增益 $\\alpha$ 等于拟合直线的斜率：\n    $$\n    \\alpha = m\n    $$\n2.  读出噪声 $\\sigma_r$ 由 y 截距确定。我们有 $c = \\alpha^2 \\sigma_r^2$。代入 $\\alpha=m$，得到 $c = m^2 \\sigma_r^2$。解出 $\\sigma_r$：\n    $$\n    \\sigma_r^2 = \\frac{c}{m^2} \\implies \\sigma_r = \\frac{\\sqrt{c}}{m}\n    $$\n    物理约束要求方差 $c$ 必须为非负，增益 $m$ 必须为正。在实践中，测量噪声可能导致拟合得到一个小的负截距；在这种情况下，物理上有意义的解释是读出噪声为零或低于测量阈值，因此我们应将任何负的 $c$ 视为 $0$。\n\n因此，算法如下：\n1.  对于每个测试用例，取输入的 DN 均值和标准差数组。\n2.  通过将每个标准差平方，创建一个对应的 DN 方差数组。\n3.  对 DN 方差与 DN 均值进行线性最小二乘拟合，以获得斜率 $m$ 和 y 截距 $c$。\n4.  计算增益 $\\alpha = m$。\n5.  计算读出噪声 $\\sigma_r = \\sqrt{\\max(0, c)} / m$。\n6.  将 $\\alpha$ 和 $\\sigma_r$ 都四舍五入到六位小数，并按指定格式输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the sensor characterization problem for all test cases.\n    The method is based on the Photon Transfer Curve (PTC) analysis,\n    where a linear relationship between signal variance and signal mean is exploited.\n    The derived relationship is Var(DN) = alpha * Mean(DN) + (alpha * sigma_r)^2.\n    A linear fit of Var(DN) vs. Mean(DN) yields a slope `m` and intercept `c`.\n    The physical parameters are then:\n    - Gain (alpha) = m\n    - Read Noise (sigma_r) = sqrt(c) / m\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general happy path, mid to high radiance)\n        (\n            np.array([475, 1425, 2850, 5700, 8550, 11400], dtype=float),\n            np.array([21.536, 36.958, 52.153, 73.671, 90.196, 104.136], dtype=float),\n        ),\n        # Case 2 (low-light regime, read noise dominated boundary)\n        (\n            np.array([0, 47.5, 95, 190], dtype=float),\n            np.array([3.515, 7.585, 10.130, 13.889], dtype=float),\n        ),\n        # Case 3 (presence of a mild outlier in one exposure)\n        (\n            np.array([600, 1800, 3600, 7200, 10800], dtype=float),\n            np.array([27.495, 46.872, 66.0, 102.442, 114.0], dtype=float),\n        ),\n        # Case 4 (different sensor gain and read noise, moderate radiance range)\n        (\n            np.array([350, 1400, 2800, 4900], dtype=float),\n            np.array([15.716, 31.352, 44.333, 58.600], dtype=float),\n        ),\n    ]\n\n    results = []\n    for mean_dn, std_dev_dn in test_cases:\n        # The independent variable x is the mean DN\n        x = mean_dn\n        \n        # The dependent variable y is the variance of the DN, which is the square of the histogram width (std dev)\n        y = np.square(std_dev_dn)\n        \n        # Perform a linear least-squares fit (polynomial of degree 1)\n        # This returns the slope (m) and y-intercept (c) of the fitted line y = mx + c\n        m, c = np.polyfit(x, y, 1)\n        \n        # From the derived model, the gain alpha is the slope of the line\n        alpha = m\n        \n        # The read noise sigma_r is derived from the intercept c = (alpha * sigma_r)^2\n        # So, sigma_r = sqrt(c) / alpha.\n        # Intercept c must be non-negative for a physical interpretation.\n        # Fit errors on noisy data can result in a small negative intercept.\n        # In such a case, the physically meaningful interpretation is a read noise of zero.\n        if alpha > 0:\n            sigma_r = np.sqrt(max(0, c)) / alpha\n        else:\n            # A non-positive gain is physically unrealistic. In this unlikely event, read noise is undefined.\n            # Handle this gracefully, e.g., by setting it to 0 or NaN.\n            # For this problem's context, with valid data, alpha should be positive.\n            sigma_r = 0.0\n\n        # Round the results to six decimal places as required\n        alpha_rounded = round(alpha, 6)\n        sigma_r_rounded = round(sigma_r, 6)\n        \n        results.append([alpha_rounded, sigma_r_rounded])\n\n    # Format the final output string to exactly match the required format: [[a,b],[c,d],...]\n    case_strings = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output = f\"[{','.join(case_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "原始的数字量（Digital Numbers, DN）值是设备相关的；要进行科学应用，就必须将其转换为物理量。本练习将演示辐射定量的基本工作流程，即将无单位的DN值转换为大气层顶（Top-of-Atmosphere, TOA）反射率——一种衡量目标反射能量的标准化物理量。通过应用波段特定的增益、偏移和太阳光照数据，您将亲身体会到定标如何重塑影像直方图，从而揭示地表真实的光谱特性。",
            "id": "3806065",
            "problem": "一个无源多光谱卫星传感器在一个均质农田上空，当太阳天顶角为 $\\theta_s = 30^{\\circ}$ 时，采集了一小部分像素。平台报告了三个光谱波段的原始数字量化值（DN）：波段1（蓝色）、波段2（绿色）和波段3（近红外）。每个波段 $b$ 的辐射定标是线性的，其特征是增益 $\\alpha_b$ 和偏移 $\\beta_b$，以及特定于波段的大气层外太阳辐照度 $E_{0,\\lambda_b}$。为计算大气层顶（TOA）反射率，假设大气效应可忽略不计，且所有波段的偏移均为零，即 $\\beta_b = 0$。参数如下：\n- 波段1（蓝色）：$\\alpha_1 = 1.2$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu \\mathrm{m}^{-1}\\,\\text{per DN}\\right)$, $E_{0,\\lambda_1} = 1900$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu \\mathrm{m}^{-1}\\right)$。\n- 波段2（绿色）：$\\alpha_2 = 1.0$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu \\mathrm{m}^{-1}\\,\\text{per DN}\\right)$, $E_{0,\\lambda_2} = 1850$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu \\mathrm{m}^{-1}\\right)$。\n- 波段3（近红外）：$\\alpha_3 = 0.8$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu \\mathrm{m}^{-1}\\,\\text{per DN}\\right)$, $E_{0,\\lambda_3} = 1600$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu \\mathrm{m}^{-1}\\right)$。\n\n对于每个波段，传感器在10个空间像素上记录了以下原始DN值：\n- 波段1：$\\{50, 55, 60, 65, 70, 80, 90, 100, 120, 150\\}$。\n- 波段2：$\\{60, 65, 75, 85, 90, 95, 110, 130, 160, 180\\}$。\n- 波段3：$\\{110, 120, 130, 140, 150, 170, 190, 210, 230, 250\\}$。\n\n从辐射亮度、线性辐射定标和TOA反射率的定义出发，推导将DN映射到TOA反射率 $\\rho_{\\lambda_b}$ 的表达式，并计算每个波段中每个像素的反射率。为每个波段构建两个包含3个区间的直方图：\n- 使用DN区间 $[0, 80)$、$[80, 120)$ 和 $[120, \\infty)$ 的定标前DN直方图。\n- 使用反射率区间 $[0, 0.15)$、$[0.15, 0.30)$ 和 $[0.30, \\infty)$ 的定标后反射率直方图。\n\n将每个直方图归一化为这3个区间上的离散概率质量函数。对于每个波段 $b$，使用公式 $D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right) = \\sum_{i=1}^{3} p^{(b)}_i \\,\\ln\\!\\left(\\frac{p^{(b)}_i}{q^{(b)}_i}\\right)$ 计算从定标前分布 $p^{(b)}$ 到定标后分布 $q^{(b)}$ 的Kullback–Leibler散度（KLD），约定当 $p^{(b)}_i = 0$ 时，该项对总和的贡献为0。最后，报告定义为总和 $\\sum_{b=1}^{3} D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right)$ 的多波段直方图散度度量。将最终答案四舍五入到四位有效数字。将最终度量表示为一个无量纲的小数。",
            "solution": "该问题经评估具有科学依据、提法得当、客观且自洽。所有必要的数据、定义和约束都已提供，并且它们与遥感和信息论的既定原则相一致。因此，该问题被认为是**有效的**，下面给出完整解答。\n\n分析过程分为以下五个连续步骤：\n1.  推导从数字量化值（DN）到大气层顶（TOA）反射率的公式。\n2.  计算所有三个光谱波段中每个像素的反射率值。\n3.  构建DN值（定标前）和反射率值（定标后）的归一化直方图（概率质量函数，PMF）。\n4.  计算每个波段的Kullback–Leibler散度（KLD）。\n5.  对KLD值求和，以获得最终的多波段直方图散度度量。\n\n**步骤1：从DN推导TOA反射率**\n传感器处波段 $b$ 的光谱辐射亮度 $L_{\\lambda_b}$ 由以下线性辐射定标方程给出：\n$$L_{\\lambda_b} = \\alpha_b \\cdot \\text{DN}_b + \\beta_b$$\n其中 $\\alpha_b$ 是增益，$\\beta_b$ 是偏移，$\\text{DN}_b$ 是数字量化值。问题陈述偏移为零，$\\beta_b = 0$。因此，方程简化为：\n$$L_{\\lambda_b} = \\alpha_b \\cdot \\text{DN}_b$$\n\n假设为朗伯表面且大气效应可忽略不计，TOA反射率 $\\rho_{\\lambda_b}$ 将测得的上行辐射亮度 $L_{\\lambda_b}$ 与入射太阳辐照度关联起来。大气层顶水平表面上的太阳辐照度由 $E_{0,\\lambda_b} \\cos(\\theta_s)$ 给出，其中 $E_{0,\\lambda_b}$ 是特定波段的平均大气层外太阳辐照度，$\\theta_s$ 是太阳天顶角。从理想朗伯表面反射的辐射亮度在所有方向上均匀分布，其关系式为：\n$$L_{\\lambda_b} = \\frac{\\rho_{\\lambda_b} E_{0,\\lambda_b} \\cos(\\theta_s)}{\\pi}$$\n解出 $\\rho_{\\lambda_b}$ 得：\n$$\\rho_{\\lambda_b} = \\frac{\\pi L_{\\lambda_b}}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\n将 $L_{\\lambda_b}$ 关于 $\\text{DN}_b$ 的表达式代入：\n$$\\rho_{\\lambda_b} = \\frac{\\pi \\alpha_b \\text{DN}_b}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\n此表达式可通过定义一个特定于波段的转换因子 $C_b$ 来简化：\n$$C_b = \\frac{\\pi \\alpha_b}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\n使得 $\\rho_{\\lambda_b} = C_b \\cdot \\text{DN}_b$。\n\n**步骤2：计算转换因子和反射率**\n给定太阳天顶角 $\\theta_s = 30^{\\circ}$，我们有 $\\cos(30^{\\circ}) = \\frac{\\sqrt{3}}{2}$。现在我们可以计算每个波段的转换因子 $C_b$。\n对于波段1：$C_1 = \\frac{\\pi(1.2)}{1900 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0022911$\n对于波段2：$C_2 = \\frac{\\pi(1.0)}{1850 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0019609$\n对于波段3：$C_3 = \\frac{\\pi(0.8)}{1600 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0018138$\n\n使用这些因子，我们将每个像素的DN值转换为反射率值。\n- **波段1反射率 ($\\rho_1$)：**\n  DN值：$\\{50, 55, 60, 65, 70, 80, 90, 100, 120, 150\\}$\n  反射率：$\\{0.1146, 0.1260, 0.1375, 0.1489, 0.1604, 0.1833, 0.2062, 0.2291, 0.2749, 0.3437\\}$\n- **波段2反射率 ($\\rho_2$)：**\n  DN值：$\\{60, 65, 75, 85, 90, 95, 110, 130, 160, 180\\}$\n  反射率：$\\{0.1177, 0.1275, 0.1471, 0.1667, 0.1765, 0.1863, 0.2157, 0.2549, 0.3137, 0.3530\\}$\n- **波段3反射率 ($\\rho_3$)：**\n  DN值：$\\{110, 120, 130, 140, 150, 170, 190, 210, 230, 250\\}$\n  反射率：$\\{0.1995, 0.2177, 0.2358, 0.2539, 0.2721, 0.3083, 0.3446, 0.3809, 0.4171, 0.4534\\}$\n\n**步骤3：构建归一化直方图（PMF）**\n我们使用指定的区间为每个波段的DN和反射率构建直方图，并通过像素总数（$N=10$）进行归一化，以得到PMF $p^{(b)}$（定标前）和 $q^{(b)}$（定标后）。\n\n- **波段1：**\n  - DN区间：$[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    计数：$\\{5, 3, 2\\}$\n    概率质量函数 $p^{(1)} = \\{0.5, 0.3, 0.2\\}$\n  - 反射率区间：$[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    计数：$\\{4, 5, 1\\}$\n    概率质量函数 $q^{(1)} = \\{0.4, 0.5, 0.1\\}$\n\n- **波段2：**\n  - DN区间：$[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    计数：$\\{3, 4, 3\\}$\n    概率质量函数 $p^{(2)} = \\{0.3, 0.4, 0.3\\}$\n  - 反射率区间：$[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    计数：$\\{3, 5, 2\\}$\n    概率质量函数 $q^{(2)} = \\{0.3, 0.5, 0.2\\}$\n\n- **波段3：**\n  - DN区间：$[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    计数：$\\{0, 1, 9\\}$\n    概率质量函数 $p^{(3)} = \\{0.0, 0.1, 0.9\\}$\n  - 反射率区间：$[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    计数：$\\{0, 5, 5\\}$\n    概率质量函数 $q^{(3)} = \\{0.0, 0.5, 0.5\\}$\n\n**步骤4：计算Kullback–Leibler散度（KLD）**\n从分布 $p$ 到 $q$ 的KLD由 $D_{\\mathrm{KL}}\\!\\left(p \\parallel q\\right) = \\sum_{i} p_i \\,\\ln\\!\\left(\\frac{p_i}{q_i}\\right)$ 给出。我们将其应用于每个波段。\n\n- **波段1：**\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = p^{(1)}_1 \\ln\\left(\\frac{p^{(1)}_1}{q^{(1)}_1}\\right) + p^{(1)}_2 \\ln\\left(\\frac{p^{(1)}_2}{q^{(1)}_2}\\right) + p^{(1)}_3 \\ln\\left(\\frac{p^{(1)}_3}{q^{(1)}_3}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = 0.5 \\ln\\left(\\frac{0.5}{0.4}\\right) + 0.3 \\ln\\left(\\frac{0.3}{0.5}\\right) + 0.2 \\ln\\left(\\frac{0.2}{0.1}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = 0.5 \\ln(1.25) + 0.3 \\ln(0.6) + 0.2 \\ln(2)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) \\approx 0.5(0.22314) + 0.3(-0.51083) + 0.2(0.69315) \\approx 0.11157 - 0.15325 + 0.13863 \\approx 0.09695$\n\n- **波段2：**\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) = 0.3 \\ln\\left(\\frac{0.3}{0.3}\\right) + 0.4 \\ln\\left(\\frac{0.4}{0.5}\\right) + 0.3 \\ln\\left(\\frac{0.3}{0.2}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) = 0.3 \\ln(1) + 0.4 \\ln(0.8) + 0.3 \\ln(1.5)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) \\approx 0 + 0.4(-0.22314) + 0.3(0.40547) \\approx -0.08926 + 0.12164 \\approx 0.03238$\n\n- **波段3：**\n  第一个区间的 $p^{(3)}_1 = 0$ 且 $q^{(3)}_1 = 0$。根据所述约定，$p^{(b)}_i = 0$ 的项对总和的贡献为0。\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) = 0 + 0.1 \\ln\\left(\\frac{0.1}{0.5}\\right) + 0.9 \\ln\\left(\\frac{0.9}{0.5}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) = 0.1 \\ln(0.2) + 0.9 \\ln(1.8)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) \\approx 0.1(-1.60944) + 0.9(0.58779) \\approx -0.16094 + 0.52901 \\approx 0.36807$\n\n**步骤5：求和与最终答案**\n多波段直方图散度度量是各个KLD值的总和。\n$$ \\sum_{b=1}^{3} D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right) \\approx 0.09695 + 0.03238 + 0.36807 \\approx 0.49740 $$\n将最终答案四舍五入到四位有效数字，得到 $0.4974$。",
            "answer": "$$\n\\boxed{0.4974}\n$$"
        },
        {
            "introduction": "在比较同一地点不同时间拍摄的影像时，光照或大气条件的变化可能会掩盖真实的地表变化。本练习介绍了一种强大的技术——相对辐射归一化，它利用影像直方图来使数据标准化。您将实现一种基于对齐直方图中位数的稳健方法，从而理解为何像中位数这样的统计量在处理云或饱和像素等现实世界数据缺陷时是不可或缺的。",
            "id": "3806073",
            "problem": "一个具有$12$位量化的无源光学卫星传感器的单光谱波段，记录了同一地表镶嵌图上两幅已配准影像的数字量化值（DNs）：一幅是待归一化的目标影像，另一幅是定义辐射基线的参考影像。目标影像的直方图在以下DN支撑集 $\\{d_i\\}$ 上测量，其计数为 $\\{h_T(d_i)\\}$：\n- $d_i \\in \\{0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3800, 4095\\}$,\n- $h_T(d_i) \\in \\{50, 200, 500, 800, 1200, 2000, 4000, 6000, 8000, 9000, 9500, 8000, 6000, 4000, 2500, 1500, 900, 600, 400, 300, 250, 150, 100, 80, 60, 30\\}$，顺序相同。\n\n参考影像在相同的DN支撑集上测量的直方图，其计数为 $\\{h_R(d_i)\\}$：\n- $h_R(d_i) \\in \\{100, 400, 800, 1200, 2200, 3000, 5000, 7000, 9000, 10000, 9500, 7000, 5000, 3000, 1800, 1100, 700, 500, 300, 250, 200, 120, 90, 70, 50, 20\\}$，顺序相同。\n\n假设传感器在动态范围内具有线性响应，目标影像和参考影像分别具有固定的黑电平偏移 $b_T$ 和 $b_R$，并且对目标影像应用未知的乘性增益 $a$ 以实现辐射归一化。设偏移量以DNs表示为 $b_T = 64$ 和 $b_R = 60$。在没有显著大气路径辐射差异的单调光照变化下，一种稳健的归一化方法通过以下公式对齐以中位数为中心的DN值：\n$$y = a\\,(x - b_T) + b_R,$$\n其中 $x$ 是目标DN值，$y$ 是归一化后的DN值，预期与参考DN值在统计上一致。\n\n使用经验累积分布函数（CDF）的定义 $F(d) = \\frac{1}{N}\\sum_{d_i \\leq d} h(d_i)$，对于总计数为 $N = \\sum_i h(d_i)$ 的直方图，计算：\n1. 目标影像在给定DN支撑集上的经验CDF $F_T(d)$，并确定中位数DN值 $m_T$ 为满足 $F_T(d) \\geq 0.5$ 的最小 $d$。\n2. 使用相同的定义，计算参考影像的中位数DN值 $m_R$。\n3. 使用给定的偏移量和以下公式，计算对齐中位数的稳健增益 $a$：\n$$a = \\frac{m_R - b_R}{m_T - b_T}.$$\n\n解释为什么在高DN值处存在饱和亮异常值时，中位数比均值更受青睐，并最终给出 $a$ 的数值。\n\n将您对 $a$ 的最终答案四舍五入到四位有效数字。最终答案应表示为一个无单位的无量纲标量。",
            "solution": "首先验证问题，以确保其科学上合理、问题明确且信息完整。\n\n### 步骤 1：问题验证\n给定的信息是：\n- 一个具有$12$位量化（$0$至$4095$ DN范围）的传感器。\n- 目标影像直方图：DN支撑集 $\\{d_i\\}$ 和计数 $\\{h_T(d_i)\\}$。\n- 参考影像直方图：相同的DN支撑集 $\\{d_i\\}$ 和计数 $\\{h_R(d_i)\\}$。\n- 目标影像黑电平偏移：$b_T = 64$。\n- 参考影像黑电平偏移：$b_R = 60$。\n- 线性归一化模型：$y = a\\,(x - b_T) + b_R$。\n- 经验CDF定义：$F(d) = \\frac{1}{N}\\sum_{d_i \\leq d} h(d_i)$，其中 $N = \\sum_i h(d_i)$。\n- 中位数定义：满足 $F(d) \\geq 0.5$ 的最小 $d$。\n- 增益计算公式：$a = \\frac{m_R - b_R}{m_T - b_T}$。\n\n该问题在科学上是合理的，因为它描述了遥感中相对辐射归一化的一种标准方法。计算所需的所有数据和定义均已提供，使得问题明确且自洽。其假设（线性传感器响应、单调光照变化）是简化此类问题的典型假设。不存在矛盾或含糊之处。该问题被认定为有效。\n\n### 步骤 2：求解推导\n\n求解过程需要三部分的计算，然后是一个概念性解释。\n\n**1. 计算目标影像中位数 ($m_T$)**\n\n首先，我们必须通过对直方图计数 $h_T(d_i)$ 求和来计算目标影像的总像素数 $N_T$：\n$N_T = \\sum_i h_T(d_i)$\n$N_T = 50 + 200 + 500 + 800 + 1200 + 2000 + 4000 + 6000 + 8000 + 9000 + 9500 + 8000 + 6000 + 4000 + 2500 + 1500 + 900 + 600 + 400 + 300 + 250 + 150 + 100 + 80 + 60 + 30 = 66120$。\n目标影像中的总像素数为 $N_T = 66120$。\n\n中位数 $m_T$ 是使累积分布函数 $F_T(d) \\geq 0.5$ 的最小数字量化值 $d$。这等价于找到最小的 $d_i$，使得累积计数 $H_T(d_i) = \\sum_{j \\le i} h_T(d_j)$ 大于或等于总像素数的一半，即 $N_T/2 = 33060$。\n\n我们计算累积直方图计数 $H_T(d_i)$：\n- $H_T(0) = 50$\n- $H_T(100) = 50 + 200 = 250$\n- $H_T(200) = 250 + 500 = 750$\n- $H_T(300) = 750 + 800 = 1550$\n- $H_T(400) = 1550 + 1200 = 2750$\n- $H_T(500) = 2750 + 2000 = 4750$\n- $H_T(600) = 4750 + 4000 = 8750$\n- $H_T(700) = 8750 + 6000 = 14750$\n- $H_T(800) = 14750 + 8000 = 22750$\n- $H_T(900) = 22750 + 9000 = 31750$\n- $H_T(1000) = 31750 + 9500 = 41250$\n\n在 $d_i = 900$ 处的累积计数为 $31750$，小于 $33060$。在下一个DN支撑值 $d_i = 1000$ 处的累积计数为 $41250$，大于或等于 $33060$。根据定义，中位数是满足条件的最小 $d$。\n因此，目标影像的中位数为 $m_T = 1000$。\n\n**2. 计算参考影像中位数 ($m_R$)**\n\n同样，我们计算参考影像的总像素数 $N_R$：\n$N_R = \\sum_i h_R(d_i)$\n$N_R = 100 + 400 + 800 + 1200 + 2200 + 3000 + 5000 + 7000 + 9000 + 10000 + 9500 + 7000 + 5000 + 3000 + 1800 + 1100 + 700 + 500 + 300 + 250 + 200 + 120 + 90 + 70 + 50 + 20 = 68400$。\n参考影像中的总像素数为 $N_R = 68400$。\n\n中位数条件是找到最小的 $d_i$，使得累积计数 $H_R(d_i)$ 大于或等于 $N_R/2 = 34200$。\n\n我们计算累积直方图计数 $H_R(d_i)$：\n- $H_R(0) = 100$\n- $H_R(100) = 100 + 400 = 500$\n- $H_R(200) = 500 + 800 = 1300$\n- $H_R(300) = 1300 + 1200 = 2500$\n- $H_R(400) = 2500 + 2200 = 4700$\n- $H_R(500) = 4700 + 3000 = 7700$\n- $H_R(600) = 7700 + 5000 = 12700$\n- $H_R(700) = 12700 + 7000 = 19700$\n- $H_R(800) = 19700 + 9000 = 28700$\n- $H_R(900) = 28700 + 10000 = 38700$\n\n在 $d_i = 800$ 处的累积计数为 $28700$，小于 $34200$。在下一个DN支撑值 $d_i = 900$ 处的累积计数为 $38700$，超过了 $34200$。\n因此，参考影像的中位数为 $m_R = 900$。\n\n**3. 计算稳健增益 ($a$)**\n\n增益因子 $a$ 使用提供的公式和计算出的中位数进行计算：\n$$a = \\frac{m_R - b_R}{m_T - b_T}$$\n代入已知值：$m_T = 1000$，$m_R = 900$，$b_T = 64$ 和 $b_R = 60$。\n$$a = \\frac{900 - 60}{1000 - 64} = \\frac{840}{936}$$\n进行除法运算得到：\n$$a \\approx 0.897435897...$$\n四舍五入到四位有效数字，我们得到：\n$$a \\approx 0.8974$$\n\n**4. 中位数与均值的对比解释**\n\n对于辐射归一化等任务，特别是在存在异常值的情况下，中位数比均值更受青睐，这与其作为集中趋势的统计度量的稳健性有关。\n\n数据集的均值是所有值的总和除以值的数量。它对每个数据点的大小都高度敏感。异常值，即与数据其余部分相比异常高或低的值，会不成比例地影响均值。在卫星影像中，“饱和亮异常值”指的是记录了可能的最大数字量化值（例如，对于$12$位传感器为$4095$）的像素，因为入射辐射超出了传感器的能力范围。这些饱和值不是地表辐射的真实度量，而是传感器限制造成的人为结果。少量此类像素（例如来自云层或镜面反射）会显著增加计算出的影像平均亮度，使其成为一个不能代表场景主体的不具代表性的统计量。\n\n相比之下，中位数是将数据样本的较高一半与较低一半分开的值。它的值取决于数据的排序，而不是极端值的具体大小。如果影像中的最高DN值被人为地加倍，均值会增加，但中位数将保持不变。因为中位数不受极端值的影响而产生偏斜，所以它被认为是一个稳健的统计量。\n\n在对齐两幅影像的背景下，使用均值会导致归一化因任一影像中存在的饱和像素而产生偏差。这可能导致不正确的增益因子，无法很好地匹配大多数非饱和像素的辐射特性。通过使用中位数，归一化基于大部分数据的集中趋势，忽略了分布尾部异常值的偏倚效应。这会使得影像的对齐更加稳定和可靠（即“稳健”）。",
            "answer": "$$\\boxed{0.8974}$$"
        }
    ]
}