{
    "hands_on_practices": [
        {
            "introduction": "水量平衡方程是水文学的基本核算框架，它基于质量守恒定律。在实践中，对降水（$P$）、蒸散发（$E$）和径流（$Q$）的测量不可避免地存在误差，这导致水量平衡计算中出现不闭合项。本练习  将指导你通过动手编程，量化这种不平衡，并利用误差传播理论追溯其不确定性的来源，这是诊断和评估水文模型与数据产品的关键技能。",
            "id": "3814655",
            "problem": "给定流域平均的降水量 (P)、蒸散发量 (E) 和径流量 (Q) 的多年逐月序列，每个值都表示为以毫米/月为单位的流域水深。从控制体的质量守恒出发，水量平衡原理指出，在某个时间间隔内，陆地水储量的变化等于入流量减去出流量。当储量变化无法被独立约束时，通过汇总入流量和出流量并检查净不平衡量，来评估多年期间的闭合残差。将 $P$、$E$ 和 $Q$ 的逐月不确定性视为独立的，并以逐月标准差为特征，使用一阶方差传播将闭合误差的不确定性归因于每个分量。您的程序必须为每个测试用例实现以下任务：\n\n1. 基于 $P$、$E$ 和 $Q$，计算作为入流量减去出流量的逐月残差序列。\n2. 汇总整个多年期间的逐月残差，以获得净不平衡量 $I$（单位：毫米）。\n3. 使用跨月份和跨分量的独立性假设和一阶方差传播，计算 $I$ 的传播不确定性，记为 $\\sigma_I$（单位：毫米）。\n4. 计算来自 $P$、$E$ 和 $Q$ 的方差对 $I$ 的总方差的分数贡献，分别记为 $f_P$、$f_E$ 和 $f_Q$，每个值都以小数形式表示。每个分数贡献必须为非负，并且它们的和在四舍五入容差范围内必须等于 $1$。\n\n将 $I$ 和 $\\sigma_I$ 以毫米表示，并四舍五入到三位小数。将 $f_P$、$f_E$ 和 $f_Q$ 表示为小数，并四舍五入到三位小数（不要使用百分号）。\n\n下面提供了测试套件参数。每个测试用例包含 $T = 24$ 个月（$2$ 年），其中第一年的数据重复以构成第二年。对于每个用例，每个分量内的逐月不确定性是恒定的，但不同分量之间可以不同。\n\n测试用例 1（季节性变化，中等不确定性）：\n- 第一年 $P$：$80$、$60$、$70$、$75$、$90$、$100$、$120$、$110$、$95$、$85$、$70$、$65$。\n- 第一年 $E$：$30$、$35$、$40$、$50$、$60$、$80$、$100$、$95$、$70$、$50$、$40$、$35$。\n- 第一年 $Q$：$20$、$15$、$18$、$22$、$25$、$30$、$35$、$33$、$28$、$24$、$20$、$18$。\n- 逐月不确定性标准差：$\\sigma_P = 5$ 毫米，$\\sigma_E = 8$ 毫米，$\\sigma_Q = 6$ 毫米。\n\n测试用例 2（精确逐月闭合，非零不确定性）：\n- 第一年 $E$：$25$、$30$、$35$、$40$、$50$、$70$、$90$、$85$、$60$、$45$、$35$、$30$。\n- 第一年 $Q$：$15$、$20$、$25$、$35$、$40$、$40$、$45$、$40$、$35$、$35$、$25$、$20$。\n- 第一年 $P$：$40$、$50$、$60$、$75$、$90$、$110$、$135$、$125$、$95$、$80$、$60$、$50$。\n- 逐月不确定性标准差：$\\sigma_P = 3$ 毫米，$\\sigma_E = 5$ 毫米，$\\sigma_Q = 4$ 毫米。\n\n测试用例 3（蒸散发不确定性占主导）：\n- 第一年 $P$：$70$、$55$、$60$、$65$、$85$、$95$、$110$、$105$、$90$、$80$、$65$、$60$。\n- 第一年 $E$：$40$、$45$、$50$、$55$、$65$、$85$、$95$、$90$、$70$、$55$、$50$、$45$。\n- 第一年 $Q$：$20$、$18$、$17$、$19$、$22$、$28$、$30$、$28$、$24$、$22$、$20$、$18$。\n- 逐月不确定性标准差：$\\sigma_P = 2$ 毫米，$\\sigma_E = 20$ 毫米，$\\sigma_Q = 1$ 毫米。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于测试用例 1、2 和 3，输出必须按顺序包含以下值：$I$、$\\sigma_I$、$f_P$、$f_E$、$f_Q$，然后对下一个测试用例重复此格式。例如，格式为 $[I_1,\\sigma_{I,1},f_{P,1},f_{E,1},f_{Q,1},I_2,\\sigma_{I,2},f_{P,2},f_{E,2},f_{Q,2},I_3,\\sigma_{I,3},f_{P,3},f_{E,3},f_{Q,3}]$，每个数值条目都四舍五入到三位小数。",
            "solution": "该问题被评估为有效的，因为它在科学上基于质量守恒原理，数学上是适定的、客观的，并包含唯一解所需的所有必要信息。\n\n指导此分析的基本原理是应用于流域的质量守恒，通常表示为水量平衡方程。对于一个离散的时间间隔 $i$（在本例中为一个月），陆地水储量的变化 $\\Delta S_i$ 等于总入水量减去总出水量。主要入流是降水量 ($P_i$)，主要出流是蒸散发量 ($E_i$) 和径流量 ($Q_i$)。所有量都表示为流域面积上的水深，单位为毫米 ($mm$)。月度储量变化的方程是：\n$$\n\\Delta S_i = P_i - E_i - Q_i\n$$\n问题将 $P_i - E_i - Q_i$ 项定义为月度残差，我们可以将其表示为 $R_i$。\n\n第一个任务是计算整个多年期间的净不平衡量 $I$。这是月度残差在总月数 $T$ 上的总和。指定的时间段为 $2$ 年，因此 $T=24$ 个月。净不平衡量 $I$ 表示在 $T$ 个月期间的总储量变化。\n$$\nI = \\sum_{i=1}^{T} R_i = \\sum_{i=1}^{T} (P_i - E_i - Q_i)\n$$\n由于提供的第一年数据会重复以构成第二年，因此总和可以计算为第一年（$T_{yr} = 12$ 个月）总和的两倍：\n$$\nI = 2 \\times \\sum_{i=1}^{T_{yr}} (P_i - E_i - Q_i)\n$$\n\n第二个任务是使用一阶方差传播来确定净不平衡量的不确定性 $\\sigma_I$。我们已知 $P$、$E$ 和 $Q$ 的月度不确定性是独立的。这意味着对于给定的月份 $i$，测量值 $P_i$、$E_i$ 和 $Q_i$ 是不相关的。此外，这也意味着不同月份的测量值也是不相关的（例如，当 $i \\neq j$ 时，$P_i$ 与 $P_j$ 独立）。\n\n月度残差的方差 $\\text{Var}(R_i) = \\sigma_{R_i}^2$ 是通过将方差传播规则应用于独立变量之和来找到的。对于独立变量的任何线性组合 $Y = aX_1 + bX_2$，$\\text{Var}(Y) = a^2\\text{Var}(X_1) + b^2\\text{Var}(X_2)$。对于残差 $R_i = P_i - E_i - Q_i$，方差为：\n$$\n\\sigma_{R_i}^2 = \\text{Var}(P_i) + (-1)^2\\text{Var}(E_i) + (-1)^2\\text{Var}(Q_i) = \\sigma_{P_i}^2 + \\sigma_{E_i}^2 + \\sigma_{Q_i}^2\n$$\n净不平衡量 $I$ 是这些月度残差的总和，$I = \\sum_{i=1}^{T} R_i$。由于不同月份的残差 $R_i$ 是独立的，总不平衡量的方差 $\\sigma_I^2$ 是月度残差方差的总和：\n$$\n\\sigma_I^2 = \\text{Var}(I) = \\text{Var}\\left(\\sum_{i=1}^{T} R_i\\right) = \\sum_{i=1}^{T} \\text{Var}(R_i) = \\sum_{i=1}^{T} (\\sigma_{P_i}^2 + \\sigma_{E_i}^2 + \\sigma_{Q_i}^2)\n$$\n问题指出，每个分量的月度不确定性标准差在所有月份中是恒定的。设它们为 $\\sigma_P$、$\\sigma_E$ 和 $\\sigma_Q$。总方差的方程简化为：\n$$\n\\sigma_I^2 = \\sum_{i=1}^{T} (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2) = T \\cdot (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2)\n$$\n总不确定性 $\\sigma_I$ 是该方差的平方根：\n$$\n\\sigma_I = \\sqrt{T \\cdot (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2)}\n$$\n\n最后一个任务是计算每个分量的方差对不平衡量总方差 $\\sigma_I^2$ 的分数贡献 ($f_P, f_E, f_Q$)。在 $T$ 个月内，降水量贡献的总方差为 $\\sum_{i=1}^{T} \\sigma_P^2 = T \\cdot \\sigma_P^2$。同样，蒸散发量和径流量的总方差贡献分别为 $T \\cdot \\sigma_E^2$ 和 $T \\cdot \\sigma_Q^2$。\n来自降水量的分数贡献 $f_P$ 是其总方差贡献与总不平衡量方差的比率：\n$$\nf_P = \\frac{T \\cdot \\sigma_P^2}{\\sigma_I^2} = \\frac{T \\cdot \\sigma_P^2}{T \\cdot (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2)} = \\frac{\\sigma_P^2}{\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2}\n$$\n同样，来自蒸散发量和径流量的分数贡献是：\n$$\nf_E = \\frac{\\sigma_E^2}{\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2}\n$$\n$$\nf_Q = \\frac{\\sigma_Q^2}{\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2}\n$$\n根据定义，这些分数的总和必须为 1：$f_P + f_E + f_Q = 1$。每个测试用例的计算都遵循这些派生公式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the water balance closure problem for a set of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test Case 1\",\n            \"P_yr1\": [80, 60, 70, 75, 90, 100, 120, 110, 95, 85, 70, 65],\n            \"E_yr1\": [30, 35, 40, 50, 60, 80, 100, 95, 70, 50, 40, 35],\n            \"Q_yr1\": [20, 15, 18, 22, 25, 30, 35, 33, 28, 24, 20, 18],\n            \"sigma_P\": 5,\n            \"sigma_E\": 8,\n            \"sigma_Q\": 6,\n        },\n        {\n            \"name\": \"Test Case 2\",\n            \"P_yr1\": [40, 50, 60, 75, 90, 110, 135, 125, 95, 80, 60, 50],\n            \"E_yr1\": [25, 30, 35, 40, 50, 70, 90, 85, 60, 45, 35, 30],\n            \"Q_yr1\": [15, 20, 25, 35, 40, 40, 45, 40, 35, 35, 25, 20],\n            \"sigma_P\": 3,\n            \"sigma_E\": 5,\n            \"sigma_Q\": 4,\n        },\n        {\n            \"name\": \"Test Case 3\",\n            \"P_yr1\": [70, 55, 60, 65, 85, 95, 110, 105, 90, 80, 65, 60],\n            \"E_yr1\": [40, 45, 50, 55, 65, 85, 95, 90, 70, 55, 50, 45],\n            \"Q_yr1\": [20, 18, 17, 19, 22, 28, 30, 28, 24, 22, 20, 18],\n            \"sigma_P\": 2,\n            \"sigma_E\": 20,\n            \"sigma_Q\": 1,\n        },\n    ]\n\n    all_results = []\n    T = 24  # Total number of months (2 years)\n\n    for case in test_cases:\n        p_yr1 = np.array(case[\"P_yr1\"])\n        e_yr1 = np.array(case[\"E_yr1\"])\n        q_yr1 = np.array(case[\"Q_yr1\"])\n        \n        sigma_P = case[\"sigma_P\"]\n        sigma_E = case[\"sigma_E\"]\n        sigma_Q = case[\"sigma_Q\"]\n        \n        # 1.  2. Compute the net imbalance I over the full 2-year period.\n        # The sum over 2 years is twice the sum over the first year.\n        imbalance_yr1 = np.sum(p_yr1) - np.sum(e_yr1) - np.sum(q_yr1)\n        I = 2 * imbalance_yr1\n        \n        # 3. Compute the propagated uncertainty of I, denoted sigma_I.\n        var_P = sigma_P**2\n        var_E = sigma_E**2\n        var_Q = sigma_Q**2\n        \n        # Total variance is T * (sum of monthly component variances).\n        var_I = T * (var_P + var_E + var_Q)\n        sigma_I = np.sqrt(var_I)\n        \n        # 4. Compute the fractional contributions to the total variance.\n        # The factor T cancels out from numerator and denominator.\n        total_comp_var = var_P + var_E + var_Q\n        f_P = var_P / total_comp_var if total_comp_var > 0 else 0\n        f_E = var_E / total_comp_var if total_comp_var > 0 else 0\n        f_Q = var_Q / total_comp_var if total_comp_var > 0 else 0\n        \n        # Append all five results for the current test case.\n        # Rounding is handled by the final f-string formatting.\n        all_results.extend([I, sigma_I, f_P, f_E, f_Q])\n\n    # Format the final results to three decimal places as required.\n    formatted_results = [f'{x:.3f}' for x in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "蒸散发是连接水循环和能量循环的关键过程。Penman-Monteith 方程是描述该过程最核心的物理模型，但其形式的复杂性可能令人望而生畏。本练习  将通过引导你从第一性原理出发，推导该方程并探索其在不同环境条件下的极限行为，从而揭示蒸散发过程在根本上是如何由有效能量或大气干燥力所主导的。",
            "id": "3814631",
            "problem": "考虑一个植被覆盖的陆地表面，卫星遥感为其提供了模拟蒸散所需的辐射强迫和地表特性。假设净辐射减去地表热通量 $R_{n} - G$ 已从中分辨率成像光谱仪 (MODIS) 产品和基于物理的表面能量平衡模型中反演得到，并且空气动力学阻力 $r_{a}$ 和冠层表面总阻力 $r_{s}$ 已通过莫宁-奥布霍夫相似理论 (MOST) 以及从雷达后向散射和多光谱指数推断的冠层结构进行了约束。在该场地一个有代表性的正午时刻，取以下值为已知：$R_{n} - G = 180 \\ \\mathrm{W\\,m^{-2}}$，$r_{a} = 25 \\ \\mathrm{s\\,m^{-1}}$，$r_{s} = 150 \\ \\mathrm{s\\,m^{-1}}$，空气密度 $\\rho = 1.2 \\ \\mathrm{kg\\,m^{-3}}$，恒压下空气比热 $c_{p} = 1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，汽化潜热 $\\lambda = 2.45 \\times 10^{6} \\ \\mathrm{J\\,kg^{-1}}$，干湿表常数 $\\gamma = 0.066 \\ \\mathrm{kPa\\,K^{-1}}$，以及在该场地气温下的饱和水汽压曲线斜率 $\\Delta = 0.188 \\ \\mathrm{kPa\\,K^{-1}}$。\n\n从基本定律和经过充分检验的关系式出发：\n- 表面能量平衡 $R_{n} - G = H + \\lambda E$；\n- 感热的总体空气动力学公式 $H = \\rho c_{p} \\frac{T_{s} - T_{a}}{r_{a}}$，其中 $T_{s}$ 和 $T_{a}$ 分别是地表温度和气温；\n- 饱和水汽压曲线的线性化 $e_{s}(T_{s}) \\approx e_{s}(T_{a}) + \\Delta (T_{s} - T_{a})$；\n- 从冠层到大气的蒸汽输运的串联阻力表示，有效梯度为 $e_{s}(T_{s}) - e_{a}$，跨越 $r_{s}$ 和 $r_{a}$，并通过 $\\gamma$ 实现温度和水汽压的干湿计联系，\n\n推导空气动力学限制和辐射限制的蒸散机制如何作为控制表达式的适当极限而出现。然后，将两种机制之间的“过渡”定义为控制表达式中与辐射强迫相关的贡献等于与空气动力学强迫相关的贡献的条件。根据该定义，确定该场地在过渡状态下的饱和水汽压差 $(e_{s} - e_{a})^{\\ast}$。\n\n以千帕 (kilopascal) 为单位表示您对 $(e_{s} - e_{a})^{\\ast}$ 的最终答案。将您的答案四舍五入到三位有效数字。",
            "solution": "用户请求解答一个关于蒸散的环境建模问题。第一步是验证问题陈述的有效性。\n\n### 第 1 步：提取已知条件\n问题提供了以下数据、定义和关系式：\n- 净辐射减去地表热通量：$R_{n} - G = 180 \\ \\mathrm{W\\,m^{-2}}$\n- 空气动力学阻力：$r_{a} = 25 \\ \\mathrm{s\\,m^{-1}}$\n- 冠层表面总阻力：$r_{s} = 150 \\ \\mathrm{s\\,m^{-1}}$\n- 空气密度：$\\rho = 1.2 \\ \\mathrm{kg\\,m^{-3}}$\n- 空气比热：$c_{p} = 1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- 汽化潜热：$\\lambda = 2.45 \\times 10^{6} \\ \\mathrm{J\\,kg^{-1}}$\n- 干湿表常数：$\\gamma = 0.066 \\ \\mathrm{kPa\\,K^{-1}}$\n- 饱和水汽压曲线斜率：$\\Delta = 0.188 \\ \\mathrm{kPa\\,K^{-1}}$\n\n提供的基本关系式：\n1. 表面能量平衡：$R_{n} - G = H + \\lambda E$\n2. 感热的总体空气动力学公式：$H = \\rho c_{p} \\frac{T_{s} - T_{a}}{r_{a}}$\n3. 饱和水汽压曲线的线性化：$e_{s}(T_{s}) \\approx e_{s}(T_{a}) + \\Delta (T_{s} - T_{a})$\n4. 潜热通量 $\\lambda E$ 的水汽输运串联阻力表示。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题基于蒸散的 Penman-Monteith 公式，这是水文学、微气象学和环境科学的基石。所有提供的方程都是标准的，代表了基本的物理原理（能量守恒）和广为接受的经验/半经验模型（总体输送、阻力网络）。物理常数（$\\rho$、$c_p$、$\\lambda$）和特定场地参数（$R_n - G$、$r_a$、$r_s$、$\\gamma$、$\\Delta$）的数值对于午间条件下的植被地表是符合物理实际的。该问题在科学上是合理的。\n- **适定性**：问题要求基于明确定义的条件推导极限机制并计算一个特定值（过渡饱和水汽压差）。所提供的信息是充分且自洽的，可以得出唯一解。\n- **客观性**：问题以精确、定量和客观的科学语言陈述，没有任何主观或基于观点的论断。\n\n### 第 3 步：结论与行动\n该问题具有科学合理性、适定性和客观性。它是**有效的**。将提供解答。\n\n### 控制表达式（Penman-Monteith 方程）的推导\n目标是找到一个潜热通量 $\\lambda E$ 的表达式，该表达式消除了未测量的地表温度 $T_s$。这将是“控制表达式”。\n\n我们从提供的四个基本关系式开始。潜热通量 $\\lambda E$ 可以使用类似于感热 $H$ 的阻力公式来表示。水汽的质量通量 $E$ 是由地表到空气的比湿梯度驱动的，并受到地表阻力和空气动力学阻力之和 $r_s + r_a$ 的阻碍：\n$$E = \\rho \\frac{q_{s} - q_{a}}{r_{s} + r_{a}}$$\n其中 $q_{s}$ 是有效表面（假设在温度 $T_{s}$ 时饱和）的比湿，$q_{a}$ 是环境空气的比湿。使用近似 $q \\approx (\\epsilon/P)e$，其中 $\\epsilon$ 是水和干空气的摩尔质量比，$P$ 是大气压力，以及干湿表常数的定义 $\\gamma = c_p P / (\\epsilon \\lambda)$，我们可以用饱和水汽压来表示潜热通量：\n$$\\lambda E = \\lambda \\rho \\frac{\\epsilon}{P} \\frac{e_{s}(T_{s}) - e_{a}}{r_{a} + r_{s}} = \\rho \\frac{c_{p}}{\\gamma} \\frac{e_{s}(T_{s}) - e_{a}}{r_{a} + r_{s}}$$\n我们现在有四个关键方程组：\n1. $R_{n} - G = H + \\lambda E$\n2. $H = \\rho c_{p} \\frac{T_{s} - T_{a}}{r_{a}}$\n3. $e_{s}(T_{s}) = e_{s}(T_{a}) + \\Delta (T_{s} - T_{a})$\n4. $\\lambda E = \\rho \\frac{c_{p}}{\\gamma} \\frac{e_{s}(T_{s}) - e_{a}}{r_{a} + r_{s}}$\n\n从方程 (2) 中，我们分离出温差 $T_{s} - T_{a}$：\n$$T_{s} - T_{a} = \\frac{H r_{a}}{\\rho c_{p}}$$\n将此式代入方程 (3)：\n$$e_{s}(T_{s}) = e_{s}(T_{a}) + \\Delta \\frac{H r_{a}}{\\rho c_{p}}$$\n这消除了 $T_{s}$，代之以 $H$。现在代入能量平衡（方程 1）的形式 $H = (R_{n} - G) - \\lambda E$：\n$$e_{s}(T_{s}) = e_{s}(T_{a}) + \\frac{\\Delta r_{a}}{\\rho c_{p}} ( (R_{n} - G) - \\lambda E )$$\n驱动蒸发的水汽压梯度 $e_{s}(T_s) - e_a$ 现在可以写成：\n$$e_{s}(T_{s}) - e_{a} = (e_{s}(T_{a}) - e_{a}) + \\frac{\\Delta r_{a}}{\\rho c_{p}} (R_{n} - G) - \\frac{\\Delta r_{a}}{\\rho c_{p}} \\lambda E$$\n令 $D = e_{s}(T_{a}) - e_{a}$ 表示空气的饱和水汽压差。\n$$e_{s}(T_{s}) - e_{a} = D + \\frac{\\Delta r_{a}}{\\rho c_{p}} (R_{n} - G) - \\frac{\\Delta r_{a}}{\\rho c_{p}} \\lambda E$$\n现在，将整个 $e_{s}(T_{s}) - e_{a}$ 的表达式代入潜热通量方程 (4)：\n$$\\lambda E = \\rho \\frac{c_{p}}{\\gamma} \\frac{1}{r_{a} + r_{s}} \\left( D + \\frac{\\Delta r_{a}}{\\rho c_{p}} (R_{n} - G) - \\frac{\\Delta r_{a}}{\\rho c_{p}} \\lambda E \\right)$$\n我们现在求解 $\\lambda E$。展开各项：\n$$\\lambda E = \\frac{\\rho c_{p} D}{\\gamma (r_{a} + r_{s})} + \\frac{\\Delta r_{a} (R_{n} - G)}{\\gamma (r_{a} + r_{s})} - \\frac{\\Delta r_{a} \\lambda E}{\\gamma (r_{a} + r_{s})}$$\n将含有 $\\lambda E$ 的项组合在一起：\n$$\\lambda E \\left( 1 + \\frac{\\Delta r_{a}}{\\gamma (r_{a} + r_{s})} \\right) = \\frac{\\Delta r_{a} (R_{n} - G) + \\rho c_{p} D}{\\gamma (r_{a} + r_{s})}$$\n$$\\lambda E \\left( \\frac{\\gamma(r_{a} + r_{s}) + \\Delta r_{a}}{\\gamma(r_{a} + r_{s})} \\right) = \\frac{\\Delta r_{a} (R_{n} - G) + \\rho c_{p} D}{\\gamma (r_{a} + r_{s})}$$\n求解 $\\lambda E$ 得：\n$$\\lambda E = \\frac{\\Delta r_{a} (R_n-G) + \\rho c_p D}{\\Delta r_a + \\gamma(r_a+r_s)}$$\n为了得到 Penman-Monteith 方程的标准形式，我们将分子和分母同时除以 $r_a$：\n$$\\lambda E = \\frac{\\Delta (R_n-G) + (\\rho c_p / r_a) D}{\\Delta + \\gamma (1 + r_s/r_a)}$$\n这是蒸散的控制表达式。它由一个辐射项和一个空气动力学项组成。\n\n### 极限机制分析\n控制表达式可以写成两个分量的和：\n$$\\lambda E = \\frac{\\Delta (R_n-G)}{\\Delta + \\gamma(1 + r_s/r_a)} + \\frac{(\\rho c_p / r_a) D}{\\Delta + \\gamma(1 + r_s/r_a)}$$\n第一项是辐射驱动分量，第二项是空气动力学驱动分量。\n\n- **辐射限制机制**：当可用能量 $R_n - G$ 是蒸发的主要驱动力时，出现这种机制。这发生在空气动力学项可忽略不计时，即当空气接近饱和时（$D \\to 0$）。在此极限下，蒸发主要由辐射收支和地表阻力决定：\n  $$\\lambda E \\approx \\frac{\\Delta (R_n-G)}{\\Delta + \\gamma(1 + r_s/r_a)}$$\n- **空气动力学限制机制**：当大气的“干燥能力”是主要驱动力时，出现这种机制。这发生在空气非常干燥（大的 $D$）且风大（小的 $r_a$）时，使得空气动力学项主导辐射项。如果我们考虑可用能量很小（$R_n - G \\to 0$）的情况，方程简化为：\n  $$\\lambda E \\approx \\frac{(\\rho c_p / r_a) D}{\\Delta + \\gamma(1 + r_s/r_a)}$$\n  此时，蒸发主要取决于饱和水汽压差和湍流输送的效率。\n\n### 过渡饱和水汽压差的确定\n问题将“过渡”定义为与辐射强迫相关的贡献等于与空气动力学强迫相关的贡献的条件。根据 Penman-Monteith 方程分子中代表蒸发两个能量来源的结构，我们令这两项相等：\n$$\\text{辐射强迫项} = \\text{空气动力学强迫项}$$\n$$\\Delta (R_{n}-G) = \\frac{\\rho c_{p}}{r_{a}} (e_{s} - e_{a})^{\\ast}$$\n这里，$(e_s - e_a)^{\\ast}$ 是过渡点处的饱和水汽压差。我们求解这个量：\n$$(e_{s} - e_{a})^{\\ast} = \\frac{\\Delta (R_{n} - G) r_{a}}{\\rho c_{p}}$$\n\n### 计算\n我们现在将给定值代入此表达式。单位必须一致。$R_n - G$ 的单位是 $\\mathrm{W\\,m^{-2}}$，等同于 $\\mathrm{J\\,s^{-1}\\,m^{-2}}$。\n- $\\Delta = 0.188 \\ \\mathrm{kPa\\,K^{-1}}$\n- $R_{n} - G = 180 \\ \\mathrm{J\\,s^{-1}\\,m^{-2}}$\n- $r_{a} = 25 \\ \\mathrm{s\\,m^{-1}}$\n- $\\rho = 1.2 \\ \\mathrm{kg\\,m^{-3}}$\n- $c_{p} = 1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n\n$$(e_{s} - e_{a})^{\\ast} = \\frac{(0.188 \\ \\mathrm{kPa\\,K^{-1}}) (180 \\ \\mathrm{J\\,s^{-1}\\,m^{-2}}) (25 \\ \\mathrm{s\\,m^{-1}})}{(1.2 \\ \\mathrm{kg\\,m^{-3}}) (1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}})}$$\n$$(e_{s} - e_{a})^{\\ast} = \\frac{0.188 \\times 180 \\times 25}{1.2 \\times 1004} \\ \\mathrm{kPa}$$\n$$(e_{s} - e_{a})^{\\ast} = \\frac{846}{1204.8} \\ \\mathrm{kPa}$$\n$$(e_{s} - e_{a})^{\\ast} \\approx 0.70219 \\ \\mathrm{kPa}$$\n按要求四舍五入到三位有效数字，结果是 $0.702 \\ \\mathrm{kPa}$。",
            "answer": "$$\\boxed{0.702}$$"
        },
        {
            "introduction": "物理过程模型虽然功能强大，但其内部包含了许多难以直接测量的参数，例如土壤水力学参数，这些参数通常需要通过其他观测数据来估计。本练习  旨在解决一个核心问题：我们能否从卫星土壤湿度等观测数据中唯一地确定这些参数？通过计算费雪信息矩阵（Fisher Information Matrix），你将亲自探究模型参数的“可识别性”，并学习如何诊断模型校准在何时以及为何会遇到困难。",
            "id": "3814668",
            "problem": "一个遥感仪器获取地表体积土壤湿度时间序列，该序列带有独立的、加性的、零均值高斯噪声。考虑一个深度为 $Z$（单位为 $\\mathrm{m}$）的表层土壤的简化物理桶状模型，其状态为体积土壤湿度 $\\theta$（无量纲，$\\mathrm{m^3/m^3}$）。该模型由离散时间点 $t_k$ 上的给定降雨率 $R_k$（单位为 $\\mathrm{m/s}$）和蒸发率 $E_k$（单位为 $\\mathrm{m/s}$）驱动，时间步长 $\\Delta t$（单位为 $\\mathrm{s}$）是均匀的。土壤水力行为遵循 van Genuchten–Mualem 本构关系，由形状参数 $n$（无量纲）和饱和导水率 $K_s$（单位为 $\\mathrm{m/s}$）参数化。设残余和饱和体积含水量分别为 $\\theta_r$ 和 $\\theta_s$（无量纲），并定义有效饱和度 $S_e(\\theta) = (\\theta - \\theta_r)/(\\theta_s - \\theta_r)$，指数 $m = 1 - 1/n$，以及孔隙连通性参数 $l = 0.5$。非饱和导水率由下式给出\n$$\nK(\\theta; n, K_s) = K_s \\, S_e(\\theta)^l \\left[ 1 - \\left( 1 - S_e(\\theta)^{1/m} \\right)^m \\right]^2,\n$$\n对于 $\\theta \\in [\\theta_r,\\theta_s]$ 和 $n  1$。更新表层状态的离散时间水量平衡方程为\n$$\n\\theta_{k+1} = \\operatorname{clip}\\left( \\theta_k + \\frac{\\Delta t}{Z} \\left( \\min\\{ R_k, K(\\theta_k;n,K_s) \\} - \\chi_k K(\\theta_k;n,K_s) - E_k \\right), \\theta_r, \\theta_s \\right),\n$$\n其中，如果 $R_k  0$ 则 $\\chi_k = 0$，如果 $R_k = 0$ 则 $\\chi_k = 1$。$\\operatorname{clip}(x,a,b)$ 函数将 $x$ 的值限制在区间 $[a,b]$ 内。观测模型为 $y_k = \\theta_k + \\varepsilon_k$，其中 $\\varepsilon_k \\sim \\mathcal{N}(0,\\sigma^2)$ 对所有 $k$ 独立，目标参数向量为 $\\mathbf{p} = [\\ln(n), \\ln(K_s)]^\\top$，该向量通过构造是无量纲的。\n\n您的任务是从基本质量平衡和指定的本构关系出发，实现一个程序。对于给定的强迫和常数，该程序在方差为 $\\sigma^2$ 的独立高斯观测噪声假设下，计算与参数向量 $\\mathbf{p}$ 关联的费雪信息矩阵（Fisher Information Matrix），并从地表土壤湿度时间序列中分析参数的局部可识别性。使用数值稳定的中心有限差分近似来计算构建关于 $\\mathbf{p}$ 的雅可比矩阵所需的敏感度。\n\n对于所有测试用例，您必须采用以下物理和数值上一致的常数和单位：\n- 时间步长 $\\Delta t = 3600$ $\\mathrm{s}$，步数 $N = 48$，土层深度 $Z = 0.1$ $\\mathrm{m}$。\n- 残余和饱和体积含水量 $\\theta_r = 0.05$，$\\theta_s = 0.45$（无量纲）。\n- 孔隙连通性参数 $l = 0.5$（无量纲）。\n- 观测噪声标准差 $\\sigma = 0.02$（无量纲 $\\mathrm{m^3/m^3}$）。\n- 在变换后的参数 $\\ln(n)$ 和 $\\ln(K_s)$ 中，使用中心有限差分步长 $\\delta = 10^{-4}$。\n\n定义三个科学上现实的测试用例，以探究不同的可识别性机制：\n- 测试用例 1（变化的降雨脉冲，中等湿度）：$n = 1.6$，$K_s = 5\\times 10^{-6}$ $\\mathrm{m/s}$，初始湿度 $\\theta_0 = 0.20$。对所有 $k$，蒸发率 $E_k = 2\\times 10^{-8}$ $\\mathrm{m/s}$。降雨率 $R_k$ 在第 $6$ 至 $8$ 小时（包括首尾）和第 $20$ 至 $22$ 小时（包括首尾）期间等于 $1.5\\times 10^{-6}$ $\\mathrm{m/s}$（即索引 $k$ 满足 $k \\in \\{6,7,8,20,21,22\\}$），在第 $35$ 小时等于 $8\\times 10^{-7}$ $\\mathrm{m/s}$（即 $k=35$），其他时间等于 $0$。\n- 测试用例 2（无降雨，干燥过程）：$n = 1.6$，$K_s = 5\\times 10^{-6}$ $\\mathrm{m/s}$，初始湿度 $\\theta_0 = 0.20$。对所有 $k$，蒸发率 $E_k = 2\\times 10^{-8}$ $\\mathrm{m/s}$。对所有 $k$，降雨率 $R_k = 0$。\n- 测试用例 3（接近饱和，持续降雨）：$n = 1.8$，$K_s = 7\\times 10^{-6}$ $\\mathrm{m/s}$，初始湿度 $\\theta_0 = 0.44$。对所有 $k$，蒸发率 $E_k = 2\\times 10^{-8}$ $\\mathrm{m/s}$。降雨率 $R_k$ 在第 $0$ 至 $9$ 小时期间（包括首尾）等于 $2\\times 10^{-6}$ $\\mathrm{m/s}$（即索引 $k \\in \\{0,1,\\dots,9\\}$），其他时间 $R_k = 0$。\n\n对于每个测试用例，您的程序必须：\n- 在给定的强迫和参数下，模拟确定性状态轨迹 $\\{ \\theta_k \\}_{k=0}^{N-1}$。\n- 使用 $\\ln(n)$ 和 $\\ln(K_s)$ 上的中心有限差分，构建观测向量 $\\mathbf{y} = [\\theta_0,\\theta_1,\\dots,\\theta_{N-1}]^\\top$ 关于 $\\mathbf{p}$ 的雅可比矩阵 $\\mathbf{J} \\in \\mathbb{R}^{N \\times 2}$。\n- 计算费雪信息矩阵 $\\mathbf{F} = \\sigma^{-2} \\mathbf{J}^\\top \\mathbf{J}$。\n- 计算 $\\mathbf{F}$ 的条件数的以 10 为底的对数，定义为 $\\log_{10}(\\lambda_{\\max}/\\lambda_{\\min})$，其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 是 $\\mathbf{F}$ 的最大和最小特征值。\n\n您的程序应生成单行输出，其中包含一个方括号内的逗号分隔列表。每个测试用例对应一个浮点数，该浮点数是按上述规定计算的费雪信息矩阵条件数的以 10 为底的对数。这些输出是无量纲的浮点数。不涉及角度。单行输出格式必须与 `[result_1,result_2,result_3]` 完全一致。",
            "solution": "该问题要求对一个简化的、基于物理的土壤湿度模型进行局部参数可识别性分析。这涉及为一组水文参数计算费雪信息矩阵（FIM）及其条件数。该分析将在代表不同环境条件的三个不同测试用例下进行。\n\n**1. 模型构建与控制方程**\n\n该系统由一个深度为 Z 的表层土壤的单层“桶”模型描述。状态变量是体积土壤湿度 $\\theta(t)$，它是无量纲的（$\\mathrm{m^3/m^3}$）。模型的动力学在时间上以均匀步长 $\\Delta t$ 进行离散化。\n\n土壤的水力特性由 van Genuchten–Mualem 模型定义。关键关系如下：\n- 有效饱和度 $S_e$，它将土壤含水量在其残余值 $\\theta_r$ 和饱和值 $\\theta_s$ 之间进行归一化：\n$$\nS_e(\\theta) = \\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r}\n$$\n- 非饱和导水率 $K(\\theta)$，它取决于土壤湿度和两个关键参数：饱和导水率 $K_s$（$\\mathrm{m/s}$）和孔径分布形状参数 $n$：\n$$\nK(\\theta; n, K_s) = K_s \\, S_e(\\theta)^l \\left[ 1 - \\left( 1 - S_e(\\theta)^{1/m} \\right)^m \\right]^2\n$$\n其中 $l=0.5$ 是孔隙连通性参数，且 $m = 1 - 1/n$。此函数在 $\\theta \\in [\\theta_r, \\theta_s]$ 和 $n  1$ 时有效。\n\n时间步长为 $k$ 时的土壤湿度 $\\theta_k$ 的时间演变由以下离散水量平衡方程控制：\n$$\n\\theta_{k+1} = \\operatorname{clip}\\left( \\theta_k + \\frac{\\Delta t}{Z} \\left( \\min\\{ R_k, K(\\theta_k;n,K_s) \\} - \\chi_k K(\\theta_k;n,K_s) - E_k \\right), \\theta_r, \\theta_s \\right)\n$$\n此处，$R_k$ 是降雨率，$E_k$ 是蒸发率，$\\min\\{R_k, K(\\theta_k)\\}$ 代表入渗（受降雨率或土壤导水率限制），而 $\\chi_k K(\\theta_k)$ 代表深层渗漏，假设只在没有降雨时发生（如果 $R_k=0$，则 $\\chi_k = 1$；如果 $R_k  0$，则 $\\chi_k = 0$）。$\\operatorname{clip}(x, a, b)$ 函数确保 $\\theta_{k+1}$ 保持在物理边界 $[\\theta_r, \\theta_s]$ 内。\n\n**2. 参数可识别性与费雪信息矩阵（FIM）**\n\n目标是评估参数向量 $\\mathbf{p} = [\\ln(n), \\ln(K_s)]^\\top$ 的局部可识别性。这取决于模型的输出（土壤湿度时间序列 $\\{\\theta_k\\}$）对这些参数扰动的敏感程度。费雪信息矩阵为此分析提供了一个定量框架。\n\n假设观测值 $y_k$ 受到独立的、加性的、零均值高斯噪声的干扰，$y_k = \\theta_k(\\mathbf{p}) + \\varepsilon_k$，其中 $\\varepsilon_k \\sim \\mathcal{N}(0, \\sigma^2)$，则参数向量 $\\mathbf{p}$ 的 FIM 由下式给出：\n$$\n\\mathbf{F} = \\frac{1}{\\sigma^2} \\mathbf{J}^\\top \\mathbf{J}\n$$\n其中 $\\mathbf{J}$ 是雅可比（或敏感度）矩阵。雅可比矩阵的元素 $J_{ki}$ 表示模型在时间步 $k$ 的输出对第 $i$ 个参数分量 $p_i$ 变化的敏感度：\n$$\nJ_{ki} = \\frac{\\partial \\theta_k}{\\partial p_i}\n$$\n观测向量取为 $\\boldsymbol{\\theta} = [\\theta_0, \\theta_1, \\dots, \\theta_{N-1}]^\\top$，其长度为 $N=48$。参数向量为 $\\mathbf{p} = [p_1, p_2]^\\top = [\\ln(n), \\ln(K_s)]^\\top$。雅可比矩阵 $\\mathbf{J}$ 是一个 $N \\times 2$ 的矩阵。\n\nFIM 的高条件数 $\\kappa(\\mathbf{F}) = \\lambda_{\\max}/\\lambda_{\\min}$（其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 是 $\\mathbf{F}$ 的最大和最小特征值）表明该矩阵是病态的或近乎奇异的。这意味着模型输出对参数空间中至少一个方向的变化不敏感，预示着较差的参数可识别性。某些参数组合无法从给定数据中唯一确定。我们使用 $\\log_{10}(\\kappa(\\mathbf{F}))$ 作为最终的度量指标。\n\n**3. 数值实现策略**\n\n任务的核心是计算雅可比矩阵 $\\mathbf{J}$。由于模型方程复杂且递归应用，其导数的解析推导是难以处理的。因此，采用数值方法。\n\n**a. 通过有限差分计算敏感度：** 偏导数使用中心有限差分格式进行近似。对于一个小的扰动 $\\delta$，关于参数 $p_i$ 的导数为：\n$$\n\\frac{\\partial \\theta_k(\\mathbf{p})}{\\partial p_i} \\approx \\frac{\\theta_k(\\mathbf{p} + \\delta \\mathbf{e}_i) - \\theta_k(\\mathbf{p} - \\delta \\mathbf{e}_i)}{2\\delta}\n$$\n其中 $\\mathbf{e}_i$ 是第 $i$ 个标准基向量。这需要对每个参数进行一次前向扰动和一次后向扰动，并运行完整的模型模拟。对于我们的双参数问题，这意味着需要四次模拟来构建雅可比矩阵的两列。\n由于初始条件 $\\theta_0$ 是固定的，不依赖于参数 $\\mathbf{p}$，其导数为零：$\\frac{\\partial \\theta_0}{\\partial p_i} = 0$。因此，雅可比矩阵的第一行将是 $[0, 0]$。\n\n**b. 算法：** 对于每个测试用例，执行以下步骤：\n1.  **初始化常数和强迫项：** 设置全局模型常数（$\\Delta t, Z, \\theta_r, \\theta_s, l, \\sigma, N, \\delta$）和特定测试用例的参数（$n, K_s, \\theta_0$）以及强迫时间序列（$R_k, E_k$）。\n2.  **定义名义参数和扰动参数：** 将名义参数 $n_{nom}$ 和 $K_{s,nom}$ 变换为 $p_{1,nom} = \\ln(n_{nom})$ 和 $p_{2,nom} = \\ln(K_{s,nom})$。计算扰动后的参数值，例如，对于 $n$：$n_{fwd} = \\exp(p_{1,nom} + \\delta)$ 和 $n_{bwd} = \\exp(p_{1,nom} - \\delta)$。\n3.  **模拟状态轨迹：** 实现一个函数 `_run_simulation`，通过迭代水量平衡方程（$k = 0, \\dots, N-2$）来生成土壤湿度时间序列 $\\boldsymbol{\\theta} = [\\theta_0, \\dots, \\theta_{N-1}]^\\top$。\n4.  **计算雅可比矩阵的列：**\n    -   为了得到 $\\mathbf{J}$ 的第一列，使用扰动后的参数 $n$（同时保持 $K_s$ 为其名义值）进行模型模拟，得到 $\\boldsymbol{\\theta}_{fwd,1}$ 和 $\\boldsymbol{\\theta}_{bwd,1}$。然后，$\\mathbf{J}_{:,1} = (\\boldsymbol{\\theta}_{fwd,1} - \\boldsymbol{\\theta}_{bwd,1}) / (2\\delta)$。\n    -   对第二个参数 $K_s$ 重复此过程以获得第二列 $\\mathbf{J}_{:,2}$。\n5.  **计算FIM和条件数：**\n    -   组装雅可比矩阵 $\\mathbf{J} = [\\mathbf{J}_{:,1}, \\mathbf{J}_{:,2}]$。\n    -   计算FIM：$\\mathbf{F} = \\sigma^{-2} \\mathbf{J}^\\top \\mathbf{J}$。\n    -   计算 $2 \\times 2$ 矩阵 $\\mathbf{F}$ 的特征值。\n    -   计算条件数 $\\kappa(\\mathbf{F}) = \\lambda_{\\max}/\\lambda_{\\min}$。如果 $\\lambda_{\\min}$ 为零或极小，这表示 FIM 是奇异的，条件数实际上是无限的。在数值计算中，预计会得到一个非常大但有限的值。\n6.  **最终输出：** 取条件数的以 10 为底的对数 $\\log_{10}(\\kappa(\\mathbf{F}))$。这是该测试用例的结果。\n\n这个完整的流程将应用于三个测试用例中的每一个，这些测试用例旨在探究模型在不同水文状况下的可识别性：变化的降雨、持续干燥和接近饱和的条件。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to perform parameter identifiability analysis for a soil moisture model.\n    \"\"\"\n    \n    # Global constants\n    DT = 3600.0  # s\n    N_STEPS = 48\n    Z_DEPTH = 0.1  # m\n    THETA_R = 0.05\n    THETA_S = 0.45\n    L_PARAM = 0.5\n    SIGMA_NOISE = 0.02\n    FD_DELTA = 1e-4\n\n    consts = {\n        'dt': DT,\n        'N': N_STEPS,\n        'Z': Z_DEPTH,\n        'theta_r': THETA_R,\n        'theta_s': THETA_S,\n        'l': L_PARAM\n    }\n\n    # --- Test Case Definitions ---\n\n    # Forcing for Case 1\n    R1 = np.zeros(N_STEPS)\n    R1[[6, 7, 8, 20, 21, 22]] = 1.5e-6\n    R1[35] = 8.0e-7\n    E1 = np.full(N_STEPS, 2.0e-8)\n\n    # Forcing for Case 2\n    R2 = np.zeros(N_STEPS)\n    E2 = np.full(N_STEPS, 2.0e-8)\n\n    # Forcing for Case 3\n    R3 = np.zeros(N_STEPS)\n    R3[0:10] = 2.0e-6\n    E3 = np.full(N_STEPS, 2.0e-8)\n\n    test_cases = [\n        {'n': 1.6, 'Ks': 5e-6, 'theta0': 0.20, 'R': R1, 'E': E1},\n        {'n': 1.6, 'Ks': 5e-6, 'theta0': 0.20, 'R': R2, 'E': E2},\n        {'n': 1.8, 'Ks': 7e-6, 'theta0': 0.44, 'R': R3, 'E': E3},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _process_case(case, consts, FD_DELTA, SIGMA_NOISE ** 2)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef _calculate_K(theta, n, Ks, theta_r, theta_s, l_param):\n    \"\"\"\n    Computes unsaturated hydraulic conductivity K(theta) using van Genuchten-Mualem model.\n    \"\"\"\n    if theta = theta_r:\n        return 0.0\n    if theta >= theta_s:\n        return Ks\n\n    m_param = 1.0 - 1.0 / n\n    Se = (theta - theta_r) / (theta_s - theta_r)\n    \n    # To prevent potential numerical issues even though Se is bounded.\n    Se = np.clip(Se, 0.0, 1.0)\n    \n    term1 = 1.0 - (1.0 - Se**(1.0 / m_param))**m_param\n    K = Ks * (Se**l_param) * (term1**2)\n    return K\n\n\ndef _run_simulation(n, Ks, theta0, R_forcing, E_forcing, consts):\n    \"\"\"\n    Runs the forward simulation of the bucket soil moisture model.\n    \"\"\"\n    dt, N, Z, theta_r, theta_s, l = consts['dt'], consts['N'], consts['Z'], consts['theta_r'], consts['theta_s'], consts['l']\n    \n    theta_hist = np.zeros(N)\n    theta_hist[0] = theta0\n    \n    for k in range(N - 1):\n        theta_k = theta_hist[k]\n        K_k = _calculate_K(theta_k, n, Ks, theta_r, theta_s, l)\n        \n        R_k = R_forcing[k]\n        E_k = E_forcing[k]\n        \n        chi_k = 1.0 if R_k == 0.0 else 0.0\n        \n        infiltration = min(R_k, K_k)\n        \n        d_theta = (dt / Z) * (infiltration - chi_k * K_k - E_k)\n        \n        theta_k1 = np.clip(theta_k + d_theta, theta_r, theta_s)\n        theta_hist[k + 1] = theta_k1\n        \n    return theta_hist\n\n\ndef _process_case(case_params, consts, delta, noise_var):\n    \"\"\"\n    Processes a single test case to compute the log10 of the FIM condition number.\n    \"\"\"\n    n_nom, Ks_nom, theta0 = case_params['n'], case_params['Ks'], case_params['theta0']\n    R, E = case_params['R'], case_params['E']\n\n    p_nom = np.array([np.log(n_nom), np.log(Ks_nom)])\n\n    # Perturb n (p1)\n    n_fwd1 = np.exp(p_nom[0] + delta)\n    n_bwd1 = np.exp(p_nom[0] - delta)\n    theta_fwd1 = _run_simulation(n_fwd1, Ks_nom, theta0, R, E, consts)\n    theta_bwd1 = _run_simulation(n_bwd1, Ks_nom, theta0, R, E, consts)\n    J_col1 = (theta_fwd1 - theta_bwd1) / (2 * delta)\n\n    # Perturb Ks (p2)\n    Ks_fwd2 = np.exp(p_nom[1] + delta)\n    Ks_bwd2 = np.exp(p_nom[1] - delta)\n    theta_fwd2 = _run_simulation(n_nom, Ks_fwd2, theta0, R, E, consts)\n    theta_bwd2 = _run_simulation(n_nom, Ks_bwd2, theta0, R, E, consts)\n    J_col2 = (theta_fwd2 - theta_bwd2) / (2 * delta)\n\n    J = np.stack([J_col1, J_col2], axis=1)\n\n    FIM = (1.0 / noise_var) * (J.T @ J)\n\n    eigenvalues = np.linalg.eigvals(FIM)\n    \n    # Handle potential singularity\n    min_eig = np.min(eigenvalues)\n    if min_eig  1e-20: # Use a threshold to avoid division by zero\n        return np.inf\n\n    cond_num = np.max(eigenvalues) / min_eig\n    return np.log10(cond_num)\n\nsolve()\n```"
        }
    ]
}