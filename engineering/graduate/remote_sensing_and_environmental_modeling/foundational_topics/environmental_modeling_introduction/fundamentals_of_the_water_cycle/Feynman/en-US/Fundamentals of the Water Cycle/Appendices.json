{
    "hands_on_practices": [
        {
            "introduction": "Evapotranspiration ($ET$) is a critical flux connecting the water and energy cycles, and the Penman-Monteith equation is the cornerstone for its estimation. This exercise will guide you through the derivation of this famous equation from the first principles of surface energy balance and aerodynamic transport. By analyzing its limiting cases, you will develop a deep intuition for when $ET$ is controlled by available energy (the radiation-limited regime) versus the atmosphere's capacity to transport vapor (the aerodynamic-limited regime), a crucial skill for interpreting environmental data and satellite retrievals .",
            "id": "3814631",
            "problem": "Consider a vegetated land surface for which satellite remote sensing provides the radiative forcing and land surface properties needed to model evapotranspiration. Assume net radiation minus ground heat flux $R_{n} - G$ has been retrieved from Moderate Resolution Imaging Spectroradiometer (MODIS) products and a physically based surface energy balance model, and aerodynamic resistance $r_{a}$ and bulk canopy surface resistance $r_{s}$ have been constrained using Monin–Obukhov Similarity Theory (MOST) and canopy structure inferred from radar backscatter and multispectral indices. At a representative midday hour for the site, take the following values as known: $R_{n} - G = 180 \\ \\mathrm{W\\,m^{-2}}$, $r_{a} = 25 \\ \\mathrm{s\\,m^{-1}}$, $r_{s} = 150 \\ \\mathrm{s\\,m^{-1}}$, air density $\\rho = 1.2 \\ \\mathrm{kg\\,m^{-3}}$, specific heat of air at constant pressure $c_{p} = 1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$, latent heat of vaporization $\\lambda = 2.45 \\times 10^{6} \\ \\mathrm{J\\,kg^{-1}}$, psychrometric constant $\\gamma = 0.066 \\ \\mathrm{kPa\\,K^{-1}}$, and the slope of the saturation vapor pressure curve at the site’s air temperature $\\Delta = 0.188 \\ \\mathrm{kPa\\,K^{-1}}$.\n\nStarting from fundamental laws and well-tested relationships:\n- The surface energy balance $R_{n} - G = H + \\lambda E$;\n- A bulk-aerodynamic formulation for sensible heat $H = \\rho c_{p} \\frac{T_{s} - T_{a}}{r_{a}}$, where $T_{s}$ and $T_{a}$ are surface and air temperatures;\n- Linearization of the saturation vapor pressure curve $e_{s}(T_{s}) \\approx e_{s}(T_{a}) + \\Delta (T_{s} - T_{a})$;\n- A resistances-in-series representation for vapor transport from the canopy to the atmosphere, with an effective gradient $e_{s}(T_{s}) - e_{a}$ across $r_{s}$ and $r_{a}$, and the psychrometric linking of temperature and vapor pressure via $\\gamma$,\n\nderive how the aerodynamic-limited and radiation-limited evapotranspiration regimes emerge as appropriate limits of the governing expression. Then, define the “transition” between regimes as the condition at which the contribution in the governing expression associated with radiative forcing is equal to the contribution associated with aerodynamic forcing. Under that definition, determine the vapor pressure deficit $(e_{s} - e_{a})^{\\ast}$ at the transition for this site.\n\nExpress your final answer for $(e_{s} - e_{a})^{\\ast}$ in kilopascals. Round your answer to three significant figures.",
            "solution": "The user has requested a solution to a problem in environmental modeling concerning evapotranspiration. The first step is to validate the problem statement.\n\n### Step 1: Extract Givens\nThe problem provides the following data, definitions, and relationships:\n- Net radiation minus ground heat flux: $R_{n} - G = 180 \\ \\mathrm{W\\,m^{-2}}$\n- Aerodynamic resistance: $r_{a} = 25 \\ \\mathrm{s\\,m^{-1}}$\n- Bulk canopy surface resistance: $r_{s} = 150 \\ \\mathrm{s\\,m^{-1}}$\n- Air density: $\\rho = 1.2 \\ \\mathrm{kg\\,m^{-3}}$\n- Specific heat of air: $c_{p} = 1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- Latent heat of vaporization: $\\lambda = 2.45 \\times 10^{6} \\ \\mathrm{J\\,kg^{-1}}$\n- Psychrometric constant: $\\gamma = 0.066 \\ \\mathrm{kPa\\,K^{-1}}$\n- Slope of the saturation vapor pressure curve: $\\Delta = 0.188 \\ \\mathrm{kPa\\,K^{-1}}$\n\nFundamental relationships provided:\n1. Surface energy balance: $R_{n} - G = H + \\lambda E$\n2. Bulk-aerodynamic formulation for sensible heat: $H = \\rho c_{p} \\frac{T_{s} - T_{a}}{r_{a}}$\n3. Linearization of the saturation vapor pressure curve: $e_{s}(T_{s}) \\approx e_{s}(T_{a}) + \\Delta (T_{s} - T_{a})$\n4. A resistances-in-series representation for vapor transport for latent heat flux, $\\lambda E$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on the Penman-Monteith formulation of evapotranspiration, a cornerstone of hydrology, micrometeorology, and environmental science. All provided equations are standard and represent fundamental physical principles (energy conservation) and well-established empirical/semi-empirical models (bulk transfer, resistance network). The numerical values for the physical constants ($\\rho$, $c_p$, $\\lambda$) and site-specific parameters ($R_n - G$, $r_a$, $r_s$, $\\gamma$, $\\Delta$) are physically realistic for a vegetated land surface under midday conditions. The problem is scientifically sound.\n- **Well-Posed**: The problem requests the derivation of limiting regimes and the calculation of a specific value (transition vapor pressure deficit) based on a clearly defined condition. The provided information is sufficient and self-consistent, allowing for a unique solution.\n- **Objective**: The problem is stated in precise, quantitative, and objective scientific language, free of any subjective or opinion-based claims.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and objective. It is **valid**. A solution will be provided.\n\n### Derivation of the Governing Expression (Penman-Monteith Equation)\nThe goal is to find an expression for the latent heat flux, $\\lambda E$, that eliminates the un-measured surface temperature, $T_s$. This will be the \"governing expression\".\n\nWe start with the four fundamental relationships provided. The latent heat flux, $\\lambda E$, can be expressed using a resistance formulation analogous to that for sensible heat, $H$. The mass flux of water vapor, $E$, is driven by the specific humidity gradient from the surface to the air and is resisted by the sum of the surface and aerodynamic resistances, $r_s + r_a$:\n$$E = \\rho \\frac{q_{s} - q_{a}}{r_{s} + r_{a}}$$\nwhere $q_{s}$ is the specific humidity at the effective surface (assumed to be saturated at temperature $T_{s}$) and $q_{a}$ is the specific humidity of the ambient air. Using the approximation $q \\approx (\\epsilon/P)e$, where $\\epsilon$ is the ratio of molar masses of water to dry air and $P$ is atmospheric pressure, and the definition of the psychrometric constant $\\gamma = c_p P / (\\epsilon \\lambda)$, we can write the latent heat flux in terms of vapor pressure:\n$$\\lambda E = \\lambda \\rho \\frac{\\epsilon}{P} \\frac{e_{s}(T_{s}) - e_{a}}{r_{a} + r_{s}} = \\rho \\frac{c_{p}}{\\gamma} \\frac{e_{s}(T_{s}) - e_{a}}{r_{a} + r_{s}}$$\nWe now have a system of four key equations:\n1. $R_{n} - G = H + \\lambda E$\n2. $H = \\rho c_{p} \\frac{T_{s} - T_{a}}{r_{a}}$\n3. $e_{s}(T_{s}) = e_{s}(T_{a}) + \\Delta (T_{s} - T_{a})$\n4. $\\lambda E = \\rho \\frac{c_{p}}{\\gamma} \\frac{e_{s}(T_{s}) - e_{a}}{r_{a} + r_{s}}$\n\nFrom equation (2), we isolate the temperature difference $T_{s} - T_{a}$:\n$$T_{s} - T_{a} = \\frac{H r_{a}}{\\rho c_{p}}$$\nSubstitute this into equation (3):\n$$e_{s}(T_{s}) = e_{s}(T_{a}) + \\Delta \\frac{H r_{a}}{\\rho c_{p}}$$\nThis eliminates $T_{s}$ in favor of $H$. Now substitute the energy balance (equation 1) in the form $H = (R_{n} - G) - \\lambda E$:\n$$e_{s}(T_{s}) = e_{s}(T_{a}) + \\frac{\\Delta r_{a}}{\\rho c_{p}} ( (R_{n} - G) - \\lambda E )$$\nThe vapor pressure gradient driving evaporation, $e_{s}(T_s) - e_a$, can now be written as:\n$$e_{s}(T_{s}) - e_{a} = (e_{s}(T_{a}) - e_{a}) + \\frac{\\Delta r_{a}}{\\rho c_{p}} (R_{n} - G) - \\frac{\\Delta r_{a}}{\\rho c_{p}} \\lambda E$$\nLet $D = e_{s}(T_{a}) - e_{a}$ represent the vapor pressure deficit of the air.\n$$e_{s}(T_{s}) - e_{a} = D + \\frac{\\Delta r_{a}}{\\rho c_{p}} (R_{n} - G) - \\frac{\\Delta r_{a}}{\\rho c_{p}} \\lambda E$$\nNow, substitute this entire expression for $e_{s}(T_{s}) - e_{a}$ into the latent heat flux equation (4):\n$$\\lambda E = \\rho \\frac{c_{p}}{\\gamma} \\frac{1}{r_{a} + r_{s}} \\left( D + \\frac{\\Delta r_{a}}{\\rho c_{p}} (R_{n} - G) - \\frac{\\Delta r_{a}}{\\rho c_{p}} \\lambda E \\right)$$\nWe now solve for $\\lambda E$. Expand the terms:\n$$\\lambda E = \\frac{\\rho c_{p} D}{\\gamma (r_{a} + r_{s})} + \\frac{\\Delta r_{a} (R_{n} - G)}{\\gamma (r_{a} + r_{s})} - \\frac{\\Delta r_{a} \\lambda E}{\\gamma (r_{a} + r_{s})}$$\nGroup terms containing $\\lambda E$:\n$$\\lambda E \\left( 1 + \\frac{\\Delta r_{a}}{\\gamma (r_{a} + r_{s})} \\right) = \\frac{\\Delta r_{a} (R_{n} - G) + \\rho c_{p} D}{\\gamma (r_{a} + r_{s})}$$\n$$\\lambda E \\left( \\frac{\\gamma(r_{a} + r_{s}) + \\Delta r_{a}}{\\gamma(r_{a} + r_{s})} \\right) = \\frac{\\Delta r_{a} (R_{n} - G) + \\rho c_{p} D}{\\gamma (r_{a} + r_{s})}$$\nSolving for $\\lambda E$ yields:\n$$\\lambda E = \\frac{\\Delta r_{a} (R_n-G) + \\rho c_p D}{\\Delta r_a + \\gamma(r_a+r_s)}$$\nTo obtain the standard form of the Penman-Monteith equation, we divide the numerator and denominator by $r_a$:\n$$\\lambda E = \\frac{\\Delta (R_n-G) + (\\rho c_p / r_a) D}{\\Delta + \\gamma (1 + r_s/r_a)}$$\nThis is the governing expression for evapotranspiration. It is composed of a radiative term and an aerodynamic term.\n\n### Analysis of Limiting Regimes\nThe governing expression can be written as the sum of two components:\n$$\\lambda E = \\frac{\\Delta (R_n-G)}{\\Delta + \\gamma(1 + r_s/r_a)} + \\frac{(\\rho c_p / r_a) D}{\\Delta + \\gamma(1 + r_s/r_a)}$$\nThe first term is the radiation-driven component, and the second is the aerodynamically-driven component.\n\n- **Radiation-limited regime**: This regime occurs when the available energy, $R_n - G$, is the primary driver of evaporation. This happens when the aerodynamic term is negligible, which occurs when the air is nearly saturated ($D \\to 0$). In this limit, evaporation is determined mainly by the radiation budget and surface resistance:\n  $$\\lambda E \\approx \\frac{\\Delta (R_n-G)}{\\Delta + \\gamma(1 + r_s/r_a)}$$\n- **Aerodynamic-limited regime**: This regime occurs when the \"drying power\" of the atmosphere is the primary driver. This happens when the air is very dry (large $D$) and conditions are windy (small $r_a$), such that the aerodynamic term dominates the radiative term. If we consider the case where available energy is small ($R_n - G \\to 0$), the equation simplifies to:\n  $$\\lambda E \\approx \\frac{(\\rho c_p / r_a) D}{\\Delta + \\gamma(1 + r_s/r_a)}$$\n  Here, evaporation is primarily a function of the vapor pressure deficit and the efficiency of turbulent transport.\n\n### Determination of the Transition Vapor Pressure Deficit\nThe problem defines the \"transition\" as the condition where the contribution associated with radiative forcing is equal to that associated with aerodynamic forcing. Based on the structure of the numerator in the Penman-Monteith equation, which represents the two energy sources for evaporation, we set these two terms equal:\n$$\\text{Radiative Forcing Term} = \\text{Aerodynamic Forcing Term}$$\n$$\\Delta (R_{n}-G) = \\frac{\\rho c_{p}}{r_{a}} (e_{s} - e_{a})^{\\ast}$$\nHere, $(e_s - e_a)^{\\ast}$ is the vapor pressure deficit at the transition point. We solve for this quantity:\n$$(e_{s} - e_{a})^{\\ast} = \\frac{\\Delta (R_{n} - G) r_{a}}{\\rho c_{p}}$$\n\n### Calculation\nWe now substitute the given values into this expression. The units must be consistent. $R_n - G$ is in $\\mathrm{W\\,m^{-2}}$, which is equivalent to $\\mathrm{J\\,s^{-1}\\,m^{-2}}$.\n- $\\Delta = 0.188 \\ \\mathrm{kPa\\,K^{-1}}$\n- $R_{n} - G = 180 \\ \\mathrm{J\\,s^{-1}\\,m^{-2}}$\n- $r_{a} = 25 \\ \\mathrm{s\\,m^{-1}}$\n- $\\rho = 1.2 \\ \\mathrm{kg\\,m^{-3}}$\n- $c_{p} = 1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n\n$$(e_{s} - e_{a})^{\\ast} = \\frac{(0.188 \\ \\mathrm{kPa\\,K^{-1}}) (180 \\ \\mathrm{J\\,s^{-1}\\,m^{-2}}) (25 \\ \\mathrm{s\\,m^{-1}})}{(1.2 \\ \\mathrm{kg\\,m^{-3}}) (1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}})}$$\n$$(e_{s} - e_{a})^{\\ast} = \\frac{0.188 \\times 180 \\times 25}{1.2 \\times 1004} \\ \\mathrm{kPa}$$\n$$(e_{s} - e_{a})^{\\ast} = \\frac{846}{1204.8} \\ \\mathrm{kPa}$$\n$$(e_{s} - e_{a})^{\\ast} \\approx 0.70219 \\ \\mathrm{kPa}$$\nRounding to three significant figures as requested, the result is $0.702 \\ \\mathrm{kPa}$.",
            "answer": "$$\\boxed{0.702}$$"
        },
        {
            "introduction": "After examining a key flux like evapotranspiration, we can scale up to the entire water balance of a catchment. The principle of mass conservation, expressed as the water balance equation ($\\Delta S = P - E - Q$), provides a fundamental framework for hydrological assessment. This practice challenges you to apply this principle to multi-year time series of precipitation ($P$), evapotranspiration ($E$), and runoff ($Q$) . You will quantify the \"water balance closure error\" and, critically, use error propagation to diagnose which data component contributes most to the overall budget uncertainty, a vital task in data integration and model evaluation.",
            "id": "3814655",
            "problem": "You are given multi-year monthly sequences of basin-average Precipitation (P), Evapotranspiration (E), and Runoff (Q), each expressed as depth over the basin in millimeters per month. Starting from conservation of mass for a control volume, the water-balance principle states that the change in terrestrial water storage over a time interval equals inflows minus outflows. When storage change cannot be independently constrained, the closure residual over a multi-year period is assessed by aggregating inflows and outflows and examining the net imbalance. Treat the monthly uncertainties of $P$, $E$, and $Q$ as independent and characterized by monthly standard deviations, and use first-order variance propagation to attribute the closure error uncertainty to each component. Your program must implement the following tasks for each test case:\n\n1. Compute the monthly residual sequence as the inflow minus outflows based on $P$, $E$, and $Q$.\n2. Aggregate the monthly residuals over the full multi-year period to obtain the net imbalance $I$ (in millimeters).\n3. Compute the propagated uncertainty of $I$, denoted $\\sigma_I$ (in millimeters), using independence and first-order variance propagation across months and components.\n4. Compute the fractional contributions of the variance from $P$, $E$, and $Q$ to the total variance of $I$, denoted $f_P$, $f_E$, and $f_Q$, respectively, each expressed as a decimal. Each fractional contribution must be non-negative and their sum must equal $1$ within rounding tolerance.\n\nExpress $I$ and $\\sigma_I$ in millimeters and round them to three decimal places. Express $f_P$, $f_E$, and $f_Q$ as decimals and round them to three decimal places (do not use the percentage sign).\n\nTest suite parameters are provided below. Each test case consists of $T = 24$ months ($2$ years) with the first year repeated to form the second year. For each case, monthly uncertainties are constant within each component but can differ between components.\n\nTest Case $1$ (seasonal variability, moderate uncertainties):\n- First-year $P$: $80$, $60$, $70$, $75$, $90$, $100$, $120$, $110$, $95$, $85$, $70$, $65$.\n- First-year $E$: $30$, $35$, $40$, $50$, $60$, $80$, $100$, $95$, $70$, $50$, $40$, $35$.\n- First-year $Q$: $20$, $15$, $18$, $22$, $25$, $30$, $35$, $33$, $28$, $24$, $20$, $18$.\n- Monthly uncertainty standard deviations: $\\sigma_P = 5$ millimeters, $\\sigma_E = 8$ millimeters, $\\sigma_Q = 6$ millimeters.\n\nTest Case $2$ (exact monthly closure, nonzero uncertainties):\n- First-year $E$: $25$, $30$, $35$, $40$, $50$, $70$, $90$, $85$, $60$, $45$, $35$, $30$.\n- First-year $Q$: $15$, $20$, $25$, $35$, $40$, $40$, $45$, $40$, $35$, $35$, $25$, $20$.\n- First-year $P$: $40$, $50$, $60$, $75$, $90$, $110$, $135$, $125$, $95$, $80$, $60$, $50$.\n- Monthly uncertainty standard deviations: $\\sigma_P = 3$ millimeters, $\\sigma_E = 5$ millimeters, $\\sigma_Q = 4$ millimeters.\n\nTest Case $3$ (dominant evapotranspiration uncertainty):\n- First-year $P$: $70$, $55$, $60$, $65$, $85$, $95$, $110$, $105$, $90$, $80$, $65$, $60$.\n- First-year $E$: $40$, $45$, $50$, $55$, $65$, $85$, $95$, $90$, $70$, $55$, $50$, $45$.\n- First-year $Q$: $20$, $18$, $17$, $19$, $22$, $28$, $30$, $28$, $24$, $22$, $20$, $18$.\n- Monthly uncertainty standard deviations: $\\sigma_P = 2$ millimeters, $\\sigma_E = 20$ millimeters, $\\sigma_Q = 1$ millimeters.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The output must contain, in order for Test Cases $1$, $2$, and $3$, the following values: $I$, $\\sigma_I$, $f_P$, $f_E$, $f_Q$, then repeat for the next test case. For example, the format is $[I_1,\\sigma_{I,1},f_{P,1},f_{E,1},f_{Q,1},I_2,\\sigma_{I,2},f_{P,2},f_{E,2},f_{Q,2},I_3,\\sigma_{I,3},f_{P,3},f_{E,3},f_{Q,3}]$, with each numeric entry rounded to three decimal places.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principle of mass conservation, mathematically well-posed, objective, and contains all necessary information for a unique solution.\n\nThe fundamental principle guiding this analysis is the conservation of mass applied to a watershed, commonly expressed as the water balance equation. For a discrete time interval $i$ (in this case, one month), the change in terrestrial water storage, $\\Delta S_i$, is equal to the total water inflows minus the total water outflows. The primary inflow is Precipitation ($P_i$), and the primary outflows are Evapotranspiration ($E_i$) and Runoff ($Q_i$). All quantities are expressed as a depth in millimeters ($mm$) over the basin area. The equation for the monthly change in storage is:\n$$\n\\Delta S_i = P_i - E_i - Q_i\n$$\nThe problem defines the term $P_i - E_i - Q_i$ as the monthly residual, which we can denote as $R_i$.\n\nThe first task is to compute the net imbalance, $I$, over the entire multi-year period. This is the sum of the monthly residuals over the total number of months, $T$. The period is specified as $2$ years, so $T=24$ months. The net imbalance $I$ represents the total change in storage over the $T$-month period.\n$$\nI = \\sum_{i=1}^{T} R_i = \\sum_{i=1}^{T} (P_i - E_i - Q_i)\n$$\nSince the provided data for the first year is repeated to form the second year, the total sum can be calculated as twice the sum over the first year ($T_{yr} = 12$ months):\n$$\nI = 2 \\times \\sum_{i=1}^{T_{yr}} (P_i - E_i - Q_i)\n$$\n\nThe second task is to determine the uncertainty of the net imbalance, $\\sigma_I$, using first-order variance propagation. We are given that the monthly uncertainties of $P$, $E$, and $Q$ are independent. This implies that for a given month $i$, the measurements $P_i$, $E_i$, and $Q_i$ are uncorrelated. Furthermore, it implies that measurements from different months are also uncorrelated (e.g., $P_i$ is independent of $P_j$ for $i \\neq j$).\n\nThe variance of the monthly residual, $\\text{Var}(R_i) = \\sigma_{R_i}^2$, is found by applying the rules of variance propagation to the sum of independent variables. For any linear combination $Y = aX_1 + bX_2$ of independent variables, $\\text{Var}(Y) = a^2\\text{Var}(X_1) + b^2\\text{Var}(X_2)$. For the residual $R_i = P_i - E_i - Q_i$, the variance is:\n$$\n\\sigma_{R_i}^2 = \\text{Var}(P_i) + (-1)^2\\text{Var}(E_i) + (-1)^2\\text{Var}(Q_i) = \\sigma_{P_i}^2 + \\sigma_{E_i}^2 + \\sigma_{Q_i}^2\n$$\nThe net imbalance $I$ is the sum of these monthly residuals, $I = \\sum_{i=1}^{T} R_i$. Since the residuals $R_i$ for different months are independent, the variance of the total imbalance, $\\sigma_I^2$, is the sum of the variances of the monthly residuals:\n$$\n\\sigma_I^2 = \\text{Var}(I) = \\text{Var}\\left(\\sum_{i=1}^{T} R_i\\right) = \\sum_{i=1}^{T} \\text{Var}(R_i) = \\sum_{i=1}^{T} (\\sigma_{P_i}^2 + \\sigma_{E_i}^2 + \\sigma_{Q_i}^2)\n$$\nThe problem states that the monthly uncertainty standard deviations are constant for each component across all months. Let these be $\\sigma_P$, $\\sigma_E$, and $\\sigma_Q$. The equation for the total variance simplifies to:\n$$\n\\sigma_I^2 = \\sum_{i=1}^{T} (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2) = T \\cdot (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2)\n$$\nThe total uncertainty $\\sigma_I$ is the square root of this variance:\n$$\n\\sigma_I = \\sqrt{T \\cdot (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2)}\n$$\n\nThe final task is to calculate the fractional contributions ($f_P, f_E, f_Q$) of each component's variance to the total variance of the imbalance, $\\sigma_I^2$. The total variance contributed by Precipitation over the $T$ months is $\\sum_{i=1}^{T} \\sigma_P^2 = T \\cdot \\sigma_P^2$. Similarly, the total variance contributions from Evapotranspiration and Runoff are $T \\cdot \\sigma_E^2$ and $T \\cdot \\sigma_Q^2$, respectively.\nThe fractional contribution from Precipitation, $f_P$, is the ratio of its total variance contribution to the total imbalance variance:\n$$\nf_P = \\frac{T \\cdot \\sigma_P^2}{\\sigma_I^2} = \\frac{T \\cdot \\sigma_P^2}{T \\cdot (\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2)} = \\frac{\\sigma_P^2}{\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2}\n$$\nSimilarly, the fractional contributions from Evapotranspiration and Runoff are:\n$$\nf_E = \\frac{\\sigma_E^2}{\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2}\n$$\n$$\nf_Q = \\frac{\\sigma_Q^2}{\\sigma_P^2 + \\sigma_E^2 + \\sigma_Q^2}\n$$\nBy definition, the sum of these fractions must be unity: $f_P + f_E + f_Q = 1$. The calculations for each test case follow these derived formulas.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the water balance closure problem for a set of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test Case 1\",\n            \"P_yr1\": [80, 60, 70, 75, 90, 100, 120, 110, 95, 85, 70, 65],\n            \"E_yr1\": [30, 35, 40, 50, 60, 80, 100, 95, 70, 50, 40, 35],\n            \"Q_yr1\": [20, 15, 18, 22, 25, 30, 35, 33, 28, 24, 20, 18],\n            \"sigma_P\": 5,\n            \"sigma_E\": 8,\n            \"sigma_Q\": 6,\n        },\n        {\n            \"name\": \"Test Case 2\",\n            \"P_yr1\": [40, 50, 60, 75, 90, 110, 135, 125, 95, 80, 60, 50],\n            \"E_yr1\": [25, 30, 35, 40, 50, 70, 90, 85, 60, 45, 35, 30],\n            \"Q_yr1\": [15, 20, 25, 35, 40, 40, 45, 40, 35, 35, 25, 20],\n            \"sigma_P\": 3,\n            \"sigma_E\": 5,\n            \"sigma_Q\": 4,\n        },\n        {\n            \"name\": \"Test Case 3\",\n            \"P_yr1\": [70, 55, 60, 65, 85, 95, 110, 105, 90, 80, 65, 60],\n            \"E_yr1\": [40, 45, 50, 55, 65, 85, 95, 90, 70, 55, 50, 45],\n            \"Q_yr1\": [20, 18, 17, 19, 22, 28, 30, 28, 24, 22, 20, 18],\n            \"sigma_P\": 2,\n            \"sigma_E\": 20,\n            \"sigma_Q\": 1,\n        },\n    ]\n\n    all_results = []\n    T = 24  # Total number of months (2 years)\n\n    for case in test_cases:\n        p_yr1 = np.array(case[\"P_yr1\"])\n        e_yr1 = np.array(case[\"E_yr1\"])\n        q_yr1 = np.array(case[\"Q_yr1\"])\n        \n        sigma_P = case[\"sigma_P\"]\n        sigma_E = case[\"sigma_E\"]\n        sigma_Q = case[\"sigma_Q\"]\n        \n        # 1.  2. Compute the net imbalance I over the full 2-year period.\n        # The sum over 2 years is twice the sum over the first year.\n        imbalance_yr1 = np.sum(p_yr1) - np.sum(e_yr1) - np.sum(q_yr1)\n        I = 2 * imbalance_yr1\n        \n        # 3. Compute the propagated uncertainty of I, denoted sigma_I.\n        var_P = sigma_P**2\n        var_E = sigma_E**2\n        var_Q = sigma_Q**2\n        \n        # Total variance is T * (sum of monthly component variances).\n        var_I = T * (var_P + var_E + var_Q)\n        sigma_I = np.sqrt(var_I)\n        \n        # 4. Compute the fractional contributions to the total variance.\n        # The factor T cancels out from numerator and denominator.\n        total_comp_var = var_P + var_E + var_Q\n        f_P = var_P / total_comp_var if total_comp_var > 0 else 0\n        f_E = var_E / total_comp_var if total_comp_var > 0 else 0\n        f_Q = var_Q / total_comp_var if total_comp_var > 0 else 0\n        \n        # Append all five results for the current test case.\n        # Rounding is handled by the final f-string formatting.\n        all_results.extend([I, sigma_I, f_P, f_E, f_Q])\n\n    # Format the final results to three decimal places as required.\n    formatted_results = [f'{x:.3f}' for x in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Human activities like irrigation significantly alter the local water cycle, but mapping them at large scales is a persistent challenge. Remote sensing offers a powerful pathway for monitoring such changes by observing their physical signatures on the land surface. This practice asks you to design a diagnostic tool that detects irrigation by synergistically combining two distinct physical signals: the cooling effect of enhanced evaporation on surface temperature and the increase in vegetation water content observable in the microwave spectrum . You will translate these physical principles into a practical algorithm, validate its performance, and gain hands-on experience in synthesizing multi-source satellite data to address real-world environmental questions.",
            "id": "3814664",
            "problem": "A remote sensing and environmental modeling diagnostic must be designed to detect irrigation using satellite diurnal skin temperature amplitude and vegetation optical depth anomalies, and be validated against independent irrigation maps. The derivation and implementation must start from fundamental physical principles of the land surface energy balance and microwave radiative transfer, and must not assume any pre-existing detection formula. The diagnostic must satisfy the following requirements.\n\nFoundational base to use:\n- Land surface energy balance: net radiation partitions into sensible and latent heat flux, where increased evaporation due to irrigation reduces near-surface temperature variability over the diurnal cycle. The day-night land surface temperature amplitude responds to this partitioning.\n- Microwave radiative transfer: vegetation optical depth increases with vegetation water content, so anomalously wet vegetation increases the optical depth relative to climatology.\n\nData and units:\n- Use diurnal skin temperature amplitude in Kelvin (denote values in $K$). Specifically, differences are day-night amplitude values and climatological references in $K$.\n- Use Vegetation Optical Depth (VOD) values that are dimensionless.\n- All reported physical quantities must be internally computed in their specified units. Final skill metrics are dimensionless.\n\nImplementation tasks:\n1. Define standardized anomalies relative to a pixel-wise climatology for both diurnal skin temperature amplitude and Vegetation Optical Depth. Standardization should be computed from observed values, a climatological mean, and a climatological standard deviation, yielding dimensionless standardized anomalies that are comparable and composable.\n2. From first principles, construct a dimensionless irrigation fingerprint diagnostic that increases when irrigation is present, by combining the standardized anomalies such that reduced diurnal amplitude (consistent with increased evaporation) and increased Vegetation Optical Depth (consistent with increased vegetation water content) both increase the diagnostic. Derive the detection decision rule using a physically motivated threshold corresponding to the null expectation of no irrigation signal.\n3. Validate the diagnostic against independent irrigation map labels by computing a confusion matrix and the Matthews correlation coefficient for each test case. If the Matthews correlation coefficient denominator is zero (degenerate case), set the coefficient to $0.0$.\n\nTest suite:\nImplement the program to compute the detection and validation for the following four test cases. Each test case consists of arrays of pixel-wise inputs and an array of independent irrigation labels. For every array entry, each number must be used exactly as given. All quantities are specified in their units and all numbers must be treated as floats except labels, which are integers.\n\n- Test case $1$ (mixed signals, happy path):\n  - Diurnal amplitude observed $A_{\\mathrm{obs}}$: $[9.0,14.0,10.0,16.0,11.0,13.0]$ in $K$.\n  - Diurnal amplitude climatological mean $\\mu_{A}$: $[12.0,13.0,12.0,13.0,12.0,12.0]$ in $K$.\n  - Diurnal amplitude climatological standard deviation $\\sigma_{A}$: $[2.0,2.0,1.5,3.0,2.0,3.0]$ in $K$.\n  - Vegetation Optical Depth observed $V_{\\mathrm{obs}}$: $[0.62,0.50,0.58,0.53,0.56,0.54]$ (dimensionless).\n  - Vegetation Optical Depth climatological mean $\\mu_{V}$: $[0.54,0.52,0.55,0.53,0.55,0.55]$ (dimensionless).\n  - Vegetation Optical Depth climatological standard deviation $\\sigma_{V}$: $[0.04,0.03,0.02,0.04,0.02,0.02]$ (dimensionless).\n  - Independent irrigation labels $y$: $[1,0,1,0,1,0]$ where $1$ denotes irrigated and $0$ denotes non-irrigated.\n\n- Test case $2$ (all non-irrigated, boundary condition):\n  - $A_{\\mathrm{obs}}$: $[13.6,12.0,13.0,12.6]$ in $K$.\n  - $\\mu_{A}$: $[12.0,12.0,12.0,12.0]$ in $K$.\n  - $\\sigma_{A}$: $[2.0,2.0,2.0,2.0]$ in $K$.\n  - $V_{\\mathrm{obs}}$: $[0.52,0.544,0.55,0.541]$ (dimensionless).\n  - $\\mu_{V}$: $[0.55,0.55,0.55,0.55]$ (dimensionless).\n  - $\\sigma_{V}$: $[0.03,0.03,0.03,0.03]$ (dimensionless).\n  - $y$: $[0,0,0,0]$.\n\n- Test case $3$ (all irrigated, boundary condition):\n  - $A_{\\mathrm{obs}}$: $[11.0,11.5,10.5,12.0]$ in $K$.\n  - $\\mu_{A}$: $[13.0,13.0,13.0,13.0]$ in $K$.\n  - $\\sigma_{A}$: $[2.0,2.0,2.0,2.0]$ in $K$.\n  - $V_{\\mathrm{obs}}$: $[0.56,0.55,0.57,0.54]$ (dimensionless).\n  - $\\mu_{V}$: $[0.53,0.53,0.53,0.53]$ (dimensionless).\n  - $\\sigma_{V}$: $[0.02,0.02,0.02,0.02]$ (dimensionless).\n  - $y$: $[1,1,1,1]$.\n\n- Test case $4$ (ambiguous edge case, near-threshold signals):\n  - $A_{\\mathrm{obs}}$: $[11.2,12.8,11.0,12.0,13.5]$ in $K$.\n  - $\\mu_{A}$: $[12.0,12.0,12.0,12.0,12.0]$ in $K$.\n  - $\\sigma_{A}$: $[3.0,3.0,3.0,3.0,3.0]$ in $K$.\n  - $V_{\\mathrm{obs}}$: $[0.553,0.555,0.540,0.543,0.525]$ (dimensionless).\n  - $\\mu_{V}$: $[0.54,0.54,0.54,0.54,0.54]$ (dimensionless).\n  - $\\sigma_{V}$: $[0.03,0.03,0.03,0.03,0.03]$ (dimensionless).\n  - $y$: $[1,0,1,0,0]$.\n\nRequired computations:\n- Compute standardized anomalies $z_{A}$ for diurnal amplitude and $z_{V}$ for Vegetation Optical Depth for each pixel in each test case.\n- Construct a dimensionless irrigation fingerprint diagnostic from first principles that increases with decreasing $z_{A}$ and increasing $z_{V}$, and implement a detection rule that compares the diagnostic to the null threshold representing no irrigation signal.\n- For each test case, produce the Matthews correlation coefficient from the confusion matrix between detections and labels, with degenerate denominator mapped to $0.0$.\n\nFinal output format and numerical specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the Matthews correlation coefficient for each of the four test cases, each rounded to three decimal places (e.g., $[0.750,0.000,0.000,0.250]$). The metrics are dimensionless floats.\n\nNo external input should be read; all arrays must be embedded in the program exactly as specified above.",
            "solution": "The diagnostic is derived from fundamental relations linking surface energy balance to diurnal temperature variability and microwave radiative transfer to vegetation optical depth, then validated with a classification skill metric.\n\nFirst principles for the diurnal skin temperature amplitude. The land surface energy balance states that net radiation $R_{n}$ is partitioned among sensible heat flux $H$, latent heat flux $\\lambda E$, and ground heat flux $G$:\n$$\nR_{n} = H + \\lambda E + G.\n$$\nUnder irrigation, soil moisture increases, enhancing evaporation $\\lambda E$ and typically reducing $H$ as the evaporative fraction increases. Increased $\\lambda E$ dampens near-surface temperature excursions because more available energy is consumed by phase change rather than raising air and surface temperatures. The day-night land surface temperature amplitude (denote it $A$ in $K$) decreases when the evaporative fraction increases. Around a climatology, one can use standardized anomalies to compare signals across variables and regions. The standardized anomaly for diurnal amplitude is\n$$\nz_{A} = \\frac{A_{\\mathrm{obs}} - \\mu_{A}}{\\sigma_{A}},\n$$\nwhere $A_{\\mathrm{obs}}$ is the observed amplitude, $\\mu_{A}$ is the climatological mean, and $\\sigma_{A}$ is the climatological standard deviation. Since irrigation reduces diurnal amplitude relative to climatology, irrigation is associated with $z_{A}  0$ and, equivalently, with $-z_{A}  0$.\n\nFirst principles for Vegetation Optical Depth. Microwave radiative transfer through vegetation can be described by an optical depth $\\tau$ that scales with vegetation water content $W$ as\n$$\n\\tau \\propto W,\n$$\nwith proportionality set by species- and frequency-dependent parameters. Vegetation Optical Depth (VOD), a dimensionless measure of microwave attenuation, therefore increases when vegetation is wetter or biomass is higher. Around a climatology, the standardized anomaly for VOD is\n$$\nz_{V} = \\frac{V_{\\mathrm{obs}} - \\mu_{V}}{\\sigma_{V}},\n$$\nwhere $V_{\\mathrm{obs}}$ is the observed VOD, $\\mu_{V}$ is the climatological mean, and $\\sigma_{V}$ is its climatological standard deviation. Irrigation results in higher vegetation water content and often higher VOD relative to climatology, which yields $z_{V}  0$.\n\nConstructing a physically motivated diagnostic. A dimensionless irrigation fingerprint diagnostic should increase when the diurnal amplitude anomaly decreases and the VOD anomaly increases. The simplest such diagnostic that respects the directionality is a linear combination of standardized anomalies:\n$$\nS = \\alpha \\, (-z_{A}) + \\beta \\, z_{V},\n$$\nwhere $\\alpha$ and $\\beta$ are non-negative weights. In the absence of additional calibration, a principle-based choice is $\\alpha = 1$ and $\\beta = 1$, which assumes comparable sensitivity after standardization. This yields\n$$\nS = -z_{A} + z_{V}.\n$$\nUnder the null hypothesis of no irrigation signal, the standardized anomalies are centered at zero, and the expectation of $S$ is zero. Therefore, a physically motivated detection rule is\n$$\n\\text{detect irrigation if } S  0,\n$$\nthat is, when the positive contribution of increased VOD outweighs any increase in diurnal amplitude, or when decreased diurnal amplitude combines with non-negative VOD anomaly to yield an overall positive fingerprint.\n\nValidation metric. For each test case, compare detections to labels $y \\in \\{0,1\\}$ and compute the confusion matrix counts: true positives $TP$, true negatives $TN$, false positives $FP$, and false negatives $FN$. The Matthews correlation coefficient (dimensionless) is\n$$\n\\mathrm{MCC} = \\frac{TP \\cdot TN - FP \\cdot FN}{\\sqrt{(TP+FP)(TP+FN)(TN+FP)(TN+FN)}}.\n$$\nIn degenerate cases where the denominator is zero (for example, all detections and labels are of a single class), define $\\mathrm{MCC} = 0.0$ to avoid undefined behavior. This convention yields a bounded and computable skill measure for all four test cases.\n\nAlgorithmic steps for implementation:\n1. For each pixel, compute $z_{A}$ using $A_{\\mathrm{obs}}$, $\\mu_{A}$, and $\\sigma_{A}$ as given, ensuring that $A$ quantities are treated in $K$.\n2. For each pixel, compute $z_{V}$ using $V_{\\mathrm{obs}}$, $\\mu_{V}$, and $\\sigma_{V}$ as given.\n3. Compute $S = -z_{A} + z_{V}$ for each pixel. Apply the detection rule $S  0$ to produce a boolean detection.\n4. Compare detections to labels $y$ to accumulate $TP$, $TN$, $FP$, and $FN$, then compute $\\mathrm{MCC}$ for each test case using the formula above, with the degenerate-denominator rule mapping to $0.0$.\n5. Round each $\\mathrm{MCC}$ to three decimal places and output a single line in the specified format with the four values.\n\nPhysical consistency and the test suite. The given numerical values are internally consistent with the described physics: irrigated pixels have lower diurnal amplitude relative to climatology (negative $z_{A}$) and higher VOD relative to climatology (positive $z_{V}$), while non-irrigated pixels have the opposite or neutral characteristics. The boundary test cases probe degenerate confusion matrices, and the ambiguous case includes near-threshold signals to test robustness. The final program produces a single line of output containing the four dimensionless $\\mathrm{MCC}$ values, each rounded to three decimal places, in the order of the test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef standardized_anomaly(obs: np.ndarray, mu: np.ndarray, sigma: np.ndarray) - np.ndarray:\n    \"\"\"Compute standardized anomalies (z-scores) elementwise.\"\"\"\n    return (obs - mu) / sigma\n\ndef irrigation_fingerprint(z_A: np.ndarray, z_V: np.ndarray) - npndarray:\n    \"\"\"\n    Compute the irrigation fingerprint diagnostic S = -z_A + z_V.\n    Positive values indicate irrigation presence under the derived rule.\n    \"\"\"\n    return (-z_A) + z_V\n\ndef detect_irrigation(S: np.ndarray) - np.ndarray:\n    \"\"\"\n    Detection rule: irrigation is detected if S > 0.0.\n    Returns a boolean array.\n    \"\"\"\n    return S > 0.0\n\ndef matthews_correlation_coefficient(y_true: np.ndarray, y_pred: np.ndarray) - float:\n    \"\"\"\n    Compute Matthews correlation coefficient.\n    If the denominator is zero (degenerate case), return 0.0.\n    \"\"\"\n    # Convert booleans to integers 0/1 for counting\n    yt = y_true.astype(int)\n    yp = y_pred.astype(int)\n    tp = int(np.sum((yp == 1)  (yt == 1)))\n    tn = int(np.sum((yp == 0)  (yt == 0)))\n    fp = int(np.sum((yp == 1)  (yt == 0)))\n    fn = int(np.sum((yp == 0)  (yt == 1)))\n\n    denom = np.sqrt((tp + fp) * (tp + fn) * (tn + fp) * (tn + fn))\n    if denom == 0.0:\n        return 0.0\n    return (tp * tn - fp * fn) / denom\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a dict with observed and climatological arrays and labels.\n    test_cases = [\n        {\n            \"A_obs\": np.array([9.0, 14.0, 10.0, 16.0, 11.0, 13.0], dtype=float),\n            \"A_mu\":  np.array([12.0, 13.0, 12.0, 13.0, 12.0, 12.0], dtype=float),\n            \"A_sigma\": np.array([2.0, 2.0, 1.5, 3.0, 2.0, 3.0], dtype=float),\n            \"V_obs\": np.array([0.62, 0.50, 0.58, 0.53, 0.56, 0.54], dtype=float),\n            \"V_mu\":  np.array([0.54, 0.52, 0.55, 0.53, 0.55, 0.55], dtype=float),\n            \"V_sigma\": np.array([0.04, 0.03, 0.02, 0.04, 0.02, 0.02], dtype=float),\n            \"labels\": np.array([1, 0, 1, 0, 1, 0], dtype=int),\n        },\n        {\n            \"A_obs\": np.array([13.6, 12.0, 13.0, 12.6], dtype=float),\n            \"A_mu\":  np.array([12.0, 12.0, 12.0, 12.0], dtype=float),\n            \"A_sigma\": np.array([2.0, 2.0, 2.0, 2.0], dtype=float),\n            \"V_obs\": np.array([0.52, 0.544, 0.55, 0.541], dtype=float),\n            \"V_mu\":  np.array([0.55, 0.55, 0.55, 0.55], dtype=float),\n            \"V_sigma\": np.array([0.03, 0.03, 0.03, 0.03], dtype=float),\n            \"labels\": np.array([0, 0, 0, 0], dtype=int),\n        },\n        {\n            \"A_obs\": np.array([11.0, 11.5, 10.5, 12.0], dtype=float),\n            \"A_mu\":  np.array([13.0, 13.0, 13.0, 13.0], dtype=float),\n            \"A_sigma\": np.array([2.0, 2.0, 2.0, 2.0], dtype=float),\n            \"V_obs\": np.array([0.56, 0.55, 0.57, 0.54], dtype=float),\n            \"V_mu\":  np.array([0.53, 0.53, 0.53, 0.53], dtype=float),\n            \"V_sigma\": np.array([0.02, 0.02, 0.02, 0.02], dtype=float),\n            \"labels\": np.array([1, 1, 1, 1], dtype=int),\n        },\n        {\n            \"A_obs\": np.array([11.2, 12.8, 11.0, 12.0, 13.5], dtype=float),\n            \"A_mu\":  np.array([12.0, 12.0, 12.0, 12.0, 12.0], dtype=float),\n            \"A_sigma\": np.array([3.0, 3.0, 3.0, 3.0, 3.0], dtype=float),\n            \"V_obs\": np.array([0.553, 0.555, 0.540, 0.543, 0.525], dtype=float),\n            \"V_mu\":  np.array([0.54, 0.54, 0.54, 0.54, 0.54], dtype=float),\n            \"V_sigma\": np.array([0.03, 0.03, 0.03, 0.03, 0.03], dtype=float),\n            \"labels\": np.array([1, 0, 1, 0, 0], dtype=int),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        z_A = standardized_anomaly(case[\"A_obs\"], case[\"A_mu\"], case[\"A_sigma\"])\n        z_V = standardized_anomaly(case[\"V_obs\"], case[\"V_mu\"], case[\"V_sigma\"])\n        S = irrigation_fingerprint(z_A, z_V)\n        detections = detect_irrigation(S)\n        mcc = matthews_correlation_coefficient(case[\"labels\"], detections)\n        results.append(mcc)\n\n    # Final print statement in the exact required format with three decimals.\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}