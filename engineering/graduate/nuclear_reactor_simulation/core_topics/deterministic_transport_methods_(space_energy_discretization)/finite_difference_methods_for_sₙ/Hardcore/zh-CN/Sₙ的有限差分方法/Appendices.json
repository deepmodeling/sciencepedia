{
    "hands_on_practices": [
        {
            "introduction": "Sₙ输运问题的有限差分法，其基础在于将连续的玻尔兹曼方程离散化为一组代数方程。第一个练习  将引导您完成这一基本过程。通过推导二维单元的离散守恒方程，并应用菱形差分关系，您将直接理解单元中心角通量与界面平均角通量之间的关系，这是输运扫描算法的基石。",
            "id": "4225370",
            "problem": "考虑一个二维笛卡尔单元中的稳态、单能输运问题，该单元内有各向同性固定内源，问题由线性玻尔兹曼输运方程建模。其基本方程是关于方向余弦对的角通量平衡方程，在平面几何中可以写为 $ \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\boldsymbol{r}, \\boldsymbol{\\Omega}) + \\Sigma_{t} \\psi(\\boldsymbol{r}, \\boldsymbol{\\Omega}) = Q(\\boldsymbol{r}, \\boldsymbol{\\Omega}) $，其中 $ \\psi $ 是角通量，$ \\boldsymbol{\\Omega} $ 是单位方向向量，其分量为 $ \\mu $ 和 $ \\eta $，$ \\Sigma_{t} $ 是总宏观截面，$ Q $ 是源项。\n\n在二维笛卡尔几何中使用离散纵标法（$S_n$）进行角度离散，取 $ n = 4 $ 个方向，具体为水平对称集，其方向余弦为 $ (\\mu_{m}, \\eta_{m}) \\in \\{ (\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}), (\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}), (-\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}), (-\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}) \\} $，求积权重为 $ w_{m} = \\frac{\\pi}{2} $，使得 $ \\sum_{m=1}^{4} w_{m} = 2 \\pi $。假设单元的所有四个面上都为真空（黑体）边界条件。\n\n使用有限体积单元平衡法对输运方程进行离散化，考虑一个边长为 $ h = 2 $（无量纲长度单位）的单个方形单元，其单元中心总截面为 $ \\Sigma_{t} = 1 $（无量纲），每个离散方向上的固定源与角度无关且各向同性，为 $ Q^{m} = q = 0.5 $（无量纲）。使用每个面上的菱形差分关系来封闭离散方程。根据 $ \\mu_{m} $ 和 $ \\eta_{m} $ 的符号所决定的迎风顺序进行方向扫描（例如，对于 $ \\mu_{m} > 0 $ 和 $ \\eta_{m} > 0 $，从西南面扫描到东北面；对于其他符号组合，则相应地调整）。由于只有一个单元，扫描顺序仍必须遵循对每个方向的入射面的识别。\n\n从连续角通量平衡方程出发，推导给定方向上单元中心角通量的离散菱形差分单元方程，并用它计算单元中心的离散标量通量 $ \\phi $，其计算公式为 $\\phi \\approx \\sum_{m=1}^{4} w_m \\psi^m $，其中 $ \\psi^{m} $ 是方向 $ m $ 的单元中心角通量。将你最终的 $ \\phi $ 数值结果四舍五入到四位有效数字。用无量纲单位表示你的最终答案。",
            "solution": "用户希望使用带有菱形差分空间封闭关系的离散纵标法（$S_n$），求解单个二维笛卡尔单元中的单元中心标量通量。\n\n出发点是二维笛卡尔坐标 $(x, y)$ 中离散方向 $m$ 的稳态、单能、线性玻尔兹曼输运方程：\n$$ \\mu_m \\frac{\\partial \\psi_m(x, y)}{\\partial x} + \\eta_m \\frac{\\partial \\psi_m(x, y)}{\\partial y} + \\Sigma_t \\psi_m(x, y) = Q_m(x, y) $$\n这里，$\\psi_m$ 是方向 $m$ 的角通量，$(\\mu_m, \\eta_m)$ 是方向余弦，$\\Sigma_t$ 是总宏观截面，$Q_m$ 是方向 $m$ 的源项。\n\n为了离散化该方程，我们将其在方形单元的面积上进行积分，该单元在 $x$ 方向上从 $x_{i-1/2}$ 延伸到 $x_{i+1/2}$，在 $y$ 方向上从 $y_{j-1/2}$ 延伸到 $y_{j+1/2}$。该单元的边长为 $h$。单元面积为 $A = h^2$。\n$$ \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( \\mu_m \\frac{\\partial \\psi_m}{\\partial x} + \\eta_m \\frac{\\partial \\psi_m}{\\partial y} \\right) dx dy + \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\Sigma_t \\psi_m dx dy = \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} Q_m dx dy $$\n对微分项进行积分，得到：\n$$ \\mu_m \\int_{y_{j-1/2}}^{y_{j+1/2}} \\left[ \\psi_m(x_{i+1/2}, y) - \\psi_m(x_{i-1/2}, y) \\right] dy + \\eta_m \\int_{x_{i-1/2}}^{x_{i+1/2}} \\left[ \\psi_m(x, y_{j+1/2}) - \\psi_m(x, y_{j-1/2}) \\right] dx + \\text{(损失项)} = \\text{(源项)} $$\n我们引入以下有限差分近似：\n- 单元平均角通量: $\\psi_m^{i,j} \\approx \\frac{1}{h^2} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\psi_m(x, y) dx dy$\n- 面平均角通量:\n  $\\psi_{m, i+1/2} \\approx \\frac{1}{h} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\psi_m(x_{i+1/2}, y) dy$\n  $\\psi_{m, i-1/2} \\approx \\frac{1}{h} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\psi_m(x_{i-1/2}, y) dy$\n  （$y$ 方向的面 $\\psi_{m, j+1/2}$ 和 $\\psi_{m, j-1/2}$ 同理）。\n- 单元平均源: $Q_m^{i,j} \\approx \\frac{1}{h^2} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} Q_m(x, y) dx dy$\n\n利用这些近似，并假设 $\\Sigma_t$ 和 $Q_m$ 在单元内为常数，积分后的方程就变成了离散单元平衡方程。为简单起见，由于只有一个单元，我们省略单元索引 $(i,j)$。\n$$ \\mu_m h (\\psi_{m, i+1/2} - \\psi_{m, i-1/2}) + \\eta_m h (\\psi_{m, j+1/2} - \\psi_{m, j-1/2}) + \\Sigma_t h^2 \\psi^m = Q^m h^2 $$\n两边同时除以单元面积 $h^2$，我们得到：\n$$ \\frac{\\mu_m}{h} (\\psi_{m, i+1/2} - \\psi_{m, i-1/2}) + \\frac{\\eta_m}{h} (\\psi_{m, j+1/2} - \\psi_{m, j-1/2}) + \\Sigma_t \\psi^m = Q^m $$\n这个方程必须写成能反映粒子流动方向（迎风格式）的形式。表示通量差的项可以用入射面通量和出射面通量重写。对于方向 $m$，设 $\\psi_{m, \\text{in}, x}$ 和 $\\psi_{m, \\text{out}, x}$ 分别为垂直于 $x$ 轴的面上的入射通量和出射通量（$y$ 方向同理）。平衡方程为：\n$$ \\frac{|\\mu_m|}{h} (\\psi_{m, \\text{out}, x} - \\psi_{m, \\text{in}, x}) + \\frac{|\\eta_m|}{h} (\\psi_{m, \\text{out}, y} - \\psi_{m, \\text{in}, y}) + \\Sigma_t \\psi^m = Q^m $$\n菱形差分（DD）封闭关系将单元平均通量与面平均通量联系起来：\n$$ \\psi^m = \\frac{\\psi_{m, \\text{out}, x} + \\psi_{m, \\text{in}, x}}{2} \\implies \\psi_{m, \\text{out}, x} = 2 \\psi^m - \\psi_{m, \\text{in}, x} $$\n$$ \\psi^m = \\frac{\\psi_{m, \\text{out}, y} + \\psi_{m, \\text{in}, y}}{2} \\implies \\psi_{m, \\text{out}, y} = 2 \\psi^m - \\psi_{m, \\text{in}, y} $$\n将这些出射通量的表达式代入平衡方程：\n$$ \\frac{|\\mu_m|}{h} ((2\\psi^m - \\psi_{m, \\text{in}, x}) - \\psi_{m, \\text{in}, x}) + \\frac{|\\eta_m|}{h} ((2\\psi^m - \\psi_{m, \\text{in}, y}) - \\psi_{m, \\text{in}, y}) + \\Sigma_t \\psi^m = Q^m $$\n化简此方程：\n$$ \\frac{2|\\mu_m|}{h} (\\psi^m - \\psi_{m, \\text{in}, x}) + \\frac{2|\\eta_m|}{h} (\\psi^m - \\psi_{m, \\text{in}, y}) + \\Sigma_t \\psi^m = Q^m $$\n我们现在可以求解未知的单元平均通量 $\\psi^m$：\n$$ \\psi^m \\left( \\frac{2|\\mu_m|}{h} + \\frac{2|\\eta_m|}{h} + \\Sigma_t \\right) = Q^m + \\frac{2|\\mu_m|}{h} \\psi_{m, \\text{in}, x} + \\frac{2|\\eta_m|}{h} \\psi_{m, \\text{in}, y} $$\n$$ \\psi^m = \\frac{Q^m + \\frac{2|\\mu_m|}{h} \\psi_{m, \\text{in}, x} + \\frac{2|\\eta_m|}{h} \\psi_{m, \\text{in}, y}}{\\Sigma_t + \\frac{2|\\mu_m|}{h} + \\frac{2|\\eta_m|}{h}} $$\n题目指明单个单元的所有四个面都为真空边界条件。这意味着对于任何方向 $m$，任何边界表面上的入射角通量都为零。因此，对于所有 $m$，$\\psi_{m, \\text{in}, x} = 0$ 且 $\\psi_{m, \\text{in}, y} = 0$。$\\psi^m$ 的方程简化为：\n$$ \\psi^m = \\frac{Q^m}{\\Sigma_t + \\frac{2|\\mu_m|}{h} + \\frac{2|\\eta_m|}{h}} $$\n现在，我们代入所提供的数值：\n- 单元边长: $h = 2$\n- 总截面: $\\Sigma_t = 1$\n- 每个方向的源: $Q^m = q = 0.5$\n- 方向余弦: 对于给定的 $S_4$ 水平对称集，对所有的 $m = 1, 2, 3, 4$，都有 $|\\mu_m| = |\\eta_m| = \\frac{1}{\\sqrt{2}}$。\n\n将这些值代入 $\\psi^m$ 的表达式中：\n$$ \\psi^m = \\frac{0.5}{1 + \\frac{2(1/\\sqrt{2})}{2} + \\frac{2(1/\\sqrt{2})}{2}} = \\frac{0.5}{1 + \\frac{1}{\\sqrt{2}} + \\frac{1}{\\sqrt{2}}} = \\frac{0.5}{1 + \\frac{2}{\\sqrt{2}}} = \\frac{0.5}{1 + \\sqrt{2}} $$\n由于对于所有的 $m=1, 2, 3, 4$，源和方向余弦的模都是相同的，因此单元平均角通量 $\\psi^m$ 对于所有四个方向都是相同的。\n\n最后一步是计算单元中心标量通量 $\\phi$，它通过对离散纵标求和来近似：\n$$ \\phi \\approx \\sum_{m=1}^{4} w_m \\psi^m $$\n求积权重给定为对所有 $m$ 都有 $w_m = \\frac{\\pi}{2}$。由于 $\\psi^m$ 对所有 $m$ 都是常数，我们可以将其从求和中提取出来：\n$$ \\phi = \\psi^m \\sum_{m=1}^{4} w_m = \\left( \\frac{0.5}{1 + \\sqrt{2}} \\right) \\left( 4 \\times \\frac{\\pi}{2} \\right) = \\left( \\frac{0.5}{1 + \\sqrt{2}} \\right) (2\\pi) $$\n将 $0.5$ 写成 $\\frac{1}{2}$：\n$$ \\phi = \\left( \\frac{1/2}{1 + \\sqrt{2}} \\right) (2\\pi) = \\frac{1}{2(1 + \\sqrt{2})} (2\\pi) = \\frac{\\pi}{1 + \\sqrt{2}} $$\n为化简此表达式，我们对分母进行有理化：\n$$ \\phi = \\frac{\\pi}{1 + \\sqrt{2}} \\times \\frac{\\sqrt{2} - 1}{\\sqrt{2} - 1} = \\frac{\\pi(\\sqrt{2} - 1)}{(\\sqrt{2})^2 - 1^2} = \\frac{\\pi(\\sqrt{2} - 1)}{2 - 1} = \\pi(\\sqrt{2} - 1) $$\n现在，我们计算其数值并四舍五入到四位有效数字：\n$$ \\phi = \\pi(\\sqrt{2} - 1) \\approx (3.14159...)(1.41421... - 1) \\approx (3.14159...)(0.41421...) \\approx 1.3013698... $$\n四舍五入到四位有效数字得到 $1.301$。",
            "answer": "$$\n\\boxed{1.301}\n$$"
        },
        {
            "introduction": "推导出离散方程后，下一步是求解由此产生的线性系统。虽然完整的Sₙ问题很复杂，但其底层的矩阵结构通常与更简单的扩散问题相似，而扩散问题本身也是扩散综合加速（DSA）等加速方案的关键组成部分。这个练习  提供了一个动手编程的挑战，要求您构建并求解离散格林函数所对应的三对角系统，从而培养实现Sₙ求解器所需的核心计算技能。",
            "id": "3228117",
            "problem": "考虑在区间 $[0,1]$ 上，与微分算子 $-\\frac{d^2}{dx^2}$ 相关联的格林函数 $G(x,s)$ 的一维齐次狄利克雷边界值问题 (BVP)：\n$$\n-\\,\\frac{\\partial^2}{\\partial x^2} G(x,s) \\;=\\; \\delta(x-s), \\quad G(0,s)=0,\\; G(1,s)=0,\n$$\n其中 $\\delta$ 表示狄拉克$\\delta$函数。你的任务是使用有限差分法（FDM）计算一个完全离散的模拟。\n\n从第一性原理出发，在 $[0,1]$ 上构建一个包含 $N$ 个子区间的均匀网格：\n$$\nx_i \\;=\\; i\\,h,\\quad h \\;=\\; \\frac{1}{N},\\quad i=0,1,\\dots,N,\n$$\n并施加离散的齐次狄利克雷边界条件 $G_0=G_N=0$，其中 $G_i$ 是 $G(x_i,s)$ 的近似值。在内部节点 $i=1,\\dots,N-1$ 上，通过标准的中心二阶差分来离散化 $-\\,\\frac{d^2}{dx^2}$，这样离散算子 $L_h$ 应用于向量 $G=(G_1,\\dots,G_{N-1})^\\top$ 时，其分量形式由下式给出：\n$$\n(L_h G)_i \\;=\\; -\\,\\frac{G_{i-1}-2G_i+G_{i+1}}{h^2},\\quad i=1,\\dots,N-1,\n$$\n其中我们理解为 $G_0=G_N=0$。\n\n定义离散$\\delta$函数 $\\delta_h$，使其在黎曼和的意义下保持单位质量：\n$$\n\\sum_{i=1}^{N-1} h\\,(\\delta_h)_i \\;=\\; 1.\n$$\n对于源点位置 $s$ 恰好与某个网格点 $x_k$（$k\\in\\{1,\\dots,N-1\\}$）重合的特殊情况，取：\n$$\n(\\delta_h)_i \\;=\\; \\begin{cases}\n\\frac{1}{h},  & i=k, \\\\[4pt]\n0, & i\\neq k.\n\\end{cases}\n$$\n然后通过求解线性系统来获得离散格林函数值 $(G_1,\\dots,G_{N-1})$：\n$$\nL_h G \\;=\\; \\delta_h.\n$$\n\n实现一个程序，对于下面的测试集，该程序组装并求解由 $L_h$ 和上述 $\\delta_h$ 导出的三对角线性系统，并报告离散格林函数向量的选定条目。下面所有 $G_i$ 的索引均指内部索引 $i\\in\\{1,\\dots,N-1\\}$。\n\n测试集：\n- 情况 A：$N=8$, $k=3$，报告 $G_2$, $G_3$, $G_5$。\n- 情况 B：$N=8$, $k=1$，报告 $G_1$, $G_2$, $G_7$。\n- 情况 C：$N=16$, $k=8$，报告 $G_4$, $G_8$, $G_{12}$。\n\n要求：\n- 使用指定的中心二阶差分格式和齐次狄利克雷边界条件来构造 $L_h$。\n- 精确地按照规定构造 $\\delta_h$，以使其满足单位质量属性，即 $\\sum_{i=1}^{N-1} h\\,(\\delta_h)_i=1$。\n- 对每种情况，使用数值稳定的线性代数方法精确求解所得的线性系统。\n- 本问题不涉及物理单位。\n- 你的程序应生成单行输出，其中包含按顺序排列的结果，格式为用方括号括起来的逗号分隔列表，无空格：\n$$\n[\\,G_2^{(\\text{A})},G_3^{(\\text{A})},G_5^{(\\text{A})},G_1^{(\\text{B})},G_2^{(\\text{B})},G_7^{(\\text{B})},G_4^{(\\text{C})},G_8^{(\\text{C})},G_{12}^{(\\text{C})}\\,].\n$$\n每个条目必须以十进制数（浮点数）打印。答案类型为浮点数，汇总到单个列表中。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它具有科学依据、是适定且客观的。它提出了一个在数值分析中使用有限差分法求解边界值问题的标准的、自包含的问题。所有必要的数据和定义都已提供，没有矛盾，并且允许计算出唯一的、有意义的解。\n\n任务是为在区间 $[0,1]$ 上带有齐次狄利克雷边界条件的算子 $L = -\\frac{d^2}{dx^2}$ 寻找格林函数 $G(x,s)$ 的数值近似解。其控制方程为：\n$$\n-\\frac{\\partial^2}{\\partial x^2} G(x,s) = \\delta(x-s), \\quad G(0,s)=0, G(1,s)=0.\n$$\n我们在均匀网格 $x_i = ih$（$i=0, 1, \\dots, N$）上采用有限差分法，步长为 $h = 1/N$。离散解向量，记作 $G = (G_1, G_2, \\dots, G_{N-1})^\\top$，近似了内部网格点上的格林函数，即 $G_i \\approx G(x_i, s)$。边界条件被施加为 $G_0 = 0$ 和 $G_N = 0$。\n\n微分算子由中心二阶差分格式近似。离散算子 $L_h$ 作用于向量 $G$，其第 $i$ 个分量为：\n$$\n(L_h G)_i = -\\frac{G_{i-1} - 2G_i + G_{i+1}}{h^2}, \\quad \\text{for } i=1, \\dots, N-1.\n$$\n源项，即狄拉克$\\delta$函数 $\\delta(x-s)$，在源点位置 $s$ 与某个网格点 $x_k=kh$（$k \\in \\{1, \\dots, N-1\\}$）重合的情况下，被离散化为一个向量 $\\delta_h$。该离散$\\delta$函数的分量定义如下：\n$$\n(\\delta_h)_i = \\begin{cases} \\frac{1}{h}  & i=k \\\\ 0  & i \\neq k \\end{cases}.\n$$\n这个定义正确地保持了单位质量属性，即 $\\sum_{i=1}^{N-1} h (\\delta_h)_i = h \\cdot (\\frac{1}{h}) = 1$。\n\n因此，问题简化为求解 $(N-1) \\times (N-1)$ 的线性方程组：\n$$\nL_h G = \\delta_h.\n$$\n其矩阵形式为 $A G = b$，其中矩阵 $A$ 代表算子 $L_h$，向量 $b$ 代表离散源 $\\delta_h$。矩阵 $A$ 的元素由 $L_h$ 的差分格式导出：\n$$\nA = \\frac{1}{h^2}\n\\begin{pmatrix}\n2  -1  0  \\cdots  0 \\\\\n-1  2  -1  \\ddots  \\vdots \\\\\n0  \\ddots  \\ddots  \\ddots  0 \\\\\n\\vdots  \\ddots  -1  2  -1 \\\\\n0  \\cdots  0  -1  2\n\\end{pmatrix}.\n$$\n向量 $b$ 在索引 $k-1$ 处有一个非零元素（对内部点向量使用从0开始的索引）：\n$$\nb = \\left(0, \\dots, 0, \\frac{1}{h}, 0, \\dots, 0\\right)^\\top,\n$$\n其中非零元素位于第 $k$ 个位置。\n\n为了提高数值稳定性和计算便利性，我们可以将整个系统乘以 $h^2$：\n$$\n(h^2 A) G = h^2 b.\n$$\n令 $A' = h^2 A$ 且 $b' = h^2 b$。修改后的矩阵 $A'$ 和向量 $b'$ 为：\n$$\nA' = \n\\begin{pmatrix}\n2  -1  0  \\cdots  0 \\\\\n-1  2  -1  \\ddots  \\vdots \\\\\n0  \\ddots  \\ddots  \\ddots  0 \\\\\n\\vdots  \\ddots  -1  2  -1 \\\\\n0  \\cdots  0  -1  2\n\\end{pmatrix},\n\\quad\nb' = \n\\left(0, \\dots, 0, h, 0, \\dots, 0\\right)^\\top.\n$$\n求解该系统 $A'G = b'$ 以获得未知向量 $G$。矩阵 $A'$ 是对称、正定和三对角的，这保证了可以高效地找到一个唯一的、稳定的解。\n\n指定的测试用例通过以下步骤求解：\n1.  对于每种情况（A, B, C），使用参数 $N$ 和 $k$ 来定义问题规模 $N-1$ 和步长 $h=1/N$。\n2.  组装 $(N-1) \\times (N-1)$ 的三对角矩阵 $A'$。\n3.  构造大小为 $N-1$ 的右端向量 $b'$，其在索引 $k-1$ 处的值为 $h$，其他位置为零。\n4.  求解线性系统 $A'G=b'$ 以获得离散格林函数值 $G = (G_1, \\dots, G_{N-1})^\\top$。\n5.  从解向量 $G$ 中提取指定的元素 $G_i$。请注意，问题对网格点 $i \\in \\{1, \\dots, N-1\\}$ 使用从1开始的索引，这对应于解向量中从0开始的索引 $i-1$。\n\n- **情况 A**：$N=8$, $k=3$。我们求解一个 $7 \\times 7$ 的系统。我们报告元素 $G_2, G_3, G_5$，对应于解向量的索引 $1, 2, 4$。\n- **情况 B**：$N=8$, $k=1$。我们求解一个 $7 \\times 7$ 的系统。我们报告元素 $G_1, G_2, G_7$，对应于解向量的索引 $0, 1, 6$。\n- **情况 C**：$N=16$, $k=8$。我们求解一个 $15 \\times 15$ 的系统。我们报告元素 $G_4, G_8, G_{12}$，对应于解向量的索引 $3, 7, 11$。\n\n最终的程序实现了这一确切的逻辑来计算所需的值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_discrete_greens_function(N, k):\n    \"\"\"\n    Assembles and solves the finite difference system for the discrete Green's function.\n\n    Args:\n        N (int): The number of subintervals on [0,1].\n        k (int): The 1-based index of the grid point where the source is located.\n\n    Returns:\n        numpy.ndarray: The solution vector G = (G_1, ..., G_{N-1}).\n    \"\"\"\n    # The number of interior grid points, which is the dimension of the linear system.\n    dim = N - 1\n    \n    # Grid spacing\n    h = 1.0 / N\n\n    # Construct the matrix A' = h^2 * L_h = tridiag(-1, 2, -1).\n    # This matrix is of size (N-1) x (N-1).\n    # Main diagonal with 2s.\n    main_diag = 2 * np.ones(dim)\n    # Off-diagonals with -1s.\n    off_diag = -1 * np.ones(dim - 1)\n    \n    A_prime = np.diag(main_diag, 0) + np.diag(off_diag, -1) + np.diag(off_diag, 1)\n\n    # Construct the right-hand side vector b' = h^2 * delta_h.\n    # It's a vector of zeros except for the entry at index (k-1), which is h.\n    # The index is (k-1) because k is 1-based and array indices are 0-based.\n    b_prime = np.zeros(dim)\n    b_prime[k - 1] = h\n\n    # Solve the linear system A' * G = b' for the vector G.\n    G = np.linalg.solve(A_prime, b_prime)\n    \n    return G\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, k, list_of_indices_to_report).\n    # Indices are 1-based as per the problem.\n    test_cases = [\n        (8, 3, [2, 3, 5]),   # Case A\n        (8, 1, [1, 2, 7]),   # Case B\n        (16, 8, [4, 8, 12]), # Case C\n    ]\n\n    results = []\n    for case in test_cases:\n        N, k, indices_to_report = case\n        \n        # Calculate the full solution vector for the discrete Green's function.\n        G_solution = solve_discrete_greens_function(N, k)\n        \n        # Extract the required values.\n        # Convert 1-based problem indices to 0-based array indices.\n        for idx in indices_to_report:\n            results.append(G_solution[idx - 1])\n\n    # Final print statement in the exact required format.\n    # The format is a comma-separated list of float values enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "对于包含散射的实际问题，Sₙ方程需要迭代求解，但基本的源迭代（SI）方法收敛非常缓慢。为了达到实用的计算效率，加速技术至关重要。这个高级分析练习  深入探讨了这一挑战背后的理论，要求您分析SI的收敛行为以及扩散综合加速（DSA）预处理器的修正效果。通过研究最简单的傅里叶模式，您将精确地揭示为何DSA在加速收敛方面如此有效。",
            "id": "4225366",
            "problem": "考虑一维空间中的稳态单能线性玻尔兹曼输运方程，对于具有周期性边界条件的均匀平板，通过用总宏观截面 $\\Sigma_{t}$ 对空间坐标 $x$ 进行缩放，使得 $x \\leftarrow \\Sigma_{t} x$，将其写为无量纲形式。令角通量为 $\\psi(x,\\mu)$，标量通量为 $\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu) \\,\\mathrm{d}\\mu$，散射比为 $c = \\Sigma_{s}/\\Sigma_{t}$，其中 $0  c  1$。在无量纲形式下，输运方程为\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\psi(x,\\mu) = \\frac{c}{2}\\,\\phi(x) + \\frac{q(x)}{2},\n$$\n其中 $q(x)$ 是给定的固定源。\n\n使用离散纵标法 $S_{n}$（$n=2$，两个方向）对角度变量进行离散化，具体使用 Gauss–Legendre 横坐标 $\\mu_{1} = \\frac{1}{\\sqrt{3}}$ 和 $\\mu_{2} = -\\frac{1}{\\sqrt{3}}$，权重为 $w_{1} = w_{2} = 1$。考虑源迭代 (SI)，在第 $k+1$ 次迭代中，散射源由标量通量 $\\phi^{(k)}(x)$ 构成，并执行输运扫描以获得 $\\psi^{(k+1)}(x,\\mu)$，进而得到 $\\phi^{(k+1)}(x)$。引入相对于精确标量通量 $\\phi^{*}(x)$ 的误差 $e^{(k)}(x) = \\phi^{(k)}(x) - \\phi^{*}(x)$，并假设 $q(x) \\equiv 0$，以便应用齐次误差传播分析。\n\n将标量通量误差上的 SI 误差传播算子 $\\mathcal{K}$ 定义为 $e^{(k+1)} = \\mathcal{K}\\,e^{(k)}$。使用各向同性散射的无量纲扩散极限渐近，通过离散化综合扩散方程\n$$\n-\\,\\frac{\\mathrm{d}}{\\mathrm{d}x}\\!\\left(D\\,\\frac{\\mathrm{d}\\,\\delta\\phi(x)}{\\mathrm{d}x}\\right) + (1-c)\\,\\delta\\phi(x) = r(x),\n$$\n在相同的均匀周期性网格上构造一个有限差分 (FD) 扩散综合加速 (DSA) 预条件子，其中 $D = \\frac{1}{3}$ 是无量纲扩散系数，$r(x)$ 是残差。将得到的离散扩散算子记为 $\\mathcal{M}$，它作用于标量通量修正量，使得 $\\mathcal{M}\\,\\delta\\phi = r$。\n\n现在考虑对线性系统 $(\\mathcal{I}-\\mathcal{K})\\,\\phi = b$ 使用广义最小残差法 (GMRES) 进行 Krylov 加速，并采用 $\\mathcal{M}^{-1}$ 进行左预处理，其中 $\\mathcal{I}$ 是单位算子，$b$ 是固定源贡献项。关注误差的空间常数傅里叶模式（零波数），即 $e^{(k)}(x) = \\mathrm{const}$。仅从上述定义和方程出发，确定作用于此空间常数模式的预处理算子 $\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})$ 的特征值。\n\n将最终答案表示为一个无单位的实数。无需四舍五入。",
            "solution": "我们从一维无量纲单能输运方程开始，\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\psi(x,\\mu) = \\frac{c}{2}\\,\\phi(x) + \\frac{q(x)}{2},\n$$\n其中散射比 $c \\in (0,1)$。我们使用 $S_{2}$ 离散纵标法对角度积分进行离散化，其横坐标为 $\\mu_{1} = \\frac{1}{\\sqrt{3}}$ 和 $\\mu_{2} = -\\frac{1}{\\sqrt{3}}$，权重为 $w_{1} = w_{2} = 1$。标量通量近似为\n$$\n\\phi(x) = \\sum_{m=1}^{2} w_{m}\\,\\psi(x,\\mu_{m}) = \\psi(x,\\mu_{1}) + \\psi(x,\\mu_{2}).\n$$\n\n在源迭代 (SI) 中，我们根据当前迭代值 $\\phi^{(k)}(x)$ 构造散射源，并求解\n$$\n\\mu_{m}\\,\\frac{\\partial \\psi^{(k+1)}(x,\\mu_{m})}{\\partial x} + \\psi^{(k+1)}(x,\\mu_{m}) = \\frac{c}{2}\\,\\phi^{(k)}(x) + \\frac{q(x)}{2}, \\quad m \\in \\{1,2\\},\n$$\n以获得 $\\psi^{(k+1)}(x,\\mu_{m})$，进而得到 $\\phi^{(k+1)}(x)$。为了进行误差传播分析，我们设置 $q(x) \\equiv 0$，并考察误差 $e^{(k)}(x) = \\phi^{(k)}(x) - \\phi^{*}(x)$ 的演化，其中 $\\phi^{*}(x)$ 是精确的标量通量。SI 误差传播可以表示为\n$$\ne^{(k+1)}(x) = \\mathcal{K}\\,e^{(k)}(x),\n$$\n其中 $\\mathcal{K}$ 是由输运扫描和散射过程导出的某个算子。\n\n我们关注空间常数傅里叶模式（零波数），即形如 $e^{(k)}(x) \\equiv E^{(k)}$ 的误差，其中 $E^{(k)}$ 与 $x$ 无关。对于此模式，所有空间导数都为零，误差的输运方程简化为代数关系。具体来说，当 $q(x)\\equiv 0$ 且 $\\frac{\\partial}{\\partial x}=0$ 时，第 $k+1$ 次迭代的角通量误差的输运方程为\n$$\n\\psi^{(k+1)}(x,\\mu_{m}) = \\frac{c}{2}\\,\\phi^{(k)}(x), \\quad m \\in \\{1,2\\}.\n$$\n由于方程右侧与 $x$ 无关，因此左侧也与 $x$ 无关，并且对于 $\\mu_{1}$ 和 $\\mu_{2}$，其值相等。对所有纵标求和以构成标量通量，得到\n$$\n\\phi^{(k+1)}(x) = \\psi^{(k+1)}(x,\\mu_{1}) + \\psi^{(k+1)}(x,\\mu_{2}) = \\frac{c}{2}\\,\\phi^{(k)}(x) + \\frac{c}{2}\\,\\phi^{(k)}(x) = c\\,\\phi^{(k)}(x).\n$$\n因此，对于空间常数模式，SI 误差传播算子 $\\mathcal{K}$ 的作用是乘以 $c$：\n$$\ne^{(k+1)}(x) = c\\,e^{(k)}(x).\n$$\n作用于此模式的相应算子 $(\\mathcal{I} - \\mathcal{K})$ 的特征值为\n$$\n\\lambda_{\\mathcal{I}-\\mathcal{K}}^{(0)} = 1 - c.\n$$\n\n我们现在使用适用于一维各向同性散射的无量纲扩散极限方程来构造扩散综合加速 (DSA) 预条件子。在扩散极限下，标量通量修正量 $\\delta\\phi(x)$ 的综合方程为\n$$\n-\\,\\frac{\\mathrm{d}}{\\mathrm{d}x}\\!\\left(D\\,\\frac{\\mathrm{d}\\,\\delta\\phi(x)}{\\mathrm{d}x}\\right) + (1-c)\\,\\delta\\phi(x) = r(x),\n$$\n其中 $D = \\frac{1}{3}$ 是无量纲扩散系数。通过有限差分 (FD) 在相同的均匀周期性网格上离散化该方程，得到一个线性算子 $\\mathcal{M}$，使得\n$$\n\\mathcal{M}\\,\\delta\\phi = r.\n$$\n在空间常数傅里叶模式上，$\\delta\\phi(x) = \\Delta$ 是常数，因此 $\\frac{\\mathrm{d}\\,\\delta\\phi}{\\mathrm{d}x} = 0$，扩散项消失。因此，作用于常数模式的算子 $\\mathcal{M}$ 简化为乘以 $(1 - c)$：\n$$\n\\mathcal{M}\\,\\Delta = (1 - c)\\,\\Delta,\n$$\n所以，常数模式下 $\\mathcal{M}$ 的特征值为\n$$\n\\lambda_{\\mathcal{M}}^{(0)} = 1 - c.\n$$\n\n题目要求我们考虑对线性系统\n$$\n(\\mathcal{I}-\\mathcal{K})\\,\\phi = b,\n$$\n使用广义最小残差法 (GMRES) 进行 Krylov 加速，并采用 $\\mathcal{M}^{-1}$ 进行左预处理，并确定作用于空间常数模式的预处理算子 $\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})$ 的特征值。在一个模式上，可交换算子之积的特征值是它们在该模式上特征值的比值。对于常数模式，\n$$\n\\lambda_{\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})}^{(0)} = \\frac{\\lambda_{\\mathcal{I}-\\mathcal{K}}^{(0)}}{\\lambda_{\\mathcal{M}}^{(0)}} = \\frac{1 - c}{1 - c} = 1.\n$$\n\n因此，作用于空间常数傅里叶模式的左预处理算子 $\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})$ 的特征值精确地为 $1$。",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}