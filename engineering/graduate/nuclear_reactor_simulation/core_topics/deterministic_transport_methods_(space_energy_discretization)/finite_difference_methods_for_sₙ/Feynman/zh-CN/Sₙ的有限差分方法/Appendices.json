{
    "hands_on_practices": [
        {
            "introduction": "本练习是掌握 $S_n$ 方法的基石。我们将从连续形式的输运方程出发，为一个二维笛卡尔网格推导出离散平衡方程。通过应用金刚石差分关系，你将亲手实践如何将一个偏微分方程转化为一个代数方程组，这是所有有限差分输运程序的核心 。",
            "id": "4225370",
            "problem": "考虑一个二维笛卡尔单元中的稳态单能输运问题，该单元具有各向同性的内部固定源，由线性玻尔兹曼输运方程建模。其基本依据是针对方向余弦对的角通量平衡方程，在平面几何中可写为 $ \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\boldsymbol{r}, \\boldsymbol{\\Omega}) + \\Sigma_{t} \\psi(\\boldsymbol{r}, \\boldsymbol{\\Omega}) = Q(\\boldsymbol{r}, \\boldsymbol{\\Omega}) $，其中 $ \\psi $ 是角通量，$ \\boldsymbol{\\Omega} $ 是单位方向向量，其分量为 $ \\mu $ 和 $ \\eta $，$ \\Sigma_{t} $ 是总宏观截面，$ Q $ 是源项。\n\n在二维笛卡尔几何中，使用离散纵标($S_{n}$)方法进行角度离散化，取 $ n = 4 $ 个方向，具体采用水平对称集，其方向余弦为 $ (\\mu_{m}, \\eta_{m}) \\in \\{ (\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}), (\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}), (-\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}), (-\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}) \\} $，求积权重为 $ w_{m} = \\frac{\\pi}{2} $，使得 $ \\sum_{m=1}^{4} w_{m} = 2 \\pi $。假设单元的所有四个面均为真空（黑体）边界条件。\n\n使用有限体积单元平衡法，对一个边长为 $ h = 2 $（无量纲长度单位）的单个方形单元上的输运方程进行离散化，该单元具有单元中心总截面 $ \\Sigma_{t} = 1 $（无量纲），以及每个离散方向上与角度无关的各向同性固定源 $ Q^{m} = q = 0.5 $（无量纲）。使用每个面上的菱形差分关系来封闭离散化。根据 $ \\mu_{m} $ 和 $ \\eta_{m} $ 的符号所隐含的迎风顺序进行方向扫描（例如，对于 $ \\mu_{m} > 0 $ 和 $ \\eta_{m} > 0 $，从西南面扫描到东北面；对其他符号组合进行相应调整）。由于只有一个单元，扫描顺序仍必须遵循每个方向的入射面的识别。\n\n从连续角通量平衡方程出发，推导给定方向上单元中心角通量的离散菱形差分单元方程，并用它来计算单元中心的离散标量通量 $ \\phi $，其计算公式为 $ \\phi \\approx \\sum_{m=1}^{4} w_{m} \\psi^{m} $，其中 $ \\psi^{m} $ 是方向 $ m $ 的单元中心角通量。将你计算出的 $ \\phi $ 的最终数值结果四舍五入到四位有效数字。以无量纲单位表示你的最终答案。",
            "solution": "用户希望使用离散纵标($S_n$)方法和菱形差分空间闭合关系，求解单个二维笛卡尔单元中的单元中心标量通量。\n\n出发点是稳态、单能、线性的玻尔兹曼输运方程，在二维笛卡尔坐标 $(x, y)$ 下，对于离散方向 $m$：\n$$ \\mu_m \\frac{\\partial \\psi_m(x, y)}{\\partial x} + \\eta_m \\frac{\\partial \\psi_m(x, y)}{\\partial y} + \\Sigma_t \\psi_m(x, y) = Q_m(x, y) $$\n这里，$\\psi_m$ 是方向 $m$ 的角通量，$(\\mu_m, \\eta_m)$ 是方向余弦，$\\Sigma_t$ 是总宏观截面，$Q_m$ 是方向 $m$ 的源项。\n\n为离散化此方程，我们将其在一个方形单元的面积上进行积分，该单元在 $x$ 方向上从 $x_{i-1/2}$ 延伸到 $x_{i+1/2}$，在 $y$ 方向上从 $y_{j-1/2}$ 延伸到 $y_{j+1/2}$。该单元的边长为 $h$。单元面积为 $A = h^2$。\n$$ \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( \\mu_m \\frac{\\partial \\psi_m}{\\partial x} + \\eta_m \\frac{\\partial \\psi_m}{\\partial y} \\right) dx dy + \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\Sigma_t \\psi_m dx dy = \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} Q_m dx dy $$\n对导数项进行积分得到：\n$$ \\mu_m \\int_{y_{j-1/2}}^{y_{j+1/2}} \\left[ \\psi_m(x_{i+1/2}, y) - \\psi_m(x_{i-1/2}, y) \\right] dy + \\eta_m \\int_{x_{i-1/2}}^{x_{i+1/2}} \\left[ \\psi_m(x, y_{j+1/2}) - \\psi_m(x, y_{j-1/2}) \\right] dx + \\text{(损失项)} = \\text{(源项)} $$\n我们引入以下有限差分近似：\n- 单元平均角通量：$\\psi_m^{i,j} \\approx \\frac{1}{h^2} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\psi_m(x, y) dx dy$\n- 面平均角通量：\n  $\\psi_{m, i+1/2} \\approx \\frac{1}{h} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\psi_m(x_{i+1/2}, y) dy$\n  $\\psi_{m, i-1/2} \\approx \\frac{1}{h} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\psi_m(x_{i-1/2}, y) dy$\n  （对于 $y$ 方向的面 $\\psi_{m, j+1/2}$ 和 $\\psi_{m, j-1/2}$ 也类似）。\n- 单元平均源：$Q_m^{i,j} \\approx \\frac{1}{h^2} \\int_{y_{j-1/2}}^{y_{j+1/2}} \\int_{x_{i-1/2}}^{x_{i+1/2}} Q_m(x, y) dx dy$\n\n利用这些近似，并假设 $\\Sigma_t$ 和 $Q_m$ 在单元内为常数，积分后的方程就成为离散单元平衡方程。为简化起见，由于只有一个单元，我们省略单元索引 $(i,j)$。\n$$ \\mu_m h (\\psi_{m, i+1/2} - \\psi_{m, i-1/2}) + \\eta_m h (\\psi_{m, j+1/2} - \\psi_{m, j-1/2}) + \\Sigma_t h^2 \\psi^m = Q^m h^2 $$\n两边同除以单元面积 $h^2$，得到：\n$$ \\frac{\\mu_m}{h} (\\psi_{m, i+1/2} - \\psi_{m, i-1/2}) + \\frac{\\eta_m}{h} (\\psi_{m, j+1/2} - \\psi_{m, j-1/2}) + \\Sigma_t \\psi^m = Q^m $$\n该方程必须考虑粒子流动的方向（迎风格式）。表示通量差异的项可以用入射和出射面通量重写。对于方向 $m$，令 $\\psi_{m, \\text{in}, x}$ 和 $\\psi_{m, \\text{out}, x}$ 分别为垂直于 $x$ 轴的面上的入射和出射通量（$y$ 方向同理）。平衡方程为：\n$$ \\frac{|\\mu_m|}{h} (\\psi_{m, \\text{out}, x} - \\psi_{m, \\text{in}, x}) + \\frac{|\\eta_m|}{h} (\\psi_{m, \\text{out}, y} - \\psi_{m, \\text{in}, y}) + \\Sigma_t \\psi^m = Q^m $$\n菱形差分(DD)闭合关系将单元平均通量与面平均通量联系起来：\n$$ \\psi^m = \\frac{\\psi_{m, \\text{out}, x} + \\psi_{m, \\text{in}, x}}{2} \\implies \\psi_{m, \\text{out}, x} = 2 \\psi^m - \\psi_{m, \\text{in}, x} $$\n$$ \\psi^m = \\frac{\\psi_{m, \\text{out}, y} + \\psi_{m, \\text{in}, y}}{2} \\implies \\psi_{m, \\text{out}, y} = 2 \\psi^m - \\psi_{m, \\text{in}, y} $$\n将这些出射通量的表达式代入平衡方程中：\n$$ \\frac{|\\mu_m|}{h} ((2\\psi^m - \\psi_{m, \\text{in}, x}) - \\psi_{m, \\text{in}, x}) + \\frac{|\\eta_m|}{h} ((2\\psi^m - \\psi_{m, \\text{in}, y}) - \\psi_{m, \\text{in}, y}) + \\Sigma_t \\psi^m = Q^m $$\n简化此方程：\n$$ \\frac{2|\\mu_m|}{h} (\\psi^m - \\psi_{m, \\text{in}, x}) + \\frac{2|\\eta_m|}{h} (\\psi^m - \\psi_{m, \\text{in}, y}) + \\Sigma_t \\psi^m = Q^m $$\n现在我们可以求解未知的单元平均通量 $\\psi^m$：\n$$ \\psi^m \\left( \\frac{2|\\mu_m|}{h} + \\frac{2|\\eta_m|}{h} + \\Sigma_t \\right) = Q^m + \\frac{2|\\mu_m|}{h} \\psi_{m, \\text{in}, x} + \\frac{2|\\eta_m|}{h} \\psi_{m, \\text{in}, y} $$\n$$ \\psi^m = \\frac{Q^m + \\frac{2|\\mu_m|}{h} \\psi_{m, \\text{in}, x} + \\frac{2|\\eta_m|}{h} \\psi_{m, \\text{in}, y}}{\\Sigma_t + \\frac{2|\\mu_m|}{h} + \\frac{2|\\eta_m|}{h}} $$\n问题指定单个单元的所有四个面均为真空边界条件。这意味着对于任何方向 $m$，任何边界面上的入射角通量都为零。因此，对于所有 $m$，$\\psi_{m, \\text{in}, x} = 0$ 且 $\\psi_{m, \\text{in}, y} = 0$。$\\psi^m$ 的方程简化为：\n$$ \\psi^m = \\frac{Q^m}{\\Sigma_t + \\frac{2|\\mu_m|}{h} + \\frac{2|\\eta_m|}{h}} $$\n现在，我们代入提供的数值：\n- 单元边长: $h = 2$\n- 总截面: $\\Sigma_t = 1$\n- 每个方向的源强: $Q^m = q = 0.5$\n- 方向余弦: 对于给定的 $S_4$ 水平对称集，对所有 $m = 1, 2, 3, 4$，都有 $|\\mu_m| = |\\eta_m| = \\frac{1}{\\sqrt{2}}$。\n\n将这些值代入 $\\psi^m$ 的表达式中：\n$$ \\psi^m = \\frac{0.5}{1 + \\frac{2(1/\\sqrt{2})}{2} + \\frac{2(1/\\sqrt{2})}{2}} = \\frac{0.5}{1 + \\frac{1}{\\sqrt{2}} + \\frac{1}{\\sqrt{2}}} = \\frac{0.5}{1 + \\frac{2}{\\sqrt{2}}} = \\frac{0.5}{1 + \\sqrt{2}} $$\n由于源强和方向余弦的绝对值对于所有 $m=1, 2, 3, 4$ 都相同，所以单元平均角通量 $\\psi^m$ 对于所有四个方向都相同。\n\n最后一步是计算单元中心标量通量 $\\phi$，它通过对离散纵标求和来近似：\n$$ \\phi \\approx \\sum_{m=1}^{4} w_m \\psi^m $$\n求积权重给定为 $w_m = \\frac{\\pi}{2}$（对所有 $m$）。由于 $\\psi^m$ 对所有 $m$ 都是常数，我们可以将其从求和中提出来：\n$$ \\phi = \\psi^m \\sum_{m=1}^{4} w_m = \\left( \\frac{0.5}{1 + \\sqrt{2}} \\right) \\left( 4 \\times \\frac{\\pi}{2} \\right) = \\left( \\frac{0.5}{1 + \\sqrt{2}} \\right) (2\\pi) $$\n将 $0.5$ 写为 $\\frac{1}{2}$：\n$$ \\phi = \\left( \\frac{1/2}{1 + \\sqrt{2}} \\right) (2\\pi) = \\frac{1}{2(1 + \\sqrt{2})} (2\\pi) = \\frac{\\pi}{1 + \\sqrt{2}} $$\n为了简化此表达式，我们将分母有理化：\n$$ \\phi = \\frac{\\pi}{1 + \\sqrt{2}} \\times \\frac{\\sqrt{2} - 1}{\\sqrt{2} - 1} = \\frac{\\pi(\\sqrt{2} - 1)}{(\\sqrt{2})^2 - 1^2} = \\frac{\\pi(\\sqrt{2} - 1)}{2 - 1} = \\pi(\\sqrt{2} - 1) $$\n现在，我们计算数值并四舍五入到四位有效数字：\n$$ \\phi = \\pi(\\sqrt{2} - 1) \\approx (3.14159...)(1.41421... - 1) \\approx (3.14159...)(0.41421...) \\approx 1.3013698... $$\n四舍五入到四位有效数字得到 $1.301$。",
            "answer": "$$\n\\boxed{1.301}\n$$"
        },
        {
            "introduction": "在将微分方程离散化后，下一步就是通过计算机编程求解得到的线性系统。这个练习提供了一个绝佳的实践机会，你需要通过编写程序来构建并求解一个由有限差分法产生的矩阵方程 。尽管该问题背景是计算格林函数，但其涉及的组装稀疏矩阵和求解线性系统的技能，可以直接应用于开发隐式 $S_n$ 求解器。",
            "id": "3228117",
            "problem": "考虑在区间 $[0,1]$ 上，与微分算子 $-\\frac{d^2}{dx^2}$ 相关联的格林函数 $G(x,s)$ 的一维齐次狄利克雷边界值问题（BVP）：\n$$\n-\\,\\frac{\\partial^2}{\\partial x^2} G(x,s) \\;=\\; \\delta(x-s), \\quad G(0,s)=0,\\; G(1,s)=0,\n$$\n其中 $\\delta$ 表示狄拉克 delta 函数。您的任务是使用有限差分法（FDM）计算其完全离散的模拟。\n\n从第一性原理出发，在 $[0,1]$ 上构建一个包含 $N$ 个子区间的均匀网格：\n$$\nx_i \\;=\\; i\\,h,\\quad h \\;=\\; \\frac{1}{N},\\quad i=0,1,\\dots,N,\n$$\n并强制施加离散齐次狄利克雷边界条件 $G_0=G_N=0$，其中 $G_i$ 是 $G(x_i,s)$ 的近似值。在内部节点 $i=1,\\dots,N-1$ 上，使用标准的中心二阶差分来离散化 $-\\,\\frac{d^2}{dx^2}$，使得离散算子 $L_h$ 应用于向量 $G=(G_1,\\dots,G_{N-1})^\\top$ 时，其分量形式由下式给出\n$$\n(L_h G)_i \\;=\\; -\\,\\frac{G_{i-1}-2G_i+G_{i+1}}{h^2},\\quad i=1,\\dots,N-1,\n$$\n约定 $G_0=G_N=0$。\n\n定义离散 delta 函数 $\\delta_h$，使其在黎曼和意义下保持单位质量：\n$$\n\\sum_{i=1}^{N-1} h\\,(\\delta_h)_i \\;=\\; 1.\n$$\n对于源位置 $s$ 正好与某个网格点 $x_k$（其中 $k\\in\\{1,\\dots,N-1\\}$）重合的特殊情况，取\n$$\n(\\delta_h)_i = \\begin{cases} \\frac{1}{h},  i=k \\\\ 0,  i \\neq k \\end{cases}\n$$\n然后通过求解线性系统来获得离散格林函数的值 $(G_1,\\dots,G_{N-1})$\n$$\nL_h G \\;=\\; \\delta_h.\n$$\n\n实现一个程序，针对以下测试套件，组装并求解由 $L_h$ 和上述 $\\delta_h$ 导出的三对角线性系统，并报告离散格林函数向量的选定条目。下面所有 $G_i$ 的索引均指内部索引 $i\\in\\{1,\\dots,N-1\\}$。\n\n测试套件：\n- 情况 A：$N=8$，$k=3$，报告 $G_2$、$G_3$、$G_5$。\n- 情况 B：$N=8$，$k=1$，报告 $G_1$、$G_2$、$G_7$。\n- 情况 C：$N=16$，$k=8$，报告 $G_4$、$G_8$、$G_{12}$。\n\n要求：\n- 使用指定的中心二阶差分格式和齐次狄利克雷边界条件构建 $L_h$。\n- 精确地按照指定方式构建 $\\delta_h$，以使单位质量属性成立，即 $\\sum_{i=1}^{N-1} h\\,(\\delta_h)_i=1$。\n- 对每种情况，使用数值稳定的线性代数方法精确求解所得的线性系统。\n- 此问题不涉及物理单位。\n- 您的程序应生成单行输出，其中包含按顺序排列的结果，格式为用方括号括起来、无空格的逗号分隔列表：\n$$\n[\\,G_2^{(\\text{A})},G_3^{(\\text{A})},G_5^{(\\text{A})},G_1^{(\\text{B})},G_2^{(\\text{B})},G_7^{(\\text{B})},G_4^{(\\text{C})},G_8^{(\\text{C})},G_{12}^{(\\text{C})}\\,].\n$$\n每个条目必须打印为十进制数（浮点数）。答案类型为浮点数，汇总到一个列表中。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它具有科学依据，是适定的、客观的。它提出了一个数值分析中的标准、自包含问题，即使用有限差分法求解边界值问题。所有必要的数据和定义都已提供，没有矛盾，并且可以计算出唯一、有意义的解。\n\n任务是求解在区间 $[0,1]$ 上带有齐次狄利克雷边界条件的算子 $L = -\\frac{d^2}{dx^2}$ 的格林函数 $G(x,s)$ 的数值近似。控制方程为\n$$\n-\\frac{\\partial^2}{\\partial x^2} G(x,s) = \\delta(x-s), \\quad G(0,s)=0, G(1,s)=0.\n$$\n我们在均匀网格 $x_i = ih$（$i=0, 1, \\dots, N$）上采用有限差分法，步长为 $h = 1/N$。离散解向量表示为 $G = (G_1, G_2, \\dots, G_{N-1})^\\top$，它近似于内部网格点上的格林函数，$G_i \\approx G(x_i, s)$。边界条件强制为 $G_0 = 0$ 和 $G_N = 0$。\n\n微分算子通过中心二阶差分格式进行近似。离散算子 $L_h$ 作用于向量 $G$，其第 $i$ 个分量为\n$$\n(L_h G)_i = -\\frac{G_{i-1} - 2G_i + G_{i+1}}{h^2}, \\quad \\text{for } i=1, \\dots, N-1.\n$$\n源项，即狄拉克 delta 函数 $\\delta(x-s)$，在源位置 $s$ 与某个网格点 $x_k=kh$（其中 $k \\in \\{1, \\dots, N-1\\}$）重合的情况下，被离散化为一个向量 $\\delta_h$。离散 delta 函数按分量定义为\n$$\n(\\delta_h)_i = \\begin{cases} \\frac{1}{h}  i=k \\\\ 0  i \\neq k \\end{cases}.\n$$\n该定义正确地保持了单位质量属性，$\\sum_{i=1}^{N-1} h (\\delta_h)_i = h \\cdot (\\frac{1}{h}) = 1$。\n\n因此，问题简化为求解 $(N-1) \\times (N-1)$ 的线性方程组：\n$$\nL_h G = \\delta_h.\n$$\n以矩阵形式表示，即为 $A G = b$，其中矩阵 $A$ 代表算子 $L_h$，向量 $b$ 代表离散源 $\\delta_h$。矩阵 $A$ 的元素由 $L_h$ 的差分格式导出：\n$$\nA = \\frac{1}{h^2}\n\\begin{pmatrix}\n2  -1  0  \\cdots  0 \\\\\n-1  2  -1  \\ddots  \\vdots \\\\\n0  \\ddots  \\ddots  \\ddots  0 \\\\\n\\vdots  \\ddots  -1  2  -1 \\\\\n0  \\cdots  0  -1  2\n\\end{pmatrix}.\n$$\n向量 $b$ 只有一个非零项，位于索引 $k-1$ 处（对内部点向量使用从 0 开始的索引）：\n$$\nb = \\left(0, \\dots, 0, \\frac{1}{h}, 0, \\dots, 0\\right)^\\top,\n$$\n其中非零元素位于第 $k$ 个位置。\n\n为了提高数值稳定性和计算便利性，我们可以将整个系统乘以 $h^2$：\n$$\n(h^2 A) G = h^2 b.\n$$\n令 $A' = h^2 A$ 和 $b' = h^2 b$。修改后的矩阵 $A'$ 和向量 $b'$ 为：\n$$\nA' = \n\\begin{pmatrix}\n2  -1  0  \\cdots  0 \\\\\n-1  2  -1  \\ddots  \\vdots \\\\\n0  \\ddots  \\ddots  \\ddots  0 \\\\\n\\vdots  \\ddots  -1  2  -1 \\\\\n0  \\cdots  0  -1  2\n\\end{pmatrix},\n\\quad\nb' = \n\\left(0, \\dots, 0, h, 0, \\dots, 0\\right)^\\top.\n$$\n求解此系统 $A'G = b'$ 以得到未知向量 $G$。矩阵 $A'$ 是对称、正定且三对角的，这保证了可以高效地找到一个唯一且稳定的解。\n\n通过以下步骤解决指定的测试用例：\n1.  对每种情况（A、B、C），使用参数 $N$ 和 $k$ 定义问题规模 $N-1$ 和步长 $h=1/N$。\n2.  组装 $(N-1) \\times (N-1)$ 的三对角矩阵 $A'$。\n3.  构建大小为 $N-1$ 的右侧向量 $b'$，其在索引 $k-1$ 处的值为 $h$，其他位置为零。\n4.  求解线性系统 $A'G=b'$ 以获得离散格林函数值 $G = (G_1, \\dots, G_{N-1})^\\top$。\n5.  从解向量 $G$ 中提取指定的元素 $G_i$。请注意，问题对网格点 $i \\in \\{1, \\dots, N-1\\}$ 使用从 1 开始的索引，这对应于解向量中从 0 开始的索引 $i-1$。\n\n- **情况 A**：$N=8$，$k=3$。我们求解一个 $7 \\times 7$ 的系统。我们报告元素 $G_2, G_3, G_5$，对应于解向量的索引 $1, 2, 4$。\n- **情况 B**：$N=8$，$k=1$。我们求解一个 $7 \\times 7$ 的系统。我们报告元素 $G_1, G_2, G_7$，对应于解向量的索引 $0, 1, 6$。\n- **情况 C**：$N=16$，$k=8$。我们求解一个 $15 \\times 15$ 的系统。我们报告元素 $G_4, G_8, G_{12}$，对应于解向量的索引 $3, 7, 11$。\n\n最终程序实现了这一精确逻辑来计算所需的值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_discrete_greens_function(N, k):\n    \"\"\"\n    Assembles and solves the finite difference system for the discrete Green's function.\n\n    Args:\n        N (int): The number of subintervals on [0,1].\n        k (int): The 1-based index of the grid point where the source is located.\n\n    Returns:\n        numpy.ndarray: The solution vector G = (G_1, ..., G_{N-1}).\n    \"\"\"\n    # The number of interior grid points, which is the dimension of the linear system.\n    dim = N - 1\n    \n    # Grid spacing\n    h = 1.0 / N\n\n    # Construct the matrix A' = h^2 * L_h = tridiag(-1, 2, -1).\n    # This matrix is of size (N-1) x (N-1).\n    # Main diagonal with 2s.\n    main_diag = 2 * np.ones(dim)\n    # Off-diagonals with -1s.\n    off_diag = -1 * np.ones(dim - 1)\n    \n    A_prime = np.diag(main_diag, 0) + np.diag(off_diag, -1) + np.diag(off_diag, 1)\n\n    # Construct the right-hand side vector b' = h^2 * delta_h.\n    # It's a vector of zeros except for the entry at index (k-1), which is h.\n    # The index is (k-1) because k is 1-based and array indices are 0-based.\n    b_prime = np.zeros(dim)\n    b_prime[k - 1] = h\n\n    # Solve the linear system A' * G = b' for the vector G.\n    G = np.linalg.solve(A_prime, b_prime)\n    \n    return G\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, k, list_of_indices_to_report).\n    # Indices are 1-based as per the problem.\n    test_cases = [\n        (8, 3, [2, 3, 5]),   # Case A\n        (8, 1, [1, 2, 7]),   # Case B\n        (16, 8, [4, 8, 12]), # Case C\n    ]\n\n    results = []\n    for case in test_cases:\n        N, k, indices_to_report = case\n        \n        # Calculate the full solution vector for the discrete Green's function.\n        G_solution = solve_discrete_greens_function(N, k)\n        \n        # Extract the required values.\n        # Convert 1-based problem indices to 0-based array indices.\n        for idx in indices_to_report:\n            results.append(G_solution[idx - 1])\n\n    # Final print statement in the exact required format.\n    # The format is a comma-separated list of float values enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "对于实际的大规模输运问题，直接求解矩阵方程往往是不可行的，必须依赖高效的迭代方法。本练习深入探讨了一种高级加速技术——扩散综合加速（DSA），它被用来显著提升标准源迭代（SI）的收敛速度 。通过对特定傅里叶模式的理论分析，你将揭示为何 DSA 能够有效克服源迭代在光学厚且散射主导问题中的收敛瓶颈。",
            "id": "4225366",
            "problem": "考虑稳态、单速、一维空间中的线性玻尔兹曼输运方程，该方程通过用总宏观截面 $\\Sigma_{t}$ 对空间坐标 $x$ 进行缩放（即 $x \\leftarrow \\Sigma_{t} x$）而写成无量纲形式，适用于具有周期性边界条件的均匀平板。设角通量为 $\\psi(x,\\mu)$，标量通量为 $\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu) \\,\\mathrm{d}\\mu$，散射比为 $c = \\Sigma_{s}/\\Sigma_{t}$，其中 $0  c  1$。在无量纲形式下，输运方程为\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\psi(x,\\mu) = \\frac{c}{2}\\,\\phi(x) + \\frac{q(x)}{2},\n$$\n其中 $q(x)$ 是一个给定的固定源。\n\n使用离散纵标法 $S_{n}$ 对角度变量进行离散化，取 $n=2$（两个方向），具体使用高斯-勒让德节点 $\\mu_{1} = \\frac{1}{\\sqrt{3}}$ 和 $\\mu_{2} = -\\frac{1}{\\sqrt{3}}$，权重为 $w_{1} = w_{2} = 1$。考虑源迭代 (SI)，在第 $k+1$ 次迭代中，根据标量通量 $\\phi^{(k)}(x)$ 形成散射源，并执行输运扫描以获得 $\\psi^{(k+1)}(x,\\mu)$，进而得到 $\\phi^{(k+1)}(x)$。引入相对于精确标量通量 $\\phi^{*}(x)$ 的误差 $e^{(k)}(x) = \\phi^{(k)}(x) - \\phi^{*}(x)$，并假设 $q(x) \\equiv 0$ 以便应用齐次误差传播分析。\n\n将作用于标量通量误差的 SI 误差传播算子 $\\mathcal{K}$ 定义为 $e^{(k+1)} = \\mathcal{K}\\,e^{(k)}$。使用各向同性散射的无量纲扩散极限渐近，通过离散化综合扩散方程\n$$\n-\\,\\frac{\\mathrm{d}}{\\mathrm{d}x}\\!\\left(D\\,\\frac{\\mathrm{d}\\,\\delta\\phi(x)}{\\mathrm{d}x}\\right) + (1-c)\\,\\delta\\phi(x) = r(x),\n$$\n在相同的均匀周期性网格上构造一个有限差分 (FD) 扩散综合加速 (DSA) 预条件子，其中 $D = \\frac{1}{3}$ 是无量纲扩散系数，$r(x)$ 是残差。将得到的离散扩散算子记为 $\\mathcal{M}$，它作用于标量通量修正量，使得 $\\mathcal{M}\\,\\delta\\phi = r$。\n\n现在考虑对线性系统 $(\\mathcal{I}-\\mathcal{K})\\,\\phi = b$ 采用通过广义极小残差法 (GMRES) 实现的克雷洛夫加速，并使用 $\\mathcal{M}^{-1}$ 进行左预处理，其中 $\\mathcal{I}$ 是单位算子，$b$ 是固定源贡献。关注误差的空间常数傅里叶模式（零波数），即 $e^{(k)}(x) = \\mathrm{const}$。仅从上述定义和方程出发，确定作用于此空间常数模式的预处理算子 $\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})$ 的特征值。\n\n将最终答案表示为一个没有单位的实数。无需四舍五入。",
            "solution": "我们从一维无量纲单速输运方程开始，\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\psi(x,\\mu) = \\frac{c}{2}\\,\\phi(x) + \\frac{q(x)}{2},\n$$\n其中散射比 $c \\in (0,1)$。我们使用 $S_{2}$ 离散纵标法对角度积分进行离散化，节点为 $\\mu_{1} = \\frac{1}{\\sqrt{3}}$ 和 $\\mu_{2} = -\\frac{1}{\\sqrt{3}}$，权重为 $w_{1} = w_{2} = 1$。标量通量近似为\n$$\n\\phi(x) = \\sum_{m=1}^{2} w_{m}\\,\\psi(x,\\mu_{m}) = \\psi(x,\\mu_{1}) + \\psi(x,\\mu_{2})。\n$$\n\n在源迭代 (SI) 中，根据当前迭代的 $\\phi^{(k)}(x)$ 形成散射源，并求解\n$$\n\\mu_{m}\\,\\frac{\\partial \\psi^{(k+1)}(x,\\mu_{m})}{\\partial x} + \\psi^{(k+1)}(x,\\mu_{m}) = \\frac{c}{2}\\,\\phi^{(k)}(x) + \\frac{q(x)}{2}, \\quad m \\in \\{1,2\\},\n$$\n以获得 $\\psi^{(k+1)}(x,\\mu_{m})$，进而得到 $\\phi^{(k+1)}(x)$。为了进行误差传播分析，我们设 $q(x) \\equiv 0$ 并研究误差 $e^{(k)}(x) = \\phi^{(k)}(x) - \\phi^{*}(x)$ 的演化，其中 $\\phi^{*}(x)$ 是精确标量通量。SI 误差传播可以表示为\n$$\ne^{(k+1)}(x) = \\mathcal{K}\\,e^{(k)}(x),\n$$\n其中 $\\mathcal{K}$ 是由输运扫描和散射过程导出的某个算子。\n\n我们关注空间常数傅里叶模式（零波数），即形式为 $e^{(k)}(x) \\equiv E^{(k)}$ 的误差，其中 $E^{(k)}$ 与 $x$ 无关。对于此模式，所有空间导数都为零，误差的输运方程简化为代数关系。具体来说，对于 $q(x)\\equiv 0$ 和 $\\frac{\\partial}{\\partial x}=0$，第 $k+1$ 次迭代中角通量误差的输运方程为\n$$\n\\psi^{(k+1)}(x,\\mu_{m}) = \\frac{c}{2}\\,\\phi^{(k)}(x), \\quad m \\in \\{1,2\\}。\n$$\n由于右侧与 $x$ 无关，左侧也与 $x$ 无关，并且它们对于 $\\mu_{1}$ 和 $\\mu_{2}$ 的值是相等的。对所有纵标求和以形成标量通量，得到\n$$\n\\phi^{(k+1)}(x) = \\psi^{(k+1)}(x,\\mu_{1}) + \\psi^{(k+1)}(x,\\mu_{2}) = \\frac{c}{2}\\,\\phi^{(k)}(x) + \\frac{c}{2}\\,\\phi^{(k)}(x) = c\\,\\phi^{(k)}(x)。\n$$\n因此，对于空间常数模式，SI 误差传播算子 $\\mathcal{K}$ 的作用是乘以 $c$：\n$$\ne^{(k+1)}(x) = c\\,e^{(k)}(x)。\n$$\n作用于此模式的相应算子 $(\\mathcal{I} - \\mathcal{K})$ 的特征值为\n$$\n\\lambda_{\\mathcal{I}-\\mathcal{K}}^{(0)} = 1 - c.\n$$\n\n现在我们使用适用于一维各向同性散射的无量纲扩散极限方程来构造扩散综合加速 (DSA) 预条件子。在扩散极限下，标量通量修正量 $\\delta\\phi(x)$ 的综合方程为\n$$\n-\\,\\frac{\\mathrm{d}}{\\mathrm{d}x}\\!\\left(D\\,\\frac{\\mathrm{d}\\,\\delta\\phi(x)}{\\mathrm{d}x}\\right) + (1-c)\\,\\delta\\phi(x) = r(x),\n$$\n其中 $D = \\frac{1}{3}$ 是无量纲扩散系数。通过有限差分 (FD) 在相同的均匀周期性网格上离散化此方程，得到一个线性算子 $\\mathcal{M}$，使得\n$$\n\\mathcal{M}\\,\\delta\\phi = r.\n$$\n对于空间常数傅里叶模式，$\\delta\\phi(x) = \\Delta$ 是常数，因此 $\\frac{\\mathrm{d}\\,\\delta\\phi}{\\mathrm{d}x} = 0$，扩散项消失。因此，作用于常数模式的算子 $\\mathcal{M}$ 简化为乘以 $(1 - c)$：\n$$\n\\mathcal{M}\\,\\Delta = (1 - c)\\,\\Delta,\n$$\n所以 $\\mathcal{M}$ 对于常数模式的特征值为\n$$\n\\lambda_{\\mathcal{M}}^{(0)} = 1 - c.\n$$\n\n题目要求我们考虑对线性系统\n$$\n(\\mathcal{I}-\\mathcal{K})\\,\\phi = b,\n$$\n使用广义极小残差法 (GMRES) 进行克雷洛夫加速，并采用 $\\mathcal{M}^{-1}$ 进行左预处理，并确定作用于空间常数模式的预处理算子 $\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})$ 的特征值。对于一个模式上的可交换算子乘积，其特征值是它们在该模式上各自特征值的比值。对于常数模式，\n$$\n\\lambda_{\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})}^{(0)} = \\frac{\\lambda_{\\mathcal{I}-\\mathcal{K}}^{(0)}}{\\lambda_{\\mathcal{M}}^{(0)}} = \\frac{1 - c}{1 - c} = 1.\n$$\n\n因此，作用于空间常数傅里叶模式的左预处理算子 $\\mathcal{M}^{-1}(\\mathcal{I}-\\mathcal{K})$ 的特征值恰好为 $1$。",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}