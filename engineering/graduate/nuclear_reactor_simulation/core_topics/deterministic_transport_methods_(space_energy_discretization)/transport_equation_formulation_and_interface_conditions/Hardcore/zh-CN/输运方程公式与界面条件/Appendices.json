{
    "hands_on_practices": [
        {
            "introduction": "中子输运方程的求解是反应堆模拟的核心。特征线法 (Method of Characteristics, MOC) 是一种直观且强大的数值方法，它通过沿中子飞行的直线路径（即特征线）积分输运方程来求解。这项实践将指导您从第一性原理出发，构建一个沿单条特征线追踪中子角通量的算法，帮助您理解中子在穿越不同材料区域时的衰减和源贡献累积过程 。",
            "id": "4258245",
            "problem": "考虑核反应堆模拟中一维多区域燃料棒栅元内的一条直线特征飞行路径。沿着单条射线，稳态角中子通量 $ \\psi(s) $ 满足以下一阶常微分方程\n$$\n\\frac{d\\psi(s)}{ds} + \\Sigma_t(s)\\,\\psi(s) = q(s),\n$$\n其中 $ s $ 是沿射线的路径长度坐标，$ \\Sigma_t(s) $ 是总宏观截面，$ q(s) $ 是单位立体角内的方向内源。假设采用分段常数材料模型：在每个以 $ k $ 为索引的区域内，$ \\Sigma_t(s) = \\Sigma_{t,k} $ 和 $ q(s) = q_k $ 在长度为 $ L_k $ 的区域段上是常数。区域间的界面条件强制要求角通量 $ \\psi(s) $ 跨界面是连续的。不存在奇异界面源，且射线方向在界面处不发生改变。\n\n从控制方程和这些界面条件出发，组合各分段区域的贡献，以获得在穿越一系列区域后边界处的出射角通量。穿越单个区域段的传播必须仅基于第一性原理，并且在科学上是合理的。然后，设计并实现一个算法，在给定第一个区域段起点的入射角通量的情况下，计算最后一个区域段末端的出射角通量。\n\n必须明确遵守物理单位。设 $ \\Sigma_{t,k} $ 的单位为 $ \\text{cm}^{-1} $，区域段长度 $ L_k $ 的单位为 $ \\text{cm} $，源 $ q_k $ 的单位为 $ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，角通量 $ \\psi $ 的单位为 $ \\text{neutrons}\\ \\text{cm}^{-2}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $。所有关于出射角通量的最终答案都必须以 $ \\text{neutrons}\\ \\text{cm}^{-2}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $ 为单位，表示为浮点数。不需要角度；所有距离 $ L_k $ 均直接沿射线以 $ \\text{cm} $ 为单位给出。\n\n您的程序必须实现以下具有科学依据的区域段映射：对于一个长度为 $ L $、具有恒定 $ \\Sigma_t $ 和 $ q $ 的单个区域段，从区域段入口处的入射角通量 $ \\psi_{\\text{in}} $ 到区域段出口处的出射角通量 $ \\psi_{\\text{out}} $ 的映射为\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_t L} + \\frac{q}{\\Sigma_t}\\left(1 - e^{-\\Sigma_t L}\\right),\n$$\n在 $ \\Sigma_t \\to 0 $ 且 $ q $ 为有限值的特殊极限情况下，该映射简化为\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}} + q\\,L,\n$$\n必须使用此简化形式以避免除以零，并与 $ \\Sigma_t = 0 $ 时 $ \\frac{d\\psi}{ds} = q $ 的情况保持一致。\n\n沿射线的的多区域燃料棒栅元由一个有序的区域段列表 $ \\{(\\Sigma_{t,k}, q_k, L_k)\\}_{k=1}^N $ 定义。算法必须从 $ k = 1 $ 到 $ k = N $ 顺序应用单区域段映射，通过将区域段 $ k $ 的入射通量设置为区域段 $ k-1 $ 的出射通量，来确保 $ \\psi $ 在每个界面处的连续性。\n\n实现该算法并在以下测试套件上进行评估，每个案例由一个入射角通量 $ \\psi_{\\text{in}} $ 和一个有序的区域段列表 $ (\\Sigma_{t,k}, q_k, L_k) $ 定义：\n\n案例 $ 1 $（理想情况，包含燃料、薄间隙和包壳的三区域燃料棒栅元，燃料区有内源）：\n- 入射通量 $ \\psi_{\\text{in}} = 0.1\\ \\text{neutrons}\\ \\text{cm}^{-2}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $。\n- 区域段：\n  - 燃料区：$ \\Sigma_{t,1} = 0.7\\ \\text{cm}^{-1} $，$ q_1 = 0.05\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_1 = 0.2\\ \\text{cm} $。\n  - 间隙区：$ \\Sigma_{t,2} = 0.001\\ \\text{cm}^{-1} $，$ q_2 = 0.0\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_2 = 0.05\\ \\text{cm} $。\n  - 包壳区：$ \\Sigma_{t,3} = 0.2\\ \\text{cm}^{-1} $，$ q_3 = 0.0\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_3 = 0.08\\ \\text{cm} $。\n\n案例 $ 2 $（纯衰减，单区域，无源）：\n- 入射通量 $ \\psi_{\\text{in}} = 1.0\\ \\text{neutrons}\\ \\text{cm}^{-2}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $。\n- 区域段：\n  - 区域 $ 1 $：$ \\Sigma_{t,1} = 1.3\\ \\text{cm}^{-1} $，$ q_1 = 0.0\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_1 = 0.5\\ \\text{cm} $。\n\n案例 $ 3 $（边界情况，零截面有源区域段后接衰减区域）：\n- 入射通量 $ \\psi_{\\text{in}} = 0.0\\ \\text{neutrons}\\ \\text{cm}^{-2}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $。\n- 区域段：\n  - 类真空区：$ \\Sigma_{t,1} = 0.0\\ \\text{cm}^{-1} $，$ q_1 = 0.02\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_1 = 1.0\\ \\text{cm} $。\n  - 衰减区：$ \\Sigma_{t,2} = 0.4\\ \\text{cm}^{-1} $，$ q_2 = 0.0\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_2 = 0.25\\ \\text{cm} $。\n\n案例 $ 4 $（边界条件，零厚度区域段后接衰减区域）：\n- 入射通量 $ \\psi_{\\text{in}} = 0.5\\ \\text{neutrons}\\ \\text{cm}^{-2}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $。\n- 区域段：\n  - 退化区域段：$ \\Sigma_{t,1} = 0.8\\ \\text{cm}^{-1} $，$ q_1 = 0.1\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_1 = 0.0\\ \\text{cm} $。\n  - 衰减区：$ \\Sigma_{t,2} = 0.3\\ \\text{cm}^{-1} $，$ q_2 = 0.0\\ \\text{neutrons}\\ \\text{cm}^{-3}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $，$ L_2 = 0.1\\ \\text{cm} $。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果（例如，$ [\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4] $），其中每个 $ \\text{result}_i $ 是相应案例在边界处的出射角通量，以 $ \\text{neutrons}\\ \\text{cm}^{-2}\\ \\text{s}^{-1}\\ \\text{sr}^{-1} $ 为单位，表示为浮点数。",
            "solution": "该问题要求计算给定入射通量下，中子穿越一系列一维材料区域后的出射角中子通量。这是特征线法中的一个基本问题，该方法是求解核反应堆分析中中子输运方程的常用技术。\n\n首先，需要对问题陈述进行验证。给定的条件是：\n- 稳态角通量 $\\psi(s)$ 沿特征飞行路径（路径长度坐标为 $s$）的控制方程：\n$$ \\frac{d\\psi(s)}{ds} + \\Sigma_t(s)\\,\\psi(s) = q(s) $$\n- 材料属性 $\\Sigma_t(s)$（总宏观截面）和 $q(s)$（方向内源）是分段常数。对于长度为 $L_k$ 的区域 $k$，$\\Sigma_t(s) = \\Sigma_{t,k}$ 且 $q(s) = q_k$。\n- 界面条件要求 $\\psi(s)$ 连续。\n- 单个长度为 $L$ 的区域段，从入射通量 $\\psi_{\\text{in}}$ 到出射通量 $\\psi_{\\text{out}}$ 的映射由以下公式给出：\n$$ \\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_t L} + \\frac{q}{\\Sigma_t}\\left(1 - e^{-\\Sigma_t L}\\right) \\quad (\\text{对于 } \\Sigma_t \\neq 0) $$\n$$ \\psi_{\\text{out}} = \\psi_{\\text{in}} + q\\,L \\quad (\\text{对于 } \\Sigma_t = 0) $$\n- 问题为所有物理量指定了单位，这些单位在内部是一致的。\n- 提供了四个具体的测试案例，定义了初始入射通量和材料区域段的序列。\n\n该问题具有科学依据，因为它基于标准的一维空间线性玻尔兹曼输运方程。所提供的均匀区域段的解析解是正确的，可以从第一性原理推导得出。该问题是适定的，提供了明确的初始条件和定义清晰的操作序列，保证了唯一解的存在。语言客观、精确。所有必需的数据均已提供，且无矛盾之处。其结构形式规范，可直接转换为算法。因此，该问题被认为是有效的，可以构建解决方案。\n\n核心原理是对单个均匀空间区域段上的输运方程进行解析积分。在一个从局部坐标 $s=0$ 延伸到 $s=L_k$ 的区域段 $k$ 内，该方程变为一个具有常系数的一阶线性常微分方程：\n$$ \\frac{d\\psi(s)}{ds} + \\Sigma_{t,k}\\,\\psi(s) = q_k $$\n这个方程可以使用积分因子 $I(s) = \\exp(\\int \\Sigma_{t,k} \\, ds) = \\exp(\\Sigma_{t,k} s)$ 来求解。将微分方程两边同乘以 $I(s)$ 得：\n$$ \\exp(\\Sigma_{t,k} s) \\frac{d\\psi(s)}{ds} + \\Sigma_{t,k} \\exp(\\Sigma_{t,k} s) \\psi(s) = q_k \\exp(\\Sigma_{t,k} s) $$\n根据链式法则，左侧是乘积的导数：\n$$ \\frac{d}{ds} \\left( \\psi(s) \\exp(\\Sigma_{t,k} s) \\right) = q_k \\exp(\\Sigma_{t,k} s) $$\n对该表达式在区域段长度上从 $s=0$到$s=L_k$进行积分：\n$$ \\int_{0}^{L_k} \\frac{d}{ds} \\left( \\psi(s) \\exp(\\Sigma_{t,k} s) \\right) ds = \\int_{0}^{L_k} q_k \\exp(\\Sigma_{t,k} s) ds $$\n$$ \\left[ \\psi(s) \\exp(\\Sigma_{t,k} s) \\right]_{0}^{L_k} = \\left[ \\frac{q_k}{\\Sigma_{t,k}} \\exp(\\Sigma_{t,k} s) \\right]_{0}^{L_k} $$\n此步骤假设 $\\Sigma_{t,k} \\neq 0$。在积分上下限处求值得到：\n$$ \\psi(L_k) \\exp(\\Sigma_{t,k} L_k) - \\psi(0) \\exp(0) = \\frac{q_k}{\\Sigma_{t,k}} (\\exp(\\Sigma_{t,k} L_k) - \\exp(0)) $$\n$$ \\psi(L_k) \\exp(\\Sigma_{t,k} L_k) - \\psi(0) = \\frac{q_k}{\\Sigma_{t,k}} (\\exp(\\Sigma_{t,k} L_k) - 1) $$\n令 $s=0$ 处的入射通量为 $\\psi_{\\text{in},k} = \\psi(0)$，$s=L_k$ 处的出射通量为 $\\psi_{\\text{out},k} = \\psi(L_k)$，我们求解 $\\psi_{\\text{out},k}$：\n$$ \\psi_{\\text{out},k} = \\psi_{\\text{in},k} \\exp(-\\Sigma_{t,k} L_k) + \\frac{q_k}{\\Sigma_{t,k}}(1 - \\exp(-\\Sigma_{t,k} L_k)) $$\n该推导验证了问题陈述中为 $\\Sigma_{t,k} \\neq 0$ 情况提供的公式。第一项 $\\psi_{\\text{in},k} \\exp(-\\Sigma_{t,k} L_k)$ 代表入射通量穿过材料时的衰减。第二项代表来自内部源 $q_k$ 的贡献，该贡献也受到衰减。量 $\\tau_k = \\Sigma_{t,k} L_k$ 是区域段的光学厚度。\n\n对于 $\\Sigma_{t,k} = 0$ 的特殊情况，控制方程简化为：\n$$ \\frac{d\\psi(s)}{ds} = q_k $$\n从 $s=0$ 到 $s=L_k$ 积分此方程：\n$$ \\int_{0}^{L_k} \\frac{d\\psi(s)}{ds} ds = \\int_{0}^{L_k} q_k ds $$\n$$ \\psi(L_k) - \\psi(0) = q_k L_k $$\n$$ \\psi_{\\text{out},k} = \\psi_{\\text{in},k} + q_k L_k $$\n这证实了提供的第二个公式。这种情况对应于粒子在真空中（或非相互作用介质中）流过，通量由于源的存在而线性增加。\n\n多区域问题的算法是该单区域段解的顺序应用。界面处通量连续的原理意味着，区域段 $k-1$ 的出射通量成为区域段 $k$ 的入射通量。设 $\\psi_{k}$ 为区域段 $k$ 的出射通量。该过程是迭代的：\n1. 以第一个区域段开始处的入射通量进行初始化：$\\psi_{\\text{in},1} = \\psi_{\\text{incident}}$。\n2. 对每个区域段 $k = 1, 2, \\dots, N$：\n   - 当前区域段的入射通量是前一个区域段的出射通量：$\\psi_{\\text{in},k} = \\psi_{k-1}$（其中 $\\psi_0 = \\psi_{\\text{incident}}$）。\n   - 根据 $\\Sigma_{t,k}$ 是否为零，使用相应的公式计算出射通量 $\\psi_k$。\n3. 最终结果是最后一个区域段的出射通量 $\\psi_N$。\n\n这个顺序过程正确地模拟了粒子沿特征射线穿过整个非均匀介质的输运过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the neutron transport problem for the given test cases.\n    \"\"\"\n    \n    # Each case is: (incident_flux, [(sigma_t, q, L), ...])\n    test_cases = [\n        # Case 1 (happy path, three-region pin cell)\n        (0.1, [\n            (0.7, 0.05, 0.2),  # Fuel\n            (0.001, 0.0, 0.05), # Gap\n            (0.2, 0.0, 0.08)   # Cladding\n        ]),\n        \n        # Case 2 (pure attenuation, single region)\n        (1.0, [\n            (1.3, 0.0, 0.5)\n        ]),\n        \n        # Case 3 (edge case, zero cross section)\n        (0.0, [\n            (0.0, 0.02, 1.0),   # Vacuum-like with source\n            (0.4, 0.0, 0.25)   # Attenuating\n        ]),\n        \n        # Case 4 (boundary condition, zero-thickness segment)\n        (0.5, [\n            (0.8, 0.1, 0.0),   # Degenerate segment\n            (0.3, 0.0, 0.1)    # Attenuating\n        ])\n    ]\n\n    results = []\n    for initial_flux, segments in test_cases:\n        current_flux = initial_flux\n        \n        for sigma_t, q, L in segments:\n            # sigma_t is given in cm^-1\n            # q is given in neutrons cm^-3 s^-1 sr^-1\n            # L is given in cm\n            # current_flux is in neutrons cm^-2 s^-1 sr^-1\n            \n            # Use a small tolerance for floating point comparison to zero\n            if abs(sigma_t)  1e-12:\n                # Special case for sigma_t = 0\n                # psi_out = psi_in + q * L\n                current_flux = current_flux + q * L\n            else:\n                # Standard case for sigma_t > 0\n                # The optical thickness (tau) is dimensionless\n                tau = sigma_t * L\n                \n                # Attenuation factor is dimensionless\n                attenuation = np.exp(-tau)\n                \n                # psi_out = psi_in * exp(-sigma_t*L) + (q/sigma_t) * (1 - exp(-sigma_t*L))\n                source_contribution = (q / sigma_t) * (1.0 - attenuation)\n                current_flux = current_flux * attenuation + source_contribution\n        \n        results.append(current_flux)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在真实的反应堆材料中，中子散射并非总是各向同性的，尤其是在高能区，前向散射现象尤为显著。这种各向异性散射深刻影响着材料交界面处的中子行为。本练习旨在通过解析推导，将微观的散射截面矩（$ \\Sigma_{s,0} $ 和 $ \\Sigma_{s,1} $）与宏观的界面分流（$ J^{+} $ 和 $ J^{-} $）直接联系起来，从而揭示散射各向异性如何塑造穿越界面的中子角通量分布 。",
            "id": "4258252",
            "problem": "考虑在占据 $x  0$ 的均匀半空间中的稳态单能中子输运，该半空间与 $x > 0$ 的真空区域相邻。界面为平面 $x=0$。$x  0$ 中的材料具有总截面 $\\Sigma_{t}$ 和各向异性散射，其特征由微分散射截面的前两个勒让德矩 $\\Sigma_{s,0}$ 和 $\\Sigma_{s,1}$ 描述。假设为线性各向异性散射（在球谐函数 (P$_1$) 展开中截断至一阶），因此平板几何中的散射核可以表示为\n$$\n\\Sigma_{s}(\\mu,\\mu') \\;=\\; \\frac{1}{2}\\,\\Sigma_{s,0} \\;+\\; \\frac{3}{2}\\,\\Sigma_{s,1}\\,\\mu\\,\\mu' \\,,\n$$\n其中 $\\mu=\\cos\\theta$ 是相对于 $x$ 轴的方向余弦，$\\mu'$ 是入射方向余弦。\n\n在 $x  0$ 一侧界面内的一个薄层中，在发生碰撞之前，角通量是已知的，由下式给出\n$$\n\\psi^{\\mathrm{inc}}(\\mu') \\;=\\; \\psi_{0}\\,\\big(1 + \\alpha\\,\\mu'\\big) \\quad \\text{for} \\quad -1 \\le \\mu' \\le 1 \\,,\n$$\n其中 $|\\alpha|  1$ 和 $\\psi_{0}0$ 为常数。假设该薄层内的散射产生一个具有角分布的中子源\n$$\nS(\\mu) \\;=\\; \\int_{-1}^{1} \\Sigma_{s}(\\mu,\\mu')\\,\\psi^{\\mathrm{inc}}(\\mu')\\,d\\mu' \\,,\n$$\n并且这些散射后的中子随后自由流过界面进入真空，在 $x=0$ 处的衰减或反射可忽略不计。在此假设下，由该散射源引起的穿过界面的分流与 $S(\\mu)$ 的半程一阶矩成正比：\n$$\nJ^{+} \\;=\\; \\int_{0}^{1} \\mu\\,S(\\mu)\\,d\\mu \\,, \\qquad\nJ^{-} \\;=\\; \\int_{-1}^{0} (-\\mu)\\,S(\\mu)\\,d\\mu \\,.\n$$\n将界面处分流的各向异性定义为\n$$\nA \\;=\\; \\frac{J^{+}-J^{-}}{J^{+}+J^{-}} \\,.\n$$\n\n从线性玻尔兹曼输运方程和散射源项的定义出发，根据上述假设和几何形状，用 $\\alpha$、$\\Sigma_{s,0}$ 和 $\\Sigma_{s,1}$ 推导出 $A$ 的闭式解。将最终答案表示为单个解析表达式。无需四舍五入。",
            "solution": "该问题被认为是有效的，因为它在科学上基于线性输运理论，是适定的，有足够的信息得到唯一解，并以客观、正式的语言表述。因此，我们可以进行推导。\n\n目标是推导分流各向异性 $A$ 的表达式，其定义为 $A = \\frac{J^{+}-J^{-}}{J^{+}+J^{-}}$。推导过程分三个主要步骤：首先，确定散射源项 $S(\\mu)$；其次，计算分流 $J^{+}$ 和 $J^{-}$；第三，将这些代入 $A$ 的表达式中以获得最终结果。\n\n步骤 1：计算散射源 $S(\\mu)$。\n\n散射源由对所有入射方向 $\\mu'$ 的积分定义：\n$$\nS(\\mu) = \\int_{-1}^{1} \\Sigma_{s}(\\mu,\\mu')\\,\\psi^{\\mathrm{inc}}(\\mu')\\,d\\mu'\n$$\n问题给出了线性各向异性散射核和入射角通量：\n$$\n\\Sigma_{s}(\\mu,\\mu') = \\frac{1}{2}\\Sigma_{s,0} + \\frac{3}{2}\\Sigma_{s,1}\\mu\\mu'\n$$\n$$\n\\psi^{\\mathrm{inc}}(\\mu') = \\psi_{0}(1 + \\alpha\\mu')\n$$\n其中 $\\Sigma_{s,0}$ 和 $\\Sigma_{s,1}$ 分别是散射截面的零阶和一阶勒让德矩，而 $\\psi_{0} > 0$ 和 $|\\alpha|  1$ 是常数。\n\n将这些代入 $S(\\mu)$ 的积分中：\n$$\nS(\\mu) = \\int_{-1}^{1} \\left( \\frac{1}{2}\\Sigma_{s,0} + \\frac{3}{2}\\Sigma_{s,1}\\mu\\mu' \\right) \\left( \\psi_{0}(1 + \\alpha\\mu') \\right) \\,d\\mu'\n$$\n我们可以提出常数 $\\psi_0$ 并展开被积函数中的项：\n$$\nS(\\mu) = \\frac{\\psi_{0}}{2} \\int_{-1}^{1} (\\Sigma_{s,0} + 3\\Sigma_{s,1}\\mu\\mu')(1 + \\alpha\\mu') \\,d\\mu'\n$$\n$$\nS(\\mu) = \\frac{\\psi_{0}}{2} \\int_{-1}^{1} (\\Sigma_{s,0} + \\alpha\\Sigma_{s,0}\\mu' + 3\\Sigma_{s,1}\\mu\\mu' + 3\\alpha\\Sigma_{s,1}\\mu(\\mu')^2) \\,d\\mu'\n$$\n我们逐项计算积分，使用以下由勒让德多项式在区间 $[-1, 1]$ 上的正交性得出的定积分：\n$$\n\\int_{-1}^{1} 1 \\,d\\mu' = 2\n$$\n$$\n\\int_{-1}^{1} \\mu' \\,d\\mu' = 0\n$$\n$$\n\\int_{-1}^{1} (\\mu')^2 \\,d\\mu' = \\frac{2}{3}\n$$\n将这些应用于 $S(\\mu)$ 的表达式：\n$$\nS(\\mu) = \\frac{\\psi_{0}}{2} \\left( \\Sigma_{s,0}\\int_{-1}^{1} 1\\,d\\mu' + \\alpha\\Sigma_{s,0}\\int_{-1}^{1}\\mu'\\,d\\mu' + 3\\Sigma_{s,1}\\mu\\int_{-1}^{1}\\mu'\\,d\\mu' + 3\\alpha\\Sigma_{s,1}\\mu\\int_{-1}^{1}(\\mu')^2\\,d\\mu' \\right)\n$$\n$$\nS(\\mu) = \\frac{\\psi_{0}}{2} \\left( \\Sigma_{s,0}(2) + \\alpha\\Sigma_{s,0}(0) + 3\\Sigma_{s,1}\\mu(0) + 3\\alpha\\Sigma_{s,1}\\mu\\left(\\frac{2}{3}\\right) \\right)\n$$\n$$\nS(\\mu) = \\frac{\\psi_{0}}{2} \\left( 2\\Sigma_{s,0} + 2\\alpha\\Sigma_{s,1}\\mu \\right)\n$$\n这简化为散射源的最终表达式：\n$$\nS(\\mu) = \\psi_{0}(\\Sigma_{s,0} + \\alpha\\Sigma_{s,1}\\mu)\n$$\n正如对 P$_1$ 通量和 P$_1$ 核的预期，所得源也与 $\\mu$ 呈线性关系。\n\n步骤 2：计算分流 $J^{+}$ 和 $J^{-}$。\n\n分流定义如下：\n$$\nJ^{+} = \\int_{0}^{1} \\mu\\,S(\\mu)\\,d\\mu\n$$\n$$\nJ^{-} = \\int_{-1}^{0} (-\\mu)\\,S(\\mu)\\,d\\mu\n$$\n我们将推导出的 $S(\\mu)$ 表达式代入这些积分中。\n对于 $J^{+}$：\n$$\nJ^{+} = \\int_{0}^{1} \\mu \\left( \\psi_{0}(\\Sigma_{s,0} + \\alpha\\Sigma_{s,1}\\mu) \\right) \\,d\\mu\n$$\n$$\nJ^{+} = \\psi_{0} \\int_{0}^{1} (\\Sigma_{s,0}\\mu + \\alpha\\Sigma_{s,1}\\mu^2) \\,d\\mu\n$$\n$$\nJ^{+} = \\psi_{0} \\left[ \\Sigma_{s,0}\\frac{\\mu^2}{2} + \\alpha\\Sigma_{s,1}\\frac{\\mu^3}{3} \\right]_{0}^{1} = \\psi_{0} \\left( \\frac{\\Sigma_{s,0}}{2} + \\frac{\\alpha\\Sigma_{s,1}}{3} - 0 \\right)\n$$\n$$\nJ^{+} = \\psi_{0} \\left( \\frac{\\Sigma_{s,0}}{2} + \\frac{\\alpha\\Sigma_{s,1}}{3} \\right)\n$$\n对于 $J^{-}$：\n$$\nJ^{-} = \\int_{-1}^{0} (-\\mu) \\left( \\psi_{0}(\\Sigma_{s,0} + \\alpha\\Sigma_{s,1}\\mu) \\right) \\,d\\mu\n$$\n$$\nJ^{-} = -\\psi_{0} \\int_{-1}^{0} (\\Sigma_{s,0}\\mu + \\alpha\\Sigma_{s,1}\\mu^2) \\,d\\mu\n$$\n$$\nJ^{-} = -\\psi_{0} \\left[ \\Sigma_{s,0}\\frac{\\mu^2}{2} + \\alpha\\Sigma_{s,1}\\frac{\\mu^3}{3} \\right]_{-1}^{0} = -\\psi_{0} \\left( 0 - \\left( \\Sigma_{s,0}\\frac{(-1)^2}{2} + \\alpha\\Sigma_{s,1}\\frac{(-1)^3}{3} \\right) \\right)\n$$\n$$\nJ^{-} = -\\psi_{0} \\left( -\\left( \\frac{\\Sigma_{s,0}}{2} - \\frac{\\alpha\\Sigma_{s,1}}{3} \\right) \\right) = \\psi_{0} \\left( \\frac{\\Sigma_{s,0}}{2} - \\frac{\\alpha\\Sigma_{s,1}}{3} \\right)\n$$\n\n步骤 3：计算各向异性 $A$。\n\n各向异性定义为 $A = \\frac{J^{+}-J^{-}}{J^{+}+J^{-}}$。我们分别计算分子和分母。\n分子：\n$$\nJ^{+} - J^{-} = \\psi_{0} \\left( \\frac{\\Sigma_{s,0}}{2} + \\frac{\\alpha\\Sigma_{s,1}}{3} \\right) - \\psi_{0} \\left( \\frac{\\Sigma_{s,0}}{2} - \\frac{\\alpha\\Sigma_{s,1}}{3} \\right) = \\psi_{0} \\left( \\frac{2\\alpha\\Sigma_{s,1}}{3} \\right)\n$$\n分母：\n$$\nJ^{+} + J^{-} = \\psi_{0} \\left( \\frac{\\Sigma_{s,0}}{2} + \\frac{\\alpha\\Sigma_{s,1}}{3} \\right) + \\psi_{0} \\left( \\frac{\\Sigma_{s,0}}{2} - \\frac{\\alpha\\Sigma_{s,1}}{3} \\right) = \\psi_{0} \\left( \\frac{2\\Sigma_{s,0}}{2} \\right) = \\psi_{0}\\Sigma_{s,0}\n$$\n最后，我们计算比值 $A$：\n$$\nA = \\frac{\\psi_{0} \\left( \\frac{2\\alpha\\Sigma_{s,1}}{3} \\right)}{\\psi_{0}\\Sigma_{s,0}}\n$$\n假定 $\\psi_{0} \\ne 0$ 和 $\\Sigma_{s,0} \\ne 0$，这是物理上必需的条件，我们可以消去 $\\psi_{0}$ 以获得最终表达式：\n$$\nA = \\frac{2\\alpha\\Sigma_{s,1}}{3\\Sigma_{s,0}}\n$$\n该表达式根据初始通量各向异性 $\\alpha$ 和散射截面矩 $\\Sigma_{s,0}$ 和 $\\Sigma_{s,1}$，给出了由散射源引起的界面处分流的各向异性。",
            "answer": "$$\\boxed{\\frac{2\\alpha\\Sigma_{s,1}}{3\\Sigma_{s,0}}}$$"
        },
        {
            "introduction": "有限体积法 (Finite Volume Method, FVM) 是求解守恒律方程（如中子输运方程）的一种主流数值技术。该方法的核心在于确保每个离散的控制体积（单元）内的粒子数守恒。本练习将聚焦于有限体积法的一个关键环节：界面通量的计算，特别是“迎风格式”的应用，它对于保证计算的物理真实性和数值稳定性至关重要。通过亲手实现并验证界面通量的守恒性，您将深入理解现代输运程序设计的基本准则 。",
            "id": "4258233",
            "problem": "考虑一个无源、各向同性、均匀区域中关于角通量 $\\psi(\\mathbf{x},\\mathbf{\\Omega})$ 的稳态、单能线性玻尔兹曼输运方程。流项为 $\\mathbf{\\Omega}\\cdot\\nabla \\psi$，其中 $\\mathbf{\\Omega}$ 是单位方向矢量。在一个由平面组成边界 $\\partial V$ 的控制体 $V$ 上的有限体积离散中，根据散度定理，流项的积分可化为各面通量之和：\n$$\n\\int_{V} \\mathbf{\\Omega}\\cdot\\nabla \\psi \\, dV \\;=\\; \\sum_{f\\in\\partial V} \\int_{S_f} \\mathbf{\\Omega}\\cdot\\mathbf{n}_f \\, \\psi \\, dS,\n$$\n其中 $S_f$ 是一个面，$\\mathbf{n}_f$ 是该面的外法向单位矢量，$dS$ 是面积微元。为保证界面一致性，内界面上的角通量沿特征线是连续的，对于离散纵标法，必须在面上使用 $\\psi$ 的迎风值。在每个单元 $i$ 内进行一阶线性重构时，面值可近似为\n$$\n\\psi(\\mathbf{x}_f,\\mathbf{\\Omega}) \\approx \\psi_i(\\mathbf{\\Omega}) + \\nabla\\psi_i(\\mathbf{\\Omega})\\cdot(\\mathbf{x}_f - \\mathbf{x}_i),\n$$\n其中 $\\mathbf{x}_i$ 是单元中心，$\\mathbf{x}_f$ 是面中心，$\\nabla\\psi_i(\\mathbf{\\Omega})$ 是用于重构的给定梯度。对于一个由左单元 $L$ 和右单元 $R$ 共享的内界面，若法向 $\\mathbf{n}_f$ 从 $L$ 指向 $R$，则对于方向 $\\mathbf{\\Omega}$，如果 $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f0$，迎风单元为 $L$；如果 $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f  0$，则迎风单元为 $R$。如果 $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f=0$，则贡献为零。面通量定义为\n$$\nF_f(\\mathbf{\\Omega}) \\equiv \\int_{S_f} \\mathbf{\\Omega}\\cdot\\mathbf{n}_f \\, \\psi(\\mathbf{x}_f,\\mathbf{\\Omega}) \\, dS \\approx \\left(\\mathbf{\\Omega}\\cdot\\mathbf{n}_f\\right) \\, A_f \\, \\psi_\\text{up}(\\mathbf{x}_f,\\mathbf{\\Omega}),\n$$\n其中 $A_f$ 是面的面积，$\\psi_\\text{up}$ 是重构的迎风面值。跨界面的守恒性要求该面对左右单元守恒方程的贡献大小相等，符号相反：\n$$\nF_f^{(L)}(\\mathbf{\\Omega}) = +F_f(\\mathbf{\\Omega}), \\quad F_f^{(R)}(\\mathbf{\\Omega}) = -F_f(\\mathbf{\\Omega}),\n$$\n使得对于每个方向 $\\mathbf{\\Omega}$ 都有 $F_f^{(L)}(\\mathbf{\\Omega}) + F_f^{(R)}(\\mathbf{\\Omega}) = 0$。\n\n你的任务是针对一个简单的双单元几何结构实现此面通量计算，并验证界面守恒性。该几何结构是二维空间中两个相邻的单位正方形单元，它们共享一个垂直内界面：\n- 单元索引：$i=0$ 是左单元，$i=1$ 是右单元。\n- 单元中心：$\\mathbf{x}_0=(0.5,0.5)$ 和 $\\mathbf{x}_1=(1.5,0.5)$。\n- 内界面中心：$\\mathbf{x}_f=(1.0,0.5)$。\n- 内界面法向：$\\mathbf{n}_f=(1,0)$，从左指向右。\n- 内界面面积：$A_f=1$。\n\n对于下方的每个测试用例，给定：\n- 离散方向列表 $\\{\\mathbf{\\Omega}_m\\}_{m=1}^M$（每个都是单位矢量）。\n- 对于 $i\\in\\{0,1\\}$ 和 $m\\in\\{1,\\dots,M\\}$ 的单元中心角通量值 $\\psi_i(\\mathbf{\\Omega}_m)$。\n- 对于 $i\\in\\{0,1\\}$ 和 $m\\in\\{1,\\dots,M\\}$ 的单元中心重构梯度 $\\nabla\\psi_i(\\mathbf{\\Omega}_m)$。\n\n实现上述迎风线性重构，计算每个方向的内界面通量 $F_f(\\mathbf{\\Omega}_m)$。使用大小相同、符号相反的 $F_f(\\mathbf{\\Omega}_m)$ 构成共享面对左右单元的贡献。对于每个测试，返回一个布尔值，表示跨内界面的守恒条件是否在 $10^{-12}$ 的数值容差内成立，即对于测试中的所有方向，是否有 $|F_f^{(L)}(\\mathbf{\\Omega}_m) + F_f^{(R)}(\\mathbf{\\Omega}_m)| \\le 10^{-12}$。在其中一个测试中，你还必须通过检查左右贡献在所有方向上的总和是否在容差范围内相互抵消来验证聚合守恒性。\n\n不需要物理单位；将所有量视为无量纲。\n\n测试套件：\n- 测试 1（右行流，分段常数重构）：\n  - 方向：$\\mathbf{\\Omega}_1=(1,0)$。\n  - $\\psi_0(\\mathbf{\\Omega}_1)=2.0$，$\\psi_1(\\mathbf{\\Omega}_1)=0.5$。\n  - $\\nabla\\psi_0(\\mathbf{\\Omega}_1)=(0.0,0.0)$，$\\nabla\\psi_1(\\mathbf{\\Omega}_1)=(0.0,0.0)$。\n- 测试 2（左行流，分段常数重构）：\n  - 方向：$\\mathbf{\\Omega}_1=(-1,0)$。\n  - $\\psi_0(\\mathbf{\\Omega}_1)=1.2$，$\\psi_1(\\mathbf{\\Omega}_1)=3.0$。\n  - $\\nabla\\psi_0(\\mathbf{\\Omega}_1)=(0.0,0.0)$，$\\nabla\\psi_1(\\mathbf{\\Omega}_1)=(0.0,0.0)$。\n- 测试 3（平行于界面的流，法向分量为零）：\n  - 方向：$\\mathbf{\\Omega}_1=(0,1)$。\n  - $\\psi_0(\\mathbf{\\Omega}_1)=5.0$，$\\psi_1(\\mathbf{\\Omega}_1)=7.0$。\n  - $\\nabla\\psi_0(\\mathbf{\\Omega}_1)=(0.0,0.0)$，$\\nabla\\psi_1(\\mathbf{\\Omega}_1)=(0.0,0.0)$。\n- 测试 4（对角流，迎风单元中的线性重构）：\n  - 方向：$\\mathbf{\\Omega}_1=\\left(\\frac{\\sqrt{2}}{2},\\frac{\\sqrt{2}}{2}\\right)$。\n  - $\\psi_0(\\mathbf{\\Omega}_1)=1.0$，$\\psi_1(\\mathbf{\\Omega}_1)=4.0$。\n  - $\\nabla\\psi_0(\\mathbf{\\Omega}_1)=(1.0,0.0)$，$\\nabla\\psi_1(\\mathbf{\\Omega}_1)=(0.0,0.0)$。\n- 测试 5（多个方向上的聚合守恒性）：\n  - 方向：$\\mathbf{\\Omega}_1=(1,0)$ 和 $\\mathbf{\\Omega}_2=\\left(\\frac{\\sqrt{2}}{2},\\frac{\\sqrt{2}}{2}\\right)$。\n  - $\\psi_0(\\mathbf{\\Omega}_1)=2.0$，$\\psi_1(\\mathbf{\\Omega}_1)=0.5$，$\\psi_0(\\mathbf{\\Omega}_2)=1.0$，$\\psi_1(\\mathbf{\\Omega}_2)=4.0$。\n  - $\\nabla\\psi_0(\\mathbf{\\Omega}_1)=(0.0,0.0)$，$\\nabla\\psi_1(\\mathbf{\\Omega}_1)=(0.0,0.0)$，$\\nabla\\psi_0(\\mathbf{\\Omega}_2)=(1.0,0.0)$，$\\nabla\\psi_1(\\mathbf{\\Omega}_2)=(0.0,0.0)$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3,result4,result5]”）。每个结果都必须是一个布尔值，表示该测试是否如指定那样守恒。",
            "solution": "该问题要求实现并验证稳态、单能线性玻尔兹曼输运方程一阶有限体积离散的面通量计算。核心任务是验证所实现的面通量数值格式在两个计算单元之间的界面上是守恒的。\n\n该问题描述了一种特定的数值方法，称为线性间断格式。面上的通量通过根据粒子方向 $\\mathbf{\\Omega}$ 相对于面法向 $\\mathbf{n}_f$ 来选择“迎风”单元，然后使用该迎风单元的数据在面中心进行线性重构来评估通量，从而确定。\n\n守恒性质由以下要求定义：共享面对左单元守恒方程的贡献 $F_f^{(L)}(\\mathbf{\\Omega})$ 必须与对右单元的贡献 $F_f^{(R)}(\\mathbf{\\Omega})$ 大小相等、符号相反。问题将这些贡献定义为 $F_f^{(L)}(\\mathbf{\\Omega}) = +F_f(\\mathbf{\\Omega})$ 和 $F_f^{(R)}(\\mathbf{\\Omega}) = -F_f(\\mathbf{\\Omega})$，其中 $F_f(\\mathbf{\\Omega})$ 是跨面的净通量。根据这种构造，和 $F_f^{(L)}(\\mathbf{\\Omega}) + F_f^{(R)}(\\mathbf{\\Omega})$ 解析上为零。因此，验证任务是正确实现 $F_f(\\mathbf{\\Omega})$ 的计算，并确认 $|F_f^{(L)}(\\mathbf{\\Omega}) + F_f^{(R)}(\\mathbf{\\Omega})| \\le 10^{-12}$。如果实现正确计算了 $F_f(\\mathbf{\\Omega})$ 并应用了 $F_f^{(L)}$ 和 $F_f^{(R)}$ 的定义，此条件将成立。\n\n几何和物理设置如下：\n- 左单元 ($i=0$): 中心 $\\mathbf{x}_0 = (0.5, 0.5)$。\n- 右单元 ($i=1$): 中心 $\\mathbf{x}_1 = (1.5, 0.5)$。\n- 内界面: 中心 $\\mathbf{x}_f = (1.0, 0.5)$，面积 $A_f=1$，从左到右的外法向为 $\\mathbf{n}_f = (1, 0)$。\n\n计算面通量 $F_f(\\mathbf{\\Omega})$ 并检查单个方向 $\\mathbf{\\Omega}$ 的守恒性的算法如下：\n1.  **确定迎风单元。** 我们计算点积 $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f$。\n    - 如果 $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f > 0$，粒子从左向右流动。迎风单元是左单元，索引为 $u=0$。\n    - 如果 $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f  0$，粒子从右向左流动。迎风单元是右单元，索引为 $u=1$。\n    - 如果 $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f = 0$，没有净通量穿过该面，所以 $F_f(\\mathbf{\\Omega})=0$。\n\n2.  **在面上评估重构的迎风通量。** 使用线性重构公式：\n    $$ \\psi_{\\text{up}}(\\mathbf{x}_f, \\mathbf{\\Omega}) = \\psi_u(\\mathbf{\\Omega}) + \\nabla\\psi_u(\\mathbf{\\Omega}) \\cdot (\\mathbf{x}_f - \\mathbf{x}_u) $$\n    其中 $\\psi_u(\\mathbf{\\Omega})$ 和 $\\nabla\\psi_u(\\mathbf{\\Omega})$ 是给定的迎风单元 $u$ 的单元中心角通量及其梯度。\n\n3.  **计算净面通量。** 通量由以下公式给出：\n    $$ F_f(\\mathbf{\\Omega}) = (\\mathbf{\\Omega}\\cdot\\mathbf{n}_f) A_f \\psi_{\\text{up}}(\\mathbf{x}_f, \\mathbf{\\Omega}) $$\n\n4.  **验证守恒性。** 我们检查 $|F_f(\\mathbf{\\Omega}) + (-F_f(\\mathbf{\\Omega}))| \\le 10^{-12}$ 是否成立。这简化为 $|0| \\le 10^{-12}$，这永远为真。因此，该测试验证了 $F_f(\\mathbf{\\Omega})$ 的正确计算是守恒性质的基石。\n\n我们现在将此过程应用于每个测试用例。\n\n**测试 1：右行流，分段常数重构**\n- 方向：$\\mathbf{\\Omega}_1 = (1, 0)$。\n- 数据：$\\psi_0(\\mathbf{\\Omega}_1)=2.0$，$\\nabla\\psi_0(\\mathbf{\\Omega}_1)=(0.0, 0.0)$。\n- 迎风检查：$\\mathbf{\\Omega}_1 \\cdot \\mathbf{n}_f = (1, 0) \\cdot (1, 0) = 1 > 0$。迎风单元是 $u=0$（左侧）。\n- 重构：梯度为零，因此这是分段常数或“阶梯”格式。$\\psi_{\\text{up}}(\\mathbf{x}_f, \\mathbf{\\Omega}_1) = \\psi_0(\\mathbf{\\Omega}_1) = 2.0$。\n- 面通量：$F_f(\\mathbf{\\Omega}_1) = (1)(1)(2.0) = 2.0$。\n- 守恒性：$F_f^{(L)} = 2.0$, $F_f^{(R)} = -2.0$。$|2.0 + (-2.0)| = 0 \\le 10^{-12}$。条件成立。\n\n**测试 2：左行流，分段常数重构**\n- 方向：$\\mathbf{\\Omega}_1 = (-1, 0)$。\n- 数据：$\\psi_1(\\mathbf{\\Omega}_1)=3.0$，$\\nabla\\psi_1(\\mathbf{\\Omega}_1)=(0.0, 0.0)$。\n- 迎风检查：$\\mathbf{\\Omega}_1 \\cdot \\mathbf{n}_f = (-1, 0) \\cdot (1, 0) = -1  0$。迎风单元是 $u=1$（右侧）。\n- 重构：$\\psi_{\\text{up}}(\\mathbf{x}_f, \\mathbf{\\Omega}_1) = \\psi_1(\\mathbf{\\Omega}_1) = 3.0$。\n- 面通量：$F_f(\\mathbf{\\Omega}_1) = (-1)(1)(3.0) = -3.0$。\n- 守恒性：$F_f^{(L)} = -3.0$, $F_f^{(R)} = -(-3.0) = 3.0$。$|-3.0 + 3.0| = 0 \\le 10^{-12}$。条件成立。\n\n**测试 3：平行于界面的流**\n- 方向：$\\mathbf{\\Omega}_1 = (0, 1)$。\n- 数据：通量计算不需要，但给定为 $\\psi_0(\\mathbf{\\Omega}_1)=5.0$，$\\psi_1(\\mathbf{\\Omega}_1)=7.0$。\n- 迎风检查：$\\mathbf{\\Omega}_1 \\cdot \\mathbf{n}_f = (0, 1) \\cdot (1, 0) = 0$。\n- 面通量：由于点积为零，$F_f(\\mathbf{\\Omega}_1) = 0$。\n- 守恒性：$F_f^{(L)} = 0$, $F_f^{(R)} = 0$。$|0 + 0| = 0 \\le 10^{-12}$。条件成立。\n\n**测试 4：对角流，线性重构**\n- 方向：$\\mathbf{\\Omega}_1 = (\\frac{\\sqrt{2}}{2}, \\frac{\\sqrt{2}}{2})$。\n- 数据：$\\psi_0(\\mathbf{\\Omega}_1)=1.0$，$\\nabla\\psi_0(\\mathbf{\\Omega}_1)=(1.0, 0.0)$。\n- 迎风检查：$\\mathbf{\\Omega}_1 \\cdot \\mathbf{n}_f = (\\frac{\\sqrt{2}}{2}, \\frac{\\sqrt{2}}{2}) \\cdot (1, 0) = \\frac{\\sqrt{2}}{2} > 0$。迎风单元是 $u=0$（左侧）。\n- 重构：\n  - 位移矢量：$\\mathbf{x}_f - \\mathbf{x}_0 = (1.0, 0.5) - (0.5, 0.5) = (0.5, 0.0)$。\n  - 重构值：$\\psi_{\\text{up}}(\\mathbf{x}_f, \\mathbf{\\Omega}_1) = \\psi_0(\\mathbf{\\Omega}_1) + \\nabla\\psi_0(\\mathbf{\\Omega}_1) \\cdot (\\mathbf{x}_f - \\mathbf{x}_0) = 1.0 + (1.0, 0.0) \\cdot (0.5, 0.0) = 1.0 + 0.5 = 1.5$。\n- 面通量：$F_f(\\mathbf{\\Omega}_1) = (\\frac{\\sqrt{2}}{2})(1)(1.5) = \\frac{1.5\\sqrt{2}}{2} = 0.75\\sqrt{2}$。\n- 守恒性：$F_f^{(L)} = 0.75\\sqrt{2}$, $F_f^{(R)} = -0.75\\sqrt{2}$。$|0.75\\sqrt{2} - 0.75\\sqrt{2}| = 0 \\le 10^{-12}$。条件成立。\n\n**测试 5：多个方向上的聚合守恒性**\n此测试要求分别检查每个方向的守恒性，然后检查所有方向通量总和的守恒性。\n\n- **方向 1：** $\\mathbf{\\Omega}_1 = (1, 0)$。这与测试 1 相同。\n  - $F_f(\\mathbf{\\Omega}_1) = 2.0$。\n  - $F_f^{(L)}(\\mathbf{\\Omega}_1) = 2.0$, $F_f^{(R)}(\\mathbf{\\Omega}_1) = -2.0$。\n  - 守恒性检查 1：$|2.0 - 2.0| = 0 \\le 10^{-12}$。成立。\n\n- **方向 2：** $\\mathbf{\\Omega}_2 = (\\frac{\\sqrt{2}}{2}, \\frac{\\sqrt{2}}{2})$。这与测试 4 相同。\n  - $F_f(\\mathbf{\\Omega}_2) = 0.75\\sqrt{2}$。\n  - $F_f^{(L)}(\\mathbf{\\Omega}_2) = 0.75\\sqrt{2}$, $F_f^{(R)}(\\mathbf{\\Omega}_2) = -0.75\\sqrt{2}$。\n  - 守恒性检查 2：$|0.75\\sqrt{2} - 0.75\\sqrt{2}| = 0 \\le 10^{-12}$。成立。\n\n- **聚合守恒性：** 我们检查对左右单元贡献的总和。\n  - 对左单元的总贡献：$\\sum_m F_f^{(L)}(\\mathbf{\\Omega}_m) = F_f^{(L)}(\\mathbf{\\Omega}_1) + F_f^{(L)}(\\mathbf{\\Omega}_2) = 2.0 + 0.75\\sqrt{2}$。\n  - 对右单元的总贡献：$\\sum_m F_f^{(R)}(\\mathbf{\\Omega}_m) = F_f^{(R)}(\\mathbf{\\Omega}_1) + F_f^{(R)}(\\mathbf{\\Omega}_2) = -2.0 - 0.75\\sqrt{2}$。\n  - 聚合检查：$|\\left( \\sum_m F_f^{(L)}(\\mathbf{\\Omega}_m) \\right) + \\left( \\sum_m F_f^{(R)}(\\mathbf{\\Omega}_m) \\right)| = |(2.0 + 0.75\\sqrt{2}) + (-2.0 - 0.75\\sqrt{2})| = 0 \\le 10^{-12}$。成立。\n\n由于所有单独和聚合的守恒性检查都通过了，测试 5 的结果为真。如上所示，由于通量贡献 $F_f^{(L)}$ 和 $F_f^{(R)}$ 的定义方式，所有测试用例的守恒条件都得到了满足。实现只需正确计算底层的面通量 $F_f(\\mathbf{\\Omega})$，这一性质便能得到数值验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and verifies the face-flux conservation for a finite-volume\n    discretization of the linear transport equation.\n    \"\"\"\n    \n    # Define geometry\n    x0 = np.array([0.5, 0.5])  # Centroid of left cell (i=0)\n    x1 = np.array([1.5, 0.5])  # Centroid of right cell (i=1)\n    xf = np.array([1.0, 0.5])  # Centroid of internal face\n    nf = np.array([1.0, 0.0])  # Normal vector of internal face\n    Af = 1.0                      # Area of internal face\n    \n    # Tolerance for conservation check\n    tolerance = 1e-12\n\n    test_cases = [\n        # Test 1: Right-going flow, piecewise constant\n        {\n            'directions': [np.array([1.0, 0.0])],\n            'psi_vals': {0: [2.0], 1: [0.5]},\n            'grad_psi_vals': {0: [np.array([0.0, 0.0])], 1: [np.array([0.0, 0.0])]}\n        },\n        # Test 2: Left-going flow, piecewise constant\n        {\n            'directions': [np.array([-1.0, 0.0])],\n            'psi_vals': {0: [1.2], 1: [3.0]},\n            'grad_psi_vals': {0: [np.array([0.0, 0.0])], 1: [np.array([0.0, 0.0])]}\n        },\n        # Test 3: Flow parallel to interface\n        {\n            'directions': [np.array([0.0, 1.0])],\n            'psi_vals': {0: [5.0], 1: [7.0]},\n            'grad_psi_vals': {0: [np.array([0.0, 0.0])], 1: [np.array([0.0, 0.0])]}\n        },\n        # Test 4: Diagonal flow, linear reconstruction\n        {\n            'directions': [np.array([np.sqrt(2)/2, np.sqrt(2)/2])],\n            'psi_vals': {0: [1.0], 1: [4.0]},\n            'grad_psi_vals': {0: [np.array([1.0, 0.0])], 1: [np.array([0.0, 0.0])]}\n        },\n        # Test 5: Aggregated conservation\n        {\n            'directions': [np.array([1.0, 0.0]), np.array([np.sqrt(2)/2, np.sqrt(2)/2])],\n            'psi_vals': {0: [2.0, 1.0], 1: [0.5, 4.0]},\n            'grad_psi_vals': {\n                0: [np.array([0.0, 0.0]), np.array([1.0, 0.0])],\n                1: [np.array([0.0, 0.0]), np.array([0.0, 0.0])]\n            }\n        },\n    ]\n\n    results = []\n    \n    for i, case in enumerate(test_cases):\n        all_conserved = True\n        total_F_L = 0.0\n        total_F_R = 0.0\n        \n        for m, omega in enumerate(case['directions']):\n            # 1. Determine upwind cell\n            dot_product = np.dot(omega, nf)\n            \n            if dot_product > 0:\n                u = 0  # upwind is left cell\n                psi_u = case['psi_vals'][u][m]\n                grad_psi_u = case['grad_psi_vals'][u][m]\n                xu = x0\n            elif dot_product  0:\n                u = 1  # upwind is right cell\n                psi_u = case['psi_vals'][u][m]\n                grad_psi_u = case['grad_psi_vals'][u][m]\n                xu = x1\n            else: # dot_product is zero\n                psi_up_f = 0.0\n                F_f = 0.0\n\n            if dot_product != 0:\n                # 2. Evaluate reconstructed upwind flux at the face\n                displacement = xf - xu\n                psi_up_f = psi_u + np.dot(grad_psi_u, displacement)\n                \n                # 3. Compute net face flux\n                F_f = dot_product * Af * psi_up_f\n            \n            # 4. Define cell contributions\n            F_f_L = F_f\n            F_f_R = -F_f\n            \n            total_F_L += F_f_L\n            total_F_R += F_f_R\n\n            # 5. Verify conservation for this direction\n            if abs(F_f_L + F_f_R) > tolerance:\n                all_conserved = False\n                break\n        \n        if not all_conserved:\n            results.append(False)\n            continue\n            \n        # For Test 5 (index 4), also check aggregated conservation\n        if i == 4:\n            if abs(total_F_L + total_F_R) > tolerance:\n                all_conserved = False\n\n        results.append(all_conserved)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}