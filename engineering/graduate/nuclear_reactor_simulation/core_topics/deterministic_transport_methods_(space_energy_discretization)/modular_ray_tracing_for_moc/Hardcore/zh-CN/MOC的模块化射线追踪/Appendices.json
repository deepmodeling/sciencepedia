{
    "hands_on_practices": [
        {
            "introduction": "在特征线法（MOC）中，第一步是生成一组离散的射线（或称“轨迹线”）来离散化求解区域。然而，轨迹线的布置并非无足轻重；如果轨迹线与几何结构（例如燃料棒晶格的边界）发生系统性对齐，会引入显著的数值偏差，即所谓的“射线效应”。本练习将引导你探讨轨迹线生成的关键技术()，通过学习如何正确地对轨迹线进行交错排布，你将能够避免计算中的统计偏差，从而确保MOC模拟的准确性和稳健性。",
            "id": "4236041",
            "problem": "考虑一个二维方栅燃料组件，由 $I \\times J$ 个节距为 $a$ 的相同棒元组成，占据矩形区域 $\\Omega = [0, L_x] \\times [0, L_y]$，其中 $L_x = I a$ 且 $L_y = J a$。特征线法（MOC）沿着具有预设方位角 $\\varphi_m$ 和平行径迹间均匀法向间距 $\\Delta$ 的直线特征线来描述稳态中子输运。假设在 $\\partial \\Omega$ 上采用周期性边界条件，并计划执行模块化射线追踪，即重复使用穿过相同棒元模块的径迹段。\n\n必须为每个方位角 $\\varphi_m$ 定义一个规范径迹集，该径迹集需满足以下条件：\n\n- 遵循方向 $\\varphi_m$ 的平行特征线的几何定义，\n- 使用垂直于径迹测量的均匀间距 $\\Delta$，\n- 在周期性边界条件下完全覆盖整个区域，无重复或遗漏，并且\n- 避免径迹与棒元边界 $x = n a$ 或 $y = n a$（其中 $n \\in \\mathbb{Z}$）发生系统性对齐，因为这种对齐在对径迹和角度进行聚合时可能导致通量计数的偏差。\n\n以下哪个选项正确地指定了特征径迹族和满足这些要求的偏移量交错规则？\n\nA. 对每个角度 $\\varphi_m$，定义单位方向 $\\mathbf{s}_m = (\\cos \\varphi_m, \\sin \\varphi_m)$ 和单位法向量 $\\mathbf{n}_m = (-\\sin \\varphi_m, \\cos \\varphi_m)$。平行径迹族由 $\\mathbf{n}_m \\cdot \\mathbf{r} = b_m + k \\Delta$ 给出，其中 $\\mathbf{r} = (x,y)$，$k \\in \\mathbb{Z}$ 遍历 $\\Omega$ 在 $\\mathbf{n}_m$ 上的投影范围，并在 $\\partial \\Omega$ 处进行周期性环绕。选择一个交错偏移量 $b_m = a \\{ m \\alpha \\}$，其中 $\\{ \\cdot \\}$ 表示小数部分，$\\alpha$ 是任意无理数（例如，$\\alpha = (\\sqrt{5}-1)/2$），从而使得对所有 $m$，$b_m / a$ 都是无理数，并且偏移量在整个角度集上模 $a$ 等分布，以防止与棒元边界的系统性对齐。\n\nB. 对每个角度 $\\varphi_m$，通过 $\\mathbf{s}_m \\cdot \\mathbf{r} = k \\Delta$ 来定义径迹族，其中 $\\mathbf{s}_m = (\\cos \\varphi_m, \\sin \\varphi_m)$ 且 $k \\in \\mathbb{Z}$。为保持对称性，对所有 $m$ 设定 $b_m = 0$，并依靠周期性边界条件实现覆盖。\n\nC. 对每个角度 $\\varphi_m$，使用 $\\mathbf{n}_m \\cdot \\mathbf{r} = k \\Delta$，其中 $\\mathbf{n}_m = (-\\sin \\varphi_m, \\cos \\varphi_m)$ 且 $k \\in \\mathbb{Z}$。为实现交错，对奇数 $m$ 设定 $b_m = a/2$，对偶数 $m$ 设定 $b_m = 0$，这使得径迹起点相对于棒元边界交替变化。\n\nD. 对每个角度 $\\varphi_m$，定义 $\\mathbf{n}_m \\cdot \\mathbf{r} = b_m + k \\Delta$，其中 $\\mathbf{n}_m = (-\\sin \\varphi_m, \\cos \\varphi_m)$ 且 $k \\in \\mathbb{Z}$。选择 $b_m = r_m \\Delta$，其中 $r_m \\in \\mathbb{Z}$ 是一个依赖于 $m$ 的整数索引，以确保偏移量是间距 $\\Delta$ 的整数倍，从而保证各角度间的一致性。\n\n通过选择正确选项来回答，并说明哪种构造方法满足了 MOC 模块化射线追踪在周期性边界条件下实现无偏通量计数的几何和统计要求，请从特征线公式和晶格上等分布的基本抽样原理出发进行论证。",
            "solution": "该问题要求为特征线法（MOC）在一个具有周期性方栅（节距为 $a$）的二维区域内，正确地指定特征径迹。该指定必须满足四个要求：正确的几何定义、均匀的径迹间距、在周期性边界条件下的完全覆盖，以及避免与栅格发生系统性对齐以防止数值偏差。\n\n首先，我们建立一个平行径迹族的数学表示。对于一个方位角 $\\varphi_m$，运动方向由单位向量 $\\mathbf{s}_m = (\\cos \\varphi_m, \\sin \\varphi_m)$ 给出。特征径迹是与此方向平行的直线。一条直线由所有点 $\\mathbf{r} = (x,y)$ 定义，这些点在该直线法向量上的投影为常数。垂直于 $\\mathbf{s}_m$ 的单位法向量是 $\\mathbf{n}_m = (-\\sin \\varphi_m, \\cos \\varphi_m)$。因此，单条径迹由方程 $\\mathbf{n}_m \\cdot \\mathbf{r} = d$ 描述，其中 $d$ 是从原点到该径迹的有符号垂直距离。\n\n为了满足前两个要求——一个具有均匀法向间距 $\\Delta$ 的平行线族——距离 $d$ 必须形成一个公差为 $\\Delta$ 的等差数列。这可以表示为 $\\mathbf{n}_m \\cdot \\mathbf{r} = b_m + k \\Delta$，其中 $k \\in \\mathbb{Z}$ 是一个整数索引。这里，$b_m$ 是对应于角度 $\\varphi_m$ 的整个径迹族的基础偏移量。\n\n第三个要求是在周期性边界条件下完全覆盖区域 $\\Omega = [0, L_x] \\times [0, L_y]$。公式 $\\mathbf{n}_m \\cdot \\mathbf{r} = b_m + k \\Delta$ 与离开 $\\partial\\Omega$ 的径迹的周期性环绕相结合，是确保这种覆盖的标准构造方法。径迹的数量和 $k$ 的范围被选择来铺满整个区域，但基本的径迹定义是合理的。\n\n第四个也是最关键的要求是避免与棒元边界发生系统性对齐，这些边界位于整数 $n$ 的 $x=na$ 和 $y=na$ 处。如果对于许多角度，径迹在棒元内总是处于相同的相对位置（例如，总是穿过中心，或总是沿着边缘），那么得到的体积平均通量计数就会有偏差。这种数值假象是射线效应的一种形式。为了缓解这个问题，径迹相对于棒元栅格的位置必须在离散角度集上有所变化。这通过仔细选择与角度相关的偏移量 $b_m$ 来实现。偏移量序列 $b_m$ 理想情况下应使径迹在模栅格节距 $a$ 的意义下尽可能均匀地分布。\n\n有了这个理论框架，我们现在可以评估每个选项。\n\n**选项 A：**\n- **径迹族定义**：径迹由 $\\mathbf{n}_m \\cdot \\mathbf{r} = b_m + k \\Delta$ 定义，其中 $\\mathbf{n}_m = (-\\sin \\varphi_m, \\cos \\varphi_m)$。这是一个具有均匀法向间距 $\\Delta$ 的平行线族的正确几何公式。\n- **交错规则**：偏移量选择为 $b_m = a \\{ m \\alpha \\}$，其中 $\\{ \\cdot \\}$ 是小数部分，$\\alpha$ 是一个无理数。这是一种复杂且在统计上稳健的方法。根据 Weyl 准则，如果 $\\alpha$ 是无理数，则序列 $x_m = \\{ m \\alpha \\}$（对于 $m=1, 2, 3, \\ldots$）在区间 $[0, 1)$ 上是等分布的。这意味着，当我们在求积组中考虑更多的角度时，归一化的偏移量 $b_m/a$ 将均匀地覆盖区间 $[0, 1)$。因此，径迹族相对于棒元栅格被均匀地移动，从而有效消除了系统性对齐及其相关的偏差。这是一种准蒙特卡罗方法，为径迹抽样提供了优异的统计特性。黄金比例 $\\alpha = (\\sqrt{5}-1)/2$ 是一个常见的选择，因为它具有出色的分布特性。此方法满足所有四个要求。\n- **结论**：**正确**。\n\n**选项 B：**\n- **径迹族定义**：径迹由 $\\mathbf{s}_m \\cdot \\mathbf{r} = k \\Delta$ 定义。向量 $\\mathbf{s}_m = (\\cos \\varphi_m, \\sin \\varphi_m)$ 是中子行进的方向。方程 $\\mathbf{s}_m \\cdot \\mathbf{r} = \\text{常数}$ 定义的是一条*垂直*于行进方向的线，而不是平行于它的线。这代表的是波前，而不是粒子轨迹或特征径迹。对于MOC来说，这个公式在几何上是错误的。\n- **交错规则**：它建议对所有 $m$ 设定 $b_m = 0$，意味着没有交错。这是产生偏差的最坏情况，因为它最大化了径迹与栅格系统性对齐的可能性，而这正是要求4旨在防止的。\n- **结论**：**不正确**。\n\n**选项 C：**\n- **径迹族定义**：陈述的公式是 $\\mathbf{n}_m \\cdot \\mathbf{r} = k \\Delta$，这意味着 $b_m=0$，但接下来的交错规则与此相矛盾。假设预期的公式是 $\\mathbf{n}_m \\cdot \\mathbf{r} = b_m + k \\Delta$。\n- **交错规则**：偏移量对奇数 $m$ 设定为 $b_m=a/2$，对偶数 $m$ 设定为 $b_m=0$。这引入了一种最小的、确定性的交错。虽然比完全没有交错要好，但这是一种非常弱的方案。相对于栅元原点，径迹只可能处于两个位置之一。这仍然是一种高度系统化的模式，不能保证避免偏差。对于某些角度和栅格几何的组合，这种简单的交替仍然可能导致显著的统计相关性和有偏结果。它没有提供更具随机性的序列所能实现的对栅元的均匀“扫掠”。\n- **结论**：**不正确**。\n\n**选项 D：**\n- **径迹族定义**：形式 $\\mathbf{n}_m \\cdot \\mathbf{r} = b_m + k \\Delta$ 是正确的。\n- **交错规则**：偏移量选择为 $b_m = r_m \\Delta$，其中 $r_m$ 是一个整数。让我们分析径迹位置的集合。直线方程为 $y \\cos \\varphi_m - x \\sin \\varphi_m = r_m \\Delta + k \\Delta$。由于 $r_m$ 和 $k$ 都是整数，它们的和 $k' = r_m + k$ 也是一个遍历 $\\mathbb{Z}$ 的整数。因此，这组直线是 $\\{ \\mathbf{r} | \\mathbf{n}_m \\cdot \\mathbf{r} = k' \\Delta, k' \\in \\mathbb{Z} \\}$。这与我们选择偏移量 $b_m=0$ 时的直线集合完全相同。将整个等间距平行线族移动其间距的整数倍，结果得到的是完全相同的线族。因此，这个“交错规则”没有任何效果，等同于没有交错。\n- **结论**：**不正确**。\n\n总而言之，选项A是唯一一个为特征径迹提供了几何上正确的公式，并将其与基于等分布理论的、统计上合理且有效的交错策略相结合，以满足无偏模块化MOC计算的所有既定要求。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "当几何模型被特征线离散化后，特征线法通过迭代求解输运方程。这个过程的核心是源迭代算法：计算中子源，沿特征线求解通量，用新通量更新中子源，并重复此过程直至收敛。本练习将让你亲手实现这一核心算法()，通过编写代码来解决一个固定点迭代问题，你将深入理解输运方程数值解的迭代本质，并探究由散射等物理过程决定的收敛速度及其影响因素。",
            "id": "4236060",
            "problem": "考虑一个双能群均匀区域，该区域使用特征线法（MOC）中典型的模块化输运扫描和源更新方法进行求解。特征线法（MOC）执行一种输运扫描，通过沿直线轨迹积分中子输运方程，将已知的各向同性源映射为标量通量。在均匀区域中，输运扫描模块可以抽象为一个对角算子，它通过除以总宏观截面，将每个能群的各向同性源映射到每个能群的标量通量。在各向同性散射的情况下，散射源与标量通量成正比。在模块化架构中，这为标量通量向量产生了一个不动点问题。令 $G=2$ 表示能群数，$\\boldsymbol{\\phi}\\in\\mathbb{R}^2$ 为标量通量向量，输运扫描与散射复合算子由 $2\\times 2$ 的散射比矩阵 $\\mathbf{R}$ 表示，其元素为 $r_{g\\leftarrow g'}=\\Sigma_{s}^{g\\leftarrow g'}/\\Sigma_{t,g}$，其中 $\\Sigma_{s}^{g\\leftarrow g'}$ 和 $\\Sigma_{t,g}$ 分别表示宏观散射截面和总截面。令 $\\mathbf{b}\\in\\mathbb{R}^2$ 表示经过输运扫描映射后的外部源，即 $b_g=q_g/\\Sigma_{t,g}$。不动点问题为\n$$\n\\boldsymbol{\\phi}=\\mathbf{b}+\\mathbf{R}\\boldsymbol{\\phi}.\n$$\n源迭代通过以下方式更新通量：\n$$\n\\boldsymbol{\\phi}^{(k+1)}=\\mathbf{b}+\\mathbf{R}\\boldsymbol{\\phi}^{(k)},\n$$\n从初始猜测值 $\\boldsymbol{\\phi}^{(0)}$ 开始。\n\n将第 $k$ 次迭代的残差定义为不动点残差的欧几里得范数\n$$\nr^{(k)}=\\left\\|\\boldsymbol{\\phi}^{(k)}-\\mathbf{b}-\\mathbf{R}\\boldsymbol{\\phi}^{(k)}\\right\\|_2.\n$$\n给定一个容差 $\\epsilon0$，所需的源迭代次数是满足 $r^{(N)}\\le \\epsilon$ 的最小整数 $N$。\n\n从稳态中子输运方程以及 MOC 中输运扫描和散射源的模块化分解出发，推导上述源迭代为何是在均匀区域中的一个有效不动点算法，并将其收敛行为与 $\\mathbf{R}$ 的谱性质联系起来。然后，针对下方的参数集，实现一个程序，为每个测试计算两种不同初始猜测值下满足 $r^{(N)}\\le \\epsilon$ 所需的源迭代次数 $N$，并将结果汇总为指定的最终输出格式。如果在最多 $10000$ 次迭代内未达到收敛，则对该初始猜测值返回整数 $-1$。\n\n本问题中所有量均为无量纲量，迭代次数必须以整数形式返回。角度未出现，因此不需要角度单位。\n\n使用以下测试套件，它涵盖了典型行为、慢收斂和边界情况。对于每个测试，程序必须评估两种初始猜测值：零通量向量和下面指定的备选值。\n\n- 测试 1（正常情况，中等散射和耦合）：\n  - $\\mathbf{R}=\\begin{bmatrix}0.450.05\\\\0.100.35\\end{bmatrix}$,\n  - $\\mathbf{b}=\\begin{bmatrix}1.0\\\\0.2\\end{bmatrix}$,\n  - $\\epsilon=10^{-8}$,\n  - 初始猜测值：\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{zero}}=\\begin{bmatrix}0\\\\0\\end{bmatrix}$,\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{sub}}=$ $\\mathbf{R}$ 的次 dominant 特征值（模第二大的特征值）对应的单位范数右特征向量。\n\n- 测试 2（慢收敛，优势比接近于 1）：\n  - $\\mathbf{R}=\\begin{bmatrix}0.70.25\\\\0.240.68\\end{bmatrix}$,\n  - $\\mathbf{b}=\\begin{bmatrix}0.5\\\\0.5\\end{bmatrix}$,\n  - $\\epsilon=10^{-10}$,\n  - 初始猜测值：\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{zero}}=\\begin{bmatrix}0\\\\0\\end{bmatrix}$,\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{sub}}=$ $\\mathbf{R}$ 的次 dominant 特征值对应的单位范数右特征向量。\n\n- 测试 3（边界情况，精确初始解）：\n  - $\\mathbf{R}=\\begin{bmatrix}0.30.0\\\\0.050.4\\end{bmatrix}$,\n  - $\\mathbf{b}=\\begin{bmatrix}2.0\\\\0.0\\end{bmatrix}$,\n  - $\\epsilon=10^{-12}$,\n  - 初始猜测值：\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{zero}}=\\begin{bmatrix}0\\\\0\\end{bmatrix}$,\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{exact}}=\\boldsymbol{\\phi}^{*}$，即满足 $(\\mathbf{I}-\\mathbf{R})\\boldsymbol{\\phi}^{*}=\\mathbf{b}$ 的精确不动点解。\n\n- 测试 4（近边界行为，优势比非常接近于 1，对称耦合）：\n  - $\\mathbf{R}=\\begin{bmatrix}0.850.14\\\\0.140.85\\end{bmatrix}$,\n  - $\\mathbf{b}=\\begin{bmatrix}0.2\\\\0.8\\end{bmatrix}$,\n  - $\\epsilon=10^{-8}$,\n  - 初始猜测值：\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{zero}}=\\begin{bmatrix}0\\\\0\\end{bmatrix}$,\n    - $\\boldsymbol{\\phi}^{(0)}_{\\text{sub}}=$ $\\mathbf{R}$ 的次 dominant 特征值对应的单位范数右特征向量。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。对于每个测试 $i\\in\\{1,2,3,4\\}$，报告一个双元素列表 $[N_{\\text{zero}},N_{\\text{alt}}]$，其中包含零初始猜测值和指定的备选初始猜测值的迭代次数。将这四个双元素列表汇总成一个单一列表，例如，`[[N_{1,\\text{zero}},N_{1,\\text{alt}}],[N_{2,\\text{zero}},N_{2,\\text{alt}}],[N_{3,\\text{zero}},N_{3,\\text{alt}}],[N_{4,\\text{zero}},N_{4,\\text{alt}}]]`。",
            "solution": "问题陈述经评估有效。它具有科学依据，数学上适定，并且是自洽的。该公式代表了在均匀介质中求解多群中子平衡方程的标准源迭代法，这是核反应堆物理学中的一个基本问题。求解所需的所有参数和条件都已指定，且没有内部矛盾。我们继续进行推导和求解。\n\n问题的核心是求解由稳态、多群中子平衡方程产生的线性系统。对于具有各向同性中子通量和源的均匀区域，能群 $g$ 的平衡方程指出，中子损失率必须等于中子产生率。单位体积的损失率由总碰撞率 $\\Sigma_{t,g}\\phi_g$ 给出，其中 $\\Sigma_{t,g}$ 是能群 $g$ 的宏观总截面，$\\phi_g$ 是标量通量。产生率是从中子从所有其他能群 $g'$ 散射到能群 $g$ 的总和，以及任何外部或固定源 $q_g$。散射源由 $\\sum_{g'} \\Sigma_{s}^{g\\leftarrow g'} \\phi_{g'}$ 给出，其中 $\\Sigma_{s}^{g\\leftarrow g'}$ 是从中子从能群 $g'$ 散射到能群 $g$ 的宏观散射截面。\n\n因此，平衡方程为：\n$$\n\\Sigma_{t,g}\\phi_g = \\sum_{g'} \\Sigma_{s}^{g\\leftarrow g'} \\phi_{g'} + q_g\n$$\n这代表了一个关于 $G$ 个未知标量通量 $\\phi_g$ 的 $G$ 个线性方程组。在这个问题中，$G=2$。为了将其表述为所述的不动点问题，我们可以像特征线法（MOC）中典型的那样，以模块化的方式对求解过程建模。通量 $\\phi_g$ 可以看作是“输运扫描”作用于总源 $Q_g = \\sum_{g'} \\Sigma_{s}^{g\\leftarrow g'} \\phi_{g'} + q_g$ 的结果。在无限均匀介质中，此扫描只是简单地除以总截面：$\\phi_g = Q_g / \\Sigma_{t,g}$。代入 $Q_g$ 的表达式，我们得到：\n$$\n\\phi_g = \\frac{1}{\\Sigma_{t,g}} \\left( \\sum_{g'} \\Sigma_{s}^{g\\leftarrow g'} \\phi_{g'} + q_g \\right)\n$$\n整理各项可得：\n$$\n\\phi_g = \\sum_{g'} \\left(\\frac{\\Sigma_{s}^{g\\leftarrow g'}}{\\Sigma_{t,g}}\\right) \\phi_{g'} + \\frac{q_g}{\\Sigma_{t,g}}\n$$\n通过定义散射比矩阵 $\\mathbf{R}$（其元素为 $r_{g\\leftarrow g'} = \\Sigma_{s}^{g\\leftarrow g'}/\\Sigma_{t,g}$）和源向量 $\\mathbf{b}$（其元素为 $b_g = q_g/\\Sigma_{t,g}$），我们可以将此方程组表示为矩阵形式：\n$$\n\\boldsymbol{\\phi} = \\mathbf{R}\\boldsymbol{\\phi} + \\mathbf{b}\n$$\n这正是陈述中给出的不动点问题，$\\boldsymbol{\\phi} = (\\mathbf{I}-\\mathbf{R})^{-1}\\mathbf{b}$。这一推导证实了基于中子输运基本原理的问题公式的有效性。\n\n源迭代法是求解该系统的一种定常线性迭代法（不动点迭代的一个特例）。它由以下递推关系定义：\n$$\n\\boldsymbol{\\phi}^{(k+1)} = \\mathbf{b} + \\mathbf{R}\\boldsymbol{\\phi}^{(k)}\n$$\n其中 $\\boldsymbol{\\phi}^{(k)}$ 是第 $k$ 次迭代时的通量向量。为了分析其收敛性，我们考察迭代误差的行为，其定义为 $\\mathbf{e}^{(k)} = \\boldsymbol{\\phi}^{(k)} - \\boldsymbol{\\phi}^{*}$，其中 $\\boldsymbol{\\phi}^{*}$ 是满足 $\\boldsymbol{\\phi}^{*} = \\mathbf{b} + \\mathbf{R}\\boldsymbol{\\phi}^{*}$ 的精确解。\n\n从迭代方程中减去精确方程，我们得到误差传播关系：\n$$\n\\boldsymbol{\\phi}^{(k+1)} - \\boldsymbol{\\phi}^{*} = (\\mathbf{b} + \\mathbf{R}\\boldsymbol{\\phi}^{(k)}) - (\\mathbf{b} + \\mathbf{R}\\boldsymbol{\\phi}^{*}) = \\mathbf{R}(\\boldsymbol{\\phi}^{(k)} - \\boldsymbol{\\phi}^{*})\n$$\n$$\n\\mathbf{e}^{(k+1)} = \\mathbf{R}\\mathbf{e}^{(k)}\n$$\n通过归纳法，第 $k$ 次迭代的误差与初始误差 $\\mathbf{e}^{(0)}$ 的关系为 $\\mathbf{e}^{(k)} = \\mathbf{R}^k \\mathbf{e}^{(0)}$。对于任意初始误差 $\\mathbf{e}^{(0)}$，迭代收敛，即 $\\lim_{k\\to\\infty} \\mathbf{e}^{(k)} = \\mathbf{0}$，当且仅当 $\\lim_{k\\to\\infty} \\mathbf{R}^k = \\mathbf{0}$。如果迭代矩阵 $\\mathbf{R}$ 的谱半径（记为 $\\rho(\\mathbf{R})$）严格小于 $1$，则满足此条件。谱半径是 $\\mathbf{R}$ 的特征值中的最大模。\n\n在物理上，$\\rho(\\mathbf{R})$可以解释为散射过程的无限介质增殖因子。$\\rho(\\mathbf{R})  1$ 的值对应于一个次临界系统，其中若没有外部源，中子布居最终将衰减至零。源迭代法数值模拟了这一物理过程。渐进收敛率由 $\\rho(\\mathbf{R})$ 决定；每次迭代误差大约减少一个因子 $\\rho(\\mathbf{R})$。因此，当 $\\rho(\\mathbf{R})$ 接近 1 时，收敛会很慢。\n\n下面实现的算法遵循了问题规范。对于每个测试用例，它初始化通量向量 $\\boldsymbol{\\phi}^{(0)}$ 并进入一个循环。在每次迭代 $N$ 中，它计算残差 $r^{(N)} = \\left\\|\\boldsymbol{\\phi}^{(N)} - \\mathbf{b} - \\mathbf{R}\\boldsymbol{\\phi}^{(N)}\\right\\|_2$。如果 $r^{(N)}$ 小于或等于指定的容差 $\\epsilon$，循环终止并返回迭代次数 $N$。否则，它计算下一个通量迭代值 $\\boldsymbol{\\phi}^{(N+1)} = \\mathbf{b} + \\mathbf{R}\\boldsymbol{\\phi}^{(N)}$ 并继续。如果在最多 $10000$ 次迭代内未达到收敛，则中止该过程。备选初始猜测值使用 `numpy.linalg.eig` 计算次 dominant 特征向量，使用 `numpy.linalg.solve` 计算精确解。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef count_iterations(R, b, epsilon, phi_0, max_iter=10000):\n    \"\"\"\n    Performs source iteration to find the number of iterations N to converge.\n\n    Args:\n        R (np.ndarray): The scattering ratio matrix.\n        b (np.ndarray): The external source vector.\n        epsilon (float): The convergence tolerance.\n        phi_0 (np.ndarray): The initial flux guess.\n        max_iter (int): The maximum number of iterations.\n\n    Returns:\n        int: The number of iterations N for convergence, or -1 if not converged.\n    \"\"\"\n    phi = np.array(phi_0, dtype=float)\n\n    for N in range(max_iter + 1):\n        # The problem defines the residual at iteration k as:\n        # r(k) = ||phi(k) - (b + R @ phi(k))||_2\n        # where phi(k) is the current iterate.\n        residual_vec = phi - (b + R @ phi)\n        \n        # Check for convergence using the L2 norm of the residual vector\n        if np.linalg.norm(residual_vec) = epsilon:\n            return N\n        \n        # If not converged, compute the next iterate phi^(N+1)\n        # This will be the 'phi' for the next loop cycle (where the loop counter is N+1).\n        phi = b + R @ phi\n        \n    # If the loop completes without convergence, return -1\n    return -1\n\ndef solve():\n    \"\"\"\n    Solves the problem for all specified test cases and prints the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1: Happy path\n        {'R': [[0.45, 0.05], [0.10, 0.35]], 'b': [1.0, 0.2], 'eps': 1e-8, 'alt_type': 'sub'},\n        # Test 2: Slow convergence\n        {'R': [[0.7, 0.25], [0.24, 0.68]], 'b': [0.5, 0.5], 'eps': 1e-10, 'alt_type': 'sub'},\n        # Test 3: Edge case, exact initial solution\n        {'R': [[0.3, 0.0], [0.05, 0.4]], 'b': [2.0, 0.0], 'eps': 1e-12, 'alt_type': 'exact'},\n        # Test 4: Near-boundary behavior\n        {'R': [[0.85, 0.14], [0.14, 0.85]], 'b': [0.2, 0.8], 'eps': 1e-8, 'alt_type': 'sub'}\n    ]\n\n    results = []\n    for case in test_cases:\n        R = np.array(case['R'], dtype=float)\n        b = np.array(case['b'], dtype=float)\n        eps = case['eps']\n        \n        # Case 1: Zero initial guess\n        phi0_zero = np.zeros(2)\n        N_zero = count_iterations(R, b, eps, phi0_zero)\n        \n        # Case 2: Alternative initial guess\n        phi0_alt = None\n        if case['alt_type'] == 'sub':\n            # Calculate eigenvalues and right eigenvectors\n            eigvals, eigvecs = np.linalg.eig(R)\n            \n            # Get indices that would sort eigenvalues by magnitude (ascending)\n            sorted_indices = np.argsort(np.abs(eigvals))\n            \n            # The subdominant eigenvalue is the second to last in the sorted list\n            subdominant_idx = sorted_indices[-2]\n            \n            # The corresponding eigenvector is the initial guess.\n            # Eigvecs are columns. Result from eig can be complex, but for real\n            # eigenvalues of a real matrix, the eigenvector can be chosen as real.\n            phi0_alt = np.real(eigvecs[:, subdominant_idx])\n            \n        elif case['alt_type'] == 'exact':\n            # Solve (I - R) * phi = b for the exact solution phi*\n            I = np.identity(2)\n            phi0_alt = np.linalg.solve(I - R, b)\n            \n        N_alt = count_iterations(R, b, eps, phi0_alt)\n        \n        results.append([N_zero, N_alt])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "均匀的轨迹线间距虽然简单，但计算效率不高，可能在平坦区域浪费计算资源，而在高曲率区域又显得不足。为了平衡精度与效率，先进的MOC程序采用自适应间距技术，即根据几何特征的复杂性动态调整轨迹线密度。本练习将引导你探索一种先进的优化方法()，通过推导并实现一个自适应轨迹线间距算法，你将学会如何根据材料边界的局部曲率来控制几何误差，从而在不牺牲精度的前提下显著提升计算效率。",
            "id": "4236066",
            "problem": "考虑一个用于核反应堆模拟中特征线法 (MOC) 的模块化射线追踪模块。在此背景下，一束平行的特征射线穿过一个包含弯曲材料界面的二维横截面。目标是确定射线间的自适应横向间距，记为 $\\,\\Delta\\,$，使得通过局部用直线弦近似弯曲边界所引起的沿射线方向的交点长度几何误差保持在指定目标以下。\n\n从以下微分几何和圆几何的基本原理出发：\n\n- 光滑曲线上某点的曲率 $\\,\\kappa\\,$ 等于其密切圆半径 $\\,R\\,$ 的倒数，即 $\\,\\kappa = \\dfrac{1}{R}\\,$.\n- 对于由长度为 $\\,\\Delta\\,$ 的弦所对的圆弧，其矢高（弧与弦之间的最大偏差）为\n$$\ns(\\Delta, R) \\;=\\; R \\;-\\; \\sqrt{R^2 - \\left(\\dfrac{\\Delta}{2}\\right)^2}\\,,\n$$\n且对于相对于 $\\,R\\,$ 足够小的 $\\,\\Delta\\,$，二阶泰勒展开式给出了经过充分检验的近似式\n$$\ns(\\Delta, R) \\;\\approx\\; \\dfrac{\\Delta^2}{8R}\\;=\\;\\dfrac{\\kappa\\,\\Delta^2}{8}\\,.\n$$\n\n假设一条特征射线以相对于边界法线的入射角 $\\,\\alpha\\,$ 与弯曲边界相交。一个法向位置误差 $\\,s\\,$ 通过投影映射为沿射线方向的交点长度误差 $\\,e\\,$，\n$$\ne \\;=\\; \\dfrac{s}{\\left|\\cos\\alpha\\right|}\\,.\n$$\n假设对沿射线方向的交点长度误差规定了一个目标上限 $\\,\\varepsilon\\,$。\n\n任务 A (推导): 基于上述基本原理，推导出自适应射线间距 $\\,\\Delta\\,$ 作为曲率 $\\,\\kappa\\,$、入射角 $\\,\\alpha\\,$ 和目标误差 $\\,\\varepsilon\\,$ 的函数关系式，以确保对于小的 $\\,\\Delta\\,$ 满足 $\\,e \\le \\varepsilon\\,$。证明 $\\,\\Delta\\,$ 与 $\\,\\Delta \\propto \\kappa^{-1/2}\\,$ 成比例，并给出包含常数的明确比例关系。\n\n任务 B (算法设计): 使用推导出的关系式，设计一个用于计算 $\\,\\Delta\\,$ 的鲁棒算法，该算法包括一个实际的上限 $\\,\\Delta_{\\max}\\,$，以防止在弱弯曲或平坦区域的射线过于稀疏。如果 $\\,\\kappa = 0\\,$，则定义 $\\,\\Delta\\,$ 为 $\\,\\Delta_{\\max}\\,$。所有距离必须以米为单位表示，所有角度必须以弧度为单位表示。\n\n任务 C (实现与测试套件): 实现一个完整的、可运行的程序，该程序：\n- 为一组固定的测试用例计算 $\\,\\Delta\\,$。\n- 使用任务 A 中的公式和任务 B 中的实用规则。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $\\,\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]\\,$。\n\n测试套件由以下参数集 $\\,(\\kappa,\\alpha,\\varepsilon,\\Delta_{\\max})\\,$ 组成：\n- 情况 1 (典型曲率和角度): $\\,\\left(1.0,\\;\\dfrac{\\pi}{4},\\;1.0\\times 10^{-4},\\;0.05\\right)\\,$。\n- 情况 2 (高曲率): $\\,\\left(100.0,\\;\\dfrac{\\pi}{6},\\;1.0\\times 10^{-4},\\;0.05\\right)\\,$。\n- 情况 3 (平坦边界): $\\,\\left(0.0,\\;\\dfrac{\\pi}{4},\\;1.0\\times 10^{-4},\\;0.10\\right)\\,$。\n- 情况 4 (近切向入射): $\\,\\left(10.0,\\;89.0\\times\\dfrac{\\pi}{180},\\;1.0\\times 10^{-4},\\;0.05\\right)\\,$。\n- 情况 5 (受最大间距限制): $\\,\\left(2.0,\\;\\dfrac{\\pi}{3},\\;1.0\\times 10^{-3},\\;0.02\\right)\\,$。\n\n对于每种情况，计算以米为单位的自适应间距 $\\,\\Delta\\,$。您的程序应产生单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $\\,\\left[\\Delta_1,\\Delta_2,\\Delta_3,\\Delta_4,\\Delta_5\\right]\\,$，其中每个 $\\,\\Delta_i\\,$ 是一个表示米数的浮点数。不应打印任何额外文本。",
            "solution": "**问题验证**\n\n**步骤 1：提取已知条件**\n从问题陈述中逐字提取的已知条件如下：\n- 自适应横向射线间距：$\\Delta$\n- 曲率：$\\kappa = \\dfrac{1}{R}$，其中 $R$ 是密切圆的半径。\n- 圆弧的矢高：$s(\\Delta, R) = R - \\sqrt{R^2 - \\left(\\dfrac{\\Delta}{2}\\right)^2}$。\n- 矢高的二阶泰勒近似：$s(\\Delta, R) \\approx \\dfrac{\\Delta^2}{8R} = \\dfrac{\\kappa\\,\\Delta^2}{8}$。\n- 入射角：$\\alpha$，相对于边界法线测量。\n- 由法向位置误差 $s$ 导致的沿射线交点长度误差 $e$：$e = \\dfrac{s}{\\left|\\cos\\alpha\\right|}$。\n- 沿射线交点长度误差的目标上限：$\\varepsilon$。目标是确保 $e \\le \\varepsilon$。\n- 射线间距的实际操作上限：$\\Delta_{\\max}$。\n- 平坦边界的条件：如果 $\\kappa = 0$，则 $\\Delta = \\Delta_{\\max}$。\n- 测试用例 1：$(\\kappa, \\alpha, \\varepsilon, \\Delta_{\\max}) = \\left(1.0, \\dfrac{\\pi}{4}, 1.0 \\times 10^{-4}, 0.05\\right)$。\n- 测试用例 2：$(\\kappa, \\alpha, \\varepsilon, \\Delta_{\\max}) = \\left(100.0, \\dfrac{\\pi}{6}, 1.0 \\times 10^{-4}, 0.05\\right)$。\n- 测试用例 3：$(\\kappa, \\alpha, \\varepsilon, \\Delta_{\\max}) = \\left(0.0, \\dfrac{\\pi}{4}, 1.0 \\times 10^{-4}, 0.10\\right)$。\n- 测试用例 4：$(\\kappa, \\alpha, \\varepsilon, \\Delta_{\\max}) = \\left(10.0, 89.0 \\times \\dfrac{\\pi}{180}, 1.0 \\times 10^{-4}, 0.05\\right)$。\n- 测试用例 5：$(\\kappa, \\alpha, \\varepsilon, \\Delta_{\\max}) = \\left(2.0, \\dfrac{\\pi}{3}, 1.0 \\times 10^{-3}, 0.02\\right)$。\n- 所有距离单位为米，所有角度单位为弧度。\n\n**步骤 2：使用提取的已知条件进行验证**\n根据验证标准对问题进行评估：\n- **科学依据**：该问题坚实地基于微分几何的既定原理（曲率、密切圆、矢高）及其在物理学数值方法（用于粒子输运的特征线法）中的应用。所提供的关系式是该领域使用的标准近似。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。它清晰地定义了所有变量，并提供了推导自适应射线间距 $\\Delta$ 唯一解所需的所有方程和常数。任务具体，测试用例提供了所有必需的输入参数。\n- **客观性**：该问题以精确、客观的语言陈述。它使用形式化的数学定义，并避免任何主观、推测性或基于观点的断言。\n\n该问题不存在任何无效性缺陷。它基于正确的科学前提，是可形式化的、自洽的，在数值模拟的背景下是物理上现实的，并且结构良好。\n\n**步骤 3：结论与行动**\n问题陈述有效。将提供完整的解决方案。\n\n**求解推导与算法设计**\n\n**任务 A：推导**\n目标是推导自适应射线间距 $\\Delta$ 作为曲率 $\\kappa$、入射角 $\\alpha$ 和目标误差 $\\varepsilon$ 的函数表达式。推导从所提供的关系式开始。\n\n弯曲边界与长度为 $\\Delta$ 的近似直线弦之间的最大几何偏差由矢高 $s$ 给出。对于相对于曲率半径 $R$ 较小的 $\\Delta$，其近似值为：\n$$\ns \\approx \\dfrac{\\kappa \\Delta^2}{8}\n$$\n这个矢高代表了由这种几何近似产生的最大法向位置误差。\n\n沿射线交点长度误差 $e$ 与我们取为矢高 $s$ 的法向位置误差通过投影公式相关联：\n$$\ne = \\dfrac{s}{|\\cos\\alpha|}\n$$\n必须满足的条件是该长度误差不得超过指定的容差 $\\varepsilon$：\n$$\ne \\le \\varepsilon\n$$\n将 $e$ 和 $s$ 的表达式代入此不等式，我们得到：\n$$\n\\dfrac{s}{|\\cos\\alpha|} \\le \\varepsilon\n$$\n$$\n\\dfrac{\\left(\\dfrac{\\kappa \\Delta^2}{8}\\right)}{|\\cos\\alpha|} \\le \\varepsilon\n$$\n现在我们求解 $\\Delta$。对于满足该准则的最大间距 $\\Delta$，此不等式应成立，因此我们可以将其视为边界情况的等式。\n$$\n\\dfrac{\\kappa \\Delta^2}{8 |\\cos\\alpha|} = \\varepsilon\n$$\n整理各项以分离 $\\Delta^2$：\n$$\n\\Delta^2 = \\dfrac{8 \\varepsilon |\\cos\\alpha|}{\\kappa}\n$$\n对两边取平方根，得到自适应射线间距的期望关系式：\n$$\n\\Delta = \\sqrt{\\dfrac{8 \\varepsilon |\\cos\\alpha|}{\\kappa}}\n$$\n此公式在 $\\kappa  0$ 时有效。从此表达式中，很明显 $\\Delta$ 与 $\\kappa^{-1/2}$ 成正比：\n$$\n\\Delta = \\left( \\sqrt{8 \\varepsilon |\\cos\\alpha|} \\right) \\kappa^{-1/2}\n$$\n项 $\\sqrt{8 \\varepsilon |\\cos\\alpha|}$ 是明确的比例常数，其本身取决于误差容差 $\\varepsilon$ 和入射角 $\\alpha$。\n\n**任务 B：算法设计**\n一个用于计算 $\\Delta$ 的鲁棒算法必须能处理所有可能的 $\\kappa$ 输入范围，包括 $\\kappa = 0$ 的平坦边界的特殊情况，并整合实际的上限 $\\Delta_{\\max}$。\n\n该算法流程如下：\n$1$. 给定输入：曲率 $\\kappa$、入射角 $\\alpha$、误差容差 $\\varepsilon$ 和最大间距 $\\Delta_{\\max}$。\n$2$. 检查平坦或近乎平坦边界的情况。如果 $\\kappa = 0$（或数值上无法与零区分），则推导出的公式因除以零而无定义。根据问题规范，间距被设置为允许的最大值：\n   $$\n   \\text{如果 } \\kappa = 0, \\text{ 则 } \\Delta = \\Delta_{\\max}\n   $$\n$3$. 对于 $\\kappa  0$ 的弯曲边界，使用任务 A 中推导的公式计算理想间距，我们称之为 $\\Delta_{\\text{calc}}$：\n   $$\n   \\Delta_{\\text{calc}} = \\sqrt{\\dfrac{8 \\varepsilon |\\cos\\alpha|}{\\kappa}}\n   $$\n   绝对值 $|\\cos\\alpha|$ 确保了对于任何角度 $\\alpha$ 的正确性，尽管在此上下文中 $\\alpha$ 通常位于 $[0, \\pi/2]$ 区间，其中 $\\cos\\alpha \\ge 0$。\n$4$. 为了防止在曲率非常低的区域（即 $\\Delta_{\\text{calc}}$ 很大）射线过于稀疏，计算出的间距必须受到实际的上限 $\\Delta_{\\max}$ 的限制。因此，最终的自适应间距 $\\Delta$ 是计算值和允许的最大值中的较小者：\n   $$\n   \\Delta = \\min(\\Delta_{\\text{calc}}, \\Delta_{\\max})\n   $$\n这个两步逻辑（处理 $\\kappa=0$ 的情况，然后应用上限 $\\Delta_{\\max}$）为计算所有有效输入的自适应射线间距提供了一个鲁棒的程序。实现将结合这些步骤。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the adaptive ray spacing for a set of test cases based on\n    curvature, incidence angle, error tolerance, and a maximum spacing limit.\n    \"\"\"\n    # The test suite consists of the following parameter sets (κ, α, ε, Δ_max).\n    # κ: curvature (1/m)\n    # α: incidence angle (radians)\n    # ε: target error (m)\n    # Δ_max: maximum spacing (m)\n    test_cases = [\n        # Case 1 (typical curvature and angle)\n        (1.0, np.pi / 4.0, 1.0e-4, 0.05),\n        # Case 2 (high curvature)\n        (100.0, np.pi / 6.0, 1.0e-4, 0.05),\n        # Case 3 (flat boundary)\n        (0.0, np.pi / 4.0, 1.0e-4, 0.10),\n        # Case 4 (near-tangent incidence)\n        (10.0, 89.0 * np.pi / 180.0, 1.0e-4, 0.05),\n        # Case 5 (limit by maximum spacing)\n        (2.0, np.pi / 3.0, 1.0e-3, 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        kappa, alpha, epsilon, delta_max = case\n\n        if kappa == 0.0:\n            # For a flat boundary, curvature is zero. The derived formula is\n            # undefined. Per the problem statement, use the maximum spacing.\n            delta = delta_max\n        else:\n            # Calculate the ideal spacing based on the derived formula from Task A.\n            # Δ = sqrt( (8 * ε * |cos(α)|) / κ )\n            # The use of np.abs() for cos(alpha) is for robustness, though alpha\n            # in this context is typically in [0, pi/2].\n            numerator = 8.0 * epsilon * np.abs(np.cos(alpha))\n            delta_calc = np.sqrt(numerator / kappa)\n\n            # Apply the practical upper bound from Task B. The final spacing\n            # is the minimum of the calculated value and the max allowed value.\n            delta = min(delta_calc, delta_max)\n        \n        results.append(delta)\n\n    # The final print statement must produce only the single-line format\n    # specified in the problem statement.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}