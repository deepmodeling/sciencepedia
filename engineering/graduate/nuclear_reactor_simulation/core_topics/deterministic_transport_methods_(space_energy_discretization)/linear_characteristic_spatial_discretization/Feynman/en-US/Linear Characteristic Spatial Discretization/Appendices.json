{
    "hands_on_practices": [
        {
            "introduction": "The most fundamental test of any transport scheme is its ability to correctly model particle attenuation in a source-free medium. This first exercise  challenges you to verify that the Linear Characteristic (LC) method exactly reproduces the analytical solution for exponential decay. You will confirm that the method upholds the particle balance principle, where net leakage must equal total absorption within each computational cell.",
            "id": "4233806",
            "problem": "Consider the one-dimensional steady-state neutron transport equation along a single characteristic direction with direction cosine $\\mu$ in a homogeneous planar cell, where the volumetric source is zero. Let the total macroscopic cross section be $\\Sigma_t$, the cell width be $\\Delta x$, and the incoming angular flux at the left boundary be $\\psi_{\\text{in}}$. The Linear Characteristic (LC) spatial discretization integrates the transport equation along the characteristic path through each cell segment. With zero volumetric source, the physical expectation is that the balance is governed purely by leakage and absorption with no in-cell production, and the angular flux attenuates monotonically along the characteristic.\n\nStarting from the steady-state, monoenergetic, one-dimensional, source-free linear Boltzmann transport equation along a characteristic inside a cell,\n$$\n\\mu \\,\\frac{\\partial \\psi(x)}{\\partial x} + \\Sigma_t \\,\\psi(x) = 0,\n$$\nthe LC method constructs directional cell balances by integrating this equation over the path length traversed by a characteristic segment within each cell. In a piecewise-constant medium, the LC method is exact for zero volumetric source. Your task is to implement a program that, for several test cases, verifies two statements:\n- The LC-computed outflow equals the LC-consistent attenuation along the characteristic through each cell.\n- The net leakage in each cell equals the path-integrated absorption in that cell when the volumetric source is zero.\n\nUse a one-dimensional slab geometry with piecewise-constant $\\Sigma_t$ per cell and a single discrete ordinates direction $\\mu$. Let the path length through a cell be $\\ell = \\Delta x / |\\mu|$. For each test case, propagate an incident angular flux $\\psi_{\\text{in}}$ from the left boundary through the sequential cells, computing the outflow from each cell using LC with zero source, and compute the cell absorption by integrating $\\Sigma_t \\,\\psi(s)$ over the characteristic coordinate $s \\in [0,\\ell]$, where $s$ is the path length measured along the characteristic. Verify that the net leakage $\\psi_{\\text{in}} - \\psi_{\\text{out}}$ equals the path integral of $\\Sigma_t \\,\\psi(s)$ for each cell. Additionally, verify that the domain-exit angular flux equals the left-boundary incident angular flux attenuated across the total optical thickness of the domain.\n\nScientific and numerical specifications:\n- Geometry: one-dimensional slab with cells indexed by $i = 1,2,\\dots,N$, each of width $\\Delta x_i$ (in centimeters) and total macroscopic cross section $\\Sigma_{t,i}$ (in inverse centimeters).\n- Direction: a single direction cosine $\\mu$ (dimensionless), with $|\\mu| > 0$.\n- Boundary condition: a single incident angular flux $\\psi_{\\text{in}}$ (dimensionless) at the left boundary of the first cell.\n- Volumetric source: zero in all cells.\n- Units: express all lengths in centimeters (cm) and all cross sections in inverse centimeters ($\\text{cm}^{-1}$). Angular flux is dimensionless. The direction cosine is dimensionless. Angles are not required; the direction cosine $\\mu$ is specified directly.\n- Tolerance: use absolute tolerances specified per test case for equality checks.\n\nYour program must implement the LC propagation through cells for zero source and compute:\n1. The per-cell outflow and absorption along the characteristic.\n2. The per-cell verification that net leakage equals absorption to within the specified absolute tolerance.\n3. The global verification that the exit angular flux equals the incident angular flux attenuated across the total optical thickness of the domain to within the specified absolute tolerance.\n\nTest Suite:\nProvide four test cases that cover a range of behaviors:\n- Test case $1$ (multi-cell, moderate angles and cross sections):\n  - Cells: $\\left[(\\Delta x_1,\\Sigma_{t,1}) = (0.5,0.3), (\\Delta x_2,\\Sigma_{t,2}) = (1.0,1.2), (\\Delta x_3,\\Sigma_{t,3}) = (2.0,0.05)\\right]$.\n  - Direction cosine: $\\mu = 0.8$.\n  - Incident angular flux: $\\psi_{\\text{in}} = 1.0$.\n  - Absolute tolerance: $\\varepsilon = 10^{-12}$.\n- Test case $2$ (single cell, near-grazing direction):\n  - Cells: $\\left[(\\Delta x_1,\\Sigma_{t,1}) = (0.2,2.0)\\right]$.\n  - Direction cosine: $\\mu = 0.01$.\n  - Incident angular flux: $\\psi_{\\text{in}} = 1.0$.\n  - Absolute tolerance: $\\varepsilon = 10^{-14}$.\n- Test case $3$ (multi-cell vacuum streaming):\n  - Cells: $\\left[(\\Delta x_1,\\Sigma_{t,1}) = (1.0,0.0), (\\Delta x_2,\\Sigma_{t,2}) = (3.0,0.0), (\\Delta x_3,\\Sigma_{t,3}) = (0.5,0.0)\\right]$.\n  - Direction cosine: $\\mu = 0.6$.\n  - Incident angular flux: $\\psi_{\\text{in}} = 0.7$.\n  - Absolute tolerance: $\\varepsilon = 10^{-15}$.\n- Test case $4$ (single very-thick, strong attenuation cell):\n  - Cells: $\\left[(\\Delta x_1,\\Sigma_{t,1}) = (100.0,1.0)\\right]$.\n  - Direction cosine: $\\mu = 0.5$.\n  - Incident angular flux: $\\psi_{\\text{in}} = 2.0$.\n  - Absolute tolerance: $\\varepsilon = 10^{-12}$.\n\nFor each test case, return a single boolean indicating whether both the per-cell leakage-equals-absorption checks and the global attenuation check pass within the specified tolerance.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4\\right]$), where each $\\text{result}_k$ is a boolean corresponding to test case $k$.",
            "solution": "The problem requires the verification of fundamental particle balance principles within the context of the Linear Characteristic (LC) spatial discretization method for the one-dimensional, steady-state, source-free neutron transport equation. The analysis is based on the analytical solution to the governing equation, which the LC method reproduces exactly for piecewise-constant media and zero source.\n\nThe governing equation for the angular neutron flux $\\psi(x)$ along a specific characteristic direction with direction cosine $\\mu$ in a homogeneous region with total macroscopic cross section $\\Sigma_t$ and zero volumetric source is:\n$$\n\\mu \\, \\frac{d\\psi(x)}{dx} + \\Sigma_t \\, \\psi(x) = 0\n$$\nSince the problem specifies that the direction cosine $\\mu$ is constant and non-zero, we can transform the spatial variable $x$ to the path length $s$ along the characteristic, where $ds = dx / |\\mu|$. For the cases provided, $\\mu > 0$, so $ds = dx / \\mu$. The transport equation simplifies to a first-order ordinary differential equation in terms of $s$:\n$$\n\\frac{d\\psi(s)}{ds} + \\Sigma_t \\, \\psi(s) = 0\n$$\nFor a single computational cell $i$ with constant properties $\\Sigma_{t,i}$, let the incoming flux at the cell boundary (corresponding to path length $s=0$) be $\\psi_{\\text{in},i}$. The solution to the equation is found by separation of variables:\n$$\n\\psi(s) = \\psi_{\\text{in},i} \\, \\exp(-\\Sigma_{t,i} s)\n$$\nThis equation describes the exponential attenuation of the angular flux along the characteristic path. The path length $\\ell_i$ through a cell of width $\\Delta x_i$ is $\\ell_i = \\Delta x_i / |\\mu|$. For the given test cases where $\\mu > 0$, this is $\\ell_i = \\Delta x_i / \\mu$. The outflowing flux from the cell, $\\psi_{\\text{out},i}$, is the flux at the end of the path, $s=\\ell_i$:\n$$\n\\psi_{\\text{out},i} = \\psi(\\ell_i) = \\psi_{\\text{in},i} \\, \\exp(-\\Sigma_{t,i} \\ell_i) = \\psi_{\\text{in},i} \\, \\exp\\left(-\\frac{\\Sigma_{t,i} \\Delta x_i}{\\mu}\\right)\n$$\nThe problem requires the verification of two statements.\n\nFirst, for each cell, the net leakage must equal the path-integrated absorption.\nThe net leakage, $L_i$, represents the net rate of particles leaving the cell along the characteristic direction. It is the difference between the incoming and outgoing flux:\n$$\nL_i = \\psi_{\\text{in},i} - \\psi_{\\text{out},i}\n$$\nThe absorption rate at a point $s$ along the path is $\\Sigma_{t,i} \\psi(s)$. The total absorption in the cell, $A_i$, is the integral of this rate over the entire path length $\\ell_i$:\n$$\nA_i = \\int_{0}^{\\ell_i} \\Sigma_{t,i} \\, \\psi(s) \\, ds\n$$\nSubstituting the expression for $\\psi(s)$:\n$$\nA_i = \\int_{0}^{\\ell_i} \\Sigma_{t,i} \\, \\psi_{\\text{in},i} \\, \\exp(-\\Sigma_{t,i} s) \\, ds\n$$\nFor $\\Sigma_{t,i} > 0$, the integral evaluates to:\n$$\nA_i = \\Sigma_{t,i} \\, \\psi_{\\text{in},i} \\left[ -\\frac{1}{\\Sigma_{t,i}} \\exp(-\\Sigma_{t,i} s) \\right]_0^{\\ell_i} = -\\psi_{\\text{in},i} \\left( \\exp(-\\Sigma_{t,i} \\ell_i) - \\exp(0) \\right) = \\psi_{\\text{in},i} \\left( 1 - \\exp(-\\Sigma_{t,i} \\ell_i) \\right)\n$$\nRecognizing that $\\psi_{\\text{in},i} \\exp(-\\Sigma_{t,i} \\ell_i) = \\psi_{\\text{out},i}$, we have:\n$$\nA_i = \\psi_{\\text{in},i} - \\psi_{\\text{out},i} = L_i\n$$\nThis confirms analytically that the net leakage equals the path-integrated absorption. For the special case where $\\Sigma_{t,i} = 0$ (a vacuum), the absorption rate is zero everywhere, so $A_i = 0$. The transport equation becomes $d\\psi/ds = 0$, implying $\\psi(s)$ is constant. Therefore, $\\psi_{\\text{out},i} = \\psi_{\\text{in},i}$, and the net leakage $L_i = \\psi_{\\text{in},i} - \\psi_{\\text{out},i} = 0$. The identity $L_i = A_i$ holds for this case as well. The numerical verification requires computing $|L_i - A_i| < \\varepsilon_i$ for each cell $i$ within a specified tolerance $\\varepsilon_i$.\n\nSecond, the global conservation must be verified. The flux exiting the entire domain must equal the initial incident flux attenuated across the total optical thickness of the domain.\nFor a sequence of cells $i = 1, 2, \\ldots, N$, the outflow of one cell becomes the inflow of the next: $\\psi_{\\text{in},i+1} = \\psi_{\\text{out},i}$. The final flux exiting the domain, $\\psi_{\\text{exit}}$, is the outflow from the last cell, $\\psi_{\\text{out},N}$. By repeatedly applying the attenuation formula:\n$$\n\\psi_{\\text{exit}} = \\psi_{\\text{out},N} = \\psi_{\\text{in},N} \\exp\\left(-\\frac{\\Sigma_{t,N} \\Delta x_N}{\\mu}\\right) = \\psi_{\\text{out},N-1} \\exp\\left(-\\frac{\\Sigma_{t,N} \\Delta x_N}{\\mu}\\right) = \\dots\n$$\nThis results in a telescoping product:\n$$\n\\psi_{\\text{exit}} = \\psi_{\\text{in},1} \\prod_{i=1}^{N} \\exp\\left(-\\frac{\\Sigma_{t,i} \\Delta x_i}{\\mu}\\right) = \\psi_{\\text{in},1} \\exp\\left( -\\sum_{i=1}^{N} \\frac{\\Sigma_{t,i} \\Delta x_i}{\\mu} \\right)\n$$\nThe term $\\tau_{\\text{total}} = \\sum_{i=1}^{N} \\Sigma_{t,i} \\Delta x_i$ is the total optical thickness of the domain perpendicular to the slab faces. The argument of the exponential, $\\tau_{\\text{path,total}} = \\tau_{\\text{total}} / \\mu$, is the total optical path length. The expected exit flux is therefore:\n$$\n\\psi_{\\text{exit,analytic}} = \\psi_{\\text{in},1} \\exp\\left(-\\frac{\\tau_{\\text{total}}}{\\mu}\\right)\n$$\nThe global verification check compares the final flux obtained by propagating through each cell sequentially, $\\psi_{\\text{exit,propagated}}$, with this analytical result, ensuring $|\\psi_{\\text{exit,propagated}} - \\psi_{\\text{exit,analytic}}| < \\varepsilon$.\n\nThe algorithm for each test case proceeds as follows:\n$1$. Initialize the incoming flux for the first cell and the total optical thickness.\n$2$. Iterate through each cell of the domain:\n    a. Calculate the cell's optical path length, $\\tau_{\\text{path},i} = \\Sigma_{t,i} \\Delta x_i / \\mu$.\n    b. Compute the outflow, $\\psi_{\\text{out},i} = \\psi_{\\text{in},i} \\exp(-\\tau_{\\text{path},i})$.\n    c. Compute the net leakage $L_i = \\psi_{\\text{in},i} - \\psi_{\\text{out},i}$ and integrated absorption $A_i = \\psi_{\\text{in},i} (1 - \\exp(-\\tau_{\\text{path},i}))$.\n    d. Verify that $|L_i - A_i| < \\varepsilon$. If this fails, the test case fails.\n    e. Set the inflow for the next cell, $\\psi_{\\text{in},i+1} = \\psi_{\\text{out},i}$.\n    f. Accumulate the optical thickness $\\Sigma_{t,i} \\Delta x_i$.\n$3$. After iterating through all cells, perform the global check by comparing the final propagated flux with the flux calculated using the total accumulated optical thickness.\nA test case passes only if all per-cell checks and the final global check are satisfied.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Linear Characteristic method verification.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"id\": 1,\n            \"cells\": [(0.5, 0.3), (1.0, 1.2), (2.0, 0.05)],  # (dx_i, sigma_t_i)\n            \"mu\": 0.8,\n            \"psi_in\": 1.0,\n            \"epsilon\": 1e-12,\n        },\n        {\n            \"id\": 2,\n            \"cells\": [(0.2, 2.0)],\n            \"mu\": 0.01,\n            \"psi_in\": 1.0,\n            \"epsilon\": 1e-14,\n        },\n        {\n            \"id\": 3,\n            \"cells\": [(1.0, 0.0), (3.0, 0.0), (0.5, 0.0)],\n            \"mu\": 0.6,\n            \"psi_in\": 0.7,\n            \"epsilon\": 1e-15,\n        },\n        {\n            \"id\": 4,\n            \"cells\": [(100.0, 1.0)],\n            \"mu\": 0.5,\n            \"psi_in\": 2.0,\n            \"epsilon\": 1e-12,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_test_case(\n            case[\"cells\"], case[\"mu\"], case[\"psi_in\"], case[\"epsilon\"]\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_test_case(cells, mu, psi_in_initial, epsilon):\n    \"\"\"\n    Runs a single test case for the LC verification.\n\n    Args:\n        cells (list of tuples): Each tuple is (dx, sigma_t) for a cell.\n        mu (float): The direction cosine.\n        psi_in_initial (float): The incident angular flux at the domain left boundary.\n        epsilon (float): The absolute tolerance for checks.\n\n    Returns:\n        bool: True if all checks pass, False otherwise.\n    \"\"\"\n    current_psi_in = psi_in_initial\n    total_optical_thickness = 0.0  # Sum of Sigma_t * dx\n    all_checks_pass = True\n\n    # Per-cell propagation and verification\n    for dx, sigma_t in cells:\n        # Path length through the cell for the given direction cosine\n        # Note: problem statement ensures mu > 0, so abs(mu) is not needed.\n        path_length = dx / mu\n        \n        # Optical path length for the cell\n        optical_path_length = sigma_t * path_length\n\n        # Calculate outflow using the exact analytical solution\n        # for a source-free characteristic segment.\n        psi_out = current_psi_in * np.exp(-optical_path_length)\n\n        # 1. Per-cell leakage-absorption balance check\n        net_leakage = current_psi_in - psi_out\n        \n        # The integrated absorption can be calculated analytically.\n        # It's important to handle the sigma_t = 0 case to avoid division by zero\n        # if using the integral form directly. The derived form is safe.\n        # absorption = psi_in * (1 - exp(-optical_path))\n        # np.expm1(-x) is more accurate than 1 - np.exp(-x) for small x,\n        # but 1 - np.exp(-x) is fine for large x as in cases 2 and 4.\n        # Direct form is clearer and sufficient here.\n        if sigma_t == 0.0:\n            absorption = 0.0\n        else:\n            absorption = current_psi_in * (1.0 - np.exp(-optical_path_length))\n\n        if np.abs(net_leakage - absorption) >= epsilon:\n            all_checks_pass = False\n            break # Exit loop early on failure\n\n        # Prepare for the next cell\n        current_psi_in = psi_out\n        total_optical_thickness += sigma_t * dx\n    \n    if not all_checks_pass:\n        return False\n\n    # 2. Global attenuation check\n    # The final propagated flux is the last value of current_psi_in\n    final_psi_out_propagated = current_psi_in\n    \n    # Calculate expected final flux based on total domain optical thickness\n    total_optical_path = total_optical_thickness / mu\n    final_psi_out_expected = psi_in_initial * np.exp(-total_optical_path)\n\n    if np.abs(final_psi_out_propagated - final_psi_out_expected) >= epsilon:\n        all_checks_pass = False\n\n    return all_checks_pass\n\nsolve()\n```"
        },
        {
            "introduction": "While the LC method is powerful, it is crucial to understand its place among other common discretization schemes. This practice  involves a comparative analysis of LC, the Step Characteristic (SC), and the widely-used Diamond Difference (DD) method. By implementing these schemes, you will gain insight into their relative accuracy and inherent properties, particularly the concept of numerical monotonicity and why characteristic-based methods are often preferred.",
            "id": "4233836",
            "problem": "Consider a one-dimensional slab cell of width $\\Delta$ (in $\\mathrm{cm}$), with material total macroscopic cross section $\\Sigma_t$ (in $\\mathrm{cm}^{-1}$), and a uniform isotropic volumetric source density $Q$ (in $\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$). Along a single discrete-ordinates direction characterized by the direction cosine $\\mu \\in (0,1]$, the steady-state linear Boltzmann transport equation reduces to the one-dimensional ordinary differential equation\n$$\n\\mu \\,\\frac{d \\psi(x)}{dx} + \\Sigma_t \\,\\psi(x) = q(x),\n$$\nwhere $\\psi(x)$ is the angular flux (in $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$) and $q(x)$ is the angular source (in $\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$). For an isotropic source density $Q$, the angular source is $q(x) = Q/2$ throughout the cell. A vacuum boundary is imposed at the left boundary $x = 0$, so that the incoming angular flux is $\\psi(0) = 0$ for directions with $\\mu > 0$. The goal is to compute the outgoing angular flux at the right boundary $x = \\Delta$, denoted $\\psi(\\Delta)$, using three different spatial discretizations:\n\n- Step Characteristic (SC): Treat the source as constant in the cell and integrate the characteristic exactly under that assumption.\n- Diamond Difference (DD): Use a linear approximation to the flux within the cell and a centered discretization of the streaming term.\n- Linear Characteristic (LC): Treat the source as linearly varying across the cell and integrate the characteristic exactly for a linear source representation.\n\nStarting from the stated transport equation and boundary condition, derive the update relations for a single cell that map the incoming boundary flux at $x = 0$ and the cell source representation to the outgoing boundary flux at $x = \\Delta$ for the SC, DD, and LC schemes. For LC, consider a general linear source parameterization $q(x) = q_L + \\left(\\frac{x}{\\Delta}\\right)(q_R - q_L)$, and then specialize to the uniform source case $q_L = q_R = Q/2$ to match the physical setup. For each scheme, express the outgoing angular flux $\\psi(\\Delta)$ in $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$.\n\nDefine the optical thickness $\\tau$ by $\\tau = \\Sigma_t \\Delta / \\mu$. Use this parameter to analyze the monotonicity of the outgoing flux with respect to the incoming flux for each scheme. In particular, determine whether $\\frac{\\partial \\psi(\\Delta)}{\\partial \\psi(0)} \\ge 0$ holds for each scheme, and report the monotonicity as a boolean value for the Diamond Difference scheme by checking whether the sensitivity with respect to $\\psi(0)$ is nonnegative.\n\nImplement a complete program that computes the outgoing angular flux for each scheme and the Diamond Difference monotonicity boolean for the following test suite. Use the vacuum boundary condition $\\psi(0) = 0$ for all cases. Express all outgoing angular fluxes in $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$, rounded to six decimal places.\n\nTest suite parameters:\n- Case $1$ (general case with moderate optical thickness): $\\mu = 1$, $\\Delta = 1\\,\\mathrm{cm}$, $\\Sigma_t = 0.5\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$.\n- Case $2$ (boundary of monotonicity for Diamond Difference): $\\mu = 1$, $\\Delta = 2\\,\\mathrm{cm}$, $\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$.\n- Case $3$ (large optical thickness): $\\mu = 0.2$, $\\Delta = 1\\,\\mathrm{cm}$, $\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$.\n- Case $4$ (small optical thickness limit): $\\mu = 1$, $\\Delta = 10^{-6}\\,\\mathrm{cm}$, $\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list of four entries in the order $[\\psi_{\\mathrm{SC}}(\\Delta), \\psi_{\\mathrm{DD}}(\\Delta), \\psi_{\\mathrm{LC}}(\\Delta), \\text{DD\\_monotone}]$. For example, the output should look like $[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3],[a_4,b_4,c_4,d_4]]$, where each $a_i$, $b_i$, $c_i$ is a float rounded to six decimals in the unit $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$ and each $d_i$ is a boolean.",
            "solution": "The user has provided a valid, well-posed problem statement from the field of nuclear reactor physics, specifically concerning the spatial discretization of the one-dimensional, steady-state, monoenergetic linear Boltzmann transport equation. The problem is scientifically grounded, objective, and contains all necessary information to derive the requested numerical schemes and compute the results for the given test cases.\n\nThe governing ordinary differential equation for the angular flux $\\psi(x)$ along a discrete direction $\\mu \\in (0,1]$ in a slab of width $\\Delta$ is given by:\n$$ \\mu \\frac{d\\psi(x)}{dx} + \\Sigma_t \\psi(x) = q(x) $$\nwhere $\\Sigma_t$ is the total macroscopic cross section, and $q(x)$ is the angular source. For a uniform, isotropic volumetric source $Q$, the angular source is constant: $q(x) = Q/2$. The boundary condition at $x=0$ is $\\psi(0) = 0$. We aim to find the outgoing flux $\\psi(\\Delta)$ using three different schemes.\n\nFirst, we establish a general analytical framework by solving the ODE. Rearranging the equation gives:\n$$ \\frac{d\\psi(x)}{dx} + \\frac{\\Sigma_t}{\\mu} \\psi(x) = \\frac{q(x)}{\\mu} $$\nThis is a first-order linear ODE. We can solve it using an integrating factor $I(x) = \\exp\\left(\\int \\frac{\\Sigma_t}{\\mu} dx\\right) = \\exp\\left(\\frac{\\Sigma_t x}{\\mu}\\right)$. Multiplying the ODE by $I(x)$ and integrating from $x=0$ to $x=\\Delta$ yields the formal solution:\n$$ \\psi(\\Delta)e^{\\frac{\\Sigma_t \\Delta}{\\mu}} - \\psi(0)e^0 = \\int_0^\\Delta \\frac{q(x')}{\\mu} e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\nSolving for $\\psi(\\Delta)$ and introducing the cell optical thickness $\\tau = \\frac{\\Sigma_t \\Delta}{\\mu}$, we have:\n$$ \\psi(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{e^{-\\tau}}{\\mu} \\int_0^\\Delta q(x') e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\nThis formal solution is the foundation for the characteristic-based methods.\n\n**1. Step Characteristic (SC) Scheme**\n\nThe Step Characteristic scheme assumes the source term is constant across the cell, i.e., $q(x) = \\bar{q}$. For the given problem, the source is physically constant, $q(x) = Q/2$, so we set $\\bar{q} = Q/2$. Substituting this into the integral of the formal solution:\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{e^{-\\tau}}{\\mu} \\int_0^\\Delta \\frac{Q}{2} e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Qe^{-\\tau}}{2\\mu} \\left[ \\frac{\\mu}{\\Sigma_t} e^{\\frac{\\Sigma_t x'}{\\mu}} \\right]_0^\\Delta $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Qe^{-\\tau}}{2\\Sigma_t} \\left( e^{\\frac{\\Sigma_t \\Delta}{\\mu}} - 1 \\right) $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Q}{2\\Sigma_t} \\left( 1 - e^{-\\tau} \\right) $$\nSince the SC assumption matches the physical reality of a constant source, this scheme yields the exact analytical solution for this problem. The sensitivity to the incoming flux is $\\frac{\\partial \\psi_{SC}(\\Delta)}{\\partial \\psi(0)} = e^{-\\tau}$. As $\\tau > 0$, this sensitivity is always positive, meaning the scheme is unconditionally monotonic.\n\n**2. Diamond Difference (DD) Scheme**\n\nThe Diamond Difference scheme is derived by integrating the transport equation over the cell width $\\Delta$:\n$$ \\int_0^\\Delta \\left( \\mu \\frac{d\\psi}{dx} + \\Sigma_t \\psi(x) \\right) dx = \\int_0^\\Delta q(x) dx $$\n$$ \\mu[\\psi(\\Delta) - \\psi(0)] + \\Sigma_t \\Delta \\bar{\\psi} = \\Delta \\bar{q} $$\nwhere $\\bar{\\psi}$ and $\\bar{q}$ are the cell-averaged flux and source. The DD scheme employs a linear approximation for the flux, which implies the closure relation $\\bar{\\psi} = \\frac{\\psi(0) + \\psi(\\Delta)}{2}$. For the constant source, $\\bar{q} = Q/2$. Substituting these into the balance equation:\n$$ \\mu[\\psi(\\Delta) - \\psi(0)] + \\Sigma_t \\Delta \\frac{\\psi(0) + \\psi(\\Delta)}{2} = \\Delta \\frac{Q}{2} $$\nTo solve for $\\psi(\\Delta)$, we divide by $\\mu$ and use $\\tau = \\Sigma_t \\Delta / \\mu$:\n$$ [\\psi(\\Delta) - \\psi(0)] + \\tau \\frac{\\psi(0) + \\psi(\\Delta)}{2} = \\frac{\\tau Q}{2\\Sigma_t} $$\nGrouping terms for $\\psi(\\Delta)$ and $\\psi(0)$:\n$$ \\psi(\\Delta) \\left(1 + \\frac{\\tau}{2}\\right) = \\psi(0) \\left(1 - \\frac{\\tau}{2}\\right) + \\frac{\\tau Q}{2\\Sigma_t} $$\n$$ \\psi_{DD}(\\Delta) = \\frac{1 - \\tau/2}{1 + \\tau/2} \\psi(0) + \\frac{\\tau Q / (2\\Sigma_t)}{1 + \\tau/2} = \\frac{2-\\tau}{2+\\tau}\\psi(0) + \\frac{\\tau Q}{\\Sigma_t(2+\\tau)} $$\nThe sensitivity to the incoming flux is $\\frac{\\partial \\psi_{DD}(\\Delta)}{\\partial \\psi(0)} = \\frac{2-\\tau}{2+\\tau}$. For this to be non-negative, and since $2+\\tau > 0$ for physical problems, we require $2-\\tau \\ge 0$. Thus, the DD scheme is monotonic if and only if $\\tau \\le 2$.\n\n**3. Linear Characteristic (LC) Scheme**\n\nThe Linear Characteristic scheme starts from the same formal solution as SC but assumes a linearly varying source: $q(x) = q_L + \\frac{x}{\\Delta}(q_R - q_L)$. The problem requires specializing this to the uniform source case, where $q_L = q_R = Q/2$. This substitution makes the source term constant, $q(x) = Q/2$, which is a zero-degree polynomial and thus a special case of a linear function. The derivation becomes identical to the Step Characteristic case:\n$$ \\psi_{LC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Q}{2\\Sigma_t} \\left( 1 - e^{-\\tau} \\right) $$\nAs with SC, the LC scheme is exact for this problem and is unconditionally monotonic since $\\frac{\\partial \\psi_{LC}(\\Delta)}{\\partial \\psi(0)} = e^{-\\tau} > 0$.\n\n**Summary of Formulas for Implementation**\n\nFor all cases, the boundary condition is $\\psi(0) = 0$. The optical thickness is $\\tau = \\frac{\\Sigma_t \\Delta}{\\mu}$.\n-   **SC Flux**: $\\psi_{SC}(\\Delta) = \\frac{Q}{2\\Sigma_t} (1 - e^{-\\tau})$. This can be rewritten for numerical stability as $\\tau \\to 0$ as $\\psi_{SC}(\\Delta) = \\frac{Q\\Delta}{2\\mu} \\frac{1-e^{-\\tau}}{\\tau}$.\n-   **DD Flux**: $\\psi_{DD}(\\Delta) = \\frac{\\tau Q}{\\Sigma_t(2+\\tau)}$. This can be rewritten as $\\psi_{DD}(\\Delta) = \\frac{Q\\Delta}{\\mu(2+\\tau)}$.\n-   **LC Flux**: $\\psi_{LC}(\\Delta) = \\frac{Q}{2\\Sigma_t} (1 - e^{-\\tau})$, same as SC.\n-   **DD Monotonicity**: A boolean value indicating if $\\tau \\le 2$.\n\nThese formulas are used to compute the results for the provided test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes outgoing angular flux for SC, DD, and LC schemes and checks\n    DD monotonicity for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (mu, delta, sigma_t, Q)\n        (1.0, 1.0, 0.5, 1.0),\n        (1.0, 2.0, 1.0, 1.0),\n        (0.2, 1.0, 1.0, 1.0),\n        (1.0, 1.0e-6, 1.0, 1.0),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        mu, delta, sigma_t, Q = case\n\n        # Calculate optical thickness\n        # This is guaranteed to be non-zero for the given test cases.\n        tau = sigma_t * delta / mu\n\n        # --- SC and LC Scheme ---\n        # The SC and LC schemes are identical and exact for a constant source.\n        # psi_sc_lc = (Q / (2 * sigma_t)) * (1 - np.exp(-tau))\n        # This form is numerically unstable as sigma_t -> 0 (and tau -> 0).\n        # A more stable form is derived by substituting sigma_t = tau * mu / delta:\n        # psi_sc_lc = (Q * delta / (2 * mu)) * (1 - exp(-tau)) / tau\n        # We use np.expm1 for precision with small tau.\n        # -expm1(-x) is equivalent to 1-exp(-x) but more accurate for small x.\n        if tau == 0.0:\n            # This is the streaming limit as tau -> 0\n            psi_sc_lc = (Q * delta) / (2 * mu)\n        else:\n            psi_sc_lc = (Q * delta / (2 * mu)) * (-np.expm1(-tau) / tau)\n        \n        psi_sc = psi_sc_lc\n        psi_lc = psi_sc_lc\n\n        # --- DD Scheme ---\n        # psi_dd = (tau * Q) / (sigma_t * (2 + tau))\n        # A more stable form is derived by substituting tau/sigma_t = delta/mu:\n        psi_dd = (Q * delta / mu) / (2 + tau)\n\n        # --- DD Monotonicity ---\n        # The scheme is monotonic if tau <= 2.\n        dd_monotone = (tau <= 2)\n\n        # Append results for the current case\n        all_results.append([psi_sc, psi_dd, psi_lc, dd_monotone])\n\n    # Format the final output string as per the problem specification.\n    # The output must be a single line, representing a list of lists.\n    # Each sub-list contains three floats rounded to 6 decimal places and a boolean.\n    output_parts = []\n    for res in all_results:\n        # str(res[3]) will correctly produce 'True' or 'False'\n        part = f\"[{res[0]:.6f},{res[1]:.6f},{res[2]:.6f},{str(res[3])}]\"\n        output_parts.append(part)\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Ensuring a numerical code is free of bugs and correctly implemented is a critical skill in computational science. This final exercise  introduces the Method of Manufactured Solutions (MMS), a powerful and standard technique for rigorous code verification. You will construct a problem with a known, non-trivial analytical solution to precisely measure the convergence and error of your LC implementation, transitioning from understanding the method to verifying its correctness.",
            "id": "4233777",
            "problem": "Consider the steady-state, monoenergetic, one-dimensional neutron transport equation in slab geometry, where the unknown angular flux $\\,\\psi(x,\\mu)\\,$ satisfies\n$$\n\\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu) = q(x,\\mu),\n$$\nwith spatial coordinate $\\,x\\in[0,L]\\,$, direction cosine $\\,\\mu\\in\\{-1,+1\\}\\,$, total macroscopic cross-section $\\,\\Sigma_t(x)\\,$ in $\\,$m$^{-1}$, and angular source $\\,q(x,\\mu)\\,$ in consistent units. The boundary conditions impose prescribed incoming angular flux at the inflow boundaries:\n$$\n\\psi(0,+1) = \\psi_{\\text{in}}^+(0),\\quad \\psi(L,-1) = \\psi_{\\text{in}}^-(L).\n$$\n\nA manufactured-solution approach is used to define a known reference solution $\\,\\psi(x,\\mu)\\,$ and deduce the source $\\,q(x,\\mu)\\,$ and the cross-section $\\,\\Sigma_t(x)\\,$ so that the transport equation holds identically. The goal is to implement a linear characteristic (LC) spatial discretization and quantify its error compared to the manufactured solution.\n\nThe manufactured angular flux is chosen as\n$$\n\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\,\\sin(\\pi x),\n$$\nwith $\\,x\\,$ in meters and $\\,\\mu\\in\\{-1,+1\\}\\,$. Let the total macroscopic cross-section be piecewise constant per spatial cell, defined from a smooth profile\n$$\n\\Sigma_t(x) = \\Sigma_0\\,(1+\\alpha x),\n$$\nbut taken as a constant within each cell equal to the value at the cell center. The corresponding manufactured source that makes the transport equation hold is\n$$\nq(x,\\mu) = \\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu),\n$$\nwhere the derivative is\n$$\n\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\,\\pi\\cos(\\pi x).\n$$\n\nImplement the LC method on a uniform mesh of $\\,N\\,$ cells covering $\\,x\\in[0,L]\\,$, with cell edges at $\\,x_i = i\\,h\\,$ for $\\,i=0,1,\\dots,N\\,$ and cell width $\\,h = L/N\\,$. For each cell $\\,i\\,$, approximate the angular source $\\,q(x,\\mu)\\,$ by a linear function in the local coordinate $\\,s\\in[0,h]\\,$ measured from the upstream edge for the direction $\\,\\mu\\,$:\n$$\nq_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s,\n$$\nconstructed by linearly interpolating between the exact source values at the two edges using the per-cell constant cross-section $\\,\\Sigma_{t,i}=\\Sigma_t(x_{i+\\frac{1}{2}})\\,$, where $\\,x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2\\,$. Specifically, define the slope\n$$\n\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h},\n$$\nand set\n$$\nq_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i}),\\quad q_{i,1}^{(+1)} = \\Delta q_i^{(+1)},\n$$\n$$\nq_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i}),\\quad q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}.\n$$\nFor clarity, $\\,q(x,\\mu;\\Sigma_{t,i})\\,$ denotes the manufactured source evaluated with the per-cell constant cross-section $\\,\\Sigma_{t,i}\\,$.\n\nWithin each cell, the LC method advances the angular flux from the upstream edge over a distance $\\,d\\in[0,h]\\,$ using the exact solution of the linear ordinary differential equation with constant $\\,\\Sigma_{t,i}\\,$ and linear source $\\,q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s\\,$. For $\\,\\Sigma_{t,i}\\neq 0\\,$,\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right).\n$$\nFor the pure streaming limit $\\,\\Sigma_{t,i} = 0\\,$,\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}\\,d + \\frac{1}{2}\\,q_{i,1}^{(\\mu)}\\,d^2.\n$$\n\nUse the manufactured inflow boundary conditions, which follow from the chosen $\\,\\psi(x,\\mu)\\,$:\n$$\n\\psi(0,+1) = 2,\\quad \\psi(L,-1) = 2.\n$$\nMarch cell by cell in the $\\,\\mu=+1\\,$ direction from $\\,x=0\\,$ to $\\,x=L\\,$ and in the $\\,\\mu=-1\\,$ direction from $\\,x=L\\,$ to $\\,x=0\\,$. Record the LC-approximated angular flux at each cell center by setting $\\,d = h/2\\,$ measured from the appropriate upstream edge. Compare the LC-approximated center values to the manufactured exact center values $\\,\\psi(x_{i+\\frac{1}{2}},\\mu)\\,$ and compute the root-mean-square (RMS) error over both directions and all cell centers:\n$$\n\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}.\n$$\n\nYour program must implement the above procedure and produce numerical values of $\\,\\varepsilon_{\\text{RMS}}\\,$ for the following five test cases, expressed as dimensionless floats. The spatial length $\\,L\\,$ must be expressed in meters ($\\,\\mathrm{m}\\,$) and the total macroscopic cross-section parameters in inverse meters ($\\,\\mathrm{m}^{-1}\\,$). The test suite is:\n- Case A (happy path): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- Case B (single cell boundary condition check): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 1\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- Case C (strong attenuation): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 10.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.0\\,$.\n- Case D (refinement for convergence behavior): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 200\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- Case E (pure streaming limit): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 0.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.0\\,$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $\\,\\left[\\varepsilon_A,\\varepsilon_B,\\varepsilon_C,\\varepsilon_D,\\varepsilon_E\\right]\\,$, where each entry is the RMS error for the corresponding case.",
            "solution": "The user has provided a problem that requires the implementation and verification of a linear characteristic (LC) spatial discretization for the steady-state, monoenergetic, one-dimensional neutron transport equation. The verification is to be performed using the method of manufactured solutions (MMS).\n\n### Step 1: Extract Givens\n\n-   **Governing Equation**: $\\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu) = q(x,\\mu)$\n-   **Domain**: Spatial coordinate $x \\in [0,L]$, direction cosine $\\mu \\in \\{-1, +1\\}$.\n-   **Manufactured Angular Flux**: $\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\,\\sin(\\pi x)$.\n-   **Manufactured Cross-Section Profile**: $\\Sigma_t(x) = \\Sigma_0\\,(1+\\alpha x)$.\n-   **Discretized Cross-Section**: For cell $i$, $\\Sigma_{t,i}$ is constant, evaluated at the cell center: $\\Sigma_{t,i} = \\Sigma_t(x_{i+\\frac{1}{2}})$.\n-   **Manufactured Source Definition**: $q(x,\\mu) = \\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu)$, with $\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\,\\pi\\cos(\\pi x)$.\n-   **Boundary Conditions**: $\\psi(0,+1) = \\psi_{\\text{in}}^+(0)$, $\\psi(L,-1) = \\psi_{\\text{in}}^-(L)$. Derived from the manufactured solution: $\\psi(0,+1) = 2$ and $\\psi(L,-1) = 2$.\n-   **Spatial Discretization**: Uniform mesh of $N$ cells over $[0,L]$. Cell width $h = L/N$. Cell edges $x_i = i\\,h$. Cell center $x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2$.\n-   **Linear Source Approximation within Cell $i$**: $q_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s$, where $s$ is the local coordinate from the upstream edge.\n    -   The source approximation uses the per-cell constant cross-section $\\Sigma_{t,i}$.\n    -   Slope: $\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h}$.\n    -   Coefficients for $\\mu=+1$: $q_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i})$, $q_{i,1}^{(+1)} = \\Delta q_i^{(+1)}$.\n    -   Coefficients for $\\mu=-1$: $q_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i})$, $q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}$.\n-   **Linear Characteristic (LC) Propagator**:\n    -   For $\\Sigma_{t,i} \\neq 0$: $\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right)$.\n    -   For $\\Sigma_{t,i} = 0$: $\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}\\,d + \\frac{1}{2}\\,q_{i,1}^{(\\mu)}\\,d^2$.\n-   **Numerical Evaluation**: The LC-approximated flux is to be calculated at each cell center, which corresponds to propagating over a distance $d = h/2$ from the upstream edge.\n-   **Error Metric**: Root-Mean-Square (RMS) error: $\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}$.\n-   **Test Cases**:\n    -   Case A: $L=1.0, N=40, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case B: $L=1.0, N=1, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case C: $L=1.0, N=40, \\Sigma_0=10.0, \\alpha=0.0$.\n    -   Case D: $L=1.0, N=200, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case E: $L=1.0, N=40, \\Sigma_0=0.0, \\alpha=0.0$.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientific Grounding**: The problem is grounded in the well-established field of neutron transport theory. The one-dimensional, steady-state, monoenergetic transport equation is a standard model. The method of manufactured solutions is a rigorous and widely used technique for code verification. The linear characteristic method is a known, valid numerical scheme. All formulas and concepts are standard in computational reactor physics.\n-   **Well-Posedness**: The problem is well-posed. The governing ODE, combined with the inflow boundary conditions, defines a unique solution. The numerical method is explicitly defined, including the discretization of the cross-section and source term, the propagation algorithm, and the error calculation. The test cases are well-defined and cover various physical regimes.\n-   **Objectivity**: The problem is stated in precise, objective, mathematical language. There are no subjective or ambiguous terms.\n-   **Consistency and Completeness**: The problem is self-contained. All necessary equations, parameters, and procedures are provided. The givens are internally consistent. For example, the boundary conditions are correctly derived from the manufactured solution at the specified boundaries. The discretization of the source term is defined with sufficient clarity to avoid ambiguity. The formulas for the LC propagator correctly represent the analytical solution of the underlying ODE for a linear source and constant coefficients.\n\n### Step 3: Verdict and Action\n\nThe problem statement is valid. It is a well-defined numerical methods exercise with clear instructions and verifiable goals. I will proceed with the solution.\n\n### Implementation Strategy\n\nThe solution is architected around a main function that orchestrates the numerical simulation for a given set of physical and numerical parameters. This function implements the transport sweep algorithm, a cornerstone of solving the Boltzmann transport equation. The algorithm proceeds direction by direction.\n\nFirst, for the positive direction ($\\mu=+1$), the domain is traversed from left to right ($x=0$ to $x=L$). The angular flux at the left boundary is known. This known flux serves as the incoming flux for the first spatial cell. The linear characteristic (LC) method is then applied to propagate the solution across the cell. The LC method relies on the analytical solution of the transport equation under the assumption of a piecewise constant cross-section and a piecewise linear source. The problem rigorously specifies how to obtain these piecewise approximations from the given continuous manufactured profiles.\n\nSpecifically, within each cell $i$, the following steps are performed:\n1.  The constant cross-section $\\Sigma_{t,i}$ is determined by evaluating the continuous profile $\\Sigma_t(x)$ at the cell's midpoint $x_{i+1/2}$.\n2.  The linear source approximation $q_i(s,+1) \\approx q_{i,0}^{(+1)} + q_{i,1}^{(+1)} s$ is constructed. The coefficients are determined by evaluating the manufactured source function (using the just-computed $\\Sigma_{t,i}$) at the cell edges $x_i$ and $x_{i+1}$ and performing linear interpolation.\n3.  The LC propagation formula is invoked twice. First, to compute the flux at the cell center ($d=h/2$), which is stored for the final error calculation. Second, to compute the flux at the cell's exit face ($d=h$), which becomes the known incoming flux for the next cell, $i+1$.\n\nThis process repeats for all cells, completing the sweep for $\\mu=+1$.\n\nNext, a similar process is executed for the negative direction ($\\mu=-1$). This sweep proceeds from right to left ($x=L$ to $x=0$). The known incoming flux at the right boundary initializes the process. For each cell, the source is again linearized based on its values at the cell edges (using the appropriate cell-constant $\\Sigma_{t,i}$), and the LC formulas propagate the solution from the upstream edge (now the right edge, $x_{i+1}$) to the cell center and then to the downstream edge ($x_i$).\n\nAfter both sweeps are complete, the numerically computed flux values at all cell centers for both directions are available. The root-mean-square (RMS) error is then calculated by comparing these numerical values to the exact manufactured solution evaluated at the same cell center locations. This RMS error quantifies the accuracy of the LC discretization for the given problem parameters.\n\nHelper functions are designed to encapsulate the mathematical definitions of the manufactured solution, its derivative, and the source term. A dedicated function for the LC propagator handles the two cases: non-zero cross-section ($\\Sigma_{t,i} \\neq 0$) and the pure streaming limit ($\\Sigma_{t,i}=0$), directly implementing the formulas provided in the problem statement. This modular design enhances clarity and correctness.\n\nThe entire process is repeated for each of the five test cases defined in the problem, and the resulting RMS errors are collected for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef psi_manufactured(x, mu):\n    \"\"\"Calculates the manufactured angular flux psi(x, mu).\"\"\"\n    return 2.0 + np.sin(2.0 * np.pi * x) + mu * np.sin(np.pi * x)\n\ndef dpsi_dx_manufactured(x, mu):\n    \"\"\"Calculates the derivative of the manufactured flux, dpsi/dx.\"\"\"\n    return 2.0 * np.pi * np.cos(2.0 * np.pi * x) + mu * np.pi * np.cos(np.pi * x)\n\ndef q_manufactured(x, mu, sigma_val):\n    \"\"\"\n    Calculates the manufactured source q(x, mu) for a given constant \n    cross-section value.\n    \"\"\"\n    psi_val = psi_manufactured(x, mu)\n    dpsi_dx_val = dpsi_dx_manufactured(x, mu)\n    return mu * dpsi_dx_val + sigma_val * psi_val\n\ndef lc_propagate(psi_in, q0, q1, sigma, d):\n    \"\"\"\n    Propagates the angular flux across a distance d using the Linear\n    Characteristic method.\n    \"\"\"\n    if sigma == 0.0:\n        # Pure streaming case\n        return psi_in + q0 * d + 0.5 * q1 * d**2\n    else:\n        # Case with non-zero cross-section\n        exp_term = np.exp(-sigma * d)\n        \n        # To avoid catastrophic cancellation for small sigma*d, one could use\n        # Taylor expansions or functions like expm1, but direct implementation\n        # is sufficient for the given problem parameters.\n        psi_out = (\n            psi_in * exp_term\n            + (q0 / sigma) * (1.0 - exp_term)\n            + q1 * (d / sigma - (1.0 - exp_term) / sigma**2)\n        )\n        return psi_out\n\ndef calculate_rms_error(L, N, Sigma0, alpha):\n    \"\"\"\n    Implements the full LC transport sweep and computes the RMS error against\n    the manufactured solution.\n    \"\"\"\n    h = L / N\n    x_edges = np.linspace(0.0, L, N + 1)\n    x_centers = x_edges[:-1] + h / 2\n    \n    total_squared_error = 0.0\n\n    # Sweep for mu = +1 (forward)\n    mu = 1.0\n    psi_edge = psi_manufactured(0.0, mu)  # Inflow boundary condition at x=0\n\n    for i in range(N):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi, downstream is xi1\n        q_up = q_manufactured(xi, mu, sigma_ti)\n        q_down = q_manufactured(xi1, mu, sigma_ti)\n        q0 = q_up\n        q1 = (q_down - q_up) / h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n\n    # Sweep for mu = -1 (backward)\n    mu = -1.0\n    psi_edge = psi_manufactured(L, mu)  # Inflow boundary condition at x=L\n\n    for i in range(N - 1, -1, -1):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi1, downstream is xi\n        q_up = q_manufactured(xi1, mu, sigma_ti)\n        q_down = q_manufactured(xi, mu, sigma_ti)\n        q0 = q_up # Per problem spec, q0 is at upstream edge\n        q1 = (q_down - q_up) / h # -(q_up - q_down)/h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n        \n    rms_error = np.sqrt(total_squared_error / (2.0 * N))\n    return rms_error\n\ndef solve():\n    \"\"\"\n    Defines and runs the test cases, then prints the results in the\n    specified format.\n    \"\"\"\n    test_cases = [\n        # Case A: happy path\n        (1.0, 40, 1.0, 0.5),\n        # Case B: single cell boundary condition check\n        (1.0, 1, 1.0, 0.5),\n        # Case C: strong attenuation\n        (1.0, 40, 10.0, 0.0),\n        # Case D: refinement for convergence behavior\n        (1.0, 200, 1.0, 0.5),\n        # Case E: pure streaming limit\n        (1.0, 40, 0.0, 0.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        L, N, Sigma0, alpha = params\n        error = calculate_rms_error(L, N, Sigma0, alpha)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}