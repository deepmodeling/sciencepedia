{
    "hands_on_practices": [
        {
            "introduction": "To truly master the Linear Characteristic (LC) method, we must begin with its fundamental implementation in a general geometry. This exercise  guides you through the essential steps of applying the LC scheme within a single three-dimensional tetrahedral cell, from calculating barycentric coordinates to integrating the transport equation with a linearly varying source. This foundational practice will build your intuition for how the method operates on unstructured meshes.",
            "id": "4233766",
            "problem": "Consider a one-group, steady-state neutron transport along a straight characteristic within a single tetrahedral cell of a three-dimensional unstructured mesh. In the Method of Characteristics (MOC), assume the total macroscopic cross section is constant within the cell and denote it by $\\Sigma_{t}$. The angular flux $\\,\\psi(s)\\,$ along the characteristic parameterized by the arc-length coordinate $\\,s\\in[0,\\ell]\\,$ satisfies the fundamental linear ordinary differential equation derived from the linear Boltzmann transport equation along a straight path,\n$$\n\\frac{d\\psi}{ds} + \\Sigma_{t}\\,\\psi = q(s),\n$$\nwhere $\\,q(s)\\,$ is the isotropic source along the segment inside the tetrahedron. Adopt the linear characteristic spatial discretization: the source is approximated as a linear function in space within the cell by interpolating nodal source coefficients attached to the cell’s vertices via barycentric coordinates.\n\nYou are given the tetrahedron vertices in Cartesian coordinates:\n$$\n\\mathbf{v}_{1}=(0,0,0),\\quad \\mathbf{v}_{2}=(1,0,0),\\quad \\mathbf{v}_{3}=(0,1,0),\\quad \\mathbf{v}_{4}=(0,0,1).\n$$\nA characteristic ray enters the tetrahedron at\n$$\n\\mathbf{r}_{\\mathrm{in}}=(0.1,\\,0.2,\\,0.1)\n$$\nand exits at\n$$\n\\mathbf{r}_{\\mathrm{out}}=(0.2,\\,0.3,\\,0.15).\n$$\nLet the nodal source coefficients (scalars associated with the vertices) be\n$$\nS_{1}=0.4,\\quad S_{2}=0.6,\\quad S_{3}=0.5,\\quad S_{4}=0.3.\n$$\nAssume the total macroscopic cross section is $\\Sigma_{t}=2$ (nondimensionalized units), and the incoming angular flux at the entry point is $\\psi(0)=1.5$ (nondimensionalized units). Let $\\,\\ell\\,$ be the segment length between $\\mathbf{r}_{\\mathrm{in}}$ and $\\mathbf{r}_{\\mathrm{out}}$ measured by the Euclidean norm.\n\nTasks:\n- Starting from the definition of barycentric coordinates for a tetrahedron, derive a formula to compute the barycentric coordinate vector $\\,\\boldsymbol{\\lambda}(\\mathbf{r})=(\\lambda_{1},\\lambda_{2},\\lambda_{3},\\lambda_{4})^{\\top}\\,$ of an arbitrary point $\\,\\mathbf{r}\\,$ in the tetrahedron as the solution of a $4\\times 4$ linear system built from $\\{\\mathbf{v}_{i}\\}_{i=1}^{4}$. Use this to obtain the barycentric coordinates $\\,\\boldsymbol{\\lambda}_{\\mathrm{in}}\\,$ and $\\,\\boldsymbol{\\lambda}_{\\mathrm{out}}\\,$ for $\\,\\mathbf{r}_{\\mathrm{in}}\\,$ and $\\,\\mathbf{r}_{\\mathrm{out}}\\,$ respectively.\n- Show that along the straight segment parameterized by $\\,\\mathbf{r}(s)=\\mathbf{r}_{\\mathrm{in}}+\\frac{s}{\\ell}\\left(\\mathbf{r}_{\\mathrm{out}}-\\mathbf{r}_{\\mathrm{in}}\\right)\\,$, the barycentric coordinates vary linearly with $\\,s\\,$ and can be written in the affine form $\\,\\boldsymbol{\\lambda}(s)=\\boldsymbol{\\alpha}+\\boldsymbol{\\beta}\\,s\\,$, determining $\\,\\boldsymbol{\\alpha}\\,$ and $\\,\\boldsymbol{\\beta}\\,$ in terms of $\\,\\boldsymbol{\\lambda}_{\\mathrm{in}}\\,$, $\\,\\boldsymbol{\\lambda}_{\\mathrm{out}}\\,$, and $\\,\\ell$.\n- Using the linear source approximation $\\,q(s)=\\sum_{i=1}^{4}S_{i}\\,\\lambda_{i}(s)\\,$, integrate the transport ordinary differential equation to obtain the closed-form analytic expression for the exit angular flux $\\,\\psi(\\ell)\\,$ in terms of $\\,\\Sigma_{t}$, $\\,\\ell$, $\\,\\psi(0)$, $\\,\\mathbf{S}=(S_{1},S_{2},S_{3},S_{4})$, and the parameters of $\\,\\boldsymbol{\\lambda}(s)$ derived above.\n\nExpress your final answer for $\\,\\psi(\\ell)\\,$ as a single closed-form analytic expression involving the exponential function. No rounding is required, and no units should be included in the final expression.",
            "solution": "The problem statement has been critically reviewed and is determined to be valid. It is scientifically grounded in the principles of neutron transport theory, mathematically well-posed, objective, and self-contained. All necessary data for a unique solution are provided. The solution proceeds as follows.\n\nThe problem requires solving the one-dimensional, steady-state transport equation along a characteristic line segment within a tetrahedral cell:\n$$\n\\frac{d\\psi}{ds} + \\Sigma_{t}\\,\\psi(s) = q(s), \\quad s \\in [0, \\ell]\n$$\nwith an initial condition $\\psi(s=0) = \\psi(0)$. The source term $q(s)$ is defined by a linear interpolation of nodal source values using barycentric coordinates.\n\n**1. Barycentric Coordinates**\n\nFor a point $\\mathbf{r} = (x, y, z)^{\\top}$ inside a tetrahedron with vertices $\\{\\mathbf{v}_{i}\\}_{i=1}^{4}$, the barycentric coordinates $\\boldsymbol{\\lambda}(\\mathbf{r})=(\\lambda_{1}, \\lambda_{2}, \\lambda_{3}, \\lambda_{4})^{\\top}$ are defined by the two conditions:\n$$\n\\mathbf{r} = \\sum_{i=1}^{4} \\lambda_{i} \\mathbf{v}_{i} \\quad \\text{and} \\quad \\sum_{i=1}^{4} \\lambda_{i} = 1.\n$$\nThese conditions form a system of $4$ linear equations for the $4$ unknowns $\\lambda_i$. In matrix form, this is:\n$$\n\\begin{pmatrix} v_{1x}  v_{2x}  v_{3x}  v_{4x} \\\\ v_{1y}  v_{2y}  v_{3y}  v_{4y} \\\\ v_{1z}  v_{2z}  v_{3z}  v_{4z} \\\\ 1  1  1  1 \\end{pmatrix}\n\\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\\\ \\lambda_3 \\\\ \\lambda_4 \\end{pmatrix}\n=\n\\begin{pmatrix} x \\\\ y \\\\ z \\\\ 1 \\end{pmatrix}\n$$\nThe given vertices are $\\mathbf{v}_{1}=(0,0,0)$, $\\mathbf{v}_{2}=(1,0,0)$, $\\mathbf{v}_{3}=(0,1,0)$, and $\\mathbf{v}_{4}=(0,0,1)$. Substituting these into the matrix system yields:\n$$\n\\begin{pmatrix} 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\\\ 1  1  1  1 \\end{pmatrix}\n\\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\\\ \\lambda_3 \\\\ \\lambda_4 \\end{pmatrix}\n=\n\\begin{pmatrix} x \\\\ y \\\\ z \\\\ 1 \\end{pmatrix}\n$$\nSolving this simple system gives the barycentric coordinates as functions of the Cartesian coordinates $(x,y,z)$:\n$$\n\\lambda_2 = x, \\quad \\lambda_3 = y, \\quad \\lambda_4 = z\n$$\n$$\n\\lambda_1 = 1 - \\lambda_2 - \\lambda_3 - \\lambda_4 = 1 - x - y - z\n$$\nSo, $\\boldsymbol{\\lambda}(\\mathbf{r}) = (1-x-y-z, x, y, z)^{\\top}$.\n\nUsing this formula, we compute the barycentric coordinates for the entry point $\\mathbf{r}_{\\mathrm{in}}=(0.1, 0.2, 0.1)$ and exit point $\\mathbf{r}_{\\mathrm{out}}=(0.2, 0.3, 0.15)$.\nFor $\\mathbf{r}_{\\mathrm{in}}$:\n$\\lambda_{2, \\mathrm{in}} = 0.1$, $\\lambda_{3, \\mathrm{in}} = 0.2$, $\\lambda_{4, \\mathrm{in}} = 0.1$.\n$\\lambda_{1, \\mathrm{in}} = 1 - 0.1 - 0.2 - 0.1 = 0.6$.\nThus, $\\boldsymbol{\\lambda}_{\\mathrm{in}} = (0.6, 0.1, 0.2, 0.1)^{\\top}$.\n\nFor $\\mathbf{r}_{\\mathrm{out}}$:\n$\\lambda_{2, \\mathrm{out}} = 0.2$, $\\lambda_{3, \\mathrm{out}} = 0.3$, $\\lambda_{4, \\mathrm{out}} = 0.15$.\n$\\lambda_{1, \\mathrm{out}} = 1 - 0.2 - 0.3 - 0.15 = 0.35$.\nThus, $\\boldsymbol{\\lambda}_{\\mathrm{out}} = (0.35, 0.2, 0.3, 0.15)^{\\top}$.\n\n**2. Linear Variation of Barycentric Coordinates Along the Characteristic**\n\nThe characteristic segment is parameterized by the arc length $s$ as:\n$$\n\\mathbf{r}(s) = \\mathbf{r}_{\\mathrm{in}} + \\frac{s}{\\ell} (\\mathbf{r}_{\\mathrm{out}} - \\mathbf{r}_{\\mathrm{in}}) = \\left(1-\\frac{s}{\\ell}\\right)\\mathbf{r}_{\\mathrm{in}} + \\frac{s}{\\ell}\\mathbf{r}_{\\mathrm{out}}, \\quad s \\in [0, \\ell]\n$$\nwhere $\\ell$ is the segment length. Since the mapping from Cartesian coordinates $\\mathbf{r}$ to barycentric coordinates $\\boldsymbol{\\lambda}(\\mathbf{r})$ is an affine transformation, and $\\mathbf{r}(s)$ is an affine (linear) function of $s$, the composition $\\boldsymbol{\\lambda}(\\mathbf{r}(s))$ is also an affine function of $s$. Specifically:\n$$\n\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\lambda}(\\mathbf{r}(s)) = \\left(1-\\frac{s}{\\ell}\\right)\\boldsymbol{\\lambda}(\\mathbf{r}_{\\mathrm{in}}) + \\frac{s}{\\ell}\\boldsymbol{\\lambda}(\\mathbf{r}_{\\mathrm{out}})\n$$\nRearranging this into the form $\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\alpha} + \\boldsymbol{\\beta}s$:\n$$\n\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\lambda}_{\\mathrm{in}} + \\frac{1}{\\ell}(\\boldsymbol{\\lambda}_{\\mathrm{out}} - \\boldsymbol{\\lambda}_{\\mathrm{in}})s\n$$\nThus, we identify the constant vector $\\boldsymbol{\\alpha}$ and the vector of slopes $\\boldsymbol{\\beta}$ as:\n$$\n\\boldsymbol{\\alpha} = \\boldsymbol{\\lambda}_{\\mathrm{in}} \\quad \\text{and} \\quad \\boldsymbol{\\beta} = \\frac{1}{\\ell}(\\boldsymbol{\\lambda}_{\\mathrm{out}} - \\boldsymbol{\\lambda}_{\\mathrm{in}})\n$$\n\n**3. Integration of the Transport Equation**\n\nThe transport equation is a first-order linear ordinary differential equation. Its solution can be found using an integrating factor, $I(s)=\\exp(\\Sigma_t s)$. The general solution for $\\psi(\\ell)$ given $\\psi(0)$ is:\n$$\n\\psi(\\ell) = \\psi(0)\\exp(-\\Sigma_t \\ell) + \\int_0^\\ell q(s') \\exp(-\\Sigma_t (\\ell-s')) ds'\n$$\nThe source along the characteristic is given by $q(s) = \\sum_{i=1}^4 S_i \\lambda_i(s) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}(s)$, where $\\mathbf{S}=(S_1, S_2, S_3, S_4)^\\top$. Using the linear form for $\\boldsymbol{\\lambda}(s)$:\n$$\nq(s) = \\mathbf{S}^\\top(\\boldsymbol{\\alpha} + \\boldsymbol{\\beta}s) = (\\mathbf{S}^\\top \\boldsymbol{\\alpha}) + (\\mathbf{S}^\\top \\boldsymbol{\\beta})s\n$$\nLet $q_0 = \\mathbf{S}^\\top \\boldsymbol{\\alpha} = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{in}} = q(0)$ and $q_1 = \\mathbf{S}^\\top \\boldsymbol{\\beta} = \\frac{\\mathbf{S}^\\top(\\boldsymbol{\\lambda}_{\\mathrm{out}}-\\boldsymbol{\\lambda}_{\\mathrm{in}})}{\\ell} = \\frac{q(\\ell)-q(0)}{\\ell}$. The source is linear in $s$: $q(s) = q_0 + q_1 s$.\n\nThe integral term is $\\exp(-\\Sigma_t \\ell) \\int_0^\\ell (q_0+q_1 s')\\exp(\\Sigma_t s') ds'$. We compute the definite integral:\n$$\n\\int_0^\\ell (q_0+q_1 s')\\exp(\\Sigma_t s') ds' = \\left[ \\frac{q_0}{\\Sigma_t}\\exp(\\Sigma_t s') \\right]_0^\\ell + q_1 \\int_0^\\ell s'\\exp(\\Sigma_t s') ds'\n$$\nUsing integration by parts for the second term, $\\int s' e^{as'} ds' = (\\frac{s'}{a} - \\frac{1}{a^2})e^{as'}$, we get:\n$$\n= \\frac{q_0}{\\Sigma_t}(\\exp(\\Sigma_t \\ell)-1) + q_1 \\left[ \\left(\\frac{s'}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right)\\exp(\\Sigma_t s') \\right]_0^\\ell\n$$\n$$\n= \\frac{q_0}{\\Sigma_t}(\\exp(\\Sigma_t \\ell)-1) + q_1 \\left( \\left(\\frac{\\ell}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right)\\exp(\\Sigma_t \\ell) - \\left(-\\frac{1}{\\Sigma_t^2}\\right) \\right)\n$$\nSubstituting this into the solution for $\\psi(\\ell)$ and simplifying:\n$$\n\\psi(\\ell) = \\psi(0)\\exp(-\\Sigma_t \\ell) + \\frac{q_0}{\\Sigma_t}(1-\\exp(-\\Sigma_t \\ell)) + q_1 \\left( \\left(\\frac{\\ell}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right) + \\frac{1}{\\Sigma_t^2}\\exp(-\\Sigma_t \\ell) \\right)\n$$\nRecalling $q_0 = q(0)$ and $q_0+q_1\\ell = q(\\ell)$, a more standard form is obtained by grouping terms with $\\exp(-\\Sigma_t \\ell)$:\n$$\n\\psi(\\ell) = \\left( \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} \\right) \\exp(-\\Sigma_t \\ell) + \\frac{q(0)+q_1\\ell}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2}\n$$\n$$\n\\psi(\\ell) = \\left( \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} \\right) \\exp(-\\Sigma_t \\ell) + \\frac{q(\\ell)}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2}\n$$\n\n**4. Final Calculation**\n\nWe now substitute the given numerical values.\nFirst, compute the segment length $\\ell$:\n$$\n\\ell = \\|\\mathbf{r}_{\\mathrm{out}} - \\mathbf{r}_{\\mathrm{in}}\\|_2 = \\|(0.2-0.1, 0.3-0.2, 0.15-0.1)\\|_2 = \\|(0.1, 0.1, 0.05)\\|_2\n$$\n$$\n\\ell = \\sqrt{(0.1)^2 + (0.1)^2 + (0.05)^2} = \\sqrt{0.01 + 0.01 + 0.0025} = \\sqrt{0.0225} = 0.15\n$$\nNext, compute the source values $q(0)$ and $q(\\ell)$ using $\\mathbf{S}=(0.4, 0.6, 0.5, 0.3)^\\top$:\n$$\nq(0) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{in}} = (0.4)(0.6) + (0.6)(0.1) + (0.5)(0.2) + (0.3)(0.1) = 0.24 + 0.06 + 0.10 + 0.03 = 0.43\n$$\n$$\nq(\\ell) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{out}} = (0.4)(0.35) + (0.6)(0.2) + (0.5)(0.3) + (0.3)(0.15) = 0.14 + 0.12 + 0.15 + 0.045 = 0.455\n$$\nFrom these, we find the source slope parameter $q_1$:\n$$\nq_1 = \\frac{q(\\ell) - q(0)}{\\ell} = \\frac{0.455 - 0.43}{0.15} = \\frac{0.025}{0.15} = \\frac{25}{150} = \\frac{1}{6}\n$$\nThe remaining values are: $\\psi(0)=1.5$, $\\Sigma_t=2$. Let's compute the coefficients in the expression for $\\psi(\\ell)$.\nThe optical thickness is $\\Sigma_t \\ell = 2 \\times 0.15 = 0.3$.\nThe coefficient of the exponential term is:\n$$\nC_1 = \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} = 1.5 - \\frac{0.43}{2} + \\frac{1/6}{2^2} = \\frac{3}{2} - \\frac{0.43}{2} + \\frac{1}{24} = \\frac{3}{2} - \\frac{43}{200} + \\frac{1}{24}\n$$\nThe least common denominator of $2$, $200$, and $24$ is $600$.\n$$\nC_1 = \\frac{3 \\times 300}{600} - \\frac{43 \\times 3}{600} + \\frac{1 \\times 25}{600} = \\frac{900 - 129 + 25}{600} = \\frac{796}{600} = \\frac{199}{150}\n$$\nThe constant term is:\n$$\nC_2 = \\frac{q(\\ell)}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2} = \\frac{0.455}{2} - \\frac{1/6}{2^2} = \\frac{0.455}{2} - \\frac{1}{24} = \\frac{455}{2000} - \\frac{1}{24} = \\frac{91}{400} - \\frac{1}{24}\n$$\nThe least common denominator of $400$ and $24$ is $1200$.\n$$\nC_2 = \\frac{91 \\times 3}{1200} - \\frac{1 \\times 50}{1200} = \\frac{273 - 50}{1200} = \\frac{223}{1200}\n$$\nCombining these results, the final expression for the exit flux is:\n$$\n\\psi(\\ell) = C_1 \\exp(-\\Sigma_t \\ell) + C_2 = \\frac{199}{150} \\exp(-0.3) + \\frac{223}{1200}\n$$\nWe can also write the exponent as a fraction, $-0.3 = -3/10$:\n$$\n\\psi(\\ell) = \\frac{199}{150} \\exp\\left(-\\frac{3}{10}\\right) + \\frac{223}{1200}\n$$\nThis is the final closed-form analytic expression for the exit angular flux.",
            "answer": "$$\\boxed{\\frac{199}{150} \\exp\\left(-\\frac{3}{10}\\right) + \\frac{223}{1200}}$$"
        },
        {
            "introduction": "A key reason for the prevalence of characteristic-based methods is their superior positivity and stability properties compared to simpler schemes like Diamond Difference (DD). This hands-on practice  challenges you to implement and compare the LC, Step Characteristics (SC), and DD methods under extreme conditions, such as strong absorption and steep source gradients. By observing where certain methods fail to produce physical, non-negative fluxes, you will gain a concrete understanding of the robustness that makes LC a valuable tool.",
            "id": "4233761",
            "problem": "Consider the steady-state, monoenergetic neutron transport along a single characteristic line traversing a tetrahedral finite-volume cell. Assume an absorbing, non-scattering medium with constant total macroscopic cross section $\\sigma_t  0$ within the cell, and a prescribed volumetric source that varies linearly along the characteristic path of length $L  0$. Let the one-dimensional coordinate along the characteristic be $x \\in [0,L]$, with boundary condition $\\psi(0) = \\psi_{\\text{in}} \\ge 0$. The angular flux satisfies the ordinary differential equation $d\\psi/dx + \\sigma_t \\psi = s(x)$, where $s(x) = s_0 + s_1 x$ with $s_0 \\ge 0$ and $s_1$ real, and the path is chosen within a fixed tetrahedral cell in such a way that $s(x) \\ge 0$ for the constructed test cases. You will compare three spatial discretizations for computing the outflow angular flux at $x = L$ and the cell-average angular flux: Linear Characteristics (LC), Step Characteristics (SC), and Diamond-Difference (DD). Linear Characteristics (LC) models the source as linear in $x$ and integrates the transport equation exactly along the characteristic. Step Characteristics (SC) models the source as constant in the cell, equal to the upwind value $s(0) = s_0$, and integrates the transport equation exactly for this constant source. Diamond-Difference (DD) uses a centered finite-difference discretization in space with a single cell unknown and models the source as constant, equal to the chord-average $s_{\\text{avg}} = s_0 + \\frac{s_1 L}{2}$.\n\nStarting from the fundamental definition of the steady-state, monoenergetic transport equation along a characteristic, $d\\psi/dx + \\sigma_t \\psi = s(x)$, and the assumption $\\psi(0) = \\psi_{\\text{in}}$, derive expressions for the outflow angular flux $\\psi(L)$ and the cell-average angular flux $\\bar{\\psi} = \\frac{1}{L}\\int_0^L \\psi(x)\\,dx$ under each of the three discretizations. Use these expressions to implement a program that, for each of the provided test cases, determines the positivity of each discretization by returning a boolean indicating whether both the computed outflow flux and the computed cell-average flux are greater than or equal to zero, up to a numerical tolerance of $10^{-12}$.\n\nAll quantities are dimensionless for this problem, and angles are not required. Your implementation must use the following parameterization for each test case: $(\\sigma_t, L, \\psi_{\\text{in}}, s_0, s_1)$.\n\nTest suite:\n- Case 1 (moderate absorption, mild gradient): $(\\sigma_t, L, \\psi_{\\text{in}}, s_0, s_1) = (1.0, 1.0, 0.5, 0.2, 0.1)$.\n- Case 2 (strong absorption, steep source gradient in a tetrahedral chord with small chord length but large optical thickness): $(\\sigma_t, L, \\psi_{\\text{in}}, s_0, s_1) = (8000.0, 0.001, 10.0, 0.0, 1000.0)$.\n- Case 3 (near-transparent cell, source-dominated): $(\\sigma_t, L, \\psi_{\\text{in}}, s_0, s_1) = (10^{-6}, 1.0, 0.0, 1.0, 1.0)$.\n- Case 4 (very strong absorption, nearly flat and small source): $(\\sigma_t, L, \\psi_{\\text{in}}, s_0, s_1) = (20.0, 1.0, 2.0, 0.01, 0.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a three-element list of booleans in the order $[\\text{LC\\_positive}, \\text{SC\\_positive}, \\text{DD\\_positive}]$. For example, the output format is $[[b_{11},b_{12},b_{13}],[b_{21},b_{22},b_{23}],\\ldots]$, where each $b_{ij}$ is either True or False.",
            "solution": "The problem is evaluated as scientifically grounded, well-posed, and objective. It is based on the fundamental steady-state, monoenergetic neutron transport equation, a cornerstone of reactor physics. The specified discretization methods—Linear Characteristics (LC), Step Characteristics (SC), and Diamond-Difference (DD)—are standard numerical techniques in the field. All necessary parameters and conditions are provided, and there are no internal contradictions. The problem is therefore deemed **valid**, and a solution will be provided.\n\nThe analysis begins with the one-dimensional, steady-state, monoenergetic transport equation along a characteristic line of length $L$:\n$$\n\\frac{d\\psi}{dx} + \\sigma_t \\psi(x) = s(x), \\quad x \\in [0, L]\n$$\nwith a given inflow boundary condition $\\psi(0) = \\psi_{\\text{in}}$. The source term is linear, $s(x) = s_0 + s_1 x$. The general solution to this first-order linear ordinary differential equation is found using an integrating factor $e^{\\sigma_t x}$, yielding:\n$$\n\\psi(x) = \\psi_{\\text{in}} e^{-\\sigma_t x} + \\int_0^x s(x') e^{-\\sigma_t(x - x')} dx'\n$$\nThe cell-average flux is defined as $\\bar{\\psi} = \\frac{1}{L}\\int_0^L \\psi(x) dx$. A convenient relation for $\\bar{\\psi}$ can be derived by integrating the transport equation over the cell length $L$:\n$$\n\\int_0^L \\frac{d\\psi}{dx} dx + \\sigma_t \\int_0^L \\psi(x) dx = \\int_0^L s(x) dx\n$$\n$$\n\\psi(L) - \\psi(0) + \\sigma_t (L \\bar{\\psi}) = L s_{\\text{avg}}\n$$\nwhere $s_{\\text{avg}}$ is the average source over the path length $L$ for the specific source model used by a discretization. This provides a balance equation:\n$$\n\\bar{\\psi} = \\frac{\\psi_{\\text{in}} - \\psi(L) + L s_{\\text{avg}}}{\\sigma_t L} = \\frac{\\psi_{\\text{in}} - \\psi(L)}{\\sigma_t L} + \\frac{s_{\\text{avg}}}{\\sigma_t}\n$$\nThis relationship is used to find the cell-average flux once the outflow flux $\\psi(L)$ is determined for each method.\n\nBelow, we derive the expressions for the outflow flux $\\psi(L)$ and the cell-average flux $\\bar{\\psi}$ for each of the three discretization methods. Let the optical thickness be denoted by $\\tau = \\sigma_t L$.\n\n### 1. Linear Characteristics (LC)\nThis method uses the exact linear source $s(x) = s_0 + s_1 x$ and integrates the transport equation analytically.\nThe integral in the general solution becomes:\n$$\n\\int_0^x (s_0 + s_1 x') e^{-\\sigma_t(x - x')} dx' = \\frac{s_0}{\\sigma_t}(1 - e^{-\\sigma_t x}) + \\frac{s_1}{\\sigma_t} \\left( x - \\frac{1 - e^{-\\sigma_t x}}{\\sigma_t} \\right)\n$$\nSetting $x=L$, the outflow flux $\\psi_{LC}(L)$ is:\n$$\n\\psi_{LC}(L) = \\psi_{\\text{in}} e^{-\\sigma_t L} + \\frac{s_0}{\\sigma_t}(1 - e^{-\\sigma_t L}) + \\frac{s_1}{\\sigma_t} \\left( L - \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t} \\right)\n$$\nThe average source for the LC model is the true average of the linear source: $s_{\\text{avg,LC}} = \\frac{1}{L}\\int_0^L (s_0 + s_1 x) dx = s_0 + \\frac{s_1 L}{2}$. The cell-average flux $\\bar{\\psi}_{LC}$ is found using the balance equation:\n$$\n\\bar{\\psi}_{LC} = \\frac{\\psi_{\\text{in}} - \\psi_{LC}(L)}{\\sigma_t L} + \\frac{s_0 + s_1 L/2}{\\sigma_t}\n$$\nSince $s(x) \\ge 0$ and $\\psi_{\\text{in}} \\ge 0$, the analytical nature of this solution guarantees that both $\\psi_{LC}(L)$ and $\\bar{\\psi}_{LC}$ will be non-negative.\n\n### 2. Step Characteristics (SC)\nThis method approximates the source as a constant over the cell, equal to its upwind value, $s(x) \\approx s_{SC} = s(0) = s_0$. This is a special case of the LC derivation with $s_1 = 0$.\nThe outflow flux $\\psi_{SC}(L)$ is obtained by setting $s_1=0$ in the LC formula:\n$$\n\\psi_{SC}(L) = \\psi_{\\text{in}} e^{-\\sigma_t L} + \\frac{s_0}{\\sigma_t}(1 - e^{-\\sigma_t L})\n$$\nThe average source for the SC model is simply $s_{\\text{avg,SC}} = s_0$. The cell-average flux $\\bar{\\psi}_{SC}$ is:\n$$\n\\bar{\\psi}_{SC} = \\frac{\\psi_{\\text{in}} - \\psi_{SC}(L)}{\\sigma_t L} + \\frac{s_0}{\\sigma_t}\n$$\nLike LC, with non-negative inputs $\\psi_{\\text{in}} \\ge 0$ and $s_0 \\ge 0$, the SC method is guaranteed to produce non-negative fluxes.\n\n### 3. Diamond-Difference (DD)\nThe DD method employs a centered finite-difference approximation over the cell $[0, L]$. The derivative is approximated at the cell center as $\\frac{\\psi(L) - \\psi(0)}{L}$, and the flux itself is approximated by its cell-edge average $\\frac{\\psi(0) + \\psi(L)}{2}$. The source is taken as the cell-average value, $s_{\\text{avg,DD}} = s_0 + \\frac{s_1 L}{2}$.\nThe discretized transport equation is:\n$$\n\\frac{\\psi_{DD}(L) - \\psi_{\\text{in}}}{L} + \\sigma_t \\left( \\frac{\\psi_{\\text{in}} + \\psi_{DD}(L)}{2} \\right) = s_0 + \\frac{s_1 L}{2}\n$$\nSolving for the outflow flux $\\psi_{DD}(L)$:\n$$\n\\psi_{DD}(L) \\left(\\frac{1}{L} + \\frac{\\sigma_t}{2}\\right) = s_0 + \\frac{s_1 L}{2} + \\psi_{\\text{in}}\\left(\\frac{1}{L} - \\frac{\\sigma_t}{2}\\right)\n$$\n$$\n\\psi_{DD}(L) = \\frac{ s_0 + s_1 L/2 + \\psi_{\\text{in}}(\\frac{1}{L} - \\frac{\\sigma_t}{2}) }{ \\frac{1}{L} + \\frac{\\sigma_t}{2} } = \\frac{2L(s_0 + s_1 L/2) + \\psi_{\\text{in}}(2 - \\sigma_t L)}{2 + \\sigma_t L}\n$$\nThe DD scheme defines the cell-average flux as the arithmetic mean of the cell-edge fluxes:\n$$\n\\bar{\\psi}_{DD} = \\frac{\\psi_{\\text{in}} + \\psi_{DD}(L)}{2}\n$$\nSubstituting the expression for $\\psi_{DD}(L)$ and simplifying yields:\n$$\n\\bar{\\psi}_{DD} = \\frac{2\\psi_{\\text{in}} + L(s_0 + s_1 L/2)}{2 + \\sigma_t L}\n$$\nUnlike LC and SC, the DD scheme is not unconditionally positive. The term $(2 - \\sigma_t L)$ in the numerator for $\\psi_{DD}(L)$ can be negative if the optical thickness $\\tau = \\sigma_t L  2$. If the source term is small compared to a large inflow flux $\\psi_{\\text{in}}$, this can lead to a non-physical negative outflow flux $\\psi_{DD}(L)$.\n\nFor implementation, when the optical thickness $\\tau = \\sigma_t L$ is very small (e.g., $\\tau  10^{-6}$), expressions involving $(1 - e^{-\\tau})$ can suffer from catastrophic cancellation. In these cases, Taylor series expansions are used for numerical stability. For example, $(1 - e^{-\\tau})/\\sigma_t \\approx L(1 - \\tau/2 + \\tau^2/6 - \\dots)$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes outflow and cell-average fluxes for LC, SC, and DD methods\n    and checks for positivity.\n    \"\"\"\n    test_cases = [\n        (1.0, 1.0, 0.5, 0.2, 0.1),\n        (8000.0, 0.001, 10.0, 0.0, 1000.0),\n        (10**-6, 1.0, 0.0, 1.0, 1.0),\n        (20.0, 1.0, 2.0, 0.01, 0.0),\n    ]\n\n    all_results = []\n    TOL = 1e-12\n\n    for case in test_cases:\n        sigma_t, L, psi_in, s0, s1 = case\n        \n        tau = sigma_t * L\n        \n        case_results = []\n\n        # --- Linear Characteristics (LC) ---\n        psi_L_lc, psi_bar_lc = 0.0, 0.0\n        s_avg_lc = s0 + s1 * L / 2.0\n\n        if tau  1e-7: # Use Taylor expansion for small optical thickness\n            # psi_L = psi_in + s0*L + s1*L^2/2 - tau*(psi_in + s0*L/2 + s1*L^2/6) + ...\n            psi_L_lc = psi_in + s0 * L + s1 * L**2 / 2.0\n            # psi_bar = psi_in + s0*L/2 + s1*L^2/6 - tau*(psi_in/2 + s0*L/6 + s1*L^2/24) + ...\n            psi_bar_lc = psi_in + s0 * L / 2.0 + s1 * L**2 / 6.0\n        else:\n            exp_m_tau = np.exp(-tau)\n            # Factor for s0 term\n            f1 = (1.0 - exp_m_tau) / sigma_t\n            # Factor for s1 term\n            f2 = (L - f1) / sigma_t\n            \n            psi_L_lc = psi_in * exp_m_tau + s0 * f1 + s1 * f2\n            psi_bar_lc = (psi_in - psi_L_lc) / tau + s_avg_lc / sigma_t\n\n        lc_positive = (psi_L_lc >= -TOL) and (psi_bar_lc >= -TOL)\n        case_results.append(lc_positive)\n        \n        # --- Step Characteristics (SC) ---\n        psi_L_sc, psi_bar_sc = 0.0, 0.0\n        s_avg_sc = s0\n\n        if tau  1e-7: # Use Taylor expansion\n            # psi_L = psi_in + s0*L - tau*(psi_in + s0*L/2) + ...\n            psi_L_sc = psi_in + s0 * L\n            # psi_bar = psi_in + s0*L/2 - tau*(psi_in/2 + s0*L/6) + ...\n            psi_bar_sc = psi_in + s0 * L / 2.0\n        else:\n            exp_m_tau = np.exp(-tau)\n            f1 = (1.0 - exp_m_tau) / sigma_t\n            \n            psi_L_sc = psi_in * exp_m_tau + s0 * f1\n            psi_bar_sc = (psi_in - psi_L_sc) / tau + s_avg_sc / sigma_t\n\n        sc_positive = (psi_L_sc >= -TOL) and (psi_bar_sc >= -TOL)\n        case_results.append(sc_positive)\n\n        # --- Diamond Difference (DD) ---\n        s_avg_dd = s0 + s1 * L / 2.0\n        \n        # Numerically stable and direct formulas\n        denominator = 2.0 + tau\n        \n        psi_L_dd = (2.0 * L * s_avg_dd + psi_in * (2.0 - tau)) / denominator\n        psi_bar_dd = (2.0 * psi_in + L * s_avg_dd) / denominator\n        \n        dd_positive = (psi_L_dd >= -TOL) and (psi_bar_dd >= -TOL)\n        case_results.append(dd_positive)\n\n        all_results.append(case_results)\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join([f\"[{b1},{b2},{b3}]\" for b1, b2, b3 in all_results]) + \"]\"\n    print(output_str.replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\n\nsolve()\n```"
        },
        {
            "introduction": "Writing a correct numerical solver is challenging; verifying its correctness is an even more critical task. This advanced exercise  introduces the Method of Manufactured Solutions (MMS), a powerful technique for code verification. You will construct a known analytical solution to the transport equation, derive the corresponding source term, and then use it to measure the error of your own LC implementation, a gold-standard practice in scientific computing.",
            "id": "4233777",
            "problem": "Consider the steady-state, monoenergetic, one-dimensional neutron transport equation in slab geometry, where the unknown angular flux $\\,\\psi(x,\\mu)\\,$ satisfies\n$$\n\\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu) = q(x,\\mu),\n$$\nwith spatial coordinate $\\,x\\in[0,L]\\,$, direction cosine $\\,\\mu\\in\\{-1,+1\\}\\,$, total macroscopic cross-section $\\,\\Sigma_t(x)\\,$ in $\\,$m$^{-1}$, and angular source $\\,q(x,\\mu)\\,$ in consistent units. The boundary conditions impose prescribed incoming angular flux at the inflow boundaries:\n$$\n\\psi(0,+1) = \\psi_{\\text{in}}^+(0),\\quad \\psi(L,-1) = \\psi_{\\text{in}}^-(L).\n$$\n\nA manufactured-solution approach is used to define a known reference solution $\\,\\psi(x,\\mu)\\,$ and deduce the source $\\,q(x,\\mu)\\,$ and the cross-section $\\,\\Sigma_t(x)\\,$ so that the transport equation holds identically. The goal is to implement a linear characteristic (LC) spatial discretization and quantify its error compared to the manufactured solution.\n\nThe manufactured angular flux is chosen as\n$$\n\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\,\\sin(\\pi x),\n$$\nwith $\\,x\\,$ in meters and $\\,\\mu\\in\\{-1,+1\\}\\,$. Let the total macroscopic cross-section be piecewise constant per spatial cell, defined from a smooth profile\n$$\n\\Sigma_t(x) = \\Sigma_0\\,(1+\\alpha x),\n$$\nbut taken as a constant within each cell equal to the value at the cell center. The corresponding manufactured source that makes the transport equation hold is\n$$\nq(x,\\mu) = \\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu),\n$$\nwhere the derivative is\n$$\n\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\,\\pi\\cos(\\pi x).\n$$\n\nImplement the LC method on a uniform mesh of $\\,N\\,$ cells covering $\\,x\\in[0,L]\\,$, with cell edges at $\\,x_i = i\\,h\\,$ for $\\,i=0,1,\\dots,N\\,$ and cell width $\\,h = L/N\\,$. For each cell $\\,i\\,$, approximate the angular source $\\,q(x,\\mu)\\,$ by a linear function in the local coordinate $\\,s\\in[0,h]\\,$ measured from the upstream edge for the direction $\\,\\mu\\,$:\n$$\nq_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s,\n$$\nconstructed by linearly interpolating between the exact source values at the two edges using the per-cell constant cross-section $\\,\\Sigma_{t,i}=\\Sigma_t(x_{i+\\frac{1}{2}})\\,$, where $\\,x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2\\,$. Specifically, define the slope\n$$\n\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h},\n$$\nand set\n$$\nq_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i}),\\quad q_{i,1}^{(+1)} = \\Delta q_i^{(+1)},\n$$\n$$\nq_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i}),\\quad q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}.\n$$\nFor clarity, $\\,q(x,\\mu;\\Sigma_{t,i})\\,$ denotes the manufactured source evaluated with the per-cell constant cross-section $\\,\\Sigma_{t,i}\\,$.\n\nWithin each cell, the LC method advances the angular flux from the upstream edge over a distance $\\,d\\in[0,h]\\,$ using the exact solution of the linear ordinary differential equation with constant $\\,\\Sigma_{t,i}\\,$ and linear source $\\,q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s\\,$. For $\\,\\Sigma_{t,i}\\neq 0\\,$,\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right).\n$$\nFor the pure streaming limit $\\,\\Sigma_{t,i} = 0\\,$,\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}\\,d + \\frac{1}{2}\\,q_{i,1}^{(\\mu)}\\,d^2.\n$$\n\nUse the manufactured inflow boundary conditions, which follow from the chosen $\\,\\psi(x,\\mu)\\,$:\n$$\n\\psi(0,+1) = 2,\\quad \\psi(L,-1) = 2.\n$$\nMarch cell by cell in the $\\,\\mu=+1\\,$ direction from $\\,x=0\\,$ to $\\,x=L\\,$ and in the $\\,\\mu=-1\\,$ direction from $\\,x=L\\,$ to $\\,x=0\\,$. Record the LC-approximated angular flux at each cell center by setting $\\,d = h/2\\,$ measured from the appropriate upstream edge. Compare the LC-approximated center values to the manufactured exact center values $\\,\\psi(x_{i+\\frac{1}{2}},\\mu)\\,$ and compute the root-mean-square (RMS) error over both directions and all cell centers:\n$$\n\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}.\n$$\n\nYour program must implement the above procedure and produce numerical values of $\\,\\varepsilon_{\\text{RMS}}\\,$ for the following five test cases, expressed as dimensionless floats. The spatial length $\\,L\\,$ must be expressed in meters ($\\,\\mathrm{m}\\,$) and the total macroscopic cross-section parameters in inverse meters ($\\,\\mathrm{m}^{-1}\\,$). The test suite is:\n- Case A (happy path): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- Case B (single cell boundary condition check): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 1\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- Case C (strong attenuation): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 10.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.0\\,$.\n- Case D (refinement for convergence behavior): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 200\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- Case E (pure streaming limit): $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 0.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.0\\,$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $\\,\\left[\\varepsilon_A,\\varepsilon_B,\\varepsilon_C,\\varepsilon_D,\\varepsilon_E\\right]\\,$, where each entry is the RMS error for the corresponding case.",
            "solution": "The user has provided a problem that requires the implementation and verification of a linear characteristic (LC) spatial discretization for the steady-state, monoenergetic, one-dimensional neutron transport equation. The verification is to be performed using the method of manufactured solutions (MMS).\n\n### Step 1: Extract Givens\n\n-   **Governing Equation**: $\\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu) = q(x,\\mu)$\n-   **Domain**: Spatial coordinate $x \\in [0,L]$, direction cosine $\\mu \\in \\{-1, +1\\}$.\n-   **Manufactured Angular Flux**: $\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\,\\sin(\\pi x)$.\n-   **Manufactured Cross-Section Profile**: $\\Sigma_t(x) = \\Sigma_0\\,(1+\\alpha x)$.\n-   **Discretized Cross-Section**: For cell $i$, $\\Sigma_{t,i}$ is constant, evaluated at the cell center: $\\Sigma_{t,i} = \\Sigma_t(x_{i+\\frac{1}{2}})$.\n-   **Manufactured Source Definition**: $q(x,\\mu) = \\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu)$, with $\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\,\\pi\\cos(\\pi x)$.\n-   **Boundary Conditions**: $\\psi(0,+1) = \\psi_{\\text{in}}^+(0)$, $\\psi(L,-1) = \\psi_{\\text{in}}^-(L)$. Derived from the manufactured solution: $\\psi(0,+1) = 2$ and $\\psi(L,-1) = 2$.\n-   **Spatial Discretization**: Uniform mesh of $N$ cells over $[0,L]$. Cell width $h = L/N$. Cell edges $x_i = i\\,h$. Cell center $x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2$.\n-   **Linear Source Approximation within Cell $i$**: $q_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s$, where $s$ is the local coordinate from the upstream edge.\n    -   The source approximation uses the per-cell constant cross-section $\\Sigma_{t,i}$.\n    -   Slope: $\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h}$.\n    -   Coefficients for $\\mu=+1$: $q_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i})$, $q_{i,1}^{(+1)} = \\Delta q_i^{(+1)}$.\n    -   Coefficients for $\\mu=-1$: $q_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i})$, $q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}$.\n-   **Linear Characteristic (LC) Propagator**:\n    -   For $\\Sigma_{t,i} \\neq 0$: $\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right)$.\n    -   For $\\Sigma_{t,i} = 0$: $\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}\\,d + \\frac{1}{2}\\,q_{i,1}^{(\\mu)}\\,d^2$.\n-   **Numerical Evaluation**: The LC-approximated flux is to be calculated at each cell center, which corresponds to propagating over a distance $d = h/2$ from the upstream edge.\n-   **Error Metric**: Root-Mean-Square (RMS) error: $\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}$.\n-   **Test Cases**:\n    -   Case A: $L=1.0, N=40, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case B: $L=1.0, N=1, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case C: $L=1.0, N=40, \\Sigma_0=10.0, \\alpha=0.0$.\n    -   Case D: $L=1.0, N=200, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case E: $L=1.0, N=40, \\Sigma_0=0.0, \\alpha=0.0$.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientific Grounding**: The problem is grounded in the well-established field of neutron transport theory. The one-dimensional, steady-state, monoenergetic transport equation is a standard model. The method of manufactured solutions is a rigorous and widely used technique for code verification. The linear characteristic method is a known, valid numerical scheme. All formulas and concepts are standard in computational reactor physics.\n-   **Well-Posedness**: The problem is well-posed. The governing ODE, combined with the inflow boundary conditions, defines a unique solution. The numerical method is explicitly defined, including the discretization of the cross-section and source term, the propagation algorithm, and the error calculation. The test cases are well-defined and cover various physical regimes.\n-   **Objectivity**: The problem is stated in precise, objective, mathematical language. There are no subjective or ambiguous terms.\n-   **Consistency and Completeness**: The problem is self-contained. All necessary equations, parameters, and procedures are provided. The givens are internally consistent. For example, the boundary conditions are correctly derived from the manufactured solution at the specified boundaries. The discretization of the source term is defined with sufficient clarity to avoid ambiguity. The formulas for the LC propagator correctly represent the analytical solution of the underlying ODE for a linear source and constant coefficients.\n\n### Step 3: Verdict and Action\n\nThe problem statement is valid. It is a well-defined numerical methods exercise with clear instructions and verifiable goals. I will proceed with the solution.\n\n### Principle-Based Design\n\nThe solution is architected around a main function that orchestrates the numerical simulation for a given set of physical and numerical parameters. This function implements the transport sweep algorithm, a cornerstone of solving the Boltzmann transport equation. The algorithm proceeds direction by direction.\n\nFirst, for the positive direction ($\\mu=+1$), the domain is traversed from left to right ($x=0$ to $x=L$). The angular flux at the left boundary is known. This known flux serves as the incoming flux for the first spatial cell. The linear characteristic (LC) method is then applied to propagate the solution across the cell. The LC method relies on the analytical solution of the transport equation under the assumption of a piecewise constant cross-section and a piecewise linear source. The problem rigorously specifies how to obtain these piecewise approximations from the given continuous manufactured profiles.\n\nSpecifically, within each cell $i$, the following steps are performed:\n1.  The constant cross-section $\\Sigma_{t,i}$ is determined by evaluating the continuous profile $\\Sigma_t(x)$ at the cell's midpoint $x_{i+1/2}$.\n2.  The linear source approximation $q_i(s,+1) \\approx q_{i,0}^{(+1)} + q_{i,1}^{(+1)} s$ is constructed. The coefficients are determined by evaluating the manufactured source function (using the just-computed $\\Sigma_{t,i}$) at the cell edges $x_i$ and $x_{i+1}$ and performing linear interpolation.\n3.  The LC propagation formula is invoked twice. First, to compute the flux at the cell center ($d=h/2$), which is stored for the final error calculation. Second, to compute the flux at the cell's exit face ($d=h$), which becomes the known incoming flux for the next cell, $i+1$.\n\nThis process repeats for all cells, completing the sweep for $\\mu=+1$.\n\nNext, a similar process is executed for the negative direction ($\\mu=-1$). This sweep proceeds from right to left ($x=L$ to $x=0$). The known incoming flux at the right boundary initializes the process. For each cell, the source is again linearized based on its values at the cell edges (using the appropriate cell-constant $\\Sigma_{t,i}$), and the LC formulas propagate the solution from the upstream edge (now the right edge, $x_{i+1}$) to the cell center and then to the downstream edge ($x_i$).\n\nAfter both sweeps are complete, the numerically computed flux values at all cell centers for both directions are available. The root-mean-square (RMS) error is then calculated by comparing these numerical values to the exact manufactured solution evaluated at the same cell center locations. This RMS error quantifies the accuracy of the LC discretization for the given problem parameters.\n\nHelper functions are designed to encapsulate the mathematical definitions of the manufactured solution, its derivative, and the source term. A dedicated function for the LC propagator handles the two cases: non-zero cross-section ($\\Sigma_{t,i} \\neq 0$) and the pure streaming limit ($\\Sigma_{t,i}=0$), directly implementing the formulas provided in the problem statement. This modular design enhances clarity and correctness.\n\nThe entire process is repeated for each of the five test cases defined in the problem, and the resulting RMS errors are collected for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef psi_manufactured(x, mu):\n    \"\"\"Calculates the manufactured angular flux psi(x, mu).\"\"\"\n    return 2.0 + np.sin(2.0 * np.pi * x) + mu * np.sin(np.pi * x)\n\ndef dpsi_dx_manufactured(x, mu):\n    \"\"\"Calculates the derivative of the manufactured flux, dpsi/dx.\"\"\"\n    return 2.0 * np.pi * np.cos(2.0 * np.pi * x) + mu * np.pi * np.cos(np.pi * x)\n\ndef q_manufactured(x, mu, sigma_val):\n    \"\"\"\n    Calculates the manufactured source q(x, mu) for a given constant \n    cross-section value.\n    \"\"\"\n    psi_val = psi_manufactured(x, mu)\n    dpsi_dx_val = dpsi_dx_manufactured(x, mu)\n    return mu * dpsi_dx_val + sigma_val * psi_val\n\ndef lc_propagate(psi_in, q0, q1, sigma, d):\n    \"\"\"\n    Propagates the angular flux across a distance d using the Linear\n    Characteristic method.\n    \"\"\"\n    if sigma == 0.0:\n        # Pure streaming case\n        return psi_in + q0 * d + 0.5 * q1 * d**2\n    else:\n        # Case with non-zero cross-section\n        exp_term = np.exp(-sigma * d)\n        \n        # To avoid catastrophic cancellation for small sigma*d, one could use\n        # Taylor expansions or functions like expm1, but direct implementation\n        # is sufficient for the given problem parameters.\n        psi_out = (\n            psi_in * exp_term\n            + (q0 / sigma) * (1.0 - exp_term)\n            + q1 * (d / sigma - (1.0 - exp_term) / sigma**2)\n        )\n        return psi_out\n\ndef calculate_rms_error(L, N, Sigma0, alpha):\n    \"\"\"\n    Implements the full LC transport sweep and computes the RMS error against\n    the manufactured solution.\n    \"\"\"\n    h = L / N\n    x_edges = np.linspace(0.0, L, N + 1)\n    x_centers = x_edges[:-1] + h / 2\n    \n    total_squared_error = 0.0\n\n    # Sweep for mu = +1 (forward)\n    mu = 1.0\n    psi_edge = psi_manufactured(0.0, mu)  # Inflow boundary condition at x=0\n\n    for i in range(N):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi, downstream is xi1\n        q_up = q_manufactured(xi, mu, sigma_ti)\n        q_down = q_manufactured(xi1, mu, sigma_ti)\n        q0 = q_up\n        q1 = (q_down - q_up) / h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n\n    # Sweep for mu = -1 (backward)\n    mu = -1.0\n    psi_edge = psi_manufactured(L, mu)  # Inflow boundary condition at x=L\n\n    for i in range(N - 1, -1, -1):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi1, downstream is xi\n        q_up = q_manufactured(xi1, mu, sigma_ti)\n        q_down = q_manufactured(xi, mu, sigma_ti)\n        q0 = q_up # Per problem spec, q0 is at upstream edge\n        q1 = (q_down - q_up) / h # -(q_up - q_down)/h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n        \n    rms_error = np.sqrt(total_squared_error / (2.0 * N))\n    return rms_error\n\ndef solve():\n    \"\"\"\n    Defines and runs the test cases, then prints the results in the\n    specified format.\n    \"\"\"\n    test_cases = [\n        # Case A: happy path\n        (1.0, 40, 1.0, 0.5),\n        # Case B: single cell boundary condition check\n        (1.0, 1, 1.0, 0.5),\n        # Case C: strong attenuation\n        (1.0, 40, 10.0, 0.0),\n        # Case D: refinement for convergence behavior\n        (1.0, 200, 1.0, 0.5),\n        # Case E: pure streaming limit\n        (1.0, 40, 0.0, 0.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        L, N, Sigma0, alpha = params\n        error = calculate_rms_error(L, N, Sigma0, alpha)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}