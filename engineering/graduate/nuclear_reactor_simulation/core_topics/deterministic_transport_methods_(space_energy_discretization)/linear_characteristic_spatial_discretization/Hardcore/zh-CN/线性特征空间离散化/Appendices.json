{
    "hands_on_practices": [
        {
            "introduction": "线性特征（LC）方法的威力在于其能够优雅地处理复杂几何形状，例如现代反应堆模拟中常用的非结构化四面体网格。本练习  将此过程分解为几个基本步骤，带领您进行一次第一性原理的推导。您将学习如何使用重心坐标来定义线性源场，并求解在该场内沿特征线的输运方程，从而为在复杂几何中应用LC方法建立坚实的数学直觉。",
            "id": "4233766",
            "problem": "考虑在三维非结构网格的单个四面体单元内，沿一条直线特征线的单群、稳态中子输运。在特征线方法 (MOC) 中，假设总宏观截面在单元内是恒定的，并用 $\\Sigma_{t}$ 表示。沿由弧长坐标 $\\,s\\in[0,\\ell]\\,$ 参数化的特征线，角通量 $\\,\\psi(s)\\,$ 满足从沿直线路径的线性玻尔兹曼输运方程导出的基本线性常微分方程，\n$$\n\\frac{d\\psi}{ds} + \\Sigma_{t}\\,\\psi = q(s),\n$$\n其中 $\\,q(s)\\,$ 是四面体内部线段上的各向同性源。采用线性特征线空间离散格式：通过重心坐标插值附着在单元顶点上的节点源系数，将源在单元内近似为空间上的线性函数。\n\n给定四面体顶点的笛卡尔坐标：\n$$\n\\mathbf{v}_{1}=(0,0,0),\\quad \\mathbf{v}_{2}=(1,0,0),\\quad \\mathbf{v}_{3}=(0,1,0),\\quad \\mathbf{v}_{4}=(0,0,1).\n$$\n一条特征射线在\n$$\n\\mathbf{r}_{\\mathrm{in}}=(0.1,\\,0.2,\\,0.1)\n$$\n处进入四面体，并在\n$$\n\\mathbf{r}_{\\mathrm{out}}=(0.2,\\,0.3,\\,0.15)\n$$\n处射出。\n设节点源系数（与顶点相关联的标量）为\n$$\nS_{1}=0.4,\\quad S_{2}=0.6,\\quad S_{3}=0.5,\\quad S_{4}=0.3.\n$$\n假设总宏观截面为 $\\Sigma_{t}=2$（无量纲单位），入射点的入射角通量为 $\\psi(0)=1.5$（无量纲单位）。设 $\\,\\ell\\,$ 为 $\\mathbf{r}_{\\mathrm{in}}$ 和 $\\mathbf{r}_{\\mathrm{out}}$ 之间用欧几里得范数测量的线段长度。\n\n任务：\n- 从四面体重心坐标的定义出发，推导一个公式，将四面体中任意点 $\\,\\mathbf{r}\\,$ 的重心坐标向量 $\\,\\boldsymbol{\\lambda}(\\mathbf{r})=(\\lambda_{1},\\lambda_{2},\\lambda_{3},\\lambda_{4})^{\\top}\\,$ 作为由 $\\{\\mathbf{v}_{i}\\}_{i=1}^{4}$ 构建的 $4\\times 4$ 线性系统的解来计算。使用此公式分别求出 $\\,\\mathbf{r}_{\\mathrm{in}}\\,$ 和 $\\,\\mathbf{r}_{\\mathrm{out}}\\,$ 的重心坐标 $\\,\\boldsymbol{\\lambda}_{\\mathrm{in}}\\,$ 和 $\\,\\boldsymbol{\\lambda}_{\\mathrm{out}}\\,$。\n- 证明沿着由 $\\,\\mathbf{r}(s)=\\mathbf{r}_{\\mathrm{in}}+\\frac{s}{\\ell}\\left(\\mathbf{r}_{\\mathrm{out}}-\\mathbf{r}_{\\mathrm{in}}\\right)\\,$ 参数化的直线段，重心坐标随 $\\,s\\,$ 线性变化，并且可以写成仿射形式 $\\,\\boldsymbol{\\lambda}(s)=\\boldsymbol{\\alpha}+\\boldsymbol{\\beta}\\,s\\,$，用 $\\,\\boldsymbol{\\lambda}_{\\mathrm{in}}\\,$、$\\,\\boldsymbol{\\lambda}_{\\mathrm{out}}\\,$ 和 $\\,\\ell\\,$ 来确定 $\\,\\boldsymbol{\\alpha}\\,$ 和 $\\,\\boldsymbol{\\beta}\\,$。\n- 使用线性源近似 $\\,q(s)=\\sum_{i=1}^{4}S_{i}\\,\\lambda_{i}(s)\\,$，对输运常微分方程进行积分，以获得用 $\\,\\Sigma_{t}$、$\\,\\ell$、$\\,\\psi(0)$、$\\,\\mathbf{S}=(S_{1},S_{2},S_{3},S_{4})$ 和上面推导的 $\\,\\boldsymbol{\\lambda}(s)$ 的参数表示的出射角通量 $\\,\\psi(\\ell)\\,$ 的闭式解析表达式。\n\n将 $\\,\\psi(\\ell)\\,$ 的最终答案表示为包含指数函数的单个闭式解析表达式。无需四舍五入，最终表达式中不应包含单位。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于中子输运理论的原理，在数学上是适定的、客观的且自洽的。提供了唯一解所需的所有数据。求解过程如下。\n\n该问题要求求解在四面体单元内沿特征线段的一维稳态输运方程：\n$$\n\\frac{d\\psi}{ds} + \\Sigma_{t}\\,\\psi(s) = q(s), \\quad s \\in [0, \\ell]\n$$\n初始条件为 $\\psi(s=0) = \\psi(0)$。源项 $q(s)$ 是通过使用重心坐标对节点源值进行线性插值来定义的。\n\n**1. 重心坐标**\n\n对于具有顶点 $\\{\\mathbf{v}_{i}\\}_{i=1}^{4}$ 的四面体内的点 $\\mathbf{r} = (x, y, z)^{\\top}$，其重心坐标 $\\boldsymbol{\\lambda}(\\mathbf{r})=(\\lambda_{1}, \\lambda_{2}, \\lambda_{3}, \\lambda_{4})^{\\top}$ 由以下两个条件定义：\n$$\n\\mathbf{r} = \\sum_{i=1}^{4} \\lambda_{i} \\mathbf{v}_{i} \\quad \\text{和} \\quad \\sum_{i=1}^{4} \\lambda_{i} = 1.\n$$\n这些条件构成了一个关于 4 个未知数 $\\lambda_i$ 的 4 个线性方程组。其矩阵形式为：\n$$\n\\begin{pmatrix} v_{1x}  v_{2x}  v_{3x}  v_{4x} \\\\ v_{1y}  v_{2y}  v_{3y}  v_{4y} \\\\ v_{1z}  v_{2z}  v_{3z}  v_{4z} \\\\ 1  1  1  1 \\end{pmatrix}\n\\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\\\ \\lambda_3 \\\\ \\lambda_4 \\end{pmatrix}\n=\n\\begin{pmatrix} x \\\\ y \\\\ z \\\\ 1 \\end{pmatrix}\n$$\n给定的顶点是 $\\mathbf{v}_{1}=(0,0,0)$, $\\mathbf{v}_{2}=(1,0,0)$, $\\mathbf{v}_{3}=(0,1,0)$ 和 $\\mathbf{v}_{4}=(0,0,1)$。将这些代入矩阵系统可得：\n$$\n\\begin{pmatrix} 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\\\ 1  1  1  1 \\end{pmatrix}\n\\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\\\ \\lambda_3 \\\\ \\lambda_4 \\end{pmatrix}\n=\n\\begin{pmatrix} x \\\\ y \\\\ z \\\\ 1 \\end{pmatrix}\n$$\n求解这个简单的系统，可以得到重心坐标作为笛卡尔坐标 $(x,y,z)$ 的函数：\n$$\n\\lambda_2 = x, \\quad \\lambda_3 = y, \\quad \\lambda_4 = z\n$$\n$$\n\\lambda_1 = 1 - \\lambda_2 - \\lambda_3 - \\lambda_4 = 1 - x - y - z\n$$\n因此，$\\boldsymbol{\\lambda}(\\mathbf{r}) = (1-x-y-z, x, y, z)^{\\top}$。\n\n使用这个公式，我们计算入射点 $\\mathbf{r}_{\\mathrm{in}}=(0.1, 0.2, 0.1)$ 和出射点 $\\mathbf{r}_{\\mathrm{out}}=(0.2, 0.3, 0.15)$ 的重心坐标。\n对于 $\\mathbf{r}_{\\mathrm{in}}$:\n$\\lambda_{2, \\mathrm{in}} = 0.1$, $\\lambda_{3, \\mathrm{in}} = 0.2$, $\\lambda_{4, \\mathrm{in}} = 0.1$.\n$\\lambda_{1, \\mathrm{in}} = 1 - 0.1 - 0.2 - 0.1 = 0.6$.\n因此，$\\boldsymbol{\\lambda}_{\\mathrm{in}} = (0.6, 0.1, 0.2, 0.1)^{\\top}$。\n\n对于 $\\mathbf{r}_{\\mathrm{out}}$:\n$\\lambda_{2, \\mathrm{out}} = 0.2$, $\\lambda_{3, \\mathrm{out}} = 0.3$, $\\lambda_{4, \\mathrm{out}} = 0.15$.\n$\\lambda_{1, \\mathrm{out}} = 1 - 0.2 - 0.3 - 0.15 = 0.35$.\n因此，$\\boldsymbol{\\lambda}_{\\mathrm{out}} = (0.35, 0.2, 0.3, 0.15)^{\\top}$。\n\n**2. 重心坐标沿特征线的线性变化**\n\n特征线段由弧长 $s$ 参数化如下：\n$$\n\\mathbf{r}(s) = \\mathbf{r}_{\\mathrm{in}} + \\frac{s}{\\ell} (\\mathbf{r}_{\\mathrm{out}} - \\mathbf{r}_{\\mathrm{in}}) = \\left(1-\\frac{s}{\\ell}\\right)\\mathbf{r}_{\\mathrm{in}} + \\frac{s}{\\ell}\\mathbf{r}_{\\mathrm{out}}, \\quad s \\in [0, \\ell]\n$$\n其中 $\\ell$ 是线段长度。由于从笛卡尔坐标 $\\mathbf{r}$ 到重心坐标 $\\boldsymbol{\\lambda}(\\mathbf{r})$ 的映射是一个仿射变换，并且 $\\mathbf{r}(s)$ 是 $s$ 的一个仿射（线性）函数，因此复合函数 $\\boldsymbol{\\lambda}(\\mathbf{r}(s))$ 也是 $s$ 的一个仿射函数。具体来说：\n$$\n\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\lambda}(\\mathbf{r}(s)) = \\left(1-\\frac{s}{\\ell}\\right)\\boldsymbol{\\lambda}(\\mathbf{r}_{\\mathrm{in}}) + \\frac{s}{\\ell}\\boldsymbol{\\lambda}(\\mathbf{r}_{\\mathrm{out}})\n$$\n将其重新整理成 $\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\alpha} + \\boldsymbol{\\beta}s$ 的形式：\n$$\n\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\lambda}_{\\mathrm{in}} + \\frac{1}{\\ell}(\\boldsymbol{\\lambda}_{\\mathrm{out}} - \\boldsymbol{\\lambda}_{\\mathrm{in}})s\n$$\n因此，我们确定常数向量 $\\boldsymbol{\\alpha}$ 和斜率向量 $\\boldsymbol{\\beta}$ 为：\n$$\n\\boldsymbol{\\alpha} = \\boldsymbol{\\lambda}_{\\mathrm{in}} \\quad \\text{和} \\quad \\boldsymbol{\\beta} = \\frac{1}{\\ell}(\\boldsymbol{\\lambda}_{\\mathrm{out}} - \\boldsymbol{\\lambda}_{\\mathrm{in}})\n$$\n\n**3. 输运方程的积分**\n\n输运方程是一阶线性常微分方程。其解可以使用积分因子 $I(s)=\\exp(\\Sigma_t s)$ 求得。对于给定的 $\\psi(0)$，$\\psi(\\ell)$ 的通解为：\n$$\n\\psi(\\ell) = \\psi(0)\\exp(-\\Sigma_t \\ell) + \\int_0^\\ell q(s') \\exp(-\\Sigma_t (\\ell-s')) ds'\n$$\n沿特征线的源由 $q(s) = \\sum_{i=1}^4 S_i \\lambda_i(s) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}(s)$ 给出，其中 $\\mathbf{S}=(S_1, S_2, S_3, S_4)^\\top$。使用 $\\boldsymbol{\\lambda}(s)$ 的线性形式：\n$$\nq(s) = \\mathbf{S}^\\top(\\boldsymbol{\\alpha} + \\boldsymbol{\\beta}s) = (\\mathbf{S}^\\top \\boldsymbol{\\alpha}) + (\\mathbf{S}^\\top \\boldsymbol{\\beta})s\n$$\n设 $q_0 = \\mathbf{S}^\\top \\boldsymbol{\\alpha} = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{in}} = q(0)$ 且 $q_1 = \\mathbf{S}^\\top \\boldsymbol{\\beta} = \\frac{\\mathbf{S}^\\top(\\boldsymbol{\\lambda}_{\\mathrm{out}}-\\boldsymbol{\\lambda}_{\\mathrm{in}})}{\\ell} = \\frac{q(\\ell)-q(0)}{\\ell}$。源是 $s$ 的线性函数：$q(s) = q_0 + q_1 s$。\n\n积分项为 $\\exp(-\\Sigma_t \\ell) \\int_0^\\ell (q_0+q_1 s')\\exp(\\Sigma_t s') ds'$。我们计算该定积分：\n$$\n\\int_0^\\ell (q_0+q_1 s')\\exp(\\Sigma_t s') ds' = \\left[ \\frac{q_0}{\\Sigma_t}\\exp(\\Sigma_t s') \\right]_0^\\ell + q_1 \\int_0^\\ell s'\\exp(\\Sigma_t s') ds'\n$$\n对第二项使用分部积分法，$\\int s' e^{as'} ds' = (\\frac{s'}{a} - \\frac{1}{a^2})e^{as'}$，我们得到：\n$$\n= \\frac{q_0}{\\Sigma_t}(\\exp(\\Sigma_t \\ell)-1) + q_1 \\left[ \\left(\\frac{s'}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right)\\exp(\\Sigma_t s') \\right]_0^\\ell\n$$\n$$\n= \\frac{q_0}{\\Sigma_t}(\\exp(\\Sigma_t \\ell)-1) + q_1 \\left( \\left(\\frac{\\ell}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right)\\exp(\\Sigma_t \\ell) - \\left(-\\frac{1}{\\Sigma_t^2}\\right) \\right)\n$$\n将此结果代入 $\\psi(\\ell)$ 的解并化简：\n$$\n\\psi(\\ell) = \\psi(0)\\exp(-\\Sigma_t \\ell) + \\frac{q_0}{\\Sigma_t}(1-\\exp(-\\Sigma_t \\ell)) + q_1 \\left( \\left(\\frac{\\ell}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right) + \\frac{1}{\\Sigma_t^2}\\exp(-\\Sigma_t \\ell) \\right)\n$$\n回顾 $q_0 = q(0)$ 和 $q_0+q_1\\ell = q(\\ell)$，通过将含 $\\exp(-\\Sigma_t \\ell)$ 的项组合在一起，可以得到一个更标准的形式：\n$$\n\\psi(\\ell) = \\left( \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} \\right) \\exp(-\\Sigma_t \\ell) + \\frac{q(0)+q_1\\ell}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2}\n$$\n$$\n\\psi(\\ell) = \\left( \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} \\right) \\exp(-\\Sigma_t \\ell) + \\frac{q(\\ell)}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2}\n$$\n\n**4. 最终计算**\n\n我们现在代入给定的数值。\n首先，计算线段长度 $\\ell$：\n$$\n\\ell = \\|\\mathbf{r}_{\\mathrm{out}} - \\mathbf{r}_{\\mathrm{in}}\\|_2 = \\|(0.2-0.1, 0.3-0.2, 0.15-0.1)\\|_2 = \\|(0.1, 0.1, 0.05)\\|_2\n$$\n$$\n\\ell = \\sqrt{(0.1)^2 + (0.1)^2 + (0.05)^2} = \\sqrt{0.01 + 0.01 + 0.0025} = \\sqrt{0.0225} = 0.15\n$$\n接下来，使用 $\\mathbf{S}=(0.4, 0.6, 0.5, 0.3)^\\top$ 计算源值 $q(0)$ 和 $q(\\ell)$：\n$$\nq(0) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{in}} = (0.4)(0.6) + (0.6)(0.1) + (0.5)(0.2) + (0.3)(0.1) = 0.24 + 0.06 + 0.10 + 0.03 = 0.43\n$$\n$$\nq(\\ell) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{out}} = (0.4)(0.35) + (0.6)(0.2) + (0.5)(0.3) + (0.3)(0.15) = 0.14 + 0.12 + 0.15 + 0.045 = 0.455\n$$\n由此，我们求出源斜率参数 $q_1$：\n$$\nq_1 = \\frac{q(\\ell) - q(0)}{\\ell} = \\frac{0.455 - 0.43}{0.15} = \\frac{0.025}{0.15} = \\frac{25}{150} = \\frac{1}{6}\n$$\n剩余的值为：$\\psi(0)=1.5$, $\\Sigma_t=2$。让我们计算 $\\psi(\\ell)$ 表达式中的系数。\n光学厚度为 $\\Sigma_t \\ell = 2 \\times 0.15 = 0.3$。\n指数项的系数是：\n$$\nC_1 = \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} = 1.5 - \\frac{0.43}{2} + \\frac{1/6}{2^2} = \\frac{3}{2} - \\frac{0.43}{2} + \\frac{1}{24} = \\frac{3}{2} - \\frac{43}{200} + \\frac{1}{24}\n$$\n$2$、$200$ 和 $24$ 的最小公分母是 $600$。\n$$\nC_1 = \\frac{3 \\times 300}{600} - \\frac{43 \\times 3}{600} + \\frac{1 \\times 25}{600} = \\frac{900 - 129 + 25}{600} = \\frac{796}{600} = \\frac{199}{150}\n$$\n常数项是：\n$$\nC_2 = \\frac{q(\\ell)}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2} = \\frac{0.455}{2} - \\frac{1/6}{2^2} = \\frac{0.455}{2} - \\frac{1}{24} = \\frac{455}{2000} - \\frac{1}{24} = \\frac{91}{400} - \\frac{1}{24}\n$$\n$400$ 和 $24$ 的最小公分母是 $1200$。\n$$\nC_2 = \\frac{91 \\times 3}{1200} - \\frac{1 \\times 50}{1200} = \\frac{273 - 50}{1200} = \\frac{223}{1200}\n$$\n综合这些结果，出射角通量的最终表达式为：\n$$\n\\psi(\\ell) = C_1 \\exp(-\\Sigma_t \\ell) + C_2 = \\frac{199}{150} \\exp(-0.3) + \\frac{223}{1200}\n$$\n我们也可以将指数写成分数形式，$-0.3 = -3/10$：\n$$\n\\psi(\\ell) = \\frac{199}{150} \\exp\\left(-\\frac{3}{10}\\right) + \\frac{223}{1200}\n$$\n这就是出射角通量的最终闭式解析表达式。",
            "answer": "$$\\boxed{\\frac{199}{150} \\exp\\left(-\\frac{3}{10}\\right) + \\frac{223}{1200}}$$"
        },
        {
            "introduction": "为了充分理解LC方法的优势，将其与一些更简单但广泛使用的方法（如阶梯特征法 SC 和菱形差分法 DD）进行比较是非常有益的。这个一维平板几何中的编程练习  要求您实现这三种格式，并分析它们的数值特性。通过比较结果，您将亲身体会到不同方法在稳定性和单调性等关键属性上的差异，并理解为何LC方法在许多应用中是更优越的选择。",
            "id": "4233836",
            "problem": "考虑一个宽度为 $\\Delta$（单位 $\\mathrm{cm}$）的一维板状栅元，其材料总宏观截面为 $\\Sigma_t$（单位 $\\mathrm{cm}^{-1}$），均匀各向同性体积源密度为 $Q$（单位 $\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$）。沿着由方向余弦 $\\mu \\in (0,1]$ 表征的单个离散纵标方向，稳态线性玻尔兹曼输运方程简化为以下一维常微分方程\n$$\n\\mu \\,\\frac{d \\psi(x)}{dx} + \\Sigma_t \\,\\psi(x) = q(x),\n$$\n其中 $\\psi(x)$ 是角通量（单位 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$），$q(x)$ 是角源（单位 $\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$）。对于各向同性源密度 $Q$，整个栅元内的角源为 $q(x) = Q/2$。在左边界 $x = 0$ 处施加真空边界条件，因此对于方向 $\\mu > 0$，入射角通量为 $\\psi(0) = 0$。目标是使用三种不同的空间离散化方法计算右边界 $x = \\Delta$ 处的出射角通量，记为 $\\psi(\\Delta)$：\n\n- 阶梯特征线法 (SC)：将栅元内的源视为常数，并在此假设下精确积分特征线。\n- 菱形差分法 (DD)：在栅元内对通量使用线性近似，并对流项进行中心离散化。\n- 线性特征线法 (LC)：将栅元内的源视为线性变化，并对线性源表示精确积分特征线。\n\n从给定的输运方程和边界条件出发，为 SC、DD 和 LC 三种格式推导单个栅元的更新关系，该关系将 $x = 0$ 处的入射边界通量和栅元源表示映射到 $x = \\Delta$ 处的出射边界通量。对于 LC，考虑一个通用的线性源参数化 $q(x) = q_L + \\left(\\frac{x}{\\Delta}\\right)(q_R - q_L)$，然后将其特化为均匀源情况 $q_L = q_R = Q/2$ 以匹配物理设置。对于每种格式，以 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$ 为单位表示出射角通量 $\\psi(\\Delta)$。\n\n定义光学厚度 $\\tau$ 为 $\\tau = \\Sigma_t \\Delta / \\mu$。使用此参数分析每种格式下出射通量相对于入射通量的单调性。特别地，确定每种格式是否满足 $\\frac{\\partial \\psi(\\Delta)}{\\partial \\psi(0)} \\ge 0$，并通过检查对 $\\psi(0)$ 的灵敏度是否为非负来报告菱形差分格式的单调性（布尔值）。\n\n编写一个完整的程序，为以下测试套件计算每种格式的出射角通量和菱形差分格式的单调性布尔值。对所有情况使用真空边界条件 $\\psi(0) = 0$。所有出射角通量以 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$ 为单位表示，并四舍五入到六位小数。\n\n测试套件参数：\n- 情况 1（光学厚度适中的一般情况）：$\\mu = 1$，$\\Delta = 1\\,\\mathrm{cm}$，$\\Sigma_t = 0.5\\,\\mathrm{cm}^{-1}$，$Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$。\n- 情况 2（菱形差分法单调性的边界情况）：$\\mu = 1$，$\\Delta = 2\\,\\mathrm{cm}$，$\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$，$Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$。\n- 情况 3（大光学厚度）：$\\mu = 0.2$，$\\Delta = 1\\,\\mathrm{cm}$，$\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$，$Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$。\n- 情况 4（小光学厚度极限）：$\\mu = 1$，$\\Delta = 10^{-6}\\,\\mathrm{cm}$，$\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$，$Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素本身也是一个列表，包含按顺序排列的四个条目 $[\\psi_{\\mathrm{SC}}(\\Delta), \\psi_{\\mathrm{DD}}(\\Delta), \\psi_{\\mathrm{LC}}(\\Delta), \\text{DD\\_monotone}]$。例如，输出应类似于 $[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3],[a_4,b_4,c_4,d_4]]$，其中每个 $a_i$、$b_i$、$c_i$ 是以 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$ 为单位并四舍五入到六位小数的浮点数，每个 $d_i$ 是一个布尔值。",
            "solution": "用户提供了一个来自核反应堆物理领域的有效、良态的问题陈述，具体涉及一维、稳态、单能线性玻尔兹曼输运方程的空间离散化。该问题具有科学依据、客观，并包含推导所要求的数值格式和计算给定测试用例结果所需的所有信息。\n\n在宽度为 $\\Delta$ 的板中，沿离散方向 $\\mu \\in (0,1]$ 的角通量 $\\psi(x)$ 的控制常微分方程由下式给出：\n$$ \\mu \\frac{d\\psi(x)}{dx} + \\Sigma_t \\psi(x) = q(x) $$\n其中 $\\Sigma_t$ 是总宏观截面，$q(x)$ 是角源。对于均匀、各向同性的体积源 $Q$，角源是恒定的：$q(x) = Q/2$。在 $x=0$ 处的边界条件是 $\\psi(0) = 0$。我们的目标是使用三种不同的格式来求出射通量 $\\psi(\\Delta)$。\n\n首先，我们通过求解该常微分方程来建立一个通用的解析框架。重新整理方程可得：\n$$ \\frac{d\\psi(x)}{dx} + \\frac{\\Sigma_t}{\\mu} \\psi(x) = \\frac{q(x)}{\\mu} $$\n这是一个一阶线性常微分方程。我们可以使用积分因子 $I(x) = \\exp\\left(\\int \\frac{\\Sigma_t}{\\mu} dx\\right) = \\exp\\left(\\frac{\\Sigma_t x}{\\mu}\\right)$ 来求解。将常微分方程两边乘以 $I(x)$ 并从 $x=0$ 到 $x=\\Delta$ 积分，得到其形式解：\n$$ \\psi(\\Delta)e^{\\frac{\\Sigma_t \\Delta}{\\mu}} - \\psi(0)e^0 = \\int_0^\\Delta \\frac{q(x')}{\\mu} e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\n解出 $\\psi(\\Delta)$ 并引入栅元光学厚度 $\\tau = \\frac{\\Sigma_t \\Delta}{\\mu}$，我们得到：\n$$ \\psi(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{e^{-\\tau}}{\\mu} \\int_0^\\Delta q(x') e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\n这个形式解是基于特征线方法的基础。\n\n**1. 阶梯特征线法 (SC) 格式**\n\n阶梯特征线法格式假设源项在整个栅元内是常数，即 $q(x) = \\bar{q}$。对于给定的问题，源在物理上是常数，$q(x) = Q/2$，所以我们设 $\\bar{q} = Q/2$。将此代入形式解的积分中：\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{e^{-\\tau}}{\\mu} \\int_0^\\Delta \\frac{Q}{2} e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Qe^{-\\tau}}{2\\mu} \\left[ \\frac{\\mu}{\\Sigma_t} e^{\\frac{\\Sigma_t x'}{\\mu}} \\right]_0^\\Delta $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Qe^{-\\tau}}{2\\Sigma_t} \\left( e^{\\frac{\\Sigma_t \\Delta}{\\mu}} - 1 \\right) $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Q}{2\\Sigma_t} \\left( 1 - e^{-\\tau} \\right) $$\n由于 SC 的假设与常数源的物理现实相符，该格式为此问题提供了精确的解析解。对入射通量的灵敏度为 $\\frac{\\partial \\psi_{SC}(\\Delta)}{\\partial \\psi(0)} = e^{-\\tau}$。由于 $\\tau > 0$，此灵敏度始终为正，意味着该格式是无条件单调的。\n\n**2. 菱形差分法 (DD) 格式**\n\n菱形差分法格式是通过将输运方程在栅元宽度 $\\Delta$ 上积分得到的：\n$$ \\int_0^\\Delta \\left( \\mu \\frac{d\\psi}{dx} + \\Sigma_t \\psi(x) \\right) dx = \\int_0^\\Delta q(x) dx $$\n$$ \\mu[\\psi(\\Delta) - \\psi(0)] + \\Sigma_t \\Delta \\bar{\\psi} = \\Delta \\bar{q} $$\n其中 $\\bar{\\psi}$ 和 $\\bar{q}$ 是栅元平均通量和源。DD 格式对通量采用线性近似，这意味着封闭关系为 $\\bar{\\psi} = \\frac{\\psi(0) + \\psi(\\Delta)}{2}$。对于常数源，$\\bar{q} = Q/2$。将这些代入平衡方程：\n$$ \\mu[\\psi(\\Delta) - \\psi(0)] + \\Sigma_t \\Delta \\frac{\\psi(0) + \\psi(\\Delta)}{2} = \\Delta \\frac{Q}{2} $$\n为了解出 $\\psi(\\Delta)$，我们除以 $\\mu$ 并使用 $\\tau = \\Sigma_t \\Delta / \\mu$：\n$$ [\\psi(\\Delta) - \\psi(0)] + \\tau \\frac{\\psi(0) + \\psi(\\Delta)}{2} = \\frac{\\tau Q}{2\\Sigma_t} $$\n对 $\\psi(\\Delta)$ 和 $\\psi(0)$ 的项进行分组：\n$$ \\psi(\\Delta) \\left(1 + \\frac{\\tau}{2}\\right) = \\psi(0) \\left(1 - \\frac{\\tau}{2}\\right) + \\frac{\\tau Q}{2\\Sigma_t} $$\n$$ \\psi_{DD}(\\Delta) = \\frac{1 - \\tau/2}{1 + \\tau/2} \\psi(0) + \\frac{\\tau Q / (2\\Sigma_t)}{1 + \\tau/2} = \\frac{2-\\tau}{2+\\tau}\\psi(0) + \\frac{\\tau Q}{\\Sigma_t(2+\\tau)} $$\n对入射通量的灵敏度为 $\\frac{\\partial \\psi_{DD}(\\Delta)}{\\partial \\psi(0)} = \\frac{2-\\tau}{2+\\tau}$。为了使其为非负，并且由于对于物理问题 $2+\\tau > 0$，我们需要 $2-\\tau \\ge 0$。因此，DD 格式是单调的当且仅当 $\\tau \\le 2$。\n\n**3. 线性特征线法 (LC) 格式**\n\n线性特征线法格式与 SC 同样从形式解出发，但假设源是线性变化的：$q(x) = q_L + \\frac{x}{\\Delta}(q_R - q_L)$。问题要求将其特化为均匀源情况，即 $q_L = q_R = Q/2$。这一代换使得源项成为常数 $q(x) = Q/2$，这是一个零次多项式，因此是线性函数的一个特例。推导过程变得与阶梯特征线法情况完全相同：\n$$ \\psi_{LC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Q}{2\\Sigma_t} \\left( 1 - e^{-\\tau} \\right) $$\n与 SC 一样，LC 格式对于此问题是精确的，并且是无条件单调的，因为 $\\frac{\\partial \\psi_{LC}(\\Delta)}{\\partial \\psi(0)} = e^{-\\tau} > 0$。\n\n**用于实现的公式总结**\n\n对于所有情况，边界条件为 $\\psi(0) = 0$。光学厚度为 $\\tau = \\frac{\\Sigma_t \\Delta}{\\mu}$。\n-   **SC 通量**: $\\psi_{SC}(\\Delta) = \\frac{Q}{2\\Sigma_t} (1 - e^{-\\tau})$。为了在 $\\tau \\to 0$ 时的数值稳定性，可以重写为 $\\psi_{SC}(\\Delta) = \\frac{Q\\Delta}{2\\mu} \\frac{1-e^{-\\tau}}{\\tau}$。\n-   **DD 通量**: $\\psi_{DD}(\\Delta) = \\frac{\\tau Q}{\\Sigma_t(2+\\tau)}$。可以重写为 $\\psi_{DD}(\\Delta) = \\frac{Q\\Delta}{\\mu(2+\\tau)}$。\n-   **LC 通量**: $\\psi_{LC}(\\Delta) = \\frac{Q}{2\\Sigma_t} (1 - e^{-\\tau})$，与 SC 相同。\n-   **DD 单调性**: 一个布尔值，指示是否 $\\tau \\le 2$。\n\n这些公式用于计算所提供测试套件的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes outgoing angular flux for SC, DD, and LC schemes and checks\n    DD monotonicity for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (mu, delta, sigma_t, Q)\n        (1.0, 1.0, 0.5, 1.0),\n        (1.0, 2.0, 1.0, 1.0),\n        (0.2, 1.0, 1.0, 1.0),\n        (1.0, 1.0e-6, 1.0, 1.0),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        mu, delta, sigma_t, Q = case\n\n        # Calculate optical thickness\n        # This is guaranteed to be non-zero for the given test cases.\n        tau = sigma_t * delta / mu\n\n        # --- SC and LC Scheme ---\n        # The SC and LC schemes are identical and exact for a constant source.\n        # psi_sc_lc = (Q / (2 * sigma_t)) * (1 - np.exp(-tau))\n        # This form is numerically unstable as sigma_t -> 0 (and tau -> 0).\n        # A more stable form is derived by substituting sigma_t = tau * mu / delta:\n        # psi_sc_lc = (Q * delta / (2 * mu)) * (1 - exp(-tau)) / tau\n        # We use np.expm1 for precision with small tau.\n        # -expm1(-x) is equivalent to 1-exp(-x) but more accurate for small x.\n        if tau == 0.0:\n            # This is the streaming limit as tau -> 0\n            psi_sc_lc = (Q * delta) / (2 * mu)\n        else:\n            psi_sc_lc = (Q * delta / (2 * mu)) * (-np.expm1(-tau) / tau)\n        \n        psi_sc = psi_sc_lc\n        psi_lc = psi_sc_lc\n\n        # --- DD Scheme ---\n        # psi_dd = (tau * Q) / (sigma_t * (2 + tau))\n        # A more stable form is derived by substituting tau/sigma_t = delta/mu:\n        psi_dd = (Q * delta / mu) / (2 + tau)\n\n        # --- DD Monotonicity ---\n        # The scheme is monotonic if tau = 2.\n        dd_monotone = (tau = 2)\n\n        # Append results for the current case\n        all_results.append([psi_sc, psi_dd, psi_lc, dd_monotone])\n\n    # Format the final output string as per the problem specification.\n    # The output must be a single line, representing a list of lists.\n    # Each sub-list contains three floats rounded to 6 decimal places and a boolean.\n    output_parts = []\n    for res in all_results:\n        # str(res[3]) will correctly produce 'True' or 'False'\n        part = f\"[{res[0]:.6f},{res[1]:.6f},{res[2]:.6f},{str(res[3])}]\"\n        output_parts.append(part)\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "在科学计算中，编写代码只是第一步，确保其正确性同样至关重要。最后一个练习  将向您介绍一种强大且专业的代码验证技术：人造解方法（Method of Manufactured Solutions, MMS）。通过精心设计一个具有已知精确解的问题，您可以严格地量化您实现的LC方法的误差，并验证其收敛阶，这是开发可靠模拟工具的一项关键技能。",
            "id": "4233777",
            "problem": "考虑平板几何中的稳态、单能、一维中子输运方程，其中未知的角通量 $\\,\\psi(x,\\mu)\\,$ 满足\n$$\n\\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu) = q(x,\\mu),\n$$\n其中空间坐标 $\\,x\\in[0,L]\\,$，方向余弦 $\\,\\mu\\in\\{-1,+1\\}\\,$，总宏观截面 $\\,\\Sigma_t(x)\\,$ 的单位为 $\\,$m$^{-1}$，角源 $\\,q(x,\\mu)\\,$ 的单位与之协调一致。边界条件在入流边界上指定了入射角通量：\n$$\n\\psi(0,+1) = \\psi_{\\text{in}}^+(0),\\quad \\psi(L,-1) = \\psi_{\\text{in}}^-(L).\n$$\n\n采用制造解方法来定义一个已知的参考解 $\\,\\psi(x,\\mu)\\,$，并由此推导出源项 $\\,q(x,\\mu)\\,$ 和截面 $\\,\\Sigma_t(x)\\,$，使得输运方程恒成立。目标是实现一种线性特征线（LC）空间离散格式，并量化其与制造解相比的误差。\n\n选取的制造角通量为\n$$\n\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\,\\sin(\\pi x),\n$$\n其中 $\\,x\\,$ 的单位为米，$\\,\\mu\\in\\{-1,+1\\}\\,$。设总宏观截面在每个空间网格内为分段常数，由一个光滑剖面定义\n$$\n\\Sigma_t(x) = \\Sigma_0\\,(1+\\alpha x),\n$$\n但在每个网格内取为常数，其值等于网格中心处的值。使输运方程成立的相应制造源为\n$$\nq(x,\\mu) = \\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu),\n$$\n其中导数为\n$$\n\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\,\\pi\\cos(\\pi x).\n$$\n\n在覆盖 $\\,x\\in[0,L]\\,$ 的 $\\,N\\,$ 个网格的均匀网格上实现 LC 方法，网格边界位于 $\\,x_i = i\\,h\\,$（$i=0,1,\\dots,N$），网格宽度为 $\\,h = L/N\\,$。对于每个网格 $\\,i\\,$，将角源 $\\,q(x,\\mu)\\,$ 近似为局部坐标 $\\,s\\in[0,h]\\,$ 的线性函数，该坐标从方向 $\\,\\mu\\,$ 的上游边界开始测量：\n$$\nq_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s,\n$$\n该函数通过在两个边界处的精确源值之间进行线性插值来构造，插值时使用每个网格的常数截面 $\\,\\Sigma_{t,i}=\\Sigma_t(x_{i+\\frac{1}{2}})\\,$，其中 $\\,x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2\\,$。具体来说，定义斜率\n$$\n\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h},\n$$\n并设置\n$$\nq_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i}),\\quad q_{i,1}^{(+1)} = \\Delta q_i^{(+1)},\n$$\n$$\nq_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i}),\\quad q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}.\n$$\n为清晰起见，$\\,q(x,\\mu;\\Sigma_{t,i})\\,$ 表示使用每个网格的常数截面 $\\,\\Sigma_{t,i}\\,$ 计算的制造源。\n\n在每个网格内，LC 方法使用具有常数 $\\,\\Sigma_{t,i}\\,$ 和线性源 $\\,q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s\\,$ 的线性常微分方程的精确解，将角通量从上游边界向前推进距离 $\\,d\\in[0,h]\\,$。对于 $\\,\\Sigma_{t,i}\\neq 0\\,$，\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right).\n$$\n对于纯流出极限 $\\,\\Sigma_{t,i} = 0\\,$，\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}\\,d + \\frac{1}{2}\\,q_{i,1}^{(\\mu)}\\,d^2.\n$$\n\n使用由所选 $\\,\\psi(x,\\mu)\\,$ 导出的制造入流边界条件：\n$$\n\\psi(0,+1) = 2,\\quad \\psi(L,-1) = 2.\n$$\n在 $\\,\\mu=+1\\,$ 方向上，从 $\\,x=0\\,$ 到 $\\,x=L\\,$ 逐个网格进行推进；在 $\\,\\mu=-1\\,$ 方向上，从 $\\,x=L\\,$ 到 $\\,x=0\\,$ 逐个网格进行推进。通过设置从相应上游边界测量的距离 $\\,d = h/2\\,$，记录每个网格中心处经 LC 近似的角通量。将 LC 近似的中心值与制造的精确中心值 $\\,\\psi(x_{i+\\frac{1}{2}},\\mu)\\,$ 进行比较，并计算在所有方向和所有网格中心上的均方根（RMS）误差：\n$$\n\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}.\n$$\n\n您的程序必须实现上述过程，并为以下五个测试案例生成 $\\,\\varepsilon_{\\text{RMS}}\\,$ 的数值，结果表示为无量纲浮点数。空间长度 $\\,L\\,$ 必须以米（$\\,\\mathrm{m}\\,$）表示，总宏观截面参数必须以逆米（$\\,\\mathrm{m}^{-1}\\,$）表示。测试案例如下：\n- 案例 A（理想路径）：$\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- 案例 B（单网格边界条件检查）：$\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 1\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- 案例 C（强衰减）：$\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 10.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.0\\,$.\n- 案例 D（用于收敛行为的网格加密）：$\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 200\\,$, $\\,\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.5\\,$.\n- 案例 E（纯流出极限）：$\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,N = 40\\,$, $\\,\\Sigma_0 = 0.0\\,\\mathrm{m}^{-1}\\,$, $\\,\\alpha = 0.0\\,$.\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $\\,\\left[\\varepsilon_A,\\varepsilon_B,\\varepsilon_C,\\varepsilon_D,\\varepsilon_E\\right]\\,$，其中每个条目是相应案例的 RMS 误差。",
            "solution": "用户提供了一个问题，要求为稳态、单能、一维中子输运方程实现并验证一种线性特征线（LC）空间离散格式。验证将使用制造解方法（MMS）进行。\n\n### 第一步：提取已知条件\n\n-   **控制方程**: $\\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu) = q(x,\\mu)$\n-   **定义域**: 空间坐标 $x \\in [0,L]$，方向余弦 $\\mu \\in \\{-1, +1\\}$。\n-   **制造角通量**: $\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\,\\sin(\\pi x)$。\n-   **制造截面剖面**: $\\Sigma_t(x) = \\Sigma_0\\,(1+\\alpha x)$。\n-   **离散截面**: 对于网格 $i$，$\\Sigma_{t,i}$ 为常数，在网格中心处计算：$\\Sigma_{t,i} = \\Sigma_t(x_{i+\\frac{1}{2}})$。\n-   **制造源定义**: $q(x,\\mu) = \\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu)$，其中 $\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\,\\pi\\cos(\\pi x)$。\n-   **边界条件**: $\\psi(0,+1) = \\psi_{\\text{in}}^+(0)$, $\\psi(L,-1) = \\psi_{\\text{in}}^-(L)$。从制造解推导：$\\psi(0,+1) = 2$ 且 $\\psi(L,-1) = 2$。\n-   **空间离散**: 在 $[0,L]$ 上有 $N$ 个网格的均匀网格。网格宽度 $h = L/N$。网格边界 $x_i = i\\,h$。网格中心 $x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2$。\n-   **网格 $i$ 内的线性源近似**: $q_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s$，其中 $s$ 是从上游边界开始的局部坐标。\n    -   源近似使用每个网格的常数截面 $\\Sigma_{t,i}$。\n    -   斜率：$\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h}$。\n    -   $\\mu=+1$ 的系数：$q_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i})$，$q_{i,1}^{(+1)} = \\Delta q_i^{(+1)}$。\n    -   $\\mu=-1$ 的系数：$q_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i})$，$q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}$。\n-   **线性特征线（LC）传播器**:\n    -   对于 $\\Sigma_{t,i} \\neq 0$：$\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right)$。\n    -   对于 $\\Sigma_{t,i} = 0$：$\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}\\,d + \\frac{1}{2}\\,q_{i,1}^{(\\mu)}\\,d^2$。\n-   **数值计算**: LC 近似的通量将在每个网格中心计算，这对应于从上游边界传播距离 $d = h/2$。\n-   **误差度量**: 均方根（RMS）误差：$\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}$。\n-   **测试案例**:\n    -   案例 A: $L=1.0, N=40, \\Sigma_0=1.0, \\alpha=0.5$。\n    -   案例 B: $L=1.0, N=1, \\Sigma_0=1.0, \\alpha=0.5$。\n    -   案例 C: $L=1.0, N=40, \\Sigma_0=10.0, \\alpha=0.0$。\n    -   案例 D: $L=1.0, N=200, \\Sigma_0=1.0, \\alpha=0.5$。\n    -   案例 E: $L=1.0, N=40, \\Sigma_0=0.0, \\alpha=0.0$。\n\n### 第二步：使用提取的已知条件进行验证\n\n-   **科学依据**: 该问题基于成熟的中子输运理论领域。一维、稳态、单能的输运方程是标准模型。制造解方法是用于代码验证的严谨且广泛使用的技术。线性特征线法是已知有效的数值格式。所有公式和概念在计算反应堆物理学中都是标准的。\n-   **适定性**: 该问题是适定的。控制常微分方程与入流边界条件相结合，定义了唯一的解。数值方法有明确的定义，包括截面和源项的离散化、传播算法和误差计算。测试案例定义清晰，并涵盖了各种物理情景。\n-   **客观性**: 问题以精确、客观的数学语言陈述。没有主观或模糊的术语。\n-   **一致性与完备性**: 问题是自洽的。提供了所有必要的方程、参数和程序。给定的条件内部一致。例如，边界条件是从制造解在指定边界处正确推导出来的。源项的离散化定义足够清晰，以避免歧义。LC 传播器的公式正确地表示了线性源和常系数下基本常微分方程的解析解。\n\n### 第三步：结论与行动\n\n问题陈述有效。这是一个定义明确的数值方法练习，具有清晰的指令和可验证的目标。我将着手解决。\n\n### 基于原理的设计\n\n该解决方案围绕一个主函数构建，该函数为一组给定的物理和数值参数组织数值模拟。该函数实现了输运扫描算法，这是求解玻尔兹曼输运方程的基石。算法逐个方向进行。\n\n首先，对于正方向（$\\mu=+1$），从左到右（$x=0$ 到 $x=L$）遍历区域。左边界的角通量是已知的。这个已知的通量作为第一个空间网格的入流通量。然后应用线性特征线（LC）方法在整个网格中传播解。LC 方法依赖于在分段常数截面和分段线性源假设下输运方程的解析解。问题严格规定了如何从给定的连续制造剖面中获得这些分段近似。\n\n具体来说，在每个网格 $i$ 内，执行以下步骤：\n1.  通过在网格中点 $x_{i+1/2}$ 处计算连续剖面 $\\Sigma_t(x)$ 的值来确定常数截面 $\\Sigma_{t,i}$。\n2.  构造线性源近似 $q_i(s,+1) \\approx q_{i,0}^{(+1)} + q_{i,1}^{(+1)} s$。通过在网格边界 $x_i$ 和 $x_{i+1}$ 处计算制造源函数（使用刚计算出的 $\\Sigma_{t,i}$）并进行线性插值来确定系数。\n3.  LC 传播公式被调用两次。第一次是计算网格中心处的通量（$d=h/2$），该值被存储用于最终的误差计算。第二次是计算网格出口面处的通量（$d=h$），该值成为下一个网格 $i+1$ 的已知入流通量。\n\n对所有网格重复此过程，完成 $\\mu=+1$ 的扫描。\n\n接下来，对负方向（$\\mu=-1$）执行类似的过程。此扫描从右到左（$x=L$ 到 $x=0$）进行。右边界的已知入流通量初始化该过程。对于每个网格，再次根据其在网格边界处的值（使用相应的网格常数 $\\Sigma_{t,i}$）对源进行线性化，并且 LC 公式将解从上游边界（现在是右边界 $x_{i+1}$）传播到网格中心，然后到下游边界（$x_i$）。\n\n在两次扫描都完成后，就得到了所有网格中心处两个方向上的数值计算通量值。然后，通过将这些数值与在相同网格中心位置计算的精确制造解进行比较，来计算均方根（RMS）误差。该 RMS 误差量化了给定问题参数下 LC 离散的准确性。\n\n设计了辅助函数来封装制造解、其导数和源项的数学定义。一个专门用于 LC 传播器的函数处理两种情况：非零截面（$\\Sigma_{t,i} \\neq 0$）和纯流出极限（$\\Sigma_{t,i}=0$），直接实现了问题陈述中提供的公式。这种模块化设计提高了清晰度和正确性。\n\n对问题中定义的五个测试案例中的每一个重复整个过程，并将得到的 RMS 误差收集起来用于最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef psi_manufactured(x, mu):\n    \"\"\"Calculates the manufactured angular flux psi(x, mu).\"\"\"\n    return 2.0 + np.sin(2.0 * np.pi * x) + mu * np.sin(np.pi * x)\n\ndef dpsi_dx_manufactured(x, mu):\n    \"\"\"Calculates the derivative of the manufactured flux, dpsi/dx.\"\"\"\n    return 2.0 * np.pi * np.cos(2.0 * np.pi * x) + mu * np.pi * np.cos(np.pi * x)\n\ndef q_manufactured(x, mu, sigma_val):\n    \"\"\"\n    Calculates the manufactured source q(x, mu) for a given constant \n    cross-section value.\n    \"\"\"\n    psi_val = psi_manufactured(x, mu)\n    dpsi_dx_val = dpsi_dx_manufactured(x, mu)\n    return mu * dpsi_dx_val + sigma_val * psi_val\n\ndef lc_propagate(psi_in, q0, q1, sigma, d):\n    \"\"\"\n    Propagates the angular flux across a distance d using the Linear\n    Characteristic method.\n    \"\"\"\n    if sigma == 0.0:\n        # Pure streaming case\n        return psi_in + q0 * d + 0.5 * q1 * d**2\n    else:\n        # Case with non-zero cross-section\n        exp_term = np.exp(-sigma * d)\n        \n        # To avoid catastrophic cancellation for small sigma*d, one could use\n        # Taylor expansions or functions like expm1, but direct implementation\n        # is sufficient for the given problem parameters.\n        psi_out = (\n            psi_in * exp_term\n            + (q0 / sigma) * (1.0 - exp_term)\n            + q1 * (d / sigma - (1.0 - exp_term) / sigma**2)\n        )\n        return psi_out\n\ndef calculate_rms_error(L, N, Sigma0, alpha):\n    \"\"\"\n    Implements the full LC transport sweep and computes the RMS error against\n    the manufactured solution.\n    \"\"\"\n    h = L / N\n    x_edges = np.linspace(0.0, L, N + 1)\n    x_centers = x_edges[:-1] + h / 2\n    \n    total_squared_error = 0.0\n\n    # Sweep for mu = +1 (forward)\n    mu = 1.0\n    psi_edge = psi_manufactured(0.0, mu)  # Inflow boundary condition at x=0\n\n    for i in range(N):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi, downstream is xi1\n        q_up = q_manufactured(xi, mu, sigma_ti)\n        q_down = q_manufactured(xi1, mu, sigma_ti)\n        q0 = q_up\n        q1 = (q_down - q_up) / h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n\n    # Sweep for mu = -1 (backward)\n    mu = -1.0\n    psi_edge = psi_manufactured(L, mu)  # Inflow boundary condition at x=L\n\n    for i in range(N - 1, -1, -1):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi1, downstream is xi\n        q_up = q_manufactured(xi1, mu, sigma_ti)\n        q_down = q_manufactured(xi, mu, sigma_ti)\n        q0 = q_up # Per problem spec, q0 is at upstream edge\n        q1 = (q_down - q_up) / h # -(q_up - q_down)/h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n        \n    rms_error = np.sqrt(total_squared_error / (2.0 * N))\n    return rms_error\n\ndef solve():\n    \"\"\"\n    Defines and runs the test cases, then prints the results in the\n    specified format.\n    \"\"\"\n    test_cases = [\n        # Case A: happy path\n        (1.0, 40, 1.0, 0.5),\n        # Case B: single cell boundary condition check\n        (1.0, 1, 1.0, 0.5),\n        # Case C: strong attenuation\n        (1.0, 40, 10.0, 0.0),\n        # Case D: refinement for convergence behavior\n        (1.0, 200, 1.0, 0.5),\n        # Case E: pure streaming limit\n        (1.0, 40, 0.0, 0.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        L, N, Sigma0, alpha = params\n        error = calculate_rms_error(L, N, Sigma0, alpha)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}