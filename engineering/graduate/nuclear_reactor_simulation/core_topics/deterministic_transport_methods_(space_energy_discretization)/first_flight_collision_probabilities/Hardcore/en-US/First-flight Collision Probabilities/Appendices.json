{
    "hands_on_practices": [
        {
            "introduction": "The calculation of first-flight collision probabilities between distinct regions is a cornerstone of the collision probability method in reactor analysis. This exercise guides you through the fundamental process of deriving and solving for this probability in a classic planar geometry scenario. By translating the physical principles of isotropic emission and exponential attenuation into a concrete integral form, you will then apply numerical quadrature to compute the probability, developing essential skills in both transport theory and scientific programming. ",
            "id": "4225749",
            "problem": "Consider two contiguous, infinite, homogeneous planar slabs in three-dimensional space, with a common planar interface aligned with the plane $x = 0$. Region $i$ occupies $x \\in [-d_i, 0]$ and region $j$ occupies $x \\in [0, d_j]$, where $d_i > 0$ and $d_j > 0$ are the slab thicknesses. The materials have macroscopic total cross sections $\\Sigma_{t,i}$ and $\\Sigma_{t,j}$, respectively, both measured in inverse centimeters. Neutrons are born uniformly in space throughout region $i$, with an isotropic angular distribution in the full sphere. A neutron travels along straight-line trajectories and undergoes exponential attenuation in each homogeneous region according to the well-tested law of exponential attenuation: the probability of survival without collision over a path length $s$ in a material with macroscopic total cross section $\\Sigma_t$ is $\\exp(-\\Sigma_t s)$. Assume no scattering between regions before the first collision, and assume that if a neutron exits region $j$ without colliding then it is lost.\n\nDefine the first-flight collision probability $P_{ij}^{(1)}$ as the probability that a neutron born in region $i$ undergoes its first collision in region $j$. Starting from the fundamental definitions above, and using a direction cosine $\\mu = \\cos\\theta$ with respect to the slab normal (aligned with the $+x$ axis), where the polar angle $\\theta$ is measured in radians, derive a mathematically correct expression for $P_{ij}^{(1)}$ in terms of integrals over the birth position $x \\in [-d_i, 0]$ and the angular variable $\\mu \\in [0, 1]$. Use the fact that for isotropic emission in three dimensions, the differential solid angle measure is $\\mathrm{d}\\Omega = 2\\pi\\,\\mathrm{d}\\mu$ and the directional probability density is $1/(4\\pi)$.\n\nImplement a program that computes $P_{ij}^{(1)}$ deterministically by:\n- Using ray tracing to evaluate the path length to the interface in region $i$ and the path length across region $j$ for a given direction cosine $\\mu$, and\n- Approximating the angular integral over $\\mu \\in [0, 1]$ with an $N$-point Gauss–Legendre quadrature on the half-range, where $N$ is a positive integer referred to as the angular order.\n\nAdditionally, estimate the quadrature error as a function of angular order $N$ by comparing the quadrature-based value of $P_{ij}^{(1)}$ to a high-accuracy reference computed via adaptive numerical integration of the same integral over $\\mu \\in [0, 1]$.\n\nPhysical units: slab thicknesses $d_i$ and $d_j$ must be expressed in centimeters, and macroscopic total cross sections $\\Sigma_{t,i}$ and $\\Sigma_{t,j}$ must be expressed in inverse centimeters. The angle $\\theta$ is measured in radians. The final quantity $P_{ij}^{(1)}$ is a dimensionless probability.\n\nYour program must evaluate the following test suite:\n- Test case A (baseline geometry and error study): $d_i = $ $2.0$ cm, $d_j = $ $3.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $1.2$ cm$^{-1}$. Compute the absolute quadrature error for $N \\in \\{\\,1,\\,2,\\,4,\\,8,\\,16,\\,32\\,\\}$ relative to a high-accuracy reference.\n- Test case B (vacuum target region): $d_i = $ $2.0$ cm, $d_j = $ $10.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $0.0$ cm$^{-1}$. Compute $P_{ij}^{(1)}$ using quadrature with $N = $ $16$.\n- Test case C (very thick and highly absorbing target region): $d_i = $ $2.0$ cm, $d_j = $ $50.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $10.0$ cm$^{-1}$. Compute $P_{ij}^{(1)}$ using quadrature with $N = $ $16$.\n- Test case D (extremely thin source region): $d_i = $ $0.01$ cm, $d_j = $ $3.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $1.2$ cm$^{-1}$. Compute $P_{ij}^{(1)}$ using quadrature with $N = $ $16$.\n\nError values and computed probabilities must be returned as floating-point numbers.\n\nFinal output format: Your program should produce a single line of output containing a comma-separated list enclosed in square brackets. The list must concatenate the $6$ absolute error values for Test case A in the order of increasing $N$, followed by the three $P_{ij}^{(1)}$ values for Test cases B, C, and D, in that order. For example, the output must have the form \"[error_N1,error_N2,error_N4,error_N8,error_N16,error_N32,P_vacuum,P_thick,P_thin]\".",
            "solution": "The problem is valid as it is scientifically grounded in the principles of neutron transport theory, is well-posed with sufficient information for a unique solution, and is expressed in objective, formal language. The provided parameters are physically realistic.\n\nThe first-flight collision probability, $P_{ij}^{(1)}$, is defined as the probability that a neutron born in region $i$ has its first collision in region $j$. This can be formulated as an integral over the phase space of the neutron source, which is uniform in position over region $i$ and isotropic in direction.\n\nLet a neutron be born at a position $x_0 \\in [-d_i, 0]$ with a direction characterized by the cosine of the polar angle, $\\mu = \\cos\\theta$, with respect to the positive $x$-axis. The source is isotropic, so the probability distribution of emission directions is uniform over the $4\\pi$ solid angle, with a probability density of $1/(4\\pi)$ per steradian. The differential solid angle element for azimuthally symmetric problems is $\\mathrm{d}\\Omega = 2\\pi\\,\\mathrm{d}\\mu$. Thus, the probability of a neutron being emitted with a direction cosine between $\\mu$ and $\\mu + \\mathrm{d}\\mu$ is $\\frac{2\\pi \\mathrm{d}\\mu}{4\\pi} = \\frac{1}{2} \\mathrm{d}\\mu$. The source is uniform in space, so the probability of birth in a differential element $\\mathrm{d}x_0$ is $\\mathrm{d}x_0/d_i$.\n\nA neutron born at $x_0$ with direction $\\mu$ can only reach region $j$ (where $x > 0$) if it is traveling in the positive $x$ direction, i.e., $\\mu > 0$. The probability $P_{ij}^{(1)}$ is therefore an average over all birth positions $x_0 \\in [-d_i, 0]$ and all forward directions $\\mu \\in [0, 1]$:\n$$ P_{ij}^{(1)} = \\int_{-d_i}^{0} \\frac{\\mathrm{d}x_0}{d_i} \\int_{0}^{1} \\frac{1}{2} P(\\text{collision in } j | x_0, \\mu) \\, \\mathrm{d}\\mu $$\nwhere $P(\\text{collision in } j | x_0, \\mu)$ is the conditional probability that a neutron born at $x_0$ with direction $\\mu$ has its first collision in region $j$.\n\nFor this event to occur, the neutron must:\n1.  Travel from its birth position $x_0$ to the interface at $x=0$ without colliding. The path length in region $i$ is $s_i = (0 - x_0)/\\mu = -x_0/\\mu$. The probability of surviving this path is given by the law of exponential attenuation: $P_{\\text{survival}, i} = \\exp(-\\Sigma_{t,i} s_i) = \\exp(\\Sigma_{t,i} x_0 / \\mu)$.\n2.  Enter region $j$ and have its first collision before exiting at $x=d_j$. The path length across region $j$ is $s_j = d_j/\\mu$. The probability of colliding within this path length is $1$ minus the probability of surviving it: $P_{\\text{collision}, j} = 1 - \\exp(-\\Sigma_{t,j} s_j) = 1 - \\exp(-\\Sigma_{t,j} d_j / \\mu)$.\n\nThe conditional probability is the product of these two independent events:\n$$ P(\\text{collision in } j | x_0, \\mu) = \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\left[1 - \\exp\\left(-\\frac{\\Sigma_{t,j} d_j}{\\mu}\\right)\\right] $$\nSubstituting this into the integral for $P_{ij}^{(1)}$ and reordering the integration gives:\n$$ P_{ij}^{(1)} = \\int_{0}^{1} \\frac{1}{2 d_i} \\left[1 - \\exp\\left(-\\frac{\\Sigma_{t,j} d_j}{\\mu}\\right)\\right] \\left( \\int_{-d_i}^{0} \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\mathrm{d}x_0 \\right) \\mathrm{d}\\mu $$\nThe inner integral over $x_0$ can be solved analytically. Let this integral be $J(\\mu)$:\n$$ J(\\mu) = \\int_{-d_i}^{0} \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\mathrm{d}x_0 $$\nTwo cases must be considered for the evaluation of $J(\\mu)$:\n- If $\\Sigma_{t,i} > 0$:\n$$ J(\\mu) = \\left[ \\frac{\\mu}{\\Sigma_{t,i}} \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\right]_{-d_i}^0 = \\frac{\\mu}{\\Sigma_{t,i}} \\left(1 - \\exp\\left(-\\frac{\\Sigma_{t,i} d_i}{\\mu}\\right)\\right) $$\n- If $\\Sigma_{t,i} = 0$ (a vacuum in region $i$):\n$$ J(\\mu) = \\int_{-d_i}^{0} 1 \\, \\mathrm{d}x_0 = d_i $$\nThis result can also be obtained by taking the limit of the first case as $\\Sigma_{t,i} \\to 0$.\n\nLet the integrand of the angular integral be $I(\\mu)$. It is given by:\n$$ I(\\mu) = \\frac{1}{2 d_i} \\left[1 - \\exp\\left(-\\frac{\\Sigma_{t,j} d_j}{\\mu}\\right)\\right] J(\\mu) $$\nThus, $P_{ij}^{(1)} = \\int_0^1 I(\\mu) \\, \\mathrm{d}\\mu$. This final integral over $\\mu$ does not have a closed-form solution in terms of elementary functions and must be evaluated numerically. The integrand $I(\\mu)$ is a smooth function for $\\mu \\in (0,1]$ and its limit is $0$ as $\\mu \\to 0^+$, making it well-suited for high-order quadrature methods.\n\nThe problem specifies using an $N$-point Gauss-Legendre quadrature. This method approximates an integral over the interval $[-1, 1]$ as a weighted sum: $\\int_{-1}^1 g(z)\\,\\mathrm{d}z \\approx \\sum_{k=1}^N w_k g(z_k)$, where $z_k$ and $w_k$ are the quadrature points and weights. To apply this to our integral over $[0, 1]$, we perform a change of variables: $\\mu = (z+1)/2$, which gives $\\mathrm{d}\\mu = \\mathrm{d}z/2$. The integral becomes:\n$$ P_{ij}^{(1)} = \\int_{-1}^{1} I\\left(\\frac{z+1}{2}\\right) \\frac{1}{2} \\, \\mathrm{d}z \\approx \\sum_{k=1}^{N} \\frac{w_k}{2} I\\left(\\frac{z_k+1}{2}\\right) $$\nThis deterministic calculation will be implemented for the specified test cases. For the error analysis in Test Case A, a high-accuracy reference value is computed using an adaptive quadrature routine (`scipy.integrate.quad`), which provides a benchmark against which the Gauss-Legendre quadrature results can be compared. The absolute error is then $|P_{ij,\\text{Gauss}}^{(1)} - P_{ij,\\text{ref}}^{(1)}|$.\n\nSpecial cases check the physical limits:\n- If region $j$ is a vacuum ($\\Sigma_{t,j} = 0$), then the term $1 - \\exp(-\\Sigma_{t,j} d_j / \\mu)$ is always zero. Thus, $I(\\mu) = 0$ and $P_{ij}^{(1)} = 0$, which is physically correct as no collisions can occur in a vacuum.\n- If region $j$ is very thick or highly absorbing ($\\Sigma_{t,j} d_j \\to \\infty$), then $1 - \\exp(-\\Sigma_{t,j} d_j / \\mu) \\to 1$ for all $\\mu > 0$. $P_{ij}^{(1)}$ then represents the total probability of a neutron escaping region $i$ into region $j$.\n- If region $i$ is very thin ($d_i \\to 0$), it approximates a planar source at the interface. The probability $P_{ij}^{(1)}$ for a thin source approaches that for a surface source.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\nfrom numpy.polynomial.legendre import leggauss\n\ndef solve():\n    \"\"\"\n    Solves the first-flight collision probability problem for the given test cases.\n    \"\"\"\n\n    def get_integrand_function(di, dj, sig_ti, sig_tj):\n        \"\"\"\n        Creates a vectorized function for the integrand of the angular integral.\n\n        The expression for P_ij^(1) is derived as:\n        P_ij = integral from 0 to 1 of I(mu) d(mu), where\n        I(mu) = (1 / (2 * di)) * (integral over x0) * (prob_collide_in_j)\n        \n        Args:\n            di (float): Thickness of region i (cm).\n            dj (float): Thickness of region j (cm).\n            sig_ti (float): Macroscopic total cross section of region i (cm^-1).\n            sig_tj (float): Macroscopic total cross section of region j (cm^-1).\n\n        Returns:\n            A function that computes the integrand I(mu) for a given mu (or array of mu).\n        \"\"\"\n        \n        def integrand(mu):\n            # The integrand is 0 at mu=0. Using a small epsilon to avoid division by zero.\n            mu = np.maximum(mu, 1e-15)\n\n            # Probability of collision in region j, given entry at x=0\n            prob_collide_in_j = 1.0 - np.exp(-sig_tj * dj / mu)\n\n            # Spatially averaged transmission probability through region i\n            # This is the integral over x0 from -di to 0 of exp(sig_ti * x0 / mu).\n            if sig_ti == 0.0:\n                # If region i is a vacuum, the integral evaluates to di\n                integral_x0 = np.full_like(mu, di)\n            else:\n                # Standard case\n                integral_x0 = (mu / sig_ti) * (1.0 - np.exp(-sig_ti * di / mu))\n\n            # The full integrand for the angular integral\n            # I(mu) = (1/2di) * J(mu) * P_coll,j\n            # where J(mu) is the spatial integral\n            integrand_val = (1.0 / (2.0 * di)) * integral_x0 * prob_collide_in_j\n            return integrand_val\n\n        return integrand\n\n    def calculate_p_ij_gauss(integrand_func, N):\n        \"\"\"\n        Calculates the integral using N-point Gauss-Legendre quadrature.\n        \"\"\"\n        # Get standard [-1, 1] points and weights\n        points, weights = leggauss(N)\n\n        # Transform points and weights for [0, 1] interval\n        mu_points = 0.5 * (points + 1.0)\n        mu_weights = 0.5 * weights\n        \n        # Evaluate integrand at quadrature points (vectorized)\n        integrand_values = integrand_func(mu_points)\n        \n        # Compute the weighted sum\n        integral = np.sum(mu_weights * integrand_values)\n        return integral\n\n    def get_reference_p_ij(integrand_func):\n        \"\"\"\n        Calculates a high-accuracy reference value using adaptive quadrature.\n        \"\"\"\n        ref_val, _ = quad(integrand_func, 0, 1, epsabs=1e-15, epsrel=1e-15, limit=200)\n        return ref_val\n\n    results = []\n\n    # Test case A: Baseline geometry and error study\n    di_A, dj_A, sig_ti_A, sig_tj_A = 2.0, 3.0, 0.8, 1.2\n    integrand_A = get_integrand_function(di_A, dj_A, sig_ti_A, sig_tj_A)\n    p_ij_ref_A = get_reference_p_ij(integrand_A)\n    \n    orders_N = [1, 2, 4, 8, 16, 32]\n    for N in orders_N:\n        p_ij_gauss = calculate_p_ij_gauss(integrand_A, N)\n        error = abs(p_ij_gauss - p_ij_ref_A)\n        results.append(error)\n\n    # Test case B: Vacuum target region\n    di_B, dj_B, sig_ti_B, sig_tj_B = 2.0, 10.0, 0.8, 0.0\n    integrand_B = get_integrand_function(di_B, dj_B, sig_ti_B, sig_tj_B)\n    p_ij_B = calculate_p_ij_gauss(integrand_B, N=16)\n    results.append(p_ij_B)\n\n    # Test case C: Very thick and highly absorbing target region\n    di_C, dj_C, sig_ti_C, sig_tj_C = 2.0, 50.0, 0.8, 10.0\n    integrand_C = get_integrand_function(di_C, dj_C, sig_ti_C, sig_tj_C)\n    p_ij_C = calculate_p_ij_gauss(integrand_C, N=16)\n    results.append(p_ij_C)\n    \n    # Test case D: Extremely thin source region\n    di_D, dj_D, sig_ti_D, sig_tj_D = 0.01, 3.0, 0.8, 1.2\n    integrand_D = get_integrand_function(di_D, dj_D, sig_ti_D, sig_tj_D)\n    p_ij_D = calculate_p_ij_gauss(integrand_D, N=16)\n    results.append(p_ij_D)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While homogeneous models are useful for initial analysis, real reactor components often feature materials with spatially varying properties. This practice extends the concept of first-flight collision probability to such heterogeneous media, where the macroscopic cross section $\\Sigma_t(x)$ is a function of position. You will implement a numerical solution that correctly handles the path-dependent optical thickness, providing a deeper understanding of how material non-uniformity impacts neutron transport and escape. ",
            "id": "4225747",
            "problem": "Consider one-speed neutron transport in a vacuum-bounded one-dimensional slab of thickness $L$ along the spatial coordinate $x \\in [0,L]$. A neutron is born at position $x_0$ with an isotropic angular distribution characterized by the direction cosine $\\mu \\in [-1,1]$ relative to the $+x$ axis. The total macroscopic cross section is spatially varying and denoted by $\\Sigma_t(x)$, with units of $\\mathrm{cm}^{-1}$. Assume vacuum at both boundaries $x=0$ and $x=L$ and neglect scattering, fission, and any energy dependence.\n\nStarting from the definition of exponential survival along straight characteristics, the probability that a neutron emitted at $x_0$ reaches a boundary without any collision depends on the optical path integral of $\\Sigma_t(x)$ along the chord to the boundary and the directional cosine magnitude $|\\mu|$. The first-flight collision probability at $x_0$ is defined as one minus the isotropic directional average of escape-to-boundary survival. You must compute this quantity by performing a numerical quadrature over angles $\\mu$ of the survival factor $\\exp\\big(-\\int \\Sigma_t(x)\\,dx/|\\mu|\\big)$, using the appropriate path from $x_0$ to the nearest boundary in the sign of $\\mu$.\n\nYour task is to implement a program that, for each specified case below, numerically evaluates:\n- The optical path integral $A_{\\text{left}}(x_0) = \\int_{0}^{x_0} \\Sigma_t(x)\\,dx$ (for $\\mu<0$) and $A_{\\text{right}}(x_0) = \\int_{x_0}^{L} \\Sigma_t(x)\\,dx$ (for $\\mu>0$), in $\\mathrm{cm}^{-1}\\cdot\\mathrm{cm}$ (unitless optical thickness).\n- The angular integrals over $\\mu \\in [0,1]$ of $\\exp(-A_{\\text{left}}/ \\mu)$ and $\\exp(-A_{\\text{right}}/ \\mu)$, each weighted by $1/2$ to reflect isotropic emission over negative and positive directions.\n- The first-flight collision probability at $x_0$ as $P_{\\text{collide}}(x_0) = 1 - \\frac{1}{2}\\int_{0}^{1}\\exp(-A_{\\text{left}}/\\mu)\\,d\\mu - \\frac{1}{2}\\int_{0}^{1}\\exp(-A_{\\text{right}}/\\mu)\\,d\\mu$.\n\nYou must carry out the angular quadrature numerically; do not introduce any closed-form shortcuts to bypass the $\\mu$-integration. Use physically consistent, nonnegative $\\Sigma_t(x)$.\n\nPhysical units requirement:\n- Express lengths $L$ and positions $x_0$ in $\\mathrm{cm}$.\n- Express $\\Sigma_t(x)$ in $\\mathrm{cm}^{-1}$.\n- Express each final first-flight collision probability as a dimensionless decimal (no percentage sign), rounded to $12$ decimal digits.\n\nTest suite:\nEvaluate $P_{\\text{collide}}(x_0)$ for the following five cases:\n- Case $1$ (baseline, symmetric, constant $\\Sigma_t$): $L = 10\\,\\mathrm{cm}$, $x_0 = 5\\,\\mathrm{cm}$, $\\Sigma_t(x) = 0.2\\,\\mathrm{cm}^{-1}$.\n- Case $2$ (linearly increasing $\\Sigma_t$): $L = 10\\,\\mathrm{cm}$, $x_0 = 2\\,\\mathrm{cm}$, $\\Sigma_t(x) = 0.1\\,(1 + 0.05\\,x)\\,\\mathrm{cm}^{-1}$, where $x$ is in $\\mathrm{cm}$.\n- Case $3$ (piecewise-constant $\\Sigma_t$ with absorber region): $L = 10\\,\\mathrm{cm}$, $x_0 = 3\\,\\mathrm{cm}$, $\\Sigma_t(x) = 0.05\\,\\mathrm{cm}^{-1}$ for $x \\in [0,4)\\,\\mathrm{cm}$ and $\\Sigma_t(x) = 0.5\\,\\mathrm{cm}^{-1}$ for $x \\in [4,10]\\,\\mathrm{cm}$.\n- Case $4$ (source at boundary): $L = 10\\,\\mathrm{cm}$, $x_0 = 0\\,\\mathrm{cm}$, $\\Sigma_t(x) = 0.2\\,\\mathrm{cm}^{-1}$.\n- Case $5$ (very weak interaction): $L = 10\\,\\mathrm{cm}$, $x_0 = 5\\,\\mathrm{cm}$, $\\Sigma_t(x) = 1\\times 10^{-4}\\,\\mathrm{cm}^{-1}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the cases above, with each value rounded to $12$ decimal digits (for example, \"[$0.123456789012$,$0.234567890123$,$0.345678901234$,$0.456789012345$,$0.567890123456$]\").",
            "solution": "The problem is valid as it is scientifically grounded in the principles of one-speed neutron transport theory, is well-posed with all necessary information provided, and is expressed in objective, formal language. We may therefore proceed with a solution.\n\nThe problem asks for the first-flight collision probability, $P_{\\text{collide}}(x_0)$, for a neutron born isotropically at a point $x_0$ within a one-dimensional slab of thickness $L$ defined by the spatial domain $x \\in [0, L]$. The slab has a spatially dependent total macroscopic cross section $\\Sigma_t(x)$ and is bounded by a vacuum.\n\nThe fundamental principle governing the process is the exponential attenuation of a neutral particle beam. The probability that a neutron travels a distance $s$ through a homogeneous medium with a total macroscopic cross section $\\Sigma_t$ without interacting is given by $e^{-\\Sigma_t s}$. For a heterogeneous medium, the term $\\Sigma_t s$ is replaced by the optical path length, $\\tau$, which is the integral of the macroscopic cross section along the particle's trajectory.\n\nA neutron born at $x_0$ with a direction cosine $\\mu = \\cos\\theta \\in [-1, 1]$ relative to the $+x$ axis travels along a straight line. The path length $ds$ is related to the displacement $dx$ along the axis by $ds = dx/|\\mu|$. The optical path length to travel from $x_a$ to $x_b$ is therefore:\n$$ \\tau = \\int_{\\text{path}} \\Sigma_t(s') ds' = \\frac{1}{|\\mu|} \\left| \\int_{x_a}^{x_b} \\Sigma_t(x') dx' \\right| $$\nThe probability of a neutron surviving the flight from its birth point $x_0$ to a boundary is thus dependent on its direction $\\mu$.\n- If $\\mu > 0$, the neutron travels towards the boundary at $x=L$. The survival probability is $P_{\\text{surv}}(\\mu>0) = \\exp\\left(-\\frac{1}{\\mu} \\int_{x_0}^{L} \\Sigma_t(x) dx\\right)$.\n- If $\\mu < 0$, the neutron travels towards the boundary at $x=0$. The survival probability is $P_{\\text{surv}}(\\mu<0) = \\exp\\left(-\\frac{1}{|\\mu|} \\int_0^{x_0} \\Sigma_t(x) dx\\right) = \\exp\\left(-\\frac{1}{-\\mu} \\int_0^{x_0} \\Sigma_t(x) dx\\right)$.\n\nLet us define the optical thickness from the point $x_0$ to the left and right boundaries as:\n$$ A_{\\text{left}}(x_0) = \\int_{0}^{x_0} \\Sigma_t(x) dx $$\n$$ A_{\\text{right}}(x_0) = \\int_{x_0}^{L} \\Sigma_t(x) dx $$\nThe survival probabilities can be written as:\n$$ P_{\\text{surv}}(\\mu>0) = \\exp\\left(-\\frac{A_{\\text{right}}(x_0)}{\\mu}\\right) $$\n$$ P_{\\text{surv}}(\\mu<0) = \\exp\\left(-\\frac{A_{\\text{left}}(x_0)}{|\\mu|}\\right) $$\n\nThe problem states the neutron is born with an isotropic angular distribution. In one dimension, this corresponds to a uniform probability distribution for the direction cosine $\\mu$ over its range, i.e., $p(\\mu) = 1/2$ for $\\mu \\in [-1, 1]$. The total escape probability, $P_{\\text{esc}}(x_0)$, is the survival probability averaged over all possible directions:\n$$ P_{\\text{esc}}(x_0) = \\int_{-1}^{1} P_{\\text{surv}}(\\mu) p(\\mu) d\\mu = \\frac{1}{2} \\int_{-1}^{1} P_{\\text{surv}}(\\mu) d\\mu $$\nWe split the integral into negative and positive $\\mu$ ranges:\n$$ P_{\\text{esc}}(x_0) = \\frac{1}{2} \\int_{-1}^{0} \\exp\\left(-\\frac{A_{\\text{left}}(x_0)}{|\\mu|}\\right) d\\mu + \\frac{1}{2} \\int_{0}^{1} \\exp\\left(-\\frac{A_{\\text{right}}(x_0)}{\\mu}\\right) d\\mu $$\nIn the first integral, we perform a change of variables $\\mu' = -\\mu$. This gives $d\\mu = -d\\mu'$ and the integration limits change from $[-1, 0]$ to $[1, 0]$.\n$$ \\int_{-1}^{0} \\exp\\left(-\\frac{A_{\\text{left}}(x_0)}{-\\mu}\\right) d\\mu = \\int_{1}^{0} \\exp\\left(-\\frac{A_{\\text{left}}(x_0)}{\\mu'}\\right) (-d\\mu') = \\int_{0}^{1} \\exp\\left(-\\frac{A_{\\text{left}}(x_0)}{\\mu'}\\right) d\\mu' $$\nSubstituting this back, and using $\\mu$ as the integration variable for both terms, we obtain the expression for the total escape probability:\n$$ P_{\\text{esc}}(x_0) = \\frac{1}{2} \\int_{0}^{1} \\exp\\left(-\\frac{A_{\\text{left}}(x_0)}{\\mu}\\right) d\\mu + \\frac{1}{2} \\int_{0}^{1} \\exp\\left(-\\frac{A_{\\text{right}}(x_0)}{\\mu}\\right) d\\mu $$\nThe first-flight collision probability is the complement of the escape probability:\n$$ P_{\\text{collide}}(x_0) = 1 - P_{\\text{esc}}(x_0) = 1 - \\frac{1}{2} \\int_{0}^{1} \\exp\\left(-\\frac{A_{\\text{left}}(x_0)}{\\mu}\\right) d\\mu - \\frac{1}{2} \\int_{0}^{1} \\exp\\left(-\\frac{A_{\\text{right}}(x_0)}{\\mu}\\right) d\\mu $$\nThis matches the formula provided in the problem statement.\n\nTo solve this numerically, we will proceed as follows for each test case:\n1.  Define the function for the macroscopic cross section $\\Sigma_t(x)$ based on the case parameters.\n2.  Numerically compute the optical thicknesses $A_{\\text{left}}(x_0)$ and $A_{\\text{right}}(x_0)$ by integrating $\\Sigma_t(x)$ over the intervals $[0, x_0]$ and $[x_0, L]$ respectively. The `scipy.integrate.quad` function is suitable for this purpose.\n3.  Define the integrands for the angular-averaging integrals, $f_{\\text{left}}(\\mu) = \\exp(-A_{\\text{left}}/\\mu)$ and $f_{\\text{right}}(\\mu) = \\exp(-A_{\\text{right}}/\\mu)$. A special case arises if an optical thickness is zero (e.g., $A_{\\text{left}}=0$ if $x_0=0$). In this case, the integrand becomes $\\exp(0)=1$, and the corresponding integral evaluates to $\\int_0^1 1\\,d\\mu = 1$.\n4.  Numerically compute the two angular integrals over $\\mu \\in [0, 1]$ using `scipy.integrate.quad`. The integrands have a convergent singularity at $\\mu=0$ (for non-zero optical thickness), which `quad` can handle effectively.\n5.  Combine the numerical results using the derived formula for $P_{\\text{collide}}(x_0)$.\n6.  Format the final result to the required precision of $12$ decimal digits.\n\nThis procedure will be applied to each of the five specified test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the first-flight collision probability problem for a set of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (L, x0, sigma_t_function)\n    # L and x0 are in cm, sigma_t_function returns values in cm^-1.\n    test_cases = [\n        # Case 1: baseline, symmetric, constant Sigma_t\n        (10.0, 5.0, lambda x: 0.2),\n        \n        # Case 2: linearly increasing Sigma_t\n        (10.0, 2.0, lambda x: 0.1 * (1.0 + 0.05 * x)),\n        \n        # Case 3: piecewise-constant Sigma_t with absorber region\n        (10.0, 3.0, lambda x: 0.05 if x < 4.0 else 0.5),\n        \n        # Case 4: source at boundary\n        (10.0, 0.0, lambda x: 0.2),\n        \n        # Case 5: very weak interaction\n        (10.0, 5.0, lambda x: 1.0e-4)\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, x0, sigma_t_func = case\n\n        # Step 1: Numerically compute the optical path integrals A_left and A_right.\n        # A_left is the integral of Sigma_t(x) from 0 to x0.\n        A_left, _ = integrate.quad(sigma_t_func, 0, x0)\n        \n        # A_right is the integral of Sigma_t(x) from x0 to L.\n        A_right, _ = integrate.quad(sigma_t_func, x0, L)\n\n        # Step 2: Numerically compute the angular integrals of the escape probabilities.\n        # The integrand is exp(-A/mu).\n        \n        # Integral for the leftward escape component.\n        # Handle the special case where A_left is zero (e.g., x0=0).\n        # In this case, exp(-0/mu) = 1, and the integral from 0 to 1 is 1.\n        if np.isclose(A_left, 0.0):\n            escape_integral_left = 1.0\n        else:\n            integrand_left = lambda mu: np.exp(-A_left / mu)\n            # The integrand approaches 0 as mu -> 0+, which quad handles well.\n            escape_integral_left, _ = integrate.quad(integrand_left, 0, 1)\n\n        # Integral for the rightward escape component.\n        # Handle the special case where A_right is zero (e.g., x0=L).\n        if np.isclose(A_right, 0.0):\n            escape_integral_right = 1.0\n        else:\n            integrand_right = lambda mu: np.exp(-A_right / mu)\n            escape_integral_right, _ = integrate.quad(integrand_right, 0, 1)\n\n        # Step 3: Calculate the first-flight collision probability.\n        # P_collide = 1 - P_escape\n        # P_escape = 0.5 * integral_left + 0.5 * integral_right\n        p_escape = 0.5 * escape_integral_left + 0.5 * escape_integral_right\n        p_collide = 1.0 - p_escape\n        \n        results.append(p_collide)\n\n    # Final print statement in the exact required format.\n    # Each value is rounded and formatted to 12 decimal places.\n    formatted_results = [f\"{r:.12f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This advanced exercise introduces a powerful modeling technique used in homogenization theory to simplify complex boundary effects. You will explore how a seemingly intricate process, like partial leakage from a convex body, can be elegantly represented by an effective, spatially uniform cross section. By applying principles from integral geometry and statistics, this practice develops your ability to formulate efficient, approximate models for complex transport phenomena, a crucial skill in practical reactor analysis. ",
            "id": "4225707",
            "problem": "Consider a homogeneous, isotropically emitting and attenuating medium occupying a convex body of volume $V$ and surface area $S$. Neutrons travel in straight lines between interactions, with free-flight governed by the macroscopic total cross section $\\Sigma_{t}$ (units $\\text{cm}^{-1}$). The boundary is partially transparent: upon each boundary crossing, a neutron leaks (is lost) with probability $P_{\\text{leak}} \\in (0,1)$; with probability $1 - P_{\\text{leak}}$ it is perfectly returned to the medium and immediately re-isotropized (no energy change).\n\nStarting from the free-path exponential law and the well-tested geometric fact that, for isotropic straight-flight inside a convex body, the expected number of boundary crossings per unit path length equals $S/(4V)$, show that the partially transparent boundary can be modeled as an additional, path-length-homogeneous attenuation with an effective attenuation coefficient. Then, using the principle of independent competing hazards, derive the adjusted first-flight collision probability $P^{(1)}$ that the neutron’s first terminating event is a material collision (not leakage), expressed in terms of $\\Sigma_{t}$, $S/V$, and $P_{\\text{leak}}$.\n\nFinally, evaluate $P^{(1)}$ numerically for a plane-parallel slab of thickness $T$ with large lateral extent (so that edge effects are negligible). For such a slab, take $S/V = 2/T$. Use $T = 5\\,\\text{cm}$, $\\Sigma_{t} = 0.8\\,\\text{cm}^{-1}$, and $P_{\\text{leak}} = 0.3$. Express the final numerical value of $P^{(1)}$ as a dimensionless decimal rounded to four significant figures.",
            "solution": "The problem statement is evaluated for validity before attempting a solution.\n\n**Step 1: Extract Givens**\n- Medium: Homogeneous, isotropically emitting and attenuating.\n- Geometry: Convex body of volume $V$ and surface area $S$.\n- Material interaction: Governed by macroscopic total cross section $\\Sigma_t$ (units $\\text{cm}^{-1}$).\n- Boundary condition: Partially transparent.\n- Leakage probability per boundary crossing: $P_{\\text{leak}} \\in (0,1)$.\n- Return probability per boundary crossing: $1 - P_{\\text{leak}}$.\n- Geometric property: For isotropic straight-flight inside a convex body, the expected number of boundary crossings per unit path length is $S/(4V)$.\n- Task 1: Show the boundary can be modeled as an effective path-length-homogeneous attenuation coefficient.\n- Task 2: Derive the adjusted first-flight collision probability $P^{(1)}$ in terms of $\\Sigma_t$, $S/V$, and $P_{\\text{leak}}$.\n- Task 3: Numerically evaluate $P^{(1)}$ for a plane-parallel slab of thickness $T$.\n- Slab-specific geometry: For a large slab, $S/V = 2/T$.\n- Numerical values: $T = 5\\,\\text{cm}$, $\\Sigma_t = 0.8\\,\\text{cm}^{-1}$, $P_{\\text{leak}} = 0.3$.\n- Final numerical result requirement: Rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in the principles of neutron transport theory. Key concepts such as the macroscopic cross section, mean free path, and first-flight collision probability are standard in nuclear engineering. The geometric fact provided, that the expected number of boundary crossings per unit path length is $S/(4V)$, is a well-established result from integral geometry, related to Cauchy's mean chord length theorem ($\\bar{\\ell} = 4V/S$). Modeling boundary leakage as an effective, spatially-homogeneous cross section is a common and valid approximation technique (often used in homogenization). The use of the principle of independent competing hazards is a standard statistical method for dealing with multiple, concurrent decay or removal processes. The problem is well-posed, providing all necessary information for a unique solution. The language is objective and precise. Therefore, the problem is deemed valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution proceeds.\n\nThe solution is developed in three parts as requested by the problem statement.\n\nFirst, we model the effect of the partially transparent boundary as an effective attenuation coefficient. A neutron traveling in the medium can be removed by two distinct stochastic processes: a collision with a nucleus in the material, or leakage through the boundary. The probability per unit path length of a material collision is given by the macroscopic total cross section, $\\Sigma_t$.\n\nThe problem states that the expected number of boundary crossings per unit path length is $\\frac{S}{4V}$. Let's denote this rate of boundary encounters as $\\lambda_{\\text{boundary}}$.\n$$\n\\lambda_{\\text{boundary}} = \\frac{S}{4V}\n$$\nThis rate has units of $\\text{length}^{-1}$. Each time a neutron crosses the boundary, there is a probability $P_{\\text{leak}}$ that it leaks and is removed from the system. We can model the sequence of boundary crossings as a Poisson process in path length with rate $\\lambda_{\\text{boundary}}$. The leakage events are a subset of these crossings, where each crossing constitutes an independent trial with a \"success\" (leakage) probability of $P_{\\text{leak}}$. This is a classic example of thinning a Poisson process. The rate of leakage events, which we can define as an effective macroscopic leakage cross section $\\Sigma_{\\text{leak}}$, is the product of the rate of boundary crossings and the probability of leakage per crossing.\n$$\n\\Sigma_{\\text{leak}} = \\lambda_{\\text{boundary}} \\times P_{\\text{leak}} = \\left(\\frac{S}{4V}\\right) P_{\\text{leak}}\n$$\nThis $\\Sigma_{\\text{leak}}$ represents a path-length-homogeneous probability per unit length of a neutron being removed from the system via leakage. This demonstrates that the boundary leakage can be modeled as an additional attenuation coefficient, independent of the neutron's position or direction (due to the isotropic re-emission assumption and the nature of the geometric average).\n\nSecond, we derive the adjusted first-flight collision probability, $P^{(1)}$. The \"first flight\" of a neutron ends with its first terminating event. In this modified system, there are two independent, competing terminating events:\n$1$. Material collision, occurring with a rate (probability per unit path length) of $\\Sigma_t$.\n$2$. Boundary leakage, occurring with an effective rate of $\\Sigma_{\\text{leak}}$.\n\nAccording to the principle of independent competing hazards, the total rate of any terminating event, $\\Sigma_{\\text{total}}$, is the sum of the rates of the individual competing processes.\n$$\n\\Sigma_{\\text{total}} = \\Sigma_t + \\Sigma_{\\text{leak}}\n$$\nThe probability that the first event to occur is of a specific type (in this case, a material collision) is the ratio of that event's rate to the total rate of all events. Therefore, the first-flight collision probability, $P^{(1)}$, is given by:\n$$\nP^{(1)} = \\frac{\\text{Rate of material collision}}{\\text{Total rate of termination}} = \\frac{\\Sigma_t}{\\Sigma_{\\text{total}}}\n$$\nSubstituting the expressions for the rates, we obtain:\n$$\nP^{(1)} = \\frac{\\Sigma_t}{\\Sigma_t + \\Sigma_{\\text{leak}}}\n$$\nFinally, expressing this in terms of the given parameters $\\Sigma_t$, $S/V$, and $P_{\\text{leak}}$:\n$$\nP^{(1)} = \\frac{\\Sigma_t}{\\Sigma_t + \\frac{S P_{\\text{leak}}}{4V}}\n$$\nThis is the desired analytical expression for the adjusted first-flight collision probability.\n\nThird, we evaluate $P^{(1)}$ numerically for the specified case of a large plane-parallel slab. The given parameters are:\n- Slab thickness $T = 5\\,\\text{cm}$.\n- Macroscopic total cross section $\\Sigma_t = 0.8\\,\\text{cm}^{-1}$.\n- Leakage probability per crossing $P_{\\text{leak}} = 0.3$.\n- For this geometry, the surface-area-to-volume ratio is $S/V = 2/T$.\n\nFirst, we calculate the numerical value for $S/V$:\n$$\n\\frac{S}{V} = \\frac{2}{T} = \\frac{2}{5\\,\\text{cm}} = 0.4\\,\\text{cm}^{-1}\n$$\nNext, we calculate the effective leakage cross section, $\\Sigma_{\\text{leak}}$:\n$$\n\\Sigma_{\\text{leak}} = \\frac{S P_{\\text{leak}}}{4V} = \\frac{1}{4} \\left(\\frac{S}{V}\\right) P_{\\text{leak}} = \\frac{1}{4} (0.4\\,\\text{cm}^{-1}) (0.3) = (0.1\\,\\text{cm}^{-1}) (0.3) = 0.03\\,\\text{cm}^{-1}\n$$\nNow, we can calculate the numerical value of $P^{(1)}$:\n$$\nP^{(1)} = \\frac{\\Sigma_t}{\\Sigma_t + \\Sigma_{\\text{leak}}} = \\frac{0.8\\,\\text{cm}^{-1}}{0.8\\,\\text{cm}^{-1} + 0.03\\,\\text{cm}^{-1}} = \\frac{0.8}{0.83}\n$$\nPerforming the division:\n$$\nP^{(1)} = \\frac{0.8}{0.83} \\approx 0.96385542...\n$$\nThe problem requires the result to be rounded to four significant figures.\n$$\nP^{(1)} \\approx 0.9639\n$$\nThis is the final numerical value for the first-flight collision probability under the specified conditions.",
            "answer": "$$\\boxed{0.9639}$$"
        }
    ]
}