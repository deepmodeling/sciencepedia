{
    "hands_on_practices": [
        {
            "introduction": "本练习在解析概率和蒙特卡罗模拟之间建立了基础性的联系。通过分析一个简化的单向中子束场景，您将首先从第一性原理出发，推导出首次飞行碰撞概率的解析解。接着，您将为其构建一个无偏的蒙特卡罗估计量，这有助于您深入理解模拟结果的统计性质及其方差 ()。",
            "id": "4225715",
            "problem": "考虑一个一维单能中子输运场景，该场景包含由平行平面界定的两个相邻的均匀平面区域，记为区域 $i$ 和区域 $j$。区域 $i$ 的厚度为 $\\ell_{i}$，宏观总截面为 $\\Sigma_{t,i}$；区域 $j$ 的厚度为 $\\ell_{j}$，宏观总截面为 $\\Sigma_{t,j}$。位于区域 $i$ 左侧外边界的中子源注入沿 $+x$ 方向确定性运动的中子。忽略能量变化和散射重定向；将飞行路径上的碰撞建模为一个空间泊松过程，其强度等于当地的宏观总截面。定义光学厚度为 $\\tau_{i} = \\Sigma_{t,i} \\,\\ell_{i}$ 和 $\\tau_{j} = \\Sigma_{t,j} \\,\\ell_{j}$。令 $P_{ij}^{(1)}$ 表示中子在区域 $j$ 中发生首次碰撞的概率。\n\n仅使用指数衰减和碰撞的空间泊松过程的基本定义，完成以下任务：\n\n- 从第一性原理出发，用 $\\tau_{i}$ 和 $\\tau_{j}$ 推导出事件概率 $P_{ij}^{(1)}$。\n- 为 $P_{ij}^{(1)}$ 构建一个蒙特卡罗(MC)碰撞估计量，当且仅当首次碰撞发生在区域 $j$ 时，该估计量得分为 $1$，否则为 $0$。证明该估计量是无偏的。\n- 分析该估计量的方差，将其表示为光学厚度 $\\tau_{i}$ 和 $\\tau_{j}$ 的函数，并提供一个用 $\\tau_{i}$ 和 $\\tau_{j}$ 表示方差的单一闭式解析表达式。\n\n你的最终答案必须是一个单一的闭式解析表达式。不要包含任何单位，也不要四舍五入；不需要进行数值计算。",
            "solution": "该问题要求推导首次碰撞概率，构建并证明一个用于该概率的蒙特卡罗(MC)估计量的合理性，并分析该估计量的方差。整个分析基于中子输运的第一性原理，特别是将碰撞建模为空间泊松过程的模型。\n\n首先，我们推导概率 $P_{ij}^{(1)}$，即一个从区域 $i$ 左边界出发并沿 $+x$ 方向运动的中子，在相邻的区域 $j$ 中经历其首次碰撞的概率。问题陈述，沿中子路径的碰撞由一个空间泊松过程控制，其强度等于当地的宏观总截面 $\\Sigma_t(x)$。\n\n该模型的基本推论是，在一个截面为 $\\Sigma_t$ 的均匀介质中，中子穿行长度为 $d$ 的路径而存活（即不发生碰撞）的概率由 $\\exp(-\\Sigma_t d)$ 给出。更一般地，对于非均匀介质，从中 $x=0$ 到 $x=L$ 的路径上的存活概率为 $S(L) = \\exp(-\\tau(L))$，其中 $\\tau(L) = \\int_0^L \\Sigma_t(x') dx'$ 是该路径的光学厚度。\n\n事件“首次碰撞发生在区域 $j$”可以分解为两个必要且连续的事件：\n1. 中子必须穿过整个区域 $i$ 而不发生碰撞。\n2. 进入区域 $j$ 后，中子必须在区域 $j$ 内发生其首次碰撞。\n\n让我们计算这两个事件的概率。\n区域 $i$ 的光学厚度定义为 $\\tau_{i} = \\Sigma_{t,i} \\ell_{i}$。中子穿过区域 $i$（从 $x=0$ 到 $x=\\ell_i$）而不发生碰撞的概率由存活概率给出：\n$$P(\\text{survival through } i) = \\exp(-\\Sigma_{t,i} \\ell_{i}) = \\exp(-\\tau_{i})$$\n\n鉴于中子已穿过区域 $i$ 并进入区域 $j$，其在区域 $j$ 内发生碰撞的概率与它穿过区域 $j$ 而存活的概率是互补的。区域 $j$ 的光学厚度是 $\\tau_{j} = \\Sigma_{t,j} \\ell_{j}$。进入区域 $j$ 的中子穿过其整个厚度 $\\ell_j$ 而存活的概率是 $\\exp(-\\tau_j)$。因此，它在区域 $j$ 内某处发生碰撞的概率是：\n$$P(\\text{collision in } j | \\text{survival through } i) = 1 - \\exp(-\\Sigma_{t,j} \\ell_{j}) = 1 - \\exp(-\\tau_{j})$$\n由于泊松过程是无记忆的，穿过区域 $i$ 而存活的事件与随后在区域 $j$ 中碰撞的事件是独立的。总概率 $P_{ij}^{(1)}$ 是它们各自概率的乘积：\n$$P_{ij}^{(1)} = P(\\text{survival through } i) \\times P(\\text{collision in } j | \\text{survival through } i) = \\exp(-\\tau_{i}) (1 - \\exp(-\\tau_{j}))$$\n\n接下来，我们为 $P_{ij}^{(1)}$ 构建一个 MC 碰撞估计量，并证明其无偏性。问题指定了一个估计量，如果首次碰撞发生在区域 $j$，则得分为 $1$，否则为 $0$。设这个估计量为随机变量 $I$。这是所讨论事件的一个指示变量：\n$$I = \\begin{cases} 1  \\text{if the first collision is in region } j \\\\ 0  \\text{otherwise} \\end{cases}$$\n如果一个量 $\\theta$ 的估计量 $\\hat{\\theta}$ 的期望值 $E[\\hat{\\theta}]$ 等于 $\\theta$，则该估计量是无偏的。这里，我们必须证明 $E[I] = P_{ij}^{(1)}$。\n根据离散随机变量的期望值定义，我们有：\n$$E[I] = \\sum_{k \\in \\{0,1\\}} k \\cdot P(I=k) = (1) \\cdot P(I=1) + (0) \\cdot P(I=0) = P(I=1)$$\n事件 $I=1$ 正是“首次碰撞发生在区域 $j$”的事件。根据定义，此事件的概率为 $P_{ij}^{(1)}$。因此，\n$$E[I] = P(I=1) = P_{ij}^{(1)}$$\n这证实了所提出的估计量 $I$ 是概率 $P_{ij}^{(1)}$ 的一个无偏估计量。\n\n最后，我们分析这个估计量的方差。任何随机变量 $X$ 的方差由公式 $\\text{Var}(X) = E[X^2] - (E[X])^2$ 给出。对于我们的估计量 $I$，方差为 $\\text{Var}(I) = E[I^2] - (E[I])^2$。\n由于 $I$ 是一个指示变量，其唯一可能的值是 $0$ 和 $1$。因此，$I^2$ 与 $I$ 相同，因为 $0^2=0$ 和 $1^2=1$。这意味着 $E[I^2] = E[I]$。\n将此代入方差公式，得到：\n$$\\text{Var}(I) = E[I] - (E[I])^2$$\n我们已经确定 $E[I] = P_{ij}^{(1)}$。为简化符号，令 $p = P_{ij}^{(1)}$。估计量的方差为：\n$$\\text{Var}(I) = p - p^2 = p(1-p)$$\n这是成功概率为 $p$ 的伯努利随机变量的著名方差。\n为了得到以给定光学厚度表示的最终表达式，我们代入推导出的 $p = P_{ij}^{(1)}$ 的表达式：\n$$p = \\exp(-\\tau_{i})(1 - \\exp(-\\tau_{j}))$$\n因此，估计量的方差为：\n$$\\text{Var}(I) = \\left[ \\exp(-\\tau_{i})(1 - \\exp(-\\tau_{j})) \\right] \\left[ 1 - \\exp(-\\tau_{i})(1 - \\exp(-\\tau_{j})) \\right]$$\n这就是所要求的、作为 $\\tau_i$ 和 $\\tau_j$ 函数的指定MC估计量方差的单一闭式解析表达式。",
            "answer": "$$\\boxed{\\left( \\exp(-\\tau_{i})(1 - \\exp(-\\tau_{j})) \\right) \\left( 1 - \\exp(-\\tau_{i})(1 - \\exp(-\\tau_{j})) \\right)}$$"
        },
        {
            "introduction": "在掌握基础之后，本实践将处理一个更贴近实际的各向同性中子源情景，这是反应堆分析的基石。您将学习如何将碰撞概率表述为对所有出射角度的积分，并使用高斯-勒让德求积法这一强大的确定论方法进行数值求解。此练习旨在锻炼您实现数值积分并分析其精度的实践技能 ()。",
            "id": "4225749",
            "problem": "考虑三维空间中两个相邻的无限均匀平面板，其公共平面界面与平面 $x = 0$ 对齐。区域 $i$ 占据 $x \\in [-d_i, 0]$，区域 $j$ 占据 $x \\in [0, d_j]$，其中 $d_i > 0$ 和 $d_j > 0$ 是板层厚度。这两种材料的宏观总截面分别为 $\\Sigma_{t,i}$ 和 $\\Sigma_{t,j}$，单位均为反厘米。中子在区域 $i$ 的整个空间内均匀产生，其角分布在全球面上是各向同性的。中子沿直线轨迹运动，在每个均匀区域中根据经过充分验证的指数衰减定律发生指数衰减：在宏观总截面为 $\\Sigma_t$ 的材料中，沿路程长度 $s$ 无碰撞存活的概率为 $\\exp(-\\Sigma_t s)$。假设首次碰撞前区域间无散射，并假设如果一个中子未经碰撞离开区域 $j$，则视为丢失。\n\n定义首次飞行碰撞概率 $P_{ij}^{(1)}$ 为一个在区域 $i$ 中产生的中子在区域 $j$ 中发生其首次碰撞的概率。从上述基本定义出发，使用相对于板层法线（与$+x$轴对齐）的方向余弦 $\\mu = \\cos\\theta$（其中极角 $\\theta$ 以弧度为单位），推导出一个关于产生位置 $x \\in [-d_i, 0]$ 和角变量 $\\mu \\in [0, 1]$ 的积分的数学上正确的 $P_{ij}^{(1)}$ 表达式。利用三维各向同性发射中，立体角微元为 $\\mathrm{d}\\Omega = 2\\pi\\,\\mathrm{d}\\mu$，方向概率密度为 $1/(4\\pi)$ 这一事实。\n\n实现一个程序，通过以下方式确定性地计算 $P_{ij}^{(1)}$：\n- 对于给定的方向余弦 $\\mu$，使用射线追踪来评估区域 $i$ 中到达界面的路程长度和穿越区域 $j$ 的路程长度，以及\n- 使用半程上的 $N$ 点高斯-勒让德求积来近似角变量在 $\\mu \\in [0, 1]$ 上的积分，其中 $N$ 是一个称为角阶数的正整数。\n\n此外，通过将基于求积的 $P_{ij}^{(1)}$ 值与通过对同一积分在 $\\mu \\in [0, 1]$ 上进行自适应数值积分计算出的高精度参考值进行比较，来估计求积误差作为角阶数 $N$ 的函数。\n\n物理单位：板层厚度 $d_i$ 和 $d_j$ 必须以厘米表示，宏观总截面 $\\Sigma_{t,i}$ 和 $\\Sigma_{t,j}$ 必须以反厘米表示。角度 $\\theta$ 以弧度为单位。最终量 $P_{ij}^{(1)}$ 是一个无量纲的概率。\n\n您的程序必须评估以下测试套件：\n- 测试用例 A（基准几何形状和误差研究）：$d_i = $ $2.0$ cm, $d_j = $ $3.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $1.2$ cm$^{-1}$。计算 $N \\in \\{\\,1,\\,2,\\,4,\\,8,\\,16,\\,32\\,\\}$ 时相对于高精度参考值的绝对求积误差。\n- 测试用例 B（真空目标区域）：$d_i = $ $2.0$ cm, $d_j = $ $10.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $0.0$ cm$^{-1}$。使用 $N = $ $16$ 的求积计算 $P_{ij}^{(1)}$。\n- 测试用例 C（极厚且强吸收的目标区域）：$d_i = $ $2.0$ cm, $d_j = $ $50.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $10.0$ cm$^{-1}$。使用 $N = $ $16$ 的求积计算 $P_{ij}^{(1)}$。\n- 测试用例 D（极薄源区域）：$d_i = $ $0.01$ cm, $d_j = $ $3.0$ cm, $\\Sigma_{t,i} = $ $0.8$ cm$^{-1}$, $\\Sigma_{t,j} = $ $1.2$ cm$^{-1}$。使用 $N = $ $16$ 的求积计算 $P_{ij}^{(1)}$。\n\n误差值和计算出的概率必须以浮点数形式返回。\n\n最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序连接测试用例 A 的 6 个绝对误差值（按 $N$ 递增的顺序），然后是测试用例 B、C 和 D 的三个 $P_{ij}^{(1)}$ 值。例如，输出必须具有以下形式：\"[error_N1,error_N2,error_N4,error_N8,error_N16,error_N32,P_vacuum,P_thick,P_thin]\"。",
            "solution": "该问题是有效的，因为它科学地基于中子输运理论的原理，问题陈述清晰且信息充分，可得出唯一解，并以客观、正式的语言表达。所提供的参数在物理上是现实的。\n\n首次飞行碰撞概率 $P_{ij}^{(1)}$ 定义为在区域 $i$ 中产生的中子在区域 $j$ 中发生首次碰撞的概率。这可以表述为对中子源相空间的积分，该源在区域 $i$ 上位置均匀，方向上各向同性。\n\n设一个中子在位置 $x_0 \\in [-d_i, 0]$ 产生，其方向由相对于正 $x$ 轴的极角余弦 $\\mu = \\cos\\theta$ 来表征。源是各向同性的，因此发射方向的概率分布在 $4\\pi$ 立体角上是均匀的，其概率密度为每球面度 $1/(4\\pi)$。对于方位角对称问题，立体角微元为 $\\mathrm{d}\\Omega = 2\\pi\\,\\mathrm{d}\\mu$。因此，一个中子以介于 $\\mu$ 和 $\\mu + \\mathrm{d}\\mu$ 之间的方向余弦发射的概率为 $\\frac{2\\pi \\mathrm{d}\\mu}{4\\pi} = \\frac{1}{2} \\mathrm{d}\\mu$。源在空间上是均匀的，因此在微元 $\\mathrm{d}x_0$ 中产生的概率为 $\\mathrm{d}x_0/d_i$。\n\n一个在 $x_0$ 处以方向 $\\mu$ 产生的中子，只有当它沿正 $x$ 方向行进时，即 $\\mu > 0$，才能到达区域 $j$（其中 $x > 0$）。因此，概率 $P_{ij}^{(1)}$ 是对所有产生位置 $x_0 \\in [-d_i, 0]$ 和所有前向方向 $\\mu \\in [0, 1]$ 的平均值：\n$$ P_{ij}^{(1)} = \\int_{-d_i}^{0} \\frac{\\mathrm{d}x_0}{d_i} \\int_{0}^{1} \\frac{1}{2} P(\\text{collision in } j | x_0, \\mu) \\, \\mathrm{d}\\mu $$\n其中 $P(\\text{collision in } j | x_0, \\mu)$ 是一个在 $x_0$ 处以方向 $\\mu$ 产生的中子在区域 $j$ 中发生其首次碰撞的条件概率。\n\n要发生此事件，中子必须：\n1.  从其产生位置 $x_0$ 行进到界面 $x=0$ 而不发生碰撞。在区域 $i$ 中的路程长度为 $s_i = (0 - x_0)/\\mu = -x_0/\\mu$。存活这段路程的概率由指数衰减定律给出：$P_{\\text{survival}, i} = \\exp(-\\Sigma_{t,i} s_i) = \\exp(\\Sigma_{t,i} x_0 / \\mu)$。\n2.  进入区域 $j$ 并在离开 $x=d_j$ 之前发生首次碰撞。穿越区域 $j$ 的路程长度为 $s_j = d_j/\\mu$。在此路程长度内发生碰撞的概率是 $1$ 减去存活它的概率：$P_{\\text{collision}, j} = 1 - \\exp(-\\Sigma_{t,j} s_j) = 1 - \\exp(-\\Sigma_{t,j} d_j / \\mu)$。\n\n条件概率是这两个独立事件的乘积：\n$$ P(\\text{collision in } j | x_0, \\mu) = \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\left[1 - \\exp\\left(-\\frac{\\Sigma_{t,j} d_j}{\\mu}\\right)\\right] $$\n将此代入 $P_{ij}^{(1)}$ 的积分并重新排列积分顺序得到：\n$$ P_{ij}^{(1)} = \\int_{0}^{1} \\frac{1}{2 d_i} \\left[1 - \\exp\\left(-\\frac{\\Sigma_{t,j} d_j}{\\mu}\\right)\\right] \\left( \\int_{-d_i}^{0} \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\mathrm{d}x_0 \\right) \\mathrm{d}\\mu $$\n关于 $x_0$ 的内层积分可以解析求解。设此积分为 $J(\\mu)$：\n$$ J(\\mu) = \\int_{-d_i}^{0} \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\mathrm{d}x_0 $$\n评估 $J(\\mu)$ 时必须考虑两种情况：\n- 如果 $\\Sigma_{t,i} > 0$：\n$$ J(\\mu) = \\left[ \\frac{\\mu}{\\Sigma_{t,i}} \\exp\\left(\\frac{\\Sigma_{t,i} x_0}{\\mu}\\right) \\right]_{-d_i}^0 = \\frac{\\mu}{\\Sigma_{t,i}} \\left(1 - \\exp\\left(-\\frac{\\Sigma_{t,i} d_i}{\\mu}\\right)\\right) $$\n- 如果 $\\Sigma_{t,i} = 0$（区域 $i$ 为真空）：\n$$ J(\\mu) = \\int_{-d_i}^{0} 1 \\, \\mathrm{d}x_0 = d_i $$\n此结果也可以通过取第一种情况在 $\\Sigma_{t,i} \\to 0$ 时的极限得到。\n\n设角积分的被积函数为 $I(\\mu)$。它由下式给出：\n$$ I(\\mu) = \\frac{1}{2 d_i} \\left[1 - \\exp\\left(-\\frac{\\Sigma_{t,j} d_j}{\\mu}\\right)\\right] J(\\mu) $$\n因此，$P_{ij}^{(1)} = \\int_0^1 I(\\mu) \\, \\mathrm{d}\\mu$。这个关于 $\\mu$ 的最终积分没有以初等函数表示的闭式解，必须进行数值计算。被积函数 $I(\\mu)$ 对于 $\\mu \\in (0,1]$ 是一个光滑函数，且当 $\\mu \\to 0^+$ 时其极限为 $0$，这使其非常适合高阶求积方法。\n\n问题指定使用 $N$ 点高斯-勒让德求积。该方法将区间 $[-1, 1]$ 上的积分近似为一个加权和：$\\int_{-1}^1 g(z)\\,\\mathrm{d}z \\approx \\sum_{k=1}^N w_k g(z_k)$，其中 $z_k$ 和 $w_k$ 是求积节点和权重。为了将其应用于我们在 $[0, 1]$ 上的积分，我们进行变量替换：$\\mu = (z+1)/2$，得到 $\\mathrm{d}\\mu = \\mathrm{d}z/2$。积分变为：\n$$ P_{ij}^{(1)} = \\int_{-1}^{1} I\\left(\\frac{z+1}{2}\\right) \\frac{1}{2} \\, \\mathrm{d}z \\approx \\sum_{k=1}^{N} \\frac{w_k}{2} I\\left(\\frac{z_k+1}{2}\\right) $$\n将对指定的测试用例实施此确定性计算。对于测试用例 A 中的误差分析，使用自适应求积程序（`scipy.integrate.quad`）计算一个高精度参考值，该值提供了一个基准，用以比较高斯-勒让德求积的结果。绝对误差则为 $|P_{ij,\\text{Gauss}}^{(1)} - P_{ij,\\text{ref}}^{(1)}|$。\n\n特殊情况检查物理极限：\n- 如果区域 $j$ 是真空（$\\Sigma_{t,j} = 0$），则项 $1 - \\exp(-\\Sigma_{t,j} d_j / \\mu)$ 始终为零。因此，$I(\\mu) = 0$ 且 $P_{ij}^{(1)} = 0$，这在物理上是正确的，因为在真空中不可能发生碰撞。\n- 如果区域 $j$ 非常厚或强吸收（$\\Sigma_{t,j} d_j \\to \\infty$），则对于所有 $\\mu > 0$，$1 - \\exp(-\\Sigma_{t,j} d_j / \\mu) \\to 1$。$P_{ij}^{(1)}$ 此时表示一个中子从区域 $i$ 逃逸到区域 $j$ 的总概率。\n- 如果区域 $i$ 非常薄（$d_i \\to 0$），它近似于界面处的一个平面源。薄源的概率 $P_{ij}^{(1)}$ 接近于面源的概率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\nfrom numpy.polynomial.legendre import leggauss\n\ndef solve():\n    \"\"\"\n    Solves the first-flight collision probability problem for the given test cases.\n    \"\"\"\n\n    def get_integrand_function(di, dj, sig_ti, sig_tj):\n        \"\"\"\n        Creates a vectorized function for the integrand of the angular integral.\n\n        The expression for P_ij^(1) is derived as:\n        P_ij = integral from 0 to 1 of I(mu) d(mu), where\n        I(mu) = (1 / (2 * di)) * (integral over x0) * (prob_collide_in_j)\n        \n        Args:\n            di (float): Thickness of region i (cm).\n            dj (float): Thickness of region j (cm).\n            sig_ti (float): Macroscopic total cross section of region i (cm^-1).\n            sig_tj (float): Macroscopic total cross section of region j (cm^-1).\n\n        Returns:\n            A function that computes the integrand I(mu) for a given mu (or array of mu).\n        \"\"\"\n        \n        def integrand(mu):\n            # The integrand is 0 at mu=0. Using a small epsilon to avoid division by zero.\n            mu = np.maximum(mu, 1e-15)\n\n            # Probability of collision in region j, given entry at x=0\n            prob_collide_in_j = 1.0 - np.exp(-sig_tj * dj / mu)\n\n            # Spatially averaged transmission probability through region i\n            # This is the integral over x0 from -di to 0 of exp(sig_ti * x0 / mu).\n            if sig_ti == 0.0:\n                # If region i is a vacuum, the integral evaluates to di\n                integral_x0 = np.full_like(mu, di)\n            else:\n                # Standard case\n                integral_x0 = (mu / sig_ti) * (1.0 - np.exp(-sig_ti * di / mu))\n\n            # The full integrand for the angular integral\n            # I(mu) = (1/2di) * J(mu) * P_coll,j\n            # where J(mu) is the spatial integral\n            integrand_val = (1.0 / (2.0 * di)) * integral_x0 * prob_collide_in_j\n            return integrand_val\n\n        return integrand\n\n    def calculate_p_ij_gauss(integrand_func, N):\n        \"\"\"\n        Calculates the integral using N-point Gauss-Legendre quadrature.\n        \"\"\"\n        # Get standard [-1, 1] points and weights\n        points, weights = leggauss(N)\n\n        # Transform points and weights for [0, 1] interval\n        mu_points = 0.5 * (points + 1.0)\n        mu_weights = 0.5 * weights\n        \n        # Evaluate integrand at quadrature points (vectorized)\n        integrand_values = integrand_func(mu_points)\n        \n        # Compute the weighted sum\n        integral = np.sum(mu_weights * integrand_values)\n        return integral\n\n    def get_reference_p_ij(integrand_func):\n        \"\"\"\n        Calculates a high-accuracy reference value using adaptive quadrature.\n        \"\"\"\n        ref_val, _ = quad(integrand_func, 0, 1, epsabs=1e-15, epsrel=1e-15, limit=200)\n        return ref_val\n\n    results = []\n\n    # Test case A: Baseline geometry and error study\n    di_A, dj_A, sig_ti_A, sig_tj_A = 2.0, 3.0, 0.8, 1.2\n    integrand_A = get_integrand_function(di_A, dj_A, sig_ti_A, sig_tj_A)\n    p_ij_ref_A = get_reference_p_ij(integrand_A)\n    \n    orders_N = [1, 2, 4, 8, 16, 32]\n    for N in orders_N:\n        p_ij_gauss = calculate_p_ij_gauss(integrand_A, N)\n        error = abs(p_ij_gauss - p_ij_ref_A)\n        results.append(error)\n\n    # Test case B: Vacuum target region\n    di_B, dj_B, sig_ti_B, sig_tj_B = 2.0, 10.0, 0.8, 0.0\n    integrand_B = get_integrand_function(di_B, dj_B, sig_ti_B, sig_tj_B)\n    p_ij_B = calculate_p_ij_gauss(integrand_B, N=16)\n    results.append(p_ij_B)\n\n    # Test case C: Very thick and highly absorbing target region\n    di_C, dj_C, sig_ti_C, sig_tj_C = 2.0, 50.0, 0.8, 10.0\n    integrand_C = get_integrand_function(di_C, dj_C, sig_ti_C, sig_tj_C)\n    p_ij_C = calculate_p_ij_gauss(integrand_C, N=16)\n    results.append(p_ij_C)\n    \n    # Test case D: Extremely thin source region\n    di_D, dj_D, sig_ti_D, sig_tj_D = 0.01, 3.0, 0.8, 1.2\n    integrand_D = get_integrand_function(di_D, dj_D, sig_ti_D, sig_tj_D)\n    p_ij_D = calculate_p_ij_gauss(integrand_D, N=16)\n    results.append(p_ij_D)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后一个练习将从直接计算转向物理建模的艺术，这是高级研究人员的一项关键技能。它挑战您使用“等效截面”这一巧妙概念来模拟一个复杂的物理过程——边界上的部分泄漏。通过本实践，您将深化对如何将复杂的、与位置相关的现象简化为等效的、均匀化模型以进行工程分析的理解 ()。",
            "id": "4225707",
            "problem": "考虑一个占据体积为 $V$、表面积为 $S$ 的凸体的均匀、各向同性发射和衰减的介质。中子在两次相互作用之间沿直线运动，其自由飞行由宏观总截面 $\\Sigma_{t}$（单位为 $\\text{cm}^{-1}$）决定。边界是部分透明的：每次穿越边界时，中子有 $P_{\\text{leak}} \\in (0,1)$ 的概率泄漏（损失掉）；有 $1 - P_{\\text{leak}}$ 的概率被完全反射回介质并立即重新变为各向同性（能量不变）。\n\n从自由程指数定律和经过充分检验的几何事实出发，即对于凸体内的各向同性直线飞行，单位程长上预期的边界穿越次数等于 $S/(4V)$，证明部分透明边界可以被建模为一个附加的、程长均匀的衰减，并具有一个有效的衰减系数。然后，利用独立竞争风险原理，推导出调整后的首次飞行碰撞概率 $P^{(1)}$，即中子的第一个终止事件是与材料发生碰撞（而非泄漏）的概率，用 $\\Sigma_{t}$、$S/V$ 和 $P_{\\text{leak}}$ 表示。\n\n最后，对于厚度为 $T$ 且横向尺寸很大（因此边缘效应可以忽略）的平行平面板，数值计算 $P^{(1)}$。对于这样的平板，取 $S/V = 2/T$。使用 $T = 5\\,\\text{cm}$，$\\Sigma_{t} = 0.8\\,\\text{cm}^{-1}$ 和 $P_{\\text{leak}} = 0.3$。将 $P^{(1)}$ 的最终数值表示为一个无量纲小数，并四舍五入到四位有效数字。",
            "solution": "在尝试求解之前，首先评估问题陈述的有效性。\n\n**步骤1：提取已知条件**\n- 介质：均匀、各向同性发射和衰减。\n- 几何形状：体积为 $V$、表面积为 $S$ 的凸体。\n- 材料相互作用：由宏观总截面 $\\Sigma_t$（单位 $\\text{cm}^{-1}$）决定。\n- 边界条件：部分透明。\n- 每次穿越边界的泄漏概率：$P_{\\text{leak}} \\in (0,1)$。\n- 每次穿越边界的返回概率：$1 - P_{\\text{leak}}$。\n- 几何性质：对于凸体内的各向同性直线飞行，单位程长上预期的边界穿越次数为 $S/(4V)$。\n- 任务1：证明边界可以被建模为一个有效的、程长均匀的衰减系数。\n- 任务2：用 $\\Sigma_t$、$S/V$ 和 $P_{\\text{leak}}$ 推导调整后的首次飞行碰撞概率 $P^{(1)}$。\n- 任务3：对厚度为 $T$ 的平行平面板，数值计算 $P^{(1)}$。\n- 平板特定几何形状：对于大平板，$S/V = 2/T$。\n- 数值：$T = 5\\,\\text{cm}$，$\\Sigma_t = 0.8\\,\\text{cm}^{-1}$，$P_{\\text{leak}} = 0.3$。\n- 最终数值结果要求：四舍五入到四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在科学上基于中子输运理论的原理。诸如宏观截面、平均自由程和首次飞行碰撞概率等关键概念是核工程领域的标准内容。所提供的几何事实，即单位程长上预期的边界穿越次数为 $S/(4V)$，是积分几何学中一个公认的结果，与 Cauchy 的平均弦长定理（$\\bar{\\ell} = 4V/S$）有关。将边界泄漏建模为一个有效的、空间均匀的截面是一种常用且有效的近似技术（常用于均匀化方法中）。使用独立竞争风险原理是处理多个并发衰变或移除过程的标准统计方法。问题提法严谨，为得到唯一解提供了所有必要信息。语言客观精确。因此，该问题被认定为有效。\n\n**步骤3：结论与行动**\n问题有效。继续进行求解。\n\n按照问题陈述的要求，解答分为三个部分。\n\n首先，我们将部分透明边界效应建模为一个有效的衰减系数。在介质中运动的中子可以通过两个独立的随机过程被移除：与介质中的原子核发生碰撞，或通过边界泄漏。单位程长内发生材料碰撞的概率由宏观总截面 $\\Sigma_t$ 给出。\n\n问题陈述指出，单位程长上预期的边界穿越次数为 $\\frac{S}{4V}$。我们将此边界遭遇率表示为 $\\lambda_{\\text{boundary}}$。\n$$\n\\lambda_{\\text{boundary}} = \\frac{S}{4V}\n$$\n该率的单位为 $\\text{length}^{-1}$。每次中子穿越边界，都有 $P_{\\text{leak}}$ 的概率泄漏并从系统中移除。我们可以将边界穿越序列建模为一个发生率为 $\\lambda_{\\text{boundary}}$ 的关于程长的泊松过程。泄漏事件是这些穿越事件的一个子集，其中每次穿越构成一次独立的试验，其“成功”（泄漏）概率为 $P_{\\text{leak}}$。这是一个泊松过程稀疏化的经典例子。泄漏事件的发生率，我们可以将其定义为有效宏观泄漏截面 $\\Sigma_{\\text{leak}}$，是边界穿越率与每次穿越泄漏概率的乘积。\n$$\n\\Sigma_{\\text{leak}} = \\lambda_{\\text{boundary}} \\times P_{\\text{leak}} = \\left(\\frac{S}{4V}\\right) P_{\\text{leak}}\n$$\n这个 $\\Sigma_{\\text{leak}}$ 代表了中子因泄漏而从系统中被移除的、程长均匀的单位长度概率。这表明边界泄漏可以被建模为一个附加的衰减系数，该系数与中子的位置或方向无关（由于各向同性再发射假设和几何平均的性质）。\n\n其次，我们推导调整后的首次飞行碰撞概率 $P^{(1)}$。中子的“首次飞行”以其第一个终止事件结束。在这个修正后的系统中，存在两个独立的、竞争性的终止事件：\n$1$。材料碰撞，其发生率（单位程长概率）为 $\\Sigma_t$。\n$2$。边界泄漏，其有效发生率为 $\\Sigma_{\\text{leak}}$。\n\n根据独立竞争风险原理，任何终止事件的总发生率 $\\Sigma_{\\text{total}}$ 是各个独立竞争过程发生率的总和。\n$$\n\\Sigma_{\\text{total}} = \\Sigma_t + \\Sigma_{\\text{leak}}\n$$\n发生的第一个事件是特定类型（在此情况下为材料碰撞）的概率是该事件发生率与所有事件总发生率之比。因此，首次飞行碰撞概率 $P^{(1)}$ 由下式给出：\n$$\nP^{(1)} = \\frac{\\text{材料碰撞率}}{\\text{总终止率}} = \\frac{\\Sigma_t}{\\Sigma_{\\text{total}}}\n$$\n代入各发生率的表达式，我们得到：\n$$\nP^{(1)} = \\frac{\\Sigma_t}{\\Sigma_t + \\Sigma_{\\text{leak}}}\n$$\n最后，用给定的参数 $\\Sigma_t$、$S/V$ 和 $P_{\\text{leak}}$ 来表示：\n$$\nP^{(1)} = \\frac{\\Sigma_t}{\\Sigma_t + \\frac{S P_{\\text{leak}}}{4V}}\n$$\n这就是所求的调整后首次飞行碰撞概率的解析表达式。\n\n第三，我们对指定的无限大平行平面板情况进行 $P^{(1)}$ 的数值计算。给定的参数是：\n- 平板厚度 $T = 5\\,\\text{cm}$。\n- 宏观总截面 $\\Sigma_t = 0.8\\,\\text{cm}^{-1}$。\n- 每次穿越的泄漏概率 $P_{\\text{leak}} = 0.3$。\n- 对于此几何形状，表面积与体积之比为 $S/V = 2/T$。\n\n首先，我们计算 $S/V$ 的数值：\n$$\n\\frac{S}{V} = \\frac{2}{T} = \\frac{2}{5\\,\\text{cm}} = 0.4\\,\\text{cm}^{-1}\n$$\n接下来，我们计算有效泄漏截面 $\\Sigma_{\\text{leak}}$：\n$$\n\\Sigma_{\\text{leak}} = \\frac{S P_{\\text{leak}}}{4V} = \\frac{1}{4} \\left(\\frac{S}{V}\\right) P_{\\text{leak}} = \\frac{1}{4} (0.4\\,\\text{cm}^{-1}) (0.3) = (0.1\\,\\text{cm}^{-1}) (0.3) = 0.03\\,\\text{cm}^{-1}\n$$\n现在，我们可以计算 $P^{(1)}$ 的数值：\n$$\nP^{(1)} = \\frac{\\Sigma_t}{\\Sigma_t + \\Sigma_{\\text{leak}}} = \\frac{0.8\\,\\text{cm}^{-1}}{0.8\\,\\text{cm}^{-1} + 0.03\\,\\text{cm}^{-1}} = \\frac{0.8}{0.83}\n$$\n进行除法运算：\n$$\nP^{(1)} = \\frac{0.8}{0.83} \\approx 0.96385542...\n$$\n问题要求结果四舍五入到四位有效数字。\n$$\nP^{(1)} \\approx 0.9639\n$$\n这就是在指定条件下首次飞行碰撞概率的最终数值。",
            "answer": "$$\\boxed{0.9639}$$"
        }
    ]
}