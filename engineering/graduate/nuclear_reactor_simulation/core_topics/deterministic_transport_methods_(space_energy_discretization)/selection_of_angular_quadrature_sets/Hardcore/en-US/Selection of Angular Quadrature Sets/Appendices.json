{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any moment-matching quadrature scheme is the set of exact, continuous integrals it is designed to reproduce. Before constructing or evaluating a discrete ordinates set, we must first determine these target values from first principles. This foundational exercise  will guide you through the direct calculation of two key fourth-order moments, reinforcing the underlying calculus that connects the continuous angular dependency to the discrete approximation.",
            "id": "4248105",
            "problem": "In the selection of angular quadrature sets for the discrete ordinates (SN) method in nuclear reactor simulation, one requires exact reproduction of continuous angular moments of low-order polynomials in the direction cosines to ensure rotational invariance and accurate transport of anisotropic flux components. Consider a unit sphere parameterized by spherical coordinates with polar angle $\\theta \\in [0,\\pi]$ measured from the $z$-axis and azimuthal angle $\\phi \\in [0,2\\pi)$ measured from the $x$-axis, with differential solid angle $d\\Omega=\\sin\\theta\\,d\\theta\\,d\\phi$. Define the direction cosines relative to the Cartesian axes by $\\Omega_x=\\sin\\theta\\cos\\phi$, $\\Omega_y=\\sin\\theta\\sin\\phi$, and $\\Omega_z=\\cos\\theta$. \n\nStarting from these definitions and only fundamental trigonometric identities and properties of integrals on the sphere, derive the exact closed-form values of the following integrals, which are the continuous spherical moments that a fourth-order exact angular quadrature must match:\n$$I_{1}=\\int_{4\\pi}\\Omega_x^{4}\\,d\\Omega,\\qquad I_{2}=\\int_{4\\pi}\\Omega_x^{2}\\Omega_y^{2}\\,d\\Omega.$$\n\nUse radians for all angular variables, and treat all quantities as dimensionless. Report your final answer as a two-entry row matrix $\\begin{pmatrix}I_{1}  I_{2}\\end{pmatrix}$ in exact form. No rounding is required.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and complete. All conditions and definitions are standard in the field of neutron transport theory and mathematical physics. We may proceed with the solution.\n\nThe objective is to compute the two integrals:\n$$I_{1}=\\int_{4\\pi}\\Omega_x^{4}\\,d\\Omega$$\n$$I_{2}=\\int_{4\\pi}\\Omega_x^{2}\\Omega_y^{2}\\,d\\Omega$$\n\nThe direction cosines are defined in spherical coordinates as $\\Omega_x=\\sin\\theta\\cos\\phi$, $\\Omega_y=\\sin\\theta\\sin\\phi$, and $\\Omega_z=\\cos\\theta$. The differential solid angle is $d\\Omega=\\sin\\theta\\,d\\theta\\,d\\phi$, where the polar angle $\\theta$ ranges from $0$ to $\\pi$ and the azimuthal angle $\\phi$ ranges from $0$ to $2\\pi$.\n\nWe will evaluate each integral by expressing it in spherical coordinates and separating the variables.\n\nFirst, let's express $I_{1}$ as a double integral:\n$$I_{1} = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} (\\sin\\theta\\cos\\phi)^{4} \\sin\\theta\\,d\\theta\\,d\\phi$$\nThe integrand is a product of a function of $\\theta$ and a function of $\\phi$, so the integral is separable:\n$$I_{1} = \\left( \\int_{0}^{\\pi} \\sin^{4}\\theta \\sin\\theta \\,d\\theta \\right) \\left( \\int_{0}^{2\\pi} \\cos^{4}\\phi \\,d\\phi \\right) = \\left( \\int_{0}^{\\pi} \\sin^{5}\\theta \\,d\\theta \\right) \\left( \\int_{0}^{2\\pi} \\cos^{4}\\phi \\,d\\phi \\right)$$\n\nSimilarly, for $I_{2}$:\n$$I_{2} = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} (\\sin\\theta\\cos\\phi)^{2} (\\sin\\theta\\sin\\phi)^{2} \\sin\\theta\\,d\\theta\\,d\\phi$$\n$$I_{2} = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\sin^{4}\\theta \\cos^{2}\\phi \\sin^{2}\\phi \\sin\\theta\\,d\\theta\\,d\\phi$$\nThis integral is also separable:\n$$I_{2} = \\left( \\int_{0}^{\\pi} \\sin^{5}\\theta \\,d\\theta \\right) \\left( \\int_{0}^{2\\pi} \\cos^{2}\\phi \\sin^{2}\\phi \\,d\\phi \\right)$$\n\nWe observe that both expressions share the same integral with respect to $\\theta$. Let us define the components:\n$$I_{\\theta} = \\int_{0}^{\\pi} \\sin^{5}\\theta \\,d\\theta$$\n$$I_{\\phi,1} = \\int_{0}^{2\\pi} \\cos^{4}\\phi \\,d\\phi$$\n$$I_{\\phi,2} = \\int_{0}^{2\\pi} \\cos^{2}\\phi \\sin^{2}\\phi \\,d\\phi$$\nThen, $I_{1} = I_{\\theta} I_{\\phi,1}$ and $I_{2} = I_{\\theta} I_{\\phi,2}$. We will compute each of these three integrals.\n\nCalculation of $I_{\\theta}$:\nTo compute $I_{\\theta} = \\int_{0}^{\\pi} \\sin^{5}\\theta \\,d\\theta$, we use the substitution $u = \\cos\\theta$, which implies $du = -\\sin\\theta \\,d\\theta$. The limits of integration change from $\\theta=0$ to $u=\\cos(0)=1$ and from $\\theta=\\pi$ to $u=\\cos(\\pi)=-1$. We rewrite the integrand as $\\sin^{5}\\theta = \\sin^{4}\\theta \\sin\\theta = (\\sin^{2}\\theta)^{2} \\sin\\theta = (1-\\cos^{2}\\theta)^{2} \\sin\\theta$.\n$$I_{\\theta} = \\int_{1}^{-1} (1-u^{2})^{2} (-du) = \\int_{-1}^{1} (1-u^{2})^{2} \\,du$$\nExpanding the polynomial:\n$$I_{\\theta} = \\int_{-1}^{1} (1 - 2u^{2} + u^{4}) \\,du$$\nIntegrating term by term:\n$$I_{\\theta} = \\left[ u - \\frac{2}{3}u^{3} + \\frac{1}{5}u^{5} \\right]_{-1}^{1}$$\n$$I_{\\theta} = \\left(1 - \\frac{2}{3} + \\frac{1}{5}\\right) - \\left(-1 - \\frac{2}{3}(-1)^{3} + \\frac{1}{5}(-1)^{5}\\right) = \\left(1 - \\frac{2}{3} + \\frac{1}{5}\\right) - \\left(-1 + \\frac{2}{3} - \\frac{1}{5}\\right)$$\n$$I_{\\theta} = 2 \\left(1 - \\frac{2}{3} + \\frac{1}{5}\\right) = 2 \\left(\\frac{15 - 10 + 3}{15}\\right) = 2 \\left(\\frac{8}{15}\\right) = \\frac{16}{15}$$\n\nCalculation of $I_{\\phi,1}$:\nTo compute $I_{\\phi,1} = \\int_{0}^{2\\pi} \\cos^{4}\\phi \\,d\\phi$, we use the power-reduction identity $\\cos^{2}x = \\frac{1+\\cos(2x)}{2}$.\n$$\\cos^{4}\\phi = (\\cos^{2}\\phi)^{2} = \\left(\\frac{1+\\cos(2\\phi)}{2}\\right)^{2} = \\frac{1}{4}(1 + 2\\cos(2\\phi) + \\cos^{2}(2\\phi))$$\nWe apply the identity again for $\\cos^{2}(2\\phi) = \\frac{1+\\cos(4\\phi)}{2}$:\n$$\\cos^{4}\\phi = \\frac{1}{4}\\left(1 + 2\\cos(2\\phi) + \\frac{1+\\cos(4\\phi)}{2}\\right) = \\frac{1}{4}\\left(\\frac{3}{2} + 2\\cos(2\\phi) + \\frac{1}{2}\\cos(4\\phi)\\right) = \\frac{3}{8} + \\frac{1}{2}\\cos(2\\phi) + \\frac{1}{8}\\cos(4\\phi)$$\nNow, we integrate:\n$$I_{\\phi,1} = \\int_{0}^{2\\pi} \\left(\\frac{3}{8} + \\frac{1}{2}\\cos(2\\phi) + \\frac{1}{8}\\cos(4\\phi)\\right)d\\phi$$\nThe integrals of $\\cos(2\\phi)$ and $\\cos(4\\phi)$ over the interval $[0, 2\\pi]$ are zero, as they are integrals of periodic functions over an integer number of periods.\n$$\\int_{0}^{2\\pi}\\cos(k\\phi)d\\phi = \\left[\\frac{\\sin(k\\phi)}{k}\\right]_{0}^{2\\pi} = 0 \\quad \\text{for integer } k \\ne 0$$\nThus, we are left with:\n$$I_{\\phi,1} = \\int_{0}^{2\\pi} \\frac{3}{8} \\,d\\phi = \\frac{3}{8} [\\phi]_{0}^{2\\pi} = \\frac{3}{8}(2\\pi) = \\frac{3\\pi}{4}$$\n\nCalculation of $I_{\\phi,2}$:\nTo compute $I_{\\phi,2} = \\int_{0}^{2\\pi} \\cos^{2}\\phi \\sin^{2}\\phi \\,d\\phi$, we use the double-angle identity $\\sin(2x) = 2\\sin x \\cos x$.\n$$\\cos^{2}\\phi \\sin^{2}\\phi = (\\cos\\phi\\sin\\phi)^{2} = \\left(\\frac{\\sin(2\\phi)}{2}\\right)^{2} = \\frac{1}{4}\\sin^{2}(2\\phi)$$\nNext, we use the power-reduction identity $\\sin^{2}x = \\frac{1-\\cos(2x)}{2}$:\n$$\\frac{1}{4}\\sin^{2}(2\\phi) = \\frac{1}{4}\\left(\\frac{1-\\cos(4\\phi)}{2}\\right) = \\frac{1}{8}(1-\\cos(4\\phi))$$\nNow, we integrate:\n$$I_{\\phi,2} = \\int_{0}^{2\\pi} \\frac{1}{8}(1-\\cos(4\\phi)) \\,d\\phi$$\nAs before, the integral of $\\cos(4\\phi)$ over $[0, 2\\pi]$ is zero.\n$$I_{\\phi,2} = \\int_{0}^{2\\pi} \\frac{1}{8} \\,d\\phi = \\frac{1}{8}[\\phi]_{0}^{2\\pi} = \\frac{1}{8}(2\\pi) = \\frac{\\pi}{4}$$\n\nFinally, we assemble the results to find $I_{1}$ and $I_{2}$.\n$$I_{1} = I_{\\theta} I_{\\phi,1} = \\left(\\frac{16}{15}\\right) \\left(\\frac{3\\pi}{4}\\right) = \\frac{48\\pi}{60} = \\frac{4\\pi}{5}$$\n$$I_{2} = I_{\\theta} I_{\\phi,2} = \\left(\\frac{16}{15}\\right) \\left(\\frac{\\pi}{4}\\right) = \\frac{16\\pi}{60} = \\frac{4\\pi}{15}$$\n\nThe calculated values are $I_{1} = \\frac{4\\pi}{5}$ and $I_{2} = \\frac{4\\pi}{15}$. The final answer is to be reported as a two-entry row matrix.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{4\\pi}{5}  \\frac{4\\pi}{15} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "With the target moments established, we can now turn to the practical construction of a quadrature set. This practice  challenges you to apply the moment-matching principle to derive the weights for a level-symmetric ($LS_N$) quadrature, a family of sets known for its efficiency and symmetry properties. By translating the geometric constraints and moment conditions into a system of algebraic equations, you will gain firsthand insight into the design process of these essential numerical tools.",
            "id": "4248055",
            "problem": "In three-dimensional steady-state neutron transport, the specific intensity obeys the first-order linear Boltzmann transport equation, and angular integration over the unit sphere is required to form moments for diffusion-like closures and to compute reaction rates. To approximate these angular integrals, a discrete ordinates method selects a finite set of directions with associated weights that integrate low-order spherical moments exactly. A widely used angular quadrature on the sphere is the level-symmetric family, in which, in each octant, the abscissae are arranged in levels that are symmetric under permutation of the coordinate axes.\n\nConsider constructing a level-symmetric set with two polar levels in the first octant for a so-called $LS_4$ quadrature. In the first octant, for each level $l \\in \\{1,2\\}$, define three directions as the permutations of the triplet ($u_l, v_l, v_l$), where $u_l \\in (0,1)$ and $v_l \\in (0,1)$ are direction cosines such that the direction vector has unit length. The three directions in the first octant at level $l$ share a common weight $w_l$ (in steradians), and the full $4\\pi$ set is formed by reflecting these directions by symmetry through the coordinate planes into all eight octants. The fundamental geometric constraint for direction cosines of a unit vector is\n$$\nu_l^{2} + 2v_l^{2} = 1,\n$$\nso that\n$$\nv_l^{2} = \\frac{1 - u_l^{2}}{2}.\n$$\nLet $x_l \\equiv u_l^{2}$ for $l=1,2$.\n\nTo enforce exactness of low-order spherical moments, require the quadrature to integrate the following over the unit sphere exactly:\n- The constant function, $\\int_{4\\pi} 1 \\,\\mathrm{d}\\Omega = 4\\pi$.\n- The fourth-order moment $\\int_{4\\pi} \\Omega_x^{4} \\,\\mathrm{d}\\Omega = \\frac{4\\pi}{5}$.\n- The mixed fourth-order moment $\\int_{4\\pi} \\Omega_x^{2} \\Omega_y^{2} \\,\\mathrm{d}\\Omega = \\frac{4\\pi}{15}$.\n\nHere, $\\Omega_x$, $\\Omega_y$, and $\\Omega_z$ denote the direction cosines of a unit vector with respect to the $x$, $y$, and $z$ axes. Due to the permutation symmetry in each level and reflection across octants, the quadrature sum over all directions for these moments reduces to combinations of $u_l$ and $v_l$ with the weights $w_l$.\n\nUsing only the constant moment and the $\\Omega_x^4$ moment conditions together with the geometric unit-vector constraint above, derive and simplify a closed-form analytic expression for the weight per direction in the first octant at level $l=1$, $w_1$, as a function of $x_1$ and $x_2$. Express your final answer in steradians. No numerical approximation or rounding is required; provide the exact symbolic expression.",
            "solution": "The problem requires the derivation of a closed-form analytic expression for the quadrature weight $w_1$ as a function of the squared direction-cosine parameters $x_1$ and $x_2$. The derivation must use the integral moment conditions for the constant function and for the fourth-order moment $\\Omega_x^4$.\n\nThe angular quadrature approximates an integral over the unit sphere, $\\int_{4\\pi} f(\\Omega) \\,\\mathrm{d}\\Omega$, by a weighted sum over a discrete set of directions $\\Omega_m = (\\Omega_{xm}, \\Omega_{ym}, \\Omega_{zm})$ with corresponding weights $w_m$:\n$$\n\\int_{4\\pi} f(\\Omega) \\,\\mathrm{d}\\Omega \\approx \\sum_m w_m f(\\Omega_m)\n$$\nThe problem defines a level-symmetric quadrature set with two levels, $l \\in \\{1,2\\}$, in the first octant.\nFor level $l$, the directions are the $3$ permutations of the triplet $(u_l, v_l, v_l)$. These three directions in the first octant, and their symmetric reflections in the other seven octants, all share the same weight, which we denote as $w_l$.\nThe geometric constraint for a unit direction vector is $u_l^2 + 2v_l^2 = 1$. With the definition $x_l \\equiv u_l^2$, this gives $v_l^2 = \\frac{1-x_l}{2}$. Since $u_l, v_l \\in (0,1)$, it implies $x_l \\in (0,1)$.\n\nThe full quadrature set is formed by symmetry. The directions in the first octant are $(u_l, v_l, v_l)$, $(v_l, u_l, v_l)$, and $(v_l, v_l, u_l)$ for $l=1,2$. As $u_l, v_l > 0$, these directions are not on any coordinate plane. Assuming $u_l \\neq v_l$, for each level $l$, there are $3$ distinct directions in the first octant. The full set of directions for level $l$ is generated by permutations and sign changes, resulting in $8 \\times 3 = 24$ distinct directions. Thus, the total quadrature set consists of $24$ directions of type $l=1$ with weight $w_1$ and $24$ directions of type $l=2$ with weight $w_2$.\n\nWe now enforce the two moment conditions provided.\n\n1.  **Constant Moment Condition:** The quadrature must integrate the constant function $f(\\Omega) = 1$ exactly.\n    The exact integral is $\\int_{4\\pi} 1 \\,\\mathrm{d}\\Omega = 4\\pi$.\n    The quadrature sum is the sum of all weights. With $24$ directions of weight $w_1$ and $24$ of weight $w_2$, this sum is:\n    $$\n    \\sum_m w_m = 24w_1 + 24w_2\n    $$\n    Equating the quadrature sum to the exact integral gives:\n    $$\n    24w_1 + 24w_2 = 4\\pi\n    $$\n    Dividing by $24$, we obtain our first equation:\n    $$\n    w_1 + w_2 = \\frac{\\pi}{6} \\quad \\text{(Eq. 1)}\n    $$\n\n2.  **Fourth-Order Moment ($\\Omega_x^4$) Condition:** The quadrature must integrate $f(\\Omega) = \\Omega_x^4$ exactly.\n    The exact integral is $\\int_{4\\pi} \\Omega_x^4 \\,\\mathrm{d}\\Omega = \\frac{4\\pi}{5}$.\n    The quadrature sum is $\\sum_m w_m \\Omega_{xm}^4$. We can group the terms by level.\n    For level $l$, the sum of $\\Omega_{xm}^4$ over its $24$ directions is computed. The directions are permutations of $(\\pm u_l, \\pm v_l, \\pm v_l)$.\n    -   The $8$ directions of the form $(\\pm u_l, \\cdot, \\cdot)$ have $\\Omega_x = \\pm u_l$. Their contribution to the sum of $\\Omega_x^4$ is $8 \\times u_l^4$.\n    -   The $8$ directions of the form $(\\pm v_l, \\cdot, \\cdot)$ where $u_l$ is in the second position have $\\Omega_x = \\pm v_l$. Their contribution is $8 \\times v_l^4$.\n    -   The $8$ directions of the form $(\\pm v_l, \\cdot, \\cdot)$ where $u_l$ is in the third position have $\\Omega_x = \\pm v_l$. Their contribution is $8 \\times v_l^4$.\n    The sum of $\\Omega_{xm}^4$ over all $24$ directions of level $l$ is $8(u_l^4 + 2v_l^4)$.\n    The total quadrature sum is:\n    $$\n    \\sum_m w_m \\Omega_{xm}^4 = w_1 \\left[ 8(u_1^4 + 2v_1^4) \\right] + w_2 \\left[ 8(u_2^4 + 2v_2^4) \\right]\n    $$\n    Equating this to the exact integral:\n    $$\n    8w_1(u_1^4 + 2v_1^4) + 8w_2(u_2^4 + 2v_2^4) = \\frac{4\\pi}{5}\n    $$\n    We define an intermediate quantity $S_l = u_l^4 + 2v_l^4$. Using $x_l = u_l^2$ and $v_l^2 = \\frac{1-x_l}{2}$, we have $u_l^4 = x_l^2$ and $v_l^4 = \\left(\\frac{1-x_l}{2}\\right)^2 = \\frac{1-2x_l+x_l^2}{4}$.\n    $$\n    S_l = x_l^2 + 2\\left(\\frac{1-2x_l+x_l^2}{4}\\right) = x_l^2 + \\frac{1-2x_l+x_l^2}{2} = \\frac{2x_l^2 + 1-2x_l+x_l^2}{2} = \\frac{3x_l^2 - 2x_l + 1}{2}\n    $$\n    Substituting $S_l$ into the moment equation and dividing by $8$:\n    $$\n    w_1 S_1 + w_2 S_2 = \\frac{\\pi}{10} \\quad \\text{(Eq. 2)}\n    $$\n\nNow we have a system of two linear equations for $w_1$ and $w_2$:\n1.  $w_1 + w_2 = \\frac{\\pi}{6}$\n2.  $w_1 S_1 + w_2 S_2 = \\frac{\\pi}{10}$\n\nWe solve for $w_1$. From Eq. 1, $w_2 = \\frac{\\pi}{6} - w_1$. Substitute this into Eq. 2:\n$$\nw_1 S_1 + \\left(\\frac{\\pi}{6} - w_1\\right) S_2 = \\frac{\\pi}{10}\n$$\n$$\nw_1 S_1 + \\frac{\\pi}{6} S_2 - w_1 S_2 = \\frac{\\pi}{10}\n$$\n$$\nw_1 (S_1 - S_2) = \\frac{\\pi}{10} - \\frac{\\pi}{6} S_2\n$$\n$$\nw_1 (S_1 - S_2) = \\pi \\left(\\frac{1}{10} - \\frac{S_2}{6}\\right) = \\pi \\frac{3 - 5S_2}{30}\n$$\n$$\nw_1 = \\frac{\\pi}{30} \\frac{3 - 5S_2}{S_1 - S_2}\n$$\nTo get the final expression in terms of $x_1$ and $x_2$, we substitute the expressions for $S_1$ and $S_2$.\nThe numerator is:\n$$\n3 - 5S_2 = 3 - 5\\left(\\frac{3x_2^2 - 2x_2 + 1}{2}\\right) = \\frac{6 - 5(3x_2^2 - 2x_2 + 1)}{2} = \\frac{6 - 15x_2^2 + 10x_2 - 5}{2} = \\frac{-15x_2^2 + 10x_2 + 1}{2}\n$$\nThe denominator is:\n$$\nS_1 - S_2 = \\frac{3x_1^2 - 2x_1 + 1}{2} - \\frac{3x_2^2 - 2x_2 + 1}{2} = \\frac{1}{2} \\left( 3(x_1^2 - x_2^2) - 2(x_1 - x_2) \\right)\n$$\n$$\nS_1 - S_2 = \\frac{1}{2} (x_1 - x_2) \\left( 3(x_1 + x_2) - 2 \\right)\n$$\nFinally, substituting these into the expression for $w_1$:\n$$\nw_1 = \\frac{\\pi}{30} \\frac{\\frac{-15x_2^2 + 10x_2 + 1}{2}}{\\frac{1}{2} (x_1 - x_2) (3(x_1 + x_2) - 2)}\n$$\nThe factors of $\\frac{1}{2}$ cancel, yielding the simplified closed-form expression for $w_1$:\n$$\nw_1 = \\frac{\\pi}{30} \\frac{-15x_2^2 + 10x_2 + 1}{(x_1 - x_2)(3x_1 + 3x_2 - 2)}\n$$\nThis expression provides the weight for any direction at level $l=1$ as a function of $x_1$ and $x_2$.",
            "answer": "$$\n\\boxed{\\frac{\\pi}{30} \\frac{-15x_2^{2} + 10x_2 + 1}{(x_1 - x_2)(3x_1 + 3x_2 - 2)}}\n$$"
        },
        {
            "introduction": "The final step in mastering quadrature sets is learning how to assess their quality rigorously. This capstone exercise  moves from specific constructions to a general verification framework, tasking you with writing a program to score a quadrature's performance. By testing its ability to integrate spherical harmonics—a complete functional basis on the sphere—you will develop a powerful and practical method to quantify the exactness of any product quadrature.",
            "id": "4248085",
            "problem": "Consider the angular integrals of complex spherical harmonics $Y_{l}^{m}(\\theta,\\phi)$ over the unit sphere, where $l$ is the degree and $m$ is the order. The unit sphere surface measure is $d\\Omega = \\sin\\theta\\,d\\theta\\,d\\phi$, with polar angle $\\theta \\in [0,\\pi]$ and azimuthal angle $\\phi \\in [0,2\\pi)$. Adopt the Condon–Shortley normalization of spherical harmonics used in widely accepted scientific libraries, with orthonormality under the inner product $\\int_{S^{2}} Y_{l}^{m}(\\theta,\\phi)\\, \\overline{Y_{l'}^{m'}(\\theta,\\phi)}\\, d\\Omega = \\delta_{ll'}\\delta_{mm'}$ for all integer $l \\ge 0$ and integer $-l \\le m \\le l$, where $\\overline{(\\cdot)}$ denotes complex conjugation and $\\delta_{ab}$ is the Kronecker delta.\n\nYou will assess the exactness of a specified product quadrature on the sphere that is commonly used in transport simulations in nuclear reactor analysis. The quadrature is defined by a tensor-product of a Gauss–Legendre rule in $\\mu = \\cos\\theta$ on $[-1,1]$ and a trapezoidal rule in $\\phi$ on $[0,2\\pi)$. Specifically, for a chosen number of polar points $N_{\\theta}$ and azimuthal points $N_{\\phi}$:\n- Let $(\\mu_{i}, w^{\\mu}_{i})$ for $i=1,\\dots,N_{\\theta}$ be the nodes and weights of the Gauss–Legendre quadrature on $[-1,1]$, which are exact for polynomials in $\\mu$ up to degree $2N_{\\theta}-1$ and satisfy $\\sum_{i=1}^{N_{\\theta}} w^{\\mu}_{i} = 2$.\n- Let $\\phi_{j} = 2\\pi j / N_{\\phi}$ for $j=0,\\dots,N_{\\phi}-1$ be equally spaced azimuthal nodes with trapezoidal weights $w^{\\phi} = 2\\pi / N_{\\phi}$, such that $\\sum_{j=0}^{N_{\\phi}-1} w^{\\phi} = 2\\pi$.\n- The total weight for a tensor-product node $(\\mu_{i}, \\phi_{j})$ is $w_{ij} = w^{\\mu}_{i}\\, w^{\\phi}$, and the corresponding polar angle is $\\theta_{i} = \\arccos(\\mu_{i})$.\n\nFor a given nonnegative integer $L$, consider the set $\\mathcal{H}_{L} = \\{Y_{l}^{m} : 0 \\le l \\le L,\\ -l \\le m \\le l\\}$. Define the analytic integral\n$$\nI_{l,m} = \\int_{S^{2}} Y_{l}^{m}(\\theta,\\phi)\\, d\\Omega,\n$$\nand the quadrature approximation\n$$\nQ_{l,m} = \\sum_{i=1}^{N_{\\theta}} \\sum_{j=0}^{N_{\\phi}-1} w_{ij}\\, Y_{l}^{m}(\\theta_{i},\\phi_{j}).\n$$\nUsing the stated normalization, it is a well-tested and fundamental fact that $I_{0,0} = \\sqrt{4\\pi}$ and $I_{l,m} = 0$ for all $(l,m) \\ne (0,0)$. You must compute the exactness score\n$$\nS(L, N_{\\theta}, N_{\\phi}, \\tau) = \\frac{1}{|\\mathcal{H}_{L}|}\\sum_{l=0}^{L}\\ \\sum_{m=-l}^{l} \\mathbf{1}\\left( \\left|Q_{l,m} - I_{l,m}\\right| \\le \\tau \\right),\n$$\nwhere $|\\mathcal{H}_{L}| = \\sum_{l=0}^{L} (2l+1)$ is the cardinality and $\\mathbf{1}(\\cdot)$ is the indicator function. The angles $\\theta$ and $\\phi$ must be handled in radians. The final score $S$ must be reported as a decimal number in $[0,1]$.\n\nStarting only from the foundational definitions of spherical coordinates, the spherical surface measure, and the stated normalization and properties of Gauss–Legendre and trapezoidal rules, derive an algorithm to compute $S(L, N_{\\theta}, N_{\\phi}, \\tau)$ for a given tuple $(L, N_{\\theta}, N_{\\phi}, \\tau)$, and implement it in the specified programming language environment. Ensure that the quadrature weights satisfy $\\sum_{i,j} w_{ij} = 4\\pi$ so that the constant function is integrated exactly. Throughout, keep angles in radians.\n\nDesign your program to evaluate the exactness score for the following test suite of parameter tuples $(L, N_{\\theta}, N_{\\phi}, \\tau)$:\n- Case $1$: $(L, N_{\\theta}, N_{\\phi}, \\tau) = (5, 4, 8, 10^{-12})$.\n- Case $2$: $(L, N_{\\theta}, N_{\\phi}, \\tau) = (7, 3, 6, 10^{-9})$.\n- Case $3$: $(L, N_{\\theta}, N_{\\phi}, \\tau) = (9, 2, 4, 10^{-6})$.\n- Case $4$: $(L, N_{\\theta}, N_{\\phi}, \\tau) = (3, 1, 1, 10^{-12})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[s_{1},s_{2},s_{3},s_{4}]$, where each $s_{k}$ is the computed decimal score $S$ for the corresponding test case. No angles in degrees or percentage signs are permitted; express all angles in radians and all scores as decimal numbers.",
            "solution": "The problem statement has been critically validated and is deemed sound. It is scientifically grounded, well-posed, and provides a complete and consistent set of definitions and data for a formalizable problem in numerical analysis, specifically concerning the exactness of quadrature sets for integrating spherical harmonics.\n\nThe objective is to compute an exactness score, $S(L, N_{\\theta}, N_{\\phi}, \\tau)$, for a tensor-product quadrature scheme on the unit sphere. This score quantifies the fraction of spherical harmonics $Y_{l}^{m}$ up to a maximum degree $L$ that are integrated to within a given tolerance $\\tau$.\n\nThe analytic integral of a spherical harmonic $Y_{l}^{m}$ over the unit sphere, $S^2$, is given by:\n$$\nI_{l,m} = \\int_{S^{2}} Y_{l}^{m}(\\theta,\\phi)\\, d\\Omega = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} Y_{l}^{m}(\\theta,\\phi) \\sin\\theta\\,d\\theta\\,d\\phi\n$$\nThe spherical harmonic for $l=0, m=0$ is a constant, $Y_{0}^{0}(\\theta,\\phi) = 1/\\sqrt{4\\pi}$. Using this, we can write the integral as an inner product:\n$$\nI_{l,m} = \\int_{S^{2}} Y_{l}^{m}(\\theta,\\phi) \\cdot \\sqrt{4\\pi} Y_{0}^{0}(\\theta,\\phi) \\, d\\Omega = \\sqrt{4\\pi} \\int_{S^{2}} Y_{l}^{m}(\\theta,\\phi) \\overline{Y_{0}^{0}(\\theta,\\phi)} \\, d\\Omega\n$$\nwhere $\\overline{(\\cdot)}$ denotes the complex conjugate. Invoking the orthonormality property provided, $\\int_{S^{2}} Y_{l}^{m} \\overline{Y_{l'}^{m'}} d\\Omega = \\delta_{ll'}\\delta_{mm'}$, we find:\n$$\nI_{l,m} = \\sqrt{4\\pi} \\delta_{l0}\\delta_{m0}\n$$\nThis confirms the problem's statement that $I_{0,0} = \\sqrt{4\\pi}$ and $I_{l,m} = 0$ for all other $(l,m)$.\n\nThe numerical quadrature approximation of this integral is:\n$$\nQ_{l,m} = \\sum_{i=1}^{N_{\\theta}} \\sum_{j=0}^{N_{\\phi}-1} w_{ij}\\, Y_{l}^{m}(\\theta_{i},\\phi_{j})\n$$\nwhere the weights are $w_{ij} = w^{\\mu}_{i}\\, w^{\\phi}$. The nodes are $(\\theta_i, \\phi_j)$, with $\\theta_i = \\arccos(\\mu_i)$. The pairs $(\\mu_i, w^{\\mu}_{i})$ are the nodes and weights of the $N_{\\theta}$-point Gauss-Legendre quadrature on $[-1,1]$, and the azimuthal nodes and weights are $\\phi_j = 2\\pi j / N_{\\phi}$ and $w^{\\phi} = 2\\pi / N_{\\phi}$, respectively.\n\nThe algorithm to compute the exactness score $S$ is as follows:\n\n1.  **Initialize Parameters**: For each test case, we are given a tuple $(L, N_{\\theta}, N_{\\phi}, \\tau)$.\n2.  **Generate Quadrature Set**:\n    a.  Compute the $N_{\\theta}$ Gauss-Legendre nodes $\\mu_i$ and weights $w^{\\mu}_{i}$ on the interval $[-1,1]$. These can be obtained using standard numerical libraries, such as `numpy.polynomial.legendre.leggauss`.\n    b.  Convert the polar nodes to radians: $\\theta_i = \\arccos(\\mu_i)$.\n    c.  Compute the $N_{\\phi}$ equally spaced trapezoidal nodes $\\phi_j = 2\\pi j / N_{\\phi}$ for $j=0, \\dots, N_{\\phi}-1$ and the constant weight $w^{\\phi} = 2\\pi / N_{\\phi}$.\n3.  **Iterate and Evaluate**: We iterate through all spherical harmonics $Y_{l}^{m}$ for $0 \\le l \\le L$ and $-l \\le m \\le l$. For each harmonic:\n    a.  Determine the exact analytic integral, $I_{l,m}$, which is $\\sqrt{4\\pi}$ for $(l,m)=(0,0)$ and $0$ otherwise.\n    b.  Compute the numerical integral, $Q_{l,m}$. This is done by evaluating $Y_{l}^{m}(\\theta_i, \\phi_j)$ at each quadrature point, multiplying by the corresponding weight $w_{ij} = w^{\\mu}_{i} w^{\\phi}$, and summing the results. The complex spherical harmonics $Y_{l}^{m}$ are evaluated using a standard scientific library function, such as `scipy.special.sph_harm`.\n4.  **Compare and Count**: For each $(l,m)$, we calculate the absolute error $|Q_{l,m} - I_{l,m}|$ and check if it is less than or equal to the specified tolerance $\\tau$. A counter, initialized to zero, is incremented if the condition is met.\n5.  **Calculate Final Score**: After checking all $(L+1)^2$ harmonics in the set $\\mathcal{H}_L$, the final score is computed as the ratio of the counter to the total number of harmonics:\n    $$\n    S = \\frac{\\text{number of exactly integrated harmonics}}{|\\mathcal{H}_{L}|} = \\frac{\\text{counter}}{(L+1)^2}\n    $$\n\nThis procedure is implemented for each provided test case to determine the corresponding exactness score. The implementation should leverage vectorized computations for efficiency, particularly in the evaluation of the sum for $Q_{l,m}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import sph_harm\n\ndef solve():\n    \"\"\"\n    Evaluates the exactness score for a tensor-product quadrature on the sphere\n    for integrating spherical harmonics, based on a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, N_theta, N_phi, tau)\n        (5, 4, 8, 10**-12),\n        (7, 3, 6, 10**-9),\n        (9, 2, 4, 10**-6),\n        (3, 1, 1, 10**-12),\n    ]\n\n    results = []\n    for L, N_theta, N_phi, tau in test_cases:\n        # Step 1: Generate Quadrature Set\n        # Gauss-Legendre quadrature nodes (mu) and weights for the polar angle\n        mu_nodes, mu_weights = np.polynomial.legendre.leggauss(N_theta)\n        \n        # Convert mu nodes to polar angle theta nodes in radians\n        theta_nodes = np.arccos(mu_nodes)\n\n        # Trapezoidal rule nodes and weight for the azimuthal angle\n        phi_nodes = np.arange(N_phi, dtype=float) * (2.0 * np.pi / N_phi)\n        phi_weight = 2.0 * np.pi / N_phi\n        \n        # Initialize counters\n        total_harmonics = (L + 1)**2\n        exact_count = 0\n        \n        # Combine weights for tensor product\n        # weights_grid is an (N_theta, N_phi) array\n        weights_grid = np.outer(mu_weights, np.full(N_phi, phi_weight))\n\n        # Create meshgrid of angles for vectorized evaluation\n        # theta_grid and phi_grid are (N_theta, N_phi) arrays\n        # Note: 'ij' indexing ensures theta corresponds to the first axis\n        theta_grid, phi_grid = np.meshgrid(theta_nodes, phi_nodes, indexing='ij')\n\n        # Step 2: Iterate over all spherical harmonics up to degree L\n        for l in range(L + 1):\n            for m in range(-l, l + 1):\n                # Step 3a: Determine analytic integral I_l,m\n                if l == 0 and m == 0:\n                    I_lm = np.sqrt(4.0 * np.pi)\n                else:\n                    I_lm = 0.0\n\n                # Step 3b: Compute numerical quadrature Q_l,m\n                # Evaluate Y_l^m at all quadrature points (vectorized)\n                # sph_harm arguments are (m, l, azimuth_phi, polar_theta)\n                y_lm_values = sph_harm(m, l, phi_grid, theta_grid)\n\n                # Compute the sum over all points\n                Q_lm = np.sum(weights_grid * y_lm_values)\n\n                # Step 4: Compare and Count\n                # np.abs handles complex numbers correctly (computes magnitude)\n                if np.abs(Q_lm - I_lm) = tau:\n                    exact_count += 1\n        \n        # Step 5: Calculate Final Score\n        score = exact_count / total_harmonics\n        results.append(score)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}