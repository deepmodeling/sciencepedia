{
    "hands_on_practices": [
        {
            "introduction": "The Linear Boltzmann Transport Equation is a first-order hyperbolic partial differential equation. The most direct way to solve it is by using the method of characteristics, which converts the PDE into a simpler ordinary differential equation along the path of particle motion. This fundamental technique  provides deep insight into how a particle population evolves, balancing attenuation from collisions against buildup from sources as it traverses a medium.",
            "id": "4255574",
            "problem": "Consider the steady-state, monoenergetic linear Boltzmann transport equation (LBTE) for the angular flux $ \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $ in a homogeneous medium with constant total macroscopic cross section $ \\Sigma_{t} $ and a constant, isotropic volumetric source $ Q $ that is independent of position, direction, and energy. Assume that the direction $ \\boldsymbol{\\Omega} $ is a unit vector and that scattering is already subsumed into $ Q $ so that no explicit scattering term appears. Let $ s $ denote the path-length coordinate along a straight characteristic in the direction $ \\boldsymbol{\\Omega} $, with $ s = 0 $ at an inflow boundary where the boundary value $ \\psi(0) = \\psi_{b} $ is prescribed, and $ s = L $ at an interior point a distance $ L $ along the characteristic.\n\nStarting from the LBTE and the definition of the directional derivative along characteristics, derive the characteristic ordinary differential equation governing $ \\psi(s) $, and solve it subject to the inflow boundary condition to obtain the closed-form expression for $ \\psi(L) $ as a function of $ \\Sigma_{t} $, $ Q $, $ \\psi_{b} $, and $ L $.\n\nExpress your final answer as a single analytic expression. No rounding is required. Do not include units in the final boxed answer.",
            "solution": "The problem is well-posed and asks for a standard derivation in transport theory. The solution involves solving a first-order ordinary differential equation (ODE) that describes particle transport along a characteristic line.\n\n1.  **Formulate the Characteristic Equation**:\n    The steady-state, monoenergetic linear Boltzmann transport equation in a homogeneous medium without an explicit scattering term is:\n    $$\n    \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = Q\n    $$\n    Let $s$ be the distance along a characteristic line in the direction $\\boldsymbol{\\Omega}$, so that $\\mathbf{r}(s) = \\mathbf{r}(0) + s\\boldsymbol{\\Omega}$. The directional derivative along this characteristic is $\\frac{d}{ds}\\psi(\\mathbf{r}(s), \\boldsymbol{\\Omega}) = \\boldsymbol{\\Omega} \\cdot \\nabla \\psi$. Substituting this into the transport equation gives a first-order ordinary differential equation for $\\psi(s) \\equiv \\psi(\\mathbf{r}(s), \\boldsymbol{\\Omega})$:\n    $$\n    \\frac{d\\psi(s)}{ds} + \\Sigma_t \\psi(s) = Q\n    $$\n\n2.  **Solve the ODE**:\n    This is a first-order linear ODE. We can solve it using an integrating factor, $I(s)$. The integrating factor is given by $I(s) = \\exp\\left(\\int \\Sigma_t \\,ds\\right) = \\exp(s\\Sigma_t)$, since $\\Sigma_t$ is constant.\n    \n    Multiplying the entire ODE by the integrating factor $I(s)$:\n    $$\n    \\exp(s\\Sigma_t)\\frac{d\\psi(s)}{ds} + \\Sigma_t \\exp(s\\Sigma_t) \\psi(s) = Q \\exp(s\\Sigma_t)\n    $$\n    The left side of the equation is the derivative of the product $\\psi(s) \\exp(s\\Sigma_t)$ with respect to $s$:\n    $$\n    \\frac{d}{ds}\\left[ \\psi(s) \\exp(s\\Sigma_t) \\right] = Q \\exp(s\\Sigma_t)\n    $$\n\n3.  **Integrate and Apply Boundary Conditions**:\n    We integrate this equation from the inflow boundary at $s=0$ to the interior point at $s=L$:\n    $$\n    \\int_{0}^{L} \\frac{d}{ds}\\left[ \\psi(s) \\exp(s\\Sigma_t) \\right] ds = \\int_{0}^{L} Q \\exp(s\\Sigma_t) ds\n    $$\n    Evaluating the definite integrals on both sides:\n    $$\n    \\left[ \\psi(s) \\exp(s\\Sigma_t) \\right]_{0}^{L} = Q \\left[ \\frac{\\exp(s\\Sigma_t)}{\\Sigma_t} \\right]_{0}^{L}\n    $$\n    $$\n    \\psi(L)\\exp(L\\Sigma_t) - \\psi(0)\\exp(0) = \\frac{Q}{\\Sigma_t}(\\exp(L\\Sigma_t) - \\exp(0))\n    $$\n    Using the given boundary condition $\\psi(0) = \\psi_b$ and that $\\exp(0)=1$:\n    $$\n    \\psi(L)\\exp(L\\Sigma_t) - \\psi_b = \\frac{Q}{\\Sigma_t}(\\exp(L\\Sigma_t) - 1)\n    $$\n\n4.  **Final Expression**:\n    Finally, we solve for $\\psi(L)$ by isolating it:\n    $$\n    \\psi(L)\\exp(L\\Sigma_t) = \\psi_b + \\frac{Q}{\\Sigma_t}(\\exp(L\\Sigma_t) - 1)\n    $$\n    Multiplying the entire equation by $\\exp(-L\\Sigma_t)$:\n    $$\n    \\psi(L) = \\psi_b \\exp(-L\\Sigma_t) + \\frac{Q}{\\Sigma_t}(1 - \\exp(-L\\Sigma_t))\n    $$\n    This expression shows that the flux at distance $L$ consists of two components: the attenuated flux from the boundary source ($\\psi_b$) and the accumulated flux from the volumetric source ($Q$) along the path, also subject to attenuation. This is the final analytical solution.",
            "answer": "$$\n\\boxed{\\psi_{b} \\exp(-\\Sigma_{t} L) + \\frac{Q}{\\Sigma_{t}}(1 - \\exp(-\\Sigma_{t} L))}\n$$"
        },
        {
            "introduction": "While the method of characteristics provides an exact solution along a single path, practical simulations often use moment-based methods (like the $P_N$ approximation) that solve for angular moments of the flux. The key challenge in this approach is to correctly represent the angular moments of the scattering source term. This exercise  walks you through the formal derivation of the zeroth and first moments of the inscattering source, a crucial step for developing the coupled moment equations that are solved in many transport codes.",
            "id": "4255578",
            "problem": "Consider the steady-state, mono-source, multigroup form of the linear Boltzmann transport equation for neutral particles in an infinite, homogeneous medium with azimuthally symmetric scattering. The inscattering source in energy group $g$ from all other groups $g' \\in \\{1,\\dots,G\\}$ is defined as\n$$\nQ_{s}^{g}(\\boldsymbol{\\Omega}) \\;=\\; \\sum_{g'=1}^{G} \\int_{4\\pi} \\Sigma_{s}^{g'\\to g}(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\psi^{g'}(\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega}' \\,,\n$$\nwhere $\\psi^{g'}(\\boldsymbol{\\Omega}')$ is the angular flux in energy group $g'$ and direction $\\boldsymbol{\\Omega}'$, and $\\Sigma_{s}^{g'\\to g}(\\mu)$ is the macroscopic differential scattering cross section for a scattering cosine $\\mu = \\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}'$. Assume linearly anisotropic scattering (the $P_{1}$ approximation) with the Legendre expansion\n$$\n\\Sigma_{s}^{g'\\to g}(\\mu) \\;=\\; \\sum_{\\ell=0}^{1} \\frac{2\\ell+1}{4\\pi}\\,\\Sigma_{s\\ell}^{g'\\to g}\\,P_{\\ell}(\\mu) \\,,\n$$\nwhere $P_{\\ell}(\\mu)$ are Legendre polynomials and $\\Sigma_{s\\ell}^{g'\\to g}$ are the Legendre moments of the group-to-group scattering cross section. Define the angular moments of the angular flux as the scalar flux (zeroth moment)\n$$\n\\phi^{g} \\;\\equiv\\; \\int_{4\\pi} \\psi^{g}(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\boldsymbol{\\Omega} \\,,\n$$\nand the neutron current (first moment vector)\n$$\n\\mathbf{J}^{g} \\;\\equiv\\; \\int_{4\\pi} \\boldsymbol{\\Omega}\\,\\psi^{g}(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\boldsymbol{\\Omega} \\,.\n$$\nSimilarly, define the zeroth and first angular moments of the inscattering source for group $g$ as\n$$\nq_{s,0}^{g} \\;\\equiv\\; \\int_{4\\pi} Q_{s}^{g}(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\boldsymbol{\\Omega} \\,,\\qquad\n\\mathbf{q}_{s,1}^{g} \\;\\equiv\\; \\int_{4\\pi} \\boldsymbol{\\Omega}\\,Q_{s}^{g}(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\boldsymbol{\\Omega} \\,.\n$$\n\nStarting only from these definitions and the orthogonality and addition properties of Legendre polynomials on the unit sphere, derive the explicit multigroup expressions for the inscattering source moment contributions $q_{s,0}^{g}$ and $\\mathbf{q}_{s,1}^{g}$ in terms of the Legendre moments $\\Sigma_{s0}^{g'\\to g}$ and $\\Sigma_{s1}^{g'\\to g}$ and the angular flux moments $\\phi^{g'}$ and $\\mathbf{J}^{g'}$. Express your final answer as a pair of expressions in a single row matrix, with the first entry being $q_{s,0}^{g}$ and the second entry being the vector $\\mathbf{q}_{s,1}^{g}$. No numerical evaluation is required, and no units are to be included in the final answer.",
            "solution": "The problem is valid as it is scientifically grounded in the established theory of neutron transport, is mathematically well-posed, and uses objective, formal language. It presents a standard derivation in nuclear reactor physics based on a complete and consistent set of definitions.\n\nThe objective is to derive expressions for the zeroth and first angular moments of the multigroup inscattering source, denoted as $q_{s,0}^{g}$ and $\\mathbf{q}_{s,1}^{g}$ respectively. The derivation will start from the provided definitions and utilize the properties of Legendre polynomials.\n\nFirst, we recall the key definitions:\nThe inscattering source in group $g$:\n$$\nQ_{s}^{g}(\\boldsymbol{\\Omega}) = \\sum_{g'=1}^{G} \\int_{4\\pi} \\Sigma_{s}^{g'\\to g}(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\psi^{g'}(\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega}'\n$$\nThe linearly anisotropic ($P_1$) scattering cross section:\n$$\n\\Sigma_{s}^{g'\\to g}(\\mu) = \\sum_{\\ell=0}^{1} \\frac{2\\ell+1}{4\\pi}\\,\\Sigma_{s\\ell}^{g'\\to g}\\,P_{\\ell}(\\mu) = \\frac{1}{4\\pi}\\Sigma_{s0}^{g'\\to g}P_0(\\mu) + \\frac{3}{4\\pi}\\Sigma_{s1}^{g'\\to g}P_1(\\mu)\n$$\nwhere $\\mu = \\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}'$, $P_0(\\mu)=1$, and $P_1(\\mu)=\\mu$.\n\nThe moments of the inscattering source are:\n$$\nq_{s,0}^{g} \\equiv \\int_{4\\pi} Q_{s}^{g}(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\boldsymbol{\\Omega}\n$$\n$$\n\\mathbf{q}_{s,1}^{g} \\equiv \\int_{4\\pi} \\boldsymbol{\\Omega}\\,Q_{s}^{g}(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\boldsymbol{\\Omega}\n$$\n\n**Derivation of the Zeroth Moment, $q_{s,0}^{g}$**\n\nWe begin with the definition of $q_{s,0}^{g}$ and substitute the expression for $Q_{s}^{g}(\\boldsymbol{\\Omega})$:\n$$\nq_{s,0}^{g} = \\int_{4\\pi} \\left( \\sum_{g'=1}^{G} \\int_{4\\pi} \\Sigma_{s}^{g'\\to g}(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\psi^{g'}(\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega}' \\right) \\mathrm{d}\\boldsymbol{\\Omega}\n$$\nAssuming the integrals and sum are well-behaved, we can change the order of integration and summation:\n$$\nq_{s,0}^{g} = \\sum_{g'=1}^{G} \\int_{4\\pi} \\psi^{g'}(\\boldsymbol{\\Omega}') \\left( \\int_{4\\pi} \\Sigma_{s}^{g'\\to g}(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega} \\right) \\mathrm{d}\\boldsymbol{\\Omega}'\n$$\nNow, we evaluate the inner integral by substituting the $P_1$ expansion for the cross section:\n$$\n\\int_{4\\pi} \\Sigma_{s}^{g'\\to g}(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega} = \\int_{4\\pi} \\left( \\frac{1}{4\\pi}\\Sigma_{s0}^{g'\\to g}P_0(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}') + \\frac{3}{4\\pi}\\Sigma_{s1}^{g'\\to g}P_1(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}') \\right) \\mathrm{d}\\boldsymbol{\\Omega}\n$$\nWe can separate this into two integrals:\n$$\n= \\frac{\\Sigma_{s0}^{g'\\to g}}{4\\pi} \\int_{4\\pi} P_0(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega} + \\frac{3\\Sigma_{s1}^{g'\\to g}}{4\\pi} \\int_{4\\pi} P_1(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega}\n$$\nUsing the properties $P_0(\\mu) = 1$ and $P_1(\\mu) = \\mu = \\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}'$, we evaluate each integral.\nThe first integral is:\n$$\n\\int_{4\\pi} 1\\,\\mathrm{d}\\boldsymbol{\\Omega} = 4\\pi\n$$\nThe second integral is:\n$$\n\\int_{4\\pi} \\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}'\\,\\mathrm{d}\\boldsymbol{\\Omega} = \\boldsymbol{\\Omega}' \\cdot \\int_{4\\pi} \\boldsymbol{\\Omega}\\,\\mathrm{d}\\boldsymbol{\\Omega}\n$$\nThe integral $\\int_{4\\pi} \\boldsymbol{\\Omega}\\,\\mathrm{d}\\boldsymbol{\\Omega}$ is a vector integral over the unit sphere, which is symmetric with respect to the origin. By symmetry, the result is the zero vector, $\\mathbf{0}$. Therefore, the second integral evaluates to $0$.\n\nSubstituting these results back, the inner integral simplifies to:\n$$\n\\frac{\\Sigma_{s0}^{g'\\to g}}{4\\pi} (4\\pi) + \\frac{3\\Sigma_{s1}^{g'\\to g}}{4\\pi} (0) = \\Sigma_{s0}^{g'\\to g}\n$$\nNow, we substitute this back into the expression for $q_{s,0}^{g}$:\n$$\nq_{s,0}^{g} = \\sum_{g'=1}^{G} \\int_{4\\pi} \\psi^{g'}(\\boldsymbol{\\Omega}') (\\Sigma_{s0}^{g'\\to g}) \\,\\mathrm{d}\\boldsymbol{\\Omega}'\n$$\nSince $\\Sigma_{s0}^{g'\\to g}$ is a constant with respect to the integration variable $\\boldsymbol{\\Omega}'$, we can pull it out of the integral:\n$$\nq_{s,0}^{g} = \\sum_{g'=1}^{G} \\Sigma_{s0}^{g'\\to g} \\int_{4\\pi} \\psi^{g'}(\\boldsymbol{\\Omega}') \\,\\mathrm{d}\\boldsymbol{\\Omega}'\n$$\nRecognizing the remaining integral as the definition of the scalar flux $\\phi^{g'}$, we arrive at the final expression for the zeroth moment of the inscattering source:\n$$\nq_{s,0}^{g} = \\sum_{g'=1}^{G} \\Sigma_{s0}^{g'\\to g} \\phi^{g'}\n$$\n\n**Derivation of the First Moment, $\\mathbf{q}_{s,1}^{g}$**\n\nWe follow a similar procedure for the first moment, $\\mathbf{q}_{s,1}^{g}$. Starting from its definition:\n$$\n\\mathbf{q}_{s,1}^{g} = \\int_{4\\pi} \\boldsymbol{\\Omega}\\,Q_{s}^{g}(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\boldsymbol{\\Omega}\n$$\nSubstituting for $Q_{s}^{g}(\\boldsymbol{\\Omega})$ and changing the order of operations:\n$$\n\\mathbf{q}_{s,1}^{g} = \\sum_{g'=1}^{G} \\int_{4\\pi} \\psi^{g'}(\\boldsymbol{\\Omega}') \\left( \\int_{4\\pi} \\boldsymbol{\\Omega}\\,\\Sigma_{s}^{g'\\to g}(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega} \\right) \\mathrm{d}\\boldsymbol{\\Omega}'\n$$\nWe evaluate the inner vector integral by substituting the $P_1$ expansion:\n$$\n\\int_{4\\pi} \\boldsymbol{\\Omega}\\,\\Sigma_{s}^{g'\\to g}(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega} = \\int_{4\\pi} \\boldsymbol{\\Omega}\\left( \\frac{1}{4\\pi}\\Sigma_{s0}^{g'\\to g}P_0(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}') + \\frac{3}{4\\pi}\\Sigma_{s1}^{g'\\to g}P_1(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}') \\right) \\mathrm{d}\\boldsymbol{\\Omega}\n$$\n$$\n= \\frac{\\Sigma_{s0}^{g'\\to g}}{4\\pi} \\int_{4\\pi} \\boldsymbol{\\Omega}\\,P_0(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega} + \\frac{3\\Sigma_{s1}^{g'\\to g}}{4\\pi} \\int_{4\\pi} \\boldsymbol{\\Omega}\\,P_1(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega}\n$$\nWe evaluate the two vector integrals. The first integral, using $P_0(\\mu)=1$, is:\n$$\n\\int_{4\\pi} \\boldsymbol{\\Omega}\\cdot 1\\,\\mathrm{d}\\boldsymbol{\\Omega} = \\mathbf{0}\n$$\ndue to symmetry, as established before.\nThe second integral, using $P_1(\\mu) = \\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}'$, is:\n$$\n\\int_{4\\pi} \\boldsymbol{\\Omega}\\,(\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}')\\,\\mathrm{d}\\boldsymbol{\\Omega}\n$$\nTo evaluate this, consider a coordinate system where $\\boldsymbol{\\Omega}'$ is aligned with the z-axis, i.e., $\\boldsymbol{\\Omega}' = (0, 0, 1)$. Then $\\boldsymbol{\\Omega}\\cdot\\boldsymbol{\\Omega}' = \\Omega_z = \\cos\\theta$. The integral of the z-component becomes:\n$$\n\\int_{4\\pi} \\Omega_z (\\Omega_z) \\mathrm{d}\\boldsymbol{\\Omega} = \\int_0^{2\\pi}\\int_0^{\\pi} (\\cos\\theta)^2 \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = 2\\pi \\int_{-1}^{1} u^2\\,\\mathrm{d}u = 2\\pi \\left[\\frac{u^3}{3}\\right]_{-1}^{1} = \\frac{4\\pi}{3}\n$$\nThe x-component is $\\int_{4\\pi} \\Omega_x (\\Omega_z)\\,\\mathrm{d}\\boldsymbol{\\Omega} = \\int_0^{2\\pi}\\cos\\phi\\,\\mathrm{d}\\phi \\int_0^\\pi \\sin^2\\theta\\cos\\theta\\,\\mathrm{d}\\theta = 0$. Similarly, the y-component is $0$.\nThus, the vector integral result is $(0, 0, 4\\pi/3)$, which is equivalent to $\\frac{4\\pi}{3}(0, 0, 1) = \\frac{4\\pi}{3}\\boldsymbol{\\Omega}'$. This result is general for any orientation of $\\boldsymbol{\\Omega}'$.\n\nSubstituting the values of the integrals back:\n$$\n\\frac{\\Sigma_{s0}^{g'\\to g}}{4\\pi}(\\mathbf{0}) + \\frac{3\\Sigma_{s1}^{g'\\to g}}{4\\pi}\\left(\\frac{4\\pi}{3}\\boldsymbol{\\Omega}'\\right) = \\Sigma_{s1}^{g'\\to g}\\boldsymbol{\\Omega}'\n$$\nNow, we substitute this result into the expression for $\\mathbf{q}_{s,1}^{g}$:\n$$\n\\mathbf{q}_{s,1}^{g} = \\sum_{g'=1}^{G} \\int_{4\\pi} \\psi^{g'}(\\boldsymbol{\\Omega}') (\\Sigma_{s1}^{g'\\to g}\\boldsymbol{\\Omega}') \\,\\mathrm{d}\\boldsymbol{\\Omega}'\n$$\nPulling the constant scalar $\\Sigma_{s1}^{g'\\to g}$ outside the integral:\n$$\n\\mathbf{q}_{s,1}^{g} = \\sum_{g'=1}^{G} \\Sigma_{s1}^{g'\\to g} \\int_{4\\pi} \\boldsymbol{\\Omega}'\\,\\psi^{g'}(\\boldsymbol{\\Omega}') \\,\\mathrm{d}\\boldsymbol{\\Omega}'\n$$\nThe remaining integral is the definition of the neutron current vector, $\\mathbf{J}^{g'}$. This gives the final expression for the first moment of the inscattering source:\n$$\n\\mathbf{q}_{s,1}^{g} = \\sum_{g'=1}^{G} \\Sigma_{s1}^{g'\\to g} \\mathbf{J}^{g'}\n$$\n\nIn summary, the zeroth and first angular moments of the linearly anisotropic inscattering source are given by the sums over all source groups $g'$ of the respective scattering cross-section moments multiplied by the corresponding angular flux moments.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sum_{g'=1}^{G} \\Sigma_{s0}^{g'\\to g} \\phi^{g'}  \\sum_{g'=1}^{G} \\Sigma_{s1}^{g'\\to g} \\mathbf{J}^{g'} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Ultimately, most real-world transport problems are too complex for analytical solutions and must be solved numerically. The discrete ordinates ($S_N$) method, which discretizes the angular domain, is a cornerstone of modern transport simulation. This practice  takes you into the heart of the computational process, asking you to implement a single iteration of an $S_N$ solver to see firsthand how the angular flux is updated across a spatial mesh in a \"transport sweep.\"",
            "id": "4255613",
            "problem": "Consider a one-dimensional slab geometry for steady-state neutron transport with isotropic scattering and a spatially constant volumetric external source. The fundamental base is the one-speed, one-dimensional form of the linear Boltzmann transport equation for the angular flux $\\psi(x,\\mu)$,\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t \\,\\psi(x,\\mu) = q + \\frac{\\Sigma_s}{2}\\,\\phi(x),\n$$\nwhere $x$ is position in $\\text{cm}$ along the slab, $\\mu$ is the direction cosine, $\\Sigma_t$ is the macroscopic total cross section in $\\text{cm}^{-1}$, $\\Sigma_s$ is the macroscopic scattering cross section in $\\text{cm}^{-1}$, $q$ is the constant isotropic volumetric source in $\\text{n}/\\text{cm}^3\\text{-s-sr}$, and $\\phi(x)$ is the scalar flux in $\\text{n}/\\text{cm}^2\\text{-s}$. The scalar flux is defined as\n$$\n\\phi(x) = \\int_{-1}^{1}\\psi(x,\\mu)\\,d\\mu.\n$$\n\nUse the discrete ordinates (also known as $S_N$) method at the $S_2$ level with Gaussâ€“Legendre quadrature, which employs two directions $\\mu_1 = +1/\\sqrt{3}$ and $\\mu_2 = -1/\\sqrt{3}$ with weights $w_1 = 1$ and $w_2 = 1$. Apply the diamond difference spatial discretization on a uniform mesh of $N$ cells of width $h = L/N$, where $L$ is the slab thickness in $\\text{cm}$. Impose boundary conditions through specified incoming angular fluxes for the two discrete directions at the vacuum or incident boundaries.\n\nPerform a single source iteration starting from the initial guess $\\phi^{(0)}(x) = 0$ (so the scattering source is null on this iteration). Execute one full $S_2$ sweep: for $\\mu_10$, sweep left-to-right using the left boundary incoming condition, and for $\\mu_20$, sweep right-to-left using the right boundary incoming condition. Within each cell, use the diamond difference relation between cell-edge and cell-averaged angular fluxes to update the outgoing edge angular flux given the incoming edge angular flux and the cell source. After completing both directional sweeps, compute the first-iteration scalar flux $\\phi^{(1)}(x)$ at each cell center from the two cell-averaged angular fluxes and the $S_2$ weights.\n\nUnits must be adhered to as follows: report the final scalar flux values in $\\text{n}/\\text{cm}^2\\text{-s}$. Angles are not used explicitly; direction cosines $\\mu$ are dimensionless.\n\nImplement this procedure as a complete, runnable program. Your program must solve the following test suite and aggregate the results exactly as specified. For each test case, return the list of cell-centered first-iteration scalar flux values $\\phi^{(1)}$ as floating-point numbers. The program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, with each floating-point number formatted to six decimal places (for example, $[\\,[0.123456,0.234567],\\,[0.345678,0.456789]\\,]$).\n\nTest suite (all parameters are constant over space within a case):\n\n- Test case $1$ (happy path, vacuum boundaries):\n  - Slab thickness $L = 10\\,\\text{cm}$, number of cells $N = 20$, $\\Sigma_t = 1.0\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.9\\,\\text{cm}^{-1}$, external source $q = 0.2\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: incoming angular flux $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$ at $x=0$ and $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$ at $x=L$ (vacuum at both ends).\n\n- Test case $2$ (pure absorber, vacuum boundaries):\n  - Slab thickness $L = 5\\,\\text{cm}$, number of cells $N = 10$, $\\Sigma_t = 1.0\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.0\\,\\text{cm}^{-1}$, external source $q = 0.1\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$, $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$.\n\n- Test case $3$ (incident beam at left boundary, vacuum at right):\n  - Slab thickness $L = 3\\,\\text{cm}$, number of cells $N = 6$, $\\Sigma_t = 0.5\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.4\\,\\text{cm}^{-1}$, external source $q = 0.0\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 1.0\\,\\text{n}/\\text{cm}^2\\text{-s-sr}$, $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$.\n\n- Test case $4$ (thin slab, moderate absorption, vacuum boundaries):\n  - Slab thickness $L = 2\\,\\text{cm}$, number of cells $N = 4$, $\\Sigma_t = 0.2\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.0\\,\\text{cm}^{-1}$, external source $q = 0.05\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$, $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets (e.g., $[\\,[\\phi_1^{(1)}(x_1),\\ldots,\\phi_1^{(1)}(x_N)],\\,[\\phi_2^{(1)}(x_1),\\ldots,\\phi_2^{(1)}(x_N)],\\,[\\phi_3^{(1)}(x_1),\\ldots,\\phi_3^{(1)}(x_N)],\\,[\\phi_4^{(1)}(x_1),\\ldots,\\phi_4^{(1)}(x_N)]\\,]$), with each floating-point number formatted to six decimal places and interpreted in $\\text{n}/\\text{cm}^2\\text{-s}$.",
            "solution": "The problem is valid as it presents a well-posed, scientifically grounded scenario in the field of computational neutron transport. All parameters, boundary conditions, and numerical methods are clearly defined, enabling a unique solution for the requested first iteration. The procedures and physical model are standard in nuclear engineering education and practice. We shall proceed with the derivation and implementation of the specified algorithm.\n\nThe problem requires the numerical solution of the one-speed, one-dimensional, steady-state linear Boltzmann transport equation for a slab geometry with isotropic scattering and a constant external source. The governing equation for the angular neutron flux $\\psi(x,\\mu)$ is:\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t \\,\\psi(x,\\mu) = Q(x,\\mu)\n$$\nwhere $x \\in [0, L]$ is the spatial coordinate, $\\mu \\in [-1, 1]$ is the cosine of the angle with the positive $x$-axis, $\\Sigma_t$ is the macroscopic total cross section, and $Q(x,\\mu)$ is the total source of neutrons. For this problem, the source is composed of an external volumetric source $q$ and a scattering source term:\n$$\nQ(x,\\mu) = q + \\frac{\\Sigma_s}{2}\\,\\phi(x)\n$$\nHere, $\\Sigma_s$ is the macroscopic scattering cross section and $\\phi(x)$ is the scalar flux, defined as the integral of the angular flux over all directions:\n$$\n\\phi(x) = \\int_{-1}^{1}\\psi(x,\\mu)\\,d\\mu\n$$\n\nThe discrete ordinates ($S_N$) method is employed to solve this equation. This method discretizes the angular variable $\\mu$ into a set of discrete directions $\\{\\mu_m\\}$ with corresponding quadrature weights $\\{w_m\\}$. The problem specifies an $S_2$ treatment with Gauss-Legendre quadrature, which yields two directions $\\mu_1 = 1/\\sqrt{3}$ and $\\mu_2 = -1/\\sqrt{3}$, each with a weight $w_m=1$. This transforms the single integro-differential equation into a system of coupled ordinary differential equations, one for each discrete direction $\\mu_m$:\n$$\n\\mu_m \\,\\frac{d \\psi_m(x)}{dx} + \\Sigma_t \\,\\psi_m(x) = q + \\frac{\\Sigma_s}{2}\\,\\sum_{j=1}^{2} w_j \\psi_j(x)\n$$\nwhere $\\psi_m(x) \\equiv \\psi(x,\\mu_m)$ and the scalar flux is approximated by the quadrature sum $\\phi(x) \\approx \\sum_{j=1}^{2} w_j \\psi_j(x)$.\n\nThe spatial domain $[0, L]$ is discretized into $N$ uniform cells, each of width $h = L/N$. Let cell $i$ span the interval $[x_{i-1/2}, x_{i+1/2}]$. Integrating the discrete ordinates equation over cell $i$ yields a balance equation:\n$$\n\\mu_m (\\psi_{m,i+1/2} - \\psi_{m,i-1/2}) + \\Sigma_t h \\bar{\\psi}_{m,i} = h \\bar{S}_{m,i}\n$$\nHere, $\\psi_{m,i\\pm1/2}$ are the angular fluxes at the cell edges and $\\bar{\\psi}_{m,i}$ and $\\bar{S}_{m,i}$ are the cell-averaged angular flux and source, respectively. The source term for the first iteration, starting from an initial guess of zero scalar flux ($\\phi^{(0)}(x) = 0$), is simply the constant external source $\\bar{S}_{m,i} = q$.\n\nTo close this system, the diamond difference (DD) spatial discretization scheme is used. This scheme relates the cell-averaged flux to the cell-edge fluxes via a linear interpolation:\n$$\n\\bar{\\psi}_{m,i} = \\frac{\\psi_{m,i+1/2} + \\psi_{m,i-1/2}}{2}\n$$\nSubstituting the DD relation into the balance equation, we can derive an explicit formula for the outgoing flux from a cell as a function of the incoming flux. We use the absolute value of the direction cosine, $|\\mu_m|$, to provide a unified expression.\n\nFor a sweep in the direction of increasing $x$ ($\\mu_m  0$), the incoming flux to cell $i$ is $\\psi_{m,i-1/2}$ and the outgoing flux is $\\psi_{m,i+1/2}$. The update formula is:\n$$\n\\psi_{m,i+1/2} = \\frac{|\\mu_m| - \\frac{\\Sigma_t h}{2}}{|\\mu_m| + \\frac{\\Sigma_t h}{2}} \\psi_{m,i-1/2} + \\frac{h q}{|\\mu_m| + \\frac{\\Sigma_t h}{2}}\n$$\nFor a sweep in the direction of decreasing $x$ ($\\mu_m  0$), the incoming flux to cell $i$ is $\\psi_{m,i+1/2}$ and the outgoing flux is $\\psi_{m,i-1/2}$. The update formula is:\n$$\n\\psi_{m,i-1/2} = \\frac{|\\mu_m| - \\frac{\\Sigma_t h}{2}}{|\\mu_m| + \\frac{\\Sigma_t h}{2}} \\psi_{m,i+1/2} + \\frac{h q}{|\\mu_m| + \\frac{\\Sigma_t h}{2}}\n$$\n\nThe overall algorithm for a single source iteration is as follows:\n1.  **Initialization**: Define problem parameters $L, N, \\Sigma_t, \\Sigma_s, q$, and boundary conditions. Calculate cell width $h=L/N$. The quadrature set is $\\mu_1 = 1/\\sqrt{3}$, $\\mu_2 = -1/\\sqrt{3}$, and $w_1 = w_2 = 1$. The initial scalar flux is $\\phi^{(0)}(x) = 0$, so the scattering source term is zero for this iteration.\n2.  **Sweep for $\\mu_1  0$ (Left-to-Right)**:\n    - Initialize the cell-edge angular flux at the left boundary $\\psi_{1,1/2} = \\psi_{\\text{inc},\\text{left}}(\\mu_1)$.\n    - For each cell $i=1, \\dots, N$, calculate the outgoing edge flux $\\psi_{1,i+1/2}$ using the incoming flux $\\psi_{1,i-1/2}$ and the first update formula.\n    - Store all edge fluxes $\\psi_{1,i-1/2}$ for $i=1, \\dots, N+1$.\n3.  **Sweep for $\\mu_2  0$ (Right-to-Left)**:\n    - Initialize the cell-edge angular flux at the right boundary $\\psi_{2,N+1/2} = \\psi_{\\text{inc},\\text{right}}(\\mu_2)$.\n    - For each cell $i=N, \\dots, 1$ (in reverse), calculate the outgoing edge flux $\\psi_{2,i-1/2}$ using the incoming flux $\\psi_{2,i+1/2}$ and the second update formula.\n    - Store all edge fluxes $\\psi_{2,i-1/2}$ for $i=1, \\dots, N+1$.\n4.  **Scalar Flux Update**:\n    - For each cell $i=1, \\dots, N$:\n    - Calculate the cell-averaged angular flux for direction 1 using the DD relation: $\\bar{\\psi}^{(1)}_{1,i} = (\\psi_{1,i+1/2} + \\psi_{1,i-1/2})/2$.\n    - Calculate the cell-averaged angular flux for direction 2: $\\bar{\\psi}^{(1)}_{2,i} = (\\psi_{2,i+1/2} + \\psi_{2,i-1/2})/2$.\n    - Compute the new cell-averaged scalar flux $\\bar{\\phi}^{(1)}_i$ using the $S_2$ quadrature formula:\n        $$\n        \\bar{\\phi}^{(1)}_i = w_1 \\bar{\\psi}^{(1)}_{1,i} + w_2 \\bar{\\psi}^{(1)}_{2,i} = \\bar{\\psi}^{(1)}_{1,i} + \\bar{\\psi}^{(1)}_{2,i}\n        $$\nThis procedure is implemented for each test case to produce the list of cell-centered scalar fluxes, $\\bar{\\phi}^{(1)}_i$.",
            "answer": "```python\nimport numpy as np\n\ndef s2_diamond_difference_iteration(L, N, Sigma_t, Sigma_s, q, psi_inc_left, psi_inc_right):\n    \"\"\"\n    Performs a single S2 source iteration with diamond differencing for a 1D slab.\n\n    Args:\n        L (float): Slab thickness in cm.\n        N (int): Number of spatial cells.\n        Sigma_t (float): Macroscopic total cross section in cm^-1.\n        Sigma_s (float): Macroscopic scattering cross section in cm^-1. (Not used in first iteration).\n        q (float): Isotropic volumetric source in n/cm^3-s-sr.\n        psi_inc_left (float): Incoming angular flux for mu0 at x=0.\n        psi_inc_right (float): Incoming angular flux for mu0 at x=L.\n\n    Returns:\n        list[float]: A list of cell-centered scalar flux values for the first iteration.\n    \"\"\"\n    # S2 Gauss-Legendre quadrature set\n    mu = 1.0 / np.sqrt(3.0)\n    w = 1.0  # weights for both directions are 1\n\n    # Spatial discretization\n    h = L / N\n    \n    # In this first iteration, the scattering source is zero because phi_guess = 0.\n    # The total source Q is therefore just the external source q.\n    source = q\n\n    # Arrays to store cell-edge angular fluxes.\n    # Indices 0 to N correspond to spatial locations x_0, x_1, ..., x_N.\n    psi1_edge = np.zeros(N + 1)  # For mu1  0\n    psi2_edge = np.zeros(N + 1)  # For mu2  0\n\n    # ----- Sweep for mu1  0 (left-to-right) -----\n    psi1_edge[0] = psi_inc_left\n    \n    # Coefficients for the diamond difference update rule.\n    # These are the same for mu1 and mu2 because the formula uses |mu|.\n    # psi_out = C1 * psi_in + C2\n    C1_num = mu - Sigma_t * h / 2.0\n    C_den = mu + Sigma_t * h / 2.0\n    C1 = C1_num / C_den\n    C2 = h * source / C_den\n\n    # Sweep across the cells from left to right\n    for i in range(N):\n        psi1_edge[i + 1] = C1 * psi1_edge[i] + C2\n\n    # ----- Sweep for mu2  0 (right-to-left) -----\n    psi2_edge[N] = psi_inc_right\n    \n    # Sweep across the cells from right to left\n    for i in range(N - 1, -1, -1):\n        psi2_edge[i] = C1 * psi2_edge[i + 1] + C2\n\n    # ---- Calculate new cell-centered scalar flux -----\n    phi_cell_center = np.zeros(N)\n    for i in range(N):\n        # Cell-average angular flux using the diamond difference relation\n        psi1_cell_avg = (psi1_edge[i] + psi1_edge[i + 1]) / 2.0\n        psi2_cell_avg = (psi2_edge[i] + psi2_edge[i + 1]) / 2.0\n        \n        # Update scalar flux using S2 quadrature rule (w1=1, w2=1)\n        phi_cell_center[i] = w * psi1_cell_avg + w * psi2_cell_avg\n        \n    return list(phi_cell_center)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: L=10, N=20, St=1.0, Ss=0.9, q=0.2, BCs: 0, 0\n        (10.0, 20, 1.0, 0.9, 0.2, 0.0, 0.0),\n        # Case 2: L=5, N=10, St=1.0, Ss=0.0, q=0.1, BCs: 0, 0\n        (5.0, 10, 1.0, 0.0, 0.1, 0.0, 0.0),\n        # Case 3: L=3, N=6, St=0.5, Ss=0.4, q=0.0, BCs: 1.0, 0\n        (3.0, 6, 0.5, 0.4, 0.0, 1.0, 0.0),\n        # Case 4: L=2, N=4, St=0.2, Ss=0.0, q=0.05, BCs: 0, 0\n        (2.0, 4, 0.2, 0.0, 0.05, 0.0, 0.0)\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = s2_diamond_difference_iteration(*case)\n        all_results.append(result)\n\n    # Format the output string exactly as required\n    formatted_lists = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places\n        formatted_numbers = [f\"{val:.6f}\" for val in res_list]\n        # Create the inner list string: \"[num1,num2,...]\"\n        inner_list_str = \"[\" + \",\".join(formatted_numbers) + \"]\"\n        formatted_lists.append(inner_list_str)\n    \n    # Create the final outer list string: \"[[...],[...]]\"\n    final_output_str = \"[\" + \",\".join(formatted_lists) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}