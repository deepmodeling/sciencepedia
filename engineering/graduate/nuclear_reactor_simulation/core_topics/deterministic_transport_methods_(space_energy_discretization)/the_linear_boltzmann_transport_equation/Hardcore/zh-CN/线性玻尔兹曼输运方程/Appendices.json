{
    "hands_on_practices": [
        {
            "introduction": "反应堆物理学的一个主要目标是确定维持自持核链式反应的条件，这个概念由临界本征值 $k$ 所描述。本练习  将输运方程应用于一个简化的无泄漏系统，以揭示中子产生、吸收和临界状态之间一个优美而简洁的关系。此练习演示了如何利用蕴含在线性玻尔兹曼方程中的基本守恒原理来分析系统的整体中子经济性。",
            "id": "4255610",
            "problem": "考虑一个均匀的平板，宽度为 $a$，占据 $0 \\leq x \\leq a$ 的区域，在横向上无限延伸。该平板包含一个单能中子群，具有各向同性散射和各向同性裂变发射。设宏观总截面为 $\\Sigma_{t}$，宏观散射截面为 $\\Sigma_{s}$，宏观吸收截面为 $\\Sigma_{a} = \\Sigma_{t} - \\Sigma_{s}$，宏观裂变产生项为 $\\nu \\Sigma_{f}$，其中 $\\nu$ 是每次裂变产生的平均中子数。定义角通量为 $\\psi(x,\\mu)$，其中方向余弦 $\\mu \\in [-1,1]$；标量通量为 $\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu) \\,\\mathrm{d}\\mu$；中子流为 $J(x) = \\int_{-1}^{1} \\mu \\,\\psi(x,\\mu) \\,\\mathrm{d}\\mu$。\n\n从线性玻尔兹曼输运方程 (LBTE) 出发：\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_{t} \\,\\psi(x,\\mu) \\;=\\; \\frac{\\Sigma_{s}}{2} \\int_{-1}^{1} \\psi(x,\\mu') \\,\\mathrm{d}\\mu' \\;+\\; \\frac{1}{k}\\,\\frac{\\nu \\Sigma_{f}}{2} \\int_{-1}^{1} \\psi(x,\\mu') \\,\\mathrm{d}\\mu' \\,,\n$$\n为该平板建立具有相应反射边界条件（在 $x=0$ 和 $x=a$ 处）的 $k$ 本征值问题，并利用 LBTE 所蕴含的基本守恒原理，推导出基波（最低）本征模相对于中间平面 $x = a/2$ 的对称性。\n\n然后，仅用 $\\nu \\Sigma_{f}$ 和 $\\Sigma_{a}$ 推导出基波 $k$ 本征值 $k_{0}$ 的解析表达式。最终答案以闭式符号表达式形式给出；请勿进行近似计算。由于 $k_0$ 是无量纲的，最终答案不需要单位。",
            "solution": "用户要求我求解一个具有反射边界的平板中的单能、稳态中子输运问题，以找到基波 $k$ 本征值。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   **系统**: 一个均匀的平板，宽度为 $a$，占据 $0 \\leq x \\leq a$ 的区域，在横向上无限延伸。\n-   **物理模型**: 单能中子群，各向同性散射和各向同性裂变发射。\n-   **参数**: 宏观总截面 $\\Sigma_{t}$，宏观散射截面 $\\Sigma_{s}$，宏观吸收截面 $\\Sigma_a = \\Sigma_t - \\Sigma_s$，以及宏观裂变产生项 $\\nu \\Sigma_{f}$。\n-   **变量与定义**:\n    -   角通量: $\\psi(x,\\mu)$，对于位置 $x$ 和方向余弦 $\\mu \\in [-1,1]$。\n    -   标量通量: $\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu) \\,\\mathrm{d}\\mu$。\n    -   中子流: $J(x) = \\int_{-1}^{1} \\mu \\,\\psi(x,\\mu) \\,\\mathrm{d}\\mu$。\n-   **控制方程**: 线性玻尔兹曼输运方程 (LBTE) 如下：\n    $$ \\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_{t} \\,\\psi(x,\\mu) \\;=\\; \\frac{\\Sigma_{s}}{2} \\int_{-1}^{1} \\psi(x,\\mu') \\,\\mathrm{d}\\mu' \\;+\\; \\frac{1}{k}\\,\\frac{\\nu \\Sigma_{f}}{2} \\int_{-1}^{1} \\psi(x,\\mu') \\,\\mathrm{d}\\mu' $$\n-   **边界条件**: 在 $x=0$ 和 $x=a$ 处的边界是完全反射的。\n-   **目标**:\n    1.  建立具有相应反射边界条件的 $k$ 本征值问题。\n    2.  利用基本守恒原理推导基波本征模相对于中间平面 $x = a/2$ 的对称性。\n    3.  推导基波 $k$ 本征值 $k_0$ 的解析表达式，仅用 $\\nu \\Sigma_{f}$ 和 $\\Sigma_{a}$ 表示。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据、适定且客观。它是核反应堆理论和中子输运领域的标准经典问题。整个设定是自洽且一致的。\n-   **科学依据**: 该问题使用单能线性玻尔兹曼输运方程，这是输运理论中一个完善的基本模型。截面、通量和临界本征值的概念都是标准概念。\n-   **适定性**: 该问题是一个适定的本征值问题。指定一个具有完全反射边界条件的均匀介质，定义了一个自洽的系统，该系统存在唯一的、正的基波本征函数和对应的实、正的基波本征值 $k_0$。\n-   **客观性**: 语言精确，符合数学规范，没有任何主观或模棱两可的术语。\n-   **结论**: 没有科学、逻辑或结构上的缺陷。该问题是有效的。\n\n**步骤 3：结论与行动**\n该问题是有效的。将提供一个完整的、论证充分的解答。\n\n### 解答\n\n所述的 $k$ 本征值问题由线性玻尔兹曼输运方程 (LBTE) 和平板上的边界条件所定义。\n\n首先，我们使用标量通量的定义 $\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu') \\,\\mathrm{d}\\mu'$ 来表示 LBTE。LBTE 的右侧 (RHS) 可以写为：\n$$ \\text{RHS} = \\frac{1}{2} \\left( \\Sigma_{s} + \\frac{\\nu \\Sigma_{f}}{k} \\right) \\phi(x) $$\n因此，LBTE 为：\n$$ \\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_{t} \\psi(x,\\mu) = \\frac{1}{2} \\left( \\Sigma_{s} + \\frac{\\nu \\Sigma_{f}}{k} \\right) \\phi(x) $$\n在 $x=0$ 和 $x=a$ 处的边界条件是完全反射。完全反射边界条件意味着任何离开区域的中子通量都与一个以反射角度进入该区域的等量通量完全平衡。\n-   在 $x=0$ 处，$\\mu  0$ 的中子正在离开，$\\mu > 0$ 的中子正在进入。反射意味着方向为 $\\mu > 0$ 的入射中子的角通量等于方向为 $-\\mu$ 的出射中子的通量。数学上表示为：\n    $$ \\psi(0, \\mu) = \\psi(0, -\\mu) \\quad \\text{对于 } \\mu \\in (0, 1] $$\n-   在 $x=a$ 处，$\\mu > 0$ 的中子正在离开，$\\mu  0$ 的中子正在进入。反射意味着方向为 $\\mu  0$ 的入射中子的角通量等于方向为 $-\\mu$ 的出射中子的通量。数学上表示为：\n    $$ \\psi(a, \\mu) = \\psi(a, -\\mu) \\quad \\text{对于 } \\mu \\in [-1, 0) $$\n\n接下来，我们推导基波本征模的对称性。该问题在物理上相对于中间平面 $x=a/2$ 是对称的。材料性质（$\\Sigma_t$, $\\Sigma_s$, $\\nu\\Sigma_f$）是均匀的，因此在变换 $x' = a-x$ 下是不变的。两个边界上的边界条件类型相同（完全反射）。LBTE 算子本身在联立变换 $x \\to a-x$ 和 $\\mu \\to -\\mu$ 下也是不变的。由于算子及其边界条件的这种整体对称性，本征函数必须具有关于系统中心 $x=a/2$ 的确定对称性（偶对称或奇对称）。输运理论（与克林-鲁特曼定理相关，是佩龙-弗罗贝尼乌斯定理的推广）保证了与最大（模）本征值 $k_0$ 相关的基波本征模是实的、正的且非简并的。一个在区域 $(0, a)$ 内处处为正的函数不可能是关于 $x=a/2$ 反对称的（因为它在 $x=a/2$ 处必须为零）。因此，基波模的标量通量 $\\phi_0(x)$ 必须是对称的：\n$$ \\phi_0(x) = \\phi_0(a-x) $$\n问题要求基于“基本守恒原理”进行推导。这一点也可以从我们接下来要推导的中子平衡方程中看出。\n\n为了推导基波本征值 $k_0$ 的表达式，我们应用守恒原理。我们将 LBTE 对所有角度 $\\mu \\in [-1, 1]$ 进行积分：\n$$ \\int_{-1}^{1} \\mu \\frac{\\partial \\psi(x, \\mu)}{\\partial x} \\mathrm{d}\\mu + \\int_{-1}^{1} \\Sigma_{t} \\psi(x, \\mu) \\mathrm{d}\\mu = \\int_{-1}^{1} \\frac{1}{2} \\left( \\Sigma_{s} + \\frac{\\nu \\Sigma_{f}}{k} \\right) \\phi(x) \\mathrm{d}\\mu $$\n使用标量通量 $\\phi(x)$ 和中子流 $J(x)$ 的定义，上式变为：\n$$ \\frac{\\mathrm{d}}{\\mathrm{d}x} \\left( \\int_{-1}^{1} \\mu \\psi(x, \\mu) \\mathrm{d}\\mu \\right) + \\Sigma_{t} \\left( \\int_{-1}^{1} \\psi(x, \\mu) \\mathrm{d}\\mu \\right) = \\frac{1}{2} \\left( \\Sigma_{s} + \\frac{\\nu \\Sigma_{f}}{k} \\right) \\phi(x) \\int_{-1}^{1} \\mathrm{d}\\mu $$\n$$ \\frac{\\mathrm{d}J(x)}{\\mathrm{d}x} + \\Sigma_{t} \\phi(x) = \\left( \\Sigma_{s} + \\frac{\\nu \\Sigma_{f}}{k} \\right) \\phi(x) $$\n整理各项并使用定义 $\\Sigma_a = \\Sigma_t - \\Sigma_s$，我们得到一维稳态中子平衡方程：\n$$ \\frac{\\mathrm{d}J(x)}{\\mathrm{d}x} + (\\Sigma_t - \\Sigma_s) \\phi(x) - \\frac{\\nu \\Sigma_f}{k} \\phi(x) = 0 $$\n$$ \\frac{\\mathrm{d}J(x)}{\\mathrm{d}x} + \\Sigma_a \\phi(x) = \\frac{\\nu \\Sigma_f}{k} \\phi(x) $$\n这个方程表示了中子的局域守恒：中子流的空间变化率（从微分体积元中的净泄漏）加上吸收率等于产生率。\n\n为了找到本征值 $k$ 的全局条件，我们将此平衡方程在平板的整个空间域（从 $x=0$ 到 $x=a$）上积分：\n$$ \\int_{0}^{a} \\frac{\\mathrm{d}J(x)}{\\mathrm{d}x} \\mathrm{d}x + \\int_{0}^{a} \\Sigma_a \\phi(x) \\mathrm{d}x = \\int_{0}^{a} \\frac{\\nu \\Sigma_f}{k} \\phi(x) \\mathrm{d}x $$\n对第一项应用微积分基本定理，并注意到 $\\Sigma_a$ 和 $\\nu\\Sigma_f$ 在空间上是常数：\n$$ J(a) - J(0) + \\Sigma_a \\int_{0}^{a} \\phi(x) \\mathrm{d}x = \\frac{\\nu \\Sigma_f}{k} \\int_{0}^{a} \\phi(x) \\mathrm{d}x $$\n现在，我们必须计算边界上的中子流 $J(0)$ 和 $J(a)$。在完全反射边界上的净中子流为零。让我们为 $J(0)$ 证明这一点：\n$$ J(0) = \\int_{-1}^{1} \\mu \\psi(0, \\mu) \\mathrm{d}\\mu = \\int_{-1}^{0} \\mu \\psi(0, \\mu) \\mathrm{d}\\mu + \\int_{0}^{1} \\mu \\psi(0, \\mu) \\mathrm{d}\\mu $$\n在第一个积分中，我们进行换元 $\\mu' = -\\mu$，得到 $\\mathrm{d}\\mu = -\\mathrm{d}\\mu'$。积分限从 $[-1, 0]$ 变为 $[1, 0]$。\n$$ \\int_{-1}^{0} \\mu \\psi(0, \\mu) \\mathrm{d}\\mu = \\int_{1}^{0} (-\\mu') \\psi(0, -\\mu') (-\\mathrm{d}\\mu') = \\int_{1}^{0} \\mu' \\psi(0, -\\mu') \\mathrm{d}\\mu' = -\\int_{0}^{1} \\mu' \\psi(0, -\\mu') \\mathrm{d}\\mu' $$\n使用反射边界条件 $\\psi(0, -\\mu') = \\psi(0, \\mu')$（对于 $\\mu' \\in (0, 1]$）：\n$$ -\\int_{0}^{1} \\mu' \\psi(0, \\mu') \\mathrm{d}\\mu' $$\n将此结果代回 $J(0)$ 的表达式中：\n$$ J(0) = \\left( -\\int_{0}^{1} \\mu' \\psi(0, \\mu') \\mathrm{d}\\mu' \\right) + \\int_{0}^{1} \\mu \\psi(0, \\mu) \\mathrm{d}\\mu = 0 $$\n使用在 $x=a$ 处的边界条件进行类似的推导，可以证明 $J(a) = 0$。因此，没有中子从平板中净泄漏。\n\n将 $J(0)=0$ 和 $J(a)=0$ 代入积分后的平衡方程，得到：\n$$ \\Sigma_a \\int_{0}^{a} \\phi(x) \\mathrm{d}x = \\frac{\\nu \\Sigma_f}{k} \\int_{0}^{a} \\phi(x) \\mathrm{d}x $$\n这可以重新排列为：\n$$ \\left( \\frac{\\nu \\Sigma_f}{k} - \\Sigma_a \\right) \\int_{0}^{a} \\phi(x) \\mathrm{d}x = 0 $$\n对于基波模解，标量通量 $\\phi_0(x)$ 在所有 $x \\in (0, a)$ 处均为正值，代表一个物理上的中子群。因此，其在区域上的积分必须为正：\n$$ \\int_{0}^{a} \\phi_0(x) \\mathrm{d}x > 0 $$\n因此，为了使方程成立，另一个因子必须为零。这为基波本征值 $k_0$ 提供了条件：\n$$ \\frac{\\nu \\Sigma_f}{k_0} - \\Sigma_a = 0 $$\n解出 $k_0$ 得到最终表达式：\n$$ k_0 = \\frac{\\nu \\Sigma_f}{\\Sigma_a} $$\n这个结果表明，在一个没有中子泄漏的系统中（由于完全反射的边界），临界条件就是每次吸收事件产生的中子数必须为一。就其整体中子经济而言，该系统的行为就好像它在空间上是无限的。",
            "answer": "$$\\boxed{\\frac{\\nu \\Sigma_{f}}{\\Sigma_{a}}}$$"
        },
        {
            "introduction": "虽然解析解能提供深刻的物理洞察，但大多数现实世界中的输运问题都需要数值方法来解决。本练习  通过指导您实现离散纵标法（$S_N$）的一次迭代，搭建起理论与计算之间的桥梁，而离散纵标法是现代输运计算程序的一块基石。通过编写输运扫描程序，您将亲身体验数值输运模拟的基本构建模块。",
            "id": "4255613",
            "problem": "考虑具有各向同性散射和空间上恒定的体积外源的稳态中子输运的一维平板几何。其基本依据是角通量 $\\psi(x,\\mu)$ 的单能、一维形式的线性玻尔兹曼输运方程，\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t \\,\\psi(x,\\mu) = q + \\frac{\\Sigma_s}{2}\\,\\phi(x),\n$$\n其中 $x$ 是沿平板的位置（单位为 $\\text{cm}$），$\\mu$ 是方向余弦，$\\Sigma_t$ 是宏观总截面（单位为 $\\text{cm}^{-1}$），$\\Sigma_s$ 是宏观散射截面（单位为 $\\text{cm}^{-1}$），$q$ 是恒定的各向同性体积源（单位为 $\\text{n}/\\text{cm}^3\\text{-s-sr}$），$\\phi(x)$ 是标量通量（单位为 $\\text{n}/\\text{cm}^2\\text{-s}$）。标量通量定义为\n$$\n\\phi(x) = \\int_{-1}^{1}\\psi(x,\\mu)\\,d\\mu.\n$$\n\n使用 $S_2$ 阶的离散纵标法（也称为 $S_N$ 方法）和 Gauss–Legendre 求积，该方法采用两个方向 $\\mu_1 = +1/\\sqrt{3}$ 和 $\\mu_2 = -1/\\sqrt{3}$，权重分别为 $w_1 = 1$ 和 $w_2 = 1$。在由 $N$ 个宽度为 $h = L/N$ 的单元组成的均匀网格上，应用菱形差分空间离散，其中 $L$ 是平板厚度（单位为 $\\text{cm}$）。通过在真空或入射边界处为两个离散方向指定入射角通量来施加边界条件。\n\n从初始猜测值 $\\phi^{(0)}(x) = 0$ 开始执行单次源迭代（因此在本次迭代中散射源为零）。执行一次完整的 $S_2$ 扫描：对于 $\\mu_1>0$，使用左边界入射条件从左到右扫描；对于 $\\mu_20$，使用右边界入射条件从右到左扫描。在每个单元内，利用单元边界角通量和单元平均角通量之间的菱形差分关系，根据给定的入射边界角通量和单元源来更新出射边界角通量。完成两个方向的扫描后，根据两个单元平均角通量和 $S_2$ 权重计算每个单元中心的第一次迭代标量通量 $\\phi^{(1)}(x)$。\n\n必须遵守以下单位规定：最终的标量通量值以 $\\text{n}/\\text{cm}^2\\text{-s}$ 为单位报告。角度不被显式使用；方向余弦 $\\mu$ 是无量纲的。\n\n将此过程实现为一个完整的、可运行的程序。您的程序必须解决以下测试套件，并完全按照规定汇总结果。对于每个测试用例，返回单元中心的第一次迭代标量通量值 $\\phi^{(1)}$ 的列表，列表元素为浮点数。程序应生成单行输出，其中包含一个用方括号括起来的、由逗号分隔的列表的列表形式的结果，每个浮点数格式化为六位小数（例如，$[\\,[0.123456,0.234567],\\,[0.345678,0.456789]\\,]$）。\n\n测试套件（在每个用例中，所有参数在空间上都是恒定的）：\n\n- 测试用例 $1$（正常情况，真空边界）：\n  - 平板厚度 $L = 10\\,\\text{cm}$，单元数 $N = 20$，$\\Sigma_t = 1.0\\,\\text{cm}^{-1}$，$\\Sigma_s = 0.9\\,\\text{cm}^{-1}$，外源 $q = 0.2\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$。\n  - 边界条件：在 $x=0$ 处的入射角通量 $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$，在 $x=L$ 处的入射角通量 $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$（两端均为真空）。\n\n- 测试用例 $2$（纯吸收体，真空边界）：\n  - 平板厚度 $L = 5\\,\\text{cm}$，单元数 $N = 10$，$\\Sigma_t = 1.0\\,\\text{cm}^{-1}$，$\\Sigma_s = 0.0\\,\\text{cm}^{-1}$，外源 $q = 0.1\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$。\n  - 边界条件：$\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$，$\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$。\n\n- 测试用例 $3$（左边界有入射束，右边界为真空）：\n  - 平板厚度 $L = 3\\,\\text{cm}$，单元数 $N = 6$，$\\Sigma_t = 0.5\\,\\text{cm}^{-1}$，$\\Sigma_s = 0.4\\,\\text{cm}^{-1}$，外源 $q = 0.0\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$。\n  - 边界条件：$\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 1.0\\,\\text{n}/\\text{cm}^2\\text{-s-sr}$，$\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$。\n\n- 测试用例 $4$（薄板，中等吸收，真空边界）：\n  - 平板厚度 $L = 2\\,\\text{cm}$，单元数 $N = 4$，$\\Sigma_t = 0.2\\,\\text{cm}^{-1}$，$\\Sigma_s = 0.0\\,\\text{cm}^{-1}$，外源 $q = 0.05\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$。\n  - 边界条件：$\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$，$\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、由逗号分隔的列表的列表形式的结果（例如，$[\\,[\\phi_1^{(1)}(x_1),\\ldots,\\phi_1^{(1)}(x_N)],\\,[\\phi_2^{(1)}(x_1),\\ldots,\\phi_2^{(1)}(x_N)],\\,[\\phi_3^{(1)}(x_1),\\ldots,\\phi_3^{(1)}(x_N)],\\,[\\phi_4^{(1)}(x_1),\\ldots,\\phi_4^{(1)}(x_N)]\\,]$），每个浮点数格式化为六位小数，并以 $\\text{n}/\\text{cm}^2\\text{-s}$ 为单位进行解释。",
            "solution": "该问题是有效的，因为它在计算中子输运领域提出了一个适定的、有科学依据的情景。所有参数、边界条件和数值方法都得到了清晰的定义，从而能够为所要求的第一次迭代提供唯一解。其程序和物理模型在核工程教育和实践中都是标准的。我们将继续推导和实现指定的算法。\n\n该问题要求对具有各向同性散射和恒定外源的平板几何中的单能、一维、稳态线性玻尔兹曼输运方程进行数值求解。角中子通量 $\\psi(x,\\mu)$ 的控制方程为：\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t \\,\\psi(x,\\mu) = Q(x,\\mu)\n$$\n其中 $x \\in [0, L]$ 是空间坐标，$\\mu \\in [-1, 1]$ 是与 x 轴正方向夹角的余弦，$\\Sigma_t$ 是宏观总截面，$Q(x,\\mu)$ 是总中子源。对于此问题，源由一个外部体积源 $q$ 和一个散射源项组成：\n$$\nQ(x,\\mu) = q + \\frac{\\Sigma_s}{2}\\,\\phi(x)\n$$\n在此，$\\Sigma_s$ 是宏观散射截面，$\\phi(x)$ 是标量通量，定义为角通量对所有方向的积分：\n$$\n\\phi(x) = \\int_{-1}^{1}\\psi(x,\\mu)\\,d\\mu\n$$\n\n采用离散纵标（$S_N$）法求解此方程。该方法将角度变量 $\\mu$ 离散为一组离散方向 $\\{\\mu_m\\}$ 和相应的求积权重 $\\{w_m\\}$。问题指定了采用 Gauss-Legendre 求积的 $S_2$ 处理方法，得到两个方向 $\\mu_1 = 1/\\sqrt{3}$ 和 $\\mu_2 = -1/\\sqrt{3}$，每个方向的权重均为 $w_m=1$。这将单个积分-微分方程转换为一个耦合常微分方程组，每个离散方向 $\\mu_m$ 对应一个方程：\n$$\n\\mu_m \\,\\frac{d \\psi_m(x)}{dx} + \\Sigma_t \\,\\psi_m(x) = q + \\frac{\\Sigma_s}{2}\\,\\sum_{j=1}^{2} w_j \\psi_j(x)\n$$\n其中 $\\psi_m(x) \\equiv \\psi(x,\\mu_m)$，标量通量通过求积和 $\\phi(x) \\approx \\sum_{j=1}^{2} w_j \\psi_j(x)$ 来近似。\n\n空间域 $[0, L]$ 被离散为 $N$ 个均匀单元，每个单元的宽度为 $h = L/N$。设单元 $i$ 跨越区间 $[x_{i-1/2}, x_{i+1/2}]$。对离散纵标方程在单元 $i$ 上积分，得到一个平衡方程：\n$$\n\\mu_m (\\psi_{m,i+1/2} - \\psi_{m,i-1/2}) + \\Sigma_t h \\bar{\\psi}_{m,i} = h \\bar{S}_{m,i}\n$$\n在此，$\\psi_{m,i\\pm1/2}$ 是单元边界处的角通量，$\\bar{\\psi}_{m,i}$ 和 $\\bar{S}_{m,i}$ 分别是单元平均角通量和单元平均源。对于从零标量通量的初始猜测值（$\\phi^{(0)}(x) = 0$）开始的第一次迭代，源项就是恒定的外源 $\\bar{S}_{m,i} = q$。\n\n为封闭该方程组，使用菱形差分（DD）空间离散格式。该格式通过线性插值将单元平均通量与单元边界通量联系起来：\n$$\n\\bar{\\psi}_{m,i} = \\frac{\\psi_{m,i+1/2} + \\psi_{m,i-1/2}}{2}\n$$\n将 DD 关系代入平衡方程，我们可以推导出一个单元的出射通量作为入射通量函数的显式公式。我们使用方向余弦的绝对值 $|\\mu_m|$ 来提供一个统一的表达式。\n\n对于沿 $x$ 增加方向（$\\mu_m > 0$）的扫描，进入单元 $i$ 的入射通量为 $\\psi_{m,i-1/2}$，出射通量为 $\\psi_{m,i+1/2}$。更新公式为：\n$$\n\\psi_{m,i+1/2} = \\frac{|\\mu_m| - \\frac{\\Sigma_t h}{2}}{|\\mu_m| + \\frac{\\Sigma_t h}{2}} \\psi_{m,i-1/2} + \\frac{h q}{|\\mu_m| + \\frac{\\Sigma_t h}{2}}\n$$\n对于沿 $x$ 减小方向（$\\mu_m  0$）的扫描，进入单元 $i$ 的入射通量为 $\\psi_{m,i+1/2}$，出射通量为 $\\psi_{m,i-1/2}$。更新公式为：\n$$\n\\psi_{m,i-1/2} = \\frac{|\\mu_m| - \\frac{\\Sigma_t h}{2}}{|\\mu_m| + \\frac{\\Sigma_t h}{2}} \\psi_{m,i+1/2} + \\frac{h q}{|\\mu_m| + \\frac{\\Sigma_t h}{2}}\n$$\n\n单次源迭代的整体算法如下：\n1.  **初始化**：定义问题参数 $L, N, \\Sigma_t, \\Sigma_s, q$ 和边界条件。计算单元宽度 $h=L/N$。求积组为 $\\mu_1 = 1/\\sqrt{3}$、$\\mu_2 = -1/\\sqrt{3}$ 和 $w_1 = w_2 = 1$。初始标量通量为 $\\phi^{(0)}(x) = 0$，因此本次迭代的散射源项为零。\n2.  **对 $\\mu_1 > 0$ 进行扫描（从左到右）**：\n    - 初始化左边界的单元边界角通量 $\\psi_{1,1/2} = \\psi_{\\text{inc},\\text{left}}(\\mu_1)$。\n    - 对每个单元 $i=1, \\dots, N$，使用入射通量 $\\psi_{1,i-1/2}$ 和第一个更新公式计算出射边界通量 $\\psi_{1,i+1/2}$。\n    - 存储所有边界通量 $\\psi_{1,i-1/2}$（$i=1, \\dots, N+1$）。\n3.  **对 $\\mu_2  0$ 进行扫描（从右到左）**：\n    - 初始化右边界的单元边界角通量 $\\psi_{2,N+1/2} = \\psi_{\\text{inc},\\text{right}}(\\mu_2)$。\n    - 对每个单元 $i=N, \\dots, 1$（逆序），使用入射通量 $\\psi_{2,i+1/2}$ 和第二个更新公式计算出射边界通量 $\\psi_{2,i-1/2}$。\n    - 存储所有边界通量 $\\psi_{2,i-1/2}$（$i=1, \\dots, N+1$）。\n4.  **标量通量更新**：\n    - 对每个单元 $i=1, \\dots, N$：\n    - 使用 DD 关系计算方向 1 的单元平均角通量：$\\bar{\\psi}^{(1)}_{1,i} = (\\psi_{1,i+1/2} + \\psi_{1,i-1/2})/2$。\n    - 计算方向 2 的单元平均角通量：$\\bar{\\psi}^{(1)}_{2,i} = (\\psi_{2,i+1/2} + \\psi_{2,i-1/2})/2$。\n    - 使用 $S_2$ 求积公式计算新的单元平均标量通量 $\\bar{\\phi}^{(1)}_i$：\n        $$\n        \\bar{\\phi}^{(1)}_i = w_1 \\bar{\\psi}^{(1)}_{1,i} + w_2 \\bar{\\psi}^{(1)}_{2,i} = \\bar{\\psi}^{(1)}_{1,i} + \\bar{\\psi}^{(1)}_{2,i}\n        $$\n对每个测试用例实施此过程，以生成单元中心标量通量列表 $\\bar{\\phi}^{(1)}_i$。",
            "answer": "```python\nimport numpy as np\n\ndef s2_diamond_difference_iteration(L, N, Sigma_t, Sigma_s, q, psi_inc_left, psi_inc_right):\n    \"\"\"\n    Performs a single S2 source iteration with diamond differencing for a 1D slab.\n\n    Args:\n        L (float): Slab thickness in cm.\n        N (int): Number of spatial cells.\n        Sigma_t (float): Macroscopic total cross section in cm^-1.\n        Sigma_s (float): Macroscopic scattering cross section in cm^-1. (Not used in first iteration).\n        q (float): Isotropic volumetric source in n/cm^3-s-sr.\n        psi_inc_left (float): Incoming angular flux for μ > 0 at x=0.\n        psi_inc_right (float): Incoming angular flux for μ  0 at x=L.\n\n    Returns:\n        list[float]: A list of cell-centered scalar flux values for the first iteration.\n    \"\"\"\n    # S2 Gauss-Legendre quadrature set\n    mu = 1.0 / np.sqrt(3.0)\n    w = 1.0  # weights for both directions are 1\n\n    # Spatial discretization\n    h = L / N\n    \n    # In this first iteration, the scattering source is zero because phi_guess = 0.\n    # The total source Q is therefore just the external source q.\n    source = q\n\n    # Arrays to store cell-edge angular fluxes.\n    # Indices 0 to N correspond to spatial locations x_0, x_1, ..., x_N.\n    psi1_edge = np.zeros(N + 1)  # For mu1 > 0\n    psi2_edge = np.zeros(N + 1)  # For mu2  0\n\n    # ----- Sweep for mu1 > 0 (left-to-right) -----\n    psi1_edge[0] = psi_inc_left\n    \n    # Coefficients for the diamond difference update rule.\n    # These are the same for mu1 and mu2 because the formula uses |mu|.\n    # psi_out = C1 * psi_in + C2\n    C1_num = mu - Sigma_t * h / 2.0\n    C_den = mu + Sigma_t * h / 2.0\n    C1 = C1_num / C_den\n    C2 = h * source / C_den\n\n    # Sweep across the cells from left to right\n    for i in range(N):\n        psi1_edge[i + 1] = C1 * psi1_edge[i] + C2\n\n    # ----- Sweep for mu2  0 (right-to-left) -----\n    psi2_edge[N] = psi_inc_right\n    \n    # Sweep across the cells from right to left\n    for i in range(N - 1, -1, -1):\n        psi2_edge[i] = C1 * psi2_edge[i + 1] + C2\n\n    # ---- Calculate new cell-centered scalar flux -----\n    phi_cell_center = np.zeros(N)\n    for i in range(N):\n        # Cell-average angular flux using the diamond difference relation\n        psi1_cell_avg = (psi1_edge[i] + psi1_edge[i + 1]) / 2.0\n        psi2_cell_avg = (psi2_edge[i] + psi2_edge[i + 1]) / 2.0\n        \n        # Update scalar flux using S2 quadrature rule (w1=1, w2=1)\n        phi_cell_center[i] = w * psi1_cell_avg + w * psi2_cell_avg\n        \n    return list(phi_cell_center)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: L=10, N=20, St=1.0, Ss=0.9, q=0.2, BCs: 0, 0\n        (10.0, 20, 1.0, 0.9, 0.2, 0.0, 0.0),\n        # Case 2: L=5, N=10, St=1.0, Ss=0.0, q=0.1, BCs: 0, 0\n        (5.0, 10, 1.0, 0.0, 0.1, 0.0, 0.0),\n        # Case 3: L=3, N=6, St=0.5, Ss=0.4, q=0.0, BCs: 1.0, 0\n        (3.0, 6, 0.5, 0.4, 0.0, 1.0, 0.0),\n        # Case 4: L=2, N=4, St=0.2, Ss=0.0, q=0.05, BCs: 0, 0\n        (2.0, 4, 0.2, 0.0, 0.05, 0.0, 0.0)\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = s2_diamond_difference_iteration(*case)\n        all_results.append(result)\n\n    # Format the output string exactly as required\n    formatted_lists = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places\n        formatted_numbers = [f\"{val:.6f}\" for val in res_list]\n        # Create the inner list string: \"[num1,num2,...]\"\n        inner_list_str = \"[\" + \",\".join(formatted_numbers) + \"]\"\n        formatted_lists.append(inner_list_str)\n    \n    # Create the final outer list string: \"[[...],[...]]\"\n    final_output_str = \"[\" + \",\".join(formatted_lists) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}