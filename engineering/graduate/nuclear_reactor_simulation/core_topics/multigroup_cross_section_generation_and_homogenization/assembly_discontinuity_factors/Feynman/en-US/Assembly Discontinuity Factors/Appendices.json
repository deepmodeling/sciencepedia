{
    "hands_on_practices": [
        {
            "introduction": "To begin, we will solidify our understanding of the fundamental mathematical role of Assembly Discontinuity Factors (ADFs). This practice focuses on the direct algebraic consequence of applying ADFs at an interface between two homogenized regions in a reactor model. By working through this derivation, you will see precisely how ADFs, defined to enforce continuity of a transformed flux, create a necessary and deliberate discontinuity in the homogenized scalar flux of the nodal model, which is the key to correcting homogenization errors .",
            "id": "4214667",
            "problem": "Consider a one-dimensional interface between two adjacent homogenized reactor assemblies, denoted the left assembly and the right assembly. For a fixed energy group $g$ and the common interfacial face $f$, let the face-averaged homogenized scalar fluxes be $\\phi_{L,f,g}$ and $\\phi_{R,f,g}$ on the left and right sides, respectively. The interfacial net current is $J_{L,f,g}$ on the left and $J_{R,f,g}$ on the right. In homogenized multi-group diffusion, the Assembly Discontinuity Factor (ADF) $d_{f,g}$ is defined on each face and energy group so that the transformed flux $\\tilde{\\phi}_{f,g} \\equiv d_{f,g}\\,\\phi_{f,g}$ is enforced to be continuous across the assembly interface, while the physical current is also continuous. That is, the well-tested interface conditions are $J_{L,f,g} = J_{R,f,g}$ and $d_{L,f,g}\\,\\phi_{L,f,g} = d_{R,f,g}\\,\\phi_{R,f,g}$.\n\nStarting from these interface conditions and the definition of the transformed flux, derive an analytic expression for the homogenized scalar flux jump\n$$\n\\Delta \\phi_{g} \\equiv \\phi_{R,f,g} - \\phi_{L,f,g}\n$$\nthat explicitly shows how the presence of $d_{f,g} \\neq 1$ permits a finite jump at the interface. Express $\\Delta \\phi_{g}$ in terms of the ratio $d_{L,f,g}/d_{R,f,g}$ and the continuous transformed flux $\\tilde{\\phi}_{f,g}$. Your final answer must be a single closed-form expression. No numerical rounding is required for this problem, and you should not include units in the final expression.",
            "solution": "The starting point is the homogenized multi-group diffusion description of assembly interfaces. At an interface between two homogenized assemblies, two well-tested conditions are enforced:\n\n1. Continuity of physical net current, which stems from neutron balance and Fick’s law in the homogenized medium, given by $J_{L,f,g} = J_{R,f,g}$.\n\n2. Continuity of the transformed flux, constructed using the Assembly Discontinuity Factor (ADF) to restore interfacial consistency with a high-fidelity reference. The transformed flux is defined as $\\tilde{\\phi}_{f,g} \\equiv d_{f,g}\\,\\phi_{f,g}$ and is enforced to be continuous across the interface:\n$$\nd_{L,f,g}\\,\\phi_{L,f,g} \\;=\\; d_{R,f,g}\\,\\phi_{R,f,g} \\;=\\; \\tilde{\\phi}_{f,g} .\n$$\n\nThe second condition directly relates the homogenized scalar fluxes on the left and right sides to the common transformed flux value. Solving for each homogenized flux in terms of the continuous transformed flux yields\n$$\n\\phi_{L,f,g} \\;=\\; \\frac{\\tilde{\\phi}_{f,g}}{d_{L,f,g}}, \n\\qquad\n\\phi_{R,f,g} \\;=\\; \\frac{\\tilde{\\phi}_{f,g}}{d_{R,f,g}} .\n$$\nSubtracting the left expression from the right expression gives the homogenized flux jump:\n$$\n\\Delta \\phi_{g} \\;\\equiv\\; \\phi_{R,f,g} - \\phi_{L,f,g}\n\\;=\\;\n\\frac{\\tilde{\\phi}_{f,g}}{d_{R,f,g}} - \\frac{\\tilde{\\phi}_{f,g}}{d_{L,f,g}}\n\\;=\\;\n\\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right).\n$$\n\nThis expression makes two important points transparent:\n\n- If $d_{L,f,g} = d_{R,f,g}$, then the jump vanishes, $\\Delta \\phi_{g} = 0$, and $\\phi_{f,g}$ is continuous, consistent with the special case where ADFs do not induce any discontinuity.\n\n- If $d_{L,f,g} \\neq d_{R,f,g}$, then a nonzero jump appears in proportion to the difference of the reciprocals of the ADFs, scaled by the continuous transformed flux. Equivalently, using the ratio $d_{L,f,g}/d_{R,f,g}$, one may write\n$$\n\\phi_{R,f,g} = \\left(\\frac{d_{L,f,g}}{d_{R,f,g}}\\right)\\phi_{L,f,g}\n\\quad\\Rightarrow\\quad\n\\Delta \\phi_{g} = \\phi_{L,f,g}\\left(\\frac{d_{L,f,g}}{d_{R,f,g}} - 1\\right)\n= \\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right),\n$$\nwhere the last equality uses $\\phi_{L,f,g} = \\tilde{\\phi}_{f,g}/d_{L,f,g}$.\n\nThus, in terms of the continuous transformed flux and the ADFs, the interface jump is given in closed form by\n$$\n\\Delta \\phi_{g} = \\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right).\n$$\nThis result explicitly quantifies how $d_{f,g} \\neq 1$ permits a finite jump in the homogenized scalar flux across the assembly interface while maintaining continuity of the transformed flux.",
            "answer": "$$\\boxed{\\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}}-\\frac{1}{d_{L,f,g}}\\right)}$$"
        },
        {
            "introduction": "Having established the mathematical function of ADFs, we now investigate their physical origin. This exercise bridges the gap between the abstract correction factor and the underlying neutron transport phenomena that necessitate it. By solving a simplified, one-dimensional transport problem, you will derive and compute how the ADF value is directly influenced by the angular distribution of neutrons at an assembly interface—a physical detail that standard diffusion theory cannot capture .",
            "id": "4214682",
            "problem": "Consider a one-speed, steady-state, one-dimensional slab model of a nuclear reactor assembly for group $g$ that is homogeneous, spatially uniform, and free of internal sources. The slab of thickness $T$ (in $\\mathrm{cm}$) occupies $x \\in [0,T]$. The group-$g$ absorption macroscopic cross section is $\\Sigma_{a,g}$ (in $\\mathrm{cm}^{-1}$). The interface of interest is the left face at $x=0$, where the incident angular flux for directions streaming into the slab is prescribed. Let the direction cosine with respect to the $+x$ axis be $\\mu \\in (0,1)$ for directions pointing into the slab at $x=0$. There is vacuum at $x=T$ (i.e., no incoming flux at the right boundary).\n\nDefine the scalar flux $\\phi_g(x)$ and the angular flux $\\psi_g(x,\\mu)$ in the usual way for neutron transport. For the purposes of this idealized transport problem, a simplified, non-standard factor relating the volume-averaged flux to the surface flux is used. This factor, denoted $d_{f,g}$ for this problem, is defined as the ratio of the assembly volume-averaged scalar flux to the surface half-range scalar flux at the face,\n$$\nd_{f,g} \\equiv \\frac{\\bar{\\phi}_g}{\\hat{\\phi}_{f,g}},\n$$\nwhere\n$$\n\\bar{\\phi}_g = \\frac{1}{T} \\int_{0}^{T} \\phi_g(x) \\, dx,\n\\qquad\n\\hat{\\phi}_{f,g} = \\int_{0}^{1} \\psi_g(0,\\mu) \\, d\\mu.\n$$\n\nAssume that within the slab the one-speed neutron transport with pure absorption holds:\n$$\n\\mu \\, \\frac{\\partial \\psi_g(x,\\mu)}{\\partial x} + \\Sigma_{a,g} \\, \\psi_g(x,\\mu) = 0,\n$$\nfor $\\mu \\in (0,1)$ (streaming into the slab from $x=0$), with vacuum at $x=T$ ensuring no incoming flux from the right. Let the incident boundary angular flux at $x=0$ be parameterized as\n$$\n\\psi_g(0,\\mu) = \\psi_0 \\, \\bigl(1 + \\alpha \\mu \\bigr), \\quad \\mu \\in (0,1),\n$$\nwith $\\psi_0$ (in $\\mathrm{n \\, cm^{-2} \\, s^{-1} \\, sr^{-1}}$) and anisotropy parameter $\\alpha \\in [-1,1]$ such that $\\psi_g(0,\\mu) \\ge 0$ for all $\\mu \\in (0,1)$. The special case $\\alpha = 0$ represents an isotropic angular flux distribution at the interface, which is a proxy for an isotropic-scattering-dominated boundary condition.\n\nYour task is to:\n1. Start from the stated transport equation and these definitions to derive a formula for $d_{f,g}$ in terms of $\\Sigma_{a,g}$, $T$, $\\psi_0$, and $\\alpha$. Your derivation must begin from the transport equation and the definitions of $\\phi_g(x)$, $\\bar{\\phi}_g$, and $\\hat{\\phi}_{f,g}$ and proceed by rigorous mathematical steps without invoking any shortcut formulas.\n2. Implement a program that computes $d_{f,g}$ for two cases for each specified parameter set:\n   - A streaming-dominated fast group case with the given $\\alpha$ (e.g., $\\alpha$ close to $1$).\n   - An isotropic case with $\\alpha = 0$ but the same $\\Sigma_{a,g}$, $T$, and $\\psi_0$.\n3. Also compute, for each parameter set, the ratio of surface half-range scalar fluxes $r \\equiv \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$ to explicitly show the role of the angular flux distribution.\n\nExpress all final numerical outputs as dimensionless decimal numbers. No physical units are required in the outputs.\n\nThe test suite consists of four parameter sets, each given as $(\\Sigma_{a,g}, T, \\psi_0, \\alpha)$ in $\\bigl(\\mathrm{cm^{-1}}, \\mathrm{cm}, \\mathrm{n\\,cm^{-2}\\,s^{-1}\\,sr^{-1}}, \\text{dimensionless}\\bigr)$:\n- Case A (happy path): $(0.1, 5.0, 3.0, 0.9)$.\n- Case B (thin optical thickness): $(0.01, 5.0, 2.0, 1.0)$.\n- Case C (strong absorption): $(1.0, 5.0, 1.0, 0.7)$.\n- Case D (near-transparent): $(1.0 \\times 10^{-4}, 10.0, 1.0, 1.0)$.\n\nFor each case, your program must compute three outputs in order:\n- $d_{f,g}^{\\text{stream}}$ for the specified $\\alpha$,\n- $d_{f,g}^{\\text{iso}}$ for $\\alpha = 0$,\n- $r = \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of Case A followed by Case B, Case C, and Case D. For each case, append the three floats in the sequence described above. The final output will thus contain twelve comma-separated numbers:\n$$\n\\bigl[ d_{A}^{\\text{stream}}, d_{A}^{\\text{iso}}, r_A, d_{B}^{\\text{stream}}, d_{B}^{\\text{iso}}, r_B, d_{C}^{\\text{stream}}, d_{C}^{\\text{iso}}, r_C, d_{D}^{\\text{stream}}, d_{D}^{\\text{iso}}, r_D \\bigr].\n$$",
            "solution": "The problem requires the derivation of a formula for the Assembly Discontinuity Factor (ADF) in a simplified one-dimensional, one-speed, pure-absorber neutron transport problem, and its subsequent numerical evaluation for specified cases. The derivation will proceed step-by-step from the fundamental definitions and the transport equation.\n\nThe factor $d_{f,g}$ is defined for this problem as:\n$$\nd_{f,g} \\equiv \\frac{\\bar{\\phi}_g}{\\hat{\\phi}_{f,g}}\n$$\nwhere $\\bar{\\phi}_g$ is the volume-averaged scalar flux and $\\hat{\\phi}_{f,g}$ is the surface half-range scalar flux. The face of interest is the left boundary at $x=0$.\n\n**Step 1: Solution of the Neutron Transport Equation**\n\nThe governing equation is the one-speed, steady-state transport equation with pure absorption and no internal sources:\n$$\n\\mu \\, \\frac{\\partial \\psi_g(x,\\mu)}{\\partial x} + \\Sigma_{a,g} \\, \\psi_g(x,\\mu) = 0\n$$\nThis equation applies for neutrons streaming into the slab from the left, i.e., for direction cosines $\\mu \\in (0,1)$. This is a first-order linear ordinary differential equation in the spatial variable $x$ for a fixed $\\mu$. It can be solved using the method of characteristics or by separation of variables. Rearranging the equation gives:\n$$\n\\frac{d\\psi_g}{\\psi_g} = -\\frac{\\Sigma_{a,g}}{\\mu} dx\n$$\nIntegrating from the boundary at $x'=0$ to a point $x$ within the slab, we get:\n$$\n\\int_{\\psi_g(0,\\mu)}^{\\psi_g(x,\\mu)} \\frac{d\\psi_g'}{\\psi_g'} = -\\frac{\\Sigma_{a,g}}{\\mu} \\int_0^x dx'\n$$\n$$\n\\ln\\left(\\frac{\\psi_g(x,\\mu)}{\\psi_g(0,\\mu)}\\right) = -\\frac{\\Sigma_{a,g} x}{\\mu}\n$$\nSolving for $\\psi_g(x,\\mu)$ yields the solution:\n$$\n\\psi_g(x,\\mu) = \\psi_g(0,\\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right)\n$$\nWe are given the incident angular flux at the boundary $x=0$:\n$$\n\\psi_g(0,\\mu) = \\psi_0 (1 + \\alpha \\mu) \\quad \\text{for } \\mu \\in (0,1)\n$$\nSubstituting this into the solution gives the angular flux distribution throughout the slab for $\\mu>0$:\n$$\n\\psi_g(x,\\mu) = \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\quad \\text{for } \\mu \\in (0,1)\n$$\n\n**Step 2: Calculation of the Scalar Flux $\\phi_g(x)$**\n\nThe scalar flux $\\phi_g(x)$ is defined as the integral of the angular flux over all solid angles:\n$$\n\\phi_g(x) = \\int_{-1}^{1} \\psi_g(x,\\mu') \\, d\\mu' = \\int_0^1 \\psi_g(x,\\mu') \\, d\\mu' + \\int_{-1}^0 \\psi_g(x,\\mu') \\, d\\mu'\n$$\nFor negative direction cosines ($\\mu' < 0$), neutrons stream from right to left. The boundary condition at $x=T$ is a vacuum, meaning no neutrons enter from the right: $\\psi_g(T, \\mu')=0$ for $\\mu' < 0$. Since there are no sources of neutrons with $\\mu' < 0$ within the slab (no scattering or fission), the angular flux for negative $\\mu'$ is zero everywhere: $\\psi_g(x, \\mu')=0$ for $x \\in [0,T]$ and $\\mu' \\in [-1,0)$.\n\nTherefore, the scalar flux is determined solely by the neutrons with $\\mu > 0$:\n$$\n\\phi_g(x) = \\int_0^1 \\psi_g(x,\\mu) \\, d\\mu = \\int_0^1 \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\, d\\mu\n$$\nThis integral can be expressed using the exponential integral functions, $E_n(z) = \\int_1^\\infty t^{-n} e^{-zt} dt$. By substituting $t=1/\\mu$, we find:\n$$\n\\phi_g(x) = \\psi_0 \\left[ E_2(\\Sigma_{a,g} x) + \\alpha E_3(\\Sigma_{a,g} x) \\right]\n$$\n\n**Step 3: Calculation of the Volume-Averaged Scalar Flux $\\bar{\\phi}_g$**\n\nThe volume-averaged scalar flux is defined as:\n$$\n\\bar{\\phi}_g = \\frac{1}{T} \\int_0^T \\phi_g(x) \\, dx = \\frac{1}{T} \\int_0^T \\left[ \\int_0^1 \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) d\\mu \\right] dx\n$$\nBy Fubini's theorem, we can switch the order of integration:\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T} \\int_0^1 (1 + \\alpha \\mu) \\left[ \\int_0^T \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) dx \\right] d\\mu\n$$\nThe inner integral over $x$ evaluates to:\n$$\n\\int_0^T \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) dx = \\left[ -\\frac{\\mu}{\\Sigma_{a,g}} \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\right]_0^T = \\frac{\\mu}{\\Sigma_{a,g}} \\left(1 - \\exp\\left(-\\frac{\\Sigma_{a,g} T}{\\mu}\\right)\\right)\n$$\nSubstituting this back into the expression for $\\bar{\\phi}_g$:\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\int_0^1 (1 + \\alpha \\mu) \\mu \\left(1 - e^{-\\Sigma_{a,g} T/\\mu}\\right) d\\mu\n$$\nLet $\\tau = \\Sigma_{a,g} T$ be the optical thickness of the slab.\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\int_0^1 (\\mu + \\alpha \\mu^2) (1 - e^{-\\tau/\\mu}) d\\mu\n$$\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\int_0^1 (\\mu + \\alpha \\mu^2) d\\mu - \\int_0^1 (\\mu + \\alpha \\mu^2) e^{-\\tau/\\mu} d\\mu \\right]\n$$\nThe first term is a simple polynomial integral: $\\int_0^1 (\\mu + \\alpha \\mu^2) d\\mu = [\\frac{\\mu^2}{2} + \\frac{\\alpha\\mu^3}{3}]_0^1 = \\frac{1}{2} + \\frac{\\alpha}{3}$.\nThe second term is split and expressed in terms of exponential integrals:\n$$\n\\int_0^1 \\mu e^{-\\tau/\\mu} d\\mu = E_3(\\tau) \\quad \\text{and} \\quad \\int_0^1 \\mu^2 e^{-\\tau/\\mu} d\\mu = E_4(\\tau)\n$$\nCombining these results gives the final expression for the volume-averaged scalar flux:\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\left(\\frac{1}{2} + \\frac{\\alpha}{3}\\right) - \\left(E_3(\\tau) + \\alpha E_4(\\tau)\\right) \\right]\n$$\nUsing the identity $E_n(0) = 1/(n-1)$ for $n>1$, this can be written as:\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\left(E_3(0) - E_3(\\tau)\\right) + \\alpha \\left(E_4(0) - E_4(\\tau)\\right) \\right]\n$$\n\n**Step 4: Calculation of the Surface Half-Range Scalar Flux $\\hat{\\phi}_{f,g}$**\n\nThe surface half-range scalar flux at the face $x=0$ is defined as:\n$$\n\\hat{\\phi}_{f,g} = \\int_0^1 \\psi_g(0,\\mu) \\, d\\mu\n$$\nUsing the given boundary condition $\\psi_g(0,\\mu) = \\psi_0(1+\\alpha\\mu)$:\n$$\n\\hat{\\phi}_{f,g} = \\int_0^1 \\psi_0(1+\\alpha\\mu) \\, d\\mu = \\psi_0 \\left[ \\int_0^1 d\\mu + \\alpha \\int_0^1 \\mu \\, d\\mu \\right]\n$$\n$$\n\\hat{\\phi}_{f,g} = \\psi_0 \\left[ [\\mu]_0^1 + \\alpha \\left[\\frac{\\mu^2}{2}\\right]_0^1 \\right] = \\psi_0 \\left(1 + \\frac{\\alpha}{2}\\right)\n$$\n\n**Step 5: Derivation of the Factor's Formula**\n\nNow we assemble the formula for $d_{f,g} = \\bar{\\phi}_g / \\hat{\\phi}_{f,g}$:\n$$\nd_{f,g} = \\frac{\\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ (\\frac{1}{2} - E_3(\\Sigma_{a,g} T)) + \\alpha (\\frac{1}{3} - E_4(\\Sigma_{a,g} T)) \\right]}{\\psi_0 (1 + \\alpha/2)}\n$$\nThe incident flux magnitude $\\psi_0$ cancels out, as expected for a linear problem. Let $\\tau = \\Sigma_{a,g} T$.\n$$\nd_{f,g} = \\frac{1}{\\tau (1 + \\alpha/2)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + \\alpha \\left(\\frac{1}{3} - E_4(\\tau)\\right) \\right]\n$$\nThis is the general formula for the factor under the specified conditions.\n\n**Step 6: Specialization and Ratio Calculation**\n\nThe problem requires computation for two scenarios: the general \"streaming\" case with a given $\\alpha$, and the \"isotropic\" case where $\\alpha=0$.\n\n-   **Streaming Case ($d_{f,g}^{\\text{stream}}$)**: The formula is the one derived above.\n    $$\n    d_{f,g}^{\\text{stream}} = \\frac{1}{\\tau (1 + \\alpha/2)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + \\alpha \\left(\\frac{1}{3} - E_4(\\tau)\\right) \\right]\n    $$\n\n-   **Isotropic Case ($d_{f,g}^{\\text{iso}}$)**: We set $\\alpha=0$ in the general formula.\n    $$\n    d_{f,g}^{\\text{iso}} = \\frac{1}{\\tau (1 + 0)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + 0 \\right] = \\frac{\\frac{1}{2} - E_3(\\tau)}{\\tau}\n    $$\n\n-   **Flux Ratio ($r$)**: The ratio of the surface half-range scalar fluxes is defined as $r \\equiv \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$.\n    $$\n    \\hat{\\phi}_{f,g}^{\\text{stream}} = \\psi_0(1 + \\alpha/2)\n    $$\n    $$\n    \\hat{\\phi}_{f,g}^{\\text{iso}} = \\psi_0(1 + 0/2) = \\psi_0\n    $$\n    Therefore, the ratio $r$ simplifies to:\n    $$\n    r = \\frac{\\psi_0 (1 + \\alpha/2)}{\\psi_0} = 1 + \\frac{\\alpha}{2}\n    $$\nThis shows that the ratio $r$ is independent of all parameters except for the anisotropy factor $\\alpha$. The numerical implementation will be based on these three final formulas. For the limiting case where $\\tau \\to 0$, both $d_{f,g}^{\\text{stream}}$ and $d_{f,g}^{\\text{iso}}$ tend to $1$, which can be shown using a Taylor series expansion of the exponential integral functions.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import expn\n\ndef solve():\n    \"\"\"\n    Computes Assembly Discontinuity Factors (ADFs) and a flux ratio\n    for a one-dimensional, one-speed neutron transport problem in a slab.\n    \"\"\"\n    \n    # The test suite consists of four parameter sets, each given as \n    # (Sigma_a, T, psi_0, alpha) in units of\n    # (cm^-1, cm, n cm^-2 s^-1 sr^-1, dimensionless).\n    test_cases = [\n        (0.1, 5.0, 3.0, 0.9),      # Case A\n        (0.01, 5.0, 2.0, 1.0),     # Case B\n        (1.0, 5.0, 1.0, 0.7),      # Case C\n        (1.0e-4, 10.0, 1.0, 1.0),  # Case D\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        sigma_a, T, psi_0, alpha = case\n        \n        # Calculate the optical thickness of the slab\n        tau = sigma_a * T\n        \n        # In the limit tau -> 0, the ADFs approach 1.\n        # This handles potential division-by-zero if tau is exactly 0.\n        if np.isclose(tau, 0.0):\n            d_stream = 1.0\n            d_iso = 1.0\n        else:\n            # Calculate ADF for the streaming-dominated case (given alpha)\n            # Formula: d_stream = (1/(tau*(1+alpha/2))) * ((1/2 - E3(tau)) + alpha*(1/3 - E4(tau)))\n            e3_tau = expn(3, tau)\n            e4_tau = expn(4, tau)\n            \n            d_stream_num = (0.5 - e3_tau) + alpha * (1./3. - e4_tau)\n            d_stream_den = tau * (1. + alpha / 2.)\n            d_stream = d_stream_num / d_stream_den\n            \n            # Calculate ADF for the isotropic case (alpha = 0)\n            # Formula: d_iso = (1/tau) * (1/2 - E3(tau))\n            d_iso_num = 0.5 - e3_tau\n            d_iso_den = tau\n            d_iso = d_iso_num / d_iso_den\n\n        # Calculate the ratio of surface half-range scalar fluxes\n        # Formula: r = 1 + alpha/2\n        r = 1. + alpha / 2.\n        \n        results.extend([d_stream, d_iso, r])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "With a solid theoretical and physical understanding of ADFs, we turn to their practical application and validation in reactor analysis. This exercise simulates a common workflow where ADFs are calculated from a high-fidelity reference benchmark and then tested for their accuracy under different core conditions. This practice will highlight the critical concept of state-dependence, demonstrating how the effectiveness of constant ADFs can vary as the reactor's operational state deviates from the reference state used for their generation .",
            "id": "4214693",
            "problem": "Consider a one-dimensional interface between two adjacent fuel assemblies in a multigroup reactor core model. The steady-state neutron balance is approximated by the multigroup diffusion equation for energy group $g$,\n$$-\\nabla \\cdot \\left(D_g \\nabla \\phi_g\\right) + \\Sigma_{a,g}\\,\\phi_g = S_g,$$\nwith Fick's law,\n$$\\mathbf{J}_g = - D_g \\nabla \\phi_g,$$\nwhere $D_g$ is the group-wise diffusion coefficient, $\\Sigma_{a,g}$ is the group-wise macroscopic absorption cross section, $S_g$ is the group-wise source, $\\phi_g$ is the scalar neutron flux, and $\\mathbf{J}_g$ is the net current. In an assembly-homogenized nodal method, for a planar interface between assemblies $A$ and $B$ of half-widths $h_A$ and $h_B$, the face-trace fluxes are related to the assembly-average flux and the interface net current by linearization of the flux profile over each half-cell. Specifically, letting the outward normal of assembly $A$ point toward assembly $B$, one obtains from Fick's law and a linear half-cell gradient approximation that the face-trace flux at the interface on the $A$ side satisfies\n$$\\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g,$$\nand on the $B$ side satisfies\n$$\\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g,$$\nwhere $\\bar{\\phi}_{A,g}$ and $\\bar{\\phi}_{B,g}$ are the assembly-average fluxes and $J_g$ is the net current pointing from $A$ to $B$.\n\nDefine the Assembly Discontinuity Factor (ADF) for face $f \\in \\{A,B\\}$ and energy group $g$ as the multiplicative correction that makes the corrected nodal face-trace flux equal to a high-order transport-computed reference face-trace flux,\n$$d_{f,g} := \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}},$$\nwhere $\\hat{\\Phi}^{\\text{trans}}_{f,g}$ denotes the transport-computed face-trace flux at face $f$ for group $g$, and $\\hat{\\phi}^{\\text{diff}}_{f,g}$ denotes the corresponding uncorrected nodal diffusion face-trace flux.\n\nValidation of $d_{f,g}$ against a reference transport benchmark such as the two-dimensional, seven-energy-group benchmark (C5G7) can be reduced to a one-dimensional interface consistency check in two energy groups. In this problem, you will:\n- Compute $d_{f,g}$ from a provided reference dataset by applying the above definition using transport-computed face-trace fluxes and nodal diffusion face-trace fluxes derived from assembly averages and net currents.\n- For three prediction scenarios, apply the computed $d_{f,g}$ to new nodal diffusion face-trace fluxes, form the corrected nodal face-trace fluxes, and compare the ratio of opposite faces from transport to the ratio from corrected nodal diffusion. Specifically, for each group $g$, compute the transport ratio\n$$R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}},$$\nand the corrected nodal diffusion ratio\n$$R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}.$$\nThen quantify the residual mismatch per scenario by the maximum absolute ratio difference across energy groups,\n$$\\varepsilon = \\max_{g} \\left| R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} \\right|.$$\n\nAll flux-like quantities in this problem are normalized and dimensionless. Geometric half-widths $h_A,h_B$ and diffusion coefficients $D_{A,g},D_{B,g}$ are treated as non-dimensional parameters consistent with the above linearized trace relations. Angles do not appear in this problem. Your program must implement the computations from first principles stated above and produce a single output line aggregating the three scenario results as specified at the end.\n\nReference dataset (used exclusively to compute $d_{f,g}$):\n- Geometry: $h_A = 20$, $h_B = 20$.\n- Diffusion coefficients: $D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$.\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$.\n- Interface net currents: $J_{1} = 0.02$, $J_{2} = 0.005$ (positive from $A$ to $B$).\n- Transport-computed face-trace fluxes at the interface:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$.\n\nPrediction scenarios (use the $d_{f,g}$ computed from the reference dataset to validate; each scenario provides new assembly averages and currents and transport-computed face-trace fluxes to compare against):\n\nScenario 1 (happy path: identical to the reference conditions):\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$.\n- Interface net currents: $J_{1} = 0.02$, $J_{2} = 0.005$.\n- Transport-computed face-trace fluxes:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$.\n\nScenario 2 (edge case: zero net currents):\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$.\n- Interface net currents: $J_{1} = 0.0$, $J_{2} = 0.0$.\n- Transport-computed face-trace fluxes:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$.\n\nScenario 3 (boundary case: large net currents and strong gradients):\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$.\n- Interface net currents: $J_{1} = 0.06$, $J_{2} = 0.02$.\n- Transport-computed face-trace fluxes:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$.\n\nYour task is to implement a program that:\n- Computes $\\hat{\\phi}^{\\text{diff}}_{A,g}$ and $\\hat{\\phi}^{\\text{diff}}_{B,g}$ for the reference dataset and then evaluates $d_{A,g}$ and $d_{B,g}$ using the transport-computed reference fluxes.\n- For each prediction scenario, computes $\\hat{\\phi}^{\\text{diff}}_{A,g}$ and $\\hat{\\phi}^{\\text{diff}}_{B,g}$ from the given assembly averages and currents, forms $R^{\\text{corr}}_{g}$ using the previously computed $d_{f,g}$, and compares to $R^{\\text{trans}}_{g}$ from the provided transport data.\n- Returns the residual mismatch $\\varepsilon$ per scenario as defined above.\n\nFinal output format specification:\n- Your program should produce a single line of output containing the three scenario residual mismatches as a comma-separated list enclosed in square brackets, with each float rounded to six decimal places, following the exact format\n$$[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3].$$",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of nuclear reactor physics, specifically nodal diffusion methods, and is mathematically well-posed with all necessary information provided.\n\nThe problem requires the calculation of Assembly Discontinuity Factors (ADFs) from a reference dataset and then the evaluation of their effectiveness in three different prediction scenarios. The effectiveness is quantified by a residual mismatch parameter, $\\varepsilon$. The solution proceeds in two primary stages: first, the computation of the ADFs, and second, the application of these ADFs in each scenario to compute the corresponding $\\varepsilon$.\n\n**Part 1: Computation of Assembly Discontinuity Factors ($d_{f,g}$)**\n\nThe ADFs are constants derived from the provided reference dataset. They bridge the gap between the low-fidelity nodal diffusion model and a high-fidelity transport solution at the interface between assemblies.\n\nThe fundamental relations for the nodal diffusion face-trace fluxes, $\\hat{\\phi}^{\\text{diff}}_{f,g}$, for an interface between assembly $A$ and assembly $B$ are:\n$$ \\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g $$\n$$ \\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g $$\nwhere $g$ is the energy group index ($g \\in \\{1, 2\\}$), $\\bar{\\phi}_{f,g}$ is the assembly-average flux, $h_f$ is the assembly half-width, $D_{f,g}$ is the diffusion coefficient, and $J_g$ is the net current from $A$ to $B$.\n\nThe ADF, $d_{f,g}$, is defined as the ratio of the transport-computed face-trace flux, $\\hat{\\Phi}^{\\text{trans}}_{f,g}$, to the nodal diffusion face-trace flux:\n$$ d_{f,g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}} $$\n\nWe use the reference dataset to compute the four ADFs ($d_{A,1}, d_{A,2}, d_{B,1}, d_{B,2}$).\nReference Data:\n- Geometry: $h_A = 20$, $h_B = 20$.\n- Diffusion coefficients: $D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$.\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$.\n- Interface net currents: $J_{1} = 0.02$, $J_{2} = 0.005$.\n- Transport fluxes: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$.\n\nFor energy group $g=1$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.0 - \\frac{20}{2 \\times 1.2} \\times 0.02 = 1.0 - 0.166\\overline{6} \\approx 0.833\\overline{3}$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.95 + \\frac{20}{2 \\times 1.0} \\times 0.02 = 0.95 + 0.2 = 1.15$\n- $d_{A,1} = \\frac{0.875}{0.833\\overline{3}} = 1.05$\n- $d_{B,1} = \\frac{1.20}{1.15} \\approx 1.043478$\n\nFor energy group $g=2$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.3 - \\frac{20}{2 \\times 0.5} \\times 0.005 = 0.3 - 0.1 = 0.2$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.31 + \\frac{20}{2 \\times 0.4} \\times 0.005 = 0.31 + 0.125 = 0.435$\n- $d_{A,2} = \\frac{0.208}{0.2} = 1.04$\n- $d_{B,2} = \\frac{0.450}{0.435} \\approx 1.034483$\n\nThese four ADF values are now fixed and will be used for all subsequent prediction scenarios.\n\n**Part 2: Evaluation of Prediction Scenarios**\n\nFor each scenario, we compute the residual mismatch $\\varepsilon = \\max_{g} | R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} |$, where:\n- Transport ratio: $R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}}$\n- Corrected nodal ratio: $R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}$\n\nThe geometry ($h_A, h_B$) and diffusion coefficients ($D_A, D_B$) are constant across all scenarios.\n\n**Scenario 1: Reference Conditions**\nThe data for this scenario is identical to the reference dataset. By construction, the corrected nodal fluxes will exactly match the transport fluxes: $d_{f,g} \\hat{\\phi}^{\\text{diff}}_{f,g} = \\hat{\\Phi}^{\\text{trans}}_{f,g}$.\nTherefore, $R^{\\text{corr}}_{g} = R^{\\text{trans}}_{g}$ for both groups $g=1$ and $g=2$.\nThe absolute difference is $0$ for both groups.\n- $\\varepsilon_1 = \\max(|0|, |0|) = 0.0$\n\n**Scenario 2: Zero Net Currents**\nData: $\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$. $J_1=0.0, J_2=0.0$.\nTransport fluxes: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$.\n\nFor group $g=1$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.05 - 0 = 1.05$; $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.98 + 0 = 0.98$\n- $R^{\\text{trans}}_{1} = \\frac{1.012381913}{1.12105} \\approx 0.903067$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 0.98}{d_{A,1} \\times 1.05} = \\frac{1.043478 \\times 0.98}{1.05 \\times 1.05} \\approx 0.927536$\n- Difference: $|0.927536 - 0.903067| \\approx 0.024469$\n\nFor group $g=2$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.32 - 0 = 0.32$; $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.30 + 0 = 0.30$\n- $R^{\\text{trans}}_{2} = \\frac{0.30413894}{0.342784} \\approx 0.887255$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.30}{d_{A,2} \\times 0.32} = \\frac{1.034483 \\times 0.30}{1.04 \\times 0.32} \\approx 0.932501$\n- Difference: $|0.932501 - 0.887255| \\approx 0.045246$\n- $\\varepsilon_2 = \\max(0.024469, 0.045246) \\approx 0.045246$\n\n**Scenario 3: Large Net Currents**\nData: $\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$. $J_1=0.06, J_2=0.02$.\nTransport fluxes: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$.\n\nFor group $g=1$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 0.97 - \\frac{20}{2 \\times 1.2} \\times 0.06 = 0.97 - 0.5 = 0.47$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.90 + \\frac{20}{2 \\times 1.0} \\times 0.06 = 0.90 + 0.6 = 1.50$\n- $R^{\\text{trans}}_{1} = \\frac{1.5182609}{0.498435} \\approx 3.046031$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 1.50}{d_{A,1} \\times 0.47} = \\frac{1.043478 \\times 1.50}{1.05 \\times 0.47} \\approx 3.171350$\n- Difference: $|3.171350 - 3.046031| \\approx 0.125319$\n\nFor group $g=2$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.50 - \\frac{20}{2 \\times 0.5} \\times 0.02 = 0.50 - 0.4 = 0.10$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.35 + \\frac{20}{2 \\times 0.4} \\times 0.02 = 0.35 + 0.5 = 0.85$\n- $R^{\\text{trans}}_{2} = \\frac{0.8353448}{0.1092} \\approx 7.649678$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.85}{d_{A,2} \\times 0.10} = \\frac{1.034483 \\times 0.85}{1.04 \\times 0.10} \\approx 8.454913$\n- Difference: $|8.454913 - 7.649678| \\approx 0.805235$\n- $\\varepsilon_3 = \\max(0.125319, 0.805235) \\approx 0.805236$\n\nIn summary, the residual mismatches for the three scenarios are $\\varepsilon_1 = 0.0$, $\\varepsilon_2 \\approx 0.045246$, and $\\varepsilon_3 \\approx 0.805236$. These results demonstrate that the accuracy of ADFs, when treated as constants, degrades as the system state (fluxes and currents) deviates from the reference state used to generate them.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes Assembly Discontinuity Factors (ADFs) from a reference dataset and\n    evaluates their performance in three prediction scenarios by calculating the\n    residual mismatch epsilon.\n    \"\"\"\n    \n    # --- Data Definition ---\n\n    # Common geometric and material properties\n    hA = 20.0\n    hB = 20.0\n    DA = [1.2, 0.5]\n    DB = [1.0, 0.4]\n\n    # Reference dataset for ADF calculation\n    ref_data = {\n        'phi_bar_A': [1.0, 0.3],\n        'phi_bar_B': [0.95, 0.31],\n        'J': [0.02, 0.005],\n        'phi_trans_A': [0.875, 0.208],\n        'phi_trans_B': [1.20, 0.450]\n    }\n\n    # Prediction scenarios\n    test_cases = [\n        # Scenario 1 (happy path: identical to the reference conditions)\n        {\n            'phi_bar_A': [1.0, 0.3], 'phi_bar_B': [0.95, 0.31],\n            'J': [0.02, 0.005],\n            'phi_trans_A': [0.875, 0.208], 'phi_trans_B': [1.20, 0.450]\n        },\n        # Scenario 2 (edge case: zero net currents)\n        {\n            'phi_bar_A': [1.05, 0.32], 'phi_bar_B': [0.98, 0.30],\n            'J': [0.0, 0.0],\n            'phi_trans_A': [1.12105, 0.342784], 'phi_trans_B': [1.012381913, 0.30413894]\n        },\n        # Scenario 3 (boundary case: large net currents and strong gradients)\n        {\n            'phi_bar_A': [0.97, 0.50], 'phi_bar_B': [0.90, 0.35],\n            'J': [0.06, 0.02],\n            'phi_trans_A': [0.498435, 0.1092], 'phi_trans_B': [1.5182609, 0.8353448]\n        }\n    ]\n\n    # --- Step 1: Calculate ADFs (d_f,g) from the Reference Dataset ---\n\n    # Pre-calculate geometric/material factors\n    # The arrays correspond to energy groups [g=1, g=2] i.e. index 0 and 1\n    factors_A = [hA / (2 * D) for D in DA]\n    factors_B = [hB / (2 * D) for D in DB]\n\n    # Calculate nodal diffusion face-trace fluxes for the reference case\n    phi_diff_A_ref = [\n        ref_data['phi_bar_A'][g] - factors_A[g] * ref_data['J'][g] for g in range(2)\n    ]\n    phi_diff_B_ref = [\n        ref_data['phi_bar_B'][g] + factors_B[g] * ref_data['J'][g] for g in range(2)\n    ]\n\n    # Calculate the Assembly Discontinuity Factors (ADFs)\n    d_A = [ ref_data['phi_trans_A'][g] / phi_diff_A_ref[g] for g in range(2) ]\n    d_B = [ ref_data['phi_trans_B'][g] / phi_diff_B_ref[g] for g in range(2) ]\n\n    # --- Step 2: Process Each Prediction Scenario ---\n    \n    results = []\n    for case in test_cases:\n        ratio_diffs = []\n        for g in range(2): # Iterate through energy groups g=1 (index 0) and g=2 (index 1)\n            \n            # Calculate nodal diffusion face-trace fluxes for the current scenario\n            phi_diff_A_scen = case['phi_bar_A'][g] - factors_A[g] * case['J'][g]\n            phi_diff_B_scen = case['phi_bar_B'][g] + factors_B[g] * case['J'][g]\n\n            # Calculate the transport-computed ratio\n            R_trans = case['phi_trans_B'][g] / case['phi_trans_A'][g]\n\n            # Calculate the ADF-corrected nodal diffusion ratio\n            num_corr = d_B[g] * phi_diff_B_scen\n            den_corr = d_A[g] * phi_diff_A_scen\n            \n            # This check is for robustness; given the problem data, den_corr will not be zero.\n            if den_corr == 0:\n                # Handle division by zero based on problem physics, e.g., set to infinity or NaN\n                # For this problem, it's not expected.\n                raise ValueError(\"Denominator for R_corr is zero.\")\n\n            R_corr = num_corr / den_corr\n            \n            # Calculate and store the absolute difference\n            ratio_diffs.append(abs(R_corr - R_trans))\n        \n        # The residual mismatch epsilon is the maximum difference across energy groups\n        epsilon = max(ratio_diffs)\n        results.append(epsilon)\n\n    # --- Final Output Formatting ---\n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join([f'{res:.6f}' for res in results])}]\")\n\nsolve()\n```"
        }
    ]
}