{
    "hands_on_practices": [
        {
            "introduction": "为了修正均匀化带来的误差，组件非连续因子（ADF）在堆芯模拟中被引入。这个练习旨在从 ADF 的基本定义出发，通过数学推导，揭示 ADF 如何在保持界面中子流连续的同时，精确地在中子通量中引入一个不连续的跳变 。理解这个机制是掌握 ADF 如何在均匀化扩散计算中恢复非均匀输运解关键特征的第一步。",
            "id": "4214667",
            "problem": "考虑两个相邻的均匀化反应堆组件之间的一维界面，这两个组件分别称为左侧组件和右侧组件。对于一个固定的能量群 $g$ 和公共交界面 $f$，设左右两侧的面平均标量通量分别为 $\\phi_{L,f,g}$ 和 $\\phi_{R,f,g}$。左侧的界面净流为 $J_{L,f,g}$，右侧为 $J_{R,f,g}$。在均匀化多群扩散理论中，在每个面和每个能量群上定义了组件不连续因子(ADF) $d_{f,g}$，使得变换通量 $\\tilde{\\phi}_{f,g} \\equiv d_{f,g}\\,\\phi_{f,g}$ 被强制在组件界面上连续，同时物理流也是连续的。也就是说，经过充分检验的界面条件是 $J_{L,f,g} = J_{R,f,g}$ 和 $d_{L,f,g}\\,\\phi_{L,f,g} = d_{R,f,g}\\,\\phi_{R,f,g}$。\n\n从这些界面条件和变换通量的定义出发，推导物理标量通量跳跃\n$$\n\\Delta \\phi_{g} \\equiv \\phi_{R,f,g} - \\phi_{L,f,g}\n$$\n的解析表达式，该表达式应明确显示 $d_{f,g} \\neq 1$ 的存在如何导致界面上出现有限的跳跃。用比值 $d_{L,f,g}/d_{R,f,g}$ 和连续的变换通量 $\\tilde{\\phi}_{f,g}$ 来表示 $\\Delta \\phi_{g}$。你的最终答案必须是单一的封闭形式表达式。本题不需要进行数值取整，最终表达式中也不应包含单位。",
            "solution": "出发点是均匀化多群扩散理论对组件界面的描述。在两个均匀化组件之间的界面上，强制执行两个经过充分检验的条件：\n\n1. 物理净流的连续性，这源于均匀化介质中的中子平衡和菲克定律（Fick’s law），由 $J_{L,f,g} = J_{R,f,g}$ 给出。\n\n2. 变换通量的连续性，该通量是使用组件不连续因子(ADF)构建的，用以恢复与高保真参考解的界面一致性。变换通量定义为 $\\tilde{\\phi}_{f,g} \\equiv d_{f,g}\\,\\phi_{f,g}$，并被强制在界面上连续：\n$$\nd_{L,f,g}\\,\\phi_{L,f,g} \\;=\\; d_{R,f,g}\\,\\phi_{R,f,g} \\;=\\; \\tilde{\\phi}_{f,g} .\n$$\n\n第二个条件直接将左右两侧的物理标量通量与共同的变换通量值联系起来。将每个物理通量用连续的变换通量表示，可得\n$$\n\\phi_{L,f,g} \\;=\\; \\frac{\\tilde{\\phi}_{f,g}}{d_{L,f,g}}, \n\\qquad\n\\phi_{R,f,g} \\;=\\; \\frac{\\tilde{\\phi}_{f,g}}{d_{R,f,g}} .\n$$\n用右侧的表达式减去左侧的表达式，得到物理通量跳跃：\n$$\n\\Delta \\phi_{g} \\;\\equiv\\; \\phi_{R,f,g} - \\phi_{L,f,g}\n\\;=\\;\n\\frac{\\tilde{\\phi}_{f,g}}{d_{R,f,g}} - \\frac{\\tilde{\\phi}_{f,g}}{d_{L,f,g}}\n\\;=\\;\n\\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right).\n$$\n\n这个表达式清楚地说明了两点：\n\n- 如果 $d_{L,f,g} = d_{R,f,g}$，则跳跃消失，$\\Delta \\phi_{g} = 0$，并且 $\\phi_{f,g}$ 是连续的，这与ADF不引起任何不连续性的特殊情况相符。\n\n- 如果 $d_{L,f,g} \\neq d_{R,f,g}$，则会出现一个非零跳跃，其大小与ADF倒数之差成正比，并由连续的变换通量进行缩放。等价地，使用比值 $d_{L,f,g}/d_{R,f,g}$，可以写成\n$$\n\\phi_{R,f,g} = \\left(\\frac{d_{L,f,g}}{d_{R,f,g}}\\right)\\phi_{L,f,g}\n\\quad\\Rightarrow\\quad\n\\Delta \\phi_{g} = \\phi_{L,f,g}\\left(\\frac{d_{L,f,g}}{d_{R,f,g}} - 1\\right)\n= \\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right),\n$$\n其中最后一个等式使用了 $\\phi_{L,f,g} = \\tilde{\\phi}_{f,g}/d_{L,f,g}$。\n\n因此，用连续的变换通量和ADF表示，界面跳跃的封闭形式由下式给出\n$$\n\\Delta \\phi_{g} = \\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right).\n$$\n这个结果明确地量化了 $d_{f,g} \\neq 1$ 如何在保持变换通量连续性的同时，允许物理标量通量在组件界面上产生有限的跳跃。",
            "answer": "$$\\boxed{\\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}}-\\frac{1}{d_{L,f,g}}\\right)}$$"
        },
        {
            "introduction": "组件非连续因子并非纯粹的数学拟合参数，其数值大小根植于真实的输运物理过程。本练习将通过一个简化的单能中子输运模型，指导你计算并分析 ADF 的值 。你将通过比较中子角通量在界面处呈各向同性与呈强指向性两种情况，亲身体会到界面处的中子角分布是如何从根本上决定 ADF 的大小的。",
            "id": "4214682",
            "problem": "考虑一个用于群 $g$ 的核反应堆组件的单能、稳态、一维平板模型，该模型是均匀、空间一致且无内部源的。厚度为 $T$（单位为 $\\mathrm{cm}$）的平板占据 $x \\in [0,T]$ 的空间。$g$ 群的吸收宏观截面为 $\\Sigma_{a,g}$（单位为 $\\mathrm{cm}^{-1}$）。我们关注的界面是位于 $x=0$ 的左侧面，在该面上，流入平板方向的入射角通量是给定的。对于在 $x=0$ 处指向平板内部的方向，设相对于 $+x$ 轴的方向余弦为 $\\mu \\in (0,1)$。在 $x=T$ 处为真空（即右边界没有入射通量）。\n\n按照中子输运的常规方式定义标量通量 $\\phi_g(x)$ 和角通量 $\\psi_g(x,\\mu)$。在界面 $f$ 上 $g$ 群的组件不连续因子 (ADF)，记为 $d_{f,g}$，定义为组件体积平均标量通量与该界面上的表面半程标量通量之比，\n$$\nd_{f,g} \\equiv \\frac{\\bar{\\phi}_g}{\\hat{\\phi}_{f,g}},\n$$\n其中\n$$\n\\bar{\\phi}_g = \\frac{1}{T} \\int_{0}^{T} \\phi_g(x) \\, dx,\n\\qquad\n\\hat{\\phi}_{f,g} = \\int_{0}^{1} \\psi_g(0,\\mu) \\, d\\mu.\n$$\n\n假设在平板内部，单能中子输运的纯吸收模型成立：\n$$\n\\mu \\, \\frac{\\partial \\psi_g(x,\\mu)}{\\partial x} + \\Sigma_{a,g} \\, \\psi_g(x,\\mu) = 0,\n$$\n对于 $\\mu \\in (0,1)$（中子从 $x=0$ 流入平板），并且在 $x=T$ 处为真空，确保没有中子从右侧入射。设 $x=0$ 处的入射边界角通量参数化为\n$$\n\\psi_g(0,\\mu) = \\psi_0 \\, \\bigl(1 + \\alpha \\mu \\bigr), \\quad \\mu \\in (0,1),\n$$\n其中 $\\psi_0$（单位为 $\\mathrm{n \\, cm^{-2} \\, s^{-1} \\, sr^{-1}}$）和各向异性参数 $\\alpha \\in [-1,1]$ 使得对于所有 $\\mu \\in (0,1)$ 都有 $\\psi_g(0,\\mu) \\ge 0$。$\\alpha = 0$ 的特殊情况代表了界面处的各向同性角通量分布，这是各向同性散射主导边界条件的近似。\n\n你的任务是：\n1. 从给定的输运方程和这些定义出发，推导出一个用 $\\Sigma_{a,g}$、$T$、$\\psi_0$ 和 $\\alpha$ 表示 $d_{f,g}$ 的公式。你的推导必须从输运方程以及 $\\phi_g(x)$、$\\bar{\\phi}_g$ 和 $\\hat{\\phi}_{f,g}$ 的定义开始，并通过严谨的数学步骤进行，不得使用任何快捷公式。\n2. 实现一个程序，为每个指定的参数集计算两种情况下的 $d_{f,g}$：\n   - 一个给定 $\\alpha$（例如，$\\alpha$ 接近 $1$）的流-主导快群情况。\n   - 一个 $\\alpha = 0$ 但具有相同 $\\Sigma_{a,g}$、$T$ 和 $\\psi_0$ 的各向同性情况。\n3. 同时，为每个参数集计算表面半程标量通量之比 $r \\equiv \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$，以明确显示角通量分布的作用。\n\n将所有最终数值输出表示为无量纲的小数。输出中不需要物理单位。\n\n测试套件包含四个参数集，每个参数集以 $(\\Sigma_{a,g}, T, \\psi_0, \\alpha)$ 的形式给出，单位为 $\\bigl(\\mathrm{cm^{-1}}, \\mathrm{cm}, \\mathrm{n\\,cm^{-2}\\,s^{-1}\\,sr^{-1}}, \\text{无量纲}\\bigr)$：\n- 情况A（理想路径）：$(0.1, 5.0, 3.0, 0.9)$。\n- 情况B（薄光学厚度）：$(0.01, 5.0, 2.0, 1.0)$。\n- 情况C（强吸收）：$(1.0, 5.0, 1.0, 0.7)$。\n- 情况D（近透明）：$(1.0 \\times 10^{-4}, 10.0, 1.0, 1.0)$。\n\n对于每种情况，你的程序必须按顺序计算三个输出：\n- 指定 $\\alpha$ 的 $d_{f,g}^{\\text{stream}}$，\n- $\\alpha = 0$ 的 $d_{f,g}^{\\text{iso}}$，\n- $r = \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按情况 A、情况 B、情况 C 和情况 D 的顺序排列。对于每种情况，按上述顺序附加三个浮点数。因此，最终输出将包含十二个逗号分隔的数字：\n$$\n\\bigl[ d_{A}^{\\text{stream}}, d_{A}^{\\text{iso}}, r_A, d_{B}^{\\text{stream}}, d_{B}^{\\text{iso}}, r_B, d_{C}^{\\text{stream}}, d_{C}^{\\text{iso}}, r_C, d_{D}^{\\text{stream}}, d_{D}^{\\text{iso}}, r_D \\bigr].\n$$",
            "solution": "该问题要求在一个简化的一维、单能、纯吸收体中子输运问题中，推导组件不连续因子 (ADF) 的公式，并随后对指定情况进行数值评估。推导将从基本定义和输运方程开始，逐步进行。\n\n$g$ 群在界面 $f$ 上的 ADF，$d_{f,g}$，定义为：\n$$\nd_{f,g} \\equiv \\frac{\\bar{\\phi}_g}{\\hat{\\phi}_{f,g}}\n$$\n其中 $\\bar{\\phi}_g$ 是体积平均标量通量，$\\hat{\\phi}_{f,g}$ 是表面半程标量通量。我们关注的界面是位于 $x=0$ 的左边界。\n\n**第 1 步：求解中子输运方程**\n\n控制方程是单能、稳态、纯吸收且无内部源的输运方程：\n$$\n\\mu \\, \\frac{\\partial \\psi_g(x,\\mu)}{\\partial x} + \\Sigma_{a,g} \\, \\psi_g(x,\\mu) = 0\n$$\n此方程适用于从中子从左侧流入平板的情况，即方向余弦 $\\mu \\in (0,1)$。对于固定的 $\\mu$，这是一个关于空间变量 $x$ 的一阶线性常微分方程。可以用特征线法或分离变量法求解。重新整理方程可得：\n$$\n\\frac{d\\psi_g}{\\psi_g} = -\\frac{\\Sigma_{a,g}}{\\mu} dx\n$$\n从边界 $x'=0$ 积分到平板内的点 $x$，我们得到：\n$$\n\\int_{\\psi_g(0,\\mu)}^{\\psi_g(x,\\mu)} \\frac{d\\psi_g'}{\\psi_g'} = -\\frac{\\Sigma_{a,g}}{\\mu} \\int_0^x dx'\n$$\n$$\n\\ln\\left(\\frac{\\psi_g(x,\\mu)}{\\psi_g(0,\\mu)}\\right) = -\\frac{\\Sigma_{a,g} x}{\\mu}\n$$\n求解 $\\psi_g(x,\\mu)$ 得到解：\n$$\n\\psi_g(x,\\mu) = \\psi_g(0,\\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right)\n$$\n我们已知边界 $x=0$ 处的入射角通量：\n$$\n\\psi_g(0,\\mu) = \\psi_0 (1 + \\alpha \\mu) \\quad \\text{for } \\mu \\in (0,1)\n$$\n将此代入解中，得到平板内 $\\mu>0$ 的角通量分布：\n$$\n\\psi_g(x,\\mu) = \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\quad \\text{for } \\mu \\in (0,1)\n$$\n\n**第 2 步：计算标量通量 $\\phi_g(x)$**\n\n标量通量 $\\phi_g(x)$ 定义为角通量在所有立体角上的积分：\n$$\n\\phi_g(x) = \\int_{-1}^{1} \\psi_g(x,\\mu') \\, d\\mu' = \\int_0^1 \\psi_g(x,\\mu') \\, d\\mu' + \\int_{-1}^0 \\psi_g(x,\\mu') \\, d\\mu'\n$$\n对于负方向余弦（$\\mu'  0$），中子从右向左流。$x=T$ 处的边界条件是真空，意味着没有中子从右侧进入：对于 $\\mu'  0$，有 $\\psi_g(T, \\mu')=0$。由于平板内没有 $\\mu'  0$ 的中子源（没有散射或裂变），因此负 $\\mu'$ 的角通量处处为零：对于 $x \\in [0,T]$ 和 $\\mu' \\in [-1,0)$，有 $\\psi_g(x, \\mu')=0$。\n\n因此，标量通量仅由 $\\mu  0$ 的中子决定：\n$$\n\\phi_g(x) = \\int_0^1 \\psi_g(x,\\mu) \\, d\\mu = \\int_0^1 \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\, d\\mu\n$$\n这个积分可以用指数积分函数 $E_n(z) = \\int_1^\\infty t^{-n} e^{-zt} dt$ 来表示。通过代換 $t=1/\\mu$，我们发现：\n$$\n\\phi_g(x) = \\psi_0 \\left[ E_2(\\Sigma_{a,g} x) + \\alpha E_3(\\Sigma_{a,g} x) \\right]\n$$\n\n**第 3 步：计算体积平均标量通量 $\\bar{\\phi}_g$**\n\n体积平均标量通量定义为：\n$$\n\\bar{\\phi}_g = \\frac{1}{T} \\int_0^T \\phi_g(x) \\, dx = \\frac{1}{T} \\int_0^T \\left[ \\int_0^1 \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) d\\mu \\right] dx\n$$\n根据 Fubini 定理，我们可以交换积分顺序：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T} \\int_0^1 (1 + \\alpha \\mu) \\left[ \\int_0^T \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) dx \\right] d\\mu\n$$\n内部对 $x$ 的积分计算结果为：\n$$\n\\int_0^T \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) dx = \\left[ -\\frac{\\mu}{\\Sigma_{a,g}} \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\right]_0^T = \\frac{\\mu}{\\Sigma_{a,g}} \\left(1 - \\exp\\left(-\\frac{\\Sigma_{a,g} T}{\\mu}\\right)\\right)\n$$\n将此代回 $\\bar{\\phi}_g$ 的表达式：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\int_0^1 (1 + \\alpha \\mu) \\mu \\left(1 - e^{-\\Sigma_{a,g} T/\\mu}\\right) d\\mu\n$$\n令 $\\tau = \\Sigma_{a,g} T$ 为平板的光学厚度。\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\int_0^1 (\\mu + \\alpha \\mu^2) (1 - e^{-\\tau/\\mu}) d\\mu\n$$\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\int_0^1 (\\mu + \\alpha \\mu^2) d\\mu - \\int_0^1 (\\mu + \\alpha \\mu^2) e^{-\\tau/\\mu} d\\mu \\right]\n$$\n第一项是一个简单的多项式积分：$\\int_0^1 (\\mu + \\alpha \\mu^2) d\\mu = [\\frac{\\mu^2}{2} + \\frac{\\alpha\\mu^3}{3}]_0^1 = \\frac{1}{2} + \\frac{\\alpha}{3}$。\n第二项被拆分并用指数积分表示：\n$$\n\\int_0^1 \\mu e^{-\\tau/\\mu} d\\mu = E_3(\\tau) \\quad \\text{and} \\quad \\int_0^1 \\mu^2 e^{-\\tau/\\mu} d\\mu = E_4(\\tau)\n$$\n结合这些结果，得到体积平均标量通量的最终表达式：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\left(\\frac{1}{2} + \\frac{\\alpha}{3}\\right) - \\left(E_3(\\tau) + \\alpha E_4(\\tau)\\right) \\right]\n$$\n使用恒等式 $E_n(0) = 1/(n-1)$（对于 $n1$），可以写成：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\left(E_3(0) - E_3(\\tau)\\right) + \\alpha \\left(E_4(0) - E_4(\\tau)\\right) \\right]\n$$\n\n**第 4 步：计算表面半程标量通量 $\\hat{\\phi}_{f,g}$**\n\n在界面 $x=0$ 处的表面半程标量通量定义为：\n$$\n\\hat{\\phi}_{f,g} = \\int_0^1 \\psi_g(0,\\mu) \\, d\\mu\n$$\n使用给定的边界条件 $\\psi_g(0,\\mu) = \\psi_0(1+\\alpha\\mu)$：\n$$\n\\hat{\\phi}_{f,g} = \\int_0^1 \\psi_0(1+\\alpha\\mu) \\, d\\mu = \\psi_0 \\left[ \\int_0^1 d\\mu + \\alpha \\int_0^1 \\mu \\, d\\mu \\right]\n$$\n$$\n\\hat{\\phi}_{f,g} = \\psi_0 \\left[ [\\mu]_0^1 + \\alpha \\left[\\frac{\\mu^2}{2}\\right]_0^1 \\right] = \\psi_0 \\left(1 + \\frac{\\alpha}{2}\\right)\n$$\n\n**第 5 步：ADF 公式的推导**\n\n现在我们组合公式得到 $d_{f,g} = \\bar{\\phi}_g / \\hat{\\phi}_{f,g}$。入射通量大小 $\\psi_0$ 被消去，这对于线性问题是预期的。令 $\\tau = \\Sigma_{a,g} T$。\n$$\nd_{f,g} = \\frac{\\frac{1}{T \\Sigma_{a,g}} \\left[ (\\frac{1}{2} - E_3(\\tau)) + \\alpha (\\frac{1}{3} - E_4(\\tau)) \\right]}{1 + \\alpha/2}\n$$\n$$\nd_{f,g} = \\frac{1}{\\tau (1 + \\alpha/2)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + \\alpha \\left(\\frac{1}{3} - E_4(\\tau)\\right) \\right]\n$$\n这就是在指定条件下 ADF 的通用公式。\n\n**第 6 步：特例化和比率计算**\n\n问题要求计算两种情景：给定 $\\alpha$ 的通用“流”情况，以及 $\\alpha=0$ 的“各向同性”情况。\n\n-   **流情况 ($d_{f,g}^{\\text{stream}}$)**：公式即为上面推导出的公式。\n    $$\n    d_{f,g}^{\\text{stream}} = \\frac{1}{\\tau (1 + \\alpha/2)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + \\alpha \\left(\\frac{1}{3} - E_4(\\tau)\\right) \\right]\n    $$\n\n-   **各向同性情况 ($d_{f,g}^{\\text{iso}}$)**：我们在通用公式中设置 $\\alpha=0$。\n    $$\n    d_{f,g}^{\\text{iso}} = \\frac{1}{\\tau (1 + 0)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + 0 \\right] = \\frac{\\frac{1}{2} - E_3(\\tau)}{\\tau}\n    $$\n\n-   **通量比 ($r$)**：表面半程标量通量之比定义为 $r \\equiv \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$。\n    $$\n    \\hat{\\phi}_{f,g}^{\\text{stream}} = \\psi_0(1 + \\alpha/2)\n    $$\n    $$\n    \\hat{\\phi}_{f,g}^{\\text{iso}} = \\psi_0(1 + 0/2) = \\psi_0\n    $$\n    因此，比率 $r$ 简化为：\n    $$\n    r = \\frac{\\psi_0 (1 + \\alpha/2)}{\\psi_0} = 1 + \\frac{\\alpha}{2}\n    $$\n这表明比率 $r$ 除了各向异性因子 $\\alpha$ 外，与其他所有参数无关。数值实现将基于这三个最终公式。对于 $\\tau \\to 0$ 的极限情况，可以使用指数积分函数的泰勒级数展开来证明 $d_{f,g}^{\\text{stream}}$ 和 $d_{f,g}^{\\text{iso}}$ 都趋向于 1。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import expn\n\ndef solve():\n    \"\"\"\n    Computes Assembly Discontinuity Factors (ADFs) and a flux ratio\n    for a one-dimensional, one-speed neutron transport problem in a slab.\n    \"\"\"\n    \n    # The test suite consists of four parameter sets, each given as \n    # (Sigma_a, T, psi_0, alpha) in units of\n    # (cm^-1, cm, n cm^-2 s^-1 sr^-1, dimensionless).\n    test_cases = [\n        (0.1, 5.0, 3.0, 0.9),      # Case A\n        (0.01, 5.0, 2.0, 1.0),     # Case B\n        (1.0, 5.0, 1.0, 0.7),      # Case C\n        (1.0e-4, 10.0, 1.0, 1.0),  # Case D\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        sigma_a, T, psi_0, alpha = case\n        \n        # Calculate the optical thickness of the slab\n        tau = sigma_a * T\n        \n        # In the limit tau -> 0, the ADFs approach 1.\n        # This handles potential division-by-zero if tau is exactly 0.\n        if np.isclose(tau, 0.0):\n            d_stream = 1.0\n            d_iso = 1.0\n        else:\n            # Calculate ADF for the streaming-dominated case (given alpha)\n            # Formula: d_stream = (1/(tau*(1+alpha/2))) * ((1/2 - E3(tau)) + alpha*(1/3 - E4(tau)))\n            e3_tau = expn(3, tau)\n            e4_tau = expn(4, tau)\n            \n            d_stream_num = (0.5 - e3_tau) + alpha * (1./3. - e4_tau)\n            d_stream_den = tau * (1. + alpha / 2.)\n            d_stream = d_stream_num / d_stream_den\n            \n            # Calculate ADF for the isotropic case (alpha = 0)\n            # Formula: d_iso = (1/tau) * (1/2 - E3(tau))\n            d_iso_num = 0.5 - e3_tau\n            d_iso_den = tau\n            d_iso = d_iso_num / d_iso_den\n\n        # Calculate the ratio of surface half-range scalar fluxes\n        # Formula: r = 1 + alpha/2\n        r = 1. + alpha / 2.\n        \n        results.extend([d_stream, d_iso, r])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际反应堆模拟中，ADF 通常在参考状态（如全功率、循环初期）下计算得到，并在后续的瞬态或燃耗计算中作为常数使用。这个练习模拟了一个关键的验证过程，即检验这些预先计算的 ADF 在偏离参考状态时的准确性 。通过对比不同工况下的计算结果，你将量化分析 ADF 的状态依赖性，这是理解和应用 ADF 时必须考虑的一个重要实际问题。",
            "id": "4214693",
            "problem": "考虑多群反应堆堆芯模型中两个相邻燃料组件之间的一维界面。稳态中子平衡由能量群 $g$ 的多群扩散方程近似表示，\n$$-\\nabla \\cdot \\left(D_g \\nabla \\phi_g\\right) + \\Sigma_{a,g}\\,\\phi_g = S_g,$$\n以及菲克定律，\n$$\\mathbf{J}_g = - D_g \\nabla \\phi_g,$$\n其中 $D_g$ 是群扩散系数，$\\Sigma_{a,g}$ 是群宏观吸收截面，$S_g$ 是群源项，$\\phi_g$ 是标量中子通量，而 $\\mathbf{J}_g$ 是净流。在组件均匀化节点法中，对于半宽分别为 $h_A$ 和 $h_B$ 的组件 $A$ 和 $B$ 之间的一个平面界面，通过对每个半栅元上的通量分布进行线性化，可以将面上通量迹与组件平均通量和界面净流关联起来。具体而言，令组件 $A$ 的外法线指向组件 $B$，根据菲克定律和线性半栅元梯度近似，可以得到界面上 $A$ 侧的面上通量迹满足\n$$\\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g,$$\n而 $B$ 侧的面上通量迹满足\n$$\\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g,$$\n其中 $\\bar{\\phi}_{A,g}$ 和 $\\bar{\\phi}_{B,g}$ 是组件平均通量，$J_g$ 是从 $A$ 指向 $B$ 的净流。\n\n对于面 $f \\in \\{A,B\\}$ 和能量群 $g$，将组件不连续因子 (Assembly Discontinuity Factor, ADF) 定义为一个乘法校正因子，它使得校正后的节点面上通量迹等于一个高阶输运计算得到的参考面上通量迹，\n$$d_{f,g} := \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}},$$\n其中 $\\hat{\\Phi}^{\\text{trans}}_{f,g}$ 表示在面 $f$ 上能量群 $g$ 的输运计算面上通量迹，而 $\\hat{\\phi}^{\\text{diff}}_{f,g}$ 表示相应的未校正的节点扩散面上通量迹。\n\n针对像二维七群基准题 (C5G7) 这样的参考输运基准题对 $d_{f,g}$ 进行验证，可以简化为两个能量群下的一维界面一致性检验。在本问题中，您将：\n- 根据提供的参考数据集，应用上述定义，使用输运计算的面上通量迹以及从组件平均值和净流推导出的节点扩散面上通量迹，计算 $d_{f,g}$。\n- 对于三种预测情景，将计算出的 $d_{f,g}$ 应用于新的节点扩散面上通量迹，构建校正后的节点面上通量迹，并比较输运解中相对面上的通量比率与校正后节点扩散解中的该比率。具体来说，对于每个能量群 $g$，计算输运比率\n$$R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}},$$\n和校正后的节点扩散比率\n$$R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}.$$\n然后，通过各能量群中比率绝对差的最大值来量化每个情景的残余失配，\n$$\\varepsilon = \\max_{g} \\left| R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} \\right|.$$\n\n本问题中所有类通量均为归一化且无量纲的。几何半宽 $h_A,h_B$ 和扩散系数 $D_{A,g},D_{B,g}$ 被视为与上述线性化迹关系一致的无量纲参数。本问题不涉及角度。您的程序必须根据上述第一性原理实现计算，并按照末尾指定的方式，生成一个包含三个情景结果的单行输出。\n\n参考数据集 (专门用于计算 $d_{f,g}$):\n- 几何：$h_A = 20$, $h_B = 20$。\n- 扩散系数：$D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$。\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$。\n- 界面净流：$J_{1} = 0.02$, $J_{2} = 0.005$ (从 $A$ 到 $B$ 为正)。\n- 界面上输运计算的面上通量迹：\n  - 在 $A$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$。\n  - 在 $B$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$。\n\n预测情景 (使用从参考数据集计算出的 $d_{f,g}$ 进行验证；每个情景提供新的组件平均值、电流和输运计算的面上通量迹以供比较):\n\n情景 1 (理想情况：与参考条件相同):\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$。\n- 界面净流：$J_{1} = 0.02$, $J_{2} = 0.005$。\n- 输运计算的面上通量迹：\n  - 在 $A$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$。\n  - 在 $B$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$。\n\n情景 2 (边界情况：净流为零):\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$。\n- 界面净流：$J_{1} = 0.0$, $J_{2} = 0.0$。\n- 输运计算的面上通量迹：\n  - 在 $A$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$。\n  - 在 $B$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$。\n\n情景 3 (边界情况：大净流和强梯度):\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$。\n- 界面净流：$J_{1} = 0.06$, $J_{2} = 0.02$。\n- 输运计算的面上通量迹：\n  - 在 $A$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$。\n  - 在 $B$ 面上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$。\n\n您的任务是实现一个程序：\n- 根据参考数据集计算 $\\hat{\\phi}^{\\text{diff}}_{A,g}$ 和 $\\hat{\\phi}^{\\text{diff}}_{B,g}$，然后使用输运计算的参考通量评估 $d_{A,g}$ 和 $d_{B,g}$。\n- 对于每个预测情景，根据给定的组件平均值和净流计算 $\\hat{\\phi}^{\\text{diff}}_{A,g}$ 和 $\\hat{\\phi}^{\\text{diff}}_{B,g}$，使用先前计算的 $d_{f,g}$ 构建 $R^{\\text{corr}}_{g}$，并与提供的输运数据中的 $R^{\\text{trans}}_{g}$ 进行比较。\n- 返回每个情景下如上定义的残余失配 $\\varepsilon$。\n\n最终输出格式规范：\n- 您的程序应生成单行输出，其中包含三个情景的残余失配，形式为方括号内的逗号分隔列表，每个浮点数四舍五入到六位小数，严格遵循以下格式\n$$[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3].$$",
            "solution": "该问题被评估为有效，因为它在科学上基于核反应堆物理学原理，特别是节点扩散方法，并且在数学上是适定的，提供了所有必要的信息。\n\n该问题要求根据参考数据集计算组件不连续因子 (ADF)，然后评估它们在三种不同预测情景下的有效性。有效性由一个残余失配参数 $\\varepsilon$ 来量化。解题过程分为两个主要阶段：首先，计算 ADF；其次，在每个情景中应用这些 ADF 来计算相应的 $\\varepsilon$。\n\n**第 1 部分：计算组件不连续因子 ($d_{f,g}$)**\n\nADF 是从提供的参考数据集中导出的常数。它们弥合了组件间界面上低保真度节点扩散模型与高保真度输运解之间的差距。\n\n组件 $A$ 和组件 $B$ 之间界面的节点扩散面上通量迹 $\\hat{\\phi}^{\\text{diff}}_{f,g}$ 的基本关系式为：\n$$ \\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g $$\n$$ \\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g $$\n其中 $g$ 是能群索引 ($g \\in \\{1, 2\\}$)，$\\bar{\\phi}_{f,g}$ 是组件平均通量，$h_f$ 是组件半宽，$D_{f,g}$ 是扩散系数，$J_g$ 是从 $A$ 到 $B$ 的净流。\n\nADF $d_{f,g}$ 定义为输运计算的面上通量迹 $\\hat{\\Phi}^{\\text{trans}}_{f,g}$ 与节点扩散面上通量迹的比值：\n$$ d_{f,g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}} $$\n\n我们使用参考数据集来计算四个 ADF ($d_{A,1}, d_{A,2}, d_{B,1}, d_{B,2}$)。\n参考数据：\n- 几何：$h_A = 20$, $h_B = 20$。\n- 扩散系数：$D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$。\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$。\n- 界面净流：$J_{1} = 0.02$, $J_{2} = 0.005$。\n- 输运通量：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$。\n\n对于能群 $g=1$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.0 - \\frac{20}{2 \\times 1.2} \\times 0.02 = 1.0 - 0.166\\overline{6} \\approx 0.833\\overline{3}$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.95 + \\frac{20}{2 \\times 1.0} \\times 0.02 = 0.95 + 0.2 = 1.15$\n- $d_{A,1} = \\frac{0.875}{0.833\\overline{3}} = 1.05$\n- $d_{B,1} = \\frac{1.20}{1.15} \\approx 1.043478$\n\n对于能群 $g=2$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.3 - \\frac{20}{2 \\times 0.5} \\times 0.005 = 0.3 - 0.1 = 0.2$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.31 + \\frac{20}{2 \\times 0.4} \\times 0.005 = 0.31 + 0.125 = 0.435$\n- $d_{A,2} = \\frac{0.208}{0.2} = 1.04$\n- $d_{B,2} = \\frac{0.450}{0.435} \\approx 1.034483$\n\n这四个 ADF 值现在是固定的，并将用于所有后续的预测情景。\n\n**第 2 部分：评估预测情景**\n\n对于每个情景，我们计算残余失配 $\\varepsilon = \\max_{g} | R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} |$，其中：\n- 输运比率：$R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}}$\n- 校正后的节点比率：$R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}$\n\n几何参数 ($h_A, h_B$) 和扩散系数 ($D_A, D_B$) 在所有情景中保持不变。\n\n**情景 1：参考条件**\n此情景的数据与参考数据集相同。根据构造，校正后的节点通量将精确匹配输运通量：$d_{f,g} \\hat{\\phi}^{\\text{diff}}_{f,g} = \\hat{\\Phi}^{\\text{trans}}_{f,g}$。\n因此，对于 $g=1$ 和 $g=2$ 两个群，$R^{\\text{corr}}_{g} = R^{\\text{trans}}_{g}$。\n两个群的绝对差均为 $0$。\n- $\\varepsilon_1 = \\max(|0|, |0|) = 0.0$\n\n**情景 2：净流为零**\n数据：$\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$。$J_1=0.0, J_2=0.0$。\n输运通量：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$。\n\n对于群 $g=1$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.05 - 0 = 1.05$；$\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.98 + 0 = 0.98$\n- $R^{\\text{trans}}_{1} = \\frac{1.012381913}{1.12105} \\approx 0.903067$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 0.98}{d_{A,1} \\times 1.05} = \\frac{1.043478 \\times 0.98}{1.05 \\times 1.05} \\approx 0.927536$\n- 差值：$|0.927536 - 0.903067| \\approx 0.024469$\n\n对于群 $g=2$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.32 - 0 = 0.32$；$\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.30 + 0 = 0.30$\n- $R^{\\text{trans}}_{2} = \\frac{0.30413894}{0.342784} \\approx 0.887255$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.30}{d_{A,2} \\times 0.32} = \\frac{1.034483 \\times 0.30}{1.04 \\times 0.32} \\approx 0.932501$\n- 差值：$|0.932501 - 0.887255| \\approx 0.045246$\n- $\\varepsilon_2 = \\max(0.024469, 0.045246) \\approx 0.045246$\n\n**情景 3：大净流**\n数据：$\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$。$J_1=0.06, J_2=0.02$。\n输运通量：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$。\n\n对于群 $g=1$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 0.97 - \\frac{20}{2 \\times 1.2} \\times 0.06 = 0.97 - 0.5 = 0.47$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.90 + \\frac{20}{2 \\times 1.0} \\times 0.06 = 0.90 + 0.6 = 1.50$\n- $R^{\\text{trans}}_{1} = \\frac{1.5182609}{0.498435} \\approx 3.046031$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 1.50}{d_{A,1} \\times 0.47} = \\frac{1.043478 \\times 1.50}{1.05 \\times 0.47} \\approx 3.171350$\n- 差值：$|3.171350 - 3.046031| \\approx 0.125319$\n\n对于群 $g=2$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.50 - \\frac{20}{2 \\times 0.5} \\times 0.02 = 0.50 - 0.4 = 0.10$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.35 + \\frac{20}{2 \\times 0.4} \\times 0.02 = 0.35 + 0.5 = 0.85$\n- $R^{\\text{trans}}_{2} = \\frac{0.8353448}{0.1092} \\approx 7.649678$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.85}{d_{A,2} \\times 0.10} = \\frac{1.034483 \\times 0.85}{1.04 \\times 0.10} \\approx 8.454913$\n- 差值：$|8.454913 - 7.649678| \\approx 0.805235$\n- $\\varepsilon_3 = \\max(0.125319, 0.805235) \\approx 0.805236$\n\n总之，三个情景的残余失配分别为 $\\varepsilon_1 = 0.0$，$\\varepsilon_2 \\approx 0.045246$ 和 $\\varepsilon_3 \\approx 0.805236$。这些结果表明，当 ADF 被视为常数时，其准确性会随着系统状态（通量和净流）偏离用于生成它们的参考状态而降低。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes Assembly Discontinuity Factors (ADFs) from a reference dataset and\n    evaluates their performance in three prediction scenarios by calculating the\n    residual mismatch epsilon.\n    \"\"\"\n    \n    # --- Data Definition ---\n\n    # Common geometric and material properties\n    hA = 20.0\n    hB = 20.0\n    DA = [1.2, 0.5]\n    DB = [1.0, 0.4]\n\n    # Reference dataset for ADF calculation\n    ref_data = {\n        'phi_bar_A': [1.0, 0.3],\n        'phi_bar_B': [0.95, 0.31],\n        'J': [0.02, 0.005],\n        'phi_trans_A': [0.875, 0.208],\n        'phi_trans_B': [1.20, 0.450]\n    }\n\n    # Prediction scenarios\n    test_cases = [\n        # Scenario 1 (happy path: identical to the reference conditions)\n        {\n            'phi_bar_A': [1.0, 0.3], 'phi_bar_B': [0.95, 0.31],\n            'J': [0.02, 0.005],\n            'phi_trans_A': [0.875, 0.208], 'phi_trans_B': [1.20, 0.450]\n        },\n        # Scenario 2 (edge case: zero net currents)\n        {\n            'phi_bar_A': [1.05, 0.32], 'phi_bar_B': [0.98, 0.30],\n            'J': [0.0, 0.0],\n            'phi_trans_A': [1.12105, 0.342784], 'phi_trans_B': [1.012381913, 0.30413894]\n        },\n        # Scenario 3 (boundary case: large net currents and strong gradients)\n        {\n            'phi_bar_A': [0.97, 0.50], 'phi_bar_B': [0.90, 0.35],\n            'J': [0.06, 0.02],\n            'phi_trans_A': [0.498435, 0.1092], 'phi_trans_B': [1.5182609, 0.8353448]\n        }\n    ]\n\n    # --- Step 1: Calculate ADFs (d_f,g) from the Reference Dataset ---\n\n    # Pre-calculate geometric/material factors\n    # The arrays correspond to energy groups [g=1, g=2] i.e. index 0 and 1\n    factors_A = [hA / (2 * D) for D in DA]\n    factors_B = [hB / (2 * D) for D in DB]\n\n    # Calculate nodal diffusion face-trace fluxes for the reference case\n    phi_diff_A_ref = [\n        ref_data['phi_bar_A'][g] - factors_A[g] * ref_data['J'][g] for g in range(2)\n    ]\n    phi_diff_B_ref = [\n        ref_data['phi_bar_B'][g] + factors_B[g] * ref_data['J'][g] for g in range(2)\n    ]\n\n    # Calculate the Assembly Discontinuity Factors (ADFs)\n    d_A = [ ref_data['phi_trans_A'][g] / phi_diff_A_ref[g] for g in range(2) ]\n    d_B = [ ref_data['phi_trans_B'][g] / phi_diff_B_ref[g] for g in range(2) ]\n\n    # --- Step 2: Process Each Prediction Scenario ---\n    \n    results = []\n    for case in test_cases:\n        ratio_diffs = []\n        for g in range(2): # Iterate through energy groups g=1 (index 0) and g=2 (index 1)\n            \n            # Calculate nodal diffusion face-trace fluxes for the current scenario\n            phi_diff_A_scen = case['phi_bar_A'][g] - factors_A[g] * case['J'][g]\n            phi_diff_B_scen = case['phi_bar_B'][g] + factors_B[g] * case['J'][g]\n\n            # Calculate the transport-computed ratio\n            R_trans = case['phi_trans_B'][g] / case['phi_trans_A'][g]\n\n            # Calculate the ADF-corrected nodal diffusion ratio\n            num_corr = d_B[g] * phi_diff_B_scen\n            den_corr = d_A[g] * phi_diff_A_scen\n            \n            # This check is for robustness; given the problem data, den_corr will not be zero.\n            if den_corr == 0:\n                # Handle division by zero based on problem physics, e.g., set to infinity or NaN\n                # For this problem, it's not expected.\n                raise ValueError(\"Denominator for R_corr is zero.\")\n\n            R_corr = num_corr / den_corr\n            \n            # Calculate and store the absolute difference\n            ratio_diffs.append(abs(R_corr - R_trans))\n        \n        # The residual mismatch epsilon is the maximum difference across energy groups\n        epsilon = max(ratio_diffs)\n        results.append(epsilon)\n\n    # --- Final Output Formatting ---\n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join([f'{res:.6f}' for res in results])}]\")\n\nsolve()\n```"
        }
    ]
}