{
    "hands_on_practices": [
        {
            "introduction": "Assembly Discontinuity Factors (ADFs) are a cornerstone of modern nodal methods, designed to correct for errors introduced by spatial homogenization. This foundational exercise guides you through a short derivation to reveal the precise mathematical mechanism by which ADFs work: they enforce continuity on a *transformed* flux, which in turn introduces a necessary and calculated discontinuity in the physical scalar flux at assembly interfaces. Understanding this principle is the first step toward mastering their application in advanced reactor simulations .",
            "id": "4214667",
            "problem": "Consider a one-dimensional interface between two adjacent homogenized reactor assemblies, denoted the left assembly and the right assembly. For a fixed energy group $g$ and the common interfacial face $f$, let the face-averaged scalar fluxes be $\\phi_{L,f,g}$ and $\\phi_{R,f,g}$ on the left and right sides, respectively. The interfacial net current is $J_{L,f,g}$ on the left and $J_{R,f,g}$ on the right. In homogenized multi-group diffusion, the Assembly Discontinuity Factor (ADF) $d_{f,g}$ is defined on each face and energy group so that the transformed flux $\\tilde{\\phi}_{f,g} \\equiv d_{f,g}\\,\\phi_{f,g}$ is enforced to be continuous across the assembly interface, while the physical current is also continuous. That is, the well-tested interface conditions are $J_{L,f,g} = J_{R,f,g}$ and $d_{L,f,g}\\,\\phi_{L,f,g} = d_{R,f,g}\\,\\phi_{R,f,g}$.\n\nStarting from these interface conditions and the definition of the transformed flux, derive an analytic expression for the physical scalar flux jump\n$$\n\\Delta \\phi_{g} \\equiv \\phi_{R,f,g} - \\phi_{L,f,g}\n$$\nthat explicitly shows how the presence of $d_{f,g} \\neq 1$ permits a finite jump at the interface. Express $\\Delta \\phi_{g}$ in terms of the ratio $d_{L,f,g}/d_{R,f,g}$ and the continuous transformed flux $\\tilde{\\phi}_{f,g}$. Your final answer must be a single closed-form expression. No numerical rounding is required for this problem, and you should not include units in the final expression.",
            "solution": "The starting point is the homogenized multi-group diffusion description of assembly interfaces. At an interface between two homogenized assemblies, two well-tested conditions are enforced:\n\n1. Continuity of physical net current, which stems from neutron balance and Fick’s law in the homogenized medium, given by $J_{L,f,g} = J_{R,f,g}$.\n\n2. Continuity of the transformed flux, constructed using the Assembly Discontinuity Factor (ADF) to restore interfacial consistency with a high-fidelity reference. The transformed flux is defined as $\\tilde{\\phi}_{f,g} \\equiv d_{f,g}\\,\\phi_{f,g}$ and is enforced to be continuous across the interface:\n$$\nd_{L,f,g}\\,\\phi_{L,f,g} \\;=\\; d_{R,f,g}\\,\\phi_{R,f,g} \\;=\\; \\tilde{\\phi}_{f,g} .\n$$\n\nThe second condition directly relates the physical scalar fluxes on the left and right sides to the common transformed flux value. Solving for each physical flux in terms of the continuous transformed flux yields\n$$\n\\phi_{L,f,g} \\;=\\; \\frac{\\tilde{\\phi}_{f,g}}{d_{L,f,g}}, \n\\qquad\n\\phi_{R,f,g} \\;=\\; \\frac{\\tilde{\\phi}_{f,g}}{d_{R,f,g}} .\n$$\nSubtracting the left expression from the right expression gives the physical flux jump:\n$$\n\\Delta \\phi_{g} \\;\\equiv\\; \\phi_{R,f,g} - \\phi_{L,f,g}\n\\;=\\;\n\\frac{\\tilde{\\phi}_{f,g}}{d_{R,f,g}} - \\frac{\\tilde{\\phi}_{f,g}}{d_{L,f,g}}\n\\;=\\;\n\\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right).\n$$\n\nThis expression makes two important points transparent:\n\n- If $d_{L,f,g} = d_{R,f,g}$, then the jump vanishes, $\\Delta \\phi_{g} = 0$, and $\\phi_{f,g}$ is continuous, consistent with the special case where ADFs do not induce any discontinuity.\n\n- If $d_{L,f,g} \\neq d_{R,f,g}$, then a nonzero jump appears in proportion to the difference of the reciprocals of the ADFs, scaled by the continuous transformed flux. Equivalently, using the ratio $d_{L,f,g}/d_{R,f,g}$, one may write\n$$\n\\phi_{R,f,g} = \\left(\\frac{d_{L,f,g}}{d_{R,f,g}}\\right)\\phi_{L,f,g}\n\\quad\\Rightarrow\\quad\n\\Delta \\phi_{g} = \\phi_{L,f,g}\\left(\\frac{d_{L,f,g}}{d_{R,f,g}} - 1\\right)\n= \\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right),\n$$\nwhere the last equality uses $\\phi_{L,f,g} = \\tilde{\\phi}_{f,g}/d_{L,f,g}$.\n\nThus, in terms of the continuous transformed flux and the ADFs, the interface jump is given in closed form by\n$$\n\\Delta \\phi_{g} = \\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}} - \\frac{1}{d_{L,f,g}}\\right).\n$$\nThis result explicitly quantifies how $d_{f,g} \\neq 1$ permits a finite jump in the physical scalar flux across the assembly interface while maintaining continuity of the transformed flux.",
            "answer": "$$\\boxed{\\tilde{\\phi}_{f,g}\\left(\\frac{1}{d_{R,f,g}}-\\frac{1}{d_{L,f,g}}\\right)}$$"
        },
        {
            "introduction": "Beyond their theoretical definition, the practical utility of ADFs depends on their ability to accurately reproduce high-fidelity results under various reactor conditions. This exercise simulates a common validation task, where you will use a reference dataset to compute ADFs and then test their performance in different operational scenarios . By quantifying the mismatch, you will gain hands-on experience with the crucial concept of ADF state dependency, a key challenge in reactor analysis.",
            "id": "4214693",
            "problem": "Consider a one-dimensional interface between two adjacent fuel assemblies in a multigroup reactor core model. The steady-state neutron balance is approximated by the multigroup diffusion equation for energy group $g$,\n$$-\\nabla \\cdot \\left(D_g \\nabla \\phi_g\\right) + \\Sigma_{a,g}\\,\\phi_g = S_g,$$\nwith Fick's law,\n$$\\mathbf{J}_g = - D_g \\nabla \\phi_g,$$\nwhere $D_g$ is the group-wise diffusion coefficient, $\\Sigma_{a,g}$ is the group-wise macroscopic absorption cross section, $S_g$ is the group-wise source, $\\phi_g$ is the scalar neutron flux, and $\\mathbf{J}_g$ is the net current. In an assembly-homogenized nodal method, for a planar interface between assemblies $A$ and $B$ of half-widths $h_A$ and $h_B$, the face-trace fluxes are related to the assembly-average flux and the interface net current by linearization of the flux profile over each half-cell. Specifically, letting the outward normal of assembly $A$ point toward assembly $B$, one obtains from Fick's law and a linear half-cell gradient approximation that the face-trace flux at the interface on the $A$ side satisfies\n$$\\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g,$$\nand on the $B$ side satisfies\n$$\\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g,$$\nwhere $\\bar{\\phi}_{A,g}$ and $\\bar{\\phi}_{B,g}$ are the assembly-average fluxes and $J_g$ is the net current pointing from $A$ to $B$.\n\nDefine the Assembly Discontinuity Factor (ADF) for face $f \\in \\{A,B\\}$ and energy group $g$ as the multiplicative correction that makes the corrected nodal face-trace flux equal to a high-order transport-computed reference face-trace flux,\n$$d_{f,g} := \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}},$$\nwhere $\\hat{\\Phi}^{\\text{trans}}_{f,g}$ denotes the transport-computed face-trace flux at face $f$ for group $g$, and $\\hat{\\phi}^{\\text{diff}}_{f,g}$ denotes the corresponding uncorrected nodal diffusion face-trace flux.\n\nValidation of $d_{f,g}$ against a reference transport benchmark such as the two-dimensional, seven-energy-group benchmark (C5G7) can be reduced to a one-dimensional interface consistency check in two energy groups. In this problem, you will:\n- Compute $d_{f,g}$ from a provided reference dataset by applying the above definition using transport-computed face-trace fluxes and nodal diffusion face-trace fluxes derived from assembly averages and net currents.\n- For three prediction scenarios, apply the computed $d_{f,g}$ to new nodal diffusion face-trace fluxes, form the corrected nodal face-trace fluxes, and compare the ratio of opposite faces from transport to the ratio from corrected nodal diffusion. Specifically, for each group $g$, compute the transport ratio\n$$R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}},$$\nand the corrected nodal diffusion ratio\n$$R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}.$$\nThen quantify the residual mismatch per scenario by the maximum absolute ratio difference across energy groups,\n$$\\varepsilon = \\max_{g} \\left| R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} \\right|.$$\n\nAll flux-like quantities in this problem are normalized and dimensionless. Geometric half-widths $h_A,h_B$ and diffusion coefficients $D_{A,g},D_{B,g}$ are treated as non-dimensional parameters consistent with the above linearized trace relations. Angles do not appear in this problem. Your program must implement the computations from first principles stated above and produce a single output line aggregating the three scenario results as specified at the end.\n\nReference dataset (used exclusively to compute $d_{f,g}$):\n- Geometry: $h_A = 20$, $h_B = 20$.\n- Diffusion coefficients: $D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$.\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$.\n- Interface net currents: $J_{1} = 0.02$, $J_{2} = 0.005$ (positive from $A$ to $B$).\n- Transport-computed face-trace fluxes at the interface:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$.\n\nPrediction scenarios (use the $d_{f,g}$ computed from the reference dataset to validate; each scenario provides new assembly averages and currents and transport-computed face-trace fluxes to compare against):\n\nScenario 1 (happy path: identical to the reference conditions):\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$.\n- Interface net currents: $J_{1} = 0.02$, $J_{2} = 0.005$.\n- Transport-computed face-trace fluxes:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$.\n\nScenario 2 (edge case: zero net currents):\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$.\n- Interface net currents: $J_{1} = 0.0$, $J_{2} = 0.0$.\n- Transport-computed face-trace fluxes:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$.\n\nScenario 3 (boundary case: large net currents and strong gradients):\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$.\n- Interface net currents: $J_{1} = 0.06$, $J_{2} = 0.02$.\n- Transport-computed face-trace fluxes:\n  - On face $A$: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$.\n  - On face $B$: $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$.\n\nYour task is to implement a program that:\n- Computes $\\hat{\\phi}^{\\text{diff}}_{A,g}$ and $\\hat{\\phi}^{\\text{diff}}_{B,g}$ for the reference dataset and then evaluates $d_{A,g}$ and $d_{B,g}$ using the transport-computed reference fluxes.\n- For each prediction scenario, computes $\\hat{\\phi}^{\\text{diff}}_{A,g}$ and $\\hat{\\phi}^{\\text{diff}}_{B,g}$ from the given assembly averages and currents, forms $R^{\\text{corr}}_{g}$ using the previously computed $d_{f,g}$, and compares to $R^{\\text{trans}}_{g}$ from the provided transport data.\n- Returns the residual mismatch $\\varepsilon$ per scenario as defined above.\n\nFinal output format specification:\n- Your program should produce a single line of output containing the three scenario residual mismatches as a comma-separated list enclosed in square brackets, with each float rounded to six decimal places, following the exact format\n$$[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3].$$",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of nuclear reactor physics, specifically nodal diffusion methods, and is mathematically well-posed with all necessary information provided.\n\nThe problem requires the calculation of Assembly Discontinuity Factors (ADFs) from a reference dataset and then the evaluation of their effectiveness in three different prediction scenarios. The effectiveness is quantified by a residual mismatch parameter, $\\varepsilon$. The solution proceeds in two primary stages: first, the computation of the ADFs, and second, the application of these ADFs in each scenario to compute the corresponding $\\varepsilon$.\n\n**Part 1: Computation of Assembly Discontinuity Factors ($d_{f,g}$)**\n\nThe ADFs are constants derived from the provided reference dataset. They bridge the gap between the low-fidelity nodal diffusion model and a high-fidelity transport solution at the interface between assemblies.\n\nThe fundamental relations for the nodal diffusion face-trace fluxes, $\\hat{\\phi}^{\\text{diff}}_{f,g}$, for an interface between assembly $A$ and assembly $B$ are:\n$$ \\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g $$\n$$ \\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g $$\nwhere $g$ is the energy group index ($g \\in \\{1, 2\\}$), $\\bar{\\phi}_{f,g}$ is the assembly-average flux, $h_f$ is the assembly half-width, $D_{f,g}$ is the diffusion coefficient, and $J_g$ is the net current from $A$ to $B$.\n\nThe ADF, $d_{f,g}$, is defined as the ratio of the transport-computed face-trace flux, $\\hat{\\Phi}^{\\text{trans}}_{f,g}$, to the nodal diffusion face-trace flux:\n$$ d_{f,g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}} $$\n\nWe use the reference dataset to compute the four ADFs ($d_{A,1}, d_{A,2}, d_{B,1}, d_{B,2}$).\nReference Data:\n- Geometry: $h_A = 20$, $h_B = 20$.\n- Diffusion coefficients: $D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$.\n- Assembly-average fluxes: $\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$.\n- Interface net currents: $J_{1} = 0.02$, $J_{2} = 0.005$.\n- Transport fluxes: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$.\n\nFor energy group $g=1$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.0 - \\frac{20}{2 \\times 1.2} \\times 0.02 = 1.0 - 0.166\\overline{6} \\approx 0.833\\overline{3}$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.95 + \\frac{20}{2 \\times 1.0} \\times 0.02 = 0.95 + 0.2 = 1.15$\n- $d_{A,1} = \\frac{0.875}{0.833\\overline{3}} = 1.05$\n- $d_{B,1} = \\frac{1.20}{1.15} \\approx 1.043478$\n\nFor energy group $g=2$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.3 - \\frac{20}{2 \\times 0.5} \\times 0.005 = 0.3 - 0.1 = 0.2$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.31 + \\frac{20}{2 \\times 0.4} \\times 0.005 = 0.31 + 0.125 = 0.435$\n- $d_{A,2} = \\frac{0.208}{0.2} = 1.04$\n- $d_{B,2} = \\frac{0.450}{0.435} \\approx 1.034483$\n\nThese four ADF values are now fixed and will be used for all subsequent prediction scenarios.\n\n**Part 2: Evaluation of Prediction Scenarios**\n\nFor each scenario, we compute the residual mismatch $\\varepsilon = \\max_{g} | R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} |$, where:\n- Transport ratio: $R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}}$\n- Corrected nodal ratio: $R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}$\n\nThe geometry ($h_A, h_B$) and diffusion coefficients ($D_A, D_B$) are constant across all scenarios.\n\n**Scenario 1: Reference Conditions**\nThe data for this scenario is identical to the reference dataset. By construction, the corrected nodal fluxes will exactly match the transport fluxes: $d_{f,g} \\hat{\\phi}^{\\text{diff}}_{f,g} = \\hat{\\Phi}^{\\text{trans}}_{f,g}$.\nTherefore, $R^{\\text{corr}}_{g} = R^{\\text{trans}}_{g}$ for both groups $g=1$ and $g=2$.\nThe absolute difference is $0$ for both groups.\n- $\\varepsilon_1 = \\max(|0|, |0|) = 0.0$\n\n**Scenario 2: Zero Net Currents**\nData: $\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$. $J_1=0.0, J_2=0.0$.\nTransport fluxes: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$.\n\nFor group $g=1$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.05 - 0 = 1.05$; $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.98 + 0 = 0.98$\n- $R^{\\text{trans}}_{1} = \\frac{1.012381913}{1.12105} \\approx 0.903067$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 0.98}{d_{A,1} \\times 1.05} = \\frac{1.043478 \\times 0.98}{1.05 \\times 1.05} \\approx 0.927536$\n- Difference: $|0.927536 - 0.903067| \\approx 0.024469$\n\nFor group $g=2$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.32 - 0 = 0.32$; $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.30 + 0 = 0.30$\n- $R^{\\text{trans}}_{2} = \\frac{0.30413894}{0.342784} \\approx 0.887255$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.30}{d_{A,2} \\times 0.32} = \\frac{1.034483 \\times 0.30}{1.04 \\times 0.32} \\approx 0.932501$\n- Difference: $|0.932501 - 0.887255| \\approx 0.045246$\n- $\\varepsilon_2 = \\max(0.024469, 0.045246) \\approx 0.045246$\n\n**Scenario 3: Large Net Currents**\nData: $\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$. $J_1=0.06, J_2=0.02$.\nTransport fluxes: $\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$.\n\nFor group $g=1$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 0.97 - \\frac{20}{2 \\times 1.2} \\times 0.06 = 0.97 - 0.5 = 0.47$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.90 + \\frac{20}{2 \\times 1.0} \\times 0.06 = 0.90 + 0.6 = 1.50$\n- $R^{\\text{trans}}_{1} = \\frac{1.5182609}{0.498435} \\approx 3.046031$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 1.50}{d_{A,1} \\times 0.47} = \\frac{1.043478 \\times 1.50}{1.05 \\times 0.47} \\approx 3.171350$\n- Difference: $|3.171350 - 3.046031| \\approx 0.125319$\n\nFor group $g=2$:\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.50 - \\frac{20}{2 \\times 0.5} \\times 0.02 = 0.50 - 0.4 = 0.10$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.35 + \\frac{20}{2 \\times 0.4} \\times 0.02 = 0.35 + 0.5 = 0.85$\n- $R^{\\text{trans}}_{2} = \\frac{0.8353448}{0.1092} \\approx 7.649678$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.85}{d_{A,2} \\times 0.10} = \\frac{1.034483 \\times 0.85}{1.04 \\times 0.10} \\approx 8.454913$\n- Difference: $|8.454913 - 7.649678| \\approx 0.805235$\n- $\\varepsilon_3 = \\max(0.125319, 0.805235) \\approx 0.805236$\n\nIn summary, the residual mismatches for the three scenarios are $\\varepsilon_1 = 0.0$, $\\varepsilon_2 \\approx 0.045246$, and $\\varepsilon_3 \\approx 0.805236$. These results demonstrate that the accuracy of ADFs, when treated as constants, degrades as the system state (fluxes and currents) deviates from the reference state used to generate them.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes Assembly Discontinuity Factors (ADFs) from a reference dataset and\n    evaluates their performance in three prediction scenarios by calculating the\n    residual mismatch epsilon.\n    \"\"\"\n    \n    # --- Data Definition ---\n\n    # Common geometric and material properties\n    hA = 20.0\n    hB = 20.0\n    DA = [1.2, 0.5]\n    DB = [1.0, 0.4]\n\n    # Reference dataset for ADF calculation\n    ref_data = {\n        'phi_bar_A': [1.0, 0.3],\n        'phi_bar_B': [0.95, 0.31],\n        'J': [0.02, 0.005],\n        'phi_trans_A': [0.875, 0.208],\n        'phi_trans_B': [1.20, 0.450]\n    }\n\n    # Prediction scenarios\n    test_cases = [\n        # Scenario 1 (happy path: identical to the reference conditions)\n        {\n            'phi_bar_A': [1.0, 0.3], 'phi_bar_B': [0.95, 0.31],\n            'J': [0.02, 0.005],\n            'phi_trans_A': [0.875, 0.208], 'phi_trans_B': [1.20, 0.450]\n        },\n        # Scenario 2 (edge case: zero net currents)\n        {\n            'phi_bar_A': [1.05, 0.32], 'phi_bar_B': [0.98, 0.30],\n            'J': [0.0, 0.0],\n            'phi_trans_A': [1.12105, 0.342784], 'phi_trans_B': [1.012381913, 0.30413894]\n        },\n        # Scenario 3 (boundary case: large net currents and strong gradients)\n        {\n            'phi_bar_A': [0.97, 0.50], 'phi_bar_B': [0.90, 0.35],\n            'J': [0.06, 0.02],\n            'phi_trans_A': [0.498435, 0.1092], 'phi_trans_B': [1.5182609, 0.8353448]\n        }\n    ]\n\n    # --- Step 1: Calculate ADFs (d_f,g) from the Reference Dataset ---\n\n    # Pre-calculate geometric/material factors\n    # The arrays correspond to energy groups [g=1, g=2] i.e. index 0 and 1\n    factors_A = [hA / (2 * D) for D in DA]\n    factors_B = [hB / (2 * D) for D in DB]\n\n    # Calculate nodal diffusion face-trace fluxes for the reference case\n    phi_diff_A_ref = [\n        ref_data['phi_bar_A'][g] - factors_A[g] * ref_data['J'][g] for g in range(2)\n    ]\n    phi_diff_B_ref = [\n        ref_data['phi_bar_B'][g] + factors_B[g] * ref_data['J'][g] for g in range(2)\n    ]\n\n    # Calculate the Assembly Discontinuity Factors (ADFs)\n    d_A = [ ref_data['phi_trans_A'][g] / phi_diff_A_ref[g] for g in range(2) ]\n    d_B = [ ref_data['phi_trans_B'][g] / phi_diff_B_ref[g] for g in range(2) ]\n\n    # --- Step 2: Process Each Prediction Scenario ---\n    \n    results = []\n    for case in test_cases:\n        ratio_diffs = []\n        for g in range(2): # Iterate through energy groups g=1 (index 0) and g=2 (index 1)\n            \n            # Calculate nodal diffusion face-trace fluxes for the current scenario\n            phi_diff_A_scen = case['phi_bar_A'][g] - factors_A[g] * case['J'][g]\n            phi_diff_B_scen = case['phi_bar_B'][g] + factors_B[g] * case['J'][g]\n\n            # Calculate the transport-computed ratio\n            R_trans = case['phi_trans_B'][g] / case['phi_trans_A'][g]\n\n            # Calculate the ADF-corrected nodal diffusion ratio\n            num_corr = d_B[g] * phi_diff_B_scen\n            den_corr = d_A[g] * phi_diff_A_scen\n            \n            # This check is for robustness; given the problem data, den_corr will not be zero.\n            if den_corr == 0:\n                # Handle division by zero based on problem physics, e.g., set to infinity or NaN\n                # For this problem, it's not expected.\n                raise ValueError(\"Denominator for R_corr is zero.\")\n\n            R_corr = num_corr / den_corr\n            \n            # Calculate and store the absolute difference\n            ratio_diffs.append(abs(R_corr - R_trans))\n        \n        # The residual mismatch epsilon is the maximum difference across energy groups\n        epsilon = max(ratio_diffs)\n        results.append(epsilon)\n\n    # --- Final Output Formatting ---\n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join([f'{res:.6f}' for res in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The accuracy of a nodal calculation depends not only on the quality of the ADFs but also on the consistency between how they are generated and how they are used. This practice explores the numerical robustness of ADFs when the polynomial order of the nodal flux expansion is varied, a common scenario in multi-physics simulations with varying computational demands . This analysis will help you understand how the choice of numerical method impacts the fidelity of the ADF correction, a vital consideration for developing and using advanced simulation codes.",
            "id": "4214698",
            "problem": "Consider a one-dimensional slab representation of a single reactor assembly used in a homogenized nodal solver. Let the spatial coordinate be $x \\in [-h/2,h/2]$, and define the normalized coordinate $\\xi = 2x/h \\in [-1,1]$. The scalar neutron flux shape for a given energy group $g$ inside the heterogeneous assembly is denoted by $\\phi_{\\mathrm{het},g}(x)$ and is assumed to be positive and sufficiently smooth. The homogenized nodal solver uses a polynomial representation of the flux inside the assembly based on the Nodal Expansion Method (NEM), which uses Legendre polynomials $P_n(\\xi)$ up to order $p$, so that the reconstructed shape is $\\phi_{\\mathrm{proj},g}^{(p)}(\\xi) = \\sum_{n=0}^{p} a_{n,g}^{(p)} P_n(\\xi)$. The Assembly Discontinuity Factor (ADF) at face $f$ for group $g$, denoted $d_{f,g}$, is defined to enforce the reproduction of heterogeneous face fluxes by scaling the homogenized nodal face fluxes at the assembly interfaces. Specifically, for the left face $f=L$ at $\\xi=-1$ and the right face $f=R$ at $\\xi=+1$, the ADFs satisfy $d_{L,g}\\,\\phi_{\\mathrm{hom},g}(-1)=\\phi_{\\mathrm{het},g}(-1)$ and $d_{R,g}\\,\\phi_{\\mathrm{hom},g}(+1)=\\phi_{\\mathrm{het},g}(+1)$, where $\\phi_{\\mathrm{hom},g}$ denotes the face flux reconstructed by the nodal method. \n\nStart from the neutron balance in one-group diffusion form as the fundamental base: in a homogeneous slab with diffusion coefficient $D_g$ and absorption cross section $\\Sigma_{a,g}$, the scalar flux solves $-D_g\\,\\frac{d^2 \\phi_g}{dx^2} + \\Sigma_{a,g}\\,\\phi_g = S_g(x)$ under appropriate boundary conditions, where $S_g(x)$ is a source. In a heterogeneous assembly, spatial variations of $D_g$, $\\Sigma_{a,g}$, and $S_g(x)$ produce nontrivial intra-assembly shapes $\\phi_{\\mathrm{het},g}(x)$. The purpose of ADFs is to correct the face values of the homogenized representation so that the nodal solver reproduces the heterogeneous face fluxes and their ratios across interfaces.\n\nIn this problem, analyze the robustness of $d_{f,g}$ to mesh coarsening within the nodal solver by examining how changes in nodal polynomial order $p$ affect the reproduction of heterogeneous face flux ratios. Use the following definitions and procedures:\n\n- Define the heterogeneous flux shape for group $g$ on $x \\in [-h/2,h/2]$ by\n$$\n\\phi_{\\mathrm{het},g}(x) = \\exp\\!\\Big(\\alpha_g \\frac{x}{h}\\Big)\\,\\Big(1 + \\beta_g \\cos\\!\\Big(\\pi \\frac{x}{h}\\Big) + \\gamma_g \\Big(\\frac{x}{h}\\Big)^2\\Big),\n$$\nand normalize it to unit cell-average over $x \\in [-h/2,h/2]$. This normalization ensures $\\frac{1}{h}\\int_{-h/2}^{h/2} \\phi_{\\mathrm{het},g}(x)\\,dx = 1$.\n\n- Construct the Legendre projection $\\phi_{\\mathrm{proj},g}^{(p)}(\\xi)$ by least-squares projection of the normalized heterogeneous shape onto the span of $\\{P_0(\\xi),P_1(\\xi),\\dots,P_p(\\xi)\\}$ on $\\xi \\in [-1,1]$, using the standard $L^2$ inner product. Ensure the projected shape is consistently normalized in the $L^2$ sense implied by the projection.\n\n- Let the reference ADFs be computed at a high polynomial order $p_{\\mathrm{ref}}$ by\n$$\nd_{L,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(-1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(-1)}, \\quad\nd_{R,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(+1)}.\n$$\n\n- Define the true heterogeneous face flux ratio for group $g$ as\n$$\nr_{g}^{\\mathrm{true}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{het},g}(-1)}.\n$$\n\n- For each lower polynomial order $p \\in \\mathbb{N}$, define the ADF-corrected predicted ratio using the reference ADFs applied to the $p$-order projection as\n$$\nr_{g}^{\\mathrm{pred}}(p) = \\frac{d_{R,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(+1)}{d_{L,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(-1)}.\n$$\n\n- Define the robustness metric for a given parameter set and a list of polynomial orders $\\{p\\}$ as the worst-case relative error in reproducing the face flux ratio,\n$$\n\\mathcal{R}_g = \\max_{p \\in \\mathcal{P}} \\left| \\frac{r_{g}^{\\mathrm{pred}}(p) - r_{g}^{\\mathrm{true}}}{r_{g}^{\\mathrm{true}}} \\right|.\n$$\nA smaller $\\mathcal{R}_g$ indicates that the ADFs are robust to coarsening of the nodal polynomial order.\n\nImplement the above computation numerically using Gauss–Legendre quadrature on $\\xi \\in [-1,1]$ with sufficiently many points to ensure stability of the projections. Treat the single energy group $g$ as given in each case. No physical units are required because the flux shape is dimensionless after normalization.\n\nYour task is to write a complete, runnable program that computes $\\mathcal{R}_g$ for each of the following test cases. For each case, use the specified assembly half-width $h/2$ implied by $h$, and use the given list of polynomial orders for coarsening. Use a single reference order $p_{\\mathrm{ref}}=9$ for all cases.\n\nTest Suite:\n- Case $1$ (baseline heterogeneity): $h=1$, $\\alpha=0.8$, $\\beta=0.2$, $\\gamma=0.1$, $\\mathcal{P}=\\{0,1,2,3\\}$.\n- Case $2$ (near-flat shape boundary): $h=1$, $\\alpha=0.0$, $\\beta=0.0$, $\\gamma=0.0$, $\\mathcal{P}=\\{0,1,2,3\\}$.\n- Case $3$ (strong exponential skew with moderate oscillation): $h=1$, $\\alpha=3.0$, $\\beta=0.3$, $\\gamma=0.2$, $\\mathcal{P}=\\{0,1,3,5\\}$.\n- Case $4$ (purely oscillatory within moderate amplitude): $h=1$, $\\alpha=0.0$, $\\beta=0.4$, $\\gamma=0.0$, $\\mathcal{P}=\\{0,1,2,4\\}$.\n\nFor each case, compute the single robustness metric $\\mathcal{R}_g$ as defined above and round it to $6$ decimal places.\n\nFinal Output Format:\nYour program should produce a single line of output containing the robustness metrics for the four cases as a comma-separated list of floats enclosed in square brackets, for example, $[\\mathcal{R}_1,\\mathcal{R}_2,\\mathcal{R}_3,\\mathcal{R}_4]$, where each $\\mathcal{R}_i$ is rounded to $6$ decimal places as specified.",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n\n-   **Spatial Domain**: One-dimensional slab, $x \\in [-h/2, h/2]$.\n-   **Normalized Coordinate**: $\\xi = 2x/h \\in [-1, 1]$.\n-   **Heterogeneous Flux Shape**: $\\phi_{\\mathrm{het},g}(x) = \\exp(\\alpha_g \\frac{x}{h}) (1 + \\beta_g \\cos(\\pi \\frac{x}{h}) + \\gamma_g (\\frac{x}{h})^2)$.\n-   **Flux Normalization**: The heterogeneous flux must be normalized to have a unit cell-average: $\\frac{1}{h}\\int_{-h/2}^{h/2} \\phi_{\\mathrm{het},g}(x)\\,dx = 1$.\n-   **Projected Flux Shape**: Nodal Expansion Method (NEM) representation using Legendre polynomials $P_n(\\xi)$ up to order $p$: $\\phi_{\\mathrm{proj},g}^{(p)}(\\xi) = \\sum_{n=0}^{p} a_{n,g}^{(p)} P_n(\\xi)$.\n-   **Projection Method**: The coefficients $a_{n,g}^{(p)}$ are determined by a least-squares projection of the normalized heterogeneous shape onto the span of $\\{P_0(\\xi), \\dots, P_p(\\xi)\\}$ using the standard $L^2$ inner product on $\\xi \\in [-1,1]$.\n-   **Assembly Discontinuity Factor (ADF) Definition**: $d_{L,g}\\,\\phi_{\\mathrm{hom},g}(-1)=\\phi_{\\mathrm{het},g}(-1)$ and $d_{R,g}\\,\\phi_{\\mathrm{hom},g}(+1)=\\phi_{\\mathrm{het},g}(+1)$ at faces $L$ ($\\xi=-1$) and $R$ ($\\xi=+1$).\n-   **Reference Polynomial Order**: $p_{\\mathrm{ref}}=9$.\n-   **Reference ADFs**: $d_{L,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(-1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(-1)}$ and $d_{R,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(+1)}$.\n-   **True Face Flux Ratio**: $r_{g}^{\\mathrm{true}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{het},g}(-1)}$.\n-   **ADF-Corrected Predicted Ratio**: $r_{g}^{\\mathrm{pred}}(p) = \\frac{d_{R,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(+1)}{d_{L,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(-1)}$.\n-   **Robustness Metric**: $\\mathcal{R}_g = \\max_{p \\in \\mathcal{P}} \\left| \\frac{r_{g}^{\\mathrm{pred}}(p) - r_{g}^{\\mathrm{true}}}{r_{g}^{\\mathrm{true}}} \\right|$.\n-   **Numerical Method**: Use Gauss-Legendre quadrature.\n-   **Test Suite**:\n    -   Case 1: $h=1, \\alpha=0.8, \\beta=0.2, \\gamma=0.1, \\mathcal{P}=\\{0,1,2,3\\}$.\n    -   Case 2: $h=1, \\alpha=0.0, \\beta=0.0, \\gamma=0.0, \\mathcal{P}=\\{0,1,2,3\\}$.\n    -   Case 3: $h=1, \\alpha=3.0, \\beta=0.3, \\gamma=0.2, \\mathcal{P}=\\{0,1,3,5\\}$.\n    -   Case 4: $h=1, \\alpha=0.0, \\beta=0.4, \\gamma=0.0, \\mathcal{P}=\\{0,1,2,4\\}$.\n-   **Output Requirement**: Compute $\\mathcal{R}_g$ for each case, rounded to $6$ decimal places.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is subjected to validation against the established criteria:\n\n1.  **Scientific Grounding**: The problem is firmly rooted in the field of nuclear reactor physics, specifically in the area of numerical methods for reactor simulation. The concepts of homogenized nodal methods, Assembly Discontinuity Factors (ADFs), Legendre polynomial expansions (Nodal Expansion Method), and neutron diffusion are all standard and well-established. The use of an analytical function for the heterogeneous flux is a common technique for verifying numerical methods and analyzing their properties.\n2.  **Well-Posedness**: The problem defines a clear, unambiguous, and deterministic computational procedure. Each step—from flux normalization and projection to the calculation of ratios and the final error metric—is precisely specified. All necessary parameters and data for the test cases are provided, ensuring a unique solution can be computed.\n3.  **Objectivity**: The problem is stated in precise, technical language, free from subjective or opinion-based statements. The definitions and metrics are quantitative and objective.\n4.  **Completeness**: The problem is self-contained. It provides the analytical form of the flux, all required parameters for four distinct cases, the specific polynomial orders to be tested, the reference order, and the exact definition of the metric to be calculated. The suggestion to use Gauss-Legendre quadrature provides sufficient guidance for implementation.\n5.  **No other flaws detected**: The problem does not violate any other criteria. It is not trivial (requiring non-obvious numerical computation), is formalizable, and is scientifically verifiable through computation. The provided parameters are physically plausible for a test problem.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. It represents a well-posed and scientifically grounded numerical analysis task relevant to the field of nuclear engineering. A complete solution will be provided.\n\n## Solution\n\nThe solution requires implementing a numerical procedure to compute the robustness metric $\\mathcal{R}_g$ for several test cases. The core of the procedure involves projecting a given heterogeneous flux shape onto a basis of Legendre polynomials and then evaluating the accuracy of Assembly Discontinuity Factors (ADFs) under polynomial order coarsening.\n\nFirst, we express the heterogeneous flux in terms of the normalized coordinate $\\xi = 2x/h$. Substituting $x/h = \\xi/2$ into the given expression, we get:\n$$\n\\phi_{\\mathrm{het},g}(\\xi) = \\exp\\left(\\frac{\\alpha_g \\xi}{2}\\right)\\left(1 + \\beta_g \\cos\\left(\\frac{\\pi \\xi}{2}\\right) + \\gamma_g \\left(\\frac{\\xi}{2}\\right)^2\\right)\n$$\nThis function is defined on the interval $\\xi \\in [-1, 1]$.\n\nThe problem requires normalizing this flux to have a unit cell-average. The cell-average is given by $\\frac{1}{h}\\int_{-h/2}^{h/2} \\phi_{\\mathrm{het},g}(x)\\,dx$. Changing variables to $\\xi$, where $dx = \\frac{h}{2}d\\xi$, the average becomes:\n$$\n\\text{Avg}(\\phi) = \\frac{1}{h}\\int_{-1}^{1} \\phi_{\\mathrm{het},g}(\\xi) \\frac{h}{2}d\\xi = \\frac{1}{2}\\int_{-1}^{1} \\phi_{\\mathrm{het},g}(\\xi) d\\xi\n$$\nLet the unnormalized flux be $\\phi_{\\mathrm{unnorm},g}(\\xi)$. We define the normalized flux $\\phi_{\\mathrm{norm},g}(\\xi) = C_g \\phi_{\\mathrm{unnorm},g}(\\xi)$ such that its average is $1$. The normalization constant $C_g$ is therefore:\n$$\nC_g = \\frac{1}{\\frac{1}{2}\\int_{-1}^{1} \\phi_{\\mathrm{unnorm},g}(\\xi) d\\xi} = \\frac{2}{\\int_{-1}^{1} \\phi_{\\mathrm{unnorm},g}(\\xi) d\\xi}\n$$\nThis integral will be computed numerically using Gauss-Legendre quadrature over $\\xi \\in [-1,1]$.\n\nNext, we construct the Legendre projection of the normalized flux, $\\phi_{\\mathrm{norm},g}(\\xi)$. The projected flux of order $p$, $\\phi_{\\mathrm{proj},g}^{(p)}(\\xi)$, is given by the series:\n$$\n\\phi_{\\mathrm{proj},g}^{(p)}(\\xi) = \\sum_{n=0}^{p} a_{n,g}^{(p)} P_n(\\xi)\n$$\nThe coefficients $a_{n,g}^{(p)}$ are found via the standard $L^2$ projection formula, which leverages the orthogonality of Legendre polynomials, $\\int_{-1}^1 P_n(\\xi) P_m(\\xi) d\\xi = \\frac{2}{2n+1}\\delta_{nm}$:\n$$\na_{n,g}^{(p)} = \\frac{\\int_{-1}^1 \\phi_{\\mathrm{norm},g}(\\xi) P_n(\\xi) d\\xi}{\\int_{-1}^1 P_n^2(\\xi) d\\xi} = \\frac{2n+1}{2} \\int_{-1}^1 \\phi_{\\mathrm{norm},g}(\\xi) P_n(\\xi) d\\xi\n$$\nThese integrals are also evaluated using Gauss-Legendre quadrature. A sufficiently high number of quadrature points is used to ensure accuracy for the non-polynomial integrand.\n\nWith the coefficients determined, we can evaluate the projected flux at the boundaries $\\xi = -1$ and $\\xi = +1$. Using the properties $P_n(-1) = (-1)^n$ and $P_n(+1) = 1$:\n$$\n\\phi_{\\mathrm{proj},g}^{(p)}(-1) = \\sum_{n=0}^{p} a_{n,g}^{(p)} (-1)^n \\quad \\text{and} \\quad \\phi_{\\mathrm{proj},g}^{(p)}(+1) = \\sum_{n=0}^{p} a_{n,g}^{(p)}\n$$\n\nThe main calculation proceeds as follows for each test case:\n1.  Define the unnormalized flux $\\phi_{\\mathrm{unnorm},g}(\\xi)$ using the given parameters $\\alpha_g, \\beta_g, \\gamma_g$.\n2.  Compute the normalization constant $C_g$ and define the normalized flux $\\phi_{\\mathrm{norm},g}(\\xi)$.\n3.  Calculate the heterogeneous face fluxes $\\phi_{\\mathrm{norm},g}(-1)$ and $\\phi_{\\mathrm{norm},g}(+1)$.\n4.  Compute the \"true\" face flux ratio: $r_{g}^{\\mathrm{true}} = \\phi_{\\mathrm{norm},g}(+1) / \\phi_{\\mathrm{norm},g}(-1)$.\n5.  Calculate the reference projected flux values at the boundaries for $p_{\\mathrm{ref}}=9$: $\\phi_{\\mathrm{proj},g}^{(9)}(-1)$ and $\\phi_{\\mathrm{proj},g}^{(9)}(+1)$.\n6.  Compute the reference ADFs:\n    $$\n    d_{L,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{norm},g}(-1)}{\\phi_{\\mathrm{proj},g}^{(9)}(-1)} \\quad \\text{and} \\quad\n    d_{R,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{norm},g}(+1)}{\\phi_{\\mathrm{proj},g}^{(9)}(+1)}\n    $$\n7.  Initialize a variable for the maximum relative error to $0$.\n8.  Iterate through each polynomial order $p$ in the specified set $\\mathcal{P}$:\n    a. Calculate the projected flux values at the boundaries for the current order $p$: $\\phi_{\\mathrm{proj},g}^{(p)}(-1)$ and $\\phi_{\\mathrm{proj},g}^{(p)}(+1)$.\n    b. Compute the ADF-corrected predicted ratio:\n    $$\n    r_{g}^{\\mathrm{pred}}(p) = \\frac{d_{R,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(+1)}{d_{L,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(-1)}\n    $$\n    c. Calculate the relative error: $\\left| (r_{g}^{\\mathrm{pred}}(p) - r_{g}^{\\mathrm{true}}) / r_{g}^{\\mathrm{true}} \\right|$.\n    d. Update the maximum relative error if the current error is larger.\n9.  The final maximum relative error is the robustness metric $\\mathcal{R}_g$ for the test case.\n\nThis procedure is implemented for each of the four test cases provided, and the resulting $\\mathcal{R}_g$ values are collected.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import eval_legendre\nfrom numpy.polynomial.legendre import leggauss\n\ndef get_projected_flux_at_endpoints(p_order, phi_norm_func, quad_points, quad_weights):\n    \"\"\"\n    Calculates the Legendre-projected flux at the endpoints xi = -1 and xi = +1.\n\n    Args:\n        p_order (int): The maximum order of the Legendre polynomial expansion.\n        phi_norm_func (callable): The normalized heterogeneous flux function phi(xi).\n        quad_points (np.ndarray): Gauss-Legendre quadrature points.\n        quad_weights (np.ndarray): Gauss-Legendre quadrature weights.\n\n    Returns:\n        tuple[float, float]: A tuple containing the projected flux at xi=-1 and xi=+1.\n    \"\"\"\n    phi_proj_L = 0.0\n    phi_proj_R = 0.0\n    \n    phi_vals_at_quad = phi_norm_func(quad_points)\n\n    for n in range(p_order + 1):\n        # Evaluate P_n(xi) at all quadrature points\n        Pn_vals_at_quad = eval_legendre(n, quad_points)\n        \n        # Compute the integral for the coefficient a_n\n        integrand = phi_vals_at_quad * Pn_vals_at_quad\n        integral_val = np.sum(integrand * quad_weights)\n        \n        # Calculate the coefficient a_n\n        a_n = (2 * n + 1) / 2.0 * integral_val\n        \n        # Accumulate the series sum at xi = -1 and xi = +1\n        # P_n(-1) = (-1)^n, P_n(+1) = 1\n        phi_proj_L += a_n * ((-1)**n)\n        phi_proj_R += a_n\n        \n    return phi_proj_L, phi_proj_R\n\ndef compute_robustness_metric(h, alpha, beta, gamma, P_orders, p_ref=9, n_quad_points=200):\n    \"\"\"\n    Computes the robustness metric R_g for a single test case.\n    \n    Args:\n        h (float): Assembly width.\n        alpha (float): Parameter for the exponential term of the flux shape.\n        beta (float): Parameter for the cosine term of the flux shape.\n        gamma (float): Parameter for the quadratic term of the flux shape.\n        P_orders (list[int]): List of polynomial orders for coarsening analysis.\n        p_ref (int): The reference polynomial order for ADF calculation.\n        n_quad_points (int): The number of points for Gauss-Legendre quadrature.\n\n    Returns:\n        float: The computed robustness metric R_g.\n    \"\"\"\n    # 1. Define the unnormalized heterogeneous flux function phi(xi)\n    # x/h = xi/2\n    def phi_unnorm_func(xi):\n        return np.exp(alpha * xi / 2.0) * (1.0 + beta * np.cos(np.pi * xi / 2.0) + gamma * (xi / 2.0)**2)\n\n    # 2. Setup quadrature and compute normalization constant\n    quad_points, quad_weights = leggauss(n_quad_points)\n    \n    integral_phi_unnorm = np.sum(phi_unnorm_func(quad_points) * quad_weights)\n    \n    # Avoid division by zero if integral is pathologically zero\n    if np.abs(integral_phi_unnorm)  1e-15:\n        # For the case alpha=beta=gamma=0, integral is 2, h=1.\n        # This branch is for analytical robustness, not expected to be hit by tests.\n        C_g = 1.0 \n    else:\n        C_g = 2.0 / integral_phi_unnorm\n    \n    def phi_norm_func(xi):\n        return C_g * phi_unnorm_func(xi)\n\n    # 3. Calculate true heterogeneous face fluxes and their ratio\n    phi_het_L = phi_norm_func(-1.0)\n    phi_het_R = phi_norm_func(1.0)\n    \n    if np.abs(phi_het_L)  1e-15:\n        # For the provided test cases, phi_het_L is always non-zero.\n        raise ValueError(\"Heterogeneous flux at left face is zero, cannot compute ratio.\")\n        \n    r_true = phi_het_R / phi_het_L\n\n    # 4. Calculate reference ADFs using p_ref\n    phi_proj_ref_L, phi_proj_ref_R = get_projected_flux_at_endpoints(\n        p_ref, phi_norm_func, quad_points, quad_weights\n    )\n\n    if np.abs(phi_proj_ref_L)  1e-15 or np.abs(phi_proj_ref_R)  1e-15:\n        # This case might occur if the projection is zero at an endpoint, \n        # but is unlikely for a high-order projection of a smooth function.\n        # Fallback for case 2 (flat flux): proj is 1 everywhere.\n        if np.abs(phi_proj_ref_L)  1e-15: phi_proj_ref_L=1.0\n        if np.abs(phi_proj_ref_R)  1e-15: phi_proj_ref_R=1.0\n\n    d_L_ref = phi_het_L / phi_proj_ref_L\n    d_R_ref = phi_het_R / phi_proj_ref_R\n\n    # 5. Compute the robustness metric over the specified polynomial orders\n    max_rel_error = 0.0\n\n    for p in P_orders:\n        phi_proj_p_L, phi_proj_p_R = get_projected_flux_at_endpoints(\n            p, phi_norm_func, quad_points, quad_weights\n        )\n        \n        # Denominator for r_pred\n        denom = d_L_ref * phi_proj_p_L\n        if np.abs(denom)  1e-15:\n            # Special handling for symmetric cases (alpha=0) where proj_p_L can be zero\n            # if the flux is even and p is odd.\n            # Example: p=1 proj of even func has a1=0, phi_proj(xi)=1.\n            # However, with ADF correction, this should cancel out.\n            # If denom is zero, numerator should also be zero.\n             if np.abs(d_R_ref * phi_proj_p_R)  1e-15:\n                 r_pred = r_true # If both are zero, ratio is indeterminate but physically should be the true ratio\n             else:\n                 r_pred = np.inf # Should not happen in a well-behaved problem\n        else:\n            r_pred = (d_R_ref * phi_proj_p_R) / denom\n\n        if np.abs(r_true)  1e-15:\n            rel_error = np.abs(r_pred - r_true)\n        else:\n            rel_error = np.abs((r_pred - r_true) / r_true)\n        \n        if rel_error > max_rel_error:\n            max_rel_error = rel_error\n            \n    return max_rel_error\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h, alpha, beta, gamma, P_orders)\n        (1.0, 0.8, 0.2, 0.1, [0, 1, 2, 3]),\n        (1.0, 0.0, 0.0, 0.0, [0, 1, 2, 3]),\n        (1.0, 3.0, 0.3, 0.2, [0, 1, 3, 5]),\n        (1.0, 0.0, 0.4, 0.0, [0, 1, 2, 4]),\n    ]\n\n    results = []\n    for case in test_cases:\n        h, alpha, beta, gamma, P_orders = case\n        result = compute_robustness_metric(h, alpha, beta, gamma, P_orders)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}