{
    "hands_on_practices": [
        {
            "introduction": "要真正理解组件非连续因子（ADFs），关键在于弄清它们如何从基本的中子输运物理中产生。本实践旨在连接组件边界处详细的角通量分布与节块程序中使用的简化参数，从而弥合两者之间的差距。通过推导和计算一个一维中子输运问题的ADF，您将直接洞察中子流等因素如何影响均匀化所需的修正。",
            "id": "4214682",
            "problem": "考虑一个用于$g$群的核反应堆组件的单速、稳态、一维平板模型，该模型是均匀、空间一致且无内源的。厚度为$T$（单位为$\\mathrm{cm}$）的平板占据$x \\in [0,T]$的空间。$g$群的宏观吸收截面为$\\Sigma_{a,g}$（单位为$\\mathrm{cm}^{-1}$）。我们关注的界面是位于$x=0$的左侧面，在该界面上，流入平板方向的入射角通量是给定的。对于在$x=0$处指向平板内部的方向，设相对于$+x$轴的方向余弦为$\\mu \\in (0,1)$。在$x=T$处为真空（即右边界没有入射通量）。\n\n按照中子输运的常规方式定义标流通量$\\phi_g(x)$和角通量$\\psi_g(x,\\mu)$。$g$群在$f$面上的组件非连续因子（ADF），记作$d_{f,g}$，定义为组件的体积平均标流通量与该面上的表面半程标流通量之比，\n$$\nd_{f,g} \\equiv \\frac{\\bar{\\phi}_g}{\\hat{\\phi}_{f,g}},\n$$\n其中\n$$\n\\bar{\\phi}_g = \\frac{1}{T} \\int_{0}^{T} \\phi_g(x) \\, dx,\n\\qquad\n\\hat{\\phi}_{f,g} = \\int_{0}^{1} \\psi_g(0,\\mu) \\, d\\mu.\n$$\n\n假设在平板内部，单速纯吸收中子输运方程成立：\n$$\n\\mu \\, \\frac{\\partial \\psi_g(x,\\mu)}{\\partial x} + \\Sigma_{a,g} \\, \\psi_g(x,\\mu) = 0,\n$$\n对于$\\mu \\in (0,1)$（中子自$x=0$流入平板），且$x=T$处为真空，确保没有中子自右侧入射。设$x=0$处的入射边界角通量参数化为\n$$\n\\psi_g(0,\\mu) = \\psi_0 \\, \\bigl(1 + \\alpha \\mu \\bigr), \\quad \\mu \\in (0,1),\n$$\n其中$\\psi_0$（单位为$\\mathrm{n \\, cm^{-2} \\, s^{-1} \\, sr^{-1}}$）和各向异性参数$\\alpha \\in [-1,1]$，使得对于所有$\\mu \\in (0,1)$，都有$\\psi_g(0,\\mu) \\ge 0$。$\\alpha = 0$的特殊情况代表了界面处的各向同性角通量分布，这可以作为各向同性散射主导的边界条件的近似。\n\n您的任务是：\n1. 从给定的输运方程和这些定义出发，推导出一个用$\\Sigma_{a,g}$、$T$、$\\psi_0$和$\\alpha$表示$d_{f,g}$的公式。您的推导必须从输运方程以及$\\phi_g(x)$、$\\bar{\\phi}_g$和$\\hat{\\phi}_{f,g}$的定义开始，并遵循严格的数学步骤，不得使用任何简化公式。\n2. 实现一个程序，为每个指定的参数集计算两种情况下的$d_{f,g}$：\n   - 给定$\\alpha$的流出主导的快群情况（例如，$\\alpha$接近$1$）。\n   - $\\alpha = 0$的各向同性情况，但$\\Sigma_{a,g}$、$T$和$\\psi_0$保持不变。\n3. 对每个参数集，同时计算表面半程标流通量之比$r \\equiv \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$，以明确显示角通量分布的作用。\n\n将所有最终数值输出表示为无量纲的十进制数。输出中不需要物理单位。\n\n测试套件包含四组参数集，每组以$(\\Sigma_{a,g}, T, \\psi_0, \\alpha)$的形式给出，单位为$\\bigl(\\mathrm{cm^{-1}}, \\mathrm{cm}, \\mathrm{n\\,cm^{-2}\\,s^{-1}\\,sr^{-1}}, \\text{无量纲}\\bigr)$：\n- 情况A（理想路径）：$(0.1, 5.0, 3.0, 0.9)$。\n- 情况B（薄光学厚度）：$(0.01, 5.0, 2.0, 1.0)$。\n- 情况C（强吸收）：$(1.0, 5.0, 1.0, 0.7)$。\n- 情况D（近乎透明）：$(1.0 \\times 10^{-4}, 10.0, 1.0, 1.0)$。\n\n对于每种情况，您的程序必须按顺序计算三个输出：\n- 针对指定$\\alpha$的$d_{f,g}^{\\text{stream}}$，\n- 针对$\\alpha = 0$的$d_{f,g}^{\\text{iso}}$，\n- $r = \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按情况A、情况B、情况C和情况D的顺序排列。对于每种情况，按照上述顺序附加三个浮点数。因此，最终输出将包含十二个用逗号分隔的数字：\n$$\n\\bigl[ d_{A}^{\\text{stream}}, d_{A}^{\\text{iso}}, r_A, d_{B}^{\\text{stream}}, d_{B}^{\\text{iso}}, r_B, d_{C}^{\\text{stream}}, d_{C}^{\\text{iso}}, r_C, d_{D}^{\\text{stream}}, d_{D}^{\\text{iso}}, r_D \\bigr].\n$$",
            "solution": "该问题要求在一个简化的单维、单速、纯吸收体的中子输运问题中，推导组件非连续因子（ADF）的公式，并随后对指定情况进行数值评估。推导将从基本定义和输运方程开始，一步步进行。\n\n$g$群在$f$面上的ADF，$d_{f,g}$，定义为：\n$$\nd_{f,g} \\equiv \\frac{\\bar{\\phi}_g}{\\hat{\\phi}_{f,g}}\n$$\n其中$\\bar{\\phi}_g$是体积平均标流通量，$\\hat{\\phi}_{f,g}$是表面半程标流通量。我们关注的面是位于$x=0$的左边界。\n\n**第1步：求解中子输运方程**\n\n控制方程是单速、稳态、纯吸收且无内源的输运方程：\n$$\n\\mu \\, \\frac{\\partial \\psi_g(x,\\mu)}{\\partial x} + \\Sigma_{a,g} \\, \\psi_g(x,\\mu) = 0\n$$\n此方程适用于中子自左侧流入平板的情况，即方向余弦$\\mu \\in (0,1)$。对于固定的$\\mu$，这是一个关于空间变量$x$的一阶线性常微分方程。它可以使用特征线法或变量分离法求解。重新整理方程可得：\n$$\n\\frac{d\\psi_g}{\\psi_g} = -\\frac{\\Sigma_{a,g}}{\\mu} dx\n$$\n从边界$x'=0$到平板内某点$x$进行积分，我们得到：\n$$\n\\int_{\\psi_g(0,\\mu)}^{\\psi_g(x,\\mu)} \\frac{d\\psi_g'}{\\psi_g'} = -\\frac{\\Sigma_{a,g}}{\\mu} \\int_0^x dx'\n$$\n$$\n\\ln\\left(\\frac{\\psi_g(x,\\mu)}{\\psi_g(0,\\mu)}\\right) = -\\frac{\\Sigma_{a,g} x}{\\mu}\n$$\n求解$\\psi_g(x,\\mu)$可得解：\n$$\n\\psi_g(x,\\mu) = \\psi_g(0,\\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right)\n$$\n我们已知边界$x=0$处的入射角通量：\n$$\n\\psi_g(0,\\mu) = \\psi_0 (1 + \\alpha \\mu) \\quad \\text{for } \\mu \\in (0,1)\n$$\n将此代入解中，可得到平板内$\\mu>0$的角通量分布：\n$$\n\\psi_g(x,\\mu) = \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\quad \\text{for } \\mu \\in (0,1)\n$$\n\n**第2步：计算标流通量 $\\phi_g(x)$**\n\n标流通量$\\phi_g(x)$定义为角通量在所有立体角上的积分：\n$$\n\\phi_g(x) = \\int_{-1}^{1} \\psi_g(x,\\mu') \\, d\\mu' = \\int_0^1 \\psi_g(x,\\mu') \\, d\\mu' + \\int_{-1}^0 \\psi_g(x,\\mu') \\, d\\mu'\n$$\n对于负方向余弦（$\\mu'  0$），中子从右向左流动。$x=T$处的边界条件是真空，意味着没有中子从右侧进入：对于$\\mu'  0$，$\\psi_g(T, \\mu')=0$。由于平板内没有$\\mu'  0$的中子源（无散射或裂变），因此负$\\mu'$的角通量处处为零：对于$x \\in [0,T]$和$\\mu' \\in [-1,0)$，$\\psi_g(x, \\mu')=0$。\n\n因此，标流通量仅由$\\mu > 0$的中子决定：\n$$\n\\phi_g(x) = \\int_0^1 \\psi_g(x,\\mu) \\, d\\mu = \\int_0^1 \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\, d\\mu\n$$\n该积分可以使用指数积分函数$E_n(z) = \\int_1^\\infty t^{-n} e^{-zt} dt$来表示。通过代换$t=1/\\mu$，我们发现：\n$$\n\\phi_g(x) = \\psi_0 \\left[ E_2(\\Sigma_{a,g} x) + \\alpha E_3(\\Sigma_{a,g} x) \\right]\n$$\n\n**第3步：计算体积平均标流通量 $\\bar{\\phi}_g$**\n\n体积平均标流通量定义为：\n$$\n\\bar{\\phi}_g = \\frac{1}{T} \\int_0^T \\phi_g(x) \\, dx = \\frac{1}{T} \\int_0^T \\left[ \\int_0^1 \\psi_0 (1 + \\alpha \\mu) \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) d\\mu \\right] dx\n$$\n根据Fubini定理，我们可以交换积分顺序：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T} \\int_0^1 (1 + \\alpha \\mu) \\left[ \\int_0^T \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) dx \\right] d\\mu\n$$\n对$x$的内层积分计算结果为：\n$$\n\\int_0^T \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) dx = \\left[ -\\frac{\\mu}{\\Sigma_{a,g}} \\exp\\left(-\\frac{\\Sigma_{a,g} x}{\\mu}\\right) \\right]_0^T = \\frac{\\mu}{\\Sigma_{a,g}} \\left(1 - \\exp\\left(-\\frac{\\Sigma_{a,g} T}{\\mu}\\right)\\right)\n$$\n将此结果代回$\\bar{\\phi}_g$的表达式中：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\int_0^1 (1 + \\alpha \\mu) \\mu \\left(1 - e^{-\\Sigma_{a,g} T/\\mu}\\right) d\\mu\n$$\n令$\\tau = \\Sigma_{a,g} T$为平板的光学厚度。\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\int_0^1 (\\mu + \\alpha \\mu^2) (1 - e^{-\\tau/\\mu}) d\\mu\n$$\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\int_0^1 (\\mu + \\alpha \\mu^2) d\\mu - \\int_0^1 (\\mu + \\alpha \\mu^2) e^{-\\tau/\\mu} d\\mu \\right]\n$$\n第一项是一个简单的多项式积分：$\\int_0^1 (\\mu + \\alpha \\mu^2) d\\mu = [\\frac{\\mu^2}{2} + \\frac{\\alpha\\mu^3}{3}]_0^1 = \\frac{1}{2} + \\frac{\\alpha}{3}$。\n第二项被拆分并用指数积分表示：\n$$\n\\int_0^1 \\mu e^{-\\tau/\\mu} d\\mu = E_3(\\tau) \\quad \\text{and} \\quad \\int_0^1 \\mu^2 e^{-\\tau/\\mu} d\\mu = E_4(\\tau)\n$$\n结合这些结果，得到体积平均标流通量的最终表达式：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\left(\\frac{1}{2} + \\frac{\\alpha}{3}\\right) - \\left(E_3(\\tau) + \\alpha E_4(\\tau)\\right) \\right]\n$$\n使用恒等式$E_n(0) = 1/(n-1)$（对于$n>1$），这可以写成：\n$$\n\\bar{\\phi}_g = \\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ \\left(E_3(0) - E_3(\\tau)\\right) + \\alpha \\left(E_4(0) - E_4(\\tau)\\right) \\right]\n$$\n\n**第4步：计算表面半程标流通量 $\\hat{\\phi}_{f,g}$**\n\n在$x=0$面上的表面半程标流通量定义为：\n$$\n\\hat{\\phi}_{f,g} = \\int_0^1 \\psi_g(0,\\mu) \\, d\\mu\n$$\n使用给定的边界条件$\\psi_g(0,\\mu) = \\psi_0(1+\\alpha\\mu)$：\n$$\n\\hat{\\phi}_{f,g} = \\int_0^1 \\psi_0(1+\\alpha\\mu) \\, d\\mu = \\psi_0 \\left[ \\int_0^1 d\\mu + \\alpha \\int_0^1 \\mu \\, d\\mu \\right]\n$$\n$$\n\\hat{\\phi}_{f,g} = \\psi_0 \\left[ [\\mu]_0^1 + \\alpha \\left[\\frac{\\mu^2}{2}\\right]_0^1 \\right] = \\psi_0 \\left(1 + \\frac{\\alpha}{2}\\right)\n$$\n\n**第5步：推导ADF公式**\n\n现在我们组合$d_{f,g} = \\bar{\\phi}_g / \\hat{\\phi}_{f,g}$的公式：\n$$\nd_{f,g} = \\frac{\\frac{\\psi_0}{T \\Sigma_{a,g}} \\left[ (\\frac{1}{2} - E_3(\\Sigma_{a,g} T)) + \\alpha (\\frac{1}{3} - E_4(\\Sigma_{a,g} T)) \\right]}{\\psi_0 (1 + \\alpha/2)}\n$$\n入射通量的大小$\\psi_0$被消去，这对于线性问题是符合预期的。令$\\tau = \\Sigma_{a,g} T$。\n$$\nd_{f,g} = \\frac{1}{\\tau (1 + \\alpha/2)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + \\alpha \\left(\\frac{1}{3} - E_4(\\tau)\\right) \\right]\n$$\n这是在指定条件下ADF的通用公式。\n\n**第6步：特殊化与比率计算**\n\n问题要求计算两种情景：给定$\\alpha$的通用“流出”情况，以及$\\alpha=0$的“各向同性”情况。\n\n-   **流出情况 ($d_{f,g}^{\\text{stream}}$)**：公式为上面推导出的那个。\n    $$\n    d_{f,g}^{\\text{stream}} = \\frac{1}{\\tau (1 + \\alpha/2)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + \\alpha \\left(\\frac{1}{3} - E_4(\\tau)\\right) \\right]\n    $$\n\n-   **各向同性情况 ($d_{f,g}^{\\text{iso}}$)**：我们在通用公式中设置$\\alpha=0$。\n    $$\n    d_{f,g}^{\\text{iso}} = \\frac{1}{\\tau (1 + 0)} \\left[ \\left(\\frac{1}{2} - E_3(\\tau)\\right) + 0 \\right] = \\frac{\\frac{1}{2} - E_3(\\tau)}{\\tau}\n    $$\n\n-   **通量比 ($r$)**：表面半程标流通量之比定义为 $r \\equiv \\hat{\\phi}_{f,g}^{\\text{stream}} / \\hat{\\phi}_{f,g}^{\\text{iso}}$。\n    $$\n    \\hat{\\phi}_{f,g}^{\\text{stream}} = \\psi_0(1 + \\alpha/2)\n    $$\n    $$\n    \\hat{\\phi}_{f,g}^{\\text{iso}} = \\psi_0(1 + 0/2) = \\psi_0\n    $$\n    因此，比率$r$简化为：\n    $$\n    r = \\frac{\\psi_0 (1 + \\alpha/2)}{\\psi_0} = 1 + \\frac{\\alpha}{2}\n    $$\n这表明比率$r$除了各向异性因子$\\alpha$外，与所有其他参数无关。数值实现将基于这三个最终公式。对于$\\tau \\to 0$的极限情况，可以使用指数积分函数的泰勒级数展开来证明，$d_{f,g}^{\\text{stream}}$和$d_{f,g}^{\\text{iso}}$都趋向于1。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import expn\n\ndef solve():\n    \"\"\"\n    Computes Assembly Discontinuity Factors (ADFs) and a flux ratio\n    for a one-dimensional, one-speed neutron transport problem in a slab.\n    \"\"\"\n    \n    # The test suite consists of four parameter sets, each given as \n    # (Sigma_a, T, psi_0, alpha) in units of\n    # (cm^-1, cm, n cm^-2 s^-1 sr^-1, dimensionless).\n    test_cases = [\n        (0.1, 5.0, 3.0, 0.9),      # Case A\n        (0.01, 5.0, 2.0, 1.0),     # Case B\n        (1.0, 5.0, 1.0, 0.7),      # Case C\n        (1.0e-4, 10.0, 1.0, 1.0),  # Case D\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        sigma_a, T, psi_0, alpha = case\n        \n        # Calculate the optical thickness of the slab\n        tau = sigma_a * T\n        \n        # In the limit tau -> 0, the ADFs approach 1.\n        # This handles potential division-by-zero if tau is exactly 0.\n        if np.isclose(tau, 0.0):\n            d_stream = 1.0\n            d_iso = 1.0\n        else:\n            # Calculate ADF for the streaming-dominated case (given alpha)\n            # Formula: d_stream = (1/(tau*(1+alpha/2))) * ((1/2 - E3(tau)) + alpha*(1/3 - E4(tau)))\n            e3_tau = expn(3, tau)\n            e4_tau = expn(4, tau)\n            \n            d_stream_num = (0.5 - e3_tau) + alpha * (1./3. - e4_tau)\n            d_stream_den = tau * (1. + alpha / 2.)\n            d_stream = d_stream_num / d_stream_den\n            \n            # Calculate ADF for the isotropic case (alpha = 0)\n            # Formula: d_iso = (1/tau) * (1/2 - E3(tau))\n            d_iso_num = 0.5 - e3_tau\n            d_iso_den = tau\n            d_iso = d_iso_num / d_iso_den\n\n        # Calculate the ratio of surface half-range scalar fluxes\n        # Formula: r = 1 + alpha/2\n        r = 1. + alpha / 2.\n        \n        results.extend([d_stream, d_iso, r])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际的反应堆分析中，ADF并非从简单的解析模型中推导出来，而是通过比较低阶节块计算结果与高保真参考解来生成。本练习模拟了这一核心工作流程：您将首先使用来自一个模拟输运基准题的数据计算ADF。接着，您将应用这些计算出的因子到新的堆芯状态中以验证其准确性，并量化当堆芯条件改变时产生的残余误差。",
            "id": "4214693",
            "problem": "考虑多群反应堆堆芯模型中两个相邻燃料组件之间的一维界面。能量群 $g$ 的稳态中子平衡由多群扩散方程近似表示：\n$$-\\nabla \\cdot \\left(D_g \\nabla \\phi_g\\right) + \\Sigma_{a,g}\\,\\phi_g = S_g,$$\n以及菲克定律：\n$$\\mathbf{J}_g = - D_g \\nabla \\phi_g,$$\n其中 $D_g$ 是群扩散系数，$\\Sigma_{a,g}$ 是群宏观吸收截面，$S_g$ 是群源项，$\\phi_g$ 是标量中子通量，$\\mathbf{J}_g$ 是净流。在组件均匀化节点法中，对于半宽为 $h_A$ 和 $h_B$ 的组件 $A$ 和 $B$ 之间的平面界面，通过对每个半单元上的通量分布进行线性化，面迹通量与组件平均通量和界面净流相关联。具体来说，令组件 $A$ 的外法线指向组件 $B$，根据菲克定律和线性半单元梯度近似，可以得到在界面上 $A$ 侧的面迹通量满足：\n$$\\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g,$$\n在 $B$ 侧的面迹通量满足：\n$$\\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g,$$\n其中 $\\bar{\\phi}_{A,g}$ 和 $\\bar{\\phi}_{B,g}$ 是组件平均通量，$J_g$ 是从 $A$ 指向 $B$ 的净流。\n\n将面 $f \\in \\{A,B\\}$ 和能量群 $g$ 的组件不连续因子 (ADF) 定义为使修正后的节点面迹通量等于高阶输运计算得到的参考面迹通量的乘法修正因子：\n$$d_{f,g} := \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}},$$\n其中 $\\hat{\\Phi}^{\\text{trans}}_{f,g}$ 表示在面 $f$ 上能量群 $g$ 的输运计算面迹通量，$\\hat{\\phi}^{\\text{diff}}_{f,g}$ 表示相应的未修正节点扩散面迹通量。\n\n针对二维七能量群基准问题 (C5G7) 等参考输运基准来验证 $d_{f,g}$，可以简化为两个能量群下的一维界面一致性检查。在此问题中，您将：\n- 根据提供的数据集，应用上述定义，使用输运计算的面迹通量和从组件平均值与净流导出的节点扩散面迹通量来计算 $d_{f,g}$。\n- 对于三种预测情景，将计算出的 $d_{f,g}$ 应用于新的节点扩散面迹通量，形成修正后的节点面迹通量，并将输运计算的对面通量比率与修正后节点扩散计算的比率进行比较。具体来说，对于每个能量群 $g$，计算输运比率：\n$$R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}},$$\n和修正后的节点扩散比率：\n$$R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}.$$\n然后，通过跨能量群的最大绝对比率差来量化每个情景的残余失配：\n$$\\varepsilon = \\max_{g} \\left| R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} \\right|.$$\n\n本问题中所有类通量物理量均已归一化且无量纲。几何半宽 $h_A,h_B$ 和扩散系数 $D_{A,g},D_{B,g}$ 被视为与上述线性化迹关系一致的无量纲参数。本问题不涉及角度。您的程序必须从头开始实现上述计算，并按照末尾指定的方式生成一个整合了三个情景结果的单行输出。\n\n参考数据集（仅用于计算 $d_{f,g}$）：\n- 几何：$h_A = 20$, $h_B = 20$。\n- 扩散系数：$D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$。\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$。\n- 界面净流：$J_{1} = 0.02$, $J_{2} = 0.005$（从 $A$ 到 $B$ 为正）。\n- 界面处输运计算的面迹通量：\n  - 在面 $A$ 上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$。\n  - 在面 $B$ 上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$。\n\n预测情景（使用从参考数据集计算出的 $d_{f,g}$ 进行验证；每个情景提供新的组件平均值、净流以及用于比较的输运计算面迹通量）：\n\n情景 1（理想路径：与参考条件相同）：\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$。\n- 界面净流：$J_{1} = 0.02$, $J_{2} = 0.005$。\n- 输运计算的面迹通量：\n  - 在面 $A$ 上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$。\n  - 在面 $B$ 上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$。\n\n情景 2（边缘情况：净流为零）：\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$。\n- 界面净流：$J_{1} = 0.0$, $J_{2} = 0.0$。\n- 输运计算的面迹通量：\n  - 在面 $A$ 上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$。\n  - 在面 $B$ 上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$。\n\n情景 3（边界情况：大净流和强梯度）：\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$。\n- 界面净流：$J_{1} = 0.06$, $J_{2} = 0.02$。\n- 输运计算的面迹通量：\n  - 在面 $A$ 上：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$。\n  - 在面 $B$ 上：$\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$。\n\n您的任务是实现一个程序，该程序：\n- 计算参考数据集的 $\\hat{\\phi}^{\\text{diff}}_{A,g}$ 和 $\\hat{\\phi}^{\\text{diff}}_{B,g}$，然后使用输运计算的参考通量评估 $d_{A,g}$ 和 $d_{B,g}$。\n- 对于每个预测情景，根据给定的组件平均值和净流计算 $\\hat{\\phi}^{\\text{diff}}_{A,g}$ 和 $\\hat{\\phi}^{\\text{diff}}_{B,g}$，使用先前计算的 $d_{f,g}$ 构建 $R^{\\text{corr}}_{g}$，并与提供的输运数据中的 $R^{\\text{trans}}_{g}$进行比较。\n- 按上述定义，返回每个情景的残余失配 $\\varepsilon$。\n\n最终输出格式规范：\n- 您的程序应生成单行输出，其中包含三个情景的残余失配，形式为逗号分隔的列表，并用方括号括起来，每个浮点数四舍五入到六位小数，严格遵循以下格式：\n$$[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3].$$",
            "solution": "该问题被评估为有效的，因为它在科学上基于核反应堆物理学原理，特别是节点扩散方法，并且在数学上是适定的，提供了所有必要的信息。\n\n该问题要求根据一个参考数据集计算组件不连续因子 (ADF)，然后评估它们在三种不同预测情景中的有效性。有效性由一个残余失配参数 $\\varepsilon$ 来量化。求解过程主要分两个阶段：首先，计算 ADF；其次，在每个情景中应用这些 ADF 来计算相应的 $\\varepsilon$。\n\n**第一部分：计算组件不连续因子 ($d_{f,g}$)**\n\nADF 是从提供的参考数据集中导出的常数。它们弥合了低保真度节点扩散模型与高保真度输运解在组件界面处的差距。\n\n对于组件 $A$ 和组件 $B$ 之间的界面，节点扩散面迹通量 $\\hat{\\phi}^{\\text{diff}}_{f,g}$ 的基本关系是：\n$$ \\hat{\\phi}^{\\text{diff}}_{A,g} = \\bar{\\phi}_{A,g} - \\frac{h_A}{2 D_{A,g}} J_g $$\n$$ \\hat{\\phi}^{\\text{diff}}_{B,g} = \\bar{\\phi}_{B,g} + \\frac{h_B}{2 D_{B,g}} J_g $$\n其中 $g$ 是能量群索引 ($g \\in \\{1, 2\\}$)，$\\bar{\\phi}_{f,g}$ 是组件平均通量，$h_f$ 是组件半宽，$D_{f,g}$ 是扩散系数，$J_g$ 是从 $A$ 到 $B$ 的净流。\n\nADF, $d_{f,g}$ 定义为输运计算的面迹通量 $\\hat{\\Phi}^{\\text{trans}}_{f,g}$ 与节点扩散面迹通量之比：\n$$ d_{f,g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{f,g}}{\\hat{\\phi}^{\\text{diff}}_{f,g}} $$\n\n我们使用参考数据集来计算四个 ADF ($d_{A,1}, d_{A,2}, d_{B,1}, d_{B,2}$)。\n参考数据：\n- 几何：$h_A = 20$, $h_B = 20$。\n- 扩散系数：$D_{A,1} = 1.2$, $D_{A,2} = 0.5$, $D_{B,1} = 1.0$, $D_{B,2} = 0.4$。\n- 组件平均通量：$\\bar{\\phi}_{A,1} = 1.0$, $\\bar{\\phi}_{A,2} = 0.3$, $\\bar{\\phi}_{B,1} = 0.95$, $\\bar{\\phi}_{B,2} = 0.31$。\n- 界面净流：$J_{1} = 0.02$, $J_{2} = 0.005$。\n- 输运通量：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.875$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.208$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.20$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.450$。\n\n对于能量群 $g=1$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.0 - \\frac{20}{2 \\times 1.2} \\times 0.02 = 1.0 - 0.166\\overline{6} \\approx 0.833\\overline{3}$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.95 + \\frac{20}{2 \\times 1.0} \\times 0.02 = 0.95 + 0.2 = 1.15$\n- $d_{A,1} = \\frac{0.875}{0.833\\overline{3}} = 1.05$\n- $d_{B,1} = \\frac{1.20}{1.15} \\approx 1.043478$\n\n对于能量群 $g=2$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.3 - \\frac{20}{2 \\times 0.5} \\times 0.005 = 0.3 - 0.1 = 0.2$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.31 + \\frac{20}{2 \\times 0.4} \\times 0.005 = 0.31 + 0.125 = 0.435$\n- $d_{A,2} = \\frac{0.208}{0.2} = 1.04$\n- $d_{B,2} = \\frac{0.450}{0.435} \\approx 1.034483$\n\n这四个 ADF 值现已固定，并将用于所有后续的预测情景。\n\n**第二部分：评估预测情景**\n\n对于每个情景，我们计算残余失配 $\\varepsilon = \\max_{g} | R^{\\text{corr}}_{g} - R^{\\text{trans}}_{g} |$，其中：\n- 输运比率：$R^{\\text{trans}}_{g} = \\frac{\\hat{\\Phi}^{\\text{trans}}_{B,g}}{\\hat{\\Phi}^{\\text{trans}}_{A,g}}$\n- 修正后的节点比率：$R^{\\text{corr}}_{g} = \\frac{d_{B,g}\\,\\hat{\\phi}^{\\text{diff}}_{B,g}}{d_{A,g}\\,\\hat{\\phi}^{\\text{diff}}_{A,g}}$\n\n几何参数 ($h_A, h_B$) 和扩散系数 ($D_A, D_B$) 在所有情景中保持不变。\n\n**情景 1：参考条件**\n此情景的数据与参考数据集完全相同。根据构造，修正后的节点通量将精确匹配输运通量：$d_{f,g} \\hat{\\phi}^{\\text{diff}}_{f,g} = \\hat{\\Phi}^{\\text{trans}}_{f,g}$。\n因此，对于两个能量群 $g=1$ 和 $g=2$，$R^{\\text{corr}}_{g} = R^{\\text{trans}}_{g}$。\n两个能量群的绝对差均为 $0$。\n- $\\varepsilon_1 = \\max(|0|, |0|) = 0.0$\n\n**情景 2：净流为零**\n数据：$\\bar{\\phi}_{A,1} = 1.05$, $\\bar{\\phi}_{A,2} = 0.32$, $\\bar{\\phi}_{B,1} = 0.98$, $\\bar{\\phi}_{B,2} = 0.30$。$J_1=0.0, J_2=0.0$。\n输运通量：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 1.12105$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.342784$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.012381913$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.30413894$。\n\n对于群 $g=1$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 1.05 - 0 = 1.05$; $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.98 + 0 = 0.98$\n- $R^{\\text{trans}}_{1} = \\frac{1.012381913}{1.12105} \\approx 0.903067$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 0.98}{d_{A,1} \\times 1.05} = \\frac{1.043478 \\times 0.98}{1.05 \\times 1.05} \\approx 0.927536$\n- 差值：$|0.927536 - 0.903067| \\approx 0.024469$\n\n对于群 $g=2$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.32 - 0 = 0.32$; $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.30 + 0 = 0.30$\n- $R^{\\text{trans}}_{2} = \\frac{0.30413894}{0.342784} \\approx 0.887255$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.30}{d_{A,2} \\times 0.32} = \\frac{1.034483 \\times 0.30}{1.04 \\times 0.32} \\approx 0.932501$\n- 差值：$|0.932501 - 0.887255| \\approx 0.045246$\n- $\\varepsilon_2 = \\max(0.024469, 0.045246) \\approx 0.045246$\n\n**情景 3：大净流**\n数据：$\\bar{\\phi}_{A,1} = 0.97$, $\\bar{\\phi}_{A,2} = 0.50$, $\\bar{\\phi}_{B,1} = 0.90$, $\\bar{\\phi}_{B,2} = 0.35$。$J_1=0.06, J_2=0.02$。\n输运通量：$\\hat{\\Phi}^{\\text{trans}}_{A,1} = 0.498435$, $\\hat{\\Phi}^{\\text{trans}}_{A,2} = 0.1092$, $\\hat{\\Phi}^{\\text{trans}}_{B,1} = 1.5182609$, $\\hat{\\Phi}^{\\text{trans}}_{B,2} = 0.8353448$。\n\n对于群 $g=1$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,1} = 0.97 - \\frac{20}{2 \\times 1.2} \\times 0.06 = 0.97 - 0.5 = 0.47$\n- $\\hat{\\phi}^{\\text{diff}}_{B,1} = 0.90 + \\frac{20}{2 \\times 1.0} \\times 0.06 = 0.90 + 0.6 = 1.50$\n- $R^{\\text{trans}}_{1} = \\frac{1.5182609}{0.498435} \\approx 3.046031$\n- $R^{\\text{corr}}_{1} = \\frac{d_{B,1} \\times 1.50}{d_{A,1} \\times 0.47} = \\frac{1.043478 \\times 1.50}{1.05 \\times 0.47} \\approx 3.171350$\n- 差值：$|3.171350 - 3.046031| \\approx 0.125319$\n\n对于群 $g=2$：\n- $\\hat{\\phi}^{\\text{diff}}_{A,2} = 0.50 - \\frac{20}{2 \\times 0.5} \\times 0.02 = 0.50 - 0.4 = 0.10$\n- $\\hat{\\phi}^{\\text{diff}}_{B,2} = 0.35 + \\frac{20}{2 \\times 0.4} \\times 0.02 = 0.35 + 0.5 = 0.85$\n- $R^{\\text{trans}}_{2} = \\frac{0.8353448}{0.1092} \\approx 7.649678$\n- $R^{\\text{corr}}_{2} = \\frac{d_{B,2} \\times 0.85}{d_{A,2} \\times 0.10} = \\frac{1.034483 \\times 0.85}{1.04 \\times 0.10} \\approx 8.454913$\n- 差值：$|8.454913 - 7.649678| \\approx 0.805235$\n- $\\varepsilon_3 = \\max(0.125319, 0.805235) \\approx 0.805236$\n\n总而言之，三个情景的残余失配为 $\\varepsilon_1 = 0.0$, $\\varepsilon_2 \\approx 0.045246$ 和 $\\varepsilon_3 \\approx 0.805236$。这些结果表明，当 ADF 被视为常数时，其准确性会随着系统状态（通量和流）偏离用于生成它们时的参考状态而降低。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes Assembly Discontinuity Factors (ADFs) from a reference dataset and\n    evaluates their performance in three prediction scenarios by calculating the\n    residual mismatch epsilon.\n    \"\"\"\n    \n    # --- Data Definition ---\n\n    # Common geometric and material properties\n    hA = 20.0\n    hB = 20.0\n    DA = [1.2, 0.5]\n    DB = [1.0, 0.4]\n\n    # Reference dataset for ADF calculation\n    ref_data = {\n        'phi_bar_A': [1.0, 0.3],\n        'phi_bar_B': [0.95, 0.31],\n        'J': [0.02, 0.005],\n        'phi_trans_A': [0.875, 0.208],\n        'phi_trans_B': [1.20, 0.450]\n    }\n\n    # Prediction scenarios\n    test_cases = [\n        # Scenario 1 (happy path: identical to the reference conditions)\n        {\n            'phi_bar_A': [1.0, 0.3], 'phi_bar_B': [0.95, 0.31],\n            'J': [0.02, 0.005],\n            'phi_trans_A': [0.875, 0.208], 'phi_trans_B': [1.20, 0.450]\n        },\n        # Scenario 2 (edge case: zero net currents)\n        {\n            'phi_bar_A': [1.05, 0.32], 'phi_bar_B': [0.98, 0.30],\n            'J': [0.0, 0.0],\n            'phi_trans_A': [1.12105, 0.342784], 'phi_trans_B': [1.012381913, 0.30413894]\n        },\n        # Scenario 3 (boundary case: large net currents and strong gradients)\n        {\n            'phi_bar_A': [0.97, 0.50], 'phi_bar_B': [0.90, 0.35],\n            'J': [0.06, 0.02],\n            'phi_trans_A': [0.498435, 0.1092], 'phi_trans_B': [1.5182609, 0.8353448]\n        }\n    ]\n\n    # --- Step 1: Calculate ADFs (d_f,g) from the Reference Dataset ---\n\n    # Pre-calculate geometric/material factors\n    # The arrays correspond to energy groups [g=1, g=2] i.e. index 0 and 1\n    factors_A = [hA / (2 * D) for D in DA]\n    factors_B = [hB / (2 * D) for D in DB]\n\n    # Calculate nodal diffusion face-trace fluxes for the reference case\n    phi_diff_A_ref = [\n        ref_data['phi_bar_A'][g] - factors_A[g] * ref_data['J'][g] for g in range(2)\n    ]\n    phi_diff_B_ref = [\n        ref_data['phi_bar_B'][g] + factors_B[g] * ref_data['J'][g] for g in range(2)\n    ]\n\n    # Calculate the Assembly Discontinuity Factors (ADFs)\n    d_A = [ ref_data['phi_trans_A'][g] / phi_diff_A_ref[g] for g in range(2) ]\n    d_B = [ ref_data['phi_trans_B'][g] / phi_diff_B_ref[g] for g in range(2) ]\n\n    # --- Step 2: Process Each Prediction Scenario ---\n    \n    results = []\n    for case in test_cases:\n        ratio_diffs = []\n        for g in range(2): # Iterate through energy groups g=1 (index 0) and g=2 (index 1)\n            \n            # Calculate nodal diffusion face-trace fluxes for the current scenario\n            phi_diff_A_scen = case['phi_bar_A'][g] - factors_A[g] * case['J'][g]\n            phi_diff_B_scen = case['phi_bar_B'][g] + factors_B[g] * case['J'][g]\n\n            # Calculate the transport-computed ratio\n            R_trans = case['phi_trans_B'][g] / case['phi_trans_A'][g]\n\n            # Calculate the ADF-corrected nodal diffusion ratio\n            num_corr = d_B[g] * phi_diff_B_scen\n            den_corr = d_A[g] * phi_diff_A_scen\n            \n            # This check is for robustness; given the problem data, den_corr will not be zero.\n            if den_corr == 0:\n                # Handle division by zero based on problem physics, e.g., set to infinity or NaN\n                # For this problem, it's not expected.\n                raise ValueError(\"Denominator for R_corr is zero.\")\n\n            R_corr = num_corr / den_corr\n            \n            # Calculate and store the absolute difference\n            ratio_diffs.append(abs(R_corr - R_trans))\n        \n        # The residual mismatch epsilon is the maximum difference across energy groups\n        epsilon = max(ratio_diffs)\n        results.append(epsilon)\n\n    # --- Final Output Formatting ---\n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join([f'{res:.6f}' for res in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一套有效的ADF应具备鲁棒性，这意味着即使底层的节块求解器为了计算效率而使用不同程度的近似，它们也应保持准确。这最后一个实践将探讨ADF相对于节块展开法（NEM）中使用的多项式阶数的鲁棒性概念。通过评估一组固定的参考ADF在不同多项式近似下再现正确界面通量比的能力，您将学会量化并理解均匀化方法在实际应用中的一个关键挑战。",
            "id": "4214698",
            "problem": "考虑用于均匀化节块求解器的单个反应堆组件的一维板坯表示。设空间坐标为 $x \\in [-h/2,h/2]$，并定义归一化坐标 $\\xi = 2x/h \\in [-1,1]$。在非均匀组件内部，给定能群 $g$ 的标量中子通量形状表示为 $\\phi_{\\mathrm{het},g}(x)$，并假定其为正且足够光滑。均匀化节块求解器基于节块展开法（NEM）对组件内的通量进行多项式表示，该方法使用最高 $p$ 阶的勒让德多项式 $P_n(\\xi)$，因此重建的形状为 $\\phi_{\\mathrm{proj},g}^{(p)}(\\xi) = \\sum_{n=0}^{p} a_{n,g}^{(p)} P_n(\\xi)$。对于能群 $g$ 在界面 $f$ 上的组件不连续因子（ADF），记作 $d_{f,g}$，其定义旨在通过缩放组件交界面上的均匀化节块界面通量来再现非均匀界面通量。具体来说，对于位于 $\\xi=-1$ 的左界面 $f=L$ 和位于 $\\xi=+1$ 的右界面 $f=R$，ADF 满足 $d_{L,g}\\,\\phi_{\\mathrm{hom},g}(-1)=\\phi_{\\mathrm{het},g}(-1)$ 和 $d_{R,g}\\,\\phi_{\\mathrm{hom},g}(+1)=\\phi_{\\mathrm{het},g}(+1)$，其中 $\\phi_{\\mathrm{hom},g}$ 表示由节块法重建的界面通量。\n\n以单群扩散形式的中子平衡作为基本出发点：在扩散系数为 $D_g$、吸收截面为 $\\Sigma_{a,g}$ 的均匀板坯中，标量通量在适当的边界条件下满足方程 $-D_g\\,\\frac{d^2 \\phi_g}{dx^2} + \\Sigma_{a,g}\\,\\phi_g = S_g(x)$，其中 $S_g(x)$ 是一个源项。在非均匀组件中，$D_g$、$\\Sigma_{a,g}$ 和 $S_g(x)$ 的空间变化会产生非平凡的组件内通量形状 $\\phi_{\\mathrm{het},g}(x)$。ADF 的目的是修正均匀化表示的界面值，以便节块求解器能够再现非均匀界面通量及其跨界面的比率。\n\n在此问题中，通过研究节块多项式阶数 $p$ 的变化如何影响非均匀界面通量比的再现，来分析 $d_{f,g}$ 对节块求解器中网格粗化的鲁棒性。请使用以下定义和步骤：\n\n- 将能群 $g$ 在 $x \\in [-h/2,h/2]$ 上的非均匀通量形状定义为\n$$\n\\phi_{\\mathrm{het},g}(x) = \\exp\\!\\Big(\\alpha_g \\frac{x}{h}\\Big)\\,\\Big(1 + \\beta_g \\cos\\!\\Big(\\pi \\frac{x}{h}\\Big) + \\gamma_g \\Big(\\frac{x}{h}\\Big)^2\\Big),\n$$\n并将其归一化，使其在 $x \\in [-h/2,h/2]$ 上的单元平均值为1。此归一化确保 $\\frac{1}{h}\\int_{-h/2}^{h/2} \\phi_{\\mathrm{het},g}(x)\\,dx = 1$。\n\n- 使用标准的 $L^2$ 内积，通过将归一化的非均匀形状最小二乘投影到 $\\xi \\in [-1,1]$ 上由 $\\{P_0(\\xi),P_1(\\xi),\\dots,P_p(\\xi)\\}$ 张成的空间中，来构造勒让德投影 $\\phi_{\\mathrm{proj},g}^{(p)}(\\xi)$。确保投影后的形状在投影所隐含的 $L^2$ 意义上得到一致的归一化。\n\n- 设参考 ADF 在一个高的多项式阶数 $p_{\\mathrm{ref}}$ 下计算得出：\n$$\nd_{L,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(-1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(-1)}, \\quad\nd_{R,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(+1)}.\n$$\n\n- 将能群 $g$ 的真实非均匀界面通量比定义为\n$$\nr_{g}^{\\mathrm{true}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{het},g}(-1)}.\n$$\n\n- 对于每个较低的多项式阶数 $p \\in \\mathbb{N}$，将参考 ADF 应用于 $p$ 阶投影，定义经 ADF 校正的预测比率为\n$$\nr_{g}^{\\mathrm{pred}}(p) = \\frac{d_{R,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(+1)}{d_{L,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(-1)}.\n$$\n\n- 对于给定的参数集和多项式阶数列表 $\\{p\\}$，将鲁棒性度量定义为再现界面通量比的最坏情况相对误差，\n$$\n\\mathcal{R}_g = \\max_{p \\in \\mathcal{P}} \\left| \\frac{r_{g}^{\\mathrm{pred}}(p) - r_{g}^{\\mathrm{true}}}{r_{g}^{\\mathrm{true}}} \\right|.\n$$\n较小的 $\\mathcal{R}_g$ 值表示 ADF 对节块多项式阶数的粗化具有鲁棒性。\n\n请使用在 $\\xi \\in [-1,1]$ 上的高斯-勒让德求积法进行数值实现，并使用足够多的点数以确保投影的稳定性。在每种情况下，将单个能群 $g$ 视为给定。由于通量形状经过归一化后是无量纲的，因此不需要物理单位。\n\n您的任务是编写一个完整、可运行的程序，为以下每个测试用例计算 $\\mathcal{R}_g$。对于每个用例，使用由 $h$ 隐含的指定组件半宽度 $h/2$，并使用给定的多项式阶数列表进行粗化分析。所有用例均使用单一参考阶数 $p_{\\mathrm{ref}}=9$。\n\n测试套件：\n- 用例 1（基准非均匀性）：$h=1$, $\\alpha=0.8$, $\\beta=0.2$, $\\gamma=0.1$, $\\mathcal{P}=\\{0,1,2,3\\}$。\n- 用例 2（近乎平坦的形状边界）：$h=1$, $\\alpha=0.0$, $\\beta=0.0$, $\\gamma=0.0$, $\\mathcal{P}=\\{0,1,2,3\\}$。\n- 用例 3（具有中等振荡的强指数偏斜）：$h=1$, $\\alpha=3.0$, $\\beta=0.3$, $\\gamma=0.2$, $\\mathcal{P}=\\{0,1,3,5\\}$。\n- 用例 4（中等振幅内的纯振荡）：$h=1$, $\\alpha=0.0$, $\\beta=0.4$, $\\gamma=0.0$, $\\mathcal{P}=\\{0,1,2,4\\}$。\n\n对于每个用例，计算如上定义的单个鲁棒性度量 $\\mathcal{R}_g$，并将其四舍五入到 $6$ 位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个用例的鲁棒性度量，形式为方括号括起来的逗号分隔浮点数列表，例如 $[\\mathcal{R}_1,\\mathcal{R}_2,\\mathcal{R}_3,\\mathcal{R}_4]$，其中每个 $\\mathcal{R}_i$ 都按要求四舍五入到 $6$ 位小数。",
            "solution": "## 问题验证\n\n### 步骤 1：提取已知信息\n\n-   **空间域**：一维板坯，$x \\in [-h/2, h/2]$。\n-   **归一化坐标**：$\\xi = 2x/h \\in [-1, 1]$。\n-   **非均匀通量形状**：$\\phi_{\\mathrm{het},g}(x) = \\exp(\\alpha_g \\frac{x}{h}) (1 + \\beta_g \\cos(\\pi \\frac{x}{h}) + \\gamma_g (\\frac{x}{h})^2)$。\n-   **通量归一化**：非均匀通量必须归一化，使其单元平均值为1：$\\frac{1}{h}\\int_{-h/2}^{h/2} \\phi_{\\mathrm{het},g}(x)\\,dx = 1$。\n-   **投影通量形状**：使用最高 $p$ 阶的勒让德多项式 $P_n(\\xi)$ 的节块展开法（NEM）表示：$\\phi_{\\mathrm{proj},g}^{(p)}(\\xi) = \\sum_{n=0}^{p} a_{n,g}^{(p)} P_n(\\xi)$。\n-   **投影方法**：系数 $a_{n,g}^{(p)}$ 通过在 $\\xi \\in [-1,1]$ 上使用标准的 $L^2$ 内积，将归一化的非均匀形状最小二乘投影到由 $\\{P_0(\\xi), \\dots, P_p(\\xi)\\}$ 张成的空间中来确定。\n-   **组件不连续因子（ADF）定义**：在界面 $L$ ($\\xi=-1$) 和 $R$ ($\\xi=+1$) 处，$d_{L,g}\\,\\phi_{\\mathrm{hom},g}(-1)=\\phi_{\\mathrm{het},g}(-1)$ 和 $d_{R,g}\\,\\phi_{\\mathrm{hom},g}(+1)=\\phi_{\\mathrm{het},g}(+1)$。\n-   **参考多项式阶数**：$p_{\\mathrm{ref}}=9$。\n-   **参考 ADF**：$d_{L,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(-1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(-1)}$ 和 $d_{R,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{proj},g}^{(p_{\\mathrm{ref}})}(+1)}$。\n-   **真实界面通量比**：$r_{g}^{\\mathrm{true}} = \\frac{\\phi_{\\mathrm{het},g}(+1)}{\\phi_{\\mathrm{het},g}(-1)}$。\n-   **经 ADF 校正的预测比率**：$r_{g}^{\\mathrm{pred}}(p) = \\frac{d_{R,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(+1)}{d_{L,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(-1)}$。\n-   **鲁棒性度量**：$\\mathcal{R}_g = \\max_{p \\in \\mathcal{P}} \\left| \\frac{r_{g}^{\\mathrm{pred}}(p) - r_{g}^{\\mathrm{true}}}{r_{g}^{\\mathrm{true}}} \\right|$。\n-   **数值方法**：使用高斯-勒让德求积法。\n-   **测试套件**：\n    -   用例 1: $h=1, \\alpha=0.8, \\beta=0.2, \\gamma=0.1, \\mathcal{P}=\\{0,1,2,3\\}$。\n    -   用例 2: $h=1, \\alpha=0.0, \\beta=0.0, \\gamma=0.0, \\mathcal{P}=\\{0,1,2,3\\}$。\n    -   用例 3: $h=1, \\alpha=3.0, \\beta=0.3, \\gamma=0.2, \\mathcal{P}=\\{0,1,3,5\\}$。\n    -   用例 4: $h=1, \\alpha=0.0, \\beta=0.4, \\gamma=0.0, \\mathcal{P}=\\{0,1,2,4\\}$。\n-   **输出要求**：为每个用例计算 $\\mathcal{R}_g$，并四舍五入到 $6$ 位小数。\n\n### 步骤 2：使用提取的已知信息进行验证\n\n根据已建立的标准对问题进行验证：\n\n1.  **科学基础**：该问题牢固地植根于核反应堆物理领域，特别是反应堆模拟的数值方法。均匀化节块法、组件不连续因子（ADF）、勒让德多项式展开（节块展开法）和中子扩散等概念都是标准且成熟的。使用解析函数表示非均匀通量是验证数值方法和分析其性质的常用技术。\n2.  **适定性**：问题定义了一个清晰、明确且确定性的计算过程。从通量归一化和投影到比率计算和最终误差度量的每个步骤都得到了精确的规定。测试用例所需的所有参数和数据均已提供，确保可以计算出唯一的解。\n3.  **客观性**：问题以精确的技术语言陈述，不含主观或基于意见的陈述。定义和度量都是定量的和客观的。\n4.  **完整性**：问题是自洽的。它提供了通量的解析形式、四个不同用例所需的所有参数、待测试的特定多项式阶数、参考阶数以及待计算度量的精确定义。使用高斯-勒让德求积法的建议为实现提供了充分的指导。\n5.  **未检测到其他缺陷**：问题不违反任何其他标准。它并非微不足道（需要非显而易见的数值计算），是可形式化的，并且可以通过计算进行科学验证。所提供的参数对于一个测试问题而言是物理上合理的。\n\n### 步骤 3：结论与行动\n\n该问题是**有效的**。它代表了一个与核工程领域相关的、适定且具有科学基础的数值分析任务。将提供完整的解决方案。\n\n## 解决方案\n\n该解决方案需要实现一个数值程序，为几个测试用例计算鲁棒性度量 $\\mathcal{R}_g$。该程序的核心涉及将给定的非均匀通量形状投影到勒让德多项式基上，然后评估在多项式阶数粗化下组件不连续因子（ADF）的准确性。\n\n首先，我们用归一化坐标 $\\xi = 2x/h$ 来表示非均匀通量。将 $x/h = \\xi/2$ 代入给定表达式，得到：\n$$\n\\phi_{\\mathrm{het},g}(\\xi) = \\exp\\left(\\frac{\\alpha_g \\xi}{2}\\right)\\left(1 + \\beta_g \\cos\\left(\\frac{\\pi \\xi}{2}\\right) + \\gamma_g \\left(\\frac{\\xi}{2}\\right)^2\\right)\n$$\n该函数定义在区间 $\\xi \\in [-1, 1]$ 上。\n\n问题要求将此通量归一化，使其单元平均值为1。单元平均值由 $\\frac{1}{h}\\int_{-h/2}^{h/2} \\phi_{\\mathrm{het},g}(x)\\,dx$ 给出。变换变量为 $\\xi$，其中 $dx = \\frac{h}{2}d\\xi$，平均值变为：\n$$\n\\text{Avg}(\\phi) = \\frac{1}{h}\\int_{-1}^{1} \\phi_{\\mathrm{het},g}(\\xi) \\frac{h}{2}d\\xi = \\frac{1}{2}\\int_{-1}^{1} \\phi_{\\mathrm{het},g}(\\xi) d\\xi\n$$\n设未归一化的通量为 $\\phi_{\\mathrm{unnorm},g}(\\xi)$。我们定义归一化通量 $\\phi_{\\mathrm{norm},g}(\\xi) = C_g \\phi_{\\mathrm{unnorm},g}(\\xi)$，使其平均值为 $1$。因此，归一化常数 $C_g$ 为：\n$$\nC_g = \\frac{1}{\\frac{1}{2}\\int_{-1}^{1} \\phi_{\\mathrm{unnorm},g}(\\xi) d\\xi} = \\frac{2}{\\int_{-1}^{1} \\phi_{\\mathrm{unnorm},g}(\\xi) d\\xi}\n$$\n该积分将使用在 $\\xi \\in [-1,1]$ 上的高斯-勒让德求积法进行数值计算。\n\n接下来，我们构造归一化通量 $\\phi_{\\mathrm{norm},g}(\\xi)$ 的勒让德投影。阶数为 $p$ 的投影通量 $\\phi_{\\mathrm{proj},g}^{(p)}(\\xi)$ 由以下级数给出：\n$$\n\\phi_{\\mathrm{proj},g}^{(p)}(\\xi) = \\sum_{n=0}^{p} a_{n,g}^{(p)} P_n(\\xi)\n$$\n系数 $a_{n,g}^{(p)}$ 通过标准的 $L^2$ 投影公式求得，该公式利用了勒让德多项式的正交性，即 $\\int_{-1}^1 P_n(\\xi) P_m(\\xi) d\\xi = \\frac{2}{2n+1}\\delta_{nm}$：\n$$\na_{n,g}^{(p)} = \\frac{\\int_{-1}^1 \\phi_{\\mathrm{norm},g}(\\xi) P_n(\\xi) d\\xi}{\\int_{-1}^1 P_n^2(\\xi) d\\xi} = \\frac{2n+1}{2} \\int_{-1}^1 \\phi_{\\mathrm{norm},g}(\\xi) P_n(\\xi) d\\xi\n$$\n这些积分也使用高斯-勒让德求积法进行计算。使用足够高的求积点数以确保对于非多项式被积函数的准确性。\n\n确定系数后，我们可以在边界 $\\xi = -1$ 和 $\\xi = +1$ 处评估投影通量。利用性质 $P_n(-1) = (-1)^n$ 和 $P_n(+1) = 1$：\n$$\n\\phi_{\\mathrm{proj},g}^{(p)}(-1) = \\sum_{n=0}^{p} a_{n,g}^{(p)} (-1)^n \\quad \\text{和} \\quad \\phi_{\\mathrm{proj},g}^{(p)}(+1) = \\sum_{n=0}^{p} a_{n,g}^{(p)}\n$$\n\n对每个测试用例，主要计算过程如下：\n1.  使用给定的参数 $\\alpha_g, \\beta_g, \\gamma_g$ 定义未归一化的通量 $\\phi_{\\mathrm{unnorm},g}(\\xi)$。\n2.  计算归一化常数 $C_g$ 并定义归一化通量 $\\phi_{\\mathrm{norm},g}(\\xi)$。\n3.  计算非均匀界面通量 $\\phi_{\\mathrm{norm},g}(-1)$ 和 $\\phi_{\\mathrm{norm},g}(+1)$。\n4.  计算“真实”界面通量比：$r_{g}^{\\mathrm{true}} = \\phi_{\\mathrm{norm},g}(+1) / \\phi_{\\mathrm{norm},g}(-1)$。\n5.  对于 $p_{\\mathrm{ref}}=9$，计算参考投影通量在边界处的值：$\\phi_{\\mathrm{proj},g}^{(9)}(-1)$ 和 $\\phi_{\\mathrm{proj},g}^{(9)}(+1)$。\n6.  计算参考 ADF：\n    $$\n    d_{L,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{norm},g}(-1)}{\\phi_{\\mathrm{proj},g}^{(9)}(-1)} \\quad \\text{和} \\quad\n    d_{R,g}^{\\mathrm{ref}} = \\frac{\\phi_{\\mathrm{norm},g}(+1)}{\\phi_{\\mathrm{proj},g}^{(9)}(+1)}\n    $$\n7.  将最大相对误差的变量初始化为 $0$。\n8.  遍历指定集合 $\\mathcal{P}$ 中的每个多项式阶数 $p$：\n    a.  计算当前阶数 $p$ 下投影通量在边界处的值：$\\phi_{\\mathrm{proj},g}^{(p)}(-1)$ 和 $\\phi_{\\mathrm{proj},g}^{(p)}(+1)$。\n    b.  计算经 ADF 校正的预测比率：\n    $$\n    r_{g}^{\\mathrm{pred}}(p) = \\frac{d_{R,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(+1)}{d_{L,g}^{\\mathrm{ref}}\\,\\phi_{\\mathrm{proj},g}^{(p)}(-1)}\n    $$\n    c.  计算相对误差：$\\left| (r_{g}^{\\mathrm{pred}}(p) - r_{g}^{\\mathrm{true}}) / r_{g}^{\\mathrm{true}} \\right|$。\n    d.  如果当前误差更大，则更新最大相对误差。\n9.  最终的最大相对误差即为该测试用例的鲁棒性度量 $\\mathcal{R}_g$。\n\n对所提供的四个测试用例中的每一个都实施此过程，并收集得到的 $\\mathcal{R}_g$ 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import eval_legendre\nfrom numpy.polynomial.legendre import leggauss\n\ndef get_projected_flux_at_endpoints(p_order, phi_norm_func, quad_points, quad_weights):\n    \"\"\"\n    Calculates the Legendre-projected flux at the endpoints xi = -1 and xi = +1.\n\n    Args:\n        p_order (int): The maximum order of the Legendre polynomial expansion.\n        phi_norm_func (callable): The normalized heterogeneous flux function phi(xi).\n        quad_points (np.ndarray): Gauss-Legendre quadrature points.\n        quad_weights (np.ndarray): Gauss-Legendre quadrature weights.\n\n    Returns:\n        tuple[float, float]: A tuple containing the projected flux at xi=-1 and xi=+1.\n    \"\"\"\n    phi_proj_L = 0.0\n    phi_proj_R = 0.0\n    \n    phi_vals_at_quad = phi_norm_func(quad_points)\n\n    for n in range(p_order + 1):\n        # Evaluate P_n(xi) at all quadrature points\n        Pn_vals_at_quad = eval_legendre(n, quad_points)\n        \n        # Compute the integral for the coefficient a_n\n        integrand = phi_vals_at_quad * Pn_vals_at_quad\n        integral_val = np.sum(integrand * quad_weights)\n        \n        # Calculate the coefficient a_n\n        a_n = (2 * n + 1) / 2.0 * integral_val\n        \n        # Accumulate the series sum at xi = -1 and xi = +1\n        # P_n(-1) = (-1)^n, P_n(+1) = 1\n        phi_proj_L += a_n * ((-1)**n)\n        phi_proj_R += a_n\n        \n    return phi_proj_L, phi_proj_R\n\ndef compute_robustness_metric(h, alpha, beta, gamma, P_orders, p_ref=9, n_quad_points=200):\n    \"\"\"\n    Computes the robustness metric R_g for a single test case.\n    \n    Args:\n        h (float): Assembly width.\n        alpha (float): Parameter for the exponential term of the flux shape.\n        beta (float): Parameter for the cosine term of the flux shape.\n        gamma (float): Parameter for the quadratic term of the flux shape.\n        P_orders (list[int]): List of polynomial orders for coarsening analysis.\n        p_ref (int): The reference polynomial order for ADF calculation.\n        n_quad_points (int): The number of points for Gauss-Legendre quadrature.\n\n    Returns:\n        float: The computed robustness metric R_g.\n    \"\"\"\n    # 1. Define the unnormalized heterogeneous flux function phi(xi)\n    # x/h = xi/2\n    def phi_unnorm_func(xi):\n        return np.exp(alpha * xi / 2.0) * (1.0 + beta * np.cos(np.pi * xi / 2.0) + gamma * (xi / 2.0)**2)\n\n    # 2. Setup quadrature and compute normalization constant\n    quad_points, quad_weights = leggauss(n_quad_points)\n    \n    integral_phi_unnorm = np.sum(phi_unnorm_func(quad_points) * quad_weights)\n    \n    # Avoid division by zero if integral is pathologically zero\n    if np.abs(integral_phi_unnorm)  1e-15:\n        # For the case alpha=beta=gamma=0, integral is 2, h=1.\n        # This branch is for analytical robustness, not expected to be hit by tests.\n        C_g = 1.0 \n    else:\n        C_g = 2.0 / integral_phi_unnorm\n    \n    def phi_norm_func(xi):\n        return C_g * phi_unnorm_func(xi)\n\n    # 3. Calculate true heterogeneous face fluxes and their ratio\n    phi_het_L = phi_norm_func(-1.0)\n    phi_het_R = phi_norm_func(1.0)\n    \n    if np.abs(phi_het_L)  1e-15:\n        # For the provided test cases, phi_het_L is always non-zero.\n        raise ValueError(\"Heterogeneous flux at left face is zero, cannot compute ratio.\")\n        \n    r_true = phi_het_R / phi_het_L\n\n    # 4. Calculate reference ADFs using p_ref\n    phi_proj_ref_L, phi_proj_ref_R = get_projected_flux_at_endpoints(\n        p_ref, phi_norm_func, quad_points, quad_weights\n    )\n\n    if np.abs(phi_proj_ref_L)  1e-15 or np.abs(phi_proj_ref_R)  1e-15:\n        # This case might occur if the projection is zero at an endpoint, \n        # but is unlikely for a high-order projection of a smooth function.\n        # Fallback for case 2 (flat flux): proj is 1 everywhere.\n        if np.abs(phi_proj_ref_L)  1e-15: phi_proj_ref_L=1.0\n        if np.abs(phi_proj_ref_R)  1e-15: phi_proj_ref_R=1.0\n\n    d_L_ref = phi_het_L / phi_proj_ref_L\n    d_R_ref = phi_het_R / phi_proj_ref_R\n\n    # 5. Compute the robustness metric over the specified polynomial orders\n    max_rel_error = 0.0\n\n    for p in P_orders:\n        phi_proj_p_L, phi_proj_p_R = get_projected_flux_at_endpoints(\n            p, phi_norm_func, quad_points, quad_weights\n        )\n        \n        # Denominator for r_pred\n        denom = d_L_ref * phi_proj_p_L\n        if np.abs(denom)  1e-15:\n            # Special handling for symmetric cases (alpha=0) where proj_p_L can be zero\n            # if the flux is even and p is odd.\n            # Example: p=1 proj of even func has a1=0, phi_proj(xi)=1.\n            # However, with ADF correction, this should cancel out.\n            # If denom is zero, numerator should also be zero.\n             if np.abs(d_R_ref * phi_proj_p_R)  1e-15:\n                 r_pred = r_true # If both are zero, ratio is indeterminate but physically should be the true ratio\n             else:\n                 r_pred = np.inf # Should not happen in a well-behaved problem\n        else:\n            r_pred = (d_R_ref * phi_proj_p_R) / denom\n\n        if np.abs(r_true)  1e-15:\n            rel_error = np.abs(r_pred - r_true)\n        else:\n            rel_error = np.abs((r_pred - r_true) / r_true)\n        \n        if rel_error > max_rel_error:\n            max_rel_error = rel_error\n            \n    return max_rel_error\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h, alpha, beta, gamma, P_orders)\n        (1.0, 0.8, 0.2, 0.1, [0, 1, 2, 3]),\n        (1.0, 0.0, 0.0, 0.0, [0, 1, 2, 3]),\n        (1.0, 3.0, 0.3, 0.2, [0, 1, 3, 5]),\n        (1.0, 0.0, 0.4, 0.0, [0, 1, 2, 4]),\n    ]\n\n    results = []\n    for case in test_cases:\n        h, alpha, beta, gamma, P_orders = case\n        result = compute_robustness_metric(h, alpha, beta, gamma, P_orders)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}