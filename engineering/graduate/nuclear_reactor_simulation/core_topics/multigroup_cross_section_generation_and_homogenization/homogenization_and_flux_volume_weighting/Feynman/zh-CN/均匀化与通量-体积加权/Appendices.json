{
    "hands_on_practices": [
        {
            "introduction": "理论上，最精确的均匀化参数是通过使用真实的、精细的通量分布作为权重函数来获得的。本练习将这一抽象概念付诸实践。您将首先求解一个简单分层介质中的精确中子通量分布，然后利用该精确解来计算通量-体积加权的均匀化扩散系数，从而将通量加权的概念建立在坚实的计算基础上。",
            "id": "4230767",
            "problem": "考虑一个总厚度为 $L$ 的一维平板中的稳态单群中子扩散，该平板由两个均匀层组成，界面位于 $x=a$ 处。标量中子通量记为 $\\phi(x)$，扩散系数记为 $D(x)$，吸收截面记为 $\\Sigma_{a}(x)$，均匀各向同性体积源记为 $S(x)$。假设采用以下物理上一致的模型：\n- 控制方程为一维空间中的单群扩散方程，\n$$- \\frac{d}{dx}\\!\\left(D(x)\\,\\frac{d\\phi}{dx}\\right) + \\Sigma_{a}(x)\\,\\phi(x) = S(x).$$\n- 介质是分层的：对于 $0 \\leq x \\leq a$（区域1），$D(x)=D_{1}$ 且 $\\Sigma_{a}(x)=\\Sigma_{a,1}$；对于 $a \\leq x \\leq L$（区域2），$D(x)=D_{2}$ 且 $\\Sigma_{a}(x)=\\Sigma_{a,2}$。\n- 每个区域的扩散系数通过标准定义 $D_{i}=\\frac{1}{3\\,\\Sigma_{tr,i}}$（其中 $i\\in\\{1,2\\}$）与中子输运截面相关。\n- 两个区域的源是均匀且相等的，$S(x)=S$，并且两个区域的吸收都可以忽略不计，$\\Sigma_{a,1}=\\Sigma_{a,2}=0$。\n- 平板两端为真空，在此模型中通过零标量通量边界条件 $\\phi(0)=0$ 和 $\\phi(L)=0$ 来模拟。\n- 在 $x=a$ 处的界面条件强制通量和净流的连续性：$\\phi_{1}(a)=\\phi_{2}(a)$ 和 $D_{1}\\,\\phi_{1}'(a)=D_{2}\\,\\phi_{2}'(a)$。\n\n从控制方程和这些条件出发，求出区域1和区域2中的精确分段解 $\\phi(x)$，通过施加边界和界面条件确定积分常数，然后计算由堆芯均匀化原理定义的通量-体积加权均匀化扩散系数 $D^{\\text{hom}}$\n$$D^{\\text{hom}} = \\frac{\\displaystyle \\int_{0}^{L} D(x)\\,\\phi(x)\\,dx}{\\displaystyle \\int_{0}^{L} \\phi(x)\\,dx}.$$\n使用以下数值参数：$L=60\\,\\text{cm}$，$a=20\\,\\text{cm}$，$\\Sigma_{tr,1}=1.0\\,\\text{cm}^{-1}$，$\\Sigma_{tr,2}=0.5\\,\\text{cm}^{-1}$。以厘米为单位表示 $D^{\\text{hom}}$ 的最终值，并将答案四舍五入到四位有效数字。",
            "solution": "用户要求我解决一个双区域平板的一维单群中子扩散问题，然后计算通量-体积加权的均匀化扩散系数。\n\n### 第1步：提取已知条件\n- 控制方程：$- \\frac{d}{dx}\\!\\left(D(x)\\,\\frac{d\\phi}{dx}\\right) + \\Sigma_{a}(x)\\,\\phi(x) = S(x)$\n- 区域1 ($0 \\leq x \\leq a$): $D(x)=D_{1}$, $\\Sigma_{a}(x)=\\Sigma_{a,1}$\n- 区域2 ($a \\leq x \\leq L$): $D(x)=D_{2}$, $\\Sigma_{a}(x)=\\Sigma_{a,2}$\n- 扩散系数定义：$D_{i}=\\frac{1}{3\\,\\Sigma_{tr,i}}$ 对于 $i\\in\\{1,2\\}$\n- 源：$S(x)=S$ (均匀常数)\n- 吸收：$\\Sigma_{a,1}=\\Sigma_{a,2}=0$\n- 边界条件：$\\phi(0)=0$, $\\phi(L)=0$\n- 界面条件 ($x=a$): $\\phi_{1}(a)=\\phi_{2}(a)$ (通量连续性), $D_{1}\\,\\phi_{1}'(a)=D_{2}\\,\\phi_{2}'(a)$ (流连续性)\n- 均匀化扩散系数定义：$D^{\\text{hom}} = \\frac{\\displaystyle \\int_{0}^{L} D(x)\\,\\phi(x)\\,dx}{\\displaystyle \\int_{0}^{L} \\phi(x)\\,dx}$\n- 数值参数：\n  - $L=60\\,\\text{cm}$\n  - $a=20\\,\\text{cm}$\n  - $\\Sigma_{tr,1}=1.0\\,\\text{cm}^{-1}$\n  - $\\Sigma_{tr,2}=0.5\\,\\text{cm}^{-1}$\n\n### 第2步：使用提取的已知条件进行验证\n这个问题是核反应堆物理学中的一个标准教科书练习题。\n- **科学依据**：该问题使用单群中子扩散方程，这在适当的假设下是反应堆物理学中一个有效的物理模型。定义、边界条件（真空对应零通量）和界面条件（通量和流的连续性）都是标准的。\n- **适定性**：该问题是一个二阶线性常微分方程，具有足够的边界和界面条件来确定唯一解。均匀化系数的定义是明确的。\n- **客观性**：该问题使用精确的数学和物理术语陈述，没有主观性。\n- **完整性**：为得到唯一解提供了所有必要的参数和条件。\n\n### 第3步：结论和行动\n该问题被认为是**有效的**。我将继续进行求解。\n\n### 求解推导\n\n控制单群中子扩散方程为：\n$$-\\frac{d}{dx}\\left(D(x)\\frac{d\\phi}{dx}\\right) + \\Sigma_a(x)\\phi(x) = S(x)$$\n鉴于吸收截面 $\\Sigma_a(x)=0$ 且源是均匀的 $S(x)=S$，方程简化为：\n$$-\\frac{d}{dx}\\left(D(x)\\frac{d\\phi}{dx}\\right) = S$$\n由于扩散系数 $D(x)$ 是分段常数，我们在每个区域分别求解方程。\n\n**区域1：$0 \\le x \\le a$**\n在此区域，$D(x)=D_1$。方程变为 $-D_1\\frac{d^2\\phi_1}{dx^2} = S$。\n对 $x$ 积分两次，得到标量通量 $\\phi_1(x)$ 的通解：\n$$\\phi_1(x) = -\\frac{S}{2D_1}x^2 + A_1x + B_1$$\n其中 $A_1$ 和 $B_1$ 是积分常数。\n\n**区域2：$a \\le x \\le L$**\n在此区域，$D(x)=D_2$。方程变为 $-D_2\\frac{d^2\\phi_2}{dx^2} = S$。\n标量通量 $\\phi_2(x)$ 的通解为：\n$$\\phi_2(x) = -\\frac{S}{2D_2}x^2 + A_2x + B_2$$\n其中 $A_2$ 和 $B_2$ 是积分常数。\n\n我们有四个未知常数（$A_1, B_1, A_2, B_2$），需要通过边界和界面条件来确定。\n\n1.  **$x=0$ 处的边界条件**：$\\phi(0)=0$。\n    将此条件应用于区域1的解：\n    $\\phi_1(0) = -\\frac{S}{2D_1}(0)^2 + A_1(0) + B_1 = 0 \\implies B_1 = 0$。\n    所以，$\\phi_1(x) = -\\frac{S}{2D_1}x^2 + A_1x$。\n\n2.  **$x=L$ 处的边界条件**：$\\phi(L)=0$。\n    将此条件应用于区域2的解：\n    $\\phi_2(L) = -\\frac{S}{2D_2}L^2 + A_2L + B_2 = 0 \\implies B_2 = \\frac{S}{2D_2}L^2 - A_2L$。\n\n3.  **$x=a$ 处的界面条件**：通量连续性，$\\phi_1(a) = \\phi_2(a)$。\n    $$-\\frac{S}{2D_1}a^2 + A_1a = -\\frac{S}{2D_2}a^2 + A_2a + B_2$$\n\n4.  **$x=a$ 处的界面条件**：流连续性，$D_1\\phi_1'(a) = D_2\\phi_2'(a)$。\n    首先，我们求导数：\n    $\\phi_1'(x) = -\\frac{S}{D_1}x + A_1$\n    $\\phi_2'(x) = -\\frac{S}{D_2}x + A_2$\n    应用该条件：\n    $D_1\\left(-\\frac{S}{D_1}a + A_1\\right) = D_2\\left(-\\frac{S}{D_2}a + A_2\\right)$\n    $-Sa + D_1A_1 = -Sa + D_2A_2 \\implies D_1A_1 = D_2A_2$。\n\n现在，我们求解这个方程组来确定常数。根据条件4，我们有 $A_2 = \\frac{D_1}{D_2}A_1$。将这个关系式以及由条件2得到的 $B_2$ 的表达式代入通量连续性方程（条件3）：\n$$-\\frac{S}{2D_1}a^2 + A_1a = -\\frac{S}{2D_2}a^2 + \\left(\\frac{D_1}{D_2}A_1\\right)a + \\left(\\frac{S}{2D_2}L^2 - A_2L\\right)$$\n$$-\\frac{S}{2D_1}a^2 + A_1a = -\\frac{S}{2D_2}a^2 + \\frac{D_1}{D_2}A_1a + \\frac{S}{2D_2}L^2 - \\left(\\frac{D_1}{D_2}A_1\\right)L$$\n合并含有 $A_1$ 的项：\n$$A_1\\left(a - \\frac{D_1}{D_2}a + \\frac{D_1}{D_2}L\\right) = \\frac{S}{2D_1}a^2 - \\frac{S}{2D_2}a^2 + \\frac{S}{2D_2}L^2$$\n$$A_1\\left(\\frac{aD_2 - aD_1 + LD_1}{D_2}\\right) = \\frac{S}{2}\\left(\\frac{a^2D_2 - a^2D_1 + L^2D_1}{D_1D_2}\\right)$$\n求解 $A_1$：\n$$A_1 = \\frac{S}{2D_1}\\frac{a^2(D_2-D_1) + L^2D_1}{a(D_2-D_1) + LD_1}$$\n任意的源强度 $S$ 是通量的一个比例因子，在最终计算 $D^{\\text{hom}}$ 时会被消掉。为了计算方便，我们可以设 $S=1$。\n\n**数值计算**\n\n首先，计算扩散系数：\n给定 $\\Sigma_{tr,1}=1.0\\,\\text{cm}^{-1}$ 和 $\\Sigma_{tr,2}=0.5\\,\\text{cm}^{-1}$。\n$D_1 = \\frac{1}{3\\Sigma_{tr,1}} = \\frac{1}{3 \\times 1.0} = \\frac{1}{3}\\,\\text{cm}$。\n$D_2 = \\frac{1}{3\\Sigma_{tr,2}} = \\frac{1}{3 \\times 0.5} = \\frac{2}{3}\\,\\text{cm}$。\n\n其他参数：$L=60\\,\\text{cm}$，$a=20\\,\\text{cm}$。\n设 $S=1$。我们计算 $A_1$ 所需的各项：\n$D_2 - D_1 = \\frac{2}{3} - \\frac{1}{3} = \\frac{1}{3}\\,\\text{cm}$。\n$a(D_2-D_1) + LD_1 = 20(\\frac{1}{3}) + 60(\\frac{1}{3}) = \\frac{20+60}{3} = \\frac{80}{3}\\,\\text{cm}^2$。\n$a^2(D_2-D_1) + L^2D_1 = (20)^2(\\frac{1}{3}) + (60)^2(\\frac{1}{3}) = \\frac{400+3600}{3} = \\frac{4000}{3}\\,\\text{cm}^3$。\n\n现在计算常数：\n$A_1 = \\frac{1}{2(\\frac{1}{3})} \\frac{4000/3}{80/3} = \\frac{3}{2} \\cdot \\frac{4000}{80} = \\frac{3}{2} \\cdot 50 = 75$。\n$A_2 = \\frac{D_1}{D_2}A_1 = \\frac{1/3}{2/3} \\cdot 75 = \\frac{1}{2} \\cdot 75 = 37.5$。\n$B_2 = \\frac{S L^2}{2D_2} - A_2L = \\frac{1 \\cdot 60^2}{2(2/3)} - (37.5) \\cdot 60 = \\frac{3600}{4/3} - 2250 = 2700 - 2250 = 450$。\n\n分段通量解（当 $S=1$ 时）为：\n对于 $0 \\le x \\le 20$：\n$\\phi_1(x) = -\\frac{1}{2(1/3)}x^2 + 75x = -1.5x^2 + 75x$。\n对于 $20 \\le x \\le 60$：\n$\\phi_2(x) = -\\frac{1}{2(2/3)}x^2 + 37.5x + 450 = -0.75x^2 + 37.5x + 450$。\n\n**均匀化计算**\n均匀化扩散系数为：\n$D^{\\text{hom}} = \\frac{\\int_{0}^{L} D(x)\\phi(x)dx}{\\int_{0}^{L} \\phi(x)dx} = \\frac{\\int_{0}^{a} D_1\\phi_1(x)dx + \\int_{a}^{L} D_2\\phi_2(x)dx}{\\int_{0}^{a} \\phi_1(x)dx + \\int_{a}^{L} \\phi_2(x)dx}$。\n\n计算分母积分 $I_D = \\int_0^L \\phi(x)dx$：\n$I_{D,1} = \\int_{0}^{20} (-1.5x^2 + 75x) dx = \\left[-0.5x^3 + 37.5x^2\\right]_{0}^{20} = -0.5(20)^3 + 37.5(20)^2 = -4000 + 15000 = 11000$。\n$I_{D,2} = \\int_{20}^{60} (-0.75x^2 + 37.5x + 450) dx = \\left[-0.25x^3 + 18.75x^2 + 450x\\right]_{20}^{60}$。\n在 $x=60$ 处的值：$-0.25(60)^3 + 18.75(60)^2 + 450(60) = -54000 + 67500 + 27000 = 40500$。\n在 $x=20$ 处的值：$-0.25(20)^3 + 18.75(20)^2 + 450(20) = -2000 + 7500 + 9000 = 14500$。\n$I_{D,2} = 40500 - 14500 = 26000$。\n$I_D = I_{D,1} + I_{D,2} = 11000 + 26000 = 37000$。\n\n计算分子积分 $I_N = \\int_0^L D(x)\\phi(x)dx$：\n$I_{N,1} = \\int_{0}^{20} D_1\\phi_1(x)dx = \\int_{0}^{20} \\frac{1}{3}(-1.5x^2 + 75x)dx = \\int_{0}^{20} (-0.5x^2 + 25x)dx$。\n$I_{N,1} = \\left[-\\frac{0.5}{3}x^3 + 12.5x^2\\right]_{0}^{20} = -\\frac{1}{6}(20)^3 + 12.5(20)^2 = -\\frac{8000}{6} + 5000 = -\\frac{4000}{3} + \\frac{15000}{3} = \\frac{11000}{3}$。\n$I_{N,2} = \\int_{20}^{60} D_2\\phi_2(x)dx = \\int_{20}^{60} \\frac{2}{3}(-0.75x^2 + 37.5x + 450)dx = \\int_{20}^{60} (-0.5x^2 + 25x + 300)dx$。\n$I_{N,2} = \\left[-\\frac{0.5}{3}x^3 + 12.5x^2 + 300x\\right]_{20}^{60}$。\n在 $x=60$ 处的值：$-\\frac{1}{6}(60)^3 + 12.5(60)^2 + 300(60) = -36000 + 45000 + 18000 = 27000$。\n在 $x=20$ 处的值：$-\\frac{1}{6}(20)^3 + 12.5(20)^2 + 300(20) = -\\frac{4000}{3} + 5000 + 6000 = \\frac{-4000+33000}{3} = \\frac{29000}{3}$。\n$I_{N,2} = 27000 - \\frac{29000}{3} = \\frac{81000-29000}{3} = \\frac{52000}{3}$。\n$I_N = I_{N,1} + I_{N,2} = \\frac{11000}{3} + \\frac{52000}{3} = \\frac{63000}{3} = 21000$。\n\n最后，计算均匀化扩散系数：\n$$D^{\\text{hom}} = \\frac{I_N}{I_D} = \\frac{21000}{37000} = \\frac{21}{37}$$\n$D^{\\text{hom}} \\approx 0.56756756...$\n四舍五入到四位有效数字，我们得到 $0.5676$。单位是 cm。",
            "answer": "$$\\boxed{0.5676}$$"
        },
        {
            "introduction": "为什么我们不简单地使用体积平均进行均匀化？本练习通过构建一个特定场景，直接比较体积加权和通量-体积加权这两种均匀化方案，来回答这个问题。您将发现，即使这些方案能保持总吸收率等物理量不变，它们对中子泄漏等关键物理过程的预测却可能大相径庭，这突显了为保持目标物理特性而选择正确权重函数的重要性。",
            "id": "4230760",
            "problem": "考虑一个总长度为 $L$ 的一维非均匀节点，该节点由两个厚度相等（均为 $L/2$）、横截面积相同（均为 $A$）的相邻层组成。在每一层 $i \\in \\{1,2\\}$ 内，稳态中子扩散近似成立，其菲克定律 (Fick's law) 为 $J = -D \\frac{d\\phi}{dx}$，吸收反应率密度为 $r_{a} = \\Sigma_{a} \\phi$。节点内部没有固定源，仅有泄漏和吸收项参与平衡。细网格材料数据和细网格标量通量（假设在每层内是均匀的）如下：\n- 第1层：扩散系数 $D_{1} = 1.0 \\ \\text{cm}$，吸收截面 $\\Sigma_{a,1} = 0.05 \\ \\text{cm}^{-1}$，标量通量 $\\phi_{1} = 1.0$。\n- 第2层：扩散系数 $D_{2} = 0.2 \\ \\text{cm}$，吸收截面 $\\Sigma_{a,2} = 0.05 \\ \\text{cm}^{-1}$，标量通量 $\\phi_{2} = 2.0$。\n假设粗网格的节点未知数是节点平均标量通量，其定义为细网格标量通量的体积平均值。考虑两种均匀化策略：\n- 体积加权均匀化：均匀化参数等于其在节点上的体积平均值。\n- 通量-体积加权均匀化：均匀化参数等于其以细网格标量通量和体积为权重的平均值。\n节点边界标量通量给定为左侧面 $\\phi_{L} = 1.0$，右侧面 $\\phi_{R} = 2.0$。对于粗网格泄漏封闭关系，使用 $(\\phi_{R} - \\phi_{L})/L$ 来近似整个节点上的面平均梯度，并使用菲克定律和相应的均匀化扩散系数 $D^{H}$ 来计算向右的界面流。根据给定数据：\n1. 从第一性原理和定义出发，证明为何两种均匀化方法对此节点产生的总吸收反应率相同。\n2. 计算每种均匀化方法预测的向右界面流，并确定通量-体积加权预测值与体积加权预测值之比。\n将最终答案表示为等于该比率的一个小数，四舍五入到四位有效数字。答案是无量纲的，请勿包含单位。",
            "solution": "问题陈述已经过验证，具有科学依据、适定且客观。这是核反应堆物理中一个关于均匀化理论的标准问题。所有必要的数据和定义都已提供，不存在矛盾或含糊之处。\n\n问题分为两部分。第一部分要求证明为什么两种不同的均匀化方法对该节点产生的总吸收反应率相同。第二部分要求计算这两种方法预测的界面流之比。\n\n**第一部分：总吸收率相同的证明**\n\n节点内的总吸收反应率，记为 $R_a$，定义为吸收反应率密度 $r_a(x) = \\Sigma_a(x) \\phi(x)$ 在节点总体积 $V$ 上的体积积分。\n$$R_a = \\int_V \\Sigma_a(x) \\phi(x) dV$$\n节点由第1层和第2层这两个相邻层组成，每层的体积均为 $V_1 = V_2 = A(L/2) = V/2$。材料性质和标量通量在每层内均为常数。因此，该积分可以写为两层之和：\n$$R_a = \\int_{V_1} \\Sigma_{a,1} \\phi_1 dV_1 + \\int_{V_2} \\Sigma_{a,2} \\phi_2 dV_2 = \\Sigma_{a,1} \\phi_1 V_1 + \\Sigma_{a,2} \\phi_2 V_2$$\n在节点的均匀化模型中，总吸收率 $R_a^H$ 是使用均匀化吸收截面 $\\Sigma_a^H$、节点平均标量通量 $\\bar{\\phi}$ 和节点总体积 $V$ 计算的：\n$$R_a^H = \\Sigma_a^H \\bar{\\phi} V$$\n问题要求证明由体积加权均匀化预测的总吸收率 $R_{a,V}^H$ 与由通量-体积加权均匀化预测的总吸收率 $R_{a,FV}^H$ 相同。\n$$R_{a,V}^H = \\Sigma_{a,V}^H \\bar{\\phi} V \\quad \\text{和} \\quad R_{a,FV}^H = \\Sigma_{a,FV}^H \\bar{\\phi} V$$\n为了证明它们相等，我们必须证明均匀化吸收截面 $\\Sigma_{a,V}^H$ 和 $\\Sigma_{a,FV}^H$ 相等。\n\n首先，我们根据定义求体积加权均匀化截面 $\\Sigma_{a,V}^H$：\n$$\\Sigma_{a,V}^H = \\frac{\\int_V \\Sigma_a(x) dV}{\\int_V dV} = \\frac{\\Sigma_{a,1} V_1 + \\Sigma_{a,2} V_2}{V_1 + V_2}$$\n由于 $V_1 = V_2 = V/2$，上式简化为：\n$$\\Sigma_{a,V}^H = \\frac{\\Sigma_{a,1} (V/2) + \\Sigma_{a,2} (V/2)}{V} = \\frac{1}{2}(\\Sigma_{a,1} + \\Sigma_{a,2})$$\n问题给出的数据为 $\\Sigma_{a,1} = 0.05 \\ \\text{cm}^{-1}$ 和 $\\Sigma_{a,2} = 0.05 \\ \\text{cm}^{-1}$。由于这些值相同，我们令 $\\Sigma_a^{\\text{const}} = 0.05 \\ \\text{cm}^{-1}$。\n$$\\Sigma_{a,V}^H = \\frac{1}{2}(\\Sigma_a^{\\text{const}} + \\Sigma_a^{\\text{const}}) = \\Sigma_a^{\\text{const}}$$\n\n其次，我们根据定义求通量-体积加权均匀化截面 $\\Sigma_{a,FV}^H$：\n$$\\Sigma_{a,FV}^H = \\frac{\\int_V \\Sigma_a(x) \\phi(x) dV}{\\int_V \\phi(x) dV} = \\frac{\\Sigma_{a,1} \\phi_1 V_1 + \\Sigma_{a,2} \\phi_2 V_2}{\\phi_1 V_1 + \\phi_2 V_2}$$\n由于 $V_1 = V_2 = V/2$，上式简化为：\n$$\\Sigma_{a,FV}^H = \\frac{\\Sigma_{a,1} \\phi_1 (V/2) + \\Sigma_{a,2} \\phi_2 (V/2)}{\\phi_1 (V/2) + \\phi_2 (V/2)} = \\frac{\\Sigma_{a,1} \\phi_1 + \\Sigma_{a,2} \\phi_2}{\\phi_1 + \\phi_2}$$\n代入给定数据，其中 $\\Sigma_{a,1} = \\Sigma_{a,2} = \\Sigma_a^{\\text{const}}$：\n$$\\Sigma_{a,FV}^H = \\frac{\\Sigma_a^{\\text{const}} \\phi_1 + \\Sigma_a^{\\text{const}} \\phi_2}{\\phi_1 + \\phi_2} = \\frac{\\Sigma_a^{\\text{const}}(\\phi_1 + \\phi_2)}{\\phi_1 + \\phi_2} = \\Sigma_a^{\\text{const}}$$\n\n我们已经证明了 $\\Sigma_{a,V}^H = \\Sigma_{a,FV}^H = \\Sigma_a^{\\text{const}}$。因为两种均匀化方法都得出了完全相同的均匀化吸收截面，并且两个模型都使用相同的节点平均通量 $\\bar{\\phi}$ 和总体积 $V$，所以必然得出预测的总吸收反应率是相同的：\n$$R_{a,V}^H = (\\Sigma_a^{\\text{const}}) \\bar{\\phi} V \\quad \\text{和} \\quad R_{a,FV}^H = (\\Sigma_a^{\\text{const}}) \\bar{\\phi} V \\implies R_{a,V}^H = R_{a,FV}^H$$\n这种相等性是吸收截面在整个节点内空间均匀的直接结果。\n\n**第二部分：界面流之比的计算**\n\n粗网格向右的界面流 $J_R^H$ 由菲克定律的近似形式给出：\n$$J_R^H = -D^H \\frac{\\phi_R - \\phi_L}{L}$$\n其中 $D^H$ 是均匀化扩散系数。我们需要为两种均匀化方案计算此电流并求出它们的比率。\n\n令 $J_{R,V}^H$ 为体积加权法得到的电流，$J_{R,FV}^H$ 为通量-体积加权法得到的电流。\n$$J_{R,V}^H = -D_V^H \\frac{\\phi_R - \\phi_L}{L}$$\n$$J_{R,FV}^H = -D_{FV}^H \\frac{\\phi_R - \\phi_L}{L}$$\n该比率为：\n$$\\frac{J_{R,FV}^H}{J_{R,V}^H} = \\frac{-D_{FV}^H (\\phi_R - \\phi_L)/L}{-D_V^H (\\phi_R - \\phi_L)/L} = \\frac{D_{FV}^H}{D_V^H}$$\n我们现在必须计算均匀化扩散系数 $D_V^H$ 和 $D_{FV}^H$。\n\n体积加权扩散系数 $D_V^H$ 为：\n$$D_V^H = \\frac{D_1 V_1 + D_2 V_2}{V_1 + V_2} = \\frac{1}{2}(D_1 + D_2)$$\n使用给定值 $D_1 = 1.0 \\ \\text{cm}$ 和 $D_2 = 0.2 \\ \\text{cm}$：\n$$D_V^H = \\frac{1}{2}(1.0 + 0.2) = \\frac{1.2}{2} = 0.6$$\n\n通量-体积加权扩散系数 $D_{FV}^H$ 为：\n$$D_{FV}^H = \\frac{D_1 \\phi_1 V_1 + D_2 \\phi_2 V_2}{\\phi_1 V_1 + \\phi_2 V_2} = \\frac{D_1 \\phi_1 + D_2 \\phi_2}{\\phi_1 + \\phi_2}$$\n使用给定值 $D_1 = 1.0 \\ \\text{cm}$、$\\phi_1 = 1.0$、$D_2 = 0.2 \\ \\text{cm}$ 和 $\\phi_2 = 2.0$：\n$$D_{FV}^H = \\frac{(1.0)(1.0) + (0.2)(2.0)}{1.0 + 2.0} = \\frac{1.0 + 0.4}{3.0} = \\frac{1.4}{3.0}$$\n\n最后，我们计算扩散系数之比：\n$$\\text{比率} = \\frac{D_{FV}^H}{D_V^H} = \\frac{1.4 / 3.0}{0.6} = \\frac{1.4}{3.0 \\times 0.6} = \\frac{1.4}{1.8} = \\frac{14}{18} = \\frac{7}{9}$$\n问题要求将此比率表示为四舍五入到四位有效数字的小数。\n$$\\frac{7}{9} \\approx 0.777777...$$\n四舍五入到四位有效数字得到 $0.7778$。",
            "answer": "$$\\boxed{0.7778}$$"
        },
        {
            "introduction": "均匀化方法是强大的近似工具，但它们存在局限性，尤其是在材料性质差异巨大的情况下。这项高级实践将带您从应用公式转向开发批判性评估工具。您将实现一个算法，用于计算功率峰因子和通量形状失配等关键诊断指标，以识别那些简单均匀化方法可能失效的案例，从而掌握反应堆模拟专家必备的一项关键技能。",
            "id": "4230729",
            "problem": "您的任务是构建一个诊断算法，用于评估在具有强烈区域内非均匀性的核反应堆栅元均匀化过程中，Superhomogenization (SPH) 修正的潜在失效模式。目标是根据中子输运和反应率守恒的第一性原理，构建并实施计算，以量化与均匀化相关的差异。重点是基于局部功率峰值指数和通量形状失配度量的诊断方法。\n\n请从以下基本定义开始，其中定义了将要使用的物理量和数学量：\n\n- 子区域 $i$ 中能量群 $g$ 的中子通量为 $ \\phi_{i,g} $。\n- 子区域 $i$ 中能量群 $g$ 的宏观裂变截面为 $ \\Sigma_{f,i,g} $。\n- 子区域体积为 $ V_i $，总体积为 $ V_{\\text{tot}} = \\sum_i V_i $。\n- 能量群 $g$ 通量在整个栅元上的体积积分为 $ \\Phi_g = \\sum_i V_i \\phi_{i,g} $。\n- 能量群 $g$ 的栅元平均通量为 $ \\bar{\\phi}_g = \\Phi_g / V_{\\text{tot}} $。\n- 能量群 $g$ 中按体积加权的均匀化裂变截面为\n$$\n\\Sigma^{\\text{vol}}_{f,g} = \\frac{\\sum_i V_i \\Sigma_{f,i,g}}{V_{\\text{tot}}}.\n$$\n- 能量群 $g$ 中按通量-体积加权的均匀化裂变截面为\n$$\n\\Sigma^{\\text{fv}}_{f,g} = \\frac{\\sum_i V_i \\phi_{i,g} \\Sigma_{f,i,g}}{\\sum_i V_i \\phi_{i,g}} = \\frac{\\sum_i V_i \\phi_{i,g} \\Sigma_{f,i,g}}{\\Phi_g},\n$$\n条件是 $ \\Phi_g > 0 $，如果 $ \\Phi_g = 0 $，则取值等于 $ \\Sigma^{\\text{vol}}_{f,g} $。\n- 能量群 $g$ 中在细网格上对整个栅元聚合的反应率为\n$$\nR^{\\text{fine}}_g = \\sum_i V_i \\Sigma_{f,i,g} \\phi_{i,g}.\n$$\n- 使用 $ \\Sigma^{\\text{vol}}_{f,g} $ 和均匀粗网通量 $ \\bar{\\phi}_g $ 的粗网模型预测的反应率为\n$$\nR^{\\text{coarse}}_g = \\Sigma^{\\text{vol}}_{f,g} \\sum_i V_i \\bar{\\phi}_g = \\Sigma^{\\text{vol}}_{f,g} \\Phi_g.\n$$\n- 能量群 $g$ 中的 Superhomogenization (SPH) 因子，定义为在粗网通量下缩放体积加权的宏观截面以强制保持反应率守恒，其表达式为\n$$\nF_g = \n\\begin{cases}\n\\dfrac{R^{\\text{fine}}_g}{R^{\\text{coarse}}_g},  \\text{若 } \\Phi_g > 0, \\\\\n1,  \\text{若 } \\Phi_g = 0,\n\\end{cases}\n$$\n其与 1 的偏差 $ |F_g - 1| $ 是需要强修正的诊断指标。\n- 子区域 $i$ 中能量群 $g$ 的归一化通量形状为\n$$\ns_{i,g} = \n\\begin{cases}\n\\dfrac{\\phi_{i,g}}{\\bar{\\phi}_g},  \\text{若 } \\bar{\\phi}_g > 0, \\\\\n0,  \\text{若 } \\bar{\\phi}_g = 0.\n\\end{cases}\n$$\n- 能量群 $g$ 的 $L^2$ 形状失配（所有子区域的均匀粗网形状等于 $1$）为\n$$\n\\Delta^{(2)}_g = \\left( \\sum_i \\frac{V_i}{V_{\\text{tot}}} \\left( s_{i,g} - 1 \\right)^2 \\right)^{1/2},\n$$\n而 $L^\\infty$ 形状失配为\n$$\n\\Delta^{(\\infty)}_g = \\max_i \\left| s_{i,g} - 1 \\right|.\n$$\n- 子区域 $i$ 的局部功率密度由相对单位定义为\n$$\nq_i = \\sum_g \\Sigma_{f,i,g} \\phi_{i,g}.\n$$\n- 栅元平均功率密度为\n$$\n\\bar{q} = \\frac{\\sum_i V_i q_i}{V_{\\text{tot}}}.\n$$\n- 局部功率峰值指数为\n$$\n\\text{PPI} = \\frac{\\max_i q_i}{\\bar{q}}.\n$$\n\n您必须设计并实现一个程序，为每个测试用例计算以下诊断指标：\n1) 局部功率峰值指数 $ \\text{PPI} $。\n2) 跨能量群的最大 $L^\\infty$ 通量形状失配 $ \\max_g \\Delta^{(\\infty)}_g $。\n3) 跨能量群的最大 SPH 因子偏差 $ \\max_g |F_g - 1| $。\n4) 一个布尔失效标志，由逻辑条件定义\n$$\n\\left( \\max_g \\Delta^{(\\infty)}_g > \\tau_{\\infty} \\right) \\lor \\left( \\text{PPI} > \\tau_{\\text{PPI}} \\right) \\lor \\left( \\max_g |F_g - 1| > \\tau_{\\text{SPH}} \\right),\n$$\n阈值为 $ \\tau_{\\infty} = 0.6 $，$ \\tau_{\\text{PPI}} = 1.5 $ 和 $ \\tau_{\\text{SPH}} = 0.3 $。\n\n所有输出均为无量纲量，必须作为不带单位的纯数字计算。\n\n您的程序必须处理以下测试套件。每个测试用例包含 $N=4$ 个子区域和 $G=2$ 个能量群。请按给定顺序提供每个用例的结果。\n\n测试用例 1 (中等非均匀性)：\n- 体积 $ V = [1.5, 1.0, 1.2, 0.8] $。\n- 通量 $ \\phi_{i,1} = [1.0, 0.9, 1.1, 1.0] $，$ \\phi_{i,2} = [0.8, 0.85, 0.75, 0.82] $。\n- 裂变截面 $ \\Sigma_{f,i,1} = [0.005, 0.0045, 0.0055, 0.005] $，$ \\Sigma_{f,i,2} = [0.03, 0.028, 0.032, 0.031] $。\n\n测试用例 2 (强非均匀性，可能失效)：\n- 体积 $ V = [1.5, 1.0, 0.5, 0.2] $。\n- 通量 $ \\phi_{i,1} = [3.0, 0.5, 0.2, 0.1] $，$ \\phi_{i,2} = [0.4, 2.5, 0.1, 0.05] $。\n- 裂变截面 $ \\Sigma_{f,i,1} = [0.006, 0.004, 0.003, 0.002] $，$ \\Sigma_{f,i,2} = [0.035, 0.02, 0.01, 0.005] $。\n\n测试用例 3 (部分子区域通量为零)：\n- 体积 $ V = [2.0, 0.7, 0.3, 1.0] $。\n- 通量 $ \\phi_{i,1} = [1.2, 1.0, 0.0, 0.6] $，$ \\phi_{i,2} = [1.5, 0.0, 0.0, 1.0] $。\n- 裂变截面 $ \\Sigma_{f,i,1} = [0.005, 0.006, 0.007, 0.005] $，$ \\Sigma_{f,i,2} = [0.03, 0.033, 0.035, 0.029] $。\n\n测试用例 4 (均匀通量但截面变化)：\n- 体积 $ V = [1.0, 1.0, 1.0, 1.0] $。\n- 通量 $ \\phi_{i,1} = [1.0, 1.0, 1.0, 1.0] $，$ \\phi_{i,2} = [1.0, 1.0, 1.0, 1.0] $。\n- 裂变截面 $ \\Sigma_{f,i,1} = [0.002, 0.004, 0.006, 0.008] $，$ \\Sigma_{f,i,2} = [0.02, 0.02, 0.02, 0.02] $。\n\n测试用例 5 (形状失配高，功率峰值中等)：\n- 体积 $ V = [1.5, 1.0, 1.2, 0.8] $。\n- 通量 $ \\phi_{i,1} = [0.2, 0.2, 3.0, 3.1] $，$ \\phi_{i,2} = [0.2, 0.2, 3.0, 3.1] $。\n- 裂变截面 $ \\Sigma_{f,i,1} = [0.007, 0.007, 0.001, 0.001] $，$ \\Sigma_{f,i,2} = [0.025, 0.025, 0.005, 0.005] $。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含五个测试用例的结果，格式为逗号分隔的 Python 风格列表的列表。对于每个用例，输出一个包含四个条目的列表，顺序如下：布尔失效标志、作为浮点数的局部功率峰值指数 $ \\text{PPI} $、作为浮点数的最大 $L^\\infty$ 通量形状失配 $ \\max_g \\Delta^{(\\infty)}_g $，以及作为浮点数的最大 SPH 偏差 $ \\max_g |F_g - 1| $。例如：\n\"[[False,1.234,0.456,0.078],[True,1.678,0.987,0.345],...]\"。",
            "solution": "所陈述的问题经过了严格的验证。\n\n### 第 1 步：提取已知条件\n- **子区域数据**：\n    - 子区域索引：$i$。\n    - 能量群索引：$g$。\n    - 中子通量：$\\phi_{i,g}$。\n    - 宏观裂变截面：$\\Sigma_{f,i,g}$。\n    - 子区域体积：$V_i$。\n- **聚合和均匀化量**：\n    - 总体积：$V_{\\text{tot}} = \\sum_i V_i$。\n    - 群通量的体积积分：$\\Phi_g = \\sum_i V_i \\phi_{i,g}$。\n    - 栅元平均群通量：$\\bar{\\phi}_g = \\Phi_g / V_{\\text{tot}}$。\n    - 体积加权的均匀化裂变截面：$\\Sigma^{\\text{vol}}_{f,g} = \\frac{\\sum_i V_i \\Sigma_{f,i,g}}{V_{\\text{tot}}}$。\n    - 通量-体积加权的均匀化裂变截面：$\\Sigma^{\\text{fv}}_{f,g} = \\frac{\\sum_i V_i \\phi_{i,g} \\Sigma_{f,i,g}}{\\sum_i V_i \\phi_{i,g}}$。\n- **反应率**：\n    - 细网格反应率：$R^{\\text{fine}}_g = \\sum_i V_i \\Sigma_{f,i,g} \\phi_{i,g}$。\n    - 粗网模型反应率：$R^{\\text{coarse}}_g = \\Sigma^{\\text{vol}}_{f,g} \\Phi_g$。\n- **诊断度量**：\n    - Superhomogenization (SPH) 因子：$F_g = R^{\\text{fine}}_g / R^{\\text{coarse}}_g$ 若 $\\Phi_g > 0$，且 $F_g = 1$ 若 $\\Phi_g = 0$。\n    - 归一化通量形状：$s_{i,g} = \\phi_{i,g} / \\bar{\\phi}_g$ 若 $\\bar{\\phi}_g > 0$，且 $s_{i,g} = 0$ 若 $\\bar{\\phi}_g = 0$。\n    - $L^2$ 形状失配：$\\Delta^{(2)}_g = \\left( \\sum_i \\frac{V_i}{V_{\\text{tot}}} \\left( s_{i,g} - 1 \\right)^2 \\right)^{1/2}$。\n    - $L^\\infty$ 形状失配：$\\Delta^{(\\infty)}_g = \\max_i \\left| s_{i,g} - 1 \\right|$。\n    - 局部功率密度：$q_i = \\sum_g \\Sigma_{f,i,g} \\phi_{i,g}$。\n    - 栅元平均功率密度：$\\bar{q} = \\frac{\\sum_i V_i q_i}{V_{\\text{tot}}}$。\n    - 局部功率峰值指数：$\\text{PPI} = \\frac{\\max_i q_i}{\\bar{q}}$。\n- **失效条件**：\n    - 由 $\\left( \\max_g \\Delta^{(\\infty)}_g > \\tau_{\\infty} \\right) \\lor \\left( \\text{PPI} > \\tau_{\\text{PPI}} \\right) \\lor \\left( \\max_g |F_g - 1| > \\tau_{\\text{SPH}} \\right)$ 定义的布尔标志。\n    - 阈值：$\\tau_{\\infty} = 0.6$，$\\tau_{\\text{PPI}} = 1.5$，$\\tau_{\\text{SPH}} = 0.3$。\n- **测试用例**：提供了五个测试用例，每个用例包含 $N=4$ 个子区域和 $G=2$ 个能量群，并指定了 $V_i$、$\\phi_{i,g}$ 和 $\\Sigma_{f,i,g}$ 的值。\n\n### 第 2 步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题建立在核反应堆物理的既定原理之上，特别是中子输运、反应率计算和栅元均匀化理论。SPH 因子、通量加权、功率密度和形状失配度量的定义是该领域的标准。\n- **适定性**：提供了所有必要的数据和定义。每个诊断指标的公式都是明确且无歧义的，从而为每个测试用例导出一个唯一且可计算的解。对于零通量或零体积积分等边界情况，通过特定的条件定义进行了处理。\n- **客观性**：问题使用精确的数学语言和客观的物理量进行阐述。它不包含任何主观或基于观点的陈述。\n- **其他缺陷**：问题陈述是完整、一致且科学合理的。它不包含说明中列出的任何使其无效的缺陷。测试用例旨在探测诊断指标在不同物理条件下的行为，这是一种有效且标准的方法。\n\n### 第 3 步：结论与行动\n该问题是 **有效的**。将提供一个解决方案。\n\n为每个测试用例计算所需诊断指标的算法，是通过系统地实现所提供的数学定义来构建的。对于一个给定的包含 $N$ 个子区域和 $G$ 个能量群的测试用例，输入是体积向量 $V = [V_1, \\dots, V_N]$，以及通量矩阵 $\\phi = \\{\\phi_{i,g}\\}$ 和裂变截面矩阵 $\\Sigma_f = \\{\\Sigma_{f,i,g}\\}$。\n\n计算过程如下：\n\n1.  **计算聚合量和平均量**：\n    首先，我们计算栅元的总体积，$V_{\\text{tot}} = \\sum_{i=1}^{N} V_i$。\n    然后，对于每个能量群 $g=1, \\dots, G$，我们计算体积积分通量，$\\Phi_g = \\sum_{i=1}^{N} V_i \\phi_{i,g}$。\n    每个能量群的栅元平均通量为 $\\bar{\\phi}_g = \\Phi_g / V_{\\text{tot}}$。如果 $V_{\\text{tot}} = 0$，这些量将无定义，但所有测试用例都提供了 $V_i > 0$。\n\n2.  **计算功率峰值指数 (PPI)**：\n    每个子区域 $i$ 的局部功率密度 $q_i$ 是所有能量群上裂变反应率的总和：$q_i = \\sum_{g=1}^{G} \\Sigma_{f,i,g} \\phi_{i,g}$。\n    栅元平均功率密度 $\\bar{q}$ 是局部功率密度的体积加权平均值：$\\bar{q} = \\frac{\\sum_{i=1}^{N} V_i q_i}{V_{\\text{tot}}}$。\n    功率峰值指数是最大局部功率密度与平均功率密度之比：$\\text{PPI} = \\frac{\\max_i \\{q_i\\}}{\\bar{q}}$。如果 $\\bar{q}=0$（这仅在所有 $q_i=0$ 时发生），则不存在功率峰值，$\\text{PPI}$ 取为 $1$。\n\n3.  **计算最大 $L^\\infty$ 通量形状失配**：\n    对于每个能量群 $g$，子区域 $i$ 中的归一化通量形状为 $s_{i,g} = \\phi_{i,g} / \\bar{\\phi}_g$。根据问题陈述，如果 $\\bar{\\phi}_g = 0$，则 $s_{i,g}=0$。\n    能量群 $g$ 的 $L^\\infty$ 形状失配度量了归一化通量与均匀值 $1$ 的最大偏差：$\\Delta^{(\\infty)}_g = \\max_i \\{ |s_{i,g} - 1| \\}$。\n    最终的诊断指标是这些值在所有能量群中的最大值：$\\max_g \\{ \\Delta^{(\\infty)}_g \\}$。\n\n4.  **计算最大 SPH 因子偏差**：\n    SPH 方法旨在保持反应率守恒。能量群 $g$ 中真实的、细网格的裂变反应率为 $R^{\\text{fine}}_g = \\sum_{i=1}^{N} V_i \\Sigma_{f,i,g} \\phi_{i,g}$。\n    使用体积加权截面 $\\Sigma^{\\text{vol}}_{f,g} = \\frac{\\sum_{i=1}^{N} V_i \\Sigma_{f,i,g}}{V_{\\text{tot}}}$ 的简单均匀化，结合积分通量 $\\Phi_g$，会预测出一个粗网反应率 $R^{\\text{coarse}}_g = \\Sigma^{\\text{vol}}_{f,g} \\Phi_g$。\n    SPH 因子 $F_g$ 是协调这两个反应率的修正因子：$F_g = R^{\\text{fine}}_g / R^{\\text{coarse}}_g$。如果 $\\Phi_g = 0$，那么 $R^{\\text{coarse}}_g=0$，并且可能 $R^{\\text{fine}}_g=0$。在这种情况下，不需要也不可能进行修正，因此 $F_g$ 定义为 $1$。\n    SPH 因子与 1 的偏差 $|F_g - 1|$ 表明了所需修正的大小。最终的诊断指标是所有能量群中的最大偏差：$\\max_g \\{ |F_g - 1| \\}$。\n\n5.  **确定布尔失效标志**：\n    如果任何计算出的诊断指标超过其预定义阈值，则失效标志设置为 `True`，否则设置为 `False`。条件是：\n    $$\n    (\\max_g \\Delta^{(\\infty)}_g > \\tau_{\\infty}) \\lor (\\text{PPI} > \\tau_{\\text{PPI}}) \\lor (\\max_g |F_g - 1| > \\tau_{\\text{SPH}})\n    $$\n    其中阈值给定为 $\\tau_{\\infty} = 0.6$，$ \\tau_{\\text{PPI}} = 1.5 $ 和 $ \\tau_{\\text{SPH}} = 0.3 $。\n\n这个完整的流程被实现并应用于五个测试用例中的每一个，以生成所需的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_case(V, phi, Sigma_f, thresholds):\n    \"\"\"\n    Computes homogenization diagnostics for a single test case.\n\n    Args:\n        V (np.ndarray): 1D array of subregion volumes (shape N).\n        phi (np.ndarray): 2D array of subregion fluxes (shape GxN).\n        Sigma_f (np.ndarray): 2D array of fission cross sections (shape GxN).\n        thresholds (dict): Dictionary of failure thresholds.\n\n    Returns:\n        list: A list containing [failure_flag, ppi, max_delta_inf, max_sph_dev].\n    \"\"\"\n    G, N = phi.shape  # Number of groups, Number of subregions\n\n    # Handle the case of zero total volume to avoid division by zero, though not present in test data.\n    V_tot = np.sum(V)\n    if V_tot == 0:\n        return [False, 1.0, 0.0, 0.0]\n\n    # --- 1. SPH Factor and Deviation ---\n    # Volume-integrated flux per group\n    Phi_g = np.sum(V * phi, axis=1)  # Shape (G,)\n\n    # Volume-weighted homogenized fission cross section\n    sum_V_Sigma_f = np.sum(V * Sigma_f, axis=1)  # Shape (G,)\n    Sigma_vol_fg = sum_V_Sigma_f / V_tot\n\n    # Fine-mesh and coarse-mesh reaction rates\n    R_fine_g = np.sum(V * Sigma_f * phi, axis=1)  # Shape (G,)\n    R_coarse_g = Sigma_vol_fg * Phi_g  # Shape (G,)\n\n    # SPH factor F_g\n    F_g = np.ones(G)\n    # The condition is Phi_g > 0. If Phi_g > 0 and V_i, Sigma_f_i > 0, then R_coarse_g > 0.\n    # The given test cases ensure positive V_i and non-negative Sigma_f and phi.\n    # We check if Phi_g > 0, which also implies R_coarse_g is safe to use as a denominator\n    # unless Sigma_vol_fg is zero, which is not the case here.\n    valid_phi_g_indices = np.where(Phi_g > 0)[0]\n    if valid_phi_g_indices.size > 0:\n        # It's possible R_coarse_g is zero even if Phi_g is positive if all Sigma_f are zero for that group\n        safe_denom_indices = np.where(R_coarse_g[valid_phi_g_indices] != 0)[0]\n        if safe_denom_indices.size > 0:\n            target_indices = valid_phi_g_indices[safe_denom_indices]\n            F_g[target_indices] = R_fine_g[target_indices] / R_coarse_g[target_indices]\n\n    sph_dev = np.abs(F_g - 1.0)\n    max_sph_dev = np.max(sph_dev)\n\n    # --- 2. Flux Shape Mismatch ---\n    bar_phi_g = Phi_g / V_tot  # Shape (G,)\n    s_ig = np.zeros_like(phi) # GxN matrix\n\n    # Calculate normalized shape s_ig, handling group-wise division by zero\n    for g in range(G):\n        if bar_phi_g[g] > 0:\n            s_ig[g, :] = phi[g, :] / bar_phi_g[g]\n        # else, s_ig[g,:] remains 0 as per problem spec\n\n    delta_inf_g = np.max(np.abs(s_ig - 1.0), axis=1)  # Shape (G,)\n    max_delta_inf = np.max(delta_inf_g)\n\n    # --- 3. Power Peaking Index (PPI) ---\n    # Sum over groups 'g' for each region 'i'\n    q_i = np.sum(Sigma_f * phi, axis=0)  # Shape (N,)\n\n    # Cell-average power density\n    bar_q = np.sum(V * q_i) / V_tot\n\n    ppi = 1.0  # Default for no peaking (if bar_q is zero)\n    if bar_q > 0:\n        max_q_i = np.max(q_i)\n        ppi = max_q_i / bar_q\n\n    # --- 4. Boolean Failure Flag ---\n    failure_flag = (max_delta_inf > thresholds['tau_inf']) or \\\n                   (ppi > thresholds['tau_ppi']) or \\\n                   (max_sph_dev > thresholds['tau_sph'])\n\n    return [failure_flag, ppi, max_delta_inf, max_sph_dev]\n\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print results.\n    \"\"\"\n    \n    thresholds = {'tau_inf': 0.6, 'tau_ppi': 1.5, 'tau_sph': 0.3}\n\n    # Define the test cases from the problem statement.\n    test_cases_data = [\n        { # Test Case 1\n            \"V\": [1.5, 1.0, 1.2, 0.8],\n            \"phi\": [[1.0, 0.9, 1.1, 1.0], [0.8, 0.85, 0.75, 0.82]],\n            \"Sigma_f\": [[0.005, 0.0045, 0.0055, 0.005], [0.03, 0.028, 0.032, 0.031]]\n        },\n        { # Test Case 2\n            \"V\": [1.5, 1.0, 0.5, 0.2],\n            \"phi\": [[3.0, 0.5, 0.2, 0.1], [0.4, 2.5, 0.1, 0.05]],\n            \"Sigma_f\": [[0.006, 0.004, 0.003, 0.002], [0.035, 0.02, 0.01, 0.005]]\n        },\n        { # Test Case 3\n            \"V\": [2.0, 0.7, 0.3, 1.0],\n            \"phi\": [[1.2, 1.0, 0.0, 0.6], [1.5, 0.0, 0.0, 1.0]],\n            \"Sigma_f\": [[0.005, 0.006, 0.007, 0.005], [0.03, 0.033, 0.035, 0.029]]\n        },\n        { # Test Case 4\n            \"V\": [1.0, 1.0, 1.0, 1.0],\n            \"phi\": [[1.0, 1.0, 1.0, 1.0], [1.0, 1.0, 1.0, 1.0]],\n            \"Sigma_f\": [[0.002, 0.004, 0.006, 0.008], [0.02, 0.02, 0.02, 0.02]]\n        },\n        { # Test Case 5\n            \"V\": [1.5, 1.0, 1.2, 0.8],\n            \"phi\": [[0.2, 0.2, 3.0, 3.1], [0.2, 0.2, 3.0, 3.1]],\n            \"Sigma_f\": [[0.007, 0.007, 0.001, 0.001], [0.025, 0.025, 0.005, 0.005]]\n        }\n    ]\n\n    results = []\n    for case_data in test_cases_data:\n        V = np.array(case_data[\"V\"])\n        phi = np.array(case_data[\"phi\"])\n        Sigma_f = np.array(case_data[\"Sigma_f\"])\n        \n        result = solve_case(V, phi, Sigma_f, thresholds)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}