{
    "hands_on_practices": [
        {
            "introduction": "The core application of the probability table method is to correctly calculate effective cross sections in the presence of resonance self-shielding. This is achieved by replacing complex energy integrals with weighted averages over a discrete probability distribution of cross sections. This first practice  provides a hands-on implementation of this fundamental concept, where you will apply the formula for the group-averaged capture cross section and investigate its sensitivity to the background dilution, $\\sigma_0$.",
            "id": "4242843",
            "problem": "You are given a problem in nuclear reactor simulation focused on the Unresolved Resonance Region (URR) probability table method. The goal is to compute, from first principles, how the group-averaged microscopic capture cross section changes when the background cross section increases by a specified percentage. The Unresolved Resonance Region (URR) is treated using probability tables that provide a discrete approximation to the distribution of microscopic reaction cross sections within an energy group. The probability table is composed of bins with associated probabilities, microscopic total cross sections, and microscopic capture cross sections. The background cross section, denoted $\\sigma_0$ and expressed in barns, represents the effect of other materials and geometrical leakage that dilute resonant self-shielding. \n\nStarting from the transport slowing-down balance that implies the spectrum in a narrow group is approximately inversely proportional to the sum of the microscopic total cross section and a background term, and from the definition of a flux-weighted group average, derive the expression for the group-averaged microscopic capture cross section in a single energy group using a discrete probability table and the stated physical assumptions. Then, for a given increase fraction $\\delta$ (expressed as a decimal), compute the change $\\Delta\\sigma_{c,g}$ in the group-averaged capture cross section when the background cross section changes from $\\sigma_0$ to $\\sigma_0(1+\\delta)$. All cross sections must be handled in barns. The final numeric answers must be floats representing $\\Delta\\sigma_{c,g}$ in barns, in the specified output format.\n\nAssumptions and core definitions to start from:\n- The neutron flux in a narrow energy group, under the slowing-down approximation and with dilution, is proportional to the inverse of the sum of the microscopic total cross section and an effective background term. Use this proportionality as the flux shape in the group.\n- The group-averaged microscopic reaction cross section is defined as the flux-weighted average over the group.\n- A URR probability table for a single energy group is a set of $N$ bins. Each bin $i$ has a probability $p_i$, a microscopic total cross section $\\sigma_{t,i}$ in barns, and a microscopic capture cross section $\\sigma_{c,i}$ in barns. The probabilities satisfy $\\sum_{i=1}^N p_i = 1$.\n\nTask:\n- Derive the algorithm from the stated principles for computing the group-averaged microscopic capture cross section in a single energy group for a given URR probability table and background cross section $\\sigma_0$, and then compute $\\Delta\\sigma_{c,g} = \\sigma_{c,g}\\big(\\sigma_0(1+\\delta)\\big) - \\sigma_{c,g}(\\sigma_0)$ in barns.\n- Implement the derived algorithm in a program that evaluates $\\Delta\\sigma_{c,g}$ for each test case listed below.\n\nTest suite:\nUse the following URR probability tables and background-change scenarios. For every table, the entries are given as triplet lists of the form $[p_i, \\sigma_{t,i}, \\sigma_{c,i}]$, with $p_i$ dimensionless and $\\sigma_{t,i}$ and $\\sigma_{c,i}$ in barns.\n\n- Table A (moderate correlation, four bins):\n  - Bin 1: `[0.1, 150, 80]`\n  - Bin 2: `[0.2, 60, 15]`\n  - Bin 3: `[0.4, 30, 3]`\n  - Bin 4: `[0.3, 80, 25]`\n\n- Table B (strong positive correlation, four bins):\n  - Bin 1: `[0.25, 10, 1]`\n  - Bin 2: `[0.25, 100, 50]`\n  - Bin 3: `[0.25, 300, 150]`\n  - Bin 4: `[0.25, 1000, 600]`\n\nEvaluate the following cases, each producing one float result in barns:\n- Case 1: Table A, $\\sigma_0 = 5$ barns, $\\delta = 0.1$.\n- Case 2: Table A, $\\sigma_0 = 0.1$ barns, $\\delta = 0.5$.\n- Case 3: Table A, $\\sigma_0 = 100$ barns, $\\delta = 1.0$.\n- Case 4: Table B, $\\sigma_0 = 1$ barns, $\\delta = 0.2$.\n- Case 5: Table B, $\\sigma_0 = 10$ barns, $\\delta = 0.0$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each entry being the float $\\Delta\\sigma_{c,g}$ in barns for the corresponding case, in the same order as listed above. For example, the output must look like `[result1,result2,result3,result4,result5]` with no additional text. All numeric results are floats in barns. Angles are not involved. Percent increases $\\delta$ are provided as decimals, not with a percent sign.",
            "solution": "The problem requires the derivation and implementation of an algorithm to calculate the change in the group-averaged microscopic capture cross section, $\\Delta\\sigma_{c,g}$, due to a change in the background cross section $\\sigma_0$. The derivation proceeds from the fundamental principles provided.\n\nLet the energy group be denoted by the subscript $g$. The microscopic total cross section is $\\sigma_t(E)$ and the microscopic capture cross section is $\\sigma_c(E)$, both functions of energy $E$. The background cross section $\\sigma_0$ is constant within the group.\n\nFirst, we establish the formula for the group-averaged microscopic capture cross section, $\\sigma_{c,g}$. The problem states two core assumptions:\n1. The group-averaged microscopic reaction cross section is defined as the flux-weighted average over the group. For the capture cross section, this is:\n$$ \\sigma_{c,g} = \\frac{\\int_{g} \\sigma_c(E) \\phi(E) dE}{\\int_{g} \\phi(E) dE} $$\nwhere $\\phi(E)$ is the neutron flux at energy $E$, and the integral is over the energy range of group $g$.\n\n2. The neutron flux in a narrow energy group is approximately inversely proportional to the sum of the microscopic total cross section and the background term. This is a consequence of the narrow resonance (NR) approximation in slowing-down theory for a homogeneous mixture.\n$$ \\phi(E) \\propto \\frac{1}{\\sigma_t(E) + \\sigma_0} $$\nWe can write this as $\\phi(E) = \\frac{C}{\\sigma_t(E) + \\sigma_0}$ for some normalization constant $C$.\n\nSubstituting the expression for $\\phi(E)$ into the definition of $\\sigma_{c,g}$:\n$$ \\sigma_{c,g} = \\frac{\\int_{g} \\sigma_c(E) \\frac{C}{\\sigma_t(E) + \\sigma_0} dE}{\\int_{g} \\frac{C}{\\sigma_t(E) + \\sigma_0} dE} $$\nThe constant $C$ cancels from the numerator and denominator:\n$$ \\sigma_{c,g} = \\frac{\\int_{g} \\frac{\\sigma_c(E)}{\\sigma_t(E) + \\sigma_0} dE}{\\int_{g} \\frac{1}{\\sigma_t(E) + \\sigma_0} dE} $$\n\nThe probability table method replaces the continuous, complex energy dependence of cross sections within the Unresolved Resonance Region (URR) with a discrete probability distribution. Instead of integrating over energy $E$, we average over the probability distribution of the cross section values. A probability table for a single energy group consists of a set of $N$ bins, where each bin $i$ is characterized by a probability $p_i$, a total cross section $\\sigma_{t,i}$, and a capture cross section $\\sigma_{c,i}$. The probabilities are normalized such that $\\sum_{i=1}^N p_i = 1$.\n\nThis discrete representation allows us to replace the energy integrals with weighted sums over the $N$ bins. The integral of a function $f(\\sigma_t(E), \\sigma_c(E))$ over the group is approximated by the expected value of that function, computed using the probability table:\n$$ \\int_g f(\\sigma_t(E), \\sigma_c(E)) dE \\propto \\sum_{i=1}^N p_i f(\\sigma_{t,i}, \\sigma_{c,i}) $$\nApplying this approximation to our expression for $\\sigma_{c,g}$, the numerator becomes $\\sum_{i=1}^N p_i \\frac{\\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0}$ and the denominator becomes $\\sum_{i=1}^N p_i \\frac{1}{\\sigma_{t,i} + \\sigma_0}$.\n\nTherefore, the group-averaged microscopic capture cross section for a given background $\\sigma_0$ is:\n$$ \\sigma_{c,g}(\\sigma_0) = \\frac{\\sum_{i=1}^N p_i \\frac{\\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0}}{\\sum_{i=1}^N p_i \\frac{1}{\\sigma_{t,i} + \\sigma_0}} $$\nThis formula correctly accounts for the phenomenon of resonance self-shielding. The term $\\frac{1}{\\sigma_{t,i} + \\sigma_0}$ acts as a weighting factor, giving lower weight to cross-section bands with high total cross sections (where the flux is depressed).\n\nThe problem asks for the change in $\\sigma_{c,g}$ when the background cross section $\\sigma_0$ is increased by a fraction $\\delta$. The new background cross section, $\\sigma'_{0}$, is:\n$$ \\sigma'_{0} = \\sigma_0 (1 + \\delta) $$\nThe change, $\\Delta\\sigma_{c,g}$, is the difference between the group-averaged capture cross section calculated with the new background and the one calculated with the original background:\n$$ \\Delta\\sigma_{c,g} = \\sigma_{c,g}(\\sigma'_{0}) - \\sigma_{c,g}(\\sigma_0) $$\n$$ \\Delta\\sigma_{c,g} = \\frac{\\sum_{i=1}^N \\frac{p_i \\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0(1+\\delta)}}{\\sum_{i=1}^N \\frac{p_i}{\\sigma_{t,i} + \\sigma_0(1+\\delta)}} - \\frac{\\sum_{i=1}^N \\frac{p_i \\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0}}{\\sum_{i=1}^N \\frac{p_i}{\\sigma_{t,i} + \\sigma_0}} $$\n\nThis is the final expression to be implemented. Increasing $\\sigma_0$ reduces self-shielding, as it makes the total effective cross section $\\sigma_t + \\sigma_0$ more uniform across the probability bands. This \"flattens\" the flux, causing the group-averaged cross section to move closer to its infinitely dilute value ($\\sum p_i \\sigma_{c,i}$). Thus, for $\\delta > 0$, we expect $\\Delta\\sigma_{c,g} > 0$. For $\\delta = 0$, $\\Delta\\sigma_{c,g}$ must be exactly $0$.\n\nThe algorithm is as follows:\n1. For each test case, identify the probability table ($\\{p_i, \\sigma_{t,i}, \\sigma_{c,i}\\}$), the initial background cross section $\\sigma_0$, and the fractional change $\\delta$.\n2. Calculate the initial group-averaged capture cross section $\\sigma_{c,g}(\\sigma_0)$ using the derived formula.\n3. Calculate the new background cross section $\\sigma'_{0} = \\sigma_0(1+\\delta)$.\n4. Calculate the final group-averaged capture cross section $\\sigma_{c,g}(\\sigma'_{0})$ using the new background.\n5. Compute the difference $\\Delta\\sigma_{c,g} = \\sigma_{c,g}(\\sigma'_{0}) - \\sigma_{c,g}(\\sigma_0)$.\n6. Store this result and repeat for all test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in the group-averaged microscopic capture cross section\n    based on the URR probability table method for a given change in the\n    background cross section.\n    \"\"\"\n\n    # Define the probability tables from the problem statement.\n    # Each row is [p_i, sigma_t_i, sigma_c_i]\n    table_A = np.array([\n        [0.1, 150.0, 80.0],\n        [0.2, 60.0, 15.0],\n        [0.4, 30.0, 3.0],\n        [0.3, 80.0, 25.0]\n    ])\n\n    table_B = np.array([\n        [0.25, 10.0, 1.0],\n        [0.25, 100.0, 50.0],\n        [0.25, 300.0, 150.0],\n        [0.25, 1000.0, 600.0]\n    ])\n\n    # Define the test cases from the problem statement.\n    # Each entry is a tuple: (table, sigma_0, delta)\n    test_cases = [\n        (table_A, 5.0, 0.1),\n        (table_A, 0.1, 0.5),\n        (table_A, 100.0, 1.0),\n        (table_B, 1.0, 0.2),\n        (table_B, 10.0, 0.0)\n    ]\n\n    def calculate_group_capture_xs(table: np.ndarray, sigma_0: float) -> float:\n        \"\"\"\n        Calculates the group-averaged microscopic capture cross section.\n        \n        Args:\n            table: A numpy array representing the URR probability table.\n            sigma_0: The background cross section in barns.\n\n        Returns:\n            The group-averaged capture cross section in barns.\n        \"\"\"\n        p = table[:, 0]\n        sigma_t = table[:, 1]\n        sigma_c = table[:, 2]\n\n        # Denominator of the flux weighting factor (sigma_t_i + sigma_0)\n        weight_denom = sigma_t + sigma_0\n        \n        # Numerator of the group-averaged cross section formula:\n        # Sum(p_i * sigma_c_i / (sigma_t_i + sigma_0))\n        numerator = np.sum(p * sigma_c / weight_denom)\n\n        # Denominator of the group-averaged cross section formula:\n        # Sum(p_i / (sigma_t_i + sigma_0))\n        denominator = np.sum(p / weight_denom)\n        \n        # The case of a zero denominator is physically unrealistic with positive\n        # cross sections and probabilities, but included for robustness.\n        if denominator == 0.0:\n            # Fallback to infinitely dilute average, though this should not be reached.\n            return np.sum(p * sigma_c)\n\n        return numerator / denominator\n\n    results = []\n    for table, sigma_0, delta in test_cases:\n        # 1. Calculate the initial group-averaged capture cross section\n        sigma_c_g_initial = calculate_group_capture_xs(table, sigma_0)\n\n        # 2. Calculate the new background cross section\n        sigma_0_new = sigma_0 * (1.0 + delta)\n\n        # 3. Calculate the final group-averaged capture cross section\n        sigma_c_g_final = calculate_group_capture_xs(table, sigma_0_new)\n\n        # 4. Compute the change (Delta sigma_c,g)\n        delta_sigma_c_g = sigma_c_g_final - sigma_c_g_initial\n        results.append(delta_sigma_c_g)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A crucial physical insight in the unresolved resonance region is that fluctuations in partial cross sections, like capture, are correlated with fluctuations in the total cross section because they arise from the same resonance structures. This next exercise  is designed to make this abstract concept concrete by having you quantify the error introduced by incorrectly ignoring this correlation. By comparing a physically sound correlated model with a simplified uncorrelated one, you will see firsthand why retaining this correlation is essential for accuracy, especially in highly self-shielded environments.",
            "id": "4242791",
            "problem": "You are tasked to construct and analyze a minimal probability table example for the Unresolved Resonance Region (URR) using the probability table method, and to quantify the bias introduced in the capture reaction rate when the correlation between the capture cross section and the total cross section is neglected. The physical basis is as follows: in the URR, resonant fluctuations in the total cross section and channel cross sections are represented stochastically. The reaction rate density for capture is defined from first principles as $R_\\gamma = N \\int \\phi(E) \\, \\sigma_\\gamma(E) \\, \\mathrm{d}E$, where $N$ is the number density, $\\phi(E)$ is the neutron flux as a function of energy, and $\\sigma_\\gamma(E)$ is the capture cross section. In the probability table method with Bondarenko self-shielding, the within-group flux shape is inversely proportional to the sum of the total cross section and a background cross section, i.e., $\\phi(E) \\propto 1/(\\sigma_t(E) + \\sigma_0)$, where $\\sigma_t(E)$ is the total cross section and $\\sigma_0$ is the background cross section characterizing the degree of self-shielding by other nuclides and geometry. The unresolved resonance region exhibits correlations between $\\sigma_\\gamma$ and $\\sigma_t$ because both are governed by the same resonant structures; neglecting this correlation allows sampling of high $\\sigma_\\gamma$ values together with low $\\sigma_t$, which artificially elevates the flux weighting and biases the reaction rate.\n\nStarting from the fundamental reaction rate definition and the stated flux-proportionality fact, derive the appropriate flux-weighted effective capture cross section within an energy group when correlations are retained, and then derive the corresponding expression when $\\sigma_\\gamma$ is sampled independently of $\\sigma_t$ (i.e., correlation neglected). Use these derivations to compute, for the specified numerical probability table, the fractional bias in the capture reaction rate at several values of $\\sigma_0$, defined as the decimal quantity $b = (\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} - \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}) / \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$.\n\nYou must write a complete, runnable program that:\n- Implements the two-state probability table for a single unresolved energy bin:\n  - State $1$ (“background”): probability $p_1 = 0.9$, total cross section $\\sigma_{t,1} = 5$ barns, capture cross section $\\sigma_{\\gamma,1} = 0.2$ barns.\n  - State $2$ (“resonance”): probability $p_2 = 0.1$, total cross section $\\sigma_{t,2} = 100$ barns, capture cross section $\\sigma_{\\gamma,2} = 1.0$ barns.\n- Uses the Bondarenko self-shielding assumption $\\phi \\propto 1/(\\sigma_t + \\sigma_0)$ as the flux-shape basis for the flux weighting within the group.\n- Computes $\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$ as the flux-weighted effective capture cross section when correlation between $\\sigma_\\gamma$ and $\\sigma_t$ is retained (i.e., each state’s $\\sigma_\\gamma$ is paired with its own $\\sigma_t$).\n- Computes $\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}}$ under the assumption that $\\sigma_\\gamma$ is independent of $\\sigma_t$ (i.e., neglecting correlation), and then the fractional bias $b$ as defined above.\n- Produces numerical results for the following background cross sections (in barns): $\\sigma_0 \\in \\{0, 0.01, 5, 100, 10^6\\}$.\n\nScientific realism requirements:\n- All cross sections must be expressed in barns.\n- The bias must be expressed as a decimal number (not with a percent sign).\n- Your derivation must begin from $R_\\gamma = N \\int \\phi(E)\\sigma_\\gamma(E)\\,\\mathrm{d}E$ and the stated flux proportionality, then logically proceed to the group-effective formulas.\n\nTest suite:\n- Use the five values of $\\sigma_0$ given above to demonstrate:\n  - A low $\\sigma_0$ case (e.g., $\\sigma_0 = 0$ and $\\sigma_0 = 0.01$) where the bias is large and positive (i.e., the uncorrelated treatment overpredicts).\n  - Intermediate $\\sigma_0$ (e.g., $\\sigma_0 = 5$ and $\\sigma_0 = 100$) showing diminishing bias.\n  - A very large $\\sigma_0$ (e.g., $\\sigma_0 = 10^6$) showing the bias tending toward $0$ as expected when background dominates and masks resonance effects.\n- Quantifiable outputs must be floats: the program should compute and return the list of the five biases $b$ for the five $\\sigma_0$ values.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[b_1,b_2,b_3,b_4,b_5]$).",
            "solution": "The problem is first validated and found to be scientifically grounded, well-posed, and complete. All necessary data and definitions for a unique solution are provided. The physical model is based on standard, accepted principles in nuclear reactor physics, specifically the probability table method for the unresolved resonance region and the Bondarenko self-shielding model.\n\nThe objective is to derive expressions for the flux-weighted effective capture cross section under two different assumptions (correlated and uncorrelated cross sections) and compute the resulting fractional bias for a given two-state probability table.\n\nThe starting point is the definition of the reaction rate density for a capture reaction, $R_\\gamma$, within an energy group of width $\\Delta E$:\n$$ R_\\gamma = N \\int_{\\Delta E} \\phi(E) \\sigma_\\gamma(E) \\, \\mathrm{d}E $$\nwhere $N$ is the nuclide number density, $\\phi(E)$ is the neutron flux spectrum, and $\\sigma_\\gamma(E)$ is the microscopic capture cross section. The group-effective capture cross section, $\\sigma_{\\gamma, \\text{eff}}$, is defined such that the reaction rate can be expressed in terms of the group-averaged flux, $\\bar{\\phi} = \\frac{1}{\\Delta E} \\int_{\\Delta E} \\phi(E) \\, \\mathrm{d}E$.\n$$ R_\\gamma = N \\bar{\\phi} \\sigma_{\\gamma, \\text{eff}} \\Delta E $$\nBy equating the two expressions for $R_\\gamma$, we find the formal definition of the effective cross section:\n$$ \\sigma_{\\gamma, \\text{eff}} = \\frac{\\int_{\\Delta E} \\phi(E) \\sigma_\\gamma(E) \\, \\mathrm{d}E}{\\int_{\\Delta E} \\phi(E) \\, \\mathrm{d}E} = \\frac{\\langle \\phi \\sigma_\\gamma \\rangle}{\\langle \\phi \\rangle} $$\nwhere the angle brackets denote an average over the energy group.\n\nThe probability table method discretizes the continuous functions of energy, $\\sigma_t(E)$ and $\\sigma_\\gamma(E)$, into a finite number of states, indexed by $i$. Each state has a probability $p_i$ of occurring within the energy group, and associated cross section values $\\sigma_{t,i}$ and $\\sigma_{\\gamma,i}$. The integrals are replaced by probability-weighted sums:\n$$ \\sigma_{\\gamma, \\text{eff}} = \\frac{\\sum_i p_i \\phi_i \\sigma_{\\gamma,i}}{\\sum_j p_j \\phi_j} $$\nThe problem specifies the Bondarenko self-shielding model for the flux, where the flux shape within the group is taken to be inversely proportional to the total macroscopic cross section. For a single nuclide, this microscopic equivalent is $\\phi(E) \\propto 1/(\\sigma_t(E) + \\sigma_0)$, where $\\sigma_0$ is the background cross section representing all other materials. Therefore, for each state $i$, the flux weighting factor is $\\phi_i = C/(\\sigma_{t,i} + \\sigma_0)$, where $C$ is a proportionality constant that will cancel from the numerator and denominator.\n$$ \\sigma_{\\gamma, \\text{eff}} = \\frac{\\sum_i p_i \\left( \\frac{C}{\\sigma_{t,i} + \\sigma_0} \\right) \\sigma_{\\gamma,i}}{\\sum_j p_j \\left( \\frac{C}{\\sigma_{t,j} + \\sigma_0} \\right)} = \\frac{\\sum_i p_i \\frac{\\sigma_{\\gamma,i}}{\\sigma_{t,i} + \\sigma_0}}{\\sum_j p_j \\frac{1}{\\sigma_{t,j} + \\sigma_0}} $$\nThis is the general formula used for the subsequent derivations.\n\nThe provided two-state probability table is:\nState $1$: $p_1 = 0.9$, $\\sigma_{t,1} = 5$ barns, $\\sigma_{\\gamma,1} = 0.2$ barns.\nState $2$: $p_2 = 0.1$, $\\sigma_{t,2} = 100$ barns, $\\sigma_{\\gamma,2} = 1.0$ barns.\n\nThe background cross sections to be tested are $\\sigma_0 \\in \\{0, 0.01, 5, 100, 10^6\\}$ barns.\n\n**Case 1: Correlated Effective Cross Section ($\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$)**\nIn the correlated case, the pairs $(\\sigma_{t,i}, \\sigma_{\\gamma,i})$ are intrinsically linked. This is the physically correct representation, as both cross sections are determined by the same underlying resonance parameters. We apply the general formula directly to the two given states ($i=1, 2$):\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = \\frac{p_1 \\frac{\\sigma_{\\gamma,1}}{\\sigma_{t,1} + \\sigma_0} + p_2 \\frac{\\sigma_{\\gamma,2}}{\\sigma_{t,2} + \\sigma_0}}{p_1 \\frac{1}{\\sigma_{t,1} + \\sigma_0} + p_2 \\frac{1}{\\sigma_{t,2} + \\sigma_0}} $$\n\n**Case 2: Uncorrelated Effective Cross Section ($\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}}$)**\nIn the uncorrelated case, we assume that the value of $\\sigma_\\gamma$ is chosen independently from the value of $\\sigma_t$. This means the joint probability of observing a particular pair $(\\sigma_{t,j}, \\sigma_{\\gamma,k})$ is the product of their marginal probabilities, $p(\\sigma_{t,j}) p(\\sigma_{\\gamma,k})$. In our model, the marginal probability of $\\sigma_{t,j}$ is $p_j$ and the marginal probability of $\\sigma_{\\gamma,k}$ is $p_k$. The summation for the effective cross section must now be over all $2 \\times 2 = 4$ independent pairings:\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = \\frac{\\sum_{j=1}^2 \\sum_{k=1}^2 p_j p_k \\frac{\\sigma_{\\gamma,k}}{\\sigma_{t,j} + \\sigma_0}}{\\sum_{j=1}^2 \\sum_{k=1}^2 p_j p_k \\frac{1}{\\sigma_{t,j} + \\sigma_0}} $$\nThe numerator and denominator can be factored due to the independence of the sums over $j$ and $k$:\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = \\frac{\\left( \\sum_{k=1}^2 p_k \\sigma_{\\gamma,k} \\right) \\left( \\sum_{j=1}^2 p_j \\frac{1}{\\sigma_{t,j} + \\sigma_0} \\right)}{\\left( \\sum_{k=1}^2 p_k \\right) \\left( \\sum_{j=1}^2 p_j \\frac{1}{\\sigma_{t,j} + \\sigma_0} \\right)} $$\nSince $\\sum_k p_k = p_1 + p_2 = 1$, the expression simplifies significantly:\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = \\sum_{k=1}^2 p_k \\sigma_{\\gamma,k} = \\langle \\sigma_\\gamma \\rangle $$\nThis shows that neglecting correlations reduces the effective capture cross section to its simple probability-weighted average, independent of self-shielding effects. For the given data:\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = p_1 \\sigma_{\\gamma,1} + p_2 \\sigma_{\\gamma,2} = (0.9)(0.2) + (0.1)(1.0) = 0.18 + 0.1 = 0.28 \\text{ barns} $$\nThis value is constant for all $\\sigma_0$.\n\n**Fractional Bias Calculation**\nThe fractional bias is defined as $b = (\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} - \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}) / \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$. We now compute $\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$ and $b$ for each given value of $\\sigma_0$.\n\nFor $\\sigma_0 = 0$ barns:\nNumerator, $N = \\frac{(0.9)(0.2)}{5+0} + \\frac{(0.1)(1.0)}{100+0} = 0.036 + 0.001 = 0.037$\nDenominator, $D = \\frac{0.9}{5+0} + \\frac{0.1}{100+0} = 0.18 + 0.001 = 0.181$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D = 0.037 / 0.181 \\approx 0.20442$ barns\n$b = (0.28 - 0.20442) / 0.20442 \\approx 0.36972$\n\nFor $\\sigma_0 = 0.01$ barns:\n$N = \\frac{0.18}{5.01} + \\frac{0.1}{100.01} \\approx 0.0359281 + 0.0009999 = 0.0369280$\n$D = \\frac{0.9}{5.01} + \\frac{0.1}{100.01} \\approx 0.1796407 + 0.0009999 = 0.1806406$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.204427$ barns\n$b = (0.28 - 0.204427) / 0.204427 \\approx 0.36968$\n\nFor $\\sigma_0 = 5$ barns:\n$N = \\frac{0.18}{5+5} + \\frac{0.1}{100+5} = \\frac{0.18}{10} + \\frac{0.1}{105} = 0.018 + 0.00095238 \\approx 0.01895238$\n$D = \\frac{0.9}{10} + \\frac{0.1}{105} = 0.09 + 0.00095238 \\approx 0.09095238$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.208376$ barns\n$b = (0.28 - 0.208376) / 0.208376 \\approx 0.34373$\n\nFor $\\sigma_0 = 100$ barns:\n$N = \\frac{0.18}{5+100} + \\frac{0.1}{100+100} = \\frac{0.18}{105} + \\frac{0.1}{200} \\approx 0.00171429 + 0.0005 = 0.00221429$\n$D = \\frac{0.9}{105} + \\frac{0.1}{200} \\approx 0.00857143 + 0.0005 = 0.00907143$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.244094$ barns\n$b = (0.28 - 0.244094) / 0.244094 \\approx 0.14710$\n\nFor $\\sigma_0 = 10^6$ barns:\nIn the limit $\\sigma_0 \\to \\infty$, the flux weighting factors $1/(\\sigma_{t,i} + \\sigma_0)$ become equal for all states $i$. The denominator of the expression for $\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$ becomes $\\frac{1}{\\sigma_0} (p_1+p_2)$ and the numerator becomes $\\frac{1}{\\sigma_0} (p_1 \\sigma_{\\gamma,1}+p_2 \\sigma_{\\gamma,2})$. Thus, $\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} \\to \\langle \\sigma_\\gamma \\rangle = \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}}$, and the bias $b \\to 0$.\n$N = \\frac{0.18}{1000005} + \\frac{0.1}{1000100} \\approx 1.79991 \\times 10^{-7} + 9.9990 \\times 10^{-8} \\approx 2.79981 \\times 10^{-7}$\n$D = \\frac{0.9}{1000005} + \\frac{0.1}{1000100} \\approx 8.99955 \\times 10^{-7} + 9.9990 \\times 10^{-8} \\approx 9.99945 \\times 10^{-7}$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.279994$ barns\n$b = (0.28 - 0.279994) / 0.279994 \\approx 0.0000214$\n\nThe physical interpretation is that for low $\\sigma_0$ (high self-shielding), the flux is severely depressed in the high cross-section resonance state (state $2$). Since the capture cross section is also highest in this state, the correct correlated calculation properly accounts for this flux depression, yielding a lower effective capture rate. The uncorrelated model fails to do this, averaging the high capture cross section from state $2$ with a flux that is less depressed, leading to a significant overprediction (large positive bias). As $\\sigma_0$ increases, the external background cross section dominates the total, the flux becomes flatter ($\\phi(E) \\approx \\text{const.}$), self-shielding effects diminish, and both models converge to the same result, causing the bias to approach zero.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs a two-state probability table for an unresolved resonance region,\n    derives and calculates effective capture cross sections with and without\n    correlation, and computes the fractional bias for several background\n    cross sections.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # The probability table consists of two states for a single energy group.\n    # State 1 (\"background\")\n    p1 = 0.9\n    sigma_t1 = 5.0  # barns\n    sigma_g1 = 0.2  # barns\n\n    # State 2 (\"resonance\")\n    p2 = 0.1\n    sigma_t2 = 100.0 # barns\n    sigma_g2 = 1.0   # barns\n\n    # Background cross sections to test (in barns)\n    sigma_0_values = [0.0, 0.01, 5.0, 100.0, 1e6]\n\n    results = []\n\n    # Calculate the uncorrelated effective capture cross section.\n    # This is the simple probability-weighted average <sigma_gamma>,\n    # which is constant for all sigma_0.\n    sigma_geff_uncorr = p1 * sigma_g1 + p2 * sigma_g2\n\n    for sigma_0 in sigma_0_values:\n        # --- Correlated Case ---\n        # The effective capture cross section is computed by weighting each state's\n        # capture cross section by its corresponding flux factor.\n        # Flux factor for state i is proportional to 1 / (sigma_ti + sigma_0).\n        \n        # Numerator of the correlated effective cross section formula\n        numerator_corr = (p1 * sigma_g1 / (sigma_t1 + sigma_0)) + \\\n                         (p2 * sigma_g2 / (sigma_t2 + sigma_0))\n\n        # Denominator of the correlated effective cross section formula\n        denominator_corr = (p1 / (sigma_t1 + sigma_0)) + \\\n                           (p2 / (sigma_t2 + sigma_0))\n\n        # Handle potential division by zero if denominator is zero, though unlikely with given inputs.\n        if denominator_corr == 0:\n            # This case corresponds to infinite sigma_t and sigma_0, physically not meaningful here.\n            # In the limit of large sigma_0, the correlated value approaches the uncorrelated one.\n            sigma_geff_corr = sigma_geff_uncorr\n        else:\n            sigma_geff_corr = numerator_corr / denominator_corr\n\n        # --- Fractional Bias Calculation ---\n        # bias = (uncorrelated - correlated) / correlated\n        \n        # Handle potential division by zero if the correlated cross section is zero.\n        if sigma_geff_corr == 0:\n            # If the correct (correlated) value is zero, any non-zero\n            # uncorrelated value would give an infinite bias. This is not\n            # expected for the given physical problem.\n            if sigma_geff_uncorr == 0:\n                bias = 0.0\n            else:\n                bias = np.inf\n        else:\n            bias = (sigma_geff_uncorr - sigma_geff_corr) / sigma_geff_corr\n        \n        results.append(bias)\n\n    # Final print statement in the exact required format.\n    # Example format: [0.3697247706422018,0.3696813470559194,0.3437302631578948,0.14710037171003714,2.1429997811986563e-05]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In practical multigroup reactor calculations, probability tables are typically provided at discrete energy points, requiring interpolation to obtain effective cross sections across a continuous energy group. The order of operations—interpolating before or after the non-linear self-shielding calculation—is a critical choice with performance and accuracy implications. This final practice  delves into this advanced topic, asking you to compare two common interpolation schemes and analyze the conditions under which a simpler method is acceptable, bridging the gap between single-group theory and real-world code implementation.",
            "id": "4242816",
            "problem": "You are given a simplified, yet physically consistent, model problem to quantify and compare the effect of two interpolation schemes applied to probability tables in the Unresolved Resonance Region (URR) for nuclear reactor simulation. The goal is to compute the group-averaged capture cross section and to assess the impact of different interpolation strategies on the result.\n\nFundamental base. Use the following foundational assumptions and well-tested approximations relevant to the URR:\n- Narrow-resonance self-shielding approximation: within each probability table bin, the scalar neutron flux is inversely proportional to the sum of the total cross section and a spectrally independent background (or dilution) cross section. Specifically, for bin index $j$, flux weighting implies $\\phi_j \\propto 1/(\\sigma_{t,j} + \\sigma_0)$, where $\\sigma_{t,j}$ is the total cross section in bin $j$ and $\\sigma_0$ is the background cross section.\n- The effective capture cross section at a given energy is the capture cross section averaged over the probability table bins with the flux weights above.\n- Group-averaged cross section over an energy interval is the flux-weighted average over energy using a prescribed spectrum shape $w(E)$.\n\nSet-up. Consider a single energy group bounded by $E_1 = 20\\,\\text{keV}$ and $E_2 = 40\\,\\text{keV}$. For two tabulated energies $E_1$ and $E_2$, you are given probability tables with $N = 5$ equiprobable bins with probabilities $w_j = 0.2$ for $j \\in \\{1,2,3,4,5\\}$. Each bin contains a total cross section and a capture cross section, both expressed in barns. The data are:\n- At $E_1$: $\\sigma_{t}^{(1)} = [8.0, 12.0, 20.0, 60.0, 150.0]$ and $\\sigma_{c}^{(1)} = [0.2, 0.5, 1.5, 6.0, 20.0]$.\n- At $E_2$: $\\sigma_{t}^{(2)} = [6.0, 9.0, 15.0, 40.0, 100.0]$ and $\\sigma_{c}^{(2)} = [0.15, 0.35, 1.0, 4.0, 13.0]$.\n\nDefine two interpolation schemes to compute the effective capture cross section within the group:\n1. Energy-linear post-averaged interpolation (method A). Compute the self-shielded effective capture cross sections at $E_1$ and at $E_2$ using the probability tables and background cross section $\\sigma_0$. Then, for any $E \\in [E_1,E_2]$, linearly interpolate these effective capture cross sections in energy: $\\sigma_{c,\\mathrm{eff}}^{A}(E)$ is defined as a linear function of $E$ connecting the endpoint effective values.\n2. Probability-space pre-averaged interpolation (method B). For each bin $j$, linearly interpolate the bin-wise total and capture cross sections between $E_1$ and $E_2$ at the target energy $E$. Then compute the effective capture cross section $\\sigma_{c,\\mathrm{eff}}^{B}(E)$ using the same self-shielding flux weighting with $\\sigma_0$.\n\nFor group-averaging, use a shape function $w(E) = E^{-s}$ with $s \\ge 0$, and compute the group-averaged capture cross section as\n$$\n\\langle \\sigma_c \\rangle = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}(E)\\, w(E)\\, dE}{\\int_{E_1}^{E_2} w(E)\\, dE}.\n$$\n\nTasks. For each test case below, perform the following:\n- Compute the group-averaged capture cross section in barns using method A, denoted $\\langle \\sigma_c \\rangle_A$.\n- Compute the group-averaged capture cross section in barns using method B, denoted $\\langle \\sigma_c \\rangle_B$.\n- Compute the relative difference (a dimensionless decimal) defined as\n$$\n\\delta = \\frac{|\\langle \\sigma_c \\rangle_B - \\langle \\sigma_c \\rangle_A|}{\\langle \\sigma_c \\rangle_B}.\n$$\n- Decide whether the simpler method A is acceptable by using the criterion $\\delta \\le \\tau$ with tolerance $\\tau = 0.005$.\n\nAll integrations over energy must be performed numerically to high accuracy. You must use a deterministic quadrature with enough points to ensure numerical stability. The background cross section $\\sigma_0$ is in barns. The energy weight $w(E)$ uses $E$ expressed in $\\text{keV}$, and the final group-averaged capture cross sections must be expressed in barns. The relative difference $\\delta$ must be expressed as a decimal (not a percentage). Round the reported group-averaged capture cross sections to $6$ decimal places and the relative difference to $6$ decimal places.\n\nTest suite. Use the following $5$ test cases, each specified by $(\\sigma_0, s)$:\n- Case $1$: $(10000.0, 1.0)$.\n- Case $2$: $(10.0, 1.0)$.\n- Case $3$: $(0.1, 1.0)$.\n- Case $4$: $(10.0, 0.0)$.\n- Case $5$: $(10.0, 2.0)$.\n\nOutput specification. Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets. Each test case result must be a list of four elements in the form $[\\langle \\sigma_c \\rangle_A,\\langle \\sigma_c \\rangle_B,\\delta,\\mathrm{flag}]$, where `flag` is an integer equal to $1$ if $\\delta \\le \\tau$ and $0$ otherwise. For example, the overall output format must be\n$[[x_1,y_1,d_1,f_1],[x_2,y_2,d_2,f_2],\\dots]$\nwith all $x_i$ and $y_i$ in barns rounded to $6$ decimal places, all $d_i$ rounded to $6$ decimal places, and each $f_i$ an integer.",
            "solution": "We begin from the fundamental definition of self-shielding in the Unresolved Resonance Region (URR) using probability tables. For a single energy $E$ and a background cross section $\\sigma_0$, the narrow resonance approximation states that the scalar flux in bin $j$ scales as $\\phi_j(E) \\propto 1/(\\sigma_{t,j}(E) + \\sigma_0)$, where $\\sigma_{t,j}(E)$ is the total cross section for that bin. Given a set of bin probabilities $\\{w_j\\}_{j=1}^N$ with $\\sum_j w_j = 1$, the effective capture cross section is defined by a flux-weighted average over bins:\n$$\n\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0) = \\frac{\\sum_{j=1}^N w_j \\, \\sigma_{c,j}(E)\\, \\frac{1}{\\sigma_{t,j}(E) + \\sigma_0}}{\\sum_{j=1}^N w_j \\, \\frac{1}{\\sigma_{t,j}(E) + \\sigma_0}}.\n$$\nThis expression follows from the standard relationship for reaction rate densities $R_{c,j} \\propto \\sigma_{c,j}\\phi_j$ and consistency with reaction rate averaging in steady state.\n\nTo obtain the group-averaged capture cross section over energy, we adopt a spectral weight $w(E) = E^{-s}$ with $s \\ge 0$, and compute\n$$\n\\langle \\sigma_c \\rangle = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)\\, E^{-s}\\, dE}{\\int_{E_1}^{E_2} E^{-s}\\, dE}.\n$$\nThe denominator provides proper normalization and isolates the physics in the numerator due to $\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$.\n\nWe compare two interpolation strategies between $E_1$ and $E_2$:\n\n- Method A (energy-linear post-averaged). First compute the endpoint values:\n$$\n\\sigma_{c,\\mathrm{eff}}^{(1)} = \\sigma_{c,\\mathrm{eff}}(E_1;\\sigma_0), \\quad\n\\sigma_{c,\\mathrm{eff}}^{(2)} = \\sigma_{c,\\mathrm{eff}}(E_2;\\sigma_0).\n$$\nDefine the linear energy interpolation factor\n$$\n\\alpha(E) = \\frac{E_2 - E}{E_2 - E_1}.\n$$\nThen for any $E \\in [E_1,E_2]$, define\n$$\n\\sigma_{c,\\mathrm{eff}}^{A}(E) = \\alpha(E)\\, \\sigma_{c,\\mathrm{eff}}^{(1)} + \\left(1 - \\alpha(E)\\right)\\, \\sigma_{c,\\mathrm{eff}}^{(2)}.\n$$\nFinally compute the group average\n$$\n\\langle \\sigma_c \\rangle_A = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}^{A}(E)\\, E^{-s}\\, dE}{\\int_{E_1}^{E_2} E^{-s}\\, dE}.\n$$\n\n- Method B (probability-space pre-averaged). For each bin $j$, linearly interpolate the bin-wise cross sections:\n$$\n\\sigma_{t,j}(E) = \\alpha(E)\\, \\sigma_{t,j}^{(1)} + \\left(1-\\alpha(E)\\right)\\, \\sigma_{t,j}^{(2)}, \\quad\n\\sigma_{c,j}(E) = \\alpha(E)\\, \\sigma_{c,j}^{(1)} + \\left(1-\\alpha(E)\\right)\\, \\sigma_{c,j}^{(2)}.\n$$\nUse these in the self-shielding expression to obtain $\\sigma_{c,\\mathrm{eff}}^{B}(E) = \\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$ and then compute\n$$\n\\langle \\sigma_c \\rangle_B = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}^{B}(E)\\, E^{-s}\\, dE}{\\int_{E_1}^{E_2} E^{-s}\\, dE}.\n$$\n\nThe impact of the interpolation choice is quantified by the relative difference\n$$\n\\delta = \\frac{\\left|\\langle \\sigma_c \\rangle_B - \\langle \\sigma_c \\rangle_A\\right|}{\\langle \\sigma_c \\rangle_B}.\n$$\nWe accept method A when $\\delta \\le \\tau$ with tolerance $\\tau = 0.005$, otherwise method B is required.\n\nAlgorithmic design. We implement the following steps:\n- Represent the probability table at $E_1$ and $E_2$ by arrays $\\{\\sigma_{t,j}^{(1)}\\}_{j=1}^N$, $\\{\\sigma_{c,j}^{(1)}\\}_{j=1}^N$, $\\{\\sigma_{t,j}^{(2)}\\}_{j=1}^N$, $\\{\\sigma_{c,j}^{(2)}\\}_{j=1}^N$, and weights $w_j = 1/N$.\n- Provide a function to compute $\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$ from bin-wise cross sections and $\\sigma_0$ according to the flux-weighted rational expression above. This is the core realization of the narrow-resonance approximation.\n- For method A, compute $\\sigma_{c,\\mathrm{eff}}^{(1)}$ and $\\sigma_{c,\\mathrm{eff}}^{(2)}$ once, then define $\\sigma_{c,\\mathrm{eff}}^{A}(E)$ as a linear function in $E$ using $\\alpha(E)$.\n- For method B, at each quadrature abscissa $E$, compute the bin-wise interpolated $\\sigma_{t,j}(E)$ and $\\sigma_{c,j}(E)$ and then compute $\\sigma_{c,\\mathrm{eff}}^{B}(E)$ directly from the same flux-weighted formula.\n- Perform the energy integrals using a high-order Gaussian quadrature over $[E_1,E_2]$. Let $\\{x_q, w_q\\}_{q=1}^Q$ be the abscissas and weights mapped to $[E_1,E_2]$, then approximate\n$$\n\\int_{E_1}^{E_2} f(E)\\, dE \\approx \\sum_{q=1}^Q f(x_q)\\, w_q.\n$$\nWe use a sufficiently large $Q$ to ensure stability across the test cases.\n- For each test case $(\\sigma_0, s)$, evaluate $\\langle \\sigma_c \\rangle_A$, $\\langle \\sigma_c \\rangle_B$, compute $\\delta$, and decide the acceptability of method A.\n- Round $\\langle \\sigma_c \\rangle_A$ and $\\langle \\sigma_c \\rangle_B$ to $6$ decimal places (barns) and $\\delta$ to $6$ decimal places. The acceptability flag is an integer $1$ if $\\delta \\le 0.005$ and $0$ otherwise.\n\nWhy and when each method is acceptable. If the background cross section $\\sigma_0 \\to \\infty$ (infinite dilution), then the flux weights become bin-independent because\n$$\n\\frac{1}{\\sigma_{t,j}(E) + \\sigma_0} \\approx \\frac{1}{\\sigma_0} \\quad \\text{for all } j,\n$$\nand the effective capture cross section reduces to the probability-weighted arithmetic mean of $\\sigma_{c,j}(E)$. In that limit, linearity ensures that both interpolation orders become equivalent, yielding $\\delta \\to 0$. More generally, when $\\sigma_{t,j}(E)$ and $\\sigma_{c,j}(E)$ vary nearly linearly in $E$ within the group and the self-shielding distortion is weak (moderate to large $\\sigma_0$), $\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$ is close to linear in $E$ and method A is acceptable. In contrast, for small $\\sigma_0$ (strong self-shielding), the nonlinear dependence of the flux weights on $\\sigma_{t,j}(E)$ causes $\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$ to be a nonlinear function of $E$. In such cases, pre-averaging in probability space (method B) preserves the bin-resolved nonlinearity and yields a more accurate group average, while method A may deviate beyond the tolerance.\n\nThe program implements these principles, evaluates the specified test suite, and prints the required list\n$$\n\\big[\\,[\\langle \\sigma_c \\rangle_A,\\langle \\sigma_c \\rangle_B,\\delta,\\mathrm{flag}],\\dots\\big]\n$$\nwith the requested rounding and units (barns) for the cross sections.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef compute_sigma_c_eff(sig_t, sig_c, probs, sigma0):\n    \"\"\"\n    Compute effective capture cross section with narrow resonance self-shielding:\n    sigma_c_eff = sum_j w_j * sigma_c_j / (sigma_t_j + sigma0) / sum_j w_j / (sigma_t_j + sigma0)\n    All inputs are 1D numpy arrays.\n    \"\"\"\n    inv_denom = 1.0 / (sig_t + sigma0)\n    num = np.sum(probs * sig_c * inv_denom)\n    den = np.sum(probs * inv_denom)\n    return num / den\n\ndef group_average_sigma(method, E1, E2, s, sigma0, probs, sig_t1, sig_c1, sig_t2, sig_c2, quad_n=200):\n    \"\"\"\n    Compute group-averaged capture cross section for a given method over [E1,E2] with weight w(E)=E^{-s}.\n    method: 'A' or 'B'\n    \"\"\"\n    # Quadrature setup on [E1,E2]\n    # Use Gauss-Legendre nodes on [-1,1] mapped to [E1,E2]\n    xi, wi = leggauss(quad_n)\n    # Map to [E1, E2]\n    Emid = 0.5 * (E1 + E2)\n    Ehalf = 0.5 * (E2 - E1)\n    Es = Emid + Ehalf * xi  # energies\n    dE = Ehalf * wi         # differential weights\n\n    # Precompute endpoint effective values for method A\n    if method == 'A':\n        eff1 = compute_sigma_c_eff(sig_t1, sig_c1, probs, sigma0)\n        eff2 = compute_sigma_c_eff(sig_t2, sig_c2, probs, sigma0)\n\n    num = 0.0\n    den = 0.0\n    for E, wE in zip(Es, dE):\n        weight_E = (E ** (-s))  # spectral weight\n        if method == 'A':\n            alpha = (E2 - E) / (E2 - E1)\n            sigma_eff = alpha * eff1 + (1.0 - alpha) * eff2\n        elif method == 'B':\n            alpha = (E2 - E) / (E2 - E1)\n            sig_tE = alpha * sig_t1 + (1.0 - alpha) * sig_t2\n            sig_cE = alpha * sig_c1 + (1.0 - alpha) * sig_c2\n            sigma_eff = compute_sigma_c_eff(sig_tE, sig_cE, probs, sigma0)\n        else:\n            raise ValueError(\"Unknown method\")\n        num += sigma_eff * weight_E * wE\n        den += weight_E * wE\n\n    return num / den\n\ndef solve():\n    # Energy bounds in keV\n    E1 = 20.0\n    E2 = 40.0\n\n    # Probability table with N=5 equiprobable bins\n    probs = np.array([0.2, 0.2, 0.2, 0.2, 0.2], dtype=float)\n\n    # Cross sections at E1 (barns)\n    sig_t1 = np.array([8.0, 12.0, 20.0, 60.0, 150.0], dtype=float)\n    sig_c1 = np.array([0.2, 0.5, 1.5, 6.0, 20.0], dtype=float)\n\n    # Cross sections at E2 (barns)\n    sig_t2 = np.array([6.0, 9.0, 15.0, 40.0, 100.0], dtype=float)\n    sig_c2 = np.array([0.15, 0.35, 1.0, 4.0, 13.0], dtype=float)\n\n    # Test suite: (sigma0, s)\n    test_cases = [\n        (10000.0, 1.0),\n        (10.0, 1.0),\n        (0.1, 1.0),\n        (10.0, 0.0),\n        (10.0, 2.0),\n    ]\n\n    tau = 0.005  # tolerance for acceptability\n\n    results_str = []\n    for sigma0, s in test_cases:\n        # Group averages for both methods\n        gA = group_average_sigma('A', E1, E2, s, sigma0, probs, sig_t1, sig_c1, sig_t2, sig_c2, quad_n=200)\n        gB = group_average_sigma('B', E1, E2, s, sigma0, probs, sig_t1, sig_c1, sig_t2, sig_c2, quad_n=200)\n        # Relative difference\n        rel = abs(gB - gA) / gB if gB != 0.0 else 0.0\n        flag = 1 if rel <= tau else 0\n        # Format with required rounding\n        results_str.append(f\"[{gA:.6f},{gB:.6f},{rel:.6f},{flag}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}