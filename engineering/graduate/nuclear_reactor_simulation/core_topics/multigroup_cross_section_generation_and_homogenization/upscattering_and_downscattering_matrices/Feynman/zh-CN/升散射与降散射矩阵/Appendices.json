{
    "hands_on_practices": [
        {
            "introduction": "多群散射矩阵并非凭空产生，而是通过在离散能群上对连续能量核数据进行平均得到的。本练习将带您实践这一关键步骤，重点是从给定的能量转移核中分离出上散射分量 ()。这项实践填补了理论上的连续能量物理学与模拟中使用的离散矩阵之间的鸿沟。",
            "id": "4259645",
            "problem": "考虑稳态中子输运中的均匀慢化剂，其中散射由双微分微观散射截面建模。线性玻尔兹曼方程中的微观散射源项定义为\n$$\nQ_{s}(E,\\Omega) \\;=\\; \\int_{0}^{\\infty} \\int_{4\\pi} \\frac{d^{2}\\sigma_{s}}{dE \\, d\\Omega}(E' \\rightarrow E, \\Omega' \\rightarrow \\Omega) \\, \\phi(E',\\Omega') \\, d\\Omega' \\, dE' ,\n$$\n其中 $E$ 和 $E'$ 分别是出射和入射中子能量，$\\Omega$ 和 $\\Omega'$ 是对应的方向，$\\phi(E',\\Omega')$ 是角通量，$\\frac{d^{2}\\sigma_{s}}{dE \\, d\\Omega}$ 是双微分微观散射截面。假设在实验室坐标系中散射是各向同性的，因此\n$$\n\\frac{d^{2}\\sigma_{s}}{dE \\, d\\Omega}(E' \\rightarrow E, \\Omega' \\rightarrow \\Omega) \\;=\\; \\frac{\\Sigma_{s}^{0}(E')}{4\\pi} \\, K(E;E') ,\n$$\n其中 $\\Sigma_{s}^{0}(E')$ 是入射能量为 $E'$ 的总微观散射截面，而 $K(E;E')$ 是一个能量转移核，归一化为 $\\int_{0}^{\\infty} K(E;E') \\, dE \\,=\\, 1$。考虑一个由以下定义的双群能量结构\n- 第 $1$ 群：$E' \\in [0,\\, 0.5]$ eV，\n- 第 $2$ 群：$E \\in [0.5,\\, \\infty)$ eV，\n以及在入射群中的平坦通量权重函数 $w(E') = 1$，群归一化为\n$$\nW_{1} \\;=\\; \\int_{0}^{0.5} w(E') \\, dE' \\;=\\; 0.5 \\;\\text{eV}.\n$$\n能量转移核被指定为一种简单的、物理上合理的混合形式，以捕捉降散射和升散射，\n$$\nK(E;E') \\;=\\; p \\, \\frac{H(E' - E)}{E'} \\;+\\; (1-p) \\, \\lambda \\, \\exp\\!\\big(-\\lambda (E - E')\\big) \\, H(E - E') ,\n$$\n其中 $H(\\cdot)$ 是亥维赛函数，$p \\in [0,1]$ 是降散射分数，$\\lambda  0$ 是一个控制升散射尾部的能量衰减参数。在此慢化剂中，对于所有 $E' \\in [0,\\, 0.5]$ eV，取 $\\Sigma_{s}^{0}(E') = 4$ barns，$p = 0.8$ 以及 $\\lambda = 2$ eV$^{-1}$。从微观散射源和多群通量加权转移矩阵的定义出发，构建从第 1 群到第 2 群的各向同性（$l=0$ 勒让德矩）升散射转移矩阵元，记为 $\\Sigma_{s,1 \\rightarrow 2}^{(0)}$，其形式为给定的双微分截面在入射群上使用指定权重进行平均的能量和角度积分。然后精确计算该矩阵元。最终结果以 barns 为单位表示。将你的答案四舍五入到 $4$ 位有效数字。",
            "solution": "用户希望我解决一个问题。\n\n该问题被认为是有效的。\n\n### 步骤 1：多群转移截面的形式化定义\n问题要求计算各向同性（$l=0$）的群间散射截面，该截面描述了中子从能量群 $g'$ 转移到能量群 $g$ 的过程。该截面的第 $l$ 阶勒让德矩在源群 $g'$ 上使用权重函数 $w(E')$ 平均的一般定义为：\n$$\n\\Sigma_{s,g' \\rightarrow g}^{(l)} = \\frac{\\int_{E' \\in g'} w(E') \\int_{E \\in g} \\Sigma_{s}^{(l)}(E' \\rightarrow E) \\, dE \\, dE'}{\\int_{E' \\in g'} w(E') \\, dE'}\n$$\n其中 $\\Sigma_{s}^{(l)}(E' \\rightarrow E)$ 是微分能量转移截面的第 $l$ 阶勒让德矩。分母是源群的归一化因子，记为 $W_{g'}$。\n\n对于这个问题，我们关心的是各向同性分量，因此 $l=0$。转移是从第 1 群到第 2 群，所以 $g'=1$ 且 $g=2$。问题提供了以下具体信息：\n- 源群 1：$E' \\in [0, 0.5]$ eV。\n- 目标群 2：$E \\in [0.5, \\infty)$ eV。\n- 权重函数：对于 $E' \\in [0, 0.5]$ eV，$w(E') = 1$。\n- 归一化因子：$W_{1} = \\int_{0}^{0.5} (1) \\, dE' = 0.5$ eV。\n\n所求截面 $\\Sigma_{s,1 \\rightarrow 2}^{(0)}$ 的表达式为：\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = \\frac{1}{W_{1}} \\int_{0}^{0.5} w(E') \\int_{0.5}^{\\infty} \\Sigma_{s}^{(0)}(E' \\rightarrow E) \\, dE \\, dE'\n$$\n\n### 步骤 2：确定各向同性能量转移核 $\\Sigma_{s}^{(0)}(E' \\rightarrow E)$\n问题指出，在实验室坐标系中散射是各向同性的。双微分微观截面给出如下：\n$$\n\\frac{d^{2}\\sigma_{s}}{dE \\, d\\Omega}(E' \\rightarrow E, \\Omega' \\rightarrow \\Omega) = \\frac{\\Sigma_{s}^{0}(E')}{4\\pi} \\, K(E;E')\n$$\n问题使用符号 $\\Sigma_s^0(E')$ 来表示一个功能上是微观截面的量，因为最终答案要求以 barns 为单位。我们将沿用此符号。各向同性能量转移核 $\\Sigma_{s}^{(0)}(E' \\rightarrow E)$ 是通过将双微分截面对所有出射立体角 $\\Omega$ 积分得到的：\n$$\n\\Sigma_{s}^{(0)}(E' \\rightarrow E) = \\int_{4\\pi} \\frac{d^{2}\\sigma_{s}}{dE \\, d\\Omega}(E' \\rightarrow E, \\Omega' \\rightarrow \\Omega) \\, d\\Omega\n$$\n代入给定的表达式：\n$$\n\\Sigma_{s}^{(0)}(E' \\rightarrow E) = \\int_{4\\pi} \\left( \\frac{\\Sigma_{s}^{0}(E')}{4\\pi} \\, K(E;E') \\right) d\\Omega\n$$\n由于被积函数与角度 $\\Omega$ 无关，在 $4\\pi$ 球面度上的积分就是被积函数乘以 $4\\pi$。\n$$\n\\Sigma_{s}^{(0)}(E' \\rightarrow E) = \\left( \\frac{\\Sigma_{s}^{0}(E')}{4\\pi} \\, K(E;E') \\right) \\times 4\\pi = \\Sigma_{s}^{0}(E') \\, K(E;E')\n$$\n\n### 步骤 3：建立 $\\Sigma_{s,1 \\rightarrow 2}^{(0)}$ 的具体积分\n现在我们可以通过代入所有给定信息来组合出 $\\Sigma_{s,1 \\rightarrow 2}^{(0)}$ 的完整积分：\n- $W_{1} = 0.5$ eV\n- $w(E') = 1$\n- $\\Sigma_{s}^{(0)}(E' \\rightarrow E) = \\Sigma_{s}^{0}(E') \\, K(E;E')$\n- 对于 $E' \\in [0, 0.5]$ eV，$\\Sigma_{s}^{0}(E') = 4$ barns\n- $K(E;E') = p \\, \\frac{H(E' - E)}{E'} + (1-p) \\, \\lambda \\, \\exp\\!\\big(-\\lambda (E - E')\\big) \\, H(E - E')$，其中 $p = 0.8$ 且 $\\lambda = 2$ eV$^{-1}$。\n\n积分为：\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = \\frac{1}{0.5} \\int_{0}^{0.5} (1) \\int_{0.5}^{\\infty} \\left( 4 \\cdot K(E;E') \\right) \\, dE \\, dE'\n$$\n积分区域为 $E' \\in [0, 0.5]$ 和 $E \\in [0.5, \\infty)$。在这个整个区域内，出射能量 $E$ 总是大于入射能量 $E'$。这意味着 $E > E'$ 或 $E - E' > 0$。我们在此条件下分析核 $K(E;E')$ 中的亥维赛函数：\n- 降散射项包含 $H(E' - E)$。由于 $E' - E  0$，因此 $H(E' - E) = 0$。该项消失。\n- 升散射项包含 $H(E - E')$。由于 $E - E' > 0$，因此 $H(E - E') = 1$。该项被保留。\n\n因此，对于从第 1 群到第 2 群的转移，核中唯一相关的部分是升散射分量：\n$$\nK(E;E') = (1-p) \\, \\lambda \\, \\exp\\!\\big(-\\lambda (E - E')\\big)\n$$\n将这个简化的核代入我们的积分中：\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = \\frac{4}{0.5} \\int_{0}^{0.5} \\int_{0.5}^{\\infty} \\left( (1-p) \\, \\lambda \\, \\exp\\!\\big(-\\lambda (E - E')\\big) \\right) \\, dE \\, dE'\n$$\n代入数值 $p = 0.8$ 和 $\\lambda = 2$：\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = 8 \\int_{0}^{0.5} \\int_{0.5}^{\\infty} \\left( (1 - 0.8) \\cdot 2 \\cdot \\exp\\!\\big(-2 (E - E')\\big) \\right) \\, dE \\, dE'\n$$\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = 8 \\int_{0}^{0.5} \\int_{0.5}^{\\infty} 0.4 \\cdot \\exp(-2E) \\exp(2E') \\, dE \\, dE'\n$$\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = 3.2 \\int_{0}^{0.5} \\exp(2E') \\left( \\int_{0.5}^{\\infty} \\exp(-2E) \\, dE \\right) dE'\n$$\n\n### 步骤 4：计算积分\n我们首先计算关于 $E$ 的内层积分：\n$$\n\\int_{0.5}^{\\infty} \\exp(-2E) \\, dE = \\left[ -\\frac{1}{2} \\exp(-2E) \\right]_{E=0.5}^{\\infty} = 0 - \\left( -\\frac{1}{2} \\exp(-2 \\cdot 0.5) \\right) = \\frac{1}{2} \\exp(-1)\n$$\n现在，将此结果代回 $\\Sigma_{s,1 \\rightarrow 2}^{(0)}$ 的表达式中：\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = 3.2 \\int_{0}^{0.5} \\exp(2E') \\left( \\frac{1}{2} \\exp(-1) \\right) dE' = 1.6 \\, \\exp(-1) \\int_{0}^{0.5} \\exp(2E') \\, dE'\n$$\n接下来，我们计算关于 $E'$ 的外层积分：\n$$\n\\int_{0}^{0.5} \\exp(2E') \\, dE' = \\left[ \\frac{1}{2} \\exp(2E') \\right]_{E'=0}^{0.5} = \\frac{1}{2} \\left( \\exp(2 \\cdot 0.5) - \\exp(2 \\cdot 0) \\right) = \\frac{1}{2} (\\exp(1) - \\exp(0)) = \\frac{1}{2} (e - 1)\n$$\n最后，我们将所有部分组合起来，求出 $\\Sigma_{s,1 \\rightarrow 2}^{(0)}$ 的精确值：\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = 1.6 \\, \\exp(-1) \\cdot \\frac{1}{2} (e - 1) = 0.8 \\, \\exp(-1) (e - 1) = 0.8 \\left( \\frac{e - 1}{e} \\right) = 0.8 \\left( 1 - \\frac{1}{e} \\right)\n$$\n该截面的单位是 barns，继承自 $\\Sigma_{s}^{0}(E')$。\n\n### 步骤 5：数值计算\n问题要求一个四舍五入到 $4$ 位有效数字的数值答案。我们计算解析表达式的值：\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} = 0.8 \\left( 1 - \\exp(-1) \\right)\n$$\n使用数值 $e \\approx 2.71828$：\n$$\n\\exp(-1) \\approx 0.36787944\n$$\n$$\n1 - \\exp(-1) \\approx 1 - 0.36787944 = 0.63212056\n$$\n$$\n\\Sigma_{s,1 \\rightarrow 2}^{(0)} \\approx 0.8 \\times 0.63212056 = 0.50569645 \\text{ barns}\n$$\n将此结果四舍五入到 $4$ 位有效数字，我们得到 $0.5057$。",
            "answer": "$$\n\\boxed{0.5057}\n$$"
        },
        {
            "introduction": "为了保证散射矩阵的有效性，它们必须遵循基本的物理定律。本练习要求您编写一个程序来验证这些属性，例如非负性、粒子数守恒以及热能群的细致平衡原理 ()。这项实践突显了确保矩阵产生有意义的模拟结果所必须满足的物理约束。",
            "id": "4259640",
            "problem": "你需要为核反应堆模拟中的多群中子散射矩阵实现一个验证与确认 (VV) 程序。其物理背景是源于玻尔兹曼输运方程的稳态中子平衡的多群近似，其中散射源项按能群离散化。设存在 $G$ 个能群，其代表能量为 $\\{E_g\\}_{g=1}^G$。散射矩阵元 $S_{g \\to g'}$ 代表单位长度上的群间转移截面，单位为 $\\mathrm{cm^{-1}}$。能群 $g$ 的总散射截面为 $\\sigma_s^g$，单位为 $\\mathrm{cm^{-1}}$。\n\n根据第一性原理：\n- 中子数密度和碰撞率均为非负，这意味着 $S_{g \\to g'} \\ge 0$。\n- 从一个能群散射出去的粒子数守恒，要求从能群 $g$ 转移出的总和等于该能群的总散射截面，即 $\\sum_{g'=1}^G S_{g \\to g'} = \\sigma_s^g$。\n- 在高能（快中子）能群中，每次碰撞的能量损失主要为正（能量减少），因此升散射与降散射相比可以忽略不计。\n- 在与温度为 $T$ 的慢化剂达到热平衡时，微观可逆性和时间反演不变性（细致平衡）意味着散射核在通过平衡中子通量加权后是对称的。在多群设定中，这为热能范围内的能群提供了一个互易性条件：\n$$\n\\phi^{\\mathrm{eq}}(E_g) \\, S_{g \\to h} \\approx \\phi^{\\mathrm{eq}}(E_h) \\, S_{h \\to g}, \\quad \\text{对于热中子能群 } g,h,\n$$\n其中平衡中子通量与速率乘以麦克斯韦-玻尔兹曼数密度成正比，$\\phi^{\\mathrm{eq}}(E) \\propto v(E)\\, e^{-E/(k_B T)}$，对于非相对论性中子，$v(E) \\propto \\sqrt{E}$。因此可以取\n$$\n\\phi^{\\mathrm{eq}}(E) = \\sqrt{E} \\, \\exp\\!\\left(-\\frac{E}{k_B T}\\right).\n$$\n\n你的任务是编写一个程序来检查给定散射矩阵的以下属性：\n1. 非负性：对于所有 $g,g'$，$S_{g \\to g'} \\ge 0$。\n2. 行和守恒：对于所有 $g$，$\\sum_{g'} S_{g \\to g'} = \\sigma_s^g$ 在绝对容差 $\\epsilon$ 内成立。\n3. 快中子能群升散射可忽略性：对于每个能量 $E_g \\ge E_c$ 的能群 $g$，比率\n$$\nr_g = \\frac{\\sum_{g':\\, E_{g'}  E_g} S_{g \\to g'}}{\\sigma_s^g}\n$$\n必须满足 $r_g \\le r_{\\max}$。\n4. 热中子互易性（细致平衡）：对于所有 $g \\ne h$ 且 $E_g \\le E_{\\mathrm{th,max}}$, $E_h \\le E_{\\mathrm{th,max}}$ 的有序对 $(g,h)$，加权对称性\n$$\n\\phi^{\\mathrm{eq}}(E_g) \\, S_{g \\to h} \\approx \\phi^{\\mathrm{eq}}(E_h) \\, S_{h \\to g}\n$$\n必须在相对容差 $\\delta$ 内成立。使用玻尔兹曼常数 $k_B = 8.617333262145 \\times 10^{-5} \\, \\mathrm{eV/K}$。\n\n在一个通用函数中实现这些检查，然后评估以下五个测试用例。在所有情况下，使用 $G = 4$ 个能群，能量单位为电子伏特 (eV)，温度单位为开尔文 (K)，截面单位为 $\\mathrm{cm^{-1}}$。使用 $\\epsilon = 10^{-10}$，$\\delta = 10^{-10}$，$E_c = 1000$ eV，以及 $E_{\\mathrm{th,max}} = 0.1$ eV。使用 $r_{\\max} = 10^{-3}$。\n\n测试套件规格：\n- 测试用例 1 (理想情况):\n  - 能量：$E = [2 \\times 10^6,\\, 5 \\times 10^5,\\, 0.05,\\, 0.02]$ eV。\n  - 温度：$T = 300$ K。\n  - 总散射：$\\sigma_s = [0.8,\\, 0.7,\\, 0.5,\\, 0.4]$ $\\mathrm{cm^{-1}}$。\n  - 散射矩阵行：\n    - 行 $g=1$: $[S_{1 \\to 1}, S_{1 \\to 2}, S_{1 \\to 3}, S_{1 \\to 4}] = [0.0,\\, 0.3,\\, 0.3,\\, 0.2]$。\n    - 行 $g=2$: $[S_{2 \\to 1}, S_{2 \\to 2}, S_{2 \\to 3}, S_{2 \\to 4}] = [0.0,\\, 0.0,\\, 0.4,\\, 0.3]$。\n    - 行 $g=3$: 令 $x = 0.2$ 并设置 $[S_{3 \\to 1}, S_{3 \\to 2}, S_{3 \\to 3}, S_{3 \\to 4}] = [0.0,\\, 0.0,\\, 0.5 - x,\\, x]$。\n    - 行 $g=4$: 令 $y$ 由 $T=300$ K 时的细致平衡确定为 $y = \\left(\\frac{\\phi^{\\mathrm{eq}}(E_3)}{\\phi^{\\mathrm{eq}}(E_4)}\\right) x$，并设置 $[S_{4 \\to 1}, S_{4 \\to 2}, S_{4 \\to 3}, S_{4 \\to 4}] = [0.0,\\, 0.0,\\, y,\\, 0.4 - y]$。\n- 测试用例 2 (非负性违规):\n  - 与测试用例 1 相同，但将 $S_{2 \\to 4}$ 替换为 $-0.01$。\n- 测试用例 3 (行和守恒违规):\n  - 与测试用例 1 相同，但将 $S_{1 \\to 4}$ 替换为 $0.201$。\n- 测试用例 4 (热中子互易性违规):\n  - 与测试用例 1 相同，但修改行 $g=4$，使得 $S_{4 \\to 3} = 1.2\\, y$ 且 $S_{4 \\to 4} = 0.4 - 1.2\\, y$（以保持行和等于 $0.4$），其中 $y$ 的定义与测试用例 1 中相同。\n- 测试用例 5 (快中子升散射违规):\n  - 与测试用例 1 相同，但修改行 $g=2$，使得 $[S_{2 \\to 1}, S_{2 \\to 2}, S_{2 \\to 3}, S_{2 \\to 4}] = [0.01,\\, 0.0,\\, 0.39,\\, 0.3]$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的列表形式的测试结果（每个测试用例通过/失败），每个结果都是一个布尔值。例如：$[ \\mathrm{True}, \\mathrm{False}, \\mathrm{True}, \\mathrm{False}, \\mathrm{True} ]$。不应打印任何额外文本。",
            "solution": "该问题陈述经评估后被确定为 **有效**。\n\n它具有科学依据，其要求源于中子输运物理学在多群近似法（核反应堆分析中的一种标准技术）中的基本原理。截面的非负性、散射事件中粒子的守恒、快中子的主要能量损失（降散射）以及热中子的细致平衡（互易性）等原理都已得到充分确立并被正确陈述。\n\n该问题是适定的。它为任务提供了所有必要的数据、常数（例如 `$k_B$`）和定义（例如 `$\\phi^{\\mathrm{eq}}(E)$`）。验证标准通过无歧义的量化阈值和容差（`$\\epsilon, \\delta, E_c, E_{\\mathrm{th,max}}, r_{\\max}$`）进行了规定。测试用例被明确定义，从而能够得到一个唯一且可验证的解。\n\n所用语言客观、精确，没有任何主观或含糊的术语。问题的所有要素都可以形式化为一个计算算法。测试用例的构建是一致的，旨在严格测试每个指定的验证标准。\n\n因此，该问题是合理的，并允许一个形式化的解。\n\n该解将以一个 Python 程序的形式实现，该程序定义了一个主要的验证函数。此函数将对给定的散射矩阵及其相关的物理参数进行四个顺序检查。然后，程序将根据问题描述构建并评估五个具体的测试用例，为每个用例报告一个布尔结果。\n\n解的核心是一个函数 `validate_scattering_matrix`，它接收散射矩阵 `$S$`、总散射截面向量 `$\\sigma_s$`、能群能量向量 `$E$`、慢化剂温度 `$T$` 以及验证参数 `$\\epsilon, \\delta, E_c, E_{\\mathrm{th,max}}, r_{\\max}$` 作为输入。该函数按顺序执行四个必需的检查。\n\n1.  **非负性检查**：此检查强制执行了物理原理，即与相互作用概率相关的截面不能为负。条件是对于所有能群索引 `$g, g'$`，$S_{g \\to g'} \\ge 0$`。通过验证输入矩阵 `$S$` 的所有元素都大于或等于零来实现。\n\n2.  **行和守恒检查**：此检查强制执行散射过程中的中子守恒。对于任何初始能群 `$g$`，所有散射到任何最终能群 `$g'$`（包括向能群 `$g$` 本身的内散射）的截面之和必须等于该能群的总散射截面 `$\\sigma_s^g$`。条件是 `$\\left| \\left( \\sum_{g'=1}^G S_{g \\to g'} \\right) - \\sigma_s^g \\right| \\le \\epsilon$`，其中 `$\\epsilon$` 是一个小的绝对容差，以考虑浮点计算的不精确性。通过计算矩阵 `$S$` 的每一行之和，并将其与 `$\\sigma_s$` 向量中相应的元素进行比较来实现。\n\n3.  **快中子能群升散射检查**：此检查基于中子散射的运动学。高能（快）中子在与慢化剂核碰撞时主要损失能量（降散射）。获得能量（升散射）是罕见事件。该检查通过识别“快”能群（其中 `$E_g \\ge E_c$`）并确保导致升散射的事件比例可忽略不计来量化这一点。快能群 `$g$` 的升散射比率定义为 `$r_g = (\\sum_{g': E_{g'} > E_g} S_{g \\to g'}) / \\sigma_s^g$`。此比率不得超过指定的-最大值 `$r_g \\le r_{\\max}$`。注意，如果 `$\\sigma_s^g = 0$`，那么为了满足守恒和非负性属性，所有 `$S_{g \\to g'}$` 也必须为零，这使得 `$r_g = 0/0$`，物理上解释为 `$0$`。该实现遍历所有能群，根据能量阈值 `$E_c$` 识别快能群，计算 `$r_g$`，并将其与 `$r_{\\max}$` 进行比较。\n\n4.  **热中子互易性检查**：此检查验证了细致平衡原理，该原理源于热平衡系统中的时间反演不变性。对于热能范围内的中子（其中 `$E_g, E_h \\le E_{\\mathrm{th,max}}$`），从能群 `$g$` 散射到 `$h$` 以及从 `$h$` 散射到 `$g$` 的速率通过平衡通量谱 `$\\phi^{\\mathrm{eq}}(E)$` 相关联。条件是 `$\\phi^{\\mathrm{eq}}(E_g) S_{g \\to h} \\approx \\phi^{\\mathrm{eq}}(E_h) S_{h \\to g}$`。平衡通量由 `$\\phi^{\\mathrm{eq}}(E) = \\sqrt{E} \\exp(-E/(k_B T))$` 给出。该检查通过识别所有不同的热能群对 `$(g,h)$` 并验证互易性关系在指定的相对容差 `$\\delta$` 内成立来实现。使用一种鲁棒的数值比较方法，例如 `$\\left| L - R \\right| \\le \\delta \\cdot \\max(\\left|L\\right|, \\left|R\\right|)$`，其中 `$L = \\phi^{\\mathrm{eq}}(E_g) S_{g \\to h}$` 且 `$R = \\phi^{\\mathrm{eq}}(E_h) S_{h \\to g}$`，以处理潜在的浮点问题和除零情况。\n\n主程序定义了五个测试用例。为第一个测试用例构建一个基础矩阵，该用例旨在通过所有检查。其余四个用例通过对基础用例进行特定修改来构建，每个修改都旨在使特定的检查失败。对每个用例调用验证函数，并将布尔结果汇总到一个列表中以供最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef validate_scattering_matrix(S, sigma_s, E, T, G, epsilon, delta, E_c, r_max, E_th_max, k_B):\n    \"\"\"\n    Performs Verification and Validation checks on a multigroup scattering matrix.\n    \n    Returns True if all checks pass, False otherwise.\n    \"\"\"\n    \n    # Check 1: Nonnegativity\n    if not np.all(S >= 0):\n        return False\n        \n    # Check 2: Row-sum conservation\n    row_sums = np.sum(S, axis=1)\n    if not np.all(np.abs(row_sums - sigma_s) = epsilon):\n        return False\n        \n    # Check 3: Fast-group upscattering negligibility\n    for g in range(G):\n        if E[g] >= E_c: # This is a fast group\n            upscatter_sum = 0.0\n            for gp in range(G):\n                if E[gp] > E[g]:\n                    upscatter_sum += S[g, gp]\n            \n            if sigma_s[g] > 0:\n                ratio = upscatter_sum / sigma_s[g]\n                if ratio > r_max:\n                    return False\n            # If sigma_s[g] is 0, upscatter_sum must also be 0, so ratio is 0.\n\n    # Check 4: Thermal reciprocity (detailed balance)\n    kBT = k_B * T\n    def phi_eq(energy):\n        if energy = 0: return 0.0 # Avoid math domain error for sqrt\n        return np.sqrt(energy) * np.exp(-energy / kBT)\n\n    thermal_group_indices = [g for g in range(G) if E[g] = E_th_max]\n    \n    for i in range(len(thermal_group_indices)):\n        for j in range(i + 1, len(thermal_group_indices)):\n            g = thermal_group_indices[i]\n            h = thermal_group_indices[j]\n            \n            phi_g = phi_eq(E[g])\n            phi_h = phi_eq(E[h])\n            \n            lhs = phi_g * S[g, h]\n            rhs = phi_h * S[h, g]\n            \n            denominator = max(np.abs(lhs), np.abs(rhs))\n            \n            if denominator > 0:\n                relative_diff = np.abs(lhs - rhs) / denominator\n                if relative_diff > delta:\n                    return False\n            # If denominator is 0, then lhs and rhs are 0, so they are equal.\n\n    return True\n\ndef solve():\n    # Define problem constants and parameters\n    G = 4\n    epsilon = 1e-10\n    delta = 1e-10\n    E_c = 1000.0  # eV\n    r_max = 1e-3\n    E_th_max = 0.1  # eV\n    k_B = 8.617333262145e-5  # eV/K\n\n    # Base parameters for the test cases\n    E_base = np.array([2e6, 5e5, 0.05, 0.02])\n    T_base = 300.0\n    sigma_s_base = np.array([0.8, 0.7, 0.5, 0.4])\n\n    def get_base_matrix():\n        S = np.zeros((G, G))\n        \n        # Row g=1\n        S[0, :] = [0.0, 0.3, 0.3, 0.2]\n        # Row g=2\n        S[1, :] = [0.0, 0.0, 0.4, 0.3]\n        # Row g=3\n        x = 0.2\n        S[2, :] = [0.0, 0.0, 0.5 - x, x]\n        # Row g=4\n        kBT = k_B * T_base\n        phi_E3 = np.sqrt(E_base[2]) * np.exp(-E_base[2] / kBT)\n        phi_E4 = np.sqrt(E_base[3]) * np.exp(-E_base[3] / kBT)\n        y = (phi_E3 / phi_E4) * x\n        S[3, :] = [0.0, 0.0, y, 0.4 - y]\n        \n        return S\n\n    # Prepare list of test cases\n    test_cases = []\n    \n    # Test case 1 (happy path)\n    s1 = get_base_matrix()\n    test_cases.append((s1, sigma_s_base, E_base, T_base))\n\n    # Test case 2 (nonnegativity violation)\n    s2 = get_base_matrix()\n    s2[1, 3] = -0.01  # S_2->4 = -0.01\n    test_cases.append((s2, sigma_s_base, E_base, T_base))\n\n    # Test case 3 (row-sum conservation violation)\n    s3 = get_base_matrix()\n    s3[0, 3] = 0.201 # S_1->4 = 0.201\n    test_cases.append((s3, sigma_s_base, E_base, T_base))\n    \n    # Test case 4 (thermal reciprocity violation)\n    s4 = get_base_matrix()\n    x = 0.2\n    kBT = k_B * T_base\n    phi_E3 = np.sqrt(E_base[2]) * np.exp(-E_base[2] / kBT)\n    phi_E4 = np.sqrt(E_base[3]) * np.exp(-E_base[3] / kBT)\n    y = (phi_E3 / phi_E4) * x\n    s4[3, 2] = 1.2 * y  # S_4->3 = 1.2 * y\n    s4[3, 3] = 0.4 - 1.2 * y # S_4->4 adjusted to conserve row sum\n    test_cases.append((s4, sigma_s_base, E_base, T_base))\n\n    # Test case 5 (fast upscattering violation)\n    s5 = get_base_matrix()\n    s5[1, :] = [0.01, 0.0, 0.39, 0.3] # Modify row for g=2\n    test_cases.append((s5, sigma_s_base, E_base, T_base))\n\n    # Run validation for all test cases\n    results = []\n    for case in test_cases:\n        S, sigma_s, E, T = case\n        is_valid = validate_scattering_matrix(S, sigma_s, E, T, G, epsilon, delta, E_c, r_max, E_th_max, k_B)\n        results.append(is_valid)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "散射矩阵的结构，特别是上散射的存在，对反应堆物理程序中使用的数值求解器有深远的影响。本练习通过计算源迭代矩阵的谱半径来展示这一效应，谱半径是收敛速度的关键指标 ()。通过比较有无上散射的情况，您将直接理解为何上散射会使问题变得“刚性”，从而需要更高级的求解技术。",
            "id": "4235000",
            "problem": "考虑一个具有三个能量群的单一均匀空间栅元中的稳态多群中子扩散平衡。对于群 $g \\in \\{1,2,3\\}$，其平衡的代数形式由下式给出\n$$\n\\left(\\Sigma_{r,g} + D_g B^2\\right)\\,\\phi_g \\;=\\; \\sum_{g' \\neq g} \\Sigma_{s,\\,g \\leftarrow g'}\\,\\phi_{g'} \\;+\\; Q_g,\n$$\n其中 $D_g$ 是扩散系数（单位：米），$B^2$ 是几何曲率（单位：平方米的倒数），$\\Sigma_{r,g}$ 是移出宏观截面（单位：米的倒数），$\\Sigma_{s,\\,g \\leftarrow g'}$ 是从中子群 $g'$ 到中子群 $g$ 的散射宏观截面（单位：米的倒数），$Q_g$ 是一个外源（单位：米的倒数）。定义对角矩阵\n$$\nA \\;=\\; \\mathrm{diag}\\!\\left(\\Sigma_{r,1}+D_1 B^2,\\; \\Sigma_{r,2}+D_2 B^2,\\; \\Sigma_{r,3}+D_3 B^2\\right),\n$$\n以及非对角散射矩阵 $S$，其元素为 $S_{g,g'} = \\Sigma_{s,\\,g \\leftarrow g'}$（当 $g \\neq g'$ 时）和 $S_{g,g} = 0$。经典的源迭代更新可写为\n$$\n\\boldsymbol{\\phi}^{(k+1)} \\;=\\; A^{-1} S \\,\\boldsymbol{\\phi}^{(k)} \\;+\\; A^{-1} \\boldsymbol{Q}.\n$$\n源迭代的收敛速率由谱半径决定\n$$\n\\rho\\!\\left(A^{-1} S\\right) \\;=\\; \\max_i \\left|\\lambda_i\\!\\left(A^{-1} S\\right)\\right|,\n$$\n其中 $\\lambda_i(\\cdot)$ 表示矩阵参数的特征值。\n\n您的任务是编写一个完整、可运行的程序，为以下四个测试用例计算谱半径 $\\rho\\!\\left(A^{-1} S\\right)$。每个测试用例都指定了扩散系数、几何曲率、移出截面和散射矩阵。所有扩散系数 $D_g$ 的单位均为米，所有截面（$\\Sigma_{r,g}$ 和 $S$ 的所有元素）的单位均为米的倒数，$B^2$ 的单位为平方米的倒数。谱半径是无量纲的，必须报告为四舍五入到六位小数的浮点数。\n\n测试用例 1（无升散射，严格降散射）：\n- $D = [1.0,\\;0.8,\\;0.6]$ 米\n- $B^2 = 0.01$ 平方米的倒数\n- $\\Sigma_r = [0.4,\\;0.25,\\;0.15]$ 米的倒数\n- $S = \\begin{bmatrix}\n0.0  0.0  0.0 \\\\\n0.14  0.0  0.0 \\\\\n0.03  0.09  0.0\n\\end{bmatrix}$ 米的倒数\n\n测试用例 2（轻度升散射）：\n- $D = [1.0,\\;0.8,\\;0.6]$ 米\n- $B^2 = 0.01$ 平方米的倒数\n- $\\Sigma_r = [0.4,\\;0.25,\\;0.15]$ 米的倒数\n- $S = \\begin{bmatrix}\n0.0  0.01  0.005 \\\\\n0.14  0.0  0.02 \\\\\n0.03  0.09  0.0\n\\end{bmatrix}$ 米的倒数\n\n测试用例 3（强升散射）：\n- $D = [1.0,\\;0.8,\\;0.6]$ 米\n- $B^2 = 0.01$ 平方米的倒数\n- $\\Sigma_r = [0.4,\\;0.25,\\;0.15]$ 米的倒数\n- $S = \\begin{bmatrix}\n0.0  0.06  0.03 \\\\\n0.16  0.0  0.07 \\\\\n0.035  0.10  0.0\n\\end{bmatrix}$ 米的倒数\n\n测试用例 4（接近具有显著升散射和减少的泄漏/移出的挑战性工况）：\n- $D = [1.4,\\;1.1,\\;0.7]$ 米\n- $B^2 = 0.003$ 平方米的倒数\n- $\\Sigma_r = [0.22,\\;0.16,\\;0.10]$ 米的倒数\n- $S = \\begin{bmatrix}\n0.0  0.07  0.035 \\\\\n0.10  0.0  0.05 \\\\\n0.03  0.07  0.0\n\\end{bmatrix}$ 米的倒数\n\n程序要求：\n- 对于每个测试用例，构造 $A$ 和 $S$，形成 $M = A^{-1} S$，并计算 $\\rho(M)$ 作为 $M$ 的特征值的最大绝对值。\n- 将每个谱半径表示为四舍五入到六位小数的浮点数（无量纲）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，`[r1,r2,r3,r4]`）的结果，其中 $r_i$ 对应于所列顺序中测试用例 $i$ 的谱半径。\n\n此外，在您的解决方案中，请从基本原理出发，解释为什么升散射会以增加 $\\rho\\!\\left(A^{-1}S\\right)$ 的方式改变矩阵结构，以及为什么当 $\\rho\\!\\left(A^{-1}S\\right)$ 接近1时，有必要采用隐式处理升散射的预处理策略来恢复快速收敛。此问题不涉及物理角度，因此无需指定角度单位。",
            "solution": "该问题要求计算在各种散射条件下多群中子扩散方程的源迭代矩阵的谱半径，并从理论上解释升散射对收敛的影响。\n\n均匀介质中的稳态多群扩散方程可以写成矩阵形式。对于群注量率向量 $\\boldsymbol{\\phi} = [\\phi_1, \\phi_2, \\dots, \\phi_G]^T$ 和外源向量 $\\boldsymbol{Q} = [Q_1, Q_2, \\dots, Q_G]^T$，平衡方程为：\n$$\n(L+R)\\boldsymbol{\\phi} = S\\boldsymbol{\\phi} + \\boldsymbol{Q}\n$$\n在这里，$L$ 是表示因泄漏造成的中子损失的矩阵，$R$ 是表示因移出（吸收和群外散射）造成的中子损失的矩阵。$S$ 是群内散射矩阵。在这个问题中，总损失算子由对角矩阵 $A$ 给出，其对角元素为 $A_{gg} = \\Sigma_{r,g} + D_g B^2$。该项结合了群 $g$ 内的移出（由宏观移出截面 $\\Sigma_{r,g}$ 表征）和群 $g$ 中子泄漏出空间域（由 $D_g B^2$ 近似）。因此，$A \\equiv L+R$。矩阵 $S$ 包含非对角散射截面 $\\Sigma_{s, g \\leftarrow g'}$，它表示中子从群 $g'$ 散射到群 $g$。该问题可以紧凑地表示为：\n$$\nA\\boldsymbol{\\phi} = S\\boldsymbol{\\phi} + \\boldsymbol{Q}\n$$\n经典的源迭代方法通过显式处理整个散射源项 $S\\boldsymbol{\\phi}$ 来求解该系统。给定上一次迭代的注量率向量估计值 $\\boldsymbol{\\phi}^{(k)}$，通过求解以下方程找到下一个估计值 $\\boldsymbol{\\phi}^{(k+1)}$：\n$$\nA\\boldsymbol{\\phi}^{(k+1)} = S\\boldsymbol{\\phi}^{(k)} + \\boldsymbol{Q}\n$$\n由于 $A$ 是一个对角矩阵，其逆 $A^{-1}$ 的计算非常简单（它是一个对角矩阵，其元素是 $A$ 元素的倒数）。因此，迭代可以写成：\n$$\n\\boldsymbol{\\phi}^{(k+1)} = A^{-1}S\\boldsymbol{\\phi}^{(k)} + A^{-1}\\boldsymbol{Q}\n$$\n这是一个形式为 $\\boldsymbol{x}^{(k+1)} = M\\boldsymbol{x}^{(k)} + \\boldsymbol{c}$ 的不动点迭代，其中迭代矩阵为 $M = A^{-1}S$。如果迭代矩阵的谱半径 $\\rho(M)$ 小于 $1$，则这种迭代的收敛性得到保证。渐近收敛速率由 $\\rho(M)$ 决定；$\\rho(M)$ 越接近 $1$，收敛越慢。谱半径定义为矩阵特征值的最大绝对值：$\\rho(M) = \\max_i |\\lambda_i(M)|$。\n\n让我们分析迭代矩阵 $M$ 的结构及其对散射性质的依赖性。按照惯例，能量群从高能到低能进行索引（群 $1$ 是最快的，群 $G$ 是最慢的）。\n- **降散射（Downscattering）**：中子碰撞导致能量损失，使其从一个较高能量的群 $g'$ 移动到一个较低能量的群 $g$（其中 $g > g'$）。在散射矩阵 $S$ 中，这对应于矩阵严格下三角部分的非零项 $S_{gg'}$。\n- **升散射（Upscattering）**：中子碰撞导致能量增加，使其从一个较低能量的群 $g'$ 移动到一个较高能量的群 $g$（其中 $g  g'$）。这在物理上仅对从热慢化剂核碰撞中获得能量的热中子有显著意义。在散射矩阵 $S$ 中，这对应于矩阵严格上三角部分的非零项 $S_{gg'}$。\n\n**升散射对谱半径 $\\rho(A^{-1}S)$ 的影响**\n\n1.  **情况1：无升散射（严格降散射）**\n    当只存在降散射时，散射矩阵 $S$ 是严格下三角矩阵。其上三角和对角元素均为零。矩阵 $A$ 是具有正元素的对角矩阵。迭代矩阵 $M = A^{-1}S$ 是一个对角矩阵和一个严格下三角矩阵的乘积，结果是另一个严格下三角矩阵。三角矩阵的一个基本性质是其特征值就是其对角元素。对于严格下三角矩阵，所有对角元素都为零。因此，$M$ 的所有特征值都为零，其谱半径为 $\\rho(M) = 0$。这意味着源迭代在有限步数内收敛（对于一个 $G$-群问题，最多 $G$ 次迭代），因为矩阵 $M$ 是幂零的（$M^G = 0$）。测试用例1就是这种情况的例子。\n\n2.  **情况2：存在升散射**\n    当发生升散射时，矩阵 $S$ 在其上三角部分有非零项。因此，迭代矩阵 $M = A^{-1}S$ 不再是三角矩阵。它具有更一般的结构，在对角线的上方和下方都有非零项。这种结构在能量群耦合中引入了循环。例如，一个中子可以从群1降散射到群2，然后从群2升散射回到群1。这种双向耦合意味着矩阵 $M$ 不再是幂零的，并且可以有非零的特征值。这些特征值的大小，以及谱半径，取决于耦合项（$S$ 的元素）相对于移出项（$A$ 的对角元素）的强度。随着 $S$ 中升散射项的量级增加，或随着 $A$ 中移出/泄漏项的量级减少（例如，在一个大的、低吸收的系统中），$M$ 的特征值的量级趋于增加。这导致谱半径 $\\rho(M)$ 增加，减慢了源迭代的收敛速度。当 $\\rho(M)$ 接近 $1$ 时，收敛所需的迭代次数可能会变得非常大。\n\n**升散射问题中预处理的必要性**\n\n当强升散射和低移出/泄漏导致 $\\rho(A^{-1}S)$ 接近 $1$ 时，标准源迭代是不切实际的。必须采用加速技术或预处理。收敛缓慢的原因是，对整个散射矩阵 $S$ 的显式处理未能捕捉到由升散射引入的群之间的强隐式耦合。\n\n一种常见且有效的预处理策略是隐式处理有问题的升散射项。我们可以将散射矩阵 $S$ 分解为其严格下三角部分 $S_L$（降散射）和其严格上三角部分 $S_U$（升散射）：$S = S_L + S_U$。\n原始方程 $A\\boldsymbol{\\phi} = (S_L + S_U)\\boldsymbol{\\phi} + \\boldsymbol{Q}$ 可以重新排列为：\n$$\n(A - S_U)\\boldsymbol{\\phi} = S_L\\boldsymbol{\\phi} + \\boldsymbol{Q}\n$$\n这提出了一个替代的迭代方案：\n$$\n(A - S_U)\\boldsymbol{\\phi}^{(k+1)} = S_L\\boldsymbol{\\phi}^{(k)} + \\boldsymbol{Q}\n$$\n更新步骤是 $\\boldsymbol{\\phi}^{(k+1)} = (A - S_U)^{-1}S_L\\boldsymbol{\\phi}^{(k)} + (A - S_U)^{-1}\\boldsymbol{Q}$。这个预处理方案的迭代矩阵是 $M' = (A - S_U)^{-1}S_L$。\n矩阵 $(A - S_U)$ 是上三角矩阵（因为 $A$ 是对角的，$S_U$ 是严格上三角的），并且其对角元素是 $A$ 的正元素。因此，它总是可逆的，并且在每次迭代步骤中可以使用回代法高效地求解该系统。通过将升散射项移到左侧，我们在每次迭代中隐式地求解其效应。得到的迭代矩阵 $M'$ 的谱半径通常比原始的 $M = A^{-1}(S_L+S_U)$ 小得多，从而显著加速收敛。该方法在正向求解方向上有效地解耦了能量群，打破了减慢原始迭代速度的循环。\n\n现在将基于公式 $\\rho(A^{-1}S)$ 对四个测试用例进行数值计算。\n对于每种情况：\n1. 构造对角矩阵 $A$，其元素为 $A_{gg} = \\Sigma_{r,g} + D_g B^2$。\n2. 对 $A$ 求逆得到 $A^{-1}$。\n3. 形成迭代矩阵 $M = A^{-1} S$。\n4. 计算 $M$ 的特征值。\n5. 找到特征值的最大绝对值以获得谱半径 $\\rho(M)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the spectral radius for the source iteration matrix in multigroup\n    neutron diffusion for four test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"D\": np.array([1.0, 0.8, 0.6]),\n            \"B2\": 0.01,\n            \"Sigma_r\": np.array([0.4, 0.25, 0.15]),\n            \"S\": np.array([\n                [0.0, 0.0, 0.0],\n                [0.14, 0.0, 0.0],\n                [0.03, 0.09, 0.0]\n            ])\n        },\n        {\n            \"D\": np.array([1.0, 0.8, 0.6]),\n            \"B2\": 0.01,\n            \"Sigma_r\": np.array([0.4, 0.25, 0.15]),\n            \"S\": np.array([\n                [0.0, 0.01, 0.005],\n                [0.14, 0.0, 0.02],\n                [0.03, 0.09, 0.0]\n            ])\n        },\n        {\n            \"D\": np.array([1.0, 0.8, 0.6]),\n            \"B2\": 0.01,\n            \"Sigma_r\": np.array([0.4, 0.25, 0.15]),\n            \"S\": np.array([\n                [0.0, 0.06, 0.03],\n                [0.16, 0.0, 0.07],\n                [0.035, 0.10, 0.0]\n            ])\n        },\n        {\n            \"D\": np.array([1.4, 1.1, 0.7]),\n            \"B2\": 0.003,\n            \"Sigma_r\": np.array([0.22, 0.16, 0.10]),\n            \"S\": np.array([\n                [0.0, 0.07, 0.035],\n                [0.10, 0.0, 0.05],\n                [0.03, 0.07, 0.0]\n            ])\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        D = case[\"D\"]\n        B2 = case[\"B2\"]\n        Sigma_r = case[\"Sigma_r\"]\n        S = case[\"S\"]\n\n        # 1. Construct the diagonal matrix A.\n        # A_gg = Sigma_r,g + D_g * B^2\n        A_diag = Sigma_r + D * B2\n        \n        # A is a diagonal matrix.\n        # A = np.diag(A_diag)\n\n        # 2. Invert A. For a diagonal matrix, the inverse is a diagonal\n        # matrix with the reciprocal of the diagonal elements. This is more\n        # efficient than a general inversion.\n        A_inv_diag = 1.0 / A_diag\n        A_inv = np.diag(A_inv_diag)\n        \n        # 3. Form the iteration matrix M = A^-1 * S.\n        M = A_inv @ S\n\n        # 4. Compute the eigenvalues of M.\n        eigenvalues = np.linalg.eigvals(M)\n        \n        # 5. Find the spectral radius as the maximum absolute value of the eigenvalues.\n        spectral_radius = np.max(np.abs(eigenvalues))\n        \n        results.append(spectral_radius)\n\n    # Format results to six decimal places and print in the required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}