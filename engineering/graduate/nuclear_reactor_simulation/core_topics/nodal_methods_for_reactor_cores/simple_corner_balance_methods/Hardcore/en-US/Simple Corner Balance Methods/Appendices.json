{
    "hands_on_practices": [
        {
            "introduction": "Theory is best understood through application. This first practice challenges you to implement the Simple Corner Balance (SCB) method in a one-dimensional setting, the simplest context for building a transport solver. By constructing a numerical experiment , you will verify the diffusion limit of the transport equation, a cornerstone concept in reactor physics that connects high-fidelity transport solutions to their approximate diffusion counterparts in optically thick, scattering-dominated regimes. This exercise builds foundational coding skills while providing a concrete demonstration of this important asymptotic relationship.",
            "id": "4248673",
            "problem": "Consider the steady-state, monoenergetic neutron transport in a one-dimensional slab of length $L$ with isotropic scattering and isotropic internal source. The unknown angular flux is $ \\psi(x,\\mu) $ for position $ x \\in [0,L] $ and direction cosine $ \\mu \\in [-1,1] $. The scalar flux is $ \\phi(x) = \\frac{1}{2} \\int_{-1}^{1} \\psi(x,\\mu) \\,\\mathrm{d}\\mu $. The underlying physical law is the steady neutron transport equation\n$$\n\\mu \\frac{\\mathrm{d} \\psi(x,\\mu)}{\\mathrm{d}x} + \\sigma_t \\psi(x,\\mu) = \\frac{\\sigma_s}{2} \\phi(x) + \\frac{Q}{2},\n$$\nwhere $ \\sigma_t $ is the total macroscopic cross section, $ \\sigma_s $ is the scattering macroscopic cross section, and $ Q $ is the isotropic volumetric source. Impose vacuum boundary conditions: for $ \\mu > 0 $, the incoming angular flux at $ x=0 $ is zero, and for $ \\mu < 0 $, the incoming angular flux at $ x=L $ is zero.\n\nThe numerical method to be implemented is the Simple Corner Balance (SCB) method specialized to one dimension. The SCB method is a finite-volume balance scheme that enforces balance at cell corners by tracing characteristics across each cell with piecewise-constant cross sections and sources, and uses upwinded face values to guarantee positivity and conservation. Your program must implement the one-dimensional specialization of SCB that is consistent with the transport equation above and the stated boundary conditions, using a symmetric discrete ordinates quadrature with $ N = 4 $ angular directions (denoted $ S_4 $ Gauss–Legendre quadrature on $ [-1,1] $).\n\nTo verify the diffusion limit of SCB, use the following diffusion scaling: introduce a small parameter $ \\epsilon > 0 $ and set\n$$\n\\sigma_t = \\hat{\\sigma}_t,\\quad \\sigma_a = \\hat{\\sigma}_a \\epsilon^2,\\quad \\sigma_s = \\sigma_t - \\sigma_a,\\quad Q = \\hat{Q}\\,\\epsilon^2,\n$$\nwhere $ \\sigma_a $ is the absorption macroscopic cross section, and $ \\hat{\\sigma}_t > 0 $, $ \\hat{\\sigma}_a \\ge 0 $, and $ \\hat{Q} \\ge 0 $ are fixed reference values independent of $ \\epsilon $. In this scaling, the diffusion limit as $ \\epsilon \\to 0 $ is described by the one-speed diffusion equation\n$$\n- D \\frac{\\mathrm{d}^2 \\phi(x)}{\\mathrm{d}x^2} + \\sigma_a \\phi(x) = Q,\n$$\nwith diffusion coefficient $ D = \\frac{1}{3 \\sigma_t} $. Impose vacuum boundary conditions in diffusion form using Marshak conditions:\n$$\n\\phi(0) + 2 D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(0) = 0, \\quad \\phi(L) - 2 D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(L) = 0.\n$$\nThese boundary conditions induce an extrapolation length of $ 2 D $.\n\nConstruct a numerical experiment to assess the convergence of the SCB transport solution to the diffusion solution in the diffusion scaling defined above. Use a uniform spatial mesh of $ N_x $ cells over $ [0,L] $ with piecewise constant cross sections and source. For each test case, compute:\n- The SCB transport scalar flux $ \\phi_i^{\\mathrm{SCB}} $ at cell centers $ x_i $ for $ i = 1,2,\\dots,N_x $.\n- The analytic diffusion scalar flux $ \\phi^{\\mathrm{diff}}(x_i) $ at the same cell centers, obtained by solving the constant-coefficient diffusion equation with Marshak boundary conditions.\n- The relative discrepancy, measured by the discrete $ L^2 $ norm over the mesh,\n$$\nE = \\sqrt{\\frac{\\sum_{i=1}^{N_x} \\left( \\phi_i^{\\mathrm{SCB}} - \\phi^{\\mathrm{diff}}(x_i) \\right)^2 \\Delta x}{\\sum_{i=1}^{N_x} \\left( \\phi^{\\mathrm{diff}}(x_i) \\right)^2 \\Delta x}},\n$$\nwhere $ \\Delta x = L / N_x $.\n\nParameters and units:\n- Let $ L = 1 $ (in meters), $ \\hat{\\sigma}_t = 1 \\,\\mathrm{m}^{-1} $, $ \\hat{\\sigma}_a = 1 \\,\\mathrm{m}^{-1} $, and $ \\hat{Q} = 1 \\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1} $. The program will report dimensionless relative errors $ E $; no physical units are to be printed in the output.\n- Use $ S_4 $ symmetric Gauss–Legendre quadrature on $ [-1,1] $ for directions $ \\mu $ with weights $ w $ satisfying $ \\sum w = 2 $.\n\nTest suite:\n- Case 1 (general): $ \\epsilon = 0.5 $, $ N_x = 40 $.\n- Case 2 (thicker regime): $ \\epsilon = 0.25 $, $ N_x = 40 $.\n- Case 3 (more diffusive): $ \\epsilon = 0.125 $, $ N_x = 40 $.\n- Case 4 (edge, coarse mesh): $ \\epsilon = 0.125 $, $ N_x = 10 $.\n- Case 5 (edge, fine mesh): $ \\epsilon = 0.125 $, $ N_x = 80 $.\n\nYour program must:\n- Implement the SCB method for the transport equation with the given scaling, boundary conditions, and quadrature.\n- Compute the analytic diffusion solution for the constant-coefficient problem with Marshak boundary conditions.\n- Evaluate the relative error $ E $ for each test case.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"), where each entry is the floating-point value of $ E $ for the corresponding test case, in the order listed above. No other text should be printed. Angles are measured in radians implicitly through direction cosines, but the reported values are dimensionless relative errors.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. The well-posed problem requires the implementation of the Simple Corner Balance (SCB) numerical method for the one-dimensional, steady-state, monoenergetic neutron transport equation and its comparison against an analytical diffusion theory solution in a specified diffusion limit.\n\nThe fundamental physical law is the neutron transport equation:\n$$\n\\mu \\frac{\\mathrm{d} \\psi(x,\\mu)}{\\mathrm{d}x} + \\sigma_t \\psi(x,\\mu) = S(x)\n$$\nwhere the total source term $S(x)$ is given by\n$$\nS(x) = \\frac{\\sigma_s}{2} \\phi(x) + \\frac{Q}{2}\n$$\nThe scalar flux $\\phi(x)$ is the angular integral of the angular flux $\\psi(x, \\mu)$. The problem is defined on a slab of length $L$ with vacuum boundary conditions.\n\nThe solution process is divided into three parts:\n1. Derivation of the analytical solution to the corresponding diffusion equation.\n2. Formulation and implementation of the Simple Corner Balance (SCB) numerical scheme for the transport equation.\n3. Computation of the relative error between the numerical transport solution and the analytical diffusion solution for the specified test cases.\n\n**1. Analytical Diffusion Solution**\n\nIn the specified diffusion scaling, where $\\sigma_t = \\hat{\\sigma}_t$, $\\sigma_a = \\hat{\\sigma}_a \\epsilon^2$, and $Q = \\hat{Q}\\,\\epsilon^2$, the transport equation asymptotically approaches the one-speed diffusion equation for small $\\epsilon$:\n$$\n- D \\frac{\\mathrm{d}^2 \\phi(x)}{\\mathrm{d}x^2} + \\sigma_a \\phi(x) = Q\n$$\nThe diffusion coefficient is $D = 1/(3\\sigma_t)$. With the given constant parameters $L=1$, $\\hat{\\sigma}_t=1$, $\\hat{\\sigma}_a=1$, and $\\hat{Q}=1$, the diffusion parameters become:\n$$\n\\sigma_t = 1, \\quad \\sigma_a = \\epsilon^2, \\quad Q = \\epsilon^2, \\quad D = \\frac{1}{3}\n$$\nThe diffusion equation is a second-order linear ordinary differential equation with constant coefficients. Its general solution is the sum of a homogeneous solution and a particular solution. The particular solution is $\\phi_p(x) = Q/\\sigma_a = \\epsilon^2/\\epsilon^2 = 1$. The homogeneous equation is $-D \\frac{\\mathrm{d}^2 \\phi_h}{\\mathrm{d}x^2} + \\sigma_a \\phi_h = 0$, which can be rewritten as $\\frac{\\mathrm{d}^2 \\phi_h}{\\mathrm{d}x^2} - \\frac{\\phi_h}{L_d^2} = 0$, where $L_d = \\sqrt{D/\\sigma_a} = \\sqrt{(1/3)/\\epsilon^2} = 1/(\\sqrt{3}\\epsilon)$ is the diffusion length.\n\nThe general solution is therefore:\n$$\n\\phi(x) = A e^{-x/L_d} + B e^{x/L_d} + 1\n$$\nThe constants of integration, $A$ and $B$, are determined by applying the Marshak boundary conditions:\n1. At $x=0$: $\\phi(0) + 2D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(0) = 0$\n2. At $x=L$: $\\phi(L) - 2D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(L) = 0$\n\nThe derivative of the flux is $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(x) = -\\frac{A}{L_d} e^{-x/L_d} + \\frac{B}{L_d} e^{x/L_d}$. Substituting into the boundary conditions yields a $2 \\times 2$ linear system for $A$ and $B$:\n$$\n\\begin{pmatrix}\n1 - \\frac{2D}{L_d} & 1 + \\frac{2D}{L_d} \\\\\n(1 + \\frac{2D}{L_d})e^{-L/L_d} & (1 - \\frac{2D}{L_d})e^{L/L_d}\n\\end{pmatrix}\n\\begin{pmatrix}\nA \\\\\nB\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-1 \\\\\n-1\n\\end{pmatrix}\n$$\nThis linear system is solved for $A$ and $B$ for each given $\\epsilon$, providing the complete analytical diffusion solution $\\phi^{\\mathrm{diff}}(x)$.\n\n**2. Simple Corner Balance (SCB) Numerical Solution**\n\nThe SCB method is a finite-volume scheme applied to the transport equation. The domain $[0, L]$ is discretized into $N_x$ uniform cells of width $\\Delta x = L/N_x$. The angular variable $\\mu$ is discretized using an $S_4$ symmetric Gauss-Legendre quadrature set, yielding $N=4$ discrete directions $\\mu_m$ and corresponding weights $w_m$.\n\nThe core of the numerical solution is the Source Iteration (SI) method, which proceeds as follows:\n1.  Initialize the scalar flux profile, e.g., $\\phi_i^{(0)} = 1$ for all cells $i=1, \\dots, N_x$.\n2.  For iteration $k=0, 1, 2, \\dots$:\n    a. Compute the cell-wise constant source term based on the previous iterate's scalar flux: $S_i^{(k+1/2)} = \\frac{\\sigma_s}{2} \\phi_i^{(k)} + \\frac{Q}{2}$. Note that $\\sigma_s = \\sigma_t - \\sigma_a = 1 - \\epsilon^2$.\n    b. Perform a transport sweep for each discrete direction $\\mu_m$ to compute the updated cell-average angular fluxes $\\psi_{i,m}^{(k+1)}$. The SCB method, equivalent to the Step Characteristics method in 1D, is used. The method traces characteristics across each cell, assuming a constant source.\n    \n    For a given direction $\\mu_m$, the outgoing flux from a cell is related to the incoming flux and the internal source. Let $\\psi_{in,m}$ be the flux on the upwind face of cell $i$. The optical thickness of the cell is $\\tau_{i,m} = \\sigma_t \\Delta x / |\\mu_m|$. The outgoing face flux is:\n    $$\n    \\psi_{out,m} = \\psi_{in,m} e^{-\\tau_{i,m}} + \\frac{S_i^{(k+1/2)}}{\\sigma_t} (1 - e^{-\\tau_{i,m}})\n    $$\n    The cell-average angular flux $\\psi_{i,m}^{(k+1)}$ is then calculated using a relation derived from integrating the flux profile along the characteristic within the cell:\n    $$\n    \\psi_{i,m}^{(k+1)} = \\frac{S_i^{(k+1/2)}}{\\sigma_t} + \\left( \\psi_{in,m} - \\frac{S_i^{(k+1/2)}}{\\sigma_t} \\right) \\frac{1 - e^{-\\tau_{i,m}}}{\\tau_{i,m}}\n    $$\n    The transport sweep proceeds by traversing the spatial mesh in the direction of neutron travel:\n    - For $\\mu_m > 0$, the sweep is from left to right ($i=1, \\dots, N_x$). The incoming flux at the left boundary is $\\psi_{1/2, m} = 0$.\n    - For $\\mu_m < 0$, the sweep is from right to left ($i=N_x, \\dots, 1$). The incoming flux at the right boundary is $\\psi_{N_x+1/2, m} = 0$.\n\n    c. After sweeping through all directions, update the scalar flux in each cell:\n    $$\n    \\phi_i^{(k+1)} = \\frac{1}{2} \\sum_{m=1}^{N} w_m \\psi_{i,m}^{(k+1)}\n    $$\n    The factor of $1/2$ comes from the definition $\\phi(x) = \\frac{1}{2} \\int_{-1}^1 \\psi(x, \\mu) d\\mu$.\n3. Check for convergence. The iteration stops when the relative difference between successive scalar flux iterates is below a tolerance, i.e., $\\|\\phi^{(k+1)} - \\phi^{(k)}\\|_2 / \\|\\phi^{(k+1)}\\|_2 < \\text{tol}$.\n\n**3. Error Computation**\n\nOnce the SCB transport solver has converged to a solution $\\phi_i^{\\mathrm{SCB}}$, it is compared to the analytical diffusion solution $\\phi^{\\mathrm{diff}}(x_i)$ evaluated at the same cell centers $x_i = (i-0.5)\\Delta x$. The relative discrepancy is measured using the discrete $L^2$ norm:\n$$\nE = \\sqrt{\\frac{\\sum_{i=1}^{N_x} \\left( \\phi_i^{\\mathrm{SCB}} - \\phi^{\\mathrm{diff}}(x_i) \\right)^2}{\\sum_{i=1}^{N_x} \\left( \\phi^{\\mathrm{diff}}(x_i) \\right)^2}}\n$$\nThe factor $\\Delta x$ in the numerator and denominator cancels out for a uniform mesh. This calculation is performed for each test case specified in the problem statement. As $\\epsilon \\to 0$, we expect $E$ to decrease, confirming that the transport solution converges to the diffusion solution in this limit. Varying $N_x$ shows the effect of the spatial discretization error of the SCB method on this comparison.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (epsilon, Nx)\n        (0.5, 40),\n        (0.25, 40),\n        (0.125, 40),\n        (0.125, 10),\n        (0.125, 80),\n    ]\n\n    results = []\n    for epsilon, Nx in test_cases:\n        error = run_case(epsilon, Nx)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef run_case(epsilon, Nx):\n    \"\"\"\n    Runs a single test case for a given epsilon and Nx.\n    \n    Args:\n        epsilon (float): The diffusion scaling parameter.\n        Nx (int): The number of spatial cells.\n\n    Returns:\n        float: The relative L2 error between SCB and diffusion solutions.\n    \"\"\"\n    # Fixed parameters\n    L = 1.0\n    sigma_t_hat = 1.0\n    sigma_a_hat = 1.0\n    Q_hat = 1.0\n\n    # Scaled parameters\n    sigma_t = sigma_t_hat\n    sigma_a = sigma_a_hat * epsilon**2\n    sigma_s = sigma_t - sigma_a\n    Q_val = Q_hat * epsilon**2\n    D = 1.0 / (3.0 * sigma_t)\n\n    # Spatial mesh\n    dx = L / Nx\n    x_centers = np.linspace(dx / 2.0, L - dx / 2.0, Nx)\n\n    # 1. Compute analytical diffusion solution\n    phi_diff = get_diffusion_solution(L, D, sigma_a, Q_val, x_centers)\n\n    # 2. Compute SCB transport solution\n    phi_scb = get_scb_solution(L, Nx, sigma_t, sigma_s, Q_val)\n\n    # 3. Compute relative L2 error\n    norm_diff = np.linalg.norm(phi_diff)\n    if norm_diff == 0:\n        return np.linalg.norm(phi_scb - phi_diff)\n        \n    error = np.linalg.norm(phi_scb - phi_diff) / norm_diff\n    \n    return error\n\ndef get_diffusion_solution(L, D, sigma_a, Q_val, x_centers):\n    \"\"\"\n    Calculates the analytical solution to the 1D diffusion equation with Marshak BCs.\n    \"\"\"\n    if sigma_a == 0: # Purely scattering case\n        # Equation: -D * phi'' = Q. phi = -Q/(2D)*x^2 + C1*x + C2\n        # BCs: phi(0) + 2D*phi'(0) = 0, phi(L) - 2D*phi'(L) = 0\n        # phi'(x) = -Q/D * x + C1\n        # BC1 at x=0: C2 + 2D*C1 = 0 => C2 = -2*D*C1\n        # BC2 at x=L: -Q/(2D)*L^2 + C1*L + C2 - 2D*(-Q/D*L + C1) = 0\n        # -Q/(2D)*L^2 + C1*L - 2DC1 + 2QL - 2DC1 = 0\n        # C1*(L - 4D) = Q*L^2/(2D) - 2*Q*L\n        # C1 = (Q*L^2/(2D) - 2*Q*L) / (L-4*D)\n        C1 = (Q_val * L**2 / (2.0 * D) - 2.0 * Q_val * L) / (L - 4.0 * D)\n        C2 = -2.0 * D * C1\n        return -Q_val / (2.0 * D) * x_centers**2 + C1 * x_centers + C2\n\n    phi_p = Q_val / sigma_a\n    L_d = np.sqrt(D / sigma_a)\n    \n    # Setup the 2x2 linear system for coefficients A and B\n    # A * x = b, where x = [A, B]^T\n    alpha = 2.0 * D / L_d\n    exp_L_Ld = np.exp(L / L_d)\n    exp_neg_L_Ld = np.exp(-L / L_d)\n\n    mat_A = np.array([\n        [1.0 - alpha, 1.0 + alpha],\n        [(1.0 + alpha) * exp_neg_L_Ld, (1.0 - alpha) * exp_L_Ld]\n    ])\n    \n    vec_b = np.array([-phi_p, -phi_p])\n\n    try:\n        A, B = np.linalg.solve(mat_A, vec_b)\n    except np.linalg.LinAlgError:\n        # Fallback for ill-conditioned matrix\n        return np.full_like(x_centers, phi_p)\n\n    phi_analytic = A * np.exp(-x_centers / L_d) + B * np.exp(x_centers / L_d) + phi_p\n    return phi_analytic\n\ndef get_scb_solution(L, Nx, sigma_t, sigma_s, Q_val):\n    \"\"\"\n    Solves the 1D transport equation using the Simple Corner Balance (SCB) method.\n    \"\"\"\n    # S4 Gauss-Legendre quadrature set on [-1, 1]\n    # mu are nodes, w are weights. sum(w) = 2.\n    mu, w = np.polynomial.legendre.leggauss(4)\n    N = len(mu)\n\n    # Spatial discretization\n    dx = L / Nx\n    \n    # Source Iteration\n    phi = np.ones(Nx)  # Initial guess for scalar flux\n    max_iter = 20000\n    tol = 1.0e-12\n\n    for k in range(max_iter):\n        phi_old = np.copy(phi)\n        \n        # Calculate source term\n        S = (sigma_s / 2.0) * phi + (Q_val / 2.0)\n        \n        psi_cell = np.zeros((Nx, N))\n        S_over_sigt = S / sigma_t\n\n        for m in range(N):\n            tau_m = sigma_t * dx / abs(mu[m])\n            \n            # Robust calculation of (1 - exp(-tau)) / tau\n            if tau_m < 1e-6:\n                f_tau = 1.0 - tau_m / 2.0 + tau_m**2 / 6.0\n            else:\n                f_tau = -np.expm1(-tau_m) / tau_m\n\n            exp_tau = np.exp(-tau_m)\n\n            if mu[m] > 0:\n                # Sweep from left to right\n                psi_face_in = 0.0  # Vacuum BC at x=0\n                for i in range(Nx):\n                    psi_cell[i, m] = S_over_sigt[i] \\\n                                   + (psi_face_in - S_over_sigt[i]) * f_tau\n                    psi_face_out = psi_face_in * exp_tau \\\n                                   + S_over_sigt[i] * (1.0 - exp_tau)\n                    psi_face_in = psi_face_out\n            else:  # mu[m] < 0\n                # Sweep from right to left\n                psi_face_in = 0.0  # Vacuum BC at x=L\n                for i in range(Nx - 1, -1, -1):\n                    psi_cell[i, m] = S_over_sigt[i] \\\n                                   + (psi_face_in - S_over_sigt[i]) * f_tau\n                    psi_face_out = psi_face_in * exp_tau \\\n                                   + S_over_sigt[i] * (1.0 - exp_tau)\n                    psi_face_in = psi_face_out\n\n        # Update scalar flux\n        phi = 0.5 * np.sum(w * psi_cell, axis=1)\n        \n        # Check for convergence\n        norm_phi = np.linalg.norm(phi)\n        if norm_phi > 0:\n            rel_err = np.linalg.norm(phi - phi_old) / norm_phi\n            if rel_err < tol:\n                break\n    \n    return phi\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "Building upon the one-dimensional case, this exercise extends the SCB method to two dimensions and explores a common, practical challenge in reactor simulation. You will investigate how the scheme's accuracy is affected by material discontinuities, particularly when they are not perfectly aligned with the computational grid . This practice highlights the \"stair-step\" approximation errors inherent in Cartesian mesh methods and deepens your understanding of how numerical schemes interact with the geometric modeling of heterogeneous systems.",
            "id": "4248715",
            "problem": "Consider the steady-state, monoenergetic, two-dimensional neutral particle transport equation on a rectangular domain with isotropic fixed sources and vacuum boundary conditions. Let the domain be the unit square with coordinates $(x,y) \\in [0,1] \\times [0,1]$, discretized into a uniform Cartesian mesh of $N_x \\times N_y$ rectangular cells of widths $\\Delta x = 1/N_x$ and $\\Delta y = 1/N_y$. The governing equation for the angular flux $\\psi(x,y,\\boldsymbol{\\Omega})$ in direction $\\boldsymbol{\\Omega} = (\\mu,\\eta)$, with $|\\boldsymbol{\\Omega}|=1$, is\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(x,y,\\boldsymbol{\\Omega}) + \\sigma_t(x,y)\\, \\psi(x,y,\\boldsymbol{\\Omega}) = q(x,y),\n$$\nwhere $\\sigma_t(x,y)$ is the total cross section (in $\\mathrm{cm}^{-1}$) and $q(x,y)$ is the isotropic fixed source (in $\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$). Vacuum boundary conditions are imposed, meaning all incoming angular fluxes on boundary inflow are zero.\n\nUse the Simple Corner Balance (SCB) approach in the Discrete Ordinates Method (DOM) with four directions $\\boldsymbol{\\Omega}_m$ corresponding to the cardinal diagonal directions:\n- $\\boldsymbol{\\Omega}_1 = (\\mu,\\eta) = \\left(\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$,\n- $\\boldsymbol{\\Omega}_2 = \\left(-\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$,\n- $\\boldsymbol{\\Omega}_3 = \\left(\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}\\right)$,\n- $\\boldsymbol{\\Omega}_4 = \\left(-\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}\\right)$,\nwith equal quadrature weights $w_m = \\frac{1}{4}$, $m=1,2,3,4$.\n\nIn the SCB method, the cell-wise discretization proceeds by associating angular flux values to the four cell corners. For each direction $\\boldsymbol{\\Omega}_m$, a transport sweep advances corner-to-corner across each cell in upwind order. Within a cell with constant coefficients $\\sigma_t$ and $q$, the SCB corner update assumes a path length\n$$\nL = \\frac{\\Delta x}{|\\mu|} + \\frac{\\Delta y}{|\\eta|},\n$$\nand approximates the outgoing corner flux $\\psi_{\\mathrm{out}}$ from the incoming corner flux $\\psi_{\\mathrm{in}}$ by solving the one-dimensional ordinary differential equation along the characteristic:\n$$\n\\frac{d\\psi}{ds} + \\sigma_t \\psi = q, \\quad s \\in [0,L],\n$$\nwhich yields\n$$\n\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\, e^{-\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - e^{-\\sigma_t L}\\right).\n$$\nAn approximation to the cell-averaged angular flux in the SCB method is taken as the line-average along the characteristic:\n$$\n\\overline{\\psi} = \\frac{1}{L}\\int_0^{L}\\left(\\psi_{\\mathrm{in}} e^{-\\sigma_t s} + \\frac{q}{\\sigma_t}\\left(1-e^{-\\sigma_t s}\\right)\\right) ds = \\psi_{\\mathrm{in}}\\, \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L}\\right).\n$$\nFor vacuum boundaries, all inflow corner fluxes on the domain boundary are set to zero. The scalar flux in a cell is the quadrature-weighted sum of the cell-averaged angular fluxes:\n$$\n\\phi = \\sum_{m=1}^4 w_m\\, \\overline{\\psi}_m.\n$$\nThis SCB approach is known to be positivity-preserving for nonnegative sources $q \\ge 0$ and nonnegative inflow values.\n\nThe objective is to construct and run a set of numerical tests in which material discontinuities align and misalign with the computational grid, and compare SCB performance in both cases in terms of scalar flux error and positivity. Use a high-resolution SCB solution on a refined mesh as a reference (\"truth\") for the error metric.\n\nDefine the relative $\\ell_2$ error between a coarse scalar flux field $\\phi^{\\mathrm{coarse}}_{i,j}$ and a block-averaged fine reference scalar flux $\\phi^{\\mathrm{ref}}_{i,j}$, where the fine mesh is an integer refinement of the coarse mesh, as:\n$$\n\\varepsilon_{\\ell_2} = \\frac{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{coarse}}_{i,j} - \\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}.\n$$\nAlso record the positivity indicator, which is a boolean asserting whether $\\phi^{\\mathrm{coarse}}_{i,j} \\ge 0$ holds for all cells.\n\nTest suite. For all tests below, the fine reference mesh uses $N_x^{\\mathrm{fine}} = 200$ and $N_y^{\\mathrm{fine}} = 200$. The coarse meshes and material/source specifications are:\n\n- Test 1 (Aligned discontinuity, moderate contrast): $N_x = 20$, $N_y = 20$. Let $\\sigma_t(x,y) = 1.0$ and $q(x,y) = 1.0$ for $x < 0.5$, and $\\sigma_t(x,y) = 5.0$ and $q(x,y) = 1.0$ for $x \\ge 0.5$.\n\n- Test 2 (Misaligned discontinuity, moderate contrast): $N_x = 20$, $N_y = 20$. Let $\\sigma_t(x,y) = 1.0$ and $q(x,y) = 1.0$ for $x < 0.53$, and $\\sigma_t(x,y) = 5.0$ and $q(x,y) = 1.0$ for $x \\ge 0.53$.\n\n- Test 3 (Misaligned discontinuity, high contrast, coarser grid): $N_x = 10$, $N_y = 10$. Let $\\sigma_t(x,y) = 0.5$ and $q(x,y) = 1.0$ for $x < 0.52$, and $\\sigma_t(x,y) = 20.0$ and $q(x,y) = 1.0$ for $x \\ge 0.52$.\n\n- Test 4 (Uniform medium baseline): $N_x = 20$, $N_y = 20$. Let $\\sigma_t(x,y) = 2.0$ and $q(x,y) = 1.0$ everywhere.\n\nFor each test, implement the SCB transport sweep with the four specified directions and vacuum boundary conditions to compute the coarse scalar flux, compute the fine reference scalar flux, block-average the fine scalar flux to the coarse mesh, compute the relative $\\ell_2$ error $\\varepsilon_{\\ell_2}$, and check the positivity indicator.\n\nFinal output format. Your program should produce a single line of output containing the results for the four tests as a comma-separated list enclosed in square brackets, where each test’s result is itself a two-element list of the form $[\\varepsilon_{\\ell_2}, \\text{positivity}]$. For example:\n$[[0.0123,True],[0.0456,True],[0.0789,True],[0.0012,True]]$.\nAll numerical values are pure numbers; no physical units are to be included in the output. Angles are unitless directional cosines; no angle unit is required.",
            "solution": "The problem presents a well-defined task in the field of numerical methods for particle transport. It requires the implementation of the Simple Corner Balance (SCB) method for a two-dimensional, steady-state, monoenergetic transport problem and an evaluation of its performance under different material configurations. The problem has been validated and found to be scientifically sound, well-posed, and objective.\n\n### Principle-Based Design of the Solution\n\nThe solution involves developing a numerical simulation based on the Discrete Ordinates Method ($S_N$) with a specific spatial discretization scheme, the Simple Corner Balance (SCB) method. The overall goal is to quantify the numerical error and verify the positivity of the SCB method, particularly in scenarios where material discontinuities are either aligned or misaligned with the computational mesh.\n\n#### 1. Discretization and Problem Setup\n\nThe continuous domain $(x,y) \\in [0,1] \\times [0,1]$ is discretized into a uniform Cartesian grid of $N_x \\times N_y$ cells, each with dimensions $\\Delta x = 1/N_x$ and $\\Delta y = 1/N_y$. The material properties, total cross-section $\\sigma_t(x,y)$ and source term $q(x,y)$, are assumed to be constant within each cell. These constant values are determined by evaluating the given functions at the center of each cell $(i,j)$, located at coordinates $(x_c, y_c) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$ for $i \\in \\{0, ..., N_x-1\\}$ and $j \\in \\{0, ..., N_y-1\\}$.\n\nThe angular domain is discretized using a specific Discrete Ordinates ($S_N$) quadrature set with four directions, $\\boldsymbol{\\Omega}_m = (\\mu_m, \\eta_m)$, and corresponding weights, $w_m$. The provided set consists of the four diagonal directions:\n- $\\boldsymbol{\\Omega}_1 = (1/\\sqrt{2}, 1/\\sqrt{2})$, with $w_1 = 1/4$\n- $\\boldsymbol{\\Omega}_2 = (-1/\\sqrt{2}, 1/\\sqrt{2})$, with $w_2 = 1/4$\n- $\\boldsymbol{\\Omega}_3 = (1/\\sqrt{2}, -1/\\sqrt{2})$, with $w_3 = 1/4$\n- $\\boldsymbol{\\Omega}_4 = (-1/\\sqrt{2}, -1/\\sqrt{2})$, with $w_4 = 1/4$\n\nFor this set, $|\\mu_m| = |\\eta_m| = 1/\\sqrt{2}$ for all $m$.\n\n#### 2. The Transport Sweep and Simple Corner Balance (SCB)\n\nThe core of the simulation is the transport sweep, which is an iterative process that solves for the angular flux $\\psi_m$ for each direction $m$ across the entire spatial grid. The sweep proceeds cell-by-cell in an order determined by the direction of particle travel, ensuring that inflow boundary conditions for each cell are known from either the domain boundaries or previously computed adjacent cells.\n\nFor a direction $\\boldsymbol{\\Omega}_m = (\\mu_m, \\eta_m)$, the sweep progresses:\n- in increasing $i$ index (from $0$ to $N_x-1$) if $\\mu_m > 0$.\n- in decreasing $i$ index (from $N_x-1$ to $0$) if $\\mu_m < 0$.\n- in increasing $j$ index (from $0$ to $N_y-1$) if $\\eta_m > 0$.\n- in decreasing $j$ index (from $N_y-1$ to $0$) if $\\eta_m < 0$.\n\nVacuum boundary conditions imply that any angular flux entering the domain is zero. This provides the starting values for the sweep. The corner fluxes $\\psi_m$ are stored on a grid of vertices of size $(N_x+1) \\times (N_y+1)$.\n\nWithin each cell $(i,j)$ and for each direction $m$, the SCB method relates a single incoming corner flux $\\psi_{\\mathrm{in}}$ to a single outgoing corner flux $\\psi_{\\mathrm{out}}$. The specific corners depend on the direction:\n- For $\\boldsymbol{\\Omega}_1$ ($\\mu>0, \\eta>0$): $\\psi_{\\mathrm{in}}$ is at corner $(i,j)$; $\\psi_{\\mathrm{out}}$ is at $(i+1,j+1)$.\n- For $\\boldsymbol{\\Omega}_2$ ($\\mu<0, \\eta>0$): $\\psi_{\\mathrm{in}}$ is at corner $(i+1,j)$; $\\psi_{\\mathrm{out}}$ is at $(i,j+1)$.\n- For $\\boldsymbol{\\Omega}_3$ ($\\mu>0, \\eta<0$): $\\psi_{\\mathrm{in}}$ is at corner $(i,j+1)$; $\\psi_{\\mathrm{out}}$ is at $(i+1,j)$.\n- For $\\boldsymbol{\\Omega}_4$ ($\\mu<0, \\eta<0$): $\\psi_{\\mathrm{in}}$ is at corner $(i+1,j+1)$; $\\psi_{\\mathrm{out}}$ is at $(i,j)$.\n\nThe update is derived by solving the 1D transport equation along a characteristic path of length $L = \\frac{\\Delta x}{|\\mu_m|} + \\frac{\\Delta y}{|\\eta_m|}$. This specific (and simplified) path length is a defining feature of the SCB variant used here. The solution gives the outgoing flux:\n$$\n\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\, e^{-\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - e^{-\\sigma_t L}\\right)\n$$\nwhere $\\sigma_t$ and $q$ are the constant properties of the cell.\n\n#### 3. Calculation of Scalar Flux\n\nAfter computing the outgoing corner flux, the cell-averaged angular flux $\\overline{\\psi}_m$ for the current cell and direction is calculated. This is found by averaging the flux solution along the same characteristic path:\n$$\n\\overline{\\psi}_m = \\psi_{\\mathrm{in}}\\, \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L}\\right)\n$$\nTo handle the case of $\\sigma_t \\rightarrow 0$ numerically, these expressions can be implemented using the `expm1` function or a Taylor series approximation for small $\\sigma_t L$.\n\nThe total cell-averaged scalar flux $\\phi_{i,j}$ is then obtained by summing the contributions from all four angular directions, weighted by the quadrature weights:\n$$\n\\phi_{i,j} = \\sum_{m=1}^4 w_m\\, \\overline{\\psi}_{m,i,j}\n$$\nThis process is repeated for all cells, completing the calculation of the scalar flux field for the entire grid.\n\n#### 4. Verification and Error Analysis\n\nThe problem requires a verification study. A high-resolution reference solution is generated using the same SCB method on a fine mesh ($N_x^{\\mathrm{fine}} = 200, N_y^{\\mathrm{fine}} = 200$). This reference scalar flux field, $\\phi^{\\mathrm{fine}}$, is considered the \"truth\" for the purpose of this analysis.\n\nTo compare the coarse-mesh solution $\\phi^{\\mathrm{coarse}}$ with the reference, the fine-mesh solution must be projected onto the coarse grid. This is done via block averaging: each cell in the coarse reference grid, $\\phi^{\\mathrm{ref}}_{i,j}$, is assigned the arithmetic mean of all the fine-grid cell fluxes it geometrically contains.\n\nThe relative $\\ell_2$ error norm is then computed as:\n$$\n\\varepsilon_{\\ell_2} = \\frac{\\|\\phi^{\\mathrm{coarse}} - \\phi^{\\mathrm{ref}}\\|_2}{\\|\\phi^{\\mathrm{ref}}\\|_2} = \\frac{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{coarse}}_{i,j} - \\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}\n$$\nThis metric quantifies the average deviation of the coarse solution from the reference. The test cases are designed to highlight how this error is affected by the alignment of material discontinuities with the mesh. When a discontinuity is misaligned, a single coarse cell may straddle two different material regions. The cell-center sampling scheme assigns one set of properties to the entire cell, introducing a \"smearing\" error that is expected to increase $\\varepsilon_{\\ell_2}$.\n\nFinally, a positivity check is performed to verify that $\\phi^{\\mathrm{coarse}}_{i,j} \\ge 0$ for all cells $(i,j)$. The SCB method with non-negative sources and inflow conditions is inherently positivity-preserving, so this serves as a check on the correctness of the implementation.\n\nThe overall algorithm is implemented in a single Python script leveraging the `numpy` library for efficient array operations. A main function orchestrates the execution of the four specified test cases, each time computing a coarse solution and its corresponding reference solution, calculating the error and positivity, and finally formatting the results as required.",
            "answer": "```python\nimport numpy as np\n\ndef run_scb_simulation(Nx, Ny, sigma_t_func, q_func):\n    \"\"\"\n    Executes a Simple Corner Balance (SCB) simulation on a grid.\n    \n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        sigma_t_func (callable): Function sigma_t(x, y) returning the total cross-section.\n        q_func (callable): Function q(x, y) returning the isotropic source.\n\n    Returns:\n        numpy.ndarray: A (Nx, Ny) array of cell-averaged scalar fluxes.\n    \"\"\"\n    dx = 1.0 / Nx\n    dy = 1.0 / Ny\n\n    # Cell-centered properties (using (i,j) for (x,y) indices)\n    sigma_t_cells = np.zeros((Nx, Ny))\n    q_cells = np.zeros((Nx, Ny))\n    for i in range(Nx):\n        for j in range(Ny):\n            x_c = (i + 0.5) * dx\n            y_c = (j + 0.5) * dy\n            sigma_t_cells[i, j] = sigma_t_func(x_c, y_c)\n            q_cells[i, j] = q_func(x_c, y_c)\n\n    # Angular directions and weights\n    sqrt2_inv = 1.0 / np.sqrt(2.0)\n    directions = [\n        (sqrt2_inv, sqrt2_inv),    # m=0: mu > 0, eta > 0\n        (-sqrt2_inv, sqrt2_inv),   # m=1: mu < 0, eta > 0\n        (sqrt2_inv, -sqrt2_inv),  # m=2: mu > 0, eta < 0\n        (-sqrt2_inv, -sqrt2_inv)  # m=3: mu < 0, eta < 0\n    ]\n    weights = [0.25, 0.25, 0.25, 0.25]\n\n    # Corner fluxes: 4 directions, (Nx+1) x (Ny+1) grid\n    psi_corners = np.zeros((4, Nx + 1, Ny + 1))\n    \n    # Cell-averaged scalar flux\n    phi_cells = np.zeros((Nx, Ny))\n    \n    TINY_VAL = 1e-9\n\n    for m, (mu, eta) in enumerate(directions):\n        w = weights[m]\n        \n        # Determine sweep ranges based on direction signs\n        i_range = range(Nx) if mu > 0 else range(Nx - 1, -1, -1)\n        j_range = range(Ny) if eta > 0 else range(Ny - 1, -1, -1)\n\n        for i in i_range:\n            for j in j_range:\n                sigma_t = sigma_t_cells[i, j]\n                q = q_cells[i, j]\n\n                # Identify incoming corner based on sweep direction\n                if m == 0:  # mu > 0, eta > 0\n                    psi_in = psi_corners[m, i, j]\n                elif m == 1:  # mu < 0, eta > 0\n                    psi_in = psi_corners[m, i + 1, j]\n                elif m == 2:  # mu > 0, eta < 0\n                    psi_in = psi_corners[m, i, j + 1]\n                else:  # m == 3, mu < 0, eta < 0\n                    psi_in = psi_corners[m, i + 1, j + 1]\n\n                # Path length as defined in the problem\n                L = dx / abs(mu) + dy / abs(eta)\n                sigma_L = sigma_t * L\n                \n                if sigma_t < TINY_VAL:\n                    # Taylor expansion for sigma_t -> 0\n                    psi_out = psi_in + q * L\n                    psi_avg = psi_in + q * L / 2.0\n                else:\n                    # Numerically stable formulation for update equations\n                    # exp_term = exp(-sigma_L)\n                    # 1 - exp_term = -expm1(-sigma_L)\n                    m_expm1_sl = -np.expm1(-sigma_L)\n                    psi_out = psi_in * (1.0 - m_expm1_sl) + (q / sigma_t) * m_expm1_sl\n                    \n                    # Cell-averaged angular flux\n                    avg_factor = m_expm1_sl / sigma_L\n                    psi_avg = psi_in * avg_factor + (q / sigma_t) * (1.0 - avg_factor)\n                \n                # Update outgoing corner\n                if m == 0:  # mu > 0, eta > 0\n                    psi_corners[m, i + 1, j + 1] = psi_out\n                elif m == 1:  # mu < 0, eta > 0\n                    psi_corners[m, i, j + 1] = psi_out\n                elif m == 2:  # mu > 0, eta < 0\n                    psi_corners[m, i + 1, j] = psi_out\n                else:  # m == 3, mu < 0, eta < 0\n                    psi_corners[m, i, j] = psi_out\n\n                phi_cells[i, j] += w * psi_avg\n                \n    return phi_cells\n\ndef block_average(phi_fine, Nx_coarse, Ny_coarse):\n    \"\"\" Averages a fine grid solution onto a coarse grid. \"\"\"\n    Nx_fine, Ny_fine = phi_fine.shape\n    ref_x = Nx_fine // Nx_coarse\n    ref_y = Ny_fine // Ny_coarse\n    \n    phi_ref_coarse = np.zeros((Nx_coarse, Ny_coarse))\n    for i in range(Nx_coarse):\n        for j in range(Ny_coarse):\n            block = phi_fine[i * ref_x : (i + 1) * ref_x,\n                             j * ref_y : (j + 1) * ref_y]\n            phi_ref_coarse[i, j] = np.mean(block)\n    return phi_ref_coarse\n\ndef solve():\n    \"\"\"\n    Main driver function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test 1 (Aligned, moderate contrast)\",\n            \"Nx\": 20, \"Ny\": 20,\n            \"sigma_t_func\": lambda x, y: 1.0 if x < 0.5 else 5.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n        {\n            \"name\": \"Test 2 (Misaligned, moderate contrast)\",\n            \"Nx\": 20, \"Ny\": 20,\n            \"sigma_t_func\": lambda x, y: 1.0 if x < 0.53 else 5.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n        {\n            \"name\": \"Test 3 (Misaligned, high contrast, coarser grid)\",\n            \"Nx\": 10, \"Ny\": 10,\n            \"sigma_t_func\": lambda x, y: 0.5 if x < 0.52 else 20.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n        {\n            \"name\": \"Test 4 (Uniform medium baseline)\",\n            \"Nx\": 20, \"Ny\": 20,\n            \"sigma_t_func\": lambda x, y: 2.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n    ]\n\n    Nx_fine, Ny_fine = 200, 200\n    results = []\n\n    for case in test_cases:\n        Nx_coarse, Ny_coarse = case[\"Nx\"], case[\"Ny\"]\n        sigma_t_func = case[\"sigma_t_func\"]\n        q_func = case[\"q_func\"]\n\n        # Run coarse simulation\n        phi_coarse = run_scb_simulation(Nx_coarse, Ny_coarse, sigma_t_func, q_func)\n\n        # Run fine reference simulation\n        phi_fine = run_scb_simulation(Nx_fine, Ny_fine, sigma_t_func, q_func)\n\n        # Block-average the reference solution\n        phi_ref = block_average(phi_fine, Nx_coarse, Ny_coarse)\n\n        # Calculate relative l2 error\n        diff = phi_coarse - phi_ref\n        l2_err_num = np.sqrt(np.sum(diff**2))\n        l2_err_den = np.sqrt(np.sum(phi_ref**2))\n        rel_l2_error = l2_err_num / l2_err_den if l2_err_den > 0 else 0.0\n\n        # Check positivity\n        positivity = bool(np.all(phi_coarse >= 0))\n\n        results.append([rel_l2_error, positivity])\n\n    # Format and print the final output\n    result_str = ','.join([str(res) for res in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "After implementing specific verification tests, the final practice elevates your perspective from a user to a developer of computational tools. You are tasked with designing a complete and rigorous verification suite for an SCB-based transport code . This capstone exercise requires you to understand the distinct purpose of canonical benchmarks—such as the Method of Manufactured Solutions, the Marshak wave, and Reed's problem—in systematically testing a code's accuracy, robustness, and conservation properties.",
            "id": "4248707",
            "problem": "You are asked to design a rigorous, self-consistent verification suite for a Simple Corner Balance (SCB) spatial discretization of the linear transport equation used in nuclear reactor simulation. Assume a standard Discrete Ordinates (DO) angular discretization (often written as $S_n$), uniform Cartesian meshes in $2$-D, and, when needed, a backward Euler time integrator for transient tests. The goal is to verify conservation, robustness across regimes (streaming, diffusion, strong absorber and void), and accuracy (grid and angle convergence) without relying on any unverified external references. Your suite must include tests based on the Method of Manufactured Solutions (MMS), Marshak wave transient problems, line source problems, and Reed’s problem. You must also specify error metrics and balance checks that are necessary and sufficient to establish that the SCB scheme is both locally conservative and asymptotically correct in the thick diffusion limit, while remaining accurate and robust in highly streaming-dominated configurations.\n\nFrom first principles, build your reasoning on: (i) the linear Boltzmann transport equation (streaming plus removal equals sources plus scattering) and its cell-integrated balance form, (ii) the definition and use of MMS for a Partial Differential Equation (PDE), (iii) the asymptotic diffusion limit of transport as the mean free path tends to $0$ (thick diffusion limit), and (iv) properties of canonical benchmarks: Marshak wave to probe the diffusion regime under Marshak-type boundary injection, line source to probe ray effects and angular resolution, and Reed’s fixed-source problem to probe deep penetration with voids and strong absorbers. Do not assume access to external analytic reference solutions beyond what can be derived from these bases.\n\nWhich option below most completely and correctly specifies a verification suite and associated error and balance checks that accomplish these goals for SCB?\n\nA. Include: ($1$) a $2$-D MMS with smooth, bounded scalar flux and angular flux constructed by selecting a smooth target solution and deriving the volumetric source and boundary inflow to make it an exact solution of the steady transport equation; perform mesh refinement and verify the observed spatial order by comparing cell-averaged scalar flux errors in $L^1$, $L^2$, and $L^\\infty$ norms, and verify that the discrete cell-wise balance residual (streaming divergence plus removal minus sources) converges to the nonlinear solver tolerance and scales down with mesh size. ($2$) A transient Marshak wave in a highly scattering medium with Marshak-type inflow on a boundary and reflective boundary elsewhere; verify the thick diffusion limit by running a family of problems with scattering ratio $c \\to 1$ and mean free path tending to $0$ while keeping diffusive scalings fixed, comparing the SCB cell-centered scalar flux against the corresponding discrete diffusion solution produced by the same mesh and time step, and check that global energy balance (integrated over the domain) holds to solver tolerance at each time step. ($3$) A $2$-D line source in a void/low-absorption medium with vacuum boundary; verify angular convergence by refining $S_n$ quadrature order $n$ and measuring error decay in $L^2$ and $L^\\infty$ relative to a highly resolved angular solution, and verify that spurious negative scalar fluxes do not develop and that rotational symmetry about the source is respected up to discretization error. ($4$) Reed’s problem with prescribed piecewise-constant cross sections, including voids and strong absorbers; verify local cell-wise balance, interfaces conservation (net current continuity across material interfaces in the discrete sense), nonnegativity of the scalar flux within solver tolerance, and robustness of the sweep (no breakdown in voids). For all tests, report both local and global balance residuals, and confirm that symmetry constraints implied by the geometry and boundary conditions are satisfied. \nB. Include: ($1$) a $1$-D eigenvalue calculation of a multiplying system to estimate the effective multiplication factor and compare it to a Monte Carlo code, ($2$) a random source transient for which no analytic or manufactured reference is constructed, and ($3$) a vacuum slab problem with a constant isotropic source; verify only that the domain-integrated source equals the sum of removal and leakage to within a fixed tolerance on the coarsest mesh, without mesh refinement or angular refinement studies, and do not include Marshak wave, line source, or Reed’s problem. \nC. Include: ($1$) a $2$-D MMS but assess error only in $L^\\infty$ norm at cell centers and assume second-order spatial accuracy for all solutions including those with discontinuous cross sections, ($2$) a Marshak wave with vacuum boundary conditions only, evaluated at a single time without varying the scattering ratio, and ($3$) a ring source problem in a purely absorbing medium; verify only global balance and do not check cell-wise balance or interface conservation, and assume angular resolution is unnecessary so no $S_n$ refinement is performed. \nD. Include: ($1$) MMS and Reed’s problem, ($2$) a line source with reflecting boundaries on all sides of the square domain to trap radiation indefinitely, and ($3$) a Marshak wave posed with periodic boundary conditions and comparison against equilibrium diffusion at late time; for error and balance checks, focus on integrated energy conservation over the full domain and allow local cell-wise imbalances if they average out globally, and accept negative scalar flux values if they do not change the global conservation up to tolerance. \nE. Include: ($1$) a $3$-D MMS with non-smooth target solution exhibiting jump discontinuities at arbitrary planes, ($2$) a steady diffusion problem with isotropic scattering ratio $c \\approx 1$ only, and ($3$) a point absorber test; verify thick diffusion limit by comparing the SCB solution directly to the continuous diffusion equation without discretizing it on the same mesh, and omit line source and Marshak wave because angular and transient effects are deemed secondary; do not perform angular refinement studies and check only $L^2$ errors without reporting local balance residuals.\n\nSelect the best option.",
            "solution": "The problem asks for the most complete and correct specification of a verification suite for a Simple Corner Balance (SCB) spatial discretization of the linear transport equation. The suite must be rigorous, self-consistent, and based on first principles, covering conservation, robustness, and accuracy.\n\n**1. Validation of the Problem Statement**\n\n**Step 1: Extract Givens**\n-   **Method:** Simple Corner Balance (SCB) spatial discretization.\n-   **Equation:** Linear Boltzmann transport equation (BTE).\n-   **Discretization Context:** 2-D uniform Cartesian meshes, Discrete Ordinates (DO, $S_n$) angular discretization, backward Euler time integration.\n-   **Verification Goals:** Conservation (local and global), robustness (streaming, diffusion, strong absorber, void regimes), and accuracy (grid and angle convergence).\n-   **Constraint:** No reliance on unverified external references.\n-   **Required Test Suite Components:** Method of Manufactured Solutions (MMS), Marshak wave problems, line source problems, and Reed’s problem.\n-   **Required Checks:** Error metrics and balance checks to establish local conservation, asymptotic correctness in the thick diffusion limit, and accuracy/robustness in streaming-dominated configurations.\n-   **Foundational Principles:** (i) The linear BTE and its cell-integrated balance form; (ii) The definition and use of MMS; (iii) The asymptotic diffusion limit; (iv) Properties of the canonical benchmarks (Marshak wave, line source, Reed's problem).\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is firmly established in the field of numerical methods for radiation transport, a sub-discipline of nuclear engineering and computational physics. All concepts—the BTE, SCB, $S_n$, MMS, and the specified benchmark problems—are standard and scientifically sound.\n-   **Well-Posed:** The task is to evaluate and select the best option describing a verification suite. The criteria for \"best\" are clearly defined by a comprehensive list of required tests and verification goals. The question is structured to have a single best answer among the choices.\n-   **Objective:** The language is technical, precise, and free of subjectivity. It outlines a set of formal requirements for a verification procedure.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It is a well-posed, scientifically grounded, and objective request to evaluate a set of technical proposals against a rigorous set of criteria derived from first principles of numerical verification. The problem is complete and internally consistent. I will proceed to derive the ideal solution and evaluate the options.\n\n**2. Derivation of the Correct Verification Suite from First Principles**\n\nA rigorous verification suite for a numerical scheme like SCB must systematically test its fundamental properties as dictated by the governing PDE and the discretization method.\n\n**I. Accuracy Verification (MMS):**\nThe purpose of the Method of Manufactured Solutions (MMS) is to confirm that the code implementation correctly achieves the theoretical order of accuracy of the numerical scheme.\n-   **Principle:** The BTE is $L(\\psi) = Q$. We choose a manufactured solution $\\psi_m$ and substitute it into the BTE to find the corresponding manufactured source, $Q_m = L(\\psi_m)$. The code is then run to solve $L(\\psi_h) = Q_m$, where $\\psi_h$ is the numerical solution. The error $e = \\psi_h - \\psi_m$ must vanish as the discretization is refined.\n-   **Procedure:** To observe the asymptotic, formal order of accuracy, $\\psi_m$ must be sufficiently smooth (e.g., infinitely differentiable). For SCB on a uniform Cartesian grid, the theoretical accuracy for the cell-averaged scalar flux $\\bar{\\phi}$ is second order. We must perform a grid refinement study, solving the problem on a sequence of meshes with decreasing cell size $h$. The error is quantified using various norms, such as the $L^1$, $L^2$, and $L^\\infty$ norms. The observed rate of convergence $p$, calculated from $||e_h|| / ||e_{h/2}|| \\approx 2^p$, should be close to the theoretical value of $2$.\n-   **Checks:** The primary check is the convergence rate $p$. Additionally, the discrete balance equation for each cell, $\\text{Leakage} + \\text{Removal} - \\text{Total Source} = R_{i,j}$, must be satisfied, meaning the residual $R_{i,j}$ should converge to the solver's tolerance.\n\n**II. Asymptotic Diffusion Limit (Marshak Wave):**\nThe transport equation must correctly asymptote to the diffusion equation in the thick, scattering-dominated limit.\n-   **Principle:** In the limit where the mean free path $\\lambda = 1/\\Sigma_t \\to 0$ and the scattering ratio $c = \\Sigma_s/\\Sigma_t \\to 1$, an asymptotic analysis shows the BTE simplifies to a diffusion equation for the scalar flux $\\phi$: $-\\vec{\\nabla} \\cdot D \\vec{\\nabla} \\phi + \\Sigma_a \\phi = S$, where $\\Sigma_a = \\Sigma_t - \\Sigma_s$ and $D \\approx 1/(3\\Sigma_{tr})$. A robust transport scheme must numerically reproduce this behavior.\n-   **Procedure:** The Marshak wave problem is the canonical test. A transient problem is set up in a domain with a high scattering cross-section $\\Sigma_s$ and total cross-section $\\Sigma_t$. A flux is injected at a boundary (a Marshak-type, or first-kind, boundary condition). To perform a self-contained verification, one must solve the corresponding diffusion equation using a simple, verified numerical method (e.g., finite differences) on the *exact same spatial mesh and with the same time-stepper*.\n-   **Checks:** The scalar flux from the SCB transport solution, $\\phi_{SCB}$, is compared to the scalar flux from the discrete diffusion solution, $\\phi_{Diff}$. The disagreement between the two should systematically decrease as the problem parameters are pushed further into the diffusion limit (i.e., as $\\Sigma_t L$ increases and $c$ approaches $1$, where $L$ is a characteristic length). Global particle balance (total particles in domain + total leakage + total absorption = total source) must be verified to machine precision at each time step.\n\n**III. Streaming and Angular Accuracy (Line Source):**\nThe scheme must be robust and accurate in the streaming limit (near-vacuum), where angular effects are dominant.\n-   **Principle:** In a near-vacuum, particles stream undeflected along straight lines. The $S_n$ discretization approximates the continuous angular variable with a finite set of directions, leading to \"ray effects\"—unphysical spatial variations in the scalar flux.\n-   **Procedure:** A line source in a 2-D square domain with vacuum boundary conditions is the standard test. The source emits particles that stream to the boundaries. An angular refinement study is performed by increasing the $S_n$ quadrature order (e.g., $S_4, S_8, S_{16}, ...$).\n-   **Checks:** The solution should converge to a reference solution computed with a very high $S_n$ order. The error is measured in $L^2$ and $L^\\infty$ norms. One must also verify that the solution respects the problem's symmetry (e.g., rotational for a point source) up to discretization error. A critical quality check is for non-negativity; while linear schemes like SCB are not guaranteed to be positive, the magnitude of any negative fluxes should be small and vanish upon refinement.\n\n**IV. Robustness in Heterogeneous Media (Reed's Problem):**\nThe scheme must handle strong, discontinuous variations in material properties.\n-   **Principle:** Nuclear reactors contain materials with vastly different properties (fuel, moderator, control rods, voids). The numerical scheme must be robust and maintain conservation across material interfaces.\n-   **Procedure:** Reed's problem is a 1-D slab geometry problem with five regions, including a near-vacuum, a strong absorber, and a scattering region.\n-   **Checks:**\n    1.  **Local Cell Balance:** The discrete particle balance equation must hold for every cell, regardless of its material.\n    2.  **Interface Conservation:** The net current across any cell interface must be continuous. This is a hallmark of finite-volume-type methods like SCB.\n    3.  **Robustness:** The transport sweep algorithm must not fail or exhibit extreme convergence degradation, particularly in the void and high-absorption regions.\n    4.  **Non-negativity:** The scalar flux should remain non-negative.\n\n**3. Evaluation of Options**\n\n-   **Option A:** This option correctly specifies all four required tests. (1) MMS is described correctly with smooth solutions, multi-norm error analysis, and convergence rate checks. (2) The Marshak wave test is correctly formulated to verify the diffusion limit by comparing against a consistently discretized diffusion solution. (3) The line source test is correctly specified with vacuum boundaries, angular refinement, and checks for symmetry and positivity. (4) Reed's problem is correctly used to check local balance, interface conservation, and robustness. The overall requirement to report both local and global balance residuals is crucial and correctly stated. This option is comprehensive and technically sound. **Correct**.\n\n-   **Option B:** This option is fundamentally flawed. It replaces rigorous verification with ad-hoc tests and validation. (1) Comparison to Monte Carlo is a validation, not verification, task. (2) A random source transient without a known solution is useful only for checking conservation, not accuracy. (3) The checks are trivial (coarse mesh only) and it omits the three most important benchmark problems (Marshak, Line Source, Reed's). **Incorrect**.\n\n-   **Option C:** This option contains multiple errors. (1) Limiting MMS error to $L^\\infty$ is incomplete, and assuming second-order accuracy even with discontinuous cross-sections is wrong—the rate degrades. (2) Using only vacuum boundaries for a Marshak wave and not varying parameters prevents a test of the diffusion limit. (3) Omitting $S_n$ refinement means that angular accuracy is not verified. (4) Verifying only global balance and not local/interface conservation is a critical omission for a scheme whose primary virtue is local conservation. **Incorrect**.\n\n-   **Option D:** This option proposes incorrectly designed tests. (2) A line source with reflecting boundaries is the wrong setup; it traps radiation and masks the streaming behavior and ray effects that the test is designed to probe. (3) A Marshak wave with periodic BCs is non-physical and not a standard test. Most critically, the philosophy of (4) allowing local cell-wise imbalances as long as they \"average out\" is a direct violation of the principles of a conservative finite-volume scheme. Local conservation is a non-negotiable requirement. **Incorrect**.\n\n-   **Option E:** This option contains significant methodological errors. (1) Using a non-smooth solution for an MMS to check the formal convergence order is incorrect; it will not reveal the asymptotic rate. (2) Comparing the transport solution to the *continuous* diffusion equation is wrong; for a rigorous, self-contained test of the asymptotic limit, the comparison must be between two *discrete* solutions on the same grid to isolate a single source of error. (3) It omits the Marshak wave and line source tests, and fails to perform angular refinement, thus missing key verification objectives. **Incorrect**.\n\n**Conclusion:** Option A provides the only description of a verification suite that is complete, rigorous, and technically correct according to the first principles of numerical code verification for transport methods.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}