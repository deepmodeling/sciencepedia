{
    "hands_on_practices": [
        {
            "introduction": "The emergence of unphysical negative fluxes is often a direct consequence of the numerical methods used to solve the underlying transport or diffusion equations. This exercise delves into the stability of the explicit time-dependent diffusion equation, tasking you with deriving the precise conditions on time step and mesh size that guarantee a positive solution. By understanding these limitations , you will gain insight into why implicit methods are often preferred for their unconditional stability and positivity-preserving properties.",
            "id": "4237665",
            "problem": "Consider a one-dimensional slab model for single-group neutron diffusion with absorption, written in non-dimensionalized form obtained by scaling time with the neutron speed so that the time derivative has unit coefficient. The governing equation for the neutron flux $\\,\\phi(x,t)\\,$ on the domain $\\,x \\in [0,L]\\,$ is\n$$\n\\frac{\\partial \\phi}{\\partial t} \\;=\\; D \\,\\frac{\\partial^{2}\\phi}{\\partial x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi \\;+\\; S(x,t),\n$$\nwhere $\\,D>0\\,$ is the diffusion coefficient and $\\,\\Sigma_{a} \\ge 0\\,$ is the macroscopic absorption cross section. Assume homogeneous Dirichlet boundary conditions $\\,\\phi(0,t) = \\phi(L,t) = \\phi_{b}\\,$ with $\\,\\phi_{b} \\ge 0\\,$ and a nonnegative source $\\,S(x,t) \\ge 0\\,$. Discretize space on a uniform mesh $\\,x_{i} = i\\,\\Delta x\\,$, $\\,i=0,1,\\dots,N\\,$, and approximate the Laplacian with the standard second-order central difference. Advance in time using forward Euler with time step $\\,\\Delta t\\,$:\n$$\n\\phi^{n+1}_{i} \\;=\\; \\phi^{n}_{i} \\;+\\; \\Delta t \\left[ D\\,\\frac{\\phi^{n}_{i+1} - 2\\,\\phi^{n}_{i} + \\phi^{n}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n}_{i} \\;+\\; S^{n}_{i} \\right]\n$$\nfor $\\,i=1,2,\\dots,N-1\\,$, with $\\,\\phi^{n}_{0}=\\phi^{n}_{N}=\\phi_{b}\\,$. Assume $\\,\\phi^{n}_{i} \\ge 0\\,$ for all $\\,i\\,$ and $\\,S^{n}_{i} \\ge 0\\,$. Using the discrete maximum principle (DMP) framework and monotonicity arguments suitable for preventing negative flux, derive the condition on the coefficients of this explicit update that guarantees $\\,\\phi^{n+1}_{i} \\ge 0\\,$ whenever $\\,\\phi^{n}_{i} \\ge 0\\,$ and $\\,S^{n}_{i} \\ge 0\\,$. From this condition, obtain an inequality that couples $\\,\\Delta t\\,$ and $\\,\\Delta x\\,$.\n\nNow, suppose the explicit time step is chosen to be one half of the absorption timescale in this non-dimensionalized system, specifically $\\,\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}\\,$. Under this choice, deduce a bound on the mesh size $\\,\\Delta x\\,$ in terms of $\\,D\\,$ and $\\,\\Sigma_{a}\\,$ that guarantees positivity of the explicit update for all interior points. Express your final bound on $\\,\\Delta x\\,$ in centimeters.\n\nFinally, explain, by referring to the structure of the backward Euler matrix and the concept of an $\\mathsf{M}$-matrix (where $\\mathsf{M}$ stands for a matrix with nonpositive off-diagonals and inverse that is componentwise nonnegative), how fully implicit schemes relax the explicit positivity bound you derived. The final answer must be a single closed-form expression for the required lower bound on $\\,\\Delta x\\,$. No numerical values are provided, so no rounding is required. Express the final bound in centimeters.",
            "solution": "The problem statement will first be validated for scientific soundness, consistency, and completeness before a solution is attempted.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Governing Equation:** The one-dimensional, single-group neutron diffusion equation is given as\n$$\n\\frac{\\partial \\phi}{\\partial t} \\;=\\; D \\,\\frac{\\partial^{2}\\phi}{\\partial x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi \\;+\\; S(x,t)\n$$\n- **Domain:** $x \\in [0,L]$.\n- **Coefficients:** Diffusion coefficient $D > 0$, macroscopic absorption cross section $\\Sigma_{a} \\ge 0$.\n- **Boundary and Initial Conditions:** Homogeneous Dirichlet boundary conditions $\\phi(0,t) = \\phi(L,t) = \\phi_{b}$ with $\\phi_{b} \\ge 0$. Initial flux is nonnegative, $\\phi(x,0) \\ge 0$.\n- **Source Term:** Nonnegative source, $S(x,t) \\ge 0$.\n- **Numerical Scheme:**\n  - **Spatial Discretization:** Uniform mesh $x_{i} = i\\,\\Delta x$ for $i=0,1,...,N$. Standard second-order central difference for the Laplacian.\n  - **Temporal Discretization:** Forward Euler with time step $\\Delta t$.\n  - **Fully Discrete Equation:**\n  $$\n  \\phi^{n+1}_{i} \\;=\\; \\phi^{n}_{i} \\;+\\; \\Delta t \\left[ D\\,\\frac{\\phi^{n}_{i+1} - 2\\,\\phi^{n}_{i} + \\phi^{n}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n}_{i} \\;+\\; S^{n}_{i} \\right]\n  $$\n  for interior points $i=1,2,...,N-1$.\n  - **Discrete Boundary Conditions:** $\\phi^{n}_{0}=\\phi^{n}_{N}=\\phi_{b}$ for all time steps $n$.\n- **Positivity Assumption:** At time step $n$, it is assumed that $\\phi^{n}_{i} \\ge 0$ for all $i$ and $S^{n}_{i} \\ge 0$.\n- **Specific Condition:** A specific time step is chosen for the second part of the analysis: $\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}$.\n- **Objectives:**\n  1. Derive the condition on coefficients that guarantees $\\phi^{n+1}_{i} \\ge 0$.\n  2. Obtain an inequality coupling $\\Delta t$ and $\\Delta x$ from this condition.\n  3. With $\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}$, deduce a lower bound on the mesh size $\\Delta x$.\n  4. Explain how a fully implicit (backward Euler) scheme relaxes this bound, with reference to the concept of an $\\mathsf{M}$-matrix.\n  5. Express the final answer for the lower bound on $\\Delta x$ in centimeters.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding:** The problem is based on the neutron diffusion equation and standard numerical methods (finite differences, forward/backward Euler), which are fundamental concepts in nuclear engineering and computational physics. The analysis of positivity and the use of discrete maximum principles and $\\mathsf{M}$-matrix theory are standard and correct for this context. The model is scientifically sound.\n- **Clarity and Consistency:** The problem is largely well-posed and objective. However, there is a minor contradiction and a point of ambiguity.\n  1. The problem states the equation is in \"non-dimensionalized form\" but then asks for a final answer in \"centimeters\". This is contradictory. A truly non-dimensional system has no units. A careful dimensional analysis of the time-transformed equation $\\frac{\\partial \\phi}{\\partial t} = D \\frac{\\partial^2\\phi}{\\partial x^2} - \\dots$ reveals that if the original physical time $t_{phys}$ was scaled via $t = v t_{phys}$ (where $v$ is neutron speed), then the new time variable $t$ has units of length. Under this interpretation, $D$ has units of length (e.g., cm) and $\\Sigma_a$ has units of inverse length (e.g., cm$^{-1}$). This makes all terms in the PDE dimensionally consistent and resolves the apparent contradiction. The problem is thus solvable, assuming this physically-consistent interpretation of the \"non-dimensionalization\" as a time-variable transformation.\n  2. The problem asks to express the final answer in centimeters, but the global formatting rules explicitly forbid units in the final answer box. As a resolution, the derivation will proceed symbolically, with the understanding that if the base units for length are centimeters, the final expression for $\\Delta x$ will naturally be in centimeters. The final boxed answer will adhere to the formatting rules and omit units.\n\n- **Verdict:** The problem is deemed valid and solvable, proceeding with the clarified understanding of the time variable and units.\n\n### Solution\n\nThe first goal is to find the condition under which the explicit forward Euler scheme is positivity-preserving. The scheme for an interior node $i$ is:\n$$\n\\phi^{n+1}_{i} \\;=\\; \\phi^{n}_{i} \\;+\\; \\Delta t \\left[ D\\,\\frac{\\phi^{n}_{i+1} - 2\\,\\phi^{n}_{i} + \\phi^{n}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n}_{i} \\;+\\; S^{n}_{i} \\right]\n$$\nTo analyze positivity, we rearrange the equation to express $\\phi^{n+1}_{i}$ as a linear combination of the values at the previous time step, $\\phi^{n}$:\n$$\n\\phi^{n+1}_{i} \\;=\\; \\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right) \\phi^{n}_{i-1} \\;+\\; \\left(1 - \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} - \\Sigma_{a}\\,\\Delta t\\right) \\phi^{n}_{i} \\;+\\; \\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right) \\phi^{n}_{i+1} \\;+\\; \\Delta t\\,S^{n}_{i}\n$$\nWe are given that all quantities at time step $n$ are non-negative: $\\phi^{n}_{j} \\ge 0$ for all $j$ (including boundary values $\\phi^{n}_{0}=\\phi^{n}_{N}=\\phi_b \\ge 0$), and $S^{n}_{i} \\ge 0$. For $\\phi^{n+1}_{i}$ to be guaranteed non-negative, all coefficients in the linear combination above must be non-negative.\nThe coefficients of $\\phi^{n}_{i-1}$ and $\\phi^{n}_{i+1}$ are $\\frac{D\\,\\Delta t}{\\Delta x^{2}}$. Since $D > 0$, $\\Delta t > 0$, and $\\Delta x^{2} > 0$, these terms are always non-negative.\nThe coefficient of the source term is $\\Delta t$, which is also non-negative.\nThe crucial constraint comes from the coefficient of $\\phi^{n}_{i}$:\n$$\n1 - \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} - \\Sigma_{a}\\,\\Delta t \\;\\ge\\; 0\n$$\nThis inequality is the condition on the coefficients that guarantees positivity. This is a classic result from applying the discrete maximum principle.\n\nFrom this condition, we can derive the inequality that couples the time step $\\Delta t$ and the mesh spacing $\\Delta x$:\n$$\n1 \\;\\ge\\; \\Delta t \\left( \\frac{2\\,D}{\\Delta x^{2}} + \\Sigma_{a} \\right)\n$$\nThis can be expressed as a stability limit on the time step:\n$$\n\\Delta t \\;\\le\\; \\frac{1}{\\frac{2\\,D}{\\Delta x^{2}} + \\Sigma_{a}}\n$$\nThis inequality shows that the maximum allowable time step for a positivity-preserving explicit scheme is limited by both diffusion (a $\\Delta x^{-2}$ dependence) and absorption (a constant dependence).\n\nNext, we are asked to consider the specific case where the time step is chosen as $\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}$. We substitute this into the primary positivity condition:\n$$\n1 - \\frac{2\\,D}{\\Delta x^{2}} \\left(\\frac{1}{2\\,\\Sigma_{a}}\\right) - \\Sigma_{a} \\left(\\frac{1}{2\\,\\Sigma_{a}}\\right) \\;\\ge\\; 0\n$$\nSimplifying the expression gives:\n$$\n1 - \\frac{D}{\\Sigma_{a}\\,\\Delta x^{2}} - \\frac{1}{2} \\;\\ge\\; 0\n$$\n$$\n\\frac{1}{2} - \\frac{D}{\\Sigma_{a}\\,\\Delta x^{2}} \\;\\ge\\; 0\n$$\nWe can now rearrange this inequality to find a bound on the mesh size $\\Delta x$:\n$$\n\\frac{1}{2} \\;\\ge\\; \\frac{D}{\\Sigma_{a}\\,\\Delta x^{2}}\n$$\n$$\n\\Sigma_{a}\\,\\Delta x^{2} \\;\\ge\\; 2\\,D\n$$\n$$\n\\Delta x^{2} \\;\\ge\\; \\frac{2\\,D}{\\Sigma_{a}}\n$$\nSince $\\Delta x > 0$, we can take the square root of both sides to obtain the final bound on $\\Delta x$:\n$$\n\\Delta x \\;\\ge\\; \\sqrt{\\frac{2\\,D}{\\Sigma_{a}}}\n$$\nThis inequality specifies a **lower bound** on the mesh size $\\Delta x$. For the chosen time step, if the mesh is too fine (i.e., $\\Delta x$ is too small), the scheme will not be guaranteed to preserve positivity and may produce unphysical negative flux values. The quantity $\\sqrt{D/\\Sigma_{a}}$ has units of length and is known as the diffusion length, a characteristic length scale in reactor physics. The required mesh size must be larger than a value proportional to this length.\n\nFinally, we explain how a fully implicit scheme, such as backward Euler, relaxes this bound. The backward Euler discretization of the diffusion equation is:\n$$\n\\frac{\\phi^{n+1}_{i} - \\phi^{n}_{i}}{\\Delta t} \\;=\\; D\\,\\frac{\\phi^{n+1}_{i+1} - 2\\,\\phi^{n+1}_{i} + \\phi^{n+1}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n+1}_{i} \\;+\\; S^{n+1}_{i}\n$$\nTo solve for the unknown flux $\\phi^{n+1}$, we rearrange the equation, placing all terms involving $\\phi^{n+1}$ on the left-hand side:\n$$\n-\\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right)\\phi^{n+1}_{i-1} + \\left(1 + \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} + \\Sigma_{a}\\,\\Delta t\\right)\\phi^{n+1}_{i} - \\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right)\\phi^{n+1}_{i+1} \\;=\\; \\phi^{n}_{i} + \\Delta t\\,S^{n+1}_{i}\n$$\nThis system of linear equations for the unknown vector $\\mathbf{\\phi}^{n+1}$ can be written in matrix form as $\\mathsf{A}\\,\\mathbf{\\phi}^{n+1} = \\mathbf{b}$.\nThe right-hand side vector $\\mathbf{b}$ has components $b_i = \\phi^n_i + \\Delta t S^{n+1}_i$ plus terms from the boundary conditions. Since we assume $\\phi^n_i \\ge 0$, $S^{n+1}_i \\ge 0$, and $\\phi_b \\ge 0$, the vector $\\mathbf{b}$ is component-wise non-negative, $\\mathbf{b} \\ge 0$.\n\nThe system matrix $\\mathsf{A}$ is a tridiagonal matrix. For any row $i$:\n- The diagonal entry is $A_{ii} = 1 + \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} + \\Sigma_{a}\\,\\Delta t$, which is strictly positive for any $\\Delta t > 0$ and $\\Delta x > 0$.\n- The off-diagonal entries are $A_{i, i-1} = A_{i, i+1} = -\\frac{D\\,\\Delta t}{\\Delta x^{2}}$, which are non-positive.\n\nAccording to the provided definition, a matrix is an $\\mathsf{M}$-matrix if its off-diagonal entries are non-positive and its inverse is component-wise non-negative. For a matrix with non-positive off-diagonals (a Z-matrix), a sufficient condition to be an $\\mathsf{M}$-matrix is that it is strictly diagonally dominant. Let's check for strict diagonal dominance:\n$$\n|A_{ii}| > \\sum_{j \\ne i} |A_{ij}|\n$$\nFor an interior row $i$, this becomes:\n$$\n1 + \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} + \\Sigma_{a}\\,\\Delta t > \\left|-\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right| + \\left|-\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right| = \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}}\n$$\n$$\n1 + \\Sigma_{a}\\,\\Delta t > 0\n$$\nSince $\\Sigma_a \\ge 0$ and $\\Delta t > 0$, this condition is always satisfied. The dominance is even stronger for the first and last rows of the matrix, which only have one off-diagonal element.\nTherefore, the matrix $\\mathsf{A}$ is a strictly diagonally dominant Z-matrix for **any** choice of $\\Delta t > 0$ and $\\Delta x > 0$. This proves that $\\mathsf{A}$ is an $\\mathsf{M}$-matrix, and thus its inverse $\\mathsf{A}^{-1}$ has all non-negative entries, $\\mathsf{A}^{-1} \\ge 0$.\n\nThe solution for the flux at the new time step is $\\mathbf{\\phi}^{n+1} = \\mathsf{A}^{-1}\\mathbf{b}$. Since both $\\mathsf{A}^{-1}$ and $\\mathbf{b}$ are component-wise non-negative, their product $\\mathbf{\\phi}^{n+1}$ is also guaranteed to be non-negative. This holds irrespective of the size of $\\Delta t$ and $\\Delta x$. Consequently, the backward Euler scheme is unconditionally positivity-preserving, and it completely relaxes the restrictive bound on $\\Delta t$ and $\\Delta x$ required by the forward Euler scheme.\n\nThe final bound expression on $\\Delta x$ is the lower bound derived for the explicit scheme. If the units of $D$ are cm and $\\Sigma_a$ are cm$^{-1}$, the resulting unit for the bound on $\\Delta x$ is cm.",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{2D}{\\Sigma_{a}}}}\n$$"
        },
        {
            "introduction": "When negative fluxes do appear, a common remedy is to clip them to zero and renormalize the solution to conserve a key quantity like the total fission source, but this introduces a bias. This practice challenges you to analytically quantify the error introduced in the system's eigenvalue, $k_{\\text{eff}}$, by such a procedure in a simplified, two-region model. This first-principles derivation  provides a clear, mathematical understanding of the trade-off between enforcing positivity and maintaining the accuracy of integral parameters.",
            "id": "4237628",
            "problem": "Consider a one-speed steady-state neutron diffusion eigenvalue problem in a spatial domain composed of two homogeneous material regions, labeled region $A$ and region $B$, with volumes $V_A$ and $V_B$, respectively. The materials are characterized by macroscopic cross sections $\\Sigma_{aA}$, $\\Sigma_{aB}$, $\\Sigma_{sA}$, $\\Sigma_{sB}$, and $\\Sigma_{fA}$, $\\Sigma_{fB}$, and average neutrons per fission $\\nu$ (assume the same $\\nu$ applies in both regions). The flux is approximated as piecewise constant, with $\\phi_A$ in region $A$ and $\\phi_B$ in region $B$. The boundary conditions are reflective, and scattering is assumed to be isoenergetic and number-conserving so that the only net loss mechanism in the domain is absorption.\n\nAn artifact of the numerical discretization produces a small subvolume of region $B$ in which the flux becomes negative. Specifically, a fractional subvolume $\\eta$ of region $B$ has a spurious flux value $-\\epsilon\\,\\phi_B$, with $0<\\epsilon\\ll 1$ and $0<\\eta\\ll 1$, while the remaining fraction $(1-\\eta)$ of region $B$ retains the flux $\\phi_B$. This negative-flux artifact is corrected by a fixup: the negative flux in the $\\eta$ subvolume is clipped to zero, and then the nonnegative flux field is multiplied uniformly by a factor $r$ chosen such that the total volume-integrated fission source after the fixup equals the total volume-integrated fission source before the fixup.\n\nDefine the Effective Multiplication Factor, $k_{\\text{eff}}$, by the steady-state balance between total fission production and total neutron loss in the domain. Under the stated assumptions (reflective boundaries and one-speed with number-conserving scattering), the loss is due only to absorption.\n\nUsing first principles of the reaction-rate balance and the stated fixup and renormalization procedure, derive a first-order analytic expression in $\\eta$ and $\\epsilon$ for the change $\\Delta k_{\\text{eff}}=k_{\\text{eff}}^{(\\text{after})}-k_{\\text{eff}}^{(\\text{before})}$ caused by clipping the negative flux subvolume and renormalizing the total source. Express your final result in terms of the parameters $\\nu$, $\\Sigma_{fA}$, $\\Sigma_{fB}$, $\\Sigma_{aA}$, $\\Sigma_{aB}$, $\\phi_A$, $\\phi_B$, $V_A$, $V_B$, $\\eta$, and $\\epsilon$. You may assume any products of $\\eta$ and $\\epsilon$ beyond first order are negligible. The final answer should be a single closed-form symbolic expression. No numerical evaluation is required.",
            "solution": "The user wants to derive the change in the effective multiplication factor, $\\Delta k_{\\text{eff}}$, resulting from a negative flux fixup procedure.\n\nFirst, we validate the problem statement.\n\n### Step 1: Extract Givens\n- **Problem Type**: one-speed, steady-state neutron diffusion eigenvalue problem.\n- **Domain**: Two homogeneous regions, $A$ and $B$, with volumes $V_A$ and $V_B$.\n- **Material Properties**: Macroscopic cross sections $\\Sigma_{aA}$, $\\Sigma_{aB}$ (absorption); $\\Sigma_{sA}$, $\\Sigma_{sB}$ (scattering); $\\Sigma_{fA}$, $\\Sigma_{fB}$ (fission). Average neutrons per fission is $\\nu$ for both regions.\n- **Boundary Conditions**: Reflective.\n- **Scattering Model**: Isoenergetic and number-conserving. This implies the only net neutron loss mechanism is absorption.\n- **Flux Approximation (Before Fixup)**:\n    - Piecewise constant flux $\\phi_A$ in region $A$.\n    - In a fractional subvolume $\\eta$ of region $B$, the flux is $-\\epsilon\\,\\phi_B$, where $0<\\epsilon\\ll 1$ and $0<\\eta\\ll 1$.\n    - In the remaining fractional subvolume $(1-\\eta)$ of region $B$, the flux is $\\phi_B$.\n- **Fixup Procedure**:\n    1.  The negative flux in subvolume $\\eta V_B$ is clipped to $0$.\n    2.  The resulting non-negative flux field is multiplied by a uniform factor $r$.\n    3.  The factor $r$ is chosen to conserve the total volume-integrated fission source, i.e., the source after fixup equals the source before fixup.\n- **Definition of $k_{\\text{eff}}$**: $k_{\\text{eff}} = \\frac{\\text{Total Fission Production}}{\\text{Total Neutron Loss (Absorption)}}$.\n- **Objective**: Derive a first-order analytic expression for $\\Delta k_{\\text{eff}} = k_{\\text{eff}}^{(\\text{after})} - k_{\\text{eff}}^{(\\text{before})}$ in terms of $\\nu, \\Sigma_{fA}, \\Sigma_{fB}, \\Sigma_{aA}, \\Sigma_{aB}, \\phi_A, \\phi_B, V_A, V_B, \\eta, \\epsilon$.\n- **Approximation**: Products of $\\eta$ and $\\epsilon$ beyond first order are negligible. This is interpreted as finding the leading-order term in an expansion in $\\eta$ and $\\epsilon$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on the neutron diffusion equation and reaction-rate balances, which are fundamental concepts in nuclear reactor physics. Negative flux is a known numerical artifact, and \"fixup\" procedures are a standard topic in computational reactor analysis. The scenario is a simplified but valid model of this phenomenon.\n- **Well-Posed**: The problem is self-contained. All variables and procedures are explicitly defined. The objective is clear, and a unique analytical solution is derivable from the premises.\n- **Objective**: The problem is stated using precise, unbiased technical language.\n- **Completeness and Consistency**: All necessary parameters are provided. The assumptions, such as reflective boundaries and one-speed energy treatment, are consistent and standard for creating a tractable analytical problem. There are no contradictions.\n- **Unrealistic or Infeasible**: The setup is an idealization (e.g., piecewise constant flux) but is not physically impossible or scientifically implausible for its purpose as a model problem.\n- **Structure**: The problem is well-structured and non-trivial. It requires careful application of first principles and algebraic manipulation.\n\n### Step 3: Verdict and Action\nThe problem is valid. The solution will be derived as requested.\n\n### Derivation of the Solution\n\nThe effective multiplication factor, $k_{\\text{eff}}$, is defined as the ratio of the total rate of neutron production from fission to the total rate of neutron loss. Given the problem's assumptions, the only loss mechanism is absorption.\nThe total production rate, $P$, and total absorption rate, $L$, are given by the volume integrals of the respective reaction rates:\n$$P = \\int_V \\nu \\Sigma_f(\\mathbf{r}) \\phi(\\mathbf{r}) dV$$\n$$L = \\int_V \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) dV$$\nTherefore, $k_{\\text{eff}} = P/L$.\n\nTo simplify the notation, let us define the reaction rates for the idealized, positive-flux case in each region:\n- Fission production in region $A$: $P_A = \\nu \\Sigma_{fA} \\phi_A V_A$\n- Fission production in region $B$: $P_B = \\nu \\Sigma_{fB} \\phi_B V_B$\n- Absorption in region $A$: $L_A = \\Sigma_{aA} \\phi_A V_A$\n- Absorption in region $B$: $L_B = \\Sigma_{aB} \\phi_B V_B$\n\n**1. State Before Fixup**\n\nBefore the fixup, the flux field has a spurious negative value in a subvolume of region $B$. We calculate the total production $P_{\\text{before}}$ and loss $L_{\\text{before}}$ by summing the contributions from each part of the domain.\nThe contribution from region $A$ is $P_A$ and $L_A$.\nThe contribution from region $B$ is split into two parts:\n- Subvolume $(1-\\eta)V_B$ with flux $\\phi_B$: Production is $(1-\\eta)P_B$, Absorption is $(1-\\eta)L_B$.\n- Subvolume $\\eta V_B$ with flux $-\\epsilon\\phi_B$: Production is $(-\\epsilon\\eta)P_B$, Absorption is $(-\\epsilon\\eta)L_B$. Note the integration over this subvolume is $\\nu \\Sigma_{fB} (-\\epsilon \\phi_B) (\\eta V_B) = -\\epsilon\\eta (\\nu \\Sigma_{fB} \\phi_B V_B) = -\\epsilon\\eta P_B$.\n\nThe total rates are:\n$$P_{\\text{before}} = P_A + (1-\\eta)P_B - \\epsilon\\eta P_B = P_A + P_B(1 - \\eta - \\epsilon\\eta)$$\n$$L_{\\text{before}} = L_A + (1-\\eta)L_B - \\epsilon\\eta L_B = L_A + L_B(1 - \\eta - \\epsilon\\eta)$$\n\nThus, the multiplication factor before the fixup is:\n$$k_{\\text{eff}}^{(\\text{before})} = \\frac{P_{\\text{before}}}{L_{\\text{before}}} = \\frac{P_A + P_B(1 - \\eta - \\epsilon\\eta)}{L_A + L_B(1 - \\eta - \\epsilon\\eta)}$$\n\n**2. State After Fixup**\n\nThe fixup procedure involves two steps.\nFirst, the negative flux is clipped to zero. The new, unnormalized flux field $\\phi'(\\mathbf{r})$ is:\n- $\\phi'_A = \\phi_A$ in region $A$.\n- $\\phi'_B = \\phi_B$ in subvolume $(1-\\eta)V_B$.\n- $\\phi'_B = 0$ in subvolume $\\eta V_B$.\n\nSecond, this field is renormalized by a factor $r$ such that the total fission source is conserved. The final flux is $\\phi_{\\text{after}}(\\mathbf{r}) = r \\phi'(\\mathbf{r})$.\nThe fission source after renormalization is:\n$$P_{\\text{after}} = \\int_V \\nu \\Sigma_f(\\mathbf{r}) \\phi_{\\text{after}}(\\mathbf{r}) dV = r \\left( \\nu\\Sigma_{fA}\\phi_A V_A + \\nu\\Sigma_{fB}\\phi_B (1-\\eta)V_B \\right) = r(P_A + P_B(1-\\eta))$$\nConservation of the fission source means $P_{\\text{after}} = P_{\\text{before}}$.\n$$r(P_A + P_B(1-\\eta)) = P_A + P_B(1 - \\eta - \\epsilon\\eta)$$\nThis relation defines the renormalization factor $r$, but we will see it is not needed to calculate $k_{\\text{eff}}^{(\\text{after})}$.\n\nThe absorption rate after fixup is calculated with the final flux $\\phi_{\\text{after}}(\\mathbf{r})$:\n$$L_{\\text{after}} = \\int_V \\Sigma_a(\\mathbf{r}) \\phi_{\\text{after}}(\\mathbf{r}) dV = r \\left( \\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B (1-\\eta)V_B \\right) = r(L_A + L_B(1-\\eta))$$\n\nThe multiplication factor after the fixup is:\n$$k_{\\text{eff}}^{(\\text{after})} = \\frac{P_{\\text{after}}}{L_{\\text{after}}} = \\frac{r(P_A + P_B(1-\\eta))}{r(L_A + L_B(1-\\eta))} = \\frac{P_A + P_B(1-\\eta)}{L_A + L_B(1-\\eta)}$$\nThe factor $r$ cancels, as expected, since $k_{\\text{eff}}$ is an eigenvalue and is insensitive to uniform scaling of the eigenfunction (flux).\n\n**3. Calculating the Change $\\Delta k_{\\text{eff}}$**\n\nWe need to compute $\\Delta k_{\\text{eff}} = k_{\\text{eff}}^{(\\text{after})} - k_{\\text{eff}}^{(\\text{before})}$.\n$$\\Delta k_{\\text{eff}} = \\frac{P_A + P_B(1-\\eta)}{L_A + L_B(1-\\eta)} - \\frac{P_A + P_B(1 - \\eta - \\epsilon\\eta)}{L_A + L_B(1 - \\eta - \\epsilon\\eta)}$$\nLet us define $P_1 = P_A + P_B(1-\\eta)$, $L_1 = L_A + L_B(1-\\eta)$, and the small perturbations due to the artifact as $\\delta_P = -P_B\\epsilon\\eta$ and $\\delta_L = -L_B\\epsilon\\eta$.\nThen $k_{\\text{eff}}^{(\\text{after})} = P_1/L_1$ and $k_{\\text{eff}}^{(\\text{before})} = (P_1+\\delta_P)/(L_1+\\delta_L)$.\n$$\\Delta k_{\\text{eff}} = \\frac{P_1}{L_1} - \\frac{P_1+\\delta_P}{L_1+\\delta_L} = \\frac{P_1(L_1+\\delta_L) - L_1(P_1+\\delta_P)}{L_1(L_1+\\delta_L)} = \\frac{P_1\\delta_L - L_1\\delta_P}{L_1(L_1+\\delta_L)}$$\nSince $\\delta_P$ and $\\delta_L$ are of order $\\epsilon\\eta$, we can approximate the denominator by $L_1^2$ for the leading-order term.\n$$\\Delta k_{\\text{eff}} \\approx \\frac{P_1\\delta_L - L_1\\delta_P}{L_1^2}$$\nNow, we substitute the expressions for $P_1, L_1, \\delta_P, \\delta_L$:\nThe numerator is\n$$ (P_A + P_B(1-\\eta))(-L_B\\epsilon\\eta) - (L_A + L_B(1-\\eta))(-P_B\\epsilon\\eta) $$\n$$ = \\epsilon\\eta \\left[ - (P_A + P_B(1-\\eta))L_B + (L_A + L_B(1-\\eta))P_B \\right] $$\n$$ = \\epsilon\\eta \\left[ -P_A L_B - P_B L_B + P_B L_B \\eta + L_A P_B + L_B P_B - L_B P_B \\eta \\right] $$\n$$ = \\epsilon\\eta (P_B L_A - P_A L_B) $$\nThe denominator is $L_1^2 = (L_A + L_B(1-\\eta))^2$. Since $\\eta \\ll 1$, we can approximate this to leading order as $(L_A+L_B)^2$. The correction terms would be of order $\\eta$, which, when multiplied by the numerator's $\\epsilon\\eta$, would result in terms of order $\\epsilon\\eta^2$, which are higher-order and can be neglected.\nSo, the first-order (leading-order) expression for the change is:\n$$\\Delta k_{\\text{eff}} \\approx \\frac{(P_B L_A - P_A L_B)\\epsilon\\eta}{(L_A+L_B)^2}$$\nFinally, we substitute back the full definitions of $P_A, P_B, L_A, L_B$:\n$$P_B L_A - P_A L_B = (\\nu \\Sigma_{fB} \\phi_B V_B)(\\Sigma_{aA} \\phi_A V_A) - (\\nu \\Sigma_{fA} \\phi_A V_A)(\\Sigma_{aB} \\phi_B V_B)$$\n$$ = \\nu \\phi_A V_A \\phi_B V_B (\\Sigma_{fB}\\Sigma_{aA} - \\Sigma_{fA}\\Sigma_{aB})$$\n$$L_A + L_B = \\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B V_B$$\nCombining these gives the final expression for the change in the effective multiplication factor.\n$$ \\Delta k_{\\text{eff}} = \\frac{\\nu \\phi_A V_A \\phi_B V_B (\\Sigma_{fB}\\Sigma_{aA} - \\Sigma_{fA}\\Sigma_{aB})}{(\\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B V_B)^2} \\epsilon\\eta $$\nThis is the desired first-order expression, as it represents the leading-order term in an expansion of $\\Delta k_{\\text{eff}}$ in powers of the small parameters $\\eta$ and $\\epsilon$.",
            "answer": "$$ \\boxed{\\frac{\\nu \\phi_A V_A \\phi_B V_B (\\Sigma_{fB}\\Sigma_{aA} - \\Sigma_{fA}\\Sigma_{aB})}{(\\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B V_B)^2} \\epsilon\\eta} $$"
        },
        {
            "introduction": "The true test of a fixup technique lies in its implementation and the analysis of its impact on a simulation. This computational exercise guides you through building a 2D diffusion code and implementing a tunable negative flux limiter. By performing a sensitivity study on the limiter's parameters , you will directly observe and quantify the delicate balance between eliminating non-physical negatives and preserving the accuracy of important reactor characteristics like $k_{\\text{eff}}$ and power distribution.",
            "id": "4237649",
            "problem": "Consider a two-dimensional, one-group neutron diffusion $k$-eigenvalue problem on a uniform square lattice with vacuum (zero Dirichlet) boundary conditions. The governing equation is the steady-state balance law\n$$\n-\\nabla \\cdot \\left(D(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})\\right) + \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) = \\frac{1}{k_{\\text{eff}}} \\, \\nu \\Sigma_f(\\mathbf{r}) \\, \\phi(\\mathbf{r}),\n$$\nwhere $D$ is the diffusion coefficient, $\\Sigma_a$ is the macroscopic absorption cross section, $\\nu \\Sigma_f$ is the macroscopic fission production cross section, $\\phi$ is the scalar neutron flux, and $k_{\\text{eff}}$ is the effective multiplication factor. Vacuum boundary conditions mean $\\phi=0$ on the domain boundary.\n\nDiscretize this equation on an $N_x \\times N_y$ uniform mesh with cell width $h$ using a standard five-point finite-difference stencil with arithmetic averaging of face diffusion coefficients. Let the discrete flux vector be $\\boldsymbol{\\phi} \\in \\mathbb{R}^{N_x N_y}$, the discrete diffusion operator be the sparse matrix $\\mathbf{A} \\in \\mathbb{R}^{N \\times N}$ (with $N=N_x N_y$) incorporating zero Dirichlet boundary conditions, and let the diagonal fission production operator be represented by the nonnegative vector $\\mathbf{f} \\in \\mathbb{R}^N$ with entries $f_i = \\nu \\Sigma_{f,i}$. The discrete $k$-eigenvalue problem is\n$$\n\\mathbf{A}\\boldsymbol{\\phi} = \\frac{1}{k_{\\text{eff}}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi},\n$$\nwhere $\\odot$ denotes elementwise multiplication.\n\nUse the following fundamental iteration scheme based on the method of successive fission-source iterations (power iteration for the operator $\\mathbf{A}^{-1} \\operatorname{diag}(\\mathbf{f})$):\n1. Initialize $k^{(0)}$ and $\\boldsymbol{\\phi}^{(0)}$. At iteration $m$, form the fission source\n$$\n\\mathbf{q}^{(m)} = \\frac{1}{k^{(m)}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi}^{(m)}.\n$$\n2. Solve the linear system\n$$\n\\mathbf{A}\\boldsymbol{\\phi}^{(m+1)} = \\mathbf{q}^{(m)}.\n$$\n3. Apply a fixup operator to enforce nonnegativity using a limiter with strength parameter $\\alpha \\in [0,1]$ and a floor $\\varepsilon > 0$:\n$$\n\\phi_i^{(m+1,\\text{fix})} = \n\\begin{cases}\n(1-\\alpha)\\,\\phi_i^{(m+1)} + \\alpha \\,\\varepsilon, & \\text{if } \\phi_i^{(m+1)} < \\varepsilon,\\\\\n\\phi_i^{(m+1)}, & \\text{otherwise}.\n\\end{cases}\n$$\n4. Update the effective multiplication factor by the ratio of total fission production between successive iterates,\n$$\nk^{(m+1)} = k^{(m)} \\, \\frac{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m)}},\n$$\nand renormalize the flux to unit fission production,\n$$\n\\boldsymbol{\\phi}^{(m+1)} = \\frac{\\boldsymbol{\\phi}^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}},\n$$\nso that $\\sum_i f_i \\, \\phi_i^{(m+1)} = 1$ for all $m \\ge 0$.\n\nFor leakage, use the discrete diffusion current approximation at the vacuum boundary. For a boundary face with outward unit normal $\\hat{\\mathbf{n}}$, the normal current is $J_n = -D \\, \\partial \\phi / \\partial n$. With a zero Dirichlet boundary and uniform spacing, approximate $\\partial \\phi / \\partial n \\approx (\\phi_{\\text{ghost}} - \\phi_{\\text{interior}})/h = -\\phi_{\\text{interior}}/h$, so the outward leakage per boundary face is $J_{\\text{out}} h = D \\, \\phi_{\\text{interior}}$. The total leakage is the sum over all outer faces, which on a uniform grid reduces to the sum of $D \\, \\phi$ over each boundary cell face.\n\nDefine pin power as $p_i = f_i \\, \\phi_i$, and report the maximum pin power. All outputs are dimensionless in this setup.\n\nConstruct the heterogeneous material map on a $10 \\times 10$ mesh ($N_x=N_y=10$) with $h=1$ as follows:\n- Central fuel region occupying indices $i \\in \\{3,4,5,6\\}$ and $j \\in \\{3,4,5,6\\}$ has $D_{\\text{fuel}} = 1.2$, $\\Sigma_{a,\\text{fuel}} = 0.20$, $\\nu\\Sigma_{f,\\text{fuel}} = 0.40$.\n- Moderator region elsewhere has $D_{\\text{mod}} = 1.0$, $\\Sigma_{a,\\text{mod}} = 0.08$, $\\nu\\Sigma_{f,\\text{mod}} = 0.0$.\n\nBuild $\\mathbf{A}$ using an arithmetic average for each interior face: for a face between cells $i$ and $j$, use $D_{\\text{face}} = \\left(D_i + D_j\\right)/2$. For a boundary face, enforce zero Dirichlet boundary conditions by adding $D_i/h^2$ to the diagonal of the adjacent interior cell and no off-diagonal coupling across the boundary.\n\nBaseline reference: compute a reference solution by running the iteration with $\\alpha=0$ (no fixup) and a positive initial flux $\\boldsymbol{\\phi}^{(0)}$ set to all ones, normalized so that $\\sum_i f_i \\, \\phi_i^{(0)} = 1$. Iterate until convergence defined by both the relative change in $k_{\\text{eff}}$ and the relative $\\ell_2$ change in $\\boldsymbol{\\phi}$ being less than $10^{-9}$, or until a maximum of $500$ iterations. Record the reference $k_{\\text{eff}}$, leakage, and flux.\n\nSensitivity experiments: for each test case below, start from a deliberately oscillatory initial flux with negative components,\n$$\n\\phi_{i,j}^{(0)} = 0.10 + 0.20 \\sin\\left(\\frac{\\pi i}{N_x}\\right) \\cos\\left(\\frac{2 \\pi j}{N_y}\\right) - 0.15 \\cos\\left(\\frac{\\pi i}{N_x}\\right),\n$$\nreshape to a vector, and scale so that $\\sum_i f_i \\, \\phi_i^{(0)} = 1$. Use initial $k^{(0)}=1.0$, the same convergence criteria as in the baseline run, and apply the fixup step with the specified $(\\alpha,\\varepsilon)$.\n\nFor each test case, compute:\n- The converged $k_{\\text{eff}}$.\n- The total leakage as the sum of $D \\, \\phi$ across all boundary faces.\n- The maximum pin power $\\max_i p_i$.\n- The relative error in $k_{\\text{eff}}$ with respect to the baseline, $\\left|k_{\\text{eff}}^{\\text{test}} - k_{\\text{eff}}^{\\text{ref}}\\right|/k_{\\text{eff}}^{\\text{ref}}$.\n- The relative error in leakage with respect to the baseline, $\\left|L^{\\text{test}} - L^{\\text{ref}}\\right|/L^{\\text{ref}}$.\n- The relative $\\ell_2$ error in flux with respect to the baseline, $\\left\\|\\boldsymbol{\\phi}^{\\text{test}} - \\boldsymbol{\\phi}^{\\text{ref}}\\right\\|_2 / \\left\\|\\boldsymbol{\\phi}^{\\text{ref}}\\right\\|_2$.\n\nTest suite (five cases exploring limiter strength and floor):\n1. $(\\alpha,\\varepsilon) = (0.0, 10^{-12})$,\n2. $(\\alpha,\\varepsilon) = (0.2, 10^{-8})$,\n3. $(\\alpha,\\varepsilon) = (0.5, 10^{-6})$,\n4. $(\\alpha,\\varepsilon) = (0.8, 10^{-4})$,\n5. $(\\alpha,\\varepsilon) = (1.0, 10^{-3})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is a list of six floats in the order\n$$\n\\left[k_{\\text{eff}}, \\, \\text{leakage}, \\, \\max(p_i), \\, \\text{rel\\_}k\\text{\\_error}, \\, \\text{rel\\_leak\\_error}, \\, \\text{rel\\_flux\\_L2}\\right].\n$$\nFor example, the final output should look like\n$$\n\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right].\n$$\nAll values are dimensionless, and no physical units are required. Angles do not appear, so no angle unit is needed. Express all errors as decimals (not percentages).",
            "solution": "The problem requires the solution of a two-dimensional, one-group neutron diffusion $k$-eigenvalue problem on a heterogeneous square lattice using the power iteration method, and an analysis of a negative flux fixup scheme.\n\n### 1. Problem Formulation\nThe continuous problem is governed by the steady-state neutron diffusion equation with zero Dirichlet boundary conditions ($\\phi=0$ on the boundary $\\partial \\Omega$):\n$$\n-\\nabla \\cdot \\left(D(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})\\right) + \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) = \\frac{1}{k_{\\text{eff}}} \\, \\nu \\Sigma_f(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\quad \\text{for } \\mathbf{r} \\in \\Omega\n$$\nDiscretizing this equation on a uniform Cartesian mesh with grid spacing $h$ using a cell-centered finite difference method leads to a matrix eigenvalue problem:\n$$\n\\mathbf{A}\\boldsymbol{\\phi} = \\frac{1}{k_{\\text{eff}}} \\mathbf{F}\\boldsymbol{\\phi}\n$$\nHere, $\\boldsymbol{\\phi}$ is the vector of cell-averaged fluxes, $\\mathbf{A}$ is the sparse matrix representing the destruction operator (diffusion leakage plus absorption), and $\\mathbf{F}$ is a diagonal matrix representing the fission production operator, with diagonal entries $(\\mathbf{F})_{ii} = f_i = (\\nu \\Sigma_f)_i$. The problem statement uses the elementwise product notation $\\mathbf{f} \\odot \\boldsymbol{\\phi}$ which is equivalent to $\\mathbf{F}\\boldsymbol{\\phi}$.\n\n### 2. Discretization and Matrix Construction\nWe construct the matrix $\\mathbf{A}$ for a grid of size $N_x \\times N_y$. A 2D cell index $(i,j)$ is mapped to a 1D vector index $k = i \\cdot N_y + j$. The matrix $\\mathbf{A}$ has dimension $(N_x N_y) \\times (N_x N_y)$.\n\nFor an interior cell $k$ corresponding to grid location $(i,j)$, the balance equation, after multiplying by $h^2$, is:\n$$\n\\left( \\sum_{l \\in N(k)} \\frac{D_{k,l}}{h^2} + \\Sigma_{a,k} \\right) \\phi_k - \\sum_{l \\in N(k)} \\frac{D_{k,l}}{h^2} \\phi_l = \\frac{1}{k_{\\text{eff}}} f_k \\phi_k\n$$\nwhere $N(k)$ is the set of four adjacent neighbors of cell $k$, and $D_{k,l}$ is the diffusion coefficient on the face between cells $k$ and $l$. The problem specifies arithmetic averaging: $D_{k,l} = (D_k + D_l)/2$. With $h=1$, this simplifies.\n\nThe elements of matrix $\\mathbf{A}$ are therefore:\n- **Off-diagonal elements**: For a neighbor cell $l$ of cell $k$, the matrix element is $A_{k,l} = -D_{k,l}/h^2 = -(D_k + D_l)/2$.\n- **Diagonal elements**: The diagonal element $A_{k,k}$ is composed of the absorption term and leakage terms.\nFor an interior cell $k$ at $(i,j)$:\n$$\nA_{k,k} = \\Sigma_{a,k} + \\frac{1}{h^2}\\left( D_{k, \\text{north}} + D_{k, \\text{south}} + D_{k, \\text{east}} + D_{k, \\text{west}} \\right)\n$$\nwhere $D_{k, \\text{direction}}$ is the face-averaged diffusion coefficient.\n\nFor a cell $k$ on a boundary, the problem specifies that the zero Dirichlet condition is enforced by adding $D_k/h^2$ to the diagonal for each boundary face. This effectively means that for a boundary face, the neighboring flux is zero, and the leakage term adds to the diagonal rather than coupling to an external node. For a cell $k=(i,j)$ on the left boundary ($i=0$), the \"west\" neighbor is the boundary. The contribution to the diagonal is $D_k/h^2$, and there is no off-diagonal element for this face.\nThe general formula for the diagonal element $A_{k,k}$ for cell $k$ at $(i,j)$ with $h=1$ is:\n$$\nA_{k,k} = \\Sigma_{a,k} + C_N + C_S + C_E + C_W\n$$\nwhere the coupling terms $C$ are:\n- $C_N = \\begin{cases} (D_{i,j}+D_{i,j+1})/2 & \\text{if } j < N_y-1 \\\\ D_{i,j} & \\text{if } j = N_y-1 \\end{cases}$\n- $C_S = \\begin{cases} (D_{i,j}+D_{i,j-1})/2 & \\text{if } j > 0 \\\\ D_{i,j} & \\text{if } j = 0 \\end{cases}$\n- $C_E = \\begin{cases} (D_{i,j}+D_{i+1,j})/2 & \\text{if } i < N_x-1 \\\\ D_{i,j} & \\text{if } i = N_x-1 \\end{cases}$\n- $C_W = \\begin{cases} (D_{i,j}+D_{i-1,j})/2 & \\text{if } i > 0 \\\\ D_{i,j} & \\text{if } i = 0 \\end{cases}$\nThe off-diagonal entries are set accordingly. For example, for the neighbor $l$ corresponding to $(i,j+1)$, $A_{k,l} = -(D_{i,j}+D_{i,j+1})/2$ if $j < N_y-1$.\n\n### 3. Numerical Solution Algorithm\nThe eigenvalue problem is solved using the fission source iteration method (power iteration). Given an initial guess for the eigenvalue $k^{(0)}$ and eigenvector $\\boldsymbol{\\phi}^{(0)}$, the algorithm iterates as follows for $m=0, 1, 2, \\dots$:\n\n1.  **Calculate Fission Source**: The source for the next flux iteration is computed using the current flux and eigenvalue:\n    $$ \\mathbf{q}^{(m)} = \\frac{1}{k^{(m)}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi}^{(m)} $$\n\n2.  **Solve for Flux**: A new flux distribution is obtained by solving the linear system representing diffusion and absorption for the given source:\n    $$ \\mathbf{A}\\boldsymbol{\\phi}^{(m+1)} = \\mathbf{q}^{(m)} $$\n    This is solved efficiently since $\\mathbf{A}$ is a sparse matrix.\n\n3.  **Apply Non-negativity Fixup**: The resulting flux $\\boldsymbol{\\phi}^{(m+1)}$ may contain small negative values due to numerical precision or the nature of the initial guess. A limiter is applied to enforce positivity. For each cell $i$:\n    $$ \\phi_i^{(m+1,\\text{fix})} = \\begin{cases} (1-\\alpha)\\,\\phi_i^{(m+1)} + \\alpha \\,\\varepsilon, & \\text{if } \\phi_i^{(m+1)} < \\varepsilon,\\\\ \\phi_i^{(m+1)}, & \\text{otherwise}. \\end{cases} $$\n    The parameter $\\alpha$ controls the strength of the correction, blending the computed negative flux with a small positive floor $\\varepsilon$.\n\n4.  **Update Eigenvalue and Normalize Flux**: The eigenvalue and flux are updated. First, the total fission production from the fixed flux is computed: $P^{(m+1)} = \\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}$.\n    The eigenvalue is updated by the ratio of fission production rates:\n    $$ k^{(m+1)} = k^{(m)} \\, \\frac{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m)}} $$\n    The problem specifies that the flux is normalized at each step such that $\\sum_i f_i \\, \\phi_i^{(m)} = 1$ for all $m \\ge 0$. This simplifies the update to:\n    $$ k^{(m+1)} = k^{(m)} \\cdot P^{(m+1)} $$\n    The flux vector for the next iteration is then renormalized:\n    $$ \\boldsymbol{\\phi}^{(m+1)} = \\frac{\\boldsymbol{\\phi}^{(m+1,\\text{fix})}}{P^{(m+1)}} $$\n\nThe iteration continues until the relative changes in both $k_{\\text{eff}}$ and $\\boldsymbol{\\phi}$ fall below a tolerance of $10^{-9}$.\n\n### 4. Calculation of Output Quantities\nAfter convergence to $k_{\\text{eff}}$ and $\\boldsymbol{\\phi}$:\n- **Total Leakage ($L$)**: The total neutron leakage from the domain is the sum of currents across all boundary faces. For a cell $k$ on the boundary, the outward current through a boundary face of area $h$ is approximated as $J_{\\text{out}} h = (D_k \\phi_k/h) h = D_k \\phi_k$. The total leakage is the sum of these terms over all boundary faces:\n$$ L = \\sum_{k \\text{ on boundary}} D_k \\phi_k \\times (\\text{number of boundary faces for cell } k) $$\n- **Pin Power ($p_i$)**: The pin power in cell $i$ is the fission rate, $p_i = f_i \\phi_i$. The maximum pin power is $\\max_i(p_i)$.\n- **Relative Errors**: Errors for test cases are calculated relative to a baseline reference solution ($\\text{ref}$) obtained with $\\alpha=0$ and a positive initial flux:\n  - $\\text{rel\\_k\\_err} = |k_{\\text{eff}}^{\\text{test}} - k_{\\text{eff}}^{\\text{ref}}| / k_{\\text{eff}}^{\\text{ref}}$\n  - $\\text{rel\\_leak\\_err} = |L^{\\text{test}} - L^{\\text{ref}}| / L^{\\text{ref}}$\n  - $\\text{rel\\_flux\\_L2\\_err} = \\|\\boldsymbol{\\phi}^{\\text{test}} - \\boldsymbol{\\phi}^{\\text{ref}}\\|_2 / \\|\\boldsymbol{\\phi}^{\\text{ref}}\\|_2$\n\n### 5. Execution Plan\nA Python script will be implemented to perform the following steps:\n1.  Define the geometry, material properties, and create the material maps ($D$, $\\Sigma_a$, $f$).\n2.  Construct the sparse matrix $\\mathbf{A}$ according to the discretization rules.\n3.  Implement a solver function that performs the power iteration, including the fixup step.\n4.  **Baseline Run**: Call the solver with $\\alpha=0$, a uniform positive initial flux, and initial $k^{(0)}=1.0$ to obtain $k_{\\text{eff}}^{\\text{ref}}$, $L^{\\text{ref}}$, and $\\boldsymbol{\\phi}^{\\text{ref}}$.\n5.  **Test Suite Runs**: For each of the five $(\\alpha, \\varepsilon)$ test cases, generate the specified oscillatory initial flux, normalize it, and call the solver to get the test case results.\n6.  Calculate the required output quantities and relative errors for each test case.\n7.  Format and print the final results as a list of lists.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Solves the 2D neutron diffusion k-eigenvalue problem and analyzes negative flux fixup schemes.\n    \"\"\"\n    # 1. Setup: Problem Parameters and Material Properties\n    Nx, Ny = 10, 10\n    h = 1.0\n    N = Nx * Ny\n    tol = 1e-9\n    max_iter = 500\n\n    # Initialize material property arrays\n    D = np.full((Nx, Ny), 1.0)\n    Sigma_a = np.full((Nx, Ny), 0.08)\n    nuSigma_f = np.zeros((Nx, Ny))\n\n    # Assign fuel properties to central region (indices 3,4,5,6)\n    fuel_indices = slice(3, 7)\n    D[fuel_indices, fuel_indices] = 1.2\n    Sigma_a[fuel_indices, fuel_indices] = 0.20\n    nuSigma_f[fuel_indices, fuel_indices] = 0.40\n\n    # Flatten material properties to 1D vectors\n    D_vec = D.flatten()\n    Sigma_a_vec = Sigma_a.flatten()\n    f_vec = nuSigma_f.flatten()\n\n    # 2. Matrix Construction\n    A = lil_matrix((N, N))\n    for i in range(Nx):\n        for j in range(Ny):\n            k = i * Ny + j\n            \n            # Diagonal term from absorption\n            A[k, k] += Sigma_a_vec[k]\n\n            # Coupling to neighbors\n            # North\n            if j < Ny - 1:\n                l = i * Ny + (j + 1)\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n            \n            # South\n            if j > 0:\n                l = i * Ny + (j - 1)\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n\n            # East\n            if i < Nx - 1:\n                l = (i + 1) * Ny + j\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n                \n            # West\n            if i > 0:\n                l = (i - 1) * Ny + j\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n    \n    A_csc = csc_matrix(A)\n\n    def power_iteration(phi0, k0, alpha, epsilon):\n        phi = np.copy(phi0)\n        # Normalize initial flux\n        fission_prod = np.dot(f_vec, phi)\n        if np.abs(fission_prod) > 1e-12: # Avoid division by zero\n            phi /= fission_prod\n        \n        k = k0\n\n        for _ in range(max_iter):\n            phi_old = np.copy(phi)\n            k_old = k\n\n            # 1. Fission Source\n            q = (1.0 / k) * (f_vec * phi)\n            \n            # 2. Solve for flux\n            phi_next_unfixed = spsolve(A_csc, q)\n\n            # 3. Apply fixup\n            phi_next_fixed = np.copy(phi_next_unfixed)\n            neg_indices = phi_next_fixed < epsilon\n            phi_next_fixed[neg_indices] = (1.0 - alpha) * phi_next_unfixed[neg_indices] + alpha * epsilon\n            \n            # 4. Update eigenvalue and renormalize flux\n            fission_prod_old = np.dot(f_vec, phi_old)\n            # This should be 1.0 after the first iteration\n            if abs(fission_prod_old) < 1e-15: fission_prod_old = 1.0\n            \n            fission_prod_new = np.dot(f_vec, phi_next_fixed)\n\n            k = k_old * (fission_prod_new / fission_prod_old)\n            \n            if np.abs(fission_prod_new) > 1e-12:\n                phi = phi_next_fixed / fission_prod_new\n            else: # Fission production collapsed, unlikely but handle\n                phi = np.zeros_like(phi)\n\n            # Convergence check\n            k_rel_err = np.abs(k - k_old) / k if k > 0 else 0\n            phi_l2_norm = np.linalg.norm(phi, 2)\n            phi_rel_err = np.linalg.norm(phi - phi_old, 2) / phi_l2_norm if phi_l2_norm > 0 else 0\n            \n            if k_rel_err < tol and phi_rel_err < tol:\n                break\n        \n        return k, phi\n\n    def calculate_leakage(phi_vec, D_vec):\n        leakage = 0.0\n        for i in range(Nx):\n            for j in range(Ny):\n                k = i * Ny + j\n                if i == 0:\n                    leakage += D_vec[k] * phi_vec[k]\n                if i == Nx - 1:\n                    leakage += D_vec[k] * phi_vec[k]\n                if j == 0:\n                    leakage += D_vec[k] * phi_vec[k]\n                if j == Ny - 1:\n                    leakage += D_vec[k] * phi_vec[k]\n        return leakage\n\n    # 3. Baseline Reference Calculation\n    phi0_ref = np.ones(N)\n    k0_ref = 1.0\n    k_ref, phi_ref = power_iteration(phi0_ref, k0_ref, alpha=0.0, epsilon=1e-12)\n    leakage_ref = calculate_leakage(phi_ref, D_vec)\n    phi_ref_norm = np.linalg.norm(phi_ref, 2)\n\n    # 4. Sensitivity Experiments\n    test_cases = [\n        (0.0, 1e-12),\n        (0.2, 1e-8),\n        (0.5, 1e-6),\n        (0.8, 1e-4),\n        (1.0, 1e-3),\n    ]\n    results = []\n\n    # Prepare oscillatory initial flux\n    phi0_test_grid = np.zeros((Nx, Ny))\n    for i in range(Nx):\n        for j in range(Ny):\n            phi0_test_grid[i, j] = 0.10 + 0.20 * np.sin(np.pi * (i+0.5) / Nx) * np.cos(2 * np.pi * (j+0.5) / Ny) - 0.15 * np.cos(np.pi * (i+0.5) / Nx)\n    phi0_test = phi0_test_grid.flatten()\n    k0_test = 1.0\n\n    for alpha_test, epsilon_test in test_cases:\n        k_test, phi_test = power_iteration(phi0_test, k0_test, alpha_test, epsilon_test)\n        \n        # Calculate required outputs\n        leakage_test = calculate_leakage(phi_test, D_vec)\n        pin_power_test = f_vec * phi_test\n        max_pin_power = np.max(pin_power_test)\n        \n        # Calculate relative errors\n        rel_k_error = np.abs(k_test - k_ref) / k_ref\n        rel_leak_error = np.abs(leakage_test - leakage_ref) / leakage_ref if leakage_ref > 0 else 0.0\n        rel_flux_l2_error = np.linalg.norm(phi_test - phi_ref, 2) / phi_ref_norm if phi_ref_norm > 0 else 0.0\n        \n        case_results = [\n            k_test,\n            leakage_test,\n            max_pin_power,\n            rel_k_error,\n            rel_leak_error,\n            rel_flux_l2_error\n        ]\n        results.append(case_results)\n\n    # 5. Final Output\n    output_str = \"[\" + \",\".join([f\"[{','.join(f'{v:.10e}' for v in res)}]\" for res in results]) + \"]\"\n\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}