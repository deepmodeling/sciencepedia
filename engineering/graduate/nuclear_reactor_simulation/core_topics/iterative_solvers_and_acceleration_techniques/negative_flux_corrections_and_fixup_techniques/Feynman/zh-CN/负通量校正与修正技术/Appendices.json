{
    "hands_on_practices": [
        {
            "introduction": "中子通量在物理上必须为非负值，但数值模拟有时会产生非物理的负值。本练习旨在探究这一问题的根源。我们将从基本的中子输运方程出发，分析即使在物理正确的真空边界条件下，为何连续解能保证正性，而一种广泛使用的离散格式——菱形差分法 (diamond-difference)——却可能破坏这种正性。通过  的分析，你将深入理解负通量伪影的产生机制，即空间离散格式在陡峭梯度区域的线性外推失败，这是理解和选择修正技术的第一步。",
            "id": "4237688",
            "problem": "考虑有界域 $V$ 中的稳态单能中子输运方程（线性玻尔兹曼方程），其边界为 $\\partial V$，在点 $\\mathbf{r} \\in \\partial V$ 处的单位外法向量为 $\\mathbf{n}(\\mathbf{r})$。角通量为 $\\psi(\\mathbf{r}, \\Omega)$，总宏观截面为 $\\sigma_t(\\mathbf{r}) \\ge 0$，组合的散射加裂变源为 $q(\\mathbf{r}, \\Omega) \\ge 0$。控制方程为\n$$\n\\Omega \\cdot \\nabla \\psi(\\mathbf{r}, \\Omega) + \\sigma_t(\\mathbf{r}) \\, \\psi(\\mathbf{r}, \\Omega) = q(\\mathbf{r}, \\Omega),\n$$\n对于入射方向，施加真空边界条件：\n$$\n\\psi(\\mathbf{r}_b, \\Omega) = 0 \\quad \\text{for} \\quad \\Omega \\cdot \\mathbf{n}(\\mathbf{r}_b)  0, \\quad \\mathbf{r}_b \\in \\partial V.\n$$\n采用带有有限体积空间离散的离散纵标 ($S_N$) 方法来近似 $\\psi(\\mathbf{r}, \\Omega)$，并对流项使用菱形差分格式（一种从网格平均值对边通量进行线性中心重构的格式）。\n\n基于输运控制方程、$q(\\mathbf{r}, \\Omega)$ 和 $\\sigma_t(\\mathbf{r})$ 的正性，以及 $\\psi(\\mathbf{r}, \\Omega)$ 作为相空间中非负粒子密度的物理解释，论证为何对于 $\\Omega \\cdot \\mathbf{n}  0$ 的真空边界条件 $\\psi=0$ 与解的正性是一致的。然后，解释为何尽管如此，当使用 $S_N$ 菱形差分格式时，在实际中仍可能出现邻近边界的离散通量为负值的情况。下列哪个陈述是正确的？\n\nA. 在连续方程中，对于从真空边界进入区域的特征线，沿其积分得到的解，\n$$\n\\frac{d\\psi}{ds} + \\sigma_t(s) \\, \\psi(s) = q(s), \\quad \\psi(0) = 0 \\ \\text{for incoming}, \n$$\n在 $q(s) \\ge 0$ 和 $\\sigma_t(s) \\ge 0$ 的条件下，对于所有 $s \\ge 0$ 都是非负的。然而，离散纵标菱形差分空间离散格式可能会产生邻近边界的负通量，因为其线性重构不是单调的：在陡峭的边界层附近，强制使用与网格平均值和一侧边界值一致的线性斜率，可能导致在另一侧边界出现下冲至小于 $0$ 的值。\n\nB. 在真空边界上对 $\\Omega \\cdot \\mathbf{n}  0$ 施加 $\\psi=0$ 与 $\\psi$ 的物理正性不相容，并违反了连续输运方程中的粒子平衡；因此，连续解必然在边界附近表现出负通量。\n\nC. 阶梯特征线法（沿每个离散方向进行精确指数积分）或指数差分格式，在 $q(\\mathbf{r}, \\Omega) \\ge 0$ 和 $\\sigma_t(\\mathbf{r}) \\ge 0$ 的条件下，对任何网格光学厚度都是保正的。菱形差分格式中出现的邻近边界的负通量可以通过切换到阶梯特征线法或应用保正修正（如单调通量限制器或截断负值后进行局部平衡校正）来消除。\n\nD. 邻近真空边界的负通量仅仅是 $S_N$ 方法中角求积不足造成的人为现象；即使使用中心（菱形差分）空间离散格式，将离散方向的数量增加到非常大也可以消除这种负值。\n\nE. 一种与守恒一致的实用修正是将负的边界面或网格中心通量截断为 $0$，然后通过调整群内源或边界面流来重新平衡，使得网格积分平衡方程，\n$$\n\\int_{\\Delta V} \\sigma_t \\, \\psi \\, dV \\;=\\; \\int_{\\partial (\\Delta V)} (\\Omega \\cdot \\mathbf{n}) \\, \\psi \\, dA \\;+\\; \\int_{\\Delta V} q \\, dV,\n$$\n在一阶上得到满足。这在发生截断的地方牺牲了二阶空间精度，但保持了全局守恒。\n\n选择所有适用项。",
            "solution": "在进行求解之前，对问题陈述进行严格验证。\n\n### 步骤 1：提取已知条件\n- **控制方程**：有界域 $V$ 中的稳态单能中子输运方程：\n$$\n\\Omega \\cdot \\nabla \\psi(\\mathbf{r}, \\Omega) + \\sigma_t(\\mathbf{r}) \\, \\psi(\\mathbf{r}, \\Omega) = q(\\mathbf{r}, \\Omega)\n$$\n- **变量与参数**：\n  - $\\psi(\\mathbf{r}, \\Omega)$: 角中子通量。\n  - $\\sigma_t(\\mathbf{r})$: 总宏观截面，$\\sigma_t(\\mathbf{r}) \\ge 0$。\n  - $q(\\mathbf{r}, \\Omega)$: 组合的散射加裂变源，$q(\\mathbf{r}, \\Omega) \\ge 0$。\n  - $\\mathbf{r} \\in V$: 位置向量。\n  - $\\Omega$: 角方向单位向量。\n  - $\\mathbf{n}(\\mathbf{r})$: 边界 $\\partial V$ 上的单位外法向量。\n- **边界条件**：入射方向的真空边界条件：\n$$\n\\psi(\\mathbf{r}_b, \\Omega) = 0 \\quad \\text{for} \\quad \\Omega \\cdot \\mathbf{n}(\\mathbf{r}_b)  0, \\quad \\mathbf{r}_b \\in \\partial V.\n$$\n- **数值方法**：\n  - 角度离散：离散纵标 ($S_N$) 法。\n  - 空间离散：有限体积法。\n  - 流项重构：菱形差分（线性、中心）格式。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学基础**：该问题描述了线性玻尔兹曼输运方程，这是反应堆物理和辐射输运的基石。角通量、截面、源和真空边界条件的定义是标准的且具有合理的物理意义。通量、源和截面是非负量这一前提是其物理解释的基础。所提到的数值方法（$S_N$、有限体积、菱形差分）在该领域被广泛使用和研究。由菱形差分格式引起的负通量问题是一个经典的、有充分文献记载的数值人为现象。该问题是科学严谨的。\n2.  **适定性**：具有指定的非负源和截面的输运方程，以及真空边界条件，构成了一个一阶线性双曲方程的适定边值问题。已知其解存在、唯一且非负。该问题要求解释连续方程的已知性质和一种常用数值格式，这是一个明确定义的任务。\n3.  **客观性**：该问题使用计算输运理论中精确、标准和无偏见的术语进行陈述。它没有主观或模棱两可的语言。\n\n### 步骤 3：结论与行动\n问题陈述是有效的。它科学合理、适定且客观，提出了一个中子输运数值方法中的标准且非平凡的问题。将推导解答。\n\n### 推导与分析\n\n该问题要求进行两个主要方面的论证：\n1.  为何真空边界条件与连续解 $\\psi(\\mathbf{r}, \\Omega)$ 的正性是一致的。\n2.  尽管连续解具有正性，菱形差分格式如何会导致负通量值。\n\n**1. 连续解的正性**\n\n输运方程是一个一阶偏微分方程。它可以用特征线法求解。特征线是中子行进方向上的一条直线，由路径长度 $s$ 参数化。设一个粒子位于位置 $\\mathbf{r}(s) = \\mathbf{r}_0 + s\\Omega$。沿特征线的方向导数为 $\\frac{d}{ds} = \\Omega \\cdot \\nabla$。因此，输运方程沿特征线变为关于 $\\psi$ 的一阶常微分方程（ODE）：\n$$\n\\frac{d\\psi}{ds} + \\sigma_t(s) \\, \\psi(s) = q(s)\n$$\n其中 $\\psi(s) = \\psi(\\mathbf{r}(s), \\Omega)$, $\\sigma_t(s) = \\sigma_t(\\mathbf{r}(s))$, 且 $q(s) = q(\\mathbf{r}(s), \\Omega)$。\n\n这个线性常微分方程可以用积分因子 $I(s) = \\exp\\left( \\int \\sigma_t(s) ds \\right)$ 求解。在特征线上，给定 $s=0$ 处的值为 $\\psi_0$，点 $s$ 处的 $\\psi$ 的解为：\n$$\n\\psi(s) = \\psi_0 \\exp\\left(-\\int_0^s \\sigma_t(s') ds'\\right) + \\int_0^s q(s') \\exp\\left(-\\int_{s'}^s \\sigma_t(s'') ds''\\right) ds'\n$$\n对于一个从真空进入区域 $V$ 的中子，其特征线始于一个边界点 $\\mathbf{r}_b \\in \\partial V$，其中 $\\Omega \\cdot \\mathbf{n}(\\mathbf{r}_b)  0$。我们可以设此边界点为 $s=0$。真空边界条件规定入射通量为零，因此 $\\psi_0 = \\psi(\\mathbf{r}_b, \\Omega) = 0$。那么，沿这条特征线在区域内部任意点 $s > 0$ 处的 $\\psi$ 的解为：\n$$\n\\psi(s) = \\int_0^s q(s') \\exp\\left(-\\int_{s'}^s \\sigma_t(s'') ds''\\right) ds'\n$$\n根据问题陈述，我们有 $q(\\mathbf{r}, \\Omega) \\ge 0$ 和 $\\sigma_t(\\mathbf{r}) \\ge 0$。这意味着沿路径有 $q(s') \\ge 0$ 和 $\\sigma_t(s'') \\ge 0$。因此，指数项总是正的（因为它是一个非正数的指数）。被积函数是一个非负函数 $q(s')$ 与一个正函数的乘积，其本身也是非负的。一个非负函数在 $s \\ge 0$ 区间上的积分是非负的。因此，沿任何源于真空边界的特征线，对于所有 $s \\ge 0$ 都有 $\\psi(s) \\ge 0$。这表明真空边界条件与物理解的正性完全一致，并且实际上是其正性的基础。\n\n**2. 菱形差分格式中的负通量**\n\n为简单起见，我们来分析一维情况下的菱形差分（DD）格式的行为。考虑一个宽度为 $\\Delta x$ 的空间网格 $i$，从 $x_{i-1/2}$ 到 $x_{i+1/2}$，其网格平均通量为 $\\psi_i$。我们分析一个单一的离散方向 $\\mu > 0$（意味着从左向右行进）。该网格的离散平衡方程为：\n$$\n\\frac{\\mu}{\\Delta x} \\left( \\psi_{i+1/2} - \\psi_{i-1/2} \\right) + \\sigma_{t,i} \\psi_i = q_i\n$$\n菱形差分格式通过假设网格内通量呈线性分布来提供一个封闭关系。这意味着网格平均通量是边界面通量的平均值：\n$$\n\\psi_i = \\frac{\\psi_{i-1/2} + \\psi_{i+1/2}}{2} \\quad \\implies \\quad \\psi_{i+1/2} = 2\\psi_i - \\psi_{i-1/2}\n$$\n这是关键关系。一旦网格平均通量 $\\psi_i$ 和入射通量 $\\psi_{i-1/2}$ 已知，它就允许我们确定出射通量 $\\psi_{i+1/2}$。我们可以用入射通量 $\\psi_{i-1/2}$ 来求解 $\\psi_i$ 和 $\\psi_{i+1/2}$。将 DD 关系代入平衡方程以消去 $\\psi_{i+1/2}$：\n$$\n\\frac{\\mu}{\\Delta x} \\left( (2\\psi_i - \\psi_{i-1/2}) - \\psi_{i-1/2} \\right) + \\sigma_{t,i} \\psi_i = q_i\n$$\n$$\n\\left( \\frac{2\\mu}{\\Delta x} + \\sigma_{t,i} \\right) \\psi_i = q_i + \\frac{2\\mu}{\\Delta x}\\psi_{i-1/2} \\quad \\implies \\quad \\psi_i = \\frac{q_i + \\frac{2\\mu}{\\Delta x}\\psi_{i-1/2}}{\\frac{2\\mu}{\\Delta x} + \\sigma_{t,i}}\n$$\n由于 $q_i \\ge 0$, $\\sigma_{t,i} \\ge 0$, $\\mu > 0$ 且 $\\Delta x > 0$，如果入射通量 $\\psi_{i-1/2}$ 是非负的，那么网格平均通量 $\\psi_i$ 也将是非负的。\n现在，让我们求解出射通量 $\\psi_{i+1/2}$：\n$$\n\\psi_{i+1/2} = 2\\psi_i - \\psi_{i-1/2} = 2 \\left( \\frac{q_i + \\frac{2\\mu}{\\Delta x}\\psi_{i-1/2}}{\\frac{2\\mu}{\\Delta x} + \\sigma_{t,i}} \\right) - \\psi_{i-1/2}\n$$\n为简单起见，考虑无源情况，$q_i=0$。这在纯吸收体或屏蔽问题中很常见，其中通量梯度最陡。\n$$\n\\psi_{i+1/2} = \\left( \\frac{\\frac{4\\mu}{\\Delta x}}{\\frac{2\\mu}{\\Delta x} + \\sigma_{t,i}} - 1 \\right) \\psi_{i-1/2} = \\left( \\frac{4}{2 + \\frac{\\sigma_{t,i}\\Delta x}{\\mu}} - 1 \\right) \\psi_{i-1/2} = \\frac{2 - \\frac{\\sigma_{t,i}\\Delta x}{\\mu}}{2 + \\frac{\\sigma_{t,i}\\Delta x}{\\mu}} \\psi_{i-1/2}\n$$\n如果分子为负（假设 $\\psi_{i-1/2} > 0$），出射通量 $\\psi_{i+1/2}$ 将为负。这发生在：\n$$\n2 - \\frac{\\sigma_{t,i}\\Delta x}{\\mu}  0 \\quad \\implies \\quad \\frac{\\sigma_{t,i}\\Delta x}{\\mu} > 2\n$$\n项 $\\frac{\\sigma_{t,i}\\Delta x}{|\\mu|}$ 是网格沿方向 $\\mu$ 的光学厚度。因此，如果网格是光学厚的（超过 $2$ 个平均自由程），菱形差分格式中固有的线性外推可能会“下冲”到零以下，在出射面上产生非物理的负通量。这在真空边界附近尤其成问题，因为那里的通量从 $0$ 开始急剧上升，形成一个大的梯度，而线性模型无法在厚网格上准确捕捉该梯度。\n\n### 选项评估\n\n**A. 在连续方程中，对于从真空边界进入区域的特征线，沿其积分得到的解 ... 在 $q(s) \\ge 0$ 和 $\\sigma_t(s) \\ge 0$ 的条件下，对于所有 $s \\ge 0$ 都是非负的。然而，离散纵标菱形差分空间离散格式可能会产生邻近边界的负通量，因为其线性重构不是单调的：在陡峭的边界层附近，强制使用与网格平均值和一侧边界值一致的线性斜率，可能导致在另一侧边界出现下冲至小于 $0$ 的值。**\n\n该陈述与上述推导完全一致。第一部分正确地陈述了连续解的正性属性，正如通过特征线法所展示的那样。第二部分正确地指出了菱形差分线性重构的非单调性是产生负通量的原因，并准确地描述了外推如何失效。\n**结论：正确。**\n\n**B. 在真空边界上对 $\\Omega \\cdot \\mathbf{n}  0$ 施加 $\\psi=0$ 与 $\\psi$ 的物理正性不相容，并违反了连续输运方程中的粒子平衡；因此，连续解必然在边界附近表现出负通量。**\n\n该陈述在事实上是错误的。如分析所示，在真空边界上将入射通量设为零是“无粒子进入”的物理解释，并且是与非负源一起保证整个区域内 $\\psi$ 解为非负的数学条件。它与正性完全相容，并且不违反粒子平衡。\n**结论：错误。**\n\n**C. 阶梯特征线法（沿每个离散方向进行精确指数积分）或指数差分格式，在 $q(\\mathbf{r}, \\Omega) \\ge 0$ 和 $\\sigma_t(\\mathbf{r}) \\ge 0$ 的条件下，对任何网格光学厚度都是保正的。菱形差分格式中出现的邻近边界的负通量可以通过切换到阶梯特征线法或应用保正修正（如单调通量限制器或截断负值后进行局部平衡校正）来消除。**\n\n该陈述准确地描述了菱形差分格式负值问题的解决方法。阶梯特征线法和相关的指数格式是基于跨网格的输运常微分方程的解析（指数）解构建的（假设属性是分片常数），这本身就是非负的。因此，无论光学厚度如何，它们都是保正的。第二部分正确地列出了处理负通量的标准方法：要么切换到保正格式，要么应用“修正”。通量限制器和带平衡校正的截断是标准的修正技术。\n**结论：正确。**\n\n**D. 邻近真空边界的负通量仅仅是 $S_N$ 方法中角求积不足造成的人为现象；即使使用中心（菱形差分）空间离散格式，将离散方向的数量增加到非常大也可以消除这种负值。**\n\n该陈述错误地诊断了问题。负通量问题是*空间*离散格式（菱形差分）的缺陷，而不是*角度*离散（$S_N$）的缺陷。我们的推导表明，当对于*单个*离散方向 $\\mu$ 有 $\\frac{\\sigma_t \\Delta x}{|\\mu|} > 2$ 时，就会出现负值。增加更多方向并不会改变原始方向的这个条件。要解决这个问题，必须细化空间网格（减小 $\\Delta x$）或更改空间格式，而不是角求积。\n**结论：错误。**\n\n**E. 一种与守恒一致的实用修正是将负的边界面或网格中心通量截断为 $0$，然后通过调整群内源或边界面流来重新平衡，使得网格积分平衡方程 ... 在一阶上得到满足。这在发生截断的地方牺牲了二阶空间精度，但保持了全局守恒。**\n\n该陈述正确地描述了一种广泛使用的“平衡校正”或“一致性截断与校正”的修正程序。如果初始的 DD 计算产生负通量，该值将被“截断”（设为 $0$）。此操作违反了该网格的原始离散平衡方程。为了恢复守恒，会重新计算平衡方程中的其他项（例如，网格平均通量，其他出射面通量），以便再次满足网格内的离散粒子平衡。此过程确保粒子在局部守恒，从而在全局守恒。然而，这种局部干预实际上在该网格内用一阶精度格式（类似于阶梯格式）取代了二阶精度的 DD 格式，从而为保证正性和守恒而牺牲了精度。“在一阶上得到满足”这个说法稍有不精确，但正确地传达了二阶精度丢失的思想。该方法及其属性的核心描述是准确的。\n**结论：正确。**",
            "answer": "$$\\boxed{ACE}$$"
        },
        {
            "introduction": "理解了负通量的来源之后，下一个关键问题是当我们“修正”这些负值时会发生什么。本练习提供了一个简洁而深刻的思维实验，通过  中的简化模型，你将解析推导出一个常见的修正方法（截断并重新归一化）对系统关键参数——有效增殖因子 $k_{\\text{eff}}$——所引入的偏差。这个实践强调了修正技术并非没有代价，它们可能会系统性地改变物理问题的解，这对任何使用或开发模拟程序的人来说都是一个至关重要的概念。",
            "id": "4237628",
            "problem": "考虑一个单能、稳态的中子扩散本征值问题，其空间域由两个均匀材料区域组成，分别标记为区域 $A$ 和区域 $B$，体积分别为 $V_A$ 和 $V_B$。这些材料的特征由宏观截面 $\\Sigma_{aA}$、$\\Sigma_{aB}$、$\\Sigma_{sA}$、$\\Sigma_{sB}$ 和 $\\Sigma_{fA}$、$\\Sigma_{fB}$ 以及每次裂变产生的平均中子数 $\\nu$ 决定（假设 $\\nu$ 在两个区域中相同）。通量被近似为分段常数，在区域 $A$ 中为 $\\phi_A$，在区域 $B$ 中为 $\\phi_B$。边界条件是反射边界，散射被假定为等能且粒子数守恒，因此区域内唯一的净损失机制是吸收。\n\n数值离散化产生的一个假象导致区域 $B$ 的一小部分子体积中通量变为负值。具体来说，区域 $B$ 的一个体积分数为 $\\eta$ 的子体积具有伪通量值 $-\\epsilon\\,\\phi_B$，其中 $0  \\epsilon \\ll 1$ 且 $0  \\eta \\ll 1$，而区域 $B$ 的剩余部分 $(1-\\eta)$ 仍保持通量 $\\phi_B$。这个负通量假象通过一个“修复”（fixup）程序进行修正：将 $\\eta$ 子体积中的负通量“截断”为零，然后将得到的非负通量场乘以一个均匀因子 $r$，该因子 $r$ 的选择要保证修复后的总体积积分裂变源等于修复前的总体积积分裂变源。\n\n将有效增殖因子（keff）$k_{\\text{eff}}$ 定义为区域内总裂变产生率与总中子损失率之间的稳态平衡。在所述假设下（反射边界和单能、粒子数守恒散射），损失仅由吸收引起。\n\n使用反应率平衡的第一性原理以及所述的修复和重归一化程序，推导由于截断负通量子体积和重归一化总源而引起的变化量 $\\Delta k_{\\text{eff}}=k_{\\text{eff}}^{(\\text{after})}-k_{\\text{eff}}^{(\\text{before})}$ 的关于 $\\eta$ 和 $\\epsilon$ 的一阶解析表达式。用参数 $\\nu$、$\\Sigma_{fA}$、$\\Sigma_{fB}$、$\\Sigma_{aA}$、$\\Sigma_{aB}$、$\\phi_A$、$\\phi_B$、$V_A$、$V_B$、$\\eta$ 和 $\\epsilon$ 表示您的最终结果。您可以假设任何超过一阶的 $\\eta$ 和 $\\epsilon$ 的乘积都可以忽略不计。最终答案应为单个闭式符号表达式。不需要进行数值计算。",
            "solution": "用户希望推导由负通量修复程序引起的有效增殖因子变化量 $\\Delta k_{\\text{eff}}$。\n\n首先，我们验证问题陈述。\n\n### 步骤1：提取已知条件\n- **问题类型**：单能、稳态中子扩散本征值问题。\n- **区域**：两个均匀区域 $A$ 和 $B$，体积分别为 $V_A$ 和 $V_B$。\n- **材料性质**：宏观截面 $\\Sigma_{aA}$、$\\Sigma_{aB}$（吸收）；$\\Sigma_{sA}$、$\\Sigma_{sB}$（散射）；$\\Sigma_{fA}$、$\\Sigma_{fB}$（裂变）。每次裂变产生的平均中子数为 $\\nu$，适用于两个区域。\n- **边界条件**：反射。\n- **散射模型**：等能且粒子数守恒。这意味着唯一的净中子损失机制是吸收。\n- **通量近似（修复前）**：\n    - 区域 $A$ 中为分段常数通量 $\\phi_A$。\n    - 在区域 $B$ 的一个体积分数为 $\\eta$ 的子体积中，通量为 $-\\epsilon\\,\\phi_B$，其中 $0  \\epsilon \\ll 1$ 且 $0  \\eta \\ll 1$。\n    - 在区域 $B$ 的剩余体积分数 $(1-\\eta)$ 部分，通量为 $\\phi_B$。\n- **修复程序**：\n    1.  将子体积 $\\eta V_B$ 中的负通量截断为 $0$。\n    2.  将得到的非负通量场乘以一个均匀因子 $r$。\n    3.  选择因子 $r$ 以保持总体积积分裂变源守恒，即修复后的源等于修复前的源。\n- **$k_{\\text{eff}}$ 的定义**：$k_{\\text{eff}} = \\frac{\\text{总裂变产生率}}{\\text{总中子损失率（吸收）}}$。\n- **目标**：推导 $\\Delta k_{\\text{eff}} = k_{\\text{eff}}^{(\\text{after})} - k_{\\text{eff}}^{(\\text{before})}$ 关于 $\\nu, \\Sigma_{fA}, \\Sigma_{fB}, \\Sigma_{aA}, \\Sigma_{aB}, \\phi_A, \\phi_B, V_A, V_B, \\eta, \\epsilon$ 的一阶解析表达式。\n- **近似**：忽略超过一阶的 $\\eta$ 和 $\\epsilon$ 的乘积。这被解释为寻找在 $\\eta$ 和 $\\epsilon$ 的展开式中的主导项。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于中子扩散方程和反应率平衡，这些是核反应堆物理学的基本概念。负通量是一个已知的数值假象，“修复”程序是计算反应堆分析中的一个标准课题。该情景是这一现象的简化但有效的模型。\n- **适定性**：该问题是自洽的。所有变量和程序都有明确定义。目标清晰，并且可以从前提中推导出唯一的解析解。\n- **客观性**：问题陈述使用了精确、无偏见的技术语言。\n- **完整性和一致性**：提供了所有必要的参数。诸如反射边界和单能处理等假设是一致的，并且是创建易于处理的分析问题的标准做法。没有矛盾之处。\n- **不切实际或不可行**：该设置是理想化的（例如，分段常数通量），但作为模型问题，其在物理上并非不可能或科学上不合理。\n- **结构**：问题结构良好且不平凡。它需要仔细应用第一性原理和代数操作。\n\n### 步骤3：结论与行动\n问题是有效的。将按要求推导解答。\n\n### 解答推导\n\n有效增殖因子 $k_{\\text{eff}}$ 定义为总裂变中子产生率与总中子损失率之比。根据问题的假设，唯一的损失机制是吸收。\n总产生率 $P$ 和总吸收率 $L$ 由各自反应率的体积积分给出：\n$$P = \\int_V \\nu \\Sigma_f(\\mathbf{r}) \\phi(\\mathbf{r}) dV$$\n$$L = \\int_V \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) dV$$\n因此，$k_{\\text{eff}} = P/L$。\n\n为简化符号，我们定义每个区域中理想化正通量情况下的反应率：\n- 区域 $A$ 的裂变产生：$P_A = \\nu \\Sigma_{fA} \\phi_A V_A$\n- 区域 $B$ 的裂变产生：$P_B = \\nu \\Sigma_{fB} \\phi_B V_B$\n- 区域 $A$ 的吸收：$L_A = \\Sigma_{aA} \\phi_A V_A$\n- 区域 $B$ 的吸收：$L_B = \\Sigma_{aB} \\phi_B V_B$\n\n**1. 修复前的状态**\n\n修复前，通量场在区域B的一个子体积中存在伪负值。我们通过对区域各部分的贡献求和来计算总产生率 $P_{\\text{before}}$ 和总损失率 $L_{\\text{before}}$。\n区域 $A$ 的贡献为 $P_A$ 和 $L_A$。\n区域 $B$ 的贡献分为两部分：\n- 通量为 $\\phi_B$ 的子体积 $(1-\\eta)V_B$：产生为 $(1-\\eta)P_B$，吸收为 $(1-\\eta)L_B$。\n- 通量为 $-\\epsilon\\phi_B$ 的子体积 $\\eta V_B$：产生为 $(-\\epsilon)P_B$，吸收为 $(-\\epsilon)L_B$。注意，对此子体积的积分为 $\\nu \\Sigma_{fB} (-\\epsilon \\phi_B) (\\eta V_B) = -\\epsilon\\eta (\\nu \\Sigma_{fB} \\phi_B V_B) = -\\epsilon\\eta P_B$。\n\n总率值为：\n$$P_{\\text{before}} = P_A + (1-\\eta)P_B - \\epsilon\\eta P_B = P_A + P_B(1 - \\eta - \\epsilon\\eta)$$\n$$L_{\\text{before}} = L_A + (1-\\eta)L_B - \\epsilon\\eta L_B = L_A + L_B(1 - \\eta - \\epsilon\\eta)$$\n\n因此，修复前的增殖因子为：\n$$k_{\\text{eff}}^{(\\text{before})} = \\frac{P_{\\text{before}}}{L_{\\text{before}}} = \\frac{P_A + P_B(1 - \\eta - \\epsilon\\eta)}{L_A + L_B(1 - \\eta - \\epsilon\\eta)}$$\n\n**2. 修复后的状态**\n\n修复程序包含两个步骤。\n首先，将负通量截断为零。新的、未归一化的通量场 $\\phi'(\\mathbf{r})$ 为：\n- 在区域 $A$ 中，$\\phi'_A = \\phi_A$。\n- 在子体积 $(1-\\eta)V_B$ 中，$\\phi'_B = \\phi_B$。\n- 在子体积 $\\eta V_B$ 中，$\\phi'_B = 0$。\n\n其次，该场通过一个因子 $r$ 进行重归一化，以使总裂变源守恒。最终的通量为 $\\phi_{\\text{after}}(\\mathbf{r}) = r \\phi'(\\mathbf{r})$。\n重归一化后的裂变源为：\n$$P_{\\text{after}} = \\int_V \\nu \\Sigma_f(\\mathbf{r}) \\phi_{\\text{after}}(\\mathbf{r}) dV = r \\left( \\nu\\Sigma_{fA}\\phi_A V_A + \\nu\\Sigma_{fB}\\phi_B (1-\\eta)V_B \\right) = r(P_A + P_B(1-\\eta))$$\n裂变源守恒意味着 $P_{\\text{after}} = P_{\\text{before}}$。\n$$r(P_A + P_B(1-\\eta)) = P_A + P_B(1 - \\eta - \\epsilon\\eta)$$\n该关系定义了重归一化因子 $r$，但我们将看到计算 $k_{\\text{eff}}^{(\\text{after})}$ 并不需要它。\n\n修复后的吸收率用最终通量 $\\phi_{\\text{after}}(\\mathbf{r})$ 计算：\n$$L_{\\text{after}} = \\int_V \\Sigma_a(\\mathbf{r}) \\phi_{\\text{after}}(\\mathbf{r}) dV = r \\left( \\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B (1-\\eta)V_B \\right) = r(L_A + L_B(1-\\eta))$$\n\n修复后的增殖因子为：\n$$k_{\\text{eff}}^{(\\text{after})} = \\frac{P_{\\text{after}}}{L_{\\text{after}}} = \\frac{r(P_A + P_B(1-\\eta))}{r(L_A + L_B(1-\\eta))} = \\frac{P_A + P_B(1-\\eta)}{L_A + L_B(1-\\eta)}$$\n因子 $r$ 如预期那样被消去，因为 $k_{\\text{eff}}$ 是一个本征值，对本征函数（通量）的均匀缩放不敏感。\n\n**3. 计算变化量 $\\Delta k_{\\text{eff}}$**\n\n我们需要计算 $\\Delta k_{\\text{eff}} = k_{\\text{eff}}^{(\\text{after})} - k_{\\text{eff}}^{(\\text{before})}$。\n$$\\Delta k_{\\text{eff}} = \\frac{P_A + P_B(1-\\eta)}{L_A + L_B(1-\\eta)} - \\frac{P_A + P_B(1 - \\eta - \\epsilon\\eta)}{L_A + L_B(1 - \\eta - \\epsilon\\eta)}$$\n让我们定义 $P_1 = P_A + P_B(1-\\eta)$，$L_1 = L_A + L_B(1-\\eta)$，以及由假象引起的小扰动为 $\\delta_P = -P_B\\epsilon\\eta$ 和 $\\delta_L = -L_B\\epsilon\\eta$。\n那么 $k_{\\text{eff}}^{(\\text{after})} = P_1/L_1$ 且 $k_{\\text{eff}}^{(\\text{before})} = (P_1+\\delta_P)/(L_1+\\delta_L)$。\n$$\\Delta k_{\\text{eff}} = \\frac{P_1}{L_1} - \\frac{P_1+\\delta_P}{L_1+\\delta_L} = \\frac{P_1(L_1+\\delta_L) - L_1(P_1+\\delta_P)}{L_1(L_1+\\delta_L)} = \\frac{P_1\\delta_L - L_1\\delta_P}{L_1(L_1+\\delta_L)}$$\n由于 $\\delta_P$ 和 $\\delta_L$ 是 $\\epsilon\\eta$ 的阶，对于主导项，我们可以用 $L_1^2$ 来近似分母。\n$$\\Delta k_{\\text{eff}} \\approx \\frac{P_1\\delta_L - L_1\\delta_P}{L_1^2}$$\n现在，我们代入 $P_1, L_1, \\delta_P, \\delta_L$ 的表达式：\n分子是\n$$ (P_A + P_B(1-\\eta))(-L_B\\epsilon\\eta) - (L_A + L_B(1-\\eta))(-P_B\\epsilon\\eta) $$\n$$ = \\epsilon\\eta \\left[ - (P_A + P_B(1-\\eta))L_B + (L_A + L_B(1-\\eta))P_B \\right] $$\n$$ = \\epsilon\\eta \\left[ -P_A L_B - P_B L_B + P_B L_B \\eta + L_A P_B + L_B P_B - L_B P_B \\eta \\right] $$\n$$ = \\epsilon\\eta (P_B L_A - P_A L_B) $$\n分母是 $L_1^2 = (L_A + L_B(1-\\eta))^2$。由于 $\\eta \\ll 1$，我们可以将其近似为主导阶 $(L_A+L_B)^2$。修正项将是 $\\eta$ 的阶，当乘以分子的 $\\epsilon\\eta$ 时，将产生 $\\epsilon\\eta^2$ 阶的项，这些是更高阶的项，可以忽略。\n因此，变化量的一阶（主导阶）表达式为：\n$$\\Delta k_{\\text{eff}} \\approx \\frac{(P_B L_A - P_A L_B)\\epsilon\\eta}{(L_A+L_B)^2}$$\n最后，我们代回 $P_A, P_B, L_A, L_B$ 的完整定义：\n$$P_B L_A - P_A L_B = (\\nu \\Sigma_{fB} \\phi_B V_B)(\\Sigma_{aA} \\phi_A V_A) - (\\nu \\Sigma_{fA} \\phi_A V_A)(\\Sigma_{aB} \\phi_B V_B)$$\n$$ = \\nu \\phi_A V_A \\phi_B V_B (\\Sigma_{fB}\\Sigma_{aA} - \\Sigma_{fA}\\Sigma_{aB})$$\n$$L_A + L_B = \\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B V_B$$\n将这些组合起来，就得到了有效增殖因子变化量的最终表达式。\n$$ \\Delta k_{\\text{eff}} = \\frac{\\nu \\phi_A V_A \\phi_B V_B (\\Sigma_{fB}\\Sigma_{aA} - \\Sigma_{fA}\\Sigma_{aB})}{(\\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B V_B)^2} \\epsilon\\eta $$\n这是所需的一阶表达式，因为它代表了 $\\Delta k_{\\text{eff}}$ 在小参数 $\\eta$ 和 $\\epsilon$ 的幂次展开中的主导项。",
            "answer": "$$ \\boxed{\\frac{\\nu \\phi_A V_A \\phi_B V_B (\\Sigma_{fB}\\Sigma_{aA} - \\Sigma_{fA}\\Sigma_{aB})}{(\\Sigma_{aA}\\phi_A V_A + \\Sigma_{aB}\\phi_B V_B)^2} \\epsilon\\eta} $$"
        },
        {
            "introduction": "本章的最终实践旨在将理论与实际应用联系起来。在这个练习中，你将构建一个简单的二维中子扩散程序来求解 $k$ 特征值问题。你需要在程序中实现一种依赖于参数的负通量修正方案，并对其进行敏感性分析。通过  这项动手编程任务，你将能够直接、定量地研究不同的修正策略（例如，更强或更弱的修正）如何影响特征值 $k_{\\text{eff}}$、中子泄漏率以及功率峰因子等关键反應堆参数，从而具体地体会到在保证解的正性和维持计算精度之间的权衡。",
            "id": "4237649",
            "problem": "考虑一个在均匀方格栅格上的二维单群中子扩散 $k$ 特征值问题，其边界条件为真空（零狄利克雷）边界条件。其控制方程是稳态平衡定律\n$$\n-\\nabla \\cdot \\left(D(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})\\right) + \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) = \\frac{1}{k_{\\text{eff}}} \\, \\nu \\Sigma_f(\\mathbf{r}) \\, \\phi(\\mathbf{r}),\n$$\n其中 $D$ 是扩散系数，$\\Sigma_a$ 是宏观吸收截面，$\\nu \\Sigma_f$ 是宏观裂变产生截面，$\\phi$ 是标量中子通量，$k_{\\text{eff}}$ 是有效增殖因子。真空边界条件意味着在区域边界上 $\\phi=0$。\n\n使用标准的五点有限差分格式，在单元宽度为 $h$ 的 $N_x \\times N_y$ 均匀网格上对此方程进行离散化，其中交界面上的扩散系数采用算术平均。设离散通量向量为 $\\boldsymbol{\\phi} \\in \\mathbb{R}^{N_x N_y}$，包含零狄利克雷边界条件的离散扩散算子为稀疏矩阵 $\\mathbf{A} \\in \\mathbb{R}^{N \\times N}$（其中 $N=N_x N_y$），对角裂变产生算子由非负向量 $\\mathbf{f} \\in \\mathbb{R}^N$ 表示，其元素为 $f_i = \\nu \\Sigma_{f,i}$。离散化的 $k$ 特征值问题为\n$$\n\\mathbf{A}\\boldsymbol{\\phi} = \\frac{1}{k_{\\text{eff}}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi},\n$$\n其中 $\\odot$ 表示逐元素乘法。\n\n使用以下基于连续裂变源迭代法（即对算子 $\\mathbf{A}^{-1} \\operatorname{diag}(\\mathbf{f})$ 进行幂迭代）的基本迭代格式：\n1. 初始化 $k^{(0)}$ 和 $\\boldsymbol{\\phi}^{(0)}$。在第 $m$ 次迭代时，构建裂变源\n$$\n\\mathbf{q}^{(m)} = \\frac{1}{k^{(m)}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi}^{(m)}.\n$$\n2. 求解线性系统\n$$\n\\mathbf{A}\\boldsymbol{\\phi}^{(m+1)} = \\mathbf{q}^{(m)}.\n$$\n3. 应用修正算子，使用强度参数为 $\\alpha \\in [0,1]$ 且下限值为 $\\varepsilon > 0$ 的限制器来强制实现非负性：\n$$\n\\phi_i^{(m+1,\\text{fix})} = \n\\begin{cases}\n(1-\\alpha)\\,\\phi_i^{(m+1)} + \\alpha \\,\\varepsilon,  \\text{if } \\phi_i^{(m+1)}  \\varepsilon,\\\\\n\\phi_i^{(m+1)},  \\text{otherwise}.\n\\end{cases}\n$$\n4. 通过连续迭代步的总裂变产生率之比来更新有效增殖因子，\n$$\nk^{(m+1)} = k^{(m)} \\, \\frac{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m)}},\n$$\n并将通量重新归一化至单位裂变产生率，\n$$\n\\boldsymbol{\\phi}^{(m+1)} = \\frac{\\boldsymbol{\\phi}^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}},\n$$\n使得对于所有 $m \\ge 0$ 都有 $\\sum_i f_i \\, \\phi_i^{(m+1)} = 1$。\n\n对于泄漏，在真空边界处使用离散扩散流近似。对于一个外向单位法向量为 $\\hat{\\mathbf{n}}$ 的边界面，其法向流为 $J_n = -D \\, \\partial \\phi / \\partial n$。在零狄利克雷边界和均匀间距下，近似 $\\partial \\phi / \\partial n \\approx (\\phi_{\\text{ghost}} - \\phi_{\\text{interior}})/h = -\\phi_{\\text{interior}}/h$，因此每个边界面的外向泄漏为 $J_{\\text{out}} h = D \\, \\phi_{\\text{interior}}$。总泄漏是所有外表面的总和，在均匀网格上，这简化为每个边界单元面上 $D \\, \\phi$ 的总和。\n\n将栅元功率定义为 $p_i = f_i \\, \\phi_i$，并报告最大栅元功率。在此设置中，所有输出都是无量纲的。\n\n在 $h=1$ 的 $10 \\times 10$ 网格（$N_x=N_y=10$）上构建非均匀材料分布如下：\n- 中心燃料区，占据索引 $i \\in \\{3,4,5,6\\}$ 和 $j \\in \\{3,4,5,6\\}$，其参数为 $D_{\\text{fuel}} = 1.2$，$\\Sigma_{a,\\text{fuel}} = 0.20$，$\\nu\\Sigma_{f,\\text{fuel}} = 0.40$。\n- 其他区域为慢化剂区，其参数为 $D_{\\text{mod}} = 1.0$，$\\Sigma_{a,\\text{mod}} = 0.08$，$\\nu\\Sigma_{f,\\text{mod}} = 0.0$。\n\n使用每个内表面的算术平均来构建 $\\mathbf{A}$：对于单元 $i$ 和 $j$ 之间的面，使用 $D_{\\text{face}} = \\left(D_i + D_j\\right)/2$。对于边界面，通过将 $D_i/h^2$ 加到相邻内部单元的对角元上，并且不设置跨边界的非对角耦合，来强制施加零狄利克雷边界条件。\n\n基准参考：通过设置 $\\alpha=0$（无修正）和初始通量 $\\boldsymbol{\\phi}^{(0)}$ 全为1（并归一化使得 $\\sum_i f_i \\, \\phi_i^{(0)} = 1$）来运行迭代，计算一个参考解。迭代直至 $k_{\\text{eff}}$ 的相对变化和 $\\boldsymbol{\\phi}$ 的相对 $\\ell_2$ 范数变化均小于 $10^{-9}$，或达到最多 500 次迭代时收敛。记录参考的 $k_{\\text{eff}}$、泄漏和通量。\n\n灵敏度实验：对于下面的每个测试用例，从一个带有负分量的、刻意设置的振荡初始通量开始，\n$$\n\\phi_{i,j}^{(0)} = 0.10 + 0.20 \\sin\\left(\\frac{\\pi i}{N_x}\\right) \\cos\\left(\\frac{2 \\pi j}{N_y}\\right) - 0.15 \\cos\\left(\\frac{\\pi i}{N_x}\\right),\n$$\n将其重塑为向量，并进行缩放以使 $\\sum_i f_i \\, \\phi_i^{(0)} = 1$。使用初始 $k^{(0)}=1.0$，与基准运行相同的收敛准则，并使用指定的 $(\\alpha,\\varepsilon)$ 应用修正步骤。\n\n对于每个测试用例，计算：\n- 收敛后的 $k_{\\text{eff}}$。\n- 总泄漏，即所有边界表面上 $D \\, \\phi$ 的总和。\n- 最大栅元功率 $\\max_i p_i$。\n- $k_{\\text{eff}}$ 相对于基准的相对误差，$\\left|k_{\\text{eff}}^{\\text{test}} - k_{\\text{eff}}^{\\text{ref}}\\right|/k_{\\text{eff}}^{\\text{ref}}$。\n- 泄漏相对于基准的相对误差，$\\left|L^{\\text{test}} - L^{\\text{ref}}\\right|/L^{\\text{ref}}$。\n- 通量相对于基准的相对 $\\ell_2$ 范数误差，$\\left\\|\\boldsymbol{\\phi}^{\\text{test}} - \\boldsymbol{\\phi}^{\\text{ref}}\\right\\|_2 / \\left\\|\\boldsymbol{\\phi}^{\\text{ref}}\\right\\|_2$。\n\n测试套件（五个探索限制器强度和下限值的案例）：\n1. $(\\alpha,\\varepsilon) = (0.0, 10^{-12})$,\n2. $(\\alpha,\\varepsilon) = (0.2, 10^{-8})$,\n3. $(\\alpha,\\varepsilon) = (0.5, 10^{-6})$,\n4. $(\\alpha,\\varepsilon) = (0.8, 10^{-4})$,\n5. $(\\alpha,\\varepsilon) = (1.0, 10^{-3})$.\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果是一个包含六个浮点数的列表，顺序如下\n$$\n\\left[k_{\\text{eff}}, \\, \\text{leakage}, \\, \\max(p_i), \\, \\text{rel_k_error}, \\, \\text{rel_leak_error}, \\, \\text{rel_flux_L2}\\right].\n$$\n例如，最终输出应如下所示\n$$\n\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right].\n$$\n所有值都是无量纲的，不需要物理单位。问题不涉及角度，因此也不需要角度单位。所有误差都以小数形式表示（而非百分比）。",
            "solution": "该问题要求使用幂迭代法求解非均匀方格栅格上的二维单群中子扩散 $k$ 特征值问题，并分析一种负通量修正方案。\n\n### 1. 问题公式\n连续问题由稳态中子扩散方程控制，其边界条件为零狄利克雷边界条件（即在边界 $\\partial \\Omega$ 上 $\\phi=0$）：\n$$\n-\\nabla \\cdot \\left(D(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})\\right) + \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) = \\frac{1}{k_{\\text{eff}}} \\, \\nu \\Sigma_f(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\quad \\text{for } \\mathbf{r} \\in \\Omega\n$$\n使用以网格单元为中心的有限差分法，在网格间距为 $h$ 的均匀笛卡尔网格上对此方程进行离散化，可得到一个矩阵特征值问题：\n$$\n\\mathbf{A}\\boldsymbol{\\phi} = \\frac{1}{k_{\\text{eff}}} \\mathbf{F}\\boldsymbol{\\phi}\n$$\n此处，$\\boldsymbol{\\phi}$ 是单元平均通量向量，$\\mathbf{A}$ 是代表湮灭算子（扩散泄漏加吸收）的稀疏矩阵，$\\mathbf{F}$ 是代表裂变产生算子的对角矩阵，其对角线元素为 $(\\mathbf{F})_{ii} = f_i = (\\nu \\Sigma_f)_i$。问题陈述中使用了逐元素乘积的表示法 $\\mathbf{f} \\odot \\boldsymbol{\\phi}$，这等价于 $\\mathbf{F}\\boldsymbol{\\phi}$。\n\n### 2. 离散化与矩阵构建\n我们为尺寸为 $N_x \\times N_y$ 的网格构建矩阵 $\\mathbf{A}$。二维单元索引 $(i,j)$ 映射到一维向量索引 $k = i \\cdot N_y + j$。矩阵 $\\mathbf{A}$ 的维度为 $(N_x N_y) \\times (N_x N_y)$。\n\n对于与网格位置 $(i,j)$ 对应的内部单元 $k$，其平衡方程在乘以 $h^2$ 后为：\n$$\n\\left( \\sum_{l \\in N(k)} \\frac{D_{k,l}}{h^2} + \\Sigma_{a,k} \\right) \\phi_k - \\sum_{l \\in N(k)} \\frac{D_{k,l}}{h^2} \\phi_l = \\frac{1}{k_{\\text{eff}}} f_k \\phi_k\n$$\n其中 $N(k)$ 是单元 $k$ 的四个相邻邻居的集合，$D_{k,l}$ 是单元 $k$ 和 $l$ 之间交界面上的扩散系数。问题指定使用算术平均：$D_{k,l} = (D_k + D_l)/2$。当 $h=1$ 时，此式得到简化。\n\n因此，矩阵 $\\mathbf{A}$ 的元素为：\n- **非对角元素**：对于单元 $k$ 的一个邻居单元 $l$，矩阵元素为 $A_{k,l} = -D_{k,l}/h^2 = -(D_k + D_l)/2$。\n- **对角元素**：对角元素 $A_{k,k}$ 由吸收项和泄漏项组成。\n对于位于 $(i,j)$ 的内部单元 $k$：\n$$\nA_{k,k} = \\Sigma_{a,k} + \\frac{1}{h^2}\\left( D_{k, \\text{north}} + D_{k, \\text{south}} + D_{k, \\text{east}} + D_{k, \\text{west}} \\right)\n$$\n其中 $D_{k, \\text{direction}}$ 是面平均扩散系数。\n\n对于边界上的单元 $k$，问题指定通过为每个边界面将 $D_k/h^2$ 添加到对角线上来强制施加零狄利克雷条件。这实际上意味着，对于一个边界面，相邻的通量为零，泄漏项被加到对角元上，而不是与外部节点耦合。对于左边界（$i=0$）上的单元 $k=(i,j)$，“西侧”邻居就是边界。对对角元的贡献是 $D_k/h^2$，并且该面没有非对角元素。\n对于 $h=1$ 时位于 $(i,j)$ 的单元 $k$，其对角元素 $A_{k,k}$ 的通用公式为：\n$$\nA_{k,k} = \\Sigma_{a,k} + C_N + C_S + C_E + C_W\n$$\n其中耦合项 $C$ 为：\n- $C_N = \\begin{cases} (D_{i,j}+D_{i,j+1})/2  \\text{如果 } j  N_y-1 \\\\ D_{i,j}  \\text{如果 } j = N_y-1 \\end{cases}$\n- $C_S = \\begin{cases} (D_{i,j}+D_{i,j-1})/2  \\text{如果 } j > 0 \\\\ D_{i,j}  \\text{如果 } j = 0 \\end{cases}$\n- $C_E = \\begin{cases} (D_{i,j}+D_{i+1,j})/2  \\text{如果 } i  N_x-1 \\\\ D_{i,j}  \\text{如果 } i = N_x-1 \\end{cases}$\n- $C_W = \\begin{cases} (D_{i,j}+D_{i-1,j})/2  \\text{如果 } i > 0 \\\\ D_{i,j}  \\text{如果 } i = 0 \\end{cases}$\n非对角项也相应设置。例如，对于对应于 $(i,j+1)$ 的邻居 $l$，如果 $j  N_y-1$，则 $A_{k,l} = -(D_{i,j}+D_{i,j+1})/2$。\n\n### 3. 数值求解算法\n该特征值问题使用裂变源迭代法（幂迭代）求解。给定特征值 $k^{(0)}$ 和特征向量 $\\boldsymbol{\\phi}^{(0)}$ 的初始猜测，算法按如下方式迭代，其中 $m=0, 1, 2, \\dots$：\n\n1.  **计算裂变源**：使用当前的通量和特征值计算下一次通量迭代的源项：\n    $$ \\mathbf{q}^{(m)} = \\frac{1}{k^{(m)}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi}^{(m)} $$\n\n2.  **求解通量**：通过求解代表给定源项的扩散和吸收的线性系统来获得新的通量分布：\n    $$ \\mathbf{A}\\boldsymbol{\\phi}^{(m+1)} = \\mathbf{q}^{(m)} $$\n    由于 $\\mathbf{A}$ 是一个稀疏矩阵，这个求解过程可以很高效。\n\n3.  **应用非负性修正**：由于数值精度或初始猜测的性质，得到的通量 $\\boldsymbol{\\phi}^{(m+1)}$ 可能包含小的负值。应用一个限制器来强制其为正。对每个单元 $i$：\n    $$ \\phi_i^{(m+1,\\text{fix})} = \\begin{cases} (1-\\alpha)\\,\\phi_i^{(m+1)} + \\alpha \\,\\varepsilon,  \\text{if } \\phi_i^{(m+1)}  \\varepsilon,\\\\ \\phi_i^{(m+1)},  \\text{otherwise}. \\end{cases} $$\n    参数 $\\alpha$ 控制修正的强度，它将计算出的负通量与一个小的正下限值 $\\varepsilon$ 进行混合。\n\n4.  **更新特征值和归一化通量**：更新特征值和通量。首先，根据修正后的通量计算总裂变产生率：$P^{(m+1)} = \\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}$。\n    通过裂变产生率的比值来更新特征值：\n    $$ k^{(m+1)} = k^{(m)} \\, \\frac{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m)}} $$\n    问题指定在每一步都对通量进行归一化，使得对于所有 $m \\ge 0$ 都有 $\\sum_i f_i \\, \\phi_i^{(m)} = 1$。这可将更新简化为：\n    $$ k^{(m+1)} = k^{(m)} \\cdot P^{(m+1)} $$\n    然后对下一次迭代的通量向量进行重新归一化：\n    $$ \\boldsymbol{\\phi}^{(m+1)} = \\frac{\\boldsymbol{\\phi}^{(m+1,\\text{fix})}}{P^{(m+1)}} $$\n\n迭代持续进行，直到 $k_{\\text{eff}}$ 和 $\\boldsymbol{\\phi}$ 的相对变化都低于 $10^{-9}$ 的容差为止。\n\n### 4. 输出量的计算\n在收敛到 $k_{\\text{eff}}$ 和 $\\boldsymbol{\\phi}$ 之后：\n- **总泄漏（$L$）**：从区域流出的总中子泄漏是所有边界面上的流的总和。对于边界上的一个单元 $k$，通过面积为 $h$ 的边界面向外的流近似为 $J_{\\text{out}} h = (D_k \\phi_k/h) h = D_k \\phi_k$。总泄漏是这些项在所有边界面上的总和：\n$$ L = \\sum_{j=0}^{N_y-1} \\left( D_{0,j}\\phi_{0,j} + D_{N_x-1,j}\\phi_{N_x-1,j} \\right) + \\sum_{i=1}^{N_x-2} \\left( D_{i,0}\\phi_{i,0} + D_{i,N_y-1}\\phi_{i,N_y-1} \\right) $$\n此表达式正确地计算了角部单元，将它们来自两个边界面的贡献相加。\n- **栅元功率 ($p_i$)**：单元 $i$ 中的栅元功率是裂变率，即 $p_i = f_i \\phi_i$。最大栅元功率是 $\\max_i(p_i)$。\n- **相对误差**：测试用例的误差是相对于使用 $\\alpha=0$ 和正初始通量获得的基准参考解（$\\text{ref}$）计算的：\n  - $\\text{rel\\_k\\_err} = |k_{\\text{eff}}^{\\text{test}} - k_{\\text{eff}}^{\\text{ref}}| / k_{\\text{eff}}^{\\text{ref}}$\n  - $\\text{rel\\_leak\\_err} = |L^{\\text{test}} - L^{\\text{ref}}| / L^{\\text{ref}}$\n  - $\\text{rel\\_flux\\_L2\\_err} = \\|\\boldsymbol{\\phi}^{\\text{test}} - \\boldsymbol{\\phi}^{\\text{ref}}\\|_2 / \\|\\boldsymbol{\\phi}^{\\text{ref}}\\|_2$\n\n### 5. 执行计划\n将实现一个 Python 脚本来执行以下步骤：\n1.  定义几何形状、材料属性，并创建材料分布图（$D$, $\\Sigma_a$, $f$）。\n2.  根据离散化规则构建稀疏矩阵 $\\mathbf{A}$。\n3.  实现一个执行幂迭代的求解器函数，包括修正步骤。\n4.  **基准运行**：使用 $\\alpha=0$、均匀正初始通量和初始 $k^{(0)}=1.0$ 调用求解器，以获得 $k_{\\text{eff}}^{\\text{ref}}$、$L^{\\text{ref}}$ 和 $\\boldsymbol{\\phi}^{\\text{ref}}$。\n5.  **测试套件运行**：对于五个 $(\\alpha, \\varepsilon)$ 测试用例中的每一个，生成指定的振荡初始通量，对其进行归一化，然后调用求解器以获得测试用例结果。\n6.  为每个测试用例计算所需的输出量和相对误差。\n7.  将最终结果格式化为列表的列表并打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Solves the 2D neutron diffusion k-eigenvalue problem and analyzes negative flux fixup schemes.\n    \"\"\"\n    # 1. Setup: Problem Parameters and Material Properties\n    Nx, Ny = 10, 10\n    h = 1.0\n    N = Nx * Ny\n    tol = 1e-9\n    max_iter = 500\n\n    # Initialize material property arrays\n    D = np.full((Nx, Ny), 1.0)\n    Sigma_a = np.full((Nx, Ny), 0.08)\n    nuSigma_f = np.zeros((Nx, Ny))\n\n    # Assign fuel properties to central region (indices 3,4,5,6)\n    fuel_indices = slice(3, 7)\n    D[fuel_indices, fuel_indices] = 1.2\n    Sigma_a[fuel_indices, fuel_indices] = 0.20\n    nuSigma_f[fuel_indices, fuel_indices] = 0.40\n\n    # Flatten material properties to 1D vectors\n    D_vec = D.flatten()\n    Sigma_a_vec = Sigma_a.flatten()\n    f_vec = nuSigma_f.flatten()\n\n    # 2. Matrix Construction\n    A = lil_matrix((N, N))\n    for i in range(Nx):\n        for j in range(Ny):\n            k = i * Ny + j\n            \n            # Diagonal term from absorption\n            A[k, k] += Sigma_a_vec[k]\n\n            # Coupling to neighbors\n            # North\n            if j  Ny - 1:\n                l = i * Ny + (j + 1)\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n            \n            # South\n            if j > 0:\n                l = i * Ny + (j - 1)\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n\n            # East\n            if i  Nx - 1:\n                l = (i + 1) * Ny + j\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n                \n            # West\n            if i > 0:\n                l = (i - 1) * Ny + j\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n    \n    A_csc = csc_matrix(A)\n\n    def power_iteration(phi0, k0, alpha, epsilon):\n        phi = np.copy(phi0)\n        # Normalize initial flux\n        fission_prod = np.dot(f_vec, phi)\n        if np.abs(fission_prod) > 1e-12: # Avoid division by zero\n            phi /= fission_prod\n        \n        k = k0\n\n        for _ in range(max_iter):\n            phi_old = np.copy(phi)\n            k_old = k\n\n            # 1. Fission Source\n            q = (1.0 / k) * (f_vec * phi)\n            \n            # 2. Solve for flux\n            phi_next_unfixed = spsolve(A_csc, q)\n\n            # 3. Apply fixup\n            phi_next_fixed = np.copy(phi_next_unfixed)\n            neg_indices = phi_next_fixed  epsilon\n            phi_next_fixed[neg_indices] = (1.0 - alpha) * phi_next_unfixed[neg_indices] + alpha * epsilon\n            \n            # 4. Update eigenvalue and renormalize flux\n            fission_prod_old = np.dot(f_vec, phi_old)\n            # This should be 1.0 after the first iteration\n            if abs(fission_prod_old)  1e-15: fission_prod_old = 1.0\n            \n            fission_prod_new = np.dot(f_vec, phi_next_fixed)\n\n            k = k_old * (fission_prod_new / fission_prod_old)\n            \n            if np.abs(fission_prod_new) > 1e-12:\n                phi = phi_next_fixed / fission_prod_new\n            else: # Fission production collapsed, unlikely but handle\n                phi = np.zeros_like(phi)\n\n            # Convergence check\n            k_rel_err = np.abs(k - k_old) / k if k > 0 else 0\n            phi_l2_norm = np.linalg.norm(phi, 2)\n            phi_rel_err = np.linalg.norm(phi - phi_old, 2) / phi_l2_norm if phi_l2_norm > 0 else 0\n            \n            if k_rel_err  tol and phi_rel_err  tol:\n                break\n        \n        return k, phi\n\n    def calculate_leakage(phi_vec, D_vec):\n        leakage = 0.0\n        for i in range(Nx):\n            for j in range(Ny):\n                k = i * Ny + j\n                if i == 0:\n                    leakage += D_vec[k] * phi_vec[k]\n                if i == Nx - 1:\n                    leakage += D_vec[k] * phi_vec[k]\n                if j == 0:\n                    leakage += D_vec[k] * phi_vec[k]\n                if j == Ny - 1:\n                    leakage += D_vec[k] * phi_vec[k]\n        return leakage\n\n    # 3. Baseline Reference Calculation\n    phi0_ref = np.ones(N)\n    k0_ref = 1.0\n    k_ref, phi_ref = power_iteration(phi0_ref, k0_ref, alpha=0.0, epsilon=1e-12)\n    leakage_ref = calculate_leakage(phi_ref, D_vec)\n    phi_ref_norm = np.linalg.norm(phi_ref, 2)\n\n    # 4. Sensitivity Experiments\n    test_cases = [\n        (0.0, 1e-12),\n        (0.2, 1e-8),\n        (0.5, 1e-6),\n        (0.8, 1e-4),\n        (1.0, 1e-3),\n    ]\n    results = []\n\n    # Prepare oscillatory initial flux\n    phi0_test_grid = np.zeros((Nx, Ny))\n    for i in range(Nx):\n        for j in range(Ny):\n            phi0_test_grid[i, j] = 0.10 + 0.20 * np.sin(np.pi * (i+0.5) / Nx) * np.cos(2 * np.pi * (j+0.5) / Ny) - 0.15 * np.cos(np.pi * (i+0.5) / Nx)\n    phi0_test = phi0_test_grid.flatten()\n    k0_test = 1.0\n\n    for alpha_test, epsilon_test in test_cases:\n        k_test, phi_test = power_iteration(phi0_test, k0_test, alpha_test, epsilon_test)\n        \n        # Calculate required outputs\n        leakage_test = calculate_leakage(phi_test, D_vec)\n        pin_power_test = f_vec * phi_test\n        max_pin_power = np.max(pin_power_test)\n        \n        # Calculate relative errors\n        rel_k_error = np.abs(k_test - k_ref) / k_ref\n        rel_leak_error = np.abs(leakage_test - leakage_ref) / leakage_ref\n        rel_flux_l2_error = np.linalg.norm(phi_test - phi_ref, 2) / phi_ref_norm\n        \n        case_results = [\n            k_test,\n            leakage_test,\n            max_pin_power,\n            rel_k_error,\n            rel_leak_error,\n            rel_flux_l2_error\n        ]\n        results.append(case_results)\n\n    # 5. Final Output\n    # The output format requires a list of lists.\n    # The map converts each float to string for join, and str() on a list adds spaces.\n    # To get the exact format, we manually build the string representation.\n    output_str = \"[\" + \",\".join([f\"[{','.join(f'{v:.10e}' for v in res)}]\" for res in results]) + \"]\"\n\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}