{
    "hands_on_practices": [
        {
            "introduction": "The heart of any multigrid method is the coarse-grid operator, which must accurately solve for the low-frequency error components that the fine-grid smoother cannot efficiently eliminate. For problems with complex or discontinuous coefficients, such as those found in reactor physics, naively rediscretizing the problem on a coarse grid can introduce significant errors and harm convergence. This exercise provides a first-principles derivation comparing the physically robust Galerkin coarse operator with a naive rediscretization approach, demonstrating why the Galerkin construction is essential for preserving fine-scale physics on the coarse grid .",
            "id": "4236904",
            "problem": "Consider the one-group steady neutron diffusion equation in Cartesian geometry, written for the scalar neutron flux $\\phi(x,y)$ as $-\\nabla \\cdot (D(x,y)\\,\\nabla \\phi) = 0$, where $D(x,y)$ is the diffusion coefficient. Assume a conservative cell-centered finite-volume discretization on a uniform $2 \\times 2$ fine grid of square cells of side length $h$, with cell centers at the usual midpoints and face-centered diffusive fluxes computed by Fick's law and continuity of normal current. The diffusion coefficient $D(x,y)$ is heterogeneous in a checkerboard pattern: the top-left fine cell has $D = D_{A}$, the top-right has $D = D_{B}$, the bottom-left has $D = D_{B}$, and the bottom-right has $D = D_{A}$, with $D_{A} > 0$ and $D_{B} > 0$.\n\nForm a two-cell coarse grid by aggregating the two left fine cells into a single coarse cell $L$ and the two right fine cells into a single coarse cell $R$. Define the multigrid coarse operator by the Galerkin projection with restriction $R = P^{\\top}$, where the prolongation $P$ is piecewise constant on aggregates: a coarse degree of freedom injects a constant value to all its constituent fine cells, and zero elsewhere. For comparison, define a rediscretized coarse operator by discretizing the same diffusion equation on the two-cell coarse grid, using the same finite-volume scheme, with coarse-cell diffusion coefficients given by the volume average within each aggregate, i.e., $D_{L}^{c} = (D_{A} + D_{B})/2$ and $D_{R}^{c} = (D_{A} + D_{B})/2$.\n\nLet the coarse-grid off-diagonal entry between $L$ and $R$ be denoted by $A_{H}^{\\text{Gal}}(L,R)$ for the Galerkin operator and $A_{H}^{\\text{Red}}(L,R)$ for the rediscretized operator. Using only the fundamental definitions above (Fick’s law for diffusive flux, continuity of normal current across faces, and conservative finite-volume balance), derive each off-diagonal entry from first principles. Then compute the ratio of magnitudes\n$$\\mathcal{R} = \\frac{|A_{H}^{\\text{Red}}(L,R)|}{|A_{H}^{\\text{Gal}}(L,R)|}$$\nas a closed-form analytic expression in terms of $D_{A}$ and $D_{B}$.\n\nFinally, briefly explain, based on your derivation, which construction better captures the fine-scale physics across the coarse interface for the given checkerboard heterogeneity. Express the final ratio $\\mathcal{R}$ as your answer. No rounding is required, and no units should be included in the final expression.",
            "solution": "The problem requires the derivation of off-diagonal entries for two types of multigrid coarse-grid operators—Galerkin and rediscretized—and the calculation of the ratio of their magnitudes. The analysis is based on a cell-centered finite-volume discretization of the steady-state neutron diffusion equation, $-\\nabla \\cdot (D(x,y)\\,\\nabla \\phi) = 0$, on a specific $2 \\times 2$ heterogeneous grid.\n\nFirst, we establish the fine-grid discretization. The domain is a $2 \\times 2$ grid of square cells, each with side length $h$. Let the cells be numbered as follows:\n- Cell $1$: top-left, with diffusion coefficient $D_1 = D_A$.\n- Cell $2$: top-right, with diffusion coefficient $D_2 = D_B$.\n- Cell $3$: bottom-left, with diffusion coefficient $D_3 = D_B$.\n- Cell $4$: bottom-right, with diffusion coefficient $D_4 = D_A$.\n\nThe cell-centered finite-volume method yields a system of linear equations $A_h \\phi_h = f_h$, where $\\phi_h = [\\phi_1, \\phi_2, \\phi_3, \\phi_4]^{\\top}$ is the vector of cell-averaged fluxes. The equation for a cell $i$ is derived from the conservative balance law, which states that the sum of currents leaving the cell through its faces is zero (for a source-free problem).\nThe current across the face between cell $i$ and cell $j$ is given by Fick's law. For a face of length $h$ and cell center distance $h$, the integrated current (or flux) is $F_{ij} = C_{ij}(\\phi_i - \\phi_j)$, where $C_{ij}$ is the conductance. The matrix entry $A_{ij}$ for $i \\neq j$ is given by $A_{ij} = -C_{ij}$. The conductance is defined as $C_{ij} = \\frac{D_{ij} \\cdot (\\text{face area})}{(\\text{cell distance})}$, where $D_{ij}$ is the diffusion coefficient at the interface.\nFor a 2D problem on a square grid of side $h$, the face area is $h$ (per unit depth) and the distance between cell centers is $h$. Thus, $C_{ij} = D_{ij}$. The problem specifies continuity of normal current, which implies that the interface diffusion coefficient $D_{ij}$ should be the harmonic mean of the diffusion coefficients of the adjacent cells: $D_{ij} = \\frac{2 D_i D_j}{D_i + D_j}$.\n\nLet's compute the conductances between adjacent fine cells:\n- Interface $1$-$2$: $C_{12} = \\frac{2 D_1 D_2}{D_1 + D_2} = \\frac{2 D_A D_B}{D_A + D_B}$.\n- Interface $1$-$3$: $C_{13} = \\frac{2 D_1 D_3}{D_1 + D_3} = \\frac{2 D_A D_B}{D_A + D_B}$.\n- Interface $2$-$4$: $C_{24} = \\frac{2 D_2 D_4}{D_2 + D_4} = \\frac{2 D_B D_A}{D_B + D_A}$.\n- Interface $3$-$4$: $C_{34} = \\frac{2 D_3 D_4}{D_3 + D_4} = \\frac{2 D_B D_A}{D_B + D_A}$.\nAll four conductances are identical. Let us denote this value by $K = \\frac{2 D_A D_B}{D_A + D_B}$. The off-diagonal entries of the fine-grid matrix $A_h$ are $A_{ij} = -K$ if cells $i$ and $j$ are adjacent, and $0$ otherwise. The diagonal entries are $A_{ii} = -\\sum_{j \\neq i} A_{ij}$. This gives the fine-grid operator matrix:\n$$\nA_h = \\begin{pmatrix}\nC_{12}+C_{13} & -C_{12} & -C_{13} & 0 \\\\\n-C_{21} & C_{21}+C_{24} & 0 & -C_{24} \\\\\n-C_{31} & 0 & C_{31}+C_{34} & -C_{34} \\\\\n0 & -C_{42} & -C_{43} & C_{42}+C_{43}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n2K & -K & -K & 0 \\\\\n-K & 2K & 0 & -K \\\\\n-K & 0 & 2K & -K \\\\\n0 & -K & -K & 2K\n\\end{pmatrix}\n$$\n\nNext, we construct the Galerkin coarse-grid operator, $A_{H}^{\\text{Gal}} = R A_h P$. The coarse grid consists of two cells: $L$ (aggregating fine cells $1$ and $3$) and $R$ (aggregating fine cells $2$ and $4$). The prolongation operator $P$ maps the coarse-flux vector $\\phi_H = [\\phi_L, \\phi_R]^{\\top}$ to the fine-flux vector $\\phi_h$ via piecewise constant injection: $\\phi_1 = \\phi_L$, $\\phi_3 = \\phi_L$, $\\phi_2 = \\phi_R$, $\\phi_4 = \\phi_R$. In matrix form:\n$$\nP = \\begin{pmatrix}\n1 & 0 \\\\\n0 & 1 \\\\\n1 & 0 \\\\\n0 & 1\n\\end{pmatrix}\n$$\nThe restriction operator $R$ is the transpose of $P$:\n$$\nR = P^{\\top} = \\begin{pmatrix}\n1 & 0 & 1 & 0 \\\\\n0 & 1 & 0 & 1\n\\end{pmatrix}\n$$\nNow we compute $A_{H}^{\\text{Gal}} = R A_h P$:\n$$\nA_h P = \\begin{pmatrix}\n2K & -K & -K & 0 \\\\\n-K & 2K & 0 & -K \\\\\n-K & 0 & 2K & -K \\\\\n0 & -K & -K & 2K\n\\end{pmatrix}\n\\begin{pmatrix}\n1 & 0 \\\\\n0 & 1 \\\\\n1 & 0 \\\\\n0 & 1\n\\end{pmatrix} = \\begin{pmatrix}\n(2K-K) & -K \\\\\n-K & (2K-K) \\\\\n(-K+2K) & -K \\\\\n-K & (-K+2K)\n\\end{pmatrix} = \\begin{pmatrix}\nK & -K \\\\\n-K & K \\\\\nK & -K \\\\\n-K & K\n\\end{pmatrix}\n$$\n$$\nA_{H}^{\\text{Gal}} = R (A_h P) = \\begin{pmatrix}\n1 & 0 & 1 & 0 \\\\\n0 & 1 & 0 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\nK & -K \\\\\n-K & K \\\\\nK & -K \\\\\n-K & K\n\\end{pmatrix} = \\begin{pmatrix}\n(K+K) & (-K-K) \\\\\n(-K-K) & (K+K)\n\\end{pmatrix} = \\begin{pmatrix}\n2K & -2K \\\\\n-2K & 2K\n\\end{pmatrix}\n$$\nThe off-diagonal entry for the Galerkin operator is $A_{H}^{\\text{Gal}}(L,R) = -2K$. Substituting the expression for $K$:\n$$A_{H}^{\\text{Gal}}(L,R) = -2 \\left( \\frac{2 D_A D_B}{D_A + D_B} \\right) = -\\frac{4 D_A D_B}{D_A + D_B}$$\n\nNext, we derive the rediscretized coarse operator, $A_{H}^{\\text{Red}}$. This involves discretizing the diffusion equation on the coarse grid itself. Each coarse cell has dimensions $h \\times 2h$. The diffusion coefficients for the coarse cells are volume averages of the constituent fine cells. Since each fine cell has area $h^2$:\n- $D_{L}^{c} = \\frac{D_A \\cdot h^2 + D_B \\cdot h^2}{h^2 + h^2} = \\frac{D_A + D_B}{2}$.\n- $D_{R}^{c} = \\frac{D_B \\cdot h^2 + D_A \\cdot h^2}{h^2 + h^2} = \\frac{D_A + D_B}{2}$.\nWe apply the same finite-volume scheme to this two-cell coarse grid. The off-diagonal entry $A_{H}^{\\text{Red}}(L,R)$ is the negative of the conductance $C_{LR}$ between coarse cells $L$ and $R$.\n$$C_{LR} = \\frac{D_{\\text{int}} \\cdot (\\text{face area})}{(\\text{cell distance})}$$\nThe interface between cells $L$ and $R$ has area (length) $2h$. The distance between the coarse cell centers is $h$. The interface diffusion coefficient $D_{\\text{int}}$ is the harmonic mean of $D_L^c$ and $D_R^c$:\n$$D_{\\text{int}} = \\frac{2 D_L^c D_R^c}{D_L^c + D_R^c} = \\frac{2 \\left(\\frac{D_A+D_B}{2}\\right) \\left(\\frac{D_A+D_B}{2}\\right)}{\\left(\\frac{D_A+D_B}{2}\\right) + \\left(\\frac{D_A+D_B}{2}\\right)} = \\frac{D_A+D_B}{2}$$\nThe coarse-grid conductance is therefore:\n$$C_{LR} = \\frac{\\left(\\frac{D_A+D_B}{2}\\right) \\cdot (2h)}{h} = D_A + D_B$$\nThe off-diagonal entry for the rediscretized operator is $A_{H}^{\\text{Red}}(L,R) = -C_{LR} = -(D_A + D_B)$.\n\nFinally, we compute the ratio $\\mathcal{R}$:\n$$\\mathcal{R} = \\frac{|A_{H}^{\\text{Red}}(L,R)|}{|A_{H}^{\\text{Gal}}(L,R)|} = \\frac{|-(D_A + D_B)|}{\\left|-\\frac{4 D_A D_B}{D_A + D_B}\\right|} = \\frac{D_A + D_B}{\\frac{4 D_A D_B}{D_A + D_B}}$$\n$$\\mathcal{R} = \\frac{(D_A + D_B)^2}{4 D_A D_B}$$\n\nBased on this derivation, we can assess which construction is superior. The Galerkin operator's off-diagonal term, $A_{H}^{\\text{Gal}}(L,R) = -2K$, represents the negative sum of all fine-scale conductances connecting the aggregates $L$ and $R$. The total conductance across the coarse interface is the sum of the conductances of the two fine-scale interfaces ($1$-$2$ and $3$-$4$) that compose it. This corresponds physically to two parallel paths for diffusion, and summing their individual conductances ($K+K=2K$) correctly yields the total conductance. Thus, the Galerkin operator accurately preserves the total fine-scale flux across the coarse-cell boundary.\nThe rediscretized operator, in contrast, first computes an arithmetic average of the diffusion coefficients within each coarse cell, $D_L^c=D_R^c=(D_A+D_B)/2$. This homogenization step smooths over the critical checkerboard heterogeneity, creating an effective medium. The subsequent discretization on this homogenized medium yields a conductance of $D_A+D_B$. This value does not correspond to the physical reality of diffusion across the alternating high and low-conductivity paths. The ratio $\\mathcal{R}$ is a measure of the discrepancy. By the inequality of arithmetic and geometric means, $(D_A+D_B)^2 \\ge 4 D_A D_B$, so $\\mathcal{R} \\ge 1$. This shows that the rediscretized coarse operator overestimates the coupling (conductance) between the coarse cells whenever $D_A \\neq D_B$. For problems with high contrast ($D_A \\gg D_B$ or $D_B \\gg D_A$), this overestimation can be severe, leading to poor convergence of the multigrid solver. The Galerkin construction, by correctly summing the physical pathways, better captures the fine-scale physics and is the preferred method for such problems.",
            "answer": "$$\\boxed{\\frac{(D_A + D_B)^2}{4 D_A D_B}}$$"
        },
        {
            "introduction": "While the coarse-grid operator handles low-frequency errors, the smoother is responsible for efficiently damping high-frequency errors. A well-designed smoother is critical for overall multigrid performance, and its properties can be precisely analyzed using Local Fourier Analysis (LFA). This analysis often reveals that special care is needed near domain boundaries where the operator stencil changes, a common feature in reactor core models. This practice guides you through using LFA to design an optimal weighted Jacobi smoother, deriving both an interior relaxation weight and a specialized weight for boundary-adjacent points to ensure uniform effectiveness across the domain .",
            "id": "4236918",
            "problem": "Consider the one-dimensional, steady, one-group neutron diffusion equation in a homogeneous slab of length $L$ with vacuum boundaries implemented at the extrapolated boundary locations so that the scalar flux satisfies $\\phi = 0$ at the first and last grid points. The governing equation is\n$$\n- \\frac{d}{dx} \\left( D \\frac{d \\phi}{dx} \\right) + \\Sigma_a \\phi = q,\n$$\nwhere $D$ is the diffusion coefficient, $\\Sigma_a$ is the macroscopic absorption cross section, and $q$ is a source term. Discretize the slab on a uniform mesh of spacing $h$ with nodal unknowns $\\{\\phi_i\\}_{i=1}^{N}$, and impose Dirichlet values $\\phi_0 = 0$ and $\\phi_{N+1} = 0$ to represent vacuum boundaries at the extrapolated boundary locations. Assume $D$ and $\\Sigma_a$ are constant.\n\nUsing a second-order centered finite-difference discretization for interior points, the resulting linear system can be written in the form $A \\phi = b$, where $A$ has the standard three-point stencil in the interior. Employ weighted Jacobi relaxation for multigrid smoothing, but allow different relaxation weights for interior points and boundary-adjacent points (those with only one unknown neighbor due to the vacuum boundary). Specifically, use an interior weight $\\omega$ for $i = 2, 3, \\dots, N-1$ and a boundary-adjacent weight $\\omega_b$ for $i = 1$ and $i = N$.\n\nStarting from the discrete equations and the definition of weighted Jacobi, perform a local Fourier analysis (LFA) of the error-propagation operator for the interior using the Fourier error mode $e_i = \\exp( \\mathrm{i} \\theta i )$. Derive the interior error-amplification factor $r_{\\mathrm{int}}(\\theta)$ and, over the high-frequency band $ \\theta \\in [\\pi/2, \\pi] $, select $\\omega$ to minimize the worst-case magnitude $\\max_{\\theta \\in [\\pi/2, \\pi]} | r_{\\mathrm{int}}(\\theta) |$ by enforcing equioscillation at the band endpoints. Then, for the boundary-adjacent point, derive the one-sided stencil error-amplification factor for the alternating mode $\\theta = \\pi$ and choose $\\omega_b$ so that the boundary-adjacent amplification magnitude matches the interior worst-case magnitude, thereby making the smoother boundary-aware.\n\nReport your final answer as the pair consisting of the boundary-adjacent weight $\\omega_b$ and the corresponding worst-case smoothing factor $\\rho^\\star$. Express both quantities as exact closed-form analytic expressions in terms of $D$, $\\Sigma_a$, and $h$. No numerical values are required.",
            "solution": "The one-dimensional steady-state neutron diffusion equation is given by:\n$$\n-D \\frac{d^2 \\phi}{dx^2} + \\Sigma_a \\phi = q\n$$\nfor constant $D$ and $\\Sigma_a$. Using a second-order centered finite-difference scheme on a uniform mesh with spacing $h$, the second derivative at an interior node $x_i$ is approximated as:\n$$\n\\frac{d^2 \\phi}{dx^2} \\bigg|_{x_i} \\approx \\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{h^2}\n$$\nSubstituting this into the diffusion equation gives the discrete equation for an interior node $i \\in \\{2, \\dots, N-1\\}$:\n$$\n-D \\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{h^2} + \\Sigma_a \\phi_i = q_i\n$$\nRearranging this equation gives the standard three-point stencil form:\n$$\n-\\frac{D}{h^2} \\phi_{i-1} + \\left(\\frac{2D}{h^2} + \\Sigma_a\\right) \\phi_i - \\frac{D}{h^2} \\phi_{i+1} = q_i\n$$\nThis corresponds to a row of the matrix $A$ in the system $A\\phi=b$. The diagonal entry for an interior row is $A_{ii} = \\frac{2D}{h^2} + \\Sigma_a$.\n\nThe weighted Jacobi iteration for updating the solution vector $\\phi$ is given by $\\phi^{(k+1)} = \\phi^{(k)} - \\omega D_A^{-1} (A\\phi^{(k)} - b)$, where $D_A$ is the diagonal of $A$. The error $e^{(k)} = \\phi - \\phi^{(k)}$ propagates according to the equation $e^{(k+1)} = (I - \\omega D_A^{-1} A) e^{(k)}$. For a single component $i$, the error update is:\n$$\ne_i^{(k+1)} = (1-\\omega) e_i^{(k)} + \\frac{\\omega}{A_{ii}} \\sum_{j \\ne i} (-A_{ij}) e_j^{(k)}\n$$\nFor an interior point $i$, this becomes:\n$$\ne_i^{(k+1)} = (1-\\omega) e_i^{(k)} + \\frac{\\omega}{\\frac{2D}{h^2} + \\Sigma_a} \\left( \\frac{D}{h^2} e_{i-1}^{(k)} + \\frac{D}{h^2} e_{i+1}^{(k)} \\right)\n$$\nTo perform Local Fourier Analysis (LFA), we examine the amplification of a single Fourier mode, $e_j^{(k)} = [r_{\\mathrm{int}}(\\theta)]^{k} \\exp(\\mathrm{i} \\theta j)$. Substituting this into the error propagation equation and dividing by $[r_{\\mathrm{int}}(\\theta)]^{k} \\exp(\\mathrm{i} \\theta i)$ yields the amplification factor $r_{\\mathrm{int}}(\\theta)$:\n$$\nr_{\\mathrm{int}}(\\theta) = 1-\\omega + \\frac{\\omega \\frac{D}{h^2}}{\\frac{2D}{h^2} + \\Sigma_a} \\left( \\exp(-\\mathrm{i} \\theta) + \\exp(\\mathrm{i} \\theta) \\right)\n$$\n$$\nr_{\\mathrm{int}}(\\theta) = 1-\\omega + \\frac{2\\omega D/h^2}{2D/h^2 + \\Sigma_a} \\cos(\\theta)\n$$\nTo simplify the expression, we define the dimensionless parameter $\\alpha = \\frac{\\Sigma_a h^2}{2D}$. This parameter represents the ratio of neutron absorption to diffusion over a mesh cell.\nThe amplification factor can be rewritten as:\n$$\nr_{\\mathrm{int}}(\\theta) = 1-\\omega + \\frac{\\omega}{1 + \\frac{\\Sigma_a h^2}{2D}} \\cos(\\theta) = 1-\\omega + \\frac{\\omega}{1+\\alpha} \\cos(\\theta) = 1 - \\omega \\left(1 - \\frac{\\cos(\\theta)}{1+\\alpha}\\right)\n$$\nThe problem requires optimizing the interior weight $\\omega$ to minimize the smoothing factor, defined as $\\rho = \\max_{\\theta \\in [\\pi/2, \\pi]} |r_{\\mathrm{int}}(\\theta)|$. The optimal value is found by enforcing the equioscillation condition $|r_{\\mathrm{int}}(\\pi/2)| = |r_{\\mathrm{int}}(\\pi)|$.\nWe evaluate $r_{\\mathrm{int}}(\\theta)$ at the endpoints of the high-frequency band:\nAt $\\theta = \\pi/2$, $\\cos(\\pi/2) = 0$, so $r_{\\mathrm{int}}(\\pi/2) = 1-\\omega$.\nAt $\\theta = \\pi$, $\\cos(\\pi) = -1$, so $r_{\\mathrm{int}}(\\pi) = 1 - \\omega\\left(1 - \\frac{-1}{1+\\alpha}\\right) = 1 - \\omega\\left(\\frac{2+\\alpha}{1+\\alpha}\\right)$.\nOptimal smoothers typically have amplification factors that oscillate around $0$. We thus set $r_{\\mathrm{int}}(\\pi/2) = -r_{\\mathrm{int}}(\\pi)$:\n$$\n1-\\omega = - \\left[ 1 - \\omega\\left(\\frac{2+\\alpha}{1+\\alpha}\\right) \\right]\n$$\n$$\n1-\\omega = -1 + \\omega\\left(\\frac{2+\\alpha}{1+\\alpha}\\right)\n$$\n$$\n2 = \\omega \\left( 1 + \\frac{2+\\alpha}{1+\\alpha} \\right) = \\omega \\left( \\frac{1+\\alpha+2+\\alpha}{1+\\alpha} \\right) = \\omega \\left( \\frac{3+2\\alpha}{1+\\alpha} \\right)\n$$\nSolving for the optimal interior weight $\\omega$:\n$$\n\\omega = \\frac{2(1+\\alpha)}{3+2\\alpha}\n$$\nThe corresponding worst-case smoothing factor, $\\rho^\\star$, is the magnitude of the amplification at the band ends:\n$$\n\\rho^\\star = |r_{\\mathrm{int}}(\\pi/2)| = |1-\\omega| = \\left| 1 - \\frac{2(1+\\alpha)}{3+2\\alpha} \\right| = \\left| \\frac{3+2\\alpha - 2-2\\alpha}{3+2\\alpha} \\right| = \\left| \\frac{1}{3+2\\alpha} \\right|\n$$\nSince $\\Sigma_a, D, h^2$ are non-negative, $\\alpha \\ge 0$, and thus $3+2\\alpha > 0$.\n$$\n\\rho^\\star = \\frac{1}{3+2\\alpha}\n$$\nSubstituting $\\alpha = \\frac{\\Sigma_a h^2}{2D}$ gives the first required quantity:\n$$\n\\rho^\\star = \\frac{1}{3 + 2\\left(\\frac{\\Sigma_a h^2}{2D}\\right)} = \\frac{1}{3 + \\frac{\\Sigma_a h^2}{D}} = \\frac{D}{3D + \\Sigma_a h^2}\n$$\nNext, we analyze the boundary-adjacent points, e.g., $i=1$. The discrete equation is derived using the boundary condition $\\phi_0 = 0$:\n$$\n-D \\frac{0 - 2\\phi_1 + \\phi_2}{h^2} + \\Sigma_a \\phi_1 = q_1 \\implies \\left(\\frac{2D}{h^2} + \\Sigma_a\\right)\\phi_1 - \\frac{D}{h^2}\\phi_2 = q_1\n$$\nThe diagonal element $A_{11}$ is the same as for the interior points. The weighted Jacobi error update for $i=1$ uses the boundary-adjacent weight $\\omega_b$:\n$$\ne_1^{(k+1)} = (1-\\omega_b) e_1^{(k)} + \\frac{\\omega_b}{\\frac{2D}{h^2} + \\Sigma_a} \\left( \\frac{D}{h^2} e_2^{(k)} \\right)\n$$\nWe analyze this for the highest frequency mode $\\theta = \\pi$, for which $e_j = C(-1)^j$. Let the amplification factor be $r_b(\\pi)$. Substituting $e_j^{(k)} = [r_b(\\pi)]^k C(-1)^j$ gives:\n$$\n[r_b(\\pi)]^{k+1} C(-1)^1 = (1-\\omega_b)[r_b(\\pi)]^k C(-1)^1 + \\frac{\\omega_b \\frac{D}{h^2}}{\\frac{2D}{h^2} + \\Sigma_a} [r_b(\\pi)]^k C(-1)^2\n$$\nDividing by $[r_b(\\pi)]^k C$:\n$$\n-r_b(\\pi) = -(1-\\omega_b) + \\frac{\\omega_b \\frac{D}{h^2}}{\\frac{2D}{h^2} + \\Sigma_a}\n$$\n$$\nr_b(\\pi) = 1-\\omega_b - \\frac{\\omega_b}{2(1+\\alpha)} = 1 - \\omega_b\\left(1+\\frac{1}{2(1+\\alpha)}\\right) = 1 - \\omega_b\\left(\\frac{3+2\\alpha}{2(1+\\alpha)}\\right)\n$$\nThe problem requires choosing $\\omega_b$ such that $|r_b(\\pi)| = \\rho^\\star$. For consistency, we enforce that the highest frequency mode behaves similarly at the boundary and in the interior. The interior analysis yielded $r_{\\mathrm{int}}(\\pi) = -\\rho^\\star$. We therefore set $r_b(\\pi) = -\\rho^\\star$:\n$$\n1 - \\omega_b\\left(\\frac{3+2\\alpha}{2(1+\\alpha)}\\right) = -\\rho^\\star = -\\frac{1}{3+2\\alpha}\n$$\nSolving for $\\omega_b$:\n$$\n1 + \\frac{1}{3+2\\alpha} = \\omega_b\\left(\\frac{3+2\\alpha}{2(1+\\alpha)}\\right)\n$$\n$$\n\\frac{3+2\\alpha+1}{3+2\\alpha} = \\frac{4+2\\alpha}{3+2\\alpha} = \\omega_b\\left(\\frac{3+2\\alpha}{2(1+\\alpha)}\\right)\n$$\n$$\n\\omega_b = \\frac{2(2+\\alpha)}{3+2\\alpha} \\cdot \\frac{2(1+\\alpha)}{3+2\\alpha} = \\frac{4(1+\\alpha)(2+\\alpha)}{(3+2\\alpha)^2}\n$$\nFinally, we substitute $\\alpha = \\frac{\\Sigma_a h^2}{2D}$ to express $\\omega_b$ in terms of the original parameters:\n$$\n\\omega_b = \\frac{4\\left(1+\\frac{\\Sigma_a h^2}{2D}\\right)\\left(2+\\frac{\\Sigma_a h^2}{2D}\\right)}{\\left(3+2\\frac{\\Sigma_a h^2}{2D}\\right)^2} = \\frac{4\\left(\\frac{2D+\\Sigma_a h^2}{2D}\\right)\\left(\\frac{4D+\\Sigma_a h^2}{2D}\\right)}{\\left(\\frac{3D+\\Sigma_a h^2}{D}\\right)^2}\n$$\n$$\n\\omega_b = \\frac{\\frac{(2D+\\Sigma_a h^2)(4D+\\Sigma_a h^2)}{D^2}}{\\frac{(3D+\\Sigma_a h^2)^2}{D^2}} = \\frac{(2D + \\Sigma_a h^2)(4D + \\Sigma_a h^2)}{(3D + \\Sigma_a h^2)^2}\n$$\nThe final answer is the pair $(\\omega_b, \\rho^\\star)$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{(2D + \\Sigma_a h^2)(4D + \\Sigma_a h^2)}{(3D + \\Sigma_a h^2)^2} & \\frac{D}{3D + \\Sigma_a h^2} \\end{pmatrix} } $$"
        },
        {
            "introduction": "An effective multigrid solver is not just about having good components; it is about balancing the computational work between them to achieve the fastest time-to-solution. A V-cycle involves a trade-off: more smoothing sweeps improve the damping of high-frequency error but increase the cost per cycle, while a more accurate coarse-grid solve improves low-frequency error reduction but also adds to the cost. This problem introduces a practical performance model to explore this crucial trade-off, allowing you to perform a discrete optimization to find the ideal number of smoothing and coarse-solve iterations for a given problem .",
            "id": "4236968",
            "problem": "Consider the steady-state multigroup neutron diffusion equation discretized on a three-dimensional reactor core mesh. To accelerate a stationary source iteration, a two-grid Multigrid (MG) cycle is used, consisting of fine-grid smoothing, restriction to a coarse grid, an inexact coarse-grid solve, and prolongation back to the fine grid, followed by fine-grid post-smoothing. The goal is to choose the cycle parameters to minimize total time-to-solution for a prescribed residual reduction.\n\nAdopt the following work unit model for the two-grid MG cycle. Each fine-grid smoothing sweep (Jacobi-like) costs $c_s$ work units, a single fine-to-coarse transfer (restriction) costs $c_r$ work units, a single coarse-to-fine transfer (prolongation) costs $c_p$ work units, and each coarse-grid inner iteration costs $c_c$ work units. Let the number of pre-smoothing sweeps be $m$ and the number of post-smoothing sweeps be $m$ (i.e., $2m$ total fine-grid smooths), and let the number of coarse-grid inner iterations be $\\gamma$. The per-cycle cost is modeled as\n$$\nW(m,\\gamma) \\;=\\; 2 m\\, c_s \\;+\\; c_r \\;+\\; c_p \\;+\\; \\gamma \\, c_c.\n$$\n\nAssume the error after one cycle is decomposable into a high-frequency component damped primarily by smoothing and a low-frequency component damped primarily by the coarse-grid correction. If the initial error energy splits as a fraction $\\alpha$ in high-frequency modes and $1-\\alpha$ in low-frequency modes, and if a single fine-grid smoothing sweep reduces high-frequency modes by a factor $\\sigma$ while a single coarse-grid inner iteration reduces low-frequency modes by a factor $\\tau$, then the per-cycle error contraction factor is modeled by\n$$\nq(m,\\gamma) \\;=\\; \\sqrt{ \\alpha \\, \\sigma^{2m} \\;+\\; (1-\\alpha) \\, \\tau^{2\\gamma} }.\n$$\n\nThe number of cycles required to achieve a residual reduction factor $r_{\\mathrm{target}}$ is the smallest integer\n$$\nk(m,\\gamma) \\;=\\; \\left\\lceil \\frac{\\ln\\!\\big(r_{\\mathrm{target}}\\big)}{\\ln\\!\\big(q(m,\\gamma)\\big)} \\right\\rceil,\n$$\nand the total time-to-solution is then\n$$\nT(m,\\gamma) \\;=\\; W(m,\\gamma)\\, k(m,\\gamma).\n$$\n\nFor a representative pressurized water reactor (PWR) core problem, measured constants are: $c_s = 4.0$ ms, $c_r = 1.2$ ms, $c_p = 1.5$ ms, $c_c = 7.0$ ms, $\\alpha = 0.6$, $\\sigma = 0.5$, $\\tau = 0.3$, and $r_{\\mathrm{target}} = 10^{-8}$. Restrict attention to $m \\in \\{\\,1,\\,2,\\,3\\,\\}$ and $\\gamma \\in \\{\\,1,\\,2,\\,3\\,\\}$.\n\nUsing the work unit model and contraction model above, determine the minimal possible total time-to-solution $T_{\\min}$ over the specified discrete choices of $m$ and $\\gamma$. Express your final answer in seconds and round your answer to four significant figures.",
            "solution": "The objective is to find the minimal possible total time-to-solution, $T_{\\min}$, by evaluating the function $T(m,\\gamma)$ for all pairs $(m, \\gamma)$ in the discrete domain $m \\in \\{1, 2, 3\\}$ and $\\gamma \\in \\{1, 2, 3\\}$.\n\nThe given parameters are:\n$c_s = 4.0$, $c_r = 1.2$, $c_p = 1.5$, $c_c = 7.0$ (all in ms).\n$\\alpha = 0.6$, $\\sigma = 0.5$, $\\tau = 0.3$, and $r_{\\mathrm{target}} = 10^{-8}$.\n\nFirst, we compute the constant terms. The combined cost of restriction and prolongation per cycle is $c_r + c_p = 1.2 + 1.5 = 2.7$ ms. The numerator in the expression for $k(m,\\gamma)$ is $\\ln(r_{\\mathrm{target}}) = \\ln(10^{-8}) = -8 \\ln(10) \\approx -18.42068$.\n\nWe now systematically evaluate $T(m,\\gamma)$ for each of the $3 \\times 3 = 9$ pairs of $(m, \\gamma)$. All time calculations are initially in milliseconds (ms).\n\n**Case 1: $m=1$**\n-   For $(m, \\gamma) = (1, 1)$:\n    $W(1,1) = 2(1)(4.0) + 2.7 + 1(7.0) = 8.0 + 2.7 + 7.0 = 17.7$ ms.\n    $q(1,1) = \\sqrt{0.6(0.5)^{2(1)} + (1-0.6)(0.3)^{2(1)}} = \\sqrt{0.6(0.25) + 0.4(0.09)} = \\sqrt{0.186} \\approx 0.43128$.\n    $k(1,1) = \\left\\lceil \\frac{-18.42068}{\\ln(0.43128)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-0.84095} \\right\\rceil = \\lceil 21.905 \\rceil = 22$.\n    $T(1,1) = 17.7 \\times 22 = 389.4$ ms.\n\n-   For $(m, \\gamma) = (1, 2)$:\n    $W(1,2) = 2(1)(4.0) + 2.7 + 2(7.0) = 8.0 + 2.7 + 14.0 = 24.7$ ms.\n    $q(1,2) = \\sqrt{0.6(0.5)^2 + 0.4(0.3)^4} = \\sqrt{0.15 + 0.4(0.0081)} = \\sqrt{0.15324} \\approx 0.39146$.\n    $k(1,2) = \\left\\lceil \\frac{-18.42068}{\\ln(0.39146)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-0.93796} \\right\\rceil = \\lceil 19.639 \\rceil = 20$.\n    $T(1,2) = 24.7 \\times 20 = 494.0$ ms.\n\n-   For $(m, \\gamma) = (1, 3)$:\n    $W(1,3) = 2(1)(4.0) + 2.7 + 3(7.0) = 8.0 + 2.7 + 21.0 = 31.7$ ms.\n    $q(1,3) = \\sqrt{0.6(0.5)^2 + 0.4(0.3)^6} = \\sqrt{0.15 + 0.4(0.000729)} = \\sqrt{0.1502916} \\approx 0.38767$.\n    $k(1,3) = \\left\\lceil \\frac{-18.42068}{\\ln(0.38767)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-0.94759} \\right\\rceil = \\lceil 19.439 \\rceil = 20$.\n    $T(1,3) = 31.7 \\times 20 = 634.0$ ms.\n\n**Case 2: $m=2$**\n-   For $(m, \\gamma) = (2, 1)$:\n    $W(2,1) = 2(2)(4.0) + 2.7 + 1(7.0) = 16.0 + 2.7 + 7.0 = 25.7$ ms.\n    $q(2,1) = \\sqrt{0.6(0.5)^{2(2)} + 0.4(0.3)^{2(1)}} = \\sqrt{0.6(0.0625) + 0.4(0.09)} = \\sqrt{0.0735} \\approx 0.27111$.\n    $k(2,1) = \\left\\lceil \\frac{-18.42068}{\\ln(0.27111)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-1.30521} \\right\\rceil = \\lceil 14.113 \\rceil = 15$.\n    $T(2,1) = 25.7 \\times 15 = 385.5$ ms.\n\n-   For $(m, \\gamma) = (2, 2)$:\n    $W(2,2) = 2(2)(4.0) + 2.7 + 2(7.0) = 16.0 + 2.7 + 14.0 = 32.7$ ms.\n    $q(2,2) = \\sqrt{0.6(0.5)^4 + 0.4(0.3)^4} = \\sqrt{0.0375 + 0.00324} = \\sqrt{0.04074} \\approx 0.20184$.\n    $k(2,2) = \\left\\lceil \\frac{-18.42068}{\\ln(0.20184)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-1.60023} \\right\\rceil = \\lceil 11.511 \\rceil = 12$.\n    $T(2,2) = 32.7 \\times 12 = 392.4$ ms.\n\n-   For $(m, \\gamma) = (2, 3)$:\n    $W(2,3) = 2(2)(4.0) + 2.7 + 3(7.0) = 16.0 + 2.7 + 21.0 = 39.7$ ms.\n    $q(2,3) = \\sqrt{0.6(0.5)^4 + 0.4(0.3)^6} = \\sqrt{0.0375 + 0.0002916} = \\sqrt{0.0377916} \\approx 0.19440$.\n    $k(2,3) = \\left\\lceil \\frac{-18.42068}{\\ln(0.19440)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-1.63783} \\right\\rceil = \\lceil 11.247 \\rceil = 12$.\n    $T(2,3) = 39.7 \\times 12 = 476.4$ ms.\n\n**Case 3: $m=3$**\n-   For $(m, \\gamma) = (3, 1)$:\n    $W(3,1) = 2(3)(4.0) + 2.7 + 1(7.0) = 24.0 + 2.7 + 7.0 = 33.7$ ms.\n    $q(3,1) = \\sqrt{0.6(0.5)^{2(3)} + 0.4(0.3)^{2(1)}} = \\sqrt{0.6(0.015625) + 0.4(0.09)} = \\sqrt{0.045375} \\approx 0.21299$.\n    $k(3,1) = \\left\\lceil \\frac{-18.42068}{\\ln(0.21299)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-1.54649} \\right\\rceil = \\lceil 11.911 \\rceil = 12$.\n    $T(3,1) = 33.7 \\times 12 = 404.4$ ms.\n\n-   For $(m, \\gamma) = (3, 2)$:\n    $W(3,2) = 2(3)(4.0) + 2.7 + 2(7.0) = 24.0 + 2.7 + 14.0 = 40.7$ ms.\n    $q(3,2) = \\sqrt{0.6(0.5)^6 + 0.4(0.3)^4} = \\sqrt{0.009375 + 0.00324} = \\sqrt{0.012615} \\approx 0.11232$.\n    $k(3,2) = \\left\\lceil \\frac{-18.42068}{\\ln(0.11232)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-2.18651} \\right\\rceil = \\lceil 8.425 \\rceil = 9$.\n    $T(3,2) = 40.7 \\times 9 = 366.3$ ms.\n\n-   For $(m, \\gamma) = (3, 3)$:\n    $W(3,3) = 2(3)(4.0) + 2.7 + 3(7.0) = 24.0 + 2.7 + 21.0 = 47.7$ ms.\n    $q(3,3) = \\sqrt{0.6(0.5)^6 + 0.4(0.3)^6} = \\sqrt{0.009375 + 0.0002916} = \\sqrt{0.0096666} \\approx 0.09832$.\n    $k(3,3) = \\left\\lceil \\frac{-18.42068}{\\ln(0.09832)} \\right\\rceil = \\left\\lceil \\frac{-18.42068}{-2.32000} \\right\\rceil = \\lceil 7.940 \\rceil = 8$.\n    $T(3,3) = 47.7 \\times 8 = 381.6$ ms.\n\n**Conclusion**\nBy comparing all nine computed values of $T(m,\\gamma)$:\n$T(1,1)=389.4$ ms, $T(1,2)=494.0$ ms, $T(1,3)=634.0$ ms\n$T(2,1)=385.5$ ms, $T(2,2)=392.4$ ms, $T(2,3)=476.4$ ms\n$T(3,1)=404.4$ ms, $T(3,2)=366.3$ ms, $T(3,3)=381.6$ ms\n\nThe minimum value is $T_{\\min} = 366.3$ ms, corresponding to the parameters $(m, \\gamma) = (3, 2)$. The problem asks for this result in seconds, rounded to four significant figures.\n$$\nT_{\\min} = 366.3 \\text{ ms} = 0.3663 \\text{ s}\n$$\nThis value is already expressed to four significant figures.",
            "answer": "$$\n\\boxed{0.3663}\n$$"
        }
    ]
}