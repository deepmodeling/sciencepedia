{
    "hands_on_practices": [
        {
            "introduction": "该练习聚焦于任何表面穿越估计器核心中的基本计算。通过处理一个具体的中子穿越事件，您将应用矢量微积分来寻找表面法向，并计算蒙特卡罗计数贡献，即粒子权重乘以穿越角的余弦值。这有助于巩固估计器的基本力学原理。",
            "id": "4253958",
            "problem": "在中子输运蒙特卡罗模拟中，穿过光滑表面的净向外粒子流定义为角通量乘以粒子运动方向在表面法线上的投影，然后在表面与角度上进行积分。相应的穿面估计子为每个粒子穿面事件赋予一个贡献值，该值等于粒子统计权重乘以粒子方向与表面局部向外单位法向量的点积。\n\n考虑一个在三维欧几里得空间中以原点为中心、半径为 $R$ 的球面，它由水平集 $f(\\mathbf{r}) = x^{2} + y^{2} + z^{2} - R^{2} = 0$ 隐式定义。一个统计权重为 $w$ 的中子在点 $\\mathbf{r}_{c} = (0,\\,5,\\,12)$ 处穿过该球面，其飞行方向为 $\\mathbf{\\Omega} = \\left(-\\frac{3}{5},\\,-\\frac{4}{5},\\,0\\right)$。球面半径为 $R = 13$。方向 $\\mathbf{\\Omega}$ 的长度为单位长度，并且相对于向外法线而言，这是一次入射穿越。\n\n从隐式曲面表示和法向量的第一性原理出发，推导在穿越点 $\\mathbf{r}_{c}$ 处的向外单位法向量 $\\mathbf{n}$，然后计算此次单次穿越对净向外流计数的贡献 $w\\,(\\mathbf{\\Omega}\\cdot\\mathbf{n})$。使用 $w = \\frac{41}{50}$。将最终答案表示为一个精确的有理数。由于贡献值是无量纲的，因此不需要单位。",
            "solution": "首先验证问题，以确保其在科学上是合理的、自洽的并且是适定的。\n\n**步骤1：提取已知条件**\n-   球面的隐式曲面表示：$f(\\mathbf{r}) = x^{2} + y^{2} + z^{2} - R^{2} = 0$。\n-   球面半径：$R = 13$。\n-   表面上的穿越点：$\\mathbf{r}_{c} = (0,\\,5,\\,12)$。\n-   中子统计权重：$w = \\frac{41}{50}$。\n-   中子飞行方向（单位矢量）：$\\mathbf{\\Omega} = \\left(-\\frac{3}{5},\\,-\\frac{4}{5},\\,0\\right)$。\n-   任务：从隐式曲面表示推导在 $\\mathbf{r}_{c}$ 处的向外单位法向量 $\\mathbf{n}$，并计算对净向外流计数的贡献 $w\\,(\\mathbf{\\Omega}\\cdot\\mathbf{n})$。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题描述了蒙特卡罗粒子输运中的标准穿面估计子，这是核反应堆物理学中一个成熟的方法。其数学公式基于矢量微积分的基本原理。\n\n首先，我们验证给定数据的一致性。穿越点 $\\mathbf{r}_{c}$ 必须位于指定的表面上。我们计算位置矢量 $\\mathbf{r}_{c}$ 的模：\n$$|\\mathbf{r}_{c}| = \\sqrt{0^{2} + 5^{2} + 12^{2}} = \\sqrt{0 + 25 + 144} = \\sqrt{169} = 13$$\n穿越点的位置矢量的模等于给定的半径 $R = 13$。因此，点 $\\mathbf{r}_{c}$ 确实在球面上。\n\n接下来，我们验证方向矢量 $\\mathbf{\\Omega}$ 是一个单位矢量：\n$$|\\mathbf{\\Omega}| = \\sqrt{\\left(-\\frac{3}{5}\\right)^{2} + \\left(-\\frac{4}{5}\\right)^{2} + 0^{2}} = \\sqrt{\\frac{9}{25} + \\frac{16}{25}} = \\sqrt{\\frac{25}{25}} = 1$$\n方向矢量被正确地指定为单位矢量。问题陈述这是一次入射穿越，这意味着点积 $\\mathbf{\\Omega}\\cdot\\mathbf{n}$ 应该为负。这一点将通过计算得到验证。所有数据都是一致的，并且足以得到唯一解。\n\n**步骤3：结论与行动**\n该问题是有效的。它在科学上是合理的、适定的且内部一致的。我们继续进行求解。\n\n问题的核心是计算对净向外流计数的贡献 $C$，定义为：\n$$C = w\\,(\\mathbf{\\Omega}\\cdot\\mathbf{n})$$\n这需要确定在穿越点 $\\mathbf{r}_{c}$ 处球面上的向外单位法向量 $\\mathbf{n}$。\n\n对于由水平集方程 $f(\\mathbf{r}) = k$（其中 $k$ 是常数）隐式定义的曲面，梯度矢量 $\\nabla f(\\mathbf{r})$ 在各处都与曲面垂直。在我们的例子中，曲面由 $f(x, y, z) = x^{2} + y^{2} + z^{2} - R^{2} = 0$ 给出。\n\n$f$ 的梯度计算如下：\n$$\\nabla f(x, y, z) = \\left(\\frac{\\partial f}{\\partial x}, \\frac{\\partial f}{\\partial y}, \\frac{\\partial f}{\\partial z}\\right)$$\n偏导数是：\n$$\\frac{\\partial f}{\\partial x} = 2x$$\n$$\\frac{\\partial f}{\\partial y} = 2y$$\n$$\\frac{\\partial f}{\\partial z} = 2z$$\n因此，梯度矢量为：\n$$\\nabla f(x, y, z) = (2x, 2y, 2z) = 2\\mathbf{r}$$\n其中 $\\mathbf{r} = (x, y, z)$ 是位置矢量。\n\n我们在穿越点 $\\mathbf{r}_{c} = (0,\\,5,\\,12)$ 处计算该梯度：\n$$\\nabla f(\\mathbf{r}_{c}) = 2(0, 5, 12) = (0, 10, 24)$$\n该矢量在 $\\mathbf{r}_{c}$ 处与曲面垂直。为了确定它指向外还是指向内，我们观察到函数 $f(\\mathbf{r}) = |\\mathbf{r}|^{2} - R^{2}$ 随着距原点距离 $|\\mathbf{r}|$ 的增加而增加。梯度矢量指向 $f$ 最陡峭的上升方向，这对应于从球面径向向外移动。因此，$\\nabla f(\\mathbf{r}_{c})$ 是一个指向外的法向量。\n\n为了获得向外单位法向量 $\\mathbf{n}$，我们将 $\\nabla f(\\mathbf{r}_{c})$ 除以其模来进行归一化：\n$$\\mathbf{n} = \\frac{\\nabla f(\\mathbf{r}_{c})}{|\\nabla f(\\mathbf{r}_{c})|}$$\n模为：\n$$|\\nabla f(\\mathbf{r}_{c})| = |(0, 10, 24)| = \\sqrt{0^{2} + 10^{2} + 24^{2}} = \\sqrt{100 + 576} = \\sqrt{676} = 26$$\n所以，在 $\\mathbf{r}_{c}$ 处的向外单位法向量是：\n$$\\mathbf{n} = \\frac{1}{26}(0, 10, 24) = \\left(0, \\frac{10}{26}, \\frac{24}{26}\\right) = \\left(0, \\frac{5}{13}, \\frac{12}{13}\\right)$$\n\n现在，我们计算粒子方向 $\\mathbf{\\Omega}$ 和向外法线 $\\mathbf{n}$ 的点积。这一项 $\\mathbf{\\Omega}\\cdot\\mathbf{n}$ 是两个矢量之间夹角的余弦，代表粒子方向在法线上的投影。\n$$\\mathbf{\\Omega}\\cdot\\mathbf{n} = \\left(-\\frac{3}{5}, -\\frac{4}{5}, 0\\right) \\cdot \\left(0, \\frac{5}{13}, \\frac{12}{13}\\right)$$\n$$\\mathbf{\\Omega}\\cdot\\mathbf{n} = \\left(-\\frac{3}{5}\\right)(0) + \\left(-\\frac{4}{5}\\right)\\left(\\frac{5}{13}\\right) + (0)\\left(\\frac{12}{13}\\right)$$\n$$\\mathbf{\\Omega}\\cdot\\mathbf{n} = 0 - \\frac{4 \\cdot 5}{5 \\cdot 13} + 0 = -\\frac{4}{13}$$\n负值结果证实了问题中关于穿越是“入射”的（即与向外法线方向相反）陈述。\n\n最后，我们将此点积乘以粒子的统计权重 $w = \\frac{41}{50}$ 来计算贡献 $C$：\n$$C = w\\,(\\mathbf{\\Omega}\\cdot\\mathbf{n}) = \\left(\\frac{41}{50}\\right) \\left(-\\frac{4}{13}\\right)$$\n$$C = -\\frac{41 \\cdot 4}{50 \\cdot 13} = -\\frac{164}{650}$$\n我们通过将分子和分母除以它们的最大公约数 $2$ 来简化这个分数：\n$$C = -\\frac{164 \\div 2}{650 \\div 2} = -\\frac{82}{325}$$\n这就是单次穿越事件对净向外流计数的贡献，表示为一个精确的有理数。",
            "answer": "$$\\boxed{-\\frac{82}{325}}$$"
        },
        {
            "introduction": "虽然蒙特卡罗方法追踪单个粒子，但我们寻求估计的物理量通常是由角通量积分定义的宏观流。本练习通过要求您从给定的各向异性角通量分布中解析计算部分流和净流，从而在微观和宏观视角之间架起一座桥梁。此练习阐明了粒子方向的连续分布如何贡献于跨越表面的总流量。",
            "id": "4254023",
            "problem": "考虑一个单能、稳态的中子场，其几何形状为平板，在位置$x=0$处有一个平面边界，向外单位法向量$\\hat{n}$指向$+x$方向。假设具有方位角对称性，因此角通量仅取决于极角余弦 $\\mu = \\Omega \\cdot \\hat{n} \\in [-1,1]$，其中 $\\Omega$ 是单位方向向量。边界处的角通量是各向异性的，其形式为\n$$\n\\psi(0,\\mu) = \\psi_{0}\\left(1 + a\\,P_{1}(\\mu)\\right),\n$$\n其中 $P_{1}(\\mu)$ 是一阶勒让德多项式，$P_{1}(\\mu) = \\mu$，而 $\\psi_{0}$ 是一个恒定振幅。设振幅和各向异性参数分别为 $\\,\\psi_{0} = 1.0\\,\\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}\\cdot\\text{sr}^{-1}\\,$ 和 $\\,a = 0.6\\,$，这满足对所有 $\\mu \\in [-1,1]$ 的非负性条件 $\\psi(0,\\mu) \\ge 0$。\n\n从中子流穿过一个表面的动力学理论定义（即单位面积上的粒子穿越率）出发，并使用上面给出的角通量，确定出射分流 $J^{+}$、入射分流 $J^{-}$（定义为 $\\mu0$ 时的正值）以及穿过边界的净流 $J_{\\text{net}}$。以中子数/平方厘米·秒为单位表示最终的流。将您的答案四舍五入到四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是具有科学依据、提法恰当、客观且自洽的。给定的角通量形式 $\\psi(0,\\mu)$ 是 $\\mu$ 的一个线性函数。对于 $\\mu \\in [-1,1]$ 的非负性条件 $\\psi(0,\\mu) \\ge 0$，由所提供的常数 $\\psi_0 = 1.0$ 和 $a = 0.6$ 满足，因为该函数在区间上的最小值出现在 $\\mu = -1$ 处，得到 $\\psi(0,-1) = \\psi_0(1-a) = 1.0(1-0.6) = 0.4$，这是非负的。所有条件都是内部一致的，并符合中子输运理论的原理。因此，我们可以继续进行求解。\n\n穿过一个具有向外单位法向量 $\\hat{n}$ 的表面的中子流密度，或称净流，定义为角通量 $\\psi(\\vec{r}, \\Omega)$ 乘以粒子方向向量 $\\Omega$ 在法线上的投影 $\\Omega \\cdot \\hat{n}$ 后，对所有立体角 $4\\pi$ 进行积分。在这个平板几何问题中，表面位于 $x=0$ 处，法向量为 $\\hat{n} = \\hat{x}$，因此投影为 $\\mu = \\Omega \\cdot \\hat{x}$。鉴于方位角对称性，立体角微元为 $d\\Omega = d\\phi \\, d\\mu$，对从 $0$ 到 $2\\pi$ 的方位角 $\\phi$ 进行积分会得到一个因子 $2\\pi$。\n\n边界 $x=0$ 处的净流 $J_{\\text{net}}$ 由下式给出：\n$$ J_{\\text{net}} = \\int_{4\\pi} (\\Omega \\cdot \\hat{n}) \\psi(0, \\Omega) d\\Omega = \\int_0^{2\\pi} d\\phi \\int_{-1}^{1} \\mu \\, \\psi(0, \\mu) \\, d\\mu = 2\\pi \\int_{-1}^{1} \\mu \\, \\psi(0, \\mu) \\, d\\mu $$\n分流是通过对出射和入射半球进行积分来定义的。\n\n出射分流 $J^{+}$ 表示中子沿法线方向（$\\mu > 0$）穿过表面的速率：\n$$ J^{+} = \\int_0^{2\\pi} d\\phi \\int_{0}^{1} \\mu \\, \\psi(0, \\mu) \\, d\\mu = 2\\pi \\int_{0}^{1} \\mu \\, \\psi(0, \\mu) \\, d\\mu $$\n入射分流 $J^{-}$ 定义为中子沿与法线相反方向（$\\mu  0$）穿过表面的速率的正值：\n$$ J^{-} = - \\int_0^{2\\pi} d\\phi \\int_{-1}^{0} \\mu \\, \\psi(0, \\mu) \\, d\\mu = -2\\pi \\int_{-1}^{0} \\mu \\, \\psi(0, \\mu) \\, d\\mu $$\n净流是出射分流和入射分流之间的差值：$J_{\\text{net}} = J^{+} - J^{-}$。\n\n我们已知边界 $x=0$ 处的角通量为 $\\psi(0,\\mu) = \\psi_{0}(1 + a P_{1}(\\mu))$，其中 $P_{1}(\\mu) = \\mu$。因此，$\\psi(0,\\mu) = \\psi_{0}(1 + a\\mu)$。现在我们可以计算分流。\n\n首先，我们计算出射分流 $J^{+}$：\n$$ J^{+} = 2\\pi \\int_{0}^{1} \\mu \\, \\psi_{0}(1 + a\\mu) \\, d\\mu = 2\\pi \\psi_{0} \\int_{0}^{1} (\\mu + a\\mu^2) \\, d\\mu $$\n$$ J^{+} = 2\\pi \\psi_{0} \\left[ \\frac{\\mu^2}{2} + \\frac{a\\mu^3}{3} \\right]_{0}^{1} = 2\\pi \\psi_{0} \\left( \\left(\\frac{1^2}{2} + \\frac{a(1)^3}{3}\\right) - 0 \\right) $$\n$$ J^{+} = 2\\pi \\psi_{0} \\left(\\frac{1}{2} + \\frac{a}{3}\\right) $$\n代入给定值 $\\psi_0 = 1.0\\,\\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}\\cdot\\text{sr}^{-1}$ 和 $a=0.6$：\n$$ J^{+} = 2\\pi (1.0) \\left(\\frac{1}{2} + \\frac{0.6}{3}\\right) = 2\\pi (0.5 + 0.2) = 2\\pi(0.7) = 1.4\\pi $$\n数值上，$J^{+} \\approx 4.398229... \\, \\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}$。\n\n接下来，我们计算入射分流 $J^{-}$：\n$$ J^{-} = -2\\pi \\int_{-1}^{0} \\mu \\, \\psi_{0}(1 + a\\mu) \\, d\\mu = -2\\pi \\psi_{0} \\int_{-1}^{0} (\\mu + a\\mu^2) \\, d\\mu $$\n$$ J^{-} = -2\\pi \\psi_{0} \\left[ \\frac{\\mu^2}{2} + \\frac{a\\mu^3}{3} \\right]_{-1}^{0} = -2\\pi \\psi_{0} \\left( 0 - \\left(\\frac{(-1)^2}{2} + \\frac{a(-1)^3}{3}\\right) \\right) $$\n$$ J^{-} = -2\\pi \\psi_{0} \\left( - \\left(\\frac{1}{2} - \\frac{a}{3}\\right) \\right) = 2\\pi \\psi_{0} \\left(\\frac{1}{2} - \\frac{a}{3}\\right) $$\n代入给定值：\n$$ J^{-} = 2\\pi (1.0) \\left(\\frac{1}{2} - \\frac{0.6}{3}\\right) = 2\\pi (0.5 - 0.2) = 2\\pi(0.3) = 0.6\\pi $$\n数值上，$J^{-} \\approx 1.884955... \\, \\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}$。\n\n最后，我们计算净流 $J_{\\text{net}}$，即分流之差：\n$$ J_{\\text{net}} = J^{+} - J^{-} = 2\\pi \\psi_{0} \\left(\\frac{1}{2} + \\frac{a}{3}\\right) - 2\\pi \\psi_{0} \\left(\\frac{1}{2} - \\frac{a}{3}\\right) $$\n$$ J_{\\text{net}} = 2\\pi \\psi_{0} \\left[ \\left(\\frac{1}{2} + \\frac{a}{3}\\right) - \\left(\\frac{1}{2} - \\frac{a}{3}\\right) \\right] = 2\\pi \\psi_{0} \\left( \\frac{2a}{3} \\right) = \\frac{4\\pi a \\psi_{0}}{3} $$\n代入给定值：\n$$ J_{\\text{net}} = \\frac{4\\pi (0.6) (1.0)}{3} = \\frac{2.4\\pi}{3} = 0.8\\pi $$\n数值上，$J_{\\text{net}} \\approx 2.513274... \\, \\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}$。\n\n按要求将数值结果四舍五入到四位有效数字：\n$J^{+} = 4.398 \\, \\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}$\n$J^{-} = 1.885 \\, \\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}$\n$J_{\\text{net}} = 2.513 \\, \\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}$\n流的单位是 $\\text{neutrons}\\cdot\\text{cm}^{-2}\\cdot\\text{s}^{-1}$，与预期相符。\n最终答案以 $J^{+}$、$J^{-}$ 和 $J_{\\text{net}}$ 的行矩阵形式呈现。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 4.398  1.885  2.513 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理解的最终检验是实现并验证一个可工作的模型。这个总结性练习将指导您设计一个完整的计算基准测试：您将首先推导出一个简单、可解场景下流的解析解，然后实现一个蒙特卡罗表面穿越估计器，以在统计不确定性范围内复现此结果。该实践整合了理论推导、算法设计和统计分析，这些都是计算科学中的基本技能。",
            "id": "4253987",
            "problem": "您需要设计并实现一个计算基准，以使用半空间各向同性源问题来验证核反应堆模拟中粒子流的表面穿越估计量。该基准必须在科学上基于界面处粒子流的输运理论公式，并且必须在统计不确定性范围内量化解析表达式与蒙特卡罗（Monte Carlo (MC)）估计值之间的一致性。\n\n考虑一个位于 $x=0$ 处的平面界面，它分隔了两个真空半空间，即左半空间 $x0$ 和右半空间 $x0$。设指向右半空间的界面单位法向量为出射方向。用 $\\psi\\left(x,\\Omega\\right)$ 表示角通量，其中 $\\Omega$ 是单位球面上的方向，相对于法线的极向余弦为 $\\mu=\\Omega\\cdot\\hat{n}$。从左半空间穿过界面进入右半空间的部分流（记为 $J^{+}$）和从右半空间穿过界面进入左半空间的部分流（记为 $J^{-}$），被定义为角通量乘以方向余弦在相应半球面上的积分。本任务要求您在半空间各向同性源边界条件下，推导出 $J^{+}$ 和 $J^{-}$ 的精确解析表达式，并基于表面穿越公式实现这些流的蒙特卡罗估计量。\n\n您必须使用的基本原理包括：\n- 角通量 $\\psi\\left(x,\\Omega\\right)$ 的定义及其与粒子流动的关系。\n- 部分流的定义，即粒子穿过一个界面的通量，并由 $\\mu$ 进行适当的方向加权。\n- 半空间各向同性源边界条件，其中从每个半空间入射到界面上的角通量在其出射半球面上是恒定的。\n- 远离界面的真空边界条件（Vacuum Boundary Conditions (VBC)），意味着没有碰撞的自由流。\n\n您不得假设或使用任何预先推导出的流的简化公式。相反，您必须从上述原理出发，推导出所需的 $J^{+}$ 和 $J^{-}$ 表达式。随后，设计一个蒙特卡罗估计量，该估计量使用指定的提议分布在半球面上采样方向，并使用无偏权重来估计表面流。该估计量必须清晰地处理统计不确定性，包括均值的标准误，并包含一个决策规则来确定解析结果与蒙特卡罗结果之间的一致性。\n\n物理单位：\n- 设角通量的单位为粒子/平方米/球面度/秒，即 $\\mathrm{particles\\cdot m^{-2}\\cdot sr^{-1}\\cdot s^{-1}}$。\n- 部分流 $J^{+}$ 和 $J^{-}$ 的单位必须为粒子/平方米/秒，即 $\\mathrm{particles\\cdot m^{-2}\\cdot s^{-1}}$。\n\n角度单位：\n- 所有角度必须以弧度处理。\n\n您的程序必须：\n1. 如上所述，从第一性原理推导并实现 $J^{+}$ 和 $J^{-}$ 的解析表达式。\n2. 使用半球面采样提议分布和适当的权重，实现部分流的蒙特卡罗估计量，以得到表面流积分的无偏估计。\n3. 使用固定的随机种子以确保确定性输出，并为每个流计算标准化差异 $z=\\left(\\hat{J}-J_{\\text{analytic}}\\right)/\\sigma_{\\hat{J}}$，其中 $\\hat{J}$ 是蒙特卡罗估计值，$\\sigma_{\\hat{J}}$ 是估计的均值标准误。\n4. 如果 $\\left|z\\right|\\leq k$（其中 $k=2$），则宣告一致。\n\n测试套件：\n提供一组参数集 $(\\psi_{L},\\psi_{R},N_{L},N_{R})$ 作为测试套件，其中 $\\psi_{L}$ 是界面上左半空间的出射各向同性角通量，$\\psi_{R}$ 是界面上右半空间的出射各向同性角通量， $N_{L}$ 是用于从左半空间估计 $J^{+}$ 的蒙特卡罗样本数， $N_{R}$ 是用于从右半空间估计 $J^{-}$ 的蒙特卡罗样本数。使用以下测试用例：\n- 用例 1：$(\\psi_{L},\\psi_{R},N_{L},N_{R})=\\left(1.0,0.0,200000,0\\right)$。\n- 用例 2：$(\\psi_{L},\\psi_{R},N_{L},N_{R})=\\left(0.0,0.5,0,150000\\right)$。\n- 用例 3：$(\\psi_{L},\\psi_{R},N_{L},N_{R})=\\left(0.8,0.8,100000,100000\\right)$。\n- 用例 4：$(\\psi_{L},\\psi_{R},N_{L},N_{R})=\\left(1.25,0.75,1000,1000\\right)$。\n\n覆盖性设计：\n- 用例 1 使用大样本量测试 $J^{+}$ 的单边源情况，而 $J^{-}$ 的源为零。\n- 用例 2 使用大样本量测试 $J^{-}$ 的另一侧情况，而 $J^{+}$ 的源为零。\n- 用例 3 在两侧提供对称的非零源，以中等样本量同时验证两个流。\n- 用例 4 提供较小的样本量，以测试估计量在较大统计不确定性下的行为。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例对此列表贡献一个布尔值，仅当该用例中的 $J^{+}$ 和 $J^{-}$ 都满足 $\\left|z\\right|\\leq k$ 时，才表示一致。例如，输出应类似于 $\\left[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4}\\right]$，其中每个 $\\text{result}_{i}$ 是 $\\text{True}$ 或 $\\text{False}$。",
            "solution": "该问题要求设计并实现一个计算基准，用以对照已知的解析解来验证一个用于粒子流的蒙特卡罗（MC）表面穿越估计量。物理场景是一个位于 $x=0$ 的平面界面，分隔两个真空半空间，其中有各向同性的粒子源射向相对的半空间。\n\n第一步是根据输运理论的基本原理推导部分流的解析表达式。部分流 $J^{+}$ 是粒子从左半空间 ($x0$) 穿过界面 $x=0$ 进入右半空间 ($x>0$) 的通量。部分流 $J^{-}$ 是粒子从右侧 ($x>0$) 穿过到左侧 ($x0$) 的通量。界面法向量 $\\hat{n}$ 指向正 $x$ 方向。粒子飞行方向由单位向量 $\\Omega$ 给出，$\\Omega$ 与 $\\hat{n}$ 之间夹角的余弦是极向余弦，$\\mu = \\Omega \\cdot \\hat{n}$。\n\n单位面积上的部分流定义为角通量 $\\psi(x,\\Omega)$ 在相应立体角半球面上乘以粒子方向向量法向分量的积分：\n$$ J^{+} = \\int_{\\mu0} \\mu \\, \\psi(0, \\Omega) \\, d\\Omega $$\n$$ J^{-} = \\int_{\\mu0} |\\mu| \\, \\psi(0, \\Omega) \\, d\\Omega = \\int_{\\mu0} (-\\mu) \\, \\psi(0, \\Omega) \\, d\\Omega $$\n\n问题指定了半空间各向同性源边界条件。从左侧 ($x0$) 入射到界面上的角通量对于所有出射方向 ($\\mu0$) 都是一个常数 $\\psi_L$，而从右侧 ($x0$) 入射的通量对于所有射向左侧的出射方向 ($\\mu0$) 都是一个常数 $\\psi_R$。\n$$ \\psi(0, \\Omega) = \\psi_L \\quad \\text{for } \\mu0 $$\n$$ \\psi(0, \\Omega) = \\psi_R \\quad \\text{for } \\mu0 $$\n由于 $\\psi_L$ 和 $\\psi_R$ 在它们各自的半球面上是常数，可以将它们移到积分外部：\n$$ J^{+} = \\psi_L \\int_{\\mu0} \\mu \\, d\\Omega $$\n$$ J^{-} = \\psi_R \\int_{\\mu0} (-\\mu) \\, d\\Omega $$\n\n为了计算这些积分，我们使用球坐标系，其中极轴与 $\\hat{n}$ 对齐。微分立体角为 $d\\Omega = \\sin\\theta \\, d\\theta \\, d\\phi$，其中 $\\theta$ 是极角，$\\phi$ 是方位角。极向余弦为 $\\mu = \\cos\\theta$。\n\n对于 $J^{+}$，积分范围是前半球面：$\\phi \\in [0, 2\\pi]$ 和 $\\theta \\in [0, \\pi/2]$ (对应于 $\\mu \\in [0, 1]$)。\n$$ \\int_{\\mu0} \\mu \\, d\\Omega = \\int_0^{2\\pi} d\\phi \\int_0^{\\pi/2} \\cos\\theta \\sin\\theta \\, d\\theta $$\n方位角积分得到一个因子 $2\\pi$。极角积分为：\n$$ \\int_0^{\\pi/2} \\sin\\theta \\cos\\theta \\, d\\theta = \\left[ \\frac{\\sin^2\\theta}{2} \\right]_0^{\\pi/2} = \\frac{1}{2} - 0 = \\frac{1}{2} $$\n因此，立体角上的积分为 $(2\\pi) \\times (1/2) = \\pi$。$J^{+}$ 的解析表达式为：\n$$ J^{+}_{\\text{analytic}} = \\pi \\psi_L $$\n\n对于 $J^{-}$，积分范围是后半球面：$\\phi \\in [0, 2\\pi]$ 和 $\\theta \\in [\\pi/2, \\pi]$ (对应于 $\\mu \\in [-1, 0]$)。\n$$ \\int_{\\mu0} (-\\mu) \\, d\\Omega = \\int_0^{2\\pi} d\\phi \\int_{\\pi/2}^{\\pi} (-\\cos\\theta) \\sin\\theta \\, d\\theta $$\n方位角积分再次得到 $2\\pi$。极角积分为：\n$$ \\int_{\\pi/2}^{\\pi} (-\\cos\\theta) \\sin\\theta \\, d\\theta = \\left[ \\frac{\\cos^2\\theta}{2} \\right]_{\\pi/2}^{\\pi} = \\frac{(-1)^2}{2} - \\frac{0^2}{2} = \\frac{1}{2} $$\n立体角上的积分也为 $\\pi$。$J^{-}$ 的解析表达式为：\n$$ J^{-}_{\\text{analytic}} = \\pi \\psi_R $$\n\n接下来，我们设计蒙特卡罗估计量。$J^{+}$ 的积分可以写成期望值的形式：\n$$ J^{+} = \\int_{2\\pi^+} \\left( \\frac{\\mu \\psi_L}{p(\\Omega)} \\right) p(\\Omega) \\, d\\Omega = E_p\\left[ \\frac{\\mu \\psi_L}{p(\\Omega)} \\right] $$\n其中 $p(\\Omega)$ 是我们用来抽样方向 $\\Omega$ 的概率密度函数。\n一个直接的提议分布 $p(\\Omega)$ 选择是在半球面上均匀（各向同性）分布，其中 $p(\\Omega) = 1/(2\\pi)$。为了从此分布中抽样，我们可以在 $[0,1]$ 上均匀抽样极向余弦 $\\mu$，在 $[0, 2\\pi]$ 上均匀抽样方位角 $\\phi$。对于以方向余弦 $\\mu_i$ 抽样的单个粒子 $i$，其分数或权重为：\n$$ W_i^{(+)} = \\frac{\\mu_i \\psi_L}{p(\\Omega_i)} = \\frac{\\mu_i \\psi_L}{1/(2\\pi)} = 2\\pi \\mu_i \\psi_L $$\n基于 $N_L$ 个样本的 $J^{+}$ 的MC估计值是这些分数的样本均值：\n$$ \\hat{J}^{+} = \\frac{1}{N_L} \\sum_{i=1}^{N_L} W_i^{(+)} $$\n该估计量是无偏的，因为 $E[W_i^{(+)}] = 2\\pi \\psi_L E[\\mu_i] = 2\\pi \\psi_L (1/2) = \\pi \\psi_L = J^{+}_{\\text{analytic}}$。\n\n类似地，对于 $J^{-}$，我们在 $[-1, 0]$ 上均匀抽样 $\\mu$。一个粒子的分数为：\n$$ W_i^{(-)} = \\frac{|\\mu_i| \\psi_R}{p(\\Omega_i)} = \\frac{|\\mu_i| \\psi_R}{1/(2\\pi)} = 2\\pi |\\mu_i| \\psi_R $$\nMC估计值 $\\hat{J}^{-}$ 是在 $N_R$ 个样本上对这些分数求平均。该估计量也是无偏的。\n\n最后一部分是统计验证。对于一组 $N$ 个分数 $\\{W_i\\}$，样本均值为 $\\hat{J} = \\frac{1}{N} \\sum W_i$。分数的样本方差为 $S_W^2 = \\frac{1}{N-1} \\sum (W_i - \\hat{J})^2$。那么均值的标准误为 $\\sigma_{\\hat{J}} = S_W / \\sqrt{N}$。\n\nMC估计值 $\\hat{J}$ 与解析解 $J_{\\text{analytic}}$ 之间的一致性由标准化差异 $z$ 来量化：\n$$ z = \\frac{\\hat{J} - J_{\\text{analytic}}}{\\sigma_{\\hat{J}}} $$\n根据中心极限定理，对于大的 $N$，$z$ 服从标准正态分布。如果 $|z| \\leq k$，则宣告一致。对于此问题，$k=2$，这对应于MC估计值在解析解的大约两个标准误范围内。\n\n如果某个流的样本数（例如 $N_L$）为零，则根据测试用例，相应的源（$\\psi_L$）也必须为零。在这种情况下，$J_{\\text{analytic}}=0$。不执行MC估计，因此我们可以认为估计值为 $\\hat{J}=0$，标准误 $\\sigma_{\\hat{J}}=0$。此时统计检验不适用，我们默认一致性为真，因为没有统计不确定性可供检验。对于给定的测试用例，一致性要求该条件对 $J^{+}$ 和 $J^{-}$ 都成立。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a computational benchmark to verify surface crossing\n    estimators for current in nuclear reactor simulation using a half-space\n    isotropic source problem.\n    \"\"\"\n    # Use a fixed random seed for deterministic and reproducible output.\n    SEED = 42\n    rng = np.random.default_rng(SEED)\n\n    # Define the test cases from the problem statement.\n    # Format: (psi_L, psi_R, N_L, N_R)\n    # psi_L: left half-space outward isotropic angular flux\n    # psi_R: right half-space outward isotropic angular flux\n    # N_L: number of MC samples for J+ (from left)\n    # N_R: number of MC samples for J- (from right)\n    test_cases = [\n        (1.0, 0.0, 200000, 0),\n        (0.0, 0.5, 0, 150000),\n        (0.8, 0.8, 100000, 100000),\n        (1.25, 0.75, 1000, 1000),\n    ]\n\n    # Threshold for standardized difference z\n    k = 2.0\n    results = []\n\n    for case in test_cases:\n        psi_L, psi_R, N_L, N_R = case\n\n        # --- Analytical Solutions ---\n        # J_plus = pi * psi_L\n        # J_minus = pi * psi_R\n        j_plus_analytic = np.pi * psi_L\n        j_minus_analytic = np.pi * psi_R\n\n        # Default agreement to True. This handles cases with N=0.\n        z_plus_ok = True\n        z_minus_ok = True\n\n        # --- Monte Carlo Estimation for J+ (left to right) ---\n        if N_L > 1:\n            # Sample mu uniformly from [0, 1] for the forward hemisphere.\n            mu_samples = rng.random(size=N_L)\n            \n            # The score for each particle is W = (mu * psi_L) / p(Omega)\n            # where p(Omega) = 1 / (2*pi) for uniform hemisphere sampling.\n            scores = 2.0 * np.pi * mu_samples * psi_L\n            \n            # Compute MC estimate and standard error of the mean\n            j_plus_mc = np.mean(scores)\n            \n            # Use ddof=1 for sample standard deviation\n            std_dev_scores = np.std(scores, ddof=1)\n            std_error_mean = std_dev_scores / np.sqrt(N_L)\n            \n            # Calculate the standardized difference z.\n            # Avoid division by zero if variance is zero (highly unlikely for N > 1).\n            if std_error_mean > 0:\n                z_plus = (j_plus_mc - j_plus_analytic) / std_error_mean\n                z_plus_ok = abs(z_plus) = k\n            else:\n                # If std_error is 0, the MC estimate must perfectly match the\n                # analytic one for agreement.\n                z_plus_ok = np.isclose(j_plus_mc, j_plus_analytic)\n        \n        # --- Monte Carlo Estimation for J- (right to left) ---\n        if N_R > 1:\n            # Sample |mu| uniformly from [0, 1] for the backward hemisphere.\n            # This is equivalent to sampling mu from [-1, 0] and taking abs().\n            abs_mu_samples = rng.random(size=N_R)\n            \n            # The score for each particle is W = (|mu| * psi_R) / p(Omega)\n            scores = 2.0 * np.pi * abs_mu_samples * psi_R\n\n            # Compute MC estimate and standard error of the mean\n            j_minus_mc = np.mean(scores)\n            std_dev_scores = np.std(scores, ddof=1)\n            std_error_mean = std_dev_scores / np.sqrt(N_R)\n\n            # Calculate the standardized difference z.\n            if std_error_mean > 0:\n                z_minus = (j_minus_mc - j_minus_analytic) / std_error_mean\n                z_minus_ok = abs(z_minus) = k\n            else:\n                z_minus_ok = np.isclose(j_minus_mc, j_minus_analytic)\n        \n        # Agreement for the case requires both currents to pass the test.\n        case_agreement = z_plus_ok and z_minus_ok\n        results.append(case_agreement)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}