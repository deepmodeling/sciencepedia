{
    "hands_on_practices": [
        {
            "introduction": "蒙特卡洛方法不仅仅是理论知识的堆砌，更需要通过动手实践来真正掌握。本章节将引导您完成一系列精心设计的实践问题，旨在加深您对蒙特卡洛估计量和统计（tally）的理解。我们将从三个核心领域展开：正确解读统计结果、量化其不确定性以及优化模拟效率。\n\n在临界（$k$-eigenvalue）蒙特卡洛模拟中，解出的中子通量密度是一个本征函数，其绝对幅度是任意的，因此必须进行归一化才能获得有物理意义的反应率。此练习  旨在阐明两种最常见的归一化方案——“每源粒子归一化”和“每裂变事件归一化”——之间的概念差异。掌握它们之间的转换对于正确解释模拟数据和比较不同设置下的结果至关重要。",
            "id": "4224230",
            "problem": "一个稳态中子输运问题通过蒙特卡罗 $k$ 特征值模拟求解，该模拟针对一个无外部源的均匀反应堆，其中裂变源驱动中子布居逐代延续。在此类模拟中，通常使用两种通量归一化方法：每源粒子归一化和每裂变事件归一化。\n\n从稳态中子平衡的 $k$ 特征值形式开始，该形式可以符号化地写为\n$$ \\mathcal{L}\\,\\phi = \\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}\\,\\phi, $$\n其中 $\\mathcal{L}$ 是流及损失算符，$\\mathcal{F}$ 是裂变产生算符，包含每次裂变产生的平均中子数 $\\nu$，而 $k_{\\text{eff}}$ 是有效中子增殖因子。设总裂变率为 $F \\equiv \\int_{V}\\Sigma_{f}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}V\\,\\mathrm{d}E$，总裂变中子产生率为 $P \\equiv \\int_{V}\\nu(\\mathbf{r},E)\\,\\Sigma_{f}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}V\\,\\mathrm{d}E$。设 $R_{r} \\equiv \\int_{V}\\Sigma_{r}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}V\\,\\mathrm{d}E$ 表示某种反应 $r$ 的体积分反应率。\n\n请解释每源粒子归一化和每裂变事件归一化在 $\\phi$ 的标定方式以及 $F$ 和 $P$ 与 $k_{\\text{eff}}$ 的关系方面的概念性差异。然后，使用第一性原理定义，推导一个通用表达式，用于将以每源粒子为单位报告的反应率统计量 $R_{r}$ 转换为相应的每裂变事件归一化的反应率。\n\n最后，将您的推导应用于以下测量的统计量，这些统计量均在同一次 $k$ 特征值模拟中以每源粒子为单位报告：\n- 有效增殖因子 $k_{\\text{eff}} = 1.0150$，\n- 体积分裂变率 $F_{\\text{s}} = 0.4150$，\n- 体积分裂变中子产生率 $P_{\\text{s}} = 1.0150$，\n- 反应 $r$（吸收材料中一种特定的俘获反应）的体积分反应率 $R_{r,\\text{s}} = 0.00790$。\n\n计算 $R_{r}$ 的每裂变事件归一化值，并以“每次裂变事件的事件数”为单位表示您的最终结果。将您的答案四舍五入到四位有效数字。",
            "solution": "所提出的问题具有科学依据，是自洽且适定的。提供的定义和方程是核反应堆物理和蒙特卡罗方法领域的标准。数值与理论框架一致，特别是报告的 $k_{\\text{eff}}$ 与每源粒子的裂变中子产生率之间的等同关系，这是所选归一化方法的一个已知结果。因此，该问题被认为是有效的，可以构建一个解。\n\n问题要求三个部分：对两种常用归一化方案的概念性解释，推导它们之间的转换公式，以及将此公式应用于一组特定的统计量。\n\n首先，我们讨论两种归一化方案之间的概念性差异。稳态 $k$ 特征值中子平衡方程\n$$ \\mathcal{L}\\,\\phi = \\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}\\,\\phi $$\n的基本解是特征函数 $\\phi$，它代表中子通量分布。与任何特征函数一样，其绝对幅度是任意的；该方程只决定其形状。为了获得定量的反应率，必须对通量进行归一化。这是通过对通量的某个积分性质施加约束来实现的。\n\n在每源粒子归一化中（通常用于蒙特卡罗 $k$ 特征值模拟），通量幅度被标定，使得下一代总源强度为1。在由裂变源驱动的模拟中，第 $n+1$ 代的中子源是第 $n$ 代裂变产生的中子布居。此源的算符是 $\\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}$。让按每源粒子归一化的通量表示为 $\\phi_{\\text{s}}$。总源强度是源项在所有相空间上的积分。因此，归一化条件为：\n$$ \\int_{V}\\int_{E} \\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}\\,\\phi_{\\text{s}}(\\mathbf{r},E) \\,\\mathrm{d}E\\,\\mathrm{d}V = 1 $$\n根据定义，总裂变中子产生率为 $P_{\\text{s}} = \\int_{V}\\int_{E} \\mathcal{F}\\,\\phi_{\\text{s}}(\\mathbf{r},E) \\,\\mathrm{d}E\\,\\mathrm{d}V$。将此代入归一化条件，得到：\n$$ \\frac{P_{\\text{s}}}{k_{\\text{eff}}} = 1 \\implies P_{\\text{s}} = k_{\\text{eff}} $$\n此恒等式证实，在每源粒子归一化的系统中，总裂变中子产生率的统计量在数值上等于有效增殖因子 $k_{\\text{eff}}$。问题陈述提供了 $k_{\\text{eff}} = 1.0150$ 和 $P_{\\text{s}} = 1.0150$，这与该原理一致。任何反应率统计量 $R_{r,\\text{s}}$ 均以“每模拟源粒子的 $r$ 类型事件数”为单位报告。\n\n在每裂变事件归一化中，通量幅度被标定，使得系统中发生的总裂变事件数为1。让此通量表示为 $\\phi_{\\text{f}}$。总裂变率定义为 $F \\equiv \\int_{V}\\int_{E}\\Sigma_{f}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}E\\,\\mathrm{d}V$。因此，归一化条件为：\n$$ F_{\\text{f}} = \\int_{V}\\int_{E}\\Sigma_{f}(\\mathbf{r},E)\\,\\phi_{\\text{f}}(\\mathbf{r},E)\\,\\mathrm{d}E\\,\\mathrm{d}V = 1 $$\n使用此归一化，反应率统计量 $R_{r,\\text{f}}$ 以“系统中每裂变事件的 $r$ 类型事件数”为单位报告。总裂变中子产生率 $P_{\\text{f}}$ 将是每次裂变事件产生的平均中子数，通常表示为 $\\bar{\\nu}$。\n\n接下来，我们推导转换公式。由于 $\\phi_{\\text{s}}$ 和 $\\phi_{\\text{f}}$ 代表相同的基本模式（特征函数），它们必须成比例。我们可以写成：\n$$ \\phi_{\\text{f}} = C \\cdot \\phi_{\\text{s}} $$\n其中 $C$ 是一个常数转换因子。为了找到 $C$，我们使用每裂变事件归一化的定义。\n$$ F_{\\text{f}} = 1 = \\int_{V}\\int_{E}\\Sigma_{f}\\,\\phi_{\\text{f}}\\,\\mathrm{d}E\\,\\mathrm{d}V = \\int_{V}\\int_{E}\\Sigma_{f}\\,(C \\cdot \\phi_{\\text{s}})\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n将常数 $C$ 提取出来：\n$$ 1 = C \\cdot \\int_{V}\\int_{E}\\Sigma_{f}\\,\\phi_{\\text{s}}\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n右侧的积分根据定义是每源粒子的裂变率 $F_{\\text{s}}$。\n$$ 1 = C \\cdot F_{\\text{s}} \\implies C = \\frac{1}{F_{\\text{s}}} $$\n现在我们可以转换任何任意的反应率 $R_{r}$。每裂变事件的反应率为 $R_{r,\\text{f}}$，每源粒子的反应率为 $R_{r,\\text{s}}$。\n$$ R_{r,\\text{f}} = \\int_{V}\\int_{E}\\Sigma_{r}\\,\\phi_{\\text{f}}\\,\\mathrm{d}E\\,\\mathrm{d}V = \\int_{V}\\int_{E}\\Sigma_{r}\\,\\left(\\frac{1}{F_{\\text{s}}}\\phi_{\\text{s}}\\right)\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n$$ R_{r,\\text{f}} = \\frac{1}{F_{\\text{s}}} \\int_{V}\\int_{E}\\Sigma_{r}\\,\\phi_{\\text{s}}\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n该积分是 $R_{r,\\text{s}}$ 的定义。因此，将反应率统计量从每源粒子转换为每裂变事件的通用表达式为：\n$$ R_{r,\\text{f}} = \\frac{R_{r,\\text{s}}}{F_{\\text{s}}} $$\n这表明，要将任何统计量从每源粒子的基础转换为每裂变事件的基础，必须将该统计量值除以在每源粒子基础上计算的总裂变率。\n\n最后，我们应用此推导来计算所要求的值。问题提供了以下均以每源粒子为单位报告的统计量：\n- 体积分裂变率：$F_{\\text{s}} = 0.4150$\n- 反应 $r$ 的体积分反应率：$R_{r,\\text{s}} = 0.00790$\n\n使用推导出的公式：\n$$ R_{r,\\text{f}} = \\frac{R_{r,\\text{s}}}{F_{\\text{s}}} = \\frac{0.00790}{0.4150} $$\n计算数值：\n$$ R_{r,\\text{f}} \\approx 0.019036144... $$\n输入数据中的有效数字位数对于 $R_{r,\\text{s}}$ ($0.00790$) 是三位，对于 $F_{\\text{s}}$ ($0.4150$) 是四位。标准的科学实践要求除法结果应报告为较少的有效数字位数，即三位。然而，问题明确指示“将您的答案四舍五入到四位有效数字”。遵循此直接指令，我们将结果四舍五入到四位有效数字。\n$$ R_{r,\\text{f}} \\approx 0.01904 $$\n该值表示反应堆中每发生一次裂变事件，反应 $r$ 的事件数。",
            "answer": "$$\\boxed{0.01904}$$"
        },
        {
            "introduction": "在理解了统计数值的物理意义之后，下一个关键步骤是评估我们对该数值的置信度。许多重要的物理量，如反照率（albedo）或宏观截面比值，是通过两个不同统计量的比值来计算的，即比值估计量。由于这些统计量通常源于同一批粒子历史，它们之间往往存在统计相关性，这使得不确定性的计算变得不那么直接。本练习  将指导您完成一个标准流程，应用一阶不确定性传播（也称为Delta方法）来推导相关变量比值估计量的方差，这是进行严谨误差分析的一项核心技能。",
            "id": "4224240",
            "problem": "考虑在具有平面表面$\\mathcal{S}$的平板中，稳态、单能中子输运。该表面分隔两个区域。设$\\mathbf{n}$为$\\mathcal{S}$上指向所研究区域外部的单位法向量。角通量为$\\psi(\\mathbf{r},\\mathbf{\\Omega})$，其中$\\mathbf{r}$是位置，$\\mathbf{\\Omega}$是方向。通过$\\mathcal{S}$的出射和入射偏流定义为\n$$\nJ_{+} \\equiv \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n} > 0} (\\mathbf{\\Omega}\\cdot \\mathbf{n}) \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S,\\qquad\nJ_{-} \\equiv \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n}  0} |\\mathbf{\\Omega}\\cdot \\mathbf{n}| \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S.\n$$\n$\\mathcal{S}$处的反照率是无量纲比值$A \\equiv J_{+}/J_{-}$。\n\n用$N$个独立源史进行蒙特卡罗（MC）模拟。每个史$i$由于输运、碰撞和所用的任何粒子数控制技术，在$\\mathcal{S}$处生成一组随机加权的粒子穿面事件。对于史$i$中的每个穿面事件$j$，设$w_{ij}$为穿越时的粒子统计权重，并设$\\mu_{ij} \\equiv \\mathbf{\\Omega}_{ij}\\cdot \\mathbf{n}$为其相对于$\\mathbf{n}$的方向余弦。定义每个史的出射和入射流贡献为\n$$\nX_{i} \\equiv \\sum_{j \\in \\text{outgoing}} w_{ij}\\, \\mu_{ij},\\qquad\nY_{i} \\equiv \\sum_{j \\in \\text{incoming}} w_{ij}\\, |\\mu_{ij}|.\n$$\n假设对于每个史$i$，对$(X_{i},Y_{i})$是一个平方可积的随机向量，具有有限的一阶矩和二阶矩，并且这些对在不同史之间是独立同分布的，但由于共享的输运实现和方差减小操作，在一个史内部可能相关。设$\\mu_{X} \\equiv \\mathbb{E}[X_{i}]$，$\\mu_{Y} \\equiv \\mathbb{E}[Y_{i}]$，$\\sigma_{X}^{2} \\equiv \\mathrm{Var}(X_{i})$，$\\sigma_{Y}^{2} \\equiv \\mathrm{Var}(Y_{i})$以及$\\sigma_{XY} \\equiv \\mathrm{Cov}(X_{i},Y_{i})$。\n\n定义样本均值$\\bar{X} \\equiv \\frac{1}{N}\\sum_{i=1}^{N} X_{i}$和$\\bar{Y} \\equiv \\frac{1}{N}\\sum_{i=1}^{N} Y_{i}$，以及反照率的比值估计量$\\hat{A} \\equiv \\bar{X}/\\bar{Y}$。从$J_{+}$和$J_{-}$的定义以及蒙特卡罗中偏流的无偏穿面流估计量出发，证明$\\hat{A}$以$A$为目标，也即证明当$N \\to \\infty$时，$\\hat{A}$是$A$的一致估计量。然后，利用$(\\bar{X},\\bar{Y})$的联合渐近正态性和适用于相关随机变量的一阶不确定性传播，推导$\\mathrm{Var}(\\hat{A})$的渐近方差，其形式为$\\mu_{X}$、$\\mu_{Y}$、$\\sigma_{X}^{2}$、$\\sigma_{Y}^{2}$、$\\sigma_{XY}$和$N$的闭式函数。\n\n将您的最终答案表示为单个闭式解析表达式。不需要数值舍入，反照率及其不确定性是无量纲的。",
            "solution": "该问题要求关于反照率的蒙特卡罗估计的两个结果。首先，我们必须证明比值估计量$\\hat{A} = \\bar{X}/\\bar{Y}$是真实反照率$A = J_{+}/J_{-}$的一致估计量。其次，我们必须推导该估计量的渐近方差$\\mathrm{Var}(\\hat{A})$。\n\n**第一部分：估计量$\\hat{A}$的一致性**\n\n估计量的一致性意味着随着样本数量趋于无穷大，该估计量在概率上收敛到被估计量的真值。这里，我们必须证明当$N \\to \\infty$时，$\\hat{A} \\xrightarrow{p} A$。\n\n量$J_{+}$和$J_{-}$是真实的出射和入射偏流，定义为角中子通量$\\psi(\\mathbf{r},\\mathbf{\\Omega})$的积分：\n$$J_{+} = \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n}  0} (\\mathbf{\\Omega}\\cdot \\mathbf{n}) \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S$$\n$$J_{-} = \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n}  0} |\\mathbf{\\Omega}\\cdot \\mathbf{n}| \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S$$\n真实反照率是比值$A = J_{+}/J_{-}$。\n\n在蒙特卡罗模拟中，得分$X_{i}$和$Y_{i}$分别是每个史对出射流和入射流的记录。穿面估计量被构造为无偏的。这意味着记录得分的期望值与所关心的物理量成正比。设$\\mu_X = \\mathbb{E}[X_i]$和$\\mu_Y = \\mathbb{E}[Y_i]$为每个史的期望得分。由于穿面估计量的无偏性，这些期望得分与真实偏流成正比，具有与源归一化相关的相同比例常数$C$：\n$$ \\mu_X = C J_{+} $$\n$$ \\mu_Y = C J_{-} $$\n因此，期望得分的比值恰好是反照率：\n$$ \\frac{\\mu_X}{\\mu_Y} = \\frac{C J_{+}}{C J_{-}} = \\frac{J_{+}}{J_{-}} = A $$\n我们假设$J_{-} \\neq 0$，因此$\\mu_Y \\neq 0$，这是反照率有良好定义的必要条件。\n\n问题陈述，对$(X_i, Y_i)$（$i=1, \\dots, N$）是独立同分布（i.i.d.）的随机向量，具有有限的一阶矩$\\mu_X$和$\\mu_Y$。样本均值为$\\bar{X} = \\frac{1}{N}\\sum_{i=1}^{N} X_{i}$和$\\bar{Y} = \\frac{1}{N}\\sum_{i=1}^{N} Y_{i}$。\n\n根据大数定律（LLN），对于具有有限均值的独立同分布随机变量，样本均值在概率上收敛于真实均值。将大数定律应用于我们的估计量，我们有：\n$$ \\bar{X} \\xrightarrow{p} \\mu_X \\quad \\text{as } N \\to \\infty $$\n$$ \\bar{Y} \\xrightarrow{p} \\mu_Y \\quad \\text{as } N \\to \\infty $$\n反照率估计量是$\\hat{A} = \\bar{X}/\\bar{Y}$。我们可以将其写为函数$g(\\bar{X}, \\bar{Y})$，其中$g(x,y) = x/y$。函数$g$在所有$y \\neq 0$的点$(x,y)$上是连续的。因为我们假设$\\mu_Y \\neq 0$，所以该函数在$(\\mu_X, \\mu_Y)$处是连续的。\n\n根据连续映射定理（Slutsky定理的一个推论），如果一个随机向量序列在概率上收敛到一个常数向量，那么该序列的任何连续函数都在概率上收敛到该常数向量的函数值。因此：\n$$ \\hat{A} = g(\\bar{X}, \\bar{Y}) \\xrightarrow{p} g(\\mu_X, \\mu_Y) = \\frac{\\mu_X}{\\mu_Y} $$\n因为我们已经确定$\\mu_X / \\mu_Y = A$，所以可以得出：\n$$ \\hat{A} \\xrightarrow{p} A $$\n这证明了$\\hat{A}$是反照率$A$的一致估计量。\n\n**第二部分：$\\hat{A}$的渐近方差**\n\n为了求$\\hat{A}$的渐近方差，我们使用函数$g(\\bar{X}, \\bar{Y}) = \\bar{X}/\\bar{Y}$在均值点$(\\mu_X, \\mu_Y)$周围的一阶泰勒级数展开。这种技术也被称为Delta方法。\n$$ \\hat{A} \\approx g(\\mu_X, \\mu_Y) + \\frac{\\partial g}{\\partial x}\\bigg|_{(\\mu_X, \\mu_Y)} (\\bar{X} - \\mu_X) + \\frac{\\partial g}{\\partial y}\\bigg|_{(\\mu_X, \\mu_Y)} (\\bar{Y} - \\mu_Y) $$\n$g(x,y) = x/y$的偏导数是：\n$$ \\frac{\\partial g}{\\partial x} = \\frac{1}{y} \\quad \\implies \\quad \\frac{\\partial g}{\\partial x}\\bigg|_{(\\mu_X, \\mu_Y)} = \\frac{1}{\\mu_Y} $$\n$$ \\frac{\\partial g}{\\partial y} = -\\frac{x}{y^2} \\quad \\implies \\quad \\frac{\\partial g}{\\partial y}\\bigg|_{(\\mu_X, \\mu_Y)} = -\\frac{\\mu_X}{\\mu_Y^2} $$\n将这些代入泰勒展开式得到：\n$$ \\hat{A} \\approx \\frac{\\mu_X}{\\mu_Y} + \\frac{1}{\\mu_Y}(\\bar{X} - \\mu_X) - \\frac{\\mu_X}{\\mu_Y^2}(\\bar{Y} - \\mu_Y) $$\n$\\hat{A}$的渐近方差是这个线性近似的方差。由于$\\mu_X$和$\\mu_Y$是常数，方差由下式给出：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\mathrm{Var}\\left( \\frac{1}{\\mu_Y}\\bar{X} - \\frac{\\mu_X}{\\mu_Y^2}\\bar{Y} \\right) $$\n我们使用两个相关随机变量$U$和$V$的线性组合的方差通用公式，$\\mathrm{Var}(aU+bV) = a^2\\mathrm{Var}(U) + b^2\\mathrm{Var}(V) + 2ab\\mathrm{Cov}(U,V)$。这里，$U=\\bar{X}$，$V=\\bar{Y}$，$a=1/\\mu_Y$，$b=-\\mu_X/\\mu_Y^2$。\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\left(\\frac{1}{\\mu_Y}\\right)^2 \\mathrm{Var}(\\bar{X}) + \\left(-\\frac{\\mu_X}{\\mu_Y^2}\\right)^2 \\mathrm{Var}(\\bar{Y}) + 2\\left(\\frac{1}{\\mu_Y}\\right)\\left(-\\frac{\\mu_X}{\\mu_Y^2}\\right)\\mathrm{Cov}(\\bar{X}, \\bar{Y}) $$\n接下来，我们求样本均值的方差和协方差。由于每个史的得分$(X_i, Y_i)$是独立同分布的，其方差为$\\sigma_X^2 = \\mathrm{Var}(X_i)$、$\\sigma_Y^2 = \\mathrm{Var}(Y_i)$，协方差为$\\sigma_{XY} = \\mathrm{Cov}(X_i, Y_i)$：\n$$ \\mathrm{Var}(\\bar{X}) = \\mathrm{Var}\\left(\\frac{1}{N}\\sum_{i=1}^{N} X_i\\right) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\mathrm{Var}(X_i) = \\frac{N\\sigma_X^2}{N^2} = \\frac{\\sigma_X^2}{N} $$\n$$ \\mathrm{Var}(\\bar{Y}) = \\mathrm{Var}\\left(\\frac{1}{N}\\sum_{i=1}^{N} Y_i\\right) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\mathrm{Var}(Y_i) = \\frac{N\\sigma_Y^2}{N^2} = \\frac{\\sigma_Y^2}{N} $$\n$$ \\mathrm{Cov}(\\bar{X}, \\bar{Y}) = \\mathrm{Cov}\\left(\\frac{1}{N}\\sum_{i=1}^{N} X_i, \\frac{1}{N}\\sum_{j=1}^{N} Y_j\\right) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\mathrm{Cov}(X_i, Y_i) = \\frac{N\\sigma_{XY}}{N^2} = \\frac{\\sigma_{XY}}{N} $$\n在协方差计算中，我们利用了当$i \\neq j$时$\\mathrm{Cov}(X_i, Y_j) = 0$这一事实，因为不同史是独立的。\n\n将这些代入$\\mathrm{Var}(\\hat{A})$的表达式中：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\frac{1}{\\mu_Y^2} \\left(\\frac{\\sigma_X^2}{N}\\right) + \\frac{\\mu_X^2}{\\mu_Y^4} \\left(\\frac{\\sigma_Y^2}{N}\\right) - \\frac{2\\mu_X}{\\mu_Y^3} \\left(\\frac{\\sigma_{XY}}{N}\\right) $$\n我们可以提出因子$1/N$并合并各项：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\frac{1}{N} \\left( \\frac{\\sigma_X^2}{\\mu_Y^2} + \\frac{\\mu_X^2 \\sigma_Y^2}{\\mu_Y^4} - \\frac{2\\mu_X \\sigma_{XY}}{\\mu_Y^3} \\right) $$\n为了得到一个单一的分式，我们将所有项置于公分母$N \\mu_Y^4$上：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\frac{1}{N\\mu_Y^4} \\left( \\mu_Y^2 \\sigma_X^2 + \\mu_X^2 \\sigma_Y^2 - 2\\mu_X \\mu_Y \\sigma_{XY} \\right) $$\n这就是反照率估计量$\\hat{A}$的渐近方差的最终闭式表达式。",
            "answer": "$$\\boxed{\\frac{\\mu_Y^2 \\sigma_X^2 + \\mu_X^2 \\sigma_Y^2 - 2\\mu_X \\mu_Y \\sigma_{XY}}{N\\mu_Y^4}}$$"
        },
        {
            "introduction": "一次模拟的最终价值不仅取决于其统计精度，还取决于获得该精度所需的计算成本。品质因子（Figure of Merit, FOM）是衡量蒙特卡洛模拟整体效率的黄金标准，它巧妙地结合了统计方差和计算时间这两个方面。优化模拟效率往往需要在不同因素之间做出权衡。此练习  构建了一个实用模型，用于分析在网格统计（mesh tally）中进行网格粗化所带来的效率增益。通过该模型，您将探索计算时间减少（由于穿越的网格边界减少）与统计方差变化（由于空间相关性）之间的复杂关系，从而深入理解如何全面地评估和提升模拟性能。",
            "id": "4224244",
            "problem": "一个模拟团队正在构建一个非均匀反应堆堆芯的高保真中子输运蒙特卡罗（MC）模型，以使用笛卡尔网格计数上的径迹长度估计子来预测空间分辨通量。他们希望了解几何追踪成本如何影响品质因数（FOM），以及在具有强材料非均匀性的堆芯中，粗化网格计数如何影响效率。该团队为建模和推导采用了以下科学上合理的假设：\n\n- 对于给定的网格单元，每个历史的计数得分是目标量的无偏估计量，其单历史随机变量为 $X$，具有有限均值 $E[X]$ 和方差 $\\mathrm{Var}(X)$，且各历史是独立的。\n- FOM 按常规定义为 $1/(R^{2} T)$，其中 $R$ 是计数的相对误差，$T$ 是达到该误差目标所需的总运行时间，对于 $N$ 个独立历史和每个历史的墙上时钟时间 $t_{h}$，$T = N t_{h}$。\n- 每个历史的时间可加性分解为 $t_{h} = t_{\\mathrm{coll}} + t_{\\mathrm{geom}} + t_{\\mathrm{tally}}$，其中 $t_{\\mathrm{coll}}$ 表示碰撞物理采样的时间，$t_{\\mathrm{geom}}$ 表示几何追踪（物理堆芯几何中的表面相交检查和边界穿越）的时间，$t_{\\mathrm{tally}}$ 表示网格计数簿记（径迹段到单元的映射和累积）的时间。\n- 几何追踪时间与一个历史中堆芯几何表面相互作用的期望次数成正比。对于平均径迹长度为 $L$、堆芯几何界面密度为 $\\Lambda_{\\mathrm{geo}}$（单位径迹长度的期望表面相交次数）的历史，$t_{\\mathrm{geom}}$ 被建模为 $t_{\\mathrm{geom}} = c_{g} L \\Lambda_{\\mathrm{geo}}$，其中 $c_{g}  0$ 是每次相交检查/穿越的平均成本。\n- 网格计数时间与一个历史中网格面穿越的期望次数成正比。对于细网格单元边长为 $a_{\\mathrm{fine}}$ 的笛卡尔网格，线-面穿越强度为 $\\Lambda_{\\mathrm{mesh}} = k_{m}/a_{\\mathrm{fine}}$，其中 $k_{m}  0$ 是一个与几何无关的常数，$t_{\\mathrm{tally}} = c_{t} L \\Lambda_{\\mathrm{mesh}}$，其中 $c_{t}  0$ 是每次网格穿越计数操作的平均成本。\n- 反应堆堆芯是三维的，团队考虑在每个笛卡尔方向上将网格粗化一个因子 $r  1$，因此粗网格单元的边长为 $a_{\\mathrm{coarse}} = r\\, a_{\\mathrm{fine}}$，每个粗网格单元聚合了 $K = r^{3}$ 个细网格单元。在粗化下，$\\Lambda_{\\mathrm{mesh}}$ 与边长成反比：$\\Lambda_{\\mathrm{mesh,coarse}} = \\Lambda_{\\mathrm{mesh}}/r$。\n- 粗网格单元的计数得分是 $K$ 个细网格单元得分的总和。为了捕捉由非均匀性驱动的空间相关性，团队将在一个给定的历史中，聚合到一个粗网格单元中的 $K$ 个细网格单元的单历史得分建模为具有共同的每单元方差 $\\sigma^{2}$ 和在粗网格单元内的不同细网格单元之间具有相等的两两相关系数 $\\rho \\in [0,1]$。这样得到的粗网格单元总和的方差考虑了协方差。\n\n基于这些假设：\n\n- 从第一性原理出发，推导一个每单元 FOM 的表达式，该表达式明确地将几何追踪成本的贡献显示为 $t_{h}$ 中的一个可加项。\n- 然后，根据所述的 $\\Lambda_{\\mathrm{mesh}}$ 随 $r$ 的标度关系，推导效率增益 $G$ 的闭式表达式，$G$ 定义为粗网格单元 FOM 与细网格单元 FOM 的比值，$G = \\mathrm{FOM}_{\\mathrm{coarse}} / \\mathrm{FOM}_{\\mathrm{fine}}$，用 $K$、$\\rho$、$L$、$t_{\\mathrm{coll}}$、$c_{g}$、$\\Lambda_{\\mathrm{geo}}$、$c_{t}$ 和 $\\Lambda_{\\mathrm{mesh}}$ 表示。\n\n选择为每单元 FOM 和效率增益 $G$ 提供正确表达式对的选项。\n\nA. $\\displaystyle \\mathrm{FOM} = \\frac{E[X]^{2}}{\\mathrm{Var}(X)} \\cdot \\frac{1}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}, \\quad G = \\frac{r^{3}}{1 + \\rho \\left(r^{3} - 1\\right)} \\cdot \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\dfrac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}.$\n\nB. $\\displaystyle \\mathrm{FOM} = \\left(\\frac{E[X]^{2}}{\\mathrm{Var}(X)}\\right)\\left(c_{g} L \\Lambda_{\\mathrm{geo}}\\right), \\quad G = r^{3} \\cdot \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\dfrac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}.$\n\nC. $\\displaystyle \\mathrm{FOM} = \\frac{E[X]^{2}}{\\mathrm{Var}(X)} \\cdot \\frac{1}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}, \\quad G = \\frac{r}{1 + \\rho \\left(r - 1\\right)} \\cdot \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\dfrac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}.$\n\nD. $\\displaystyle \\mathrm{FOM} = \\frac{E[X]^{2}}{\\mathrm{Var}(X)} \\cdot \\frac{1}{\\left(t_{\\mathrm{coll}} + c_{t} L \\Lambda_{\\mathrm{mesh}}\\right)\\left(1 + c_{g} L \\Lambda_{\\mathrm{geo}}\\right)}, \\quad G = \\frac{r^{3}}{1 - \\rho \\left(r^{3} - 1\\right)} \\cdot \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\dfrac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}.$",
            "solution": "该问题陈述被评估为有效，因为它是科学上站得住脚的、适定的、客观的，并包含足够的信息以获得唯一解。所提出的计算时间和方差模型在蒙特卡罗核反应堆模拟的背景下是标准且合理的。\n\n解的推导分为两部分，与问题的要求一致：首先，推导品质因数（FOM）；其次，推导效率增益 $G$。\n\n### 第 1 部分：每单元品质因数（FOM）的推导\n\n1.  **FOM的定义**：品质因数定义为 $\\mathrm{FOM} = 1/(R^2 T)$，其中 $R$ 是计数的相对误差，$T$ 是总运行时间。\n\n2.  **相对误差 ($R$)**：单个历史的计数得分是一个随机变量 $X$，其均值为 $E[X]$，方差为 $\\mathrm{Var}(X)$。模拟运行 $N$ 个独立的历史。样本均值为 $\\bar{X}_N = \\frac{1}{N} \\sum_{i=1}^{N} X_i$。\n    样本均值的期望值为 $E[\\bar{X}_N] = E[X]$。\n    对于独立历史，样本均值的方差为 $\\mathrm{Var}(\\bar{X}_N) = \\mathrm{Var}(X)/N$。\n    相对误差 $R$ 是均值的标准误除以均值：\n    $$R = \\frac{\\sqrt{\\mathrm{Var}(\\bar{X}_N)}}{E[\\bar{X}_N]} = \\frac{\\sqrt{\\mathrm{Var}(X)/N}}{E[X]} = \\frac{1}{\\sqrt{N}} \\frac{\\sqrt{\\mathrm{Var}(X)}}{E[X]}$$\n    对相对误差平方可得：\n    $$R^2 = \\frac{1}{N} \\frac{\\mathrm{Var}(X)}{(E[X])^2}$$\n\n3.  **总运行时间 ($T$)**：总运行时间由 $T = N t_h$ 给出，其中 $t_h$ 是每个历史的平均墙上时钟时间。\n\n4.  **代入FOM**：我们将 $R^2$ 和 $T$ 的表达式代入 FOM 的定义中：\n    $$\\mathrm{FOM} = \\frac{1}{R^2 T} = \\frac{1}{\\left(\\frac{1}{N} \\frac{\\mathrm{Var}(X)}{(E[X])^2}\\right) (N t_h)} = \\frac{(E[X])^2 N}{\\mathrm{Var}(X) N t_h} = \\frac{(E[X])^2}{\\mathrm{Var}(X) t_h}$$\n    这是一个标准结果，表明 FOM 与历史数 $N$ 无关。项 $(E[X])^2/\\mathrm{Var}(X)$ 可与单历史得分的变异系数相关。\n\n5.  **单历史时间 ($t_h$)**：问题提供了单历史时间的可加性分解：\n    $$t_h = t_{\\mathrm{coll}} + t_{\\mathrm{geom}} + t_{\\mathrm{tally}}$$\n    问题还将几何和计数追踪时间建模为：\n    $$t_{\\mathrm{geom}} = c_{g} L \\Lambda_{\\mathrm{geo}}$$\n    $$t_{\\mathrm{tally}} = c_{t} L \\Lambda_{\\mathrm{mesh}}$$\n    将这些代入 $t_h$ 的表达式中可得：\n    $$t_h = t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}$$\n\n6.  **最终FOM表达式**：将 $t_h$ 的完整表达式代入 FOM 方程，得到每单元 FOM 的最终表达式，其中明确显示了几何追踪成本：\n    $$\\mathrm{FOM} = \\frac{(E[X])^2}{\\mathrm{Var}(X) t_h} = \\frac{(E[X])^2}{\\mathrm{Var}(X)} \\cdot \\frac{1}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}$$\n\n### 第 2 部分：效率增益 ($G$) 的推导\n\n1.  **G的定义**：效率增益 $G$ 是粗网格单元 FOM 与细网格单元 FOM 的比值：\n    $$G = \\frac{\\mathrm{FOM}_{\\mathrm{coarse}}}{\\mathrm{FOM}_{\\mathrm{fine}}}$$\n\n2.  **FOM的比率**：使用上面推导的 FOM 的通用表达式，我们可以将该比率写为：\n    $$G = \\frac{(E[X_{\\mathrm{coarse}}])^2 / (\\mathrm{Var}(X_{\\mathrm{coarse}}) t_{h, \\mathrm{coarse}})}{(E[X_{\\mathrm{fine}}])^2 / (\\mathrm{Var}(X_{\\mathrm{fine}}) t_{h, \\mathrm{fine}})} = \\left(\\frac{E[X_{\\mathrm{coarse}}]}{E[X_{\\mathrm{fine}}]}\\right)^2 \\cdot \\frac{\\mathrm{Var}(X_{\\mathrm{fine}})}{\\mathrm{Var}(X_{\\mathrm{coarse}})} \\cdot \\frac{t_{h, \\mathrm{fine}}}{t_{h, \\mathrm{coarse}}}$$\n\n3.  **比率分量分析**：我们评估三个比率中的每一个。\n    *   **期望值比率**：一个粗网格单元是 $K = r^3$ 个细网格单元的聚合。粗网格单元中的得分 $X_{\\mathrm{coarse}}$ 是其组成的细网格单元得分 $X_{\\mathrm{fine}, i}$ 的总和：$X_{\\mathrm{coarse}} = \\sum_{i=1}^{K} X_{\\mathrm{fine}, i}$。根据期望的线性性质，$E[X_{\\mathrm{coarse}}] = \\sum_{i=1}^{K} E[X_{\\mathrm{fine}, i}]$。假设目标量在粗网格单元内的细网格单元之间近似均匀，我们可以假定对于一个代表性的细网格单元有 $E[X_{\\mathrm{fine}, i}] \\approx E[X_{\\mathrm{fine}}]$。因此，$E[X_{\\mathrm{coarse}}] \\approx K \\cdot E[X_{\\mathrm{fine}}]$。期望平方的比值为：\n        $$\\left(\\frac{E[X_{\\mathrm{coarse}}]}{E[X_{\\mathrm{fine}}]}\\right)^2 \\approx \\left(\\frac{K \\cdot E[X_{\\mathrm{fine}}]}{E[X_{\\mathrm{fine}}]}\\right)^2 = K^2$$\n    *   **方差比率**：问题陈述，细网格单元得分具有共同的方差 $\\mathrm{Var}(X_{\\mathrm{fine}, i}) = \\sigma^2 = \\mathrm{Var}(X_{\\mathrm{fine}})$，以及共同的两两相关性 $\\mathrm{Corr}(X_{\\mathrm{fine}, i}, X_{\\mathrm{fine}, j}) = \\rho$，对于 $i \\neq j$。这意味着 $\\mathrm{Cov}(X_{\\mathrm{fine}, i}, X_{\\mathrm{fine}, j}) = \\rho \\sigma^2$。总和的方差为：\n        $$\\mathrm{Var}(X_{\\mathrm{coarse}}) = \\mathrm{Var}\\left(\\sum_{i=1}^{K} X_{\\mathrm{fine}, i}\\right) = \\sum_{i=1}^{K} \\mathrm{Var}(X_{\\mathrm{fine}, i}) + \\sum_{i \\neq j} \\mathrm{Cov}(X_{\\mathrm{fine}, i}, X_{\\mathrm{fine}, j})$$\n        有 $K$ 个方差项和 $K(K-1)$ 个协方差项。\n        $$\\mathrm{Var}(X_{\\mathrm{coarse}}) = K \\sigma^2 + K(K-1) \\rho \\sigma^2 = K \\sigma^2 [1 + (K-1)\\rho]$$\n        方差的反比为：\n        $$\\frac{\\mathrm{Var}(X_{\\mathrm{fine}})}{\\mathrm{Var}(X_{\\mathrm{coarse}})} = \\frac{\\sigma^2}{K \\sigma^2 [1 + (K-1)\\rho]} = \\frac{1}{K[1 + (K-1)\\rho]}$$\n    *   **时间比率**：单历史时间取决于计数网格。\n        对于细网格：$t_{h, \\mathrm{fine}} = t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}$。\n        对于粗网格，单元边长是 $r$ 倍大，因此网格穿越强度标度为 $\\Lambda_{\\mathrm{mesh,coarse}} = \\Lambda_{\\mathrm{mesh}}/r$。\n        粗网格的时间为：$t_{h, \\mathrm{coarse}} = t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh,coarse}} = t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\frac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}$。\n        时间比率为：\n        $$\\frac{t_{h, \\mathrm{fine}}}{t_{h, \\mathrm{coarse}}} = \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\frac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}$$\n\n4.  **组合增益 ($G$)**：我们将三个分量比率相乘：\n    $$G = (K^2) \\cdot \\left(\\frac{1}{K[1 + (K-1)\\rho]}\\right) \\cdot \\left(\\frac{t_{h, \\mathrm{fine}}}{t_{h, \\mathrm{coarse}}}\\right)$$\n    $$G = \\frac{K}{1 + (K-1)\\rho} \\cdot \\frac{t_{h, \\mathrm{fine}}}{t_{h, \\mathrm{coarse}}}$$\n    代入 $K=r^3$ 和完整的时间表达式：\n    $$G = \\frac{r^3}{1 + \\rho(r^3 - 1)} \\cdot \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\frac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}$$\n\n### 选项评估\n\n推导出的表达式为：\n-   $\\displaystyle \\mathrm{FOM} = \\frac{E[X]^{2}}{\\mathrm{Var}(X)} \\cdot \\frac{1}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}$\n-   $\\displaystyle G = \\frac{r^{3}}{1 + \\rho \\left(r^{3} - 1\\right)} \\cdot \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\frac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}$\n\n现在我们对照这些结果评估每个选项。\n\n**A.** FOM 的表达式为 $\\displaystyle \\mathrm{FOM} = \\frac{E[X]^{2}}{\\mathrm{Var}(X)} \\cdot \\frac{1}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}$。这与我们推导的 FOM 完全相同。\n$G$ 的表达式为 $\\displaystyle G = \\frac{r^{3}}{1 + \\rho \\left(r^{3} - 1\\right)} \\cdot \\frac{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + c_{t} L \\Lambda_{\\mathrm{mesh}}}{t_{\\mathrm{coll}} + c_{g} L \\Lambda_{\\mathrm{geo}} + \\dfrac{c_{t} L \\Lambda_{\\mathrm{mesh}}}{r}}$。这与我们推导的增益 $G$ 完全相同。\n**结论**：正确。\n\n**B.** FOM 的表达式为 $\\displaystyle \\mathrm{FOM} = \\left(\\frac{E[X]^{2}}{\\mathrm{Var}(X)}\\right)\\left(c_{g} L \\Lambda_{\\mathrm{geo}}\\right)$。这在量纲和结构上都是不正确的，因为它与时间的一个分量成正比，而不是与总时间成反比。$G$ 的表达式也不正确，因为它忽略了方差缩减因子 $[1 + \\rho(r^3 - 1)]^{-1}$。\n**结论**：不正确。\n\n**C.** FOM 的表达式是正确的。但是，$G$ 的表达式 $\\displaystyle G = \\frac{r}{1 + \\rho \\left(r - 1\\right)} \\cdot \\ldots$ 在方差比率项中错误地使用了 $r$ 来代替 $K=r^3$。这只对一维问题有效，而这与问题陈述的设置（三维堆芯，$K=r^3$）相矛盾。\n**结论**：不正确。\n\n**D.** FOM 的表达式 $\\displaystyle \\mathrm{FOM} = \\frac{E[X]^{2}}{\\mathrm{Var}(X)} \\cdot \\frac{1}{\\left(t_{\\mathrm{coll}} + c_{t} L \\Lambda_{\\mathrm{mesh}}\\right)\\left(1 + c_{g} L \\Lambda_{\\mathrm{geo}}\\right)}$ 错误地将时间贡献建模为乘法结构而非加法结构。$G$ 的表达式在方差因子的分母中存在符号错误（是 $1 - \\rho(r^3-1)$ 而不是 $1 + \\rho(r^3-1)$）。这是一个关键的数学错误。\n**结论**：不正确。\n\n基于第一性原理的推导，只有选项 A 提供了正确的表达式对。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}