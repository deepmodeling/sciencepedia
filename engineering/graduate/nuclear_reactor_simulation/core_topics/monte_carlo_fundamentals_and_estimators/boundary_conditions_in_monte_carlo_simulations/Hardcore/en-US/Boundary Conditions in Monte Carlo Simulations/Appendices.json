{
    "hands_on_practices": [
        {
            "introduction": "This practice addresses the most fundamental operation in Monte Carlo particle tracking: calculating the distance from a particle's current position to a geometric boundary. Mastering this calculation is essential, as it forms the basis for determining whether a particle's next event is a collision or a boundary crossing. This exercise  will also introduce you to a critical aspect of creating robust simulations—handling the numerical instabilities that arise from near-grazing trajectories in finite-precision arithmetic.",
            "id": "4216094",
            "problem": "In neutral particle transport for nuclear reactor simulation, the neutron's streaming between interactions is governed by the linear Boltzmann transport equation, whose deterministic streaming term states that a particle at position $\\mathbf{r}$ with direction $\\hat{\\Omega}$ advances along the parametric ray $\\mathbf{r}(s)=\\mathbf{r}+s\\,\\hat{\\Omega}$ until it either interacts in the medium or encounters a boundary. In Monte Carlo (MC) simulation, the free-flight distance to the next collision is sampled from an exponential distribution determined by the total macroscopic cross section, and potential boundary crossings are located by geometric intersection of $\\mathbf{r}(s)$ with the boundary surface. Consider a planar face of a convex cell described by a plane with outward unit normal $\\mathbf{n}$ and a known point $\\mathbf{r}_{0}$ on the plane, so that any point $\\mathbf{x}$ on the plane satisfies $\\mathbf{n}\\cdot(\\mathbf{x}-\\mathbf{r}_{0})=0$. A neutron is currently at position $\\mathbf{r}$ inside the cell with unit direction $\\hat{\\Omega}$, and the cell has a homogeneous total macroscopic cross section $\\Sigma_{t}$.\n\n(a) Starting from the plane equation and the ray parameterization, derive an expression for the distance-to-boundary $s_{b}$ along $\\hat{\\Omega}$ to the planar face, and identify the conditions under which this distance is physically admissible (i.e., yields a forward intersection). Explain, from first principles, the near-parallel edge case where $\\hat{\\Omega}\\cdot\\mathbf{n}\\approx 0$, including how finite-precision arithmetic motivates introducing a tolerance $\\tau>0$ for deciding when to treat the ray as parallel to the plane within the simulation.\n\n(b) In a specific simulation, let the outward unit normal be $\\mathbf{n}=(0,0,1)$, the plane reference point be $\\mathbf{r}_{0}=\\big(0,0,5.0\\times 10^{-3}\\big)\\,\\mathrm{m}$, the neutron position be $\\mathbf{r}=\\big(1.0\\times 10^{-3},\\,2.0\\times 10^{-3},\\,4.9\\times 10^{-3}\\big)\\,\\mathrm{m}$, and the neutron direction be $\\hat{\\Omega}=\\dfrac{(1,\\,0,\\,10^{-12})}{\\|(1,\\,0,\\,10^{-12})\\|}$. The total macroscopic cross section is $\\Sigma_{t}=50\\,\\mathrm{m}^{-1}$, and the uniform random deviate used to sample the free-flight distance is $\\xi=0.2$. Adopt a near-parallel tolerance of $\\tau=1.0\\times 10^{-10}$. Using your derivation from part (a), compute the physically realized streaming distance $s$ as the minimum of the admissible boundary distance and the sampled collision distance. Express the final distance $s$ in meters, and round your result to six significant figures.",
            "solution": "The problem is divided into two parts. Part (a) requires the derivation of the distance to a planar boundary and an analysis of the physically admissible conditions, including the numerical treatment of near-parallel trajectories. Part (b) requires applying these principles to compute a specific streaming distance for a neutron in a Monte Carlo simulation.\n\n(a) Derivation and Analysis of Boundary Intersection\n\nA neutron travels along a straight line path between interactions. Its position $\\mathbf{r}(s)$ at a distance $s$ along its flight path from its current position $\\mathbf{r}$ is given by the parametric ray equation:\n$$\n\\mathbf{r}(s) = \\mathbf{r} + s\\,\\hat{\\Omega}\n$$\nwhere $\\hat{\\Omega}$ is the unit vector representing the neutron's direction of travel.\n\nThe planar face of the geometry is described by the set of all points $\\mathbf{x}$ satisfying the equation:\n$$\n\\mathbf{n}\\cdot(\\mathbf{x}-\\mathbf{r}_{0})=0\n$$\nwhere $\\mathbf{n}$ is the outward-pointing unit normal to the plane and $\\mathbf{r}_{0}$ is a known point on the plane.\n\nTo find the distance-to-boundary, denoted by $s_{b}$, we must find the value of the parameter $s$ for which the neutron's path intersects the plane. This occurs when $\\mathbf{r}(s_{b})$ satisfies the plane equation. Substituting the ray equation into the plane equation gives:\n$$\n\\mathbf{n}\\cdot((\\mathbf{r} + s_{b}\\,\\hat{\\Omega}) - \\mathbf{r}_{0}) = 0\n$$\nWe can rearrange this equation using the distributive property of the dot product:\n$$\n\\mathbf{n}\\cdot(\\mathbf{r} - \\mathbf{r}_{0}) + \\mathbf{n}\\cdot(s_{b}\\,\\hat{\\Omega}) = 0\n$$\nSince $s_{b}$ is a scalar, we can factor it out of the second dot product:\n$$\n\\mathbf{n}\\cdot(\\mathbf{r} - \\mathbf{r}_{0}) + s_{b}\\,(\\mathbf{n}\\cdot\\hat{\\Omega}) = 0\n$$\nSolving for the distance-to-boundary $s_{b}$ yields:\n$$\ns_{b}\\,(\\mathbf{n}\\cdot\\hat{\\Omega}) = -\\mathbf{n}\\cdot(\\mathbf{r} - \\mathbf{r}_{0}) = \\mathbf{n}\\cdot(\\mathbf{r}_{0} - \\mathbf{r})\n$$\n$$\ns_{b} = \\frac{\\mathbf{n}\\cdot(\\mathbf{r}_{0} - \\mathbf{r})}{\\mathbf{n}\\cdot\\hat{\\Omega}}\n$$\nThis is the general expression for the distance from point $\\mathbf{r}$ to the plane along the direction $\\hat{\\Omega}$.\n\nNext, we identify the conditions under which this distance is physically admissible.\n$1$. The neutron must travel a positive distance to reach the boundary. Thus, we must have $s_{b} > 0$.\n$2$. The point $\\mathbf{r}$ is stated to be *inside* the convex cell. Since $\\mathbf{n}$ is the *outward* unit normal, the vector from a point on the plane ($\\mathbf{r}_0$) to the particle's position ($\\mathbf{r}$) must have a component that opposes $\\mathbf{n}$. Mathematically, this means $\\mathbf{n}\\cdot(\\mathbf{r} - \\mathbf{r}_{0}) < 0$. Consequently, the numerator of the expression for $s_{b}$, which is $\\mathbf{n}\\cdot(\\mathbf{r}_{0} - \\mathbf{r})$, must be positive.\n$3$. For $s_{b} = \\frac{\\mathbf{n}\\cdot(\\mathbf{r}_{0} - \\mathbf{r})}{\\mathbf{n}\\cdot\\hat{\\Omega}}$ to be positive, given a positive numerator, the denominator $\\mathbf{n}\\cdot\\hat{\\Omega}$ must also be positive. A value of $\\mathbf{n}\\cdot\\hat{\\Omega} > 0$ signifies that the neutron's direction vector $\\hat{\\Omega}$ has a component along the outward normal $\\mathbf{n}$, meaning the neutron is moving towards the boundary, which is the necessary condition for an intersection to occur in the forward direction. If $\\mathbf{n}\\cdot\\hat{\\Omega} \\le 0$, the neutron is moving parallel to or away from the boundary and will not intersect it (in the positive $s$ direction), so $s_b$ is not a valid positive distance.\n\nTherefore, the condition for a physically admissible forward intersection is $\\mathbf{n}\\cdot\\hat{\\Omega} > 0$.\n\nNow we consider the near-parallel edge case where $\\mathbf{n}\\cdot\\hat{\\Omega} \\approx 0$.\nFrom first principles, if a neutron's path is exactly parallel to the plane, then $\\hat{\\Omega}$ is orthogonal to $\\mathbf{n}$, and $\\mathbf{n}\\cdot\\hat{\\Omega} = 0$. In this case, the denominator of the expression for $s_b$ is zero, and the distance to intersection is infinite, which is physically correct.\nIn a computer simulation using finite-precision arithmetic (e.g., floating-point numbers), a value that is mathematically zero may be represented by a very small non-zero number due to rounding errors in previous calculations of $\\mathbf{r}$ or $\\hat{\\Omega}$. If $\\mathbf{n}\\cdot\\hat{\\Omega}$ is a very small non-zero number, its direct use in the division can cause severe numerical instability:\n- If $\\mathbf{n}\\cdot\\hat{\\Omega}$ is a small positive number (e.g., $10^{-15}$), $s_{b}$ becomes an enormous positive number, potentially causing an overflow.\n- If, due to a slight numerical error, $\\mathbf{n}\\cdot\\hat{\\Omega}$ becomes a small negative number, $s_{b}$ would be calculated as a large-magnitude negative distance, incorrectly implying an intersection in the backward direction.\nThe result is extremely sensitive to minute errors in the dot product. To ensure the robustness of the simulation, a tolerance $\\tau > 0$ is introduced. Before computing $s_{b}$, the absolute value of the denominator is checked:\nIf $|\\mathbf{n}\\cdot\\hat{\\Omega}| < \\tau$, the ray is treated as being effectively parallel to the plane. In this scenario, the algorithm does not calculate the division. Instead, it concludes that no intersection will occur, and the distance to this boundary is set to a value representing infinity. This prevents the division by a near-zero number and yields a physically consistent result for near-parallel trajectories, which would travel a very long distance within the cell before hitting that specific face.\n\n(b) Calculation of Streaming Distance\n\nFirst, we define the given parameters:\n- Outward normal: $\\mathbf{n}=(0,0,1)$.\n- Point on plane: $\\mathbf{r}_{0}=\\big(0,0,5.0\\times 10^{-3}\\big)\\,\\mathrm{m}$.\n- Neutron position: $\\mathbf{r}=\\big(1.0\\times 10^{-3},\\,2.0\\times 10^{-3},\\,4.9\\times 10^{-3}\\big)\\,\\mathrm{m}$.\n- Unnormalized neutron direction: $\\mathbf{v} = (1,\\,0,\\,10^{-12})$.\n- Total macroscopic cross section: $\\Sigma_{t}=50\\,\\mathrm{m}^{-1}$.\n- Random number for sampling: $\\xi=0.2$.\n- Near-parallel tolerance: $\\tau=1.0\\times 10^{-10}$.\n\nThe realized streaming distance $s$ is the minimum of two quantities: the sampled distance to the next collision, $s_{c}$, and the admissible distance to the boundary, $s_{b}$.\n$$\ns = \\min(s_{c}, s_{b})\n$$\n\n1. Calculate the sampled collision distance $s_{c}$.\nIn Monte Carlo methods, the distance to collision is sampled from the probability distribution $p(s) = \\Sigma_{t}\\exp(-\\Sigma_{t}s)$ by inverting its cumulative distribution function. This leads to the formula:\n$$\ns_{c} = -\\frac{1}{\\Sigma_{t}}\\ln(\\xi)\n$$\nSubstituting the given values:\n$$\ns_{c} = -\\frac{1}{50\\,\\mathrm{m}^{-1}}\\ln(0.2) = \\frac{\\ln(5)}{50}\\,\\mathrm{m} \\approx 0.032188758\\,\\mathrm{m}\n$$\n\n2. Calculate the distance to the boundary $s_{b}$.\nFirst, we must normalize the direction vector $\\mathbf{v}$:\n$$\n\\|\\mathbf{v}\\| = \\sqrt{1^{2} + 0^{2} + (10^{-12})^{2}} = \\sqrt{1 + 10^{-24}}\n$$\nThe unit direction vector is $\\hat{\\Omega} = \\frac{\\mathbf{v}}{\\|\\mathbf{v}\\|} = \\frac{(1,\\,0,\\,10^{-12})}{\\sqrt{1 + 10^{-24}}}$.\n\nNext, we follow the procedure from part (a). We compute the denominator for $s_{b}$, which we denote $\\mu = \\mathbf{n}\\cdot\\hat{\\Omega}$.\n$$\n\\mu = \\mathbf{n}\\cdot\\hat{\\Omega} = (0,0,1)\\cdot\\frac{(1,\\,0,\\,10^{-12})}{\\sqrt{1 + 10^{-24}}} = \\frac{10^{-12}}{\\sqrt{1 + 10^{-24}}}\n$$\nThe value $\\sqrt{1+10^{-24}}$ is negligibly different from $1$, so $\\mu \\approx 10^{-12}$.\nNow, we apply the near-parallel tolerance check. We compare $|\\mu|$ with $\\tau$:\n$$\n|\\mu| = \\frac{10^{-12}}{\\sqrt{1 + 10^{-24}}} \\approx 10^{-12}\n$$\nSince $\\tau = 1.0\\times 10^{-10}$, the condition $|\\mu| < \\tau$ is met because $10^{-12} < 10^{-10}$.\n\nAccording to the rule established in part (a), the ray is treated as parallel to the plane. Therefore, we do not compute $s_b$ via division. Instead, the distance to this boundary is considered infinite for the purpose of determining the next event. So, we set $s_{b} = \\infty$.\n\n3. Determine the final streaming distance $s$.\nThe streaming distance is the minimum of the collision and boundary distances:\n$$\ns = \\min(s_{c}, s_{b}) = \\min\\left(\\frac{\\ln(5)}{50}\\,\\mathrm{m}, \\infty\\right) = \\frac{\\ln(5)}{50}\\,\\mathrm{m}\n$$\nThe neutron will have a collision within the cell before it reaches the boundary.\n\nFinally, we compute the numerical value and round to six significant figures:\n$$\ns = \\frac{\\ln(5)}{50} \\approx 0.03218875824... \\,\\mathrm{m}\n$$\nRounding to six significant figures gives:\n$$\ns \\approx 0.0321888\\,\\mathrm{m}\n$$",
            "answer": "$$\n\\boxed{0.0321888}\n$$"
        },
        {
            "introduction": "Building upon the geometric calculation of distance-to-boundary, this exercise explores the implementation of the simplest physical boundary condition: a vacuum. You will analyze the competition between two possible events for a particle—collision within the medium versus leakage from the system. This practice  provides a concrete example of how the probabilistic nature of particle transport, governed by the exponential free-path distribution, is combined with deterministic geometry to decide a particle's fate.",
            "id": "4216085",
            "problem": "Consider a one-dimensional slab geometry with spatial coordinate $x \\in [0,H]$. Both boundaries at $x=0$ and $x=H$ are vacuum boundaries, meaning that any particle that reaches a boundary leaves the system. A single neutral particle is born at position $x_0 \\in (0,H)$ with direction cosine $\\mu \\in (0,1)$ relative to the $+x$ axis. The medium is homogeneous with constant total macroscopic cross section $\\Sigma_t > 0$, and all interactions are purely absorbing (that is, any collision terminates the particle history). In a Monte Carlo (MC) transport simulation under these conditions, the free-flight distance $S$ to the next collision is an exponentially distributed random variable with survival probability $\\mathbb{P}(S > s) = \\exp(-\\Sigma_t s)$ for $s \\geq 0$. Define the random variable $D_{\\text{leak}}$ to be the distance the particle travels from its starting position to vacuum leakage at $x=H$, with the convention that if a collision occurs before reaching $x=H$, then $D_{\\text{leak}} = 0$.\n\nUsing only the fundamental definition of the exponential free-path distribution and the vacuum boundary condition, derive a closed-form expression for the expected distance to vacuum leakage, $\\mathbb{E}[D_{\\text{leak}}]$, in terms of $\\Sigma_t$, $x_0$, $\\mu$, and $H$. Express your final answer as a closed-form analytic expression in these symbols. No numerical evaluation is required, and no rounding is needed.",
            "solution": "The objective is to find the expected value of the random variable $D_{\\text{leak}}$, which represents the distance a particle travels before leaking through the boundary at $x=H$.\n\nFirst, we determine the deterministic distance the particle must travel to reach the boundary. The particle starts at $x_0$ and moves with direction cosine $\\mu$ relative to the $+x$ axis. Its position after a path length $s$ is $x(s) = x_0 + \\mu s$. The distance to the boundary at $x=H$, denoted $s_H$, is found by setting $x(s_H) = H$:\n$$H = x_0 + \\mu s_H \\implies s_H = \\frac{H - x_0}{\\mu}$$\nSince $x_0 < H$ and $\\mu > 0$, this distance $s_H$ is positive.\n\nThe particle's journey ends in one of two mutually exclusive events:\n1.  **Leakage**: The particle travels the full distance $s_H$ without a collision and leaks. This occurs if the sampled free-flight distance, $S$, is greater than $s_H$.\n2.  **Collision**: The particle collides before reaching the boundary. This occurs if $S \\le s_H$.\n\nThe problem defines the random variable $D_{\\text{leak}}$ based on these outcomes:\n$$D_{\\text{leak}} = \\begin{cases} s_H & \\text{if } S > s_H \\text{ (leakage)} \\\\ 0 & \\text{if } S \\le s_H \\text{ (collision before leakage)} \\end{cases}$$\n\nThe expected value of a random variable is the sum of each possible value multiplied by its probability. In this case, we can write:\n$$\\mathbb{E}[D_{\\text{leak}}] = (s_H) \\cdot \\mathbb{P}(S > s_H) + (0) \\cdot \\mathbb{P}(S \\le s_H)$$\nThis simplifies to:\n$$\\mathbb{E}[D_{\\text{leak}}] = s_H \\cdot \\mathbb{P}(S > s_H)$$\n\nThe probability that the particle travels a distance greater than $s_H$ without a collision is given by the survival function of the exponential distribution:\n$$\\mathbb{P}(S > s_H) = \\exp(-\\Sigma_t s_H)$$\n\nSubstituting this probability and the expression for $s_H$ into the expectation formula gives our final result:\n$$\\mathbb{E}[D_{\\text{leak}}] = s_H \\cdot \\exp(-\\Sigma_t s_H) = \\left(\\frac{H - x_0}{\\mu}\\right) \\exp\\left(-\\Sigma_t \\frac{H - x_0}{\\mu}\\right)$$\nThis is the closed-form expression for the expected distance to vacuum leakage.",
            "answer": "$$\\boxed{\\frac{H - x_0}{\\mu} \\exp\\left(-\\Sigma_t \\frac{H - x_0}{\\mu}\\right)}$$"
        },
        {
            "introduction": "We now advance from simple leakage to a more complex and physically interesting scenario: the albedo boundary condition, where a particle may be reflected back into the domain. This exercise  delves into the stochastic modeling of such an interaction, requiring you to derive the probability distribution for the number of reflections a particle undergoes before it is ultimately absorbed. Understanding this process is key to accurately simulating interfaces between different materials or between a reactor core and its reflector.",
            "id": "4216119",
            "problem": "Consider a homogeneous, source-free region of a nuclear reactor model in which particle histories are simulated using Monte Carlo (MC) methods. The region is bounded on one side by a planar interface that enforces a constant-albedo boundary condition. Specifically, upon each encounter with the boundary, a particle is reflected with probability $\\alpha$ and absorbed with probability $1-\\alpha$, where $0<\\alpha<1$. Assume that successive boundary interactions are statistically independent and that the reflection/absorption probabilities are invariant with respect to angle, energy, and history.\n\nA single particle begins immediately adjacent to the boundary and moves toward it such that a boundary interaction is certain to occur. Let $K$ denote the total number of boundary reflections undergone by the particle before the first absorption at the boundary. Using only first principles of probability (independence of trials and conservation of probability), and without invoking prepackaged distribution formulas by name, derive the probability mass function $p_{K}(k)$ for $k\\in\\{0,1,2,\\dots\\}$ and then compute the expectation $\\mathbb{E}[K]$ as a closed-form analytic expression in terms of $\\alpha$.\n\nExpress your final answer for $\\mathbb{E}[K]$ as a single closed-form expression. No rounding is required, and no units are to be included in the final expression.",
            "solution": "The problem requires deriving the probability mass function (PMF) for $K$, the number of reflections before absorption, and its expectation, $\\mathbb{E}[K]$. The particle undergoes a series of independent boundary interactions, with a reflection probability of $\\alpha$ and an absorption probability of $1-\\alpha$.\n\nFirst, we derive the PMF, $p_K(k) = P(K=k)$, for $k \\in \\{0, 1, 2, \\dots\\}$. The event $\\{K=k\\}$ means the particle is reflected $k$ times and then absorbed on the $(k+1)$-th interaction.\n\n-   For $k=0$, no reflections occur. The particle is absorbed on its first encounter. The probability is:\n    $$p_K(0) = P(\\text{absorption}) = 1-\\alpha$$\n-   For $k=1$, the particle is reflected once, then absorbed. Since the events are independent, the probability is:\n    $$p_K(1) = P(\\text{reflection}) \\times P(\\text{absorption}) = \\alpha (1-\\alpha)$$\n-   In general, for the event $\\{K=k\\}$ to occur, there must be a sequence of $k$ independent reflections, followed by one absorption. The probability is:\n    $$p_K(k) = \\underbrace{\\alpha \\cdot \\alpha \\cdots \\alpha}_{k \\text{ times}} \\cdot (1-\\alpha) = \\alpha^k (1-\\alpha)$$\nThis is the PMF for a geometric distribution defined over the non-negative integers.\n\nNext, we compute the expectation $\\mathbb{E}[K]$ using the definition for a discrete random variable:\n$$\\mathbb{E}[K] = \\sum_{k=0}^{\\infty} k \\cdot p_K(k) = \\sum_{k=0}^{\\infty} k \\alpha^k (1-\\alpha)$$\nWe can factor out the constant term $(1-\\alpha)$:\n$$\\mathbb{E}[K] = (1-\\alpha) \\sum_{k=0}^{\\infty} k \\alpha^k$$\nThe $k=0$ term is zero, so the sum can start from $k=1$:\n$$\\mathbb{E}[K] = (1-\\alpha) \\sum_{k=1}^{\\infty} k \\alpha^k$$\nThe sum $S = \\sum_{k=1}^{\\infty} k \\alpha^k$ is a standard result related to the geometric series. Consider the formula for a geometric series, valid for $|\\alpha| < 1$:\n$$G(\\alpha) = \\sum_{k=0}^{\\infty} \\alpha^k = \\frac{1}{1-\\alpha}$$\nDifferentiating with respect to $\\alpha$ gives:\n$$\\frac{dG}{d\\alpha} = \\sum_{k=1}^{\\infty} k \\alpha^{k-1} = \\frac{1}{(1-\\alpha)^2}$$\nMultiplying by $\\alpha$ yields the sum we need:\n$$S = \\alpha \\sum_{k=1}^{\\infty} k \\alpha^{k-1} = \\sum_{k=1}^{\\infty} k \\alpha^k = \\frac{\\alpha}{(1-\\alpha)^2}$$\nFinally, we substitute this back into the expression for the expectation:\n$$\\mathbb{E}[K] = (1-\\alpha) \\cdot S = (1-\\alpha) \\left( \\frac{\\alpha}{(1-\\alpha)^2} \\right)$$\nSimplifying the expression gives the final result:\n$$\\mathbb{E}[K] = \\frac{\\alpha}{1-\\alpha}$$",
            "answer": "$$\n\\boxed{\\frac{\\alpha}{1-\\alpha}}\n$$"
        }
    ]
}