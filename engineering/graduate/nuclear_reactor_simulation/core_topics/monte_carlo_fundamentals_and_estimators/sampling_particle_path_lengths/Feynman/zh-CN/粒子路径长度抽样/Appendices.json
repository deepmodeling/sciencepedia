{
    "hands_on_practices": [
        {
            "introduction": "在蒙特卡罗模拟中，粒子的“生命”由一系列直线飞行和离散事件组成。最基本的判断是确定粒子在当前材料区域内发生碰撞，还是先到达边界。这个练习  将引导你从第一性原理出发，推导粒子穿过一段距离而不发生碰撞并到达边界的概率。掌握这一推导过程将加深你对指数衰减定律的理解，这是粒子输运追踪算法的基石。",
            "id": "4247018",
            "problem": "在一个蒙特卡洛（MC）中子输运模拟中，一个中性粒子在单一、均匀的材料区域内被追踪。在该区域内各处，宏观总截面为常数，等于 $\\Sigma_{t}$（单位为长度的倒数）。考虑沿粒子直线飞行方向测量的一维路径坐标 $s \\geq 0$。沿 $s$ 的碰撞过程被建模为一个常数率为每单位长度 $\\Sigma_{t}$ 的泊松点过程，因此在任何长度为 $s$ 的区间内，碰撞次数是一个均值为 $\\Sigma_{t} s$ 的泊松随机变量。粒子从一个内部点出发，其沿飞行方向到最近材料边界的已知直线距离表示为 $d_{\\text{surf}} > 0$。沿该射线遇到的第一个事件必然是与材料发生碰撞或穿过边界。\n\n从泊松过程模型及其对首次碰撞自由程长度分布的推论出发，推导第一个事件是边界穿越而非碰撞的条件概率，并以 $\\Sigma_{t}$ 和 $d_{\\text{surf}}$ 表示为单个闭式解析表达式。最终结果只用 $\\Sigma_{t}$ 和 $d_{\\text{surf}}$ 表示。不需要数值近似，最终表达式中不应包含单位。",
            "solution": "问题陈述经评估是科学上合理、提法明确的，并包含了获得唯一且有意义解所需的所有必要信息。它代表了中性粒子输运理论和蒙特卡洛模拟方法中的一个基本概念。\n\n问题的核心在于确定两个互斥事件中哪一个先发生的概率：粒子-介质相互作用（碰撞）或粒子穿过材料边界。粒子在碰撞前行进的距离是一个随机变量，而沿粒子飞行路径到边界的距离是一个固定的已知值。\n\n设 $S$ 为代表粒子从其出发点到第一次碰撞所行进的径迹长度的随机变量。问题陈述指出，碰撞过程是一个常数率为每单位长度 $\\Sigma_{t}$ 的泊松点过程。该模型的一个直接且基本的推论是，到第一个事件（碰撞）的距离 $S$ 是一个呈指数分布的随机变量。\n\n对于在总宏观截面为 $\\Sigma_{t}$ 的均匀介质中行进的粒子，其径迹长度 $S$ 的概率密度函数（PDF），记为 $f_S(s)$，由下式给出：\n$$f_S(s) = \\Sigma_{t} \\exp(-\\Sigma_{t} s), \\quad \\text{for } s \\geq 0$$\n此函数描述了在特定径迹长度 $s$ 处发生碰撞的概率密度。\n\n为了求出粒子行进一定距离而*不*发生碰撞的概率，我们需要生存函数，它是累积分布函数（CDF）的补。CDF，$F_S(s) = P(S \\leq s)$，是在距离 $s$ 或之前发生碰撞的概率。它通过将PDF从 $0$ 积分到 $s$ 来计算：\n$$F_S(s) = \\int_{0}^{s} f_S(s') ds' = \\int_{0}^{s} \\Sigma_{t} \\exp(-\\Sigma_{t} s') ds'$$\n计算该积分可得：\n$$F_S(s) = [-\\exp(-\\Sigma_{t} s')]_{0}^{s} = -\\exp(-\\Sigma_{t} s) - (-\\exp(0)) = 1 - \\exp(-\\Sigma_{t} s)$$\n\n生存函数 $R(s) = P(S > s)$ 给出了粒子在首次碰撞前行进距离大于 $s$ 的概率。它的计算方法如下：\n$$R(s) = P(S > s) = 1 - F_S(s) = 1 - (1 - \\exp(-\\Sigma_{t} s)) = \\exp(-\\Sigma_{t} s)$$\n\n问题为粒子指定了两种可能的“第一事件”：\n1. 在材料内部发生碰撞。\n2. 穿过材料区域的边界。\n\n沿粒子飞行方向到最近边界的距离是一个确定性值，给定为 $d_{\\text{surf}}$。\n\n当且仅当随机确定的到第一次碰撞的径迹长度 $S$ 大于到边界的固定距离 $d_{\\text{surf}}$ 时，边界穿越才会是第一个事件。因此，第一个事件是边界穿越的概率等同于粒子在行进距离 $d_{\\text{surf}}$ 内未发生碰撞而存活的概率。\n\n我们被要求求出 $P(\\text{first event is boundary crossing})$。这可以表示为：\n$$P(\\text{first event is boundary crossing}) = P(S > d_{\\text{surf}})$$\n使用上面推导出的生存函数 $R(s)$，我们可以通过设置 $s = d_{\\text{surf}}$ 来评估这个概率：\n$$P(S > d_{\\text{surf}}) = R(d_{\\text{surf}}) = \\exp(-\\Sigma_{t} d_{\\text{surf}})$$\n\n该表达式表示在给定粒子的起始位置、方向和材料属性的情况下，粒子到达边界的条件概率。它是蒙特卡洛程序中粒子追踪算法的基石。该算法通常从分布 $f_S(s)$ 中抽样一个径迹长度 $s$，并将其与 $d_{\\text{surf}}$ 进行比较。如果 $s > d_{\\text{surf}}$，粒子被移动到边界；否则，它被移动到距离为 $s$ 的碰撞位置。前一种情况的概率就是我们所推导出的结果。",
            "answer": "$$\\boxed{\\exp(-\\Sigma_{t} d_{\\text{surf}})}$$"
        },
        {
            "introduction": "虽然基本的自由程抽样假设介质是无限的，但实际的模拟总是在有限的几何结构中进行。在某些情况下，我们需要在已知碰撞必然发生在粒子离开某个特定单元之前的情况下，对路径长度进行抽样。这需要我们将标准的逆变换采样方法应用于截断的概率分布。通过这个练习 ，你将掌握在有界区域内进行路径长度抽样的关键技能，并推导和应用适用于截断指数分布的抽样公式。",
            "id": "4247040",
            "problem": "在用于蒙特卡罗输运的核反应堆模型的均匀区域中，假设总宏观截面为常数，等于 $\\Sigma_{t}$ (单位: $\\mathrm{m}^{-1}$)。考虑一个粒子沿直线弦穿过厚度为 $s_{\\max}$ (单位: $\\mathrm{m}$) 的有限栅元。基本的指数衰减定律指出，在距离 $s$ 内未发生碰撞的存活概率为 $\\exp(-\\Sigma_{t} s)$，并且碰撞过程由一个等于 $\\Sigma_{t}$ 的恒定风险率控制。\n\n基于这些原理，完成以下任务：\n\n1. 在区间 $s \\in [0, s_{\\max}]$ 上，推导下一次碰撞距离的条件概率密度函数 $p(s \\mid s \\le s_{\\max})$，条件是碰撞发生在离开栅元之前。\n2. 使用逆变换采样法，推导从此条件分布中采样 $s$ 的方法，将 $s$ 表示为均匀分布变量 $u \\sim \\mathcal{U}(0,1)$ 的显式函数。\n3. 对于一个 $\\Sigma_{t} = 0.8\\,\\mathrm{m}^{-1}$ 且栅元厚度 $s_{\\max} = 0.35\\,\\mathrm{m}$ 的均匀区域，如果抽取一个均匀随机数 $u = 0.37$，使用您推导的采样公式计算采样得到的自由程长度 $s$。用米作单位表示最终数值答案，并四舍五入到四位有效数字。\n\n最终答案必须是一个实数。不要在最终的方框答案中包含单位。",
            "solution": "问题陈述具有科学依据，提法恰当，客观，并包含足够的信息以获得唯一解。它基于粒子输运理论和蒙特卡罗方法的标准原理，特别是指数衰减定律和用于截断分布的逆变换采样法。因此，该问题被认为是有效的。\n\n解答按要求分为三部分展开。\n\n### 第1部分：条件概率密度函数(PDF)的推导\n\n问题陈述指出，粒子在行进距离 $s$ 后未发生碰撞的存活概率由指数衰减定律给出，$P(\\text{存活}) = \\exp(-\\Sigma_{t} s)$。这是路径长度随机变量 $S$ 的互补累积分布函数(CCDF)。\n$$\nP(S > s) = \\exp(-\\Sigma_{t} s)\n$$\n累积分布函数(CDF) $F(s)$ 给出了在距离 $s$ 或之前发生碰撞的概率，其表达式为：\n$$\nF(s) = P(S \\le s) = 1 - P(S > s) = 1 - \\exp(-\\Sigma_{t} s)\n$$\n概率密度函数(PDF) $f(s)$ 是CDF关于 $s$ 的导数。这表示在无限介质中到下一次碰撞的路径长度的概率分布。\n$$\nf(s) = \\frac{dF(s)}{ds} = \\frac{d}{ds} \\left(1 - \\exp(-\\Sigma_{t} s)\\right) = \\Sigma_{t} \\exp(-\\Sigma_{t} s), \\quad \\text{对于 } s \\ge 0\n$$\n这是速率参数为 $\\Sigma_{t}$ 的指数分布。\n\n我们需要求的是在碰撞发生于厚度为 $s_{\\max}$ 的栅元内的条件下，碰撞距离的条件PDF $p(s \\mid s \\le s_{\\max})$。根据条件概率的定义，对于 $s \\in [0, s_{\\max}]$：\n$$\np(s \\mid s \\le s_{\\max}) = \\frac{f(s)}{P(s \\le s_{\\max})}\n$$\n概率 $P(s \\le s_{\\max})$ 是在距离 $s_{\\max}$ 或之前发生碰撞的概率，它由CDF在 $s_{\\max}$ 处的值给出：\n$$\nP(s \\le s_{\\max}) = F(s_{\\max}) = 1 - \\exp(-\\Sigma_{t} s_{\\max})\n$$\n将 $f(s)$ 和 $P(s \\le s_{\\max})$ 代入条件PDF的表达式中，我们得到：\n$$\np(s \\mid s \\le s_{\\max}) = \\frac{\\Sigma_{t} \\exp(-\\Sigma_{t} s)}{1 - \\exp(-\\Sigma_{t} s_{\\max})} \\quad \\text{对于 } s \\in [0, s_{\\max}]\n$$\n这是在区间 $[0, s_{\\max}]$ 上的截断指数分布的PDF。我们可以通过验证其在其定义域上的积分等于1来证明这是一个有效的PDF：\n$$\n\\int_{0}^{s_{\\max}} p(s \\mid s \\le s_{\\max}) ds = \\int_{0}^{s_{\\max}} \\frac{\\Sigma_{t} \\exp(-\\Sigma_{t} s)}{1 - \\exp(-\\Sigma_{t} s_{\\max})} ds\n$$\n$$\n= \\frac{1}{1 - \\exp(-\\Sigma_{t} s_{\\max})} \\left[ -\\exp(-\\Sigma_{t} s) \\right]_{0}^{s_{\\max}}\n$$\n$$\n= \\frac{1}{1 - \\exp(-\\Sigma_{t} s_{\\max})} \\left( -\\exp(-\\Sigma_{t} s_{\\max}) - (-\\exp(0)) \\right)\n$$\n$$\n= \\frac{1 - \\exp(-\\Sigma_{t} s_{\\max})}{1 - \\exp(-\\Sigma_{t} s_{\\max})} = 1\n$$\n归一化是正确的。\n\n### 第2部分：逆变换采样公式的推导\n\n逆变换采样法需要条件累积分布函数，我们称之为 $F_{c}(s)$。它是通过将条件PDF $p(t \\mid t \\le s_{\\max})$ 从 $0$ 积分到 $s$ 得到的，其中 $s \\in [0, s_{\\max}]$。\n$$\nF_{c}(s) = \\int_{0}^{s} p(t \\mid t \\le s_{\\max}) dt = \\int_{0}^{s} \\frac{\\Sigma_{t} \\exp(-\\Sigma_{t} t)}{1 - \\exp(-\\Sigma_{t} s_{\\max})} dt\n$$\n$$\nF_{c}(s) = \\frac{1}{1 - \\exp(-\\Sigma_{t} s_{\\max})} \\int_{0}^{s} \\Sigma_{t} \\exp(-\\Sigma_{t} t) dt\n$$\n$$\nF_{c}(s) = \\frac{1}{1 - \\exp(-\\Sigma_{t} s_{\\max})} \\left[ -\\exp(-\\Sigma_{t} t) \\right]_{0}^{s}\n$$\n$$\nF_{c}(s) = \\frac{1 - \\exp(-\\Sigma_{t} s)}{1 - \\exp(-\\Sigma_{t} s_{\\max})}\n$$\n为了从此分布中采样路径长度 $s$，我们将条件CDF设为等于一个均匀随机变量 $u \\sim \\mathcal{U}(0,1)$，然后求解 $s$：\n$$\nu = F_{c}(s) = \\frac{1 - \\exp(-\\Sigma_{t} s)}{1 - \\exp(-\\Sigma_{t} s_{\\max})}\n$$\n我们现在重新整理方程以分离出 $s$：\n$$\nu \\left(1 - \\exp(-\\Sigma_{t} s_{\\max})\\right) = 1 - \\exp(-\\Sigma_{t} s)\n$$\n$$\n\\exp(-\\Sigma_{t} s) = 1 - u \\left(1 - \\exp(-\\Sigma_{t} s_{\\max})\\right)\n$$\n对两边取自然对数：\n$$\n-\\Sigma_{t} s = \\ln\\left(1 - u \\left(1 - \\exp(-\\Sigma_{t} s_{\\max})\\right)\\right)\n$$\n最后，解出 $s$ 得到采样公式：\n$$\ns = -\\frac{1}{\\Sigma_{t}} \\ln\\left(1 - u \\left(1 - \\exp(-\\Sigma_{t} s_{\\max})\\right)\\right)\n$$\n\n### 第3部分：数值计算\n\n给定以下数值：\n总宏观截面：$\\Sigma_{t} = 0.8\\,\\mathrm{m}^{-1}$\n栅元厚度：$s_{\\max} = 0.35\\,\\mathrm{m}$\n均匀随机数：$u = 0.37$\n\n我们将这些值代入第2部分推导出的采样公式中。\n首先，计算指数函数的参数：\n$$\n\\Sigma_{t} s_{\\max} = (0.8)(0.35) = 0.28\n$$\n接下来，计算项 $(1 - \\exp(-\\Sigma_{t} s_{\\max}))$：\n$$\n1 - \\exp(-0.28) \\approx 1 - 0.7557836 = 0.2442164\n$$\n现在，将此结果和 $u$ 代入对数的参数中：\n$$\n1 - u \\left(1 - \\exp(-\\Sigma_{t} s_{\\max})\\right) = 1 - 0.37 \\times (0.2442164)\n$$\n$$\n= 1 - 0.090360068 = 0.909639932\n$$\n对此结果取自然对数：\n$$\n\\ln(0.909639932) \\approx -0.0946955\n$$\n最后，计算 $s$：\n$$\ns = -\\frac{1}{0.8} \\ln(0.909639932) \\approx -1.25 \\times (-0.0946955)\n$$\n$$\ns \\approx 0.118369375\n$$\n问题要求将答案四舍五入到四位有效数字。\n$$\ns \\approx 0.1184\\,\\mathrm{m}\n$$",
            "answer": "$$\n\\boxed{0.1184}\n$$"
        },
        {
            "introduction": "前面的练习都假设在具有恒定截面 $\\Sigma_t$ 的均匀介质中。然而，真实的反应堆堆芯是高度非均匀的，其宏观截面 $\\Sigma_t$ 会随空间位置变化。在这种更普遍的情况下，简单的解析抽样公式不再适用，我们必须求解光程厚度的基本积分方程 $\\tau(s) = -\\ln\\xi$。这个高级练习  深入探讨了在非均匀介质中进行路径长度抽样所需的稳健数值方法，要求你分析和比较不同的求根方案，这是理解和开发高保真蒙特卡罗输运程序的核心。",
            "id": "4246978",
            "problem": "在一个非均质核反应堆堆芯的蒙特卡洛（MC）中子输运模拟中，考虑一个位于位置 $\\boldsymbol{r}_0 \\in \\mathbb{R}^3$、运动方向为 $\\boldsymbol{\\Omega}$ 的粒子，该粒子在总宏观截面为 $\\Sigma_t(\\boldsymbol{r}) \\ge 0$ 的介质中行进。沿长度为 $s \\ge 0$ 的直线路径的光学厚度由以下线积分定义：\n$$\n\\tau(s) \\equiv \\int_{0}^{s} \\Sigma_t\\big(\\boldsymbol{r}_0 + s' \\boldsymbol{\\Omega}\\big)\\, \\mathrm{d}s' .\n$$\n通过抽取一个均匀随机数 $\\xi \\sim \\mathcal{U}(0,1)$ 并求解以下方程来抽样自由程长度：\n$$\n\\tau(s) \\;=\\; -\\ln \\xi .\n$$\n假设几何结构由不重叠的凸多面体区域（例如，轴对齐的长方体或一般的凸多面体）组成，并且在每个区域内，函数 $\\Sigma_t(\\boldsymbol{r})$ 是可测且局部有界的，其沿任何有限直线射线段的线积分都有明确定义。射线穿过一系列区域，将路径分割成一系列长度有限的连续段，这些段终止于材料交界面或计算域的边界。\n\n要求您选择一个能最正确且最稳健地规定求解 $\\tau(s) = -\\ln \\xi$ 的数值求根方案的算法描述，该方案满足：\n- 仅使用沿 $\\boldsymbol{\\Omega}$ 方向由几何导出的路径段边界，为未知数 $s$ 构建一个有效的括号区间，并且\n- 以足够的精度计算沿射线段所需的 $\\Sigma_t$ 的线积分，\n- 并且采用一种其收敛性由 $\\tau(s)$ 的单调性保证的求根方法。\n\n以下哪个选项最正确且最稳健？\n\nA. 从任意初始猜测值 $s^{(0)}>0$ 开始，对 $f(s) \\equiv \\tau(s) + \\ln \\xi = 0$ 应用纯牛顿迭代法，使用的导数为 $f'(s)=\\dfrac{\\mathrm{d}\\Sigma_t(\\boldsymbol{r}_0 + s\\boldsymbol{\\Omega})}{\\mathrm{d}s}$。不强制执行任何括号限定。如果牛顿步长超出了当前材料区域，则接受该步长并继续；因为导数使用了 $\\Sigma_t$ 的梯度，所以即使跨越不连续点，收敛也很快。\n\nB. 从 $\\boldsymbol{r}_0$ 沿 $\\boldsymbol{\\Omega}$ 执行确定性射线追踪，生成由几何交界面界定的、以 $j$ 为索引的连续路径段，每个路径段长度为 $\\ell_j>0$。对于每个路径段，通过一种对 $\\Sigma_t$ 的局部变化足够精确的求积法（例如，如果 $\\Sigma_t$ 在段内变化，则使用自适应高斯求积法；如果 $\\Sigma_t$ 是常数，则进行精确计算）来计算路径段的光学深度\n$$\nI_j \\;\\equiv\\; \\int_{0}^{\\ell_j} \\Sigma_t\\big(\\boldsymbol{r}_j^{\\text{start}} + s' \\boldsymbol{\\Omega}\\big)\\,\\mathrm{d}s'\n$$\n累加部分和 $\\tau_k \\equiv \\sum_{j=1}^{k} I_j$，直到找到第一个满足 $\\tau_{k^\\star-1} \\le -\\ln \\xi \\le \\tau_{k^\\star}$ 的索引 $k^\\star$（约定 $\\tau_0 \\equiv 0$）。这将根限定在第 $k^\\star$ 段的起点和终点之间，即 $s_L \\equiv \\sum_{j=1}^{k^\\star-1} \\ell_j$ 和 $s_U \\equiv \\sum_{j=1}^{k^\\star} \\ell_j$。然后通过求解以下方程的根来求解从第 $k^\\star$ 段起点开始的局部剩余距离 $\\delta \\in [0,\\ell_{k^\\star}]$：\n$$\ng(\\delta) \\;\\equiv\\; \\int_{0}^{\\delta} \\Sigma_t\\big(\\boldsymbol{r}_{k^\\star}^{\\text{start}} + s' \\boldsymbol{\\Omega}\\big)\\,\\mathrm{d}s' \\;-\\; \\big((- \\ln \\xi) - \\tau_{k^\\star-1}\\big) \\;=\\; 0 ,\n$$\n使用安全保护的牛顿法：在第 $n$ 次迭代中，计算牛顿建议值\n$$\n\\delta_{\\text{N}}^{(n+1)} \\;=\\; \\delta^{(n)} - \\frac{g(\\delta^{(n)})}{\\Sigma_t\\big(\\boldsymbol{r}_{k^\\star}^{\\text{start}} + \\delta^{(n)} \\boldsymbol{\\Omega}\\big)} ,\n$$\n并且仅当该值位于 $[0,\\ell_{k^\\star}]$ 区间内且能减小 $|g|$ 时才接受它；否则，对当前 $\\delta$ 的括号区间采取二分法步长。当 $|g(\\delta)| \\le \\varepsilon_\\tau$ 或括号区间宽度 $\\le \\varepsilon_s$ 时终止，其中 $\\varepsilon_\\tau>0$ 和 $\\varepsilon_s>0$ 是用户设定的容差。最终的路径长度为 $s^\\star = s_L + \\delta$。\n\nC. 不使用几何信息，预先估计射线路径上的全局界限 $\\Sigma_{\\min}$ 和 $\\Sigma_{\\max}$，并通过 $s_L \\equiv (-\\ln \\xi)/\\Sigma_{\\max}$ 和 $s_U \\equiv (-\\ln \\xi)/\\Sigma_{\\min}$ 来限定括号区间。在 $[s_L,s_U]$ 上，使用二分法求解 $f(s) \\equiv \\tau(s) + \\ln \\xi = 0$，其中每次 $f(s)$ 的计算都使用具有预定子区间数量的固定分块梯形法则，且该数量与 $\\Sigma_t$ 的局部变化无关。\n\nD. 完全用抽样一个优势函数自由程 $s' \\equiv (-\\ln \\xi)/\\Sigma_{\\text{maj}}$ 来取代求根过程，其中 $\\Sigma_{\\text{maj}} \\ge \\Sigma_t(\\boldsymbol{r})$ 是一个在所有地方都成立的全局优势函数，然后以概率 $\\Sigma_t(\\boldsymbol{r}_0 + s'\\boldsymbol{\\Omega})/\\Sigma_{\\text{maj}}$ 接受在 $s'$ 处的碰撞，否则重复该过程（δ追踪法）。这避免了括号限定和积分计算，同时仍然能抽样出正确的路径长度，因此它是在非均质几何中求解 $\\tau(s) = -\\ln \\xi$ 的最稳健方法。\n\n选择唯一的最佳选项。",
            "solution": "问题要求找到最正确且最稳健的数值算法，用于在具有非均质介质的蒙特卡洛模拟中，根据方程 $\\tau(s) = -\\ln \\xi$ 求解粒子自由程长度 $s$，其中 $\\tau(s)$ 是光学厚度。该算法必须满足三个特定标准：\n1.  使用由几何导出的路径段边界为 $s$ 构建一个括号区间。\n2.  精确计算总宏观截面 $\\Sigma_t(\\boldsymbol{r})$ 的线积分。\n3.  使用一种保证收敛的求根方法。\n\n需要求解的方程是 $f(s) = \\tau(s) + \\ln \\xi = 0$，其中光学厚度由下式给出：\n$$\n\\tau(s) = \\int_{0}^{s} \\Sigma_t\\big(\\boldsymbol{r}_0 + s' \\boldsymbol{\\Omega}\\big)\\, \\mathrm{d}s'\n$$\n随机变量 $\\xi$ 从均匀分布 $\\mathcal{U}(0,1)$ 中抽取，因此 $-\\ln \\xi$ 是一个正实数。函数 $\\tau(s)$ 的导数非负，即 $\\tau'(s) = \\Sigma_t(\\boldsymbol{r}_0 + s \\boldsymbol{\\Omega}) \\ge 0$，这意味着 $\\tau(s)$ 是 $s$ 的一个非减函数。这种单调性是确保唯一根存在（假设粒子路径在完美真空中的长度不是无限的）并允许使用稳健求根算法的关键属性。\n\n现在，我们根据问题的要求来评估每个选项。\n\nA. **从任意初始猜测值 $s^{(0)}>0$ 开始，对 $f(s) \\equiv \\tau(s) + \\ln \\xi = 0$ 应用纯牛顿迭代法，使用的导数为 $f'(s)=\\dfrac{\\mathrm{d}\\Sigma_t(\\boldsymbol{r}_0 + s\\boldsymbol{\\Omega})}{\\mathrm{d}s}$。不强制执行任何括号限定。如果牛顿步长超出了当前材料区域，则接受该步长并继续；因为导数使用了 $\\Sigma_t$ 的梯度，所以即使跨越不连续点，收敛也很快。**\n\n该选项有几个根本性的缺陷。\n- **错误的导数**：根据微积分基本定理，$f(s) = \\tau(s) + \\ln \\xi$ 关于 $s$ 的导数是 $f'(s) = \\tau'(s) = \\Sigma_t(\\boldsymbol{r}_0 + s \\boldsymbol{\\Omega})$。该选项错误地陈述导数为 $\\dfrac{\\mathrm{d}\\Sigma_t(\\boldsymbol{r}_0 + s\\boldsymbol{\\Omega})}{\\mathrm{d}s}$。这实际上是 $\\tau(s)$ 的二阶导数。\n- **缺乏稳健性**：没有安全保护或括号限定的纯牛顿法不是全局收敛的。宏观截面 $\\Sigma_t(\\boldsymbol{r})$ 在材料交界面上是不连续的。这些不连续性意味着导数 $f'(s)$ 本身也是不连续的。在这种不连续点上应用牛顿法是不稳定的，可能导致发散、振荡或走向非物理的（负）路径长度。关于跨越不连续点收敛很快的断言是错误的；这恰恰是该方法最可能失败的地方。\n- **未能满足标准**：该算法没有使用几何信息来形成括号区间（标准1），其收敛性也无法保证（标准3）。盲目接受跨越材料边界的步长的过程是导致灾难性失败的根源。\n\n因此，选项A是**错误的**。\n\nB. **执行确定性射线追踪... 累加部分和... 将根限定在括号内... 求解局部剩余距离... 使用安全保护的牛顿法...**\n\n该选项描述了一个复杂的多阶段算法，直接解决了问题的复杂性。\n1.  **射线追踪与括号限定**：该算法首先通过确定性地追踪粒子路径射线 $\\boldsymbol{r}_0 + s \\boldsymbol{\\Omega}$ 穿过几何模型来开始。这会识别出一系列以 $j$ 为索引的路径段，每个段的长度为 $\\ell_j$。这是现代蒙特卡洛程序中的一个标准过程。\n2.  **括号区间识别**：然后，它计算每个路径段的光学深度 $I_j$，并将它们累加成部分和 $\\tau_k = \\sum_{j=1}^{k} I_j$。通过检查条件 $\\tau_{k^\\star-1} \\le -\\ln \\xi \\le \\tau_{k^\\star}$（约定 $\\tau_0 \\equiv 0$），它识别出碰撞必须发生的特定段 $k^\\star$。这稳健地为总路径长度 $s$ 建立了一个紧密的括号区间，即 $s \\in [\\sum_{j=1}^{k^\\star-1} \\ell_j, \\sum_{j=1}^{k^\\star} \\ell_j]$。这完美地满足了标准1。\n3.  **局部求根问题**：问题随后被重新构造为在该段 $k^\\star$ 内寻找剩余距离 $\\delta$。方程变为求解 $g(\\delta) = 0$ 且 $\\delta \\in [0, \\ell_{k^\\star}]$，其中 $g(\\delta) = \\int_{0}^{\\delta} \\Sigma_t\\big(\\boldsymbol{r}_{k^\\star}^{\\text{start}} + s' \\boldsymbol{\\Omega}\\big)\\,\\mathrm{d}s' - C$，而 $C = (-\\ln \\xi) - \\tau_{k^\\star-1}$ 是需要穿越的剩余光学深度。\n4.  **积分精度**：该选项正确地指明了段积分 $I_j$ 应通过适合 $\\Sigma_t$ 局部行为的方法来计算，例如，如果它变化则使用自适应求积法，如果它是常数则进行解析计算。这满足了标准2。\n5.  **稳健的求根方法**：为了求解 $\\delta$，它提出了一种安全保护的牛顿法。牛顿迭代使用了正确的导数 $g'(\\delta) = \\Sigma_t(\\boldsymbol{r}_{k^\\star}^{\\text{start}} + \\delta \\boldsymbol{\\Omega})$。“安全保护”——如果牛顿步长没有效果或超出了已知的括号区间 $[0, \\ell_{k^\\star}]$，则退回到二分法步长——将牛顿法的快速局部收敛性与二分法的保证收敛性结合起来。由于函数 $g(\\delta)$ 在括号区间内是单调的，因此收敛得到保证。这满足了标准3。\n\n该算法是一个全面、正确且稳健的解决方案，代表了该领域的最佳实践。\n\n因此，选项B是**正确的**。\n\nC. **不使用几何信息，预先估计射线路径上的全局界限 $\\Sigma_{\\min}$ 和 $\\Sigma_{\\max}$，并通过 $s_L \\equiv (-\\ln \\xi)/\\Sigma_{\\max}$ 和 $s_U \\equiv (-\\ln \\xi)/\\Sigma_{\\min}$ 来限定括号区间。在 $[s_L,s_U]$ 上，使用二分法求解 $f(s) \\equiv \\tau(s) + \\ln \\xi = 0$，其中每次 $f(s)$ 的计算都使用具有预定子区间数量的固定分块梯形法则...**\n\n该选项在数值上是幼稚且不切实际的。\n- **括号限定**：括号区间是从不等式 $\\Sigma_{\\min} s \\le \\tau(s) \\le \\Sigma_{\\max} s$ 推导出来的。虽然这在数学上是合理的，但在没有进行任何形式的射线追踪的情况下，找到紧密的全局界限 $\\Sigma_{\\min}$ 和 $\\Sigma_{\\max}$ 通常是不可能的，或者会导致非常宽松的界限（例如，如果可能存在真空区，$\\Sigma_{\\min} \\approx 0$），使得上界 $s_U$ 过大，方法效率低下。这种方法明确地未能满足标准1，该标准要求使用由几何导出的路径段边界。\n- **积分方法**：对于一个分段定义且可能在材料交界面有大跳跃的函数 $\\Sigma_t(\\boldsymbol{r}(s))$，使用“具有预定子区间数量的固定分块梯形法则”是一个糟糕的选择。除非使用极大量的子区间，否则这种方法的精度会非常低，从而使其效率极低。这未能满足要求足够精度的标准2。\n- **求根方法**：虽然二分法保证收敛（满足标准3），但其效率严重依赖于初始括号区间的质量和函数评估的成本。在该方案中，这两者都很差。\n\n因此，选项C是**错误的**。\n\nD. **完全用抽样一个优势函数自由程 $s' \\equiv (-\\ln \\xi)/\\Sigma_{\\text{maj}}$ 来取代求根过程，其中 $\\Sigma_{\\text{maj}} \\ge \\Sigma_t(\\boldsymbol{r})$ 是一个在所有地方都成立的全局优势函数，然后以概率 $\\Sigma_t(\\boldsymbol{r}_0 + s'\\boldsymbol{\\Omega})/\\Sigma_{\\text{maj}}$ 接受在 $s'$ 处的碰撞，否则重复该过程（δ追踪法）。这避免了括号限定和积分计算，同时仍然能抽样出正确的路径长度，因此它是在非均质几何中求解 $\\tau(s) = -\\ln \\xi$ 的最稳健方法。**\n\n该选项描述了δ追踪法（或称为Woodcock/优势函数核方法）。这是一种在复杂几何中抽样路径长度的有效且通常高效的算法。然而，它是通过求根来求解方程 $\\tau(s) = -\\ln \\xi$ 的一种*替代*方法。问题明确要求一个“用于求解 $\\tau(s) = -\\ln \\xi$ 的数值求根方案”，该方案需遵循与括号限定和积分相关的特定约束。δ追踪法是一种接受-拒绝技术，它巧妙地绕过了计算积分 $\\tau(s)$ 和求根的需要。它没有构建括号区间，没有计算 $\\Sigma_t$ 的积分，也没有使用问题陈述中所意指的求根器。因此，虽然它是一种有效的输运算法，但它并不是关于如何通过求根实现直接反演方法的具体问题的答案。\n\n因此，作为对所提问题的回答，选项D是**错误的**。\n\n总之，选项B是唯一一个描述了正确、稳健且高效的数值求根方案，并满足问题陈述中所有指定标准的选项。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}