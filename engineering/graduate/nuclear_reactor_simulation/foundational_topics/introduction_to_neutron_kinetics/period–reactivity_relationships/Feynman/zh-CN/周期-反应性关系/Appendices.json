{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在培养一项核心计算技能：对“反应性-周期”关系式（即“固有时方程”）进行数值求解。我们将构建一个稳健的算法，用以在给定反应性 $\\rho$ 的情况下，精确确定反应堆周期 $T$。这在反应堆动态预测中是一项基础任务，通过该实践，你将深化对这两个关键参数之间非线性关系的理解，并掌握数值方法在反应堆分析中的重要应用。",
            "id": "4240819",
            "problem": "给定科学上合理的缓发中子数据和一个均匀点堆模型的瞬发中子代时间。任务是构建一个数值程序，在假设反应性恒定的情况下，可靠地反演周期-反应性关系，以获得作为指定反应性 $\\rho$（临界附近）函数的反应堆周期 $T$。出发点是中子布居数 $n(t)$ 和缓发中子先驱核浓度 $C_i(t)$ 的点堆动力学方程，以及反应堆周期的定义和标准的缓发中子群数据。你不能使用任何闭式反演；相反，必须构建一个算法，通过稳健的数值求根方法来求解从 $T$到 $\\rho$ 的隐式映射。\n\n使用的基本原理：\n- 反应性恒定且无外部源的点堆动力学方程：\n  - $\\dfrac{d n(t)}{d t} = \\dfrac{\\rho - \\beta}{\\Lambda} n(t) + \\sum_{i=1}^m \\lambda_i C_i(t)$\n  - $\\dfrac{d C_i(t)}{d t} = \\dfrac{\\beta_i}{\\Lambda} n(t) - \\lambda_i C_i(t)$\n- 假设中子布居数呈指数行为 $n(t) \\propto e^{\\omega t}$，通过 $\\omega = 1/T$ 定义增长率 $\\omega$ 和反应堆周期 $T$。\n\n你的程序必须：\n1. 对于一组指定的缓发中子参数 $\\{\\beta_i,\\lambda_i\\}$、瞬发中子代时间 $\\Lambda$ 和目标反应性 $\\rho$（以小数形式表示，不带百分号），构建一个关于 $T$ 的函数，该函数表示模型反应性与目标 $\\rho$ 之间的残差，然后找到求解残差方程 $g(T)=0$ 的主反应堆周期 $T$。\n2. 选择临界点附近物理相关的主分支：当 $\\rho \\to 0^+$ 时，$T \\to +\\infty$；当 $\\rho \\to 0^-$ 时，$T \\to -\\infty$。你的求解器必须避免在 $T = -1/\\lambda_i$ 处的奇点，并且必须在一个与这些极点分离的单调区间内将根括起来。\n3. 通过返回无限周期来处理精确临界情况 $\\rho = 0$。\n4. 将所有返回的周期以秒为单位表示，并四舍五入到六位小数。\n\n测试套件的输入数据：\n- $T$ 和 $\\Lambda$ 的单位为秒，$\\lambda_i$ 的单位为秒$^{-1}$。反应性 $\\rho$ 是无量纲的小数形式。\n- 测试套件A（六群铀-235热中子数据，代表Keepin类型的值），$\\Lambda = 1\\times 10^{-5}\\ \\mathrm{s}$：\n  - $\\beta$ 值：$\\{0.000215, 0.001424, 0.001274, 0.002568, 0.000748, 0.000273\\}$\n  - $\\lambda$ 值：$\\{0.0124, 0.0305, 0.111, 0.301, 1.14, 3.01\\}$\n  - 目标反应性 $\\rho$：$\\{0, 0.0005, -0.0005, 0.002\\}$\n- 测试套件B（与六群数据相同，但瞬发中子代时间不同），$\\Lambda = 5\\times 10^{-5}\\ \\mathrm{s}$：\n  - $\\beta$ 值：$\\{0.000215, 0.001424, 0.001274, 0.002568, 0.000748, 0.000273\\}$\n  - $\\lambda$ 值：$\\{0.0124, 0.0305, 0.111, 0.301, 1.14, 3.01\\}$\n  - 目标反应性 $\\rho$：$\\{0.0005\\}$\n- 测试套件C（二群聚合数据），$\\Lambda = 1.5\\times 10^{-5}\\ \\mathrm{s}$：\n  - $\\beta$ 值：$\\{0.0015, 0.0050\\}$\n  - $\\lambda$ 值：$\\{0.08, 0.30\\}$\n  - 目标反应性 $\\rho$：$\\{-0.0001\\}$\n\n算法约束：\n- 实现一种基于区间的求根方法，该方法保证能在给定 $\\rho$（临界附近）的主分支上收敛。建议在残差变号且函数单调的区间上使用有保障的二分法。\n- 通过构建完全位于单调区间内的括号来明确避免在 $T = -1/\\lambda_i$ 处的奇点：对于 $\\rho>0$ 是 $(0,+\\infty)$，对于 $\\rho<0$ 是 $(-\\infty, -1/\\lambda_{\\min})$，其中 $\\lambda_{\\min}$ 是最小的衰变常数。\n\n输出规格：\n- 你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个元素对应于上面列出的一个测试用例，并且必须是一个以秒为单位、四舍五入到六位小数的浮点数。如果周期是无限的，则将其打印为字符串 \"inf\"。例如：\"[1.234567,-12.345679,inf]\"。\n\n无需用户输入；所有参数都嵌入在程序中。",
            "solution": "该问题是有效的，因为它科学上基于成熟的核反应堆点堆动力学理论，数学上是适定的，并且以客观、明确的方式呈现。所有必要的数据和约束条件都已提供，以便于数值上表述和解决问题。\n\n问题的核心在于周期-反应性关系的反演，该关系源自反应性 $\\rho$ 恒定且无外部源的反应堆的点堆动力学方程。中子布居数 $n(t)$ 和第 $i$ 群缓发中子先驱核浓度 $C_i(t)$ 的控制方程是：\n$$\n\\frac{d n(t)}{d t} = \\frac{\\rho - \\beta}{\\Lambda} n(t) + \\sum_{i=1}^m \\lambda_i C_i(t)\n$$\n$$\n\\frac{d C_i(t)}{d t} = \\frac{\\beta_i}{\\Lambda} n(t) - \\lambda_i C_i(t)\n$$\n这里，$\\Lambda$ 是瞬发中子代时间，$\\beta_i$ 是第 $i$ 群的缓发中子份额，$\\beta = \\sum_{i=1}^m \\beta_i$ 是总缓发中子份额，$\\lambda_i$ 是第 $i$ 个先驱核群的衰变常数， $m$ 是缓发中子群的数量。\n\n当反应性 $\\rho$ 恒定时，中子布居数和先驱核浓度表现出渐近指数行为，$n(t) = n_0 e^{\\omega t}$ 和 $C_i(t) = C_{i0} e^{\\omega t}$，其中 $\\omega$ 是逆反应堆周期，$\\omega = 1/T$。将这些形式代入先驱核方程，得到渐近状态的代数关系：\n$$\n\\omega C_{i0} e^{\\omega t} = \\frac{\\beta_i}{\\Lambda} n_0 e^{\\omega t} - \\lambda_i C_{i0} e^{\\omega t}\n$$\n解出 $C_{i0}$：\n$$\nC_{i0} = \\frac{\\beta_i n_0}{\\Lambda(\\omega + \\lambda_i)} \\quad \\implies \\quad C_i(t) = \\frac{\\beta_i n(t)}{\\Lambda(\\omega + \\lambda_i)}\n$$\n将此结果以及 $\\frac{d n(t)}{d t} = \\omega n(t)$ 代入中子布居数方程，我们得到：\n$$\n\\omega n(t) = \\frac{\\rho - \\beta}{\\Lambda} n(t) + \\sum_{i=1}^m \\lambda_i \\left( \\frac{\\beta_i n(t)}{\\Lambda(\\omega + \\lambda_i)} \\right)\n$$\n两边除以 $n(t)$ 并乘以 $\\Lambda$，得到著名的联系反应性与逆周期 $\\omega$ 的逆小时方程：\n$$\n\\Lambda \\omega = \\rho - \\beta + \\sum_{i=1}^m \\frac{\\lambda_i \\beta_i}{\\omega + \\lambda_i}\n$$\n整理以将 $\\rho$ 表示为 $\\omega$ 的函数，得到：\n$$\n\\rho(\\omega) = \\Lambda \\omega + \\sum_{i=1}^m \\beta_i - \\sum_{i=1}^m \\frac{\\lambda_i \\beta_i}{\\omega + \\lambda_i} = \\Lambda \\omega + \\sum_{i=1}^m \\frac{\\omega \\beta_i}{\\omega + \\lambda_i}\n$$\n问题是用反应堆周期 $T$ 来表述的，所以我们代入 $\\omega = 1/T$：\n$$\n\\rho(T) = \\frac{\\Lambda}{T} + \\sum_{i=1}^m \\frac{\\beta_i / T}{1/T + \\lambda_i} = \\frac{\\Lambda}{T} + \\sum_{i=1}^m \\frac{\\beta_i}{1 + \\lambda_i T}\n$$\n我们的任务是找到对应于给定目标反应性 $\\rho_{target}$ 的周期 $T$。这是一个关于残差函数 $g(T)$ 的求根问题：\n$$\ng(T) = \\rho(T) - \\rho_{target} = \\left( \\frac{\\Lambda}{T} + \\sum_{i=1}^m \\frac{\\beta_i}{1 + \\lambda_i T} \\right) - \\rho_{target} = 0\n$$\n我们将使用稳健的区间法来数值求解这个方程，正如要求的那样。区间的选择取决于 $\\rho_{target}$ 的符号。函数 $\\rho(T)$ 在每个缓发中子群的 $T_i = -1/\\lambda_i$ 处有极点。对于接近临界的状态，物理相关的解的主分支是具有最大代数值 $T$ 的那个。\n\n情况1：临界反应堆（$\\rho_{target} = 0$）\n当反应性为零时，反应堆精确临界。在点堆动力学模型中，这对应于一个稳定的中子布居数，等效于无限周期。这可以从 $\\rho(T)$ 的方程中看出，当 $|T| \\to \\infty$ 时，$\\rho(T) \\to 0$。算法将此作为特殊情况处理，并返回无限周期。\n\n情况2：超临界反应堆（$\\rho_{target} > 0$）\n对于正反应性，中子布居数增长，对应于正周期 $T > 0$。在区间 $T \\in (0, \\infty)$ 内，函数 $\\rho(T)$ 是连续的并且单调递减，从 $T \\to 0^+$ 时的 $\\rho(T) \\to +\\infty$ 降至 $T \\to +\\infty$ 时的 $\\rho(T) \\to 0$。因此，对于任何 $\\rho_{target} > 0$，存在一个唯一的正根 $T$。我们可以建立一个搜索区间 $[a, b]$，其中 $a$ 是一个小的正数（例如，$10^{-9}\\ \\mathrm{s}$），$b$ 是一个大的正数（例如，$10^9\\ \\mathrm{s}$）。对于这样的区间，$g(a) = \\rho(a) - \\rho_{target} > 0$ 且 $g(b) = \\rho(b) - \\rho_{target} < 0$，保证了区间内存在一个根。\n\n情况3：次临界反应堆（$\\rho_{target} < 0$）\n对于负反应性，中子布居数衰减，对应于负周期 $T < 0$。$T$ 的主根位于区间 $(-\\infty, -1/\\lambda_{min})$ 内，其中 $\\lambda_{min}$ 是所有衰变常数 $\\lambda_i$ 中最小的一个。在此区间内，$\\rho(T)$ 是连续的并且单调递减，从 $T \\to -\\infty$ 时的 $\\rho(T) \\to 0$ 降至 $T$ 从下方接近极点 $-1/\\lambda_{min}$ 时的 $\\rho(T) \\to -\\infty$。对于任何 $\\rho_{target} < 0$，此区间内存在一个唯一的根。可以构建一个合适的搜索区间 $[a, b]$，其中 $a$ 是一个大数量级的负数（例如，$-10^9\\ \\mathrm{s}$），$b$ 是一个略小于第一个极点的值（例如，$-1/\\lambda_{min} - 10^{-9}\\ \\mathrm{s}$）。对于这个区间，$g(a) \\approx -\\rho_{target} > 0$ 且 $g(b)$ 是一个大的负值，因此 $g(b) < 0$，这也保证了存在一个根。\n\n实现将使用 `scipy.optimize.brentq` 函数，这是一个高效且稳健的基于区间的求根器。它结合了二分法、割线法和逆二次插值法来寻找根，满足问题的算法约束。程序将首先根据 $\\rho_{target}$ 的符号确定合适的区间，然后调用 `brentq` 找到周期 $T$。结果将按要求格式化为六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves for the reactor period T given delayed neutron data and reactivity rho.\n    \"\"\"\n\n    # Define the six-group U-235 thermal data\n    betas_6group = np.array([0.000215, 0.001424, 0.001274, 0.002568, 0.000748, 0.000273])\n    lambdas_6group = np.array([0.0124, 0.0305, 0.111, 0.301, 1.14, 3.01])\n\n    # Define the two-group aggregated data\n    betas_2group = np.array([0.0015, 0.0050])\n    lambdas_2group = np.array([0.08, 0.30])\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (Lambda, betas, lambdas, rho)\n    test_cases = [\n        # Test Suite A\n        (1e-5, betas_6group, lambdas_6group, 0.0),\n        (1e-5, betas_6group, lambdas_6group, 0.0005),\n        (1e-5, betas_6group, lambdas_6group, -0.0005),\n        (1e-5, betas_6group, lambdas_6group, 0.0020),\n        # Test Suite B\n        (5e-5, betas_6group, lambdas_6group, 0.0005),\n        # Test Suite C\n        (1.5e-5, betas_2group, lambdas_2group, -0.0001),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Lambda, betas, lambdas, rho_target = case\n\n        # Handle the special case for critical reactivity\n        if rho_target == 0.0:\n            results.append(\"inf\")\n            continue\n\n        # Define the residual function g(T) = rho(T) - rho_target = 0\n        # rho(T) = (Lambda / T) + sum(beta_i / (1 + lambda_i * T))\n        def residual_function(T):\n            if T == 0:\n                # Based on the limit T->0+, rho(T) is positive infinity.\n                # This should only be approached from one side in the root-finder.\n                return np.inf if T > 0 else -np.inf\n            \n            rho_T = (Lambda / T) + np.sum(betas / (1.0 + lambdas * T))\n            return rho_T - rho_target\n\n        try:\n            # Set up the bracket and solve based on the sign of rho_target\n            if rho_target > 0:\n                # For positive reactivity, the period T is positive.\n                # Bracket the root in the interval (0, infinity).\n                # Lower bound a: small positive T, giving large positive rho(T)\n                # Upper bound b: large positive T, giving rho(T) near 0\n                a = 1e-9  # Small positive number\n                b = 1e9   # Large positive number\n                period = brentq(residual_function, a, b, xtol=1e-12, rtol=1e-12)\n\n            else:  # rho_target  0\n                # For negative reactivity, the principal period T is negative.\n                # The root is in (-infinity, -1/lambda_min).\n                lambda_min = np.min(lambdas)\n                pole = -1.0 / lambda_min\n                \n                # Lower bound a: large negative T, giving rho(T) near 0\n                # Upper bound b: a value just below the first pole, giving large negative rho(T)\n                a = -1e9  # Large-magnitude negative number\n                # T approaches the pole from the left.\n                b = pole - 1e-9 \n\n                period = brentq(residual_function, a, b, xtol=1e-12, rtol=1e-12)\n            \n            results.append(f\"{period:.6f}\")\n\n        except ValueError:\n            # This can happen if the bracket is not valid (f(a)*f(b) >= 0)\n            # or if the search interval is non-finite.\n            # This code's bracketing strategy is robust and should not fail.\n            results.append(\"solver_error\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了“周期-反应性”关系的基础上，本实践将模拟一个真实的实验场景。我们将采用两种独立的方法——瞬发跳变和渐近周期——来推断阶跃反应性引入的幅度。此练习旨在阐明，如何利用反应性变化后出现的不同物理现象进行交叉验证，这在实验反应堆物理学中是至关重要的一环。",
            "id": "4240813",
            "problem": "一位研究人员正在使用点动力学方程（PKE）来表征一个热中子研究反应堆，以研究周期-反应性关系。在 $t=0$ 时刻阶跃插入反应性后，立即测量得到一个瞬发跳跃因子 $J$，该因子是反应性插入后与插入前反应堆功率的比值。随后，在缓发中子瞬态稳定后，反应堆呈现出指数形式的功率演化，测得的渐近反应堆周期为 $T$（单位：秒），因此功率 $P(t)$ 的行为符合 $P(t) \\propto \\exp(\\omega t)$，其中 $\\omega = 1/T$。反应堆可能经历正或负的反应性变化，因此周期 $T$ 也可能为正或为负。目标是利用逆动力学推理，从瞬发跳跃 $J$ 和渐近周期 $T$ 两方面确定阶跃反应性插入的量值 $ \\Delta \\rho $，然后使用从PKE推导出的换算时关系式来验证这两个独立推论的一致性。\n\n您的程序必须使用反应堆动力学的第一性原理来实现以下内容，不得预先假设本说明中给出的任何目标公式：\n\n- 使用包含 $m$ 组缓发中子先驱核群的点动力学方程基本形式，该方程由中子布居数 $n(t)$ 和先驱核浓度 $C_i(t)$（$i=1,\\dots,m$）定义，并伴随一个在 $ t=0 $ 时施加的恒定阶跃反应性 $ \\Delta \\rho $。缓发中子数据由各组的缓发中子份额 $ \\beta_i $（无量纲）和衰变常数 $ \\lambda_i $（单位：$\\text{s}^{-1}$）指定。有效缓发中子份额为 $ \\beta_{\\text{eff}} = \\sum_{i=1}^{m} \\beta_i $。瞬发中子代时间为 $ \\Lambda $（单位：$\\text{s}$）。\n- 从测量的瞬发跳跃因子 $ J $ 推断 $ \\Delta \\rho $。\n- 当功率呈渐近指数增长时，通过使用PKE所蕴含的换算时关系式，从测量的渐近周期 $ T $ 推断 $ \\Delta \\rho $。\n- 如果两个推断出的反应性之间的绝对差不大于指定的容差 $ \\varepsilon $（无量纲），则宣布这两个推论是一致的。使用 $ \\varepsilon = 5 \\times 10^{-6} $。\n\n使用以下代表热中子 $^{235}\\text{U}$ 系统的科学上真实且广泛使用的六组缓发中子数据：\n- 组份额 $ \\beta_i $：$ [0.000215,\\,0.001424,\\,0.001274,\\,0.002568,\\,0.000748,\\,0.000273] $，因此 $ \\beta_{\\text{eff}} = 0.006502 $。\n- 组衰变常数 $ \\lambda_i $（单位：$\\text{s}^{-1}$）：$ [0.0124,\\,0.0305,\\,0.111,\\,0.301,\\,1.14,\\,3.01] $。\n- 瞬发中子代时间 $ \\Lambda = 1.0 \\times 10^{-4} \\text{ s} $。\n\n您的程序必须处理以下测试集，这些测试集包含测量的瞬发跳跃因子 $J$ 和渐近周期 $T$（单位：秒），每个测试集代表不同的工况：\n1. 正的次瞬发临界阶跃：$ J = 1.858 $ 且 $ T = 7.14 \\text{ s} $。\n2. 从下方接近瞬发临界：$ J = 32.15 $ 且 $ T = 0.2817 \\text{ s} $。\n3. 负阶跃（功率下降）：$ J = 0.866 $ 且 $ T = -84.88 \\text{ s} $。\n4. 非常小的正阶跃（周期斜率近乎为零）：$ J = 1.00154 $ 且 $ T = 8488.0 \\text{ s} $。\n\n对于每个测试用例，您的程序必须：\n- 使用适用于阶跃插入的逆动力学逻辑，从瞬发跳跃 $ J $ 计算 $ \\Delta \\rho_{\\text{jump}} $。\n- 使用测量的 $ \\omega = 1/T $ 以及指定的 $ \\beta_i $、$ \\lambda_i $ 和 $ \\Lambda $，通过评估换算时关系式来计算 $ \\Delta \\rho_{\\text{inhour}} $。\n- 确定一个布尔一致性标志 $ \\text{cons} $，如果 $ |\\Delta \\rho_{\\text{jump}} - \\Delta \\rho_{\\text{inhour}}| \\le \\varepsilon $，则其值为 $ \\text{True} $，否则为 $ \\text{False} $。\n\n物理单位和输出要求：\n- 周期 $ T $ 必须以秒为单位，符号表示增长（$ T  0 $）或衰减（$ T  0 $）。\n- 反应性 $ \\Delta \\rho $ 必须以无量纲小数形式报告（不要使用百分号）。\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的列表，该列表括在方括号中，每个元素是对应测试用例的形如 $ [\\Delta \\rho_{\\text{jump}},\\,\\Delta \\rho_{\\text{inhour}},\\,\\text{cons}] $ 的子列表，顺序与上文相同。例如，输出必须看起来像 $ [[a_1,b_1,c_1],[a_2,b_2,c_2],\\dots] $，其中 $ a_i $ 和 $ b_i $ 为实际数值，$ c_i $ 为布尔值。",
            "solution": "该问题被评估为有效。它在科学上基于成熟的核反应堆动力学理论，问题阐述清晰，数据充分且一致，并以客观、正式的语言表达。解决方案将首先从第一性原理推导必要的物理关系，然后将其应用于所提供的数据。\n\n反应堆的行为由点动力学方程（PKE）控制，该方程描述了中子布居数 $n(t)$ 和 $m$ 组缓发中子先驱核浓度 $C_i(t)$：\n$$\n\\frac{dn(t)}{dt} = \\frac{\\rho(t) - \\beta_{\\text{eff}}}{\\Lambda} n(t) + \\sum_{i=1}^{m} \\lambda_i C_i(t)\n$$\n$$\n\\frac{dC_i(t)}{dt} = \\frac{\\beta_i}{\\Lambda} n(t) - \\lambda_i C_i(t), \\quad \\text{for } i=1, \\dots, m\n$$\n其中 $\\rho(t)$ 是反应性，$\\Lambda$ 是瞬发中子代时间，$\\beta_i$ 是第 $i$ 组的缓发中子份额，$\\lambda_i$ 是相应的衰变常数，$\\beta_{\\text{eff}} = \\sum_{i=1}^{m} \\beta_i$ 是总有效缓发中子份额。问题指定在时间 $t=0$ 时进行一次幅度为 $\\Delta\\rho$ 的阶跃反应性插入，因此对于 $t \\ge 0$，$\\rho(t) = \\Delta\\rho$。假设在 $t  0$ 时反应堆处于临界稳态，此时 $\\rho(t0)=0$，$\\frac{dn}{dt}=0$，且 $\\frac{dC_i}{dt}=0$。\n\n**1. 从瞬发跳跃推断反应性 ($ \\Delta \\rho_{\\text{jump}} $)**\n\n瞬发跳跃是反应性插入后中子布居数的快速变化。这种变化发生在由 $\\Lambda$ 决定的时间尺度上，该尺度远小于先驱核衰变的时间尺度 $1/\\lambda_i$。因此，先驱核浓度 $C_i(t)$ 不会瞬时改变：$C_i(0^+) = C_i(0^-)$。\n\n对于 $t=0^-$ 时的初始临界状态，我们有 $\\frac{dn}{dt}=0$，$\\rho=0$，且 $n(t) = n_0$。中子布居数的PKE变为：\n$$\n0 = \\frac{0 - \\beta_{\\text{eff}}}{\\Lambda} n_0 + \\sum_{i=1}^{m} \\lambda_i C_i(0^-)\n$$\n这意味着初始的缓发中子源项为 $\\sum_{i=1}^{m} \\lambda_i C_i(0^-) = \\frac{\\beta_{\\text{eff}}}{\\Lambda} n_0$。\n\n在 $t=0^+$ 阶跃插入后，反应性为 $\\Delta\\rho$，中子布居数为 $n(0^+)$，而缓发中子源项保持不变，即 $\\sum \\lambda_i C_i(0^+) = \\sum \\lambda_i C_i(0^-) = \\frac{\\beta_{\\text{eff}}}{\\Lambda} n_0$。在 $t=0^+$ 时的中子布居数方程为：\n$$\n\\left. \\frac{dn}{dt} \\right|_{t=0^+} = \\frac{\\Delta\\rho - \\beta_{\\text{eff}}}{\\Lambda} n(0^+) + \\frac{\\beta_{\\text{eff}}}{\\Lambda} n_0\n$$\n瞬发跳跃近似假设瞬发中子寿命 $\\Lambda$ 极小（$\\Lambda \\to 0$）。为使时间导数 $\\frac{dn}{dt}$ 保持有限，方程 $\\Lambda \\frac{dn}{dt} = (\\Delta\\rho - \\beta_{\\text{eff}})n(t) + \\Lambda\\sum \\lambda_i C_i(t)$ 的右侧必须为零。将此应用于 $t=0^+$（此时 $n(t) = n(0^+)$ 且源项为 $\\frac{\\beta_{\\text{eff}}}{\\Lambda}n_0$）：\n$$\n0 \\approx (\\Delta\\rho - \\beta_{\\text{eff}}) n(0^+) + \\beta_{\\text{eff}} n_0\n$$\n对比值 $n(0^+)/n_0$（即瞬发跳跃因子 $J$）进行整理：\n$$\n(\\beta_{\\text{eff}} - \\Delta\\rho) n(0^+) = \\beta_{\\text{eff}} n_0 \\implies J = \\frac{n(0^+)}{n_0} = \\frac{\\beta_{\\text{eff}}}{\\beta_{\\text{eff}} - \\Delta\\rho}\n$$\n为了从测量的跳跃因子 $J$ 求出反应性 $\\Delta\\rho$，我们对此关系进行逆运算：\n$$\nJ(\\beta_{\\text{eff}} - \\Delta\\rho) = \\beta_{\\text{eff}} \\implies J\\beta_{\\text{eff}} - J\\Delta\\rho = \\beta_{\\text{eff}} \\implies J\\Delta\\rho = J\\beta_{\\text{eff}} - \\beta_{\\text{eff}}\n$$\n$$\n\\Delta\\rho_{\\text{jump}} = \\frac{\\beta_{\\text{eff}}(J - 1)}{J}\n$$\n该公式将用于计算第一个反应性推断值。\n\n**2. 从渐近周期推断反应性 ($ \\Delta \\rho_{\\text{inhour}} $)**\n\n在瞬发跳跃和初始瞬态衰减后，反应堆功率以及所有状态变量都以一个稳定的渐近周期 $T$ 演化。我们可以写出 $n(t) = n_a e^{\\omega t}$ 和 $C_i(t) = C_{i,a} e^{\\omega t}$，其中 $\\omega = 1/T$ 是逆周期或稳定根。将这些形式代入 $\\rho(t) = \\Delta\\rho$ 的PKE中：\n\n从第 $i$ 组的先驱核方程出发：\n$$\n\\frac{d}{dt}(C_{i,a} e^{\\omega t}) = \\frac{\\beta_i}{\\Lambda} (n_a e^{\\omega t}) - \\lambda_i (C_{i,a} e^{\\omega t})\n$$\n$$\n\\omega C_{i,a} e^{\\omega t} = \\frac{\\beta_i}{\\Lambda} n_a e^{\\omega t} - \\lambda_i C_{i,a} e^{\\omega t}\n$$\n除以 $e^{\\omega t}$ 并求解 $C_{i,a}$，得到先驱核幅值与中子布居数幅值之间的渐近关系：\n$$\nC_{i,a}(\\omega + \\lambda_i) = \\frac{\\beta_i}{\\Lambda} n_a \\implies C_{i,a} = \\frac{\\beta_i n_a}{\\Lambda(\\omega + \\lambda_i)}\n$$\n接下来，将 $n(t)$ 和 $C_i(t)$ 的渐近形式代入中子布居数方程：\n$$\n\\frac{d}{dt}(n_a e^{\\omega t}) = \\frac{\\Delta\\rho - \\beta_{\\text{eff}}}{\\Lambda} (n_a e^{\\omega t}) + \\sum_{i=1}^{m} \\lambda_i (C_{i,a} e^{\\omega t})\n$$\n$$\n\\omega n_a e^{\\omega t} = \\frac{\\Delta\\rho - \\beta_{\\text{eff}}}{\\Lambda} n_a e^{\\omega t} + e^{\\omega t} \\sum_{i=1}^{m} \\lambda_i C_{i,a}\n$$\n除以 $n_a e^{\\omega t}$ 并代入 $C_{i,a}$ 的表达式：\n$$\n\\omega = \\frac{\\Delta\\rho - \\beta_{\\text{eff}}}{\\Lambda} + \\frac{1}{n_a} \\sum_{i=1}^{m} \\lambda_i \\left( \\frac{\\beta_i n_a}{\\Lambda(\\omega + \\lambda_i)} \\right)\n$$\n$$\n\\omega = \\frac{\\Delta\\rho - \\beta_{\\text{eff}}}{\\Lambda} + \\frac{1}{\\Lambda} \\sum_{i=1}^{m} \\frac{\\lambda_i \\beta_i}{\\omega + \\lambda_i}\n$$\n这个方程被称为换算时方程，它将反应性 $\\Delta\\rho$ 与稳定逆周期 $\\omega$ 联系起来。我们求解 $\\Delta\\rho$：\n$$\n\\Delta\\rho = \\Lambda\\omega + \\beta_{\\text{eff}} - \\sum_{i=1}^{m} \\frac{\\lambda_i \\beta_i}{\\omega + \\lambda_i} = \\Lambda\\omega + \\sum_{i=1}^{m} \\left( \\beta_i - \\frac{\\lambda_i \\beta_i}{\\omega + \\lambda_i} \\right)\n$$\n$$\n\\Delta\\rho = \\Lambda\\omega + \\sum_{i=1}^{m} \\beta_i \\left( \\frac{\\omega + \\lambda_i - \\lambda_i}{\\omega + \\lambda_i} \\right) = \\Lambda\\omega + \\sum_{i=1}^{m} \\frac{\\omega \\beta_i}{\\omega + \\lambda_i}\n$$\n第二个反应性推断的最终形式是：\n$$\n\\Delta\\rho_{\\text{inhour}} = \\Lambda\\omega + \\omega \\sum_{i=1}^{m} \\frac{\\beta_i}{\\omega + \\lambda_i}\n$$\n\n**3. 计算流程**\n\n程序将实现这两个推导出的公式。对于由一对测量值 $(J, T)$ 定义的每个测试用例，执行以下步骤：\n- 计算有效缓发中子份额 $\\beta_{\\text{eff}}$，其值为给定各组份额 $\\beta_i$ 的总和。\n- 使用公式 $\\Delta\\rho_{\\text{jump}} = \\beta_{\\text{eff}} (J-1)/J$ 计算 $\\Delta\\rho_{\\text{jump}}$。\n- 计算逆周期 $\\omega$，其值为 $\\omega = 1/T$。\n- 使用上面推导的换算时方程公式计算 $\\Delta\\rho_{\\text{inhour}}$，对所有 $m=6$ 组缓发中子进行求和。\n- 对比两个反应性值。如果 $|\\Delta\\rho_{\\text{jump}} - \\Delta\\rho_{\\text{inhour}}| \\le \\varepsilon$（其中容差为 $\\varepsilon = 5 \\times 10^{-6}$），则一致性标志 $\\text{cons}$ 设为 $\\text{True}$，否则设为 $\\text{False}$。\n- 对每个测试用例，存储三元组 $[\\Delta\\rho_{\\text{jump}}, \\Delta\\rho_{\\text{inhour}}, \\text{cons}]$。\n最后，按要求格式化并打印结果列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the reactor kinetics problem by inferring reactivity from prompt jump and\n    asymptotic period, and then checks for consistency.\n    \"\"\"\n    \n    # Define the delayed neutron data for 235U thermal fission.\n    # Group fractions beta_i (dimensionless)\n    beta_i = np.array([0.000215, 0.001424, 0.001274, 0.002568, 0.000748, 0.000273])\n    \n    # Group decay constants lambda_i (in s^-1)\n    lambda_i = np.array([0.0124, 0.0305, 0.111, 0.301, 1.14, 3.01])\n    \n    # Prompt neutron generation time (in s)\n    Lambda = 1.0e-4\n    \n    # Total effective delayed neutron fraction (dimensionless)\n    beta_eff = np.sum(beta_i)\n    \n    # Consistency tolerance (dimensionless)\n    epsilon = 5.0e-6\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (prompt_jump_factor_J, asymptotic_period_T_in_s)\n    test_cases = [\n        (1.858, 7.14),       # Positive subprompt-critical step\n        (32.15, 0.2817),     # Near prompt-critical from below\n        (0.866, -84.88),     # Negative step\n        (1.00154, 8488.0),   # Very small positive step\n    ]\n\n    results = []\n    for J, T in test_cases:\n        # 1. Infer reactivity from the prompt jump factor J.\n        # This uses the formula derived from the prompt jump approximation (Lambda -> 0).\n        # Delta_rho_jump = beta_eff * (J - 1) / J\n        delta_rho_jump = beta_eff * (J - 1.0) / J\n\n        # 2. Infer reactivity from the asymptotic period T.\n        # This uses the inhour equation.\n        # omega is the inverse period (in s^-1).\n        omega = 1.0 / T\n        \n        # Calculate the sum term in the inhour equation.\n        # sum_{i} (omega * beta_i / (omega + lambda_i))\n        inhour_sum_term = np.sum(omega * beta_i / (omega + lambda_i))\n        \n        # Inhour equation: Delta_rho_inhour = Lambda * omega + sum_term\n        delta_rho_inhour = Lambda * omega + inhour_sum_term\n\n        # 3. Determine consistency.\n        # The consistency flag 'cons' is True if the absolute difference is within\n        # the specified tolerance epsilon, and False otherwise.\n        is_consistent = np.abs(delta_rho_jump - delta_rho_inhour) = epsilon\n        \n        results.append([delta_rho_jump, delta_rho_inhour, is_consistent])\n\n    # Format the output string to match the required format: [[a,b,c],[d,e,f],...].\n    # str(list) introduces spaces, so we remove them for a compact representation.\n    formatted_sublists = [str(sublist).replace(\" \", \"\") for sublist in results]\n    final_output = f\"[{','.join(formatted_sublists)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "最后一项高级实践将我们的知识融会贯通，构建一个用于实验设计的综合仿真。我们将对一个控制棒刻度实验进行建模，预测其产生的反应堆周期，并引入测量不确定度模型。最终目标是确定能够使推断反应性的不确定度最小化的最优实验步长，从而展示仿真是如何直接指导并提升实体实验精度的。",
            "id": "4240828",
            "problem": "一个反应堆物理实验室计划进行一次控制棒校准序列，其中控制棒将以离散的物理距离步长移动，以产生相应的反应性变化。目标是使用第一性原理点动力学模型预测每个候选棒步长的反应堆周期，并选择一个最佳步长，以最小化由周期测量推断出的反应性的绝对不确定度。您的任务是编写一个完整、可运行的程序来实现这一模拟，该模拟基于点动力学方程和缓发中子群的物理原理。所有数学实体必须用 LaTeX 书写。\n\n本问题的基本基础是带有缓发中子先驱核的点动力学模型。中子布居数动力学由描述中子布居数和先驱核浓度的线性常微分方程组描述。这些方程与指数解的假设相结合，得出了反应性与反应堆周期之间的关系，但在本说明中未给出其显式形式。您必须从点动力学定义出发，在您的解答中推导出必要的关系。\n\n您将使用科学上合理的假设来实现以下模拟逻辑：\n\n- 使用多个缓发中子群对反应堆进行建模。对于每个群组，给定以下参数：第 $i$ 群的有效缓发中子份额，记为 $\\beta_i$，以及先驱核衰变常数 $\\lambda_i$，单位为 $\\mathrm{s}^{-1}$。设总缓发中子份额为 $\\beta = \\sum_i \\beta_i$，瞬发中子代时间为 $\\Lambda$，单位为 $\\mathrm{s}$。\n- 当控制棒移动距离 $\\Delta x$（单位为 $\\mathrm{cm}$）时，反应性增加 $\\rho = w\\, \\Delta x$，其中 $w$ 是一个恒定的棒价值斜率，单位为小数份额/厘米。所有反应性必须以小数份额处理（即，不用百分号书写）。\n- 对于给定的正反应性 $\\rho$（小于 $\\beta$），反应堆达到一个正增长率 $s$（单位为 $\\mathrm{s}^{-1}$），反应堆周期 $\\tau$（单位为 $\\mathrm{s}$）满足 $\\tau = 1/s$。由点动力学方程产生的 $\\rho$ 与 $s$ 之间的关系必须通过数值方法求解 $s$。\n- 使用一个测量模型，其中观测到的逆周期 $1/\\tau$ 是通过在持续时间为 $T_m$（单位为 $\\mathrm{s}$）的测量窗口内对 $\\ln P(t)$ 进行线性拟合来估计的。设测量开始时的初始计数率为 $C_0$，单位为 计数/秒。假设指数增长，在测量窗口期间观测到的总计数建模为\n$$\nN = \\int_0^{T_m} C_0\\, e^{t/\\tau}\\, dt = C_0\\, \\tau \\left(e^{T_m/\\tau} - 1\\right).\n$$\n假设测量的逆周期的标准差为\n$$\n\\sigma_{(1/\\tau)} = \\frac{\\gamma}{\\sqrt{N}},\n$$\n其中 $\\gamma$ 是一个无量纲的噪声参数，它包含了估计器和仪器的特性。\n- 由于 $s = 1/\\tau$ 的测量不确定度而导致的推断反应性 $\\rho$ 的不确定度，必须通过第一性原理不确定度传播方法获得，使用由点动力学方程所蕴含的 $\\rho$–$s$ 关系得出的灵敏度 $\\frac{d\\rho}{ds}$。$\\rho$ 的绝对标准差为\n$$\n\\sigma_\\rho = \\left| \\frac{d\\rho}{ds} \\right| \\; \\sigma_s,\n$$\n其中 $\\sigma_s = \\sigma_{(1/\\tau)}$。\n- 对于给定的测试用例，最佳棒步长 $\\Delta x_\\mathrm{opt}$ 是在指定范围 $[\\Delta x_{\\min}, \\Delta x_{\\max}]$ 内使 $\\sigma_\\rho$ 最小化的值，同时需满足物理约束 $0  \\rho  \\beta$。\n\n您必须实现上述模拟以处理多个测试用例。对于每个测试用例，程序必须计算最佳步长以及相应的周期和不确定度。所有答案必须以指定单位表示，并四舍五入到六位小数。\n\n单位：\n- 时间必须以 $\\mathrm{s}$ 表示。\n- 反应性必须以小数份额表示。\n- 棒步长必须以 $\\mathrm{cm}$ 表示。\n- 所有角度（如有）必须以弧度表示。本问题中不使用角度。\n\n测试套件：\n提供以下四个参数集的结果。在每种情况下，使用在最小值和最大值之间均匀分布的 $101$ 个候选步长组成的网格。如果某个候选步长产生的 $\\rho \\ge \\beta$，则必须将其排除在考虑范围之外。程序必须在有效候选者中搜索 $\\sigma_\\rho$ 的最小值。\n\n1. 热中子反应堆，典型缓发中子数据：\n   - $\\beta_i = [\\,0.000215,\\,0.001424,\\,0.001274,\\,0.002568,\\,0.000748,\\,0.000273\\,]$,\n   - $\\lambda_i = [\\,0.0124,\\,0.0305,\\,0.111,\\,0.301,\\,1.140,\\,3.010\\,]\\;\\mathrm{s}^{-1}$,\n   - $\\Lambda = 1.0\\times 10^{-5}\\;\\mathrm{s}$,\n   - $w = 1.6\\times 10^{-4}\\;\\text{每 cm}$,\n   - $\\Delta x_{\\min} = 0.2\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 25.0\\;\\mathrm{cm}$,\n   - $T_m = 30.0\\;\\mathrm{s}$, $C_0 = 2000.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n2. 快中子反应堆，缓发中子份额减少：\n   - $\\beta = 0.0021$，其中各群组份额与热中子堆情况相同，但经过缩放以使 $\\sum_i \\beta_i = \\beta$，\n   - $\\lambda_i$ 同案例1,\n   - $\\Lambda = 5.0\\times 10^{-7}\\;\\mathrm{s}$,\n   - $w = 3.2\\times 10^{-4}\\;\\text{每 cm}$,\n   - $\\Delta x_{\\min} = 0.05\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 10.0\\;\\mathrm{cm}$,\n   - $T_m = 10.0\\;\\mathrm{s}$, $C_0 = 5000.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n3. 热中子反应堆，接近瞬发临界极限的陡峭价值斜率：\n   - $\\beta_i$ 和 $\\lambda_i$ 同案例1,\n   - $\\Lambda = 1.0\\times 10^{-5}\\;\\mathrm{s}$,\n   - $w = 5.0\\times 10^{-4}\\;\\text{每 cm}$,\n   - $\\Delta x_{\\min} = 0.1\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 40.0\\;\\mathrm{cm}$,\n   - $T_m = 15.0\\;\\mathrm{s}$, $C_0 = 1500.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n4. 热中子反应堆，适用于长周期的极小价值斜率：\n   - $\\beta_i$ 和 $\\lambda_i$ 同案例1,\n   - $\\Lambda = 1.0\\times 10^{-5}\\;\\mathrm{s}$,\n   - $w = 2.0\\times 10^{-5}\\;\\text{每 cm}$,\n   - $\\Delta x_{\\min} = 0.1\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 20.0\\;\\mathrm{cm}$,\n   - $T_m = 60.0\\;\\mathrm{s}$, $C_0 = 800.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n对于每个测试用例，您的程序必须计算：\n- 最佳棒步长 $\\Delta x_{\\mathrm{opt}}$，单位 $\\mathrm{cm}$，\n- 该步长下预测的周期 $\\tau_{\\mathrm{opt}}$，单位 $\\mathrm{s}$，\n- 推断反应性中相应的绝对标准差 $\\sigma_\\rho$。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个由逗号分隔的四个子列表组成的列表，每个子列表的格式为 $[\\tau_{\\mathrm{opt}},\\,\\Delta x_{\\mathrm{opt}},\\,\\sigma_\\rho]$，并且每个数值都四舍五入到六位小数。示例格式（使用占位符值）：\n$[[0.123456,1.234567,0.000001],[...],[...],[...]]$。",
            "solution": "用户提供了一个有效的问题。\n### 第 1 步：提取给定条件\n\n问题提供了以下数据、定义、关系和约束。\n\n**模型定义：**\n- 反应堆使用带有多个缓发中子群的点动力学模型进行建模。\n- 对于每个群组 $i$：有效缓发中子份额 $\\beta_i$，先驱核衰变常数 $\\lambda_i$ ($\\mathrm{s}^{-1}$)。\n- 总缓发中子份额：$\\beta = \\sum_i \\beta_i$。\n- 瞬发中子代时间：$\\Lambda$ ($\\mathrm{s}$)。\n- 由棒移动引入的反应性：$\\rho = w \\cdot \\Delta x$，其中 $w$ 是棒价值斜率 (每 $\\mathrm{cm}$)，$\\Delta x$ 是步长 ($\\mathrm{cm}$)。\n- 反应堆周期 $\\tau$ ($\\mathrm{s}$) 和增长率 $s$ ($\\mathrm{s}^{-1}$) 通过 $\\tau = 1/s$ 相关。\n- 对于一个正反应性 $\\rho  \\beta$ 与增长率 $s$ 之间的关系源于点动力学方程，必须通过数值方法求解。\n\n**测量和不确定度模型：**\n- 测量窗口持续时间：$T_m$ ($\\mathrm{s}$)。\n- 初始计数率：$C_0$ (计数/秒)。\n- 总观测计数：$N = \\int_0^{T_m} C_0\\, e^{t/\\tau}\\, dt = C_0\\, \\tau (e^{T_m/\\tau} - 1)$。\n- 测量的逆周期的标准差：$\\sigma_{(1/\\tau)} = \\frac{\\gamma}{\\sqrt{N}}$，其中 $\\gamma$ 是一个无量纲的噪声参数。\n- 反应性的标准差通过一阶不确定度传播获得：$\\sigma_\\rho = \\left| \\frac{d\\rho}{ds} \\right| \\; \\sigma_s$，其中 $\\sigma_s = \\sigma_{(1/\\tau)}$。\n\n**优化任务：**\n- 对于给定的范围 $[\\Delta x_{\\min}, \\Delta x_{\\max}]$，找到使 $\\sigma_\\rho$ 最小化的最佳步长 $\\Delta x_\\mathrm{opt}$。\n- 搜索在一个由 $101$ 个均匀间隔的候选步长组成的网格上执行。\n- 施加物理约束：$0  \\rho  \\beta$。任何导致 $\\rho \\ge \\beta$ 的候选步长必须被排除。\n\n**测试用例1：热中子反应堆**\n- $\\beta_i = [\\,0.000215,\\,0.001424,\\,0.001274,\\,0.002568,\\,0.000748,\\,0.000273\\,]$。\n- $\\lambda_i = [\\,0.0124,\\,0.0305,\\,0.111,\\,0.301,\\,1.140,\\,3.010\\,]\\;\\mathrm{s}^{-1}$。\n- $\\Lambda = 1.0 \\times 10^{-5}\\;\\mathrm{s}$。\n- $w = 1.6 \\times 10^{-4}\\;\\text{每 cm}$。\n- $\\Delta x_{\\min} = 0.2\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 25.0\\;\\mathrm{cm}$。\n- $T_m = 30.0\\;\\mathrm{s}$, $C_0 = 2000.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n**测试用例2：快中子反应堆**\n- $\\beta = 0.0021$。群份额 $\\beta_i/\\beta$ 与案例1相同。\n- $\\lambda_i$ 同案例1。\n- $\\Lambda = 5.0 \\times 10^{-7}\\;\\mathrm{s}$。\n- $w = 3.2 \\times 10^{-4}\\;\\text{每 cm}$。\n- $\\Delta x_{\\min} = 0.05\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 10.0\\;\\mathrm{cm}$。\n- $T_m = 10.0\\;\\mathrm{s}$, $C_0 = 5000.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n**测试用例3：热中子反应堆，陡峭价值**\n- $\\beta_i$ 和 $\\lambda_i$ 同案例1。\n- $\\Lambda = 1.0 \\times 10^{-5}\\;\\mathrm{s}$。\n- $w = 5.0 \\times 10^{-4}\\;\\text{每 cm}$。\n- $\\Delta x_{\\min} = 0.1\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 40.0\\;\\mathrm{cm}$。\n- $T_m = 15.0\\;\\mathrm{s}$, $C_0 = 1500.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n**测试用例4：热中子反应堆，小价值**\n- $\\beta_i$ 和 $\\lambda_i$ 同案例1。\n- $\\Lambda = 1.0 \\times 10^{-5}\\;\\mathrm{s}$。\n- $w = 2.0 \\times 10^{-5}\\;\\text{每 cm}$。\n- $\\Delta x_{\\min} = 0.1\\;\\mathrm{cm}$, $\\Delta x_{\\max} = 20.0\\;\\mathrm{cm}$。\n- $T_m = 60.0\\;\\mathrm{s}$, $C_0 = 800.0\\;\\text{计数/s}$, $\\gamma = 1.0$。\n\n### 第 2 步：使用提取的给定条件进行验证\n\n根据验证标准对问题进行评估：\n- **科学依据：** 该问题牢固地基于核反应堆动力学的标准点动力学模型，这是反应堆物理学的基石。为此次模拟所定义的测量和不确定度模型是合理的且定义明确的。\n- **适定性：** 该问题要求在一个指定的候选集上最小化一个明确定义的函数（$\\sigma_\\rho$）。所有必要的参数和约束都已提供。只要有效候选集不为空，解的存在性就得到保证，对于给定的测试用例，情况确实如此。\n- **客观性：** 问题以精确、定量和无偏见的科学语言陈述。\n\n该问题没有表现出任何诸如科学上不合理、不完整、矛盾或含糊不清的缺陷。物理参数对于指定的反应堆类型是现实的。\n\n### 第 3 步：结论与行动\n问题有效。将提供一个完整的解决方案。\n\n### 基于原理的解决方案\n目标是确定最佳控制棒步长 $\\Delta x_{\\mathrm{opt}}$，以最小化从反应堆周期测量中推断出的反应性不确定度 $\\sigma_\\rho$。这需要基于反应堆动力学和不确定度分析原理进行多步推导和数值实现。\n\n**1. 反应性方程（In-Hour Equation）**\n点动力学方程描述了中子布居数 $n(t)$ 和第 $i$ 群缓发中子先驱核浓度 $C_i(t)$ 的时间演化：\n$$\n\\frac{dn(t)}{dt} = \\frac{\\rho(t) - \\beta}{\\Lambda} n(t) + \\sum_{i} \\lambda_i C_i(t)\n$$\n$$\n\\frac{dC_i(t)}{dt} = \\frac{\\beta_i}{\\Lambda} n(t) - \\lambda_i C_i(t)\n$$\n对于一个恒定的正反应性 $\\rho$ 的阶跃引入，系统最终达到一个稳定的指数增长，其特征是一个恒定的逆周期 $s  0$。我们假设解的形式为 $n(t) = n_0 e^{st}$ 和 $C_i(t) = C_{i,0} e^{st}$。将这些代入先驱核方程得到：\n$$\ns C_{i,0} e^{st} = \\frac{\\beta_i}{\\Lambda} n_0 e^{st} - \\lambda_i C_{i,0} e^{st} \\implies C_{i,0} = \\frac{\\beta_i n_0}{\\Lambda(s + \\lambda_i)}\n$$\n将此结果以及 $n(t)$ 的指数形式代入中子布居数方程得到：\n$$\ns n_0 e^{st} = \\frac{\\rho - \\beta}{\\Lambda} n_0 e^{st} + \\sum_{i} \\lambda_i \\frac{\\beta_i n_0}{\\Lambda(s + \\lambda_i)} e^{st}\n$$\n两边同除以 $n_0 e^{st}$ 并乘以 $\\Lambda$，并回顾 $\\beta = \\sum_i \\beta_i$，我们得到：\n$$\ns \\Lambda = \\rho - \\sum_i \\beta_i + \\sum_{i} \\frac{\\lambda_i \\beta_i}{s + \\lambda_i} = \\rho + \\sum_i \\left( \\frac{\\lambda_i \\beta_i}{s + \\lambda_i} - \\beta_i \\right) = \\rho + \\sum_i \\frac{\\lambda_i \\beta_i - \\beta_i(s+\\lambda_i)}{s + \\lambda_i} = \\rho - \\sum_i \\frac{s \\beta_i}{s + \\lambda_i}\n$$\n整理得到 **反应性方程（in-hour equation）**，它将反应性与逆周期 $s$ 联系起来：\n$$\n\\rho(s) = s\\Lambda + \\sum_{i} \\frac{s \\beta_i}{s+\\lambda_i}\n$$\n对于任何给定的反应性 $\\rho$ 满足 $0  \\rho  \\beta$，该方程有唯一的正根 $s$，必须通过数值方法找到。\n\n**2. 不确定度传播**\n推断反应性的不确定度 $\\sigma_\\rho$ 是通过将逆周期的测量不确定度 $\\sigma_s = \\sigma_{(1/\\tau)}$ 通过反应性方程关系进行传播来确定的。一阶近似由下式给出：\n$$\n\\sigma_\\rho = \\left| \\frac{d\\rho}{ds} \\right| \\sigma_s\n$$\n我们必须推导右侧两项的表达式。\n\n**2.1. 灵敏度项 $\\frac{d\\rho}{ds}$**\n我们将反应性方程对 $s$ 求导：\n$$\n\\frac{d\\rho}{ds} = \\frac{d}{ds} \\left( s\\Lambda + \\sum_{i} \\frac{s \\beta_i}{s+\\lambda_i} \\right) = \\Lambda + \\sum_{i} \\beta_i \\frac{d}{ds} \\left( \\frac{s}{s+\\lambda_i} \\right)\n$$\n使用商法则 $\\frac{d}{dx} \\frac{u}{v} = \\frac{u'v - uv'}{v^2}$，我们发现：\n$$\n\\frac{d}{ds} \\left( \\frac{s}{s+\\lambda_i} \\right) = \\frac{(1)(s+\\lambda_i) - (s)(1)}{(s+\\lambda_i)^2} = \\frac{\\lambda_i}{(s+\\lambda_i)^2}\n$$\n因此，灵敏度项为：\n$$\n\\frac{d\\rho}{ds} = \\Lambda + \\sum_{i} \\frac{\\beta_i \\lambda_i}{(s+\\lambda_i)^2}\n$$\n由于 $\\Lambda, \\beta_i, \\lambda_i$ 均为正值，所以 $\\frac{d\\rho}{ds}$ 总是正的，因此 $\\left| \\frac{d\\rho}{ds} \\right| = \\frac{d\\rho}{ds}$。\n\n**2.2. 测量不确定度 $\\sigma_s$**\n逆周期的标准差由 $\\sigma_s = \\gamma / \\sqrt{N}$ 给出。总计数 $N$ 为：\n$$\nN = \\int_0^{T_m} C_0 e^{t/\\tau} dt = C_0 \\left[ \\tau e^{t/\\tau} \\right]_0^{T_m} = C_0 \\tau (e^{T_m/\\tau} - 1)\n$$\n代入 $\\tau = 1/s$，我们有：\n$$\nN(s) = C_0 \\frac{1}{s} (e^{sT_m} - 1)\n$$\n因此，测量不确定度是 $s$ 的函数：\n$$\n\\sigma_s(s) = \\gamma \\sqrt{\\frac{s}{C_0(e^{sT_m} - 1)}}\n$$\n\n**2.3. 总反应性不确定度 $\\sigma_\\rho(s)$**\n结合这些项，作为逆周期 $s$ 的函数的总反应性不确定度为：\n$$\n\\sigma_\\rho(s) = \\left( \\Lambda + \\sum_{i} \\frac{\\beta_i \\lambda_i}{(s+\\lambda_i)^2} \\right) \\left( \\gamma \\sqrt{\\frac{s}{C_0(e^{sT_m} - 1)}} \\right)\n$$\n\n**3. 优化程序**\n目标是找到使 $\\sigma_\\rho$ 最小化的棒步长 $\\Delta x$。步骤如下：\n1.  **离散化搜索空间：** 在范围 $[\\Delta x_{\\min}, \\Delta x_{\\max}]$ 内为 $\\Delta x$ 创建一个包含 $101$ 个等距候选值的网格。\n2.  **迭代与评估：** 对于网格中的每个候选 $\\Delta x$：\n    a. 计算相应的反应性 $\\rho = w \\cdot \\Delta x$。\n    b. 检查有效性约束：如果 $\\rho \\ge \\beta = \\sum_i \\beta_i$，则该候选者无效并被排除在考虑范围之外。\n    c. 对于有效的 $\\rho$，求解反应性方程 $f(s) = s\\Lambda + \\sum_i \\frac{s \\beta_i}{s+\\lambda_i} - \\rho = 0$ 以得到其唯一的正根 $s$。这可以通过数值求根算法（如 Brent 方法）来完成。\n    d. 使用找到的 $s$ 值，利用上面推导出的表达式计算不确定度 $\\sigma_\\rho(s)$。\n3.  **确定最优值：** 在评估所有有效候选者之后，搜索结果以找到 $\\sigma_\\rho$ 的最小值。相应的步长 $\\Delta x_{\\mathrm{opt}}$、周期 $\\tau_{\\mathrm{opt}} = 1/s_{\\mathrm{opt}}$ 和不确定度 $\\sigma_{\\rho, \\mathrm{opt}}$ 即为该测试用例的解。\n\n值得注意的是，对于 $s > 0$，灵敏度项 $\\frac{d\\rho}{ds}$ 和测量不确定度项 $\\sigma_s(s)$ 都是 $s$ 的正单调递减函数。因此，它们的乘积 $\\sigma_\\rho(s)$ 也是 $s$ 的单调递减函数。由于 $s$ 是 $\\rho$（因此也是 $\\Delta x$）的单调递增函数，因此可以得出 $\\sigma_\\rho$ 是 $\\Delta x$ 的单调递减函数。因此，最小不确定度将始终出现在指定网格中最大的有效候选步长 $\\Delta x$ 处。尽管如此，所实现的程序仍将按照指示执行全面搜索。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the reactor control rod calibration optimization problem.\n\n    For each test case, the program finds the optimal rod step size that minimizes\n    the uncertainty in inferred reactivity, based on the point kinetics model.\n    \"\"\"\n\n    # --- Test Case Definitions ---\n    beta_i_base = np.array([0.000215, 0.001424, 0.001274, 0.002568, 0.000748, 0.000273])\n    lambda_i_base = np.array([0.0124, 0.0305, 0.111, 0.301, 1.140, 3.010])\n    beta_base_total = np.sum(beta_i_base)\n\n    beta_i_case2 = beta_i_base * (0.0021 / beta_base_total)\n    \n    test_cases = [\n        {\n            \"name\": \"Thermal reactor, typical\",\n            \"beta_i\": beta_i_base,\n            \"lambda_i\": lambda_i_base,\n            \"Lambda\": 1.0e-5,\n            \"w\": 1.6e-4,\n            \"dx_min\": 0.2, \"dx_max\": 25.0,\n            \"Tm\": 30.0, \"C0\": 2000.0, \"gamma\": 1.0\n        },\n        {\n            \"name\": \"Fast reactor, reduced beta\",\n            \"beta_i\": beta_i_case2,\n            \"lambda_i\": lambda_i_base,\n            \"Lambda\": 5.0e-7,\n            \"w\": 3.2e-4,\n            \"dx_min\": 0.05, \"dx_max\": 10.0,\n            \"Tm\": 10.0, \"C0\": 5000.0, \"gamma\": 1.0\n        },\n        {\n            \"name\": \"Thermal reactor, aggressive worth\",\n            \"beta_i\": beta_i_base,\n            \"lambda_i\": lambda_i_base,\n            \"Lambda\": 1.0e-5,\n            \"w\": 5.0e-4,\n            \"dx_min\": 0.1, \"dx_max\": 40.0,\n            \"Tm\": 15.0, \"C0\": 1500.0, \"gamma\": 1.0\n        },\n        {\n            \"name\": \"Thermal reactor, very small worth\",\n            \"beta_i\": beta_i_base,\n            \"lambda_i\": lambda_i_base,\n            \"Lambda\": 1.0e-5,\n            \"w\": 2.0e-5,\n            \"dx_min\": 0.1, \"dx_max\": 20.0,\n            \"Tm\": 60.0, \"C0\": 800.0, \"gamma\": 1.0\n        }\n    ]\n\n    final_results = []\n    \n    # --- Main Calculation Loop ---\n    for params in test_cases:\n        beta_i = params[\"beta_i\"]\n        lambda_i = params[\"lambda_i\"]\n        Lambda = params[\"Lambda\"]\n        w = params[\"w\"]\n        Tm = params[\"Tm\"]\n        C0 = params[\"C0\"]\n        gamma = params[\"gamma\"]\n        total_beta = np.sum(beta_i)\n        \n        dx_grid = np.linspace(params[\"dx_min\"], params[\"dx_max\"], 101)\n        \n        valid_steps = []\n\n        def in_hour_residual(s, rho_target, Lambda_p, beta_i_p, lambda_i_p):\n            \"\"\"Residual of the in-hour equation: f(s) = rho(s) - rho_target.\"\"\"\n            rho_s = s * Lambda_p + np.sum(s * beta_i_p / (s + lambda_i_p))\n            return rho_s - rho_target\n\n        for dx in dx_grid:\n            rho = w * dx\n            \n            # Constraint: 0  rho  beta. The lower bound dx_min > 0 ensures rho > 0.\n            if rho >= total_beta:\n                continue\n\n            # Solve for inverse period 's' using Brent's method\n            try:\n                # A wide bracket for s is safe, as rho is constrained below beta.\n                s = brentq(in_hour_residual, 1e-9, 2000.0, args=(rho, Lambda, beta_i, lambda_i))\n            except ValueError:\n                # Should not happen for rho  beta\n                continue\n            \n            # Calculate sensitivity d(rho)/ds\n            d_rho_ds = Lambda + np.sum(beta_i * lambda_i / (s + lambda_i)**2)\n            \n            # Calculate measurement uncertainty sigma_s\n            tau = 1.0 / s\n            \n            # Use np.expm1 for better precision with small s*Tm\n            N = C0 * tau * np.expm1(s * Tm)\n            \n            if N = 0:\n                sigma_s = np.inf\n            else:\n                sigma_s = gamma / np.sqrt(N)\n                \n            # Calculate total reactivity uncertainty sigma_rho\n            sigma_rho = d_rho_ds * sigma_s\n            \n            valid_steps.append({'dx': dx, 'tau': tau, 'sigma_rho': sigma_rho})\n            \n        # Find the step with the minimum uncertainty among valid candidates\n        if not valid_steps:\n             # This case should not occur with the given problem parameters.\n             # If it did, it would imply no solution exists in the specified range.\n             # For robustness, handle this, although it's not expected.\n            raise ValueError(f\"No valid steps found for case: {params['name']}\")\n\n        optimal_step = min(valid_steps, key=lambda x: x['sigma_rho'])\n        \n        dx_opt = optimal_step['dx']\n        tau_opt = optimal_step['tau']\n        sigma_rho_opt = optimal_step['sigma_rho']\n\n        # Format result string for this case\n        result_str = f\"[{tau_opt:.6f},{dx_opt:.6f},{sigma_rho_opt:.6f}]\"\n        final_results.append(result_str)\n\n    # --- Final Output ---\n    # Print the final result string in the required format\n    print(f\"[{','.join(final_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}