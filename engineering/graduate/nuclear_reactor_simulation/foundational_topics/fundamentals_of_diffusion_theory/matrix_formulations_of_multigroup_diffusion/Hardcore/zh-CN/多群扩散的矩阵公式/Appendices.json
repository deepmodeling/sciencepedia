{
    "hands_on_practices": [
        {
            "introduction": "本次实践练习着眼于多群扩散方程矩阵形式中最基本的组成部分：散射矩阵。我们将根据给定的宏观散射截面数据组装矩阵，然后分析一个关键的数学属性——亚随机性（substochasticity）。这个属性是确保基本源迭代法收敛的一个充分条件，因此该练习旨在建立物理截面数据与算子数学性质之间的桥梁。",
            "id": "4234944",
            "problem": "考虑一个均匀、非裂变介质，其模型由稳态多群扩散平衡描述，通量矢量为 $\\boldsymbol{\\phi} = (\\phi_{1}, \\phi_{2}, \\phi_{3})^{\\mathrm{T}}$，能量群为 $g \\in \\{1,2,3\\}$。基本出发点是每个能量群 $g$ 的多群扩散平衡方程，\n$$\n- \\nabla \\cdot \\left( D_{g} \\nabla \\phi_{g} \\right) + \\Sigma_{r,g} \\phi_{g} = \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g} \\, \\phi_{g'} ,\n$$\n其中 $D_{g}$ 是扩散系数，$\\Sigma_{r,g}$ 是宏观移出截面，$\\Sigma_{s,g' \\to g}$ 是中子从能量群 $g'$ 散射到能量群 $g$ 的宏观散射截面。在一个空间均匀化的单自由度（每个能量群一个未知数）设定中，散射源可以写成一个作用于 $\\boldsymbol{\\phi}$ 的 $3 \\times 3$ 矩阵，\n$$\n\\mathbf{S} \\boldsymbol{\\phi} = \\begin{pmatrix}\n\\Sigma_{s,1 \\to 1} & \\Sigma_{s,2 \\to 1} & \\Sigma_{s,3 \\to 1} \\\\\n\\Sigma_{s,1 \\to 2} & \\Sigma_{s,2 \\to 2} & \\Sigma_{s,3 \\to 2} \\\\\n\\Sigma_{s,1 \\to 3} & \\Sigma_{s,2 \\to 3} & \\Sigma_{s,3 \\to 3}\n\\end{pmatrix} \\begin{pmatrix} \\phi_{1} \\\\ \\phi_{2} \\\\ \\phi_{3} \\end{pmatrix},\n$$\n移出算子是对角矩阵 $\\mathbf{R} = \\mathrm{diag}(\\Sigma_{r,1}, \\Sigma_{r,2}, \\Sigma_{r,3})$。在纯散射系统的源迭代背景下，诱导无穷范数下的一个收敛充分条件是 $\\mathbf{R}^{-1}\\mathbf{S}$ 的行和小于1，这对应于散射到移出映射的严格次随机性。\n\n给定以下 $G=3$ 的列表形式的宏观散射截面 $\\Sigma_{s,g' \\to g}$（单位为反厘米，$\\mathrm{cm}^{-1}$）和宏观移出截面 $\\Sigma_{r,g}$（单位也为 $\\mathrm{cm}^{-1}$）：\n- $\\Sigma_{s,1 \\to 1} = 0.20$, $\\Sigma_{s,1 \\to 2} = 0.05$, $\\Sigma_{s,1 \\to 3} = 0.00$,\n- $\\Sigma_{s,2 \\to 1} = 0.01$, $\\Sigma_{s,2 \\to 2} = 0.25$, $\\Sigma_{s,2 \\to 3} = 0.06$,\n- $\\Sigma_{s,3 \\to 1} = 0.00$, $\\Sigma_{s,3 \\to 2} = 0.02$, $\\Sigma_{s,3 \\to 3} = 0.30$,\n- $\\Sigma_{r,1} = 0.35$, $\\Sigma_{r,2} = 0.40$, $\\Sigma_{r,3} = 0.38$。\n\n任务：\n1. 组装与从 $\\boldsymbol{\\phi}$ 到散射源的多群映射一致的 $\\mathbf{S}$ 的 $3 \\times 3$ 块结构。解释行和列在引入散射方面的含义。\n2. 使用 $\\mathbf{R} = \\mathrm{diag}(\\Sigma_{r,1}, \\Sigma_{r,2}, \\Sigma_{r,3})$ 的矩阵观点，确定 $\\mathbf{R}^{-1}\\mathbf{S}$ 在诱导无穷范数下是严格次随机的条件，并用列表中的截面表示该条件。\n3. 计算严格次随机性余量 $\\delta$，其定义为对每个能量群 $g$ 都满足以下条件的最大非负数：\n$$\n\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g} \\leq (1 - \\delta)\\, \\Sigma_{r,g} .\n$$\n将 $\\delta$ 的最终答案表示为一个无量纲小数，并四舍五入到四位有效数字。",
            "solution": "按要求分三步对问题进行分析：组装并解释散射矩阵，推导严格次随机性的条件，以及计算相应的余量 $\\delta$。\n\n**任务1：组装并解释散射矩阵 $\\mathbf{S}$**\n\n给定能量群 $g$ 的稳态多群扩散方程为\n$$\n- \\nabla \\cdot \\left( D_{g} \\nabla \\phi_{g} \\right) + \\Sigma_{r,g} \\phi_{g} = \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g} \\, \\phi_{g'}\n$$\n在空间均匀化的背景下，散度项消失，平衡方程变为一个代数系统。右侧项代表从中子从所有能量群 $g'$ 散射到能量群 $g$ 的源，可以写成矩阵-矢量乘积。散射源矢量为 $\\mathbf{S}\\boldsymbol{\\phi}$，其中源矢量对于能量群 $g$ 的分量是 $(\\mathbf{S}\\boldsymbol{\\phi})_g = \\sum_{g'=1}^{3} S_{g,g'} \\phi_{g'}$。将其与扩散方程中的求和项进行比较，我们发现散射矩阵 $\\mathbf{S}$ 在第 $g$ 行和第 $g'$ 列的元素必须是 $S_{g,g'} = \\Sigma_{s,g' \\to g}$。\n\n问题给出了矩阵结构：\n$$\n\\mathbf{S} = \\begin{pmatrix}\n\\Sigma_{s,1 \\to 1} & \\Sigma_{s,2 \\to 1} & \\Sigma_{s,3 \\to 1} \\\\\n\\Sigma_{s,1 \\to 2} & \\Sigma_{s,2 \\to 2} & \\Sigma_{s,3 \\to 2} \\\\\n\\Sigma_{s,1 \\to 3} & \\Sigma_{s,2 \\to 3} & \\Sigma_{s,3 \\to 3}\n\\end{pmatrix}\n$$\n代入给定的数值（单位均为 $\\mathrm{cm}^{-1}$）：\n$$\n\\mathbf{S} = \\begin{pmatrix}\n0.20 & 0.01 & 0.00 \\\\\n0.05 & 0.25 & 0.02 \\\\\n0.00 & 0.06 & 0.30\n\\end{pmatrix}\n$$\n$\\mathbf{S}$ 的行和列的解释如下：\n- 元素 $S_{g,g'} = \\Sigma_{s,g' \\to g}$ 代表一个中子从源群 $g'$ 散射到目标群 $g$ 的宏观截面。\n- $\\mathbf{S}$ 的第 $g$ 行包含截面 $\\{\\Sigma_{s,1 \\to g}, \\Sigma_{s,2 \\to g}, \\Sigma_{s,3 \\to g}\\}$。当乘以通量矢量 $\\boldsymbol{\\phi}$ 时，和 $\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g} \\phi_{g'}$ 给出散射*进入*能量群 $g$ 的中子的总反应率密度。因此，$\\mathbf{S}$ 的每一行对应于特定目标群的引入散射截面。\n- $\\mathbf{S}$ 的第 $g'$ 列包含截面 $\\{\\Sigma_{s,g' \\to 1}, \\Sigma_{s,g' \\to 2}, \\Sigma_{s,g' \\to 3}\\}$。这些是在能量群 $g'$ 中的中子散射*出去*到任何其他群的截面。\n\n**任务2：严格次随机性的条件**\n\n对于代数系统 $(\\mathbf{R} - \\mathbf{S})\\boldsymbol{\\phi} = \\boldsymbol{q}_{ext}$（其中 $\\boldsymbol{q}_{ext}$ 是一个外部源，在这个均匀问题中为零），源迭代方法由 $\\mathbf{R}\\boldsymbol{\\phi}^{(k+1)} = \\mathbf{S}\\boldsymbol{\\phi}^{(k)} + \\boldsymbol{q}_{ext}$ 给出，或者 $\\boldsymbol{\\phi}^{(k+1)} = \\mathbf{R}^{-1}\\mathbf{S}\\boldsymbol{\\phi}^{(k)} + \\mathbf{R}^{-1}\\boldsymbol{q}_{ext}$。如果迭代矩阵 $\\mathbf{M} = \\mathbf{R}^{-1}\\mathbf{S}$ 的谱半径小于1，则此迭代收敛。一个充分条件是任何诱导矩阵范数小于1。\n\n问题指定了诱导无穷范数 $||\\mathbf{M}||_{\\infty}$，其定义为矩阵 $\\mathbf{M}$ 的最大绝对行和。收敛的条件是 $||\\mathbf{M}||_{\\infty} < 1$。一个所有项都非负且所有行和都小于1的矩阵被称为严格次随机的。\n\n矩阵 $\\mathbf{R}$ 和 $\\mathbf{S}$ 是已知的。移出矩阵是 $\\mathbf{R} = \\mathrm{diag}(\\Sigma_{r,1}, \\Sigma_{r,2}, \\Sigma_{r,3})$，所以它的逆是 $\\mathbf{R}^{-1} = \\mathrm{diag}(1/\\Sigma_{r,1}, 1/\\Sigma_{r,2}, 1/\\Sigma_{r,3})$。\n迭代矩阵是：\n$$\n\\mathbf{M} = \\mathbf{R}^{-1}\\mathbf{S} = \\begin{pmatrix}\n\\frac{1}{\\Sigma_{r,1}} & 0 & 0 \\\\\n0 & \\frac{1}{\\Sigma_{r,2}} & 0 \\\\\n0 & 0 & \\frac{1}{\\Sigma_{r,3}}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\Sigma_{s,1 \\to 1} & \\Sigma_{s,2 \\to 1} & \\Sigma_{s,3 \\to 1} \\\\\n\\Sigma_{s,1 \\to 2} & \\Sigma_{s,2 \\to 2} & \\Sigma_{s,3 \\to 2} \\\\\n\\Sigma_{s,1 \\to 3} & \\Sigma_{s,2 \\to 3} & \\Sigma_{s,3 \\to 3}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{\\Sigma_{s,1 \\to 1}}{\\Sigma_{r,1}} & \\frac{\\Sigma_{s,2 \\to 1}}{\\Sigma_{r,1}} & \\frac{\\Sigma_{s,3 \\to 1}}{\\Sigma_{r,1}} \\\\\n\\frac{\\Sigma_{s,1 \\to 2}}{\\Sigma_{r,2}} & \\frac{\\Sigma_{s,2 \\to 2}}{\\Sigma_{r,2}} & \\frac{\\Sigma_{s,3 \\to 2}}{\\Sigma_{r,2}} \\\\\n\\frac{\\Sigma_{s,1 \\to 3}}{\\Sigma_{r,3}} & \\frac{\\Sigma_{s,2 \\to 3}}{\\Sigma_{r,3}} & \\frac{\\Sigma_{s,3 \\to 3}}{\\Sigma_{r,3}}\n\\end{pmatrix}\n$$\n$\\mathbf{M}$ 是严格次随机的条件是，对于每一行 $g \\in \\{1, 2, 3\\}$，其元素之和小于1。第 $g$ 行的元素之和是：\n$$\n\\sum_{g'=1}^{3} M_{g,g'} = \\sum_{g'=1}^{3} \\frac{\\Sigma_{s,g' \\to g}}{\\Sigma_{r,g}} = \\frac{1}{\\Sigma_{r,g}} \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g}\n$$\n因此，用列表中的截面表示的严格次随机性条件是，对于每个能量群 $g$：\n$$\n\\frac{1}{\\Sigma_{r,g}} \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g} < 1 \\quad \\iff \\quad \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g} < \\Sigma_{r,g}\n$$\n在物理上，这意味着对于每个能量群，总的引入散射率必须严格小于总的移出率（吸收加群外散射）。\n\n**任务3：计算严格次随机性余量 $\\delta$**\n\n余量 $\\delta$ 定义为对每个能量群 $g$ 都满足以下条件的最大非负数：\n$$\n\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g} \\leq (1 - \\delta) \\Sigma_{r,g}\n$$\n重新整理以求解 $\\delta$，假设 $\\Sigma_{r,g} > 0$：\n$$\n\\frac{\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g}}{\\Sigma_{r,g}} \\leq 1 - \\delta \\quad \\implies \\quad \\delta \\leq 1 - \\frac{\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g}}{\\Sigma_{r,g}}\n$$\n这个不等式必须对所有的 $g \\in \\{1, 2, 3\\}$ 都成立。为了找到满足这个不等式组的最大 $\\delta$，我们必须取所有 $g$ 对应的不等式右侧的最小值：\n$$\n\\delta = \\min_{g \\in \\{1,2,3\\}} \\left( 1 - \\frac{\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g}}{\\Sigma_{r,g}} \\right)\n$$\n这等价于：\n$$\n\\delta = 1 - \\max_{g \\in \\{1,2,3\\}} \\left( \\frac{\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g}}{\\Sigma_{r,g}} \\right)\n$$\n我们计算每个群的引入散射截面总和以及该比率。设 $c_g = (\\sum_{g'=1}^{3} \\Sigma_{s,g' \\to g}) / \\Sigma_{r,g}$。\n\n对于群 $g=1$：\n$$ \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to 1} = \\Sigma_{s,1 \\to 1} + \\Sigma_{s,2 \\to 1} + \\Sigma_{s,3 \\to 1} = 0.20 + 0.01 + 0.00 = 0.21 \\, \\mathrm{cm}^{-1} $$\n$$ c_1 = \\frac{0.21}{0.35} = 0.6 $$\n\n对于群 $g=2$：\n$$ \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to 2} = \\Sigma_{s,1 \\to 2} + \\Sigma_{s,2 \\to 2} + \\Sigma_{s,3 \\to 2} = 0.05 + 0.25 + 0.02 = 0.32 \\, \\mathrm{cm}^{-1} $$\n$$ c_2 = \\frac{0.32}{0.40} = 0.8 $$\n\n对于群 $g=3$：\n$$ \\sum_{g'=1}^{3} \\Sigma_{s,g' \\to 3} = \\Sigma_{s,1 \\to 3} + \\Sigma_{s,2 \\to 3} + \\Sigma_{s,3 \\to 3} = 0.00 + 0.06 + 0.30 = 0.36 \\, \\mathrm{cm}^{-1} $$\n$$ c_3 = \\frac{0.36}{0.38} = \\frac{36}{38} = \\frac{18}{19} $$\n\n这些比率的最大值是：\n$$ \\max\\{c_1, c_2, c_3\\} = \\max\\left\\{0.6, 0.8, \\frac{18}{19}\\right\\} = \\max\\left\\{0.6, 0.8, 0.947368...\\right\\} = \\frac{18}{19} $$\n那么，严格次随机性余量 $\\delta$ 是：\n$$ \\delta = 1 - \\frac{18}{19} = \\frac{1}{19} $$\n转换为小数并四舍五入到四位有效数字：\n$$ \\delta \\approx 0.05263157... \\approx 0.05263 $$\n这个值是无量纲的，因为它是截面的比率。",
            "answer": "$$\n\\boxed{0.05263}\n$$"
        },
        {
            "introduction": "从单点代数系统扩展到完整的空间模型，本练习涉及在二维笛卡尔网格上对多群扩散方程进行离散化。您将通过实施有限差分法，来构建代表整个耦合系统的大型稀疏分块矩阵。通过此练习，您将亲身体验反应堆模拟程序开发中矩阵组装的实际过程，并深入理解其稀疏结构。",
            "id": "4234989",
            "problem": "您的任务是推导、组合和分析在二维均匀笛卡尔网格上双能群中子多群扩散（MGD）方程的全局分块矩阵。目标是构建由最近邻有限差分格式产生的全局分块矩阵 $A = L - S$，并提供其稀疏模式信息。您必须编写一个完整、可运行的程序，该程序为指定的测试套件构建此矩阵，并输出稀疏模式的定量描述符。\n\n从以下基本原理开始。在非均匀但分块常数的材料区域中，稳态双能群扩散模型由以下耦合偏微分方程（PDEs）给出\n$$\n-\\nabla \\cdot \\left(D_1(\\mathbf{r}) \\nabla \\phi_1(\\mathbf{r})\\right) + \\Sigma_{r,1}(\\mathbf{r}) \\phi_1(\\mathbf{r}) = \\Sigma_{s,1\\to 1}(\\mathbf{r}) \\phi_1(\\mathbf{r}) + \\Sigma_{s,2\\to 1}(\\mathbf{r}) \\phi_2(\\mathbf{r}),\n$$\n$$\n-\\nabla \\cdot \\left(D_2(\\mathbf{r}) \\nabla \\phi_2(\\mathbf{r})\\right) + \\Sigma_{r,2}(\\mathbf{r}) \\phi_2(\\mathbf{r}) = \\Sigma_{s,1\\to 2}(\\mathbf{r}) \\phi_1(\\mathbf{r}) + \\Sigma_{s,2\\to 2}(\\mathbf{r}) \\phi_2(\\mathbf{r}),\n$$\n其中 $D_g(\\mathbf{r})$ 是能群 $g$ 的扩散系数，$\\Sigma_{r,g}(\\mathbf{r})$ 是移出截面，$\\Sigma_{s,g'\\to g}(\\mathbf{r})$ 是从能群 $g'$ 到能群 $g$ 的散射截面。未知量是 $g \\in \\{1,2\\}$ 的标量通量 $\\phi_g(\\mathbf{r})$。假设在均匀网格的每个单元内，所有系数在空间上都是均匀的。\n\n在尺寸为 $N_x \\times N_y$、单元宽度为单位长度的矩形网格上，使用标准五点有限差分（FD）格式对空间算子进行离散化（您可以将网格间距视为无单位的 $h=1$）。强制执行狄利克雷边界条件，即任何位于域外的相邻点都将直接从格式中省略。设 $N = N_x N_y$ 为空间单元的数量。对未知量向量使用群主序：先列出能群1的所有 $N$ 个未知量，然后是能群2的所有 $N$ 个未知量。在此排序下，全局分块矩阵 $A$ 是一个 $2N \\times 2N$ 的矩阵，由四个 $N \\times N$ 的子块组成，\n$$\nA = \\begin{pmatrix}\nA_{11} & A_{12} \\\\\nA_{21} & A_{22}\n\\end{pmatrix},\n\\quad\nA_{11} = L_{11} - S_{11},\\quad\nA_{22} = L_{22} - S_{22},\\quad\nA_{12} = -S_{12},\\quad\nA_{21} = -S_{21}.\n$$\n这里，$L_{gg}$ 是由五点FD格式产生的群内泄漏加移出离散算子（其中 $D_g$ 在每条边上，$\\Sigma_{r,g}$ 在对角线上），而 $S_{g g'}$ 是从能群 $g'$ 到能群 $g$ 的散射算子。在离散设置中，散射算子在空间上是单元局域的，因此在同一网格上表示时，每个 $S_{g g'}$ 在空间索引上都是对角矩阵。\n\n您的程序必须组合 $A$，并为每个测试用例报告定量的稀疏性信息，该信息需同时捕捉能群分块结构和泄漏算子中的空间邻接关系。具体来说，对于每个测试用例，计算并以下列项目的单个列表形式输出：\n1. $A$ 的每个能群块的非零元计数：$[\\mathrm{nnz}(A_{11}), \\mathrm{nnz}(A_{12}), \\mathrm{nnz}(A_{21}), \\mathrm{nnz}(A_{22})]$，使用 $10^{-12}$ 的数值阈值将矩阵元素视为零。\n2. 两个布尔指示符，用于判断非对角能群块在空间上是否为对角矩阵：$[\\mathrm{isdiag}(A_{12}), \\mathrm{isdiag}(A_{21})]$，如果块中所有非零元都位于其空间对角线上，则为 true，否则为 false（没有非零元的块被视为对角矩阵）。\n3. 泄漏块 $L_{11}$ 和 $L_{22}$ 中行非零元计数的已排序唯一列表，每个列表都使用相同的 $10^{-12}$ 阈值计算：$[\\mathrm{degrees}(L_{11}), \\mathrm{degrees}(L_{22})]$。每个列表报告了仅由五点格式结构、狄利克雷边界和移出对角项产生的每行非零元的不同计数。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果按上述顺序以嵌套列表的形式呈现。\n\n测试套件：\n使用以下三个测试用例，每个用例由 $(N_x, N_y, D_1, D_2, \\Sigma_{r,1}, \\Sigma_{r,2}, \\Sigma_{s,1\\to 1}, \\Sigma_{s,2\\to 2}, \\Sigma_{s,1\\to 2}, \\Sigma_{s,2\\to 1})$ 定义，为组合和分析之目的，所有量均被视为无量纲正实数：\n- 用例1（二维网格，仅向下散射）：$(2, 2, 1.0, 0.8, 0.2, 0.1, 0.0, 0.0, 0.05, 0.0)$。\n- 用例2（嵌入二维索引的一维线，包含群内和群间散射）：$(3, 1, 0.5, 0.5, 0.3, 0.3, 0.1, 0.2, 0.05, 0.02)$。\n- 用例3（单单元边界情况，仅向下散射）：$(1, 1, 1.2, 1.2, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个含有三个嵌套列表的列表，每个嵌套列表对应一个测试用例，并严格按照上面给出的顺序排列。对于每个测试用例，嵌套列表必须依次包含：\n- 列表 $[\\mathrm{nnz}(A_{11}), \\mathrm{nnz}(A_{12}), \\mathrm{nnz}(A_{21}), \\mathrm{nnz}(A_{22})]$，\n- 列表 $[\\mathrm{isdiag}(A_{12}), \\mathrm{isdiag}(A_{21})]$，\n- 列表 $\\mathrm{degrees}(L_{11})$，\n- 列表 $\\mathrm{degrees}(L_{22})$。\n\n作为格式示例，如果有两个测试用例，其结果分别为 $r_1$ 和 $r_2$，那么打印的单行内容应为：$[r_1,r_2]$。您不能打印任何附加文本。",
            "solution": "用户提供了一个关于在二维笛卡尔网格上组装和分析双能群中子扩散方程的全局矩阵的问题。\n\n### 问题验证\n\n我将首先根据指定标准验证问题陈述。\n\n#### 第1步：提取已知信息\n\n*   **控制方程**：稳态双能群扩散方程如下：\n    $$-\\nabla \\cdot \\left(D_1(\\mathbf{r}) \\nabla \\phi_1(\\mathbf{r})\\right) + \\Sigma_{r,1}(\\mathbf{r}) \\phi_1(\\mathbf{r}) = \\Sigma_{s,1\\to 1}(\\mathbf{r}) \\phi_1(\\mathbf{r}) + \\Sigma_{s,2\\to 1}(\\mathbf{r}) \\phi_2(\\mathbf{r})$$\n    $$-\\nabla \\cdot \\left(D_2(\\mathbf{r}) \\nabla \\phi_2(\\mathbf{r})\\right) + \\Sigma_{r,2}(\\mathbf{r}) \\phi_2(\\mathbf{r}) = \\Sigma_{s,1\\to 2}(\\mathbf{r}) \\phi_1(\\mathbf{r}) + \\Sigma_{s,2\\to 2}(\\mathbf{r}) \\phi_2(\\mathbf{r})$$\n*   **物理参数**：$D_g$（扩散系数），$\\Sigma_{r,g}$（移出截面），$\\Sigma_{s,g'\\to g}$（散射截面）。假设对于每个测试用例，这些参数都是分块常数且均匀的。\n*   **离散化**：\n    *   方法：五点有限差分（FD）格式。\n    *   网格：大小为 $N_x \\times N_y$ 单元的均匀笛卡尔网格。\n    *   网格间距：$h=1$。\n    *   边界条件：狄利克雷，通过省略域外的任何相邻点来实现。\n*   **矩阵系统**：\n    *   未知量排序：群主序，先列出能群1的所有 $N = N_x N_y$ 个空间未知量，然后是能群2的所有 $N$ 个未知量。\n    *   全局矩阵：$A = L-S$，一个具有 $2 \\times 2$ 分块结构的 $2N \\times 2N$ 矩阵。\n    $$A = \\begin{pmatrix} A_{11} & A_{12} \\\\ A_{21} & A_{22} \\end{pmatrix}$$\n    *   分块定义：\n        *   $A_{11} = L_{11} - S_{11}$\n        *   $A_{22} = L_{22} - S_{22}$\n        *   $A_{12} = -S_{12}$\n        *   $A_{21} = -S_{21}$\n        *   $L_{gg}$：能群 $g$ 的泄漏加移出算子。\n        *   $S_{gg'}$：从能群 $g'$ 到 $g$ 的散射算子，注意其在空间上是单元局域的（对角）。\n*   **分析任务**：对每个测试用例，计算并输出：\n    1.  每个块的非零元计数：$[\\mathrm{nnz}(A_{11}), \\mathrm{nnz}(A_{12}), \\mathrm{nnz}(A_{21}), \\mathrm{nnz}(A_{22})]$，容差为 $10^{-12}$。\n    2.  非对角块的对角性指示符：$[\\mathrm{isdiag}(A_{12}), \\mathrm{isdiag}(A_{21})]$。\n    3.  泄漏块的排序后唯一的行非零元计数：$[\\mathrm{degrees}(L_{11}), \\mathrm{degrees}(L_{22})]$。\n*   **测试套件**：提供了三个用例，其具体值为 $(N_x, N_y, D_1, D_2, \\Sigma_{r,1}, \\Sigma_{r,2}, \\Sigma_{s,1\\to 1}, \\Sigma_{s,2\\to 2}, \\Sigma_{s,1\\to 2}, \\Sigma_{s,2\\to 1})$。\n\n#### 第2步：使用提取的已知信息进行验证\n\n1.  **科学或事实不健全**：该问题基于多群扩散近似，这是核反应堆物理学中一个标准且成熟的模型。使用有限差分进行离散化也是一种基本的数值技术。问题表述在科学上和数学上都是合理的。\n2.  **非形式化或不相关**：该问题具体、明确，并要求实现一个特定的数值算法。它与核反应堆的模拟直接相关。\n3.  **不完整或矛盾的设置**：问题提供了所有必要信息：控制方程、离散化方法、边界条件、矩阵排序以及测试用例的所有物理参数。矩阵块的定义与将控制方程重排为矩阵形式是一致的。例如，能群1方程右侧的项 $\\Sigma_{s,2\\to 1} \\phi_2$ 移到左侧，贡献了 $-\\Sigma_{s,2\\to 1}\\phi_2$。这对应于矩阵块 $A_{12}$ 作用于 $\\phi_2$ 向量。定义 $A_{12} = -S_{12}$，其中 $S_{12}$ 表示从能群2到1的散射（与 $\\Sigma_{s,2\\to 1}$ 相关），这是自洽的。\n4.  **不切实际或不可行**：所提供的参数是正实数，这在物理上是合理的。问题的简化（例如，$h=1$，均匀材料属性）在学术练习中很常见，并不会使问题在物理上不可能或不一致。\n5.  **不适定或结构不良**：任务是组装矩阵并分析其结构，而不是求解线性系统。这是一个定义明确的计算任务。使用“狄利克雷边界条件”来指代省略格式点是一种略微非标准但清晰指定的实现指令。在其上下文中，它是明确无误的。\n6.  **伪深刻、琐碎或同义反复**：该问题需要理解偏微分方程离散化、稀疏矩阵数据结构，以及索引和组装逻辑的仔细实现。这是科学计算中一个实质性的、非凡的练习。\n7.  **超出科学可验证性**：矩阵组装的结果是算法决定的，可以被独立地复现和验证。\n\n#### 第3步：结论与行动\n\n问题陈述是有效的。它具有科学依据、适定且完整。我现在将继续提供解决方案。\n\n### 解决方案\n\n解决方案涉及为双能群中子扩散问题构建全局矩阵 $A$ 的组成块，并分析其稀疏模式。该过程可分为三个主要阶段：构建泄漏加移出算子 ($L_{gg}$)、构建散射算子 ($S_{gg'}$) 以及最后组装 $A$ 的块并进行后续分析。\n\n#### 1. 离散化与泄漏加移出算子 ($L_{gg}$)\n\n算子 $L_{gg}$ 代表 $-\\nabla \\cdot (D_g \\nabla \\phi_g) + \\Sigma_{r,g} \\phi_g$ 的离散形式。我们在尺寸为 $N_x \\times N_y$、间距为 $h=1$ 的均匀笛卡尔网格上使用五点有限差分格式。单元通过单个全局索引 $k \\in \\{0, 1, ..., N-1\\}$ 进行索引，其中 $N = N_x N_y$。从二维坐标 $(i, j)$（其中 $0 \\le i < N_x$, $0 \\le j < N_y$）到全局索引 $k$ 的一个常见映射是行主序：$k = i + j \\cdot N_x$。\n\n对于常数扩散系数 $D_g$，在点 $(x,y)$ 处的连续泄漏算子为 $-D_g \\nabla^2 \\phi_g = -D_g (\\frac{\\partial^2\\phi_g}{\\partial x^2} + \\frac{\\partial^2\\phi_g}{\\partial y^2})$。使用 $h=1$ 的中心差分，作用于单元 $k$（坐标为 $(i,j)$）通量上的离散算子为：\n$$ -D_g (\\phi_{g,i+1,j} - 2\\phi_{g,i,j} + \\phi_{g,i-1,j} + \\phi_{g,i,j+1} - 2\\phi_{g,i,j} + \\phi_g{,i,j-1}) = D_g(4\\phi_{g,k} - \\phi_{g,k_{R}} - \\phi_{g,k_{L}} - \\phi_{g,k_{T}} - \\phi_{g,k_{B}})$$\n其中 $k_R, k_L, k_T, k_B$ 分别是右、左、上、下相邻单元的全局索引。\n\n问题指明，对于边界附近的单元，任何位于域外的相邻点都将从格式中省略。这意味着相邻点贡献的总和仅包括存在的相邻点，并且中心项 $\\phi_{g,k}$ 的系数随实际相邻点数量 $c_k$ 进行缩放。\n\n将离散泄漏算子与移出项 $\\Sigma_{r,g}\\phi_{g,k}$ 结合，算子 $L_{gg}$ 的第 $k$ 行的完整表达式为：\n$$(L_{gg} \\boldsymbol{\\phi}_g)_k = (c_k D_g + \\Sigma_{r,g}) \\phi_{g,k} - \\sum_{k' \\in \\text{neighbors}(k)} D_g \\phi_{g,k'}$$\n由此，我们推导出矩阵 $L_{gg}$ 的元素：\n*   对角元：$(L_{gg})_{k,k} = c_k D_g + \\Sigma_{r,g}$\n*   非对角元：如果单元 $k'$ 是单元 $k$ 的相邻单元，则 $(L_{gg})_{k,k'} = -D_g$。\n*   所有其他元素均为 $0$。\n相邻单元数 $c_k$ 可以是 $2$（对于角点单元，如果 $N_x, N_y > 1$）、$3$（对于边单元，非角点）或 $4$（对于内部单元）。对于类一维情况（$N_x=1$ 或 $N_y=1$），$c_k$ 可以是 $0$、$1$ 或 $2$。\n\n#### 2. 散射算子 ($S_{gg'}$)\n\n散射算子 $S_{gg'}$ 表示中子从能群 $g'$ 到能群 $g$ 的转移。问题指出这些算子“在空间上是单元局域的”，这意味着在某一空间位置的散射过程仅取决于该位置的通量。因此，矩阵 $S_{gg'}$ 在空间索引上是对角的。对于每个测试用例中给出的均匀材料属性，从能群 $g'$ 到 $g$ 的散射矩阵只是一个缩放的单位矩阵：\n$$S_{gg'} = \\Sigma_{s,g' \\to g} \\cdot I_N$$\n其中 $I_N$ 是 $N \\times N$ 的单位矩阵。注意约定：$S_{12}$ 对应从能群2到能群1的散射，因此它使用 $\\Sigma_{s,2 \\to 1}$ 构建。\n\n#### 3. 组装与分析\n\n在定义了 $L_{gg}$ 和 $S_{gg'}$ 矩阵后，系统矩阵 $A$ 的四个块按如下方式组装：\n*   $A_{11} = L_{11} - S_{11}$\n*   $A_{22} = L_{22} - S_{22}$\n*   $A_{12} = -S_{12}$\n*   $A_{21} = -S_{21}$\n\n这些操作使用稀疏矩阵算术执行。最后一步是根据问题要求分析这四个块：\n1.  **非零元计数**：对于每个块 $A_{gg'}$，绝对值低于 $10^{-12}$ 的元素被视为零。然后计算剩余非零元素的数量。\n2.  **对角性检查**：对于非对角块 $A_{12}$ 和 $A_{21}$，我们检查所有非零元素是否都位于主对角线上。根据问题陈述，全零矩阵被视为对角矩阵。\n3.  **泄漏块的度**：对于每个泄漏块 $L_{gg}$，我们首先过滤掉接近零的值。然后，对每一行，我们计算非零项的数量。每个块的最终结果是在这些行计数中找到的已排序的唯一值列表。这反映了网格中单元的不同连接模式（例如，角点、边、内部）。\n\n该实现将系统地将此逻辑应用于提供的每个测试用例。我们将使用 `scipy.sparse` 矩阵，特别是用于构建的 `lil_matrix`（因其高效的逐元素更新）和用于分析的 `csr_matrix`（因其高效的基于行的操作）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, diags, csr_matrix\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It iterates through each test case, builds the matrices,\n    performs the analysis, and prints the results in the specified format.\n    \"\"\"\n    # Test Suite:\n    # (Nx, Ny, D1, D2, Sigma_r1, Sigma_r2, Sigma_s11, Sigma_s22, Sigma_s12, Sigma_s21)\n    # The problem text labels scatter as g' -> g, but the test case tuple appears\n    # consistent with indexing (e.g. s12 is scatter 1->2). We map accordingly.\n    test_cases = [\n        # Case 1: 2x2 grid, downscatter only\n        (2, 2, 1.0, 0.8, 0.2, 0.1, 0.0, 0.0, 0.05, 0.0),\n        # Case 2: 3x1 grid, full scattering\n        (3, 1, 0.5, 0.5, 0.3, 0.3, 0.1, 0.2, 0.05, 0.02),\n        # Case 3: 1x1 grid, downscatter only\n        (1, 1, 1.2, 1.2, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_case(case)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # str() converts lists and booleans to the required string representation.\n    output_str = \"[\" + \",\".join(map(str, results)) + \"]\"\n    print(output_str)\n\ndef analyze_case(case_params):\n    \"\"\"\n    Analyzes a single test case: builds matrices and computes sparsity metrics.\n    \n    Args:\n        case_params (tuple): A tuple containing all parameters for the test case.\n        \n    Returns:\n        list: A nested list containing the four required analysis results.\n    \"\"\"\n    (Nx, Ny, D1, D2, Sr1, Sr2, Ss11, Ss22, Ss12, Ss21) = case_params\n    N = Nx * Ny\n    \n    # 1. Build Leakage-plus-Removal matrices L_gg\n    L11 = build_leakage_operator(Nx, Ny, D1, Sr1)\n    L22 = build_leakage_operator(Nx, Ny, D2, Sr2)\n\n    # 2. Build Scattering matrices S_gg'\n    # S_gg' is scattering from g' to g.\n    # In notation S_12, g=1, g'=2, representing scatter from 2 -> 1.\n    S11 = diags([Ss11], [0], shape=(N, N), format='csr')\n    S22 = diags([Ss22], [0], shape=(N, N), format='csr')\n    S12 = diags([Ss21], [0], shape=(N, N), format='csr') # 2 -> 1\n    S21 = diags([Ss12], [0], shape=(N, N), format='csr') # 1 -> 2\n\n    # 3. Assemble final block matrices A_gg'\n    A11 = L11 - S11\n    A22 = L22 - S22\n    A12 = -S12\n    A21 = -S21\n\n    # 4. Perform analysis\n    \n    # Item 1: Nonzero counts\n    nnz_A11 = count_nnz(A11)\n    nnz_A12 = count_nnz(A12)\n    nnz_A21 = count_nnz(A21)\n    nnz_A22 = count_nnz(A22)\n    nnz_counts = [nnz_A11, nnz_A12, nnz_A21, nnz_A22]\n    \n    # Item 2: Diagonality check\n    isdiag_A12 = is_diagonal(A12)\n    isdiag_A21 = is_diagonal(A21)\n    diag_indicators = [isdiag_A12, isdiag_A21]\n    \n    # Item 3: Degrees of leakage blocks\n    degrees_L11 = get_degrees(L11)\n    degrees_L22 = get_degrees(L22)\n    \n    return [nnz_counts, diag_indicators, degrees_L11, degrees_L22]\n\ndef build_leakage_operator(Nx, Ny, D, Sigma_r):\n    \"\"\"\n    Constructs the leakage-plus-removal operator L for a single energy group.\n    \n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        D (float): Diffusion coefficient.\n        Sigma_r (float): Removal cross section.\n        \n    Returns:\n        scipy.sparse.csr_matrix: The assembled L matrix.\n    \"\"\"\n    N = Nx * Ny\n    if N == 0:\n        return csr_matrix((0, 0))\n    \n    # Use LIL format for efficient construction\n    mat = lil_matrix((N, N), dtype=np.float64)\n    \n    for k in range(N):\n        i = k % Nx\n        j = k // Nx\n        \n        num_neighbors = 0\n        \n        # Left neighbor\n        if i > 0:\n            k_neighbor = (i - 1) + j * Nx\n            mat[k, k_neighbor] = -D\n            num_neighbors += 1\n        # Right neighbor\n        if i  Nx - 1:\n            k_neighbor = (i + 1) + j * Nx\n            mat[k, k_neighbor] = -D\n            num_neighbors += 1\n        # Bottom neighbor\n        if j > 0:\n            k_neighbor = i + (j - 1) * Nx\n            mat[k, k_neighbor] = -D\n            num_neighbors += 1\n        # Top neighbor\n        if j  Ny - 1:\n            k_neighbor = i + (j + 1) * Nx\n            mat[k, k_neighbor] = -D\n            num_neighbors += 1\n            \n        # Diagonal entry\n        mat[k, k] = num_neighbors * D + Sigma_r\n        \n    return mat.tocsr()\n\ndef apply_threshold(mat, threshold=1e-12):\n    \"\"\"\n    Explicitly zeros out elements of a sparse matrix below a threshold.\n    This function modifies the matrix in place.\n    \"\"\"\n    if mat.nnz > 0:\n        mat.data[np.abs(mat.data)  threshold] = 0.0\n        mat.eliminate_zeros()\n\ndef count_nnz(mat, threshold=1e-12):\n    \"\"\"Counts non-zeros in a matrix after applying a tolerance.\"\"\"\n    mat_copy = mat.copy()\n    apply_threshold(mat_copy, threshold)\n    return mat_copy.nnz\n\ndef is_diagonal(mat, threshold=1e-12):\n    \"\"\"Checks if a sparse matrix is diagonal.\"\"\"\n    mat_copy = mat.copy()\n    apply_threshold(mat_copy, threshold)\n    \n    # A matrix is diagonal if all its non-zero elements have row_idx == col_idx\n    # This correctly handles the all-zero matrix case, as nonzero() returns empty tuples.\n    rows, cols = mat_copy.nonzero()\n    return np.all(rows == cols)\n\ndef get_degrees(mat, threshold=1e-12):\n    \"\"\"\n    Computes the sorted list of unique row-wise non-zero counts (degrees).\n    \"\"\"\n    mat_copy = mat.copy().tocsr()\n    apply_threshold(mat_copy, threshold)\n    \n    # For a CSR matrix, the difference of the indptr array gives nnz per row.\n    row_nnz = np.diff(mat_copy.indptr)\n    unique_degrees = np.unique(row_nnz)\n    return unique_degrees.tolist()\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在掌握了系统矩阵的构建之后，我们现在来研究其数值特性。本练习探讨一种重要的物理现象——中子能量的上散射（upscattering）——如何影响广泛使用的源迭代法的收敛速度。通过计算迭代矩阵的谱半径$ \\rho $，您将能够量化这种影响，并从根本上理解为何在处理包含上散射的问题时，必须采用更高级的预处理或加速技术。",
            "id": "4235000",
            "problem": "考虑一个具有三个能量群的均匀空间单元中的稳态多群中子扩散平衡。对于群 $g \\in \\{1,2,3\\}$，其平衡的代数形式由下式给出\n$$\n\\left(\\Sigma_{r,g} + D_g B^2\\right)\\,\\phi_g \\;=\\; \\sum_{g' \\neq g} \\Sigma_{s,\\,g \\leftarrow g'}\\,\\phi_{g'} \\;+\\; Q_g,\n$$\n其中 $D_g$ 是扩散系数（单位：米），$B^2$ 是几何曲率（单位：米^-2），$\\Sigma_{r,g}$ 是移出宏观截面（单位：米^-1），$\\Sigma_{s,\\,g \\leftarrow g'}$ 是从中子群 $g'$ 到中子群 $g$ 的散射宏观截面（单位：米^-1），$Q_g$ 是外部源（单位：米^-1）。定义对角矩阵\n$$\nA \\;=\\; \\mathrm{diag}\\!\\left(\\Sigma_{r,1}+D_1 B^2,\\; \\Sigma_{r,2}+D_2 B^2,\\; \\Sigma_{r,3}+D_3 B^2\\right),\n$$\n以及非对角散射矩阵 $S$，其元素为当 $g \\neq g'$ 时 $S_{g,g'} = \\Sigma_{s,\\,g \\leftarrow g'}$，当 $g=g'$ 时 $S_{g,g} = 0$。经典源迭代的更新可写为\n$$\n\\boldsymbol{\\phi}^{(k+1)} \\;=\\; A^{-1} S \\,\\boldsymbol{\\phi}^{(k)} \\;+\\; A^{-1} \\boldsymbol{Q}.\n$$\n源迭代的收敛速率由谱半径决定\n$$\n\\rho\\!\\left(A^{-1} S\\right) \\;=\\; \\max_i \\left|\\lambda_i\\!\\left(A^{-1} S\\right)\\right|,\n$$\n其中 $\\lambda_i(\\cdot)$ 表示矩阵参数的特征值。\n\n您的任务是编写一个完整的、可运行的程序，为以下四个测试用例中的每一个计算谱半径 $\\rho\\!\\left(A^{-1} S\\right)$。每个测试用例都指定了扩散系数、几何曲率、移出截面和散射矩阵。所有扩散系数 $D_g$ 的单位是米，所有截面（$\\Sigma_{r,g}$ 和 $S$ 的所有元素）的单位是米^-1，$B^2$ 的单位是米^-2。谱半径是无量纲的，并且必须以浮点数形式报告，保留六位小数。\n\n测试用例 1（无上散射，严格下散射）：\n- $D = [1.0,\\;0.8,\\;0.6]$ 米\n- $B^2 = 0.01$ 米^-2\n- $\\Sigma_r = [0.4,\\;0.25,\\;0.15]$ 米^-1\n- $S = \\begin{bmatrix}\n0.0  0.0  0.0 \\\\\n0.14  0.0  0.0 \\\\\n0.03  0.09  0.0\n\\end{bmatrix}$ 米^-1\n\n测试用例 2（弱上散射）：\n- $D = [1.0,\\;0.8,\\;0.6]$ 米\n- $B^2 = 0.01$ 米^-2\n- $\\Sigma_r = [0.4,\\;0.25,\\;0.15]$ 米^-1\n- $S = \\begin{bmatrix}\n0.0  0.01  0.005 \\\\\n0.14  0.0  0.02 \\\\\n0.03  0.09  0.0\n\\end{bmatrix}$ 米^-1\n\n测试用例 3（强上散射）：\n- $D = [1.0,\\;0.8,\\;0.6]$ 米\n- $B^2 = 0.01$ 米^-2\n- $\\Sigma_r = [0.4,\\;0.25,\\;0.15]$ 米^-1\n- $S = \\begin{bmatrix}\n0.0  0.06  0.03 \\\\\n0.16  0.0  0.07 \\\\\n0.035  0.10  0.0\n\\end{bmatrix}$ 米^-1\n\n测试用例 4（接近一个具有显著上散射和减少的泄漏/移出的挑战性区域）：\n- $D = [1.4,\\;1.1,\\;0.7]$ 米\n- $B^2 = 0.003$ 米^-2\n- $\\Sigma_r = [0.22,\\;0.16,\\;0.10]$ 米^-1\n- $S = \\begin{bmatrix}\n0.0  0.07  0.035 \\\\\n0.10  0.0  0.05 \\\\\n0.03  0.07  0.0\n\\end{bmatrix}$ 米^-1\n\n程序要求：\n- 对于每个测试用例，构建 $A$ 和 $S$，形成 $M = A^{-1} S$，并计算 $\\rho(M)$ 作为 $M$ 的特征值的最大绝对值。\n- 将每个谱半径表示为浮点数，四舍五入到六位小数（无量纲）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[r1,r2,r3,r4]”），其中 $r_i$ 对应于按所列顺序的测试用例 $i$ 的谱半径。\n\n此外，在您的解决方案中，请从第一性原理出发，解释为什么上散射会以增加 $\\rho\\!\\left(A^{-1}S\\right)$ 的方式修改矩阵结构，以及为什么当 $\\rho\\!\\left(A^{-1}S\\right)$ 接近 1 时，必须采用隐式处理上散射的预处理策略来恢复快速收敛。",
            "solution": "问题要求在不同散射条件下计算多群中子扩散方程的源迭代矩阵的谱半径，并对上散射对收敛性的影响给出理论解释。\n\n均匀介质的稳态多群扩散方程可以写成矩阵形式。对于群注量率向量 $\\boldsymbol{\\phi} = [\\phi_1, \\phi_2, \\dots, \\phi_G]^T$ 和外部源向量 $\\boldsymbol{Q} = [Q_1, Q_2, \\dots, Q_G]^T$，平衡方程为：\n$$\n(L+R)\\boldsymbol{\\phi} = S\\boldsymbol{\\phi} + \\boldsymbol{Q}\n$$\n在这里，$L$ 是表示由于泄漏导致的中子损失的矩阵，$R$ 是表示由于移出（吸收和群外散射）导致的中子损失的矩阵。$S$ 是入散射矩阵。在这个问题中，总损失算子由对角矩阵 $A$ 给出，其对角元素为 $A_{gg} = \\Sigma_{r,g} + D_g B^2$。该项结合了群 $g$ 内的移出（由宏观移出截面 $\\Sigma_{r,g}$ 表征）和群 $g$ 离开空间区域的泄漏（由 $D_g B^2$ 近似）。因此，$A \\equiv L+R$。矩阵 $S$ 包含非对角散射截面 $\\Sigma_{s, g \\leftarrow g'}$，表示中子从群 $g'$ 散射到群 $g$。该问题可以紧凑地表示为：\n$$\nA\\boldsymbol{\\phi} = S\\boldsymbol{\\phi} + \\boldsymbol{Q}\n$$\n经典源迭代法通过显式处理整个散射源项 $S\\boldsymbol{\\phi}$ 来求解该系统。给定前一次迭代的注量率向量估计值 $\\boldsymbol{\\phi}^{(k)}$，下一个估计值 $\\boldsymbol{\\phi}^{(k+1)}$ 通过求解以下方程得到：\n$$\nA\\boldsymbol{\\phi}^{(k+1)} = S\\boldsymbol{\\phi}^{(k)} + \\boldsymbol{Q}\n$$\n由于 $A$ 是一个对角矩阵，其逆矩阵 $A^{-1}$ 的计算非常简单（它是一个对角矩阵，其元素是 $A$ 对角元的倒数）。因此，迭代可以写成：\n$$\n\\boldsymbol{\\phi}^{(k+1)} = A^{-1}S\\boldsymbol{\\phi}^{(k)} + A^{-1}\\boldsymbol{Q}\n$$\n这是一种形式为 $\\boldsymbol{x}^{(k+1)} = M\\boldsymbol{x}^{(k)} + \\boldsymbol{c}$ 的不动点迭代，其中迭代矩阵为 $M = A^{-1}S$。如果迭代矩阵的谱半径 $\\rho(M)$ 小于 1，则保证此类迭代的收敛。渐近收敛速率由 $\\rho(M)$ 决定；$\\rho(M)$ 越接近 1，收敛越慢。谱半径定义为矩阵特征值的最大绝对值：$\\rho(M) = \\max_i |\\lambda_i(M)|$。\n\n让我们分析迭代矩阵 $M$ 的结构及其对散射性质的依赖性。按照惯例，能量群从高能到低能进行索引（群 1 是最快的，群 $G$ 是最慢的）。\n- **下散射**：中子碰撞导致能量损失，使其从一个较高能量的群 $g'$ 移动到一个较低能量的群 $g$（其中 $g  g'$）。在散射矩阵 $S$ 中，这对应于矩阵严格下三角部分的非零元素 $S_{gg'}$。\n- **上散射**：中子碰撞导致能量增益，使其从一个较低能量的群 $g'$ 移动到一个较高能量的群 $g$（其中 $g  g'$）。这在物理上仅对与热慢化剂核碰撞而获得能量的热中子有重要意义。在散射矩阵 $S$ 中，这对应于矩阵严格上三角部分的非零元素 $S_{gg'}$。\n\n**上散射对谱半径 $\\rho(A^{-1}S)$ 的影响**\n\n1.  **情况 1：无上散射（严格下散射）**\n    当只存在下散射时，散射矩阵 $S$ 是严格下三角矩阵。其上三角和对角线元素均为零。矩阵 $A$ 是具有正元素的对角矩阵。迭代矩阵 $M = A^{-1}S$ 是一个对角矩阵和一个严格下三角矩阵的乘积，结果是另一个严格下三角矩阵。三角矩阵的一个基本性质是其特征值就是其对角元素。对于一个严格下三角矩阵，所有对角元素都为零。因此，$M$ 的所有特征值都为零，其谱半径为 $\\rho(M) = 0$。这意味着源迭代在有限步数内收敛（对于一个 $G$ 群问题，最多 $G$ 次迭代），因为矩阵 $M$ 是幂零的（$M^G = 0$）。测试用例 1 例证了这种情况。\n\n2.  **情况 2：存在上散射**\n    当发生上散射时，矩阵 $S$ 在其上三角部分有非零元素。因此，迭代矩阵 $M = A^{-1}S$ 不再是三角矩阵。它具有更一般的结构，在对角线的上方和下方都有非零元素。这种结构在能量群耦合中引入了循环。例如，一个中子可以从群 1 下散射到群 2，然后又从群 2 上散射回群 1。这种双向耦合意味着矩阵 $M$ 不再是幂零的，并且可以有非零的特征值。这些特征值的大小，以及谱半径，取决于耦合项（$S$ 的元素）相对于移出项（$A$ 的对角元素）的强度。随着 $S$ 中上散射项的量值增加，或者 $A$ 中移出/泄漏项的量值减少（例如，在一个大的、低吸收的系统中），$M$ 的特征值的量值趋于增加。这导致谱半径 $\\rho(M)$ 增加，从而减慢了源迭代的收敛速度。当 $\\rho(M)$ 接近 1 时，收敛所需的迭代次数可能会变得非常大，以至于不切实际。\n\n**对上散射问题进行预处理的必要性**\n\n当强上散射和低移出/泄漏导致 $\\rho(A^{-1}S)$ 接近 1 时，标准源迭代是不切实际的。必须使用加速技术或预处理。收敛缓慢的原因是，对整个散射矩阵 $S$ 的显式处理未能捕捉到由上散射引入的群之间的强隐式耦合。\n\n一种常见且有效的预处理策略是隐式处理有问题的上散射项。我们可以将散射矩阵 $S$ 分解为其严格下三角部分 $S_L$（下散射）和其严格上三角部分 $S_U$（上散射）：$S = S_L + S_U$。\n原始方程 $A\\boldsymbol{\\phi} = (S_L + S_U)\\boldsymbol{\\phi} + \\boldsymbol{Q}$ 可以重新排列为：\n$$\n(A - S_U)\\boldsymbol{\\phi} = S_L\\boldsymbol{\\phi} + \\boldsymbol{Q}\n$$\n这提出了另一种迭代方案：\n$$\n(A - S_U)\\boldsymbol{\\phi}^{(k+1)} = S_L\\boldsymbol{\\phi}^{(k)} + \\boldsymbol{Q}\n$$\n更新步骤是 $\\boldsymbol{\\phi}^{(k+1)} = (A - S_U)^{-1}S_L\\boldsymbol{\\phi}^{(k)} + (A - S_U)^{-1}\\boldsymbol{Q}$。这个预处理方案的迭代矩阵是 $M' = (A - S_U)^{-1}S_L$。\n矩阵 $(A - S_U)$ 是上三角矩阵（因为 $A$ 是对角矩阵，$S_U$ 是严格上三角矩阵），并且其对角元素是 $A$ 的正元素。因此，它总是可逆的，并且可以在每个迭代步骤中使用回代法高效地求解该系统。通过将上散射项移到左手边，我们在每次迭代中都隐式地求解其影响。生成的迭代矩阵 $M'$ 通常比原始的 $M = A^{-1}(S_L+S_U)$ 具有小得多的谱半径，从而极大地加速了收敛。该方法在正向求解方向上有效地解耦了能量群，打破了减慢原始迭代速度的循环。\n\n现在将基于公式 $\\rho(A^{-1}S)$ 对四个测试用例进行数值计算。\n对于每种情况：\n1. 构建对角矩阵 $A$，其元素为 $A_{gg} = \\Sigma_{r,g} + D_g B^2$。\n2. 对 $A$ 求逆得到 $A^{-1}$。\n3. 形成迭代矩阵 $M = A^{-1} S$。\n4. 计算 $M$ 的特征值。\n5. 找到特征值的最大绝对值以获得谱半径 $\\rho(M)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the spectral radius for the source iteration matrix in multigroup\n    neutron diffusion for four test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"D\": np.array([1.0, 0.8, 0.6]),\n            \"B2\": 0.01,\n            \"Sigma_r\": np.array([0.4, 0.25, 0.15]),\n            \"S\": np.array([\n                [0.0, 0.0, 0.0],\n                [0.14, 0.0, 0.0],\n                [0.03, 0.09, 0.0]\n            ])\n        },\n        {\n            \"D\": np.array([1.0, 0.8, 0.6]),\n            \"B2\": 0.01,\n            \"Sigma_r\": np.array([0.4, 0.25, 0.15]),\n            \"S\": np.array([\n                [0.0, 0.01, 0.005],\n                [0.14, 0.0, 0.02],\n                [0.03, 0.09, 0.0]\n            ])\n        },\n        {\n            \"D\": np.array([1.0, 0.8, 0.6]),\n            \"B2\": 0.01,\n            \"Sigma_r\": np.array([0.4, 0.25, 0.15]),\n            \"S\": np.array([\n                [0.0, 0.06, 0.03],\n                [0.16, 0.0, 0.07],\n                [0.035, 0.10, 0.0]\n            ])\n        },\n        {\n            \"D\": np.array([1.4, 1.1, 0.7]),\n            \"B2\": 0.003,\n            \"Sigma_r\": np.array([0.22, 0.16, 0.10]),\n            \"S\": np.array([\n                [0.0, 0.07, 0.035],\n                [0.10, 0.0, 0.05],\n                [0.03, 0.07, 0.0]\n            ])\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        D = case[\"D\"]\n        B2 = case[\"B2\"]\n        Sigma_r = case[\"Sigma_r\"]\n        S = case[\"S\"]\n\n        # 1. Construct the diagonal matrix A.\n        # A_gg = Sigma_r,g + D_g * B^2\n        A_diag = Sigma_r + D * B2\n        \n        # A is a diagonal matrix.\n        # A = np.diag(A_diag)\n\n        # 2. Invert A. For a diagonal matrix, the inverse is a diagonal\n        # matrix with the reciprocal of the diagonal elements. This is more\n        # efficient than a general inversion.\n        A_inv_diag = 1.0 / A_diag\n        A_inv = np.diag(A_inv_diag)\n        \n        # 3. Form the iteration matrix M = A^-1 * S.\n        M = A_inv @ S\n\n        # 4. Compute the eigenvalues of M.\n        eigenvalues = np.linalg.eigvals(M)\n        \n        # 5. Find the spectral radius as the maximum absolute value of the eigenvalues.\n        spectral_radius = np.max(np.abs(eigenvalues))\n        \n        results.append(spectral_radius)\n\n    # Format results to six decimal places and print in the required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}