{
    "hands_on_practices": [
        {
            "introduction": "在反应堆中子学计算中，为了在可接受的计算成本内捕捉关键物理现象，通常需要简化复杂的几何结构。这种简化的过程被称为均匀化。这项实践将通过一个常见的例子——带中心孔的环形燃料芯块——来介绍几何均匀化的基本思想，您将通过推导一个有效“弥散”密度来练习质量守恒原理的应用，这一过程旨在为更复杂的均匀化方法奠定概念基础。",
            "id": "4228069",
            "problem": "轻水反应堆栅元中的一个圆柱形燃料芯块带有一个半径为 $R_{h}$ 的中心轴向孔，其燃料外半径为 $R_{f}$，且 $R_{h}  R_{f}$。固体燃料材料具有体积质量密度 $\\rho_{\\text{bulk}}$，该密度是假设材料填充整个无孔圆柱体时所能达到的密度。在组件栅格的中子学均匀化处理中，通常将环形燃料区替换为占据整个半径 $R_{f}$ 的均匀“弥散”燃料，其选择应保证单位长度的总燃料质量守恒。\n\n从单位长度质量守恒以及圆盘和环形面积的基本几何关系出发，推导有效弥散燃料密度 $\\rho_{\\text{eff}}$ 关于 $\\rho_{\\text{bulk}}$、$R_{h}$ 和 $R_{f}$ 的闭式解析表达式。在您的推理中，请明确地将均匀化步骤描述为将实际环形燃料的单位长度质量与密度为 $\\rho_{\\text{eff}}$ 的均匀圆盘的单位长度质量相等同。\n\n然后，运用中子输运第一性原理和宏观截面，定性解释当栅元嵌入组件栅格时，用密度为 $\\rho_{\\text{eff}}$ 的弥散燃料替换环形燃料将如何改变栅元中的共振自屏效应，重点关注核数密度和光学厚度的作用。本讨论无需进行数值评估。\n\n请以 $\\rho_{\\text{eff}}$ 的单个闭式解析表达式的形式提供最终答案。最终答案框中不要包含单位。无需进行四舍五入。",
            "solution": "该问题要求分为两部分：首先，推导环形燃料芯块的有效弥散燃料密度 $\\rho_{\\text{eff}}$；其次，定性解释这种均匀化如何影响共振自屏效应。\n\n首先，我们来推导有效弥散燃料密度 $\\rho_{\\text{eff}}$。指导这种均匀化的基本原理是单位长度的总燃料质量守恒。\n\n我们考虑一段单位长度的燃料棒。实际燃料呈环形，内半径为 $R_{h}$，外半径为 $R_{f}$。燃料材料本身具有均匀的体积质量密度，记为 $\\rho_{\\text{bulk}}$。此环形燃料区单位长度的体积等于其横截面积 $A_{\\text{annulus}}$。环形的面积是外圆盘的面积减去内圆盘的面积。\n$$A_{\\text{annulus}} = \\pi R_{f}^{2} - \\pi R_{h}^{2} = \\pi (R_{f}^{2} - R_{h}^{2})$$\n环形燃料单位长度的质量 $m_{\\text{annulus}}$ 是其单位长度的体积与其密度的乘积。\n$$m_{\\text{annulus}} = \\rho_{\\text{bulk}} \\times A_{\\text{annulus}} = \\rho_{\\text{bulk}} \\pi (R_{f}^{2} - R_{h}^{2})$$\n\n接下来，我们考虑均匀化模型。在该模型中，环形燃料被一个具有相同外半径 $R_{f}$ 的均匀实心圆柱盘燃料所取代。中心孔被这种“弥散”燃料材料填充。这个均匀化燃料盘具有一个我们需要确定的有效弥散密度 $\\rho_{\\text{eff}}$。这个均匀化燃料盘单位长度的体积是其横截面积 $A_{\\text{smeared}}$。\n$$A_{\\text{smeared}} = \\pi R_{f}^{2}$$\n这个均匀化燃料盘单位长度的质量 $m_{\\text{smeared}}$ 是其单位长度的体积与其有效密度的乘积。\n$$m_{\\text{smeared}} = \\rho_{\\text{eff}} \\times A_{\\text{smeared}} = \\rho_{\\text{eff}} \\pi R_{f}^{2}$$\n\n均匀化的核心要求是单位长度的总燃料质量守恒。因此，我们必须令实际环形燃料的单位长度质量与弥散盘的单位长度质量相等。\n$$m_{\\text{annulus}} = m_{\\text{smeared}}$$\n代入上面推导出的表达式：\n$$\\rho_{\\text{bulk}} \\pi (R_{f}^{2} - R_{h}^{2}) = \\rho_{\\text{eff}} \\pi R_{f}^{2}$$\n现在我们可以通过分离变量来求解有效弥散密度 $\\rho_{\\text{eff}}$。两边的因子 $\\pi$ 可以消去。\n$$\\rho_{\\text{eff}} = \\rho_{\\text{bulk}} \\frac{R_{f}^{2} - R_{h}^{2}}{R_{f}^{2}}$$\n该表达式可以简化为最终形式：\n$$\\rho_{\\text{eff}} = \\rho_{\\text{bulk}} \\left(1 - \\frac{R_{h}^{2}}{R_{f}^{2}}\\right) = \\rho_{\\text{bulk}} \\left(1 - \\left(\\frac{R_{h}}{R_{f}}\\right)^{2}\\right)$$\n这个结果在物理上是直观的。由于弥散体积大于实际燃料体积，有效密度 $\\rho_{\\text{eff}}$ 必须小于块体材料密度 $\\rho_{\\text{bulk}}$，这与当 $R_{h} > 0$ 时因子 $\\left(1 - (R_{h}/R_{f})^2\\right)$ 小于 1 的情况是一致的。\n\n其次，我们定性解释这种均匀化如何改变共振自屏效应。共振自屏效应是核反应堆中一个关键的非均匀效应。在称为共振峰的特定中子能量下，像 $^{238}\\text{U}$ 这样的燃料同位素的吸收截面 $\\sigma_{a}$ 会变得极大。\n\n在实际的环形几何结构中，燃料材料具有很高的体积极数密度 $N_{\\text{bulk}}$，它与质量密度 $\\rho_{\\text{bulk}}$ 成正比。因此，在共振能量下，燃料中的宏观吸收截面 $\\Sigma_{a, \\text{bulk}} = N_{\\text{bulk}} \\sigma_{a}$ 非常高。这使得燃料环在光学上是厚的（光学厚）。从中子慢化剂或中心孔进入燃料的中子，在非常靠近燃料区表面的地方就被吸收了。这在燃料体内部的共振能量处造成了中子通量的显著凹陷。燃料内部的原子核被表面的原子核“屏蔽”，从而免受共振能量中子的影响。与通量均匀的情况相比，这降低了总体的有效吸收率。\n\n当我们用弥散模型替换环形燃料时，会发生两个关键变化。首先，正如我们所推导的，有效密度降低了：$\\rho_{\\text{eff}}  \\rho_{\\text{bulk}}$。这直接意味着燃料原子的有效核数密度也降低了：$N_{\\text{eff}}  N_{\\text{bulk}}$。其次，几何形状从空心环形变为实心圆盘；原先允许中子流注的中心空洞，现在被（实际上是）稀释的燃料-慢化剂混合物所填充。\n\n核数密度的降低导致有效宏观截面变小，即 $\\Sigma_{a, \\text{eff}} = N_{\\text{eff}} \\sigma_{a}  \\Sigma_{a, \\text{bulk}}$。较低的宏观截面意味着中子的平均自由程更长，燃料介质在光学上变得更透明（光学薄）。因此，燃料表面的严重通量凹陷得以减轻。中子在被吸收前可以更深入地穿透到燃料区域。均匀化过程本质上是用一个较弱、更弥散的吸收体取代了一个强的、空间局域的吸收体。\n\n通过降低光学厚度和使材料分布平滑化，均匀化处理从本质上削弱了自屏效应。该模型不再能捕捉非均匀系统特有的强表面吸收和内部通量凹陷。结果是，在弥散燃料模型中计算出的共振吸收率将高于环形栅元中的实际吸收率，因为该模型低估了自屏效应。从实践的角度来看，使用此类均匀化模型的反应堆分析程序必须应用修正因子，以弥补对共振自屏效应的这种低估。",
            "answer": "$$\n\\boxed{\\rho_{\\text{bulk}} \\left(1 - \\left(\\frac{R_{h}}{R_{f}}\\right)^{2}\\right)}\n$$"
        },
        {
            "introduction": "处理了空间几何之后，下一个挑战是管理中子相互作用的能量依赖性，这通常通过多群方法来解决。这项实践是一个动手编程练习，旨在将详细的70群横截面数据压缩为实用的2群结构，其核心是必须保持反应率不变。通过此练习，您不仅能掌握群常数生成的标准流程，还能深刻理解加权谱在此过程中的关键作用。",
            "id": "4228080",
            "problem": "给定具有燃料棒栅元分辨率的细能群数据，这些数据代表了核反应堆模拟中组件栅格内的单个燃料棒。目标是将 $G=70$ 个能群的细能群宏观反应数据并群至 $2$ 个能群，并量化在使用两种不同权重谱（无限栅格权重谱和经泄漏调整的权重谱）时，所得并群常数的方差。\n\n从以下基本定义开始：\n- 对于宏观截面为 $\\Sigma_{X,g}$ 和标量通量为 $\\phi_g$ 的宏观反应，其在 $g$ 群的反应率密度为 $R_{X,g}=\\Sigma_{X,g}\\,\\phi_g$。此处 $X$ 表示特定的反应类型，即吸收和裂变产生。\n- 并群后的 $H$ 群宏观常数 $\\overline{\\Sigma}_{X,H}$ 是一个唯一的常数，当它乘以 $H$ 群中适当加权的平均通量时，能够再现对属于 $H$ 的所有细能群积分得到的总反应率。在离散多群设置中，这是通过使用谱 $w_g$ 进行加权并强制保持反应率守恒来实现的，从而得到离散通量加权平均定义：\n$$\\overline{\\Sigma}_{X,H}=\\dfrac{\\sum_{g\\in H}\\Sigma_{X,g}\\,w_g}{\\sum_{g\\in H}w_g}$$\n\n将使用两种权重谱：\n1. 无限栅格权重，定义为 $w_g=\\phi_g$。\n2. 经泄漏调整的权重，定义为 $w_g=\\tilde{\\phi}_g$，其中 $\\tilde{\\phi}_g=\\max\\left(\\phi_g-\\lambda\\,L_g,\\epsilon\\right)$，$\\epsilon$ 是一个微小的正数下限，以防止除以零，$L_g$ 是泄漏谱估计。泄漏项模拟了有限组件环境中由净中子流引起的中子能谱软化或硬化。\n\n将 $G=70$ 个细能群划分为 $2$ 个并合群，如下所示：\n- 第 $H=1$ 群（快中子/超热中子群）：索引 $g=0,1,\\dots,29$。\n- 第 $H=2$ 群（热中子群）：索引 $g=30,31,\\dots,69$。\n\n通过参数化生成器，为您提供了用于标量通量 $\\phi_g$、吸收反应率密度 $R_{a,g}$ 和裂变产生反应率密度 $R_{p,g}$ 的合成但物理上合理的燃料棒分辨细能群数据，以及一个泄漏谱 $L_g$。对于每个测试用例，必须使用以下构造和参数值来生成输入：\n\n所有测试用例的通用构造：\n- 设能群索引为 $g\\in\\{0,1,\\dots,69\\}$，其中 $g=0$ 是最高能群，$g=69$ 是最低能（热）群。\n- 通量分解为一个超热尾部和一个热峰：\n$$\\phi_g=\\frac{A}{g+1}+B\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s^2}\\right).$$\n- 吸收宏观截面形状：\n$$\\Sigma_{a,g}=\\sigma_{a,0}+\\sigma_{a,1}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_a^2}\\right)+\\frac{\\sigma_{a,2}}{g+1}.$$\n- 裂变产生宏观项：\n$$\\nu\\Sigma_{f,g}=\\sigma_{p,0}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_f^2}\\right)+\\frac{\\sigma_{p,1}}{\\sqrt{g+1}}.$$\n- 反应率密度：\n$$R_{a,g}=\\Sigma_{a,g}\\,\\phi_g,\\qquad R_{p,g}=\\nu\\Sigma_{f,g}\\,\\phi_g.$$\n- 泄漏谱估计器（燃料棒内能谱梯度的有限差分幅度）：\n$$L_g=c_{\\ell}\\,\\left|\\phi_g-\\phi_{g+1}\\right|,\\quad\\text{with}\\quad \\phi_{70}\\equiv\\phi_{69}\\ \\text{for the boundary},$$\n  以及泄漏调整下限 $\\epsilon=10^{-12}$，以在所有除法运算中保持数值稳定性。\n- 单位：$\\phi_g$ 的单位为 $\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}$，$R_{a,g}$ 和 $R_{p,g}$ 的单位为 $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$，$\\Sigma_{a,g}$ 和 $\\nu\\Sigma_{f,g}$ 的单位为 $\\text{cm}^{-1}$，$L_g$ 的单位为 $\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}$。所有并群宏观常数 $\\overline{\\Sigma}_{a,H}$ 和 $\\overline{\\nu\\Sigma}_{f,H}$ 的单位均为 $\\text{cm}^{-1}$。\n\n通过选择一个非负参数 $\\lambda$ 并计算以下公式来定义经泄漏调整的谱\n$$\\tilde{\\phi}_g=\\max\\left(\\phi_g-\\lambda\\,L_g,\\,\\epsilon\\right).$$\n\n对于每个测试用例，使用无限栅格权重和经泄漏调整的权重计算并群后的双群宏观吸收和裂变产生常数。然后，对于每个并合群 $H\\in\\{1,2\\}$ 和每种反应类型 $X\\in\\{a,\\,p\\}$（其中 $p$ 表示裂变产生），计算两种权重计算结果的方差，\n$$\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{X,H}\\right)=\\frac{1}{2}\\sum_{k\\in\\{\\text{inf},\\text{leak}\\}}\\left(\\overline{\\Sigma}_{X,H}^{(k)}-\\overline{\\Sigma}_{X,H}^{\\text{mean}}\\right)^2,\\quad \\overline{\\Sigma}_{X,H}^{\\text{mean}}=\\frac{\\overline{\\Sigma}_{X,H}^{(\\text{inf})}+\\overline{\\Sigma}_{X,H}^{(\\text{leak})}}{2}.$$\n方差的单位是 $\\left(\\text{cm}^{-1}\\right)^2$。\n\n包含三个用例的测试套件，用于探究不同的能谱和泄漏状态：\n- 用例1（热化燃料棒，中等泄漏）：\n  - $A=1.0$, $B=5.0$, $g_t=65$, $s=3.0$,\n  - $\\sigma_{a,0}=0.02$, $\\sigma_{a,1}=0.5$, $s_a=5.0$, $\\sigma_{a,2}=0.01$,\n  - $\\sigma_{p,0}=0.7$, $s_f=4.0$, $\\sigma_{p,1}=0.02$,\n  - $c_{\\ell}=1.0$, $\\lambda=0.05$.\n- 用例2（较硬能谱燃料棒，较强泄漏）：\n  - $A=3.0$, $B=0.5$, $g_t=60$, $s=5.0$,\n  - $\\sigma_{a,0}=0.01$, $\\sigma_{a,1}=0.2$, $s_a=7.0$, $\\sigma_{a,2}=0.03$,\n  - $\\sigma_{p,0}=0.2$, $s_f=6.0$, $\\sigma_{p,1}=0.05$,\n  - $c_{\\ell}=2.0$, $\\lambda=0.10$.\n- 用例3（热化燃料棒，无泄漏调整的边界情况）：\n  - $A=1.0$, $B=5.0$, $g_t=65$, $s=3.0$,\n  - $\\sigma_{a,0}=0.02$, $\\sigma_{a,1}=0.5$, $s_a=5.0$, $\\sigma_{a,2}=0.01$,\n  - $\\sigma_{p,0}=0.7$, $s_f=4.0$, $\\sigma_{p,1}=0.02$,\n  - $c_{\\ell}=1.0$, $\\lambda=0.00$.\n\n您的程序必须：\n- 对于每个测试用例，使用上述公式和参数构建细能群数组 $\\phi_g$, $\\Sigma_{a,g}$, $\\nu\\Sigma_{f,g}$, $R_{a,g}$, $R_{p,g}$ 和 $L_g$。\n- 计算两种权重谱下的并群双群宏观吸收和裂变产生常数。\n- 为每个测试用例计算四个方差 $\\left[\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,1}\\right),\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,2}\\right),\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,1}\\right),\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,2}\\right)\\right]$，单位为 $\\left(\\text{cm}^{-1}\\right)^2$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表内容按测试用例排序，且每个测试用例内的结果按上述顺序列出。具体而言，输出必须是 $$\\left[\\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,1}\\right),\\ \\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,2}\\right),\\ \\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,1}\\right),\\ \\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,2}\\right),\\ \\text{case}_2\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,1}\\right),\\dots,\\ \\text{case}_3\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,2}\\right)\\right],$$ 其中每个条目都是一个单位为 $\\left(\\text{cm}^{-1}\\right)^2$ 的浮点数。",
            "solution": "问题陈述已经过严格验证，并被确定为有效。它在科学上基于核反应堆物理的原理，特别是多群中子输运理论。该问题是适定的，所有必要的数据、公式和约束都已明确定义，确保了唯一且可计算的解。其语言客观，设置自洽且在数学上合理。\n\n核心任务是执行宏观截面的能群并合，这是反应堆分析中的一种标准技术，用于在保留基本物理特性的同时降低计算复杂性。其基本原理是反应率守恒。粗能群 $H$ 中的总反应率必须等于构成 $H$ 群的所有细能群 $g$ 的反应率之和。\n给定类型为 $X$ 的反应，粗群 $H$ 中的总反应率为 $\\sum_{g \\in H} R_{X,g} = \\sum_{g \\in H} \\Sigma_{X,g}\\,\\phi_g$。我们寻求一个并群截面 $\\overline{\\Sigma}_{X,H}$，使得该反应率可以通过 $\\overline{\\Sigma}_{X,H}\\,\\overline{\\phi}_H$ 再现，其中 $\\overline{\\phi}_H$ 是 $H$ 群中的总通量，定义为 $\\overline{\\phi}_H = \\sum_{g \\in H} \\phi_g$。令两者相等可得：\n$$\n\\overline{\\Sigma}_{X,H} \\left( \\sum_{g \\in H} \\phi_g \\right) = \\sum_{g \\in H} \\Sigma_{X,g}\\,\\phi_g \\implies \\overline{\\Sigma}_{X,H} = \\frac{\\sum_{g \\in H} \\Sigma_{X,g}\\,\\phi_g}{\\sum_{g \\in H} \\phi_g}\n$$\n这正是问题陈述中给出的当权重谱 $w_g$ 是标量通量 $\\phi_g$ 本身时的公式。该问题通过引入任意权重谱 $w_g$ 来推广这一概念，从而得到离散通量加权平均定义：\n$$\n\\overline{\\Sigma}_{X,H} = \\frac{\\sum_{g\\in H}\\Sigma_{X,g}\\,w_g}{\\sum_{g\\in H}w_g}\n$$\n此计算必须针对权重谱 $w_g$ 的两种不同选择来执行：\n1.  **无限栅格权重**：$w_g = \\phi_g$。该谱是概念上无限、周期性的燃料棒栅格中子学环境的特征，远离任何边界或材料不连续性。\n2.  **经泄漏调整的权重**：$w_g = \\tilde{\\phi}_g = \\max(\\phi_g - \\lambda L_g, \\epsilon)$。该谱是对无限栅格通量的一种修正，旨在近似有限尺寸燃料组件中中子泄漏（净中子流）的影响。参数 $\\lambda$ 控制此调整的幅度，而下限 $\\epsilon$ 确保数值稳定性。\n\n通过对提供的三个测试用例中的每一个执行直接的计算步骤来获得解。\n\n**步骤1：生成细能群数据**\n对于每个测试用例，我们首先生成必要的 $G=70$ 细能群中子学数据。能群索引范围从 $g=0$ 到 $g=69$。\n标量通量 $\\phi_g$、吸收截面 $\\Sigma_{a,g}$ 和裂变产生项 $\\nu\\Sigma_{f,g}$ 使用给定的参数化公式和该用例的特定参数进行计算：\n$$\n\\phi_g = \\frac{A}{g+1} + B\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s^2}\\right)\n$$\n$$\n\\Sigma_{a,g} = \\sigma_{a,0} + \\sigma_{a,1}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_a^2}\\right) + \\frac{\\sigma_{a,2}}{g+1}\n$$\n$$\n\\nu\\Sigma_{f,g} = \\sigma_{p,0}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_f^2}\\right) + \\frac{\\sigma_{p,1}}{\\sqrt{g+1}}\n$$\n泄漏谱估计器 $L_g$ 被计算为通量谱的有限差分幅度。对于 $g \\in \\{0, 1, \\dots, 68\\}$，$L_g = c_{\\ell}|\\phi_g - \\phi_{g+1}|$。对于边界群 $g=69$，问题指定 $\\phi_{70} \\equiv \\phi_{69}$，这意味着 $L_{69} = c_{\\ell}|\\phi_{69} - \\phi_{69}| = 0$。所要求的反应率 $R_{a,g}=\\Sigma_{a,g}\\phi_g$ 和 $R_{p,g}=\\nu\\Sigma_{f,g}\\phi_g$ 也被构建出来。\n\n**步骤2：能群并合**\n将 $70$ 个细能群划分为 $2$ 个粗群：第 $H=1$ 群（快中子/超热中子群，$g \\in \\{0, \\dots, 29\\}$）和第 $H=2$ 群（热中子群，$g \\in \\{30, \\dots, 69\\}$）。对于每种反应类型（$X=a$ 代表吸收，$X=p$ 代表裂变产生）和每个粗群（$H=1, 2$），我们使用两种权重方案计算并群常数。\n\n对于**无限栅格权重**，我们使用 $w_g = \\phi_g$。例如，第1群的并群吸收截面为：\n$$\n\\overline{\\Sigma}_{a,1}^{(\\text{inf})} = \\frac{\\sum_{g=0}^{29} \\Sigma_{a,g}\\,\\phi_g}{\\sum_{g=0}^{29} \\phi_g}\n$$\n其他三个常数 $\\overline{\\Sigma}_{a,2}^{(\\text{inf})}$、$\\overline{\\nu\\Sigma}_{f,1}^{(\\text{inf})}$ 和 $\\overline{\\nu\\Sigma}_{f,2}^{(\\text{inf})}$，通过将公式应用于适当的截面数据和能群索引，以类似的方式计算得出。\n\n对于**经泄漏调整的权重**，我们首先计算权重谱 $w_g = \\tilde{\\phi}_g = \\max(\\phi_g - \\lambda L_g, \\epsilon)$，其中 $\\epsilon = 10^{-12}$。然后，第1群的并群吸收截面为：\n$$\n\\overline{\\Sigma}_{a,1}^{(\\text{leak})} = \\frac{\\sum_{g=0}^{29} \\Sigma_{a,g}\\,\\tilde{\\phi}_g}{\\sum_{g=0}^{29} \\tilde{\\phi}_g}\n$$\n类似地，我们计算 $\\overline{\\Sigma}_{a,2}^{(\\text{leak})}$、$\\overline{\\nu\\Sigma}_{f,1}^{(\\text{leak})}$ 和 $\\overline{\\nu\\Sigma}_{f,2}^{(\\text{leak})}$。\n\n**步骤3：方差计算**\n最后一步是量化两种权重方案结果之间的差异。对于每一对并群常数（$\\overline{\\Sigma}_{X,H}^{(\\text{inf})}$ 和 $\\overline{\\Sigma}_{X,H}^{(\\text{leak})}$），计算其方差。所提供的公式 $\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{X,H}\\right)=\\frac{1}{2}\\sum_{k}\\left(\\overline{\\Sigma}_{X,H}^{(k)}-\\overline{\\Sigma}_{X,H}^{\\text{mean}}\\right)^2$，对于一个包含两个样本的总体，可简化为半差的平方：\n$$\n\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{X,H}\\right) = \\left( \\frac{\\overline{\\Sigma}_{X,H}^{(\\text{inf})} - \\overline{\\Sigma}_{X,H}^{(\\text{leak})}}{2} \\right)^2\n$$\n对三个测试用例中的每一个，都为所有四对常数（$X \\in \\{a, p\\}$, $H \\in \\{1, 2\\}$）执行此计算。对于用例3，其中泄漏调整参数 $\\lambda=0$，经泄漏调整的谱 $\\tilde{\\phi}_g$ 变得与无限栅格通量 $\\phi_g$ 相同（因为 $\\phi_g \\gg \\epsilon$），因此预期 $\\overline{\\Sigma}_{X,H}^{(\\text{inf})} = \\overline{\\Sigma}_{X,H}^{(\\text{leak})}$ 且所有所得方差均为零。这可作为对数值实现的重要验证检查。\n\n整个过程使用 Python 的 `numpy` 库实现，该库非常适合所需的向量化数值计算。三个测试用例的结果根据输出格式要求汇总到单个列表中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Solves the group condensation problem for three test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: thermalized pin, moderate leakage\n        {\n            \"A\": 1.0, \"B\": 5.0, \"g_t\": 65.0, \"s\": 3.0,\n            \"sigma_a_0\": 0.02, \"sigma_a_1\": 0.5, \"s_a\": 5.0, \"sigma_a_2\": 0.01,\n            \"sigma_p_0\": 0.7, \"s_f\": 4.0, \"sigma_p_1\": 0.02,\n            \"c_l\": 1.0, \"lambda\": 0.05\n        },\n        # Case 2: harder spectrum pin, stronger leakage\n        {\n            \"A\": 3.0, \"B\": 0.5, \"g_t\": 60.0, \"s\": 5.0,\n            \"sigma_a_0\": 0.01, \"sigma_a_1\": 0.2, \"s_a\": 7.0, \"sigma_a_2\": 0.03,\n            \"sigma_p_0\": 0.2, \"s_f\": 6.0, \"sigma_p_1\": 0.05,\n            \"c_l\": 2.0, \"lambda\": 0.10\n        },\n        # Case 3: thermalized pin, no leakage adjustment\n        {\n            \"A\": 1.0, \"B\": 5.0, \"g_t\": 65.0, \"s\": 3.0,\n            \"sigma_a_0\": 0.02, \"sigma_a_1\": 0.5, \"s_a\": 5.0, \"sigma_a_2\": 0.01,\n            \"sigma_p_0\": 0.7, \"s_f\": 4.0, \"sigma_p_1\": 0.02,\n            \"c_l\": 1.0, \"lambda\": 0.00\n        }\n    ]\n\n    epsilon = 1.0e-12\n    num_groups = 70\n    g = np.arange(num_groups, dtype=np.float64)\n\n    group1_indices = slice(0, 30)\n    group2_indices = slice(30, num_groups)\n\n    all_results = []\n\n    for params in test_cases:\n        # Step 1: Generate fine-group data\n        phi_g = (params[\"A\"] / (g + 1.0) +\n                 params[\"B\"] * np.exp(-(g - params[\"g_t\"])**2 / (2.0 * params[\"s\"]**2)))\n\n        Sigma_a_g = (params[\"sigma_a_0\"] +\n                     params[\"sigma_a_1\"] * np.exp(-(g - params[\"g_t\"])**2 / (2.0 * params[\"s_a\"]**2)) +\n                     params[\"sigma_a_2\"] / (g + 1.0))\n\n        nuSigma_f_g = (params[\"sigma_p_0\"] * np.exp(-(g - params[\"g_t\"])**2 / (2.0 * params[\"s_f\"]**2)) +\n                       params[\"sigma_p_1\"] / np.sqrt(g + 1.0))\n\n        # These are requested but not used in the final variance calculation\n        # R_a_g = Sigma_a_g * phi_g\n        # R_p_g = nuSigma_f_g * phi_g\n\n        # Calculate L_g with boundary condition phi_70 = phi_69\n        phi_g_plus_1 = np.append(phi_g[1:], phi_g[-1])\n        L_g = params[\"c_l\"] * np.abs(phi_g - phi_g_plus_1)\n\n        # Step 2: Group Condensation\n        # Define weighting spectra\n        w_inf = phi_g\n        w_leak = np.maximum(phi_g - params[\"lambda\"] * L_g, epsilon)\n\n        def condense(sigma_fine, weight_fine, group_slice):\n            \"\"\"Performs group condensation for a single coarse group.\"\"\"\n            numerator = np.sum(sigma_fine[group_slice] * weight_fine[group_slice])\n            denominator = np.sum(weight_fine[group_slice])\n            return numerator / denominator if denominator != 0.0 else 0.0\n\n        # Condense using infinite-lattice weighting\n        Sigma_a1_inf = condense(Sigma_a_g, w_inf, group1_indices)\n        Sigma_a2_inf = condense(Sigma_a_g, w_inf, group2_indices)\n        nuSigma_f1_inf = condense(nuSigma_f_g, w_inf, group1_indices)\n        nuSigma_f2_inf = condense(nuSigma_f_g, w_inf, group2_indices)\n\n        # Condense using leakage-adjusted weighting\n        Sigma_a1_leak = condense(Sigma_a_g, w_leak, group1_indices)\n        Sigma_a2_leak = condense(Sigma_a_g, w_leak, group2_indices)\n        nuSigma_f1_leak = condense(nuSigma_f_g, w_leak, group1_indices)\n        nuSigma_f2_leak = condense(nuSigma_f_g, w_leak, group2_indices)\n\n        # Step 3: Variance Calculation\n        def calculate_variance(val_inf, val_leak):\n            \"\"\"Calculates variance for a population of two values.\"\"\"\n            return ((val_inf - val_leak) / 2.0)**2\n\n        var_a1 = calculate_variance(Sigma_a1_inf, Sigma_a1_leak)\n        var_a2 = calculate_variance(Sigma_a2_inf, Sigma_a2_leak)\n        var_p1 = calculate_variance(nuSigma_f1_inf, nuSigma_f1_leak)\n        var_p2 = calculate_variance(nuSigma_f2_inf, nuSigma_f2_leak)\n\n        all_results.extend([var_a1, var_a2, var_p1, var_p2])\n\n    # Final print statement in the exact required format.\n    # Using scientific notation to handle potentially very small numbers.\n    print(f\"[{','.join(f'{r:.12e}' for r in all_results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "这项最终的实践练习整合了空间、能量和时间（燃耗）这几个维度，模拟了一项真实的工程任务。您将从详细的燃料棒功率历史出发，生成用于更大尺度堆芯模拟的、考虑了燃耗依赖性的均匀化节块横截面。本练习将引入反应性加权这一高级概念，展示如何在非均匀、演化的系统中正确地对物理量进行平均。",
            "id": "4228064",
            "problem": "您的任务是，从第一性原理出发，构建一种方法，从棒功率历史计算组件级节点反应性加权燃耗图，并使用该图生成与燃耗相关的均匀化宏观吸收截面。背景是一个单一的燃料组件，该组件被建模为一个由相同的燃料棒组成的矩形栅格，并被细分为多个节点区域。目标是使用基本定义和经过充分检验的近似方法，将棒元物理与组件栅格均匀化联系起来。\n\n该组件包含 $N_p = 16$ 个燃料棒，排列成一个 $4 \\times 4$ 的网格。组件被细分为 $N_n = 4$ 个方形节点，呈 $2 \\times 2$ 模式排列，每个节点包含一个 $2 \\times 2$ 的燃料棒块。设节点索引为 $n \\in \\{0,1,2,3\\}$，由燃料棒索引块定义：\n- 节点 $0$：行 $0$-$1$，列 $0$-$1$，\n- 节点 $1$：行 $0$-$1$，列 $2$-$3$，\n- 节点 $2$：行 $2$-$3$，列 $0$-$1$，\n- 节点 $3$：行 $2$-$3$，列 $2$-$3$。\n所有燃料棒具有相同的燃料质量 $M_p = 0.5\\ \\mathrm{kgU}$ 和相同的体积 $V_p = 400\\ \\mathrm{cm}^3$。燃耗必须以兆瓦日/千克铀（MWd/kgU）表示。\n\n基本原理和定义：\n- 时间离散化的棒功率历史以兆瓦（MW）为单位给出，表示为 $P_p(t_i)$，涵盖 $N_t = 4$ 个等长的时间步长，每个步长为 $\\Delta t = 10\\ \\mathrm{days}$。\n- 燃料棒燃耗 $B_p$ 定义为该棒累积的单位燃料质量的能量，即\n$$\nB_p = \\frac{1}{M_p}\\sum_{i=0}^{N_t-1} P_p(t_i)\\,\\Delta t,\n$$\n当 $P_p$ 的单位为 $\\mathrm{MW}$ 且 $\\Delta t$ 的单位为 $\\mathrm{days}$ 时，该公式计算出的燃耗单位为 $\\mathrm{MWd/kgU}$。\n- 均匀化宏观吸收截面必须以逆厘米（$\\mathrm{cm}^{-1}$）为单位进行计算。\n- 您必须使用基于反应性价值的重要性加权来定义节点燃耗，其动机源于一阶中子微扰理论和适用于轻水反应堆栅格的物理上合理的近似。最终的节点量是节点反应性加权燃耗 $B_n^{\\mathrm{rw}}$。\n- 均匀化截面必须通过对每个节点内各燃料棒的与燃耗相关的宏观截面进行通量-体积加权来获得。\n\n棒宏观截面模型：\n- 将宏观裂变截面 $\\Sigma_{f,p}(B)$ 和宏观吸收截面 $\\Sigma_{a,p}(B)$ 视为燃耗 $B$ 的线性函数，其系数取决于燃料棒在 $4 \\times 4$ 栅格中是内部棒还是边缘/角部棒：\n    - 对于内部棒（行 $1$-$2$ 和列 $1$-$2$）：\n        $$\n        \\Sigma_{f,p}(B) = 0.120 - 2.0\\times 10^{-6}\\,B,\\quad \\Sigma_{a,p}(B) = 0.090 + 4.0\\times 10^{-6}\\,B.\n        $$\n    - 对于边缘或角部棒（所有其他索引）：\n        $$\n        \\Sigma_{f,p}(B) = 0.115 - 1.5\\times 10^{-6}\\,B,\\quad \\Sigma_{a,p}(B) = 0.095 + 3.0\\times 10^{-6}\\,B.\n        $$\n  $\\Sigma_{f,p}$ 和 $\\Sigma_{a,p}$ 的单位是 $\\mathrm{cm}^{-1}$，而 $B$ 的单位是 $\\mathrm{MWd/kgU}$。\n\n通量和加权近似：\n- 在轻水反应堆栅格物理学中，单个能群中的中子平衡可以通过扩散理论来表示，而一阶中子微扰理论表明，反应性重要性与伴随通量和局部算子微扰的乘积成正比。对于实用的组件级均匀化，假设正向通量和伴随通量的形状相同，并使用最后一个时间步的棒功率 $P_p(t_{N_t-1})$ 来构建正向通量 $\\phi_p$ 的代理，根据\n$$\n\\phi_p \\propto \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p},\n$$\n其中比例常数在比率计算中被抵消。\n\n您的程序必须：\n1. 计算所有测试案例中所有燃料棒的燃耗 $B_p$，单位为 $\\mathrm{MWd/kgU}$。\n2. 通过构建物理上合理的燃料棒重要性权重 $w_p$ 并聚合到节点，推导出反应性加权节点燃耗图 $B_n^{\\mathrm{rw}}$。您必须论证并实现一种与一阶微扰理论和上述通量近似一致的反应性加权方法。对于节点 $n$，计算\n$$\nB_n^{\\mathrm{rw}} = \\frac{\\sum_{p\\in n} w_p\\,B_p}{\\sum_{p\\in n} w_p},\n$$\n并以 $\\mathrm{MWd/kgU}$ 为单位输出四舍五入到三位小数的值。\n3. 使用通量-体积加权和与燃耗相关的宏观吸收截面，为每个节点计算在所计算出的节点燃耗下的均匀化宏观吸收截面 $\\Sigma_{a,n}^{\\mathrm{hom}}$。使用如上所述的最后一个时间步的通量代理 $\\phi_p$，计算\n$$\n\\Sigma_{a,n}^{\\mathrm{hom}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,\\phi_p\\,V_p}{\\sum_{p\\in n} \\phi_p\\,V_p},\n$$\n并以 $\\mathrm{cm}^{-1}$ 为单位输出四舍五入到五位小数的值。\n\n测试套件：\n使用以下三种棒功率历史案例（单位为 $\\mathrm{MW}$）。对于每个案例 $k\\in\\{1,2,3\\}$，$P^{(k)}(t_i)$ 均以 $4\\times 4$ 矩阵的形式给出，其中 $i\\in\\{0,1,2,3\\}$。\n\n案例 $1$：\n$$\nP^{(1)}(t_0) =\n\\begin{bmatrix}\n0.30  0.35  0.35  0.30\\\\\n0.35  0.45  0.45  0.35\\\\\n0.35  0.45  0.45  0.35\\\\\n0.30  0.35  0.35  0.30\n\\end{bmatrix},\\quad\nP^{(1)}(t_1) =\n\\begin{bmatrix}\n0.28  0.33  0.33  0.28\\\\\n0.34  0.48  0.48  0.34\\\\\n0.34  0.48  0.48  0.34\\\\\n0.28  0.33  0.33  0.28\n\\end{bmatrix},\n$$\n$$\nP^{(1)}(t_2) =\n\\begin{bmatrix}\n0.26  0.31  0.31  0.26\\\\\n0.33  0.50  0.50  0.33\\\\\n0.33  0.50  0.50  0.33\\\\\n0.26  0.31  0.31  0.26\n\\end{bmatrix},\\quad\nP^{(1)}(t_3) =\n\\begin{bmatrix}\n0.25  0.30  0.30  0.25\\\\\n0.32  0.52  0.52  0.32\\\\\n0.32  0.52  0.52  0.32\\\\\n0.25  0.30  0.30  0.25\n\\end{bmatrix}.\n$$\n\n案例 $2$：\n$$\nP^{(2)}(t_0) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix},\\quad\nP^{(2)}(t_1) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix},\n$$\n$$\nP^{(2)}(t_2) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix},\\quad\nP^{(2)}(t_3) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix}.\n$$\n\n案例 $3$：\n$$\nP^{(3)}(t_0) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.40  0.40  0.30\\\\\n0.30  0.40  0.40  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix},\\quad\nP^{(3)}(t_1) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.42  0.42  0.30\\\\\n0.30  0.42  0.42  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix},\n$$\n$$\nP^{(3)}(t_2) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.44  0.44  0.30\\\\\n0.30  0.44  0.44  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix},\\quad\nP^{(3)}(t_3) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.46  0.46  0.30\\\\\n0.30  0.46  0.46  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix}.\n$$\n\n角度单位不适用。不涉及百分比；任何分数答案都必须以十进制形式表示。您的程序必须处理这三个案例，并生成一行输出，其中包含一个以方括号括起来的逗号分隔列表形式的结果，其中每个案例的条目是一个包含两个列表的列表：第一个是节点反应性加权燃耗（单位 $\\mathrm{MWd/kgU}$，四舍五入到三位小数），第二个是相应的均匀化宏观吸收截面（单位 $\\mathrm{cm}^{-1}$，四舍五入到五位小数）。例如，输出格式必须是\n$$\n\\left[\\left[\\left[b_{0},b_{1},b_{2},b_{3}\\right],\\left[\\sigma_{0},\\sigma_{1},\\sigma_{2},\\sigma_{3}\\right]\\right],\\ \\text{案例 2 结果},\\ \\text{案例 3 结果}\\right].\n$$",
            "solution": "用户提供了一个核反应堆物理领域的问题，具体涉及从棒级数据对燃料组件属性进行均匀化处理。\n\n对问题陈述的验证确认了其科学性、适定性和客观性。它包含了进行求解所需的所有必要数据和模型。问题的核心在于，基于所提供的物理背景，为燃料棒燃耗推导出一个合适的反应性加权因子。下面从第一性原理出发，进行了严谨的推导，随后是分步计算过程。\n\n**1. 理论阐述**\n\n该问题需要一个多步骤的计算，从棒级功率历史开始，最终得到均匀化的节点参数。\n\n**1.1. 燃料棒燃耗计算**\n每个燃料棒 $p$ 的燃耗 $B_p$ 是初始重金属单位质量产生的总能量。给定以兆瓦（$\\mathrm{MW}$）为单位的棒功率历史 $P_p(t_i)$，涵盖 $N_t$ 个时间步长，每个步长为 $\\Delta t$ 天，以及以千克铀（$\\mathrm{kgU}$）为单位的初始铀质量 $M_p$，燃耗计算如下：\n$$\nB_p = \\frac{1}{M_p}\\sum_{i=0}^{N_t-1} P_p(t_i)\\,\\Delta t\n$$\n如题目要求，$B_p$ 的单位将是 $\\mathrm{MWd/kgU}$。\n\n**1.2. 棒宏观截面**\n宏观裂变（$\\Sigma_{f,p}$）和吸收（$\\Sigma_{a,p}$）截面被给定为燃料棒燃耗 $B_p$ 的线性函数。这些线性模型的系数取决于燃料棒在 $4 \\times 4$ 组件栅格中的位置。问题区分了“内部”棒和“边缘/角部”棒。我们将与燃耗相关的截面表示为 $\\Sigma_{f,p}(B_p)$ 和 $\\Sigma_{a,p}(B_p)$。\n\n**1.3. 反应性权重 $w_p$ 的推导**\n问题要求使用特定于燃料棒的重要性权重 $w_p$ 来计算节点反应性加权燃耗 $B_n^{\\mathrm{rw}}$。这些权重必须从一阶中子微扰理论和所提供的近似中推导出来。\n\n在反应堆物理学中，中子的“重要性”由伴随通量 $\\phi^*$ 给出。系统的总反应性与总的重要性加权裂变中子产生率有关。一阶微扰理论反应性表达式的分母是 $F = \\langle \\phi^*, \\mathcal{F} \\phi \\rangle = \\int \\phi^*(\\mathbf{r}) \\nu\\Sigma_f(\\mathbf{r}) \\phi(\\mathbf{r}) dV$，其中 $\\mathcal{F}$ 是裂变算子。该项表示裂变中子在维持链式反应中的总有效性。\n\n任何棒级物理量的一个物理上合理的权重可以是它对这个总有效性的贡献。单个燃料棒 $p$ 的贡献近似为 $(\\phi_p^*)(\\nu\\Sigma_{f,p}\\phi_p V_p)$。问题陈述假设伴随通量形状与正向通量形状成正比，即 $\\phi_p^* \\propto \\phi_p$。因此，燃料棒 $p$ 的贡献与 $\\phi_p (\\nu\\Sigma_{f,p}\\phi_p V_p) = \\nu\\Sigma_{f,p}\\phi_p^2 V_p$ 成正比。\n\n常数 $\\nu$（每次裂变释放的中子数）在整个组件中是均匀的，将在加权平均公式中被抵消。因此，一个合适的燃料棒重要性权重 $w_p$ 是：\n$$\nw_p \\propto \\Sigma_{f,p}(B_p)\\,\\phi_p^2\\,V_p\n$$\n问题基于最后一个时间步的棒功率 $P_p(t_{N_t-1})$ 提供了一个正向通量 $\\phi_p$ 的代理：\n$$\n\\phi_p \\propto \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p}\n$$\n设比例常数为 $C$。将此代入权重 $w_p$ 的表达式中：\n$$\nw_p \\propto \\Sigma_{f,p}(B_p) \\left( C \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p} \\right)^2 V_p = C^2 \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)\\,V_p}\n$$\n由于所有燃料棒的体积 $V_p$ 相同，并且常数 $C^2$ 是全局的，它们在加权平均中都将被抵消。因此，反应性权重 $w_p$ 的最终简化表达式为：\n$$\nw_p = \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)}\n$$\n该权重是无量纲的，代表了燃料棒属性的反应性重要性。\n\n**1.4. 节点反应性加权燃耗 ($B_n^{\\mathrm{rw}}$)**\n定义了权重 $w_p$ 后，节点 $n$ 的反应性加权燃耗是该节点内所有燃料棒燃耗的加权平均值：\n$$\nB_n^{\\mathrm{rw}} = \\frac{\\sum_{p\\in n} w_p\\,B_p}{\\sum_{p\\in n} w_p} = \\frac{\\sum_{p\\in n} \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)}\\,B_p}{\\sum_{p\\in n} \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)}}\n$$\n\n**1.5. 均匀化节点宏观吸收截面 ($\\Sigma_{a,n}^{\\mathrm{hom}}$)**\n节点的均匀化吸收截面 $\\Sigma_{a,n}^{\\mathrm{hom}}$ 使用通量-体积加权计算。公式如下：\n$$\n\\Sigma_{a,n}^{\\mathrm{hom}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,\\phi_p\\,V_p}{\\sum_{p\\in n} \\phi_p\\,V_p}\n$$\n使用所提供的通量代理，加权项 $\\phi_p V_p$ 变为：\n$$\n\\phi_p V_p = \\left( C \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p} \\right) V_p = C \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}\n$$\n常数 $C$ 在比率中被抵消，留下燃料棒 $p$ 的加权因子为 $W_{FV,p} = \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}$。因此，均匀化截面的公式是棒吸收截面 $\\Sigma_{a,p}(B_p)$ 的加权平均值：\n$$\n\\Sigma_{a,n}^{\\mathrm{hom}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,W_{FV,p}}{\\sum_{p\\in n} W_{FV,p}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,\\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}}{\\sum_{p\\in n} \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}}\n$$\n\n**2. 计算步骤**\n\n针对三个测试案例，按照推导出的公式执行求解。\n\n1.  **定义常量和几何结构**：定义常量 $M_p = 0.5\\ \\mathrm{kgU}$、$\\Delta t = 10\\ \\mathrm{days}$ 和 $V_p = 400\\ \\mathrm{cm}^3$。使用一个 $4 \\times 4$ 的布尔矩阵来区分内部棒和边缘/角部棒。节点边界定义为完整的 $4 \\times 4$ 棒阵列的 $2 \\times 2$ 切片。\n\n2.  **处理每个测试案例**：对于每个案例的功率历史数据 $P^{(k)}(t_i)$：\n    a.  通过对所有时间步的功率矩阵求和并乘以 $\\Delta t / M_p$，计算 $4 \\times 4$ 的棒燃耗矩阵 $B_p$。\n    b.  根据棒类型图和计算出的燃耗矩阵 $B_p$，使用各自的线性模型，计算 $4 \\times 4$ 的棒最终截面矩阵 $\\Sigma_{f,p}(B_p)$ 和 $\\Sigma_{a,p}(B_p)$。\n    c.  使用最后一个时间步的功率 $P_p(t_3)$ 和最终裂变截面 $\\Sigma_{f,p}(B_p)$，计算 $4 \\times 4$ 的反应性权重矩阵 $w_p$。\n    d.  对于四个节点中的每一个（$n \\in \\{0,1,2,3\\}$）：\n        i.  对 $B_p$ 和 $w_p$ 矩阵进行切片，以提取当前节点中燃料棒的值。\n        ii. 使用节点加权平均公式计算 $B_n^{\\mathrm{rw}}$。\n    e.  对于四个节点中的每一个：\n        i.  计算通量-体积加权因子 $W_{FV,p} = P_p(t_3)/\\Sigma_{f,p}(B_p)$。\n        ii. 对上述因子和 $\\Sigma_{a,p}(B_p)$ 矩阵进行切片，以提取当前节点的值。\n        iii. 使用节点加权平均公式计算截面 $\\Sigma_{a,n}^{\\mathrm{hom}}$。\n    f.  存储结果，并按指定精度四舍五入：$B_n^{\\mathrm{rw}}$ 保留三位小数，$\\Sigma_{a,n}^{\\mathrm{hom}}$ 保留五位小数。\n\n3.  **最终输出**：将所有三个案例的结果组合成指定的列表格式，并作为单行打印。\n\n这种结构化的方法确保了问题的所有要求都得到满足，并遵循了所提供的物理原理和数学定义。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes nodal reactivity-weighted burnup and homogenized macroscopic absorption\n    cross sections for a fuel assembly based on pin-wise power histories.\n    \"\"\"\n    # Define problem constants\n    M_p = 0.5  # kgU\n    delta_t = 10.0  # days\n    # V_p = 400.0 cm^3, but it cancels out in all calculations\n\n    # Test cases for pin-wise power histories P(t_i) in MW\n    test_cases_power = [\n        # Case 1\n        [\n            np.array([[0.30, 0.35, 0.35, 0.30], [0.35, 0.45, 0.45, 0.35], [0.35, 0.45, 0.45, 0.35], [0.30, 0.35, 0.35, 0.30]]),\n            np.array([[0.28, 0.33, 0.33, 0.28], [0.34, 0.48, 0.48, 0.34], [0.34, 0.48, 0.48, 0.34], [0.28, 0.33, 0.33, 0.28]]),\n            np.array([[0.26, 0.31, 0.31, 0.26], [0.33, 0.50, 0.50, 0.33], [0.33, 0.50, 0.50, 0.33], [0.26, 0.31, 0.31, 0.26]]),\n            np.array([[0.25, 0.30, 0.30, 0.25], [0.32, 0.52, 0.52, 0.32], [0.32, 0.52, 0.52, 0.32], [0.25, 0.30, 0.30, 0.25]]),\n        ],\n        # Case 2\n        [\n            np.full((4, 4), 0.40),\n            np.full((4, 4), 0.40),\n            np.full((4, 4), 0.40),\n            np.full((4, 4), 0.40),\n        ],\n        # Case 3\n        [\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.40, 0.40, 0.30], [0.30, 0.40, 0.40, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.42, 0.42, 0.30], [0.30, 0.42, 0.42, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.44, 0.44, 0.30], [0.30, 0.44, 0.44, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.46, 0.46, 0.30], [0.30, 0.46, 0.46, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n        ],\n    ]\n\n    # Assembly geometry\n    # A map of pin types: True for Interior, False for Edge/Corner\n    is_interior_map = np.full((4, 4), False)\n    is_interior_map[1:3, 1:3] = True\n\n    # Node definitions (slices for the 4x4 array)\n    node_slices = [\n        np.s_[0:2, 0:2],  # Node 0\n        np.s_[0:2, 2:4],  # Node 1\n        np.s_[2:4, 0:2],  # Node 2\n        np.s_[2:4, 2:4],  # Node 3\n    ]\n\n    # Cross section model coefficients\n    # Coeffs for Sigma(B) = C0 + C1*B\n    # Fission cross section coefficients\n    sf_c0_int, sf_c1_int = 0.120, -2.0e-6\n    sf_c0_edge, sf_c1_edge = 0.115, -1.5e-6\n    # Absorption cross section coefficients\n    sa_c0_int, sa_c1_int = 0.090, 4.0e-6\n    sa_c0_edge, sa_c1_edge = 0.095, 3.0e-6\n\n    def get_sigma_f(B, is_interior):\n        return np.where(is_interior, sf_c0_int + sf_c1_int * B, sf_c0_edge + sf_c1_edge * B)\n\n    def get_sigma_a(B, is_interior):\n        return np.where(is_interior, sa_c0_int + sa_c1_int * B, sa_c0_edge + sa_c1_edge * B)\n\n    # Main processing loop\n    results = []\n    for power_history in test_cases_power:\n        # 1. Compute pin burnups B_p\n        total_energy_per_pin = sum(power_history) * delta_t\n        B_p = total_energy_per_pin / M_p\n\n        # 2. Compute final pin-wise cross sections\n        Sigma_f_p = get_sigma_f(B_p, is_interior_map)\n        Sigma_a_p = get_sigma_a(B_p, is_interior_map)\n        P_p_final = power_history[-1]\n\n        # 3. Compute nodal reactivity-weighted burnup B_n^rw\n        reactivity_weights_w_p = P_p_final**2 / Sigma_f_p\n        \n        nodal_burnups = []\n        for node_slice in node_slices:\n            w_p_node = reactivity_weights_w_p[node_slice]\n            B_p_node = B_p[node_slice]\n            numerator = np.sum(w_p_node * B_p_node)\n            denominator = np.sum(w_p_node)\n            B_n_rw = numerator / denominator if denominator != 0 else 0\n            nodal_burnups.append(round(B_n_rw, 3))\n\n        # 4. Compute homogenized macroscopic absorption cross sections Sigma_a,n^hom\n        flux_volume_weights_W_FVp = P_p_final / Sigma_f_p\n\n        nodal_sigmas = []\n        for node_slice in node_slices:\n            W_FVp_node = flux_volume_weights_W_FVp[node_slice]\n            Sigma_a_p_node = Sigma_a_p[node_slice]\n            numerator = np.sum(Sigma_a_p_node * W_FVp_node)\n            denominator = np.sum(W_FVp_node)\n            Sigma_a_n_hom = numerator / denominator if denominator != 0 else 0\n            nodal_sigmas.append(round(Sigma_a_n_hom, 5))\n        \n        results.append([nodal_burnups, nodal_sigmas])\n\n    # Final print statement in the exact required format\n    # The string conversion here is a bit tricky to match the format precisely.\n    # We avoid spaces after commas within the inner lists.\n    case_strings = []\n    for res in results:\n        b_str = f\"[{','.join(map(str, res[0]))}]\"\n        s_str = f\"[{','.join(map(str, res[1]))}]\"\n        case_strings.append(f\"[{b_str},{s_str}]\")\n    \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        }
    ]
}