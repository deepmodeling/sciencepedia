{
    "hands_on_practices": [
        {
            "introduction": "The concept of self-shielding is central to accurately predicting reaction rates in a reactor, quantifying the depression of neutron flux within the energy range of a strong resonance. The Narrow Resonance (NR) approximation represents one theoretical limit where the flux is assumed to be undepressed, while the Wide Resonance (WR) approximation represents the opposite extreme of maximum depression. This practice challenges you to derive and compare the self-shielding factors for these limits, as well as for an intermediate case, providing a quantitative feel for the impact of different flux models on the effective absorption rate .",
            "id": "4223807",
            "problem": "Consider a homogeneous infinite medium containing a dilute concentration of uranium-238 ($^{238}\\mathrm{U}$) acting as a resonance absorber. In the resolved resonance region, model a single isolated $s$-wave capture resonance centered at energy $E_{0} = 6.67\\,\\mathrm{eV}$ by the simplified single-level Breit–Wigner form with constant widths, written in Lorentzian notation for the absorption microscopic cross section,\n$$\n\\sigma_{a}(E) = \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}},\n$$\nwhere $\\sigma_{r}$ is the resonance peak value and $\\gamma = \\Gamma/2$ is the half-width. Take $\\sigma_{r} = 2500\\,\\mathrm{b}$ and $\\gamma = 0.30\\,\\mathrm{eV}$. Use the Equivalence Theory representation of the slowing-down flux depression near resonance via a constant “background” cross section $\\sigma_{0}$ that lumps geometry and non-resonant interactions into an equivalent energy-independent term, and adopt $\\sigma_{0} = 30\\,\\mathrm{b}$. Normalize the flux such that, far from the resonance where $\\sigma_{a}(E) \\approx 0$, the flux amplitude is unity.\n\nDefine the self-shielding factor $f$ for this single resonance as the ratio of the resonance absorption rate under a specified flux model to the unshielded absorption rate under constant flux:\n$$\nf \\equiv \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE}.\n$$\nCompute and compare the following three self-shielding factors:\n- The Narrow Resonance factor $f_{\\mathrm{NR}}$, taking $\\phi(E)$ constant across the resonance.\n- The Wide Resonance factor $f_{\\mathrm{WR}}$, taking $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)}$.\n- The Intermediate Resonance factor $f_{\\mathrm{IR}}$, taking $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)}$ with $p = 0.60$.\n\nStarting from the stated definitions and models (Lorentzian cross section and the flux forms above grounded in Equivalence Theory), derive closed-form expressions for $f_{\\mathrm{NR}}$, $f_{\\mathrm{WR}}$, and $f_{\\mathrm{IR}}$, and then evaluate them numerically for the given parameters. Treat the energy integration bounds as extending to infinity, justified by the resonance’s narrow width relative to the lethargy mesh. Express each of $f_{\\mathrm{NR}}$, $f_{\\mathrm{WR}}$, and $f_{\\mathrm{IR}}$ as a dimensionless number rounded to four significant figures. Finally, quantitatively compare their predictions in the sense of ranking their magnitudes and commenting on the degree of self-shielding implied by each.",
            "solution": "The problem is first validated to be scientifically grounded, well-posed, objective, and complete. All necessary physical models, definitions, and numerical parameters are provided, and they are consistent with established principles of nuclear reactor physics, specifically the theory of resonance absorption. The problem is a standard exercise in applying equivalence theory and different resonance approximations (Narrow, Wide, Intermediate). Thus, we proceed with the solution.\n\nThe self-shielding factor, $f$, is defined as the ratio of the actual (shielded) resonance absorption rate to the hypothetical unshielded rate:\n$$\nf \\equiv \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE}\n$$\nThe denominator of this expression is the unshielded resonance integral, which we denote as $I_{unsh}$. Using the given Lorentzian form for the absorption cross section, $\\sigma_{a}(E) = \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}$, we can evaluate this integral. Let $x = E - E_0$, so $dx = dE$. The integration limits remain $(-\\infty, \\infty)$.\n$$\nI_{unsh} = \\int_{-\\infty}^{\\infty} \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}\\,dE = \\sigma_{r}\\gamma^{2} \\int_{-\\infty}^{\\infty} \\frac{dx}{x^{2} + \\gamma^{2}}\n$$\nThis is a standard integral form.\n$$\nI_{unsh} = \\sigma_{r}\\gamma^{2} \\left[ \\frac{1}{\\gamma} \\arctan\\left(\\frac{x}{\\gamma}\\right) \\right]_{-\\infty}^{\\infty} = \\sigma_{r}\\gamma \\left( \\arctan(+\\infty) - \\arctan(-\\infty) \\right) = \\sigma_{r}\\gamma \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right)\n$$\n$$\nI_{unsh} = \\pi \\gamma \\sigma_{r}\n$$\nThis result for the unshielded resonance integral serves as the normalization for all three cases.\n\nWe now compute the self-shielding factor for each of the three specified flux models.\n\n**1. Narrow Resonance (NR) Factor, $f_{\\mathrm{NR}}$**\n\nThe Narrow Resonance approximation assumes the resonance is so narrow that any scattering collision within it removes the neutron from the resonance energy range. Consequently, the flux is not depressed by absorption within the resonance and remains at its asymptotic value. Given the normalization of unity far from the resonance, we have $\\phi(E) = 1$.\n$$\nf_{\\mathrm{NR}} = \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,(1)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE} = \\frac{I_{unsh}}{I_{unsh}} = 1\n$$\nThe analytical expression is $f_{\\mathrm{NR}} = 1$. Numerically, this is $1.000$.\n\n**2. Wide Resonance (WR) Factor, $f_{\\mathrm{WR}}$**\n\nThe Wide Resonance approximation assumes the resonance is so broad that a neutron cannot escape it by a single scattering collision. The flux is therefore depressed according to the steady-state slowing-down equation, which, under the specified model conditions, yields $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)}$. The numerator for the factor $f_{\\mathrm{WR}}$ is the shielded resonance integral, $I_{sh, WR}$:\n$$\nI_{sh, WR} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)} dE\n$$\nLet us analyze the integrand by substituting the expression for $\\sigma_a(E)$:\n$$\n\\frac{\\sigma_{a}(E)}{\\sigma_{0} + \\sigma_{a}(E)} = \\frac{\\sigma_{r}\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}}{\\sigma_{0} + \\sigma_{r}\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}} = \\frac{\\sigma_{r}\\gamma^{2}}{\\sigma_{0}((E-E_{0})^{2} + \\gamma^{2}) + \\sigma_{r}\\gamma^{2}}\n$$\nThus, the integral becomes:\n$$\nI_{sh, WR} = \\int_{-\\infty}^{\\infty} \\frac{\\sigma_{0}\\sigma_{r}\\gamma^{2}}{\\sigma_{0}(E-E_{0})^{2} + \\sigma_{0}\\gamma^{2} + \\sigma_{r}\\gamma^{2}} dE\n$$\nLet's factor $\\sigma_0$ from the denominator of the integrand and let $x = E - E_0$:\n$$\nI_{sh, WR} = \\sigma_{r}\\gamma^{2} \\int_{-\\infty}^{\\infty} \\frac{dx}{x^{2} + \\gamma^{2}(1 + \\frac{\\sigma_r}{\\sigma_0})}\n$$\nThis is again the arctangent integral form, where the constant term in the denominator corresponds to $a^{2} = \\gamma^{2}(1 + \\frac{\\sigma_r}{\\sigma_0})$, so $a = \\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}$.\n$$\nI_{sh, WR} = \\sigma_{r}\\gamma^{2} \\left[ \\frac{1}{\\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}} \\arctan\\left(\\frac{x}{\\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\\right) \\right]_{-\\infty}^{\\infty}\n$$\n$$\nI_{sh, WR} = \\frac{\\sigma_{r}\\gamma}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}} (\\pi) = \\frac{\\pi \\gamma \\sigma_r}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\n$$\nThe self-shielding factor is then:\n$$\nf_{\\mathrm{WR}} = \\frac{I_{sh, WR}}{I_{unsh}} = \\frac{\\frac{\\pi \\gamma \\sigma_r}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}}{\\pi \\gamma \\sigma_r} = \\frac{1}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\n$$\nUsing the given values $\\sigma_{r} = 2500\\,\\mathrm{b}$ and $\\sigma_{0} = 30\\,\\mathrm{b}$:\n$$\nf_{\\mathrm{WR}} = \\frac{1}{\\sqrt{1 + \\frac{2500}{30}}} = \\frac{1}{\\sqrt{1 + \\frac{250}{3}}} = \\frac{1}{\\sqrt{\\frac{253}{3}}} = \\sqrt{\\frac{3}{253}} \\approx 0.108893\n$$\nRounded to four significant figures, $f_{\\mathrm{WR}} = 0.1089$.\n\n**3. Intermediate Resonance (IR) Factor, $f_{\\mathrm{IR}}$**\n\nThe Intermediate Resonance model uses an interpolation parameter $p$ to bridge the NR and WR limits, with the flux given by $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)}$. The calculation is formally identical to the WR case, with the replacement $\\sigma_r \\rightarrow p \\sigma_r$ in the final analytical expression for $f_{\\mathrm{WR}}$. Let's verify this quickly. The shielded integral is:\n$$\nI_{sh, IR} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)} dE\n$$\nThe derivation proceeds exactly as for $f_{\\mathrm{WR}}$, but the term corresponding to $\\frac{\\sigma_r}{\\sigma_0}$ becomes $p\\frac{\\sigma_r}{\\sigma_0}$. Therefore, the closed-form expression for $f_{\\mathrm{IR}}$ is:\n$$\nf_{\\mathrm{IR}} = \\frac{1}{\\sqrt{1 + p\\frac{\\sigma_r}{\\sigma_0}}}\n$$\nUsing the given values, including $p = 0.60$:\n$$\nf_{\\mathrm{IR}} = \\frac{1}{\\sqrt{1 + (0.60)\\left(\\frac{2500}{30}\\right)}} = \\frac{1}{\\sqrt{1 + (0.60)\\left(\\frac{250}{3}\\right)}} = \\frac{1}{\\sqrt{1 + 50}} = \\frac{1}{\\sqrt{51}} \\approx 0.140028\n$$\nRounded to four significant figures, $f_{\\mathrm{IR}} = 0.1400$.\n\n**Comparison and Ranking**\n\nThe calculated self-shielding factors are:\n- $f_{\\mathrm{NR}} = 1.000$\n- $f_{\\mathrm{IR}} = 0.1400$\n- $f_{\\mathrm{WR}} = 0.1089$\n\nRanking these by magnitude, we have:\n$$\nf_{\\mathrm{WR}}  f_{\\mathrm{IR}}  f_{\\mathrm{NR}}\n$$\nThe self-shielding factor $f$ quantifies the flux depression at resonance energies; a value close to $1$ implies negligible shielding, while a value much less than $1$ signifies strong shielding.\n- The NR model ($f_{\\mathrm{NR}}=1.000$) assumes no flux depression, resulting in no shielding. This is the theoretical maximum absorption rate for a given resonance.\n- The WR model ($f_{\\mathrm{WR}}=0.1089$) assumes maximal flux depression, where the flux is inversely proportional to the total cross section. This results in the strongest shielding effect, reducing the effective absorption rate by a factor of approximately $1/0.1089 \\approx 9.18$.\n- The IR model ($f_{\\mathrm{IR}}=0.1400$) provides an intermediate level of shielding, accounting for a partial probability of neutrons escaping the resonance upon scattering. The shielding is substantial, reducing the absorption rate by a factor of approximately $1/0.1400 \\approx 7.14$, but less severe than the pure WR limit.\n\nThe significant difference between $f_{\\mathrm{NR}}$ and the other two factors highlights the critical importance of accounting for self-shielding for a strong, low-energy resonance like the $6.67\\,\\mathrm{eV}$ resonance in $^{238}\\mathrm{U}$. The NR approximation is physically inappropriate for such a case, while the WR and IR models provide more realistic estimations of the heavily suppressed resonance absorption.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.000  0.1089  0.1400\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The great utility of the Narrow Resonance approximation lies in its ability to transform a complex integral into a simple analytical expression, greatly simplifying the calculation of resonance integrals. This is achieved by assuming that the flux weighting term, typically $1/E$ in the slowing-down region, is essentially constant across the narrow energy range of the resonance and can be evaluated at the resonance energy $E_r$. This hands-on coding practice tasks you with quantifying the error introduced by this very assumption, comparing the elegant NR formula against a more rigorous numerical integration of the Doppler-broadened resonance integral to see when this powerful simplification is justified .",
            "id": "4256177",
            "problem": "Consider a single isolated absorption resonance of a heavy nuclide in a thermal neutron spectrum. Near the resonance, the microscopic absorption cross section can be modeled by a single-level Lorentzian (Breit-Wigner shape) with resonance energy $E_r$ (in electron volts), peak magnitude $\\sigma_0$ (in barns), and total width $\\Gamma$ (in electron volts). Let $\\gamma = \\Gamma/2$ denote the half-width. The unbroadened energy-dependent cross section is assumed to be\n$$\n\\sigma_L(E) = \\sigma_0 \\frac{\\gamma^2}{(E - E_r)^2 + \\gamma^2}.\n$$\nThermal motion of the target nuclide at absolute temperature $T$ (in kelvin) produces Doppler broadening, which can be modeled by convolving $\\sigma_L(E)$ with a Gaussian kernel of standard deviation\n$$\nw_D = \\sqrt{\\frac{4 E_r k_B T}{A}},\n$$\nwhere $A$ is the target-to-neutron mass ratio (dimensionless) and $k_B$ is the Boltzmann constant expressed in electron volts per kelvin, $k_B = 8.617333262 \\times 10^{-5}$ $\\mathrm{eV/K}$. The Doppler-broadened cross section is therefore\n$$\n\\sigma_D(E) = \\int_{-\\infty}^{+\\infty} \\sigma_L(E') \\frac{1}{w_D \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(E - E')^2}{2 w_D^2}\\right) \\, dE'.\n$$\nIn the lethargy representation, the relevant flux weighting for calculating the resonance integral uses the factor $1/E$ over an energy interval where the Lorentzian representation is valid. Assume the valid interval is the symmetric window\n$$\n[E_{\\min}, E_{\\max}] = [\\max(E_r - W, \\varepsilon), E_r + W],\n$$\nwhere $\\varepsilon$ is a small positive lower bound to avoid division by zero, and $W$ is a chosen multiple of the dominant width scale:\n$$\nW = \\alpha \\cdot \\max(\\gamma, w_D),\n$$\nfor a specified multiplier $\\alpha$. The numerically evaluated resonance integral is then\n$$\nI_{\\mathrm{num}} = \\int_{E_{\\min}}^{E_{\\max}} \\frac{\\sigma_D(E)}{E} \\, dE,\n$$\nwhich must be expressed in barns.\n\nThe narrow resonance approximation posits that over the resonance width, the factor $1/E$ varies negligibly, and may be replaced by its value at the resonance energy. Starting from the above definitions and well-tested facts about convolution with normalized kernels, derive the narrow resonance approximation expression for the resonance integral $I_{\\mathrm{NR}}$ in barns and explain why any Doppler broadening that preserves the area under the cross section profile does not change $I_{\\mathrm{NR}}$.\n\nThen, design and implement a robust numerical algorithm to:\n- Evaluate the Doppler-broadened cross section $\\sigma_D(E)$ using the convolution with a Gaussian. For computational efficiency and stability, use the Voigt profile representation:\n$$\nV(x; w_D, \\gamma) = \\frac{\\Re\\left( w\\!\\left( \\frac{x + i \\gamma}{w_D \\sqrt{2}} \\right) \\right)}{w_D \\sqrt{2\\pi}},\n$$\nwhere $x = E - E_r$ and $w(z)$ is the Faddeeva function. The Doppler-broadened cross section can be expressed as the area-preserving scaling of $V$ by the Lorentzian area, which must be derived from first principles.\n- Compute $I_{\\mathrm{num}}$ by one-dimensional numerical quadrature over the interval $[E_{\\min}, E_{\\max}]$.\n- Compute the narrow resonance approximation $I_{\\mathrm{NR}}$ from your derivation.\n- Report the relative deviation as a decimal:\n$$\n\\delta = \\frac{I_{\\mathrm{num}} - I_{\\mathrm{NR}}}{I_{\\mathrm{num}}}.\n$$\nUse $\\alpha = 50$ and $\\varepsilon = 10^{-8}$ $\\mathrm{eV}$ for all test cases. All energies must be handled in $\\mathrm{eV}$, temperatures in $\\mathrm{K}$, and cross sections in $\\mathrm{barns}$; the resonance integral $I_{\\mathrm{num}}$ and $I_{\\mathrm{NR}}$ must be in $\\mathrm{barns}$, and the final relative deviations $\\delta$ must be dimensionless decimals.\n\nYour program should compute $\\delta$ for the following test suite of parameter sets $(E_r, \\sigma_0, \\Gamma, A, T)$:\n1. A typical narrow resonance at moderate temperature: $(6.67, 1000.0, 0.03, 238.0, 600.0)$.\n2. A wider resonance at higher temperature: $(0.30, 2000.0, 0.50, 239.0, 900.0)$.\n3. A higher-energy narrow resonance at lower temperature: $(20.0, 500.0, 0.02, 232.0, 300.0)$.\n4. An extremely narrow resonance with moderate peak at elevated temperature: $(1.0, 100.0, 0.001, 100.0, 1200.0)$.\n5. A near-zero Doppler width boundary case: $(5.0, 800.0, 0.01, 200.0, 1.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4,r_5]$), where each $r_i$ is the computed value of $\\delta$ (a decimal) for the corresponding test case in the order listed above.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of nuclear reactor physics, well-posed, and objective. All necessary parameters and definitions for a unique solution are provided, and the requested tasks—derivation and numerical computation—are standard procedures in resonance analysis.\n\n### Theoretical Derivation and Analysis\n\nThe primary task is to derive the narrow resonance (NR) approximation for the resonance integral, denoted $I_{\\mathrm{NR}}$, and to explain its independence from Doppler broadening.\n\nThe numerically evaluated resonance integral is defined as:\n$$\nI_{\\mathrm{num}} = \\int_{E_{\\min}}^{E_{\\max}} \\frac{\\sigma_D(E)}{E} \\, dE\n$$\nwhere $\\sigma_D(E)$ is the Doppler-broadened cross section.\n\nThe narrow resonance approximation is based on the physical premise that the resonance width, whether natural ($\\Gamma$) or Doppler-broadened ($w_D$), is very small compared to the resonance energy $E_r$. Under this condition, the flux weighting term $1/E$ varies very little over the energy range where the cross section $\\sigma_D(E)$ is significant. Thus, we can approximate $1/E$ by its value at the center of the resonance, $1/E_r$, and pull this constant factor out of the integral:\n$$\nI_{\\mathrm{NR}} = \\int_{E_{\\min}}^{E_{\\max}} \\frac{\\sigma_D(E)}{E_r} \\, dE = \\frac{1}{E_r} \\int_{E_{\\min}}^{E_{\\max}} \\sigma_D(E) \\, dE\n$$\nThe integration limits $[E_{\\min}, E_{\\max}]$ are defined by $W = \\alpha \\cdot \\max(\\gamma, w_D)$ with a large multiplier $\\alpha=50$. This ensures that the interval covers virtually the entire resonance profile. Consequently, extending the integration limits to $(-\\infty, +\\infty)$ introduces negligible error:\n$$\nI_{\\mathrm{NR}} \\approx \\frac{1}{E_r} \\int_{-\\infty}^{+\\infty} \\sigma_D(E) \\, dE\n$$\nThe integral $\\int_{-\\infty}^{+\\infty} \\sigma_D(E) \\, dE$ represents the total area under the Doppler-broadened cross section curve. A fundamental property of convolution is that the integral of a convolved function is the product of the integrals of the original functions. The Doppler-broadened cross section $\\sigma_D(E)$ is the convolution of the unbroadened Lorentzian cross section $\\sigma_L(E)$ with a normalized Gaussian kernel $G(E, w_D)$:\n$$\n\\sigma_D(E) = (\\sigma_L * G)(E)\n$$\nThe Gaussian kernel is normalized by definition, meaning $\\int_{-\\infty}^{+\\infty} G(E, w_D) \\, dE = 1$. Therefore, the area under the cross section profile is conserved during Doppler broadening:\n$$\n\\int_{-\\infty}^{+\\infty} \\sigma_D(E) \\, dE = \\left( \\int_{-\\infty}^{+\\infty} \\sigma_L(E) \\, dE \\right) \\left( \\int_{-\\infty}^{+\\infty} G(E, w_D) \\, dE \\right) = \\int_{-\\infty}^{+\\infty} \\sigma_L(E) \\, dE\n$$\nThis explains why any Doppler broadening that preserves the area under the cross section profile does not change the value of the integral part of $I_{\\mathrm{NR}}$. The effect of broadening is to redistribute the cross section's magnitude over a wider energy range, making the peak lower and the tails wider, but the total area remains invariant.\n\nTo find $I_{\\mathrm{NR}}$, we must calculate the area under the unbroadened Lorentzian profile $\\sigma_L(E)$:\n$$\n\\text{Area}_L = \\int_{-\\infty}^{+\\infty} \\sigma_L(E) \\, dE = \\int_{-\\infty}^{+\\infty} \\sigma_0 \\frac{\\gamma^2}{(E - E_r)^2 + \\gamma^2} \\, dE\n$$\nLet $u = E - E_r$, so $du = dE$. The limits remain $(-\\infty, +\\infty)$.\n$$\n\\text{Area}_L = \\sigma_0 \\gamma^2 \\int_{-\\infty}^{+\\infty} \\frac{1}{u^2 + \\gamma^2} \\, du\n$$\nThis is a standard integral. Using the antiderivative $\\int \\frac{dx}{x^2+a^2} = \\frac{1}{a} \\arctan(\\frac{x}{a})$:\n$$\n\\text{Area}_L = \\sigma_0 \\gamma^2 \\left[ \\frac{1}{\\gamma} \\arctan\\left(\\frac{u}{\\gamma}\\right) \\right]_{u=-\\infty}^{u=+\\infty} = \\sigma_0 \\gamma \\left( \\arctan(+\\infty) - \\arctan(-\\infty) \\right) = \\sigma_0 \\gamma \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\pi \\sigma_0 \\gamma\n$$\nSubstituting this area back into the expression for $I_{\\mathrm{NR}}$:\n$$\nI_{\\mathrm{NR}} = \\frac{1}{E_r} (\\pi \\sigma_0 \\gamma)\n$$\nUsing the definition $\\gamma = \\Gamma/2$, where $\\Gamma$ is the total width, we obtain the final expression for the narrow resonance approximation of the resonance integral:\n$$\nI_{\\mathrm{NR}} = \\frac{\\pi \\sigma_0 \\Gamma}{2 E_r}\n$$\nThis result is independent of temperature $T$ (and thus of the Doppler width $w_D$), confirming the theoretical expectation.\n\n### Numerical Algorithm Design\n\nThe algorithm computes the relative deviation $\\delta = (I_{\\mathrm{num}} - I_{\\mathrm{NR}}) / I_{\\mathrm{num}}$ by evaluating both terms.\n\n1.  **Doppler-Broadened Cross Section $\\sigma_D(E)$**:\n    The problem provides an efficient representation of the Doppler-broadened profile using the Voigt function, which is the convolution of a normalized Gaussian and a normalized Lorentzian. The given expression,\n    $$\n    V(x; w_D, \\gamma) = \\frac{\\Re\\left( w\\!\\left( \\frac{x + i \\gamma}{w_D \\sqrt{2}} \\right) \\right)}{w_D \\sqrt{2\\pi}}\n    $$\n    is the normalized Voigt profile, meaning its integral over $x$ from $-\\infty$ to $+\\infty$ is $1$. The unbroadened cross section $\\sigma_L(E)$ is not normalized; its area is $\\pi \\sigma_0 \\gamma$.\n    Since convolution is a linear operation, the Doppler-broadened cross section $\\sigma_D(E)$ is simply the normalized Voigt profile scaled by the area of the original Lorentzian function:\n    $$\n    \\sigma_D(E) = (\\text{Area}_L) \\cdot V(E-E_r; w_D, \\gamma) = (\\pi \\sigma_0 \\gamma) \\frac{\\Re\\left( w\\!\\left( \\frac{(E - E_r) + i \\gamma}{w_D \\sqrt{2}} \\right) \\right)}{w_D \\sqrt{2\\pi}}\n    $$\n    This formula will be implemented using `scipy.special.wofz` for the Faddeeva function $w(z)$. A special case must be handled for $w_D \\to 0$, where the profile tends to the original Lorentzian $\\sigma_L(E)$. However, given the test cases, $w_D$ remains positive.\n\n2.  **Calculation of $I_{\\mathrm{num}}$ and $I_{\\mathrm{NR}}$**:\n    For each parameter set $(E_r, \\sigma_0, \\Gamma, A, T)$:\n    - Calculate constants: $\\gamma = \\Gamma/2$ and $k_B = 8.617333262 \\times 10^{-5}$ $\\mathrm{eV/K}$.\n    - Compute the Doppler width standard deviation: $w_D = \\sqrt{4 E_r k_B T / A}$.\n    - Determine the integration window: $W = 50 \\cdot \\max(\\gamma, w_D)$.\n    - Set the integration limits: $E_{\\min} = \\max(E_r - W, 10^{-8})$ and $E_{\\max} = E_r + W$.\n    - Calculate the narrow resonance approximation integral: $I_{\\mathrm{NR}} = (\\pi \\sigma_0 \\gamma) / E_r$.\n    - Define the integrand function $f(E) = \\sigma_D(E)/E$ using the Voigt representation for $\\sigma_D(E)$.\n    - Use a robust numerical quadrature routine, such as `scipy.integrate.quad`, to compute $I_{\\mathrm{num}} = \\int_{E_{\\min}}^{E_{\\max}} f(E) \\, dE$.\n\n3.  **Calculation of Relative Deviation $\\delta$**:\n    - With both $I_{\\mathrm{num}}$ and $I_{\\mathrm{NR}}$ computed, the relative deviation is found via:\n    $$\n    \\delta = \\frac{I_{\\mathrm{num}} - I_{\\mathrm{NR}}}{I_{\\mathrm{num}}}\n    $$\n    This process is repeated for all test cases, and the results are collected.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the relative deviation between the numerically evaluated resonance integral\n    and its narrow resonance approximation for a set of test cases.\n    \"\"\"\n    # Define physical and numerical constants from the problem statement.\n    KB_EV_PER_K = 8.617333262e-5  # Boltzmann constant in eV/K\n    ALPHA = 50.0  # Integration window multiplier\n    EPSILON = 1e-8  # Lower energy bound in eV\n\n    # Test suite of parameter sets: (Er, sigma0, Gamma, A, T)\n    # Er: resonance energy [eV]\n    # sigma0: peak cross section [barns]\n    # Gamma: total width [eV]\n    # A: target-to-neutron mass ratio [dimensionless]\n    # T: temperature [K]\n    test_cases = [\n        (6.67, 1000.0, 0.03, 238.0, 600.0),\n        (0.30, 2000.0, 0.50, 239.0, 900.0),\n        (20.0, 500.0, 0.02, 232.0, 300.0),\n        (1.0, 100.0, 0.001, 100.0, 1200.0),\n        (5.0, 800.0, 0.01, 200.0, 1.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current case\n        er, sigma0, gamma_total, mass_ratio_A, temp_T = case\n\n        # 1. Calculate derived parameters\n        gamma = gamma_total / 2.0  # Half-width\n        doppler_width_wd = np.sqrt((4.0 * er * KB_EV_PER_K * temp_T) / mass_ratio_A)\n        \n        # 2. Calculate the narrow resonance approximation integral (I_NR)\n        # I_NR = (pi * sigma0 * gamma) / Er\n        i_nr = (np.pi * sigma0 * gamma) / er\n\n        # 3. Set up for numerical integration\n        # Define the Doppler-broadened cross section using the Voigt profile\n        # sigma_D(E) = (Area_L) * V(E-Er; wD, gamma)\n        lorentzian_area = np.pi * sigma0 * gamma\n        \n        def sigma_doppler_broadened(E, er_val, wd_val, gamma_val):\n            \"\"\"\n            Calculates the Doppler-broadened cross section at energy E.\n            \"\"\"\n            # Handle the case where Doppler width is extremely small to avoid division by zero\n            # The problem's data does not trigger this, but it is good practice\n            if wd_val  1e-15:\n                # Fallback to the unbroadened Lorentzian shape\n                return sigma0 * (gamma_val**2) / ((E - er_val)**2 + gamma_val**2)\n            \n            x = E - er_val\n            z = (x + 1j * gamma_val) / (wd_val * np.sqrt(2.0))\n            \n            # The Voigt profile is proportional to the real part of the Faddeeva function\n            voigt_val = np.real(wofz(z)) / (wd_val * np.sqrt(2.0 * np.pi))\n            \n            return lorentzian_area * voigt_val\n\n        # Define the full integrand for the numerical integral: sigma_D(E) / E\n        def integrand(E, er_val, wd_val, gamma_val):\n            return sigma_doppler_broadened(E, er_val, wd_val, gamma_val) / E\n\n        # Determine integration limits\n        W = ALPHA * max(gamma, doppler_width_wd)\n        emin = max(er - W, EPSILON)\n        emax = er + W\n\n        # 4. Compute the numerical resonance integral (I_num)\n        # quad returns (integral_value, error_estimate)\n        i_num, _ = quad(\n            integrand, \n            emin, \n            emax, \n            args=(er, doppler_width_wd, gamma)\n        )\n\n        # 5. Calculate the relative deviation\n        if i_num == 0:\n            # Avoid division by zero, though unlikely for these parameters\n            delta = 0.0\n        else:\n            delta = (i_num - i_nr) / i_num\n        \n        results.append(delta)\n\n    # Format the final output as a comma-separated list in brackets.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A resonance's effective \"narrowness\" is not just determined by its intrinsic width $\\Gamma$, but also by the Doppler broadening effect caused by the thermal motion of target nuclei. This computational exercise investigates the consequences of neglecting Doppler broadening—a simplification sometimes associated with the NR framework—on the effective self-shielded cross section. By comparing a calculation using the full Voigt profile against one using only the natural Lorentzian shape, you will explore the non-intuitive but critical phenomenon where broadening can actually increase total resonance absorption in strongly shielded systems .",
            "id": "4245987",
            "problem": "You are asked to evaluate the impact of the narrow resonance approximation in the context of resonance self-shielding for a single isolated absorption resonance in a moderator-absorber mixture. Work in the energy domain with electronvolts and use the following physically plausible modeling assumptions and definitions.\n\nStart from the following base, which is widely used in slowing-down theory and single-level resonance modeling:\n\n- The single-level resonance absorption cross section is approximated by a Lorentzian centered at energy $E_0$ with full width at half maximum $\\Gamma$ and central height $\\sigma_{\\text{peak}}$ expressed in barns. Writing $\\gamma = \\Gamma/2$, the unbroadened resonant absorption cross section is\n$$\n\\sigma_{\\text{L}}(E) = \\sigma_{\\text{peak}} \\frac{\\gamma^2}{(E - E_0)^2 + \\gamma^2}.\n$$\n\n- Thermal motion of target nuclei introduces Doppler broadening. Modeling the Doppler kernel as a Gaussian in energy with standard deviation $\\sigma_{\\text{D}}$ leads to the Doppler-broadened resonance as the convolution of the Lorentzian with the Gaussian. The resulting profile is the Voigt function. Let $x = E - E_0$. The area-normalized Voigt function is\n$$\nV(x; \\sigma, \\gamma) = \\frac{\\Re\\!\\left[w\\!\\left(\\frac{x + i \\gamma}{\\sigma \\sqrt{2}}\\right)\\right]}{\\sigma \\sqrt{2\\pi}},\n$$\nwhere $w(z)$ is the Fadeeva function and $\\Re[\\cdot]$ denotes the real part. To preserve the resonance area, define the broadened absorption cross section as\n$$\n\\sigma_{\\text{V}}(E) = A_{\\text{L}}\\, V(E - E_0; \\sigma_{\\text{D}}, \\gamma),\n\\quad\\text{with}\\quad\nA_{\\text{L}} = \\pi \\gamma \\sigma_{\\text{peak}}.\n$$\nBy construction, $\\int_{-\\infty}^{\\infty} \\sigma_{\\text{V}}(E)\\, dE = \\int_{-\\infty}^{\\infty} \\sigma_{\\text{L}}(E)\\, dE$, and in the limiting case $\\sigma_{\\text{D}} \\to 0$ one has $\\sigma_{\\text{V}}(E) \\to \\sigma_{\\text{L}}(E)$.\n\n- In a simplified slowing-down regime with a constant background cross section $\\sigma_{\\text{b}}$ (barns) over a narrow energy window containing the resonance, the local neutron flux is inversely proportional to the total cross section. Approximating the total cross section as $\\sigma_{\\text{b}} + \\sigma(E)$ over the resonance window, the self-shielded, flux-weighted effective resonance absorption cross section over an energy interval $[E_{\\text{low}}, E_{\\text{high}}]$ is defined as\n$$\n\\sigma_{\\text{eff}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\sigma(E)\\, \\phi(E)\\, dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\phi(E)\\, dE},\n\\quad\\text{with}\\quad\n\\phi(E) \\propto \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)}.\n$$\nAny proportionality constant cancels in the ratio. This provides a first-principles, physically grounded model of self-shielding in the resonance energy range.\n\nDefine the narrow resonance approximation (NRA) for the purpose of this problem as the approximation that neglects Doppler broadening, i.e., uses $\\sigma(E) = \\sigma_{\\text{L}}(E)$ to compute $\\sigma_{\\text{eff}}$. The reference \"numerically broadened self-shielded\" result uses $\\sigma(E) = \\sigma_{\\text{V}}(E)$ with the given Doppler width $\\sigma_{\\text{D}}$.\n\nFor each test case below, compute the relative error of the narrow resonance approximation with respect to the broadened reference, defined as the dimensionless quantity\n$$\n\\varepsilon = \\frac{\\sigma_{\\text{eff}}^{\\text{NRA}} - \\sigma_{\\text{eff}}^{\\text{broadened}}}{\\sigma_{\\text{eff}}^{\\text{broadened}}}.\n$$\n\nAll energies must be treated in electronvolts ($\\mathrm{eV}$). All cross sections must be treated in barns. Temperatures are given in Kelvin ($\\mathrm{K}$) only for context; the Doppler width $\\sigma_{\\text{D}}$ is provided directly in $\\mathrm{eV}$ for each case and must be used as given. Angles do not appear in this problem. Your program must numerically evaluate the required integrals over energy.\n\nTest suite (each tuple is $(E_0, \\Gamma, \\sigma_{\\text{peak}}, \\sigma_{\\text{b}}, \\sigma_{\\text{D}}, E_{\\text{low}}, E_{\\text{high}}, T)$ with units as specified):\n- Case 1 (moderate self-shielding, resolved resonance): $(6.67, 0.025, 5000.0, 2.0, 0.15, 6.0, 7.5, 900)$.\n- Case 2 (large background cross section, reduced self-shielding): $(6.67, 0.025, 5000.0, 100.0, 0.15, 6.0, 7.5, 900)$.\n- Case 3 (no Doppler broadening, check limiting behavior): $(20.0, 0.2, 800.0, 5.0, 0.0, 18.0, 22.0, 300)$.\n- Case 4 (very narrow thermal resonance, strong self-shielding): $(0.3, 0.001, 12000.0, 0.5, 0.05, 0.1, 0.5, 600)$.\n\nYour program should produce a single line of output containing the relative errors for these four cases as a comma-separated list enclosed in square brackets, with each float rounded to six decimal places (for example, $[0.123456,-0.000001,0.000000,0.987654]$). The final answers are unitless decimal numbers as defined by $\\varepsilon$ above.",
            "solution": "The problem has been validated and is a well-posed, scientifically grounded exercise in computational nuclear reactor physics. It requires the numerical evaluation of the impact of Doppler broadening on resonance self-shielding.\n\n### 1. Theoretical Framework\n\nThe core of the problem lies in comparing two models for the effective resonance absorption cross section, $\\sigma_{\\text{eff}}$. This quantity represents a flux-weighted average cross section over a specified energy range, accounting for the phenomenon of self-shielding.\n\n**a. Resonance Cross Section Profiles**\n\n- **Lorentzian (Natural) Profile:** The intrinsic energy-dependent absorption cross section for a single, isolated resonance is described by the single-level Breit-Wigner formula, which has a Lorentzian shape. It is given as:\n$$\n\\sigma_{\\text{L}}(E) = \\sigma_{\\text{peak}} \\frac{\\gamma^2}{(E - E_0)^2 + \\gamma^2}\n$$\nwhere $E_0$ is the resonance energy, $\\sigma_{\\text{peak}}$ is the peak cross section value, and $\\gamma = \\Gamma/2$ is the half-width at half-maximum.\n\n- **Voigt (Doppler-Broadened) Profile:** In a physical medium at a finite temperature, target nuclei are in thermal motion. This motion induces a Doppler shift in the apparent energy of an incoming neutron as seen by the nucleus. Averaging over the Maxwellian distribution of nuclear velocities convolves the Lorentzian profile with a Gaussian. The resulting shape is a Voigt profile. The problem provides the area-preserving formulation:\n$$\n\\sigma_{\\text{V}}(E) = A_{\\text{L}}\\, V(E - E_0; \\sigma_{\\text{D}}, \\gamma)\n$$\nHere, $A_{\\text{L}} = \\pi \\gamma \\sigma_{\\text{peak}}$ is the area under the Lorentzian curve, which is conserved during broadening. The term $\\sigma_{\\text{D}}$ is the standard deviation of the Gaussian Doppler kernel, and $V(x; \\sigma_{\\text{D}}, \\gamma)$ is the area-normalized Voigt function, defined using the Fadeeva function $w(z)$:\n$$\nV(x; \\sigma, \\gamma) = \\frac{\\Re\\!\\left[w\\!\\left(\\frac{x + i \\gamma}{\\sigma \\sqrt{2}}\\right)\\right]}{\\sigma \\sqrt{2\\pi}}\n$$\nIn the limit where the Doppler width approaches zero ($\\sigma_{\\text{D}} \\to 0$), the Voigt profile $\\sigma_{\\text{V}}(E)$ converges to the Lorentzian profile $\\sigma_{\\text{L}}(E)$.\n\n**b. Self-Shielding and Effective Cross Section**\n\nResonance self-shielding is a consequence of flux depression. At energies where the absorption cross section $\\sigma(E)$ is large, neutrons are preferentially absorbed, leading to a local dip in the neutron flux $\\phi(E)$. A standard model for this effect in a homogeneous mixture is:\n$$\n\\phi(E) \\propto \\frac{1}{\\sigma_{\\text{total}}(E)} \\approx \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)}\n$$\nwhere $\\sigma_{\\text{b}}$ is the constant background cross section per absorber atom.\n\nThe effective cross section $\\sigma_{\\text{eff}}$ is an average of $\\sigma(E)$ weighted by this depressed flux, ensuring that the total reaction rate is preserved. It is calculated by the ratio of two integrals:\n$$\n\\sigma_{\\text{eff}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\sigma(E) \\phi(E) dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\phi(E) dE} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma(E)}{\\sigma_{\\text{b}} + \\sigma(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)} dE}\n$$\nThese integrals do not generally have closed-form analytical solutions and must be evaluated numerically.\n\n### 2. Computational Procedure\n\nTo find the relative error $\\varepsilon$, we must compute $\\sigma_{\\text{eff}}$ using both the approximate and reference cross section models.\n\n**a. Broadened Effective Cross Section ($\\sigma_{\\text{eff}}^{\\text{broadened}}$)**\nThis is the reference calculation, which uses the physically accurate Doppler-broadened cross section, $\\sigma(E) = \\sigma_{\\text{V}}(E)$. The calculation requires numerically evaluating:\n$$\n\\sigma_{\\text{eff}}^{\\text{broadened}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma_{\\text{V}}(E)}{\\sigma_{\\text{b}} + \\sigma_{\\text{V}}(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma_{\\text{V}}(E)} dE}\n$$\nA special case occurs for $\\sigma_{\\text{D}} = 0$, where we set $\\sigma_{\\text{V}}(E) = \\sigma_{\\text{L}}(E)$.\n\n**b. Narrow Resonance Approximation ($\\sigma_{\\text{eff}}^{\\text{NRA}}$)**\nThis approximation, as defined in the problem, neglects Doppler broadening, so we use the natural line shape, $\\sigma(E) = \\sigma_{\\text{L}}(E)$. The calculation is:\n$$\n\\sigma_{\\text{eff}}^{\\text{NRA}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma_{\\text{L}}(E)}{\\sigma_{\\text{b}} + \\sigma_{\\text{L}}(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma_{\\text{L}}(E)} dE}\n$$\n\n**c. Relative Error ($\\varepsilon$)**\nThe final step is to compute the relative error using the definition provided:\n$$\n\\varepsilon = \\frac{\\sigma_{\\text{eff}}^{\\text{NRA}} - \\sigma_{\\text{eff}}^{\\text{broadened}}}{\\sigma_{\\text{eff}}^{\\text{broadened}}}\n$$\nDoppler broadening lowers the peak and widens the base of the resonance. In a self-shielded scenario (low $\\sigma_{\\text{b}}$), absorption at the peak is already saturated. The broadening exposes the wider wings of the resonance to a higher, less-depressed flux, which typically increases the overall effective absorption. Therefore, we expect $\\sigma_{\\text{eff}}^{\\text{broadened}}  \\sigma_{\\text{eff}}^{\\text{NRA}}$, which would result in a negative error $\\varepsilon$.\n\n### 3. Implementation Details\n\nThe solution will be implemented in Python.\n- Numerical integration will be performed using the `quad` function from `scipy.integrate`, which provides robust and accurate quadrature.\n- The Fadeeva function $w(z)$ required for the Voigt profile will be evaluated using `wofz` from `scipy.special`.\n- A generic function will be designed to compute $\\sigma_{\\text{eff}}$ which accepts the appropriate cross section function ($\\sigma_{\\text{L}}$ or $\\sigma_{\\text{V}}$) as an argument.\n- The main program will iterate through each test case, perform the two calculations for $\\sigma_{\\text{eff}}$, compute the relative error, and store the result.\n- The case of $\\sigma_{\\text{D}} = 0$ will be handled explicitly to ensure $\\varepsilon = 0$ and to avoid numerical issues like division by zero.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the resonance self-shielding problem by calculating the relative\n    error of the Narrow Resonance Approximation (NRA) with respect to a\n    Doppler-broadened reference calculation.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Format: (E0, Gamma, sigma_peak, sigma_b, sigma_D, E_low, E_high, T)\n    test_cases = [\n        (6.67, 0.025, 5000.0, 2.0, 0.15, 6.0, 7.5, 900),\n        (6.67, 0.025, 5000.0, 100.0, 0.15, 6.0, 7.5, 900),\n        (20.0, 0.2, 800.0, 5.0, 0.0, 18.0, 22.0, 300),\n        (0.3, 0.001, 12000.0, 0.5, 0.05, 0.1, 0.5, 600),\n    ]\n\n    def sigma_lorentzian(E, E0, gamma, sigma_peak):\n        \"\"\"Calculates the Lorentzian (unbroadened) cross section.\"\"\"\n        return sigma_peak * (gamma**2) / ((E - E0)**2 + gamma**2)\n\n    def sigma_voigt(E, E0, gamma, sigma_peak, sigma_D):\n        \"\"\"Calculates the Voigt (Doppler-broadened) cross section.\"\"\"\n        # Calculate the resonance area to preserve it.\n        area_L = np.pi * gamma * sigma_peak\n        \n        # Argument for the Fadeeva function.\n        z = (E - E0 + 1j * gamma) / (sigma_D * np.sqrt(2.0))\n        \n        # Area-normalized Voigt function V(E-E0; sigma_D, gamma).\n        # V = Re[w(z)] / (sigma_D * sqrt(2*pi))\n        voigt_func_val = np.real(wofz(z)) / (sigma_D * np.sqrt(2.0 * np.pi))\n        \n        return area_L * voigt_func_val\n\n    def calculate_effective_xs(xs_func, E_low, E_high, sigma_b, *xs_args):\n        \"\"\"\n        Calculates the self-shielded effective cross section for a given\n        cross section function (xs_func) over an energy interval.\n        \"\"\"\n        # Define the integrand for the numerator of the sigma_eff expression.\n        def numerator_integrand(E):\n            xs_val = xs_func(E, *xs_args)\n            return xs_val / (sigma_b + xs_val)\n\n        # Define the integrand for the denominator of the sigma_eff expression.\n        def denominator_integrand(E):\n            xs_val = xs_func(E, *xs_args)\n            return 1.0 / (sigma_b + xs_val)\n\n        # Use high-precision numerical integration.\n        num_integral, _ = quad(numerator_integrand, E_low, E_high, epsabs=1.49e-12, epsrel=1.49e-12)\n        den_integral, _ = quad(denominator_integrand, E_low, E_high, epsabs=1.49e-12, epsrel=1.49e-12)\n\n        # Avoid division by zero, although physically unlikely for this problem.\n        if abs(den_integral)  1e-15:\n            return 0.0\n        \n        return num_integral / den_integral\n\n    results = []\n    for case in test_cases:\n        E0, Gamma, sigma_peak, sigma_b, sigma_D, E_low, E_high, _ = case\n        gamma = Gamma / 2.0\n\n        # --- 1. Calculate the NRA effective cross section ---\n        xs_args_lor = (E0, gamma, sigma_peak)\n        sigma_eff_nra = calculate_effective_xs(\n            sigma_lorentzian, E_low, E_high, sigma_b, *xs_args_lor\n        )\n\n        # --- 2. Calculate the Broadened effective cross section ---\n        # Handle the limiting case of zero Doppler broadening.\n        # In this limit, the Voigt profile becomes the Lorentzian profile.\n        if sigma_D  1e-9:\n            sigma_eff_broadened = sigma_eff_nra\n        else:\n            xs_args_voigt = (E0, gamma, sigma_peak, sigma_D)\n            sigma_eff_broadened = calculate_effective_xs(\n                sigma_voigt, E_low, E_high, sigma_b, *xs_args_voigt\n            )\n\n        # --- 3. Calculate the relative error ---\n        if abs(sigma_eff_broadened)  1e-12:\n            # If the broadened result is effectively zero, the NRA result\n            # should also be zero, so the error is zero.\n            epsilon = 0.0\n        else:\n            epsilon = (sigma_eff_nra - sigma_eff_broadened) / sigma_eff_broadened\n        \n        results.append(epsilon)\n\n    # Format the final output string as specified.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}