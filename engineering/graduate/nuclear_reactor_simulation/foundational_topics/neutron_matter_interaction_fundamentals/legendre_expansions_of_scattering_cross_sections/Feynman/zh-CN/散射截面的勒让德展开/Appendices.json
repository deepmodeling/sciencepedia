{
    "hands_on_practices": [
        {
            "introduction": "为了深入理解勒让德展开的特性，研究一个极端情况是很有启发性的：即中子散射只发生在一个固定的角度。这个物理情景可以用狄拉克$\\delta$函数来建模。 这个练习不仅将展示如何解析地推导勒让德矩，还将揭示多项式展开在处理高度局域化函数时的根本局限性，这对于理解反应堆物理中的实际挑战至关重要。",
            "id": "4233070",
            "problem": "考虑在无限均匀介质平板几何中的单能中子输运，其中宏观微分散射截面仅依赖于散射角的余弦，记为 $\\mu \\in [-1, 1]$。设该截面为强前向峰，并用狄拉克δ分布建模，$\\sigma(\\mu) = \\sigma_s \\,\\delta(\\mu - \\mu_0)$，其中 $\\sigma_s > 0$ 是一个常数，$\\mu_0 \\in [-1, 1]$ 是一个固定值。在中子输运中，平板几何中的各向异性散射通常通过将 $\\sigma(\\mu)$ 在区间 $[-1, 1]$ 上的勒让德多项式基 $\\{P_\\ell(\\mu)\\}_{\\ell=0}^{\\infty}$ 中展开来表示，这些多项式在以下意义上是正交的：\n$$\n\\int_{-1}^{1} P_\\ell(\\mu)\\,P_m(\\mu)\\,d\\mu = \\frac{2}{2\\ell+1}\\,\\delta_{\\ell m}.\n$$\n从勒让德基的完备性和上述正交关系作为基本输入出发，推导由以下表示所定义的勒让德展开系数 $\\sigma_\\ell$：\n$$\n\\sigma(\\mu) = \\sum_{\\ell=0}^{\\infty} (2\\ell+1)\\,\\sigma_\\ell\\,P_\\ell(\\mu).\n$$\n然后，利用勒让德多项式在 $\\ell \\to \\infty$ 时的渐进行为，分析 $\\sigma_\\ell$ 的高阶行为，以讨论N阶球谐函数截断近似($P_N$)对δ函数核的收敛速度，并比较 $\\mu_0 \\in (-1, 1)$ 和 $\\mu_0 = 1$ 两种情况。假设角度以弧度为单位。将你的最终答案表示为关于 $\\sigma_s$、$\\mu_0$ 和 $P_\\ell$ 的 $\\sigma_\\ell$ 的闭式符号表达式。",
            "solution": "目标是为一个用狄拉克δ分布建模的散射截面推导其勒让德展开系数 $\\sigma_\\ell$，并分析所得级数的收敛性质。\n\n散射截面由 $\\sigma(\\mu) = \\sigma_s \\,\\delta(\\mu - \\mu_0)$ 给出，其中 $\\sigma_s > 0$ 是一个常数，$\\mu_0 \\in [-1, 1]$ 是散射角的余弦。$\\sigma(\\mu)$ 在勒让德多项式 $P_\\ell(\\mu)$ 基上的展开式为：\n$$\n\\sigma(\\mu) = \\sum_{m=0}^{\\infty} (2m+1)\\,\\sigma_m\\,P_m(\\mu)\n$$\n此处，求和索引用 $m$ 表示，以区别于我们旨在确定的系数的索引 $\\ell$。勒让德多项式在区间 $[-1, 1]$ 上是正交的，并满足以下关系：\n$$\n\\int_{-1}^{1} P_\\ell(\\mu)\\,P_m(\\mu)\\,d\\mu = \\frac{2}{2\\ell+1}\\,\\delta_{\\ell m}\n$$\n其中 $\\delta_{\\ell m}$ 是克罗内克δ符号。\n\n为了确定任意非负整数 $\\ell$ 的系数 $\\sigma_\\ell$，我们利用正交性质。我们将 $\\sigma(\\mu)$ 的级数表示式两边同乘以 $P_\\ell(\\mu)$，并在定义域 $\\mu \\in [-1, 1]$ 上积分。\n\n此操作的左侧（LHS）变为：\n$$\n\\text{LHS} = \\int_{-1}^{1} \\sigma(\\mu) P_\\ell(\\mu) \\,d\\mu\n$$\n代入 $\\sigma(\\mu)$ 的表达式：\n$$\n\\text{LHS} = \\int_{-1}^{1} \\sigma_s \\delta(\\mu - \\mu_0) P_\\ell(\\mu) \\,d\\mu\n$$\n通过应用狄拉克δ函数的筛选性质，即对于包含点 $a$ 的积分域，有 $\\int f(x) \\delta(x-a) \\,dx = f(a)$，我们计算该积分。由于 $\\mu_0 \\in [-1, 1]$，该条件得到满足，我们得到：\n$$\n\\text{LHS} = \\sigma_s P_\\ell(\\mu_0)\n$$\n此操作的右侧（RHS）为：\n$$\n\\text{RHS} = \\int_{-1}^{1} \\left( \\sum_{m=0}^{\\infty} (2m+1)\\,\\sigma_m\\,P_m(\\mu) \\right) P_\\ell(\\mu) \\,d\\mu\n$$\n假设级数收敛性足够好，允许交换求和与积分的顺序，我们有：\n$$\n\\text{RHS} = \\sum_{m=0}^{\\infty} (2m+1)\\,\\sigma_m \\int_{-1}^{1} P_m(\\mu) P_\\ell(\\mu) \\,d\\mu\n$$\n使用勒让德多项式的正交关系：\n$$\n\\text{RHS} = \\sum_{m=0}^{\\infty} (2m+1)\\,\\sigma_m \\left( \\frac{2}{2\\ell+1}\\,\\delta_{\\ell m} \\right)\n$$\n克罗内克δ符号 $\\delta_{\\ell m}$ 的存在使得无穷级数中除了 $m=\\ell$ 的那一项外，所有项都为零。因此，表达式简化为：\n$$\n\\text{RHS} = (2\\ell+1)\\,\\sigma_\\ell \\left( \\frac{2}{2\\ell+1} \\right) = 2\\sigma_\\ell\n$$\n通过令LHS和RHS的结果相等，我们得到如下关系：\n$$\n\\sigma_s P_\\ell(\\mu_0) = 2\\sigma_\\ell\n$$\n解此方程得到 $\\sigma_\\ell$，即为勒让德展开系数的闭式符号表达式：\n$$\n\\sigma_\\ell = \\frac{\\sigma_s}{2} P_\\ell(\\mu_0)\n$$\n此表达式构成了所要求的最终答案。\n\n为了分析高阶行为，我们考察 $\\ell \\to \\infty$ 时 $\\sigma_\\ell$ 的渐进行为。截断的$P_N$近似 $\\sigma_N(\\mu) = \\sum_{\\ell=0}^{N} (2\\ell+1)\\,\\sigma_\\ell\\,P_\\ell(\\mu)$ 的收敛性取决于 $\\sigma_\\ell$ 的衰减速度。\n\n情况1：$\\mu_0 \\in (-1, 1)$。\n在这种情况下，我们可以写成 $\\mu_0 = \\cos(\\theta_0)$，对于某个角度 $\\theta_0 \\in (0, \\pi)$。对于大的 $\\ell$，勒让德多项式的渐进行为由希尔伯公式给出：\n$$\nP_\\ell(\\cos\\theta_0) \\approx \\sqrt{\\frac{2}{\\pi \\ell \\sin\\theta_0}} \\cos\\left( \\left(\\ell + \\frac{1}{2}\\right)\\theta_0 - \\frac{\\pi}{4} \\right) + O(\\ell^{-3/2})\n$$\n这表明 $P_\\ell(\\mu_0)$ 以 $\\ell^{-1/2}$ 的速度衰减。因此，系数 $\\sigma_\\ell = \\frac{\\sigma_s}{2} P_\\ell(\\mu_0)$ 也以 $O(\\ell^{-1/2})$ 的速度衰减。这是一个极其缓慢的衰减速度，意味着$P_N$级数收敛非常缓慢。需要大量的项，即高阶的 $N$，才能对δ函数达到一个合理的近似，这是在全局多项式基中展开尖锐、局部化函数时的一种典型病态问题。\n\n情况2：$\\mu_0 = 1$ (纯前向散射)。\n对于这个极限情况，我们使用已知的恒等式 $P_\\ell(1) = 1$（对所有 $\\ell \\ge 0$ 成立）。展开系数变为：\n$$\n\\sigma_\\ell = \\frac{\\sigma_s}{2} P_\\ell(1) = \\frac{\\sigma_s}{2}\n$$\n这些系数是常数，当 $\\ell \\to \\infty$ 时不趋于零。级数收敛的条件未被满足。因此，勒让德级数展开无法在区间的端点处表示δ函数。在实践中，$P_N$方法的这一严重限制通常通过使用‘输运修正’来处理，即将散射的前向峰部分从展开中移除，并将其视为对总截面的一种修正。",
            "answer": "$$\n\\boxed{\\frac{\\sigma_s}{2} P_\\ell(\\mu_0)}\n$$"
        },
        {
            "introduction": "尽管对于简单的散射核可以进行解析推导，但真实的散射截面数据通常是复杂的，或以表格形式给出。因此，从理论转向实践，我们需要一个强大的数值工具。 本练习将介绍高斯-勒让德积分法，这是数值计算勒让德矩的黄金标准方法。你将亲手实现该方法并验证其卓越的精度特性，这是处理核数据的一项关键技能。",
            "id": "4233098",
            "problem": "您的任务是设计并实现一个高斯-勒让德(Gauss–Legendre)求积方法，用于在中子输运的背景下计算散射勒让德矩，并证明为精确积分指定次数以下的多项式所需的点数。考虑一维散射角余弦，记为 $\\mu \\in [-1, 1]$，并令 $\\{P_\\ell(\\mu)\\}_{\\ell=0}^{\\infty}$ 为 $[-1, 1]$ 上的勒让德多项式，它们满足正交关系\n$$\n\\int_{-1}^{1} P_\\ell(\\mu) P_m(\\mu)\\,d\\mu = \\frac{2}{2\\ell+1}\\,\\delta_{\\ell m},\n$$\n其中 $\\delta_{\\ell m}$ 是克罗内克δ函数(Kronecker delta)。\n\n在多群中子输运中，散射截面 $\\sigma_s(\\mu)$ 的 $\\ell$ 阶散射勒让德矩定义为\n$$\n\\sigma_\\ell = \\frac{2\\ell+1}{2}\\int_{-1}^{1} \\sigma_s(\\mu)\\,P_\\ell(\\mu)\\,d\\mu.\n$$\n\n在 $[-1, 1]$ 上具有 $N$ 个点的高斯-勒让德求积提供节点 $\\{\\mu_i\\}_{i=1}^{N}$ 和正权重 $\\{w_i\\}_{i=1}^{N}$，使得\n$$\n\\int_{-1}^{1} p(\\mu)\\,d\\mu = \\sum_{i=1}^{N} w_i\\,p(\\mu_i)\n$$\n对于任意次数至多为 $2N-1$ 的多项式 $p(\\mu)$ 均成立。\n\n您的任务是：\n- 构造一个具有 $N=L+1$ 个点的高斯-勒让德求积，并用它通过下式来近似计算 $\\ell=0, 1, \\dots, L$ 的 $\\sigma_\\ell$：\n$$\n\\sigma_\\ell^{(Q)} = \\frac{2\\ell+1}{2}\\sum_{i=1}^{N} w_i\\,\\sigma_s(\\mu_i)\\,P_\\ell(\\mu_i).\n$$\n- 从第一性原理出发，证明为何 $N=L+1$ 个点能在 $[-1, 1]$ 上精确积分任意次数至多为 $2L$ 的多项式。\n- 通过与可用的解析积分进行比较，或使用一个对于该被积函数类别可证明是精确的更高阶高斯-勒让德法则来验证该求积。\n\n角度单位：所有角度都通过其无量纲的余弦值 $\\mu$ 来表示。此问题不需要其他物理单位。\n\n您的程序必须实现以下测试套件，并按下方描述的精确最终输出格式生成结果。\n\n测试套件：\n1. 令 $L=3$ 并在勒让德基上定义 $\\sigma_s(\\mu)$ 为\n   $$\n   \\sigma_s(\\mu) = a_0 P_0(\\mu) + a_1 P_1(\\mu) + a_2 P_2(\\mu) + a_3 P_3(\\mu),\n   $$\n   系数为 $a_0=1.2$, $a_1=0.5$, $a_2=-0.3$, $a_3=0.25$。使用 $N=L+1$ 个点计算并返回列表 $[\\sigma_0^{(Q)},\\sigma_1^{(Q)},\\sigma_2^{(Q)},\\sigma_3^{(Q)}]$。\n\n2. 边界情况：令 $L=0$ 且 $\\sigma_s(\\mu)=c$，其中 $c=2.5$。使用 $N=L+1$ 个点返回 $\\sigma_0^{(Q)}$。\n\n3. 强调被积函数次数的边缘情况：令 $L=3$ 并在单项式基上定义 $\\sigma_s(\\mu)$ 为\n   $$\n   \\sigma_s(\\mu) = c_0 + c_1 \\mu + c_2 \\mu^2 + c_3 \\mu^3 + c_4 \\mu^4 + c_5 \\mu^5 + c_6 \\mu^6,\n   $$\n   系数为 $c_0=0.8$, $c_1=-0.4$, $c_2=0.3$, $c_3=0.2$, $c_4=-0.1$, $c_5=0.05$, $c_6=0.02$。对于 $\\ell=0, 1, 2, 3$，使用 $N=L+1$ 个点计算 $\\sigma_\\ell^{(Q)}$。同时，使用一个点数 $N_{\\mathrm{ref}}$ 的高斯-勒让德求积计算一个参考值 $\\sigma_\\ell^{(\\mathrm{ref})}$，其中 $N_{\\mathrm{ref}}$ 被选择为能精确积分所有次数最高达到 $3L$ 的乘积 $\\sigma_s(\\mu) P_\\ell(\\mu)$ 的最小值，即\n$$\n2N_{\\mathrm{ref}}-1 \\ge 3L.\n$$\n返回最大绝对误差 $\\max_{0\\le \\ell \\le L} |\\sigma_\\ell^{(Q)} - \\sigma_\\ell^{(\\mathrm{ref})}|$。\n\n4. 属性检查：令 $L=4$ 并设 $N=L+1=5$。对于每个单项式 $p_n(\\mu) = \\mu^n$，其中 $n=0, 1, \\dots, 2L$，使用 $N$ 点高斯-勒让德求积来计算 $\\int_{-1}^{1} p_n(\\mu)\\,d\\mu$。将每个结果与精确的解析积分进行比较\n$$\n\\int_{-1}^{1} \\mu^n\\,d\\mu = \\begin{cases}\n0,\\text{若 $n$ 为奇数},\\\\\n\\frac{2}{n+1},\\text{若 $n$ 为偶数}。\n\\end{cases}\n$$\n返回一个布尔值，该值当且仅当所有单项式积分与解析值的绝对误差在 $10^{-12}$ 以内时为 $\\mathrm{True}$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。列表元素按顺序对应上述四个测试用例：\n- 测试 1：一个包含 $L+1$ 个浮点值的列表 $[\\sigma_0^{(Q)},\\dots,\\sigma_L^{(Q)}]$，\n- 测试 2：一个单一的浮点值 $\\sigma_0^{(Q)}$，\n- 测试 3：一个等于最大绝对误差的单一浮点值，\n- 测试 4：一个表示属性检查结果的单一布尔值。\n\n例如，输出必须具有以下形状\n$$\n[\\,[\\cdots],\\,\\cdots,\\,\\cdots,\\,\\mathrm{True}\\,],\n$$\n不打印任何额外文本。",
            "solution": "此问题是有效的，因为它在科学上基于数值方法和核工程，问题设定良好，具有明确的输入和清晰的目标，并且没有任何科学或事实上的不准确、模糊或矛盾之处。因此，我们可以着手解决。\n\n这个问题的核心是应用高斯-勒让德(Gauss–Legendre)求积来计算散射截面 $\\sigma_s(\\mu)$ 的勒让德矩 $\\sigma_\\ell$。我们将首先为该求积方法的性质提供理论证明，然后概述每个测试用例的算法实现。\n\n**理论证明：高斯-勒让德求积的精度**\n\n问题要求从第一性原理出发，证明为什么一个 $N$ 点高斯-勒让德求积法则能精确积分任何次数最高为 $2N-1$ 的多项式。我们特别关心 $N=L+1$ 的情况，此时该求积对于次数最高为 $2(L+1)-1 = 2L+1$ 的多项式是精确的。这自然意味着，如问题描述中所述，它对于次数最高为 $2L$ 的多项式也是精确的。\n\n设 $N$ 点高斯-勒让德求积的节点 $\\{\\mu_i\\}_{i=1}^N$ 是 $N$ 次勒让德多项式 $P_N(\\mu)$ 的 $N$ 个不同根。设相应的权重为 $\\{w_i\\}_{i=1}^N$。令 $p(\\mu)$ 是一个次数至多为 $2N-1$ 的任意多项式。\n\n我们可以用 $P_N(\\mu)$ 对 $p(\\mu)$ 进行多项式长除法，得到商 $q(\\mu)$ 和余数 $r(\\mu)$：\n$$\np(\\mu) = q(\\mu)P_N(\\mu) + r(\\mu)\n$$\n由于 $\\deg(p) \\le 2N-1$ 且 $\\deg(P_N) = N$，商的次数必须为 $\\deg(q) \\le (2N-1) - N = N-1$，余数的次数必须为 $\\deg(r) \\le N-1$。\n\n现在，我们对 $p(\\mu)$ 在区间 $[-1, 1]$ 上积分：\n$$\n\\int_{-1}^{1} p(\\mu)\\,d\\mu = \\int_{-1}^{1} q(\\mu)P_N(\\mu)\\,d\\mu + \\int_{-1}^{1} r(\\mu)\\,d\\mu\n$$\n勒让德多项式 $\\{P_k(\\mu)\\}$ 在 $[-1, 1]$ 上构成一个正交基。源于此正交性的一个关键性质是，对于 $k \\ne m$，$\\int_{-1}^{1} P_k(\\mu)P_m(\\mu)\\,d\\mu = 0$。因此，$P_N(\\mu)$ 与任何次数小于 $N$ 的多项式正交。由于 $\\deg(q) \\le N-1$，$q(\\mu)$ 可以表示为勒让德多项式 $P_k(\\mu)$（其中 $k \\in \\{0, 1, \\dots, N-1\\}$）的线性组合。由于正交性，$q(\\mu)$ 和 $P_N(\\mu)$ 的乘积积分为零：\n$$\n\\int_{-1}^{1} q(\\mu)P_N(\\mu)\\,d\\mu = 0\n$$\n这将 $p(\\mu)$ 的积分简化为：\n$$\n\\int_{-1}^{1} p(\\mu)\\,d\\mu = \\int_{-1}^{1} r(\\mu)\\,d\\mu\n$$\n接下来，我们计算 $p(\\mu)$ 的求积和：\n$$\n\\sum_{i=1}^{N} w_i\\,p(\\mu_i) = \\sum_{i=1}^{N} w_i \\left( q(\\mu_i)P_N(\\mu_i) + r(\\mu_i) \\right)\n$$\n根据定义，求积节点 $\\mu_i$ 是 $P_N(\\mu)$ 的根，所以对于所有 $i=1, \\dots, N$，$P_N(\\mu_i) = 0$。因此，求和简化为：\n$$\n\\sum_{i=1}^{N} w_i\\,p(\\mu_i) = \\sum_{i=1}^{N} w_i\\,r(\\mu_i)\n$$\n权重 $w_i$ 的构造恰好使得 $N$ 点求积法则对于所有次数至多为 $N-1$ 的多项式都是精确的。由于 $\\deg(r) \\le N-1$，该求积能精确计算 $r(\\mu)$ 的积分：\n$$\n\\int_{-1}^{1} r(\\mu)\\,d\\mu = \\sum_{i=1}^{N} w_i\\,r(\\mu_i)\n$$\n通过结合这些结果，我们建立了等式：\n$$\n\\int_{-1}^{1} p(\\mu)\\,d\\mu = \\int_{-1}^{1} r(\\mu)\\,d\\mu = \\sum_{i=1}^{N} w_i\\,r(\\mu_i) = \\sum_{i=1}^{N} w_i\\,p(\\mu_i)\n$$\n这证明了 $N$ 点高斯-勒让德求积对于任何次数至多为 $2N-1$ 的多项式 $p(\\mu)$ 都是精确的。对于 $N = L+1$ 的情况，该法则对于次数至多为 $2L+1$ 的多项式是精确的。\n\n**算法设计**\n\n主要的计算任务是使用基于求积的近似来计算散射矩 $\\sigma_\\ell$：\n$$\n\\sigma_\\ell^{(Q)} = \\frac{2\\ell+1}{2}\\sum_{i=1}^{N} w_i\\,\\sigma_s(\\mu_i)\\,P_\\ell(\\mu_i)\n$$\n实现将依赖于 `scipy` 库来执行标准数值计算。\n\n1.  **高斯-勒让德求积**：对于给定的点数 $N$，节点 $\\{\\mu_i\\}$ 和权重 $\\{w_i\\}$ 将使用 `scipy.special.roots_legendre(N)` 函数获得。\n2.  **勒让德多项式**：$P_\\ell(\\mu_i)$ 的值将使用 `scipy.special.eval_legendre(l, mu_array)` 计算。\n3.  **截面**：散射截面 $\\sigma_s(\\mu)$ 必须在每个节点 $\\mu_i$ 处进行求值。$\\sigma_s(\\mu)$ 的函数形式在每个测试用例中给出。\n4.  **求和**：对 $i$ 的求和将使用 `numpy` 的高效向量操作来执行，通常是 `numpy.dot(weights, integrand_values)`。\n\n我们现在详细说明每个测试用例的方法。\n\n**测试用例 1**：给定 $L=3$ 和 $\\sigma_s(\\mu)$ 为勒让德基下的一个3次多项式。我们使用一个 $N=L+1=4$ 点的求积。第 $\\ell$ 阶矩的被积函数是 $\\sigma_s(\\mu)P_\\ell(\\mu)$。该被积函数的最高次数出现在 $\\ell=3$ 时，即 $\\deg(P_3(\\mu)P_3(\\mu)) = 3+3=6$。我们的 $N=4$ 点求积对于次数最高为 $2(4)-1=7$ 的多项式是精确的。由于 $6 \\le 7$，该求积将精确计算这些矩。由于正交关系，精确的矩已知就是系数 $a_\\ell$ 本身。算法将计算 $\\ell=0, 1, 2, 3$ 的 $\\sigma_\\ell^{(Q)}$，结果应在机器精度内与 $[1.2, 0.5, -0.3, 0.25]$ 相匹配。\n\n**测试用例 2**：$L=0$ 时，我们需要一个 $N=L+1=1$ 点的求积。这里 $\\sigma_s(\\mu)=2.5$，是一个常数（0次多项式）。$\\sigma_0^{(Q)}$ 的被积函数是 $\\sigma_s(\\mu)P_0(\\mu) = 2.5 \\times 1 = 2.5$，这是一个0次多项式。$N=1$ 点法则对于次数最高为 $2(1)-1=1$ 的多项式是精确的。单个节点是 $\\mu_1=0$，权重是 $w_1=2$。计算为 $\\sigma_0^{(Q)} = \\frac{1}{2} w_1 \\sigma_s(\\mu_1) P_0(\\mu_1) = \\frac{1}{2}(2)(2.5)(1) = 2.5$。\n\n**测试用例 3**：给定 $L=3$ 和一个单项式基下的6次多项式 $\\sigma_s(\\mu)$。我们首先用一个 $N=L+1=4$ 点的求积计算 $\\sigma_\\ell^{(Q)}$。被积函数的最高次数（对于 $\\ell=3$）是 $\\deg(\\sigma_s(\\mu)P_3(\\mu)) = 6+3=9$。$N=4$ 求积法则仅对次数最高为7的多项式精确，因此它将产生一个近似结果。为了找到误差，我们使用一个足够高阶的求积来计算参考解 $\\sigma_\\ell^{(\\mathrm{ref})}$，以保证其精确性。所需的阶数 $N_{\\mathrm{ref}}$ 必须满足 $2N_{\\mathrm{ref}}-1 \\ge 9$，这导致最小的 $N_{\\mathrm{ref}}=5$。我们将用 $N=4$ 和 $N=5$ 个点分别计算矩，然后找出两组结果之间的最大绝对差。\n\n**测试用例 4**：这个案例是对高斯-勒让德求积基本性质的直接验证。我们使用 $L=4$，所以 $N=L+1=5$。该求积对于次数最高为 $2(5)-1=9$ 的多项式应该是精确的。我们通过对 $n=0, 1, \\dots, 2L=8$ 的单项式 $\\mu^n$ 进行积分来测试这一点。最高次数是8，小于9。对于每个 $n$，我们使用求积和 $\\sum_{i=1}^5 w_i\\mu_i^n$ 来计算积分，并将其与已知的解析结果进行比较，对于偶数 $n$ 是 $2/(n+1)$，对于奇数 $n$ 是 $0$。如果所有计算的积分都在 $10^{-12}$ 的容差范围内与它们的解析值相符，则测试通过。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\n\ndef calculate_sigma_l(l_max, n_pts, sigma_s_func):\n    \"\"\"\n    Calculates Legendre moments sigma_l for l=0,...,l_max using an n_pts\n    Gauss-Legendre quadrature.\n\n    Args:\n        l_max (int): Maximum Legendre order to compute.\n        n_pts (int): Number of quadrature points.\n        sigma_s_func (callable): Function that takes an array of mu values and\n                                 returns the cross section sigma_s(mu).\n\n    Returns:\n        list: A list of the computed moments [sigma_0, ..., sigma_l_max].\n    \"\"\"\n    mus, weights = special.roots_legendre(n_pts)\n    sigma_s_vals = sigma_s_func(mus)\n\n    sigmas = []\n    for l in range(l_max + 1):\n        # Evaluate P_l at all quadrature nodes\n        pl_vals = special.eval_legendre(l, mus)\n        \n        # Form the integrand for the moment calculation\n        integrand_vals = sigma_s_vals * pl_vals\n        \n        # Perform the quadrature sum\n        integral = np.dot(weights, integrand_vals)\n        \n        # Apply the normalization factor\n        sigma_l = (2 * l + 1) / 2.0 * integral\n        sigmas.append(sigma_l)\n        \n    return sigmas\n\n\ndef test_case_1():\n    \"\"\"\n    Test Case 1: sigma_s is a polynomial of degree L=3 in Legendre basis.\n    The N=L+1 quadrature is exact.\n    \"\"\"\n    L = 3\n    N = L + 1\n    a_coeffs = np.array([1.2, 0.5, -0.3, 0.25])\n\n    def sigma_s_mu(mu):\n        # Using numpy's broadcasting for evaluation at multiple points\n        L_vals = np.arange(len(a_coeffs))\n        mu_reshaped = mu[:, np.newaxis]\n        pl_matrix = special.eval_legendre(L_vals, mu_reshaped)\n        return pl_matrix @ a_coeffs\n\n    sigmas = calculate_sigma_l(L, N, sigma_s_mu)\n    return sigmas\n\n\ndef test_case_2():\n    \"\"\"\n    Test Case 2: Boundary case with L=0, constant cross section.\n    \"\"\"\n    L = 0\n    N = L + 1\n    c = 2.5\n\n    def sigma_s_mu(mu):\n        return np.full_like(mu, c)\n\n    sigmas = calculate_sigma_l(L, N, sigma_s_mu)\n    return sigmas[0]\n\n\ndef test_case_3():\n    \"\"\"\n    Test Case 3: Stress test where N=L+1 is not sufficient for exactness.\n    \"\"\"\n    L = 3\n    c_coeffs = np.array([0.8, -0.4, 0.3, 0.2, -0.1, 0.05, 0.02])\n\n    def sigma_s_mu(mu):\n        # Note: np.polyval expects coefficients from highest power to lowest\n        return np.polyval(c_coeffs[::-1], mu)\n\n    # Approximate calculation with N = L+1 points\n    N_q = L + 1\n    sigmas_q = calculate_sigma_l(L, N_q, sigma_s_mu)\n\n    # Reference calculation with minimally exact number of points\n    # deg(sigma_s) = 6, max deg(P_l) = 3. Integrand deg = 9.\n    # 2*N_ref - 1 >= 9 ==> N_ref >= 5.\n    N_ref = 5\n    sigmas_ref = calculate_sigma_l(L, N_ref, sigma_s_mu)\n\n    # Calculate max absolute error\n    error = np.max(np.abs(np.array(sigmas_q) - np.array(sigmas_ref)))\n    return error\n\n\ndef test_case_4():\n    \"\"\"\n    Test Case 4: Property check of the quadrature rule itself.\n    \"\"\"\n    L = 4\n    N = L + 1  # 5 points\n    tol = 1e-12\n\n    mus, weights = special.roots_legendre(N)\n    \n    # The N=5 rule is exact for polynomials up to degree 2*5-1=9\n    # We test for monomials up to degree 2L=8\n    max_n = 2 * L\n    \n    for n in range(max_n + 1):\n        # Quadrature sum for integral of mu^n\n        integrand_vals = mus**n\n        quad_integral = np.dot(weights, integrand_vals)\n        \n        # Analytic result\n        if n % 2 != 0:\n            analytic_integral = 0.0\n        else:\n            analytic_integral = 2.0 / (n + 1)\n        \n        if abs(quad_integral - analytic_integral) > tol:\n            return False\n            \n    return True\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    results = [\n        test_case_1(),\n        test_case_2(),\n        test_case_3(),\n        test_case_4(),\n    ]\n\n    # Format the final output string as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\n\nsolve()\n\n```"
        },
        {
            "introduction": "最后，我们将所有知识点联系起来：我们究竟为什么需要计算这些勒让德矩？ 本练习将模拟一个$P_N$中子输运求解器的行为，以回答这个问题。通过使用一个前向峰化的散射模型并改变展开阶数$ N $，你将直接观察到标通量和中子流这两个反应堆模拟的关键输出量，其精度如何依赖于所包含的勒让德矩的数量。这能让你深刻体会到在计算成本和物理保真度之间的权衡。",
            "id": "4233106",
            "problem": "考虑一个在一维平板几何中的稳态、单能中子输运问题。未知的角通量表示为 $\\psi(x,\\mu)$，其中 $x$ 是空间坐标（单位为 $\\mathrm{cm}$），$\\mu$ 是方向余弦（无量纲）。总宏观截面为 $\\Sigma_t$（单位为 $\\mathrm{cm^{-1}}$）。散射核由勒让德展开表示，其矩为 $\\Sigma_{s,\\ell}$，使得散射源项与球谐函数方法 ($P_N$) 一致。在该方法中，角通量展开为 $\\psi(x,\\mu) \\approx \\sum_{\\ell=0}^{N} (2\\ell+1)\\,\\phi_\\ell(x)\\,P_\\ell(\\mu)$，其矩为 $\\phi_\\ell(x)$（标量通量为 $\\phi_0(x)$，流为 $\\phi_1(x)$）。微观物理由一个前向峰化核参数化，其中散射截面的勒让德矩满足 $\\Sigma_{s,\\ell} = \\Sigma_{s,0}\\,g^\\ell$，其中 $0 \\le g  1$，$\\Sigma_{s,0} = c\\,\\Sigma_t$ 且 $0  c  1$。这种形式与 Henyey–Greenstein 型相函数一致，其勒让德矩随 $\\ell$ 按几何级数衰减。\n\n假设一个各向同性体积源，其空间依赖关系为 $Q(x) = Q_0 \\cos(k x)$，其中 $Q_0$ 是源的零阶勒让德矩（单位为 $\\mathrm{n\\;cm^{-3}\\;s^{-1}}$），$k$ 是波数（单位为弧度/$\\mathrm{cm}$）。使用在 $N$ 阶截断的球谐函数方法 ($P_N$)，通过将中子输运方程投影到勒让德多项式上，可以得到平板几何中的矩方程。这会形成一个关于 $\\{\\phi_\\ell(x)\\}_{\\ell=0}^N$ 的耦合系统，其中流项带来最近邻耦合，对角项包含 $\\Sigma_t$ 和 $\\Sigma_{s,\\ell}$。在谐波驱动 $Q(x) = \\Re\\{Q_0 e^{i k x}\\}$ 下，适合寻找谐波响应 $\\phi_\\ell(x) = \\Re\\{\\hat{\\phi}_\\ell e^{i k x}\\}$，这将空间导数转换为代数因子 $i k$。\n\n从基本中子平衡方程和勒让德多项式的标准正交性出发，推导在 $P_N$ 闭合条件 $\\hat{\\phi}_{-1} = 0$ 和 $\\hat{\\phi}_{N+1} = 0$ 下关于复振幅 $\\{\\hat{\\phi}_\\ell\\}_{\\ell=0}^{N}$ 的代数系统。然后，设计并实现一个数值实验，该实验为一组前向峰化核计算标量通量振幅 $\\hat{\\phi}_0$ 和流振幅 $\\hat{\\phi}_1$ 的 $P_1$、$P_3$ 和 $P_7$ 解，并通过与 $N = N_{\\mathrm{ref}}$ 处的高阶参考解进行比较，来量化这些振幅相对于 $N$ 的收敛性。\n\n该数值实验必须遵守以下要求：\n\n- 使用由球谐函数方法 ($P_N$) 在带谐波源的平板几何中形成的耦合矩方程。您必须为复振幅 $\\{\\hat{\\phi}_\\ell\\}$ 构建 $(N+1)\\times(N+1)$ 线性系统，其中流项带来与 $i k$ 成正比的最近邻耦合，对角线项包含 $(2\\ell+1)\\left(\\Sigma_t - \\Sigma_{s,\\ell}\\right)$。源矩向量仅有第零个分量非零，等于 $Q_0$。\n- 对于每个 $N \\in \\{1,3,7\\}$，求解 $\\hat{\\phi}_0$ 和 $\\hat{\\phi}_1$，并计算这些复振幅相对于 $N_{\\mathrm{ref}} = 31$ 的参考 $P_{N_{\\mathrm{ref}}}$ 解的相对误差。复振幅 $\\hat{\\phi}$ 的相对误差必须定义为 $|\\hat{\\phi}^{(N)} - \\hat{\\phi}^{(N_{\\mathrm{ref}})}| \\big/ |\\hat{\\phi}^{(N_{\\mathrm{ref}})}|$，该值为无量纲。\n- 所有截面以 $\\mathrm{cm^{-1}}$ 表示，波数 $k$ 以弧度/$\\mathrm{cm}$ 表示，源 $Q_0$ 以 $\\mathrm{n\\;cm^{-3}\\;s^{-1}}$ 表示，并报告相对误差（无量纲）。角度不直接报告；方向余弦 $\\mu$ 是无量纲的，空间谐波波数 $k$ 使用弧度单位。\n- 提供一个参数集 $(\\Sigma_t, c, g, k, Q_0)$ 的测试套件，以探索不同情况，包括一般情况、类扩散行为、极端前向峰化、各向同性散射对照和吸收增强。具体使用：\n    - 情况 A（一般前向峰化）：$(\\Sigma_t, c, g, k, Q_0) = (\\,1\\,\\mathrm{cm^{-1}},\\,0.9,\\,0.9,\\,0.5\\,\\mathrm{rad\\;cm^{-1}},\\,1\\,\\mathrm{n\\;cm^{-3}\\;s^{-1}}\\,)$。\n    - 情况 B（类扩散 $k \\to 0$）：$(\\Sigma_t, c, g, k, Q_0) = (\\,1\\,\\mathrm{cm^{-1}},\\,0.9,\\,0.9,\\,10^{-3}\\,\\mathrm{rad\\;cm^{-1}},\\,1\\,\\mathrm{n\\;cm^{-3}\\;s^{-1}}\\,)$。\n    - 情况 C（极端前向峰化和更高空间频率）：$(\\Sigma_t, c, g, k, Q_0) = (\\,1\\,\\mathrm{cm^{-1}},\\,0.95,\\,0.99,\\,2\\,\\mathrm{rad\\;cm^{-1}},\\,1\\,\\mathrm{n\\;cm^{-3}\\;s^{-1}}\\,)$。\n    - 情况 D（各向同性散射对照）：$(\\Sigma_t, c, g, k, Q_0) = (\\,1\\,\\mathrm{cm^{-1}},\\,0.9,\\,0,\\,0.5\\,\\mathrm{rad\\;cm^{-1}},\\,1\\,\\mathrm{n\\;cm^{-3}\\;s^{-1}}\\,)$。\n    - 情况 E（吸收增强）：$(\\Sigma_t, c, g, k, Q_0) = (\\,1\\,\\mathrm{cm^{-1}},\\,0.3,\\,0.9,\\,0.5\\,\\mathrm{rad\\;cm^{-1}},\\,1\\,\\mathrm{n\\;cm^{-3}\\;s^{-1}}\\,)$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每种情况，按顺序输出六个浮点数 $[\\text{err}(\\hat{\\phi}_0^{\\mathrm{P1}}), \\text{err}(\\hat{\\phi}_1^{\\mathrm{P1}}), \\text{err}(\\hat{\\phi}_0^{\\mathrm{P3}}), \\text{err}(\\hat{\\phi}_1^{\\mathrm{P3}}), \\text{err}(\\hat{\\phi}_0^{\\mathrm{P7}}), \\text{err}(\\hat{\\phi}_1^{\\mathrm{P7}})]$，并将所有情况的结果连接成一个扁平列表。相对误差是无量纲的浮点数。因此，最终输出是一个包含 30 个浮点数的单行方括号列表。\n\n目标是从第一性原理出发，量化球谐函数方法 ($P_N$) 对于前向峰化散射核的收敛情况，以及标量通量和流的振幅在不同情况下如何依赖于 $N$。不需要外部输入；所有参数已在上方指定，并且必须在您的程序中硬编码。",
            "solution": "用户提供的问题经评估有效。该问题在科学上是合理的、适定的、客观的且自洽的，提出了一个核反应堆物理学中的标准问题。我们现在将进行推导和求解。\n\n该问题的基础是稳态、单能、一维平板几何下的中子输运方程。该方程描述了在位置 $x$ 处、沿方向余弦 $\\mu = \\cos(\\theta)$ 指定的方向行进的中子的平衡：\n$$\n\\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t \\psi(x,\\mu) = \\int_{-1}^{1} \\Sigma_s(\\mu') \\psi(x,\\mu') d\\mu' + Q(x,\\mu)\n$$\n这里，$\\psi(x,\\mu)$ 是角中子通量，$\\Sigma_t$ 是总宏观截面，$\\Sigma_s(\\mu')$ 代表散射核，$Q(x,\\mu)$ 是外部中子源。假设散射过程是方位角对称的，因此散射核仅依赖于散射角的余弦。\n\n该问题指定使用球谐函数 ($P_N$) 方法来近似求解。这涉及将通量 $\\psi(x,\\mu)$ 和散射核 $\\Sigma_s(\\mu_s)$ 的角依赖性用勒让德多项式 $P_\\ell(\\mu)$ 进行展开。一个常见的约定是定义通量矩 $\\phi_\\ell(x)$，然后为这些矩构建方程组，这导出了问题中描述的系统。用矩 $\\{\\phi_\\ell(x)\\}_{\\ell=0}^N$ 表示的一维输运方程由下式给出：\n$$\n\\frac{\\ell}{2\\ell-1}\\frac{{d\\phi}_{\\ell-1}(x)}{dx} + \\frac{\\ell+1}{2\\ell+1}\\frac{d\\phi_{\\ell+1}(x)}{dx} + (\\Sigma_t - \\Sigma_{s,\\ell})\\phi_\\ell(x) = Q_\\ell(x)\n$$\n其中 $\\phi_\\ell(x) = \\int_{-1}^{1} \\psi(x,\\mu) P_\\ell(\\mu) d\\mu$ 是通量矩，$\\Sigma_{s,\\ell}$ 是散射截面的勒让德矩，$Q_\\ell(x)$ 是源的矩。问题陈述暗示了对这些方程进行缩放。如果我们将第 $\\ell$ 个方程乘以 $(2\\ell+1)$，我们得到：\n$$\n\\ell \\frac{d\\phi_{\\ell-1}(x)}{dx} + (\\ell+1) \\frac{d\\phi_{\\ell+1}(x)}{dx} + (2\\ell+1)(\\Sigma_t - \\Sigma_{s,\\ell})\\phi_\\ell(x) = (2\\ell+1)Q_\\ell(x)\n$$\n此形式与问题陈述中描述的矩阵结构相匹配。$P_N$ 近似通过设置 $\\phi_{N+1}(x) = 0$ 来闭合。对于 $\\ell=0$ 的方程，条件 $\\phi_{-1}=0$ 自然满足。源被指定为各向同性，其空间依赖关系为 $Q(x) = Q_0 \\cos(kx)$。其唯一的非零矩是 $\\ell=0$ 时的矩：$Q_0(x) = Q_0 \\cos(kx)$。对于 $\\ell  0$，所有其他矩 $Q_\\ell(x)=0$。\n\n该问题寻求谐波驱动下的解。我们将源表示为 $Q(x) = \\Re\\{Q_0 e^{ikx}\\}$，并为通量矩寻求谐波响应：$\\phi_\\ell(x) = \\Re\\{\\hat{\\phi}_\\ell e^{ikx}\\}$。空间导数算子 $\\frac{d}{dx}$ 变换为乘以 $ik$。将这些形式代入缩放后的矩方程，得到一个关于复振幅 $\\{\\hat{\\phi}_\\ell\\}_{\\ell=0}^N$ 的代数方程组：\n$$\nik\\ell\\,\\hat{\\phi}_{\\ell-1} + ik(\\ell+1)\\,\\hat{\\phi}_{\\ell+1} + (2\\ell+1)(\\Sigma_t - \\Sigma_{s,\\ell})\\hat{\\phi}_\\ell = (2\\ell+1)Q_0\\delta_{\\ell,0}\n$$\n对于 $\\ell=0$，这给出：\n$$\nik\\,\\hat{\\phi}_{1} + (\\Sigma_t - \\Sigma_{s,0})\\hat{\\phi}_0 = Q_0\n$$\n对于 $1 \\le \\ell \\le N-1$：\n$$\nik\\ell\\,\\hat{\\phi}_{\\ell-1} + ik(\\ell+1)\\,\\hat{\\phi}_{\\ell+1} + (2\\ell+1)(\\Sigma_t - \\Sigma_{s,\\ell})\\hat{\\phi}_\\ell = 0\n$$\n对于 $\\ell=N$，应用闭合条件 $\\hat{\\phi}_{N+1}=0$：\n$$\nikN\\,\\hat{\\phi}_{N-1} + (2N+1)(\\Sigma_t - \\Sigma_{s,N})\\hat{\\phi}_N = 0\n$$\n该系统可以写成矩阵形式 $A \\hat{\\mathbf{\\phi}} = \\hat{\\mathbf{Q}}$，其中 $\\hat{\\mathbf{\\phi}} = [\\hat{\\phi}_0, \\hat{\\phi}_1, \\dots, \\hat{\\phi}_N]^T$ 且 $\\hat{\\mathbf{Q}} = [Q_0, 0, \\dots, 0]^T$。矩阵 $A$ 是一个 $(N+1) \\times (N+1)$ 的复值三对角矩阵，其对于 $\\ell = 0, \\dots, N$ 的非零元如下：\n$$\nA_{\\ell,\\ell-1} = ik\\ell \\quad (\\text{对于 } \\ell  0)\n$$\n$$\nA_{\\ell,\\ell} = (2\\ell+1)(\\Sigma_t - \\Sigma_{s,\\ell})\n$$\n$$\nA_{\\ell,\\ell+1} = ik(\\ell+1) \\quad (\\text{对于 } \\ell  N)\n$$\n问题指定散射矩为 $\\Sigma_{s,\\ell} = \\Sigma_{s,0} g^\\ell$，其中 $\\Sigma_{s,0} = c \\Sigma_t$。\n\n该数值实验涉及为不同的展开阶数 $N \\in \\{1, 3, 7\\}$ 和几组物理参数构建并求解此线性系统。计算一个 $N_{\\mathrm{ref}}=31$ 的高阶参考解作为基准。通过计算标量通量 ($\\hat{\\phi}_0$) 和流 ($\\hat{\\phi}_1$) 的复振幅相对于该参考解的相对误差，来量化 $P_N$ 近似的收敛性。复数量 $\\hat{\\phi}$ 的相对误差定义为 $|\\hat{\\phi}^{(N)} - \\hat{\\phi}^{(N_{\\mathrm{ref}})}| / |\\hat{\\phi}^{(N_{\\mathrm{ref}})}|$。\n\n算法如下：\n1. 对于每个参数集 $(\\Sigma_t, c, g, k, Q_0)$：\n2. 通过为 $N = N_{\\mathrm{ref}} = 31$ 构建并求解系统 $A \\hat{\\mathbf{\\phi}} = \\hat{\\mathbf{Q}}$，计算参考解向量 $\\hat{\\mathbf{\\phi}}^{(N_{\\mathrm{ref}})}$。提取参考振幅 $\\hat{\\phi}_0^{(N_{\\mathrm{ref}})}$ 和 $\\hat{\\phi}_1^{(N_{\\mathrm{ref}})}$。\n3. 对于每个测试阶数 $N \\in \\{1, 3, 7\\}$：\n    a. 通过求解该 $N$ 对应的系统，计算解向量 $\\hat{\\mathbf{\\phi}}^{(N)}$。\n    b. 提取振幅 $\\hat{\\phi}_0^{(N)}$ 和 $\\hat{\\phi}_1^{(N)}$。\n    c. 使用指定公式计算 $\\hat{\\phi}_0$ 和 $\\hat{\\phi}_1$ 的相对误差。\n4. 将所有计算出的相对误差按规定顺序收集到一个列表中，以供最终输出。\n\n此过程在以下 Python 代码中实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_pn(N, Sigma_t, c, g, k, Q0):\n    \"\"\"\n    Constructs and solves the P_N algebraic system for complex flux moment amplitudes.\n\n    Args:\n        N (int): The order of the P_N approximation.\n        Sigma_t (float): Total macroscopic cross section (cm^-1).\n        c (float): Scattering ratio (Sigma_s0 / Sigma_t).\n        g (float): Anisotropy factor for scattering moments.\n        k (float): Wavenumber of the harmonic source (rad/cm).\n        Q0 (float): Amplitude of the zeroth moment of the source (n cm^-3 s^-1).\n\n    Returns:\n        numpy.ndarray: A complex vector of the flux moment amplitudes [phi_0, ..., phi_N].\n    \"\"\"\n    n_vars = N + 1\n    A = np.zeros((n_vars, n_vars), dtype=np.complex128)\n    b = np.zeros(n_vars, dtype=np.complex128)\n\n    # Set the source term (only the 0-th moment is non-zero)\n    b[0] = Q0\n\n    # Calculate the 0-th scattering moment\n    Sigma_s0 = c * Sigma_t\n\n    # Populate the tridiagonal matrix A\n    for l in range(n_vars):\n        # Scattering moment for order l\n        Sigma_sl = Sigma_s0 * (g**l)\n        \n        # Diagonal element\n        A[l, l] = (2 * l + 1) * (Sigma_t - Sigma_sl)\n\n        # Super-diagonal element (l - l+1 coupling)\n        if l  N:\n            A[l, l + 1] = 1j * k * (l + 1)\n\n        # Sub-diagonal element (l - l-1 coupling)\n        if l > 0:\n            A[l, l - 1] = 1j * k * l\n\n    # Solve the linear system A * phi_hat = b\n    phi_hat = np.linalg.solve(A, b)\n    return phi_hat\n\ndef solve():\n    \"\"\"\n    Main function to run the numerical experiment as specified in the problem.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: general forward-peaked\n        (1.0, 0.9, 0.9, 0.5, 1.0),\n        # Case B: diffusion-like k - 0\n        (1.0, 0.9, 0.9, 1e-3, 1.0),\n        # Case C: extreme forward-peaked and higher spatial frequency\n        (1.0, 0.95, 0.99, 2.0, 1.0),\n        # Case D: isotropic scattering control\n        (1.0, 0.9, 0.0, 0.5, 1.0),\n        # Case E: increased absorption\n        (1.0, 0.3, 0.9, 0.5, 1.0),\n    ]\n\n    N_orders = [1, 3, 7]\n    N_ref = 31\n    \n    all_results = []\n\n    for params in test_cases:\n        Sigma_t, c, g, k, Q0 = params\n\n        # Compute the high-order reference solution\n        phi_hat_ref = solve_pn(N_ref, Sigma_t, c, g, k, Q0)\n        phi0_ref = phi_hat_ref[0]\n        phi1_ref = phi_hat_ref[1]\n\n        # Avoid division by zero if reference value is zero (highly unlikely for these params)\n        phi0_ref_mag = np.abs(phi0_ref)\n        if phi0_ref_mag == 0: phi0_ref_mag = 1.0\n\n        phi1_ref_mag = np.abs(phi1_ref)\n        if phi1_ref_mag == 0: phi1_ref_mag = 1.0\n\n        # Compute solutions for specified N orders and their errors\n        for N in N_orders:\n            phi_hat_N = solve_pn(N, *params)\n            phi0_N = phi_hat_N[0]\n            # Current (phi_1) is only available for N = 1\n            phi1_N = phi_hat_N[1] if N = 1 else 0.0 + 0.0j\n\n            # Calculate relative errors\n            err_phi0 = np.abs(phi0_N - phi0_ref) / phi0_ref_mag\n            err_phi1 = np.abs(phi1_N - phi1_ref) / phi1_ref_mag\n            \n            all_results.append(err_phi0)\n            all_results.append(err_phi1)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.8e}' for x in all_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}