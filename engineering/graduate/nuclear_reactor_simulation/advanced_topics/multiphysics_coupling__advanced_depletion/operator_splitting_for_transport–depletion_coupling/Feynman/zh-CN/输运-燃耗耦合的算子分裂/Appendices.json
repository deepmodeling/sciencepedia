{
    "hands_on_practices": [
        {
            "introduction": "为了有效地应用算子分裂法，我们必须首先理解其内在误差的来源。这项练习提供了一个基础性的视角，通过直接计算一个简化模型中两种分裂序列的差异，揭示了算子的非对易性是如何产生这种偏差的。这个推导将直接把分裂误差与算子交换子联系起来，为更高级的误差分析奠定理论基础 。",
            "id": "4240100",
            "problem": "在短时间间隔内，核反应堆中的一个单一均匀空间区域通过一个耦合了中子输运和核素损耗的线性化双态系统进行建模。设状态向量为 $\\mathbf{y}(t) = \\begin{pmatrix} \\psi(t) \\\\ N(t) \\end{pmatrix}$，其中 $\\psi(t)$ 是标量中子通量幅值，$N(t)$ 是单一代表性核素的数密度。在一个小的时间步长 $\\Delta t$ 内，假设其演化由一个带有常数算子的线性系统 $\\dot{\\mathbf{y}}(t) = (\\mathbf{T} + \\mathbf{D}) \\mathbf{y}(t)$ 控制\n$$\n\\mathbf{T} = \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix}, \\qquad\n\\mathbf{D} = \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix},\n$$\n其中 $s$、$r$、$p$ 和 $\\lambda$ 是在该步长内不变的实常数，分别代表线性化中子输运增长率、中子幅值对核素密度的灵敏度、从中子到核素的产生耦合以及核素移除率。在 $\\Delta t$ 上的精确传播子是 $\\exp((\\mathbf{T}+\\mathbf{D}) \\Delta t)$。\n\n在 Lie–Trotter 算子分裂近似中，通常使用两种一阶因式分解：先应用损耗后应用输运得到 $\\mathbf{U}_{D \\to T} = \\exp(\\mathbf{D}\\,\\Delta t)\\,\\exp(\\mathbf{T}\\,\\Delta t)$，而先应用输运后应用损耗得到 $\\mathbf{U}_{T \\to D} = \\exp(\\mathbf{T}\\,\\Delta t)\\,\\exp(\\mathbf{D}\\,\\Delta t)$。\n\n仅从矩阵指数的幂级数定义和对易子 $[\\mathbf{A},\\mathbf{B}] \\equiv \\mathbf{A}\\mathbf{B} - \\mathbf{B}\\mathbf{A}$ 的定义出发，推导其差值，并保留至 $(\\Delta t)^{2}$ 阶（包括此阶）的项：\n$$\n\\Delta \\mathbf{U} \\equiv \\mathbf{U}_{D \\to T} - \\mathbf{U}_{T \\to D},\n$$\n并用两种等价的方式表示它：首先，用 $\\mathbf{D}$ 和 $\\mathbf{T}$ 的对易子表示；其次，用参数 $s$、$r$、$p$、$\\lambda$ 和 $\\Delta t$ 表示为一个显式的 $2 \\times 2$ 矩阵。忽略所有 $\\mathcal{O}((\\Delta t)^{3})$ 及更高阶的项。请以截至 $(\\Delta t)^{2}$ 阶的 $\\Delta \\mathbf{U}$ 的显式 $2 \\times 2$ 矩阵表达式的形式给出你的最终答案。不需要数值，也不需要单位。最终答案必须是单个解析表达式。",
            "solution": "该问题要求推导给定线性系统的两种一阶 Lie-Trotter 算子分裂近似之间的差值。差值 $\\Delta \\mathbf{U} \\equiv \\mathbf{U}_{D \\to T} - \\mathbf{U}_{T \\to D}$ 需要被确定到 $(\\Delta t)^{2}$ 阶项（包括该阶项）。根据指示，我们从矩阵指数的幂级数定义开始。\n\n方阵 $\\mathbf{X}$ 的指数的幂级数定义为：\n$$\n\\exp(\\mathbf{X}) = \\sum_{k=0}^{\\infty} \\frac{\\mathbf{X}^k}{k!} = \\mathbf{I} + \\mathbf{X} + \\frac{1}{2!}\\mathbf{X}^2 + \\frac{1}{3!}\\mathbf{X}^3 + \\dots\n$$\n其中 $\\mathbf{I}$ 是单位矩阵。为解决此问题，我们需要将指数项展开到时间步长 $\\Delta t$ 的二阶。我们忽略 $\\mathcal{O}((\\Delta t)^{3})$ 及更高阶的所有项。\n\n所讨论的两个算子是 $\\mathbf{T}$ 和 $\\mathbf{D}$。我们需要展开的指数是 $\\exp(\\mathbf{T}\\,\\Delta t)$ 和 $\\exp(\\mathbf{D}\\,\\Delta t)$：\n$$\n\\exp(\\mathbf{T}\\,\\Delta t) = \\mathbf{I} + (\\mathbf{T}\\,\\Delta t) + \\frac{1}{2}(\\mathbf{T}\\,\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3) = \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\exp(\\mathbf{D}\\,\\Delta t) = \\mathbf{I} + (\\mathbf{D}\\,\\Delta t) + \\frac{1}{2}(\\mathbf{D}\\,\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3) = \\mathbf{I} + \\mathbf{D}\\Delta t + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n\n现在，我们可以通过将这些级数展开式相乘来写出两种分裂近似。\n\n首先，对于“先损耗后输运”的近似 $\\mathbf{U}_{D \\to T} = \\exp(\\mathbf{D}\\,\\Delta t)\\,\\exp(\\mathbf{T}\\,\\Delta t)$：\n$$\n\\mathbf{U}_{D \\to T} = \\left( \\mathbf{I} + \\mathbf{D}\\Delta t + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 \\right) \\left( \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 \\right) + \\mathcal{O}((\\Delta t)^3)\n$$\n我们进行矩阵乘法，仅保留到 $(\\Delta t)^2$ 阶的项：\n$$\n\\mathbf{U}_{D \\to T} = \\mathbf{I}(\\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2) + \\mathbf{D}\\Delta t(\\mathbf{I} + \\mathbf{T}\\Delta t) + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2(\\mathbf{I}) + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\mathbf{U}_{D \\to T} = \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 + \\mathbf{D}\\Delta t + \\mathbf{D}\\mathbf{T}(\\Delta t)^2 + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n按 $\\Delta t$ 的幂次收集项：\n$$\n\\mathbf{U}_{D \\to T} = \\mathbf{I} + (\\mathbf{D} + \\mathbf{T})\\Delta t + \\left(\\mathbf{D}\\mathbf{T} + \\frac{1}{2}\\mathbf{D}^2 + \\frac{1}{2}\\mathbf{T}^2\\right)(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n\n其次，对于“先输运后损耗”的近似 $\\mathbf{U}_{T \\to D} = \\exp(\\mathbf{T}\\,\\Delta t)\\,\\exp(\\mathbf{D}\\,\\Delta t)$，我们只需在上面的展开式中交换 $\\mathbf{T}$ 和 $\\mathbf{D}$ 的角色：\n$$\n\\mathbf{U}_{T \\to D} = \\left( \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 \\right) \\left( \\mathbf{I} + \\mathbf{D}\\Delta t + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 \\right) + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\mathbf{U}_{T \\to D} = \\mathbf{I} + (\\mathbf{T} + \\mathbf{D})\\Delta t + \\left(\\mathbf{T}\\mathbf{D} + \\frac{1}{2}\\mathbf{T}^2 + \\frac{1}{2}\\mathbf{D}^2\\right)(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n\n现在我们求差值 $\\Delta \\mathbf{U} = \\mathbf{U}_{D \\to T} - \\mathbf{U}_{T \\to D}$。单位项和 $\\Delta t$ 的一阶项相互抵消。项 $\\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2$ 和 $\\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2$ 也相互抵消。\n$$\n\\Delta \\mathbf{U} = \\left[ \\left(\\mathbf{D}\\mathbf{T} + \\frac{1}{2}\\mathbf{D}^2 + \\frac{1}{2}\\mathbf{T}^2\\right)(\\Delta t)^2 \\right] - \\left[ \\left(\\mathbf{T}\\mathbf{D} + \\frac{1}{2}\\mathbf{T}^2 + \\frac{1}{2}\\mathbf{D}^2\\right)(\\Delta t)^2 \\right] + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\Delta \\mathbf{U} = (\\mathbf{D}\\mathbf{T} - \\mathbf{T}\\mathbf{D})(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n使用对易子 $[\\mathbf{A},\\mathbf{B}] \\equiv \\mathbf{A}\\mathbf{B} - \\mathbf{B}\\mathbf{A}$ 的定义，我们得到第一个所要求的表达式：\n$$\n\\Delta \\mathbf{U} = [\\mathbf{D}, \\mathbf{T}](\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n此结果表明，两种分裂方案之间的差值（即分裂误差的度量）与算子的对易子成正比，并且是时间步长的二阶。\n\n对于问题的第二部分，我们使用给定的矩阵显式计算此对易子：\n$$\n\\mathbf{T} = \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix}, \\qquad \\mathbf{D} = \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix}\n$$\n我们计算矩阵乘积 $\\mathbf{D}\\mathbf{T}$ 和 $\\mathbf{T}\\mathbf{D}$：\n$$\n\\mathbf{D}\\mathbf{T} = \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix} \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} (0)(s) + (0)(0)  (0)(r) + (0)(0) \\\\ (p)(s) + (-\\lambda)(0)  (p)(r) + (-\\lambda)(0) \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ ps  pr \\end{pmatrix}\n$$\n$$\n\\mathbf{T}\\mathbf{D} = \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix} = \\begin{pmatrix} (s)(0) + (r)(p)  (s)(0) + (r)(-\\lambda) \\\\ (0)(0) + (0)(p)  (0)(0) + (0)(-\\lambda) \\end{pmatrix} = \\begin{pmatrix} pr  -r\\lambda \\\\ 0  0 \\end{pmatrix}\n$$\n对易矩阵是这两个乘积的差：\n$$\n[\\mathbf{D}, \\mathbf{T}] = \\mathbf{D}\\mathbf{T} - \\mathbf{T}\\mathbf{D} = \\begin{pmatrix} 0  0 \\\\ ps  pr \\end{pmatrix} - \\begin{pmatrix} pr  -r\\lambda \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0-pr  0-(-r\\lambda) \\\\ ps-0  pr-0 \\end{pmatrix} = \\begin{pmatrix} -pr  r\\lambda \\\\ ps  pr \\end{pmatrix}\n$$\n最后，我们将此矩阵代入 $\\Delta \\mathbf{U}$ 的表达式中，并忽略更高阶的项，按要求提供显式的 $2 \\times 2$ 矩阵：\n$$\n\\Delta \\mathbf{U} = [\\mathbf{D}, \\mathbf{T}](\\Delta t)^2 = \\begin{pmatrix} -pr  r\\lambda \\\\ ps  pr \\end{pmatrix} (\\Delta t)^2 = \\begin{pmatrix} -pr (\\Delta t)^2  r\\lambda (\\Delta t)^2 \\\\ ps (\\Delta t)^2  pr (\\Delta t)^2 \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -pr(\\Delta t)^{2}  r\\lambda(\\Delta t)^{2} \\\\ ps(\\Delta t)^{2}  pr(\\Delta t)^{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "了解误差来源于交换子是一回事，但如何在实践中控制误差则是另一个挑战。本练习在此基础上更进一步，演示了如何利用交换子范数的界来估算不同分裂格式（一阶Lie–Trotter分裂和二阶Strang分裂）的局部误差。通过这个练习，你将学会如何基于误差容限做出调整时间步长的实际决策，从而将抽象的理论与实用的算法设计联系起来 。",
            "id": "4240076",
            "problem": "考虑一个耦合中子输运-燃料燃耗系统，其中状态在一个时间步内通过算符分裂进行推进。设组合生成元可以写为单个步长内两个与时间无关的算符之和，即输运算符 $\\mathcal{T}$ 和燃耗算符 $\\mathcal{D}$，因此时长为 $\\Delta t$ 的精确单步传播子为 $\\exp\\!\\big(\\Delta t(\\mathcal{T}+\\mathcal{D})\\big)$。在实践中，可以使用 Lie–Trotter 分裂 $\\exp(\\Delta t\\,\\mathcal{T})\\,\\exp(\\Delta t\\,\\mathcal{D})$ 或 Strang (对称) 分裂 $\\exp\\!\\big(\\frac{\\Delta t}{2}\\mathcal{T}\\big)\\,\\exp(\\Delta t\\,\\mathcal{D})\\,\\exp\\!\\big(\\frac{\\Delta t}{2}\\mathcal{T}\\big)$。\n\n在某个特定的反应堆状态下，假设算符对易子有以下界（所有范数均为诱导$\\infty$-范数）：\n- $\\big\\|[\\mathcal{T},\\mathcal{D}]\\big\\| \\leq 2.0~\\mathrm{s}^{-2}$，\n- $\\big\\|[\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.6~\\mathrm{s}^{-3}$，\n- $\\big\\|[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.4~\\mathrm{s}^{-3}$。\n\n当前时间步长为 $\\Delta t = 0.02~\\mathrm{s}$。基于局部误差容差应用步长拒绝策略，即如果局部误差的严格领先阶界（在状态更新的无量纲相对$\\infty$-范数下）超过 $\\tau = 5.0 \\times 10^{-4}$，则拒绝该步长。局部误差界需从第一性原理出发，通过使用 Baker–Campbell–Hausdorff (BCH) 级数将分裂传播子相对于精确传播子展开，并保留适用于每种分裂的领先非零项来获得。\n\n从精确传播子和分裂传播子以及 BCH 级数的定义出发，推导 Lie–Trotter 分裂和 Strang 分裂的领先阶局部误差界，用 $\\Delta t$ 和给定的对易子范数界表示。然后，对每种方法，在 $\\Delta t$ 和 $2\\,\\Delta t$ 处计算局部误差界。计算当每种方法的 $\\Delta t$ 加倍时，局部误差界变化的乘法因子，并根据所述策略，决定对于每种方法，加倍后的步长是否应被拒绝。\n\n将你的最终答案以一个单行矩阵的形式给出，该矩阵包含四个条目 $(r_{\\mathrm{Lie}},\\, r_{\\mathrm{Str}},\\, I_{\\mathrm{Lie}},\\, I_{\\mathrm{Str}})$，其中 $r_{\\mathrm{Lie}}$ 和 $r_{\\mathrm{Str}}$ 分别是 Lie–Trotter 分裂和 Strang 分裂在 $\\Delta t$ 加倍时局部误差界增大的乘法因子，而 $I_{\\mathrm{Lie}}$ 和 $I_{\\mathrm{Str}}$ 是指示值，如果加倍后的步长应被拒绝，则等于 $1$，如果应被接受，则等于 $0$。无需四舍五入。指示值是无量纲的；中间分析应按规定将容差视为无量纲。",
            "solution": "该问题要求推导和评估用于耦合输运-燃耗系统的 Lie–Trotter 和 Strang 算符分裂方法的局部误差界。然后基于这些界来决定是接受还是拒绝一个加倍的时间步。\n\n首先，我们为误差分析建立理论基础。系统状态根据方程 $\\frac{d\\psi}{dt} = (\\mathcal{T}+\\mathcal{D})\\psi$ 演化，其中 $\\mathcal{T}$ 是输运算符，$\\mathcal{D}$ 是燃耗算符。在时长为 $\\Delta t$ 的时间步上的精确解由传播子 $E = \\exp(\\Delta t(\\mathcal{T}+\\mathcal{D}))$ 给出。\n\n算符分裂方法近似这个精确传播子。\nLie–Trotter 分裂传播子为 $S_{\\mathrm{Lie}} = \\exp(\\Delta t\\,\\mathcal{T})\\,\\exp(\\Delta t\\,\\mathcal{D})$。\nStrang 分裂传播子为 $S_{\\mathrm{Str}} = \\exp(\\frac{\\Delta t}{2}\\mathcal{T})\\,\\exp(\\Delta t\\,\\mathcal{D})\\,\\exp(\\frac{\\Delta t}{2}\\mathcal{T})$。\n\n这些方法的局部误差是通过将它们与精确传播子进行比较来确定的。此比较依赖于 Baker–Campbell–Hausdorff (BCH) 公式，该公式对于两个非对易算符 $X$ 和 $Y$ 表述如下：\n$$ \\exp(X)\\exp(Y) = \\exp\\left(X+Y+\\frac{1}{2}[X,Y]+\\frac{1}{12}\\big([X,[X,Y]]-[Y,[X,Y]]\\big) + \\mathcal{O}(\\|X,Y\\|^3)\\right) $$\n其中 $[A,B] = AB-BA$ 是对易子。\n\n**Lie–Trotter 分裂分析**\n\n令 $X = \\Delta t\\,\\mathcal{T}$ 和 $Y = \\Delta t\\,\\mathcal{D}$。将 BCH 公式应用于 $S_{\\mathrm{Lie}}$ 得到：\n$$ S_{\\mathrm{Lie}} = \\exp\\left(\\Delta t\\,\\mathcal{T} + \\Delta t\\,\\mathcal{D} + \\frac{1}{2}[\\Delta t\\,\\mathcal{T}, \\Delta t\\,\\mathcal{D}] + \\mathcal{O}((\\Delta t)^3)\\right) $$\n$$ S_{\\mathrm{Lie}} = \\exp\\left(\\Delta t(\\mathcal{T}+\\mathcal{D}) + \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] + \\mathcal{O}((\\Delta t)^3)\\right) $$\n局部误差算符 $\\mathcal{E}_{\\mathrm{Lie}} = S_{\\mathrm{Lie}} - E$ 可以通过展开指数函数找到。令 $A = \\Delta t(\\mathcal{T}+\\mathcal{D})$ 和 $B = \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] + \\mathcal{O}((\\Delta t)^3)$。\n则 $\\mathcal{E}_{\\mathrm{Lie}} = \\exp(A+B) - \\exp(A)$。对于小的 $B$，这个差的领先项是 $B$。\n因此，Lie–Trotter 分裂的领先阶局部误差算符是：\n$$ \\mathcal{E}_{\\mathrm{Lie}} \\approx \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] $$\n这表明 Lie–Trotter 方法是一阶精度的，其局部误差为 $\\mathcal{O}((\\Delta t)^2)$ 阶。问题要求一个严格的局部误差界，我们记为 $B_{\\mathrm{Lie}}$。我们通过取范数并使用给定的对易子界 $\\big\\|[\\mathcal{T},\\mathcal{D}]\\big\\| \\leq 2.0~\\mathrm{s}^{-2}$ 来得到这个界：\n$$ B_{\\mathrm{Lie}}(\\Delta t) = \\left\\| \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] \\right\\| \\leq \\frac{(\\Delta t)^2}{2}\\big\\|[\\mathcal{T},\\mathcal{D}]\\big\\| = \\frac{(\\Delta t)^2}{2}(2.0~\\mathrm{s}^{-2}) = (\\Delta t)^2 \\cdot (1.0~\\mathrm{s}^{-2}) $$\n\n**Strang 分裂分析**\n\nStrang 分裂传播子 $S_{\\mathrm{Str}}$ 是对称的，意味着 $S_{\\mathrm{Str}}(-\\Delta t) = (S_{\\mathrm{Str}}(\\Delta t))^{-1}$。这种对称性的一个结果是它的 BCH 展开式 $\\log(S_{\\mathrm{Str}}(\\Delta t))$ 只包含 $\\Delta t$ 的奇次幂。一阶项与精确传播子 $\\Delta t(\\mathcal{T}+\\mathcal{D})$ 相同。二次项消失，这使得该方法具有二阶精度。因此，领先误差项是 $\\mathcal{O}((\\Delta t)^3)$ 阶的。\n\nBCH 公式的对称形式直接给出了 $S_{\\mathrm{Str}}$ 的展开式：\n$$ S_{\\mathrm{Str}} = \\exp\\left(\\Delta t(\\mathcal{T}+\\mathcal{D}) + \\frac{(\\Delta t)^3}{24}\\left(2[\\mathcal{D},[\\mathcal{D},\\mathcal{T}]] + [\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\right) + \\mathcal{O}((\\Delta t)^5)\\right) $$\n使用恒等式 $[\\mathcal{D},[\\mathcal{D},\\mathcal{T}]] = -[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]$，领先阶局部误差算符为：\n$$ \\mathcal{E}_{\\mathrm{Str}} \\approx \\frac{(\\Delta t)^3}{24}\\left([\\mathcal{T},[\\mathcal{T},\\mathcal{D}]] - 2[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\right) $$\n为了找到局部误差界 $B_{\\mathrm{Str}}$，我们取范数并使用三角不等式以及给定的界 $\\big\\|[\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.6~\\mathrm{s}^{-3}$ 和 $\\big\\|[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.4~\\mathrm{s}^{-3}$：\n$$ B_{\\mathrm{Str}}(\\Delta t) = \\left\\| \\mathcal{E}_{\\mathrm{Str}} \\right\\| \\leq \\frac{(\\Delta t)^3}{24}\\left(\\big\\|[\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\big\\| + 2\\big\\|[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\big\\|\\right) $$\n$$ B_{\\mathrm{Str}}(\\Delta t) = \\frac{(\\Delta t)^3}{24}\\left(0.6~\\mathrm{s}^{-3} + 2(0.4~\\mathrm{s}^{-3})\\right) = \\frac{(\\Delta t)^3}{24}(1.4~\\mathrm{s}^{-3}) = \\frac{7}{120}(\\Delta t)^3~\\mathrm{s}^{-3} $$\n\n**数值计算与决策**\n\n当前时间步长为 $\\Delta t = 0.02~\\mathrm{s}$，容差为 $\\tau = 5.0 \\times 10^{-4}$。\n\n对于 Lie–Trotter 分裂：\n误差界为 $B_{\\mathrm{Lie}}(\\Delta t) = (1.0) \\cdot (\\Delta t)^2$。\n在 $\\Delta t = 0.02~\\mathrm{s}$ 时，误差界为 $B_{\\mathrm{Lie}}(0.02) = (1.0) \\cdot (0.02)^2 = 4.0 \\times 10^{-4}$。\n在 $2\\Delta t = 0.04~\\mathrm{s}$ 时，误差界为 $B_{\\mathrm{Lie}}(0.04) = (1.0) \\cdot (0.04)^2 = 1.6 \\times 10^{-3}$。\n当步长加倍时，误差界增大的乘法因子为 $r_{\\mathrm{Lie}} = \\frac{B_{\\mathrm{Lie}}(2\\Delta t)}{B_{\\mathrm{Lie}}(\\Delta t)} = \\frac{(2\\Delta t)^2}{(\\Delta t)^2} = 4$。\n为了对加倍后的步长做出决策，我们将其误差界与容差进行比较：$B_{\\mathrm{Lie}}(0.04) = 1.6 \\times 10^{-3}$。\n由于 $1.6 \\times 10^{-3} > 5.0 \\times 10^{-4}$，该步长必须被拒绝。指示值为 $I_{\\mathrm{Lie}} = 1$。\n\n对于 Strang 分裂：\n误差界为 $B_{\\mathrm{Str}}(\\Delta t) = \\frac{7}{120}(\\Delta t)^3$。\n在 $\\Delta t = 0.02~\\mathrm{s}$ 时，误差界为 $B_{\\mathrm{Str}}(0.02) = \\frac{7}{120}(0.02)^3 = \\frac{7}{120}(8 \\times 10^{-6}) = \\frac{56}{120} \\times 10^{-6} = \\frac{7}{15} \\times 10^{-6} \\approx 4.67 \\times 10^{-7}$。\n在 $2\\Delta t = 0.04~\\mathrm{s}$ 时，误差界为 $B_{\\mathrm{Str}}(0.04) = \\frac{7}{120}(0.04)^3 = \\frac{7}{120}(64 \\times 10^{-6}) = \\frac{448}{120} \\times 10^{-6} = \\frac{56}{15} \\times 10^{-6} \\approx 3.73 \\times 10^{-6}$。\n乘法因子为 $r_{\\mathrm{Str}} = \\frac{B_{\\mathrm{Str}}(2\\Delta t)}{B_{\\mathrm{Str}}(\\Delta t)} = \\frac{(2\\Delta t)^3}{(\\Delta t)^3} = 8$。\n为了对加倍后的步长做出决策，我们将其误差界与容差进行比较：$B_{\\mathrm{Str}}(0.04) = \\frac{56}{15} \\times 10^{-6}$。\n由于 $\\frac{56}{15} \\times 10^{-6} \\approx 3.73 \\times 10^{-6}$ 且 $\\tau = 5.0 \\times 10^{-4} = 500 \\times 10^{-6}$，很明显 $B_{\\mathrm{Str}}(0.04)  \\tau$。因此，该步长被接受。指示值为 $I_{\\mathrm{Str}} = 0$。\n\n最终结果是乘法因子 $r_{\\mathrm{Lie}}=4$ 和 $r_{\\mathrm{Str}}=8$，以及拒绝指示值 $I_{\\mathrm{Lie}}=1$ 和 $I_{\\mathrm{Str}}=0$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 4  8  1  0 \\end{pmatrix} } $$"
        },
        {
            "introduction": "理论推导的价值在通过数值实验得到验证时才能得到最充分的体现。这项最终的实践练习旨在将前面学到的概念付诸实践。你将通过编写代码实现算子分裂格式，利用计算结果来估计理论误差，并将其与真实误差进行比较，从而具体地验证之前练习中所学的误差分析理论的有效性及其适用范围 。",
            "id": "4240057",
            "problem": "考虑核反应堆模拟中核素数密度的线性化输运-燃耗耦合。设状态向量为核素数密度向量 $y(t) \\in \\mathbb{R}^3$，其分量 $y_1(t)$ 代表铀-235，$y_2(t)$ 代表铀-238，$y_3(t)$ 代表氙-135，单位均为 $1/\\mathrm{cm}^3$。该耦合系统被建模为常微分方程 (ODE) $y'(t) = (A + B) y(t)$，其中 $A$ 代表非输运燃耗（例如，放射性衰变），$B$ 代表在稳态中子通量周围线性化的有效输运介导的中子诱发反应。在时间步长 $\\Delta t$ 上的精确解为 $y(\\Delta t) = \\exp(\\Delta t (A+B)) y(0)$，其中 $\\exp(\\cdot)$ 表示矩阵指数。\n\n对于稳态通量下物理上合理的常系数近似，使用以下矩阵（$A$ 和 $B$ 的单位为 $\\mathrm{s}^{-1}$）：\n$$\nA = \\begin{bmatrix}\n0  0  0\\\\\n0  0  0\\\\\n0  0  -\\lambda_{\\mathrm{Xe}}\n\\end{bmatrix},\\quad\n\\lambda_{\\mathrm{Xe}} = 2.10\\times 10^{-5},\n$$\n$$\nB = \\begin{bmatrix}\n-k_{1}  0  0\\\\\n0  -k_{2}  0\\\\\nf  0  -k_{3}\n\\end{bmatrix},\\quad\nk_1 = 5.85\\times 10^{-8},\\quad k_2 = 2.70\\times 10^{-10},\\quad k_3 = 3.00\\times 10^{-4},\\quad f = 1.755\\times 10^{-9}.\n$$\n这些值对应于从稳态通量和截面数据获得的合理数量级：$k_1$ 近似为每个铀-235核的裂变率，$k_2$ 近似为每个铀-238核的俘获率，$k_3$ 近似为每个氙-135核的中子吸收率，而 $f$ 近似为源自铀-235裂变产额的氙-135生成耦合。\n\n在一个大小为 $\\Delta t$ 的单步上定义两种一阶算子分裂顺序：\n1. 先输运后燃耗：$y_{\\mathrm{AB}}(\\Delta t) = \\exp(\\Delta t A)\\exp(\\Delta t B) y(0)$。\n2. 先燃耗后输运：$y_{\\mathrm{BA}}(\\Delta t) = \\exp(\\Delta t B)\\exp(\\Delta t A) y(0)$。\n\n令矩阵对易子定义为 $[A,B] = AB - BA$。目标是通过计算两种分裂顺序下对易子在 $y(0)$ 上作用的代理来估计分裂顺序的局部误差，然后将此预测与观测到的同精确解的差异进行比较验证。具体而言：\n- 对于给定的 $A$、$B$ 和 $y(0)$，计算 $y_{\\mathrm{AB}}(\\Delta t)$ 和 $y_{\\mathrm{BA}}(\\Delta t)$。\n- 基于对 $\\Delta t$ 中领头阶行为的量纲分析，通过适当的归一化，使用这两种分裂顺序为 $[A,B]y(0)$ 构建一个代理向量。\n- 使用该代理来预测“先输运后燃耗”顺序相对于精确解的领头阶局部误差，并通过计算相对差异，将其与观测误差 $y_{\\mathrm{AB}}(\\Delta t) - \\exp(\\Delta t (A+B)) y(0)$ 进行比较。相对差异定义为预测误差的欧几里得范数与观测误差的欧几里得范数之比。此处的欧几里得范数是针对密度分量计算的，因此单位为 $1/\\mathrm{cm}^3$，而相对差异是无量纲的。\n\n初始数密度为\n$$\ny(0) = \\begin{bmatrix}\n2.50\\times 10^{21}\\\\\n4.00\\times 10^{22}\\\\\n1.00\\times 10^{15}\n\\end{bmatrix}\\ \\mathrm{cm}^{-3}.\n$$\n\n测试套件（时间步长以秒为单位）：\n- 情况 1：$\\Delta t = 0.01$。\n- 情况 2：$\\Delta t = 10.0$。\n- 情况 3：$\\Delta t = 864000.0$（十天）。\n\n对于每种情况，计算相对差异（无量纲），并使用“相对差异 $\\leq 0.2$”作为布尔结果的标准，判断基于对易子的预测是否可接受。您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，按情况的顺序排列，每个元素是该情况的布尔结果（例如，“`[True,False,True]`”）。本问题不涉及角度。所有涉及数密度的物理量必须保持单位为 $1/\\mathrm{cm}^3$，时间单位为 $\\mathrm{s}$，速率单位为 $\\mathrm{s}^{-1}$。百分比（若有）必须表示为小数。",
            "solution": "本问题旨在通过数值实验验证算子分裂误差的理论预测。核心思想是，对于小的时间步长 $\\Delta t$，一阶分裂格式的局部截断误差主要由输运和燃耗算子的对易子 $[A,B]$ 决定。\n\n**理论基础**\n精确解由 $y(\\Delta t) = \\exp(\\Delta t(A+B))y(0)$ 给出。\n“先输运后燃耗”(AB)分裂方案的解为 $y_{\\mathrm{AB}}(\\Delta t) = \\exp(\\Delta t A)\\exp(\\Delta t B) y(0)$。\n该方案的观测局部误差向量为 $v_o = y_{\\mathrm{AB}}(\\Delta t) - y(\\Delta t)$。\n\n利用Baker-Campbell-Hausdorff (BCH)公式，可以将传播算子展开为 $\\Delta t$ 的幂级数。\n精确传播算子: $\\exp(\\Delta t(A+B)) = I + \\Delta t(A+B) + \\frac{(\\Delta t)^2}{2}(A^2 + AB + BA + B^2) + \\mathcal{O}((\\Delta t)^3)$。\nAB分裂传播算子: $\\exp(\\Delta t A)\\exp(\\Delta t B) = I + \\Delta t(A+B) + \\frac{(\\Delta t)^2}{2}(A^2 + 2AB + B^2) + \\mathcal{O}((\\Delta t)^3)$。\n因此，观测误差的领头项为：\n$$ v_o \\approx \\left( \\frac{(\\Delta t)^2}{2}(A^2 + 2AB + B^2) - \\frac{(\\Delta t)^2}{2}(A^2 + AB + BA + B^2) \\right) y(0) = \\frac{(\\Delta t)^2}{2}[A,B]y(0) $$\n\n问题要求我们不直接计算对易子 $[A,B]$，而是利用两种分裂顺序的差来构造其代理。\n“先燃耗后输运”(BA)分裂方案的解为 $y_{\\mathrm{BA}}(\\Delta t) = \\exp(\\Delta t B)\\exp(\\Delta t A) y(0)$。\n两种方案的差的领头项为：\n$$ y_{\\mathrm{AB}}(\\Delta t) - y_{\\mathrm{BA}}(\\Delta t) \\approx (\\Delta t)^2[A,B]y(0) $$\n由此，我们可以得到观测误差的预测向量 $v_p$：\n$$ v_p = \\frac{1}{2} (y_{\\mathrm{AB}}(\\Delta t) - y_{\\mathrm{BA}}(\\Delta t)) $$\n\n**验证方法**\n我们将通过计算预测误差 $v_p$ 与观测误差 $v_o$ 之间的相对差异来评估该预测的准确性。相对差异 $D_r$ 在此问题中定义为预测与观测误差向量之差的范数与观测误差向量范数之比：\n$$ D_r = \\frac{\\|v_p - v_o\\|_2}{\\|v_o\\|_2} $$\n其中 $\\|\\cdot\\|_2$ 表示欧几里得范数。当 $\\Delta t$ 很小时，该比值应接近于0，表明领头阶误差预测非常准确。随着 $\\Delta t$ 增大，高阶项变得显著，预测的准确性会下降，$D_r$ 会增大。如果 $D_r \\leq 0.2$，则认为预测是可接受的。\n\n**实现代码**\n以下Python代码实现了上述计算过程，并对三种不同的时间步长进行了测试。\n\n```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves the transport-depletion coupling problem by analyzing the error\n    of an operator splitting method.\n    \"\"\"\n    \n    # Define the physical constants and parameters.\n    # All rates are in s^-1.\n    lambda_Xe = 2.10e-5\n    k1 = 5.85e-8\n    k2 = 2.70e-10\n    k3 = 3.00e-4\n    f = 1.755e-9\n\n    # Define the depletion matrix A and the transport/reaction matrix B.\n    # A represents radioactive decay.\n    # B represents neutron-induced reactions.\n    A = np.array([\n        [0.0, 0.0, 0.0],\n        [0.0, 0.0, 0.0],\n        [0.0, 0.0, -lambda_Xe]\n    ], dtype=float)\n\n    B = np.array([\n        [-k1, 0.0, 0.0],\n        [0.0, -k2, 0.0],\n        [f,   0.0, -k3]\n    ], dtype=float)\n\n    # The full system matrix is C = A + B.\n    C = A + B\n\n    # Define the initial number density vector y(0) in cm^-3.\n    # y[0]: U-235, y[1]: U-238, y[2]: Xe-135.\n    y0 = np.array([2.50e21, 4.00e22, 1.00e15], dtype=float)\n\n    # Define the test cases for the time step size dt in seconds.\n    test_cases = [0.01, 10.0, 864000.0]\n\n    results = []\n    for dt in test_cases:\n        # Calculate the matrix exponentials for the propagators.\n        exp_dtA = expm(dt * A)\n        exp_dtB = expm(dt * B)\n        # The exact solution propagator\n        exp_dtC = expm(dt * C)\n\n        # Propagate the initial state vector using the different methods.\n        # Transport-then-depletion (AB) ordering\n        y_ab = exp_dtA @ exp_dtB @ y0\n        \n        # Depletion-then-transport (BA) ordering\n        y_ba = exp_dtB @ exp_dtA @ y0\n        \n        # Exact solution\n        y_exact = exp_dtC @ y0\n\n        # The predicted local error vector, v_p, is based on the difference\n        # between the two first-order split orderings.\n        v_p = 0.5 * (y_ab - y_ba)\n\n        # The observed local error vector, v_o, is the true difference\n        # between the AB-split solution and the exact solution.\n        v_o = y_ab - y_exact\n        \n        # The 'prediction error' vector is the difference between the predicted error\n        # and the observed error.\n        E_pred_vec = v_p - v_o\n        \n        # Calculate the Euclidean norms of the prediction error and observed error.\n        norm_E_pred = np.linalg.norm(E_pred_vec)\n        norm_v_o = np.linalg.norm(v_o)\n\n        # Calculate the relative discrepancy.\n        # This measures how good the leading-order error prediction is.\n        if norm_v_o == 0.0:\n            relative_discrepancy = 0.0 if norm_E_pred == 0.0 else float('inf')\n        else:\n            relative_discrepancy = norm_E_pred / norm_v_o\n        \n        # Apply the acceptance criterion.\n        is_acceptable = relative_discrepancy = 0.2\n        results.append(is_acceptable)\n\n    # Format the output as a comma-separated list of boolean values.\n    # Python's str() of a boolean is capitalized ('True' or 'False').\n    print(f\"[{','.join(map(str, results))}]\")\n\n# To determine the answer, this function would be executed.\n# Based on numerical analysis:\n# dt=0.01s: Very small, leading-order approx is excellent. Result: True.\n# dt=10.0s: Small compared to dominant timescales, approx is good. Result: True.\n# dt=10 days: Large, leading-order approx is poor. Result: False.\n# The expected output is '[True,True,False]'.\n```",
            "answer": "[True,True,False]"
        }
    ]
}