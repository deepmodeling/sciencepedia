{
    "hands_on_practices": [
        {
            "introduction": "To effectively apply the power iteration method, we must first translate the underlying physics of neutron transport into a mathematical framework. This initial practice focuses on that crucial first step. By starting with fundamental physical parameters like macroscopic cross-sections and the fission spectrum, you will construct the core matrices that define the k-eigenvalue problem, providing a concrete link between physical processes and their linear algebraic representation .",
            "id": "4241549",
            "problem": "Consider a two-energy-group, homogeneous infinite-medium model for steady-state neutron transport in a nuclear reactor simulation. In an infinite medium, spatial leakage is neglected, and the multigroup neutron balance for group $g \\in \\{1,2\\}$ equates the rate of neutron loss due to absorption and out-scattering to the rate of gain due to in-scattering and fission production, with the latter scaled by the effective multiplication factor $k$. Starting from this balance, the system can be cast into a $k$-eigenvalue problem of the form $A \\phi = \\frac{1}{k} B \\phi$, where $A$ is the loss operator and $B$ is the fission production operator, and $\\phi$ is the two-group flux vector.\n\nUse the following physically plausible macroscopic cross-sections (units are centimeters inverse, written $\\text{cm}^{-1}$), group-wise fission parameters, and fission spectrum:\n- Group $1$ absorption $\\,\\Sigma_{a,1} = 0.07\\,\\text{cm}^{-1}$, down-scatter $\\,\\Sigma_{s,1 \\to 2} = 0.21\\,\\text{cm}^{-1}$, and group-wise average neutrons per fission times fission cross-section $\\,\\nu \\Sigma_{f,1} = 0.042\\,\\text{cm}^{-1}$.\n- Group $2$ absorption $\\,\\Sigma_{a,2} = 0.09\\,\\text{cm}^{-1}$, up-scatter $\\,\\Sigma_{s,2 \\to 1} = 0.015\\,\\text{cm}^{-1}$, and group-wise $\\,\\nu \\Sigma_{f,2} = 0.175\\,\\text{cm}^{-1}$.\n- Fission spectrum fractions (probability a fission neutron is born in each group): $\\,\\chi_1 = 0.92\\,$ and $\\,\\chi_2 = 0.08\\,$.\n\nLet the two-group flux vector be\n$$\n\\phi = \\begin{pmatrix} \\phi_1 \\\\ \\phi_2 \\end{pmatrix} = \\begin{pmatrix} 1.37 \\times 10^{13} \\\\ 2.62 \\times 10^{13} \\end{pmatrix} \\ \\text{cm}^{-2}\\,\\text{s}^{-1}.\n$$\n\nTasks:\n1. Starting from the steady-state multigroup balance in an infinite medium, assemble the $2 \\times 2$ loss matrix $A$ and the $2 \\times 2$ fission production matrix $B$ consistent with the $k$-eigenvalue formulation described above.\n2. State the dimensions and sparsity patterns of $A$ and $B$.\n3. Compute the fission source vector $q = B \\phi$, and then compute the scalar total fission source\n$$\nS_f = q_1 + q_2,\n$$\nwhere $q_g$ is the $g$-th component of $q$. Express the final numerical value of $S_f$ in neutrons per cubic centimeter per second, written as $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, and round your answer to five significant figures.",
            "solution": "The user-provided problem has been analyzed and is determined to be **valid**. It is scientifically grounded in the principles of nuclear reactor physics, well-posed with sufficient and consistent data, and objectively stated. The tasks involve a standard application of the multigroup neutron balance equations.\n\nThe problem asks to perform three tasks related to the two-group, steady-state, infinite-medium neutron balance equations. We will address each task in sequence.\n\nFirst, we establish the theoretical framework. The steady-state neutron balance for energy group $g$ in an infinite medium equates neutron losses (absorption and out-scattering) to neutron gains (in-scattering and fission).\n\nFor a two-group model ($g=1$ for the fast group, $g=2$ for the thermal group), the balance equations are:\n\nFor group $1$:\n$$\n\\text{Losses}_1 = \\text{Gains}_1\n$$\n$$\n\\Sigma_{a,1}\\phi_1 + \\Sigma_{s,1 \\to 2}\\phi_1 = \\Sigma_{s,2 \\to 1}\\phi_2 + \\frac{1}{k} \\chi_1 \\left( \\nu\\Sigma_{f,1}\\phi_1 + \\nu\\Sigma_{f,2}\\phi_2 \\right)\n$$\n\nFor group $2$:\n$$\n\\text{Losses}_2 = \\text{Gains}_2\n$$\n$$\n\\Sigma_{a,2}\\phi_2 + \\Sigma_{s,2 \\to 1}\\phi_2 = \\Sigma_{s,1 \\to 2}\\phi_1 + \\frac{1}{k} \\chi_2 \\left( \\nu\\Sigma_{f,1}\\phi_1 + \\nu\\Sigma_{f,2}\\phi_2 \\right)\n$$\n\nHere, $\\phi_g$ is the neutron flux in group $g$, $\\Sigma_{a,g}$ is the macroscopic absorption cross-section, $\\Sigma_{s,g \\to g'}$ is the macroscopic scattering cross-section from group $g$ to $g'$, $\\nu\\Sigma_{f,g}$ is the average number of neutrons produced per fission times the macroscopic fission cross-section, $\\chi_g$ is the fraction of fission neutrons born in group $g$, and $k$ is the effective multiplication factor.\n\nThe problem requires casting this system into the form $A \\phi = \\frac{1}{k} B \\phi$. To do this, we group all non-fission terms on the left-hand side and all fission-related production terms on the right-hand side.\n\nRearranging the equations:\n$$\n(\\Sigma_{a,1} + \\Sigma_{s,1 \\to 2})\\phi_1 - \\Sigma_{s,2 \\to 1}\\phi_2 = \\frac{1}{k} \\left[ \\chi_1 ( \\nu\\Sigma_{f,1}\\phi_1 + \\nu\\Sigma_{f,2}\\phi_2 ) \\right]\n$$\n$$\n-\\Sigma_{s,1 \\to 2}\\phi_1 + (\\Sigma_{a,2} + \\Sigma_{s,2 \\to 1})\\phi_2 = \\frac{1}{k} \\left[ \\chi_2 ( \\nu\\Sigma_{f,1}\\phi_1 + \\nu\\Sigma_{f,2}\\phi_2 ) \\right]\n$$\n\nThis system can be written in matrix form as:\n$$\n\\begin{pmatrix} \\Sigma_{a,1} + \\Sigma_{s,1 \\to 2}  -\\Sigma_{s,2 \\to 1} \\\\ -\\Sigma_{s,1 \\to 2}  \\Sigma_{a,2} + \\Sigma_{s,2 \\to 1} \\end{pmatrix} \\begin{pmatrix} \\phi_1 \\\\ \\phi_2 \\end{pmatrix} = \\frac{1}{k} \\begin{pmatrix} \\chi_1 \\nu\\Sigma_{f,1}  \\chi_1 \\nu\\Sigma_{f,2} \\\\ \\chi_2 \\nu\\Sigma_{f,1}  \\chi_2 \\nu\\Sigma_{f,2} \\end{pmatrix} \\begin{pmatrix} \\phi_1 \\\\ \\phi_2 \\end{pmatrix}\n$$\n\n**Task 1: Assemble the loss matrix $A$ and the fission production matrix $B$.**\n\nFrom the matrix equation above, we can identify a loss operator $A$ (more precisely, a net loss and scattering operator) and a fission production operator $B$.\n\nThe loss matrix $A$ is:\n$$\nA = \\begin{pmatrix} \\Sigma_{a,1} + \\Sigma_{s,1 \\to 2}  -\\Sigma_{s,2 \\to 1} \\\\ -\\Sigma_{s,1 \\to 2}  \\Sigma_{a,2} + \\Sigma_{s,2 \\to 1} \\end{pmatrix}\n$$\nThe fission production matrix $B$ is:\n$$\nB = \\begin{pmatrix} \\chi_1 \\nu\\Sigma_{f,1}  \\chi_1 \\nu\\Sigma_{f,2} \\\\ \\chi_2 \\nu\\Sigma_{f,1}  \\chi_2 \\nu\\Sigma_{f,2} \\end{pmatrix}\n$$\nThis can also be expressed as the outer product of the fission spectrum vector $\\chi_g$ and the production vector $\\nu\\Sigma_{f,g}$, i.e., $B = \\chi (\\nu\\Sigma_f)^T$.\n\nNow, we substitute the given numerical values:\n$\\Sigma_{a,1} = 0.07\\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\to 2} = 0.21\\,\\text{cm}^{-1}$, $\\nu \\Sigma_{f,1} = 0.042\\,\\text{cm}^{-1}$.\n$\\Sigma_{a,2} = 0.09\\,\\text{cm}^{-1}$, $\\Sigma_{s,2 \\to 1} = 0.015\\,\\text{cm}^{-1}$, $\\nu \\Sigma_{f,2} = 0.175\\,\\text{cm}^{-1}$.\n$\\chi_1 = 0.92$, $\\chi_2 = 0.08$.\n\nFor matrix $A$:\n$A_{11} = \\Sigma_{a,1} + \\Sigma_{s,1 \\to 2} = 0.07 + 0.21 = 0.28\\,\\text{cm}^{-1}$\n$A_{12} = -\\Sigma_{s,2 \\to 1} = -0.015\\,\\text{cm}^{-1}$\n$A_{21} = -\\Sigma_{s,1 \\to 2} = -0.21\\,\\text{cm}^{-1}$\n$A_{22} = \\Sigma_{a,2} + \\Sigma_{s,2 \\to 1} = 0.09 + 0.015 = 0.105\\,\\text{cm}^{-1}$\n$$\nA = \\begin{pmatrix} 0.28  -0.015 \\\\ -0.21  0.105 \\end{pmatrix}\\,\\text{cm}^{-1}\n$$\n\nFor matrix $B$:\n$B_{11} = \\chi_1 \\nu\\Sigma_{f,1} = 0.92 \\times 0.042 = 0.03864\\,\\text{cm}^{-1}$\n$B_{12} = \\chi_1 \\nu\\Sigma_{f,2} = 0.92 \\times 0.175 = 0.161\\,\\text{cm}^{-1}$\n$B_{21} = \\chi_2 \\nu\\Sigma_{f,1} = 0.08 \\times 0.042 = 0.00336\\,\\text{cm}^{-1}$\n$B_{22} = \\chi_2 \\nu\\Sigma_{f,2} = 0.08 \\times 0.175 = 0.014\\,\\text{cm}^{-1}$\n$$\nB = \\begin{pmatrix} 0.03864  0.161 \\\\ 0.00336  0.014 \\end{pmatrix}\\,\\text{cm}^{-1}\n$$\n\n**Task 2: State the dimensions and sparsity patterns of $A$ and $B$.**\n\nThe dimensions of both matrix $A$ and matrix $B$ are $2 \\times 2$, corresponding to the two energy groups.\nRegarding sparsity, a matrix is sparse if many of its elements are zero. In this case, all elements of both $A$ and $B$ are non-zero. Therefore, both matrices $A$ and $B$ are dense.\n\n**Task 3: Compute the fission source vector $q = B\\phi$ and the scalar total fission source $S_f = q_1 + q_2$.**\n\nThe fission source vector $q$ represents the rate of production of fission neutrons per unit volume in each energy group. It is calculated as $q = B\\phi$. The total fission source $S_f$ is the sum of the components of $q$.\nGiven the flux vector:\n$$\n\\phi = \\begin{pmatrix} \\phi_1 \\\\ \\phi_2 \\end{pmatrix} = \\begin{pmatrix} 1.37 \\times 10^{13} \\\\ 2.62 \\times 10^{13} \\end{pmatrix} \\ \\text{cm}^{-2}\\,\\text{s}^{-1}\n$$\nThe total fission source $S_f$ is the total number of neutrons produced by fission per unit volume per unit time. This is given by the sum over all groups of the fission rate in each group multiplied by the neutrons per fission.\n$$\nS_f = \\sum_{g=1}^{2} \\nu\\Sigma_{f,g} \\phi_g = \\nu\\Sigma_{f,1}\\phi_1 + \\nu\\Sigma_{f,2}\\phi_2\n$$\nNote that since the fission spectrum fractions sum to unity ($\\chi_1 + \\chi_2 = 0.92 + 0.08 = 1$), it holds that $S_f = q_1 + q_2$.\nWe calculate $S_f$ directly:\n$$\nS_f = (0.042\\,\\text{cm}^{-1}) \\times (1.37 \\times 10^{13}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}) + (0.175\\,\\text{cm}^{-1}) \\times (2.62 \\times 10^{13}\\,\\text{cm}^{-2}\\,\\text{s}^{-1})\n$$\n$$\nS_f = (0.05754 \\times 10^{13}) + (0.4585 \\times 10^{13}) \\,\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}\n$$\n$$\nS_f = 0.51604 \\times 10^{13} \\,\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}\n$$\n$$\nS_f = 5.1604 \\times 10^{12} \\,\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}\n$$\nThe problem requires the final answer to be rounded to five significant figures. The calculated value $5.1604 \\times 10^{12}$ already has five significant figures.",
            "answer": "$$\n\\boxed{5.1604 \\times 10^{12}}\n$$"
        },
        {
            "introduction": "With the system matrices established, we can now examine the engine of the power iteration method: a single iterative step. This exercise guides you through the core mechanics of updating the neutron flux. You will solve the fixed-source problem $A x = B\\phi^{(m)}$ and then apply the necessary normalization, gaining direct experience with how the flux distribution and the k-eigenvalue estimate are refined in one cycle of the algorithm .",
            "id": "4241508",
            "problem": "Consider the steady-state, one-group neutron diffusion $k$-eigenvalue problem in One Dimension (1D),\n$$- \\frac{d}{dx}\\left(D(x)\\frac{d \\phi(x)}{dx}\\right) + \\Sigma_{a}(x)\\,\\phi(x) \\;=\\; \\frac{1}{k}\\,\\nu \\Sigma_{f}(x)\\,\\phi(x),$$\nwhere $D(x)$ is the diffusion coefficient, $\\Sigma_{a}(x)$ is the absorption macroscopic cross section, $\\nu\\Sigma_{f}(x)$ is the neutron production macroscopic cross section, $\\phi(x)$ is the neutron flux, and $k$ is the effective multiplication factor. Under a uniform mesh finite-difference discretization with reflecting boundary conditions on a three-cell mesh of equal widths, the spatial operator and the fission production operator assemble into the matrices\n$$A \\;=\\; \\begin{pmatrix}\n1.1  -1  0 \\\\\n-1  2.1  -1 \\\\\n0  -1  1.1\n\\end{pmatrix}, \\qquad\nB \\;=\\; \\mathrm{diag}\\!\\big(0.1,\\;0.125,\\;0.1\\big).$$\nLet the current iterate flux vector be\n$$\\phi^{(m)} \\;=\\; \\begin{pmatrix} 4 \\\\ 4 \\\\ 1 \\end{pmatrix},$$\nwhich has been normalized to unit total fission source using the weighting induced by $B$. Define the fission-source normalization functional $S(\\psi)$ by\n$$S(\\psi) \\;=\\; \\sum_{i=1}^{3} \\big[B\\big]_{ii}\\,\\psi_i \\;=\\; 0.1\\,\\psi_1 + 0.125\\,\\psi_2 + 0.1\\,\\psi_3.$$\nImplement one step of Power Iteration (PI) by solving the linear system\n$$A\\,x \\;=\\; B\\,\\phi^{(m)},$$\nforming the updated flux\n$$\\phi^{(m+1)} \\;=\\; \\frac{x}{S(x)}$$\nso that $S\\!\\big(\\phi^{(m+1)}\\big) = 1$, and estimating the updated multiplication factor $k^{(m+1)}$ using the fission-based estimator. Express the final $k^{(m+1)}$ as a dimensionless real number and round your answer to six significant figures.",
            "solution": "The one-group neutron diffusion $k$-eigenvalue problem can be written in operator form as\n$$A\\,\\phi \\;=\\; \\frac{1}{k}\\,B\\,\\phi,$$\nwhere $A$ represents leakage and absorption and $B$ represents fission production. Rearranging yields\n$$A^{-1} B\\,\\phi \\;=\\; k\\,\\phi,$$\nso the dominant eigenvalue of $A^{-1} B$ is $k$. The Power Iteration (PI) step constructs\n$$y \\;=\\; A^{-1} B\\,\\phi^{(m)}$$\nby solving $A\\,x = B\\,\\phi^{(m)}$ and taking $x = y$. If the flux is normalized by the fission-source functional $S(\\cdot)$ so that $S\\!\\big(\\phi^{(m)}\\big)=1$, then for the exact eigenpair it holds $y = k\\,\\phi$ and therefore\n$$S(y) \\;=\\; S(k\\,\\phi) \\;=\\; k\\,S(\\phi) \\;=\\; k.$$\nThus, under fission-source normalization, the fission-based estimator of the updated multiplication factor is\n$$k^{(m+1)} \\;=\\; S(x),$$\nand the updated flux is scaled to maintain $S\\!\\big(\\phi^{(m+1)}\\big) = 1$ via $\\phi^{(m+1)} = x/S(x)$.\n\nWe now carry out the calculation with the given data. First compute the right-hand side $r = B\\,\\phi^{(m)}$:\n$$r \\;=\\; \\begin{pmatrix}\n0.1  0  0 \\\\\n0  0.125  0 \\\\\n0  0  0.1\n\\end{pmatrix}\n\\begin{pmatrix} 4 \\\\ 4 \\\\ 1 \\end{pmatrix}\n\\;=\\; \\begin{pmatrix} 0.4 \\\\ 0.5 \\\\ 0.1 \\end{pmatrix}.$$\nSolve the linear system $A\\,x = r$ with\n$$A \\;=\\; \\begin{pmatrix}\n1.1  -1  0 \\\\\n-1  2.1  -1 \\\\\n0  -1  1.1\n\\end{pmatrix}, \\qquad r \\;=\\; \\begin{pmatrix} 0.4 \\\\ 0.5 \\\\ 0.1 \\end{pmatrix}.$$\nWrite the equations componentwise:\n\\begin{align*}\n1.1\\,x_1 - x_2 = 0.4, \\\\\n-\\,x_1 + 2.1\\,x_2 - x_3 = 0.5, \\\\\n-\\,x_2 + 1.1\\,x_3 = 0.1.\n\\end{align*}\nFrom the first equation, express $x_2$ in terms of $x_1$:\n$$x_2 \\;=\\; 1.1\\,x_1 - 0.4.$$\nFrom the third equation, express $x_3$ in terms of $x_2$:\n$$1.1\\,x_3 \\;=\\; 0.1 + x_2 \\;\\;\\Rightarrow\\;\\; x_3 \\;=\\; \\frac{0.1 + x_2}{1.1} \\;=\\; x_1 - \\frac{3}{11}.$$\nInsert these into the second equation:\n\\begin{align*}\n-\\,x_1 + 2.1\\,x_2 - x_3 = 0.5, \\\\\n-\\,x_1 + 2.1\\,(1.1\\,x_1 - 0.4) - \\big(x_1 - \\tfrac{3}{11}\\big) = 0.5, \\\\\n\\left(-1 + 2.31 - 1\\right) x_1 + \\left(-0.84 + \\tfrac{3}{11}\\right) = 0.5, \\\\\n0.31\\,x_1 - \\frac{156}{275} = \\frac{1}{2}.\n\\end{align*}\nSolve for $x_1$:\n\\begin{align*}\n0.31\\,x_1 = \\frac{1}{2} + \\frac{156}{275} \\;=\\; \\frac{587}{550}, \\\\\nx_1 = \\frac{587}{550}\\cdot\\frac{100}{31} \\;=\\; \\frac{1174}{341}.\n\\end{align*}\nThen\n\\begin{align*}\nx_2 = 1.1\\,x_1 - 0.4 \\;=\\; \\frac{11}{10}\\cdot\\frac{1174}{341} - \\frac{2}{5} \\;=\\; \\frac{1155}{341}, \\\\\nx_3 = x_1 - \\frac{3}{11} \\;=\\; \\frac{1174}{341} - \\frac{93}{341} \\;=\\; \\frac{1081}{341}.\n\\end{align*}\nThus,\n$$x \\;=\\; \\begin{pmatrix} \\dfrac{1174}{341} \\\\ \\dfrac{1155}{341} \\\\ \\dfrac{1081}{341} \\end{pmatrix}.$$\nCompute the fission-source functional $S(x)$ using the diagonal entries of $B$:\n\\begin{align*}\nS(x) \\;=\\; 0.1\\,x_1 + 0.125\\,x_2 + 0.1\\,x_3 \\\\\n=\\; \\frac{1}{10}\\cdot\\frac{1174}{341} \\;+\\; \\frac{1}{8}\\cdot\\frac{1155}{341} \\;+\\; \\frac{1}{10}\\cdot\\frac{1081}{341}\n\\end{align*}\nBring to a common denominator of 13640:\n\\begin{align*}\nS(x) = \\frac{1174 \\cdot 4}{3410 \\cdot 4} + \\frac{1155 \\cdot 5}{2728 \\cdot 5} + \\frac{1081 \\cdot 4}{3410 \\cdot 4} \\\\\n= \\frac{4696}{13640} + \\frac{5775}{13640} + \\frac{4324}{13640} \\\\\n= \\frac{4696 + 5775 + 4324}{13640} = \\frac{14795}{13640}\n\\end{align*}\nSimplifying the fraction by dividing the numerator and denominator by 5 gives $\\frac{2959}{2728}$.\nTherefore, the fission-based estimator gives\n$$k^{(m+1)} \\;=\\; S(x) \\;=\\; \\frac{2959}{2728} \\;\\approx\\; 1.084677419\\ldots.$$\nRounding to six significant figures yields\n$$k^{(m+1)} \\;\\approx\\; 1.08468.$$",
            "answer": "$$\\boxed{1.08468}$$"
        },
        {
            "introduction": "Building on the single-step mechanic, this final practice challenges you to implement the complete power iteration loop, including the critical aspect of assessing convergence. Real-world simulations don't run forever; we need robust criteria to know when to stop. This problem emphasizes the necessity of monitoring both the eigenvalue ($k$) and the eigenvector (fission source shape) to avoid the pitfall of \"false convergence\" and ensure a physically meaningful solution .",
            "id": "4241519",
            "problem": "Consider the steady-state, one-speed neutron balance in a homogeneous medium discretized into a finite number of spatial cells. In operator form, the state equation is given by $T \\phi = \\frac{1}{k} F \\phi$, where $T$ is the removal/transport operator, $F$ is the fission production operator, $\\phi$ is the neutron flux (a state vector), and $k$ is the effective neutron multiplication factor (the $k$-eigenvalue). Assume that $T$ is a non-singular matrix with strictly positive diagonal entries and that $F$ is a non-negative, irreducible matrix representing a physically plausible coupling of fission production across cells.\n\nDefine $B = T^{-1} F$. Under these assumptions, the power iteration applied to the $k$-eigenvalue problem can be cast in terms of repeated application of $B$ to the flux vector. Let $q_n = F \\phi_n$ denote the fission source at iteration $n$. In each iteration, you update the flux and compute the instantaneous growth factor of the fission source. Let $\\lambda_n$ denote the ratio of the total fission source between consecutive iterates, that is, $\\lambda_n = \\frac{\\sum_i (q_{n+1})_i}{\\sum_i (q_n)_i}$, and define $k_{n+1} = \\frac{1}{\\lambda_n}$. After computing the raw update $\\phi^{\\text{raw}}_{n+1} = B \\phi_n$ and $q^{\\text{raw}}_{n+1} = F \\phi^{\\text{raw}}_{n+1}$, renormalize the flux by setting $\\phi_{n+1} = \\frac{\\phi^{\\text{raw}}_{n+1}}{\\lambda_n}$ and $q_{n+1} = \\frac{q^{\\text{raw}}_{n+1}}{\\lambda_n}$, so that $\\sum_i (q_{n+1})_i = \\sum_i (q_n)_i$ is maintained across iterations.\n\nYour task is to implement a program that, for a specified test problem and given thresholds, computes the stopping iteration index at which both of the following conditions are simultaneously satisfied:\n- The relative change in the effective multiplication factor is strictly less than a given threshold, that is, $\\frac{|k_{n+1} - k_n|}{k_{n+1}}  \\varepsilon_k$.\n- The normalized fission source difference, measured by the one-norm of the difference between successive normalized sources, is strictly less than a given threshold, that is, $\\left\\| \\hat{q}_{n+1} - \\hat{q}_n \\right\\|_1  \\varepsilon_q$, where $\\hat{q}_n = \\frac{q_n}{\\sum_i (q_n)_i}$.\n\nThe iteration starts from an initial flux $\\phi_0$ and an initial guess $k_0$ and proceeds with the renormalization detailed above. If the criteria are not met within a specified maximum number of iterations, return $-1$ for that case. Throughout, use the one-norm for vector sums and differences, ensure all matrix-vector operations are finite and well-defined, and assume no physical units are required for the final outputs (all quantities are dimensionless). Angles are not involved.\n\nThe test problem is defined with the following $4 \\times 4$ matrices:\n- $T = \\mathrm{diag}(1.2, 0.9, 1.1, 1.0)$,\n- $F = \\begin{pmatrix}\n0.7  0.2  0.1  0.1 \\\\\n0.1  0.7  0.2  0.1 \\\\\n0.1  0.1  0.6  0.2 \\\\\n0.1  0.1  0.2  0.5\n\\end{pmatrix}$.\n\nThe operator $B$ is implicitly determined as $B = T^{-1} F$. Assume $T$ and $F$ are fixed across all test cases.\n\nImplement the algorithm described above and apply it to the following test suite. Each test case is a tuple consisting of $(\\phi_0, k_0, \\varepsilon_k, \\varepsilon_q, N_{\\max})$, where $N_{\\max}$ is the maximum number of iterations.\n\nTest suite:\n1. General case with typical tolerances: $\\phi_0 = (1, 1, 1, 1)$, $k_0 = 1.0$, $\\varepsilon_k = 10^{-6}$, $\\varepsilon_q = 10^{-6}$, $N_{\\max} = 200$.\n2. Loose tolerances and a non-uniform initial flux: $\\phi_0 = (0.5, 2.0, 1.5, 0.8)$, $k_0 = 0.8$, $\\varepsilon_k = 10^{-2}$, $\\varepsilon_q = 10^{-2}$, $N_{\\max} = 50$.\n3. Impossible strict thresholds (zero) with a moderate iteration cap: $\\phi_0 = (1, 1, 1, 1)$, $k_0 = 1.3$, $\\varepsilon_k = 0.0$, $\\varepsilon_q = 0.0$, $N_{\\max} = 30$.\n4. Immediate convergence case, dominant eigenvector initial flux and exact initial $k$: $\\phi_0$ is set equal to the dominant right eigenvector of $B$ (scaled arbitrarily to a positive vector), $k_0$ is set equal to the exact $k$ corresponding to the dominant eigenvalue of $B$ (that is, $k_0 = \\frac{1}{\\rho(B)}$ where $\\rho(B)$ is the spectral radius), $\\varepsilon_k = 10^{-12}$, $\\varepsilon_q = 10^{-12}$, $N_{\\max} = 5$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4]$), where $r_i$ is the stopping iteration index for the $i$-th test case or $-1$ if the criteria are not met within $N_{\\max}$.",
            "solution": "The problem requires the implementation of a power iteration algorithm to solve a nuclear reactor physics k-eigenvalue problem and determine the number of iterations required to meet specified convergence criteria.\n\n### Problem Validation\n\nThe problem statement has been validated and is deemed sound. It is scientifically grounded in the principles of neutron transport and numerical linear algebra, specifically the power iteration method for finding the dominant eigenpair of a matrix. The governing equation, $T \\phi = \\frac{1}{k} F \\phi$, is a standard, discretized representation of the steady-state neutron balance. The properties of the operators $T$ and $F$ (non-singular, positive diagonal $T$; non-negative, irreducible $F$) are physically realistic and ensure, via the Perron-Frobenius theorem, that the iteration matrix $B = T^{-1} F$ has a unique, simple, positive dominant eigenvalue and a corresponding positive eigenvector. The algorithm, initial conditions, and convergence criteria are specified in sufficient detail to allow for a unique and verifiable solution.\n\nA minor ambiguity in the problem's phrasing was identified concerning the definition of the normalization factor $\\lambda_n$. The text states, \"Let $\\lambda_n$ denote the ratio of the total fission source between consecutive iterates, that is, $\\lambda_n = \\frac{\\sum_i (q_{n+1})_i}{\\sum_i (q_n)_i}$,\" while also specifying that the subsequent normalization uses $\\lambda_n$ such that $\\sum_i (q_{n+1})_i = \\sum_i (q_n)_i$. This would imply $\\lambda_n = 1$, which is incorrect. The only logical interpretation is that $\\lambda_n$ is computed using the un-normalized (raw) iterates, specifically $\\lambda_n = \\frac{\\sum_i (q^{\\text{raw}}_{n+1})_i}{\\sum_i (q_n)_i}$. With this standard interpretation, the problem is well-posed. The definition $k_{n+1} = 1/\\lambda_n$ is unconventional (as the physical k-eigenvalue is the dominant eigenvalue of the iteration matrix), but it is mathematically consistent within the self-contained definition of the algorithm to be implemented.\n\n### Principle-Based Solution Design\n\nThe core of the problem is to implement the power iteration for the generalized eigenvalue problem $T \\phi = \\frac{1}{k} F \\phi$. The power iteration method is an algorithm that repeatedly applies the iteration matrix $B = T^{-1}F$ to an initial vector $\\phi_0$, which causes the vector to converge to the eigenvector associated with the dominant eigenvalue. The ratio of the norms of successive vectors converges to the dominant eigenvalue itself.\n\nThe algorithm specified in the problem statement is a variant of this method, formulated in terms of the fission source vector $q_n = F \\phi_n$. The algorithm proceeds as follows:\n\n**1. Initialization ($n=0$)**\n- Given an initial flux guess $\\phi_0$ and k-eigenvalue guess $k_0$.\n- The matrices $T$ and $F$ are provided:\n$$T = \\mathrm{diag}(1.2, 0.9, 1.1, 1.0)$$\n$$F = \\begin{pmatrix} 0.7  0.2  0.1  0.1 \\\\ 0.1  0.7  0.2  0.1 \\\\ 0.1  0.1  0.6  0.2 \\\\ 0.1  0.1  0.2  0.5 \\end{pmatrix}$$\n- The iteration matrix $B = T^{-1} F$ is computed. Since $T$ is diagonal, $T^{-1}$ is simply the diagonal matrix with entries $1/T_{ii}$.\n- The initial fission source is $q_0 = F \\phi_0$.\n- The initial normalized fission source for convergence checks is $\\hat{q}_0 = \\frac{q_0}{\\|q_0\\|_1}$, where $\\| \\cdot \\|_1$ is the one-norm (sum of absolute values of components).\n\n**2. Iteration Step ($n \\to n+1$)**\nFor each iteration, starting from $n=0$ up to a maximum of $N_{\\max}-1$:\n- The state is defined by $(\\phi_n, k_n, q_n, \\hat{q}_n)$.\n- An un-normalized successor flux is computed: $\\phi^{\\text{raw}}_{n+1} = B \\phi_n$.\n- An un-normalized successor fission source is computed: $q^{\\text{raw}}_{n+1} = F \\phi^{\\text{raw}}_{n+1}$.\n- A normalization factor, which is an estimate of the dominant eigenvalue of $B$, is calculated. The problem statement refers to this as $\\lambda_n$, but to avoid index confusion, we will call the factor computed at step $n+1$ as $\\lambda_{n+1}$:\n$$\\lambda_{n+1} = \\frac{\\|q^{\\text{raw}}_{n+1}\\|_1}{\\|q_n\\|_1} = \\frac{\\sum_i |(q^{\\text{raw}}_{n+1})_i|}{\\sum_i |(q_n)_i|}$$\nSince all vectors involved are non-negative, the absolute values are redundant.\n- The successor k-eigenvalue is updated according to the problem's specific rule:\n$$k_{n+1} = \\frac{1}{\\lambda_{n+1}}$$\n- The flux and fission source are normalized for the next iteration:\n$$\\phi_{n+1} = \\frac{\\phi^{\\text{raw}}_{n+1}}{\\lambda_{n+1}}, \\quad q_{n+1} = \\frac{q^{\\text{raw}}_{n+1}}{\\lambda_{n+1}}$$\nThis normalization ensures that $\\|q_{n+1}\\|_1 = \\|q_n\\|_1$, maintaining a constant total fission source across iterations.\n- The normalized fission source for the convergence check is updated:\n$$\\hat{q}_{n+1} = \\frac{q_{n+1}}{\\|q_{n+1}\\|_1}$$\n\n**3. Convergence Check**\nAfter computing the state for step $n+1$, two criteria are checked against thresholds $\\varepsilon_k$ and $\\varepsilon_q$:\n- Relative change in k-eigenvalue: $\\frac{|k_{n+1} - k_n|}{k_{n+1}}  \\varepsilon_k$.\n- One-norm of the difference in normalized fission sources: $\\|\\hat{q}_{n+1} - \\hat{q}_n\\|_1  \\varepsilon_q$.\n\nIf both conditions are met, the iteration is considered converged, and the stopping iteration index is $n+1$. If the loop completes up to $N_{\\max}$ iterations without convergence, the result is $-1$.\n\n**4. Special Case: Test Case 4**\nThis case requires setting the initial state $(\\phi_0, k_0)$ to the exact dominant eigenpair of $B$. This is achieved by numerically computing the eigenvalues and eigenvectors of the $4 \\times 4$ matrix $B$. The dominant eigenvalue is the one with the largest magnitude, which is the spectral radius $\\rho(B)$. By the Perron-Frobenius theorem, this eigenvalue is real and positive, and its corresponding eigenvector can be chosen to have all positive components.\n- The initial value $k_0$ is set as per the problem's convention: $k_0 = 1/\\rho(B)$.\n- The initial flux $\\phi_0$ is set to the corresponding eigenvector.\nWith this initial state, the algorithm is expected to converge in the first iteration, as the errors should be numerically zero.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.linalg import norm, eig\n\ndef solve():\n    \"\"\"\n    Solves the power iteration k-eigenvalue problem for a given test suite.\n    \"\"\"\n    # Define the fixed matrices T and F for the test problem.\n    T_mat = np.diag([1.2, 0.9, 1.1, 1.0])\n    F_mat = np.array([\n        [0.7, 0.2, 0.1, 0.1],\n        [0.1, 0.7, 0.2, 0.1],\n        [0.1, 0.1, 0.6, 0.2],\n        [0.1, 0.1, 0.2, 0.5]\n    ])\n\n    # Compute the iteration matrix B = T_inv * F\n    T_inv_mat = np.diag(1.0 / np.diag(T_mat))\n    B_mat = T_inv_mat @ F_mat\n\n    # --- Setup for Test Case 4: requires a priori knowledge of the dominant eigenpair ---\n    # Compute eigenvalues and eigenvectors of B_mat\n    eigenvalues, eigenvectors = eig(B_mat)\n    \n    # The dominant eigenvalue (spectral radius) is the one with the largest magnitude.\n    # By Perron-Frobenius, it is real and positive.\n    dominant_eigenvalue = np.max(np.abs(eigenvalues))\n    \n    # The problem asks for k_0 = 1 / rho(B)\n    k0_case4 = 1.0 / dominant_eigenvalue\n    \n    # The initial flux is the corresponding eigenvector.\n    # It can be scaled arbitrarily; we ensure it's real and positive.\n    dominant_eigenvector_idx = np.argmax(np.abs(eigenvalues))\n    phi0_case4 = np.real(eigenvectors[:, dominant_eigenvector_idx])\n    # Ensure all components are positive, as guaranteed by Perron-Frobenius theorem\n    # for a non-negative, irreducible matrix.\n    phi0_case4 = np.abs(phi0_case4)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (np.array([1.0, 1.0, 1.0, 1.0]), 1.0, 1e-6, 1e-6, 200),\n        (np.array([0.5, 2.0, 1.5, 0.8]), 0.8, 1e-2, 1e-2, 50),\n        (np.array([1.0, 1.0, 1.0, 1.0]), 1.3, 0.0, 0.0, 30),\n        (phi0_case4, k0_case4, 1e-12, 1e-12, 5)\n    ]\n\n    results = []\n\n    for case in test_cases:\n        phi_0, k_0, eps_k, eps_q, N_max = case\n        \n        # Initialize state for iteration 0\n        phi_n = phi_0\n        k_n = k_0\n        q_n = F_mat @ phi_n\n        \n        # Guard against zero vector for q_0\n        q_norm = norm(q_n, 1)\n        if q_norm == 0:\n            results.append(-1) # Cannot proceed\n            continue\n            \n        q_hat_n = q_n / q_norm\n\n        converged = False\n        for n in range(1, N_max + 1):\n            # Compute raw updates for iteration n\n            phi_raw_n1 = B_mat @ phi_n\n            q_raw_n1 = F_mat @ phi_raw_n1\n\n            # Get norms for eigenvalue estimate\n            q_raw_n1_norm = norm(q_raw_n1, 1)\n            q_n_norm = norm(q_n, 1)\n\n            # Check for division by zero (stagnation or collapse)\n            if q_n_norm == 0:\n                break\n                \n            lambda_val = q_raw_n1_norm / q_n_norm\n            \n            if lambda_val == 0:\n                break\n            \n            # Update state variables to n+1\n            k_n1 = 1.0 / lambda_val\n            phi_n1 = phi_raw_n1 / lambda_val\n            q_n1 = q_raw_n1 / lambda_val\n            \n            q_n1_norm = norm(q_n1, 1)\n            if q_n1_norm == 0:\n                break\n            q_hat_n1 = q_n1 / q_n1_norm\n\n            # Check for convergence\n            # Denominator k_{n+1} is used as per problem spec\n            err_k = np.abs(k_n1 - k_n) / k_n1\n            err_q = norm(q_hat_n1 - q_hat_n, 1)\n\n            if err_k  eps_k and err_q  eps_q:\n                results.append(n)\n                converged = True\n                break\n\n            # Prepare for the next iteration\n            phi_n, k_n, q_n, q_hat_n = phi_n1, k_n1, q_n1, q_hat_n1\n        \n        if not converged:\n            results.append(-1)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}