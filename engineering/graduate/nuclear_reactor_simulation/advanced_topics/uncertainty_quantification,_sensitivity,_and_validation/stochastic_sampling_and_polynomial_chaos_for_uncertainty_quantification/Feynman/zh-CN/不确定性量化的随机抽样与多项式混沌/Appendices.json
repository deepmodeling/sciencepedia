{
    "hands_on_practices": [
        {
            "introduction": "在构建多项式混沌展开（Polynomial Chaos Expansion, PCE）模型之前，关键的第一步是确定其规模。本练习将指导您推导标准总阶展开式中基多项式的数量公式，该公式直接衡量了模型的复杂性以及未来计算所面临的挑战 。",
            "id": "4252603",
            "problem": "在稳态核反应堆模拟中，单群中子扩散模型的主要不确定性输入参数由 $d$ 个独立的标准化随机变量表示。构建一个多项式混沌展开（PCE；Polynomial Chaos Expansion）来近似一个标量关注量（例如，特征值或积分通量泛函），该近似是关于这 $d$ 个变量的多元正交多项式的有限和。该基按总阶数截断，这意味着对于给定的总阶数 $p \\in \\mathbb{N}_{0}$，所有满足 $\\sum_{i=1}^{d} \\alpha_{i} \\leq p$ 的多重指标 $\\boldsymbol{\\alpha} = (\\alpha_{1}, \\ldots, \\alpha_{d}) \\in \\mathbb{N}_{0}^{d}$ 所对应的多元单项式都被保留。从这个总阶数截断的定义以及基函数与此类多重指标一一对应的概念出发，仅使用初等计数的基本原理，推导出一个关于 $d$ 和 $p$ 的封闭形式组合表达式，用于计算保留的基多项式总数。然后，对 $d = 15$ 和 $p = 4$ 的情况计算该表达式的值。提供该情况下的最终整数值。无需四舍五入。",
            "solution": "该问题要求推导一个用于计算总阶数截断的多项式混沌展开（PCE）中基多项式数量的封闭形式组合表达式，并随后对一个特定情况进行求值。\n\n问题陈述已经过验证，被认为是有效的。它在科学上基于核工程的不确定性量化领域，作为一个组合计数问题被恰当地提出，并且以精确的定义进行了客观陈述。\n\n设 $d$ 是独立随机变量的数量，$p$ 是截断的预定总阶数。保留的基多项式集合与多重指标 $\\boldsymbol{\\alpha} = (\\alpha_{1}, \\ldots, \\alpha_{d}) \\in \\mathbb{N}_{0}^{d}$ 的集合存在双射对应关系，其中多重指标的分量之和不大于 $p$。该条件用不等式表示为：\n$$ \\sum_{i=1}^{d} \\alpha_{i} \\leq p $$\n其中每个 $\\alpha_{i}$ 是一个非负整数，即 $\\alpha_{i} \\in \\{0, 1, 2, \\ldots\\}$。\n\n任务是找到所有此类多重指标集合的基数，我们将其表示为 $N$。这是一个初等组合学中的问题。为了从基本原理推导解答，我们将不等式转化为一个等式。我们引入一个辅助的非负整数变量，通常称为“松弛”变量，$\\alpha_{d+1} \\in \\mathbb{N}_{0}$。该变量定义为：\n$$ \\alpha_{d+1} = p - \\sum_{i=1}^{d} \\alpha_{i} $$\n由于 $\\sum_{i=1}^{d} \\alpha_{i} \\leq p$，可以保证 $\\alpha_{d+1} \\geq 0$，所以 $\\alpha_{d+1}$ 确实是一个非负整数。原始不等式现在可以重写为等式：\n$$ \\alpha_{1} + \\alpha_{2} + \\ldots + \\alpha_{d} + \\alpha_{d+1} = p $$\n不等式的解集 $(\\alpha_1, \\ldots, \\alpha_d)$ 与该等式的解集 $(\\alpha_1, \\ldots, \\alpha_d, \\alpha_{d+1})$ 之间存在一一对应关系。因此，计算不等式的解的数量等价于计算这个新的、包含 $d+1$ 个变量的等式的非负整数解的数量。\n\n这是一个经典的组合问题，称为“隔板法”问题。我们要求的是将整数 $p$ 写成 $d+1$ 个非负整数之和的方法数。这等价于将 $p$ 个相同的物品（“星号”）分配到 $d+1$ 个不同的箱子（变量 $\\alpha_1, \\ldots, \\alpha_{d+1}$）中。\n\n为了将其形象化，想象一个由 $p$ 个星号（$*$）和 $d$ 个隔板（$|$）组成的序列。隔板作为分隔符，将星号分成 $d+1$ 组。例如，对于 $p=6$ 和 $d+1=4$ 的情况，序列 $* * | * | | * * *$ 将对应于解 $\\alpha_1=2$, $\\alpha_2=1$, $\\alpha_3=0$, $\\alpha_4=3$。\n\n序列中物体的总数是 $p$ 个星号加上 $d$ 个隔板，即 $p+d$ 个物体。因此，序列中的总位置数是 $p+d$。问题简化为从 $p+d$ 个可用位置中选择 $d$ 个位置来放置隔板的方法数。剩下的 $p$ 个位置将由星号填充。这是一个标准的组合问题，其方法数由二项式系数给出：\n$$ N = \\binom{p+d}{d} $$\n等价地，也可以从 $p+d$ 个总位置中选择 $p$ 个位置来放置星号，这会得到相同的结果：\n$$ N = \\binom{p+d}{p} $$\n这就是所求的、作为 $d$ 和 $p$ 的函数的、用于计算保留基多项式总数的封闭形式组合表达式。\n\n接下来，问题要求对 $d=15$ 和 $p=4$ 的情况计算该表达式的值。使用推导出的公式，基函数的数量为：\n$$ N = \\binom{p+d}{p} = \\binom{4+15}{4} = \\binom{19}{4} $$\n该二项式系数的值计算如下：\n$$ \\binom{19}{4} = \\frac{19!}{4!(19-4)!} = \\frac{19!}{4!15!} $$\n展开阶乘进行计算：\n$$ N = \\frac{19 \\times 18 \\times 17 \\times 16}{4 \\times 3 \\times 2 \\times 1} $$\n我们可以通过约去分子和分母中的项来简化表达式：\n$$ N = 19 \\times \\frac{18}{3 \\times 2} \\times 17 \\times \\frac{16}{4} $$\n$$ N = 19 \\times 3 \\times 17 \\times 4 $$\n进行乘法运算：\n$$ N = (19 \\times 3) \\times (17 \\times 4) = 57 \\times 68 $$\n$$ N = 3876 $$\n因此，对于一个具有 $d=15$ 个不确定性参数和总阶数截断 $p=4$ 的PCE，共有 $3876$ 个基多项式。",
            "answer": "$$\\boxed{3876}$$"
        },
        {
            "introduction": "PCE 的系数由投影积分定义，而这些积分通常需要通过数值方法进行评估。这个动手编程问题将要求您实现一个自适应求积算法，这是一种高效且稳健的方法，它能够智能地将计算资源集中在被积函数最复杂的区域，从而精确计算这些积分 。",
            "id": "4252630",
            "problem": "考虑一个核反应堆模拟中的不确定性量化任务，其中有效增殖因子 $k_{\\mathrm{eff}}$ 取决于不确定输入 $\\mathbf{X}$。这些输入被建模为在 $[-1,1]$ 上均匀分布的独立随机变量。设概率密度为 $\\rho(\\mathbf{x}) = \\left(\\frac{1}{2}\\right)^d$ on $[-1,1]^d$，其中 $d \\in \\{1,2\\}$。目标是计算多项式混沌 (PC) 展开中的谱系数，其中基函数是标准正交的勒让德多项式。具体来说，将一维标准正交勒让德基函数 $\\phi_n(x)$ 定义为 $\\phi_n(x) = \\sqrt{\\frac{2n+1}{2}}\\,P_n(x)$，其中 $P_n(x)$ 是第 $n$ 阶勒让德多项式，并通过张量积 $\\Psi_{\\alpha}(\\mathbf{x}) = \\prod_{i=1}^{d} \\phi_{\\alpha_i}(x_i)$ 将其扩展到多维，其中多重索引 $\\alpha \\in \\mathbb{N}_0^d$。谱系数是积分\n$$\nI_{\\alpha} = \\int_{[-1,1]^d} k_{\\mathrm{eff}}(\\mathbf{x})\\,\\Psi_{\\alpha}(\\mathbf{x})\\,\\rho(\\mathbf{x})\\,\\mathrm{d}\\mathbf{x}.\n$$\n下文任何三角函数中的角度都必须以弧度为单位解释。\n\n在维度 $d = 1$ 时，使用\n$$\nk_{\\mathrm{eff}}(x) = 1.01 + 0.12\\,x + 0.18\\,\\exp\\!\\left(-7\\,(x - 0.2)^2\\right) + 0.04\\,\\sin(7\\,x).\n$$\n在维度 $d = 2$ 时，使用\n$$\nk_{\\mathrm{eff}}(x,y) = 1.02 + 0.09\\,x - 0.06\\,y + 0.14\\,\\exp\\!\\left(-5\\,\\left[(x - 0.25)^2 + (y + 0.35)^2\\right]\\right) + 0.05\\,\\sin(4\\,x + 3\\,y) + 0.03\\,\\sin(6\\,x\\,y).\n$$\n\n设计并实现一种自适应求积方案，该方案针对被积函数 $k_{\\mathrm{eff}}(\\mathbf{X})\\Psi_{\\alpha}(\\mathbf{X})$ 中变化剧烈的区域，并通过后验指标估计误差。该方案必须满足以下所有要求：\n\n- 将域 $[-1,1]^d$ 表示为轴对齐超矩形（单元）的层次化分区。从覆盖整个域的单个根单元开始。\n- 在每个单元上，使用两个嵌入式张量积高斯-勒让德求积法来近似 $k_{\\mathrm{eff}}(\\mathbf{x})\\,\\Psi_{\\alpha}(\\mathbf{x})\\,\\rho(\\mathbf{x})$ 的局部积分。这两个求积法在参考区间 $[-1,1]$ 上每个维度分别使用 $n_{\\text{low}}$ 和 $n_{\\text{high}}$ 个点，并仿射映射到该单元。设仿射映射的雅可比行列式为 $J = \\prod_{i=1}^{d} \\frac{b_i - a_i}{2}$，其中单元边界为 $[a_i,b_i]$。\n- 使用每个单元上两种近似值的差 $\\eta_{\\text{cell}} = \\left|I_{\\text{high,cell}} - I_{\\text{low,cell}}\\right|$ 作为后验误差指标。令全局积分近似为所有单元上精细近似值的总和，$I_{\\text{global}} = \\sum_{\\text{cells}} I_{\\text{high,cell}}$，全局误差指标为所有单元指标的总和，$\\eta_{\\text{global}} = \\sum_{\\text{cells}} \\eta_{\\text{cell}}$。\n- 通过重复选择误差指标最大的单元并沿其最长边进行二等分（即，在其中点处分割区间 $[a_j,b_j]$，其中 $j = \\arg\\max_i (b_i - a_i)$）来进行自适应加密。用其两个子单元替换父单元，并相应地更新 $I_{\\text{global}}$ 和 $\\eta_{\\text{global}}$。\n- 当 $\\eta_{\\text{global}} \\leq \\varepsilon$（容差）或达到最大单元数 $N_{\\max}$ 时终止。报告是否满足容差。\n\n您的程序必须使用上述自适应方案为以下测试套件计算 $I_{\\alpha}$。在每种情况下，$n_{\\text{low}}$ 和 $n_{\\text{high}}$ 是嵌入式求积对每个维度的高斯-勒让德节点数，$\\varepsilon$ 是绝对容差，$N_{\\max}$ 是最大单元数。\n\n- 测试 1：$d = 1$, $\\alpha = (0)$, $n_{\\text{low}} = 3$, $n_{\\text{high}} = 7$, $\\varepsilon = 10^{-9}$, $N_{\\max} = 200$。\n- 测试 2：$d = 1$, $\\alpha = (4)$, $n_{\\text{low}} = 3$, $n_{\\text{high}} = 9$, $\\varepsilon = 10^{-8}$, $N_{\\max} = 200$。\n- 测试 3：$d = 2$, $\\alpha = (0,0)$, $n_{\\text{low}} = 3$, $n_{\\text{high}} = 7$, $\\varepsilon = 10^{-7}$, $N_{\\max} = 300$。\n- 测试 4：$d = 2$, $\\alpha = (2,3)$, $n_{\\text{low}} = 3$, $n_{\\text{high}} = 9$, $\\varepsilon = 10^{-7}$, $N_{\\max} = 300$。\n- 测试 5（边界条件）：$d = 2$, $\\alpha = (0,0)$, $n_{\\text{low}} = 3$, $n_{\\text{high}} = 9$, $\\varepsilon = 10^{-12}$, $N_{\\max} = 100$。\n\n最终输出格式必须是单行，包含一个列表的列表，每个测试用例对应一个子列表。每个子列表包含三个条目：全局积分近似值 $I_{\\text{global}}$（浮点数）、全局误差指标 $\\eta_{\\text{global}}$（浮点数）以及一个布尔值，指示是否达到容差。例如，\n$[\\,[I_1,\\eta_1,\\text{True}],\\,[I_2,\\eta_2,\\text{False}],\\,\\dots]$。\n\n无需用户输入。此问题中没有物理单位；所有量均为无量纲。所有角度均以弧度为单位。您的程序应生成此单行作为其唯一输出。",
            "solution": "任务是计算 $k_{\\mathrm{eff}}(\\mathbf{X})$ 关于标准正交勒让德基函数的多项式混沌 (PC) 展开的谱系数 $I_{\\alpha}$。PC 展开是基于与输入分布相关的正交多项式构建的随机量的谱表示。其基本基础包括期望、正交性和张量积积分的定义。\n\n从第一性原理出发，谱系数是关于 $\\mathbf{X}$ 联合分布的期望，\n$$\nI_{\\alpha} = \\mathbb{E}\\left[k_{\\mathrm{eff}}(\\mathbf{X})\\,\\Psi_{\\alpha}(\\mathbf{X})\\right]\n= \\int_{[-1,1]^d} k_{\\mathrm{eff}}(\\mathbf{x})\\,\\Psi_{\\alpha}(\\mathbf{x})\\,\\rho(\\mathbf{x})\\,\\mathrm{d}\\mathbf{x},\n$$\n其中 $\\rho(\\mathbf{x}) = \\left(\\frac{1}{2}\\right)^d$ 是独立均匀输入的概率密度，且基函数是标准正交的，即对于一维情况，\n$$\n\\int_{-1}^1 \\phi_m(x)\\,\\phi_n(x)\\,\\left(\\frac{1}{2}\\right)\\,\\mathrm{d}x = \\delta_{mn}.\n$$\n在更高维度上，标准正交性通过张量积扩展，\n$$\n\\int_{[-1,1]^d} \\Psi_{\\alpha}(\\mathbf{x})\\,\\Psi_{\\beta}(\\mathbf{x})\\,\\rho(\\mathbf{x})\\,\\mathrm{d}\\mathbf{x} = \\delta_{\\alpha\\beta}.\n$$\n对于均匀测度，合适的标准正交多项式是缩放后的勒让德多项式：\n$$\n\\phi_n(x) = \\sqrt{\\frac{2n+1}{2}}\\,P_n(x),\n\\quad\n\\Psi_{\\alpha}(\\mathbf{x}) = \\prod_{i=1}^d \\sqrt{\\frac{2\\alpha_i+1}{2}}\\,P_{\\alpha_i}(x_i).\n$$\n\n由于对于给定的 $k_{\\mathrm{eff}}$，无法获得 $I_{\\alpha}$ 的闭式解，我们转向数值求积。为了在被积函数复杂性不同的区域高效地确保准确性，我们采用自适应求积。核心设计要素依赖于：\n\n- 映射与张量积求积：任何超矩形（单元）$[a_1,b_1]\\times\\cdots\\times[a_d,b_d] \\subseteq [-1,1]^d$ 都可以通过仿射映射从参考域 $[-1,1]^d$ 映射而来\n$$\nx_i = \\frac{a_i + b_i}{2} + \\frac{b_i - a_i}{2}\\,\\hat{x}_i,\n\\quad \\text{其雅可比行列式为 } J = \\prod_{i=1}^d \\frac{b_i - a_i}{2}.\n$$\n在参考坐标 $\\hat{\\mathbf{x}}$ 上使用 $n$ 阶张量积高斯-勒让德求积，我们将单元积分近似为\n$$\nI_{\\text{cell}}^{(n)} \\approx \\sum_{q_1=1}^n \\cdots \\sum_{q_d=1}^n\n\\left[ k_{\\mathrm{eff}}(\\mathbf{x}(\\hat{\\mathbf{x}}))\\,\\Psi_{\\alpha}(\\mathbf{x}(\\hat{\\mathbf{x}}))\\,\\rho(\\mathbf{x}(\\hat{\\mathbf{x}})) \\right]\n\\left( \\prod_{i=1}^d w_{q_i}^{(n)} \\right) J,\n$$\n其中 $w_{q_i}^{(n)}$ 是一维高斯-勒让德权重。\n\n- 用于后验误差的嵌入式求积：使用两个嵌套的求积阶数 $n_{\\text{low}}$ 和 $n_{\\text{high}}$，在同一单元上获得两个近似值。其绝对差\n$$\n\\eta_{\\text{cell}} = \\left| I_{\\text{cell}}^{(n_{\\text{high}})} - I_{\\text{cell}}^{(n_{\\text{low}})} \\right|\n$$\n可作为后验误差指标。该指标在实践中是稳健的，因为对于足够光滑的被积函数，高阶高斯-勒让德求积能提供更优的近似，而与低阶规则的差值可以估计局部求积误差。\n\n- 自适应加密准则：为了针对被积函数 $k_{\\mathrm{eff}}(\\mathbf{x})\\,\\Psi_{\\alpha}(\\mathbf{x})$ 中变化剧烈的区域，重复加密误差最大的单元。最简单有效的策略是沿单元的最长边进行二等分。这会优先提高空间尺度最大且误差最高的区域的分辨率，从而高效地捕捉梯度或局部特征（凸起和振荡）。\n\n算法步骤：\n1. 初始化一个覆盖 $[-1,1]^d$ 的单个单元。\n2. 在当前单元集上计算 $I_{\\text{cell}}^{(n_{\\text{low}})}$, $I_{\\text{cell}}^{(n_{\\text{high}})}$ 和 $\\eta_{\\text{cell}}$。\n3. 汇总 $I_{\\text{global}} = \\sum I_{\\text{cell}}^{(n_{\\text{high}})}$ 和 $\\eta_{\\text{global}} = \\sum \\eta_{\\text{cell}}$。\n4. 如果 $\\eta_{\\text{global}} \\leq \\varepsilon$，则停止并报告收敛。否则，找出 $\\eta_{\\text{cell}}$ 最大的单元，沿最长维度将其二等分，并用两个子单元替换它。\n5. 在新的子单元上重新计算局部积分，更新 $I_{\\text{global}}$ 和 $\\eta_{\\text{global}}$，并迭代直到满足停止准则或达到最大单元数限制 $N_{\\max}$。\n\n正确性论证：\n- 在均匀分布和标准正交 PC 基下，期望积分是良定义的。对于光滑的被积函数，随着阶数的增加，张量积高斯-勒让德求积会收敛。由于高阶规则的准确性更高，嵌入式对提供了一个一致的局部误差指标，反映了被积函数在每个单元内的变化。\n- 自适应分区将计算精力集中在 $\\eta_{\\text{cell}}$ 较大的单元上，这些单元对应于 $k_{\\mathrm{eff}}(\\mathbf{x})\\,\\Psi_{\\alpha}(\\mathbf{x})$ 变化显著的区域，例如靠近局部指数函数或正弦项引起的振荡区域。沿最长边二等分是一种有效的启发式方法，它平衡了跨维度的加密，并与各向异性特征对齐。\n- 将所有单元的精细求积贡献相加可近似全局积分；将局部指标相加可提供一个类似保守边界的总求积误差指标。虽然这个总和不是严格的数学界限，但它是自适应积分中一个标准且实用的后验度量。\n\n实现细节：\n- 通过标准的勒让德多项式求值来使用函数 $P_n(x)$，并计算 $\\phi_n(x) = \\sqrt{\\frac{2n+1}{2}}\\,P_n(x)$。\n- 对于 $d = 1$，$\\Psi_{\\alpha}(x) = \\phi_{\\alpha_1}(x)$；对于 $d = 2$，$\\Psi_{\\alpha}(x,y) = \\phi_{\\alpha_1}(x)\\,\\phi_{\\alpha_2}(y)$。\n- 将密度 $\\rho(\\mathbf{x}) = \\left(\\frac{1}{2}\\right)^d$ 直接包含在被积函数中。\n- 使用高斯-勒让德规则构建张量积求积节点和权重，映射到每个单元，并计算局部积分。\n\n该程序评估五个指定的测试用例，并输出一行包含 $[I_{\\text{global}}, \\eta_{\\text{global}}, \\text{converged}]$ 三元组列表的结果，每个测试用例对应一个三元组，以确保可复现性并覆盖正常和边界行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Orthonormal Legendre basis: phi_n(x) = sqrt((2n+1)/2) * P_n(x)\ndef normalized_legendre(n, x):\n    # Evaluate P_n(x) using numpy.polynomial.legendre.legval with coefficients\n    coeffs = np.zeros(n + 1)\n    coeffs[n] = 1.0\n    Pn = np.polynomial.legendre.legval(x, coeffs)\n    return np.sqrt((2 * n + 1) / 2.0) * Pn\n\ndef psi_alpha_1d(alpha, x):\n    # alpha is a tuple/list of length 1\n    return normalized_legendre(alpha[0], x)\n\ndef psi_alpha_2d(alpha, x, y):\n    return normalized_legendre(alpha[0], x) * normalized_legendre(alpha[1], y)\n\n# k_eff definitions\ndef k_eff_1d(x):\n    # k_eff(x) = 1.01 + 0.12 x + 0.18 exp(-7 (x - 0.2)^2) + 0.04 sin(7 x)\n    return 1.01 + 0.12 * x + 0.18 * np.exp(-7.0 * (x - 0.2) ** 2) + 0.04 * np.sin(7.0 * x)\n\ndef k_eff_2d(x, y):\n    # k_eff(x,y) = 1.02 + 0.09 x - 0.06 y + 0.14 exp(-5[(x-0.25)^2 + (y+0.35)^2]) + 0.05 sin(4x+3y) + 0.03 sin(6xy)\n    return (\n        1.02\n        + 0.09 * x\n        - 0.06 * y\n        + 0.14 * np.exp(-5.0 * ((x - 0.25) ** 2 + (y + 0.35) ** 2))\n        + 0.05 * np.sin(4.0 * x + 3.0 * y)\n        + 0.03 * np.sin(6.0 * x * y)\n    )\n\ndef tensor_quadrature_on_cell(d, alpha, a, b, n):\n    \"\"\"\n    Compute tensor-product Gauss-Legendre quadrature of order n per dimension\n    for the integrand g(x) = k_eff(x) * Psi_alpha(x) * rho on a hyperrectangular cell with bounds a,b.\n    \"\"\"\n    # One-dimensional Gauss-Legendre nodes and weights on [-1,1]\n    nodes, weights = np.polynomial.legendre.leggauss(n)\n\n    # Precompute scaling and center for affine map\n    a = np.asarray(a, dtype=float)\n    b = np.asarray(b, dtype=float)\n    centers = (a + b) / 2.0\n    scales = (b - a) / 2.0\n    J = np.prod(scales)  # Jacobian\n\n    # Build tensor grids for nodes and weights\n    node_grids = np.meshgrid(*([nodes] * d), indexing='ij')\n    weight_grids = np.meshgrid(*([weights] * d), indexing='ij')\n    # Map to physical coordinates\n    # Each coordinate array is centers[i] + scales[i] * node_grids[i]\n    phys_coords = [centers[i] + scales[i] * node_grids[i] for i in range(d)]\n    # Product weights across dimensions\n    wprod = np.prod(np.array(weight_grids), axis=0)\n\n    rho = (0.5) ** d\n\n    if d == 1:\n        x = phys_coords[0]\n        integrand = k_eff_1d(x) * psi_alpha_1d(alpha, x) * rho\n    elif d == 2:\n        x = phys_coords[0]\n        y = phys_coords[1]\n        integrand = k_eff_2d(x, y) * psi_alpha_2d(alpha, x, y) * rho\n    else:\n        raise ValueError(\"Unsupported dimension d: {}\".format(d))\n\n    # Sum over all points\n    I = np.sum(integrand * wprod) * J\n    return I\n\ndef adaptive_integral(d, alpha, n_low, n_high, tol, max_cells):\n    \"\"\"\n    Adaptive quadrature over [-1,1]^d using embedded Gauss-Legendre tensor-product rules.\n    \"\"\"\n    # Initial single cell covering the domain\n    a0 = np.array([-1.0] * d)\n    b0 = np.array([1.0] * d)\n    I_low = tensor_quadrature_on_cell(d, alpha, a0, b0, n_low)\n    I_high = tensor_quadrature_on_cell(d, alpha, a0, b0, n_high)\n    err = abs(I_high - I_low)\n    cells = [{\n        'a': a0,\n        'b': b0,\n        'I_low': I_low,\n        'I_high': I_high,\n        'err': err\n    }]\n\n    I_global = I_high\n    eta_global = err\n\n    converged = eta_global = tol\n    # Adaptive loop\n    while (not converged) and (len(cells)  max_cells):\n        # Select cell with maximum error\n        idx = int(np.argmax([c['err'] for c in cells]))\n        cell = cells[idx]\n        a = cell['a']\n        b = cell['b']\n        lengths = b - a\n        split_dim = int(np.argmax(lengths))\n        mid = 0.5 * (a[split_dim] + b[split_dim])\n\n        # Create two child cells by bisecting along split_dim\n        a_left = a.copy()\n        b_left = b.copy()\n        b_left[split_dim] = mid\n\n        a_right = a.copy()\n        b_right = b.copy()\n        a_right[split_dim] = mid\n\n        # Compute integrals on children\n        I_low_left = tensor_quadrature_on_cell(d, alpha, a_left, b_left, n_low)\n        I_high_left = tensor_quadrature_on_cell(d, alpha, a_left, b_left, n_high)\n        err_left = abs(I_high_left - I_low_left)\n\n        I_low_right = tensor_quadrature_on_cell(d, alpha, a_right, b_right, n_low)\n        I_high_right = tensor_quadrature_on_cell(d, alpha, a_right, b_right, n_high)\n        err_right = abs(I_high_right - I_low_right)\n\n        # Update global sums: remove parent, add children\n        I_global += (I_high_left + I_high_right - cell['I_high'])\n        eta_global += (err_left + err_right - cell['err'])\n\n        # Replace parent cell with children\n        cells.pop(idx)\n        cells.append({\n            'a': a_left, 'b': b_left,\n            'I_low': I_low_left, 'I_high': I_high_left, 'err': err_left\n        })\n        cells.append({\n            'a': a_right, 'b': b_right,\n            'I_low': I_low_right, 'I_high': I_high_right, 'err': err_right\n        })\n\n        converged = eta_global = tol\n\n    return I_global, eta_global, converged\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (d, alpha, n_low, n_high, tol, max_cells)\n    test_cases = [\n        (1, (0,), 3, 7, 1e-9, 200),\n        (1, (4,), 3, 9, 1e-8, 200),\n        (2, (0, 0), 3, 7, 1e-7, 300),\n        (2, (2, 3), 3, 9, 1e-7, 300),\n        (2, (0, 0), 3, 9, 1e-12, 100),\n    ]\n\n    results = []\n    for case in test_cases:\n        d, alpha, n_low, n_high, tol, max_cells = case\n        I_est, eta, conv = adaptive_integral(d, alpha, n_low, n_high, tol, max_cells)\n        results.append([I_est, eta, bool(conv)])\n\n    # Final print statement in the exact required format.\n    # Print single line: list of lists with [I_global, eta_global, converged]\n    # Use default str() representation; ensure one line.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一旦 PCE 代理模型构建完成，其真正的威力在于它所支持的后处理分析。本练习将展示如何利用 PCE 系数计算高级灵敏度指标，例如相关比 $\\eta^2$，从而提供对模型非线性依赖关系的深刻见解，这是像皮尔逊相关系数等简单线性度量无法捕捉的 。",
            "id": "4252595",
            "problem": "在一个压水反应堆堆芯模型中，由于热工水力波动，慢化剂密度 $\\,\\delta\\,$（单位为 $\\mathrm{kg/m^3}$）存在不确定性。将 $\\,\\delta\\,$ 视为一个高斯随机变量，服从 $\\,\\delta \\sim \\mathcal{N}(\\delta_0,\\sigma_{\\delta}^2)\\,$，其中 $\\,\\delta_0 = 700\\,$ 且 $\\,\\sigma_{\\delta} = 7\\,.$。定义标准化变量 $\\,\\xi = (\\delta - \\delta_0)/\\sigma_{\\delta}\\,$，因此 $\\,\\xi \\sim \\mathcal{N}(0,1)\\,.$。反应堆反应性 $\\,\\rho\\,$ 由一个三阶多项式混沌展开（PCE）近似，其中多项式混沌展开（PCE）指的是一个随机过程的正交多项式表示，使用概率论中的 Hermite 多项式（相对于标准正态测度）：\n$$\n\\rho(\\xi) = a_0 + a_1 \\,\\xi + a_2 \\,(\\xi^2 - 1) + a_3 \\,(\\xi^3 - 3\\,\\xi) + \\varepsilon,\n$$\n其中 $\\,\\varepsilon\\,$ 是一个独立的随机项，代表未解析的建模和输入不确定性，满足 $\\,\\mathbb{E}[\\varepsilon]=0\\,$ 和 $\\,\\mathrm{Var}(\\varepsilon)=\\sigma_{\\varepsilon}^2\\,$.。这些系数是通过耦合中子输运和热工水力模拟的高保真度随机抽样估计得出的，其值为：\n$$\na_0 = 5.0 \\times 10^{-3}, \\quad a_1 = 2.0 \\times 10^{-3}, \\quad a_2 = 3.0 \\times 10^{-3}, \\quad a_3 = 1.0 \\times 10^{-3}, \\quad \\sigma_{\\varepsilon}^2 = 1.2 \\times 10^{-5}.\n$$\n\n从相关比 $\\,\\eta^2(\\rho \\mid \\delta) = \\dfrac{\\mathrm{Var}\\!\\left(\\mathbb{E}[\\rho \\mid \\delta]\\right)}{\\mathrm{Var}(\\rho)}\\,$ 的定义和全方差定律出发，推导一个用展开系数 $\\,a_1, a_2, a_3\\,$ 和 $\\,\\sigma_{\\varepsilon}^2\\,$ 表示的 $\\,\\eta^2(\\rho \\mid \\delta)\\,$ 的闭式表达式，然后用给定值进行数值计算。最后，用文字并利用推导出的表达式解释，当 $\\,\\rho\\,$ 和 $\\,\\delta\\,$ 之间的关系为非线性时，为什么 $\\,\\eta^2\\,$ 不同于皮尔逊相关系数。\n\n将 $\\,\\eta^2\\,$ 的最终值表示为一个无单位的纯数，并四舍五入到四位有效数字。",
            "solution": "该问题是有效的，因为它科学地基于概率论和不确定性量化（多项式混沌展开，全方差定律）的既定原则，问题设定良好，有足够的信息得到唯一解，并以客观、精确的语言表达。\n\n目标是推导和评估相关比 $\\eta^2(\\rho \\mid \\delta)$，并解释其与皮尔逊相关系数平方的区别。相关比定义为：\n$$\n\\eta^2(\\rho \\mid \\delta) = \\frac{\\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\delta])}{\\mathrm{Var}(\\rho)}\n$$\n分析始于计算此表达式中的两个方差项。\n\n首先，我们确定分子 $\\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\delta])$。标准化随机变量 $\\xi$ 是慢化剂密度 $\\delta$ 的线性变换，由 $\\xi = (\\delta - \\delta_0)/\\sigma_{\\delta}$ 给出。因此，以 $\\delta$ 为条件等价于以 $\\xi$ 为条件。给定 $\\xi$ 时，反应性 $\\rho$ 的条件期望为：\n$$\n\\mathbb{E}[\\rho \\mid \\xi] = \\mathbb{E}\\left[ a_0 + a_1 \\xi + a_2 (\\xi^2 - 1) + a_3 (\\xi^3 - 3\\xi) + \\varepsilon \\mid \\xi \\right]\n$$\n给定 $\\xi$，所有涉及 $\\xi$ 的项都是确定性的。项 $\\varepsilon$ 被定义为一个独立的随机变量，且 $\\mathbb{E}[\\varepsilon] = 0$。它与 $\\xi$ 的独立性意味着 $\\mathbb{E}[\\varepsilon \\mid \\xi] = \\mathbb{E}[\\varepsilon] = 0$。因此，条件期望简化为模型的多项式混沌展开（PCE）部分：\n$$\n\\mathbb{E}[\\rho \\mid \\xi] = a_0 + a_1 \\xi + a_2 (\\xi^2 - 1) + a_3 (\\xi^3 - 3\\xi)\n$$\n展开式中的多项式 $H_0(\\xi)=1$、$H_1(\\xi)=\\xi$、$H_2(\\xi)=\\xi^2 - 1$ 和 $H_3(\\xi)=\\xi^3 - 3\\xi$ 是概率论中的 Hermite 多项式。这些多项式的一个基本性质是它们关于标准正态概率测度（即 $\\xi \\sim \\mathcal{N}(0,1)$ 的分布）的正交性：\n$$\n\\mathbb{E}[H_i(\\xi) H_j(\\xi)] = \\int_{-\\infty}^{\\infty} H_i(x)H_j(x) \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2}\\right) dx = \\delta_{ij} i!\n$$\n其中 $\\delta_{ij}$ 是克罗内克 delta 符号。\n\n为了求 $\\mathbb{E}[\\rho \\mid \\xi]$ 的方差，我们首先求其均值：\n$$\n\\mathbb{E}\\left[\\mathbb{E}[\\rho \\mid \\xi]\\right] = \\mathbb{E}[a_0 H_0(\\xi) + a_1 H_1(\\xi) + a_2 H_2(\\xi) + a_3 H_3(\\xi)] = a_0 \\mathbb{E}[H_0] + a_1 \\mathbb{E}[H_1] + \\dots\n$$\n根据正交性，对于 $i  0$ 有 $\\mathbb{E}[H_i] = \\mathbb{E}[H_i H_0] = 0$，而 $\\mathbb{E}[H_0] = 1$。因此，$\\mathbb{E}[\\mathbb{E}[\\rho \\mid \\xi]] = a_0$。于是方差为：\n$$\n\\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\xi]) = \\mathbb{E}\\left[ (\\mathbb{E}[\\rho \\mid \\xi] - a_0)^2 \\right] = \\mathbb{E}\\left[ (a_1 H_1(\\xi) + a_2 H_2(\\xi) + a_3 H_3(\\xi))^2 \\right]\n$$\n展开平方并应用期望算子，交叉乘积项因正交性而消失，剩下：\n$$\n\\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\xi]) = a_1^2 \\mathbb{E}[H_1^2] + a_2^2 \\mathbb{E}[H_2^2] + a_3^2 \\mathbb{E}[H_3^2]\n$$\n使用 $\\mathbb{E}[H_i^2] = i!$，我们得到相关比的分子：\n$$\n\\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\delta]) = a_1^2 (1!) + a_2^2 (2!) + a_3^2 (3!) = a_1^2 + 2a_2^2 + 6a_3^2\n$$\n接下来，我们确定分母 $\\mathrm{Var}(\\rho)$。这是反应性的总方差。我们使用全方差定律：\n$$\n\\mathrm{Var}(\\rho) = \\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\delta]) + \\mathbb{E}[\\mathrm{Var}(\\rho \\mid \\delta)]\n$$\n我们已经计算了第一项。第二项是条件方差的期望。条件方差为：\n$$\n\\mathrm{Var}(\\rho \\mid \\xi) = \\mathrm{Var}\\left( a_0 + a_1 \\xi + a_2 (\\xi^2 - 1) + a_3 (\\xi^3 - 3\\xi) + \\varepsilon \\mid \\xi \\right)\n$$\n给定 $\\xi$，整个 PCE 部分是一个常数。常数的方差为零，而一个和式与一个独立变量相加的方差就是该变量的方差。\n$$\n\\mathrm{Var}(\\rho \\mid \\xi) = \\mathrm{Var}(\\varepsilon \\mid \\xi)\n$$\n由于 $\\varepsilon$ 与 $\\xi$ 相互独立，$\\mathrm{Var}(\\varepsilon \\mid \\xi) = \\mathrm{Var}(\\varepsilon) = \\sigma_{\\varepsilon}^2$。因此，$\\mathbb{E}[\\mathrm{Var}(\\rho \\mid \\delta)] = \\mathbb{E}[\\sigma_{\\varepsilon}^2] = \\sigma_{\\varepsilon}^2$。总方差是条件期望的方差与条件方差的均值之和：\n$$\n\\mathrm{Var}(\\rho) = (a_1^2 + 2a_2^2 + 6a_3^2) + \\sigma_{\\varepsilon}^2\n$$\n相关比的闭式表达式是这两个结果的比值：\n$$\n\\eta^2(\\rho \\mid \\delta) = \\frac{a_1^2 + 2a_2^2 + 6a_3^2}{a_1^2 + 2a_2^2 + 6a_3^2 + \\sigma_{\\varepsilon}^2}\n$$\n现在，我们使用给定值对该表达式进行数值计算：$a_1 = 2.0 \\times 10^{-3}$，$a_2 = 3.0 \\times 10^{-3}$，$a_3 = 1.0 \\times 10^{-3}$，以及 $\\sigma_{\\varepsilon}^2 = 1.2 \\times 10^{-5}$。分子是：\n$$\n\\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\delta]) = (2.0 \\times 10^{-3})^2 + 2(3.0 \\times 10^{-3})^2 + 6(1.0 \\times 10^{-3})^2 \\\\\n= 4.0 \\times 10^{-6} + 2(9.0 \\times 10^{-6}) + 6(1.0 \\times 10^{-6}) \\\\\n= (4.0 + 18.0 + 6.0) \\times 10^{-6} = 28.0 \\times 10^{-6} = 2.8 \\times 10^{-5}\n$$\n分母是：\n$$\n\\mathrm{Var}(\\rho) = (2.8 \\times 10^{-5}) + (1.2 \\times 10^{-5}) = 4.0 \\times 10^{-5}\n$$\n相关比的数值为：\n$$\n\\eta^2(\\rho \\mid \\delta) = \\frac{2.8 \\times 10^{-5}}{4.0 \\times 10^{-5}} = \\frac{2.8}{4.0} = 0.7\n$$\n四舍五入到四位有效数字得到 $0.7000$。\n\n最后，我们解释为什么 $\\eta^2$ 与皮尔逊相关系数的平方 $R^2$ 不同。$\\rho$ 和 $\\delta$（或等价地，$\\xi$）之间的皮尔逊相关系数定义为 $R(\\rho, \\xi) = \\frac{\\mathrm{Cov}(\\rho, \\xi)}{\\sqrt{\\mathrm{Var}(\\rho)\\mathrm{Var}(\\xi)}}$。其平方系数为：\n$$\nR^2(\\rho, \\xi) = \\frac{[\\mathrm{Cov}(\\rho, \\xi)]^2}{\\mathrm{Var}(\\rho)\\mathrm{Var}(\\xi)}\n$$\n我们已知 $\\mathrm{Var}(\\rho)$ 和 $\\mathrm{Var}(\\xi) = 1$。协方差项是：\n$$\n\\mathrm{Cov}(\\rho, \\xi) = \\mathbb{E}[(\\rho - \\mathbb{E}[\\rho])(\\xi - \\mathbb{E}[\\xi])] = \\mathbb{E}[(\\rho - a_0)\\xi]\n$$\n将 $\\rho-a_0$ 的 PCE 代入并使用 $\\xi = H_1(\\xi)$：\n$$\n\\mathrm{Cov}(\\rho, \\xi) = \\mathbb{E}[(a_1 H_1 + a_2 H_2 + a_3 H_3 + \\varepsilon) H_1] = a_1 \\mathbb{E}[H_1^2] = a_1\n$$\n由于正交性和独立性，其他项消失。因此，皮尔逊系数的平方为：\n$$\nR^2(\\rho, \\delta) = \\frac{a_1^2}{a_1^2 + 2a_2^2 + 6a_3^2 + \\sigma_{\\varepsilon}^2}\n$$\n比较 $\\eta^2$ 和 $R^2$ 的表达式：\n$$\n\\eta^2 = \\frac{a_1^2 + 2a_2^2 + 6a_3^2}{\\mathrm{Var}(\\rho)} \\quad \\text{和} \\quad R^2 = \\frac{a_1^2}{\\mathrm{Var}(\\rho)}\n$$\n皮尔逊相关系数，根据其构造，只量化了两个变量之间*线性*关系的强度。其分子 $[\\mathrm{Cov}(\\rho, \\xi)]^2 = a_1^2$ 代表了 $\\rho$ 中可归因于相对于 $\\xi$ 的最佳线性拟合的那部分方差，这对应于线性项 $a_1 \\xi$ 的方差。\n相比之下，相关比 $\\eta^2$ 衡量的是 $\\rho$ 的方差中可以由与 $\\delta$（或 $\\xi$）的*任何*函数关系解释的比例，这由条件期望 $\\mathbb{E}[\\rho \\mid \\delta]$ 捕获。其分子 $\\mathrm{Var}(\\mathbb{E}[\\rho \\mid \\delta]) = a_1^2 + 2a_2^2 + 6a_3^2$ 解释了 $\\rho$ 的 PCE 模型中所有依赖于 $\\delta$ 的项所贡献的方差——线性的 ($a_1^2$)、二次的 ($2a_2^2$) 和三次的 ($6a_3^2$)。\n由于 $\\rho$ 和 $\\delta$ 之间的关系是非线性的（由非零系数 $a_2$ 和 $a_3$ 表明），相关比捕获了这些非线性依赖关系的解释能力，而皮尔逊系数则不能。这就是为什么在这个问题中 $\\eta^2  R^2$。如果关系是纯线性的（$a_2=0, a_3=0$），则分子将相同，$\\eta^2$ 将等于 $R^2$。",
            "answer": "$$\\boxed{0.7000}$$"
        }
    ]
}