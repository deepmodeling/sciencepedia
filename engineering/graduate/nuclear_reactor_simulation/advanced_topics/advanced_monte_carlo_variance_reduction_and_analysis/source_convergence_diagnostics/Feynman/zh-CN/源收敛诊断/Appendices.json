{
    "hands_on_practices": [
        {
            "introduction": "本练习提供了一个具体的低维模型，用以探索源迭代的核心原理。通过分析一个简单的双区反应堆，您将计算权重窗等偏倚技术如何改变裂变算子的特征值，并直接影响由优势比量化的收敛速率。此实践旨在巩固输运算子的抽象线性代数与模拟中实际收敛速度之间的联系。",
            "id": "4250530",
            "problem": "考虑一个用于源收敛诊断 (SCD) 的蒙特卡洛中子输运 (MCNT) $k$-特征值计算中的临界板式反应堆的两区域模型。设区域 $A$ 和 $B$ 上的裂变源分布在第 $n$ 次迭代（代）时由列向量 $s_n \\in \\mathbb{R}^2_{\\ge 0}$ 表示，并设在没有任何偏差的情况下，平均线性裂变源映射由非负矩阵 $\\mathbf{M}_0 \\in \\mathbb{R}^{2 \\times 2}$ 表示，\n$$\n\\mathbf{M}_0 = \\begin{pmatrix}\n0.6  0.2 \\\\\n0.4  0.8\n\\end{pmatrix}.\n$$\n假设系统在无偏抽样和粒子数管理下是临界的，并且在代与代之间应用了将源归一化到单位总权重的操作。\n\n现在，假设一个错误指定的权重函数与权重窗 (WW) 粒子数控制结合使用，这与轮盘赌 (RR) 和粒子分裂一起，在每个区域对裂变源的期望贡献中引入了系统性偏差：落在 $A$ 区的贡献按因子 $b_A = 1.10$ 缩放，而落在 $B$ 区的贡献按因子 $b_B = 0.95$ 缩放。将此建模为应用于该映射的对角缩放 $\\mathbf{B} = \\mathrm{diag}(b_A,b_B)$，得到有偏平均算子\n$$\n\\mathbf{M}_b = \\mathbf{B}\\mathbf{M}_0.\n$$\n假设初始源 $s_0$ 分解为 $\\mathbf{M}_b$ 的主右特征向量 $v_1$ 和次主右特征向量 $v_2$ 的线性组合，即 $s_0 = c_1 v_1 + \\varepsilon v_2$，其中与 SCD 相关的次主模幅度为 $\\varepsilon = 0.3$。SCD 阈值要求在 $n$ 代之后，次主模幅度至多为 $\\delta = 1.0 \\times 10^{-5}$。\n\n使用非负矩阵线性算子迭代的基本原理和给定的建模假设，确定在有偏算子 $\\mathbf{M}_b$ 下，为使次主模幅度降至阈值 $\\delta$ 以下所需的最少源迭代整数次数 $n_{\\min}$。以单个整数形式提供 $n_{\\min}$。无需四舍五入到指定数量的有效数字；报告确切的最小整数。",
            "solution": "## 问题验证\n\n### 步骤 1：提取已知条件\n问题提供了以下数据和定义：\n- 无偏裂变源映射矩阵：\n$$\n\\mathbf{M}_0 = \\begin{pmatrix}\n0.6  0.2 \\\\\n0.4  0.8\n\\end{pmatrix}\n$$\n- 系统在无偏抽样下是临界的，意味着 $\\mathbf{M}_0$ 的主特征值为 $1$。\n- 通过对角缩放矩阵 $\\mathbf{B} = \\mathrm{diag}(b_A, b_B)$ 引入了偏差，其中缩放因子为 $b_A = 1.10$ 和 $b_B = 0.95$。\n- 有偏平均算子由 $\\mathbf{M}_b = \\mathbf{B}\\mathbf{M}_0$ 给出。\n- 初始源分布 $s_0$ 分解为 $\\mathbf{M}_b$ 的特征向量，表示为 $s_0 = c_1 v_1 + \\varepsilon v_2$，其中 $v_1$ 是主特征向量，$v_2$ 是次主特征向量。\n- 次主模的初始幅度为 $\\varepsilon = 0.3$。\n- 次主模幅度的收敛阈值为 $\\delta = 1.0 \\times 10^{-5}$。\n- 目标是找到使次主模幅度降至 $\\delta$ 以下所需的最小源迭代整数次数 $n_{\\min}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估：\n- **科学依据：** 该问题使用了一个成熟的线性代数模型（对裂变矩阵进行幂迭代）来分析蒙特卡洛模拟中的源收敛，这是核反应堆物理学中的一个标准课题。使用矩阵表示离散区域间的中子输运、由权重窗等方差减小技术引入偏差的概念，以及通过优势比分析收敛速度，都是该领域中基本且科学正确的原理。给定的矩阵 $\\mathbf{M}_0$ 是非负的，符合裂变算子的要求，其主特征值确实为 1，与系统“临界”的陈述一致。\n- **良态的：** 该问题在数学上是良定义的。它要求计算一个量衰减到阈值以下所需的最小迭代次数，这是数值分析中的一个标准问题，并且有唯一解。所有必要的参数（$\\mathbf{M}_0$、$\\mathbf{B}$、$\\varepsilon$、$\\delta$）都已提供。\n- **客观性：** 该问题以精确、定量和无偏的语言陈述，使用了核工程和线性代数的标准术语。没有主观或模糊的陈述。\n\n### 步骤 3：结论与行动\n该问题是有效的。它具有科学性、良态性和客观性。将制定解决方案。\n\n## 解法\n\n该问题描述了用于寻找有偏裂变算子 $\\mathbf{M}_b$ 主特征向量的幂迭代过程。第 $n$ 次迭代时的源向量 $s_n$ 是通过将算子 $\\mathbf{M}_b$ 应用于前一个源向量 $s_{n-1}$ 并将结果归一化得到的。初始源向量 $s_0$ 被给出为 $\\mathbf{M}_b$ 的主特征向量 $v_1$ 和次主特征向量 $v_2$ 的线性组合：\n$$\ns_0 = c_1 v_1 + \\varepsilon v_2\n$$\n其中 $\\mathbf{M}_b v_1 = \\lambda_1 v_1$ 且 $\\mathbf{M}_b v_2 = \\lambda_2 v_2$，且 $|\\lambda_1| > |\\lambda_2|$。矩阵 $\\mathbf{M}_b$ 将是一个正矩阵，因此根据佩龙-弗罗贝尼乌斯定理，$\\lambda_1$ 是实数、正数，并且其量值严格大于任何其他特征值。\n\n经过一次迭代后，在归一化之前，源向量变为：\n$$\ns'_1 = \\mathbf{M}_b s_0 = \\mathbf{M}_b (c_1 v_1 + \\varepsilon v_2) = c_1 \\lambda_1 v_1 + \\varepsilon \\lambda_2 v_2\n$$\n经过 $n$ 次迭代后，未归一化的源向量是：\n$$\ns'_n = \\mathbf{M}_b^n s_0 = c_1 \\lambda_1^n v_1 + \\varepsilon \\lambda_2^n v_2\n$$\n源向量 $s_n$ 在每一步都被归一化，但特征向量的相对幅度不受此标量归一化的影响。我们可以通过提出主特征值项来分析次主模的衰减：\n$$\ns'_n = \\lambda_1^n \\left( c_1 v_1 + \\varepsilon \\left(\\frac{\\lambda_2}{\\lambda_1}\\right)^n v_2 \\right)\n$$\n经过 $n$ 次迭代后，次主模的幅度（表示为 $\\varepsilon_n$）是初始幅度乘以优势比 $\\rho = |\\lambda_2 / \\lambda_1|$ 的 $n$ 次方。\n$$\n\\varepsilon_n = \\varepsilon \\rho^n = \\varepsilon \\left| \\frac{\\lambda_2}{\\lambda_1} \\right|^n\n$$\n我们需要找到最小整数 $n$，使得 $\\varepsilon_n \\le \\delta$。这导致不等式：\n$$\n\\varepsilon \\left| \\frac{\\lambda_2}{\\lambda_1} \\right|^n \\le \\delta\n$$\n首先，我们计算有偏算子 $\\mathbf{M}_b$：\n$$\n\\mathbf{M}_b = \\mathbf{B}\\mathbf{M}_0 = \\begin{pmatrix} 1.10  0 \\\\ 0  0.95 \\end{pmatrix} \\begin{pmatrix} 0.6  0.2 \\\\ 0.4  0.8 \\end{pmatrix} = \\begin{pmatrix} (1.10)(0.6)  (1.10)(0.2) \\\\ (0.95)(0.4)  (0.95)(0.8) \\end{pmatrix} = \\begin{pmatrix} 0.66  0.22 \\\\ 0.38  0.76 \\end{pmatrix}\n$$\n接下来，我们通过求解特征方程 $\\det(\\mathbf{M}_b - \\lambda\\mathbf{I}) = 0$ 来找到 $\\mathbf{M}_b$ 的特征值。\n$$\n\\det \\begin{pmatrix} 0.66 - \\lambda  0.22 \\\\ 0.38  0.76 - \\lambda \\end{pmatrix} = 0\n$$\n$$\n(0.66 - \\lambda)(0.76 - \\lambda) - (0.22)(0.38) = 0\n$$\n$$\n\\lambda^2 - (0.66 + 0.76)\\lambda + (0.66)(0.76) - (0.0836) = 0\n$$\n$$\n\\lambda^2 - 1.42\\lambda + 0.5016 - 0.0836 = 0\n$$\n$$\n\\lambda^2 - 1.42\\lambda + 0.418 = 0\n$$\n使用二次公式 $\\lambda = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$：\n$$\n\\lambda = \\frac{1.42 \\pm \\sqrt{(-1.42)^2 - 4(1)(0.418)}}{2} = \\frac{1.42 \\pm \\sqrt{2.0164 - 1.672}}{2} = \\frac{1.42 \\pm \\sqrt{0.3444}}{2}\n$$\n主特征值是 $\\lambda_1 = \\frac{1.42 + \\sqrt{0.3444}}{2}$，次主特征值是 $\\lambda_2 = \\frac{1.42 - \\sqrt{0.3444}}{2}$。两个特征值都是正的，所以优势比的绝对值符号可以去掉。\n$$\n\\rho = \\frac{\\lambda_2}{\\lambda_1} = \\frac{\\frac{1.42 - \\sqrt{0.3444}}{2}}{\\frac{1.42 + \\sqrt{0.3444}}{2}} = \\frac{1.42 - \\sqrt{0.3444}}{1.42 + \\sqrt{0.3444}}\n$$\n现在我们求解关于 $n$ 的不等式：\n$$\n\\varepsilon \\rho^n \\le \\delta\n$$\n$$\n\\rho^n \\le \\frac{\\delta}{\\varepsilon}\n$$\n对两边取自然对数：\n$$\nn \\ln(\\rho) \\le \\ln\\left(\\frac{\\delta}{\\varepsilon}\\right)\n$$\n由于 $\\rho < 1$，$\\ln(\\rho)$ 是负数。除以 $\\ln(\\rho)$ 会使不等号反向：\n$$\nn \\ge \\frac{\\ln(\\delta/\\varepsilon)}{\\ln(\\rho)}\n$$\n我们代入给定值 $\\varepsilon = 0.3$ 和 $\\delta = 1.0 \\times 10^{-5}$。\n$$\n\\frac{\\delta}{\\varepsilon} = \\frac{1.0 \\times 10^{-5}}{0.3} = \\frac{1}{30000}\n$$\n现在，我们计算对数的数值：\n$$\n\\ln\\left(\\frac{\\delta}{\\varepsilon}\\right) = \\ln\\left(\\frac{1}{30000}\\right) = -\\ln(30000) \\approx -10.30895\n$$\n$$\n\\rho = \\frac{1.42 - \\sqrt{0.3444}}{1.42 + \\sqrt{0.3444}} \\approx \\frac{1.42 - 0.586856}{1.42 + 0.586856} \\approx \\frac{0.833144}{2.006856} \\approx 0.415143\n$$\n注意：$\\rho$ 的一个更精确的计算结果是 $0.4151213$。为了准确性，我们使用这个值。\n$$\n\\ln(\\rho) \\approx \\ln(0.4151213) \\approx -0.87913\n$$\n将这些值代入关于 $n$ 的不等式：\n$$\nn \\ge \\frac{-10.30895}{-0.87913} \\approx 11.7263\n$$\n由于迭代次数 $n$ 必须是整数，我们对这个值取上整。\n$$\nn_{\\min} = \\lceil 11.7263 \\rceil = 12\n$$\n因此，需要至少 12 次源迭代，才能使次主模的幅度降至指定阈值以下。",
            "answer": "$$\\boxed{12}$$"
        },
        {
            "introduction": "在对优势比的理论理解基础上，本练习要求您实现一个实用的数值诊断工具。您将通过编写代码，分析源向量在迭代间的变化来估计优势比，这一技术模拟了现实世界中的源收敛检查方法。这项动手编码任务展示了如何将理论收敛率转化为一个具体的度量标准，用于诊断收敛缓慢的问题系统。",
            "id": "4250531",
            "problem": "考虑一种用于核反应堆模拟中近似基本裂变源形状的离散源迭代方法。设非负矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 表示一个作用于离散化源分布 $s \\in \\mathbb{R}^n$ 的线性化输运-裂变算子。假设 $A$ 是非负的，且初始源向量 $s_0$ 是严格为正的。在理想情况下，即 $A$ 是不可约且非周期的，根据 Perron-Frobenius 定理，源迭代会（在归一化意义下）收敛到与最大特征值关联的唯一主特征向量。在实践中，主特征结构的简并或近简并表现为收敛缓慢或非唯一的渐近行为，这必须得到可靠的诊断。\n\n您的任务是实现一个诊断程序，仅使用源迭代历史和基于范数的比较来推断 $A$ 的主特征结构的简并性或近简并性。该诊断必须基于以下步骤：\n\n- 初始化：使用一个初始源 $s_0$，其分量与索引成正比，即 $s_{0,i} \\propto i+1$ for $i = 0,1,\\dots,n-1$，并进行归一化，使其分量之和为 $1$（即使用 $\\ell_1$ 归一化）。\n- 迭代：对于 $k = 0,1,\\dots,K-1$，计算 $s_{k+1} = A s_k$，然后通过除以其 $\\ell_1$ 范数将 $s_{k+1}$ 归一化为单位 $\\ell_1$ 范数。使用 $K = 200$ 次迭代。\n- 差分：计算 $k = 0,1,\\dots,K-1$ 的 $\\ell_1$ 差分 $d_k = \\|s_{k+1} - s_k\\|_1$。\n- 尾部比率估计：对于大小为 $T = 50$ 的尾部窗口，在最后 $T$ 步中，当 $d_k$ 超过一个小阈值 $\\varepsilon = 10^{-12}$ 时，计算比率 $r_k = d_{k+1}/d_k$。如果无法计算出这样的比率（例如，尾部所有的 $d_k$ 都低于 $\\varepsilon$），则将有效尾部比率 $R$ 设置为 $1.0$；否则将 $R$ 定义为可计算的 $r_k$ 值的中位数。\n- 决策规则：如果 $R \\ge \\tau_r$，则判定存在简并或近简并，其中阈值 $\\tau_r = 0.9$。\n\n此诊断应被理解为源迭代渐近收敛率的一个代理指标，在理想情况下，该收敛率由次主特征值模与主特征值模之比决定。\n\n请实现上述诊断程序，并将其应用于以下代表不同情景的测试矩阵 $A$ 套件：\n\n1. 维度 $n=5$、参数 $\\alpha = 0.1, \\beta = 0.9$ 的一秩扰动单位矩阵：\n   $$A^{(1)} = \\alpha I + \\frac{\\beta}{n} J,$$\n   其中 $I$ 是 $n \\times n$ 单位矩阵，$J$ 是 $n \\times n$ 全一矩阵。此处 $n = 5, \\alpha = 0.1, \\beta = 0.9$。\n2. 维度 $n=5$、参数 $\\alpha = 0.95, \\beta = 0.05$ 的近简并一秩扰动单位矩阵：\n   $$A^{(2)} = \\alpha I + \\frac{\\beta}{n} J,$$\n   其中 $n = 5, \\alpha = 0.95, \\beta = 0.05$。\n3. 维度 $n=5$、参数 $\\alpha = 1.0, \\beta = 0.0$ 的精确简并单位矩阵：\n   $$A^{(3)} = \\alpha I + \\frac{\\beta}{n} J = I,$$\n   其中 $n = 5, \\alpha = 1.0, \\beta = 0.0$。\n4. 维度 $n=5$、参数 $\\alpha = 0.9, \\beta = 0.1$ 的临界近简并一秩扰动单位矩阵：\n   $$A^{(4)} = \\alpha I + \\frac{\\beta}{n} J,$$\n   其中 $n = 5, \\alpha = 0.9, \\beta = 0.1$。\n5. 一个捕捉周期性的 $2 \\times 2$ 置换（交换）矩阵：\n   $$A^{(5)} = \\begin{bmatrix} 0  1 \\\\ 1  0 \\end{bmatrix}.$$\n\n您的程序必须严格按照描述实现该诊断程序，将其应用于矩阵 $A^{(1)}, A^{(2)}, A^{(3)}, A^{(4)}, A^{(5)}$，并生成单行最终输出，其中包含一个方括号括起来的逗号分隔列表，按顺序给出五个案例的布尔结果，例如 $[\\text{True},\\text{False},\\dots]$。不应打印任何额外文本。\n\n此问题不要求物理单位。不涉及角度。不应使用百分比；阈值和比率均为纯小数。\n\n测试套件中的矩阵旨在针对“理想路径”案例（主特征值分离良好）、近简并案例、精确简并案例、处于决策阈值的临界案例以及周期性案例来检验该诊断程序。最终答案必须是一个完整的、可运行的程序，该程序实现了诊断功能，并按指定格式单行输出决策布尔值。",
            "solution": "问题陈述经评估有效。它提出了一个定义明确的数值算法，该算法基于线性代数中的既定原理，特别是幂迭代法及其收敛性质。任务是实现一个特定的诊断启发式方法，其所有参数、过程和测试案例都已明确定义。该问题科学上合理、自成体系且客观，从而能够得出一个唯一且可验证的解。\n\n此问题的核心是实现一个数值诊断方法，用以检测幂迭代法中的慢收敛现象。幂迭代法是核反应堆物理中用于求解中子裂变源基模的一种常用算法。该迭代过程由下式给出\n$$ s_{k+1} = \\frac{A s_k}{\\|A s_k\\|_1} $$\n其中 $s_k \\in \\mathbb{R}^n$ 是第 $k$ 次迭代时的源向量，$A \\in \\mathbb{R}^{n \\times n}$ 是一个表示离散化的中子输運和裂变过程的非负矩阵，$\\|\\cdot\\|_1$ 表示 $\\ell_1$ 范数。\n\n根据针对非负、不可约、非周期矩阵的 Perron-Frobenius 定理，该迭代会收敛到与主（模最大）特征值 $\\lambda_1$ 关联的唯一的、严格为正的特征向量 $v_1$。收敛速率由优势比 $\\rho = |\\lambda_2|/|\\lambda_1|$决定，其中 $\\lambda_2$ 是次主特征值（模第二大的特征值）。迭代向量 $s_k$ 与真实特征向量 $v_1$ 之间的距离以与 $\\rho^k$ 成正比的速率减小。\n\n当 $\\rho$ 接近 1 时，收敛会变得非常缓慢。这种情况，即 $|\\lambda_1| \\approx |\\lambda_2|$，被称为主特征结构的近简并。问题中描述的诊断算法是一种直接从迭代序列 $\\{s_k\\}$ 估计该优势比 $\\rho$ 的实用方法。\n\n每次迭代中源向量的变化通过差值 $d_k = \\|s_{k+1} - s_k\\|_1$ 来衡量。对于大的 $k$，可以证明这些差值的序列以由 $\\rho$ 决定的速率几何收敛。因此，连续差分的比率，\n$$ r_k = \\frac{d_{k+1}}{d_k} = \\frac{\\|s_{k+2} - s_{k+1}\\|_1}{\\|s_{k+1} - s_k\\|_1} $$\n提供了优势比 $\\rho$ 的一个估计。$r_k$ 的值接近 1 表明收敛缓慢，并暗示存在近简并。\n\n指定的算法将此概念形式化为：\n\n1.  初始化：构造一个初始向量 $s_0$，其分量 $s_{0,i}$ 与 $i+1$ 成正比。归一化为单位 $\\ell_1$ 范数后得到：\n    $$ s_0 = \\frac{(1, 2, \\dots, n)^T}{\\sum_{j=1}^n j} = \\frac{2}{n(n+1)} (1, 2, \\dots, n)^T $$\n\n2.  迭代：对于 $k=0, 1, \\dots, K-1$，迭代次数 $K=200$，计算并归一化下一个源向量：\n    $$s_{k+1} = \\frac{A s_k}{\\|A s_k\\|_1}$$\n\n3.  差分：计算所有迭代 $k = 0, \\dots, K-1$ 的 $\\ell_1$ 差分序列 $d_k = \\|s_{k+1} - s_k\\|_1$。\n\n4.  尾部比率估计：为获得渐近比率的稳定估计，我们考察比率序列的尾部。我们考虑最后 $T=50$ 个潜在比率的一个窗口，即对于 $k \\in [K-T-1, K-2]$ 的 $r_k = d_{k+1}/d_k$。可计算比率集合定义为 $\\mathcal{R} = \\{ r_k \\mid d_k > \\varepsilon \\}$，其中 $\\varepsilon=10^{-12}$ 是一个避免除以零或数值不稳定的小阈值。有效尾部比率 $R$ 定义为 $\\mathcal{R}$ 中各值的中位数。如果 $\\mathcal{R}$ 为空（即收敛速度非常快，以至于尾部所有差分都低于阈值，或者向量没有变化），则将 $R$ 设置为 $1.0$。\n\n5.  决策规则：通过将估计的比率 $R$ 与阈值 $\\tau_r = 0.9$ 进行比较来作出关于近简并的决策。如果 $R \\ge \\tau_r$，则系统被标记为具有（近）简并的主特征结构。\n\n该程序将应用于所提供的五个测试矩阵中的每一个。对于矩阵族 $A = \\alpha I + \\frac{\\beta}{n} J$，其特征值为 $\\lambda_1 = \\alpha + \\beta$ 和 $\\lambda_2 = \\dots = \\lambda_n = \\alpha$。真实的优势比为 $\\rho = \\frac{\\alpha}{\\alpha+\\beta}$，这使我们能够预测诊断程序的行为。例如，在案例1中（$\\alpha=0.1, \\beta=0.9$），$\\rho=0.1$，表示快速收敛。在案例2中（$\\alpha=0.95, \\beta=0.05$），$\\rho=0.95$，表示近简并。其他案例测试了精确简并、临界条件和周期性。",
            "answer": "```python\nimport numpy as np\n\ndef run_diagnostic(A, n):\n    \"\"\"\n    Implements the source iteration convergence diagnostic for a given matrix.\n\n    Args:\n        A (np.ndarray): The n x n matrix for the power iteration.\n        n (int): The dimension of the matrix.\n\n    Returns:\n        bool: True if near-degeneracy is detected, False otherwise.\n    \"\"\"\n    # Parameters from the problem statement\n    K = 200\n    T = 50\n    epsilon = 1e-12\n    tau_r = 0.9\n\n    # Step 1: Initialization\n    # Initial source s_0 with components proportional to index i+1, l1-normalized.\n    s0_unnormalized = np.arange(1, n + 1, dtype=np.float64)\n    s0_norm = np.linalg.norm(s0_unnormalized, ord=1)\n    s = s0_unnormalized / s0_norm\n\n    # Store history of source vectors\n    s_history = np.zeros((K + 1, n))\n    s_history[0] = s\n\n    # Step 2: Iteration\n    # For k = 0, ..., K-1, compute s_{k+1}\n    for k in range(K):\n        s_prev = s_history[k]\n        s_next_unnorm = A @ s_prev\n        \n        norm_val = np.linalg.norm(s_next_unnorm, ord=1)\n        # Handle the case where the norm is zero to avoid division by zero.\n        if norm_val == 0:\n            s_next = np.zeros_like(s_next_unnorm)\n        else:\n            s_next = s_next_unnorm / norm_val\n        \n        s_history[k + 1] = s_next\n\n    # Step 3: Differences\n    # Compute d_k = ||s_{k+1} - s_k||_1 for k = 0, ..., K-1\n    d = np.zeros(K)\n    for k in range(K):\n        d[k] = np.linalg.norm(s_history[k + 1] - s_history[k], ord=1)\n    \n    # Step 4: Tail ratio estimate\n    ratios = []\n    # Loop over the indices corresponding to the last T potential ratios.\n    # These are r_k for k from K-T-1 to K-2.\n    start_k = K - T - 1\n    end_k = K - 1 \n    for k in range(start_k, end_k):\n        # Check if the denominator is above the threshold\n        if d[k] > epsilon:\n            ratios.append(d[k + 1] / d[k])\n    \n    if not ratios:\n        R = 1.0\n    else:\n        R = np.median(ratios)\n\n    # Step 5: Decision rule\n    return R >= tau_r\n\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and run the diagnostic on each.\n    \"\"\"\n    \n    # --- Define Test Cases ---\n    \n    # Case 1: n=5, alpha=0.1, beta=0.9\n    n1 = 5\n    alpha1 = 0.1\n    beta1 = 0.9\n    J1 = np.ones((n1, n1))\n    A1 = alpha1 * np.identity(n1) + (beta1 / n1) * J1\n    \n    # Case 2: n=5, alpha=0.95, beta=0.05\n    n2 = 5\n    alpha2 = 0.95\n    beta2 = 0.05\n    J2 = np.ones((n2, n2))\n    A2 = alpha2 * np.identity(n2) + (beta2 / n2) * J2\n    \n    # Case 3: n=5, alpha=1.0, beta=0.0\n    n3 = 5\n    alpha3 = 1.0\n    beta3 = 0.0\n    J3 = np.ones((n3, n3))\n    A3 = alpha3 * np.identity(n3) + (beta3 / n3) * J3 # This is just Identity\n    \n    # Case 4: n=5, alpha=0.9, beta=0.1\n    n4 = 5\n    alpha4 = 0.9\n    beta4 = 0.1\n    J4 = np.ones((n4, n4))\n    A4 = alpha4 * np.identity(n4) + (beta4 / n4) * J4\n    \n    # Case 5: 2x2 permutation matrix\n    n5 = 2\n    A5 = np.array([[0, 1], [1, 0]], dtype=np.float64)\n\n    test_cases = [\n        (A1, n1),\n        (A2, n2),\n        (A3, n3),\n        (A4, n4),\n        (A5, n5)\n    ]\n\n    results = []\n    for (A, n) in test_cases:\n        result = run_diagnostic(A, n)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在确认源已收敛后，准确的量化不确定性至关重要。本问题聚焦于分析已收敛的源度量（香农熵）的时间序列，以正确计算其置信区间。您将应用积分自相关时间的概念来处理代际间的序列相关性，这是从任何蒙特卡罗模拟中报告具有统计学意义结果的关键步骤。",
            "id": "4250569",
            "problem": "在压水反应堆堆芯的蒙特卡洛 $k$ 特征值模拟中，裂变源分布通过幂迭代法在每个代次进行更新，从而产生一个逐代源度量的相关序列。用于评估源稳定性的诊断量之一是归一化裂变源直方图的香农熵，其在每个代次 $t$ 定义为 $H_{t} = -\\sum_{i=1}^{B} p_{t,i} \\ln p_{t,i}$，其中 $p_{t,i}$ 是在第 $t$ 代期间出生于空间单元 $i$ 的裂变中子份额，且 $\\sum_{i=1}^{B} p_{t,i} = 1$。在舍弃非活跃代以消除初始瞬态后，假设收集了 $N = 1000$ 个活跃代，并且平稳熵过程 $\\{H_{t}\\}_{t=1}^{N}$ 被视为由源迭代生成的平稳遍历序列的一个实现。\n\n根据这些代次，计算出以下诊断量：样本均值 $\\bar{H} = 3.182$（以自然对数单位计），$\\{H_{t}\\}$ 的样本方差 $s^{2} = 3.6 \\times 10^{-3}$，以及基于经验自相关函数得到的 $\\{H_{t}\\}$ 的积分自相关时间估计值 $\\tau_{\\text{int}} = 8.2$。请使用基于 $H_{t}$ 定义和相关平稳序列的适当渐近理论的推导，为平稳平均熵水平构建一个渐近双边 $95\\%$ 置信区间，并计算相应的 $95\\%$ 半宽度。只报告半宽度的数值，四舍五入到四位有效数字，并以自然对数单位表示半宽度。",
            "solution": "用户希望求出一个相关时间序列均值的 $95\\%$ 置信区间的半宽度。\n\n### 步骤1：提取已知条件\n-   活跃代（样本）的数量为 $N = 1000$。\n-   该过程是香农熵值的平稳遍历序列，$\\{H_{t}\\}_{t=1}^{N}$。\n-   熵的样本均值为 $\\bar{H} = 3.182$。\n-   熵序列的样本方差为 $s^{2} = 3.6 \\times 10^{-3}$。\n-   该序列的积分自相关时间估计值为 $\\tau_{\\text{int}} = 8.2$。\n-   所需的置信水平为 $95\\%$。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据：** 该问题设置在蒙特卡洛核反应堆分析的标准框架内。使用香农熵作为源收敛诊断量、幂迭代、活跃代以及对所得时间序列（包括自相关）的统计处理都是该领域的既定做法。所提供的值在物理上和数值上都是合理的。该问题是科学合理的。\n-   **良态的：** 所有计算所要求数量的必要数据（$N$、$s^2$、$\\tau_{\\text{int}}$ 和置信水平）均已提供。该问题要求一个唯一的数值，即置信区间的半宽度，这可以使用标准的时间序列统计理论来确定。\n-   **客观性：** 该问题使用统计学和核工程中常见的精确且无歧义的技术语言来陈述。没有主观或基于意见的元素。\n\n### 步骤3：结论与行动\n问题有效。将提供完整的解答。\n\n### 解答推导\n问题要求为一个平稳、遍历但自相关的随机过程 $\\{H_t\\}$ 的真实均值 $\\mu_H = E[H_t]$ 构建一个置信区间。我们已知该过程的大小为 $N = 1000$ 的有限样本。\n\n根据具有足够快相关衰减的平稳序列的中心极限定理，样本均值 $\\bar{H} = \\frac{1}{N}\\sum_{t=1}^{N} H_t$ 是渐近正态分布的。这个分布的均值是过程的真实均值 $\\mu_H$，其方差 $\\sigma^2_{\\bar{H}}$ 由下式给出：\n$$ \\sigma^2_{\\bar{H}} = \\text{Var}(\\bar{H}) = \\frac{\\sigma^2}{N} \\left( 1 + 2\\sum_{k=1}^{N-1} \\left(1 - \\frac{k}{N}\\right) \\rho_k \\right) $$\n其中 $\\sigma^2 = \\text{Var}(H_t)$ 是过程的真实方差，$\\rho_k$ 是过程在滞后 $k$ 时的自相关。\n\n对于大的 $N$，这个表达式可以使用积分自相关时间 $\\tau_{\\text{int}}$ 来近似，其定义为：\n$$ \\tau_{\\text{int}} = 1 + 2\\sum_{k=1}^{\\infty} \\rho_k $$\n根据这个定义，对于大的 $N$，样本均值的方差变为：\n$$ \\sigma^2_{\\bar{H}} \\approx \\frac{\\sigma^2 \\tau_{\\text{int}}}{N} $$\n这个表达式表明，与不相关的过程相比，相关性使样本均值的方差增加了 $\\tau_{\\text{int}}$ 倍。数量 $N_{\\text{eff}} = N/\\tau_{\\text{int}}$ 可以解释为有效独立样本数。\n\n为了计算置信区间，我们必须首先估计均值的标准误 $s_{\\bar{H}}$。这是样本均值估计方差 $s^2_{\\bar{H}}$ 的平方根。我们使用给定的样本方差 $s^2$ 作为真实过程方差 $\\sigma^2$ 的估计量来估计 $\\sigma^2_{\\bar{H}}$。\n$$ s^2_{\\bar{H}} = \\frac{s^2 \\tau_{\\text{int}}}{N} $$\n代入给定值：\n$N = 1000$\n$s^2 = 3.6 \\times 10^{-3}$\n$\\tau_{\\text{int}} = 8.2$\n$$ s^2_{\\bar{H}} = \\frac{(3.6 \\times 10^{-3}) \\cdot (8.2)}{1000} = \\frac{0.02952}{1000} = 2.952 \\times 10^{-5} $$\n均值的标准误是该值的平方根：\n$$ s_{\\bar{H}} = \\sqrt{2.952 \\times 10^{-5}} \\approx 0.005433231 $$\n\n真实均值 $\\mu_H$ 的一个双边 $95\\%$ 置信区间由下式给出：\n$$ \\bar{H} \\pm z_{\\alpha/2} s_{\\bar{H}} $$\n对于 $95\\%$ 的置信水平，显著性水平为 $\\alpha = 0.05$，这意味着 $\\alpha/2 = 0.025$。来自标准正态分布的临界值 $z_{0.025}$ 是使得累积概率为 $1 - 0.025 = 0.975$ 的值。该值为：\n$$ z_{0.025} = 1.96 $$\n因为样本量 ($N=1000$) 很大，所以使用正态分布是合理的。\n\n置信区间的半宽度 ($HW$) 是从样本均值中加上和减去的量。其定义为：\n$$ HW = z_{\\alpha/2} s_{\\bar{H}} $$\n代入 $z_{0.025}$ 和 $s_{\\bar{H}}$ 的值：\n$$ HW = 1.96 \\times \\sqrt{\\frac{s^2 \\tau_{\\text{int}}}{N}} $$\n$$ HW = 1.96 \\times \\sqrt{2.952 \\times 10^{-5}} $$\n$$ HW \\approx 1.96 \\times 0.005433231 \\approx 0.010649133 $$\n问题要求答案四舍五入到四位有效数字。\n$$ HW \\approx 0.01065 $$\n半宽度的单位与被测量的量相同，即自然对数单位。",
            "answer": "$$\n\\boxed{0.01065}\n$$"
        }
    ]
}