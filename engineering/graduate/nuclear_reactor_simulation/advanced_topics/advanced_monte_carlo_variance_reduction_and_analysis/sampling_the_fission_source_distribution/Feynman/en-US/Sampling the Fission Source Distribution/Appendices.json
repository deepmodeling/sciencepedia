{
    "hands_on_practices": [
        {
            "introduction": "The first step in simulating the life of a fission neutron is its \"birth,\" which requires sampling its initial properties from the fission source distribution. A crucial property is the neutron's kinetic energy, which follows a continuous spectrum rather than being a single value. This exercise  delves into the physics behind two important models for the prompt fission neutron energy spectrum—the Maxwellian and Madland-Nix models—and challenges you to develop sampling methods for each. By deriving and comparing their statistical moments, you will gain a deeper appreciation for how physical models directly inform the algorithms used in Monte Carlo codes.",
            "id": "4247542",
            "problem": "You are asked to build a complete, runnable program that compares two physically-motivated probability models for the prompt fission neutron source energy in nuclear reactor simulation: a Maxwellian spectrum and a Madland–Nix spectrum. Your program must implement scientifically justified sampling methods for each spectrum and must compute the first and second energy moments to quantify the effect of spectrum choice on the source energy distribution. All energy-related quantities must be expressed in megaelectronvolts (MeV). Angles, where needed, must be treated in radians. The program must produce the final results in a single line in the specified format.\n\nStart from the following fundamental base, without using shortcut formulas not derived from these principles:\n\n- Nonrelativistic kinetic energy relation: for a particle of mass $m$, the kinetic energy is $E = \\frac{1}{2} m v^{2}$, and for the addition of velocities when a particle is emitted isotropically from a moving source, the laboratory-frame speed squared is $v^{2} = v'^{2} + V^{2} + 2 v' V \\cos\\theta$, with $\\theta \\in [0,\\pi]$.\n- Maxwell–Boltzmann distribution for particle speeds in thermal equilibrium and its induced energy distribution.\n- Nuclear evaporation picture for neutron emission from moving fission fragments, in which emission in the fragment frame is isotropic, and the center-of-mass emission energy $E'$ is modeled by an exponential distribution with a characteristic emission temperature $T$.\n- Conservation of energy and isotropy of emission in the fragment frame.\n\nYou must carry out the following tasks:\n\n1. Define the Maxwellian source energy model. The Maxwellian model for the energy $E$ of prompt fission neutrons emerging from a stationary source is obtained by transforming the Maxwell–Boltzmann speed distribution to energy. You must derive the properly normalized probability density function (PDF) in terms of the emission temperature parameter $T_{\\mathrm{M}}$ and then derive the first moment $\\mathbb{E}[E]$ and the second moment $\\mathbb{E}[E^{2}]$ in units of MeV and $\\mathrm{MeV}^{2}$, respectively. You must also design a sampling method that draws independent samples of $E$ consistent with this PDF.\n\n2. Define the Madland–Nix source energy model. The Madland–Nix model treats emission from two classes of moving fission fragments, light and heavy, labeled $i \\in \\{L,H\\}$. In the fragment frame, the neutron emission energy $E'$ is exponentially distributed with characteristic temperature $T_{i}$, and emission directions are isotropic. In the laboratory frame, the fragment motion produces a nonrelativistic kinematic boost parameter\n$$\nE_{b,i} = \\frac{\\mathrm{KE}_{\\mathrm{frag},i}}{A_{i}},\n$$\nwhere $\\mathrm{KE}_{\\mathrm{frag},i}$ is the kinetic energy of fragment class $i$ and $A_{i}$ is its mass number. Using $E = \\frac{1}{2} m v^{2}$ and nonrelativistic velocity addition, show that the laboratory energy for an emitted neutron can be written as\n$$\nE = E' + E_{b,i} + 2 \\sqrt{E' E_{b,i}} \\, \\mu,\n$$\nwhere $\\mu = \\cos\\theta$ is uniformly distributed on $[-1,1]$ due to isotropy. Derive the first moment $\\mathbb{E}[E]$ and the second moment $\\mathbb{E}[E^{2}]$ for each fragment class as functions of $T_{i}$ and $E_{b,i}$, then for the overall Madland–Nix spectrum obtained by an equal-probability mixture of the light and heavy classes. Design a sampling method that draws independent samples of $E$ consistent with this model by sampling $E'$ and $\\mu$ and assembling $E$ as above.\n\n3. Quantify the effect of spectrum choice. For each test case below, compute the difference in energy moments between the Madland–Nix and Maxwellian models:\n$$\n\\Delta m_{1} = \\mathbb{E}_{\\mathrm{MN}}[E] - \\mathbb{E}_{\\mathrm{M}}[E], \\quad \\Delta m_{2} = \\mathbb{E}_{\\mathrm{MN}}[E^{2}] - \\mathbb{E}_{\\mathrm{M}}[E^{2}],\n$$\nwith $\\Delta m_{1}$ reported in MeV and $\\Delta m_{2}$ reported in $\\mathrm{MeV}^{2}$. Your program must implement samplers for both models and also compute the derived analytical moment differences from the model definitions. To ensure a deterministic output, you must report the analytical moment differences rounded to six decimal places. Internally, you must verify the sampling methods by generating at least $N = 100{,}000$ samples per distribution per test case using a fixed random seed to confirm that sampled moment differences are consistent with the analytical ones to within reasonable Monte Carlo error, but you must not print these internal verification results.\n\nPhysical units requirement: All energies must be treated and reported in $\\mathrm{MeV}$, and second moments in $\\mathrm{MeV}^{2}$. There are no angles to report.\n\nYour test suite consists of three cases covering typical, low-temperature, and higher-temperature regimes. For each case, parameter values are:\n\n- Case $1$ (typical thermal fission): Maxwellian parameter $T_{\\mathrm{M}} = 1.3$; Madland–Nix parameters: light fragment $T_{L} = 1.0$, $\\mathrm{KE}_{\\mathrm{frag},L} = 100.0$, $A_{L} = 96$ giving $E_{b,L} = \\mathrm{KE}_{\\mathrm{frag},L}/A_{L}$; heavy fragment $T_{H} = 0.8$, $\\mathrm{KE}_{\\mathrm{frag},H} = 70.0$, $A_{H} = 140$ giving $E_{b,H} = \\mathrm{KE}_{\\mathrm{frag},H}/A_{H}$.\n\n- Case $2$ (lower temperatures): Maxwellian parameter $T_{\\mathrm{M}} = 0.5$; Madland–Nix parameters: light fragment $T_{L} = 0.6$, $\\mathrm{KE}_{\\mathrm{frag},L} = 90.0$, $A_{L} = 100$ giving $E_{b,L}$; heavy fragment $T_{H} = 0.5$, $\\mathrm{KE}_{\\mathrm{frag},H} = 80.0$, $A_{H} = 135$ giving $E_{b,H}$.\n\n- Case $3$ (higher temperatures): Maxwellian parameter $T_{\\mathrm{M}} = 2.0$; Madland–Nix parameters: light fragment $T_{L} = 1.6$, $\\mathrm{KE}_{\\mathrm{frag},L} = 110.0$, $A_{L} = 95$ giving $E_{b,L}$; heavy fragment $T_{H} = 1.2$, $\\mathrm{KE}_{\\mathrm{frag},H} = 60.0$, $A_{H} = 141$ giving $E_{b,H}$.\n\nYour program must:\n\n- Implement samplers for both Maxwellian and Madland–Nix spectra that conform to the physical derivations above.\n- Compute analytical $\\Delta m_{1}$ and $\\Delta m_{2}$ for each case based on your derived formulas.\n- Internally verify that Monte Carlo estimated moment differences are close to analytical differences using $N = 100{,}000$ samples per spectrum per case and a fixed seed, but do not print the verification.\n- Produce a single line of output containing the analytical results as a comma-separated list enclosed in square brackets, ordered as $[\\Delta m_{1}^{(1)},\\Delta m_{2}^{(1)},\\Delta m_{1}^{(2)},\\Delta m_{2}^{(2)},\\Delta m_{1}^{(3)},\\Delta m_{2}^{(3)}]$, rounded to six decimal places.\n\nThere must be no other text in the program output besides this single line list.",
            "solution": "We begin from the nonrelativistic kinetic energy relation. For a particle of mass $m$, the kinetic energy is $E = \\frac{1}{2} m v^{2}$. If a neutron with center-of-mass speed $v'$ is emitted isotropically from a fragment moving with speed $V$, the laboratory speed satisfies $v^{2} = v'^{2} + V^{2} + 2 v' V \\cos\\theta$ with $\\theta$ uniformly distributed on $[0,\\pi]$, so $\\mu = \\cos\\theta$ is uniform on $[-1,1]$. In energy variables, $E' = \\frac{1}{2} m v'^{2}$, $E_{b} = \\frac{1}{2} m V^{2}$, and\n$$\nE = E' + E_{b} + 2 \\sqrt{E' E_{b}} \\, \\mu.\n$$\n\nMaxwellian model. For a stationary source (no boost), a Maxwell–Boltzmann distribution of speeds at temperature $T_{\\mathrm{M}}$ induces the energy distribution\n$$\nf_{\\mathrm{M}}(E; T_{\\mathrm{M}}) = \\frac{2}{\\sqrt{\\pi}} \\frac{E^{1/2}}{T_{\\mathrm{M}}^{3/2}} \\exp\\!\\left(-\\frac{E}{T_{\\mathrm{M}}}\\right), \\quad E \\ge 0,\n$$\nwhich is a Gamma distribution with shape parameter $k = \\frac{3}{2}$ and scale parameter $\\theta = T_{\\mathrm{M}}$. From Gamma distribution properties derived via\n$$\n\\mathbb{E}[E^{n}] = \\int_{0}^{\\infty} E^{n} f_{\\mathrm{M}}(E; T_{\\mathrm{M}}) \\, \\mathrm{d}E,\n$$\nwe obtain\n$$\n\\mathbb{E}_{\\mathrm{M}}[E] = k \\theta = \\frac{3}{2} T_{\\mathrm{M}}, \\qquad \\mathbb{E}_{\\mathrm{M}}[E^{2}] = \\theta^{2} k (k + 1) = \\frac{15}{4} T_{\\mathrm{M}}^{2}.\n$$\nA sampling method consistent with $f_{\\mathrm{M}}$ is to draw $E$ from a Gamma distribution with parameters $k = \\frac{3}{2}$ and $\\theta = T_{\\mathrm{M}}$, which can be derived from the Maxwell–Boltzmann speed distribution via the transformation $E = \\frac{1}{2} m v^{2}$ and the Jacobian relating speed and energy PDFs.\n\nMadland–Nix model. In the fragment frame, we model the emission energy by an exponential PDF\n$$\nf_{E'}(E'; T_{i}) = \\frac{1}{T_{i}} \\exp\\!\\left( - \\frac{E'}{T_{i}} \\right), \\quad E' \\ge 0,\n$$\nconsistent with an evaporation spectrum at temperature $T_{i}$ and isotropic angles. The fragment kinetic energy per nucleon is\n$$\nE_{b,i} = \\frac{\\mathrm{KE}_{\\mathrm{frag},i}}{A_{i}},\n$$\nso the laboratory-frame energy for a neutron emitted from fragment class $i \\in \\{L,H\\}$ is\n$$\nE = E' + E_{b,i} + 2 \\sqrt{E' E_{b,i}} \\, \\mu, \\quad \\mu \\sim \\mathrm{Uniform}(-1,1).\n$$\nWe derive the first moment per fragment class by conditioning on $E'$ and $\\mu$:\n$$\n\\mathbb{E}[E \\mid E'] = E' + E_{b,i} + 2 \\sqrt{E' E_{b,i}} \\, \\mathbb{E}[\\mu] = E' + E_{b,i},\n$$\nsince $\\mathbb{E}[\\mu] = 0$ by symmetry. Hence\n$$\n\\mathbb{E}_{i}[E] = \\mathbb{E}[E'] + E_{b,i} = T_{i} + E_{b,i}.\n$$\nNext, we derive the second moment. Given $E'$, we have\n$$\nE^{2} = \\left( E' + E_{b,i} + 2 \\sqrt{E' E_{b,i}} \\, \\mu \\right)^{2} = (E' + E_{b,i})^{2} + 4 \\sqrt{E' E_{b,i}} \\, \\mu (E' + E_{b,i}) + 4 E' E_{b,i} \\mu^{2}.\n$$\nTaking expectation over $\\mu$ using $\\mathbb{E}[\\mu] = 0$ and $\\mathbb{E}[\\mu^{2}] = \\frac{1}{3}$ yields\n$$\n\\mathbb{E}[E^{2} \\mid E'] = (E' + E_{b,i})^{2} + \\frac{4}{3} E' E_{b,i}.\n$$\nUnconditioning over $E'$ requires the moments of the exponential distribution, namely $\\mathbb{E}[E'] = T_{i}$ and $\\mathbb{E}[E'^{2}] = 2 T_{i}^{2}$. Substituting:\n$$\n\\mathbb{E}_{i}[E^{2}] = \\mathbb{E}[E'^{2}] + 2 E_{b,i} \\mathbb{E}[E'] + E_{b,i}^{2} + \\frac{4}{3} E_{b,i} \\mathbb{E}[E'] = 2 T_{i}^{2} + E_{b,i}^{2} + \\frac{10}{3} E_{b,i} T_{i}.\n$$\nThe overall Madland–Nix spectrum is the equal-probability mixture of light and heavy fragments, so its moments are the averages of the fragment-class moments:\n$$\n\\mathbb{E}_{\\mathrm{MN}}[E] = \\frac{1}{2} \\left( T_{L} + E_{b,L} + T_{H} + E_{b,H} \\right),\n$$\n$$\n\\mathbb{E}_{\\mathrm{MN}}[E^{2}] = \\frac{1}{2} \\left( 2 T_{L}^{2} + E_{b,L}^{2} + \\frac{10}{3} E_{b,L} T_{L} + 2 T_{H}^{2} + E_{b,H}^{2} + \\frac{10}{3} E_{b,H} T_{H} \\right).\n$$\nTherefore, the differences in moments between the Madland–Nix and Maxwellian models are\n$$\n\\Delta m_{1} = \\mathbb{E}_{\\mathrm{MN}}[E] - \\frac{3}{2} T_{\\mathrm{M}},\n$$\n$$\n\\Delta m_{2} = \\mathbb{E}_{\\mathrm{MN}}[E^{2}] - \\frac{15}{4} T_{\\mathrm{M}}^{2}.\n$$\n\nSampling methods. For the Maxwellian model, sampling $E$ from a Gamma distribution with shape $k = \\frac{3}{2}$ and scale $\\theta = T_{\\mathrm{M}}$ is consistent with $f_{\\mathrm{M}}(E; T_{\\mathrm{M}})$ derived above. For the Madland–Nix model, a physically consistent sampler proceeds as follows: select fragment class $i$ with equal probability; sample $E'$ from the exponential distribution with mean $T_{i}$; sample $\\mu$ uniformly from $[-1,1]$; compute $E = E' + E_{b,i} + 2 \\sqrt{E' E_{b,i}} \\, \\mu$. This construction follows directly from the nonrelativistic transformation of energies from the fragment frame to the laboratory frame and the isotropy of emission.\n\nVerification. While the final reported results must be the analytical moment differences rounded to six decimal places, we can verify the samplers using Monte Carlo (MC) estimation. Using $N = 100{,}000$ samples per distribution per case and a fixed random seed, we compute sample averages of $E$ and $E^{2}$ and check that they are close to the derived moments. By the Central Limit Theorem (CLT), the sampling error scales like $N^{-1/2}$, ensuring that the MC estimates will be near the analytical values for the chosen $N$.\n\nImplementation details. For each test case, compute $E_{b,i}$ via $E_{b,i} = \\mathrm{KE}_{\\mathrm{frag},i}/A_{i}$ from the given parameters. Then compute $\\Delta m_{1}$ and $\\Delta m_{2}$ using the formulas above, in the required units. Internally perform MC verification as described, but only print the final analytical differences in the specified single-line format: $[\\Delta m_{1}^{(1)},\\Delta m_{2}^{(1)},\\Delta m_{1}^{(2)},\\Delta m_{2}^{(2)},\\Delta m_{1}^{(3)},\\Delta m_{2}^{(3)}]$, rounded to six decimal places. No other output is permitted.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef maxwellian_moments(T_M):\n    \"\"\"\n    Analytical moments for Maxwellian energy distribution (Gamma k=3/2, theta=T_M).\n    Returns (m1, m2): mean and second moment in MeV and MeV^2.\n    \"\"\"\n    m1 = 1.5 * T_M\n    m2 = (15.0 / 4.0) * (T_M ** 2)\n    return m1, m2\n\ndef madland_nix_moments(T_L, Eb_L, T_H, Eb_H):\n    \"\"\"\n    Analytical moments for Madland–Nix mixture (equal weights of light and heavy fragments).\n    E' ~ Exp(scale=T_i), mu ~ Uniform(-1,1), E = E' + Eb_i + 2*sqrt(E'*Eb_i)*mu\n    Returns (m1, m2): mean and second moment in MeV and MeV^2.\n    \"\"\"\n    # Per-fragment moments\n    m1_L = T_L + Eb_L\n    m2_L = 2.0 * (T_L ** 2) + (Eb_L ** 2) + (10.0 / 3.0) * Eb_L * T_L\n\n    m1_H = T_H + Eb_H\n    m2_H = 2.0 * (T_H ** 2) + (Eb_H ** 2) + (10.0 / 3.0) * Eb_H * T_H\n\n    # Mixture average\n    m1 = 0.5 * (m1_L + m1_H)\n    m2 = 0.5 * (m2_L + m2_H)\n    return m1, m2\n\ndef sample_maxwellian(T_M, N, rng):\n    \"\"\"\n    Sample energies from Maxwellian distribution using Gamma(k=3/2, theta=T_M).\n    Returns array of energies in MeV.\n    \"\"\"\n    # numpy's gamma uses shape k and scale theta\n    return rng.gamma(shape=1.5, scale=T_M, size=N)\n\ndef sample_madland_nix(T_L, Eb_L, T_H, Eb_H, N, rng):\n    \"\"\"\n    Sample energies from Madland–Nix distribution via physical construction.\n    Returns array of energies in MeV.\n    \"\"\"\n    # Choose fragment class indices: 0 for L, 1 for H\n    frag_choices = rng.integers(0, 2, size=N)  # equal probability\n    # Prepare arrays for parameters per sample\n    T = np.where(frag_choices == 0, T_L, T_H)\n    Eb = np.where(frag_choices == 0, Eb_L, Eb_H)\n\n    # Sample E' exponential with mean T (scale=T), mu uniform(-1,1)\n    E_prime = rng.exponential(scale=T, size=N)\n    mu = rng.uniform(low=-1.0, high=1.0, size=N)\n\n    # Construct lab energy\n    E = E_prime + Eb + 2.0 * np.sqrt(E_prime * Eb) * mu\n    # Numerical safeguard: E can be slightly negative due to rounding when E' and Eb are tiny; clip at 0\n    E = np.clip(E, 0.0, None)\n    return E\n\ndef compute_deltas(case, N_verify=100_000, seed=12345):\n    \"\"\"\n    For a given case, compute analytical delta moments and perform internal MC verification.\n    Returns (delta_m1, delta_m2) analytical values.\n    \"\"\"\n    T_M, T_L, KE_L, A_L, T_H, KE_H, A_H = case\n    Eb_L = KE_L / A_L\n    Eb_H = KE_H / A_H\n\n    # Analytical moments\n    m1_M, m2_M = maxwellian_moments(T_M)\n    m1_MN, m2_MN = madland_nix_moments(T_L, Eb_L, T_H, Eb_H)\n    delta_m1 = m1_MN - m1_M\n    delta_m2 = m2_MN - m2_M\n\n    # Internal MC verification (not printed)\n    rng = np.random.default_rng(seed)\n    # Sample Maxwellian\n    E_M = sample_maxwellian(T_M, N_verify, rng)\n    # Sample Madland–Nix\n    E_MN = sample_madland_nix(T_L, Eb_L, T_H, Eb_H, N_verify, rng)\n\n    # Compute sample moments\n    m1_M_sample = float(np.mean(E_M))\n    m2_M_sample = float(np.mean(E_M ** 2))\n    m1_MN_sample = float(np.mean(E_MN))\n    m2_MN_sample = float(np.mean(E_MN ** 2))\n    # Sample deltas (not used for output)\n    _delta_m1_sample = m1_MN_sample - m1_M_sample\n    _delta_m2_sample = m2_MN_sample - m2_M_sample\n    # Could assert closeness if desired; omitted to keep silent output\n\n    return delta_m1, delta_m2\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case tuple: (T_M, T_L, KE_L, A_L, T_H, KE_H, A_H)\n    test_cases = [\n        (1.3, 1.0, 100.0, 96.0, 0.8, 70.0, 140.0),   # Case 1\n        (0.5, 0.6, 90.0, 100.0, 0.5, 80.0, 135.0),   # Case 2\n        (2.0, 1.6, 110.0, 95.0, 1.2, 60.0, 141.0),   # Case 3\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_m1, delta_m2 = compute_deltas(case)\n        # Round to six decimal places as required\n        results.append(f\"{delta_m1:.6f}\")\n        results.append(f\"{delta_m2:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Once a source neutron is sampled, it is tracked through the reactor geometry. To improve computational efficiency, especially in regions of low importance, variance reduction techniques like Russian roulette are often employed. However, these techniques must be implemented carefully to avoid introducing bias into the simulation results. This exercise  presents a seemingly plausible but flawed roulette scheme and asks you to derive the resulting mathematical bias in the fission source, providing a crucial lesson on the importance of conserving expected particle weight to maintain an unbiased simulation.",
            "id": "4247534",
            "problem": "Consider a one-speed, one-dimensional slab transport model used in Monte Carlo (MC) neutron simulation to sample the fission source distribution. The geometry consists of three contiguous regions along the positive $x$-axis: a left fuel slab $\\mathcal{U} = [0, L]$, a void slab $\\mathcal{V} = [L, L+H]$, and a right fuel slab $\\mathcal{W} = [L+H, 2L+H]$, where $L > 0$ and $H > 0$. The fuel regions have constant macroscopic total cross section $\\Sigma_{t} > 0$, are purely absorbing (no scattering), and have macroscopic fission cross section $\\Sigma_{f} > 0$. The void region is an ideal void with $\\Sigma_{t} = 0$. Neutrons are monokinetic, and for simplicity, all source neutrons in $\\mathcal{U}$ stream to the right without angular redistribution. The fundamental facts you may use are the Beer–Lambert exponential attenuation law and the linearity of MC estimators with respect to particle weight.\n\nA uniform fission source density $S_{0}$ (neutrons per unit length per unit time) is sustained in $\\mathcal{U}$, and we define the target fission source distribution in $\\mathcal{W}$ to be\n$$\nS_{\\text{true}}(x) = \\nu \\Sigma_{f} \\phi(x), \\quad x \\in [L+H, 2L+H],\n$$\nwhere $\\nu$ is the average number of neutrons produced per fission, and $\\phi(x)$ is the (one-speed) scalar flux produced by those source neutrons streaming from $\\mathcal{U}$ into $\\mathcal{W}$ through the void. Assume vacuum boundaries at $x=0$ and $x=2L+H$.\n\nNow implement a naive Russian roulette in the void slab $\\mathcal{V}$ as follows: whenever a particle enters $\\mathcal{V}$ with statistical weight $w$, it is killed with probability $r \\in (0,1)$ and, if it survives, it continues with unchanged weight $w$ into $\\mathcal{W}$. No other variance-reduction or biasing is employed, and all tallies are proportional to particle weight. This roulette is applied at most once per particle history, specifically upon the first crossing from $\\mathcal{U}$ into $\\mathcal{V}$.\n\nStarting from first principles and the given fundamental facts, derive the expected fission source distribution in $\\mathcal{W}$ under this naive roulette, $S_{\\text{RR}}(x)$, and compute the multiplicative bias factor $B$ defined by\n$$\nB = \\frac{\\mathbb{E}[\\hat{S}_{\\text{RR}}(x)]}{S_{\\text{true}}(x)},\n$$\nwhich should be independent of $x$ in this setup. Then determine a single constant weight-rescaling correction factor $C$ to be applied to the weight of each surviving particle upon roulette in $\\mathcal{V}$ so that the corrected estimator recovers $S_{\\text{true}}(x)$ in expectation for all $x \\in [L+H, 2L+H]$.\n\nExpress your final answer as a two-entry row matrix $\\begin{pmatrix} B & C \\end{pmatrix}$ in closed form as a function of $r$. No numerical rounding is required, and no physical units should be included in your final expressions.",
            "solution": "The problem requires the derivation of the bias introduced by a naive Russian roulette scheme and the determination of a correction factor to render the scheme unbiased. We will proceed by first principles, as requested.\n\nFirst, let us establish the true, unperturbed fission source distribution, $S_{\\text{true}}(x)$, in the right fuel slab $\\mathcal{W} = [L+H, 2L+H]$. The source is generated by the scalar neutron flux, $\\phi(x)$, resulting from neutrons born in the left fuel slab $\\mathcal{U} = [0, L]$ that stream to the right.\n\nThe source in $\\mathcal{U}$ is a uniform density $S_{0}$. Consider a differential source element $S_{0}dx'$ located at a position $x' \\in [0, L]$. These neutrons stream to the right. According to the Beer–Lambert law, the flux of uncollided neutrons from this element is attenuated as they travel through the material. The path length within $\\mathcal{U}$ to its right boundary at $x=L$ is $L-x'$. The path in the void $\\mathcal{V}=[L, L+H]$ has length $H$, but the total cross section is $\\Sigma_t = 0$, so there is no attenuation. The path length within $\\mathcal{W}$ to a point $x \\in \\mathcal{W}$ is $x-(L+H)$.\n\nThe contribution to the scalar flux at $x$ from the source element at $x'$ is:\n$$\nd\\phi(x) = S_{0} \\exp(-\\Sigma_{t}(L-x')) \\exp(-0 \\cdot H) \\exp(-\\Sigma_{t}(x-(L+H))) dx'\n$$\nTo find the total scalar flux $\\phi(x)$ at $x \\in \\mathcal{W}$, we must integrate over all source positions $x' \\in \\mathcal{U}$:\n$$\n\\phi(x) = \\int_{0}^{L} S_{0} \\exp(-\\Sigma_{t}(L-x')) \\exp(-\\Sigma_{t}(x-L-H)) dx'\n$$\nThe term involving $x$ is constant with respect to the integration variable $x'$. We can factor it out:\n$$\n\\phi(x) = S_{0} \\exp(-\\Sigma_{t}(x-L-H)) \\int_{0}^{L} \\exp(-\\Sigma_{t}(L-x')) dx'\n$$\nThe integral evaluates to:\n$$\n\\int_{0}^{L} \\exp(-\\Sigma_{t}(L-x')) dx' = \\left[ \\frac{1}{\\Sigma_{t}} \\exp(-\\Sigma_{t}(L-x')) \\right]_{x'=0}^{L} = \\frac{1}{\\Sigma_{t}} (1 - \\exp(-\\Sigma_{t}L))\n$$\nThus, the true scalar flux in region $\\mathcal{W}$ is:\n$$\n\\phi(x) = \\frac{S_{0}}{\\Sigma_{t}} (1 - \\exp(-\\Sigma_{t}L)) \\exp(-\\Sigma_{t}(x-L-H))\n$$\nThe true fission source distribution is defined as $S_{\\text{true}}(x) = \\nu \\Sigma_{f} \\phi(x)$, which gives:\n$$\nS_{\\text{true}}(x) = \\frac{\\nu \\Sigma_{f} S_{0}}{\\Sigma_{t}} (1 - \\exp(-\\Sigma_{t}L)) \\exp(-\\Sigma_{t}(x-L-H))\n$$\n\nNext, we analyze the effect of the naive Russian roulette. A particle with weight $w$ entering the void region $\\mathcal{V}$ is killed with probability $r$ and survives with probability $1-r$. If it survives, its weight remains $w$. All tallies are proportional to the particle's weight.\n\nConsider a particle history originating from $x' \\in \\mathcal{U}$. Its contribution to the scalar flux at $x \\in \\mathcal{W}$ in the absence of roulette would be proportional to its weight, which attenuates exponentially. Let's denote the contribution to a tally at $x$ from a unit-weight source particle at $x'$ as $T_1(x, x')$. In this case, $T_1$ for the flux is $\\exp(-\\Sigma_{t}(L-x')) \\exp(-\\Sigma_{t}(x-L-H))$.\nWith the roulette, the particle's contribution is a random variable.\n- With probability $r$, the particle is killed, and its contribution is $0$.\n- With probability $1-r$, it survives with its weight unchanged, so its contribution is $T_1(x, x')$.\n\nThe expected contribution from this single history, $\\mathbb{E}[T_{\\text{RR}}(x, x')]$, is:\n$$\n\\mathbb{E}[T_{\\text{RR}}(x, x')] = T_1(x, x') \\times (1-r) + 0 \\times r = (1-r) T_1(x, x')\n$$\nThe expected scalar flux, $\\phi_{\\text{RR}}(x)$, is obtained by integrating the expected contributions over the source distribution $S_0$. Due to the linearity of expectation, integration and expectation operators commute:\n$$\n\\phi_{\\text{RR}}(x) = \\mathbb{E}\\left[\\int_{0}^{L} S_{0} T_{\\text{RR}}(x, x') dx'\\right] = \\int_{0}^{L} S_{0} \\mathbb{E}[T_{\\text{RR}}(x, x')] dx'\n$$\n$$\n\\phi_{\\text{RR}}(x) = \\int_{0}^{L} S_{0} (1-r) T_1(x, x') dx' = (1-r) \\int_{0}^{L} S_{0} T_1(x, x') dx' = (1-r)\\phi(x)\n$$\nThe problem states that Monte Carlo estimators are linear with respect to particle weight. The estimated fission source, $\\hat{S}_{\\text{RR}}(x)$, is proportional to the flux of weighted particles. The expected value of this estimator, $S_{\\text{RR}}(x) = \\mathbb{E}[\\hat{S}_{\\text{RR}}(x)]$, is therefore:\n$$\nS_{\\text{RR}}(x) = \\nu \\Sigma_{f} \\phi_{\\text{RR}}(x) = \\nu \\Sigma_{f} (1-r) \\phi(x) = (1-r) S_{\\text{true}}(x)\n$$\nThis is the expected fission source distribution under the naive roulette.\n\nThe multiplicative bias factor, $B$, is defined as the ratio of the expected estimated value to the true value:\n$$\nB = \\frac{\\mathbb{E}[\\hat{S}_{\\text{RR}}(x)]}{S_{\\text{true}}(x)} = \\frac{S_{\\text{RR}}(x)}{S_{\\text{true}}(x)} = \\frac{(1-r) S_{\\text{true}}(x)}{S_{\\text{true}}(x)} = 1-r\n$$\nThe bias factor is indeed independent of $x$.\n\nFinally, we determine the constant weight-rescaling correction factor $C$ that makes the estimator unbiased. An estimator is unbiased if its expectation equals the true value. In Monte Carlo, this is achieved by ensuring that the expected weight of a particle is conserved through statistical games like Russian roulette.\n\nLet $w$ be the weight of a particle entering the roulette region $\\mathcal{V}$. In the corrected scheme, if the particle survives, its weight is rescaled to $w' = Cw$. The probability of survival is $1-r$. The expected weight after the corrected roulette, $\\mathbb{E}[w_{\\text{corr}}]$, is:\n$$\n\\mathbb{E}[w_{\\text{corr}}] = (Cw) \\times (1-r) + 0 \\times r = Cw(1-r)\n$$\nTo conserve the expected weight, we must have $\\mathbb{E}[w_{\\text{corr}}] = w$:\n$$\nCw(1-r) = w\n$$\nSince $w > 0$ for a particle that reaches the roulette region and $r \\in (0,1)$, we can divide by $w(1-r) \\neq 0$:\n$$\nC = \\frac{1}{1-r}\n$$\nWith this correction factor, the expected contribution from any history becomes $C \\times (1-r) \\times T_1(x, x') = \\frac{1}{1-r} (1-r) T_1(x, x') = T_1(x, x')$. This recovers the true expected value, making the estimator unbiased.\n\nThe two required quantities are the bias factor $B = 1-r$ and the correction factor $C = \\frac{1}{1-r}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1-r & \\frac{1}{1-r}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "After tracking a generation of neutrons and recording the locations of new fission events, we must construct the source distribution for the next generation. In practice, this continuous distribution is often discretized onto a spatial mesh, with each mesh cell holding a fraction of the total source probability. This exercise  focuses on the construction of this mesh-based histogram and the statistical quality of the result. You will derive the variance of this common estimator, gaining insight into how the uncertainty of the fission source is quantified and how it is affected by particle weights from variance reduction schemes.",
            "id": "4247590",
            "problem": "Consider a steady-state neutron transport eigenvalue simulation in which the fission source density $S(\\mathbf{r})$ is proportional to the neutron production rate and, for sampling purposes, is normalized so that $\\int S(\\mathbf{r}) \\,\\mathrm{d}\\mathbf{r} = 1$. The spatial domain is partitioned into a mesh of disjoint cells $\\{c\\}$ that cover the domain. Define the cell probability $p_c$ as the probability that a fission birth location $\\mathbf{r}$ lies in cell $c$, i.e., $p_c = \\int_{c} S(\\mathbf{r}) \\,\\mathrm{d}\\mathbf{r}$.\n\nSuppose you obtain $N$ independent fission birth samples $\\{\\mathbf{r}_i\\}_{i=1}^{N}$ from $S(\\mathbf{r})$ in a Monte Carlo (MC) simulation, and each sampled history carries a positive weight $w_i > 0$ arising from population control or non-analog techniques. Assume the sampling across the mesh cells is multinomial with parameters $\\{p_c\\}$, and treat the weights $\\{w_i\\}$ as deterministic constants known from the simulation iteration. For a fixed cell $c$, construct a consistent mesh-based histogram estimator for $p_c$ that utilizes the indicator $\\mathbf{1}\\{\\mathbf{r}_i \\in c\\}$ and the weights $\\{w_i\\}$, starting from the definition of $p_c$ and the properties of indicators and expectations. Then, under the stated multinomial sampling assumptions, derive the variance of your estimator in closed form, expressed only in terms of $p_c$, $N$, and the weights $\\{w_i\\}$.\n\nExpress the final result for the variance as a closed-form analytic expression. No numerical evaluation is required. If you choose to interpret the result, do so in the solution, but the final answer must be the single closed-form variance expression without units.",
            "solution": "The task is to construct a consistent estimator for the cell probability $p_c$ and then derive the variance of this estimator.\n\nFirst, we construct the estimator for $p_c$. The cell probability $p_c$ is defined as the integral of the normalized fission source density $S(\\mathbf{r})$ over the volume of cell $c$:\n$$\np_c = \\int_{c} S(\\mathbf{r}) \\,\\mathrm{d}\\mathbf{r}\n$$\nThe domain of integration can be extended to all space by introducing the indicator function for cell $c$, denoted as $\\mathbf{1}\\{\\mathbf{r} \\in c\\}$, which is equal to $1$ if $\\mathbf{r}$ is in cell $c$ and $0$ otherwise. The definition of $p_c$ can then be rewritten as:\n$$\np_c = \\int_{\\text{all space}} \\mathbf{1}\\{\\mathbf{r} \\in c\\} S(\\mathbf{r}) \\,\\mathrm{d}\\mathbf{r}\n$$\nThis expression is precisely the definition of the expected value of the function $\\mathbf{1}\\{\\mathbf{r} \\in c\\}$, where $\\mathbf{r}$ is a random variable with the probability density function $S(\\mathbf{r})$. Thus, we have:\n$$\np_c = E[\\mathbf{1}\\{\\mathbf{r} \\in c\\}]\n$$\nWe are given $N$ independent samples $\\{\\mathbf{r}_i\\}_{i=1}^{N}$ drawn from $S(\\mathbf{r})$, with each sample $i$ having a deterministic positive weight $w_i > 0$. A mesh-based histogram estimator, $\\hat{p}_c$, for $p_c$ can be constructed as a weighted sum of the indicator function evaluated at each sample point. Let the estimator have the form:\n$$\n\\hat{p}_c = C \\sum_{i=1}^{N} w_i \\mathbf{1}\\{\\mathbf{r}_i \\in c\\}\n$$\nwhere $C$ is a normalization constant. For this estimator to be consistent, we require it to be unbiased, meaning its expectation must equal the true value $p_c$. Let us compute the expectation of $\\hat{p}_c$. Since the weights $\\{w_i\\}$ are treated as deterministic constants and the expectation operator is linear, we have:\n$$\nE[\\hat{p}_c] = E\\left[ C \\sum_{i=1}^{N} w_i \\mathbf{1}\\{\\mathbf{r}_i \\in c\\} \\right] = C \\sum_{i=1}^{N} w_i E[\\mathbf{1}\\{\\mathbf{r}_i \\in c\\}]\n$$\nFor each sample $\\mathbf{r}_i$ drawn from $S(\\mathbf{r})$, the expectation of the indicator is $E[\\mathbf{1}\\{\\mathbf{r}_i \\in c\\}] = p_c$. Substituting this into the equation gives:\n$$\nE[\\hat{p}_c] = C \\sum_{i=1}^{N} w_i p_c = C p_c \\left( \\sum_{i=1}^{N} w_i \\right)\n$$\nTo ensure unbiasedness, we set $E[\\hat{p}_c] = p_c$.\n$$\np_c = C p_c \\left( \\sum_{i=1}^{N} w_i \\right)\n$$\nSince $p_c$ can be non-zero, we can divide by it to solve for $C$:\n$$\n1 = C \\left( \\sum_{j=1}^{N} w_j \\right) \\implies C = \\frac{1}{\\sum_{j=1}^{N} w_j}\n$$\nTherefore, the consistent, weighted histogram estimator for $p_c$ is:\n$$\n\\hat{p}_c = \\frac{\\sum_{i=1}^{N} w_i \\mathbf{1}\\{\\mathbf{r}_i \\in c\\}}{\\sum_{j=1}^{N} w_j}\n$$\n\nNext, we derive the variance of this estimator, $\\text{Var}(\\hat{p}_c)$. Let us define the random variable $X_i = \\mathbf{1}\\{\\mathbf{r}_i \\in c\\}$ and the total weight $W_{tot} = \\sum_{j=1}^{N} w_j$. Since the weights are deterministic, $W_{tot}$ is a constant. The estimator can be written as:\n$$\n\\hat{p}_c = \\frac{1}{W_{tot}} \\sum_{i=1}^{N} w_i X_i\n$$\nThe variance is then:\n$$\n\\text{Var}(\\hat{p}_c) = \\text{Var}\\left( \\frac{1}{W_{tot}} \\sum_{i=1}^{N} w_i X_i \\right)\n$$\nUsing the property $\\text{Var}(aY) = a^2 \\text{Var}(Y)$ for a constant $a$, we can factor out the constant term $1/W_{tot}$:\n$$\n\\text{Var}(\\hat{p}_c) = \\frac{1}{W_{tot}^2} \\text{Var}\\left( \\sum_{i=1}^{N} w_i X_i \\right)\n$$\nThe problem states that the samples $\\{\\mathbf{r}_i\\}$ are independent. Consequently, the random variables $\\{X_i\\}$ are also independent. For a sum of independent random variables, the variance of the sum is the sum of the variances. Furthermore, since the weights $\\{w_i\\}$ are constants, we use the property $\\text{Var}(\\sum a_i Y_i) = \\sum a_i^2 \\text{Var}(Y_i)$ for independent $Y_i$:\n$$\n\\text{Var}(\\hat{p}_c) = \\frac{1}{W_{tot}^2} \\sum_{i=1}^{N} \\text{Var}(w_i X_i) = \\frac{1}{W_{tot}^2} \\sum_{i=1}^{N} w_i^2 \\text{Var}(X_i)\n$$\nNow, we must find the variance of $X_i$. The random variable $X_i = \\mathbf{1}\\{\\mathbf{r}_i \\in c\\}$ can take the value $1$ with probability $P(\\mathbf{r}_i \\in c) = p_c$, and the value $0$ with probability $1 - p_c$. This is a Bernoulli distribution with parameter $p_c$. The variance of a Bernoulli-distributed random variable is given by $p(1 - p)$. Therefore, for all $i$:\n$$\n\\text{Var}(X_i) = p_c(1 - p_c)\n$$\nSubstituting this result back into our expression for the variance of the estimator:\n$$\n\\text{Var}(\\hat{p}_c) = \\frac{1}{W_{tot}^2} \\sum_{i=1}^{N} w_i^2 [p_c(1 - p_c)]\n$$\nThe term $p_c(1 - p_c)$ is constant with respect to the summation index $i$, so it can be factored out of the sum:\n$$\n\\text{Var}(\\hat{p}_c) = \\frac{p_c(1 - p_c)}{W_{tot}^2} \\sum_{i=1}^{N} w_i^2\n$$\nFinally, substituting the definition of $W_{tot}$ back into the expression, we obtain the closed-form expression for the variance of the estimator in terms of $p_c$, $N$, and the weights $\\{w_i\\}$:\n$$\n\\text{Var}(\\hat{p}_c) = \\frac{p_c(1 - p_c) \\sum_{i=1}^{N} w_i^2}{\\left(\\sum_{j=1}^{N} w_j\\right)^2}\n$$\nThis is the final analytical expression for the variance of the weighted histogram estimator for the cell probability $p_c$.",
            "answer": "$$\n\\boxed{\\frac{p_c(1 - p_c) \\sum_{i=1}^{N} w_i^2}{\\left(\\sum_{j=1}^{N} w_j\\right)^2}}\n$$"
        }
    ]
}