{
    "hands_on_practices": [
        {
            "introduction": "在应用源偏倚技术之前，首要任务是精确地构建一个基准，即“模拟”源分布的数学描述。本练习将引导你从源粒子独立的空间、能量及方向分量出发，推导其联合概率密度函数（PDF）。掌握此基础是正确定义模拟仿真、并为后续所有偏倚方案建立参照系的必要前提。",
            "id": "4250366",
            "problem": "考虑一个蒙特卡罗（MC）中子输运模拟，其中中子在一个有界区域内的空间源中产生，其方向是各向同性的，能量谱是独立的。目标是为初始源状态 $(\\mathbf{r},E,\\Omega)$ 的抽样构建模拟联合概率密度函数（PDF），并论证方向分量的各向同性因子。从以下基本要求出发：(i) 联合PDF在整个抽样域上的积分为 $1$；(ii) 在模拟抽样下，源的位置、能量和方向是相互独立的；(iii) 对于各向同性源，方向分布在单位球面立体角上是均匀的。\n\n假设源占据一个以原点为中心、半径为 $R$ 的球形体积 $V$。空间源强度仅依赖于径向坐标 $r=|\\mathbf{r}|$，并由 $S(\\mathbf{r})=S_{0}\\exp(-\\gamma r)$ 给出，其中 $0 \\le r \\le R$，常数 $S_{0}0$ 且 $\\gamma0$。能量谱采用有效温度为 $T0$ 的麦克斯韦-玻尔兹曼分布，因此对于 $E\\ge 0$ 的能量PDF为\n$$\n\\chi(E)=\\frac{2}{\\sqrt{\\pi}}\\,\\frac{E^{1/2}}{T^{3/2}}\\,\\exp\\!\\left(-\\frac{E}{T}\\right).\n$$\n假设方向在三维空间中是各向同性的。\n\n仅使用PDF的归一化条件、模拟抽样下 $(\\mathbf{r},E,\\Omega)$ 的独立性以及各向同性的立体角均匀性，推导在 $V\\times[0,\\infty)\\times\\mathbb{S}^{2}$ 上的模拟联合PDF $p(\\mathbf{r},E,\\Omega)$ 的闭合形式表达式，该表达式用 $r$、$E$、$\\Omega$ 以及参数 $R$、$\\gamma$ 和 $T$ 表示。你的最终答案必须是 $p(\\mathbf{r},E,\\Omega)$ 的单个解析表达式。\n\n不需要进行数值计算或四舍五入。最终表达式中不要包含任何物理单位。",
            "solution": "该问题被评估为有效，因为其具有科学依据、问题明确且客观。它展示了粒子输运蒙特卡罗方法领域中的一个标准问题，提供了所有必要信息，且没有内部矛盾。\n\n任务是推导源中子初始状态抽样的联合概率密度函数（PDF）$p(\\mathbf{r}, E, \\Omega)$，其中 $\\mathbf{r}$ 是位置，$E$ 是能量，$\\Omega$ 是发射方向。\n\n推导从所提供的基本要求开始：\n(i) 联合PDF必须归一化为1：$\\int_{V} d\\mathbf{r} \\int_{0}^{\\infty} dE \\int_{\\mathbb{S}^2} d\\Omega \\, p(\\mathbf{r}, E, \\Omega) = 1$。\n(ii) 在模拟抽样下，源变量 $(\\mathbf{r}, E, \\Omega)$ 是相互独立的。\n(iii) 方向分布是各向同性的，意味着它在立体角上是均匀的。\n\n根据要求(ii)，联合PDF可以表示为位置、能量和方向的各自PDF的乘积：\n$$\np(\\mathbf{r}, E, \\Omega) = p_{\\mathbf{r}}(\\mathbf{r}) \\, p_E(E) \\, p_{\\Omega}(\\Omega)\n$$\n这些分量PDF中的每一个都必须在其各自的域上进行归一化。我们现在来推导每个分量。\n\n**1. 方向PDF, $p_{\\Omega}(\\Omega)$**\n\n要求(iii)指出发射方向是各向同性的，这意味着发射到任何微分立体角 $d\\Omega$ 内的概率是相同的，与方向 $\\Omega$ 无关。因此，PDF $p_{\\Omega}(\\Omega)$ 必须是一个常数，我们称之为 $C_{\\Omega}$。这个常数由PDF的归一化条件确定，这是要求(i)的一个具体实例：\n$$\n\\int_{\\mathbb{S}^2} p_{\\Omega}(\\Omega) \\, d\\Omega = 1\n$$\n其中 $\\mathbb{S}^2$ 代表单位球面的表面。代入 $p_{\\Omega}(\\Omega) = C_{\\Omega}$：\n$$\n\\int_{\\mathbb{S}^2} C_{\\Omega} \\, d\\Omega = C_{\\Omega} \\int_{\\mathbb{S}^2} d\\Omega = 1\n$$\n整个单位球面上的微分立体角积分是球体的总立体角，即 $4\\pi$ 球面度。\n$$\nC_{\\Omega} (4\\pi) = 1 \\implies C_{\\Omega} = \\frac{1}{4\\pi}\n$$\n因此，“各向同性因子”就是方向PDF本身的值。对于任何方向 $\\Omega$，PDF为：\n$$\np_{\\Omega}(\\Omega) = \\frac{1}{4\\pi}\n$$\n\n**2. 能量PDF, $p_E(E)$**\n\n问题明确提供了归一化的能量相关PDF, $\\chi(E)$。因此，我们有：\n$$\np_E(E) = \\chi(E) = \\frac{2}{\\sqrt{\\pi}}\\,\\frac{E^{1/2}}{T^{3/2}}\\,\\exp\\left(-\\frac{E}{T}\\right) \\quad \\text{for } E \\ge 0\n$$\n此函数以PDF形式给出，并且在其定义域 $E \\in [0, \\infty)$ 上确实归一化为1。\n\n**3. 空间PDF, $p_{\\mathbf{r}}(\\mathbf{r})$**\n\n问题给出源强度为 $S(\\mathbf{r}) = S_0 \\exp(-\\gamma r)$，其中 $r=|\\mathbf{r}| \\in [0, R]$。空间PDF $p_{\\mathbf{r}}(\\mathbf{r})$ 必须与此强度成正比。要成为一个有效的PDF，它必须在源体积 $V$（一个半径为 $R$ 的球体）上进行归一化。\n$$\np_{\\mathbf{r}}(\\mathbf{r}) = \\frac{S(\\mathbf{r})}{\\int_V S(\\mathbf{r'}) \\, d\\mathbf{r'}} = \\frac{S_0 \\exp(-\\gamma r)}{\\int_V S_0 \\exp(-\\gamma r') \\, d\\mathbf{r'}} = \\frac{\\exp(-\\gamma r)}{\\int_V \\exp(-\\gamma r') \\, d\\mathbf{r'}}\n$$\n归一化常数是分母中的积分。我们在球坐标中计算此积分，其中 $d\\mathbf{r'} = (r')^2 \\sin\\theta' \\, dr' \\, d\\theta' \\, d\\phi'$。\n$$\n\\int_V \\exp(-\\gamma r') \\, d\\mathbf{r'} = \\int_0^{2\\pi} d\\phi' \\int_0^{\\pi} \\sin\\theta' \\, d\\theta' \\int_0^R (r')^2 \\exp(-\\gamma r') \\, dr'\n$$\n角度积分是标准的：\n$$\n\\int_0^{2\\pi} d\\phi' = 2\\pi \\quad \\text{and} \\quad \\int_0^{\\pi} \\sin\\theta' \\, d\\theta' = [-\\cos\\theta']_0^{\\pi} = 2\n$$\n角度积分的乘积是 $4\\pi$。归一化积分简化为：\n$$\n\\int_V \\exp(-\\gamma r') \\, d\\mathbf{r'} = 4\\pi \\int_0^R r^2 \\exp(-\\gamma r) \\, dr\n$$\n剩下的径向积分通过分部积分法求解。不定积分由下式给出：\n$$\n\\int r^2 \\exp(-\\gamma r) \\, dr = -\\frac{\\exp(-\\gamma r)}{\\gamma} \\left( r^2 + \\frac{2r}{\\gamma} + \\frac{2}{\\gamma^2} \\right)\n$$\n在极限 $r=0$ 和 $r=R$ 处计算该式：\n$$\n\\int_0^R r^2 \\exp(-\\gamma r) \\, dr = \\left[ -\\frac{\\exp(-\\gamma r)}{\\gamma} \\left( r^2 + \\frac{2r}{\\gamma} + \\frac{2}{\\gamma^2} \\right) \\right]_0^R\n$$\n$$\n= \\left( -\\frac{\\exp(-\\gamma R)}{\\gamma} \\left( R^2 + \\frac{2R}{\\gamma} + \\frac{2}{\\gamma^2} \\right) \\right) - \\left( -\\frac{\\exp(0)}{\\gamma} \\left( 0 + 0 + \\frac{2}{\\gamma^2} \\right) \\right)\n$$\n$$\n= \\frac{2}{\\gamma^3} - \\exp(-\\gamma R) \\left( \\frac{R^2}{\\gamma} + \\frac{2R}{\\gamma^2} + \\frac{2}{\\gamma^3} \\right)\n$$\n$$\n= \\frac{1}{\\gamma^3} \\left[ 2 - (\\gamma^2 R^2 + 2\\gamma R + 2)\\exp(-\\gamma R) \\right]\n$$\n我们称完整的归一化积分为 $N_r = \\int_V \\exp(-\\gamma r') \\, d\\mathbf{r'}$。\n$$\nN_r = \\frac{4\\pi}{\\gamma^3} \\left[ 2 - (\\gamma^2 R^2 + 2\\gamma R + 2)\\exp(-\\gamma R) \\right]\n$$\n因此，空间PDF为：\n$$\np_{\\mathbf{r}}(\\mathbf{r}) = \\frac{\\exp(-\\gamma r)}{N_r} = \\frac{\\gamma^3 \\exp(-\\gamma r)}{4\\pi \\left[ 2 - (\\gamma^2 R^2 + 2\\gamma R + 2)\\exp(-\\gamma R) \\right]} \\quad \\text{for } r \\le R\n$$\n\n**4. 组装联合PDF**\n\n最后，我们将三个分量PDF组合起来，得到联合PDF $p(\\mathbf{r}, E, \\Omega)$：\n$$\np(\\mathbf{r}, E, \\Omega) = p_{\\mathbf{r}}(\\mathbf{r}) \\, p_E(E) \\, p_{\\Omega}(\\Omega)\n$$\n$$\np(\\mathbf{r}, E, \\Omega) = \\left( \\frac{\\gamma^3 \\exp(-\\gamma r)}{4\\pi \\left[ 2 - (\\gamma^2 R^2 + 2\\gamma R + 2)\\exp(-\\gamma R) \\right]} \\right) \\left( \\frac{2 E^{1/2} \\exp(-E/T)}{\\sqrt{\\pi} T^{3/2}} \\right) \\left( \\frac{1}{4\\pi} \\right)\n$$\n合并常数项和指数项，得到最终表达式：\n$$\np(\\mathbf{r}, E, \\Omega) = \\frac{2\\gamma^3}{16\\pi^2 \\sqrt{\\pi} T^{3/2} \\left[ 2 - (\\gamma^2 R^2 + 2\\gamma R + 2)\\exp(-\\gamma R) \\right]} E^{1/2} \\exp\\left(-\\gamma r - \\frac{E}{T}\\right)\n$$\n$$\np(\\mathbf{r}, E, \\Omega) = \\frac{\\gamma^3}{8\\pi^{5/2} T^{3/2} \\left[ 2 - (\\gamma^2 R^2 + 2\\gamma R + 2)\\exp(-\\gamma R) \\right]} E^{1/2} \\exp\\left(-\\gamma r - \\frac{E}{T}\\right)\n$$\n该表达式是在域 $V \\times [0, \\infty) \\times \\mathbb{S}^2$ 上，源状态 $(\\mathbf{r}, E, \\Omega)$ 的模拟联合PDF，其中 $r=|\\mathbf{r}|$。它纯粹用状态变量和给定参数表示。",
            "answer": "$$\n\\boxed{\\frac{\\gamma^3 E^{1/2} \\exp\\left(-\\gamma r - \\frac{E}{T}\\right)}{8 \\pi^{5/2} T^{3/2} \\left[ 2 - \\left(\\gamma^2 R^2 + 2\\gamma R + 2\\right)\\exp(-\\gamma R) \\right]}}\n$$"
        },
        {
            "introduction": "在建立了模拟源的基准后，下一步是探索如何主动地改变抽样过程以提升计算效率。本练习将通过一个经典的粒子穿透问题，让你亲手实践指数变换偏倚方法 。你将推导出能够使方差最小化的最优偏倚参数，从而深刻体会到重要性抽样在解决稀有事件问题中的核心作用与巨大威力。",
            "id": "4250382",
            "problem": "考虑一束单能中性粒子束垂直入射到一个厚度为 $L$、宏观总截面为 $\\Sigma_{t}$ 的均匀纯吸收板上。假设没有散射，也没有内源。每个历史在入射面 $x=0$ 处发射一个权重为1、沿 $+x$ 方向直线运动的粒子。到第一次碰撞的自由程距离 $s$ 服从由比尔-朗伯定律所蕴含的指数衰减定律，即类比概率密度函数 (PDF) 为 $f(s) = \\Sigma_{t} \\exp(-\\Sigma_{t} s)$，$s \\geq 0$。在出射面 $x=L$ 处的表面通量记录当且仅当抽样得到的 $s$ 超过 $L$（即粒子未经碰撞而出射）时，才记有贡献，否则记录的贡献为零。\n\n您将比较用于出射面通量记录的两种无偏蒙特卡罗 (MC) 估计量的方差，然后推导使重要性抽样估计量方差最小的偏倚参数：\n- 类比估计量，在 $f(s)$ 分布下记录得分为 $Y = \\mathbb{I}[s \\geq L]$，其中 $\\mathbb{I}[\\cdot]$ 表示指示函数。\n- 指数变换重要性抽样估计量，它从偏倚概率密度函数 $g_{q}(s) = (\\Sigma_{t} - q)\\exp\\!\\big[-(\\Sigma_{t} - q)s\\big]$（$s \\geq 0$，其中 $q$ 满足 $0  q  \\Sigma_{t}$）中抽样 $s$，并记录得分为 $X_{q} = w_{q}(s)\\,\\mathbb{I}[s \\geq L]$，其中权重是似然比 $w_{q}(s) = \\dfrac{f(s)}{g_{q}(s)} = \\dfrac{\\Sigma_{t}}{\\Sigma_{t} - q}\\exp(-q s)$。\n\n任务：\n- 从指数衰减定律和上述定义出发，推导出射面通量的类比估计量 $Y$ 的均值和方差。\n- 证明重要性抽样估计量 $X_{q}$ 的无偏性，并推导其方差作为 $q$、$\\Sigma_{t}$ 和 $L$ 的函数。\n- 通过对 $q$ 在允许区间 $0  q  \\Sigma_{t}$ 上进行直接最小化，推导出使 $X_{q}$ 方差最小的关于 $q$ 的条件，并将最优值表示为无量纲比 $r^{\\star} = q^{\\star}/\\Sigma_{t}$，用无量纲光学厚度 $\\tau = \\Sigma_{t} L$ 表示。\n\n答案规格：\n- 将最终答案报告为关于 $\\tau$ 的单一闭式解析表达式。\n- 无需进行数值计算，最终答案中不应包含任何物理单位。",
            "solution": "在尝试任何解答之前，需对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **物理系统**：一束单能中性粒子束垂直入射到一个均匀纯吸收板上。\n- **板的属性**：厚度 $L$，宏观总截面 $\\Sigma_{t}$。\n- **粒子动力学**：初始位置 $x=0$，初始方向为 $+x$，直线运动。无散射，无内源。\n- **类比抽样**：自由程距离 $s$ 从概率密度函数 (PDF) $f(s) = \\Sigma_{t} \\exp(-\\Sigma_{t} s)$（$s \\geq 0$）中抽样。\n- **类比估计量**：$Y = \\mathbb{I}[s \\geq L]$，其中 $\\mathbb{I}[\\cdot]$ 是粒子在 $x=L$ 处出射事件的指示函数。\n- **偏倚抽样**：另一种抽样方法使用偏倚概率密度函数 $g_{q}(s) = (\\Sigma_{t} - q)\\exp\\!\\big[-(\\Sigma_{t} - q)s\\big]$（$s \\geq 0$）。\n- **偏倚参数**：$q$ 是一个满足约束条件 $0  q  \\Sigma_{t}$ 的参数。\n- **重要性抽样估计量**：$X_{q} = w_{q}(s)\\,\\mathbb{I}[s \\geq L]$。\n- **统计权重**：权重是似然比 $w_{q}(s) = \\dfrac{f(s)}{g_{q}(s)} = \\dfrac{\\Sigma_{t}}{\\Sigma_{t} - q}\\exp(-q s)$。\n- **任务**：\n    1.  推导类比估计量 $Y$ 的均值和方差。\n    2.  证明重要性抽样估计量 $X_{q}$ 的无偏性，并推导其方差作为 $q$、$\\Sigma_{t}$ 和 $L$ 的函数。\n    3.  求出使 $X_{q}$ 方差最小的偏倚参数最优值 $q^{\\star}$。将结果表示为无量纲比 $r^{\\star} = q^{\\star}/\\Sigma_{t}$，用无量纲光学厚度 $\\tau = \\Sigma_{t} L$ 表示。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题在根本上是合理的。它描述了蒙特卡罗方差缩减技术（特别是指数变换或路径拉伸）在粒子输运理论中一个典型问题上的经典应用。指数衰减定律、估计量的定义以及权重函数在该领域都是标准且正确的。\n- **适定性**：该问题是适定的。目标陈述清晰：推导均值和方差的表达式，然后最小化偏倚估计量的方差。所有必要的函数和参数（$f(s)$, $g_q(s)$, $Y$, $X_q$）都已精确定义。约束条件 $0  q  \\Sigma_{t}$ 确保了偏倚概率密度函数 $g_q(s)$ 是良定义的（即其指数前因子 $\\Sigma_t - q$ 为正）且可归一化。\n- **客观性**：该问题以客观的数学语言陈述，没有歧义或主观论断。\n\n### 步骤 3：结论与操作\n该问题有效，因为它科学合理、适定且客观。将提供完整的解答。\n\n### 解答推导\n\n分析按顺序处理三个任务中的每一个。\n\n**1. 类比估计量 $Y$ 的均值和方差**\n\n类比估计量为 $Y = \\mathbb{I}[s \\geq L]$，其中随机变量 $s$ 从类比概率密度函数 $f(s) = \\Sigma_{t} \\exp(-\\Sigma_{t} s)$ 中抽取。$Y$ 是一个伯努利随机变量。\n\n$Y$ 的均值（期望值）是事件 $\\{s \\geq L\\}$ 的概率。\n$$E[Y] = P(s \\geq L) = \\int_L^{\\infty} f(s) \\, ds = \\int_L^{\\infty} \\Sigma_{t} \\exp(-\\Sigma_{t} s) \\, ds$$\n$$E[Y] = \\left[ -\\exp(-\\Sigma_{t} s) \\right]_L^{\\infty} = 0 - (-\\exp(-\\Sigma_t L)) = \\exp(-\\Sigma_t L)$$\n这是无碰撞穿透的物理概率，因此该估计量是无偏的。\n\n$Y$ 的方差由 $\\text{Var}(Y) = E[Y^2] - (E[Y])^2$ 给出。由于 $Y$ 是一个指示函数，其值要么是 $0$ 要么是 $1$，这意味着 $Y^2 = Y$。\n因此，$E[Y^2] = E[Y] = \\exp(-\\Sigma_t L)$。\n方差为：\n$$\\text{Var}(Y) = \\exp(-\\Sigma_t L) - (\\exp(-\\Sigma_t L))^2 = \\exp(-\\Sigma_t L) \\left(1 - \\exp(-\\Sigma_t L)\\right)$$\n\n**2. 重要性抽样估计量 $X_q$ 的无偏性和方差**\n\n重要性抽样估计量为 $X_q = w_q(s) \\mathbb{I}[s \\geq L]$，其中 $s$ 现在从偏倚概率密度函数 $g_q(s)$ 中抽样。期望是关于 $g_q(s)$ 计算的，记为 $E_q[\\cdot]$。\n\n为了证明无偏性，我们必须证明 $E_q[X_q] = E[Y]$。\n$$E_q[X_q] = \\int_0^{\\infty} X_q(s) g_q(s) \\, ds = \\int_0^{\\infty} w_q(s) \\mathbb{I}[s \\geq L] g_q(s) \\, ds$$\n指示函数将积分下限限制为 $L$。代入 $w_q(s) = f(s)/g_q(s)$：\n$$E_q[X_q] = \\int_L^{\\infty} \\frac{f(s)}{g_q(s)} g_q(s) \\, ds = \\int_L^{\\infty} f(s) \\, ds = E[Y] = \\exp(-\\Sigma_t L)$$\n因此，对于任何有效的 $q$ 值，估计量 $X_q$ 都是无偏的。\n\n$X_q$ 的方差是 $\\text{Var}_q(X_q) = E_q[X_q^2] - (E_q[X_q])^2$。第二项是 $(E[Y])^2 = \\exp(-2\\Sigma_t L)$。我们需要计算二阶矩 $E_q[X_q^2]$。\n$$E_q[X_q^2] = \\int_0^{\\infty} (w_q(s) \\mathbb{I}[s \\geq L])^2 g_q(s) \\, ds = \\int_L^{\\infty} w_q^2(s) g_q(s) \\, ds$$\n我们来分析被积函数：\n$$w_q^2(s) g_q(s) = \\left(\\frac{f(s)}{g_q(s)}\\right)^2 g_q(s) = \\frac{f^2(s)}{g_q(s)}$$\n代入概率密度函数的具体形式：\n$$f^2(s) = \\Sigma_t^2 \\exp(-2\\Sigma_t s)$$\n$$g_q(s) = (\\Sigma_t - q) \\exp(-(\\Sigma_t - q)s)$$\n被积函数变为：\n$$\\frac{f^2(s)}{g_q(s)} = \\frac{\\Sigma_t^2 \\exp(-2\\Sigma_t s)}{(\\Sigma_t - q) \\exp(-(\\Sigma_t - q)s)} = \\frac{\\Sigma_t^2}{\\Sigma_t - q} \\exp(-(2\\Sigma_t - (\\Sigma_t - q))s) = \\frac{\\Sigma_t^2}{\\Sigma_t - q} \\exp(-(\\Sigma_t + q)s)$$\n现在，我们将此表达式从 $L$ 积分到 $\\infty$：\n$$E_q[X_q^2] = \\int_L^{\\infty} \\frac{\\Sigma_t^2}{\\Sigma_t - q} \\exp(-(\\Sigma_t + q)s) \\, ds = \\frac{\\Sigma_t^2}{\\Sigma_t - q} \\left[ \\frac{\\exp(-(\\Sigma_t + q)s)}{-(\\Sigma_t + q)} \\right]_L^{\\infty}$$\n$$E_q[X_q^2] = \\frac{\\Sigma_t^2}{\\Sigma_t - q} \\left( 0 - \\frac{\\exp(-(\\Sigma_t + q)L)}{-(\\Sigma_t + q)} \\right) = \\frac{\\Sigma_t^2}{(\\Sigma_t - q)(\\Sigma_t + q)} \\exp(-(\\Sigma_t + q)L)$$\n$$E_q[X_q^2] = \\frac{\\Sigma_t^2}{\\Sigma_t^2 - q^2} \\exp(-(\\Sigma_t + q)L)$$\n方差则为：\n$$\\text{Var}_q(X_q) = \\frac{\\Sigma_t^2}{\\Sigma_t^2 - q^2} \\exp(-(\\Sigma_t + q)L) - \\exp(-2\\Sigma_t L)$$\n\n**3. $X_q$ 方差的最小化**\n\n为了找到使 $\\text{Var}_q(X_q)$ 最小化的最优参数 $q^{\\star}$，我们需要在区间 $(0, \\Sigma_t)$ 中找到使 $\\frac{d}{dq}\\text{Var}_q(X_q) = 0$ 的 $q$ 值。由于项 $(E_q[X_q])^2 = \\exp(-2\\Sigma_t L)$ 与 $q$ 无关，最小化方差等价于最小化二阶矩 $E_q[X_q^2]$。\n令 $V_2(q) = E_q[X_q^2] = \\frac{\\Sigma_t^2}{\\Sigma_t^2 - q^2} \\exp(-(\\Sigma_t + q)L)$。为了简化求导，我们可以最小化其自然对数 $\\ln(V_2(q))$，因为对数是单调递增函数。\n$$\\ln(V_2(q)) = \\ln(\\Sigma_t^2) - \\ln(\\Sigma_t^2 - q^2) - (\\Sigma_t + q)L$$\n对 $q$ 求导：\n$$\\frac{d}{dq}\\ln(V_2(q)) = 0 - \\frac{-2q}{\\Sigma_t^2 - q^2} - L = \\frac{2q}{\\Sigma_t^2 - q^2} - L$$\n令导数为零以求极值：\n$$\\frac{2q}{\\Sigma_t^2 - q^2} = L$$\n$$2q = L(\\Sigma_t^2 - q^2) \\implies Lq^2 + 2q - L\\Sigma_t^2 = 0$$\n这是一个关于 $q$ 的二次方程。我们使用二次方程求根公式 $q = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解 $q$，其中 $a=L$，$b=2$，$c=-L\\Sigma_t^2$：\n$$q = \\frac{-2 \\pm \\sqrt{2^2 - 4(L)(-L\\Sigma_t^2)}}{2L} = \\frac{-2 \\pm \\sqrt{4 + 4L^2\\Sigma_t^2}}{2L} = \\frac{-1 \\pm \\sqrt{1 + L^2\\Sigma_t^2}}{L}$$\n我们有两个可能的 $q$ 解。我们必须选择满足给定约束条件 $0  q  \\Sigma_t$ 的那个解。\n解 $q = \\frac{-1 - \\sqrt{1 + L^2\\Sigma_t^2}}{L}$ 总是负的（因为 $L0$），所以舍弃。\n另一个解是 $q^{\\star} = \\frac{-1 + \\sqrt{1 + L^2\\Sigma_t^2}}{L}$。由于 $\\sqrt{1+L^2\\Sigma_t^2} > 1$，这个 $q^{\\star}$ 的值是正的。我们还必须验证 $q^{\\star}  \\Sigma_t$：\n$$\\frac{-1 + \\sqrt{1 + L^2\\Sigma_t^2}}{L}  \\Sigma_t \\implies -1 + \\sqrt{1 + L^2\\Sigma_t^2}  L\\Sigma_t \\implies \\sqrt{1 + L^2\\Sigma_t^2}  1 + L\\Sigma_t$$\n由于当 $L0$ 且 $\\Sigma_t0$ 时，不等式两边都为正，我们可以对它们进行平方而不改变不等关系：\n$$1 + L^2\\Sigma_t^2  (1 + L\\Sigma_t)^2 = 1 + 2L\\Sigma_t + L^2\\Sigma_t^2$$\n$$0  2L\\Sigma_t$$\n这个不等式总是成立的，所以 $q^{\\star}$ 在有效范围 $(0, \\Sigma_t)$ 内。$\\ln(V_2(q))$ 的二阶导数是 $\\frac{2(\\Sigma_t^2+q^2)}{(\\Sigma_t^2-q^2)^2}$，对于 $q \\in (0, \\Sigma_t)$，该值为正，证实了 $q^{\\star}$ 对应一个最小值。\n\n最后一步是将结果表示为无量纲比 $r^{\\star} = q^{\\star}/\\Sigma_t$，用光学厚度 $\\tau = \\Sigma_t L$ 表示。\n$$r^{\\star} = \\frac{q^{\\star}}{\\Sigma_t} = \\frac{1}{\\Sigma_t} \\left( \\frac{-1 + \\sqrt{1 + L^2\\Sigma_t^2}}{L} \\right) = \\frac{-1 + \\sqrt{1 + (L\\Sigma_t)^2}}{L\\Sigma_t}$$\n代入 $\\tau = \\Sigma_t L$：\n$$r^{\\star} = \\frac{-1 + \\sqrt{1 + \\tau^2}}{\\tau}$$\n这就是最优偏倚参数比的最终表达式。",
            "answer": "$$\n\\boxed{\\frac{\\sqrt{1+\\tau^2}-1}{\\tau}}\n$$"
        },
        {
            "introduction": "偏倚是强大的工具，但其有效性并非无限，理解其局限性与理解其能力同等重要。本练习旨在揭示一个关键的实际问题：源偏倚的收益递减效应 。你将通过推导综合了方差与计算成本的品质因数（FOM）随偏倚强度变化的函数关系，学会量化分析为何过度偏倚反而会降低整体计算效率，这是设计高效、稳健蒙特卡罗模拟方案时必须掌握的高级技能。",
            "id": "4250409",
            "problem": "考虑一个用于蒙特卡罗（MC）核反应堆模拟中源偏倚的简化但科学上一致的模型，以估计由从两个不相交的相空间区域发射的源粒子引起的标量响应。设原始源概率分布将概率 $p_{A}$ 分配给区域 $A$，将概率 $p_{B}$ 分配给区域 $B$，其中 $p_{A} + p_{B} = 1$ 且 $p_{A}, p_{B} \\in (0,1)$。从区域 $i \\in \\{A,B\\}$ 抽样的单个源历史对统计量贡献一个确定性的非负得分 $g_{i}$，代表从该区域开始的一个历史对目标响应的期望贡献。设真实平均响应为 $\\mu = p_{A} g_{A} + p_{B} g_{B}$。\n\n我们通过一个由强度参数 $b \\in [0,1]$ 索引的混合重要性抽样构造来引入源偏倚。偏倚源分布 $q(\\cdot \\, ; b)$ 将概率质量从原始源重新分配到区域 $A$，如下所示：\n$$\nq_{A}(b) = p_{A} + b \\left(1 - p_{A}\\right), \\qquad q_{B}(b) = p_{B} - b p_{B} = p_{B} \\left(1 - b\\right),\n$$\n对于所有 $b \\in [0,1]$，该分布满足 $q_{A}(b) + q_{B}(b) = 1$。源粒子从 $q(\\cdot \\, ; b)$ 中抽样，并通过标准重要性因子 $w_{i}(b) = \\frac{p_{i}}{q_{i}(b)}$ 进行重新加权，以保持估计量的无偏性。假设每个偏倚源历史产生一个无量纲计算成本 $C(b)$，其模型为：\n$$\nC(b) = C_{0} \\left(1 + \\gamma b\\right),\n$$\n其中 $C_{0}  0$ 是原始源下每个源历史的基准成本，而 $\\gamma \\geq 0$ 量化了实现偏倚抽样机制的开销。计算时间以每个历史的基准时间为单位进行度量，因此下面定义的品质因子（FOM）是无量纲的。\n\n从无偏加权估计量、其在偏倚分布下的方差以及标准 MC 效率度量——品质因子（FOM）的定义（定义为相对误差平方与计算时间乘积的倒数）出发，推导效率曲线 $\\mathrm{FOM}(b)$ 作为 $b$, $p_{A}$, $p_{B}$, $g_{A}$, $g_{B}$, $C_{0}$ 和 $\\gamma$ 的函数的闭式解析表达式。你的推导必须从重要性抽样的第一性原理和测度变换下方差的定义开始，并且必须明确展示当 $b \\to 1$ 时收益递减是如何产生的。\n\n将你的最终答案表示为关于 $b$, $p_{A}$, $p_{B}$, $g_{A}$, $g_{B}$, $C_{0}$ 和 $\\gamma$ 的 $\\mathrm{FOM}(b)$ 的单一简化解析表达式。无需进行数值计算。最终答案必须是无量纲的。无需进行四舍五入。",
            "solution": "我们从蒙特卡罗（MC）估计中重要性抽样的基本框架开始。设原始源分布是两个区域上的概率质量函数 $p_{A}$ 和 $p_{B}$，偏倚分布为 $q_{A}(b)$ 和 $q_{B}(b)$，且 $q_{A}(b) + q_{B}(b) = 1$。在偏倚分布下保持无偏性的单历史估计量使用重要性权重 $w_{i}(b) = \\frac{p_{i}}{q_{i}(b)}$ 乘以得分 $g_{i}$，因为在偏倚分布下的期望满足：\n$$\n\\mathbb{E}_{q}\\!\\left[w(b) \\, g\\right] = \\sum_{i \\in \\{A,B\\}} q_{i}(b) \\, \\frac{p_{i}}{q_{i}(b)} \\, g_{i} = \\sum_{i \\in \\{A,B\\}} p_{i} g_{i} = \\mu.\n$$\n因此，对于所有 $b \\in [0,1]$，估计量保持无偏。在偏倚分布下单历史加权估计量的方差由 $q$ 下的二阶矩减去均值的平方给出：\n$$\n\\mathrm{Var}_{q}\\!\\left[w(b) \\, g\\right] = \\mathbb{E}_{q}\\!\\left[\\left(w(b) \\, g\\right)^{2}\\right] - \\mu^{2}.\n$$\n由于 $w(b) \\, g$ 以概率 $q_{A}(b)$ 取值 $\\frac{p_{A}}{q_{A}(b)} g_{A}$，以概率 $q_{B}(b)$ 取值 $\\frac{p_{B}}{q_{B}(b)} g_{B}$，因此二阶矩计算为：\n$$\n\\mathbb{E}_{q}\\!\\left[\\left(w(b) \\, g\\right)^{2}\\right]\n= q_{A}(b) \\left(\\frac{p_{A}}{q_{A}(b)} g_{A}\\right)^{2} + q_{B}(b) \\left(\\frac{p_{B}}{q_{B}(b)} g_{B}\\right)^{2}\n= \\frac{p_{A}^{2} g_{A}^{2}}{q_{A}(b)} + \\frac{p_{B}^{2} g_{B}^{2}}{q_{B}(b)}.\n$$\n因此，偏倚分布下的单历史方差为：\n$$\n\\mathrm{Var}_{q}\\!\\left[w(b) \\, g\\right] = \\frac{p_{A}^{2} g_{A}^{2}}{q_{A}(b)} + \\frac{p_{B}^{2} g_{B}^{2}}{q_{B}(b)} - \\mu^{2},\n$$\n其中 $\\mu = p_{A} g_{A} + p_{B} g_{B}$。\n\nMC 的品质因子（FOM），定义为相对误差平方与计算时间乘积的倒数，可以用每个历史的量来表示。对于 $N$ 个独立历史，样本均值的方差为 $\\mathrm{Var}_{q}\\!\\left[w(b) \\, g\\right] / N$，所以相对误差的平方是：\n$$\nR^{2}(b) = \\frac{\\mathrm{Var}_{q}\\!\\left[w(b) \\, g\\right]}{N \\, \\mu^{2}}.\n$$\n如果每个历史的平均计算成本是以每个历史的基准时间为单位的 $C(b)$，那么总计算时间为 $T = N \\, C(b)$。FOM 为：\n$$\n\\mathrm{FOM}(b) = \\frac{1}{R^{2}(b) \\, T} = \\frac{1}{\\left(\\frac{\\mathrm{Var}_{q}\\!\\left[w(b) \\, g\\right]}{N \\, \\mu^{2}}\\right) \\, N \\, C(b)} = \\frac{\\mu^{2}}{\\mathrm{Var}_{q}\\!\\left[w(b) \\, g\\right] \\, C(b)}.\n$$\n因此，$\\mathrm{FOM}(b)$ 与 $N$ 无关，仅取决于偏倚分布下的单历史方差和每个历史的成本。\n\n我们代入上面推导出的表达式。成本模型取为：\n$$\nC(b) = C_{0} \\left(1 + \\gamma b\\right),\n$$\n其中 $C_{0}  0$ 且 $\\gamma \\geq 0$。偏倚概率为：\n$$\nq_{A}(b) = p_{A} + b \\left(1 - p_{A}\\right), \\qquad q_{B}(b) = p_{B} \\left(1 - b\\right).\n$$\n综合这些可得：\n$$\n\\mathrm{FOM}(b) = \\frac{\\mu^{2}}{C_{0} \\left(1 + \\gamma b\\right)} \\left[ \\frac{1}{\\frac{p_{A}^{2} g_{A}^{2}}{q_{A}(b)} + \\frac{p_{B}^{2} g_{B}^{2}}{q_{B}(b)} - \\mu^{2}} \\right],\n$$\n其中 $\\mu = p_{A} g_{A} + p_{B} g_{B}$。\n\n为了使依赖关系明确，我们替换 $q_{A}(b)$ 和 $q_{B}(b)$：\n$$\n\\mathrm{FOM}(b) = \\frac{\\left(p_{A} g_{A} + p_{B} g_{B}\\right)^{2}}{C_{0} \\left(1 + \\gamma b\\right) \\left( \\frac{p_{A}^{2} g_{A}^{2}}{p_{A} + b \\left(1 - p_{A}\\right)} + \\frac{p_{B}^{2} g_{B}^{2}}{p_{B} \\left(1 - b\\right)} - \\left(p_{A} g_{A} + p_{B} g_{B}\\right)^{2} \\right)}.\n$$\n\n我们现在分析收益递减。当 $b \\to 0$ 时，$q_{A}(b) \\to p_{A}$ 且 $q_{B}(b) \\to p_{B}$，方差趋向于：\n$$\n\\mathrm{Var}_{q}\\!\\left[w(0) \\, g\\right] = \\frac{p_{A}^{2} g_{A}^{2}}{p_{A}} + \\frac{p_{B}^{2} g_{B}^{2}}{p_{B}} - \\mu^{2} = p_{A} g_{A}^{2} + p_{B} g_{B}^{2} - \\left(p_{A} g_{A} + p_{B} g_{B}\\right)^{2},\n$$\n即原始源方差，而成本趋向于 $C(0) = C_{0}$。当 $b$ 从零开始增加时，项 $\\frac{p_{A}^{2} g_{A}^{2}}{q_{A}(b)}$ 减小，因为 $q_{A}(b)$ 增加，这反映了由于从重要区域 $A$ 进行更频繁抽样而导致的方差减小。同时，项 $\\frac{p_{B}^{2} g_{B}^{2}}{q_{B}(b)}$ 增加，因为 $q_{B}(b) = p_{B} (1 - b)$ 减小，这惩罚了对区域 $B$ 的忽略。在极限 $b \\to 1^{-}$ 时，\n$$\nq_{B}(b) \\to 0^{+} \\quad \\Rightarrow \\quad \\frac{p_{B}^{2} g_{B}^{2}}{q_{B}(b)} \\to \\infty,\n$$\n因此方差发散，除非 $g_{B} = 0$。此外，$C(b)$ 随 $b$ 线性增加。这些相互竞争的效应产生了收益递减：$b$ 的初始增加减小了来自区域 $A$ 的主导方差项，但激进的偏倚最终导致区域 $B$ 的权重项占主导地位并使方差爆炸性增长，同时还增加了成本，从而在 $b$ 很大时减小 $\\mathrm{FOM}(b)$。\n\n因此，效率曲线 $\\mathrm{FOM}(b)$ 是直接从无偏加权估计量、测度变换下的方差和 MC 效率的基本定义推导出的显式解析函数：\n$$\n\\mathrm{FOM}(b) = \\frac{\\left(p_{A} g_{A} + p_{B} g_{B}\\right)^{2}}{C_{0} \\left(1 + \\gamma b\\right) \\left( \\frac{p_{A}^{2} g_{A}^{2}}{p_{A} + b \\left(1 - p_{A}\\right)} + \\frac{p_{B}^{2} g_{B}^{2}}{p_{B} \\left(1 - b\\right)} - \\left(p_{A} g_{A} + p_{B} g_{B}\\right)^{2} \\right)}.\n$$\n这条曲线明确地显示了随着偏倚强度 $b$ 变得越来越激进，方差减小方面的收益递减现象。",
            "answer": "$$\\boxed{\\frac{\\left(p_{A} g_{A} + p_{B} g_{B}\\right)^{2}}{C_{0} \\left(1 + \\gamma b\\right) \\left( \\frac{p_{A}^{2} g_{A}^{2}}{p_{A} + b \\left(1 - p_{A}\\right)} + \\frac{p_{B}^{2} g_{B}^{2}}{p_{B} \\left(1 - b\\right)} - \\left(p_{A} g_{A} + p_{B} g_{B}\\right)^{2} \\right)}}$$"
        }
    ]
}