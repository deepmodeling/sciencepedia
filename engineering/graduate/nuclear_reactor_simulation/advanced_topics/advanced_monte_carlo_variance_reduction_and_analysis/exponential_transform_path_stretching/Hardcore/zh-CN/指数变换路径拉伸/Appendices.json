{
    "hands_on_practices": [
        {
            "introduction": "在应用任何数值方法之前，理解其数学基础至关重要。本练习将引导你完成指数变换估计器方差的解析推导。最终目标是找到最优路径拉伸参数的精确数学形式，从而深入理解该方法为何有效以及如何工作。",
            "id": "4224668",
            "problem": "考虑单能中性粒子穿过厚度为 $d$、宏观总截面为 $\\Sigma_{t}0$ 的均匀平面板。该板是纯吸收性的（板内无散射，无源）。一个单能、单向的粒子从 $x=0$ 出发，沿着板的法线方向向 $x=d$ 移动。\n\n需要使用的基本事实：\n- 在均匀吸收剂中，到第一次碰撞的自由程长度 $s$ 服从指数概率密度函数（PDF）$f(s)=\\Sigma_{t}\\exp(-\\Sigma_{t} s)$，其中 $s\\geq 0$。\n- 穿过板的泄漏（透射）概率是第一次碰撞距离超过 $d$ 的概率，即 $P_{\\mathrm{leak}}=\\exp(-\\Sigma_{t} d)$。\n- 在蒙特卡罗（MC）模拟中，通过重要性抽样进行的方差缩减必须通过似然比来保持无偏性。如果使用有偏的概率密度函数 $f_{\\alpha}(s)$ 对 $s$ 进行抽样，则任何事件泛函的无偏估计量可通过将事件指示符乘以似然比 $L(s)=f(s)/f_{\\alpha}(s)$ 得到。\n\n为了使用指数变换路径拉伸法估计 $P_{\\mathrm{leak}}$，引入一个约束为 $\\alpha  1$ 的无量纲偏倚参数 $\\alpha$，并将 $f(s)$ 替换为有偏的概率密度函数\n$$\nf_{\\alpha}(s)=(1-\\alpha)\\,\\Sigma_{t}\\,\\exp\\!\\big(-(1-\\alpha)\\,\\Sigma_{t}\\,s\\big), \\quad s\\geq 0,\n$$\n同时使用无偏泄漏估计量\n$$\nY_{\\alpha}=\\mathbf{1}_{\\{sd\\}}\\,L(s), \\quad L(s)=\\frac{f(s)}{f_{\\alpha}(s)}.\n$$\n这里 $\\mathbf{1}_{\\{sd\\}}$ 是抽样的自由程超过板厚的事件的指示函数。\n\n仅从上述基本事实和定义出发，不引入任何额外的预推导公式，完成以下任务：\n\n1. 推导方差 $\\mathrm{Var}[Y_{\\alpha}]$ 作为 $\\alpha$、$\\Sigma_{t}$ 和 $d$ 的函数的闭式表达式。\n2. 对于 $\\alpha  1$，确定使 $\\mathrm{Var}[Y_{\\alpha}]$ 最小的值 $\\alpha^{\\star}$。将结果表示为光学厚度 $\\Sigma_{t}d$ 的闭式函数。\n3. 基于你得到的 $\\alpha^{\\star}$ 表达式，定性解释当 $\\Sigma_{t} d$ 增加时最优值的行为，但最终答案只需报告 $\\alpha^{\\star}$ 的精确闭式表达式。\n\n将最终答案报告为 $\\alpha^{\\star}$ 的单个闭式解析表达式，无单位。不要四舍五入。",
            "solution": "该问题要求推导粒子泄漏的蒙特卡罗估计量的方差，优化一个偏倚参数，并对结果进行定性分析。我们将依次解决这三个部分。\n\n首先，必须对问题进行验证。\n**步骤1：提取已知条件**\n- 单能中性粒子输运，均匀平面板，厚度 $d$，宏观总截面 $\\Sigma_{t}0$。\n- 纯吸收板（无散射，无内部源）。\n- 单能、单向粒子从 $x=0$ 出发，向 $x=d$ 移动。\n- 自由程长度概率密度函数（PDF）：$f(s)=\\Sigma_{t}\\exp(-\\Sigma_{t} s)$，其中 $s\\geq 0$。\n- 泄漏（透射）概率：$P_{\\mathrm{leak}}=\\exp(-\\Sigma_{t} d)$。\n- 用于重要性抽样的有偏概率密度函数：$f_{\\alpha}(s)=(1-\\alpha)\\,\\Sigma_{t}\\,\\exp(-(1-\\alpha)\\,\\Sigma_{t}\\,s)$，其中 $s\\geq 0$ 且 $\\alpha  1$。\n- 无偏泄漏估计量：$Y_{\\alpha}=\\mathbf{1}_{\\{sd\\}}\\,L(s)$，其中 $L(s)=f(s)/f_{\\alpha}(s)$ 是似然比，$\\mathbf{1}_{\\{sd\\}}$ 是事件 $sd$ 的指示函数。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，是粒子输运蒙特卡罗方法理论中的一个标准练习，特别涉及指数变换方差缩减技术。问题提法严谨，为得到唯一的数学解提供了所有必要的定义和约束。语言客观、精确。问题是自洽的，没有矛盾或不科学的前提。\n\n**步骤3：结论与行动**\n问题有效。我们继续求解。\n\n**1. 方差 $\\mathrm{Var}[Y_{\\alpha}]$ 的推导**\n\n随机变量 $Y_{\\alpha}$ 的方差由以下公式给出，其中期望 $\\mathrm{E}_{\\alpha}[\\cdot]$ 是相对于有偏概率密度函数 $f_{\\alpha}(s)$ 计算的：\n$$\n\\mathrm{Var}[Y_{\\alpha}] = \\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] - (\\mathrm{E}_{\\alpha}[Y_{\\alpha}])^2\n$$\n我们首先计算估计量的均值 $\\mathrm{E}_{\\alpha}[Y_{\\alpha}]$。根据定义，\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}] = \\int_{0}^{\\infty} Y_{\\alpha}(s) f_{\\alpha}(s) \\, ds = \\int_{0}^{\\infty} \\mathbf{1}_{\\{sd\\}} L(s) f_{\\alpha}(s) \\, ds\n$$\n代入 $L(s) = f(s)/f_{\\alpha}(s)$，我们得到：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}] = \\int_{0}^{\\infty} \\mathbf{1}_{\\{sd\\}} \\frac{f(s)}{f_{\\alpha}(s)} f_{\\alpha}(s) \\, ds = \\int_{0}^{\\infty} \\mathbf{1}_{\\{sd\\}} f(s) \\, ds\n$$\n指示函数将积分域限制在 $sd$：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}] = \\int_{d}^{\\infty} f(s) \\, ds = \\int_{d}^{\\infty} \\Sigma_{t}\\exp(-\\Sigma_{t} s) \\, ds = \\left[-\\exp(-\\Sigma_{t} s)\\right]_{d}^{\\infty} = 0 - (-\\exp(-\\Sigma_{t} d)) = \\exp(-\\Sigma_{t} d)\n$$\n这证实了该估计量是无偏的，即其期望值是真实的泄漏概率 $P_{\\mathrm{leak}}$。因此，均值的平方为 $(\\mathrm{E}_{\\alpha}[Y_{\\alpha}])^2 = (\\exp(-\\Sigma_{t} d))^2 = \\exp(-2\\Sigma_{t} d)$。\n\n接下来，我们计算二阶矩 $\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2]$。\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\int_{0}^{\\infty} Y_{\\alpha}^2(s) f_{\\alpha}(s) \\, ds = \\int_{0}^{\\infty} (\\mathbf{1}_{\\{sd\\}} L(s))^2 f_{\\alpha}(s) \\, ds\n$$\n由于 $(\\mathbf{1}_{\\{sd\\}})^2 = \\mathbf{1}_{\\{sd\\}}$，我们有：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\int_{d}^{\\infty} (L(s))^2 f_{\\alpha}(s) \\, ds\n$$\n首先，我们明确地写出似然比 $L(s)$ 的表达式：\n$$\nL(s) = \\frac{f(s)}{f_{\\alpha}(s)} = \\frac{\\Sigma_{t}\\exp(-\\Sigma_{t} s)}{(1-\\alpha)\\Sigma_{t}\\exp(-(1-\\alpha)\\Sigma_{t}s)} = \\frac{1}{1-\\alpha} \\exp(-\\Sigma_{t}s + (1-\\alpha)\\Sigma_{t}s) = \\frac{1}{1-\\alpha} \\exp(-\\alpha\\Sigma_{t}s)\n$$\n现在我们将 $L(s)$ 和 $f_{\\alpha}(s)$ 代入二阶矩的积分中：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\int_{d}^{\\infty} \\left(\\frac{1}{1-\\alpha} \\exp(-\\alpha\\Sigma_{t}s)\\right)^2 \\left((1-\\alpha)\\Sigma_{t}\\exp(-(1-\\alpha)\\Sigma_{t}s)\\right) \\, ds\n$$\n$$\n= \\int_{d}^{\\infty} \\frac{1}{(1-\\alpha)^2} \\exp(-2\\alpha\\Sigma_{t}s) (1-\\alpha)\\Sigma_{t}\\exp(-(1-\\alpha)\\Sigma_{t}s) \\, ds\n$$\n$$\n= \\frac{\\Sigma_{t}}{1-\\alpha} \\int_{d}^{\\infty} \\exp\\big(-2\\alpha\\Sigma_{t}s - (1-\\alpha)\\Sigma_{t}s\\big) \\, ds\n$$\n指数项化简为 $-2\\alpha\\Sigma_{t}s - \\Sigma_{t}s + \\alpha\\Sigma_{t}s = -(1+\\alpha)\\Sigma_{t}s$。积分变为：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\frac{\\Sigma_{t}}{1-\\alpha} \\int_{d}^{\\infty} \\exp(-(1+\\alpha)\\Sigma_{t}s) \\, ds\n$$\n为了使该积分收敛，指数的参数必须为负，这要求 $(1+\\alpha)\\Sigma_{t} > 0$。由于 $\\Sigma_{t}0$，我们必须有 $1+\\alpha0$，即 $\\alpha  -1$。计算积分：\n$$\n\\int_{d}^{\\infty} \\exp(-(1+\\alpha)\\Sigma_{t}s) \\, ds = \\left[ \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}s)}{-(1+\\alpha)\\Sigma_{t}} \\right]_d^{\\infty} = 0 - \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{-(1+\\alpha)\\Sigma_{t}} = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{(1+\\alpha)\\Sigma_{t}}\n$$\n将此结果代回二阶矩的表达式中：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\frac{\\Sigma_{t}}{1-\\alpha} \\cdot \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{(1+\\alpha)\\Sigma_{t}} = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{(1-\\alpha)(1+\\alpha)} = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{1-\\alpha^2}\n$$\n最后，我们组合得到方差：\n$$\n\\mathrm{Var}[Y_{\\alpha}] = \\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] - (\\mathrm{E}_{\\alpha}[Y_{\\alpha}])^2 = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{1-\\alpha^2} - \\exp(-2\\Sigma_{t}d)\n$$\n\n**2. 最优参数 $\\alpha^{\\star}$ 的确定**\n\n为了找到使 $\\mathrm{Var}[Y_{\\alpha}]$ 最小的 $\\alpha$ 值，我们将方差对 $\\alpha$ 求导并令其为零。我们记光学厚度为 $T = \\Sigma_{t}d > 0$。方差为：\n$$\nV(\\alpha) = \\frac{\\exp(-(1+\\alpha)T)}{1-\\alpha^2} - \\exp(-2T)\n$$\n我们需要求解 $\\frac{dV}{d\\alpha} = 0$。项 $\\exp(-2T)$ 相对于 $\\alpha$ 是一个常数。\n$$\n\\frac{dV}{d\\alpha} = \\frac{d}{d\\alpha} \\left( \\frac{\\exp(-T - \\alpha T)}{1-\\alpha^2} \\right) = 0\n$$\n使用除法求导法则 $\\frac{d}{dx}(\\frac{u}{v}) = \\frac{u'v - uv'}{v^2}$：\n$$\n\\frac{(-T \\exp(-T-\\alpha T))(1-\\alpha^2) - (\\exp(-T-\\alpha T))(-2\\alpha)}{(1-\\alpha^2)^2} = 0\n$$\n由于 $\\exp(-T-\\alpha T)$ 总是正的，且对于 $\\alpha \\in (-1, 1)$ 分母不为零，我们可以通过将分子设为零来简化方程：\n$$\n-T(1-\\alpha^2) + 2\\alpha = 0\n$$\n$$\n-T + T\\alpha^2 + 2\\alpha = 0 \\implies T\\alpha^2 + 2\\alpha - T = 0\n$$\n这是一个关于 $\\alpha$ 的二次方程。使用二次公式 $\\alpha = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$，其中 $a=T$， $b=2$， $c=-T$：\n$$\n\\alpha = \\frac{-2 \\pm \\sqrt{2^2 - 4(T)(-T)}}{2T} = \\frac{-2 \\pm \\sqrt{4 + 4T^2}}{2T} = \\frac{-2 \\pm 2\\sqrt{1+T^2}}{2T} = \\frac{-1 \\pm \\sqrt{1+T^2}}{T}\n$$\n这给出了两个可能的解：\n$$\n\\alpha_1 = \\frac{-1 + \\sqrt{1+T^2}}{T} \\quad \\text{和} \\quad \\alpha_2 = \\frac{-1 - \\sqrt{1+T^2}}{T}\n$$\n我们必须根据约束条件 $\\alpha  1$ 和 $\\alpha  -1$ 来检验这些解。对于 $T  0$，有 $\\sqrt{1+T^2}  \\sqrt{T^2} = T$ 和 $\\sqrt{1+T^2}  \\sqrt{1+2T+T^2} = 1+T$。\n对于 $\\alpha_1$：分子满足 $0  -1 + \\sqrt{1+T^2}  T$。由于 $T0$，除以 $T$ 得到 $0  \\alpha_1  1$。此解在有效范围内。\n对于 $\\alpha_2$：分子为 $-1 - \\sqrt{1+T^2}  -2$。因此，$\\alpha_2 = \\frac{-1 - \\sqrt{1+T^2}}{T}$ 是负数。进一步分析表明，对于所有 $T0$，$\\alpha_2  -1$。此解位于方差有限的定义域之外。\n二阶导数检验确认 $\\alpha_1$ 对应于一个最小值。因此，最优参数为 $\\alpha^{\\star} = \\alpha_1$。代入 $T=\\Sigma_{t}d$：\n$$\n\\alpha^{\\star} = \\frac{-1 + \\sqrt{1 + (\\Sigma_t d)^2}}{\\Sigma_t d}\n$$\n\n**3. $\\alpha^{\\star}$ 的定性行为**\n\n我们分析 $\\alpha^{\\star}$ 作为光学厚度 $T = \\Sigma_{t} d$ 的函数的行为。\n- 当光学厚度变得非常大（$T \\to \\infty$）时，泄漏成为一个稀有事件。我们考察其极限：\n$$\n\\lim_{T\\to\\infty} \\alpha^{\\star} = \\lim_{T\\to\\infty} \\frac{-1 + \\sqrt{1+T^2}}{T} = \\lim_{T\\to\\infty} \\frac{T\\sqrt{1/T^2+1}-1}{T} = \\lim_{T\\to\\infty} \\left(\\sqrt{1/T^2+1} - 1/T\\right) = 1\n$$\n所以，$\\alpha^{\\star}$ 趋近于 $1$。一个接近 $1$ 的 $\\alpha$ 值对应于一个重度偏倚（“拉伸”）的路径长度分布，该分布优先抽样长路径，从而增加了在模拟中观察到稀有泄漏事件的可能性。\n- 当光学厚度变得非常小（$T \\to 0$）时，泄漏是一个非常可能发生的事件。对小的 $x$ 使用泰勒展开 $\\sqrt{1+x} \\approx 1+\\frac{1}{2}x$：\n$$\n\\alpha^{\\star} \\approx \\frac{-1 + (1 + \\frac{1}{2}T^2)}{T} = \\frac{\\frac{1}{2}T^2}{T} = \\frac{1}{2}T\n$$\n所以，$\\alpha^{\\star}$ 趋近于 $0$。一个接近 $0$ 的 $\\alpha$ 值对应于几乎没有偏倚，这在目标事件不稀有时是合适的。\n总之，随着板的光学厚度 $\\Sigma_t d$ 的增加，最优偏倚参数 $\\alpha^{\\star}$ 从 $0$ 增加到趋近于 $1$，这反映了需要更强的重要性抽样来有效地模拟日益稀有的粒子透射事件。",
            "answer": "$$\\boxed{\\frac{-1 + \\sqrt{1 + (\\Sigma_{t} d)^{2}}}{\\Sigma_{t} d}}$$"
        },
        {
            "introduction": "在建立了理论基础之后，本练习将通过一个具体的数值场景来巩固这些概念。通过解决一个深度穿透问题，你将计算不同偏倚参数下的方差减小效果，并亲眼见证其显著改进。这个练习在抽象公式和实际结果之间架起了一座桥梁，强化了指数变换方法的实用价值。",
            "id": "4224672",
            "problem": "一束单能中子束穿过一块厚度为 $d$、宏观总截面为 $\\Sigma_{t}$ 的纯吸收板。穿过该板的透射概率遵循指数衰减规律。在蒙特卡洛（MC）中子输运中，对到碰撞点的飞行距离 $s$ 的直接抽样使用与该衰减定律一致的指数分布。指数变换（ET）路径拉伸技术通过一个无量纲参数 $\\alpha \\in [0,1)$ 对指数分布进行偏倚，从而修改 $s$ 的抽样，同时通过一个适当的统计权重进行补偿，以保持估计的无偏性。\n\n仅从基本衰减定律和指数碰撞过程的直接MC抽样定义出发，完成以下任务：\n\n1. 推导穿过板的透射概率 $T$ 的直接MC估计量及其方差，用 $\\Sigma_{t}$ 和 $d$ 表示。\n2. 基于路径拉伸参数 $\\alpha \\in [0,1)$，为飞行距离 $s$ 定义一个偏倚指数抽样律，并推导确保对 $T$ 进行无偏估计的相应统计权重。\n3. 使用此偏倚律和权重，推导ET估计量方差的闭式表达式，该表达式是 $\\alpha$、$\\Sigma_{t}$ 和 $d$ 的函数。\n4. 对于 $\\Sigma_{t} d = 10$ 的深穿透情况，数值计算当 $\\alpha = 0$、$\\alpha = 0.5$ 和 $\\alpha = 0.9$ 时的直接抽样方差和ET方差。将所有数值方差结果四舍五入到四位有效数字。\n5. 根据深穿透问题中实际的方差减少效果来解释这些数值结果。\n6. 对于一般的乘积 $c \\equiv \\Sigma_{t} d  0$，解析地确定使ET方差最小化的 $\\alpha$ 值，然后计算当 $c = 10$ 时这个最优的 $\\alpha$。将最优 $\\alpha$ 表示为一个四舍五入到四位有效数字的单个数字。\n\n所有答案都是无量纲的；不要包含单位。最终报告的数字应为四舍五入到四位有效数字的最优 $\\alpha$ 值。",
            "solution": "该问题提得很好，有科学依据，并包含了完整解答所需的所有信息。它描述了一种在蒙特卡洛粒子输运模拟中使用的标准方差减少技术——指数变换。我们将根据基本原理推导所需的量。\n\n令 $\\Sigma_t$ 为宏观总截面， $d$ 为板厚度， $s$ 为中子飞行距离。分析从辐射衰减基本定律开始。\n\n中子飞行距离 $s$ 而不发生碰撞的概率由 $P(\\text{flight}  s) = \\exp(-\\Sigma_t s)$ 给出。第一次碰撞的飞行距离 $s$ 对应的概率密度函数 (PDF) 是通过对累积分布函数 $F(s) = P(\\text{flight} \\le s) = 1 - \\exp(-\\Sigma_t s)$ 求导得到的：\n$$\np(s) = \\frac{dF(s)}{ds} = \\Sigma_t \\exp(-\\Sigma_t s), \\quad s \\ge 0\n$$\n\n穿过厚度为 $d$ 的纯吸收板的解析透射概率 $T$ 是首次飞行距离 $s$ 大于 $d$ 的概率：\n$$\nT = P(s  d) = \\int_{d}^{\\infty} p(s) \\,ds = \\int_{d}^{\\infty} \\Sigma_t \\exp(-\\Sigma_t s) \\,ds = [-\\exp(-\\Sigma_t s)]_{d}^{\\infty} = \\exp(-\\Sigma_t d)\n$$\n\n现在我们来解决问题的六个部分。\n\n**1. 直接MC估计量与方差**\n\n在直接蒙特卡洛模拟中，我们直接从物理PDF $p(s)$ 中抽样飞行距离 $s$。对于透射问题，一个历史的得分 $\\xi_{an}$ 为：如果中子穿过板 ($s > d$)，则为 $1$；如果在板内碰撞 ($s \\le d$)，则为 $0$。这是一个伯努利随机变量。\n\n直接估计量 $\\xi_{an}$ 的期望值为：\n$$\nE[\\xi_{an}] = (1) \\cdot P(s  d) + (0) \\cdot P(s \\le d) = P(s  d) = \\exp(-\\Sigma_t d) = T\n$$\n由于 $E[\\xi_{an}] = T$，该估计量是无偏的。\n\n单个历史得分的方差 $\\text{Var}(\\xi_{an})$ 由 $\\text{Var}(\\xi_{an}) = E[\\xi_{an}^2] - (E[\\xi_{an}])^2$ 给出。对于一个伯努利变量，其中 $\\xi_{an}$ 取值为 $0$ 或 $1$，我们有 $\\xi_{an}^2 = \\xi_{an}$。因此，$E[\\xi_{an}^2] = E[\\xi_{an}] = T$。方差为：\n$$\n\\text{Var}(\\xi_{an}) = T - T^2 = T(1 - T) = \\exp(-\\Sigma_t d) \\left(1 - \\exp(-\\Sigma_t d)\\right)\n$$\n\n**2. 偏倚抽样律与统计权重**\n\n指数变换（ET）方法引入一个偏倚的PDF $p^*(s)$ 来抽样飞行距离 $s$。这是通过将总截面修改为一个偏倚值 $\\Sigma_t' = (1-\\alpha)\\Sigma_t$ 来实现的，其中 $\\alpha \\in [0,1)$ 是路径拉伸参数。条件 $\\alpha  1$ 确保了 $\\Sigma_t'  0$。\n\n偏倚抽样律 (PDF) 是：\n$$\np^*(s) = \\Sigma_t' \\exp(-\\Sigma_t' s) = (1-\\alpha)\\Sigma_t \\exp\\left(-(1-\\alpha)\\Sigma_t s\\right)\n$$\n为确保最终估计保持无偏，每个粒子的得分必须乘以一个统计权重 $w(s)$，该权重是真实PDF与偏倚PDF的比值：\n$$\nw(s) = \\frac{p(s)}{p^*(s)} = \\frac{\\Sigma_t \\exp(-\\Sigma_t s)}{(1-\\alpha)\\Sigma_t \\exp\\left(-(1-\\alpha)\\Sigma_t s\\right)} = \\frac{1}{1-\\alpha} \\exp(-\\Sigma_t s + (1-\\alpha)\\Sigma_t s)\n$$\n$$\nw(s) = \\frac{1}{1-\\alpha} \\exp(-\\alpha \\Sigma_t s)\n$$\n\nET透射估计量 $\\xi_{ET}$ 为：如果粒子透射 ($s > d$)，则为权重 $w(s)$；否则为 $0$。期望值为 $E[\\xi_{ET}] = \\int_d^\\infty w(s) p^*(s) \\,ds = \\int_d^\\infty p(s) \\,ds = T$，这证实了该估计量是无偏的。\n\n**3. ET估计量的方差**\n\nET估计量的方差是 $\\text{Var}(\\xi_{ET}) = E[\\xi_{ET}^2] - (E[\\xi_{ET}])^2$。我们已知 $E[\\xi_{ET}] = T$。现在我们计算二阶矩 $E[\\xi_{ET}^2]$：\n$$\nE[\\xi_{ET}^2] = \\int_0^\\infty (\\xi_{ET}(s))^2 p^*(s) \\,ds = \\int_d^\\infty (w(s))^2 p^*(s) \\,ds\n$$\n代入 $w(s)$ 和 $p^*(s)$ 的表达式：\n$$\nE[\\xi_{ET}^2] = \\int_d^\\infty \\left( \\frac{1}{1-\\alpha} \\exp(-\\alpha \\Sigma_t s) \\right)^2 \\left( (1-\\alpha)\\Sigma_t \\exp(-(1-\\alpha)\\Sigma_t s) \\right) \\,ds\n$$\n$$\nE[\\xi_{ET}^2] = \\int_d^\\infty \\frac{1}{(1-\\alpha)^2} \\exp(-2\\alpha \\Sigma_t s) (1-\\alpha)\\Sigma_t \\exp(-(1-\\alpha)\\Sigma_t s) \\,ds\n$$\n$$\nE[\\xi_{ET}^2] = \\frac{\\Sigma_t}{1-\\alpha} \\int_d^\\infty \\exp\\left( -2\\alpha \\Sigma_t s - (1-\\alpha)\\Sigma_t s \\right) \\,ds\n$$\n指数项为 $-2\\alpha \\Sigma_t s - \\Sigma_t s + \\alpha \\Sigma_t s = -(1+\\alpha)\\Sigma_t s$。\n$$\nE[\\xi_{ET}^2] = \\frac{\\Sigma_t}{1-\\alpha} \\int_d^\\infty \\exp\\left( -(1+\\alpha)\\Sigma_t s \\right) \\,ds\n$$\n$$\nE[\\xi_{ET}^2] = \\frac{\\Sigma_t}{1-\\alpha} \\left[ \\frac{\\exp(-(1+\\alpha)\\Sigma_t s)}{-(1+\\alpha)\\Sigma_t} \\right]_d^\\infty = \\frac{\\Sigma_t}{1-\\alpha} \\left( 0 - \\frac{\\exp(-(1+\\alpha)\\Sigma_t d)}{-(1+\\alpha)\\Sigma_t} \\right)\n$$\n$$\nE[\\xi_{ET}^2] = \\frac{1}{(1-\\alpha)(1+\\alpha)} \\exp(-(1+\\alpha)\\Sigma_t d) = \\frac{\\exp(-(1+\\alpha)\\Sigma_t d)}{1-\\alpha^2}\n$$\nET估计量的方差作为 $\\alpha$、$\\Sigma_t$ 和 $d$ 的函数是：\n$$\n\\text{Var}(\\xi_{ET}) = E[\\xi_{ET}^2] - T^2 = \\frac{\\exp(-(1+\\alpha)\\Sigma_t d)}{1-\\alpha^2} - (\\exp(-\\Sigma_t d))^2\n$$\n$$\n\\text{Var}(\\xi_{ET}) = \\frac{\\exp(-\\Sigma_t d) \\exp(-\\alpha \\Sigma_t d)}{1-\\alpha^2} - \\exp(-2\\Sigma_t d)\n$$\n\n**4. $\\Sigma_t d = 10$ 时的数值方差**\n\n给定 $c \\equiv \\Sigma_t d = 10$。透射概率为 $T = \\exp(-10)$。\n\n直接抽样方差 ($\\alpha=0$) 是：\n$$\n\\text{Var}(\\xi_{an}) = \\exp(-10)(1 - \\exp(-10)) \\approx (4.53999 \\times 10^{-5})(1 - 4.53999 \\times 10^{-5}) \\approx 4.5398 \\times 10^{-5}\n$$\n四舍五入到四位有效数字，直接抽样方差为 $4.540 \\times 10^{-5}$。注意，当 $\\alpha=0$ 时，ET方差公式正确地简化为直接抽样方差：\n$$\n\\text{Var}(\\xi_{ET})|_{\\alpha=0} = \\frac{\\exp(-10)}{1-0} - \\exp(-20) = \\exp(-10)(1 - \\exp(-10))\n$$\n\n对于 $\\alpha = 0.5$：\n$$\n\\text{Var}(\\xi_{ET})|_{\\alpha=0.5} = \\frac{\\exp(-(1+0.5)10)}{1-0.5^2} - \\exp(-2 \\cdot 10) = \\frac{\\exp(-15)}{1-0.25} - \\exp(-20)\n$$\n$$\n\\text{Var}(\\xi_{ET})|_{\\alpha=0.5} = \\frac{\\exp(-15)}{0.75} - \\exp(-20) \\approx \\frac{3.0590 \\times 10^{-7}}{0.75} - 2.0612 \\times 10^{-9} \\approx 4.0787 \\times 10^{-7} - 2.0612 \\times 10^{-9} \\approx 4.058 \\times 10^{-7}\n$$\n\n对于 $\\alpha = 0.9$：\n$$\n\\text{Var}(\\xi_{ET})|_{\\alpha=0.9} = \\frac{\\exp(-(1+0.9)10)}{1-0.9^2} - \\exp(-20) = \\frac{\\exp(-19)}{1-0.81} - \\exp(-20)\n$$\n$$\n\\text{Var}(\\xi_{ET})|_{\\alpha=0.9} = \\frac{\\exp(-19)}{0.19} - \\exp(-20) \\approx \\frac{5.5891 \\times 10^{-9}}{0.19} - 2.0612 \\times 10^{-9} \\approx 2.9416 \\times 10^{-8} - 2.0612 \\times 10^{-9} \\approx 2.736 \\times 10^{-8}\n$$\n\n**5. 结果解释**\n\n数值结果如下：\n- 直接抽样方差 ($\\alpha=0$): $4.540 \\times 10^{-5}$\n- ET方差 ($\\alpha=0.5$): $4.058 \\times 10^{-7}$\n- ET方差 ($\\alpha=0.9$): $2.736 \\times 10^{-8}$\n\n对于深穿透问题 ($\\Sigma_t d = 10$)，直接抽样效率极低，因为透射是一个稀有事件 ($T \\approx 4.5 \\times 10^{-5}$)。大多数历史的得分都是 $0$，导致相对方差很高。通过选择 $\\alpha  0$，ET方法通过从一个具有较小有效截面的分布中抽样来“拉伸”粒子路径，从而增加了粒子到达并穿过厚度 $d$ 的概率。\n将 $\\alpha$ 从 $0$ 增加到 $0.5$，方差减少了约 $112$ 倍。将 $\\alpha$ 进一步增加到 $0.9$，与直接抽样相比，方差减少了超过 $1600$ 倍。这表明ET方法是解决深穿透问题的强大方差减少技术，只要选择了最优值，较大的 $\\alpha$ 值（接近 $1$）会带来越来越大的方差减少。\n\n**6. 最优路径拉伸参数 $\\alpha$**\n\n为了找到使方差最小化的 $\\alpha$ 值，我们将 $\\text{Var}(\\xi_{ET})$ 对 $\\alpha$ 求导，并令结果为零。令 $c = \\Sigma_t d$。\n$$\n\\text{Var}(\\xi_{ET}) = \\frac{\\exp(-(1+\\alpha)c)}{1-\\alpha^2} - \\exp(-2c)\n$$\n最小化方差等同于最小化第一项，因为第二项 $\\exp(-2c)$ 与 $\\alpha$ 无关。令 $f(\\alpha) = \\frac{\\exp(-(1+\\alpha)c)}{1-\\alpha^2}$。我们可以忽略常数因子 $\\exp(-c)$，转而最小化 $g(\\alpha) = \\frac{\\exp(-\\alpha c)}{1-\\alpha^2}$。\n使用除法定则求导：\n$$\n\\frac{dg}{d\\alpha} = \\frac{(-c \\exp(-\\alpha c))(1-\\alpha^2) - (\\exp(-\\alpha c))(-2\\alpha)}{(1-\\alpha^2)^2} = 0\n$$\n由于当 $\\alpha \\in [0,1)$ 时，$\\exp(-\\alpha c)  0$ 且 $(1-\\alpha^2)^2  0$，我们只需要分子为零：\n$$\n-c(1-\\alpha^2) + 2\\alpha = 0\n$$\n$$\nc\\alpha^2 + 2\\alpha - c = 0\n$$\n这是一个关于 $\\alpha$ 的一元二次方程。应用求根公式：\n$$\n\\alpha = \\frac{-2 \\pm \\sqrt{2^2 - 4(c)(-c)}}{2c} = \\frac{-2 \\pm \\sqrt{4 + 4c^2}}{2c} = \\frac{-2 \\pm 2\\sqrt{1+c^2}}{2c} = \\frac{-1 \\pm \\sqrt{1+c^2}}{c}\n$$\n由于 $c  0$，项 $\\sqrt{1+c^2}  1$。解 $\\alpha = \\frac{-1-\\sqrt{1+c^2}}{c}$ 是负数，因此不在定义域 $\\alpha \\in [0,1)$ 内。唯一具有物理意义的解是：\n$$\n\\alpha_{opt} = \\frac{-1 + \\sqrt{1+c^2}}{c}\n$$\n为使此解为最小值，二阶导数应为正。这一点可以被证实，但它是一个标准结果。我们还必须验证这个 $\\alpha_{opt}$ 在 $[0, 1)$ 范围内。对于 $c  0$，$\\sqrt{1+c^2}1$，所以 $\\alpha_{opt}  0$。并且，$\\sqrt{1+c^2}  \\sqrt{1+2c+c^2} = \\sqrt{(1+c)^2} = 1+c$，这意味着 $\\sqrt{1+c^2}-1  c$，所以 $\\alpha_{opt}  1$。因此，$\\alpha_{opt} \\in (0,1)$。\n\n对于 $c = \\Sigma_t d = 10$ 的特定情况：\n$$\n\\alpha_{opt} = \\frac{-1 + \\sqrt{1+10^2}}{10} = \\frac{-1 + \\sqrt{101}}{10}\n$$\n数值上，$\\sqrt{101} \\approx 10.0498756$。\n$$\n\\alpha_{opt} \\approx \\frac{-1 + 10.0498756}{10} = \\frac{9.0498756}{10} = 0.90498756\n$$\n四舍五入到四位有效数字，最优 $\\alpha$ 值为 $0.9050$。",
            "answer": "$$\\boxed{0.9050}$$"
        },
        {
            "introduction": "最后的练习将带你进入计算物理学的领域。你将编写一个程序来实现指数变换方法，通过模拟实验找到一个合适的偏倚参数，并使用专业标准——品质因数（Figure of Merit, FOM）来量化其有效性。这个练习将所有学到的概念综合到一个可验证的实践模拟中，这正是在真实世界中科学家或工程师会执行的任务。",
            "id": "4224733",
            "problem": "考虑核反应堆模拟中的一个一维板屏蔽基准问题。一个单能粒子从入口 $x=0$ 出发，沿 $+x$ 方向穿过一个均匀的纯吸收介质，该介质的宏观总截面为 $\\Sigma_t$，单位为 $\\mathrm{cm}^{-1}$。该板的厚度为 $L$，单位为 $\\mathrm{cm}$。感兴趣的量是在 $x=L$ 处的透射份额（通量），它等于粒子在离开板之前未发生相互作用的概率。\n\n基本原理：\n- 对于纯吸收介质，比尔-朗伯指数衰减定律指出，穿过路径长度 $s$ 的存活概率为 $\\exp(-\\Sigma_t s)$。\n- 在标准蒙特卡罗抽样中，根据宏观总截面的定义，自由程 $s$ 从一个率为 $\\Sigma_t$ 的指数分布中抽样。\n\n指数变换路径拉伸是一种方差缩减技术，它通过降低指数率来偏倚自由程抽样，并用适当的权重进行补偿以保持无偏性。设 $\\alpha$ 为无量纲的路径拉伸参数，其选择应满足 $0 \\le \\alpha  1$ 以确保偏倚抽样是良定义的。偏倚抽样率变为 $(1-\\alpha)\\Sigma_t$，并且必须使用标准抽样定律与偏倚抽样定律之间的严格似然比以及透射指示函数来推导透射份额的无偏估计量。此处不提供无偏估计量的快捷公式；估计量必须从上述基本原理出发，通过第一性原理获得。\n\n品质因子（FOM）定义如下。设 $N$ 表示粒子历史数（这是计算量；将其视为以历史数为单位的“时间”），$\\hat{\\mu}$ 为透射份额的样本均值估计量，$\\hat{\\sigma}^2$ 为其无偏样本方差。相对误差为 $R = \\hat{\\sigma}/|\\hat{\\mu}|$。品质因子（FOM）为 $1/(R^2 N)$，并且必须以 $\\mathrm{histories}^{-1}$ 为单位报告。\n\n任务：\n1. 对于给定的 $(\\Sigma_t, L)$，在一组离散的候选 $\\alpha$ 值上进行预研究，以估计每个候选值的 FOM。使用预研究结果选择使估计的 FOM 最大化的 $\\alpha$。在预研究的离散化下，此 $\\alpha$ 被视为“最优”（无量纲）。\n2. 通过进行一次正式运行来验证所选参数，并比较以下情况的 FOM：\n   - 标准情况（$\\alpha = 0$），\n   - 预研究选择的最优 $\\alpha$，\n   - 从预研究集合中选择的一个可证明的非最优 $\\alpha$，其预研究 FOM 严格低于最优选择。\n3. 对于每个测试用例，报告：\n   - 最优 $\\alpha$（无量纲），\n   - 最优 $\\alpha$ 的正式运行 FOM（单位 $\\mathrm{histories}^{-1}$），\n   - 标准情况的正式运行 FOM（单位 $\\mathrm{histories}^{-1}$），\n   - 所选非最优 $\\alpha$ 的正式运行 FOM（单位 $\\mathrm{histories}^{-1}$），\n   - 一个确认最优 FOM 严格大于标准 FOM 的布尔值，\n   - 一个确认最优 FOM 严格大于非最优 FOM 的布尔值。\n\n估计量和算法要求：\n- 从上述基本原理出发，使用分布变换似然比结合透射指示函数 $I[s \\ge L]$，推导在指数变换路径拉伸下的透射份额的无偏估计量。\n- 对每个候选 $\\alpha$（包括通过设置 $\\alpha = 0$ 实现的标准情况），使用从率为 $(1-\\alpha)\\Sigma_t$ 的偏倚指数分布中对自由程 $s$ 进行独立同分布抽样来实现蒙特卡罗方法。\n- 对于每次运行，计算样本均值、无偏样本方差、相对误差 $R$ 和品质因子 FOM $1/(R^2 N)$，所有量均使用上述指定单位。\n\n测试套件：\n为以下测试用例执行您的程序，每个用例都有自己的预研究和正式运行规模：\n- 测试用例 1：$\\Sigma_t = 1.0\\,\\mathrm{cm}^{-1}$，$L = 10.0\\,\\mathrm{cm}$，$N_{\\text{pilot}} = 20000$ 历史数，$N_{\\text{prod}} = 100000$ 历史数。\n- 测试用例 2：$\\Sigma_t = 0.2\\,\\mathrm{cm}^{-1}$，$L = 5.0\\,\\mathrm{cm}$，$N_{\\text{pilot}} = 20000$ 历史数，$N_{\\text{prod}} = 100000$ 历史数。\n- 测试用例 3：$\\Sigma_t = 2.0\\,\\mathrm{cm}^{-1}$，$L = 1.0\\,\\mathrm{cm}$，$N_{\\text{pilot}} = 20000$ 历史数，$N_{\\text{prod}} = 100000$ 历史数。\n\n预研究候选集：\n对于每个测试用例，考虑一个由五个候选 $\\alpha$ 值组成的离散集合，定义为：$\\{0.0, 0.2, 0.5, 0.8, 0.95\\}$，并理解偏倚率 $(1-\\alpha)\\Sigma_t$ 必须为正；如果需要，将 $\\alpha$ 限制在严格小于 $1$ 的范围内。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的结果，形式为一个用方括号括起来的逗号分隔列表，其中每个测试用例的结果本身就是一个列表，顺序如下：\n$[\\alpha_{\\text{opt}}, \\mathrm{FOM}_{\\text{opt}}, \\mathrm{FOM}_{\\text{analog}}, \\mathrm{FOM}_{\\text{nonopt}}, \\text{opt\\_gt\\_analog}, \\text{opt\\_gt\\_nonopt}]$。\n例如，总的外层列表应显示为 $[[\\cdots],[\\cdots],[\\cdots]]$，包含数值和布尔值，并且所有 $\\alpha$ 值必须是无量纲的，而所有 FOM 值必须以 $\\mathrm{histories}^{-1}$ 为单位。",
            "solution": "所提出的问题是粒子输运蒙特卡罗方法领域一个有效且良态的练习。它在科学上基于辐射物理学和统计估计的原理，并且所有必要的参数和目标都已明确定义。因此，我们将着手提供一个完整的解决方案。\n\n主要目标是评估指数变换路径拉伸方差缩减技术对于一维纯吸收屏蔽问题的有效性。这涉及到推导无偏估计量，实现蒙特卡罗模拟，并用它来寻找最优的路径拉伸参数 $\\alpha$。\n\n**1. 无偏估计量的推导**\n\n感兴趣的量是透射份额 $\\mu$，即粒子在没有发生相互作用的情况下行进距离大于或等于板厚 $L$ 的概率。粒子的自由程 $s$ 是一个随机变量。\n\n在标准（无偏）物理模型中，自由程 $s$ 的概率密度函数 (PDF) 由指数分布给出：\n$$\np(s) = \\Sigma_t e^{-\\Sigma_t s}, \\quad s \\ge 0\n$$\n其中 $\\Sigma_t$ 是宏观总截面。\n\n透射份额 $\\mu$ 是存活概率 $P(s \\ge L)$。这可以表示为指示函数 $I[s \\ge L]$ 的期望，如果 $s \\ge L$，该函数为 $1$，否则为 $0$。\n$$\n\\mu = E_p[I[s \\ge L]] = \\int_0^\\infty I[s \\ge L] p(s) ds = \\int_L^\\infty \\Sigma_t e^{-\\Sigma_t s} ds = e^{-\\Sigma_t L}\n$$\n标准蒙特卡罗方法通过从 $p(s)$ 中抽样 $s_i$ 并对 $I[s_i \\ge L]$ 求平均来估计 $\\mu$。对于 $\\Sigma_t L \\gg 1$ 的深穿透问题，$\\mu$ 非常小，这种标准方法效率很低，因为大多数历史的得分都为 $0$。\n\n指数变换技术是重要性抽样的一种形式，它通过偏倚抽样来增加透射概率。我们从一个偏倚的 PDF $p'(s)$ 中抽样路径长度 $s'$：\n$$\np'(s) = (1-\\alpha)\\Sigma_t e^{-(1-\\alpha)\\Sigma_t s}, \\quad s \\ge 0\n$$\n其中 $\\alpha$ 是无量纲的路径拉伸参数，满足 $0 \\le \\alpha  1$。这个偏倚分布的平均自由程（$1/((1-\\alpha)\\Sigma_t)$）比标准分布（$1/\\Sigma_t$）的要大，从而鼓励更长的路径。\n\n为确保估计量保持无偏，我们必须引入一个权重 $w(s')$ 来校正概率测度的改变。期望被重写为：\n$$\n\\mu = \\int_0^\\infty I[s \\ge L] p(s) ds = \\int_0^\\infty I[s \\ge L] \\frac{p(s)}{p'(s)} p'(s) ds = E_{p'}\\left[I[s' \\ge L] \\frac{p(s')}{p'(s')}\\right]\n$$\n期望中的项是从 $p'(s')$ 中抽样的单个历史的得分。权重 $w(s')$ 是似然比：\n$$\nw(s') = \\frac{p(s')}{p'(s')} = \\frac{\\Sigma_t e^{-\\Sigma_t s'}}{(1-\\alpha)\\Sigma_t e^{-(1-\\alpha)\\Sigma_t s'}} = \\frac{1}{1 - \\alpha} e^{-[\\Sigma_t - (1 - \\alpha)\\Sigma_t]s'} = \\frac{1}{1 - \\alpha} e^{-\\alpha \\Sigma_t s'}\n$$\n因此，对于每个粒子历史 $i$，我们从 $p'(s')$ 中抽样一个路径长度 $s'_i$。该历史的得分 $X_i$ 是：\n$$\nX_i = \\begin{cases} \\frac{1}{1-\\alpha} e^{-\\alpha \\Sigma_t s'_i}   \\text{if } s'_i \\ge L \\\\ 0  \\text{if } s'_i  L \\end{cases}\n$$\n这是单个历史的无偏估计量。在 $N$ 个历史上的样本均值 $\\hat{\\mu} = \\frac{1}{N} \\sum_{i=1}^N X_i$ 是真实透射份额 $\\mu$ 的一个无偏估计量。\n\n**2. 蒙特卡罗算法与品质因子 (FOM)**\n\n对于给定的参数集 $(\\Sigma_t, L, \\alpha)$ 和总共 $N$ 个粒子历史，模拟过程如下：\n1. 对于每个历史 $i=1, \\dots, N$，从一个率为 $\\Sigma'_t = (1-\\alpha)\\Sigma_t$ 的指数分布中抽样一个路径长度 $s'_i$。\n2. 如果 $s'_i \\ge L$，计算得分 $X_i = \\frac{1}{1-\\alpha} e^{-\\alpha \\Sigma_t s'_i}$。\n3. 如果 $s'_i  L$，得分为 $X_i = 0$。\n\n在运行 $N$ 个历史后，我们从得分集合 $\\{X_1, X_2, \\dots, X_N\\}$ 中计算以下统计量：\n- **样本均值：** $\\hat{\\mu} = \\frac{1}{N} \\sum_{i=1}^N X_i$\n- **无偏样本方差：** $\\hat{\\sigma}^2 = \\frac{1}{N-1} \\sum_{i=1}^N (X_i - \\hat{\\mu})^2$\n\n根据问题定义，相对误差 $R$ 和品质因子 (FOM) 定义为：\n- **相对误差：** $R = \\frac{\\hat{\\sigma}}{|\\hat{\\mu}|}$\n- **品质因子：** $\\mathrm{FOM} = \\frac{1}{R^2 N} = \\frac{1}{(\\hat{\\sigma}^2 / \\hat{\\mu}^2) N} = \\frac{\\hat{\\mu}^2}{N \\hat{\\sigma}^2}$\n\nFOM 的单位是 $\\mathrm{histories}^{-1}$，符合要求。更高的 FOM 表示模拟效率更高，意味着达到给定统计精度水平所需的历史数更少。\n\n**3. 参数优化与验证**\n\n指数变换的效力高度依赖于 $\\alpha$ 的选择。寻找合适的 $\\alpha$ 并验证其性能的程序如下：\n\n1. **预研究：** 对于给定的测试用例 $(\\Sigma_t, L)$，使用 $N_{\\text{pilot}}$ 个历史对一组离散的候选 $\\alpha$ 值 $\\{0.0, 0.2, 0.5, 0.8, 0.95\\}$ 进行模拟。为每个候选值估计 FOM。产生最高估计 FOM 的 $\\alpha$ 值被指定为最优参数 $\\alpha_{\\text{opt}}$。\n\n2. **正式运行与验证：** 为了获得统计上更稳健的结果，使用更多数量的历史 $N_{\\text{prod}}$ 进行正式运行。计算三种特定情况下的 FOM：\n    - **标准情况**：$\\alpha = 0$。这代表了没有方差缩减时的基准性能。\n    - **最优情况**：$\\alpha = \\alpha_{\\text{opt}}$，由预研究确定。\n    - **非最优情况**：$\\alpha = \\alpha_{\\text{nonopt}}$。此值选择为预研究中导致最低 FOM 的候选 $\\alpha$，为较差的参数选择提供一个基准。\n\n最后，我们报告关键结果：$\\alpha_{\\text{opt}}$，以及最优、标准和非最优情况下的正式运行 FOM。我们还确认最优 FOM 严格大于标准和非最优 FOM，从而证明优化过程的成功。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_monte_carlo_simulation(sigma_t, L, alpha, N):\n    \"\"\"\n    Performs a Monte Carlo simulation for the 1D shielding problem.\n\n    Args:\n        sigma_t (float): Macroscopic total cross section (cm^-1).\n        L (float): Slab thickness (cm).\n        alpha (float): Dimensionless path-stretching parameter.\n        N (int): Number of particle histories.\n\n    Returns:\n        tuple: (sample_mean, sample_variance, figure_of_merit)\n    \"\"\"\n    if N = 1:\n        return 0.0, 0.0, 0.0\n\n    if not 0 = alpha  1:\n        raise ValueError(\"alpha must be in the range [0, 1).\")\n\n    biased_rate = (1.0 - alpha) * sigma_t\n    \n    # Generate N random path lengths from the biased exponential distribution\n    # scale = 1/lambda, where lambda is the rate.\n    path_lengths = np.random.exponential(scale=1.0/biased_rate, size=N)\n\n    # Identify transmitted particles\n    transmitted_mask = path_lengths >= L\n    transmitted_paths = path_lengths[transmitted_mask]\n\n    # Calculate scores for all histories\n    scores = np.zeros(N)\n    if transmitted_paths.size > 0:\n        # The weight is applied only to transmitted particles\n        weight_prefactor = 1.0 / (1.0 - alpha)\n        weights = weight_prefactor * np.exp(-alpha * sigma_t * transmitted_paths)\n        scores[transmitted_mask] = weights\n\n    # Calculate statistics\n    mu_hat = np.mean(scores)\n\n    # If mu_hat is 0, it means no particles were transmitted (or scores were zero).\n    # In this case, the variance is 0, and the FOM is 0.\n    if mu_hat == 0.0:\n        return 0.0, 0.0, 0.0\n\n    # Unbiased sample variance (ddof=1 for N-1 in denominator)\n    sigma_sq = np.var(scores, ddof=1)\n    \n    # If variance is 0 but mean is not, this implies a perfect estimator (infinite FOM).\n    # This shouldn't happen for this problem with N > 1.\n    if sigma_sq == 0.0:\n        fom = np.inf\n    else:\n        # Relative error squared: R^2 = (sigma/mu)^2 = sigma^2 / mu^2\n        R_sq = sigma_sq / (mu_hat**2)\n        # Figure of Merit: FOM = 1 / (R^2 * N)\n        fom = 1.0 / (R_sq * N)\n\n    return mu_hat, sigma_sq, fom\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and produce the final output.\n    \"\"\"\n    test_cases = [\n        # (Sigma_t, L, N_pilot, N_prod)\n        (1.0, 10.0, 20000, 100000),\n        (0.2, 5.0, 20000, 100000),\n        (2.0, 1.0, 20000, 100000),\n    ]\n\n    alpha_factors = [0.0, 0.2, 0.5, 0.8, 0.95]\n    \n    final_results = []\n\n    for sigma_t, L, n_pilot, n_prod in test_cases:\n        # --- Pilot Study ---\n        pilot_results = {}\n        candidate_alphas = alpha_factors\n\n        for alpha in candidate_alphas:\n            _, _, fom = run_monte_carlo_simulation(sigma_t, L, alpha, n_pilot)\n            pilot_results[alpha] = fom\n        \n        # --- Parameter Selection ---\n        # Find optimal alpha (max FOM in pilot run)\n        alpha_opt = max(pilot_results, key=pilot_results.get)\n        \n        # Find a demonstrably non-optimal alpha (min FOM in pilot run)\n        # Exclude the analog case if it happens to be the worst, to ensure non-opt is different from analog\n        non_opt_candidates = {a: f for a, f in pilot_results.items() if a != alpha_opt}\n        if not non_opt_candidates: # This only happens if all alphas give the same FOM\n            alpha_nonopt = min(pilot_results, key=pilot_results.get)\n        else:\n            alpha_nonopt = min(non_opt_candidates, key=non_opt_candidates.get)\n\n        # The analog case is always a candidate for comparison\n        alpha_analog = 0.0\n\n        # --- Production Runs ---\n        _, _, fom_opt = run_monte_carlo_simulation(sigma_t, L, alpha_opt, n_prod)\n        _, _, fom_analog = run_monte_carlo_simulation(sigma_t, L, alpha_analog, n_prod)\n        _, _, fom_nonopt = run_monte_carlo_simulation(sigma_t, L, alpha_nonopt, n_prod)\n\n        # --- Validation  Reporting ---\n        opt_gt_analog = fom_opt > fom_analog\n        opt_gt_nonopt = fom_opt > fom_nonopt\n\n        result_for_case = [\n            alpha_opt,\n            fom_opt,\n            fom_analog,\n            fom_nonopt,\n            opt_gt_analog,\n            opt_gt_nonopt\n        ]\n        final_results.append(result_for_case)\n\n    # Format the final output string as specified\n    # The default string representation of a list is what's required.\n    print(str(final_results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}