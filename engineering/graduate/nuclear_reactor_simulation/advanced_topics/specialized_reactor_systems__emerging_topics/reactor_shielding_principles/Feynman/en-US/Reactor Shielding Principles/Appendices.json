{
    "hands_on_practices": [
        {
            "introduction": "The simplest model for radiation shielding, exponential attenuation, only accounts for particles that travel through the shield without interacting. This \"uncollided\" component is often just a small part of the total radiation field. This practice explores the concept of the build-up factor, a critical correction that accounts for the contribution of scattered particles, and quantifies the significant error that arises from neglecting this effect in a shielding calculation .",
            "id": "4245204",
            "problem": "A collimated photon beam at energy $2\\,\\mathrm{MeV}$ from a point source passes perpendicularly through a planar lead slab of thickness $20\\,\\mathrm{cm}$. In a point-kernel treatment of photon transport and shielding, the response of interest (for example, fluence rate after the slab or a fluence-proportional dose quantity) is often computed by splitting the field into an uncollided component governed by exponential attenuation and a scattered component generated by interactions in the medium. The uncollided component obeys the linear attenuation law derived from particle balance, where the linear attenuation coefficient $\\mu(E)$ for lead at energy $E$ is treated as known. The contribution of multiply scattered photons to the response is compactly accounted for by the build-up factor $B(E,x)$, defined as the ratio of the total response behind a slab of material of thickness $x$ at photon energy $E$ to the response due only to the uncollided component behind that slab.\n\nAssume the slab is thick enough and the collimation is sufficiently tight that geometric dilution is negligible compared to attenuation over the slab thickness, and that the response quantity is proportional to photon fluence. For $E=2\\,\\mathrm{MeV}$ and $x=20\\,\\mathrm{cm}$ in lead, take an empirically justified build-up factor of $B(E,x)=2$ for the response of interest. An analyst neglects build-up and reports the response using only the uncollided exponential attenuation.\n\nUsing only the fundamental exponential attenuation for the uncollided component and the definition of the build-up factor, derive an expression for the fractional error (defined as the magnitude of the difference between the physically correct total response and the no-build-up estimate, divided by the physically correct total response) incurred by neglecting build-up. Then evaluate this fractional error for $B=2$. Express your final answer as a dimensionless decimal number. Do not use a percentage sign.",
            "solution": "The problem requires the derivation and evaluation of the fractional error resulting from neglecting the photon build-up factor in a shielding calculation.\n\nFirst, we must validate the problem statement.\n\n### Step 1: Extract Givens\n-   Photon beam energy: $E=2\\,\\mathrm{MeV}$\n-   Slab material: Lead\n-   Slab thickness: $x=20\\,\\mathrm{cm}$\n-   Source and geometry: Collimated beam from a point source, perpendicular incidence on a planar slab.\n-   Assumption: Geometric dilution is negligible over the slab thickness.\n-   Assumption: The response quantity is proportional to photon fluence.\n-   Definition of uncollided component: Follows the linear attenuation law, $I(x) = I_0 \\exp(-\\mu x)$, where $\\mu$ is the linear attenuation coefficient.\n-   Definition of build-up factor: $B(E,x) = \\frac{\\text{Total response}}{\\text{Uncollided response}}$.\n-   Given value: For the specified conditions, the build-up factor is $B = 2$.\n-   Definition of the analyst's estimate: The response calculated using only the uncollided exponential attenuation (i.e., neglecting build-up).\n-   Definition of fractional error: $\\epsilon = \\frac{|\\text{physically correct total response} - \\text{no-build-up estimate}|}{\\text{physically correct total response}}$.\n-   Task: Derive an expression for the fractional error and evaluate it for $B=2$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded:** The problem is based on fundamental principles of radiation transport and shielding theory. The concepts of exponential attenuation, the point-kernel method, and the build-up factor are standard in nuclear engineering and health physics. The value of the build-up factor is physically plausible.\n-   **Well-Posed:** All terms are clearly defined. The question asks for a derivation based on the provided definitions, leading to a unique analytical expression for the fractional error in terms of the build-up factor. The subsequent numerical evaluation is straightforward.\n-   **Objective:** The language is technical and precise, with no subjective or ambiguous statements.\n\nThe problem is self-contained, scientifically sound, and well-posed. No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Solution Derivation\n\nLet us define the relevant quantities symbolically based on the problem statement.\nLet $R_t$ be the physically correct total response, which accounts for both uncollided and scattered photons.\nLet $R_u$ be the response due to the uncollided photons only.\nLet $R_{est}$ be the analyst's estimated response, which neglects build-up. By definition, this estimate is equal to the uncollided component's response:\n$$R_{est} = R_u$$\n\nThe build-up factor, $B$, is defined as the ratio of the total response to the uncollided response:\n$$B = \\frac{R_t}{R_u}$$\nThis definition is central to the problem. From this relationship, the total response can be expressed in terms of the uncollided response and the build-up factor:\n$$R_t = B \\cdot R_u$$\n\nThe problem asks for the fractional error, $\\epsilon$, which is defined as the magnitude of the difference between the correct total response and the estimated response, divided by the correct total response:\n$$\\epsilon = \\frac{|R_t - R_{est}|}{R_t}$$\n\nNow, we substitute the expressions for $R_t$ and $R_{est}$ in terms of $R_u$ and $B$ into the formula for $\\epsilon$:\n$$\\epsilon = \\frac{|(B \\cdot R_u) - R_u|}{B \\cdot R_u}$$\n\nWe can factor out $R_u$ from the term in the numerator:\n$$\\epsilon = \\frac{|(B - 1) R_u|}{B R_u}$$\n\nThe build-up factor $B$ accounts for the contribution of scattered photons. For any shielding material where scattering occurs, there will be more photons contributing to the response than just the uncollided ones. Therefore, the total response is greater than or equal to the uncollided response, which implies $B \\ge 1$. For any realistic situation with a finite slab thickness, scattering will occur, so $B > 1$. The problem provides a value of $B=2$. Thus, the term $(B-1)$ is positive. The response $R_u$ is a physical quantity (proportional to fluence) and must be non-negative. The absolute value signs can therefore be removed:\n$$\\epsilon = \\frac{(B - 1) R_u}{B R_u}$$\n\nAssuming a non-zero incident beam and a finite slab thickness, the uncollided response $R_u$ will be non-zero. We can therefore cancel $R_u$ from the numerator and the denominator:\n$$\\epsilon = \\frac{B - 1}{B}$$\nThis can be rewritten as:\n$$\\epsilon = 1 - \\frac{1}{B}$$\nThis is the general expression for the fractional error incurred by neglecting the build-up factor, derived solely from its definition. This expression is independent of the slab thickness $x$, the material's attenuation coefficient $\\mu$, and the initial beam intensity, as long as the value of $B$ for those conditions is known.\n\nThe final step is to evaluate this expression for the given build-up factor, $B=2$:\n$$\\epsilon = 1 - \\frac{1}{2}$$\n$$\\epsilon = \\frac{1}{2}$$\nAs a decimal number, this is:\n$$\\epsilon = 0.5$$\n\nThis result indicates that neglecting a build-up factor of $2$ leads to an underestimation of the total response by $50\\%$. The fractional error is $0.5$.",
            "answer": "$$\n\\boxed{0.5}\n$$"
        },
        {
            "introduction": "While the build-up factor corrects simple attenuation models, a more detailed physical description is often needed. Neutron diffusion theory provides a powerful analytical framework for this purpose. Since practical shields are rarely homogeneous, this exercise focuses on a multi-layer system, requiring you to apply the fundamental physical principles of flux and current continuity at material interfaces—a cornerstone skill for analyzing any heterogeneous reactor component .",
            "id": "4245195",
            "problem": "Consider a one-dimensional, one-energy-group steady-state neutron diffusion model of a planar, two-layer shield in slab geometry. Let the coordinate $x$ measure distance normal to the shield, with $x=0$ at the shield inner surface, $x=a$ at the interface between the two layers, and $x=a+b$ at the shield outer surface. Layer $1$ occupies $0 \\leq x \\leq a$ and is homogeneous with diffusion coefficient $D_{1} > 0$ and macroscopic absorption cross section $\\Sigma_{a,1} > 0$. Layer $2$ occupies $a \\leq x \\leq a+b$ and is homogeneous with diffusion coefficient $D_{2} > 0$ and macroscopic absorption cross section $\\Sigma_{a,2} > 0$. Assume no volumetric neutron sources in the shield, and use the diffusion approximation derived from the steady-state neutron balance together with Fick’s law, where the neutron current density satisfies $J(x) = - D(x)\\, d\\phi(x)/dx$ and the neutron scalar flux $\\phi(x)$ satisfies the steady continuity equation.\n\nBoundary conditions are as follows:\n- At the inner surface $x=0$, the scalar flux is prescribed as $\\phi(0) = \\phi_{0}$, with $\\phi_{0} > 0$ known.\n- At the outer surface $x = a + b$, the boundary is reflecting, so the normal current is zero: $J(a+b) = 0$.\n\nStarting from first principles (steady-state neutron balance and Fick’s law), derive the diffusion equation in each layer, obtain its general solution, and enforce physically appropriate interface conditions at $x = a$. Specifically, state and justify which quantities are continuous across $x=a$ for this multilayer shield, and use those conditions to obtain a closed-form analytic expression for the neutron current at the interface,\n$$\nJ(a),\n$$\nin terms of $D_{1}$, $D_{2}$, $\\Sigma_{a,1}$, $\\Sigma_{a,2}$, $a$, $b$, and $\\phi_{0}$. Define $k_{1} \\equiv \\sqrt{\\Sigma_{a,1}/D_{1}}$ and $k_{2} \\equiv \\sqrt{\\Sigma_{a,2}/D_{2}}$ to simplify your expression. Your final answer must be a single closed-form analytic expression. For physical interpretation, the unit of $J(a)$ is neutrons per square centimeter per second. Do not include units in the final boxed expression.",
            "solution": "The user wants me to solve the problem by following these steps.\n1.  **Validate the Problem:**\n    *   **Extract Givens:**\n        *   Geometry: One-dimensional, two-layer slab. Layer 1: $0 \\leq x \\leq a$. Layer 2: $a \\leq x \\leq a+b$.\n        *   Material Properties:\n            *   Layer 1: Diffusion coefficient $D_{1} > 0$, macroscopic absorption cross section $\\Sigma_{a,1} > 0$.\n            *   Layer 2: Diffusion coefficient $D_{2} > 0$, macroscopic absorption cross section $\\Sigma_{a,2} > 0$.\n        *   Source Term: No volumetric neutron sources.\n        *   Governing Physics: One-group, steady-state neutron diffusion. Fick's Law: $J(x) = - D(x)\\, d\\phi(x)/dx$.\n        *   Boundary Conditions:\n            *   At $x=0$: Scalar flux $\\phi(0) = \\phi_{0}$, with $\\phi_{0} > 0$.\n            *   At $x=a+b$: Reflecting boundary, $J(a+b) = 0$.\n        *   Definitions: $k_{1} \\equiv \\sqrt{\\Sigma_{a,1}/D_{1}}$, $k_{2} \\equiv \\sqrt{\\Sigma_{a,2}/D_{2}}$.\n        *   Objective: Derive an expression for the neutron current at the interface, $J(a)$.\n    *   **Validate Using Extracted Givens:**\n        *   **Scientifically Grounded:** The problem is a standard application of one-group neutron diffusion theory, a fundamental and well-established model in nuclear reactor physics and engineering.\n        *   **Well-Posed:** The problem provides two second-order ordinary differential equations (one for each layer), yielding four constants of integration. The two boundary conditions and two physically-required interface conditions (continuity of flux and current) provide a total of four constraints, which is sufficient to determine a unique solution.\n        *   **Objective:** The problem is stated in precise, quantitative terms without ambiguity or subjective elements.\n        *   The problem does not exhibit any of the flaws listed in the instructions (e.g., scientific unsoundness, incompleteness, contradiction). The parameters are physically meaningful ($D > 0, \\Sigma_a > 0$).\n    *   **Verdict and Action:** The problem is valid. A solution will be derived.\n\nThe solution proceeds as follows, starting from first principles.\n\nThe steady-state neutron balance equation for a one-dimensional system with no sources is given by:\n$$\n\\frac{dJ(x)}{dx} + \\Sigma_a(x) \\phi(x) = 0\n$$\nwhere $J(x)$ is the neutron current density, $\\phi(x)$ is the neutron scalar flux, and $\\Sigma_a(x)$ is the macroscopic absorption cross section. Fick's law relates the current to the flux gradient:\n$$\nJ(x) = -D(x) \\frac{d\\phi(x)}{dx}\n$$\nwhere $D(x)$ is the diffusion coefficient. Substituting Fick's law into the balance equation yields the neutron diffusion equation:\n$$\n-\\frac{d}{dx}\\left(D(x) \\frac{d\\phi(x)}{dx}\\right) + \\Sigma_a(x) \\phi(x) = 0\n$$\nWithin each homogeneous layer, $D$ and $\\Sigma_a$ are constants, so the equation simplifies to:\n$$\n-D \\frac{d^2\\phi(x)}{dx^2} + \\Sigma_a \\phi(x) = 0 \\implies \\frac{d^2\\phi(x)}{dx^2} - \\frac{\\Sigma_a}{D} \\phi(x) = 0\n$$\nWe define the inverse diffusion length $k \\equiv \\sqrt{\\Sigma_a/D}$. The diffusion equation in each layer becomes a standard second-order homogeneous ODE.\n\nFor Layer 1 ($0 \\le x \\le a$), with $k_1 = \\sqrt{\\Sigma_{a,1}/D_1}$, the flux $\\phi_1(x)$ satisfies:\n$$\n\\frac{d^2\\phi_1(x)}{dx^2} - k_1^2 \\phi_1(x) = 0\n$$\nThe general solution can be written using hyperbolic functions:\n$$\n\\phi_1(x) = C_1 \\cosh(k_1 x) + S_1 \\sinh(k_1 x)\n$$\n\nFor Layer 2 ($a \\le x \\le a+b$), with $k_2 = \\sqrt{\\Sigma_{a,2}/D_2}$, the flux $\\phi_2(x)$ satisfies:\n$$\n\\frac{d^2\\phi_2(x)}{dx^2} - k_2^2 \\phi_2(x) = 0\n$$\nThe general solution, written in a form convenient for the boundary at $x=a+b$, is:\n$$\n\\phi_2(x) = C_2 \\cosh(k_2(x - (a+b))) + S_2 \\sinh(k_2(x - (a+b)))\n$$\n\nNext, we apply the boundary conditions to determine the four integration constants ($C_1, S_1, C_2, S_2$).\nAt $x=0$, the flux is prescribed: $\\phi_1(0) = \\phi_0$.\n$$\n\\phi_0 = C_1 \\cosh(0) + S_1 \\sinh(0) \\implies C_1 = \\phi_0\n$$\nSo, the solution in Layer 1 is $\\phi_1(x) = \\phi_0 \\cosh(k_1 x) + S_1 \\sinh(k_1 x)$.\n\nAt $x=a+b$, the boundary is reflecting, meaning the current is zero: $J(a+b) = 0$.\nThe current in Layer 2 is $J_2(x) = -D_2 \\frac{d\\phi_2}{dx}$.\n$$\nJ_2(x) = -D_2 k_2 \\left[ C_2 \\sinh(k_2(x - (a+b))) + S_2 \\cosh(k_2(x - (a+b))) \\right]\n$$\nApplying $J_2(a+b)=0$:\n$$\n0 = -D_2 k_2 \\left[ C_2 \\sinh(0) + S_2 \\cosh(0) \\right] = -D_2 k_2 S_2\n$$\nSince $D_2 > 0$ and $k_2 > 0$, we must have $S_2=0$.\nSo, the solution in Layer 2 is $\\phi_2(x) = C_2 \\cosh(k_2(x - (a+b)))$.\n\nAt the interface $x=a$, two physical conditions must be met:\n1.  **Continuity of Flux**: The neutron scalar flux must be continuous, as it represents a particle density which cannot be discontinuous at a physical boundary. So, $\\phi_1(a) = \\phi_2(a)$.\n2.  **Continuity of Current**: The neutron current must be continuous as a consequence of particle conservation. There are no sources or sinks at the infinitely thin interface plane. So, $J_1(a) = J_2(a)$.\n\nApplying these two interface conditions will yield a system of two equations for the remaining two unknowns, $S_1$ and $C_2$.\n\nCondition 1: $\\phi_1(a) = \\phi_2(a)$\n$$\n\\phi_0 \\cosh(k_1 a) + S_1 \\sinh(k_1 a) = C_2 \\cosh(k_2(a - (a+b))) = C_2 \\cosh(-k_2 b)\n$$\nUsing the even property of cosh, $\\cosh(-z) = \\cosh(z)$:\n$$\n\\phi_0 \\cosh(k_1 a) + S_1 \\sinh(k_1 a) = C_2 \\cosh(k_2 b) \\quad (1)\n$$\n\nCondition 2: $J_1(a) = J_2(a)$, which is $-D_1 \\frac{d\\phi_1}{dx}\\Big|_{x=a} = -D_2 \\frac{d\\phi_2}{dx}\\Big|_{x=a}$.\nFirst, we find the currents in each region:\n$J_1(x) = -D_1 \\frac{d\\phi_1}{dx} = -D_1 k_1 \\left[ \\phi_0 \\sinh(k_1 x) + S_1 \\cosh(k_1 x) \\right]$.\n$J_2(x) = -D_2 \\frac{d\\phi_2}{dx} = -D_2 k_2 C_2 \\sinh(k_2(x - (a+b)))$.\nAt $x=a$:\n$-D_1 k_1 \\left[ \\phi_0 \\sinh(k_1 a) + S_1 \\cosh(k_1 a) \\right] = -D_2 k_2 C_2 \\sinh(k_2(a - (a+b))) = -D_2 k_2 C_2 \\sinh(-k_2 b)$.\nUsing the odd property of sinh, $\\sinh(-z) = -\\sinh(z)$:\n$$\n-D_1 k_1 \\left[ \\phi_0 \\sinh(k_1 a) + S_1 \\cosh(k_1 a) \\right] = D_2 k_2 C_2 \\sinh(k_2 b) \\quad (2)\n$$\n\nThe quantity to be found is $J(a)$. From continuity, $J(a) = J_1(a) = J_2(a)$. From the derivation of Eq. (2), we see immediately that $J(a) = J_2(a) = D_2 k_2 C_2 \\sinh(k_2 b)$. To find $J(a)$, we only need to solve the system for $C_2$.\n\nFrom Eq. (2), we can express $S_1$ in terms of $C_2$:\n$$\n\\phi_0 \\sinh(k_1 a) + S_1 \\cosh(k_1 a) = -\\frac{D_2 k_2}{D_1 k_1} C_2 \\sinh(k_2 b)\n$$\n$$\nS_1 = -\\frac{\\phi_0 \\sinh(k_1 a)}{\\cosh(k_1 a)} - \\frac{D_2 k_2 \\sinh(k_2 b)}{D_1 k_1 \\cosh(k_1 a)} C_2\n$$\nSubstitute this expression for $S_1$ into Eq. (1):\n$$\n\\phi_0 \\cosh(k_1 a) + \\left( -\\frac{\\phi_0 \\sinh(k_1 a)}{\\cosh(k_1 a)} - \\frac{D_2 k_2 \\sinh(k_2 b)}{D_1 k_1 \\cosh(k_1 a)} C_2 \\right) \\sinh(k_1 a) = C_2 \\cosh(k_2 b)\n$$\nMultiply the entire equation by $\\cosh(k_1 a)$ to clear the denominator:\n$$\n\\phi_0 \\cosh^2(k_1 a) - \\phi_0 \\sinh^2(k_1 a) - \\frac{D_2 k_2}{D_1 k_1} C_2 \\sinh(k_2 b) \\sinh(k_1 a) = C_2 \\cosh(k_2 b) \\cosh(k_1 a)\n$$\nUsing the hyperbolic identity $\\cosh^2(z) - \\sinh^2(z) = 1$:\n$$\n\\phi_0 = C_2 \\cosh(k_2 b) \\cosh(k_1 a) + \\frac{D_2 k_2}{D_1 k_1} C_2 \\sinh(k_2 b) \\sinh(k_1 a)\n$$\nFactor out $C_2$:\n$$\n\\phi_0 = C_2 \\left( \\cosh(k_1 a) \\cosh(k_2 b) + \\frac{D_2 k_2}{D_1 k_1} \\sinh(k_1 a) \\sinh(k_2 b) \\right)\n$$\nSolve for $C_2$:\n$$\nC_2 = \\frac{\\phi_0}{\\cosh(k_1 a) \\cosh(k_2 b) + \\frac{D_2 k_2}{D_1 k_1} \\sinh(k_1 a) \\sinh(k_2 b)}\n$$\nMultiply the numerator and denominator by $D_1 k_1$ for a cleaner form:\n$$\nC_2 = \\frac{D_1 k_1 \\phi_0}{D_1 k_1 \\cosh(k_1 a) \\cosh(k_2 b) + D_2 k_2 \\sinh(k_1 a) \\sinh(k_2 b)}\n$$\nFinally, substitute this expression for $C_2$ into the formula for the interface current, $J(a) = D_2 k_2 C_2 \\sinh(k_2 b)$:\n$$\nJ(a) = D_2 k_2 \\sinh(k_2 b) \\left( \\frac{D_1 k_1 \\phi_0}{D_1 k_1 \\cosh(k_1 a) \\cosh(k_2 b) + D_2 k_2 \\sinh(k_1 a) \\sinh(k_2 b)} \\right)\n$$\nThis gives the final closed-form expression for the neutron current at the interface:\n$$\nJ(a) = \\frac{D_1 k_1 D_2 k_2 \\phi_0 \\sinh(k_2 b)}{D_1 k_1 \\cosh(k_1 a) \\cosh(k_2 b) + D_2 k_2 \\sinh(k_1 a) \\sinh(k_2 b)}\n$$\nThe expression is in terms of the specified parameters $D_1, D_2, k_1, k_2, a, b, \\phi_0$.",
            "answer": "$$\n\\boxed{\\frac{D_{1} k_{1} D_{2} k_{2} \\phi_{0} \\sinh(k_{2} b)}{D_{1} k_{1} \\cosh(k_{1} a) \\cosh(k_{2} b) + D_{2} k_{2} \\sinh(k_{1} a) \\sinh(k_{2} b)}}\n$$"
        },
        {
            "introduction": "To achieve the highest fidelity in shielding analysis, we must move beyond approximate models like diffusion theory and solve the Boltzmann transport equation directly. This practice guides you through setting up a computational solution using the Discrete Ordinates ($S_N$) method, a workhorse algorithm in reactor physics. You will translate physical parameters—material cross sections, source definitions, and boundary conditions—into a numerical model, bridging the gap between fundamental theory and modern simulation practice .",
            "id": "4245217",
            "problem": "You are asked to construct a two-energy-group Discrete Ordinates ($S_N$) calculation for a one-dimensional slab that consists of a layer of lead followed by a layer of polyethylene. The slab is irradiated on the left boundary by an incident fast neutron source. The objective is to compute transmitted and reflected boundary currents, as well as slab-averaged scalar fluxes, under specified boundary conditions and material scattering matrices. The formulation must start from the one-dimensional neutron transport equation in slab geometry with isotropic scattering, written for energy group $g \\in \\{0,1\\}$ as\n$$\n\\mu \\frac{d \\psi_g(x,\\mu)}{dx} + \\Sigma_{t,g}(x) \\psi_g(x,\\mu) = \\sum_{g'=0}^{1} \\frac{\\Sigma_{s,g' \\rightarrow g}(x)}{2} \\, \\phi_{g'}(x) + S_g(x,\\mu),\n$$\nwhere $x \\in [0, L]$ is position in the slab, $\\mu \\in [-1,1]$ is the direction cosine, $\\psi_g(x,\\mu)$ is the angular flux for group $g$, $\\Sigma_{t,g}(x)$ is the total macroscopic cross section, $\\Sigma_{s,g' \\rightarrow g}(x)$ is the isotropic scattering macroscopic cross section from group $g'$ to $g$, $\\phi_g(x) = \\int_{-1}^{1} \\psi_g(x,\\mu)\\,d\\mu$ is the scalar flux for group $g$, and $S_g(x,\\mu)$ is any external source term. In this problem, $S_g(x,\\mu)$ is zero in the interior ($x \\in (0,L)$), and the only external source is a half-range isotropic incident fast neutron source applied as a boundary condition at $x=0$.\n\nYou must implement the $S_N$ discrete ordinates method using Gauss-Legendre quadrature with $N$ directions, and the diamond-difference spatial discretization for the streaming-collision operator on a uniform spatial mesh of cell width $\\Delta x$. For each direction $\\mu_m$ and weight $w_m$ from the quadrature, the diamond-difference update across a cell of width $\\Delta x$ with constant $\\Sigma_{t,g}$ and source $q_g$ must be used to march angular fluxes, ensuring that the directional sweep is performed from left-to-right for $\\mu_m > 0$ and from right-to-left for $\\mu_m < 0$. The isotropic scattering source per group is defined by\n$$\nq_g(x) = \\sum_{g'=0}^{1} \\frac{\\Sigma_{s,g' \\rightarrow g}(x)}{2} \\, \\phi_{g'}(x).\n$$\nGroup coupling through scattering must be treated by source iteration until convergence. Use a relative tolerance of $10^{-10}$ and a maximum of $10000$ iterations. The scalar flux is reconstructed at the cell centers from angular fluxes by discrete angular integration.\n\nBoundary conditions:\n- At $x=0$ (left boundary): for the fast group ($g=0$), impose a half-range isotropic incident angular flux of constant magnitude $I_0$ for all $\\mu_m > 0$, i.e., $\\psi_{0}(0,\\mu_m) = I_0$ for all $\\mu_m > 0$; for the thermal group ($g=1$), impose vacuum for incoming directions $\\mu_m > 0$, i.e., $\\psi_{1}(0,\\mu_m) = 0$ for all $\\mu_m > 0$.\n- At $x=L$ (right boundary): use either vacuum (i.e., $\\psi_{g}(L,\\mu_m) = 0$ for all $\\mu_m < 0$) or specular reflection (i.e., $\\psi_{g}(L,\\mu_m<0) = \\psi_{g}(L,|\\mu_m|)$), depending on the test case.\n\nGeometry and materials:\n- The slab is composed of lead (left layer) of thickness $L_{\\text{Pb}}$ followed by polyethylene (right layer) of thickness $L_{\\text{PE}}$, so the total slab thickness is $L = L_{\\text{Pb}} + L_{\\text{PE}}$. The spatial mesh must cover $[0,L]$ uniformly with cell width $\\Delta x$, with piecewise constant material properties in each layer.\n- Lead material cross sections are denoted by $\\Sigma_{t,g}^{\\text{Pb}}$ and $\\Sigma_{s,g' \\rightarrow g}^{\\text{Pb}}$.\n- Polyethylene (PE) material cross sections are denoted by $\\Sigma_{t,g}^{\\text{PE}}$ and $\\Sigma_{s,g' \\rightarrow g}^{\\text{PE}}$.\n- All macroscopic cross sections are in units of $\\text{cm}^{-1}$.\n- Neglect upscattering from thermal to fast in test cases where it is not specified (set $\\Sigma_{s,1 \\rightarrow 0} = 0$ when omitted).\n\nOutputs to compute per test case:\n- The transmitted right-boundary outward current for group $g$:\n$$\nJ_{g}^{\\text{out}} = \\sum_{\\mu_m > 0} w_m \\, \\mu_m \\, \\psi_g(L,\\mu_m),\n$$\n- The reflected left-boundary outward current for the fast group ($g=0$):\n$$\nJ_{0}^{\\text{ref}} = \\sum_{\\mu_m < 0} w_m \\, |\\mu_m| \\, \\psi_0(0,\\mu_m),\n$$\n- The slab-averaged scalar flux for the specified group(s):\n$$\n\\bar{\\phi}_g = \\frac{1}{L} \\int_0^L \\phi_g(x) \\, dx,\n\\quad\n\\bar{\\phi}_{\\text{tot}} = \\frac{1}{L} \\int_0^L \\left( \\phi_0(x) + \\phi_1(x) \\right) \\, dx.\n$$\n\nUnits:\n- The incident angular flux magnitude $I_0$ is in neutrons per square centimeter per second per steradian.\n- The currents $J_{g}^{\\text{out}}$ and $J_{0}^{\\text{ref}}$ must be reported in neutrons per square centimeter per second.\n- The scalar fluxes $\\bar{\\phi}_g$ and $\\bar{\\phi}_{\\text{tot}}$ must be reported in neutrons per square centimeter per second.\n\nTest suite:\nProvide the following three scientifically plausible test cases with distinct boundary conditions, $S_N$ orders, and scattering matrices. Use the specified values exactly.\n\n- Test case $1$ (happy path, vacuum transmission through lead plus polyethylene):\n  - Discrete ordinates order: $N = 8$.\n  - Layer thicknesses: $L_{\\text{Pb}} = 5.0 \\,\\text{cm}$, $L_{\\text{PE}} = 10.0 \\,\\text{cm}$, so $L = 15.0 \\,\\text{cm}$.\n  - Spatial mesh: $\\Delta x = 0.05 \\,\\text{cm}$.\n  - Right boundary: vacuum.\n  - Incident fast boundary angular flux magnitude: $I_0 = 1.0$.\n  - Lead cross sections:\n    - $\\Sigma_{t,0}^{\\text{Pb}} = 0.8 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 0}^{\\text{Pb}} = 0.7 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 1}^{\\text{Pb}} = 0.05 \\,\\text{cm}^{-1}$,\n    - $\\Sigma_{t,1}^{\\text{Pb}} = 1.2 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 1}^{\\text{Pb}} = 1.0 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 0}^{\\text{Pb}} = 0.0 \\,\\text{cm}^{-1}$.\n  - Polyethylene cross sections:\n    - $\\Sigma_{t,0}^{\\text{PE}} = 0.5 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 0}^{\\text{PE}} = 0.3 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 1}^{\\text{PE}} = 0.15 \\,\\text{cm}^{-1}$,\n    - $\\Sigma_{t,1}^{\\text{PE}} = 0.7 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 1}^{\\text{PE}} = 0.65 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 0}^{\\text{PE}} = 0.0 \\,\\text{cm}^{-1}$.\n  - Required outputs: $[ J_{0}^{\\text{out}}, J_{1}^{\\text{out}}, \\bar{\\phi}_0 ]$.\n\n- Test case $2$ (boundary condition edge case, pure polyethylene with specular reflection at right boundary):\n  - Discrete ordinates order: $N = 4$.\n  - Layer thicknesses: $L_{\\text{Pb}} = 0.0 \\,\\text{cm}$, $L_{\\text{PE}} = 5.0 \\,\\text{cm}$, so $L = 5.0 \\,\\text{cm}$.\n  - Spatial mesh: $\\Delta x = 0.05 \\,\\text{cm}$.\n  - Right boundary: reflecting (specular).\n  - Incident fast boundary angular flux magnitude: $I_0 = 1.0$.\n  - Polyethylene cross sections:\n    - $\\Sigma_{t,0}^{\\text{PE}} = 0.5 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 0}^{\\text{PE}} = 0.2 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 1}^{\\text{PE}} = 0.25 \\,\\text{cm}^{-1}$,\n    - $\\Sigma_{t,1}^{\\text{PE}} = 0.6 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 1}^{\\text{PE}} = 0.55 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 0}^{\\text{PE}} = 0.0 \\,\\text{cm}^{-1}$.\n  - Required outputs: $[ J_{0}^{\\text{ref}}, \\bar{\\phi}_1, J_{0}^{\\text{out}} ]$.\n\n- Test case $3$ (strong attenuation edge case, thick lead followed by thin polyethylene, vacuum right boundary):\n  - Discrete ordinates order: $N = 2$.\n  - Layer thicknesses: $L_{\\text{Pb}} = 20.0 \\,\\text{cm}$, $L_{\\text{PE}} = 1.0 \\,\\text{cm}$, so $L = 21.0 \\,\\text{cm}$.\n  - Spatial mesh: $\\Delta x = 0.10 \\,\\text{cm}$.\n  - Right boundary: vacuum.\n  - Incident fast boundary angular flux magnitude: $I_0 = 1.0$.\n  - Lead cross sections:\n    - $\\Sigma_{t,0}^{\\text{Pb}} = 1.0 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 0}^{\\text{Pb}} = 0.6 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 1}^{\\text{Pb}} = 0.02 \\,\\text{cm}^{-1}$,\n    - $\\Sigma_{t,1}^{\\text{Pb}} = 1.5 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 1}^{\\text{Pb}} = 1.3 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 0}^{\\text{Pb}} = 0.0 \\,\\text{cm}^{-1}$.\n  - Polyethylene cross sections:\n    - $\\Sigma_{t,0}^{\\text{PE}} = 0.5 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 0}^{\\text{PE}} = 0.3 \\,\\text{cm}^{-1}$, $\\Sigma_{s,0 \\rightarrow 1}^{\\text{PE}} = 0.15 \\,\\text{cm}^{-1}$,\n    - $\\Sigma_{t,1}^{\\text{PE}} = 0.7 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 1}^{\\text{PE}} = 0.65 \\,\\text{cm}^{-1}$, $\\Sigma_{s,1 \\rightarrow 0}^{\\text{PE}} = 0.0 \\,\\text{cm}^{-1}$.\n  - Required outputs: $[ J_{0}^{\\text{out}}, J_{1}^{\\text{out}}, \\bar{\\phi}_{\\text{tot}} ]$.\n\nYour program must solve each test case independently, using the formulation above, and aggregate the three test case results into a single line. The final output format must be a single line containing the three result lists as a comma-separated list enclosed in square brackets, with each inner list containing the specified floats in order, for example:\n$[ [a_1,a_2,a_3], [b_1,b_2,b_3], [c_1,c_2,c_3] ]$.\nAll outputs must be in the units specified above. No user input is required; the parameter values are fixed as given. Ensure scientific realism by strictly using the provided cross sections and boundary conditions, and by performing source iteration until the stated convergence tolerance is met.",
            "solution": "The problem is valid. It presents a well-posed, scientifically sound problem in computational neutron transport theory. All necessary data, equations, boundary conditions, and numerical parameters are provided, and they are internally consistent and physically plausible. The problem requires the implementation of a standard, verifiable numerical method (Discrete Ordinates with Diamond-Differencing and Source Iteration) to solve the linear neutron transport equation in a shielding configuration.\n\nThe solution is constructed by numerically solving the one-dimensional, two-energy-group neutron transport equation for a slab geometry, given as:\n$$\n\\mu \\frac{d \\psi_g(x,\\mu)}{dx} + \\Sigma_{t,g}(x) \\psi_g(x,\\mu) = Q_g(x)\n$$\nwhere $g \\in \\{0,1\\}$ is the energy group index, $\\psi_g(x,\\mu)$ is the angular neutron flux at position $x$ traveling in direction $\\mu$ (the cosine of the angle with the x-axis), and $\\Sigma_{t,g}(x)$ is the total macroscopic cross section. The term $Q_g(x)$ represents the total source of neutrons into group $g$ at position $x$, which for isotropic scattering is given by:\n$$\nQ_g(x) = \\frac{1}{2} \\sum_{g'=0}^{1} \\Sigma_{s,g' \\rightarrow g}(x) \\phi_{g'}(x)\n$$\nHere, $\\Sigma_{s,g' \\rightarrow g}(x)$ is the scattering cross section from group $g'$ to group $g$, and $\\phi_{g'}(x)$ is the scalar flux, defined by the angular integral $\\phi_{g'}(x) = \\int_{-1}^{1} \\psi_{g'}(x,\\mu) d\\mu$. The problem specifies no internal source, so the source term consists only of scattering.\n\nThe solution methodology is based on the Discrete Ordinates ($S_N$) method, which involves discretization in both angle and space.\n\n**1. Angular Discretization (Discrete Ordinates)**\nThe continuous angular variable $\\mu \\in [-1, 1]$ is replaced by a discrete set of $N$ ordinates (directions) $\\{\\mu_m\\}$ and corresponding quadrature weights $\\{w_m\\}$, for $m=0, \\dots, N-1$. These are chosen as the abscissas and weights of an $N$-th order Gauss-Legendre quadrature. This transforms the single integro-differential transport equation into a system of $N \\times G$ coupled ordinary differential equations, one for each direction $m$ and group $g$:\n$$\n\\mu_m \\frac{d \\psi_{g,m}(x)}{dx} + \\Sigma_{t,g}(x) \\psi_{g,m}(x) = \\frac{1}{2} \\sum_{g'=0}^{1} \\Sigma_{s,g' \\rightarrow g}(x) \\sum_{m'=0}^{N-1} w_{m'} \\psi_{g',m'}(x)\n$$\nwhere $\\psi_{g,m}(x) \\equiv \\psi_g(x, \\mu_m)$.\n\n**2. Spatial Discretization (Diamond-Difference)**\nThe spatial domain $x \\in [0, L]$ is divided into a uniform mesh of $J$ cells, each of width $\\Delta x$. The cell boundaries are located at $x_{i-1/2}$ and $x_{i+1/2}$, and cell centers at $x_i$, for $i=0, \\dots, J-1$. Within each cell $i$, the cross sections are assumed to be constant. Integrating the discrete ordinates equation over cell $i$ yields:\n$$\n\\mu_m \\frac{\\psi_{g,m,i+1/2} - \\psi_{g,m,i-1/2}}{\\Delta x} + \\Sigma_{t,g,i} \\psi_{g,m,i} = Q_{g,i}\n$$\nwhere $\\psi_{g,m,i\\pm1/2}$ are the cell-edge angular fluxes and $\\psi_{g,m,i}$ and $Q_{g,i}$ are the cell-average angular flux and source, respectively. The Diamond-Difference (DD) method provides a closure relation linking the cell-average and cell-edge fluxes:\n$$\n\\psi_{g,m,i} = \\frac{\\psi_{g,m,i+1/2} + \\psi_{g,m,i-1/2}}{2}\n$$\nSubstituting this into the balance equation and rearranging allows for the calculation of the outgoing flux from a cell based on its incoming flux. For a sweep in the direction of increasing $x$ ($\\mu_m > 0$), the incoming flux is $\\psi_{g,m,i-1/2}$ and the outgoing flux is $\\psi_{g,m,i+1/2}$:\n$$\n\\psi_{g,m,i+1/2} = \\frac{\\left(1 - \\frac{\\Sigma_{t,g,i}\\Delta x}{2\\mu_m}\\right)\\psi_{g,m,i-1/2} + \\frac{Q_{g,i}\\Delta x}{\\mu_m}}{\\left(1 + \\frac{\\Sigma_{t,g,i}\\Delta x}{2\\mu_m}\\right)}\n$$\nA similar expression is derived for sweeps in the direction of decreasing $x$ ($\\mu_m < 0$).\n\n**3. Solution Algorithm: Source Iteration with Transport Sweeps**\nThe right-hand side (the scattering source) depends on the scalar flux, which in turn depends on the solution (the angular flux) we are trying to find. This circular dependency is resolved using an iterative scheme known as source iteration.\n\nThe algorithm proceeds as follows:\na. Initialize the scalar flux $\\phi_g(x)$ for all groups to zero.\nb. Begin the iteration loop, indexed by $k$.\nc. Calculate the cell-average scattering source $Q_{g,i}^{(k)}$ using the scalar flux from the previous iteration, $\\phi_{g',i}^{(k-1)}$:\n$$\nQ_{g,i}^{(k)} = \\frac{1}{2} \\sum_{g'=0}^{1} \\Sigma_{s,g' \\rightarrow g,i} \\phi_{g',i}^{(k-1)}\n$$\nd. For each energy group $g$, perform a transport sweep to solve for the angular fluxes $\\psi_{g,m,i\\pm1/2}^{(k)}$. The sweep proceeds across the spatial mesh cell by cell.\n   - For directions with $\\mu_m > 0$, the sweep starts at the left boundary ($x=0$) and proceeds to the right. The incoming flux at the first cell, $\\psi_{g,m,-1/2}$, is given by the specified left-boundary condition ($\\psi_0(0, \\mu_m) = I_0$ for $g=0$, $\\psi_1(0, \\mu_m)=0$ for $g=1$).\n   - For directions with $\\mu_m < 0$, the sweep starts at the right boundary ($x=L$) and proceeds to the left. The incoming flux at the last cell, $\\psi_{g,m,J-1/2}$, is given by the specified right-boundary condition. For a vacuum boundary, it is zero. For a specular reflecting boundary, it is set to the outgoing flux in the corresponding positive direction, i.e., $\\psi_{g}(L, \\mu_m) = \\psi_{g}(L, -\\mu_m)$.\ne. After the sweeps for all directions are complete, update the cell-average scalar flux for the current iteration, $\\phi_{g,i}^{(k)}$, by numerically integrating the new cell-average angular fluxes:\n$$\n\\phi_{g,i}^{(k)} = \\sum_{m=0}^{N-1} w_m \\psi_{g,m,i}^{(k)}\n$$\nf. Check for convergence. The total slab-integrated scalar flux is computed for the current and previous iterations. The iteration is considered converged if the relative difference between these two values is less than the specified tolerance ($10^{-10}$). If not converged, return to step (c) for the next iteration.\ng. Once converged, the final flux distribution is used to compute the required output quantities. The transmitted current $J_g^{\\text{out}}$ is the sum of particles crossing the right boundary in positive directions. The reflected current $J_0^{\\text{ref}}$ is the sum of particles crossing the left boundary in negative directions. The slab-averaged scalar flux $\\bar{\\phi}_g$ is the spatial average of the cell-center scalar flux. These are calculated using their discretized definitions provided in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef solve():\n    \"\"\"\n    Main function to define, run, and print results for all test cases.\n    \"\"\"\n\n    class S_N_Solver:\n        \"\"\"\n        A class to solve the 1D, two-group S_N transport equation.\n        \"\"\"\n        def __init__(self, N, L_Pb, L_PE, dx, bc_right, I0, xs_Pb, xs_PE):\n            \"\"\"\n            Initializes the solver with problem parameters.\n            \"\"\"\n            self.N = N\n            self.G = 2  # Number of energy groups\n            self.L_Pb = float(L_Pb)\n            self.L_PE = float(L_PE)\n            self.L = self.L_Pb + self.L_PE\n            self.dx = float(dx)\n            # Ensure number of cells is an integer\n            self.J = int(round(self.L / self.dx))\n            self.bc_right = bc_right  # 'vacuum' or 'reflecting'\n            self.I0 = float(I0)\n            \n            # Generate Gauss-Legendre quadrature set and sort by mu\n            mu, w = leggauss(N)\n            idx = np.argsort(mu)\n            self.mu = mu[idx]\n            self.w = w[idx]\n            \n            # Set up a positive-mu index for convenience\n            self.pos_mu_indices = np.where(self.mu > 0)[0]\n\n            # Set up material properties on the spatial mesh\n            self.sigma_t = np.zeros((self.G, self.J))\n            self.sigma_s = np.zeros((self.G, self.G, self.J))\n            \n            num_cells_pb = int(round(self.L_Pb / self.dx))\n            \n            if num_cells_pb > 0:\n                self.sigma_t[:, :num_cells_pb] = np.array(xs_Pb['t']).reshape(-1, 1)\n                self.sigma_s[:, :, :num_cells_pb] = np.array(xs_Pb['s']).reshape(self.G, self.G, 1)\n            \n            if self.L_PE > 0:\n                self.sigma_t[:, num_cells_pb:] = np.array(xs_PE['t']).reshape(-1, 1)\n                self.sigma_s[:, :, num_cells_pb:] = np.array(xs_PE['s']).reshape(self.G, self.G, 1)\n\n        def run_solver(self, tol=1e-10, max_iter=10000):\n            \"\"\"\n            Executes the source iteration algorithm until convergence.\n            \"\"\"\n            phi = np.zeros((self.G, self.J))\n            phi_old_integral = 0.0\n\n            for k in range(max_iter):\n                \n                # Calculate scattering source term: q_g = 0.5 * sum_g' (sigma_s_g'->g * phi_g')\n                q = 0.5 * np.einsum('fgj, fj -> gj', self.sigma_s, phi, optimize=True)\n\n                psi_edge = np.zeros((self.G, self.N, self.J + 1))\n                \n                for g in range(self.G):\n                    # Left Boundary Condition (x=0) for mu > 0\n                    if g == 0:  # Fast group\n                        psi_edge[g, self.pos_mu_indices, 0] = self.I0\n                    else:  # Thermal group\n                        psi_edge[g, self.pos_mu_indices, 0] = 0.0\n                    \n                    # Forward sweep (mu > 0)\n                    for m in self.pos_mu_indices:\n                        mu_m = self.mu[m]\n                        for i in range(self.J):\n                            psi_in = psi_edge[g, m, i]\n                            term = self.sigma_t[g, i] * self.dx / (2.0 * mu_m)\n                            psi_out = ( (1.0 - term) * psi_in + q[g, i] * self.dx / mu_m ) / (1.0 + term)\n                            psi_edge[g, m, i + 1] = psi_out\n                    \n                    # Right Boundary Condition (x=L) for mu < 0\n                    neg_mu_indices = np.where(self.mu < 0)[0]\n                    if self.bc_right == 'reflecting':\n                        # mu_m < 0 are indices m < N/2. mu_{N-1-m} = -mu_m\n                        for m in neg_mu_indices:\n                            psi_edge[g, m, self.J] = psi_edge[g, self.N - 1 - m, self.J]\n                    else:  # vacuum\n                        psi_edge[g, neg_mu_indices, self.J] = 0.0\n\n                    # Backward sweep (mu < 0)\n                    for m in reversed(neg_mu_indices):\n                        mu_m = self.mu[m]\n                        for i in range(self.J - 1, -1, -1):\n                            psi_in = psi_edge[g, m, i + 1]\n                            term = self.sigma_t[g, i] * self.dx / (2.0 * abs(mu_m))\n                            psi_out = ( (1.0 - term) * psi_in + q[g, i] * self.dx / abs(mu_m) ) / (1.0 + term)\n                            psi_edge[g, m, i] = psi_out\n\n                # Reconstruct cell-center scalar fluxes\n                psi_center = 0.5 * (psi_edge[:, :, :-1] + psi_edge[:, :, 1:])\n                phi_new = np.einsum('m, gmj -> gj', self.w, psi_center, optimize=True)\n                phi = phi_new\n                \n                # Check convergence on total integrated flux\n                phi_new_integral = np.sum(phi * self.dx)\n                if phi_new_integral > 1e-12: # Avoid division by zero on first iteration\n                    err = abs(phi_new_integral - phi_old_integral) / phi_new_integral\n                    if err < tol:\n                        break\n                \n                phi_old_integral = phi_new_integral\n\n            # Calculate and return final observables\n            return self._calculate_outputs(phi, psi_edge)\n\n        def _calculate_outputs(self, phi, psi_edge):\n            \"\"\" Computes currents and average fluxes from converged solution. \"\"\"\n            # Transmitted right-boundary outward currents\n            J_0_out = np.sum(self.w[self.pos_mu_indices] * self.mu[self.pos_mu_indices] * psi_edge[0, self.pos_mu_indices, self.J])\n            J_1_out = np.sum(self.w[self.pos_mu_indices] * self.mu[self.pos_mu_indices] * psi_edge[1, self.pos_mu_indices, self.J])\n\n            # Reflected left-boundary outward current\n            neg_mu_indices = np.where(self.mu < 0)[0]\n            J_0_ref = np.sum(self.w[neg_mu_indices] * np.abs(self.mu[neg_mu_indices]) * psi_edge[0, neg_mu_indices, 0])\n            \n            # Slab-averaged scalar fluxes\n            phi_0_avg = np.sum(phi[0, :]) * self.dx / self.L if self.L > 0 else 0\n            phi_1_avg = np.sum(phi[1, :]) * self.dx / self.L if self.L > 0 else 0\n            phi_tot_avg = phi_0_avg + phi_1_avg\n\n            return {\n                \"J_0_out\": J_0_out, \"J_1_out\": J_1_out, \"J_0_ref\": J_0_ref,\n                \"phi_0_avg\": phi_0_avg, \"phi_1_avg\": phi_1_avg, \"phi_tot_avg\": phi_tot_avg\n            }\n\n    test_cases = [\n        # Test Case 1\n        {\n            \"params\": {\n                \"N\": 8, \"L_Pb\": 5.0, \"L_PE\": 10.0, \"dx\": 0.05, \n                \"bc_right\": \"vacuum\", \"I0\": 1.0,\n                \"xs_Pb\": {\n                    \"t\": [0.8, 1.2],\n                    \"s\": [[0.7, 0.05], [0.0, 1.0]]\n                },\n                \"xs_PE\": {\n                    \"t\": [0.5, 0.7],\n                    \"s\": [[0.3, 0.15], [0.0, 0.65]]\n                }\n            },\n            \"outputs\": [\"J_0_out\", \"J_1_out\", \"phi_0_avg\"]\n        },\n        # Test Case 2\n        {\n            \"params\": {\n                \"N\": 4, \"L_Pb\": 0.0, \"L_PE\": 5.0, \"dx\": 0.05, \n                \"bc_right\": \"reflecting\", \"I0\": 1.0,\n                \"xs_Pb\": {}, # Not used\n                \"xs_PE\": {\n                    \"t\": [0.5, 0.6],\n                    \"s\": [[0.2, 0.25], [0.0, 0.55]]\n                }\n            },\n            \"outputs\": [\"J_0_ref\", \"phi_1_avg\", \"J_0_out\"]\n        },\n        # Test Case 3\n        {\n            \"params\": {\n                \"N\": 2, \"L_Pb\": 20.0, \"L_PE\": 1.0, \"dx\": 0.10, \n                \"bc_right\": \"vacuum\", \"I0\": 1.0,\n                \"xs_Pb\": {\n                    \"t\": [1.0, 1.5],\n                    \"s\": [[0.6, 0.02], [0.0, 1.3]]\n                },\n                \"xs_PE\": {\n                    \"t\": [0.5, 0.7],\n                    \"s\": [[0.3, 0.15], [0.0, 0.65]]\n                }\n            },\n            \"outputs\": [\"J_0_out\", \"J_1_out\", \"phi_tot_avg\"]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        solver = S_N_Solver(**case[\"params\"])\n        results_dict = solver.run_solver()\n        \n        # Assemble the list of results in the specified order\n        case_results = [results_dict[key] for key in case[\"outputs\"]]\n        all_results.append(case_results)\n\n    # Format the final output string as per requirements\n    string_results = [f\"[{','.join(f'{val:.8e}' for val in res)}]\" for res in all_results]\n    print(f\"[{','.join(string_results)}]\")\n\nsolve()\n```"
        }
    ]
}