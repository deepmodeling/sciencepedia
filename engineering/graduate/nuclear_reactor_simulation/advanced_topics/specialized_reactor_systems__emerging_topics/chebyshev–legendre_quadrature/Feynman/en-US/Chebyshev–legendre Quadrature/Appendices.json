{
    "hands_on_practices": [
        {
            "introduction": "A core task in solving the neutron transport equation is the accurate calculation of scattering source moments. This practice directly connects the abstract theory of Gauss-Legendre quadrature to this physical necessity. By examining a case of linearly anisotropic scattering, we will determine the minimum number of polar quadrature points ($N_\\mu$) required to exactly integrate the first angular moment, illustrating the crucial link between polynomial exactness and simulation fidelity. ",
            "id": "4216823",
            "problem": "In one-dimensional neutron transport for slab geometry, the scattering source is commonly expanded in Legendre polynomials $P_{\\ell}(\\mu)$ of the polar cosine $\\mu \\in [-1,1]$, truncated at order $L$, where $L=1$ corresponds to linearly anisotropic scattering. The first angular moment associated with the anisotropic part of the scattering source involves the integral of $\\mu P_{1}(\\mu)$ over $\\mu$. Consider the Chebyshev–Legendre (CL) product quadrature in which the polar cosine integral is evaluated using $N_{\\mu}$-point Gauss–Legendre quadrature in $\\mu$ with positive weights $w_{i}$ and nodes $\\mu_{i}$ that are symmetric about $\\mu=0$.\n\nStarting from the definitions of Legendre polynomials, $P_{0}(\\mu)=1$ and $P_{1}(\\mu)=\\mu$, and using only standard properties of Gauss–Legendre quadrature, do the following:\n- Identify the exact value of the first moment integral\n$$\nI \\equiv \\int_{-1}^{1} \\mu P_{1}(\\mu) \\, d\\mu\n$$\nand explain why this integral is representative of the degree of polynomial exactness required to capture the first moment under linearly anisotropic scattering ($L=1$).\n- Show, by direct evaluation with the $N_{\\mu}=1$ Gauss–Legendre rule in $\\mu$, that the CL approximation fails to reproduce $I$.\n- Determine the smallest integer $N_{\\mu}$ such that the Gauss–Legendre rule in $\\mu$ yields the exact value of $I$ for any linearly anisotropic angular dependence (i.e., for any integrand whose $\\mu$-dependence does not exceed linear anisotropy in $P_1$ when forming the first moment).\n\nState your final answer as the minimal $N_{\\mu}$ required for exact first-moment integration under CL. No rounding is needed.",
            "solution": "The problem statement has been critically evaluated and is deemed valid. It is scientifically grounded in the principles of neutron transport theory and numerical analysis, well-posed with sufficient information for a unique solution, and expressed in objective, formal language. We may therefore proceed with the solution.\n\nThe problem requires us to analyze the exactness of the Gauss–Legendre quadrature scheme for computing the first angular moment of the linearly anisotropic scattering source in one-dimensional slab geometry. We are given the integral of interest:\n$$\nI \\equiv \\int_{-1}^{1} \\mu P_{1}(\\mu) \\, d\\mu\n$$\nwhere $P_1(\\mu) = \\mu$ is the first-order Legendre polynomial and $\\mu$ is the cosine of the polar angle.\n\nFirst, we determine the exact value of the integral $I$. Substituting the definition $P_1(\\mu) = \\mu$ into the integral expression, we obtain:\n$$\nI = \\int_{-1}^{1} \\mu (\\mu) \\, d\\mu = \\int_{-1}^{1} \\mu^{2} \\, d\\mu\n$$\nThe evaluation of this definite integral is straightforward:\n$$\nI = \\left[ \\frac{\\mu^{3}}{3} \\right]_{-1}^{1} = \\frac{(1)^{3}}{3} - \\frac{(-1)^{3}}{3} = \\frac{1}{3} - \\left(-\\frac{1}{3}\\right) = \\frac{2}{3}\n$$\nAlternatively, one can use the orthogonality property of Legendre polynomials, which states:\n$$\n\\int_{-1}^{1} P_m(x) P_n(x) \\, dx = \\frac{2}{2n+1} \\delta_{mn}\n$$\nwhere $\\delta_{mn}$ is the Kronecker delta. Since $P_1(\\mu) = \\mu$, our integral $I$ is precisely the case where $m=n=1$:\n$$\nI = \\int_{-1}^{1} P_1(\\mu) P_1(\\mu) \\, d\\mu = \\frac{2}{2(1)+1} \\delta_{11} = \\frac{2}{3}\n$$\nThe significance of this integral lies in its connection to the moments method for solving the transport equation. For a scattering source with a linearly anisotropic component ($L=1$), the angular dependence of the source term, let's call it $S(\\mu)$, contains terms up to $P_1(\\mu)$. The first moment of this source is given by $\\int_{-1}^{1} \\mu S(\\mu) \\, d\\mu$. The integrand, $\\mu S(\\mu)$, will thus contain terms up to $\\mu P_1(\\mu) = \\mu^2$. The integral $I$ represents the contribution from the highest-order polynomial term that must be integrated exactly to preserve the first moment of the particle distribution. Therefore, any numerical quadrature scheme must be able to integrate polynomials of at least degree $2$ to capture this physical moment correctly.\n\nNext, we are asked to demonstrate that the $N_{\\mu}=1$ Gauss–Legendre quadrature rule fails to reproduce the exact value of $I$. A general $N$-point Gauss–Legendre quadrature rule approximates an integral as a weighted sum:\n$$\n\\int_{-1}^{1} f(\\mu) \\, d\\mu \\approx \\sum_{i=1}^{N} w_i f(\\mu_i)\n$$\nA key property of this rule is that it is exact if $f(\\mu)$ is a polynomial of degree at most $2N-1$.\nFor $N_{\\mu}=1$, the rule is exact for polynomials of degree at most $2(1)-1=1$. The integrand in our problem is $f(\\mu) = \\mu P_1(\\mu) = \\mu^2$, which is a polynomial of degree $2$. Since $2 > 1$, we do not expect the $N_{\\mu}=1$ rule to be exact, and we must show this explicitly.\n\nFor the $N_{\\mu}=1$ rule, the single node $\\mu_1$ is the root of the Legendre polynomial $P_1(\\mu)$. Since $P_1(\\mu) = \\mu$, the root is $\\mu_1 = 0$. The corresponding weight is $w_1 = \\int_{-1}^{1} d\\mu = 2$.\nApplying this rule to our integral:\n$$\nI_{N_{\\mu}=1} = w_1 f(\\mu_1) = 2 \\cdot f(0)\n$$\nWith $f(\\mu) = \\mu^2$, we have:\n$$\nI_{N_{\\mu}=1} = 2 \\cdot (0)^2 = 0\n$$\nThe exact value is $I = \\frac{2}{3}$. Since $0 \\neq \\frac{2}{3}$, we have explicitly shown that the $N_{\\mu}=1$ Gauss–Legendre rule fails to compute the integral exactly.\n\nFinally, we must determine the smallest integer $N_{\\mu}$ for which the Gauss–Legendre rule yields the exact value of $I$. As established, the first moment integral for any linearly anisotropic source, $\\int_{-1}^{1} \\mu S(\\mu) \\, d\\mu$, will involve an integrand that is a polynomial of at most degree $2$. Let the integrand be $g(\\mu) = \\mu (\\alpha P_0(\\mu) + \\beta P_1(\\mu)) = \\alpha\\mu + \\beta\\mu^2$. The highest degree is $d=2$.\nFor the $N_{\\mu}$-point Gauss–Legendre quadrature to be exact for any polynomial of degree up to $d$, the condition is:\n$$\n2N_{\\mu} - 1 \\ge d\n$$\nSubstituting $d=2$:\n$$\n2N_{\\mu} - 1 \\ge 2\n$$\nSolving for $N_{\\mu}$:\n$$\n2N_{\\mu} \\ge 3 \\implies N_{\\mu} \\ge 1.5\n$$\nSince the number of quadrature points $N_{\\mu}$ must be an integer, the smallest integer value that satisfies this condition is $N_{\\mu}=2$.\nFor $N_{\\mu}=2$, the Gauss–Legendre quadrature rule is exact for all polynomials of degree up to $2(2)-1 = 3$. Since our integrand is of degree $2$, which is less than $3$, the $N_{\\mu}=2$ rule will be exact.\nTo verify, the $N_{\\mu}=2$ nodes are the roots of $P_2(\\mu) = \\frac{1}{2}(3\\mu^2 - 1)$, which are $\\mu_{1,2} = \\pm \\frac{1}{\\sqrt{3}}$. The weights are $w_1 = w_2 = 1$. The numerical evaluation of $I$ is:\n$$\nI_{N_{\\mu}=2} = w_1 f(\\mu_1) + w_2 f(\\mu_2) = (1) \\left(-\\frac{1}{\\sqrt{3}}\\right)^2 + (1) \\left(\\frac{1}{\\sqrt{3}}\\right)^2 = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3}\n$$\nThis matches the exact value. Therefore, the minimal integer number of quadrature points required is $2$.",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "Having explored the requirements for the polar quadrature, we now turn to constructing the full three-dimensional set of discrete directions. This exercise involves combining the polar and azimuthal rules to form a Chebyshev-Legendre product quadrature. You will use the fundamental symmetries of these rules to determine how directions are distributed across the sphere and to verify that the total sum of weights correctly normalizes to $4\\pi$, a critical property for particle conservation. ",
            "id": "4216853",
            "problem": "In three-dimensional ($3\\text{D}$) neutron transport for nuclear reactor simulation using the Discrete Ordinates ($S_N$) method, angular integrals over the unit sphere are evaluated with product quadratures. Consider the Chebyshev–Legendre product quadrature, where the polar cosine $\\mu = \\cos(\\theta)$ is discretized by Gauss–Legendre quadrature on $[-1,1]$ with $N_\\mu$ nodes and weights $\\{ \\mu_i, w_{\\mu,i} \\}_{i=1}^{N_\\mu}$, and the azimuthal angle $\\phi$ is discretized by a uniform Chebyshev (trapezoidal) rule on $[0, 2\\pi)$ with $N_\\phi$ points and equal weights $\\{ \\phi_j, w_{\\phi,j} \\}_{j=1}^{N_\\phi}$. The total angular measure is $4\\pi$ steradians, and octants are defined by the signs of the Cartesian direction cosines.\n\nSuppose $N_\\mu = 12$ and $N_\\phi = 16$, with azimuthal angles measured in radians. Using only foundational facts about Gauss–Legendre and uniform Chebyshev quadrature and the symmetry of the sphere, determine the number of unique directions per octant generated by this product quadrature, and verify that the distribution of quadrature weights across all octants sums to $4\\pi$. Express the total weight sum in steradians.\n\nProvide your final answer as a two-entry row matrix containing the number of unique directions per octant and the total weight sum over all octants, in the form $\\begin{pmatrix} \\text{directions per octant} & \\text{total weight sum} \\end{pmatrix}$.",
            "solution": "The problem is well-posed, scientifically grounded, and contains sufficient information for a unique solution based on the fundamental properties of the specified quadrature rules. The context is standard in computational nuclear engineering, and the terminology is precise. Therefore, a solution can be derived.\n\nThe problem asks for two quantities related to a Chebyshev–Legendre product quadrature for discretizing the unit sphere in the context of the Discrete Ordinates ($S_N$) method. The discretization is defined by $N_\\mu = 12$ polar cosine nodes from Gauss–Legendre quadrature and $N_\\phi = 16$ azimuthal angle nodes from a uniform Chebyshev (trapezoidal) rule.\n\nFirst, we determine the number of unique discrete directions per octant.\nA discrete direction on the unit sphere is specified by a pair $(\\mu_i, \\phi_j)$, where $\\mu_i$ is a polar cosine node and $\\phi_j$ is an azimuthal angle node. The total number of unique discrete directions, $N_{total}$, is the product of the number of nodes in each dimension:\n$$N_{total} = N_\\mu \\times N_\\phi$$\nGiven $N_\\mu = 12$ and $N_\\phi = 16$, the total number of directions is:\n$$N_{total} = 12 \\times 16 = 192$$\nThe problem requires determining the number of these directions per octant. An octant of the unit sphere is defined by the signs of the three Cartesian direction cosines: $\\Omega_x = \\sqrt{1-\\mu^2}\\cos(\\phi)$, $\\Omega_y = \\sqrt{1-\\mu^2}\\sin(\\phi)$, and $\\Omega_z = \\mu$. The symmetry of the quadrature set is key to distributing these directions.\n\n1.  **Symmetry of Polar Nodes ($\\mu_i$):** The nodes of the Gauss–Legendre quadrature on the interval $[-1, 1]$ are the roots of the Legendre polynomial $P_{N_\\mu}(\\mu)$. Since $N_\\mu=12$ is an even number, the polynomial $P_{12}(\\mu)$ is an even function, meaning $P_{12}(-\\mu) = P_{12}(\\mu)$. Consequently, its roots are symmetric with respect to $\\mu=0$. Furthermore, for even $N_\\mu$, $\\mu=0$ is not a root, so no polar node lies on the equatorial plane ($\\Omega_z = 0$). Thus, there are $N_\\mu/2 = 12/2 = 6$ nodes with positive $\\mu_i$ (upper hemisphere) and $N_\\mu/2 = 6$ nodes with negative $\\mu_i$ (lower hemisphere).\n\n2.  **Symmetry of Azimuthal Nodes ($\\phi_j$):** The azimuthal angles are discretized using a uniform rule on $[0, 2\\pi)$ with $N_\\phi=16$ points. Since $N_\\phi=16$ is a multiple of $4$, the nodes exhibit four-fold rotational symmetry. This means that the set of nodes is invariant under rotations by $\\pi/2$. This ensures that the nodes are distributed equally among the four quadrants of the $xy$-plane.\n\nCombining these two symmetries, the entire set of $N_{total} = 192$ direction vectors is distributed symmetrically across the $8$ octants of the unit sphere. In practical $S_N$ implementations, each discrete direction is assigned to a single octant, and for a symmetric quadrature set, each octant contains the same number of directions. Therefore, the number of unique directions per octant is the total number of directions divided by the number of octants ($8$).\n$$\\text{Directions per octant} = \\frac{N_{total}}{8} = \\frac{192}{8} = 24$$\n\nSecond, we verify that the sum of all quadrature weights equals $4\\pi$.\nThe integral of a function $f(\\mu, \\phi)$ over the unit sphere is given by:\n$$I = \\int_{4\\pi} f(\\vec{\\Omega}) d\\Omega = \\int_{-1}^{1} \\int_{0}^{2\\pi} f(\\mu, \\phi) d\\phi \\, d\\mu$$\nThe product quadrature approximates this integral as a sum over all discrete directions:\n$$I \\approx \\sum_{i=1}^{N_\\mu} \\sum_{j=1}^{N_\\phi} f(\\mu_i, \\phi_j) w_{\\mu,i} w_{\\phi,j}$$\nThe weight associated with a direction $(\\mu_i, \\phi_j)$ is the product of the individual weights, $w_{ij} = w_{\\mu,i} w_{\\phi,j}$. The total weight sum, $W_{total}$, is the sum of all these product weights.\n$$W_{total} = \\sum_{i=1}^{N_\\mu} \\sum_{j=1}^{N_\\phi} w_{\\mu,i} w_{\\phi,j} = \\left(\\sum_{i=1}^{N_\\mu} w_{\\mu,i}\\right) \\left(\\sum_{j=1}^{N_\\phi} w_{\\phi,j}\\right)$$\nA fundamental property of any valid quadrature rule is that it must integrate the constant function $f=1$ exactly. The integral of $f=1$ over the domain gives the measure of the domain.\n\n1.  **Sum of Polar Weights:** The sum of weights for the Gauss–Legendre quadrature on $[-1, 1]$ is:\n$$\\sum_{i=1}^{N_\\mu} w_{\\mu,i} = \\int_{-1}^{1} 1 \\, d\\mu = [\\mu]_{-1}^{1} = 1 - (-1) = 2$$\n\n2.  **Sum of Azimuthal Weights:** The sum of weights for the uniform quadrature rule on $[0, 2\\pi)$ is:\n$$\\sum_{j=1}^{N_\\phi} w_{\\phi,j} = \\int_{0}^{2\\pi} 1 \\, d\\phi = [\\phi]_{0}^{2\\pi} = 2\\pi - 0 = 2\\pi$$\n\nMultiplying these two sums gives the total weight sum for the product quadrature over the sphere:\n$$W_{total} = (2) \\times (2\\pi) = 4\\pi$$\nThis confirms that the quadrature rule is correctly normalized, as the total weight sum equals the total solid angle of the unit sphere, which is $4\\pi$ steradians.\n\nThe two requested values are the number of unique directions per octant ($24$) and the total weight sum ($4\\pi$).",
            "answer": "$$\\boxed{\\begin{pmatrix} 24 & 4\\pi \\end{pmatrix}}$$"
        },
        {
            "introduction": "This final practice applies the Chebyshev-Legendre quadrature in a tangible simulation context: a source iteration step for the neutron transport equation. You will conduct a numerical experiment to investigate how the resolution of the azimuthal quadrature, $N_\\phi$, affects the accuracy of a calculation with an anisotropic scattering source. By measuring a proxy for the iteration's convergence rate, you will observe the practical consequences of aliasing, a critical concept in numerical accuracy. ",
            "id": "4216870",
            "problem": "Consider the time-independent, monoenergetic, one-dimensional linear Boltzmann transport equation for a homogeneous plane-parallel slab with vacuum boundaries, expressed for the angular flux $\\psi(x,\\mu,\\phi)$ as\n$$\\mu\\,\\frac{\\partial \\psi(x,\\mu,\\phi)}{\\partial x} + \\Sigma_t\\,\\psi(x,\\mu,\\phi) = \\frac{\\Sigma_s}{4\\pi}\\int_{4\\pi} p\\!\\left(\\phi-\\phi'\\right)\\,\\psi(x,\\mu',\\phi')\\,\\mathrm{d}\\Omega' \\,,$$\nwhere $x$ is the spatial coordinate, $\\mu=\\cos\\theta\\in[-1,1]$ is the direction cosine with respect to the slab normal, $\\phi\\in[0,2\\pi)$ is the azimuthal angle in radians, $\\Sigma_t>0$ is the total macroscopic cross section, $\\Sigma_s\\in(0,\\Sigma_t)$ is the scattering macroscopic cross section, and $p(\\phi-\\phi')$ is a normalized azimuthal scattering phase function. The angular integral $\\int_{4\\pi}\\cdot\\,\\mathrm{d}\\Omega'$ is over the unit sphere of directions.\n\nThe slab has dimensionless optical thickness $T=\\Sigma_t L$ over its thickness $L$. There is no external source. The scattering phase function is taken to have a single azimuthal anisotropic mode,\n$$p(\\Delta\\phi) = 1 + a\\,\\cos\\!\\big(m\\,\\Delta\\phi\\big)\\,,$$\nwith anisotropy amplitude $a\\in[0,1]$ and integer azimuthal mode $m\\ge 1$, and is normalized so that $\\frac{1}{4\\pi}\\int_{4\\pi}p(\\Delta\\phi)\\,\\mathrm{d}\\Omega' = 1$. The material parameters satisfy $\\Sigma_t=1$ and $\\Sigma_s = c\\,\\Sigma_t$ with $c\\in(0,1)$.\n\nYou will perform a single Source Iteration (SI) step using product Chebyshev–Legendre quadrature, defined as follows:\n- In the polar variable $\\mu$, use $N_\\mu$-point Gauss–Legendre quadrature on $[-1,1]$ with nodes $\\{\\mu_j\\}_{j=1}^{N_\\mu}$ and weights $\\{w_{\\mu,j}\\}_{j=1}^{N_\\mu}$.\n- In the azimuthal variable $\\phi$, use $N_\\phi$-point equiangular Chebyshev-type quadrature on $[0,2\\pi)$ with nodes $\\{\\phi_k\\}_{k=1}^{N_\\phi}$ taken uniformly as $\\phi_k = \\frac{2\\pi(k-1)}{N_\\phi}$ and equal weights $w_\\phi = \\frac{2\\pi}{N_\\phi}$.\n\nBegin from the initial angular flux guess (independent of $x$ and $\\mu$)\n$$\\psi^{(0)}(\\mu,\\phi) = 1 + \\beta\\,\\cos\\!\\big(m\\,\\phi\\big)\\,,$$\nwith $\\beta\\in[0,1]$. The SI step consists of:\n1. Computing the scattering source $S(\\phi)$ at the cell level using the Chebyshev–Legendre product quadrature,\n$$S(\\phi_k) = \\frac{\\Sigma_s}{4\\pi}\\sum_{j=1}^{N_\\mu}\\sum_{l=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,p\\!\\big(\\phi_k-\\phi_l\\big)\\,\\psi^{(0)}(\\mu_j,\\phi_l)\\,.$$\n2. Performing a diamond-difference sweep across a single spatial cell of optical thickness $T$ with vacuum inflow boundary conditions to obtain the cell-averaged updated angular flux $\\psi^{(1)}(\\mu_j,\\phi_k)$ for each discrete direction $(\\mu_j,\\phi_k)$,\n$$\\psi^{(1)}(\\mu_j,\\phi_k) = \\frac{S(\\phi_k)}{\\Sigma_t}\\left[1 - \\frac{1 - \\exp\\!\\left(-\\frac{T}{|\\mu_j|}\\right)}{\\frac{T}{|\\mu_j|}}\\right]\\,.$$\n\nDefine a convergence-rate proxy $r(N_\\phi)$ as the ratio of quadrature-weighted $L^2$ norms of the updated cell-averaged angular flux to the initial angular flux,\n$$r(N_\\phi) = \\frac{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(1)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(0)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}\\,.$$\nThis proxy quantifies how aggressively the SI step contracts the angular flux (smaller values imply faster contraction).\n\nYou must implement the above in a single program and report $r(N_\\phi)$ for the following test suite:\n- Happy path resolution: $N_\\phi=12$.\n- Moderate resolution: $N_\\phi=6$.\n- Low resolution: $N_\\phi=4$.\n- Severe aliasing edge case: $N_\\phi=3$.\n\nUse the fixed parameters $N_\\mu=8$, $T=2.0$, $\\Sigma_t=1.0$, $c=0.95$, $a=0.6$, $m=3$, $\\beta=0.7$. All angles must be in radians, and there are no physical units required beyond the dimensionless quantities specified. Your program should produce a single line of output containing the values $r(N_\\phi)$ for the four test cases as a comma-separated list enclosed in square brackets, in the order $[N_\\phi=12, N_\\phi=6, N_\\phi=4, N_\\phi=3]$, for example $[0.123,0.456,0.789,1.012]$. The outputs must be floating-point numbers.",
            "solution": "The problem statement has been critically validated and is deemed to be scientifically grounded, well-posed, objective, and internally consistent. It presents a clear, formalizable task within the domain of numerical methods for particle transport theory. All necessary parameters, equations, and boundary conditions are provided, and there are no contradictions or ambiguities. The problem is a non-trivial numerical experiment designed to investigate the effect of quadrature resolution on the accuracy of a source iteration step, specifically highlighting the phenomenon of aliasing in the azimuthal discretization.\n\nThe solution proceeds by implementing the specified single-step source iteration (SI) for the given one-dimensional transport problem. The objective is to compute the convergence-rate proxy, $r(N_\\phi)$, for a set of different azimuthal quadrature resolutions $N_\\phi$. The calculation is broken down into the following distinct steps:\n\n1.  **System and Quadrature Setup**: Define all physical and numerical parameters as specified in the problem statement. Generate the Gauss–Legendre quadrature set for the polar angle $\\mu$ and the equiangular quadrature set for the azimuthal angle $\\phi$.\n2.  **Initial Flux Norm Calculation**: Compute the discrete quadrature-weighted $L^2$ norm of the initial angular flux guess, $\\psi^{(0)}(\\mu, \\phi)$. This will serve as the denominator in the ratio $r(N_\\phi)$.\n3.  **Scattering Source Calculation**: Evaluate the scattering source term, $S(\\phi)$, at each discrete azimuthal angle $\\phi_k$. This involves performing a discrete convolution integral using the product Chebyshev–Legendre quadrature.\n4.  **Updated Flux Calculation**: Compute the cell-averaged updated angular flux, $\\psi^{(1)}(\\mu, \\phi)$, for each discrete direction $(\\mu_j, \\phi_k)$ using the provided formula derived from a diamond-difference sweep over a single spatial cell.\n5.  **Updated Flux Norm Calculation**: Compute the discrete quadrature-weighted $L^2$ norm of the updated angular flux, $\\psi^{(1)}(\\mu, \\phi)$. This will be the numerator in the ratio $r(N_\\phi)$.\n6.  **Convergence-Rate Proxy**: Calculate the final ratio $r(N_\\phi)$ by dividing the norm of the updated flux by the norm of the initial flux.\n\nLet us now detail each step mathematically.\n\n**1. System and Quadrature Setup**\nThe fixed parameters are given as:\n- Total macroscopic cross section: $\\Sigma_t = 1.0$\n- Ratio of scattering to total cross section: $c = 0.95$\n- Scattering macroscopic cross section: $\\Sigma_s = c\\,\\Sigma_t = 0.95$\n- Optical thickness of the slab: $T = 2.0$\n- Phase function anisotropy amplitude: $a = 0.6$\n- Phase function azimuthal mode: $m = 3$\n- Initial flux anisotropy amplitude: $\\beta = 0.7$\n- Number of polar quadrature points: $N_\\mu = 8$\n\nFor the polar angle $\\mu \\in [-1, 1]$, we use an $N_\\mu$-point Gauss–Legendre quadrature with nodes $\\{\\mu_j\\}_{j=1}^{N_\\mu}$ and weights $\\{w_{\\mu,j}\\}_{j=1}^{N_\\mu}$. These are determined such that $\\sum_{j=1}^{N_\\mu} w_{\\mu,j} f(\\mu_j) \\approx \\int_{-1}^1 f(\\mu) \\,\\mathrm{d}\\mu$. A key property is that $\\sum_{j=1}^{N_\\mu} w_{\\mu,j} = \\int_{-1}^1 1\\,\\mathrm{d}\\mu = 2$.\n\nFor the azimuthal angle $\\phi \\in [0, 2\\pi)$, we use an $N_\\phi$-point equiangular quadrature with nodes and weights given by:\n- Nodes: $\\phi_k = \\frac{2\\pi(k-1)}{N_\\phi}$ for $k \\in \\{1, 2, \\dots, N_\\phi\\}$\n- Weights: $w_\\phi = \\frac{2\\pi}{N_\\phi}$\n\n**2. Initial Flux Norm (Denominator)**\nThe initial angular flux is $\\psi^{(0)}(\\mu, \\phi) = 1 + \\beta\\,\\cos(m\\phi)$. At the discrete angles, this is $\\psi^{(0)}(\\mu_j, \\phi_k) = 1 + \\beta\\,\\cos(m\\phi_k)$. Note that it is independent of the polar angle $\\mu_j$.\n\nThe squared, quadrature-weighted $L^2$ norm of $\\psi^{(0)}$ is defined as:\n$$D^2 = \\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(0)}(\\mu_j, \\phi_k)\\big]^2$$\nSince $\\psi^{(0)}$ is independent of $\\mu_j$, we can separate the sums:\n$$D^2 = \\left(\\sum_{j=1}^{N_\\mu} w_{\\mu,j}\\right) \\left(\\sum_{k=1}^{N_\\phi} w_\\phi\\,\\big[1 + \\beta\\,\\cos(m\\phi_k)\\big]^2\\right)$$\nUsing the property $\\sum_{j=1}^{N_\\mu} w_{\\mu,j} = 2$, this simplifies to:\n$$D^2 = 2 \\sum_{k=1}^{N_\\phi} w_\\phi\\,\\big[1 + \\beta\\,\\cos(m\\phi_k)\\big]^2$$\nThe denominator of the proxy $r(N_\\phi)$ is then $D = \\sqrt{D^2}$.\n\n**3. Scattering Source Calculation**\nThe scattering source $S(\\phi_k)$ is calculated for each discrete azimuth $\\phi_k$ using the formula:\n$$S(\\phi_k) = \\frac{\\Sigma_s}{4\\pi}\\sum_{j=1}^{N_\\mu}\\sum_{l=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,p(\\phi_k-\\phi_l)\\,\\psi^{(0)}(\\mu_j, \\phi_l)$$\nwhere the phase function is $p(\\Delta\\phi) = 1 + a\\,\\cos(m\\Delta\\phi)$.\n\nAgain, since $\\psi^{(0)}$ is independent of $\\mu$, the summation over $j$ can be performed first:\n$$S(\\phi_k) = \\frac{\\Sigma_s}{4\\pi}\\left(\\sum_{j=1}^{N_\\mu} w_{\\mu,j}\\right) \\left(\\sum_{l=1}^{N_\\phi} w_\\phi\\,p(\\phi_k-\\phi_l)\\,\\psi^{(0)}(\\phi_l)\\right)$$\n$$S(\\phi_k) = \\frac{\\Sigma_s}{2\\pi} \\sum_{l=1}^{N_\\phi} w_\\phi\\, \\big[1 + a\\,\\cos(m(\\phi_k-\\phi_l))\\big] \\big[1 + \\beta\\,\\cos(m\\phi_l)\\big]$$\nSubstituting $w_\\phi = 2\\pi/N_\\phi$:\n$$S(\\phi_k) = \\frac{\\Sigma_s}{N_\\phi} \\sum_{l=1}^{N_\\phi} \\big[1 + a\\,\\cos(m(\\phi_k-\\phi_l))\\big] \\big[1 + \\beta\\,\\cos(m\\phi_l)\\big]$$\nThis expression represents a discrete circular convolution. Its accuracy depends on how well the $N_\\phi$-point equiangular quadrature (trapezoidal rule) resolves the integrand, which is a trigonometric polynomial of degree $2m$. For $m=3$, the critical resolution is $N_\\phi > 2m = 6$. Cases where $N_\\phi \\le 6$ will exhibit aliasing error, which is precisely what the problem is designed to explore.\n\n**4. Updated Flux Calculation**\nThe cell-averaged updated angular flux $\\psi^{(1)}$ is obtained for each direction $(\\mu_j, \\phi_k)$ using the scattering source $S(\\phi_k)$ computed in the previous step and the given transport sweep formula:\n$$\\psi^{(1)}(\\mu_j,\\phi_k) = \\frac{S(\\phi_k)}{\\Sigma_t}\\left[1 - \\frac{1 - \\exp\\!\\left(-\\frac{T}{|\\mu_j|}\\right)}{\\frac{T}{|\\mu_j|}}\\right]$$\nThis formula couples the source $S(\\phi_k)$, which depends only on the outgoing azimuthal angle $\\phi_k$, to the direction cosine $\\mu_j$ via the attenuation term in the brackets. The expression is well-defined as the Gauss–Legendre nodes $\\mu_j$ are never zero.\n\n**5. Updated Flux Norm (Numerator)**\nThe squared, quadrature-weighted $L^2$ norm of the updated flux $\\psi^{(1)}$ is:\n$$N^2 = \\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(1)}(\\mu_j, \\phi_k)\\big]^2$$\nThis double summation is computed over all discrete directions. The numerator of the proxy $r(N_\\phi)$ is then $N = \\sqrt{N^2}$.\n\n**6. Convergence-Rate Proxy**\nFinally, the convergence-rate proxy is computed as the ratio of the two norms:\n$$r(N_\\phi) = \\frac{N}{D} = \\frac{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(1)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(0)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}$$\nThe following program implements this sequence of calculations for each value of $N_\\phi$ in the test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef calculate_r(N_phi, N_mu, T, Sigma_t, c, a, m, beta):\n    \"\"\"\n    Calculates the convergence-rate proxy r(N_phi) for a given set of parameters.\n    \"\"\"\n    # 1. System and Quadrature Setup\n    Sigma_s = c * Sigma_t\n    \n    # Polar quadrature (Gauss-Legendre) on [-1, 1]\n    # leggauss returns nodes and weights for the interval [-1, 1]\n    mu_nodes, mu_weights = leggauss(N_mu)\n    \n    # Azimuthal quadrature (equiangular) on [0, 2*pi)\n    phi_nodes = 2 * np.pi * np.arange(N_phi) / N_phi\n    phi_weight = 2 * np.pi / N_phi\n\n    # 2. Initial Flux Norm (Denominator)\n    # psi_0 is independent of mu\n    psi0_k = 1 + beta * np.cos(m * phi_nodes)\n    \n    # The sum of mu_weights is exactly 2.0\n    # D^2 = (sum_j w_mu_j) * (sum_k w_phi * psi0_k^2)\n    # D^2 = 2 * sum_k w_phi * psi0_k^2\n    norm_psi0_sq = 2.0 * phi_weight * np.sum(psi0_k**2)\n    \n    # 3. Scattering Source Calculation\n    # Vectorized calculation of S(phi_k)\n    # S_k = (Sigma_s / N_phi) * sum_l p(phi_k - phi_l) * psi0(phi_l)\n    \n    # Create matrices for vectorized computation\n    # phi_k is a column vector, phi_l is a row vector\n    phi_k_col = phi_nodes.reshape(-1, 1)\n    phi_l_row = phi_nodes.reshape(1, -1)\n    \n    # delta_phi_matrix has elements (phi_k - phi_l)\n    delta_phi_matrix = phi_k_col - phi_l_row\n    \n    # p_matrix has elements p(phi_k - phi_l)\n    p_matrix = 1 + a * np.cos(m * delta_phi_matrix)\n    \n    # Perform the discrete convolution via matrix-vector multiplication\n    S_k = (Sigma_s / N_phi) * (p_matrix @ psi0_k)\n\n    # 4. Updated Flux Calculation\n    # psi_1(mu_j, phi_k) calculation\n    # Define mu-dependent attenuation factor\n    # Use np.abs for |mu_j|. The nodes are symmetric around 0.\n    f_j = T / np.abs(mu_nodes)\n    \n    # Handle potential for f_j being very large (mu_j close to 0)\n    # np.exp(-f_j) will underflow to 0, which is correct.\n    # The expression is numerically stable for mu_j != 0, which is true for Gauss-Legendre.\n    attenuation_factor_j = 1 - (1 - np.exp(-f_j)) / f_j\n    \n    # Use broadcasting to compute psi_1 for all (j, k)\n    # S_k is (N_phi,), reshape to (1, N_phi)\n    # attenuation_factor_j is (N_mu,), reshape to (N_mu, 1)\n    # Resulting psi1_jk is a (N_mu, N_phi) matrix\n    psi1_jk = (S_k.reshape(1, -1) / Sigma_t) * attenuation_factor_j.reshape(-1, 1)\n\n    # 5. Updated Flux Norm (Numerator)\n    # N^2 = sum_j sum_k w_mu_j * w_phi * psi1_jk^2\n    # Create the weight matrix w_jk = w_mu_j * w_phi via broadcasting\n    weight_matrix_jk = mu_weights.reshape(-1, 1) * phi_weight\n    norm_psi1_sq = np.sum(weight_matrix_jk * psi1_jk**2)\n    \n    # 6. Convergence-Rate Proxy\n    # r = sqrt(N^2 / D^2)\n    if norm_psi0_sq == 0:\n        return 0.0 # Avoid division by zero, though unlikely here\n    \n    r = np.sqrt(norm_psi1_sq / norm_psi0_sq)\n    \n    return r\n    \ndef solve():\n    \"\"\"\n    Main solver function to run the test suite and print results.\n    \"\"\"\n    # Define the fixed parameters from the problem statement.\n    N_mu = 8\n    T = 2.0\n    Sigma_t = 1.0\n    c = 0.95\n    a = 0.6\n    m = 3\n    beta = 0.7\n    \n    # Define the test cases for N_phi from the problem statement.\n    test_cases_N_phi = [12, 6, 4, 3]\n\n    results = []\n    for N_phi in test_cases_N_phi:\n        result = calculate_r(N_phi, N_mu, T, Sigma_t, c, a, m, beta)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Format each number as a float.\n    print(f\"[{','.join(f'{r:.16f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}