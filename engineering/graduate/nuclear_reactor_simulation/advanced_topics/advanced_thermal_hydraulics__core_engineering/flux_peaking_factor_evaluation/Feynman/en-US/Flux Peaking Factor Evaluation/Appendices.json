{
    "hands_on_practices": [
        {
            "introduction": "To effectively evaluate the flux peaking factor, we must first understand its physical origins. This practice explores how the global flux shape is determined by the interplay between different material regions in a reactor. By solving the one-group neutron diffusion equation for a simplified slab reactor with a reflector , you will analytically derive the flux profile and see how the reflector \"flattens\" the flux, reducing the peak-to-average ratio compared to a bare reactor. This exercise provides a foundational understanding of how geometry and material properties directly influence this critical safety parameter.",
            "id": "4227008",
            "problem": "Consider a one-speed neutron diffusion model of a uniform slab reactor core of half-thickness $a$, occupying $-a \\le x \\le a$, surrounded on both sides by non-multiplying reflectors of thickness $t$ occupying $a < |x| \\le a+t$. The reactor is symmetric about $x=0$. The outer boundary at $x=\\pm(a+t)$ is a vacuum boundary. The materials are homogeneous in each region, characterized by diffusion coefficients $D$ and macroscopic absorption cross sections $\\Sigma_{a}$. In the reactor core, fission neutrons are produced with an effective production term; in the reflectors, no sources exist.\n\nYou are to work in the framework of one-group neutron diffusion theory. The governing equation for the neutron flux $\\phi(x)$ in the core is the one-group Neutron Diffusion Equation (NDE),\n$$\n-D_{c}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,c}\\,\\phi=\\frac{\\nu\\Sigma_{f,c}}{k}\\,\\phi \\quad \\text{for } |x|<a,\n$$\nwhere $D_{c}$ is the core diffusion coefficient, $\\Sigma_{a,c}$ is the core macroscopic absorption cross section, $\\nu\\Sigma_{f,c}$ is the core macroscopic neutron production term, and $k$ is the neutron multiplication factor. In the reflector,\n$$\n-D_{r}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,r}\\,\\phi=0 \\quad \\text{for } a<|x|<a+t,\n$$\nwith $D_{r}$ and $\\Sigma_{a,r}$ the reflector diffusion coefficient and absorption, respectively. Impose vacuum boundary conditions at $x=\\pm(a+t)$ and continuity of $\\phi$ and of the neutron current $J=-D\\,d\\phi/dx$ at the core-reflector interfaces $x=\\pm a$. Assume the fundamental even-parity mode in the core.\n\nDefine the Flux Peaking Factor (FPF) as\n$$\n\\text{FPF}=\\frac{\\phi_{\\max}}{\\langle \\phi \\rangle_{\\text{core}}},\n$$\nwhere $\\phi_{\\max}$ is the maximum value of $\\phi(x)$ in the core and $\\langle \\phi \\rangle_{\\text{core}}$ is the spatial average of $\\phi(x)$ over $-a\\le x\\le a$. Starting from the above NDE and boundary/interface conditions, derive the shape of $\\phi(x)$ in the core and obtain an expression for $\\text{FPF}$ in terms of the fundamental-mode wavenumber and geometry. Then, for the following material and geometric parameters,\n- $a=50\\,\\text{cm}$,\n- $t=30\\,\\text{cm}$,\n- $D_{c}=1.5\\,\\text{cm}$,\n- $D_{r}=0.7\\,\\text{cm}$,\n- $\\Sigma_{a,r}=5.0\\times 10^{-4}\\,\\text{cm}^{-1}$,\nevaluate the wavenumber that satisfies the interface condition and compute the numerical value of $\\text{FPF}$. Round your final answer to four significant figures. Express the final peaking factor as a pure number with no units.",
            "solution": "The starting point is the one-group Neutron Diffusion Equation (NDE). In the core, we write\n$$\n-D_{c}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,c}\\,\\phi=\\frac{\\nu\\Sigma_{f,c}}{k}\\,\\phi \\quad \\text{for } |x|<a.\n$$\nIntroduce the core wavenumber $B$ via\n$$\nB^{2}=\\frac{\\nu\\Sigma_{f,c}/k-\\Sigma_{a,c}}{D_{c}},\n$$\nso that the core equation reduces to\n$$\n\\frac{d^{2}\\phi}{dx^{2}}+B^{2}\\phi=0.\n$$\nFor the fundamental even-parity mode in a symmetric slab, the core solution is\n$$\n\\phi_{c}(x)=A\\cos\\!\\big(Bx\\big), \\quad |x|\\le a,\n$$\nwith amplitude $A>0$.\n\nIn the reflector, the NDE is\n$$\n-D_{r}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,r}\\,\\phi=0, \\quad a<|x|<a+t.\n$$\nDefine the reflector attenuation constant\n$$\n\\kappa_{r}=\\sqrt{\\frac{\\Sigma_{a,r}}{D_{r}}}.\n$$\nOn the right reflector ($x\\in[a,a+t]$) with a vacuum boundary $\\phi\\big(a+t\\big)=0$, the general solution that satisfies the vacuum boundary is\n$$\n\\phi_{r}(x)=S\\,\\sinh\\!\\big(\\kappa_{r}(a+t-x)\\big), \\quad a\\le x\\le a+t,\n$$\nwith some constant $S$.\n\nImpose interface conditions at $x=a$:\n- Continuity of flux:\n$$\n\\phi_{c}(a)=\\phi_{r}(a)\\quad\\Rightarrow\\quad A\\cos\\!\\big(Ba\\big)=S\\,\\sinh\\!\\big(\\kappa_{r}t\\big).\n$$\n- Continuity of neutron current $J=-D\\,d\\phi/dx$:\n$$\n-D_{c}\\,\\phi_{c}'(a)=-D_{r}\\,\\phi_{r}'(a).\n$$\nCompute derivatives at $x=a$:\n$$\n\\phi_{c}'(x)=-AB\\sin\\!\\big(Bx\\big)\\quad\\Rightarrow\\quad \\phi_{c}'(a)=-AB\\sin\\!\\big(Ba\\big),\n$$\n$$\n\\phi_{r}'(x)=-S\\,\\kappa_{r}\\cosh\\!\\big(\\kappa_{r}(a+t-x)\\big)\\quad\\Rightarrow\\quad \\phi_{r}'(a)=-S\\,\\kappa_{r}\\cosh\\!\\big(\\kappa_{r}t\\big).\n$$\nThus current continuity gives\n$$\n-D_{c}\\big(-AB\\sin(Ba)\\big)=-D_{r}\\big(-S\\kappa_{r}\\cosh(\\kappa_{r}t)\\big)\\quad\\Rightarrow\\quad D_{c}AB\\sin(Ba)=D_{r}S\\kappa_{r}\\cosh(\\kappa_{r}t).\n$$\nEliminate $S$ using the flux continuity:\n$$\nS=\\frac{A\\cos(Ba)}{\\sinh(\\kappa_{r}t)}.\n$$\nSubstitute:\n$$\nD_{c}AB\\sin(Ba)=D_{r}\\left(\\frac{A\\cos(Ba)}{\\sinh(\\kappa_{r}t)}\\right)\\kappa_{r}\\cosh(\\kappa_{r}t).\n$$\nCancel $A$ and rearrange to obtain the transcendental interface condition for the core wavenumber $B$:\n$$\n\\tan\\!\\big(Ba\\big)=\\frac{D_{r}\\kappa_{r}}{D_{c}B}\\,\\coth\\!\\big(\\kappa_{r}t\\big).\n$$\n\nNext, compute the Flux Peaking Factor (FPF). For the even-parity fundamental mode, $\\phi_{\\max}$ occurs at $x=0$, so\n$$\n\\phi_{\\max}=\\phi_{c}(0)=A\\cos(0)=A.\n$$\nThe core-average flux is\n$$\n\\langle\\phi\\rangle_{\\text{core}}=\\frac{1}{2a}\\int_{-a}^{a}\\phi_{c}(x)\\,dx=\\frac{1}{2a}\\int_{-a}^{a}A\\cos(Bx)\\,dx.\n$$\nBy symmetry,\n$$\n\\langle\\phi\\rangle_{\\text{core}}=\\frac{A}{a}\\int_{0}^{a}\\cos(Bx)\\,dx=\\frac{A}{a}\\left[\\frac{\\sin(Bx)}{B}\\right]_{0}^{a}=\\frac{A}{a}\\cdot\\frac{\\sin(Ba)}{B}.\n$$\nTherefore,\n$$\n\\text{FPF}=\\frac{\\phi_{\\max}}{\\langle\\phi\\rangle_{\\text{core}}}=\\frac{A}{\\dfrac{A}{a}\\cdot\\dfrac{\\sin(Ba)}{B}}=\\frac{aB}{\\sin(Ba)}.\n$$\n\nAll quantities are now determined by material and geometric parameters through the interface equation. With the given data,\n$$\na=50,\\quad t=30,\\quad D_{c}=1.5,\\quad D_{r}=0.7,\\quad \\Sigma_{a,r}=5.0\\times 10^{-4},\n$$\ncompute\n$$\n\\kappa_{r}=\\sqrt{\\frac{\\Sigma_{a,r}}{D_{r}}}=\\sqrt{\\frac{5.0\\times 10^{-4}}{0.7}}=\\sqrt{7.142857\\times 10^{-4}}\\approx 0.02673.\n$$\nThen\n$$\n\\kappa_{r}t\\approx 0.02673\\times 30\\approx 0.8019,\n$$\nand\n$$\n\\coth(\\kappa_{r}t)=\\frac{\\cosh(\\kappa_{r}t)}{\\sinh(\\kappa_{r}t)}=\\frac{\\dfrac{\\exp(\\kappa_{r}t)+\\exp(-\\kappa_{r}t)}{2}}{\\dfrac{\\exp(\\kappa_{r}t)-\\exp(-\\kappa_{r}t)}{2}}.\n$$\nUsing $\\exp(0.8019)\\approx 2.230$ and $\\exp(-0.8019)\\approx 0.4485$,\n$$\n\\cosh(\\kappa_{r}t)\\approx \\frac{2.230+0.4485}{2}\\approx 1.33925,\\quad \\sinh(\\kappa_{r}t)\\approx \\frac{2.230-0.4485}{2}\\approx 0.89075,\n$$\nso\n$$\n\\coth(\\kappa_{r}t)\\approx \\frac{1.33925}{0.89075}\\approx 1.503.\n$$\nDefine\n$$\nR=\\frac{D_{r}\\kappa_{r}}{D_{c}}\\,\\coth(\\kappa_{r}t)=\\frac{0.7\\times 0.02673}{1.5}\\times 1.503\\approx 0.01874.\n$$\nThe interface equation becomes\n$$\n\\tan( Ba )=\\frac{R}{B}=\\frac{0.01874}{B},\\quad \\text{with } a=50.\n$$\nEquivalently,\n$$\nf(B)=\\tan(50B)-\\frac{0.01874}{B}=0.\n$$\nSolve this equation for the smallest positive $B$. A bisection or secant search yields\n$$\nB\\approx 0.01678.\n$$\nCheck consistency:\n$$\n\\tan(50B)=\\tan(0.839)\\approx 1.113,\\quad \\frac{0.01874}{B}\\approx \\frac{0.01874}{0.01678}\\approx 1.117,\n$$\nwhich agree within the expected numerical tolerance.\n\nNow evaluate the Flux Peaking Factor:\n$$\n\\text{FPF}=\\frac{aB}{\\sin(Ba)}=\\frac{50\\times 0.01678}{\\sin(0.839)}=\\frac{0.839}{\\sin(0.839)}.\n$$\nUsing a series evaluation,\n$$\n\\sin(0.839)\\approx 0.839-\\frac{0.839^{3}}{6}+\\frac{0.839^{5}}{120}-\\frac{0.839^{7}}{5040}+\\frac{0.839^{9}}{362880}\\approx 0.74415.\n$$\nThus,\n$$\n\\text{FPF}\\approx \\frac{0.839}{0.74415}\\approx 1.1276.\n$$\nRounded to four significant figures, the peaking factor is\n$$\n1.128.\n$$\nAs requested, this is a pure, dimensionless number.",
            "answer": "$$\\boxed{1.128}$$"
        },
        {
            "introduction": "Modern reactor simulations rely on nodal methods, which solve for flux values averaged over relatively large computational cells. A key challenge is to determine the peak flux *within* these cells from the limited information available. This practice  addresses this \"reconstruction\" problem directly, asking you to develop an algorithm that finds the maximum value of a quadratic flux profile given only the node-averaged and boundary values. This exercise hones your ability to translate integral and boundary data into detailed local information, a crucial skill in the interpretation of simulation results.",
            "id": "4227007",
            "problem": "Consider a one-dimensional (1D) slab node of width $h$ used in a neutron diffusion nodal method for a steady-state reactor simulation. Let the intra-nodal neutron flux be approximated via a second-order polynomial subcell interpolant on the local coordinate $x \\in \\left[-\\frac{h}{2}, \\frac{h}{2}\\right]$,\n$$\n\\phi(x) = a + b x + c x^2,\n$$\nwhere $a$, $b$, and $c$ are unknown coefficients. You are given the volume-averaged flux $\\bar{\\phi}$ over the node and the flux values at the left and right node interfaces, $\\phi_L = \\phi\\!\\left(-\\frac{h}{2}\\right)$ and $\\phi_R = \\phi\\!\\left(\\frac{h}{2}\\right)$. Assume all given fluxes are strictly positive. The Flux Peaking Factor (FPF) is defined as the ratio of the maximum intra-nodal flux to the node-averaged flux,\n$$\n\\mathrm{FPF} \\equiv \\frac{\\displaystyle \\max_{x \\in \\left[-\\frac{h}{2}, \\frac{h}{2}\\right]} \\phi(x)}{\\bar{\\phi}}.\n$$\nStarting from the following fundamental bases:\n- Neutron balance in a node implies that subcell interpolants are constructed to be consistent with integral moments and boundary constraints.\n- The cell-average constraint is\n$$\n\\frac{1}{h} \\int_{-h/2}^{h/2} \\phi(x)\\,dx = \\bar{\\phi}.\n$$\n- The interface constraints are\n$$\n\\phi\\!\\left(-\\frac{h}{2}\\right) = \\phi_L, \\qquad \\phi\\!\\left(\\frac{h}{2}\\right) = \\phi_R.\n$$\nDerive an algorithm to determine the coefficients $a$, $b$, and $c$, and then determine $\\max_{x} \\phi(x)$ over the closed interval. Your algorithm must:\n- Solve for $a$, $b$, and $c$ using only the three constraints above.\n- Detect whether the maximum occurs at an interior stationary point $x^\\star$ (if it exists inside the interval and corresponds to a local maximum) or at an endpoint. If the quadratic is concave down on the interval and the stationary point $x^\\star$ lies within $\\left[-\\frac{h}{2}, \\frac{h}{2}\\right]$, evaluate $\\phi(x^\\star)$. Otherwise, evaluate $\\phi$ at the endpoints and select the larger value.\n- Compute the FPF as a dimensionless float.\n\nPhysical units: $h$ must be provided in centimeters, and all fluxes must be provided in neutrons per square centimeter per second. The final Flux Peaking Factor is dimensionless and must be expressed as a float rounded to six decimal places.\n\nImplement the algorithm as a complete, runnable program that evaluates the FPF for the following test suite of cases, each specified as $(\\bar{\\phi}, \\phi_L, \\phi_R, h)$:\n- Case $1$: $(1.0, 0.8, 0.8, 10.0)$\n- Case $2$: $(1.0, 0.9, 1.2, 10.0)$\n- Case $3$: $(1.0, 0.95, 0.85, 10.0)$\n- Case $4$: $(1.0, 1.0, 1.0, 10.0)$\n- Case $5$: $(1.0, 0.4, 1.4, 5.0)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\text{result}_1,\\text{result}_2,\\dots]$), where each result is the FPF of the corresponding case rounded to six decimal places. The output must be dimensionless floats rounded to six decimal places with no additional text.",
            "solution": "The objective is to derive an algorithm for computing the Flux Peaking Factor (FPF) for a one-dimensional slab node where the intra-nodal neutron flux $\\phi(x)$ is approximated by a quadratic polynomial, $\\phi(x) = a + b x + c x^2$, over the local domain $x \\in \\left[-\\frac{h}{2}, \\frac{h}{2}\\right]$. The algorithm will be based on three fundamental constraints: the node-averaged flux $\\bar{\\phi}$, and the flux values at the left and right interfaces, $\\phi_L$ and $\\phi_R$.\n\nFirst, we determine the coefficients $a$, $b$, and $c$ by solving a system of three linear equations derived from the given constraints.\n\n1.  **Left Interface Constraint**: The flux at $x = -h/2$ must equal $\\phi_L$.\n    $$\n    \\phi\\left(-\\frac{h}{2}\\right) = a - b\\frac{h}{2} + c\\left(-\\frac{h}{2}\\right)^2 = a - \\frac{bh}{2} + \\frac{ch^2}{4} = \\phi_L\n    $$\n\n2.  **Right Interface Constraint**: The flux at $x = h/2$ must equal $\\phi_R$.\n    $$\n    \\phi\\left(\\frac{h}{2}\\right) = a + b\\frac{h}{2} + c\\left(\\frac{h}{2}\\right)^2 = a + \\frac{bh}{2} + \\frac{ch^2}{4} = \\phi_R\n    $$\n\n3.  **Cell-Average Constraint**: The spatial average of $\\phi(x)$ over the node width $h$ must equal $\\bar{\\phi}$.\n    $$\n    \\bar{\\phi} = \\frac{1}{h} \\int_{-h/2}^{h/2} (a + bx + cx^2) \\,dx = \\frac{1}{h} \\left[ ax + \\frac{bx^2}{2} + \\frac{cx^3}{3} \\right]_{-h/2}^{h/2}\n    $$\n    Evaluating the definite integral:\n    $$\n    \\bar{\\phi} = \\frac{1}{h} \\left\\{ \\left(a\\frac{h}{2} + \\frac{b}{2}\\left(\\frac{h}{2}\\right)^2 + \\frac{c}{3}\\left(\\frac{h}{2}\\right)^3\\right) - \\left(a\\left(-\\frac{h}{2}\\right) + \\frac{b}{2}\\left(-\\frac{h}{2}\\right)^2 + \\frac{c}{3}\\left(-\\frac{h}{2}\\right)^3\\right) \\right\\}\n    $$\n    $$\n    \\bar{\\phi} = \\frac{1}{h} \\left( ah + \\frac{2c}{3}\\frac{h^3}{8} \\right) = a + \\frac{ch^2}{12}\n    $$\n\nNow we solve the system of three equations for $a$, $b$, and $c$:\n(I) $a - \\frac{bh}{2} + \\frac{ch^2}{4} = \\phi_L$\n(II) $a + \\frac{bh}{2} + \\frac{ch^2}{4} = \\phi_R$\n(III) $a + \\frac{ch^2}{12} = \\bar{\\phi}$\n\nSubtracting (I) from (II) yields an expression for $b$:\n$$\n(\\text{II}) - (\\text{I}): \\quad (a + \\frac{bh}{2} + \\frac{ch^2}{4}) - (a - \\frac{bh}{2} + \\frac{ch^2}{4}) = \\phi_R - \\phi_L\n$$\n$$\nbh = \\phi_R - \\phi_L \\implies b = \\frac{\\phi_R - \\phi_L}{h}\n$$\n\nAdding (I) and (II) yields a relation between $a$ and $c$:\n$$\n(\\text{I}) + (\\text{II}): \\quad (a - \\frac{bh}{2} + \\frac{ch^2}{4}) + (a + \\frac{bh}{2} + \\frac{ch^2}{4}) = \\phi_L + \\phi_R\n$$\n$$\n2a + \\frac{ch^2}{2} = \\phi_L + \\phi_R \\implies a = \\frac{\\phi_L + \\phi_R}{2} - \\frac{ch^2}{4}\n$$\nSubstitute this expression for $a$ into (III):\n$$\n\\left(\\frac{\\phi_L + \\phi_R}{2} - \\frac{ch^2}{4}\\right) + \\frac{ch^2}{12} = \\bar{\\phi}\n$$\n$$\n\\frac{\\phi_L + \\phi_R}{2} - \\bar{\\phi} = \\frac{ch^2}{4} - \\frac{ch^2}{12} = \\frac{3ch^2 - ch^2}{12} = \\frac{2ch^2}{12} = \\frac{ch^2}{6}\n$$\nSolving for $c$:\n$$\nc = \\frac{6}{h^2} \\left( \\frac{\\phi_L + \\phi_R}{2} - \\bar{\\phi} \\right) = \\frac{3(\\phi_L + \\phi_R - 2\\bar{\\phi})}{h^2}\n$$\n\nFinally, substitute the expression for $c$ back into the expression for $a$ from (III), $a = \\bar{\\phi} - \\frac{ch^2}{12}$:\n$$\na = \\bar{\\phi} - \\frac{h^2}{12} \\left( \\frac{3(\\phi_L + \\phi_R - 2\\bar{\\phi})}{h^2} \\right) = \\bar{\\phi} - \\frac{\\phi_L + \\phi_R - 2\\bar{\\phi}}{4}\n$$\n$$\na = \\frac{4\\bar{\\phi} - \\phi_L - \\phi_R + 2\\bar{\\phi}}{4} = \\frac{6\\bar{\\phi} - \\phi_L - \\phi_R}{4} = \\frac{3}{2}\\bar{\\phi} - \\frac{\\phi_L + \\phi_R}{4}\n$$\n\nWith the coefficients determined, the next step is to find the maximum value of $\\phi(x)$ on the closed interval $\\left[-\\frac{h}{2}, \\frac{h}{2}\\right]$. The maximum of a continuous function on a closed interval occurs either at the endpoints or at an interior critical point.\n\nThe critical point(s) of the quadratic $\\phi(x)$ are found by setting its derivative to zero:\n$$\n\\phi'(x) = b + 2cx = 0 \\implies x^\\star = -\\frac{b}{2c}\n$$\nThe nature of this stationary point depends on the sign of the second derivative, $\\phi''(x) = 2c$.\n\nThe algorithmic procedure to find $\\phi_{\\max} = \\displaystyle \\max_{x \\in \\left[-\\frac{h}{2}, \\frac{h}{2}\\right]} \\phi(x)$ is as follows:\n1.  Calculate the coefficients $b$ and $c$ using the derived formulas.\n2.  Analyze the sign of $c$:\n    -   If $c \\ge 0$, the parabola is concave up or linear (if $c=0$). In this case, the maximum value on the interval must occur at one of the endpoints. Therefore, $\\phi_{\\max} = \\max\\left(\\phi_L, \\phi_R\\right)$.\n    -   If $c < 0$, the parabola is concave down, and the stationary point $x^\\star = -b/(2c)$ is a local maximum.\n        -   We must check if this maximum lies within the interval: $|x^\\star| \\le h/2$.\n        -   If it does, the global maximum on the interval is the value of the flux at this point: $\\phi_{\\max} = \\phi(x^\\star) = a + b x^\\star + c (x^\\star)^2$. This can be simplified to $\\phi_{\\max} = a - \\frac{b^2}{4c}$.\n        -   If $x^\\star$ lies outside the interval ($|x^\\star| > h/2$), the function is monotonic over $\\left[-\\frac{h}{2}, \\frac{h}{2}\\right]$, so the maximum must occur at an endpoint: $\\phi_{\\max} = \\max\\left(\\phi_L, \\phi_R\\right)$.\n\nFinally, the Flux Peaking Factor (FPF) is computed as the ratio of the maximum flux to the average flux:\n$$\n\\mathrm{FPF} = \\frac{\\phi_{\\max}}{\\bar{\\phi}}\n$$\nThis quantity is dimensionless, as both fluxes have the same units. The final algorithm is implemented for the given test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the Flux Peaking Factor (FPF) for a 1D quadratic flux profile\n    based on node-averaged and interface flux values.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (phi_bar, phi_L, phi_R, h)\n    test_cases = [\n        (1.0, 0.8, 0.8, 10.0), # Case 1\n        (1.0, 0.9, 1.2, 10.0), # Case 2\n        (1.0, 0.95, 0.85, 10.0), # Case 3\n        (1.0, 1.0, 1.0, 10.0), # Case 4\n        (1.0, 0.4, 1.4, 5.0), # Case 5\n    ]\n\n    results = []\n    \n    # A small tolerance for floating-point comparisons to zero.\n    TOL = 1e-12\n\n    for case in test_cases:\n        phi_bar, phi_L, phi_R, h = case\n\n        # Derived expressions for the quadratic coefficients of phi(x) = a + bx + cx^2\n        # b = (phi_R - phi_L) / h\n        # c = 3 * (phi_L + phi_R - 2 * phi_bar) / h^2\n        # a = 1.5 * phi_bar - 0.25 * (phi_L + phi_R)\n\n        b = (phi_R - phi_L) / h\n        c = 3.0 * (phi_L + phi_R - 2.0 * phi_bar) / (h**2)\n\n        phi_max = 0.0\n\n        if c >= -TOL:\n            # Parabola is concave up (c > 0) or linear (c ≈ 0).\n            # The maximum flux on the interval must be at one of the endpoints.\n            phi_max = max(phi_L, phi_R)\n        else:\n            # Parabola is concave down (c  0).\n            # The stationary point is a maximum.\n            x_star = -b / (2.0 * c)\n\n            # Check if the stationary point is within the closed interval [-h/2, h/2].\n            if abs(x_star) = h / 2.0:\n                # The maximum is at the internal peak.\n                # Calculate 'a' to evaluate phi(x_star).\n                a = 1.5 * phi_bar - 0.25 * (phi_L + phi_R)\n                # phi_max = a + b * x_star + c * x_star**2\n                # A more stable form is used to avoid reliance on x_star directly:\n                phi_max = a - (b**2) / (4.0 * c)\n            else:\n                # The peak is outside the interval. The function is monotonic\n                # on the interval, so the maximum must be at an endpoint.\n                phi_max = max(phi_L, phi_R)\n        \n        # Calculate the Flux Peaking Factor.\n        # Ensure phi_bar is not zero to avoid division by zero error,\n        # which is guaranteed by the problem statement (fluxes are strictly positive).\n        fpf = phi_max / phi_bar\n        \n        # Format the result to six decimal places.\n        results.append(f\"{fpf:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Building upon the concept of intra-nodal reconstruction, this final practice tackles a core task in practical reactor analysis: estimating the power of individual fuel pins from a coarse-mesh nodal solution. In this 2D problem , you will use a separable polynomial expansion to approximate the flux distribution within a fuel assembly and then calculate the average flux for each pin. This exercise moves from finding a point-wise peak to identifying the pin with the highest average power, demonstrating how macroscopic simulation data is refined to ensure detailed safety limits are met at the sub-assembly level.",
            "id": "4226992",
            "problem": "Consider a single homogenized square fuel node in a two-dimensional reactor core plane, modeled under steady-state, one-group neutron diffusion with fission source. Let the node be mapped to the reference domain $[-1,1] \\times [-1,1]$ with spatial coordinates $(x,y)$ aligned to the node’s local axes. The node-average scalar flux is given as $\\bar{\\phi} = 1$. A coarse-mesh nodal calculation has provided face-averaged scalar fluxes on the node boundaries: left face average $\\phi_{L} = 0.90$, right face average $\\phi_{R} = 1.10$, bottom face average $\\phi_{B} = 0.94$, and top face average $\\phi_{T} = 1.06$. Assume spatially uniform macroscopic cross sections within the node so that the local fission power density is proportional to the local scalar flux.\n\nUsing a separable nodal reconstruction, approximate the intra-nodal flux as $\\phi(x,y) = \\bar{\\phi}\\, f(x)\\, g(y)$ on $[-1,1] \\times [-1,1]$, where $f(x)$ and $g(y)$ are polynomials of degree at most two. Impose the following constraints that arise from nodal balance and consistency with face-averaged quantities:\n- The average of $f(x)$ over $x \\in [-1,1]$ is $1$, and the average of $g(y)$ over $y \\in [-1,1]$ is $1$.\n- The face-averaged fluxes satisfy $f(-1) = \\phi_{L}/\\bar{\\phi}$, $f(1) = \\phi_{R}/\\bar{\\phi}$, $g(-1) = \\phi_{B}/\\bar{\\phi}$, and $g(1) = \\phi_{T}/\\bar{\\phi}$.\n\nPartition the node into a uniform $4 \\times 4$ array of pins (subcells), each of size $0.5 \\times 0.5$ in the reference coordinates. Define the pin-averaged power as the area average of $\\phi(x,y)$ over each subcell. Under the separable reconstruction and the constraints above, compute the pin power peaking factor within this node, defined as the ratio of the maximum pin-averaged power to the node-averaged power. Express your final answer as a dimensionless number and round to four significant figures.",
            "solution": "The problem requires the calculation of the pin power peaking factor for a homogenized square fuel node. This factor is defined as the ratio of the maximum pin-averaged power to the node-averaged power. Given that the macroscopic cross sections are uniform, the local power density is directly proportional to the local scalar flux, $P(x,y) \\propto \\phi(x,y)$. Consequently, the pin power peaking factor is equivalent to the pin flux peaking factor, which is the ratio of the maximum pin-averaged scalar flux to the node-averaged scalar flux. The node-averaged scalar flux is given as $\\bar{\\phi} = 1$.\n\nThe intra-nodal scalar flux is approximated by a separable polynomial expansion on the domain $[-1,1] \\times [-1,1]$:\n$$\n\\phi(x,y) = \\bar{\\phi}\\, f(x)\\, g(y)\n$$\nSince $\\bar{\\phi}=1$, we have $\\phi(x,y) = f(x)g(y)$. The functions $f(x)$ and $g(y)$ are polynomials of degree at most two.\n\nFirst, we determine the polynomial $f(x)$. Let $f(x) = a_2 x^2 + a_1 x + a_0$. Three constraints are provided to determine the coefficients $a_0$, $a_1$, and $a_2$.\n1.  The average of $f(x)$ over $[-1,1]$ is $1$:\n    $$\n    \\frac{1}{1 - (-1)} \\int_{-1}^{1} f(x) dx = \\frac{1}{2} \\int_{-1}^{1} (a_2 x^2 + a_1 x + a_0) dx = 1\n    $$\n    $$\n    \\frac{1}{2} \\left[ a_2 \\frac{x^3}{3} + a_1 \\frac{x^2}{2} + a_0 x \\right]_{-1}^{1} = \\frac{1}{2} \\left( \\left(\\frac{a_2}{3} + \\frac{a_1}{2} + a_0\\right) - \\left(-\\frac{a_2}{3} + \\frac{a_1}{2} - a_0\\right) \\right) = \\frac{a_2}{3} + a_0 = 1\n    $$\n2.  The face-averaged flux on the left face ($x=-1$) is consistent with the given value $\\phi_L = 0.90$:\n    $$\n    f(-1) = a_2(-1)^2 + a_1(-1) + a_0 = a_2 - a_1 + a_0 = \\frac{\\phi_L}{\\bar{\\phi}} = \\frac{0.90}{1} = 0.90\n    $$\n3.  The face-averaged flux on the right face ($x=1$) is consistent with the given value $\\phi_R = 1.10$:\n    $$\n    f(1) = a_2(1)^2 + a_1(1) + a_0 = a_2 + a_1 + a_0 = \\frac{\\phi_R}{\\bar{\\phi}} = \\frac{1.10}{1} = 1.10\n    $$\nWe have a system of three linear equations for $a_0, a_1, a_2$:\n$$\n\\begin{cases}\n\\frac{1}{3}a_2 + a_0 = 1 \\\\\na_2 - a_1 + a_0 = 0.90 \\\\\na_2 + a_1 + a_0 = 1.10\n\\end{cases}\n$$\nAdding the second and third equations gives $2a_2 + 2a_0 = 2.00$, which simplifies to $a_2 + a_0 = 1$. Subtracting the second equation from the third gives $2a_1 = 0.20$, so $a_1 = 0.10$.\nNow we have two equations for $a_2$ and $a_0$: $a_2 + a_0 = 1$ and $\\frac{1}{3}a_2 + a_0 = 1$. Subtracting these two equations yields $(\\frac{1}{3} - 1)a_2 = 0$, which implies $-\\frac{2}{3}a_2 = 0$, so $a_2 = 0$. Substituting $a_2=0$ into $a_2 + a_0 = 1$ gives $a_0 = 1$.\nThe polynomial $f(x)$ is therefore $f(x) = 0.10x + 1$.\n\nNext, we determine the polynomial $g(y)$. Let $g(y) = b_2 y^2 + b_1 y + b_0$. The constraints are analogous:\n1.  Average of $g(y)$ over $[-1,1]$ is $1$: $\\frac{1}{3}b_2 + b_0 = 1$.\n2.  $g(-1) = \\phi_B / \\bar{\\phi} = 0.94 / 1 = 0.94$.\n3.  $g(1) = \\phi_T / \\bar{\\phi} = 1.06 / 1 = 1.06$.\nThis leads to the system:\n$$\n\\begin{cases}\n\\frac{1}{3}b_2 + b_0 = 1 \\\\\nb_2 - b_1 + b_0 = 0.94 \\\\\nb_2 + b_1 + b_0 = 1.06\n\\end{cases}\n$$\nSolving this system similarly, we add and subtract the second and third equations to find $b_2+b_0=1$ and $b_1 = 0.06$. From $b_2+b_0=1$ and $\\frac{1}{3}b_2+b_0=1$, we find $b_2=0$ and $b_0=1$.\nThe polynomial $g(y)$ is therefore $g(y) = 0.06y + 1$.\n\nThe intra-nodal flux distribution is $\\phi(x,y) = (0.10x + 1)(0.06y + 1)$.\n\nThe node is partitioned into a $4 \\times 4$ array of pins. The reference domain $[-1,1] \\times [-1,1]$ is divided into $16$ subcells, each of size $0.5 \\times 0.5$. Let a pin be indexed by $(i,j)$ for $i,j \\in \\{1,2,3,4\\}$, covering the domain $[x_{i-1}, x_i] \\times [y_{j-1}, y_j]$, where $x_i = -1 + 0.5i$ and $y_j = -1 + 0.5j$. The area of each pin is $A_{pin} = 0.5 \\times 0.5 = 0.25$.\nThe pin-averaged flux for pin $(i,j)$ is:\n$$\n\\bar{\\phi}_{ij} = \\frac{1}{A_{pin}} \\int_{y_{j-1}}^{y_j} \\int_{x_{i-1}}^{x_i} \\phi(x,y) \\,dx\\,dy = \\frac{1}{0.25} \\int_{y_{j-1}}^{y_j} \\int_{x_{i-1}}^{x_i} f(x)g(y) \\,dx\\,dy\n$$\nDue to the separable form of the flux, this becomes:\n$$\n\\bar{\\phi}_{ij} = 4 \\left( \\int_{x_{i-1}}^{x_i} f(x) \\,dx \\right) \\left( \\int_{y_{j-1}}^{y_j} g(y) \\,dy \\right)\n$$\nTo find the maximum pin-averaged flux, we need to find the maximum of $\\bar{\\phi}_{ij}$. The function $f(x)=0.10x+1$ is monotonically increasing with $x$. The function $g(y)=0.06y+1$ is monotonically increasing with $y$. Therefore, the integrals of $f(x)$ and $g(y)$ will be largest over the intervals where the functions themselves are largest. This corresponds to the top-right corner of the node. The maximum pin-averaged flux will thus be in the pin cell $(4,4)$, which corresponds to the domain $[0.5, 1] \\times [0.5, 1]$.\n\nWe calculate the required integrals for this pin:\n$$\nF_4 = \\int_{0.5}^{1} f(x) \\,dx = \\int_{0.5}^{1} (0.10x + 1) \\,dx = \\left[ 0.10\\frac{x^2}{2} + x \\right]_{0.5}^{1} = [0.05x^2 + x]_{0.5}^{1}\n$$\n$$\nF_4 = (0.05(1)^2 + 1) - (0.05(0.5)^2 + 0.5) = (1.05) - (0.05 \\times 0.25 + 0.5) = 1.05 - (0.0125 + 0.5) = 1.05 - 0.5125 = 0.5375\n$$\n$$\nG_4 = \\int_{0.5}^{1} g(y) \\,dy = \\int_{0.5}^{1} (0.06y + 1) \\,dy = \\left[ 0.06\\frac{y^2}{2} + y \\right]_{0.5}^{1} = [0.03y^2 + y]_{0.5}^{1}\n$$\n$$\nG_4 = (0.03(1)^2 + 1) - (0.03(0.5)^2 + 0.5) = (1.03) - (0.03 \\times 0.25 + 0.5) = 1.03 - (0.0075 + 0.5) = 1.03 - 0.5075 = 0.5225\n$$\nThe maximum pin-averaged flux is $\\bar{\\phi}_{44}$:\n$$\n\\bar{\\phi}_{44} = 4 F_4 G_4 = 4 \\times (0.5375) \\times (0.5225) = 1.123375\n$$\nThe pin power peaking factor is\n$$\n\\text{PPPF} = \\frac{\\max_{i,j} \\bar{\\phi}_{ij}}{\\bar{\\phi}} = \\frac{\\bar{\\phi}_{44}}{1} = 1.123375\n$$\nRounding the result to four significant figures, we get $1.123$.",
            "answer": "$$\\boxed{1.123}$$"
        }
    ]
}