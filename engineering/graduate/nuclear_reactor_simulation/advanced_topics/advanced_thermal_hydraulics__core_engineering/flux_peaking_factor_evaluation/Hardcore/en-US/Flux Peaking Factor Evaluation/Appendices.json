{
    "hands_on_practices": [
        {
            "introduction": "To begin our practical exploration, we will analyze one of the most fundamental scenarios influencing the global flux distribution: a reactor core surrounded by a neutron reflector. The presence of a reflector alters the boundary condition from a zero-flux approximation, scattering neutrons that would otherwise leak back into the core. This practice  guides you through an analytical derivation using one-group diffusion theory to quantify how this interaction flattens the flux profile and to calculate the resulting global flux peaking factor.",
            "id": "4227008",
            "problem": "Consider a one-speed neutron diffusion model of a uniform slab reactor core of half-thickness $a$, occupying $-a \\le x \\le a$, surrounded on both sides by non-multiplying reflectors of thickness $t$ occupying $a  |x| \\le a+t$. The reactor is symmetric about $x=0$. The outer boundary at $x=\\pm(a+t)$ is a vacuum boundary. The materials are homogeneous in each region, characterized by diffusion coefficients $D$ and macroscopic absorption cross sections $\\Sigma_{a}$. In the reactor core, fission neutrons are produced with an effective production term; in the reflectors, no sources exist.\n\nYou are to work in the framework of one-group neutron diffusion theory. The governing equation for the neutron flux $\\phi(x)$ in the core is the one-group Neutron Diffusion Equation (NDE),\n$$\n-D_{c}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,c}\\,\\phi=\\frac{\\nu\\Sigma_{f,c}}{k}\\,\\phi \\quad \\text{for } |x|a,\n$$\nwhere $D_{c}$ is the core diffusion coefficient, $\\Sigma_{a,c}$ is the core macroscopic absorption cross section, $\\nu\\Sigma_{f,c}$ is the core macroscopic neutron production term, and $k$ is the neutron multiplication factor. In the reflector,\n$$\n-D_{r}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,r}\\,\\phi=0 \\quad \\text{for } a|x|a+t,\n$$\nwith $D_{r}$ and $\\Sigma_{a,r}$ the reflector diffusion coefficient and absorption, respectively. Impose vacuum boundary conditions at $x=\\pm(a+t)$ and continuity of $\\phi$ and of the neutron current $J=-D\\,d\\phi/dx$ at the core-reflector interfaces $x=\\pm a$. Assume the fundamental even-parity mode in the core.\n\nDefine the Flux Peaking Factor (FPF) as\n$$\n\\text{FPF}=\\frac{\\phi_{\\max}}{\\langle \\phi \\rangle_{\\text{core}}},\n$$\nwhere $\\phi_{\\max}$ is the maximum value of $\\phi(x)$ in the core and $\\langle \\phi \\rangle_{\\text{core}}$ is the spatial average of $\\phi(x)$ over $-a\\le x\\le a$. Starting from the above NDE and boundary/interface conditions, derive the shape of $\\phi(x)$ in the core and obtain an expression for $\\text{FPF}$ in terms of the fundamental-mode wavenumber and geometry. Then, for the following material and geometric parameters,\n- $a=50\\,\\text{cm}$,\n- $t=30\\,\\text{cm}$,\n- $D_{c}=1.5\\,\\text{cm}$,\n- $D_{r}=0.7\\,\\text{cm}$,\n- $\\Sigma_{a,r}=5.0\\times 10^{-4}\\,\\text{cm}^{-1}$,\nevaluate the wavenumber that satisfies the interface condition and compute the numerical value of $\\text{FPF}$. Round your final answer to four significant figures. Express the final peaking factor as a pure number with no units.",
            "solution": "The starting point is the one-group Neutron Diffusion Equation (NDE). In the core, we write\n$$\n-D_{c}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,c}\\,\\phi=\\frac{\\nu\\Sigma_{f,c}}{k}\\,\\phi \\quad \\text{for } |x|a.\n$$\nIntroduce the core wavenumber $B$ via\n$$\nB^{2}=\\frac{\\nu\\Sigma_{f,c}/k-\\Sigma_{a,c}}{D_{c}},\n$$\nso that the core equation reduces to\n$$\n\\frac{d^{2}\\phi}{dx^{2}}+B^{2}\\phi=0.\n$$\nFor the fundamental even-parity mode in a symmetric slab, the core solution is\n$$\n\\phi_{c}(x)=A\\cos\\!\\big(Bx\\big), \\quad |x|\\le a,\n$$\nwith amplitude $A0$.\n\nIn the reflector, the NDE is\n$$\n-D_{r}\\,\\frac{d^{2}\\phi}{dx^{2}}+\\Sigma_{a,r}\\,\\phi=0, \\quad a|x|a+t.\n$$\nDefine the reflector attenuation constant\n$$\n\\kappa_{r}=\\sqrt{\\frac{\\Sigma_{a,r}}{D_{r}}}.\n$$\nOn the right reflector ($x\\in[a,a+t]$) with a vacuum boundary $\\phi\\big(a+t\\big)=0$, the general solution that satisfies the vacuum boundary is\n$$\n\\phi_{r}(x)=S\\,\\sinh\\!\\big(\\kappa_{r}(a+t-x)\\big), \\quad a\\le x\\le a+t,\n$$\nwith some constant $S$.\n\nImpose interface conditions at $x=a$:\n- Continuity of flux:\n$$\n\\phi_{c}(a)=\\phi_{r}(a)\\quad\\Rightarrow\\quad A\\cos\\!\\big(Ba\\big)=S\\,\\sinh\\!\\big(\\kappa_{r}t\\big).\n$$\n- Continuity of neutron current $J=-D\\,d\\phi/dx$:\n$$\n-D_{c}\\,\\phi_{c}'(a)=-D_{r}\\,\\phi_{r}'(a).\n$$\nCompute derivatives at $x=a$:\n$$\n\\phi_{c}'(x)=-AB\\sin\\!\\big(Bx\\big)\\quad\\Rightarrow\\quad \\phi_{c}'(a)=-AB\\sin\\!\\big(Ba\\big),\n$$\n$$\n\\phi_{r}'(x)=-S\\,\\kappa_{r}\\cosh\\!\\big(\\kappa_{r}(a+t-x)\\big)\\quad\\Rightarrow\\quad \\phi_{r}'(a)=-S\\,\\kappa_{r}\\cosh\\!\\big(\\kappa_{r}t\\big).\n$$\nThus current continuity gives\n$$\n-D_{c}\\big(-AB\\sin(Ba)\\big)=-D_{r}\\big(-S\\kappa_{r}\\cosh(\\kappa_{r}t)\\big)\\quad\\Rightarrow\\quad D_{c}AB\\sin(Ba)=D_{r}S\\kappa_{r}\\cosh(\\kappa_{r}t).\n$$\nEliminate $S$ using the flux continuity:\n$$\nS=\\frac{A\\cos(Ba)}{\\sinh(\\kappa_{r}t)}.\n$$\nSubstitute:\n$$\nD_{c}AB\\sin(Ba)=D_{r}\\left(\\frac{A\\cos(Ba)}{\\sinh(\\kappa_{r}t)}\\right)\\kappa_{r}\\cosh(\\kappa_{r}t).\n$$\nCancel $A$ and rearrange to obtain the transcendental interface condition for the core wavenumber $B$:\n$$\n\\tan\\!\\big(Ba\\big)=\\frac{D_{r}\\kappa_{r}}{D_{c}B}\\,\\coth\\!\\big(\\kappa_{r}t\\big).\n$$\n\nNext, compute the Flux Peaking Factor (FPF). For the even-parity fundamental mode, $\\phi_{\\max}$ occurs at $x=0$, so\n$$\n\\phi_{\\max}=\\phi_{c}(0)=A\\cos(0)=A.\n$$\nThe core-average flux is\n$$\n\\langle\\phi\\rangle_{\\text{core}}=\\frac{1}{2a}\\int_{-a}^{a}\\phi_{c}(x)\\,dx=\\frac{1}{2a}\\int_{-a}^{a}A\\cos(Bx)\\,dx.\n$$\nBy symmetry,\n$$\n\\langle\\phi\\rangle_{\\text{core}}=\\frac{A}{a}\\int_{0}^{a}\\cos(Bx)\\,dx=\\frac{A}{a}\\left[\\frac{\\sin(Bx)}{B}\\right]_{0}^{a}=\\frac{A}{a}\\cdot\\frac{\\sin(Ba)}{B}.\n$$\nTherefore,\n$$\n\\text{FPF}=\\frac{\\phi_{\\max}}{\\langle\\phi\\rangle_{\\text{core}}}=\\frac{A}{\\dfrac{A}{a}\\cdot\\dfrac{\\sin(Ba)}{B}}=\\frac{aB}{\\sin(Ba)}.\n$$\n\nAll quantities are now determined by material and geometric parameters through the interface equation. With the given data,\n$$\na=50,\\quad t=30,\\quad D_{c}=1.5,\\quad D_{r}=0.7,\\quad \\Sigma_{a,r}=5.0\\times 10^{-4},\n$$\ncompute\n$$\n\\kappa_{r}=\\sqrt{\\frac{\\Sigma_{a,r}}{D_{r}}}=\\sqrt{\\frac{5.0\\times 10^{-4}}{0.7}}=\\sqrt{7.142857\\times 10^{-4}}\\approx 0.02673.\n$$\nThen\n$$\n\\kappa_{r}t\\approx 0.02673\\times 30\\approx 0.8019,\n$$\nand\n$$\n\\coth(\\kappa_{r}t)=\\frac{\\cosh(\\kappa_{r}t)}{\\sinh(\\kappa_{r}t)}=\\frac{\\dfrac{\\exp(\\kappa_{r}t)+\\exp(-\\kappa_{r}t)}{2}}{\\dfrac{\\exp(\\kappa_{r}t)-\\exp(-\\kappa_{r}t)}{2}}.\n$$\nUsing $\\exp(0.8019)\\approx 2.230$ and $\\exp(-0.8019)\\approx 0.4485$,\n$$\n\\cosh(\\kappa_{r}t)\\approx \\frac{2.230+0.4485}{2}\\approx 1.33925,\\quad \\sinh(\\kappa_{r}t)\\approx \\frac{2.230-0.4485}{2}\\approx 0.89075,\n$$\nso\n$$\n\\coth(\\kappa_{r}t)\\approx \\frac{1.33925}{0.89075}\\approx 1.503.\n$$\nDefine\n$$\nR=\\frac{D_{r}\\kappa_{r}}{D_{c}}\\,\\coth(\\kappa_{r}t)=\\frac{0.7\\times 0.02673}{1.5}\\times 1.503\\approx 0.01874.\n$$\nThe interface equation becomes\n$$\n\\tan( Ba )=\\frac{R}{B}=\\frac{0.01874}{B},\\quad \\text{with } a=50.\n$$\nEquivalently,\n$$\nf(B)=\\tan(50B)-\\frac{0.01874}{B}=0.\n$$\nSolve this equation for the smallest positive $B$. A bisection or secant search yields\n$$\nB\\approx 0.01678.\n$$\nCheck consistency:\n$$\n\\tan(50B)=\\tan(0.839)\\approx 1.113,\\quad \\frac{0.01874}{B}\\approx \\frac{0.01874}{0.01678}\\approx 1.117,\n$$\nwhich agree within the expected numerical tolerance.\n\nNow evaluate the Flux Peaking Factor:\n$$\n\\text{FPF}=\\frac{aB}{\\sin(Ba)}=\\frac{50\\times 0.01678}{\\sin(0.839)}=\\frac{0.839}{\\sin(0.839)}.\n$$\nUsing a series evaluation,\n$$\n\\sin(0.839)\\approx 0.839-\\frac{0.839^{3}}{6}+\\frac{0.839^{5}}{120}-\\frac{0.839^{7}}{5040}+\\frac{0.839^{9}}{362880}\\approx 0.74415.\n$$\nThus,\n$$\n\\text{FPF}\\approx \\frac{0.839}{0.74415}\\approx 1.1276.\n$$\nRounded to four significant figures, the peaking factor is\n$$\n1.128.\n$$\nAs requested, this is a pure, dimensionless number.",
            "answer": "$$\\boxed{1.128}$$"
        },
        {
            "introduction": "Modern reactor analysis relies heavily on nodal methods, which solve for neutron fluxes on a coarse spatial mesh. While computationally efficient, these methods only provide node-averaged and surface-averaged data. This exercise  addresses the crucial subsequent step of \"pin power reconstruction,\" where we use this coarse-mesh information to estimate the detailed flux and power distribution within a node, allowing us to identify the maximum local power peak.",
            "id": "4226992",
            "problem": "Consider a single homogenized square fuel node in a two-dimensional reactor core plane, modeled under steady-state, one-group neutron diffusion with fission source. Let the node be mapped to the reference domain $[-1,1] \\times [-1,1]$ with spatial coordinates $(x,y)$ aligned to the node’s local axes. The node-average scalar flux is given as $\\bar{\\phi} = 1$. A coarse-mesh nodal calculation has provided face-averaged scalar fluxes on the node boundaries: left face average $\\phi_{L} = 0.90$, right face average $\\phi_{R} = 1.10$, bottom face average $\\phi_{B} = 0.94$, and top face average $\\phi_{T} = 1.06$. Assume spatially uniform macroscopic cross sections within the node so that the local fission power density is proportional to the local scalar flux.\n\nUsing a separable nodal reconstruction, approximate the intra-nodal flux as $\\phi(x,y) = \\bar{\\phi}\\, f(x)\\, g(y)$ on $[-1,1] \\times [-1,1]$, where $f(x)$ and $g(y)$ are polynomials of degree at most two. Impose the following constraints that arise from nodal balance and consistency with face-averaged quantities:\n- The average of $f(x)$ over $x \\in [-1,1]$ is $1$, and the average of $g(y)$ over $y \\in [-1,1]$ is $1$.\n- The face-averaged fluxes satisfy $f(-1) = \\phi_{L}/\\bar{\\phi}$, $f(1) = \\phi_{R}/\\bar{\\phi}$, $g(-1) = \\phi_{B}/\\bar{\\phi}$, and $g(1) = \\phi_{T}/\\bar{\\phi}$.\n\nPartition the node into a uniform $4 \\times 4$ array of pins (subcells), each of size $0.5 \\times 0.5$ in the reference coordinates. Define the pin-averaged power as the area average of $\\phi(x,y)$ over each subcell. Under the separable reconstruction and the constraints above, compute the pin power peaking factor within this node, defined as the ratio of the maximum pin-averaged power to the node-averaged power. Express your final answer as a dimensionless number and round to four significant figures.",
            "solution": "The problem requires the calculation of the pin power peaking factor for a homogenized square fuel node. This factor is defined as the ratio of the maximum pin-averaged power to the node-averaged power. Given that the macroscopic cross sections are uniform, the local power density is directly proportional to the local scalar flux, $P(x,y) \\propto \\phi(x,y)$. Consequently, the pin power peaking factor is equivalent to the pin flux peaking factor, which is the ratio of the maximum pin-averaged scalar flux to the node-averaged scalar flux. The node-averaged scalar flux is given as $\\bar{\\phi} = 1$.\n\nThe intra-nodal scalar flux is approximated by a separable polynomial expansion on the domain $[-1,1] \\times [-1,1]$:\n$$\n\\phi(x,y) = \\bar{\\phi}\\, f(x)\\, g(y)\n$$\nSince $\\bar{\\phi}=1$, we have $\\phi(x,y) = f(x)g(y)$. The functions $f(x)$ and $g(y)$ are polynomials of degree at most two.\n\nFirst, we determine the polynomial $f(x)$. Let $f(x) = a_2 x^2 + a_1 x + a_0$. Three constraints are provided to determine the coefficients $a_0$, $a_1$, and $a_2$.\n1.  The average of $f(x)$ over $[-1,1]$ is $1$:\n    $$\n    \\frac{1}{1 - (-1)} \\int_{-1}^{1} f(x) dx = \\frac{1}{2} \\int_{-1}^{1} (a_2 x^2 + a_1 x + a_0) dx = 1\n    $$\n    $$\n    \\frac{1}{2} \\left[ a_2 \\frac{x^3}{3} + a_1 \\frac{x^2}{2} + a_0 x \\right]_{-1}^{1} = \\frac{1}{2} \\left( \\left(\\frac{a_2}{3} + \\frac{a_1}{2} + a_0\\right) - \\left(-\\frac{a_2}{3} + \\frac{a_1}{2} - a_0\\right) \\right) = \\frac{a_2}{3} + a_0 = 1\n    $$\n2.  The face-averaged flux on the left face ($x=-1$) is consistent with the given value $\\phi_L = 0.90$:\n    $$\n    f(-1) = a_2(-1)^2 + a_1(-1) + a_0 = a_2 - a_1 + a_0 = \\frac{\\phi_L}{\\bar{\\phi}} = \\frac{0.90}{1} = 0.90\n    $$\n3.  The face-averaged flux on the right face ($x=1$) is consistent with the given value $\\phi_R = 1.10$:\n    $$\n    f(1) = a_2(1)^2 + a_1(1) + a_0 = a_2 + a_1 + a_0 = \\frac{\\phi_R}{\\bar{\\phi}} = \\frac{1.10}{1} = 1.10\n    $$\nWe have a system of three linear equations for $a_0, a_1, a_2$:\n$$\n\\begin{cases}\n\\frac{1}{3}a_2 + a_0 = 1 \\\\\na_2 - a_1 + a_0 = 0.90 \\\\\na_2 + a_1 + a_0 = 1.10\n\\end{cases}\n$$\nAdding the second and third equations gives $2a_2 + 2a_0 = 2.00$, which simplifies to $a_2 + a_0 = 1$. Subtracting the second equation from the third gives $2a_1 = 0.20$, so $a_1 = 0.10$.\nNow we have two equations for $a_2$ and $a_0$: $a_2 + a_0 = 1$ and $\\frac{1}{3}a_2 + a_0 = 1$. Subtracting these two equations yields $(\\frac{1}{3} - 1)a_2 = 0$, which implies $-\\frac{2}{3}a_2 = 0$, so $a_2 = 0$. Substituting $a_2=0$ into $a_2 + a_0 = 1$ gives $a_0 = 1$.\nThe polynomial $f(x)$ is therefore $f(x) = 0.10x + 1$.\n\nNext, we determine the polynomial $g(y)$. Let $g(y) = b_2 y^2 + b_1 y + b_0$. The constraints are analogous:\n1.  Average of $g(y)$ over $[-1,1]$ is $1$: $\\frac{1}{3}b_2 + b_0 = 1$.\n2.  $g(-1) = \\phi_B / \\bar{\\phi} = 0.94 / 1 = 0.94$.\n3.  $g(1) = \\phi_T / \\bar{\\phi} = 1.06 / 1 = 1.06$.\nThis leads to the system:\n$$\n\\begin{cases}\n\\frac{1}{3}b_2 + b_0 = 1 \\\\\nb_2 - b_1 + b_0 = 0.94 \\\\\nb_2 + b_1 + b_0 = 1.06\n\\end{cases}\n$$\nSolving this system similarly, we add and subtract the second and third equations to find $b_2+b_0=1$ and $b_1 = 0.06$. From $b_2+b_0=1$ and $\\frac{1}{3}b_2+b_0=1$, we find $b_2=0$ and $b_0=1$.\nThe polynomial $g(y)$ is therefore $g(y) = 0.06y + 1$.\n\nThe intra-nodal flux distribution is $\\phi(x,y) = (0.10x + 1)(0.06y + 1)$.\n\nThe node is partitioned into a $4 \\times 4$ array of pins. The reference domain $[-1,1] \\times [-1,1]$ is divided into $16$ subcells, each of size $0.5 \\times 0.5$. Let a pin be indexed by $(i,j)$ for $i,j \\in \\{1,2,3,4\\}$, covering the domain $[x_{i-1}, x_i] \\times [y_{j-1}, y_j]$, where $x_i = -1 + 0.5i$ and $y_j = -1 + 0.5j$. The area of each pin is $A_{pin} = 0.5 \\times 0.5 = 0.25$.\nThe pin-averaged flux for pin $(i,j)$ is:\n$$\n\\bar{\\phi}_{ij} = \\frac{1}{A_{pin}} \\int_{y_{j-1}}^{y_j} \\int_{x_{i-1}}^{x_i} \\phi(x,y) \\,dx\\,dy = \\frac{1}{0.25} \\int_{y_{j-1}}^{y_j} \\int_{x_{i-1}}^{x_i} f(x)g(y) \\,dx\\,dy\n$$\nDue to the separable form of the flux, this becomes:\n$$\n\\bar{\\phi}_{ij} = 4 \\left( \\int_{x_{i-1}}^{x_i} f(x) \\,dx \\right) \\left( \\int_{y_{j-1}}^{y_j} g(y) \\,dy \\right)\n$$\nTo find the maximum pin-averaged flux, we need to find the maximum of $\\bar{\\phi}_{ij}$. The function $f(x)=0.10x+1$ is monotonically increasing with $x$. The function $g(y)=0.06y+1$ is monotonically increasing with $y$. Therefore, the integrals of $f(x)$ and $g(y)$ will be largest over the intervals where the functions themselves are largest. This corresponds to the top-right corner of the node. The maximum pin-averaged flux will thus be in the pin cell $(4,4)$, which corresponds to the domain $[0.5, 1] \\times [0.5, 1]$.\n\nWe calculate the required integrals for this pin:\n$$\nF_4 = \\int_{0.5}^{1} f(x) \\,dx = \\int_{0.5}^{1} (0.10x + 1) \\,dx = \\left[ 0.10\\frac{x^2}{2} + x \\right]_{0.5}^{1} = [0.05x^2 + x]_{0.5}^{1}\n$$\n$$\nF_4 = (0.05(1)^2 + 1) - (0.05(0.5)^2 + 0.5) = (1.05) - (0.05 \\times 0.25 + 0.5) = 1.05 - (0.0125 + 0.5) = 1.05 - 0.5125 = 0.5375\n$$\n$$\nG_4 = \\int_{0.5}^{1} g(y) \\,dy = \\int_{0.5}^{1} (0.06y + 1) \\,dy = \\left[ 0.06\\frac{y^2}{2} + y \\right]_{0.5}^{1} = [0.03y^2 + y]_{0.5}^{1}\n$$\n$$\nG_4 = (0.03(1)^2 + 1) - (0.03(0.5)^2 + 0.5) = (1.03) - (0.03 \\times 0.25 + 0.5) = 1.03 - (0.0075 + 0.5) = 1.03 - 0.5075 = 0.5225\n$$\nThe maximum pin-averaged flux is $\\bar{\\phi}_{44}$:\n$$\n\\bar{\\phi}_{44} = 4 F_4 G_4 = 4 \\times (0.5375) \\times (0.5225) = 1.123375\n$$\nThe pin power peaking factor is\n$$\n\\text{PPPF} = \\frac{\\max_{i,j} \\bar{\\phi}_{ij}}{\\bar{\\phi}} = \\frac{\\bar{\\phi}_{44}}{1} = 1.123375\n$$\nRounding the result to four significant figures, we get $1.123$.",
            "answer": "$$\\boxed{1.123}$$"
        },
        {
            "introduction": "Building on the previous concepts, we now advance to a more realistic simulation that accounts for the energy spectrum of the neutron population. This practice  involves developing a numerical solver for the two-group neutron diffusion equations to investigate how fast and thermal fluxes can exhibit distinct spatial shapes and peaking behaviors. Furthermore, you will compute a reaction-rate-weighted peaking factor, highlighting the critical distinction between flux peaking and the more operationally significant power peaking.",
            "id": "4226996",
            "problem": "A one-dimensional (1D) multigroup neutron diffusion model is used to evaluate energy-group-specific flux peaking and reaction-rate-weighted peaking factors in a slab geometry with piecewise-homogeneous material properties and reflective boundary conditions. The task is to construct a complete program that discretizes the two-group steady-state neutron balance using a finite-volume approach and computes the fundamental-mode flux shape by solving a generalized eigenvalue problem. The final outputs are dimensionless peaking factors defined by the ratio of the maximum local quantity to its spatial average, for each energy group and for a combined fission-reaction-rate weighting.\n\nThe fundamental base is the two-group neutron balance expressed in the multigroup diffusion formulation. For group indices $g \\in \\{1,2\\}$ with $g=1$ denoting a fast group and $g=2$ denoting a thermal group, the steady-state equations (with down-scattering only and fission neutrons born in the fast group) are\n$$\n- \\frac{d}{dx}\\!\\left(D_1(x)\\,\\frac{d \\phi_1(x)}{dx}\\right) + \\Sigma_{a,1}(x)\\,\\phi_1(x) + \\Sigma_{s,1\\to 2}(x)\\,\\phi_1(x) \\;=\\; \\frac{1}{k}\\,\\nu\\left[\\Sigma_{f,1}(x)\\,\\phi_1(x) + \\Sigma_{f,2}(x)\\,\\phi_2(x)\\right],\n$$\n$$\n- \\frac{d}{dx}\\!\\left(D_2(x)\\,\\frac{d \\phi_2(x)}{dx}\\right) + \\Sigma_{a,2}(x)\\,\\phi_2(x) \\;=\\; \\Sigma_{s,1\\to 2}(x)\\,\\phi_1(x),\n$$\nwith reflective boundary conditions\n$$\n\\frac{d \\phi_g}{dx}\\Big|_{x=0} \\;=\\; 0, \\quad \\frac{d \\phi_g}{dx}\\Big|_{x=L} \\;=\\; 0,\n$$\nwhere $x$ is the spatial coordinate in centimeters, $L$ is the slab length, $D_g(x)$ are diffusion coefficients in centimeters, $\\Sigma_{a,g}(x)$ are macroscopic absorption cross sections in inverse centimeters, $\\Sigma_{s,1\\to 2}(x)$ is the down-scattering cross section from group $1$ to group $2$ in inverse centimeters, $\\Sigma_{f,g}(x)$ are macroscopic fission cross sections in inverse centimeters, $\\nu$ is the average number of neutrons per fission (dimensionless), $k$ is the effective multiplication factor (dimensionless), and $\\phi_g(x)$ are the neutron fluxes with units $\\mathrm{n}/\\mathrm{cm}^2\\cdot \\mathrm{s}$.\n\nThe program shall discretize the spatial domain into $N$ uniform cells with width $\\Delta x = L/N$ and approximate the diffusion operator using a conservative finite-volume scheme. The interfacial diffusion coefficient at the face between cells $i$ and $i+1$ shall be formed by the harmonic average\n$$\nD_{g,i+\\frac{1}{2}} \\;=\\; \\frac{2}{\\frac{1}{D_{g,i}} + \\frac{1}{D_{g,i+1}}}.\n$$\nLet $i \\in \\{0,1,\\dots,N-1\\}$ index cell centers. Define the discrete divergence of current so that reflective boundaries imply zero current at the domain ends, yielding the discrete diffusion stencil for each group:\n$$\n\\left[-\\nabla\\!\\cdot\\!\\left(D_g \\nabla \\phi_g\\right)\\right]_i \\;\\approx\\; \\frac{D_{g,i-\\frac{1}{2}}}{\\Delta x^2}\\left(\\phi_{g,i} - \\phi_{g,i-1}\\right) + \\frac{D_{g,i+\\frac{1}{2}}}{\\Delta x^2}\\left(\\phi_{g,i} - \\phi_{g,i+1}\\right),\n$$\nwith $D_{g,-\\frac{1}{2}} = 0$ at $i=0$ and $D_{g,N-\\frac{1}{2}} = 0$ at $i=N-1$ due to the zero-current reflective boundary condition. The group-$1$ removal cross section is $\\Sigma_{r,1} = \\Sigma_{a,1} + \\Sigma_{s,1\\to 2}$.\n\nAssemble the discrete system in block-matrix form\n$$\n\\mathbf{A}\\,\\boldsymbol{\\phi} \\;=\\; \\frac{1}{k}\\,\\mathbf{F}\\,\\boldsymbol{\\phi},\n$$\nwhere $\\boldsymbol{\\phi} = \\begin{bmatrix}\\boldsymbol{\\phi}_1 \\\\ \\boldsymbol{\\phi}_2\\end{bmatrix} \\in \\mathbb{R}^{2N}$ stacks the group fluxes, $\\mathbf{A} \\in \\mathbb{R}^{2N \\times 2N}$ is block lower-triangular with\n$$\n\\mathbf{A}_{11} = \\mathbf{L}_1 + \\mathrm{diag}(\\Sigma_{r,1}), \\quad \\mathbf{A}_{22} = \\mathbf{L}_2 + \\mathrm{diag}(\\Sigma_{a,2}), \\quad \\mathbf{A}_{21} = -\\,\\mathrm{diag}(\\Sigma_{s,1\\to 2}), \\quad \\mathbf{A}_{12} = \\mathbf{0},\n$$\nand $\\mathbf{L}_g$ are the discrete diffusion operators built from the harmonic averages at faces, while the fission production matrix $\\mathbf{F}$ is\n$$\n\\mathbf{F} \\;=\\; \\begin{bmatrix}\n\\mathrm{diag}\\!\\left(\\nu\\,\\Sigma_{f,1}\\right)  \\mathrm{diag}\\!\\left(\\nu\\,\\Sigma_{f,2}\\right)\\\\\n\\mathbf{0}  \\mathbf{0}\n\\end{bmatrix}.\n$$\nThe fundamental-mode flux shape corresponds to the dominant right eigenvector of $\\mathbf{M} = \\mathbf{A}^{-1}\\mathbf{F}$ associated with the largest eigenvalue $\\lambda_{\\max} = 1/k$. The program shall compute this eigenvector using an iterative power method and then extract the group fluxes $\\boldsymbol{\\phi}_1$ and $\\boldsymbol{\\phi}_2$.\n\nDefine the energy-group-specific flux peaking factors\n$$\nP_1 \\;=\\; \\frac{\\max_i \\phi_{1,i}}{\\frac{1}{N}\\sum_{i=0}^{N-1} \\phi_{1,i}}, \\quad\nP_2 \\;=\\; \\frac{\\max_i \\phi_{2,i}}{\\frac{1}{N}\\sum_{i=0}^{N-1} \\phi_{2,i}},\n$$\nand the reaction-rate-weighted total fission peaking factor\n$$\nP_F \\;=\\; \\frac{\\displaystyle\\max_i \\left(\\Sigma_{f,1,i}\\,\\phi_{1,i} + \\Sigma_{f,2,i}\\,\\phi_{2,i}\\right)}{\\displaystyle\\frac{1}{N}\\sum_{i=0}^{N-1} \\left(\\Sigma_{f,1,i}\\,\\phi_{1,i} + \\Sigma_{f,2,i}\\,\\phi_{2,i}\\right)}.\n$$\nAll peaking factors are dimensionless and must be returned as floating-point numbers.\n\nImplement the program to evaluate $(P_1,P_2,P_F)$ for the following test suite of piecewise-homogeneous cases. Material properties are specified per region and must be assigned to each cell according to its center location $x_i = \\left(i+\\frac{1}{2}\\right)\\Delta x$. All cross sections are in $\\mathrm{cm}^{-1}$, all diffusion coefficients are in $\\mathrm{cm}$, all lengths are in $\\mathrm{cm}$, and the average neutrons per fission $\\nu$ is dimensionless. The output must be dimensionless floats.\n\n- Case $1$ (two-region moderator–fuel–moderator slab):\n  - Slab length $L = 100\\,\\mathrm{cm}$, number of cells $N = 200$.\n  - Regions: left moderator for $x \\in [0,25)\\,\\mathrm{cm}$; middle fuel for $x \\in [25,75)\\,\\mathrm{cm}$; right moderator for $x \\in [75,100]\\,\\mathrm{cm}$.\n  - Moderator: $D_1 = 1.5\\,\\mathrm{cm}$, $D_2 = 0.4\\,\\mathrm{cm}$, $\\Sigma_{a,1} = 0.005\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a,2} = 0.040\\,\\mathrm{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 0.020\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,1} = 0.0000\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,2} = 0.0000\\,\\mathrm{cm}^{-1}$.\n  - Fuel: $D_1 = 1.2\\,\\mathrm{cm}$, $D_2 = 0.3\\,\\mathrm{cm}$, $\\Sigma_{a,1} = 0.010\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a,2} = 0.080\\,\\mathrm{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 0.050\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,1} = 0.002\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,2} = 0.120\\,\\mathrm{cm}^{-1}$.\n  - Average neutrons per fission $\\nu = 2.5$.\n\n- Case $2$ (uniform fuel-like slab):\n  - Slab length $L = 60\\,\\mathrm{cm}$, number of cells $N = 120$.\n  - Uniform properties: $D_1 = 1.2\\,\\mathrm{cm}$, $D_2 = 0.3\\,\\mathrm{cm}$, $\\Sigma_{a,1} = 0.008\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a,2} = 0.060\\,\\mathrm{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 0.040\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,1} = 0.001\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,2} = 0.100\\,\\mathrm{cm}^{-1}$.\n  - Average neutrons per fission $\\nu = 2.5$.\n\n- Case $3$ (localized hot zone in a moderating background):\n  - Slab length $L = 60\\,\\mathrm{cm}$, number of cells $N = 240$.\n  - Background properties: $D_1 = 1.3\\,\\mathrm{cm}$, $D_2 = 0.35\\,\\mathrm{cm}$, $\\Sigma_{a,1} = 0.007\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a,2} = 0.050\\,\\mathrm{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 0.030\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,1} = 0.0005\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,2} = 0.020\\,\\mathrm{cm}^{-1}$.\n  - Hot-zone properties (applied to the central region $x \\in \\left[\\frac{L}{2}-3, \\frac{L}{2}+3\\right]\\,\\mathrm{cm}$): $D_1 = 1.3\\,\\mathrm{cm}$, $D_2 = 0.35\\,\\mathrm{cm}$, $\\Sigma_{a,1} = 0.007\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a,2} = 0.090\\,\\mathrm{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 0.060\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,1} = 0.001\\,\\mathrm{cm}^{-1}$, $\\Sigma_{f,2} = 0.600\\,\\mathrm{cm}^{-1}$.\n  - Average neutrons per fission $\\nu = 2.5$.\n\nAll quantities must be handled in the units stated above, and the program’s final outputs must be the dimensionless peaking factors.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\left[P_1^{(1)},\\,P_2^{(1)},\\,P_F^{(1)},\\,P_1^{(2)},\\,P_2^{(2)},\\,P_F^{(2)},\\,P_1^{(3)},\\,P_2^{(3)},\\,P_F^{(3)}\\right],\n$$\nwhere the superscripts indicate the case number. Each list element must be a floating-point number. No other text should be printed.",
            "solution": "The problem statement has been validated and found to be well-posed, scientifically sound, and self-contained. It presents a standard problem in computational reactor physics: determining the fundamental-mode neutron flux distribution and associated peaking factors in a one-dimensional, two-group neutron diffusion model. The provided equations, boundary conditions, discretization scheme, and material data are consistent and physically realistic. We may therefore proceed with a complete solution.\n\nThe solution synthesizes the principles of neutron diffusion theory with numerical methods for solving generalized eigenvalue problems. The core of the task is to discretize the continuous domain and equations into an algebraic system and then solve it for the dominant mode.\n\n**1. Discretization using the Finite Volume Method**\n\nThe continuous, steady-state, two-group neutron diffusion equations are given as:\n$$\n- \\frac{d}{dx}\\!\\left(D_1(x)\\,\\frac{d \\phi_1(x)}{dx}\\right) + \\Sigma_{r,1}(x)\\,\\phi_1(x) \\;=\\; \\frac{1}{k}\\left(\\nu\\Sigma_{f,1}(x)\\,\\phi_1(x) + \\nu\\Sigma_{f,2}(x)\\,\\phi_2(x)\\right)\n$$\n$$\n- \\frac{d}{dx}\\!\\left(D_2(x)\\,\\frac{d \\phi_2(x)}{dx}\\right) + \\Sigma_{a,2}(x)\\,\\phi_2(x) \\;=\\; \\Sigma_{s,1\\to 2}(x)\\,\\phi_1(x)\n$$\nHere, the group-$1$ removal cross section is defined as $\\Sigma_{r,1}(x) = \\Sigma_{a,1}(x) + \\Sigma_{s,1\\to 2}(x)$. The domain $x \\in [0, L]$ is subject to reflective boundary conditions, which imply zero net current ($J_g(x) = -D_g(x) \\frac{d\\phi_g(x)}{dx}$) at the boundaries: $J_g(0) = J_g(L) = 0$.\n\nWe discretize the domain into $N$ uniform cells, each of width $\\Delta x = L/N$. The cell centers are located at $x_i = (i + 1/2)\\Delta x$ for $i \\in \\{0, 1, \\dots, N-1\\}$. The flux $\\phi_g(x)$ is approximated by its cell-averaged value $\\phi_{g,i}$ within cell $i$. Integrating the diffusion equation over cell $i$, from $x_{i-1/2}$ to $x_{i+1/2}$, yields:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( -\\frac{d J_g(x)}{dx} + \\Sigma_{\\text{reaction},g}(x)\\phi_g(x) \\right) dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} S_g(x) dx\n$$\nwhere $\\Sigma_{\\text{reaction},g}$ and $S_g$ represent the appropriate reaction and source terms for group $g$. Applying the fundamental theorem of calculus to the leakage term and approximating the remaining integrals gives:\n$$\n-J_{g,i+1/2} + J_{g,i-1/2} + \\Sigma_{\\text{reaction},g,i}\\,\\phi_{g,i}\\,\\Delta x \\approx S_{g,i}\\,\\Delta x\n$$\nThe interface currents $J_{g,i\\pm 1/2}$ are approximated using a finite difference on the cell-centered fluxes:\n$$\nJ_{g,i+1/2} = -D_{g,i+1/2}\\frac{\\phi_{g,i+1}-\\phi_{g,i}}{\\Delta x}\n$$\nThe problem specifies the harmonic mean for the interface diffusion coefficient, a standard choice that preserves current continuity across material interfaces:\n$$\nD_{g,i+1/2} = \\frac{2 D_{g,i} D_{g,i+1}}{D_{g,i} + D_{g,i+1}}\n$$\nCombining these expressions leads to the discrete form of the diffusion operator for cell $i$, which constitutes a row of the leakage matrix $\\mathbf{L}_g$:\n$$\n[-\\nabla \\cdot (D_g \\nabla \\phi_g)]_i \\approx \\frac{1}{\\Delta x^2} \\left[ -D_{g,i-1/2} \\phi_{g,i-1} + (D_{g,i-1/2} + D_{g,i+1/2}) \\phi_{g,i} - D_{g,i+1/2} \\phi_{g,i+1} \\right]\n$$\nThe reflective boundary conditions ($J_g(0)=0, J_g(L)=0$) are imposed by setting the interface diffusion coefficients at the domain boundaries to zero, i.e., $D_{g,-1/2} = 0$ and $D_{g,N-1/2} = 0$. This results in $\\mathbf{L}_g$ being an $N \\times N$ symmetric, positive semi-definite, tridiagonal matrix.\n\n**2. Assembling the Algebraic Eigenvalue Problem**\n\nWith the discretization defined, the continuous equations are transformed into a matrix eigenvalue problem, $\\mathbf{A}\\boldsymbol{\\phi} = \\frac{1}{k}\\mathbf{F}\\boldsymbol{\\phi}$. The flux vector $\\boldsymbol{\\phi} = [\\boldsymbol{\\phi}_1^T, \\boldsymbol{\\phi}_2^T]^T$ is a vector of length $2N$.\nThe loss-and-scattering matrix $\\mathbf{A}$ and the fission-production matrix $\\mathbf{F}$ are $2N \\times 2N$ block matrices:\n$$\n\\mathbf{A} = \\begin{bmatrix} \\mathbf{L}_1 + \\mathrm{diag}(\\Sigma_{r,1})  \\mathbf{0} \\\\ -\\mathrm{diag}(\\Sigma_{s,1\\to 2})  \\mathbf{L}_2 + \\mathrm{diag}(\\Sigma_{a,2}) \\end{bmatrix}, \\quad \\mathbf{F} = \\begin{bmatrix} \\mathrm{diag}(\\nu\\Sigma_{f,1})  \\mathrm{diag}(\\nu\\Sigma_{f,2}) \\\\ \\mathbf{0}  \\mathbf{0} \\end{bmatrix}\n$$\nThe sub-matrices $\\mathbf{L}_g + \\mathrm{diag}(\\cdot)$ are tridiagonal. Specifically, for $\\mathbf{A}_{11} = \\mathbf{L}_1 + \\mathrm{diag}(\\Sigma_{r,1})$, the diagonal and off-diagonal elements are:\n- Main diagonal $(i,i)$: $\\frac{D_{1,i-1/2} + D_{1,i+1/2}}{\\Delta x^2} + \\Sigma_{r,1,i}$\n- Sub-diagonal $(i,i-1)$: $-\\frac{D_{1,i-1/2}}{\\Delta x^2}$\n- Super-diagonal $(i,i+1)$: $-\\frac{D_{1,i+1/2}}{\\Delta x^2}$\nSimilar expressions hold for $\\mathbf{A}_{22}$.\n\n**3. Solving via Power Iteration (Source Iteration Method)**\n\nThe problem seeks the fundamental-mode solution, which corresponds to the eigenvector associated with the largest positive eigenvalue $k$ (the effective multiplication factor). This is found using the power iteration method, also known in this context as source iteration.\n\nThe algorithm proceeds as follows:\n1. Initialize the flux vector $\\boldsymbol{\\phi}^{(0)}$ (e.g., a vector of all ones) and the eigenvalue $k^{(0)} = 1.0$.\n2. For iteration $p = 1, 2, \\dots$ until convergence:\n    a. Compute the fission source from the previous flux iterate: $\\mathbf{s}_{fission}^{(p-1)} = \\mathbf{F} \\boldsymbol{\\phi}^{(p-1)}$.\n    b. The total source for the linear system is $\\mathbf{S} = \\frac{1}{k^{(p-1)}} \\mathbf{s}_{fission}^{(p-1)}$.\n    c. Solve the linear system $\\mathbf{A}\\boldsymbol{\\phi}^{(p)} = \\mathbf{S}$ for the new flux vector $\\boldsymbol{\\phi}^{(p)}$. Since $\\mathbf{A}$ is block lower-triangular, this is solved in two stages:\n        i. Solve for the fast flux $\\boldsymbol{\\phi}_1^{(p)}$: $(\\mathbf{L}_1 + \\mathrm{diag}(\\Sigma_{r,1}))\\boldsymbol{\\phi}_1^{(p)} = \\mathbf{S}_1$. This is a tridiagonal system, efficiently solvable with the Thomas algorithm (TDMA).\n        ii. Solve for the thermal flux $\\boldsymbol{\\phi}_2^{(p)}$: $(\\mathbf{L}_2 + \\mathrm{diag}(\\Sigma_{a,2}))\\boldsymbol{\\phi}_2^{(p)} = \\mathbf{S}_2 - \\mathbf{A}_{21}\\boldsymbol{\\phi}_1^{(p)} = \\mathbf{0} + \\mathrm{diag}(\\Sigma_{s,1\\to 2})\\boldsymbol{\\phi}_1^{(p)}$. This is also a tridiagonal system solved via TDMA.\n    d. Compute a new fission source from the updated flux: $\\mathbf{s}_{fission}^{(p)} = \\mathbf{F} \\boldsymbol{\\phi}^{(p)}$.\n    e. Update the eigenvalue: $k^{(p)} = k^{(p-1)} \\, \\frac{\\sum_j (\\mathbf{s}_{fission}^{(p)})_j}{\\sum_j (\\mathbf{s}_{fission}^{(p-1)})_j}$. This ratio effectively compares the total neutron production rate between iterations.\n    f. Check for convergence, for instance, by requiring $|k^{(p)} - k^{(p-1)}|  \\epsilon$ for a small tolerance $\\epsilon$. If not converged, update $\\boldsymbol{\\phi}^{(p-1)} \\leftarrow \\boldsymbol{\\phi}^{(p)}$ and $k^{(p-1)} \\leftarrow k^{(p)}$ and repeat.\n\n**4. Calculation of Peaking Factors**\n\nOnce the power iteration converges, we have the fundamental-mode flux eigenvector $\\boldsymbol{\\phi} = [\\boldsymbol{\\phi}_1^T, \\boldsymbol{\\phi}_2^T]^T$. The problem requires three dimensionless peaking factors, defined as the ratio of the maximum value to the spatial average.\n1. Fast Flux Peaking Factor, $P_1$:\n$$\nP_1 = \\frac{\\max_{i} \\phi_{1,i}}{\\langle \\phi_1 \\rangle} = \\frac{\\max_{i} \\phi_{1,i}}{\\frac{1}{N}\\sum_{i=0}^{N-1} \\phi_{1,i}}\n$$\n2. Thermal Flux Peaking Factor, $P_2$:\n$$\nP_2 = \\frac{\\max_{i} \\phi_{2,i}}{\\langle \\phi_2 \\rangle} = \\frac{\\max_{i} \\phi_{2,i}}{\\frac{1}{N}\\sum_{i=0}^{N-1} \\phi_{2,i}}\n$$\n3. Fission Rate Peaking Factor, $P_F$: First, we compute the pointwise fission reaction rate, $f_i = \\Sigma_{f,1,i}\\phi_{1,i} + \\Sigma_{f,2,i}\\phi_{2,i}$.\n$$\nP_F = \\frac{\\max_i f_i}{\\langle f \\rangle} = \\frac{\\max_i f_i}{\\frac{1}{N}\\sum_{i=0}^{N-1} f_i}\n$$\nThese steps are implemented for each of the three test cases specified, yielding nine final floating-point values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to solve the neutron diffusion problem for all test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case 1\",\n            \"L\": 100.0,\n            \"N\": 200,\n            \"nu\": 2.5,\n            \"regions\": [\n                {\"bounds\": (0, 25), \"props\": {\"D1\": 1.5, \"D2\": 0.4, \"Sa1\": 0.005, \"Sa2\": 0.040, \"Ss12\": 0.020, \"Sf1\": 0.0, \"Sf2\": 0.0}}, # Moderator\n                {\"bounds\": (25, 75), \"props\": {\"D1\": 1.2, \"D2\": 0.3, \"Sa1\": 0.010, \"Sa2\": 0.080, \"Ss12\": 0.050, \"Sf1\": 0.002, \"Sf2\": 0.120}}, # Fuel\n                {\"bounds\": (75, 100), \"props\": {\"D1\": 1.5, \"D2\": 0.4, \"Sa1\": 0.005, \"Sa2\": 0.040, \"Ss12\": 0.020, \"Sf1\": 0.0, \"Sf2\": 0.0}}  # Moderator\n            ]\n        },\n        {\n            \"name\": \"Case 2\",\n            \"L\": 60.0,\n            \"N\": 120,\n            \"nu\": 2.5,\n            \"regions\": [\n                {\"bounds\": (0, 60), \"props\": {\"D1\": 1.2, \"D2\": 0.3, \"Sa1\": 0.008, \"Sa2\": 0.060, \"Ss12\": 0.040, \"Sf1\": 0.001, \"Sf2\": 0.100}}\n            ]\n        },\n        {\n            \"name\": \"Case 3\",\n            \"L\": 60.0,\n            \"N\": 240,\n            \"nu\": 2.5,\n            \"regions\": [\n                {\"bounds\": (0, 60), \"props\": {\"D1\": 1.3, \"D2\": 0.35, \"Sa1\": 0.007, \"Sa2\": 0.050, \"Ss12\": 0.030, \"Sf1\": 0.0005, \"Sf2\": 0.020}}, # Background\n                {\"bounds\": (27, 33), \"props\": {\"D1\": 1.3, \"D2\": 0.35, \"Sa1\": 0.007, \"Sa2\": 0.090, \"Ss12\": 0.060, \"Sf1\": 0.001, \"Sf2\": 0.600}}  # Hot zone\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p1, p2, pf = calculate_peaking_factors(case)\n        results.extend([p1, p2, pf])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef tdma_solver(a, b, c, d):\n    \"\"\"\n    Tridiagonal Matrix Algorithm (Thomas Algorithm) solver.\n    a: sub-diagonal (a[0] is ignored)\n    b: main diagonal\n    c: super-diagonal (c[N-1] is ignored)\n    d: right-hand side vector\n    \"\"\"\n    N = len(d)\n    c_p = np.zeros(N)\n    d_p = np.zeros(N)\n    x = np.zeros(N)\n\n    # Forward sweep\n    c_p[0] = c[0] / b[0]\n    d_p[0] = d[0] / b[0]\n    for i in range(1, N):\n        denom = b[i] - a[i] * c_p[i-1]\n        if i  N - 1:\n            c_p[i] = c[i] / denom\n        d_p[i] = (d[i] - a[i] * d_p[i-1]) / denom\n\n    # Backward substitution\n    x[N-1] = d_p[N-1]\n    for i in range(N - 2, -1, -1):\n        x[i] = d_p[i] - c_p[i] * x[i+1]\n        \n    return x\n\ndef calculate_peaking_factors(case_params):\n    \"\"\"\n    Calculates flux and fission peaking factors for a given case.\n    \"\"\"\n    L = case_params[\"L\"]\n    N = case_params[\"N\"]\n    nu = case_params[\"nu\"]\n    dx = L / N\n    \n    # Material properties arrays\n    D1, D2 = np.zeros(N), np.zeros(N)\n    Sa1, Sa2 = np.zeros(N), np.zeros(N)\n    Ss12 = np.zeros(N)\n    Sf1, Sf2 = np.zeros(N), np.zeros(N)\n    \n    cell_centers = (np.arange(N) + 0.5) * dx\n    for region in case_params[\"regions\"]:\n        lower, upper = region[\"bounds\"]\n        props = region[\"props\"]\n        mask = (cell_centers >= lower)  (cell_centers  upper)\n        # For the last region, include the upper bound if it's the end of the slab\n        if upper == L:\n            mask = (cell_centers >= lower)  (cell_centers = upper)\n        \n        D1[mask], D2[mask] = props[\"D1\"], props[\"D2\"]\n        Sa1[mask], Sa2[mask] = props[\"Sa1\"], props[\"Sa2\"]\n        Ss12[mask] = props[\"Ss12\"]\n        Sf1[mask], Sf2[mask] = props[\"Sf1\"], props[\"Sf2\"]\n\n    Sr1 = Sa1 + Ss12\n\n    # Interface diffusion coefficients (harmonic mean)\n    D1_interface = np.zeros(N - 1)\n    D2_interface = np.zeros(N - 1)\n    for i in range(N - 1):\n        D1_interface[i] = 2.0 * D1[i] * D1[i+1] / (D1[i] + D1[i+1])\n        D2_interface[i] = 2.0 * D2[i] * D2[i+1] / (D2[i] + D2[i+1])\n        \n    # Build tridiagonal matrices A11 and A22\n    def build_tridiagonal(D_cell, D_int, Sigma_removal):\n        a = np.zeros(N)  # sub-diagonal\n        b = np.zeros(N)  # main diagonal\n        c = np.zeros(N)  # sup-diagonal\n        \n        # i = 0 (left boundary)\n        b[0] = D_int[0] / dx**2 + Sigma_removal[0]\n        c[0] = -D_int[0] / dx**2\n        \n        # i = 1 to N-2\n        for i in range(1, N - 1):\n            a[i] = -D_int[i-1] / dx**2\n            b[i] = (D_int[i-1] + D_int[i]) / dx**2 + Sigma_removal[i]\n            c[i] = -D_int[i] / dx**2\n            \n        # i = N-1 (right boundary)\n        a[N-1] = -D_int[N-2] / dx**2\n        b[N-1] = D_int[N-2] / dx**2 + Sigma_removal[N-1]\n        \n        return a, b, c\n\n    a1, b1, c1 = build_tridiagonal(D1, D1_interface, Sr1)\n    a2, b2, c2 = build_tridiagonal(D2, D2_interface, Sa2)\n\n    # Power Iteration\n    phi1 = np.ones(N)\n    phi2 = np.ones(N)\n    k_eff = 1.0\n    tol = 1e-8\n    max_iter = 2000\n\n    fission_source_old_sum = 1.0 # arbitrary non-zero\n    for _ in range(max_iter):\n        # Fission source\n        fission_prod1 = nu * (Sf1 * phi1 + Sf2 * phi2)\n        \n        fission_source_new_sum = np.sum(fission_prod1)\n        k_eff *= fission_source_new_sum / fission_source_old_sum\n        \n        source1 = fission_prod1 / k_eff\n        \n        # Solve for group 1 flux\n        phi1_new = tdma_solver(a1, b1, c1, source1)\n        \n        # Solve for group 2 flux\n        source2 = Ss12 * phi1_new\n        phi2_new = tdma_solver(a2, b2, c2, source2)\n        \n        # Check for convergence\n        if abs(fission_source_new_sum - fission_source_old_sum)  tol * fission_source_new_sum:\n            break\n            \n        # Update for next iteration\n        phi1 = phi1_new.copy()\n        phi2 = phi2_new.copy()\n        fission_source_old_sum = fission_source_new_sum\n\n    # Calculate Peaking Factors\n    p1 = np.max(phi1) / np.mean(phi1)\n    p2 = np.max(phi2) / np.mean(phi2)\n    \n    fission_rate = Sf1 * phi1 + Sf2 * phi2\n    pf = np.max(fission_rate) / np.mean(fission_rate)\n    \n    return p1, p2, pf\n\nsolve()\n\n```"
        }
    ]
}