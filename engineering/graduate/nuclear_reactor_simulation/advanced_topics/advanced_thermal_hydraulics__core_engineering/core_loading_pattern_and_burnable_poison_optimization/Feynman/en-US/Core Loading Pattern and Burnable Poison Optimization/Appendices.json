{
    "hands_on_practices": [
        {
            "introduction": "A core principle in using burnable poisons is understanding their effect on the neutron energy distribution. This exercise explores this fundamental concept using a two-group diffusion model, a cornerstone of reactor physics. You will quantify 'spectral hardening'—the shift in neutron population to higher energies due to a thermal absorber—and analyze how this change interacts with neutron leakage to affect both the infinite-medium ($k_{\\infty}$) and effective ($k_{\\mathrm{eff}}$) multiplication factors .",
            "id": "4219351",
            "problem": "A two-group neutron diffusion model is used to analyze the effect of spectral hardening induced by gadolinium oxide burnable poison on the infinite-medium multiplication factor and the effective multiplication factor. The task is to derive from the two-group neutron balance with diffusion leakage how added thermal absorption from gadolinia changes the group-wise fluxes and the multiplication factors, then quantify the resulting difference between the infinite-medium multiplication factor and the effective multiplication factor using leakage-dependent spectral indices and group-wise reaction rates. The analysis is framed in purely mathematical terms and must be implemented as a complete, runnable program.\n\nAssume a spatially uniform reactor region, modeled by two energy groups: group $1$ (fast) and group $2$ (thermal). Neutrons are born from fission predominantly in the fast group and may scatter between the two groups. The two-group steady-state diffusion approximation with homogeneous buckling is the fundamental base. In this approximation, the balance equations for each group include removal by absorption and out-scatter, in-scatter from the other group, diffusion leakage modeled by geometric buckling, and fission production scaled by the multiplication factor. Let $k$ denote the multiplication factor, with $k_{\\infty}$ the infinite-medium multiplication factor obtained with zero leakage, and $k_{\\mathrm{eff}}$ the effective multiplication factor obtained with nonzero leakage.\n\nLet the macroscopic absorption cross sections be $\\,\\Sigma_{a1}\\,$ and $\\,\\Sigma_{a2}\\,$ (units: $\\text{cm}^{-1}$), the macroscopic scattering cross sections be $\\,\\Sigma_{s12}\\,$ (from $1$ to $2$) and $\\,\\Sigma_{s21}\\,$ (from $2$ to $1$) (units: $\\text{cm}^{-1}$), the diffusion coefficients be $\\,D_1\\,$ and $\\,D_2\\,$ (units: $\\text{cm}$), the geometric buckling be $\\,B^2\\,$ (units: $\\text{cm}^{-2}$), the macroscopic fission production cross sections be $\\,\\nu\\Sigma_{f1}\\,$ and $\\,\\nu\\Sigma_{f2}\\,$ (units: $\\text{cm}^{-1}$), and the fission spectrum fractions be $\\,\\chi_1\\,$ and $\\,\\chi_2\\,$, with $\\,\\chi_1 + \\chi_2 = 1\\,$. Define the removal cross sections $\\,\\Sigma_{r1} = \\Sigma_{a1} + \\Sigma_{s12}\\,$ and $\\,\\Sigma_{r2} = \\Sigma_{a2} + \\Sigma_{s21}\\,$. The balance for group fluxes $\\,\\phi_1\\,$ and $\\,\\phi_2\\,$ can be written in matrix form as a generalized eigenvalue problem derived from diffusion theory:\n$$\n\\begin{bmatrix}\n\\Sigma_{r1} + D_1 B^2 & -\\Sigma_{s21} \\\\\n-\\Sigma_{s12} & \\Sigma_{r2} + D_2 B^2\n\\end{bmatrix}\n\\begin{bmatrix}\n\\phi_1 \\\\\n\\phi_2\n\\end{bmatrix}\n=\n\\frac{1}{k}\n\\begin{bmatrix}\n\\chi_1 \\nu\\Sigma_{f1} & \\chi_1 \\nu\\Sigma_{f2} \\\\\n\\chi_2 \\nu\\Sigma_{f1} & \\chi_2 \\nu\\Sigma_{f2}\n\\end{bmatrix}\n\\begin{bmatrix}\n\\phi_1 \\\\\n\\phi_2\n\\end{bmatrix}.\n$$\nThis expression embodies the fundamental laws: steady-state neutron balance, diffusion leakage captured by $\\,D_g B^2\\,$ terms, and production by fission with spectrum fractions.\n\nTo model gadolinia-induced spectral hardening, let the burnable poison loading be parameterized by a dimensionless scalar $\\,p \\ge 0\\,$. The poison increases absorption predominantly in the thermal group. Use the following linearized model for the macroscopic absorption cross sections with $\\,p\\,$:\n$$\n\\Sigma_{a1}(p) = \\Sigma_{a1}^{(0)} + \\beta\\,p, \\qquad \\Sigma_{a2}(p) = \\Sigma_{a2}^{(0)} + \\alpha\\,p,\n$$\nwhere $\\,\\alpha\\,$ and $\\,\\beta\\,$ are constants with $\\,\\alpha \\gg \\beta\\,$, capturing that gadolinia absorbs mostly thermal neutrons. All other parameters are independent of $\\,p\\,$. The spectral index is defined as the ratio of fast to thermal flux,\n$$\nS(B^2) = \\frac{\\phi_1(B^2)}{\\phi_2(B^2)},\n$$\nand the infinite-medium spectral index is $\\,S(0)\\,$. Quantify spectral hardening by how $\\,S(B^2)\\,$ increases with $\\,p\\,$ and $\\,B^2\\,$. In addition, quantify the redistribution of reaction rates by computing group-wise normalized absorption fractions and fission fractions:\n$$\nf^{(a)}_1 = \\frac{\\Sigma_{a1}\\,\\phi_1}{\\Sigma_{a1}\\,\\phi_1 + \\Sigma_{a2}\\,\\phi_2}, \\quad\nf^{(a)}_2 = \\frac{\\Sigma_{a2}\\,\\phi_2}{\\Sigma_{a1}\\,\\phi_1 + \\Sigma_{a2}\\,\\phi_2},\n$$\n$$\nf^{(f)}_1 = \\frac{\\nu\\Sigma_{f1}\\,\\phi_1}{\\nu\\Sigma_{f1}\\,\\phi_1 + \\nu\\Sigma_{f2}\\,\\phi_2}, \\quad\nf^{(f)}_2 = \\frac{\\nu\\Sigma_{f2}\\,\\phi_2}{\\nu\\Sigma_{f1}\\,\\phi_1 + \\nu\\Sigma_{f2}\\,\\phi_2}.\n$$\nAll outputs are dimensionless numbers. No physical unit conversion or reporting is required because the flux normalization cancels absolute units; only ratios and multiplication factors are reported.\n\nYou must implement a program that, for each test case listed below, constructs the matrices, computes $\\,k_{\\infty}\\,$ from the zero-leakage case $\\,B^2 = 0\\,$, computes $\\,k_{\\mathrm{eff}}\\,$ from the specified nonzero $\\,B^2\\,$, extracts the corresponding dominant eigenvectors to form the spectral indices $\\,S(0)\\,$ and $\\,S(B^2)\\,$, calculates the difference $\\,\\Delta k = k_{\\infty} - k_{\\mathrm{eff}}\\,$, and evaluates the normalized group-wise absorption and fission fractions for the leakage case. Select the principal (largest real) eigenvalue and the associated right eigenvector for each matrix pair. For numerical stability, discard any negligible imaginary parts arising from floating-point computations.\n\nUse the following scientifically plausible parameter values, stated with their physical units for clarity in the model specification, while the outputs remain dimensionless:\n- Base macroscopic absorption cross sections: $\\,\\Sigma_{a1}^{(0)} = 0.010\\,\\text{cm}^{-1}\\,$, $\\,\\Sigma_{a2}^{(0)} = 0.080\\,\\text{cm}^{-1}\\,$.\n- Macroscopic scattering cross sections: $\\,\\Sigma_{s12} = 0.200\\,\\text{cm}^{-1}\\,$, $\\,\\Sigma_{s21} = 0.005\\,\\text{cm}^{-1}\\,$.\n- Diffusion coefficients: $\\,D_1 = 1.300\\,\\text{cm}\\,$, $\\,D_2 = 0.300\\,\\text{cm}\\,$.\n- Macroscopic fission production cross sections: $\\,\\nu\\Sigma_{f1} = 0.020\\,\\text{cm}^{-1}\\,$, $\\,\\nu\\Sigma_{f2} = 0.100\\,\\text{cm}^{-1}\\,$.\n- Fission spectrum fractions: $\\,\\chi_1 = 1.000\\,$, $\\,\\chi_2 = 0.000\\,$.\n- Gadolinia absorption scaling coefficients: $\\,\\alpha = 0.100\\,\\text{cm}^{-1}\\,$, $\\,\\beta = 0.005\\,\\text{cm}^{-1}\\,$.\n\nTest suite of poison loading and leakage cases:\n- Case $1$: $\\,p = 0.000\\,$, $\\,B^2 = 0.000000\\,\\text{cm}^{-2}\\,$.\n- Case $2$: $\\,p = 0.500\\,$, $\\,B^2 = 0.000000\\,\\text{cm}^{-2}\\,$.\n- Case $3$: $\\,p = 0.500\\,$, $\\,B^2 = 0.000500\\,\\text{cm}^{-2}\\,$.\n- Case $4$: $\\,p = 1.000\\,$, $\\,B^2 = 0.001000\\,\\text{cm}^{-2}\\,$.\n- Case $5$: $\\,p = 0.000\\,$, $\\,B^2 = 0.001000\\,\\text{cm}^{-2}\\,$.\n\nRequired final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list of nine floats in the order\n$$\n\\big[k_{\\infty},\\,k_{\\mathrm{eff}},\\,S(0),\\,S(B^2),\\,\\Delta k,\\,f^{(a)}_1,\\,f^{(a)}_2,\\,f^{(f)}_1,\\,f^{(f)}_2\\big],\n$$\nrounded to six decimal places. For example, the final printed line must look like\n$$\n\\texttt{[[0.950000,0.900000,1.200000,1.300000,0.050000,0.400000,0.600000,0.150000,0.850000],[\\dots]]}.\n$$",
            "solution": "The problem is subjected to validation and is found to be valid. It is scientifically grounded in the principles of nuclear reactor physics, specifically two-group neutron diffusion theory. It is well-posed as a generalized eigenvalue problem, with all necessary data and definitions provided to ensure a unique, meaningful solution. The language is objective and the parameters are physically plausible.\n\nThe core of the problem lies in analyzing the steady-state two-group neutron diffusion equations, which can be expressed as a generalized eigenvalue problem. The governing equation is:\n$$\n\\begin{bmatrix}\n\\Sigma_{r1} + D_1 B^2 & -\\Sigma_{s21} \\\\\n-\\Sigma_{s12} & \\Sigma_{r2} + D_2 B^2\n\\end{bmatrix}\n\\begin{bmatrix}\n\\phi_1 \\\\\n\\phi_2\n\\end{bmatrix}\n=\n\\frac{1}{k}\n\\begin{bmatrix}\n\\chi_1 \\nu\\Sigma_{f1} & \\chi_1 \\nu\\Sigma_{f2} \\\\\n\\chi_2 \\nu\\Sigma_{f1} & \\chi_2 \\nu\\Sigma_{f2}\n\\end{bmatrix}\n\\begin{bmatrix}\n\\phi_1 \\\\\n\\phi_2\n\\end{bmatrix}\n$$\nThis equation balances neutron removal (absorption, scattering-out, and leakage) on the left side with neutron production (fission) on the right side. The variable $k$ is the multiplication factor, $\\phi_1$ and $\\phi_2$ are the fast and thermal neutron fluxes, respectively, and $B^2$ is the geometric buckling representing neutron leakage.\n\nLet the removal/leakage matrix be denoted by $M$ and the fission production matrix by $F$. The equation is then $M\\boldsymbol{\\phi} = \\frac{1}{k} F\\boldsymbol{\\phi}$. It is computationally more convenient to rearrange this into the standard form for generalized eigenvalue solvers:\n$$\nF\\boldsymbol{\\phi} = k M\\boldsymbol{\\phi}\n$$\nwhere $\\boldsymbol{\\phi} = [\\phi_1, \\phi_2]^T$ is the flux eigenvector, and $k$ is the eigenvalue. The physically meaningful solution corresponds to the largest, real, positive eigenvalue, known as the dominant eigenvalue, which represents the effective multiplication factor $k_{\\mathrm{eff}}$. The corresponding eigenvector has positive components.\n\nThe matrices $F$ and $M$ are constructed as follows. The fission matrix $F$ is given by:\n$$\nF =\n\\begin{bmatrix}\n\\chi_1 \\nu\\Sigma_{f1} & \\chi_1 \\nu\\Sigma_{f2} \\\\\n\\chi_2 \\nu\\Sigma_{f1} & \\chi_2 \\nu\\Sigma_{f2}\n\\end{bmatrix}\n$$\nUsing the provided parameters $\\chi_1 = 1.0$, $\\chi_2 = 0.0$, $\\nu\\Sigma_{f1} = 0.020\\,\\text{cm}^{-1}$, and $\\nu\\Sigma_{f2} = 0.100\\,\\text{cm}^{-1}$, the fission matrix $F$ is constant for all test cases:\n$$\nF =\n\\begin{bmatrix}\n1.0 \\times 0.020 & 1.0 \\times 0.100 \\\\\n0.0 \\times 0.020 & 0.0 \\times 0.100\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n0.020 & 0.100 \\\\\n0 & 0\n\\end{bmatrix}\n$$\nThe removal/leakage matrix $M$ depends on the burnable poison loading $p$ and the geometric buckling $B^2$:\n$$\nM(p, B^2) =\n\\begin{bmatrix}\n\\Sigma_{r1}(p) + D_1 B^2 & -\\Sigma_{s21} \\\\\n-\\Sigma_{s12} & \\Sigma_{r2}(p) + D_2 B^2\n\\end{bmatrix}\n$$\nThe components of $M$ are determined from the problem's parameters:\n- Absorption cross sections, dependent on poison loading $p$:\n  $$\n  \\Sigma_{a1}(p) = \\Sigma_{a1}^{(0)} + \\beta\\,p = 0.010 + 0.005\\,p\n  $$\n  $$\n  \\Sigma_{a2}(p) = \\Sigma_{a2}^{(0)} + \\alpha\\,p = 0.080 + 0.100\\,p\n  $$\n- Removal cross sections, which include scattering:\n  $$\n  \\Sigma_{r1}(p) = \\Sigma_{a1}(p) + \\Sigma_{s12} = (0.010 + 0.005\\,p) + 0.200 = 0.210 + 0.005\\,p\n  $$\n  $$\n  \\Sigma_{r2}(p) = \\Sigma_{a2}(p) + \\Sigma_{s21} = (0.080 + 0.100\\,p) + 0.005 = 0.085 + 0.100\\,p\n  $$\n- The other fixed parameters are $D_1 = 1.300\\,\\text{cm}$, $D_2 = 0.300\\,\\text{cm}$, $\\Sigma_{s12} = 0.200\\,\\text{cm}^{-1}$, and $\\Sigma_{s21} = 0.005\\,\\text{cm}^{-1}$.\n\nFor each test case, defined by a pair $(p^*, B^{2*})$, the following computational procedure is executed:\n\n1.  **Infinite Medium Calculation**: To find $k_{\\infty}$ and $S(0)$, we analyze the system with the specified poison loading $p^*$ but zero leakage ($B^2 = 0$).\n    -   Construct the matrix $M(p^*, 0)$.\n    -   Solve the generalized eigenvalue problem $F\\boldsymbol{\\phi} = k M(p^*, 0)\\boldsymbol{\\phi}$.\n    -   The largest real eigenvalue is $k_{\\infty}$.\n    -   The corresponding eigenvector $\\boldsymbol{\\phi}_{\\infty} = [\\phi_{1,\\infty}, \\phi_{2,\\infty}]^T$ is used to compute the infinite-medium spectral index $S(0) = \\phi_{1,\\infty} / \\phi_{2,\\infty}$.\n\n2.  **Effective Medium Calculation**: To find $k_{\\mathrm{eff}}$ and $S(B^2)$, we analyze the system with the specified poison loading $p^*$ and leakage $B^{2*}$.\n    -   Construct the matrix $M(p^*, B^{2*})$.\n    -   Solve the generalized eigenvalue problem $F\\boldsymbol{\\phi} = k M(p^*, B^{2*})\\boldsymbol{\\phi}$.\n    -   The largest real eigenvalue is $k_{\\mathrm{eff}}$.\n    -   The corresponding eigenvector $\\boldsymbol{\\phi}_{\\mathrm{eff}} = [\\phi_{1,\\mathrm{eff}}, \\phi_{2,\\mathrm{eff}}]^T$ is used to compute the effective spectral index $S(B^{2*}) = \\phi_{1,\\mathrm{eff}} / \\phi_{2,\\mathrm{eff}}$.\n\n3.  **Difference in Multiplication Factors**: The effect of leakage on reactivity is quantified by $\\Delta k = k_{\\infty} - k_{\\mathrm{eff}}$.\n\n4.  **Reaction Rate Fractions**: The distribution of reactions between the energy groups for the leakage case is calculated using the effective flux eigenvector $\\boldsymbol{\\phi}_{\\mathrm{eff}}$ (or, equivalently, the spectral index $S(B^{2*})$).\n    -   Normalized absorption fractions:\n        $$\n        f^{(a)}_1 = \\frac{\\Sigma_{a1}(p^*)\\,\\phi_{1,\\mathrm{eff}}}{\\Sigma_{a1}(p^*)\\,\\phi_{1,\\mathrm{eff}} + \\Sigma_{a2}(p^*)\\,\\phi_{2,\\mathrm{eff}}} = \\frac{\\Sigma_{a1}(p^*)\\,S(B^{2*})}{\\Sigma_{a1}(p^*)\\,S(B^{2*}) + \\Sigma_{a2}(p^*)}\n        $$\n        $$\n        f^{(a)}_2 = 1 - f^{(a)}_1\n        $$\n    -   Normalized fission fractions:\n        $$\n        f^{(f)}_1 = \\frac{\\nu\\Sigma_{f1}\\,\\phi_{1,\\mathrm{eff}}}{\\nu\\Sigma_{f1}\\,\\phi_{1,\\mathrm{eff}} + \\nu\\Sigma_{f2}\\,\\phi_{2,\\mathrm{eff}}} = \\frac{\\nu\\Sigma_{f1}\\,S(B^{2*})}{\\nu\\Sigma_{f1}\\,S(B^{2*}) + \\nu\\Sigma_{f2}}\n        $$\n        $$\n        f^{(f)}_2 = 1 - f^{(f)}_1\n        $$\nThis procedure is applied to each of the five test cases provided. The numerical solution of the generalized eigenvalue problem is obtained using standard linear algebra libraries. Any negligible imaginary components resulting from floating-point arithmetic are discarded, as the physical quantities (eigenvalues and eigenvectors) are guaranteed to be real for this problem.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eig\n\ndef solve():\n    \"\"\"\n    Solves the two-group neutron diffusion eigenvalue problem for a set of test cases.\n    \"\"\"\n\n    # Define base parameter values from the problem statement.\n    sigma_a1_0 = 0.010\n    sigma_a2_0 = 0.080\n    sigma_s12 = 0.200\n    sigma_s21 = 0.005\n    D1 = 1.300\n    D2 = 0.300\n    nu_sigma_f1 = 0.020\n    nu_sigma_f2 = 0.100\n    chi1 = 1.0\n    chi2 = 0.0\n    alpha = 0.100\n    beta = 0.005\n\n    # Test suite of poison loading and leakage cases.\n    test_cases = [\n        # (p, B^2)\n        (0.000, 0.000000),  # Case 1\n        (0.500, 0.000000),  # Case 2\n        (0.500, 0.000500),  # Case 3\n        (1.000, 0.001000),  # Case 4\n        (0.000, 0.001000),  # Case 5\n    ]\n\n    # Construct the constant Fission matrix F\n    F = np.array([\n        [chi1 * nu_sigma_f1, chi1 * nu_sigma_f2],\n        [chi2 * nu_sigma_f1, chi2 * nu_sigma_f2]\n    ])\n\n    def solve_diffusion_eigenproblem(p, B2):\n        \"\"\"\n        Constructs matrices and solves the generalized eigenvalue problem for a given p and B^2.\n        \n        Args:\n            p (float): Dimensionless poison loading factor.\n            B2 (float): Geometric buckling (cm^-2).\n        \n        Returns:\n            tuple: A tuple containing:\n                - k (float): Dominant eigenvalue (multiplication factor).\n                - S (float): Spectral index (phi_1 / phi_2).\n                - sigma_a1 (float): Group 1 macroscopic absorption cross section.\n                - sigma_a2 (float): Group 2 macroscopic absorption cross section.\n        \"\"\"\n        # Calculate poison-dependent absorption cross sections\n        sigma_a1 = sigma_a1_0 + beta * p\n        sigma_a2 = sigma_a2_0 + alpha * p\n\n        # Calculate removal cross sections\n        sigma_r1 = sigma_a1 + sigma_s12\n        sigma_r2 = sigma_a2 + sigma_s21\n\n        # Construct the Removal/Leakage matrix M\n        M = np.array([\n            [sigma_r1 + D1 * B2, -sigma_s21],\n            [-sigma_s12,        sigma_r2 + D2 * B2]\n        ])\n\n        # Solve the generalized eigenvalue problem: F*phi = k*M*phi\n        eigenvalues, eigenvectors = eig(F, b=M)\n\n        # The physical solution is the largest real eigenvalue and its corresponding eigenvector.\n        # Numerical results might have negligible imaginary parts.\n        eigenvalues = np.real(eigenvalues)\n        eigenvectors = np.real(eigenvectors)\n\n        # Find the index of the dominant (largest) eigenvalue\n        dominant_idx = np.argmax(eigenvalues)\n        \n        k = eigenvalues[dominant_idx]\n        flux_vector = eigenvectors[:, dominant_idx]\n\n        # Ensure flux is positive (a convention)\n        if flux_vector[1] < 0:\n            flux_vector = -flux_vector\n        \n        # Calculate spectral index S = phi_1 / phi_2\n        # Handle potential division by zero if phi_2 is numerically zero, though unlikely here.\n        if abs(flux_vector[1]) < 1e-15:\n            # Physically, thermal flux will not be zero. This is a safeguard.\n            S = np.inf\n        else:\n            S = flux_vector[0] / flux_vector[1]\n\n        return k, S, sigma_a1, sigma_a2\n\n    results = []\n    for p_case, B2_case in test_cases:\n        # 1. Calculate for infinite medium (k_inf, S_0)\n        k_inf, S_0, _, _ = solve_diffusion_eigenproblem(p=p_case, B2=0.0)\n\n        # 2. Calculate for effective medium (k_eff, S_B2)\n        k_eff, S_B2, sigma_a1_eff, sigma_a2_eff = solve_diffusion_eigenproblem(p=p_case, B2=B2_case)\n        \n        # 3. Calculate delta_k\n        delta_k = k_inf - k_eff\n        \n        # 4. Calculate reaction rate fractions for the leakage case\n        # Note: Denominators are never zero if fluxes are positive.\n        # The calculation can be done using the spectral index S_B2.\n        \n        # Absorption fractions\n        num_fa1 = sigma_a1_eff * S_B2\n        den_fa = num_fa1 + sigma_a2_eff\n        f_a1 = num_fa1 / den_fa if den_fa != 0 else 0\n        f_a2 = 1.0 - f_a1\n\n        # Fission fractions\n        num_ff1 = nu_sigma_f1 * S_B2\n        den_ff = num_ff1 + nu_sigma_f2\n        f_f1 = num_ff1 / den_ff if den_ff != 0 else 0\n        f_f2 = 1.0 - f_f1\n\n        # Assemble the 9-tuple result for the current case\n        case_result = [\n            k_inf, k_eff, S_0, S_B2, delta_k,\n            f_a1, f_a2, f_f1, f_f2\n        ]\n        results.append(case_result)\n\n    # Format the final output string\n    output_str = \"[\"\n    for i, case_res in enumerate(results):\n        formatted_res = [f\"{val:.6f}\" for val in case_res]\n        output_str += f\"[{','.join(formatted_res)}]\"\n        if i < len(results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n        \n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Moving from fundamental physics to practical engineering, the placement of burnable poison (BP) pins within a fuel assembly is a critical design decision. This practice delves into the trade-off between suppressing excess reactivity and controlling local power peaks to maintain safety margins. Using a first-order 'frozen flux' approximation, you will calculate how relocating BP pins from the assembly interior to the corners impacts both the infinite multiplication factor ($k_{\\infty}$) and the pin power peaking factor ($PF$) .",
            "id": "4219374",
            "problem": "You are given a simplified, but scientifically faithful, two-group infinite-lattice model of a square fuel assembly in a nuclear reactor core. The goal is to quantify how moving two Burnable Poison (BP) pins from interior positions to corner positions changes the assembly infinite multiplication factor and the pin power peaking factor, using lattice-calculated macroscopic constants and provided flux maps. You must implement a program that computes these changes for a specified test suite of cases and prints a single aggregated output line.\n\nThe fundamental base is the stationary neutron balance in an infinite medium, represented in a two-energy-group approximation. Let the square assembly have a grid of $N \\times N$ pins indexed by integer coordinates $(i,j)$ with $i,j \\in \\{0,1,\\dots,N-1\\}$. For each pin $(i,j)$, and each energy group $g \\in \\{1,2\\}$, let the scalar flux be denoted by $\\phi_g(i,j)$, and let the macroscopic absorption and production parameters of the assigned pin material $m(i,j)$ be denoted by $\\Sigma_{a,g}(m)$ and $\\nu\\Sigma_{f,g}(m)$, respectively. All macroscopic cross-sections are in $\\text{cm}^{-1}$.\n\nWe define the infinite multiplication factor, $k_{\\infty}$, from first principles as the ratio of total neutron production rate to total absorption rate in the infinite medium:\n$$\nk_{\\infty} \\equiv \\frac{\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\sum_{g=1}^{2} \\nu\\Sigma_{f,g}(m(i,j)) \\, \\phi_g(i,j)}{\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\sum_{g=1}^{2} \\Sigma_{a,g}(m(i,j)) \\, \\phi_g(i,j)}.\n$$\nWe consider a “frozen flux” approximation for small reconfigurations: the flux maps $\\{\\phi_g(i,j)\\}$ are taken from a reference lattice calculation of the baseline configuration (with the BP pins at interior positions), and are reused as weights when evaluating reaction-rate changes under the pin move. This corresponds to a first-order computation consistent with perturbative reasoning when the material perturbation is modest and leakage is negligible.\n\nFor pin power peaking, we adopt the standard lattice proxy that pin power is proportional to the fission source density, which is proportional to $\\sum_{g=1}^{2} \\nu\\Sigma_{f,g}(m(i,j)) \\, \\phi_g(i,j)$. The assembly pin power peaking factor, $PF$, is then defined by\n$$\nPF \\equiv \\frac{\\max_{i,j} \\left( \\sum_{g=1}^{2} \\nu\\Sigma_{f,g}(m(i,j)) \\, \\phi_g(i,j) \\right)}{\\frac{1}{N^2} \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\left( \\sum_{g=1}^{2} \\nu\\Sigma_{f,g}(m(i,j)) \\, \\phi_g(i,j) \\right)}.\n$$\n\nYour program must:\n- Construct the baseline material map $m_{\\mathrm{base}}(i,j)$ with two BP pins at specified interior coordinates and all other pins as fuel.\n- Construct the moved material map $m_{\\mathrm{moved}}(i,j)$ by moving those two BP pins to specified corner coordinates, converting the interior locations to fuel.\n- Generate two-group flux maps $\\phi_1(i,j)$ and $\\phi_2(i,j)$ using the provided parametric form that mimics lattice-calculated flux shapes, and normalize each group so that $\\sum_{i,j}\\phi_g(i,j)=1$ for $g \\in \\{1,2\\}$.\n- Compute $k_{\\infty}$ for baseline and moved maps under the frozen-flux approximation and report $\\Delta k_{\\infty} \\equiv k_{\\infty}^{\\mathrm{moved}} - k_{\\infty}^{\\mathrm{base}}$.\n- Compute $PF$ for baseline and moved maps and report $\\Delta PF \\equiv PF^{\\mathrm{moved}} - PF^{\\mathrm{base}}$.\n\nFlux map generation: For each group $g$, let $\\gamma_g$ be a nonnegative shape parameter. For pin $(i,j)$, define the squared radial index relative to the assembly center as\n$$\nr^2(i,j) \\equiv \\left(i - \\frac{N-1}{2}\\right)^2 + \\left(j - \\frac{N-1}{2}\\right)^2.\n$$\nDefine the raw flux by\n$$\n\\phi^{\\mathrm{raw}}_g(i,j) \\equiv \\max\\!\\left(\\varepsilon, \\, 1 - \\gamma_g \\, r^2(i,j)\\right),\n$$\nwith $\\varepsilon = 10^{-8}$, and normalize to obtain $\\phi_g(i,j) \\equiv \\phi^{\\mathrm{raw}}_g(i,j) \\big/ \\left( \\sum_{p,q} \\phi^{\\mathrm{raw}}_g(p,q)\\right)$, ensuring $\\sum_{i,j}\\phi_g(i,j)=1$ for each group.\n\nMaterials: Fuel pins have macroscopic parameters $\\Sigma_{a,1}(\\mathrm{fuel})$, $\\Sigma_{a,2}(\\mathrm{fuel})$, $\\nu\\Sigma_{f,1}(\\mathrm{fuel})$, and $\\nu\\Sigma_{f,2}(\\mathrm{fuel})$. Burnable Poison (BP) pins have $\\Sigma_{a,1}(\\mathrm{BP})$, $\\Sigma_{a,2}(\\mathrm{BP})$, and $\\nu\\Sigma_{f,g}(\\mathrm{BP}) = 0$ for $g \\in \\{1,2\\}$ to represent the non-fissile absorber.\n\nTest suite and parameters:\n- Case $1$ (happy path):\n  - $N = 5$.\n  - Interior BP pins at $(2,2)$ and $(2,3)$; moved to corners $(0,0)$ and $(0,4)$.\n  - Flux shape parameters: $\\gamma_1 = \\beta = 0.02$, $\\gamma_2 = \\alpha = 0.06$.\n  - Fuel: $\\Sigma_{a,1}(\\mathrm{fuel}) = 0.02$, $\\Sigma_{a,2}(\\mathrm{fuel}) = 0.08$, $\\nu\\Sigma_{f,1}(\\mathrm{fuel}) = 0.005$, $\\nu\\Sigma_{f,2}(\\mathrm{fuel}) = 0.12$.\n  - BP: $\\Sigma_{a,1}(\\mathrm{BP}) = 0.03$, $\\Sigma_{a,2}(\\mathrm{BP}) = 0.20$, $\\nu\\Sigma_{f,1}(\\mathrm{BP}) = 0.0$, $\\nu\\Sigma_{f,2}(\\mathrm{BP}) = 0.0$.\n- Case $2$ (boundary condition: uniform flux):\n  - $N = 5$.\n  - Interior BP pins at $(2,2)$ and $(1,3)$; moved to corners $(0,0)$ and $(4,4)$.\n  - Flux shape parameters: $\\gamma_1 = \\beta = 0.0$, $\\gamma_2 = \\alpha = 0.0$.\n  - Fuel and BP macroscopic parameters identical to Case $1$.\n- Case $3$ (stronger thermal absorption in BP, larger assembly):\n  - $N = 7$.\n  - Interior BP pins at $(3,3)$ and $(3,4)$; moved to corners $(0,6)$ and $(6,0)$.\n  - Flux shape parameters: $\\gamma_1 = \\beta = 0.01$, $\\gamma_2 = \\alpha = 0.04$.\n  - Fuel: $\\Sigma_{a,1}(\\mathrm{fuel}) = 0.025$, $\\Sigma_{a,2}(\\mathrm{fuel}) = 0.09$, $\\nu\\Sigma_{f,1}(\\mathrm{fuel}) = 0.004$, $\\nu\\Sigma_{f,2}(\\mathrm{fuel}) = 0.11$.\n  - BP: $\\Sigma_{a,1}(\\mathrm{BP}) = 0.035$, $\\Sigma_{a,2}(\\mathrm{BP}) = 0.30$, $\\nu\\Sigma_{f,1}(\\mathrm{BP}) = 0.0$, $\\nu\\Sigma_{f,2}(\\mathrm{BP}) = 0.0$.\n\nComputational requirements:\n- Use the provided parametric flux model and normalize each group’s flux to satisfy $\\sum_{i,j}\\phi_g(i,j)=1$ for $g \\in \\{1,2\\}$.\n- Compute $k_{\\infty}$ and $PF$ for baseline and moved configurations as defined above.\n- Report $\\Delta k_{\\infty}$ and $\\Delta PF$ for each case. Both quantities are dimensionless and must be expressed as decimals.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[\\Delta k_{\\infty}^{(1)}, \\Delta PF^{(1)}, \\Delta k_{\\infty}^{(2)}, \\Delta PF^{(2)}, \\Delta k_{\\infty}^{(3)}, \\Delta PF^{(3)}]$, where the superscript indicates the case number. No additional text should be printed.",
            "solution": "The problem requires the quantification of changes in the infinite multiplication factor, $k_{\\infty}$, and the pin power peaking factor, $PF$, in a simplified two-group nuclear fuel assembly model. These changes result from relocating two Burnable Poison (BP) pins from interior positions to corner positions. The analysis is performed under a \"frozen flux\" approximation, a standard perturbative approach where the neutron flux distribution is assumed to remain unchanged by the material perturbation.\n\nThe solution is implemented by following a structured, step-by-step computational procedure for each test case provided.\n\n### 1. Flux Map Generation\n\nThe neutron flux distribution within the assembly is modeled for two energy groups, a fast group ($g=1$) and a thermal group ($g=2$). For an $N \\times N$ assembly grid with pin coordinates $(i,j)$ for $i,j \\in \\{0, 1, \\dots, N-1\\}$, the flux shape is parametrically defined.\n\nFirst, the squared radial distance of each pin from the geometric center of the assembly is calculated. The center is located at coordinates $(\\frac{N-1}{2}, \\frac{N-1}{2})$. The squared radial index is:\n$$\nr^2(i,j) = \\left(i - \\frac{N-1}{2}\\right)^2 + \\left(j - \\frac{N-1}{2}\\right)^2\n$$\nNext, a raw (un-normalized) flux map for each group $g$ is generated using a parabolic depression model controlled by a shape parameter $\\gamma_g$:\n$$\n\\phi^{\\mathrm{raw}}_g(i,j) = \\max\\!\\left(\\varepsilon, \\, 1 - \\gamma_g \\, r^2(i,j)\\right)\n$$\nwhere $\\varepsilon = 10^{-8}$ is a small positive constant to ensure the flux is strictly positive. This shape reflects the self-shielding effect where flux is typically lower in the center of a fuel assembly. A value of $\\gamma_g = 0$ results in a spatially uniform flux.\n\nFinally, each raw flux map is normalized such that the sum of all pin fluxes in a group equals one. This is crucial for their use as weighting functions in reaction rate calculations. The normalized flux $\\phi_g(i,j)$ is:\n$$\n\\phi_g(i,j) = \\frac{\\phi^{\\mathrm{raw}}_g(i,j)}{\\sum_{p=0}^{N-1}\\sum_{q=0}^{N-1} \\phi^{\\mathrm{raw}}_g(p,q)}\n$$\nThis process yields two $N \\times N$ matrices, $\\phi_1$ and $\\phi_2$, representing the normalized fast and thermal flux distributions. Crucially, under the frozen flux approximation, these flux maps, calculated based on the baseline configuration's parameters, are used for calculations of both the baseline and the moved configurations.\n\n### 2. Material and Cross-Section Mapping\n\nTwo material configurations are considered: a 'baseline' and a 'moved' configuration. In the baseline, two BP pins are at specified interior locations, with all other pins being fuel. In the moved configuration, these BP pins are relocated to corner positions, and their former interior positions are filled with fuel.\n\nFor each configuration, we construct $N \\times N$ maps for all relevant macroscopic cross-sections: $\\Sigma_{a,1}(\\mathbf{r})$, $\\Sigma_{a,2}(\\mathbf{r})$, $\\nu\\Sigma_{f,1}(\\mathbf{r})$, and $\\nu\\Sigma_{f,2}(\\mathbf{r})$, where $\\mathbf{r}$ denotes the pin location $(i,j)$. Each element $(i,j)$ of a cross-section map is assigned the value corresponding to the material (fuel or BP) at that location. For instance, the map for the group $1$ absorption cross-section, $\\Sigma_{a,1}(\\mathbf{r})$, will contain $\\Sigma_{a,1}(\\mathrm{fuel})$ at fuel pin locations and $\\Sigma_{a,1}(\\mathrm{BP})$ at BP pin locations.\n\n### 3. Calculation of Infinite Multiplication Factor ($k_{\\infty}$)\n\nThe infinite multiplication factor, $k_{\\infty}$, is the ratio of the total rate of neutron production to the total rate of neutron absorption across the entire assembly. Using the generated flux and cross-section maps, these rates are calculated as sums over all pins and both energy groups.\n\nThe total production rate, $P$, is:\n$$\nP = \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} \\left( \\nu\\Sigma_{f,1}(i,j) \\, \\phi_1(i,j) + \\nu\\Sigma_{f,2}(i,j) \\, \\phi_2(i,j) \\right)\n$$\nThe total absorption rate, $A$, is:\n$$\nA = \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} \\left( \\Sigma_{a,1}(i,j) \\, \\phi_1(i,j) + \\Sigma_{a,2}(i,j) \\, \\phi_2(i,j) \\right)\n$$\nFrom these, we compute $k_{\\infty}$:\n$$\nk_{\\infty} = \\frac{P}{A}\n$$\nThis calculation is performed for both the baseline configuration ($k_{\\infty}^{\\mathrm{base}}$) and the moved configuration ($k_{\\infty}^{\\mathrm{moved}}$), using the respective cross-section maps but the same frozen flux maps.\n\n### 4. Calculation of Pin Power Peaking Factor ($PF$)\n\nThe pin power peaking factor, $PF$, measures the power of the most-loaded pin relative to the average pin power. In this model, pin power is proportional to the fission source density, $S(i,j)$.\n\nFirst, we compute the pin-wise fission source density map:\n$$\nS(i,j) = \\nu\\Sigma_{f,1}(i,j) \\, \\phi_1(i,j) + \\nu\\Sigma_{f,2}(i,j) \\, \\phi_2(i,j)\n$$\nThe maximum pin power is the maximum value in this map:\n$$\nS_{\\max} = \\max_{i,j} S(i,j)\n$$\nThe average pin power is the total production rate $P$ divided by the number of pins, $N^2$:\n$$\nS_{\\mathrm{avg}} = \\frac{1}{N^2} \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} S(i,j) = \\frac{P}{N^2}\n$$\nThe pin power peaking factor is the ratio of the maximum to the average:\n$$\nPF = \\frac{S_{\\max}}{S_{\\mathrm{avg}}}\n$$\nSimilar to $k_{\\infty}$, $PF^{\\mathrm{base}}$ and $PF^{\\mathrm{moved}}$ are calculated for the two configurations.\n\n### 5. Final Output Calculation\n\nThe final required outputs are the differences in these parameters between the moved and baseline configurations:\n$$\n\\Delta k_{\\infty} = k_{\\infty}^{\\mathrm{moved}} - k_{\\infty}^{\\mathrm{base}}\n$$\n$$\n\\Delta PF = PF^{\\mathrm{moved}} - PF^{\\mathrm{base}}\n$$\nThis entire procedure is repeated for each of the three test cases specified, and the resulting six values are aggregated into the final output format.\nMoving a strongly absorbing, non-fissile BP pin from a high-flux interior region to a lower-flux corner region is expected to increase reactivity (positive $\\Delta k_{\\infty}$) because less absorption occurs in the region of highest neutron importance. This move also tends to flatten the power distribution, as high-power central pins are replaced by fuel, but the change in $PF$ can be complex, depending on the flux shape and the specific locations involved.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the nuclear fuel assembly problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path)\n        {\n            \"N\": 5,\n            \"bp_base_locs\": [(2, 2), (2, 3)],\n            \"bp_moved_locs\": [(0, 0), (0, 4)],\n            \"gamma1\": 0.02, \"gamma2\": 0.06,\n            \"fuel_props\": {\"Sa1\": 0.02, \"Sa2\": 0.08, \"nuSf1\": 0.005, \"nuSf2\": 0.12},\n            \"bp_props\": {\"Sa1\": 0.03, \"Sa2\": 0.20, \"nuSf1\": 0.0, \"nuSf2\": 0.0},\n        },\n        # Case 2 (boundary condition: uniform flux)\n        {\n            \"N\": 5,\n            \"bp_base_locs\": [(2, 2), (1, 3)],\n            \"bp_moved_locs\": [(0, 0), (4, 4)],\n            \"gamma1\": 0.0, \"gamma2\": 0.0,\n            \"fuel_props\": {\"Sa1\": 0.02, \"Sa2\": 0.08, \"nuSf1\": 0.005, \"nuSf2\": 0.12},\n            \"bp_props\": {\"Sa1\": 0.03, \"Sa2\": 0.20, \"nuSf1\": 0.0, \"nuSf2\": 0.0},\n        },\n        # Case 3 (stronger thermal absorption in BP, larger assembly)\n        {\n            \"N\": 7,\n            \"bp_base_locs\": [(3, 3), (3, 4)],\n            \"bp_moved_locs\": [(0, 6), (6, 0)],\n            \"gamma1\": 0.01, \"gamma2\": 0.04,\n            \"fuel_props\": {\"Sa1\": 0.025, \"Sa2\": 0.09, \"nuSf1\": 0.004, \"nuSf2\": 0.11},\n            \"bp_props\": {\"Sa1\": 0.035, \"Sa2\": 0.30, \"nuSf1\": 0.0, \"nuSf2\": 0.0},\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        \n        # Step 1: Generate frozen flux maps based on baseline parameters\n        phi1_map, phi2_map = generate_flux_maps(N, case[\"gamma1\"], case[\"gamma2\"])\n\n        # Step 2: Calculate metrics for baseline configuration\n        k_inf_base, pf_base = calculate_metrics(\n            N, case[\"bp_base_locs\"], phi1_map, phi2_map, case[\"fuel_props\"], case[\"bp_props\"]\n        )\n\n        # Step 3: Calculate metrics for moved configuration\n        k_inf_moved, pf_moved = calculate_metrics(\n            N, case[\"bp_moved_locs\"], phi1_map, phi2_map, case[\"fuel_props\"], case[\"bp_props\"]\n        )\n\n        # Step 4: Compute the deltas\n        delta_k_inf = k_inf_moved - k_inf_base\n        delta_pf = pf_moved - pf_base\n\n        results.extend([delta_k_inf, delta_pf])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\n\ndef generate_flux_maps(N, gamma1, gamma2):\n    \"\"\"\n    Generates normalized two-group flux maps based on a parametric model.\n    \"\"\"\n    epsilon = 1e-8\n    indices = np.arange(N)\n    i, j = np.meshgrid(indices, indices, indexing='ij')\n\n    center = (N - 1) / 2.0\n    r_squared = (i - center)**2 + (j - center)**2\n\n    phi_raw_1 = np.maximum(epsilon, 1 - gamma1 * r_squared)\n    phi_raw_2 = np.maximum(epsilon, 1 - gamma2 * r_squared)\n\n    phi1_map = phi_raw_1 / np.sum(phi_raw_1)\n    phi2_map = phi_raw_2 / np.sum(phi_raw_2)\n\n    return phi1_map, phi2_map\n\n\ndef calculate_metrics(N, bp_locs, phi1_map, phi2_map, fuel_props, bp_props):\n    \"\"\"\n    Calculates k_inf and PF for a given material configuration and flux maps.\n    \"\"\"\n    # Create material map: 0 for fuel, 1 for BP\n    material_map = np.zeros((N, N), dtype=int)\n    for r, c in bp_locs:\n        material_map[r, c] = 1\n\n    # Create full cross-section maps using advanced indexing\n    Sa1_map = np.array([fuel_props[\"Sa1\"], bp_props[\"Sa1\"]])[material_map]\n    Sa2_map = np.array([fuel_props[\"Sa2\"], bp_props[\"Sa2\"]])[material_map]\n    nuSf1_map = np.array([fuel_props[\"nuSf1\"], bp_props[\"nuSf1\"]])[material_map]\n    nuSf2_map = np.array([fuel_props[\"nuSf2\"], bp_props[\"nuSf2\"]])[material_map]\n\n    # Calculate total production and absorption rates\n    total_production = np.sum(nuSf1_map * phi1_map + nuSf2_map * phi2_map)\n    total_absorption = np.sum(Sa1_map * phi1_map + Sa2_map * phi2_map)\n\n    # Calculate k_inf\n    k_inf = total_production / total_absorption if total_absorption != 0 else 0.0\n    \n    # Calculate pin power peaking factor (PF)\n    # Pin power is proportional to fission source density\n    pin_power_map = nuSf1_map * phi1_map + nuSf2_map * phi2_map\n    \n    if total_production > 0:\n        max_pin_power = np.max(pin_power_map)\n        avg_pin_power = total_production / (N * N)\n        pf = max_pin_power / avg_pin_power\n    else: # Should not happen with fuel in the assembly\n        pf = 1.0\n\n    return k_inf, pf\n\nsolve()\n```"
        },
        {
            "introduction": "Efficiently optimizing an entire core loading pattern requires tools that can predict the impact of changes without running thousands of full-core simulations. This advanced practice introduces one such tool: the adjoint flux, which represents the 'importance' of a neutron to sustaining the chain reaction. You will solve the adjoint diffusion equation and use the resulting adjoint flux to perform a first-order sensitivity analysis, quantifying how $k_{\\mathrm{eff}}$ changes in response to adjustments in poison concentration .",
            "id": "4219387",
            "problem": "You are tasked with computing the adjoint neutron flux to evaluate the first-order sensitivity of the effective multiplication factor $k_{\\mathrm{eff}}$ to changes in burnable poison density in a one-dimensional coarse-mesh diffusion model of a nuclear reactor core. The reactor core is represented as a uniform grid of $N$ nodes with spacing $h$ in $\\text{cm}$ and reflective boundary conditions. The physical model is the steady-state, one-group neutron diffusion approximation, discretized using finite differences with interface diffusion coefficients.\n\nBegin from the following fundamental base:\n\n- The steady-state one-group neutron balance in diffusion approximation can be represented by a generalized eigenvalue problem on the discretized mesh,\n$$\nL(\\boldsymbol{\\theta}) \\, \\boldsymbol{\\phi} = \\lambda \\, M(\\boldsymbol{\\theta}) \\, \\boldsymbol{\\phi},\n$$\nwhere $L$ is the loss operator containing neutron diffusion and absorption, $M$ is the production operator containing neutron generation by fission, $\\boldsymbol{\\phi}$ is the neutron flux vector, $\\lambda$ is the generalized eigenvalue equal to $1/k_{\\mathrm{eff}}$, and $\\boldsymbol{\\theta}$ are material parameters. Reflective boundary conditions are imposed.\n\n- The adjoint eigenproblem is\n$$\nL(\\boldsymbol{\\theta})^{\\mathsf{T}} \\, \\boldsymbol{\\phi}^{\\ast} = \\lambda \\, M(\\boldsymbol{\\theta})^{\\mathsf{T}} \\, \\boldsymbol{\\phi}^{\\ast},\n$$\nwhere $\\boldsymbol{\\phi}^{\\ast}$ is the adjoint flux and ${}^{\\mathsf{T}}$ denotes the transpose.\n\n- The burnable poison density parameter $p$ enters linearly in the macroscopic absorption cross section via\n$$\n\\Sigma_{a,i}(p) = \\Sigma_{a,i}^{\\mathrm{base}} + p \\, \\Sigma_{p,i},\n$$\nwhere $\\Sigma_{a,i}^{\\mathrm{base}}$ is the base absorption in node $i$ and $\\Sigma_{p,i}$ is the poison macroscopic absorption cross section contribution in node $i$. All cross sections are in $\\text{cm}^{-1}$, and the diffusion coefficient $D_i$ is in $\\text{cm}$. The fission production cross section is $\\nu \\Sigma_{f,i}$ in $\\text{cm}^{-1}$. The mesh spacing is $h$ in $\\text{cm}$.\n\n- The discrete loss operator $L$ is built using harmonic-mean interface diffusion coefficients $D_{i+\\frac{1}{2}}$ and reflective boundaries, with entries\n$$\nL_{i,i} = \\frac{D_{i-\\frac{1}{2}} + D_{i+\\frac{1}{2}}}{h^2} + \\Sigma_{a,i}(p), \\quad\nL_{i,i-1} = -\\frac{D_{i-\\frac{1}{2}}}{h^2}, \\quad\nL_{i,i+1} = -\\frac{D_{i+\\frac{1}{2}}}{h^2},\n$$\nwhere $D_{-\\frac{1}{2}} = 0$ and $D_{N-\\frac{1}{2}} = 0$ enforce reflective boundaries, and $D_{i+\\frac{1}{2}} = \\dfrac{2}{\\frac{1}{D_i} + \\frac{1}{D_{i+1}}}$ for $i = 0, \\dots, N-2$. The production operator $M$ is diagonal with $M_{i,i} = \\nu \\Sigma_{f,i}$.\n\nYour program must:\n\n- Construct $L$ and $M$ for each test case at a baseline poison density $p_0$.\n- Solve the forward generalized eigenproblem for the smallest positive real eigenvalue $\\lambda$ and the associated right eigenvector $\\boldsymbol{\\phi}$, and compute $k_{\\mathrm{eff}} = 1/\\lambda$.\n- Solve the adjoint generalized eigenproblem to obtain $\\boldsymbol{\\phi}^{\\ast}$ for the same $\\lambda$.\n- Using first principles, derive and implement the first-order sensitivity of $k_{\\mathrm{eff}}$ to $p$, expressed in terms of the adjoint and forward solutions and the operator derivative $\\frac{\\partial L}{\\partial p}$ evaluated at $p_0$. Treat $p$ as dimensionless. Do not assume any pre-normalization of $\\boldsymbol{\\phi}$ or $\\boldsymbol{\\phi}^{\\ast}$; any required inner products must be computed explicitly.\n- Predict the change $\\Delta k_{\\mathrm{eff}}$ for a small perturbation $\\delta p$ using the first-order sensitivity.\n- Validate the prediction by directly recomputing $k_{\\mathrm{eff}}$ at $p_1 = p_0 + \\delta p$ and taking the difference with the baseline.\n\nPhysical and numerical units:\n- Use $\\text{cm}$ for $h$ and $D_i$, and $\\text{cm}^{-1}$ for all cross sections. The effective multiplication factor $k_{\\mathrm{eff}}$ and its changes are dimensionless. Express all final outputs as decimal floats (dimensionless).\n\nTest suite:\nImplement the following three test cases. For each case, the final result must be the absolute error between the adjoint-based first-order prediction $\\Delta k_{\\mathrm{eff}}^{\\mathrm{pred}}$ and the directly computed change $\\Delta k_{\\mathrm{eff}}^{\\mathrm{dir}}$.\n\n- Case $1$ (happy path, interior poison):\n  - $N = 12$, $h = 15$ $\\text{cm}$.\n  - $D_i = 1.2$ $\\text{cm}$ for all $i$.\n  - $\\Sigma_{a,i}^{\\mathrm{base}} = 0.006$ $\\text{cm}^{-1}$ for all $i$.\n  - $\\nu \\Sigma_{f,i} = 0.045$ $\\text{cm}^{-1}$ for all $i$.\n  - $\\Sigma_{p,i} = 0$ $\\text{cm}^{-1}$ for all $i$ except $i \\in \\{5,6\\}$ where $\\Sigma_{p,i} = 0.020$ $\\text{cm}^{-1}$.\n  - $p_0 = 0.8$, $\\delta p = 0.01$.\n\n- Case $2$ (boundary condition and zero poison derivative edge case):\n  - $N = 8$, $h = 20$ $\\text{cm}$.\n  - $D_i = 1.4$ $\\text{cm}$ for all $i$.\n  - $\\Sigma_{a,i}^{\\mathrm{base}} = 0.006$ $\\text{cm}^{-1}$ for all $i$.\n  - $\\nu \\Sigma_{f,i} = 0.050$ $\\text{cm}^{-1}$ for all $i$.\n  - $\\Sigma_{p,i} = 0$ $\\text{cm}^{-1}$ for all $i$.\n  - $p_0 = 1.0$, $\\delta p = 0.05$.\n\n- Case $3$ (heterogeneous diffusion, poison at boundaries, negative perturbation):\n  - $N = 10$, $h = 12$ $\\text{cm}$.\n  - $D_i = 1.0 + 0.6 \\frac{i}{N-1}$ $\\text{cm}$ for $i = 0, \\dots, N-1$.\n  - $\\Sigma_{a,i}^{\\mathrm{base}} = 0.005$ $\\text{cm}^{-1}$ for all $i$.\n  - $\\nu \\Sigma_{f,i} = 0.040$ $\\text{cm}^{-1}$ for all $i$.\n  - $\\Sigma_{p,i} = 0$ $\\text{cm}^{-1}$ for all $i$ except $i \\in \\{0,9\\}$ where $\\Sigma_{p,i} = 0.030$ $\\text{cm}^{-1}$.\n  - $p_0 = 0.5$, $\\delta p = -0.02$.\n\nFinal output format:\nYour program should produce a single line of output containing the three absolute errors as a comma-separated list of decimal floats enclosed in square brackets, for example, $[e_1,e_2,e_3]$, where $e_j = \\left|\\Delta k_{\\mathrm{eff},j}^{\\mathrm{pred}} - \\Delta k_{\\mathrm{eff},j}^{\\mathrm{dir}}\\right|$ for case $j$. There must be no additional text in the output.",
            "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in established reactor physics principles, is mathematically well-posed, and all necessary parameters and definitions are provided for a unique and meaningful solution. No contradictions, ambiguities, or factual unsoundness were found.\n\nThe core of the problem is to compute the first-order sensitivity of the effective multiplication factor, $k_{\\mathrm{eff}}$, with respect to a change in the burnable poison density, $p$. This requires the derivation of the sensitivity coefficient using first-order perturbation theory, which relies on the forward and adjoint neutron flux.\n\nFirst, we formally derive the sensitivity expression. The system is described by the one-group, steady-state neutron diffusion equation, discretized as a generalized eigenvalue problem:\n$$\nL(p) \\, \\boldsymbol{\\phi}(p) = \\lambda(p) \\, M \\, \\boldsymbol{\\phi}(p)\n$$\nwhere $\\boldsymbol{\\phi}$ is the vector of neutron fluxes at each spatial node, $L$ is the neutron loss operator (diffusion and absorption), $M$ is the neutron production operator (fission), $\\lambda = 1/k_{\\mathrm{eff}}$ is the eigenvalue, and $p$ is the poison density parameter. Notably, $M$ does not depend on $p$.\n\nThe corresponding adjoint eigenproblem is given by:\n$$\nL(p)^{\\mathsf{T}} \\, \\boldsymbol{\\phi}^{\\ast}(p) = \\lambda(p) \\, M^{\\mathsf{T}} \\, \\boldsymbol{\\phi}^{\\ast}(p)\n$$\nwhere $\\boldsymbol{\\phi}^{\\ast}$ is the adjoint flux vector. In this problem, the discretized operator $L$ and the production operator $M$ (which is diagonal) are both real and symmetric, so $L^{\\mathsf{T}} = L$ and $M^{\\mathsf{T}} = M$. Consequently, the forward and adjoint problems are identical, and their eigenvectors $\\boldsymbol{\\phi}$ and $\\boldsymbol{\\phi}^{\\ast}$ are the same.\n\nTo find the sensitivity, we differentiate the forward eigenvalue equation with respect to $p$:\n$$\n\\frac{\\partial L}{\\partial p} \\boldsymbol{\\phi} + L \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} = \\frac{\\partial \\lambda}{\\partial p} M \\boldsymbol{\\phi} + \\lambda M \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p}\n$$\nWe then take the inner product of this equation with the adjoint flux $\\boldsymbol{\\phi}^{\\ast}$, where the inner product is defined as $\\langle \\mathbf{y}, \\mathbf{x} \\rangle = \\mathbf{y}^{\\mathsf{T}}\\mathbf{x}$.\n$$\n\\langle \\boldsymbol{\\phi}^{\\ast}, \\frac{\\partial L}{\\partial p} \\boldsymbol{\\phi} \\rangle + \\langle \\boldsymbol{\\phi}^{\\ast}, L \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle = \\frac{\\partial \\lambda}{\\partial p} \\langle \\boldsymbol{\\phi}^{\\ast}, M \\boldsymbol{\\phi} \\rangle + \\lambda \\langle \\boldsymbol{\\phi}^{\\ast}, M \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle\n$$\nBy the definition of the adjoint operator, $\\langle \\boldsymbol{\\phi}^{\\ast}, L \\mathbf{v} \\rangle = \\langle L^{\\mathsf{T}} \\boldsymbol{\\phi}^{\\ast}, \\mathbf{v} \\rangle$. Using this property and the adjoint equation $L^{\\mathsf{T}}\\boldsymbol{\\phi}^{\\ast} = \\lambda M^{\\mathsf{T}}\\boldsymbol{\\phi}^{\\ast}$, we can rewrite the second term on the left-hand side:\n$$\n\\langle \\boldsymbol{\\phi}^{\\ast}, L \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle = \\langle L^{\\mathsf{T}} \\boldsymbol{\\phi}^{\\ast}, \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle = \\langle \\lambda M^{\\mathsf{T}} \\boldsymbol{\\phi}^{\\ast}, \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle = \\lambda \\langle \\boldsymbol{\\phi}^{\\ast}, M \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle\n$$\nThe last step holds because $M$ is symmetric ($M^{\\mathsf{T}} = M$). Substituting this back, we find that the terms involving the derivative of the flux, $\\frac{\\partial \\boldsymbol{\\phi}}{\\partial p}$, cancel out:\n$$\n\\langle \\boldsymbol{\\phi}^{\\ast}, \\frac{\\partial L}{\\partial p} \\boldsymbol{\\phi} \\rangle + \\lambda \\langle \\boldsymbol{\\phi}^{\\ast}, M \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle = \\frac{\\partial \\lambda}{\\partial p} \\langle \\boldsymbol{\\phi}^{\\ast}, M \\boldsymbol{\\phi} \\rangle + \\lambda \\langle \\boldsymbol{\\phi}^{\\ast}, M \\frac{\\partial \\boldsymbol{\\phi}}{\\partial p} \\rangle\n$$\n$$\n\\implies \\langle \\boldsymbol{\\phi}^{\\ast}, \\frac{\\partial L}{\\partial p} \\boldsymbol{\\phi} \\rangle = \\frac{\\partial \\lambda}{\\partial p} \\langle \\boldsymbol{\\phi}^{\\ast}, M \\boldsymbol{\\phi} \\rangle\n$$\nSolving for $\\frac{\\partial \\lambda}{\\partial p}$ gives the sensitivity of the eigenvalue:\n$$\n\\frac{\\partial \\lambda}{\\partial p} = \\frac{\\langle \\boldsymbol{\\phi}^{\\ast}, \\frac{\\partial L}{\\partial p} \\boldsymbol{\\phi} \\rangle}{\\langle \\boldsymbol{\\phi}^{\\ast}, M \\boldsymbol{\\phi} \\rangle}\n$$\nThe problem asks for the sensitivity of $k_{\\mathrm{eff}} = 1/\\lambda$. Using the chain rule, $\\frac{\\partial \\lambda}{\\partial p} = -\\frac{1}{k_{\\mathrm{eff}}^2} \\frac{\\partial k_{\\mathrm{eff}}}{\\partial p}$. Substituting this and rearranging gives the desired sensitivity of $k_{\\mathrm{eff}}$:\n$$\n\\frac{\\partial k_{\\mathrm{eff}}}{\\partial p} = -k_{\\mathrm{eff}}^2 \\frac{\\langle \\boldsymbol{\\phi}^{\\ast}, \\frac{\\partial L}{\\partial p} \\boldsymbol{\\phi} \\rangle}{\\langle \\boldsymbol{\\phi}^{\\ast}, M \\boldsymbol{\\phi} \\rangle}\n$$\nThe operator derivative $\\frac{\\partial L}{\\partial p}$ is found by differentiating the elements of $L$. Only the diagonal absorption term depends on $p$: $L_{i,i}(p) = \\dots + \\Sigma_{a,i}^{\\mathrm{base}} + p \\, \\Sigma_{p,i}$. Thus, $\\frac{\\partial L_{i,i}}{\\partial p} = \\Sigma_{p,i}$. The derivative matrix $\\frac{\\partial L}{\\partial p}$ is diagonal with entries $\\Sigma_{p,i}$. The inner products become sums:\n$$\n\\frac{\\partial k_{\\mathrm{eff}}}{\\partial p} = -k_{\\mathrm{eff}}^2 \\frac{\\sum_{i=0}^{N-1} \\phi^{\\ast}_i \\Sigma_{p,i} \\phi_i}{\\sum_{i=0}^{N-1} \\phi^{\\ast}_i (\\nu \\Sigma_{f,i}) \\phi_i}\n$$\nThe predicted change in $k_{\\mathrm{eff}}$ from a small perturbation $\\delta p$ is then $\\Delta k_{\\mathrm{eff}}^{\\mathrm{pred}} = \\frac{\\partial k_{\\mathrm{eff}}}{\\partial p} \\delta p$.\n\nThe numerical implementation proceeds as follows:\n1.  For a given set of parameters at the baseline poison density $p_0$, construct the symmetric loss matrix $L(p_0)$ and the diagonal production matrix $M$. The off-diagonal elements of $L$ are built from the harmonic mean of diffusion coefficients at cell interfaces, and the reflective boundary conditions are enforced by setting the diffusion terms to zero at the outer boundaries.\n2.  Solve the generalized eigenvalue problem $L(p_0) \\boldsymbol{\\phi}_0 = \\lambda_0 M \\boldsymbol{\\phi}_0$ for the smallest eigenvalue $\\lambda_0$ and its corresponding eigenvector $\\boldsymbol{\\phi}_0$. This is done using a numerical eigensolver for symmetric matrices. The baseline effective multiplication factor is $k_{\\mathrm{eff},0} = 1/\\lambda_0$.\n3.  As $L$ and $M$ are symmetric, the adjoint flux is identical to the forward flux, $\\boldsymbol{\\phi}^{\\ast}_0 = \\boldsymbol{\\phi}_0$.\n4.  Compute the sensitivity $\\frac{\\partial k_{\\mathrm{eff}}}{\\partial p}$ at $p_0$ using the derived formula, the fluxes $\\boldsymbol{\\phi}_0$, $\\boldsymbol{\\phi}^{\\ast}_0$, and $k_{\\mathrm{eff},0}$.\n5.  Calculate the predicted change $\\Delta k_{\\mathrm{eff}}^{\\mathrm{pred}} = \\frac{\\partial k_{\\mathrm{eff}}}{\\partial p} \\delta p$.\n6.  For validation, directly compute the perturbed state. Construct a new loss matrix $L(p_1)$ for $p_1 = p_0 + \\delta p$.\n7.  Solve the new eigenproblem $L(p_1) \\boldsymbol{\\phi}_1 = \\lambda_1 M \\boldsymbol{\\phi}_1$ to find the perturbed eigenvalue $\\lambda_1$ and $k_{\\mathrm{eff},1} = 1/\\lambda_1$.\n8.  The directly computed change is $\\Delta k_{\\mathrm{eff}}^{\\mathrm{dir}} = k_{\\mathrm{eff},1} - k_{\\mathrm{eff},0}$.\n9.  The final result for each case is the absolute error $e = |\\Delta k_{\\mathrm{eff}}^{\\mathrm{pred}} - \\Delta k_{\\mathrm{eff}}^{\\mathrm{dir}}|$. This error quantifies the accuracy of the first-order approximation. It is expected to be small for a small perturbation $\\delta p$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef build_matrices(N, h, D_vec, Sigma_a_base, nu_Sigma_f, Sigma_p, p):\n    \"\"\"\n    Constructs the loss (L) and production (M) matrices for the 1D diffusion problem.\n\n    Args:\n        N (int): Number of nodes.\n        h (float): Node spacing in cm.\n        D_vec (np.ndarray): Vector of diffusion coefficients for each node in cm.\n        Sigma_a_base (np.ndarray): Vector of base absorption cross sections in cm^-1.\n        nu_Sigma_f (np.ndarray): Vector of neutron production cross sections in cm^-1.\n        Sigma_p (np.ndarray): Vector of poison absorption cross sections in cm^-1.\n        p (float): Dimensionless poison density parameter.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]: A tuple containing the L and M matrices.\n    \"\"\"\n    L = np.zeros((N, N))\n    M = np.diag(nu_Sigma_f)\n\n    # Calculate interface diffusion coefficients using harmonic mean\n    D_interface = np.zeros(N - 1)\n    for i in range(N - 1):\n        D_interface[i] = 2.0 / (1.0 / D_vec[i] + 1.0 / D_vec[i+1])\n\n    # Calculate current absorption cross sections\n    Sigma_a = Sigma_a_base + p * Sigma_p\n\n    # Populate the tridiagonal L matrix\n    # Diagonal elements\n    h2 = h * h\n    for i in range(N):\n        # Absorption term\n        L[i, i] = Sigma_a[i]\n        # Diffusion term from the right interface (i, i+1)\n        if i < N - 1:\n            L[i, i] += D_interface[i] / h2\n        # Diffusion term from the left interface (i-1, i)\n        if i > 0:\n            L[i, i] += D_interface[i-1] / h2\n\n    # Off-diagonal elements\n    for i in range(N - 1):\n        L[i, i+1] = -D_interface[i] / h2\n        L[i+1, i] = -D_interface[i] / h2\n        \n    return L, M\n\ndef solve_eigenproblem(L, M):\n    \"\"\"\n    Solves the generalized eigenvalue problem L*phi = lambda*M*phi.\n\n    Args:\n        L (np.ndarray): The loss matrix.\n        M (np.ndarray): The production matrix.\n\n    Returns:\n        tuple[float, np.ndarray]: A tuple containing the fundamental eigenvalue (lambda_0)\n                                  and the corresponding eigenvector (flux phi_0).\n    \"\"\"\n    # eigh is for symmetric/Hermitian matrices, which L and M are.\n    # It returns eigenvalues in ascending order.\n    eigenvalues, eigenvectors = eigh(L, M)\n    \n    # The fundamental mode corresponds to the smallest positive eigenvalue.\n    lambda_0 = eigenvalues[0]\n    phi_0 = eigenvectors[:, 0]\n    \n    # Normalize flux to be positive (physical convention)\n    if np.sum(phi_0) < 0:\n        phi_0 *= -1.0\n        \n    return lambda_0, phi_0\n\ndef solve():\n    \"\"\"\n    Main function to execute the problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            \"N\": 12, \"h\": 15.0,\n            \"D_func\": lambda N: np.full(N, 1.2),\n            \"Sigma_a_base_func\": lambda N: np.full(N, 0.006),\n            \"nu_Sigma_f_func\": lambda N: np.full(N, 0.045),\n            \"Sigma_p_func\": lambda N: np.array([0.020 if i in {5, 6} else 0.0 for i in range(N)]),\n            \"p0\": 0.8, \"delta_p\": 0.01\n        },\n        # Case 2\n        {\n            \"N\": 8, \"h\": 20.0,\n            \"D_func\": lambda N: np.full(N, 1.4),\n            \"Sigma_a_base_func\": lambda N: np.full(N, 0.006),\n            \"nu_Sigma_f_func\": lambda N: np.full(N, 0.050),\n            \"Sigma_p_func\": lambda N: np.zeros(N),\n            \"p0\": 1.0, \"delta_p\": 0.05\n        },\n        # Case 3\n        {\n            \"N\": 10, \"h\": 12.0,\n            \"D_func\": lambda N: 1.0 + 0.6 * np.arange(N) / (N - 1),\n            \"Sigma_a_base_func\": lambda N: np.full(N, 0.005),\n            \"nu_Sigma_f_func\": lambda N: np.full(N, 0.040),\n            \"Sigma_p_func\": lambda N: np.array([0.030 if i in {0, 9} else 0.0 for i in range(N)]),\n            \"p0\": 0.5, \"delta_p\": -0.02\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case[\"N\"]\n        h = case[\"h\"]\n        p0 = case[\"p0\"]\n        delta_p = case[\"delta_p\"]\n        p1 = p0 + delta_p\n\n        # Generate material properties\n        D_vec = case[\"D_func\"](N)\n        Sigma_a_base = case[\"Sigma_a_base_func\"](N)\n        nu_Sigma_f = case[\"nu_Sigma_f_func\"](N)\n        Sigma_p = case[\"Sigma_p_func\"](N)\n\n        # 1. Baseline Calculation (at p0)\n        L0, M = build_matrices(N, h, D_vec, Sigma_a_base, nu_Sigma_f, Sigma_p, p0)\n        lambda0, phi0 = solve_eigenproblem(L0, M)\n        k_eff0 = 1.0 / lambda0\n        \n        # In this problem, L and M are symmetric, so phi* = phi\n        phi_star0 = phi0\n\n        # 2. Sensitivity Calculation\n        # dL/dp is a diagonal matrix with Sigma_p on the diagonal\n        dL_dp_matrix = np.diag(Sigma_p)\n        \n        numerator = phi_star0.T @ dL_dp_matrix @ phi0\n        denominator = phi_star0.T @ M @ phi0\n        \n        # Avoid division by zero if there's no fission\n        if np.isclose(denominator, 0.0):\n            dk_eff_dp = 0.0\n        else:\n            dk_eff_dp = -k_eff0**2 * (numerator / denominator)\n\n        delta_k_eff_pred = dk_eff_dp * delta_p\n\n        # 3. Direct Calculation (at p1 = p0 + delta_p)\n        L1, _ = build_matrices(N, h, D_vec, Sigma_a_base, nu_Sigma_f, Sigma_p, p1)\n        lambda1, _ = solve_eigenproblem(L1, M)\n        k_eff1 = 1.0 / lambda1\n        \n        delta_k_eff_dir = k_eff1 - k_eff0\n\n        # 4. Compute Absolute Error\n        error = abs(delta_k_eff_pred - delta_k_eff_dir)\n        results.append(error)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.12e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}