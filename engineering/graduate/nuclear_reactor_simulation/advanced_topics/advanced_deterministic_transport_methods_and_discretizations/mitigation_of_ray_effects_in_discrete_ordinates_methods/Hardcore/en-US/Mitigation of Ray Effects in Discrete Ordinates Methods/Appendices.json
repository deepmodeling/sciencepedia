{
    "hands_on_practices": [
        {
            "introduction": "Ray effects are a direct consequence of approximating the continuous angular domain with a finite set of discrete directions. This practice delves into the fundamental design of these discrete ordinate sets, which serves as the first line of defense against such artifacts. By examining the symbolic construction of a modern level-symmetric quadrature, you will discover a crucial, built-in mitigation feature: the intentional avoidance of directions aligned with the Cartesian axes, which are known to produce severe, unphysical streaking .",
            "id": "4235200",
            "problem": "Consider the three-dimensional Discrete Ordinates method (order-$N$ level-symmetric quadrature, denoted $S_{N}$) for neutron transport in nuclear reactor simulation. Angular integration is over the unit sphere using direction cosines $(\\mu,\\eta,\\xi)$ with $\\mu^{2}+\\eta^{2}+\\xi^{2}=1$, and quadrature weights are strictly positive. A level-symmetric quadrature partitions the first-octant directions into levels whose members are generated by permutations of a level-defining triple and extended to the full sphere by sign symmetries, so that the full quadrature has $N(N+2)$ directions. The construction is constrained by the exactness of angular moments up to degree $N-1$ (equivalently, orthogonality conditions with spherical harmonics up to total degree $N-1$), and by the normalization and symmetry of the quadrature.\n\nYou are tasked to construct an $S_{12}$ level-symmetric quadrature symbolically, enumerating explicit first-octant direction cosines and their multiplicities without computing numerical abscissae or weights. Use the following scientifically standard structure:\n\n- Let $L=\\frac{N}{2}=6$ denote the number of levels in the first octant.\n- For $5$ of the levels (type-$A$), define triples of the form $(\\alpha_{\\ell},\\alpha_{\\ell},\\beta_{\\ell})$ with $\\ell\\in\\{1,2,3,4,5\\}$, where $\\alpha_{\\ell},\\beta_{\\ell}\\in(0,1)$ and $2\\alpha_{\\ell}^{2}+\\beta_{\\ell}^{2}=1$. Each type-$A$ level produces $3$ distinct first-octant directions via permutations of the entries.\n- For $1$ of the levels (type-$B$), define a triple $(\\gamma_{1},\\gamma_{2},\\gamma_{3})$ with $\\gamma_{1},\\gamma_{2},\\gamma_{3}\\in(0,1)$, all distinct, and $\\gamma_{1}^{2}+\\gamma_{2}^{2}+\\gamma_{3}^{2}=1$. The type-$B$ level produces $6$ distinct first-octant directions via all permutations.\n- Assign a single weight $w_{\\ell}>0$ to each level, used for each permutation in that level. Impose the moment constraints that ensure exactness for all monomials $\\mu^{r}\\eta^{s}\\xi^{t}$ with $r+s+t\\leq N-1$ under the surface-area measure on the sphere, together with the symmetry conditions implied by sign changes and permutations.\n\nThis construction yields $3\\times 5+6=21$ first-octant directions and $N(N+2)=168$ total directions after applying sign symmetries.\n\nUsing only the symbolic construction above and the defining constraints of level-symmetric quadrature, identify whether any of the constructed directions align with the Cartesian axes (that is, whether any direction has $(\\mu,\\eta,\\xi)$ equal to $(\\pm 1,0,0)$, $(0,\\pm 1,0)$, or $(0,0,\\pm 1)$), which are known to exacerbate ray artifacts in Discrete Ordinates transport.\n\nCompute the total number of axis-aligned directions contained in the full $S_{12}$ level-symmetric quadrature as constructed. Express your final answer as an integer with no units. No rounding is required.",
            "solution": "The objective is to determine the total number of axis-aligned directions within a specifically constructed $S_{12}$ level-symmetric quadrature. An axis-aligned direction is defined as a vector where two of the three Cartesian components are zero. On the unit sphere, these directions are $(\\pm 1, 0, 0)$, $(0, \\pm 1, 0)$, and $(0, 0, \\pm 1)$. There are $6$ such directions in total.\n\nThe problem describes the construction of the full quadrature set, which contains $N(N+2) = 12(12+2) = 168$ directions. This set is generated from a basis of $21$ unique directions in the first octant. The generation process involves applying sign symmetries to these first-octant directions. Let a first-octant direction be denoted by a triple of direction cosines $(\\mu_0, \\eta_0, \\xi_0)$, where by definition of the first octant, $\\mu_0 \\ge 0$, $\\eta_0 \\ge 0$, and $\\xi_0 \\ge 0$. The full set of directions generated from this single first-octant direction is given by the set $\\{(\\pm \\mu_0, \\pm \\eta_0, \\pm \\xi_0)\\}$, with the number of unique directions depending on whether any of the components are zero.\n\nFor a direction $(\\mu, \\eta, \\xi)$ in the full quadrature to be axis-aligned, for instance $(\\pm 1, 0, 0)$, its components must have absolute values $(|\\mu|, |\\eta|, |\\xi|) = (1, 0, 0)$. Since the absolute values of the components are invariant under sign changes, this requires that the corresponding first-octant direction $(\\mu_0, \\eta_0, \\xi_0)$ must be a permutation of $(1, 0, 0)$. Therefore, the core of the problem is to ascertain whether any of the specified first-octant directions can have components equal to $0$ or $1$.\n\nThe construction of the first-octant directions is partitioned into two types of levels.\n\n1.  **Type-A Levels**: There are $5$ such levels, for $\\ell \\in \\{1, 2, 3, 4, 5\\}$. The direction cosines for any direction in these levels are permutations of the triple $(\\alpha_{\\ell}, \\alpha_{\\ell}, \\beta_{\\ell})$. The problem explicitly states the constraints on these values: $\\alpha_{\\ell} \\in (0,1)$ and $\\beta_{\\ell} \\in (0,1)$. The notation $(0,1)$ represents the open interval, meaning $0 < \\alpha_{\\ell} < 1$ and $0 < \\beta_{\\ell} < 1$. Consequently, none of the components $\\alpha_{\\ell}$ or $\\beta_{\\ell}$ can be equal to $0$ or $1$. Thus, no direction derived from a Type-A level can be a permutation of $(1,0,0)$.\n\n2.  **Type-B Level**: There is $1$ such level. The direction cosines for any direction in this level are permutations of the triple $(\\gamma_1, \\gamma_2, \\gamma_3)$. The problem states the constraints on these values: $\\gamma_{1}, \\gamma_{2}, \\gamma_{3} \\in (0,1)$, and they are all distinct. Again, this means $0 < \\gamma_i < 1$ for $i \\in \\{1, 2, 3\\}$. As with the Type-A levels, none of the components can be equal to $0$ or $1$. Thus, no direction derived from the Type-B level can be a permutation of $(1,0,0)$.\n\nThe entire set of first-octant directions is composed exclusively of directions from Type-A and Type-B levels. The constraints provided in the problem statement, $\\alpha_{\\ell}, \\beta_{\\ell}, \\gamma_i \\in (0,1)$, are definitive. They strictly forbid any component of a first-octant direction from being $0$ or $1$.\n\nLet $(\\mu_0, \\eta_0, \\xi_0)$ be any of the $21$ first-octant directions. Based on the analysis above, we have $\\mu_0 > 0$, $\\eta_0 > 0$, and $\\xi_0 > 0$. When generating the full quadrature by applying sign symmetries, we obtain directions of the form $(\\pm \\mu_0, \\pm \\eta_0, \\pm \\xi_0)$. Since $\\mu_0, \\eta_0, \\xi_0$ are all non-zero, none of the components of these generated directions can be zero.\n\nAn axis-aligned direction, however, must have two zero components. Since no direction in the entire $S_{12}$ set as constructed can have any zero components, it is impossible for any of them to be axis-aligned. This feature of constructing quadrature sets with components strictly within $(0,1)$ is intentional in many modern Discrete Ordinates methods, precisely to avoid placing ordinates on the axes and thereby mitigate ray effects.\n\nTherefore, the total number of axis-aligned directions in the specified $S_{12}$ quadrature is $0$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Beyond the angular quadrature, the spatial discretization scheme also profoundly influences how ray effects manifest and propagate. This exercise explores how the numerical properties of a common scheme—first-order upwinding—introduce an artificial diffusion that can dampen these artifacts. Through a classic modified-equation analysis, you will derive the \"numerical diffusion length,\" providing a tangible link between the discretization error and a physical length scale over which ray effects are inherently smeared .",
            "id": "4235151",
            "problem": "Consider a one-dimensional slab-geometry, monoenergetic neutron transport problem discretized by the Discrete Ordinates ($S_{N}$) method. Let $x$ denote the spatial coordinate and let a single ordinate with direction cosine $0<\\mu\\leq 1$ represent the streaming direction. The continuous streaming operator is $ \\mu \\,\\partial \\psi / \\partial x$, where $\\psi(x)$ is the angular flux. Suppose the spatial discretization uses a first-order upwind finite-volume scheme on a uniform mesh of cell width $h$.\n\nRay effects in the Discrete Ordinates ($S_{N}$) method manifest as grid-scale beam-like artifacts in angle-space and propagate through the spatial discretization. To quantify how the chosen spatial scheme mitigates these artifacts, define the numerical diffusion length as follows: introduce the equivalent artificial diffusion implied by the modified-equation analysis of the first-order upwind discretization of the streaming operator. Then, for a grid-scale Fourier mode with wavenumber $k_{\\max}=\\pi/h$, define the numerical diffusion length $\\ell_{\\text{num}}$ to be the distance along $x$ at which the amplitude of this mode is reduced by a factor of $\\exp(-1)$ by the artificial diffusion alone.\n\nStarting from the continuous streaming operator and the definition of the first-order upwind finite-volume discretization, and using only Taylor-series-based modified-equation analysis and Fourier-mode attenuation under diffusion, derive an analytic expression for $\\ell_{\\text{num}}$ in terms of $h$ and fundamental constants. Finally, express $\\ell_{\\text{num}}$ in meters, and provide your result as a single closed-form expression. No rounding is required.",
            "solution": "The problem requires the derivation of the numerical diffusion length, $\\ell_{\\text{num}}$, for a first-order upwind discretization of the one-dimensional streaming operator in the context of the Discrete Ordinates method. The derivation proceeds in four principal steps: ($1$) discretizing the continuous streaming operator, ($2$) performing a modified-equation analysis to identify the artificial diffusion term, ($3$) analyzing the attenuation of a Fourier mode within a time-dependent framework, and ($4$) calculating the specific length scale at which the highest-wavenumber mode decays by a factor of $\\exp(-1)$.\n\nStep 1: Discretization of the Streaming Operator\n\nWe consider the continuous, one-dimensional streaming operator, $\\mu \\frac{\\partial \\psi}{\\partial x}$, where $\\psi(x)$ is the angular flux and $\\mu > 0$ is the direction cosine. We discretize this operator on a uniform spatial grid with cell width $h$. The cells are indexed by $i$, centered at positions $x_i$, with boundaries at $x_{i \\pm 1/2}$.\n\nUsing a finite-volume method, we integrate the operator over a cell $i$, from $x_{i-1/2}$ to $x_{i+1/2}$:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\mu \\frac{\\partial \\psi}{\\partial x} \\, dx = \\mu [\\psi(x_{i+1/2}) - \\psi(x_{i-1/2})]\n$$\nThe cell-averaged operator is obtained by dividing by the cell width $h$:\n$$\n\\frac{1}{h} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\mu \\frac{\\partial \\psi}{\\partial x} \\, dx = \\frac{\\mu}{h} [\\psi(x_{i+1/2}) - \\psi(x_{i-1/2})]\n$$\nFor a first-order upwind scheme, the flux at a cell boundary is approximated by the cell-averaged flux from the upwind cell. Since the direction cosine $\\mu$ is positive, the flow of neutrons is in the positive $x$ direction. Therefore, the upwind direction is to the left (from cell $i-1$ to cell $i$). Let $\\psi_i$ represent the cell-averaged flux in cell $i$. The upwind approximations for the boundary fluxes are:\n$$\n\\psi(x_{i-1/2}) \\approx \\psi_{i-1}\n$$\n$$\n\\psi(x_{i+1/2}) \\approx \\psi_i\n$$\nSubstituting these approximations into the finite-volume expression yields the discretized streaming operator at cell $i$:\n$$\n\\left( \\mu \\frac{\\partial \\psi}{\\partial x} \\right)_{\\text{discrete}, i} = \\mu \\frac{\\psi_i - \\psi_{i-1}}{h}\n$$\n\nStep 2: Modified-Equation Analysis and Artificial Diffusion\n\nTo determine the effective continuous equation that the discrete scheme solves, we perform a modified-equation analysis. We replace the discrete flux values $\\psi_i$ and $\\psi_{i-1}$ with their Taylor series expansions around the cell center $x_i$. The flux $\\psi_{i-1}$ at $x_{i-1} = x_i - h$ is expanded as:\n$$\n\\psi_{i-1} = \\psi(x_i - h) = \\psi(x_i) - h \\left.\\frac{\\partial \\psi}{\\partial x}\\right|_{x_i} + \\frac{h^2}{2} \\left.\\frac{\\partial^2 \\psi}{\\partial x^2}\\right|_{x_i} - O(h^3)\n$$\nSubstituting this expansion into the discrete operator, and denoting $\\psi(x_i)$ as $\\psi_i$ for notational consistency with the continuous function:\n$$\n\\mu \\frac{\\psi_i - \\psi_{i-1}}{h} = \\frac{\\mu}{h} \\left[ \\psi_i - \\left( \\psi_i - h \\frac{\\partial \\psi}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 \\psi}{\\partial x^2} - O(h^3) \\right) \\right]\n$$\n$$\n= \\frac{\\mu}{h} \\left[ h \\frac{\\partial \\psi}{\\partial x} - \\frac{h^2}{2} \\frac{\\partial^2 \\psi}{\\partial x^2} + O(h^3) \\right]\n$$\n$$\n= \\mu \\frac{\\partial \\psi}{\\partial x} - \\frac{\\mu h}{2} \\frac{\\partial^2 \\psi}{\\partial x^2} + O(h^2)\n$$\nThis result shows that the first-order upwind scheme approximates the original streaming operator plus a leading-order truncation error term, $-\\frac{\\mu h}{2} \\frac{\\partial^2 \\psi}{\\partial x^2}$. This term has the form of a diffusion operator, $-D_{\\text{art}} \\frac{\\partial^2 \\psi}{\\partial x^2}$, where the coefficient of artificial diffusion is:\n$$\nD_{\\text{art}} = \\frac{\\mu h}{2}\n$$\nThe problem asks for the attenuation due to this \"artificial diffusion alone\".\n\nStep 3: Fourier Mode Attenuation\n\nTo analyze the attenuation of a spatial mode, it is standard to consider a time-dependent advection problem, $\\frac{\\partial \\psi}{\\partial t} + \\mu \\frac{\\partial \\psi}{\\partial x} = 0$. Discretizing the spatial part with the first-order upwind scheme leads to the modified partial differential equation:\n$$\n\\frac{\\partial \\psi}{\\partial t} + \\mu \\frac{\\partial \\psi}{\\partial x} = D_{\\text{art}} \\frac{\\partial^2 \\psi}{\\partial x^2} = \\frac{\\mu h}{2} \\frac{\\partial^2 \\psi}{\\partial x^2}\n$$\nThis is an advection-diffusion equation. We analyze its effect on a single spatial Fourier mode, $\\psi(x,t) = A(t) \\exp(ikx)$, where $k$ is the wavenumber. Substituting this into the modified equation gives:\n$$\n\\frac{dA(t)}{dt} \\exp(ikx) + \\mu A(t) (ik) \\exp(ikx) = \\frac{\\mu h}{2} A(t) (ik)^2 \\exp(ikx)\n$$\nDividing by $\\exp(ikx)$ yields an ordinary differential equation for the amplitude $A(t)$:\n$$\n\\frac{dA(t)}{dt} = -ik\\mu A(t) - k^2 \\frac{\\mu h}{2} A(t) = \\left( -ik\\mu - k^2 \\frac{\\mu h}{2} \\right) A(t)\n$$\nThe solution is $A(t) = A(0) \\exp\\left( \\left( -ik\\mu - k^2 \\frac{\\mu h}{2} \\right) t \\right)$. The magnitude of the amplitude evolves as:\n$$\n|A(t)| = |A(0)| \\left| \\exp(-ik\\mu t) \\exp\\left(-k^2 \\frac{\\mu h}{2} t\\right) \\right| = |A(0)| \\exp\\left(-k^2 \\frac{\\mu h}{2} t\\right)\n$$\nThe attenuation of the mode is governed by the real part of the exponent, which arises from the artificial diffusion term.\n\nStep 4: Calculation of the Numerical Diffusion Length\n\nThe problem defines $\\ell_{\\text{num}}$ as a spatial distance. We can relate the temporal evolution to spatial propagation by considering the speed at which the Fourier mode travels. This is given by the group velocity, $v_g$, of the wave packet. For the advection-diffusion equation, the dispersion relation is $\\omega(k) = k\\mu - i k^2 \\frac{\\mu h}{2}$. The group velocity is the derivative of the real part of $\\omega$ with respect to $k$:\n$$\nv_g = \\frac{d(\\text{Re}(\\omega))}{dk} = \\frac{d(k\\mu)}{dk} = \\mu\n$$\nA wave packet travels a distance $x$ in time $t = x/v_g = x/\\mu$. We can express the amplitude attenuation as a function of propagation distance $x$:\n$$\n|A(x)| = |A_0| \\exp\\left(-k^2 \\frac{\\mu h}{2} \\frac{x}{\\mu}\\right) = |A_0| \\exp\\left(-\\frac{k^2 h x}{2}\\right)\n$$\nNote that the dependence on the direction cosine $\\mu$ has canceled. The numerical diffusion length $\\ell_{\\text{num}}$ is the distance $x$ at which the amplitude is reduced by a factor of $\\exp(-1)$, i.e., $|A(\\ell_{\\text{num}})|/|A_0| = \\exp(-1)$.\n$$\n\\exp\\left(-\\frac{k^2 h \\ell_{\\text{num}}}{2}\\right) = \\exp(-1)\n$$\nTaking the natural logarithm of both sides gives:\n$$\n\\frac{k^2 h \\ell_{\\text{num}}}{2} = 1 \\implies \\ell_{\\text{num}} = \\frac{2}{k^2 h}\n$$\nThe problem specifies that we must evaluate this for the grid-scale Fourier mode, which has the highest possible wavenumber on the mesh, $k_{\\max} = \\pi/h$. Substituting this value for $k$:\n$$\n\\ell_{\\text{num}} = \\frac{2}{\\left(\\frac{\\pi}{h}\\right)^2 h} = \\frac{2}{\\frac{\\pi^2}{h^2} h} = \\frac{2h}{\\pi^2}\n$$\nThe expression for the numerical diffusion length is given in terms of the cell width $h$ and the fundamental mathematical constant $\\pi$. If $h$ is provided in meters, $\\ell_{\\text{num}}$ will also be in meters, as required.",
            "answer": "$$\\boxed{\\frac{2h}{\\pi^{2}}}$$"
        },
        {
            "introduction": "Having analyzed the inherent properties of the discretization, we now turn to an active mitigation strategy applied at the problem modeling stage. Ray effects are most pronounced for localized, \"point-like\" sources, as they concentrate the particle flux into a few discrete directions. This hands-on computational exercise demonstrates how distributing the source over a volume effectively mitigates these artifacts by spreading its influence across a wider range of discrete ordinates, resulting in a smoother angular flux distribution .",
            "id": "4235231",
            "problem": "Consider the steady-state, monoenergetic linear transport equation in a homogeneous, infinite medium with pure absorption (no scattering), expressed as $\\boldsymbol{\\Omega}\\cdot\\nabla \\psi(\\mathbf{r},\\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r},\\boldsymbol{\\Omega}) = q(\\mathbf{r})/(4\\pi)$, where $\\psi(\\mathbf{r},\\boldsymbol{\\Omega})$ is the angular flux, $\\Sigma_t$ is the total macroscopic cross section, $\\boldsymbol{\\Omega}$ is the unit direction vector, and $q(\\mathbf{r})$ is an isotropic source density. In the discrete ordinates ($S_N$) method, ray effects manifest as artificial angular streaking caused by concentrating flux into a limited set of discrete directions. A distributed volumetric source can mitigate these effects by spreading directional contributions over many ordinates. Your task is to demonstrate this mitigation quantitatively by computing the angular variance of $\\psi(\\boldsymbol{\\Omega})$ at a fixed observation location for two source configurations: an isotropic point source and a uniform volumetric cube source. Work in three-dimensional space.\n\nFundamental base and assumptions:\n- Use the linear transport equation above as the base model with pure absorption, zero scattering, and an infinite medium.\n- The isotropic point source has total emission rate $S_0$ in particles per second, located at the origin.\n- The uniform volumetric source occupies a cube of side $a$ centered at the origin and has strength $s_v$ in particles per cubic centimeter per second, chosen so that the total emission rate equals the point source, i.e., $s_v a^3 = S_0$.\n- The observation point is at position $\\mathbf{r}_{\\text{obs}}$ and is outside the cube for all test cases.\n\nDiscrete approximation and algorithmic definitions:\n1. Discrete ordinates quadrature:\n   - Construct a product quadrature over the unit sphere by combining Gauss–Legendre nodes in $\\mu = \\cos\\theta$ on $\\left[-1,1\\right]$ with $N_\\mu$ nodes and weights, and uniform azimuthal angles $\\phi$ over $\\left[0,2\\pi\\right)$ with $N_\\phi$ equally spaced nodes. The direction vectors are $\\boldsymbol{\\Omega}_{n} = (\\sin\\theta_i\\cos\\phi_j,\\,\\sin\\theta_i\\sin\\phi_j,\\,\\mu_i)$ with weights $w_n = w^{(\\mu)}_i \\cdot \\Delta\\phi$, where $\\Delta\\phi = 2\\pi/N_\\phi$ and $w^{(\\mu)}_i$ are the Gauss–Legendre weights. The weights must sum to $4\\pi$.\n   - Angles must be in radians.\n\n2. Angular flux construction at $\\mathbf{r}_{\\text{obs}}$:\n   - For a source point at position $\\mathbf{r}_s$, its contribution magnitude to the angular flux at $\\mathbf{r}_{\\text{obs}}$ along the line-of-sight direction $\\widehat{\\mathbf{d}} = (\\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s)/\\lVert \\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s\\rVert$ and path length $L = \\lVert \\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s\\rVert$ is given by the line attenuation and geometric dilution: $A(\\mathbf{r}_s) = \\left(\\frac{Q_s}{4\\pi}\\right) \\frac{e^{-\\Sigma_t L}}{L^2}$, where $Q_s$ is the emission rate assigned to the source point (for the point source, $Q_s = S_0$ and there is one source point; for the volumetric source discretized into $M$ subpoints, $Q_s = S_0/M$ for each subpoint).\n   - In the discrete ordinates approximation, assign the contribution from $\\mathbf{r}_s$ to the single quadrature direction $\\boldsymbol{\\Omega}_{n^*}$ that minimizes the angular separation to $\\widehat{\\mathbf{d}}$; equivalently, choose $n^* = \\underset{n}{\\arg\\max}\\, \\boldsymbol{\\Omega}_n\\cdot \\widehat{\\mathbf{d}}$. Accumulate $A(\\mathbf{r}_s)$ into $\\psi_n$ for $n=n^*$.\n   - For the point source configuration, there is a single $\\mathbf{r}_s = \\mathbf{0}$.\n   - For the volumetric configuration, approximate the uniform source by a Cartesian grid of $M = N^3$ points, centered within the cube, uniformly spaced, covering the cube of side $a$.\n\n3. Angular variance metric:\n   - Let $\\{\\psi_n\\}_{n=1}^N$ be the constructed discrete angular flux values and $\\{w_n\\}_{n=1}^N$ the corresponding quadrature weights, with $\\sum_{n=1}^N w_n = 4\\pi$.\n   - Compute the weighted mean $\\mu_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\psi_n$.\n   - Compute the weighted variance $V_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\left(\\psi_n - \\mu_\\psi\\right)^2$.\n   - Report the normalized angular variance (coefficient of variation squared) $C = \\frac{V_\\psi}{\\mu_\\psi^2}$, which is dimensionless.\n   - Define the variance reduction ratio $\\rho = \\frac{C_{\\text{vol}}}{C_{\\text{point}}}$, where $C_{\\text{vol}}$ and $C_{\\text{point}}$ are the normalized variances for the volumetric and point sources, respectively. Values $\\rho < 1$ indicate mitigation of ray effects.\n\nUnits and numerical details:\n- Lengths must be in centimeters (cm).\n- Cross section $\\Sigma_t$ must be in inverse centimeters ($\\text{cm}^{-1}$).\n- Source emission rate $S_0$ must be in particles per second ($\\text{s}^{-1}$), but you should set $S_0 = 1$ so the final outputs are dimensionless and independent of arbitrary scaling.\n- Angles must be in radians.\n\nTest suite:\nFor each test case, apply the algorithm above to compute $\\rho$ at the given observation point. Use the specified quadrature sizes and volumetric cube parameters. Aggregate the results for all test cases into a single output line as specified below.\n\n- Test case $1$ (general case, moderate absorption, medium quadrature):\n  - $\\Sigma_t = 0.1\\,\\text{cm}^{-1}$,\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$,\n  - $N_\\mu = 8$, $N_\\phi = 16$,\n  - Cube side $a = 6.0\\,\\text{cm}$,\n  - Volumetric discretization $M = 1000$ (i.e., $N=10$ per side).\n\n- Test case $2$ (coarse quadrature, stronger ray effects expected):\n  - $\\Sigma_t = 0.1\\,\\text{cm}^{-1}$,\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$,\n  - $N_\\mu = 4$, $N_\\phi = 8$,\n  - Cube side $a = 6.0\\,\\text{cm}$,\n  - Volumetric discretization $M = 216$ (i.e., $N=6$ per side).\n\n- Test case $3$ (near-point volumetric source, boundary condition):\n  - $\\Sigma_t = 0.1\\,\\text{cm}^{-1}$,\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$,\n  - $N_\\mu = 8$, $N_\\phi = 16$,\n  - Cube side $a = 0.5\\,\\text{cm}$,\n  - Volumetric discretization $M = 1000$ (i.e., $N=10$ per side).\n\n- Test case $4$ (higher absorption, robustness check):\n  - $\\Sigma_t = 0.7\\,\\text{cm}^{-1}$,\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$,\n  - $N_\\mu = 8$, $N_\\phi = 16$,\n  - Cube side $a = 6.0\\,\\text{cm}$,\n  - Volumetric discretization $M = 1000$ (i.e., $N=10$ per side).\n\nFinal output format:\n- Your program should produce a single line of output containing the variance reduction ratios for the above four test cases, as a comma-separated list enclosed in square brackets, e.g., $\\left[\\rho_1,\\rho_2,\\rho_3,\\rho_4\\right]$. Each $\\rho_i$ must be a floating-point number (dimensionless). The program must run as-is, with no user input, and must compute all quantities internally following the stated definitions and units.",
            "solution": "The solution proceeds by first constructing a discrete representation of the angular domain and then simulating the particle transport from two different source configurations to a fixed observation point. The core idea is to show that a spatially distributed source deposits flux across a wider range of discrete angular directions, thereby reducing the angular variance compared to a highly localized point source.\n\nThe first step is the discretization of the continuous angular variable $\\boldsymbol{\\Omega}$ into a finite set of $N = N_\\mu \\times N_\\phi$ directions $\\{\\boldsymbol{\\Omega}_n\\}$ with corresponding weights $\\{w_n\\}$. A product quadrature is employed. The polar angle cosine $\\mu = \\cos\\theta \\in [-1, 1]$ is discretized using an $N_\\mu$-point Gauss-Legendre quadrature, yielding a set of nodes $\\{\\mu_i\\}_{i=1}^{N_\\mu}$ and weights $\\{w^{(\\mu)}_i\\}_{i=1}^{N_\\mu}$. The polar angles are then $\\theta_i = \\arccos(\\mu_i)$. The sum of these weights is $\\sum_{i=1}^{N_\\mu} w^{(\\mu)}_i = 2$. The azimuthal angle $\\phi \\in [0, 2\\pi)$ is discretized into $N_\\phi$ uniformly spaced angles $\\{\\phi_j\\}_{j=0}^{N_\\phi-1}$, where $\\phi_j = j \\cdot \\Delta\\phi$ and the angular bin width is $\\Delta\\phi = 2\\pi/N_\\phi$. A discrete direction $\\boldsymbol{\\Omega}_n$, corresponding to a pair $(\\mu_i, \\phi_j)$, is given in Cartesian coordinates by:\n$$ \\boldsymbol{\\Omega}_n = (\\sin\\theta_i\\cos\\phi_j, \\sin\\theta_i\\sin\\phi_j, \\mu_i) = (\\sqrt{1-\\mu_i^2}\\cos\\phi_j, \\sqrt{1-\\mu_i^2}\\sin\\phi_j, \\mu_i) $$\nThe weight $w_n$ associated with this direction is the product of the polar and azimuthal weights, $w_n = w^{(\\mu)}_i \\cdot \\Delta\\phi$. The total sum of all weights is $\\sum_{n=1}^{N} w_n = \\sum_{i=1}^{N_\\mu} w^{(\\mu)}_i \\sum_{j=0}^{N_\\phi-1} \\Delta\\phi = 2 \\cdot (N_\\phi \\cdot \\frac{2\\pi}{N_\\phi}) = 4\\pi$, correctly normalizing over the unit sphere.\n\nThe second step is the angular flux calculation. The angular flux $\\psi(\\mathbf{r}_{\\text{obs}}, \\boldsymbol{\\Omega})$ at the observation point $\\mathbf{r}_{\\text{obs}}$ is constructed by summing the contributions from all source locations. For a source element of strength $Q_s$ at position $\\mathbf{r}_s$, the uncollided flux contribution along the line-of-sight is based on geometric $1/L^2$ dilution and exponential attenuation. The path length is $L = \\lVert \\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s\\rVert$. The contribution's magnitude is:\n$$ A(\\mathbf{r}_s) = \\left(\\frac{Q_s}{4\\pi}\\right) \\frac{e^{-\\Sigma_t L}}{L^2} $$\nIn the discrete ordinates method, this continuous contribution, which travels in the exact direction $\\widehat{\\mathbf{d}} = (\\mathbf{r}_{\\text{obs}}-\\mathbf{r}_s)/L$, is assigned to the single discrete ordinate $\\boldsymbol{\\Omega}_{n^*}$ that is \"closest\" in angle. This is found by maximizing the dot product:\n$$ n^* = \\underset{n}{\\arg\\max}\\ (\\boldsymbol{\\Omega}_n \\cdot \\widehat{\\mathbf{d}}) $$\nThe discrete angular flux array, initialized to zeros, $\\{\\psi_n = 0\\}_{n=1}^N$, is then updated by accumulating these contributions: $\\psi_{n^*} \\leftarrow \\psi_{n^*} + A(\\mathbf{r}_s)$. This process is repeated for all source locations. Two source models are considered:\n1.  A single point source at the origin, $\\mathbf{r}_s = \\mathbf{0}$, with total strength $Q_s = S_0$. This results in a single non-zero contribution to one specific ordinate $\\psi_{n^*}$, which is characteristic of the ray effect.\n2.  A volumetric source where the cube of side $a$ is discretized into $M=N^3$ identical sub-cubes. Each sub-cube is represented by a point source at its center, $\\mathbf{r}_{s_k}$. The total source strength $S_0$ is distributed equally among these points, so each has strength $Q_s = S_0/M$. The flux is calculated by summing the contributions from all $M$ points. Since each point $\\mathbf{r}_{s_k}$ defines a slightly different line-of-sight direction $\\widehat{\\mathbf{d}}_k$, the total flux is spread over multiple discrete ordinates, mitigating the ray effect.\n\nThe third step is angular variance quantification. To quantify the smoothness of the angular flux distribution, a normalized variance is computed. Given the set of discrete flux values $\\{\\psi_n\\}$ and weights $\\{w_n\\}$, the weighted mean angular flux (equivalent to the scalar flux divided by $4\\pi$) is calculated:\n$$ \\mu_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\psi_n $$\nNext, the weighted variance is computed:\n$$ V_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\left(\\psi_n - \\mu_\\psi\\right)^2 $$\nFinally, the dimensionless normalized angular variance, or squared coefficient of variation, is given by:\n$$ C = \\frac{V_\\psi}{\\mu_\\psi^2} $$\nThis metric $C$ is computed for both the point source ($C_{\\text{point}}$) and the volumetric source ($C_{\\text{vol}}$).\n\nThe final step is the computation of the variance reduction ratio. The effectiveness of the volumetric source in mitigating ray effects is measured by the ratio $\\rho$:\n$$ \\rho = \\frac{C_{\\text{vol}}}{C_{\\text{point}}} $$\nA value of $\\rho < 1$ indicates that the volumetric source produces a smoother angular flux distribution (lower relative variance) than the point source, demonstrating the mitigation of ray effects. The algorithm implements these steps for each test case to compute the corresponding $\\rho_i$. For all calculations, the total source strength is set to $S_0=1$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\nclass RayEffectMitigationSimulator:\n    \"\"\"\n    Simulates particle transport from different sources to quantify ray effect mitigation.\n    \"\"\"\n    def __init__(self, sigma_t, r_obs, N_mu, N_phi, a, M):\n        \"\"\"\n        Initializes the simulator with parameters for a single test case.\n        \"\"\"\n        self.sigma_t = sigma_t\n        self.r_obs = np.array(r_obs, dtype=float)\n        self.N_mu = N_mu\n        self.N_phi = N_phi\n        self.a = a\n        self.M = M\n        self.S0 = 1.0  # Normalized total source strength, as per problem.\n\n        # Generate the discrete ordinates quadrature set upon initialization.\n        self.omegas, self.weights = self._generate_quadrature_set()\n\n    def _generate_quadrature_set(self):\n        \"\"\"\n        Constructs the product quadrature set (directions and weights).\n        \"\"\"\n        # Get N_mu Gauss-Legendre nodes (mu) and weights (w_mu) on [-1, 1].\n        # The sum of numpy's `leggauss` weights is 2.\n        mu_nodes, mu_weights = leggauss(self.N_mu)\n        \n        # Generate N_phi uniform azimuthal angles on [0, 2*pi).\n        phi_nodes = np.linspace(0.0, 2.0 * np.pi, self.N_phi, endpoint=False)\n        delta_phi = 2.0 * np.pi / self.N_phi\n        \n        num_directions = self.N_mu * self.N_phi\n        omegas = np.zeros((num_directions, 3))\n        weights = np.zeros(num_directions)\n        \n        idx = 0\n        for i in range(self.N_mu):\n            mu = mu_nodes[i]\n            w_mu = mu_weights[i]\n            # sin(theta) = sqrt(1 - cos^2(theta))\n            sin_theta = np.sqrt(1.0 - mu**2)\n            for j in range(self.N_phi):\n                phi = phi_nodes[j]\n                \n                # Convert from spherical to Cartesian coordinates for the direction vector.\n                omegas[idx, 0] = sin_theta * np.cos(phi)\n                omegas[idx, 1] = sin_theta * np.sin(phi)\n                omegas[idx, 2] = mu\n                \n                # The weight for this direction is the product of polar and azimuthal weights.\n                weights[idx] = w_mu * delta_phi\n                idx += 1\n        \n        return omegas, weights\n\n    def _calculate_normalized_variance(self, source_type):\n        \"\"\"\n        Calculates the normalized angular variance for a given source configuration.\n        \"\"\"\n        # 1. Generate source points and their individual strengths.\n        if source_type == 'point':\n            source_points = np.array([[0.0, 0.0, 0.0]])\n            q_s = self.S0\n        elif source_type == 'volumetric':\n            N = int(round(self.M**(1./3.)))\n            if N**3 != self.M:\n                # This check ensures M is a perfect cube as expected.\n                raise ValueError(f\"M={self.M} is not a perfect cube.\")\n            \n            # Create coordinates for sub-source points at the center of each sub-volume.\n            coords1d = np.linspace(-self.a / 2.0 + self.a / (2.0 * N), self.a / 2.0 - self.a / (2.0 * N), N)\n            x, y, z = np.meshgrid(coords1d, coords1d, coords1d, indexing='ij')\n            source_points = np.vstack([x.ravel(), y.ravel(), z.ravel()]).T\n            q_s = self.S0 / self.M\n        else:\n            raise ValueError(\"Invalid source type specified.\")\n\n        # 2. Calculate the discrete angular flux psi_n.\n        num_directions = len(self.weights)\n        psi_n = np.zeros(num_directions)\n\n        for r_s in source_points:\n            d = self.r_obs - r_s\n            L = np.linalg.norm(d)\n            if L == 0.0: continue # Observer is at a source point. Skip.\n            \n            d_hat = d / L\n            \n            # Calculate contribution magnitude: geometric dilution and attenuation.\n            A = (q_s / (4.0 * np.pi)) * np.exp(-self.sigma_t * L) / (L**2)\n\n            # Find the discrete ordinate that best matches the line-of-sight direction.\n            dot_products = self.omegas @ d_hat\n            n_star = np.argmax(dot_products)\n            \n            # Accumulate the contribution to the corresponding angular flux bin.\n            psi_n[n_star] += A\n        \n        # 3. Compute the normalized variance C.\n        # Weighted mean of the angular flux.\n        mu_psi = np.sum(self.weights * psi_n) / (4.0 * np.pi)\n        \n        # According to the problem, C = V / mu^2. If mu is zero, C is undefined.\n        # However, for the given test cases, mu_psi will be non-zero.\n        if mu_psi == 0.0:\n            return np.nan\n\n        # Weighted variance of the angular flux.\n        V_psi = np.sum(self.weights * (psi_n - mu_psi)**2) / (4.0 * np.pi)\n        \n        # Normalized variance (squared coefficient of variation).\n        C = V_psi / (mu_psi**2)\n        \n        return C\n\n    def compute_reduction_ratio(self):\n        \"\"\"\n        Computes the variance reduction ratio rho = C_vol / C_point.\n        \"\"\"\n        C_point = self._calculate_normalized_variance('point')\n        C_vol = self._calculate_normalized_variance('volumetric')\n\n        if C_point == 0.0:\n            return np.nan # C_point should be large and positive, but handle this case.\n\n        rho = C_vol / C_point\n        return rho\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (sigma_t, r_obs, N_mu, N_phi, a, M)\n        {'sigma_t': 0.1, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 8, 'N_phi': 16, 'a': 6.0, 'M': 1000},\n        {'sigma_t': 0.1, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 4, 'N_phi': 8, 'a': 6.0, 'M': 216},\n        {'sigma_t': 0.1, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 8, 'N_phi': 16, 'a': 0.5, 'M': 1000},\n        {'sigma_t': 0.7, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 8, 'N_phi': 16, 'a': 6.0, 'M': 1000},\n    ]\n\n    results = []\n    for params in test_cases:\n        # Instantiate the simulator for the current test case.\n        simulator = RayEffectMitigationSimulator(**params)\n        # Compute the variance reduction ratio.\n        rho = simulator.compute_reduction_ratio()\n        results.append(rho)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}