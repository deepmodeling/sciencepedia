{
    "hands_on_practices": [
        {
            "introduction": "The foundation of the Finite Volume Method (FVM) for particle transport is the principle of conservation. This practice involves transforming the differential form of the Boltzmann transport equation into an algebraic balance equation over a single computational cell. By completing this exercise (), you will gain first-hand experience in this fundamental derivation, solidifying your understanding of how continuous physics is translated into a discrete form that a computer can solve.",
            "id": "4259421",
            "problem": "Consider a single steady-state monoenergetic transport direction in a Discrete Ordinates ($S_N$) formulation for nuclear reactor simulation. Let a convex hexahedral cell with axis-aligned faces have edge lengths $L_x$, $L_y$, and $L_z$, so the cell volume is $V = L_x L_y L_z$ and the six face areas are $A_{\\pm x} = L_y L_z$, $A_{\\pm y} = L_x L_z$, and $A_{\\pm z} = L_x L_y$. The steady-state linear Boltzmann transport equation for angular flux $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega})$ with a constant total cross section $\\Sigma_t$ and a constant isotropic volumetric source $q$ per unit solid angle is\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = q.\n$$\nStarting from this equation, integrate over the cell volume and apply the divergence theorem to derive a discrete cell balance that relates the cell-constant angular flux under a piecewise constant approximation and the inflow and outflow angular fluxes on each face for the given direction $\\boldsymbol{\\Omega}$. Assume the following physically consistent modeling choices:\n- The piecewise constant approximation sets $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega})$ equal to a single constant $\\psi_c(\\boldsymbol{\\Omega})$ throughout the cell interior.\n- On outflow faces (those with $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f > 0$, where $\\mathbf{n}_f$ is the outward unit normal of face $f$), the face angular flux equals the cell value, i.e., $\\psi_f(\\boldsymbol{\\Omega}) = \\psi_c(\\boldsymbol{\\Omega})$.\n- On inflow faces (those with $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f < 0$), the face angular flux is prescribed as an incoming boundary value $\\psi_{f,\\text{in}}(\\boldsymbol{\\Omega})$.\n\nThen, for a specific hexahedral cell with $L_x = 2\\,\\text{cm}$, $L_y = 3\\,\\text{cm}$, $L_z = 5\\,\\text{cm}$, direction $\\boldsymbol{\\Omega} = \\left(\\frac{3}{5}, -\\frac{4}{5}, 0\\right)$, total cross section $\\Sigma_t = \\frac{1}{3}\\,\\text{cm}^{-1}$, and isotropic source $q = \\frac{1}{2}\\,\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$, take the incoming (inflow) angular fluxes to be\n$$\n\\psi_{-x,\\text{in}}(\\boldsymbol{\\Omega}) = 2\\,\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}, \\quad\n\\psi_{+y,\\text{in}}(\\boldsymbol{\\Omega}) = 3\\,\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1},\n$$\nwith no other inflow on the remaining faces for this direction. Using the derived discrete balance, compute the outflow angular flux for this cell and direction, noting that the piecewise constant approximation makes the outflow angular flux equal on all outflow faces. Express your final answer in neutrons per square centimeter per second per steradian. No rounding is required; provide an exact value.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of neutral particle transport, well-posed with sufficient information for a unique solution, and objectively stated.\n\nThe starting point is the steady-state, monoenergetic, linear Boltzmann transport equation for the angular flux $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega})$ in a medium with a constant total cross section $\\Sigma_t$ and a constant isotropic volumetric source $q$ per unit solid angle:\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = q\n$$\nHere, $\\mathbf{r}$ is the position vector and $\\boldsymbol{\\Omega}$ is the direction of particle travel.\n\nTo derive the discrete cell balance equation, we integrate this equation over the volume $V$ of a single convex hexahedral cell:\n$$\n\\int_V (\\boldsymbol{\\Omega} \\cdot \\nabla \\psi) dV + \\int_V \\Sigma_t \\psi dV = \\int_V q dV\n$$\nSince $\\boldsymbol{\\Omega}$ is constant for a given discrete ordinate direction, the first term can be rewritten using the product rule for divergence, $\\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) = (\\nabla \\cdot \\boldsymbol{\\Omega}) \\psi + \\boldsymbol{\\Omega} \\cdot \\nabla \\psi$. As $\\boldsymbol{\\Omega}$ is a constant vector, $\\nabla \\cdot \\boldsymbol{\\Omega} = 0$, so $\\boldsymbol{\\Omega} \\cdot \\nabla \\psi = \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi)$. Applying the divergence theorem to this term yields:\n$$\n\\int_V \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) dV = \\oint_{\\partial V} (\\boldsymbol{\\Omega} \\psi) \\cdot \\mathbf{n} dS = \\sum_{f=1}^{6} \\int_{A_f} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) dA\n$$\nwhere $\\partial V$ is the boundary of the cell, which consists of $6$ faces. For each face $f$, $A_f$ is its area, $\\mathbf{n}_f$ is its outward unit normal vector, and $\\psi_f$ is the angular flux on that face.\n\nNow we apply the piecewise constant approximation. Within the cell interior, the angular flux is assumed to be a constant value, $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = \\psi_c(\\boldsymbol{\\Omega})$. The source $q$ and cross section $\\Sigma_t$ are also constant. Thus, the volume integrals become:\n$$\n\\int_V \\Sigma_t \\psi dV = \\Sigma_t \\psi_c V\n$$\n$$\n\\int_V q dV = q V\n$$\nOn each face $f$, the flux $\\psi_f$ is also assumed to be constant over the face area. The surface integral then simplifies to:\n$$\n\\sum_{f=1}^{6} \\int_{A_f} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) dA = \\sum_{f=1}^{6} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f\n$$\nSubstituting these expressions back into the integrated transport equation gives the balance equation:\n$$\n\\sum_{f=1}^{6} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t \\psi_c V = q V\n$$\nNext, we utilize the inflow and outflow conditions. The set of faces is partitioned into outflow faces where $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f > 0$, inflow faces where $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f < 0$, and potentially grazing faces where $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f = 0$. For grazing faces, the contribution to the sum is zero.\n- For outflow faces, the flux is set to the cell-average value: $\\psi_f = \\psi_c$.\n- For inflow faces, the flux is a prescribed boundary condition: $\\psi_f = \\psi_{f,\\text{in}}$.\n\nThe sum over the faces can be split accordingly:\n$$\n\\sum_{\\text{outflow}} \\psi_c (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t \\psi_c V = q V\n$$\nWe can now solve for the unknown cell-average flux, $\\psi_c$:\n$$\n\\psi_c \\left( \\sum_{\\text{outflow}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t V \\right) = q V - \\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f\n$$\n$$\n\\psi_c = \\frac{q V - \\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f}{\\sum_{\\text{outflow}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t V}\n$$\nThe problem asks for the outflow angular flux, which, under the given approximation, is equal to $\\psi_c$.\n\nNow we apply this formula to the specific case. The cell dimensions are $L_x = 2\\,\\text{cm}$, $L_y = 3\\,\\text{cm}$, and $L_z = 5\\,\\text{cm}$.\nThe cell volume is $V = L_x L_y L_z = (2)(3)(5) = 30\\,\\text{cm}^3$.\nThe face areas are $A_x = L_y L_z = (3)(5) = 15\\,\\text{cm}^2$, $A_y = L_x L_z = (2)(5) = 10\\,\\text{cm}^2$, and $A_z = L_x L_y = (2)(3) = 6\\,\\text{cm}^2$.\nThe direction is $\\boldsymbol{\\Omega} = (\\Omega_x, \\Omega_y, \\Omega_z) = \\left(\\frac{3}{5}, -\\frac{4}{5}, 0\\right)$.\nThe physical constants are $\\Sigma_t = \\frac{1}{3}\\,\\text{cm}^{-1}$ and $q = \\frac{1}{2}\\,\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$.\n\nWe must identify the inflow and outflow faces by checking the sign of $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f$:\n- Face at $x = -L_x/2$ (face $-x$): $\\mathbf{n}_{-x} = (-1, 0, 0)$. $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-x} = -\\frac{3}{5} < 0$. This is an inflow face.\n- Face at $x = +L_x/2$ (face $+x$): $\\mathbf{n}_{+x} = (1, 0, 0)$. $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+x} = +\\frac{3}{5} > 0$. This is an outflow face.\n- Face at $y = -L_y/2$ (face $-y$): $\\mathbf{n}_{-y} = (0, -1, 0)$. $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-y} = +\\frac{4}{5} > 0$. This is an outflow face.\n- Face at $y = +L_y/2$ (face $+y$): $\\mathbf{n}_{+y} = (0, 1, 0)$. $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+y} = -\\frac{4}{5} < 0$. This is an inflow face.\n- Faces at $z = \\pm L_z/2$ (faces $\\pm z$): $\\mathbf{n}_{\\pm z} = (0, 0, \\pm 1)$. $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{\\pm z} = 0$. These are grazing faces and do not contribute to the leakage sums.\n\nThe inflow angular fluxes are given as $\\psi_{-x,\\text{in}} = 2$ and $\\psi_{+y,\\text{in}} = 3$ in units of $\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$.\n\nWe can now compute the terms in the expression for $\\psi_c$:\nThe source term in the numerator is $qV = (\\frac{1}{2})(30) = 15$.\nThe inflow leakage term is $\\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f$:\n$$\n\\psi_{-x,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-x}) A_{-x} + \\psi_{+y,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+y}) A_{+y} = (2)\\left(-\\frac{3}{5}\\right)(15) + (3)\\left(-\\frac{4}{5}\\right)(10)\n$$\n$$\n= (2)(-9) + (3)(-8) = -18 - 24 = -42\n$$\nThe numerator is $qV - (-42) = 15 + 42 = 57$.\n\nThe outflow leakage term in the denominator is $\\sum_{\\text{outflow}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f$:\n$$\n(\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+x}) A_{+x} + (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-y}) A_{-y} = \\left(\\frac{3}{5}\\right)(15) + \\left(\\frac{4}{5}\\right)(10)\n$$\n$$\n= 9 + 8 = 17\n$$\nThe removal term in the denominator is $\\Sigma_t V = (\\frac{1}{3})(30) = 10$.\nThe denominator is $17 + 10 = 27$.\n\nFinally, the cell-average flux, which is equal to the outflow flux, is:\n$$\n\\psi_c = \\frac{57}{27}\n$$\nThis fraction can be simplified by dividing the numerator and denominator by $3$:\n$$\n\\psi_c = \\frac{19}{9}\n$$\nThe outflow angular flux is $\\frac{19}{9}\\,\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$.",
            "answer": "$$\n\\boxed{\\frac{19}{9}}\n$$"
        },
        {
            "introduction": "Moving from the theoretical cell balance equation to a robust transport solver requires a concrete algorithm for computing the net flow of particles. This practice () bridges that gap by guiding you through the implementation of the upwind finite volume logic for a polyhedral cell. This coding exercise is invaluable for appreciating the practical details of a transport sweep, such as identifying inflow and outflow faces based on geometry and assembling the components of the discretized equation.",
            "id": "4259437",
            "problem": "You are asked to implement a program that, for a polyhedral control volume in a discretized steady, monoenergetic Linear Boltzmann Transport Equation (LBTE) using the Discrete Ordinates (DO) method (also called $S_N$), identifies inflow faces and assembles the streaming contribution to the local residual using a first-order upwind Finite Volume (FV) discretization. The goal is to compute, for each given angular quadrature direction and each specified test case, the list of inflow faces and the corresponding scalar streaming residual for the cell. All computations are purely geometric and algebraic, and no physical units are required.\n\nStart from the fundamental streaming operator in the LBTE, where the angular flux $ \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $ satisfies the streaming term $ \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $. Integrate this term over a polyhedral control volume $ V_c $ with boundary $ \\partial V_c $ and apply the divergence theorem to obtain a surface integral. In a first-order upwind FV discretization in direction $ \\boldsymbol{\\Omega}_m $, the streaming contribution to the cell residual is obtained by summing over faces with appropriate upwind selection at each face.\n\nYou are given a convex polyhedral cell with faces indexed by $ f \\in \\{0,1,\\dots,F-1\\} $. Each face $ f $ has an outward unit normal vector $ \\mathbf{n}_f \\in \\mathbb{R}^3 $ and an area $ A_f \\in \\mathbb{R}_{>0} $. For each angular direction $ \\boldsymbol{\\Omega}_m \\in \\mathbb{R}^3 $ with $ \\lVert \\boldsymbol{\\Omega}_m \\rVert = 1 $, define the signed face direction cosine $ s_{mf} = \\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f $. A face $ f $ is inflow for direction $ m $ if $ s_{mf} &lt; 0 $, outflow if $ s_{mf} &gt; 0 $, and grazing if $ s_{mf} = 0 $. For numerical robustness, treat values with $ \\lvert s_{mf} \\rvert \\le \\varepsilon $ as grazing, with $ \\varepsilon = 10^{-12} $.\n\nFor a given cell and direction $ m $, define the upwind face angular flux $ \\psi_{f}^{\\text{upw}}(m) $ by:\n- If $ s_{mf} &lt; 0 $ and the face has a neighbor cell, use the neighbor’s angular flux $ \\psi_{\\text{nb}(f)}(m) $.\n- If $ s_{mf} &lt; 0 $ and the face is a boundary face, impose a vacuum boundary condition with incoming angular flux $ \\psi_{\\text{in}}(f,m) = 0 $.\n- If $ s_{mf} &gt; 0 $, use the cell’s own angular flux $ \\psi_c(m) $.\n- If $ \\lvert s_{mf} \\rvert \\le \\varepsilon $, contribute zero from that face.\n\nThe streaming contribution to the residual for the cell in direction $ m $ is the scalar\n$$\nR_{\\text{stream}}(c,m) \\;=\\; \\sum_{f=0}^{F-1} A_f \\, s_{mf} \\, \\psi_{f}^{\\text{upw}}(m).\n$$\n\nYou must implement this computation for the following test suite. In each case, report:\n- The list of inflow faces for each $ m $ as a list of zero-based face indices.\n- The scalar residual $ R_{\\text{stream}}(c,m) $ for each $ m $.\n\nYour program must aggregate results for all test cases into a single line of output containing a list. For each test case, output a two-element list $[\\text{inflow\\_lists}, \\text{residuals}]$, where:\n- $ \\text{inflow\\_lists} $ is a list whose $ m $-th element is the list of inflow face indices for direction $ m $.\n- $ \\text{residuals} $ is a list whose $ m $-th element is the float value of $ R_{\\text{stream}}(c,m) $.\n\nTherefore, the overall output must be a single line string representation of a list of test case results, for example $ [ [ [\\dots], [\\dots] ], [ [\\dots], [\\dots] ] ] $. All indices must be zero-based. All numbers in the output must be plain decimal numbers. No angles are used, so no angle unit specification is required.\n\nGeometry and data conventions for all cases:\n- Use a hexahedral control volume with $ F = 6 $ faces and outward unit normals ordered as $ [(-\\hat{\\mathbf{x}}), (+\\hat{\\mathbf{x}}), (-\\hat{\\mathbf{y}}), (+\\hat{\\mathbf{y}}), (-\\hat{\\mathbf{z}}), (+\\hat{\\mathbf{z}})] $, i.e.,\n  $ \\mathbf{n}_0 = (-1,0,0) $, $ \\mathbf{n}_1 = (1,0,0) $, $ \\mathbf{n}_2 = (0,-1,0) $, $ \\mathbf{n}_3 = (0,1,0) $, $ \\mathbf{n}_4 = (0,0,-1) $, $ \\mathbf{n}_5 = (0,0,1) $.\n- Use face areas $ A_f = 1 $ for all $ f \\in \\{0,1,2,3,4,5\\} $.\n- For faces marked as “neighbor,” you are given neighbor angular flux values $ \\psi_{\\text{nb}(f)}(m) $ for each direction $ m $. For faces marked as “boundary,” apply vacuum, i.e., $ \\psi_{\\text{in}}(f,m) = 0 $ for $ s_{mf} &lt; 0 $. For $ s_{mf} &gt; 0 $ always use the cell’s $ \\psi_c(m) $ irrespective of neighbor/boundary status, consistent with upwinding.\n\nTest suite:\n- Case $ 1 $ (general interior/boundary mix, two directions):\n  - Directions: $ \\boldsymbol{\\Omega}_0 = \\dfrac{(1,\\,0.2,\\,0.1)}{\\lVert (1,\\,0.2,\\,0.1) \\rVert} $, $ \\boldsymbol{\\Omega}_1 = (-0.8,\\,0.6,\\,0) $.\n  - Cell angular fluxes: $ \\psi_c(0) = 1.2 $, $ \\psi_c(1) = 0.7 $.\n  - Face neighbor availability (faces $ 0 $ to $ 5 $): $ [\\text{neighbor}, \\text{boundary}, \\text{neighbor}, \\text{neighbor}, \\text{boundary}, \\text{neighbor}] $.\n  - Neighbor angular fluxes per face for $ m \\in \\{0,1\\} $:\n    - Face $ 0 $: $ [2.0,\\,1.0] $.\n    - Face $ 1 $: none (boundary).\n    - Face $ 2 $: $ [1.5,\\,0.0] $.\n    - Face $ 3 $: $ [0.5,\\,2.0] $.\n    - Face $ 4 $: none (boundary).\n    - Face $ 5 $: $ [1.0,\\,3.0] $.\n- Case $ 2 $ (all boundary, vacuum, one direction):\n  - Direction: $ \\boldsymbol{\\Omega}_0 = \\dfrac{(1,\\,1,\\,1)}{\\lVert (1,\\,1,\\,1) \\rVert} $.\n  - Cell angular flux: $ \\psi_c(0) = 4.0 $.\n  - All faces boundary (no neighbors).\n- Case $ 3 $ (grazing faces present, one direction):\n  - Direction: $ \\boldsymbol{\\Omega}_0 = (0,\\,1,\\,0) $.\n  - Cell angular flux: $ \\psi_c(0) = 1.0 $.\n  - Face neighbor availability: only face $ 2 $ is a neighbor with neighbor angular flux $ [5.0] $, all other faces boundary.\n- Case $ 4 $ (near-grazing tolerance check, one direction):\n  - Direction: $ \\boldsymbol{\\Omega}_0 = \\dfrac{(1,\\,10^{-14},\\,0)}{\\lVert (1,\\,10^{-14},\\,0) \\rVert} $.\n  - Cell angular flux: $ \\psi_c(0) = 2.0 $.\n  - Face neighbor availability: only face $ 0 $ is a neighbor with neighbor angular flux $ [10.0] $, all other faces boundary.\n\nNumerical and algorithmic requirements:\n- Use a grazing tolerance $ \\varepsilon = 10^{-12} $ when classifying faces.\n- For each test case and each direction $ m $, compute:\n  - The list of inflow face indices where $ s_{mf} &lt; 0 $ and $ \\lvert s_{mf} \\rvert &gt; \\varepsilon $.\n  - The residual $ R_{\\text{stream}}(c,m) = \\sum_{f=0}^{5} A_f \\, s_{mf} \\, \\psi_{f}^{\\text{upw}}(m) $ with the upwind rule above and with $ A_f = 1 $.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself the two-element list $[\\text{inflow\\_lists}, \\text{residuals}]$ as described above. All indices must be zero-based, and all numbers must be printed as standard decimal literals without extraneous text.",
            "solution": "The problem requires the implementation of a numerical algorithm to compute the streaming contribution to the residual of a discretized cell in the context of the steady-state, monoenergetic Linear Boltzmann Transport Equation (LBTE). The discretization scheme is a first-order upwind Finite Volume (FV) method on a polyhedral mesh, using the Discrete Ordinates ($S_N$) approximation for the angular variable. I shall first derive the discretized equation from fundamental principles and then detail the computational procedure for the given test cases.\n\nThe steady-state, monoenergetic LBTE, in the absence of scattering and external sources, is described by the streaming operator acting on the angular neutron flux $ \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $:\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t(\\mathbf{r}) \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = 0\n$$\nwhere $ \\boldsymbol{\\Omega} $ is the direction of particle travel, $ \\mathbf{r} $ is the spatial position, and $ \\Sigma_t $ is the total macroscopic cross-section. The problem focuses exclusively on the streaming term, $ \\boldsymbol{\\Omega} \\cdot \\nabla \\psi $.\n\nIn the Finite Volume method, we integrate the equation over a control volume $ V_c $, which is a convex polyhedron in this case. The integral of the streaming term is:\n$$\n\\int_{V_c} \\boldsymbol{\\Omega} \\cdot \\nabla \\psi \\, dV\n$$\nApplying the Gauss-Ostrogradsky divergence theorem, we convert this volume integral into a surface integral over the boundary $ \\partial V_c $ of the cell:\n$$\n\\int_{V_c} \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) \\, dV = \\int_{\\partial V_c} (\\boldsymbol{\\Omega} \\psi) \\cdot \\mathbf{n} \\, dS\n$$\nwhere $ \\mathbf{n} $ is the outward unit normal vector on the surface $ \\partial V_c $. Since $ \\boldsymbol{\\Omega} $ is constant with respect to position, $ \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) = \\boldsymbol{\\Omega} \\cdot \\nabla \\psi $. The boundary of the polyhedron $ V_c $ consists of a set of flat faces, indexed by $ f \\in \\{0, 1, \\dots, F-1\\} $. The surface integral can thus be written as a sum of integrals over each face $ f $ with area $ A_f $:\n$$\n\\sum_{f=0}^{F-1} \\int_{A_f} \\psi(\\mathbf{r}_S, \\boldsymbol{\\Omega}) (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) \\, dS_f\n$$\nwhere $ \\mathbf{n}_f $ is the outward unit normal for face $ f $.\n\nIn the Discrete Ordinates ($S_N$) method, the continuous angular variable $ \\boldsymbol{\\Omega} $ is replaced by a discrete set of quadrature directions $ \\boldsymbol{\\Omega}_m $. For a specific direction $ \\boldsymbol{\\Omega}_m $, and assuming the angular flux is constant over each face, the sum becomes an algebraic expression. The face-averaged angular flux $ \\psi_f(m) $ is defined as $ \\psi_f(m) = \\frac{1}{A_f} \\int_{A_f} \\psi(\\mathbf{r}_S, \\boldsymbol{\\Omega}_m) \\, dS_f $. The expression is then approximated as:\n$$\n\\sum_{f=0}^{F-1} A_f (\\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f) \\psi_f(m)\n$$\nThis expression represents the net rate of particle streaming out of the control volume $ V_c $ in the direction $ \\boldsymbol{\\Omega}_m $.\n\nThe crucial step is to define the face-averaged flux $ \\psi_f(m) $. A first-order upwind scheme sets this flux based on the direction of flow relative to the face. The sign of the dot product $ s_{mf} = \\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f $ determines whether the \"flow\" is into or out of the cell.\n- If $ s_{mf} < 0 $, particles in direction $ \\boldsymbol{\\Omega}_m $ are entering $ V_c $ through face $ f $. This is an **inflow** face. The upwind principle dictates that the flux on the face is determined by the region from which the particles originate, which is the neighboring cell or the domain boundary. Thus, we set $ \\psi_f^{\\text{upw}}(m) $ to the angular flux of the neighbor cell, $ \\psi_{\\text{nb}(f)}(m) $, or to a specified incoming boundary flux, $ \\psi_{\\text{in}}(f,m) $. For vacuum boundary conditions, $ \\psi_{\\text{in}}(f,m) = 0 $.\n- If $ s_{mf} > 0 $, particles in direction $ \\boldsymbol{\\Omega}_m $ are leaving $ V_c $ through face $ f $. This is an **outflow** face. The upwind flux is determined by the region particles are leaving, which is the cell $ c $ itself. Therefore, we set $ \\psi_f^{\\text{upw}}(m) = \\psi_c(m) $, where $ \\psi_c(m) $ is the cell-averaged angular flux.\n- If $ s_{mf} = 0 $, the direction $ \\boldsymbol{\\Omega}_m $ is parallel to the face $ f $. This is a **grazing** face, and it does not contribute to the flux balance across the face. For numerical stability, a tolerance $ \\varepsilon > 0 $ is introduced. If $ |s_{mf}| \\le \\varepsilon $, the face is treated as grazing, and its contribution to the residual is zero.\n\nThe streaming contribution to the local residual for cell $ c $ and direction $ m $, denoted $ R_{\\text{stream}}(c,m) $, is the discretized net flow rate:\n$$\nR_{\\text{stream}}(c,m) = \\sum_{f=0}^{F-1} A_f \\, s_{mf} \\, \\psi_{f}^{\\text{upw}}(m)\n$$\nwhere the term for any grazing face is zero.\n\nThe computational procedure is as follows: For each test case, we are given the geometry (a hexahedron with specified face normals $ \\mathbf{n}_f $ and areas $ A_f=1 $), a set of angular directions $ \\boldsymbol{\\Omega}_m $, the cell-averaged angular fluxes $ \\psi_c(m) $, the status of each face (neighbor or boundary), and the angular fluxes in neighboring cells $ \\psi_{\\text{nb}(f)}(m) $.\n\nFor each given angular direction $ \\boldsymbol{\\Omega}_m $:\n1. Normalize the direction vector if it is not already a unit vector.\n2. Initialize the residual $ R_{\\text{stream}}(c,m) = 0 $ and an empty list for inflow face indices.\n3. For each face $ f \\in \\{0, 1, ..., 5\\} $:\n    a. Compute the signed direction cosine $ s_{mf} = \\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f $.\n    b. Check for grazing condition: If $ |s_{mf}| \\le \\varepsilon = 10^{-12} $, the contribution from this face is zero. Continue to the next face.\n    c. If $ s_{mf} < 0 $ (inflow):\n        i. Add face index $ f $ to the list of inflow faces.\n        ii. Determine the upwind flux $ \\psi_f^{\\text{upw}}(m) $. If face $ f $ is a boundary, $ \\psi_f^{\\text{upw}}(m) = 0 $. If it has a neighbor, $ \\psi_f^{\\text{upw}}(m) = \\psi_{\\text{nb}(f)}(m) $.\n    d. If $ s_{mf} > 0 $ (outflow):\n        i. The upwind flux is the cell's own flux: $ \\psi_f^{\\text{upw}}(m) = \\psi_c(m) $.\n    e. Add the face's contribution to the residual: $ R_{\\text{stream}}(c,m) \\leftarrow R_{\\text{stream}}(c,m) + A_f s_{mf} \\psi_f^{\\text{upw}}(m) $.\n4. After iterating through all faces, the final values for the list of inflow faces and the scalar residual $ R_{\\text{stream}}(c,m) $ are obtained. These are collected for all directions and all test cases to form the final result.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the streaming residual for a hexahedral cell for several test cases\n    using a first-order upwind Finite Volume Discrete Ordinates method.\n    \"\"\"\n\n    # Global geometric and numerical parameters\n    normals = np.array([\n        [-1.0, 0.0, 0.0],  # Face 0 (-x)\n        [1.0, 0.0, 0.0],   # Face 1 (+x)\n        [0.0, -1.0, 0.0],  # Face 2 (-y)\n        [0.0, 1.0, 0.0],   # Face 3 (+y)\n        [0.0, 0.0, -1.0],  # Face 4 (-z)\n        [0.0, 0.0, 1.0]    # Face 5 (+z)\n    ])\n    areas = np.ones(6)\n    epsilon = 1e-12\n\n    # Test suite data\n    test_cases = [\n        # Case 1: General interior/boundary mix\n        {\n            \"directions\": [np.array([1.0, 0.2, 0.1]), np.array([-0.8, 0.6, 0.0])],\n            \"cell_fluxes\": [1.2, 0.7],\n            \"face_types\": [\"neighbor\", \"boundary\", \"neighbor\", \"neighbor\", \"boundary\", \"neighbor\"],\n            \"neighbor_fluxes\": {\n                0: [2.0, 1.0],\n                2: [1.5, 0.0],\n                3: [0.5, 2.0],\n                5: [1.0, 3.0]\n            }\n        },\n        # Case 2: All boundary, vacuum\n        {\n            \"directions\": [np.array([1.0, 1.0, 1.0])],\n            \"cell_fluxes\": [4.0],\n            \"face_types\": [\"boundary\"] * 6,\n            \"neighbor_fluxes\": {}\n        },\n        # Case 3: Grazing faces\n        {\n            \"directions\": [np.array([0.0, 1.0, 0.0])],\n            \"cell_fluxes\": [1.0],\n            \"face_types\": [\"boundary\", \"boundary\", \"neighbor\", \"boundary\", \"boundary\", \"boundary\"],\n            \"neighbor_fluxes\": {2: [5.0]}\n        },\n        # Case 4: Near-grazing tolerance check\n        {\n            \"directions\": [np.array([1.0, 1e-14, 0.0])],\n            \"cell_fluxes\": [2.0],\n            \"face_types\": [\"neighbor\", \"boundary\", \"boundary\", \"boundary\", \"boundary\", \"boundary\"],\n            \"neighbor_fluxes\": {0: [10.0]}\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        case_inflow_lists = []\n        case_residuals = []\n        \n        directions = case[\"directions\"]\n        cell_fluxes = case[\"cell_fluxes\"]\n        face_types = case[\"face_types\"]\n        neighbor_fluxes = case[\"neighbor_fluxes\"]\n        \n        for m, dir_vec in enumerate(directions):\n            # Normalize the direction vector\n            norm = np.linalg.norm(dir_vec)\n            omega_m = dir_vec / norm if norm > 0 else dir_vec\n\n            inflow_faces = []\n            residual = 0.0\n            \n            for f in range(normals.shape[0]):\n                s_mf = np.dot(omega_m, normals[f])\n                \n                # Check for grazing faces\n                if abs(s_mf) = epsilon:\n                    continue\n                \n                psi_upw = 0.0\n                # Inflow face\n                if s_mf  0:\n                    inflow_faces.append(f)\n                    if face_types[f] == \"neighbor\":\n                        psi_upw = neighbor_fluxes[f][m]\n                    else: # Boundary face\n                        psi_upw = 0.0  # Vacuum boundary condition\n                # Outflow face\n                else: # s_mf > 0\n                    psi_upw = cell_fluxes[m]\n                \n                residual += areas[f] * s_mf * psi_upw\n            \n            case_inflow_lists.append(inflow_faces)\n            case_residuals.append(residual)\n            \n        all_results.append([case_inflow_lists, case_residuals])\n\n    # Final print statement must match the problem's specified format.\n    # The string representation of a list in Python matches the example format.\n    print(all_results)\n\nsolve()\n```"
        },
        {
            "introduction": "A transport simulation is defined not only by the physics within the domain but also by the conditions at its boundaries. A common and powerful technique in reactor analysis is to exploit symmetry, which is modeled with a specular reflective boundary condition. This exercise () walks through the first-principles derivation of this condition, showing how to relate the angular flux of particles leaving a boundary to those striking it, providing a deep understanding of how physical symmetries are encoded into a numerical transport algorithm.",
            "id": "4259471",
            "problem": "Consider steady-state, monoenergetic neutron transport in a three-dimensional unstructured polyhedral mesh representing a reactor core. Let $\\,\\psi(\\mathbf{r},\\boldsymbol{\\Omega})\\,$ denote the angular flux at position $\\,\\mathbf{r}\\,$ in direction $\\,\\boldsymbol{\\Omega}\\,$, where $\\,\\boldsymbol{\\Omega}\\,$ is a unit vector. The transport is discretized using the Discrete Ordinates ($S_N$) method with a direction set $\\{\\boldsymbol{\\Omega}_m\\}$ possessing reflection symmetry. A symmetry plane of the core is modeled as a perfectly specular reflective boundary. On such a boundary, microphysical interactions imply that the normal component of the neutron current is reversed while the tangential component is preserved for each collisionless reflection.\n\nLet $\\,\\mathbf{r}_b\\,$ lie on a boundary face with unit normal $\\,\\mathbf{n}_b\\,$ pointing into the computational domain. You are to derive, from first principles, the mapping of directions induced by specular reflection and show how this mapping enters the face-based upwind sweep on the unstructured mesh.\n\nStarting from the geometrical decomposition of $\\,\\boldsymbol{\\Omega}\\,$ into normal and tangential components relative to $\\,\\mathbf{n}_b\\,$, and using the physical characterization of a specular reflection at a smooth boundary, derive the closed-form expression for the reflected direction to be used in the boundary sweep for any incident direction $\\,\\boldsymbol{\\Omega}\\,$ with $\\,\\mathbf{n}_b\\cdot\\boldsymbol{\\Omega}0\\,$. Then, state the corresponding reflective boundary mapping for the angular flux $\\,\\psi(\\mathbf{r}_b,\\boldsymbol{\\Omega})\\,$ in terms of $\\,\\psi\\,$ evaluated at the reflected direction.\n\nYour final answer must be a single closed-form analytic expression for the reflected direction vector as a function of $\\,\\boldsymbol{\\Omega}\\,$ and $\\,\\mathbf{n}_b\\,$. Do not include any equality signs or units in your final answer. No rounding is required.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of neutron transport theory, well-posed with sufficient information for a unique derivation, and expressed in objective, formal language. We may proceed with the solution.\n\nThe problem asks for the derivation of the direction vector resulting from a specular reflection at a boundary, based on first principles. A specular, or mirror-like, reflection is defined physically by the conservation of the tangential component of the incident particle's momentum (and thus direction) and the reversal of its normal component. We are given an incident neutron direction, represented by the unit vector $\\boldsymbol{\\Omega}$, and a boundary face with an inward-pointing unit normal vector $\\mathbf{n}_b$.\n\nThe first step is to decompose the incident direction vector $\\boldsymbol{\\Omega}$ into its components parallel and perpendicular to the normal vector $\\mathbf{n}_b$. Let $\\boldsymbol{\\Omega}_n$ be the component of $\\boldsymbol{\\Omega}$ normal to the boundary (i.e., parallel to $\\mathbf{n}_b$) and $\\boldsymbol{\\Omega}_t$ be the component tangential to the boundary (i.e., perpendicular to $\\mathbf{n}_b$). The decomposition is:\n$$\n\\boldsymbol{\\Omega} = \\boldsymbol{\\Omega}_n + \\boldsymbol{\\Omega}_t\n$$\nThe normal component, $\\boldsymbol{\\Omega}_n$, is found by projecting $\\boldsymbol{\\Omega}$ onto the direction of the unit vector $\\mathbf{n}_b$. The formula for vector projection is:\n$$\n\\boldsymbol{\\Omega}_n = (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b) \\mathbf{n}_b\n$$\nThe tangential component, $\\boldsymbol{\\Omega}_t$, is the remainder of the vector $\\boldsymbol{\\Omega}$ after subtracting the normal component:\n$$\n\\boldsymbol{\\Omega}_t = \\boldsymbol{\\Omega} - \\boldsymbol{\\Omega}_n = \\boldsymbol{\\Omega} - (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b) \\mathbf{n}_b\n$$\nWe can verify that $\\boldsymbol{\\Omega}_t$ is indeed perpendicular to $\\mathbf{n}_b$ by taking their dot product:\n$$\n\\boldsymbol{\\Omega}_t \\cdot \\mathbf{n}_b = \\left(\\boldsymbol{\\Omega} - (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b)\\mathbf{n}_b\\right) \\cdot \\mathbf{n}_b = (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b) - (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b)(\\mathbf{n}_b \\cdot \\mathbf{n}_b)\n$$\nSince $\\mathbf{n}_b$ is a unit vector, $\\mathbf{n}_b \\cdot \\mathbf{n}_b = |\\mathbf{n}_b|^2 = 1$. The expression simplifies to:\n$$\n\\boldsymbol{\\Omega}_t \\cdot \\mathbf{n}_b = (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b) - (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b) = 0\n$$\nThis confirms that the decomposition is correct, with $\\boldsymbol{\\Omega}_n$ being parallel to $\\mathbf{n}_b$ and $\\boldsymbol{\\Omega}_t$ being perpendicular to $\\mathbf{n}_b$.\n\nNow, let $\\boldsymbol{\\Omega}'$ be the direction vector after reflection. It can also be decomposed into a new normal component $\\boldsymbol{\\Omega}'_n$ and a new tangential component $\\boldsymbol{\\Omega}'_t$. According to the physical characterization of specular reflection:\n1.  The normal component is reversed: $\\boldsymbol{\\Omega}'_n = -\\boldsymbol{\\Omega}_n$.\n2.  The tangential component is preserved: $\\boldsymbol{\\Omega}'_t = \\boldsymbol{\\Omega}_t$.\n\nWe can now construct the reflected vector $\\boldsymbol{\\Omega}'$:\n$$\n\\boldsymbol{\\Omega}' = \\boldsymbol{\\Omega}'_n + \\boldsymbol{\\Omega}'_t = -\\boldsymbol{\\Omega}_n + \\boldsymbol{\\Omega}_t\n$$\nSubstituting the expressions for $\\boldsymbol{\\Omega}_n$ and $\\boldsymbol{\\Omega}_t$ in terms of $\\boldsymbol{\\Omega}$ and $\\mathbf{n}_b$:\n$$\n\\boldsymbol{\\Omega}' = - \\left((\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b) \\mathbf{n}_b\\right) + \\left(\\boldsymbol{\\Omega} - (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b) \\mathbf{n}_b\\right)\n$$\nCombining terms, we arrive at the closed-form expression for the reflected direction:\n$$\n\\boldsymbol{\\Omega}' = \\boldsymbol{\\Omega} - 2(\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b)\\mathbf{n}_b\n$$\nThis is the required formula. The problem specifies that this applies to an incident direction $\\boldsymbol{\\Omega}$ with $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b  0$, which correctly identifies a neutron moving towards the boundary, since $\\mathbf{n}_b$ points into the domain. For such an incident $\\boldsymbol{\\Omega}$, the normal component of the reflected direction is $\\boldsymbol{\\Omega}' \\cdot \\mathbf{n}_b = -(\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b)  0$, confirming that the reflected neutron moves away from the boundary and back into the computational domain.\n\nNext, we address the reflective boundary mapping for the angular flux, $\\psi(\\mathbf{r}_b, \\boldsymbol{\\Omega})$. The physical meaning of a specular reflection is that neutrons incident on the boundary in direction $\\boldsymbol{\\Omega}$ are scattered into the reflected direction $\\boldsymbol{\\Omega}'$ without any change in number. This implies that the magnitude of the angular flux is conserved. Therefore, the angular flux at a boundary point $\\mathbf{r}_b$ in the outgoing direction $\\boldsymbol{\\Omega}'$ is equal to the angular flux at the same point in the corresponding incoming direction $\\boldsymbol{\\Omega}$. This relationship is expressed as:\n$$\n\\psi(\\mathbf{r}_b, \\boldsymbol{\\Omega}') = \\psi(\\mathbf{r}_b, \\boldsymbol{\\Omega}) \\quad \\text{for } \\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b  0\n$$\nwhere $\\boldsymbol{\\Omega}' = \\boldsymbol{\\Omega} - 2(\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b)\\mathbf{n}_b$.\n\nIn the context of a face-based upwind sweep on an unstructured mesh, this boundary condition provides the value of the flux for all outgoing directions at the boundary. For a discrete direction $\\boldsymbol{\\Omega}_m$ for which $\\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_b  0$ (an outgoing direction), the flux $\\psi(\\mathbf{r}_b, \\boldsymbol{\\Omega}_m)$ serves as an upwind boundary condition for the adjacent cell. This value is determined by finding the corresponding incoming direction $\\boldsymbol{\\Omega}_{m'}$ such that $\\boldsymbol{\\Omega}_m$ is the reflection of $\\boldsymbol{\\Omega}_{m'}$. The condition of reflection symmetry on the discrete ordinate set $\\{\\boldsymbol{\\Omega}_m\\}$ guarantees that if $\\boldsymbol{\\Omega}_{m'}$ is in the set, then its reflection $\\boldsymbol{\\Omega}_m$ is also in the set. The upwind boundary value is then set as $\\psi(\\mathbf{r}_b, \\boldsymbol{\\Omega}_m) = \\psi(\\mathbf{r}_b, \\boldsymbol{\\Omega}_{m'})$. The value $\\psi(\\mathbf{r}_b, \\boldsymbol{\\Omega}_{m'})$ becomes known as the sweep progresses, as it represents a flux leaving a cell and striking the boundary.",
            "answer": "$$\\boxed{\\boldsymbol{\\Omega} - 2(\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_b)\\mathbf{n}_b}$$"
        }
    ]
}