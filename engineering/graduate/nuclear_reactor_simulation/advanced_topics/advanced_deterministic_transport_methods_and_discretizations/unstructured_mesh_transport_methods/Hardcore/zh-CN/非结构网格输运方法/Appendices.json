{
    "hands_on_practices": [
        {
            "introduction": "在非结构网格输运方法中，有限体积法（FVM）是一个核心技术。本练习将指导您完成该方法的基石步骤：从连续的玻尔兹曼输运方程出发，通过在单个任意形状的控制体上进行积分，推导出离散的粒子平衡方程。这个过程清晰地揭示了物理守恒定律如何转化为计算机可以求解的代数关系，是理解输运代码内部工作原理的关键实践。",
            "id": "4259421",
            "problem": "考虑核反应堆模拟中离散纵标 (S$_N$) 公式下的一个稳态单能输运方向。设一个具有轴对齐面的凸六面体单元的边长分别为 $L_x$、$L_y$ 和 $L_z$，因此单元体积为 $V = L_x L_y L_z$，六个面的面积为 $A_{\\pm x} = L_y L_z$、$A_{\\pm y} = L_x L_z$ 和 $A_{\\pm z} = L_x L_y$。对于具有恒定总截面 $\\Sigma_t$ 和单位立体角上恒定的各向同性体积源 $q$ 的角通量 $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega})$，其稳态线性玻尔兹曼输运方程为\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = q.\n$$\n从此方程出发，对单元体积进行积分并应用散度定理，推导出一个离散的单元平衡方程，该方程将分段常数近似下的单元常数角通量与给定方向 $\\boldsymbol{\\Omega}$ 上每个面的流入和流出角通量联系起来。假设采用以下物理上一致的建模选择：\n- 分段常数近似将单元内部的 $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega})$ 设为单一常数 $\\psi_c(\\boldsymbol{\\Omega})$。\n- 在流出面（即 $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f > 0$ 的面，其中 $\\mathbf{n}_f$ 是面 $f$ 的外向单位法向量），面角通量等于单元值，即 $\\psi_f(\\boldsymbol{\\Omega}) = \\psi_c(\\boldsymbol{\\Omega})$。\n- 在流入面（即 $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f  0$ 的面），面角通量被指定为入射边界值 $\\psi_{f,\\text{in}}(\\boldsymbol{\\Omega})$。\n\n然后，对于一个具体的六面体单元，其 $L_x = 2\\,\\text{cm}$，$L_y = 3\\,\\text{cm}$，$L_z = 5\\,\\text{cm}$，方向为 $\\boldsymbol{\\Omega} = \\left(\\frac{3}{5}, -\\frac{4}{5}, 0\\right)$，总截面为 $\\Sigma_t = \\frac{1}{3}\\,\\text{cm}^{-1}$，各向同性源为 $q = \\frac{1}{2}\\,\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$，设入射（流入）角通量为\n$$\n\\psi_{-x,\\text{in}}(\\boldsymbol{\\Omega}) = 2\\,\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}, \\quad\n\\psi_{+y,\\text{in}}(\\boldsymbol{\\Omega}) = 3\\,\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1},\n$$\n在此方向上，其余面没有其他流入。使用推导出的离散平衡方程，计算该单元和方向的流出角通量，注意分段常数近似使得所有流出面上的流出角通量相等。以中子/平方厘米·秒·球面度为单位表示最终答案。无需四舍五入；请提供精确值。",
            "solution": "该问题是有效的，因为它科学地基于中性粒子输运原理，信息充分，具有唯一解，且陈述客观。\n\n出发点是在具有恒定总截面 $\\Sigma_t$ 和单位立体角上恒定的各向同性体积源 $q$ 的介质中，角通量 $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega})$ 的稳态、单能、线性玻尔兹曼输运方程：\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = q\n$$\n这里，$\\mathbf{r}$ 是位置矢量，$\\boldsymbol{\\Omega}$ 是粒子行进的方向。\n\n为推导离散单元平衡方程，我们将此方程对单个凸六面体单元的体积 $V$ 进行积分：\n$$\n\\int_V (\\boldsymbol{\\Omega} \\cdot \\nabla \\psi) dV + \\int_V \\Sigma_t \\psi dV = \\int_V q dV\n$$\n由于对于给定的离散纵标方向 $\\boldsymbol{\\Omega}$ 是恒定的，第一项可以使用散度的乘积法则重写，$\\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) = (\\nabla \\cdot \\boldsymbol{\\Omega}) \\psi + \\boldsymbol{\\Omega} \\cdot \\nabla \\psi$。因为 $\\boldsymbol{\\Omega}$ 是一个常数矢量，所以 $\\nabla \\cdot \\boldsymbol{\\Omega} = 0$，因此 $\\boldsymbol{\\Omega} \\cdot \\nabla \\psi = \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi)$。对此项应用散度定理可得：\n$$\n\\int_V \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) dV = \\oint_{\\partial V} (\\boldsymbol{\\Omega} \\psi) \\cdot \\mathbf{n} dS = \\sum_{f=1}^{6} \\int_{A_f} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) dA\n$$\n其中 $\\partial V$ 是单元的边界，由 6 个面组成。对于每个面 $f$，$A_f$ 是其面积，$\\mathbf{n}_f$ 是其外向单位法向量，$\\psi_f$ 是该面上的角通量。\n\n现在我们应用分段常数近似。在单元内部，角通量被假定为一个常数值，$\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = \\psi_c(\\boldsymbol{\\Omega})$。源 $q$ 和截面 $\\Sigma_t$ 也是恒定的。因此，体积积分变为：\n$$\n\\int_V \\Sigma_t \\psi dV = \\Sigma_t \\psi_c V\n$$\n$$\n\\int_V q dV = q V\n$$\n在每个面 $f$ 上，通量 $\\psi_f$ 也被假定在整个面面积上是恒定的。于是面积分简化为：\n$$\n\\sum_{f=1}^{6} \\int_{A_f} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) dA = \\sum_{f=1}^{6} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f\n$$\n将这些表达式代回积分后的输运方程，得到平衡方程：\n$$\n\\sum_{f=1}^{6} \\psi_f (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t \\psi_c V = q V\n$$\n接下来，我们利用流入和流出条件。面的集合被划分为流出面（其中 $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f > 0$）、流入面（其中 $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f  0$）以及可能的擦过面（其中 $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f = 0$）。对于擦过面，其对求和的贡献为零。\n- 对于流出面，通量设为单元平均值：$\\psi_f = \\psi_c$。\n- 对于流入面，通量是一个指定的边界条件：$\\psi_f = \\psi_{f,\\text{in}}$。\n\n对所有面的求和可以相应地拆分：\n$$\n\\sum_{\\text{outflow}} \\psi_c (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t \\psi_c V = q V\n$$\n我们现在可以解出未知的单元平均通量 $\\psi_c$：\n$$\n\\psi_c \\left( \\sum_{\\text{outflow}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t V \\right) = q V - \\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f\n$$\n$$\n\\psi_c = \\frac{q V - \\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f}{\\sum_{\\text{outflow}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f + \\Sigma_t V}\n$$\n问题要求的是流出角通量，在给定的近似下，它等于 $\\psi_c$。\n\n现在我们将此公式应用于具体情况。单元尺寸为 $L_x = 2\\,\\text{cm}$，$L_y = 3\\,\\text{cm}$，$L_z = 5\\,\\text{cm}$。\n单元体积为 $V = L_x L_y L_z = (2)(3)(5) = 30\\,\\text{cm}^3$。\n面面积为 $A_x = L_y L_z = (3)(5) = 15\\,\\text{cm}^2$，$A_y = L_x L_z = (2)(5) = 10\\,\\text{cm}^2$，$A_z = L_x L_y = (2)(3) = 6\\,\\text{cm}^2$。\n方向为 $\\boldsymbol{\\Omega} = (\\Omega_x, \\Omega_y, \\Omega_z) = \\left(\\frac{3}{5}, -\\frac{4}{5}, 0\\right)$。\n物理常数为 $\\Sigma_t = \\frac{1}{3}\\,\\text{cm}^{-1}$ 和 $q = \\frac{1}{2}\\,\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$。\n\n我们必须通过检查 $\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f$ 的符号来确定流入和流出面：\n- 位于 $x = -L_x/2$ 的面（$-x$ 面）：$\\mathbf{n}_{-x} = (-1, 0, 0)$。$\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-x} = -\\frac{3}{5}  0$。这是一个流入面。\n- 位于 $x = +L_x/2$ 的面（$+x$ 面）：$\\mathbf{n}_{+x} = (1, 0, 0)$。$\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+x} = +\\frac{3}{5} > 0$。这是一个流出面。\n- 位于 $y = -L_y/2$ 的面（$-y$ 面）：$\\mathbf{n}_{-y} = (0, -1, 0)$。$\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-y} = +\\frac{4}{5} > 0$。这是一个流出面。\n- 位于 $y = +L_y/2$ 的面（$+y$ 面）：$\\mathbf{n}_{+y} = (0, 1, 0)$。$\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+y} = -\\frac{4}{5}  0$。这是一个流入面。\n- 位于 $z = \\pm L_z/2$ 的面（$\\pm z$ 面）：$\\mathbf{n}_{\\pm z} = (0, 0, \\pm 1)$。$\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{\\pm z} = 0$。这些是擦过面，对泄漏项求和没有贡献。\n\n给定的流入角通量为 $\\psi_{-x,\\text{in}} = 2$ 和 $\\psi_{+y,\\text{in}} = 3$，单位为 $\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$。\n\n我们现在可以计算 $\\psi_c$ 表达式中的各项：\n分子中的源项是 $qV = (\\frac{1}{2})(30) = 15$。\n流入泄漏项是 $\\sum_{\\text{inflow}} \\psi_{f,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f$：\n$$\n\\psi_{-x,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-x}) A_{-x} + \\psi_{+y,\\text{in}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+y}) A_{+y} = (2)\\left(-\\frac{3}{5}\\right)(15) + (3)\\left(-\\frac{4}{5}\\right)(10)\n$$\n$$\n= (2)(-9) + (3)(-8) = -18 - 24 = -42\n$$\n分子是 $qV - (-42) = 15 + 42 = 57$。\n\n分母中的流出泄漏项是 $\\sum_{\\text{outflow}} (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) A_f$：\n$$\n(\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{+x}) A_{+x} + (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_{-y}) A_{-y} = \\left(\\frac{3}{5}\\right)(15) + \\left(\\frac{4}{5}\\right)(10)\n$$\n$$\n= 9 + 8 = 17\n$$\n分母中的移出项是 $\\Sigma_t V = (\\frac{1}{3})(30) = 10$。\n分母是 $17 + 10 = 27$。\n\n最后，等于流出通量的单元平均通量是：\n$$\n\\psi_c = \\frac{57}{27}\n$$\n这个分数可以通过分子分母同时除以 $3$ 来简化：\n$$\n\\psi_c = \\frac{19}{9}\n$$\n流出角通量是 $\\frac{19}{9}\\,\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}\\,\\text{sr}^{-1}$。",
            "answer": "$$\n\\boxed{\\frac{19}{9}}\n$$"
        },
        {
            "introduction": "与有限体积法并行的另一种强大技术是有限元法（FEM）。本练习将深入探讨FEM的核心机制，要求您在一个典型的非结构网格单元——四面体上，执行一项基本计算。您将使用等参映射和形函数来计算线性标量通量场的梯度，并最终得到流项 $\\boldsymbol{\\Omega}\\cdot\\nabla \\psi$ 的值，这是构建完整有限元系统矩阵的关键组成部分。",
            "id": "4259428",
            "problem": "在三维非结构化网格的稳态中子输运方程的输运离散化中，离散纵标法（SN）中沿离散方向的流项由 $\\boldsymbol{\\Omega}\\cdot\\nabla \\psi$ 给出，其中 $\\psi$ 在每个单元内通过由节点值和线性基函数构成的线性有限元场来近似。考虑一个四面体单元，其顶点物理坐标为\n$$(x_{1},y_{1},z_{1})=(0,0,0),\\quad (x_{2},y_{2},z_{2})=(2,0,0),\\quad (x_{3},y_{3},z_{3})=(0,1,0),\\quad (x_{4},y_{4},z_{4})=(0,0,3),$$\n其中所有距离单位均为 $\\mathrm{cm}$。设标量通量的线性有限元近似为\n$$\\psi(\\boldsymbol{x})=\\sum_{i=1}^{4} N_{i}(\\boldsymbol{x})\\,\\psi_{i},$$\n节点值为 $\\psi_{1}=1.3$，$\\psi_{2}=2.4$，$\\psi_{3}=1.8$ 和 $\\psi_{4}=0.7$（无量纲）。局部线性基函数 $N_{i}(\\boldsymbol{x})$ 是标准的 $P_{1}$ 四面体形函数。\n\n使用具有坐标 $(\\hat{r},\\hat{s},\\hat{t})$ 的参考四面体和到物理单元的标准等参映射，从第一性原理推导出单元内的常数梯度 $\\nabla N_{i}$，然后针对离散纵标方向\n$$\\boldsymbol{\\Omega}=\\frac{1}{\\sqrt{14}}\\,(1,2,3),$$\n（这是一个单位向量）计算单元内各处的流算子 $\\boldsymbol{\\Omega}\\cdot\\nabla\\psi$。\n\n将你的最终结果以一个实数形式报告，该数值等于 $\\boldsymbol{\\Omega}\\cdot\\nabla\\psi$ 的值，单位为 $\\mathrm{cm}^{-1}$。将你的答案四舍五入到四位有效数字。最终答案以 $\\mathrm{cm}^{-1}$ 表示。",
            "solution": "目标是计算量 $\\boldsymbol{\\Omega}\\cdot\\nabla \\psi$。由于标量通量 $\\psi$ 是由线性有限元场近似的，其梯度 $\\nabla\\psi$ 在整个单元内是恒定的。梯度由下式给出：\n$$ \\nabla\\psi = \\nabla \\left( \\sum_{i=1}^{4} N_{i}(\\boldsymbol{x})\\,\\psi_{i} \\right) = \\sum_{i=1}^{4} \\left( \\nabla N_{i}(\\boldsymbol{x}) \\right) \\psi_{i} $$\n其中 $\\psi_i$ 是恒定的节点值，$\\nabla N_i$ 是线性基函数的恒定梯度。任务的核心是找到这些梯度。根据要求，这将使用从参考单元的等参映射，从第一性原理完成。\n\n假设参考四面体存在于坐标系 $(\\hat{r}, \\hat{s}, \\hat{t})$ 中。标准的参考四面体顶点位于 $(0,0,0)$、$(1,0,0)$、$(0,1,0)$ 和 $(0,0,1)$。在此参考单元上的线性基函数为：\n$$ \\hat{N}_1(\\hat{r}, \\hat{s}, \\hat{t}) = 1 - \\hat{r} - \\hat{s} - \\hat{t} $$\n$$ \\hat{N}_2(\\hat{r}, \\hat{s}, \\hat{t}) = \\hat{r} $$\n$$ \\hat{N}_3(\\hat{r}, \\hat{s}, \\hat{t}) = \\hat{s} $$\n$$ \\hat{N}_4(\\hat{r}, \\hat{s}, \\hat{t}) = \\hat{t} $$\n这些函数相对于参考坐标 $\\boldsymbol{\\hat{x}} = (\\hat{r}, \\hat{s}, \\hat{t})$ 的梯度是：\n$$ \\nabla_{\\hat{x}} \\hat{N}_1 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix}, \\quad \\nabla_{\\hat{x}} \\hat{N}_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\nabla_{\\hat{x}} \\hat{N}_3 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad \\nabla_{\\hat{x}} \\hat{N}_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} $$\n等参映射使用相同的基函数将物理坐标 $\\boldsymbol{x}=(x,y,z)$ 与参考坐标 $\\boldsymbol{\\hat{x}}=(\\hat{r},\\hat{s},\\hat{t})$ 关联起来：\n$$ \\boldsymbol{x}(\\boldsymbol{\\hat{x}}) = \\sum_{i=1}^{4} \\hat{N}_i(\\boldsymbol{\\hat{x}}) \\boldsymbol{x}_i $$\n代入给定的顶点坐标 $\\boldsymbol{x}_{1}=(0,0,0)$、$\\boldsymbol{x}_{2}=(2,0,0)$、$\\boldsymbol{x}_{3}=(0,1,0)$ 和 $\\boldsymbol{x}_{4}=(0,0,3)$：\n$$ \\boldsymbol{x} = (1 - \\hat{r} - \\hat{s} - \\hat{t})\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\hat{r}\\begin{pmatrix} 2 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\hat{s}\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} + \\hat{t}\\begin{pmatrix} 0 \\\\ 0 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} 2\\hat{r} \\\\ 1\\hat{s} \\\\ 3\\hat{t} \\end{pmatrix} $$\n因此，变换为 $x=2\\hat{r}$，$y=\\hat{s}$，$z=3\\hat{t}$。此变换的雅可比矩阵 $J$ 为：\n$$ J = \\frac{\\partial \\boldsymbol{x}}{\\partial \\boldsymbol{\\hat{x}}} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\hat{r}}  \\frac{\\partial x}{\\partial \\hat{s}}  \\frac{\\partial x}{\\partial \\hat{t}} \\\\ \\frac{\\partial y}{\\partial \\hat{r}}  \\frac{\\partial y}{\\partial \\hat{s}}  \\frac{\\partial y}{\\partial \\hat{t}} \\\\ \\frac{\\partial z}{\\partial \\hat{r}}  \\frac{\\partial z}{\\partial \\hat{s}}  \\frac{\\partial z}{\\partial \\hat{t}} \\end{pmatrix} = \\begin{pmatrix} 2  0  0 \\\\ 0  1  0 \\\\ 0  0  3 \\end{pmatrix} $$\n物理坐标系中的梯度 $\\nabla_{x} N_i$ 通过链式法则与参考坐标系中的梯度 $\\nabla_{\\hat{x}} \\hat{N}_i$ 相关：$\\nabla_{\\hat{x}} = J^T \\nabla_{x}$。为求物理梯度重新整理得到 $\\nabla_{x} = (J^T)^{-1} \\nabla_{\\hat{x}}$。由于 $N_i(\\boldsymbol{x}(\\boldsymbol{\\hat{x}})) = \\hat{N}_i(\\boldsymbol{\\hat{x}})$，我们有：\n$$ \\nabla_{x} N_i = (J^T)^{-1} \\nabla_{\\hat{x}} \\hat{N}_i $$\n雅可比矩阵 $J$ 是对角矩阵，因此其转置 $J^T$ 与其本身相同，其逆矩阵也很容易求得：\n$$ J^T = \\begin{pmatrix} 2  0  0 \\\\ 0  1  0 \\\\ 0  0  3 \\end{pmatrix}, \\qquad (J^T)^{-1} = \\begin{pmatrix} 1/2  0  0 \\\\ 0  1  0 \\\\ 0  0  1/3 \\end{pmatrix} $$\n现在我们可以计算物理梯度 $\\nabla N_i \\equiv \\nabla_{x} N_i$：\n$$ \\nabla N_1 = (J^T)^{-1} \\nabla_{\\hat{x}} \\hat{N}_1 = \\begin{pmatrix} 1/2  0  0 \\\\ 0  1  0 \\\\ 0  0  1/3 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1/2 \\\\ -1 \\\\ -1/3 \\end{pmatrix} $$\n$$ \\nabla N_2 = (J^T)^{-1} \\nabla_{\\hat{x}} \\hat{N}_2 = \\begin{pmatrix} 1/2  0  0 \\\\ 0  1  0 \\\\ 0  0  1/3 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1/2 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\n$$ \\nabla N_3 = (J^T)^{-1} \\nabla_{\\hat{x}} \\hat{N}_3 = \\begin{pmatrix} 1/2  0  0 \\\\ 0  1  0 \\\\ 0  0  1/3 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} $$\n$$ \\nabla N_4 = (J^T)^{-1} \\nabla_{\\hat{x}} \\hat{N}_4 = \\begin{pmatrix} 1/2  0  0 \\\\ 0  1  0 \\\\ 0  0  1/3 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1/3 \\end{pmatrix} $$\n利用梯度 $\\nabla N_i$ 和节点通量值 $\\psi_1=1.3$，$\\psi_2=2.4$，$\\psi_3=1.8$ 和 $\\psi_4=0.7$，我们可以计算标量通量场的常数梯度 $\\nabla \\psi$：\n$$ \\nabla\\psi = \\psi_1 \\nabla N_1 + \\psi_2 \\nabla N_2 + \\psi_3 \\nabla N_3 + \\psi_4 \\nabla N_4 $$\n$$ \\nabla\\psi = 1.3 \\begin{pmatrix} -1/2 \\\\ -1 \\\\ -1/3 \\end{pmatrix} + 2.4 \\begin{pmatrix} 1/2 \\\\ 0 \\\\ 0 \\end{pmatrix} + 1.8 \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} + 0.7 \\begin{pmatrix} 0 \\\\ 0 \\\\ 1/3 \\end{pmatrix} $$\n$\\nabla\\psi$ 的分量是：\n$$ (\\nabla\\psi)_x = 1.3(-0.5) + 2.4(0.5) = -0.65 + 1.2 = 0.55 $$\n$$ (\\nabla\\psi)_y = 1.3(-1) + 1.8(1) = -1.3 + 1.8 = 0.5 $$\n$$ (\\nabla\\psi)_z = 1.3(-1/3) + 0.7(1/3) = \\frac{-1.3 + 0.7}{3} = \\frac{-0.6}{3} = -0.2 $$\n所以，标量通量的梯度为 $\\nabla\\psi = (0.55, 0.5, -0.2)$，单位为 $\\mathrm{cm}^{-1}$。\n最后，我们计算与离散方向 $\\boldsymbol{\\Omega}=\\frac{1}{\\sqrt{14}}\\,(1,2,3)$ 的点积：\n$$ \\boldsymbol{\\Omega}\\cdot\\nabla\\psi = \\frac{1}{\\sqrt{14}} \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} \\cdot \\begin{pmatrix} 0.55 \\\\ 0.5 \\\\ -0.2 \\end{pmatrix} $$\n$$ \\boldsymbol{\\Omega}\\cdot\\nabla\\psi = \\frac{1}{\\sqrt{14}} \\left( (1)(0.55) + (2)(0.5) + (3)(-0.2) \\right) $$\n$$ \\boldsymbol{\\Omega}\\cdot\\nabla\\psi = \\frac{1}{\\sqrt{14}} \\left( 0.55 + 1.0 - 0.6 \\right) $$\n$$ \\boldsymbol{\\Omega}\\cdot\\nabla\\psi = \\frac{0.95}{\\sqrt{14}} $$\n现在，我们对此表达式进行数值计算，并四舍五入到四位有效数字：\n$$ \\boldsymbol{\\Omega}\\cdot\\nabla\\psi \\approx \\frac{0.95}{3.74165738677...} \\approx 0.2539006... $$\n四舍五入到四位有效数字，结果是 $0.2539$。单位是 $\\mathrm{cm}^{-1}$，因为 $\\psi$ 是无量纲的，而梯度是相对于以 $\\mathrm{cm}$ 为单位的空间坐标。",
            "answer": "$$\n\\boxed{0.2539}\n$$"
        },
        {
            "introduction": "在理论推导和单元计算之后，下一步是将其转化为实际的算法。本练习是一个面向编程的实践，旨在模拟输运扫描（transport sweep）的核心逻辑。您将为一个多面体单元编写算法，以根据给定的中子飞行方向，准确识别哪些面是入流面，哪些是出流面，并根据一阶迎风格式组装流项的局部残差，这是任何离散纵标法（$S_N$）输运程序的核心功能。",
            "id": "4259437",
            "problem": "你需要实现一个程序，该程序针对采用离散纵标（DO）方法（也称为 $S_N$）离散化的稳态、单能线性玻尔兹曼输运方程（LBTE）中的一个多面体控制体，使用一阶迎风有限体积（FV）离散格式来识别入流面，并组装对局部残差的流输运贡献。目标是为每个给定的角求积方向和每个指定的测试用例，计算出该单元的入流面列表以及相应的标量流输运残差。所有计算都纯粹是几何和代数的，不需要物理单位。\n\n从 LBTE 中基本的流输运算子开始，其中角通量 $ \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $ 满足流输运项 $ \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $。将此项在一个边界为 $ \\partial V_c $ 的多面体控制体 $ V_c $ 上积分，并应用散度定理以获得面积分。在方向 $ \\boldsymbol{\\Omega}_m $ 上的一阶迎风 FV 离散格式中，对单元残差的流输运贡献是通过对所有面进行求和得到的，并在每个面上进行适当的迎风选择。\n\n给定一个凸多面体单元，其面索引为 $ f \\in \\{0,1,\\dots,F-1\\} $。每个面 $ f $ 都有一个外向单位法向量 $ \\mathbf{n}_f \\in \\mathbb{R}^3 $ 和一个面积 $ A_f \\in \\mathbb{R}_{0} $。对于每个角方向 $ \\boldsymbol{\\Omega}_m \\in \\mathbb{R}^3 $ 且 $ \\lVert \\boldsymbol{\\Omega}_m \\rVert = 1 $，定义带符号的面方向余弦 $ s_{mf} = \\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f $。如果 $ s_{mf}  0 $，则面 $ f $ 是方向 $ m $ 的入流面；如果 $ s_{mf}  0 $，则是出流面；如果 $ s_{mf} = 0 $，则是掠射面。为了数值稳健性，将 $ \\lvert s_{mf} \\rvert \\le \\varepsilon $ 的值视为掠射，其中 $ \\varepsilon = 10^{-12} $。\n\n对于给定的单元和方向 $ m $，按如下方式定义迎风面角通量 $ \\psi_{f}^{\\text{upw}}(m) $：\n- 如果 $ s_{mf}  0 $ 且该面有相邻单元，则使用相邻单元的角通量 $ \\psi_{\\text{nb}(f)}(m) $。\n- 如果 $ s_{mf}  0 $ 且该面是边界面，则施加真空边界条件，入射角通量为 $ \\psi_{\\text{in}}(f,m) = 0 $。\n- 如果 $ s_{mf}  0 $，则使用单元自身的角通量 $ \\psi_c(m) $。\n- 如果 $ \\lvert s_{mf} \\rvert \\le \\varepsilon $，则该面的贡献为零。\n\n单元在方向 $ m $ 上的流输运残差贡献是标量\n$$\nR_{\\text{stream}}(c,m) \\;=\\; \\sum_{f=0}^{F-1} A_f \\, s_{mf} \\, \\psi_{f}^{\\text{upw}}(m).\n$$\n\n你必须为以下测试套件实现此计算。在每种情况下，报告：\n- 每个 $ m $ 的入流面列表，表示为从零开始的面索引列表。\n- 每个 $ m $ 的标量残差 $ R_{\\text{stream}}(c,m) $。\n\n你的程序必须将所有测试用例的结果汇总到包含一个列表的单行输出中。对于每个测试用例，输出一个双元素列表 $[\\text{inflow\\_lists}, \\text{residuals}]$，其中：\n- $ \\text{inflow\\_lists} $ 是一个列表，其第 $ m $ 个元素是方向 $ m $ 的入流面索引列表。\n- $ \\text{residuals} $ 是一个列表，其第 $ m $ 个元素是 $ R_{\\text{stream}}(c,m) $ 的浮点值。\n\n因此，总输出必须是一个表示测试用例结果列表的单行字符串，例如 $ [ [ [\\dots], [\\dots] ], [ [\\dots], [\\dots] ] ] $。所有索引必须从零开始。输出中的所有数字必须是纯十进制数。不使用角度，因此不需要指定角度单位。\n\n所有用例的几何和数据约定：\n- 使用一个具有 $ F = 6 $ 个面的六面体控制体，其外向单位法线按 $ [(-\\hat{\\mathbf{x}}), (+\\hat{\\mathbf{x}}), (-\\hat{\\mathbf{y}}), (+\\hat{\\mathbf{y}}), (-\\hat{\\mathbf{z}}), (+\\hat{\\mathbf{z}})] $ 顺序排列，即\n  $ \\mathbf{n}_0 = (-1,0,0) $，$ \\mathbf{n}_1 = (1,0,0) $，$ \\mathbf{n}_2 = (0,-1,0) $，$ \\mathbf{n}_3 = (0,1,0) $，$ \\mathbf{n}_4 = (0,0,-1) $，$ \\mathbf{n}_5 = (0,0,1) $。\n- 对所有 $ f \\in \\{0,1,2,3,4,5\\} $，使用面面积 $ A_f = 1 $。\n- 对于标记为“neighbor”的面，会给出每个方向 $ m $ 的相邻角通量值 $ \\psi_{\\text{nb}(f)}(m) $。对于标记为“boundary”的面，应用真空条件，即对于 $ s_{mf}  0 $，$ \\psi_{\\text{in}}(f,m) = 0 $。对于 $ s_{mf}  0 $，始终使用单元的 $ \\psi_c(m) $，无论其是相邻面还是边界面，这与迎风格式一致。\n\n测试套件：\n- 用例 $ 1 $ （通用内部/边界混合，两个方向）：\n  - 方向：$ \\boldsymbol{\\Omega}_0 = \\dfrac{(1,\\,0.2,\\,0.1)}{\\lVert (1,\\,0.2,\\,0.1) \\rVert} $，$ \\boldsymbol{\\Omega}_1 = (-0.8,\\,0.6,\\,0) $。\n  - 单元角通量：$ \\psi_c(0) = 1.2 $，$ \\psi_c(1) = 0.7 $。\n  - 面相邻情况（面 $ 0 $ 到 $ 5 $）：$ [\\text{neighbor}, \\text{boundary}, \\text{neighbor}, \\text{neighbor}, \\text{boundary}, \\text{neighbor}] $。\n  - 每个面对于 $ m \\in \\{0,1\\} $ 的相邻角通量：\n    - 面 $ 0 $：$ [2.0,\\,1.0] $。\n    - 面 $ 1 $：无（边界）。\n    - 面 $ 2 $：$ [1.5,\\,0.0] $。\n    - 面 $ 3 $：$ [0.5,\\,2.0] $。\n    - 面 $ 4 $：无（边界）。\n    - 面 $ 5 $：$ [1.0,\\,3.0] $。\n- 用例 $ 2 $ （全边界、真空、一个方向）：\n  - 方向：$ \\boldsymbol{\\Omega}_0 = \\dfrac{(1,\\,1,\\,1)}{\\lVert (1,\\,1,\\,1) \\rVert} $。\n  - 单元角通量：$ \\psi_c(0) = 4.0 $。\n  - 所有面均为边界（无相邻单元）。\n- 用例 $ 3 $ （存在掠射面、一个方向）：\n  - 方向：$ \\boldsymbol{\\Omega}_0 = (0,\\,1,\\,0) $。\n  - 单元角通量：$ \\psi_c(0) = 1.0 $。\n  - 面相邻情况：只有面 $ 2 $ 是相邻面，相邻角通量为 $ [5.0] $，所有其他面均为边界。\n- 用例 $ 4 $ （近掠射容差检查、一个方向）：\n  - 方向：$ \\boldsymbol{\\Omega}_0 = \\dfrac{(1,\\,10^{-14},\\,0)}{\\lVert (1,\\,10^{-14},\\,0) \\rVert} $。\n  - 单元角通量：$ \\psi_c(0) = 2.0 $。\n  - 面相邻情况：只有面 $ 0 $ 是相邻面，相邻角通量为 $ [10.0] $，所有其他面均为边界。\n\n数值和算法要求：\n- 在对面进行分类时，使用掠射容差 $ \\varepsilon = 10^{-12} $。\n- 对于每个测试用例和每个方向 $ m $，计算：\n  - 入流面索引列表，其中 $ s_{mf}  0 $ 且 $ \\lvert s_{mf} \\rvert  \\varepsilon $。\n  - 残差 $ R_{\\text{stream}}(c,m) = \\sum_{f=0}^{5} A_f \\, s_{mf} \\, \\psi_{f}^{\\text{upw}}(m) $，使用上述迎风规则且 $ A_f = 1 $。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是如上所述的双元素列表 $[\\text{inflow\\_lists}, \\text{residuals}]$。所有索引必须从零开始，所有数字必须打印为标准十进制字面量，不带多余文本。",
            "solution": "该问题要求实现一个数值算法，用于在稳态、单能线性玻尔兹曼输运方程（LBTE）的背景下，计算一个离散化单元的流输运残差贡献。离散格式是在多面体网格上的一阶迎风有限体积（FV）方法，并使用离seman纵标（$S_N$）近似来处理角变量。我将首先从基本原理推导离散化方程，然后详细说明针对给定测试用例的计算步骤。\n\n在没有散射和外源的情况下，稳态、单能 LBTE 由作用于角中子通量 $ \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $ 的流输运算子描述：\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t(\\mathbf{r}) \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = 0\n$$\n其中 $ \\boldsymbol{\\Omega} $ 是粒子行进的方向，$ \\mathbf{r} $ 是空间位置，$ \\Sigma_t $ 是总宏观截面。该问题仅关注流输运项 $ \\boldsymbol{\\Omega} \\cdot \\nabla \\psi $。\n\n在有限体积法中，我们在一个控制体 $ V_c $（本例中为凸多面体）上对该方程进行积分。流输运项的积分为：\n$$\n\\int_{V_c} \\boldsymbol{\\Omega} \\cdot \\nabla \\psi \\, dV\n$$\n应用高斯-奥斯特罗格拉德斯基散度定理，我们将此体积分转换为在单元边界 $ \\partial V_c $ 上的面积分：\n$$\n\\int_{V_c} \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) \\, dV = \\int_{\\partial V_c} (\\boldsymbol{\\Omega} \\psi) \\cdot \\mathbf{n} \\, dS\n$$\n其中 $ \\mathbf{n} $ 是表面 $ \\partial V_c $ 上的外向单位法向量。由于 $ \\boldsymbol{\\Omega} $ 相对于位置是恒定的，因此 $ \\nabla \\cdot (\\boldsymbol{\\Omega} \\psi) = \\boldsymbol{\\Omega} \\cdot \\nabla \\psi $。多面体 $ V_c $ 的边界由一组平面组成，索引为 $ f \\in \\{0, 1, \\dots, F-1\\} $。因此，面积分可以写为对每个面积为 $ A_f $ 的面 $ f $ 上的积分之和：\n$$\n\\sum_{f=0}^{F-1} \\int_{A_f} \\psi(\\mathbf{r}_S, \\boldsymbol{\\Omega}) (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}_f) \\, dS_f\n$$\n其中 $ \\mathbf{n}_f $ 是面 $ f $ 的外向单位法向量。\n\n在离散纵标（$S_N$）方法中，连续的角变量 $ \\boldsymbol{\\Omega} $ 被一组离散的求积方向 $ \\boldsymbol{\\Omega}_m $ 所取代。对于一个特定的方向 $ \\boldsymbol{\\Omega}_m $，并假设角通量在每个面上是恒定的，该和式就变成了一个代数表达式。面平均角通量 $ \\psi_f(m) $ 定义为 $ \\psi_f(m) = \\frac{1}{A_f} \\int_{A_f} \\psi(\\mathbf{r}_S, \\boldsymbol{\\Omega}_m) \\, dS_f $。该表达式随后被近似为：\n$$\n\\sum_{f=0}^{F-1} A_f (\\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f) \\psi_f(m)\n$$\n这个表达式表示在方向 $ \\boldsymbol{\\Omega}_m $ 上，粒子流出控制体 $ V_c $ 的净速率。\n\n关键步骤是定义面平均通量 $ \\psi_f(m) $。一阶迎风格式根据相对于面的流动方向来设定此通量。点积 $ s_{mf} = \\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f $ 的符号决定了“流动”是进入还是流出单元。\n- 如果 $ s_{mf}  0 $，方向为 $ \\boldsymbol{\\Omega}_m $ 的粒子正通过面 $ f $ 进入 $ V_c $。这是一个**入流**面。迎风原理规定，面上的通量由粒子来源的区域决定，即相邻单元或区域边界。因此，我们将 $ \\psi_f^{\\text{upw}}(m) $ 设为相邻单元的角通量 $ \\psi_{\\text{nb}(f)}(m) $，或指定的入射边界通量 $ \\psi_{\\text{in}}(f,m) $。对于真空边界条件，$ \\psi_{\\text{in}}(f,m) = 0 $。\n- 如果 $ s_{mf} > 0 $，方向为 $ \\boldsymbol{\\Omega}_m $ 的粒子正通过面 $ f $ 离开 $ V_c $。这是一个**出流**面。迎风通量由粒子离开的区域决定，即单元 $ c $ 本身。因此，我们设 $ \\psi_f^{\\text{upw}}(m) = \\psi_c(m) $，其中 $ \\psi_c(m) $ 是单元平均角通量。\n- 如果 $ s_{mf} = 0 $，方向 $ \\boldsymbol{\\Omega}_m $ 平行于面 $ f $。这是一个**掠射**面，它对跨面的通量平衡没有贡献。为保证数值稳定性，引入一个容差 $ \\varepsilon > 0 $。如果 $ |s_{mf}| \\le \\varepsilon $，该面被视为掠射面，其对残差的贡献为零。\n\n单元 $ c $ 在方向 $ m $ 上的流输运局部残差贡献，记为 $ R_{\\text{stream}}(c,m) $，是离散化的净流率：\n$$\nR_{\\text{stream}}(c,m) = \\sum_{f=0}^{F-1} A_f \\, s_{mf} \\, \\psi_{f}^{\\text{upw}}(m)\n$$\n其中任何掠射面的项都为零。\n\n计算步骤如下：对于每个测试用例，我们都给定了几何信息（一个具有指定面法线 $ \\mathbf{n}_f $ 和面积 $ A_f=1 $ 的六面体）、一组角方向 $ \\boldsymbol{\\Omega}_m $、单元平均角通量 $ \\psi_c(m) $、每个面的状态（相邻或边界）以及相邻单元中的角通量 $ \\psi_{\\text{nb}(f)}(m) $。\n\n对于每个给定的角方向 $ \\boldsymbol{\\Omega}_m $：\n1. 如果方向向量不是单位向量，则对其进行归一化。\n2. 初始化残差 $ R_{\\text{stream}}(c,m) = 0 $ 和一个用于存放流入面索引的空列表。\n3. 对于每个面 $ f \\in \\{0, 1, ..., 5\\} $：\n    a. 计算带符号的方向余弦 $ s_{mf} = \\boldsymbol{\\Omega}_m \\cdot \\mathbf{n}_f $。\n    b. 检查掠射条件：如果 $ |s_{mf}| \\le \\varepsilon = 10^{-12} $，则此面的贡献为零。继续到下一个面。\n    c. 如果 $ s_{mf}  0 $（入流）：\n        i. 将面索引 $ f $ 添加到入流面列表中。\n        ii. 确定迎风通量 $ \\psi_f^{\\text{upw}}(m) $。如果面 $ f $ 是边界，则 $ \\psi_f^{\\text{upw}}(m) = 0 $。如果它有相邻单元，则 $ \\psi_f^{\\text{upw}}(m) = \\psi_{\\text{nb}(f)}(m) $。\n    d. 如果 $ s_{mf} > 0 $（出流）：\n        i. 迎风通量是单元自身的通量：$ \\psi_f^{\\text{upw}}(m) = \\psi_c(m) $。\n    e. 将该面的贡献加到残差上：$ R_{\\text{stream}}(c,m) \\leftarrow R_{\\text{stream}}(c,m) + A_f s_{mf} \\psi_f^{\\text{upw}}(m) $。\n4. 遍历所有面后，便得到了入流面列表和标量残差 $ R_{\\text{stream}}(c,m) $ 的最终值。将所有方向和所有测试用例的这些值收集起来，形成最终结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the streaming residual for a hexahedral cell for several test cases\n    using a first-order upwind Finite Volume Discrete Ordinates method.\n    \"\"\"\n\n    # Global geometric and numerical parameters\n    normals = np.array([\n        [-1.0, 0.0, 0.0],  # Face 0 (-x)\n        [1.0, 0.0, 0.0],   # Face 1 (+x)\n        [0.0, -1.0, 0.0],  # Face 2 (-y)\n        [0.0, 1.0, 0.0],   # Face 3 (+y)\n        [0.0, 0.0, -1.0],  # Face 4 (-z)\n        [0.0, 0.0, 1.0]    # Face 5 (+z)\n    ])\n    areas = np.ones(6)\n    epsilon = 1e-12\n\n    # Test suite data\n    test_cases = [\n        # Case 1: General interior/boundary mix\n        {\n            \"directions\": [np.array([1.0, 0.2, 0.1]), np.array([-0.8, 0.6, 0.0])],\n            \"cell_fluxes\": [1.2, 0.7],\n            \"face_types\": [\"neighbor\", \"boundary\", \"neighbor\", \"neighbor\", \"boundary\", \"neighbor\"],\n            \"neighbor_fluxes\": {\n                0: [2.0, 1.0],\n                2: [1.5, 0.0],\n                3: [0.5, 2.0],\n                5: [1.0, 3.0]\n            }\n        },\n        # Case 2: All boundary, vacuum\n        {\n            \"directions\": [np.array([1.0, 1.0, 1.0])],\n            \"cell_fluxes\": [4.0],\n            \"face_types\": [\"boundary\"] * 6,\n            \"neighbor_fluxes\": {}\n        },\n        # Case 3: Grazing faces\n        {\n            \"directions\": [np.array([0.0, 1.0, 0.0])],\n            \"cell_fluxes\": [1.0],\n            \"face_types\": [\"boundary\", \"boundary\", \"neighbor\", \"boundary\", \"boundary\", \"boundary\"],\n            \"neighbor_fluxes\": {2: [5.0]}\n        },\n        # Case 4: Near-grazing tolerance check\n        {\n            \"directions\": [np.array([1.0, 1e-14, 0.0])],\n            \"cell_fluxes\": [2.0],\n            \"face_types\": [\"neighbor\", \"boundary\", \"boundary\", \"boundary\", \"boundary\", \"boundary\"],\n            \"neighbor_fluxes\": {0: [10.0]}\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        case_inflow_lists = []\n        case_residuals = []\n        \n        directions = case[\"directions\"]\n        cell_fluxes = case[\"cell_fluxes\"]\n        face_types = case[\"face_types\"]\n        neighbor_fluxes = case[\"neighbor_fluxes\"]\n        \n        for m, dir_vec in enumerate(directions):\n            # Normalize the direction vector\n            norm = np.linalg.norm(dir_vec)\n            omega_m = dir_vec / norm if norm > 0 else dir_vec\n\n            inflow_faces = []\n            residual = 0.0\n            \n            for f in range(normals.shape[0]):\n                s_mf = np.dot(omega_m, normals[f])\n                \n                # Check for grazing faces\n                if abs(s_mf) = epsilon:\n                    continue\n                \n                psi_upw = 0.0\n                # Inflow face\n                if s_mf  0:\n                    inflow_faces.append(f)\n                    if face_types[f] == \"neighbor\":\n                        psi_upw = neighbor_fluxes[f][m]\n                    else: # Boundary face\n                        psi_upw = 0.0  # Vacuum boundary condition\n                # Outflow face\n                else: # s_mf > 0\n                    psi_upw = cell_fluxes[m]\n                \n                residual += areas[f] * s_mf * psi_upw\n            \n            case_inflow_lists.append(inflow_faces)\n            case_residuals.append(residual)\n            \n        all_results.append([case_inflow_lists, case_residuals])\n\n    # Final print statement must match the problem's specified format.\n    # The string representation of a list in Python matches the example format.\n    print(all_results)\n\nsolve()\n```"
        }
    ]
}