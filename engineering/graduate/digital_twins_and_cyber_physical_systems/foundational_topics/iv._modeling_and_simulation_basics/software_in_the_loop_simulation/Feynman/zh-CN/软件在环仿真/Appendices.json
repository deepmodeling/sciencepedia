{
    "hands_on_practices": [
        {
            "introduction": "一个可靠的软件在环（SIL）仿真始于一个正确且稳定的物理设备数值模型。本练习探讨了系统动力学中的“刚度”概念，这是一个常见的挑战，其中系统的不同部分在截然不同的时间尺度上变化。我们将分析数值积分方法的选择（如显式欧拉法）如何对仿真步长施加严格的约束以避免数值不稳定，这是构建任何高保真度数字孪生的关键第一步。",
            "id": "4246751",
            "problem": "一个针对信息物理系统数字孪生的软件在环（SIL）实验，采用一个基于主机的数值积分器来模拟一个刚性连续时间对象，同时在环路中执行控制器软件。在一个标称工作点附近，该对象被线性化为时不变形式 $\\dot{x}(t) = A x(t)$，其中 $A \\in \\mathbb{R}^{n \\times n}$ 是对象动力学的雅可比矩阵。该对象表现出刚性，因为 $A$ 的特征值具有很大的负实部。在某个特定的工作点，数值线性分析得出了三个实特征值：$\\lambda_{1} = -2.0 \\times 10^{3}\\ \\text{s}^{-1}$，$\\lambda_{2} = -50\\ \\text{s}^{-1}$ 和 $\\lambda_{3} = -0.5\\ \\text{s}^{-1}$。\n\n在这个SIL设置中，对象使用具有固定步长 $h > 0$ 的显式前向欧拉法在时间上推进，生成一个离散时间模型 $x_{k+1} = \\Phi(h)\\,x_{k}$，该模型用于每步更新一次对象状态。仅使用线性化、模态分解和线性时不变系统的离散时间稳定性判据（状态转移矩阵的所有特征值必须严格位于单位圆盘内部）的基本原理，完成以下任务：\n\n- 从第一性原理出发，推导当在线性化对象上使用显式欧拉法时，保证每个特征模态线性稳定的绝对稳定域（用步长 $h$ 表示）。\n- 由此，推导出保证所有三个模态同时线性稳定的对 $h$ 的约束，并计算给定特征值所允许的最大均匀步长 $h$。\n- 作为比较，对应用于相同线性化对象的隐式后向欧拉法重复进行模态稳定性分析，并确定对于具有严格负实部的特征值，是否需要任何步长限制来维持线性稳定性。您必须从第一性原理证明您的结论，但无需在最终数值答案中报告。\n\n以秒为单位表示您最终的 $h$，并将您的答案四舍五入到 $3$ 位有效数字。",
            "solution": "该问题是有效的，因为它在科学上基于数值分析和控制理论的原理，问题提法得当，并且陈述客观。我们可以开始求解。\n\n问题要求分析软件在环（SIL）仿真的数值稳定性。对象动力学在一个工作点附近被线性化，得到一个线性时不变（LTI）系统：\n$$\n\\dot{x}(t) = A x(t)\n$$\n其中 $x(t) \\in \\mathbb{R}^n$ 是状态向量，$A \\in \\mathbb{R}^{n \\times n}$ 是系统雅可比矩阵。该系统由三个实特征值表征：$\\lambda_{1} = -2.0 \\times 10^{3}\\ \\text{s}^{-1}$，$\\lambda_{2} = -50\\ \\text{s}^{-1}$ 和 $\\lambda_{3} = -0.5\\ \\text{s}^{-1}$。\n\n为了分析数值方法的稳定性，我们可以使用模态分解来解耦系统动力学。假设矩阵 $A$ 是可对角化的（这里由于其具有不同的实特征值而得到保证），存在一个变换 $x(t) = P z(t)$，其中 $P$ 是 $A$ 的特征向量矩阵。将此代入状态方程可得：\n$$\nP \\dot{z}(t) = A P z(t)\n$$\n$$\n\\dot{z}(t) = P^{-1} A P z(t) = \\Lambda z(t)\n$$\n其中 $\\Lambda$ 是 $A$ 的特征值对角矩阵。这个变换将 $n$ 维系统解耦为 $n$ 个独立的标量常微分方程（ODE），每个对应一个模态 $z_i(t)$：\n$$\n\\dot{z}_i(t) = \\lambda_i z_i(t) \\quad \\text{for } i = 1, 2, 3\n$$\n应用于完整系统 $\\dot{x}(t) = A x(t)$ 的数值方法的稳定性等价于将其应用于这些标量测试方程中每一个时的稳定性。\n\n**第1部分：显式前向欧拉法的稳定性分析**\n\n显式前向欧拉法使用具有固定步长 $h > 0$ 的前向差分公式来近似导数 $\\dot{z}_i(t)$：\n$$\n\\dot{z}_i(t_k) \\approx \\frac{z_{i}(t_{k+1}) - z_{i}(t_k)}{h}\n$$\n其中 $t_k = kh$，我们使用记号 $z_{i,k} \\equiv z_i(t_k)$。将此应用于模态ODE $\\dot{z}_i(t) = \\lambda_i z_i(t)$ 得到：\n$$\n\\frac{z_{i,k+1} - z_{i,k}}{h} = \\lambda_i z_{i,k}\n$$\n求解 $z_{i,k+1}$ 得到第 $i$ 个模态的离散时间更新规则：\n$$\nz_{i,k+1} = z_{i,k} + h \\lambda_i z_{i,k} = (1 + h \\lambda_i) z_{i,k}\n$$\n为了使离散时间系统稳定，传播因子（即单模态离散时间状态转移矩阵的特征值）的模必须严格小于1。这就是问题中提到的单位圆盘判据。因此，对于每个模态 $i$，我们要求：\n$$\n|1 + h \\lambda_i|  1\n$$\n这个不等式定义了前向欧拉法的绝对稳定域。由于给定的特征值 $\\lambda_i$ 是负实数，步长 $h$ 是正实数，因此项 $h \\lambda_i$ 是一个负实数。绝对值不等式可以写成一对不等式：\n$$\n-1  1 + h \\lambda_i  1\n$$\n我们分别分析每个不等式：\n1.  右侧不等式：$1 + h \\lambda_i  1 \\implies h \\lambda_i  0$。由于 $h > 0$ 且所有给定的 $\\lambda_i  0$，此条件始终满足。\n2.  左侧不等式：$-1  1 + h \\lambda_i \\implies -2  h \\lambda_i$。由于 $\\lambda_i$ 是负数，除以它会反转不等号：\n$$\nh  -\\frac{2}{\\lambda_i}\n$$\n这是保证第 $i$ 个模态稳定的对步长 $h$ 的约束。为了使整个系统稳定，这个约束必须对所有模态同时满足。这意味着 $h$ 必须小于由每个特征值确定的上界中的最小值。\n\n**第2部分：最大允许步长的计算**\n\n我们将推导出的约束 $h  -2/\\lambda_i$ 应用于每个给定的特征值：\n- 对于 $\\lambda_1 = -2.0 \\times 10^3\\ \\text{s}^{-1}$：\n$$\nh  -\\frac{2}{-2.0 \\times 10^3} \\ \\text{s} = 1.0 \\times 10^{-3}\\ \\text{s}\n$$\n- 对于 $\\lambda_2 = -50\\ \\text{s}^{-1}$：\n$$\nh  -\\frac{2}{-50} \\ \\text{s} = \\frac{1}{25}\\ \\text{s} = 0.04\\ \\text{s}\n$$\n- 对于 $\\lambda_3 = -0.5\\ \\text{s}^{-1}$：\n$$\nh  -\\frac{2}{-0.5} \\ \\text{s} = 4\\ \\text{s}\n$$\n为确保所有三个模态的稳定性，步长 $h$ 必须同时满足这三个不等式。最严格的约束是由模最大的特征值 $\\lambda_1$ 施加的，它对应于系统中最快的动态模态。这是刚性微分方程的一个典型特征。\n$$\nh  \\min(1.0 \\times 10^{-3}, 0.04, 4)\\ \\text{s}\n$$\n$$\nh  1.0 \\times 10^{-3}\\ \\text{s}\n$$\n因此，允许的最大均匀步长 $h$ 是 $1.0 \\times 10^{-3}\\ \\text{s}$。问题要求报告这个值，我们记为 $h = 1.0 \\times 10^{-3}\\ \\text{s}$。四舍五入到 $3$ 位有效数字得到 $1.00 \\times 10^{-3}\\ \\text{s}$。\n\n**第3部分：隐式后向欧拉法的比较分析**\n\n作为比较，我们分析隐式后向欧拉法的稳定性。关键区别在于导数是使用下一个时间步的状态 $z_{i,k+1}$ 来评估的：\n$$\n\\frac{z_{i,k+1} - z_{i,k}}{h} = \\lambda_i z_{i,k+1}\n$$\n我们求解 $z_{i,k+1}$：\n$$\nz_{i,k+1} - h \\lambda_i z_{i,k+1} = z_{i,k}\n$$\n$$\nz_{i,k+1} (1 - h \\lambda_i) = z_{i,k}\n$$\n$$\nz_{i,k+1} = \\left( \\frac{1}{1 - h \\lambda_i} \\right) z_{i,k}\n$$\n稳定性判据要求传播因子的模小于1：\n$$\n\\left| \\frac{1}{1 - h \\lambda_i} \\right|  1 \\implies |1 - h \\lambda_i| > 1\n$$\n我们已知特征值 $\\lambda_i$ 具有严格的负实部。让我们对我们的负实数特征值进行分析。令 $\\lambda_i = -a_i$，其中 $a_i > 0$。稳定性条件变为：\n$$\n|1 - h(-a_i)| > 1 \\implies |1 + h a_i| > 1\n$$\n由于 $h > 0$ 且 $a_i > 0$，乘积 $h a_i$ 是一个正实数。因此，$1 + h a_i$ 是一个严格大于1的实数。其绝对值就是它本身，所以条件是：\n$$\n1 + h a_i > 1\n$$\n这个不等式对任何 $h > 0$ 和任何 $a_i > 0$ 都成立。这意味着当后向欧拉法应用于其特征值具有严格负实部的系统时，对于任何正步长 $h$ 都是稳定的。这种方法被称为A-稳定方法。因此，对于给定的线性化对象，隐式后向欧拉法对步长 $h$ 没有施加上限来维持线性稳定性。这一特性使其非常适合模拟刚性系统，因为它允许比像前向欧拉法这样的条件稳定方法大得多的时间步长，从而降低了计算成本。\n\n要求的最终答案是前向欧拉法允许的最大步长。$h = 1.0 \\times 10^{-3}\\ \\text{s}$，四舍五入到 $3$ 位有效数字是 $1.00 \\times 10^{-3}\\ \\text{s}$。",
            "answer": "$$\n\\boxed{1.00 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "在确保设备仿真在数值上是可靠的之后，我们必须保证连接控制器软件的接口的完整性。本练习呈现了一个在SIL中常见且危险的情景：单元不匹配，即设备模型和控制器对交换数据的物理单位“意见不一”。通过分析这种缩放误差对闭环系统稳定性的影响，您将学习如何诊断此类接口问题并实施一个简单而有效的修正，从而强调在信息物理系统中严格进行接口管理的重要性。",
            "id": "4246810",
            "problem": "一个信息物理系统由一个数字孪生表示，该数字孪生与一个在环软件 (SIL) 中实现的控制器交换测量值。物理对象是一个平移质量-弹簧-阻尼器系统，其质量为 $m$，粘性阻尼为 $c$，刚度为 $k$。其运动 $y(t)$ 遵循牛顿第二定律 $m \\ddot{y}(t) = \\sum F(t)$，其中作用力包括弹簧力 $-k y(t)$、阻尼力 $-c \\dot{y}(t)$ 和执行器输入 $u(t)$。控制器是一个在国际单位制 (SI) 下设计的连续时间全状态反馈律，并期望输入的位置单位为米，速度单位为米每秒。测量值通过一个软件接口从数字孪生传输到 SIL 控制器。\n\n考虑以下参数和设计：\n\n- 对象参数：$m = 1\\,\\mathrm{kg}$，$c = 2\\,\\mathrm{N\\cdot s/m}$，$k = 5\\,\\mathrm{N/m}$。\n- 状态定义：$x(t) = \\begin{pmatrix} y(t) \\\\ \\dot{y}(t) \\end{pmatrix}$。\n- SI 单位制下的连续时间状态空间模型：$\\dot{x}(t) = A x(t) + B u(t)$，其中 $A = \\begin{pmatrix} 0  1 \\\\ -\\frac{k}{m}  -\\frac{c}{m} \\end{pmatrix}$ 且 $B = \\begin{pmatrix} 0 \\\\ \\frac{1}{m} \\end{pmatrix}$。\n- 期望 SI 单位的状态反馈控制器：$u(t) = -K x(t)$，其中 $K = \\begin{pmatrix} k_1  k_2 \\end{pmatrix}$，$k_1 = 15\\,\\mathrm{N/m}$ 且 $k_2 = 8\\,\\mathrm{N\\cdot s/m}$。\n\n在 SIL 设置中，数字孪生无意中发送了以毫米和毫米每秒为单位的位置和速度，而不是米和米每秒。设单位不匹配缩放表示为 $S = \\operatorname{diag}(s, s)$，其中 $s = 1000$，因此控制器处理的是 $\\tilde{x}(t) = S x(t)$ 而不是 $x(t)$，从而得到的实现控制为 $u(t) = -K \\tilde{x}(t) = -K S x(t)$。这产生了一个闭环系统矩阵 $A_{\\text{cl,mismatch}} = A - B K S$，而原始设计产生的是 $A_{\\text{cl,SI}} = A - B K$。\n\n任务：\n1. 从牛顿第二定律以及阻尼力和刚度力的定义出发，推导状态空间模型 $\\dot{x}(t) = A x(t) + B u(t)$，并用 $m$、$c$ 和 $k$ 表示 $A$ 和 $B$。然后用 $A$、$B$、$K$ 和 $S$ 显式地写出闭环系统矩阵 $A_{\\text{cl,SI}}$ 和 $A_{\\text{cl,mismatch}}$。\n2. 使用基本控制概念，解释单位缩放 $S$ 如何改变有效反馈增益，并讨论其对连续时间和采样实现（即 SIL）中闭环稳定性和动态响应的定性影响，并参考连续时间极点与其通过指数运算得到的采样等效值之间的关系。\n3. 计算标量增益校正因子 $\\gamma$，以便在测量的 $\\tilde{x}(t)$ 进入控制器之前在软件中对其进行预缩放，即实现 $u(t) = -K \\left( \\gamma \\tilde{x}(t) \\right)$，从而使得到的闭环动态特性与原始基于 SI 的设计完全匹配。以单个实数值形式提供 $\\gamma$。将您的答案四舍五入到四位有效数字。因为 $\\gamma$ 是无量纲的，所以最终答案不需要物理单位。",
            "solution": "用户提供了一个关于质量-弹簧-阻尼器系统的在环软件 (SIL) 仿真中单位不匹配的问题。首先，必须验证该问题的科学合理性、完整性和客观性。\n\n### 步骤 1：提取已知条件\n- **物理系统**：平移质量-弹簧-阻尼器。\n- **运动方程**：$m \\ddot{y}(t) = \\sum F(t) = u(t) - k y(t) - c \\dot{y}(t)$。\n- **参数**：质量 $m = 1\\,\\mathrm{kg}$，阻尼系数 $c = 2\\,\\mathrm{N\\cdot s/m}$，弹簧常数 $k = 5\\,\\mathrm{N/m}$。\n- **状态向量**：$x(t) = \\begin{pmatrix} y(t) \\\\ \\dot{y}(t) \\end{pmatrix}$。\n- **状态空间模型**：$\\dot{x}(t) = A x(t) + B u(t)$，矩阵为 $A = \\begin{pmatrix} 0  1 \\\\ -\\frac{k}{m}  -\\frac{c}{m} \\end{pmatrix}$ 和 $B = \\begin{pmatrix} 0 \\\\ \\frac{1}{m} \\end{pmatrix}$。\n- **控制器**：状态反馈律 $u(t) = -K x(t)$。\n- **反馈增益矩阵**：$K = \\begin{pmatrix} k_1  k_2 \\end{pmatrix}$，其中 $k_1 = 15\\,\\mathrm{N/m}$ 和 $k_2 = 8\\,\\mathrm{N\\cdot s/m}$。\n- **单位不匹配**：控制器接收到一个缩放后的状态向量 $\\tilde{x}(t) = S x(t)$。\n- **缩放矩阵**：$S = \\operatorname{diag}(s, s)$，其中缩放因子 $s = 1000$。这对应于测量值以毫米和毫米/秒为单位，而不是米和米/秒。\n- **实现的控制**：$u(t) = -K \\tilde{x}(t) = -K S x(t)$。\n- **闭环矩阵**：预期的系统是 $A_{\\text{cl,SI}} = A - B K$，而实际的不匹配系统是 $A_{\\text{cl,mismatch}} = A - B K S$。\n- **任务**：\n  1. 推导状态空间模型并表示闭环矩阵。\n  2. 解释缩放不匹配对稳定性和动态特性的定性影响。\n  3. 计算一个标量校正因子 $\\gamma$，用于修正的控制律 $u(t) = -K ( \\gamma \\tilde{x}(t) )$，以恢复预期的系统动态。$\\gamma$ 的最终数值答案应四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题坚实地植根于经典力学（质量-弹簧-阻尼器的牛顿第二定律）和基本的线性系统与控制理论（状态空间表示、状态反馈控制）。单位不匹配的情景是信息物理系统和 SIL 仿真工程实践中一个常见且关键的问题。所有参数和单位都与国际单位制 (SI) 一致。\n- **适定性**：该问题是自洽的，并提供了解决任务所需的所有必要信息。定义清晰，问题导向唯一的、可验证的答案。\n- **客观性**：问题以精确的技术语言陈述，没有歧义或主观论断。\n\n### 步骤 3：结论与行动\n该问题是有效的。它科学合理、适定且客观。没有矛盾、缺失数据或其他缺陷。将提供完整解答。\n\n### 解答\n\n该问题探讨了信息物理控制系统中单位缩放错误的后果及其校正方法。我们将依次解决这三个任务。\n\n**任务 1：状态空间模型和闭环矩阵的推导**\n\n物理对象的动态由平移质量-弹簧-阻尼器系统的牛顿第二定律描述。作用在质量 $m$ 上的合力等于质量乘以其加速度 $\\ddot{y}(t)$。\n这些力是外部控制输入 $u(t)$、弹簧力 $-k y(t)$ 和阻尼力 $-c \\dot{y}(t)$。\n运动方程为：\n$$m \\ddot{y}(t) = u(t) - c \\dot{y}(t) - k y(t)$$\n为了推导状态空间模型，我们首先分离出最高阶导数 $\\ddot{y}(t)$：\n$$\\ddot{y}(t) = -\\frac{k}{m} y(t) - \\frac{c}{m} \\dot{y}(t) + \\frac{1}{m} u(t)$$\n状态变量定义为 $x_1(t) = y(t)$ (位置) 和 $x_2(t) = \\dot{y}(t)$ (速度)。状态向量为 $x(t) = \\begin{pmatrix} x_1(t) \\\\ x_2(t) \\end{pmatrix}$。\n现在我们写出状态变量的一阶微分方程：\n第一个状态变量的导数是：\n$$\\dot{x}_1(t) = \\frac{d}{dt}(y(t)) = \\dot{y}(t) = x_2(t)$$\n第二个状态变量的导数是：\n$$\\dot{x}_2(t) = \\frac{d}{dt}(\\dot{y}(t)) = \\ddot{y}(t) = -\\frac{k}{m} y(t) - \\frac{c}{m} \\dot{y}(t) + \\frac{1}{m} u(t) = -\\frac{k}{m} x_1(t) - \\frac{c}{m} x_2(t) + \\frac{1}{m} u(t)$$\n这两个方程可以写成矩阵形式 $\\dot{x}(t) = A x(t) + B u(t)$：\n$$\\begin{pmatrix} \\dot{x}_1(t) \\\\ \\dot{x}_2(t) \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ -\\frac{k}{m}  -\\frac{c}{m} \\end{pmatrix} \\begin{pmatrix} x_1(t) \\\\ x_2(t) \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ \\frac{1}{m} \\end{pmatrix} u(t)$$\n通过观察，用物理参数表示的状态空间矩阵是：\n$$A = \\begin{pmatrix} 0  1 \\\\ -\\frac{k}{m}  -\\frac{c}{m} \\end{pmatrix} \\quad \\text{和} \\quad B = \\begin{pmatrix} 0 \\\\ \\frac{1}{m} \\end{pmatrix}$$\n这完成了所要求的推导。\n\n接下来，我们写出闭环系统矩阵。控制律是 $u(t) = -Kx(t)$。闭环系统动态通过将控制律代入状态方程得到：$\\dot{x}(t) = A x(t) + B(-Kx(t)) = (A - BK)x(t)$。\n正确配置的闭环系统矩阵，全程使用 SI 单位，是：\n$$A_{\\text{cl,SI}} = A - B K$$\n在单位不匹配的情况下，控制器接收到缩放后的状态向量 $\\tilde{x}(t) = S x(t)$，因此实现的控制是 $u(t) = -K\\tilde{x}(t) = -K S x(t)$。闭环动态变为 $\\dot{x}(t) = A x(t) + B(-KSx(t)) = (A - BKS)x(t)$。\n因此，在单位不匹配下的闭环系统矩阵是：\n$$A_{\\text{cl,mismatch}} = A - B K S$$\n\n**任务 2：单位不匹配的定性后果**\n\n单位不匹配导致控制器操作于 $\\tilde{x}(t) = S x(t)$ 而不是 $x(t)$。缩放矩阵是 $S = sI$，其中 $I$ 是 $2 \\times 2$ 单位矩阵，$s = 1000$。实现的控制律是 $u(t) = -K\\tilde{x}(t) = -K(Sx(t))$。由于 $S = sI$，这变为 $u(t) = -K(sI)x(t) = -sKx(t)$。\n这意味着有效反馈增益矩阵是 $K_{\\text{eff}} = sK$。当 $s = 1000$ 时，反馈增益 $k_1$ 和 $k_2$ 被有效地放大了 1000 倍。这对系统的行为有深远的影响。\n\n闭环特征方程决定了系统的极点，极点支配着稳定性和动态响应。对于不匹配的系统，方程是 $\\det(\\lambda I - A_{\\text{cl,mismatch}}) = 0$。\n$$A_{\\text{cl,mismatch}} = A - B(sK) = \\begin{pmatrix} 0  1 \\\\ -k/m  -c/m \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 1/m \\end{pmatrix} s\\begin{pmatrix} k_1  k_2 \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ -(k+sk_1)/m  -(c+sk_2)/m \\end{pmatrix}$$\n特征多项式是：\n$$\\lambda \\left(\\lambda + \\frac{c+sk_2}{m}\\right) + \\frac{k+sk_1}{m} = 0 \\implies \\lambda^2 + \\left(\\frac{c+sk_2}{m}\\right)\\lambda + \\left(\\frac{k+sk_1}{m}\\right) = 0$$\n这是一个二阶系统 $\\lambda^2 + 2\\zeta\\omega_n\\lambda + \\omega_n^2 = 0$ 的特征方程。有效的自然频率 $\\omega_{n,\\text{eff}}$ 和阻尼比 $\\zeta_{\\text{eff}}$ 由以下公式确定：\n$$\\omega_{n,\\text{eff}}^2 = \\frac{k+sk_1}{m} \\quad \\text{和} \\quad 2\\zeta_{\\text{eff}}\\omega_{n,\\text{eff}} = \\frac{c+sk_2}{m}$$\n由于 $s = 1000$，有效的闭环刚度 $(k+sk_1)$ 和阻尼 $(c+sk_2)$ 与预期的设计值 $(k+k_1)$ 和 $(c+k_2)$ 相比都极大地增加了。这会急剧增加自然频率，使系统响应极其迅速。\n在连续时间域，因为所有参数（$m, c, k, k_1, k_2, s$）都是正的，特征多项式的系数也是正的。根据 Routh-Hurwitz 稳定性判据，系统的极点将保持在复平面的左半部分，因此系统在技术上是稳定的。然而，如此高的增益会导致严重过阻尼或剧烈振荡的响应、执行器饱和以及激发模型中未包含的高频动态，这在实践中是一种失效形式。\n\n在像 SIL 这样的采样实现中，后果甚至更严重。离散时间系统的稳定性取决于其极点是否位于 z 平面中的单位圆内。对于采样周期 $T$，连续时间极点 $\\lambda_c$ 与其离散时间等效值 $\\lambda_d$ 之间的关系是 $\\lambda_d = \\exp(\\lambda_c T)$。$A_{\\text{cl,mismatch}}$ 的连续时间极点的模极大，这对采样时间 $T$ 施加了严格的约束。对于一个简单的前向欧拉近似，离散系统仅在 $(I + T A_{\\text{cl,mismatch}})$ 的所有特征值都在单位圆内时才稳定。这导致了一个形式为 $|\\lambda_c|  \\alpha/T$ 的稳定性条件，其中 $\\alpha$ 是某个常数（例如，对于实极点 $\\alpha=2$）。巨大的增益 $s$ 使得 $|\\lambda_c|$ 变得非常大，对于任何实际的 $T$，都很容易违反这个条件，导致离散仿真变得数值不稳定。\n\n**任务 3：校正因子 $\\gamma$ 的计算**\n\n目标是找到一个标量校正因子 $\\gamma$，使得修正后的控制律 $u(t) = -K (\\gamma \\tilde{x}(t))$ 能够恢复原始预期的系统行为。预期的闭环动态由状态空间方程 $\\dot{x}(t) = (A - BK)x(t)$ 给出。\n采用建议的校正后，控制律为 $u(t) = -K \\gamma \\tilde{x}(t)$。代入关系式 $\\tilde{x}(t) = Sx(t)$，我们得到：\n$$u(t) = -K \\gamma (S x(t)) = -(K \\gamma S) x(t)$$\n由此产生的闭环系统动态为：\n$$\\dot{x}(t) = A x(t) + B u(t) = A x(t) - B(K \\gamma S)x(t) = (A - B K \\gamma S) x(t)$$\n为使这些动态对于任何状态 $x(t)$ 都与预期的动态相同，闭环矩阵必须相等：\n$$A - B K = A - B K \\gamma S$$\n该方程简化为：\n$$B K = B K \\gamma S$$\n矩阵 $S$ 已知为 $S = \\operatorname{diag}(s, s)$，可以写成 $S = sI$，其中 $I$ 是单位矩阵。由于 $\\gamma$ 和 $s$ 是标量，它们与所有矩阵可交换。\n$$B K = B K \\gamma s I = \\gamma s (B K)$$\n矩阵乘积 $BK$ 是：\n$$BK = \\begin{pmatrix} 0 \\\\ 1/m \\end{pmatrix} \\begin{pmatrix} k_1  k_2 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ k_1/m  k_2/m \\end{pmatrix}$$\n由于 $m$、$k_1$ 和 $k_2$ 均为非零，$BK$ 不是零矩阵。因此，我们可以从方程 $BK = \\gamma s (BK)$ 有效地得出结论：\n$$\\gamma s = 1$$\n求解校正因子 $\\gamma$：\n$$\\gamma = \\frac{1}{s}$$\n给定缩放因子 $s = 1000$：\n$$\\gamma = \\frac{1}{1000} = 0.001$$\n题目要求答案四舍五入到四位有效数字。精确值为 $0.001$。为了用四位有效数字表示，我们包含尾随的零。\n$$\\gamma = 0.001000$$\n这个因子 $\\gamma$ 在测量值被控制器使用之前，有效地反转了由单位不匹配引入的错误缩放，从而恢复了预期的系统行为。",
            "answer": "$$\\boxed{0.001000}$$"
        },
        {
            "introduction": "除了修复个别错误，现代SIL实践采用系统化的方法来确保系统正确性。这最后一个练习介绍了基于契约的设计，这是一种强大的范式，用于形式化系统组件之间的预期行为和交互。您将实现运行时监视器，检查这些“假设-保证”契约是否被违反，从而实现故障的自动检测和分类，这极大地加速了复杂控制器软件的调试和验证过程。",
            "id": "4246839",
            "problem": "要求您设计并实现一个软件在环（SIL）仿真，该仿真在离散时间线性时不变控制器与被控对象之间强制执行基于契约的交互，并演示如何通过运行时检测契约违规来获得可操作的调试信息。程序必须执行指定的测试套件，并以规定的格式输出汇总的、可量化的结果。\n\n考虑一个被控对象，其状态为 $\\mathbf{x}_k \\in \\mathbb{R}^2$，标量控制输入为 $u_k \\in \\mathbb{R}$，测量输出为 $\\mathbf{y}_k \\in \\mathbb{R}^2$，由以下离散时间动态方程控制\n$$\n\\mathbf{x}_{k+1} = A \\mathbf{x}_k + B u_k + \\mathbf{w}_k, \\quad \\mathbf{y}_k = C \\mathbf{x}_k + \\mathbf{v}_k,\n$$\n其中 $A \\in \\mathbb{R}^{2 \\times 2}$，$B \\in \\mathbb{R}^{2 \\times 1}$，$C \\in \\mathbb{R}^{2 \\times 2}$。控制器是静态状态反馈：\n$$\nu_k = K \\mathbf{x}_k,\n$$\n其中 $K \\in \\mathbb{R}^{1 \\times 2}$。所有量均为无量纲。时间索引 $k$ 从 $k=0$ 运行到 $k=T-1$，其中 $T \\in \\mathbb{N}$。\n\n基于契约的设计。将契约定义为一个假设-保证对 $(\\mathcal{A}, \\mathcal{G})$：\n- 假设 $\\mathcal{A}$（被控对象侧）：扰动 $\\mathbf{w}_k$ 和测量噪声 $\\mathbf{v}_k$ 满足分量上的无穷范数界\n$$\n\\lVert \\mathbf{w}_k \\rVert_\\infty \\le w_{\\max}, \\quad \\lVert \\mathbf{v}_k \\rVert_\\infty \\le v_{\\max} \\quad \\text{对所有 } k.\n$$\n- 保证 $\\mathcal{G}$（控制器侧）：控制器必须遵守\n$$\n|u_k| \\le u_{\\max}, \\quad |u_k - u_{k-1}| \\le \\Delta u_{\\max} \\text{ 对 } k \\ge 1, \\quad \\lVert \\mathbf{x}_k \\rVert_\\infty \\le x_{\\max} \\quad \\text{对所有 } k,\n$$\n其中，状态安全界限的保证前提是假设 $\\mathcal{A}$ 在相应时间索引及之前都成立。\n\n运行时监视器。实现两个监视器：\n- 假设监视器 $\\mathsf{M}_\\mathcal{A}$：检测到 $\\lVert \\mathbf{w}_k \\rVert_\\infty  w_{\\max}$ 或 $\\lVert \\mathbf{v}_k \\rVert_\\infty  v_{\\max}$ 发生的最早时间 $t_\\mathcal{A}$。\n- 保证监视器 $\\mathsf{M}_\\mathcal{G}$：检测到 $|u_k|  u_{\\max}$、或 $|u_k - u_{k-1}|  \\Delta u_{\\max}$（对 $k \\ge 1$）、或 $\\lVert \\mathbf{x}_k \\rVert_\\infty  x_{\\max}$ 发生的最早时间 $t_\\mathcal{G}$。对于状态安全检查，如果假设违规发生在时间 $t_\\mathcal{A}$，那么只有时间索引 $k  t_\\mathcal{A}$ 的状态违规才归因于 $\\mathsf{M}_\\mathcal{G}$；在 $k \\ge t_\\mathcal{A}$ 时的状态违规不归因于控制器。\n\n可操作的调试分类。根据 $(t_\\mathcal{A}, t_\\mathcal{G})$，定义一个分类代码 $c \\in \\{0,1,2,3,4\\}$：\n- $c=0$：无违规（$t_\\mathcal{A}$ 和 $t_\\mathcal{G}$ 均不存在）。\n- $c=1$：仅被控对象侧假设违规（有限的 $t_\\mathcal{A}$，无 $t_\\mathcal{G}$）。\n- $c=2$：仅控制器侧保证违规（有限的 $t_\\mathcal{G}$，无 $t_\\mathcal{A}$）。\n- $c=3$：两者均违规，控制器优先（有限的 $t_\\mathcal{G}$ 和 $t_\\mathcal{A}$，且 $t_\\mathcal{G}  t_\\mathcal{A}$）。\n- $c=4$：两者均违规，被控对象优先（有限的 $t_\\mathcal{G}$ 和 $t_\\mathcal{A}$，且 $t_\\mathcal{A} \\le t_\\mathcal{G}$）。\n\n仿真与监视程序。从初始状态 $\\mathbf{x}_0$ 开始，对 $k=0,1,\\dots,T-1$ 进行迭代：\n- 计算 $u_k = K \\mathbf{x}_k$。\n- 更新 $\\mathbf{x}_{k+1} = A \\mathbf{x}_k + B u_k + \\mathbf{w}_k$。\n- 计算 $\\mathbf{y}_k = C \\mathbf{x}_k + \\mathbf{v}_k$。\n- 根据上述定义更新监视器 $\\mathsf{M}_\\mathcal{A}$ 和 $\\mathsf{M}_\\mathcal{G}$。\n\n数值参数。除非给定测试另有规定，否则使用\n$$\nA = \\begin{bmatrix} 0.9  0.1 \\\\ 0.0  0.95 \\end{bmatrix}, \\quad\nB = \\begin{bmatrix} 0.1 \\\\ 0.05 \\end{bmatrix}, \\quad\nC = I_2, \\quad\nK = \\begin{bmatrix} -0.8  -0.6 \\end{bmatrix},\n$$\n仿真时长 $T=20$，界限为 $w_{\\max}=0.05$，$v_{\\max}=0.02$，$u_{\\max}=0.5$，$\\Delta u_{\\max}=0.2$，$x_{\\max}=2.0$。所有数值均为无量纲。\n\n测试套件。实现以下6个测试；对于每个测试 $i$，输出一个三元组 $[c_i, t_{\\mathcal{A},i}, t_{\\mathcal{G},i}]$，其中缺失的时间报告为 $-1$：\n- 测试 $1$（标称情况，无违规）：$\\mathbf{x}_0 = \\begin{bmatrix} 0.5 \\\\ -0.5 \\end{bmatrix}$；对所有 $k$，$\\mathbf{w}_k = \\begin{bmatrix} 0.01 \\\\ -0.01 \\end{bmatrix}$ 和 $\\mathbf{v}_k = \\begin{bmatrix} 0.005 \\\\ -0.005 \\end{bmatrix}$；使用默认的 $A$、$B$、$C$、$K$、$T$ 和界限。\n- 测试 $2$（被控对象假设违规）：与测试 $1$ 相同，除了在 $k=5$ 时 $\\mathbf{w}_k = \\begin{bmatrix} 0.2 \\\\ 0.0 \\end{bmatrix}$，其他情况下 $\\mathbf{w}_k = \\begin{bmatrix} 0.01 \\\\ -0.01 \\end{bmatrix}$；$\\mathbf{v}_k$ 与测试 $1$ 相同。\n- 测试 $3$（通过驱动界限引发的控制器保证违规）：$\\mathbf{x}_0 = \\begin{bmatrix} 3.0 \\\\ 3.0 \\end{bmatrix}$；对所有 $k$，$\\mathbf{w}_k = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$，$\\mathbf{v}_k = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$；使用默认的 $A$、$B$、$C$、$K$、$T$ 和界限。\n- 测试 $4$（处于精确极限的边界情况，无违规）：$\\mathbf{x}_0 = \\begin{bmatrix} -0.625 \\\\ 0.0 \\end{bmatrix}$；对所有 $k$，$\\mathbf{w}_k = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$，$\\mathbf{v}_k = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$；使用默认值。请注意，$u_0 = K \\mathbf{x}_0$ 恰好等于 $u_{\\max}$，这不应被标记为违规。\n- 测试 $5$（两者均违规，控制器优先）：$\\mathbf{x}_0 = \\begin{bmatrix} 1.5 \\\\ 1.5 \\end{bmatrix}$；对所有 $k \\ne 8$，$\\mathbf{w}_k = \\begin{bmatrix} 0.01 \\\\ -0.01 \\end{bmatrix}$；在 $k=8$ 时，$\\mathbf{w}_k = \\begin{bmatrix} 0.2 \\\\ 0.0 \\end{bmatrix}$；对所有 $k$，$\\mathbf{v}_k = \\begin{bmatrix} 0.005 \\\\ -0.005 \\end{bmatrix}$；使用默认值。\n- 测试 $6$（接近临界稳定的被控对象，闭环稳定）：与测试 $1$ 相同，除了\n$$\nA = \\begin{bmatrix} 1.0  0.01 \\\\ 0.0  1.0 \\end{bmatrix}, \\quad \\mathbf{x}_0 = \\begin{bmatrix} 0.2 \\\\ -0.2 \\end{bmatrix}, \\quad \\mathbf{w}_k = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}, \\quad \\mathbf{v}_k = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix} \\text{ 对所有 } k.\n$$\n\n最终输出格式。您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个测试结果都格式化为一个不含空格的三元素列表。例如：\n\"[ [c1,tA1,tG1],[c2,tA2,tG2],... ]\"\n但不含任何空格。具体来说，您的程序必须打印：\n\"[[c1,tA1,tG1],[c2,tA2,tG2],[c3,tA3,tG3],[c4,tA4,tG4],[c5,tA5,tG5],[c6,tA6,tG6]]\"。",
            "solution": "用户要求为离散时间线性控制系统设计并实现一个软件在环（SIL）仿真，其中融合了基于契约的设计原则和运行时监视。目标是检测并分类对预定义系统契约的违规行为。\n\n### 第1步：问题验证\n\n问题陈述描述了一个标准的离散时间线性时不变（LTI）系统，带有一个静态状态反馈控制器。其动态特性由以下公式给出：\n$$\n\\mathbf{x}_{k+1} = A \\mathbf{x}_k + B u_k + \\mathbf{w}_k\n$$\n$$\nu_k = K \\mathbf{x}_k\n$$\n基于契约的设计概念，指定为一个假设-保证对 $(\\mathcal{A}, \\mathcal{G})$，以及运行时监视，是形式化方法和信息物理系统工程中的成熟原则。问题提供了所有必要的组成部分：系统矩阵（$A$、$B$、$C$）、控制器增益（$K$）、仿真时长（$T$）、初始条件（$\\mathbf{x}_0$）、扰动和噪声序列（$\\mathbf{w}_k$、$\\mathbf{v}_k$），以及契约的明确数值界限（$w_{\\max}, v_{\\max}, u_{\\max}, \\Delta u_{\\max}, x_{\\max}$）。\n\n监视规则以算法方式定义：\n- 假设监视器 $\\mathsf{M}_\\mathcal{A}$ 检查首次出现 $\\lVert \\mathbf{w}_k \\rVert_\\infty  w_{\\max}$ 或 $\\lVert \\mathbf{v}_k \\rVert_\\infty  v_{\\max}$ 的时间 $k$。\n- 保证监视器 $\\mathsf{M}_\\mathcal{G}$ 检查首次出现 $|u_k|  u_{\\max}$、$|u_k - u_{k-1}|  \\Delta u_{\\max}$（对于 $k \\ge 1$）或 $\\lVert \\mathbf{x}_k \\rVert_\\infty  x_{\\max}$ 的时间 $k$。\n为状态安全提供了一条关键的澄清规则：仅当在时间 $t_\\mathcal{A} \\le k$ 之前没有发生假设违规时，时间 $k$ 的状态违规才归因于控制器。\n\n问题根据违规时间 $(t_\\mathcal{A}, t_\\mathcal{G})$ 定义了清晰的分类方案，并指定了一个包含六个不同场景的完整测试套件，旨在检验监视系统不同的逻辑路径。所需的输出格式也已精确指定。\n\n该问题在控制理论和形式化方法方面有科学依据，信息充分、定义明确，且完全客观。在验证过程中未发现任何缺陷。因此，该问题被认定为有效，并构建了解决方案。\n\n### 第2步：算法设计\n\n解决方案分为三个主要的逻辑组件：仿真、监视和分类。一个主函数为六个测试用例中的每一个协调这些组件。\n\n**1. 仿真核心**\n仿真在时间范围 $T$ 内传播系统状态。从初始状态 $\\mathbf{x}_0$ 开始，仿真在每个时间步 $k = 0, 1, \\dots, T-1$ 迭代计算控制输入 $u_k$ 和下一个状态 $\\mathbf{x}_{k+1}$。\n循环过程如下：\n- 根据当前状态 $\\mathbf{x}_k$，计算控制输入：$u_k = K \\mathbf{x}_k$。\n- 然后使用状态更新方程计算下一个状态：$\\mathbf{x}_{k+1} = A \\mathbf{x}_k + B u_k + \\mathbf{w}_k$。\n状态向量的历史记录 $\\mathbf{x}_0, \\dots, \\mathbf{x}_T$ 和控制输入的历史记录 $u_0, \\dots, u_{T-1}$ 被存储起来，供监视器后续分析。\n\n**2. 运行时监视**\n该组件对仿真数据进行后处理，以检测契约违规。它确定最早的假设违规时间 $t_\\mathcal{A}$ 和最早的保证违规时间 $t_\\mathcal{G}$。\n\n- **假设监视器 ($\\mathsf{M}_\\mathcal{A}$)**：此监视器从 $k=0$ 迭代到 $T-1$。在每一步中，它检查过程扰动 $\\mathbf{w}_k$ 和测量噪声 $\\mathbf{v}_k$ 的无穷范数是否超过各自的界限 $w_{\\max}$ 和 $v_{\\max}$。在第一次超过界限的时间 $k$，将 $t_\\mathcal{A}$ 设置为 $k$ 并终止搜索。如果未发现违规，$t_\\mathcal{A}$ 保持其初始值 $-1$。\n\n- **保证监视器 ($\\mathsf{M}_\\mathcal{G}$)**：此监视器查找任何保证违规的最早时间。为正确执行此操作，它从 $k=0$ 迭代到 $T$，并在每个时间步 $k$ 检查所有适用的保证条件。\n  - 在每个 $k \\in \\{0, \\dots, T\\}$，它检查状态安全条件：$\\lVert \\mathbf{x}_k \\rVert_\\infty  x_{\\max}$。根据问题的明确规则，此检查仅在之前没有发生假设违规时（即，如果 $t_\\mathcal{A} = -1$ 或 $k  t_\\mathcal{A}$）才算作违规。\n  - 在每个 $k \\in \\{0, \\dots, T-1\\}$，它检查控制输入幅值：$|u_k|  u_{\\max}$。\n  - 在每个 $k \\in \\{1, \\dots, T-1\\}$，它检查控制输入变化率：$|u_k - u_{k-1}|  \\Delta u_{\\max}$。\n在任何这些条件首次满足的时间 $k$，$t_\\mathcal{G}$ 被设置为 $k$，并终止搜索。如果未发现违规，$t_\\mathcal{G}$ 保持为 $-1$。\n\n**3. 违规分类**\n一旦确定了 $t_\\mathcal{A}$ 和 $t_\\mathcal{G}$，便根据问题陈述中指定的以下逻辑分配分类代码 $c$：\n- 如果 $t_\\mathcal{A}=-1$ 且 $t_\\mathcal{G}=-1$：$c=0$（无违规）。\n- 如果 $t_\\mathcal{A} \\neq -1$ 且 $t_\\mathcal{G}=-1$：$c=1$（仅被控对象侧假设违规）。\n- 如果 $t_\\mathcal{A}=-1$ 且 $t_\\mathcal{G} \\neq -1$：$c=2$（仅控制器侧保证违规）。\n- 如果 $t_\\mathcal{A} \\neq -1$ 且 $t_\\mathcal{G} \\neq -1$ 且 $t_\\mathcal{G}  t_\\mathcal{A}$：$c=3$（两者均违规，控制器优先）。\n- 如果 $t_\\mathcal{A} \\neq -1$ 且 $t_\\mathcal{G} \\neq -1$ 且 $t_\\mathcal{A} \\le t_\\mathcal{G}$：$c=4$（两者均违规，被控对象优先）。\n\n这种结构化方法确保首先完整运行仿真，生成所有必要的数据，然后对结果进行系统性的监视，严格遵守指定的规则，特别是关于归因状态安全违规的那个微妙但关键的规则。最终的实现将此逻辑封装在一个Python脚本中，以执行所提供的测试套件。",
            "answer": "```\n[[0,-1,-1],[1,5,-1],[2,-1,0],[0,-1,-1],[3,8,0],[0,-1,-1]]\n```"
        }
    ]
}