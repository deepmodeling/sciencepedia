## Applications and Interdisciplinary Connections

Having established the fundamental principles and mechanisms of Moving Horizon Estimation (MHE) in the preceding chapter, we now turn our attention to its practical utility. The true power of MHE is revealed not in isolation, but through its application to complex, real-world problems and its deep connections with other fields of science and engineering. This chapter will explore how the core attributes of MHE—its capacity to handle constraints, its foundation in optimization, its robustness to non-ideal conditions, and its inherent flexibility—are leveraged in a diverse array of interdisciplinary contexts. Our objective is not to reiterate the theoretical underpinnings, but to demonstrate MHE as a unifying framework for observation, inference, and adaptation in modern engineered systems.

### Core Functionality in Cyber-Physical Systems and Digital Twins

At the heart of modern Cyber-Physical Systems (CPS) and the concept of the Digital Twin is the need for a persistent, accurate, and robust synchronization between a physical asset and its virtual counterpart. MHE serves as a cornerstone technology for achieving this synchronization, offering capabilities that extend far beyond traditional recursive filters.

#### State and Model Synchronization

A digital twin's primary function is to accurately mirror the state of its physical counterpart, including latent or unmeasured variables. MHE accomplishes this by solving an optimization problem at each time step to find the most probable state trajectory that explains a recent history of measurements, given a model of the system's dynamics. This process inherently provides a smoothed, physically consistent estimate of the system's complete state. A critical aspect of this synchronization is MHE's ability to gracefully handle the inevitable mismatch between the digital twin's model and the true physics of the asset. Even when the model parameters are not perfectly known, MHE can provide a state estimate with a bounded error, provided the system is sufficiently observable and the inputs are persistently exciting. This prevents the estimator from diverging and ensures reliable tracking. Furthermore, MHE's formulation as a constrained optimization problem is one of its most significant advantages. Known physical laws, operational limits, and safety boundaries (e.g., non-negative concentrations, temperatures within a safe range) can be encoded as hard constraints within the MHE problem. This prunes the search space, ruling out physically implausible trajectories and thereby improving the accuracy and identifiability of the state estimate .

#### Online Model Adaptation

For a digital twin to remain a high-fidelity representation over a system's lifetime, its internal model must adapt to changes in the physical asset due to aging, wear, or changing environmental conditions. MHE provides a natural framework for online model adaptation through joint state and parameter estimation. By augmenting the state vector to include the unknown or slowly varying parameters, MHE can be formulated to estimate both the system state and its underlying parameters simultaneously. For instance, a parameter $\theta$ can be modeled as evolving according to a random walk, $\theta_{k+1} = \theta_k + \eta_k$, where $\eta_k$ is a small process noise. The MHE objective function is then extended to include a penalty on the parameter's drift, derived from the statistics of $\eta_k$. This allows the digital twin to continuously refine its model based on incoming data.

The success of such a scheme hinges on the principle of identifiability, which is directly related to the [observability](@entry_id:152062) of the augmented state-parameter system. To distinguish the effects of the parameters from the states, the system must be sufficiently excited by its inputs. In the context of a [battery management system](@entry_id:1121417), for example, MHE can be used to track not only the State of Charge (SoC) but also the battery's [effective capacity](@entry_id:748806), a parameter known to degrade over its operational life. By jointly estimating SoC and capacity, the digital twin maintains an accurate model for prediction and control, even as the battery ages  .

#### Handling Complex Dynamics

MHE's formulation as a general [nonlinear optimization](@entry_id:143978) problem makes it exceptionally well-suited for systems with complex dynamics, where linear estimation techniques are inadequate.

- **Nonlinear Systems**: Many real-world systems, particularly in biology and chemistry, are governed by strongly nonlinear dynamics. The artificial pancreas, a critical biomedical application for individuals with Type 1 [diabetes](@entry_id:153042), relies on models of glucose-insulin interaction that are inherently nonlinear. MHE can directly incorporate these complex physiological models to estimate blood glucose levels and insulin action from sensor data. In such safety-critical applications, the horizon length $N$ becomes a crucial design parameter. It must be chosen long enough to ensure estimator stability, often guided by the system's stability properties. For instance, a common criterion is to select $N$ such that the influence of past estimation errors (summarized in the arrival cost) contracts by a specified factor over the horizon, ensuring that old information is sufficiently discounted .

- **Hybrid Systems**: A significant number of modern systems exhibit hybrid dynamics, involving the interplay of continuous-[state evolution](@entry_id:755365) and discrete-mode switching. MHE can be extended to these systems by formulating a joint estimation problem over both the continuous states and the discrete mode sequence. The MHE objective function is augmented with terms that represent the prior probability of the initial mode and the costs of transitions between modes, derived from the negative logarithm of the known [transition probabilities](@entry_id:158294) of an underlying Markov chain. This allows the estimator to find the most probable sequence of both discrete modes and continuous states that explains the observed data, enabling applications in areas like [fault-tolerant control](@entry_id:173831) where [system dynamics](@entry_id:136288) change abruptly .

- **Large-Scale and Distributed Systems**: Many systems, from plasma dynamics in fusion reactors to large-scale power grids, are described by partial differential equations (PDEs) that, when discretized, result in very high-dimensional state-space models. MHE can be applied to these large-scale systems to estimate entire profiles (e.g., temperature or density profiles). In the context of a tokamak fusion device, MHE can estimate the radial electron temperature profile based on measurements from various diagnostics, subject to physical bounds on the profile values . For networked systems composed of many interconnected subsystems, a centralized MHE can be computationally intractable. Here, distributed MHE provides a scalable solution. By introducing consensus variables for the coupling constraints and employing algorithms like the Alternating Direction Method of Multipliers (ADMM), the global estimation problem can be decomposed into smaller, local MHE problems solved by each subsystem. These local estimators then coordinate to reach a consensus on the coupled variables, achieving a globally consistent estimate in a decentralized manner .

### Robustness, Fault Diagnosis, and Security

A key motivation for employing MHE is its superior robustness compared to traditional estimators, particularly in the presence of non-ideal conditions such as measurement outliers, system faults, and malicious attacks.

#### Robustness to Outliers and Non-Gaussian Noise

The standard Kalman Filter, which implicitly minimizes a quadratic (least-squares) objective, is highly sensitive to measurement [outliers](@entry_id:172866). A single large, erroneous measurement can significantly corrupt the state estimate. MHE overcomes this limitation by allowing the use of non-[quadratic penalty](@entry_id:637777) functions in its objective. A prime example is the Huber loss function, which behaves quadratically for small residuals but linearly for large residuals. This means that the influence of large errors is effectively capped, preventing outliers from dominating the estimation process. In applications such as power electronics or battery management, where sensor faults or sharp, [unmodeled dynamics](@entry_id:264781) can produce [outliers](@entry_id:172866), this property of MHE is crucial for maintaining a reliable state estimate  .

#### Fault and Disturbance Estimation

The MHE framework can be adapted to not only estimate the state but also to detect, isolate, and quantify faults and unknown disturbances. By modeling a fault as an unknown input to the system (e.g., $x_{k+1} = f(x_k, u_k) + E d_k + w_k$, where $d_k$ is the fault), MHE can be formulated to jointly estimate the state trajectory and the fault signal $d_k$. The objective function includes a term that penalizes the magnitude of the estimated fault, corresponding to a prior belief about its statistical properties. This turns MHE into a powerful tool for disturbance reconstruction . The outputs of this estimation process can then be used to generate a residual signal designed to be sensitive to faults while being robust to normal [process and measurement noise](@entry_id:165587). For instance, a fault residual can be constructed from the measurement, the estimated state, and the estimated measurement noise provided by the MHE. By applying a threshold to this residual, a fault detection system can be implemented. The performance of such a detector is characterized by standard metrics like sensitivity (the ability to correctly detect faults) and specificity (the ability to correctly identify fault-free operation) .

#### Cybersecurity Applications

The principles of fault detection via MHE extend directly to the domain of [cybersecurity](@entry_id:262820) for Cyber-Physical Systems. Malicious attacks, such as False Data Injection (FDI) on sensor measurements, manifest as unmodeled disturbances. MHE can be used to detect such attacks by monitoring the statistics of its estimation residuals. Under normal, attack-free operation, the residuals are expected to be small and consistent with the assumed noise distributions. An FDI attack introduces a bias or structure into the residuals that violates these statistical assumptions. A principled detection scheme involves applying a statistical test, such as a chi-square ($\chi^2$) test, to a window of recent residuals. The [test statistic](@entry_id:167372), which is a weighted [sum of squared residuals](@entry_id:174395), follows a central $\chi^2$ distribution under the [null hypothesis](@entry_id:265441) (no attack). In the presence of an attack, the statistic follows a noncentral $\chi^2$ distribution with a larger expected value, allowing for detection when the statistic exceeds a threshold chosen to achieve a desired false alarm rate .

### Synergy with Model Predictive Control (MPC)

MHE and Model Predictive Control (MPC) form a natural and powerful partnership in [modern control systems](@entry_id:269478). MHE provides the accurate state information that MPC requires for prediction, while MPC steers the system toward its objectives.

#### The Estimator-Controller Partnership

In the idealized case of linear systems with quadratic costs and no constraints, a deep duality exists between the optimal controller (LQR) and the [optimal estimator](@entry_id:176428) (Kalman filter), leading to the celebrated [separation principle](@entry_id:176134): the optimal control problem and the [optimal estimation](@entry_id:165466) problem can be solved independently. MHE and MPC generalize this partnership to the nonlinear, constrained case. While the strong [separation principle](@entry_id:176134) no longer holds—the optimal control action may depend on the uncertainty of the estimate, not just the estimate itself—the [certainty equivalence](@entry_id:147361) approach, where the MHE state estimate is fed directly to the MPC as if it were the true state, is a common and effective practical strategy. In this architecture, the estimation error acts as a disturbance to the closed-loop system. The performance and stability of the overall system therefore depend critically on the quality of the MHE estimate. A more accurate estimate, with a smaller [error bound](@entry_id:161921), leads to better MPC performance and improved [constraint satisfaction](@entry_id:275212) .

#### Robust and Safe Control

A key advantage of the MHE-MPC architecture is the ability to design controllers that are robustly safe. MHE can provide not only a [point estimate](@entry_id:176325) of the state but also a characterization of the estimation uncertainty, for example, in the form of a set-membership bound. This uncertainty information can be systematically propagated into the MPC design. In a tube-based MPC framework, the MHE-provided uncertainty on the initial state is propagated forward along the prediction horizon using the system dynamics, forming a "tube" of possible state trajectories around the nominal one computed by the MPC. To guarantee that the true state will satisfy its constraints for all possible realizations of uncertainty, the MPC solves its optimization problem using tightened constraints. The amount of this "back-off" is determined by the size of the uncertainty tube. A more accurate MHE yields a smaller uncertainty set, a thinner tube, and consequently less restrictive [constraint tightening](@entry_id:174986), allowing the MPC to achieve better performance while maintaining robust [safety guarantees](@entry_id:1131173) .

#### Dual Control: Closing the Loop on Learning

The synergy between estimation and control can be taken a step further in the paradigm of [dual control](@entry_id:1124025), where the controller has the dual objective of both performance (e.g., tracking a reference) and learning (i.e., improving the quality of the estimates). This is particularly relevant when MHE is used for joint state and [parameter estimation](@entry_id:139349). The controller can be designed to deliberately inject inputs that are exciting enough to improve the [identifiability](@entry_id:194150) of uncertain parameters. This is formalized by augmenting the MPC cost function with a term that promotes information gathering. A principled way to do this is to penalize the expected posterior uncertainty of the parameters at the end of the horizon. This uncertainty can be quantified by a scalar measure of the Bayesian Cramér-Rao lower bound on the parameter covariance matrix, which in turn depends on the Fisher Information Matrix (FIM) accumulated over the horizon. For instance, using an A-[optimality criterion](@entry_id:178183), the MPC cost would include a penalty on the trace of the predicted [posterior covariance matrix](@entry_id:753631). By minimizing this dual-objective cost, the MPC finds a control sequence that optimally balances the trade-off between immediate performance and long-term learning, leading to a truly adaptive system .

### Integration with Machine Learning

The rise of machine learning offers new avenues for enhancing physics-based models within the MHE framework, leading to hybrid or "grey-box" estimation schemes that combine the strengths of both approaches.

A naive approach would be to completely replace the physics-based model with a learned surrogate model (e.g., a neural network) and treat it as perfect. This is fraught with peril, as it ignores the inherent uncertainty and potential for non-physical behavior of the learned model, often leading to overfitting to measurement noise. A more principled integration involves using the learned model to augment, rather than replace, the physical model. Several sophisticated strategies exist:

1.  **Semi-Parametric Modeling**: The dynamics can be modeled as the sum of a known physics-based component and an unknown, structured error term. The learned surrogate model is then used to provide a prior or "best guess" for this error term within the MHE objective function. This is typically formulated by adding a [quadratic penalty](@entry_id:637777) for deviations of the estimated error from the surrogate's prediction, effectively treating the surrogate's output as the mean of a Gaussian prior on the [model error](@entry_id:175815) .

2.  **Joint State and Parameter Learning**: If the surrogate model is parameterized (e.g., a neural network with weights $\phi$), its parameters can be included in the MHE decision vector for online adaptation. To prevent these parameters from fluctuating wildly to fit noise in a short data window, this joint estimation problem must be regularized. Proximal regularization penalizes large changes in the parameters between time steps, while complexity regularization (e.g., penalizing the norm of the model's Jacobian) encourages smoother, more generalizable models .

3.  **Physics-Informed Regularization**: Even when using a learned model, known physical laws (e.g., conservation of energy, passivity) can be enforced as soft constraints or penalties within the MHE optimization. For instance, if a system is known to be dissipative, a penalty can be added for any state trajectory that violates a discrete-time [dissipativity](@entry_id:162959) inequality. This biases the estimator toward physically plausible solutions, making it more robust to noise and less likely to produce nonsensical results, even if the learned model itself temporarily suggests non-physical behavior .

### Conclusion

As demonstrated throughout this chapter, Moving Horizon Estimation is far more than a simple state filter. It is a flexible, powerful, and unifying optimization-based framework for inference in dynamic systems. Its ability to handle constraints, nonlinearities, and non-Gaussian uncertainties makes it indispensable for synchronizing digital twins with their physical assets. Its formulation allows for the principled integration of techniques for fault diagnosis, cybersecurity, [robust control](@entry_id:260994), and machine learning. From ensuring the safety of biomedical devices and power converters to enabling large-scale estimation in fusion reactors and networked systems, MHE stands as a critical enabling technology at the intersection of [estimation theory](@entry_id:268624), control engineering, and computer science, poised to address the challenges of increasingly complex and [autonomous systems](@entry_id:173841).