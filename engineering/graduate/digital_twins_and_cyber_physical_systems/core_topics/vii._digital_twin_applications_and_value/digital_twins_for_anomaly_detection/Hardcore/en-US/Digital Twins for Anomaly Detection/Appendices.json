{
    "hands_on_practices": [
        {
            "introduction": "The foundation of model-based anomaly detection lies in quantifying the discrepancy between a physical system's actual behavior and its digital twin's prediction. This practice walks you through the essential first step of this process using the example of a DC motor . You will start with a realistic nonlinear model, linearize it around a nominal operating point to create a tractable model for the twin, and then derive the dynamics of the \"residual\" signal that becomes non-zero in the presence of an anomaly.",
            "id": "4215454",
            "problem": "A cyber-physical system (CPS) consisting of a Direct Current (DC) motor is monitored by a model-based Digital Twin. The physical motor dynamics include viscous and weak cubic friction, back electromotive force, and load torque. The nominal continuous-time nonlinear state-space model uses the state vector $x = [\\omega\\ i]^{\\top}$, the control input $u$, and the output $y$, with \n$$\n\\dot{\\omega} = \\frac{1}{J}\\left(K_{t} i - B \\omega - B_{\\text{nl}} \\omega^{3} - \\tau_{\\text{load}}\\right), \\quad\n\\dot{i} = \\frac{1}{L}\\left(u - R i - K_{e} \\omega\\right), \\quad\ny = \\omega,\n$$\nwhere $\\omega$ is the angular speed and $i$ is the armature current. The Digital Twin uses the same nominal model and the same commanded input $u$ to produce a predicted output $\\hat{y}$. An anomaly is modeled as a small additive disturbance $d(t)$ in the load torque acting on the physical plant only, so that the plant load torque becomes $\\tau_{\\text{load}} + d(t)$ while the Digital Twin uses the nominal $\\tau_{\\text{load}}$.\n\nThe parameters are $J = 0.01$, $B = 0.005$, $B_{\\text{nl}} = 1 \\times 10^{-7}$, $L = 0.05$, $R = 1$, $K_{t} = 0.5$, and $K_{e} = 0.5$. The nominal operating point is characterized by the steady values $\\omega_{0} = 100$, $i_{0} = 1.6$, $u_{0} = 51.6$, and $\\tau_{\\text{load},0} = 0.2$, which satisfy the equilibrium conditions of the nominal model. The residual $r(t)$ is defined as the measured-minus-predicted output difference $r(t) = y(t) - \\hat{y}(t)$.\n\nStarting from the definitions of equilibrium and first-order Taylor expansion (Jacobian linearization) around the operating point $(\\omega_{0}, i_{0}, u_{0})$, perform the following:\n\n1. Derive the linearized small-signal model of the plant and Digital Twin around $(\\omega_{0}, i_{0}, u_{0})$ and identify the matrices $A$, $B$, and $C$ for the nominal model, as well as the disturbance channel $E$ from the anomaly input $d(t)$ to the state dynamics.\n2. Using the linearized models, derive the residual generator dynamics for small anomalies, i.e., the linearized dynamics of the residual $r(t)$ driven by $d(t)$ when the plant and Digital Twin share the same initial condition at the operating point and the same commanded input $u(t)$.\n3. For a constant step anomaly $d(t) = d_{0}$ with $d_{0} = 0.02$ (units of torque), compute the steady-state residual value $r_{\\text{ss}}$ implied by the linearized dynamics. Express the final numerical answer in radians per second and round your answer to four significant figures.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective. The provided model is a standard representation of a DC motor, and the parameters are physically plausible. The task involves standard techniques from control theory: linearization and residual analysis. We first verify that the given operating point $(\\omega_{0}, i_{0}, u_{0}, \\tau_{\\text{load},0}) = (100, 1.6, 51.6, 0.2)$ is an equilibrium of the nominal model by setting the time derivatives to zero:\nFor $\\dot{\\omega} = 0$:\n$$K_{t} i_{0} - B \\omega_{0} - B_{\\text{nl}} \\omega_{0}^{3} - \\tau_{\\text{load},0} = (0.5)(1.6) - (0.005)(100) - (1 \\times 10^{-7})(100)^{3} - 0.2$$\n$$= 0.8 - 0.5 - (10^{-7})(10^{6}) - 0.2 = 0.8 - 0.5 - 0.1 - 0.2 = 0$$\nFor $\\dot{i} = 0$:\n$$u_{0} - R i_{0} - K_{e} \\omega_{0} = 51.6 - (1)(1.6) - (0.5)(100) = 51.6 - 1.6 - 50 = 0$$\nThe equilibrium conditions are satisfied. The problem is valid and we may proceed with the solution.\n\nThe nonlinear state-space model can be written in the form $\\dot{x} = f(x, u)$ with $x = [\\omega\\ i]^{\\top}$.\n$f(x, u) = \\begin{pmatrix} f_1 \\\\ f_2 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{J}\\left(K_{t} i - B \\omega - B_{\\text{nl}} \\omega^{3} - \\tau_{\\text{load}}\\right) \\\\ \\frac{1}{L}\\left(u - R i - K_{e} \\omega\\right) \\end{pmatrix}$.\nThe output is $y = h(x) = \\omega$.\n\n**1. Derivation of the Linearized Model**\n\nThe system is linearized around the operating point $(x_0, u_0)$, where $x_0 = [\\omega_0 \\ i_0]^{\\top} = [100 \\ 1.6]^{\\top}$ and $u_0 = 51.6$. The linearized model is given by $\\delta\\dot{x} = A \\delta x + B \\delta u$, where $\\delta x = x - x_0$ and $\\delta u = u - u_0$. The matrices $A$ and $B$ are the Jacobians of $f$ with respect to $x$ and $u$, evaluated at the operating point.\n\nThe Jacobian matrix $A$ is:\n$$A = \\frac{\\partial f}{\\partial x}\\bigg|_{x_0, u_0} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial \\omega}  \\frac{\\partial f_1}{\\partial i} \\\\ \\frac{\\partial f_2}{\\partial \\omega}  \\frac{\\partial f_2}{\\partial i} \\end{pmatrix}_{x_0, u_0}$$\nThe partial derivatives are:\n$\\frac{\\partial f_1}{\\partial \\omega} = \\frac{1}{J}(-B - 3B_{\\text{nl}}\\omega^2)$. Evaluating at $\\omega_0=100$:\n$\\frac{\\partial f_1}{\\partial \\omega}\\bigg|_{\\omega_0} = \\frac{1}{0.01}(-0.005 - 3(1 \\times 10^{-7})(100)^2) = 100(-0.005 - 0.003) = -0.8$.\n$\\frac{\\partial f_1}{\\partial i} = \\frac{K_t}{J} = \\frac{0.5}{0.01} = 50$.\n$\\frac{\\partial f_2}{\\partial \\omega} = -\\frac{K_e}{L} = -\\frac{0.5}{0.05} = -10$.\n$\\frac{\\partial f_2}{\\partial i} = -\\frac{R}{L} = -\\frac{1}{0.05} = -20$.\nThus, the state matrix $A$ is:\n$$A = \\begin{pmatrix} -0.8  50 \\\\ -10  -20 \\end{pmatrix}$$\n\nThe input matrix $B$ is:\n$$B = \\frac{\\partial f}{\\partial u}\\bigg|_{x_0, u_0} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial u} \\\\ \\frac{\\partial f_2}{\\partial u} \\end{pmatrix}_{x_0, u_0} = \\begin{pmatrix} 0 \\\\ \\frac{1}{L} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{1}{0.05} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 20 \\end{pmatrix}$$\n\nThe output equation is $y = \\omega$, which is already linear in the state variables. The output matrix $C$ is:\n$$C = \\frac{\\partial h}{\\partial x}\\bigg|_{x_0} = \\begin{pmatrix} \\frac{\\partial \\omega}{\\partial \\omega}  \\frac{\\partial \\omega}{\\partial i} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\end{pmatrix}$$\n\nThe anomaly $d(t)$ enters the physical plant dynamics as an additive load torque. The plant's $\\dot{\\omega}$ equation is $\\dot{\\omega}_{\\text{plant}} = \\frac{1}{J}(K_{t} i - B \\omega - B_{\\text{nl}} \\omega^{3} - \\tau_{\\text{load},0} - d(t))$. The disturbance channel matrix $E$ maps the disturbance $d(t)$ to the state dynamics.\n$$E = \\frac{\\partial f}{\\partial d}\\bigg|_{d=0} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial d} \\\\ \\frac{\\partial f_2}{\\partial d} \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{J} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{0.01} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -100 \\\\ 0 \\end{pmatrix}$$\n\n**2. Derivation of the Residual Generator Dynamics**\n\nLet $\\delta x_p(t)$ be the small-signal state deviation of the physical plant and $\\delta \\hat{x}(t)$ be that of the Digital Twin. The linearized models are:\nPlant: $\\delta \\dot{x}_p(t) = A \\delta x_p(t) + B \\delta u(t) + E d(t)$\nTwin: $\\delta \\dot{\\hat{x}}(t) = A \\delta \\hat{x}(t) + B \\delta u(t)$\nThe small-signal outputs are $\\delta y(t) = C \\delta x_p(t)$ and $\\delta \\hat{y}(t) = C \\delta \\hat{x}(t)$.\n\nThe residual is $r(t) = y(t) - \\hat{y}(t) = (y_0 + \\delta y(t)) - (\\hat{y}_0 + \\delta\\hat{y}(t))$. Since the operating points are the same ($y_0 = \\hat{y}_0$), $r(t) = \\delta y(t) - \\delta \\hat{y}(t) = C(\\delta x_p(t) - \\delta \\hat{x}(t))$.\nLet the state error be $e(t) = \\delta x_p(t) - \\delta \\hat{x}(t)$. The dynamics of the state error are found by subtracting the twin's state equation from the plant's state equation:\n$$\\dot{e}(t) = \\delta \\dot{x}_p(t) - \\delta \\dot{\\hat{x}}(t) = (A \\delta x_p + B \\delta u + E d) - (A \\delta \\hat{x} + B \\delta u)$$\n$$\\dot{e}(t) = A(\\delta x_p - \\delta \\hat{x}) + (B - B)\\delta u + E d = A e(t) + E d(t)$$\nThe residual is then given by $r(t) = C e(t)$.\nThe problem states that the initial conditions are the same, so $e(0) = \\delta x_p(0) - \\delta \\hat{x}(0) = 0$.\nThe residual generator is thus the linear time-invariant system:\n$$ \\dot{e}(t) = A e(t) + E d(t), \\quad e(0)=0 $$\n$$ r(t) = C e(t) $$\n\n**3. Computation of the Steady-State Residual**\n\nFor a constant step anomaly $d(t) = d_0 = 0.02$, the steady-state response is found by setting the time derivative of the state error to zero, $\\dot{e}(t) = 0$, assuming the system matrix $A$ is stable. The eigenvalues of $A$ have negative real parts (characteristic equation $\\lambda^2+20.8\\lambda+516=0$), so the system is stable.\nIn steady state, we have $0 = A e_{\\text{ss}} + E d_0$.\nSolving for the steady-state error $e_{\\text{ss}}$:\n$$e_{\\text{ss}} = -A^{-1}E d_0$$\nThe steady-state residual $r_{\\text{ss}}$ is then:\n$$r_{\\text{ss}} = C e_{\\text{ss}} = -C A^{-1} E d_0$$\nThis term, $-C A^{-1} E$, is the DC gain of the system from input $d$ to output $r$.\nFirst, we compute the inverse of $A$:\n$$\\det(A) = (-0.8)(-20) - (50)(-10) = 16 + 500 = 516$$\n$$A^{-1} = \\frac{1}{\\det(A)}\\begin{pmatrix} -20  -50 \\\\ 10  -0.8 \\end{pmatrix} = \\frac{1}{516}\\begin{pmatrix} -20  -50 \\\\ 10  -0.8 \\end{pmatrix}$$\nNow we compute the product $C A^{-1} E$:\n$$C A^{-1} E = \\begin{pmatrix} 1  0 \\end{pmatrix} \\left(\\frac{1}{516}\\begin{pmatrix} -20  -50 \\\\ 10  -0.8 \\end{pmatrix}\\right) \\begin{pmatrix} -100 \\\\ 0 \\end{pmatrix}$$\n$$= \\frac{1}{516} \\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} (-20)(-100) + (-50)(0) \\\\ (10)(-100) + (-0.8)(0) \\end{pmatrix} = \\frac{1}{516} \\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 2000 \\\\ -1000 \\end{pmatrix} = \\frac{2000}{516}$$\nThe steady-state residual is:\n$$r_{\\text{ss}} = - \\frac{2000}{516} d_0$$\nSubstituting $d_0 = 0.02$:\n$$r_{\\text{ss}} = - \\frac{2000}{516} \\times 0.02 = - \\frac{40}{516} \\approx -0.0775193798...$$\nRounding to four significant figures, we get:\n$$r_{\\text{ss}} = -0.07752$$\nThe units are radians per second, the same as for $\\omega$.",
            "answer": "$$\\boxed{-0.07752}$$"
        },
        {
            "introduction": "Generating a residual signal is only half the battle; we need a principled method to decide when its value is significant enough to flag an anomaly. This exercise introduces the core statistical tool for this task: the chi-square ($\\chi^2$) test, a cornerstone of anomaly detection in systems described by Gaussian uncertainties . You will learn to use the residual's covariance matrix to normalize it into a standard test statistic and set a decision threshold to achieve a specific, desired false alarm rate.",
            "id": "4215503",
            "problem": "A digital twin used for anomaly detection in a Cyber-Physical System (CPS) predicts the plant state at discrete time $k$ as $\\hat{x}_{k} \\in \\mathbb{R}^{3}$ with prediction error $e_{k} = x_{k} - \\hat{x}_{k}$. The prediction error is modeled as zero-mean Gaussian with covariance $P_{k} \\in \\mathbb{R}^{3 \\times 3}$. Two physical sensors measure a subset of the state via a linear observation model $y_{k} = C x_{k} + v_{k}$, where $C \\in \\mathbb{R}^{2 \\times 3}$ and $v_{k}$ is zero-mean Gaussian with covariance $R \\in \\mathbb{R}^{2 \\times 2}$, independent of $e_{k}$. The residual is defined as $r_{k} = y_{k} - C \\hat{x}_{k}$. Assume the system is operating nominally (no anomaly), so that the above probabilistic models hold exactly.\n\nYou are given the following numerically specified matrices:\n$$\nP_{k} =\n\\begin{pmatrix}\n0.036  0.012  -0.004 \\\\\n0.012  0.081  \\;\\;0.003 \\\\\n-0.004  0.003  \\;\\;0.25\n\\end{pmatrix},\n\\quad\nC =\n\\begin{pmatrix}\n1  0  0 \\\\\n0  1  0\n\\end{pmatrix},\n\\quad\nR =\n\\begin{pmatrix}\n0.014  0 \\\\\n0  0.019\n\\end{pmatrix}.\n$$\n\nTasks:\n1) From first principles of linear Gaussian models and independence, compute the $2 \\times 2$ residual covariance matrix of $r_{k}$ under nominal operation. Provide the exact numeric matrix.\n\n2) Design a chi-square anomaly detector that flags an anomaly at time $k$ when the quadratic form $q_{k} = r_{k}^{\\top} S_{k}^{-1} r_{k}$ exceeds a threshold $\\gamma(\\alpha)$ chosen to achieve a fixed significance level $\\alpha \\in (0,1)$. Derive a closed-form analytic expression for $\\gamma(\\alpha)$ in terms of $\\alpha$.\n\nAnswer specification:\n- Your final boxed answer must be a single closed-form analytic expression for the chi-square threshold $\\gamma(\\alpha)$, in terms of $\\alpha$ only. Do not include any units in the boxed answer.\n- No rounding is required.",
            "solution": "The problem asks for two things: the covariance matrix of the residual, and a closed-form expression for the chi-square detection threshold.\n\n**1. Residual Covariance Matrix ($S_k$)**\n\nThe residual is defined as the difference between the actual measurement $y_k$ and the measurement predicted by the digital twin, $C \\hat{x}_k$.\n$$ r_k = y_k - C \\hat{x}_k $$\nWe are given the measurement model $y_k = C x_k + v_k$. Substituting this into the residual equation gives:\n$$ r_k = (C x_k + v_k) - C \\hat{x}_k = C(x_k - \\hat{x}_k) + v_k $$\nThe prediction error is $e_k = x_k - \\hat{x}_k$, so the residual can be expressed as a linear combination of the prediction error and the measurement noise:\n$$ r_k = C e_k + v_k $$\nThe residual covariance matrix $S_k$ is the expected value of the outer product of the residual with itself, $S_k = \\mathbb{E}[r_k r_k^\\top]$, since the residual is zero-mean ($\\mathbb{E}[r_k] = C\\mathbb{E}[e_k] + \\mathbb{E}[v_k] = 0$).\n$$ S_k = \\mathbb{E}[(C e_k + v_k)(C e_k + v_k)^\\top] = \\mathbb{E}[C e_k e_k^\\top C^\\top + C e_k v_k^\\top + v_k e_k^\\top C^\\top + v_k v_k^\\top] $$\nThe problem states that the prediction error $e_k$ and measurement noise $v_k$ are independent. Therefore, the cross-terms have zero expectation, i.e., $\\mathbb{E}[C e_k v_k^\\top] = C \\mathbb{E}[e_k] \\mathbb{E}[v_k^\\top] = 0$. The expression simplifies to:\n$$ S_k = C \\mathbb{E}[e_k e_k^\\top] C^\\top + \\mathbb{E}[v_k v_k^\\top] $$\nBy definition, $\\mathbb{E}[e_k e_k^\\top] = P_k$ and $\\mathbb{E}[v_k v_k^\\top] = R$. Thus, the residual covariance is:\n$$ S_k = C P_k C^\\top + R $$\nNow, we substitute the given matrices:\n$$ P_{k} = \\begin{pmatrix} 0.036  0.012  -0.004 \\\\ 0.012  0.081  0.003 \\\\ -0.004  0.003  0.25 \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\end{pmatrix}, \\quad R = \\begin{pmatrix} 0.014  0 \\\\ 0  0.019 \\end{pmatrix} $$\nFirst, compute $C P_k C^\\top$:\n$$ C P_k C^\\top = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\end{pmatrix} \\begin{pmatrix} 0.036  0.012  -0.004 \\\\ 0.012  0.081  0.003 \\\\ -0.004  0.003  0.25 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\end{pmatrix} $$\n$$ = \\begin{pmatrix} 0.036  0.012 \\\\ 0.012  0.081 \\end{pmatrix} $$\nThen, add $R$:\n$$ S_k = \\begin{pmatrix} 0.036  0.012 \\\\ 0.012  0.081 \\end{pmatrix} + \\begin{pmatrix} 0.014  0 \\\\ 0  0.019 \\end{pmatrix} = \\begin{pmatrix} 0.050  0.012 \\\\ 0.012  0.100 \\end{pmatrix} $$\n\n**2. Chi-Square Threshold Derivation ($\\gamma(\\alpha)$)**\n\nThe anomaly score is the quadratic form $q_k = r_k^\\top S_k^{-1} r_k$. Since the residual $r_k$ is a $d=2$ dimensional Gaussian random vector with distribution $\\mathcal{N}(0, S_k)$, the score $q_k$ follows a chi-square distribution with $d=2$ degrees of freedom, i.e., $q_k \\sim \\chi^2_2$.\n\nThe detection threshold $\\gamma(\\alpha)$ is chosen to achieve a false positive rate of $\\alpha$. This means we set the threshold such that the probability of the score exceeding it under nominal conditions ($H_0$) is exactly $\\alpha$:\n$$ \\mathbb{P}(q_k  \\gamma(\\alpha) | H_0) = \\alpha $$\nThis is equivalent to finding the $(1-\\alpha)$-quantile of the $\\chi^2_2$ distribution. Let $F_{\\chi^2_2}(x)$ be the cumulative distribution function (CDF) of the $\\chi^2_2$ distribution. We need to solve:\n$$ F_{\\chi^2_2}(\\gamma(\\alpha)) = 1 - \\alpha $$\nA chi-square distribution with two degrees of freedom is equivalent to an exponential distribution with a rate parameter $\\lambda = 1/2$. The probability density function (PDF) for $x \\ge 0$ is $f(x) = \\frac{1}{2} e^{-x/2}$.\nThe CDF is the integral of the PDF from 0 to $x$:\n$$ F_{\\chi^2_2}(x) = \\int_0^x \\frac{1}{2} e^{-t/2} dt = \\left[ -e^{-t/2} \\right]_0^x = 1 - e^{-x/2} $$\nSubstituting this into our threshold equation:\n$$ 1 - e^{-\\gamma(\\alpha)/2} = 1 - \\alpha $$\n$$ e^{-\\gamma(\\alpha)/2} = \\alpha $$\nTaking the natural logarithm of both sides:\n$$ -\\frac{\\gamma(\\alpha)}{2} = \\ln(\\alpha) $$\nSolving for $\\gamma(\\alpha)$ gives the final closed-form expression:\n$$ \\gamma(\\alpha) = -2 \\ln(\\alpha) $$\nThis expression provides the threshold as a function of the desired significance level $\\alpha$.",
            "answer": "$$ \\boxed{-2 \\ln(\\alpha)} $$"
        },
        {
            "introduction": "A detector's theoretical design must be validated by its practical performance. This final hands-on practice challenges you to implement and evaluate two different anomaly detection strategies for a DC motor system, connecting directly back to the physical model from our first exercise [@problem_id:4215454, @problem_id:4215510]. By deriving and comparing the expected recall of a simple sensor-based detector versus a twin-derived residual detector, you will uncover a crucial, and often counter-intuitive, principle: naively fusing sensor data can sometimes degrade detection performance by amplifying noise.",
            "id": "4215510",
            "problem": "A Direct Current (DC) motor digital twin is deployed online to support anomaly detection in a cyber-physical system. The digital twin uses the fundamental electromechanical relationships of a DC motor and sensor measurements to derive variables that are not directly measured. The foundational base is the following steady-state motor model: the torque equation is $ \\tau = k_t i $, where $ \\tau $ is torque in newton-meter, $ k_t $ is the torque constant in newton-meter per ampere, and $ i $ is the armature current in ampere. The viscous friction model is $ \\tau_f = b \\, \\omega $, where $ \\tau_f $ is friction torque in newton-meter, $ b $ is the viscous friction coefficient in newton-meter-second per radian, and $ \\omega $ is angular speed in radians per second. The mechanical balance at steady state is $ b \\, \\omega + \\tau_{\\mathrm{load}} = \\tau $, where $ \\tau_{\\mathrm{load}} $ is the external load torque in newton-meter. A digital twin may estimate generated torque and a residual by combining $ i $ and $ \\omega $ to compute $ \\hat{\\tau} = k_t \\, i $ and $ \\hat{r} = \\hat{\\tau} - b \\, \\omega - \\tau_{\\mathrm{load},0} $, where $ \\tau_{\\mathrm{load},0} $ is the nominal (expected) load torque in newton-meter.\n\nAssume the following sensing and operation regime:\n- The system is regulated near a fixed setpoint (steady state), so that the inertia term is negligible compared to viscous friction and load torque in the time window of interest.\n- The measured armature current $ i_{\\mathrm{meas}} $ equals the true armature current plus zero-mean Gaussian noise with standard deviation $ \\sigma_i $ in ampere, and the measured speed $ \\omega_{\\mathrm{meas}} $ equals the true speed plus zero-mean Gaussian noise with standard deviation $ \\sigma_\\omega $ in radians per second. These sensor noises are independent of each other and across time.\n- An anomaly of interest is a positive step increase in load torque by $ \\Delta $ in newton-meter (i.e., $ \\Delta  0 $), occurring at an unknown time, while the controller maintains the speed close to its setpoint by adjusting the current.\n\nConsider a scalar-threshold detector for anomalies under this Gaussian sensing model. To isolate the effect of augmentation by the digital twin, compare two detectors:\n1. A detector using only the raw current measurement $ i_{\\mathrm{meas}} $ with an upper-tail threshold chosen to achieve a prescribed false positive rate $ \\alpha $ (as a decimal).\n2. A detector using only the twin-derived residual $ \\hat{r} $ with an upper-tail threshold chosen to achieve the same false positive rate $ \\alpha $.\n\nFor each detector, under normal (non-anomalous) operation, the threshold must be set to achieve the specified false positive rate. Under anomalous operation with the step increase $ \\Delta $, the expected recall is the probability that the scalar feature exceeds its threshold.\n\nTasks:\n- Implement an online twin estimator that consumes a time series of measured current $ i_{\\mathrm{meas}} $ in ampere and measured speed $ \\omega_{\\mathrm{meas}} $ in radians per second, and outputs the estimated torque $ \\hat{\\tau} $ in newton-meter and the residual $ \\hat{r} $ in newton-meter at each time step using the steady-state relationships.\n- Derive, from the stated Gaussian sensing assumptions and the steady-state motor equations, the expected recall for the current-only detector and the residual-only detector when they are both tuned to the same false positive rate $ \\alpha $.\n- Compute the expected improvement in recall, defined as the residual-only recall minus the current-only recall, for the parameter sets below.\n\nUse the following test suite of parameter sets, where each tuple represents $ (k_t, b, \\sigma_i, \\sigma_\\omega, \\Delta, \\alpha, \\tau_{\\mathrm{load},0}) $ with units $ k_t $ in newton-meter per ampere, $ b $ in newton-meter-second per radian, $ \\sigma_i $ in ampere, $ \\sigma_\\omega $ in radians per second, $ \\Delta $ in newton-meter, $ \\alpha $ as a decimal, and $ \\tau_{\\mathrm{load},0 } $ in newton-meter:\n- Test $ 1 $ (general case): $ (0.12, 0.001, 0.05, 0.5, 0.4, 0.01, 1.0) $.\n- Test $ 2 $ (near-zero noise boundary): $ (0.2, 0.002, 0.000001, 0.000001, 0.1, 0.01, 0.5) $.\n- Test $ 3 $ (speed noise dominates): $ (0.1, 0.005, 0.01, 5.0, 0.3, 0.05, 0.8) $.\n- Test $ 4 $ (current noise dominates): $ (0.08, 0.0005, 0.5, 0.1, 0.6, 0.02, 0.3) $.\n- Test $ 5 $ (small anomaly near threshold): $ (0.15, 0.002, 0.02, 0.3, 0.02, 0.05, 0.7) $.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each float rounded to six decimal places, representing the expected improvement in recall for Tests $ 1 $ through $ 5 $ in order (i.e., $ [\\mathrm{impr}_1,\\mathrm{impr}_2,\\mathrm{impr}_3,\\mathrm{impr}_4,\\mathrm{impr}_5] $). Angles must be treated in radians, and all physical quantities must use the units specified above. The program must be self-contained and must not read any external input or files.",
            "solution": "The problem requires a critical comparison of two anomaly detectors for a DC motor system, one based on the raw current measurement and another on a digital twin-derived residual. The goal is to compute the improvement in recall offered by the residual-based detector over the current-based detector, given they are both tuned to the same false positive rate.\n\nFirst, we must formalize the statistical properties of the two detection features under both normal operation (null hypothesis, $H_0$) and anomalous operation (alternative hypothesis, $H_1$). The problem provides the necessary physical models and noise characteristics.\n\nLet $i_{\\mathrm{true}}$ and $\\omega_{\\mathrm{true}}$ be the true armature current and angular speed, respectively. The measured values are given by:\n$$ i_{\\mathrm{meas}} = i_{\\mathrm{true}} + n_i, \\quad n_i \\sim \\mathcal{N}(0, \\sigma_i^2) $$\n$$ \\omega_{\\mathrm{meas}} = \\omega_{\\mathrm{true}} + n_\\omega, \\quad n_\\omega \\sim \\mathcal{N}(0, \\sigma_\\omega^2) $$\nwhere $n_i$ and $n_\\omega$ are independent, zero-mean Gaussian noise terms.\n\nThe two features for detection are the measured current, $f_1 = i_{\\mathrm{meas}}$, and the calculated residual, $f_2 = \\hat{r}$. The residual is defined as:\n$$ \\hat{r} = k_t i_{\\mathrm{meas}} - b \\omega_{\\mathrm{meas}} - \\tau_{\\mathrm{load},0} $$\n\n**Step 1: Analysis under Normal Operation ($H_0$)**\n\nUnder normal, steady-state conditions, the physical system abides by the mechanical balance equation with the nominal load $\\tau_{\\mathrm{load},0}$:\n$$ k_t i_{\\mathrm{true},0} = b \\omega_{\\mathrm{true},0} + \\tau_{\\mathrm{load},0} $$\nHere, the subscript $0$ denotes the normal operating state.\n\n**Distribution of the Current Feature ($i_{\\mathrm{meas}}$) under $H_0$:**\nThe measured current is a Gaussian random variable.\n- Mean: $\\mu_{i,0} = \\mathbb{E}[i_{\\mathrm{meas}}] = \\mathbb{E}[i_{\\mathrm{true},0} + n_i] = i_{\\mathrm{true},0} = (b \\omega_{\\mathrm{true},0} + \\tau_{\\mathrm{load},0})/k_t$.\n- Variance: $\\sigma_{i,0}^2 = \\mathrm{Var}(i_{\\mathrm{meas}}) = \\mathrm{Var}(i_{\\mathrm{true},0} + n_i) = \\sigma_i^2$.\nSo, under $H_0$, $i_{\\mathrm{meas}} \\sim \\mathcal{N}\\left(i_{\\mathrm{true},0}, \\sigma_i^2\\right)$.\n\n**Distribution of the Residual Feature ($\\hat{r}$) under $H_0$:**\nWe substitute the expressions for measured variables into the residual formula:\n$$ \\hat{r} = k_t (i_{\\mathrm{true},0} + n_i) - b (\\omega_{\\mathrm{true},0} + n_\\omega) - \\tau_{\\mathrm{load},0} $$\n$$ \\hat{r} = (k_t i_{\\mathrm{true},0} - b \\omega_{\\mathrm{true},0} - \\tau_{\\mathrm{load},0}) + k_t n_i - b n_\\omega $$\nFrom the steady-state balance equation under $H_0$, the term in parentheses is zero. Thus, the residual simplifies to a linear combination of the noise terms:\n$$ \\hat{r} = k_t n_i - b n_\\omega $$\nAs a linear combination of independent Gaussian variables, $\\hat{r}$ is also Gaussian.\n- Mean: $\\mu_{r,0} = \\mathbb{E}[k_t n_i - b n_\\omega] = k_t \\mathbb{E}[n_i] - b \\mathbb{E}[n_\\omega] = 0$.\n- Variance: $\\sigma_{r,0}^2 = \\mathrm{Var}(k_t n_i - b n_\\omega) = k_t^2 \\mathrm{Var}(n_i) + (-b)^2 \\mathrm{Var}(n_\\omega) = k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2$.\nSo, under $H_0$, $\\hat{r} \\sim \\mathcal{N}\\left(0, k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2\\right)$.\n\n**Step 2: Derivation of Detection Thresholds**\n\nBoth detectors use an upper-tail threshold set to achieve a false positive rate of $\\alpha$. Let $Z \\sim \\mathcal{N}(0, 1)$ be a standard normal variable, and let $z_\\alpha = \\Phi^{-1}(1-\\alpha)$ be the upper $\\alpha$-quantile of the standard normal distribution, where $\\Phi$ is the cumulative distribution function (CDF).\n\n- **Current Detector Threshold ($T_i$):**\n  $P(i_{\\mathrm{meas}}  T_i | H_0) = \\alpha$.\n  Standardizing the variable: $P\\left(\\frac{i_{\\mathrm{meas}} - i_{\\mathrm{true},0}}{\\sigma_i}  \\frac{T_i - i_{\\mathrm{true},0}}{\\sigma_i}\\right) = \\alpha$.\n  This implies $\\frac{T_i - i_{\\mathrm{true},0}}{\\sigma_i} = z_\\alpha$, so $T_i = i_{\\mathrm{true},0} + z_\\alpha \\sigma_i$.\n\n- **Residual Detector Threshold ($T_r$):**\n  $P(\\hat{r}  T_r | H_0) = \\alpha$.\n  Standardizing the variable: $P\\left(\\frac{\\hat{r} - 0}{\\sigma_{r,0}}  \\frac{T_r}{\\sigma_{r,0}}\\right) = \\alpha$.\n  This implies $\\frac{T_r}{\\sigma_{r,0}} = z_\\alpha$, so $T_r = z_\\alpha \\sigma_{r,0} = z_\\alpha \\sqrt{k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2}$.\n\n**Step 3: Analysis under Anomalous Operation ($H_1$)**\n\nUnder $H_1$, the load torque increases by $\\Delta$, so $\\tau_{\\mathrm{load},1} = \\tau_{\\mathrm{load},0} + \\Delta$. The controller adjusts the current to maintain the speed, so we assume $\\omega_{\\mathrm{true},1} \\approx \\omega_{\\mathrm{true},0}$. The new steady-state balance is:\n$$ k_t i_{\\mathrm{true},1} = b \\omega_{\\mathrm{true},0} + \\tau_{\\mathrm{load},1} = b \\omega_{\\mathrm{true},0} + \\tau_{\\mathrm{load},0} + \\Delta $$\nFrom this, the new true current is $i_{\\mathrm{true},1} = \\frac{b \\omega_{\\mathrm{true},0} + \\tau_{\\mathrm{load},0}}{k_t} + \\frac{\\Delta}{k_t} = i_{\\mathrm{true},0} + \\frac{\\Delta}{k_t}$.\nThe anomaly causes a mean shift in the true current.\n\n**Distribution of the Current Feature ($i_{\\mathrm{meas}}$) under $H_1$:**\n- Mean: $\\mu_{i,1} = \\mathbb{E}[i_{\\mathrm{true},1} + n_i] = i_{\\mathrm{true},1} = i_{\\mathrm{true},0} + \\Delta/k_t$.\n- Variance: $\\sigma_{i,1}^2 = \\sigma_i^2$ (noise statistics are unchanged).\nSo, under $H_1$, $i_{\\mathrm{meas}} \\sim \\mathcal{N}\\left(i_{\\mathrm{true},0} + \\Delta/k_t, \\sigma_i^2\\right)$.\n\n**Distribution of the Residual Feature ($\\hat{r}$) under $H_1$:**\n$$ \\hat{r} = k_t (i_{\\mathrm{true},1} + n_i) - b (\\omega_{\\mathrm{true},0} + n_\\omega) - \\tau_{\\mathrm{load},0} $$\n$$ \\hat{r} = (k_t i_{\\mathrm{true},1} - b \\omega_{\\mathrm{true},0} - \\tau_{\\mathrm{load},0}) + k_t n_i - b n_\\omega $$\nSubstituting $k_t i_{\\mathrm{true},1} = b \\omega_{\\mathrm{true},0} + \\tau_{\\mathrm{load},0} + \\Delta$, the parenthetical term becomes $\\Delta$.\n$$ \\hat{r} = \\Delta + k_t n_i - b n_\\omega $$\n- Mean: $\\mu_{r,1} = \\mathbb{E}[\\Delta + k_t n_i - b n_\\omega] = \\Delta$.\n- Variance: $\\sigma_{r,1}^2 = \\mathrm{Var}(\\Delta + k_t n_i - b n_\\omega) = k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2 = \\sigma_{r,0}^2$.\nSo, under $H_1$, $\\hat{r} \\sim \\mathcal{N}\\left(\\Delta, k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2\\right)$.\n\n**Step 4: Calculation of Recall and Improvement**\n\nRecall is the probability of detection given an anomaly, $P(\\text{feature}  \\text{threshold} | H_1)$.\n- **Current Detector Recall ($R_i$):**\n  $R_i = P(i_{\\mathrm{meas}}  T_i | H_1) = P\\left(\\frac{i_{\\mathrm{meas}} - \\mu_{i,1}}{\\sigma_i}  \\frac{T_i - \\mu_{i,1}}{\\sigma_i}\\right)$.\n  The argument of the probability is $\\frac{(i_{\\mathrm{true},0} + z_\\alpha \\sigma_i) - (i_{\\mathrm{true},0} + \\Delta/k_t)}{\\sigma_i} = z_\\alpha - \\frac{\\Delta}{k_t \\sigma_i}$.\n  $R_i = P(Z  z_\\alpha - \\frac{\\Delta}{k_t \\sigma_i}) = \\Phi\\left(- (z_\\alpha - \\frac{\\Delta}{k_t \\sigma_i})\\right) = \\Phi\\left(\\frac{\\Delta}{k_t \\sigma_i} - z_\\alpha\\right)$.\n\n- **Residual Detector Recall ($R_r$):**\n  $R_r = P(\\hat{r}  T_r | H_1) = P\\left(\\frac{\\hat{r} - \\mu_{r,1}}{\\sigma_{r,0}}  \\frac{T_r - \\mu_{r,1}}{\\sigma_{r,0}}\\right)$.\n  The argument of the probability is $\\frac{z_\\alpha \\sigma_{r,0} - \\Delta}{\\sigma_{r,0}} = z_\\alpha - \\frac{\\Delta}{\\sigma_{r,0}}$.\n  $R_r = P(Z  z_\\alpha - \\frac{\\Delta}{\\sigma_{r,0}}) = \\Phi\\left(\\frac{\\Delta}{\\sigma_{r,0}} - z_\\alpha\\right) = \\Phi\\left(\\frac{\\Delta}{\\sqrt{k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2}} - z_\\alpha\\right)$.\n\n**Improvement in Recall ($\\Delta R$):**\nThe final quantity to compute is the difference in recalls, $\\Delta R = R_r - R_i$.\n$$ \\Delta R = \\Phi\\left(\\frac{\\Delta}{\\sqrt{k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2}} - z_\\alpha\\right) - \\Phi\\left(\\frac{\\Delta}{k_t \\sigma_i} - z_\\alpha\\right) $$\nwhere $z_\\alpha = \\Phi^{-1}(1-\\alpha)$. This formula can be directly implemented using the parameters from each test case.\nNotice that the noise term for the residual, $\\sqrt{k_t^2 \\sigma_i^2 + b^2 \\sigma_\\omega^2}$, is always greater than or equal to the effective noise for the current detector (mapped to torque units), $k_t \\sigma_i$. This implies that the signal-to-noise ratio for the residual detector will be less than or equal to that of the current detector. Consequently, the calculated \"improvement\" will be non-positive, illustrating a scenario where naively adding sensor information can degrade performance by introducing more noise.\nThe parameter $\\tau_{\\mathrm{load},0}$ is part of the system's operating context but, as shown in the derivation, cancels out of the final recall calculation.\n\nThe following Python code implements this final formula for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes the expected improvement in recall for a residual-based anomaly detector\n    over a current-only detector for a DC motor digital twin.\n    \"\"\"\n    # Test suite of parameter sets.\n    # Each tuple represents (k_t, b, sigma_i, sigma_omega, Delta, alpha, tau_load_0).\n    test_cases = [\n        # Test 1 (general case)\n        (0.12, 0.001, 0.05, 0.5, 0.4, 0.01, 1.0),\n        # Test 2 (near-zero noise boundary)\n        (0.2, 0.002, 0.000001, 0.000001, 0.1, 0.01, 0.5),\n        # Test 3 (speed noise dominates)\n        (0.1, 0.005, 0.01, 5.0, 0.3, 0.05, 0.8),\n        # Test 4 (current noise dominates)\n        (0.08, 0.0005, 0.5, 0.1, 0.6, 0.02, 0.3),\n        # Test 5 (small anomaly near threshold)\n        (0.15, 0.002, 0.02, 0.3, 0.02, 0.05, 0.7),\n    ]\n\n    results = []\n    for case in test_cases:\n        k_t, b, sigma_i, sigma_omega, Delta, alpha, tau_load_0 = case\n\n        # Calculate z_alpha, the upper alpha-quantile of the standard normal distribution.\n        # z_alpha corresponds to the threshold in standard score units.\n        # P(Z  z_alpha) = alpha, where Z ~ N(0, 1).\n        # This is found using the percent-point function (inverse CDF) at 1-alpha.\n        z_alpha = norm.ppf(1 - alpha)\n\n        # ---- Detector 1: Current-only ----\n        # The change in the mean of the current due to the anomaly Delta is Delta / k_t.\n        # The noise standard deviation of the current measurement is sigma_i.\n        # To compare with the residual (which is in torque units), we can think of the\n        # effective \"signal\" as Delta and the effective noise std dev as k_t * sigma_i.\n        # The signal-to-noise ratio for the current detector is (Delta) / (k_t * sigma_i).\n        snr_i = Delta / (k_t * sigma_i)\n        \n        # The recall for the current detector is P(Z  z_alpha - snr_i), which is\n        # equivalent to Phi(snr_i - z_alpha), where Phi is the standard normal CDF.\n        recall_i = norm.cdf(snr_i - z_alpha)\n\n        # ---- Detector 2: Residual-only ----\n        # The change in the mean of the residual due to the anomaly is Delta.\n        # The noise standard deviation of the residual is sqrt( (k_t*sigma_i)^2 + (b*sigma_omega)^2 ).\n        # This is the variance of k_t*n_i - b*n_omega.\n        sigma_r = np.sqrt((k_t * sigma_i)**2 + (b * sigma_omega)**2)\n        \n        # The signal-to-noise ratio for the residual detector is Delta / sigma_r.\n        snr_r = Delta / sigma_r\n        \n        # The recall for the residual detector is P(Z  z_alpha - snr_r), which is\n        # equivalent to Phi(snr_r - z_alpha).\n        recall_r = norm.cdf(snr_r - z_alpha)\n\n        # --- Improvement in Recall ---\n        # The improvement is defined as residual-only recall minus current-only recall.\n        improvement = recall_r - recall_i\n        \n        results.append(improvement)\n\n    # Format the output as a comma-separated list of floats rounded to 6 decimal places,\n    # enclosed in square brackets.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}