## 引言
随着数字世界与物理世界的深度融合，网络物理系统 (CPS) 已成为关键基础设施（如智能电网、自动驾驶和工业制造）的核心。在这些系统中，确保通信的真实性、数据的完整性和操作的授权性至关重要，任何安全疏忽都可能导致灾难性的物理后果。公钥基础设施 (PKI) 作为建立数字信任的黄金标准，其作用在此背景下愈发凸显。然而，将传统的、为 IT 环境设计的 PKI 直接应用于 CPS 会面临严峻挑战，这源于 CPS 固有的实时性要求、长生命周期的物理资产以及对功能安全与信息安全的紧密耦合。

本文旨在填补这一知识鸿沟，系统性地阐述专为网络物理[系统设计](@entry_id:755777)的[公钥基础设施](@entry_id:1130291)。我们将[超越理论](@entry_id:203777)概念，深入探讨其在复杂、动态环境中的实际部署与管理。在接下来的内容中，您将学习到：

在“原理与机制”一章中，我们将奠定理论基础，详细解释为何 [PKI](@entry_id:1130291) 是保护大规模 CPS 的必然选择，并阐明其在设计时必须遵循的核心原则，例如与物理身份的强绑定、对实时性约束的适应以及失效安全的行为模式。

接着，在“应用与跨学科连接”一章中，我们将展示这些原理如何转化为实际的安全解决方案，包括保护设备通信、利用[硬件安全](@entry_id:169931)模块构建从芯片到云的信任链，以及如何赋能[零信任架构](@entry_id:1134188)等现代安全范式。

最后，通过“动手实践”部分，您将有机会将所学知识付诸实践，通过解决具体问题来加深对证书配置、路径验证和性能分析等关键技能的理解。

通过这一结构化的学习路径，本文将为您构建一个关于 CPS 中 PKI 的完整知识框架，从底层机制到高层架构，为设计和保护下一代网络物理系统提供坚实的指导。

## 原理与机制

在网络物理系统 (CPS) 的安全架构中，[公钥基础设施](@entry_id:1130291) ([PKI](@entry_id:1130291)) 提供了一个基本框架，用于在日益互联的物理世界中建立和管理数字信任。与传统的企业信息技术 (IT) 环境不同，CPS 中的 [PKI](@entry_id:1130291) 必须应对独特的挑战，这些挑战源于物理过程的实时性、安全性与功能的紧密耦合，以及对分布式、长生命周期资产的管理。本章将系统地阐述在 CPS 中设计和部署 PKI 的核心原理和关键机制，从其基本原理延伸到高级架构考虑。

### 为何在网络物理系统中使用[公钥基础设施](@entry_id:1130291)？

在设计大规模分布式系统的认证机制时，一个基本的设计选择是采用对称密钥架构还是非对称密钥（公-私钥）架构。虽然对称密钥在计算上更高效，但在 CPS 规模化部署时会面临严重的[可扩展性](@entry_id:636611)和安全风险。

我们可以通过一个思想实验来理解这一点 。假设一个由 $N_G = 1,000$ 个网关和 $N_D = 100,000$ 台设备组成的 CPS。一种对称密钥方案可能是为每个网关 $G_j$ 分配一个共享的对称密钥 $K_j$，所有分配给该网关的设备（约 $100$ 台）都持有并使用这个密钥进行认证。在这种设计下，系统只需要管理 $1,000$ 个不同的**凭证**（即密钥 $K_j$）。然而，这种设计的安全隐患是巨大的。如果其中任何一台设备被攻破，其存储的密钥 $K_j$ 就会泄露。拥有 $K_j$ 的攻击者便可以冒充该网关下的**所有** $100$ 台设备，向网关发送伪造的[遥测](@entry_id:199548)数据或恶意控制指令。这种一个凭证泄露导致整个设备组被攻破的现象，我们称之为巨大的**爆炸半径 (blast radius)**。此外，密钥轮换（例如，在密钥泄露后）的运维成本极高，需要安全地为该组中的所有 $100$ 台设备重新分发新密钥。

相比之下，**[公钥基础设施](@entry_id:1130291) ([PKI](@entry_id:1130291))** 为每台设备 $D_i$ 分配一个唯一的非对称密钥对 $(sk_i, pk_i)$，其中私钥 $sk_i$ 被安全地存储在设备内部，而公钥 $pk_i$ 则被绑定在一个由**[证书颁发机构](@entry_id:1122212) (CA)** 签发的[数字证书](@entry_id:1123724) $\mathrm{cert}_i$ 中。在这种模式下，系统需要管理的设备级凭证数量是 $N_D = 100,000$ 个。虽然凭证数量更多，但安全性得到了质的提升。如果一台设备的私钥 $sk_i$ 泄露，攻击者只能冒充这一台设备 $D_i$。其他 $99,999$ 台设备的身份仍然是安全的。因此，单次设备泄露的爆炸半径被严格限制在一个身份。此外，[PKI](@entry_id:1130291) 提供了标准的**证书撤销**机制（如证书撤销列表 CRL 或在线证书状态协议 OCSP），使得运维人员可以迅速、精确地使被盗用的凭证失效，从而有效控制损害。这种精细化的身份管理和风险控制能力，使得 [PKI](@entry_id:1130291) 成为保护大规模、关键 CPS 的必然选择。

### CPS 中公钥基础设施的核心原则

虽然 [PKI](@entry_id:1130291) 技术是通用的，但将其应用于 CPS 环境时，必须遵循一系列区别于传统 IT 应用的特定原则。这些原则根植于 CPS 的物理本质。

#### 原则一：与物理身份的强绑定

在 IT 世界中，一个证书可能代表一个网站、一个服务或一个用户。但在 CPS 中，数字身份必须无可辩驳地与一个特定的**物理资产**绑定 。一个证书不仅要证明“这是一个合法的控制器”，更要证明“这是[序列号](@entry_id:165652)为 XYZ、安装在 A 厂房 3 号生产线、校准版本为 1.2.5 的那台控制器”。这种绑定通常通过在设备制造时，利用**[硬件信任根](@entry_id:1125916) (Hardware Root of Trust)**（如[可信平台模块](@entry_id:756204) [TPM](@entry_id:170576) 或硬件安全模块 HSM）生成密钥对，并将其与设备唯一的[元数据](@entry_id:275500)（如[序列号](@entry_id:165652)）一起记录在由制造商签发的初始证书中。这种机制确保了数字世界中的认证操作能够直接映射到物理世界中可审计、可追溯的实体。

#### 原则二：遵循实时性约束

CPS 的核心特征之一是其**实时性**。控制指令的计算和执行必须在严格的时间期限（deadline）内完成，否则可能导致系统不稳定甚至危险。因此，任何在控制回路中执行的安全操作都必须具有可预测且足够短的执行时间。

例如，考虑一个控制周期为 $T_c = 20\,\mathrm{ms}$，控制截止时间为 $D_c = 10\,\mathrm{ms}$ 的安全关键型执行器 。执行器在应用控制输入前，需要验证接收到的指令签名并检查证书状态。假设签名验证耗时 $C_{\mathrm{verify}} = 2\,\mathrm{ms}$，控制算法计算耗时 $C_{\mathrm{ctrl}} = 6\,\mathrm{ms}$。如果采用传统的在线证书状态协议 (OCSP) 进行实时撤销检查，其网络往返时间可能高达 $C_{\mathrm{ocsp}} = 12\,\mathrm{ms}$。那么，执行器完成所有操作的总时间将是 $C_{\mathrm{verify}} + C_{\mathrm{ocsp}} + C_{\mathrm{ctrl}} = 2 + 12 + 6 = 20\,\mathrm{ms}$。这个时间远超过了 $10\,\mathrm{ms}$ 的截止期限，将导致控制失效。

这一分析揭示了一个核心原则：CPS 中的 [PKI](@entry_id:1130291) 机制必须避免在实时路径中引入具有无界或高延迟的操作。替代方案包括使用预先加载的证书撤销列表 (CRL)、OCSP 封套 (OCSP Stapling) 或极短生命周期的证书，这些都将在后续章节中详细讨论。

#### 原则三：安全性的至高无上与失效模式

在安全关键的 CPS 中，信息安全 (security) 和[功能安全](@entry_id:1125387) (safety) 是紧密交织的。一个被篡改的控制指令可能导致物理世界的灾难性后果。因此，当面临不确定性时，系统的默认行为必须优先保证安全。

当证书验证失败时（例如，签名无效、证书过期或被撤销），系统面临一个抉择：是“**失效开放 (fail-open)**”以保证服务的可用性，还是“**失效安全/失效关闭 (fail-secure/fail-safe)**”以保证系统的安全性？对于[安全关键系统](@entry_id:1131166)，答案是明确的：必须选择后者 。接收到一个无法验证其真实性和完整性的指令，等同于接收到一个潜在的恶意指令。此时，正确的响应是拒绝该指令，并使系统进入一个预定义的[安全状态](@entry_id:754485)，例如，保持当前输出、执行安全停车程序或切换到本地自主控制模式 。这种**失效安全**的行为模式将系统从不确定的网络状态中[解耦](@entry_id:160890)，并依赖本地的、可信的逻辑来维持物理安全。一个设计良好的 CPS，其退化模式应是**失效可操作 (fail-operational)** 的，即在隔离不可信的外部输入后，系统仍能利用本地传感器和模型维持关键功能或执行安全的降级操作。

### CPS 设备证书剖析

一个[数字证书](@entry_id:1123724)的核心是其内容和结构。根据广泛采用的 IETF RFC 5280 标准，一个 [X.509](@entry_id:1134152) 证书包含了一系列字段和扩展，它们共同定义了持有者的身份和公钥的授权用途。对于 CPS 设备，这些字段的配置必须精确，以遵循**[最小权限原则](@entry_id:753740)**。

以下是一个为 CPS 设备（例如，仅作为客户端向[数字孪生](@entry_id:171650)平台发起连接，而不接受连接或签署固件）设计的典型证书剖析 ：

*   **基础字段**：包括版本号（必须为 v3 以支持扩展）、唯一的[序列号](@entry_id:165652)、颁发者 CA 的签名算法、颁发者 CA 的可分辨名称 (DN)、证书的有效期 (`notBefore` 和 `notAfter`)、证书主体（设备）的 DN（可以为空）以及主体的公钥信息。

*   **`basicConstraints` (基本约束) 扩展**：此扩展用于区分 CA 和终端实体。对于设备证书，它必须明确指出该证书**不是**一个 CA 证书（即 `cA` 字段必须为 `FALSE`）。这是一个至关重要的安全设置，可以防止设备证书被误用为签发其他证书。

*   **`keyUsage` (密钥用途) 扩展**：此扩展在[密码学](@entry_id:139166)层面限制了公钥的用途。对于一个仅用于认证的设备（例如在 TLS 1.3 握手中），其密钥必须能够用于生成[数字签名](@entry_id:269311)。因此，`digitalSignature` 位必须被设置。由于设备不是 CA，`keyCertSign` (证书签名) 和 `cRLSign` (CRL 签名) 位**绝不能**被设置。将此扩展标记为**关键 (critical)** 是一种安全最佳实践，强制要求依赖方严格执行这些约束。

*   **`extendedKeyUsage` (扩展密钥用途) 扩展**：此扩展在应用层面进一步细化了密钥的用途。对于一个仅作为客户端的设备，此扩展应包含 `id-kp-clientAuth`。根据[最小权限原则](@entry_id:753740)，不应包含 `id-kp-serverAuth` (服务器认证) 或 `id-kp-codeSigning` (代码签名) 等该设备不需要的权限。

*   **`subjectAltName` (SAN, 主体备用名称) 扩展**：在现代 [PKI](@entry_id:1130291) 中，这是指定设备身份的首选方式。相较于结构复杂的主体 DN，SAN 可以包含更适合机器解析的标识符，如 DNS 名称、URI 或符合 IEEE 802.1AR 标准的硬件标识符。如果证书的主体 DN 字段为空，SAN 扩展必须存在且必须被标记为**关键 (critical)**。

*   **`authorityKeyIdentifier` ([AKI](@entry_id:899197), 颁发机构密钥标识符) 扩展**：此扩展通过包含颁发者 CA 证书的公钥标识符，帮助证书路径验证软件快速、无[歧义](@entry_id:276744)地找到正确的颁发者证书，从而构建证书链。它通常是非关键的。

### 信任模型与证书路径验证

一个独立的证书本身没有意义，只有当它能被追溯到一个受信的源头时，它才具有价值。这个源头被称为**信任锚 (trust anchor)**，而连接信任锚和终端实体证书的路径，则由信任模型和验证算法共同定义。

#### 信任模型：构建跨组织的信任网络

在复杂的工业环境中，系统通常涉及多个供应商和多个独立的运营域（如不同的安全域或法人实体）。选择合适的信任模型至关重要 。

*   **严格[分层模型](@entry_id:274952) (Hierarchical CA)**：由一个单一的根 CA 签发所有下级 CA。这种模型简单，路径验证直接，但违反了多组织环境下的**自治性**要求，且根 CA 成为[单点故障](@entry_id:267509)和单点信任。
*   **网状模型 (Mesh CA)**：所有组织的 CA 互相交叉认证。这种模型在规模较小时尚可，但随着组织数量 $N$ 的增加，交叉认证关系的数量以 $\mathcal{O}(N^2)$ 的速度增长，导致管理混乱和路径验证的模糊性。
*   **信任之网 (Web-of-Trust)**：一种去中心化的模型，信任基于个人或实体的相互背书。这种模型缺乏统一的策略和可审计性，不适用于需要严格、确定性验证的工业安全环境。
*   **桥接 CA 模型 (Bridge CA)**：这是一种能够兼顾自治性和互操作性的高级模型。在此模型中，每个组织（如供应商、运营商）都维护自己的分层 [PKI](@entry_id:1130291) 和根 CA。一个中立的**桥接 CA** 负责与各组织的根 CA 进行交叉认证。当需要跨域验证时，证书路径将通过桥接 CA “桥接”到另一个组织的 [PKI](@entry_id:1130291) 中。这种模型的信任关系数量以 $\mathcal{O}(N)$ 的速度增长，易于管理。桥接 CA 也成为一个理想的策略执行点，可以在此强制执行跨域的名称约束和证书策略，完美契合了受监管、多供应商的 CPS 环境的需求。

#### 路径验证机制

无论采用何种信任模型，验证一个证书链的算法是标准化的。依据 RFC 5280，路径验证是一个从信任锚开始，逐级向下直到终端实体证书的、有状态的迭代过程 。对于路径中的每一个证书，验证器必须执行以下检查：
1.  **签名验证**：使用上一级证书（颁发者）的公钥，验证当前证书的数字签名。
2.  **有效期验证**：检查当前验证时间是否在证书的 `notBefore` 和 `notAfter` 时间戳之内。
3.  **名称链验证**：确认当前证书的颁发者名称与上一级证书的主体名称匹配。
4.  **约束检查**：处理并强制执行证书中包含的各种关键扩展，例如 `basicConstraints`（确保中间证书确实是 CA）、`nameConstraints`（限制后续证书中的名称空间）和 `policyConstraints`（强制执行特定的证书策略）。
5.  **撤销状态检查**：确认证书未被其颁发者撤销（详见后文）。

任何一步失败都将导致整个路径验证失败。这个严谨的、逐步积累约束的过程，确保了只有完全符合策略的证书链才会被接受。

#### 可信时间的关键作用

在上述验证步骤中，有效期验证和撤销状态检查都依赖于一个核心要素：**可信的时间**。验证器必须将证书中的时间戳与自己本地的“当前时间”进行比较。如果设备的本地时钟可以被攻击者操纵，整个 [PKI](@entry_id:1130291) 的安全基础就会动摇 。

例如，考虑一个场景：一个设备的证书在第 $20.5$ 天被撤销。该设备在第 $20.3$ 天缓存了一份有效期为 1 天的“良好”状态的 OCSP 响应。在第 $21.2$ 天，一个攻击者通过欺骗[网络时间协议 (NTP)](@entry_id:1128549)，将设备的本地时钟回调了 $0.4$ 天，使其显示为第 $20.8$ 天。当设备此时尝试验证那张已被撤销的证书时：
1.  它首先检查缓存的 OCSP 响应。根据其被篡改的时钟 ($20.8$ 天)，这份在 $20.3$ 天获取、有效期到 $21.3$ 天的响应仍然是“新鲜”的。
2.  设备因此接受了这份状态为“良好”的旧响应，从而错误地接受了一个早已被撤销的证书。

这个例子清楚地表明，不安全的[时钟同步](@entry_id:270075)机制（如未经认证的 NTP）是 [PKI](@entry_id:1130291) 的一个严重漏洞。防御措施包括使用**网络时间安全 (NTS)** 协议来认证时间源，以及在设备本地对时钟的大幅度、非单调变化进行完整性检查。

### 身份生命周期管理

CPS 设备通常具有长达数年甚至数十年的生命周期。其数字身份也必须得到相应周期的管理，这包括从初始部署到最终退役的完整过程。

#### 从出厂到运营：IDevID 与 LDevID

一个设备在其生命周期中可能存在于不同的信任域中。为了解决这个问题，IEEE 802.1AR 标准引入了**初始设备身份 (IDevID)** 和**本地有效设备身份 (LDevID)** 的概念 。

*   **IDevID** 是由设备制造商在出厂时植入的、全球唯一的、不可更改的身份。它通常是一个由制造商 CA 签发的证书，绑定了设备的[硬件信任根](@entry_id:1125916)。IDevID 的作用是向世界证明“我是一台由 XX 制造商生产的、[序列号](@entry_id:165652)为 YYY 的正品设备”。

*   **LDevID** 是设备在部署到特定运营环境（例如，一个工厂、一个电网）后，由该环境的运营者 CA 签发的身份。LDevID 代表了设备在本地网络中的角色、权限和身份。它可以包含特定于该域的策略和名称。

从 IDevID 安全地过渡到 LDevID 的过程称为**引导 (bootstrapping)** 或**入网 (onboarding)**。一个安全的引导协议必须包含以下步骤：
1.  **安全通道建立**：设备通过 TLS 连接到本地网络的注册服务器 (Registrar)，并验证该服务器的证书，以防范[中间人攻击](@entry_id:274933)。
2.  **设备认证**：设备向注册服务器出示其 IDevID 证书，并通过使用其 IDevID 私钥签署一个由服务器提供的**随机质询 (challenge/nonce)**，来证明自己确实是该证书的合法持有者。这可以抵御重放攻击。
3.  **域授权**：仅证明设备是正品还不够，注册服务器还需要确认该设备确实被授权加入本地域。这通常通过一个**凭证 (voucher)** 机制实现。注册服务器从制造商的后端服务获取一个由制造商签名的凭证，该凭证将设备的 IDevID（如[序列号](@entry_id:165652)）与当前注册会话和注册服务器的身份绑定。设备会验证此凭证，确保自己没有被恶意注册到错误的域。
4.  **LDevID 签发**：一旦认证和授权完成，设备会生成一个新的密钥对（或重用 IDevID 的密钥对），并创建一个**证书签名请求 ([CSR](@entry_id:921447))**。注册服务器验证 [CSR](@entry_id:921447) 后，指示本地 CA 签发 LDevID 证书，并将其下发给设备。

完成此过程后，设备便可以使用其 LDevID 在本地网络中进行操作。

#### 证书注册协议

上述引导过程需要一个标准的协议来承载。业界存在多种证书管理协议，它们在安全性、复杂性和对受限环境的适应性方面各有不同 。

*   **SCEP (简单证书注册协议)**：一个较早的协议，其基于共享密码的认证方式较弱，且缺乏内建的强私钥持有证明机制，不推荐用于高安全性的 CPS。
*   **ACME (自动证书管理环境)**：主要为公共 Web 服务器设计，其验证方式（如 HTTP-01 或 DNS-01 挑战）依赖于对公共 DNS 或入站网络连接的控制，这通常不适用于位于私有网络、NAT 之后或只有出站连接的 CPS 设备。
*   **EST (安全传输之上注册)**：一个现代的、基于 HTTPS 的协议。它利用 TLS 提供服务器认证和信道加密。客户端认证可以在 TLS 层完成（如果已有证书）或在 HTTP 层完成（如使用一次性令牌），提供了较好的灵活性。
*   **CMPv2 (证书管理协议第 2 版)**：一个功能非常全面的协议。它支持多种认证方式，包括基于已有证书的签名认证和基于预共享对称密钥的 MAC 认证，非常适合 IDevID/LDevID 的引导场景。它还内建了强私钥持有证明机制，并且其异步[轮询](@entry_id:754431)模式非常适合连接不稳定的网络环境。

对于需要高灵活性和强[安全保证](@entry_id:1131169)的 CPS 设备注册场景，**CMPv2** 和 **EST** 通常是更合适的选择。

#### 私钥生命周期与风险

设备身份的根基是其私钥。保护私钥贯穿其整个生命周期是 [PKI](@entry_id:1130291) 安全的核心 。

*   **生成 (Generation)**：密钥必须在设备内部的[硬件信任根](@entry_id:1125916)中生成，使用高质量的真随机数源。此阶段的主要风险是**完整性**风险，即生成的密钥自身存在[密码学](@entry_id:139166)上的缺陷。
*   **存储 (Storage)**：私钥应被标记为不可导出，并始终存储在[硬件信任根](@entry_id:1125916)的安全边界内。此阶段的主要风险是**机密性**风险，即密钥被物理攻击或软件漏洞窃取。
*   **使用 (Usage)**：对私钥的所有[密码学](@entry_id:139166)操作（如签名）都应在[硬件信任根](@entry_id:1125916)内执行。此阶段的主要风险是**机密性**风险，即通过[侧信道攻击](@entry_id:275985)（如功耗分析、时间分析）泄露密钥信息。
*   **备份 (Backup)**：对于高价值系统，可能需要备份私钥。备份本身引入了巨大的**机密性**风险，因为密钥的副本存在于安全边界之外。对于大多数 CPS 设备，最佳实践是根本不备份私钥，而是依赖于在设备故障时重新注册新设备。
*   **轮换 (Rotation)**：定期更换密钥和证书是一种重要的安全措施。轮换过程如果失败（例如，无法联系 CA 获取新证书），可能导致设备在旧证书过期后无法通信。因此，此阶段的主要风险是**可用性**风险。
*   **销毁 (Destruction)**：当设备退役或密钥被轮换后，必须以不可恢复的方式安全销毁旧私钥。否则，攻击者可能从废弃的设备中恢复密钥，构成**机密性**风险。

一个关键原则是，诸如数字孪生之类的云平台，只应处理和存储设备的公钥及证书，**绝不能**接触、缓存或镜像设备的私钥。

#### 应对泄露：撤销机制

如果一个私钥被怀疑泄露，必须有一种机制来宣告其对应的证书无效。在网络连接受限的 CPS 环境中，选择正确的撤销机制至关重要 。

*   **证书撤销列表 (CRL)**：CA 定期发布一个经其签名的、包含所有已撤销证书[序列号](@entry_id:165652)的列表。客户端下载该列表并进行本地检查。在网络连接[间歇性](@entry_id:275330)的环境中，客户端可能长时间无法获取最新的 CRL，导致其继续接受一个已被撤销的证书（安全风险），或者因本地 CRL 过期而拒绝所有连接（可用性风险）。
*   **在线证书状态协议 (OCSP)**：客户端就单个证书向一个在线的 OCSP 服务器发起查询。如前所述，这在[实时控制](@entry_id:754131)回路中引入了不可接受的延迟。对于连接不稳定的设备，其实时查询的失败率很高，严重影响可用性。

为了克服这些挑战，CPS 的 [PKI](@entry_id:1130291) 设计应优先考虑以下现代撤销机制：

*   **OCSP 封套 (OCSP Stapling)**：服务器（例如，[数字孪生](@entry_id:171650)平台）代替客户端定期向 OCSP 服务器查询自己的证书状态，并将获得的有时间戳的、经 OCSP 服务器签名的响应“钉”在 TLS 握手过程中一并发送给客户端。这样，客户端无需自己进行网络查询，既避免了延迟，也解决了连接不稳定的问题。这是目前在 CPS 和物联网领域推荐的主流方案。

*   **短生命周期证书**：另一种有效的策略是颁发生命周期极短（例如，几小时或几天）的证书。在这种模式下，可以完全放弃撤销检查。因为即使一个密钥被盗用，其危害窗口也被严格限制在证书的短暂生命周期内。服务器需要与 CA 紧密集成，以实现高度自动化的证书申请和更新。这种方法将撤销问题转化为了一个自动化的签发问题，极大地简化了客户端的逻辑。

综上所述，通过理解并应用这些核心原理和机制，设计者可以构建一个既安全又适应 CPS 独特需求的公钥基础设施，为物理世界与数字世界的可靠互动奠定坚实的信任基石。