{
    "hands_on_practices": [
        {
            "introduction": "本练习将为基于残差的异常检测奠定基础。我们将探讨如何将稳态卡尔曼滤波器的创新序列转化为一个检验统计量，以及为何该统计量在正常运行条件下服从卡方（$\\chi^2$）分布。理解这一原理对于设定检测阈值和量化检测器的基线性能（以误报率衡量）至关重要 。",
            "id": "4247729",
            "problem": "考虑一个由数字孪生（DT）监控的信息物理系统（CPS）的离散时间、线性时不变模型，其状态演化和传感由以下公式给出\n$$\nx_{k+1} = A x_{k} + w_{k}, \\quad y_{k} = C x_{k} + v_{k},\n$$\n其中 $x_{k} \\in \\mathbb{R}^{n}$ 是系统状态， $y_{k} \\in \\mathbb{R}^{m}$ 是测量值，$w_{k} \\sim \\mathcal{N}(0,Q)$ 和 $v_{k} \\sim \\mathcal{N}(0,R)$ 是相互独立的零均值高斯噪声，其协方差分别为 $Q \\succ 0$ 和 $R \\succ 0$。该DT采用一个稳态卡尔曼滤波器，其误差协方差 $P \\succeq 0$ 是离散时间代数Riccati方程（DARE）的解。令新息过程定义为\n$$\nz_{k} = y_{k} - C \\hat{x}_{k|k-1},\n$$\n其中 $\\hat{x}_{k|k-1}$ 是卡尔曼滤波器产生的单步预测状态估计。\n\n在无攻击假设下，新息协方差为\n$$\nS = C P C^{\\top} + R.\n$$\n一个基于残差的检测器计算标量检验统计量\n$$\nT_{k} = z_{k}^{\\top} S^{-1} z_{k},\n$$\n并且如果在时刻 $k$ 有 $T_{k}  \\gamma$，则发出警报，其中 $\\gamma  0$ 是一个固定的阈值。\n\n任务：\n- 从高斯随机向量、线性变换的基本定义，以及在DARE解 $P$ 下稳态卡尔曼滤波器新息的特征出发，推导为什么在无攻击假设下，$T_{k}$ 服从自由度为 $m$ 的卡方分布。在你的推导中，明确阐述 $P$ 在确定 $S = C P C^{\\top} + R$ 中的作用，并解释 $S$ 如何影响 $T_{k}$ 的分布。\n- 对于测量维度 $m = 2$ 且检测器阈值为 $\\gamma = 4$ 的情况，计算误报概率\n$$\n\\alpha = \\mathbb{P}\\!\\left( T_{k}  \\gamma \\,\\middle|\\, \\text{no attack} \\right).\n$$\n将 $\\alpha$ 的最终数值表示为一个无量纲小数。将你的答案四舍五入到四位有效数字。",
            "solution": "该系统是离散时间的、线性的，并由高斯过程噪声和测量噪声驱动。在 $Q \\succ 0$ 和 $R \\succ 0$ 的假设下，稳态卡尔曼滤波器提供了一个最优线性估计器，其误差协方差 $P \\succeq 0$ 满足离散时间代数Riccati方程（DARE）。新息过程定义为\n$$\nz_{k} = y_{k} - C \\hat{x}_{k|k-1},\n$$\n其中 $\\hat{x}_{k|k-1}$ 是在融合 $y_{k}$ 之前的单步预测估计。在无攻击假设下，标准的稳态卡尔曼滤波器理论确立了 $z_{k}$ 是一个零均值高斯随机向量，其协方差为\n$$\nS = C P C^{\\top} + R.\n$$\n这一事实源于正交性原理和线性高斯结构：新息分离出了给定先验信息的测量中的不可预测部分。矩阵 $P$ 量化了状态预测的不确定性，因此项 $C P C^{\\top}$ 捕捉了由于状态预测而传播到测量空间的不确定性，而 $R$ 则增加了测量噪声。因此，$S$ 封装了在过去测量的条件下 $y_{k}$ 的总不确定性。\n\n定义白化新息向量\n$$\nu_{k} = S^{-1/2} z_{k},\n$$\n其中 $S^{1/2}$ 是 $S$ 的任意对称正定平方根，满足 $S^{1/2} S^{1/2} = S$。由于在无攻击假设下 $z_{k} \\sim \\mathcal{N}(0,S)$，并且 $S^{-1/2}$ 是一个确定性的线性变换，根据高斯随机变量在线性变换下的性质，可以得出\n$$\nu_{k} \\sim \\mathcal{N}(0, I_{m}),\n$$\n其中 $I_{m}$ 是 $m \\times m$ 的单位矩阵。因此，$u_{k}$ 的分量是独立同分布的标准正态随机变量。检验统计量可以重写为\n$$\nT_{k} = z_{k}^{\\top} S^{-1} z_{k} = \\left( S^{-1/2} z_{k} \\right)^{\\top} \\left( S^{-1/2} z_{k} \\right) = \\| u_{k} \\|^{2}.\n$$\n由于 $\\| u_{k} \\|^{2}$ 是 $m$ 个独立标准正态随机变量的平方和，因此 $T_{k}$ 服从自由度为 $m$ 的卡方分布，记作 $\\chi^{2}_{m}$：\n$$\nT_{k} \\sim \\chi^{2}_{m} \\quad \\text{在无攻击假设下}。\n$$\n通过 $S = C P C^{\\top} + R$，$P$ 的作用是明确的：$P$ 决定了预测不确定性如何映射到测量空间，从而设定了正确的白化变换 $S^{-1/2}$ 来对新息进行归一化。检测阈值 $\\gamma$ 是根据 $T_{k}$ 的分布来选择的，以便对于一个期望的误报概率 $\\alpha$，可以通过 $\\chi^{2}_{m}$ 的逆累积分布函数来设定 $\\gamma$，或者反过来，在给定 $\\gamma$ 的情况下，将 $\\alpha$ 计算为 $\\chi^{2}_{m}$ 分布的尾部概率。\n\n对于数值计算，取 $m = 2$ 和 $\\gamma = 4$。自由度 $m = 2$ 的卡方分布是一个伽马分布，其形状参数为 $k = m/2 = 1$，尺度参数为 $\\theta = 2$。等价地，它是一个速率为 $\\lambda = 1/\\theta = 1/2$ 的指数分布。因此，对于 $X \\sim \\chi^{2}_{2}$，其生存函数（尾部概率）为\n$$\n\\mathbb{P}(X  x) = \\exp\\!\\left( -\\frac{x}{2} \\right).\n$$\n因此，对于阈值 $\\gamma$，误报概率为\n$$\n\\alpha = \\mathbb{P}\\!\\left( T_{k}  \\gamma \\right) = \\exp\\!\\left( -\\frac{\\gamma}{2} \\right) = \\exp(-2).\n$$\n计算 $\\exp(-2)$ 并四舍五入到四位有效数字，得到\n$$\n\\alpha \\approx 0.1353.\n$$\n这个值是无量纲的，因为它是一个概率。",
            "answer": "$$\\boxed{0.1353}$$"
        },
        {
            "introduction": "在基础卡方检测器的基础上，本练习将场景推进到一个更实际的滑动窗口能量检测器。您不仅需要分析其在正常条件下的性能，还要分析其在以高斯过程为模型的隐蔽攻击下的性能。本练习将指导您推导攻击下检验统计量的精确分布，并实现一个算法来计算检测概率，从而将理论分析与量化性能评估联系起来 。",
            "id": "4247799",
            "problem": "考虑一个离散时间线性时不变 (LTI) 线性高斯信息物理系统 (CPS)，其状态估计器由卡尔曼滤波器 (KF) 实现。设时间索引 $k$ 的测量值为 $y_k = H x_k + v_k + a_k$，其中 $x_k$ 是系统状态，$H$ 是已知的测量矩阵，$v_k$ 是协方差为 $R \\succ 0$ 的零均值高斯测量噪声，$a_k$ 是协方差为 $\\Sigma_a \\succeq 0$ 的零均值高斯攻击序列，且与其他所有信号统计独立。KF产生新息序列 $\\nu_k = y_k - H \\hat{x}_{k|k-1}$，其标称（无攻击）新息协方差为 $S = H P^- H^\\top + R \\succ 0$，其中 $P^-$ 是KF的先验状态误差协方差。定义标称白化新息 $w_k = S^{-1/2} \\nu_k$，其中 $S^{-1/2}$ 表示满足 $S^{-1/2} S S^{-1/2} = I$ 的唯一对称正定平方根逆矩阵。\n\n将一个滑动窗口二次能量检测器应用于白化新息：\n$$\nT_t = \\sum_{k=t-m+1}^{t} w_k^\\top w_k,\n$$\n其中窗口长度为整数 $m \\ge 1$。假设KF处于稳态，并且新息序列在标称操作下是时间上不相关的。同时假设攻击过程 $\\{a_k\\}$ 是时间独立的，并且独立于 $\\{v_k\\}$ 和KF的预测误差。如果 $T_t \\ge \\gamma$，检测器在时间 $t$ 发出警报，其中 $\\gamma$ 是为达到指定的虚警概率 (PFA) 而选择的阈值。\n\n任务：\n1) 从KF的标准性质出发，即在标称操作下（$a_k = 0$），新息 $\\nu_k$ 是协方差为 $S$ 的零均值高斯白噪声，推导 $T_t$ 在标称操作下的分布。然后，对于给定的虚警水平 $\\alpha \\in (0,1)$，将阈值 $\\gamma$ 表示为 $\\alpha$ 和问题参数的函数。\n\n2) 在受攻击情况下（$a_k \\sim \\mathcal{N}(0,\\Sigma_a)$，且在 $k$ 上独立），首先描述 $w_k$ 的协方差，然后对其进行对角化，从而推导 $T_t$ 的精确分布。您的推导必须以已知分布的基本随机变量来表示 $T_t$ 的分布作为结论。\n\n3) 设计一个算法，在给定 $(S,\\Sigma_a,m,\\alpha)$ 的条件下，使用您推导出的精确分布计算检测概率 (PD)，其定义为 $\\mathbb{P}(T_t \\ge \\gamma \\mid \\text{attacked})$。您的算法不得依赖于绕过推导的渐近近似；它应从精确的有限样本分布中计算尾部概率。您可以使用适用于高斯随机变量二次型的数值稳定积分表示。\n\n实现要求：\n- 您的程序必须实现该算法，并在以下测试集上进行评估。对于每种情况，计算检测概率（以浮点数表示）。不涉及物理单位。\n- 使用标称新息协方差\n$$\nS = \\begin{bmatrix} 2.0  0.5 \\\\ 0.5  1.5 \\end{bmatrix}.\n$$\n- 测试集参数组 $(\\Sigma_a, m, \\alpha)$:\n  - 案例 1: $\\Sigma_a = \\begin{bmatrix} 0  0 \\\\ 0  0 \\end{bmatrix}$, $m = 10$, $\\alpha = 0.05$.\n  - 案例 2: $\\Sigma_a = 0.2 I_2$, $m = 10$, $\\alpha = 0.05$.\n  - 案例 3: $\\Sigma_a = \\begin{bmatrix} 0.5  0.3 \\\\ 0.3  0.5 \\end{bmatrix}$, $m = 10$, $\\alpha = 0.01$.\n  - 案例 4: $\\Sigma_a = 0.5 I_2$, $m = 1$, $\\alpha = 0.05$.\n  - 案例 5: $\\Sigma_a = 0.1 I_2$, $m = 30$, $\\alpha = 0.05$.\n\n输出规范：\n- 对于每种情况，返回一个在 $[0,1]$ 范围内的浮点数作为检测概率。\n- 您的程序应生成单行输出，其中包含用逗号分隔的结果列表，列表括在方括号内，并四舍五入到六位小数，按案例1到5的顺序排列（例如：\"[0.050000,0.123456,0.987654,0.111111,0.222222]\"）。",
            "solution": "该问题要求在一个信息物理系统遭受隐蔽攻击的情况下，推导并计算一个二次检测器的检测概率。解答按问题陈述的要求分为三部分呈现。\n\n### 第一部分：标称分布与检测阈值\n\n在标称条件下（假设 $H_0$），攻击序列 $a_k$ 为零，即 $a_k = 0$。卡尔曼滤波器 (KF) 的新息序列由 $\\nu_k = y_k - H \\hat{x}_{k|k-1}$ 给出。问题陈述指出，在 $H_0$ 下且 KF 处于稳态时，新息是一个协方差为 $S$ 的零均值高斯白噪声过程，因此 $\\nu_k \\sim \\mathcal{N}(0, S)$。\n\n标称白化新息为 $w_k = S^{-1/2} \\nu_k$，其中 $S^{-1/2}$ 是 $S$ 的对称正定平方根逆矩阵。由于 $\\nu_k$ 是一个高斯随机向量，$w_k$ 也是高斯向量。其均值为 $\\mathbb{E}[w_k] = S^{-1/2} \\mathbb{E}[\\nu_k] = 0$。其协方差为：\n$$\n\\text{Cov}(w_k) = \\mathbb{E}[w_k w_k^\\top] = S^{-1/2} \\mathbb{E}[\\nu_k \\nu_k^\\top] (S^{-1/2})^\\top = S^{-1/2} S S^{-1/2} = I\n$$\n因此，在 $H_0$ 下，白化新息是标准正态向量，$w_k \\sim \\mathcal{N}(0, I_p)$，其中 $p$ 是测量向量 $y_k$ 的维度。根据给定的矩阵 $S$，我们有 $p=2$。\n\n检验统计量 $T_t$ 是这些向量的二次型之和：$T_t = \\sum_{k=t-m+1}^{t} w_k^\\top w_k$。每一项 $w_k^\\top w_k$ 是 $p$ 个独立标准正态随机变量的平方和。根据定义，这服从自由度为 $p$ 的卡方分布，即 $w_k^\\top w_k \\sim \\chi^2_p$。\n\n问题陈述指出，标称新息序列在时间上是不相关的，这意味着序列 $\\{w_k\\}$ 在时间上也是不相关的（并且由于是高斯分布，因此也是独立的）。所以，$T_t$ 是 $m$ 个独立同分布 (i.i.d.) 的随机变量之和，每个变量都服从 $\\chi^2_p$ 分布。独立卡方随机变量的和仍然是卡方随机变量，其自由度是个体自由度之和。因此，检验统计量在 $H_0$ 下的分布是：\n$$\nT_t \\mid H_0 \\sim \\chi^2_{mp}\n$$\n虚警概率 (PFA) 是 $\\alpha = \\mathbb{P}(T_t \\ge \\gamma \\mid H_0)$。因此，阈值 $\\gamma$ 被选为使 $\\chi^2_{mp}$ 分布的上尾概率等于 $\\alpha$ 的值。这可以用卡方分布的分位数函数（或逆累积分布函数）表示，记为 $F_{\\chi^2_{df}}^{-1}(\\cdot)$:\n$$\n\\gamma = F_{\\chi^2_{mp}}^{-1}(1-\\alpha)\n$$\n\n### 第二部分：受攻击时的分布\n\n在受攻击条件下（假设 $H_1$），攻击序列 $a_k$ 是一个协方差为 $\\Sigma_a$ 的零均值高斯过程，即 $a_k \\sim \\mathcal{N}(0, \\Sigma_a)$。新息为 $\\nu_k = y_k - H \\hat{x}_{k|k-1} = (H x_k + v_k - H \\hat{x}_{k|k-1}) + a_k = \\nu_k^{\\text{nom}} + a_k$，其中 $\\nu_k^{\\text{nom}}$ 是标称新息。\n\n鉴于 $a_k$ 独立于所有其他信号，它也独立于 $\\nu_k^{\\text{nom}}$。由于两者都是零均值，受攻击的新息 $\\nu_k$ 也是零均值。其协方差是各协方差之和：\n$$\n\\text{Cov}(\\nu_k \\mid H_1) = \\text{Cov}(\\nu_k^{\\text{nom}}) + \\text{Cov}(a_k) = S + \\Sigma_a\n$$\n在 $H_1$ 下，白化新息 $w_k = S^{-1/2} \\nu_k$ 是一个零均值高斯向量，其协方差为：\n$$\n\\Sigma_w = \\text{Cov}(w_k \\mid H_1) = S^{-1/2} (S + \\Sigma_a) S^{-1/2} = I + S^{-1/2} \\Sigma_a S^{-1/2}\n$$\n我们将这个协方差矩阵表示为 $C = I + S^{-1/2} \\Sigma_a S^{-1/2}$。由于 $S$ 是正定的，$\\Sigma_a$ 是半正定的，所以 $C$ 是一个对称正定矩阵。\n\n项 $w_k^\\top w_k$ 是高斯向量 $w_k \\sim \\mathcal{N}(0, C)$ 的二次型。为了找到它的分布，我们使用特征分解对 $C$ 进行对角化：$C = Q \\Lambda Q^\\top$，其中 $Q$ 是特征向量组成的正交矩阵，$\\Lambda = \\text{diag}(\\lambda_1, \\dots, \\lambda_p)$ 是相应特征值组成的对角矩阵。我们定义一个新的随机向量 $z_k = Q^\\top w_k$。$z_k$ 的协方差是 $\\text{Cov}(z_k) = Q^\\top C Q = Q^\\top (Q \\Lambda Q^\\top) Q = \\Lambda$。因此，$z_k \\sim \\mathcal{N}(0, \\Lambda)$，这意味着其分量 $z_{k,i}$ 是独立的，且 $z_{k,i} \\sim \\mathcal{N}(0, \\lambda_i)$ 的高斯随机变量。\n\n现在，二次型可以表示为：\n$$\nw_k^\\top w_k = (Q z_k)^\\top (Q z_k) = z_k^\\top Q^\\top Q z_k = z_k^\\top z_k = \\sum_{i=1}^{p} z_{k,i}^2\n$$\n每一项 $z_{k,i}^2$ 是一个 $\\mathcal{N}(0, \\lambda_i)$ 变量的平方，其分布为一个自由度的卡方变量乘以 $\\lambda_i$，即 $z_{k,i}^2 \\sim \\lambda_i \\chi^2_1$。\n\n检验统计量为 $T_t = \\sum_{k=t-m+1}^{t} w_k^\\top w_k$。由于攻击过程 $\\{a_k\\}$ 在时间上是独立的，受攻击的新息序列 $\\{\\nu_k\\}$ 也是时间独立的，$\\{w_k\\}$ 同样如此。因此，$T_t$ 是随机变量 $w_k^\\top w_k$ 的 $m$ 次独立同分布抽样之和。\n$$\nT_t = \\sum_{k=t-m+1}^{t} \\sum_{i=1}^{p} z_{k,i}^2 = \\sum_{i=1}^{p} \\sum_{k=t-m+1}^{t} z_{k,i}^2\n$$\n对于固定的索引 $i$，和 $\\sum_{k=t-m+1}^{t} z_{k,i}^2$ 是 $m$ 个独立同分布随机变量的和，每个变量都服从 $\\lambda_i \\chi^2_1$ 分布。这个和在分布上等价于 $\\lambda_i$ 乘以 $m$ 个独立同分布 $\\chi^2_1$ 变量之和，即一个 $\\chi^2_m$ 变量。令 $X_i = \\sum_{k=t-m+1}^{t} (z_{k,i}/\\sqrt{\\lambda_i})^2 \\sim \\chi^2_m$。变量 $\\{X_i\\}_{i=1}^p$ 是独立的。因此，$T_t$ 在受攻击下的分布是独立卡方变量的加权和（一个广义卡方分布）：\n$$\nT_t \\mid H_1 \\sim \\sum_{i=1}^{p} \\lambda_i X_i, \\quad \\text{其中 } X_i \\sim \\chi^2_m \\text{ 是独立的}\n$$\n权重 $\\lambda_i$ 是矩阵 $C = I + S^{-1/2} \\Sigma_a S^{-1/2}$ 的特征值。\n\n### 第三部分：检测概率算法\n\n检测概率 (PD) 为 $\\mathbb{P}(T_t \\ge \\gamma \\mid H_1)$。算法流程如下：\n1.  **计算阈值**: 给定 $m$、$p$ 和 $\\alpha$，计算检测阈值 $\\gamma = F_{\\chi^2_{mp}}^{-1}(1-\\alpha)$。\n2.  **确定权重**: 给定 $S$ 和 $\\Sigma_a$，计算矩阵 $C = I + S^{-1/2}\\Sigma_a S^{-1/2}$ 并求其特征值 $\\lambda_1, \\dots, \\lambda_p$。\n3.  **计算尾部概率**: 计算 $\\text{PD} = \\mathbb{P}(\\sum_{i=1}^p \\lambda_i X_i \\ge \\gamma)$。由于该分布没有闭式累积分布函数 (CDF)，我们使用一种基于特征函数 $\\phi_{T_t}(u) = \\mathbb{E}[e^{juT_t}]$ 反演的数值方法。$X_i \\sim \\chi^2_m$ 的特征函数是 $\\phi_{X_i}(u) = (1 - 2ju)^{-m/2}$。由于独立性，$T_t$ 的特征函数是每一项 $\\lambda_i X_i$ 的特征函数的乘积：\n    $$\n    \\phi_{T_t}(u) = \\prod_{i=1}^{p} \\phi_{X_i}(\\lambda_i u) = \\prod_{i=1}^{p} (1 - 2ju\\lambda_i)^{-m/2}\n    $$\n    Gil-Pelaez反演公式将CDF $F_{T_t}(\\gamma)$ 与其特征函数联系起来：\n    $$\n    F_{T_t}(\\gamma) = \\frac{1}{2} - \\frac{1}{\\pi} \\int_0^\\infty \\text{Im}\\left[ \\frac{e^{-ju\\gamma}\\phi_{T_t}(u)}{u} \\right] du\n    $$\n    检测概率是互补CDF，即 $\\text{PD} = 1 - F_{T_t}(\\gamma)$:\n    $$\n    \\text{PD} = \\frac{1}{2} + \\frac{1}{\\pi} \\int_0^\\infty \\text{Im}\\left[ \\frac{e^{-ju\\gamma}\\phi_{T_t}(u)}{u} \\right] du = \\frac{1}{2} + \\frac{1}{\\pi} \\int_0^\\infty \\frac{\\sin(\\theta(u) - u\\gamma)}{u} A(u) \\,du\n    $$\n    其中 $A(u) = |\\phi_{T_t}(u)| = \\prod_{i=1}^p (1 + 4u^2\\lambda_i^2)^{-m/4}$ 且 $\\theta(u) = \\arg(\\phi_{T_t}(u)) = \\sum_{i=1}^p \\frac{m}{2} \\arctan(2u\\lambda_i)$。该积分通过数值方法计算。算法涉及实现这些步骤，使用数值库来找到分位数 $\\gamma$，计算矩阵运算和特征值，并执行最终的数值积分。",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats, linalg, integrate\n\ndef solve():\n    \"\"\"\n    Computes the probability of detection for a quadratic energy detector\n    in a cyber-physical system under various attack scenarios.\n    \"\"\"\n    # Define the nominal innovation covariance matrix S\n    S = np.array([\n        [2.0, 0.5],\n        [0.5, 1.5]\n    ])\n\n    # Dimension of the measurement vector\n    p = S.shape[0]\n\n    # Test suite parameter sets (Sigma_a, m, alpha)\n    test_cases = [\n        (np.zeros((2, 2)), 10, 0.05),\n        (0.2 * np.eye(2), 10, 0.05),\n        (np.array([[0.5, 0.3], [0.3, 0.5]]), 10, 0.01),\n        (0.5 * np.eye(2), 1, 0.05),\n        (0.1 * np.eye(2), 30, 0.05)\n    ]\n\n    # Pre-compute S^(-1/2) as it is constant for all test cases.\n    # This is done via eigenvalue decomposition for numerical stability and correctness.\n    eigvals_S, eigvecs_S = linalg.eigh(S)\n    D_inv_sqrt = np.diag(1.0 / np.sqrt(eigvals_S))\n    S_inv_sqrt = eigvecs_S @ D_inv_sqrt @ eigvecs_S.T\n\n    results = []\n    for Sigma_a, m, alpha in test_cases:\n        # Part 1: Compute detection threshold gamma from the nominal distribution\n        df_nominal = m * p\n        gamma = stats.chi2.ppf(1 - alpha, df_nominal)\n\n        # Case 1 (no attack): The probability of detection (PD) is equal to the\n        # probability of false alarm (PFA) by definition.\n        if np.all(Sigma_a == 0):\n            results.append(alpha)\n            continue\n\n        # Part 2: Characterize attacked distribution by finding eigenvalues (weights)\n        # Compute covariance C = I + S^(-1/2) * Sigma_a * S^(-1/2)\n        C = np.eye(p) + S_inv_sqrt @ Sigma_a @ S_inv_sqrt\n        \n        # Eigenvalues of C are the weights of the generalized chi-squared distribution.\n        # Use eigvalsh for symmetric matrices.\n        lambdas = linalg.eigvalsh(C)\n\n        # Part 3: Compute Probability of Detection (PD) using Gil-Pelaez formula\n        # PD = P(T_t >= gamma | H1), where T_t follows a generalized chi-squared dist.\n        \n        # Characteristic function phi(u) = A(u) * exp(j * theta(u))\n        # The phase component\n        def theta(u):\n            return np.sum(0.5 * m * np.arctan(2 * u * lambdas))\n\n        # The magnitude component (calculated with logs for numerical stability)\n        def A(u):\n            log_A = np.sum(-0.25 * m * np.log1p(4 * (u**2) * (lambdas**2)))\n            return np.exp(log_A)\n\n        # Define the integrand for the Gil-Pelaez formula.\n        # The integrand is Im[exp(-ju*gamma)*phi(u)/u].\n        def integrand(u):\n            # Analytically determine the limit at u=0 to avoid division by zero.\n            # As u->0, sin(x) ~ x. The integrand approaches m*sum(lambdas) - gamma.\n            if u  1e-12:\n                return m * np.sum(lambdas) - gamma\n            \n            phase = theta(u) - u * gamma\n            magnitude = A(u) / u\n            return magnitude * np.sin(phase)\n\n        # Perform numerical integration from 0 to infinity.\n        # quad is a robust numerical integrator from SciPy.\n        integral_val, _ = integrate.quad(integrand, 0, np.inf, limit=200)\n\n        # Final PD calculation: PD = 0.5 + (1/pi) * integral\n        pd = 0.5 + integral_val / np.pi\n        \n        # Clamp PD to [0, 1] to handle any minor numerical inaccuracies.\n        pd = np.clip(pd, 0, 1)\n\n        results.append(pd)\n\n    # Format output as a single line with 6 decimal places per result.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这个练习将我们的视角转换为一个旨在设计完美隐蔽攻击的成熟攻击者。我们将研究攻击者如何通过协同操纵多个传感器，以对基于线性物理不变量的检测器保持隐形。通过解决这个问题，您将把攻击隐蔽性这一抽象概念与系统约束矩阵的具体代数结构（特别是其零空间）联系起来，并确定攻击者成功所需的最少资源 。",
            "id": "4247770",
            "problem": "一个信息物理系统 (CPS) 由一个数字孪生 (DT) 监控，该数字孪生对从 $n$ 个物理传感器汇集的测量向量 $\\mathbf{y} \\in \\mathbb{R}^{n}$ 强制执行线性不变量。在正常运行情况下，真实状态 $\\mathbf{x} \\in \\mathbb{R}^{n}$ 遵循由约束矩阵 $\\mathbf{A} \\in \\mathbb{R}^{m \\times n}$ 表示的一组 $m$ 个线性不变量，因此有 $\\mathbf{A}\\mathbf{x} = \\mathbf{0}$。DT 使用统计量 $\\mathbf{r} = \\mathbf{A}\\mathbf{y}$ 执行基于残差的监控，其中 $\\mathbf{y} = \\mathbf{x} + \\mathbf{w}$ 且测量噪声 $\\mathbf{w} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma^{2}\\mathbf{I}_{n})$。检测是通过似然比检验 (LRT) 实现的，如果二次型 $J = \\mathbf{r}^{\\top}\\boldsymbol{\\Sigma}_{r}^{-1}\\mathbf{r}$ 超过一个阈值，则拒绝原假设，其中 $\\boldsymbol{\\Sigma}_{r} = \\sigma^{2}\\mathbf{A}\\mathbf{A}^{\\top}$ 是残差协方差。\n\n攻击者通过添加一个支撑集为 $\\operatorname{supp}(\\mathbf{a}) \\subseteq \\{1,2,\\dots,n\\}$ 的攻击向量 $\\mathbf{a} \\in \\mathbb{R}^{n}$，发起一次协同的多传感器操纵，从而产生被攻击的测量值 $\\mathbf{y}^{\\prime} = \\mathbf{x} + \\mathbf{w} + \\mathbf{a}$。攻击者的目标是在测量噪声下于检测层面上保持不变量，即在攻击下检测统计量 $J$ 的分布与正常情况下的分布完全相同。\n\n1. 从高斯噪声模型和基于残差的LRT出发，推导攻击向量 $\\mathbf{a}$ 必须满足的充分必要条件，以使统计量 $J$ 的分布不受攻击影响。你的推导必须明确地将此条件与约束矩阵 $\\mathbf{A}$ 的线性代数结构联系起来。\n\n2. 考虑 $n = 5$ 个传感器和 $m = 2$ 个不变量，其约束矩阵如下\n$$\n\\mathbf{A} = \\begin{pmatrix}\n1  1  0  2  1 \\\\\n0  1  1  1  2\n\\end{pmatrix}.\n$$\n在你在第1部分推导出的条件下，确定为了实现一个在测量噪声下于检测层面上保持不变量的非零攻击 $\\mathbf{a} \\neq \\mathbf{0}$，必须同时操纵的最小传感器数量（即 $\\operatorname{supp}(\\mathbf{a})$ 的最小基数）。\n\n将你的最终答案表示为代表操纵集最小基数的单个整数。无需四舍五入，最终答案中不应包含任何单位。",
            "solution": "问题要求两个主要结果：首先，推导攻击向量 $\\mathbf{a}$ 需满足的条件，使得基于残差的检测统计量 $J$ 在攻击下的分布与在正常（无攻击）情况下的分布相同。其次，将此条件应用于一个具体系统，以找到实现一次非平凡的隐蔽攻击所需的最小被操纵传感器数量。\n\n### 第1部分：隐蔽攻击条件的推导\n\n首先，让我们描述正常情况下的检测统计量 $J$。测量值由 $\\mathbf{y} = \\mathbf{x} + \\mathbf{w}$ 给出，其中 $\\mathbf{x}$ 是真实状态，$\\mathbf{w}$ 是测量噪声。噪声向量 $\\mathbf{w}$ 假定服从多元正态分布，$\\mathbf{w} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma^{2}\\mathbf{I}_{n})$。\n\n残差 $\\mathbf{r}$ 计算为 $\\mathbf{r} = \\mathbf{A}\\mathbf{y}$。代入 $\\mathbf{y}$ 的表达式并利用不变量性质 $\\mathbf{A}\\mathbf{x} = \\mathbf{0}$：\n$$\n\\mathbf{r} = \\mathbf{A}(\\mathbf{x} + \\mathbf{w}) = \\mathbf{A}\\mathbf{x} + \\mathbf{A}\\mathbf{w} = \\mathbf{0} + \\mathbf{A}\\mathbf{w} = \\mathbf{A}\\mathbf{w}\n$$\n由于 $\\mathbf{r}$ 是高斯随机向量 $\\mathbf{w}$ 的线性变换，$\\mathbf{r}$ 也是一个高斯随机向量。其均值为：\n$$\nE[\\mathbf{r}] = E[\\mathbf{A}\\mathbf{w}] = \\mathbf{A}E[\\mathbf{w}] = \\mathbf{A}\\mathbf{0} = \\mathbf{0}\n$$\n其协方差矩阵，记为 $\\boldsymbol{\\Sigma}_{r}$，是：\n$$\n\\boldsymbol{\\Sigma}_{r} = \\operatorname{Cov}(\\mathbf{r}) = E[\\mathbf{r}\\mathbf{r}^{\\top}] - E[\\mathbf{r}]E[\\mathbf{r}]^{\\top} = E[(\\mathbf{A}\\mathbf{w})(\\mathbf{A}\\mathbf{w})^{\\top}] = E[\\mathbf{A}\\mathbf{w}\\mathbf{w}^{\\top}\\mathbf{A}^{\\top}]\n$$\n$$\n\\boldsymbol{\\Sigma}_{r} = \\mathbf{A}E[\\mathbf{w}\\mathbf{w}^{\\top}]\\mathbf{A}^{\\top} = \\mathbf{A}(\\sigma^{2}\\mathbf{I}_{n})\\mathbf{A}^{\\top} = \\sigma^{2}\\mathbf{A}\\mathbf{A}^{\\top}\n$$\n这与问题陈述中给出的定义相符。因此，在正常情况下，残差向量服从分布 $\\mathbf{r} \\sim \\mathcal{N}(\\mathbf{0}, \\boldsymbol{\\Sigma}_{r})$。\n检测统计量是 $J = \\mathbf{r}^{\\top}\\boldsymbol{\\Sigma}_{r}^{-1}\\mathbf{r}$。这是一个零均值多元正态向量的二次型。$J$ 的分布是具有 $m$ 个自由度的中心卡方分布，其中 $m$ 是残差向量 $\\mathbf{r}$ 的维度。我们将其记为 $J \\sim \\chi_{m}^{2}$。\n\n现在，让我们分析受攻击的系统。受攻击的测量向量是 $\\mathbf{y}^{\\prime} = \\mathbf{x} + \\mathbf{w} + \\mathbf{a}$。攻击下的残差 $\\mathbf{r}^{\\prime}$ 是：\n$$\n\\mathbf{r}^{\\prime} = \\mathbf{A}\\mathbf{y}^{\\prime} = \\mathbf{A}(\\mathbf{x} + \\mathbf{w} + \\mathbf{a}) = \\mathbf{A}\\mathbf{x} + \\mathbf{A}\\mathbf{w} + \\mathbf{A}\\mathbf{a} = \\mathbf{A}\\mathbf{w} + \\mathbf{A}\\mathbf{a}\n$$\n项 $\\mathbf{A}\\mathbf{a}$ 是一个常数向量。因此 $\\mathbf{r}^{\\prime}$ 的分布是 $\\mathbf{A}\\mathbf{w}$ 分布的一个平移版本。其均值为：\n$$\nE[\\mathbf{r}^{\\prime}] = E[\\mathbf{A}\\mathbf{w} + \\mathbf{A}\\mathbf{a}] = \\mathbf{A}E[\\mathbf{w}] + \\mathbf{A}\\mathbf{a} = \\mathbf{A}\\mathbf{a}\n$$\n$\\mathbf{r}^{\\prime}$ 的协方差不受常数平移的影响：\n$$\n\\operatorname{Cov}(\\mathbf{r}^{\\prime}) = \\operatorname{Cov}(\\mathbf{A}\\mathbf{w} + \\mathbf{A}\\mathbf{a}) = \\operatorname{Cov}(\\mathbf{A}\\mathbf{w}) = \\boldsymbol{\\Sigma}_{r}\n$$\n所以，在攻击下，残差向量服从分布 $\\mathbf{r}^{\\prime} \\sim \\mathcal{N}(\\mathbf{A}\\mathbf{a}, \\boldsymbol{\\Sigma}_{r})$。\n攻击下的检测统计量 $J^{\\prime}$ 是 $J^{\\prime} = (\\mathbf{r}^{\\prime})^{\\top}\\boldsymbol{\\Sigma}_{r}^{-1}(\\mathbf{r}^{\\prime})$。$J^{\\prime}$ 的分布是一个非中心卡方分布, $J^{\\prime} \\sim \\chi_{m}^{2}(\\lambda)$，具有 $m$ 个自由度和由下式给出的非中心化参数 $\\lambda$：\n$$\n\\lambda = (E[\\mathbf{r}^{\\prime}])^{\\top}\\boldsymbol{\\Sigma}_{r}^{-1}(E[\\mathbf{r}^{\\prime}]) = (\\mathbf{A}\\mathbf{a})^{\\top}\\boldsymbol{\\Sigma}_{r}^{-1}(\\mathbf{A}\\mathbf{a})\n$$\n攻击者的目标是使攻击下的 $J$ 的分布与正常情况下的分布相同。这意味着 $\\chi_{m}^{2}(\\lambda)$ 必须与 $\\chi_{m}^{2}$ 相同。中心卡方分布是非中心卡方分布在非中心化参数为零时的特例。因此，分布相同的条件是 $\\lambda = 0$。\n$$\n(\\mathbf{A}\\mathbf{a})^{\\top}\\boldsymbol{\\Sigma}_{r}^{-1}(\\mathbf{A}\\mathbf{a}) = 0\n$$\n协方差矩阵 $\\boldsymbol{\\Sigma}_{r} = \\sigma^{2}\\mathbf{A}\\mathbf{A}^{\\top}$ 是正定的，前提是矩阵 $\\mathbf{A}$ 具有满行秩（即其 $m$ 行是线性无关的），这是对一组良定义不变量的标准假设。如果 $\\boldsymbol{\\Sigma}_{r}$ 是正定的，其逆矩阵 $\\boldsymbol{\\Sigma}_{r}^{-1}$ 也是正定的。\n对于一个正定矩阵 $\\mathbf{M}$，二次型 $\\mathbf{v}^{\\top}\\mathbf{M}\\mathbf{v}$ 等于零当且仅当向量 $\\mathbf{v}$ 是零向量。在我们的情况中，$\\mathbf{v} = \\mathbf{A}\\mathbf{a}$ 且 $\\mathbf{M} = \\boldsymbol{\\Sigma}_{r}^{-1}$。\n因此，条件 $\\lambda = 0$ 等价于：\n$$\n\\mathbf{A}\\mathbf{a} = \\mathbf{0}\n$$\n这是对攻击向量 $\\mathbf{a}$ 的充分必要条件。用线性代数的术语来说，攻击向量 $\\mathbf{a}$ 必须位于约束矩阵 $\\mathbf{A}$ 的零空间中，即 $\\mathbf{a} \\in \\operatorname{null}(\\mathbf{A})$。\n\n### 第2部分：被操纵传感器的最小数量\n\n给定 $n=5$ 个传感器，$m=2$ 个不变量，以及约束矩阵：\n$$\n\\mathbf{A} = \\begin{pmatrix}\n1  1  0  2  1 \\\\\n0  1  1  1  2\n\\end{pmatrix}\n$$\n我们寻找一个非零攻击向量 $\\mathbf{a} = (a_1, a_2, a_3, a_4, a_5)^{\\top}$，使得 $\\mathbf{A}\\mathbf{a} = \\mathbf{0}$，并且 $\\mathbf{a}$ 中非零分量的数量（其支撑集的基数，即 $|\\operatorname{supp}(\\mathbf{a})|$）被最小化。这个最小数量被称为矩阵 $\\mathbf{A}$ 的 spark，记作 $\\operatorname{spark}(\\mathbf{A})$。它是 $\\mathbf{A}$ 中线性相关的列的最小数量。\n\n设 $\\mathbf{A}$ 的列向量为 $\\mathbf{c}_1, \\mathbf{c}_2, \\mathbf{c}_3, \\mathbf{c}_4, \\mathbf{c}_5$：\n$$\n\\mathbf{c}_1 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\mathbf{c}_2 = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\mathbf{c}_3 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}, \\mathbf{c}_4 = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix}, \\mathbf{c}_5 = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}\n$$\n条件 $\\mathbf{A}\\mathbf{a} = \\mathbf{0}$ 可以写成列向量的线性组合：\n$$\na_1\\mathbf{c}_1 + a_2\\mathbf{c}_2 + a_3\\mathbf{c}_3 + a_4\\mathbf{c}_4 + a_5\\mathbf{c}_5 = \\mathbf{0}\n$$\n我们需要找到此方程中非零系数 $a_i$ 的最小数量。\n\n- **最小基数为1：** 只有一个被操纵传感器（比如 $a_i \\neq 0$）的非零攻击需要 $a_i\\mathbf{c}_i = \\mathbf{0}$。这意味着 $\\mathbf{c}_i = \\mathbf{0}$。检查 $\\mathbf{A}$ 的各列，没有一个是零向量。因此，最小基数必须大于1。\n\n- **最小基数为2：** 有两个被操纵传感器（比如 $a_i \\neq 0$ 和 $a_j \\neq 0$）的非零攻击需要 $a_i\\mathbf{c}_i + a_j\\mathbf{c}_j = \\mathbf{0}$。这等价于 $\\mathbf{c}_i = -\\frac{a_j}{a_i}\\mathbf{c}_j$，意味着列向量 $\\mathbf{c}_i$ 和 $\\mathbf{c}_j$ 必须是线性相关的（共线的）。我们可以检查所有的列向量对。通过观察，没有一个列向量是另一个的标量倍数。例如，对于 $\\mathbf{c}_1 = (1, 0)^{\\top}$，任何标量倍数都是 $(k, 0)^{\\top}$，这与任何其他列向量都不匹配。对于 $\\mathbf{c}_2 = (1, 1)^{\\top}$，其倍数是 $(k, k)^{\\top}$，也不匹配任何其他列向量。这个推理适用于所有向量对。因此，最小基数必须大于2。\n\n- **最小基数为3：** 有三个被操纵传感器（比如 $a_i, a_j, a_k \\neq 0$）的攻击需要 $a_i\\mathbf{c}_i + a_j\\mathbf{c}_j + a_k\\mathbf{c}_k = \\mathbf{0}$。这意味着列向量集合 $\\{\\mathbf{c}_i, \\mathbf{c}_j, \\mathbf{c}_k\\}$ 必须是线性相关的。由于这些列向量是 $\\mathbb{R}^2$ 中的向量，任何三个向量的集合都必然是线性相关的。问题是是否存在一个所有系数都非零的线性组合。让我们测试前三个列向量：$\\{\\mathbf{c}_1, \\mathbf{c}_2, \\mathbf{c}_3\\}$。我们寻找非零标量 $k_1, k_2, k_3$ 使得 $k_1\\mathbf{c}_1 + k_2\\mathbf{c}_2 + k_3\\mathbf{c}_3 = \\mathbf{0}$。\n$$\nk_1\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + k_2\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} + k_3\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n这给出了线性方程组：\n$$\n\\begin{cases} k_1 + k_2 = 0 \\\\ k_2 + k_3 = 0 \\end{cases}\n$$\n从这个方程组，我们得到 $k_1 = -k_2$ 和 $k_3 = -k_2$。我们可以为 $k_2$ 选择一个非零值，例如 $k_2 = -1$。这得到 $k_1 = 1$ 和 $k_3 = 1$。所有三个系数都非零。\n这对应于攻击向量 $\\mathbf{a} = (k_1, k_2, k_3, 0, 0)^{\\top} = (1, -1, 1, 0, 0)^{\\top}$。\n这是一个非零攻击向量，$\\mathbf{a} \\neq \\mathbf{0}$。非零分量的数量是 $3$。让我们验证它是否满足条件 $\\mathbf{A}\\mathbf{a} = \\mathbf{0}$：\n$$\n\\mathbf{A}\\mathbf{a} = \\begin{pmatrix}\n1  1  0  2  1 \\\\\n0  1  1  1  2\n\\end{pmatrix}\n\\begin{pmatrix} 1 \\\\ -1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n= \\begin{pmatrix}\n1(1) + 1(-1) + 0(1) \\\\\n0(1) + 1(-1) + 1(1)\n\\end{pmatrix}\n= \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n条件得到满足。既然我们已经证明了基数为1和2是不可能的，并且我们找到了一个基数为3的有效非零攻击向量，那么同时操纵的最小传感器数量就是 $3$。",
            "answer": "$$\\boxed{3}$$"
        }
    ]
}