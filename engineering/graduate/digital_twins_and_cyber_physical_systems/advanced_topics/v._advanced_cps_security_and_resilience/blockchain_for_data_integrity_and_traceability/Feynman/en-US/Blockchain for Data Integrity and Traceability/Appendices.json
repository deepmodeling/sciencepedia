{
    "hands_on_practices": [
        {
            "introduction": "Blockchain's promise for data traceability in Cyber-Physical Systems is often tempered by its performance limitations. Before architecting a complex system, a fundamental first step is to quantify its operational boundaries. This exercise  guides you through a first-principles derivation of a blockchain's maximum theoretical throughput, connecting core parameters like block gas limit and inter-block time to the practical rate of processing events, such as custody handoffs in a supply chain.",
            "id": "4207042",
            "problem": "A consortium operating a cyber-physical supply chain system maintains Digital Twins of assets (for example, pallets with embedded sensors) and records each custody handoff as an on-chain transaction on an Ethereum Virtual Machine (EVM)-compatible blockchain to ensure data integrity and traceability. Each custody event produces a transaction that consumes, on average, a constant gas cost of $c$ gas. The blockchain enforces a block gas limit $G$, meaning that the sum of the gas used by all transactions included in a single block cannot exceed $G$. The network produces blocks at an average inter-block time of $T_b$ seconds and is continuously saturated with custody events to include.\n\nStarting only from the fundamental definitions that (i) the total gas used by all transactions in a block cannot exceed the block gas limit $G$, and (ii) steady-state throughput is the number of completed events per unit time, derive an expression for the theoretical maximum long-run throughput (in custody events per second) as a function of $G$, $c$, and $T_b$, assuming negligible variance in per-event gas cost, negligible failed transactions, and that the blockchain remains fully utilized at capacity.\n\nThen evaluate your expression for $G=10^{7}$ gas, $c=10^{5}$ gas per custody event, and $T_b=12$ seconds. Express the final throughput in transactions per second as an exact rational number with no units in your final answer.",
            "solution": "The problem asks for the derivation of an expression for the theoretical maximum long-run throughput of a blockchain system used for a cyber-physical supply chain, and its subsequent evaluation for a given set of parameters. The throughput, which we will denote as $\\mathcal{T}$, is defined as the number of completed events (custody handoffs) per unit time.\n\nThe derivation will proceed from the fundamental definitions and constraints provided.\n\n1.  **Maximum Events per Block**:\n    The system is constrained by the block gas limit, $G$, which is the maximum total gas that can be consumed by all transactions within a single block. Each custody event corresponds to a transaction with an average gas cost of $c$. To achieve maximum throughput, the system must operate at full capacity, meaning each block is filled with the maximum possible number of transactions.\n\n    Let $N_{block}$ be the maximum number of custody event transactions that can be included in a single block. The total gas consumed by these transactions is the product of the number of transactions and the cost per transaction, i.e., $N_{block} \\times c$.\n\n    Under the condition of full utilization, this total gas consumption will be equal to the block gas limit $G$.\n    $$N_{block} \\times c = G$$\n    While the number of transactions in any single block must be an integer, $N_{block} = \\lfloor \\frac{G}{c} \\rfloor$, the problem asks for the *long-run* throughput. In performance analysis over extended periods, it is standard and appropriate to use the mean value, approximating $N_{block}$ as a continuous variable. This is justified as the effects of the integer constraint (the floor function) become negligible when averaged over a large number of blocks.\n    Thus, we can express the average maximum number of events per block as:\n    $$N_{block} = \\frac{G}{c}$$\n\n2.  **Throughput Calculation**:\n    The problem states that the average time to produce one block (the inter-block time) is $T_b$. Throughput, $\\mathcal{T}$, is the rate of processing events, i.e., the number of events processed per unit time.\n    Since $N_{block}$ events are processed in an average time interval of $T_b$, the throughput is the ratio of these two quantities:\n    $$\\mathcal{T} = \\frac{\\text{Number of events}}{\\text{Time interval}} = \\frac{N_{block}}{T_b}$$\n    Substituting the expression for $N_{block}$ from the previous step, we obtain the general expression for the maximum long-run throughput:\n    $$\\mathcal{T} = \\frac{(G/c)}{T_b}$$\n    This simplifies to the final symbolic expression for throughput as a function of $G$, $c$, and $T_b$:\n    $$\\mathcal{T} = \\frac{G}{c T_b}$$\n\n3.  **Numerical Evaluation**:\n    The problem provides the following values for the parameters:\n    - Block gas limit, $G = 10^7$ gas.\n    - Gas cost per custody event, $c = 10^5$ gas/event.\n    - Average inter-block time, $T_b = 12$ seconds.\n\n    We substitute these values into the derived throughput expression:\n    $$\\mathcal{T} = \\frac{10^7}{10^5 \\times 12}$$\n    The expression can be simplified by evaluating the powers of $10$:\n    $$\\mathcal{T} = \\frac{10^{7-5}}{12} = \\frac{10^2}{12} = \\frac{100}{12}$$\n    The problem requires the final answer to be an exact rational number. We simplify the fraction by dividing the numerator and the denominator by their greatest common divisor, which is $4$:\n    $$\\mathcal{T} = \\frac{100 \\div 4}{12 \\div 4} = \\frac{25}{3}$$\n    Thus, the theoretical maximum long-run throughput is $\\frac{25}{3}$ custody events (transactions) per second.",
            "answer": "$$\\boxed{\\frac{25}{3}}$$"
        },
        {
            "introduction": "The core of blockchain's integrity guarantee lies in the collision-resistance of its cryptographic hash functions. While we often assume collisions are impossible, a rigorous analysis requires us to quantify this risk. This practice  applies the classic 'birthday problem' from probability theory to a digital twin anchoring scenario, allowing you to calculate the maximum number of records that can be safely secured before the probability of a hash collision exceeds a given safety threshold.",
            "id": "4207086",
            "problem": "A digital twin is a computational representation of a physical asset whose state changes are recorded over time. Consider a cyber-physical system where each digital twin record is anchored to a Distributed Ledger Technology (DLT) system by committing the cryptographic hash of the record’s content. Assume the hash function behaves as an ideal random function under the Random Oracle Model (ROM): for a fixed bit-length $b$, each input is mapped uniformly and independently to one of $M = 2^{b}$ possible outputs.\n\nSuppose $n$ independent records are anchored by hashing each record to a $b$-bit digest and including the digest in a blockchain transaction. Define a collision as the event that two distinct records produce the same digest. Starting only from the ROM assumption and core combinatorial probability principles for sampling with replacement, derive an asymptotic expression for the collision probability $p$ as a function of $n$ and $b$ that is valid in the regime where $n \\ll 2^{b/2}$. Then, using your derived expression, determine the maximum $n$ such that the collision probability satisfies $p \\leq 10^{-6}$ for $b = 256$ in this anchoring scenario. Round your final numerical answer to four significant figures.",
            "solution": "This problem is equivalent to the birthday problem. We are selecting $n$ items (hash values) with replacement from a set of $M$ possibilities, and we want to find the probability of at least one duplication (a collision).\n\nLet $p$ be the probability of at least one collision. It is simpler to first calculate the probability of the complementary event, $p_{nc}$, which is the probability of having no collisions.\n\nThe total number of possible outcomes for hashing $n$ records is $M^n$, since each of the $n$ records can be independently hashed to any of the $M$ values.\n\nFor the event of no collisions, each record must hash to a unique value.\nThe first record can be hashed to any of the $M$ values.\nThe second record must be hashed to one of the remaining $M-1$ values.\nThe third record must be hashed to one of the remaining $M-2$ values.\n...\nThe $n$-th record must be hashed to one of the remaining $M-(n-1)$ values.\n\nThe number of outcomes with no collisions is the product:\n$$N_{nc} = M(M-1)(M-2)\\cdots(M-n+1)$$\nThis is the number of $n$-permutations of $M$, denoted $P(M, n)$.\n\nThe probability of no collision, $p_{nc}$, is the ratio of the number of favorable outcomes to the total number of outcomes:\n$$p_{nc} = \\frac{M(M-1)\\cdots(M-n+1)}{M^n} = \\frac{M}{M} \\cdot \\frac{M-1}{M} \\cdot \\frac{M-2}{M} \\cdots \\frac{M-n+1}{M}$$\nThis can be written as a product:\n$$p_{nc} = \\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{M}\\right)$$\nThe probability of at least one collision, $p$, is therefore:\n$$p = 1 - p_{nc} = 1 - \\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{M}\\right)$$\n\nNow, we must derive an asymptotic expression for $p$ valid in the regime where $n \\ll 2^{b/2} = \\sqrt{M}$. In this regime, $n$ is significantly smaller than $M$, which ensures that $k/M$ is very small for all $k$ in the product ($0 \\leq k < n$).\n\nWe can analyze the natural logarithm of $p_{nc}$:\n$$\\ln(p_{nc}) = \\ln\\left(\\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{M}\\right)\\right) = \\sum_{k=0}^{n-1} \\ln\\left(1 - \\frac{k}{M}\\right)$$\nFor a small value $x$, the Taylor series expansion for the natural logarithm is $\\ln(1-x) = -x - \\frac{x^2}{2} - \\frac{x^3}{3} - \\cdots$. Since $k/M$ is small, we can approximate $\\ln(1 - k/M) \\approx -k/M$.\n$$\\ln(p_{nc}) \\approx \\sum_{k=0}^{n-1} \\left(-\\frac{k}{M}\\right) = -\\frac{1}{M} \\sum_{k=0}^{n-1} k$$\nThe sum of the first $n-1$ non-negative integers is given by the formula $\\frac{(n-1)n}{2}$.\n$$\\ln(p_{nc}) \\approx -\\frac{n(n-1)}{2M}$$\nExponentiating both sides gives an approximation for $p_{nc}$:\n$$p_{nc} \\approx \\exp\\left(-\\frac{n(n-1)}{2M}\\right)$$\nSubstituting this back into the expression for $p$:\n$$p \\approx 1 - \\exp\\left(-\\frac{n(n-1)}{2M}\\right)$$\nThe condition $n \\ll \\sqrt{M}$ implies $n^2 \\ll M$, which means the argument of the exponential function, $y = \\frac{n(n-1)}{2M}$, is very close to zero. We can use the Taylor series expansion for $e^{-y} = 1 - y + \\frac{y^2}{2!} - \\cdots$. For small $y$, we can approximate $e^{-y} \\approx 1-y$.\n$$p \\approx 1 - \\left(1 - \\frac{n(n-1)}{2M}\\right) = \\frac{n(n-1)}{2M}$$\nFor large $n$, we can further approximate $n(n-1) \\approx n^2$, leading to $p \\approx \\frac{n^2}{2M}$. However, the expression $p \\approx \\frac{n(n-1)}{2M}$ is more accurate. Substituting $M = 2^b$, the derived asymptotic expression is:\n$$p \\approx \\frac{n(n-1)}{2 \\cdot 2^b}$$\n\nThis completes the first part of the problem. For the second part, we must find the maximum $n$ such that $p \\leq 10^{-6}$ for a hash bit-length of $b = 256$.\nWe use the derived asymptotic expression:\n$$\\frac{n(n-1)}{2 \\cdot 2^{256}} \\leq 10^{-6}$$\nSince we expect $n$ to be a very large number, the approximation $n(n-1) \\approx n^2$ is highly accurate. The inequality becomes:\n$$\\frac{n^2}{2 \\cdot 2^{256}} \\leq 10^{-6}$$\nSolving for $n$:\n$$n^2 \\leq 2 \\cdot 2^{256} \\cdot 10^{-6}$$\n$$n^2 \\leq 2^{257} \\cdot 10^{-6}$$\n$$n \\leq \\sqrt{2^{257} \\cdot 10^{-6}} = 2^{257/2} \\cdot 10^{-3} = 2^{128.5} \\cdot 10^{-3}$$\nTo compute this value, we use base-10 logarithms:\n$$\\log_{10}(n) \\leq \\log_{10}(2^{128.5} \\cdot 10^{-3})$$\n$$\\log_{10}(n) \\leq \\log_{10}(2^{128.5}) + \\log_{10}(10^{-3})$$\n$$\\log_{10}(n) \\leq 128.5 \\cdot \\log_{10}(2) - 3$$\nUsing the value $\\log_{10}(2) \\approx 0.30102999566$:\n$$\\log_{10}(n) \\leq 128.5 \\cdot (0.30102999566) - 3$$\n$$\\log_{10}(n) \\leq 38.682354442 - 3$$\n$$\\log_{10}(n) \\leq 35.682354442$$\nTo find $n$, we compute $10$ raised to this power:\n$$n \\leq 10^{35.682354442} = 10^{0.682354442} \\cdot 10^{35}$$\n$$n \\leq 4.812328 \\times 10^{35}$$\nThe problem asks for the maximum $n$. Since $n$ must be an integer, the maximum value is $\\lfloor 4.812328 \\times 10^{35} \\rfloor$. We are instructed to round the final numerical answer to four significant figures. This gives:\n$$n_{max} \\approx 4.812 \\times 10^{35}$$\nWe must verify that this value of $n$ is consistent with the regime $n \\ll 2^{b/2}$ used for the derivation.\nHere, $b=256$, so $2^{b/2} = 2^{128}$.\n$$2^{128} = 10^{\\log_{10}(2^{128})} = 10^{128 \\cdot \\log_{10}(2)} \\approx 10^{128 \\cdot 0.30103} \\approx 10^{38.53184} \\approx 3.403 \\times 10^{38}$$\nOur calculated value $n \\approx 4.812 \\times 10^{35}$ is indeed much smaller than $2^{128} \\approx 3.403 \\times 10^{38}$. The ratio is $\\frac{n}{2^{128}} \\approx \\frac{4.812 \\times 10^{35}}{3.403 \\times 10^{38}} \\approx 1.4 \\times 10^{-3}$, which is a small number. Thus, the use of the asymptotic expression is justified.\nThe maximum number of records $n$ that can be anchored while keeping the collision probability below $10^{-6}$ is approximately $4.812 \\times 10^{35}$.",
            "answer": "$$\\boxed{4.812 \\times 10^{35}}$$"
        },
        {
            "introduction": "Integrating blockchain into a safety-critical CPS introduces a crucial trade-off between data integrity and real-time performance. The latency inherent in transaction confirmation can destabilize physical control loops that require timely feedback. This hands-on problem  delves into this challenge by using control theory to determine the maximum allowable blockchain-induced delay a system can tolerate before its phase margin—a key indicator of stability—falls below a critical safety requirement.",
            "id": "4207045",
            "problem": "A safety-critical Cyber-Physical System (CPS) with a synchronized Digital Twin (DT) uses a permissioned blockchain to immutably record each sensed state and control actuation for data integrity and traceability. The physical plant is modeled as a linear time-invariant single-input single-output system with transfer function $P(s)=\\frac{1}{s+1}$, controlled by a continuous-time proportional controller $C(s)=K$ with $K=3$. The blockchain submission is placed in the loop so that the controller commits each control decision to the ledger before actuation, introducing an additional pure transport delay. All non-blockchain latencies in the loop are also modeled as pure delays and are given as: sensor latency $\\delta_{s}=20\\,\\mathrm{ms}$, edge computing time $\\delta_{c}=15\\,\\mathrm{ms}$, network transfer time $\\delta_{n}=10\\,\\mathrm{ms}$, and actuation interface latency $\\delta_{a}=5\\,\\mathrm{ms}$. The blockchain-induced delay is denoted $\\tau_{bc}$. Assume linear time-invariant dynamics and that all delays enter the loop as a single equivalent pure delay in the forward path.\n\nTo maintain safety-critical performance, the required lower bound on the closed-loop phase margin is $\\phi_{\\min}=\\frac{\\pi}{3}$ radians. Use the frequency-domain definitions of open-loop crossover frequency and phase margin, and the effect of a pure time delay on phase, to derive the exact expression for the maximum allowable blockchain-induced delay $\\tau_{bc,\\max}$ that can be added without violating the phase margin requirement. Then evaluate it numerically using the given data.\n\nExpress your final answer in seconds and round to four significant figures. State all angles in radians.",
            "solution": "The system described is a negative feedback control loop. The open-loop transfer function, denoted $L(s)$, is formed by the product of the controller transfer function $C(s)$, the plant transfer function $P(s)$, and the transfer function representing the total pure time delay, $e^{-s\\tau_{total}}$.\n\nThe given components are:\n- Plant transfer function: $P(s) = \\frac{1}{s+1}$\n- Controller transfer function (proportional control): $C(s) = K$, with a given gain $K=3$.\n- Total time delay $\\tau_{total}$ is the sum of all individual delays in the loop.\n\nThe individual delays are: sensor latency $\\delta_{s}=20\\,\\mathrm{ms}$, edge computing time $\\delta_{c}=15\\,\\mathrm{ms}$, network transfer time $\\delta_{n}=10\\,\\mathrm{ms}$, actuation interface latency $\\delta_{a}=5\\,\\mathrm{ms}$, and the blockchain-induced delay $\\tau_{bc}$.\n\nLet's first define the sum of the fixed, non-blockchain delays as $\\tau_{fixed}$:\n$$\n\\tau_{fixed} = \\delta_{s} + \\delta_{c} + \\delta_{n} + \\delta_{a}\n$$\nThe total delay is then:\n$$\n\\tau_{total} = \\tau_{fixed} + \\tau_{bc}\n$$\nThe open-loop transfer function $L(s)$ is constructed as follows:\n$$\nL(s) = C(s) P(s) e^{-s\\tau_{total}} = \\frac{K}{s+1} e^{-s\\tau_{total}}\n$$\nSubstituting the value $K=3$:\n$$\nL(s) = \\frac{3}{s+1} e^{-s\\tau_{total}}\n$$\nTo analyze the phase margin, we must first determine the gain crossover frequency, $\\omega_c$. This is defined as the frequency at which the magnitude of the open-loop transfer function equals unity.\n$$\n|L(j\\omega_c)| = 1\n$$\nWe evaluate the magnitude by setting $s=j\\omega$:\n$$\n|L(j\\omega)| = \\left| \\frac{3}{j\\omega+1} e^{-j\\omega\\tau_{total}} \\right| = \\left| \\frac{3}{j\\omega+1} \\right| |e^{-j\\omega\\tau_{total}}|\n$$\nThe magnitude of the pure delay term, $|e^{-j\\omega\\tau_{total}}|$, is always $1$. The magnitude of the remaining part is:\n$$\n\\left| \\frac{3}{j\\omega+1} \\right| = \\frac{|3|}{|j\\omega+1|} = \\frac{3}{\\sqrt{\\omega^2 + 1^2}}\n$$\nSetting this equal to $1$ at $\\omega = \\omega_c$:\n$$\n\\frac{3}{\\sqrt{\\omega_c^2 + 1}} = 1\n$$\n$$\n3 = \\sqrt{\\omega_c^2 + 1}\n$$\nSquaring both sides yields:\n$$\n9 = \\omega_c^2 + 1\n$$\nSolving for $\\omega_c$:\n$$\n\\omega_c^2 = 8 \\implies \\omega_c = \\sqrt{8} = 2\\sqrt{2} \\, \\mathrm{rad/s}\n$$\nNote that frequency must be non-negative.\n\nNext, we find the phase of the open-loop transfer function, $\\angle L(j\\omega)$. This is the sum of the phase contributions from each term:\n$$\n\\angle L(j\\omega) = \\angle\\left(\\frac{3}{j\\omega+1}\\right) + \\angle(e^{-j\\omega\\tau_{total}})\n$$\nThe phase of the first term is:\n$$\n\\angle\\left(\\frac{3}{j\\omega+1}\\right) = \\angle(3) - \\angle(1+j\\omega) = 0 - \\arctan\\left(\\frac{\\omega}{1}\\right) = -\\arctan(\\omega)\n$$\nThe phase contribution from the time delay is:\n$$\n\\angle(e^{-j\\omega\\tau_{total}}) = -\\omega\\tau_{total}\n$$\nTherefore, the total phase is:\n$$\n\\angle L(j\\omega) = -\\arctan(\\omega) - \\omega\\tau_{total}\n$$\nThe phase margin, $\\phi_m$, is defined by the following relation, with angles in radians:\n$$\n\\phi_m = \\pi + \\angle L(j\\omega_c)\n$$\nSubstituting our expression for the phase at $\\omega_c$:\n$$\n\\phi_m = \\pi - \\arctan(\\omega_c) - \\omega_c\\tau_{total}\n$$\nThe problem requires a minimum phase margin of $\\phi_{\\min} = \\frac{\\pi}{3}$ radians. To find the maximum permissible total delay, $\\tau_{total, \\max}$, we set $\\phi_m$ to this lower bound:\n$$\n\\frac{\\pi}{3} = \\pi - \\arctan(\\omega_c) - \\omega_c\\tau_{total, \\max}\n$$\nWe now solve for $\\tau_{total, \\max}$:\n$$\n\\omega_c\\tau_{total, \\max} = \\pi - \\frac{\\pi}{3} - \\arctan(\\omega_c) = \\frac{2\\pi}{3} - \\arctan(\\omega_c)\n$$\n$$\n\\tau_{total, \\max} = \\frac{\\frac{2\\pi}{3} - \\arctan(\\omega_c)}{\\omega_c}\n$$\nSubstituting $\\omega_c = 2\\sqrt{2}$:\n$$\n\\tau_{total, \\max} = \\frac{\\frac{2\\pi}{3} - \\arctan(2\\sqrt{2})}{2\\sqrt{2}}\n$$\nThe maximum allowable blockchain delay, $\\tau_{bc, \\max}$, is the difference between this maximum total delay and the sum of the fixed delays:\n$$\n\\tau_{bc, \\max} = \\tau_{total, \\max} - \\tau_{fixed}\n$$\nFirst, we calculate the total fixed delay in seconds:\n$$\n\\tau_{fixed} = (20 + 15 + 10 + 5) \\, \\mathrm{ms} = 50 \\, \\mathrm{ms} = 0.050 \\, \\mathrm{s}\n$$\nNow we can write the final symbolic expression for $\\tau_{bc, \\max}$:\n$$\n\\tau_{bc, \\max} = \\frac{\\frac{2\\pi}{3} - \\arctan(2\\sqrt{2})}{2\\sqrt{2}} - 0.050\n$$\nTo obtain the numerical value, we evaluate the terms (using radians for all angles):\n$$\n\\frac{2\\pi}{3} \\approx 2.094395\n$$\n$$\n2\\sqrt{2} \\approx 2.828427\n$$\n$$\n\\arctan(2\\sqrt{2}) \\approx \\arctan(2.828427) \\approx 1.230960\n$$\nSubstituting these values into the expression for $\\tau_{total, \\max}$:\n$$\n\\tau_{total, \\max} \\approx \\frac{2.094395 - 1.230960}{2.828427} = \\frac{0.863435}{2.828427} \\approx 0.305267 \\, \\mathrm{s}\n$$\nFinally, we subtract the fixed delay to find $\\tau_{bc, \\max}$:\n$$\n\\tau_{bc, \\max} \\approx 0.305267 - 0.050 = 0.255267 \\, \\mathrm{s}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\tau_{bc, \\max} \\approx 0.2553 \\, \\mathrm{s}\n$$",
            "answer": "$$\\boxed{0.2553}$$"
        }
    ]
}