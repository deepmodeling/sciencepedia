{
    "hands_on_practices": [
        {
            "introduction": "本练习构成了序贯变化检测的基石。你将从对数似然比这一基本原理出发，从头推导著名的累积和 (CUSUM) 算法，以理解它如何优化地检测过程均值的偏移 。这项实践在统计理论与一个在工程和金融领域广泛应用的强大实用算法之间建立了深刻的联系。",
            "id": "4231270",
            "problem": "一个信息物理系统的数字孪生执行一个单步预测器，并监控新息残差 $\\{r_t\\}_{t \\geq 1}$。在正确指定的模型（无漂移）下，假设 $\\{r_t\\}$ 是独立同分布的高斯变量，均值为零，方差已知，即 $r_t \\sim \\mathcal{N}(0,\\sigma^2)$，其中 $\\sigma^2$ 已知。对应于一个恒定加性偏差的模型漂移导致均值偏移到一个已知的设计值 $\\mu > 0$，因此变化后的残差遵循 $r_t \\sim \\mathcal{N}(\\mu,\\sigma^2)$，而方差保持为 $\\sigma^2$。你将使用单边累积和 (CUSUM) 程序来检测这个正向的偏移。\n\n仅从高斯分布的概率密度函数和似然比的定义出发，执行以下操作：\n\n1. 推导用于检验原假设 $H_0: r_t \\sim \\mathcal{N}(0,\\sigma^2)$ 与备择假设 $H_1: r_t \\sim \\mathcal{N}(\\mu,\\sigma^2)$ 的单样本对数似然比 $\\ell(r_t)$，并使用自然对数将其明确表示为 $r_t$、$\\mu$ 和 $\\sigma^2$ 的函数。\n\n2. 使用序贯变化检测和零点反射原理，推导单边 CUSUM 递归式，该递归式累积 $\\ell(r_t)$ 并在部分和为负时重置为零。将停止时间 $T_h$ 定义为 CUSUM 统计量首次超过固定阈值 $h$（以自然对数单位计量）的索引 $t$。\n\n3. 使用基于矩母函数的 Wald 型近似，并忽略过冲修正，计算所推导的 CUSUM 的受控平均游程长度 $\\mathrm{ARL}_0 \\triangleq \\mathbb{E}_0[T_h]$，其中下标 $0$ 表示在 $H_0$ 下的期望。为进行此计算，取设计参数 $\\mu = 0.5$, $\\sigma = 1$ 和阈值 $h = 8$。将你最终的 $\\mathrm{ARL}_0$ 数值答案四舍五入到四位有效数字，并以样本为单位表示。",
            "solution": "该问题要求对用于检测高斯过程均值偏移的单边累积和 (CUSUM) 程序进行三部分分析。分析将首先验证问题陈述，该陈述已被认定为科学上合理、适定且客观。我们现在将推导必要的组成部分并计算所需的量。\n\n首先，我们推导用于检验原假设 $H_0$ 与备择假设 $H_1$ 的单样本对数似然比 $\\ell(r_t)$。均值为 $\\theta$、方差为 $\\sigma^2$ 的高斯分布的概率密度函数 (PDF) 由下式给出：\n$$f(x; \\theta, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x - \\theta)^2}{2\\sigma^2}\\right)$$\n在原假设 $H_0$ 下，残差 $r_t$ 的分布为 $r_t \\sim \\mathcal{N}(0, \\sigma^2)$，因此其 PDF 为：\n$$f_0(r_t) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{r_t^2}{2\\sigma^2}\\right)$$\n在备择假设 $H_1$ 下，残差 $r_t$ 的分布为 $r_t \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其 PDF 为：\n$$f_1(r_t) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(r_t - \\mu)^2}{2\\sigma^2}\\right)$$\n似然比 $L(r_t)$ 是这两个密度的比值：\n$$L(r_t) = \\frac{f_1(r_t)}{f_0(r_t)} = \\frac{\\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(r_t - \\mu)^2}{2\\sigma^2}\\right)}{\\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{r_t^2}{2\\sigma^2}\\right)} = \\exp\\left(\\frac{r_t^2 - (r_t - \\mu)^2}{2\\sigma^2}\\right)$$\n指数可以简化为：\n$$r_t^2 - (r_t - \\mu)^2 = r_t^2 - (r_t^2 - 2\\mu r_t + \\mu^2) = 2\\mu r_t - \\mu^2$$\n将此代回 $L(r_t)$ 的表达式中，得到：\n$$L(r_t) = \\exp\\left(\\frac{2\\mu r_t - \\mu^2}{2\\sigma^2}\\right)$$\n单样本对数似然比 $\\ell(r_t)$ 是 $L(r_t)$ 的自然对数：\n$$\\ell(r_t) = \\ln(L(r_t)) = \\frac{2\\mu r_t - \\mu^2}{2\\sigma^2} = \\frac{\\mu}{\\sigma^2}r_t - \\frac{\\mu^2}{2\\sigma^2}$$\n这就是所需的对数似然比增量的表达式。\n\n其次，我们定义单边 CUSUM 递归和相关的停止时间。CUSUM 统计量，记为 $S_t$，随时间累积对数似然比增量 $\\ell(r_t)$。“零点反射”原理意味着累积和不允许变为负数；如果变为负数，则重置为零。这由以下递归式捕获：\n$$S_0 = 0$$\n$$S_t = \\max(0, S_{t-1} + \\ell(r_t)) \\quad \\text{for } t \\geq 1$$\n当统计量 $S_t$ 首次超过预定义阈值 $h$ 时，即检测到变化。停止时间 $T_h$ 正式定义为：\n$$T_h \\triangleq \\inf\\{t \\geq 1 : S_t > h\\}$$\n\n第三，我们使用 Wald 型近似计算受控平均游程长度 $\\mathrm{ARL}_0 = \\mathbb{E}_0[T_h]$。该近似基于大偏差理论和更新论证。在受控假设 $H_0$ 下，增量 $\\ell(r_t)$ 的期望值为负：\n$$\\mathbb{E}_0[\\ell(r_t)] = \\mathbb{E}_0\\left[\\frac{\\mu}{\\sigma^2}r_t - \\frac{\\mu^2}{2\\sigma^2}\\right] = \\frac{\\mu}{\\sigma^2}\\mathbb{E}_0[r_t] - \\frac{\\mu^2}{2\\sigma^2} = \\frac{\\mu}{\\sigma^2}(0) - \\frac{\\mu^2}{2\\sigma^2} = -\\frac{\\mu^2}{2\\sigma^2}$$\n由于这种负漂移，统计量 $S_t$ 会频繁重置为 $0$。达到阈值 $h$ 的过程可以看作是一系列更新周期，每个周期产生虚警（即超过 $h$）的概率 $p$ 很小。直到此事件发生的样本数 $T_h$ 近似服从均值为 $1/p$ 的几何分布。因此，$\\mathrm{ARL}_0 \\approx 1/p$。\n\n从 $0$ 开始的过程曾越过边界 $h$ 的概率 $p$ 可以使用与 Wald 恒等式和 Cramér 定理相关的结果来近似。近似值为 $p \\approx \\exp(-\\theta^* h)$，其中 $\\theta^*$ 是方程 $\\mathbb{E}_0[\\exp(\\theta \\ell(r_t))] = 1$ 的非零解。让我们求出这个 $\\theta^*$。\n在 $H_0$ 下 $\\ell(r_t)$ 的矩母函数 (MGF) 是：\n$$\\psi_0(\\theta) = \\mathbb{E}_0[\\exp(\\theta \\ell(r_t))] = \\mathbb{E}_0\\left[\\exp\\left(\\theta \\left(\\frac{\\mu r_t}{\\sigma^2} - \\frac{\\mu^2}{2\\sigma^2}\\right)\\right)\\right] = \\exp\\left(-\\frac{\\theta \\mu^2}{2\\sigma^2}\\right) \\mathbb{E}_0\\left[\\exp\\left(\\frac{\\theta \\mu}{\\sigma^2}r_t\\right)\\right]$$\n期望内的项是在点 $k = \\frac{\\theta \\mu}{\\sigma^2}$ 处求值的正态随机变量 $r_t \\sim \\mathcal{N}(0, \\sigma^2)$ 的 MGF。$\\mathcal{N}(m, s^2)$ 的 MGF 是 $\\exp(mk + s^2k^2/2)$。对于我们的情况，$m=0$ 且 $s^2=\\sigma^2$，所以：\n$$\\mathbb{E}_0\\left[\\exp\\left(\\frac{\\theta \\mu}{\\sigma^2}r_t\\right)\\right] = \\exp\\left(0 \\cdot \\frac{\\theta \\mu}{\\sigma^2} + \\frac{\\sigma^2}{2}\\left(\\frac{\\theta \\mu}{\\sigma^2}\\right)^2\\right) = \\exp\\left(\\frac{\\sigma^2 \\theta^2 \\mu^2}{2\\sigma^4}\\right) = \\exp\\left(\\frac{\\theta^2 \\mu^2}{2\\sigma^2}\\right)$$\n将此代回 $\\psi_0(\\theta)$ 的表达式中：\n$$\\psi_0(\\theta) = \\exp\\left(-\\frac{\\theta \\mu^2}{2\\sigma^2}\\right) \\exp\\left(\\frac{\\theta^2 \\mu^2}{2\\sigma^2}\\right) = \\exp\\left(\\frac{\\mu^2}{2\\sigma^2}(\\theta^2 - \\theta)\\right)$$\n我们寻找解 $\\psi_0(\\theta^*) = 1$ 的非零 $\\theta^*$。这意味着指数必须为零：\n$$\\frac{\\mu^2}{2\\sigma^2}((\\theta^*)^2 - \\theta^*) = 0$$\n因为 $\\mu > 0$ 且 $\\sigma^2 > 0$，这可以简化为 $(\\theta^*)^2 - \\theta^* = 0$，或 $\\theta^*(\\theta^* - 1) = 0$。非零解是 $\\theta^* = 1$。\n当 $\\theta^* = 1$ 时，一个周期内发生虚警的概率为 $p \\approx \\exp(-1 \\cdot h) = \\exp(-h)$。\n因此，受控平均游程长度的近似值为：\n$$\\mathrm{ARL}_0 \\approx \\frac{1}{p} \\approx \\frac{1}{\\exp(-h)} = \\exp(h)$$\n这个近似在 $h$ 较大且忽略过冲时有效。特定的值 $\\mu = 0.5$ 和 $\\sigma=1$ 在这个通用推导中不是必需的，因为 $\\theta^*$ 与它们无关。\n现在，我们使用给定的阈值 $h=8$ 来计算数值：\n$$\\mathrm{ARL}_0 \\approx \\exp(8)$$\n计算 $\\exp(8)$ 的值：\n$$\\exp(8) \\approx 2980.957987...$$\n将此四舍五入到四位有效数字得到 $2981$。结果以样本为单位表示。",
            "answer": "$$\\boxed{2981}$$"
        },
        {
            "introduction": "现实世界中的系统残差很少是独立的；它们通常表现出使标准检测算法失效的自相关性。本练习通过引入“残差白化”这一关键技术来应对这一挑战，将一个复杂的时间序列问题转化回一个可以应用标准方法的简单独立同分布情形 。掌握这项技术使你能够在更真实的网络物理系统监控场景中正确地应用 CUSUM 等检测算法，避免因数据相关性导致的频繁误报。",
            "id": "4231206",
            "problem": "一个信息物理系统的数字孪生对传感器测量值 $y_t$ 进行单步预测 $\\hat{y}_t$，并监测残差 $r_t = y_t - \\hat{y}_t$ 以检测模型漂移。在标称操作下，经验辨识表明残差服从一个一阶自回归（AR(1)）模型 $r_t = \\phi r_{t-1} + \\epsilon_t$，其中 $|\\phi|  1$，新息 $\\epsilon_t$ 是独立同分布（i.i.d.）的高斯变量 $\\epsilon_t \\sim \\mathcal{N}(0, \\sigma_{\\epsilon}^{2})$。在发生漂移时，系统的偏差使新息的均值变为 $\\mu_{\\epsilon} > 0$，而其方差 $\\sigma_{\\epsilon}^{2}$ 和自回归系数 $\\phi$ 保持不变。\n\n为检测新息中的均值上升，通过定义 $w_t = (r_t - \\phi r_{t-1}) / \\sigma_{\\epsilon}$ 来进行残差白化。在标称操作下，$w_t \\sim \\mathcal{N}(0, 1)$ i.i.d.，而在漂移下，$w_t \\sim \\mathcal{N}(\\delta, 1)$ i.i.d.，其中 $\\delta = \\mu_{\\epsilon} / \\sigma_{\\epsilon} > 0$。考虑基于对数似然比增量的单边累积和（CUSUM）检测器\n$$\n\\ell(w_t) = \\ln\\!\\left(\\frac{f_1(w_t)}{f_0(w_t)}\\right),\n$$\n其中 $f_0$ 和 $f_1$ 分别表示 $\\mathcal{N}(0,1)$ 和 $\\mathcal{N}(\\delta, 1)$ 的密度。初始化 $S_0 = 0$ 并更新\n$$\nS_t = \\max\\{0,\\, S_{t-1} + \\ell(w_t)\\},\n$$\n当 $S_t \\ge h$ 时发出警报，其中 $h > 0$ 为固定阈值。\n\n从高斯对数似然比的基本定义和具有负漂移的随机游走越界的大偏差特征出发，推导一个解析表达式，用于计算阈值 $h$。该阈值 $h$ 能够在标称状态下（即 $w_t \\sim \\mathcal{N}(0,1)$），对于从 $S_0 = 0$ 开始的单个监视周期，达到目标误报概率 $\\alpha \\in (0,1)$。你的推导必须从 $\\ell(w_t)$ 的定义开始，经过标称状态下的累积量生成函数，最终得到 $S_t$ 越界概率的标准大偏差近似。将最终的 $h$ 仅表示为 $\\alpha$ 的函数。无需四舍五入。如果推导过程中出现最终阈值与自回归参数 $\\phi$ 和白化所引入的尺度 $\\sigma_{\\epsilon}$ 无关的情况，请明确说明。",
            "solution": "问题陈述被评估为有效。它在科学上基于统计过程控制、时间序列分析和大偏差理论的原理。问题提法恰当，提供了推导所需量所需的所有必要定义、分布和约束。语言客观且数学上精确。没有矛盾、歧义或缺失信息。因此，我们可以进行推导。\n\n目标是从基本定义出发，为CUSUM阈值 $h$ 推导出一个解析表达式，使其能够产生指定的误报概率 $\\alpha$。误报发生在标称状态下（零假设，$H_0$），此时白化残差 $w_t$ 是独立同分布的（i.i.d.），即 $w_t \\sim \\mathcal{N}(0, 1)$。\n\n首先，我们推导对数似然比增量 $\\ell(w_t)$ 的表达式。标称状态（$f_0$）和漂移状态（$f_1$）的概率密度函数（PDF）分别由标准正态分布和移位正态分布给出：\n$$\nf_0(w_t) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{w_t^2}{2}\\right) \\quad \\text{for } w_t \\sim \\mathcal{N}(0, 1)\n$$\n$$\nf_1(w_t) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(w_t - \\delta)^2}{2}\\right) \\quad \\text{for } w_t \\sim \\mathcal{N}(\\delta, 1)\n$$\n对数似然比增量 $\\ell(w_t)$ 定义为：\n$$\n\\ell(w_t) = \\ln\\left(\\frac{f_1(w_t)}{f_0(w_t)}\\right) = \\ln\\left( \\frac{\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(w_t - \\delta)^2}{2}\\right)}{\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{w_t^2}{2}\\right)} \\right)\n$$\n简化对数内的表达式：\n$$\n\\ell(w_t) = \\ln\\left( \\exp\\left(-\\frac{(w_t - \\delta)^2}{2} + \\frac{w_t^2}{2}\\right) \\right) = -\\frac{(w_t - \\delta)^2}{2} + \\frac{w_t^2}{2}\n$$\n展开平方项：\n$$\n\\ell(w_t) = -\\frac{w_t^2 - 2\\delta w_t + \\delta^2}{2} + \\frac{w_t^2}{2} = -\\frac{w_t^2}{2} + \\delta w_t - \\frac{\\delta^2}{2} + \\frac{w_t^2}{2}\n$$\n这简化为：\n$$\n\\ell(w_t) = \\delta w_t - \\frac{\\delta^2}{2}\n$$\nCUSUM统计量 $S_t = \\max\\{0, S_{t-1} + \\ell(w_t)\\}$ 是一个在0处反射的随机游走，其增量为 $\\ell(w_t)$。为求误报概率，我们在标称状态 $H_0$（其中 $w_t \\sim \\mathcal{N}(0, 1)$）下分析其行为。在 $H_0$ 下增量的期望值为：\n$$\nE_0[\\ell(w_t)] = E_0\\left[\\delta w_t - \\frac{\\delta^2}{2}\\right] = \\delta E_0[w_t] - \\frac{\\delta^2}{2}\n$$\n由于在标称状态下 $E_0[w_t] = 0$，随机游走的漂移为负：\n$$\nE_0[\\ell(w_t)] = -\\frac{\\delta^2}{2}  0\n$$\n当 $S_t \\ge h$ 时触发警报。对于具有负漂移的随机游走，这是一个罕见事件。我们使用大偏差理论来近似其概率。该方法的核心涉及在 $H_0$ 下增量 $\\ell(w_t)$ 的累积量生成函数（CGF），定义为 $\\psi(\\theta) = \\ln(E_0[\\exp(\\theta \\ell(w_t))])$。\n$$\n\\psi(\\theta) = \\ln\\left( E_0\\left[\\exp\\left(\\theta \\left(\\delta w_t - \\frac{\\delta^2}{2}\\right)\\right)\\right] \\right) = \\ln\\left( \\exp\\left(-\\frac{\\theta\\delta^2}{2}\\right) E_0\\left[\\exp(\\theta \\delta w_t)\\right] \\right)\n$$\n$$\n\\psi(\\theta) = -\\frac{\\theta\\delta^2}{2} + \\ln\\left(E_0\\left[\\exp(\\theta \\delta w_t)\\right]\\right)\n$$\n项 $E_0[\\exp(\\theta \\delta w_t)]$ 是标准正态变量 $w_t \\sim \\mathcal{N}(0, 1)$ 在点 $\\theta\\delta$ 处的矩生成函数（MGF）。一般正态变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 的MGF是 $M_X(s) = \\exp(\\mu s + \\frac{1}{2}\\sigma^2 s^2)$。对于 $w_t \\sim \\mathcal{N}(0, 1)$，它是 $M_{w_t}(s) = \\exp(\\frac{1}{2}s^2)$。因此：\n$$\nE_0\\left[\\exp(\\theta \\delta w_t)\\right] = M_{w_t}(\\theta\\delta) = \\exp\\left(\\frac{1}{2}(\\theta\\delta)^2\\right) = \\exp\\left(\\frac{\\theta^2\\delta^2}{2}\\right)\n$$\n将此代回CGF的表达式中：\n$$\n\\psi(\\theta) = -\\frac{\\theta\\delta^2}{2} + \\frac{\\theta^2\\delta^2}{2}\n$$\n越界概率的大偏差近似取决于找到方程 $\\psi(\\theta) = 0$ 的非零根 $\\theta^*$。\n$$\n-\\frac{\\theta\\delta^2}{2} + \\frac{\\theta^2\\delta^2}{2} = 0\n$$\n由于 $\\delta = \\mu_{\\epsilon}/\\sigma_{\\epsilon} > 0$，我们可以除以 $\\frac{\\delta^2}{2} \\neq 0$：\n$$\n-\\theta + \\theta^2 = 0 \\implies \\theta(\\theta - 1) = 0\n$$\n根为 $\\theta = 0$（平凡根）和 $\\theta^* = 1$。\n\n从 $S_0=0$ 开始的CUSUM过程 $S_t$ 曾经越过阈值 $h$ 的概率 $\\alpha$ 的标准大偏差近似由下式给出：\n$$\n\\alpha = P(\\sup_{t \\ge 1} S_t \\ge h) \\approx \\exp(-\\theta^* h)\n$$\n将非平凡根 $\\theta^* = 1$ 代入此近似中，我们得到：\n$$\n\\alpha \\approx \\exp(-h)\n$$\n对两边取自然对数求解阈值 $h$：\n$$\n\\ln(\\alpha) = -h\n$$\n$$\nh = -\\ln(\\alpha)\n$$\n此表达式给出的阈值 $h$ 仅是目标误报概率 $\\alpha$ 的函数。\n\n注意到这个结果的独立性至关重要。$h$ 的最终表达式仅取决于 $\\alpha$。它与自回归参数 $\\phi$、新息标准差 $\\sigma_{\\epsilon}$ 以及待检测的漂移幅度 $\\delta = \\mu_{\\epsilon}/\\sigma_{\\epsilon}$ 无关。这种独立性源于问题阐述中的两个关键步骤：\n1.  **残差白化**：变换 $w_t = (r_t - \\phi r_{t-1}) / \\sigma_{\\epsilon}$ 通过设计使问题标准化。它消除了自相关（由参数 $\\phi$ 表征）和尺度（由参数 $\\sigma_{\\epsilon}$ 表征）的影响，创建了一个标准化的独立同分布序列 $w_t \\sim \\mathcal{N}(0, 1)$。\n2.  **对数似然比增量**：LLR增量的特定形式 $\\ell(w_t) = \\delta w_t - \\frac{\\delta^2}{2}$ 导致其CGF的非平凡根 $\\theta^*$ 恰好为1，且与 $\\delta$ 无关。这是对指数族分布使用LLR的一个特殊性质，它在某些方面确保了最优性（例如，在给定误报率下最小化检测延迟）。\n\n因此，白化过程使得检测对特定的标称动态（$\\phi$, $\\sigma_{\\epsilon}$）具有鲁棒性，而使用LLR增量使得误报概率的调整与特定的备择假设（$\\delta$）无关。",
            "answer": "$$\\boxed{-\\ln(\\alpha)}$$"
        },
        {
            "introduction": "除了简单的参数变化，一种常见而微妙的模型漂移形式是“标签偏移”，即目标环境中各个类别的潜在频率发生了变化。本练习将指导你推导黑盒偏移估计器 (BBSE)，这是一种巧妙而高效的方法，仅利用分类器的已知混淆矩阵和无标签的预测输出即可量化这种偏移 。这项实践展示了如何从单纯的漂移检测转向漂移量化，这是模型自适应的关键一步。",
            "id": "4231216",
            "problem": "一个制造信息物理系统（CPS）的数字孪生使用一个具有 $K$ 个类别的固定分类器来监控一个多类别过程状态。该数字孪生部署在具有联合分布 $P_{s}(x, y)$ 的源环境下，随后从具有联合分布 $P_{t}(x, y)$ 的目标环境接收未标记的数据。假设存在以下形式化的标签偏移条件：对于所有类别 $y \\in \\{1, \\dots, K\\}$，$P_{t}(x \\mid y) = P_{s}(x \\mid y)$，但 $P_{t}(y)$ 可能与 $P_{s}(y)$ 不同。设分类器的预测标签为 $\\hat{y} \\in \\{1, \\dots, K\\}$，它是由一个从 $x$ 到 $\\hat{y}$ 的固定映射产生的，该映射在源环境和目标环境之间不发生改变。\n\n源环境提供有标签的数据，用以估计分类器的混淆矩阵 $C \\in \\mathbb{R}^{K \\times K}$，其元素为 $C_{ij} = P_{s}(\\hat{y} = i \\mid y = j)$。目标环境只提供无标签的数据，数字孪生可以从中估计预测边际向量 $\\boldsymbol{q}_{t} \\in \\mathbb{R}^{K}$，其元素为 $[\\boldsymbol{q}_{t}]_{i} = P_{t}(\\hat{y} = i)$。定义源类别先验向量 $\\boldsymbol{\\mu}_{s} \\in \\mathbb{R}^{K}$，其元素为 $[\\boldsymbol{\\mu}_{s}]_{j} = P_{s}(y = j)$，以及目标类别先验向量 $\\boldsymbol{\\mu}_{t} \\in \\mathbb{R}^{K}$，其元素为 $[\\boldsymbol{\\mu}_{t}]_{j} = P_{t}(y = j)$。\n\n从全概率定律和标签偏移的形式化定义出发，推导出黑盒偏移估计器（Black Box Shift Estimator, BBSE），该估计器将目标类别先验向量 $\\boldsymbol{\\mu}_{t}$ 表示为混淆矩阵 $C$ 和目标预测边际向量 $\\boldsymbol{q}_{t}$ 的函数。然后，陈述在此 CPS 数字孪生设置中，$\\boldsymbol{\\mu}_{t}$ 由 $C$ 和 $\\boldsymbol{q}_{t}$ 唯一确定的充分必要可识别性条件。您的最终答案必须是 $\\boldsymbol{\\mu}_{t}$ 关于 $C$ 和 $\\boldsymbol{q}_{t}$ 的单个闭式解析表达式。不需要进行数值计算，也无需四舍五入。请将最终答案表示为无单位的符号表达式。",
            "solution": "目标是根据标签偏移假设，推导目标类别先验向量 $\\boldsymbol{\\mu}_{t}$ 关于源混淆矩阵 $C$ 和目标预测边际向量 $\\boldsymbol{q}_{t}$ 的表达式。我们还将陈述此估计唯一可能的条件。\n\n让我们从目标域中预测 $\\hat{y} = i$ 的边际概率的全概率定律开始。这可以通过对所有可能的真实类别 $y=j$ 求和得到：\n$$\nP_{t}(\\hat{y} = i) = \\sum_{j=1}^{K} P_{t}(\\hat{y} = i, y = j)\n$$\n使用条件概率的定义 $P(A, B) = P(A \\mid B) P(B)$，我们可以将其重写为：\n$$\nP_{t}(\\hat{y} = i) = \\sum_{j=1}^{K} P_{t}(\\hat{y} = i \\mid y = j) P_{t}(y = j)\n$$\n现在，我们将问题陈述中定义的术语代入该方程。\n目标预测边际向量 $\\boldsymbol{q}_{t}$ 的第 $i$ 个元素是 $[\\boldsymbol{q}_{t}]_{i} = P_{t}(\\hat{y} = i)$。\n目标类别先验向量 $\\boldsymbol{\\mu}_{t}$ 的第 $j$ 个元素是 $[\\boldsymbol{\\mu}_{t}]_{j} = P_{t}(y = j)$。\n将这些代入我们的方程，得到：\n$$\n[\\boldsymbol{q}_{t}]_{i} = \\sum_{j=1}^{K} P_{t}(\\hat{y} = i \\mid y = j) [\\boldsymbol{\\mu}_{t}]_{j}\n$$\n下一步是评估项 $P_{t}(\\hat{y} = i \\mid y = j)$。问题陈述了形式化的标签偏移条件 $P_{t}(x \\mid y) = P_{s}(x \\mid y)$，并且分类器是从特征空间 $x$ 到预测标签 $\\hat{y}$ 的固定映射。设此映射由函数 $h$ 表示，因此 $\\hat{y}=h(x)$。在给定真实标签 $y=j$ 的情况下，预测 $\\hat{y}=i$ 的条件概率，是从分布 $P(x \\mid y=j)$ 中抽取的特征向量 $x$ 被分类器映射到 $i$ 的概率。这可以表示为在特征空间中 $h(x)=i$ 的子集上的积分：\n$$\nP(\\hat{y}=i \\mid y=j) = \\int_{\\{x \\mid h(x)=i\\}} P(x \\mid y=j) dx\n$$\n由于函数 $h(x)$ 是固定的，并且条件特征分布在源域和目标域之间是不变的 ($P_{t}(x \\mid y=j) = P_{s}(x \\mid y=j)$)，因此可以直接得出，条件预测分布也是不变的：\n$$\nP_{t}(\\hat{y} = i \\mid y = j) = P_{s}(\\hat{y} = i \\mid y = j)\n$$\n问题将源混淆矩阵 $C$ 定义为具有元素 $C_{ij} = P_{s}(\\hat{y} = i \\mid y = j)$。因此，我们有：\n$$\nP_{t}(\\hat{y} = i \\mid y = j) = C_{ij}\n$$\n将此代回我们的 $[\\boldsymbol{q}_{t}]_{i}$ 方程中：\n$$\n[\\boldsymbol{q}_{t}]_{i} = \\sum_{j=1}^{K} C_{ij} [\\boldsymbol{\\mu}_{t}]_{j}\n$$\n这个方程对每个预测类别 $i \\in \\{1, \\dots, K\\}$ 都成立。这个包含 $K$ 个线性方程的系统可以简洁地表示为矩阵-向量形式。右侧是矩阵-向量乘积 $C \\boldsymbol{\\mu}_{t}$ 的定义。因此，我们有：\n$$\n\\boldsymbol{q}_{t} = C \\boldsymbol{\\mu}_{t}\n$$\n为了求解未知的目标类别先验向量 $\\boldsymbol{\\mu}_{t}$，我们需要将其分离出来。如果混淆矩阵 $C$ 是可逆的，我们可以在方程两边同时左乘其逆矩阵 $C^{-1}$：\n$$\nC^{-1} \\boldsymbol{q}_{t} = C^{-1} C \\boldsymbol{\\mu}_{t}\n$$\n$$\nC^{-1} \\boldsymbol{q}_{t} = I \\boldsymbol{\\mu}_{t}\n$$\n$$\n\\boldsymbol{\\mu}_{t} = C^{-1} \\boldsymbol{q}_{t}\n$$\n这个表达式就是黑盒偏移估计器（Black Box Shift Estimator, BBSE）。\n\n任务的第二部分是陈述充分必要的可识别性条件。当且仅当线性方程组 $\\boldsymbol{q}_{t} = C \\boldsymbol{\\mu}_{t}$ 对 $\\boldsymbol{\\mu}_{t}$ 有唯一解时，目标类别先验向量 $\\boldsymbol{\\mu}_{t}$ 才由 $C$ 和 $\\boldsymbol{q}_{t}$ 唯一确定。根据线性代数，当且仅当矩阵 $C$ 是可逆的（或非奇异的）时，存在唯一解。一个可逆矩阵的行列式不为零，即 $\\det(C) \\neq 0$，并且其列向量（和行向量）是线性无关的。\n\n在此问题的背景下，$C$ 的第 $j$ 列是给定真实类别为 $j$ 时分类器预测的条件概率向量。如果 $C$ 的列不是线性无关的，这意味着分类器对不同真实类别的响应在统计上是混淆的，从而无法唯一地解开每个真实类别对观测到的预测边际 $\\boldsymbol{q}_{t}$ 的贡献。因此，$\\boldsymbol{\\mu}_{t}$ 可识别的充分必要条件是混淆矩阵 $C$ 的可逆性。",
            "answer": "$$\\boxed{C^{-1} \\boldsymbol{q}_{t}}$$"
        }
    ]
}