{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any stable swarm is ensuring its agents do not collide with one another. This exercise guides you through the design of a provably safe interaction law using a powerful modern technique known as Control Barrier Functions (CBFs) . By deriving the minimum required repulsion strength, you will gain a first-principles understanding of how to enforce safety guarantees within a flocking algorithm.",
            "id": "4249437",
            "problem": "Consider a swarm of $N$ identical planar agents in a Cyber-Physical System (CPS) whose motion is modeled kinematically as $\\dot{x}_i(t) = u_i(t)$ with $x_i(t) \\in \\mathbb{R}^2$ and control $u_i(t) \\in \\mathbb{R}^2$. A digital twin of the swarm implements a flocking controller with two components: an attractive consensus term and a short-range repulsion term that is activated near a prescribed safety distance. Specifically, for agent $i$,\n$$\nu_i \\,=\\, u_i^{\\mathrm{att}} + u_i^{\\mathrm{rep}},\n$$\nwhere the attractive consensus is\n$$\nu_i^{\\mathrm{att}} \\,=\\, -\\,b \\sum_{j \\neq i} \\big(x_i - x_j\\big),\n$$\nwith constant $b > 0$, and the repulsion is\n$$\nu_i^{\\mathrm{rep}} \\,=\\, \\alpha \\sum_{j \\neq i} \\sigma\\!\\big(r_{ij}\\big)\\, r_{ij}^{-q} \\,\\frac{x_i - x_j}{r_{ij}},\n$$\nwith $r_{ij} := \\|x_i - x_j\\|$, exponent $q > 0$, strength $\\alpha > 0$, and a binary activation function $\\sigma(r)$ defined as $\\sigma(r) = 1$ if $r \\le d_0$ and $\\sigma(r) = 0$ if $r > d_0$, where $d_0 > 0$ is the prescribed minimum separation distance. The digital twin enforces pairwise safety via the Control Barrier Function (CBF) $h_{ij}(x) := \\|x_i - x_j\\|^2 - d_0^2$, requiring forward invariance of the safe set $\\{x : h_{ij}(x) \\ge 0 \\ \\text{for all}\\ i \\neq j\\}$.\n\nStarting from first principles (definitions of relative distance dynamics and the forward invariance condition for zeroing barrier certificates), derive a closed-form lower bound on the repulsion strength $\\alpha$ in terms of $N$, $b$, $d_0$, and $q$ that guarantees $\\dot{h}_{ij}(x) \\ge 0$ at every boundary point where $h_{ij}(x) = 0$. Assume the worst-case that, at $h_{ij}(x) = 0$, only the repulsion between agents $i$ and $j$ is active for that pair, while other pairs are not simultaneously at their activation boundary. Express your final answer as a single analytic expression in terms of $N$, $b$, $d_0$, and $q$. No numerical approximation is required.",
            "solution": "The user wants to find a lower bound on the repulsion strength, denoted by the parameter $\\alpha$ in a swarm of agents, that guarantees pairwise safety. Safety is defined by the Control Barrier Function (CBF) constraint $\\dot{h}_{ij}(x) \\ge 0$ whenever $h_{ij}(x) = 0$.\n\nFirst, a validation of the problem statement is performed.\n\n### Step 1: Extract Givens\n-   Number of agents: $N$.\n-   Agent state: $x_i(t) \\in \\mathbb{R}^2$.\n-   Agent dynamics: $\\dot{x}_i(t) = u_i(t)$, with control input $u_i(t) \\in \\mathbb{R}^2$.\n-   Control law: $u_i = u_i^{\\mathrm{att}} + u_i^{\\mathrm{rep}}$.\n-   Attractive component: $u_i^{\\mathrm{att}} = -b \\sum_{j \\neq i} (x_i - x_j)$, with constant $b > 0$.\n-   Repulsive component: $u_i^{\\mathrm{rep}} = \\alpha \\sum_{j \\neq i} \\sigma(r_{ij}) r_{ij}^{-q} \\frac{x_i - x_j}{r_{ij}}$, with $r_{ij} := \\|x_i - x_j\\|$, exponent $q > 0$, and strength $\\alpha > 0$.\n-   Activation function: $\\sigma(r) = 1$ if $r \\le d_0$ and $\\sigma(r) = 0$ if $r > d_0$, where $d_0 > 0$ is the minimum separation distance.\n-   Control Barrier Function: $h_{ij}(x) := \\|x_i - x_j\\|^2 - d_0^2$.\n-   Safety condition: $\\dot{h}_{ij}(x) \\ge 0$ must hold at every boundary point where $h_{ij}(x) = 0$.\n-   Worst-case assumption: At $h_{ij}(x) = 0$, only the repulsion between agents $i$ and $j$ is active for that pair ($\\sigma(r_{ij})=1$), while for any other agent $k \\neq i, j$, the distances $r_{ik}$ and $r_{jk}$ are greater than $d_0$ (i.e., $\\sigma(r_{ik}) = \\sigma(r_{jk}) = 0$).\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on established principles of multi-agent systems, control theory, and specifically the Control Barrier Function (CBF) methodology for safety-critical control. The models for flocking (attraction/repulsion) and kinematic agents are standard in the field.\n-   **Well-Posed**: The problem provides all necessary definitions and equations to derive the requested lower bound. The \"worst-case\" assumption is explicitly stated, which makes the problem tractable and leads to a unique analytical solution.\n-   **Objective**: The language is precise and mathematical. All terms are clearly defined.\n-   **Completeness and Consistency**: The problem is self-contained. The definitions and constraints are consistent with each other. No essential information is missing.\n-   **Realism**: The model is a common and valid simplification of agent dynamics used in robotics and cyber-physical systems research.\nThe problem is deemed valid.\n\n### Derivation of the Lower Bound\nThe safety of the system is guaranteed if the set $\\{x : h_{ij}(x) \\ge 0, \\forall i \\neq j\\}$ is forward invariant. For a zeroing barrier certificate like the one given, this condition is satisfied if $\\dot{h}_{ij}(x) \\ge 0$ for all pairs $(i, j)$ on the boundary of the safe set, i.e., where $h_{ij}(x) = 0$.\n\nThe barrier function is $h_{ij}(x) = \\|x_i - x_j\\|^2 - d_0^2$.\nThe condition $h_{ij}(x) = 0$ implies that the distance between agents $i$ and $j$ is exactly the safety distance, i.e., $r_{ij} = \\|x_i - x_j\\| = d_0$.\n\nWe compute the time derivative of $h_{ij}(x)$ along the system trajectories:\n$$\n\\dot{h}_{ij} = \\frac{d}{dt} \\left( (x_i - x_j)^T(x_i - x_j) - d_0^2 \\right) = 2(x_i - x_j)^T (\\dot{x}_i - \\dot{x}_j).\n$$\nSubstituting the system dynamics $\\dot{x}_i = u_i$, we get:\n$$\n\\dot{h}_{ij} = 2(x_i - x_j)^T (u_i - u_j).\n$$\nThe safety condition is $\\dot{h}_{ij} \\ge 0$, which translates to:\n$$\n2(x_i - x_j)^T (u_i - u_j) \\ge 0.\n$$\nNow, we must find an expression for the relative control input $u_i - u_j$.\n$$\nu_i - u_j = (u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}}) + (u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}).\n$$\nLet's analyze each component separately.\n\n1.  **Attractive Component Difference ($u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}}$):**\n    $$\n    u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}} = \\left(-b \\sum_{k \\neq i} (x_i - x_k)\\right) - \\left(-b \\sum_{k \\neq j} (x_j - x_k)\\right) = -b \\left( \\sum_{k \\neq i} (x_i - x_k) - \\sum_{k \\neq j} (x_j - x_k) \\right).\n    $$\n    We can rewrite the sums by separating the terms involving agents $i$ and $j$:\n    $$\n    \\sum_{k \\neq i} (x_i - x_k) = (x_i - x_j) + \\sum_{k \\neq i,j} (x_i - x_k).\n    $$\n    $$\n    \\sum_{k \\neq j} (x_j - x_k) = (x_j - x_i) + \\sum_{k \\neq i,j} (x_j - x_k).\n    $$\n    Subtracting the second from the first gives:\n    $$\n    (x_i - x_j) - (x_j - x_i) + \\sum_{k \\neq i,j} \\left( (x_i - x_k) - (x_j - x_k) \\right) = 2(x_i - x_j) + \\sum_{k \\neq i,j} (x_i - x_j).\n    $$\n    There are $N-2$ agents with index $k \\neq i,j$. Thus:\n    $$\n    2(x_i - x_j) + (N-2)(x_i - x_j) = N(x_i - x_j).\n    $$\n    Therefore, the attractive component difference is:\n    $$\n    u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}} = -b N (x_i - x_j).\n    $$\n\n2.  **Repulsive Component Difference ($u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}$):**\n    The repulsive control is given by $u_i^{\\mathrm{rep}} = \\alpha \\sum_{k \\neq i} \\sigma(r_{ik}) r_{ik}^{-(q+1)} (x_i - x_k)$.\n    We evaluate this at the boundary $h_{ij}(x) = 0$, where $r_{ij} = d_0$. According to the problem's assumption, at this point, $\\sigma(r_{ij})=1$, but for any other agent $k \\neq i,j$, we have $r_{ik} > d_0$ and $r_{jk} > d_0$, which means $\\sigma(r_{ik})=0$ and $\\sigma(r_{jk})=0$.\n    This simplifies the sums significantly. For $u_i^{\\mathrm{rep}}$, the only non-zero term in the summation is when $k=j$:\n    $$\n    u_i^{\\mathrm{rep}} = \\alpha \\sigma(r_{ij}) r_{ij}^{-(q+1)} (x_i - x_j).\n    $$\n    Since $r_{ij} = d_0$ and $\\sigma(r_{ij})=1$ at the boundary:\n    $$\n    u_i^{\\mathrm{rep}} \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)} (x_i - x_j).\n    $$\n    Similarly, for $u_j^{\\mathrm{rep}} = \\alpha \\sum_{k \\neq j} \\sigma(r_{jk}) r_{jk}^{-(q+1)} (x_j - x_k)$, the only non-zero term is when $k=i$:\n    $$\n    u_j^{\\mathrm{rep}} = \\alpha \\sigma(r_{ji}) r_{ji}^{-(q+1)} (x_j - x_i).\n    $$\n    Since $r_{ji}=r_{ij}=d_0$ and $\\sigma(r_{ji})=1$:\n    $$\n    u_j^{\\mathrm{rep}} \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)} (x_j - x_i) = -\\alpha d_0^{-(q+1)} (x_i - x_j).\n    $$\n    The difference is then:\n    $$\n    (u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}) \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)}(x_i-x_j) - (-\\alpha d_0^{-(q+1)}(x_i-x_j)) = 2\\alpha d_0^{-(q+1)}(x_i-x_j).\n    $$\n\nNow, we combine these results and substitute them back into the safety condition for $\\dot{h}_{ij}$, evaluated at the boundary $h_{ij}=0$:\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2(x_i - x_j)^T \\left( -bN(x_i - x_j) + 2\\alpha d_0^{-(q+1)}(x_i - x_j) \\right).\n$$\nUsing the identity $(x_i-x_j)^T(x_i-x_j) = \\|x_i-x_j\\|^2 = r_{ij}^2$, and knowing that $r_{ij}=d_0$ at the boundary:\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2 \\left( -bN\\|x_i - x_j\\|^2 + 2\\alpha d_0^{-(q+1)}\\|x_i - x_j\\|^2 \\right) = 2 \\left( -bN d_0^2 + 2\\alpha d_0^{-(q+1)}d_0^2 \\right).\n$$\nSimplifying the exponents:\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2 \\left( -bN d_0^2 + 2\\alpha d_0^{-q+1} \\right).\n$$\nThe safety condition requires $\\dot{h}_{ij} \\ge 0$:\n$$\n2 \\left( -bN d_0^2 + 2\\alpha d_0^{-q+1} \\right) \\ge 0.\n$$\n$$\n-bN d_0^2 + 2\\alpha d_0^{-q+1} \\ge 0.\n$$\nWe now solve for $\\alpha$:\n$$\n2\\alpha d_0^{-q+1} \\ge bN d_0^2.\n$$\n$$\n\\alpha \\ge \\frac{bN d_0^2}{2 d_0^{-q+1}}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{2 - (-q+1)}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{2+q-1}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{q+1}.\n$$\nThis gives the closed-form lower bound on the repulsion strength $\\alpha$ that guarantees safety under the specified conditions.",
            "answer": "$$\n\\boxed{\\frac{bN}{2} d_0^{q+1}}\n$$"
        },
        {
            "introduction": "While avoiding collisions is critical, many swarm applications also require agents to reach an agreement, or consensus, on a shared variable. This practice investigates the impact of a ubiquitous real-world imperfection—sensor bias—on the consensus process . You will first quantify the steady-state error induced by the bias and then design a distributed calibration scheme, providing hands-on experience in making collective behaviors robust.",
            "id": "4249398",
            "problem": "Consider a connected swarm of $n$ cyber-physical agents forming a networked Cyber-Physical System (CPS). The communication topology is an undirected, connected, weighted graph with symmetric adjacency weights $a_{ij} = a_{ji} \\geq 0$, Laplacian matrix $L \\in \\mathbb{R}^{n \\times n}$ defined by $L = D - A$, degree matrix $D = \\mathrm{diag}(d_{1},\\dots,d_{n})$ with $d_{i} = \\sum_{j=1}^{n} a_{ij}$, and $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$ where $\\mathbf{1} \\in \\mathbb{R}^{n}$ is the all-ones vector.\n\nEach agent $i \\in \\{1,\\dots,n\\}$ holds a physical state $x_{i}(t)$ and a digital twin that communicates with neighbors. The agent measures a biased quantity $y_{i}(t) = x_{i}(t) + \\beta_{i}$, where the sensor bias $\\beta_{i} \\in \\mathbb{R}$ is constant but unknown, and runs continuous-time average-consensus using neighbor exchanges of the measured $y_{j}(t)$:\n$$\n\\dot{x}_{i}(t) = \\sum_{j=1}^{n} a_{ij} \\big(y_{j}(t) - y_{i}(t)\\big).\n$$\nLet $x(0) \\in \\mathbb{R}^{n}$ denote the initial state vector and define the unbiased true average $\\bar{x} = \\frac{1}{n} \\mathbf{1}^{\\top} x(0)$. Under the above protocol, the swarm attempts to reach an agreement about the average, but the biases $\\beta_{i}$ perturb the evolution.\n\nTask 1: Starting from the protocol, graph definitions, and the measurement model, derive the steady-state error vector $e^{\\star} \\in \\mathbb{R}^{n}$ with entries $e^{\\star}_{i} = x^{\\star}_{i} - \\bar{x}$, where $x^{\\star}$ denotes the $t \\to \\infty$ limit of $x(t)$ under the biased consensus dynamics. Express $e^{\\star}$ in closed form in terms of $\\beta \\in \\mathbb{R}^{n}$ and the scalar average bias $\\bar{\\beta} = \\frac{1}{n} \\mathbf{1}^{\\top} \\beta$.\n\nTask 2: Propose a distributed cyber-layer calibration scheme that augments each agent with an estimator state $\\hat{\\beta}_{i}(t)$ inside its digital twin and replaces the measured input $y_{i}(t)$ by a calibrated input $r_{i}(t) = y_{i}(t) - \\hat{\\beta}_{i}(t)$ in the consensus update. Using only neighbor exchanges and the Laplacian coupling, specify local dynamics for $\\hat{\\beta}_{i}(t)$ and the modified consensus dynamics such that all agents converge to the unbiased average $\\bar{x}$ despite arbitrary constant biases $\\beta_{i}$. Derive the stacked closed-loop dynamics, identify invariants, and give sufficient conditions on a scalar estimator gain $\\gamma > 0$ and an initialization criterion that ensure convergence to $x_{i}(t) \\to \\bar{x}$ for all $i$. No numerical approximation is required.\n\nYour final answer must be the closed-form expression for $e^{\\star}$ obtained in Task 1. No rounding is required, and no units are necessary.",
            "solution": "We first express the dynamics in stacked vector form and analyze the bias-induced perturbation. Define the vectors $x(t) \\in \\mathbb{R}^{n}$, $y(t) \\in \\mathbb{R}^{n}$, and $\\beta \\in \\mathbb{R}^{n}$ with components $x_{i}(t)$, $y_{i}(t)$, and $\\beta_{i}$, respectively. The measurement model is $y(t) = x(t) + \\beta$. The average-consensus protocol in stacked form is\n$$\n\\dot{x}(t) = -L y(t) = -L \\big(x(t) + \\beta\\big) = -L x(t) - L \\beta.\n$$\nWe recall fundamental facts for connected, undirected graphs: $L$ is symmetric positive semidefinite with $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$, all other eigenvalues are strictly positive, and the average under the standard consensus flow is invariant because $\\mathbf{1}^{\\top} L = \\mathbf{0}^{\\top}$. These properties imply $\\mathbf{1}^{\\top} \\dot{x}(t) = -\\mathbf{1}^{\\top} L \\big(x(t) + \\beta\\big) = 0$, so the average $\\bar{x} = \\frac{1}{n} \\mathbf{1}^{\\top} x(t)$ is constant in time and equal to $\\frac{1}{n} \\mathbf{1}^{\\top} x(0)$.\n\nTo characterize the steady state, consider the evolution of $z(t) \\triangleq x(t) + \\beta$. Using the dynamics above,\n$$\n\\dot{z}(t) = \\dot{x}(t) = -L \\big(x(t) + \\beta\\big) = -L z(t).\n$$\nThus $z(t)$ follows a standard consensus flow. For a connected graph, the solution satisfies\n$$\n\\lim_{t \\to \\infty} z(t) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} z(0) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} \\big(x(0) + \\beta\\big) = \\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1}.\n$$\nTherefore, the steady state $x^{\\star}$ is\n$$\nx^{\\star} = \\lim_{t \\to \\infty} x(t) = \\lim_{t \\to \\infty} \\big(z(t) - \\beta\\big) = \\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1} - \\beta.\n$$\nDefine the error vector $e^{\\star} \\in \\mathbb{R}^{n}$ relative to the unbiased average $\\bar{x}$ by $e^{\\star} = x^{\\star} - \\bar{x}\\mathbf{1}$. Substituting the expression for $x^{\\star}$ yields\n$$\ne^{\\star} = \\Big(\\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1} - \\beta\\Big) - \\bar{x}\\mathbf{1} = \\bar{\\beta}\\,\\mathbf{1} - \\beta.\n$$\nComponentwise, $e^{\\star}_{i} = \\bar{\\beta} - \\beta_{i}$ for all $i$. This shows that, absent calibration, each agent’s steady-state error relative to the true average is the difference between the network-average bias and its local bias, and the swarm fails to reach equal states unless all $\\beta_{i}$ are identical.\n\nWe now propose a distributed calibration scheme that eliminates drift by estimating and subtracting the bias. Each agent maintains an estimator state $\\hat{\\beta}_{i}(t)$, and the calibrated input is $r_{i}(t) = y_{i}(t) - \\hat{\\beta}_{i}(t)$. The modified consensus update is\n$$\n\\dot{x}(t) = -L r(t) = -L \\big(y(t) - \\hat{\\beta}(t)\\big),\n$$\nwhere $r(t) \\in \\mathbb{R}^{n}$ and $\\hat{\\beta}(t) \\in \\mathbb{R}^{n}$ stack the components $r_{i}(t)$ and $\\hat{\\beta}_{i}(t)$, respectively. We choose a simple distributed estimator driven by Laplacian coupling:\n$$\n\\dot{\\hat{\\beta}}(t) = \\gamma\\, L \\big(y(t) - \\hat{\\beta}(t)\\big),\n$$\nwith scalar gain $\\gamma > 0$. Both updates use only neighbor exchanges via $L$ and are implementable in a CPS using local twin computations and communications.\n\nDefine $s(t) \\triangleq y(t) - \\hat{\\beta}(t) = x(t) + \\beta - \\hat{\\beta}(t)$. Combining the two dynamics,\n$$\n\\dot{s}(t) = \\dot{y}(t) - \\dot{\\hat{\\beta}}(t) = \\dot{x}(t) - \\gamma\\, L \\big(y(t) - \\hat{\\beta}(t)\\big) = -L s(t) - \\gamma\\, L s(t) = -(1+\\gamma) L s(t).\n$$\nThus $s(t)$ is a consensus state evolving under a Laplacian flow with rate factor $(1+\\gamma)$. For a connected graph, the average $\\bar{s}(t) = \\frac{1}{n} \\mathbf{1}^{\\top} s(t)$ is invariant since $\\mathbf{1}^{\\top} L = \\mathbf{0}^{\\top}$, and\n$$\n\\lim_{t \\to \\infty} s(t) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} s(0) = \\bar{s}(0)\\,\\mathbf{1}.\n$$\nBecause $s(0) = y(0) - \\hat{\\beta}(0) = x(0) + \\beta - \\hat{\\beta}(0)$, its initial average is $\\bar{s}(0) = \\bar{x} + \\bar{\\beta} - \\bar{\\hat{\\beta}}(0)$. If the initialization satisfies the scalar criterion\n$$\n\\bar{\\hat{\\beta}}(0) = \\bar{\\beta},\n$$\nthen $\\bar{s}(0) = \\bar{x}$ and $s(t) \\to \\bar{x}\\,\\mathbf{1}$. With $s(t)$ approaching $\\bar{x}\\,\\mathbf{1}$, the modified consensus dynamics become asymptotically\n$$\n\\dot{x}(t) = -L s(t) \\to -L \\big(\\bar{x}\\,\\mathbf{1}\\big) = \\mathbf{0},\n$$\nand, by standard consensus convergence on the subspace orthogonal to $\\mathbf{1}$, $x(t)$ converges to the constant vector $\\bar{x}\\,\\mathbf{1}$ regardless of the unknown biases $\\beta_{i}$. The sufficient conditions for convergence are:\n- the communication graph is undirected and connected so that $L$ has $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$ and positive eigenvalues elsewhere;\n- the estimator gain satisfies $\\gamma > 0$, which ensures $-(1+\\gamma)L$ is negative semidefinite with strict decay on the subspace orthogonal to $\\mathbf{1}$;\n- the estimator average is initialized to the average bias, $\\bar{\\hat{\\beta}}(0) = \\bar{\\beta}$, which can be achieved, for example, via a one-time distributed calibration procedure to estimate the network-average of initial residuals or by any mechanism that aligns the estimator’s mean with the mean bias.\n\nUnder these conditions, the closed-loop stacked dynamics for the state $(x,s)$ are\n$$\n\\begin{pmatrix}\n\\dot{x}(t) \\\\\n\\dot{s}(t)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 & -L \\\\\n0 & -(1+\\gamma)L\n\\end{pmatrix}\n\\begin{pmatrix}\nx(t) \\\\\ns(t)\n\\end{pmatrix},\n$$\nwith $s(t)$ converging to $\\bar{x}\\,\\mathbf{1}$ and $x(t)$ converging to $\\bar{x}\\,\\mathbf{1}$, thereby eliminating drift and restoring convergence to the unbiased average.\n\nReturning to Task 1, the steady-state error for the uncalibrated case is\n$$\ne^{\\star} = \\bar{\\beta}\\,\\mathbf{1} - \\beta,\n$$\na closed-form expression entirely in terms of the bias vector and its network-average.",
            "answer": "$$\\boxed{\\bar{\\beta}\\,\\mathbf{1}-\\beta}$$"
        },
        {
            "introduction": "Real-world cyber-physical systems operate under constant stochastic disturbances, making deterministic safety guarantees impossible. This computational practice addresses this reality by introducing probabilistic verification for a multi-agent system with Gaussian noise . You will implement a method to compute the probability of collision over a time horizon and use this to select a control policy that minimizes risk, bridging the gap between idealized models and practical safety engineering.",
            "id": "4249411",
            "problem": "Consider a digital twin of two robots within a swarm operating in a plane, modeled as a pairwise relative state with discrete-time linear dynamics under additive Gaussian disturbances. The relative position along each axis is denoted by $p_{x,k}$ and $p_{y,k}$ at discrete time index $k \\in \\{0,1,2,\\dots,N\\}$, and the relative velocity along each axis is denoted by $v_{x,k}$ and $v_{y,k}$. The time step is $\\Delta t$ (in seconds). The collision avoidance safety requirement is that the Euclidean separation $r_k = \\sqrt{p_{x,k}^2 + p_{y,k}^2}$ shall satisfy $r_k \\ge d_{\\min}$ (in meters) for all $k \\in \\{1,2,\\dots,N\\}$.\n\nFundamental base assumptions and definitions:\n- The dynamics are linear time-invariant and the axes are decoupled and symmetric. The velocity update is $v_{j,k+1} = (1 - \\Delta t \\, k_v) \\, v_{j,k}$ for each axis $j \\in \\{x,y\\}$, where $k_v \\ge 0$ (in $1/\\mathrm{s}$) is a constant control gain to be chosen from a finite candidate set. The position update is $p_{j,k+1} = p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}$, where the disturbance $\\eta_{j,k}$ is independent and identically distributed across time and axes with $\\eta_{j,k} \\sim \\mathcal{N}(0, \\sigma_p^2)$ (in $\\mathrm{m}^2$).\n- The initial state $(p_{x,0}, p_{y,0}, v_{x,0}, v_{y,0})$ is deterministic.\n- The disturbances are zero-mean Gaussian and independent across time, producing an isotropic covariance for the position components at each time step.\n- The safety specification is expressed as the temporal property \"always separation above threshold\" over the horizon, which can be encoded in Signal Temporal Logic (STL) as $G_{[0,N \\Delta t]} \\big( r(t) \\ge d_{\\min} \\big)$, where $G$ denotes the \"globally\" operator.\n\nTask:\n1. For each candidate control gain $k_v$ in the provided set for a given test case, compute the mean trajectory of the relative position $\\mu_k = [\\mu_{x,k}, \\mu_{y,k}]^\\top$ for all $k \\in \\{1,2,\\dots,N\\}$ using the dynamics and the initial conditions. The velocity geometry implies a geometric decay when $k_v > 0$; handle the case $k_v = 0$ exactly. Express lengths in meters and time in seconds.\n2. Using the independence and isotropy of the disturbances, compute the marginal covariance of the position at each time $k$, which takes the form $\\sigma_k^2 I_2$, where $I_2$ is the $2 \\times 2$ identity matrix and $\\sigma_k^2$ is in $\\mathrm{m}^2$. Use this to model the position vector $[p_{x,k}, p_{y,k}]^\\top$ as a two-dimensional Gaussian with mean $\\mu_k$ and covariance $\\sigma_k^2 I_2$.\n3. For each $k$, compute the probability of safety violation at that time, namely the probability that $\\sqrt{p_{x,k}^2 + p_{y,k}^2} < d_{\\min}$. Use the known distribution of the squared norm of a two-dimensional Gaussian with isotropic covariance to obtain this probability exactly. Do not approximate using sampling; use an analytic cumulative distribution. The answer must be a decimal number in $[0,1]$.\n4. Use Boole's inequality (also known as the union bound) to upper bound the probability of violating the safety specification at any time over the horizon, by summing the per-time probabilities from item $3$. Since probabilities are bounded by $1$, clamp the summed bound to the interval $[0,1]$.\n5. Compute, over the candidate set of $k_v$, the minimal union-bound violation probability. Also determine whether there exists a $k_v$ in the candidate set that ensures the union-bound violation probability is less than or equal to a given risk budget $\\varepsilon$ (a decimal in $[0,1]$). The formal verification claim uses the union bound to certify satisfaction of the \"always\" safety property under the specified stochastic disturbances.\n\nNumerical units:\n- Distances $p_{x,k}$, $p_{y,k}$, $r_k$, $d_{\\min}$ are in meters.\n- Time step $\\Delta t$ is in seconds.\n- Velocities $v_{x,k}$, $v_{y,k}$ are in meters per second.\n- Disturbance variance $\\sigma_p^2$ is in square meters.\n- Control gain $k_v$ is in inverse seconds.\n- Probabilities must be returned as decimals in $[0,1]$.\n\nTest suite:\nUse the following three test cases. For each case, the candidate control gains are a finite set, and the risk budget $\\varepsilon$ is specified.\n- Case $1$: $\\Delta t = 0.1$, $N = 30$, $d_{\\min} = 2.0$, $\\sigma_p = 0.02$, $(p_{x,0}, p_{y,0}) = (5.0, 0.0)$, $(v_{x,0}, v_{y,0}) = (-0.5, 0.0)$, candidate $k_v$ set $\\{0.0, 1.0, 2.0, 4.0\\}$, $\\varepsilon = 0.05$.\n- Case $2$: $\\Delta t = 0.1$, $N = 50$, $d_{\\min} = 1.5$, $\\sigma_p = 0.05$, $(p_{x,0}, p_{y,0}) = (2.0, 0.0)$, $(v_{x,0}, v_{y,0}) = (-0.3, 0.0)$, candidate $k_v$ set $\\{0.0, 0.5, 1.0, 2.0\\}$, $\\varepsilon = 0.1$.\n- Case $3$: $\\Delta t = 0.2$, $N = 100$, $d_{\\min} = 1.0$, $\\sigma_p = 0.1$, $(p_{x,0}, p_{y,0}) = (1.5, 0.0)$, $(v_{x,0}, v_{y,0}) = (-0.2, 0.0)$, candidate $k_v$ set $\\{0.0, 0.5, 1.0\\}$, $\\varepsilon = 0.05$.\n\nRequired final output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one item per test case. Each item must be a two-element list of the form $[x,y]$ where $x$ is the minimal union-bound violation probability rounded to six decimal places and $y$ is a boolean indicating whether there exists a $k_v$ in the candidate set that satisfies the risk budget. For example, the output must look like $[[0.012345,True],[0.067890,False],[0.000100,True]]$ (with values determined by the computation for the specified test cases).",
            "solution": "The user has provided a well-posed problem in the domain of stochastic safety analysis for a cyber-physical system, specifically a digital twin of two robots. The task is to verify a safety property for a discrete-time linear-Gaussian system under different control strategies and to determine the optimal control gain that minimizes an upper bound on the probability of a safety violation. The problem is scientifically grounded, self-contained, and objective. I will proceed with a full solution.\n\nThe solution methodology follows the five steps outlined in the problem statement. We will first derive the analytical expressions for the mean and covariance of the relative state, then use these to compute the per-time-step probability of a safety violation. Finally, we will use the union bound to estimate the total probability of failure over the time horizon and optimize this bound over a set of candidate control gains.\n\n**1. Mean Trajectory Calculation**\n\nThe system dynamics are linear, and the process noise is zero-mean. Therefore, the propagation of the mean state, $\\mu_k = [\\mu_{x,k}, \\mu_{y,k}]^\\top$ and the mean velocity, is governed by the deterministic part of the system equations. The initial state $(p_{x,0}, p_{y,0}, v_{x,0}, v_{y,0})$ is given and is deterministic.\n\nFor each axis $j \\in \\{x,y\\}$, the mean velocity at time step $k+1$ is:\n$$\n\\mathbb{E}[v_{j,k+1}] = \\mathbb{E}[(1 - \\Delta t \\, k_v) \\, v_{j,k}] = (1 - \\Delta t \\, k_v) \\, \\mathbb{E}[v_{j,k}]\n$$\nSince the velocity dynamics are unforced by noise, the velocity trajectory is deterministic. We denote $\\mu_{v_{j,k}} = v_{j,k}$. The solution to this recurrence is a geometric progression:\n$$\nv_{j,k} = (1 - \\Delta t \\, k_v)^k \\, v_{j,0}\n$$\nThe mean position $\\mu_{p_{j,k}} = \\mathbb{E}[p_{j,k}]$ evolves according to:\n$$\n\\mu_{p_{j,k+1}} = \\mathbb{E}[p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}] = \\mu_{p_{j,k}} + \\Delta t \\, v_{j,k} + \\mathbb{E}[\\eta_{j,k}] = \\mu_{p_{j,k}} + \\Delta t \\, v_{j,k}\n$$\nStarting from the deterministic initial position $\\mu_{p_{j,0}} = p_{j,0}$, we can unroll the recurrence:\n$$\n\\mu_{p_{j,k}} = p_{j,0} + \\Delta t \\sum_{i=0}^{k-1} v_{j,i} = p_{j,0} + \\Delta t \\sum_{i=0}^{k-1} (1 - \\Delta t \\, k_v)^i \\, v_{j,0}\n$$\nThe sum is a finite geometric series. Let $\\alpha = 1 - \\Delta t \\, k_v$.\n- If $k_v = 0$, then $\\alpha=1$. The sum is $\\sum_{i=0}^{k-1} 1^i = k$. The mean position is:\n$$\n\\mu_{p_{j,k}} = p_{j,0} + k \\Delta t \\, v_{j,0} \\quad (\\text{for } k_v = 0)\n$$\n- If $k_v > 0$, then $\\alpha \\neq 1$. The sum is $\\frac{1-\\alpha^k}{1-\\alpha} = \\frac{1-(1 - \\Delta t \\, k_v)^k}{\\Delta t \\, k_v}$. The mean position is:\n$$\n\\mu_{p_{j,k}} = p_{j,0} + \\Delta t \\, v_{j,0} \\left( \\frac{1 - (1 - \\Delta t \\, k_v)^k}{\\Delta t \\, k_v} \\right) = p_{j,0} + v_{j,0} \\frac{1 - (1 - \\Delta t \\, k_v)^k}{k_v} \\quad (\\text{for } k_v > 0)\n$$\nThus, for any $k \\in \\{1, \\dots, N\\}$ and any candidate gain $k_v$, we can compute the mean position vector $\\mu_k = [\\mu_{x,k}, \\mu_{y,k}]^\\top$.\n\n**2. Position Covariance Calculation**\n\nThe problem states that the position vector $[p_{x,k}, p_{y,k}]^\\top$ has an isotropic covariance matrix $\\sigma_k^2 I_2$. We need to find $\\sigma_k^2$. The position update is $p_{j,k+1} = p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}$. Since the velocity trajectory $\\{v_{j,k}\\}$ is deterministic, the uncertainty in position propagates as follows.\nLet the centered random variable for position be $\\tilde{p}_{j,k} = p_{j,k} - \\mu_{p_{j,k}}$. Its update rule is:\n$$\n\\tilde{p}_{j,k+1} = p_{j,k+1} - \\mu_{p_{j,k+1}} = (p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}) - (\\mu_{p_{j,k}} + \\Delta t \\, v_{j,k}) = \\tilde{p}_{j,k} + \\eta_{j,k}\n$$\nThe initial position is deterministic, so $\\tilde{p}_{j,0} = 0$ and its variance is $0$. The disturbances $\\eta_{j,k}$ are i.i.d. with $\\eta_{j,k} \\sim \\mathcal{N}(0, \\sigma_p^2)$ and are independent of past states. The variance of $\\tilde{p}_{j,k}$ is:\n$$\n\\mathrm{Var}(\\tilde{p}_{j,k}) = \\mathrm{Var} \\left( \\sum_{i=0}^{k-1} \\eta_{j,i} \\right) = \\sum_{i=0}^{k-1} \\mathrm{Var}(\\eta_{j,i}) = \\sum_{i=0}^{k-1} \\sigma_p^2 = k \\sigma_p^2\n$$\nSince the axes are decoupled and the disturbances are i.i.d. across axes, the covariance of the position vector $[p_{x,k}, p_{y,k}]^\\top$ is diagonal with equal entries $\\mathrm{Var}(p_{x,k}) = \\mathrm{Var}(p_{y,k})$. Therefore, the scalar variance term is:\n$$\n\\sigma_k^2 = k \\sigma_p^2\n$$\nThe position at time $k$ is distributed as $\\mathbf{p}_k = [p_{x,k}, p_{y,k}]^\\top \\sim \\mathcal{N}(\\mu_k, \\sigma_k^2 I_2)$.\n\n**3. Per-Time-Step Violation Probability**\n\nThe safety requirement is $r_k = \\sqrt{p_{x,k}^2 + p_{y,k}^2} \\ge d_{\\min}$. A violation occurs if $r_k  d_{\\min}$, which is equivalent to $r_k^2  d_{\\min}^2$. We need to compute $P(p_{x,k}^2 + p_{y,k}^2  d_{\\min}^2)$.\n\nThe random variables $p_{x,k}$ and $p_{y,k}$ are independent and follow $p_{x,k} \\sim \\mathcal{N}(\\mu_{x,k}, \\sigma_k^2)$ and $p_{y,k} \\sim \\mathcal{N}(\\mu_{y,k}, \\sigma_k^2)$. The quantity $S_k = \\frac{p_{x,k}^2}{\\sigma_k^2} + \\frac{p_{y,k}^2}{\\sigma_k^2}$ follows a non-central chi-squared distribution, $S_k \\sim \\chi'^2(df, \\lambda_k)$, with:\n- Degrees of freedom $df=2$ (for two dimensions).\n- Non-centrality parameter $\\lambda_k = \\frac{\\mu_{x,k}^2}{\\sigma_k^2} + \\frac{\\mu_{y,k}^2}{\\sigma_k^2} = \\frac{\\|\\mu_k\\|^2}{\\sigma_k^2}$.\n\nThe probability of violation at time step $k$ is:\n$$\nP(r_k^2  d_{\\min}^2) = P(p_{x,k}^2 + p_{y,k}^2  d_{\\min}^2) = P \\left( \\frac{p_{x,k}^2 + p_{y,k}^2}{\\sigma_k^2}  \\frac{d_{\\min}^2}{\\sigma_k^2} \\right) = P \\left( S_k  \\frac{d_{\\min}^2}{\\sigma_k^2} \\right)\n$$\nThis probability is given by the cumulative distribution function (CDF) of the $\\chi'^2(2, \\lambda_k)$ distribution evaluated at the point $d_{\\min}^2 / \\sigma_k^2$. Let $F_{\\chi'^2(df, \\lambda)}$ denote this CDF. Then the per-step violation probability $P_k^{\\text{viol}}$ is:\n$$\nP_k^{\\text{viol}} = F_{\\chi'^2(2, \\lambda_k)} \\left( \\frac{d_{\\min}^2}{\\sigma_k^2} \\right)\n$$\nThis can be computed numerically using a scientific library function for the non-central chi-squared CDF, valid for $k \\in \\{1, \\dots, N\\}$. For $k=0$, $\\sigma_0^2 = 0$ and the position is deterministic. The problem asks for evaluation over $k \\in \\{1, ..., N\\}$, so this is not an issue.\n\n**4. Union Bound on Total Violation Probability**\n\nThe overall safety specification is that no violation occurs at any time step from $k=1$ to $N$. The event of at least one violation is the union of the per-step violation events: $V = \\bigcup_{k=1}^N V_k$, where $V_k$ is the event $r_k  d_{\\min}$. Using Boole's inequality (the union bound), we can upper-bound the probability of this union event:\n$$\nP(V) = P \\left( \\bigcup_{k=1}^N V_k \\right) \\le \\sum_{k=1}^N P(V_k) = \\sum_{k=1}^N P_k^{\\text{viol}}\n$$\nThis sum provides an upper bound on the total probability of failure over the horizon $N$. Since a probability cannot exceed $1$, we clamp the result:\n$$\nP_{\\text{bound}} = \\min \\left( 1.0, \\sum_{k=1}^N P_k^{\\text{viol}} \\right)\n$$\n\n**5. Optimal Gain Selection and Risk Verification**\n\nThis entire procedure (Steps 1-4) is repeated for each candidate control gain $k_v$ from the provided finite set. This yields a set of union bounds, $\\{P_{\\text{bound}}(k_v)\\}$. The minimal union-bound violation probability is then found by taking the minimum over this set:\n$$\nP_{\\min} = \\min_{k_v} \\{ P_{\\text{bound}}(k_v) \\}\n$$\nFinally, we must check if any control gain can satisfy the given risk budget $\\varepsilon$. This is equivalent to checking if the minimal bound satisfies the budget:\n$$\n\\text{Risk Satisfied} = (P_{\\min} \\le \\varepsilon)\n$$\nThe final result for each test case is the pair $[P_{\\min}, \\text{Risk Satisfied}]$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import ncx2\n\ndef solve():\n    \"\"\"\n    Solves the stochastic safety verification problem for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"params\": {\n                \"dt\": 0.1, \"N\": 30, \"d_min\": 2.0, \"sigma_p\": 0.02,\n                \"p0\": (5.0, 0.0), \"v0\": (-0.5, 0.0),\n                \"kv_candidates\": [0.0, 1.0, 2.0, 4.0],\n                \"epsilon\": 0.05\n            }\n        },\n        {\n            \"case_id\": 2,\n            \"params\": {\n                \"dt\": 0.1, \"N\": 50, \"d_min\": 1.5, \"sigma_p\": 0.05,\n                \"p0\": (2.0, 0.0), \"v0\": (-0.3, 0.0),\n                \"kv_candidates\": [0.0, 0.5, 1.0, 2.0],\n                \"epsilon\": 0.1\n            }\n        },\n        {\n            \"case_id\": 3,\n            \"params\": {\n                \"dt\": 0.2, \"N\": 100, \"d_min\": 1.0, \"sigma_p\": 0.1,\n                \"p0\": (1.5, 0.0), \"v0\": (-0.2, 0.0),\n                \"kv_candidates\": [0.0, 0.5, 1.0],\n                \"epsilon\": 0.05\n            }\n        }\n    ]\n\n    results = []\n    \n    for case_data in test_cases:\n        params = case_data[\"params\"]\n        dt = params[\"dt\"]\n        N = params[\"N\"]\n        d_min = params[\"d_min\"]\n        sigma_p = params[\"sigma_p\"]\n        p0 = np.array(params[\"p0\"])\n        v0 = np.array(params[\"v0\"])\n        kv_candidates = params[\"kv_candidates\"]\n        epsilon = params[\"epsilon\"]\n        \n        all_union_bounds = []\n\n        for kv in kv_candidates:\n            sum_of_probs = 0.0\n            \n            # Create an array of time indices k from 1 to N\n            k_steps = np.arange(1, N + 1)\n            \n            # Step 1: Compute the mean trajectory mu_k for all k\n            if kv == 0.0:\n                # Vectorized calculation for kv=0\n                mu_p = p0 + v0 * k_steps[:, np.newaxis] * dt\n            else:\n                # Vectorized calculation for kv > 0\n                alpha = 1.0 - dt * kv\n                # Using np.power avoids potential issues with large k\n                geom_sum_factor = (1.0 - np.power(alpha, k_steps)) / kv\n                mu_p = p0 + v0 * geom_sum_factor[:, np.newaxis]\n            \n            # Step 2: Compute position variance sigma_k^2\n            sigma_k_sq = k_steps * (sigma_p**2)\n\n            # Step 3: Compute per-step violation probabilities\n            # Non-centrality parameter lambda_k\n            mu_p_sq_norm = np.sum(mu_p**2, axis=1)\n            # Handle potential division by zero if sigma_k_sq is somehow zero, although logic prevents this for k > 0\n            lambda_k = np.divide(mu_p_sq_norm, sigma_k_sq, out=np.zeros_like(mu_p_sq_norm), where=sigma_k_sq!=0)\n            \n            # Argument for the CDF\n            d_min_sq = d_min**2\n            x_arg = np.divide(d_min_sq, sigma_k_sq, out=np.full_like(sigma_k_sq, np.inf), where=sigma_k_sq!=0)\n            \n            # The CDF of the non-central chi-squared distribution\n            # with df=2 degrees of freedom\n            p_k_violations = ncx2.cdf(x=x_arg, df=2, nc=lambda_k)\n            \n            sum_of_probs = np.sum(p_k_violations)\n\n            # Step 4: Compute the Union Bound for the current kv\n            union_bound = min(1.0, sum_of_probs)\n            all_union_bounds.append(union_bound)\n\n        # Step 5: Find the minimum bound and check against the risk budget\n        min_union_bound = min(all_union_bounds)\n        satisfies_risk = min_union_bound = epsilon\n        \n        # Format the result string as '[value,bool]'\n        result_str = f\"[{min_union_bound:.6f},{satisfies_risk}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}