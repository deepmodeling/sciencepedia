{
    "hands_on_practices": [
        {
            "introduction": "在任何多智能体系统中，碰撞避免都是最基本也是最重要的安全要求。本练习将引导你通过控制屏障函数（CBFs）这一严谨的数学工具，将抽象的安全规范转化为具体的控制器参数约束。通过推导斥力强度的下界，你将亲身体验如何从第一性原理出发，为群体行为的安全性提供可证明的保障。",
            "id": "4249437",
            "problem": "考虑一个信息物理系统 (CPS) 中的 $N$ 个相同平面智能体组成的群体，其运动学模型为 $\\dot{x}_i(t) = u_i(t)$，其中 $x_i(t) \\in \\mathbb{R}^2$ 且控制量 $u_i(t) \\in \\mathbb{R}^2$。该群体的数字孪生实现了一个集群控制器，该控制器包含两个部分：一个吸引共识项和一个在接近预设安全距离时激活的短程排斥项。具体来说，对于智能体 $i$，\n$u_i = u_i^{\\mathrm{att}} + u_i^{\\mathrm{rep}}$，\n其中吸引共识项为\n$$\nu_i^{\\mathrm{att}} = -b \\sum_{j \\neq i} (x_i - x_j),\n$$\n常数 $b > 0$，排斥项为\n$$\nu_i^{\\mathrm{rep}} = \\alpha \\sum_{j \\neq i} \\sigma(r_{ij}) r_{ij}^{-q} \\frac{x_i - x_j}{r_{ij}},\n$$\n其中 $r_{ij} := \\|x_i - x_j\\|$，指数 $q > 0$，强度 $\\alpha > 0$，以及一个二元激活函数 $\\sigma(r)$，其定义为：当 $r \\le d_0$ 时 $\\sigma(r) = 1$，当 $r > d_0$ 时 $\\sigma(r) = 0$，其中 $d_0 > 0$ 是预设的最小间隔距离。该数字孪生通过控制屏障函数 (CBF) $h_{ij}(x) := \\|x_i - x_j\\|^2 - d_0^2$ 来强制实现成对安全，要求安全集 $\\{x : h_{ij}(x) \\ge 0 \\ \\forall\\ i \\neq j\\}$ 具有正向不变性。\n\n从第一性原理（相对距离动力学的定义和零化屏障证书的正向不变性条件）出发，推导排斥强度 $\\alpha$ 的一个闭式下界，该下界用 $N$、$b$、$d_0$ 和 $q$ 表示，并能保证在每个满足 $h_{ij}(x) = 0$ 的边界点上都有 $\\dot{h}_{ij}(x) \\ge 0$。假设在最坏情况下，当 $h_{ij}(x) = 0$ 时，对于智能体对 $(i, j)$，只有它们之间的排斥力是激活的，而其他智能体对并不同时处于其激活边界上。请将最终答案表示为关于 $N$、$b$、$d_0$ 和 $q$ 的单个解析表达式。不需要进行数值近似。",
            "solution": "用户希望找到智能体群中排斥强度参数 $\\alpha$ 的一个下界，以保证成对安全。安全性由控制屏障函数 (CBF) 约束 $\\dot{h}_{ij}(x) \\ge 0$ (当 $h_{ij}(x) = 0$ 时) 定义。\n\n首先，对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   智能体数量：$N$。\n-   智能体状态：$x_i(t) \\in \\mathbb{R}^2$。\n-   智能体动力学：$\\dot{x}_i(t) = u_i(t)$，控制输入 $u_i(t) \\in \\mathbb{R}^2$。\n-   控制律：$u_i = u_i^{\\mathrm{att}} + u_i^{\\mathrm{rep}}$。\n-   吸引分量：$u_i^{\\mathrm{att}} = -b \\sum_{j \\neq i} (x_i - x_j)$，常数 $b > 0$。\n-   排斥分量：$u_i^{\\mathrm{rep}} = \\alpha \\sum_{j \\neq i} \\sigma(r_{ij}) r_{ij}^{-q} \\frac{x_i - x_j}{r_{ij}}$，其中 $r_{ij} := \\|x_i - x_j\\|$，指数 $q > 0$，强度 $\\alpha > 0$。\n-   激活函数：当 $r \\le d_0$ 时 $\\sigma(r) = 1$，当 $r > d_0$ 时 $\\sigma(r) = 0$，其中 $d_0 > 0$ 是最小间隔距离。\n-   控制屏障函数：$h_{ij}(x) := \\|x_i - x_j\\|^2 - d_0^2$。\n-   安全条件：在每个满足 $h_{ij}(x) = 0$ 的边界点上必须有 $\\dot{h}_{ij}(x) \\ge 0$。\n-   最坏情况假设：在 $h_{ij}(x) = 0$ 时，对于智能体对 $(i,j)$，只有它们之间的排斥力是激活的 ($\\sigma(r_{ij})=1$)，而对于任何其他智能体 $k \\neq i, j$，距离 $r_{ik}$ 和 $r_{jk}$ 大于 $d_0$ (即 $\\sigma(r_{ik}) = \\sigma(r_{jk}) = 0$)。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于多智能体系统、控制理论，特别是用于安全关键控制的控制屏障函数 (CBF) 方法的既定原理。集群（吸引/排斥）和运动学智能体的模型是该领域的标准模型。\n-   **良态问题**：该问题提供了推导所要求的下界所需的所有必要定义和方程。“最坏情况”假设被明确说明，这使得问题可解，并能导出一个唯一的解析解。\n-   **客观性**：语言精确且数学化。所有术语都有明确定义。\n-   **完整性和一致性**：该问题是自洽的。定义和约束相互一致。没有缺少必要信息。\n-   **现实性**：该模型是机器人学和信息物理系统研究中使用的智能体动力学的一种常见且有效的简化。\n该问题被认为是有效的。\n\n### 下界的推导\n如果集合 $\\{x : h_{ij}(x) \\ge 0, \\forall i \\neq j\\}$ 是正向不变的，则系统的安全性得到保证。对于给定的这种零化屏障证书，如果对于安全集边界上的所有智能体对 $(i, j)$（即 $h_{ij}(x) = 0$ 处），都有 $\\dot{h}_{ij}(x) \\ge 0$，则该条件得到满足。\n\n屏障函数为 $h_{ij}(x) = \\|x_i - x_j\\|^2 - d_0^2$。\n条件 $h_{ij}(x) = 0$ 意味着智能体 $i$ 和 $j$ 之间的距离恰好是安全距离，即 $r_{ij} = \\|x_i - x_j\\| = d_0$。\n\n我们计算 $h_{ij}(x)$ 沿系统轨迹的时间导数：\n$$\n\\dot{h}_{ij} = \\frac{d}{dt} \\left( (x_i - x_j)^T(x_i - x_j) - d_0^2 \\right) = 2(x_i - x_j)^T (\\dot{x}_i - \\dot{x}_j).\n$$\n代入系统动力学 $\\dot{x}_i = u_i$，我们得到：\n$$\n\\dot{h}_{ij} = 2(x_i - x_j)^T (u_i - u_j).\n$$\n安全条件是 $\\dot{h}_{ij} \\ge 0$，这转化为：\n$$\n2(x_i - x_j)^T (u_i - u_j) \\ge 0.\n$$\n现在，我们必须找到相对控制输入 $u_i - u_j$ 的表达式。\n$$\nu_i - u_j = (u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}}) + (u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}).\n$$\n让我们分别分析每个分量。\n\n1.  **吸引分量之差 ($u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}}$):**\n    $$\n    u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}} = \\left(-b \\sum_{k \\neq i} (x_i - x_k)\\right) - \\left(-b \\sum_{k \\neq j} (x_j - x_k)\\right) = -b \\left( \\sum_{k \\neq i} (x_i - x_k) - \\sum_{k \\neq j} (x_j - x_k) \\right).\n    $$\n    我们可以通过分离涉及智能体 $i$ 和 $j$ 的项来重写求和：\n    $$\n    \\sum_{k \\neq i} (x_i - x_k) = (x_i - x_j) + \\sum_{k \\neq i,j} (x_i - x_k).\n    $$\n    $$\n    \\sum_{k \\neq j} (x_j - x_k) = (x_j - x_i) + \\sum_{k \\neq i,j} (x_j - x_k).\n    $$\n    用第一个式子减去第二个式子得到：\n    $$\n    (x_i - x_j) - (x_j - x_i) + \\sum_{k \\neq i,j} \\left( (x_i - x_k) - (x_j - x_k) \\right) = 2(x_i - x_j) + \\sum_{k \\neq i,j} (x_i - x_j).\n    $$\n    索引为 $k \\neq i,j$ 的智能体有 $N-2$ 个。因此：\n    $$\n    2(x_i - x_j) + (N-2)(x_i - x_j) = N(x_i - x_j).\n    $$\n    因此，吸引分量之差为：\n    $$\n    u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}} = -b N (x_i - x_j).\n    $$\n\n2.  **排斥分量之差 ($u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}$):**\n    排斥控制由 $u_i^{\\mathrm{rep}} = \\alpha \\sum_{k \\neq i} \\sigma(r_{ik}) r_{ik}^{-(q+1)} (x_i - x_k)$ 给出。\n    我们在边界 $h_{ij}(x) = 0$（即 $r_{ij} = d_0$）处计算该值。根据问题的假设，在这一点上，$\\sigma(r_{ij})=1$，但对于任何其他智能体 $k \\neq i,j$，我们有 $r_{ik} > d_0$ 和 $r_{jk} > d_0$，这意味着 $\\sigma(r_{ik})=0$ 和 $\\sigma(r_{jk})=0$。\n    这极大地简化了求和。对于 $u_i^{\\mathrm{rep}}$，求和中的唯一非零项是当 $k=j$ 时：\n    $$\n    u_i^{\\mathrm{rep}} = \\alpha \\sigma(r_{ij}) r_{ij}^{-(q+1)} (x_i - x_j).\n    $$\n    由于在边界处 $r_{ij} = d_0$ 且 $\\sigma(r_{ij})=1$：\n    $$\n    u_i^{\\mathrm{rep}} \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)} (x_i - x_j).\n    $$\n    类似地，对于 $u_j^{\\mathrm{rep}} = \\alpha \\sum_{k \\neq j} \\sigma(r_{jk}) r_{jk}^{-(q+1)} (x_j - x_k)$，唯一的非零项是当 $k=i$ 时：\n    $$\n    u_j^{\\mathrm{rep}} = \\alpha \\sigma(r_{ji}) r_{ji}^{-(q+1)} (x_j - x_i).\n    $$\n    由于 $r_{ji}=r_{ij}=d_0$ 且 $\\sigma(r_{ji})=1$：\n    $$\n    u_j^{\\mathrm{rep}} \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)} (x_j - x_i) = -\\alpha d_0^{-(q+1)} (x_i - x_j).\n    $$\n    那么，差值为：\n    $$\n    (u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}) \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)}(x_i-x_j) - (-\\alpha d_0^{-(q+1)}(x_i-x_j)) = 2\\alpha d_0^{-(q+1)}(x_i-x_j).\n    $$\n\n现在，我们将这些结果结合起来，并代回到在边界 $h_{ij}=0$ 处计算的 $\\dot{h}_{ij}$ 的安全条件中：\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2(x_i - x_j)^T \\left( -bN(x_i - x_j) + 2\\alpha d_0^{-(q+1)}(x_i - x_j) \\right).\n$$\n使用恒等式 $(x_i-x_j)^T(x_i-x_j) = \\|x_i-x_j\\|^2 = r_{ij}^2$，并且知道在边界处 $r_{ij}=d_0$：\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2 \\left( -bN\\|x_i - x_j\\|^2 + 2\\alpha d_0^{-(q+1)}\\|x_i - x_j\\|^2 \\right) = 2 \\left( -bN d_0^2 + 2\\alpha d_0^{-(q+1)}d_0^2 \\right).\n$$\n化简指数：\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2 \\left( -bN d_0^2 + 2\\alpha d_0^{-q+1} \\right).\n$$\n安全条件要求 $\\dot{h}_{ij} \\ge 0$：\n$$\n2 \\left( -bN d_0^2 + 2\\alpha d_0^{-q+1} \\right) \\ge 0.\n$$\n$$\n-bN d_0^2 + 2\\alpha d_0^{-q+1} \\ge 0.\n$$\n我们现在解出 $\\alpha$：\n$$\n2\\alpha d_0^{-q+1} \\ge bN d_0^2.\n$$\n$$\n\\alpha \\ge \\frac{bN d_0^2}{2 d_0^{-q+1}}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{2 - (-q+1)}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{2+q-1}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{q+1}.\n$$\n这给出了在指定条件下保证安全的排斥强度 $\\alpha$ 的闭式下界。",
            "answer": "$$\n\\boxed{\\frac{bN}{2} d_0^{q+1}}\n$$"
        },
        {
            "introduction": "在确保了物理安全之后，我们转向保障群体智能的信息基础——共识。然而，现实世界中的传感器存在固有偏差，这会干扰共识过程并导致群体决策错误。本练习旨在量化这种偏差对平均共识协议稳态误差的影响，并进一步设计一个分布式的校准方案来消除漂移，这对于构建能够准确反映物理世界的鲁棒数字孪生至关重要。",
            "id": "4249398",
            "problem": "考虑一个由 $n$ 个信息物理智能体组成的互联群体，它们构成一个网络化的信息物理系统 (CPS)。通信拓扑是一个无向、连通的加权图，其邻接权重对称 $a_{ij} = a_{ji} \\ge 0$，拉普拉斯矩阵 $L \\in \\mathbb{R}^{n \\times n}$ 定义为 $L = D - A$，度矩阵 $D = \\mathrm{diag}(d_{1},\\dots,d_{n})$ 其中 $d_{i} = \\sum_{j=1}^{n} a_{ij}$，并且 $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$，其中 $\\mathbf{1} \\in \\mathbb{R}^{n}$ 是全一向量。\n\n每个智能体 $i \\in \\{1,\\dots,n\\}$ 拥有一个物理状态 $x_{i}(t)$ 和一个与其邻居通信的数字孪生。智能体测量一个带偏差的量 $y_{i}(t) = x_{i}(t) + \\beta_{i}$，其中传感器偏差 $\\beta_{i} \\in \\mathbb{R}$ 是未知常数，并通过与邻居交换测量值 $y_{j}(t)$ 来运行连续时间平均一致性算法：\n$$\n\\dot{x}_{i}(t) = \\sum_{j=1}^{n} a_{ij} (y_{j}(t) - y_{i}(t)).\n$$\n令 $x(0) \\in \\mathbb{R}^{n}$ 表示初始状态向量，并定义无偏真实平均值为 $\\bar{x} = \\frac{1}{n} \\mathbf{1}^{\\top} x(0)$。在上述协议下，群体试图就平均值达成一致，但偏差 $\\beta_{i}$ 会扰动其演化过程。\n\n任务1：从协议、图定义和测量模型出发，推导稳态误差向量 $e^{\\star} \\in \\mathbb{R}^{n}$，其分量为 $e^{\\star}_{i} = x^{\\star}_{i} - \\bar{x}$，其中 $x^{\\star}$ 表示在有偏一致性动力学下 $x(t)$ 当 $t \\to \\infty$ 时的极限。将 $e^{\\star}$ 用 $\\beta \\in \\mathbb{R}^{n}$ 和标量平均偏差 $\\bar{\\beta} = \\frac{1}{n} \\mathbf{1}^{\\top} \\beta$ 表示为闭式解。\n\n任务2：提出一个分布式的网络层校准方案，该方案为每个智能体的数字孪生增加一个估计器状态 $\\hat{\\beta}_{i}(t)$，并在一致性更新中用校准后的输入 $r_{i}(t) = y_{i}(t) - \\hat{\\beta}_{i}(t)$ 替换测量输入 $y_{i}(t)$。仅使用邻居交换和拉普拉斯耦合，指定 $\\hat{\\beta}_{i}(t)$ 的局部动力学和修改后的一致性动力学，使得所有智能体都能收敛到无偏平均值 $\\bar{x}$，不受任意恒定偏差 $\\beta_{i}$ 的影响。推导堆叠的闭环动力学，识别不变量，并给出关于标量估计器增益 $\\gamma > 0$ 和一个初始化准则的充分条件，以确保对所有 $i$ 都有 $x_{i}(t) \\to \\bar{x}$ 的收敛性。无需进行数值近似。\n\n你的最终答案必须是任务1中得到的 $e^{\\star}$ 的闭式表达式。无需四舍五入，也无需单位。",
            "solution": "我们首先将动力学表示为堆叠向量形式，并分析由偏差引起的扰动。定义向量 $x(t) \\in \\mathbb{R}^{n}$、$y(t) \\in \\mathbb{R}^{n}$ 和 $\\beta \\in \\mathbb{R}^{n}$，其分量分别为 $x_{i}(t)$、$y_{i}(t)$ 和 $\\beta_{i}$。测量模型为 $y(t) = x(t) + \\beta$。堆叠形式的平均一致性协议为\n$$\n\\dot{x}(t) = -L y(t) = -L \\big(x(t) + \\beta\\big) = -L x(t) - L \\beta.\n$$\n我们回顾一下关于连通无向图的基本事实：$L$ 是对称半正定矩阵，其零空间为 $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$，所有其他特征值都严格为正，并且在标准一致性流下，平均值是不变的，因为 $\\mathbf{1}^{\\top} L = \\mathbf{0}^{\\top}$。这些性质意味着 $\\mathbf{1}^{\\top} \\dot{x}(t) = -\\mathbf{1}^{\\top} L \\big(x(t) + \\beta\\big) = 0$，因此平均值 $\\bar{x} = \\frac{1}{n} \\mathbf{1}^{\\top} x(t)$ 不随时间变化，且等于 $\\frac{1}{n} \\mathbf{1}^{\\top} x(0)$。\n\n为了描述稳态，考虑 $z(t) \\triangleq x(t) + \\beta$ 的演化。使用上述动力学，我们得到\n$$\n\\dot{z}(t) = \\dot{x}(t) = -L \\big(x(t) + \\beta\\big) = -L z(t).\n$$\n因此 $z(t)$ 遵循一个标准的一致性流。对于连通图，解满足\n$$\n\\lim_{t \\to \\infty} z(t) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} z(0) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} \\big(x(0) + \\beta\\big) = \\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1}.\n$$\n因此，稳态 $x^{\\star}$ 为\n$$\nx^{\\star} = \\lim_{t \\to \\infty} x(t) = \\lim_{t \\to \\infty} \\big(z(t) - \\beta\\big) = \\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1} - \\beta.\n$$\n定义相对于无偏平均值 $\\bar{x}$ 的误差向量 $e^{\\star} \\in \\mathbb{R}^{n}$ 为 $e^{\\star} = x^{\\star} - \\bar{x}\\mathbf{1}$。代入 $x^{\\star}$ 的表达式得到\n$$\ne^{\\star} = \\Big(\\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1} - \\beta\\Big) - \\bar{x}\\mathbf{1} = \\bar{\\beta}\\,\\mathbf{1} - \\beta.\n$$\n对所有 $i$，分量形式为 $e^{\\star}_{i} = \\bar{\\beta} - \\beta_{i}$。这表明，在没有校准的情况下，每个智能体相对于真实平均值的稳态误差是网络平均偏差与其局部偏差之间的差值，并且除非所有 $\\beta_{i}$ 都相同，否则群体无法达到相等的状态。\n\n我们现在提出一个分布式的校准方案，该方案通过估计和减去偏差来消除漂移。每个智能体维持一个估计器状态 $\\hat{\\beta}_{i}(t)$，并且校准后的输入为 $r_{i}(t) = y_{i}(t) - \\hat{\\beta}_{i}(t)$。修改后的一致性更新为\n$$\n\\dot{x}(t) = -L r(t) = -L \\big(y(t) - \\hat{\\beta}(t)\\big),\n$$\n其中 $r(t) \\in \\mathbb{R}^{n}$ 和 $\\hat{\\beta}(t) \\in \\mathbb{R}^{n}$ 分别堆叠了分量 $r_{i}(t)$ 和 $\\hat{\\beta}_{i}(t)$。我们选择一个由拉普拉斯耦合驱动的简单分布式估计器：\n$$\n\\dot{\\hat{\\beta}}(t) = \\gamma\\, L \\big(y(t) - \\hat{\\beta}(t)\\big),\n$$\n标量增益为 $\\gamma > 0$。两个更新都只通过 $L$ 使用邻居交换，并且可以在 CPS 中使用本地孪生计算和通信来实现。\n\n定义 $s(t) \\triangleq y(t) - \\hat{\\beta}(t) = x(t) + \\beta - \\hat{\\beta}(t)$。结合两个动力学，我们得到\n$$\n\\dot{s}(t) = \\dot{y}(t) - \\dot{\\hat{\\beta}}(t) = \\dot{x}(t) - \\gamma\\, L \\big(y(t) - \\hat{\\beta}(t)\\big) = -L s(t) - \\gamma\\, L s(t) = -(1+\\gamma) L s(t).\n$$\n因此 $s(t)$ 是一个在速率因子为 $(1+\\gamma)$ 的拉普拉斯流下演化的一致性状态。对于连通图，平均值 $\\bar{s}(t) = \\frac{1}{n} \\mathbf{1}^{\\top} s(t)$ 是不变的，因为 $\\mathbf{1}^{\\top} L = \\mathbf{0}^{\\top}$，并且\n$$\n\\lim_{t \\to \\infty} s(t) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} s(0) = \\bar{s}(0)\\,\\mathbf{1}.\n$$\n因为 $s(0) = y(0) - \\hat{\\beta}(0) = x(0) + \\beta - \\hat{\\beta}(0)$，其初始平均值为 $\\bar{s}(0) = \\bar{x} + \\bar{\\beta} - \\bar{\\hat{\\beta}}(0)$。如果初始化满足标量准则\n$$\n\\bar{\\hat{\\beta}}(0) = \\bar{\\beta},\n$$\n那么 $\\bar{s}(0) = \\bar{x}$ 且 $s(t) \\to \\bar{x}\\,\\mathbf{1}$。当 $s(t)$ 趋近于 $\\bar{x}\\,\\mathbf{1}$ 时，修改后的一致性动力学渐近地变为\n$$\n\\dot{x}(t) = -L s(t) \\to -L \\big(\\bar{x}\\,\\mathbf{1}\\big) = \\mathbf{0},\n$$\n并且，根据在与 $\\mathbf{1}$ 正交的子空间上的标准一致性收敛性，$x(t)$ 收敛到常数向量 $\\bar{x}\\,\\mathbf{1}$，而不受未知偏差 $\\beta_{i}$ 的影响。收敛的充分条件是：\n- 通信图是无向且连通的，使得 $L$ 的零空间为 $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$ 并且其他特征值为正值；\n- 估计器增益满足 $\\gamma > 0$，这确保了 $-(1+\\gamma)L$ 是负半定的，并且在与 $\\mathbf{1}$ 正交的子空间上严格衰减；\n- 估计器平均值被初始化为平均偏差，即 $\\bar{\\hat{\\beta}}(0) = \\bar{\\beta}$，这可以通过例如一次性的分布式校准过程来估计初始残差的网络平均值，或通过任何将估计器的均值与偏差的均值对齐的机制来实现。\n\n在这些条件下，$(x,s)$ 的闭环堆叠动力学为\n$$\n\\begin{pmatrix}\n\\dot{x}(t) \\\\\n\\dot{s}(t)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-L  0 \\\\\n0  -(1+\\gamma)L\n\\end{pmatrix}\n\\begin{pmatrix}\ns(t) \\\\\ns(t)\n\\end{pmatrix},\n$$\n其中 $s(t)$ 收敛到 $\\bar{x}\\,\\mathbf{1}$ 并且 $x(t)$ 收敛到 $\\bar{x}\\,\\mathbf{1}$，从而消除漂移并恢复到无偏平均值的收敛。\n\n回到任务1，未校准情况下的稳态误差为\n$$\ne^{\\star} = \\bar{\\beta}\\,\\mathbf{1} - \\beta,\n$$\n这是一个完全用偏差向量及其网络平均值表示的闭式表达式。",
            "answer": "$$\\boxed{\\bar{\\beta}\\,\\mathbf{1}-\\beta}$$"
        },
        {
            "introduction": "真实的物理世界充满了不确定性，除了系统的内部偏差，智能体还会受到外部随机扰动的影响。本练习模拟了数字孪生在执行形式化安全验证中的核心作用，要求你结合智能体的动力学模型与随机分析方法。通过计算在随机扰动下违反安全规范的概率上界，你将学会如何量化系统风险，并从一组控制策略中选择最优方案以满足给定的风险预算。",
            "id": "4249411",
            "problem": "考虑一个在平面中运行的机器人集群中两个机器人的数字孪生，其被建模为一个成对相对状态，该状态具有离散时间线性动力学，并受到加性高斯扰动的影响。在离散时间索引 $k \\in \\{0,1,2,\\dots,N\\}$ 处，沿各轴的相对位置由 $p_{x,k}$ 和 $p_{y,k}$ 表示，沿各轴的相对速度由 $v_{x,k}$ 和 $v_{y,k}$ 表示。时间步长为 $\\Delta t$（单位：秒）。碰撞避免安全要求是，对于所有 $k \\in \\{1,2,\\dots,N\\}$，欧几里得间隔 $r_k = \\sqrt{p_{x,k}^2 + p_{y,k}^2}$ 必须满足 $r_k \\ge d_{\\min}$（单位：米）。\n\n基本假设和定义：\n- 动力学是线性时不变的，且各轴是解耦和对称的。对于每个轴 $j \\in \\{x,y\\}$，速度更新为 $v_{j,k+1} = (1 - \\Delta t \\, k_v) \\, v_{j,k}$，其中 $k_v \\ge 0$（单位：$1/\\mathrm{s}$）是一个从有限候选集中选择的恒定控制增益。位置更新为 $p_{j,k+1} = p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}$，其中扰动 $\\eta_{j,k}$ 在时间和轴上是独立同分布的，满足 $\\eta_{j,k} \\sim \\mathcal{N}(0, \\sigma_p^2)$（单位：$\\mathrm{m}^2$）。\n- 初始状态 $(p_{x,0}, p_{y,0}, v_{x,0}, v_{y,0})$ 是确定性的。\n- 扰动是零均值高斯分布且跨时间独立，在每个时间步为位置分量产生各向同性的协方差。\n- 安全规范表示为在时间范围内的“始终保持间隔在阈值以上”这一时间属性，可以用信号时序逻辑（STL）编码为 $G_{[0,N \\Delta t]} ( r(t) \\ge d_{\\min} )$，其中 $G$ 表示“全局”算子。\n\n任务：\n1. 对于给定测试用例中提供的集合中的每个候选控制增益 $k_v$，使用动力学和初始条件计算所有 $k \\in \\{1,2,\\dots,N\\}$ 的相对位置的平均轨迹 $\\mu_k = [\\mu_{x,k}, \\mu_{y,k}]^\\top$。当 $k_v > 0$ 时，速度的几何特性意味着几何衰减；请精确处理 $k_v = 0$ 的情况。长度以米表示，时间以秒表示。\n2. 利用扰动的独立性和各向同性，计算每个时间 $k$ 的位置的边际协方差，其形式为 $\\sigma_k^2 I_2$，其中 $I_2$ 是 $2 \\times 2$ 的单位矩阵，$\\sigma_k^2$ 的单位是 $\\mathrm{m}^2$。使用此模型将位置向量 $[p_{x,k}, p_{y,k}]^\\top$ 建模为均值为 $\\mu_k$、协方差为 $\\sigma_k^2 I_2$ 的二维高斯分布。\n3. 对于每个 $k$，计算在该时间的安全违规概率，即 $\\sqrt{p_{x,k}^2 + p_{y,k}^2}  d_{\\min}$ 的概率。使用具有各向同性协方差的二维高斯分布的平方范数的已知分布来精确获得此概率。不要使用采样进行近似；使用解析累积分布。答案必须是 $[0,1]$ 内的一个十进制数。\n4. 使用布尔不等式（也称为联合界），通过对第3项中每个时间的概率求和，来为在时间范围内任何时候违反安全规范的概率设置上界。由于概率的界限为 $1$，将求和得到的界限限制在区间 $[0,1]$ 内。\n5. 在 $k_v$ 的候选集上，计算最小的联合界违规概率。同时，确定候选集中是否存在一个 $k_v$，能确保联合界违规概率小于或等于给定的风险预算 $\\varepsilon$（一个在 $[0,1]$ 内的十进制数）。形式化验证声明使用联合界来证明在指定的随机扰动下满足“始终”安全属性。\n\n数值单位：\n- 距离 $p_{x,k}$、$p_{y,k}$、$r_k$、$d_{\\min}$ 的单位是米。\n- 时间步长 $\\Delta t$ 的单位是秒。\n- 速度 $v_{x,k}$、$v_{y,k}$ 的单位是米/秒。\n- 扰动方差 $\\sigma_p^2$ 的单位是平方米。\n- 控制增益 $k_v$ 的单位是 $1/s$。\n- 概率必须以 $[0,1]$ 内的十进制数返回。\n\n测试套件：\n使用以下三个测试用例。对于每个用例，候选控制增益是一个有限集，并指定了风险预算 $\\varepsilon$。\n- 用例 1：$\\Delta t = 0.1$, $N = 30$, $d_{\\min} = 2.0$, $\\sigma_p = 0.02$, $(p_{x,0}, p_{y,0}) = (5.0, 0.0)$, $(v_{x,0}, v_{y,0}) = (-0.5, 0.0)$, 候选 $k_v$ 集合 $\\{0.0, 1.0, 2.0, 4.0\\}$, $\\varepsilon = 0.05$。\n- 用例 2：$\\Delta t = 0.1$, $N = 50$, $d_{\\min} = 1.5$, $\\sigma_p = 0.05$, $(p_{x,0}, p_{y,0}) = (2.0, 0.0)$, $(v_{x,0}, v_{y,0}) = (-0.3, 0.0)$, 候选 $k_v$ 集合 $\\{0.0, 0.5, 1.0, 2.0\\}$, $\\varepsilon = 0.1$。\n- 用例 3：$\\Delta t = 0.2$, $N = 100$, $d_{\\min} = 1.0$, $\\sigma_p = 0.1$, $(p_{x,0}, p_{y,0}) = (1.5, 0.0)$, $(v_{x,0}, v_{y,0}) = (-0.2, 0.0)$, 候选 $k_v$ 集合 $\\{0.0, 0.5, 1.0\\}$, $\\varepsilon = 0.05$。\n\n要求的最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一项。每一项必须是一个形式为 $[x,y]$ 的双元素列表，其中 $x$ 是四舍五入到六位小数的最小联合界违规概率，而 $y$ 是一个布尔值，指示候选集中是否存在满足风险预算的 $k_v$。例如，输出必须类似于 $[[0.012345,True],[0.067890,False],[0.000100,True]]$（其值由指定测试用例的计算确定）。",
            "solution": "用户在信息物理系统的随机安全分析领域提供了一个良构问题，具体是关于两个机器人的数字孪生。任务是为一个离散时间线性高斯系统在不同控制策略下验证其安全属性，并确定能使安全违规概率上界最小化的最优控制增益。该问题具有科学依据、自洽且客观。我将提供一个完整的解决方案。\n\n解决方法遵循问题陈述中概述的五个步骤。我们将首先推导相对状态的均值和协方差的解析表达式，然后用它们来计算每个时间步的安全违规概率。最后，我们将使用联合界来估计在整个时间范围内的总失败概率，并在候选控制增益集上优化此界。\n\n**1. 平均轨迹计算**\n\n系统动力学是线性的，过程噪声是零均值的。因此，平均状态 $\\mu_k = [\\mu_{x,k}, \\mu_{y,k}]^\\top$ 和平均速度的传播由系统方程的确定性部分决定。初始状态 $(p_{x,0}, p_{y,0}, v_{x,0}, v_{y,0})$ 是给定的且是确定性的。\n\n对于每个轴 $j \\in \\{x,y\\}$，时间步 $k+1$ 处的平均速度为：\n$$\n\\mathbb{E}[v_{j,k+1}] = \\mathbb{E}[(1 - \\Delta t \\, k_v) \\, v_{j,k}] = (1 - \\Delta t \\, k_v) \\, \\mathbb{E}[v_{j,k}]\n$$\n由于速度动力学不受噪声驱动，速度轨迹是确定性的。我们记 $\\mu_{v_{j,k}} = v_{j,k}$。此递推关系的解是一个几何级数：\n$$\nv_{j,k} = (1 - \\Delta t \\, k_v)^k \\, v_{j,0}\n$$\n平均位置 $\\mu_{p_{j,k}} = \\mathbb{E}[p_{j,k}]$ 根据以下公式演化：\n$$\n\\mu_{p_{j,k+1}} = \\mathbb{E}[p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}] = \\mu_{p_{j,k}} + \\Delta t \\, v_{j,k} + \\mathbb{E}[\\eta_{j,k}] = \\mu_{p_{j,k}} + \\Delta t \\, v_{j,k}\n$$\n从确定性的初始位置 $\\mu_{p_{j,0}} = p_{j,0}$ 开始，我们可以展开递推关系：\n$$\n\\mu_{p_{j,k}} = p_{j,0} + \\Delta t \\sum_{i=0}^{k-1} v_{j,i} = p_{j,0} + \\Delta t \\sum_{i=0}^{k-1} (1 - \\Delta t \\, k_v)^i \\, v_{j,0}\n$$\n该和是一个有限几何级数。令 $\\alpha = 1 - \\Delta t \\, k_v$。\n- 如果 $k_v = 0$，则 $\\alpha=1$。该和为 $\\sum_{i=0}^{k-1} 1^i = k$。平均位置为：\n$$\n\\mu_{p_{j,k}} = p_{j,0} + k \\Delta t \\, v_{j,0} \\quad (\\text{for } k_v = 0)\n$$\n- 如果 $k_v > 0$，则 $\\alpha \\neq 1$。该和为 $\\frac{1-\\alpha^k}{1-\\alpha} = \\frac{1-(1 - \\Delta t \\, k_v)^k}{\\Delta t \\, k_v}$。平均位置为：\n$$\n\\mu_{p_{j,k}} = p_{j,0} + \\Delta t \\, v_{j,0} \\left( \\frac{1 - (1 - \\Delta t \\, k_v)^k}{\\Delta t \\, k_v} \\right) = p_{j,0} + v_{j,0} \\frac{1 - (1 - \\Delta t \\, k_v)^k}{k_v} \\quad (\\text{for } k_v > 0)\n$$\n因此，对于任何 $k \\in \\{1, \\dots, N\\}$ 和任何候选增益 $k_v$，我们可以计算出平均位置向量 $\\mu_k = [\\mu_{x,k}, \\mu_{y,k}]^\\top$。\n\n**2. 位置协方差计算**\n\n问题陈述指出，位置向量 $[p_{x,k}, p_{y,k}]^\\top$ 具有各向同性协方差矩阵 $\\sigma_k^2 I_2$。我们需要求出 $\\sigma_k^2$。位置更新为 $p_{j,k+1} = p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}$。由于速度轨迹 $\\{v_{j,k}\\}$ 是确定性的，位置的不确定性按如下方式传播。\n令位置的中心化随机变量为 $\\tilde{p}_{j,k} = p_{j,k} - \\mu_{p_{j,k}}$。其更新规则为：\n$$\n\\tilde{p}_{j,k+1} = p_{j,k+1} - \\mu_{p_{j,k+1}} = (p_{j,k} + \\Delta t \\, v_{j,k} + \\eta_{j,k}) - (\\mu_{p_{j,k}} + \\Delta t \\, v_{j,k}) = \\tilde{p}_{j,k} + \\eta_{j,k}\n$$\n初始位置是确定性的，所以 $\\tilde{p}_{j,0} = 0$ 且其方差为 $0$。扰动 $\\eta_{j,k}$ 是独立同分布的，满足 $\\eta_{j,k} \\sim \\mathcal{N}(0, \\sigma_p^2)$ 且与过去的状态无关。 $\\tilde{p}_{j,k}$ 的方差为：\n$$\n\\mathrm{Var}(\\tilde{p}_{j,k}) = \\mathrm{Var} \\left( \\sum_{i=0}^{k-1} \\eta_{j,i} \\right) = \\sum_{i=0}^{k-1} \\mathrm{Var}(\\eta_{j,i}) = \\sum_{i=0}^{k-1} \\sigma_p^2 = k \\sigma_p^2\n$$\n由于各轴解耦且扰动在各轴上独立同分布，位置向量 $[p_{x,k}, p_{y,k}]^\\top$ 的协方差是对角的，且对角线元素相等，即 $\\mathrm{Var}(p_{x,k}) = \\mathrm{Var}(p_{y,k})$。因此，标量方差项为：\n$$\n\\sigma_k^2 = k \\sigma_p^2\n$$\n时间 $k$ 的位置分布为 $\\mathbf{p}_k = [p_{x,k}, p_{y,k}]^\\top \\sim \\mathcal{N}(\\mu_k, \\sigma_k^2 I_2)$。\n\n**3. 每时间步的违规概率**\n\n安全要求是 $r_k = \\sqrt{p_{x,k}^2 + p_{y,k}^2} \\ge d_{\\min}$。如果 $r_k  d_{\\min}$，即等价于 $r_k^2  d_{\\min}^2$，则发生违规。我们需要计算 $P(p_{x,k}^2 + p_{y,k}^2  d_{\\min}^2)$。\n\n随机变量 $p_{x,k}$ 和 $p_{y,k}$ 是独立的，并服从 $p_{x,k} \\sim \\mathcal{N}(\\mu_{x,k}, \\sigma_k^2)$ 和 $p_{y,k} \\sim \\mathcal{N}(\\mu_{y,k}, \\sigma_k^2)$。量 $S_k = \\frac{p_{x,k}^2}{\\sigma_k^2} + \\frac{p_{y,k}^2}{\\sigma_k^2}$ 服从非中心卡方分布，$S_k \\sim \\chi'^2(df, \\lambda_k)$，其中：\n- 自由度 $df=2$（对于二维）。\n- 非中心参数 $\\lambda_k = \\frac{\\mu_{x,k}^2}{\\sigma_k^2} + \\frac{\\mu_{y,k}^2}{\\sigma_k^2} = \\frac{\\|\\mu_k\\|^2}{\\sigma_k^2}$。\n\n时间步 $k$ 的违规概率是：\n$$\nP(r_k^2  d_{\\min}^2) = P(p_{x,k}^2 + p_{y,k}^2  d_{\\min}^2) = P \\left( \\frac{p_{x,k}^2 + p_{y,k}^2}{\\sigma_k^2}  \\frac{d_{\\min}^2}{\\sigma_k^2} \\right) = P \\left( S_k  \\frac{d_{\\min}^2}{\\sigma_k^2} \\right)\n$$\n这个概率由 $\\chi'^2(2, \\lambda_k)$ 分布在点 $d_{\\min}^2 / \\sigma_k^2$ 处的累积分布函数（CDF）给出。设 $F_{\\chi'^2(df, \\lambda)}$ 表示此CDF。那么每步的违规概率 $P_k^{\\text{viol}}$ 是：\n$$\nP_k^{\\text{viol}} = F_{\\chi'^2(2, \\lambda_k)} \\left( \\frac{d_{\\min}^2}{\\sigma_k^2} \\right)\n$$\n这可以使用科学计算库中用于非中心卡方CDF的函数进行数值计算，对 $k \\in \\{1, \\dots, N\\}$ 有效。对于 $k=0$，$\\sigma_0^2 = 0$ 且位置是确定性的。问题要求在 $k \\in \\{1, ..., N\\}$ 上进行评估，因此这不是问题。\n\n**4. 总违规概率的联合界**\n\n总体安全规范要求在从 $k=1$ 到 $N$ 的任何时间步都不发生违规。至少发生一次违规的事件是每步违规事件的并集：$V = \\bigcup_{k=1}^N V_k$，其中 $V_k$ 是事件 $r_k  d_{\\min}$。使用布尔不等式（联合界），我们可以为这个并集事件的概率设定一个上界：\n$$\nP(V) = P \\left( \\bigcup_{k=1}^N V_k \\right) \\le \\sum_{k=1}^N P(V_k) = \\sum_{k=1}^N P_k^{\\text{viol}}\n$$\n这个和为在时间范围 $N$ 内的总失败概率提供了一个上界。由于概率不能超过 $1$，我们将结果截断：\n$$\nP_{\\text{bound}} = \\min \\left( 1.0, \\sum_{k=1}^N P_k^{\\text{viol}} \\right)\n$$\n\n**5. 最优增益选择与风险验证**\n\n对提供的有限集中的每个候选控制增益 $k_v$ 重复整个过程（步骤1-4）。这将产生一组联合界 $\\{P_{\\text{bound}}(k_v)\\}$。然后通过在该集合上取最小值来找到最小联合界违规概率：\n$$\nP_{\\min} = \\min_{k_v} \\{ P_{\\text{bound}}(k_v) \\}\n$$\n最后，我们必须检查是否有任何控制增益可以满足给定的风险预算 $\\varepsilon$。这等价于检查最小界是否满足预算：\n$$\n\\text{Risk Satisfied} = (P_{\\min} \\le \\varepsilon)\n$$\n每个测试用例的最终结果是序对 $[P_{\\min}, \\text{Risk Satisfied}]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import ncx2\n\ndef solve():\n    \"\"\"\n    Solves the stochastic safety verification problem for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"params\": {\n                \"dt\": 0.1, \"N\": 30, \"d_min\": 2.0, \"sigma_p\": 0.02,\n                \"p0\": (5.0, 0.0), \"v0\": (-0.5, 0.0),\n                \"kv_candidates\": [0.0, 1.0, 2.0, 4.0],\n                \"epsilon\": 0.05\n            }\n        },\n        {\n            \"case_id\": 2,\n            \"params\": {\n                \"dt\": 0.1, \"N\": 50, \"d_min\": 1.5, \"sigma_p\": 0.05,\n                \"p0\": (2.0, 0.0), \"v0\": (-0.3, 0.0),\n                \"kv_candidates\": [0.0, 0.5, 1.0, 2.0],\n                \"epsilon\": 0.1\n            }\n        },\n        {\n            \"case_id\": 3,\n            \"params\": {\n                \"dt\": 0.2, \"N\": 100, \"d_min\": 1.0, \"sigma_p\": 0.1,\n                \"p0\": (1.5, 0.0), \"v0\": (-0.2, 0.0),\n                \"kv_candidates\": [0.0, 0.5, 1.0],\n                \"epsilon\": 0.05\n            }\n        }\n    ]\n\n    results = []\n    \n    for case_data in test_cases:\n        params = case_data[\"params\"]\n        dt = params[\"dt\"]\n        N = params[\"N\"]\n        d_min = params[\"d_min\"]\n        sigma_p = params[\"sigma_p\"]\n        p0 = np.array(params[\"p0\"])\n        v0 = np.array(params[\"v0\"])\n        kv_candidates = params[\"kv_candidates\"]\n        epsilon = params[\"epsilon\"]\n        \n        all_union_bounds = []\n\n        for kv in kv_candidates:\n            sum_of_probs = 0.0\n            \n            # Create an array of time indices k from 1 to N\n            k_steps = np.arange(1, N + 1)\n            \n            # Step 1: Compute the mean trajectory mu_k for all k\n            if kv == 0.0:\n                # Vectorized calculation for kv=0\n                mu_p = p0 + v0 * k_steps[:, np.newaxis] * dt\n            else:\n                # Vectorized calculation for kv > 0\n                alpha = 1.0 - dt * kv\n                # Using np.power avoids potential issues with large k\n                geom_sum_factor = (1.0 - np.power(alpha, k_steps)) / kv\n                mu_p = p0 + v0 * geom_sum_factor[:, np.newaxis]\n            \n            # Step 2: Compute position variance sigma_k^2\n            sigma_k_sq = k_steps * (sigma_p**2)\n\n            # Step 3: Compute per-step violation probabilities\n            # Non-centrality parameter lambda_k\n            mu_p_sq_norm = np.sum(mu_p**2, axis=1)\n            # Handle potential division by zero if sigma_k_sq is somehow zero, although logic prevents this for k > 0\n            lambda_k = np.divide(mu_p_sq_norm, sigma_k_sq, out=np.zeros_like(mu_p_sq_norm), where=sigma_k_sq!=0)\n            \n            # Argument for the CDF\n            d_min_sq = d_min**2\n            x_arg = np.divide(d_min_sq, sigma_k_sq, out=np.full_like(sigma_k_sq, np.inf), where=sigma_k_sq!=0)\n            \n            # The CDF of the non-central chi-squared distribution\n            # with df=2 degrees of freedom\n            p_k_violations = ncx2.cdf(x=x_arg, df=2, nc=lambda_k)\n            \n            sum_of_probs = np.sum(p_k_violations)\n\n            # Step 4: Compute the Union Bound for the current kv\n            union_bound = min(1.0, sum_of_probs)\n            all_union_bounds.append(union_bound)\n\n        # Step 5: Find the minimum bound and check against the risk budget\n        min_union_bound = min(all_union_bounds)\n        satisfies_risk = min_union_bound = epsilon\n        \n        # Format the result string as '[value,bool]'\n        result_str = f\"[{min_union_bound:.6f},{satisfies_risk}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}