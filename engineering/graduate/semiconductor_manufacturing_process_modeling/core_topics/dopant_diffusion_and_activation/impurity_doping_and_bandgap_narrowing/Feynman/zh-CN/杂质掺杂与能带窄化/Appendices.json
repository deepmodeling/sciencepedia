{
    "hands_on_practices": [
        {
            "introduction": "此练习将指导您通过第一性原理推导，来理解带隙变窄如何直接影响 p-n 结的内建电势。通过从平衡状态下费米能级恒定的基本要求出发，您将揭示微观能量偏移与宏观电学参数之间的清晰直接关系。这项练习对于建立带隙变窄对器件行为影响的物理直觉至关重要 。",
            "id": "4132013",
            "problem": "一个处于平衡状态、温度为 $T = 300\\,\\text{K}$ 的突变一维长p-n结由均匀掺杂的区域构成，其p区的受主浓度为 $N_A = 10^{19}\\,\\text{cm}^{-3}$，n区的施主浓度为 $N_D = 10^{19}\\,\\text{cm}^{-3}$。假设掺杂剂完全电离，两侧的材料参数在空间上均匀，且结足够长，以至于在远离冶金结处存在定义明确的准中性区。在重掺杂条件下，会发生带隙变窄（BGN），并使两侧的带隙对称地减小 $\\Delta E_g = 120\\,\\text{meV}$；为了本次计算，忽略任何由BGN引起的有效态密度的变化，并假设载流子统计为非简并（麦克斯韦-玻尔兹曼）统计。\n\n从以下基本要素出发：\n- 平衡状态要求整个结的费米能级恒定。\n- 在非简并极限下，电子和空穴浓度满足 $np = n_i^2$，其中 $n_i$ 是没有带隙变窄时硅的本征载流子浓度，且 $n_i^2 = N_C N_V \\exp\\!\\left(-E_g/(k_B T)\\right)$。\n- 内建静电势 $V_{bi}$ 等于在平衡状态下为对齐p-n结两侧费米能级所需的静电势差。\n\n基于这些基础，推导内建电势 $V_{bi}$ 的表达式，该表达式用 $N_A$、$N_D$、$n_i$ 和带隙变窄量 $\\Delta E_g$ 表示，将BGN处理为带隙从 $E_g$ 减小到 $E_g - \\Delta E_g$，并因此对每侧的有效本征浓度进行相应修正。然后，将您的表达式应用于给定值 $N_A = N_D = 10^{19}\\,\\text{cm}^{-3}$ 和 $\\Delta E_g = 120\\,\\text{meV}$，并确定差值\n$$\\delta \\equiv V_{bi}^{(\\text{BGN})} - V_{bi}^{(0)},$$\n其中 $V_{bi}^{(\\text{BGN})}$ 是包含带隙变窄的内建电势，而 $V_{bi}^{(0)}$ 是不考虑带隙变窄计算出的内建电势。\n\n以伏特为单位表示 $\\delta$ 的最终答案，并四舍五入到四位有效数字。不要使用百分号；本问题不涉及角度单位。",
            "solution": "问题要求推导在导致带隙变窄（BGN）的重掺杂条件下p-n结的内建电势 $V_{bi}$ 的表达式，然后计算由于BGN引起的该电势的变化。推导必须基于所提供的基本原理。\n\n设 $e$ 为元电荷，$k_B$ 为玻尔兹曼常数，$T$ 为绝对温度。热电压定义为 $V_T = \\frac{k_B T}{e}$。\n\n首先，我们建立没有带隙变窄的理想情况下的内建电势，记为 $V_{bi}^{(0)}$。在热平衡状态下，费米能级 $E_F$ 在整个结上是恒定的。根据问题陈述，内建电势 $V_{bi}^{(0)}$ 是对齐费米能级所需的静电势差。\n在准中性p区，假设完全电离，空穴浓度为 $p_p \\approx N_A$。少数载流子电子浓度由质量作用定律 $np = n_i^2$ 给出，因此 $n_p = \\frac{n_i^2}{p_p} \\approx \\frac{n_i^2}{N_A}$。\n类似地，在准中性n区，电子浓度为 $n_n \\approx N_D$，少数载流子空穴浓度为 $p_n = \\frac{n_i^2}{n_n} \\approx \\frac{n_i^2}{N_D}$。\n\n中性p区和n区中的电子浓度通过内建势垒相关联：\n$$ n_p = n_n \\exp\\left(-\\frac{eV_{bi}^{(0)}}{k_B T}\\right) $$\n将用掺杂浓度表示的 $n_p$ 和 $n_n$ 的表达式代入，得到：\n$$ \\frac{n_i^2}{N_A} \\approx N_D \\exp\\left(-\\frac{eV_{bi}^{(0)}}{k_B T}\\right) $$\n重新整理以求解 $V_{bi}^{(0)}$：\n$$ \\exp\\left(\\frac{eV_{bi}^{(0)}}{k_B T}\\right) = \\frac{N_A N_D}{n_i^2} $$\n$$ V_{bi}^{(0)} = \\frac{k_B T}{e} \\ln\\left(\\frac{N_A N_D}{n_i^2}\\right) $$\n\n接下来，我们引入带隙变窄效应。BGN使带隙减小 $\\Delta E_g$，从 $E_g$ 变为 $E_{g, \\text{eff}} = E_g - \\Delta E_g$。题目指示将其视为对有效本征载流子浓度的修正。本征载流子浓度的平方由 $n_i^2 = N_C N_V \\exp(-E_g / (k_B T))$ 给出。在有BGN的情况下，使用一个新的有效本征乘积 $n_{ie}^2$，其中 $E_g$ 被 $E_{g, \\text{eff}}$ 替换，并假设有效态密度 $N_C$ 和 $N_V$ 不变。\n$$ n_{ie}^2 = N_C N_V \\exp\\left(-\\frac{E_{g, \\text{eff}}}{k_B T}\\right) = N_C N_V \\exp\\left(-\\frac{E_g - \\Delta E_g}{k_B T}\\right) $$\n$$ n_{ie}^2 = \\left(N_C N_V \\exp\\left(-\\frac{E_g}{k_B T}\\right)\\right) \\exp\\left(\\frac{\\Delta E_g}{k_B T}\\right) = n_i^2 \\exp\\left(\\frac{\\Delta E_g}{k_B T}\\right) $$\n这个新的乘积 $n_{ie}^2$ 主导了重掺杂区的载流子统计。BGN发生在结的两侧，因此这个修正后的质量作用定律 $np = n_{ie}^2$ 在整个区域都适用。\n\n我们现在使用相同的基本逻辑推导带有BGN的内建电势 $V_{bi}^{(\\text{BGN})}$。此时少数载流子浓度变为：\n$n_p = \\frac{n_{ie}^2}{p_p} \\approx \\frac{n_{ie}^2}{N_A}$\n$p_n = \\frac{n_{ie}^2}{n_n} \\approx \\frac{n_{ie}^2}{N_D}$\n\n关系式 $n_p = n_n \\exp(-eV_{bi}^{(\\text{BGN})}/(k_B T))$ 仍然有效。代入新的表达式：\n$$ \\frac{n_{ie}^2}{N_A} = N_D \\exp\\left(-\\frac{eV_{bi}^{(\\text{BGN})}}{k_B T}\\right) $$\n求解 $V_{bi}^{(\\text{BGN})}$：\n$$ V_{bi}^{(\\text{BGN})} = \\frac{k_B T}{e} \\ln\\left(\\frac{N_A N_D}{n_{ie}^2}\\right) $$\n这是根据给定原理推导出的带隙变窄条件下的内建电势的通用表达式。\n\n为了求出差值 $\\delta = V_{bi}^{(\\text{BGN})} - V_{bi}^{(0)}$，我们将推导出的 $n_{ie}^2$ 表达式代入 $V_{bi}^{(\\text{BGN})}$ 的方程中：\n$$ V_{bi}^{(\\text{BGN})} = \\frac{k_B T}{e} \\ln\\left(\\frac{N_A N_D}{n_i^2 \\exp(\\Delta E_g / (k_B T))}\\right) $$\n使用对数性质 $\\ln(a/b) = \\ln(a) - \\ln(b)$：\n$$ V_{bi}^{(\\text{BGN})} = \\frac{k_B T}{e} \\left[ \\ln\\left(\\frac{N_A N_D}{n_i^2}\\right) - \\ln\\left(\\exp\\left(\\frac{\\Delta E_g}{k_B T}\\right)\\right) \\right] $$\n$$ V_{bi}^{(\\text{BGN})} = \\frac{k_B T}{e} \\ln\\left(\\frac{N_A N_D}{n_i^2}\\right) - \\frac{k_B T}{e} \\left(\\frac{\\Delta E_g}{k_B T}\\right) $$\n认识到第一项是 $V_{bi}^{(0)}$：\n$$ V_{bi}^{(\\text{BGN})} = V_{bi}^{(0)} - \\frac{\\Delta E_g}{e} $$\n因此，差值 $\\delta$ 为：\n$$ \\delta = V_{bi}^{(\\text{BGN})} - V_{bi}^{(0)} = \\left(V_{bi}^{(0)} - \\frac{\\Delta E_g}{e}\\right) - V_{bi}^{(0)} = -\\frac{\\Delta E_g}{e} $$\n计算差值 $\\delta$ 时，不需要具体的掺杂浓度 $N_A = 10^{19}\\,\\text{cm}^{-3}$ 和 $N_D = 10^{19}\\,\\text{cm}^{-3}$。\n\n给定 $\\Delta E_g = 120\\,\\text{meV}$。代入此值：\n$$ \\delta = -\\frac{120\\,\\text{meV}}{e} = -\\frac{120 \\times 10^{-3}\\,\\text{eV}}{e} $$\n根据定义，$1\\,\\text{eV}$ 等于元电荷 $e$ 乘以一伏特 ($1\\,\\text{V}$) 的能量。因此，$\\frac{1\\,\\text{eV}}{e} = 1\\,\\text{V}$。\n$$ \\delta = -120 \\times 10^{-3}\\,\\text{V} = -0.120\\,\\text{V} $$\n问题要求答案四舍五入到四位有效数字。\n$$ \\delta = -0.1200\\,\\text{V} $$",
            "answer": "$$\\boxed{-0.1200}$$"
        },
        {
            "introduction": "从解析推导转向计算实践，本练习要求您构建一个综合的数值模型，以确定重掺杂硅中的费米能级。您将整合多种物理效应，包括掺杂剂激活/失活动力学、与温度相关的参数以及费米-狄拉克统计，来求解电荷中性方程。此任务  提供了实施现代 TCAD 器件模拟器核心物理机制的动手经验。",
            "id": "4121902",
            "problem": "您必须编写一个完整、可运行的程序，为每个提供的测试用例，通过求解包括带隙变窄（BGN）效应在内的电荷中性条件，计算重掺杂硅中的费米能级位置，其中激活的掺杂剂浓度由掺杂剂的激活和失活动力学决定。从半导体统计学和反应动力学的第一性原理出发。在不使用简化公式的情况下，从以下基础推导相关关系式：态密度（DOS）的抛物线能带近似、费米-狄拉克分布、通过对态密度积分来定义载流子浓度的细致平衡、电荷中性以及用于掺杂剂激活和失活的一阶可逆反应动力学。程序必须数值求解费米能级的隐式电荷中性方程，并报告其相对于两个能带边缘的位置。\n\n使用硅，其随温度变化的带隙由 Varshni 关系建模。设本征带隙由 Varshni 参数给出：$E_{g,0} = 1.17\\ \\mathrm{eV}$，$\\alpha = 4.73\\times 10^{-4}\\ \\mathrm{eV}\\,\\mathrm{K}^{-1}$，以及 $\\beta = 636\\ \\mathrm{K}$。在温度 $T$ 下的带隙为 $E_{g}(T) = E_{g,0} - \\alpha \\dfrac{T^{2}}{T + \\beta}$。使用在温度 $T$ 下的有效态密度，定义为 $N_{C}(T) = N_{C,300}\\left(\\dfrac{T}{300\\ \\mathrm{K}}\\right)^{3/2}$ 和 $N_{V}(T) = N_{V,300}\\left(\\dfrac{T}{300\\ \\mathrm{K}}\\right)^{3/2}$，其中 $N_{C,300} = 2.8\\times 10^{19}\\ \\mathrm{cm}^{-3}$ 和 $N_{V,300} = 1.04\\times 10^{19}\\ \\mathrm{cm}^{-3}$。使用费米-狄拉克统计处理载流子，通过对态密度和费米-狄拉克占据数的乘积进行能量积分来获得电子和空穴浓度。不要假设使用麦克斯韦-玻尔兹曼近似。将带隙变窄（BGN）建模为导带和价带边缘的对称移动，总变窄量 $\\Delta E_{g}(N_{\\mathrm{act}})$ 取决于激活的掺杂剂浓度 $N_{\\mathrm{act}}$：设 $\\Delta E_{g}(N_{\\mathrm{act}}) = \\begin{cases}\\alpha_{\\mathrm{BGN}}\\ln\\left(\\dfrac{N_{\\mathrm{act}}}{N_{\\mathrm{ref}}}\\right),  N_{\\mathrm{act}} > N_{\\mathrm{ref}} \\\\ 0,  N_{\\mathrm{act}} \\le N_{\\mathrm{ref}}\\end{cases}$，其中 $\\alpha_{\\mathrm{BGN}} = 1.74\\times 10^{-2}\\ \\mathrm{eV}$ 和 $N_{\\mathrm{ref}} = 1.0\\times 10^{17}\\ \\mathrm{cm}^{-3}$。将 $\\Delta E_{g}$ 平均分配：导带边缘向下移动 $\\dfrac{\\Delta E_{g}}{2}$，价带边缘向上移动 $\\dfrac{\\Delta E_{g}}{2}$。\n\n对于掺杂剂的激活和失活动力学，假设在非激活掺杂剂和激活掺杂剂之间存在单一的可逆一级反应。设总掺杂剂浓度为 $N_{\\mathrm{tot}}$，激活的掺杂剂浓度 $N_{\\mathrm{act}}(t)$ 遵循 $\\dfrac{d N_{\\mathrm{act}}}{dt} = k_{\\mathrm{act}}\\left(N_{\\mathrm{tot}} - N_{\\mathrm{act}}\\right) - k_{\\mathrm{deact}} N_{\\mathrm{act}}$，且 $N_{\\mathrm{act}}(0) = 0$。解析地表示 $N_{\\mathrm{act}}(t)$，并在电荷中性条件中使用它。考虑具有单能级施主和受主的掺杂剂的不完全电离。对于施主，施主能级为 $E_{D} = E_{C} - \\Delta E_{D}$，电离施主浓度为 $N_{D}^{+} = \\dfrac{N_{D,\\mathrm{act}}}{1 + g_{D}\\exp\\left(\\dfrac{E_{F} - E_{D}}{k_{B}T}\\right)}$。对于受主，受主能级为 $E_{A} = E_{V} + \\Delta E_{A}$，电离受主浓度为 $N_{A}^{-} = \\dfrac{N_{A,\\mathrm{act}}}{1 + g_{A}\\exp\\left(\\dfrac{E_{A} - E_{F}}{k_{B}T}\\right)}$。使用玻尔兹曼常数 $k_{B} = 8.617333262145\\times 10^{-5}\\ \\mathrm{eV}\\,\\mathrm{K}^{-1}$，施主简并因子 $g_{D} = 2$，受主简并因子 $g_{A} = 4$，施主结合偏置 $\\Delta E_{D} = 0.045\\ \\mathrm{eV}$，以及受主结合偏置 $\\Delta E_{A} = 0.057\\ \\mathrm{eV}$。\n\n通过1/2阶费米-狄拉克积分定义电子和空穴。对于电子：$n = N_{C}(T)\\,F_{1/2}\\!\\left(\\eta_{n}\\right)$，其中 $\\eta_{n} = \\dfrac{E_{F} - E_{C}}{k_{B}T}$。对于空穴：$p = N_{V}(T)\\,F_{1/2}\\!\\left(\\eta_{p}\\right)$，其中 $\\eta_{p} = \\dfrac{E_{V} - E_{F}}{k_{B}T}$。此处 $F_{1/2}(\\eta) = \\dfrac{2}{\\sqrt{\\pi}}\\int_{0}^{\\infty}\\dfrac{\\sqrt{\\epsilon}}{1 + \\exp(\\epsilon - \\eta)}\\,d\\epsilon$。\n\n施加电荷中性条件：$n - p + N_{A}^{-} - N_{D}^{+} = 0$。为每个测试用例数值求解 $E_{F}$。以浮点数形式报告 $E_{F} - E_{C}$ 和 $E_{V} - E_{F}$ 的值，单位均为 $\\mathrm{eV}$。\n\n所有能量以 $\\mathrm{eV}$ 表示，所有浓度以 $\\mathrm{cm}^{-3}$ 表示，所有温度以 $\\mathrm{K}$ 表示，速率常数以 $\\mathrm{s}^{-1}$ 表示，时间以 $\\mathrm{s}$ 表示。要求的最终输出为单行，包含一个方括号括起的逗号分隔列表，其中每个元素对应一个测试用例，并且本身是一个双元素列表：$[E_{F} - E_{C}, E_{V} - E_{F}]$。例如，输出格式必须类似于 $[[x_1,y_1],[x_2,y_2],\\dots]$，其中包含数值。\n\n测试套件：\n- 案例1（中等n型，接近室温，BGN可忽略）：$T = 300\\ \\mathrm{K}$，仅有施主，其 $N_{\\mathrm{D,tot}} = 1.0\\times 10^{17}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 1.0\\times 10^{2}\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，退火时间 $t = 60\\ \\mathrm{s}$，无受主 $N_{\\mathrm{A,tot}} = 0$。\n- 案例2（重n型，BGN显著）：$T = 300\\ \\mathrm{K}$，仅有施主，其 $N_{\\mathrm{D,tot}} = 1.0\\times 10^{20}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 1.0\\times 10^{1}\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，$t = 120\\ \\mathrm{s}$，无受主 $N_{\\mathrm{A,tot}} = 0$。\n- 案例3（重p型，BGN显著）：$T = 300\\ \\mathrm{K}$，仅有受主，其 $N_{\\mathrm{A,tot}} = 5.0\\times 10^{19}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 5.0\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 5.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，$t = 180\\ \\mathrm{s}$，无施主 $N_{\\mathrm{D,tot}} = 0$。\n- 案例4（低n型，边界接近本征）：$T = 300\\ \\mathrm{K}$，仅有施主，其 $N_{\\mathrm{D,tot}} = 1.0\\times 10^{14}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 1.0\\times 10^{2}\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，$t = 10\\ \\mathrm{s}$，无受主 $N_{\\mathrm{A,tot}} = 0$。\n\n您的程序必须生成单行，其中包含四个案例的数值浮点数（单位为 $\\mathrm{eV}$），格式为 $[[E_{F} - E_{C},E_{V} - E_{F}]_{1},[E_{F} - E_{C},E_{V} - E_{F}]_{2},[E_{F} - E_{C},E_{V} - E_{F}]_{3},[E_{F} - E_{C},E_{V} - E_{F}]_{4}]$，并严格按照上面列出的顺序。",
            "solution": "经评估，此问题有效。这是一个在半导体物理学中适定的、有科学依据的问题，它自洽且无矛盾。解决方案要求在各种掺杂和退火条件下，通过考虑多种物理效应，数值计算硅中的费米能级。\n\n在此，我们按规定从第一性原理推导求解方法。问题的核心是求解费米能级 $E_F$ 的电荷中性方程。该方程表明总正电荷密度必须等于总负电荷密度。在同时掺杂有施主和受主的半导体中，这表示为：\n$$ p + N_{D}^{+} = n + N_{A}^{-} $$\n或者，重排为求根形式 $Q(E_F) = 0$，其中净电荷密度函数 $Q(E_F)$ 是：\n$$ Q(E_F) = n - p + N_{A}^{-} - N_{D}^{+} = 0 $$\n此方程中的各项取决于费米能级 $E_F$ 以及各种材料和环境参数。我们将根据所提供的物理模型构建每一项。\n\n### 1. 掺杂剂激活力学\n电激活掺杂剂的浓度 $N_{\\mathrm{act}}$ 不等于总掺杂剂浓度 $N_{\\mathrm{tot}}$。它由一级可逆反应控制。激活掺杂剂浓度的变化率由下式给出：\n$$ \\frac{d N_{\\mathrm{act}}}{dt} = k_{\\mathrm{act}}(N_{\\mathrm{tot}} - N_{\\mathrm{act}}) - k_{\\mathrm{deact}} N_{\\mathrm{act}} $$\n这是一个线性一阶常微分方程。整理后得到：\n$$ \\frac{d N_{\\mathrm{act}}}{dt} + (k_{\\mathrm{act}} + k_{\\mathrm{deact}}) N_{\\mathrm{act}} = k_{\\mathrm{act}} N_{\\mathrm{tot}} $$\n稳态解（$t \\to \\infty$, $\\frac{d N_{\\mathrm{act}}}{dt} = 0$）可求得为：\n$$ N_{\\mathrm{act,ss}} = N_{\\mathrm{tot}} \\frac{k_{\\mathrm{act}}}{k_{\\mathrm{act}} + k_{\\mathrm{deact}}} $$\n满足初始条件 $N_{\\mathrm{act}}(0) = 0$ 的常微分方程的通解是：\n$$ N_{\\mathrm{act}}(t) = N_{\\mathrm{act,ss}} \\left(1 - e^{-(k_{\\mathrm{act}} + k_{\\mathrm{deact}})t}\\right) $$\n对于每个测试用例，给定退火时间 $t$ 和各自的速率常数，该表达式用于计算激活的施主浓度（从 $N_{D,\\mathrm{tot}}$ 计算 $N_{D,\\mathrm{act}}$）和激活的受主浓度（从 $N_{A,\\mathrm{tot}}$ 计算 $N_{A,\\mathrm{act}}$）。\n\n### 2. 物理参数和带隙效应\n硅的材料属性取决于温度（$T$）和掺杂水平。\n本征带隙 $E_g$ 是温度的函数，由 Varshni 关系建模：\n$$ E_{g}(T) = E_{g,0} - \\alpha \\frac{T^2}{T + \\beta} $$\n导带的有效态密度 $N_C$ 和价带的有效态密度 $N_V$ 随温度的变化如下：\n$$ N_{C}(T) = N_{C,300}\\left(\\frac{T}{300\\ \\mathrm{K}}\\right)^{3/2} \\quad \\text{和} \\quad N_{V}(T) = N_{V,300}\\left(\\frac{T}{300\\ \\mathrm{K}}\\right)^{3/2} $$\n在高掺杂浓度下，载流子与电离掺杂剂之间的相互作用导致带隙变窄（BGN），即 $\\Delta E_g$。这被建模为总激活掺杂剂浓度 $N_{\\mathrm{act}} = N_{D,\\mathrm{act}} + N_{A,\\mathrm{act}}$ 的函数：\n$$ \\Delta E_{g}(N_{\\mathrm{act}}) = \\begin{cases}\\alpha_{\\mathrm{BGN}}\\ln\\left(\\frac{N_{\\mathrm{act}}}{N_{\\mathrm{ref}}}\\right),  N_{\\mathrm{act}} > N_{\\mathrm{ref}} \\\\ 0,  N_{\\mathrm{act}} \\le N_{\\mathrm{ref}}\\end{cases} $$\n这种变窄被对称地应用于能带边缘。设 $E_{C,0}$ 和 $E_{V,0}$ 是未受扰动的能带边缘，其中 $E_{C,0} - E_{V,0} = E_g(T)$。新的、变窄的能带边缘是：\n$$ E_C = E_{C,0} - \\frac{\\Delta E_g}{2} \\quad \\text{和} \\quad E_V = E_{V,0} + \\frac{\\Delta E_g}{2} $$\n掺杂剂能级与这些能带边缘相关联：\n$$ E_D = E_C - \\Delta E_D \\quad \\text{和} \\quad E_A = E_V + \\Delta E_A $$\n\n### 3. 载流子和电离掺杂剂浓度\n所有载流子的浓度都是费米能级 $E_F$ 的函数。我们必须按规定使用费米-狄拉克统计。\n\n**电子和空穴浓度：**\n导带中的电子浓度（$n$）和价带中的空穴浓度（$p$）通过将态密度（DOS）乘以费米-狄拉克分布函数对所有可用能态进行积分得到。该积分得到标准表达式：\n$$ n = N_C(T) F_{1/2}\\left(\\frac{E_F - E_C}{k_B T}\\right) = N_C(T) F_{1/2}(\\eta_n) $$\n$$ p = N_V(T) F_{1/2}\\left(\\frac{E_V - E_F}{k_B T}\\right) = N_V(T) F_{1/2}(\\eta_p) $$\n其中 $k_B$ 是玻尔兹曼常数，$F_{1/2}(\\eta)$ 是1/2阶费米-狄拉克积分，必须进行数值计算：\n$$ F_{1/2}(\\eta) = \\frac{2}{\\sqrt{\\pi}}\\int_{0}^{\\infty}\\frac{\\sqrt{\\epsilon}}{1 + \\exp(\\epsilon - \\eta)}\\,d\\epsilon $$\n\n**电离掺杂剂浓度：**\n掺杂剂并非完全电离，尤其是在高浓度或低温下。电离概率取决于费米能级。\n电离施主（$N_D^+$）和受主（$N_A^-$）的浓度由下式给出：\n$$ N_{D}^{+} = \\frac{N_{D,\\mathrm{act}}}{1 + g_{D}\\exp\\left(\\frac{E_{F} - E_{D}}{k_{B}T}\\right)} $$\n$$ N_{A}^{-} = \\frac{N_{A,\\mathrm{act}}}{1 + g_{A}\\exp\\left(\\frac{E_{A} - E_{F}}{k_{B}T}\\right)} $$\n其中 $g_D$ 和 $g_A$ 分别是施主和受主能级的基态简并因子。\n\n### 4. 数值解法\n将 $n$、$p$、$N_A^-$ 和 $N_D^+$ 的表达式代入电荷中性方程 $Q(E_F) = 0$，我们得到了一个关于未知数 $E_F$ 的单一、非线性、超越方程。$Q(E_F)$ 函数是单调的，当 $E_F \\ll E_V$ 时为一个大的负值，随 $E_F$ 增加而增加，当 $E_F \\gg E_C$ 时为一个大的正值。这保证了 $E_F$ 有唯一解。\n对于每个测试用例，使用稳健的求根算法（如 Brent-Dekker 方法 (`brentq`)）在给定区间内高效地找到根，从而数值求解该方程。可以为 $E_F$ 建立一个合适的求解区间，例如，从低于 $E_V$ 几个 $k_B T$ 到高于 $E_C$ 几个 $k_B T$。\n\n对于每个测试用例，步骤如下：\n1.  根据动力学模型计算 $N_{D,\\mathrm{act}}$ 和 $N_{A,\\mathrm{act}}$。\n2.  确定 $E_g(T)$、$N_C(T)$ 和 $N_V(T)$。\n3.  计算 $\\Delta E_g$ 及由此产生的移动后的能带边缘 $E_C$ 和 $E_V$。\n4.  构建电荷中性函数 $Q(E_F)$。\n5.  数值求解 $Q(E_F) = 0$ 以找到 $E_F$。\n6.  报告最终结果 $E_F - E_C$ 和 $E_V - E_F$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.optimize import brentq\nimport math\n\ndef solve():\n    \"\"\"\n    Computes the Fermi level position in heavily doped silicon by solving the\n    charge neutrality condition, including effects of dopant activation kinetics and\n    bandgap narrowing.\n    \"\"\"\n    # Define physical and material constants from the problem statement\n    k_B = 8.617333262145e-5  # Boltzmann constant in eV/K\n    Eg0_Si = 1.17           # Si bandgap at 0K in eV\n    alpha_varshni = 4.73e-4 # Varshni parameter alpha in eV/K\n    beta_varshni = 636      # Varshni parameter beta in K\n    NC300_Si = 2.8e19       # Conduction band effective DOS at 300K in cm^-3\n    NV300_Si = 1.04e19      # Valence band effective DOS at 300K in cm^-3\n    alpha_bgn = 1.74e-2     # BGN parameter in eV\n    N_ref_bgn = 1.0e17      # BGN reference concentration in cm^-3\n    delta_ED = 0.045        # Donor ionization energy offset from Ec in eV\n    delta_EA = 0.057        # Acceptor ionization energy offset from Ev in eV\n    gD = 2                  # Donor degeneracy factor\n    gA = 4                  # Acceptor degeneracy factor\n\n    # A memoization cache for the Fermi-Dirac integral to speed up calculations\n    _memo_F12 = {}\n\n    def fermi_dirac_integral_half(eta):\n        \"\"\"\n        Computes the Fermi-Dirac integral of order 1/2, F_{1/2}(eta).\n        Uses asymptotic approximations for large |eta| for numerical stability and speed.\n        \"\"\"\n        if eta in _memo_F12:\n            return _memo_F12[eta]\n\n        if eta  50:\n            # Asymptotic expansion for large positive eta (degenerate limit)\n            res = (4 / (3 * np.sqrt(np.pi))) * eta**1.5\n        elif eta  -20:\n            # Boltzmann approximation for large negative eta\n            res = np.exp(eta)\n        else:\n            # Direct numerical integration for intermediate values\n            integrand = lambda E: np.sqrt(E) / (1 + np.exp(E - eta))\n            integral_val, _ = quad(integrand, 0, np.inf)\n            res = (2 / np.sqrt(np.pi)) * integral_val\n        \n        _memo_F12[eta] = res\n        return res\n\n    def solve_case(params):\n        \"\"\"\n        Solves for the Fermi level for a single test case.\n        \"\"\"\n        T, ND_tot, NA_tot, k_act, k_deact, t = params\n        _memo_F12.clear()\n\n        # 1. Dopant Activation Kinetics\n        k_sum = k_act + k_deact\n        \n        ND_act = 0\n        if ND_tot  0 and k_sum  1e-9: # Avoid division by zero if rates are zero\n            ND_act_ss = ND_tot * (k_act / k_sum)\n            ND_act = ND_act_ss * (1 - np.exp(-k_sum * t))\n        \n        NA_act = 0\n        if NA_tot  0 and k_sum  1e-9:\n            NA_act_ss = NA_tot * (k_act / k_sum)\n            NA_act = NA_act_ss * (1 - np.exp(-k_sum * t))\n\n        N_act_total = ND_act + NA_act\n\n        # 2. Temperature-dependent and BGN-dependent parameters\n        kT = k_B * T\n        Eg_T = Eg0_Si - (alpha_varshni * T**2) / (T + beta_varshni)\n        NC_T = NC300_Si * (T / 300)**1.5\n        NV_T = NV300_Si * (T / 300)**1.5\n\n        delta_Eg = 0\n        if N_act_total  N_ref_bgn:\n            delta_Eg = alpha_bgn * np.log(N_act_total / N_ref_bgn)\n        \n        # Set reference energy (EV0 = 0) and find shifted band edges\n        EV0 = 0.0\n        EC0 = Eg_T\n        EV = EV0 + delta_Eg / 2\n        EC = EC0 - delta_Eg / 2\n        \n        # Dopant energy levels\n        ED = EC - delta_ED\n        EA = EV + delta_EA\n\n        # 3. Define the charge neutrality equation Q(EF) = n - p + NA_minus - ND_plus = 0\n        def charge_balance_equation(EF):\n            eta_n = (EF - EC) / kT\n            n = NC_T * fermi_dirac_integral_half(eta_n)\n            \n            eta_p = (EV - EF) / kT\n            p = NV_T * fermi_dirac_integral_half(eta_p)\n            \n            NA_minus = 0\n            if NA_act  0:\n                 NA_minus = NA_act / (1 + gA * np.exp((EA - EF) / kT))\n            \n            ND_plus = 0\n            if ND_act  0:\n                ND_plus = ND_act / (1 + gD * np.exp((EF - ED) / kT))\n                \n            return n - p + NA_minus - ND_plus\n\n        # 4. Numerically solve for the Fermi level EF using a bracketing root-finder\n        search_bracket_low = EV - 20 * kT\n        search_bracket_high = EC + 20 * kT\n        \n        try:\n            EF_solution = brentq(charge_balance_equation, search_bracket_low, search_bracket_high, xtol=1e-15, rtol=1e-15)\n        except ValueError:\n            return [math.nan, math.nan]\n\n        # 5. Calculate final quantities\n        EF_minus_EC = EF_solution - EC\n        EV_minus_EF = EV - EF_solution\n        \n        return [EF_minus_EC, EV_minus_EF]\n\n    test_cases = [\n        # T (K), N_D_tot (cm^-3), N_A_tot (cm^-3), k_act (s^-1), k_deact (s^-1), t (s)\n        (300, 1.0e17, 0, 1.0e2, 1.0e-1, 60),  # Case 1\n        (300, 1.0e20, 0, 1.0e1, 1.0e-1, 120), # Case 2\n        (300, 0, 5.0e19, 5.0, 5.0e-1, 180),   # Case 3\n        (300, 1.0e14, 0, 1.0e2, 1.0e-1, 10),  # Case 4\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(case_params)\n        results.append(result)\n\n    # Format the output exactly as specified: [[x1,y1],[x2,y2],...]\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "物理模型的优劣取决于其参数，而这些参数必须通过与实验数据进行校准来确定。本练习介绍了一个统计框架，用于通过联合拟合光学和电学测量数据来校准带隙变窄模型。您将实施加权最小二乘法优化并进行不确定性量化，从而掌握半导体工艺模型验证和优化的关键技能 。",
            "id": "4132059",
            "problem": "您的任务是，在固定温度下，结合光学和电学数据集，为掺杂半导体中的带隙变窄（BGN）参数构建并实现一个基于原理的统计校准框架。目标是使用加权最小二乘法联合估计一个基于物理的 BGN 模型的参数，并量化估计参数的不确定性。\n\n从以下经过充分检验的定义和事实开始：\n\n- 带隙变窄（BGN）通过有效带隙来建模，其定义为 $E_{g,\\mathrm{eff}}(N) = E_{g,0} - \\Delta E_g(N;\\boldsymbol{\\theta})$，其中 $E_{g,0}$ 是温度 $T$ 下的本征带隙，$N$ 是总电活性杂质浓度，$\\boldsymbol{\\theta}$ 是模型参数。\n- 假设一个参数化的 BGN 模型 $\\Delta E_g(N;\\boldsymbol{\\theta}) = A \\left(\\frac{N}{N_{\\mathrm{ref}}}\\right)^p$，参数为 $\\boldsymbol{\\theta} = (A,p)$，参考浓度为 $N_{\\mathrm{ref}}$，且约束条件为 $A > 0, p > 0$。\n- 在存在 BGN 的情况下，本征载流子浓度在温度 $T$ 下遵循平衡关系 $n_i^2 = N_C N_V \\exp\\left(-\\frac{E_{g,\\mathrm{eff}}}{k_B T}\\right)$，其中 $k_B$ 是玻尔兹曼常数，$N_C, N_V$ 分别是导带和价带的有效态密度。等效地，假设 $n_{i,0}$ 是在相同温度下未掺杂、无 BGN 情况下的本征载流子浓度，我们有 $\\ln n_i = \\ln n_{i,0} + \\frac{\\Delta E_g(N;\\boldsymbol{\\theta})}{2 k_B T}$。\n- 光学测量通过一个测量量 $E_{\\mathrm{opt}}$ 来提供有效带隙的估计，该测量量在给定条件下追踪 $E_{g,\\mathrm{eff}}$。\n- 电学测量在相同温度下提供 $\\ln n_i$ 的估计。\n\n测量模型和统计假设：\n\n- 对于每个光学数据点 $i$，模型为 $E_{\\mathrm{opt},i} = E_{g,\\mathrm{eff}}(N_i) + \\varepsilon_i^E$，其中 $\\varepsilon_i^E \\sim \\mathcal{N}(0,\\sigma_{E,i}^2)$。\n- 对于每个电学数据点 $j$，模型为 $(\\ln n_i)_j = \\ln n_{i,0} + \\frac{\\Delta E_g(N_j;\\boldsymbol{\\theta})}{2 k_B T} + \\varepsilon_j^{\\ln n}$，其中 $\\varepsilon_j^{\\ln n} \\sim \\mathcal{N}(0,\\sigma_{\\ln n,j}^2)$。\n- 假设所有噪声都是独立的且服从高斯分布，其标准差 $\\sigma_{E,i}$ 和 $\\sigma_{\\ln n,j}$ 已知。\n\n您的任务：\n\n1. 建立联合加权最小二乘目标函数，该函数在上述高斯假设下包含光学和电学残差，并对 $A$ 和 $p$ 强制执行正值约束。\n2. 推导关于 $(A,p)$ 的残差向量和解析雅可比矩阵的表达式，适用于高斯-牛顿或莱文伯格-马夸特算法。\n3. 实现一个求解器来估计 $(A,p)$，通过最小化联合加权目标函数，同时遵守简单边界 $A \\in (0,\\infty)$ 和 $p \\in (0,\\infty)$。\n4. 使用解处的线性化近似计算参数协方差矩阵，具体为 $\\mathbf{C}_\\theta \\approx s^2 (\\mathbf{J}^\\top \\mathbf{J})^{-1}$，其中 $\\mathbf{J}$ 是解处的加权雅可比矩阵，$s^2$ 是加权残差方差，估计为 $s^2 = \\frac{\\sum_k r_k^2}{m - n_p}$，其中 $m$ 是观测总数，$n_p$ 是参数数量。\n5. 报告估计的参数及其标准误，其中标准误是 $\\mathbf{C}_\\theta$ 对角线元素的平方根。\n\n整个问题中使用的常数和单位：\n\n- 使用 $E_{g,0} = 1.12\\,\\mathrm{eV}$。\n- 使用 $T = 300\\,\\mathrm{K}$。\n- 使用 $k_B = 8.617\\,333\\,262\\,145 \\times 10^{-5}\\,\\mathrm{eV/K}$。\n- 使用 $N_{\\mathrm{ref}} = 1.0 \\times 10^{17}\\,\\mathrm{cm}^{-3}$。\n- 使用 $\\ln n_{i,0} = \\ln(1.0 \\times 10^{10}\\,\\mathrm{cm}^{-3})$。\n- 所有能量以 $\\mathrm{eV}$ 表示，所有浓度以 $\\mathrm{cm}^{-3}$ 表示，温度以 $\\mathrm{K}$ 表示，$\\ln$ 使用自然对数。\n- 这个问题不涉及角度。\n- 将报告的每个浮点数四舍五入到 $6$ 位小数。\n\n测试套件和数据集（每个测试案例包含一个光学数据集和一个电学数据集，测量不确定度已知）：\n\n- 测试案例 1：\n  - 光学掺杂浓度 $N_{\\mathrm{opt}}$: $[1.0\\times 10^{16},\\,3.0\\times 10^{17},\\,1.0\\times 10^{18},\\,3.0\\times 10^{19}]$。\n  - 光学测量的 $E_{\\mathrm{opt}}$（单位 eV）: $[1.106753173,\\,1.095178020,\\,1.083934412,\\,1.040764180]$。\n  - 光学不确定度 $\\sigma_{E}$（单位 eV）: $[0.003,\\,0.004,\\,0.004,\\,0.008]$。\n  - 电学掺杂浓度 $N_{\\mathrm{elec}}$: $[1.0\\times 10^{17},\\,1.0\\times 10^{18},\\,5.0\\times 10^{19}]$。\n  - 电学测量的 $(\\ln n_i)$: $[23.462249930,\\,23.693750930,\\,25.005013930]$。\n  - 电学不确定度 $\\sigma_{\\ln n}$: $[0.050,\\,0.040,\\,0.080]$。\n- 测试案例 2：\n  - 光学掺杂浓度 $N_{\\mathrm{opt}}$: $[2.0\\times 10^{17},\\,5.0\\times 10^{18},\\,1.0\\times 10^{20}]$。\n  - 光学测量的 $E_{\\mathrm{opt}}$（单位 eV）: $[1.086059000,\\,1.047080000,\\,0.988810000]$。\n  - 光学不确定度 $\\sigma_{E}$（单位 eV）: $[0.003,\\,0.006,\\,0.010]$。\n  - 电学掺杂浓度 $N_{\\mathrm{elec}}$: $[5.0\\times 10^{17},\\,2.0\\times 10^{19},\\,1.0\\times 10^{20}]$。\n  - 电学测量的 $(\\ln n_i)$: $[23.882550000,\\,24.985850930,\\,25.628750930]$。\n  - 电学不确定度 $\\sigma_{\\ln n}$: $[0.060,\\,0.070,\\,0.090]$。\n- 测试案例 3：\n  - 光学掺杂浓度 $N_{\\mathrm{opt}}$: $[5.0\\times 10^{16},\\,1.0\\times 10^{17},\\,2.0\\times 10^{17}]$。\n  - 光学测量的 $E_{\\mathrm{opt}}$（单位 eV）: $[1.106820000,\\,1.105800000,\\,1.100035000]$。\n  - 光学不确定度 $\\sigma_{E}$（单位 eV）: $[0.002,\\,0.002,\\,0.003]$。\n  - 电学掺杂浓度 $N_{\\mathrm{elec}}$: $[8.0\\times 10^{16},\\,1.0\\times 10^{17},\\,3.0\\times 10^{17}]$。\n  - 电学测量的 $(\\ln n_i)$: $[23.267150930,\\,23.335850930,\\,23.418950930]$。\n  - 电学不确定度 $\\sigma_{\\ln n}$: $[0.030,\\,0.030,\\,0.040]$。\n\n算法交付成果：\n\n- 实现对 $A$ 和 $p$ 具有正值边界的联合加权最小二乘估计。\n- 使用解析雅可比矩阵计算指定的参数协方差。\n- 对于每个测试案例，输出列表 $[A_{\\text{hat}},p_{\\text{hat}},\\mathrm{SE}_A,\\mathrm{SE}_p]$，其中 $\\mathrm{SE}$ 表示标准误。报告 $A_{\\text{hat}}$ 和 $\\mathrm{SE}_A$（单位 eV），以及无量纲的 $p_{\\text{hat}}$ 和 $\\mathrm{SE}_p$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含三个测试案例的结果，格式为方括号括起来的列表的逗号分隔列表，每个内部列表按上述顺序包含四个四舍五入到6位小数的浮点数。例如，使用虚构数字的输出将如下所示 $[[0.020000,0.250000,0.001000,0.010000],[\\dots],[\\dots]]$。",
            "solution": "用户提供的问题经评估为**有效**。它在科学上基于半导体物理学，作为一个参数估计任务，其提法是适定的，并且明确了所有必要的数据、常数和目标准则。该任务是构建一个统计框架，用于从光学和电学测量的组合中估计带隙变窄（BGN）模型的参数。\n\n求解过程分为三个主要步骤：统计模型的构建、数值优化所需组件的推导，以及不确定性量化方法的说明。\n\n### 1. 统一统计模型与目标函数\n\n问题要求从两个不同的数据源联合估计参数 $\\boldsymbol{\\theta} = (A, p)$。假设测量噪声是独立的且服从高斯分布，$\\boldsymbol{\\theta}$ 的最大似然估计等价于通过最小化加权残差平方和（即 $\\chi^2$ 统计量）找到的估计。这确立了加权最小二乘法的原理。\n\n设光学测量的总数为 $M_{opt}$，电学测量的总数为 $M_{elec}$。数据点总数为 $m = M_{opt} + M_{elec}$。\n\nBGN 模型由下式给出：\n$$ \\Delta E_g(N;\\boldsymbol{\\theta}) = A \\left(\\frac{N}{N_{\\mathrm{ref}}}\\right)^p $$\n其中 $A$ 和 $p$ 是待估计的参数，$N$ 是杂质浓度，$N_{\\mathrm{ref}}$ 是参考浓度。\n\n对于每次光学测量 $i \\in \\{1, \\dots, M_{opt}\\}$，观测到的有效带隙 $E_{\\mathrm{opt},i}$ 的模型为：\n$$ E_{\\mathrm{opt},i} = E_{g,\\mathrm{eff}}(N_i) + \\varepsilon_i^E = E_{g,0} - \\Delta E_g(N_i;\\boldsymbol{\\theta}) + \\varepsilon_i^E $$\n其中 $E_{g,0}$ 是本征带隙，噪声项 $\\varepsilon_i^E$ 是一个来自正态分布 $\\mathcal{N}(0, \\sigma_{E,i}^2)$ 的随机变量。相应的加权残差为：\n$$ R_{E,i}(\\boldsymbol{\\theta}) = \\frac{ E_{\\mathrm{opt},i} - (E_{g,0} - \\Delta E_g(N_i;\\boldsymbol{\\theta})) }{\\sigma_{E,i}} = \\frac{ E_{\\mathrm{opt},i} - E_{g,0} + A(N_i/N_{\\mathrm{ref}})^p }{\\sigma_{E,i}} $$\n\n对于每次电学测量 $j \\in \\{1, \\dots, M_{elec}\\}$，观测到的本征载流子浓度的对数 $(\\ln n_i)_j$ 的模型为：\n$$ (\\ln n_i)_j = \\ln n_{i,0} + \\frac{\\Delta E_g(N_j;\\boldsymbol{\\theta})}{2 k_B T} + \\varepsilon_j^{\\ln n} $$\n其中 $\\ln n_{i,0}$ 是本征值，$k_B$ 是玻尔兹曼常数，$T$ 是温度，噪声 $\\varepsilon_j^{\\ln n} \\sim \\mathcal{N}(0, \\sigma_{\\ln n,j}^2)$。相应的加权残差为：\n$$ R_{\\ln n, j}(\\boldsymbol{\\theta}) = \\frac{ (\\ln n_i)_j - \\left(\\ln n_{i,0} + \\frac{\\Delta E_g(N_j;\\boldsymbol{\\theta})}{2 k_B T}\\right) }{\\sigma_{\\ln n,j}} = \\frac{ (\\ln n_i)_j - \\ln n_{i,0} - \\frac{A(N_j/N_{\\mathrm{ref}})^p}{2 k_B T} }{\\sigma_{\\ln n,j}} $$\n\n需要最小化的联合目标函数是所有这些加权残差的平方和：\n$$ \\chi^2(\\boldsymbol{\\theta}) = \\sum_{i=1}^{M_{opt}} \\left( R_{E,i}(\\boldsymbol{\\theta}) \\right)^2 + \\sum_{j=1}^{M_{elec}} \\left( R_{\\ln n,j}(\\boldsymbol{\\theta}) \\right)^2 $$\n该最小化过程受物理约束条件 $A > 0$ 和 $p > 0$ 的限制。\n\n### 2. 数值优化：残差向量和雅可比矩阵\n\n模型在参数 $p$ 上是非线性的，因此需要使用迭代优化算法，如高斯-牛顿法或莱文伯格-马夸特法。这些算法需要计算残差向量 $\\mathbf{R}(\\boldsymbol{\\theta})$ 及其雅可比矩阵 $\\mathbf{J}(\\boldsymbol{\\theta})$。\n\n残差向量 $\\mathbf{R}(\\boldsymbol{\\theta})$ 是一个 $m$ 维向量，由连接所有单个加权残差构成：\n$$ \\mathbf{R}(\\boldsymbol{\\theta}) = [R_{E,1}(\\boldsymbol{\\theta}), \\dots, R_{E,M_{opt}}(\\boldsymbol{\\theta}), R_{\\ln n,1}(\\boldsymbol{\\theta}), \\dots, R_{\\ln n,M_{elec}}(\\boldsymbol{\\theta})]^\\top $$\n\n雅可比矩阵是一个 $m \\times 2$ 的矩阵 $\\mathbf{J}(\\boldsymbol{\\theta})$，其中 $J_{k,l} = \\partial R_k / \\partial \\theta_l$。两列分别对应于对 $A$ 和 $p$ 的导数。\n\n对于光学残差 $R_{E,i}$，偏导数为：\n$$ \\frac{\\partial R_{E,i}}{\\partial A} = \\frac{1}{\\sigma_{E,i}} \\left( \\frac{N_i}{N_{\\mathrm{ref}}} \\right)^p $$\n$$ \\frac{\\partial R_{E,i}}{\\partial p} = \\frac{A}{\\sigma_{E,i}} \\left( \\frac{N_i}{N_{\\mathrm{ref}}} \\right)^p \\ln\\left( \\frac{N_i}{N_{\\mathrm{ref}}} \\right) $$\n\n对于电学残差 $R_{\\ln n,j}$，偏导数为：\n$$ \\frac{\\partial R_{\\ln n,j}}{\\partial A} = -\\frac{1}{2 k_B T \\sigma_{\\ln n,j}} \\left( \\frac{N_j}{N_{\\mathrm{ref}}} \\right)^p $$\n$$ \\frac{\\partial R_{\\ln n,j}}{\\partial p} = -\\frac{A}{2 k_B T \\sigma_{\\ln n,j}} \\left( \\frac{N_j}{N_{\\mathrm{ref}}} \\right)^p \\ln\\left( \\frac{N_j}{N_{\\mathrm{ref}}} \\right) $$\n\n将这些雅可比矩阵的解析表达式提供给数值求解器，与有限差分近似相比，这可以提高收敛速度和准确性。\n\n### 3. 参数不确定性量化\n\n优化得到最佳拟合参数 $\\hat{\\boldsymbol{\\theta}} = (\\hat{A}, \\hat{p})$ 后，对这些估计值的不确定性进行量化。在假设模型能很好地代表数据生成过程的前提下，估计参数的协方差矩阵可以通过在解附近对模型进行线性近似来估算。\n\n协方差矩阵 $\\mathbf{C}_\\theta$ 由下式给出：\n$$ \\mathbf{C}_\\theta \\approx s^2 (\\mathbf{J}^\\top \\mathbf{J})^{-1} $$\n其中 $\\mathbf{J}$ 是在解 $\\hat{\\boldsymbol{\\theta}}$ 处计算的雅可比矩阵。项 $s^2$ 是估计的残差方差（也称为约化卡方），计算如下：\n$$ s^2 = \\frac{\\chi^2(\\hat{\\boldsymbol{\\theta}})}{m - n_p} = \\frac{\\sum_{k=1}^m R_k(\\hat{\\boldsymbol{\\theta}})^2}{m - 2} $$\n这里，$n_p = 2$ 是估计参数的数量。这个因子 $s^2$ 用于解释对测量不确定度 $\\sigma_k$ 的任何潜在的低估或高估。\n\n参数的标准误是协方差矩阵对角元素的平方根：\n$$ \\mathrm{SE}_A = \\sqrt{(\\mathbf{C}_\\theta)_{11}} $$\n$$ \\mathrm{SE}_p = \\sqrt{(\\mathbf{C}_\\theta)_{22}} $$\n这些标准误提供了估计参数 $\\hat{A}$ 和 $\\hat{p}$ 精度的度量。\n\n实现将使用 `scipy.optimize.least_squares`，这是一个适用于有界非线性最小二乘问题的工具，并为其提供残差和解析雅可比矩阵的函数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Solves for BGN parameters and their uncertainties for a series of test cases.\n    \"\"\"\n    # Define constants\n    E_g0 = 1.12  # eV\n    T = 300.0  # K\n    k_B = 8.617333262145e-5  # eV/K\n    N_ref = 1.0e17  # cm^-3\n    ln_ni0 = np.log(1.0e10)  # ln(cm^-3)\n    kBT2 = 2 * k_B * T\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1\n        {\n            \"N_opt\": np.array([1.0e16, 3.0e17, 1.0e18, 3.0e19]),\n            \"E_opt\": np.array([1.106753173, 1.095178020, 1.083934412, 1.040764180]),\n            \"sigma_E\": np.array([0.003, 0.004, 0.004, 0.008]),\n            \"N_elec\": np.array([1.0e17, 1.0e18, 5.0e19]),\n            \"ln_ni_elec\": np.array([23.462249930, 23.693750930, 25.005013930]),\n            \"sigma_ln_n\": np.array([0.050, 0.040, 0.080]),\n        },\n        # Test Case 2\n        {\n            \"N_opt\": np.array([2.0e17, 5.0e18, 1.0e20]),\n            \"E_opt\": np.array([1.086059000, 1.047080000, 0.988810000]),\n            \"sigma_E\": np.array([0.003, 0.006, 0.010]),\n            \"N_elec\": np.array([5.0e17, 2.0e19, 1.0e20]),\n            \"ln_ni_elec\": np.array([23.882550000, 24.985850930, 25.628750930]),\n            \"sigma_ln_n\": np.array([0.060, 0.070, 0.090]),\n        },\n        # Test Case 3\n        {\n            \"N_opt\": np.array([5.0e16, 1.0e17, 2.0e17]),\n            \"E_opt\": np.array([1.106820000, 1.105800000, 1.100035000]),\n            \"sigma_E\": np.array([0.002, 0.002, 0.003]),\n            \"N_elec\": np.array([8.0e16, 1.0e17, 3.0e17]),\n            \"ln_ni_elec\": np.array([23.267150930, 23.335850930, 23.418950930]),\n            \"sigma_ln_n\": np.array([0.030, 0.030, 0.040]),\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        N_opt, E_opt, sigma_E = case[\"N_opt\"], case[\"E_opt\"], case[\"sigma_E\"]\n        N_elec, ln_ni_elec, sigma_ln_n = case[\"N_elec\"], case[\"ln_ni_elec\"], case[\"sigma_ln_n\"]\n\n        def residuals_func(params):\n            A, p = params\n            \n            # Optical residuals\n            N_ratio_opt = N_opt / N_ref\n            delta_E_g_opt = A * np.power(N_ratio_opt, p)\n            res_opt = (E_opt - E_g0 + delta_E_g_opt) / sigma_E\n            \n            # Electrical residuals\n            N_ratio_elec = N_elec / N_ref\n            delta_E_g_elec = A * np.power(N_ratio_elec, p)\n            res_elec = (ln_ni_elec - ln_ni0 - delta_E_g_elec / kBT2) / sigma_ln_n\n            \n            return np.concatenate((res_opt, res_elec))\n\n        def jacobian_func(params):\n            A, p = params\n\n            # Optical part\n            N_ratio_opt = N_opt / N_ref\n            term_opt = np.power(N_ratio_opt, p)\n            \n            log_N_ratio_opt = np.zeros_like(N_ratio_opt, dtype=float)\n            valid_idx = N_ratio_opt  0\n            log_N_ratio_opt[valid_idx] = np.log(N_ratio_opt[valid_idx])\n\n            jac_opt_A = term_opt / sigma_E\n            jac_opt_p = (A * term_opt * log_N_ratio_opt) / sigma_E\n            jac_opt = np.stack((jac_opt_A, jac_opt_p), axis=-1)\n            \n            # Electrical part\n            N_ratio_elec = N_elec / N_ref\n            term_elec = np.power(N_ratio_elec, p)\n\n            log_N_ratio_elec = np.zeros_like(N_ratio_elec, dtype=float)\n            valid_idx_elec = N_ratio_elec  0\n            log_N_ratio_elec[valid_idx_elec] = np.log(N_ratio_elec[valid_idx_elec])\n            \n            jac_elec_A = -term_elec / (kBT2 * sigma_ln_n)\n            jac_elec_p = - (A * term_elec * log_N_ratio_elec) / (kBT2 * sigma_ln_n)\n            jac_elec = np.stack((jac_elec_A, jac_elec_p), axis=-1)\n            \n            return np.vstack((jac_opt, jac_elec))\n\n        # Initial guess and bounds (small positive lower bound for strict positivity)\n        x0 = [0.02, 0.33]\n        bounds = ([1e-9, 1e-9], [np.inf, np.inf])\n\n        # Perform the least squares fit\n        result = least_squares(residuals_func, x0, jac=jacobian_func, bounds=bounds, method='trf', ftol=1e-12, xtol=1e-12, gtol=1e-12)\n        \n        A_hat, p_hat = result.x\n        \n        # Calculate covariance matrix\n        J = result.jac\n        m = N_opt.size + N_elec.size\n        n_p = 2\n        dof = m - n_p\n        \n        if dof = 0:\n             # Cannot estimate variance if no degrees of freedom\n            SE_A, SE_p = np.nan, np.nan\n        else:\n            # Sum of squared residuals\n            ssr = np.sum(result.fun**2)\n            # Residual variance\n            s2 = ssr / dof\n            \n            try:\n                # Covariance matrix calculation\n                cov_matrix = s2 * np.linalg.inv(J.T @ J)\n                SE = np.sqrt(np.diag(cov_matrix))\n                SE_A, SE_p = SE\n            except np.linalg.LinAlgError:\n                # Handle cases where matrix is singular\n                SE_A, SE_p = np.inf, np.inf\n\n        all_results.append(f\"[{A_hat:.6f},{p_hat:.6f},{SE_A:.6f},{SE_p:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}