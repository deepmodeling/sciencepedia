{
    "hands_on_practices": [
        {
            "introduction": "This first practice establishes the foundation of kinetic modeling using a simple, yet powerful, two-state system. We will model dopants switching between an electrically active state and an inactive state, governed by first-order reversible kinetics. By solving the governing rate equation under a non-isothermal annealing schedule , you will develop the core skill of translating a physical model into a solvable ordinary differential equation and handling temperature-dependent rates.",
            "id": "4121849",
            "problem": "Consider a two-state dopant system in a semiconductor during thermal processing. Let $x(t)$ denote the fraction of electrically active dopant at time $t$, and $1 - x(t)$ denote the fraction in an inactive state. Assume first-order reversible kinetics between the inactive and active states with temperature-dependent rate constants. The activation rate constant $k_a(T)$ and deactivation rate constant $k_d(T)$ follow the Arrhenius law with pre-exponential factors and activation energies. Specifically, for any temperature $T$, the rate constants are given by $k_a(T)$ and $k_d(T)$ where each has the standard Arrhenius dependence on $T$ with energy expressed in electronvolts and the Boltzmann constant (denoted $k_B$) expressed in electronvolts per kelvin.\n\nStarting from mass-action kinetics and the Arrhenius temperature dependence for the rate constants, derive the governing equation for $x(t)$ under a general, non-isothermal temperature history $T(t)$. Then, for a temperature profile consisting of a linear ramp followed by a hold,\n- for $0 \\le t \\le t_{\\mathrm{ramp}}$ with $t_{\\mathrm{ramp}} = (T_1 - T_0)/\\beta$, let $T(t) = T_0 + \\beta t$;\n- for $t_{\\mathrm{ramp}} < t \\le t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$, let $T(t) = T_1$,\ncompute the final active fraction $x(t_{\\mathrm{final}})$ at $t_{\\mathrm{final}} = t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$.\n\nAll energies must be in electronvolts, all temperatures in kelvin, time in seconds, and ramp rate in kelvin per second. Use $k_B = 8.617333262145 \\times 10^{-5}$ electronvolts per kelvin. The quantity $x(t)$ is dimensionless.\n\nYour program must numerically evaluate $x(t)$ over time for each test scenario described below and return the final value $x(t_{\\mathrm{final}})$ for each case. The numeric answer for each case must be rounded to six decimals. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nTest suite (each case is $(T_0, T_1, \\beta, t_{\\mathrm{hold}}, A_a, E_a, A_d, E_d, x(0))$ where $A_a$ and $A_d$ are the pre-exponential factors in $\\mathrm{s}^{-1}$, $E_a$ and $E_d$ are activation energies in electronvolts, $\\beta$ is the ramp rate in $\\mathrm{K/s}$, $T_0$ and $T_1$ are in $\\mathrm{K}$, $t_{\\mathrm{hold}}$ in $\\mathrm{s}$, and $x(0)$ is dimensionless):\n\n- Case 1 (general activation-dominant non-isothermal anneal): $(900,\\;1050,\\;10,\\;60,\\;10^9,\\;1.5,\\;5\\times 10^7,\\;2.5,\\;0.0)$.\n- Case 2 (rapid ramp with short hold): $(900,\\;1050,\\;100,\\;5,\\;10^9,\\;1.5,\\;5\\times 10^7,\\;2.5,\\;0.0)$.\n- Case 3 (deactivation from a fully active initial state): $(1100,\\;1200,\\;20,\\;120,\\;0.0,\\;1.0,\\;10^9,\\;2.0,\\;1.0)$.\n- Case 4 (isothermal hold as a boundary case): $(1000,\\;1000,\\;10,\\;30,\\;5\\times 10^8,\\;1.6,\\;2\\times 10^7,\\;2.4,\\;0.2)$.\n\nYour program must implement the kinetics using the temperature-dependent rates and produce the final output in the exact format specified above. The outputs are floats rounded to six decimals, dimensionless.",
            "solution": "The problem requires the derivation and numerical solution of a kinetic model for dopant activation in a semiconductor under a non-isothermal thermal process. The validation of the problem statement confirms that it is scientifically grounded, well-posed, and contains all necessary information to proceed.\n\nFirst, we establish the governing differential equation from first principles. The system consists of two states for dopant atoms: active and inactive. Let $x(t)$ be the fraction of dopants in the active state at time $t$. Consequently, the fraction in the inactive state is $1 - x(t)$. The total concentration of dopants, $C_{total}$, is constant. The concentration of active dopants is $C_a(t) = x(t) C_{total}$, and the concentration of inactive dopants is $C_i(t) = (1-x(t))C_{total}$.\n\nThe problem states that the transition between these states follows first-order reversible kinetics:\n$$\n\\text{Inactive} \\underset{k_d}{\\stackrel{k_a}{\\rightleftharpoons}} \\text{Active}\n$$\nHere, $k_a$ is the rate constant for the activation reaction (Inactive $\\rightarrow$ Active), and $k_d$ is the rate constant for the deactivation reaction (Active $\\rightarrow$ Inactive).\n\nAccording to the law of mass action, the rate of change of the concentration of active dopants, $\\frac{dC_a}{dt}$, is given by the rate of formation from the inactive state minus the rate of loss to the inactive state:\n$$\n\\frac{dC_a}{dt} = k_a C_i - k_d C_a\n$$\nSubstituting the expressions for $C_a$ and $C_i$ in terms of the active fraction $x(t)$:\n$$\n\\frac{d(x(t) C_{total})}{dt} = k_a(T(t)) (1 - x(t)) C_{total} - k_d(T(t)) x(t) C_{total}\n$$\nSince $C_{total}$ is a constant, the derivative simplifies, and we can divide the entire equation by $C_{total}$:\n$$\n\\frac{dx}{dt} = k_a(T(t)) (1 - x(t)) - k_d(T(t)) x(t)\n$$\nThis is the governing first-order ordinary differential equation (ODE) for the active dopant fraction $x(t)$. The rate constants $k_a$ and $k_d$ are temperature-dependent, and thus time-dependent through the temperature history $T(t)$.\n\nThe temperature dependence of the rate constants is described by the Arrhenius equation:\n$$\nk_a(T) = A_a \\exp\\left(-\\frac{E_a}{k_B T}\\right)\n$$\n$$\nk_d(T) = A_d \\exp\\left(-\\frac{E_d}{k_B T}\\right)\n$$\nwhere $A_a$ and $A_d$ are the pre-exponential factors (in $\\mathrm{s}^{-1}$), $E_a$ and $E_d$ are the activation energies (in electronvolts, eV), and $k_B$ is the Boltzmann constant, given as $8.617333262145 \\times 10^{-5} \\, \\mathrm{eV} \\cdot \\mathrm{K}^{-1}$.\n\nThe temperature profile $T(t)$ is specified as a two-part process: a linear ramp followed by an isothermal hold.\nFor the ramp phase, where $0 \\le t \\le t_{\\mathrm{ramp}}$:\n$$\nT(t) = T_0 + \\beta t\n$$\nFor the hold phase, where $t_{\\mathrm{ramp}} < t \\le t_{\\mathrm{final}}$:\n$$\nT(t) = T_1\n$$\nThe duration of the ramp is $t_{\\mathrm{ramp}} = (T_1 - T_0)/\\beta$, and the total process time is $t_{\\mathrm{final}} = t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$. Note that for an isothermal process where $T_0 = T_1$, $t_{\\mathrm{ramp}}$ correctly evaluates to $0$ s.\n\nThe governing ODE can be expressed in the standard linear form $\\frac{dx}{dt} + P(t)x = Q(t)$:\n$$\n\\frac{dx}{dt} + [k_a(T(t)) + k_d(T(t))] x(t) = k_a(T(t))\n$$\nBecause the temperature $T(t)$ is not constant during the ramp phase, the coefficients of the ODE, $P(t) = k_a(T(t)) + k_d(T(t))$ and $Q(t) = k_a(T(t))$, are explicit functions of time. This makes the ODE non-autonomous, and an analytical solution is generally not feasible. Therefore, a numerical approach is required.\n\nThe problem is formulated as an initial value problem (IVP), with the ODE $\\frac{dx}{dt} = f(t, x)$ and an initial condition $x(0) = x_0$ provided for each case. We will solve this IVP numerically over the time interval $[0, t_{\\mathrm{final}}]$. The `scipy.integrate.solve_ivp` function from the SciPy library is a robust tool for this purpose. It implements several adaptive-stepsize algorithms suitable for both stiff and non-stiff ODEs. Chemical kinetic problems are often stiff, so using a method like 'Radau' or 'BDF' is advisable for stability and accuracy.\n\nThe computational procedure is as follows:\n1. For each test case, extract all parameters: $(T_0, T_1, \\beta, t_{\\mathrm{hold}}, A_a, E_a, A_d, E_d, x(0))$.\n2. Define a function, say `dxdt(t, y, params)`, that computes the right-hand side of the ODE. This function will:\n   a. Unpack the parameters.\n   b. Determine the temperature $T$ at the current time $t$ based on the piecewise definition of $T(t)$.\n   c. Calculate $k_a(T)$ and $k_d(T)$ using the Arrhenius equations.\n   d. Return the value of $\\frac{dx}{dt} = k_a (1 - x) - k_d x$. Note that `solve_ivp` expects the state variable `y` to be an array, so we use `x = y[0]`.\n3. Set the time span for integration to $[0, t_{\\mathrm{final}}]$ and the initial condition to $[x(0)]$.\n4. Call `solve_ivp` with the function from step 2, the time span, the initial condition, and the parameters.\n5. The result object from `solve_ivp` will contain the solution at various time points. The final active fraction, $x(t_{\\mathrm{final}})$, is the last value in the solution array, `sol.y[0, -1]`.\n6. This final value is rounded to six decimal places as required.\n7. This process is repeated for all test cases, and the results are aggregated into the specified output format.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the dopant activation kinetics ODE for a set of test cases.\n    \"\"\"\n    \n    # Constants\n    K_B = 8.617333262145e-5  # Boltzmann constant in eV/K\n\n    # Test suite: (T0, T1, beta, t_hold, Aa, Ea, Ad, Ed, x0)\n    test_cases = [\n        (900.0, 1050.0, 10.0, 60.0, 1e9, 1.5, 5e7, 2.5, 0.0),\n        (900.0, 1050.0, 100.0, 5.0, 1e9, 1.5, 5e7, 2.5, 0.0),\n        (1100.0, 1200.0, 20.0, 120.0, 0.0, 1.0, 1e9, 2.0, 1.0),\n        (1000.0, 1000.0, 10.0, 30.0, 5e8, 1.6, 2e7, 2.4, 0.2),\n    ]\n\n    results = []\n\n    def dxdt(t, y, T0, T1, beta, t_ramp, Aa, Ea, Ad, Ed):\n        \"\"\"\n        RHS of the ODE dx/dt for the active dopant fraction x.\n        \"\"\"\n        x = y[0]\n\n        # Determine temperature T at time t\n        if t <= t_ramp:\n            T = T0 + beta * t\n        else:\n            T = T1\n        \n        # Prevent division by zero if T is ever 0, though not expected here\n        if T <= 0:\n            return [0.0]\n\n        # Calculate Arrhenius rate constants\n        # Aa = 0 implies ka = 0, exp can be avoided\n        k_a = Aa * np.exp(-Ea / (K_B * T)) if Aa > 0.0 else 0.0\n        # Ad = 0 implies kd = 0\n        k_d = Ad * np.exp(-Ed / (K_B * T)) if Ad > 0.0 else 0.0\n\n        # Return rate of change of active fraction\n        return [k_a * (1 - x) - k_d * x]\n\n    for case in test_cases:\n        T0, T1, beta, t_hold, Aa, Ea, Ad, Ed, x0 = case\n\n        # Calculate time for the temperature ramp\n        # If beta is zero, but T0 != T1, t_ramp would be infinite, but problem spec avoids this.\n        # If T0 == T1, it's an isothermal case, and t_ramp is correctly 0.\n        if beta > 0:\n            t_ramp = (T1 - T0) / beta\n        else:\n            t_ramp = 0.0\n\n        t_final = t_ramp + t_hold\n        \n        # Ensure t_final is non-zero to avoid integration errors\n        if t_final <= 0:\n            results.append(round(x0, 6))\n            continue\n\n        # Set up parameters for the ODE solver\n        params = (T0, T1, beta, t_ramp, Aa, Ea, Ad, Ed)\n        \n        # Initial condition\n        y0 = [x0]\n        \n        # Time span for integration\n        t_span = [0, t_final]\n\n        # Solve the ODE. 'Radau' is a good choice for potentially stiff problems\n        # like chemical kinetics.\n        sol = solve_ivp(\n            dxdt,\n            t_span,\n            y0,\n            args=params,\n            method='Radau',\n            dense_output=True\n        )\n\n        # The solution at the final time point\n        x_final = sol.sol(t_final)[0]\n        \n        # Append the rounded result\n        results.append(round(x_final, 6))\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Building on the basics, this exercise moves toward a more realistic process simulation by modeling a network of interacting species. Instead of an abstract inactive state, we consider specific dopant-defect reactions involving self-interstitials and vacancies, which are crucial for understanding modern annealing processes. By simulating a multi-step implant-and-anneal sequence , you will learn to solve systems of stiff ordinary differential equations and apply the model to a practical problem: optimizing a process flow for maximum dopant activation.",
            "id": "4121922",
            "problem": "Consider a reaction network that captures dopant activation and deactivation in crystalline silicon during semiconductor manufacturing. Multiple ion implantation steps introduce dopant atoms and point defects, followed by thermal anneals at specified temperatures. Your task is to derive, implement, and solve a mass-action kinetic model with Arrhenius temperature dependence to predict the final fraction of electrically active dopant and to use this prediction to determine the optimal ordering of implants and anneals among the provided sequences.\n\nFundamental base and assumptions:\n- Use the mass-action law of chemical kinetics for reactions between species. If $A$ and $B$ react to form $C$ with a bimolecular rate constant $k$, then the forward reaction rate is $r = k [A][B]$.\n- Use the Arrhenius law for temperature dependence of rate constants, $k(T) = k_0 \\exp\\!\\left(-\\dfrac{E_a}{k_B T}\\right)$, where $k_0$ is the pre-exponential factor, $E_a$ is the activation energy, $k_B$ is the Boltzmann constant, and $T$ is the absolute temperature.\n- Neglect spatial gradients and diffusion; model in a well-mixed volume element so that all species are represented by densities in $\\text{cm}^{-3}$.\n\nSpecies:\n- $D_i$: interstitial dopant density (inactive), units $\\text{cm}^{-3}$.\n- $D_s$: substitutional dopant density (active), units $\\text{cm}^{-3}$.\n- $X$: dopant-interstitial complex density (inactive cluster), units $\\text{cm}^{-3}$.\n- $I$: self-interstitial density, units $\\text{cm}^{-3}$.\n- $V$: vacancy density, units $\\text{cm}^{-3}$.\n\nReactions:\n- Interstitialcy activation and its reverse:\n  $$D_i + I \\xrightarrow{k_1(T)} D_s,\\quad D_s \\xrightarrow{k_{1r}(T)} D_i + I.$$\n- Deactivation by complex formation and its reverse:\n  $$D_s + I \\xrightarrow{k_2(T)} X,\\quad X \\xrightarrow{k_{2r}(T)} D_s + I.$$\n- Interstitial-vacancy recombination:\n  $$I + V \\xrightarrow{k_3(T)} \\varnothing.$$\n\nWrite the mass-action ordinary differential equations (to be derived in your solution):\n- $\\dfrac{d D_i}{d t}$, $\\dfrac{d D_s}{d t}$, $\\dfrac{d X}{d t}$, $\\dfrac{d I}{d t}$, $\\dfrac{d V}{d t}$ as functions of the reaction rates.\n\nTemperature dependence:\n- Use $k_B = 8.617\\times 10^{-5}\\,\\text{eV/K}$.\n- Parameterize the Arrhenius prefactors and activation energies as follows (selected to be scientifically plausible, and self-consistent):\n  - $k_1$: $k_{1,0} = 1.0\\times 10^{-13}\\,\\text{cm}^3/\\text{s}$, $E_{a,1} = 0.80\\,\\text{eV}$.\n  - $k_{1r}$: $k_{1r,0} = 1.0\\times 10^{4}\\,\\text{s}^{-1}$, $E_{a,1r} = 2.20\\,\\text{eV}$.\n  - $k_2$: $k_{2,0} = 5.0\\times 10^{-14}\\,\\text{cm}^3/\\text{s}$, $E_{a,2} = 1.20\\,\\text{eV}$.\n  - $k_{2r}$: $k_{2r,0} = 5.0\\times 10^{2}\\,\\text{s}^{-1}$, $E_{a,2r} = 2.60\\,\\text{eV}$.\n  - $k_3$: $k_{3,0} = 2.0\\times 10^{-12}\\,\\text{cm}^3/\\text{s}$, $E_{a,3} = 0.50\\,\\text{eV}$.\n\nImplant steps:\n- An implant of dose $D$ instantly increases $D_i$ by $f_i D$, increases $D_s$ by $(1 - f_i) D$, and increases the point defects by $I \\leftarrow I + \\alpha_I D$, $V \\leftarrow V + \\alpha_V D$, where $f_i$ is the fraction of dopant initially interstitial and $\\alpha_I$, $\\alpha_V$ represent damage generation per dopant atom. These are instantaneous changes without time evolution.\n\nAnneal steps:\n- During an anneal at temperature $T$ for duration $\\tau$, the system evolves under the kinetic ordinary differential equations at constant $T$ for $t \\in [0,\\tau]$, and initial conditions set by the state immediately prior to the anneal step.\n\nObjective:\n- For each process sequence, compute the final active fraction defined as\n  $$ \\phi = \\frac{D_s}{D_i + D_s + X} $$\n  evaluated at the end of the sequence. Additionally, compute the optimal sequence index that maximizes $\\phi$ among the provided sequences, using $1$-based indexing and breaking ties by choosing the smallest index.\n\nUnits and output:\n- All densities must be handled in $\\text{cm}^{-3}$, temperatures in $\\text{K}$, and durations in $\\text{s}$.\n- Express each active fraction $\\phi$ as a decimal rounded to three decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\phi_1,\\phi_2,\\phi_3,\\text{best}]$, where $\\phi_i$ are the final active fractions for the three test sequences, and $\\text{best}$ is the optimal sequence index (an integer).\n\nTest suite (three sequences):\n- Sequence $1$ (staged activation):\n  - Initial defects: $I_0 = 0\\,\\text{cm}^{-3}$, $V_0 = 0\\,\\text{cm}^{-3}$.\n  - Step $1$: Implant, dose $3.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $2$: Anneal, $T = 1173\\,\\text{K}$, duration $\\tau = 600\\,\\text{s}$.\n  - Step $3$: Implant, dose $2.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $4$: Anneal, $T = 1273\\,\\text{K}$, duration $\\tau = 120\\,\\text{s}$.\n- Sequence $2$ (back-to-back implants then long anneal):\n  - Initial defects: $I_0 = 0\\,\\text{cm}^{-3}$, $V_0 = 0\\,\\text{cm}^{-3}$.\n  - Step $1$: Implant, dose $3.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $2$: Implant, dose $2.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $3$: Anneal, $T = 1223\\,\\text{K}$, duration $\\tau = 900\\,\\text{s}$.\n- Sequence $3$ (initial defects and mixed spike/soak anneals):\n  - Initial defects: $I_0 = 5.0\\times 10^{18}\\,\\text{cm}^{-3}$, $V_0 = 5.0\\times 10^{18}\\,\\text{cm}^{-3}$.\n  - Step $1$: Implant, dose $3.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $2$: Anneal, $T = 1173\\,\\text{K}$, duration $\\tau = 60\\,\\text{s}$.\n  - Step $3$: Implant, dose $2.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $4$: Anneal, $T = 1373\\,\\text{K}$, duration $\\tau = 30\\,\\text{s}$.\n\nImplementation requirements:\n- Solve the ordinary differential equations numerically for each anneal step using a method suitable for stiff systems.\n- Aggregate the results from all provided test sequences into the required single-line output format.",
            "solution": "The problem requires the formulation and numerical solution of a mass-action kinetic model to simulate dopant activation and deactivation in silicon during a sequence of ion implantation and thermal annealing steps. The objective is to determine the final fraction of electrically active dopants for several process sequences and to identify the optimal sequence that maximizes this fraction.\n\nThe model is based on a system of coupled ordinary differential equations (ODEs), which describe the time evolution of the concentrations of various species within a well-mixed volume element. The spatial dependence of concentrations is neglected.\n\nThe species involved in the reaction network are:\n- $D_i$: Interstitial dopant concentration (inactive), in units of $\\text{cm}^{-3}$.\n- $D_s$: Substitutional dopant concentration (electrically active), in units of $\\text{cm}^{-3}$.\n- $X$: Dopant-interstitial complex concentration (inactive), in units of $\\text{cm}^{-3}$.\n- $I$: Self-interstitial point defect concentration, in units of $\\text{cm}^{-3}$.\n- $V$: Vacancy point defect concentration, in units of $\\text{cm}^{-3}$.\n\nThe state of the system at any time $t$ is described by the vector of concentrations $y(t) = ([D_i], [D_s], [X], [I], [V])$.\n\nThe reactions governing the system kinetics are:\n1. Interstitialcy activation/deactivation: $D_i + I \\rightleftharpoons_{k_{1r}(T)}^{k_1(T)} D_s$\n2. Complex formation/dissolution: $D_s + I \\rightleftharpoons_{k_{2r}(T)}^{k_2(T)} X$\n3. Interstitial-vacancy recombination: $I + V \\xrightarrow{k_3(T)} \\varnothing$ (annihilation)\n\nAccording to the law of mass action, the rates for these reactions are given by:\n- $R_1 = k_1(T) [D_i] [I]$\n- $R_{1r} = k_{1r}(T) [D_s]$\n- $R_2 = k_2(T) [D_s] [I]$\n- $R_{2r} = k_{2r}(T) [X]$\n- $R_3 = k_3(T) [I] [V]$\n\nFrom these rates, we can derive the system of ODEs describing the rate of change of each species' concentration. The rate of change for each species is the sum of the rates of the reactions that produce it, minus the sum of the rates of the reactions that consume it.\n\nThe resulting system of five coupled first-order ODEs is:\n$$ \\frac{d[D_i]}{dt} = -R_1 + R_{1r} = -k_1 [D_i][I] + k_{1r} [D_s] $$\n$$ \\frac{d[D_s]}{dt} = R_1 - R_{1r} - R_2 + R_{2r} = k_1 [D_i][I] - k_{1r} [D_s] - k_2 [D_s][I] + k_{2r} [X] $$\n$$ \\frac{d[X]}{dt} = R_2 - R_{2r} = k_2 [D_s][I] - k_{2r} [X] $$\n$$ \\frac{d[I]}{dt} = -R_1 + R_{1r} - R_2 + R_{2r} - R_3 = -k_1 [D_i][I] + k_{1r} [D_s] - k_2 [D_s][I] + k_{2r} [X] - k_3 [I][V] $$\n$$ \\frac{d[V]}{dt} = -R_3 = -k_3 [I][V] $$\n\nA critical consistency check is to verify the conservation of total dopant atoms during an anneal. The total dopant concentration is $D_{tot} = [D_i] + [D_s] + [X]$. Its time derivative is $\\frac{dD_{tot}}{dt} = \\frac{d[D_i]}{dt} + \\frac{d[D_s]}{dt} + \\frac{d[X]}{dt}$. Summing the derived ODEs, all terms cancel, yielding $\\frac{dD_{tot}}{dt} = 0$, which confirms that the total dopant concentration is a conserved quantity during thermal annealing, as expected.\n\nThe temperature dependence of the rate constants $k_j$ is given by the Arrhenius equation:\n$$ k_j(T) = k_{j,0} \\exp\\left(-\\frac{E_{a,j}}{k_B T}\\right) $$\nwhere $k_{j,0}$ is the pre-exponential factor, $E_{a,j}$ is the activation energy for reaction $j$, $T$ is the absolute temperature in Kelvin, and $k_B$ is the Boltzmann constant, given as $8.617 \\times 10^{-5}\\,\\text{eV/K}$. The specific parameters for each reaction are provided in the problem statement.\n\nThe simulation proceeds by sequentially processing the steps for each given sequence:\n1.  **Implant Step:** This is modeled as an instantaneous change in the concentrations. For an implant of dose $D$, with interstitial fraction $f_i$ and damage factors $\\alpha_I$ and $\\alpha_V$, the state vector is updated as follows:\n    - $[D_i] \\leftarrow [D_i] + f_i D$\n    - $[D_s] \\leftarrow [D_s] + (1 - f_i) D$\n    - $[I] \\leftarrow [I] + \\alpha_I D$\n    - $[V] \\leftarrow [V] + \\alpha_V D$\n2.  **Anneal Step:** This step involves solving the system of ODEs over a time interval $[0, \\tau]$ at a constant temperature $T$. First, the rate constants $k_j(T)$ are calculated for the specified temperature $T$. Then, a numerical ODE solver is used to integrate the system. Due to the wide range of timescales possible in such kinetic systems, they are often stiff. Therefore, a numerical method suitable for stiff problems, such as the Backward Differentiation Formula (BDF), is required. The initial condition for the integration is the state vector at the end of the previous step. The final state vector from the solver becomes the initial state for the next step.\n\nAfter all steps in a sequence are completed, the final active dopant fraction, $\\phi$, is calculated using the final concentrations:\n$$ \\phi = \\frac{[D_s]_{final}}{[D_i]_{final} + [D_s]_{final} + [X]_{final}} $$\n\nThis procedure is repeated for each of the three test sequences. Finally, the sequence that yields the highest value of $\\phi$ is identified as the optimal one. The results are then formatted as requested.\n\nThe implementation will utilize the `scipy.integrate.solve_ivp` function with the `method='BDF'` option to handle the stiff ODE system during the anneal steps. The state of the system will be tracked using a NumPy array, which will be updated after each implant and anneal step.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the dopant activation/deactivation kinetics problem for three\n    different process sequences.\n    \"\"\"\n\n    # --- Constants and Parameters ---\n    KB = 8.617e-5  # Boltzmann constant in eV/K\n\n    # Arrhenius parameters: (k_0, E_a)\n    # k_0 units: cm^3/s for bimolecular, 1/s for unimolecular\n    # E_a units: eV\n    PARAMS = {\n        'k1': (1.0e-13, 0.80),\n        'k1r': (1.0e4, 2.20),\n        'k2': (5.0e-14, 1.20),\n        'k2r': (5.0e2, 2.60),\n        'k3': (2.0e-12, 0.50),\n    }\n\n    # --- Test Sequences Definition ---\n    # Structure: list of sequences, where each sequence is a list of steps.\n    # Each step is a dictionary defining its type and parameters.\n    # Species order in state vector: [Di, Ds, X, I, V]\n    \n    sequences = [\n        # Sequence 1\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1173, 'tau': 600},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1273, 'tau': 120}\n        ],\n        # Sequence 2\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1223, 'tau': 900}\n        ],\n        # Sequence 3\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1173, 'tau': 60},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1373, 'tau': 30}\n        ]\n    ]\n\n    initial_conditions = [\n        np.array([0.0, 0.0, 0.0, 0.0, 0.0]), # Seq 1: Di, Ds, X, I, V\n        np.array([0.0, 0.0, 0.0, 0.0, 0.0]), # Seq 2\n        np.array([0.0, 0.0, 0.0, 5.0e18, 5.0e18]) # Seq 3\n    ]\n\n    def get_rate_constants(T):\n        \"\"\"Calculates Arrhenius rate constants for a given temperature T.\"\"\"\n        k = {}\n        for key, (k0, Ea) in PARAMS.items():\n            k[key] = k0 * np.exp(-Ea / (KB * T))\n        return k['k1'], k['k1r'], k['k2'], k['k2r'], k['k3']\n\n    def ode_system(t, y, k1, k1r, k2, k2r, k3):\n        \"\"\"\n        Defines the system of ordinary differential equations for dopant kinetics.\n        y = [Di, Ds, X, I, V]\n        \"\"\"\n        Di, Ds, X, I, V = y\n        \n        # Ensure concentrations do not go below zero during integration\n        if Di < 0: Di = 0\n        if Ds < 0: Ds = 0\n        if X < 0: X = 0\n        if I < 0: I = 0\n        if V < 0: V = 0\n\n        # Reaction rates\n        R1 = k1 * Di * I\n        R1r = k1r * Ds\n        R2 = k2 * Ds * I\n        R2r = k2r * X\n        R3 = k3 * I * V\n\n        # ODEs\n        dDi_dt = -R1 + R1r\n        dDs_dt = R1 - R1r - R2 + R2r\n        dX_dt = R2 - R2r\n        dI_dt = -R1 + R1r - R2 + R2r - R3\n        dV_dt = -R3\n        \n        return [dDi_dt, dDs_dt, dX_dt, dI_dt, dV_dt]\n\n    final_phis = []\n\n    for i, sequence in enumerate(sequences):\n        # Initialize state vector from the problem's initial conditions\n        y = np.copy(initial_conditions[i])\n\n        for step in sequence:\n            if step['type'] == 'implant':\n                dose = step['dose']\n                fi = step['fi']\n                alpha_I = step['alpha_I']\n                alpha_V = step['alpha_V']\n                \n                y[0] += fi * dose         # Di\n                y[1] += (1 - fi) * dose   # Ds\n                y[3] += alpha_I * dose    # I\n                y[4] += alpha_V * dose    # V\n            \n            elif step['type'] == 'anneal':\n                T = step['T']\n                tau = step['tau']\n                \n                # Calculate rate constants for the anneal temperature\n                k_tuple = get_rate_constants(T)\n                \n                # Solve the ODE system for the anneal duration\n                sol = solve_ivp(\n                    fun=ode_system,\n                    t_span=[0, tau],\n                    y0=y,\n                    method='BDF',  # Suitable for stiff systems\n                    args=k_tuple,\n                    dense_output=False\n                )\n                \n                # Update state vector with the final concentrations\n                y = sol.y[:, -1]\n\n        # Calculate final active fraction phi\n        Di_f, Ds_f, X_f = y[0], y[1], y[2]\n        total_dopant = Di_f + Ds_f + X_f\n        \n        # Handle case where total_dopant is zero to avoid division by zero\n        phi = (Ds_f / total_dopant) if total_dopant > 0 else 0.0\n        final_phis.append(phi)\n\n    # Determine the optimal sequence (1-based index)\n    best_idx = np.argmax(final_phis) + 1\n\n    # Format the output string\n    phi_strings = [f\"{phi:.3f}\" for phi in final_phis]\n    output_list = phi_strings + [str(best_idx)]\n    \n    print(f\"[{','.join(output_list)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The final practice connects our kinetic models to the fundamental electrical properties of the semiconductor, answering the crucial \"so what?\" question. Here, the active dopant concentration determined from kinetics is used as the input to calculate the Fermi level position, the key parameter governing a material's conductivity. This comprehensive problem  will challenge you to integrate your knowledge of kinetics with advanced semiconductor physics, including Fermi-Dirac statistics and bandgap narrowing, to predict the ultimate electrical impact of a given dopant profile.",
            "id": "4121902",
            "problem": "You must write a complete, runnable program that, for each provided test case, computes the Fermi level position in heavily doped silicon by solving the charge neutrality condition including the effect of Bandgap Narrowing (BGN), when the activated dopant concentration is determined by dopant activation and deactivation kinetics. Start from first principles of semiconductor statistics and reaction kinetics. Derive the relevant relations from the following bases without using shortcut formulas: the parabolic band approximation for the Density of States (DOS), the Fermi–Dirac distribution, detailed balance defining carrier concentrations via integrals over DOS, charge neutrality, and first-order reversible reaction kinetics for dopant activation and deactivation. The program must numerically solve the implicit charge neutrality equation for the Fermi level and report its position relative to both band edges.\n\nUse Silicon with temperature-dependent bandgap modeled by the Varshni relation. Let the intrinsic bandgap be given by the Varshni parameters: $E_{g,0} = 1.17\\ \\mathrm{eV}$, $\\alpha = 4.73\\times 10^{-4}\\ \\mathrm{eV}\\,\\mathrm{K}^{-1}$, and $\\beta = 636\\ \\mathrm{K}$. The resulting bandgap at temperature $T$ is $$E_{g}(T) = E_{g,0} - \\alpha \\dfrac{T^{2}}{T + \\beta}.$$ Use the effective density of states at $T$ defined by $N_{C}(T) = N_{C,300}\\left(\\dfrac{T}{300\\ \\mathrm{K}}\\right)^{3/2}$ and $N_{V}(T) = N_{V,300}\\left(\\dfrac{T}{300\\ \\mathrm{K}}\\right)^{3/2}$, where $N_{C,300} = 2.8\\times 10^{19}\\ \\mathrm{cm}^{-3}$ and $N_{V,300} = 1.04\\times 10^{19}\\ \\mathrm{cm}^{-3}$. Treat carriers with Fermi–Dirac statistics by integrating the product of DOS and the Fermi–Dirac occupation over energy to obtain electron and hole concentrations. Do not assume the Maxwell–Boltzmann approximation. Model Bandgap Narrowing (BGN) as a symmetric shift of the conduction and valence band edges with a total narrowing $\\Delta E_{g}(N_{\\mathrm{act}})$ that depends on the activated dopant concentration $N_{\\mathrm{act}}$: let $$\\Delta E_{g}(N_{\\mathrm{act}}) = \\begin{cases}\\alpha_{\\mathrm{BGN}}\\ln\\left(\\dfrac{N_{\\mathrm{act}}}{N_{\\mathrm{ref}}}\\right), & N_{\\mathrm{act}} > N_{\\mathrm{ref}} \\\\ 0, & N_{\\mathrm{act}} \\le N_{\\mathrm{ref}}\\end{cases},$$ with $\\alpha_{\\mathrm{BGN}} = 1.74\\times 10^{-2}\\ \\mathrm{eV}$ and $N_{\\mathrm{ref}} = 1.0\\times 10^{17}\\ \\mathrm{cm}^{-3}$. Split $\\Delta E_{g}$ equally: the conduction band edge shifts down by $\\dfrac{\\Delta E_{g}}{2}$ and the valence band edge shifts up by $\\dfrac{\\Delta E_{g}}{2}$.\n\nFor dopant activation and deactivation kinetics, assume a single reversible first-order reaction between inactive dopant and active dopant. Let the total dopant concentration be $N_{\\mathrm{tot}}$ and the activated dopant concentration $N_{\\mathrm{act}}(t)$ follow $\\dfrac{d N_{\\mathrm{act}}}{dt} = k_{\\mathrm{act}}\\left(N_{\\mathrm{tot}} - N_{\\mathrm{act}}\\right) - k_{\\mathrm{deact}} N_{\\mathrm{act}}$, with $N_{\\mathrm{act}}(0) = 0$. Express $N_{\\mathrm{act}}(t)$ analytically, and use it in the charge neutrality condition. Include incomplete ionization of dopants with single-level donors and acceptors. For donors, the donor energy level is $E_{D} = E_{C} - \\Delta E_{D}$ and the ionized donor concentration is $N_{D}^{+} = \\dfrac{N_{D,\\mathrm{act}}}{1 + g_{D}\\exp\\left(\\dfrac{E_{F} - E_{D}}{k_{B}T}\\right)}$. For acceptors, the acceptor energy level is $E_{A} = E_{V} + \\Delta E_{A}$ and the ionized acceptor concentration is $N_{A}^{-} = \\dfrac{N_{A,\\mathrm{act}}}{1 + g_{A}\\exp\\left(\\dfrac{E_{A} - E_{F}}{k_{B}T}\\right)}$. Use Boltzmann constant $k_{B} = 8.617333262145\\times 10^{-5}\\ \\mathrm{eV}\\,\\mathrm{K}^{-1}$, donor degeneracy factor $g_{D} = 2$, acceptor degeneracy factor $g_{A} = 4$, donor binding offset $\\Delta E_{D} = 0.045\\ \\mathrm{eV}$, and acceptor binding offset $\\Delta E_{A} = 0.057\\ \\mathrm{eV}$.\n\nDefine electrons and holes via Fermi–Dirac integrals of order one-half. For electrons: $n = N_{C}(T)\\,F_{1/2}\\!\\left(\\eta_{n}\\right)$ with $\\eta_{n} = \\dfrac{E_{F} - E_{C}}{k_{B}T}$. For holes: $p = N_{V}(T)\\,F_{1/2}\\!\\left(\\eta_{p}\\right)$ with $\\eta_{p} = \\dfrac{E_{V} - E_{F}}{k_{B}T}$. Here $F_{1/2}(\\eta) = \\dfrac{2}{\\sqrt{\\pi}}\\int_{0}^{\\infty}\\dfrac{\\sqrt{\\epsilon}}{1 + \\exp(\\epsilon - \\eta)}\\,d\\epsilon$.\n\nImpose charge neutrality: $n - p + N_{A}^{-} - N_{D}^{+} = 0$. Solve for $E_{F}$ numerically for each test case. Report the quantities $E_{F} - E_{C}$ and $E_{V} - E_{F}$, both in $\\mathrm{eV}$, as floats.\n\nExpress all energies in $\\mathrm{eV}$, all concentrations in $\\mathrm{cm}^{-3}$, all temperatures in $\\mathrm{K}$, rate constants in $\\mathrm{s}^{-1}$, and time in $\\mathrm{s}$. The required final output is a single line with a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a two-element list: $[[x_1,y_1],[x_2,y_2],...]$. For example, the output format must be like $[[x_1,y_1],[x_2,y_2],...]$, with numeric values.\n\nTest Suite:\n- Case $1$ (moderate $n$-type, near room temperature, negligible BGN): $T = 300\\ \\mathrm{K}$, donors only with $N_{\\mathrm{D,tot}} = 1.0\\times 10^{17}\\ \\mathrm{cm}^{-3}$, $k_{\\mathrm{act}} = 1.0\\times 10^{2}\\ \\mathrm{s}^{-1}$, $k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$, anneal time $t = 60\\ \\mathrm{s}$, acceptors absent $N_{\\mathrm{A,tot}} = 0$.\n- Case $2$ (heavy $n$-type, significant BGN): $T = 300\\ \\mathrm{K}$, donors only with $N_{\\mathrm{D,tot}} = 1.0\\times 10^{20}\\ \\mathrm{cm}^{-3}$, $k_{\\mathrm{act}} = 1.0\\times 10^{1}\\ \\mathrm{s}^{-1}$, $k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$, $t = 120\\ \\mathrm{s}$, acceptors absent $N_{\\mathrm{A,tot}} = 0$.\n- Case $3$ (heavy $p$-type, significant BGN): $T = 300\\ \\mathrm{K}$, acceptors only with $N_{\\mathrm{A,tot}} = 5.0\\times 10^{19}\\ \\mathrm{cm}^{-3}$, $k_{\\mathrm{act}} = 5.0\\ \\mathrm{s}^{-1}$, $k_{\\mathrm{deact}} = 5.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$, $t = 180\\ \\mathrm{s}$, donors absent $N_{\\mathrm{D,tot}} = 0$.\n- Case $4$ (low $n$-type, boundary near intrinsic): $T = 300\\ \\mathrm{K}$, donors only with $N_{\\mathrm{D,tot}} = 1.0\\times 10^{14}\\ \\mathrm{cm}^{-3}$, $k_{\\mathrm{act}} = 1.0\\times 10^{2}\\ \\mathrm{s}^{-1}$, $k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$, $t = 10\\ \\mathrm{s}$, acceptors absent $N_{\\mathrm{A,tot}} = 0$.\n\nYour program must produce a single line containing $[[E_F - E_C,E_V - E_F]_1,[E_F - E_C,E_V - E_F]_2,[E_F - E_C,E_V - E_F]_3,[E_F - E_C,E_V - E_F]_4]$ with numeric floats in $\\mathrm{eV}$ for the four cases, in the exact order listed above.",
            "solution": "The problem is assessed to be valid. It is a well-posed, scientifically grounded problem in semiconductor physics that is self-contained and free of contradictions. The solution requires the numerical calculation of the Fermi level in silicon under various doping and annealing conditions, accounting for several physical effects.\n\nHerein, we derive the solution method from first principles as stipulated. The core of the problem is to solve the charge neutrality equation for the Fermi energy, $E_F$. This equation states that the total positive charge density must equal the total negative charge density. In a semiconductor doped with both donors and acceptors, this is expressed as:\n$$ p + N_{D}^{+} = n + N_{A}^{-} $$\nor, rearranged into a root-finding format, $Q(E_F) = 0$, where the net charge density function $Q(E_F)$ is:\n$$ Q(E_F) = n - p + N_{A}^{-} - N_{D}^{+} = 0 $$\nThe terms in this equation depend on the Fermi level $E_F$ and various material and environmental parameters. We will construct each term based on the provided physical models.\n\n### 1. Dopant Activation Kinetics\nThe concentration of electrically active dopants, $N_{\\mathrm{act}}$, is not equal to the total dopant concentration, $N_{\\mathrm{tot}}$. It is governed by a first-order reversible reaction. The rate of change of the activated dopant concentration is given by:\n$$ \\frac{d N_{\\mathrm{act}}}{dt} = k_{\\mathrm{act}}(N_{\\mathrm{tot}} - N_{\\mathrm{act}}) - k_{\\mathrm{deact}} N_{\\mathrm{act}} $$\nThis is a linear first-order ordinary differential equation. Rearranging, we get:\n$$ \\frac{d N_{\\mathrm{act}}}{dt} + (k_{\\mathrm{act}} + k_{\\mathrm{deact}}) N_{\\mathrm{act}} = k_{\\mathrm{act}} N_{\\mathrm{tot}} $$\nThe steady-state solution ($t \\to \\infty$, $\\frac{d N_{\\mathrm{act}}}{dt} = 0$) is found to be:\n$$ N_{\\mathrm{act,ss}} = N_{\\mathrm{tot}} \\frac{k_{\\mathrm{act}}}{k_{\\mathrm{act}} + k_{\\mathrm{deact}}} $$\nThe general solution to the ODE with the initial condition $N_{\\mathrm{act}}(0) = 0$ is:\n$$ N_{\\mathrm{act}}(t) = N_{\\mathrm{act,ss}} \\left(1 - e^{-(k_{\\mathrm{act}} + k_{\\mathrm{deact}})t}\\right) $$\nThis expression is used to calculate the activated donor concentration ($N_{D,\\mathrm{act}}$ from $N_{D,\\mathrm{tot}}$) and activated acceptor concentration ($N_{A,\\mathrm{act}}$ from $N_{A,\\mathrm{tot}}$) for each test case, given the annealing time $t$ and the respective rate constants.\n\n### 2. Physical Parameters and Bandgap Effects\nThe material properties of silicon depend on temperature ($T$) and doping levels.\nThe intrinsic bandgap, $E_g$, is a function of temperature, modeled by the Varshni relation:\n$$ E_{g}(T) = E_{g,0} - \\alpha \\frac{T^2}{T + \\beta} $$\nThe effective densities of states for the conduction band, $N_C$, and valence band, $N_V$, scale with temperature as:\n$$ N_{C}(T) = N_{C,300}\\left(\\frac{T}{300\\ \\mathrm{K}}\\right)^{3/2} \\quad \\text{and} \\quad N_{V}(T) = N_{V,300}\\left(\\frac{T}{300\\ \\mathrm{K}}\\right)^{3/2} $$\nAt high doping concentrations, interactions between charge carriers and ionized dopants cause Bandgap Narrowing (BGN), $\\Delta E_g$. This is modeled as a function of the total activated dopant concentration $N_{\\mathrm{act}} = N_{D,\\mathrm{act}} + N_{A,\\mathrm{act}}$:\n$$ \\Delta E_{g}(N_{\\mathrm{act}}) = \\begin{cases}\\alpha_{\\mathrm{BGN}}\\ln\\left(\\frac{N_{\\mathrm{act}}}{N_{\\mathrm{ref}}}\\right), & N_{\\mathrm{act}} > N_{\\mathrm{ref}} \\\\ 0, & N_{\\mathrm{act}} \\le N_{\\mathrm{ref}}\\end{cases} $$\nThis narrowing is applied symmetrically to the band edges. Let $E_{C,0}$ and $E_{V,0}$ be the unperturbed band edges, where $E_{C,0} - E_{V,0} = E_g(T)$. The new, narrowed band edges are:\n$$ E_C = E_{C,0} - \\frac{\\Delta E_g}{2} \\quad \\text{and} \\quad E_V = E_{V,0} + \\frac{\\Delta E_g}{2} $$\nThe dopant energy levels are tied to these band edges:\n$$ E_D = E_C - \\Delta E_D \\quad \\text{and} \\quad E_A = E_V + \\Delta E_A $$\n\n### 3. Charge Carrier and Ionized Dopant Concentrations\nThe concentrations of all charge carriers are functions of the Fermi level $E_F$. We must use Fermi-Dirac statistics as specified.\n\n**Electron and Hole Concentrations:**\nThe concentration of electrons ($n$) in the conduction band and holes ($p$) in the valence band are obtained by integrating the density of states (DOS) multiplied by the Fermi-Dirac distribution function over all available energy states. This integration leads to the standard expressions:\n$$ n = N_C(T) F_{1/2}\\left(\\frac{E_F - E_C}{k_B T}\\right) = N_C(T) F_{1/2}(\\eta_n) $$\n$$ p = N_V(T) F_{1/2}\\left(\\frac{E_V - E_F}{k_B T}\\right) = N_V(T) F_{1/2}(\\eta_p) $$\nwhere $k_B$ is the Boltzmann constant and $F_{1/2}(\\eta)$ is the Fermi-Dirac integral of order $1/2$, which must be computed numerically:\n$$ F_{1/2}(\\eta) = \\frac{2}{\\sqrt{\\pi}}\\int_{0}^{\\infty}\\frac{\\sqrt{\\epsilon}}{1 + \\exp(\\epsilon - \\eta)}\\,d\\epsilon $$\n\n**Ionized Dopant Concentrations:**\nDopants are not fully ionized, especially at high concentrations or low temperatures. The ionization probability depends on the Fermi level.\nThe concentration of ionized donors ($N_D^+$) and acceptors ($N_A^-$) are given by:\n$$ N_{D}^{+} = \\frac{N_{D,\\mathrm{act}}}{1 + g_{D}\\exp\\left(\\frac{E_{F} - E_{D}}{k_{B}T}\\right)} $$\n$$ N_{A}^{-} = \\frac{N_{A,\\mathrm{act}}}{1 + g_{A}\\exp\\left(\\frac{E_{A} - E_{F}}{k_{B}T}\\right)} $$\nwhere $g_D$ and $g_A$ are the ground-state degeneracy factors for the donor and acceptor levels, respectively.\n\n### 4. Numerical Solution\nBy substituting the expressions for $n$, $p$, $N_A^-$, and $N_D^+$ into the charge neutrality equation $Q(E_F) = 0$, we obtain a single, nonlinear, transcendental equation for the unknown $E_F$. The function $Q(E_F)$ is monotonic, increasing from a large negative value for $E_F \\ll E_V$ to a large positive value for $E_F \\gg E_C$. This guarantees a unique solution for $E_F$.\nThis equation is solved numerically for each test case using a robust root-finding algorithm, such as the Brent-Dekker method (`brentq`), which efficiently finds the root within a given bracket. A suitable bracket for $E_F$ can be established around the bandgap, for example, from a few $k_B T$ below $E_V$ to a few $k_B T$ above $E_C$.\n\nFor each test case, the procedure is as follows:\n1.  Calculate $N_{D,\\mathrm{act}}$ and $N_{A,\\mathrm{act}}$ from the kinetic model.\n2.  Determine $E_g(T)$, $N_C(T)$, and $N_V(T)$.\n3.  Calculate $\\Delta E_g$ and the resulting shifted band edges $E_C$ and $E_V$.\n4.  Construct the charge neutrality function $Q(E_F)$.\n5.  Numerically solve $Q(E_F) = 0$ to find $E_F$.\n6.  Report the final results as $E_F - E_C$ and $E_V - E_F$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.optimize import brentq\nimport math\n\ndef solve():\n    \"\"\"\n    Computes the Fermi level position in heavily doped silicon by solving the\n    charge neutrality condition, including effects of dopant activation kinetics and\n    bandgap narrowing.\n    \"\"\"\n    # Define physical and material constants from the problem statement\n    k_B = 8.617333262145e-5  # Boltzmann constant in eV/K\n    Eg0_Si = 1.17           # Si bandgap at 0K in eV\n    alpha_varshni = 4.73e-4 # Varshni parameter alpha in eV/K\n    beta_varshni = 636      # Varshni parameter beta in K\n    NC300_Si = 2.8e19       # Conduction band effective DOS at 300K in cm^-3\n    NV300_Si = 1.04e19      # Valence band effective DOS at 300K in cm^-3\n    alpha_bgn = 1.74e-2     # BGN parameter in eV\n    N_ref_bgn = 1.0e17      # BGN reference concentration in cm^-3\n    delta_ED = 0.045        # Donor ionization energy offset from Ec in eV\n    delta_EA = 0.057        # Acceptor ionization energy offset from Ev in eV\n    gD = 2                  # Donor degeneracy factor\n    gA = 4                  # Acceptor degeneracy factor\n\n    # A memoization cache for the Fermi-Dirac integral to speed up calculations\n    _memo_F12 = {}\n\n    def fermi_dirac_integral_half(eta):\n        \"\"\"\n        Computes the Fermi-Dirac integral of order 1/2, F_{1/2}(eta).\n        Uses asymptotic approximations for large |eta| for numerical stability and speed.\n        \"\"\"\n        if eta in _memo_F12:\n            return _memo_F12[eta]\n\n        if eta > 50:\n            # Asymptotic expansion for large positive eta (degenerate limit)\n            res = (4 / (3 * np.sqrt(np.pi))) * eta**1.5\n        elif eta < -20:\n            # Boltzmann approximation for large negative eta\n            res = np.exp(eta)\n        else:\n            # Direct numerical integration for intermediate values\n            integrand = lambda E: np.sqrt(E) / (1 + np.exp(E - eta))\n            integral_val, _ = quad(integrand, 0, np.inf)\n            res = (2 / np.sqrt(np.pi)) * integral_val\n        \n        _memo_F12[eta] = res\n        return res\n\n    def solve_case(params):\n        \"\"\"\n        Solves for the Fermi level for a single test case.\n        \"\"\"\n        T, ND_tot, NA_tot, k_act, k_deact, t = params\n        _memo_F12.clear()\n\n        # 1. Dopant Activation Kinetics\n        k_sum = k_act + k_deact\n        \n        ND_act = 0\n        if ND_tot > 0 and k_sum > 1e-9: # Avoid division by zero if rates are zero\n            ND_act_ss = ND_tot * (k_act / k_sum)\n            ND_act = ND_act_ss * (1 - np.exp(-k_sum * t))\n        \n        NA_act = 0\n        if NA_tot > 0 and k_sum > 1e-9:\n            NA_act_ss = NA_tot * (k_act / k_sum)\n            NA_act = NA_act_ss * (1 - np.exp(-k_sum * t))\n\n        N_act_total = ND_act + NA_act\n\n        # 2. Temperature-dependent and BGN-dependent parameters\n        kT = k_B * T\n        Eg_T = Eg0_Si - (alpha_varshni * T**2) / (T + beta_varshni)\n        NC_T = NC300_Si * (T / 300)**1.5\n        NV_T = NV300_Si * (T / 300)**1.5\n\n        delta_Eg = 0\n        if N_act_total > N_ref_bgn:\n            delta_Eg = alpha_bgn * np.log(N_act_total / N_ref_bgn)\n        \n        # Set reference energy (EV0 = 0) and find shifted band edges\n        EV0 = 0.0\n        EC0 = Eg_T\n        EV = EV0 + delta_Eg / 2\n        EC = EC0 - delta_Eg / 2\n        \n        # Dopant energy levels\n        ED = EC - delta_ED\n        EA = EV + delta_EA\n\n        # 3. Define the charge neutrality equation Q(EF) = n - p + NA_minus - ND_plus = 0\n        def charge_balance_equation(EF):\n            eta_n = (EF - EC) / kT\n            n = NC_T * fermi_dirac_integral_half(eta_n)\n            \n            eta_p = (EV - EF) / kT\n            p = NV_T * fermi_dirac_integral_half(eta_p)\n            \n            NA_minus = 0\n            if NA_act > 0:\n                 NA_minus = NA_act / (1 + gA * np.exp((EA - EF) / kT))\n            \n            ND_plus = 0\n            if ND_act > 0:\n                ND_plus = ND_act / (1 + gD * np.exp((EF - ED) / kT))\n                \n            return n - p + NA_minus - ND_plus\n\n        # 4. Numerically solve for the Fermi level EF using a bracketing root-finder\n        search_bracket_low = EV - 20 * kT\n        search_bracket_high = EC + 20 * kT\n        \n        try:\n            EF_solution = brentq(charge_balance_equation, search_bracket_low, search_bracket_high, xtol=1e-15, rtol=1e-15)\n        except ValueError:\n            return [math.nan, math.nan]\n\n        # 5. Calculate final quantities\n        EF_minus_EC = EF_solution - EC\n        EV_minus_EF = EV - EF_solution\n        \n        return [EF_minus_EC, EV_minus_EF]\n\n    test_cases = [\n        # T (K), N_D_tot (cm^-3), N_A_tot (cm^-3), k_act (s^-1), k_deact (s^-1), t (s)\n        (300, 1.0e17, 0, 1.0e2, 1.0e-1, 60),  # Case 1\n        (300, 1.0e20, 0, 1.0e1, 1.0e-1, 120), # Case 2\n        (300, 0, 5.0e19, 5.0, 5.0e-1, 180),   # Case 3\n        (300, 1.0e14, 0, 1.0e2, 1.0e-1, 10),  # Case 4\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(case_params)\n        results.append(result)\n\n    # Format the output exactly as specified: [[x1,y1],[x2,y2],...]\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}