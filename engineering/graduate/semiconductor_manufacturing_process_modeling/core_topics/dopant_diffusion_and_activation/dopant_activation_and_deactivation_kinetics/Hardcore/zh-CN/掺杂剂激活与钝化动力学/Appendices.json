{
    "hands_on_practices": [
        {
            "introduction": "我们将从一个基本的双态可逆反应模型开始，这是理解更复杂动力学系统的基石。此练习旨在帮助您掌握在非等温条件下（例如在快速热处理中常见的温度随时间变化的斜坡升温和保温过程）建立并数值求解动力学常微分方程的方法 ()。通过这个实践，您将学会如何运用阿伦尼乌斯定律来描述速率常数与温度的依赖关系，并预测在特定退火工艺下活性掺杂浓度的演变。",
            "id": "4121849",
            "problem": "考虑在热处理过程中，半导体中的一个双态掺杂系统。令 $x(t)$ 表示在时间 $t$ 时电激活掺杂剂的分数，而 $1 - x(t)$ 表示处于非激活态的分数。假设在非激活态和激活态之间存在一级可逆动力学，其速率常数依赖于温度。激活速率常数 $k_a(T)$ 和去激活速率常数 $k_d(T)$ 遵循阿伦尼乌斯定律，具有各自的指前因子和活化能。具体来说，对于任意温度 $T$，速率常数由 $k_a(T)$ 和 $k_d(T)$ 给出，每个常数都与 $T$ 呈标准的阿伦尼乌斯依赖关系，其中能量以电子伏特表示，玻尔兹曼常数（记作 $k_B$）以电子伏特每开尔文表示。\n\n从质量作用动力学和速率常数的阿伦尼乌斯温度依赖性出发，推导在一般的非等温温度历史 $T(t)$ 下 $x(t)$ 的控制方程。然后，对于一个由线性升温和恒温保持组成的温度曲线，\n- 当 $0 \\le t \\le t_{\\mathrm{ramp}}$ 且 $t_{\\mathrm{ramp}} = (T_1 - T_0)/\\beta$ 时，令 $T(t) = T_0 + \\beta t$；\n- 当 $t_{\\mathrm{ramp}} < t \\le t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$ 时，令 $T(t) = T_1$，\n计算在 $t_{\\mathrm{final}} = t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$ 时的最终激活分数 $x(t_{\\mathrm{final}})$。\n\n所有能量单位必须是电子伏特，所有温度单位是开尔文，时间单位是秒，升温速率单位是开尔文每秒。使用 $k_B = 8.617333262145 \\times 10^{-5}$ 电子伏特每开尔文。量 $x(t)$ 是无量纲的。\n\n您的程序必须对下述每个测试场景随时间数值评估 $x(t)$，并为每个案例返回最终值 $x(t_{\\mathrm{final}})$。每个案例的数值答案必须四舍五入到六位小数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3]”）。\n\n测试套件（每个案例为 $(T_0, T_1, \\beta, t_{\\mathrm{hold}}, A_a, E_a, A_d, E_d, x(0))$，其中 $A_a$ 和 $A_d$ 为指前因子，单位为 $\\mathrm{s}^{-1}$；$E_a$ 和 $E_d$ 为活化能，单位为电子伏特；$\\beta$ 为升温速率，单位为 $\\mathrm{K/s}$；$T_0$ 和 $T_1$ 的单位为 $\\mathrm{K}$；$t_{\\mathrm{hold}}$ 的单位为 $\\mathrm{s}$；$x(0)$ 为无量纲）：\n\n- 案例1（通用激活主导的非等温退火）： $(900,\\;1050,\\;10,\\;60,\\;10^9,\\;1.5,\\;5\\times 10^7,\\;2.5,\\;0.0)$。\n- 案例2（快速升温并短暂保持）： $(900,\\;1050,\\;100,\\;5,\\;10^9,\\;1.5,\\;5\\times 10^7,\\;2.5,\\;0.0)$。\n- 案例3（从完全激活初始状态的去激活）： $(1100,\\;1200,\\;20,\\;120,\\;0.0,\\;1.0,\\;10^9,\\;2.0,\\;1.0)$。\n- 案例4（作为边界情况的等温保持）： $(1000,\\;1000,\\;10,\\;30,\\;5\\times 10^8,\\;1.6,\\;2\\times 10^7,\\;2.4,\\;0.2)$。\n\n您的程序必须使用依赖于温度的速率来实现动力学，并按上述指定的确切格式生成最终输出。输出为浮点数，四舍五入到六位小数，无量纲。",
            "solution": "该问题要求在非等温热处理过程中，为半导体中的掺杂剂激活建立动力学模型，并进行推导和数值求解。对问题陈述的验证证实了其科学基础扎实、问题定义明确，并包含了进行求解所需的所有信息。\n\n首先，我们从第一性原理出发，建立控制微分方程。该系统包含掺杂原子的两种状态：激活态和非激活态。令 $x(t)$ 为在时间 $t$ 处于激活态的掺杂剂分数。因此，处于非激活态的分数是 $1 - x(t)$。掺杂剂的总浓度 $C_{total}$ 是恒定的。激活掺杂剂的浓度为 $C_a(t) = x(t) C_{total}$，非激活掺杂剂的浓度为 $C_i(t) = (1-x(t))C_{total}$。\n\n问题陈述指出，这些状态之间的转换遵循一级可逆动力学：\n$$\n\\text{非激活态} \\underset{k_d}{\\stackrel{k_a}{\\rightleftharpoons}} \\text{激活态}\n$$\n这里，$k_a$ 是激活反应（非激活态 $\\rightarrow$ 激活态）的速率常数，$k_d$ 是去激活反应（激活态 $\\rightarrow$ 非激活态）的速率常数。\n\n根据质量作用定律，激活掺杂剂浓度的变化率 $\\frac{dC_a}{dt}$ 由从非激活态生成的速率减去损失到非激活态的速率给出：\n$$\n\\frac{dC_a}{dt} = k_a C_i - k_d C_a\n$$\n将 $C_a$ 和 $C_i$ 的表达式用激活分数 $x(t)$ 代入：\n$$\n\\frac{d(x(t) C_{total})}{dt} = k_a(T(t)) (1 - x(t)) C_{total} - k_d(T(t)) x(t) C_{total}\n$$\n由于 $C_{total}$ 是一个常数，导数得以简化，我们可以将整个方程除以 $C_{total}$：\n$$\n\\frac{dx}{dt} = k_a(T(t)) (1 - x(t)) - k_d(T(t)) x(t)\n$$\n这就是关于激活掺杂分数 $x(t)$ 的一阶常微分方程（ODE）控制方程。速率常数 $k_a$ 和 $k_d$ 依赖于温度，因此通过温度历史 $T(t)$ 也依赖于时间。\n\n速率常数的温度依赖性由阿伦尼乌斯方程描述：\n$$\nk_a(T) = A_a \\exp\\left(-\\frac{E_a}{k_B T}\\right)\n$$\n$$\nk_d(T) = A_d \\exp\\left(-\\frac{E_d}{k_B T}\\right)\n$$\n其中 $A_a$ 和 $A_d$ 是指前因子（单位为 $\\mathrm{s}^{-1}$），$E_a$ 和 $E_d$ 是活化能（单位为电子伏特，eV），$k_B$ 是玻尔兹曼常数，其值为 $8.617333262145 \\times 10^{-5} \\, \\mathrm{eV} \\cdot \\mathrm{K}^{-1}$。\n\n温度曲线 $T(t)$ 被指定为一个两阶段过程：一个线性升温，然后是一个等温保持。\n对于升温阶段，其中 $0 \\le t \\le t_{\\mathrm{ramp}}$：\n$$\nT(t) = T_0 + \\beta t\n$$\n对于保持阶段，其中 $t_{\\mathrm{ramp}} < t \\le t_{\\mathrm{final}}$：\n$$\nT(t) = T_1\n$$\n升温持续时间为 $t_{\\mathrm{ramp}} = (T_1 - T_0)/\\beta$，总处理时间为 $t_{\\mathrm{final}} = t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$。请注意，对于 $T_0 = T_1$ 的等温过程，$t_{\\mathrm{ramp}}$ 的计算结果正确地为 $0$ 秒。\n\n该控制常微分方程可以表示为标准线性形式 $\\frac{dx}{dt} + P(t)x = Q(t)$：\n$$\n\\frac{dx}{dt} + [k_a(T(t)) + k_d(T(t))] x(t) = k_a(T(t))\n$$\n因为在升温阶段温度 $T(t)$ 不是恒定的，所以该常微分方程的系数 $P(t) = k_a(T(t)) + k_d(T(t))$ 和 $Q(t) = k_a(T(t))$ 是时间的显式函数。这使得该常微分方程成为非自治的，通常无法得到解析解。因此，需要采用数值方法。\n\n该问题被构建为一个初值问题（IVP），其中包含常微分方程 $\\frac{dx}{dt} = f(t, x)$ 和为每个案例提供的初始条件 $x(0) = x_0$。我们将在时间区间 $[0, t_{\\mathrm{final}}]$ 上数值求解这个初值问题。SciPy 库中的 `scipy.integrate.solve_ivp` 函数是实现此目的的强大工具。它实现了多种自适应步长算法，适用于刚性和非刚性常微分方程。化学动力学问题通常是刚性的，因此建议使用像 'Radau' 或 'BDF' 这样的方法以确保稳定性和准确性。\n\n计算步骤如下：\n1. 对于每个测试案例，提取所有参数： $(T_0, T_1, \\beta, t_{\\mathrm{hold}}, A_a, E_a, A_d, E_d, x(0))$。\n2. 定义一个函数，例如 `dxdt(t, y, params)`，用于计算常微分方程的右侧。该函数将：\n   a. 解包参数。\n   b. 根据 $T(t)$ 的分段定义，确定当前时间 $t$ 的温度 $T$。\n   c. 使用阿伦尼乌斯方程计算 $k_a(T)$ 和 $k_d(T)$。\n   d. 返回 $\\frac{dx}{dt} = k_a (1 - x) - k_d x$ 的值。请注意，`solve_ivp` 期望状态变量 `y` 是一个数组，所以我们使用 `x = y[0]`。\n3. 将积分的时间跨度设置为 $[0, t_{\\mathrm{final}}]$，并将初始条件设置为 $[x(0)]$。\n4. 使用第2步中的函数、时间跨度、初始条件和参数调用 `solve_ivp`。\n5. 来自 `solve_ivp` 的结果对象将包含在不同时间点的解。最终的激活分数 $x(t_{\\mathrm{final}})$ 是解数组中的最后一个值，即 `sol.y[0, -1]`。\n6. 按要求将此最终值四舍五入到六位小数。\n7. 对所有测试案例重复此过程，并将结果汇总成指定的输出格式。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the dopant activation kinetics ODE for a set of test cases.\n    \"\"\"\n    \n    # Constants\n    K_B = 8.617333262145e-5  # Boltzmann constant in eV/K\n\n    # Test suite: (T0, T1, beta, t_hold, Aa, Ea, Ad, Ed, x0)\n    test_cases = [\n        (900.0, 1050.0, 10.0, 60.0, 1e9, 1.5, 5e7, 2.5, 0.0),\n        (900.0, 1050.0, 100.0, 5.0, 1e9, 1.5, 5e7, 2.5, 0.0),\n        (1100.0, 1200.0, 20.0, 120.0, 0.0, 1.0, 1e9, 2.0, 1.0),\n        (1000.0, 1000.0, 10.0, 30.0, 5e8, 1.6, 2e7, 2.4, 0.2),\n    ]\n\n    results = []\n\n    def dxdt(t, y, T0, T1, beta, t_ramp, Aa, Ea, Ad, Ed):\n        \"\"\"\n        RHS of the ODE dx/dt for the active dopant fraction x.\n        \"\"\"\n        x = y[0]\n\n        # Determine temperature T at time t\n        if t = t_ramp:\n            T = T0 + beta * t\n        else:\n            T = T1\n        \n        # Prevent division by zero if T is ever 0, though not expected here\n        if T == 0:\n            return [0.0]\n\n        # Calculate Arrhenius rate constants\n        # Aa = 0 implies ka = 0, exp can be avoided\n        k_a = Aa * np.exp(-Ea / (K_B * T)) if Aa > 0.0 else 0.0\n        # Ad = 0 implies kd = 0\n        k_d = Ad * np.exp(-Ed / (K_B * T)) if Ad > 0.0 else 0.0\n\n        # Return rate of change of active fraction\n        return [k_a * (1 - x) - k_d * x]\n\n    for case in test_cases:\n        T0, T1, beta, t_hold, Aa, Ea, Ad, Ed, x0 = case\n\n        # Calculate time for the temperature ramp\n        # If beta is zero, but T0 != T1, t_ramp would be infinite, but problem spec avoids this.\n        # If T0 == T1, it's an isothermal case, and t_ramp is correctly 0.\n        if beta > 0:\n            t_ramp = (T1 - T0) / beta\n        else:\n            t_ramp = 0.0\n\n        t_final = t_ramp + t_hold\n        \n        # Ensure t_final is non-zero to avoid integration errors\n        if t_final == 0:\n            results.append(round(x0, 6))\n            continue\n\n        # Set up parameters for the ODE solver\n        params = (T0, T1, beta, t_ramp, Aa, Ea, Ad, Ed)\n        \n        # Initial condition\n        y0 = [x0]\n        \n        # Time span for integration\n        t_span = [0, t_final]\n\n        # Solve the ODE. 'Radau' is a good choice for potentially stiff problems\n        # like chemical kinetics.\n        sol = solve_ivp(\n            dxdt,\n            t_span,\n            y0,\n            args=params,\n            method='Radau',\n            dense_output=True\n        )\n\n        # The solution at the final time point\n        x_final = sol.sol(t_final)[0]\n        \n        # Append the rounded result\n        results.append(round(x_final, 6))\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现实中的半导体制造工艺远比单一的退火步骤复杂，通常涉及离子注入引入的掺杂原子和点缺陷（间隙原子、空位）之间的多物种相互作用。本练习将挑战您为一个包含多次注入和退火步骤的完整工艺流程建立模型，并求解一个耦合的刚性常微分方程组 ()。这个实践的核心目标是让您理解不同工艺步骤之间的相互影响，并学会如何运用动力学仿真来优化制造流程，以实现最高的掺杂激活效率。",
            "id": "4121922",
            "problem": "考虑一个描述半导体制造过程中晶体硅中掺杂剂激活与失活的反应网络。多个离子注入步骤引入了掺杂原子和点缺陷，随后在指定温度下进行热退火。您的任务是推导、实现并求解一个具有阿伦尼乌斯温度依赖性的质量作用动力学模型，以预测最终的电活性掺杂剂比例，并利用此预测确定所提供序列中注入和退火的最佳顺序。\n\n基本原理与假设：\n- 对于物种之间的反应，使用化学动力学的质量作用定律。如果 $A$ 和 $B$ 反应生成 $C$，双分子速率常数为 $k$，则正向反应速率为 $r = k [A][B]$。\n- 对于速率常数的温度依赖性，使用阿伦尼乌斯定律，$k(T) = k_0 \\exp\\!\\left(-\\dfrac{E_a}{k_B T}\\right)$，其中 $k_0$ 是指前因子，$E_a$ 是活化能，$k_B$ 是玻尔兹曼常数，$T$ 是绝对温度。\n- 忽略空间梯度和扩散；在充分混合的体积元中建模，以便所有物种都由密度表示，单位为 $\\text{cm}^{-3}$。\n\n物种：\n- $D_i$：间隙掺杂剂密度（非活性），单位 $\\text{cm}^{-3}$。\n- $D_s$：替代位掺杂剂密度（活性），单位 $\\text{cm}^{-3}$。\n- $X$：掺杂剂-间隙原子复合物密度（非活性团簇），单位 $\\text{cm}^{-3}$。\n- $I$：自间隙原子密度，单位 $\\text{cm}^{-3}$。\n- $V$：空位密度，单位 $\\text{cm}^{-3}$。\n\n反应：\n- 间隙机制激活及其逆反应：\n  $$D_i + I \\xrightarrow{k_1(T)} D_s,\\quad D_s \\xrightarrow{k_{1r}(T)} D_i + I.$$\n- 通过形成复合物失活及其逆反应：\n  $$D_s + I \\xrightarrow{k_2(T)} X,\\quad X \\xrightarrow{k_{2r}(T)} D_s + I.$$\n- 间隙原子-空位复合：\n  $$I + V \\xrightarrow{k_3(T)} \\varnothing.$$\n\n写出质量作用常微分方程（将在您的解法中推导）：\n- $\\dfrac{d D_i}{d t}$、$\\dfrac{d D_s}{d t}$、$\\dfrac{d X}{d t}$、$\\dfrac{d I}{d t}$、$\\dfrac{d V}{d t}$ 作为反应速率的函数。\n\n温度依赖性：\n- 使用 $k_B = 8.617\\times 10^{-5}\\,\\text{eV/K}$。\n- 阿伦尼乌斯指前因子和活化能的参数如下（选择的参数在科学上是合理的，并且是自洽的）：\n  - $k_1$：$k_{1,0} = 1.0\\times 10^{-13}\\,\\text{cm}^3/\\text{s}$，$E_{a,1} = 0.80\\,\\text{eV}$。\n  - $k_{1r}$：$k_{1r,0} = 1.0\\times 10^{4}\\,\\text{s}^{-1}$，$E_{a,1r} = 2.20\\,\\text{eV}$。\n  - $k_2$：$k_{2,0} = 5.0\\times 10^{-14}\\,\\text{cm}^3/\\text{s}$，$E_{a,2} = 1.20\\,\\text{eV}$。\n  - $k_{2r}$：$k_{2r,0} = 5.0\\times 10^{2}\\,\\text{s}^{-1}$，$E_{a,2r} = 2.60\\,\\text{eV}$。\n  - $k_3$：$k_{3,0} = 2.0\\times 10^{-12}\\,\\text{cm}^3/\\text{s}$，$E_{a,3} = 0.50\\,\\text{eV}$。\n\n注入步骤：\n- 剂量为 $D$ 的注入会立即将 $D_i$ 增加 $f_i D$，将 $D_s$ 增加 $(1 - f_i) D$，并将点缺陷增加为 $I \\leftarrow I + \\alpha_I D$，$V \\leftarrow V + \\alpha_V D$，其中 $f_i$ 是初始时处于间隙位置的掺杂剂比例，$\\alpha_I$ 和 $\\alpha_V$ 代表每个掺杂原子产生的损伤。这些是瞬时变化，没有时间演化过程。\n\n退火步骤：\n- 在温度 $T$ 下持续时间为 $\\tau$ 的退火过程中，系统在恒定温度 $T$ 下，在 $t \\in [0,\\tau]$ 时间内根据动力学常微分方程演化，初始条件由退火步骤之前的状态设定。\n\n目标：\n- 对于每个工艺序列，计算最终的活性比例，定义为\n  $$\\phi = \\frac{D_s}{D_i + D_s + X},$$\n  在序列结束时计算该值。此外，计算在所提供的序列中使 $\\phi$ 最大化的最佳序列索引，使用从 1 开始的索引，并通过选择最小的索引来解决平局问题。\n\n单位和输出：\n- 所有密度必须以 $\\text{cm}^{-3}$ 处理，温度以 $\\text{K}$ 处理，持续时间以 $\\text{s}$ 处理。\n- 将每个活性比例 $\\phi$ 表示为四舍五入到三位小数的小数。\n- 您的程序应生成单行输出，其中包含结果，格式为方括号内的逗号分隔列表，顺序为 $[\\phi_1,\\phi_2,\\phi_3,\\text{best}]$，其中 $\\phi_i$ 是三个测试序列的最终活性比例，$\\text{best}$ 是最佳序列索引（一个整数）。\n\n测试套件（三个序列）：\n- 序列 1（分阶段激活）：\n  - 初始缺陷：$I_0 = 0\\,\\text{cm}^{-3}$，$V_0 = 0\\,\\text{cm}^{-3}$。\n  - 步骤 1：注入，剂量 $3.0\\times 10^{19}\\,\\text{cm}^{-3}$，$f_i = 0.95$，$\\alpha_I = 0.20$，$\\alpha_V = 0.20$。\n  - 步骤 2：退火，$T = 1173\\,\\text{K}$，持续时间 $\\tau = 600\\,\\text{s}$。\n  - 步骤 3：注入，剂量 $2.0\\times 10^{19}\\,\\text{cm}^{-3}$，$f_i = 0.95$，$\\alpha_I = 0.20$，$\\alpha_V = 0.20$。\n  - 步骤 4：退火，$T = 1273\\,\\text{K}$，持续时间 $\\tau = 120\\,\\text{s}$。\n- 序列 2（背靠背注入后长时退火）：\n  - 初始缺陷：$I_0 = 0\\,\\text{cm}^{-3}$，$V_0 = 0\\,\\text{cm}^{-3}$。\n  - 步骤 1：注入，剂量 $3.0\\times 10^{19}\\,\\text{cm}^{-3}$，$f_i = 0.95$，$\\alpha_I = 0.20$，$\\alpha_V = 0.20$。\n  - 步骤 2：注入，剂量 $2.0\\times 10^{19}\\,\\text{cm}^{-3}$，$f_i = 0.95$，$\\alpha_I = 0.20$，$\\alpha_V = 0.20$。\n  - 步骤 3：退火，$T = 1223\\,\\text{K}$，持续时间 $\\tau = 900\\,\\text{s}$。\n- 序列 3（初始缺陷及混合尖峰/恒温退火）：\n  - 初始缺陷：$I_0 = 5.0\\times 10^{18}\\,\\text{cm}^{-3}$，$V_0 = 5.0\\times 10^{18}\\,\\text{cm}^{-3}$。\n  - 步骤 1：注入，剂量 $3.0\\times 10^{19}\\,\\text{cm}^{-3}$，$f_i = 0.95$，$\\alpha_I = 0.20$，$\\alpha_V = 0.20$。\n  - 步骤 2：退火，$T = 1173\\,\\text{K}$，持续时间 $\\tau = 60\\,\\text{s}$。\n  - 步骤 3：注入，剂量 $2.0\\times 10^{19}\\,\\text{cm}^{-3}$，$f_i = 0.95$，$\\alpha_I = 0.20$，$\\alpha_V = 0.20$。\n  - 步骤 4：退火，$T = 1373\\,\\text{K}$，持续时间 $\\tau = 30\\,\\text{s}$。\n\n实现要求：\n- 对每个退火步骤，使用适合刚性系统的数值方法求解常微分方程。\n- 将所有提供的测试序列的结果汇总成所需的单行输出格式。",
            "solution": "该问题要求建立并数值求解一个质量作用动力学模型，以模拟离子注入和热退火序列中硅内掺杂剂的激活和失活过程。目标是确定几个工艺序列的最终电活性掺杂剂比例，并找出使该比例最大化的最佳序列。\n\n该模型基于一个耦合常微分方程组（ODEs），该方程组描述了在充分混合的体积元内各物种浓度随时间的演化。浓度的空间依赖性被忽略。\n\n反应网络中涉及的物种有：\n- $D_i$：间隙掺杂剂浓度（非活性），单位为 $\\text{cm}^{-3}$。\n- $D_s$：替代位掺杂剂浓度（电活性），单位为 $\\text{cm}^{-3}$。\n- $X$：掺杂剂-间隙原子复合物浓度（非活性），单位为 $\\text{cm}^{-3}$。\n- $I$：自间隙点缺陷浓度，单位为 $\\text{cm}^{-3}$。\n- $V$：空位点缺陷浓度，单位为 $\\text{cm}^{-3}$。\n\n在任何时间 $t$，系统的状态由浓度向量 $y(t) = ([D_i], [D_s], [X], [I], [V])$ 描述。\n\n控制系统动力学的反应如下：\n1. 间隙机制激活/失活：$D_i + I \\rightleftharpoons_{k_{1r}(T)}^{k_1(T)} D_s$\n2. 复合物形成/分解：$D_s + I \\rightleftharpoons_{k_{2r}(T)}^{k_2(T)} X$\n3. 间隙原子-空位复合：$I + V \\xrightarrow{k_3(T)} \\varnothing$（湮灭）\n\n根据质量作用定律，这些反应的速率由以下公式给出：\n- $R_1 = k_1(T) [D_i] [I]$\n- $R_{1r} = k_{1r}(T) [D_s]$\n- $R_2 = k_2(T) [D_s] [I]$\n- $R_{2r} = k_{2r}(T) [X]$\n- $R_3 = k_3(T) [I] [V]$\n\n根据这些速率，我们可以推导出描述每种物种浓度变化率的常微分方程组。每种物种的变化率是产生它的反应速率之和，减去消耗它的反应速率之和。\n\n得到的五个耦合一阶常微分方程组是：\n$$ \\frac{d[D_i]}{dt} = -R_1 + R_{1r} = -k_1 [D_i][I] + k_{1r} [D_s] $$\n$$ \\frac{d[D_s]}{dt} = R_1 - R_{1r} - R_2 + R_{2r} = k_1 [D_i][I] - k_{1r} [D_s] - k_2 [D_s][I] + k_{2r} [X] $$\n$$ \\frac{d[X]}{dt} = R_2 - R_{2r} = k_2 [D_s][I] - k_{2r} [X] $$\n$$ \\frac{d[I]}{dt} = -R_1 + R_{1r} - R_2 + R_{2r} - R_3 = -k_1 [D_i][I] + k_{1r} [D_s] - k_2 [D_s][I] + k_{2r} [X] - k_3 [I][V] $$\n$$ \\frac{d[V]}{dt} = -R_3 = -k_3 [I][V] $$\n\n一个关键的一致性检查是验证退火过程中总掺杂原子数的守恒。总掺杂浓度为 $D_{tot} = [D_i] + [D_s] + [X]$。其时间导数为 $\\frac{dD_{tot}}{dt} = \\frac{d[D_i]}{dt} + \\frac{d[D_s]}{dt} + \\frac{d[X]}{dt}$。将推导出的常微分方程相加，所有项都抵消了，得到 $\\frac{dD_{tot}}{dt} = 0$，这证实了总掺杂浓度在热退火期间是一个守恒量，符合预期。\n\n速率常数 $k_j$ 的温度依赖性由阿伦尼乌斯方程给出：\n$$ k_j(T) = k_{j,0} \\exp\\left(-\\frac{E_{a,j}}{k_B T}\\right) $$\n其中 $k_{j,0}$ 是指前因子，$E_{a,j}$ 是反应 $j$ 的活化能，$T$ 是绝对温度（单位为开尔文），$k_B$ 是玻尔兹曼常数，给定为 $8.617 \\times 10^{-5}\\,\\text{eV/K}$。每个反应的具体参数在问题描述中提供。\n\n模拟通过对每个给定序列的步骤进行顺序处理来进行：\n1.  **注入步骤：** 这被建模为浓度的瞬时变化。对于剂量为 $D$，间隙分数为 $f_i$，损伤因子为 $\\alpha_I$ 和 $\\alpha_V$ 的注入，状态向量更新如下：\n    - $[D_i] \\leftarrow [D_i] + f_i D$\n    - $[D_s] \\leftarrow [D_s] + (1 - f_i) D$\n    - $[I] \\leftarrow [I] + \\alpha_I D$\n    - $[V] \\leftarrow [V] + \\alpha_V D$\n2.  **退火步骤：** 此步骤涉及在恒定温度 $T$ 下，在时间区间 $[0, \\tau]$ 内求解常微分方程组。首先，为指定温度 $T$ 计算速率常数 $k_j(T)$。然后，使用数值常微分方程求解器来积分该系统。由于这类动力学系统中可能存在宽范围的时间尺度，它们通常是刚性的。因此，需要一个适合刚性问题的数值方法，例如后向差分公式（Backward Differentiation Formula, BDF）。积分的初始条件是上一步结束时的状态向量。求解器得到的最终状态向量成为下一步的初始状态。\n\n在序列中的所有步骤完成后，使用最终浓度计算最终的活性掺杂剂比例 $\\phi$：\n$$ \\phi = \\frac{[D_s]_{final}}{[D_i]_{final} + [D_s]_{final} + [X]_{final}} $$\n\n对三个测试序列中的每一个都重复此过程。最后，将产生最高 $\\phi$ 值的序列确定为最佳序列。然后按要求格式化结果。\n\n实现将利用 `scipy.integrate.solve_ivp` 函数，并使用 `method='BDF'` 选项来处理退火步骤中的刚性常微分方程组。系统状态将使用一个 NumPy 数组进行跟踪，该数组将在每个注入和退火步骤后更新。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the dopant activation/deactivation kinetics problem for three\n    different process sequences.\n    \"\"\"\n\n    # --- Constants and Parameters ---\n    KB = 8.617e-5  # Boltzmann constant in eV/K\n\n    # Arrhenius parameters: (k_0, E_a)\n    # k_0 units: cm^3/s for bimolecular, 1/s for unimolecular\n    # E_a units: eV\n    PARAMS = {\n        'k1': (1.0e-13, 0.80),\n        'k1r': (1.0e4, 2.20),\n        'k2': (5.0e-14, 1.20),\n        'k2r': (5.0e2, 2.60),\n        'k3': (2.0e-12, 0.50),\n    }\n\n    # --- Test Sequences Definition ---\n    # Structure: list of sequences, where each sequence is a list of steps.\n    # Each step is a dictionary defining its type and parameters.\n    # Species order in state vector: [Di, Ds, X, I, V]\n    \n    sequences = [\n        # Sequence 1\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1173, 'tau': 600},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1273, 'tau': 120}\n        ],\n        # Sequence 2\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1223, 'tau': 900}\n        ],\n        # Sequence 3\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1173, 'tau': 60},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1373, 'tau': 30}\n        ]\n    ]\n\n    initial_conditions = [\n        np.array([0.0, 0.0, 0.0, 0.0, 0.0]), # Seq 1: Di, Ds, X, I, V\n        np.array([0.0, 0.0, 0.0, 0.0, 0.0]), # Seq 2\n        np.array([0.0, 0.0, 0.0, 5.0e18, 5.0e18]) # Seq 3\n    ]\n\n    def get_rate_constants(T):\n        \"\"\"Calculates Arrhenius rate constants for a given temperature T.\"\"\"\n        k = {}\n        for key, (k0, Ea) in PARAMS.items():\n            k[key] = k0 * np.exp(-Ea / (KB * T))\n        return k['k1'], k['k1r'], k['k2'], k['k2r'], k['k3']\n\n    def ode_system(t, y, k1, k1r, k2, k2r, k3):\n        \"\"\"\n        Defines the system of ordinary differential equations for dopant kinetics.\n        y = [Di, Ds, X, I, V]\n        \"\"\"\n        Di, Ds, X, I, V = y\n        \n        # Ensure concentrations do not go below zero during integration\n        if Di  0: Di = 0\n        if Ds  0: Ds = 0\n        if X  0: X = 0\n        if I  0: I = 0\n        if V  0: V = 0\n\n        # Reaction rates\n        R1 = k1 * Di * I\n        R1r = k1r * Ds\n        R2 = k2 * Ds * I\n        R2r = k2r * X\n        R3 = k3 * I * V\n\n        # ODEs\n        dDi_dt = -R1 + R1r\n        dDs_dt = R1 - R1r - R2 + R2r\n        dX_dt = R2 - R2r\n        dI_dt = -R1 + R1r - R2 + R2r - R3\n        dV_dt = -R3\n        \n        return [dDi_dt, dDs_dt, dX_dt, dI_dt, dV_dt]\n\n    final_phis = []\n\n    for i, sequence in enumerate(sequences):\n        # Initialize state vector from the problem's initial conditions\n        y = np.copy(initial_conditions[i])\n\n        for step in sequence:\n            if step['type'] == 'implant':\n                dose = step['dose']\n                fi = step['fi']\n                alpha_I = step['alpha_I']\n                alpha_V = step['alpha_V']\n                \n                y[0] += fi * dose         # Di\n                y[1] += (1 - fi) * dose   # Ds\n                y[3] += alpha_I * dose    # I\n                y[4] += alpha_V * dose    # V\n            \n            elif step['type'] == 'anneal':\n                T = step['T']\n                tau = step['tau']\n                \n                # Calculate rate constants for the anneal temperature\n                k_tuple = get_rate_constants(T)\n                \n                # Solve the ODE system for the anneal duration\n                sol = solve_ivp(\n                    fun=ode_system,\n                    t_span=[0, tau],\n                    y0=y,\n                    method='BDF',  # Suitable for stiff systems\n                    args=k_tuple,\n                    dense_output=False\n                )\n                \n                # Update state vector with the final concentrations\n                y = sol.y[:, -1]\n\n        # Calculate final active fraction phi\n        Di_f, Ds_f, X_f = y[0], y[1], y[2]\n        total_dopant = Di_f + Ds_f + X_f\n        \n        # Handle case where total_dopant is zero to avoid division by zero\n        phi = (Ds_f / total_dopant) if total_dopant > 0 else 0.0\n        final_phis.append(phi)\n\n    # Determine the optimal sequence (1-based index)\n    best_idx = np.argmax(final_phis) + 1\n\n    # Format the output string\n    phi_strings = [f\"{phi:.3f}\" for phi in final_phis]\n    output_list = phi_strings + [str(best_idx)]\n    \n    print(f\"[{','.join(output_list)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在本章的最后一个实践中，我们将把前面学习的动力学模型与其最终的物理意义联系起来。我们之所以关心掺杂激活，是因为活性掺杂浓度直接决定了半导体的电学性质。此练习要求您通过求解电中性方程来计算费米能级 ($E_F$)，这是决定材料电导率等关键电学行为的核心参数 ()。这个综合性练习涵盖了能带变窄、不完全电离等高等物理效应，让您全面了解如何将宏观的动力学模拟结果转化为对材料微观电学特性的深刻理解。",
            "id": "4121902",
            "problem": "您必须编写一个完整、可运行的程序，对于每个提供的测试用例，通过求解电荷中性条件来计算重掺杂硅中的费米能级位置。该计算需包括带隙变窄（BGN）效应，且激活的掺杂剂浓度由掺杂剂的激活和失活动力学决定。从半导体统计学和反应动力学的第一性原理出发。基于以下基础推导相关关系，不得使用简化公式：态密度（DOS）的抛物线能带近似、费米-狄拉克分布、通过对DOS积分定义载流子浓度的细致平衡、电荷中性以及掺杂剂激活和失活的一级可逆反应动力学。程序必须数值求解关于费米能级的隐式电荷中性方程，并报告其相对于两个能带边缘的位置。\n\n使用硅材料，其随温度变化的带隙由Varshni关系式建模。设本征带隙由Varshni参数给出：$E_{g,0} = 1.17\\ \\mathrm{eV}$，$\\alpha = 4.73\\times 10^{-4}\\ \\mathrm{eV}\\,\\mathrm{K}^{-1}$，以及 $\\beta = 636\\ \\mathrm{K}$。在温度 $T$ 下的带隙为 $E_{g}(T) = E_{g,0} - \\alpha \\dfrac{T^{2}}{T + \\beta}$。使用在温度 $T$ 下的有效态密度，其定义为 $N_{C}(T) = N_{C,300}\\left(\\dfrac{T}{300\\ \\mathrm{K}}\\right)^{3/2}$ 和 $N_{V}(T) = N_{V,300}\\left(\\dfrac{T}{300\\ \\mathrm{K}}\\right)^{3/2}$，其中 $N_{C,300} = 2.8\\times 10^{19}\\ \\mathrm{cm}^{-3}$ 和 $N_{V,300} = 1.04\\times 10^{19}\\ \\mathrm{cm}^{-3}$。通过对态密度和费米-狄拉克占据数的乘积进行能量积分来获得电子和空穴浓度，从而使用费米-狄拉克统计处理载流子。不要假定使用麦克斯韦-玻尔兹曼近似。将带隙变窄（BGN）建模为导带和价带边缘的对称移动，总变窄量 $\\Delta E_{g}(N_{\\mathrm{act}})$ 取决于激活的掺杂剂浓度 $N_{\\mathrm{act}}$：令 $\\Delta E_{g}(N_{\\mathrm{act}}) = \\begin{cases}\\alpha_{\\mathrm{BGN}}\\ln\\left(\\dfrac{N_{\\mathrm{act}}}{N_{\\mathrm{ref}}}\\right),  N_{\\mathrm{act}}  N_{\\mathrm{ref}} \\\\ 0,  N_{\\mathrm{act}} \\le N_{\\mathrm{ref}}\\end{cases}$，其中 $\\alpha_{\\mathrm{BGN}} = 1.74\\times 10^{-2}\\ \\mathrm{eV}$ 且 $N_{\\mathrm{ref}} = 1.0\\times 10^{17}\\ \\mathrm{cm}^{-3}$。将 $\\Delta E_{g}$ 均等分配：导带边下移 $\\dfrac{\\Delta E_{g}}{2}$，价带边上移 $\\dfrac{\\Delta E_{g}}{2}$。\n\n对于掺杂剂的激活和失活动力学，假设在非激活掺杂剂和激活掺杂剂之间存在一个单一的一级可逆反应。设总掺杂剂浓度为 $N_{\\mathrm{tot}}$，激活的掺杂剂浓度 $N_{\\mathrm{act}}(t)$ 遵循 $\\dfrac{d N_{\\mathrm{act}}}{dt} = k_{\\mathrm{act}}\\left(N_{\\mathrm{tot}} - N_{\\mathrm{act}}\\right) - k_{\\mathrm{deact}} N_{\\mathrm{act}}$，初始条件为 $N_{\\mathrm{act}}(0) = 0$。解析地表示 $N_{\\mathrm{act}}(t)$，并在电荷中性条件中使用它。考虑具有单能级施主和受主的掺杂剂的不完全电离。对于施主，施主能级为 $E_{D} = E_{C} - \\Delta E_{D}$，电离施主浓度为 $N_{D}^{+} = \\dfrac{N_{D,\\mathrm{act}}}{1 + g_{D}\\exp\\left(\\dfrac{E_{F} - E_{D}}{k_{B}T}\\right)}$。对于受主，受主能级为 $E_{A} = E_{V} + \\Delta E_{A}$，电离受主浓度为 $N_{A}^{-} = \\dfrac{N_{A,\\mathrm{act}}}{1 + g_{A}\\exp\\left(\\dfrac{E_{A} - E_{F}}{k_{B}T}\\right)}$。使用玻尔兹曼常数 $k_{B} = 8.617333262145\\times 10^{-5}\\ \\mathrm{eV}\\,\\mathrm{K}^{-1}$，施主简并因子 $g_{D} = 2$，受主简并因子 $g_{A} = 4$，施主束缚偏移 $\\Delta E_{D} = 0.045\\ \\mathrm{eV}$，以及受主束缚偏移 $\\Delta E_{A} = 0.057\\ \\mathrm{eV}$。\n\n通过1/2阶费米-狄拉克积分定义电子和空穴。对于电子：$n = N_{C}(T)\\,F_{1/2}\\!\\left(\\eta_{n}\\right)$，其中 $\\eta_{n} = \\dfrac{E_{F} - E_{C}}{k_{B}T}$。对于空穴：$p = N_{V}(T)\\,F_{1/2}\\!\\left(\\eta_{p}\\right)$，其中 $\\eta_{p} = \\dfrac{E_{V} - E_{F}}{k_{B}T}$。这里 $F_{1/2}(\\eta) = \\dfrac{2}{\\sqrt{\\pi}}\\int_{0}^{\\infty}\\dfrac{\\sqrt{\\epsilon}}{1 + \\exp(\\epsilon - \\eta)}\\,d\\epsilon$。\n\n施加电荷中性条件：$n - p + N_{A}^{-} - N_{D}^{+} = 0$。对每个测试用例数值求解 $E_{F}$。以浮点数形式报告 $E_{F} - E_{C}$ 和 $E_{V} - E_{F}$ 这两个量，单位均为 $\\mathrm{eV}$。\n\n所有能量以 $\\mathrm{eV}$ 表示，所有浓度以 $\\mathrm{cm}^{-3}$ 表示，所有温度以 $\\mathrm{K}$ 表示，速率常数以 $\\mathrm{s}^{-1}$ 表示，时间以 $\\mathrm{s}$ 表示。要求的最终输出为单行，内容是一个用方括号括起来的逗号分隔列表，其中每个元素对应一个测试用例，并且本身是一个双元素列表：$\\left[\\left[E_{F} - E_{C},\\,E_{V} - E_{F}\\right]\\right]$。例如，输出格式必须类似于 $\\left[\\left{x_{1},y_{1}\\right},\\left{x_{2},y_{2}\\right},\\dots\\right]$，其中包含数值。\n\n测试套件：\n- 案例1（中等n型，接近室温，BGN可忽略）：$T = 300\\ \\mathrm{K}$，仅有施主，$N_{\\mathrm{D,tot}} = 1.0\\times 10^{17}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 1.0\\times 10^{2}\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，退火时间 $t = 60\\ \\mathrm{s}$，无受主 $N_{\\mathrm{A,tot}} = 0$。\n- 案例2（重n型，BGN显著）：$T = 300\\ \\mathrm{K}$，仅有施主，$N_{\\mathrm{D,tot}} = 1.0\\times 10^{20}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 1.0\\times 10^{1}\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，$t = 120\\ \\mathrm{s}$，无受主 $N_{\\mathrm{A,tot}} = 0$。\n- 案例3（重p型，BGN显著）：$T = 300\\ \\mathrm{K}$，仅有受主，$N_{\\mathrm{A,tot}} = 5.0\\times 10^{19}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 5.0\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 5.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，$t = 180\\ \\mathrm{s}$，无施主 $N_{\\mathrm{D,tot}} = 0$。\n- 案例4（低n型，接近本征边界）：$T = 300\\ \\mathrm{K}$，仅有施主，$N_{\\mathrm{D,tot}} = 1.0\\times 10^{14}\\ \\mathrm{cm}^{-3}$，$k_{\\mathrm{act}} = 1.0\\times 10^{2}\\ \\mathrm{s}^{-1}$，$k_{\\mathrm{deact}} = 1.0\\times 10^{-1}\\ \\mathrm{s}^{-1}$，$t = 10\\ \\mathrm{s}$，无受主 $N_{\\mathrm{A,tot}} = 0$。\n\n您的程序必须为以上四个案例，按所列顺序，生成一行包含 $\\left[\\left[E_{F} - E_{C},E_{V} - E_{F}\\right]_{1},\\left[E_{F} - E_{C},E_{V} - E_{F}\\right]_{2},\\left[E_{F} - E_{C},E_{V} - E_{F}\\right]_{3},\\left[E_{F} - E_{C},E_{V} - E_{F}\\right]_{4}\\right]$ 的内容，其中包含以 $\\mathrm{eV}$ 为单位的数值浮点数。",
            "solution": "该问题被评估为有效。这是一个在半导体物理学中适定（well-posed）、有科学依据的问题，内容自洽且无矛盾。其解决方案要求在不同的掺杂和退火条件下，对硅中的费米能级进行数值计算，并考虑多种物理效应。\n\n在此，我们按照规定从第一性原理推导求解方法。问题的核心是求解费米能级 $E_F$ 的电荷中性方程。该方程表明，总正电荷密度必须等于总负电荷密度。在同时掺杂有施主和受主的半导体中，这表示为：\n$$ p + N_{D}^{+} = n + N_{A}^{-} $$\n或者，重新整理为求根格式 $Q(E_F) = 0$，其中净电荷密度函数 $Q(E_F)$ 是：\n$$ Q(E_F) = n - p + N_{A}^{-} - N_{D}^{+} = 0 $$\n此方程中的各项依赖于费米能级 $E_F$ 以及各种材料和环境参数。我们将根据所提供的物理模型来构建每一项。\n\n### 1. 掺杂剂激活力学\n电激活的掺杂剂浓度 $N_{\\mathrm{act}}$ 不等于总掺杂剂浓度 $N_{\\mathrm{tot}}$。它由一个一级可逆反应控制。激活掺杂剂浓度的变化率由下式给出：\n$$ \\frac{d N_{\\mathrm{act}}}{dt} = k_{\\mathrm{act}}(N_{\\mathrm{tot}} - N_{\\mathrm{act}}) - k_{\\mathrm{deact}} N_{\\mathrm{act}} $$\n这是一个线性一阶常微分方程。整理后得到：\n$$ \\frac{d N_{\\mathrm{act}}}{dt} + (k_{\\mathrm{act}} + k_{\\mathrm{deact}}) N_{\\mathrm{act}} = k_{\\mathrm{act}} N_{\\mathrm{tot}} $$\n稳态解（$t \\to \\infty$，$\\frac{d N_{\\mathrm{act}}}{dt} = 0$）为：\n$$ N_{\\mathrm{act,ss}} = N_{\\mathrm{tot}} \\frac{k_{\\mathrm{act}}}{k_{\\mathrm{act}} + k_{\\mathrm{deact}}} $$\n该常微分方程在初始条件 $N_{\\mathrm{act}}(0) = 0$ 下的通解为：\n$$ N_{\\mathrm{act}}(t) = N_{\\mathrm{act,ss}} \\left(1 - e^{-(k_{\\mathrm{act}} + k_{\\mathrm{deact}})t}\\right) $$\n对于每个测试用例，给定退火时间 $t$ 和各自的速率常数，此表达式用于计算激活的施主浓度（从 $N_{D,\\mathrm{tot}}$ 计算 $N_{D,\\mathrm{act}}$）和激活的受主浓度（从 $N_{A,\\mathrm{tot}}$ 计算 $N_{A,\\mathrm{act}}$）。\n\n### 2. 物理参数和带隙效应\n硅的材料属性取决于温度（$T$）和掺杂水平。\n本征带隙 $E_g$ 是温度的函数，由Varshni关系式建模：\n$$ E_{g}(T) = E_{g,0} - \\alpha \\frac{T^2}{T + \\beta} $$\n导带的有效态密度 $N_C$ 和价带的有效态密度 $N_V$ 随温度的变化关系如下：\n$$ N_{C}(T) = N_{C,300}\\left(\\frac{T}{300\\ \\mathrm{K}}\\right)^{3/2} \\quad \\text{和} \\quad N_{V}(T) = N_{V,300}\\left(\\frac{T}{300\\ \\mathrm{K}}\\right)^{3/2} $$\n在高掺杂浓度下，载流子和电离掺杂剂之间的相互作用导致带隙变窄（BGN），记为 $\\Delta E_g$。这被建模为总激活掺杂剂浓度 $N_{\\mathrm{act}} = N_{D,\\mathrm{act}} + N_{A,\\mathrm{act}}$ 的函数：\n$$ \\Delta E_{g}(N_{\\mathrm{act}}) = \\begin{cases}\\alpha_{\\mathrm{BGN}}\\ln\\left(\\frac{N_{\\mathrm{act}}}{N_{\\mathrm{ref}}}\\right),  N_{\\mathrm{act}}  N_{\\mathrm{ref}} \\\\ 0,  N_{\\mathrm{act}} \\le N_{\\mathrm{ref}}\\end{cases} $$\n这种变窄对称地应用于能带边缘。设 $E_{C,0}$ 和 $E_{V,0}$ 为未受扰动的能带边缘，其中 $E_{C,0} - E_{V,0} = E_g(T)$。新的、变窄后的能带边缘为：\n$$ E_C = E_{C,0} - \\frac{\\Delta E_g}{2} \\quad \\text{以及} \\quad E_V = E_{V,0} + \\frac{\\Delta E_g}{2} $$\n掺杂剂能级与这些能带边缘相关联：\n$$ E_D = E_C - \\Delta E_D \\quad \\text{以及} \\quad E_A = E_V + \\Delta E_A $$\n\n### 3. 载流子和电离掺杂剂浓度\n所有载流子的浓度都是费米能级 $E_F$ 的函数。我们必须按规定使用费米-狄拉克统计。\n\n**电子和空穴浓度：**\n导带中的电子浓度（$n$）和价带中的空穴浓度（$p$）是通过将态密度（DOS）乘以费米-狄拉克分布函数后对所有可用能态进行积分得到的。此积分导出标准表达式：\n$$ n = N_C(T) F_{1/2}\\left(\\frac{E_F - E_C}{k_B T}\\right) = N_C(T) F_{1/2}(\\eta_n) $$\n$$ p = N_V(T) F_{1/2}\\left(\\frac{E_V - E_F}{k_B T}\\right) = N_V(T) F_{1/2}(\\eta_p) $$\n其中 $k_B$ 是玻尔兹曼常数，$F_{1/2}(\\eta)$ 是1/2阶费米-狄拉克积分，必须进行数值计算：\n$$ F_{1/2}(\\eta) = \\frac{2}{\\sqrt{\\pi}}\\int_{0}^{\\infty}\\frac{\\sqrt{\\epsilon}}{1 + \\exp(\\epsilon - \\eta)}\\,d\\epsilon $$\n\n**电离掺杂剂浓度：**\n掺杂剂并非完全电离，尤其是在高浓度或低温下。电离概率取决于费米能级。电离施主（$N_D^+$）和电离受主（$N_A^-$）的浓度由下式给出：\n$$ N_{D}^{+} = \\frac{N_{D,\\mathrm{act}}}{1 + g_{D}\\exp\\left(\\frac{E_{F} - E_{D}}{k_{B}T}\\right)} $$\n$$ N_{A}^{-} = \\frac{N_{A,\\mathrm{act}}}{1 + g_{A}\\exp\\left(\\frac{E_{A} - E_{F}}{k_{B}T}\\right)} $$\n其中 $g_D$ 和 $g_A$ 分别是施主能级和受主能级的基态简并因子。\n\n### 4. 数值解法\n将 $n$、$p$、$N_A^-$ 和 $N_D^+$ 的表达式代入电荷中性方程 $Q(E_F) = 0$，我们得到一个关于未知数 $E_F$ 的单变量、非线性、超越方程。函数 $Q(E_F)$ 是单调的，当 $E_F \\ll E_V$ 时其值为很大的负数，当 $E_F \\gg E_C$ 时其值为很大的正数。这保证了 $E_F$ 有唯一解。\n对每个测试用例，使用一个稳健的求根算法（如Brent-Dekker方法（`brentq`））来数值求解该方程，该算法能在一个给定区间内高效地找到根。可以围绕带隙建立一个合适的 $E_F$ 求解区间，例如，从比 $E_V$ 低几个 $k_B T$ 到比 $E_C$ 高几个 $k_B T$。\n\n对每个测试用例，步骤如下：\n1.  根据动力学模型计算 $N_{D,\\mathrm{act}}$ 和 $N_{A,\\mathrm{act}}$。\n2.  确定 $E_g(T)$、$N_C(T)$ 和 $N_V(T)$。\n3.  计算 $\\Delta E_g$ 以及由此产生的移动后的能带边缘 $E_C$ 和 $E_V$。\n4.  构建电荷中性函数 $Q(E_F)$。\n5.  数值求解 $Q(E_F) = 0$ 以找到 $E_F$。\n6.  以 $E_F - E_C$ 和 $E_V - E_F$ 的形式报告最终结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.optimize import brentq\nimport math\n\ndef solve():\n    \"\"\"\n    Computes the Fermi level position in heavily doped silicon by solving the\n    charge neutrality condition, including effects of dopant activation kinetics and\n    bandgap narrowing.\n    \"\"\"\n    # Define physical and material constants from the problem statement\n    k_B = 8.617333262145e-5  # Boltzmann constant in eV/K\n    Eg0_Si = 1.17           # Si bandgap at 0K in eV\n    alpha_varshni = 4.73e-4 # Varshni parameter alpha in eV/K\n    beta_varshni = 636      # Varshni parameter beta in K\n    NC300_Si = 2.8e19       # Conduction band effective DOS at 300K in cm^-3\n    NV300_Si = 1.04e19      # Valence band effective DOS at 300K in cm^-3\n    alpha_bgn = 1.74e-2     # BGN parameter in eV\n    N_ref_bgn = 1.0e17      # BGN reference concentration in cm^-3\n    delta_ED = 0.045        # Donor ionization energy offset from Ec in eV\n    delta_EA = 0.057        # Acceptor ionization energy offset from Ev in eV\n    gD = 2                  # Donor degeneracy factor\n    gA = 4                  # Acceptor degeneracy factor\n\n    # A memoization cache for the Fermi-Dirac integral to speed up calculations\n    _memo_F12 = {}\n\n    def fermi_dirac_integral_half(eta):\n        \"\"\"\n        Computes the Fermi-Dirac integral of order 1/2, F_{1/2}(eta).\n        Uses asymptotic approximations for large |eta| for numerical stability and speed.\n        \"\"\"\n        if eta in _memo_F12:\n            return _memo_F12[eta]\n\n        if eta > 50:\n            # Asymptotic expansion for large positive eta (degenerate limit)\n            res = (4 / (3 * np.sqrt(np.pi))) * eta**1.5\n        elif eta  -20:\n            # Boltzmann approximation for large negative eta\n            res = np.exp(eta)\n        else:\n            # Direct numerical integration for intermediate values\n            integrand = lambda E: np.sqrt(E) / (1 + np.exp(E - eta))\n            integral_val, _ = quad(integrand, 0, np.inf)\n            res = (2 / np.sqrt(np.pi)) * integral_val\n        \n        _memo_F12[eta] = res\n        return res\n\n    def solve_case(params):\n        \"\"\"\n        Solves for the Fermi level for a single test case.\n        \"\"\"\n        T, ND_tot, NA_tot, k_act, k_deact, t = params\n        _memo_F12.clear()\n\n        # 1. Dopant Activation Kinetics\n        k_sum = k_act + k_deact\n        \n        ND_act = 0\n        if ND_tot > 0 and k_sum > 1e-9: # Avoid division by zero if rates are zero\n            ND_act_ss = ND_tot * (k_act / k_sum)\n            ND_act = ND_act_ss * (1 - np.exp(-k_sum * t))\n        \n        NA_act = 0\n        if NA_tot > 0 and k_sum > 1e-9:\n            NA_act_ss = NA_tot * (k_act / k_sum)\n            NA_act = NA_act_ss * (1 - np.exp(-k_sum * t))\n\n        N_act_total = ND_act + NA_act\n\n        # 2. Temperature-dependent and BGN-dependent parameters\n        kT = k_B * T\n        Eg_T = Eg0_Si - (alpha_varshni * T**2) / (T + beta_varshni)\n        NC_T = NC300_Si * (T / 300)**1.5\n        NV_T = NV300_Si * (T / 300)**1.5\n\n        delta_Eg = 0\n        if N_act_total > N_ref_bgn:\n            delta_Eg = alpha_bgn * np.log(N_act_total / N_ref_bgn)\n        \n        # Set reference energy (EV0 = 0) and find shifted band edges\n        EV0 = 0.0\n        EC0 = Eg_T\n        EV = EV0 + delta_Eg / 2\n        EC = EC0 - delta_Eg / 2\n        \n        # Dopant energy levels\n        ED = EC - delta_ED\n        EA = EV + delta_EA\n\n        # 3. Define the charge neutrality equation Q(EF) = n - p + NA_minus - ND_plus = 0\n        def charge_balance_equation(EF):\n            eta_n = (EF - EC) / kT\n            n = NC_T * fermi_dirac_integral_half(eta_n)\n            \n            eta_p = (EV - EF) / kT\n            p = NV_T * fermi_dirac_integral_half(eta_p)\n            \n            NA_minus = 0\n            if NA_act > 0:\n                 NA_minus = NA_act / (1 + gA * np.exp((EA - EF) / kT))\n            \n            ND_plus = 0\n            if ND_act > 0:\n                ND_plus = ND_act / (1 + gD * np.exp((EF - ED) / kT))\n                \n            return n - p + NA_minus - ND_plus\n\n        # 4. Numerically solve for the Fermi level EF using a bracketing root-finder\n        search_bracket_low = EV - 20 * kT\n        search_bracket_high = EC + 20 * kT\n        \n        try:\n            EF_solution = brentq(charge_balance_equation, search_bracket_low, search_bracket_high, xtol=1e-15, rtol=1e-15)\n        except ValueError:\n            return [math.nan, math.nan]\n\n        # 5. Calculate final quantities\n        EF_minus_EC = EF_solution - EC\n        EV_minus_EF = EV - EF_solution\n        \n        return [EF_minus_EC, EV_minus_EF]\n\n    test_cases = [\n        # T (K), N_D_tot (cm^-3), N_A_tot (cm^-3), k_act (s^-1), k_deact (s^-1), t (s)\n        (300, 1.0e17, 0, 1.0e2, 1.0e-1, 60),  # Case 1\n        (300, 1.0e20, 0, 1.0e1, 1.0e-1, 120), # Case 2\n        (300, 0, 5.0e19, 5.0, 5.0e-1, 180),   # Case 3\n        (300, 1.0e14, 0, 1.0e2, 1.0e-1, 10),  # Case 4\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(case_params)\n        results.append(result)\n\n    # Format the output exactly as specified: [[x1,y1],[x2,y2],...]\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}