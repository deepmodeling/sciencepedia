{
    "hands_on_practices": [
        {
            "introduction": "This first exercise takes us back to the fundamental principles of displacement damage. By deriving the classic Kinchin-Pease formula from a set of simple, idealized assumptions, you will gain a deep appreciation for the model's origin and its characteristic structure. This practice is essential for understanding the physical meaning of the displacement threshold energy, $E_d$, and its role in determining the three distinct regimes of defect production. ",
            "id": "4106867",
            "problem": "A Primary Knock-on Atom (PKA) generated during ion implantation initiates a collision cascade in crystalline silicon that produces lattice defects (displaced atoms). In process modeling of amorphization and dynamic recrystallization under implantation, the defect production function is needed to estimate the rate of disorder creation, which competes with dynamic annealing. Using the classical Kinchin–Pease model assumptions, derive the defect production function $N_{d}(E)$, defined as the expected number of displaced atoms produced by a single PKA of energy $E$, in terms of the threshold displacement energy $E_{d}$. Assume binary elastic collisions, negligible electronic stopping at the considered energy, and that on average the kinetic energy is partitioned approximately equally between the recoil and the scattered atom in each binary collision. Your derivation should identify regimes in $E$ where different qualitative behaviors occur.\n\nThen evaluate $N_{d}$ for a silicon PKA with energy $E = 500\\,\\text{eV}$ and threshold displacement energy $E_{d} = 15\\,\\text{eV}$. Express the computed $N_{d}$ as an exact rational number and treat $N_{d}$ as a dimensionless quantity. No rounding is required.",
            "solution": "The problem asks for the derivation of the Kinchin–Pease defect production function, $N_{d}(E)$, and its evaluation for specific parameters. The derivation will be based on the provided assumptions: binary elastic collisions, negligible electronic stopping, and equal energy partitioning in collisions.\n\nThe Kinchin–Pease model describes the expected number of atoms displaced from their lattice sites, forming Frenkel pairs (a vacancy and an interstitial), by a Primary Knock-on Atom (PKA) with initial kinetic energy $E$. An atom is displaced if it receives an energy greater than the threshold displacement energy, $E_{d}$. The model is built by considering the cascade of collisions initiated by the PKA. The behavior of the cascade and the resulting number of defects, $N_{d}$, depend on the energy $E$ of the initiating atom relative to $E_{d}$. We can analyze the problem by defining distinct energy regimes.\n\nLet's denote the PKA energy as $E$ and the threshold displacement energy as $E_{d}$.\n\nRegime 1: $E < E_{d}$\nIn this regime, the PKA's kinetic energy $E$ is less than the minimum energy $E_{d}$ required to displace a single lattice atom. The PKA will interact with the lattice, but only through low-energy transfers that excite phonons (lattice vibrations). It cannot create a stable Frenkel pair. Therefore, the number of displaced atoms is zero.\n$$N_{d}(E) = 0 \\quad \\text{for} \\quad E < E_{d}$$\n\nRegime 2: $E_{d} \\le E < 2E_{d}$\nIn this regime, the atom possesses enough energy to displace one other atom. However, it does not have sufficient energy to initiate a multiplicative cascade. Consider an impacting atom with energy $E$ in this range. It strikes a stationary atom. To create a displacement, it must transfer at least $E_{d}$ to the target atom. After the collision, the sum of the kinetic energies of the two atoms, plus the potential energy of the created defect ($E_{d}$), must equal the initial energy $E$. Since $E < 2E_{d}$, there is not enough energy for both the incident and the recoil atom to have energies greater than or equal to $E_{d}$ after the collision. For example, if the energy were shared equally as per the problem's assumption, each would receive $E/2$, which is less than $E_d$, so no displacement would occur. The model resolves this by stating that in this energy range, exactly one displacement occurs. This can be conceptualized as a replacement collision where the incident atom displaces a lattice atom and comes to rest in its place, or both atoms have insufficient energy to cause further displacements. Thus, the net result is one stable displacement.\n$$N_{d}(E) = 1 \\quad \\text{for} \\quad E_{d} \\le E < 2E_{d}$$\n\nRegime 3: $E \\ge 2E_{d}$\nWhen the energy of an atom is greater than or equal to $2E_{d}$, it can initiate a multiplicative collision cascade. The key assumption provided is that upon collision, the kinetic energy is partitioned equally between the scattered atom and the recoil atom. So, an atom with energy $E_{i}$ creates two moving atoms, each with energy $E_{i}/2$.\n\nThis suggests a recursive relationship for the number of displacements, $N_{d}(E)$. The total number of displacements created by a PKA of energy $E$ is the sum of the displacements created by the two resulting atoms from the first collision, each with energy $E/2$.\n$$N_{d}(E) = N_{d}(E/2) + N_{d}(E/2) = 2 N_{d}(E/2)$$\nThis recursive relation holds as long as the energy of the descendants is still within the cascade regime, i.e., $E/2 \\ge 2E_{d}$ is not necessarily true, but the cascade continues as long as the energy is sufficient to produce more than one defect. The cascade process terminates when the energy of the colliding atoms drops below the threshold for multiplication, which is $2E_{d}$.\n\nThe recurrence relation $N_{d}(E) = 2 N_{d}(E/2)$ implies a linear dependence on energy. Let's assume a solution of the form $N_{d}(E) = C \\cdot E$ for some constant $C$. Substituting this into the relation:\n$$C \\cdot E = 2(C \\cdot E/2) = C \\cdot E$$\nThe form is consistent. To find the constant $C$, we must apply a boundary condition. The boundary is the transition from Regime 3 to Regime 2, which occurs at $E = 2E_{d}$. At this specific energy, the cascade model should yield the same result as the single-displacement model. Therefore, we set $N_{d}(2E_{d}) = 1$.\nUsing our trial solution at this boundary:\n$$N_{d}(2E_{d}) = C \\cdot (2E_{d}) = 1$$\nSolving for $C$, we find:\n$$C = \\frac{1}{2E_{d}}$$\nSubstituting this constant back into our solution form, we obtain the defect production function for this regime:\n$$N_{d}(E) = \\frac{E}{2E_{d}} \\quad \\text{for} \\quad E \\ge 2E_{d}$$\nThis result can be interpreted as the total kinetic energy $E$ being dissipated, with an average energy cost of $2E_{d}$ for each stable displacement created.\n\nCombining all three regimes, the complete Kinchin–Pease defect production function $N_{d}(E)$ is:\n$$\nN_{d}(E) =\n\\begin{cases}\n0 & \\text{if } E < E_{d} \\\\\n1 & \\text{if } E_{d} \\le E < 2E_{d} \\\\\n\\frac{E}{2E_{d}} & \\text{if } E \\ge 2E_{d}\n\\end{cases}\n$$\n\nNow, we must evaluate $N_{d}(E)$ for a silicon PKA with energy $E = 500\\,\\text{eV}$ and a threshold displacement energy $E_{d} = 15\\,\\text{eV}$.\n\nFirst, we determine the relevant energy regime.\nThe value of $E_{d}$ is $15\\,\\text{eV}$.\nThe threshold for the cascade regime is $2E_{d} = 2 \\times 15\\,\\text{eV} = 30\\,\\text{eV}$.\nThe PKA energy is $E = 500\\,\\text{eV}$.\nSince $E = 500\\,\\text{eV}$ is greater than $2E_{d} = 30\\,\\text{eV}$, the problem falls into Regime 3.\n\nWe use the corresponding formula $N_{d}(E) = \\frac{E}{2E_{d}}$.\nSubstituting the given values:\n$$N_{d}(500\\,\\text{eV}) = \\frac{500\\,\\text{eV}}{2 \\times 15\\,\\text{eV}} = \\frac{500}{30}$$\nThe problem requires the answer as an exact rational number. Simplifying the fraction:\n$$N_{d} = \\frac{500}{30} = \\frac{50}{3}$$\nThe energy units cancel, making $N_{d}$ a dimensionless quantity as required. This value represents the average number of displacements; the actual number in any single cascade would be an integer.",
            "answer": "$$\n\\boxed{\\frac{50}{3}}\n$$"
        },
        {
            "introduction": "Real-world applications require models that are both physically accurate and account for experimental uncertainties. This practice advances from the idealized Kinchin-Pease model to the empirically corrected Norgett-Robinson-Torrens (NRT) standard, which offers a more realistic defect yield. You will then apply first-order uncertainty propagation to determine how uncertainty in the displacement energy, $E_d$, affects the predicted damage, a vital skill for robust semiconductor process modeling. ",
            "id": "4135838",
            "problem": "In ion implantation for semiconductor manufacturing, the number of stable lattice point defects generated per implanted ion, denoted by $N_{d}$, is governed by energy transfer in ion–solid collisions. The primary knock-on atom (PKA) concept and two-body elastic collision kinematics imply that displacements occur when recoil energies exceed the threshold displacement energy $E_{d}$. The energy available to elastic nuclear processes in the cascade, often called the damage energy $T_{\\mathrm{dam}}$, is obtained by partitioning the total ion energy via Lindhard–Scharff–Schiøtt (LSS) theory. Under the Kinchin–Pease cascade picture, corrected by the Norgett–Robinson–Torrens (NRT) efficiency factor, the average number of displacements per ion scales inversely with $E_{d}$.\n\nConsider an implant recipe into crystalline silicon for which the Stopping and Range of Ions in Matter (SRIM) calculation yields a per-ion damage energy $T_{\\mathrm{dam}} = 2.4 \\times 10^{3}\\ \\mathrm{eV}$ at the process conditions of interest. The threshold displacement energy $E_{d}$ for silicon is uncertain due to crystallographic orientation and thermal effects, and will be modeled as a normally distributed quantity with mean $\\mu_{E_{d}} = 25\\ \\mathrm{eV}$ and standard deviation $\\sigma_{E_{d}} = 3\\ \\mathrm{eV}$.\n\nStarting from first principles of energy conservation and the collision cascade picture, and invoking the Kinchin–Pease model together with the NRT correction (without assuming any pre-derived target formula), derive the functional dependence of $N_{d}$ on $E_{d}$ and $T_{\\mathrm{dam}}$. Use this to compute the local sensitivity of $N_{d}$ to $E_{d}$ and propagate the stated uncertainty in $E_{d}$ to obtain a two-sided $95\\%$ confidence interval for $N_{d}$ under first-order (linear) uncertainty propagation with $T_{\\mathrm{dam}}$ treated as known. Round your two interval endpoints to four significant figures and express the final interval endpoints as dimensionless counts.",
            "solution": "The problem requires the derivation of a model for defect generation during ion implantation, followed by a sensitivity analysis and uncertainty propagation to determine a confidence interval for the number of defects.\n\n### Step 1: Problem Validation\n\n**Extracted Givens:**\n- The number of stable lattice point defects per implanted ion is denoted by $N_{d}$.\n- The damage energy per ion is $T_{\\mathrm{dam}} = 2.4 \\times 10^{3}\\ \\mathrm{eV}$. This value is treated as known.\n- The threshold displacement energy for silicon, $E_{d}$, is modeled as a normally distributed random variable.\n- The mean of the threshold displacement energy is $\\mu_{E_{d}} = 25\\ \\mathrm{eV}$.\n- The standard deviation of the threshold displacement energy is $\\sigma_{E_{d}} = 3\\ \\mathrm{eV}$.\n- The model for $N_d$ should be derived from the Kinchin–Pease (KP) cascade picture with the Norgett–Robinson–Torrens (NRT) correction.\n- The task is to compute a two-sided $95\\%$ confidence interval for $N_{d}$ using first-order (linear) uncertainty propagation.\n- The final interval endpoints must be rounded to four significant figures.\n\n**Validation Using Extracted Givens:**\n- **Scientifically Grounded:** The problem is firmly rooted in the physics of ion-solid interactions, a core topic in semiconductor process modeling. The concepts mentioned (PKA, displacement energy $E_d$, damage energy $T_{\\mathrm{dam}}$, LSS theory, Kinchin-Pease model, NRT standard) are all standard and well-established in the field.\n- **Well-Posed:** The problem provides a clear objective and all necessary data to achieve it. It asks for a specific analytical procedure (derivation, sensitivity analysis, linear uncertainty propagation) for which a unique solution exists.\n- **Objective:** The problem statement is in precise, quantitative, and unbiased language.\n- **Completeness:** All required quantitative values ($T_{\\mathrm{dam}}$, $\\mu_{E_d}$, $\\sigma_{E_d}$, confidence level) are provided. The reference to the \"NRT correction\" implies the use of the standard NRT model, which is self-contained. The problem is not underspecified.\n- **Consistency and Feasibility:** The given values are physically realistic for ion implantation processes in silicon. The assumption of a normal distribution for $E_d$ is a common and reasonable modeling choice, especially since the mean ($\\mu_{E_d} = 25\\ \\mathrm{eV}$) is many standard deviations away from zero ($\\mu_{E_d}/\\sigma_{E_d} \\approx 8.3$), making the probability of unphysical negative energies negligible.\n\n**Verdict:**\nThe problem is valid. It is a well-posed, scientifically sound, and objective problem in applied physics and engineering.\n\n### Step 2: Derivation and Solution\n\n**Derivation of the Functional Dependence of $N_d$**\n\nThe problem requires a derivation starting from the Kinchin-Pease (KP) model, corrected by the Norgett-Robinson-Torrens (NRT) standard.\n\nThe KP model provides a simplified picture of a collision cascade. It assumes that an energetic atom creates displacements until its energy falls below a certain threshold. Based on conservation of energy in a series of binary collisions, the number of displaced atoms, $N_d$, is related to the energy available for nuclear collisions (the damage energy, $T_{\\mathrm{dam}}$) and the minimum energy required to displace an atom from its lattice site ($E_d$). For damage energies significantly greater than the displacement energy ($T_{\\mathrm{dam}} \\gg E_d$), the KP model predicts a linear relationship:\n$$N_{d,KP} = \\frac{T_{\\mathrm{dam}}}{2 E_d}$$\nThis model, however, is an idealization. The NRT standard provides a more realistic estimate by introducing an efficiency factor, $\\kappa$, that accounts for the spontaneous recombination of nearby vacancies and interstitials. This effect, which is not captured by the simple KP model, reduces the final count of stable defects. For many materials, including silicon, this efficiency factor is empirically and theoretically established to be approximately $\\kappa \\approx 0.8$. The NRT model corrects the KP formula as follows:\n$$N_d = \\kappa N_{d,KP} = \\frac{\\kappa T_{\\mathrm{dam}}}{2 E_d}$$\nThe problem provides $T_{\\mathrm{dam}}$, the damage energy, which is already the energy partitioned into the nuclear collision cascade via LSS theory. Therefore, no further modification of the energy term is necessary. We adopt the NRT model with the standard efficiency factor $\\kappa = 0.8$.\n\nThe functional dependence of $N_d$ on $E_d$ and $T_{\\mathrm{dam}}$ is:\n$$N_d(E_d, T_{\\mathrm{dam}}) = \\frac{\\kappa T_{\\mathrm{dam}}}{2 E_d}$$\nGiven that $T_{\\mathrm{dam}}$ is treated as a known constant, the function of interest is $N_d(E_d) = \\frac{C}{E_d}$, where $C = \\frac{\\kappa T_{\\mathrm{dam}}}{2}$ is a constant.\n\n**Local Sensitivity Analysis**\n\nThe local sensitivity of $N_d$ with respect to $E_d$ is the partial derivative of $N_d$ with respect to $E_d$:\n$$\\frac{\\partial N_d}{\\partial E_d} = \\frac{\\partial}{\\partial E_d} \\left( \\frac{\\kappa T_{\\mathrm{dam}}}{2 E_d} \\right) = \\frac{\\kappa T_{\\mathrm{dam}}}{2} \\frac{\\partial}{\\partial E_d} \\left( E_d^{-1} \\right) = -\\frac{\\kappa T_{\\mathrm{dam}}}{2 E_d^2}$$\nThis sensitivity indicates how much $N_d$ changes for a small change in $E_d$. The negative sign correctly shows that as the energy required to displace an atom ($E_d$) increases, the number of resulting defects ($N_d$) decreases.\n\n**First-Order Uncertainty Propagation**\n\nThe problem specifies using first-order (linear) uncertainty propagation to find the uncertainty in $N_d$ due to the uncertainty in $E_d$. For a function $Y=f(X)$, the propagated variance is approximated by:\n$$\\sigma_Y^2 \\approx \\left( \\frac{df}{dX} \\bigg|_{X=\\mu_X} \\right)^2 \\sigma_X^2$$\nApplying this to our problem, the variance of $N_d$ is:\n$$\\sigma_{N_d}^2 \\approx \\left( \\frac{\\partial N_d}{\\partial E_d} \\bigg|_{E_d=\\mu_{E_d}} \\right)^2 \\sigma_{E_d}^2$$\nThe standard deviation of $N_d$ is therefore:\n$$\\sigma_{N_d} \\approx \\left| \\frac{\\partial N_d}{\\partial E_d} \\bigg|_{E_d=\\mu_{E_d}} \\right| \\sigma_{E_d} = \\left( \\frac{\\kappa T_{\\mathrm{dam}}}{2 \\mu_{E_d}^2} \\right) \\sigma_{E_d}$$\nThe expected value of $N_d$ can be approximated to first order by evaluating the function at the mean of the input variable:\n$$\\mu_{N_d} \\approx N_d(\\mu_{E_d}) = \\frac{\\kappa T_{\\mathrm{dam}}}{2 \\mu_{E_d}}$$\nThe problem states that $E_d$ is normally distributed. The linear approximation for uncertainty propagation implies that $N_d$ is treated as approximately normally distributed with mean $\\mu_{N_d}$ and standard deviation $\\sigma_{N_d}$. A two-sided $95\\%$ confidence interval for a normal distribution is given by $[\\mu - z \\sigma, \\mu + z \\sigma]$. For a $95\\%$ confidence level, the corresponding z-score is $z_{0.05/2} = z_{0.025} \\approx 1.960$.\nThe confidence interval (CI) for $N_d$ is therefore:\n$$CI_{95\\%} = \\left[ \\mu_{N_d} - 1.960 \\, \\sigma_{N_d}, \\mu_{N_d} + 1.960 \\, \\sigma_{N_d} \\right]$$\n\n**Numerical Calculation**\n\nWe substitute the given values into the derived expressions:\n- $\\kappa = 0.8$\n- $T_{\\mathrm{dam}} = 2.4 \\times 10^3\\ \\mathrm{eV}$\n- $\\mu_{E_d} = 25\\ \\mathrm{eV}$\n- $\\sigma_{E_d} = 3\\ \\mathrm{eV}$\n\nFirst, we compute the mean number of defects, $\\mu_{N_d}$:\n$$\\mu_{N_d} = \\frac{0.8 \\times (2.4 \\times 10^3\\ \\mathrm{eV})}{2 \\times (25\\ \\mathrm{eV})} = \\frac{1920}{50} = 38.4$$\n\nNext, we compute the standard deviation of the number of defects, $\\sigma_{N_d}$:\n$$\\sigma_{N_d} = \\left( \\frac{0.8 \\times (2.4 \\times 10^3\\ \\mathrm{eV})}{2 \\times (25\\ \\mathrm{eV})^2} \\right) \\times (3\\ \\mathrm{eV}) = \\left( \\frac{1920}{2 \\times 625} \\right) \\times 3 = \\frac{1920}{1250} \\times 3 = 1.536 \\times 3 = 4.608$$\n\nFinally, we compute the $95\\%$ confidence interval:\n- Lower bound: $L = \\mu_{N_d} - 1.960 \\times \\sigma_{N_d} = 38.4 - 1.960 \\times 4.608 = 38.4 - 9.03168 = 29.36832$\n- Upper bound: $U = \\mu_{N_d} + 1.960 \\times \\sigma_{N_d} = 38.4 + 1.960 \\times 4.608 = 38.4 + 9.03168 = 47.43168$\n\nThe problem requires rounding the interval endpoints to four significant figures.\n- Lower bound rounded: $29.37$\n- Upper bound rounded: $47.43$\n\nThe two-sided $95\\%$ confidence interval for the number of defects $N_d$ is $[29.37, 47.43]$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 29.37 & 47.43 \\end{pmatrix}}$$"
        },
        {
            "introduction": "This capstone exercise transitions from analytical calculations to a full-scale computational investigation, mirroring modern research practices. You will implement the NRT model to calculate total damage from a spectrum of primary knock-on atom (PKA) energies, rather than a single energy value. By performing a global sensitivity analysis using Monte Carlo methods, you will learn to identify which physical parameters most significantly influence the total defect production rate, a critical insight for materials design and process optimization. ",
            "id": "3716314",
            "problem": "A material in a nuclear fusion environment experiences primary knock-on atoms (PKAs) with a stochastic energy spectrum. The total rate of defect (Frenkel pair) production per unit time is modeled by integrating the per-PKA defect yield over the PKA energy distribution and multiplying by the PKA event rate. The per-PKA defect yield is described by the Norgett–Robinson–Torrens (NRT) model, which is a widely used refinement of the Kinchin–Pease model. Assume an exponential PKA energy spectrum truncated at an upper energy cutoff. The goal is to perform a global sensitivity analysis to identify which uncertain input parameter is the dominant contributor to the uncertainty in the predicted defect production rate.\n\nFundamental basis:\n- The Kinchin–Pease model provides a baseline for estimating defect production. The Norgett–Robinson–Torrens (NRT) model refines this by introducing a damage efficiency factor ($\\kappa=0.8$) to account for in-cascade recombination, yielding a more accurate prediction for the number of stable defects. The number of displacements, $n(E; E_d)$, created by a PKA with energy $E$ is described by a piecewise function based on the threshold displacement energy $E_d$, as detailed below.\n\nDefinitions and modeling assumptions:\n- Let $n(E; E_d)$ denote the NRT per-PKA defect yield:\n  - $n(E; E_d) = 0$ for $E < E_d$,\n  - $n(E; E_d) = 1$ for $E \\in [E_d, 2 E_d]$,\n  - $n(E; E_d) = 0.8 \\times \\dfrac{E}{2 E_d}$ for $E > 2 E_d$.\n- Let $p(E; E_0, E_{\\max}) = \\dfrac{1}{E_0 \\left(1 - \\exp\\left(-\\dfrac{E_{\\max}}{E_0}\\right)\\right)} \\exp\\left(-\\dfrac{E}{E_0}\\right)$ for $E \\in [0, E_{\\max}]$ and zero otherwise.\n- The expected defect yield per PKA event is the integral $\\int_{0}^{E_{\\max}} n(E; E_d) \\, p(E; E_0, E_{\\max}) \\, dE$.\n- The total defect production rate is $R = A \\times \\int_{0}^{E_{\\max}} n(E; E_d) \\, p(E; E_0, E_{\\max}) \\, dE$, where $A$ is the mean rate of PKA events per unit time.\n\nUncertainties:\n- The uncertain inputs are $E_d$ (displacement threshold energy, in electronvolts), $A$ (PKA event rate, in events per second), and $E_0$ (PKA spectrum scale, in electronvolts). Each is modeled by a lognormal distribution with specified median and geometric standard deviation. The upper energy cutoff $E_{\\max}$ is treated as known for each test case.\n\nSensitivity analysis task:\n- For each test case, estimate the first-order Sobol sensitivity indices for the three inputs $\\{E_d, A, E_0\\}$ using the Jansen estimator and independent sampling. Use $N$ Monte Carlo samples with two independent sample matrices and mixed matrices for the estimator. The first-order indices quantify the contribution of each input to the output variance.\n- Identify and report the index of the input with the largest first-order sensitivity for each test case, with the index mapping $0 \\rightarrow E_d$, $1 \\rightarrow A$, $2 \\rightarrow E_0$.\n\nAlgorithmic requirements:\n- Implement a vectorized computation of $R$ using the above definitions, performing the integral analytically over the truncated exponential segments induced by the NRT piecewise model.\n- Use independent lognormal sampling for the three inputs. For a lognormal variable with median $m$ and geometric standard deviation $g$, the natural logarithm parameters are $\\mu = \\ln(m)$ and $\\sigma = \\ln(g)$.\n- Use the Jansen estimator for first-order Sobol indices. Given two independent sample matrices $A$ and $B$ and mixed matrices $A_{B}^{(i)}$, the estimator is $S_i = 1 - \\dfrac{\\mathbb{E}\\left[(f(B) - f(A_{B}^{(i)}))^2\\right]}{2 \\, \\mathrm{Var}(f(A))}$, where $f$ maps inputs to the output $R$.\n\nUnits:\n- Energies must be handled in electronvolts, with $E_d$ and $E_0$ in $\\mathrm{eV}$, and $E_{\\max}$ in $\\mathrm{eV}$. The rate $A$ is in $\\mathrm{s}^{-1}$. The defect rate $R$ is in defects per second. The final reported indices are integers and therefore unitless.\n\nNumerical specifications:\n- Use $N = 20000$ samples for the Jansen estimator in each test case.\n\nTest suite:\n- Test case $1$ (happy path, moderate uncertainties with dominant spectrum scale uncertainty):\n  - $E_d$: median $90\\,\\mathrm{eV}$, geometric standard deviation $1.10$.\n  - $A$: median $10^6\\,\\mathrm{s}^{-1}$, geometric standard deviation $1.05$.\n  - $E_0$: median $15000\\,\\mathrm{eV}$, geometric standard deviation $1.30$.\n  - $E_{\\max} = 50000\\,\\mathrm{eV}$.\n- Test case $2$ (dominant threshold energy uncertainty):\n  - $E_d$: median $90\\,\\mathrm{eV}$, geometric standard deviation $1.30$.\n  - $A$: median $10^6\\,\\mathrm{s}^{-1}$, geometric standard deviation $1.05$.\n  - $E_0$: median $15000\\,\\mathrm{eV}$, geometric standard deviation $1.10$.\n  - $E_{\\max} = 50000\\,\\mathrm{eV}$.\n- Test case $3$ (dominant amplitude uncertainty):\n  - $E_d$: median $90\\,\\mathrm{eV}$, geometric standard deviation $1.05$.\n  - $A$: median $10^6\\,\\mathrm{s}^{-1}$, geometric standard deviation $1.50$.\n  - $E_0$: median $15000\\,\\mathrm{eV}$, geometric standard deviation $1.10$.\n  - $E_{\\max} = 50000\\,\\mathrm{eV}$.\n- Test case $4$ (boundary condition, low-energy spectrum near threshold):\n  - $E_d$: median $90\\,\\mathrm{eV}$, geometric standard deviation $1.20$.\n  - $A$: median $10^6\\,\\mathrm{s}^{-1}$, geometric standard deviation $1.05$.\n  - $E_0$: median $120\\,\\mathrm{eV}$, geometric standard deviation $1.20$.\n  - $E_{\\max} = 1000\\,\\mathrm{eV}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the four test cases in order. Each entry is the integer index of the input with the largest first-order sensitivity, using the mapping $[E_d, A, E_0] \\rightarrow [0, 1, 2]$. For example, the output should look like $\\left[2,0,1,0\\right]$ if the dominant contributors are $E_0$ for the first case, $E_d$ for the second case, $A$ for the third case, and $E_d$ for the fourth case.",
            "solution": "The user has provided a problem that requires performing a sensitivity analysis on a model of radiation damage in materials. I will first validate the problem statement and then provide a complete solution if it is deemed valid.\n\n### Step 1: Extract Givens\n- **Model for Defect Yield per PKA ($n(E; E_d)$):**\n  - $n(E; E_d) = 0$ for $E < E_d$\n  - $n(E; E_d) = 1$ for $E \\in [E_d, 2 E_d]$\n  - $n(E; E_d) = 0.8 \\times \\dfrac{E}{2 E_d}$ for $E > 2 E_d$\n- **Probability Density Function for PKA Energy ($p(E; E_0, E_{\\max})$):**\n  - $p(E; E_0, E_{\\max}) = \\dfrac{1}{E_0 \\left(1 - \\exp\\left(-\\dfrac{E_{\\max}}{E_0}\\right)\\right)} \\exp\\left(-\\dfrac{E}{E_0}\\right)$ for $E \\in [0, E_{\\max}]$.\n- **Total Defect Production Rate ($R$):**\n  - $R = A \\times \\int_{0}^{E_{\\max}} n(E; E_d) \\, p(E; E_0, E_{\\max}) \\, dE$, where $A$ is the PKA event rate.\n- **Uncertain Inputs:**\n  - $E_d$ (displacement threshold energy, eV), lognormal distribution.\n  - $A$ (PKA event rate, $\\mathrm{s}^{-1}$), lognormal distribution.\n  - $E_0$ (PKA spectrum scale, eV), lognormal distribution.\n- **Fixed Input (per test case):** $E_{\\max}$ (upper energy cutoff, eV).\n- **Lognormal Distribution:** For a variable with median $m$ and geometric standard deviation $g$, the natural logarithm has mean $\\mu = \\ln(m)$ and standard deviation $\\sigma = \\ln(g)$.\n- **Sensitivity Analysis Method:**\n  - Estimate first-order Sobol indices for Inputs $\\{E_d, A, E_0\\}$.\n  - Use the Jansen estimator: $S_i = 1 - \\dfrac{\\mathbb{E}\\left[(f(B) - f(A_{B}^{(i)}))^2\\right]}{2 \\, \\mathrm{Var}(f(A))}$.\n  - Use $N = 20000$ Monte Carlo samples.\n  - Report the index of the input with the largest first-order sensitivity: $0 \\rightarrow E_d$, $1 \\rightarrow A$, $2 \\rightarrow E_0$.\n- **Test Cases:**\n  1. $E_d$: median $90\\,\\mathrm{eV}$, g.s.d. $1.10$. $A$: median $10^6\\,\\mathrm{s}^{-1}$, g.s.d. $1.05$. $E_0$: median $15000\\,\\mathrm{eV}$, g.s.d. $1.30$. $E_{\\max} = 50000\\,\\mathrm{eV}$.\n  2. $E_d$: median $90\\,\\mathrm{eV}$, g.s.d. $1.30$. $A$: median $10^6\\,\\mathrm{s}^{-1}$, g.s.d. $1.05$. $E_0$: median $15000\\,\\mathrm{eV}$, g.s.d. $1.10$. $E_{\\max} = 50000\\,\\mathrm{eV}$.\n  3. $E_d$: median $90\\,\\mathrm{eV}$, g.s.d. $1.05$. $A$: median $10^6\\,\\mathrm{s}^{-1}$, g.s.d. $1.50$. $E_0$: median $15000\\,\\mathrm{eV}$, g.s.d. $1.10$. $E_{\\max} = 50000\\,\\mathrm{eV}$.\n  4. $E_d$: median $90\\,\\mathrm{eV}$, g.s.d. $1.20$. $A$: median $10^6\\,\\mathrm{s}^{-1}$, g.s.d. $1.05$. $E_0$: median $120\\,\\mathrm{eV}$, g.s.d. $1.20$. $E_{\\max} = 1000\\,\\mathrm{eV}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is based on the standard NRT model for radiation damage and uses a common representation for the PKA energy spectrum. Sensitivity analysis via Sobol indices is a standard, robust technique in uncertainty quantification. The problem is firmly rooted in nuclear materials science.\n2.  **Well-Posed:** All necessary functions, parameters, distributions, and numerical methods are explicitly defined. The task is clear and leads to a unique solution (within the statistical error of the Monte Carlo method).\n3.  **Objective:** The problem statement is formal and quantitative, free from subjective language.\n4.  **Completeness and Consistency:** The problem is self-contained and provides all required information. The physical parameters and their uncertainties are within realistic ranges for fusion materials. No contradictions are present.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-defined computational problem in physics and engineering. I will proceed with formulating and implementing the solution.\n\n### Principle-Based Design\nThe solution is designed around two main components: a vectorized model function for the defect production rate $R$, and a procedural implementation of the Sobol sensitivity analysis using the Jansen estimator.\n\n**1. Analytical Model for Defect Production Rate ($R$)**\n\nThe rate $R$ is given by $R = A \\cdot \\langle n \\rangle$, where $\\langle n \\rangle$ is the expected number of defects per PKA, obtained by integrating the product of the NRT defect yield $n(E; E_d)$ and the PKA energy PDF $p(E; E_0, E_{\\max})$.\n\n$$\n\\langle n \\rangle = \\int_0^{E_{\\max}} n(E; E_d) p(E; E_0, E_{\\max}) \\, dE\n$$\n\nThe function $n(E; E_d)$ is piecewise, which partitions the integral. Let $C = \\left[E_0 \\left(1 - \\exp\\left(-\\frac{E_{\\max}}{E_0}\\right)\\right)\\right]^{-1}$ be the normalization constant for the PDF.\n\n$$\n\\langle n \\rangle = \\int_{E_d}^{2E_d} (1) \\cdot C e^{-E/E_0} \\, dE + \\int_{2E_d}^{E_{\\max}} \\left(\\frac{0.8 E}{2E_d}\\right) \\cdot C e^{-E/E_0} \\, dE\n$$\n\nThese integrals are evaluated analytically. The integration limits must be clipped to the domain $[0, E_{\\max}]$. Let $l_1 = E_d$, $u_1 = \\min(2E_d, E_{\\max})$, $l_2 = 2E_d$, and $u_2 = E_{\\max}$.\n\nThe first integral, $I_1 = \\int_{l_1}^{u_1} C e^{-E/E_0} \\, dE$, gives:\n$$\nI_1 = -C E_0 \\left[ e^{-E/E_0} \\right]_{l_1}^{u_1} = \\frac{e^{-l_1/E_0} - e^{-u_1/E_0}}{1 - e^{-E_{\\max}/E_0}}\n$$\nThis calculation is performed only if $u_1 > l_1$.\n\nThe second integral, $I_2 = \\int_{l_2}^{u_2} \\frac{0.4}{E_d} E \\cdot C e^{-E/E_0} \\, dE$, requires integration of $E e^{-E/E_0}$, which yields $-E_0 e^{-E/E_0}(E+E_0)$.\n$$\nI_2 = \\frac{0.4C}{E_d} \\left[-E_0 e^{-E/E_0}(E+E_0)\\right]_{l_2}^{u_2} = \\frac{0.4}{E_d} \\frac{e^{-l_2/E_0}(l_2+E_0) - e^{-u_2/E_0}(u_2+E_0)}{1 - e^{-E_{\\max}/E_0}}\n$$\nThis calculation is performed only if $u_2 > l_2$.\n\nThe expected yield is $\\langle n \\rangle = I_1 + I_2$, and the total rate is $R = A \\cdot \\langle n \\rangle$. The implementation must be vectorized to efficiently compute $R$ for $N$ samples of the inputs $(E_d, A, E_0)$ simultaneously. Numerical stability for the term $1 - \\exp(-x)$ for small $x$ is handled using `numpy.expm1(-x)`.\n\n**2. Sobol Sensitivity Analysis via Jansen Estimator**\n\nThe sensitivity analysis quantifies how much of the uncertainty in the output $R$ is due to the uncertainty in each input parameter.\n- **Sampling:** We generate two independent sample matrices, $\\mathbf{A}$ and $\\mathbf{B}$, each of size $N \\times k$, where $N=20000$ is the number of samples and $k=3$ is the number of uncertain parameters $\\{E_d, A, E_0\\}$. The samples for each parameter are drawn from their specified lognormal distributions. A parameter $X$ with median $m$ and geometric standard deviation $g$ is sampled as $X = \\exp(\\mu + \\sigma Z)$, where $Z \\sim \\mathcal{N}(0,1)$, $\\mu=\\ln(m)$, and $\\sigma=\\ln(g)$.\n- **Model Evaluation:** The model $R=f(E_d, A, E_0)$ is evaluated for all sample points in $\\mathbf{A}$ (yielding vector $y_A$) and $\\mathbf{B}$ (yielding $y_B$).\n- **Estimator Calculation:** For each input parameter $i \\in \\{0, 1, 2\\}$, we construct a \"mixed\" matrix $\\mathbf{A_B^{(i)}}$, which is matrix $\\mathbf{A}$ with its $i$-th column replaced by the $i$-th column of matrix $\\mathbf{B}$. The model is then evaluated for these new sample points, yielding vector $y_{AB}^{(i)}$.\n- **First-Order Index ($S_i$):** The Jansen estimator for the first-order Sobol index is computed as:\n$$\nS_i = 1 - \\frac{\\frac{1}{N}\\sum_{j=1}^{N}(y_{B,j} - y_{AB,j}^{(i)})^2}{2 \\cdot \\mathrm{Var}(y_A)}\n$$\nwhere $\\mathrm{Var}(y_A)$ is the sample variance of the model outputs from matrix $\\mathbf{A}$.\n\nThe dominant input parameter for each test case is identified by finding the maximum value among the calculated indices $\\{S_0, S_1, S_2\\}$. The corresponding index is reported. A fixed random seed is used to ensure reproducibility of the Monte Carlo simulation.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs sensitivity analysis on a radiation damage model.\n\n    This function implements the entire solution pipeline:\n    1. Defines test cases with uncertain parameter distributions.\n    2. Implements a vectorized model for defect production rate.\n    3. For each test case, performs a Sobol sensitivity analysis using the\n       Jansen estimator to find the most influential input parameter.\n    4. Prints the final results in the specified format.\n    \"\"\"\n\n    def calculate_R(Ed, A, E0, Emax):\n        \"\"\"\n        Calculates the defect production rate R using the NRT model.\n\n        This function is vectorized to operate on NumPy arrays of samples.\n\n        Args:\n            Ed (np.ndarray): Array of displacement threshold energies [eV].\n            A (np.ndarray): Array of PKA event rates [s^-1].\n            E0 (np.ndarray): Array of PKA spectrum scale energies [eV].\n            Emax (float): Scalar upper energy cutoff for the PKA spectrum [eV].\n\n        Returns:\n            np.ndarray: Array of calculated defect production rates [defects/s].\n        \"\"\"\n        # Ensure inputs are positive to avoid numerical issues.\n        Ed = np.maximum(Ed, 1e-9)\n        E0 = np.maximum(E0, 1e-9)\n\n        # The term (1 - exp(-Emax/E0)) is the denominator in the integrals.\n        # Use np.expm1 for better numerical stability when Emax/E0 is small.\n        x = Emax / E0\n        D_term = -np.expm1(-x)\n        # Handle cases where Emax/E0 is so small that D_term becomes zero.\n        # In this limit, D_term ≈ x.\n        zero_D_mask = (D_term == 0)\n        D_term[zero_D_mask] = x[zero_D_mask]\n        # Final failsafe for any remaining zeros.\n        D_term[D_term == 0] = 1e-30\n\n        integral_val = np.zeros_like(Ed)\n\n        # Region 1: Integral of p(E) where n(E)=1, from Ed to min(2*Ed, Emax).\n        l1 = Ed\n        u1 = np.minimum(2.0 * Ed, Emax)\n        # Antiderivative of p(E) gives (exp(-l1/E0) - exp(-u1/E0)) / D_term.\n        term1_contrib = (np.exp(-l1 / E0) - np.exp(-u1 / E0)) / D_term\n        # Add contribution only where the integration interval is valid.\n        integral_val += np.where(u1 > l1, term1_contrib, 0.0)\n\n        # Region 2: Integral of (0.4*E/Ed)*p(E) where n(E)>1, from 2*Ed to Emax.\n        l2 = 2.0 * Ed\n        u2 = Emax\n        # Antiderivative of E*p(E) gives (Q(l2) - Q(u2)) where Q(E) = -(E+E0)exp(-E/E0)/D_term.\n        Q_l2 = -(l2 + E0) * np.exp(-l2 / E0)\n        Q_u2 = -(u2 + E0) * np.exp(-u2 / E0)\n        integral_of_EpE = (Q_l2 - Q_u2) / D_term\n        term2_contrib = (0.4 / Ed) * integral_of_EpE\n        # Add contribution only where the integration interval is valid.\n        integral_val += np.where(u2 > l2, term2_contrib, 0.0)\n\n        # The total rate R is the PKA rate A times the expected defect yield.\n        R = A * integral_val\n        return R\n\n    # Define test cases: ( (median, gsd)_Ed, (median, gsd)_A, (median, gsd)_E0, Emax )\n    test_cases = [\n        (((90., 1.10), (1e6, 1.05), (15000., 1.30)), 50000.),\n        (((90., 1.30), (1e6, 1.05), (15000., 1.10)), 50000.),\n        (((90., 1.05), (1e6, 1.50), (15000., 1.10)), 50000.),\n        (((90., 1.20), (1e6, 1.05), (120., 1.20)), 1000.),\n    ]\n\n    N = 20000  # Number of Monte Carlo samples\n    k = 3      # Number of uncertain parameters\n    \n    # Use a fixed seed for the random number generator for reproducibility.\n    rng = np.random.default_rng(42)\n    results = []\n\n    for params, Emax in test_cases:\n        # Lognormal distribution parameters (mu, sigma)\n        mus = [np.log(p[0]) for p in params]\n        sigmas = [np.log(p[1]) for p in params]\n\n        # Generate two independent standard normal sample matrices\n        z_A = rng.normal(size=(N, k))\n        z_B = rng.normal(size=(N, k))\n\n        # Transform samples to the lognormal parameter space\n        mat_A = np.zeros_like(z_A)\n        mat_B = np.zeros_like(z_B)\n        for i in range(k):\n            mat_A[:, i] = np.exp(mus[i] + sigmas[i] * z_A[:, i])\n            mat_B[:, i] = np.exp(mus[i] + sigmas[i] * z_B[:, i])\n\n        # Evaluate the model on the two main sample matrices\n        y_A = calculate_R(mat_A[:, 0], mat_A[:, 1], mat_A[:, 2], Emax)\n        y_B = calculate_R(mat_B[:, 0], mat_B[:, 1], mat_B[:, 2], Emax)\n\n        # Calculate the variance of the output, used in the estimator's denominator\n        var_y_A = np.var(y_A, ddof=1)\n        \n        # If variance is near zero, sensitivities are ill-defined.\n        if var_y_A < 1e-20:\n            dominant_index = 0  # Default to the first parameter\n        else:\n            sobol_indices = np.zeros(k)\n            for i in range(k):\n                # Create the mixed matrix A_B^(i)\n                mat_AB_i = mat_A.copy()\n                mat_AB_i[:, i] = mat_B[:, i]\n                \n                # Evaluate the model on the mixed matrix\n                y_AB_i = calculate_R(mat_AB_i[:, 0], mat_AB_i[:, 1], mat_AB_i[:, 2], Emax)\n\n                # Jansen estimator for the first-order Sobol index\n                numerator = np.mean((y_B - y_AB_i)**2)\n                sobol_indices[i] = 1.0 - numerator / (2.0 * var_y_A)\n\n            dominant_index = np.argmax(sobol_indices)\n        \n        results.append(dominant_index)\n\n    # Print the final result in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}