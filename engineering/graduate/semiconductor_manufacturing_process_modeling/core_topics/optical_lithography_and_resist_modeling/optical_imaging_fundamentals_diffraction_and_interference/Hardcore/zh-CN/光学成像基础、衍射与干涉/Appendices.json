{
    "hands_on_practices": [
        {
            "introduction": "在我们能够模拟复杂光掩模的成像之前，我们必须首先掌握一个简单的特征——一个狭缝——是如何散射光线的。这个练习将引导你从第一性原理出发，推导矩形孔径的经典夫琅禾费衍射图样。理解这种本质上是傅里叶变换的关系，是建立任何光学成像模型的第一步。你将确定此图样的关键特征，例如零点的位置和中央主瓣的宽度，这些都与分辨率的概念直接相关。",
            "id": "4145745",
            "problem": "在用于半导体制造的先进光学光刻技术中，由掩模开口产生的空中成像是使用远场（Fraunhofer）近似下的标量衍射理论来建模的。考虑一束来自受激辐射光放大（LASER）的单色相干平面波，其真空波长为 $\\lambda$，垂直入射到一个在 $y$ 方向上无限延伸、在 $x$ 方向上具有有限宽度 $w$ 的一维狭缝上。孔径透射率在 $|x|\\leq w/2$ 时为 $A(x)=1$，在其他情况下为 $A(x)=0$。观察在远场中相对于光轴（$z$ 方向）成 $\\theta$ 角的位置进行，使得标量 Kirchhoff 衍射积分简化为 $A(x)$ 的傅里叶变换，该变换在空间频率 $k_{x}=k\\sin\\theta$ 处求值，其中 $k=2\\pi/\\lambda$ 是自由空间波数。\n\n从 Huygens–Fresnel 原理和 Fraunhofer 衍射近似出发，推导远场光强分布 $I(\\theta)$（精确到一个乘法常数），并由此确定：\n\n1. $I(\\theta)$ 的所有零点（极小值点）的角位置 $\\theta_{m}$，由非零整数阶 $m\\in\\mathbb{Z}\\setminus\\{0\\}$ 索引，且满足物理约束 $|\\sin\\theta_{m}|\\leq 1$。\n2. 主瓣的全角宽度 $\\Delta\\theta_{\\text{main}}$，定义为关于 $\\theta=0$ 对称分布的前两个零点之间的角间距。\n\n将 $\\theta_{m}$ 和 $\\Delta\\theta_{\\text{main}}$ 的最终结果表示为以 $w$ 和 $\\lambda$ 表示的闭式解析表达式。角度以弧度表示。无需进行数值计算或四舍五入。您的最终答案必须是包含两个结果的单一复合表达式。",
            "solution": "问题陈述经评估有效。其科学依据是物理光学的基石——Fraunhofer 衍射原理。该问题提法恰当，所有必要条件和变量均已定义，可得唯一且有意义的解。语言客观、正式。\n\n该问题要求推导在相干、单色、垂直照明下单缝的远场光强分布。根据所提供的信息（这与 Fraunhofer 衍射的标量理论一致），在远场观测角 $\\theta$ 处，衍射电场的复振幅 $E$ 与孔径透射函数 $A(x)$ 的傅里叶变换成正比。傅里叶变换在空间频率 $k_x = k\\sin\\theta$ 处求值，其中 $k = 2\\pi/\\lambda$ 是波数，$\\lambda$ 是光的真空波长， $x$ 是穿过孔径的坐标。\n\n宽度为 $w$、中心在原点的狭缝的孔径透射函数 $A(x)$ 给出如下：\n$$\nA(x) =\n\\begin{cases}\n1  \\text{for } |x| \\leq w/2 \\\\\n0  \\text{for } |x| > w/2\n\\end{cases}\n$$\n因此，远场振幅 $E(\\theta)$ 与 $A(x)$ 的傅里叶变换成正比：\n$$\nE(\\theta) \\propto \\int_{-\\infty}^{\\infty} A(x) \\exp(-i k_x x) \\,dx\n$$\n代入 $A(x)$ 的表达式：\n$$\nE(\\theta) \\propto \\int_{-w/2}^{w/2} 1 \\cdot \\exp(-i k_x x) \\,dx\n$$\n我们计算此积分：\n$$\n\\int_{-w/2}^{w/2} \\exp(-i k_x x) \\,dx = \\left[ \\frac{\\exp(-i k_x x)}{-i k_x} \\right]_{-w/2}^{w/2}\n$$\n假设 $k_x \\neq 0$：\n$$\n= \\frac{\\exp(-i k_x w/2) - \\exp(i k_x w/2)}{-i k_x} = \\frac{\\exp(i k_x w/2) - \\exp(-i k_x w/2)}{i k_x}\n$$\n使用欧拉恒等式 $\\sin(\\alpha) = \\frac{\\exp(i\\alpha) - \\exp(-i\\alpha)}{2i}$，我们可以重写该表达式：\n$$\n= \\frac{2 \\sin(k_x w/2)}{k_x}\n$$\n为了将其表示为 sinc 函数的形式，我们乘以并除以 $w/2$：\n$$\n= w \\frac{\\sin(k_x w/2)}{k_x w/2}\n$$\n现在，我们代入空间频率 $k_x = k \\sin\\theta = \\frac{2\\pi}{\\lambda}\\sin\\theta$。正弦函数的宗量变为：\n$$\n\\frac{k_x w}{2} = \\frac{1}{2} \\left( \\frac{2\\pi}{\\lambda}\\sin\\theta \\right) w = \\frac{\\pi w \\sin\\theta}{\\lambda}\n$$\n所以，远场振幅为：\n$$\nE(\\theta) \\propto w \\frac{\\sin\\left(\\frac{\\pi w \\sin\\theta}{\\lambda}\\right)}{\\frac{\\pi w \\sin\\theta}{\\lambda}}\n$$\n衍射光的光强 $I(\\theta)$ 与复振幅的模的平方成正比，即 $I(\\theta) \\propto |E(\\theta)|^2$。因此，忽略一个乘法常数，光强分布为：\n$$\nI(\\theta) \\propto \\left[ \\frac{\\sin\\left(\\frac{\\pi w \\sin\\theta}{\\lambda}\\right)}{\\frac{\\pi w \\sin\\theta}{\\lambda}} \\right]^2\n$$\n这是单缝衍射经典的 sinc 平方光强图样。\n\n1. 确定零点角位置 $\\theta_m$：\n光强分布 $I(\\theta)$ 的零点（极小值点）出现在分子为零而分母不为零的位置。分子 $\\sin\\left(\\frac{\\pi w \\sin\\theta}{\\lambda}\\right)$ 在其宗量为 $\\pi$ 的非零整数倍时为零。\n$$\n\\frac{\\pi w \\sin\\theta_m}{\\lambda} = m\\pi, \\quad \\text{for } m \\in \\mathbb{Z} \\setminus \\{0\\}\n$$\n$m=0$ 的情况被排除，因为它对应于 $\\theta=0$。对于 $\\theta \\to 0$，表达式 $\\sin(\\alpha)/\\alpha \\to 1$，这给出了衍射图样的主极大值，而不是零点。\n解出 $\\sin\\theta_m$：\n$$\n\\sin\\theta_m = \\frac{m\\lambda}{w}\n$$\n角位置 $\\theta_m$ 进而通过对此表达式取反正弦函数得到。物理约束 $|\\sin\\theta_m| \\leq 1$ 意味着解只存在于满足 $|m| \\leq w/\\lambda$ 的整数阶 $m$。反正弦（arcsin）函数的定义域自动满足此约束。\n$$\n\\theta_m = \\arcsin\\left(\\frac{m\\lambda}{w}\\right), \\quad \\text{for } m \\in \\mathbb{Z} \\setminus \\{0\\} \\text{ such that } \\left|\\frac{m\\lambda}{w}\\right| \\leq 1\n$$\n\n2. 确定主瓣的全角宽度 $\\Delta\\theta_{\\text{main}}$：\n主瓣是中心亮条纹，中心位于 $\\theta=0$。其角范围由中心两侧的第一级零点界定。这些对应于整数阶 $m=1$ 和 $m=-1$。\n对于 $m=1$ 的第一级零点的角位置是：\n$$\n\\theta_1 = \\arcsin\\left(\\frac{1 \\cdot \\lambda}{w}\\right) = \\arcsin\\left(\\frac{\\lambda}{w}\\right)\n$$\n对于 $m=-1$ 的第一级零点的角位置是：\n$$\n\\theta_{-1} = \\arcsin\\left(\\frac{-1 \\cdot \\lambda}{w}\\right) = -\\arcsin\\left(\\frac{\\lambda}{w}\\right)\n$$\n主瓣的全角宽度 $\\Delta\\theta_{\\text{main}}$ 是这两个零点之间的角间距：\n$$\n\\Delta\\theta_{\\text{main}} = \\theta_1 - \\theta_{-1} = \\arcsin\\left(\\frac{\\lambda}{w}\\right) - \\left(-\\arcsin\\left(\\frac{\\lambda}{w}\\right)\\right)\n$$\n$$\n\\Delta\\theta_{\\text{main}} = 2\\arcsin\\left(\\frac{\\lambda}{w}\\right)\n$$\n该表达式是精确的角宽度。在 $\\lambda \\ll w$ 的常见小角度近似下，$\\arcsin(x) \\approx x$，这将得出 $\\Delta\\theta_{\\text{main}} \\approx 2\\lambda/w$。然而，问题没有指定此近似，因此需要精确形式。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\arcsin\\left(\\frac{m\\lambda}{w}\\right) & 2\\arcsin\\left(\\frac{\\lambda}{w}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "现实世界的光刻系统并不使用理想的单一平面波进行照明，而是使用来自扩展光源的“部分相干光”，以平衡分辨率和工艺稳健性。本练习介绍了用于量化这一特性的关键参数：部分相干因子 $\\sigma$。通过推导和计算 $\\sigma$ 值，你将把照明光源的属性与投影透镜的接收角联系起来，并开始建立关于该参数如何影响图像对比度的直观认识。",
            "id": "4145681",
            "problem": "在用于半导体制造的先进光学光刻技术中，周期性结构的成像是受衍射和干涉所支配的，在一个投影系统中，其性能受到透镜光瞳的限制。考虑一个深紫外（DUV）浸没式投影系统，其照明由一个空间均匀的圆形光源提供，该光源以有限的角半半径填充投影透镜的入射光瞳。成像发生在折射率为 $n$ 的浸没介质中，并且投影透镜定义了一个最大光瞳半角，超过该角度的衍射级将无法透射。\n\n从衍射受限成像的基本原理，特别是阿贝成像理论和数值孔径（NA）的定义出发，推导部分相干性参数（通常用 $\\sigma$ 表示）的表达式，该表达式用光源角半半径和投影透镜光瞳半角来表示，两者均在同一介质中测量。然后，根据以下物理上一致的参数计算其值：\n- 浸没介质的折射率：$n = 1.44$。\n- 光源角半半径：$\\theta_{s} = \\frac{\\pi}{6}$ 弧度。\n- 投影透镜最大光瞳半角：$\\theta_{p} = \\frac{\\pi}{3}$ 弧度。\n\n最后，基于衍射和干涉的论证，简要解释所计算的 $\\sigma$ 值将如何影响一个空间频率接近投影系统分辨率极限的密集线空间光栅的成像对比度，并与完全相干照明（即 $\\sigma \\to 0$）和准非相干照明（即 $\\sigma \\to 1$）这两种极限情况进行比较。\n\n将计算出的 $\\sigma$ 值表示为一个无量纲数，并将您的答案四舍五入至四位有效数字。角度以弧度为单位给出。",
            "solution": "该问题要求推导部分相干性参数 $\\sigma$，为一组给定参数计算其值，并对其对图像对比度的影响进行物理解释。该问题表述清晰，科学上基于应用于光刻的傅里叶光学原理，并提供了一套一致且完整的参数。\n\n验证过程确认了该问题的有效性：\n1.  **提取已知条件**：\n    - 浸没介质的折射率：$n = 1.44$\n    - 光源角半半径：$\\theta_{s} = \\frac{\\pi}{6}$ 弧度\n    - 投影透镜最大光瞳半角：$\\theta_{p} = \\frac{\\pi}{3}$ 弧度\n2.  **验证**：\n    - 该问题在科学上是合理的，基于成熟的阿贝成像理论和光学光刻中部分相干性的定义。\n    - 所有术语都定义明确，所提供的数值对于现代浸没式光刻系统是物理上现实的。例如，投影透镜的数值孔径将是 $n \\sin(\\theta_{p}) = 1.44 \\sin(\\frac{\\pi}{3}) = 1.44 \\frac{\\sqrt{3}}{2} \\approx 1.247$，这是此类系统的典型值。\n    - 该问题是自洽的，没有矛盾之处。\n\n该问题被认为是有效的。我们继续进行求解。\n\n解决方案分为三个部分：推导、计算和解释。\n\n**第一部分：部分相干性参数 $\\sigma$ 的推导**\n\n根据阿贝理论，投影系统中的图像形成是一个两步过程：首先，物体（光掩模）将入射照明衍射成一系列平面波（衍射级）；其次，投影透镜在其光瞳内收集这部分衍射光，并使其重新干涉，从而在晶圆上形成图像。\n\n收集到的衍射级的范围由投影透镜的数值孔径（NA）决定。$\\text{NA}$ 定义为：\n$$\\text{NA} = n \\sin(\\theta_{\\text{max}})$$\n其中 $n$ 是成像发生所在介质的折射率，$\\theta_{\\text{max}}$ 是可以进入或离开透镜的光锥的最大半角。对于投影透镜，这个角度是光瞳半角 $\\theta_{p}$。\n因此，投影透镜的数值孔径是：\n$$\\text{NA}_{\\text{lens}} = n \\sin(\\theta_{p})$$\n\n照明系统也由一个数值孔径来表征，它描述了掩模被照明的角度范围。对于角半半径为 $\\theta_{s}$ 的圆形光源，照明的数值孔径是：\n$$\\text{NA}_{\\text{illum}} = n \\sin(\\theta_{s})$$\n\n部分相干性参数 $\\sigma$ 是一个无量纲的量，用于量化照明的相干程度。它被定义为照明系统的数值孔径与投影透镜的数值孔径之比：\n$$\\sigma = \\frac{\\text{NA}_{\\text{illum}}}{\\text{NA}_{\\text{lens}}}$$\n当两者都投影到光瞳平面上时，这个比率有效地比较了照明光源的角范围与透镜光瞳的接收角。\n\n代入 $\\text{NA}_{\\text{illum}}$ 和 $\\text{NA}_{\\text{lens}}$ 的表达式，得到：\n$$\\sigma = \\frac{n \\sin(\\theta_{s})}{n \\sin(\\theta_{p})}$$\n由于两个角度都是在折射率为 $n$ 的同一浸没介质中测量的，因此折射率 $n$ 可以消去。最终推导出的表达式是：\n$$\\sigma = \\frac{\\sin(\\theta_{s})}{\\sin(\\theta_{p})}$$\n\n**第二部分：$\\sigma$ 的计算**\n\n我们已知以下数值：\n- 光源角半半径：$\\theta_{s} = \\frac{\\pi}{6}$ 弧度。\n- 投影透镜最大光瞳半角：$\\theta_{p} = \\frac{\\pi}{3}$ 弧度。\n\n首先，我们计算每个角度的正弦值：\n$$\\sin(\\theta_{s}) = \\sin\\left(\\frac{\\pi}{6}\\right) = \\frac{1}{2}$$\n$$\\sin(\\theta_{p}) = \\sin\\left(\\frac{\\pi}{3}\\right) = \\frac{\\sqrt{3}}{2}$$\n\n现在，我们将这些值代入推导出的 $\\sigma$ 表达式中：\n$$\\sigma = \\frac{\\sin(\\theta_{s})}{\\sin(\\theta_{p})} = \\frac{1/2}{\\sqrt{3}/2} = \\frac{1}{\\sqrt{3}}$$\n\n为了获得数值，我们计算结果并按要求四舍五入到四位有效数字：\n$$\\sigma = \\frac{1}{\\sqrt{3}} \\approx 0.577350269...$$\n四舍五入到四位有效数字，得到：\n$$\\sigma \\approx 0.5774$$\n\n**第三部分：对成像对比度影响的解释**\n\n计算出的值 $\\sigma \\approx 0.5774$ 代表部分相干状态。我们被要求将这种条件下，分辨率极限附近密集光栅的成像对比度与完全相干照明（$\\sigma \\to 0$）和准非相干照明（$\\sigma \\to 1$）的极限情况进行比较。\n\n周期性结构的图像对比度源于至少两个衍射级（对于简单光栅是 $0^{\\text{th}}$ 级和 $\\pm 1^{\\text{st}}$ 级）被透镜光瞳收集后的干涉。\n\n- **完全相干照明 ($\\sigma \\to 0$)**：照明是单一的、轴上的平面波。衍射级在光瞳中是离散的点。如果 $0^{\\text{th}}$ 级和 $\\pm 1^{\\text{st}}$ 级都被捕获，它们会以固定的相位关系进行干涉。这可以产生可能达到的最高图像对比度（调制），可能达到 $100\\%$。然而，分辨率受到限制，并且这种理想的对比度对像差（如离焦）非常敏感。\n\n- **准非相干照明 ($\\sigma \\to 1$)**：照明光源充满了整个光瞳（$\\text{NA}_{\\text{illum}} \\approx \\text{NA}_{\\text{lens}}$）。最终的图像是由光源上每个独立点产生的图像的强度总和。对于接近分辨率极限的光栅，许多照明角度将导致只有 $0^{\\text{th}}$ 级被捕获，这会贡献均匀的背景强度而不能形成图案。这种背景光的叠加严重降低了整体图像对比度，尽管光源上的一些离轴点可能比轴上相干情况能提高分辨率。\n\n- **部分相干 ($\\sigma \\approx 0.5774$)**：这是一种实际的折衷方案。照明光源是扩展的，但小于光瞳。与相干情况（$\\sigma \\to 0$）相比，对比度降低了。其原因是干涉是在一个连续的照明角度范围内平均的结果。这种平均过程模糊了理想相干干涉图样的尖锐零点，从而降低了峰谷强度差（调制）。然而，与准非相干情况（$\\sigma \\to 1$）相比，对比度显著更高。通过限制光源尺寸（$\\sigma  1$），我们排除了那些只贡献背景光而不提供图案信息的照明角度。这保留了基于干涉的调制度的很大部分，同时获得了一些离轴照明的好处，例如对某些特征类型有更高的分辨率和更好的焦深，这些对于稳健的制造过程至关重要。\n\n总而言之，计算出的 $\\sigma$ 值提供了一种平衡，牺牲了相干成像的一些最大理论对比度，以换取比纯相干和准非相干极限更高的实际分辨率和工艺稳定性。",
            "answer": "$$\\boxed{0.5774}$$"
        },
        {
            "introduction": "最后的这个练习将你从解析性的理解推向计算工程的实践，这是现代工艺建模中的一项核心技能。你将应用衍射和部分相干性的原理来解决一个实际场景：优化环形照明光源，以便为特定的线-空间图形获得最佳的图像对比度。这个编程练习模拟了光刻工程师的工作，并以一种强大的、动手实践的方式，展示了傅里叶光学如何被用来设计和调整先进的分辨率增强技术。",
            "id": "4145707",
            "problem": "要求您编写一个程序，对于一个通过标量、无像差的投影系统成像的一维周期性线-空间图案，计算最优的环形光源参数 $\\left(\\sigma_{in},\\sigma_{out}\\right)$，以最大化图案基频空间频率处的空气像对比度。该设置反映了在波长 $\\lambda=193\\,\\mathrm{nm}$ 和数值孔径 (NA) $=0.93$ 条件下的先进光学光刻技术，其中部分相干照明被建模为光源光瞳中的一个均匀强度的环带。目标是首先从第一性原理出发，使用标量傅里叶光学理论来构建部分相干照明下物理上一致的图像形成过程，然后实现一个对环形光源参数的数值搜索，以最大化对比度。您的程序必须实现该模型，并针对一组给定的目标节距测试套件执行优化。\n\n基本物理和建模假设：\n- 在空间频率域中使用标量 Abbe 成像理论。令光瞳截止空间频率为 $f_c=\\mathrm{NA}/\\lambda$。一个光源点在归一化光瞳坐标中由半径 $\\sigma\\in[0,1]$ 和方位角 $\\theta\\in[0,2\\pi)$ 表示，其中 $\\sigma=1$ 对应于光瞳边缘。\n- 考虑一个一维二元振幅掩模（薄掩模，无成像偏差），由占空比为 $0.5$ 的周期性线-空间图案组成（即线条和空间宽度相等）。该掩模的振幅透射率具有傅里叶级数振幅，给定为 $A_0=0.5$ 和 $A_{\\pm 1}=1/\\pi$，且对于偶数 $m\\neq 0$，$A_m=0$。这些值是从占空比为 $50\\%$ 的矩形波的标准傅里叶级数中获得的。\n- 在空气像中只需考虑 $m=0$ 和 $m=\\pm 1$ 衍射级次（忽略更高阶级次）。图案的空间频率为 $k=1/p$，其中 $p$ 是节距。引入归一化频率 $\\nu=\\lambda/(\\mathrm{NA}\\,p)$。\n- 对于一个给定的光源点 $\\left(\\sigma,\\theta\\right)$，在一个沿着线-空间方向的一维切面上，$m=0$ 级次位于归一化光瞳坐标 $\\sigma\\cos\\theta$ 处，$m=+1$ 级次位于 $\\sigma\\cos\\theta+\\nu$ 处，而 $m=-1$ 级次位于 $\\sigma\\cos\\theta-\\nu$ 处。一个衍射级次能被透射，当且仅当其归一化坐标的绝对值 $\\leq 1$。\n- 空气像强度是通过对环形光源上的每个光源点所形成的强度进行非相干平均得到的。由于部分相干性，您必须对强度（而非场）进行平均。对基频空间频率的贡献来自于 $m=0$ 级次与每个被透射的 $m=\\pm 1$ 级次之间的干涉。对于处于最佳焦点的远心投影系统，来自 $m=+1$ 和 $m=-1$ 分支的贡献以相同的相位叠加。\n\n对比度的定义及待实现的计算：\n- 对于单个光源点 $\\left(\\sigma,\\theta\\right)$，定义指示函数 $P_{+}(\\sigma,\\theta;\\nu)$ 和 $P_{-}(\\sigma,\\theta;\\nu)$，如果 $m=+1$ 或 $m=-1$ 级次分别被透射，则其值为 $1$，否则为 $0$。使用透射条件 $|\\sigma\\cos\\theta+\\nu|\\leq 1$ 和 $|\\sigma\\cos\\theta-\\nu|\\leq 1$。角度必须以弧度为单位。\n- 对于该单个光源点，当只保留 $m=0$ 和 $m=\\pm 1$ 级次时，强度的基波（$\\cos(2\\pi x/p)$ 的系数）的振幅正比于 $2A_0A_1\\left(P_{+}+P_{-}\\right)$，而直流（DC）强度（空间平均值）为 $A_0^2 + A_1^2\\left(P_{+}+P_{-}\\right)$。\n- 部分相干图像的对比度是光源平均后的基波振幅与光源平均后的直流强度之比，其中平均是在与 $\\sigma\\,d\\sigma\\,d\\theta$ 成正比的环形光源面积元上进行的。也就是说，您必须计算在 $\\sigma\\in[\\sigma_{in},\\sigma_{out}]$ 和 $\\theta\\in[0,2\\pi)$ 上的面积加权平均值。\n\n优化任务：\n- 对于每个目标节距 $p$，在满足 $0 \\le \\sigma_{in}  \\sigma_{out} \\le 1$、最小环带厚度约束 $\\sigma_{out}-\\sigma_{in}\\ge \\Delta\\sigma_{min}$ 以及环带上光源强度均匀的条件下，对环形光源 $\\left(\\sigma_{in},\\sigma_{out}\\right)$ 进行离散网格搜索。\n- 在 $\\sigma$ 上使用步长为 $\\Delta\\sigma=0.01$ 的均匀网格，并限制 $\\sigma_{in}\\ge 0.20$ 以反映实际的光源遮蔽。使用 $\\Delta\\sigma_{min}=0.05$。对于 $\\theta$ 的积分，使用均匀角度采样，在 $[0,2\\pi)$ 范围内（以弧度为单位）取 $N_\\theta=4096$ 个样本。\n- 对于每个候选环带，根据上述模型通过离散求和来数值近似对比度。然后选择最大化对比度的 $\\left(\\sigma_{in},\\sigma_{out}\\right)$。\n- 决胜规则：如果多个候选方案在 $10^{-12}$ 的绝对容差内达到最大对比度，则选择环带厚度 $\\sigma_{out}-\\sigma_{in}$ 最小的那个。如果仍然平局，选择最小的 $\\sigma_{out}$，然后再选择最小的 $\\sigma_{in}$。\n- 在边缘情况下，如果所有候选方案的最大对比度在 $10^{-12}$ 的绝对容差内等于零（即，对于任何光源点，都没有可分辨的一阶衍射，例如当 $\\nu2$ 时），则为该测试用例返回 $\\left(-1.0,-1.0\\right)$。\n\n数值常量和单位：\n- 使用 $\\lambda=193\\,\\mathrm{nm}$ 和 $\\mathrm{NA}=0.93$。\n- 目标节距 $p$ 以纳米为单位指定，并且在计算 $\\nu=\\lambda/(\\mathrm{NA}\\,p)$ 时必须与 $\\lambda$ 一致地处理。\n- 角度必须以弧度为单位。\n- 您的输出参数 $\\sigma_{in},\\sigma_{out}$ 是无量纲的，并且必须四舍五入到三位小数。\n\n测试套件：\n- 使用以下四个节距：$p\\in\\{220\\,\\mathrm{nm},130\\,\\mathrm{nm},105\\,\\mathrm{nm},95\\,\\mathrm{nm}\\}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个类似 Python 的列表，内有四个元素，每个元素对应一个测试用例，顺序与上文相同。每个元素必须是一个包含两个元素的列表 $\\left[\\sigma_{in},\\sigma_{out}\\right]$，并四舍五入到三位小数。例如，一个有效的输出行格式为 $[[0.300,0.700],[0.250,0.850],[0.210,0.780],[-1.000,-1.000]]$，除了分隔标记所必需的空格外，没有多余的空格。\n- 不允许用户输入；程序必须按原样运行并打印出所要求的单行内容。您的实现必须遵守上述积分和离散化指令，并且不得调用任何外部文件或网络。",
            "solution": "用户提供了一个光学光刻建模领域中定义明确的问题。我们对问题陈述进行了验证，发现其在科学上是合理的、适定的和客观的。该问题要求确定最优的环形照明参数，以最大化几种周期性图案的空气像对比度。解决方案将从标量傅里叶光学的第一性原理推导得出，并根据指定的约束条件，以网格搜索优化的形式进行数值实现。\n\n解决方案分为三个主要阶段：\n1.  **解析公式推导**：我们推导出部分相干环形照明下的空气像对比度表达式。\n2.  **数值近似**：我们根据问题的要求，对解析表达式进行离散化，以便进行数值计算。\n3.  **优化算法**：我们设计一个网格搜索算法，以找到使计算出的对比度最大化的最优光源参数，其中包括指定的决胜逻辑。\n\n**1. 对比度的解析公式推导**\n\n该系统由一个投影系统组成，它在波长 $\\lambda$ 下对节距为 $p$ 的周期性掩模进行成像，其数值孔径为 $NA$。控制分辨率的关键参数是图案的归一化空间频率 $\\nu$：\n$$ \\nu = \\frac{\\lambda}{NA \\cdot p} $$\n掩模是一个占空比为 $50\\%$ 的一维线-空间图案。对于这样的二元振幅光栅，其透射率函数的傅里叶级数振幅是给定的。我们只考虑中心三个衍射级次：零级（$m=0$）和一级（$m=\\pm 1$）。它们的振幅被提供为 $A_0 = 0.5$ 和 $A_1 = 1/\\pi$（我们假设 $A_{-1}$ 和 $A_1$ 的大小相等，这是标准做法，并且在问题陈述中已隐含）。\n\n照明是部分相干的，源于一个环形光源。光源上的一个点由归一化光瞳坐标 $(\\sigma, \\theta)$ 描述，其中 $\\sigma$ 是径向坐标（$0 \\le \\sigma \\le 1$），$\\theta$ 是方位角（$0 \\le \\theta  2\\pi$）。对于光源上的一个点 $(\\sigma, \\theta)$，三个衍射级次在投影透镜的光瞳中发生位移。沿着与图案周期性平行的轴，它们的归一化位置是：\n-   $m=0$ 级次：$u_0 = \\sigma \\cos\\theta$\n-   $m=+1$ 级次：$u_{+1} = \\sigma \\cos\\theta + \\nu$\n-   $m=-1$ 级次：$u_{-1} = \\sigma \\cos\\theta - \\nu$\n\n如果一个级次的位置的绝对值不超过光瞳半径，即 $|u_m| \\le 1$，那么它就能通过系统。$m=0$ 级次总是被透射，因为 $|\\sigma \\cos\\theta| \\le \\sigma \\le 1$。一级衍射的透射是有条件的。我们定义指示函数 $P_{+}(\\sigma, \\theta; \\nu)$ 和 $P_{-}(\\sigma, \\theta; \\nu)$：\n$$ P_{+}(\\sigma, \\theta; \\nu) = \\begin{cases} 1,  \\text{if } |\\sigma \\cos\\theta + \\nu| \\le 1 \\\\ 0,  \\text{otherwise} \\end{cases} $$\n$$ P_{-}(\\sigma, \\theta; \\nu) = \\begin{cases} 1,  \\text{if } |\\sigma \\cos\\theta - \\nu| \\le 1 \\\\ 0,  \\text{otherwise} \\end{cases} $$\n对于单个光源点，空气像强度 $I(x)$ 是由透射的衍射级次干涉产生的。图像对比度由基波分量和直流（平均）强度定义。使用所提供的模型：\n-   基波振幅（与 $\\cos(2\\pi x/p)$ 成正比）：$N_{sp}(\\sigma, \\theta) = 2 A_0 A_1 (P_{+} + P_{-})$\n-   强度的直流分量：$D_{sp}(\\sigma, \\theta) = A_0^2 + A_1^2 (P_{+} + P_{-})$\n\n为了找到由内半径 $\\sigma_{in}$ 和外半径 $\\sigma_{out}$ 定义的完整环形光源的对比度，我们必须在环带面积上对这些量进行平均。面积元为 $dA = \\sigma \\, d\\sigma \\, d\\theta$。\n光源平均后的基波振幅为 $\\langle N \\rangle$，光源平均后的直流强度为 $\\langle D \\rangle$。图像对比度 $C$ 是它们的比值：\n$$ C = \\frac{\\langle N \\rangle}{\\langle D \\rangle} = \\frac{\\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} N_{sp}(\\sigma, \\theta) \\, \\sigma \\, d\\sigma \\, d\\theta}{\\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} D_{sp}(\\sigma, \\theta) \\, \\sigma \\, d\\sigma \\, d\\theta} $$\n代入 $N_{sp}$ 和 $D_{sp}$ 的表达式：\n$$ C(\\sigma_{in}, \\sigma_{out}, \\nu) = \\frac{2 A_0 A_1 \\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} (P_{+} + P_{-}) \\, \\sigma \\, d\\sigma \\, d\\theta}{A_0^2 \\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} \\sigma \\, d\\sigma \\, d\\theta + A_1^2 \\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} (P_{+} + P_{-}) \\, \\sigma \\, d\\sigma \\, d\\theta} $$\n我们定义两个积分来简化这个表达式。首先，一个角度积分 $I(\\sigma, \\nu)$：\n$$ I(\\sigma, \\nu) = \\int_{0}^{2\\pi} [P_{+}(\\sigma, \\theta; \\nu) + P_{-}(\\sigma, \\theta; \\nu)] \\, d\\theta $$\n以及一个径向积分 $J(\\sigma_{in}, \\sigma_{out}, \\nu)$：\n$$ J(\\sigma_{in}, \\sigma_{out}, \\nu) = \\int_{\\sigma_{in}}^{\\sigma_{out}} I(\\sigma, \\nu) \\, \\sigma \\, d\\sigma $$\n分母中的光源面积分就是 $\\int_{\\sigma_{in}}^{\\sigma_{out}} 2\\pi\\sigma \\, d\\sigma = \\pi(\\sigma_{out}^2 - \\sigma_{in}^2)$。\n对比度表达式变为：\n$$ C(\\sigma_{in}, \\sigma_{out}, \\nu) = \\frac{2 A_0 A_1 J(\\sigma_{in}, \\sigma_{out}, \\nu)}{\\pi A_0^2 (\\sigma_{out}^2 - \\sigma_{in}^2) + A_1^2 J(\\sigma_{in}, \\sigma_{out}, \\nu)} $$\n\n**2. 数值近似**\n\n为了找到最优的 $(\\sigma_{in}, \\sigma_{out})$，我们必须对这个对比度表达式进行数值评估。问题中指定了离散化方法。\n-   角度积分 $I(\\sigma, \\nu)$ 通过对 $N_\\theta = 4096$ 个等间距角度 $\\theta_j = j \\frac{2\\pi}{N_\\theta}$（其中 $j=0, \\dots, N_\\theta-1$）求和来近似。\n$$ I(\\sigma, \\nu) \\approx \\frac{2\\pi}{N_\\theta} \\sum_{j=0}^{N_\\theta-1} [P_{+}(\\sigma, \\theta_j; \\nu) + P_{-}(\\sigma, \\theta_j; \\nu)] $$\n-   优化是在 $\\sigma_{in}$ 和 $\\sigma_{out}$ 的离散值上进行网格搜索。$\\sigma$ 的网格步长为 $\\Delta\\sigma = 0.01$。对于每个候选环带 $(\\sigma_{in}, \\sigma_{out})$，从这个网格计算径向积分 $J$。我们使用梯形法则进行此积分：\n$$ J(\\sigma_{in}, \\sigma_{out}, \\nu) \\approx \\int_{\\sigma_{in}}^{\\sigma_{out}} I(\\sigma, \\nu) \\sigma \\, d\\sigma $$\n数值评估将在落入 $[\\sigma_{in}, \\sigma_{out}]$ 区间内的离散 $\\sigma$ 点集上执行。\n\n**3. 优化算法**\n\n对于每个目标节距 $p$，我们执行以下步骤：\n1.  计算归一化频率 $\\nu$。如果 $\\nu > 2$，则不可能有一阶衍射（因为我们需要 $|\\sigma \\cos\\theta \\pm \\nu| \\le 1$，这要求 $|\\pm \\nu| - |\\sigma \\cos\\theta| \\le 1 \\implies \\nu - \\sigma \\le 1 \\implies \\nu-1 \\le \\sigma \\le 1$，如果 $\\nu>2$ 则这是不可能的）。在这种情况下，对比度始终为零，我们返回 $(-1.0, -1.0)$。\n2.  定义从 $\\sigma=0.20$ 到 $\\sigma=1.00$，步长为 $\\Delta\\sigma = 0.01$ 的离散 $\\sigma$ 网格。\n3.  使用离散角度求和，为网格上的每个 $\\sigma$ 预计算 $I(\\sigma, \\nu)$ 的值。\n4.  将 `best_contrast` 初始化为负值，并将 `best_params` 初始化为默认值。\n5.  遍历 $\\sigma$ 网格中所有有效的候选环带 $(\\sigma_{in}, \\sigma_{out})$，并满足以下约束条件：\n    - $\\sigma_{in} \\ge 0.20$\n    - $\\sigma_{in}  \\sigma_{out}$\n    - $\\sigma_{out} - \\sigma_{in} \\ge 0.05$\n6.  对于每个候选环带：a. 通过对预计算的 $I(\\sigma, \\nu)\\sigma$ 值进行数值积分（梯形法则）来计算 $J(\\sigma_{in}, \\sigma_{out}, \\nu)$。b. 使用第 1 部分推导的公式计算对比度 $C$。c. 将计算出的对比度与当前最大值进行比较。如果更高，则更新 `best_contrast` 和 `best_params`。比较和更新过程必须严格遵循指定的决胜规则：\n        i.  最高对比度者胜出（在 $10^{-12}$ 的容差内）。\n        ii. 如果平局，则厚度 $(\\sigma_{out} - \\sigma_{in})$ 最小者胜出。\n        iii. 如果仍然平局，则 $\\sigma_{out}$ 最小者胜出。\n        iv. 如果仍然平局，则 $\\sigma_{in}$ 最小者胜出（这由循环顺序解决）。\n7.  检查完所有候选方案后，如果总体的 `best_contrast` 为零（或低于 $10^{-12}$ 容差），则返回 $(-1.0, -1.0)$。否则，返回存储的 `best_params`。\n8.  收集所有节距的最终结果，并按要求格式化。\n该计算过程在以下 Python 脚本中实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    # Define physical constants and test cases\n    lambda_ = 193.0  # Wavelength in nm\n    NA = 0.93        # Numerical Aperture\n    test_pitches = [220.0, 130.0, 105.0, 95.0]  # Pitches in nm\n\n    # Model parameters\n    A0 = 0.5\n    A1 = 1.0 / np.pi\n    \n    # Grid search and integration parameters\n    sigma_min_in = 0.20\n    sigma_max_out = 1.00\n    d_sigma = 0.01\n    min_thickness = 0.05\n    n_theta = 4096\n    \n    # Tolerance for floating point comparisons\n    tol = 1e-12\n\n    results = []\n    for p in test_pitches:\n        s_in, s_out = find_optimal_annulus(p, lambda_, NA, A0, A1,\n                                           sigma_min_in, sigma_max_out, d_sigma,\n                                           min_thickness, n_theta, tol)\n        results.append((s_in, s_out))\n    \n    # Format the output as specified\n    formatted_results = [f\"[{res[0]:.3f},{res[1]:.3f}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef find_optimal_annulus(p, lambda_, NA, A0, A1,\n                        sigma_min_in, sigma_max_out, d_sigma,\n                        min_thickness, n_theta, tol):\n    \"\"\"\n    Finds the optimal annular source parameters (sigma_in, sigma_out) for a given pitch.\n    \"\"\"\n    nu = lambda_ / (NA * p)\n    \n    # If nu > 2, no first-order diffraction is possible. Contrast is always 0.\n    if nu > 2.0:\n        return -1.0, -1.0\n\n    # Define the discrete grid for sigma\n    sigma_grid = np.round(np.arange(sigma_min_in, sigma_max_out + d_sigma/2, d_sigma), 2)\n    num_sigma_points = len(sigma_grid)\n    \n    # Pre-compute angular integral I(sigma, nu) for each sigma on the grid\n    theta = np.linspace(0, 2 * np.pi, n_theta, endpoint=False)\n    cos_theta = np.cos(theta)\n    \n    I_vals = np.zeros(num_sigma_points)\n    for i, sigma in enumerate(sigma_grid):\n        u = sigma * cos_theta\n        P_plus = np.abs(u + nu) = 1.0\n        P_minus = np.abs(u - nu) = 1.0\n        integrand_theta = P_plus + P_minus\n        # discrete integration over theta: sum * d_theta = mean * N_theta * (2*pi/N_theta)\n        I_vals[i] = np.mean(integrand_theta) * 2 * np.pi\n\n    # The integrand for the radial integral J is I(sigma, nu) * sigma\n    integrand_J = I_vals * sigma_grid\n\n    # Initialize variables for optimization\n    best_contrast = -1.0\n    best_params = (-1.0, -1.0)\n    best_thickness = float('inf')\n    best_s_out = float('inf')\n\n    min_thickness_idx_delta = int(round(min_thickness / d_sigma))\n\n    # Grid search over all valid annuli\n    for i in range(num_sigma_points):\n        s_in = sigma_grid[i]\n        # Ensure minimum thickness constraint is met\n        for j in range(i + min_thickness_idx_delta, num_sigma_points):\n            s_out = sigma_grid[j]\n            \n            # Extract sub-arrays for integration over the current annulus\n            sub_sigma_grid = sigma_grid[i:j+1]\n            sub_integrand_J = integrand_J[i:j+1]\n            \n            # The radial integral J, evaluated numerically using the trapezoidal rule.\n            # np.trapz is part of numpy 1.23.5\n            J_val = np.trapz(sub_integrand_J, x=sub_sigma_grid)\n            \n            if abs(J_val)  1e-15:\n                current_contrast = 0.0\n            else:\n                num_term = 2 * A0 * A1 * J_val\n                den_term1 = np.pi * A0**2 * (s_out**2 - s_in**2)\n                den_term2 = A1**2 * J_val\n                current_contrast = num_term / (den_term1 + den_term2)\n\n            current_thickness = s_out - s_in\n\n            # Tie-breaking logic, applied with a numerical tolerance\n            if current_contrast > best_contrast + tol:\n                best_contrast = current_contrast\n                best_params = (s_in, s_out)\n                best_thickness = current_thickness\n                best_s_out = s_out\n            elif abs(current_contrast - best_contrast) = tol:\n                if current_thickness  best_thickness - tol:\n                    best_params = (s_in, s_out)\n                    best_thickness = current_thickness\n                    best_s_out = s_out\n                elif abs(current_thickness - best_thickness) = tol:\n                    if s_out  best_s_out - tol:\n                        best_params = (s_in, s_out)\n                        best_s_out = s_out\n                        # The final tie-breaker on s_in is implicitly handled\n                        # by the loop order, which tests smaller s_in first.\n\n    # Final check for the edge case where no configuration yields contrast\n    if best_contrast = tol:\n      return -1.0, -1.0\n    \n    return best_params\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}