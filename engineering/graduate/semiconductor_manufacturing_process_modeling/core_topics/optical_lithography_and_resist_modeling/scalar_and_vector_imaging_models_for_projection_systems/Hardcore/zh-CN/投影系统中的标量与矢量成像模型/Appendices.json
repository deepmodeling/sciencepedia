{
    "hands_on_practices": [
        {
            "introduction": "任何实际的成像模型都必须考虑光学系统中的不完美之处。波前像差会扭曲光瞳平面处的光相位，是造成图像质量下降的主要原因，而泽尼克多项式（Zernike polynomials）为此类像差的描述提供了一个数学上方便且物理意义明确的正交基。本练习将提供将经典赛德尔像差（Seidel aberrations）如离焦和彗差，转换为现代光学设计和计量软件中使用的标准泽尼克多项式表示的实践机会，这是理解和指定光学质量的一项基本技能。",
            "id": "4162813",
            "problem": "一个用于半导体制造的投影光刻系统使用一个具有单位半径圆形孔径的标量光瞳函数进行建模。穿过光瞳的光程差 $W(\\rho,\\theta)$ 在单位圆盘上定义的正交泽尼克基上展开，其中径向坐标为 $\\rho \\in [0,1]$，方位角为 $\\theta \\in [0,2\\pi)$（单位为弧度）。采用美国光学学会/美国国家标准协会（Optical Society of America/American National Standards Institute）的归一化约定，其中泽尼克多项式 $Z_{n}^{m}(\\rho,\\theta)$ 在单位圆盘上关于权重 $\\rho$ 是正交的，并由下式给出：\n$$\nZ_{n}^{m}(\\rho,\\theta) = N_{n,m} R_{n}^{m}(\\rho) \\times\n\\begin{cases}\n\\cos(m\\theta),  & m \\ge 0, \\\\\n\\sin(|m|\\theta), & m < 0,\n\\end{cases}\n$$\n其中，当 $m \\neq 0$ 时，$N_{n,0} = \\sqrt{n+1}$ 且 $N_{n,m} = \\sqrt{2(n+1)}$，$R_{n}^{m}(\\rho)$ 是标准的泽尼克径向多项式。\n\n考虑由光瞳坐标中以下单项式的系数指定的主赛德尔像差振幅（光程差，单位为米）：离焦 $A_{\\mathrm{def}}$ 乘以 $\\rho^{2}$，沿 $x$ 轴方向的像散，振幅为 $A_{\\mathrm{ast}}$，乘以 $\\rho^{2}\\cos(2\\theta)$，沿 $x$ 轴方向的彗差，振幅为 $A_{\\mathrm{coma}}$，乘以 $\\rho^{3}\\cos(\\theta)$，以及主球差，振幅为 $A_{\\mathrm{sph}}$，乘以 $\\rho^{4}$。照明波长为 $\\lambda$（单位为米）。在标量成像模型中，感应相位为 $\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} W(\\rho,\\theta)$（单位为弧度）。\n\n从标量波光学表示和上述正交泽尼克基的定义出发，将这些赛德尔形式映射到泽尼克系数，并构建去除了活塞（piston）和倾斜（tilt）的光瞳相位 $\\phi(\\rho,\\theta)$。以 $\\rho$、$\\theta$、$A_{\\mathrm{def}}$、$A_{\\mathrm{ast}}$、$A_{\\mathrm{coma}}$、$A_{\\mathrm{sph}}$ 和 $\\lambda$ 的单个闭式符号表达式给出您的最终答案，单位为弧度。不要包含任何整体的活塞或倾斜项。不需要进行数值计算。",
            "solution": "用户希望我解决以下问题：\n一个用于半导体制造的投影光刻系统使用一个具有单位半径圆形孔径的标量光瞳函数进行建模。穿过光瞳的光程差 $W(\\rho,\\theta)$ 在单位圆盘上定义的正交泽尼克基上展开，其中径向坐标为 $\\rho \\in [0,1]$，方位角为 $\\theta \\in [0,2\\pi)$（单位为弧度）。采用美国光学学会/美国国家标准协会的归一化约定，其中泽尼克多项式 $Z_{n}^{m}(\\rho,\\theta)$ 在单位圆盘上关于权重 $\\rho$ 是正交的，并由下式给出：\n$$\nZ_{n}^{m}(\\rho,\\theta) = N_{n,m} R_{n}^{m}(\\rho) \\times\n\\begin{cases}\n\\cos(m\\theta),  & m \\ge 0 \\\\\n\\sin(|m|\\theta), & m < 0\n\\end{cases}\n$$\n其中，当 $m \\neq 0$ 时，$N_{n,0} = \\sqrt{n+1}$ 且 $N_{n,m} = \\sqrt{2(n+1)}$，$R_{n}^{m}(\\rho)$ 是标准的泽尼克径向多项式。\n\n考虑由光瞳坐标中以下单项式的系数指定的主赛德尔像差振幅（光程差，单位为米）：离焦 $A_{\\mathrm{def}}$ 乘以 $\\rho^{2}$，沿 $x$ 轴方向的像散，振幅为 $A_{\\mathrm{ast}}$，乘以 $\\rho^{2}\\cos(2\\theta)$，沿 $x$ 轴方向的彗差，振幅为 $A_{\\mathrm{coma}}$，乘以 $\\rho^{3}\\cos(\\theta)$，以及主球差，振幅为 $A_{\\mathrm{sph}}$，乘以 $\\rho^{4}$。照明波长为 $\\lambda$（单位为米）。在标量成像模型中，感应相位为 $\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} W(\\rho,\\theta)$（单位为弧度）。\n\n从标量波光学表示和上述正交泽尼克基的定义出发，将这些赛德尔形式映射到泽尼克系数，并构建去除了活塞（piston）和倾斜（tilt）的光瞳相位 $\\phi(\\rho,\\theta)$。以 $\\rho$、$\\theta$、$A_{\\mathrm{def}}$、$A_{\\mathrm{ast}}$、$A_{\\mathrm{coma}}$、$A_{\\mathrm{sph}}$ 和 $\\lambda$ 的单个闭式符号表达式给出您的最终答案，单位为弧度。不要包含任何整体的活塞或倾斜项。不需要进行数值计算。\n\n### 步骤1：提取已知条件\n-   光瞳函数：标量，圆形孔径，单位半径 ($\\rho \\in [0,1]$, $\\theta \\in [0, 2\\pi)$)。\n-   光程差 (OPD): $W(\\rho,\\theta)$。\n-   基：单位圆盘上关于权重 $\\rho$ 的正交泽尼克多项式 $Z_{n}^{m}(\\rho,\\theta)$。\n-   泽尼克定义：$Z_{n}^{m}(\\rho,\\theta) = N_{n,m} R_{n}^{m}(\\rho) \\times \\begin{cases} \\cos(m\\theta),  m \\ge 0 \\\\ \\sin(|m|\\theta),  m < 0 \\end{cases}$。\n-   归一化常数：$N_{n,0} = \\sqrt{n+1}$，当 $m \\neq 0$ 时 $N_{n,m} = \\sqrt{2(n+1)}$。\n-   对 $W(\\rho,\\theta)$ 有贡献的赛德尔像差项：\n    1.  离焦: $A_{\\mathrm{def}} \\rho^{2}$\n    2.  像散 (x-轴): $A_{\\mathrm{ast}} \\rho^{2}\\cos(2\\theta)$\n    3.  彗差 (x-轴): $A_{\\mathrm{coma}} \\rho^{3}\\cos(\\theta)$\n    4.  球差: $A_{\\mathrm{sph}} \\rho^{4}$\n-   振幅 $A_{\\mathrm{def}}, A_{\\mathrm{ast}}, A_{\\mathrm{coma}}, A_{\\mathrm{sph}}$ 单位为米。\n-   波长: $\\lambda$ 单位为米。\n-   相位-OPD 关系: $\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} W(\\rho,\\theta)$ 单位为弧度。\n-   目标：构建去除了活塞和倾斜的光瞳相位 $\\phi(\\rho,\\theta)$。\n-   输出：最终相位的单个闭式符号表达式。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学基础**：该问题在物理光学中具有坚实的理论基础，特别是在光学系统设计和光刻建模中使用的像差理论。赛德尔和泽尼克多项式之间的关系是一个标准且基本的概念。\n-   **适定性**：问题定义清晰。它要求进行特定的数学变换（在去除了活塞和倾斜的泽尼克基中表示赛德尔像差），并提供了所有必要的定义和常数。目标明确，且存在唯一解。\n-   **客观性**：问题使用精确、标准和客观的科学术语陈述。没有主观或基于意见的成分。\n-   **缺陷检查表**：\n    1.  *科学/事实不健全*：无。该框架是标准的光学工程。\n    2.  *不可形式化/不相关*：无。该问题是一个形式化的数学推导。\n    3.  *设置不完整/矛盾*：无。泽尼克基和赛德尔项的定义是自洽的，足以进行推导。\n    4.  *不切实际/不可行*：无。这是一个标准的建模问题。\n    5.  *不适定/结构不良*：无。去除活塞和倾斜的要求确保了表示的唯一性。\n    6.  *伪深刻/琐碎*：无。该问题需要对泽尼克多项式的性质进行非平凡的应用。\n    7.  *超出科学可验证性*：无。该推导在数学上是可验证的。\n\n### 步骤3：结论和行动\n问题是**有效的**。将推导解答。\n\n总光程差 (OPD) $W(\\rho,\\theta)$ 是给定赛德尔像差项的总和：\n$$W(\\rho,\\theta) = A_{\\mathrm{def}} \\rho^{2} + A_{\\mathrm{ast}} \\rho^{2}\\cos(2\\theta) + A_{\\mathrm{coma}} \\rho^{3}\\cos(\\theta) + A_{\\mathrm{sph}} \\rho^{4}$$\n问题要求构建去除了活塞和倾斜的相位。这等同于找到总 OPD，将其在正交泽尼克基上展开，然后将活塞和倾斜项的系数设为零。一种等效且更直接的方法是计算 $W(\\rho,\\theta)$ 的总活塞和倾斜分量，然后减去这些分量。\n\n分别对应于活塞和 x-倾斜的泽尼克多项式是：\n-   活塞 ($n=0, m=0$): $Z_{0}^{0}(\\rho,\\theta) = N_{0,0} R_{0}^{0}(\\rho) = \\sqrt{0+1} \\cdot 1 = 1$。\n-   X-倾斜 ($n=1, m=1$): $Z_{1}^{1}(\\rho,\\theta) = N_{1,1} R_{1}^{1}(\\rho) \\cos(\\theta) = \\sqrt{2(1+1)} \\rho \\cos(\\theta) = 2\\rho\\cos(\\theta)$。\n\n总 OPD 可以展开为 $W(\\rho,\\theta) = \\sum_{n,m} c_{n,m} Z_{n}^{m}(\\rho,\\theta)$。去除了活塞和倾斜的 OPD，我们将其表示为 $W_{\\mathrm{ab}}(\\rho,\\theta)$，由下式给出：\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = W(\\rho,\\theta) - c_{0,0}Z_{0}^{0}(\\rho,\\theta) - c_{1,1}Z_{1}^{1}(\\rho,\\theta)$$\n我们假设 y-倾斜分量 $c_{1,-1}$ 为零，因为所有给定的像差都关于 $x$ 轴对称。\n\n为了找到系数 $c_{0,0}$ 和 $c_{1,1}$，我们必须将每个赛德尔单项式用泽尼克基表示。我们列出相关的泽尼克多项式：\n-   $Z_{0}^{0} = 1$ (活塞)\n-   $Z_{1}^{1} = 2\\rho\\cos(\\theta)$ (倾斜)\n-   $Z_{2}^{0} = \\sqrt{3}(2\\rho^2 - 1)$ (离焦)\n-   $Z_{3}^{1} = \\sqrt{8}(3\\rho^3-2\\rho)\\cos(\\theta)$ (彗差)\n-   $Z_{4}^{0} = \\sqrt{5}(6\\rho^4-6\\rho^2+1)$ (球差)\n\n根据这些定义，我们可以反转这些关系，用泽尼克多项式来表示单项式：\n1.  从 $Z_{2}^{0} = 2\\sqrt{3}\\rho^2 - \\sqrt{3}$ 和 $Z_{0}^{0}=1$ 可得：\n    $2\\sqrt{3}\\rho^2 = Z_{2}^{0} + \\sqrt{3}Z_{0}^{0} \\implies \\rho^2 = \\frac{1}{2\\sqrt{3}}Z_{2}^{0} + \\frac{1}{2}Z_{0}^{0}$。\n    $\\rho^2$ 的活塞分量（$\\propto Z_0^0$）是 $\\frac{1}{2}$。\n\n2.  从 $Z_{1}^{1} = 2\\rho\\cos(\\theta)$ 和 $Z_{3}^{1} = \\sqrt{8}(3\\rho^3\\cos(\\theta) - 2\\rho\\cos(\\theta))$ 可得：\n    将 $\\rho\\cos(\\theta) = \\frac{1}{2}Z_{1}^{1}$ 代入 $Z_{3}^{1}$ 的表达式中：\n    $Z_{3}^{1} = \\sqrt{8}(3\\rho^3\\cos(\\theta) - 2(\\frac{1}{2}Z_{1}^{1})) = 3\\sqrt{8}\\rho^3\\cos(\\theta) - \\sqrt{8}Z_{1}^{1}$。\n    $3\\sqrt{8}\\rho^3\\cos(\\theta) = Z_{3}^{1} + \\sqrt{8}Z_{1}^{1} \\implies \\rho^3\\cos(\\theta) = \\frac{1}{3\\sqrt{8}}Z_{3}^{1} + \\frac{1}{3}Z_{1}^{1}$。\n    $\\rho^3\\cos(\\theta)$ 的倾斜分量（$\\propto Z_1^1$）是 $\\frac{1}{3}$。\n\n3.  为了找到 $\\rho^4$ 的活塞分量，我们可以将其在完整的泽尼克基上展开。然而，一个更简单的方法是计算它在单位圆盘上的平均值，这对应于其活塞含量。函数 $f(\\rho,\\theta)$ 的平均值为 $\\langle f \\rangle = \\frac{1}{\\pi}\\int_0^{2\\pi}\\int_0^1 f(\\rho,\\theta)\\rho\\,d\\rho\\,d\\theta$。对于一个只依赖于 $\\rho$ 的函数 $g(\\rho)$，这可以简化为 $\\langle g(\\rho) \\rangle = 2\\int_0^1 g(\\rho)\\rho\\,d\\rho$。$\\rho^4$ 的活塞含量为 $\\langle \\rho^4 \\rangle = 2\\int_0^1 \\rho^4 \\rho\\,d\\rho = 2\\int_0^1 \\rho^5\\,d\\rho = 2[\\frac{\\rho^6}{6}]_0^1 = \\frac{1}{3}$。\n\n其他项，如像散 $A_{\\mathrm{ast}}\\rho^2\\cos(2\\theta)$，由于三角函数的正交性（在 $[0, 2\\pi)$ 上 $\\cos(2\\theta)$ 与 $\\cos(\\theta)$ 和常数正交），没有活塞或倾斜分量。\n\n现在我们可以求出需要从 $W(\\rho,\\theta)$ 中去除的总活塞和倾斜。\n需要去除的总 OPD，$W_{\\text{remove}}$，是所有赛德尔项的活塞和倾斜贡献之和。\n-   来自 $A_{\\mathrm{def}}\\rho^2$ 的活塞贡献：$A_{\\mathrm{def}}\\langle\\rho^2\\rangle = A_{\\mathrm{def}}(2[\\frac{\\rho^4}{4}]_0^1) = \\frac{A_{\\mathrm{def}}}{2}$。\n-   来自 $A_{\\mathrm{sph}}\\rho^4$ 的活塞贡献：$A_{\\mathrm{sph}}\\langle\\rho^4\\rangle = A_{\\mathrm{sph}}(\\frac{1}{3}) = \\frac{A_{\\mathrm{sph}}}{3}$。\n-   需要去除的总活塞：$P = (\\frac{A_{\\mathrm{def}}}{2} + \\frac{A_{\\mathrm{sph}}}{3}) Z_0^0 = \\frac{A_{\\mathrm{def}}}{2} + \\frac{A_{\\mathrm{sph}}}{3}$。\n\n-   来自 $A_{\\mathrm{coma}}\\rho^3\\cos(\\theta)$ 的倾斜贡献：这是 $A_{\\mathrm{coma}}\\rho^3\\cos(\\theta)$ 在倾斜多项式 $Z_1^1$ 上的投影。根据我们的分解，$Z_1^1$ 的系数是 $\\frac{A_{\\mathrm{coma}}}{3}$。\n-   需要去除的总倾斜：$T = c_{1,1}Z_{1}^{1} = \\frac{A_{\\mathrm{coma}}}{3} (2\\rho\\cos(\\theta)) = \\frac{2}{3}A_{\\mathrm{coma}}\\rho\\cos(\\theta)$。\n\n去除了活塞和倾斜的 OPD 是 $W_{\\mathrm{ab}}(\\rho,\\theta) = W(\\rho,\\theta) - P - T$。\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = \\left(A_{\\mathrm{def}} \\rho^{2} + A_{\\mathrm{ast}} \\rho^{2}\\cos(2\\theta) + A_{\\mathrm{coma}} \\rho^{3}\\cos(\\theta) + A_{\\mathrm{sph}} \\rho^{4}\\right) - \\left(\\frac{A_{\\mathrm{def}}}{2} + \\frac{A_{\\mathrm{sph}}}{3}\\right) - \\frac{2}{3}A_{\\mathrm{coma}}\\rho\\cos(\\theta)$$\n按赛德尔振幅对各项进行分组，可以得到一个具有物理意义的形式：\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\left(\\rho^2 \\cos(2\\theta)\\right) + A_{\\mathrm{coma}}\\left(\\rho^3\\cos(\\theta) - \\frac{2}{3}\\rho\\cos(\\theta)\\right) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right)$$\n这可以更紧凑地写成：\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\rho^2 \\cos(2\\theta) + A_{\\mathrm{coma}}\\left(\\rho^3 - \\frac{2}{3}\\rho\\right)\\cos(\\theta) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right)$$\n这个表达式表示每个赛德尔项都与活塞和倾斜正交。\n\n最后，我们使用给定的关系 $\\phi = \\frac{2\\pi}{\\lambda}W$ 将此 OPD 转换为相位 $\\phi(\\rho,\\theta)$：\n$$\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} \\left[ A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\rho^2 \\cos(2\\theta) + A_{\\mathrm{coma}}\\left(\\rho^3 - \\frac{2}{3}\\rho\\right)\\cos(\\theta) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right) \\right]$$\n这是去除了活塞和倾斜的光瞳相位的最终闭式表达式。",
            "answer": "$$ \\boxed{ \\frac{2\\pi}{\\lambda} \\left[ A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\rho^2 \\cos(2\\theta) + A_{\\mathrm{coma}}\\left(\\rho^3 - \\frac{2}{3}\\rho\\right)\\cos(\\theta) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right) \\right] } $$"
        },
        {
            "introduction": "从理论走向仿真实践时，我们通常通过掩模与系统点扩展函数（Point Spread Function, PSF）的卷积来计算图像，而快速傅里叶变换（Fast Fourier Transform, FFT）是完成这一任务的首选工具。然而，离散傅里叶变换（DFT）或FFT算法隐含地假设了信号的周期性，这会导致循环卷积（circular convolution），对于孤立的掩模图形而言，这在物理上是不正确的。通过计算为达到目标精度所需的零填充（zero-padding）大小，您将深入理解如何确保成像仿真的数值保真度，并将抽象的数值概念与具体的物理误差预算联系起来。",
            "id": "4162763",
            "problem": "一个投影光刻系统在标量、非相干近似下进行成像过程建模，其中晶圆上的空气像强度 $I(\\mathbf{r})$ 由有界掩模强度 $m(\\mathbf{r})$ 与系统的点扩散函数 (PSF) 的卷积 $I(\\mathbf{r}) = (m \\ast h)(\\mathbf{r})$ 给出。在实践中，即使使用矢量成像模型计算与偏振相关的各向异性 PSF，采样网格上的数值卷积通常也是通过由快速傅里叶变换 (FFT) 实现的离散傅里叶变换 (DFT) 来执行的。DFT 隐含地假设输入数组是周期性延拓的，因此不使用填充的 FFT 会产生循环卷积和环绕混叠。\n\n为了控制这种混叠，使用了零填充。考虑晶圆上的一个二维各向同性高斯 PSF，\n$$\nh(\\mathbf{r}) = \\frac{1}{2\\pi \\sigma^2}\\exp\\!\\left(-\\frac{\\|\\mathbf{r}\\|^2}{2\\sigma^2}\\right),\n$$\n这是一个经过充分检验的近似，用于描述部分相干投影系统中的有效模糊以及光刻胶/扩散平滑效应，即使在严格处理底层光瞳和偏振物理的情况下也是如此。假设掩模强度有界，为 $0 \\le m(\\mathbf{r}) \\le 1$，晶圆上的采样间距为 $\\Delta = 4\\,\\mathrm{nm}$，高斯宽度为 $\\sigma = 12\\,\\mathrm{nm}$。掩模在 $N_x \\times N_y$ 的网格上采样，其中 $N_x = N_y = 2048$。\n\n您的任务是从第一性原理出发，解释为什么在基于 FFT 的 PSF 卷积中需要零填充来避免循环卷积混叠，并计算一个能保证预定精度的填充尺寸。将目标精度定义为卷积结果中环绕混叠误差的一致界限，具体要求计算出的图像中的最坏情况混叠误差不大于无环绕混叠时最大可能图像强度的 $\\delta = 10^{-4}$。在这些条件下，确定一个能确保该界限的最小每侧填充 $p$（以像素为单位），以及执行基于 FFT 的卷积而不会让循环混叠污染视场所需的相应最小填充网格尺寸。\n\n哪个选项正确解释了在此背景下需要零填充的原因，并给出了正确的数值填充要求和填充后网格尺寸？\n\nA. 因为离散傅里叶变换 (DFT) 假设周期性延拓，所以 FFT 执行的是循环卷积；需要零填充来分离对象的周期性副本，以使 PSF 的支撑域不会与相邻副本重叠。对于二维归一化高斯 PSF，半径 $R$ 之外的能量分数为 $\\exp(-R^2/(2\\sigma^2))$。强制要求 $\\exp(-R^2/(2\\sigma^2)) \\le \\delta$ 可得出 $R \\ge \\sigma\\sqrt{2\\ln(1/\\delta)}$。当 $\\sigma = 12\\,\\mathrm{nm}$ 且 $\\delta = 10^{-4}$ 时，$R \\approx 51.5\\,\\mathrm{nm}$，因此每侧 $p = \\lceil R/\\Delta \\rceil = \\lceil 51.5/4 \\rceil = 13$ 像素，最小填充网格为 $(N_x+2p)\\times(N_y+2p) = 2074 \\times 2074$。\n\nB. 如果点扩散函数 (PSF) 是归一化的，则无需零填充，因为卷积保持总能量；只要 PSF 积分为 1，使用不带填充的 FFT 就能产生与线性卷积相同的结果，因此 $p=0$，网格保持为 $2048 \\times 2048$。\n\nC. 一个实用的规则是在每侧填充一个高斯函数的标准差；因此 $p = \\lceil \\sigma/\\Delta \\rceil = \\lceil 12/4 \\rceil = 3$ 像素，填充后的网格为 $2054 \\times 2054$。\n\nD. 填充应等于艾里斑的第一零点半径，$R \\approx 0.61\\,\\lambda/\\mathrm{NA}$，这定义了 PSF 的支撑域；对于 $\\lambda = 193\\,\\mathrm{nm}$ 和数值孔径 $\\mathrm{NA} = 0.93$，这得到 $R \\approx 127\\,\\mathrm{nm}$，所以 $p = \\lceil 127/4 \\rceil = 32$ 像素，填充后的网格为 $2112 \\times 2112$。",
            "solution": "用户请求对一个关于半导体光刻建模中基于 FFT 卷积的问题进行详细验证和解答。\n\n### 问题陈述验证\n\n首先，我将根据指定标准验证问题陈述。\n\n**第1步：提取给定条件**\n- **成像模型：** 标量、非相干近似。\n- **图像形成：** 空气像强度 $I(\\mathbf{r}) = (m \\ast h)(\\mathbf{r})$，其中 $\\ast$ 表示卷积。\n- **掩模强度：** $m(\\mathbf{r})$，一个有界函数，满足 $0 \\le m(\\mathbf{r}) \\le 1$。\n- **点扩散函数 (PSF)：** $h(\\mathbf{r}) = \\frac{1}{2\\pi \\sigma^2}\\exp\\!\\left(-\\frac{\\|\\mathbf{r}\\|^2}{2\\sigma^2}\\right)$，一个二维各向同性高斯函数。\n- **数值方法：** 通过由快速傅里叶变换 (FFT) 实现的离散傅里叶变换 (DFT) 执行卷积。\n- **DFT 属性：** 隐含地假设输入的周期性延拓，导致循环卷积。\n- **目标：**\n    1.  解释需要零填充以避免循环卷积混叠的原因。\n    2.  计算最小每侧填充 $p$（以像素为单位）。\n    3.  确定相应的最小填充网格尺寸。\n- **参数：**\n    - 高斯宽度：$\\sigma = 12\\,\\mathrm{nm}$。\n    - 采样间距：$\\Delta = 4\\,\\mathrm{nm}$。\n    - 掩模网格尺寸：$N_x \\times N_y$，其中 $N_x = N_y = 2048$。\n- **精度要求：** 计算图像中的最坏情况混叠误差不得大于最大可能图像强度的 $\\delta = 10^{-4}$。\n\n**第2步：使用提取的给定条件进行验证**\n- **科学基础：** 该问题牢固地植根于线性系统理论、傅里叶光学和数字信号处理的标准原理。用与 PSF 的卷积来表示成像系统是一个基本概念。使用 FFT 进行高效卷积是一种标准的数值技术。高斯函数是光刻中各种模糊现象的广泛接受的近似。该问题的背景具有科学合理性。\n- **适定性：** 问题提供了明确的目标（计算填充尺寸 $p$ 和网格维度）、特定的数学模型（高斯 PSF）、所有必要的数值参数（$\\sigma$、$\\Delta$、$N_x$、$N_y$）以及精确的定量误差标准（$\\delta = 10^{-4}$）。这种结构允许推导出唯一且有意义的解。\n- **客观性：** 问题以精确、技术性的语言陈述，没有主观性或歧义。假设（标量、非相干模型）已明确说明。\n\n问题陈述没有任何无效性缺陷。它科学合理、适定、客观、完整，并要求根据所提供的信息进行非平凡的计算。\n\n**第3步：结论与行动**\n问题陈述是**有效的**。我将继续进行推导和求解。\n\n### 解的推导\n\n**1. 零填充的必要性**\n\n卷积定理指出，空间域中的卷积对应于频率域中的乘法。对于连续函数，$\\mathcal{F}\\{m \\ast h\\} = \\mathcal{F}\\{m\\} \\cdot \\mathcal{F}\\{h\\}$，其中 $\\mathcal{F}$ 是傅里叶变换。当在有限网格上进行数值计算时，我们使用离散傅里叶变换 (DFT)，它可以通过快速傅里叶变换 (FFT) 高效计算。然而，DFT 是在周期性延拓的信号上操作的。离散卷积定理是 $\\text{DFT}\\{m \\circledast h\\} = \\text{DFT}\\{m\\} \\odot \\text{DFT}\\{h\\}$，其中 $\\circledast$ 表示循环卷积，$\\odot$ 表示逐元素相乘。\n\n因此，使用 FFT 将变换后的掩模和 PSF 数组相乘，得到的是它们的*循环*卷积，而非我们期望的*线性*卷积。在循环卷积中，当 PSF 核在掩模网格边缘附近进行卷积时，它会“环绕”并从掩模的另一侧拾取数值。这会产生环绕混叠，是一种污染计算图像的混叠误差。\n\n为了使用 FFT 计算线性卷积，我们必须明确防止这种环绕。这通过对输入数组进行零填充来实现。通过将原始的 $N_x \\times N_y$ 掩模数据嵌入一个更大的、用零填充的网格中，我们创建了一个保护带。如果这个保护带足够宽，PSF 的尾部将与这些零相乘，而不是与从远处环绕过来的掩模数据的副本相乘。计算一个 $N_m$ 点信号和一个 $N_h$ 点核的线性卷积所需的最小填充网格尺寸为 $N_m + N_h - 1$。就我们的目的而言，填充必须足够宽，以包含 PSF 核的有效支撑域。\n\n**2. 最小填充尺寸的计算**\n\n问题要求最坏情况下的混叠误差不超过最大可能图像强度的 $\\delta = 10^{-4}$。\n\n- **最大图像强度：** 图像强度为 $I(\\mathbf{r}) = \\int_{\\mathbb{R}^2} m(\\mathbf{r}-\\mathbf{r}') h(\\mathbf{r}') d^2\\mathbf{r}'$。由于 $0 \\le m(\\mathbf{r}) \\le 1$ 且 PSF 是归一化的（$\\int_{\\mathbb{R}^2} h(\\mathbf{r}') d^2\\mathbf{r}' = 1$），对于一个大面积均匀的亮场（其中 $m(\\mathbf{r})=1$），可以达到最大强度。在这种情况下，$I_{max} = \\int 1 \\cdot h(\\mathbf{r}') d^2\\mathbf{r}' = 1$。\n\n- **最坏情况下的混叠误差：** 混叠误差源于对无限支撑域的高斯 PSF 的截断。我们实际上是在距其中心一定半径 $R$ 之外截断了 PSF 核。填充必须提供一个至少为该半径 $R$ 的零值区域。由 PSF 截断尾部造成的误差贡献由 $\\int_{\\|\\mathbf{r}'\\|>R} m(\\mathbf{r}-\\mathbf{r}') h(\\mathbf{r}') d^2\\mathbf{r}'$ 给出。最坏情况的误差发生在环绕的尾部落在掩模最亮的区域，即 $m=1$ 的区域。因此，该误差的大小由 $\\int_{\\|\\mathbf{r}'\\|>R} 1 \\cdot h(\\mathbf{r}') d^2\\mathbf{r}'$ 界定。\n\n- **误差界限条件：** 我们必须满足：\n$$ \\int_{\\|\\mathbf{r}'\\|>R} h(\\mathbf{r}') d^2\\mathbf{r}' \\le \\delta \\cdot I_{max} = 10^{-4} $$\n该积分表示在半径 $R$ 之外的 PSF 体积（或“能量”）的分数。对于二维各向同性高斯函数，该积分可以在极坐标中计算：\n$$ \\int_R^{\\infty} \\int_0^{2\\pi} \\frac{1}{2\\pi \\sigma^2} e^{-r^2 / (2\\sigma^2)} r \\,d\\theta \\,dr = \\frac{1}{\\sigma^2} \\int_R^{\\infty} r e^{-r^2 / (2\\sigma^2)} \\,dr $$\n使用换元法 $u = r^2 / (2\\sigma^2)$，其中 $du = r/\\sigma^2 \\,dr$，积分变为：\n$$ \\int_{R^2/(2\\sigma^2)}^{\\infty} e^{-u} \\,du = \\left[-e^{-u}\\right]_{R^2/(2\\sigma^2)}^{\\infty} = 0 - (-e^{-R^2/(2\\sigma^2)}) = e^{-R^2/(2\\sigma^2)} $$\n条件变为：\n$$ e^{-R^2 / (2\\sigma^2)} \\le \\delta $$\n求解最小半径 $R$：\n$$ -\\frac{R^2}{2\\sigma^2} \\le \\ln(\\delta) $$\n$$ \\frac{R^2}{2\\sigma^2} \\ge -\\ln(\\delta) = \\ln(1/\\delta) $$\n$$ R^2 \\ge 2\\sigma^2 \\ln(1/\\delta) \\implies R \\ge \\sigma \\sqrt{2\\ln(1/\\delta)} $$\n- **数值计算：**\n给定 $\\sigma = 12\\,\\mathrm{nm}$ 和 $\\delta = 10^{-4}$。\n$$ R \\ge (12\\,\\mathrm{nm}) \\sqrt{2 \\ln(1/10^{-4})} = (12\\,\\mathrm{nm}) \\sqrt{2 \\ln(10^4)} = (12\\,\\mathrm{nm}) \\sqrt{2 \\cdot 4 \\ln(10)} $$\n使用 $\\ln(10) \\approx 2.302585$：\n$$ R \\ge (12\\,\\mathrm{nm}) \\sqrt{8 \\times 2.302585} \\approx (12\\,\\mathrm{nm}) \\sqrt{18.42068} \\approx (12\\,\\mathrm{nm}) \\times 4.29193 \\approx 51.503\\,\\mathrm{nm} $$\n所需的最小填充半径为 $R_{min} \\approx 51.503\\,\\mathrm{nm}$。\n\n- **像素填充和填充后网格尺寸：**\n填充距离必须至少为 $R_{min}$。每侧的像素填充数 $p$ 是该距离除以像素尺寸 $\\Delta = 4\\,\\mathrm{nm}$，然后向上取整以确保满足条件。\n$$ p = \\left\\lceil \\frac{R_{min}}{\\Delta} \\right\\rceil = \\left\\lceil \\frac{51.503\\,\\mathrm{nm}}{4\\,\\mathrm{nm}} \\right\\rceil = \\lceil 12.87575 \\rceil = 13\\,\\text{像素} $$\n最小每侧填充为 $p=13$ 像素。原始掩模为 $N_x \\times N_y = 2048 \\times 2048$。要在四周都填充的网格上执行卷积，最小网格尺寸变为 $(N_x + 2p) \\times (N_y + 2p)$。\n$$ \\text{填充后网格尺寸} = (2048 + 2 \\times 13) \\times (2048 + 2 \\times 13) = (2048 + 26) \\times (2048 + 26) = 2074 \\times 2074 $$\n\n### 逐项分析\n\n**A. 因为离散傅里叶变换 (DFT) 假设周期性延拓，所以 FFT 执行的是循环卷积；需要零填充来分离对象的周期性副本，以使 PSF 的支撑域不会与相邻副本重叠。对于二维归一化高斯 PSF，半径 $R$ 之外的能量分数为 $\\exp(-R^2/(2\\sigma^2))$。强制要求 $\\exp(-R^2/(2\\sigma^2)) \\le \\delta$ 可得出 $R \\ge \\sigma\\sqrt{2\\ln(1/\\delta)}$。当 $\\sigma = 12\\,\\mathrm{nm}$ 且 $\\delta = 10^{-4}$ 时，$R \\approx 51.5\\,\\mathrm{nm}$，因此每侧 $p = \\lceil R/\\Delta \\rceil = \\lceil 51.5/4 \\rceil = 13$ 像素，最小填充网格为 $(N_x+2p)\\times(N_y+2p) = 2074 \\times 2074$。**\n- **分析：** 定性解释是正确的。半径 $R$ 之外的能量公式是正确的。$R$ 的不等式推导是正确的。如上文推导所示，所有关于 $R$、$p$ 和最终网格尺寸的数值计算都是正确的。\n- **结论：** **正确**。\n\n**B. 如果点扩散函数 (PSF) 是归一化的，则无需零填充，因为卷积保持总能量；只要 PSF 积分为 1，使用不带填充的 FFT 就能产生与线性卷积相同的结果，因此 $p=0$，网格保持为 $2048 \\times 2048$。**\n- **分析：** 这个陈述根本上是错误的。PSF 的归一化是与线性空间不变系统中的能量守恒相关的物理性质。它与循环卷积和线性卷积之间的数学区别无关，后者是有限网格 DFT 算法的产物。在大小相同的未填充数组上使用 FFT 计算的是循环卷积，这不等于线性卷积。\n- **结论：** **错误**。\n\n**C. 一个实用的规则是在每侧填充一个高斯函数的标准差；因此 $p = \\lceil \\sigma/\\Delta \\rceil = \\lceil 12/4 \\rceil = 3$ 像素，填充后的网格为 $2054 \\times 2054$。**\n- **分析：** 这个选项提出了一个启发式或“经验法则”。问题要求一个基于特定精度标准 $\\delta = 10^{-4}$ 的解。按 $R = \\sigma = 12\\,\\mathrm{nm}$ 进行填充，对应的截断能量为 $e^{-\\sigma^2 / (2\\sigma^2)} = e^{-0.5} \\approx 0.6065$。这意味着潜在的混叠误差超过 $60\\%$，比要求的 $0.01\\%$ 容差大几个数量级。该规则不充分，不满足问题的约束。\n- **结论：** **错误**。\n\n**D. 填充应等于艾里斑的第一零点半径，$R \\approx 0.61\\,\\lambda/\\mathrm{NA}$，这定义了 PSF 的支撑域；对于 $\\lambda = 193\\,\\mathrm{nm}$ 和数值孔径 $\\mathrm{NA} = 0.93$，这得到 $R \\approx 127\\,\\mathrm{nm}$，所以 $p = \\lceil 127/4 \\rceil = 32$ 像素，填充后的网格为 $2112 \\times 2112$。**\n- **分析：** 这个选项错误地将给定的 PSF 模型替换为另一个模型。问题明确定义 PSF 为 $\\sigma = 12\\,\\mathrm{nm}$ 的高斯函数。艾里斑模型是针对具有圆形光瞳的衍射极限系统的。此外，该选项引入了问题陈述中未提供的外部参数（$\\lambda = 193\\,\\mathrm{nm}$，$\\mathrm{NA} = 0.93$）。有效的解必须完全根据给定条件推导得出。\n- **结论：** **错误**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在掌握了如何为像差建模并正确执行卷积之后，我们可以构建一个完整（尽管是简化的）光刻过程仿真器。这项综合性练习将要求您实现部分相干成像的霍普金斯模型（Hopkins model），以研究一个实际工程问题：掩模形状的微调（偏置和圆角）对最终成像的影响，这也是光学邻近效应修正（Optical Proximity Correction, OPC）的关键环节。这项压轴练习将之前的概念融会贯通于一个编程项目中，展示了标量成像模型如何用于预测关键尺寸（Critical Dimension, CD）并指导复杂掩模的设计，从而在理论建模与半导体制造的实际挑战之间建立直接联系。",
            "id": "4162766",
            "problem": "您的任务是实现一个标量部分相干成像模型，用以分析掩模偏置和拐角倒圆如何改变掩模传输函数 $t(x,y)$ 的傅里叶谱，以及这些变化如何影响投影光刻中的空气像关键尺寸（CD）。建模背景为使用投影系统的先进半导体制造。该模型必须从基本的标量衍射理论和部分相干成像原理推导得出，然后进行数值实现。偏振和材料色散被忽略，成像被视为具有二元振幅透射的薄掩模。\n\n从以下基本依据开始：\n- 惠更斯-菲涅耳原理和傅里叶光学，指出在标量相干照明下，像平面中的场可以通过掩模谱经光瞳滤波后得到：对于一个由空间频率矢量 $\\mathbf{s}$ 倾斜的平面波源，像平面复振幅场与掩模谱 $T(\\mathbf{f})$ 和光瞳函数 $P(\\mathbf{f}-\\mathbf{s})$ 的乘积的傅里叶逆变换成正比。\n- 霍普金斯部分相干成像模型，其中空气像强度是来自光源点分布的相干图像强度之和（相干图像的非相干叠加），即 $I(\\mathbf{x})$ 被建模为对光源方向的平均。\n\n采用以下符合物理实际的系统参数：\n- 波长 $\\lambda$（单位为纳米）固定为 $\\lambda = 193$ nm。\n- 数值孔径（NA）固定为 $\\mathrm{NA} = 0.93$。\n- 为简化起见，假设为单位放大率，因此在此建模练习中，掩模和晶圆坐标被同等对待。\n- 光瞳截止空间频率半径为 $f_c = \\mathrm{NA} / \\lambda$，单位为周期/纳米。\n- 部分相干性通过频率空间中半径为 $\\sigma f_c$ 的均匀环形光源进行建模，其中 $\\sigma$ 是部分相干性参数，$0 \\le \\sigma \\le 1$。在此环上使用 8 个光源点的等权重离散采样。\n\n将掩模传输 $t(x,y)$ 定义为一个二元振幅函数，表示一个位于原点的圆角矩形特征，其宽度为 $W$，高度为 $H$（单位均为纳米）。掩模偏置 $\\Delta$ 同时修改两个维度，使得 $W' = W + \\Delta$ 和 $H' = H + \\Delta$。拐角倒圆通过半径 $R$（单位为纳米）进行建模，使用一个较小的轴对齐矩形和一个半径为 $R$ 的圆盘的闵可夫斯基和，通过指示函数实现：\n$$\nt(x,y) = \\begin{cases}\n1,  & \\text{if } \\Big(\\max(|x| - a_x, 0)\\Big)^2 + \\Big(\\max(|y| - a_y, 0)\\Big)^2 \\le R^2, \\\\\n0,  & \\text{otherwise,}\n\\end{cases}\n$$\n其中 $a_x = \\max\\left(\\dfrac{W'}{2} - R,\\, 0\\right)$ 且 $a_y = \\max\\left(\\dfrac{H'}{2} - R,\\, 0\\right)$。\n\n令 $T(\\mathbf{f})$ 为 $t(x,y)$ 的二维傅里叶变换，令 $P(\\mathbf{f})$ 为圆形光瞳指示函数，当 $\\|\\mathbf{f}\\| \\le f_c$ 时 $P(\\mathbf{f}) = 1$，否则 $P(\\mathbf{f}) = 0$。对于一个给定的光源点，其位移为 $\\mathbf{s}$，大小为 $\\|\\mathbf{s}\\| = \\sigma f_c$，则相干像平面场为：\n$$\nE_{\\mathbf{s}}(\\mathbf{x}) \\propto \\mathcal{F}^{-1}\\left\\{ T(\\mathbf{f}) P(\\mathbf{f} - \\mathbf{s}) \\right\\},\n$$\n而部分相干空气像强度被建模为\n$$\nI(\\mathbf{x}) = \\frac{1}{N_s} \\sum_{k=1}^{N_s} \\left| E_{\\mathbf{s}_k}(\\mathbf{x}) \\right|^2,\n$$\n其中 $N_s$ 是环上的光源样本数。\n\n对于每个掩模配置，计算：\n1. 超出光瞳截止频率的光谱能量分数，定义为\n$$\n\\eta = \\frac{\\sum_{\\|\\mathbf{f}\\| > f_c} |T(\\mathbf{f})|^2}{\\sum_{\\mathbf{f}} |T(\\mathbf{f})|^2}。\n$$\n2. 沿 $x$ 轴在 $y=0$ 处的空气像 CD，定义为 $I(x, 0)$ 相对于最大强度的半峰全宽（FWHM）。使用峰值强度 $I(x,0)$ 的 $0.5$ 倍作为等强度阈值来确定宽度。CD 以纳米为单位表示。\n\n对于每个测试用例，报告：\n- CD 变化量（单位为纳米），$\\Delta \\mathrm{CD} = \\mathrm{CD}_\\text{biased,rounded} - \\mathrm{CD}_\\text{baseline}$，其中基准使用 $\\Delta = 0$ nm 和 $R = 0$ nm，并与测试用例具有相同的 $W$、$H$、$\\lambda$、$\\mathrm{NA}$ 和 $\\sigma$。\n- 相对于基准的超截止频率高频能量比率，$\\rho = \\eta_\\text{biased,rounded} / \\eta_\\text{baseline}$（无量纲）。\n\n数值实现的离散化要求：\n- 使用 $N \\times N$ 个样本的方形计算网格，其中 $N = 512$，采样间距 $\\Delta x = \\Delta y = 4$ nm。\n- 构建与快速傅里叶变换（FFT）一致的频率网格，并使用适当的中心化和频率移位进行径向运算。\n- 光源采样的角度必须以弧度为单位。\n\n测试套件：\n每个测试用例由 $(W,H,\\Delta,R,\\sigma)$ 指定，除无量纲的 $\\sigma$ 外，其余单位均为纳米。\n- 测试 1（基准特征，中等部分相干性）：$(100, 300, 0, 0, 0.3)$\n- 测试 2（正偏置和适度倒圆，相同的 $\\sigma$）：$(100, 300, 5, 5, 0.3)$\n- 测试 3（带倒圆的负偏置，更高部分相干性）：$(100, 300, -5, 5, 0.7)$\n- 测试 4（更大的正偏置，无倒圆，更高部分相干性）：$(100, 300, 10, 0, 0.7)$\n- 测试 5（无偏置，重度倒圆，中等部分相干性）：$(100, 300, 0, 15, 0.5)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个包含两个浮点数的列表，顺序为 $[\\Delta \\mathrm{CD}\\ \\text{in nm},\\ \\rho]$。例如，输出必须类似于：\n$[[\\Delta \\mathrm{CD}_1,\\rho_1],[\\Delta \\mathrm{CD}_2,\\rho_2],\\ldots]$。\n\n所有长度必须以纳米为单位，角度必须以弧度为单位，报告的 CD 变化量必须以十进制数形式的纳米为单位。比率 $\\rho$ 是无量纲的，必须以十进制数形式报告。",
            "solution": "该问题要求实现一个标量部分相干成像模型，以分析掩模偏置和拐角倒圆对投影光刻系统中最终空气像的影响。该解决方案必须根据傅里叶光学的基本原理构建，并根据所提供的物理和数值参数进行验证。该问题具有科学依据、定义明确，并且所有必要的参数都已指定。任务是计算一系列掩模几何形状相对于基准矩形特征的关键尺寸变化量（$\\Delta \\mathrm{CD}$）和高频光谱含量的相对变化量（$\\rho$）。\n\n解决方案系统地展开，首先定义计算域，然后生成掩模形状，计算其频谱，合成部分相干空气像，最后提取所需指标。\n\n首先，我们建立计算域。在空间域 $\\mathbf{x} = (x, y)$ 中定义一个二维方形网格，每个轴上有 $N=512$ 个样本，采样间距为 $\\Delta x = \\Delta y = 4$ nm。这导致总视场大小为 $L \\times L$，其中 $L = N \\Delta x = 2048$ nm。相应的频率域 $\\mathbf{f}=(f_x, f_y)$ 由离散傅里叶变换的性质决定。频率采样间距为 $\\Delta f = 1/L$，坐标以原点为中心，范围从负奈奎斯特频率到正奈奎斯特频率。\n\n光学系统由其波长 $\\lambda=193$ nm 和数值孔径 $\\mathrm{NA}=0.93$ 定义。这些参数决定了系统的分辨能力。在频率域中，系统的有限孔径由一个圆形光瞳函数 $P(\\mathbf{f})$ 建模，这是一个指示函数，对于空间频率大小小于或等于截止频率 $f_c$ 的情况为1，否则为0。\n$$\nf_c = \\frac{\\mathrm{NA}}{\\lambda} \\approx 0.004818 \\text{ cycles/nm}\n$$\n$$\nP(\\mathbf{f}) = \\begin{cases} 1, & \\|\\mathbf{f}\\| \\le f_c \\\\ 0, & \\|\\mathbf{f}\\| > f_c \\end{cases}\n$$\n其中 $\\|\\mathbf{f}\\| = \\sqrt{f_x^2 + f_y^2}$。\n\n要成像的对象是一个二元掩模。其传输函数 $t(x,y)$ 是为位于原点的圆角矩形指定的，标称宽度为 $W$，高度为 $H$。掩模偏置 $\\Delta$ 和拐角倒圆 $R$ 的影响通过修改几何形状来纳入。有效宽度和高度为 $W' = W + \\Delta$ 和 $H' = H + \\Delta$。圆角形状通过大小为 $(W'-2R) \\times (H'-2R)$ 的矩形和半径为 $R$ 的圆盘的闵可夫斯基和来建模。这由指示函数表示：\n$$\nt(x,y) = \\begin{cases}\n1,  & \\text{if } \\Big(\\max(|x| - a_x, 0)\\Big)^2 + \\Big(\\max(|y| - a_y, 0)\\Big)^2 \\le R^2 \\\\\n0,  & \\text{otherwise}\n\\end{cases}\n$$\n其中 $a_x = \\max(\\frac{W'}{2} - R, 0)$ 和 $a_y = \\max(\\frac{H'}{2} - R, 0)$。此函数在离散空间网格上进行数值构建。\n\n复值掩模谱 $T(\\mathbf{f}) = \\mathcal{F}\\{t(x,y)\\}$ 使用二维快速傅里叶变换（FFT）计算。从该谱中，我们计算第一个所需指标 $\\eta$，即位于光瞳截止半径 $f_c$ 之外的光谱能量分数。根据帕斯瓦尔定理，频率域中的能量与空间域中的能量成正比。因此，指标 $\\eta$ 为：\n$$\n\\eta = \\frac{\\sum_{\\|\\mathbf{f}\\| > f_c} |T(\\mathbf{f})|^2}{\\sum_{\\mathbf{f}} |T(\\mathbf{f})|^2}\n$$\n这是通过在 $\\|\\mathbf{f}\\| > f_c$ 的频率网格点上对离散谱分量的幅值平方进行求和，然后除以所有网格点上的总和来计算的。\n\n空气像强度 $I(\\mathbf{x})$ 使用用于部分相干成像的霍普金斯模型合成。照明光源被建模为一个半径为 $\\sigma f_c$ 的环带，我们将其离散为 $N_s=8$ 个等距的点源。每个位于频率空间位置 $\\mathbf{s}_k$ 的点源生成一个相干图像。单个点源的像平面场与掩模谱乘以一个移位后的光瞳函数的傅里叶逆变换成正比：\n$$\nE_{\\mathbf{s}_k}(\\mathbf{x}) \\propto \\mathcal{F}^{-1}\\left\\{ T(\\mathbf{f}) P(\\mathbf{f} - \\mathbf{s}_k) \\right\\}\n$$\n在数值上，对于每个光源点 $\\mathbf{s}_k$，在频率网格上生成移位光瞳 $P(\\mathbf{f} - \\mathbf{s}_k)$ 的二元掩模。这与掩模谱 $T(\\mathbf{f})$ 进行逐元素相乘，然后使用二维逆 FFT 将结果变换回空间域以获得 $E_{\\mathbf{s}_k}(\\mathbf{x})$。总空气像强度是来自所有光源点的图像的非相干叠加（强度之和）：\n$$\nI(\\mathbf{x}) = \\frac{1}{N_s} \\sum_{k=1}^{N_s} \\left| E_{\\mathbf{s}_k}(\\mathbf{x}) \\right|^2\n$$\n\n最后，我们从空气像中提取第二个指标，即关键尺寸（CD）。CD 定义为沿 x 轴的强度剖面 $I(x, 0)$ 的半峰全宽（FWHM）。强度剖面从二维强度矩阵 $I(\\mathbf{x})$ 的中心行中提取。找到此剖面的最大强度 $I_{max} = \\max(I(x, 0))$，并将半峰值阈值设置为 $I_{thresh} = 0.5 \\times I_{max}$。为了以亚网格精度确定宽度，我们找到强度剖面穿过此阈值的两个空间坐标 $x_{left}$ 和 $x_{right}$。这是通过在跨越阈值的网格点之间进行线性插值来实现的。CD 则是其差值：$\\mathrm{CD} = x_{right} - x_{left}$。\n\n对每个由 $(W, H, \\Delta, R, \\sigma)$ 指定的测试用例，执行这整个过程以找到 $\\mathrm{CD}_\\text{test}$ 和 $\\eta_\\text{test}$。同时，使用参数 $(W, H, 0, 0, \\sigma)$ 进行相应的基准计算，得到 $\\mathrm{CD}_\\text{baseline}$ 和 $\\eta_\\text{baseline}$。最终报告的值是 CD 的差异 $\\Delta \\mathrm{CD} = \\mathrm{CD}_\\text{test} - \\mathrm{CD}_\\text{baseline}$，以及高频能量分数的比率 $\\rho = \\eta_\\text{test} / \\eta_\\text{baseline}$。",
            "answer": "```python\nimport numpy as np\n\nclass LithoSimulator:\n    \"\"\"\n    Implements a scalar partially coherent imaging model for projection lithography.\n    \"\"\"\n    def __init__(self, lambd, NA, N, dx):\n        \"\"\"\n        Initializes the simulator with system and grid parameters.\n\n        Args:\n            lambd (float): Wavelength in nm.\n            NA (float): Numerical aperture.\n            N (int): Number of grid points along one dimension.\n            dx (float): Spatial grid pitch in nm.\n        \"\"\"\n        self.lambd = float(lambd)\n        self.NA = float(NA)\n        self.N = int(N)\n        self.dx = float(dx)\n\n        self.f_c = self.NA / self.lambd  # Pupil cutoff frequency in 1/nm\n\n        # Spatial grid (centered)\n        x_1d = (np.arange(self.N) - self.N / 2) * self.dx\n        self.X, self.Y = np.meshgrid(x_1d, x_1d)\n\n        # Frequency grid (centered)\n        f_1d = np.fft.fftshift(np.fft.fftfreq(self.N, d=self.dx))\n        self.FX, self.FY = np.meshgrid(f_1d, f_1d, indexing='ij')\n        self.F_rad = np.sqrt(self.FX**2 + self.FY**2)\n\n    def _create_mask(self, W, H, delta, R):\n        \"\"\"Generates the binary mask transmission function for a rounded rectangle.\"\"\"\n        W_prime = W + delta\n        H_prime = H + delta\n        \n        a_x = max(W_prime / 2.0 - R, 0.0)\n        a_y = max(H_prime / 2.0 - R, 0.0)\n        \n        term_x = np.maximum(np.abs(self.X) - a_x, 0.0)\n        term_y = np.maximum(np.abs(self.Y) - a_y, 0.0)\n        \n        mask = (term_x**2 + term_y**2) = R**2\n        return mask.astype(float)\n\n    def compute_metrics(self, W, H, delta, R, sigma):\n        \"\"\"\n        Computes aerial image CD and spectral energy metric for a given mask.\n        \n        Returns:\n            (float, float): A tuple containing (CD in nm, eta).\n        \"\"\"\n        # 1. Generate mask and its spectrum\n        t_xy = self._create_mask(W, H, delta, R)\n        T_f_unshifted = np.fft.fft2(t_xy)\n        T_f_shifted = np.fft.fftshift(T_f_unshifted)\n\n        # 2. Calculate eta (spectral energy metric)\n        total_energy = np.sum(np.abs(T_f_shifted)**2)\n        if total_energy  1e-9: # Effectively zero\n            eta = 0.0\n        else:\n            hf_mask = self.F_rad > self.f_c\n            hf_energy = np.sum(np.abs(T_f_shifted[hf_mask])**2)\n            eta = hf_energy / total_energy\n\n        # 3. Calculate aerial image intensity I(x,y)\n        N_s = 8\n        source_radius = sigma * self.f_c\n        thetas = np.linspace(0, 2 * np.pi, N_s, endpoint=False)\n        \n        I_xy = np.zeros((self.N, self.N), dtype=float)\n        \n        for k in range(N_s):\n            s_x = source_radius * np.cos(thetas[k])\n            s_y = source_radius * np.sin(thetas[k])\n            \n            shifted_pupil_FX = self.FX - s_x\n            shifted_pupil_FY = self.FY - s_y\n            shifted_pupil_rad = np.sqrt(shifted_pupil_FX**2 + shifted_pupil_FY**2)\n            \n            P_shifted = (shifted_pupil_rad = self.f_c).astype(float)\n            P_shifted_unshifted = np.fft.ifftshift(P_shifted)\n            \n            filtered_Tf = T_f_unshifted * P_shifted_unshifted\n            E_xy = np.fft.ifft2(filtered_Tf)\n            I_xy += np.abs(E_xy)**2\n        \n        I_xy /= N_s\n\n        # 4. Calculate CD\n        I_x_profile = I_xy[self.N // 2, :]\n        I_max = np.max(I_x_profile)\n        \n        if I_max  1e-9: # Effectively zero\n            return 0.0, eta\n        \n        threshold = 0.5 * I_max\n        above_thresh = I_x_profile > threshold\n        crossings = np.where(np.diff(above_thresh))[0]\n        \n        if len(crossings)  2:\n            # Fallback for unresolved or fully resolved features\n            cd_pixels = np.sum(above_thresh)\n            cd = cd_pixels * self.dx\n        else:\n            # Left edge interpolation\n            idx_left = crossings[0]\n            y1_left, y2_left = I_x_profile[idx_left], I_x_profile[idx_left + 1]\n            x1_left, x2_left = self.X[0, idx_left], self.X[0, idx_left + 1]\n            x_left = x1_left + (x2_left - x1_left) * (threshold - y1_left) / (y2_left - y1_left)\n\n            # Right edge interpolation\n            idx_right = crossings[-1]\n            y1_right, y2_right = I_x_profile[idx_right], I_x_profile[idx_right + 1]\n            x1_right, x2_right = self.X[0, idx_right], self.X[0, idx_right + 1]\n            x_right = x1_right + (x2_right - x1_right) * (threshold - y1_right) / (y2_right - y1_right)\n            \n            cd = x_right - x_left\n            \n        return cd, eta\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print results.\n    \"\"\"\n    # Define system parameters\n    LAMBDA = 193.0\n    NA = 0.93\n    N_GRID = 512\n    DX = 4.0\n\n    # Define test cases: (W, H, Delta, R, sigma)\n    test_cases = [\n        (100.0, 300.0, 0.0, 0.0, 0.3),\n        (100.0, 300.0, 5.0, 5.0, 0.3),\n        (100.0, 300.0, -5.0, 5.0, 0.7),\n        (100.0, 300.0, 10.0, 0.0, 0.7),\n        (100.0, 300.0, 0.0, 15.0, 0.5),\n    ]\n\n    simulator = LithoSimulator(lambd=LAMBDA, NA=NA, N=N_GRID, dx=DX)\n    results = []\n\n    for W, H, delta, R, sigma in test_cases:\n        # Calculate metrics for the test case\n        cd_test, eta_test = simulator.compute_metrics(W, H, delta, R, sigma)\n        \n        # Calculate metrics for the corresponding baseline (perfect rectangle)\n        cd_base, eta_base = simulator.compute_metrics(W, H, 0.0, 0.0, sigma)\n        \n        # Compute final reported values\n        delta_cd = cd_test - cd_base\n        \n        if abs(eta_base)  1e-9:\n             # This case is unlikely for the given features\n            rho = 0.0 if abs(eta_test)  1e-9 else float('inf')\n        else:\n            rho = eta_test / eta_base\n        \n        results.append([delta_cd, rho])\n        \n    print(f\"{results}\")\n\nsolve()\n```"
        }
    ]
}