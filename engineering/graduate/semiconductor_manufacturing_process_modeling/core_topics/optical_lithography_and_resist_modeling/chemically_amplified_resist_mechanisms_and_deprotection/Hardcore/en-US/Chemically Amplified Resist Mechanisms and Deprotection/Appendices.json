{
    "hands_on_practices": [
        {
            "introduction": "Before we can model the complex evolution of a chemically amplified resist during post-exposure bake, we must first accurately define its initial state. This exercise focuses on a critical first step: translating the resist's formulation parameters into the effective initial concentrations of acid, $[H^+]$, and base, $[B]$, within the polymer's free volume where reactions occur. Mastering this conversion  is fundamental for setting up any realistic kinetic or reaction-diffusion simulation, ensuring the model's starting point is physically sound.",
            "id": "4114955",
            "problem": "A chemically amplified photoresist film is modeled as a two-phase medium consisting of an immobile polymer matrix of volume fraction $\\phi_p \\in (0,1)$ and a contiguous nonpolymer free volume fraction $1-\\phi_p$ that hosts all mobile small molecules. The resist formulation contains a Photoacid Generator (PAG) with laboratory molarity $C_{\\mathrm{PAG}}$ and a basic quencher with laboratory molarity $C_B$, where both molarities are defined per unit total film volume prior to exposure. After exposure, each PAG molecule photolyzes with unit quantum yield to release exactly one proton (acid), and the Post-Exposure Bake (PEB) begins immediately. Assume that acid–base neutralization in the nonpolymer phase is instantaneous and stoichiometric with $1:1$ equivalence (one proton neutralizes one base molecule to form an inert salt), that no other reactions occur before the start of PEB, and that deprotection of protected polymer sites has not yet proceeded at $t=0^{+}$ of PEB. The reaction–diffusion state variables are the hydrogen ion concentration $[H^{+}]$, the free base concentration $[B]$, and the deprotected fraction of polymer sites $f$, all defined per unit nonpolymer free volume.\n\nStarting from conservation of moles, the definition of molarity as moles per unit volume, and the stated stoichiometry, derive closed-form expressions for the initial conditions $[H^{+}](\\mathbf{r},0)$, $[B](\\mathbf{r},0)$, and $f(\\mathbf{r},0)$ in the exposed region, expressed solely in terms of $\\phi_p$, $C_{\\mathrm{PAG}}$, and $C_B$. Report your result as a single row vector $\\big([H^{+}]_0 \\;\\; [B]_0 \\;\\; f_0\\big)$ where $[H^{+}]_0 = [H^{+}](\\mathbf{r},0)$, $[B]_0 = [B](\\mathbf{r},0)$, and $f_0 = f(\\mathbf{r},0)$. No numerical evaluation is required. Do not include units in your final reported vector.",
            "solution": "The problem is first validated to ensure it is self-contained, scientifically grounded, and well-posed.\n\n**Step 1: Extract Givens**\n- Photoresist film is a two-phase medium.\n- Volume fraction of immobile polymer matrix: $\\phi_p \\in (0,1)$.\n- Volume fraction of nonpolymer free volume: $1-\\phi_p$.\n- Mobile small molecules are hosted in the nonpolymer free volume.\n- Laboratory molarity of Photoacid Generator (PAG): $C_{\\mathrm{PAG}}$ (moles per unit total film volume).\n- Laboratory molarity of basic quencher: $C_B$ (moles per unit total film volume).\n- PAG photolysis: one PAG molecule yields one proton ($H^{+}$) with unit quantum yield.\n- Post-Exposure Bake (PEB) starts at time $t=0$.\n- At $t=0$ (specifically, $t=0^{+}$):\n    - Acid-base neutralization is instantaneous and stoichiometric with $1:1$ equivalence.\n    - Neutralization occurs in the nonpolymer phase.\n    - No other reactions have occurred.\n    - Deprotection has not yet started.\n- State variables, defined per unit nonpolymer free volume:\n    - Hydrogen ion concentration: $[H^{+}]$.\n    - Free base concentration: $[B]$.\n    - Deprotected fraction of polymer sites: $f$.\n- Objective: Derive expressions for the initial conditions $[H^{+}]_0 = [H^{+}](\\mathbf{r},0)$, $[B]_0 = [B](\\mathbf{r},0)$, and $f_0 = f(\\mathbf{r},0)$ in terms of $\\phi_p$, $C_{\\mathrm{PAG}}$, and $C_B$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement describes a simplified but standard model for the initial state of a chemically amplified resist after exposure and before significant deprotection during the PEB. The distinction between laboratory molarity (per total volume) and the species concentration in the free volume is a key, realistic aspect of modeling heterogeneous media. The assumptions of instantaneous neutralization and zero initial deprotection are common for establishing initial conditions in reaction-diffusion models of this process. The problem is scientifically grounded, well-posed, objective, and contains sufficient information to derive a unique solution. No contradictions, ambiguities, or factual unsoundness are present.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full solution will be provided.\n\n**Derivation of Initial Conditions**\n\nThe goal is to determine the initial values of the state variables $[H^{+}]_0$, $[B]_0$, and $f_0$ at the beginning of the PEB, denoted by $t=0$.\n\n1.  **Initial Deprotected Fraction, $f_0$**\n    The problem explicitly states that \"deprotection of protected polymer sites has not yet proceeded at $t=0^{+}$ of PEB\". The variable $f$ represents the fraction of deprotected sites. Therefore, its initial value must be zero.\n    $$f_0 = f(\\mathbf{r},0) = 0$$\n\n2.  **Initial Concentrations of Acid and Base, $[H^{+}]_0$ and $[B]_0$**\n    This requires a careful consideration of the volume basis for the concentrations and the stoichiometry of the neutralization reaction.\n\n    a. **Volume Basis Conversion:**\n    The given molarities, $C_{\\mathrm{PAG}}$ and $C_B$, are \"laboratory molarities\" defined per unit total film volume, let's call it $V_{total}$. The state variables, $[H^{+}]$ and $[B]$, are concentrations defined per unit nonpolymer free volume, $V_{free}$. The relationship between these volumes is given by the polymer volume fraction $\\phi_p$:\n    $$V_{free} = (1 - \\phi_p) V_{total}$$\n    All mobile species, including the generated acid ($H^{+}$) and the base quencher ($B$), are confined to this free volume.\n\n    b. **Initial Molarities in the Free Volume (before neutralization):**\n    First, we determine the number of moles of each species in a representative total volume $V_{total}$.\n    - Moles of PAG: $n_{\\mathrm{PAG}} = C_{\\mathrm{PAG}} V_{total}$\n    - Moles of base: $n_{B} = C_B V_{total}$\n\n    Upon exposure, each PAG molecule generates one proton. Thus, the initial number of moles of acid available is $n_{H} = n_{\\mathrm{PAG}} = C_{\\mathrm{PAG}} V_{total}$.\n\n    To find the initial concentrations of these species within the nonpolymer free volume where they reside, we must divide the number of moles by $V_{free}$. Let us denote these pre-neutralization concentrations as $C_{H, \\text{initial}}$ and $C_{B, \\text{initial}}$.\n    $$C_{H, \\text{initial}} = \\frac{n_{H}}{V_{free}} = \\frac{C_{\\mathrm{PAG}} V_{total}}{(1 - \\phi_p) V_{total}} = \\frac{C_{\\mathrm{PAG}}}{1 - \\phi_p}$$\n    $$C_{B, \\text{initial}} = \\frac{n_{B}}{V_{free}} = \\frac{C_{B} V_{total}}{(1 - \\phi_p) V_{total}} = \\frac{C_B}{1 - \\phi_p}$$\n    These are the effective concentrations of acid and base that are available to react at the start of the PEB.\n\n    c. **Stoichiometric Neutralization:**\n    The problem states that acid-base neutralization ($H^{+} + B \\rightarrow \\text{Salt}$) is instantaneous and occurs with $1:1$ stoichiometry. This is a limiting reactant problem. The species in lower concentration will be completely consumed.\n\n    - If $C_{H, \\text{initial}} > C_{B, \\text{initial}}$, acid is in excess. All the base is consumed.\n        The final concentration of acid is $[H^{+}]_0 = C_{H, \\text{initial}} - C_{B, \\text{initial}} = \\frac{C_{\\mathrm{PAG}} - C_B}{1 - \\phi_p}$.\n        The final concentration of base is $[B]_0 = 0$.\n\n    - If $C_{B, \\text{initial}} > C_{H, \\text{initial}}$, base is in excess. All the acid is consumed.\n        The final concentration of acid is $[H^{+}]_0 = 0$.\n        The final concentration of base is $[B]_0 = C_{B, \\text{initial}} - C_{H, \\text{initial}} = \\frac{C_B - C_{\\mathrm{PAG}}}{1 - \\phi_p}$.\n\n    - If $C_{H, \\text{initial}} = C_{B, \\text{initial}}$, both reactants are completely consumed.\n        $[H^{+}]_0 = 0$ and $[B]_0 = 0$.\n\n    d. **General Expressions:**\n    These three cases can be compactly represented using the maximum function, `$\\max(a, b)$`, which returns the greater of $a$ and $b$.\n    The concentration of acid remaining is the initial amount minus the amount that reacted, but it cannot be negative.\n    $$[H^{+}]_0 = \\max\\left(0, C_{H, \\text{initial}} - C_{B, \\text{initial}}\\right) = \\max\\left(0, \\frac{C_{\\mathrm{PAG}}}{1 - \\phi_p} - \\frac{C_B}{1 - \\phi_p}\\right)$$\n    Since $1 - \\phi_p > 0$, we can write:\n    $$[H^{+}]_0 = \\frac{\\max(0, C_{\\mathrm{PAG}} - C_B)}{1 - \\phi_p}$$\n    Similarly, the concentration of base remaining is:\n    $$[B]_0 = \\max\\left(0, C_{B, \\text{initial}} - C_{H, \\text{initial}}\\right) = \\max\\left(0, \\frac{C_B}{1 - \\phi_p} - \\frac{C_{\\mathrm{PAG}}}{1 - \\phi_p}\\right)$$\n    $$[B]_0 = \\frac{\\max(0, C_B - C_{\\mathrm{PAG}})}{1 - \\phi_p}$$\n    These expressions are independent of the spatial coordinate $\\mathbf{r}$ within the exposed region, as the initial loading and exposure are assumed uniform therein.\n\n3.  **Final Result Vector**\n    Combining the results for $[H^{+}]_0$, $[B]_0$, and $f_0$, we form the required row vector:\n    $$\\big([H^{+}]_0 \\;\\; [B]_0 \\;\\; f_0\\big) = \\left(\\frac{\\max(0, C_{\\mathrm{PAG}} - C_B)}{1 - \\phi_p} \\;\\; \\frac{\\max(0, C_B - C_{\\mathrm{PAG}})}{1 - \\phi_p} \\;\\; 0\\right)$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\max(0, C_{\\mathrm{PAG}} - C_B)}{1 - \\phi_p} & \\frac{\\max(0, C_B - C_{\\mathrm{PAG}})}{1 - \\phi_p} & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The kinetics of deprotection are not just governed by chemical concentrations; they are profoundly influenced by the physical state of the polymer matrix itself. This practice explores the crucial phenomenon of vitrification, where solvent evaporation during the bake increases the resist's glass transition temperature, $T_g$, potentially arresting molecular motion and halting the deprotection reaction. By coupling solvent loss kinetics with a polymer mixing rule for $T_g$, you will determine if and when a reaction \"freezes\" , a vital consideration for predicting final resist profiles and process windows.",
            "id": "4114959",
            "problem": "A chemically amplified resist (CAR) film is subjected to a Post Exposure Bake (PEB) at an isothermal temperature of $T_{b} = 393\\,\\mathrm{K}$ for $60\\,\\mathrm{s}$. The deprotection proceeds by an acid-catalyzed, pseudo-first-order process with rate constant $k = 0.050\\,\\mathrm{s}^{-1}$, provided that segmental mobility remains above a critical threshold. Assume that falling below this mobility threshold coincides with vitrification, operationally defined by the condition that the mixture Glass Transition Temperature (Tg) rises to or above the bake temperature, that is, $T_{g,\\mathrm{mix}}(t) \\ge T_{b}$, at which point deprotection effectively ceases.\n\nThe dry polymer Glass Transition Temperature is $T_{g,p} = 423\\,\\mathrm{K}$. The casting solvent acts as a plasticizer with an effective Glass Transition Temperature of $T_{g,s} = 150\\,\\mathrm{K}$. At the start of PEB, the solvent weight fraction in the film is $w_{s,0} = 0.25$. Solvent evaporates during PEB according to first-order kinetics, so that the solvent weight fraction evolves as $w_{s}(t) = w_{s,0}\\,\\exp(-k_{e} t)$, with an evaporation rate constant $k_{e} = 0.050\\,\\mathrm{s}^{-1}$. You may assume the polymer weight fraction is $w_{p}(t) = 1 - w_{s}(t)$. The mixture Glass Transition Temperature can be approximated by the Fox mixing rule, $\\dfrac{1}{T_{g,\\mathrm{mix}}} = \\dfrac{w_{p}}{T_{g,p}} + \\dfrac{w_{s}}{T_{g,s}}$.\n\nTreat the deprotection conversion as $f(t) = 1 - \\exp(-k t)$ until vitrification occurs; after vitrification time $t_{v}$, take $f(t) = f(t_{v})$ for all $t \\ge t_{v}$. Evaluate whether vitrification is expected during the $60\\,\\mathrm{s}$ PEB and its impact on halting deprotection due to mobility falling below the critical threshold. Which of the following is most consistent with the above model and data?\n\nA. No vitrification occurs within $60\\,\\mathrm{s}$ at $T_{b} = 393\\,\\mathrm{K}$; mobility remains above threshold and deprotection proceeds essentially to completion, with $f(60\\,\\mathrm{s}) \\gtrsim 0.95$.\n\nB. Vitrification occurs during PEB when the solvent weight fraction falls to approximately $0.042$, at about $t_{v} \\approx 36\\,\\mathrm{s}$; deprotection then halts at $f(t_{v}) \\approx 0.83$.\n\nC. Vitrification occurs almost immediately, within $t_{v} < 5\\,\\mathrm{s}$, because the initial $T_{g,\\mathrm{mix}}$ exceeds $T_{b}$; deprotection is negligible with $f(t_{v}) \\lesssim 0.10$.\n\nD. Vitrification occurs only after $60\\,\\mathrm{s}$ because residual solvent keeps $T_{g,\\mathrm{mix}} < T_{b}$ throughout the bake; deprotection reaches $f(60\\,\\mathrm{s}) \\approx 0.95$ and vitrifies only upon cooldown.",
            "solution": "The problem statement provides a quantitative model for the interplay between solvent evaporation and deprotection kinetics in a chemically amplified resist during a post-exposure bake. All provided parameters, equations, and conditions are scientifically sound, well-defined, and self-consistent, forming a well-posed problem in polymer physics and reaction kinetics as applied to semiconductor manufacturing. The problem is therefore valid.\n\nThe central task is to determine if and when the resist film vitrifies during the bake, and what the extent of deprotection is at that point. Vitrification is defined to occur at time $t_{v}$ when the mixture's glass transition temperature, $T_{g,\\mathrm{mix}}(t)$, rises to equal the bake temperature, $T_{b}$. At this point, deprotection is assumed to cease. The condition for vitrification is thus:\n$$T_{g,\\mathrm{mix}}(t_{v}) = T_{b}$$\n\nWe use the provided Fox mixing rule to express this condition in terms of the component weight fractions and their respective glass transition temperatures:\n$$\\dfrac{1}{T_{g,\\mathrm{mix}}(t_{v})} = \\dfrac{1}{T_{b}} = \\dfrac{w_{p}(t_{v})}{T_{g,p}} + \\dfrac{w_{s}(t_{v})}{T_{g,s}}$$\nLet $w_{s,v}$ be the critical weight fraction of the solvent at the vitrification time $t_{v}$. Using the relation $w_{p}(t_{v}) = 1 - w_{s}(t_{v}) = 1 - w_{s,v}$, we can solve for $w_{s,v}$:\n$$\\dfrac{1}{T_{b}} = \\dfrac{1 - w_{s,v}}{T_{g,p}} + \\dfrac{w_{s,v}}{T_{g,s}}$$\n$$\\dfrac{1}{T_{b}} - \\dfrac{1}{T_{g,p}} = w_{s,v} \\left( \\dfrac{1}{T_{g,s}} - \\dfrac{1}{T_{g,p}} \\right)$$\n$$w_{s,v} = \\dfrac{\\dfrac{1}{T_{b}} - \\dfrac{1}{T_{g,p}}}{\\dfrac{1}{T_{g,s}} - \\dfrac{1}{T_{g,p}}}$$\n\nSubstituting the given values $T_{b} = 393\\,\\mathrm{K}$, $T_{g,p} = 423\\,\\mathrm{K}$, and $T_{g,s} = 150\\,\\mathrm{K}$:\n$$w_{s,v} = \\dfrac{\\dfrac{1}{393\\,\\mathrm{K}} - \\dfrac{1}{423\\,\\mathrm{K}}}{\\dfrac{1}{150\\,\\mathrm{K}} - \\dfrac{1}{423\\,\\mathrm{K}}}$$\n$$w_{s,v} = \\dfrac{0.0025445... - 0.0023641...}{0.0066667... - 0.0023641...} \\,\\mathrm{K}^{-1}/\\mathrm{K}^{-1}$$\n$$w_{s,v} = \\dfrac{0.00018044}{0.00430258} \\approx 0.041938$$\nVitrification occurs when the solvent weight fraction drops to approximately $0.042$.\n\nNext, we find the time $t_{v}$ at which this critical solvent fraction is reached. The solvent weight fraction $w_{s}(t)$ evolves according to $w_{s}(t) = w_{s,0}\\,\\exp(-k_{e} t)$, with $w_{s,0} = 0.25$ and $k_{e} = 0.050\\,\\mathrm{s}^{-1}$.\n$$w_{s,v} = w_{s,0}\\,\\exp(-k_{e} t_{v})$$\n$$t_{v} = -\\dfrac{1}{k_{e}} \\ln\\left(\\dfrac{w_{s,v}}{w_{s,0}}\\right)$$\nSubstituting the values:\n$$t_{v} = -\\dfrac{1}{0.050\\,\\mathrm{s}^{-1}} \\ln\\left(\\dfrac{0.041938}{0.25}\\right)$$\n$$t_{v} = -20\\,\\mathrm{s} \\times \\ln(0.16775)$$\n$$t_{v} = -20\\,\\mathrm{s} \\times (-1.7852) \\approx 35.70\\,\\mathrm{s}$$\nSince $t_{v} \\approx 36\\,\\mathrm{s}$ is less than the total bake time of $60\\,\\mathrm{s}$, vitrification occurs during the process.\n\nDeprotection is described by $f(t) = 1 - \\exp(-k t)$ with $k = 0.050\\,\\mathrm{s}^{-1}$. According to the problem, the reaction stops at $t_{v}$, so the final conversion is $f(t_{v})$.\n$$f(t_{v}) = 1 - \\exp(-k t_{v})$$\n$$f(35.70\\,\\mathrm{s}) = 1 - \\exp(-0.050\\,\\mathrm{s}^{-1} \\times 35.70\\,\\mathrm{s})$$\n$$f(35.70\\,\\mathrm{s}) = 1 - \\exp(-1.785)$$\n$$f(35.70\\,\\mathrm{s}) = 1 - 0.16779 \\approx 0.8322$$\nThe deprotection halts at a final conversion of approximately $f(t_{v}) \\approx 0.83$.\n\nNow we evaluate the given options.\n\nA. No vitrification occurs within $60\\,\\mathrm{s}$ at $T_{b} = 393\\,\\mathrm{K}$; mobility remains above threshold and deprotection proceeds essentially to completion, with $f(60\\,\\mathrm{s}) \\gtrsim 0.95$.\nThis is **Incorrect**. Our calculation shows that vitrification does occur at $t_{v} \\approx 36\\,\\mathrm{s}$, which is within the $60\\,\\mathrm{s}$ bake time. Thus, deprotection does not proceed for the full $60\\,\\mathrm{s}$. While a full $60\\,\\mathrm{s}$ bake would yield $f(60) = 1 - \\exp(-0.050 \\times 60) = 1 - \\exp(-3) \\approx 0.95$, this state is not reached because the reaction is arrested by vitrification.\n\nB. Vitrification occurs during PEB when the solvent weight fraction falls to approximately $0.042$, at about $t_{v} \\approx 36\\,\\mathrm{s}$; deprotection then halts at $f(t_{v}) \\approx 0.83$.\nThis is **Correct**. Our calculations show that the critical solvent weight fraction for vitrification is $w_{s,v} \\approx 0.042$, the time to reach this state is $t_{v} \\approx 36\\,\\mathrm{s}$, and the deprotection conversion at this time is $f(t_{v}) \\approx 0.83$. This option accurately summarizes the results of the model.\n\nC. Vitrification occurs almost immediately, within $t_{v} < 5\\,\\mathrm{s}$, because the initial $T_{g,\\mathrm{mix}}$ exceeds $T_{b}$; deprotection is negligible with $f(t_{v}) \\lesssim 0.10$.\nThis is **Incorrect**. We can calculate the initial glass transition temperature at $t=0$, where $w_{s}(0) = 0.25$ and $w_{p}(0) = 0.75$:\n$\\dfrac{1}{T_{g,\\mathrm{mix}}(0)} = \\dfrac{0.75}{423\\,\\mathrm{K}} + \\dfrac{0.25}{150\\,\\mathrm{K}} \\approx 0.001773 + 0.001667 = 0.00344\\,\\mathrm{K}^{-1}$.\n$T_{g,\\mathrm{mix}}(0) \\approx 291\\,\\mathrm{K}$. This is well below the bake temperature $T_{b} = 393\\,\\mathrm{K}$, so the film is initially in a rubbery, mobile state. Vitrification does not occur immediately.\n\nD. Vitrification occurs only after $60\\,\\mathrm{s}$ because residual solvent keeps $T_{g,\\mathrm{mix}} < T_{b}$ throughout the bake; deprotection reaches $f(60\\,\\mathrm{s}) \\approx 0.95$ and vitrifies only upon cooldown.\nThis is **Incorrect**. Our calculation explicitly shows that vitrification occurs at $t_{v} \\approx 36\\,\\mathrm{s}$, well before the $60\\,\\mathrm{s}$ bake is complete. The premise that $T_{g,\\mathrm{mix}}$ remains below $T_b$ throughout the bake is false. Consequently, deprotection is halted and does not reach the theoretical maximum of $f(60\\,\\mathrm{s}) \\approx 0.95$.",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "The ultimate goal of process modeling is to predict the final spatial profile of the developed resist, which requires integrating all relevant physics into a cohesive simulation. This comprehensive exercise guides you through building a one-dimensional reaction-diffusion model from the ground up, using a finite-volume method to solve the coupled partial differential equations for acid, quencher, and polymer state. This practice  combines the concepts of initial conditions, reaction kinetics, and mass transport, providing hands-on experience with the numerical techniques and stability considerations that are central to predictive lithography simulation.",
            "id": "4114933",
            "problem": "A one-dimensional chemically amplified resist (CAR) film of thickness $L$ is modeled during post-exposure bake as a coupled reaction–diffusion system for acid concentration $a(x,t)$, base (quencher) concentration $b(x,t)$, and protected polymer fraction $p(x,t)$. The film occupies the interval $x \\in [0,L]$ with zero-flux boundaries. The governing physical bases are Fick's law of diffusion, mass conservation, and acid-catalyzed deprotection kinetics with base quenching and intrinsic acid loss. The mathematical model is:\n- Diffusion of acid governed by Fick's second law and reactive sinks,\n- Mass action for base quenching,\n- Acid-catalyzed deprotection treated as a first-order reaction in $a$ and $p$.\n\nStarting from these principles, you must:\n1. Derive a finite-volume discretization on a uniform grid of $N_x$ control volumes of width $\\Delta x = L/N_x$, with cell centers at $x_i$, $i = 0,\\dots,N_x-1$, and zero-flux (Neumann) boundary conditions at $x=0$ and $x=L$ for the acid. The acid flux at a face is governed by Fick's law, and the net diffusive term must be expressed in terms of neighboring cell-centered values. The reaction terms for $a$, $b$, and $p$ must be incorporated using explicit time integration. Clearly state the discrete update for each cell using only quantities from the previous time step.\n2. From first principles of linear stability analysis applied to the discrete diffusion operator in one dimension, derive a sufficient condition on the time step $\\Delta t$ relative to $\\Delta x$ and the acid diffusion coefficient $D$ that guarantees stability of the explicit time integration for the diffusion term. Use this derived condition to compute, for each test case, a boolean flag indicating whether the chosen $\\Delta t$ satisfies the stability requirement for the diffusion part of the update on the given grid.\n3. Implement the explicit finite-volume update with uniform time step $\\Delta t$ until final bake time $T$. To preserve physical plausibility, enforce $a(x,t) \\ge 0$, $b(x,t) \\ge 0$, and $0 \\le p(x,t) \\le 1$ at every step. The initial conditions at $t=0$ are $p(x,0)=1$, $b(x,0)=b_0$ (constant), and a Gaussian acid distribution $a(x,0) = a_0 \\exp\\left(-\\frac{(x - L/2)^2}{2\\sigma^2}\\right)$.\n4. For each test case below, compute the spatial average of the deprotected fraction at final time, defined as $1 - \\frac{1}{L}\\int_0^L p(x,T)\\,dx$, and also compute the boolean flag indicating whether the diffusion stability condition derived in step $2$ holds. Express the spatial average as a decimal fraction. Angles do not appear in this problem. All physical units must be respected: lengths in $\\mathrm{m}$, times in $\\mathrm{s}$, and diffusion coefficients in $\\mathrm{m^2/s}$. The final output format must be a single line containing a comma-separated list enclosed in square brackets, where each test case result is itself a two-element list of the form $[\\text{average\\_deprotected\\_fraction},\\text{stability\\_flag}]$.\n\nUse the following test suite, which spans typical behavior, boundary stability, instability, and reaction-dominated regimes. For each test case, all parameters are provided, and $T$ is an exact multiple of $\\Delta t$:\n\n- Test case $1$ (typical): $L = 1.0 \\times 10^{-7}\\ \\mathrm{m}$, $N_x = 50$, $D = 1.0 \\times 10^{-15}\\ \\mathrm{m^2/s}$, $\\Delta t = 1.0 \\times 10^{-3}\\ \\mathrm{s}$, $T = 1.0\\ \\mathrm{s}$, $a_0 = 0.5$, $\\sigma = L/10$, $b_0 = 0.1$, $k_d = 50.0\\ \\mathrm{s^{-1}}$, $k_q = 10.0\\ \\mathrm{s^{-1}}$, $k_\\ell = 1.0\\ \\mathrm{s^{-1}}$.\n- Test case $2$ (boundary stability choice): $L = 1.0 \\times 10^{-7}\\ \\mathrm{m}$, $N_x = 25$, $D = 2.0 \\times 10^{-15}\\ \\mathrm{m^2/s}$, $\\Delta t = 4.0 \\times 10^{-3}\\ \\mathrm{s}$, $T = 0.4\\ \\mathrm{s}$, $a_0 = 0.2$, $\\sigma = L/6$, $b_0 = 0.05$, $k_d = 100.0\\ \\mathrm{s^{-1}}$, $k_q = 20.0\\ \\mathrm{s^{-1}}$, $k_\\ell = 0.5\\ \\mathrm{s^{-1}}$.\n- Test case $3$ (intentional instability in diffusion step): $L = 1.0 \\times 10^{-7}\\ \\mathrm{m}$, $N_x = 50$, $D = 1.0 \\times 10^{-15}\\ \\mathrm{m^2/s}$, $\\Delta t = 3.0 \\times 10^{-3}\\ \\mathrm{s}$, $T = 0.6\\ \\mathrm{s}$, $a_0 = 0.7$, $\\sigma = L/12$, $b_0 = 0.2$, $k_d = 80.0\\ \\mathrm{s^{-1}}$, $k_q = 5.0\\ \\mathrm{s^{-1}}$, $k_\\ell = 1.0\\ \\mathrm{s^{-1}}$.\n- Test case $4$ (reaction-dominated, small diffusion): $L = 2.0 \\times 10^{-7}\\ \\mathrm{m}$, $N_x = 80$, $D = 5.0 \\times 10^{-16}\\ \\mathrm{m^2/s}$, $\\Delta t = 3.0 \\times 10^{-3}\\ \\mathrm{s}$, $T = 0.6\\ \\mathrm{s}$, $a_0 = 0.4$, $\\sigma = L/8$, $b_0 = 0.05$, $k_d = 200.0\\ \\mathrm{s^{-1}}$, $k_q = 15.0\\ \\mathrm{s^{-1}}$, $k_\\ell = 0.2\\ \\mathrm{s^{-1}}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result formatted as $[\\text{average\\_deprotected\\_fraction},\\text{stability\\_flag}]$, for example, $[[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4]]$, where $x_i$ are floats and $y_i$ are booleans.",
            "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and all necessary information is provided.\n\n### Step 1: Extract Givens\n\n**Governing Physical Principles:**\n1.  Acid diffusion governed by Fick's second law.\n2.  Reactive sinks for a one-dimensional chemically amplified resist (CAR) film.\n3.  Mass action for base quenching.\n4.  Acid-catalyzed deprotection as a first-order reaction in acid concentration $a(x,t)$ and protected polymer fraction $p(x,t)$.\n5.  Intrinsic acid loss.\n\n**Variables and Constants:**\n-   Acid concentration: $a(x,t)$.\n-   Base (quencher) concentration: $b(x,t)$.\n-   Protected polymer fraction: $p(x,t)$.\n-   Film thickness: $L$.\n-   Number of control volumes: $N_x$.\n-   Acid diffusion coefficient: $D$.\n-   Time step: $\\Delta t$.\n-   Total bake time: $T$.\n-   Initial peak acid concentration: $a_0$.\n-   Initial acid distribution width: $\\sigma$.\n-   Initial base concentration: $b_0$.\n-   Deprotection reaction rate constant: $k_d$.\n-   Quenching reaction rate constant: $k_q$.\n-   Acid loss rate constant: $k_\\ell$.\n\n**Domain and Boundaries:**\n-   Spatial domain: $x \\in [0, L]$.\n-   Boundary conditions for acid: Zero-flux (Neumann) at $x=0$ and $x=L$. $\\left.\\frac{\\partial a}{\\partial x}\\right|_{x=0} = 0$ and $\\left.\\frac{\\partial a}{\\partial x}\\right|_{x=L} = 0$.\n\n**Initial Conditions ($t=0$):**\n-   $p(x,0) = 1$.\n-   $b(x,0) = b_0$.\n-   $a(x,0) = a_0 \\exp\\left(-\\frac{(x - L/2)^2}{2\\sigma^2}\\right)$.\n\n**Discretization:**\n-   Uniform grid with $N_x$ control volumes.\n-   Control volume width: $\\Delta x = L/N_x$.\n-   Cell centers at $x_i$ for $i = 0, \\dots, N_x-1$.\n\n**Required Outputs:**\n1.  Spatial average of the deprotected fraction at time $T$: $1 - \\frac{1}{L}\\int_0^L p(x,T)\\,dx$.\n2.  Boolean flag for diffusion stability.\n\nTest cases with specific parameter values for $L, N_x, D, \\Delta t, T, a_0, \\sigma, b_0, k_d, k_q, k_\\ell$ are provided.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientifically Grounded:** The problem describes a reaction-diffusion system, a standard mathematical model in physical chemistry and engineering. The kinetics (mass action, first-order catalysis) and transport (Fickian diffusion) are fundamental, established principles. The application to CARs is a well-studied topic in semiconductor process modeling. The model is a valid, if simplified, representation of the physical processes.\n-   **Well-Posed:** The problem is an initial-boundary value problem for a system of parabolic and ordinary differential equations. The initial conditions, boundary conditions, and governing equations are clearly specified, making it a well-posed problem for which a unique solution is expected to exist.\n-   **Objective:** The problem is stated using precise, objective, and quantitative language. There are no subjective or opinion-based elements.\n-   **Completeness and Consistency:** All necessary parameters and conditions for a numerical simulation are provided. The units are consistent. There are no contradictions in the problem statement. The condition that $T$ is an exact multiple of $\\Delta t$ simplifies the time integration loop.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **valid**. It is a well-defined scientific modeling task based on established principles. We proceed to the solution.\n\n### Derivation and Solution\n\n#### 1. Governing Partial Differential Equations (PDEs)\n\nBased on the provided physical principles, we formulate the coupled PDE system for the concentrations $a(x,t)$, $b(x,t)$, and $p(x,t)$ on the domain $x \\in [0, L]$.\n\n1.  **Acid Concentration $a(x,t)$:** The rate of change of acid concentration is due to diffusion (Fick's second law) and reactive sinks from quenching and intrinsic loss. Acid is a catalyst for deprotection and is not consumed in that reaction.\n    $$ \\frac{\\partial a}{\\partial t} = D \\frac{\\partial^2 a}{\\partial x^2} - k_q a b - k_\\ell a $$\n2.  **Base Concentration $b(x,t)$:** The base is consumed by the quenching reaction with the acid. It is assumed to be non-diffusive.\n    $$ \\frac{\\partial b}{\\partial t} = -k_q a b $$\n3.  **Protected Polymer Fraction $p(x,t)$:** The protected sites are converted to deprotected sites via an acid-catalyzed reaction, which is first-order in both $a$ and $p$. The polymer is also non-diffusive.\n    $$ \\frac{\\partial p}{\\partial t} = -k_d a p $$\n\n#### 2. Finite-Volume Discretization\n\nWe discretize the spatial domain $x \\in [0,L]$ into $N_x$ uniform control volumes (cells) $CV_i$, each of width $\\Delta x = L/N_x$. The $i$-th cell, for $i=0, \\dots, N_x-1$, is centered at $x_i = (i+0.5)\\Delta x$ and spans the interval $[i\\Delta x, (i+1)\\Delta x]$. Let $a_i(t), b_i(t), p_i(t)$ represent the spatial averages of the respective quantities over $CV_i$.\n\nIntegrating the acid PDE over $CV_i = [x_i - \\Delta x/2, x_i + \\Delta x/2]$ gives:\n$$ \\int_{CV_i} \\frac{\\partial a}{\\partial t} dx = \\int_{CV_i} \\left( D \\frac{\\partial^2 a}{\\partial x^2} - k_q a b - k_\\ell a \\right) dx $$\nApproximating the spatial averages and applying the divergence theorem in one dimension:\n$$ \\Delta x \\frac{da_i}{dt} \\approx D \\left[ \\left.\\frac{\\partial a}{\\partial x}\\right|_{i+1/2} - \\left.\\frac{\\partial a}{\\partial x}\\right|_{i-1/2} \\right] - (k_q a_i b_i + k_\\ell a_i)\\Delta x $$\nwhere $i-1/2$ and $i+1/2$ denote the cell faces. The fluxes at the faces are approximated using a centered difference scheme:\n$$ \\left.\\frac{\\partial a}{\\partial x}\\right|_{i+1/2} \\approx \\frac{a_{i+1} - a_i}{\\Delta x} $$\nThe net diffusive flux into cell $i$ is thus:\n$$ D \\left( \\frac{a_{i+1} - a_i}{\\Delta x} - \\frac{a_i - a_{i-1}}{\\Delta x} \\right) = D \\frac{a_{i+1} - 2a_i + a_{i-1}}{\\Delta x} $$\nDividing by $\\Delta x$, the semi-discrete equation for an interior cell ($i=1, \\dots, N_x-2$) is:\n$$ \\frac{da_i}{dt} = D \\frac{a_{i+1} - 2a_i + a_{i-1}}{(\\Delta x)^2} - k_q a_i b_i - k_\\ell a_i $$\nFor the boundary cells, we apply the zero-flux conditions.\n-   At $x=0$, the flux $\\left.\\frac{\\partial a}{\\partial x}\\right|_{-1/2} = 0$. For cell $i=0$:\n    $$ \\frac{da_0}{dt} = D \\frac{a_1 - a_0}{(\\Delta x)^2} - k_q a_0 b_0 - k_\\ell a_0 $$\n-   At $x=L$, the flux $\\left.\\frac{\\partial a}{\\partial x}\\right|_{N_x-1/2} = 0$. For cell $i=N_x-1$:\n    $$ \\frac{da_{N_x-1}}{dt} = D \\frac{a_{N_x-2} - a_{N_x-1}}{(\\Delta x)^2} - k_q a_{N_x-1} b_{N_x-1} - k_\\ell a_{N_x-1} $$\nThe equations for $b$ and $p$ are ODEs at each grid point:\n$$ \\frac{db_i}{dt} = -k_q a_i b_i \\quad \\text{and} \\quad \\frac{dp_i}{dt} = -k_d a_i p_i $$\nWe use an explicit forward Euler scheme for time integration with step $\\Delta t$. Let $a_i^n$ be the value of $a_i$ at time $t_n = n\\Delta t$. The discrete update equations are:\n$$ a_i^{n+1} = a_i^n + \\Delta t \\cdot \\left( \\text{DiffusionTerm}_i^n - k_q a_i^n b_i^n - k_\\ell a_i^n \\right) $$\n$$ b_i^{n+1} = b_i^n - \\Delta t \\cdot k_q a_i^n b_i^n $$\n$$ p_i^{n+1} = p_i^n - \\Delta t \\cdot k_d a_i^n p_i^n $$\nwhere the diffusion term is:\n$$ \\text{DiffusionTerm}_i^n = \\begin{cases} D \\frac{a_1^n - a_0^n}{(\\Delta x)^2} & i=0 \\\\ D \\frac{a_{i+1}^n - 2a_i^n + a_{i-1}^n}{(\\Delta x)^2} & i=1, \\dots, N_x-2 \\\\ D \\frac{a_{N_x-2}^n - a_{N_x-1}^n}{(\\Delta x)^2} & i=N_x-1 \\end{cases} $$\n\n#### 3. Stability Condition\n\nWe perform a linear stability analysis on the explicit diffusion update scheme (Forward-Time Centered-Space, FTCS). The analysis focuses on the diffusion term, as it is typically the most restrictive for explicit methods. The update for an interior node is:\n$$ a_i^{n+1} = a_i^n + \\frac{D \\Delta t}{(\\Delta x)^2} (a_{i+1}^n - 2a_i^n + a_{i-1}^n) $$\nLet $\\mu = \\frac{D \\Delta t}{(\\Delta x)^2}$. The equation becomes:\n$$ a_i^{n+1} = \\mu a_{i-1}^n + (1 - 2\\mu) a_i^n + \\mu a_{i+1}^n $$\nA simple sufficient condition for stability is that all coefficients on the right-hand side are non-negative. This prevents the growth of oscillations. The coefficients $\\mu$ are positive. The coefficient $(1-2\\mu)$ must also be non-negative:\n$$ 1 - 2\\mu \\ge 0 \\implies \\mu \\le \\frac{1}{2} $$\nFor the boundary nodes, e.g., $i=0$, the update is $a_0^{n+1} = (1-\\mu)a_0^n + \\mu a_1^n$. The non-negativity condition requires $1-\\mu \\ge 0 \\implies \\mu \\le 1$.\nThe more restrictive condition from the interior nodes dictates the overall stability of the method. Therefore, the sufficient condition for stability of the diffusion component is:\n$$ \\mu = \\frac{D \\Delta t}{(\\Delta x)^2} \\le \\frac{1}{2} \\implies \\Delta t \\le \\frac{(\\Delta x)^2}{2D} $$\nThis is the well-known Courant-Friedrichs-Lewy (CFL) condition for the $1$D heat equation. For each test case, we will compute the boolean flag `is_stable` by checking if the given $\\Delta t$ satisfies this inequality.\n\n#### 4. Implementation Details and Final Calculation\n\nThe numerical simulation proceeds as follows:\n1.  Initialize grid arrays for $a, b, p$ at $t=0$ using the specified initial conditions. The spatial grid $x$ will have centers at $x_i=(i+0.5)\\Delta x$.\n2.  Calculate the number of time steps, $N_t = \\text{round}(T/\\Delta t)$.\n3.  Iterate from $n=0$ to $N_t-1$. In each step:\n    a. Calculate the diffusive part of the update for the acid concentration vector $a^n$. This can be done efficiently using vectorized array operations.\n    b. Calculate the reactive parts of the update for $a^n, b^n, p^n$.\n    c. Compute the new concentrations $a^{n+1}, b^{n+1}, p^{n+1}$ using the explicit Euler updates.\n    d. Enforce physical constraints by clamping the values: $a_i^{n+1} = \\max(0, a_i^{n+1})$, $b_i^{n+1} = \\max(0, b_i^{n+1})$, and $p_i^{n+1} = \\max(0, \\min(1, p_i^{n+1}))$.\n4.  After the final time step, the protected polymer fraction is $p(T)$. The deprotected fraction is $1 - p(T)$.\n5.  The spatial average of the deprotected fraction is calculated by approximating the integral $\\frac{1}{L}\\int_0^L (1-p(x,T))\\,dx$. For a uniform grid, this is equivalent to the mean of the discrete values:\n    $$ 1 - \\frac{1}{L} \\sum_{i=0}^{N_x-1} p_i(T) \\Delta x = 1 - \\frac{1}{N_x \\Delta x} \\sum_{i=0}^{N_x-1} p_i(T) \\Delta x = 1 - \\frac{1}{N_x} \\sum_{i=0}^{N_x-1} p_i(T) = 1 - \\text{mean}(p(T)) $$\n\nThis completes the theoretical framework for solving the problem. The final step is to implement this logic and execute it for the given test cases to produce the final numerical answer.",
            "answer": "[[0.28586,True],[0.16568,True],[0.40748,False],[0.54018,True]]"
        }
    ]
}