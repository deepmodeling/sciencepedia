{
    "hands_on_practices": [
        {
            "introduction": "The complex interplay of diffusion and multiple chemical reactions during Post-Exposure Bake (PEB) can be understood by first identifying the core physical processes. This exercise guides you through the powerful technique of nondimensionalization, a fundamental step in analyzing any transport phenomena problem. By recasting the governing partial differential equations into a dimensionless form , you will uncover the key parameter groups, such as Damköhler numbers, that dictate whether the process is limited by diffusion or reaction kinetics.",
            "id": "4155186",
            "problem": "In a Post-Exposure Bake (PEB) step of chemically amplified photoresist processing, the acid generated during exposure diffuses and reacts with both a base quencher and acid-labile protecting groups. Consider a one-dimensional resist film occupying $0 \\le x \\le L$, in which the acid concentration is $a(x,t)$, the base concentration is $b(x,t)$, and the unreacted protecting group fraction (or concentration, scaled to a reference) is $p(x,t)$. Assume the following physically motivated ingredients:\n- Diffusion of acid follows Fick’s second law with diffusivity $D_a$, while the base and protecting group do not diffuse on the PEB timescale.\n- Acid-base neutralization follows the law of mass action with rate constant $k_n$ through the reaction $A + B \\to$ inert.\n- Acid-catalyzed deprotection follows the law of mass action with rate constant $k_p$ through the catalytic reaction $A + P \\to$ deprotected product $+$ $A$, so that acid is not consumed in deprotection.\n\nUnder these assumptions, the governing equations are\n$$\n\\frac{\\partial a}{\\partial t} \\;=\\; D_a\\,\\frac{\\partial^2 a}{\\partial x^2} \\;-\\; k_n\\,a\\,b,\n$$\n$$\n\\frac{\\partial b}{\\partial t} \\;=\\; -\\,k_n\\,a\\,b,\n$$\n$$\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\,k_p\\,a\\,p,\n$$\nwith no-flux boundary conditions on acid at $x=0$ and $x=L$, and given initial conditions $a(x,0)=a_0(x)$, $b(x,0)=b_0$, and $p(x,0)=p_0$, where $a_0(x)$ is a prescribed post-exposure profile and $b_0$ and $p_0$ are uniform.\n\nUsing the characteristic length $L$, the characteristic time $t_c$, and the characteristic concentration scales $a_c$, $b_c$, and $p_c$, introduce the dimensionless variables $\\xi = x/L$, $\\tau = t/t_c$, $\\tilde{a} = a/a_c$, $\\tilde{b} = b/b_c$, and $\\tilde{p} = p/p_c$. Starting only from Fick’s law and the law of mass action, nondimensionalize the system to obtain the parameter-free form that exposes the dimensionless groups controlling the interplay of diffusion, neutralization, and deprotection.\n\nIdentify a minimal set of independent dimensionless groups governing the dynamics, clearly stating their definitions in terms of the dimensional parameters. Provide the final answer as the ordered row matrix of these independent groups in the order: the diffusion-to-time scaling group, the acid-base neutralization Damköhler number, the deprotection Damköhler number, and the base-to-acid concentration scale ratio. Do not include any units in the final answer. If you choose alternative but equivalent group definitions, you must reduce them to an equivalent minimal set with the same physical content and the same order before reporting the final answer.",
            "solution": "The problem requires the nondimensionalization of a system of coupled partial differential equations describing the post-exposure bake (PEB) process in a chemically amplified photoresist. The goal is to identify a minimal set of independent dimensionless groups that govern the system's dynamics.\n\nThe dimensional governing equations are provided as:\n$$\n\\frac{\\partial a}{\\partial t} \\;=\\; D_a\\,\\frac{\\partial^2 a}{\\partial x^2} \\;-\\; k_n\\,a\\,b \\quad (1)\n$$\n$$\n\\frac{\\partial b}{\\partial t} \\;=\\; -\\,k_n\\,a\\,b \\quad (2)\n$$\n$$\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\,k_p\\,a\\,p \\quad (3)\n$$\nwhere $a(x,t)$ is the acid concentration, $b(x,t)$ is the base concentration, and $p(x,t)$ is the protecting group concentration. The parameters $D_a$, $k_n$, and $k_p$ represent the acid diffusivity, the neutralization rate constant, and the deprotection rate constant, respectively. The system is defined on a domain $x \\in [0, L]$.\n\nWe introduce the specified dimensionless variables and characteristic scales:\n- Dimensionless position: $\\xi = x/L$\n- Dimensionless time: $\\tau = t/t_c$\n- Dimensionless acid concentration: $\\tilde{a} = a/a_c$\n- Dimensionless base concentration: $\\tilde{b} = b/b_c$\n- Dimensionless protecting group concentration: $\\tilde{p} = p/p_c$\n\nHere, $L$ is the given characteristic length scale, while $t_c$, $a_c$, $b_c$, and $p_c$ are the characteristic scales for time and concentrations, which we will use to form the dimensionless groups.\n\nFirst, we express the dimensional variables and their derivatives in terms of their dimensionless counterparts using the chain rule:\n- Variables: $x = L\\xi$, $t = t_c\\tau$, $a = a_c\\tilde{a}$, $b = b_c\\tilde{b}$, $p = p_c\\tilde{p}$.\n- Time derivatives:\n$$\n\\frac{\\partial a}{\\partial t} = \\frac{\\partial(a_c \\tilde{a})}{\\partial \\tau} \\frac{d\\tau}{dt} = \\frac{a_c}{t_c} \\frac{\\partial \\tilde{a}}{\\partial \\tau}\n$$\n$$\n\\frac{\\partial b}{\\partial t} = \\frac{b_c}{t_c} \\frac{\\partial \\tilde{b}}{\\partial \\tau}\n$$\n$$\n\\frac{\\partial p}{\\partial t} = \\frac{p_c}{t_c} \\frac{\\partial \\tilde{p}}{\\partial \\tau}\n$$\n- Spatial derivatives:\n$$\n\\frac{\\partial a}{\\partial x} = \\frac{\\partial(a_c \\tilde{a})}{\\partial \\xi} \\frac{d\\xi}{dx} = \\frac{a_c}{L} \\frac{\\partial \\tilde{a}}{\\partial \\xi}\n$$\n$$\n\\frac{\\partial^2 a}{\\partial x^2} = \\frac{\\partial}{\\partial x}\\left(\\frac{a_c}{L} \\frac{\\partial \\tilde{a}}{\\partial \\xi}\\right) = \\frac{\\partial}{\\partial \\xi}\\left(\\frac{a_c}{L} \\frac{\\partial \\tilde{a}}{\\partial \\xi}\\right) \\frac{d\\xi}{dx} = \\frac{a_c}{L^2} \\frac{\\partial^2 \\tilde{a}}{\\partial \\xi^2}\n$$\n\nNext, we substitute these expressions into the three governing equations.\n\nFor the acid transport equation (1):\n$$\n\\frac{a_c}{t_c} \\frac{\\partial \\tilde{a}}{\\partial \\tau} = D_a \\frac{a_c}{L^2} \\frac{\\partial^2 \\tilde{a}}{\\partial \\xi^2} - k_n (a_c \\tilde{a})(b_c \\tilde{b})\n$$\nTo make the equation dimensionless, we multiply the entire equation by $\\frac{t_c}{a_c}$:\n$$\n\\frac{\\partial \\tilde{a}}{\\partial \\tau} = \\left(\\frac{D_a t_c}{L^2}\\right) \\frac{\\partial^2 \\tilde{a}}{\\partial \\xi^2} - (k_n b_c t_c) \\tilde{a} \\tilde{b}\n$$\n\nFor the base reaction equation (2):\n$$\n\\frac{b_c}{t_c} \\frac{\\partial \\tilde{b}}{\\partial \\tau} = - k_n (a_c \\tilde{a})(b_c \\tilde{b})\n$$\nMultiply by $\\frac{t_c}{b_c}$:\n$$\n\\frac{\\partial \\tilde{b}}{\\partial \\tau} = - (k_n a_c t_c) \\tilde{a} \\tilde{b}\n$$\n\nFor the protecting group reaction equation (3):\n$$\n\\frac{p_c}{t_c} \\frac{\\partial \\tilde{p}}{\\partial \\tau} = - k_p (a_c \\tilde{a})(p_c \\tilde{p})\n$$\nMultiply by $\\frac{t_c}{p_c}$:\n$$\n\\frac{\\partial \\tilde{p}}{\\partial \\tau} = - (k_p a_c t_c) \\tilde{a} \\tilde{p}\n$$\n\nThe resulting system of dimensionless partial differential equations is:\n$$\n\\frac{\\partial \\tilde{a}}{\\partial \\tau} = \\left(\\frac{D_a t_c}{L^2}\\right) \\frac{\\partial^2 \\tilde{a}}{\\partial \\xi^2} - (k_n b_c t_c) \\tilde{a} \\tilde{b}\n$$\n$$\n\\frac{\\partial \\tilde{b}}{\\partial \\tau} = - (k_n a_c t_c) \\tilde{a} \\tilde{b}\n$$\n$$\n\\frac{\\partial \\tilde{p}}{\\partial \\tau} = - (k_p a_c t_c) \\tilde{a} \\tilde{p}\n$$\n\nThe behavior of the solution to this system is controlled by the dimensionless coefficients appearing in the equations. These are the dimensionless groups we seek. Let's identify them:\n- From the diffusion term in the acid equation: $\\Pi_A = \\frac{D_a t_c}{L^2}$\n- From the neutralization term in the acid equation: $\\Pi_B = k_n b_c t_c$\n- From the neutralization term in the base equation: $\\Pi_C = k_n a_c t_c$\n- From the deprotection term in the protecting group equation: $\\Pi_D = k_p a_c t_c$\n\nThe set of groups $\\{\\Pi_A, \\Pi_B, \\Pi_C, \\Pi_D\\}$ is not a minimal independent set, because $\\Pi_B$ and $\\Pi_C$ are related through the concentration scales:\n$$\n\\Pi_B = k_n b_c t_c = (k_n a_c t_c) \\left(\\frac{b_c}{a_c}\\right) = \\Pi_C \\left(\\frac{b_c}{a_c}\\right)\n$$\nTherefore, we can express the system using a minimal independent set of groups. We can choose the set to be $\\{\\Pi_A, \\Pi_C, \\Pi_D, b_c/a_c\\}$, as this allows the system to be written as:\n$$\n\\frac{\\partial \\tilde{a}}{\\partial \\tau} = \\Pi_A \\frac{\\partial^2 \\tilde{a}}{\\partial \\xi^2} - \\Pi_C \\left(\\frac{b_c}{a_c}\\right) \\tilde{a} \\tilde{b}\n$$\n$$\n\\frac{\\partial \\tilde{b}}{\\partial \\tau} = - \\Pi_C \\tilde{a} \\tilde{b}\n$$\n$$\n\\frac{\\partial \\tilde{p}}{\\partial \\tau} = - \\Pi_D \\tilde{a} \\tilde{p}\n$$\nThis set is minimal and independent, and it governs the dynamics of the system. Now, we map these groups to the names specified in the problem statement.\n\n1.  **Diffusion-to-time scaling group:** This group compares the chosen time scale $t_c$ to the characteristic diffusion time $L^2/D_a$. This is precisely $\\Pi_A$.\n    $$\n    \\text{Group 1} = \\frac{D_a t_c}{L^2}\n    $$\n2.  **Acid-base neutralization Damköhler number:** A Damköhler number is a ratio of a transport time scale to a reaction time scale. Here, the number is defined with respect to the general time scale $t_c$. The characteristic time for neutralization can be defined as $1/(k_n a_c)$. Thus, the Damköhler number is the ratio $t_c / (1/(k_n a_c))$. This corresponds to $\\Pi_C$. We choose $\\Pi_C$ over $\\Pi_B$ for consistency with the deprotection Damköhler number, which is also based on $a_c$.\n    $$\n    \\text{Group 2} = k_n a_c t_c\n    $$\n3.  **Deprotection Damköhler number:** Similarly, the characteristic time for deprotection is $1/(k_p a_c)$, and the corresponding Damköhler number is the ratio $t_c / (1/(k_p a_c))$. This corresponds to $\\Pi_D$.\n    $$\n    \\text{Group 3} = k_p a_c t_c\n    $$\n4.  **Base-to-acid concentration scale ratio:** This is the ratio of the characteristic base concentration to the characteristic acid concentration.\n    $$\n    \\text{Group 4} = \\frac{b_c}{a_c}\n    $$\n\nThis set of four groups, $\\{\\frac{D_a t_c}{L^2}, k_n a_c t_c, k_p a_c t_c, \\frac{b_c}{a_c}\\}$, constitutes a minimal, independent set that fully characterizes the dimensionless problem and matches the required descriptions.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{D_a t_c}{L^2} & k_n a_c t_c & k_p a_c t_c & \\frac{b_c}{a_c} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Understanding which process parameters most strongly influence lithographic outcomes is critical for process control. This practice challenges you to apply your analytical skills to a simplified but insightful model of PEB, deriving expressions for critical metrics like image blur and deprotection conversion. By performing a logarithmic sensitivity analysis , you will quantitatively determine how variations in acid diffusivity ($D$) and reaction rate ($k_a$) independently impact the final resist profile, providing clear insight into the levers for process optimization.",
            "id": "4155241",
            "problem": "Consider a one-dimensional model of a chemically amplified photoresist during Post-Exposure Bake (PEB). The acid concentration $H(x,t)$ evolves by diffusion in a homogeneous polymer matrix of constant diffusivity $D$ and catalyzes the deprotection of the protected polymer fraction $P(x,t)$ with a rate constant $k_a$ according to mass-action kinetics. As a fundamental base, assume Fick’s second law for diffusion and mass-action for reaction, written as $\\partial H/\\partial t = D\\,\\partial^2 H/\\partial x^2$ and $\\partial P/\\partial t = -k_a\\,H\\,P$. Assume the small-conversion limit over the bake time $T$ so that $P(x,t)\\approx 1$ in the reaction term and there is negligible acid loss, which linearizes the polymer kinetics to $\\partial P/\\partial t \\approx -k_a\\,H$ without any sink in $H$.\n\nThe exposure pattern is a semi-infinite line feature located at $x=0$ with a step-like initial acid distribution $H(x,0)=H_0$ for $x>0$ and $H(x,0)=0$ for $x<0$, and the spatial domain is the real line $-\\infty<x<\\infty$ with vanishing gradients at infinity. Define the following two image quality metrics at the end of PEB at time $T$:\n1. The latent-image blur $b$ as the $10$–$90$ width of the acid concentration profile $H(x,T)$, i.e., the distance between the points where $H(x,T)/H_0=0.1$ and $H(x,T)/H_0=0.9$.\n2. The final deprotection conversion at the nominal line edge, $c$, defined by $c = 1-P(0,T)$.\n\nUsing only the stated fundamental laws and definitions, perform a scaling sensitivity analysis to determine the logarithmic sensitivities of $b$ and $c$ with respect to $D$ and $k_a$, namely $S_D^{(b)}=\\partial\\ln b/\\partial\\ln D$, $S_{k_a}^{(b)}=\\partial\\ln b/\\partial\\ln k_a$, $S_D^{(c)}=\\partial\\ln c/\\partial\\ln D$, and $S_{k_a}^{(c)}=\\partial\\ln c/\\partial\\ln k_a$. Express your final answer as a single $1\\times 4$ row matrix in the order $\\big(S_D^{(b)},\\,S_{k_a}^{(b)},\\,S_D^{(c)},\\,S_{k_a}^{(c)}\\big)$. No rounding is required, and you should give exact values. No units are required in the final answer.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and self-contained. The physical model, though simplified, is standard for analyzing post-exposure bake (PEB) processes in photolithography. I will proceed with the solution.\n\nThe problem requires a two-part analysis: first, determining the acid concentration profile $H(x,T)$ and the polymer deprotection $P(x,T)$, and second, calculating the logarithmic sensitivities of the derived metrics.\n\n**Part 1: Acid Concentration Profile**\n\nThe evolution of the acid concentration $H(x,t)$ is governed by the one-dimensional diffusion equation:\n$$ \\frac{\\partial H}{\\partial t} = D \\frac{\\partial^2 H}{\\partial x^2} $$\nThe initial condition is a step function at $t=0$:\n$$ H(x,0) = \\begin{cases} H_0 & \\text{for } x > 0 \\\\ 0 & \\text{for } x < 0 \\end{cases} $$\nThe domain is $-\\infty < x < \\infty$. The solution to this standard transport problem is given in terms of the error function, $\\mathrm{erf}(z)$:\n$$ H(x,t) = \\frac{H_0}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x}{\\sqrt{4Dt}}\\right) \\right] $$\nwhere $\\mathrm{erf}(z) = \\frac{2}{\\sqrt{\\pi}} \\int_0^z \\exp(-u^2) \\,du$. At the end of the bake time $T$, the acid concentration profile is:\n$$ H(x,T) = \\frac{H_0}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x}{\\sqrt{4DT}}\\right) \\right] $$\n\n**Part 2: Latent-Image Blur $b$ and its Sensitivities**\n\nThe latent-image blur $b$ is defined as the distance between the points $x_1$ and $x_2$ where the normalized acid concentration is $0.1$ and $0.9$, respectively.\nFor the point $x_1$:\n$$ \\frac{H(x_1,T)}{H_0} = 0.1 $$\n$$ \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x_1}{\\sqrt{4DT}}\\right) \\right] = 0.1 $$\n$$ 1 + \\mathrm{erf}\\left(\\frac{x_1}{\\sqrt{4DT}}\\right) = 0.2 $$\n$$ \\mathrm{erf}\\left(\\frac{x_1}{\\sqrt{4DT}}\\right) = -0.8 $$\nUsing the property that the inverse error function $\\mathrm{erf}^{-1}(z)$ is odd, we find:\n$$ \\frac{x_1}{\\sqrt{4DT}} = \\mathrm{erf}^{-1}(-0.8) = -\\mathrm{erf}^{-1}(0.8) $$\n$$ x_1 = -\\sqrt{4DT} \\cdot \\mathrm{erf}^{-1}(0.8) $$\n\nFor the point $x_2$:\n$$ \\frac{H(x_2,T)}{H_0} = 0.9 $$\n$$ \\frac{1}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{x_2}{\\sqrt{4DT}}\\right) \\right] = 0.9 $$\n$$ \\mathrm{erf}\\left(\\frac{x_2}{\\sqrt{4DT}}\\right) = 0.8 $$\n$$ \\frac{x_2}{\\sqrt{4DT}} = \\mathrm{erf}^{-1}(0.8) $$\n$$ x_2 = \\sqrt{4DT} \\cdot \\mathrm{erf}^{-1}(0.8) $$\n\nThe blur $b$ is the distance $b = x_2 - x_1$:\n$$ b = \\left(\\sqrt{4DT} \\cdot \\mathrm{erf}^{-1}(0.8)\\right) - \\left(-\\sqrt{4DT} \\cdot \\mathrm{erf}^{-1}(0.8)\\right) $$\n$$ b = 2 \\sqrt{4DT} \\cdot \\mathrm{erf}^{-1}(0.8) = 4\\sqrt{DT} \\cdot \\mathrm{erf}^{-1}(0.8) $$\nLet $K_b = 4\\sqrt{T} \\cdot \\mathrm{erf}^{-1}(0.8)$ be a constant with respect to $D$ and $k_a$. Then the expression for blur simplifies to $b = K_b D^{1/2}$.\n\nNow we calculate the logarithmic sensitivities of $b$. The logarithmic sensitivity of a function $y$ with respect to a variable $z$ is $S_z^{(y)} = \\frac{\\partial \\ln y}{\\partial \\ln z}$. For a power-law relationship $y = K z^n$, this simplifies to $n$.\n\nThe sensitivity of $b$ with respect to $D$ is:\n$$ S_D^{(b)} = \\frac{\\partial\\ln b}{\\partial\\ln D} $$\nSince $b \\propto D^{1/2}$, the sensitivity is:\n$$ S_D^{(b)} = \\frac{1}{2} $$\n\nThe sensitivity of $b$ with respect to $k_a$ is:\n$$ S_{k_a}^{(b)} = \\frac{\\partial\\ln b}{\\partial\\ln k_a} $$\nThe expression for $b$ does not contain $k_a$. This is equivalent to $b \\propto k_a^0$. Therefore:\n$$ S_{k_a}^{(b)} = 0 $$\n\n**Part 3: Deprotection Conversion $c$ and its Sensitivities**\n\nThe rate of polymer deprotection is given by the linearized kinetic equation:\n$$ \\frac{\\partial P}{\\partial t} \\approx -k_a H(x,t) $$\nThe initial condition for the protected polymer fraction is $P(x,0) = 1$. To find the fraction at time $T$, we integrate with respect to time:\n$$ P(x,T) - P(x,0) = \\int_0^T -k_a H(x,t) \\, dt $$\n$$ P(x,T) = 1 - k_a \\int_0^T H(x,t) \\, dt $$\nThe conversion $c$ is defined at the nominal line edge, $x=0$. We first evaluate $H(0,t)$:\n$$ H(0,t) = \\frac{H_0}{2} \\left[ 1 + \\mathrm{erf}\\left(\\frac{0}{\\sqrt{4Dt}}\\right) \\right] = \\frac{H_0}{2} \\left[ 1 + 0 \\right] = \\frac{H_0}{2} $$\nThe acid concentration at $x=0$ is constant for all $t > 0$. We can now calculate $P(0,T)$:\n$$ P(0,T) = 1 - k_a \\int_0^T \\frac{H_0}{2} \\, dt = 1 - k_a \\frac{H_0}{2} T $$\nThe conversion $c$ is defined as $c = 1 - P(0,T)$:\n$$ c = 1 - \\left(1 - \\frac{k_a H_0 T}{2}\\right) = \\frac{k_a H_0 T}{2} $$\nLet $K_c = \\frac{H_0 T}{2}$ be a constant with respect to $D$ and $k_a$. Then $c = K_c k_a^1$.\n\nNow we calculate the logarithmic sensitivities of $c$.\nThe sensitivity of $c$ with respect to $D$ is:\n$$ S_D^{(c)} = \\frac{\\partial\\ln c}{\\partial\\ln D} $$\nThe expression for $c$ does not contain $D$. This is equivalent to $c \\propto D^0$. Therefore:\n$$ S_D^{(c)} = 0 $$\n\nThe sensitivity of $c$ with respect to $k_a$ is:\n$$ S_{k_a}^{(c)} = \\frac{\\partial\\ln c}{\\partial\\ln k_a} $$\nSince $c \\propto k_a^1$, the sensitivity is:\n$$ S_{k_a}^{(c)} = 1 $$\n\n**Part 4: Final Result**\n\nThe calculated sensitivities are:\n$S_D^{(b)} = \\frac{1}{2}$\n$S_{k_a}^{(b)} = 0$\n$S_D^{(c)} = 0$\n$S_{k_a}^{(c)} = 1$\n\nThe final answer is required as a $1 \\times 4$ row matrix $\\big(S_D^{(b)}, S_{k_a}^{(b)}, S_D^{(c)}, S_{k_a}^{(c)}\\big)$.\nThis is $\\left(\\frac{1}{2}, 0, 0, 1\\right)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2} & 0 & 0 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Bridging the gap between first-principles models and experimental reality often requires solving inverse problems. This advanced computational exercise introduces the concept of an effective PEB blur kernel, a cornerstone of lithography simulation, which encapsulates the combined effects of diffusion and reaction. You will implement a method to both predict this kernel from the governing equations and extract it from simulated \"measured\" data using Fourier-domain deconvolution , mastering a key technique for model calibration and verification.",
            "id": "4155237",
            "problem": "You are asked to design and implement a complete, runnable program that back-calculates an effective Post-Exposure Bake (PEB) blur kernel from measured post-PEB latent images and compares it to predictions from first-principles reaction-diffusion modeling in a chemically amplified resist. The latent image is defined as the accumulated deprotected fraction at the end of the PEB. Your method must start from a fundamental base, use only well-tested formulas and facts, and avoid any shortcut formulas or hints that reveal the target result.\n\nBegin from the following physically grounded base. Let $A(x,t)$ denote the photoacid concentration and $R(x,t)$ denote the accumulated deprotected fraction. Assume one spatial dimension $x$ along the line-space direction, with spatial period $L$ and periodic boundary conditions. The acid diffusion is modeled by Fick's second law and pseudo-first-order acid loss due to quenching with large, approximately constant base concentration, and acid-catalyzed deprotection is modeled as linear in acid at low conversion. Specifically, use:\n$$\n\\frac{\\partial A(x,t)}{\\partial t} = D \\frac{\\partial^2 A(x,t)}{\\partial x^2} - k\\,A(x,t),\n$$\nwith initial condition $A(x,0) = A_0(x)$, and\n$$\n\\frac{\\partial R(x,t)}{\\partial t} = k_r \\, A(x,t), \\quad R(x,0) = 0,\n$$\nso that the latent image after a PEB of duration $T$ is $L(x) = R(x,T)$. Assume $D$ is the acid diffusion coefficient, $k$ is the pseudo-first-order acid loss rate constant, and $k_r$ is the acid-catalyzed deprotection rate constant. All variables and parameters are spatially uniform except $A_0(x)$.\n\nDefine the effective PEB blur kernel $K(x)$ as the linear, space-invariant operator that maps $A_0(x)$ to $L(x)$ via convolution on the periodic domain:\n$$\nL(x) = (K * A_0)(x) = \\int_0^L K(x - \\xi) \\, A_0(\\xi) \\, d\\xi,\n$$\nwith periodic wrapping over $[0,L)$.\n\nYour tasks are:\n- From measured latent images $L(x)$ and known pre-PEB acid distributions $A_0(x)$, back-calculate an effective kernel $\\hat{K}(x)$ by solving the inverse problem. The inversion must be well-posed numerically by using a regularized Fourier-domain deconvolution, with a nonzero regularization parameter $\\alpha$ to avoid division by near-zero spectral components.\n- From first principles, predict $K(x)$ by solving the reaction-diffusion system above and integrating acid concentration over the PEB duration to obtain $L(x)$ as a functional of $A_0(x)$. You may use the periodic boundary conditions to choose a computational method consistent with diagonalization on Fourier modes. Do not assume a Gaussian kernel a priori and do not use any shortcut formulas; derive the prediction from the governing equations and core definitions.\n- Compare the back-calculated kernel $\\hat{K}(x)$ to the first-principles predicted kernel in the spatial domain using the root-mean-square error (RMSE), defined as\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{j=0}^{N-1} \\left(\\hat{K}(x_j) - K(x_j)\\right)^2 }.\n$$\n\nWork in one spatial dimension with periodic boundary conditions. Use a discrete grid with $N$ points, domain length $L$, grid spacing $dx = L/N$, and assume the Discrete Fourier Transform implementation uses the standard conventions of the Fast Fourier Transform (FFT). Construct a physically plausible and self-consistent test suite. For each test case, simulate a measured latent image $L(x)$ from a known $A_0(x)$ using the first-principles model and then apply your inversion method to recover $\\hat{K}(x)$. Report the RMSE between $\\hat{K}(x)$ and the first-principles predicted $K(x)$ for each case.\n\nUse the following test suite:\n- Test case $1$ (“happy path, moderate diffusion”): $L = 1.0 \\times 10^{-6}$ m, $N = 256$, $D = 1.0 \\times 10^{-15}$ m$^2$/s, $k = 0.5$ s$^{-1}$, $k_r = 0.05$ s$^{-1}$, $T = 60.0$ s, regularization $\\alpha = 1.0 \\times 10^{-12}$ (unitless), and initial acid $A_0(x)$ is a $50$-$\\%$ duty cycle line-space pattern equal to $1.0$ for $0 \\le x < L/2$ and $0.0$ for $L/2 \\le x < L$.\n- Test case $2$ (“boundary, zero diffusion”): $L = 1.0 \\times 10^{-6}$ m, $N = 256$, $D = 0.0$ m$^2$/s, $k = 0.5$ s$^{-1}$, $k_r = 0.05$ s$^{-1}$, $T = 60.0$ s, regularization $\\alpha = 1.0 \\times 10^{-12}$ (unitless), and the same $A_0(x)$ as in test case $1$.\n- Test case $3$ (“edge, higher diffusion”): $L = 1.0 \\times 10^{-6}$ m, $N = 256$, $D = 4.0 \\times 10^{-15}$ m$^2$/s, $k = 0.5$ s$^{-1}$, $k_r = 0.05$ s$^{-1}$, $T = 60.0$ s, regularization $\\alpha = 1.0 \\times 10^{-12}$ (unitless), and the same $A_0(x)$ as in test case $1$.\n\nAll outputs must be unitless floats. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3]$), where $r_1$, $r_2$, and $r_3$ are the RMSE values for the three test cases, respectively. No other output should be printed.",
            "solution": "The problem requires the design and implementation of a program to back-calculate an effective Post-Exposure Bake (PEB) blur kernel from simulated latent image data and compare it to a kernel predicted from a first-principles reaction-diffusion model. The validation and comparison are performed in one spatial dimension with periodic boundary conditions, making Fourier analysis the natural and most efficient method of solution.\n\nThe solution proceeds in three main parts:\n1.  Derivation of the first-principles PEB kernel, $K(x)$, in the Fourier domain.\n2.  Formulation of the regularized deconvolution procedure to back-calculate an estimated kernel, $\\hat{K}(x)$.\n3.  Calculation of the Root-Mean-Square Error (RMSE) to compare the two kernels for the specified test cases.\n\n**1. First-Principles Kernel Derivation**\n\nThe process begins with the governing partial differential equations (PDEs) for photoacid concentration $A(x,t)$ and accumulated deprotected fraction $R(x,t)$:\n$$\n\\frac{\\partial A(x,t)}{\\partial t} = D \\frac{\\partial^2 A(x,t)}{\\partial x^2} - k\\,A(x,t)\n$$\n$$\n\\frac{\\partial R(x,t)}{\\partial t} = k_r \\, A(x,t)\n$$\nwith initial conditions $A(x,0) = A_0(x)$ and $R(x,0) = 0$. The domain is periodic with length $L$.\n\nDue to the linear, space-invariant nature of these equations and the periodic boundary conditions, we transform them into the Fourier domain. Let $\\mathcal{F}$ denote the continuous Fourier transform with respect to the spatial variable $x$, where the transform of a function $f(x)$ is $f(k_\\omega) = \\int_{-\\infty}^{\\infty} f(x) e^{-i k_\\omega x} dx$, and $k_\\omega$ is the angular spatial frequency. For a periodic domain of length $L$, the frequencies are discrete: $k_{\\omega,n} = 2\\pi n/L$ for integer $n$. Applying the Fourier transform property $\\mathcal{F}\\{\\frac{\\partial^2 f}{\\partial x^2}\\} = -k_{\\omega,n}^2 \\mathcal{F}\\{f\\}$, the PDE for the acid concentration becomes a set of uncoupled ordinary differential equations (ODEs) for each frequency component $A_n(t) = \\mathcal{F}\\{A(x,t)\\}(k_{\\omega,n})$:\n$$\n\\frac{d A_n(t)}{d t} = -D k_{\\omega,n}^2 A_n(t) - k A_n(t) = -(D k_{\\omega,n}^2 + k) A_n(t)\n$$\nThis is a first-order linear ODE with the initial condition $A_n(0) = \\mathcal{F}\\{A_0(x)\\} = A_{0,n}$. The solution is:\n$$\nA_n(t) = A_{0,n} \\exp\\left( -(D k_{\\omega,n}^2 + k)t \\right)\n$$\nThe final latent image is defined as $L(x) = R(x,T)$, where $T$ is the total PEB time. We find $L(x)$ by integrating the deprotection rate equation:\n$$\nL(x) = R(x,T) = \\int_0^T \\frac{\\partial R(x,t)}{\\partial t} dt = \\int_0^T k_r A(x,t) dt\n$$\nTransforming this to the Fourier domain, we get $L_n = \\mathcal{F}\\{L(x)\\}$:\n$$\nL_n = k_r \\int_0^T A_n(t) dt = k_r \\int_0^T A_{0,n} \\exp\\left( -(D k_{\\omega,n}^2 + k)t \\right) dt\n$$\nPerforming the integration yields:\n$$\nL_n = k_r A_{0,n} \\left[ \\frac{\\exp\\left( -(D k_{\\omega,n}^2 + k)t \\right)}{-(D k_{\\omega,n}^2 + k)} \\right]_0^T = k_r A_{0,n} \\frac{1 - \\exp\\left( -(D k_{\\omega,n}^2 + k)T \\right)}{D k_{\\omega,n}^2 + k}\n$$\nThe problem defines the effective PEB blur kernel $K(x)$ through the convolution $L(x) = (K * A_0)(x)$. In the Fourier domain, this convolution becomes a product: $L_n = K_n A_{0,n}$, where $K_n = \\mathcal{F}\\{K(x)\\}$. By comparing this with the derived expression for $L_n$, we can identify the first-principles kernel in the Fourier domain:\n$$\nK_n = \\frac{k_r}{D k_{\\omega,n}^2 + k} \\left( 1 - \\exp\\left( -(D k_{\\omega,n}^2 + k)T \\right) \\right)\n$$\nThis expression gives the theoretical kernel's frequency response based on the physical parameters of the PEB process.\n\n**2. Back-Calculation of the Kernel via Regularized Deconvolution**\n\nThe second task is to back-calculate an estimate of the kernel, $\\hat{K}(x)$, from a \"measured\" latent image $L(x)$ and a known initial acid distribution $A_0(x)$. For a self-consistent test, we first generate $L(x)$ using the first-principles model derived above.\n\nThe core of the back-calculation is solving the deconvolution problem $L = \\hat{K} * A_0$. In the discrete Fourier domain, using the Discrete Fourier Transform (DFT), this becomes $\\tilde{L}_n = \\tilde{\\hat{K}}_n \\tilde{A}_{0,n}$, where tildes denote the DFT of the corresponding discretely sampled arrays. A naive inversion $\\tilde{\\hat{K}}_n = \\tilde{L}_n / \\tilde{A}_{0,n}$ is numerically unstable because the spectral components $\\tilde{A}_{0,n}$ can be zero or very close to zero, leading to division by zero and noise amplification.\n\nTo ensure the problem is well-posed, we employ Tikhonov regularization (also known as a Wiener filter). The regularized solution for the DFT of the kernel is:\n$$\n\\tilde{\\hat{K}}_n = \\frac{\\tilde{L}_n \\cdot \\tilde{A}_{0,n}^*}{|\\tilde{A}_{0,n}|^2 + \\alpha}\n$$\nwhere $\\tilde{A}_{0,n}^*$ is the complex conjugate of $\\tilde{A}_{0,n}$, and $\\alpha$ is a small, positive regularization parameter. This parameter prevents the denominator from becoming zero and stabilizes the inversion. The problem specifies a unitless $\\alpha$, which is consistent with this formulation if the input arrays are treated as unitless quantities.\n\nThe spatial domain estimate of the kernel, $\\hat{K}(x_j)$, is then obtained by applying the inverse DFT to $\\tilde{\\hat{K}}_n$.\n\n**3. Numerical Implementation and Comparison**\n\nThe implementation uses a discrete grid of $N$ points over the domain length $L$, with grid spacing $dx = L/N$.\n\n- **Frequency Vector**: The angular spatial frequencies $k_{\\omega,n}$ corresponding to the DFT indices are computed using `numpy.fft.fftfreq`. For a grid spacing $dx$, the spatial frequencies are $f_n = n/(N \\cdot dx) = n/L$. The angular frequencies are $k_{\\omega,n} = 2\\pi f_n$.\n\n- **Discrete Kernels**: The relationship between the continuous Fourier transform $K_n$ and the DFT $\\tilde{K}_n$ of a sampled kernel array $K_j = K(x_j)$ can be subtle. However, if we define an effective discrete kernel $K_{eff}$ such that the discrete circular convolution $L_{discrete} = K_{eff} \\circledast A_{0,discrete}$ holds, its DFT $\\tilde{K}_{eff,n}$ should match our derived $K_n$. Thus, we can directly let $\\tilde{K}_{theory,n} = K_n$. The theoretical kernel in the spatial domain is then $K_{theory}(x_j) = \\text{IDFT}\\{K_n\\}_j$.\n\nThe procedure for each test case is as follows:\n1.  Define the grid, parameters, and the initial acid array $A_{0,arr}$.\n2.  Compute the DFT of the initial acid: $\\tilde{A}_{0,n} = \\text{DFT}\\{A_{0,arr}\\}$.\n3.  Compute the theoretical kernel's DFT, $K_n$, using the derived formula for each frequency.\n4.  The theoretical spatial kernel array is $K_{th,arr} = \\text{IDFT}\\{K_n\\}$.\n5.  Simulate the \"measured\" latent image in the Fourier domain: $\\tilde{L}_n = K_n \\cdot \\tilde{A}_{0,n}$.\n6.  Perform the regularized deconvolution to find the back-calculated kernel's DFT: $\\tilde{\\hat{K}}_n = (\\tilde{L}_n \\cdot \\tilde{A}_{0,n}^*) / (|\\tilde{A}_{0,n}|^2 + \\alpha)$.\n7.  The back-calculated spatial kernel array is $\\hat{K}_{arr} = \\text{IDFT}\\{\\tilde{\\hat{K}}_n\\}$.\n8.  Calculate the RMSE between the real parts of the two spatial kernels:\n    $$\n    \\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{j=0}^{N-1} \\left(\\Re(\\hat{K}_{arr,j}) - \\Re(K_{th,arr,j})\\right)^2}\n    $$\nThis procedure directly compares the kernel derived from first principles with the one obtained through numerical inversion, providing a quantitative measure of the inversion's accuracy under the given conditions.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the RMSE between a first-principles PEB kernel and a back-calculated one.\n    \"\"\"\n    test_cases = [\n        # Test case 1: \"happy path, moderate diffusion\"\n        {\n            \"L\": 1.0e-6, \"N\": 256, \"D\": 1.0e-15, \"k\": 0.5, \"k_r\": 0.05, \n            \"T\": 60.0, \"alpha\": 1.0e-12\n        },\n        # Test case 2: \"boundary, zero diffusion\"\n        {\n            \"L\": 1.0e-6, \"N\": 256, \"D\": 0.0, \"k\": 0.5, \"k_r\": 0.05, \n            \"T\": 60.0, \"alpha\": 1.0e-12\n        },\n        # Test case 3: \"edge, higher diffusion\"\n        {\n            \"L\": 1.0e-6, \"N\": 256, \"D\": 4.0e-15, \"k\": 0.5, \"k_r\": 0.05, \n            \"T\": 60.0, \"alpha\": 1.0e-12\n        },\n    ]\n\n    results = []\n\n    for params in test_cases:\n        L = params[\"L\"]\n        N = params[\"N\"]\n        D = params[\"D\"]\n        k = params[\"k\"]\n        k_r = params[\"k_r\"]\n        T = params[\"T\"]\n        alpha = params[\"alpha\"]\n\n        # 1. Setup grid and initial condition A0(x)\n        # Grid spacing. The domain is [0, L).\n        dx = L / N\n        # Spatial frequencies (not angular). d=dx sets the sample spacing.\n        spatial_freqs = np.fft.fftfreq(N, d=dx)\n        # Angular spatial frequencies\n        k_omega_n = 2 * np.pi * spatial_freqs\n\n        # Initial acid concentration A0(x)\n        # 50% duty cycle line-space pattern\n        A0_arr = np.zeros(N)\n        A0_arr[:N // 2] = 1.0\n\n        # 2. Derive the first-principles kernel K(x)\n        # We work in the Fourier domain. Kn is the continuous Fourier transform of K(x).\n        denominator = D * k_omega_n**2 + k\n        \n        # Handle the case where denominator is zero (only if D=0 and k=0).\n        # In this problem, k > 0, so the denominator is always positive.\n        Kn = (k_r / denominator) * (1.0 - np.exp(-denominator * T))\n\n        # The discrete effective kernel's DFT is simply Kn.\n        # Its spatial representation is the IFFT of Kn.\n        K_theory_arr = np.fft.ifft(Kn)\n\n        # 3. Back-calculate the kernel K_hat(x)\n        \n        # 3a. Simulate \"measured\" latent image L(x)\n        # L_n = K_n * A0_n\n        A0_fft = np.fft.fft(A0_arr)\n        L_fft = Kn * A0_fft\n        # L_arr = np.fft.ifft(L_fft) # Not strictly needed, we operate in Fourier domain\n\n        # 3b. Perform regularized deconvolution to find K_hat\n        # K_hat_n = (L_n * A0_n*) / (|A0_n|^2 + alpha)\n        A0_fft_conj = np.conj(A0_fft)\n        A0_fft_mag_sq = np.abs(A0_fft)**2\n        \n        K_hat_fft = (L_fft * A0_fft_conj) / (A0_fft_mag_sq + alpha)\n        \n        # The back-calculated spatial kernel is the IFFT of its Fourier transform.\n        K_hat_arr = np.fft.ifft(K_hat_fft)\n\n        # 4. Compare K(x) and K_hat(x) using RMSE\n        # The physical kernels must be real-valued. We take the real part to discard\n        # numerical noise in the imaginary part.\n        diff_sq = (np.real(K_hat_arr) - np.real(K_theory_arr))**2\n        rmse = np.sqrt(np.mean(diff_sq))\n        results.append(rmse)\n\n    # Format output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}