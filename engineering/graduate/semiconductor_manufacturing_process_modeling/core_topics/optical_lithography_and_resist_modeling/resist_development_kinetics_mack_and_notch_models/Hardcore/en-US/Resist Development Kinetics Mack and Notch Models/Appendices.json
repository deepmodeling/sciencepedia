{
    "hands_on_practices": [
        {
            "introduction": "To accurately model the development process, we must first determine the chemical state of the resist after the post-exposure bake (PEB). This \"latent image\" is defined by the spatial distribution of the protected polymer. This exercise  guides you through a fundamental derivation, starting from first-principle rate laws to find the final protected fraction. You will see how the catalytic deprotection mechanism of the Mack model interacts with the simultaneous neutralization of acid by a quencher, a crucial process for controlling acid diffusion and reaction extent.",
            "id": "4161137",
            "problem": "A chemically amplified photoresist is subjected to a Post-Exposure Bake (PEB) in a film of thickness coordinate $z$ with $0 \\le z \\le L$. Let $[H^{+}](z,t)$ denote the local proton (acid) concentration and $P(z,t)$ denote the local protected polymer fraction. Assume negligible acid diffusion during PEB so that $[H^{+}](z,t)$ evolves independently at each $z$. The quencher concentration $Q$ is uniform and constant over time during PEB. The acid is neutralized by quencher according to a first-order mass-action rate law $d[H^{+}]/dt = -k_{q} Q [H^{+}]$, where $k_{q}$ is the neutralization rate constant. The deprotection follows the Mack model, in which the protected fraction obeys $dP/dt = -k_{D} [H^{+}] P$, where $k_{D}$ is the deprotection rate constant and the acid acts catalytically (acid consumption by deprotection is neglected). The initial conditions at the start of PEB ($t = 0$) are $[H^{+}](z,0) = H_{0}(z)$ and $P(z,0) = P_{0}(z)$, with $0 \\le P_{0}(z) \\le 1$. \n\nStarting from these mass-action rate laws and the stated assumptions, derive a closed-form analytic expression for the protected fraction $P(z,t_{f})$ after a bake time $t_{f}$. Express your final answer in terms of $H_{0}(z)$, $P_{0}(z)$, $k_{q}$, $Q$, $k_{D}$, and $t_{f}$. The answer should be a single analytic expression. No numerical evaluation or rounding is required. The protected fraction $P$ is dimensionless, so no units are required in the final expression. You may assume $k_{q}  0$, $k_{D}  0$, $Q  0$, and $t_{f} \\ge 0$. Clearly state any intermediate steps used to obtain the final expression, but do not invoke any empirical shortcut formulas beyond the given mass-action kinetics and the negligible diffusion assumption.",
            "solution": "The problem asks for the protected fraction $P(z,t_{f})$ after a bake time $t_{f}$ under negligible acid diffusion, uniform quencher concentration $Q$, and mass-action kinetics for both acid neutralization and deprotection (Mack model). The fundamental base consists of the following well-tested kinetic laws:\n\n- Acid neutralization by quencher: \n$$\\frac{d[H^{+}](z,t)}{dt} = -k_{q} Q [H^{+}](z,t),$$\nwith $k_{q}  0$ and $Q  0$.\n- Mack deprotection kinetics:\n$$\\frac{dP(z,t)}{dt} = -k_{D} [H^{+}](z,t) P(z,t),$$\nwith $k_{D}  0$.\n\nAdditionally, we have initial conditions at $t = 0$:\n$$[H^{+}](z,0) = H_{0}(z), \\quad P(z,0) = P_{0}(z).$$\n\nBecause acid diffusion is negligible, the evolution at each position $z$ is independent, and we can treat $z$ as a parameter. We first solve for the acid concentration $[H^{+}](z,t)$ using the first-order linear ordinary differential equation:\n$$\\frac{d[H^{+}](z,t)}{dt} = -k_{q} Q [H^{+}](z,t).$$\nThis equation has the standard exponential decay solution. Separating variables and integrating,\n$$\\frac{d[H^{+}](z,t)}{[H^{+}](z,t)} = -k_{q} Q \\, dt,$$\nintegrate from $t = 0$ to $t$, and from $[H^{+}](z,0) = H_{0}(z)$ to $[H^{+}](z,t)$:\n$$\\int_{H_{0}(z)}^{[H^{+}](z,t)} \\frac{d\\xi}{\\xi} = -k_{q} Q \\int_{0}^{t} dt',$$\nwhich yields\n$$\\ln\\!\\left(\\frac{[H^{+}](z,t)}{H_{0}(z)}\\right) = -k_{q} Q t.$$\nExponentiating both sides gives\n$$[H^{+}](z,t) = H_{0}(z) \\exp(-k_{q} Q t).$$\n\nNext, we use this time-dependent acid concentration in the Mack deprotection rate law:\n$$\\frac{dP(z,t)}{dt} = -k_{D} [H^{+}](z,t) P(z,t) = -k_{D} H_{0}(z) \\exp(-k_{q} Q t) \\, P(z,t).$$\nThis is a separable first-order differential equation in $P(z,t)$. Separate variables:\n$$\\frac{dP(z,t)}{P(z,t)} = -k_{D} H_{0}(z) \\exp(-k_{q} Q t) \\, dt.$$\nIntegrate from $t = 0$ to $t = t_{f}$ and from $P(z,0) = P_{0}(z)$ to $P(z,t_{f})$:\n$$\\int_{P_{0}(z)}^{P(z,t_{f})} \\frac{d\\eta}{\\eta} = -k_{D} H_{0}(z) \\int_{0}^{t_{f}} \\exp(-k_{q} Q t) \\, dt.$$\nThe left-hand side integrates to \n$$\\ln\\!\\left(\\frac{P(z,t_{f})}{P_{0}(z)}\\right).$$\nFor the right-hand side, compute the integral:\n$$\\int_{0}^{t_{f}} \\exp(-k_{q} Q t) \\, dt = \\left[ -\\frac{1}{k_{q} Q} \\exp(-k_{q} Q t) \\right]_{0}^{t_{f}} = \\frac{1}{k_{q} Q} \\left(1 - \\exp(-k_{q} Q t_{f})\\right).$$\nTherefore,\n$$\\ln\\!\\left(\\frac{P(z,t_{f})}{P_{0}(z)}\\right) = -k_{D} H_{0}(z) \\cdot \\frac{1}{k_{q} Q} \\left(1 - \\exp(-k_{q} Q t_{f})\\right).$$\nExponentiating both sides yields the closed-form expression:\n$$P(z,t_{f}) = P_{0}(z) \\exp\\!\\left( - \\frac{k_{D} H_{0}(z)}{k_{q} Q} \\left(1 - \\exp(-k_{q} Q t_{f})\\right) \\right).$$\n\nThis expression is dimensionless as required, since $P$ is a fraction. It depends only on the given initial profiles and parameters, and follows directly from the stated mass-action kinetics and negligible diffusion assumption. No empirical shortcuts were invoked; the derivation used separation of variables and direct integration of the governing rate laws.",
            "answer": "$$\\boxed{P_{0}(z)\\,\\exp\\!\\left(-\\frac{k_{D}\\,H_{0}(z)}{k_{q}\\,Q}\\left(1-\\exp(-k_{q}\\,Q\\,t_{f})\\right)\\right)}$$"
        },
        {
            "introduction": "Resist development rarely proceeds uniformly from the top surface. This practice  isolates a key physical phenomenon captured by the notch model: surface rate inhibition. By deriving the time it takes to etch through this slow, inhibited layer, you will gain a quantitative intuition for how surface effects can create a development \"dead time\" or \"induction time.\" This simple calculation provides direct insight into the physical meaning of the notch model's inhibition parameters, such as $\\beta$, and their impact on the overall process.",
            "id": "4161160",
            "problem": "A chemically amplified photoresist film of thickness $H$ undergoes development in an aqueous base. In the Mack dissolution framework, the local dissolution rate $R(P)$ depends on the spatially uniform and time-invariant protected fraction $P$ during the initial stage of development considered here. In the presence of surface inhibition consistent with the notch model, suppose the top layer of thickness $\\delta$ dissolves at a reduced rate $R_{\\mathrm{top}} = (1-\\beta) R(P)$, where $0\\beta1$ quantifies the inhibition strength. Assume one-dimensional planar dissolution, constant developer activity, and negligible transport limitations beneath the top layer so that the moving boundary speed equals the local dissolution rate. \n\nStarting from the kinematic description of a moving boundary, where the interface retreat speed equals the local dissolution rate, derive the time to surface breakthrough $t_{\\mathrm{break}}$ defined as the time needed to completely remove the inhibited top layer of thickness $\\delta$. Then consider the bulk clearing time $t_{\\mathrm{bulk}}$ defined as the time required for a film of thickness $H$ to clear at the rate $R(P)$ in the absence of surface inhibition. Report your comparison as the ratio $\\rho = t_{\\mathrm{break}}/t_{\\mathrm{bulk}}$.\n\nProvide the final answer as a single closed-form analytic expression in terms of $H$, $\\delta$, and $\\beta$. No numerical evaluation is required. No units should be included in the final answer.",
            "solution": "The problem requires the derivation of the ratio $\\rho = t_{\\mathrm{break}}/t_{\\mathrm{bulk}}$, where $t_{\\mathrm{break}}$ is the time to remove a surface-inhibited layer and $t_{\\mathrm{bulk}}$ is the hypothetical time to clear the entire film in the absence of inhibition. The solution is based on the kinematic model of a moving boundary, where the interface velocity is equal to the local material removal rate.\n\nLet $z$ be the coordinate representing the depth into the photoresist film, with $z=0$ corresponding to the initial top surface of the film. The position of the dissolving interface at time $t$ is denoted by $z(t)$. The problem states that the moving boundary speed, $\\frac{dz}{dt}$, is equal to the local dissolution rate.\n\nThe dissolution process is described by two distinct rates:\n1.  For the top layer of thickness $\\delta$, corresponding to the depth interval $0 \\leq z \\leq \\delta$, the dissolution rate is reduced due to surface inhibition. This rate is given as $R_{\\mathrm{top}} = (1-\\beta) R(P)$, where $R(P)$ is the bulk dissolution rate and $\\beta$ is the inhibition strength parameter, with $0  \\beta  1$.\n2.  For the bulk of the film, at depths $z  \\delta$, the dissolution proceeds at the uninhibited bulk rate, $R(P)$.\n\nFirst, we calculate the surface breakthrough time, $t_{\\mathrm{break}}$. This is defined as the time required to completely remove the inhibited top layer. In other words, it is the time it takes for the dissolving interface to travel from $z=0$ to $z=\\delta$.\n\nDuring this phase, the interface is within the top layer, so its velocity is constant and equal to $R_{\\mathrm{top}}$:\n$$\n\\frac{dz}{dt} = R_{\\mathrm{top}} = (1-\\beta) R(P) \\quad \\text{for } 0 \\le z(t) \\le \\delta\n$$\nTo find the time $t_{\\mathrm{break}}$, we can separate variables and integrate. We integrate the position from $z=0$ to $z=\\delta$ and the time from $t=0$ to $t=t_{\\mathrm{break}}$:\n$$\n\\int_{0}^{\\delta} dz = \\int_{0}^{t_{\\mathrm{break}}} R_{\\mathrm{top}} \\, dt\n$$\nSince $R(P)$ and $\\beta$ are given as constant, $R_{\\mathrm{top}}$ is also constant with respect to time. The integration yields:\n$$\n\\delta = R_{\\mathrm{top}} \\cdot t_{\\mathrm{break}}\n$$\nSolving for $t_{\\mathrm{break}}$, we get:\n$$\nt_{\\mathrm{break}} = \\frac{\\delta}{R_{\\mathrm{top}}} = \\frac{\\delta}{(1-\\beta)R(P)}\n$$\n\nNext, we calculate the bulk clearing time, $t_{\\mathrm{bulk}}$. This is defined as the time it would take to clear the entire film of thickness $H$ if the dissolution occurred uniformly at the bulk rate $R(P)$ throughout the entire thickness, i.e., in the absence of any surface inhibition.\nThe velocity of the interface in this hypothetical scenario would be constant and equal to $R(P)$ for the entire process:\n$$\n\\frac{dz}{dt} = R(P)\n$$\nTo find the time to clear a thickness $H$, we set up a similar integral:\n$$\n\\int_{0}^{H} dz = \\int_{0}^{t_{\\mathrm{bulk}}} R(P) \\, dt\n$$\nSince $R(P)$ is constant, this gives:\n$$\nH = R(P) \\cdot t_{\\mathrm{bulk}}\n$$\nSolving for $t_{\\mathrm{bulk}}$:\n$$\nt_{\\mathrm{bulk}} = \\frac{H}{R(P)}\n$$\n\nFinally, we are asked to find the ratio $\\rho = t_{\\mathrm{break}} / t_{\\mathrm{bulk}}$. We substitute the expressions derived for $t_{\\mathrm{break}}$ and $t_{\\mathrm{bulk}}$:\n$$\n\\rho = \\frac{t_{\\mathrm{break}}}{t_{\\mathrm{bulk}}} = \\frac{\\frac{\\delta}{(1-\\beta)R(P)}}{\\frac{H}{R(P)}}\n$$\nThe bulk dissolution rate $R(P)$ is a common factor in both the numerator and the denominator, so it cancels out:\n$$\n\\rho = \\frac{\\delta}{H(1-\\beta)}\n$$\nThis expression provides the desired ratio in terms of the film thickness $H$, the inhibited layer thickness $\\delta$, and the inhibition strength parameter $\\beta$. It is a dimensionless quantity, as expected for a ratio of two time durations.",
            "answer": "$$\\boxed{\\frac{\\delta}{H(1-\\beta)}}$$"
        },
        {
            "introduction": "This capstone practice  moves from analytical derivations to a complete computational workflow, mirroring the tasks of a process modeling engineer. You will first construct a comprehensive kinetic model that integrates both the bulk deprotection dependence (Mack-like behavior) and depth-dependent surface inhibition (notch-like behavior). You will then apply statistical methods to perform a model inversion, recovering the fundamental kinetic parameters from synthetic \"experimental\" data, which is an invaluable hands-on experience in model building, parameter extraction, and validation. Note that this problem uses the convention of **deprotected fraction, $p$**, where $p=1-P$ and $P$ is the protected fraction used in the main text.",
            "id": "4161113",
            "problem": "You are tasked with validating an inversion algorithm for photoresist development kinetics using a synthetic dataset generated from a coupled base-rate and surface-inhibition model representative of the Mack and notch formulations used in semiconductor manufacturing process modeling. Begin from the following foundational base, which you must use to derive a computable model:\n\n1. The vertical development velocity equals the local dissolution rate, so that the evolution of the resist surface is governed by $dz/dt = R_{\\mathrm{eff}}$, where $z$ is depth and $t$ is time.\n2. The bulk dissolution rate depends monotonically on the local deprotected fraction $p \\in [0,1]$ of resin sites, transitions between a minimum rate $R_{\\min}$ and a maximum rate $R_{\\max}$, and exhibits a selectivity controlled by a positive real exponent $n$.\n3. Surface inhibition reduces the effective dissolution rate multiplicatively relative to the bulk rate by a factor that decays with depth $z$ away from the surface. This inhibition is characterized by a positive strength parameter $\\beta$, a positive decay length $\\lambda$, and a positive order $m$.\n\nYour program must perform the following tasks:\n\nA. Derive a minimal, smooth, and physically consistent parametric form for the bulk rate as a function of deprotected fraction $p$ and parameters $R_{\\min}$, $R_{\\max}$, and $n$, that is bounded between $R_{\\min}$ and $R_{\\max}$ and is strictly increasing in $p$ for $p \\in (0,1)$ for any fixed admissible parameters. Then, derive a multiplicative surface-inhibition attenuation factor consistent with a decaying influence from the surface with depth, characterized by parameters $m$, $\\beta$, and $\\lambda$. Combine these to obtain an explicit model $R_{\\mathrm{model}}(p,z; \\theta)$, where $\\theta$ denotes the six parameters $\\{R_{\\min}, R_{\\max}, n, m, \\beta, \\lambda\\}$.\n\nB. Construct synthetic datasets by sampling pairs $(p,z)$ on specified grids and computing noisy observations\n$$\nR_{\\mathrm{obs}}(p,z) = R_{\\mathrm{model}}(p,z; \\theta_{\\mathrm{true}}) + \\varepsilon,\n$$\nwhere $\\varepsilon$ is independent Gaussian noise with zero mean and known standard deviation $\\sigma$. The deprotected fraction $p$ is dimensionless. Depth $z$ must be specified in nanometers and the dissolution rate must be in nanometers per second. All reported rates and depths in the internal calculations must be treated in these units.\n\nC. Invert the model using nonlinear least squares to recover parameter estimates $\\hat{\\theta}$ from the synthetic data and compute approximate two-sided $95$-percent confidence intervals for each component of $\\theta$ using the Jacobian-based covariance approximation under the usual linearization of the residual model. Explicitly account for the degrees of freedom by scaling the covariance with the residual variance estimate. For the pair $(R_{\\min}, R_{\\max})$, introduce a parametrization that guarantees $R_{\\max} \\ge R_{\\min}$ during optimization without imposing nonlinear inequality constraints.\n\nD. Validate the inversion by checking whether each true parameter value lies within its corresponding two-sided $95$-percent confidence interval. For each test case, output a single boolean that is true if and only if all six true parameters are simultaneously within their respective confidence intervals.\n\nTest Suite and Data Generation Specifications:\n\nImplement exactly the following three synthetic test cases, each with its own random seed to ensure reproducibility. In all cases, your program must construct a full factorial grid in $(p,z)$, add independent and identically distributed Gaussian noise with the specified standard deviation $\\sigma$, and then proceed with inversion and validation as described. Use the units nanometers for depth and nanometers per second for rates.\n\n- Test Case $1$ (happy path, moderate signal-to-noise ratio):\n  - True parameters: $R_{\\min} = 1.0$, $R_{\\max} = 100.0$, $n = 3.0$, $m = 2.0$, $\\beta = 3.0$, $\\lambda = 20.0$.\n  - Grids: $p$ on $[0,1]$ with $11$ equally spaced points; $z$ on $[0,200]$ nanometers with $11$ equally spaced points.\n  - Noise: Gaussian with standard deviation $\\sigma = 1.0$ nanometers per second.\n  - Random seed: $123$.\n\n- Test Case $2$ (fewer samples, higher noise):\n  - True parameters: $R_{\\min} = 0.5$, $R_{\\max} = 50.0$, $n = 1.5$, $m = 1.0$, $\\beta = 1.0$, $\\lambda = 50.0$.\n  - Grids: $p$ on $[0,1]$ with $7$ equally spaced points; $z$ on $[0,200]$ nanometers with $7$ equally spaced points.\n  - Noise: Gaussian with standard deviation $\\sigma = 2.5$ nanometers per second.\n  - Random seed: $456$.\n\n- Test Case $3$ (strong surface inhibition near the top surface):\n  - True parameters: $R_{\\min} = 2.0$, $R_{\\max} = 80.0$, $n = 4.0$, $m = 3.0$, $\\beta = 5.0$, $\\lambda = 5.0$.\n  - Grids: $p$ on $[0,1]$ with $11$ equally spaced points; $z$ on $[0,50]$ nanometers with $21$ equally spaced points.\n  - Noise: Gaussian with standard deviation $\\sigma = 1.5$ nanometers per second.\n  - Random seed: $789$.\n\nAlgorithmic and Numerical Requirements:\n\n- Use a nonlinear least-squares solver with bound constraints. Introduce a reparametrization for $(R_{\\min}, R_{\\max})$ that enforces $R_{\\max} \\ge R_{\\min}$ by optimizing over $R_{\\min}$ and a nonnegative difference parameter $\\Delta$ such that $R_{\\max} = R_{\\min} + \\Delta$.\n- Compute the Jacobian-based covariance as\n$$\n\\mathrm{Cov}(\\hat{\\phi}) \\approx s^2 \\left(J^\\top J\\right)^{-1},\n$$\nwhere $\\hat{\\phi}$ is the vector of optimized parameters used internally, $J$ is the residual Jacobian at the solution, and\n$$\ns^2 = \\frac{1}{N - K} \\sum_{i=1}^N r_i^2\n$$\nwith $N$ the number of scalar residuals, $K$ the number of free parameters, and $r_i$ the weighted residuals. If you use residuals weighted by known $\\sigma$, ensure the weighting is consistent when forming $J$ and $s^2$.\n- Propagate uncertainty from the internal parametrization $(R_{\\min}, \\Delta, n, m, \\beta, \\lambda)$ to $(R_{\\min}, R_{\\max}, n, m, \\beta, \\lambda)$ using linear error propagation. In particular, for $R_{\\max} = R_{\\min} + \\Delta$, use\n$$\n\\mathrm{Var}(\\widehat{R}_{\\max}) = \\mathrm{Var}(\\widehat{R}_{\\min}) + \\mathrm{Var}(\\widehat{\\Delta}) + 2\\,\\mathrm{Cov}(\\widehat{R}_{\\min}, \\widehat{\\Delta}).\n$$\n\nFinal Output Format:\n\nYour program should produce a single line of output containing exactly a list of three booleans, one per test case in the order listed above, each indicating whether all six true parameters are simultaneously contained within their two-sided $95$-percent confidence intervals. The list must be formatted as a comma-separated Python-style list with no spaces, for example, \"[True,False,True]\". No other text must be printed.\n\nAll internal rates must be treated in nanometers per second and depths in nanometers. Angles are not used. No percentages are to be printed; any fractions must be represented as decimals if needed. The final printed output is unitless booleans as specified.",
            "solution": "The problem is deemed valid as it is scientifically grounded in the established principles of photoresist development kinetics, is well-posed with a clear objective and sufficient data, and is free of contradictions or ambiguities. It presents a standard but non-trivial exercise in model derivation, numerical optimization, and statistical validation, common in computational science and engineering.\n\n### A. Model Derivation\n\nThe problem requires the derivation of a parametric model for the effective dissolution rate, $R_{\\mathrm{eff}}$, as a function of the deprotected fraction of resin sites, $p$, and the depth from the surface, $z$. The model is a product of a bulk dissolution rate term, $R_{\\mathrm{bulk}}(p)$, and a surface inhibition factor, $S(z)$.\n\n**1. Bulk Dissolution Rate ($R_{\\mathrm{bulk}}$)**\n\nThe bulk rate, $R_{\\mathrm{bulk}}$, must satisfy the following conditions:\n- It depends on the deprotected fraction $p \\in [0, 1]$.\n- It transitions between a minimum rate $R_{\\min}$ and a maximum rate $R_{\\max}$. Specifically, $R_{\\mathrm{bulk}}(p=0) = R_{\\min}$ and $R_{\\mathrm{bulk}}(p=1) = R_{\\max}$.\n- It is strictly increasing for $p \\in (0,1)$.\n- Its selectivity is controlled by a positive exponent $n$.\n- It must be a minimal, smooth, and physically consistent functional form.\n\nA simple and common model that fulfills these requirements is a power-law interpolation between the two limiting rates:\n$$\nR_{\\mathrm{bulk}}(p; R_{\\min}, R_{\\max}, n) = R_{\\min} + (R_{\\max} - R_{\\min}) p^n\n$$\nLet's verify this form against the criteria:\n- At $p=0$, $R_{\\mathrm{bulk}}(0) = R_{\\min} + (R_{\\max} - R_{\\min}) \\cdot 0^n = R_{\\min}$.\n- At $p=1$, $R_{\\mathrm{bulk}}(1) = R_{\\min} + (R_{\\max} - R_{\\min}) \\cdot 1^n = R_{\\max}$.\n- For $p \\in (0,1)$, assuming $R_{\\max}  R_{\\min}  0$ and $n0$, the rate is bounded between $R_{\\min}$ and $R_{\\max}$.\n- The derivative with respect to $p$ is $\\frac{\\partial R_{\\mathrm{bulk}}}{\\partial p} = (R_{\\max} - R_{\\min}) n p^{n-1}$. Given $R_{\\max}  R_{\\min}$ and $n0$, this derivative is positive for $p \\in (0,1)$, so the function is strictly increasing.\nThis form is smooth and represents a physically reasonable transition from a slow-etching protected state to a fast-etching deprotected state.\n\n**2. Surface Inhibition Factor ($S(z)$)**\n\nThe surface inhibition factor, $S(z)$, must be a multiplicative factor that reduces the bulk rate. Its characteristics are:\n- The inhibition effect is strongest at the surface ($z=0$) and decays with increasing depth $z$.\n- The factor is characterized by a positive strength $\\beta$, a positive decay length $\\lambda$, and a positive order $m$.\n\nThis implies that the factor $S(z)$ should be less than $1$ near the surface and approach $1$ as $z \\to \\infty$. A functional form that captures this behavior and incorporates the specified parameters is:\n$$\nS(z; m, \\beta, \\lambda) = \\frac{1}{1 + \\beta \\exp\\left(-\\left(\\frac{z}{\\lambda}\\right)^m\\right)}\n$$\nLet's verify this form:\n- At the surface $z=0$, the exponential term is $1$, and $S(0) = \\frac{1}{1+\\beta}$. Since $\\beta0$, this factor is less than $1$, representing maximum inhibition.\n- For large depth $z \\to \\infty$, the term $(z/\\lambda)^m \\to \\infty$, so the exponential term goes to $0$. Thus, $S(z) \\to 1$, meaning the inhibition effect vanishes.\n- The parameter $\\beta$ controls the strength of the inhibition at the surface.\n- The parameter $\\lambda$ is the characteristic length scale over which the inhibition decays.\n- The parameter $m$ controls the shape of the decay profile.\n\n**3. Combined Model ($R_{\\mathrm{model}}$)**\n\nThe full model for the effective dissolution rate is the product of the bulk rate and the surface inhibition factor:\n$$\nR_{\\mathrm{model}}(p,z; \\theta) = R_{\\mathrm{bulk}}(p) \\cdot S(z)\n$$\nwhere $\\theta = \\{R_{\\min}, R_{\\max}, n, m, \\beta, \\lambda\\}$. Substituting the derived forms:\n$$\nR_{\\mathrm{model}}(p,z; \\theta) = \\left[R_{\\min} + (R_{\\max} - R_{\\min}) p^n\\right] \\left[\\frac{1}{1 + \\beta \\exp\\left(-\\left(\\frac{z}{\\lambda}\\right)^m\\right)}\\right]\n$$\nThis is the explicit model to be used for data generation and inversion.\n\n### B. Synthetic Data Generation\n\nFor each test case, a synthetic dataset is generated as follows:\n1.  Construct a factorial grid of $(p, z)$ points using the specified ranges and number of points.\n2.  For each point $(p_i, z_i)$ on the grid, calculate the true rate $R_{\\mathrm{model}}(p_i, z_i; \\theta_{\\mathrm{true}})$ using the provided true parameters $\\theta_{\\mathrm{true}}$.\n3.  Add independent and identically distributed Gaussian noise $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$ to each true rate to obtain the \"observed\" rate:\n    $$\n    R_{\\mathrm{obs}, i} = R_{\\mathrm{model}}(p_i, z_i; \\theta_{\\mathrm{true}}) + \\varepsilon_i\n    $$\nThe random number generator is seeded for reproducibility.\n\n### C. Model Inversion and Confidence Intervals\n\nThe goal is to recover the parameters $\\theta$ from the noisy data $R_{\\mathrm{obs}}$.\n\n**1. Reparametrization**\n\nTo enforce the constraint $R_{\\max} \\ge R_{\\min} \\ge 0$ without using nonlinear inequality constraints in the optimization, we define a new set of parameters for optimization, $\\phi$:\n$$\n\\phi = (R_{\\min}, \\Delta, n, m, \\beta, \\lambda)\n$$\nwhere $\\Delta = R_{\\max} - R_{\\min}$. The original parameters are recovered as $R_{\\max} = R_{\\min} + \\Delta$. The optimization is performed on $\\phi$ with simple non-negativity bounds: $R_{\\min} \\ge 0$, $\\Delta \\ge 0$, $n0$, $m0$, $\\beta \\ge 0$, $\\lambda0$.\n\n**2. Nonlinear Least Squares**\n\nWe use nonlinear least squares to find the parameter vector $\\hat{\\phi}$ that minimizes the sum of squared weighted residuals:\n$$\n\\chi^2(\\phi) = \\sum_{i=1}^{N} \\left( \\frac{R_{\\mathrm{obs}, i} - R_{\\mathrm{model}}(p_i, z_i; \\phi)}{\\sigma} \\right)^2\n$$\nwhere $N$ is the total number of data points. The function to be minimized is implemented using `scipy.optimize.least_squares`.\n\n**3. Covariance and Confidence Intervals**\n\nThe approximate covariance matrix of the estimated parameters $\\hat{\\phi}$ is calculated based on the Jacobian of the weighted residuals at the solution. Let $r'_i(\\phi) = (R_{\\mathrm{obs}, i} - R_{\\mathrm{model}}(p_i, z_i; \\phi))/\\sigma$ be the weighted residuals and $J'$ be the Jacobian matrix with elements $J'_{ij} = \\partial r'_i / \\partial \\phi_j$ evaluated at $\\hat{\\phi}$.\nThe covariance is scaled by the reduced chi-squared value to account for the goodness of fit:\n$$\ns^2 = \\frac{1}{N - K} \\sum_{i=1}^{N} (r'_i(\\hat{\\phi}))^2 = \\frac{\\chi^2(\\hat{\\phi})}{N-K}\n$$\nwhere $K=6$ is the number of free parameters. The covariance matrix for $\\hat{\\phi}$ is then:\n$$\n\\mathrm{Cov}(\\hat{\\phi}) \\approx s^2 (J'^\\top J')^{-1}\n$$\nThe variances of the components of $\\hat{\\phi}$ are the diagonal elements of this matrix. The standard error for each parameter $\\hat{\\phi}_j$ is $\\mathrm{SE}(\\hat{\\phi}_j) = \\sqrt{\\mathrm{Cov}(\\hat{\\phi})_{jj}}$.\n\nTo find the standard error for $\\widehat{R}_{\\max} = \\widehat{R}_{\\min} + \\widehat{\\Delta}$, we use linear error propagation:\n$$\n\\mathrm{Var}(\\widehat{R}_{\\max}) = \\mathrm{Var}(\\widehat{R}_{\\min}) + \\mathrm{Var}(\\widehat{\\Delta}) + 2\\,\\mathrm{Cov}(\\widehat{R}_{\\min}, \\widehat{\\Delta})\n$$\nThe standard error is $\\mathrm{SE}(\\widehat{R}_{\\max}) = \\sqrt{\\mathrm{Var}(\\widehat{R}_{\\max})}$.\n\nFinally, the two-sided $95\\%$ confidence interval for each parameter $\\theta_j \\in \\{R_{\\min}, R_{\\max}, n, m, \\beta, \\lambda\\}$ is calculated as:\n$$\n\\mathrm{CI}_j = [\\hat{\\theta}_j - z_{0.025} \\cdot \\mathrm{SE}(\\hat{\\theta}_j), \\hat{\\theta}_j + z_{0.025} \\cdot \\mathrm{SE}(\\hat{\\theta}_j)]\n$$\nwhere $z_{0.025} \\approx 1.95996$ is the critical value from the standard normal distribution corresponding to a cumulative probability of $0.975$.\n\n### D. Validation\n\nFor each test case, the inversion is validated by checking if the true value of each of the six parameters, $\\theta_{\\mathrm{true}, j}$, lies within its corresponding calculated $95\\%$ confidence interval:\n$$\n\\mathrm{CI}_{j, \\text{lower}} \\le \\theta_{\\mathrm{true}, j} \\le \\mathrm{CI}_{j, \\text{upper}}\n$$\nA test case passes validation if and only if all six true parameters are simultaneously contained within their respective confidence intervals. The final output is a list of booleans representing the validation outcome for each test case.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Solves the photoresist kinetics inversion problem for the three specified test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: Happy path\n        {\n            \"true_params\": {\"R_min\": 1.0, \"R_max\": 100.0, \"n\": 3.0, \"m\": 2.0, \"beta\": 3.0, \"lambda\": 20.0},\n            \"p_grid\": np.linspace(0, 1, 11),\n            \"z_grid\": np.linspace(0, 200, 11),\n            \"sigma\": 1.0,\n            \"seed\": 123\n        },\n        # Case 2: Fewer samples, higher noise\n        {\n            \"true_params\": {\"R_min\": 0.5, \"R_max\": 50.0, \"n\": 1.5, \"m\": 1.0, \"beta\": 1.0, \"lambda\": 50.0},\n            \"p_grid\": np.linspace(0, 1, 7),\n            \"z_grid\": np.linspace(0, 200, 7),\n            \"sigma\": 2.5,\n            \"seed\": 456\n        },\n        # Case 3: Strong surface inhibition\n        {\n            \"true_params\": {\"R_min\": 2.0, \"R_max\": 80.0, \"n\": 4.0, \"m\": 3.0, \"beta\": 5.0, \"lambda\": 5.0},\n            \"p_grid\": np.linspace(0, 1, 11),\n            \"z_grid\": np.linspace(0, 50, 21),\n            \"sigma\": 1.5,\n            \"seed\": 789\n        }\n    ]\n\n    results = []\n\n    # Model definition using the internal optimization parametrization (phi)\n    # phi = (R_min, Delta, n, m, beta, lambda)\n    def R_model(phi, p, z):\n        R_min, Delta, n, m, beta, lam = phi\n        \n        # Ensure parameters are valid to prevent math errors during optimization\n        if n = 0 or R_min  0 or Delta  0 or lam = 0 or m = 0:\n            return np.full_like(p, np.inf)\n\n        R_max = R_min + Delta\n        \n        R_bulk = R_min + (R_max - R_min) * (p**n)\n        \n        S_z = 1.0 / (1.0 + beta * np.exp(-((z / lam)**m)))\n        \n        return R_bulk * S_z\n\n    # Residuals function for least_squares\n    def residuals(phi, p, z, R_obs, sigma):\n        return (R_obs - R_model(phi, p, z)) / sigma\n\n    # Main loop over test cases\n    for case in test_cases:\n        # Extract true parameters and re-parametrize\n        theta_true_map = case[\"true_params\"]\n        theta_true_vec = np.array([\n            theta_true_map[\"R_min\"], theta_true_map[\"R_max\"], theta_true_map[\"n\"],\n            theta_true_map[\"m\"], theta_true_map[\"beta\"], theta_true_map[\"lambda\"]\n        ])\n        \n        phi_true_vec = np.array([\n            theta_true_map[\"R_min\"],\n            theta_true_map[\"R_max\"] - theta_true_map[\"R_min\"],\n            theta_true_map[\"n\"],\n            theta_true_map[\"m\"],\n            theta_true_map[\"beta\"],\n            theta_true_map[\"lambda\"]\n        ])\n\n        # Generate synthetic data\n        p_grid, z_grid = np.meshgrid(case[\"p_grid\"], case[\"z_grid\"])\n        p_flat, z_flat = p_grid.flatten(), z_grid.flatten()\n        \n        rng = np.random.default_rng(case[\"seed\"])\n        \n        R_true = R_model(phi_true_vec, p_flat, z_flat)\n        noise = rng.normal(0, case[\"sigma\"], size=R_true.shape)\n        R_obs = R_true + noise\n\n        # Set up optimization\n        # Use true parameters as initial guess for robust convergence test\n        phi0 = phi_true_vec.copy() \n        \n        # Bounds: [R_min, Delta, n, m, beta, lambda]\n        # Use a small positive epsilon for strictly positive parameters.\n        eps = 1e-9\n        bounds = ([0, 0, eps, eps, 0, eps], \n                  [np.inf, np.inf, np.inf, np.inf, np.inf, np.inf])\n\n        # Perform nonlinear least-squares fit\n        lsq_result = least_squares(\n            residuals,\n            phi0,\n            args=(p_flat, z_flat, R_obs, case[\"sigma\"]),\n            bounds=bounds,\n            method='trf'\n        )\n        \n        phi_hat = lsq_result.x\n        \n        # Post-process to get CIs\n        # Jacobian and residuals\n        J_prime = lsq_result.jac\n        res_weighted = lsq_result.fun\n        \n        # Degrees of freedom\n        N = len(R_obs)\n        K = len(phi_hat)\n        dof = N - K\n\n        # Covariance matrix for phi\n        if dof  0:\n            s2 = np.sum(res_weighted**2) / dof\n            try:\n                cov_phi = s2 * np.linalg.inv(J_prime.T @ J_prime)\n                # Standard errors for phi\n                se_phi = np.sqrt(np.diag(cov_phi))\n            except np.linalg.LinAlgError:\n                # If inversion fails, CIs are undefined; validation fails\n                results.append(False)\n                continue\n        else:\n            # Not enough data points to estimate variance\n            results.append(False)\n            continue\n\n        # Map back to theta parameters\n        theta_hat = np.array([\n            phi_hat[0],                    # R_min\n            phi_hat[0] + phi_hat[1],       # R_max\n            phi_hat[2],                    # n\n            phi_hat[3],                    # m\n            phi_hat[4],                    # beta\n            phi_hat[5]                     # lambda\n        ])\n        \n        # Calculate standard error for R_max using error propagation\n        var_R_min = cov_phi[0, 0]\n        var_Delta = cov_phi[1, 1]\n        cov_R_min_Delta = cov_phi[0, 1]\n        var_R_max = var_R_min + var_Delta + 2 * cov_R_min_Delta\n\n        se_theta = np.array([\n            se_phi[0],                    # SE(R_min)\n            np.sqrt(var_R_max),           # SE(R_max)\n            se_phi[2],                    # SE(n)\n            se_phi[3],                    # SE(m)\n            se_phi[4],                    # SE(beta)\n            se_phi[5]                     # SE(lambda)\n        ])\n        \n        # Calculate 95% CIs\n        z_score = norm.ppf(0.975)\n        ci_lower = theta_hat - z_score * se_theta\n        ci_upper = theta_hat + z_score * se_theta\n        \n        # Validate if true parameters are within CIs\n        is_valid = np.all((theta_true_vec = ci_lower)  (theta_true_vec = ci_upper))\n        results.append(is_valid)\n\n    # Print final output in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}