{
    "hands_on_practices": [
        {
            "introduction": "At the heart of many Monte Carlo simulations is the Binary Collision Approximation (BCA), which simplifies the complex many-body problem of an ion traversing a solid into a sequence of discrete two-body collisions. Understanding the kinematics of a single elastic collision is therefore the first step in building a robust simulator. This exercise  guides you through the fundamental mechanics of energy transfer and scattering, which dictate how an ion loses energy and changes direction during its journey through the material.",
            "id": "4143597",
            "problem": "In the Binary Collision Approximation (BCA) used in Monte Carlo simulations of ion implantation, nuclear stopping is modeled as a sequence of independent, elastic, two-body collisions between an incident ion and target atoms. Consider a phosphorus ion of kinetic energy $E_{0} = 20\\,\\text{keV}$ incident on a silicon atom at rest in the laboratory frame. Assume nonrelativistic kinematics, point-like particles, elastic scattering, and neglect electronic stopping during the collision. Use the following masses for kinematics: phosphorus mass $M_{1} = 31\\,\\text{u}$ and silicon mass $M_{2} = 28.085\\,\\text{u}$, where $\\text{u}$ denotes the atomic mass unit.\n\nStarting from conservation of linear momentum and kinetic energy for an elastic two-body collision and the definition of the center-of-mass frame, derive the maximum fraction of the projectile energy that can be transferred to the target atom. Then, apply it to compute:\n1) the maximum recoil energy imparted to silicon in a single collision with the phosphorus ion at $E_{0} = 20\\,\\text{keV}$, and\n2) the center-of-mass scattering angle corresponding to a head-on collision.\n\nExpress the recoil energy in $\\text{keV}$ and the scattering angle in radians. Round the energy to four significant figures. Provide your final answer as two quantities in the order listed.",
            "solution": "The problem asks for a derivation of the maximum fractional energy transfer in an elastic two-body collision, and then to apply this result to a specific case of a phosphorus ion colliding with a silicon atom.\n\nLet $M_1$ and $v_1$ be the mass and initial velocity of the projectile (phosphorus ion) in the laboratory (lab) frame. Let $M_2$ be the mass of the target atom (silicon), which is initially at rest, so its initial velocity is $v_2=0$. The initial kinetic energy of the projectile is $E_0 = \\frac{1}{2} M_1 v_1^2$.\n\nThe fundamental principles governing this interaction are the conservation of linear momentum and the conservation of kinetic energy (since the collision is elastic).\nIn the lab frame, these are expressed as:\n$$M_1 \\vec{v}_1 = M_1 \\vec{v}_1' + M_2 \\vec{v}_2' \\quad (\\text{Conservation of Momentum})$$\n$$\\frac{1}{2} M_1 v_1^2 = \\frac{1}{2} M_1 |\\vec{v}_1'|^2 + \\frac{1}{2} M_2 |\\vec{v}_2'|^2 \\quad (\\text{Conservation of Energy})$$\nwhere $\\vec{v}_1'$ and $\\vec{v}_2'$ are the final velocities of the projectile and target in the lab frame, respectively.\n\nThe analysis is simplified by transforming to the center-of-mass (CM) reference frame. The velocity of the CM, $\\vec{V}_{CM}$, is constant and given by:\n$$\\vec{V}_{CM} = \\frac{M_1 \\vec{v}_1 + M_2 \\vec{v}_2}{M_1 + M_2} = \\frac{M_1}{M_1 + M_2} \\vec{v}_1$$\nThe initial velocities of the particles in the CM frame, $\\vec{u}_1$ and $\\vec{u}_2$, are:\n$$\\vec{u}_1 = \\vec{v}_1 - \\vec{V}_{CM} = \\vec{v}_1 - \\frac{M_1}{M_1 + M_2} \\vec{v}_1 = \\frac{M_2}{M_1 + M_2} \\vec{v}_1$$\n$$\\vec{u}_2 = \\vec{v}_2 - \\vec{V}_{CM} = 0 - \\frac{M_1}{M_1 + M_2} \\vec{v}_1 = -\\frac{M_1}{M_1 + M_2} \\vec{v}_1$$\nIn the CM frame, the total momentum is zero by definition. For an elastic collision, the kinetic energy is conserved, which implies that the speeds of the particles in the CM frame do not change. Their final velocities, $\\vec{u}_1'$ and $\\vec{u}_2'$, are related to their initial velocities by a rotation through the CM scattering angle, $\\theta_{CM}$. Thus, $|\\vec{u}_1'| = |\\vec{u}_1|$ and $|\\vec{u}_2'| = |\\vec{u}_2|$.\n\nThe energy transferred to the target atom is its final kinetic energy in the lab frame, $\\Delta E = \\frac{1}{2} M_2 |\\vec{v}_2'|^2$. The final lab-frame velocity of the target, $\\vec{v}_2'$, is obtained by transforming back from the CM frame:\n$$\\vec{v}_2' = \\vec{u}_2' + \\vec{V}_{CM}$$\nThe magnitude squared of this velocity is:\n$$|\\vec{v}_2'|^2 = (\\vec{u}_2' + \\vec{V}_{CM}) \\cdot (\\vec{u}_2' + \\vec{V}_{CM}) = |\\vec{u}_2'|^2 + |\\vec{V}_{CM}|^2 + 2 \\vec{u}_2' \\cdot \\vec{V}_{CM}$$\nWe have $|\\vec{u}_2'| = |\\vec{u}_2| = \\frac{M_1}{M_1+M_2} v_1$ and $|\\vec{V}_{CM}| = \\frac{M_1}{M_1+M_2} v_1$.\nThe vector $\\vec{V}_{CM}$ is parallel to the initial projectile velocity $\\vec{v}_1$. The vector $\\vec{u}_2$ is anti-parallel to $\\vec{v}_1$. In the CM frame, $\\vec{u}_2'$ is the vector $\\vec{u}_2$ rotated by the angle $\\theta_{CM}$. Therefore, the angle between $\\vec{u}_2'$ and $\\vec{u}_2$ is $\\theta_{CM}$. Since $\\vec{V}_{CM}$ is anti-parallel to $\\vec{u}_2$, the angle between $\\vec{u}_2'$ and $\\vec{V}_{CM}$ is $\\pi - \\theta_{CM}$.\nThe dot product is $\\vec{u}_2' \\cdot \\vec{V}_{CM} = |\\vec{u}_2'| |\\vec{V}_{CM}| \\cos(\\pi - \\theta_{CM}) = -|\\vec{u}_2'| |\\vec{V}_{CM}| \\cos(\\theta_{CM})$.\nSubstituting this into the expression for $|\\vec{v}_2'|^2$:\n$$|\\vec{v}_2'|^2 = |\\vec{u}_2'|^2 + |\\vec{V}_{CM}|^2 - 2 |\\vec{u}_2'| |\\vec{V}_{CM}| \\cos(\\theta_{CM})$$\n$$|\\vec{v}_2'|^2 = \\left(\\frac{M_1 v_1}{M_1+M_2}\\right)^2 + \\left(\\frac{M_1 v_1}{M_1+M_2}\\right)^2 - 2 \\left(\\frac{M_1 v_1}{M_1+M_2}\\right)^2 \\cos(\\theta_{CM})$$\n$$|\\vec{v}_2'|^2 = 2 \\left(\\frac{M_1 v_1}{M_1+M_2}\\right)^2 (1 - \\cos(\\theta_{CM}))$$\nUsing the trigonometric identity $1 - \\cos(\\theta_{CM}) = 2 \\sin^2(\\frac{\\theta_{CM}}{2})$:\n$$|\\vec{v}_2'|^2 = 4 \\left(\\frac{M_1 v_1}{M_1+M_2}\\right)^2 \\sin^2\\left(\\frac{\\theta_{CM}}{2}\\right)$$\nThe energy transferred, $\\Delta E$, is then:\n$$\\Delta E = \\frac{1}{2} M_2 |\\vec{v}_2'|^2 = \\frac{1}{2} M_2 \\left[ 4 \\left(\\frac{M_1 v_1}{M_1+M_2}\\right)^2 \\sin^2\\left(\\frac{\\theta_{CM}}{2}\\right) \\right] = \\frac{2 M_1^2 M_2}{(M_1+M_2)^2} v_1^2 \\sin^2\\left(\\frac{\\theta_{CM}}{2}\\right)$$\nThe fractional energy transfer, $T$, is the ratio $\\frac{\\Delta E}{E_0}$:\n$$T(\\theta_{CM}) = \\frac{\\Delta E}{E_0} = \\frac{\\frac{2 M_1^2 M_2}{(M_1+M_2)^2} v_1^2 \\sin^2\\left(\\frac{\\theta_{CM}}{2}\\right)}{\\frac{1}{2} M_1 v_1^2} = \\frac{4 M_1 M_2}{(M_1+M_2)^2} \\sin^2\\left(\\frac{\\theta_{CM}}{2}\\right)$$\nThe maximum fractional energy transfer, $\\gamma$, occurs when $\\sin^2(\\frac{\\theta_{CM}}{2})$ is at its maximum value of $1$. This happens when $\\frac{\\theta_{CM}}{2} = \\frac{\\pi}{2}$, which means $\\theta_{CM} = \\pi$ radians. A CM scattering angle of $\\pi$ corresponds to a head-on collision, where the projectile reverses its direction in the CM frame.\nTherefore, the maximum fraction of energy that can be transferred is:\n$$\\gamma = \\frac{4 M_1 M_2}{(M_1+M_2)^2}$$\nThis completes the required derivation.\n\nNow, we apply these results to the given problem.\nThe givens are:\nProjectile (Phosphorus): $M_1 = 31\\,\\text{u}$\nTarget (Silicon): $M_2 = 28.085\\,\\text{u}$\nInitial projectile energy: $E_0 = 20\\,\\text{keV}$\n\n1) Calculate the maximum recoil energy, $\\Delta E_{max}$.\nFirst, we calculate the maximum energy transfer coefficient, $\\gamma$:\n$$\\gamma = \\frac{4(31)(28.085)}{(31+28.085)^2} = \\frac{3482.54}{(59.085)^2} = \\frac{3482.54}{3491.037225} \\approx 0.9975658$$\nThe maximum recoil energy is $\\Delta E_{max} = \\gamma E_0$.\n$$\\Delta E_{max} = 0.9975658 \\times 20\\,\\text{keV} \\approx 19.951316\\,\\text{keV}$$\nRounding this value to four significant figures, we obtain:\n$$\\Delta E_{max} = 19.95\\,\\text{keV}$$\n\n2) Determine the center-of-mass scattering angle for a head-on collision.\nAs established in the derivation, the maximum energy transfer corresponds to a head-on collision. This occurs when the scattering angle in the center-of-mass frame is $\\theta_{CM} = \\pi$ radians. In this scenario, the projectile and target recede along the same line they approached on, but in opposite directions.\n\nThus, the two requested quantities are $19.95\\,\\text{keV}$ and $\\pi$ radians.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 19.95  \\pi \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While simulating collisions in a single-element target like pure silicon is instructive, most practical applications involve compound materials such as silicon dioxide ($\\text{SiO}_2$) or silicon nitride. In such cases, the simulator must decide which type of atom the ion will collide with at each step. This practice  delves into the probabilistic method for selecting a collision partner, a key algorithmic step that depends on the target's stoichiometry and the energy-dependent cross sections of its constituent atoms.",
            "id": "4143661",
            "problem": "A monoenergetic beam of boron ions with kinetic energy $E_{0} = 50$ keV enters an amorphous silicon dioxide target. You are modeling nuclear scattering events in a Monte Carlo transport kernel that treats collisions as a spatial Poisson process in a multicomponent medium. Use only the following foundational starting points:\n\n- For a single target species with atomic number density $n$ and total elastic nuclear cross section $\\sigma_{t}(E)$ at energy $E$, the probability of an interaction occurring in a differential path length $ds$ is $n\\,\\sigma_{t}(E)\\,ds$.\n- In a mixture of independent, competing event channels, the conditional probability that the next event is of type $i$ equals its event rate divided by the sum of all event rates.\n\nAssume that over one collision-selection step the ion energy remains approximately constant at $E_{0}$. The silicon dioxide has mass density $\\rho = 2.20$ g/cm$^{3}$ and molar mass $M = 60.0843$ g/mol. Use Avogadroâ€™s number $N_{A} = 6.02214076 \\times 10^{23}$ mol$^{-1}$. At $E_{0}$, take the total elastic nuclear cross sections to be $\\sigma_{t,\\mathrm{Si}}(E_{0}) = 3.0 \\times 10^{-15}$ cm$^{2}$ and $\\sigma_{t,\\mathrm{O}}(E_{0}) = 1.0 \\times 10^{-15}$ cm$^{2}$. Treat silicon dioxide as an ideal mixture of nonoverlapping targets with composition $\\mathrm{SiO}_{2}$.\n\nStarting from the stated principles, derive the categorical selection probabilities $p_{\\mathrm{Si}}$ and $p_{\\mathrm{O}}$ for the target species of the next nuclear collision and then compute their numerical values. Express your final answer as a two-component row vector $\\big(p_{\\mathrm{Si}},\\,p_{\\mathrm{O}}\\big)$ without units, and round each component to four significant figures.",
            "solution": "The problem asks for the derivation and calculation of the categorical selection probabilities for a nuclear collision with either a silicon ($\\mathrm{Si}$) or an oxygen ($\\mathrm{O}$) atom in a silicon dioxide ($\\mathrm{SiO}_2$) target during a Monte Carlo simulation. The derivation must start from the provided foundational principles.\n\nLet $E$ be the kinetic energy of the incident boron ion. The first principle states that for a single target species with atomic number density $n$ and total elastic nuclear cross section $\\sigma_{t}(E)$, the probability of an interaction occurring in a differential path length $ds$ is $n\\,\\sigma_{t}(E)\\,ds$. This differential probability is the product of the macroscopic cross section, $\\Sigma(E) = n\\,\\sigma_{t}(E)$, and the path length, $ds$. The macroscopic cross section $\\Sigma(E)$ represents the event rate per unit path length.\n\nThe target medium is silicon dioxide, $\\mathrm{SiO}_2$, which is a compound material. We treat it as an ideal mixture of non-overlapping silicon and oxygen target atoms. The total event rate per unit path length, $\\lambda_{\\text{total}}$, is the sum of the independent event rates for collisions with each atomic species.\nLet $n_{\\mathrm{Si}}$ and $n_{\\mathrm{O}}$ be the atomic number densities (atoms per unit volume) of silicon and oxygen, respectively. The corresponding total elastic nuclear cross sections at the initial energy $E_{0} = 50$ keV are given as $\\sigma_{t,\\mathrm{Si}}(E_{0})$ and $\\sigma_{t,\\mathrm{O}}(E_{0})$.\n\nThe event rate for scattering off silicon atoms is $\\lambda_{\\mathrm{Si}} = n_{\\mathrm{Si}}\\,\\sigma_{t,\\mathrm{Si}}(E_{0})$.\nThe event rate for scattering off oxygen atoms is $\\lambda_{\\mathrm{O}} = n_{\\mathrm{O}}\\,\\sigma_{t,\\mathrm{O}}(E_{0})$.\n\nThe total event rate for any nuclear collision is the sum of the rates for these two competing event channels:\n$$\n\\lambda_{\\text{total}} = \\lambda_{\\mathrm{Si}} + \\lambda_{\\mathrm{O}} = n_{\\mathrm{Si}}\\,\\sigma_{t,\\mathrm{Si}}(E_{0}) + n_{\\mathrm{O}}\\,\\sigma_{t,\\mathrm{O}}(E_{0})\n$$\n\nThe second principle states that the conditional probability of the next event being of a certain type is the ratio of its event rate to the sum of all event rates. Therefore, the probability $p_{\\mathrm{Si}}$ that the next collision is with a silicon atom is:\n$$\np_{\\mathrm{Si}} = \\frac{\\lambda_{\\mathrm{Si}}}{\\lambda_{\\text{total}}} = \\frac{n_{\\mathrm{Si}}\\,\\sigma_{t,\\mathrm{Si}}(E_{0})}{n_{\\mathrm{Si}}\\,\\sigma_{t,\\mathrm{Si}}(E_{0}) + n_{\\mathrm{O}}\\,\\sigma_{t,\\mathrm{O}}(E_{0})}\n$$\nSimilarly, the probability $p_{\\mathrm{O}}$ that the next collision is with an oxygen atom is:\n$$\np_{\\mathrm{O}} = \\frac{\\lambda_{\\mathrm{O}}}{\\lambda_{\\text{total}}} = \\frac{n_{\\mathrm{O}}\\,\\sigma_{t,\\mathrm{O}}(E_{0})}{n_{\\mathrm{Si}}\\,\\sigma_{t,\\mathrm{Si}}(E_{0}) + n_{\\mathrm{O}}\\,\\sigma_{t,\\mathrm{O}}(E_{0})}\n$$\n\nTo proceed to a numerical calculation, we must relate the atomic number densities $n_{\\mathrm{Si}}$ and $n_{\\mathrm{O}}$. These are derived from the material's mass density $\\rho$, its molar mass $M$, and Avogadro's number $N_{A}$. First, we find the number density of $\\mathrm{SiO}_{2}$ formula units:\n$$\nn_{\\mathrm{SiO}_{2}} = \\frac{\\rho}{M} N_{A}\n$$\nGiven the stoichiometry of $\\mathrm{SiO}_{2}$, each formula unit contains one silicon atom and two oxygen atoms. Thus, the atomic number densities are:\n$$\nn_{\\mathrm{Si}} = 1 \\times n_{\\mathrm{SiO}_{2}} = \\frac{\\rho N_{A}}{M}\n$$\n$$\nn_{\\mathrm{O}} = 2 \\times n_{\\mathrm{SiO}_{2}} = 2 \\frac{\\rho N_{A}}{M}\n$$\nSubstituting these expressions into the formula for $p_{\\mathrm{Si}}$:\n$$\np_{\\mathrm{Si}} = \\frac{\\left(\\frac{\\rho N_{A}}{M}\\right) \\sigma_{t,\\mathrm{Si}}(E_{0})}{\\left(\\frac{\\rho N_{A}}{M}\\right) \\sigma_{t,\\mathrm{Si}}(E_{0}) + 2\\left(\\frac{\\rho N_{A}}{M}\\right) \\sigma_{t,\\mathrm{O}}(E_{0})}\n$$\nThe term $\\frac{\\rho N_{A}}{M}$ is a common factor in the numerator and denominator, and thus cancels out. This demonstrates that the selection probabilities are independent of the material's bulk density and depend only on the stoichiometry and the microscopic cross sections.\n$$\np_{\\mathrm{Si}} = \\frac{\\sigma_{t,\\mathrm{Si}}(E_{0})}{\\sigma_{t,\\mathrm{Si}}(E_{0}) + 2\\,\\sigma_{t,\\mathrm{O}}(E_{0})}\n$$\nSimilarly, for $p_{\\mathrm{O}}$:\n$$\np_{\\mathrm{O}} = \\frac{2\\,\\sigma_{t,\\mathrm{O}}(E_{0})}{\\sigma_{t,\\mathrm{Si}}(E_{0}) + 2\\,\\sigma_{t,\\mathrm{O}}(E_{0})}\n$$\nAs a check, we can confirm that $p_{\\mathrm{Si}} + p_{\\mathrm{O}} = 1$.\n\nNow, we substitute the given numerical values: $\\sigma_{t,\\mathrm{Si}}(E_{0}) = 3.0 \\times 10^{-15}$ cm$^{2}$ and $\\sigma_{t,\\mathrm{O}}(E_{0}) = 1.0 \\times 10^{-15}$ cm$^{2}$.\n\nFor the probability of collision with a silicon atom:\n$$\np_{\\mathrm{Si}} = \\frac{3.0 \\times 10^{-15}}{3.0 \\times 10^{-15} + 2 \\times (1.0 \\times 10^{-15})} = \\frac{3.0 \\times 10^{-15}}{3.0 \\times 10^{-15} + 2.0 \\times 10^{-15}} = \\frac{3.0 \\times 10^{-15}}{5.0 \\times 10^{-15}} = \\frac{3.0}{5.0} = 0.6\n$$\nFor the probability of collision with an oxygen atom:\n$$\np_{\\mathrm{O}} = \\frac{2 \\times (1.0 \\times 10^{-15})}{3.0 \\times 10^{-15} + 2 \\times (1.0 \\times 10^{-15})} = \\frac{2.0 \\times 10^{-15}}{5.0 \\times 10^{-15}} = \\frac{2.0}{5.0} = 0.4\n$$\nThe problem requires the results to be rounded to four significant figures. Therefore, $p_{\\mathrm{Si}} = 0.6000$ and $p_{\\mathrm{O}} = 0.4000$. The final answer is the two-component row vector $(p_{\\mathrm{Si}}, p_{\\mathrm{O}})$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6000  0.4000\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A Monte Carlo simulation progresses by linking a series of discrete scattering events, and a crucial algorithmic component is determining the distance the ion travels between these collisions, known as the free path. This advanced practice  tasks you with implementing the powerful inverse transform sampling method to generate this stochastic free path, correctly accounting for the continuous energy loss the ion experiences between the discrete nuclear scattering events. Mastering this technique is essential for building a physically realistic simulation kernel.",
            "id": "4143625",
            "problem": "You are tasked with implementing a Monte Carlo free-path sampler for energetic ions moving in a semiconductor target under the Continuous Slowing Down Approximation (CSDA). An ion with initial energy $E_0$ traverses a distance $s$ before undergoing a scattering event governed by an energy-dependent macroscopic total cross section $\\Sigma_t(E)$, while simultaneously losing energy according to a stopping power $S(E)$, where $S(E)$ is the energy loss per unit distance. Under CSDA, the energy evolution along the path satisfies $dE/ds=-S(E)$ and the cumulative distribution function for the free path length $s$ is\n$$\nF(s) = 1 - \\exp\\left(-\\int_0^s \\Sigma_t\\big(E(s')\\big)\\, ds'\\right).\n$$\nThe inverse transform sampling method requires drawing a uniform random variate $U\\in(0,1)$ and find $s$ such that\n$$\n\\int_0^s \\Sigma_t\\big(E(s')\\big)\\, ds' = -\\ln(1-U).\n$$\nWhen $\\Sigma_t(E)$ depends on energy, the integral must be evaluated accounting for the within-step energy change induced by $S(E)$. Your program must implement a deterministic inverse transform sampler given explicit models for $\\Sigma_t(E)$ and $S(E)$, and it must correctly handle the case where the ion stops (energy reaches $0$) before accumulating sufficient optical depth (i.e., before a collision target is reached).\n\nDefinitions and units:\n- $E$ is energy in kiloelectronvolts (keV).\n- $s$ is distance in nanometers (nm).\n- $\\Sigma_t(E)$ is macroscopic total cross section in inverse nanometers ($\\text{nm}^{-1}$).\n- $S(E)$ is stopping power in keV per nanometer ($\\text{keV}\\,\\text{nm}^{-1}$).\n- Natural logarithm must be used for $-\\ln(1-U)$.\n- If the required optical depth $T=-\\ln(1-U)$ exceeds the maximum optical depth attainable before the energy falls to $0$, then the program must return the residual range (distance to $E=0$) and indicate that no collision occurred.\n\nEnergy dependence within a step must be correctly handled by coupling $\\Sigma_t(E)$ and $S(E)$ through the CSDA energy-distance relation. Your implementation must be purely numerical, using stable quadrature and root-finding to solve for the path length $s$ or the corresponding energy at collision.\n\nTest suite:\nImplement your program to evaluate the following four test cases. In each case the functions $\\Sigma_t(E)$ and $S(E)$ are defined as follows. All energies are in $\\text{keV}$ and distances in $\\text{nm}$.\n\n- Case 1 (baseline, constant properties):\n  - $E_0 = 50$.\n  - $\\Sigma_t(E) = \\sigma_0$, $\\sigma_0 = 0.002$ $\\text{nm}^{-1}$.\n  - $S(E) = S_0$, $S_0 = 0.01$ $\\text{keV}\\,\\text{nm}^{-1}$.\n  - $U = 0.5$.\n\n- Case 2 (energy-dependent cross section and stopping):\n  - $E_0 = 30$.\n  - $\\Sigma_t(E) = \\sigma_0 \\left(1 + \\alpha \\exp(-E/E_c)\\right)$, with $\\sigma_0 = 0.003$ $\\text{nm}^{-1}$, $\\alpha = 2.0$, $E_c = 10$ $\\text{keV}$.\n  - $S(E) = S_0 + S_1 \\sqrt{E}$, with $S_0 = 0.02$ $\\text{keV}\\,\\text{nm}^{-1}$, $S_1 = 0.005$ $\\text{keV}^{1/2}\\,\\text{nm}^{-1}$.\n  - $U = 0.95$.\n\n- Case 3 (no-collision edge case due to insufficient optical depth before stopping):\n  - $E_0 = 10$.\n  - $\\Sigma_t(E) = \\sigma_0$, $\\sigma_0 = 0.0005$ $\\text{nm}^{-1}$.\n  - $S(E) = S_0$, $S_0 = 0.5$ $\\text{keV}\\,\\text{nm}^{-1}$.\n  - $U = 0.999$.\n\n- Case 4 (immediate collision regime):\n  - $E_0 = 100$.\n  - $\\Sigma_t(E) = \\sigma_0$, $\\sigma_0 = 0.02$ $\\text{nm}^{-1}$.\n  - $S(E) = S_0$, $S_0 = 0.01$ $\\text{keV}\\,\\text{nm}^{-1}$.\n  - $U = 0.01$.\n\nComputational requirements:\n- Implement the inverse transform sampling by solving for the energy $E^\\star$ at collision (if any) via numerical root finding on\n$$\n\\int_{E^\\star}^{E_0} \\frac{\\Sigma_t(E')}{S(E')} \\, dE' = T, \\quad \\text{where } T = -\\ln(1-U),\n$$\nand then compute the corresponding distance\n$$\ns = \\int_{E^\\star}^{E_0} \\frac{1}{S(E')} \\, dE'.\n$$\n- If $T$ is larger than the maximum achievable optical depth\n$$\n\\int_0^{E_0} \\frac{\\Sigma_t(E')}{S(E')} \\, dE',\n$$\nyour program must return the residual range\n$$\ns = \\int_0^{E_0} \\frac{1}{S(E')} \\, dE',\n$$\nand a flag indicating no collision.\n\nFinal output specification:\n- For each test case, produce a pair consisting of the sampled free path length $s$ in nanometers and an integer collision flag (use $1$ for collision and $0$ for no collision).\n- Express $s$ in nanometers rounded to three decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a two-item list for a test case. For example: \"[[s1,flag1],[s2,flag2],[s3,flag3],[s4,flag4]]\".",
            "solution": "The problem requires the implementation of a Monte Carlo free-path sampler for an ion traversing a target material. The sampling is based on the inverse transform method, which is applied to the cumulative distribution function (CDF) for the free path length, $s$. The physical context is the Continuous Slowing Down Approximation (CSDA), where an ion loses energy deterministically along its path.\n\nThe CDF for the free path length $s$ is given by:\n$$\nF(s) = 1 - \\exp\\left(-\\int_0^s \\Sigma_t\\big(E(s')\\big)\\, ds'\\right)\n$$\nHere, $\\Sigma_t(E)$ is the energy-dependent macroscopic total cross section, and $E(s')$ is the ion's energy after traveling a distance $s'$. The energy evolution is governed by the stopping power, $S(E)$, according to the CSDA relation:\n$$\n\\frac{dE}{ds} = -S(E)\n$$\nwith an initial energy $E(s=0) = E_0$.\n\nTo sample a free path $s$ using the inverse transform method, we draw a random variate $U$ from a uniform distribution on $(0,1)$ and solve the equation $F(s) = U$ for $s$:\n$$\n1 - \\exp\\left(-\\int_0^s \\Sigma_t\\big(E(s')\\big)\\, ds'\\right) = U\n$$\nRearranging this equation, we get:\n$$\n\\int_0^s \\Sigma_t\\big(E(s')\\big)\\, ds' = -\\ln(1-U)\n$$\nThe quantity on the right, $T = -\\ln(1-U)$, is the target \"optical depth\" or \"optical path length\". The problem is now to find the path length $s$ that accumulates this target optical depth.\n\nThe integral is over path length $s'$, but the integrand $\\Sigma_t(E(s'))$ depends on energy, which itself is a function of $s'$. It is standard practice to change the variable of integration from path length $s'$ to energy $E$. Using the CSDA relation, we have $ds' = -dE/S(E)$. When $s'=0$, energy is $E_0$. Let $E^\\star$ be the energy at the end of the step, i.e., $E(s) = E^\\star$. The integral transforms as:\n$$\n\\int_0^s \\Sigma_t\\big(E(s')\\big)\\, ds' = \\int_{E_0}^{E^\\star} \\Sigma_t(E) \\left(-\\frac{dE}{S(E)}\\right) = \\int_{E^\\star}^{E_0} \\frac{\\Sigma_t(E)}{S(E)} \\, dE\n$$\nSo, the core problem is to find the energy at collision, $E^\\star$, by solving:\n$$\n\\int_{E^\\star}^{E_0} \\frac{\\Sigma_t(E)}{S(E)} \\, dE = T\n$$\n\nAn ion's path is finite; it ends when its energy drops to $0$. The maximum possible optical depth, $T_{max}$, is accumulated over the ion's entire trajectory from $E_0$ to $0$:\n$$\nT_{max} = \\int_{0}^{E_0} \\frac{\\Sigma_t(E)}{S(E)} \\, dE\n$$\nThis leads to two scenarios:\n\n1.  **No Collision-before-Stop ($T > T_{max}$):** The sampled optical depth $T$ is larger than the maximum achievable optical depth. This means the ion stops (energy becomes $0$) before a collision event occurs. In this case, the process is terminated, and the path length returned is the total range of the ion, $R(E_0)$.\n    $$\n    s = R(E_0) = \\int_0^{E_0} \\frac{1}{S(E)} \\, dE\n    $$\n    A \"no collision\" flag (value $0$) is returned.\n\n2.  **Collision ($T \\le T_{max}$):** The ion undergoes a collision at some energy $E^\\star \\in [0, E_0)$. We must find this $E^\\star$ by solving the integral equation. This is a root-finding problem for the function:\n    $$\n    f(E^\\star) = \\left(\\int_{E^\\star}^{E_0} \\frac{\\Sigma_t(E)}{S(E)} \\, dE\\right) - T = 0\n    $$\n    The function $f(E^\\star)$ is monotonic in $E^\\star$ on the interval $[0, E_0]$, with $f(E_0) = -T  0$ and $f(0) = T_{max} - T \\ge 0$. This guarantees that a unique root $E^\\star$ exists and can be found with a numerical root-solver like the Brent-Dekker method. Once $E^\\star$ is found, the corresponding path length $s$ is calculated by integrating the reciprocal of the stopping power:\n    $$\n    s = \\int_{E^\\star}^{E_0} \\frac{1}{S(E)} \\, dE\n    $$\n    A \"collision\" flag (value $1$) is returned.\n\nThe implementation will utilize numerical quadrature to evaluate the definite integrals and a robust root-finding algorithm to solve for $E^\\star$.\n\nThe algorithm for each test case is as follows:\n1.  Define the functions $\\Sigma_t(E)$ and $S(E)$ based on the provided parameters.\n2.  Calculate the target optical depth $T = -\\ln(1-U)$.\n3.  Define the integrands for optical depth, $g(E) = \\Sigma_t(E)/S(E)$, and for path length, $h(E) = 1/S(E)$.\n4.  Numerically compute the maximum optical depth $T_{max} = \\int_0^{E_0} g(E) \\, dE$.\n5.  If $T  T_{max}$, calculate the total range $s = \\int_0^{E_0} h(E) \\, dE$ and set the collision flag to $0$.\n6.  If $T \\le T_{max}$, solve for $E^\\star$ in the equation $\\int_{E^\\star}^{E_0} g(E) \\, dE = T$ using a numerical root-finder. Then, calculate the path length $s = \\int_{E^\\star}^{E_0} h(E) \\, dE$ and set the collision flag to $1$.\n7.  Format the resulting path length $s$ and collision flag as required.",
            "answer": "[[346.574,1],[30.435,1],[20.000,0],[0.503,1]]"
        }
    ]
}