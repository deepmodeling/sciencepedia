{
    "hands_on_practices": [
        {
            "introduction": "To effectively optimize a mask, one must first master the underlying physics of how an image is formed. This foundational exercise guides you through the process of calculating an aerial image from first principles using Fourier optics . By analyzing a simple periodic alternating phase-shift mask under coherent illumination, you will see how the optical system acts as a low-pass filter, a core concept that dictates which mask features can be resolved and shapes the final image intensity on the wafer.",
            "id": "4134399",
            "problem": "Consider one-dimensional scalar coherent imaging of a periodic mask with amplitude transmission function $M(x)=\\mathrm{sgn}\\!\\big(\\cos(2\\pi x/p)\\big)$, where $p$ is the period. The imaging system has pupil function $P(f)=\\mathrm{circ}\\!\\big(f f_c^{-1}\\big)$ with cutoff spatial frequency $f_c=\\mathrm{NA}/\\lambda$, where $\\mathrm{NA}$ is the Numerical Aperture (NA) and $\\lambda$ is the wavelength. The function $\\mathrm{circ}(u)$ equals $1$ for $|u|\\leq 1$ and $0$ otherwise. Assume coherent illumination so that the image-plane complex field $E(x)$ is given by the inverse Fourier transform of the product of the pupil function and the mask spectrum, and the aerial image intensity is $I(x)=|E(x)|^2$.\n\nUnder scientifically realistic operating conditions where the cutoff spatial frequency passes the fundamental but rejects all higher-order mask harmonics, specifically $f_c$ satisfies $1/p<f_c<3/p$, derive the aerial image $I(x)$ from first principles starting from Fourier optics of coherent imaging, and then determine the amplitude $A_1$ of the first non-direct-current (non-DC) term in the Fourier expansion of $I(x)$, i.e., the coefficient multiplying $\\cos\\!\\big(4\\pi x/p\\big)$.\n\nExpress $A_1$ as a single exact real-valued number or closed-form analytic expression. No rounding is required, and no units are needed since $A_1$ is dimensionless by construction.",
            "solution": "The problem asks for the derivation of the aerial image intensity $I(x)$ and the subsequent determination of the amplitude $A_1$ of the first non-direct-current harmonic in its Fourier expansion. The imaging process is coherent, and specific constraints are placed on the system's cutoff frequency.\n\nThe process involves these steps:\n1.  Determine the Fourier series of the periodic mask function $M(x)$.\n2.  Find the mask's spatial frequency spectrum, $\\tilde{M}(f)$, which is the Fourier transform of $M(x)$.\n3.  Apply the pupil filter, $P(f)$, to the mask spectrum to find the spectrum of the image-plane field, $\\tilde{E}(f) = P(f)\\tilde{M}(f)$.\n4.  Calculate the image-plane electric field, $E(x)$, by taking the inverse Fourier transform of $\\tilde{E}(f)$.\n5.  Compute the aerial image intensity, $I(x) = |E(x)|^2$.\n6.  Expand $I(x)$ into its Fourier series and identify the required coefficient, $A_1$.\n\nStep 1: Fourier Series of the Mask Function $M(x)$\nThe mask function is given by $M(x) = \\mathrm{sgn}(\\cos(2\\pi x/p))$. This function describes a periodic square wave with period $p$. It takes the value $+1$ when $\\cos(2\\pi x/p) > 0$ and $-1$ when $\\cos(2\\pi x/p) < 0$. For one period centered at $x=0$, specifically for $x \\in [-p/2, p/2]$, the function is:\n$$\nM(x) = \n\\begin{cases} \n+1 & \\text{for } x \\in (-p/4, p/4) \\\\\n-1 & \\text{for } x \\in [-p/2, -p/4) \\cup (p/4, p/2]\n\\end{cases}\n$$\n$M(x)$ is a periodic function and can be represented by a complex Fourier series:\n$$\nM(x) = \\sum_{n=-\\infty}^{\\infty} c_n e^{i 2 \\pi n x/p}\n$$\nThe complex Fourier coefficients $c_n$ are calculated by:\n$$\nc_n = \\frac{1}{p} \\int_{-p/2}^{p/2} M(x) e^{-i 2 \\pi n x/p} dx\n$$\nFirst, for the DC component ($n=0$):\n$$\nc_0 = \\frac{1}{p} \\int_{-p/2}^{p/2} M(x) dx = \\frac{1}{p} \\left( \\int_{-p/2}^{-p/4} (-1) dx + \\int_{-p/4}^{p/4} (1) dx + \\int_{p/4}^{p/2} (-1) dx \\right) = \\frac{1}{p} \\left( -\\frac{p}{4} + \\frac{p}{2} - \\frac{p}{4} \\right) = 0\n$$\nThe DC component is zero. For $n \\neq 0$:\n$$\nc_n = \\frac{1}{p} \\left( \\int_{-p/4}^{p/4} e^{-i 2 \\pi n x/p} dx - \\int_{-p/2}^{-p/4} e^{-i 2 \\pi n x/p} dx - \\int_{p/4}^{p/2} e^{-i 2 \\pi n x/p} dx \\right)\n$$\nSince $M(x)$ is real and even, we can simplify the calculation: $c_n = \\frac{2}{p} \\int_0^{p/2} M(x) \\cos(2\\pi n x/p) dx$.\n$$\nc_n = \\frac{2}{p} \\left( \\int_0^{p/4} \\cos\\left(\\frac{2\\pi n x}{p}\\right) dx - \\int_{p/4}^{p/2} \\cos\\left(\\frac{2\\pi n x}{p}\\right) dx \\right)\n$$\n$$\nc_n = \\frac{2}{p} \\left[ \\frac{p}{2\\pi n} \\sin\\left(\\frac{2\\pi n x}{p}\\right) \\right]_0^{p/4} - \\frac{2}{p} \\left[ \\frac{p}{2\\pi n} \\sin\\left(\\frac{2\\pi n x}{p}\\right) \\right]_{p/4}^{p/2}\n$$\n$$\nc_n = \\frac{1}{\\pi n} \\left( \\sin\\left(\\frac{n\\pi}{2}\\right) - 0 \\right) - \\frac{1}{\\pi n} \\left( \\sin(n\\pi) - \\sin\\left(\\frac{n\\pi}{2}\\right) \\right)\n$$\nSince $\\sin(n\\pi) = 0$ for any integer $n$, this simplifies to:\n$$\nc_n = \\frac{1}{\\pi n}\\sin\\left(\\frac{n\\pi}{2}\\right) + \\frac{1}{\\pi n}\\sin\\left(\\frac{n\\pi}{2}\\right) = \\frac{2}{\\pi n}\\sin\\left(\\frac{n\\pi}{2}\\right)\n$$\nThis formula is valid for $n \\neq 0$. The coefficients are non-zero only for odd values of $n$. For even $n \\neq 0$, $\\sin(n\\pi/2)=0$.\nFor $n = \\pm 1$, $c_{\\pm 1} = \\frac{2}{\\pm \\pi}\\sin(\\pm\\pi/2) = \\frac{2}{\\pi}$.\nFor $n = \\pm 3$, $c_{\\pm 3} = \\frac{2}{\\pm 3\\pi}\\sin(\\pm 3\\pi/2) = -\\frac{2}{3\\pi}$.\nIn general, for odd $n$, $c_n = \\frac{2(-1)^{(n-1)/2}}{\\pi n}$.\n\nStep 2: Mask Spectrum $\\tilde{M}(f)$\nThe Fourier transform of a periodic function is a train of Dirac delta functions located at integer multiples of the fundamental frequency $1/p$.\n$$\n\\tilde{M}(f) = \\mathcal{F}\\{M(x)\\} = \\sum_{n=-\\infty}^{\\infty} c_n \\delta\\left(f - \\frac{n}{p}\\right)\n$$\nSubstituting the coefficients $c_n$:\n$$\n\\tilde{M}(f) = \\sum_{n \\text{ odd}} \\frac{2}{\\pi n}\\sin\\left(\\frac{n\\pi}{2}\\right) \\delta\\left(f - \\frac{n}{p}\\right)\n$$\n\nStep 3: Apply the Pupil Filter $P(f)$\nThe spectrum of the image-plane field is $\\tilde{E}(f) = P(f)\\tilde{M}(f)$. The pupil function $P(f)=\\mathrm{circ}(f/f_c)$ acts as a low-pass filter, which is $1$ for $|f| \\le f_c$ and $0$ otherwise. The problem states that $1/p < f_c < 3/p$.\nThis condition determines which diffraction orders (delta functions) are transmitted by the pupil:\n- For $n=\\pm 1$, the spatial frequencies are $f=\\pm 1/p$. Since $|f|=1/p < f_c$, these orders pass through the pupil, so $P(\\pm 1/p) = 1$.\n- For $n=\\pm 3$, the spatial frequencies are $f=\\pm 3/p$. Since $|f|=3/p > f_c$, these orders are blocked by the pupil, so $P(\\pm 3/p) = 0$.\n- All higher orders ($|n| \\geq 3$) are also blocked.\nThe DC component ($n=0$) is already absent since $c_0=0$.\nTherefore, only the $n=\\pm 1$ orders contribute to the image field spectrum:\n$$\n\\tilde{E}(f) = c_1 \\delta\\left(f - \\frac{1}{p}\\right) + c_{-1} \\delta\\left(f + \\frac{1}{p}\\right)\n$$\nUsing $c_1 = c_{-1} = 2/\\pi$:\n$$\n\\tilde{E}(f) = \\frac{2}{\\pi} \\delta\\left(f - \\frac{1}{p}\\right) + \\frac{2}{\\pi} \\delta\\left(f + \\frac{1}{p}\\right)\n$$\n\nStep 4: Image-Plane Electric Field $E(x)$\nThe electric field in the image plane is the inverse Fourier transform of $\\tilde{E}(f)$:\n$$\nE(x) = \\mathcal{F}^{-1}\\{\\tilde{E}(f)\\} = \\int_{-\\infty}^{\\infty} \\tilde{E}(f) e^{i 2\\pi f x} df\n$$\n$$\nE(x) = \\int_{-\\infty}^{\\infty} \\left[ \\frac{2}{\\pi} \\delta\\left(f - \\frac{1}{p}\\right) + \\frac{2}{\\pi} \\delta\\left(f + \\frac{1}{p}\\right) \\right] e^{i 2\\pi f x} df\n$$\nUsing the sifting property of the delta function, $\\int g(t) \\delta(t-t_0) dt = g(t_0)$:\n$$\nE(x) = \\frac{2}{\\pi} e^{i 2\\pi (1/p) x} + \\frac{2}{\\pi} e^{i 2\\pi (-1/p) x} = \\frac{2}{\\pi} (e^{i 2\\pi x/p} + e^{-i 2\\pi x/p})\n$$\nUsing Euler's formula, $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$:\n$$\nE(x) = \\frac{2}{\\pi} \\left( 2\\cos\\left(\\frac{2\\pi x}{p}\\right) \\right) = \\frac{4}{\\pi} \\cos\\left(\\frac{2\\pi x}{p}\\right)\n$$\n\nStep 5: Aerial Image Intensity $I(x)$\nThe aerial image intensity is the squared magnitude of the complex electric field:\n$$\nI(x) = |E(x)|^2 = \\left| \\frac{4}{\\pi} \\cos\\left(\\frac{2\\pi x}{p}\\right) \\right|^2\n$$\nSince the expression for $E(x)$ is purely real:\n$$\nI(x) = \\left( \\frac{4}{\\pi} \\right)^2 \\cos^2\\left(\\frac{2\\pi x}{p}\\right) = \\frac{16}{\\pi^2} \\cos^2\\left(\\frac{2\\pi x}{p}\\right)\n$$\nThis is the derived aerial image intensity.\n\nStep 6: Fourier Expansion of $I(x)$ and Coefficient $A_1$\nTo find the coefficient $A_1$ of the term $\\cos(4\\pi x/p)$, we expand $I(x)$ using the trigonometric power-reduction identity $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$:\n$$\nI(x) = \\frac{16}{\\pi^2} \\left( \\frac{1 + \\cos\\left(2 \\cdot \\frac{2\\pi x}{p}\\right)}{2} \\right)\n$$\n$$\nI(x) = \\frac{8}{\\pi^2} \\left( 1 + \\cos\\left(\\frac{4\\pi x}{p}\\right) \\right)\n$$\n$$\nI(x) = \\frac{8}{\\pi^2} + \\frac{8}{\\pi^2} \\cos\\left(\\frac{4\\pi x}{p}\\right)\n$$\nThis is the Fourier expansion of the intensity $I(x)$. It consists of a DC component, $8/\\pi^2$, and a single harmonic term. This harmonic term is the first non-DC term. The problem defines $A_1$ as the amplitude of the $\\cos(4\\pi x/p)$ term. By inspection, this amplitude is:\n$$\nA_1 = \\frac{8}{\\pi^2}\n$$",
            "answer": "$$\\boxed{\\frac{8}{\\pi^2}}$$"
        },
        {
            "introduction": "Inverse lithography operates in a digital domain, representing the mask as a grid of pixels. This practice bridges the continuous world of Fourier optics with the discrete world of computation by exploring a critical question: how fine must this pixel grid be? By applying the Nyquist-Shannon sampling theorem to the resolution limits of the optical system, you will derive the fundamental constraint on mask pixel size and appreciate the immense scale of the data involved in modern ILT .",
            "id": "4134394",
            "problem": "An inverse lithography technology (ILT) mask for source-mask optimization (SMO) is represented on a discrete pixel grid in real space. The projection system is modeled using scalar, coherent imaging with numerical aperture $NA$, exposure wavelength $\\lambda$, and a mask-to-wafer linear reduction factor $M_{r}$ (mask features are $M_{r}$ times larger than the corresponding wafer features). Assume the aerial image formation is bandlimited by the projection optics, and neglect resist and etch effects so that the Optical Transfer Function (OTF) cutoff governs the minimum resolvable spatial period. Use the Nyquistâ€“Shannon sampling theorem for the pixel grid.\n\nStarting from first principles of scalar diffraction and Fourier optics, derive a relationship between the pixel size $p$ on the mask and the minimum resolvable line width on the mask, denoted $L_{\\min,\\text{mask}}$. Your derivation must proceed from the passband limitation imposed by the projection optics and the sampling condition required to represent any mask pattern whose image is within this passband. Express the relationship in closed form and interpret its meaning in terms of the minimum resolvable feature size on the mask.\n\nThen, taking the mask field of view to be a square of side $F = 50\\,\\mu\\text{m}$ and the desired mask-grid resolution to be $p = 1\\,\\text{nm}$, compute the total number of pixels required to represent this field. Express the final pixel count as an exact integer without units. No rounding is required.",
            "solution": "The problem consists of two parts. The first part requires the derivation of a relationship between the mask pixel size $p$ and the minimum resolvable line width on the mask, $L_{\\min,\\text{mask}}$. The second part requires the calculation of the total number of pixels for a given mask field of view and pixel size.\n\n**Part 1: Derivation of the Relationship**\n\nWe begin from the first principles of scalar diffraction theory for a coherent imaging system. The projection optics are characterized by the numerical aperture $NA$, the exposure wavelength $\\lambda$, and the mask-to-wafer linear reduction factor $M_r$.\n\nThe optical system acts as a low-pass filter for spatial frequencies. The maximum spatial frequency, in radians per unit length, that can be transmitted by the objective lens and appear in the aerial image on the wafer is determined by the $NA$ and $\\lambda$. This cutoff frequency is given by:\n$$k_{\\max, \\text{wafer}} = \\frac{2\\pi NA}{\\lambda}$$\nAny spatial frequency component of the object's spectrum that, when mapped to the image plane, has a magnitude greater than $k_{\\max, \\text{wafer}}$ will be filtered out by the optical system's pupil.\n\nThe mask features are larger than the wafer features by a factor of $M_r$. This demagnification in real space corresponds to a magnification of spatial frequencies. A spatial frequency $k_{\\text{mask}}$ on the mask corresponds to a spatial frequency $k_{\\text{wafer}} = M_r k_{\\text{mask}}$ on the wafer. Consequently, the cutoff frequency of the optical system, when referred back to the mask coordinate system, is:\n$$k_{\\max, \\text{mask}} = \\frac{k_{\\max, \\text{wafer}}}{M_r} = \\frac{2\\pi NA}{\\lambda M_r}$$\n\nThe problem defines the minimum resolvable line width, $L_{\\min}$, based on the passband limitation. The minimum resolvable spatial period, $\\Lambda_{\\min}$, corresponds to the resolution limit of the optical system. For coherent illumination, the smallest period of a grating that can be resolved occurs when its first-order diffracted beam is just captured by the lens. This limit is $\\Lambda_{\\min, \\text{wafer}} = \\lambda/NA$. The minimum resolvable line width is typically defined as half of this minimum period (i.e., the half-pitch):\n$$L_{\\min, \\text{wafer}} = \\frac{\\Lambda_{\\min, \\text{wafer}}}{2} = \\frac{\\lambda}{2NA}$$\nThis is the minimum line width resolvable on the wafer. The corresponding feature on the mask is $M_r$ times larger. Thus, the minimum resolvable line width on the mask is:\n$$L_{\\min, \\text{mask}} = M_r L_{\\min, \\text{wafer}} = M_r \\left( \\frac{\\lambda}{2NA} \\right) = \\frac{M_r \\lambda}{2NA}$$\n\nThe mask pattern is represented on a discrete pixel grid of size $p$. To ensure that the mask representation is adequate for the imaging process, we apply the Nyquist-Shannon sampling theorem. The theorem states that to perfectly reconstruct a signal, the sampling frequency must be at least twice the maximum frequency present in the signal. In this context, the signal is the continuous mask pattern that we are representing with discrete pixels. We only need to ensure that the mask grid can represent all frequencies up to the cutoff imposed by the optical system, $k_{\\max, \\text{mask}}$.\n\nWorking with cyclical frequencies, where $f = k/(2\\pi)$, the maximum cyclical frequency on the mask that is passed by the system is:\n$$f_{\\max, \\text{mask}} = \\frac{k_{\\max, \\text{mask}}}{2\\pi} = \\frac{NA}{\\lambda M_r}$$\nThe sampling frequency on the mask grid for a pixel size $p$ is $f_s = 1/p$. The Nyquist-Shannon theorem requires $f_s \\ge 2f_{\\max, \\text{mask}}$. Substituting the expressions for $f_s$ and $f_{\\max, \\text{mask}}$ yields:\n$$\\frac{1}{p} \\ge 2 \\left( \\frac{NA}{\\lambda M_r} \\right)$$\nSolving for the pixel size $p$, we obtain the condition:\n$$p \\le \\frac{\\lambda M_r}{2NA}$$\nBy comparing this inequality with the previously derived expression for the minimum resolvable line width on the mask, $L_{\\min, \\text{mask}} = \\frac{M_r \\lambda}{2NA}$, we find the direct relationship:\n$$p \\le L_{\\min, \\text{mask}}$$\n\nThis inequality is the required relationship. It signifies that the mask pixel size $p$ must be less than or equal to the minimum resolvable line width on the mask $L_{\\min, \\text{mask}}$. This ensures that the pixel grid is fine enough to describe any feature, including sub-resolution assist features, whose spatial frequencies are within the passband of the projection optics. If $p$ were larger than this limit, the mask grid would be unable to represent the high-frequency information that the optical system can transmit, leading to aliasing and a failure of the inverse lithography optimization. The limiting case, $p = L_{\\min, \\text{mask}}$, corresponds to sampling at exactly the Nyquist rate.\n\n**Part 2: Calculation of Pixel Count**\n\nThe problem specifies a square mask field of view with side length $F = 50\\,\\text{\\mu m}$ and a desired mask-grid pixel size of $p = 1\\,\\text{nm}$. We are asked to compute the total number of pixels required to represent this field.\n\nFirst, we must ensure the units are consistent. We will convert both lengths to meters.\n$$F = 50\\,\\text{\\mu m} = 50 \\times 10^{-6}\\,\\text{m}$$\n$$p = 1\\,\\text{nm} = 1 \\times 10^{-9}\\,\\text{m}$$\n\nThe number of pixels along one dimension of the square field, $N_{\\text{side}}$, is the total length of the side divided by the size of a single pixel:\n$$N_{\\text{side}} = \\frac{F}{p} = \\frac{50 \\times 10^{-6}\\,\\text{m}}{1 \\times 10^{-9}\\,\\text{m}} = 50 \\times 10^3 = 50000$$\nThe total number of pixels, $N_{\\text{total}}$, in the square field is the square of the number of pixels along one side:\n$$N_{\\text{total}} = (N_{\\text{side}})^2 = (50000)^2 = (5 \\times 10^4)^2 = 25 \\times 10^8 = 2,500,000,000$$\n\nThe total number of pixels required to represent the specified field of view at the given resolution is $2,500,000,000$.",
            "answer": "$$\\boxed{2500000000}$$"
        },
        {
            "introduction": "With a grasp of the forward model and its computational representation, you are ready to tackle a practical optimization problem. This exercise asks you to develop a simple lithography simulator to determine the optimal placement of a Sub-Resolution Assist Feature (SRAF), a key technique in optical proximity correction . By maximizing image quality for a main feature while ensuring the SRAF itself does not print across a process window of focus and dose variations, you will gain hands-on experience with the trade-offs at the heart of source-mask optimization.",
            "id": "4134402",
            "problem": "Consider a one-dimensional coherent imaging model for use in semiconductor manufacturing process modeling with a single point source illumination and a thin lens system. You will compute the optimal placement distance of a Sub-Resolution Assist Feature (SRAF) from the edge of a main clear line on a binary mask using a resist threshold model, and verify nonprinting of the SRAF across specified defocus and dose variation windows. Inverse lithography and source-mask optimization are framed here as choosing the SRAF placement to optimize image quality at the main feature while enforcing nonprinting constraints for the assist feature.\n\nAssume scalar, paraxial, coherent imaging with unity magnification, a binary real-valued mask amplitude transmittance, and a band-limited pupil. Let the one-dimensional spatial coordinate be $x$ expressed in nanometers. Let the wavelength be $\\lambda$ (in nanometers), and the Numerical Aperture (NA) be a positive, unitless value. The coherent imaging amplitude in the image plane is given by the inverse Fourier transform of the product of the mask spectrum and the pupil function with defocus phase. Specifically, define the spatial frequency variable $k$ (in cycles per nanometer), the pupil cutoff frequency as $k_c = \\mathrm{NA} / \\lambda$, and the defocus parameter in waves at the pupil edge as $N_\\mathrm{waves}$ (unitless). The pupil function is a low-pass filter with a quadratic phase:\n$$\nP(k;N_\\mathrm{waves}) = \\begin{cases}\n\\exp\\!\\left(i\\,2\\pi\\,N_\\mathrm{waves}\\left(\\frac{k}{k_c}\\right)^2\\right), & |k| \\le k_c, \\\\\n0, & |k| > k_c.\n\\end{cases}\n$$\nLet the mask amplitude transmittance be $m(x) \\in \\{0,1\\}$, equal to $1$ inside clear openings and $0$ otherwise. The coherent image-plane complex field is\n$$\nE(x;N_\\mathrm{waves}) = \\mathcal{F}^{-1}\\left\\{\\mathcal{F}\\{m(x)\\}\\cdot P(k;N_\\mathrm{waves})\\right\\},\n$$\nand the aerial image intensity is $I(x;N_\\mathrm{waves}) = |E(x;N_\\mathrm{waves})|^2$. Normalize intensity such that a uniform infinite clear mask would produce $I(x)=1$. To achieve this normalization numerically, define $I_\\mathrm{uniform}(x;N_\\mathrm{waves})$ as the intensity for $m(x) \\equiv 1$ under the same $P(k;N_\\mathrm{waves})$, and use\n$$\n\\tilde{I}(x;N_\\mathrm{waves}) = \\frac{I(x;N_\\mathrm{waves})}{\\langle I_\\mathrm{uniform}(x;N_\\mathrm{waves})\\rangle},\n$$\nwhere $\\langle \\cdot \\rangle$ denotes the spatial mean, ensuring $\\tilde{I}(x)=1$ for a uniform clear mask.\n\nUse a simple resist threshold model with dose scaling: for a given dose $D$ (dimensionless, relative to nominal), a location $x$ prints if $D\\,\\tilde{I}(x;N_\\mathrm{waves}) \\ge I_\\mathrm{th}$, where $I_\\mathrm{th}$ is the resist threshold (dimensionless). Otherwise, it does not print.\n\nMask geometry specification:\n- A main clear line of width $W_\\mathrm{main}$ centered at $x=0$, i.e., $m(x)=1$ for $|x|\\le W_\\mathrm{main}/2$.\n- One rectangular SRAF of width $W_\\mathrm{a}$ placed to the right of the main line. Its near edge is at distance $s$ from the right edge of the main line, so it occupies $x \\in [W_\\mathrm{main}/2 + s,\\, W_\\mathrm{main}/2 + s + W_\\mathrm{a}]$.\n\nOptimization objective and constraints:\n- Define the nominal dose $D_\\mathrm{nom} = (D_\\mathrm{min} + D_\\mathrm{max})/2$.\n- Define the nominal threshold crossing level $I_\\mathrm{cross} = I_\\mathrm{th}/D_\\mathrm{nom}$.\n- At nominal focus ($N_\\mathrm{waves}=0$), define the right-edge threshold crossing position $x^\\star$ as the location near the right edge where $\\tilde{I}(x^\\star;0) = I_\\mathrm{cross}$ (take the first crossing moving outward from the main line). Define the edge slope magnitude at the crossing as $S = \\left|\\frac{d\\tilde{I}}{dx}\\big|_{x^\\star}\\right|$.\n- Choose $s$ to maximize $S$ subject to the following nonprinting and printing constraints across the specified process window:\n    1. Nonprinting SRAF: for all $N_\\mathrm{waves}$ in the defocus set and $D \\in [D_\\mathrm{min}, D_\\mathrm{max}]$, at the SRAF center $x_\\mathrm{a,center} = W_\\mathrm{main}/2 + s + W_\\mathrm{a}/2$, require $D\\,\\tilde{I}(x_\\mathrm{a,center};N_\\mathrm{waves}) < I_\\mathrm{th}$.\n    2. Printing main feature: for all $N_\\mathrm{waves}$ in the defocus set, with dose $D=D_\\mathrm{min}$, at the main center $x=0$, require $D_\\mathrm{min}\\,\\tilde{I}(0;N_\\mathrm{waves}) > I_\\mathrm{th}$.\n\nDefocus set specification:\n- Use a discrete set of defocus values in waves at the pupil edge: $\\{-N_\\mathrm{max}, -N_\\mathrm{max}/2, 0, N_\\mathrm{max}/2, N_\\mathrm{max}\\}$.\n\nNumerical implementation requirements:\n- Perform the coherent imaging using discrete Fourier transforms on a sufficiently large one-dimensional computational window to avoid wrap-around artifacts. Use a spatial sampling that ensures the Nyquist frequency comfortably exceeds $k_c$.\n- Compute $\\tilde{I}(x;N_\\mathrm{waves})$ for the required mask configurations and defocus values.\n- Search $s$ over a specified discrete range to identify the feasible $s$ that maximizes $S$. If no feasible $s$ exists, return $-1$ for that test case.\n\nUnits and output:\n- All distances ($W_\\mathrm{main}$, $W_\\mathrm{a}$, $s$) must be handled in nanometers, and the returned optimal $s$ must be expressed in nanometers as a float rounded to one decimal place. If infeasible, return the integer $-1$.\n- Angles are not involved, so no angle unit is required.\n\nTest suite:\nCompute the optimal SRAF placement distance $s$ for each of the following parameter sets. For each test case, take the search range for $s$ as given. The final output must be a single line containing the four results as a comma-separated list enclosed in square brackets.\n\n- Case 1 (typical dry lithography):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 0.85$, $W_\\mathrm{main} = 40$ nm, $W_\\mathrm{a} = 15$ nm\n    - $I_\\mathrm{th} = 0.30$, $D_\\mathrm{min} = 0.90$, $D_\\mathrm{max} = 1.10$\n    - $N_\\mathrm{max} = 0.20$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\n- Case 2 (lower numerical aperture):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 0.50$, $W_\\mathrm{main} = 40$ nm, $W_\\mathrm{a} = 15$ nm\n    - $I_\\mathrm{th} = 0.30$, $D_\\mathrm{min} = 0.90$, $D_\\mathrm{max} = 1.10$\n    - $N_\\mathrm{max} = 0.20$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\n- Case 3 (high numerical aperture, tighter dose and larger defocus window):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 1.35$, $W_\\mathrm{main} = 30$ nm, $W_\\mathrm{a} = 12$ nm\n    - $I_\\mathrm{th} = 0.25$, $D_\\mathrm{min} = 0.95$, $D_\\mathrm{max} = 1.05$\n    - $N_\\mathrm{max} = 0.30$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\n- Case 4 (narrow main line):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 0.93$, $W_\\mathrm{main} = 20$ nm, $W_\\mathrm{a} = 10$ nm\n    - $I_\\mathrm{th} = 0.28$, $D_\\mathrm{min} = 0.90$, $D_\\mathrm{max} = 1.10$\n    - $N_\\mathrm{max} = 0.25$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each result must be the optimal SRAF placement distance $s$ in nanometers rounded to one decimal place, or the integer -1 if no feasible solution is found under the constraints and search range.",
            "solution": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the SRAF placement problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: typical dry lithography\n        {\n            \"lambda_nm\": 193.0, \"NA\": 0.85, \"W_main\": 40.0, \"W_a\": 15.0,\n            \"I_th\": 0.30, \"D_min\": 0.90, \"D_max\": 1.10,\n            \"N_max\": 0.20, \"s_range\": (20, 200, 2)\n        },\n        # Case 2: lower numerical aperture\n        {\n            \"lambda_nm\": 193.0, \"NA\": 0.50, \"W_main\": 40.0, \"W_a\": 15.0,\n            \"I_th\": 0.30, \"D_min\": 0.90, \"D_max\": 1.10,\n            \"N_max\": 0.20, \"s_range\": (20, 200, 2)\n        },\n        # Case 3: high numerical aperture, tighter dose and larger defocus window\n        {\n            \"lambda_nm\": 193.0, \"NA\": 1.35, \"W_main\": 30.0, \"W_a\": 12.0,\n            \"I_th\": 0.25, \"D_min\": 0.95, \"D_max\": 1.05,\n            \"N_max\": 0.30, \"s_range\": (20, 200, 2)\n        },\n        # Case 4: narrow main line\n        {\n            \"lambda_nm\": 193.0, \"NA\": 0.93, \"W_main\": 20.0, \"W_a\": 10.0,\n            \"I_th\": 0.28, \"D_min\": 0.90, \"D_max\": 1.10,\n            \"N_max\": 0.25, \"s_range\": (20, 200, 2)\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = find_optimal_sraf_placement(**case)\n        if result == -1:\n            results.append(-1)\n        else:\n            results.append(round(result, 1))\n    \n    # Format the final output string\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\n\ndef find_optimal_sraf_placement(lambda_nm, NA, W_main, W_a, I_th, D_min, D_max, N_max, s_range):\n    \"\"\"\n    Computes the optimal SRAF placement for a single set of parameters.\n    \"\"\"\n    # 1. Numerical Grid Setup\n    N_points = 4096\n    dx = 1.0  # nm\n    L = N_points * dx\n    x = np.linspace(-L / 2, L / 2, N_points, endpoint=False)\n    k = np.fft.fftshift(np.fft.fftfreq(N_points, d=dx))\n\n    # 2. Parameter Calculation\n    k_c = NA / lambda_nm\n    defocus_set = [-N_max, -N_max / 2, 0, N_max / 2, N_max]\n    \n    D_nom = (D_min + D_max) / 2.0\n    I_cross = I_th / D_nom\n    \n    # Process window thresholds for normalized intensity\n    I_main_print_min = I_th / D_min\n    I_sraf_nonprint_max = I_th / D_max\n\n    # 3. Pre-compute Pupil Functions and Normalization\n    pupil_functions = {}\n    norm_factors = {}\n    \n    # Pupil for normalization\n    m_uniform = np.ones(N_points)\n    M_uniform_k = np.fft.fftshift(np.fft.fft(m_uniform))\n\n    for n_waves in defocus_set:\n        pupil = np.exp(1j * 2 * np.pi * n_waves * (k / k_c)**2)\n        pupil[np.abs(k) > k_c] = 0.0\n        pupil_functions[n_waves] = pupil\n\n        # Calculate normalization factor\n        E_uniform_field_k = M_uniform_k * pupil\n        e_uniform_x = np.fft.ifft(np.fft.ifftshift(E_uniform_field_k))\n        I_uniform_x = np.abs(e_uniform_x)**2\n        norm_factors[n_waves] = np.mean(I_uniform_x)\n        \n    # 4. Search for Optimal s\n    s_min, s_max, s_step = s_range\n    s_values = np.arange(s_min, s_max + s_step, s_step)\n    \n    best_s = -1\n    max_S = -1.0\n\n    for s in s_values:\n        # Create mask\n        m_x = np.zeros(N_points)\n        # Main feature\n        m_x[np.abs(x) <= W_main / 2] = 1.0\n        # SRAF\n        sraf_start = W_main / 2 + s\n        sraf_end = sraf_start + W_a\n        m_x[(x >= sraf_start) & (x <= sraf_end)] = 1.0\n        \n        M_k = np.fft.fftshift(np.fft.fft(m_x))\n\n        is_s_feasible = True\n        I_nominal = None\n        \n        for n_waves in defocus_set:\n            P_k = pupil_functions[n_waves]\n            norm = norm_factors[n_waves]\n\n            E_field_k = M_k * P_k\n            E_x = np.fft.ifft(np.fft.ifftshift(E_field_k))\n            I_x = np.abs(E_x)**2\n            I_tilde = I_x / norm\n\n            if n_waves == 0:\n                I_nominal = I_tilde\n\n            # Check main feature printing constraint\n            I_center = np.interp(0.0, x, I_tilde)\n            if I_center <= I_main_print_min:\n                is_s_feasible = False\n                break\n            \n            # Check SRAF non-printing constraint\n            x_a_center = W_main / 2 + s + W_a / 2\n            I_sraf_center = np.interp(x_a_center, x, I_tilde)\n            if I_sraf_center >= I_sraf_nonprint_max:\n                is_s_feasible = False\n                break\n        \n        if is_s_feasible:\n            # Calculate slope S at nominal focus\n            x_search_start_idx = np.searchsorted(x, W_main / 2)\n            \n            I_minus_cross = I_nominal[x_search_start_idx:] - I_cross\n            \n            # Find first crossing index\n            cross_indices = np.where((I_minus_cross[:-1] > 0) & (I_minus_cross[1:] <= 0))[0]\n            \n            if len(cross_indices) > 0:\n                idx = cross_indices[0] + x_search_start_idx\n                \n                # Linear interpolation to find x_star\n                x1, y1 = x[idx], I_nominal[idx]\n                x2, y2 = x[idx + 1], I_nominal[idx + 1]\n                x_star = x1 + (I_cross - y1) * (x2 - x1) / (y2 - y1)\n\n                # Calculate slope\n                grad_I = np.gradient(I_nominal, dx)\n                S = np.abs(np.interp(x_star, x, grad_I))\n\n                if S > max_S:\n                    max_S = S\n                    best_s = s\n    \n    return best_s\n\nif __name__ == \"__main__\":\n    solve()\n```",
            "answer": "[104.0,172.0,52.0,66.0]"
        }
    ]
}