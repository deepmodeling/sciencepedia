{
    "hands_on_practices": [
        {
            "introduction": "Understanding how a pattern on a mask is projected onto a wafer begins with the aerial image. This first practice challenges you to compute the aerial image contrast from first principles using Fourier optics, demonstrating how the interplay between the illumination source and the mask's diffraction pattern determines the ultimate resolution of the lithographic process . Mastering this calculation is fundamental to diagnosing and optimizing imaging performance.",
            "id": "4125078",
            "problem": "Consider a one-dimensional binary line-space grating with wafer-side pitch $p$ and duty cycle $f$, illuminated by Extreme Ultraviolet (EUV) light at wavelength $\\lambda$ by a partially coherent dipole source. The imaging system is modeled as a thin, scalar, in-focus Abbe imaging system with a given Numerical Aperture ($\\mathrm{NA}$). The grating is assumed invariant along $y$ and periodic along $x$. Define the partially coherent source by the coherence parameter $\\sigma$, such that the two dipole points are located at spatial-frequency offsets $\\pm \\sigma \\,\\mathrm{NA}/\\lambda$ along one chosen orientation.\n\nYour task is to compute the aerial image contrast of the grating on the wafer, using a first-principles approach grounded in Fourier optics and scalar diffraction theory. The aerial image is defined as the intensity distribution in the image plane resulting from the incoherent superposition of the coherent images formed by each dipole source point. The fundamental basis must include:\n- Scalar diffraction theory and Fourier optics definitions, specifically that periodic structures can be represented by Fourier series harmonics with spatial frequencies $m/p$ for integer $m$.\n- Abbe imaging principles for partially coherent illumination, where each source point corresponds to a tilted plane wave that shifts the mask spectrum in the pupil, and only harmonics whose shifted spatial frequency lies within the pupil pass through.\n- The passband condition for a spatial frequency $k_x$ given by the pupil cutoff $k_c = \\mathrm{NA}/\\lambda$.\n\nScientific realism constraints:\n- Use $\\lambda = 13.5\\ \\mathrm{nm}$ for EUV illumination.\n- Treat the mask as a thin, amplitude object with unity transmission in the lines and zero in the spaces.\n- Consider only the zeroth, first, and second diffraction orders, i.e., integer harmonics $m \\in \\{-2,-1,0,1,2\\}$.\n- The dipole source can be oriented along $x$ (shifts in $k_x$) or along $y$ (no shift in $k_x$ for a one-dimensional $x$-varying grating).\n\nDefinitions required for the derivation:\n- The pupil cutoff is $k_c = \\mathrm{NA}/\\lambda$ in units of $\\mathrm{nm}^{-1}$.\n- For a source oriented along $x$, the two source points are at $k_{s} = \\pm \\sigma\\, k_c$ in $k_x$. For orientation along $y$, there is no shift in $k_x$ (i.e., $k_s = 0$ for this one-dimensional model).\n- The binary line-space grating of duty cycle $f$ has Fourier series coefficients $c_m$ defined by $c_0 = f$ and $c_m = \\dfrac{\\sin(\\pi m f)}{\\pi m}$ for $m \\neq 0$.\n- A harmonic of order $m$ passes for a given source point if and only if $\\left|k_s + \\dfrac{m}{p}\\right| \\le k_c$.\n\nComputation procedure requirements:\n- Compute the coherent field for each source point as the sum over the transmitted harmonics $m \\in \\{-2,-1,0,1,2\\}$ evaluated over one spatial period $x \\in [0,p]$.\n- The total aerial image intensity is the incoherent sum of the intensities from the two source points.\n- The aerial image contrast is defined as $C = \\dfrac{I_{\\max} - I_{\\min}}{I_{\\max} + I_{\\min}}$, where $I_{\\max}$ and $I_{\\min}$ are the maximum and minimum intensities over $x \\in [0,p]$.\n\nUnits and numerical specifications:\n- All lengths must be treated in $\\mathrm{nm}$, spatial frequencies in $\\mathrm{nm}^{-1}$.\n- Express the final contrast values as decimal fractions (no percentage sign), rounded to six decimal places.\n\nTest suite:\nProvide results for the following five parameter sets, each given as $(p,\\ \\mathrm{NA},\\ \\sigma,\\ \\text{orientation},\\ f)$, with orientation either $x$ or $y$:\n1. Baseline dipole along $x$ at cutoff-limited pitch: $(40\\ \\mathrm{nm},\\ 0.33,\\ 0.5,\\ x,\\ 0.5)$.\n2. Same pitch but dipole along $y$ (no $k_x$ shift): $(40\\ \\mathrm{nm},\\ 0.33,\\ 0.5,\\ y,\\ 0.5)$.\n3. Larger pitch allowing second-order transmission via dipole: $(60\\ \\mathrm{nm},\\ 0.33,\\ 0.5,\\ x,\\ 0.5)$.\n4. Boundary case with first-order centered in the pupil for each dipole lobe: $(81.8181818182\\ \\mathrm{nm},\\ 0.33,\\ 0.5,\\ x,\\ 0.5)$.\n5. Small pitch where even with dipole no first or second orders transmit: $(25\\ \\mathrm{nm},\\ 0.33,\\ 0.5,\\ x,\\ 0.5)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., `[c_1,c_2,c_3,c_4,c_5]`), where $c_i$ are the contrast values for the test cases in the order listed above, rounded to six decimal places.",
            "solution": "The solution computes the aerial image contrast of a one-dimensional line-space grating under partially coherent EUV illumination. The methodology is based on the principles of Fourier optics and scalar diffraction theory, as applied to an Abbe model of image formation.\n\nThe fundamental principle is that a periodic object, such as the grating, can be represented by its Fourier series. The complex electric field of light just after passing through the mask (the object field) can be written as:\n$$\nE_{\\text{obj}}(x) = \\sum_{m=-\\infty}^{\\infty} c_m e^{i 2\\pi (m/p) x}\n$$\nwhere $p$ is the pitch of the grating and $c_m$ are the Fourier series coefficients. For a binary grating with duty cycle $f$ (fraction of the period that is transparent), the coefficients are given by:\n$$\nc_0 = f\n$$\n$$\nc_m = \\frac{\\sin(\\pi m f)}{\\pi m} \\quad \\text{for } m \\neq 0\n$$\nThe problem specifies that we only need to consider diffraction orders $m \\in \\{-2, -1, 0, 1, 2\\}$.\n\nThe imaging system's objective lens acts as a spatial frequency filter. In the scalar, thin-lens approximation, this filter is represented by a pupil function, which is non-zero only for spatial frequencies $k_x$ whose magnitude is less than or equal to a cutoff frequency $k_c$. This cutoff is determined by the numerical aperture $\\mathrm{NA}$ of the lens and the wavelength $\\lambda$ of the light:\n$$\nk_c = \\frac{\\mathrm{NA}}{\\lambda}\n$$\nOnly spatial frequencies within the circle $|k| \\le k_c$ in the pupil plane are transmitted by the lens.\n\nPartially coherent illumination is modeled by considering the source to be a collection of mutually incoherent point sources. For a dipole source, there are two such points. Each source point illuminates the mask with a tilted plane wave. A source point at a spatial frequency location $k_s$ in the source plane effectively shifts the object's diffraction pattern (its Fourier spectrum) in the pupil plane by $-k_s$. Therefore, for a given source point $j$ at location $k_{s,j}$, a diffraction order $m$ with spatial frequency $k_m = m/p$ will be transmitted through the lens if its shifted frequency falls within the pupil's passband:\n$$\n|k_{s,j} + k_m| \\le k_c\n$$\nFor each source point $j$, the electric field in the image plane, $E_j(x)$, is formed by summing only the transmitted harmonics. Assuming unit magnification for simplicity, the field is:\n$$\nE_j(x) = \\sum_{m \\in \\{-2,...,2\\}} c_m \\cdot T_j(m) \\cdot e^{i 2\\pi (m/p) x}\n$$\nwhere $T_j(m)$ is a binary transmission factor for the $j$-th source point and $m$-th order:\n$$\nT_j(m) = \\begin{cases} 1 & \\text{if } |k_{s,j} + m/p| \\le k_c \\\\ 0 & \\text{otherwise} \\end{cases}\n$$\nThe problem specifies a dipole source. For a dipole oriented along the $x$-axis, the two source points are located at $k_x = \\pm \\sigma k_c$. Thus, the source shifts are $k_{s,1} = +\\sigma k_c$ and $k_{s,2} = -\\sigma k_c$. For a dipole oriented along the $y$-axis, the problem states this results in no shift in the $k_x$ dimension of this 1D model, so we take $k_s = 0$ for both source points.\n\nSince the source points are mutually incoherent, the total aerial image intensity, $I(x)$, is the sum of the intensities produced by each source point individually:\n$$\nI(x) = \\sum_{j=1}^{2} |E_j(x)|^2 = |E_1(x)|^2 + |E_2(x)|^2\n$$\nFinally, the aerial image contrast, $C$, is calculated from the maximum ($I_{\\max}$) and minimum ($I_{\\min}$) values of the total intensity over one period of the grating ($x \\in [0, p]$):\n$$\nC = \\frac{I_{\\max} - I_{\\min}}{I_{\\max} + I_{\\min}}\n$$\nA value of $C=1$ represents perfect contrast, while $C=0$ represents no modulation (a flat field), meaning the pattern is not resolved.\n\nThe computational procedure is as follows:\n1.  For each test case with parameters $(p, \\mathrm{NA}, \\sigma, \\text{orientation}, f)$, set the EUV wavelength $\\lambda = 13.5 \\ \\mathrm{nm}$.\n2.  Calculate the pupil cutoff frequency $k_c = \\mathrm{NA}/\\lambda$.\n3.  Determine the source point locations, $\\{k_{s,j}\\}$. For 'x' orientation, $k_{s,j} = \\{\\sigma k_c, -\\sigma k_c\\}$. For 'y' orientation, $k_{s,j} = \\{0, 0\\}$.\n4.  Initialize a total intensity array, $I(x)$, to zeros over a spatial grid for $x \\in [0, p]$.\n5.  For each source point $k_{s,j}$:\n    a. Initialize a complex electric field array, $E_j(x)$, to zeros.\n    b. For each diffraction order $m \\in \\{-2, -1, 0, 1, 2\\}$:\n        i. Check if the order is transmitted using the condition $|k_{s,j} + m/p| \\le k_c$.\n        ii. If it is transmitted, calculate the Fourier coefficient $c_m$ and add the term $c_m e^{i 2\\pi (m/p) x}$ to $E_j(x)$.\n    c. Calculate the intensity for this source, $|E_j(x)|^2$, and add it to the total intensity $I(x)$.\n6.  Find the maximum and minimum values of the final $I(x)$ array.\n7.  Compute the contrast $C$ using its definition. If $I_{\\max} + I_{\\min}$ is zero, the contrast is defined as $0$.\n\nThis procedure is implemented for each of the provided test cases to find the required contrast values.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the aerial image contrast for several EUV lithography scenarios.\n    \n    The solution is based on Fourier optics and the Abbe theory of image formation.\n    It models a 1D binary grating illuminated by a partially coherent dipole\n    source and imaged by a scalar, in-focus system.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (p, NA, sigma, orientation, f)\n    # where p is pitch (nm), NA is numerical aperture, sigma is coherence parameter,\n    # orientation is 'x' or 'y', f is duty cycle.\n    test_cases = [\n        (40.0, 0.33, 0.5, 'x', 0.5),\n        (40.0, 0.33, 0.5, 'y', 0.5),\n        (60.0, 0.33, 0.5, 'x', 0.5),\n        (900.0 / 11.0, 0.33, 0.5, 'x', 0.5),  # p = 81.8181... nm\n        (25.0, 0.33, 0.5, 'x', 0.5)\n    ]\n    \n    LAMBDA = 13.5  # EUV wavelength in nm\n    ORDERS = [-2, -1, 0, 1, 2] # Diffraction orders to consider\n    NUM_SAMPLES = 1000  # Number of points for spatial grid over one period\n\n    results = []\n    \n    for case in test_cases:\n        p, NA, sigma, orientation, f = case\n\n        # Step 1: Calculate derived parameters\n        kc = NA / LAMBDA  # Pupil cutoff frequency in nm^-1\n\n        # Step 2: Determine source point locations in k_x space\n        if orientation == 'x':\n            ks_vals = [sigma * kc, -sigma * kc]\n        elif orientation == 'y':\n            # For a 1D grating, a y-oriented dipole produces no k_x shift.\n            # We model this as two on-axis source points.\n            ks_vals = [0.0, 0.0]\n        else:\n            raise ValueError(\"Orientation must be 'x' or 'y'\")\n            \n        # Step 3: Define spatial grid and initialize total intensity\n        x_grid = np.linspace(0, p, NUM_SAMPLES, endpoint=False)\n        total_intensity = np.zeros_like(x_grid)\n\n        # Step 4: Loop over incoherent source points\n        for ks in ks_vals:\n            coherent_field = np.zeros_like(x_grid, dtype=np.complex128)\n\n            # Step 5: For each source, sum transmitted diffraction orders\n            for m in ORDERS:\n                km = m / p  # Spatial frequency of the m-th order\n                \n                # Pupil passband condition\n                if np.abs(ks + km) = kc:\n                    # Calculate Fourier coefficient c_m\n                    if m == 0:\n                        cm = f\n                    else:\n                        # Handle potential division by zero for m=0, though separated\n                        cm = np.sin(np.pi * m * f) / (np.pi * m)\n                    \n                    # Add harmonic's contribution to the coherent field\n                    coherent_field += cm * np.exp(1j * 2 * np.pi * km * x_grid)\n            \n            # Step 6: Accumulate intensities (incoherent sum)\n            total_intensity += np.abs(coherent_field)**2\n            \n        # Step 7: Calculate contrast from the total aerial image intensity\n        if total_intensity.size > 0:\n            I_max = np.max(total_intensity)\n            I_min = np.min(total_intensity)\n        else:\n            I_max, I_min = 0, 0\n\n        denominator = I_max + I_min\n        if denominator > 1e-12: # Check for non-zero denominator to avoid division by zero\n            contrast = (I_max - I_min) / denominator\n        else:\n            contrast = 0.0\n            \n        results.append(f\"{contrast:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A perfect aerial image is not the end goal; what matters is how robustly the pattern transfers to the wafer in the presence of inevitable manufacturing imperfections. This exercise extends the principles of aerial imaging to calculate the Mask Error Enhancement Factor (MEEF), a critical metric that quantifies how mask fabrication errors are amplified during pattern transfer . By simulating contact holes and applying a resist threshold model, you will gain hands-on experience in modeling a key limiter of process windows.",
            "id": "4125029",
            "problem": "You are asked to implement a computational model to estimate the Mask Error Enhancement Factor (MEEF) for an Extreme Ultraviolet (EUV) lithography contact hole array. The MEEF quantifies how errors in mask Critical Dimension (CD) translate into errors in wafer CD, and is defined as the sensitivity of wafer CD to mask CD. Specifically, you will compute MEEF by numerically differentiating the wafer CD with respect to the mask CD using simulated aerial images under a resist threshold development model across a specified focus and dose matrix.\n\nUse the following scientific base and modeling assumptions:\n\n- Extreme Ultraviolet (EUV) lithography operates at wavelength $\\lambda = 13.5 \\,\\text{nm}$. The Numerical Aperture ($\\mathrm{NA}$) is the pupil radius in spatial-frequency space.\n- The aerial image is modeled using scalar Fourier optics under Abbe imaging with partially coherent illumination, approximated by incoherent summation of coherent images from discrete source points.\n- The pupil function $P(\\mathbf{f})$ is a circular aperture in spatial-frequency coordinates $\\mathbf{f} = (f_x,f_y)$, with passband radius $f_c = \\mathrm{NA}/\\lambda$. For defocus distance $z$ at the image plane, the coherent transfer includes the quadratic phase $\\exp\\!\\left(-i \\pi \\lambda z \\lVert \\mathbf{f} \\rVert^2\\right)$.\n- Partial coherence is represented by a set of source points on a circle of radius $s = \\sigma f_c$ in frequency space, where $\\sigma$ is the partial coherence factor. The aerial intensity is the sum over source points of the squared magnitude of the inverse Fourier transform of the product of the shifted pupil with the object spectrum.\n- The object for a contact hole array is a binary amplitude transmission $A(x,y)$ consisting of circular openings arranged on a square grid of pitch $p$, with each opening having radius $r = \\frac{1}{2}\\, \\mathrm{CD}_\\text{mask} / M$, where $M$ is the projection demagnification (use $M=4$). Here $\\mathrm{CD}_\\text{mask}$ is specified on the mask scale; the aerial image is computed on the wafer scale.\n- The Resist threshold model is binary: define a normalized aerial intensity $I_\\mathrm{norm}(x,y)$ by dividing the computed intensity by its maximum value over the simulation domain for the given scenario. For a given dose factor $D$ and threshold $T_\\mathrm{th}$ (dimensionless), the resist clears (producing a hole on wafer) where $D \\, I_\\mathrm{norm}(x,y) \\ge T_\\mathrm{th}$.\n- The wafer CD for the central contact hole is the equivalent diameter of the connected cleared region containing the designed hole center. This diameter, $d_\\text{wafer}$, is calculated from the region's area, $A_\\text{region}$ (in $\\text{m}^2$), using the formula $d_\\text{wafer} = 2 \\sqrt{A_\\text{region}/\\pi}$. If no region is cleared at the center, the CD is zero.\n\nCompute the Mask Error Enhancement Factor (MEEF) using a central finite difference:\n$$\n\\mathrm{MEEF} \\approx \\frac{d_\\mathrm{wafer}\\!\\left(\\mathrm{CD}_\\text{mask}+\\Delta\\right) - d_\\mathrm{wafer}\\!\\left(\\mathrm{CD}_\\text{mask}-\\Delta\\right)}{(\\mathrm{CD}_\\text{mask}+\\Delta) - (\\mathrm{CD}_\\text{mask}-\\Delta)} = \\frac{d_\\mathrm{wafer}^+ - d_\\mathrm{wafer}^-}{2\\Delta},\n$$\nwhere $\\Delta$ is a small change applied to the mask CD on the mask scale.\n\nIf multi-patterning (two exposures) is used, assume Litho-Etch-Litho-Etch (LELE) style splitting of contacts into two interleaved subsets. The total dose accumulates additively across exposures; i.e., the combined intensity is the sum of the aerial intensities of the two exposures. For multi-patterning, compute the derivative with respect to the CD of the first mask only, holding the second mask constant.\n\nImplement the following steps mathematically:\n\n1. Define a two-dimensional computational grid of side length $L$ and resolution $N \\times N$; spatial sampling $\\Delta x = L/N$. Use frequency grids $f_x, f_y$ consistent with the Fast Fourier Transform (FFT).\n2. Construct the contact hole array amplitude $A(x,y)$ at wafer scale given pitch $p$ and central placement at the image center. For multi-patterning, split the array into two subsets $A_1(x,y)$ and $A_2(x,y)$ using parity of the array indices, and optionally apply an overlay offset $(\\delta_x, \\delta_y)$ to the second exposure.\n3. For a given defocus $z$, partial coherence factor $\\sigma$, and a set of source offsets $\\{\\mathbf{s}_k\\}$ on a circle of radius $s=\\sigma f_c$, compute the aerial intensity\n$$\nI(x,y) = \\sum_k \\left| \\mathcal{F}^{-1}\\left[ P(\\mathbf{f}-\\mathbf{s}_k)\\, e^{-i\\pi \\lambda z \\lVert \\mathbf{f} \\rVert^2} \\, \\mathcal{F}\\{A(x,y)\\} \\right] \\right|^2,\n$$\nwhere $\\mathcal{F}$ denotes the Fourier transform and $\\mathcal{F}^{-1}$ its inverse.\n4. Normalize the intensity to obtain $I_\\mathrm{norm}(x,y) = I(x,y) / \\max_{x,y} I(x,y)$, apply dose $D$, and threshold $T_\\mathrm{th}$ to compute the cleared binary image.\n5. Measure $d_\\mathrm{wafer}$ for the central hole by computing the area of the connected cleared region containing the central pixel and converting it to an equivalent diameter.\n6. Compute $\\mathrm{MEEF}$ using the finite difference formula above with $\\Delta$ on the mask scale, translating to a change of $\\Delta/M$ in radius at wafer scale.\n\nTest Suite and Parameters:\n\nUse a computational grid with $L = 512\\,\\text{nm}$ and $N=256$. All physical quantities must be expressed in SI units in the implementation. Use a circular pupil with $\\mathrm{NA} = 0.33$ and EUV wavelength $\\lambda = 13.5\\,\\text{nm}$. Use $M=4$. Define $p = 64\\,\\text{nm}$. Use $8$ source points uniformly distributed on the source circle. Use $\\Delta = 2\\,\\text{nm}$ on the mask scale for the finite difference.\n\nProvide the following three test cases:\n\n- Case 1 (single exposure, nominal): $\\mathrm{CD}_\\text{mask} = 140\\,\\text{nm}$, $z=0\\,\\text{nm}$, $\\sigma = 0.20$, $D=1.0$ (dimensionless), $T_\\mathrm{th}=0.35$ (dimensionless).\n- Case 2 (single exposure, defocus and low dose): $\\mathrm{CD}_\\text{mask} = 140\\,\\text{nm}$, $z=100\\,\\text{nm}$, $\\sigma = 0.20$, $D=0.85$, $T_\\mathrm{th}=0.35$.\n- Case 3 (two-exposure multi-patterning with overlay): First exposure mask $\\mathrm{CD}_\\text{mask,1} = 140\\,\\text{nm}$ varied by $\\pm \\Delta$, second exposure mask fixed at $\\mathrm{CD}_\\text{mask,2} = 140\\,\\text{nm}$, overlay offset $(\\delta_x,\\delta_y) = (3\\,\\text{nm}, 0\\,\\text{nm})$ applied to the second exposure. Use $z=0\\,\\text{nm}$, $\\sigma=0.20$, $D=1.0$, $T_\\mathrm{th}=0.35$. Split contacts into two interleaved subsets by parity of the array indices $i+j$.\n\nFor all cases, the MEEF must be reported as a dimensionless float. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nAll physical quantities in the code must be expressed in SI units. Angles are not needed. No percentages are allowed; thresholds and doses are pure decimals. Ensure that the simulation is scientifically consistent and numerically stable for the given parameters.",
            "solution": "The Mask Error Enhancement Factor (MEEF) quantifies how errors in the mask's critical dimension ($\\mathrm{CD}_\\text{mask}$) are amplified onto the wafer's critical dimension ($\\mathrm{CD}_\\text{wafer}$). The standard dimensionless MEEF, which accounts for the system's optical demagnification $M$, is defined as:\n$$\n\\mathrm{MEEF} = M \\frac{\\partial \\mathrm{CD}_\\text{wafer}}{\\partial \\mathrm{CD}_\\text{mask}}\n$$\nThis is calculated using a central finite difference approximation. The solution is implemented by following the sequence of computational steps outlined below, with all physical quantities expressed in SI units.\n\n**1. Grid and Coordinate System Definition**\nA two-dimensional computational grid represents the image plane, with a side length of $L = 512 \\times 10^{-9}\\,\\text{m}$ and a resolution of $N \\times N$ pixels, where $N=256$. This yields a spatial sampling of $\\Delta x = L/N = 2 \\times 10^{-9}\\,\\text{m}$. A corresponding frequency domain grid $(\\mathbf{f} = (f_x, f_y))$ is defined for use with the Fast Fourier Transform (FFT).\n\n**2. Mask Object Generation**\nThe mask is modeled as a binary amplitude object $A(x,y)$ on the wafer scale, representing a square array of circular contact holes. A $7 \\times 7$ array is used to model local proximity effects. The array is centered at the origin, with contact centers at $(i \\cdot p, j \\cdot p)$, where the pitch is $p=64 \\times 10^{-9}\\,\\text{m}$. Each circular hole has a radius $r$ at the wafer scale, determined by the mask-scale Critical Dimension ($\\mathrm{CD}_\\text{mask}$) and the system demagnification $M=4$:\n$$\nr = \\frac{1}{2} \\frac{\\mathrm{CD}_\\text{mask}}{M}\n$$\nFor the multi-patterning case, the contact array is split into two masks, $A_1(x,y)$ and $A_2(x,y)$, based on the parity of the sum of their grid indices $(i+j)$. An overlay error $(\\delta_x, \\delta_y) = (3 \\times 10^{-9}\\,\\text{m}, 0\\,\\text{m})$ is applied by shifting mask $A_2$.\n\n**3. Aerial Image Simulation**\nThe aerial image intensity $I(x,y)$ is calculated using the Abbe formulation for partially coherent imaging. The illumination source is modeled as an incoherent collection of $k=8$ discrete point sources uniformly distributed on a circle of radius $s = \\sigma f_c$, where $\\sigma$ is the partial coherence factor and $f_c = \\mathrm{NA}/\\lambda$ is the cutoff frequency of the projection optics ($\\lambda = 13.5 \\times 10^{-9}\\,\\text{m}$, $\\mathrm{NA}=0.33$).\n\nFor each source point $\\mathbf{s}_k$, a coherent image is computed. The calculation involves:\n1.  Computing the Fourier transform of the mask object, $\\mathcal{F}\\{A(x,y)\\}$.\n2.  Defining the pupil function $P(\\mathbf{f})$ as a circular aperture of radius $f_c$ and applying a defocus aberration as a quadratic phase term, $W(\\mathbf{f}) = \\exp(-i \\pi \\lambda z \\lVert \\mathbf{f} \\rVert^2)$.\n3.  Multiplying the object spectrum by the shifted pupil and the defocus term: $E(\\mathbf{f}) = P(\\mathbf{f}-\\mathbf{s}_k) \\cdot W(\\mathbf{f}) \\cdot \\mathcal{F}\\{A(x,y)\\}$.\n4.  Performing an inverse Fourier transform to obtain the complex electric field in the image plane, $E(x,y) = \\mathcal{F}^{-1}\\{E(\\mathbf{f})\\}$.\nThe total aerial intensity is the incoherent sum of intensities from all source points:\n$$\nI(x,y) = \\sum_{k=1}^{8} \\left| \\mathcal{F}^{-1}\\left[ P(\\mathbf{f}-\\mathbf{s}_k) \\cdot e^{-i\\pi \\lambda z \\lVert \\mathbf{f} \\rVert^2} \\cdot \\mathcal{F}\\{A(x,y)\\} \\right] \\right|^2\n$$\nFor the multi-patterning case, the final intensity is the sum of the aerial images from each mask, $I_\\text{total}(x,y) = I_1(x,y) + I_2(x,y)$, simulating a Litho-Etch-Litho-Etch (LELE) process with additive dose.\n\n**4. Resist Threshold Model and Wafer CD Measurement**\nA simple binary threshold model is applied to the aerial image. The intensity is normalized by its maximum value: $I_\\text{norm}(x,y) = I(x,y) / \\max(I)$. A region is considered \"cleared\" if the dosed normalized intensity exceeds a given threshold $T_\\mathrm{th}$:\n$$\n\\text{Cleared}(x,y) = 1 \\quad \\text{if} \\quad D \\cdot I_\\text{norm}(x,y) \\ge T_\\mathrm{th}, \\quad \\text{else} \\quad 0\n$$\nThe wafer CD, $d_\\mathrm{wafer}$, of the central contact hole is found by identifying the cleared region at the grid's origin using a connected-component labeling algorithm. If the origin is not cleared, $d_\\mathrm{wafer} = 0$. Otherwise, the area of the central component, $A_\\mathrm{region}$, is calculated by counting its pixels and multiplying by the pixel area, $\\Delta x^2$. The wafer CD is the diameter of a circle with this area:\n$$\nd_\\mathrm{wafer} = 2 \\sqrt{\\frac{A_\\mathrm{region}}{\\pi}}\n$$\n\n**5. MEEF Calculation**\nThe dimensionless MEEF is calculated using a central finite difference. This requires simulating the wafer CD for two perturbed mask CDs: $\\mathrm{CD}_\\text{mask}^+ = \\mathrm{CD}_\\text{mask} + \\Delta$ and $\\mathrm{CD}_\\text{mask}^- = \\mathrm{CD}_\\text{mask} - \\Delta$, where $\\Delta = 2 \\times 10^{-9}\\,\\text{m}$ is the perturbation on the mask scale. This yields two wafer CDs, $d_\\mathrm{wafer}^+$ and $d_\\mathrm{wafer}^-$.\n$$\n\\mathrm{MEEF} = M \\frac{d_\\mathrm{wafer}^+ - d_\\mathrm{wafer}^-}{2\\Delta}\n$$\nFor the multi-patterning case, this procedure is applied to the CD of the first mask ($\\mathrm{CD}_{\\text{mask},1}$), while the CD of the second mask ($\\mathrm{CD}_{\\text{mask},2}$) is held constant.",
            "answer": "```python\nimport numpy as np\nfrom scipy.ndimage import label\n\ndef solve():\n    \"\"\"\n    Main function to solve the MEEF calculation problem for the given test cases.\n    \"\"\"\n\n    # --- Physical and Simulation Constants (SI Units) ---\n    LAMBDA = 13.5e-9  # Wavelength (m)\n    NA = 0.33  # Numerical Aperture\n    M = 4.0  # Demagnification\n    PITCH = 64e-9  # Contact pitch (m)\n    DELTA_MASK = 2e-9  # CD perturbation on mask scale (m)\n    N_SOURCE_POINTS = 8\n\n    # --- Computational Grid ---\n    L_GRID = 512e-9  # Grid side length (m)\n    N_PIXELS = 256  # Grid resolution\n    DX = L_GRID / N_PIXELS  # Spatial sampling / pixel size (m)\n\n    # --- Test Cases ---\n    test_cases = [\n        # Case 1: Single exposure, nominal\n        {'cd_mask': 140e-9, 'z': 0.0, 'sigma': 0.20, 'dose': 1.0, 't_th': 0.35, 'multi_pattern': False},\n        # Case 2: Single exposure, defocus and low dose\n        {'cd_mask': 140e-9, 'z': 100e-9, 'sigma': 0.20, 'dose': 0.85, 't_th': 0.35, 'multi_pattern': False},\n        # Case 3: Two-exposure multi-patterning\n        {'cd_mask1': 140e-9, 'cd_mask2': 140e-9, 'overlay': (3e-9, 0.0), 'z': 0.0, 'sigma': 0.20, 'dose': 1.0, 't_th': 0.35, 'multi_pattern': True},\n    ]\n    \n    # Pre-calculate frequency grids and coordinates\n    x_coords = np.linspace(-L_GRID / 2, L_GRID / 2 - DX, N_PIXELS)\n    X, Y = np.meshgrid(x_coords, x_coords)\n    \n    freq_coords = np.fft.fftfreq(N_PIXELS, d=DX)\n    Fx, Fy = np.meshgrid(freq_coords, freq_coords)\n    F_sq = Fx**2 + Fy**2\n    \n    F_mag = np.sqrt(F_sq)\n    \n    # --- Helper Functions ---\n    \n    def create_mask(cd_mask, pitch, M, N, L, X, Y, pattern_type='all', overlay=(0,0)):\n        \"\"\"Creates a binary mask for a contact hole array.\"\"\"\n        mask = np.zeros((N, N))\n        cd_wafer = cd_mask / M\n        radius_sq = (cd_wafer / 2)**2\n        array_size = 7 # Use a 7x7 array\n        indices = range(-array_size // 2, array_size // 2 + 1)\n        \n        for i in indices:\n            for j in indices:\n                is_even = (i + j) % 2 == 0\n                if (pattern_type == 'all') or \\\n                   (pattern_type == 'even' and is_even) or \\\n                   (pattern_type == 'odd' and not is_even):\n                    \n                    cx = i * pitch + overlay[0]\n                    cy = j * pitch + overlay[1]\n                    hole = (X - cx)**2 + (Y - cy)**2 = radius_sq\n                    mask[hole] = 1.0\n        return mask\n\n    def calculate_aerial_image(mask, z, sigma, Fx, Fy, F_sq):\n        \"\"\"Calculates the aerial image using Abbe's method.\"\"\"\n        fc = NA / LAMBDA\n        pupil = (F_sq = fc**2).astype(float)\n        \n        source_radius = sigma * fc\n        \n        object_spectrum = np.fft.fftshift(np.fft.fft2(mask))\n        defocus_term = np.exp(-1j * np.pi * LAMBDA * z * F_sq)\n\n        total_intensity = np.zeros_like(mask, dtype=float)\n        \n        for k in range(N_SOURCE_POINTS):\n            theta = 2 * np.pi * k / N_SOURCE_POINTS\n            sk_x = source_radius * np.cos(theta)\n            sk_y = source_radius * np.sin(theta)\n            \n            Fx_shifted = Fx - sk_x\n            Fy_shifted = Fy - sk_y\n            \n            pupil_shifted = (Fx_shifted**2 + Fy_shifted**2 = fc**2).astype(float)\n            \n            E_field_spectrum = pupil_shifted * defocus_term * object_spectrum\n            E_field = np.fft.ifft2(np.fft.ifftshift(E_field_spectrum))\n            total_intensity += np.abs(E_field)**2\n            \n        return total_intensity\n\n    def measure_wafer_cd(intensity, dose, t_th, dx):\n        \"\"\"Measures the wafer CD from the aerial image using a threshold model.\"\"\"\n        if intensity.max() == 0:\n            return 0.0\n        \n        norm_intensity = intensity / intensity.max()\n        binary_image = (dose * norm_intensity >= t_th).astype(int)\n        \n        labeled_array, num_features = label(binary_image)\n        \n        center_pixel_idx = N_PIXELS // 2\n        center_label = labeled_array[center_pixel_idx, center_pixel_idx]\n        \n        if center_label == 0:\n            return 0.0\n        \n        area_pixels = np.sum(labeled_array == center_label)\n        area_region = area_pixels * (dx**2)\n        d_wafer = 2 * np.sqrt(area_region / np.pi)\n        \n        return d_wafer\n\n    def compute_single_exposure_meef(params):\n        \"\"\"Computes MEEF for a single exposure case.\"\"\"\n        \n        def get_dwafer(cd_mask):\n            mask = create_mask(cd_mask, PITCH, M, N_PIXELS, L_GRID, X, Y)\n            intensity = calculate_aerial_image(mask, params['z'], params['sigma'], Fx, Fy, F_sq)\n            return measure_wafer_cd(intensity, params['dose'], params['t_th'], DX)\n\n        d_wafer_plus = get_dwafer(params['cd_mask'] + DELTA_MASK)\n        d_wafer_minus = get_dwafer(params['cd_mask'] - DELTA_MASK)\n\n        meef = M * (d_wafer_plus - d_wafer_minus) / (2 * DELTA_MASK)\n        return meef\n\n    def compute_multi_pattern_meef(params):\n        \"\"\"Computes MEEF for a multi-patterning case.\"\"\"\n        # Calculate aerial image for fixed mask 2\n        mask2 = create_mask(params['cd_mask2'], PITCH, M, N_PIXELS, L_GRID, X, Y,\n                            pattern_type='odd', overlay=params['overlay'])\n        intensity2 = calculate_aerial_image(mask2, params['z'], params['sigma'], Fx, Fy, F_sq)\n\n        def get_dwafer(cd_mask1):\n            mask1 = create_mask(cd_mask1, PITCH, M, N_PIXELS, L_GRID, X, Y, pattern_type='even')\n            intensity1 = calculate_aerial_image(mask1, params['z'], params['sigma'], Fx, Fy, F_sq)\n            total_intensity = intensity1 + intensity2\n            return measure_wafer_cd(total_intensity, params['dose'], params['t_th'], DX)\n\n        d_wafer_plus = get_dwafer(params['cd_mask1'] + DELTA_MASK)\n        d_wafer_minus = get_dwafer(params['cd_mask1'] - DELTA_MASK)\n\n        meef = M * (d_wafer_plus - d_wafer_minus) / (2 * DELTA_MASK)\n        return meef\n\n    # --- Main Calculation Loop ---\n    results = []\n    for case in test_cases:\n        if not case['multi_pattern']:\n            meef = compute_single_exposure_meef(case)\n        else:\n            meef = compute_multi_pattern_meef(case)\n        results.append(meef)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.4f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond the deterministic effects of optics and resist, modern semiconductor manufacturing is governed by random fluctuations that impact device performance. This final practice moves from deterministic simulation to the realm of statistical process modeling, where you will analyze line-edge placement errors arising from multiple, spatially correlated random sources . By deriving and applying the spatial correlation function, you will learn how to characterize the 'texture' of process variability, a crucial skill for predicting and controlling line-edge roughness.",
            "id": "4125060",
            "problem": "A long metal line in a semiconductor patterning flow that combines Extreme Ultraviolet (EUV) exposure and spacer-defined multi-patterning is subject to line-edge placement error (LEPE). Assume the along-line LEPE field is a one-dimensional function $y(x)$, where $x$ is position along the line. The total $y(x)$ is modeled as a linear superposition of two independent contributions: a deposition-thickness-driven component and a spacer-corner-rounding-driven component. Specifically, assume\n$$\ny(x) = s_d \\, d(x) + s_c \\, r(x),\n$$\nwhere $d(x)$ represents deposition thickness variation along the line, $r(x)$ represents spacer corner rounding induced placement error along the line, and $s_d$ and $s_c$ are sensitivity coefficients that convert the physical variations to edge placement displacement. Both $d(x)$ and $r(x)$ are zero-mean, wide-sense stationary Gaussian random fields and independent of each other. Assume the following physically motivated and widely used exponential covariance models:\n$$\n\\mathrm{Cov}\\{d(x), d(x+\\Delta)\\} = \\sigma_d^2 \\exp\\!\\left(-\\frac{|\\Delta|}{\\ell_d}\\right), \\quad\n\\mathrm{Cov}\\{r(x), r(x+\\Delta)\\} = \\sigma_r^2 \\exp\\!\\left(-\\frac{|\\Delta|}{\\ell_c}\\right),\n$$\nwhere $\\sigma_d$ and $\\sigma_r$ are the standard deviations of $d(x)$ and $r(x)$, respectively, and $\\ell_d$ and $\\ell_c$ are their correlation lengths, respectively. All distances must be expressed in micrometers (µm). All standard deviations must be expressed in nanometers (nm). The correlation coefficient is unitless.\n\nFrom first principles of linear systems and second-order statistics, derive the normalized spatial correlation function\n$$\n\\rho(\\Delta) = \\frac{\\mathrm{Cov}\\{y(x), y(x+\\Delta)\\}}{\\sqrt{\\mathrm{Var}\\{y(x)\\}\\,\\mathrm{Var}\\{y(x+\\Delta)\\}}}.\n$$\nThen implement a program that evaluates $\\rho(\\Delta)$ for the parameter sets below.\n\nYou must treat the following as the test suite. For each test case, compute $\\rho(\\Delta)$ at the specified separation values, in the order listed. Your program must aggregate all values across all test cases into a single list, in the order of the test cases and the order of separations within each test case, and print that list as a single line in the exact format described at the end of this statement.\n\n- Test Case 1 (balanced short- and long-range contributions):\n  - $s_d = 1$, $s_c = 1$\n  - $\\sigma_d = 1.5$ nm, $\\sigma_r = 1.5$ nm\n  - $\\ell_d = 100$ µm, $\\ell_c = 0.05$ µm\n  - Separations $\\Delta$ in µm: $[0, 0.02, 0.1, 1, 50, 200]$\n\n- Test Case 2 (single-source deposition only):\n  - $s_d = 1$, $s_c = 1$\n  - $\\sigma_d = 2.0$ nm, $\\sigma_r = 0.0$ nm\n  - $\\ell_d = 1.0$ µm, $\\ell_c$ arbitrary (not used)\n  - Separations $\\Delta$ in µm: $[0, 0.5, 1.0, 2.0]$\n\n- Test Case 3 (equal correlation lengths):\n  - $s_d = 1$, $s_c = 1$\n  - $\\sigma_d = 3.0$ nm, $\\sigma_r = 4.0$ nm\n  - $\\ell_d = 0.5$ µm, $\\ell_c = 0.5$ µm\n  - Separations $\\Delta$ in µm: $[0.0, 0.25, 0.5, 1.0]$\n\n- Test Case 4 (dominant, very short-range corner rounding plus weak, very long-range deposition):\n  - $s_d = 1$, $s_c = 1$\n  - $\\sigma_d = 0.5$ nm, $\\sigma_r = 3.0$ nm\n  - $\\ell_d = 50.0$ µm, $\\ell_c = 0.02$ µm\n  - Separations $\\Delta$ in µm: $[0.0, 0.01, 0.05, 0.1, 1.0, 10.0]$\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list of decimal numbers enclosed in square brackets, e.g., \"[v1,v2,...]\".\n- Append results in the following order: all separations for Test Case 1 (in the order listed), then all separations for Test Case 2, then Test Case 3, then Test Case 4.\n- Because all requested outputs are correlation coefficients, they are unitless. Print each value rounded to six digits after the decimal point. No other text may be printed.",
            "solution": "The solution requires the derivation of the normalized spatial correlation function for the line-edge placement error (LEPE) field, $y(x)$. The derivation proceeds from the fundamental properties of wide-sense stationary (WSS) random processes.\n\n### 1. Mean of $y(x)$\nThe expected value of $y(x)$ is found using the linearity of the expectation operator $E[\\cdot]$. Since $d(x)$ and $r(x)$ are given as zero-mean processes, the mean of their linear combination $y(x)$ is also zero:\n$$E[y(x)] = E[s_d d(x) + s_c r(x)] = s_d E[d(x)] + s_c E[r(x)] = s_d(0) + s_c(0) = 0$$\n\n### 2. Covariance of $y(x)$\nThe covariance function of $y(x)$, denoted $C_{yy}(\\Delta)$, is $\\mathrm{Cov}\\{y(x), y(x+\\Delta)\\}$. For a zero-mean process, this is $E[y(x) y(x+\\Delta)]$.\n$$C_{yy}(\\Delta) = E[(s_d d(x) + s_c r(x))(s_d d(x+\\Delta) + s_c r(x+\\Delta))]$$\nExpanding the product and using the linearity of expectation gives:\n$$C_{yy}(\\Delta) = s_d^2 E[d(x)d(x+\\Delta)] + s_c^2 E[r(x)r(x+\\Delta)] + s_d s_c (E[d(x)r(x+\\Delta)] + E[r(x)d(x+\\Delta)])$$\nSince $d(x)$ and $r(x)$ are independent and zero-mean, their cross-correlation terms are zero (e.g., $E[d(x)r(x+\\Delta)] = E[d(x)]E[r(x+\\Delta)] = 0$). The expression simplifies to:\n$$C_{yy}(\\Delta) = s_d^2 E[d(x)d(x+\\Delta)] + s_c^2 E[r(x)r(x+\\Delta)]$$\nSubstituting the given exponential covariance models, $C_{dd}(\\Delta)$ and $C_{rr}(\\Delta)$:\n$$\\mathrm{Cov}\\{y(x), y(x+\\Delta)\\} = s_d^2 \\sigma_d^2 \\exp\\!\\left(-\\frac{|\\Delta|}{\\ell_d}\\right) + s_c^2 \\sigma_r^2 \\exp\\!\\left(-\\frac{|\\Delta|}{\\ell_c}\\right)$$\nThis is the numerator of the desired correlation function $\\rho(\\Delta)$.\n\n### 3. Variance of $y(x)$\nThe variance of a WSS process is its covariance at zero separation, $\\mathrm{Var}\\{y(x)\\} = C_{yy}(0)$.\n$$\\mathrm{Var}\\{y(x)\\} = s_d^2 \\sigma_d^2 \\exp(0) + s_c^2 \\sigma_r^2 \\exp(0) = s_d^2 \\sigma_d^2 + s_c^2 \\sigma_r^2$$\nSince $y(x)$ is WSS, its variance is constant, so $\\mathrm{Var}\\{y(x)\\} = \\mathrm{Var}\\{y(x+\\Delta)\\}$.\n\n### 4. Normalized Correlation Function $\\rho(\\Delta)$\nThe normalized spatial correlation function is the ratio of the covariance to the variance:\n$$\\rho(\\Delta) = \\frac{\\mathrm{Cov}\\{y(x), y(x+\\Delta)\\}}{\\mathrm{Var}\\{y(x)\\}} = \\frac{C_{yy}(\\Delta)}{C_{yy}(0)}$$\nSubstituting the derived expressions yields the final analytical formula:\n$$\\rho(\\Delta) = \\frac{s_d^2 \\sigma_d^2 \\exp(-\\frac{|\\Delta|}{\\ell_d}) + s_c^2 \\sigma_r^2 \\exp(-\\frac{|\\Delta|}{\\ell_c})}{s_d^2 \\sigma_d^2 + s_c^2 \\sigma_r^2}$$\nThis expression is implemented to evaluate $\\rho(\\Delta)$ for each test case. The units for standard deviations (nm) and lengths ($\\mu$m) are handled consistently, resulting in a dimensionless correlation coefficient as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the normalized spatial correlation function\n    for a composite LEPE field in semiconductor manufacturing.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (parameters_dict, deltas_list)\n    test_cases = [\n        (\n            {'sd': 1.0, 'sc': 1.0, 'sigma_d': 1.5, 'sigma_r': 1.5, 'l_d': 100.0, 'l_c': 0.05},\n            [0.0, 0.02, 0.1, 1.0, 50.0, 200.0]\n        ),\n        (\n            {'sd': 1.0, 'sc': 1.0, 'sigma_d': 2.0, 'sigma_r': 0.0, 'l_d': 1.0, 'l_c': 1.0}, # l_c is arbitrary\n            [0.0, 0.5, 1.0, 2.0]\n        ),\n        (\n            {'sd': 1.0, 'sc': 1.0, 'sigma_d': 3.0, 'sigma_r': 4.0, 'l_d': 0.5, 'l_c': 0.5},\n            [0.0, 0.25, 0.5, 1.0]\n        ),\n        (\n            {'sd': 1.0, 'sc': 1.0, 'sigma_d': 0.5, 'sigma_r': 3.0, 'l_d': 50.0, 'l_c': 0.02},\n            [0.0, 0.01, 0.05, 0.1, 1.0, 10.0]\n        ),\n    ]\n\n    all_results = []\n\n    def calculate_rho(delta, sd, sc, sigma_d, sigma_r, l_d, l_c):\n        \"\"\"\n        Calculates the normalized spatial correlation function rho(delta).\n        \n        The formula is:\n        rho(delta) = (sd^2 * sigma_d^2 * exp(-|delta|/l_d) + sc^2 * sigma_r^2 * exp(-|delta|/l_c)) /\n                     (sd^2 * sigma_d^2 + sc^2 * sigma_r^2)\n                     \n        All units are handled consistently as per the problem statement (nm for sigma,\n        micrometers for lengths). The result is dimensionless.\n        \"\"\"\n        \n        var_d = sd**2 * sigma_d**2\n        var_c = sc**2 * sigma_r**2\n\n        numerator = (var_d * np.exp(-abs(delta) / l_d) + \n                     var_c * np.exp(-abs(delta) / l_c))\n        \n        denominator = var_d + var_c\n        \n        # Handle the case where the total variance is zero to avoid division by zero.\n        # This occurs if both sigma_d and sigma_r are zero (or their sensitivities).\n        if denominator == 0:\n            # If total variance is 0, the process is deterministic (always 0).\n            # The correlation is undefined, but practically it can be considered 1.\n            # By problem definition, rho(0) must be 1.\n            return 1.0 if delta == 0 else np.nan\n\n        return numerator / denominator\n\n    for params, deltas in test_cases:\n        for delta in deltas:\n            result = calculate_rho(\n                delta,\n                params['sd'], params['sc'],\n                params['sigma_d'], params['sigma_r'],\n                params['l_d'], params['l_c']\n            )\n            all_results.append(result)\n\n    # Final print statement in the exact required format.\n    # The output format requests each value rounded to six digits after the decimal point.\n    print(f\"[{','.join(f'{r:.6f}' for r in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}