{
    "hands_on_practices": [
        {
            "introduction": "This first practice problem takes you back to the fundamentals of yield modeling. We will derive a closed-form expression for defect-limited yield by combining a Poisson defect distribution with a model for defect sizes. This exercise  is crucial for understanding how the average number of faults is calculated by integrating the geometry-dependent critical area over the probability distribution of defect sizes.",
            "id": "4117668",
            "problem": "A single long interconnect line segment of length $L$ on a semiconductor wafer is susceptible to open-circuit failures caused by randomly occurring circular particulate defects with random radius $r \\ge 0$. Assume defects occur in the plane according to a homogeneous Poisson Point Process (PPP) with mean areal density $D$ (defects per unit area), and that the defect radius $r$ for each defect is independent and identically distributed with probability density function $p(r) = \\lambda \\exp(-\\lambda r)$ for $r \\ge 0$, where $\\lambda > 0$ is the rate parameter of the exponential distribution. For a narrow interconnect line whose width is small compared to the defect sizes of interest, the open-failure critical area for a defect of radius $r$ can be approximated by the geometric corridor model\n$$A_c^{\\text{open}}(r) = 2 r L,$$\nwhich represents the measure of defect-center locations that would sever the line. Ignoring end effects and assuming linear superposition of independent fatal-defect risks, derive from first principles the analytic expression for the defect-limited yield $Y$ (the probability that the line has zero fatal defects) as a function of $D$, $L$, and $\\lambda$. Express your final answer as a single closed-form expression with no numerical evaluation or rounding.",
            "solution": "The problem requires the derivation of the defect-limited yield, $Y$, for a long interconnect line subject to failures from randomly located and sized particulate defects. The yield is defined as the probability that the line has zero fatal defects.\n\nThe derivation proceeds from first principles based on the provided models.\n\nFirst, we are given that the defect center locations follow a homogeneous Poisson Point Process (PPP) in the plane with a mean areal density of $D$. A key property of a PPP is that the number of points, $N$, found within any given region of area $A$ is a Poisson-distributed random variable with mean $\\mu = D A$. Thus, the probability of finding $k$ points in that region is given by:\n$$P(N=k) = \\frac{\\mu^k \\exp(-\\mu)}{k!} = \\frac{(DA)^k \\exp(-DA)}{k!}$$\n\nSecond, not every defect is fatal. A defect causes an open-circuit failure only if its center lies within a specific \"critical area\". The problem states that the size of a defect, its radius $r$, is a random variable. The critical area for an open failure, $A_c^{\\text{open}}(r)$, is a function of this random radius $r$. The problem provides this function as:\n$$A_c^{\\text{open}}(r) = 2 r L$$\nwhere $L$ is the length of the interconnect.\n\nThird, the defect radii are themselves random variables, independent and identically distributed (i.i.d.) according to an exponential distribution with probability density function (PDF):\n$$p(r) = \\lambda \\exp(-\\lambda r) \\quad \\text{for } r \\ge 0$$\nwhere $\\lambda > 0$ is the rate parameter.\n\nThe problem of finding the yield now becomes one of determining the statistics of *fatal* defects. When a homogeneous PPP is \"thinned\" by an independent process (in this case, by retaining only defects that are fatal), the resulting process of fatal defects is also a Poisson process. The number of fatal defects, let's call it $N_f$, follows a Poisson distribution with a mean, $\\mu_f$. The yield, $Y$, is the probability of having zero fatal defects, $P(N_f=0)$. For a Poisson distribution, this is:\n$$Y = P(N_f=0) = \\frac{\\mu_f^0 \\exp(-\\mu_f)}{0!} = \\exp(-\\mu_f)$$\n\nThe core of the problem is to find the mean number of fatal defects, $\\mu_f$. This quantity is commonly referred to as the \"average number of faults\". It can be calculated by multiplying the defect density $D$ by the *average critical area*, $\\langle A_c \\rangle$. The average critical area is the critical area function, $A_c^{\\text{open}}(r)$, averaged over the probability distribution of the defect radius, $p(r)$.\n$$\\mu_f = D \\cdot \\langle A_c \\rangle$$\nThe average critical area is found by the expectation integral:\n$$\\langle A_c \\rangle = E[A_c^{\\text{open}}(r)] = \\int_{0}^{\\infty} A_c^{\\text{open}}(r) p(r) dr$$\n\nWe substitute the given expressions for $A_c^{\\text{open}}(r)$ and $p(r)$ into this integral:\n$$\\langle A_c \\rangle = \\int_{0}^{\\infty} (2 r L) (\\lambda \\exp(-\\lambda r)) dr$$\n\nWe can factor out the constants $2$, $L$, and $\\lambda$ from the integral:\n$$\\langle A_c \\rangle = 2 L \\lambda \\int_{0}^{\\infty} r \\exp(-\\lambda r) dr$$\n\nThe remaining integral, $\\int_{0}^{\\infty} r \\exp(-\\lambda r) dr$, is a standard form. We can solve it using integration by parts, $\\int u dv = uv - \\int v du$.\nLet $u = r$ and $dv = \\exp(-\\lambda r) dr$.\nThen $du = dr$ and $v = -\\frac{1}{\\lambda}\\exp(-\\lambda r)$.\n\n$$\\int_{0}^{\\infty} r \\exp(-\\lambda r) dr = \\left[ r \\left(-\\frac{1}{\\lambda}\\exp(-\\lambda r)\\right) \\right]_{0}^{\\infty} - \\int_{0}^{\\infty} \\left(-\\frac{1}{\\lambda}\\exp(-\\lambda r)\\right) dr$$\nThe first term, the boundary term, evaluates to $0$:\n$$\\lim_{r \\to \\infty} \\left(-\\frac{r}{\\lambda \\exp(\\lambda r)}\\right) - \\left(0 \\cdot \\left(-\\frac{1}{\\lambda}\\exp(0)\\right)\\right) = 0 - 0 = 0$$\nThe limit at infinity is $0$ by L'HÃ´pital's rule.\n\nThe second term becomes:\n$$\\int_{0}^{\\infty} \\frac{1}{\\lambda}\\exp(-\\lambda r) dr = \\frac{1}{\\lambda} \\int_{0}^{\\infty} \\exp(-\\lambda r) dr = \\frac{1}{\\lambda} \\left[ -\\frac{1}{\\lambda}\\exp(-\\lambda r) \\right]_{0}^{\\infty}$$\n$$\\frac{1}{\\lambda} \\left[ 0 - \\left(-\\frac{1}{\\lambda}\\right) \\right] = \\frac{1}{\\lambda} \\left( \\frac{1}{\\lambda} \\right) = \\frac{1}{\\lambda^2}$$\nThus, the value of the integral is $\\frac{1}{\\lambda^2}$.\n\nAlternatively, we recognize that the mean of an exponential distribution with PDF $p(r) = \\lambda \\exp(-\\lambda r)$ is $E[r] = \\frac{1}{\\lambda}$. The integral we need to evaluate is related to this.\n$$E[r] = \\int_{0}^{\\infty} r p(r) dr = \\int_{0}^{\\infty} r (\\lambda \\exp(-\\lambda r)) dr = \\lambda \\int_{0}^{\\infty} r \\exp(-\\lambda r) dr$$\nSince $E[r] = \\frac{1}{\\lambda}$, we have:\n$$\\frac{1}{\\lambda} = \\lambda \\int_{0}^{\\infty} r \\exp(-\\lambda r) dr$$\n$$\\implies \\int_{0}^{\\infty} r \\exp(-\\lambda r) dr = \\frac{1}{\\lambda^2}$$\n\nNow we substitute this result back into the expression for the average critical area $\\langle A_c \\rangle$:\n$$\\langle A_c \\rangle = 2 L \\lambda \\left( \\frac{1}{\\lambda^2} \\right) = \\frac{2L}{\\lambda}$$\n\nNext, we calculate the mean number of fatal defects, $\\mu_f$:\n$$\\mu_f = D \\cdot \\langle A_c \\rangle = D \\cdot \\frac{2L}{\\lambda} = \\frac{2DL}{\\lambda}$$\n\nFinally, we substitute this expression for $\\mu_f$ into the formula for the yield, $Y$:\n$$Y = \\exp(-\\mu_f) = \\exp\\left(-\\frac{2DL}{\\lambda}\\right)$$\n\nThis is the analytic expression for the defect-limited yield as a function of the given parameters $D$, $L$, and $\\lambda$.",
            "answer": "$$\n\\boxed{\\exp\\left(-\\frac{2DL}{\\lambda}\\right)}\n$$"
        },
        {
            "introduction": "While catastrophic defects like opens and shorts are a major concern, they are not the only source of yield loss. This exercise explores how to create a more complete picture by modeling both catastrophic failures and parametric variations. By treating these independent failure mechanisms separately and then combining their probabilities, you will learn to calculate the \"shipped yield\" , which is the probability a die is free from both types of flaws.",
            "id": "4117703",
            "problem": "A logic die at advanced node is analyzed for random defects and parametric screening. Assume the following physically motivated bases.\n\n- Spatially random killer defects that cause catastrophic open circuits are modeled as a homogeneous Poisson point process over the die. If the expected number of open-causing defect hits per die from critical area analysis is $\\lambda$, then the probability of observing zero such hits on a die is $\\exp(-\\lambda)$.\n- Critical area analysis has been performed, aggregating layer-by-layer contributions and integrating over the defect size distribution to obtain a per-die expected count of open-causing hits of $\\lambda = 0.25$.\n- Contact resistance $R$ (in $\\Omega$) of a single contact follows a lognormal distribution: $\\ln R \\sim \\mathcal{N}(\\mu,\\sigma^{2})$ with parameters $\\mu = \\ln(10)$ and $\\sigma = 0.25$. Contacts on the same die are independent and identically distributed (i.i.d.).\n- Final electrical test performs a simple screening on each die by selecting $N=2$ contacts uniformly at random and flagging the die if any selected contact has resistance above a screening threshold $R_{s} = 15\\,\\Omega$. The events associated with catastrophic open-causing random defects and with parametric screening are independent.\n\nUsing only the foundational rules of the Poisson model for catastrophic defects and basic probability for independent events together with properties of the lognormal distribution and the Cumulative Distribution Function (CDF) of the standard normal distribution, determine the shipped yield, defined as the probability that a die both has no catastrophic open-causing hits and passes the screening test.\n\nWhich of the following is the shipped yield?\n\nA) $0.779$\n\nB) $0.948$\n\nC) $0.738$\n\nD) $0.699$",
            "solution": "The problem statement has been validated and found to be scientifically grounded, well-posed, and objective. It contains all necessary information to derive a unique solution based on established principles of probability theory and semiconductor yield modeling.\n\nThe problem asks for the shipped yield, which is defined as the probability that a die both has no catastrophic open-causing hits and passes the parametric screening test. Let $Y_{\\text{ship}}$ be the shipped yield. Let $E_{\\text{cat}}$ be the event that the die has zero catastrophic open-causing hits. Let $E_{\\text{screen}}$ be the event that the die passes the screening test. The shipped yield is the probability of the intersection of these two events:\n$$\nY_{\\text{ship}} = P(E_{\\text{cat}} \\cap E_{\\text{screen}})\n$$\nThe problem states that the events associated with catastrophic defects and parametric screening are independent. Therefore, the probability of the intersection is the product of their individual probabilities:\n$$\nY_{\\text{ship}} = P(E_{\\text{cat}}) \\times P(E_{\\text{screen}})\n$$\nWe will calculate each of these probabilities separately.\n\nFirst, we calculate the probability of a die having no catastrophic open-causing hits, $P(E_{\\text{cat}})$. This corresponds to the random defect yield, which we can denote as $Y_{\\text{rand}}$. The number of such defects is modeled as a Poisson process with an expected number of hits per die of $\\lambda$. The probability of observing $k$ hits is given by the Poisson probability mass function $P(k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$. The probability of observing zero hits ($k=0$) is:\n$$\nY_{\\text{rand}} = P(E_{\\text{cat}}) = P(k=0) = \\frac{\\lambda^0 e^{-\\lambda}}{0!} = e^{-\\lambda}\n$$\nGiven the expected count of open-causing hits is $\\lambda = 0.25$, this yield component is:\n$$\nY_{\\text{rand}} = \\exp(-0.25) \\approx 0.77880078\n$$\n\nNext, we calculate the probability that the die passes the screening test, $P(E_{\\text{screen}})$. This is the parametric yield, which we can denote as $Y_{\\text{param}}$. The test consists of measuring the resistance of $N=2$ contacts selected uniformly at random. A die is flagged (fails the test) if *any* selected contact has a resistance $R$ greater than the screening threshold $R_s = 15\\,\\Omega$. Therefore, a die passes the test if and only if *all* selected contacts have a resistance less than or equal to the threshold.\nLet $p$ be the probability that a single, randomly chosen contact passes this test, i.e., $p = P(R \\le R_s)$. The problem states that the contacts are independent and identically distributed (i.i.d.). Thus, the probability that both of the $N=2$ selected contacts pass the test is:\n$Y_{\\text{param}} = p^N = p^2$\nTo find $Y_{\\text{param}}$, we must first calculate $p$. The contact resistance $R$ follows a lognormal distribution such that its natural logarithm, $\\ln R$, follows a normal distribution $\\mathcal{N}(\\mu, \\sigma^2)$ with parameters $\\mu = \\ln(10)$ and $\\sigma = 0.25$.\nThe probability $p$ is:\n$p = P(R \\le R_s) = P(R \\le 15)$\nSince the logarithm function is monotonically increasing, this inequality is equivalent to:\n$p = P(\\ln R \\le \\ln 15)$\nTo find this probability, we standardize the normal variable $\\ln R$. Let $Z$ be a standard normal variable, $Z \\sim \\mathcal{N}(0, 1)$. The standardization is $Z = \\frac{\\ln R - \\mu}{\\sigma}$.\n$p = P\\left(\\frac{\\ln R - \\mu}{\\sigma} \\le \\frac{\\ln 15 - \\mu}{\\sigma}\\right) = P\\left(Z \\le \\frac{\\ln 15 - \\ln 10}{0.25}\\right)$\nUsing the property of logarithms $\\ln a - \\ln b = \\ln(a/b)$:\n$p = P\\left(Z \\le \\frac{\\ln(15/10)}{0.25}\\right) = P\\left(Z \\le \\frac{\\ln(1.5)}{0.25}\\right)$\nThis probability is given by the cumulative distribution function (CDF) of the standard normal distribution, denoted by $\\Phi(z)$.\nLet's calculate the argument $z$:\n$z = \\frac{\\ln(1.5)}{0.25} \\approx \\frac{0.405465}{0.25} \\approx 1.62186$\nSo, $p = \\Phi(1.62186)$. Using a standard a normal distribution table or calculator, we find:\n$p \\approx 0.94758$\nNow we can calculate the parametric yield, $Y_{\\text{param}}$:\n$Y_{\\text{param}} = p^2 \\approx (0.94758)^2 \\approx 0.89791$\n\nFinally, we can compute the total shipped yield, $Y_{\\text{ship}}$, by multiplying the two yield components:\n$Y_{\\text{ship}} = Y_{\\text{rand}} \\times Y_{\\text{param}} \\approx 0.77880 \\times 0.89791 \\approx 0.69931$\nRounding to three decimal places, the shipped yield is $0.699$.\n\nNow we evaluate each option:\n\nA) $0.779$\nThis value is approximately equal to $Y_{\\text{rand}} = \\exp(-0.25) \\approx 0.7788$. This result would be obtained if one completely ignored the parametric screening yield, effectively assuming $Y_{\\text{param}}=1$. This is an incomplete calculation. **Incorrect**.\n\nB) $0.948$\nThis value is approximately equal to $p = P(R \\le 15) \\approx 0.9476$. This is the probability that a single contact passes the resistance test. This result would be obtained if one ignored the catastrophic defect yield ($Y_{\\text{rand}}=1$) and assumed that the screening test involved only one contact ($N=1$). This is incorrect on multiple grounds. **Incorrect**.\n\nC) $0.738$\nThis value is approximately equal to $Y_{\\text{rand}} \\times p \\approx 0.7788 \\times 0.9476 \\approx 0.7380$. This result would be obtained if one correctly calculated the catastrophic yield and the single-contact pass probability, but incorrectly assumed that only $N=1$ contact was tested for parametric screening instead of the stated $N=2$. **Incorrect**.\n\nD) $0.699$\nThis value matches our calculated shipped yield, $Y_{\\text{ship}} \\approx 0.69931$, when rounded to three decimal places. The calculation correctly combines the catastrophic Poisson yield model and the parametric yield based on the lognormal distribution for $N=2$ independent contacts. **Correct**.",
            "answer": "$$\\boxed{D}$$"
        },
        {
            "introduction": "For complex integrated circuits, deriving an analytical expression for the total critical area is often impossible, which is where computational methods become essential. This hands-on coding practice introduces stratified sampling, a powerful variance reduction technique used to make Monte Carlo-based critical area estimation more efficient. You will implement this method to see how intelligently partitioning a layout and allocating samples  leads to a more precise yield estimate with less computational work.",
            "id": "4117689",
            "problem": "Consider a rectangular integrated circuit metal layout partitioned into a finite number of disjoint strata (regions) with different line densities for the purpose of Critical Area Analysis (CAA) for random defect yield. Assume defect centers arrive uniformly at random over the layout surface, and a defect of radius $r$ causes a failure (a \"killer\" event) if its center falls within the \"sensitive area\" defined by the geometric Minkowski sum of the conductive line centerlines and a radius-$r$ disk. Under the small-defect, thin-line approximation that is widely used in semiconductor yield modeling, the sensitive area fraction in stratum $h$ is approximated by\n$p_h \\approx \\min\\{1,\\,2\\,r\\,L_h\\}$,\nwhere $L_h$ is the line length per unit area in stratum $h$ (line density), and $r$ is the defect radius, both expressed in micrometers ($\\mu\\mathrm{m}$). The sensitive area in stratum $h$ is then $A_{c,h} \\approx p_h\\,A_h$, where $A_h$ is the stratum area. Let $A_{\\text{tot}} = \\sum_{h=1}^H A_h$, $W_h = A_h/A_{\\text{tot}}$, and $p = \\sum_{h=1}^H W_h\\,p_h$ denote the overall sensitive area fraction. Sampling a defect center location corresponds to drawing a Bernoulli random variable $X$ that equals $1$ if the center falls in the sensitive area and equals $0$ otherwise.\n\nYou are to implement stratified sampling for estimating the overall sensitive area fraction $p$ and compare its variance to simple random sampling (SRS). In SRS with total sample size $n$, the estimator $\\hat{p}_{\\text{SRS}}$ is the sample mean, and its variance is $p\\,(1-p)/n$. In stratified sampling, you partition the $n$ samples into nonnegative real allocations $n_h$ across strata, with $\\sum_{h=1}^H n_h = n$, and estimate $p$ by the weighted combination of stratum sample means. The variance of the stratified estimator is\n$$\n\\operatorname{Var}(\\hat{p}_{\\text{strat}}) = \\sum_{h=1}^H \\frac{W_h^2\\,\\sigma_h^2}{n_h},\n$$\nwhere $\\sigma_h^2 = p_h\\,(1-p_h)$. The optimal (Neyman) allocation that minimizes $\\operatorname{Var}(\\hat{p}_{\\text{strat}})$ for fixed $n$ is proportional to the strata-sensitive area factor $W_h\\,\\sigma_h$, that is $n_h^\\star \\propto W_h\\,\\sigma_h$.\n\nTasks:\n- For each test case, compute $p_h$ from $L_h$ and $r$ using the given approximation, then compute $W_h$, $p$, $\\operatorname{Var}(\\hat{p}_{\\text{SRS}})$, and the optimal stratified variance $\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}})$ under the continuous optimal allocation $n_h^\\star = n\\,W_h\\,\\sigma_h/\\sum_{j=1}^H W_j\\,\\sigma_j$ (do not round $n_h^\\star$ to integers). Finally, compute the variance ratio $\\rho = \\operatorname{Var}(\\hat{p}_{\\text{strat,opt}})/\\operatorname{Var}(\\hat{p}_{\\text{SRS}})$.\n- Express all probabilities as decimal values (no percentage sign) and areas in square micrometers ($\\mu\\mathrm{m}^2$). The final outputs are dimensionless variances and ratios.\n\nYour program must produce a single line of output containing, for each test case in the order given, the triple [$\\operatorname{Var}(\\hat{p}_{\\text{SRS}})$, $\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}})$, $\\rho$] as a list of floats; aggregate all test case triples into one list printed as a comma-separated list enclosed in square brackets, for example [[$v_{1,\\text{SRS}}$, $v_{1,\\text{strat}}$, $\\rho_1$], [$v_{2,\\text{SRS}}$, $v_{2,\\text{strat}}$, $\\rho_2$]].\n\nUse the following test suite with scientifically realistic parameters. In each case, the defect radius $r$ is in micrometers ($\\mu\\mathrm{m}$), areas $A_h$ are in square micrometers ($\\mu\\mathrm{m}^2$), line densities $L_h$ are in micrometers per square micrometer ($\\mu\\mathrm{m}/\\mu\\mathrm{m}^2$), and the sample size $n$ is dimensionless.\n\n- Test case $1$: $H=3$, $r=0.02$, $A=[10000,\\,10000,\\,10000]$, $L=[1.0,\\,2.0,\\,4.0]$, $n=10000$.\n- Test case $2$: $H=4$, $r=0.01$, $A=[5000,\\,5000,\\,5000,\\,5000]$, $L=[2.0,\\,2.0,\\,2.0,\\,2.0]$, $n=8000$.\n- Test case $3$: $H=3$, $r=0.03$, $A=[40000,\\,10000,\\,5000]$, $L=[0.5,\\,4.0,\\,6.0]$, $n=5000$.\n- Test case $4$: $H=2$, $r=0.005$, $A=[20000,\\,20000]$, $L=[0.2,\\,8.0]$, $n=2000$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., [[$v_{1,\\text{SRS}}$, $v_{1,\\text{strat}}$, $\\rho_1$], [$v_{2,\\text{SRS}}$, $v_{2,\\text{strat}}$, $\\rho_2$], [$v_{3,\\text{SRS}}$, $v_{3,\\text{strat}}$, $\\rho_3$], [$v_{4,\\text{SRS}}$, $v_{4,\\text{strat}}$, $\\rho_4$]]).",
            "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded in established statistical sampling theory and semiconductor yield modeling, is well-posed with all necessary information provided, and is stated in precise, objective language. There are no contradictions, ambiguities, or factual inaccuracies.\n\nThe objective is to compute the variance of an estimator for the overall sensitive area fraction, $p$, under two different sampling schemes: Simple Random Sampling (SRS) and optimally allocated Stratified Sampling. The efficiency of stratified sampling is then quantified by the ratio of the two variances.\n\nThe analysis proceeds by applying the provided formulae in a sequential manner for each test case.\n\n**1. Stratum-Level Parameters**\n\nFor each stratum $h \\in \\{1, \\dots, H\\}$, the sensitive area fraction, $p_h$, is determined by the defect radius $r$ and the line density $L_h$. This fraction is the probability that a defect of radius $r$ with a uniformly random center location within stratum $h$ is a \"killer\" defect. It is approximated by:\n$$\np_h = \\min\\{1, 2rL_h\\}\n$$\nThe population within each stratum is modeled as a Bernoulli distribution with parameter $p_h$. The variance of this distribution for stratum $h$ is:\n$$\n\\sigma_h^2 = p_h(1-p_h)\n$$\nThe corresponding standard deviation is $\\sigma_h = \\sqrt{p_h(1-p_h)}$.\n\n**2. Overall Process Parameters**\n\nThe strata are combined to represent the entire layout. The total area of the layout is $A_{\\text{tot}} = \\sum_{h=1}^H A_h$. The weight of each stratum, $W_h$, is its fractional area:\n$$\nW_h = \\frac{A_h}{A_{\\text{tot}}}\n$$\nThe overall sensitive area fraction, $p$, is the weighted average of the stratum-level fractions:\n$$\np = \\sum_{h=1}^H W_h p_h\n$$\n\n**3. Variance of Simple Random Sampling (SRS) Estimator**\n\nUnder SRS, the entire layout is treated as a single population. A sample of size $n$ is drawn, and the estimator for $p$ is the sample mean, $\\hat{p}_{\\text{SRS}}$. The variance of this estimator is given by the standard formula for the variance of a sample mean from a Bernoulli population:\n$$\n\\operatorname{Var}(\\hat{p}_{\\text{SRS}}) = \\frac{p(1-p)}{n}\n$$\n\n**4. Variance of Optimal Stratified Sampling Estimator**\n\nIn stratified sampling, the total sample of size $n$ is allocated among the strata, with $n_h$ samples drawn from stratum $h$, where $\\sum_{h=1}^H n_h = n$. The variance of the stratified estimator, $\\hat{p}_{\\text{strat}}$, is:\n$$\n\\operatorname{Var}(\\hat{p}_{\\text{strat}}) = \\sum_{h=1}^H \\frac{W_h^2 \\sigma_h^2}{n_h}\n$$\nTo minimize this variance for a fixed total sample size $n$, Neyman allocation is used. The optimal continuous allocation, $n_h^\\star$, is proportional to $W_h \\sigma_h$:\n$$\nn_h^\\star = n \\frac{W_h \\sigma_h}{\\sum_{j=1}^H W_j \\sigma_j}\n$$\nSubstituting this optimal allocation back into the variance formula yields the minimum possible variance for the stratified estimator, $\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}})$:\n$$\n\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}}) = \\sum_{h=1}^H \\frac{W_h^2 \\sigma_h^2}{n \\frac{W_h \\sigma_h}{\\sum_{j=1}^H W_j \\sigma_j}} = \\sum_{h=1}^H \\frac{W_h \\sigma_h (\\sum_{j=1}^H W_j \\sigma_j)}{n} = \\frac{(\\sum_{j=1}^H W_j \\sigma_j) (\\sum_{h=1}^H W_h \\sigma_h)}{n}\n$$\nThis simplifies to a more elegant and computationally efficient form:\n$$\n\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}}) = \\frac{1}{n} \\left( \\sum_{h=1}^H W_h \\sigma_h \\right)^2\n$$\n\n**5. Variance Ratio**\n\nFinally, the relative efficiency of optimal stratified sampling compared to SRS is measured by the ratio of their variances:\n$$\n\\rho = \\frac{\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}})}{\\operatorname{Var}(\\hat{p}_{\\text{SRS}})}\n$$\nA value of $\\rho  1$ indicates that stratified sampling is more efficient (i.e., provides a more precise estimate for the same total sample size). By the Cauchy-Schwarz inequality, it can be proven that $\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}}) \\le \\operatorname{Var}(\\hat{p}_{\\text{SRS}})$, so we expect $\\rho \\le 1$. Equality holds if and only if the strata are homogeneous with respect to the quantity of interest, which in this case means $\\sigma_h$ is constant across all strata, or if the Neyman allocation proportions $W_h\\sigma_h/\\sum_j W_j\\sigma_j$ happen to equal the stratum weights $W_h$. The latter occurs when $\\sigma_h$ is constant.\n\nThe following computational procedure is applied to each test case to derive the required results:\n1.  Given $r$ and vectors $A$ and $L$, compute the vector of stratum probabilities $p_h$.\n2.  Compute $A_{\\text{tot}}$ and the vector of stratum weights $W_h$.\n3.  Compute the overall probability $p$.\n4.  Calculate the SRS variance $\\operatorname{Var}(\\hat{p}_{\\text{SRS}})$ using $p$ and $n$.\n5.  Compute the vector of stratum standard deviations $\\sigma_h$.\n6.  Calculate the optimal stratified sampling variance $\\operatorname{Var}(\\hat{p}_{\\text{strat,opt}})$ using $W_h$, $\\sigma_h$, and $n$.\n7.  Compute the variance ratio $\\rho$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares the variance of Simple Random Sampling (SRS) and\n    optimal Stratified Sampling estimators for critical area analysis in\n    semiconductor yield modeling.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains: (r, A, L, n)\n    # r: defect radius (um)\n    # A: list of stratum areas (um^2)\n    # L: list of line densities (um/um^2)\n    # n: total sample size\n    test_cases = [\n        (0.02, [10000., 10000., 10000.], [1.0, 2.0, 4.0], 10000),\n        (0.01, [5000., 5000., 5000., 5000.], [2.0, 2.0, 2.0, 2.0], 8000),\n        (0.03, [40000., 10000., 5000.], [0.5, 4.0, 6.0], 5000),\n        (0.005, [20000., 20000.], [0.2, 8.0], 2000),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        r, A_list, L_list, n = case\n        \n        # Convert lists to NumPy arrays for vectorized operations\n        A_h = np.array(A_list, dtype=float)\n        L_h = np.array(L_list, dtype=float)\n\n        # Step 1: Compute stratum sensitive area fractions, p_h\n        # p_h = min(1, 2*r*L_h)\n        p_h = np.minimum(1.0, 2.0 * r * L_h)\n\n        # Step 2: Compute total area and stratum weights, W_h\n        # A_tot = sum(A_h)\n        # W_h = A_h / A_tot\n        A_tot = np.sum(A_h)\n        W_h = A_h / A_tot\n\n        # Step 3: Compute overall sensitive area fraction, p\n        # p = sum(W_h * p_h)\n        p = np.sum(W_h * p_h)\n\n        # Step 4: Compute variance of the SRS estimator\n        # Var(p_srs) = p * (1 - p) / n\n        var_srs = p * (1.0 - p) / n\n\n        # Step 5: Compute stratum standard deviations, sigma_h\n        # sigma_h = sqrt(p_h * (1 - p_h))\n        # Add a small epsilon to prevent sqrt of negative due to floating point error if p_h is 1.0\n        sigma_h = np.sqrt(p_h * (1.0 - p_h) + 1e-18)\n\n        # Step 6: Compute variance of the optimal stratified estimator\n        # Var(p_strat_opt) = (sum(W_h * sigma_h))^2 / n\n        sum_W_sigma = np.sum(W_h * sigma_h)\n        var_strat_opt = (sum_W_sigma**2) / n\n\n        # Step 7: Compute the variance ratio, rho\n        # rho = Var(p_strat_opt) / Var(p_srs)\n        # Handle the case where var_srs is zero (p=0 or p=1), which implies all p_h\n        # are identical (0 or 1), making var_strat_opt also zero. In this case,\n        # there is no variance to reduce, so the \"gain\" is neutral, ratio is 1.\n        if var_srs > 0:\n            rho = var_strat_opt / var_srs\n        else:\n            rho = 1.0\n            \n        all_results.append([var_srs, var_strat_opt, rho])\n\n    # Final print statement in the exact required format.\n    # e.g., [[v1_srs, v1_strat, rho1], [v2_srs, v2_strat, rho2]]\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}