{
    "hands_on_practices": [
        {
            "introduction": "在构建任何代理模型之前，了解其复杂性至关重要。对于多项式混沌展开（PCE），基函数的数量直接影响计算成本，并由输入维度和多项式阶数决定。本练习  提供了利用组合学原理推导这一基本关系的第一手实践，这是为半导体过程建模等应用设计高效PCE模型的关键第一步。",
            "id": "4128836",
            "problem": "为光刻胶中的线边缘粗糙度构建了一个计算光刻代理模型，该模型被建模为 $d$ 个统计上独立的标准化工艺输入的函数：曝光剂量、离焦、掩模偏置、数值孔径、光刻胶厚度和曝光后烘烤时间，因此 $d=6$。正在考虑两种代理建模方法：高斯过程回归 (GPR) 和多项式混沌展开 (PCE)。对于PCE，选择了一个与边际输入分布一致的正交归一基，并施加了阶数为 $p$ 的总次数截断，这意味着所有总次数小于或等于 $p$ 的多元多项式基函数都被保留。\n\n从组合计数的第一性原理出发，仅从 $d$ 个变量的多元单项式形式为 $x^{\\boldsymbol{\\alpha}}=\\prod_{i=1}^{d}x_{i}^{\\alpha_{i}}$（其中多重索引 $\\boldsymbol{\\alpha}\\in\\mathbb{N}_{0}^{d}$，总次数为 $\\lvert\\boldsymbol{\\alpha}\\rvert=\\sum_{i=1}^{d}\\alpha_{i}$）的定义开始，推导出一个封闭形式的表达式，用于计算总次数最多为 $p$ 的 $d$ 个变量的不同多元单项式的数量。然后，对于具有 $d=6$ 个输入和总次数截断阶数 $p=3$ 的光刻模型，计算这个数量。\n\n你的最终答案必须是一个整数。无需四舍五入，也无需单位。最终答案仅以一个数字表示。",
            "solution": "问题陈述经过严格验证，被认为是有效的。它在科学上植根于代理建模和组合数学领域，问题提出得当，提供了所有必要信息，并且表述客观。未发现任何缺陷。我们可以继续进行解答。\n\n问题要求完成两项任务。首先，推导一个封闭形式的表达式，用于计算总次数最多为 $p$ 的 $d$ 个变量的不同多元单项式的数量。其次，在半导体制造过程建模的一个具体应用中，当输入变量数为 $d=6$ 且总次数截断阶数为 $p=3$ 时，计算这个数量。\n\n在总次数截断阶数为 $p$ 的多项式混沌展开 (PCE) 中，基函数的数量等于形式为 $x^{\\boldsymbol{\\alpha}} = \\prod_{i=1}^{d}x_{i}^{\\alpha_{i}}$ 的不同多元单项式的数量，其中总次数 $\\lvert\\boldsymbol{\\alpha}\\rvert = \\sum_{i=1}^{d}\\alpha_{i}$ 小于或等于 $p$。多重索引 $\\boldsymbol{\\alpha}$ 是一个非负整数向量，$\\boldsymbol{\\alpha} = (\\alpha_1, \\alpha_2, \\dots, \\alpha_d) \\in \\mathbb{N}_{0}^{d}$。\n\n我们的目标是找到所有此类有效多重索引集合的基数，我们将其表示为 $N$。这等价于求解以下不等式的整数解的数量：\n$$ \\sum_{i=1}^{d} \\alpha_i \\leq p, \\quad \\text{其中 } \\alpha_i \\in \\mathbb{N}_0 \\text{ 对于 } i=1, 2, \\dots, d $$\n这是一个组合枚举问题。为了从第一性原理解决它，我们可以通过引入一个非负整数松弛变量（称之为 $\\alpha_{d+1}$）将不等式转化为等式。原始不等式等价于以下方程：\n$$ \\alpha_1 + \\alpha_2 + \\dots + \\alpha_d + \\alpha_{d+1} = p $$\n其中对于所有 $i \\in \\{1, 2, \\dots, d+1\\}$，$\\alpha_i \\geq 0$。松弛变量 $\\alpha_{d+1}$ 表示差值 $p - \\sum_{i=1}^{d} \\alpha_i$，根据原始不等式，该差值必须为非负。$d$ 个变量的不等式解集与 $d+1$ 个变量的等式解集之间存在一一对应关系。\n\n我们现在需要计算这个方程的非负整数解的数量。这是一个经典的组合问题，可以用“隔板法”来解决。想象一下，我们有 $p$ 个不可区分的物品（“星”，代表总和的单位），我们想把它们放入 $d+1$ 个可区分的箱子中（代表变量 $\\alpha_1, \\dots, \\alpha_{d+1}$）。为了将这些星分成 $d+1$ 个箱子，我们需要 $d$ 个分隔物（“隔板”）。\n\n考虑一个由 $p$ 个星和 $d$ 个隔板排列成一行的序列。例如，如果 $p=3$ 且 $d=2$（意味着有 $d+1=3$ 个箱子），一个可能的排列是 `*|**|`。这对应于解 $\\alpha_1=1, \\alpha_2=2, \\alpha_3=0$。第一个隔板前的星数是 $\\alpha_1$，第一和第二个隔板之间的星数是 $\\alpha_2$，以此类推。最后一个隔板后的星数是 $\\alpha_{d+1}$。\n\n此排列中的总位置数是星数和隔板数之和，即 $p+d$。不同的解的总数等于我们排列这 $p$ 个星和 $d$ 个隔板的方式数。这等同于从 $p+d$ 个可用位置中为 $d$ 个隔板选择位置。剩余的位置将由星填充。\n\n实现这一目标的方式数由二项式系数“p+d 中选 d”给出：\n$$ N = \\binom{p+d}{d} $$\n根据二项式系数的对称性，$\\binom{n}{k} = \\binom{n}{n-k}$，这也等于：\n$$ N = \\binom{p+d}{p} $$\n这就是总次数最多为 $p$ 的 $d$ 个变量的不同多元单项式数量的封闭形式表达式。\n\n现在，我们必须针对问题中给出的具体情况计算此表达式的值：一个具有 $d=6$ 个输入和总次数截断阶数 $p=3$ 的光刻模型。\n将这些值代入我们推导出的公式中：\n$$ N = \\binom{p+d}{d} = \\binom{3+6}{6} = \\binom{9}{6} $$\n我们可以计算这个二项式系数。使用对称形式通常更简单：\n$$ \\binom{9}{6} = \\binom{9}{9-6} = \\binom{9}{3} $$\n现在我们使用阶乘的定义展开二项式系数：\n$$ \\binom{9}{3} = \\frac{9!}{3!(9-3)!} = \\frac{9!}{3!6!} $$\n$$ \\binom{9}{3} = \\frac{9 \\times 8 \\times 7 \\times 6!}{ (3 \\times 2 \\times 1) \\times 6!} $$\n消去 $6!$ 项：\n$$ \\binom{9}{3} = \\frac{9 \\times 8 \\times 7}{3 \\times 2 \\times 1} = \\frac{504}{6} $$\n进行除法运算：\n$$ \\binom{9}{3} = 3 \\times 4 \\times 7 = 12 \\times 7 = 84 $$\n因此，对于一个具有 $d=6$ 个输入和总次数截断阶数 $p=3$ 的PCE模型，有 $84$ 个基函数。",
            "answer": "$$\\boxed{84}$$"
        },
        {
            "introduction": "标准回归模型通常假设噪声方差恒定（即同方差性），但在许多实际场景中，这一假设并不成立，例如在测量误差取决于信号本身的计量系统中。本练习  探讨了如何调整高斯过程模型以处理这种与输入相关的（即异方差）噪声。掌握这项技术对于根据实际实验数据构建准确可靠的代理模型至关重要，因为在实际数据中，测量精度通常并非处处相同。",
            "id": "4128838",
            "problem": "在先进的半导体制造中，光谱椭偏法和反射法通常用于薄膜厚度的计量。由于在较高光程下灵敏度降低和模型形式不确定性增加，这些测量系统通常表现出随膜厚增加而增大的方差。考虑将从可控沉积设置到测量的薄膜厚度的潜在映射建模为高斯过程 (GP)，并假设报告的计量误差方差是输入相关的。设潜在函数为 $f(x)$，其中 $x$ 表示以纳米为单位的沉积结果（薄膜厚度），测量模型为 $y_{i} = f(x_{i}) + \\epsilon_{i}$，其中 $\\epsilon_{i} \\sim \\mathcal{N}(0, g(x_{i}))$ 对所有 $i$ 独立同分布，而 $g(x)$ 是由计量系统提供的与输入相关的噪声方差。$f$ 上的 GP 先验是零均值的，其核函数为平方指数核，\n$$\nk(x, x') = \\sigma_{f}^{2} \\exp\\!\\left(-\\frac{(x - x')^{2}}{2 \\ell^{2}}\\right).\n$$\n给定在 $x_{1} = 50$ 和 $x_{2} = 150$ 纳米处的两个测量值，你需要在 $x_{\\star} = 100$ 纳米处进行预测。超参数为 $\\sigma_{f} = 20$ 和 $\\ell = 60$ 纳米。计量方差模型为\n$$\ng(x) = \\sigma_{0}^{2} + \\beta x^{2},\n$$\n其中 $\\sigma_{0} = 5$ 纳米，$\\beta = 1.0 \\times 10^{-3}$。\n\n任务：\n1. 使用多变量正态分布的基本性质和高斯过程 (GP) 的定义，解释为什么当测量方差依赖于 $x$ 时，同方差噪声假设（所有输入的方差恒定）对于薄膜厚度计量是不充分的，并说明这种假设如何错误地加权了不同厚度下数据点的似然贡献。\n2. 对于具有输入相关噪声方差 $g(x)$ 的异方差 GP，从联合高斯结构和条件化规则出发，显式推导后验预测均值和方差，不要使用快捷公式。\n3. 将你的通用结果应用于给定的两点数据集和超参数，写出在 $x_{\\star} = 100$ 纳米处后验预测方差的精确解析表达式。最终方差以 $\\mathrm{nm}^{2}$ 为单位，并以指数和给定数值超参数的闭合形式符号表达式给出。不要近似或四舍五入；请提供精确表达式。\n\n注：高斯过程 (GP) 和多项式混沌展开 (PCE) 都是代理建模方法；PCE 通常假设输入分布已知且观测值无噪声（或通过显式建模的噪声通道），而由计量驱动的输入相关噪声在使用 GP 代理模型时，则需要进行异方差似然处理。你的推导必须从多变量正态定律和 GP 定义开始，而不是从现成的 GP 回归公式开始。你的最终答案必须是如上所述的在 $x_{\\star}$ 处预测方差的单个闭合形式解析表达式。",
            "solution": "该问题陈述清晰，具有科学依据，并包含唯一解所需的所有信息。该场景是先进统计建模在半导体制造计量中的一个现实应用。所有参数和模型都已明确定义。\n\n解答过程按问题陈述的要求分为三个部分。\n\n### 第 1 部分：同方差噪声假设的不充分性\n\n高斯过程 (GP) 将潜在函数 $f(x)$ 建模为从一个函数分布中抽取的样本。观测模型将测量数据 $y_i$ 与输入 $x_i$ 处的潜在函数值 $f(x_i)$ 相关联。在本问题中，模型为 $y_i = f(x_i) + \\epsilon_i$，其中噪声项 $\\epsilon_i$ 服从分布 $\\epsilon_i \\sim \\mathcal{N}(0, g(x_i))$。关键特征是噪声方差 $g(x_i)$ 依赖于输入 $x_i$。这被称为异方差性。\n\n给定相应的潜在函数值 $\\mathbf{f} = \\{f(x_1), \\dots, f(x_N)\\}$，一组观测值 $\\mathbf{y} = \\{y_1, \\dots, y_N\\}$ 的似然由各个概率密度的乘积给出，这是因为噪声项 $\\epsilon_i$ 相互独立：\n$$\np(\\mathbf{y}|\\mathbf{f}) = \\prod_{i=1}^{N} p(y_i|f(x_i)) = \\prod_{i=1}^{N} \\frac{1}{\\sqrt{2\\pi g(x_i)}} \\exp\\left(-\\frac{(y_i - f(x_i))^2}{2 g(x_i)}\\right)\n$$\n对数似然（在模型拟合过程中通常被最大化，或构成后验概率的一部分）为：\n$$\n\\ln p(\\mathbf{y}|\\mathbf{f}) = \\sum_{i=1}^{N} \\left( -\\frac{1}{2} \\ln(2\\pi) - \\frac{1}{2}\\ln(g(x_i)) - \\frac{(y_i - f(x_i))^2}{2 g(x_i)} \\right)\n$$\n忽略常数项，对数似然中依赖于拟合的部分是 $\\sum_{i=1}^{N} \\left( -\\frac{1}{2}\\ln(g(x_i)) - \\frac{(y_i - f(x_i))^2}{2 g(x_i)} \\right)$。项 $(y_i - f(x_i))^2$ 表示第 $i$ 个数据点的残差平方。它对对数似然的贡献由 $1/(2g(x_i))$ 加权。\n\n同方差噪声假设假定所有输入的噪声方差都是恒定的，即对所有 $i$ 都有 $g(x_i) = \\sigma_n^2$。在这个不正确的假设下，对数似然项变为：\n$$\n\\sum_{i=1}^{N} \\left( -\\frac{1}{2}\\ln(\\sigma_n^2) - \\frac{(y_i - f(x_i))^2}{2 \\sigma_n^2} \\right) \\propto -\\frac{1}{2\\sigma_n^2} \\sum_{i=1}^{N} (y_i - f(x_i))^2\n$$\n在这种同方差情况下，每个残差平方 $(y_i - f(x_i))^2$ 的权重都相等。\n\n当 $g(x)$ 不是常数时，问题就出现了。在给定的半导体计量背景下，方差随膜厚 $x$ 的增加而增大。这意味着在较大厚度 $x_{\\text{high}}$ 处的测量将具有较大的方差 $g(x_{\\text{high}})$，而在较小厚度 $x_{\\text{low}}$ 处的测量将具有较小的方差 $g(x_{\\text{low}})$。\n- 对于在 $x_{\\text{low}}$ 处的精确测量，$g(x_{\\text{low}})$ 很小，因此其似然权重 $1/g(x_{\\text{low}})$ 很大。因此，GP 模型会因偏离该数据点而受到重罚，从而迫使后验更接近 $y_{\\text{low}}$。\n- 对于在 $x_{\\text{high}}$ 处的带噪测量，$g(x_{\\text{high}})$ 很大，因此其权重 $1/g(x_{\\text{high}})$ 很小。模型因偏离 $y_{\\text{high}}$ 而受到的惩罚较小，这正确地反映了其较低的确定性。\n\n同方差假设（或许使用平均方差）会为精确测量和带噪测量分配相同的权重。这错误地加权了它们的贡献：它低估了信息量大、噪声小的数据（将其视为比实际噪声更大），并高估了信息量小、噪声大的数据（将其视为比实际更精确）。这导致了一个次优且有偏的代理模型，该模型会被高厚度点的噪声“分散注意力”，而无法正确定位于低厚度点的高质量数据。\n\n### 第 2 部分：后验预测分布的推导\n\n我们从 GP 的基本定义开始。训练点处的潜在函数值集合 $\\mathbf{f} = [f(x_1), f(x_2)]^T$ 和测试点处的潜在函数值 $f_{\\star} = f(x_{\\star})$ 具有一个联合高斯先验分布。由于 GP 是零均值的，该分布为：\n$$\n\\begin{pmatrix} \\mathbf{f} \\\\ f_{\\star} \\end{pmatrix} \\sim \\mathcal{N}\\left(\n\\mathbf{0},\n\\begin{pmatrix}\nK(\\mathbf{x}, \\mathbf{x}) & K(\\mathbf{x}, x_{\\star}) \\\\\nK(x_{\\star}, \\mathbf{x}) & K(x_{\\star}, x_{\\star})\n\\end{pmatrix}\n\\right)\n$$\n其中 $\\mathbf{x} = [x_1, x_2]^T$。我们使用简写 $K = K(\\mathbf{x}, \\mathbf{x})$，$\\mathbf{k}_{\\star} = K(\\mathbf{x}, x_{\\star})$ 和 $k_{\\star\\star} = K(x_{\\star}, x_{\\star})$。\n\n观测值为 $\\mathbf{y} = \\mathbf{f} + \\mathbf{\\epsilon}$，其中噪声 $\\mathbf{\\epsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\Sigma_n)$。对于异方差噪声，$\\Sigma_n$ 是一个由输入相关方差组成的对角矩阵：$\\Sigma_n = \\mathrm{diag}(g(x_1), g(x_2))$。\n\n我们需要给定观测值 $\\mathbf{y}$ 的 $f_{\\star}$ 的后验分布，即 $p(f_{\\star}|\\mathbf{y})$。为了找到它，我们首先建立可观测量 $\\mathbf{y}$ 和待预测量 $f_{\\star}$ 的联合分布。由于 $\\mathbf{y}$ 和 $f_{\\star}$ 是联合高斯变量的线性组合，它们本身也是联合高斯的。\n$$\n\\begin{pmatrix} \\mathbf{y} \\\\ f_{\\star} \\end{pmatrix} \\sim \\mathcal{N}\\left(\n\\begin{pmatrix} \\mathbb{E}[\\mathbf{y}] \\\\ \\mathbb{E}[f_{\\star}] \\end{pmatrix},\n\\begin{pmatrix}\n\\mathrm{Cov}(\\mathbf{y}, \\mathbf{y}) & \\mathrm{Cov}(\\mathbf{y}, f_{\\star}) \\\\\n\\mathrm{Cov}(f_{\\star}, \\mathbf{y}) & \\mathrm{Cov}(f_{\\star}, f_{\\star})\n\\end{pmatrix}\n\\right)\n$$\n由于零均值 GP 先验和零均值噪声，期望为零。协方差项为：\n- $\\mathrm{Cov}(\\mathbf{y}, \\mathbf{y}) = \\mathrm{Cov}(\\mathbf{f} + \\mathbf{\\epsilon}, \\mathbf{f} + \\mathbf{\\epsilon}) = \\mathrm{Cov}(\\mathbf{f}, \\mathbf{f}) + \\mathrm{Cov}(\\mathbf{\\epsilon}, \\mathbf{\\epsilon}) = K + \\Sigma_n$，因为 $\\mathbf{f}$ 和 $\\mathbf{\\epsilon}$ 是独立的。\n- $\\mathrm{Cov}(\\mathbf{y}, f_{\\star}) = \\mathrm{Cov}(\\mathbf{f} + \\mathbf{\\epsilon}, f_{\\star}) = \\mathrm{Cov}(\\mathbf{f}, f_{\\star}) = \\mathbf{k}_{\\star}$。\n- $\\mathrm{Cov}(f_{\\star}, f_{\\star}) = k_{\\star\\star}$。\n\n因此，联合分布是：\n$$\n\\begin{pmatrix} \\mathbf{y} \\\\ f_{\\star} \\end{pmatrix} \\sim \\mathcal{N}\\left(\n\\mathbf{0},\n\\begin{pmatrix}\nK + \\Sigma_n & \\mathbf{k}_{\\star} \\\\\n\\mathbf{k}_{\\star}^T & k_{\\star\\star}\n\\end{pmatrix}\n\\right)\n$$\n使用多变量正态分布的条件化标准公式，如果 $\\begin{pmatrix} \\mathbf{z}_1 \\\\ \\mathbf{z}_2 \\end{pmatrix} \\sim \\mathcal{N}\\left( \\begin{pmatrix} \\mathbf{\\mu}_1 \\\\ \\mathbf{\\mu}_2 \\end{pmatrix}, \\begin{pmatrix} \\Sigma_{11} & \\Sigma_{12} \\\\ \\Sigma_{21} & \\Sigma_{22} \\end{pmatrix} \\right)$，则条件分布 $p(\\mathbf{z}_2|\\mathbf{z}_1)$ 是高斯分布，其均值为 $\\bar{\\mathbf{\\mu}}_2 = \\mathbf{\\mu}_2 + \\Sigma_{21} \\Sigma_{11}^{-1} (\\mathbf{z}_1 - \\mathbf{\\mu}_1)$，协方差为 $\\bar{\\Sigma}_{22} = \\Sigma_{22} - \\Sigma_{21} \\Sigma_{11}^{-1} \\Sigma_{12}$。\n\n将此应用于我们的情况，其中 $\\mathbf{z}_1 = \\mathbf{y}$ 和 $\\mathbf{z}_2 = f_{\\star}$（且均值为零），我们得到后验预测分布 $p(f_{\\star}|\\mathbf{y}) = \\mathcal{N}(\\bar{f}_{\\star}, \\mathbb{V}[f_{\\star}])$，其中：\n- 后验预测均值：$\\bar{f}_{\\star} = \\mathbf{k}_{\\star}^T (K + \\Sigma_n)^{-1} \\mathbf{y}$\n- 后验预测方差：$\\mathbb{V}[f_{\\star}] = k_{\\star\\star} - \\mathbf{k}_{\\star}^T (K + \\Sigma_n)^{-1} \\mathbf{k}_{\\star}$\n\n这些是具有异方差噪声的 GP 的通用公式。\n\n### 第 3 部分：后验预测方差的解析表达式\n\n我们现在将方差公式应用于给定数据。方差的单位是 $\\mathrm{nm}^2$。\n**给定数据：**\n- 训练点：$x_1 = 50$, $x_2 = 150$\n- 测试点：$x_{\\star} = 100$\n- 超参数：$\\sigma_f = 20$, $\\ell = 60$\n- 噪声参数：$\\sigma_0 = 5$, $\\beta = 1.0 \\times 10^{-3}$\n\n**1. 计算核矩阵 $K$：**\n核函数为 $k(x, x') = 20^2 \\exp\\left(-\\frac{(x - x')^2}{2 \\cdot 60^2}\\right) = 400 \\exp\\left(-\\frac{(x - x')^2}{7200}\\right)$。\n$K_{11} = k(50, 50) = 400$。\n$K_{22} = k(150, 150) = 400$。\n$K_{12} = K_{21} = k(50, 150) = 400 \\exp\\left(-\\frac{(50-150)^2}{7200}\\right) = 400 \\exp\\left(-\\frac{10000}{7200}\\right) = 400 \\exp\\left(-\\frac{25}{18}\\right)$。\n$$ K = \\begin{pmatrix} 400 & 400 \\exp(-\\frac{25}{18}) \\\\ 400 \\exp(-\\frac{25}{18}) & 400 \\end{pmatrix} $$\n\n**2. 计算噪声协方差矩阵 $\\Sigma_n$：**\n噪声方差为 $g(x) = 5^2 + (1.0 \\times 10^{-3}) x^2 = 25 + 0.001 x^2$。\n$g(x_1) = g(50) = 25 + 0.001(50^2) = 25 + 2.5 = 27.5$。\n$g(x_2) = g(150) = 25 + 0.001(150^2) = 25 + 22.5 = 47.5$。\n$$ \\Sigma_n = \\begin{pmatrix} 27.5 & 0 \\\\ 0 & 47.5 \\end{pmatrix} $$\n\n**3. 计算核向量 $\\mathbf{k}_{\\star}$ 和标量 $k_{\\star\\star}$：**\n$k(x_1, x_{\\star}) = k(50, 100) = 400 \\exp\\left(-\\frac{(50-100)^2}{7200}\\right) = 400 \\exp\\left(-\\frac{2500}{7200}\\right) = 400 \\exp\\left(-\\frac{25}{72}\\right)$。\n$k(x_2, x_{\\star}) = k(150, 100) = 400 \\exp\\left(-\\frac{(150-100)^2}{7200}\\right) = 400 \\exp\\left(-\\frac{2500}{7200}\\right) = 400 \\exp\\left(-\\frac{25}{72}\\right)$。\n$$ \\mathbf{k}_{\\star} = \\begin{pmatrix} 400 \\exp(-\\frac{25}{72}) \\\\ 400 \\exp(-\\frac{25}{72}) \\end{pmatrix} $$\n$k_{\\star\\star} = k(100, 100) = 400$。\n\n**4. 组装并计算方差：**\n我们需要计算 $\\mathbb{V}[f_{\\star}] = k_{\\star\\star} - \\mathbf{k}_{\\star}^T (K + \\Sigma_n)^{-1} \\mathbf{k}_{\\star}$。\n首先，求 $M = K + \\Sigma_n$：\n$$ M = \\begin{pmatrix} 400+27.5 & 400 \\exp(-\\frac{25}{18}) \\\\ 400 \\exp(-\\frac{25}{18}) & 400+47.5 \\end{pmatrix} = \\begin{pmatrix} 427.5 & 400 \\exp(-\\frac{25}{18}) \\\\ 400 \\exp(-\\frac{25}{18}) & 447.5 \\end{pmatrix} $$\n我们来对这个 $2 \\times 2$ 矩阵 $M = \\begin{pmatrix} a & c \\\\ c & b \\end{pmatrix}$求逆：$M^{-1} = \\frac{1}{ab-c^2} \\begin{pmatrix} b & -c \\\\ -c & a \\end{pmatrix}$。\n二次型 $\\mathbf{k}_{\\star}^T M^{-1} \\mathbf{k}_{\\star}$，其中 $\\mathbf{k}_{\\star} = [k_s, k_s]^T$，为：\n$$ \\mathbf{k}_{\\star}^T M^{-1} \\mathbf{k}_{\\star} = \\frac{1}{ab-c^2} \\begin{pmatrix} k_s & k_s \\end{pmatrix} \\begin{pmatrix} b & -c \\\\ -c & a \\end{pmatrix} \\begin{pmatrix} k_s \\\\ k_s \\end{pmatrix} = \\frac{k_s^2(a+b-2c)}{ab-c^2} $$\n代入数值：\n- $a = 427.5$\n- $b = 447.5$\n- $c = 400 \\exp(-\\frac{25}{18})$\n- $k_s = 400 \\exp(-\\frac{25}{72})$\n二次项是：\n$$ \\frac{(400 \\exp(-\\frac{25}{72}))^2 (427.5 + 447.5 - 2 \\cdot 400 \\exp(-\\frac{25}{18}))}{(427.5)(447.5) - (400 \\exp(-\\frac{25}{18}))^2} $$\n简化数值部分：\n- $(400 \\exp(-\\frac{25}{72}))^2 = 160000 \\exp(-\\frac{50}{72}) = 160000 \\exp(-\\frac{25}{36})$\n- $427.5 + 447.5 = 875$\n- $(427.5)(447.5) = 191306.25$\n- $(400 \\exp(-\\frac{25}{18}))^2 = 160000 \\exp(-\\frac{50}{18}) = 160000 \\exp(-\\frac{25}{9})$\n二次项变为：\n$$ \\frac{160000 \\exp(-\\frac{25}{36}) (875 - 800 \\exp(-\\frac{25}{18}))}{191306.25 - 160000 \\exp(-\\frac{25}{9})} $$\n最后，后验预测方差为 $\\mathbb{V}[f_{\\star}] = k_{\\star\\star} - (\\text{二次项})$。\n$$ \\mathbb{V}[f_{\\star}] = 400 - \\frac{160000 \\exp(-\\frac{25}{36}) (875 - 800 \\exp(-\\frac{25}{18}))}{191306.25 - 160000 \\exp(-\\frac{25}{9})} $$\n这就是后验预测方差的精确解析表达式，单位为 $\\mathrm{nm}^2$。",
            "answer": "$$\n\\boxed{400 - \\frac{160000 \\exp(-\\frac{25}{36}) \\left(875 - 800 \\exp(-\\frac{25}{18})\\right)}{191306.25 - 160000 \\exp(-\\frac{25}{9})}}\n$$"
        },
        {
            "introduction": "代理模型的一个关键应用是不确定性量化，特别是将输入变量的变异性通过模型传播以预测输出的不确定性。虽然这通常通过采样完成，但这个高级练习  演示了如何对具有特定核函数和高斯输入的高斯过程模型进行解析计算。此推导过程深入揭示了模型结构与输入分布之间的相互作用，展示了如何使用高斯过程进行精确的矩传播——这也是多项式混沌展开方法的核心任务之一。",
            "id": "4128852",
            "problem": "一个半导体制造团队使用高斯过程（GP）代理模型来为预测性控制建模，该模型将光刻后关键尺寸表达为可控输入和环境输入的函数。设 $f(x)$ 表示在输入 $x \\in \\mathbb{R}^{d}$ 处的潜在关键尺寸响应，其中 $x$ 收集了例如曝光剂量、焦距、光刻胶烘烤时间和蚀刻持续时间等变量。该代理模型使用一个零均值高斯过程（GP）先验，其平方指数协方差核为\n$$\nk(x,x') \\;=\\; \\sigma_{f}^{2} \\,\\exp\\!\\Big(-\\tfrac{1}{2}\\,(x-x')^{\\top}\\Lambda^{-1}(x-x')\\Big),\n$$\n其中 $\\sigma_{f}^{2} > 0$ 是过程方差，$\\Lambda = \\operatorname{diag}(\\ell_{1}^{2},\\dots,\\ell_{d}^{2})$ 是平方长度尺度的对角矩阵。训练数据 $\\{(x_{i},y_{i})\\}_{i=1}^{n}$ 由输入 $x_{i} \\in \\mathbb{R}^{d}$ 和带噪声的测量值 $y_{i} = f(x_{i}) + \\varepsilon_{i}$ 组成，其中 $\\varepsilon_{i} \\sim \\mathcal{N}(0,\\sigma_{n}^{2})$ 且相互独立。定义 $n \\times n$ 的核矩阵 $K$，$K_{ij} = k(x_{i},x_{j})$，正则化矩阵 $K_{y} = K + \\sigma_{n}^{2} I_{n}$，并令 $W = \\Lambda^{-1}$。在一个新的晶圆批次中，由于晶圆间和批次内的变异性以及计量偏差，待预测的输入 $x$ 是不确定的，建模为 $x \\sim \\mathcal{N}(\\mu_{x},\\Sigma_{x})$，其中 $\\mu_{x} \\in \\mathbb{R}^{d}$ 和正定矩阵 $\\Sigma_{x} \\in \\mathbb{R}^{d \\times d}$ 已知。\n\n仅从高斯过程回归、全期望定律和全方差定律的定义出发，并使用上面指定的平方指数核，解析地将输入不确定性 $x \\sim \\mathcal{N}(\\mu_{x},\\Sigma_{x})$ 传播通过GP后验，以推导前两阶矩 $\\mathbb{E}[f(x)\\mid X,y]$ 和 $\\operatorname{Var}[f(x)\\mid X,y]$ 的闭式表达式，表达式应以 $X=\\{x_{i}\\}_{i=1}^{n}$、$y \\in \\mathbb{R}^{n}$、$\\sigma_{f}^{2}$、$\\sigma_{n}^{2}$、$\\Lambda$、$\\mu_{x}$ 和 $\\Sigma_{x}$ 表示。你的推导必须是自洽的，并展示从这些基础出发的每一步推理，包括所需的指数化二次型的多元高斯积分。明确使用矩阵和向量符号以及任何必要的求和来表达你的结果；为简洁起见，你可以使用 $A = K_{y}^{-1}$ 和 $\\alpha = A y$。简要论证所获得的矩公式如何与基于高斯输入测度构建的Hermite多项式混沌展开（PCE）得到的前两阶矩相一致。\n\n将最终答案以行矩阵形式提供一个关于 $\\mathbb{E}[f(x)\\mid X,y]$ 和 $\\operatorname{Var}[f(x)\\mid X,y]$ 的单一复合解析表达式。不需要进行数值评估。如果在推导过程中引入任何辅助量，请明确定义它们。问题陈述中不得假定任何快捷公式。最终答案不得包含单位。",
            "solution": "问题是解析地推导高斯过程（GP）代理模型预测分布的前两阶矩，其中模型的输入本身是一个随机变量。问题陈述是有效的，因为它科学上基于已建立的统计理论，是适定的（提供了所有必要信息），并使用了客观、正式的语言。我们开始进行推导。\n\n令训练数据表示为 $\\mathcal{D} = \\{X, y\\}$，其中 $X=\\{x_{i}\\}_{i=1}^{n}$ 是 $n$ 个训练输入的集合，$y \\in \\mathbb{R}^{n}$ 是带噪声观测值的向量。根据高斯过程回归的标准理论，在新的、固定的输入点 $x$ 处，潜在函数值 $f(x)$ 的后验分布是一个高斯分布，$p(f(x) \\mid x, \\mathcal{D}) = \\mathcal{N}(f(x) \\mid \\mu(x), \\sigma^2(x))$。后验均值 $\\mu(x)$ 和方差 $\\sigma^2(x)$ 由以下公式给出：\n$$\n\\mu(x) = \\mathbb{E}[f(x) \\mid x, \\mathcal{D}] = k(X, x)^{\\top} (K + \\sigma_{n}^{2} I_{n})^{-1} y\n$$\n$$\n\\sigma^2(x) = \\operatorname{Var}[f(x) \\mid x, \\mathcal{D}] = k(x, x) - k(X, x)^{\\top} (K + \\sigma_{n}^{2} I_{n})^{-1} k(X, x)\n$$\n其中 $k(X, x)$ 是一个 $n \\times 1$ 的向量，其元素为 $[k(x_i, x)]_{i=1}^n$，$K$ 是 $n \\times n$ 的核矩阵，其中 $K_{ij}=k(x_i, x_j)$，$I_n$ 是 $n \\times n$ 的单位矩阵。使用所提供的符号 $A = K_{y}^{-1} = (K + \\sigma_{n}^{2} I_{n})^{-1}$ 和 $\\alpha = Ay$，我们可以更紧凑地写出这些表达式：\n$$\n\\mu(x) = k(X, x)^{\\top} \\alpha = \\sum_{i=1}^{n} \\alpha_i k(x_i, x)\n$$\n$$\n\\sigma^2(x) = k(x, x) - k(X, x)^{\\top} A k(X, x)\n$$\n问题指出输入 $x$ 是不确定的，并服从高斯分布 $x \\sim \\mathcal{N}(\\mu_{x}, \\Sigma_{x})$。我们需要找到矩 $\\mathbb{E}[f(x) \\mid \\mathcal{D}]$ 和 $\\operatorname{Var}[f(x) \\mid \\mathcal{D}]$，其中期望和方差是针对 $x$ 的分布计算的。\n\n我们应用全期望定律：\n$$\n\\mathbb{E}[f(x) \\mid \\mathcal{D}] = \\mathbb{E}_{x \\sim \\mathcal{N}(\\mu_x, \\Sigma_x)} \\left[ \\mathbb{E}[f(x) \\mid x, \\mathcal{D}] \\right] = \\mathbb{E}_{x}[\\mu(x)]\n$$\n以及全方差定律：\n$$\n\\operatorname{Var}[f(x) \\mid \\mathcal{D}] = \\mathbb{E}_{x}[\\operatorname{Var}(f(x) \\mid x, \\mathcal{D})] + \\operatorname{Var}_{x}[\\mathbb{E}(f(x) \\mid x, \\mathcal{D})] = \\mathbb{E}_{x}[\\sigma^2(x)] + \\operatorname{Var}_{x}[\\mu(x)]\n$$\n\n让我们推导每一项。\n\n**1. 均值 $\\mathbb{E}[f(x) \\mid \\mathcal{D}]$ 的推导**\n\n我们需要计算 $\\mathbb{E}_{x}[\\mu(x)]$：\n$$\n\\mathbb{E}_{x}[\\mu(x)] = \\mathbb{E}_{x} \\left[ \\sum_{i=1}^{n} \\alpha_i k(x_i, x) \\right] = \\sum_{i=1}^{n} \\alpha_i \\mathbb{E}_{x}[k(x_i, x)]\n$$\n核心任务是计算核函数 $k(x_i, x)$ 关于 $x \\sim \\mathcal{N}(\\mu_x, \\Sigma_x)$ 的期望。令 $W = \\Lambda^{-1}$。\n$$\nk(x_i, x) = \\sigma_{f}^{2} \\exp\\left(-\\tfrac{1}{2}(x - x_i)^{\\top} W (x - x_i)\\right)\n$$\n期望是积分：\n$$\n\\mathbb{E}_{x}[k(x_i, x)] = \\int \\sigma_{f}^{2} \\exp\\left(-\\tfrac{1}{2}(x_i - x)^{\\top} W (x_i - x)\\right) \\mathcal{N}(x \\mid \\mu_x, \\Sigma_x) \\,dx\n$$\n我们使用两个高斯函数（一个未归一化，一个是密度函数）乘积的积分恒等式：\n$$\n\\int \\exp\\left(-\\tfrac{1}{2}(x - a)^{\\top} M (x - a)\\right) \\mathcal{N}(x \\mid b, C) \\,dx = |I + MC|^{-1/2} \\exp\\left(-\\tfrac{1}{2}(a-b)^{\\top}(M^{-1}+C)^{-1}(a-b)\\right)\n$$\n在我们的情况下，$a=x_i$，$b=\\mu_x$，$M=W=\\Lambda^{-1}$，$C=\\Sigma_x$。所以，期望是：\n$$\n\\mathbb{E}_{x}[k(x_i, x)] = \\sigma_{f}^{2} |I + W\\Sigma_x|^{-1/2} \\exp\\left(-\\tfrac{1}{2}(x_i - \\mu_x)^{\\top}(\\Lambda + \\Sigma_x)^{-1}(x_i - \\mu_x)\\right)\n$$\n让我们将这个期望核定义为 $k_{E,i} \\equiv \\mathbb{E}_{x}[k(x_i, x)]$。那么总均值为：\n$$\n\\mathbb{E}[f(x) \\mid \\mathcal{D}] = \\sum_{i=1}^{n} \\alpha_i k_{E,i}\n$$\n\n**2. 方差 $\\operatorname{Var}[f(x) \\mid \\mathcal{D}]$ 的推导**\n\n我们计算 $\\mathbb{E}_{x}[\\sigma^2(x)]$ 和 $\\operatorname{Var}_{x}[\\mu(x)]$ 这两项。\n\n首先，$\\mathbb{E}_{x}[\\sigma^2(x)]$：\n$$\n\\mathbb{E}_{x}[\\sigma^2(x)] = \\mathbb{E}_{x}[k(x,x) - k(X,x)^{\\top} A k(X,x)]\n$$\n因为 $k(x,x) = \\sigma_f^2$，所以它是常数。第二项是一个二次型：\n$$\n\\mathbb{E}_{x}[k(X,x)^{\\top} A k(X,x)] = \\mathbb{E}_{x}\\left[\\sum_{i=1}^{n}\\sum_{j=1}^{n} A_{ij} k(x_i, x) k(x_j, x)\\right] = \\sum_{i,j} A_{ij} \\mathbb{E}_{x}[k(x_i, x) k(x_j, x)]\n$$\n我们需要计算两个核函数乘积的期望，我们将其定义为 $Q_{ij} = \\mathbb{E}_{x}[k(x_i, x) k(x_j, x)]$。\n$$\nk(x_i, x) k(x_j, x) = \\sigma_f^4 \\exp\\left(-\\tfrac{1}{2}((x-x_i)^\\top W(x-x_i) + (x-x_j)^\\top W(x-x_j))\\right)\n$$\n指数的参数是 $x$ 的二次型。通过配方法，指数变为：\n$$\n-\\tfrac{1}{2} \\left[ (x-x_i)^\\top W(x-x_i) + (x-x_j)^\\top W(x-x_j) \\right] = -\\tfrac{1}{4}(x_i-x_j)^\\top W(x_i-x_j) - \\tfrac{1}{2}(x - \\bar{x}_{ij})^\\top (2W)(x - \\bar{x}_{ij})\n$$\n其中 $\\bar{x}_{ij} = \\frac{x_i+x_j}{2}$。对 $x \\sim \\mathcal{N}(\\mu_x, \\Sigma_x)$ 取期望：\n$$\nQ_{ij} = \\mathbb{E}_{x}[k(x_i, x) k(x_j, x)] = \\sigma_f^4 \\exp\\left(-\\tfrac{1}{4}(x_i-x_j)^\\top W(x_i-x_j)\\right) \\mathbb{E}_{x}\\left[\\exp\\left(-\\tfrac{1}{2}(x-\\bar{x}_{ij})^{\\top}(2W)(x-\\bar{x}_{ij})\\right)\\right]\n$$\n使用相同的高斯积分恒等式，其中 $a=\\bar{x}_{ij}$，$b=\\mu_x$，$M=2W$，$C=\\Sigma_x$：\n$$\nQ_{ij} = \\sigma_f^4 \\exp\\left(-\\tfrac{1}{4}(x_i-x_j)^\\top W(x_i-x_j)\\right) |I+2W\\Sigma_x|^{-1/2} \\exp\\left(-\\tfrac{1}{2}(\\bar{x}_{ij}-\\mu_x)^\\top((2W)^{-1}+\\Sigma_x)^{-1}(\\bar{x}_{ij}-\\mu_x)\\right)\n$$\n代入 $(2W)^{-1}=\\frac{1}{2}\\Lambda$，我们得到 $Q_{ij}$ 的最终形式。\n期望变为 $\\sum_{i,j} A_{ij} Q_{ij} = \\operatorname{tr}(A Q)$，其中 $Q$ 是元素为 $Q_{ij}$ 的矩阵。所以，\n$$\n\\mathbb{E}_{x}[\\sigma^2(x)] = \\sigma_f^2 - \\operatorname{tr}(A Q)\n$$\n\n其次，$\\operatorname{Var}_{x}[\\mu(x)]$：\n$$\n\\operatorname{Var}_{x}[\\mu(x)] = \\mathbb{E}_{x}[\\mu(x)^2] - (\\mathbb{E}_{x}[\\mu(x)])^2\n$$\n第一项是：\n$$\n\\mathbb{E}_{x}[\\mu(x)^2] = \\mathbb{E}_{x}\\left[\\left(\\sum_i \\alpha_i k(x_i,x)\\right)\\left(\\sum_j \\alpha_j k(x_j,x)\\right)\\right] = \\sum_{i,j} \\alpha_i \\alpha_j \\mathbb{E}_{x}[k(x_i,x)k(x_j,x)] = \\sum_{i,j} \\alpha_i \\alpha_j Q_{ij} = \\alpha^\\top Q \\alpha\n$$\n第二项是我们已经计算出的均值的平方：$(\\mathbb{E}_{x}[\\mu(x)])^2 = (\\sum_i \\alpha_i k_{E,i})^2$。因此，\n$$\n\\operatorname{Var}_{x}[\\mu(x)] = \\alpha^\\top Q \\alpha - \\left(\\sum_i \\alpha_i k_{E,i}\\right)^2\n$$\n\n最后，合并各分量得到总方差：\n$$\n\\operatorname{Var}[f(x) \\mid \\mathcal{D}] = \\mathbb{E}_{x}[\\sigma^2(x)] + \\operatorname{Var}_{x}[\\mu(x)] = (\\sigma_f^2 - \\operatorname{tr}(A Q)) + \\left(\\alpha^\\top Q \\alpha - \\left(\\sum_i \\alpha_i k_{E,i}\\right)^2\\right)\n$$\n\n**与多项式混沌展开（PCE）的一致性**\n\n解析矩公式与Hermite PCE方法是一致的。PCE将高斯随机变量的函数表示为正交Hermite多项式的无穷级数。该级数的系数决定了函数输出分布的矩。对于一般的GP后验均值函数 $\\mu(x)$，其PCE为 $\\mu(x) = \\sum_k c_k H_k(z)$，其中 $z$ 是与 $x$ 相关的标准正态变量。$\\mu(x)$ 的均值为 $c_0$，其方差为 $\\sum_{k=1}^\\infty c_k^2 \\mathbb{E}[H_k^2]$。我们的推导直接计算了这些矩，而没有计算系数 $c_k$。平方指数核和高斯输入分布的特殊组合使得必要的积分（高斯函数的期望）可以解析求解。这等同于找到了对GP后验均值 $\\mu(x)$ 和方差 $\\sigma^2(x)$ 进行无穷项PCE所能得到的精确矩。项 $\\operatorname{Var}_x[\\mu(x)]$ 对应于GP均值函数本身的方差，捕捉了均值预测在整个输入分布上的变化情况。项 $\\mathbb{E}_x[\\sigma^2(x)]$ 是GP的平均认知不确定性，在输入分布上取平均。因此，解析计算是PCE所形式化的不确定性传播通用原理的一个具体、精确的实例。\n\n让我们为答案框定义最终的量。\n令 $\\alpha = (K + \\sigma_n^2 I_n)^{-1} y$ 和 $A = (K + \\sigma_n^2 I_n)^{-1}$。\n令 $k_{E,i} = \\sigma_f^2|I+\\Lambda^{-1}\\Sigma_x|^{-1/2} \\exp\\left(-\\frac{1}{2}(x_i-\\mu_x)^\\top (\\Lambda+\\Sigma_x)^{-1} (x_i-\\mu_x)\\right)$。\n令 $Q$ 为一个 $n \\times n$ 矩阵，其元素 $Q_{ij}$ 定义为：\n$Q_{ij} = \\sigma_f^4 |I+2\\Lambda^{-1}\\Sigma_x|^{-1/2} \\exp\\left(-\\frac{1}{4}(x_i-x_j)^\\top \\Lambda^{-1} (x_i-x_j) - \\frac{1}{2}\\left(\\frac{x_i+x_j}{2}-\\mu_x\\right)^\\top\\left(\\frac{1}{2}\\Lambda+\\Sigma_x\\right)^{-1}\\left(\\frac{x_i+x_j}{2}-\\mu_x\\right)\\right)$。\n\n均值为 $\\mathbb{E}[f(x) \\mid X, y] = \\sum_{i=1}^n \\alpha_i k_{E,i}$。\n方差为 $\\operatorname{Var}[f(x) \\mid X, y] = \\sigma_f^2 - \\operatorname{tr}(AQ) + \\alpha^\\top Q \\alpha - \\left(\\sum_{i=1}^n \\alpha_i k_{E,i}\\right)^2$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sum_{i=1}^{n} \\alpha_i k_{E,i} & \\sigma_f^2 - \\operatorname{tr}(A Q) + \\alpha^\\top Q \\alpha - \\left(\\sum_{i=1}^{n} \\alpha_i k_{E,i}\\right)^2\n\\end{pmatrix}\n}\n$$"
        }
    ]
}