## 引言
在[半导体制造](@entry_id:187383)领域，**叠刻误差（Overlay Error）**是衡量多层电[路图](@entry_id:274599)形对准精度的核心指标，直接决定了芯片的性能、可靠性与最终良率。随着摩尔定律的持续推进，器件尺寸不断微缩，工艺流程日益复杂，对叠刻精度的控制也达到了前所未有的严苛程度。因此，深刻理解叠刻误差的来源，建立精确的数学模型对其进行分析和校正，已成为现代集成电路制造中不可或缺的关键技术。本文旨在系统性地梳理叠刻误差建模的理论与实践，解决在复杂制造环境下如何有效识别、量化并控制各种误差源的难题。

本文将分为三个核心章节，引领读者逐步深入这一领域。首先，在“**原理与机制**”部分，我们将从第一性原理出发，建立叠刻误差的数学框架，详细阐述如何通过[仿射模型](@entry_id:143914)将复杂的误差场分解为具有物理意义的组分，并介绍处理[非线性](@entry_id:637147)效应、分层结构以及测量噪声的先进建模方法。接下来，“**应用与跨学科联系**”章节将展示这些理论在真实生产环境中的强大应用，包括如何通过模型驱动先进[过程控制](@entry_id:271184)（APC）来提升良率，如何为EUV、[多重图](@entry_id:261576)形化等尖端技术量身定制分析策略，并探讨其核心思想在3D集成乃至其他科学领域的延伸。最后，“**动手实践**”部分将通过一系列精心设计的计算问题，帮助读者将理论知识转化为解决实际工程问题的能力。通过这一完整的学习路径，读者将能够全面掌握叠刻[误差分析](@entry_id:142477)与控制的精髓。

## 原理与机制

### 叠刻误差的[基本表示](@entry_id:157678)

在[半导体制造](@entry_id:187383)中，**叠刻误差（Overlay Error）** 被定义为后续工艺层上形成的图形相对于先前层上参考图形的位置偏差。这是一个矢量场，描述了在晶圆的每一个点上，实际形成的图形位置 $\mathbf{x}'$ 与其设计目标位置 $\mathbf{x}$ 之间的差异。该矢量位移场 $\mathbf{u}(\mathbf{x})$ 是所有后续分析的基础：

$$
\mathbf{u}(\mathbf{x}) = \mathbf{x}' - \mathbf{x}
$$

为了精确地建模和测量叠刻误差，我们必须考虑在整个工艺流程中涉及的多个坐标系。一个典型的场景涉及至少三个坐标系：光刻机中用于定义设计图形的**掩模版坐标系 (Reticle Frame)**，图形最终被制造于其上的**晶圆坐标系 (Wafer Frame)**，以及用于测量叠刻误差的量测设备所使用的**量测台坐标系 (Stage Frame)** 。

从设计到最终测量的完整过程可以被看作是一系列坐标[变换的复合](@entry_id:149828)。假设一个[设计点](@entry_id:748327)在掩模版坐标系 $R$ 中的坐标为 $\mathbf{r} \in \mathbb{R}^2$。第一层和第二层光刻工艺分别通过不同的（或相同的）[光刻](@entry_id:158096)机完成。在局部范围内，我们可以近似地认为每次[光刻](@entry_id:158096)都是一个从掩模版坐标系 $R$到晶圆坐标系 $W$ 的**[仿射变换](@entry_id:144885) (affine transformation)**。因此，对于第 $i$ 层（$i \in \{1, 2\}$），其在晶圆上实现的位置 $\mathbf{w}_i$ 可以由一个[可逆线性变换](@entry_id:149915)矩阵 $\mathbf{M}_i \in \mathbb{R}^{2 \times 2}$ 和一个平移向量 $\mathbf{b}_i \in \mathbb{R}^2$ 来描述：

$$
\mathbf{w}_i(\mathbf{r}) = \mathbf{M}_i \mathbf{r} + \mathbf{b}_i
$$

$\mathbf{M}_i$ 矩阵捕捉了诸如放大、旋转和切变等线性畸变，而 $\mathbf{b}_i$ 则代表了整体的平移。

除了光刻机本身引入的几何偏差，工艺过程中的物理效应也会对叠刻误差产生影响。例如，在第一层和第二层工艺之间，晶圆可能会经历[热处理](@entry_id:159161)，导致均匀的平面内**[热膨胀](@entry_id:137427)**。如果这个效应导致第二层图形相对于第一层在晶圆坐标系中被[均匀缩放](@entry_id:267671)了一个因子 $\alpha$，那么在测量时，第二层图形的实际位置向量将变为 $\alpha \mathbf{w}_2(\mathbf{r})$ 。因此，在测量时刻，晶圆坐标系中两层图形的实际位置分别为：

$$
\mathbf{w}_{1,meas}(\mathbf{r}_0) = \mathbf{M}_1 \mathbf{r}_0 + \mathbf{b}_1
$$
$$
\mathbf{w}_{2,meas}(\mathbf{r}_0) = \alpha (\mathbf{M}_2 \mathbf{r}_0 + \mathbf{b}_2)
$$

其中 $\mathbf{r}_0$ 是我们关心的特定设计目标点。这两者在晶圆坐标系中的物理差异构成了晶圆级叠刻误差 $\mathbf{o}_W(\mathbf{r}_0) = \mathbf{w}_{2,meas}(\mathbf{r}_0) - \mathbf{w}_{1,meas}(\mathbf{r}_0)$。

然而，我们无法直接在晶圆坐标系中进行测量。叠刻误差的测量是在量测设备的台坐标系 $S$ 中进行的。晶圆坐标系 $W$ 和台坐标系 $S$ 之间的关系通常可以建模为一个[刚体变换](@entry_id:150396)，即一个旋转和可能的[均匀缩放](@entry_id:267671)（由一个带缩放的[正交矩阵](@entry_id:169220) $\mathbf{Q}$ 表示）加上一个平移（由向量 $\mathbf{t}$ 表示）。因此，晶圆上的一个点 $\mathbf{w}$ 在台坐标系中的测量结果为 $\mathbf{s} = \mathbf{Q} \mathbf{w} + \mathbf{t}$。

根据定义，最终测得的叠刻误差是第二层和第一层特征在台坐标系中的位置之差（遵循“第二层减第一层”的惯例）：

$$
\mathbf{o}_S(\mathbf{r}_0) = \mathbf{s}_2(\mathbf{r}_0) - \mathbf{s}_1(\mathbf{r}_0) = (\mathbf{Q} \mathbf{w}_{2,meas}(\mathbf{r}_0) + \mathbf{t}) - (\mathbf{Q} \mathbf{w}_{1,meas}(\mathbf{r}_0) + \mathbf{t})
$$

值得注意的是，量测台的平移向量 $\mathbf{t}$ 在相减过程中被消除了，因为它对两个测量点施加了共同的偏移。这揭示了一个基本原理：**叠刻误差作为一个差分矢量，对于测量系统的公共平移是不变的**。最终，测得的叠刻误差向量是在晶圆坐标系中的物理差异经过 $\mathbf{Q}$ 变换后的结果：

$$
\mathbf{o}_S(\mathbf{r}_0) = \mathbf{Q}(\mathbf{w}_{2,meas}(\mathbf{r}_0) - \mathbf{w}_{1,meas}(\mathbf{r}_0)) = \mathbf{Q} \Big[ \alpha (\mathbf{M}_2 \mathbf{r}_0 + \mathbf{b}_2) - (\mathbf{M}_1 \mathbf{r}_0 + \mathbf{b}_1) \Big]
$$

通过重新组合，我们可以得到一个关于设计坐标 $\mathbf{r}_0$ 的仿射表达式：

$$
\mathbf{o}_S(\mathbf{r}_0) = \mathbf{Q} (\alpha \mathbf{M}_2 - \mathbf{M}_1) \mathbf{r}_0 + \mathbf{Q} (\alpha \mathbf{b}_2 - \mathbf{b}_1)
$$

这个公式清晰地展示了最终测得的叠刻误差是如何由各层[光刻](@entry_id:158096)工具的特性 ($\mathbf{M}_i, \mathbf{b}_i$)、工艺引入的效应 ($\alpha$) 以及量测系统的坐标系 ($\mathbf{Q}$) 共同决定的。

### 叠刻误差来源的分解：[仿射模型](@entry_id:143914)

上述推导表明，叠刻[误差场](@entry_id:1124647) $\mathbf{u}(\mathbf{x})$ 在局部可以用一个**[仿射模型](@entry_id:143914) (affine model)** 来近似。这个模型是分析和校正叠刻误差的基石。在晶圆坐标系中，对于给定的坐标 $\mathbf{x} = (x, y)^\top$，其叠刻误差向量 $\mathbf{u}(\mathbf{x}) = (\Delta x, \Delta y)^\top$ 可以表示为：

$$
\begin{pmatrix} \Delta x \\ \Delta y \end{pmatrix} = \begin{pmatrix} a  b \\ c  d \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix} + \begin{pmatrix} t_x \\ t_y \end{pmatrix} \quad \text{或} \quad \mathbf{u}(\mathbf{x}) = \mathbf{G}\mathbf{x} + \mathbf{t}
$$

其中，$\mathbf{t}$ 是**平移 (translation)** 向量，代表了不随位置变化的恒定偏移。$\mathbf{G}$ 是**梯度矩阵 (gradient matrix)**，描述了叠刻误差如何随位置线性变化。这个简单的[线性模型](@entry_id:178302)之所以强大，是因为梯度矩阵 $\mathbf{G}$ 可以被分解为具有明确物理解释的几个部分 。

任何一个 $2 \times 2$ 矩阵 $\mathbf{G}$ 都可以唯一地分解为一个**对称矩阵 (symmetric matrix)** $\mathbf{S}$ 和一个**[反对称矩阵](@entry_id:155998) (anti-symmetric matrix)** $\mathbf{W}$ 的和：

$$
\mathbf{G} = \mathbf{S} + \mathbf{W} = \frac{1}{2}(\mathbf{G} + \mathbf{G}^\top) + \frac{1}{2}(\mathbf{G} - \mathbf{G}^\top)
$$

其中 $\mathbf{G}^\top$ 是 $\mathbf{G}$ 的[转置](@entry_id:142115)。

反对称部分 $\mathbf{W}$ 描述了场的**旋转 (rotation)**。一个[反对称矩阵](@entry_id:155998)总可以写成 $\begin{pmatrix} 0  -\theta \\ \theta  0 \end{pmatrix}$ 的形式，它对应于一个绕原点逆时针旋转小角度 $\theta$ 的线性近似。

对称部分 $\mathbf{S}$ 描述了场的**应变 (strain)**，它可以进一步分解。$\mathbf{S}$ 的迹（对角线元素之和）对应于**各向同性放大 (isotropic magnification)**，即在所有方向上均匀的缩放。$\mathbf{S}$ 的无迹部分则描述了**切变 (shear)** 或**非正交性 (non-orthogonality)**，即 $x$ 轴和 $y$ 轴之间的夹角偏离了 $90$ 度，以及 $x$ 和 $y$ 方向上不同的[放大率](@entry_id:914447)。

综合来看，一个[仿射模型](@entry_id:143914)可以将复杂的叠刻误差场分解为四个基本的物理“旋钮”：
1.  **平移 ($t_x, t_y$)**: 整体偏移。
2.  **旋转 ($\theta$)**: 围绕中心的[刚体](@entry_id:1131033)旋转。
3.  **缩放/放大 ($m$)**: 均匀的尺寸变化。
4.  **非正交性/[各向异性缩放](@entry_id:261477)**: 不同方向上的差异性缩放或形变。

例如，一个包含平移 $(t_x, t_y)$、小角度旋转 $\theta$ 和各向同性放大 $m$ 的系统，其导致的叠刻[误差场](@entry_id:1124647)可以线性化为 ：

$$
\Delta x(x,y) = t_x + m x - \theta y
$$
$$
\Delta y(x,y) = t_y + m y + \theta x
$$

通过在晶圆上不同位置测量叠刻误差，我们就可以建立一个线性方程组，求解出这些物理参数的值。例如，通过在两个正交的位置 $\mathbf{x}_1 = (L, 0)^\top$ 和 $\mathbf{x}_2 = (0, L)^\top$ 进行测量，就可以得到四个线性方程，从而唯一地确定四个未知参数 $(t_x, t_y, \theta, m)$ 。一旦确定了这些误差参数，就可以通过在[光刻](@entry_id:158096)机上施加相反的校正（例如，输入 $-t_x, -t_y, -\theta, -m$）来系统性地减小叠刻误差。

### 层次化与高阶叠刻误差模型

虽然单一场的[仿射模型](@entry_id:143914)很有用，但现代[光刻](@entry_id:158096)工艺中的叠刻误差表现出更复杂的空间结构。一个关键的区分是**场间 (inter-field)** 误差和**场内 (intra-field)** 误差。步进扫描式[光刻](@entry_id:158096)机在晶圆上曝光一系列矩形场。误差源可以分为两类：一类是在整个晶圆尺度上缓慢变化的（如晶圆形变），另一类是在每个曝光场内部变化的（如镜头畸变）。

这启发我们建立一个**层次化模型 (hierarchical model)** 。假设晶圆上有 $N$ 个场，场心位于晶圆坐标 $\mathbf{R}_f$。在每个场内，有 $M$ 个测量点，其相对于场心的局部坐标为 $\mathbf{s}_m$。总的叠刻误差向量 $\mathbf{u}_{f,m}$ 可以近似为场间和场内贡献的线性叠加：

$$
\mathbf{u}_{f,m} \approx (\mathbf{A}_W \mathbf{R}_f + \mathbf{b}_W) + (\mathbf{A}_f \mathbf{s}_m + \mathbf{b}_f)
$$

其中，$(\mathbf{A}_W, \mathbf{b}_W)$ 是描述场间（晶圆级）误差的[仿射参数](@entry_id:260625)，而 $(\mathbf{A}_f, \mathbf{b}_f)$ 是描述第 $f$ 个场内误差的[仿射参数](@entry_id:260625)。这个模型引出了一个核心问题：**参数的可识别性 (identifiability)** 和**混淆 (confounding)**。

一个典型的混淆例子是场间平移 $\mathbf{b}_W$ 和场内平移 $\mathbf{b}_f$。在模型中，我们可以给 $\mathbf{b}_W$ 加上任意一个常数向量 $\mathbf{c}$，同时从所有的 $\mathbf{b}_f$ 中减去 $\mathbf{c}$，而总的预测值 $\mathbf{u}_{f,m}$ 保持不变。这意味着，仅凭测量数据，我们无法唯一地区分全局平移和各个场的平均平移。为了解决这个问题，必须引入一个约束，例如，强制所有场内平移的平均值为零 ($\sum_{f=1}^N \mathbf{b}_f = \mathbf{0}$) [@problem_id:4146953, statement E]。

除了仿射项，高阶[非线性](@entry_id:637147)畸变也普遍存在，尤其是在曝光场的边缘。这些畸变通常来源于镜头的[光学像差](@entry_id:163452)。一个常见的[非线性](@entry_id:637147)项是三阶径向畸变，其大小与到场中心距离的平方成正比，方向沿径向。此时，叠刻模型可以扩展为 ：

$$
\mathbf{u}(\mathbf{x}) = \mathbf{t} + \theta \begin{pmatrix} -y \\ x \end{pmatrix} + m \mathbf{x} + q (x^2+y^2) \mathbf{x}
$$

其中 $q$ 是三阶径向畸变的系数。

对于更复杂的光刻系统，如步进扫描式[光刻](@entry_id:158096)机，还存在与扫描过程相关的特定误差源。例如，掩模版台和晶圆台在扫描过程中的同步误差会导致一种随扫描方向变化的畸变。这类误差通常对于反向扫描会改变符号。通过设计特殊的实验，比如在同一片晶圆上使用正向（$+x$）和反向（$-x$）扫描曝光两次，就可以将这些误差分离开来 。如果 $\mathbf{u}_{+}$ 和 $\mathbf{u}_{-}$ 分别是两种扫描方向下的叠刻场，其中包含与扫描方向无关的“偶”分量 $\mathbf{u}_{\text{even}}$ 和与扫描方向相关的“奇”分量 $\mathbf{u}_{\text{odd}}$，则：

$$
\mathbf{u}_{+} = \mathbf{u}_{\text{even}} + \mathbf{u}_{\text{odd}}
$$
$$
\mathbf{u}_{-} = \mathbf{u}_{\text{even}} - \mathbf{u}_{\text{odd}}
$$

通过简单的代数运算，我们就可以分离这两种分量：

$$
\mathbf{u}_{\text{odd}} = \frac{\mathbf{u}_{+} - \mathbf{u}_{-}}{2} \quad \text{和} \quad \mathbf{u}_{\text{even}} = \frac{\mathbf{u}_{+} + \mathbf{u}_{-}}{2}
$$

这种分离技术对于诊断和校正扫描仪的动态性能至关重要。

### [实验设计](@entry_id:142447)与参数估计

构建了精确的物理模型后，下一步是通过实验测量来估计模型中的参数。这一步的成功不仅依赖于估计算法，更关键的是**[实验设计](@entry_id:142447) (experimental design)**，即测量点（或称“靶材”）在晶圆上的布局。

一个糟糕的[实验设计](@entry_id:142447)会导致参数混淆，使得我们无法从数据中唯一地确定它们的值。一个经典的例子是在拟合包含线性和高阶径向畸变模型时的靶材布局 。如果我们试图同时估计各向同性放大（由参数 $m$ 描述）和三阶径向畸变（由参数 $q$ 描述），而所有的测量点都位于同一个半径为 $R$ 的圆周上，那么这两个效应将变得无法区分。这是因为在这些点上，放大效应项为 $m \mathbf{x}$，而三阶畸变项为 $q R^2 \mathbf{x}$。这两个向量场在所有测量点上都具有完全相同的空间依赖性（都与位置向量 $\mathbf{x}$ 成正比），它们的贡献会合并成一个单一的项 $(m + qR^2)\mathbf{x}$。在这种情况下，描述模型的**设计矩阵 (design matrix)** 将会是“[秩亏](@entry_id:754065)”的，意味着其列向量[线性相关](@entry_id:185830)，无法求得唯一解。为了打破这种混淆，测量点必须分布在至少两个不同的半径上。

在确定了良好的测量布局后，我们可以使用**最小二乘法 (Least Squares)** 来估计模型参数。其基本思想是找到一组参数，使得模型预测值与实际测量值之间的[残差平方和](@entry_id:174395)最小。

对于最简单的情况，即测量噪声是[独立同分布](@entry_id:169067)的，我们可以使用**[普通最小二乘法](@entry_id:137121) (Ordinary Least Squares, OLS)**。在一些对称的测量布局下，[设计矩阵](@entry_id:165826)的列可能是正交的，这使得计算大大简化，[参数估计](@entry_id:139349)可以独立进行 。

然而，在现实中，测量噪声的方差往往不是恒定的，这种现象称为**[异方差性](@entry_id:895761) (heteroscedasticity)**。例如，靠近曝光场边缘的测量点可能由于焦面或照明不均而具有更大的测量不确定性。在这种情况下，[最大似然估计](@entry_id:142509)原理告诉我们应该使用**[加权最小二乘法](@entry_id:177517) (Weighted Least Squares, WLS)** 。WLS 的思想是为不同测量点赋予不同的权重，权重与其[测量噪声](@entry_id:275238)方差的倒数成正比。也就是说，测量更精确的点（方差小）在拟合中应该占有更大的话语权。

此外，实际测量数据中常常会混入一些**离群点 (outliers)**，即由于偶然的缺陷、污染物或仪器故障导致的严重偏离正常值的测量。WLS 对离群点非常敏感，因为一个具有巨大残差的离群点会被平方，从而在损失函数中占据主导地位，严重扭曲拟合结果。为了解决这个问题，需要采用**[稳健回归](@entry_id:139206) (Robust Regression)** 方法。一种常用的方法是 **M-估计 (M-estimation)**，它通过**[迭代重加权最小二乘法](@entry_id:175255) (Iteratively Reweighted Least Squares, IRLS)** 来求解 。IRLS 的核心思想是在每次迭代中，根据当前模型计算出的残差大小来动态调整每个数据点的权重。对于残差很小的“正常”点，给予其由 WLS 决定的权重；而对于残差很大的“可疑”离群点，则显著降低其权重。例如，使用 **Huber 权重函数**，当残差超过某个阈值 $\delta$ 时，其权重会与残差大小成反比，从而有效抑制离群点的影响。

### 专用量测模型与高等主题

除了校正光刻机本身，精确的叠刻[误差控制](@entry_id:169753)还要求我们理解和校正量测过程本身引入的系统误差。一个典型的例子是**工具致应偏移 (Tool-Induced Shift, TIS)**。TIS 是指由于量测工具光学系统的不完美（如照明不对称）而导致的一种恒定的测量偏移。

幸运的是，通过巧妙的测量策略，我们可以将 TIS 从真实的晶圆叠刻误差中分离出来。一种常见的方法是利用靶材的对称性。假设真实的叠刻误差中包含一个与靶材自身不对称性相关的分量，称为**晶圆致应不对称性 (Wafer-Induced Asymmetry, WIA)**。通过对测量图像进行一次“镜像”操作，可以设计出两种测量模式。在标准模式下，测得的叠刻值为 $O^+$；在镜像模式下，测得的值为 $O^-$。我们可以建立一个模型，假设 TIS 在两种模式下保持不变，而 WIA 分量则会反号 ：

$$
O_s^{+} = T + W_s + \epsilon_s^{+}
$$
$$
O_s^{-} = T - W_s + \epsilon_s^{-}
$$

其中 $T$ 是待求的 TIS，$W_s$ 是每个测量点 $s$ 特有的 WIA，$ \epsilon^{\pm}_s $ 是[测量噪声](@entry_id:275238)。通过将两个测量值相加，我们可以消除掉恼人的、随点变化的 $W_s$：

$$
S_s = O_s^{+} + O_s^{-} = 2T + (\epsilon_s^{+} + \epsilon_s^{-})
$$

现在，问题转化为从一系列有噪声的测量值 $S_s$ 中估计一个常数 $2T$。如果已知每个测量的噪声方差，最佳的估计算法（最大似然估计）是计算 $S_s/2$ 的[加权平均值](@entry_id:894528)，权重与 $S_s$ 的总方差成反比。这个过程完美地展示了如何通过[实验设计](@entry_id:142447)和建模来分离混淆的物理量。

最后，叠刻[误差控制](@entry_id:169753)正在从静态的、单批次的校正转向动态的、跨批次的**先进过程控制 (Advanced Process Control, APC)**。叠刻误差不仅在单片晶圆内变化，也会随着时间（从一个生产批次到下一个批次）发生漂移。例如，[光刻](@entry_id:158096)机镜头会因连续工作而发热，导致[放大率](@entry_id:914447)随时间缓慢变化。

为了捕捉这种动态行为，我们可以采用**状态空间模型 (state-space model)** 。在这种模型中，我们将描述叠刻误差的关键物理参数（如平移、[放大率](@entry_id:914447)、漂移率等）定义为一个随时间演化的**[状态向量](@entry_id:154607) (state vector)**。模型包含两个方程：
1.  **状态方程**: 描述状态向量如何从一个批次演化到下一个批次。例如，平移会累加上一期的漂移率。
2.  **观测方程**: 描述在给定当前状态下，我们观测到的叠刻测量值是什么。

对于线性的高斯系统（即状态演化和观测都是线性的，且所有随机噪声都服从高斯分布），**卡尔曼滤波器 (Kalman filter)** 提供了一个最优的[递归估计](@entry_id:169954)算法。卡尔曼滤波器通过一个“预测-更新”循环，在每个新的生产批次数据到来时，不断地更新对当前状态的估计，并对未来批次的状态和叠刻误差做出预测。这些预测值可以作为[前馈控制](@entry_id:153676)信号输入[光刻](@entry_id:158096)机，从而实现对时间漂移的实时补偿，将叠刻[误差控制](@entry_id:169753)在极低的水平。