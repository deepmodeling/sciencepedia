{
    "hands_on_practices": [
        {
            "introduction": "在半导体制造中，评估缺陷对良率的影响至关重要。这个练习将对比两种建模方法：一种是确定性模型，假设每个缺陷的影响是固定的；另一种是随机性模型，认为每个缺陷的影响本身是一个随机变量。通过计算在两种模型下累积影响超过容差的概率，我们可以直观地理解，考虑随机严重性对于准确评估工艺风险是多么重要。",
            "id": "4119747",
            "problem": "在一条半导体生产线中，一个关键光刻层对每片晶圆上一个面积为 $A$ 的芯片级区域内的颗粒缺陷很敏感。设缺陷密度为 $d$（缺陷/平方厘米），并假设每个芯片区域内出现的缺陷数量 $N$ 被建模为均值为 $\\lambda = dA$ 的泊松随机变量。考虑两种对缺陷严重性进行建模的方法：\n\n- 确定性严重性模型：每个缺陷恰好造成 $1$ 个影响单位，因此累积影响为 $I_{\\mathrm{det}} = N$。\n- 随机性严重性模型：每个缺陷造成一个随机的影响大小 $X_i$，在所有缺陷中独立同分布，其中 $X_i$ 服从率为 $\\beta$（单位为影响单位的倒数）的指数分布。累积影响为 $S = \\sum_{i=1}^{N} X_i$，其中当 $N=0$ 时，该和为 $0$。\n\n假设 $d = 0.6$ 缺陷/cm$^2$，$A = 2$ cm$^2$，因此 $\\lambda = dA = 1.2$。累积影响的容忍阈值为 $T = 2.5$ 影响单位，指数分布的率为 $\\beta = 2$ 影响单位的倒数。\n\n仅从 $N$ 的泊松分布、$X_i$ 的指数分布以及全概率定律的定义出发，计算以下量值：\n\n1. 在确定性严重性模型下，累积影响超过容忍阈值的概率，即 $\\mathbb{P}(I_{\\mathrm{det}} > T)$。\n2. 在随机性严重性模型下，累积影响超过容忍阈值的概率，即 $\\mathbb{P}(S > T)$。\n\n以小数形式报告这两个概率。将您的答案四舍五入到四位有效数字。",
            "solution": "问题要求在两种不同的建模假设（确定性模型和随机性模型）下，计算累积影响分数超过容忍阈值的概率。我们已知以下参数：\n- 缺陷密度，$d = 0.6 \\, \\text{缺陷/cm}^2$。\n- 芯片级区域面积，$A = 2 \\, \\text{cm}^2$。\n- 缺陷数量 $N$ 服从均值为 $\\lambda = dA = (0.6)(2) = 1.2$ 的泊松分布。其概率质量函数 (PMF) 为 $\\mathbb{P}(N=k) = \\frac{\\lambda^k e^{-\\lambda}}{k!} = \\frac{(1.2)^k e^{-1.2}}{k!}$，对于 $k \\in \\{0, 1, 2, ...\\}$。\n- 累积影响的容忍阈值为 $T = 2.5$ 影响单位。\n- 在随机性模型中，单个缺陷的影响大小 $X_i$ 服从率为 $\\beta = 2$（影响单位的倒数）的指数分布。其概率密度函数 (PDF) 为 $f_X(x) = \\beta e^{-\\beta x} = 2e^{-2x}$，对于 $x \\ge 0$。\n\n我们将分别处理问题的每个部分。\n\n**1. 确定性严重性模型**\n\n在此模型中，累积影响 $I_{\\mathrm{det}}$ 等于缺陷数量 $N$。\n$$I_{\\mathrm{det}} = N$$\n我们希望计算此影响超过容忍阈值 $T$ 的概率。\n$$\\mathbb{P}(I_{\\mathrm{det}} > T) = \\mathbb{P}(N > 2.5)$$\n由于缺陷数量 $N$ 必须是整数，条件 $N > 2.5$ 等价于 $N \\ge 3$。我们可以通过计算其补集 $\\mathbb{P}(N  3)$ 来计算这个概率。\n$$\\mathbb{P}(N \\ge 3) = 1 - \\mathbb{P}(N  3) = 1 - \\left[ \\mathbb{P}(N=0) + \\mathbb{P}(N=1) + \\mathbb{P}(N=2) \\right]$$\n使用 $\\lambda = 1.2$ 的泊松分布的 PMF：\n$$\\mathbb{P}(N=0) = \\frac{(1.2)^0 e^{-1.2}}{0!} = e^{-1.2}$$\n$$\\mathbb{P}(N=1) = \\frac{(1.2)^1 e^{-1.2}}{1!} = 1.2 e^{-1.2}$$\n$$\\mathbb{P}(N=2) = \\frac{(1.2)^2 e^{-1.2}}{2!} = \\frac{1.44}{2} e^{-1.2} = 0.72 e^{-1.2}$$\n将这些概率相加：\n$$\\mathbb{P}(N  3) = e^{-1.2} + 1.2 e^{-1.2} + 0.72 e^{-1.2} = (1 + 1.2 + 0.72)e^{-1.2} = 2.92 e^{-1.2}$$\n现在，我们计算最终的概率：\n$$\\mathbb{P}(I_{\\mathrm{det}} > T) = 1 - 2.92 e^{-1.2}$$\n使用数值 $e^{-1.2} \\approx 0.3011942$，我们得到：\n$$\\mathbb{P}(I_{\\mathrm{det}} > T) \\approx 1 - 2.92 \\times 0.3011942 = 1 - 0.8794869 = 0.1205131$$\n四舍五入到四位有效数字，概率为 $0.1205$。\n\n**2. 随机性严重性模型**\n\n在此模型中，累积影响 $S$ 是来自每个缺陷的随机影响之和。\n$$S = \\sum_{i=1}^{N} X_i$$\n这里，$N \\sim \\text{Poisson}(\\lambda=1.2)$ 且 $X_i \\sim \\text{Exponential}(\\beta=2)$ 是独立同分布 (i.i.d.) 的。如果 $N=0$，则和定义为 $0$。这是一个复合泊松随机变量。\n\n为了计算 $\\mathbb{P}(S > T)$，我们使用全概率定律，以缺陷数量 $N$ 为条件。\n$$\\mathbb{P}(S > T) = \\sum_{n=0}^{\\infty} \\mathbb{P}(S > T | N=n) \\mathbb{P}(N=n)$$\n让我们分析条件概率项 $\\mathbb{P}(S > T | N=n)$。\n- 如果 $n=0$，则没有缺陷，所以 $S=0$。概率 $\\mathbb{P}(S > T | N=0) = \\mathbb{P}(0 > 2.5)$ 为 $0$。\n- 如果 $n \\ge 1$，$S$ 是 $n$ 个独立同分布的指数随机变量之和，$S_n = \\sum_{i=1}^{n} X_i$。$n$ 个率参数为 $\\beta$ 的独立同分布的指数随机变量之和服从形状参数为 $n$、率参数为 $\\beta$ 的伽马分布。因此，$S_n \\sim \\text{Gamma}(n, \\beta)$。\n\n因此，求和从 $n=1$ 开始：\n$$\\mathbb{P}(S > T) = \\sum_{n=1}^{\\infty} \\mathbb{P}(\\text{Gamma}(n, \\beta) > T) \\mathbb{P}(N=n)$$\n对于整数形状参数 $n$，伽马分布的生存函数可以表示为与泊松累积分布函数 (CDF) 相关的有限和：\n$$\\mathbb{P}(\\text{Gamma}(n, \\beta) > T) = \\sum_{j=0}^{n-1} \\frac{(\\beta T)^j e^{-\\beta T}}{j!}$$\n在我们的例子中，$\\beta = 2$ 且 $T = 2.5$，所以 $\\beta T = 5$。泊松分量的概率是 $\\mathbb{P}(N=n) = \\frac{\\lambda^n e^{-\\lambda}}{n!}$，其中 $\\lambda=1.2$。\n\n将这些表达式代入求和式中：\n$$\\mathbb{P}(S > T) = \\sum_{n=1}^{\\infty} \\left( \\sum_{j=0}^{n-1} \\frac{5^j e^{-5}}{j!} \\right) \\left( \\frac{(1.2)^n e^{-1.2}}{n!} \\right)$$\n这个无穷级数没有简单的闭式表达式，必须进行数值评估。我们计算级数的各项并将它们相加，直到后续项的贡献变得可以忽略不计。\n级数的第 $n$ 项 $a_n$ 是：\n$$a_n = \\mathbb{P}(N=n) \\times \\mathbb{P}(\\text{Gamma}(n, 2) > 2.5)$$\n和为 $\\mathbb{P}(S > T) = \\sum_{n=1}^{\\infty} a_n$。\n计算前几项：\n对于 $n=1$：$a_1 = \\mathbb{P}(N=1) \\times \\mathbb{P}(\\text{Exp}(2)>2.5) = (1.2 e^{-1.2})(e^{-5}) \\approx 0.00243540$\n对于 $n=2$：$a_2 = \\mathbb{P}(N=2) \\times \\mathbb{P}(\\text{Gamma}(2,2)>2.5) = (\\frac{1.2^2}{2}e^{-1.2})(e^{-5}(1+5)) \\approx 0.00876798$\n对于 $n=3$：$a_3 = \\mathbb{P}(N=3) \\times \\mathbb{P}(\\text{Gamma}(3,2)>2.5) = (\\frac{1.2^3}{6}e^{-1.2})(e^{-5}(1+5+\\frac{5^2}{2})) \\approx 0.01081146$\n对于 $n=4$：$a_4 = \\mathbb{P}(N=4) \\times \\mathbb{P}(\\text{Gamma}(4,2)>2.5) \\approx 0.00689688$\n对于 $n=5$：$a_5 = \\mathbb{P}(N=5) \\times \\mathbb{P}(\\text{Gamma}(5,2)>2.5) \\approx 0.00274936$\n继续这个过程并将各项相加得出：\n$$\\mathbb{P}(S > T) \\approx 0.03262552$$\n四舍五入到四位有效数字，概率为 $0.03263$。\n\n随机性模型考虑了缺陷严重性的可变性，其预测的超过容忍阈值的概率（$3.26\\%$）显著低于确定性模型（$12.05\\%$）。这凸显了为风险评估选择合适模型的重要性。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.1205  0.03263 \\end{pmatrix}}$$"
        },
        {
            "introduction": "实时监控和估计关键工艺参数（如刻蚀速率）对于过程控制至关重要。本练习旨在对比两种主流的估计算法：基于确定性系统理论的Luenberger观测器，以及为随机系统设计的卡尔曼滤波器。通过推导并比较它们在含噪声系统中的稳态估计误差方差，你将量化地理解，为何在设计估计算法时，明确地对过程和测量噪声进行随机建模能够显著提升性能。",
            "id": "4119816",
            "problem": "一个单晶圆等离子体刻蚀步骤被实时监控，以估计瞬时刻蚀速率。假设真实刻蚀速率被建模为一个采样周期为 $T_{s}$ 的离散时间慢变标量状态，遵循随机游走模型\n$$\nx_{k+1} = x_{k} + w_{k}, \\quad y_{k} = x_{k} + v_{k},\n$$\n其中 $x_{k}$ 是在样本 $k$ 时的刻蚀速率，$y_{k}$ 是一个原位计量测量值，$w_{k} \\sim \\mathcal{N}(0,Q)$ 是零均值独立过程噪声，用于建模未建模的扰动和漂移，而 $v_{k} \\sim \\mathcal{N}(0,R)$ 是零均值独立测量噪声。假设 $\\{w_{k}\\}$ 和 $\\{v_{k}\\}$ 相互独立，在时间上独立，并且独立于初始条件 $x_{0}$。采样周期为 $T_{s} = 1\\,\\mathrm{min}$，方差为 $Q = (0.5\\,\\mathrm{nm/min})^{2}$ 和 $R = (2.0\\,\\mathrm{nm/min})^{2}$。\n\n为 $x_{k}$ 设计了两个估计器：\n- 一个不显式建模噪声的确定性 Luenberger 观测器 (LO)，其更新方式为\n$$\n\\hat{x}_{k+1} = \\hat{x}_{k} + L\\left(y_{k} - \\hat{x}_{k}\\right),\n$$\n其中观测器增益 $L$ 的选择是为了将无噪声误差动态的极点配置到期望的离散时间极点 $p_{d} = \\exp\\!\\left(-T_{s}/\\tau_{d}\\right)$，设计时间常数为 $\\tau_{d} = 2\\,\\mathrm{min}$。\n- 一个在给定 $(Q,R)$ 下设计的随机 Kalman 滤波器 (KF)。\n\n使用线性状态估计和协方差传播的基本原理，推导 LO 在真实噪声动态下的稳态估计误差方差，以及 KF 的稳态误差方差。然后计算这些稳态方差的比值，\n$$\n\\rho \\equiv \\frac{P_{\\mathrm{LO}}}{P_{\\mathrm{KF}}},\n$$\n作为一个无量纲数。将你计算的 $\\rho$ 的最终答案四舍五入到四位有效数字。",
            "solution": "我们从离散时间状态空间模型开始\n$$\nx_{k+1} = x_{k} + w_{k}, \\quad y_{k} = x_{k} + v_{k},\n$$\n其中 $w_{k}\\sim \\mathcal{N}(0,Q)$，$v_{k}\\sim \\mathcal{N}(0,R)$，相互独立且在时间上独立。采样周期为 $T_{s} = 1\\,\\mathrm{min}$，过程噪声方差为 $Q = (0.5\\,\\mathrm{nm/min})^{2} = 0.25\\,(\\mathrm{nm/min})^{2}$，测量噪声方差为 $R = (2.0\\,\\mathrm{nm/min})^{2} = 4.0\\,(\\mathrm{nm/min})^{2}$。\n\n确定性 Luenberger 观测器 (LO)。观测器更新为\n$$\n\\hat{x}_{k+1} = \\hat{x}_{k} + L\\left(y_{k} - \\hat{x}_{k}\\right).\n$$\n定义估计误差 $e_{k} \\equiv x_{k} - \\hat{x}_{k}$。真实动态和观测器意味着\n$$\ne_{k+1} = x_{k+1} - \\hat{x}_{k+1} = (x_{k} + w_{k}) - \\left[\\hat{x}_{k} + L\\left(y_{k} - \\hat{x}_{k}\\right)\\right]\n= (1 - L)(x_{k} - \\hat{x}_{k}) + w_{k} - L v_{k} = (1 - L)e_{k} + w_{k} - L v_{k}.\n$$\n假设 $\\{e_{k}\\}$、$\\{w_{k}\\}$ 和 $\\{v_{k}\\}$ 在稳态下是联合宽平稳的，并且 $w_{k}$ 和 $v_{k}$ 独立于 $e_{k}$，则误差方差 $P_{k} \\equiv \\mathbb{E}[e_{k}^{2}]$ 服从\n$$\nP_{k+1} = (1 - L)^{2} P_{k} + \\mathbb{E}[w_{k}^{2}] + L^{2} \\mathbb{E}[v_{k}^{2}] = (1 - L)^{2} P_{k} + Q + L^{2} R.\n$$\n在稳态时，$P_{k+1} = P_{k} = P_{\\mathrm{LO}}$，这得出\n$$\nP_{\\mathrm{LO}} = (1 - L)^{2} P_{\\mathrm{LO}} + Q + L^{2} R\n\\quad \\Longrightarrow \\quad\nP_{\\mathrm{LO}} = \\frac{Q + L^{2} R}{1 - (1 - L)^{2}},\n$$\n对于 $|1 - L|  1$，分母为正，这在 $0  L  2$ 时成立。\n\n增益 $L$ 是确定性地选择的，以配置无噪声误差动态的极点。在没有噪声的情况下，$e_{k+1} = (1 - L)e_{k}$。设计要求是一个目标极点\n$$\np_{d} = \\exp\\!\\left(-\\frac{T_{s}}{\\tau_{d}}\\right),\n$$\n因此\n$$\n1 - L = p_{d} \\quad \\Longrightarrow \\quad L = 1 - \\exp\\!\\left(-\\frac{T_{s}}{\\tau_{d}}\\right).\n$$\n当 $T_{s} = 1$ 且 $\\tau_{d} = 2$ 时，我们有\n$$\nL = 1 - \\exp\\!\\left(-\\frac{1}{2}\\right), \\quad (1 - L)^{2} = \\exp(-1), \\quad L^{2} = \\left(1 - \\exp\\!\\left(-\\frac{1}{2}\\right)\\right)^{2}.\n$$\n因此，\n$$\nP_{\\mathrm{LO}} = \\frac{Q + L^{2} R}{1 - (1 - L)^{2}} = \\frac{Q + R\\left(1 - 2\\exp\\!\\left(-\\frac{1}{2}\\right) + \\exp(-1)\\right)}{1 - \\exp(-1)}.\n$$\n代入 $Q = 0.25$ 和 $R = 4.0$，\n$$\nP_{\\mathrm{LO}} = \\frac{0.25 + 4\\left(1 - 2\\exp\\!\\left(-\\frac{1}{2}\\right) + \\exp(-1)\\right)}{1 - \\exp(-1)}.\n$$\n为了进行数值计算，使用 $\\exp(-1/2) \\approx 0.6065306597126334$ 和 $\\exp(-1) \\approx 0.36787944117144233$：\n$$\nP_{\\mathrm{LO}} \\approx \\frac{0.25 + 4\\left(1 - 2(0.6065306597126334) + 0.36787944117144233\\right)}{1 - 0.36787944117144233}\n= \\frac{0.25 + 4(0.15481812174617553)}{0.6321205588285577}\n= \\frac{0.8692724869847022}{0.6321205588285577} \\approx 1.375168827.\n$$\n\n随机 Kalman 滤波器 (KF)。对于状态转移矩阵 $F = 1$ 和测量矩阵 $H = 1$ 的标量系统，稳态先验协方差满足 $P^{-} = P + Q$，稳态 Kalman 增益为\n$$\nK = \\frac{P^{-}}{P^{-} + R} = \\frac{P + Q}{P + Q + R},\n$$\n稳态后验协方差为\n$$\nP = (1 - K) P^{-} = \\left(1 - \\frac{P + Q}{P + Q + R}\\right) (P + Q) = \\frac{R}{P + Q + R} (P + Q).\n$$\n这得出了代数 Riccati 方程\n$$\nP(P + Q + R) = R(P + Q) \\quad \\Longrightarrow \\quad P^{2} + Q P - Q R = 0.\n$$\n求解关于 $P \\ge 0$ 的二次方程得到\n$$\nP_{\\mathrm{KF}} = \\frac{-Q + \\sqrt{Q^{2} + 4 Q R}}{2}.\n$$\n代入 $Q = 0.25$ 和 $R = 4.0$，\n$$\nP_{\\mathrm{KF}} = \\frac{-0.25 + \\sqrt{0.25^{2} + 4(0.25)(4.0)}}{2}\n= \\frac{-0.25 + \\sqrt{0.0625 + 4}}{2}\n= \\frac{-0.25 + \\sqrt{\\frac{65}{16}}}{2}\n= \\frac{1}{8}\\left(\\sqrt{65} - 1\\right).\n$$\n数值上，$\\sqrt{65} \\approx 8.062257495$ 得出\n$$\nP_{\\mathrm{KF}} \\approx \\frac{1}{8}(8.062257495 - 1) \\approx 0.882782187.\n$$\n\n最后，所要求的比值为\n$$\n\\rho \\equiv \\frac{P_{\\mathrm{LO}}}{P_{\\mathrm{KF}}} \\approx \\frac{1.375168827}{0.882782187} \\approx 1.557767\\ldots\n$$\n四舍五入到四位有效数字，\n$$\n\\rho \\approx 1.558.\n$$\n因此，在指定的 $Q$ 和 $R$ 以及选择的确定性极点下，确定性 Luenberger 观测器的稳态误差方差大约是最优随机 Kalman 滤波器方差的 $1.558$ 倍。",
            "answer": "$$\\boxed{1.558}$$"
        },
        {
            "introduction": "在选择工艺模型时，我们常常面临一个权衡：是使用简单的确定性模型，还是采用更复杂的随机性模型？本练习介绍了一种强大的统计工具——似然比检验（LRT），来帮助我们做出数据驱动的决策。你将通过此方法，判断一个描述逐批（run-to-run）过程的增益是恒定的（确定性），还是随时间随机波动的（随机性），从而学习如何科学地验证模型假设并选择最适合的模型。",
            "id": "4119783",
            "problem": "考虑一个用于单输入单输出半导体制造步骤的离散逐批（run-to-run）过程模型。令测量输出序列为 $\\{y_t\\}_{t=1}^T$，已知配方/输入序列为 $\\{u_t\\}_{t=1}^T$，其中 $T$ 是一个正整数。该过程建模为 $y_t = g_t u_t + e_t$，其中 $g_t$ 是一个（可能随时间变化的）增益，$e_t$ 是测量噪声。假设噪声为高斯噪声，满足 $e_t \\stackrel{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0,\\sigma_e^2)$，并且 $\\sigma_e^2$ 已知且为正。\n\n需要比较两个竞争模型：\n- 确定性恒定增益（零假设）：$\\mathcal{H}_0: g_t = g$ 对所有 $t$ 成立，其中 $g$ 是一个未知的常数参数。\n- 随机时变增益（备择假设）：$\\mathcal{H}_1: g_t \\stackrel{\\text{i.i.d.}}{\\sim} \\mathcal{N}(g,\\sigma_g^2)$，其中 $\\sigma_g^2 \\ge 0$，与 $\\{e_t\\}$ 独立，且 $g$ 是一个未知的恒定平均增益。\n\n仅从以下基本原理出发：\n- 标量随机变量的高斯概率密度函数及其对数。\n- 独立性意味着联合密度的因式分解和对数似然的加性。\n- 用于最大似然估计的微分和优化的基本法则。\n\n执行以下任务：\n1. 在 $\\mathcal{H}_1$ 下，通过对潜变量 $g_t$ 积分，推导以 $u_t$ 为条件的 $y_t$ 的边际分布，并用 $g$ 和 $\\sigma_g^2$ 表示 $\\mathcal{H}_1$ 下的对数似然。\n2. 证明对于固定的 $\\sigma_g^2$，关于 $g$ 最大化 $\\mathcal{H}_1$ 下的对数似然会得到一个加权最小二乘估计量 $\\hat{g}(\\sigma_g^2)$，并给出其以 $\\{u_t\\}$, $\\{y_t\\}$, $\\sigma_e^2$ 和 $\\sigma_g^2$ 表示的显式形式。\n3. 通过代入 $\\hat{g}(\\sigma_g^2)$，将 $\\mathcal{H}_1$ 下的剖面对数似然表示为仅关于 $\\sigma_g^2$ 的函数，并解释为何在 $\\sigma_g^2 \\ge 0$ 上进行一维数值最大化是合适的。\n4. 推导 $\\mathcal{H}_0$ 下的最大似然估计，并写出在最大化点处的对数似然值。\n5. 定义似然比检验（LRT）统计量\n   $$\\Lambda = -2\\left(\\ell_{\\mathcal{H}_0}(\\hat{g}_0) - \\max_{\\sigma_g^2 \\ge 0}\\ \\ell_{\\mathcal{H}_1}(\\hat{g}(\\sigma_g^2),\\sigma_g^2)\\right),$$\n   其中 $\\ell_{\\mathcal{H}_0}$ 和 $\\ell_{\\mathcal{H}_1}$ 分别表示 $\\mathcal{H}_0$ 和 $\\mathcal{H}_1$ 下的对数似然函数，$\\hat{g}_0$ 是 $\\mathcal{H}_0$ 下的最大化子。利用参数在边界上的理论，指明 $\\Lambda$ 的渐近零分布，并给出一个在水平 $\\alpha \\in (0,1)$ 下检验 $\\mathcal{H}_0$ 与 $\\mathcal{H}_1$ 的正确 $p$ 值公式。\n6. 实现一个程序，对于下面测试套件中的每个测试用例，计算 $\\Lambda$ 并在 $p$ 值严格小于 $\\alpha$ 时返回一个拒绝 $\\mathcal{H}_0$ 的布尔决策。\n\n所有计算都是无量纲的；不需要物理单位。\n\n使用以下测试套件。每个测试用例提供 $(\\{u_t\\}_{t=1}^T, \\{y_t\\}_{t=1}^T, \\sigma_e, \\alpha)$:\n- 案例 A（预期有明显的时间变化）：$T = 12$, $u = [1.00, 0.80, 1.20, 1.10, 0.90, 1.30, 0.70, 1.50, 1.00, 1.40, 0.95, 1.05]$, $y = [1.56, 1.555, 2.04, 2.153, 1.481, 2.667, 1.047, 3.306, 1.793, 2.803, 1.518, 1.999]$, $\\sigma_e = 0.05$, $\\alpha = 0.05$。\n- 案例 B（近似恒定增益）：$T = 8$, $u = [1.0, 0.9, 1.1, 1.2, 0.8, 1.3, 0.7, 1.4]$, $y = [1.805, 1.616, 1.983, 2.154, 1.442, 2.337, 1.261, 2.524]$, $\\sigma_e = 0.05$, $\\alpha = 0.05$。\n- 案例 C（带有零输入的小样本）：$T = 4$, $u = [1.0, 0.0, 1.5, 0.5]$, $y = [1.71, -0.02, 2.865, 0.795]$, $\\sigma_e = 0.05$, $\\alpha = 0.05$。\n\n最终输出要求：\n- 对于每个测试用例，使用适用于边界参数的渐近零分布计算 LRT 统计量 $\\Lambda$ 和拒绝 $\\mathcal{H}_0$ 的布尔决策。\n- 程序必须输出一行，包含一个类 JSON 格式的列表，其长度等于测试用例的数量。每个元素必须是一个双元素列表 $[\\Lambda,\\text{decision}]$，其中 $\\Lambda$ 是一个四舍五入到小数点后六位的浮点数，$\\text{decision}$ 是一个布尔值。\n- 确切的输出格式是：单行输出，无额外文本，例如 $[[2.000000,True],[0.000000,False],[1.234567,False]]$。",
            "solution": "该问题要求推导并应用似然比检验（LRT），以区分用于半导体制造步骤的确定性过程模型（$\\mathcal{H}_0$）和随机性过程模型（$\\mathcal{H}_1$）。验证确认了该问题是适定的、有科学依据的，并提供了所有必要信息。我们按要求进行推导。\n\n### 1. $\\mathcal{H}_1$ 下的边际分布和对数似然\n\n在备择假设 $\\mathcal{H}_1$ 下，过程由以下方程描述：\n$$y_t = g_t u_t + e_t$$\n其中 $g_t \\stackrel{\\text{i.i.d.}}{\\sim} \\mathcal{N}(g, \\sigma_g^2)$ 且 $e_t \\stackrel{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0, \\sigma_e^2)$。随机变量 $g_t$ 和 $e_t$ 是独立的。对于每次运行 $t$，$u_t$ 的值是已知常数。\n\n为了找到以 $u_t$ 为条件的 $y_t$ 的边际分布，我们对潜变量 $g_t$ 进行积分。由于 $g_t$ 是高斯分布的，项 $g_t u_t$ 也是一个高斯随机变量：$g_t u_t \\sim \\mathcal{N}(g u_t, u_t^2 \\sigma_g^2)$。输出 $y_t$ 是两个独立高斯随机变量 $g_t u_t$ 和 $e_t$ 的和。独立高斯随机变量的和本身也是高斯分布的。\n\n$y_t$ 的均值是均值的和：\n$$E[y_t | u_t] = E[g_t u_t] + E[e_t] = g u_t + 0 = g u_t$$\n由于独立性，$y_t$ 的方差是方差的和：\n$$\\text{Var}(y_t | u_t) = \\text{Var}(g_t u_t) + \\text{Var}(e_t) = u_t^2 \\text{Var}(g_t) + \\sigma_e^2 = u_t^2 \\sigma_g^2 + \\sigma_e^2$$\n因此，以 $u_t$ 为条件的 $y_t$ 的边际分布是：\n$$y_t | u_t \\sim \\mathcal{N}(g u_t, u_t^2 \\sigma_g^2 + \\sigma_e^2)$$\n\n单个观测值 $y_t$ 的概率密度函数（PDF）是：\n$$p(y_t | u_t; g, \\sigma_g^2) = \\frac{1}{\\sqrt{2\\pi(u_t^2 \\sigma_g^2 + \\sigma_e^2)}} \\exp\\left(-\\frac{(y_t - g u_t)^2}{2(u_t^2 \\sigma_g^2 + \\sigma_e^2)}\\right)$$\n观测值 $y_t$ 对应的对数似然是：\n$$\\ell_t(g, \\sigma_g^2) = -\\frac{1}{2}\\log(2\\pi) - \\frac{1}{2}\\log(u_t^2 \\sigma_g^2 + \\sigma_e^2) - \\frac{(y_t - g u_t)^2}{2(u_t^2 \\sigma_g^2 + \\sigma_e^2)}$$\n由于观测值 $(y_1, \\dots, y_T)$ 是独立的，序列的总对数似然是各个对数似然的和：\n$$\\ell_{\\mathcal{H}_1}(g, \\sigma_g^2) = \\sum_{t=1}^T \\ell_t(g, \\sigma_g^2) = -\\frac{T}{2}\\log(2\\pi) - \\frac{1}{2}\\sum_{t=1}^T \\log(u_t^2 \\sigma_g^2 + \\sigma_e^2) - \\frac{1}{2}\\sum_{t=1}^T \\frac{(y_t - g u_t)^2}{u_t^2 \\sigma_g^2 + \\sigma_e^2}$$\n\n### 2. $\\mathcal{H}_1$ 下 $g$ 的最大似然估计量\n\n为了找到对于固定 $\\sigma_g^2$ 的 $g$ 的最大似然估计量（MLE），我们将 $\\ell_{\\mathcal{H}_1}(g, \\sigma_g^2)$ 对 $g$ 求导并令结果为零。不含 $g$ 的项可以忽略。\n$$\\frac{\\partial \\ell_{\\mathcal{H}_1}}{\\partial g} = \\frac{\\partial}{\\partial g} \\left( -\\frac{1}{2}\\sum_{t=1}^T \\frac{(y_t - g u_t)^2}{u_t^2 \\sigma_g^2 + \\sigma_e^2} \\right) = -\\frac{1}{2}\\sum_{t=1}^T \\frac{2(y_t - g u_t)(-u_t)}{u_t^2 \\sigma_g^2 + \\sigma_e^2} = \\sum_{t=1}^T \\frac{u_t y_t - g u_t^2}{u_t^2 \\sigma_g^2 + \\sigma_e^2}$$\n令导数为零可得：\n$$\\sum_{t=1}^T \\frac{u_t y_t}{u_t^2 \\sigma_g^2 + \\sigma_e^2} = g \\sum_{t=1}^T \\frac{u_t^2}{u_t^2 \\sigma_g^2 + \\sigma_e^2}$$\n求解 $g$ 得到估计量 $\\hat{g}(\\sigma_g^2)$：\n$$\\hat{g}(\\sigma_g^2) = \\frac{\\sum_{t=1}^T \\frac{u_t y_t}{u_t^2 \\sigma_g^2 + \\sigma_e^2}}{\\sum_{t=1}^T \\frac{u_t^2}{u_t^2 \\sigma_g^2 + \\sigma_e^2}}$$\n这是一个加权最小二乘（WLS）估计量。关于 $g$ 最大化对数似然等价于最小化加权残差平方和 $\\sum_{t=1}^T w_t (y_t - g u_t)^2$，其中权重 $w_t$ 是观测值方差的倒数：$w_t = (u_t^2 \\sigma_g^2 + \\sigma_e^2)^{-1}$。推导出的 $\\hat{g}(\\sigma_g^2)$ 表达式正是此 WLS 问题的解。请注意，如果任何 $u_t=0$，则其对应项在分子和分母的和中都为零，这表明这些点正确地没有为估计 $g$ 提供任何信息。\n\n### 3. $\\sigma_g^2$ 的剖面对数似然\n\n$\\sigma_g^2$ 的剖面对数似然，记为 $\\ell_P(\\sigma_g^2)$，是通过将估计量 $\\hat{g}(\\sigma_g^2)$ 代回到完整的对数似然函数 $\\ell_{\\mathcal{H}_1}$ 中得到的：\n$$\\ell_P(\\sigma_g^2) = \\ell_{\\mathcal{H}_1}(\\hat{g}(\\sigma_g^2), \\sigma_g^2)$$\n$$\\ell_P(\\sigma_g^2) = C - \\frac{1}{2}\\sum_{t=1}^T \\log(u_t^2 \\sigma_g^2 + \\sigma_e^2) - \\frac{1}{2}\\sum_{t=1}^T \\frac{(y_t - \\hat{g}(\\sigma_g^2) u_t)^2}{u_t^2 \\sigma_g^2 + \\sigma_e^2}$$\n其中 $C = -T/2 \\log(2\\pi)$。由于 $\\sigma_g^2$ 以复杂的非线性方式出现，对此函数关于 $\\sigma_g^2$ 进行解析最大化是难以处理的。标准且合适的方法是数值求解 $\\sigma_g^2$ 的最大似然估计。这将关于 $(g, \\sigma_g^2)$ 的二维优化问题简化为在方差的有效参数范围 $\\sigma_g^2 \\ge 0$ 上更易于管理的一维数值搜索。\n\n### 4. $\\mathcal{H}_0$ 下的最大似然估计\n\n在零假设 $\\mathcal{H}_0$ 下，增益是恒定的，$g_t = g$，这等价于在 $\\mathcal{H}_1$ 模型中设置 $\\sigma_g^2 = 0$。模型变为 $y_t = g u_t + e_t$，其中 $e_t \\sim \\mathcal{N}(0, \\sigma_e^2)$。这是一个通过原点的、误差方差已知的标准线性回归模型。\n对数似然函数为：\n$$\\ell_{\\mathcal{H}_0}(g) = -\\frac{T}{2}\\log(2\\pi\\sigma_e^2) - \\frac{1}{2\\sigma_e^2}\\sum_{t=1}^T(y_t - g u_t)^2$$\n关于 $g$ 最大化此函数等价于最小化残差平方和 $\\sum(y_t - g u_t)^2$。这是一个普通最小二乘（OLS）问题。导数为：\n$$\\frac{\\partial \\ell_{\\mathcal{H}_0}}{\\partial g} = \\frac{1}{\\sigma_e^2} \\sum_{t=1}^T (u_t y_t - g u_t^2)$$\n令其为零并求解 $g$ 得到 MLE $\\hat{g}_0$：\n$$\\hat{g}_0 = \\frac{\\sum_{t=1}^T u_t y_t}{\\sum_{t=1}^T u_t^2}$$\n$\\mathcal{H}_0$ 下的最大化对数似然值是通过将 $\\hat{g}_0$ 代回到 $\\ell_{\\mathcal{H}_0}(g)$ 中找到的：\n$$\\ell_{\\mathcal{H}_0}(\\hat{g}_0) = -\\frac{T}{2}\\log(2\\pi\\sigma_e^2) - \\frac{1}{2\\sigma_e^2}\\sum_{t=1}^T(y_t - \\hat{g}_0 u_t)^2$$\n\n### 5. 似然比检验统计量和渐近分布\n\nLRT 统计量 $\\Lambda$ 定义为备择假设 $\\mathcal{H}_1$ 下的最大化对数似然与零假设 $\\mathcal{H}_0$ 下的最大化对数似然之差的两倍：\n$$\\Lambda = -2\\left(\\ell_{\\mathcal{H}_0}(\\hat{g}_0) - \\max_{\\sigma_g^2 \\ge 0}\\ \\ell_{\\mathcal{H}_1}(\\hat{g}(\\sigma_g^2),\\sigma_g^2)\\right) = 2\\left(\\max_{\\sigma_g^2 \\ge 0} \\ell_P(\\sigma_g^2) - \\ell_{\\mathcal{H}_0}(\\hat{g}_0) \\right)$$\n零假设 $\\mathcal{H}_0$ 对应于在模型 $\\mathcal{H}_1$ 中设置参数 $\\sigma_g^2 = 0$。由于方差不能为负，$\\sigma_g^2$ 的参数空间是 $[0, \\infty)$，并且零假设值位于此空间的边界上。\n\n根据参数在边界上的假设检验理论（例如，Chernoff, 1954; Self  Liang, 1987），Wilks 定理必须进行调整。对于检验单个方差分量，$\\Lambda$ 的渐近零分布是零点处的点质量与自由度为1的卡方分布的混合：\n$$\\Lambda \\sim \\frac{1}{2}\\chi^2_0 + \\frac{1}{2}\\chi^2_1$$\n其中 $\\chi^2_0$ 是一个所有质量都集中在 $0$ 处的退化分布。\n\n对于一个观测到的统计量 $\\Lambda_{obs}$，$p$ 值是在零假设下获得一个至少与 $\\Lambda_{obs}$ 一样极端的检验统计量的概率。对于 $\\Lambda_{obs} > 0$：\n$$p = P(\\Lambda \\ge \\Lambda_{obs}) = P(\\Lambda \\ge \\Lambda_{obs} | \\Lambda > 0) P(\\Lambda > 0) = P(\\chi^2_1 \\ge \\Lambda_{obs}) \\times \\frac{1}{2}$$\n如果 $\\Lambda_{obs} = 0$，则 $\\sigma_g^2$ 的 MLE 是 $0$，且似然值相等。$p$ 值为 $P(\\Lambda \\ge 0) = 1/2 P(\\chi_0^2 \\ge 0) + 1/2 P(\\chi_1^2 \\ge 0) = 1/2(1) + 1/2(1) = 1$。一个更直接的计算得出 $p = 1 - F_\\Lambda(\\Lambda_{obs})$。对于 $\\Lambda_{obs} \\ge 0$，累积分布函数（CDF）是 $F_\\Lambda(\\Lambda_{obs}) = 0.5 + 0.5 F_{\\chi^2_1}(\\Lambda_{obs})$。因此，$p$ 值为 $p = 1 - (0.5 + 0.5 F_{\\chi^2_1}(\\Lambda_{obs})) = 0.5(1 - F_{\\chi^2_1}(\\Lambda_{obs})) = 0.5 \\times P(\\chi^2_1 > \\Lambda_{obs})$。\n$\\chi^2_1$ 分布的生存函数可以使用标准正态 CDF $\\Phi(z)$ 或误差函数 $\\text{erf}(z)$ 来表示，因为一个 $\\chi^2_1$ 变量是一个标准正态变量 $Z$ 的平方：\n$$P(\\chi^2_1 > x) = P(Z^2 > x) = P(Z  -\\sqrt{x} \\text{ or } Z > \\sqrt{x}) = 2(1 - \\Phi(\\sqrt{x}))$$\n使用关系 $\\Phi(z) = \\frac{1}{2}(1 + \\text{erf}(z/\\sqrt{2}))$，对于 $\\Lambda_{obs} \\ge 0$ 的 $p$ 值公式为：\n$$p = 1 - \\Phi(\\sqrt{\\Lambda_{obs}}) = \\frac{1}{2} - \\frac{1}{2}\\text{erf}\\left(\\frac{\\sqrt{\\Lambda_{obs}}}{\\sqrt{2}}\\right)$$\n决策规则是如果 $p  \\alpha$，则拒绝 $\\mathcal{H}_0$。\n\n请注意，对于任何 $u_t=0$ 的数据点 $(u_t, y_t)$，两种假设下的模型都简化为 $y_t=e_t$。来自这样一个点的对数似然贡献是 $-\\frac{1}{2}\\log(2\\pi\\sigma_e^2) - y_t^2/(2\\sigma_e^2)$，它是一个不依赖于 $g$ 或 $\\sigma_g^2$ 的常数。因此，这些点为 $\\ell_{\\mathcal{H}_0}(\\hat{g}_0)$ 和 $\\ell_{\\mathcal{H}_1}(\\hat{g}(\\sigma_g^2), \\sigma_g^2)$ 增加了相同的常数，并在 LRT 统计量 $\\Lambda$ 中相互抵消。因此，仅使用 $u_t \\neq 0$ 的数据子集进行分析是有效的。",
            "answer": "[[32.822941,True],[0.000000,False],[0.115747,False]]"
        }
    ]
}