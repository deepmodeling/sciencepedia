{
    "hands_on_practices": [
        {
            "introduction": "To effectively design a feedback controller for a power converter, we must first understand its dynamic behavior. This practice guides you through the fundamental process of creating a small-signal model, which describes how the system responds to small, rapid changes in the control inputâ€”the duty cycle. By deriving the discrete-time transfer function from duty cycle to inductor current, you will build a mathematical tool essential for analyzing system stability and predicting its response to control signals .",
            "id": "3870752",
            "problem": "A pulse width modulation (PWM) buck converter operates in continuous conduction mode and is modeled with an ideal switch and diode, an inductor of inductance $L$, an output capacitor $C$, and a resistive load $R$. The converter is driven from a constant input source $v_{g}$ and switches at a fixed switching period $T_{s}$ with duty ratio sequence $d_{k}$ that is held constant over the $k$-th switching interval $[k T_{s}, (k+1) T_{s})$. The inductor current $i_{L}(t)$ is sampled just before the update of the duty ratio at $t=(k+1)T_{s}$, producing the discrete-time sequence $i_{L,k+1} \\equiv i_{L}((k+1)T_{s}^{-})$. Assume the output voltage $v_{o}(t)$ is approximately constant over each switching interval due to a large output capacitor.\n\nStarting from the inductor constitutive law and the piecewise-constant inductor voltage in a buck converter, derive the exact one-period sampled-data update mapping for $i_{L,k+1}$ in terms of $i_{L,k}$, $d_{k}$, and $v_{o}$ under the assumption of ideal switching and negligible inductor resistance. Linearize this mapping about a steady operating point with duty $D$ and output voltage $V$, and, under the approximation that the small-signal output-voltage perturbation over a period is negligible relative to the duty perturbation at the modulation frequency, obtain the discrete-time small-signal transfer function $G_{id}(z)$ from the duty perturbation $\\tilde{d}_{k}$ to the inductor-current perturbation $\\tilde{i}_{L,k+1}$.\n\nThen, for the specific converter and excitation below, evaluate the sinusoidal steady-state response magnitude and phase of the inductor current to a sinusoidal small-signal duty modulation by evaluating $G_{id}(z)$ on the unit circle at the modulation frequency. The converter parameters and operating point are:\n- Input voltage $v_{g} = 48\\,\\mathrm{V}$, inductance $L = 1\\,\\mathrm{mH}$, output capacitance $C = 1000\\,\\mu\\mathrm{F}$, load resistance $R = 6\\,\\Omega$.\n- Switching frequency $f_{s} = 50\\,\\mathrm{kHz}$, so $T_{s} = 1/f_{s}$.\n- Steady operating duty $D = 0.25$, yielding $V \\approx D\\,v_{g}$ in steady state under the stated idealizations.\n- Small-signal duty modulation $\\tilde{d}_{k} = \\hat{d}\\,\\sin(2\\pi f_{m}\\,k\\,T_{s})$ with modulation frequency $f_{m} = 1\\,\\mathrm{kHz}$ and amplitude $\\hat{d} = 0.02$.\n\nUsing your derived $G_{id}(z)$, predict the steady-state inductor-current ripple amplitude and its phase relative to the duty modulation at $f_{m}$, assuming the output-voltage small-signal variation over one switching period is negligible at $f_{m}$ given the large $C$ and the load. Express the phase in radians. As your final reported result, provide only the amplitude of the inductor-current ripple in amperes, rounded to four significant figures.",
            "solution": "The problem requires the derivation of a small-signal discrete-time transfer function for a PWM buck converter and its subsequent use to calculate the amplitude of the inductor current response to a sinusoidal duty cycle modulation.\n\nFirst, we validate the problem.\n\n**Step 1: Extract Givens**\n- **Model**: Ideal switch and diode, inductor $L$, capacitor $C$, resistor $R$.\n- **Operation**: Continuous conduction mode (CCM).\n- **Input**: Constant voltage source $v_{g}$.\n- **Control**: Fixed switching period $T_{s}$, duty ratio sequence $d_k$ constant over $[k T_{s}, (k+1) T_{s})$.\n- **Sampling**: Inductor current $i_{L}(t)$ is sampled at $t=(k+1)T_{s}^{-}$ to get $i_{L,k+1} \\equiv i_{L}((k+1)T_{s}^{-})$.\n- **Assumption 1**: Output voltage $v_{o}(t)$ is approximately constant over each switching interval.\n- **Assumption 2**: Ideal switching and negligible inductor resistance.\n- **Assumption 3 (for linearization)**: The small-signal output-voltage perturbation over a period is negligible relative to the duty perturbation at the modulation frequency.\n- **Parameters**:\n  - Input voltage $v_{g} = 48\\,\\mathrm{V}$\n  - Inductance $L = 1\\,\\mathrm{mH} = 1 \\times 10^{-3}\\,\\mathrm{H}$\n  - Capacitance $C = 1000\\,\\mu\\mathrm{F} = 1 \\times 10^{-3}\\,\\mathrm{F}$\n  - Load resistance $R = 6\\,\\Omega$\n  - Switching frequency $f_{s} = 50\\,\\mathrm{kHz}$, so $T_{s} = 1/f_{s} = 2 \\times 10^{-5}\\,\\mathrm{s}$\n  - Steady operating duty $D = 0.25$\n  - Steady output voltage $V \\approx D\\,v_{g}$\n  - Small-signal duty modulation $\\tilde{d}_{k} = \\hat{d}\\,\\sin(2\\pi f_{m}\\,k\\,T_{s})$\n  - Modulation frequency $f_{m} = 1\\,\\mathrm{kHz}$\n  - Modulation amplitude $\\hat{d} = 0.02$\n- **Required output**: Amplitude of the inductor-current ripple in amperes, rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem describes a standard buck converter and uses fundamental principles of power electronics and control theory (sampled-data modeling, linearization, small-signal analysis). The assumptions are standard for introductory analysis of such converters. The model is scientifically valid.\n- **Well-Posed**: The problem statement is clear, provides all necessary data, and requests a specific, calculable result. The steps are logically laid out, leading to a unique solution.\n- **Objective**: The language is technical and precise, with no subjective or ambiguous terms.\n\n**Step 3: Verdict and Action**\nThe problem is valid. We proceed with the solution.\n\n**Derivation of the Sampled-Data Update Mapping**\nThe inductor's behavior is described by its constitutive law, $v_{L}(t) = L \\frac{di_{L}(t)}{dt}$. Over a single switching period $T_s$, from $t=kT_s$ to $t=(k+1)T_s$, the change in inductor current is found by integrating the inductor voltage:\n$$ \\Delta i_{L,k} = i_{L}((k+1)T_s) - i_{L}(kT_s) = \\frac{1}{L} \\int_{kT_s}^{(k+1)T_s} v_L(\\tau) d\\tau $$\nIn a buck converter, the inductor voltage $v_L(t)$ is piecewise constant over the switching period. For the interval $[k T_{s}, (k+d_{k})T_{s})$, the switch is ON, and the inductor voltage is $v_{L}(t) = v_{g} - v_{o}(t)$. For the interval $[(k+d_{k})T_{s}, (k+1)T_{s})$, the switch is OFF, and the inductor voltage is $v_{L}(t) = -v_{o}(t)$.\n\nUnder the assumption that the output voltage $v_o(t)$ is approximately constant over the switching interval, let's denote it by $v_{o,k}$. The integral becomes:\n$$ L \\Delta i_{L,k} = \\int_{kT_s}^{(k+d_k)T_s} (v_g - v_{o,k}) d\\tau + \\int_{(k+d_k)T_s}^{(k+1)T_s} (-v_{o,k}) d\\tau $$\n$$ L (i_{L,k+1} - i_{L,k}) = (v_g - v_{o,k})d_k T_s + (-v_{o,k})(1-d_k)T_s $$\nSimplifying the right-hand side:\n$$ L (i_{L,k+1} - i_{L,k}) = (v_g d_k - v_{o,k} d_k - v_{o,k} + v_{o,k} d_k)T_s = (v_g d_k - v_{o,k})T_s $$\nThus, the exact one-period sampled-data update mapping is:\n$$ i_{L,k+1} = i_{L,k} + \\frac{T_s}{L} (v_g d_k - v_{o,k}) $$\n\n**Linearization and Small-Signal Transfer Function**\nWe linearize this mapping around a steady operating point $(D, I_L, V)$. We express each variable as a sum of its steady-state (DC) value and a small-signal (AC) perturbation:\n- $d_k = D + \\tilde{d}_k$\n- $i_{L,k} = I_L + \\tilde{i}_{L,k}$\n- $v_{o,k} = V + \\tilde{v}_{o,k}$\n\nSubstituting these into the update equation:\n$$ I_L + \\tilde{i}_{L,k+1} = (I_L + \\tilde{i}_{L,k}) + \\frac{T_s}{L} [v_g(D + \\tilde{d}_k) - (V + \\tilde{v}_{o,k})] $$\nThe steady-state (DC) terms must equate to zero on their own:\n$$ I_L = I_L + \\frac{T_s}{L} (v_g D - V) \\implies v_g D - V = 0 \\implies V = D v_g $$\nThis confirms the steady-state output voltage relation for an ideal buck converter.\n\nThe remaining terms form the small-signal model:\n$$ \\tilde{i}_{L,k+1} = \\tilde{i}_{L,k} + \\frac{T_s}{L} (v_g \\tilde{d}_k - \\tilde{v}_{o,k}) $$\nThe problem states to use the approximation that the small-signal output-voltage perturbation $\\tilde{v}_{o,k}$ is negligible for deriving the duty-to-current transfer function. Setting $\\tilde{v}_{o,k} \\approx 0$, we get:\n$$ \\tilde{i}_{L,k+1} = \\tilde{i}_{L,k} + \\frac{v_g T_s}{L} \\tilde{d}_k $$\nTo find the transfer function $G_{id}(z) = \\frac{\\tilde{I}_L(z)}{\\tilde{D}(z)}$, we take the Z-transform of this linear difference equation, where $\\tilde{I}_L(z) = \\mathcal{Z}\\{\\tilde{i}_{L,k}\\}$ and $\\tilde{D}(z) = \\mathcal{Z}\\{\\tilde{d}_k\\}$:\n$$ z \\tilde{I}_L(z) = \\tilde{I}_L(z) + \\frac{v_g T_s}{L} \\tilde{D}(z) $$\nRearranging to solve for the transfer function:\n$$ (z-1) \\tilde{I}_L(z) = \\frac{v_g T_s}{L} \\tilde{D}(z) $$\n$$ G_{id}(z) = \\frac{\\tilde{I}_L(z)}{\\tilde{D}(z)} = \\frac{v_g T_s / L}{z-1} $$\n\n**Evaluation of the Sinusoidal Steady-State Response**\nThe steady-state response of the inductor current to a sinusoidal duty modulation $\\tilde{d}_k = \\hat{d}\\,\\sin(\\omega_m k T_s)$ is found by evaluating the transfer function at $z = \\exp(j\\omega_m T_s)$, where $\\omega_m = 2\\pi f_m$. The resulting complex number $G_{id}(\\exp(j\\omega_m T_s))$ gives the gain and phase shift at that frequency. The amplitude of the inductor current response, $\\hat{i}_L$, is given by:\n$$ \\hat{i}_L = \\hat{d} \\cdot |G_{id}(\\exp(j\\omega_m T_s))| $$\nFirst, we compute the numerical values of the constants.\n- $k_{G} = \\frac{v_g T_s}{L} = \\frac{48 \\, \\mathrm{V} \\cdot (2 \\times 10^{-5}\\,\\mathrm{s})}{1 \\times 10^{-3}\\,\\mathrm{H}} = 0.96$\n- The complex exponential argument is $\\theta = \\omega_m T_s = 2\\pi f_m T_s = 2\\pi \\cdot (1 \\times 10^3\\,\\mathrm{Hz}) \\cdot (2 \\times 10^{-5}\\,\\mathrm{s}) = 0.04\\pi$ radians.\n\nNow we evaluate the magnitude of $G_{id}(z)$ at $z = \\exp(j0.04\\pi)$:\n$$ |G_{id}(\\exp(j0.04\\pi))| = \\left| \\frac{0.96}{\\exp(j0.04\\pi) - 1} \\right| = \\frac{0.96}{|\\cos(0.04\\pi) + j\\sin(0.04\\pi) - 1|} $$\n$$ |G_{id}| = \\frac{0.96}{|(\\cos(0.04\\pi) - 1) + j\\sin(0.04\\pi)|} = \\frac{0.96}{\\sqrt{(\\cos(0.04\\pi) - 1)^2 + \\sin^2(0.04\\pi)}} $$\nUsing the identity $\\sqrt{(\\cos\\theta - 1)^2 + \\sin^2\\theta} = \\sqrt{\\cos^2\\theta - 2\\cos\\theta + 1 + \\sin^2\\theta} = \\sqrt{2 - 2\\cos\\theta} = \\sqrt{2(2\\sin^2(\\theta/2))} = 2|\\sin(\\theta/2)|$. For $\\theta=0.04\\pi$, $\\theta/2 = 0.02\\pi$, which is in the first quadrant, so $\\sin(\\theta/2)$ is positive.\n$$ |G_{id}| = \\frac{0.96}{2\\sin(0.04\\pi/2)} = \\frac{0.96}{2\\sin(0.02\\pi)} $$\nNumerically:\n$$ \\sin(0.02\\pi) \\approx 0.0627905 $$\n$$ |G_{id}| \\approx \\frac{0.96}{2 \\cdot 0.0627905} = \\frac{0.96}{0.125581} \\approx 7.64448 $$\nThe amplitude of the inductor current ripple at the modulation frequency is:\n$$ \\hat{i}_L = \\hat{d} \\cdot |G_{id}| = 0.02 \\cdot 7.64448 \\approx 0.1528896\\,\\mathrm{A} $$\nRounding to four significant figures, the amplitude is $0.1529\\,\\mathrm{A}$.\n\nFor completeness, the phase of the response is:\n$$ \\angle G_{id} = \\angle(0.96) - \\angle(\\exp(j0.04\\pi) - 1) = 0 - \\arctan\\left(\\frac{\\sin(0.04\\pi)}{\\cos(0.04\\pi)-1}\\right) $$\nUsing the more robust identity $e^{j\\theta}-1 = 2\\sin(\\theta/2)e^{j(\\theta/2+\\pi/2)}$, the phase is:\n$$ \\angle G_{id} = \\angle\\left(\\frac{k_G}{2\\sin(\\theta/2)e^{j(\\theta/2+\\pi/2)}}\\right) = -\\left(\\frac{\\theta}{2} + \\frac{\\pi}{2}\\right) = -\\left(\\frac{0.04\\pi}{2} + \\frac{\\pi}{2}\\right) = -0.52\\pi \\approx -1.6336\\,\\mathrm{radians} $$\nThe current ripple lags the duty cycle modulation by approximately $1.6336$ radians. The question, however, only asks for the amplitude.",
            "answer": "$$\\boxed{0.1529}$$"
        },
        {
            "introduction": "While voltage-mode control is fundamental, many modern converters use current-mode control for its benefits like inherent current limiting and faster response. This advanced technique, however, introduces a unique stability challenge known as subharmonic oscillation, especially at higher duty cycles. This exercise tasks you with analyzing the discrete-time dynamics of a peak current-mode controlled converter to uncover the root of this instability and derive the exact slope compensation required to ensure stable operation across all conditions .",
            "id": "3870693",
            "problem": "Consider a Continuous Conduction Mode (CCM) buck converter operating under peak current-mode control with fixed-frequency Pulse Width Modulation (PWM). Let the switching period be $T_{s}$, the inductor current rise (on-time) slope be $m_{1}>0$ and the magnitude of the inductor current fall (off-time) slope be $m_{2}>0$. A linear compensation ramp of slope $m_{a} \\geq 0$ (added to the sensed inductor current signal) is used during the on-time and reset every switching period. Assume ideal current sensing and an ideal comparator that terminates the switch on-time when the sum of the sensed inductor current and the compensation ramp equals a constant threshold $i_{\\mathrm{th}}$.\n\nStarting only from the physical triangular inductor current evolution under constant input and output voltages and the sample-and-hold nature of the PWM, perform the following:\n\n1. Derive the exact one-cycle mapping for the inductor valley current $i_{v}^{(n)}$ to $i_{v}^{(n+1)}$ in terms of $m_{1}$, $m_{2}$, $m_{a}$, $T_{s}$, and $i_{\\mathrm{th}}$, under the described peak current-mode modulation law.\n2. Linearize this mapping about a steady-state periodic solution and identify the sample-data eigenvalue $p$ governing the intrinsic subharmonic dynamics of the inner current loop.\n3. Using the condition $|p|<1$ for elimination of subharmonic oscillation, find the minimum compensation ramp slope that guarantees stability at the given operating point $(m_{1},m_{2})$.\n4. Show explicitly how the addition of the compensation ramp of slope $m_{a}$ modifies the effective small-signal duty-to-current conversion within the inner loop by deriving the linear relation between a small perturbation in the comparator threshold and the resulting perturbation in the valley current across one cycle, and identify the scaling that depends on $m_{a}$.\n\nExpress your final answer for the minimum required compensation ramp slope as a closed-form analytic expression in terms of $m_{1}$ and $m_{2}$. Use the unit ampere per second (A/s) for $m_{a}$. No numerical evaluation is required.",
            "solution": "The problem requires the analysis of a peak current-mode controlled buck converter. We are asked to derive its discrete-time dynamics, assess its stability, determine the minimum compensation ramp for stable operation, and analyze the effect of this ramp on the small-signal response. The analysis begins from first principles, considering the inductor current waveform over a single switching period, $T_s$.\n\nLet the $n$-th switching cycle begin at time $t=nT_s$. The inductor current at this instant is the valley current, denoted by $i_v^{(n)}$. The switch is turned on, and the inductor current increases with a constant slope $m_1$. The current at any time $t'$ within the on-interval, where $t' = t - nT_s$, is given by:\n$$i_L(t) = i_v^{(n)} + m_1 (t - nT_s)$$\nThe on-time, denoted by $d_n T_s$, is terminated when the sum of the sensed inductor current and the compensation ramp equals the threshold $i_{\\mathrm{th}}$. The compensation ramp signal is $m_a (t-nT_s)$. Thus, the switching condition at the end of the on-time, $t = nT_s + d_n T_s$, is:\n$$i_L(nT_s + d_n T_s) + m_a (d_n T_s) = i_{\\mathrm{th}}$$\nThe current at this instant is the peak current, $i_p^{(n)} = i_v^{(n)} + m_1 (d_n T_s)$. Substituting this into the switching condition yields:\n$$(i_v^{(n)} + m_1 d_n T_s) + m_a d_n T_s = i_{\\mathrm{th}}$$\nWe can solve for the on-time duration $d_n T_s$:\n$$(m_1 + m_a) d_n T_s = i_{\\mathrm{th}} - i_v^{(n)}$$\n$$d_n T_s = \\frac{i_{\\mathrm{th}} - i_v^{(n)}}{m_1 + m_a}$$\nDuring the off-time, which lasts for $(1-d_n)T_s$, the inductor current decreases with a slope of magnitude $m_2$. The valley current at the beginning of the next cycle, $i_v^{(n+1)}$, is found by subtracting the current drop from the peak current $i_p^{(n)}$:\n$$i_v^{(n+1)} = i_p^{(n)} - m_2 (T_s - d_n T_s)$$\nSubstituting the expression for the peak current, $i_p^{(n)} = i_v^{(n)} + m_1 d_n T_s$:\n$$i_v^{(n+1)} = (i_v^{(n)} + m_1 d_n T_s) - m_2 (T_s - d_n T_s) = i_v^{(n)} - m_2 T_s + (m_1 + m_2)d_n T_s$$\nNow, substituting the expression for $d_n T_s$:\n$$i_v^{(n+1)} = i_v^{(n)} - m_2 T_s + (m_1 + m_2) \\left( \\frac{i_{\\mathrm{th}} - i_v^{(n)}}{m_1 + m_a} \\right)$$\nRearranging the terms to find the mapping from $i_v^{(n)}$ to $i_v^{(n+1)}$ completes the first task.\n$$i_v^{(n+1)} = i_v^{(n)} \\left( 1 - \\frac{m_1 + m_2}{m_1 + m_a} \\right) + \\frac{m_1 + m_2}{m_1 + m_a} i_{\\mathrm{th}} - m_2 T_s$$\n$$i_v^{(n+1)} = i_v^{(n)} \\left( \\frac{m_1 + m_a - m_1 - m_2}{m_1 + m_a} \\right) + \\frac{m_1 + m_2}{m_1 + m_a} i_{\\mathrm{th}} - m_2 T_s$$\nThis yields the final one-cycle mapping:\n$$i_v^{(n+1)} = \\left( \\frac{m_a - m_2}{m_1 + m_a} \\right) i_v^{(n)} + \\frac{m_1 + m_2}{m_1 + m_a} i_{\\mathrm{th}} - m_2 T_s$$\n\nFor the second task, we linearize this map. Let the steady-state operating point be defined by $i_v^{(n)} = i_v^{(n+1)} = I_v$ and constant inputs and outputs. We introduce a small perturbation $\\hat{i}_v^{(n)}$ such that $i_v^{(n)} = I_v + \\hat{i}_v^{(n)}$. The derived map is already a linear first-order affine transformation. Thus, linearizing it involves simply finding the derivative of the mapping function with respect to $i_v^{(n)}$, which is the coefficient of the $i_v^{(n)}$ term.\nThe perturbation dynamics are given by:\n$$\\hat{i}_v^{(n+1)} = \\frac{\\partial i_v^{(n+1)}}{\\partial i_v^{(n)}} \\bigg|_{I_v} \\hat{i}_v^{(n)}$$\nThe sample-data eigenvalue $p$ governing the intrinsic dynamics is this derivative:\n$$p = \\frac{\\partial}{\\partial i_v^{(n)}} \\left[ \\left( \\frac{m_a - m_2}{m_1 + m_a} \\right) i_v^{(n)} + \\text{constant terms} \\right] = \\frac{m_a - m_2}{m_1 + m_a}$$\n\nFor the third task, we use the stability criterion for a discrete-time system, which requires the magnitude of the eigenvalue to be less than $1$, i.e., $|p| < 1$. This prevents the growth of perturbations, including subharmonic oscillations which correspond to an eigenvalue of $p=-1$.\n$$-1 < \\frac{m_a - m_2}{m_1 + m_a} < 1$$\nGiven $m_1 > 0$, $m_2 > 0$, and $m_a \\ge 0$, the denominator $m_1 + m_a$ is strictly positive. We can analyze the two inequalities separately.\nFirst, the right-hand side inequality:\n$$\\frac{m_a - m_2}{m_1 + m_a} < 1 \\implies m_a - m_2 < m_1 + m_a \\implies -m_2 < m_1 \\implies m_1 + m_2 > 0$$\nThis condition is always met since $m_1$ and $m_2$ are positive slopes.\nSecond, the left-hand side inequality, which is critical for preventing period-doubling bifurcation (subharmonic oscillation):\n$$-1 < \\frac{m_a - m_2}{m_1 + m_a} \\implies -(m_1 + m_a) < m_a - m_2 \\implies -m_1 - m_a < m_a - m_2$$\n$$m_2 - m_1 < 2 m_a \\implies m_a > \\frac{m_2 - m_1}{2}$$\nThis is the condition on the compensation ramp slope $m_a$ to guarantee stability. The problem asks for the minimum required slope. If $m_2 \\le m_1$, then $\\frac{m_2 - m_1}{2} \\le 0$. Since the problem states $m_a \\ge 0$, any physically allowable compensation ramp, including $m_a = 0$, satisfies the stability condition. Thus, the minimum required slope in this case is $0$. If $m_2 > m_1$, a positive compensation slope is required, and the minimum value that guarantees stability is the boundary value $\\frac{m_2 - m_1}{2}$. Combining both cases, the minimum required non-negative slope $m_{a, \\text{min}}$ is:\n$$m_{a, \\text{min}} = \\max\\left(0, \\frac{m_2 - m_1}{2}\\right)$$\nThe expression for the final answer will be based on this result.\n\nFor the fourth task, we analyze the effect of a small perturbation in the threshold, $\\hat{i}_{\\mathrm{th}}$, on the valley current. We return to the full discrete-time map and introduce perturbations for both $i_v$ and $i_{\\mathrm{th}}$: $i_v^{(n)} = I_v + \\hat{i}_v^{(n)}$ and $i_{\\mathrm{th}}^{(n)} = I_{\\mathrm{th}} + \\hat{i}_{\\mathrm{th}}^{(n)}$, where $I_v$ and $I_{\\mathrm{th}}$ are the steady-state values.\n$$I_v + \\hat{i}_v^{(n+1)} = \\left( \\frac{m_a - m_2}{m_1 + m_a} \\right) (I_v + \\hat{i}_v^{(n)}) + \\frac{m_1 + m_2}{m_1 + m_a} (I_{\\mathrm{th}} + \\hat{i}_{\\mathrm{th}}^{(n)}) - m_2 T_s$$\nThe steady-state terms cancel out, leaving the small-signal dynamic equation:\n$$\\hat{i}_v^{(n+1)} = \\left( \\frac{m_a - m_2}{m_1 + m_a} \\right) \\hat{i}_v^{(n)} + \\left( \\frac{m_1 + m_2}{m_1 + m_a} \\right) \\hat{i}_{\\mathrm{th}}^{(n)}$$\nThe question asks for the linear relation for the resulting perturbation in valley current across one cycle from a perturbation in the threshold. This corresponds to the case where the system starts in steady state, so $\\hat{i}_v^{(n)} = 0$. The resulting perturbation in the next valley current is:\n$$\\hat{i}_v^{(n+1)} = \\left( \\frac{m_1 + m_2}{m_1 + m_a} \\right) \\hat{i}_{\\mathrm{th}}^{(n)}$$\nThis is the linear relation. The scaling factor that depends on $m_a$ is the term multiplying $\\hat{i}_{\\mathrm{th}}^{(n)}$:\n$$G_{\\mathrm{th}} = \\frac{m_1 + m_2}{m_1 + m_a}$$\nThis shows that the addition of the compensation ramp (increasing $m_a$ from $0$) reduces the gain from the control reference ($i_{\\mathrm{th}}$) to the state variable ($i_v$). This is an important trade-off: increasing $m_a$ improves stability at the cost of reducing the dynamic response of the current loop.\n\nThe final answer requested is the minimum required compensation ramp slope. Based on the analysis for the third task, this is $\\max(0, \\frac{m_2-m_1}{2})$.",
            "answer": "$$\\boxed{\\max\\left(0, \\frac{m_2-m_1}{2}\\right)}$$"
        },
        {
            "introduction": "A perfect control algorithm on paper can fail if the hardware implementing it cannot keep up. This final practice shifts our focus from the power stage to the digital controller, examining the real-world timing constraints of a microcontroller-based PWM system. By carefully accounting for processing time, interrupt latencies, and hardware setup requirements, you will determine the maximum achievable switching frequency, providing a crucial link between control theory and practical hardware limitations .",
            "id": "3870703",
            "problem": "A three-phase voltage source inverter is controlled by microcontroller-based Pulse Width Modulation (PWM). The PWM carrier is center-aligned and a timer generates two Interrupt Service Routine (ISR) events per switching period. Each ISR performs context save and dispatch, executes the digital control update, reads one Analog-to-Digital Converter (ADC) sample per interrupt, and writes the new compare values. The Central Processing Unit (CPU) clock runs at frequency $f_{\\mathrm{clk}}$. The timer requires that the compare register be updated at least $t_{\\mathrm{set}}$ before the next switching edge to guarantee correct latching. Assume the following parameters:\n\n- CPU clock: $f_{\\mathrm{clk}} = 160 \\times 10^{6} \\ \\mathrm{s}^{-1}$.\n- Interrupts per PWM period (center-aligned): $r = 2$.\n- Worst-case ISR latency (context save to first executable instruction): $N_{\\mathrm{lat}} = 120$ cycles.\n- Worst-case computation per ISR (digital control, non-linear observer, and saturation logic): $N_{\\mathrm{comp}} = 2400$ cycles.\n- Input/Output overhead per ISR (ADC read, compare write, peripheral synchronization): $N_{\\mathrm{io}} = 200$ cycles.\n- Compare register setup requirement: $t_{\\mathrm{set}} = 200 \\times 10^{-9} \\ \\mathrm{s}$.\n\nStarting from fundamental timing definitions and without using any pre-derived PWM scheduling formulas, derive the relationship linking the achievable PWM switching frequency $f_{\\mathrm{s}}$, the sampling rate $f_{\\mathrm{sample}}$, the interrupt latency and computational load, and the timer setup requirement. Then, using the provided numerical values, estimate the maximum achievable PWM switching frequency $f_{\\mathrm{s}}^{\\max}$ under the constraint that every ISR must complete and update the compare register at least $t_{\\mathrm{set}}$ before the next switching edge.\n\nRound your final numerical answer to four significant figures and express the final frequency in kHz. The answer must be a single number.",
            "solution": "The problem statement is evaluated for validity before proceeding to a solution.\n\n### Step 1: Extract Givens\n- System: Three-phase voltage source inverter with microcontroller-based Pulse Width Modulation (PWM).\n- PWM scheme: Center-aligned carrier.\n- Interrupts: $r = 2$ Interrupt Service Routine (ISR) events per switching period.\n- ISR tasks: Context save, digital control update, one Analog-to-Digital Converter (ADC) read per interrupt, write new compare values.\n- Central Processing Unit (CPU) clock frequency: $f_{\\mathrm{clk}} = 160 \\times 10^{6} \\ \\mathrm{s}^{-1}$.\n- Worst-case ISR latency: $N_{\\mathrm{lat}} = 120$ cycles.\n- Worst-case computation per ISR: $N_{\\mathrm{comp}} = 2400$ cycles.\n- Input/Output overhead per ISR: $N_{\\mathrm{io}} = 200$ cycles.\n- Timer compare register setup requirement: $t_{\\mathrm{set}} = 200 \\times 10^{-9} \\ \\mathrm{s}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, describing a standard and realistic timing analysis for a digital control system in power electronics. All terms used (PWM, ISR, ADC, CPU cycles, setup time) are well-defined in the context of embedded systems. The provided numerical values are plausible for a modern microcontroller. The problem is well-posed, self-contained, and objective, with sufficient information to derive a unique solution for the maximum switching frequency. It does not violate any of the specified invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. A full solution will be provided.\n\nThe problem requires the derivation of the maximum PWM switching frequency, $f_{\\mathrm{s}}^{\\max}$, for a microcontroller-based system. This frequency is limited by the time required to execute the control algorithm within the ISR and hardware timing constraints.\n\nLet $T_{\\mathrm{s}}$ be the PWM switching period, which is the reciprocal of the switching frequency, $f_{\\mathrm{s}}$.\n$$T_{\\mathrm{s}} = \\frac{1}{f_{\\mathrm{s}}}$$\nThe PWM scheme is center-aligned, with $r=2$ interrupts generated per switching period. These interrupts typically occur at the peak and trough of the triangular carrier waveform. This means the time between two consecutive ISR triggers is half the switching period.\n$$T_{\\mathrm{interval}} = \\frac{T_{\\mathrm{s}}}{r} = \\frac{T_{\\mathrm{s}}}{2}$$\nThe problem states that one ADC sample is taken per interrupt, so the sampling frequency, $f_{\\mathrm{sample}}$, is equal to the interrupt frequency.\n$$f_{\\mathrm{sample}} = r \\cdot f_{\\mathrm{s}} = 2 f_{\\mathrm{s}}$$\nWithin each ISR, the microcontroller must perform several tasks. The total time required to execute the ISR, $T_{\\mathrm{ISR\\_exec}}$, can be calculated by summing the CPU cycles for all tasks and multiplying by the duration of a single clock cycle, $T_{\\mathrm{clk}} = 1/f_{\\mathrm{clk}}$.\nThe total number of cycles per ISR, $N_{\\mathrm{total}}$, is the sum of latency, computation, and I/O cycles.\n$$N_{\\mathrm{total}} = N_{\\mathrm{lat}} + N_{\\mathrm{comp}} + N_{\\mathrm{io}}$$\nThe total execution time for one ISR is therefore:\n$$T_{\\mathrm{ISR\\_exec}} = N_{\\mathrm{total}} \\cdot T_{\\mathrm{clk}} = \\frac{N_{\\mathrm{total}}}{f_{\\mathrm{clk}}}$$\nThe critical timing constraint is that the ISR must complete its execution, including writing the new compare values to the timer registers, at least $t_{\\mathrm{set}}$ before the next PWM edge is generated. In a center-aligned scheme with interrupts at the peak and trough, the timer hardware uses the newly written compare values at these same peak and trough events. Thus, the entire ISR initiated at one event (e.g., the trough) must complete before the deadline for the next event (e.g., the peak). The deadline is $t_{\\mathrm{set}}$ before the next event.\n\nThe time available for the ISR execution is the interval between two consecutive interrupts, $T_{\\mathrm{interval}}$, minus the required setup time, $t_{\\mathrm{set}}$.\nTherefore, the fundamental timing constraint is:\n$$T_{\\mathrm{ISR\\_exec}} \\le T_{\\mathrm{interval}} - t_{\\mathrm{set}}$$\nSubstituting the expressions for $T_{\\mathrm{ISR\\_exec}}$ and $T_{\\mathrm{interval}}$:\n$$\\frac{N_{\\mathrm{lat}} + N_{\\mathrm{comp}} + N_{\\mathrm{io}}}{f_{\\mathrm{clk}}} \\le \\frac{T_{\\mathrm{s}}}{r} - t_{\\mathrm{set}}$$\nRearranging the inequality to group the time components:\n$$\\frac{N_{\\mathrm{lat}} + N_{\\mathrm{comp}} + N_{\\mathrm{io}}}{f_{\\mathrm{clk}}} + t_{\\mathrm{set}} \\le \\frac{T_{\\mathrm{s}}}{r}$$\nThis inequality represents the general relationship linking the achievable PWM switching frequency ($f_{\\mathrm{s}} = 1/T_{\\mathrm{s}}$), the sampling rate ($f_{\\mathrm{sample}} = r f_{\\mathrm{s}}$), the interrupt latency and computational load ($N_{\\mathrm{lat}}$, $N_{\\mathrm{comp}}$, $N_{\\mathrm{io}}$), the CPU clock speed ($f_{\\mathrm{clk}}$), and the timer setup requirement ($t_{\\mathrm{set}}$).\n\nTo find the maximum achievable PWM switching frequency, $f_{\\mathrm{s}}^{\\max}$, we consider the limit where the execution and setup time exactly fill the available time window. This corresponds to turning the inequality into an equality and solving for $f_{\\mathrm{s}} = f_{\\mathrm{s}}^{\\max}$ (which implies $T_{\\mathrm{s}} = T_{\\mathrm{s}}^{\\min}$).\n$$\\frac{N_{\\mathrm{lat}} + N_{\\mathrm{comp}} + N_{\\mathrm{io}}}{f_{\\mathrm{clk}}} + t_{\\mathrm{set}} = \\frac{T_{\\mathrm{s}}^{\\min}}{r} = \\frac{1}{r \\cdot f_{\\mathrm{s}}^{\\max}}$$\nSolving for $f_{\\mathrm{s}}^{\\max}$:\n$$f_{\\mathrm{s}}^{\\max} = \\frac{1}{r \\left( \\frac{N_{\\mathrm{lat}} + N_{\\mathrm{comp}} + N_{\\mathrm{io}}}{f_{\\mathrm{clk}}} + t_{\\mathrm{set}} \\right)}$$\nNow, we substitute the provided numerical values:\n- $r = 2$\n- $N_{\\mathrm{lat}} = 120$\n- $N_{\\mathrm{comp}} = 2400$\n- $N_{\\mathrm{io}} = 200$\n- $f_{\\mathrm{clk}} = 160 \\times 10^{6} \\ \\mathrm{s}^{-1}$\n- $t_{\\mathrm{set}} = 200 \\times 10^{-9} \\ \\mathrm{s}$\n\nFirst, calculate the total cycles per ISR:\n$$N_{\\mathrm{total}} = 120 + 2400 + 200 = 2720 \\ \\text{cycles}$$\nNext, calculate the ISR execution time:\n$$T_{\\mathrm{ISR\\_exec}} = \\frac{2720}{160 \\times 10^{6} \\ \\mathrm{s}^{-1}} = \\frac{272}{16 \\times 10^{6}} \\ \\mathrm{s} = 17 \\times 10^{-6} \\ \\mathrm{s}$$\nNow, calculate the minimum time interval required between interrupts:\n$$T_{\\mathrm{interval}}^{\\min} = T_{\\mathrm{ISR\\_exec}} + t_{\\mathrm{set}} = (17 \\times 10^{-6} \\ \\mathrm{s}) + (200 \\times 10^{-9} \\ \\mathrm{s})$$\n$$T_{\\mathrm{interval}}^{\\min} = (17 \\times 10^{-6} \\ \\mathrm{s}) + (0.2 \\times 10^{-6} \\ \\mathrm{s}) = 17.2 \\times 10^{-6} \\ \\mathrm{s}$$\nThis minimum interval is equal to $1 / (r \\cdot f_{\\mathrm{s}}^{\\max})$.\n$$f_{\\mathrm{s}}^{\\max} = \\frac{1}{r \\cdot T_{\\mathrm{interval}}^{\\min}} = \\frac{1}{2 \\cdot (17.2 \\times 10^{-6} \\ \\mathrm{s})} = \\frac{1}{34.4 \\times 10^{-6} \\ \\mathrm{s}}$$\n$$f_{\\mathrm{s}}^{\\max} = \\frac{10^{6}}{34.4} \\ \\mathrm{s}^{-1} \\approx 29069.76744 \\ \\mathrm{Hz}$$\nThe problem asks for the answer to be expressed in kilohertz (kHz) and rounded to four significant figures.\n$$f_{\\mathrm{s}}^{\\max} \\approx 29.06976744 \\ \\mathrm{kHz}$$\nRounding to four significant figures gives:\n$$f_{\\mathrm{s}}^{\\max} \\approx 29.07 \\ \\mathrm{kHz}$$",
            "answer": "$$\\boxed{29.07}$$"
        }
    ]
}