{
    "hands_on_practices": [
        {
            "introduction": "硬件在环 (HIL) 仿真的一个核心挑战是精确地再现控制器与功率级之间的接口。此练习关注输出接口，即 HIL 仿真器如何生成脉宽调制 (PWM) 信号。您将通过计算确定确保所需占空比分辨率所需的最小定时器时钟频率，从而深入理解 HIL 平台输出保真度的基本硬件限制 。",
            "id": "3845360",
            "problem": "一个实时硬件在环（HIL）平台被用于测试一个数字控制的直流到直流电源转换器的闭环行为。脉冲宽度调制（PWM）的门控信号由HIL目标上的一个定时器外设合成。为确保控制器施加的占空比变化不大于指定的分辨率，HIL定时器必须在一个开关周期内提供足够的时间量化。开关频率固定为 $f_{sw} = 50~\\text{kHz}$。PWM占空比 $D$ 定义为导通时间 $t_{on}$ 与开关周期 $T_{sw}$ 的比值，即 $D = t_{on}/T_{sw}$。定时器以等于定时器时钟周期的离散增量生成 $t_{on}$，我们称之为时间分辨率 $t_{res}$。\n\n为了保证HIL的保真度，要求的最差情况占空比增量为满量程的 $0.1\\%$。从 $T_{sw}$ 和 $D$ 的定义以及由 $t_{res}$ 施加的量化关系出发，确定在 $f_{sw} = 50~\\text{kHz}$ 时能保证占空比增量为 $0.1\\%$ 的最小时间分辨率 $t_{res}$，然后计算实现此时间分辨率所需的相应最小定时器时钟频率 $f_{clk}$。\n\n将时间分辨率以纳秒表示，定时器时钟频率以兆赫兹表示。提供精确值；无需四舍五入。将您的最终答案以行矩阵的形式报告，其中第一个条目是时间分辨率（单位为纳秒），第二个条目是定时器时钟频率（单位为兆赫兹）。",
            "solution": "开关周期由开关频率的倒数给出。使用基本定义，\n$$\nT_{sw} = \\frac{1}{f_{sw}}.\n$$\n占空比 $D$ 定义为\n$$\nD = \\frac{t_{on}}{T_{sw}},\n$$\n其中 $t_{on}$ 是一个开关周期内PWM的导通时间。在数字实现中，$t_{on}$ 只能以定时器时钟周期设定的离散增量变化。令 $t_{res}$ 表示定时器的时间分辨率（$t_{on}$ 的最小可能增量）。那么，可实现的最小占空比变化 $\\Delta D$ 由一个时间分辨率步长与开关周期的比值确定：\n$$\n\\Delta D = \\frac{t_{res}}{T_{sw}}.\n$$\n为保证占空比分辨率最多为 $0.1\\%$，我们需要\n$$\n\\Delta D \\leq 0.001,\n$$\n因为 $0.1\\%$ 对应于小数 $0.001$。通过设等式来找到所需的最小分辨率，\n$$\n\\frac{t_{res}}{T_{sw}} = 0.001 \\quad \\Rightarrow \\quad t_{res} = 0.001\\, T_{sw}.\n$$\n将开关频率 $f_{sw} = 50~\\text{kHz}$ 代入 $T_{sw}$，\n$$\nT_{sw} = \\frac{1}{50 \\times 10^{3}}~\\text{s} = 20 \\times 10^{-6}~\\text{s}.\n$$\n因此，\n$$\nt_{res} = 0.001 \\times 20 \\times 10^{-6}~\\text{s} = 20 \\times 10^{-9}~\\text{s}.\n$$\n因此，所需的时间分辨率为 $20~\\text{ns}$。\n\n定时器时钟频率 $f_{clk}$ 是时间分辨率的倒数，因为每个时钟滴答对应一个 $t_{res}$：\n$$\nf_{clk} = \\frac{1}{t_{res}} = \\frac{1}{20 \\times 10^{-9}~\\text{s}} = 50 \\times 10^{6}~\\text{Hz}.\n$$\n以兆赫兹表示，即为\n$$\nf_{clk} = 50~\\text{MHz}.\n$$\n因此，最小时间分辨率为 $20~\\text{ns}$，相应的最小定时器时钟频率为 $50~\\text{MHz}$。",
            "answer": "$$\\boxed{\\begin{pmatrix}20  50\\end{pmatrix}}$$"
        },
        {
            "introduction": "在 HIL 测试中，除了精确生成控制信号外，精确测量被仿真系统的状态也同样重要。此练习将您的注意力从输出接口转移到输入接口，特别是模数转换器 (ADC) 在量化反馈信号（如电感电流）时的作用。通过这个练习，您将学会如何量化 ADC 引入的噪声，并确定为可靠地解析微小但关键的信号（例如电流纹波）所需的最小位数 。",
            "id": "3845389",
            "problem": "一个硬件在环（HIL）测试台经过仪器配置，用于评估一个数字控制电源转换器的电感电流纹波。电感电流通过一个分流电阻进行检测，并由一个模数转换器（ADC）进行数字化。该转换器表现出角频率为 $\\omega_{r}$ 的单音正弦電流纹波，并叠加在一个直流偏置上。ADC采用均匀中阶量化模型，并以采样频率 $f_{s}$ 进行时钟同步。ADC的满量程输入范围为 $V_{FS}$，且ADC具有 $N$ 位分辨率。\n\n第1部分：在标准加性白量化噪声模型下，计算量化噪声谱密度，作为 $N$、$V_{FS}$ 和 $f_{s}$ 的函数。请以 $\\text{V}^{2}/\\text{Hz}$ 为单位表示您的答案。\n\n第2部分：在HIL测量中，检测到的电流纹波幅值等于 $0.5\\ \\text{A}$ 单音纹波的 $1\\%$，并通过一个值为 $R_{s} = 5 \\times 10^{-3}\\ \\Omega$ 的分流电阻将其转换为电压。控制器使用一个数字处理链来估计纹波幅值，该处理链的有效矩形测量带宽为 $B = 1.0 \\times 10^{4}\\ \\text{Hz}$，并以 $\\omega_{r}$ 为中心。定义“分辨”为：ADC输入端的纹波电压幅值与测量带宽内的量化噪声均方根值之比至少为 $10$（即幅噪比为 $10$）。在 $V_{FS} = 3.3\\ \\text{V}$ 和 $f_{s} = 5.0 \\times 10^{5}\\ \\text{Hz}$ 的条件下，推导保证此分辨标准的最小整数位数 $N$。\n\n以符号闭合形式报告最终的谱密度，并将最小的 $N$ 作为整数报告。谱密度无需四舍五入。对于位数，报告满足标准的最小整数。谱密度必须以 $\\text{V}^{2}/\\text{Hz}$ 表示。请将您的最终答案作为一个单行向量一起提供。",
            "solution": "该问题分为两部分。首先，我们推导均匀量化器的量化噪声谱密度。其次，我们利用这个结果来根据指定标准确定分辨微小信号所需的ADC最小位数。\n\n第1部分：量化噪声谱密度的推导\n\n对于均匀量化器，其量化误差 $e_q$ 的标准模型假设误差是在单个量化步长上均匀分布的随机变量。对于一个具有满量程输入范围 $V_{FS}$ 的 $N$ 位模数转换器（ADC），存在 $2^N$ 个量化级别。量化步长 $\\Delta$ 由下式给出：\n$$\n\\Delta = \\frac{V_{FS}}{2^N}\n$$\n量化误差 $e_q$ 被建模为一个在区间 $[-\\Delta/2, \\Delta/2]$ 上具有均匀概率密度函数（PDF）的随机变量。其PDF为 $p(e) = 1/\\Delta$（当 $e \\in [-\\Delta/2, \\Delta/2]$ 时），其他情况下为 $0$。\n\n量化噪声的总平均功率 $P_q$ 是该随机变量的方差。由于该分布的均值为零，功率等于误差的均方值：\n$$\nP_q = E[e_q^2] = \\int_{-\\Delta/2}^{\\Delta/2} e^2 p(e) \\, de = \\int_{-\\Delta/2}^{\\Delta/2} e^2 \\frac{1}{\\Delta} \\, de\n$$\n$$\nP_q = \\frac{1}{\\Delta} \\left[ \\frac{e^3}{3} \\right]_{-\\Delta/2}^{\\Delta/2} = \\frac{1}{3\\Delta} \\left( \\left(\\frac{\\Delta}{2}\\right)^3 - \\left(-\\frac{\\Delta}{2}\\right)^3 \\right) = \\frac{1}{3\\Delta} \\left( \\frac{\\Delta^3}{8} + \\frac{\\Delta^3}{8} \\right) = \\frac{2\\Delta^3}{24\\Delta} = \\frac{\\Delta^2}{12}\n$$\n加性白量化噪声模型进一步假设，该总噪声功率均匀分布在Nyquist频带上，该频带从 $f=0$ 延伸到 $f=f_s/2$，其中 $f_s$ 是采样频率。该区间的带宽为 $f_s/2$。\n\n单边功率谱密度 $S_n$ 是单位频率的噪声功率。它在Nyquist频带上是恒定的：\n$$\nS_n = \\frac{P_q}{\\text{Bandwidth}} = \\frac{P_q}{f_s/2} = \\frac{2P_q}{f_s}\n$$\n代入 $P_q$ 的表达式：\n$$\nS_n = \\frac{2}{f_s} \\left( \\frac{\\Delta^2}{12} \\right) = \\frac{\\Delta^2}{6f_s}\n$$\n最后，我们将 $\\Delta$ 的表达式用 $V_{FS}$ 和 $N$ 来表示并代入：\n$$\nS_n = \\frac{1}{6f_s} \\left( \\frac{V_{FS}}{2^N} \\right)^2 = \\frac{V_{FS}^2}{6f_s (2^N)^2} = \\frac{V_{FS}^2}{6f_s 2^{2N}}\n$$\n这就是以 $\\text{V}^2/\\text{Hz}$ 为单位的量化噪声谱密度，表示为 $N$、$V_{FS}$ 和 $f_s$ 的函数。\n\n第2部分：ADC的最小位数\n\n首先，我们计算ADC输入端的电压纹波幅值 $V_{\\text{ripple}}$。电流纹波幅值 $I_{\\text{ripple}}$ 是 $0.5\\ \\text{A}$ 的 $1\\%$：\n$$\nI_{\\text{ripple}} = 0.01 \\times 0.5\\ \\text{A} = 5 \\times 10^{-3}\\ \\text{A}\n$$\n该电流通过分流电阻 $R_s = 5 \\times 10^{-3}\\ \\Omega$ 转换为电压：\n$$\nV_{\\text{ripple}} = I_{\\text{ripple}} \\times R_s = (5 \\times 10^{-3}\\ \\text{A}) \\times (5 \\times 10^{-3}\\ \\Omega) = 2.5 \\times 10^{-5}\\ \\text{V}\n$$\n接下来，我们计算在指定测量带宽 $B = 1.0 \\times 10^{4}\\ \\text{Hz}$ 内的量化噪声电压的均方根值（RMS）$V_{n, \\text{rms}}$。此带宽内的噪声功率 $P_{n,B}$ 是噪声谱密度 $S_n$ 和带宽 $B$ 的乘积：\n$$\nP_{n,B} = S_n \\times B = \\left( \\frac{V_{FS}^2}{6f_s 2^{2N}} \\right) B\n$$\nRMS噪声电压是该功率的平方根：\n$$\nV_{n, \\text{rms}} = \\sqrt{P_{n,B}} = \\sqrt{\\frac{V_{FS}^2 B}{6f_s 2^{2N}}} = \\frac{V_{FS} \\sqrt{B}}{2^N \\sqrt{6f_s}}\n$$\n问题定义的分辨标准为纹波电压幅值与RMS噪声电压之比至少为 $10$：\n$$\n\\frac{V_{\\text{ripple}}}{V_{n, \\text{rms}}} \\ge 10\n$$\n代入 $V_{\\text{ripple}}$ 和 $V_{n, \\text{rms}}$ 的表达式：\n$$\n\\frac{2.5 \\times 10^{-5}}{\\frac{V_{FS} \\sqrt{B}}{2^N \\sqrt{6f_s}}} \\ge 10\n$$\n我们必须解此不等式，求出最小整数 $N$。重新整理不等式以分离出 $2^N$：\n$$\n2^N \\ge \\frac{10 \\cdot V_{FS} \\sqrt{B}}{(2.5 \\times 10^{-5}) \\sqrt{6f_s}}\n$$\n现在我们代入给定的数值：$V_{FS} = 3.3\\ \\text{V}$，$f_s = 5.0 \\times 10^5\\ \\text{Hz}$，以及 $B = 1.0 \\times 10^4\\ \\text{Hz}$。\n$$\n2^N \\ge \\frac{10 \\times 3.3 \\times \\sqrt{1.0 \\times 10^4}}{(2.5 \\times 10^{-5}) \\times \\sqrt{6 \\times (5.0 \\times 10^5)}}\n$$\n$$\n2^N \\ge \\frac{10 \\times 3.3 \\times 100}{(2.5 \\times 10^{-5}) \\times \\sqrt{3.0 \\times 10^6}}\n$$\n$$\n2^N \\ge \\frac{3300}{(2.5 \\times 10^{-5}) \\times \\sqrt{3} \\times 10^3}\n$$\n$$\n2^N \\ge \\frac{3300}{2.5 \\sqrt{3} \\times 10^{-2}} = \\frac{3.3 \\times 10^5}{2.5 \\sqrt{3}}\n$$\n$$\n2^N \\ge \\frac{1.32 \\times 10^5}{\\sqrt{3}} \\approx 76210.05\n$$\n为了找到最小整数 $N$，我们对不等式两边取以2为底的对数：\n$$\nN \\ge \\log_2(76210.05)\n$$\n我们知道 $2^{16} = 65536$ 且 $2^{17} = 131072$。由于 $65536  76210.05  131072$，所以 $\\log_2(76210.05)$ 的值在 $16$ 和 $17$ 之间。具体来说：\n$$\nN \\ge \\frac{\\ln(76210.05)}{\\ln(2)} \\approx \\frac{11.24156}{0.69315} \\approx 16.218\n$$\n由于 $N$ 必须是整数，满足此条件的最小 $N$ 值为 $17$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{V_{FS}^2}{6 f_s 2^{2N}}  17\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "HIL 仿真的核心在于其运行的数学模型，而模型保真度与计算成本之间存在着固有的权衡。此练习探讨了两种常见的电力电子模型：平均模型和开关模型。通过实现这两种模型并量化它们在预测关键动态行为（如电流纹波和次谐波振荡）方面的差异，您将能够为特定的测试场景做出明智的模型选择决策 。",
            "id": "3845398",
            "problem": "考虑一个在峰值电流模式控制下，工作于连续导通模式的直流-直流降压（buck）转换器。在硬件在环（HIL）测试的背景下，转换器对象在运行时被仿真，控制器与该对象的平均模型或开关模型进行交互。您将通过量化在电流模式控制中占空比大于 $0.5$ 时电感电流纹波和次谐波振荡存在的预测误差，来对比平均模型和开关模型的预测结果。\n\n使用以下基本原理：\n- 电感遵循 $v_{L}(t) = L \\, \\frac{d i_{L}(t)}{dt}$。\n- 电容遵循 $i_{C}(t) = C \\, \\frac{d v_{o}(t)}{dt}$。\n- 理想脉冲宽度调制（PWM），开关周期为 $T = \\frac{1}{f_{s}}$，占空比为 $D \\in (0,1)$。\n- 对于降压转换器，理想稳态平均输出电压为 $v_{o,\\text{avg}} = D \\, v_{\\text{in}}$。\n- 在峰值电流模式控制中，在开通时段内，电感电流以斜率 $m_{1} = \\frac{v_{\\text{in}} - v_{o}}{L}$ 增加；在关断时段内，电感电流以斜率 $m_{2} = \\frac{v_{o}}{L}$ 减小。可选的斜坡补偿被建模为一个斜率为 $m_{a}$（单位：安培/秒）的附加斜坡，在关断比较器中与采样电流相加。\n- 状态空间平均模型用一个周期内的平均值替代开关行为，不产生开关频率纹波或采样次谐波现象。\n\n任务：\n1. 实现两种对象模型：\n   - 一个平均模型，根据其构造，该模型预测开关频率下的电感电流纹波为零，且不预测次谐波振荡。\n   - 一个开关模型，该模型基于一个 PWM 周期内的分段线性电感电流波形，预测开关频率下的电感电流纹波幅值，并使用内层电流环的逐周期采样动态来确定是否存在次谐波振荡。\n2. 对于开关模型，推导并使用分段线性斜率来计算电感电流纹波幅值，即一个周期内的峰-谷值差。以安培为单位表示该纹波幅值。\n3. 对于开关模型，推导并使用一个关于周期起始电感电流的采样扰动映射，以确定一个小的扰动是否会逐周期地在幅度上增长。如果扰动增长因子的绝对值严格大于 $1$，则定义为存在次谐波振荡。\n4. 按如下方式量化平均模型和开关模型之间的预测误差：\n   - 纹波误差：平均模型预测的电感电流纹波幅值与开关模型预测值之间的绝对差值，以安培为单位表示，四舍五入到六位小数。\n   - 次谐波失配：一个布尔值，表示平均模型关于无次谐波振荡的预测是否与开关模型的预测不一致（即，如果开关模型预测存在次谐波振荡，则为 True，否则为 False）。\n\n使用以下参数集测试套件，涵盖一个通用情况、一个边界条件和一个补偿后的边缘情况。假设为连续导通模式和理想元件；如果某个模型未使用某个参数，仍需包含该参数以保证完整性和物理真实性。\n\n每个测试用例是一个元组 $(v_{\\text{in}}, L, C, R, f_{s}, D, m_{a})$，单位如下：\n- $v_{\\text{in}}$: 输入电压，单位为伏特。\n- $L$: 电感，单位为亨利。\n- $C$: 电容，单位为法拉。\n- $R$: 负载电阻，单位为欧姆。\n- $f_{s}$: 开关频率，单位为赫兹。\n- $D$: 占空比（无单位）。\n- $m_{a}$: 斜坡补偿，单位为安培/秒。\n\n测试套件：\n- 情况1（正常路径，D0.5 时无补偿）：$(24.0, 100\\times10^{-6}, 470\\times10^{-6}, 4.0, 100\\times10^{3}, 0.6, 0.0)$。\n- 情况2（边界条件，D=0.5 时无补偿）：$(24.0, 100\\times10^{-6}, 470\\times10^{-6}, 4.0, 100\\times10^{3}, 0.5, 0.0)$。\n- 情况3（边缘情况，D0.5 时有补偿）：$(24.0, 100\\times10^{-6}, 470\\times10^{-6}, 4.0, 100\\times10^{3}, 0.7, 60\\times10^{3})$。\n\n您的程序应：\n- 使用 $m_{1}$、$m_{2}$、$T$ 和 $D$ 从第一性原理计算开关模型的纹波幅值。\n- 通过评估从内环斜率和 $m_{a}$ 推导出的采样扰动增长因子，来确定开关模型中是否存在次谐波。\n- 与平均模型的预测（零纹波和无次谐波振荡）进行比较。\n- 生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个测试用例的结果是一个 $[\\text{ripple\\_error\\_A},\\text{subharmonic\\_mismatch}]$ 形式的双元素列表。输出中不得有空格。例如：`[[0.123456,True],[0.000000,False],[0.654321,False]]`。\n\n纹波误差以安培为单位表示，四舍五入到六位小数。本问题不使用角度。不使用百分比；按给定方式将占空比 D 表示为无单位的小数。",
            "solution": "我们从控制降压转换器和峰值电流模式控制的基本定律开始。\n\n电感的电压-电流关系为 $v_{L}(t) = L \\, \\frac{d i_{L}(t)}{dt}$。在理想 PWM 下，开关周期为 $T = \\frac{1}{f_{s}}$，占空比为 $D$，理想降压转换器的平均输出电压为 $v_{o,\\text{avg}} = D \\, v_{\\text{in}}$。在连续导通模式下，在持续时间为 $D T$ 的导通区间内，电感上的电压为 $v_{L} = v_{\\text{in}} - v_{o}$，其电流以斜率增加：\n$$\nm_{1} = \\frac{v_{\\text{in}} - v_{o}}{L}.\n$$\n在持续时间为 $(1 - D) T$ 的关断区间内，电感上的电压为 $v_{L} = - v_{o}$，其电流以斜率减小：\n$$\nm_{2} = \\frac{v_{o}}{L}.\n$$\n对于开关模型，我们计算一个周期内的峰-谷电感电流纹波幅值。从一个谷值 $i_{\\text{val}}$ 开始，导通时间结束时的峰值电流为 $i_{\\text{peak}} = i_{\\text{val}} + m_{1} D T$。因此，纹波幅值（峰值减去谷值）为\n$$\n\\Delta i_{L,\\text{switch}} = i_{\\text{peak}} - i_{\\text{val}} = m_{1} D T.\n$$\n使用 $v_{o} = D \\, v_{\\text{in}}$，我们代入 $m_{1} = \\frac{v_{\\text{in}} - D v_{\\text{in}}}{L} = \\frac{v_{\\text{in}} (1 - D)}{L}$，得到\n$$\n\\Delta i_{L,\\text{switch}} = \\frac{v_{\\text{in}} (1 - D)}{L} \\, D \\, T = \\frac{v_{\\text{in}} (1 - D) D}{L f_{s}}.\n$$\n该表达式是电感方程在导通时间内积分的直接结果。\n\n接下来，我们考虑峰值电流模式控制下的次谐波振荡。当采样电感电流与一个可选的斜坡补偿斜坡之和达到一个固定的参考值时，控制器关断开关。设斜坡补偿为一个斜率为 $m_{a}$（单位：安培/秒）的锯齿波，每个周期复位。令 $i_{n}$ 表示第 $n$ 个周期开始时的电感电流。每个周期的导通时间由比较器条件定义。如果选择固定参考值，以在 $i_{n}$ 等于标称谷值 $i_{0}$ 时强制执行标称导通时间 $D T$，那么参考值满足\n$$\nI_{\\text{ref}} = i_{0} + (m_{1} + m_{a}) D T,\n$$\n因为在导通期间，比较器观察到 $i_{n} + m_{a} t$ 以净斜率 $m_{1} + m_{a}$ 向 $I_{\\text{ref}}$ 上升。对于一个受扰动的周期起始 $i_{n} = i_{0} + \\delta_{n}$，导通时间为\n$$\nt_{\\text{on}}(n) = \\frac{I_{\\text{ref}} - i_{n}}{m_{1} + m_{a}} = \\frac{i_{0} + (m_{1} + m_{a}) D T - (i_{0} + \\delta_{n})}{m_{1} + m_{a}} = D T - \\frac{\\delta_{n}}{m_{1} + m_{a}}.\n$$\n第 $n$ 个周期中的峰值电流为\n$$\ni_{\\text{peak}}(n) = i_{n} + m_{1} t_{\\text{on}}(n) = i_{0} + \\delta_{n} + m_{1} \\left( D T - \\frac{\\delta_{n}}{m_{1} + m_{a}} \\right) = i_{0} + m_{1} D T + \\delta_{n} \\left( 1 - \\frac{m_{1}}{m_{1} + m_{a}} \\right).\n$$\n关断时间为\n$$\nt_{\\text{off}}(n) = T - t_{\\text{on}}(n) = (1 - D) T + \\frac{\\delta_{n}}{m_{1} + m_{a}}.\n$$\n在第 $n+1$ 个周期开始时，电感电流为\n$$\ni_{n+1} = i_{\\text{peak}}(n) - m_{2} t_{\\text{off}}(n) = i_{0} + m_{1} D T - m_{2} (1 - D) T + \\delta_{n} \\left( 1 - \\frac{m_{1}}{m_{1} + m_{a}} - \\frac{m_{2}}{m_{1} + m_{a}} \\right).\n$$\n对于 $v_{o} = D v_{\\text{in}}$ 的降压转换器的稳态工作点，恒等式 $m_{1} D T = m_{2} (1 - D) T$ 成立，因此常数项简化为 $i_{0}$。因此，扰动根据以下线性采样映射演化\n$$\n\\delta_{n+1} = \\left[ 1 - \\frac{m_{1} + m_{2}}{m_{1} + m_{a}} \\right] \\delta_{n}.\n$$\n量\n$$\n\\lambda = 1 - \\frac{m_{1} + m_{2}}{m_{1} + m_{a}}\n$$\n是采样扰动增长因子。如果该因子的绝对值超过 1，即 $|\\lambda| > 1$，则存在次谐波振荡。对于无补偿情况 $m_{a} = 0$，我们有\n$$\n\\lambda = 1 - \\frac{m_{1} + m_{2}}{m_{1}} = - \\frac{m_{2}}{m_{1}} = - \\frac{D}{1 - D},\n$$\n这意味着 $|\\lambda| > 1$ 当且仅当 $D > 0.5$，这恢复了峰值电流模式控制下降压转换器的经典判据。使用斜坡补偿时，稳定性要求 $|\\lambda|  1$，对于正斜率，这简化为不等式\n$$\n\\frac{m_{1} + m_{2}}{m_{1} + m_{a}}  2 \\quad \\Rightarrow \\quad m_{a} > \\frac{m_{2} - m_{1}}{2}.\n$$\n\n平均模型预测：\n- 根据定义，状态空间平均模型不产生开关频率纹波，因此它预测开关频率下的电感电流纹波幅值为零：$\\Delta i_{L,\\text{avg}} = 0$。\n- 平均连续时间模型不表示采样的内环动态，因此无论 $D$ 为何值，它都不会预测电流模式控制下的次谐波振荡；因此其预测为“无次谐波振荡”。\n\n误差度量：\n- 纹波误差为 $|\\Delta i_{L,\\text{switch}} - \\Delta i_{L,\\text{avg}}| = \\Delta i_{L,\\text{switch}}$，以安培表示，并四舍五入到六位小数。\n- 次谐波失配是一个布尔值，如果开关模型预测存在次谐波振荡（$|\\lambda| > 1$），则为 True，否则为 False，因为平均模型总是预测 False。\n\n每个测试用例 $(v_{\\text{in}}, L, C, R, f_{s}, D, m_{a})$ 的算法步骤：\n1. 计算 $T = \\frac{1}{f_{s}}$ 和 $v_{o} = D \\, v_{\\text{in}}$。\n2. 计算 $m_{1} = \\frac{v_{\\text{in}} - v_{o}}{L} = \\frac{v_{\\text{in}} (1 - D)}{L}$ 和 $m_{2} = \\frac{v_{o}}{L} = \\frac{v_{\\text{in}} D}{L}$。\n3. 计算开关模型的纹波幅值 $\\Delta i_{L,\\text{switch}} = m_{1} D T$。\n4. 计算扰动增长因子 $\\lambda = 1 - \\frac{m_{1} + m_{2}}{m_{1} + m_{a}}$，并用条件 $|\\lambda| > 1$ 判断是否存在次谐波。\n5. 将平均模型的纹波设为 $0$，次谐波设为 False。\n6. 将纹波误差计算为 $\\Delta i_{L,\\text{switch}}$（四舍五入到六位小数），将次谐波失配计算为开关模型的次谐波判定结果。\n\n程序为提供的测试套件实现这些步骤，并打印单行输出：一个用方括号括起来的逗号分隔列表，其中每个测试用例包含一个 $[\\text{ripple\\_error\\_A},\\text{subharmonic\\_mismatch}]$ 形式且无空格的双元素列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef switching_ripple(vin, L, fs, D):\n    \"\"\"\n    Compute peak-to-valley inductor current ripple amplitude for a buck converter\n    under ideal switching using slopes and duty ratio.\n\n    Δi = m1 * D * T, with m1 = (vin - vo)/L and vo = D * vin.\n    \"\"\"\n    T = 1.0 / fs\n    vo = D * vin\n    m1 = (vin - vo) / L\n    delta_i = m1 * D * T\n    return delta_i\n\ndef perturbation_growth_factor(vin, L, D, m_a):\n    \"\"\"\n    Compute the sampled perturbation growth factor λ for peak current-mode control\n    with optional slope compensation m_a (A/s).\n\n    λ = 1 - (m1 + m2) / (m1 + m_a), with m1 = (vin - vo)/L, m2 = vo/L, vo = D*vin.\n    \"\"\"\n    vo = D * vin\n    m1 = (vin - vo) / L\n    m2 = vo / L\n    # Avoid division by zero: if m1 + m_a == 0, define λ -> +inf to indicate instability.\n    denom = m1 + m_a\n    if denom == 0:\n        return np.inf\n    lam = 1.0 - (m1 + m2) / denom\n    return lam\n\ndef analyze_case(case):\n    vin, L, C, R, fs, D, m_a = case\n    # Switching model predictions\n    ripple_switch = switching_ripple(vin, L, fs, D)\n    lam = perturbation_growth_factor(vin, L, D, m_a)\n    subharmonic_switch = abs(lam) > 1.0  # strict inequality for D>0.5 criterion\n    # Averaged model predictions\n    ripple_avg = 0.0\n    subharmonic_avg = False\n    # Errors\n    ripple_error = ripple_switch - ripple_avg\n    # Round ripple error to six decimal places\n    ripple_error_fmt = f\"{ripple_error:.6f}\"\n    subharmonic_mismatch = (subharmonic_switch != subharmonic_avg)\n    return ripple_error_fmt, subharmonic_mismatch\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (vin, L, C, R, fs, D, m_a)\n        (24.0, 100e-6, 470e-6, 4.0, 100e3, 0.6, 0.0),       # Case 1: happy path, D>0.5, no compensation\n        (24.0, 100e-6, 470e-6, 4.0, 100e3, 0.5, 0.0),       # Case 2: boundary, D=0.5, no compensation\n        (24.0, 100e-6, 470e-6, 4.0, 100e3, 0.7, 60e3),      # Case 3: compensated edge case, D>0.5\n    ]\n\n    results = []\n    for case in test_cases:\n        ripple_error, mismatch = analyze_case(case)\n        # Build string for [float,bool] with no spaces\n        pair_str = f\"[{ripple_error},{str(mismatch)}]\"\n        results.append(pair_str)\n\n    # Final print statement in the exact required format (no spaces).\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}