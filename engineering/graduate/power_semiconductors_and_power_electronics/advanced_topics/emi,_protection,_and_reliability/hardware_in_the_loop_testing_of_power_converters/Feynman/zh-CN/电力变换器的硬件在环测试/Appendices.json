{
    "hands_on_practices": [
        {
            "introduction": "硬件在环（HIL）仿真的核心在于选择合适的数学模型来代表电力电子设备。模型选择是在计算效率和仿真精度之间做出的关键权衡。本练习通过对比平均模型和开关模型，揭示了不同模型保真度下的预测能力差异，并阐明了为何需要高保真模型来捕捉诸如次谐波振荡等关键的动态行为。",
            "id": "3845398",
            "problem": "考虑一个在峰值电流模式控制下，工作于连续导通模式的直流-直流降压（buck）转换器。在硬件在环（HIL）测试的背景下，转换器对象在运行时被仿真，控制器与对象的平均模型或开关模型进行交互。您将通过量化在电流模式控制下占空比大于 $0.5$ 时，电感电流纹波预测误差以及次谐波振荡的存在性，来对比平均模型和开关模型的预测结果。\n\n使用以下基本依据：\n- 电感遵循 $v_{L}(t) = L \\, \\frac{d i_{L}(t)}{dt}$。\n- 电容遵循 $i_{C}(t) = C \\, \\frac{d v_{o}(t)}{dt}$。\n- 理想的脉冲宽度调制（PWM），开关周期为 $T = \\frac{1}{f_{s}}$，占空比为 $D \\in (0,1)$。\n- 对于 buck 转换器，理想的稳态平均输出电压为 $v_{o,\\text{avg}} = D \\, v_{\\text{in}}$。\n- 在峰值电流模式控制中，在开关导通期间，电感电流以斜率 $m_{1} = \\frac{v_{\\text{in}} - v_{o}}{L}$ 增加；在关断期间，电感电流以斜率 $m_{2} = \\frac{v_{o}}{L}$ 减小。可选的斜坡补偿被建模为一个斜率为 $m_{a}$（单位为安培/秒）的附加斜坡，在关断比较器中与检测到的电流相加。\n- 状态空间平均模型用一个周期内的平均值替换开关行为，不产生开关频率纹波或采样的次谐波现象。\n\n任务：\n1. 实现两个对象模型：\n   - 一个平均模型，根据其构造，预测开关频率下的电感电流纹波为零，并且不预测次谐波振荡。\n   - 一个开关模型，根据一个 PWM 周期内的分段线性电感电流波形，预测开关频率下的电感电流纹波幅值，并使用内部电流环的逐周期采样动态来确定次谐波振荡的存在。\n2. 对于开关模型，推导并使用分段线性斜率来计算电感电流纹波幅值，即一个周期内的峰-谷值差。以安培表示纹波幅值。\n3. 对于开关模型，推导并使用一个关于周期起始电感电流的采样扰动映射，以确定一个小的扰动是否会逐周期地在幅度上增长。如果扰动增长因子的幅度严格大于 $1$，则定义为存在次谐波振荡。\n4. 如下量化平均模型和开关模型之间的预测误差：\n   - 纹波误差：平均模型预测的电感电流纹波幅值与开关模型预测值之间的绝对差值，以安培表示，四舍五入到六位小数。\n   - 次谐波不匹配：一个布尔值，指示平均模型关于无次谐波振荡的预测是否与开关模型的预测不一致（即，如果开关模型预测存在次谐波振荡，则为 True，否则为 False）。\n\n使用以下覆盖常规情况、边界条件和补偿边缘情况的参数集测试套件。假设连续导通和理想元件；如果某个模型未使用某个参数，仍应包含它以保证完整性和物理真实性。\n\n每个测试用例是一个元组 $(v_{\\text{in}}, L, C, R, f_{s}, D, m_{a})$，单位如下：\n- $v_{\\text{in}}$: 输入电压，单位为伏特。\n- $L$: 电感，单位为亨利。\n- $C$: 电容，单位为法拉。\n- $R$: 负载电阻，单位为欧姆。\n- $f_{s}$: 开关频率，单位为赫兹。\n- $D$: 占空比（无单位）。\n- $m_{a}$: 斜坡补偿，单位为安培/秒。\n\n测试套件：\n- 用例 1（常规情况，在 $D>0.5$ 时未补偿）：$(24.0, 100\\times10^{-6}, 470\\times10^{-6}, 4.0, 100\\times10^{3}, 0.6, 0.0)$。\n- 用例 2（边界情况，在 $D=0.5$ 时未补偿）：$(24.0, 100\\times10^{-6}, 470\\times10^{-6}, 4.0, 100\\times10^{3}, 0.5, 0.0)$。\n- 用例 3（边缘情况，在 $D>0.5$ 时已补偿）：$(24.0, 100\\times10^{-6}, 470\\times10^{-6}, 4.0, 100\\times10^{3}, 0.7, 60\\times10^{3})$。\n\n您的程序应：\n- 从第一性原理出发，使用 $m_{1}$、$m_{2}$、$T$ 和 $D$ 计算开关模型的纹波幅值。\n- 通过评估从内部环路斜率和 $m_{a}$ 推导出的采样扰动增长因子，来确定开关模型中次谐波的存在。\n- 与平均模型的预测（零纹波和无次谐波振荡）进行比较。\n- 生成一行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个测试用例的结果是一个形式为 $[\\text{ripple\\_error\\_A},\\text{subharmonic\\_mismatch}]$ 的双元素列表。输出中不得有任何空格。例如：`[[0.123456,True],[0.000000,False],[0.654321,False]]`。\n\n纹波误差以安培表示，四舍五入到六位小数。本问题不使用角度。不使用百分比；占空比 $D$ 表示为给定的无单位小数。",
            "solution": "我们从控制 buck 转换器和峰值电流模式控制的基本定律开始。\n\n电感的电压-电流关系为 $v_{L}(t) = L \\, \\frac{d i_{L}(t)}{dt}$。在理想的 PWM 条件下，开关周期为 $T = \\frac{1}{f_{s}}$，占空比为 $D$，理想 buck 转换器的平均输出电压为 $v_{o,\\text{avg}} = D \\, v_{\\text{in}}$。在连续导通模式下，在持续时间为 $D T$ 的导通期间，电感两端电压为 $v_{L} = v_{\\text{in}} - v_{o}$，其电流以斜率增加\n$$\nm_{1} = \\frac{v_{\\text{in}} - v_{o}}{L}.\n$$\n在持续时间为 $(1 - D) T$ 的关断期间，电感两端电压为 $v_{L} = - v_{o}$，其电流以斜率减小\n$$\nm_{2} = \\frac{v_{o}}{L}.\n$$\n对于开关模型，我们计算一个周期内的峰-谷值电感电流纹波幅值。从谷值 $i_{\\text{val}}$ 开始，导通时间结束时的峰值电流为 $i_{\\text{peak}} = i_{\\text{val}} + m_{1} D T$。因此，纹波幅值（峰值减谷值）为\n$$\n\\Delta i_{L,\\text{switch}} = i_{\\text{peak}} - i_{\\text{val}} = m_{1} D T.\n$$\n使用 $v_{o} = D \\, v_{\\text{in}}$，我们代入 $m_{1} = \\frac{v_{\\text{in}} - D v_{\\text{in}}}{L} = \\frac{v_{\\text{in}} (1 - D)}{L}$，得到\n$$\n\\Delta i_{L,\\text{switch}} = \\frac{v_{\\text{in}} (1 - D)}{L} \\, D \\, T = \\frac{v_{\\text{in}} (1 - D) D}{L f_{s}}.\n$$\n此表达式是直接对导通期间的电感方程积分得到的。\n\n接下来我们考虑峰值电流模式控制下的次谐波振荡。当检测到的电感电流与一个可选的斜坡补偿斜坡之和达到一个固定的参考值时，控制器关闭开关。设斜坡补偿为一个斜率为 $m_{a}$（单位为安培/秒）的锯齿波，每个周期复位。设 $i_{n}$ 表示第 $n$ 个周期开始时的电感电流。每个周期的导通时间由比较器条件定义。如果选择固定参考值以在 $i_{n}$ 等于标称谷值 $i_{0}$ 时强制执行标称导通时间 $D T$，则该参考值满足\n$$\nI_{\\text{ref}} = i_{0} + (m_{1} + m_{a}) D T,\n$$\n因为在导通期间，比较器观察到 $i_{n} + m_{a} t$ 以净斜率 $m_{1} + m_{a}$ 上升至 $I_{\\text{ref}}$。对于一个受扰动的周期起始值 $i_{n} = i_{0} + \\delta_{n}$，导通时间为\n$$\nt_{\\text{on}}(n) = \\frac{I_{\\text{ref}} - i_{n}}{m_{1} + m_{a}} = \\frac{i_{0} + (m_{1} + m_{a}) D T - (i_{0} + \\delta_{n})}{m_{1} + m_{a}} = D T - \\frac{\\delta_{n}}{m_{1} + m_{a}}.\n$$\n第 $n$ 个周期中的峰值电流为\n$$\ni_{\\text{peak}}(n) = i_{n} + m_{1} t_{\\text{on}}(n) = i_{0} + \\delta_{n} + m_{1} \\left( D T - \\frac{\\delta_{n}}{m_{1} + m_{a}} \\right) = i_{0} + m_{1} D T + \\delta_{n} \\left( 1 - \\frac{m_{1}}{m_{1} + m_{a}} \\right).\n$$\n关断时间为\n$$\nt_{\\text{off}}(n) = T - t_{\\text{on}}(n) = (1 - D) T + \\frac{\\delta_{n}}{m_{1} + m_{a}}.\n$$\n在第 $n+1$ 个周期开始时，电感电流为\n$$\ni_{n+1} = i_{\\text{peak}}(n) - m_{2} t_{\\text{off}}(n) = i_{0} + m_{1} D T - m_{2} (1 - D) T + \\delta_{n} \\left( 1 - \\frac{m_{1}}{m_{1} + m_{a}} - \\frac{m_{2}}{m_{1} + m_{a}} \\right).\n$$\n对于 $v_{o} = D v_{\\text{in}}$ 的 buck 转换器稳态工作点，恒等式 $m_{1} D T = m_{2} (1 - D) T$ 成立，因此常数项简化为 $i_{0}$。因此，扰动根据线性采样映射演化\n$$\n\\delta_{n+1} = \\left[ 1 - \\frac{m_{1} + m_{2}}{m_{1} + m_{a}} \\right] \\delta_{n}.\n$$\n量\n$$\n\\lambda = 1 - \\frac{m_{1} + m_{2}}{m_{1} + m_{a}}\n$$\n是采样扰动增长因子。如果该因子的幅度超过 1，即 $|\\lambda| > 1$，则存在次谐波振荡。对于无补偿的情况 $m_{a} = 0$，我们有\n$$\n\\lambda = 1 - \\frac{m_{1} + m_{2}}{m_{1}} = - \\frac{m_{2}}{m_{1}} = - \\frac{D}{1 - D},\n$$\n这意味着 $|\\lambda| > 1$ 当且仅当 $D > 0.5$，这恢复了 buck 转换器在峰值电流模式控制下的经典判据。带斜坡补偿时，稳定性要求 $|\\lambda|  1$。对于正斜率，这简化为不等式 $\\frac{m_{1} + m_{2}}{m_{1} + m_{a}}  2 \\implies m_{a} > \\frac{m_{2} - m_{1}}{2}$。\n\n平均模型预测：\n- 根据定义，状态空间平均模型不产生开关频率纹波，因此它预测开关频率下的电感电流纹波幅值为零：$\\Delta i_{L,\\text{avg}} = 0$。\n- 平均连续时间模型不表示采样的内部环路动态，因此无论 $D$ 为何值，它都不预测电流模式控制下的次谐波振荡；因此其预测为“无次谐波振荡”。\n\n误差度量：\n- 纹波误差是 $|\\Delta i_{L,\\text{switch}} - \\Delta i_{L,\\text{avg}}| = \\Delta i_{L,\\text{switch}}$，以安培表示并四舍五入到六位小数。\n- 次谐波不匹配是一个布尔值，如果开关模型预测存在次谐波振荡（$|\\lambda| > 1$），则为 True，否则为 False，因为平均模型总是预测为 False。\n\n每个测试用例 $(v_{\\text{in}}, L, C, R, f_{s}, D, m_{a})$ 的算法步骤：\n1. 计算 $T = \\frac{1}{f_{s}}$ 和 $v_{o} = D \\, v_{\\text{in}}$。\n2. 计算 $m_{1} = \\frac{v_{\\text{in}} - v_{o}}{L} = \\frac{v_{\\text{in}} (1 - D)}{L}$ 和 $m_{2} = \\frac{v_{o}}{L} = \\frac{v_{\\text{in}} D}{L}$。\n3. 计算开关模型的纹波幅值 $\\Delta i_{L,\\text{switch}} = m_{1} D T$。\n4. 计算扰动增长因子 $\\lambda = 1 - \\frac{m_{1} + m_{2}}{m_{1} + m_{a}}$ 并用条件 $|\\lambda| > 1$ 判断是否存在次谐波。\n5. 将平均模型的纹波设为 $0$，次谐波设为 False。\n6. 计算纹波误差为 $\\Delta i_{L,\\text{switch}}$（四舍五入到六位小数）和次谐波不匹配为开关模型的次谐波判断结果。\n\n程序为提供的测试套件实现这些步骤，并打印单行输出：一个用方括号括起来的逗号分隔列表，其中每个测试用例的结果为 $[\\text{ripple\\_error\\_A},\\text{subharmonic\\_mismatch}]$ 形式的双元素列表，不含空格。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef switching_ripple(vin, L, fs, D):\n    \"\"\"\n    Compute peak-to-valley inductor current ripple amplitude for a buck converter\n    under ideal switching using slopes and duty ratio.\n\n    Δi = m1 * D * T, with m1 = (vin - vo)/L and vo = D * vin.\n    \"\"\"\n    T = 1.0 / fs\n    vo = D * vin\n    m1 = (vin - vo) / L\n    delta_i = m1 * D * T\n    return delta_i\n\ndef perturbation_growth_factor(vin, L, D, m_a):\n    \"\"\"\n    Compute the sampled perturbation growth factor λ for peak current-mode control\n    with optional slope compensation m_a (A/s).\n\n    λ = 1 - (m1 + m2) / (m1 + m_a), with m1 = (vin - vo)/L, m2 = vo/L, vo = D*vin.\n    \"\"\"\n    vo = D * vin\n    m1 = (vin - vo) / L\n    m2 = vo / L\n    # Avoid division by zero: if m1 + m_a == 0, define λ - +inf to indicate instability.\n    denom = m1 + m_a\n    if denom == 0:\n        return np.inf\n    lam = 1.0 - (m1 + m2) / denom\n    return lam\n\ndef analyze_case(case):\n    vin, L, C, R, fs, D, m_a = case\n    # Switching model predictions\n    ripple_switch = switching_ripple(vin, L, fs, D)\n    lam = perturbation_growth_factor(vin, L, D, m_a)\n    subharmonic_switch = abs(lam)  1.0  # strict inequality for D0.5 criterion\n    # Averaged model predictions\n    ripple_avg = 0.0\n    subharmonic_avg = False\n    # Errors\n    ripple_error = ripple_switch - ripple_avg\n    # Round ripple error to six decimal places\n    ripple_error = round(ripple_error, 6)\n    subharmonic_mismatch = (subharmonic_switch != subharmonic_avg)\n    return ripple_error, subharmonic_mismatch\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (vin, L, C, R, fs, D, m_a)\n        (24.0, 100e-6, 470e-6, 4.0, 100e3, 0.6, 0.0),       # Case 1: happy path, D0.5, no compensation\n        (24.0, 100e-6, 470e-6, 4.0, 100e3, 0.5, 0.0),       # Case 2: boundary, D=0.5, no compensation\n        (24.0, 100e-6, 470e-6, 4.0, 100e3, 0.7, 60e3),      # Case 3: compensated edge case, D0.5\n    ]\n\n    results = []\n    for case in test_cases:\n        ripple_error, mismatch = analyze_case(case)\n        # Build string for [float,bool] with no spaces\n        pair_str = f\"[{ripple_error},{str(mismatch)}]\"\n        results.append(pair_str)\n\n    # Final print statement in the exact required format (no spaces).\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在选择了系统模型之后，下一步是在每个仿真时间步内对其方程进行数值求解。电力电子电路通常包含差异巨大的时间常数，构成“刚性”系统，这对数值积分器的稳定性提出了严峻挑战。本练习将指导您评估和选择合适的隐式积分方案与时间步长，以确保仿真在面对刚性问题时既能保持稳定又兼顾计算效率。",
            "id": "3845343",
            "problem": "在一个电力转换器的硬件在环（HIL）测试中，您正在仿真一个刚性且轻阻尼的串联$LC$网络。该$LC$网络代表了待测的无源功率级滤波器，必须在不发散的情况下进行实时数值积分。您的任务是仅从电路定律和标准数值方法定义出发，构建隐式单步积分方案，评估其离散时间稳定性和数值条件，并选择一个能够防止发散同时保持计算效率的方案和采样周期。\n\n物理对象是一个串联的电阻-电感-电容支路，其中支路电流为$i(t)$，电容电压为$v_C(t)$。使用基尔霍夫电压定律和电容的电流-电压关系作为基本依据：\n- $L \\dfrac{di(t)}{dt} + R\\,i(t) + v_C(t) = 0$，\n- $\\dfrac{dv_C(t)}{dt} = \\dfrac{i(t)}{C}$，\n其中$R$是电阻（单位为$\\Omega$），$L$是电感（单位为$\\mathrm{H}$），$C$是电容（单位为$\\mathrm{F}$）。令状态为$x(t) = \\begin{bmatrix} i(t) \\\\ v_C(t) \\end{bmatrix}$，并将动力学系统写作$\\dfrac{dx(t)}{dt} = A\\,x(t)$，其中$A$是由$R$、$L$和$C$决定的常数矩阵。\n\n在固定的采样周期$T_s$上构建两种隐式积分方案：\n- 后向欧拉法，其定义为在$t_{k+1}$时刻评估时间导数。\n- 梯形法则，其定义为在$[t_k, t_{k+1}]$区间上对状态积分进行梯形近似。\n\n对于每种方案，推导其对应的离散时间状态转移形式$x_{k+1} = M\\,x_k$，其中$M$是一个依赖于$A$和$T_s$的$2\\times 2$矩阵。通过谱半径$\\rho(M)$评估数值稳定性，并要求$\\rho(M) \\leq 1$以宣告“不发散”。通过每个隐式步骤中必须求逆的线性系统矩阵的2-范数条件数来评估数值可解性，并要求该条件数小于或等于一个预设界限$\\kappa_{\\max}$。\n\n设计一个算法，为下述每个测试用例选择：\n- 一个隐式方案（后向欧拉法编码为$0$，梯形法则编码为$1$），\n- 从给定的候选集合中选择一个最大的采样周期$T_s$（单位为秒），该周期需同时满足$\\rho(M) \\leq 1$和条件数界限。\n\n此外，为了反映低阻尼共振行为，需整合以下方案偏好策略：如果系统的连续时间特征值的实部与虚部之比较小，则优先选择梯形法则（保能行为），除非其条件数界限被违反，此时退而求其次选择后向欧拉法；否则，优先选择后向欧拉法（数值阻尼），除非其条件数界限被违反，此时尝试梯形法则。\n\n使用以下常数和候选采样周期：\n- 条件数界限 $\\kappa_{\\max} = 10^{8}$。\n- 候选采样周期 $T_s \\in \\{ 1\\times 10^{-7}, 5\\times 10^{-7}, 1\\times 10^{-6}, 5\\times 10^{-6}, 1\\times 10^{-5}, 5\\times 10^{-5}, 1\\times 10^{-4} \\}$ 秒。\n- 通过比率$\\beta = \\dfrac{\\max\\limits_i |\\Re(\\lambda_i(A))|}{\\max\\limits_i |\\Im(\\lambda_i(A))|}$定义“低阻尼”偏好阈值，规则为“如果$\\beta \\leq 10^{-2}$，则优先选择梯形法则”。\n\n测试套件：在以下参数集上评估您的算法，所有参数均以国际单位制（SI）表示：\n- 用例 $1$：$L = 1\\times 10^{-6}\\,\\mathrm{H}$，$C = 1\\times 10^{-5}\\,\\mathrm{F}$，$R = 1\\times 10^{-2}\\,\\Omega$。\n- 用例 $2$：$L = 1\\times 10^{-3}\\,\\mathrm{H}$，$C = 1\\times 10^{-6}\\,\\mathrm{F}$，$R = 0\\,\\Omega$。\n- 用例 $3$：$L = 1\\times 10^{-5}\\,\\mathrm{H}$，$C = 1\\times 10^{-7}\\,\\mathrm{F}$，$R = 1\\times 10^{-1}\\,\\Omega$。\n- 用例 $4$：$L = 1\\times 10^{-7}\\,\\mathrm{H}$，$C = 1\\times 10^{-7}\\,\\mathrm{F}$，$R = 1\\times 10^{-4}\\,\\Omega$。\n\n本问题不要求使用角度单位。所有采样周期必须以秒为单位表示。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。每个结果必须是$[\\text{scheme\\_id}, T_s]$形式的双元素列表，其中$T_s$是数值，单位为秒，例如$[[0,1\\times 10^{-6}],[1,5\\times 10^{-5}],\\dots]$。所有用例的输出必须按照所列用例的顺序汇总到一个这样的顶层列表中，并打印在单行上。",
            "solution": "本问题要求设计一种算法，为刚性、轻阻尼串联RLC电路的实时仿真选择最优的隐式积分方案和采样周期。该选择必须满足数值稳定性和计算条件方面的约束。\n\n首先，我们建立RLC电路的连续时间状态空间模型。其控制微分方程由基尔霍夫电压定律和电容的本构关系给出：\n$$\nL \\frac{di(t)}{dt} + R\\,i(t) + v_C(t) = 0\n$$\n$$\n\\frac{dv_C(t)}{dt} = \\frac{i(t)}{C}\n$$\n将状态向量定义为$x(t) = \\begin{bmatrix} i(t) \\\\ v_C(t) \\end{bmatrix}$，我们可以将这些方程重排为标准的状态空间形式$\\frac{dx(t)}{dt} = A\\,x(t)$。第一个方程给出$\\frac{di}{dt} = -\\frac{R}{L}i(t) - \\frac{1}{L}v_C(t)$。第二个方程为$\\frac{dv_C}{dt} = \\frac{1}{C}i(t) + 0 \\cdot v_C(t)$。因此，状态矩阵$A$为：\n$$\nA = \\begin{bmatrix} -R/L  -1/L \\\\ 1/C  0 \\end{bmatrix}\n$$\n接下来，我们推导在采样周期$T_s$下，两种指定隐式积分方案的离散时间状态转移矩阵。离散时间系统的形式为$x_{k+1} = M x_k$，其中$x_k = x(kT_s)$。\n\n对于后向欧拉（BE）法，导数在未来时间步$t_{k+1}$处进行近似：\n$$\n\\frac{x_{k+1} - x_k}{T_s} = A x_{k+1}\n$$\n为求得状态转移矩阵$M_{BE}$，我们求解$x_{k+1}$：\n$$\nx_k = x_{k+1} - T_s A x_{k+1} = (I - T_s A) x_{k+1}\n$$\n$$\nx_{k+1} = (I - T_s A)^{-1} x_k\n$$\n其中$I$是$2 \\times 2$的单位矩阵。状态转移矩阵为$M_{BE} = (I - T_s A)^{-1}$。该隐式步骤的实现需要求解一个以矩阵$S_{BE} = I - T_s A$为系数的线性系统。该矩阵的数值条件是一个关键约束。\n\n对于梯形法则（TR），状态积分在区间$[t_k, t_{k+1}]$上进行近似：\n$$\nx_{k+1} - x_k = \\frac{T_s}{2} (A x_k + A x_{k+1})\n$$\n求解$x_{k+1}$：\n$$\nx_{k+1} - \\frac{T_s}{2} A x_{k+1} = x_k + \\frac{T_s}{2} A x_k\n$$\n$$\n\\left(I - \\frac{T_s}{2} A\\right) x_{k+1} = \\left(I + \\frac{T_s}{2} A\\right) x_k\n$$\n$$\nx_{k+1} = \\left(I - \\frac{T_s}{2} A\\right)^{-1} \\left(I + \\frac{T_s}{2} A\\right) x_k\n$$\n状态转移矩阵为$M_{TR} = (I - \\frac{T_s}{2} A)^{-1} (I + \\frac{T_s}{2} A)$。此步骤需要求解一个涉及矩阵$S_{TR} = I - \\frac{T_s}{2} A$的线性系统。\n\n离散时间系统的稳定性由转移矩阵的谱半径$\\rho(M)$决定。防止发散的条件是$\\rho(M) \\leq 1$。连续时间矩阵$A$的特征值为$\\lambda_i(A) = -\\frac{R}{2L} \\pm \\sqrt{(\\frac{R}{2L})^2 - \\frac{1}{LC}}$。对于任何物理上的无源RLC电路，$R \\ge 0$，$L  0$ 且 $C  0$，这保证了特征值的实部非正，即$\\Re(\\lambda_i(A)) \\le 0$。后向欧拉法和梯形法则都是A-稳定的，这意味着它们的绝对稳定域包含整个复平面的左半部分。因此，对于任何满足$\\Re(\\lambda_i(A)) \\le 0$的系统，对于任意选择的$T_s  0$，这两种方案都将产生一个稳定的离散时间系统，其$\\rho(M) \\leq 1$。因此，稳定性约束总是被满足。\n\n主要的算法约束是数值可解性，通过每步求逆的矩阵的2-范数条件数来评估。我们要求$\\kappa_2(S) \\leq \\kappa_{\\max} = 10^8$，其中$S$为$S_{BE}$或$S_{TR}$。\n\n该算法还必须实现一个方案偏好策略。对于欠阻尼系统，其矩阵$A$的特征值为复数，比率$\\beta = \\frac{\\max_i |\\Re(\\lambda_i(A))|}{\\max_i |\\Im(\\lambda_i(A))|}$量化了阻尼相对于振荡频率的大小。如果$\\beta \\leq 10^{-2}$（低阻尼），则优先选择梯形法则（方案ID为$1$），该方法对于纯振荡系统是保能的。否则，优先选择后向欧拉法（方案ID为$0$），该方法会引入数值阻尼。这一偏好会被遵守，除非首选方案的条件数超过$\\kappa_{\\max}$，在这种情况下，算法将退而求其次选择另一种方案。\n\n最终的算法如下：\n对于每组给定的参数$(L, C, R)$：\n1. 构建状态矩阵 $A = \\begin{bmatrix} -R/L  -1/L \\\\ 1/C  0 \\end{bmatrix}$。\n2. 计算$A$的特征值，并基于$\\beta$比率确定方案的偏好顺序（例如，$[1, 0]$表示优先选择梯形法则，$[0, 1]$表示优先选择后向欧拉法）。如果特征值为实数（$\\Im(\\lambda_i) = 0$），则优先选择后向欧拉法。\n3. 按降序遍历候选采样周期$T_s$，从$10^{-4}$秒到$10^{-7}$秒。\n4. 对于每个$T_s$，按偏好顺序测试各个方案。\n5. 对于当前方案，构建相应的系统矩阵$S$（$S_{BE}$或$S_{TR}$）。\n6. 计算2-范数条件数$\\kappa_2(S)$。\n7. 如果$\\kappa_2(S) \\leq \\kappa_{\\max}$，则这对（方案, $T_s$）即为当前测试用例的解。记录结果并继续处理下一个用例。\n8. 如果首选方案未能通过条件数测试，则使用相同的$T_s$评估备选方案。如果备选方案通过，则它成为解。如果两者都失败，则转向下一个更小的$T_s$。\n\n此过程保证能根据指定规则找到最大的有效采样周期及相应的方案选择。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Selects an integration scheme and the largest possible sample period for\n    simulating an RLC circuit based on stability and conditioning constraints.\n    \"\"\"\n    # Define constants and problem parameters from the statement.\n    kappa_max = 1e8\n    ts_candidates = [1e-7, 5e-7, 1e-6, 5e-6, 1e-5, 5e-5, 1e-4]\n    beta_threshold = 1e-2\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (L, C, R) in SI units.\n    test_cases = [\n        (1e-6, 1e-5, 1e-2),  # Case 1\n        (1e-3, 1e-6, 0.0),   # Case 2\n        (1e-5, 1e-7, 1e-1),  # Case 3\n        (1e-7, 1e-7, 1e-4),  # Case 4\n    ]\n\n    all_results = []\n    \n    # Process each test case\n    for L, C, R in test_cases:\n        # Construct the continuous-time state matrix A\n        A = np.array([[-R/L, -1/L], [1/C, 0.0]])\n        \n        # Determine the scheme preference based on system eigenvalues\n        eigvals_A = np.linalg.eigvals(A)\n        max_re = np.max(np.abs(np.real(eigvals_A)))\n        max_im = np.max(np.abs(np.imag(eigvals_A)))\n\n        # A small tolerance for floating point comparisons of max_im\n        if max_im  1e-12:\n            # Overdamped or critically damped: prefer Backward Euler (BE)\n            pref_order = [0, 1]  # 0: BE, 1: Trapezoidal (TR)\n        else:\n            beta = max_re / max_im\n            if beta = beta_threshold:\n                # Lightly damped: prefer Trapezoidal rule (TR)\n                pref_order = [1, 0]\n            else:\n                # Damped enough: prefer Backward Euler (BE)\n                pref_order = [0, 1]\n        \n        # Iterate through sample periods from largest to smallest to find the optimal Ts\n        found_solution = False\n        for ts in sorted(ts_candidates, reverse=True):\n            # Check schemes in order of preference\n            for scheme_id in pref_order:\n                # Form the matrix S for the linear system in the implicit step\n                if scheme_id == 0:  # Backward Euler\n                    S = np.identity(2) - ts * A\n                else:  # Trapezoidal Rule\n                    S = np.identity(2) - (ts / 2.0) * A\n                \n                # Check the condition number against the maximum allowed value\n                if np.linalg.cond(S, 2) = kappa_max:\n                    # Stability check is theoretically guaranteed for A-stable methods\n                    # on passive systems, but it's good practice to confirm.\n                    if scheme_id == 0:\n                        M = np.linalg.inv(S)\n                    else:\n                        M = np.linalg.inv(S) @ (np.identity(2) + (ts / 2.0) * A)\n                    \n                    rho_M = np.max(np.abs(np.linalg.eigvals(M)))\n\n                    # Use a small tolerance for floating point comparison of spectral radius\n                    if rho_M = 1.0 + 1e-9:\n                        all_results.append([scheme_id, ts])\n                        found_solution = True\n                        break  # Break from the inner loop (schemes)\n            \n            if found_solution:\n                break  # Break from the outer loop (Ts)\n\n    # Final print statement in the exact required format.\n    # Python's default str() for lists and floats is used.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在硬件在环（HIL）测试中，控制器与一个实时运行的数字模型进行交互。精确地再现控制器发出的脉宽调制（PWM）信号是保证仿真保真度的关键。本练习将引导您将一个高层级的控制要求（占空比分辨率）转化为一个具体的硬件性能指标（定时器时钟频率），这是设计和评估HIL系统硬件接口能力的一项基本技能。",
            "id": "3845360",
            "problem": "一个实时硬件在环 (HIL) 平台被用于测试一个数字控制的直流-直流电源转换器的闭环行为。脉冲宽度调制 (PWM) 门控信号由 HIL 目标机上的一个定时器外设合成。为确保控制器施加的占空比变化不大于指定分辨率，HIL 定时器必须在一个开关周期内提供足够的时间量化。开关频率固定为 $f_{sw} = 50 \\text{kHz}$。PWM 占空比 $D$ 定义为导通时间 $t_{on}$ 与开关周期 $T_{sw}$ 的比值，即 $D = t_{on}/T_{sw}$。定时器以等于其时钟周期的离散增量生成 $t_{on}$，我们称该增量为时间分辨率 $t_{res}$。\n\n为保证 HIL 的保真度，所需的最坏情况占空比增量为满量程的 $0.1\\%$。从 $T_{sw}$ 和 $D$ 的定义以及由 $t_{res}$ 决定的量化关系出发，确定在 $f_{sw} = 50 \\text{kHz}$ 时，能保证 $0.1\\%$ 占空比增量的最小时间分辨率 $t_{res}$，然后计算实现此时间分辨率所需的相应最小定时器时钟频率 $f_{clk}$。\n\n将时间分辨率以纳秒为单位表示，定时器时钟频率以兆赫兹为单位表示。提供精确值，无需四舍五入。将最终答案以行矩阵的形式报告，其中第一个元素是以纳秒为单位的时间分辨率，第二个元素是以兆赫兹为单位的定时器时钟频率。",
            "solution": "开关周期是开关频率的倒数。根据基本定义，\n$$\nT_{sw} = \\frac{1}{f_{sw}}.\n$$\n占空比 $D$ 定义为\n$$\nD = \\frac{t_{on}}{T_{sw}},\n$$\n其中 $t_{on}$ 是一个开关周期内 PWM 的导通时间。在数字实现中，$t_{on}$ 只能以定时器时钟周期设定的离散增量进行变化。令 $t_{res}$ 表示定时器的时间分辨率（$t_{on}$ 的最小可能增量）。那么，可实现的最小占空比变化 $\\Delta D$ 由一个时间分辨率步长与开关周期的比值确定：\n$$\n\\Delta D = \\frac{t_{res}}{T_{sw}}.\n$$\n为保证占空比分辨率至多为 $0.1\\%$，我们要求\n$$\n\\Delta D \\leq 0.001,\n$$\n因为 $0.1\\%$ 对应于小数 $0.001$。设等式成立以求得所需的最小分辨率，\n$$\n\\frac{t_{res}}{T_{sw}} = 0.001 \\quad \\Rightarrow \\quad t_{res} = 0.001\\, T_{sw}.\n$$\n根据开关频率 $f_{sw} = 50 \\text{kHz}$ 代入 $T_{sw}$，\n$$\nT_{sw} = \\frac{1}{50 \\times 10^{3}} \\text{s} = 20 \\times 10^{-6} \\text{s}.\n$$\n因此，\n$$\nt_{res} = 0.001 \\times 20 \\times 10^{-6} \\text{s} = 20 \\times 10^{-9} \\text{s}.\n$$\n因此，所需的时间分辨率为 $20 \\text{ns}$。\n\n定时器时钟频率 $f_{clk}$ 是时间分辨率的倒数，因为每个时钟周期对应一个 $t_{res}$：\n$$\nf_{clk} = \\frac{1}{t_{res}} = \\frac{1}{20 \\times 10^{-9} \\text{s}} = 50 \\times 10^{6} \\text{Hz}.\n$$\n以兆赫兹表示，即为\n$$\nf_{clk} = 50 \\text{MHz}.\n$$\n因此，最小时间分辨率为 $20 \\text{ns}$，相应的最小定时器时钟频率为 $50 \\text{MHz}$。",
            "answer": "$$\\boxed{\\begin{pmatrix}20  50\\end{pmatrix}}$$"
        }
    ]
}