{
    "hands_on_practices": [
        {
            "introduction": "A primary task in power electronics filter design is selecting component values to meet performance specifications, such as limiting the current ripple produced by high-frequency switching. This exercise guides you through the process of sizing the converter-side inductor by connecting the fundamental voltage-current relationship, $v_{L}(t)=L\\frac{di(t)}{dt}$, with the operation of a Pulse-Width Modulated (PWM) inverter. By analyzing the worst-case scenario across a fundamental cycle, you will derive a critical design equation, developing a foundational skill for any grid-connected converter application. ",
            "id": "3854098",
            "problem": "A three-phase two-level Voltage Source Inverter (VSI) supplies a balanced sinusoidal current to a stiff grid through an inductor-capacitor-inductor (LCL) filter. The converter employs Space Vector Modulation (SVM), which for a single phase leg can be represented equivalently by a centered, symmetric Pulse Width Modulation (PWM) with phase leg voltage switching between $+\\frac{V_{dc}}{2}$ and $-\\frac{V_{dc}}{2}$ at switching frequency $f_{s}$. The fundamental component of the average phase-leg voltage is set by the modulation index $m$, so that the average voltage over one switching period is $v_{\\text{avg}}(\\theta)=\\frac{m V_{dc}}{2}\\sin(\\theta)$, where $\\theta$ is the fundamental angle.\n\nActive damping is implemented via capacitor-current feedback to emulate a virtual resistor, ensuring that the LCL resonance is sufficiently damped. Assume the active damping loop bandwidth is sufficiently below $f_{s}$ so that it does not alter the within-switching-period dynamics of the phase-leg voltage.\n\nConsider the converter-side inductor of the LCL filter with inductance $L$. Neglect resistive losses and assume continuous conduction. Use the fundamental relationship $v_{L}(t)=L\\,\\frac{di(t)}{dt}$ and first principles of PWM average modeling to derive an expression for the peak-to-peak ripple of the inductor current over a single switching period as a function of the instantaneous modulation angle $\\theta$. Then, by enforcing that the peak-to-peak current ripple does not exceed a specified bound $\\Delta i$ for any $\\theta$ over the fundamental cycle, compute the minimum required inductor value $L$ in terms of $V_{dc}$, $m$, $f_{s}$, and $\\Delta i$.\n\nExpress your final answer as a single closed-form symbolic expression for $L$ in Henry (H). No numerical substitution is required, and no rounding is necessary.",
            "solution": "The problem asks for the minimum required value of the converter-side inductor, $L$, in a three-phase VSI system using an LCL filter. The design criterion is that the peak-to-peak current ripple in this inductor does not exceed a specified value $\\Delta i$ at any point in the fundamental cycle.\n\nFirst, we establish a model for the voltage across the inductor $L$. The inductor is situated between the inverter phase-leg output and the filter capacitor. The voltage across the inductor, $v_L(t)$, is given by the difference between the instantaneous phase-leg voltage, $v_{\\text{sw}}(t)$, and the voltage at the filter capacitor, which is approximately the fundamental component of the grid voltage. For the purpose of calculating high-frequency ripple within a single switching period $T_s = 1/f_s$, we can assume the fundamental-frequency voltage is constant and equal to the average phase-leg voltage over that period, $v_{\\text{avg}}(\\theta)$.\n$$v_L(t) = v_{\\text{sw}}(t) - v_{\\text{avg}}(\\theta)$$\nThe problem states that the phase-leg voltage $v_{\\text{sw}}(t)$ switches between $+\\frac{V_{dc}}{2}$ and $-\\frac{V_{dc}}{2}$ relative to the DC-link midpoint. The average voltage is given as $v_{\\text{avg}}(\\theta) = \\frac{m V_{dc}}{2}\\sin(\\theta)$.\n\nThe modulation scheme is centered, symmetric PWM. For a given average voltage, the duty cycle $D$ (fraction of the period where the pulse is high) for a bipolar PWM can be found. The average voltage is given by $v_{\\text{avg}} = (\\frac{V_{dc}}{2})D + (-\\frac{V_{dc}}{2})(1-D) = \\frac{V_{dc}}{2}(2D-1)$. Equating this with the given expression for $v_{\\text{avg}}(\\theta)$:\n$$\\frac{V_{dc}}{2}(2D(\\theta)-1) = \\frac{m V_{dc}}{2}\\sin(\\theta) \\implies D(\\theta) = \\frac{1 + m \\sin(\\theta)}{2}$$\nIn centered, symmetric PWM, the pulse of duration $D T_s$ is centered within the switching period $T_s$. This means the voltage is high ($+\\frac{V_{dc}}{2}$) during the interval $[\\frac{(1-D)T_s}{2}, \\frac{(1+D)T_s}{2}]$ and low ($-\\frac{V_{dc}}{2}$) otherwise.\n\nThe inductor current ripple is caused by the switching-frequency components of the voltage $v_L(t)$. The change in inductor current is governed by $L \\frac{di(t)}{dt} = v_L(t)$. The peak-to-peak ripple, $\\Delta i_{pp}$, is the change in current from its minimum to its maximum value within one switching period. The current slope is positive when $v_L(t) > 0$ and negative when $v_L(t)  0$. The maximum current occurs at the end of the interval where $v_L(t)$ is positive, and the minimum occurs at the beginning of this interval.\n\nThe voltage across the inductor during the high-voltage part of the PWM pulse is:\n$$v_{L,\\text{on}} = v_{\\text{sw,high}} - v_{\\text{avg}}(\\theta) = \\frac{V_{dc}}{2} - \\frac{m V_{dc}}{2}\\sin(\\theta) = \\frac{V_{dc}}{2}(1 - m\\sin(\\theta))$$\nThis interval has a duration of $D(\\theta)T_s$. The peak-to-peak current ripple is the total current change during this time:\n$$\\Delta i_{pp}(\\theta) = \\frac{v_{L,\\text{on}}}{L} \\times (\\text{Duration}) = \\frac{1}{L} \\left[ \\frac{V_{dc}}{2}(1 - m\\sin(\\theta)) \\right] (D(\\theta)T_s)$$\nSubstituting the expression for $D(\\theta)$ and $T_s=1/f_s$:\n$$\\Delta i_{pp}(\\theta) = \\frac{1}{L} \\left[ \\frac{V_{dc}}{2}(1 - m\\sin(\\theta)) \\right] \\left[ \\frac{1 + m \\sin(\\theta)}{2} \\right] \\frac{1}{f_s}$$\nUsing the algebraic identity $(a-b)(a+b) = a^2 - b^2$, we simplify the expression:\n$$\\Delta i_{pp}(\\theta) = \\frac{V_{dc}}{4Lf_s} (1 - m^2\\sin^2(\\theta))$$\nThis is the expression for the peak-to-peak inductor current ripple as a function of the fundamental angle $\\theta$.\n\nNext, we must find the worst-case (maximum) ripple over a full fundamental cycle, i.e., for all $\\theta \\in [0, 2\\pi]$. We need to maximize $\\Delta i_{pp}(\\theta)$:\n$$\\Delta i_{pp, \\max} = \\max_{\\theta} \\left[ \\frac{V_{dc}}{4Lf_s} (1 - m^2\\sin^2(\\theta)) \\right]$$\nThe term $\\frac{V_{dc}}{4Lf_s}$ is a positive constant. The maximization depends on the term $(1 - m^2\\sin^2(\\theta))$. Since $m^2 \\ge 0$ and $\\sin^2(\\theta) \\ge 0$, the term $m^2\\sin^2(\\theta)$ is always non-negative. To maximize the expression, we must minimize $m^2\\sin^2(\\theta)$. The minimum value of this term is $0$, which occurs when $\\sin(\\theta) = 0$ (i.e., at $\\theta = 0, \\pi, 2\\pi, \\ldots$).\n\nAt these points, the maximum value of $(1 - m^2\\sin^2(\\theta))$ is $1$. Therefore, the maximum peak-to-peak current ripple over the entire fundamental cycle is:\n$$\\Delta i_{pp, \\max} = \\frac{V_{dc}}{4Lf_s} (1) = \\frac{V_{dc}}{4Lf_s}$$\nIt is noteworthy that the maximum ripple is independent of the modulation index $m$.\n\nFinally, the problem requires that this maximum ripple must not exceed the specified bound $\\Delta i$. This gives us the following inequality:\n$$\\Delta i_{pp, \\max} \\le \\Delta i$$\n$$\\frac{V_{dc}}{4Lf_s} \\le \\Delta i$$\nTo ensure this condition is met, the inductor value $L$ must be sufficiently large. We can solve for the minimum required value of $L$ by rearranging the inequality:\n$$L \\ge \\frac{V_{dc}}{4 f_s \\Delta i}$$\nThe minimum required inductance $L$ is therefore the value that makes this an equality.",
            "answer": "$$\\boxed{\\frac{V_{dc}}{4 f_{s} \\Delta i}}$$"
        },
        {
            "introduction": "While LCL filters offer excellent high-frequency attenuation, they introduce a resonance peak that must be damped for stable operation. Active damping, which uses feedback to create a \"virtual resistor,\" is a powerful technique to achieve this without the losses of a physical resistor. This practice explores how real-world imperfections, specifically sensor gain errors, affect the performance of an active damping system, allowing you to quantify how a small measurement error translates into an inaccurate virtual resistance and an altered system damping ratio. ",
            "id": "3854105",
            "problem": "A three-phase grid-tied Voltage-Source Converter (VSC) employs an Inductor-Capacitor-Inductor (LCL) output filter to shape the injected current. The grid-side inductance is $L_2$ and the filter capacitor is $C$, with negligible resistive losses. To damp the LCL resonance without adding physical resistors, the controller implements active damping by injecting a damping current command proportional to the measured capacitor voltage. Specifically, the damping current command is $i_{\\mathrm{ad}} = G_v \\,\\hat{v}_c$, where $\\hat{v}_c$ is the measured capacitor voltage and $G_v$ is a designed virtual conductance.\n\nA sensor gain error is present in the capacitor-voltage measurement chain, modeled as $\\hat{v}_c = g\\, v_c$ with $g = 1 + \\delta$, where $\\delta$ is the gain error. The active damping is intended to synthesize a virtual resistor across the capacitor, but the sensor gain error modifies its realized value. Assume the inner current controller is ideal (infinite bandwidth), so the damping current is perfectly realized and the resonant subsystem reduces to the series combination of $L_2$ and the parallel combination of $C$ and the synthesized virtual resistor.\n\nGiven:\n- $L_2 = 1.8 \\times 10^{-3}$ H,\n- $C = 30 \\times 10^{-6}$ F,\n- Designed closed-loop damping ratio at zero sensor error $\\zeta_d = 0.25$,\n- Sensor gain error $\\delta = 0.03$,\ndetermine the actual equivalent virtual resistor $R_{\\mathrm{eq}}$ realized under the gain error and the resulting closed-loop damping ratio $\\zeta_{\\mathrm{cl}}$ of the resonant subsystem.\n\nExpress $R_{\\mathrm{eq}}$ in Ohms and $\\zeta_{\\mathrm{cl}}$ as unitless. Round your answer to four significant figures. Provide your final answer as two values in a single row matrix, with the first entry being $R_{\\mathrm{eq}}$ and the second entry being $\\zeta_{\\mathrm{cl}}$.",
            "solution": "The user wants me to validate and solve a problem concerning an LCL filter with active damping.\n\n### Step 1: Extract Givens\n- Grid-side inductance: $L_2 = 1.8 \\times 10^{-3}$ H\n- Filter capacitor: $C = 30 \\times 10^{-6}$ F\n- Damping current command: $i_{\\mathrm{ad}} = G_v \\,\\hat{v}_c$\n- Measured capacitor voltage: $\\hat{v}_c = g\\, v_c$\n- Sensor gain: $g = 1 + \\delta$\n- Sensor gain error: $\\delta = 0.03$\n- Designed closed-loop damping ratio at zero sensor error: $\\zeta_d = 0.25$\n- Resonant subsystem model: series combination of $L_2$ and the parallel combination of $C$ and the synthesized virtual resistor.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on established principles of power electronics, circuit theory, and control systems. The use of an LCL filter, active damping via capacitor voltage feedback, and modeling of sensor errors are all standard engineering practices. The problem is scientifically sound.\n- **Well-Posed**: The problem provides sufficient data and a clear system model to determine the requested quantities ($R_{\\mathrm{eq}}$ and $\\zeta_{\\mathrm{cl}}$). A unique solution can be derived from the provided information.\n- **Objective**: The problem statement is written in precise, technical language, free of subjectivity or ambiguity.\n- **Completeness and Consistency**: The given values are self-contained and appear consistent. The parameters are within a realistic range for a grid-tied converter application. There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will now be provided.\n\n### Solution Derivation\nThe problem describes a simplified model for the resonant behavior of an LCL filter with active damping. The active damping creates a virtual resistor, which, due to sensor gain error, has an equivalent value $R_{\\mathrm{eq}}$. The problem states that the resonant subsystem is modeled as the series combination of the inductor $L_2$ and the parallel combination of the capacitor $C$ and this virtual resistor $R_{\\mathrm{eq}}$.\n\nLet's denote the virtual resistance as $R_v$. The impedance of the parallel combination of $C$ and $R_v$ is:\n$$ Z_{p}(s) = \\frac{1}{sC + \\frac{1}{R_v}} = \\frac{R_v}{1 + sCR_v} $$\nThe total impedance of the described resonant subsystem is the series combination of $L_2$ and $Z_p(s)$:\n$$ Z_{\\mathrm{sub}}(s) = sL_2 + Z_{p}(s) = sL_2 + \\frac{R_v}{1 + sCR_v} $$\nThe resonance of the system is characterized by the poles of the system's transfer function, which correspond to the zeros of the characteristic impedance. We find the zeros of $Z_{\\mathrm{sub}}(s)$ by setting it to zero:\n$$ sL_2 + \\frac{R_v}{1 + sCR_v} = 0 $$\n$$ sL_2(1 + sCR_v) + R_v = 0 $$\n$$ s^2 L_2 C R_v + sL_2 + R_v = 0 $$\nTo match this to the standard second-order characteristic equation, $s^2 + 2\\zeta\\omega_n s + \\omega_n^2 = 0$, we divide by $L_2 C R_v$:\n$$ s^2 + \\frac{1}{CR_v}s + \\frac{1}{L_2 C} = 0 $$\nBy comparing the coefficients, we identify the natural frequency $\\omega_n$ and the damping ratio $\\zeta$:\n$$ \\omega_n^2 = \\frac{1}{L_2 C} \\implies \\omega_n = \\frac{1}{\\sqrt{L_2 C}} $$\n$$ 2\\zeta\\omega_n = \\frac{1}{CR_v} \\implies \\zeta = \\frac{1}{2CR_v\\omega_n} = \\frac{1}{2CR_v} \\sqrt{L_2 C} = \\frac{1}{2R_v}\\sqrt{\\frac{L_2}{C}} $$\nThis equation relates the damping ratio $\\zeta$ to the virtual resistance $R_v$ and the physical components $L_2$ and $C$.\n\nFirst, we determine the properties of the system as it was designed, i.e., with zero sensor error ($\\delta = 0$). In this case, the measured voltage is the actual voltage, $\\hat{v}_c = v_c$. The damping current is $i_{\\mathrm{ad}} = G_v v_c$. The designed virtual resistance, let's call it $R_d$, is the ratio $v_c/i_{\\mathrm{ad}}$:\n$$ R_d = \\frac{v_c}{G_v v_c} = \\frac{1}{G_v} $$\nThe designed damping ratio is given as $\\zeta_d = 0.25$. Using our derived formula:\n$$ \\zeta_d = \\frac{1}{2R_d}\\sqrt{\\frac{L_2}{C}} $$\nWe can solve for the designed virtual resistance $R_d$:\n$$ R_d = \\frac{1}{2\\zeta_d}\\sqrt{\\frac{L_2}{C}} $$\nLet's find the value of the characteristic impedance $\\sqrt{L_2/C}$:\n$$ \\sqrt{\\frac{L_2}{C}} = \\sqrt{\\frac{1.8 \\times 10^{-3}}{30 \\times 10^{-6}}} = \\sqrt{\\frac{1.8}{30} \\times 10^3} = \\sqrt{0.06 \\times 1000} = \\sqrt{60} \\, \\Omega $$\nNow, we calculate $R_d$:\n$$ R_d = \\frac{1}{2 \\times 0.25} \\sqrt{60} = \\frac{1}{0.5} \\sqrt{60} = 2\\sqrt{60} \\, \\Omega \\approx 15.4919 \\, \\Omega $$\nThe designed virtual conductance is $G_v = 1/R_d = 1/(2\\sqrt{60})$ S.\n\nNext, we consider the effect of the sensor gain error $\\delta = 0.03$. The measured voltage is $\\hat{v}_c = (1+\\delta)v_c$. The damping current is:\n$$ i_{\\mathrm{ad}} = G_v \\hat{v}_c = G_v (1+\\delta) v_c $$\nThe actual equivalent virtual resistance, $R_{\\mathrm{eq}}$, is the ratio of the true capacitor voltage $v_c$ to the actual damping current $i_{\\mathrm{ad}}$:\n$$ R_{\\mathrm{eq}} = \\frac{v_c}{i_{\\mathrm{ad}}} = \\frac{v_c}{G_v (1+\\delta) v_c} = \\frac{1}{G_v(1+\\delta)} $$\nSince $R_d = 1/G_v$, we can write:\n$$ R_{\\mathrm{eq}} = \\frac{R_d}{1+\\delta} $$\nSubstituting the values:\n$$ R_{\\mathrm{eq}} = \\frac{2\\sqrt{60}}{1 + 0.03} = \\frac{2\\sqrt{60}}{1.03} \\approx \\frac{15.4919}{1.03} \\approx 15.0407 \\, \\Omega $$\nRounding to four significant figures, the actual equivalent virtual resistor is $R_{\\mathrm{eq}} = 15.04 \\, \\Omega$.\n\nFinally, we determine the resulting closed-loop damping ratio, $\\zeta_{\\mathrm{cl}}$, which corresponds to the actual resistance $R_{\\mathrm{eq}}$. Using the damping ratio formula again:\n$$ \\zeta_{\\mathrm{cl}} = \\frac{1}{2R_{\\mathrm{eq}}}\\sqrt{\\frac{L_2}{C}} $$\nWe can also express $\\zeta_{\\mathrm{cl}}$ in terms of the designed damping ratio $\\zeta_d$:\n$$ \\frac{\\zeta_{\\mathrm{cl}}}{\\zeta_d} = \\frac{\\frac{1}{2R_{\\mathrm{eq}}}\\sqrt{\\frac{L_2}{C}}}{\\frac{1}{2R_d}\\sqrt{\\frac{L_2}{C}}} = \\frac{R_d}{R_{\\mathrm{eq}}} $$\nSubstituting $R_{\\mathrm{eq}} = R_d/(1+\\delta)$:\n$$ \\frac{\\zeta_{\\mathrm{cl}}}{\\zeta_d} = \\frac{R_d}{R_d/(1+\\delta)} = 1+\\delta $$\nSo, the actual damping ratio is:\n$$ \\zeta_{\\mathrm{cl}} = \\zeta_d (1+\\delta) $$\nPlugging in the given values:\n$$ \\zeta_{\\mathrm{cl}} = 0.25 \\times (1 + 0.03) = 0.25 \\times 1.03 = 0.2575 $$\nThe resulting closed-loop damping ratio $\\zeta_{\\mathrm{cl}}$ is $0.2575$. This is already at four significant figures.\n\nThe final answers are $R_{\\mathrm{eq}} = 15.04 \\, \\Omega$ and $\\zeta_{\\mathrm{cl}} = 0.2575$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 15.04  0.2575 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The ultimate goal of a grid-interface filter is to ensure the current injected into the utility grid meets strict harmonic standards, a critical requirement for power quality. This comprehensive exercise challenges you to build a frequency-domain simulator from first principles, applying Kirchhoff’s laws and node-voltage analysis to derive and compare the transfer functions of L, LC, and LCL filters. By implementing this simulator, you will gain a deep, practical understanding of how different filter topologies attenuate harmonics and how to systematically validate their compliance with grid codes, bridging the gap between theory and virtual prototyping. ",
            "id": "3854041",
            "problem": "Design and implement a frequency-domain simulator to evaluate whether line-current harmonics at specified orders comply with given limits for three grid-interface filter topologies: inductor (L), inductor-capacitor (LC), and inductor-capacitor-inductor (LCL) with active damping. Your simulator must compute the magnitude of the transfer function from an inverter-side harmonic voltage source to the grid-side current for each specified harmonic order and determine compliance against harmonic current limits. The simulator should compute using fundamental circuit laws only and must not rely on any pre-derived shortcut formulas beyond the definitions of impedance and Kirchhoff’s laws.\n\nUse the following context and base definitions:\n- Kirchhoff’s Current Law (KCL): At any node, the algebraic sum of currents is zero.\n- Ohm’s Law in the frequency domain: For a component with impedance $Z(\\mathrm{j}\\omega)$, the current is $I(\\mathrm{j}\\omega) = V(\\mathrm{j}\\omega)/Z(\\mathrm{j}\\omega)$.\n- Inductor impedance: $Z_L(\\mathrm{j}\\omega) = \\mathrm{j}\\,\\omega L$.\n- Capacitor impedance (with active damping implemented as a virtual series resistor): $Z_C(\\mathrm{j}\\omega) = R_v + \\dfrac{1}{\\mathrm{j}\\,\\omega C}$.\n- Parallel combination: $Z_{a\\parallel b} = \\dfrac{Z_a Z_b}{Z_a + Z_b}$.\n\nAssume a single-phase grid model with Thevenin impedance $Z_g(\\mathrm{j}\\omega) = R_g + \\mathrm{j}\\,\\omega L_g$. Model the inverter as an ideal voltage source producing harmonic components at specified orders of the fundamental frequency. For each harmonic order $h$, define the angular frequency $\\omega_h = 2\\pi f_1 h$.\n\nDefine the grid-side current magnitude at harmonic $h$ as $|I_g(h)| = |G(\\mathrm{j}\\omega_h)|\\,A_h$, where $A_h$ is the root mean square (RMS) voltage amplitude of the inverter harmonic at order $h$ and $G(\\mathrm{j}\\omega)$ is the small-signal transfer function from the inverter-side harmonic voltage to the grid-side current.\n\nDerive $G(\\mathrm{j}\\omega)$ from first principles for each topology using node-voltage analysis:\n1) L filter: One inductor $L_1$ in series between inverter and grid port; grid port connected to ground through $Z_g(\\mathrm{j}\\omega)$.\n2) LC filter: One inductor $L_1$ in series between inverter and a node that connects in parallel to capacitor $C$ to ground and grid impedance $Z_g(\\mathrm{j}\\omega)$ to ground.\n3) LCL filter with active damping: Inductor $L_1$ in series from inverter to an intermediate node; from this node, a shunt branch to ground via the damped capacitor $Z_C(\\mathrm{j}\\omega)$, and a series inductor $L_2$ to the grid port; the grid port is connected to ground via $Z_g(\\mathrm{j}\\omega)$.\n\nFor the LCL case, implement active damping by modeling capacitor-current feedback as an equivalent series resistor of value $R_v$ in series with the capacitor, inside $Z_C(\\mathrm{j}\\omega)$.\n\nCompliance criterion:\n- For each harmonic order $h$, let the limit for the RMS grid current be $I_{h,\\mathrm{lim}}$. A topology is compliant if and only if $|I_g(h)| \\le I_{h,\\mathrm{lim}}$ for all specified harmonic orders $h$.\n\nAmplitude scaling modes:\n- **Direct:** Use the given base RMS voltage amplitudes $A_h$ as-is.\n- **Boundary:** Compute a scalar $s^\\star$ such that the worst-case harmonic is exactly at the limit when amplitudes are scaled to $s^\\star A_h$. Formally,\n$$\ns^\\star = \\left(\\max_h \\frac{|G(\\mathrm{j}\\omega_h)|\\,A_h}{I_{h,\\mathrm{lim}}}\\right)^{-1}.\n$$\nUse amplitudes $s^\\star A_h$ for compliance evaluation (this should be exactly on the boundary and therefore compliant by the inclusive inequality).\n- **Boundary-times:** Given a factor $k0$, use amplitudes $k\\,s^\\star A_h$, where $s^\\star$ is computed as above. If $k1$, the test should become non-compliant.\n\nPhysical and numerical units:\n- Fundamental frequency: $f_1 = 50\\,\\mathrm{Hz}$.\n- Harmonic orders: $[5,7,11,13,17,19]$ (dimensionless).\n- Harmonic RMS voltage amplitudes at the inverter: $A_h = [5,5,5,5,5,5]$ in $\\mathrm{V}$.\n- Grid impedance parameters: $R_g = 0.1\\,\\Omega$, $L_g = 0.7\\,\\mathrm{mH}$.\n- Harmonic current limits in RMS amperes: $I_{h,\\mathrm{lim}} = [2.0,1.5,1.2,1.1,1.0,0.9]$ in $\\mathrm{A}$.\n\nTest suite:\n- **Case 1 (happy path, compliant):** Topology LCL with active damping. Use $L_1 = 1.8\\,\\mathrm{mH}$, $L_2 = 1.8\\,\\mathrm{mH}$, $C = 15\\,\\mu\\mathrm{F}$, $R_v = 1.5\\,\\Omega$, scaling mode Direct with scale factor $s=1$.\n- **Case 2 (boundary condition, exactly at the limit):** Topology LC without active damping. Use $L_1 = 2.2\\,\\mathrm{mH}$, $C = 10\\,\\mu\\mathrm{F}$, scaling mode Boundary, i.e., compute $s^\\star$ from the network and use $s^\\star A_h$.\n- **Case 3 (edge case beyond the limit, non-compliant):** Topology L only. Use $L_1 = 1.0\\,\\mathrm{mH}$, scaling mode Boundary-times with $k = 1.2$ (i.e., compute $s^\\star$ for this topology and then scale amplitudes to $1.2\\,s^\\star A_h$).\n\nAlgorithmic requirements:\n- Construct the frequency-domain impedances for each harmonic using the given component values.\n- For each topology, derive $G(\\mathrm{j}\\omega)$ from KCL and Ohm’s law:\n  - For L and LC, reduce the network using series and parallel combinations consistently.\n  - For LCL, set up the node-voltage equations and solve the $2\\times 2$ linear system to obtain the grid-port voltage and current as a function of the inverter-port source voltage.\n- Compute $|I_g(h)| = |G(\\mathrm{j}\\omega_h)|\\,A_h$ for all harmonics. For Boundary and Boundary-times modes, compute $s^\\star$ using the definition above, then rescale amplitudes accordingly before evaluating compliance.\n\nFinal output specification:\n- Your program should produce a single line of output containing a list of three boolean values, one per test case, indicating overall compliance for that case (true if compliant for all specified harmonics, false otherwise).\n- The booleans must be printed in lowercase as the strings \"true\" or \"false\".\n- The overall output format must be exactly a single line of the form: \"[b1,b2,b3]\". For example, \"[true,true,false]\".\n\nAll quantities must be handled in SI units. Angles and phases are implicit in complex impedances; no angular units are required. The final answers for each test case must be booleans as defined above. No user input is required; all parameters are fixed by this specification within the program.",
            "solution": "The problem requires the design and implementation of a frequency-domain simulator to assess the compliance of grid-side current harmonics for three filter topologies: L, LC, and LCL. The assessment is based on comparing the calculated root mean square (RMS) current magnitude at specific harmonic frequencies against specified limits. The analysis must be derived from fundamental principles, namely Kirchhoff's Current Law (KCL) and Ohm's Law in the frequency domain.\n\nThe core of the problem is to determine the transfer function $G(\\mathrm{j}\\omega) = I_g(\\mathrm{j}\\omega) / V_{inv}(\\mathrm{j}\\omega)$, where $V_{inv}(\\mathrm{j}\\omega)$ is the inverter's harmonic voltage output and $I_g(\\mathrm{j}\\omega)$ is the resulting current injected into the grid. The harmonic voltage is treated as a small-signal source. The angular frequency for a harmonic of order $h$ is given by $\\omega_h = 2\\pi f_1 h$, where $f_1$ is the fundamental frequency.\n\nFirst, we define the impedances of the passive components and the grid in the frequency domain:\n- Grid impedance: $Z_g(\\mathrm{j}\\omega) = R_g + \\mathrm{j}\\omega L_g$.\n- Inverter-side inductor impedance: $Z_{L1}(\\mathrm{j}\\omega) = \\mathrm{j}\\omega L_1$.\n- Grid-side inductor impedance (for the LCL topology): $Z_{L2}(\\mathrm{j}\\omega) = \\mathrm{j}\\omega L_2$.\n- Damped capacitor impedance (with active damping): $Z_C(\\mathrm{j}\\omega) = R_v + \\frac{1}{\\mathrm{j}\\omega C}$. For topologies without active damping, the virtual resistance $R_v$ is set to $0$.\n\nThe derivation of the transfer function $G(\\mathrm{j}\\omega)$ for each of the three topologies proceeds as follows.\n\n**1. L Filter Topology**\nIn this configuration, a single inductor $L_1$ is placed in series between the inverter voltage source $V_{inv}$ and the grid port. The grid is represented by its Thévenin impedance $Z_g$. The circuit consists of $V_{inv}$ driving a series combination of $Z_{L1}$ and $Z_g$. The total impedance of the circuit is $Z_{tot} = Z_{L1} + Z_g$. The grid current $I_g$ is the current flowing through this entire series circuit. Applying Ohm's Law:\n$$ I_g(\\mathrm{j}\\omega) = \\frac{V_{inv}(\\mathrm{j}\\omega)}{Z_{tot}(\\mathrm{j}\\omega)} = \\frac{V_{inv}(\\mathrm{j}\\omega)}{Z_{L1}(\\mathrm{j}\\omega) + Z_g(\\mathrm{j}\\omega)} $$\nThe transfer function $G_L(\\mathrm{j}\\omega)$ is therefore:\n$$ G_L(\\mathrm{j}\\omega) = \\frac{I_g(\\mathrm{j}\\omega)}{V_{inv}(\\mathrm{j}\\omega)} = \\frac{1}{Z_{L1}(\\mathrm{j}\\omega) + Z_g(\\mathrm{j}\\omega)} = \\frac{1}{\\mathrm{j}\\omega L_1 + R_g + \\mathrm{j}\\omega L_g} $$\n\n**2. LC Filter Topology**\nThe LC filter consists of a series inductor $L_1$ followed by a shunt capacitor $C$. The problem states that the grid impedance $Z_g$ is connected in parallel with the capacitor $C$. In this case, active damping is not used, so $R_v=0$ and the capacitor impedance is $Z_C(\\mathrm{j}\\omega) = 1/(\\mathrm{j}\\omega C)$.\nThe equivalent impedance of the parallel combination of $Z_C$ and $Z_g$ is given by:\n$$ Z_p(\\mathrm{j}\\omega) = \\frac{Z_C(\\mathrm{j}\\omega) Z_g(\\mathrm{j}\\omega)}{Z_C(\\mathrm{j}\\omega) + Z_g(\\mathrm{j}\\omega)} $$\nThe total current from the inverter, $I_{tot}$, flows through $Z_{L1}$ and is given by $I_{tot} = V_{inv} / (Z_{L1} + Z_p)$. This current then splits between the capacitor and the grid impedance. Using the current divider rule to find the grid current $I_g$:\n$$ I_g(\\mathrm{j}\\omega) = I_{tot}(\\mathrm{j}\\omega) \\cdot \\frac{Z_C(\\mathrm{j}\\omega)}{Z_C(\\mathrm{j}\\omega) + Z_g(\\mathrm{j}\\omega)} $$\nSubstituting the expression for $I_{tot}$:\n$$ I_g(\\mathrm{j}\\omega) = \\frac{V_{inv}(\\mathrm{j}\\omega)}{Z_{L1}(\\mathrm{j}\\omega) + Z_p(\\mathrm{j}\\omega)} \\cdot \\frac{Z_C(\\mathrm{j}\\omega)}{Z_C(\\mathrm{j}\\omega) + Z_g(\\mathrm{j}\\omega)} $$\nSubstituting $Z_p$ and simplifying:\n$$ I_g(\\mathrm{j}\\omega) = \\frac{V_{inv}(\\mathrm{j}\\omega)}{Z_{L1} + \\frac{Z_C Z_g}{Z_C + Z_g}} \\cdot \\frac{Z_C}{Z_C + Z_g} = V_{inv}(\\mathrm{j}\\omega) \\frac{Z_C + Z_g}{Z_{L1}(Z_C + Z_g) + Z_C Z_g} \\cdot \\frac{Z_C}{Z_C + Z_g} $$\nThis simplifies to the transfer function $G_{LC}(\\mathrm{j}\\omega)$:\n$$ G_{LC}(\\mathrm{j}\\omega) = \\frac{Z_C}{Z_{L1}Z_C + Z_{L1}Z_g + Z_C Z_g} $$\n\n**3. LCL Filter Topology with Active Damping**\nThis topology has an inverter-side inductor $L_1$, a shunt capacitor $C$ with virtual damping resistor $R_v$, and a grid-side inductor $L_2$. Let $V_1$ be the voltage at the node between $Z_{L1}$, $Z_C$, and $Z_{L2}$, and $V_2$ be the voltage at the node between $Z_{L2}$ and $Z_g$ (the grid port). We apply KCL at these two nodes to find $V_2$, from which we derive the grid current $I_g = V_2 / Z_g$.\n\nAt node $1$ (voltage $V_1$):\n$$ \\frac{V_1 - V_{inv}}{Z_{L1}} + \\frac{V_1}{Z_C} + \\frac{V_1 - V_2}{Z_{L2}} = 0 $$\n$$ V_1 \\left( \\frac{1}{Z_{L1}} + \\frac{1}{Z_C} + \\frac{1}{Z_{L2}} \\right) - V_2 \\left( \\frac{1}{Z_{L2}} \\right) = \\frac{V_{inv}}{Z_{L1}} $$\n\nAt node $2$ (voltage $V_2$):\n$$ \\frac{V_2 - V_1}{Z_{L2}} + \\frac{V_2}{Z_g} = 0 $$\n$$ -V_1 \\left( \\frac{1}{Z_{L2}} \\right) + V_2 \\left( \\frac{1}{Z_{L2}} + \\frac{1}{Z_g} \\right) = 0 $$\n\nThis is a $2 \\times 2$ system of linear equations for the node voltages $V_1$ and $V_2$. We can solve this system analytically for $V_2$ in terms of $V_{inv}$. From the second equation, we express $V_1$ in terms of $V_2$: $V_1 = V_2 (1 + Z_{L2}/Z_g)$. Substituting this into the first equation and solving for $V_2$ yields:\n$$ V_2(\\mathrm{j}\\omega) = V_{inv}(\\mathrm{j}\\omega) \\frac{Z_C(\\mathrm{j}\\omega) Z_g(\\mathrm{j}\\omega)}{Z_{L1}Z_{L2} + Z_{L1}Z_g + Z_{L2}Z_C + Z_C Z_g + Z_{L1}Z_C} $$\nThe grid current is $I_g = V_2 / Z_g$. Thus, the transfer function $G_{LCL}(\\mathrm{j}\\omega)$ is:\n$$ G_{LCL}(\\mathrm{j}\\omega) = \\frac{V_2(\\mathrm{j}\\omega)}{Z_g(\\mathrm{j}\\omega) V_{inv}(\\mathrm{j}\\omega)} = \\frac{Z_C}{Z_{L1}Z_{L2} + Z_{L1}Z_g + Z_{L2}Z_C + Z_C Z_g + Z_{L1}Z_C} $$\n\n**Evaluation Procedure**\nFor each test case and each specified harmonic order $h$, the simulator performs the following steps:\n1.  Calculate the harmonic angular frequency $\\omega_h = 2\\pi f_1 h$.\n2.  Compute the complex impedance values for all components at $\\omega_h$.\n3.  Calculate the complex transfer function $G(\\mathrm{j}\\omega_h)$ using the appropriate derived formula for the given topology.\n4.  The magnitude of the transfer function $|G(\\mathrm{j}\\omega_h)|$ is stored for each harmonic.\n\nAfter calculating $|G(\\mathrm{j}\\omega_h)|$ for all relevant harmonics, the voltage amplitudes $A_h$ are scaled according to the specified mode:\n-   **Direct**: The base amplitudes $A_h$ are used directly. The resulting grid current for each harmonic is $|I_g(h)| = |G(\\mathrm{j}\\omega_h)| A_h$.\n-   **Boundary**: A scaling factor $s^\\star$ is computed to bring the most critical harmonic exactly to its limit. This factor is defined as $s^\\star = (\\max_h \\frac{|G(\\mathrm{j}\\omega_h)|\\,A_h}{I_{h,\\mathrm{lim}}})^{-1}$. The amplitudes are then set to $A'_h = s^\\star A_h$. The resulting grid current is $|I_g(h)| = |G(\\mathrm{j}\\omega_h)| A'_h$. By this definition, the system should be perfectly compliant.\n-   **Boundary-times**: The amplitudes are scaled by a factor $k$ beyond the boundary condition: $A'_h = k s^\\star A_h$.\n\nFinally, compliance is checked. A topology is deemed compliant if and only if $|I_g(h)| \\le I_{h,\\mathrm{lim}}$ for all specified harmonic orders $h$. A small numerical tolerance is used in the implementation to handle potential floating-point inaccuracies, especially for the Boundary case where the worst-case harmonic current should be exactly equal to its limit.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the final result.\n    \"\"\"\n\n    # --- Givens from problem statement ---\n    f1 = 50.0  # Hz\n    h_orders = np.array([5, 7, 11, 13, 17, 19])\n    Ah_base = np.array([5.0, 5.0, 5.0, 5.0, 5.0, 5.0]) # V (RMS)\n    Ih_lim = np.array([2.0, 1.5, 1.2, 1.1, 1.0, 0.9]) # A (RMS)\n    \n    # Grid impedance parameters\n    Rg = 0.1  # Ohms\n    Lg = 0.7e-3  # H\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        {\n            \"topology\": \"LCL\",\n            \"params\": {\"L1\": 1.8e-3, \"L2\": 1.8e-3, \"C\": 15e-6, \"Rv\": 1.5},\n            \"scaling_mode\": \"Direct\",\n            \"k_factor\": 1.0\n        },\n        {\n            \"topology\": \"LC\",\n            \"params\": {\"L1\": 2.2e-3, \"C\": 10e-6, \"L2\": 0.0, \"Rv\": 0.0},\n            \"scaling_mode\": \"Boundary\",\n            \"k_factor\": 1.0\n        },\n        {\n            \"topology\": \"L\",\n            \"params\": {\"L1\": 1.0e-3, \"C\": 0.0, \"L2\": 0.0, \"Rv\": 0.0},\n            \"scaling_mode\": \"Boundary-times\",\n            \"k_factor\": 1.2\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        is_compliant = evaluate_case(case, h_orders, Ah_base, Ih_lim, f1, Rg, Lg)\n        results.append(\"true\" if is_compliant else \"false\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef get_transfer_function_magnitudes(case, h_orders, f1, Rg, Lg):\n    \"\"\"\n    Calculates the magnitude of the transfer function G(jw) for each harmonic.\n    \"\"\"\n    topology = case[\"topology\"]\n    params = case[\"params\"]\n    \n    L1 = params.get(\"L1\", 0.0)\n    L2 = params.get(\"L2\", 0.0)\n    C = params.get(\"C\", 0.0)\n    Rv = params.get(\"Rv\", 0.0)\n\n    omega_h = 2 * np.pi * f1 * h_orders\n    g_magnitudes = []\n\n    for omega in omega_h:\n        # Define complex impedances for the current frequency\n        Z_g = Rg + 1j * omega * Lg\n        Z_L1 = 1j * omega * L1\n        \n        if topology == \"L\":\n            # G(jw) = 1 / (Z_L1 + Z_g)\n            G = 1 / (Z_L1 + Z_g)\n        \n        elif topology == \"LC\":\n            # Zc = 1 / (j*omega*C) since Rv=0\n            Z_C = 1 / (1j * omega * C)\n            # G(jw) = Zc / (Z_L1*Zc + Z_L1*Zg + Zc*Zg)\n            G = Z_C / (Z_L1 * Z_C + Z_L1 * Z_g + Z_C * Z_g)\n\n        elif topology == \"LCL\":\n            Z_L2 = 1j * omega * L2\n            Z_C = Rv + 1 / (1j * omega * C)\n            # G(jw) = Zc / (Z_L1*Z_L2 + Z_L1*Z_g + Z_L2*Z_c + Z_c*Z_g + Z_L1*Z_c)\n            numerator = Z_C\n            denominator = Z_L1*Z_L2 + Z_L1*Z_g + Z_L2*Z_C + Z_C*Z_g + Z_L1*Z_C\n            G = numerator / denominator\n            \n        else:\n            raise ValueError(f\"Unknown topology: {topology}\")\n            \n        g_magnitudes.append(np.abs(G))\n    \n    return np.array(g_magnitudes)\n\ndef evaluate_case(case, h_orders, Ah_base, Ih_lim, f1, Rg, Lg):\n    \"\"\"\n    Evaluates a single test case for harmonic compliance.\n    \"\"\"\n    g_mags = get_transfer_function_magnitudes(case, h_orders, f1, Rg, Lg)\n    \n    Ah_scaled = np.copy(Ah_base)\n    scaling_mode = case[\"scaling_mode\"]\n\n    if scaling_mode == \"Boundary\" or scaling_mode == \"Boundary-times\":\n        # Calculate ratio of current to limit for each harmonic\n        ratios = (g_mags * Ah_base) / Ih_lim\n        # Find scaling factor s_star\n        if np.max(ratios) == 0:\n            s_star = float('inf') # Avoid division by zero\n        else:\n            s_star = 1.0 / np.max(ratios)\n        \n        k = case[\"k_factor\"]\n        Ah_scaled = k * s_star * Ah_base\n\n    # For \"Direct\" mode, Ah_scaled remains Ah_base\n    \n    # Calculate final grid currents\n    Ig_h = g_mags * Ah_scaled\n    \n    # Check compliance for all harmonics\n    # Use a small tolerance for floating point comparisons\n    compliance_checks = Ig_h = Ih_lim * (1 + 1e-9)\n        \n    return np.all(compliance_checks)\n\n# Execute the simulation\nsolve()\n\n```"
        }
    ]
}