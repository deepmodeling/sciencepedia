{
    "hands_on_practices": [
        {
            "introduction": "The proliferation of non-linear loads, such as those found in power converters, means that currents in modern power systems are rarely pure sinusoids. To quantify the deviation of a waveform from an ideal sinusoid, we use metrics like Total Harmonic Distortion ($THD$). This practice takes you back to first principles, asking you to calculate the $THD$ of a current waveform given its harmonic components, based on the foundational concepts of root-mean-square (RMS) values and the orthogonality of Fourier series terms. Mastering this fundamental calculation is the first step toward diagnosing and mitigating power quality issues .",
            "id": "3887789",
            "problem": "A single-phase current drawn by a nonlinear load connected to an ideal sinusoidal voltage source at angular frequency $\\,\\omega_0\\,$ contains only the fundamental, third, and fifth harmonic components. The root-mean-square (RMS) magnitudes of these components are given by $\\,I_1 = 50\\ \\mathrm{A}$, $\\,I_3 = 10\\ \\mathrm{A}$, and $\\,I_5 = 5\\ \\mathrm{A}$. Using only the foundational definitions of root-mean-square values, orthogonality of distinct sinusoidal harmonics over an integer number of periods, and the standard power quality definitions of total harmonic distortion of current and distortion factor, determine the numerical values of:\n- the total harmonic distortion of current $\\,THD_I\\,$, defined in terms of the RMS magnitudes of the harmonic components, and\n- the distortion factor, defined as the ratio of the RMS fundamental component to the total RMS current.\n\nAssume that the given magnitudes $\\,I_n\\,$ are RMS values of each harmonic component, and that any harmonic phase angles are arbitrary but fixed. Report your two results in the order $\\,THD_I\\,$, then the distortion factor, each as a unitless decimal rounded to four significant figures. Do not use a percentage sign. The final numerical answer must be expressed as a pair of numbers in that order.",
            "solution": "The problem is evaluated as valid, as it is scientifically grounded in the principles of power electronics, self-contained, well-posed, objective, and free from any of the specified flaws.\n\nThe instantaneous current $i(t)$ drawn by the nonlinear load is composed of a fundamental component and harmonic components. It is given that only the fundamental, third, and fifth harmonics are present. The expression for this current is:\n$$i(t) = i_1(t) + i_3(t) + i_5(t)$$\nwhere $i_n(t)$ represents the $n$-th harmonic component. Given that $I_n$ is the root-mean-square (RMS) magnitude of the $n$-th harmonic, the instantaneous value of each component can be written as:\n$$i_n(t) = \\sqrt{2} I_n \\sin(n\\omega_0 t + \\phi_n)$$\nHere, $\\omega_0$ is the angular frequency of the fundamental component, and $\\phi_n$ is the phase angle of the $n$-th harmonic component. The problem states these phase angles are arbitrary but fixed.\n\nThe total RMS value of the current, $I_{rms}$, is defined by:\n$$I_{rms} = \\sqrt{\\frac{1}{T} \\int_0^T i(t)^2 dt}$$\nwhere $T = \\frac{2\\pi}{\\omega_0}$ is the period of the fundamental component.\nSubstituting the expression for $i(t)$:\n$$I_{rms}^2 = \\frac{1}{T} \\int_0^T \\left( \\sum_{n \\in \\{1,3,5\\}} \\sqrt{2} I_n \\sin(n\\omega_0 t + \\phi_n) \\right)^2 dt$$\nExpanding the square of the sum yields two types of terms: squared terms and cross-product terms.\n$$I_{rms}^2 = \\frac{1}{T} \\int_0^T \\left( \\sum_{n \\in \\{1,3,5\\}} 2 I_n^2 \\sin^2(n\\omega_0 t + \\phi_n) + \\sum_{\\substack{n, m \\in \\{1,3,5\\} \\\\ n \\neq m}} 2 I_n I_m \\sin(n\\omega_0 t + \\phi_n) \\sin(m\\omega_0 t + \\phi_m) \\right) dt$$\nThe problem requires using the orthogonality of distinct sinusoidal harmonics. This principle states that for integers $n \\neq m$:\n$$\\int_0^T \\sin(n\\omega_0 t + \\phi_n) \\sin(m\\omega_0 t + \\phi_m) dt = 0$$\nTherefore, all cross-product terms integrate to zero, and the expression for $I_{rms}^2$ simplifies to:\n$$I_{rms}^2 = \\sum_{n \\in \\{1,3,5\\}} \\frac{1}{T} \\int_0^T 2 I_n^2 \\sin^2(n\\omega_0 t + \\phi_n) dt$$\nThe average value of $\\sin^2(\\theta)$ over a full period is $\\frac{1}{2}$. The integral $\\frac{1}{T} \\int_0^T \\sin^2(n\\omega_0 t + \\phi_n) dt$ is taken over an integer number of cycles of the harmonic, so its value is $\\frac{1}{2}$.\n$$I_{rms}^2 = \\sum_{n \\in \\{1,3,5\\}} 2 I_n^2 \\left(\\frac{1}{2}\\right) = \\sum_{n \\in \\{1,3,5\\}} I_n^2$$\nThis demonstrates from foundational principles that the square of the total RMS current is the sum of the squares of the RMS values of the individual harmonic components.\n\nThe given RMS magnitudes are $I_1 = 50 \\ \\mathrm{A}$, $I_3 = 10 \\ \\mathrm{A}$, and $I_5 = 5 \\ \\mathrm{A}$.\nThe total RMS current is:\n$$I_{rms} = \\sqrt{I_1^2 + I_3^2 + I_5^2} = \\sqrt{50^2 + 10^2 + 5^2} = \\sqrt{2500 + 100 + 25} = \\sqrt{2625} \\ \\mathrm{A}$$\n\nFirst, we calculate the Total Harmonic Distortion of current, $THD_I$. It is defined as the ratio of the RMS value of the sum of all harmonic components (excluding the fundamental) to the RMS value of the fundamental component.\n$$THD_I = \\frac{\\sqrt{\\sum_{n=2}^{\\infty} I_n^2}}{I_1}$$\nFor this problem, this becomes:\n$$THD_I = \\frac{\\sqrt{I_3^2 + I_5^2}}{I_1}$$\nSubstituting the given values:\n$$THD_I = \\frac{\\sqrt{10^2 + 5^2}}{50} = \\frac{\\sqrt{100 + 25}}{50} = \\frac{\\sqrt{125}}{50} = \\frac{5\\sqrt{5}}{50} = \\frac{\\sqrt{5}}{10}$$\nThe numerical value is:\n$$THD_I \\approx 0.22360679...$$\nRounding to four significant figures, we get $THD_I = 0.2236$.\n\nNext, we calculate the distortion factor ($DF$), which is defined as the ratio of the RMS fundamental component to the total RMS current.\n$$DF = \\frac{I_1}{I_{rms}}$$\nUsing the values for $I_1$ and the calculated $I_{rms}$:\n$$DF = \\frac{50}{\\sqrt{2625}} = \\frac{50}{\\sqrt{25 \\times 105}} = \\frac{50}{5\\sqrt{105}} = \\frac{10}{\\sqrt{105}}$$\nThe numerical value is:\n$$DF \\approx 0.97590007...$$\nRounding to four significant figures, we get $DF = 0.9759$.\n\nThe two requested values in the specified order ($THD_I$, then distortion factor) are $0.2236$ and $0.9759$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.2236 & 0.9759\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "After quantifying harmonic distortion, the critical next step is to understand its impact. This exercise connects the Total Harmonic Distortion of current ($THD_I$) directly to the degradation of the true power factor, a key measure of power delivery efficiency. While the displacement power factor, $\\cos(\\phi)$, only captures the phase shift at the fundamental frequency, the presence of harmonics introduces a separate distortion component. By deriving the relationship between true power factor, displacement factor, and $THD_I$, you will gain a crucial quantitative understanding of why harmonic currents are detrimental to system performance .",
            "id": "3887758",
            "problem": "A balanced converter-fed load is supplied from a stiff, nearly ideal sinusoidal source whose voltage harmonics are negligible. The load current is nonsinusoidal with a measurable Total Harmonic Distortion of current (THD), defined for current as $THD_I \\equiv \\sqrt{\\sum_{h\\ge 2} I_h^2}/I_1$, where $I_1$ is the root-mean-square (RMS) value of the fundamental current component and $I_h$ are the RMS values of the $h$-th harmonic current components. The displacement power factor at the fundamental is characterized by the angle $\\phi$ (in radians) between the fundamental voltage and current, so that $\\cos\\phi$ is the displacement power factor.\n\nStarting from the fundamental definitions of real power $P$ as the time-average of the instantaneous power and apparent power $S$ as the product of RMS voltage and RMS current, and using the orthogonality of sinusoidal harmonics, derive an expression for the true power factor in terms of $THD_I$ and $\\cos\\phi$, under the stated assumption that the supply voltage is purely sinusoidal. Then, using $THD_I = 0.35$ and $\\cos\\phi = 0.9$, compute the true power factor. Finally, assess the local sensitivity of the true power factor to $THD_I$ at this operating point by analytically differentiating your expression with respect to $THD_I$ and evaluating it at $THD_I = 0.35$ and $\\cos\\phi = 0.9$, and explain the physical meaning of the sign and magnitude of this sensitivity.\n\nFor grading purposes, report only the computed true power factor as your final numerical answer. Express the true power factor as a dimensionless decimal and round your answer to four significant figures.",
            "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n**Step 1: Extracted Givens**\n- A balanced converter-fed load supplied from a stiff, nearly ideal sinusoidal source.\n- Voltage harmonics are negligible.\n- Load current is nonsinusoidal.\n- Total Harmonic Distortion of current: $THD_I \\equiv \\sqrt{\\sum_{h\\ge 2} I_h^2}/I_1$.\n- $I_1$ is the RMS value of the fundamental current.\n- $I_h$ are the RMS values of the $h$-th harmonic currents.\n- Displacement power factor is $\\cos\\phi$, where $\\phi$ is the angle between fundamental voltage and current.\n- Real power $P$ is the time-average of instantaneous power.\n- Apparent power $S$ is the product of RMS voltage and RMS current.\n- Orthogonality of sinusoidal harmonics is a given principle to use.\n- The supply voltage is purely sinusoidal.\n- Numerical values for evaluation: $THD_I = 0.35$ and $\\cos\\phi = 0.9$.\n- The task includes deriving an expression for true power factor, computing its value, and assessing its local sensitivity to $THD_I$.\n\n**Step 2: Validation**\nThe problem is scientifically grounded in the principles of power electronics and circuit theory. The definitions of Total Harmonic Distortion ($THD_I$), real power ($P$), apparent power ($S$), and power factor are standard. The assumption of a sinusoidal voltage source and a nonsinusoidal current is a canonical problem for analyzing the effects of nonlinear loads. The problem is self-contained, with all necessary information and definitions provided. The numerical values are physically realistic. The problem is well-posed and objective.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Derivation of True Power Factor**\n\nThe true power factor ($PF$) is defined as the ratio of real power ($P$) to apparent power ($S$).\n$$PF = \\frac{P}{S}$$\nWe will derive expressions for $P$ and $S$ based on the problem statement.\n\nThe source voltage is purely sinusoidal. We can represent it in the time domain as $v(t) = \\sqrt{2} V_1 \\cos(\\omega t)$, where $V_1$ is the RMS voltage of the fundamental (and total) voltage, and we have arbitrarily set its phase angle to zero.\n\nThe load current is nonsinusoidal and can be represented by its Fourier series:\n$$i(t) = \\sum_{h=1}^{\\infty} \\sqrt{2} I_h \\cos(h\\omega t - \\phi_h)$$\nHere, $I_h$ is the RMS value of the $h$-th harmonic component of the current, and $\\phi_h$ is its phase angle. The phase angle of the fundamental current ($h=1$) is given as $\\phi_1=\\phi$.\n\n**Real Power ($P$)**\nReal power is the time-average of the instantaneous power, $p(t) = v(t)i(t)$.\n$$P = \\frac{1}{T} \\int_0^T v(t)i(t) dt = \\frac{1}{T} \\int_0^T \\left( \\sqrt{2} V_1 \\cos(\\omega t) \\right) \\left( \\sum_{h=1}^{\\infty} \\sqrt{2} I_h \\cos(h\\omega t - \\phi_h) \\right) dt$$\nDue to the orthogonality of sinusoids, the integral of the product of two sinusoids of different frequencies over a full period is zero. Therefore, only the term where $h=1$ contributes to the average power.\n$$P = \\frac{1}{T} \\int_0^T \\left( \\sqrt{2} V_1 \\cos(\\omega t) \\right) \\left( \\sqrt{2} I_1 \\cos(\\omega t - \\phi) \\right) dt$$\n$$P = \\frac{2V_1 I_1}{T} \\int_0^T \\cos(\\omega t) \\cos(\\omega t - \\phi) dt$$\nUsing the trigonometric identity $\\cos(A)\\cos(B) = \\frac{1}{2}(\\cos(A-B) + \\cos(A+B))$, we get:\n$$P = V_1 I_1 \\left( \\frac{1}{T} \\int_0^T [\\cos(\\phi) + \\cos(2\\omega t - \\phi)] dt \\right)$$\nThe integral of the $\\cos(2\\omega t - \\phi)$ term over one period $T$ is zero.\n$$P = V_1 I_1 \\cos(\\phi) \\left( \\frac{1}{T} \\int_0^T dt \\right) = V_1 I_1 \\cos(\\phi)$$\n\n**Apparent Power ($S$)**\nApparent power is the product of the total RMS voltage $V_{rms}$ and the total RMS current $I_{rms}$.\n$$S = V_{rms} I_{rms}$$\nSince the voltage is purely sinusoidal, its RMS value is simply the RMS value of the fundamental: $V_{rms} = V_1$.\nThe RMS value of the nonsinusoidal current is the square root of the sum of the squares of the RMS values of its harmonic components:\n$$I_{rms} = \\sqrt{\\sum_{h=1}^{\\infty} I_h^2} = \\sqrt{I_1^2 + I_2^2 + I_3^2 + \\dots} = \\sqrt{I_1^2 + \\sum_{h=2}^{\\infty} I_h^2}$$\nWe are given the definition of the Total Harmonic Distortion of current:\n$$THD_I = \\frac{\\sqrt{\\sum_{h=2}^{\\infty} I_h^2}}{I_1}$$\nFrom this, we can express the sum of the squares of the harmonic currents:\n$$\\sum_{h=2}^{\\infty} I_h^2 = (I_1 \\cdot THD_I)^2 = I_1^2 (THD_I)^2$$\nSubstituting this into the expression for $I_{rms}$:\n$$I_{rms} = \\sqrt{I_1^2 + I_1^2 (THD_I)^2} = \\sqrt{I_1^2 (1 + (THD_I)^2)} = I_1 \\sqrt{1 + (THD_I)^2}$$\nNow, we can write the expression for apparent power:\n$$S = V_1 \\left( I_1 \\sqrt{1 + (THD_I)^2} \\right)$$\n\n**True Power Factor ($PF$) Expression**\nWe can now assemble the expression for the true power factor:\n$$PF = \\frac{P}{S} = \\frac{V_1 I_1 \\cos(\\phi)}{V_1 I_1 \\sqrt{1 + (THD_I)^2}}$$\nCanceling the $V_1$ and $I_1$ terms, we arrive at the desired expression:\n$$PF = \\frac{\\cos(\\phi)}{\\sqrt{1 + (THD_I)^2}}$$\nThis expression shows that the true power factor is the product of the displacement power factor, $\\cos(\\phi)$, and a distortion factor, $1/\\sqrt{1 + (THD_I)^2}$, which accounts for the harmonic distortion in the current.\n\n**Numerical Calculation**\nWe are given $THD_I = 0.35$ and a displacement power factor $\\cos(\\phi) = 0.9$.\nSubstituting these values into the derived expression:\n$$PF = \\frac{0.9}{\\sqrt{1 + (0.35)^2}} = \\frac{0.9}{\\sqrt{1 + 0.1225}} = \\frac{0.9}{\\sqrt{1.1225}}$$\n$$PF \\approx \\frac{0.9}{1.05948096} \\approx 0.84947029$$\nRounding to four significant figures, the true power factor is $0.8495$.\n\n**Sensitivity Analysis**\nTo assess the local sensitivity of the true power factor to $THD_I$, we compute the partial derivative $\\frac{\\partial(PF)}{\\partial(THD_I)}$.\n$$PF(THD_I, \\cos\\phi) = \\cos(\\phi) \\cdot (1 + (THD_I)^2)^{-1/2}$$\nUsing the chain rule for differentiation:\n$$\\frac{\\partial(PF)}{\\partial(THD_I)} = \\cos(\\phi) \\left[ -\\frac{1}{2} (1 + (THD_I)^2)^{-3/2} \\cdot (2 \\cdot THD_I) \\right]$$\n$$\\frac{\\partial(PF)}{\\partial(THD_I)} = - \\frac{THD_I \\cdot \\cos(\\phi)}{(1 + (THD_I)^2)^{3/2}}$$\nNow, we evaluate this derivative at the operating point $THD_I = 0.35$ and $\\cos(\\phi) = 0.9$:\n$$\\frac{\\partial(PF)}{\\partial(THD_I)}\\bigg|_{0.35, 0.9} = - \\frac{0.35 \\cdot 0.9}{(1 + (0.35)^2)^{3/2}} = - \\frac{0.315}{(1.1225)^{3/2}}$$\n$$\\frac{\\partial(PF)}{\\partial(THD_I)}\\bigg|_{0.35, 0.9} \\approx - \\frac{0.315}{1.18928} \\approx -0.26487$$\nThe physical meaning of this sensitivity is as follows:\n- **Sign**: The negative sign indicates that the true power factor decreases as the total harmonic distortion of the current increases. This is because a higher $THD_I$ implies a larger RMS current for the same amount of real power delivered, which by definition lowers the power factor $P/S$.\n- **Magnitude**: The magnitude of approximately $0.265$ quantifies this rate of decrease. At this operating point, a small increase in $THD_I$ of, for example, $0.01$, would lead to a decrease in the true power factor of approximately $0.265 \\times 0.01 = 0.00265$. This value indicates that the power factor is moderately sensitive to changes in current distortion.\n\nThe final answer requested is the computed numerical value of the true power factor.",
            "answer": "$$\\boxed{0.8495}$$"
        },
        {
            "introduction": "Harmonic distortions are not a localized phenomenon; harmonic currents produced by a single non-linear load can propagate through the grid and distort the voltage for other connected users. This advanced, code-based practice elevates our analysis from a single point to a system-wide perspective, modeling a radial power feeder with frequency-dependent impedance. By applying the principle of superposition, you will simulate how harmonic currents injected at one end of the feeder create voltage distortion ($THD_V$) at various points along the network. This exercise provides a realistic view of harmonic propagation, a critical concept for designing harmonic filters and ensuring power quality compliance across a distribution system .",
            "id": "3887669",
            "problem": "You are given a single-phase radial feeder modeled as a cascade of series segments with frequency-dependent impedances and an ideal sinusoidal source at the upstream end. An end customer at the downstream end injects harmonic currents. The objective is to compute the Total Harmonic Distortion (THD) of the bus voltage at a specified bus location along the feeder. The calculation must be based on first principles using Kirchhoff’s laws, Ohm’s law, and Fourier series definitions, and it must treat each harmonic as a steady-state phasor in the linear network.\n\nAssume the following physical and modeling premises:\n- The source is an ideal sinusoidal voltage source with root-mean-square (RMS) fundamental magnitude $V_{s1}$ and zero phase, in series with a source impedance that is frequency-dependent.\n- The feeder consists of $N$ series segments. Segment $i$ has resistance $R_i$ in $\\Omega$ and inductance $L_i$ in $\\text{H}$. Each segment’s series impedance at angular frequency $\\omega$ is $Z_i(\\omega) = R_i + j \\omega L_i$.\n- The source impedance at angular frequency $\\omega$ is $Z_s(\\omega) = R_s + j \\omega L_s$, where $R_s$ is in $\\Omega$ and $L_s$ is in $\\text{H}$.\n- The end customer injects a set of harmonic currents characterized by integer harmonic orders $h \\in \\mathcal{H}$; each harmonic current is given by an RMS magnitude $|I_h|$ in $\\text{A}$ and phase $\\angle I_h$ in radians. The fundamental current drawn by the customer is given by RMS magnitude $|I_1|$ in $\\text{A}$ and phase $\\angle I_1$ in radians. Angles must be interpreted in radians.\n- The fundamental line frequency is $f_0$ in $\\text{Hz}$, so the fundamental angular frequency is $\\omega_0 = 2 \\pi f_0$, and the $h$-th harmonic angular frequency is $\\omega_h = h \\, \\omega_0$.\n- The bus of interest is located at an index $k \\in \\{0,1,\\dots,N\\}$ counted from the source end, where $k=0$ denotes the bus immediately at the source terminal (upstream of all segments), and $k=N$ denotes the bus at the downstream end (after all segments). The upstream path from the source to the bus includes the source impedance and the first $k$ segments, and the downstream path from the bus to the customer includes the remaining $N-k$ segments.\n\nBased on these premises and the fundamental laws (Kirchhoff’s Voltage Law, Ohm’s law, and Fourier series/phasor definitions), derive the bus voltage phasor at the fundamental, derive the non-fundamental harmonic voltage phasors at the bus due to the injected harmonic currents, and from these obtain the Total Harmonic Distortion of the bus voltage. Express THD as a pure decimal (not a percentage), using RMS magnitudes, with angles in radians.\n\nYour program must implement the computation for each test case using the following steps:\n1. Construct the upstream equivalent series impedance seen from the bus for each angular frequency $\\omega$:\n   $$Z_{\\text{up}}(\\omega) = Z_s(\\omega) + \\sum_{i=0}^{k-1} Z_i(\\omega).$$\n2. Form the complex phasor of the fundamental source voltage: $V_{s1}\\angle 0$. Compute the fundamental bus voltage phasor:\n   $$V_1 = V_{s1}\\angle 0 - I_1 \\, Z_{\\text{up}}(\\omega_0),$$\n   where $I_1 = |I_1| \\, e^{j \\angle I_1}$.\n3. For each injected harmonic $h \\in \\mathcal{H}$, compute the bus harmonic voltage phasor:\n   $$V_h = - I_h \\, Z_{\\text{up}}(\\omega_h),$$\n   where $I_h = |I_h| \\, e^{j \\angle I_h}$.\n4. Compute the Total Harmonic Distortion (THD) of the bus voltage using RMS magnitudes of $V_h$ for $h \\ge 2$ and the RMS magnitude of $V_1$.\n\nAll physical quantities must be treated with their units explicitly as stated, and angles must be treated in radians. The final THD for each test case must be reported as a floating-point value.\n\nTest Suite:\nImplement your program to compute the THD for the following four test cases. In each case, all impedances are series elements, all magnitudes are RMS, and all angles are in radians.\n\n- Case A (moderate upstream impedance, medium voltage feeder):\n  - $f_0 = 50\\,\\text{Hz}$, $V_{s1} = 11000\\,\\text{V}$.\n  - Source impedance: $R_s = 0.1\\,\\Omega$, $L_s = 0.0005\\,\\text{H}$.\n  - Segments ($N=4$):\n    - Segment $0$: $R_0 = 0.2\\,\\Omega$, $L_0 = 0.0015\\,\\text{H}$.\n    - Segment $1$: $R_1 = 0.3\\,\\Omega$, $L_1 = 0.0020\\,\\text{H}$.\n    - Segment $2$: $R_2 = 0.25\\,\\Omega$, $L_2 = 0.0010\\,\\text{H}$.\n    - Segment $3$: $R_3 = 0.35\\,\\Omega$, $L_3 = 0.0025\\,\\text{H}$.\n  - Bus index: $k=2$.\n  - Fundamental current: $|I_1| = 100\\,\\text{A}$, $\\angle I_1 = -0.174532925\\,\\text{rad}$.\n  - Harmonic injections:\n    - $h=5$: $|I_5| = 20\\,\\text{A}$, $\\angle I_5 = -0.523598776\\,\\text{rad}$.\n    - $h=7$: $|I_7| = 15\\,\\text{A}$, $\\angle I_7 = 0.785398163\\,\\text{rad}$.\n    - $h=11$: $|I_{11}| = 8\\,\\text{A}$, $\\angle I_{11} = 0.0\\,\\text{rad}$.\n\n- Case B (stiff source at low voltage, bus at source terminal):\n  - $f_0 = 60\\,\\text{Hz}$, $V_{s1} = 400\\,\\text{V}$.\n  - Source impedance: $R_s = 0.01\\,\\Omega$, $L_s = 0.0001\\,\\text{H}$.\n  - Segments ($N=3$):\n    - Segment $0$: $R_0 = 0.05\\,\\Omega$, $L_0 = 0.0003\\,\\text{H}$.\n    - Segment $1$: $R_1 = 0.06\\,\\Omega$, $L_1 = 0.0004\\,\\text{H}$.\n    - Segment $2$: $R_2 = 0.04\\,\\Omega$, $L_2 = 0.0002\\,\\text{H}$.\n  - Bus index: $k=0$.\n  - Fundamental current: $|I_1| = 200\\,\\text{A}$, $\\angle I_1 = 0.0\\,\\text{rad}$.\n  - Harmonic injections:\n    - $h=3$: $|I_3| = 30\\,\\text{A}$, $\\angle I_3 = -0.261799388\\,\\text{rad}$.\n    - $h=5$: $|I_5| = 50\\,\\text{A}$, $\\angle I_5 = 0.34906585\\,\\text{rad}$.\n\n- Case C (large upstream impedance, stronger distortion):\n  - $f_0 = 50\\,\\text{Hz}$, $V_{s1} = 400\\,\\text{V}$.\n  - Source impedance: $R_s = 0.5\\,\\Omega$, $L_s = 0.005\\,\\text{H}$.\n  - Segments ($N=2$):\n    - Segment $0$: $R_0 = 0.8\\,\\Omega$, $L_0 = 0.004\\,\\text{H}$.\n    - Segment $1$: $R_1 = 0.4\\,\\Omega$, $L_1 = 0.002\\,\\text{H}$.\n  - Bus index: $k=1$.\n  - Fundamental current: $|I_1| = 150\\,\\text{A}$, $\\angle I_1 = -0.087266463\\,\\text{rad}$.\n  - Harmonic injections:\n    - $h=3$: $|I_3| = 25\\,\\text{A}$, $\\angle I_3 = 0.0\\,\\text{rad}$.\n    - $h=5$: $|I_5| = 40\\,\\text{A}$, $\\angle I_5 = 0.261799388\\,\\text{rad}$.\n    - $h=7$: $|I_7| = 35\\,\\text{A}$, $\\angle I_7 = -0.34906585\\,\\text{rad}$.\n\n- Case D (no harmonic injection, baseline THD):\n  - $f_0 = 50\\,\\text{Hz}$, $V_{s1} = 690\\,\\text{V}$.\n  - Source impedance: $R_s = 0.2\\,\\Omega$, $L_s = 0.001\\,\\text{H}$.\n  - Segments ($N=2$):\n    - Segment $0$: $R_0 = 0.1\\,\\Omega$, $L_0 = 0.001\\,\\text{H}$.\n    - Segment $1$: $R_1 = 0.2\\,\\Omega$, $L_1 = 0.002\\,\\text{H}$.\n  - Bus index: $k=2$.\n  - Fundamental current: $|I_1| = 100\\,\\text{A}$, $\\angle I_1 = 0.174532925\\,\\text{rad}$.\n  - Harmonic injections: none (i.e., $\\mathcal{H}$ is empty).\n\nFinal Output Format:\nYour program should produce a single line of output containing the THD results for the four cases as a comma-separated list enclosed in square brackets, in the order [Case A, Case B, Case C, Case D], for example \"[resultA,resultB,resultC,resultD]\". Each element must be a floating-point value representing THD as a decimal (unitless), consistent with the definitions above.",
            "solution": "The solution requires computing the Total Harmonic Distortion (THD) of the voltage at a specified bus $k$. This is achieved by applying the principle of superposition to the linear feeder network. Each frequency component (fundamental and harmonics) is analyzed separately, and the results are combined to calculate the THD.\n\n**1. Upstream Impedance Calculation**\nThe path from the ideal source to the bus of interest (bus $k$) consists of the source impedance $Z_s(\\omega)$ and the impedances of the first $k$ feeder segments, $Z_0(\\omega)$ through $Z_{k-1}(\\omega)$. The total upstream impedance, $Z_{\\text{up}}(\\omega)$, is the series combination of these elements.\nLet $R_{\\text{up}} = R_s + \\sum_{i=0}^{k-1} R_i$ and $L_{\\text{up}} = L_s + \\sum_{i=0}^{k-1} L_i$.\nThe frequency-dependent upstream impedance is then given by:\n$$Z_{\\text{up}}(\\omega) = R_{\\text{up}} + j\\omega L_{\\text{up}}$$\nFor the special case $k=0$, the summation is over an empty set, resulting in $R_{\\text{up}} = R_s$ and $L_{\\text{up}} = L_s$.\n\n**2. Fundamental Bus Voltage ($V_1$)**\nAt the fundamental frequency $\\omega_0 = 2 \\pi f_0$, the circuit is driven by the source voltage $V_{s1}\\angle 0$. The customer draws a fundamental current $I_1$. The voltage at bus $k$, denoted by the phasor $V_1$, is the source voltage minus the voltage drop across the upstream impedance $Z_{\\text{up}}(\\omega_0)$.\n$$V_1 = (V_{s1} + j0) - I_1 Z_{\\text{up}}(\\omega_0)$$\nwhere $I_1$ is the complex phasor $|I_1| e^{j \\angle I_1}$ and $Z_{\\text{up}}(\\omega_0) = R_{\\text{up}} + j\\omega_0 L_{\\text{up}}$. The magnitude $|V_1|$ is required for the THD calculation.\n\n**3. Harmonic Bus Voltages ($V_h$)**\nFor each harmonic of order $h \\in \\mathcal{H}$, we analyze the circuit at frequency $\\omega_h = h \\omega_0$. At these frequencies, the ideal fundamental voltage source is inactive (a short circuit). The system is driven by the harmonic current $I_h$ drawn by the load. The voltage produced at bus $k$ due to this current is the voltage drop it causes across the upstream impedance.\nThe voltage phasor $V_h$ at bus $k$ is:\n$$V_h = -I_h Z_{\\text{up}}(\\omega_h)$$\nwhere $I_h = |I_h| e^{j \\angle I_h}$ and $Z_{\\text{up}}(\\omega_h) = R_{\\text{up}} + j\\omega_h L_{\\text{up}}$. This calculation must be repeated for each harmonic in the set $\\mathcal{H}$.\n\n**4. Total Harmonic Distortion (THD) Calculation**\nThe THD of a voltage waveform is defined as the ratio of the root-mean-square (RMS) value of the sum of its harmonic components to the RMS value of its fundamental component.\n$$\\text{THD}_V = \\frac{\\sqrt{\\sum_{h=2}^{\\infty} |V_h|^2}}{|V_1|}$$\nIn this problem, the summation is performed over the specified set of harmonics $\\mathcal{H}$.\n$$\\text{THD} = \\frac{\\sqrt{\\sum_{h \\in \\mathcal{H}} |V_h|^2}}{|V_1|}$$\nIf the set $\\mathcal{H}$ is empty (no harmonic injections), the numerator is zero, and thus the THD is zero.\n\nThe implementation will systematically apply these four steps to each test case provided. Numerical calculations will be performed using complex number arithmetic.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the Total Harmonic Distortion (THD) for a series of test cases\n    based on the provided power system feeder model and harmonic analysis formulas.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {\n            \"f0\": 50.0, \"Vs1\": 11000.0,\n            \"source_z\": {\"R\": 0.1, \"L\": 0.0005},\n            \"segments\": [\n                {\"R\": 0.2, \"L\": 0.0015},\n                {\"R\": 0.3, \"L\": 0.0020},\n                {\"R\": 0.25, \"L\": 0.0010},\n                {\"R\": 0.35, \"L\": 0.0025},\n            ],\n            \"k\": 2,\n            \"I1\": (100.0, -0.174532925),\n            \"harmonics\": [\n                {\"h\": 5, \"I\": (20.0, -0.523598776)},\n                {\"h\": 7, \"I\": (15.0, 0.785398163)},\n                {\"h\": 11, \"I\": (8.0, 0.0)},\n            ],\n        },\n        # Case B\n        {\n            \"f0\": 60.0, \"Vs1\": 400.0,\n            \"source_z\": {\"R\": 0.01, \"L\": 0.0001},\n            \"segments\": [\n                {\"R\": 0.05, \"L\": 0.0003},\n                {\"R\": 0.06, \"L\": 0.0004},\n                {\"R\": 0.04, \"L\": 0.0002},\n            ],\n            \"k\": 0,\n            \"I1\": (200.0, 0.0),\n            \"harmonics\": [\n                {\"h\": 3, \"I\": (30.0, -0.261799388)},\n                {\"h\": 5, \"I\": (50.0, 0.34906585)},\n            ],\n        },\n        # Case C\n        {\n            \"f0\": 50.0, \"Vs1\": 400.0,\n            \"source_z\": {\"R\": 0.5, \"L\": 0.005},\n            \"segments\": [\n                {\"R\": 0.8, \"L\": 0.004},\n                {\"R\": 0.4, \"L\": 0.002},\n            ],\n            \"k\": 1,\n            \"I1\": (150.0, -0.087266463),\n            \"harmonics\": [\n                {\"h\": 3, \"I\": (25.0, 0.0)},\n                {\"h\": 5, \"I\": (40.0, 0.261799388)},\n                {\"h\": 7, \"I\": (35.0, -0.34906585)},\n            ],\n        },\n        # Case D\n        {\n            \"f0\": 50.0, \"Vs1\": 690.0,\n            \"source_z\": {\"R\": 0.2, \"L\": 0.001},\n            \"segments\": [\n                {\"R\": 0.1, \"L\": 0.001},\n                {\"R\": 0.2, \"L\": 0.002},\n            ],\n            \"k\": 2,\n            \"I1\": (100.0, 0.174532925),\n            \"harmonics\": [],\n        },\n    ]\n\n    def compute_thd(case_params):\n        \"\"\"\n        Computes the THD for a single case.\n        \"\"\"\n        f0 = case_params[\"f0\"]\n        Vs1 = case_params[\"Vs1\"]\n        k = case_params[\"k\"]\n        w0 = 2 * np.pi * f0\n\n        # Step 1: Construct the upstream equivalent series impedance\n        R_up = case_params[\"source_z\"][\"R\"]\n        L_up = case_params[\"source_z\"][\"L\"]\n        for i in range(k):\n            R_up += case_params[\"segments\"][i][\"R\"]\n            L_up += case_params[\"segments\"][i][\"L\"]\n\n        # Step 2: Compute the fundamental bus voltage phasor\n        w1 = w0\n        Z_up_w1 = R_up + 1j * w1 * L_up\n        I1_mag, I1_ang = case_params[\"I1\"]\n        I1_phasor = I1_mag * np.exp(1j * I1_ang)\n        V1_phasor = Vs1 - I1_phasor * Z_up_w1\n        V1_mag = np.abs(V1_phasor)\n        \n        if V1_mag == 0:\n            return float('inf')\n\n        # Step 3: For each injected harmonic, compute the bus harmonic voltage phasor\n        sum_sq_Vh = 0.0\n        for harm in case_params[\"harmonics\"]:\n            h = harm[\"h\"]\n            Ih_mag, Ih_ang = harm[\"I\"]\n            wh = h * w0\n            \n            Z_up_wh = R_up + 1j * wh * L_up\n            Ih_phasor = Ih_mag * np.exp(1j * Ih_ang)\n            \n            Vh_phasor = -Ih_phasor * Z_up_wh\n            sum_sq_Vh += np.abs(Vh_phasor)**2\n\n        # Step 4: Compute the Total Harmonic Distortion (THD)\n        thd = np.sqrt(sum_sq_Vh) / V1_mag\n        return thd\n\n    results = [compute_thd(case) for case in test_cases]\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}