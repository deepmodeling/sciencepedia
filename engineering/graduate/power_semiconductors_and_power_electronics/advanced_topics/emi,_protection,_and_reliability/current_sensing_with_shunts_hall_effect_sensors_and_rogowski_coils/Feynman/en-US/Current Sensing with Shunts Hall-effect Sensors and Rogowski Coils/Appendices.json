{
    "hands_on_practices": [
        {
            "introduction": "Open-loop Hall-effect sensors provide galvanic isolation, a key advantage in many power electronic systems. However, their internal components are sensitive to temperature, causing their sensitivity and offset voltage to drift. This practice  challenges you to quantify these temperature-induced errors by modeling the sensor's behavior, a crucial first step in designing a temperature-compensated measurement system or determining if a sensor meets a given accuracy specification.",
            "id": "3831272",
            "problem": "A three-phase inverter uses an open-loop Hall-effect sensor (no flux-nulling) to measure the phase current. The Hall-effect sensor is specified to have a nominal sensitivity at $T_0 = 25^{\\circ}\\mathrm{C}$ of $S_0 = 185\\,\\mathrm{mV/A}$ and an initial output offset at $T_0$ that is removed by a one-point offset calibration performed at $T_0$. Over temperature, the sensor exhibits a fractional sensitivity temperature coefficient $k_S = 7.0 \\times 10^{-4}\\,\\mathrm{/^{\\circ}C}$ and an offset drift $k_{\\mathrm{off}} = 1.5\\,\\mathrm{mV/^{\\circ}C}$. The ambient temperature varies within $-40^{\\circ}\\mathrm{C}$ to $125^{\\circ}\\mathrm{C}$. The current of interest lies in the interval $I \\in [5\\,\\mathrm{A},\\,30\\,\\mathrm{A}]$.\n\nStarting from first principles that relate the Hall-effect sensor output to the magnetic field induced by the conductor current and the linearized transfer characteristics of the sensor, model the sensor’s output and the estimation procedure after offset calibration at $T_0$. Derive the expression for the fractional error in the estimated current at an arbitrary temperature $T$ and current $I$ due to (i) sensitivity drift and (ii) offset drift, assuming no flux-nulling or temperature compensation beyond the single offset calibration at $T_0$. Then, determine the worst-case fractional error over the specified temperature and current ranges.\n\nFinally, the design requires accuracy within $\\pm \\epsilon$ over temperature, with $\\epsilon = 0.03$ expressed as a decimal fraction. Compute the worst-case fractional error as a single real number. Express your final result as a decimal fraction and round your answer to four significant figures.",
            "solution": "The problem is validated as self-contained, scientifically grounded, well-posed, and objective. It presents a standard engineering analysis task based on a linear model of a Hall-effect sensor, with all necessary parameters provided. There are no contradictions, ambiguities, or violations of scientific principles. Thus, a solution will be derived.\n\nFirst, we establish the model for the sensor's output voltage. The output of a Hall-effect sensor, $V_{\\text{out}}$, is linearly related to the measured current $I$ and has an offset voltage. Both the sensitivity and the offset are functions of temperature $T$. The model is:\n$$V_{\\text{out}}(I, T) = S(T) \\cdot I + V_{\\text{off}}(T)$$\nwhere $S(T)$ is the sensitivity at temperature $T$ and $V_{\\text{off}}(T)$ is the output offset voltage at temperature $T$.\n\nThe problem provides linear models for the temperature dependence of sensitivity and offset, relative to a reference temperature $T_0 = 25^{\\circ}\\mathrm{C}$.\nThe sensitivity $S(T)$ is given by:\n$$S(T) = S_0 (1 + k_S (T - T_0))$$\nwhere $S_0 = 185\\,\\mathrm{mV/A}$ is the nominal sensitivity at $T_0$ and $k_S = 7.0 \\times 10^{-4}\\,\\mathrm{/^{\\circ}C}$ is the fractional sensitivity temperature coefficient.\n\nThe offset voltage $V_{\\text{off}}(T)$ consists of an initial offset at $T_0$, let's call it $V_{\\text{off,init}}$, and a temperature-dependent drift:\n$$V_{\\text{off}}(T) = V_{\\text{off,init}} + k_{\\mathrm{off}} (T - T_0)$$\nwhere $k_{\\mathrm{off}} = 1.5\\,\\mathrm{mV/^{\\circ}C}$ is the offset drift.\n\nA one-point offset calibration is performed at the reference temperature $T_0$. This involves measuring the output at zero current ($I=0$) and $T=T_0$, and subtracting this value from subsequent measurements. The calibration value, $V_{\\text{cal}}$, is:\n$$V_{\\text{cal}} = V_{\\text{out}}(0, T_0) = S(T_0) \\cdot 0 + V_{\\text{off}}(T_0) = V_{\\text{off}}(T_0)$$\nFrom the offset model, $V_{\\text{off}}(T_0) = V_{\\text{off,init}} + k_{\\mathrm{off}}(T_0 - T_0) = V_{\\text{off,init}}$. Thus, the calibration step effectively measures and removes the initial offset, $V_{\\text{cal}} = V_{\\text{off,init}}$.\n\nThe calibrated output voltage, $V_{\\text{calibrated}}$, at an arbitrary current $I$ and temperature $T$ is:\n$$V_{\\text{calibrated}}(I, T) = V_{\\text{out}}(I, T) - V_{\\text{cal}}$$\n$$V_{\\text{calibrated}}(I, T) = [S(T) \\cdot I + V_{\\text{off}}(T)] - V_{\\text{off,init}}$$\nSubstituting the expressions for $S(T)$ and $V_{\\text{off}}(T)$:\n$$V_{\\text{calibrated}}(I, T) = [S_0 (1 + k_S (T - T_0)) \\cdot I + (V_{\\text{off,init}} + k_{\\mathrm{off}} (T - T_0))] - V_{\\text{off,init}}$$\n$$V_{\\text{calibrated}}(I, T) = S_0 (1 + k_S (T - T_0)) \\cdot I + k_{\\mathrm{off}} (T - T_0)$$\nThis equation models the sensor's output after the specified calibration.\n\nThe estimation of the current, $I_{\\text{est}}$, is performed by the system assuming the nominal sensitivity $S_0$ and zero offset:\n$$I_{\\text{est}} = \\frac{V_{\\text{calibrated}}(I, T)}{S_0}$$\nSubstituting the expression for $V_{\\text{calibrated}}(I, T)$:\n$$I_{\\text{est}} = \\frac{S_0 (1 + k_S (T - T_0)) \\cdot I + k_{\\mathrm{off}} (T - T_0)}{S_0}$$\n$$I_{\\text{est}} = (1 + k_S (T - T_0)) \\cdot I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0)$$\nThe fractional error, $\\epsilon_f$, in the estimated current is defined as $\\frac{I_{\\text{est}} - I}{I}$.\n$$\\epsilon_f(I, T) = \\frac{[(1 + k_S (T - T_0)) \\cdot I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0)] - I}{I}$$\n$$\\epsilon_f(I, T) = \\frac{I + k_S (T - T_0) I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0) - I}{I}$$\n$$\\epsilon_f(I, T) = \\frac{k_S (T - T_0) I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0)}{I}$$\nSeparating the terms, we can identify the error contributions:\n$$\\epsilon_f(I, T) = k_S(T - T_0) + \\frac{k_{\\mathrm{off}}}{S_0 I}(T - T_0)$$\nThe term $k_S(T - T_0)$ is the fractional error due to sensitivity drift, and the term $\\frac{k_{\\mathrm{off}}}{S_0 I}(T - T_0)$ is the fractional error due to offset drift.\nThis can be factored as:\n$$\\epsilon_f(I, T) = \\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)(T - T_0)$$\nTo find the worst-case fractional error, we must find the maximum absolute value of $\\epsilon_f(I, T)$ over the specified ranges: $I \\in [5\\,\\mathrm{A}, 30\\,\\mathrm{A}]$ and $T \\in [-40^{\\circ}\\mathrm{C}, 125^{\\circ}\\mathrm{C}]$.\nLet $\\Delta T = T - T_0$. Since $T_0 = 25^{\\circ}\\mathrm{C}$, the range for $\\Delta T$ is:\n$$\\Delta T \\in [(-40 - 25), (125 - 25)] \\implies \\Delta T \\in [-65^{\\circ}\\mathrm{C}, 100^{\\circ}\\mathrm{C}]$$\nThe parameters $k_S$, $k_{\\mathrm{off}}$, and $S_0$ are positive constants, and the current $I$ is also positive. Therefore, the term $\\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)$ is always positive.\nTo maximize $|\\epsilon_f(I, T)| = \\left|\\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)\\Delta T\\right| = \\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)|\\Delta T|$, we must maximize each factor.\n\n1. Maximizing $|\\Delta T|$: The range for $\\Delta T$ is $[-65, 100]$. The maximum absolute value is $|\\Delta T|_{\\max} = \\max(|-65|, |100|) = 100^{\\circ}\\mathrm{C}$, which occurs at $T_{\\max} = 125^{\\circ}\\mathrm{C}$.\n\n2. Maximizing $\\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)$: This term is a function of $I$. Since $\\frac{k_{\\mathrm{off}}}{S_0}$ is positive, the term is maximized when $I$ is minimized. The minimum current is $I_{\\min} = 5\\,\\mathrm{A}$.\n\nCombining these two conditions, the worst-case (maximum magnitude) error occurs at $I = 5\\,\\mathrm{A}$ and $T = 125^{\\circ}\\mathrm{C}$ (or possibly $T = -40^{\\circ}\\mathrm{C}$, which gives a smaller $|\\Delta T|$). The extremity of the error function will be at one of the corners of the $(I, T)$ domain. Since the pre-factor for $\\Delta T$ is always positive, the sign of the error is the same as the sign of $\\Delta T$. The largest magnitude error will occur at the temperature furthest from $T_0$, which is $T=125^{\\circ}\\mathrm{C}$, and the current which maximizes the error contributions, which is $I=5\\,\\mathrm{A}$.\n\nThe worst-case fractional error, $\\epsilon_{f, \\text{wc}}$, is therefore:\n$$\\epsilon_{f, \\text{wc}} = \\epsilon_f(5\\,\\mathrm{A}, 125^{\\circ}\\mathrm{C}) = \\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 \\cdot (5\\,\\mathrm{A})}\\right)(125^{\\circ}\\mathrm{C} - 25^{\\circ}\\mathrm{C})$$\nPlugging in the given values:\n$$k_S = 7.0 \\times 10^{-4}\\,\\mathrm{/^{\\circ}C}$$\n$$k_{\\mathrm{off}} = 1.5\\,\\mathrm{mV/^{\\circ}C}$$\n$$S_0 = 185\\,\\mathrm{mV/A}$$\n$$\\epsilon_{f, \\text{wc}} = \\left(7.0 \\times 10^{-4} + \\frac{1.5}{185 \\cdot 5}\\right) \\cdot 100$$\n$$\\epsilon_{f, \\text{wc}} = \\left(7.0 \\times 10^{-4} + \\frac{1.5}{925}\\right) \\cdot 100$$\nWe can calculate the numerical value:\n$$\\epsilon_{f, \\text{wc}} = (0.0007 + 0.0016216216...) \\cdot 100$$\n$$\\epsilon_{f, \\text{wc}} = (0.0023216216...) \\cdot 100$$\n$$\\epsilon_{f, \\text{wc}} = 0.23216216...$$\nAlternatively, using fractions for precision before final rounding:\n$$\\epsilon_{f, \\text{wc}} = 100 \\cdot k_S + \\frac{100 \\cdot k_{\\mathrm{off}}}{S_0 \\cdot 5} = 100 \\cdot (7.0 \\times 10^{-4}) + \\frac{100 \\cdot 1.5}{185 \\cdot 5}$$\n$$\\epsilon_{f, \\text{wc}} = 0.07 + \\frac{150}{925}$$\nSimplifying the fraction: $\\frac{150}{925} = \\frac{6 \\times 25}{37 \\times 25} = \\frac{6}{37}$.\n$$\\epsilon_{f, \\text{wc}} = 0.07 + \\frac{6}{37} = \\frac{7}{100} + \\frac{6}{37} = \\frac{7 \\cdot 37 + 6 \\cdot 100}{3700} = \\frac{259 + 600}{3700} = \\frac{859}{3700}$$\n$$\\epsilon_{f, \\text{wc}} = \\frac{859}{3700} \\approx 0.232162162...$$\nThe problem requires the result to be rounded to four significant figures.\nThe first four significant figures are $2$, $3$, $2$, $1$. The fifth significant figure is $6$, so we round up the fourth figure.\n$$\\epsilon_{f, \\text{wc}} \\approx 0.2322$$\nThis worst-case error of approximately $23.22\\,\\%$ is significantly larger than the required accuracy of $\\epsilon=0.03$ or $3\\,\\%$, indicating the uncompensated sensor is not suitable for this design requirement.",
            "answer": "$$\\boxed{0.2322}$$"
        },
        {
            "introduction": "While shunt resistors offer a simple, linear, and high-bandwidth way to measure current, the small differential voltage they produce is often superimposed on a large, rapidly changing common-mode voltage present in switching converters. This exercise  delves into the critical role of the differential amplifier's Common-Mode Rejection Ratio (CMRR) in preserving signal integrity. You will derive the relationship between CMRR and measurement error, learning how to specify the required amplifier performance to ensure accuracy in a noisy environment.",
            "id": "3831224",
            "problem": "A precision differential front-end is used to sense current in a high-power synchronous buck converter using a low-ohmic shunt resistor. The shunt has resistance $R_{s} = 5.00 \\times 10^{-4}\\ \\Omega$ and carries a slowly varying current of amplitude $I = 100\\ \\mathrm{A}$ so that the differential signal amplitude across the shunt is $V_{s} = I R_{s}$. Due to capacitive coupling from the switching node, both amplifier inputs experience a common-mode sinusoidal interference of amplitude $V_{CM} = 12.0\\ \\mathrm{V}$ at frequency $f = 100\\ \\mathrm{kHz}$. The differential amplifier has finite Common-Mode Rejection Ratio (CMRR), specified in decibels.\n\nStarting only from the definitions of differential gain, common-mode gain, and Common-Mode Rejection Ratio (CMRR), first derive an input-referred expression for the differential error amplitude caused by the common-mode interference $V_{CM}$ in terms of the CMRR specified in decibels. Then, by requiring that the ratio of the common-mode-induced input-referred error amplitude to the differential signal amplitude $V_{s}$ does not exceed a specified error bound $\\epsilon = 0.010$, compute the minimum CMRR at the frequency $f$ that guarantees this bound.\n\nExpress the required CMRR in dB, and round your answer to four significant figures.",
            "solution": "The problem is validated as scientifically sound, well-posed, objective, and self-contained. The provided values are realistic for a high-power synchronous buck converter application. The task is to first derive an expression for the input-referred error due to common-mode interference and then calculate the minimum required Common-Mode Rejection Ratio (CMRR) to meet a specified error bound.\n\nFirst, we establish the fundamental definitions for a differential amplifier. Let the two input voltages be $v_1$ and $v_2$. The differential input voltage, $v_d$, and the common-mode input voltage, $v_{cm}$, are defined as:\n$$v_d = v_1 - v_2$$\n$$v_{cm} = \\frac{v_1 + v_2}{2}$$\nThe output voltage, $v_o$, of the differential amplifier is a linear combination of the differential and common-mode inputs, characterized by the differential gain, $A_d$, and the common-mode gain, $A_{cm}$:\n$$v_o = A_d v_d + A_{cm} v_{cm}$$\nThe portion of the output voltage that arises from the common-mode input is the error component, $v_{o,err}$:\n$$v_{o,err} = A_{cm} v_{cm}$$\nTo determine the input-referred differential error voltage, $v_{d,err}$, we find the equivalent differential input that would produce this same error at the output. This is done by dividing the output error by the differential gain:\n$$v_{d,err} = \\frac{v_{o,err}}{A_d} = \\frac{A_{cm} v_{cm}}{A_d}$$\nThe Common-Mode Rejection Ratio (CMRR) is defined as the magnitude of the ratio of the differential gain to the common-mode gain:\n$$\\mathrm{CMRR} = \\left| \\frac{A_d}{A_{cm}} \\right|$$\nSubstituting the definition of CMRR into the expression for the input-referred error voltage gives:\n$$v_{d,err} = \\frac{v_{cm}}{\\mathrm{CMRR}}$$\nThe problem specifies a common-mode sinusoidal interference with amplitude $V_{CM}$. Thus, the amplitude of the input-referred differential error voltage, which we denote as $V_{d,err}$, is:\n$$V_{d,err} = \\frac{V_{CM}}{\\mathrm{CMRR}}$$\nThe CMRR is often specified in decibels ($\\mathrm{dB}$), and the relationship is:\n$$\\mathrm{CMRR}_{\\mathrm{dB}} = 20 \\log_{10}(\\mathrm{CMRR})$$\nFrom this definition, we can express CMRR in terms of its decibel value:\n$$\\mathrm{CMRR} = 10^{\\frac{\\mathrm{CMRR}_{\\mathrm{dB}}}{20}}$$\nSubstituting this into our expression for the error amplitude, we obtain the input-referred differential error amplitude in terms of $\\mathrm{CMRR}_{\\mathrm{dB}}$:\n$$V_{d,err} = \\frac{V_{CM}}{10^{\\frac{\\mathrm{CMRR}_{\\mathrm{dB}}}{20}}} = V_{CM} \\cdot 10^{-\\frac{\\mathrm{CMRR}_{\\mathrm{dB}}}{20}}$$\nThis completes the first part of the problem, the derivation of the input-referred error amplitude.\n\nNext, we must compute the minimum CMRR required to satisfy a given error bound. The problem states that the ratio of the common-mode-induced input-referred error amplitude, $V_{d,err}$, to the desired differential signal amplitude, $V_s$, must not exceed a specified error bound, $\\epsilon$. This requirement is expressed as:\n$$\\frac{V_{d,err}}{V_s} \\le \\epsilon$$\nSubstituting the expression for $V_{d,err}$:\n$$\\frac{V_{CM} / \\mathrm{CMRR}}{V_s} \\le \\epsilon$$\nTo find the minimum CMRR that guarantees this bound, we solve for CMRR at the limit of the inequality:\n$$\\frac{V_{CM}}{\\mathrm{CMRR} \\cdot V_s} = \\epsilon$$\n$$\\mathrm{CMRR} \\ge \\frac{V_{CM}}{\\epsilon V_s}$$\nThe minimum required CMRR is therefore:\n$$\\mathrm{CMRR}_{\\mathrm{min}} = \\frac{V_{CM}}{\\epsilon V_s}$$\nWe are given the following values:\nCommon-mode interference amplitude, $V_{CM} = 12.0\\ \\mathrm{V}$.\nError bound, $\\epsilon = 0.010$.\nShunt resistance, $R_s = 5.00 \\times 10^{-4}\\ \\Omega$.\nCurrent amplitude, $I = 100\\ \\mathrm{A}$.\n\nFirst, we calculate the differential signal amplitude, $V_s$:\n$$V_s = I R_s = (100\\ \\mathrm{A}) \\times (5.00 \\times 10^{-4}\\ \\Omega) = 0.0500\\ \\mathrm{V}$$\nNow, we can compute the minimum required CMRR as a linear ratio:\n$$\\mathrm{CMRR}_{\\mathrm{min}} = \\frac{12.0\\ \\mathrm{V}}{0.010 \\times 0.0500\\ \\mathrm{V}} = \\frac{12.0}{5.00 \\times 10^{-4}} = 24000$$\nThe problem requires the answer in decibels. We convert this linear ratio to $\\mathrm{dB}$:\n$$\\mathrm{CMRR}_{\\mathrm{dB,min}} = 20 \\log_{10}(\\mathrm{CMRR}_{\\mathrm{min}}) = 20 \\log_{10}(24000)$$\n$$\\mathrm{CMRR}_{\\mathrm{dB,min}} = 20 \\log_{10}(2.4 \\times 10^4) = 20 (\\log_{10}(2.4) + \\log_{10}(10^4))$$\n$$\\mathrm{CMRR}_{\\mathrm{dB,min}} = 20 (\\log_{10}(2.4) + 4)$$\nUsing a calculator, $\\log_{10}(2.4) \\approx 0.380211$.\n$$\\mathrm{CMRR}_{\\mathrm{dB,min}} \\approx 20 (0.380211 + 4) = 20 \\times 4.380211 \\approx 87.60422\\ \\mathrm{dB}$$\nThe problem asks to round the final answer to four significant figures.\n$$\\mathrm{CMRR}_{\\mathrm{dB,min}} \\approx 87.60\\ \\mathrm{dB}$$\nThis is the minimum CMRR at the interference frequency $f = 100\\ \\mathrm{kHz}$ required to ensure that the error induced by the common-mode voltage is no more than $1\\%$ of the signal being measured.",
            "answer": "$$\\boxed{87.60}$$"
        },
        {
            "introduction": "A precision measurement system is only as accurate as its weakest link, and in a current sensing signal chain, errors accumulate from every component—the shunt, the amplifier, and the ADC reference. This practice  provides a system-level perspective, guiding you through a worst-case error analysis by propagating the tolerances of individual components. Beyond just quantifying the error, this problem introduces the powerful engineering solution of a two-point calibration routine to digitally correct for these combined static errors.",
            "id": "3831293",
            "problem": "A resistive shunt current sensor is used to measure the phase current of a power converter leg. The signal chain consists of a precision resistive shunt of nominal resistance $R_{s}$, followed by a low-noise instrumentation amplifier with gain $G_{a}$, and an Analog-to-Digital Converter (ADC) with a nominal reference voltage $V_{\\mathrm{ref}}$. Assume ideal linear components except for specified small relative tolerances, and ignore second-order effects such as temperature drift, self-heating, and nonlinearity. The conversion chain maps input current $I$ to ADC output codes $C$ through Ohm’s law and ideal linear transfer characteristics.\n\nGiven:\n- Shunt nominal resistance $R_{s} = 5.00 \\times 10^{-4}\\ \\Omega$ with relative tolerance $t_{R} = \\pm 2.5 \\times 10^{-3}$.\n- Amplifier nominal gain $G_{a} = 60$ with relative tolerance $t_{G} = \\pm 8.0 \\times 10^{-4}$.\n- ADC nominal reference $V_{\\mathrm{ref}} = 2.500\\ \\mathrm{V}$ with relative tolerance $t_{V} = \\pm 5.0 \\times 10^{-4}$.\n- ADC is ideal and unipolar, and the exact number of bits is not required for this calculation.\n\nStarting from fundamental laws and definitions (Ohm’s law for the shunt, linear amplification, and ideal ADC code proportionality to input voltage over reference), derive the first-order linearized expression for the composite fractional gain from current to ADC code. Using linear error propagation at first order, compute the worst-case magnitude of the fractional composite gain error as a single decimal fraction by combining the three independent relative tolerances.\n\nAdditionally, propose a practical calibration routine to correct the composite gain in the digital domain, using a known calibration current and including offset removal. Clearly explain the steps and the mathematical rationale.\n\nExpress the final worst-case fractional composite gain error as a decimal fraction with no unit, and round your answer to four significant figures.",
            "solution": "The problem requires a two-part response: first, to compute the worst-case fractional gain error for a current sensing signal chain, and second, to propose a calibration routine to correct for this error.\n\n**Part 1: Worst-Case Fractional Gain Error Analysis**\n\nFirst, we establish the mathematical model for the signal chain. The chain consists of a shunt resistor, an amplifier, and an Analog-to-Digital Converter (ADC).\n\n1.  The voltage developed across the shunt resistor, $V_s$, is given by Ohm's law, where $I$ is the current flowing through it and $R_s$ is its resistance:\n    $$V_s = I \\cdot R_s$$\n\n2.  This voltage is then amplified by an instrumentation amplifier with gain $G_a$. The output voltage of the amplifier, $V_a$, which serves as the input to the ADC, is:\n    $$V_a = G_a \\cdot V_s = G_a R_s I$$\n\n3.  The problem states the ADC is ideal and unipolar. The digital output code of an ADC is proportional to the ratio of its input voltage to its reference voltage. For this analysis, it is most convenient to work with the normalized ADC output, $c$, which represents the input voltage as a fraction of the full-scale voltage range. The full-scale voltage is the reference voltage, $V_{\\mathrm{ref}}$.\n    $$c = \\frac{V_a}{V_{\\mathrm{ref}}}$$\n\n4.  By substituting the expression for $V_a$, we obtain the relationship between the input current $I$ and the normalized output $c$:\n    $$c = \\frac{G_a R_s I}{V_{\\mathrm{ref}}}$$\n\nThe problem asks for the \"composite fractional gain from current to ADC code\". We interpret this as the gain $K$ from the input current $I$ to the normalized output $c$.\n$$K = \\frac{c}{I} = \\frac{G_a R_s}{V_{\\mathrm{ref}}}$$\nThis composite gain $K$ is a function of the three parameters with specified tolerances: $R_s$, $G_a$, and $V_{\\mathrm{ref}}$.\n\nTo find the first-order linearized expression for the fractional gain error, $\\frac{\\Delta K}{K}$, we can use the method of logarithmic differentiation, which is equivalent to first-order error propagation for multiplicative functions. Taking the natural logarithm of the gain expression:\n$$\\ln(K) = \\ln(G_a) + \\ln(R_s) - \\ln(V_{\\mathrm{ref}})$$\n\nDifferentiating this expression gives the relationship between the differential fractional changes:\n$$\\frac{dK}{K} = \\frac{dG_a}{G_a} + \\frac{dR_s}{R_s} - \\frac{dV_{\\mathrm{ref}}}{V_{\\mathrm{ref}}}$$\n\nFor small, finite variations (errors), we can approximate the differentials $dx$ with a small change $\\Delta x$. This yields the first-order linearized expression for the fractional gain error:\n$$\\frac{\\Delta K}{K} \\approx \\frac{\\Delta R_s}{R_s} + \\frac{\\Delta G_a}{G_a} - \\frac{\\Delta V_{\\mathrm{ref}}}{V_{\\mathrm{ref}}}$$\n\nThe worst-case magnitude of the fractional gain error occurs when the individual error terms add up with the same sign to maximize the total magnitude. This is found by applying the triangle inequality to the expression above, and considering the maximum magnitude of each individual fractional error, which is given by the specified relative tolerance.\nLet the tolerances be $t_R = \\max\\left|\\frac{\\Delta R_s}{R_s}\\right|$, $t_G = \\max\\left|\\frac{\\Delta G_a}{G_a}\\right|$, and $t_V = \\max\\left|\\frac{\\Delta V_{\\mathrm{ref}}}{V_{\\mathrm{ref}}}\\right|$. The worst-case fractional gain error is the sum of these tolerances:\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = t_R + t_G + t_V$$\n\nNow, we substitute the given numerical values:\n-   Shunt tolerance, $t_{R} = 2.5 \\times 10^{-3}$\n-   Amplifier gain tolerance, $t_{G} = 8.0 \\times 10^{-4}$\n-   ADC reference tolerance, $t_{V} = 5.0 \\times 10^{-4}$\n\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = (2.5 \\times 10^{-3}) + (8.0 \\times 10^{-4}) + (5.0 \\times 10^{-4})$$\nTo perform the addition, we can express all terms with the same power of $10$:\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = (2.5 \\times 10^{-3}) + (0.8 \\times 10^{-3}) + (0.5 \\times 10^{-3})$$\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = (2.5 + 0.8 + 0.5) \\times 10^{-3} = 3.8 \\times 10^{-3}$$\n\nAs a decimal fraction, this is $0.0038$. The problem requires rounding to four significant figures, so the result is $0.003800$.\n\n**Part 2: Practical Calibration Routine**\n\nA practical calibration routine aims to computationally correct for the composite gain error and any system offset. The procedure relies on a two-point calibration method, assuming a linear system response.\n\n**Mathematical Rationale**\nThe actual relationship between the true input current, $I_{\\mathrm{true}}$, and the measured raw ADC code, $C_{\\mathrm{meas}}$, can be modeled as a linear equation:\n$$C_{\\mathrm{meas}} = K_{\\mathrm{actual}} \\cdot I_{\\mathrm{true}} + C_{\\mathrm{offset}}$$\nwhere $K_{\\mathrm{actual}}$ is the actual composite gain of the system in units of [ADC codes / Ampere] and $C_{\\mathrm{offset}}$ represents the total DC offset of the signal chain (from the amplifier and other sources) referred to the ADC input, in units of [ADC codes]. The calibration procedure is designed to find the values of $K_{\\mathrm{actual}}$ and $C_{\\mathrm{offset}}$.\n\n**Calibration Steps**\n\n1.  **Offset Measurement (Point 1):**\n    *   **Action:** Ensure the input current is zero ($I_{\\mathrm{true}} = 0$). In a power converter, this is done by ensuring the relevant phase leg is not switching and carries no load current.\n    *   **Measurement:** Measure the ADC output code. To improve precision and reduce the effects of noise, take a statistically significant number of samples (e.g., $1000$) and compute their average. Let this average value be $C_1$.\n    *   **Calculation:** With $I_{\\mathrm{true}} = 0$, the model simplifies to $C_1 = K_{\\mathrm{actual}} \\cdot 0 + C_{\\mathrm{offset}}$. This directly yields the system offset: $C_{\\mathrm{offset}} = C_1$. This value is stored as the first calibration constant.\n\n2.  **Gain Measurement (Point 2):**\n    *   **Action:** Apply a known, stable, non-zero DC calibration current, let's call it $I_{\\mathrm{cal}}$. This current must be precisely measured using a trusted, calibrated instrument (e.g., a high-accuracy source/measure unit or a precision multimeter) whose accuracy is significantly higher than the target accuracy of the system being calibrated. The value of $I_{\\mathrm{cal}}$ should ideally be in the upper half of the sensor's measurement range to maximize the signal-to-noise ratio.\n    *   **Measurement:** Measure the corresponding ADC output code. Again, average a large number of samples to obtain a stable reading, let's call it $C_2$.\n    *   **Calculation:** With the known current $I_{\\mathrm{cal}}$, the model gives $C_2 = K_{\\mathrm{actual}} \\cdot I_{\\mathrm{cal}} + C_{\\mathrm{offset}}$. We already found $C_{\\mathrm{offset}} = C_1$. Substituting this, we get $C_2 = K_{\\mathrm{actual}} \\cdot I_{\\mathrm{cal}} + C_1$. We can now solve for the actual system gain $K_{\\mathrm{actual}}$:\n        $$K_{\\mathrm{actual}} = \\frac{C_2 - C_1}{I_{\\mathrm{cal}}}$$\n        This value is stored as the second calibration constant.\n\n**Implementation in Software**\n\nOnce the calibration constants $C_{\\mathrm{offset}}$ and $K_{\\mathrm{actual}}$ are determined and stored in the non-volatile memory of the system's microcontroller or DSP, they are used to correct every subsequent measurement. For any new raw ADC reading $C_{\\mathrm{meas}}$, the true current $I_{\\mathrm{true}}$ is calculated by inverting the linear model:\n$$I_{\\mathrm{true}} = \\frac{C_{\\mathrm{meas}} - C_{\\mathrm{offset}}}{K_{\\mathrm{actual}}}$$\nThis real-time calculation provides a measurement of current that is corrected for both static gain and offset errors of the entire signal chain.",
            "answer": "$$\\boxed{0.003800}$$"
        }
    ]
}