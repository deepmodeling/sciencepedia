{
    "hands_on_practices": [
        {
            "introduction": "While shunt resistors provide a simple and cost-effective method for current sensing, their performance in high-frequency applications is often limited by parasitic inductance. This exercise delves into this critical non-ideality, exploring how the inductor's voltage response to rapid current changes, described by $v = L_{s} \\frac{di}{dt}$, introduces errors when measuring pulsed waveforms common in power electronics. By applying Fourier analysis, you will learn to quantify this dynamic error in the frequency domain and derive design constraints on shunt inductance for a given measurement accuracy .",
            "id": "3831253",
            "problem": "A current measurement in a hard-switched pulse-width modulation (PWM) stage uses a low-resistance shunt with non-negligible parasitic inductance. The sensed current is a periodic rectangular waveform $i(t)$ of amplitude $I_{p}$, duty cycle $D$, and period $T$, defined over one period by $i(t) = I_{p}$ for $0 \\le t < D T$ and $i(t) = 0$ for $D T \\le t < T$, repeating with fundamental frequency $f_{1} = 1/T$. The shunt exhibits parasitic inductance $L_{s}$ in series with its resistance such that the sensed voltage is $v_{\\text{sense}}(t) = R_{s} i(t) + L_{s} \\,\\frac{d i(t)}{d t}$. The term $L_{s} \\,\\frac{d i(t)}{d t}$ constitutes a measurement error voltage at high slew rates.\n\nAssume the front-end signal chain passes harmonics up to a highest frequency component $f_{h}$, and define the highest included harmonic index as $n_{h} = \\left\\lfloor \\frac{f_{h}}{f_{1}} \\right\\rfloor$. Starting from first principles, use $v_{L}(t) = L_{s} \\,\\frac{d i(t)}{d t}$ and the Fourier-series definition of harmonic content to derive the magnitude of the error voltage at harmonic $n$, and then obtain a closed-form expression for the maximum allowable inductance $L_{s}^{\\max}$ such that the error magnitude at $n = n_{h}$ does not exceed a specified bound $\\epsilon$.\n\nUse the following parameters: $I_{p} = 5\\,\\mathrm{A}$, $D = 0.27$, $T = 10\\,\\mu\\mathrm{s}$, $f_{h} = 1.7\\,\\mathrm{MHz}$, and $\\epsilon = 20\\,\\mathrm{mV}$. Express your final result for $L_{s}^{\\max}$ in nanohenry and round your answer to three significant figures.",
            "solution": "The inductive error voltage is governed by the inductor constitutive relation from circuit theory, which itself follows from Faraday's law of electromagnetic induction: for a lumped inductor, $v_{L}(t) = L_{s} \\,\\frac{d i(t)}{d t}$. The sensed voltage across the shunt is $v_{\\text{sense}}(t) = R_{s} i(t) + v_{L}(t)$, so the error term to be bounded is $v_{L}(t)$.\n\nWe analyze the error in the frequency domain. For a rectangular current waveform, the amplitude of the $n$-th sinusoidal harmonic component of the inductive voltage error, $|V_{L,n}|$, is given by:\n$$\n|V_{L,n}| = L_{s} \\cdot 4 f_{1} I_{p} \\left| \\sin( \\pi n D ) \\right|\n$$\nwhere $f_1=1/T$ is the fundamental frequency. We are required to bound this error magnitude at the highest included harmonic, $n = n_h$. The condition is:\n$$\n|V_{L,n_{h}}| = L_{s} \\, 4 f_{1} I_{p} \\left| \\sin( \\pi n_{h} D ) \\right| \\le \\epsilon,\n$$\nwhich yields the closed-form bound\n$$\nL_{s}^{\\max} = \\frac{\\epsilon}{4 f_{1} I_{p} \\left| \\sin( \\pi n_{h} D ) \\right| }.\n$$\n\nWe now evaluate numerically with the given parameters. First compute the fundamental and harmonic index:\n$$\nf_{1} = \\frac{1}{T} = \\frac{1}{10\\,\\mu\\mathrm{s}} = 100{,}000\\,\\mathrm{Hz},\n$$\n$$\nn_{h} = \\left\\lfloor \\frac{f_{h}}{f_{1}} \\right\\rfloor = \\left\\lfloor \\frac{1{,}700{,}000}{100{,}000} \\right\\rfloor = \\left\\lfloor 17 \\right\\rfloor = 17.\n$$\nNext, evaluate the sine factor:\n$$\n\\left| \\sin( \\pi n_{h} D ) \\right| = \\left| \\sin( \\pi \\times 17 \\times 0.27 ) \\right| = \\left| \\sin( 4.59 \\pi ) \\right| = \\left| \\sin( 0.59 \\pi ) \\right|.\n$$\nCompute $\\sin(0.59 \\pi)$:\n$$\n0.59 \\pi \\approx 1.8535396656\\,\\mathrm{rad}, \\quad \\sin(1.8535396656) \\approx 0.9603.\n$$\nNow compute $L_{s}^{\\max}$:\n$$\nL_{s}^{\\max} = \\frac{\\epsilon}{4 f_{1} I_{p} \\left| \\sin( \\pi n_{h} D ) \\right| } = \\frac{0.020\\,\\mathrm{V}}{4 \\times 100{,}000\\,\\mathrm{Hz} \\times 5\\,\\mathrm{A} \\times 0.9603}.\n$$\nThe denominator is\n$$\n4 \\times 100{,}000 \\times 5 \\times 0.9603 = 2{,}000{,}000 \\times 0.9603 \\approx 1{,}920{,}600.\n$$\nThus\n$$\nL_{s}^{\\max} \\approx \\frac{0.020}{1{,}920{,}600}\\,\\mathrm{H} \\approx 1.0416 \\times 10^{-8}\\,\\mathrm{H} = 10.416\\,\\mathrm{nH}.\n$$\nRounding to three significant figures and expressing in nanohenry as requested gives\n$$\nL_{s}^{\\max} \\approx 10.4\\,\\mathrm{nH}.\n$$",
            "answer": "$$\\boxed{10.4}$$"
        },
        {
            "introduction": "Hall-effect sensors provide the benefit of galvanic isolation, but their accuracy can be compromised by temperature variations, a key challenge in many power applications. This practice focuses on modeling and quantifying errors arising from temperature-induced drift in both the sensitivity and offset of an open-loop Hall sensor . You will develop a linear error model based on typical datasheet specifications to perform a worst-case analysis, a fundamental skill for designing robust systems that must operate reliably across wide temperature ranges.",
            "id": "3831272",
            "problem": "A three-phase inverter uses an open-loop Hall-effect sensor (no flux-nulling) to measure the phase current. The Hall-effect sensor is specified to have a nominal sensitivity at $T_0 = 25^{\\circ}\\mathrm{C}$ of $S_0 = 185\\,\\mathrm{mV/A}$ and an initial output offset at $T_0$ that is removed by a one-point offset calibration performed at $T_0$. Over temperature, the sensor exhibits a fractional sensitivity temperature coefficient $k_S = 7.0 \\times 10^{-4}\\,/\\!^\\circ\\text{C}$ and an offset drift $k_{\\mathrm{off}} = 1.5\\,\\mathrm{mV/^\\circ C}$. The ambient temperature varies within $-40^{\\circ}\\mathrm{C}$ to $125^{\\circ}\\mathrm{C}$. The current of interest lies in the interval $I \\in [5\\,\\mathrm{A},\\,30\\,\\mathrm{A}]$.\n\nStarting from first principles that relate the Hall-effect sensor output to the magnetic field induced by the conductor current and the linearized transfer characteristics of the sensor, model the sensor’s output and the estimation procedure after offset calibration at $T_0$. Derive the expression for the fractional error in the estimated current at an arbitrary temperature $T$ and current $I$ due to (i) sensitivity drift and (ii) offset drift, assuming no flux-nulling or temperature compensation beyond the single offset calibration at $T_0$. Then, determine the worst-case fractional error over the specified temperature and current ranges.\n\nFinally, the design requires accuracy within $\\pm \\epsilon$ over temperature, with $\\epsilon = 0.03$ expressed as a decimal fraction. Compute the worst-case fractional error as a single real number. Express your final result as a decimal fraction and round your answer to four significant figures.",
            "solution": "First, we establish the model for the sensor's output voltage. The output of a Hall-effect sensor, $V_{\\text{out}}$, is linearly related to the measured current $I$ and has an offset voltage. Both the sensitivity and the offset are functions of temperature $T$. The model is:\n$$V_{\\text{out}}(I, T) = S(T) \\cdot I + V_{\\text{off}}(T)$$\nwhere $S(T)$ is the sensitivity at temperature $T$ and $V_{\\text{off}}(T)$ is the output offset voltage at temperature $T$.\n\nThe problem provides linear models for the temperature dependence of sensitivity and offset, relative to a reference temperature $T_0 = 25^{\\circ}\\mathrm{C}$.\nThe sensitivity $S(T)$ is given by:\n$$S(T) = S_0 (1 + k_S (T - T_0))$$\nwhere $S_0 = 185\\,\\mathrm{mV/A}$ is the nominal sensitivity at $T_0$ and $k_S = 7.0 \\times 10^{-4}\\,/\\!^\\circ\\text{C}$ is the fractional sensitivity temperature coefficient.\n\nThe offset voltage $V_{\\text{off}}(T)$ consists of an initial offset at $T_0$, let's call it $V_{\\text{off,init}}$, and a temperature-dependent drift:\n$$V_{\\text{off}}(T) = V_{\\text{off,init}} + k_{\\mathrm{off}} (T - T_0)$$\nwhere $k_{\\mathrm{off}} = 1.5\\,\\mathrm{mV/^\\circ C}$ is the offset drift.\n\nA one-point offset calibration is performed at the reference temperature $T_0$. This involves measuring the output at zero current ($I=0$) and $T=T_0$, and subtracting this value from subsequent measurements. The calibration value, $V_{\\text{cal}}$, is:\n$$V_{\\text{cal}} = V_{\\text{out}}(0, T_0) = S(T_0) \\cdot 0 + V_{\\text{off}}(T_0) = V_{\\text{off}}(T_0)$$\nFrom the offset model, $V_{\\text{off}}(T_0) = V_{\\text{off,init}} + k_{\\mathrm{off}}(T_0 - T_0) = V_{\\text{off,init}}$. Thus, the calibration step effectively measures and removes the initial offset, $V_{\\text{cal}} = V_{\\text{off,init}}$.\n\nThe calibrated output voltage, $V_{\\text{calibrated}}$, at an arbitrary current $I$ and temperature $T$ is:\n$$V_{\\text{calibrated}}(I, T) = V_{\\text{out}}(I, T) - V_{\\text{cal}}$$\n$$V_{\\text{calibrated}}(I, T) = [S(T) \\cdot I + V_{\\text{off}}(T)] - V_{\\text{off,init}}$$\nSubstituting the expressions for $S(T)$ and $V_{\\text{off}}(T)$:\n$$V_{\\text{calibrated}}(I, T) = [S_0 (1 + k_S (T - T_0)) \\cdot I + (V_{\\text{off,init}} + k_{\\mathrm{off}} (T - T_0))] - V_{\\text{off,init}}$$\n$$V_{\\text{calibrated}}(I, T) = S_0 (1 + k_S (T - T_0)) \\cdot I + k_{\\mathrm{off}} (T - T_0)$$\nThis equation models the sensor's output after the specified calibration.\n\nThe estimation of the current, $I_{\\text{est}}$, is performed by the system assuming the nominal sensitivity $S_0$ and zero offset:\n$$I_{\\text{est}} = \\frac{V_{\\text{calibrated}}(I, T)}{S_0}$$\nSubstituting the expression for $V_{\\text{calibrated}}(I, T)$:\n$$I_{\\text{est}} = \\frac{S_0 (1 + k_S (T - T_0)) \\cdot I + k_{\\mathrm{off}} (T - T_0)}{S_0}$$\n$$I_{\\text{est}} = (1 + k_S (T - T_0)) \\cdot I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0)$$\nThe fractional error, $\\epsilon_f$, in the estimated current is defined as $\\frac{I_{\\text{est}} - I}{I}$.\n$$\\epsilon_f(I, T) = \\frac{[(1 + k_S (T - T_0)) \\cdot I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0)] - I}{I}$$\n$$\\epsilon_f(I, T) = \\frac{I + k_S (T - T_0) I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0) - I}{I}$$\n$$\\epsilon_f(I, T) = \\frac{k_S (T - T_0) I + \\frac{k_{\\mathrm{off}}}{S_0}(T - T_0)}{I}$$\nSeparating the terms, we can identify the error contributions:\n$$\\epsilon_f(I, T) = k_S(T - T_0) + \\frac{k_{\\mathrm{off}}}{S_0 I}(T - T_0)$$\nThe term $k_S(T - T_0)$ is the fractional error due to sensitivity drift, and the term $\\frac{k_{\\mathrm{off}}}{S_0 I}(T - T_0)$ is the fractional error due to offset drift.\nThis can be factored as:\n$$\\epsilon_f(I, T) = \\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)(T - T_0)$$\nTo find the worst-case fractional error, we must find the maximum absolute value of $\\epsilon_f(I, T)$ over the specified ranges: $I \\in [5\\,\\mathrm{A}, 30\\,\\mathrm{A}]$ and $T \\in [-40^{\\circ}\\mathrm{C}, 125^{\\circ}\\mathrm{C}]$.\nLet $\\Delta T = T - T_0$. Since $T_0 = 25^{\\circ}\\mathrm{C}$, the range for $\\Delta T$ is:\n$$\\Delta T \\in [(-40 - 25), (125 - 25)] \\implies \\Delta T \\in [-65^{\\circ}\\mathrm{C}, 100^{\\circ}\\mathrm{C}]$$\nThe parameters $k_S$, $k_{\\mathrm{off}}$, and $S_0$ are positive constants, and the current $I$ is also positive. Therefore, the term $\\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)$ is always positive.\nTo maximize $|\\epsilon_f(I, T)| = \\left|\\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)\\Delta T\\right| = \\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)|\\Delta T|$, we must maximize each factor.\n\n1. Maximizing $|\\Delta T|$: The range for $\\Delta T$ is $[-65, 100]$. The maximum absolute value is $|\\Delta T|_{\\max} = \\max(|-65|, |100|) = 100^{\\circ}\\mathrm{C}$, which occurs at $T_{\\max} = 125^{\\circ}\\mathrm{C}$.\n\n2. Maximizing $\\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 I}\\right)$: This term is a function of $I$. Since $\\frac{k_{\\mathrm{off}}}{S_0}$ is positive, the term is maximized when $I$ is minimized. The minimum current is $I_{\\min} = 5\\,\\mathrm{A}$.\n\nCombining these two conditions, the worst-case (maximum magnitude) error occurs at $I = 5\\,\\mathrm{A}$ and $T = 125^{\\circ}\\mathrm{C}$.\n\nThe worst-case fractional error, $\\epsilon_{f, \\text{wc}}$, is therefore:\n$$\\epsilon_{f, \\text{wc}} = \\epsilon_f(5\\,\\mathrm{A}, 125^{\\circ}\\mathrm{C}) = \\left(k_S + \\frac{k_{\\mathrm{off}}}{S_0 \\cdot (5\\,\\mathrm{A})}\\right)(125^{\\circ}\\mathrm{C} - 25^{\\circ}\\mathrm{C})$$\nPlugging in the given values:\n$$k_S = 7.0 \\times 10^{-4}\\,/\\!^\\circ\\text{C}$$\n$$k_{\\mathrm{off}} = 1.5\\,\\mathrm{mV/^\\circ C}$$\n$$S_0 = 185\\,\\mathrm{mV/A}$$\n$$\\epsilon_{f, \\text{wc}} = \\left(7.0 \\times 10^{-4} + \\frac{1.5}{185 \\cdot 5}\\right) \\cdot 100$$\n$$\\epsilon_{f, \\text{wc}} = \\left(7.0 \\times 10^{-4} + \\frac{1.5}{925}\\right) \\cdot 100$$\nWe can calculate the numerical value:\n$$\\epsilon_{f, \\text{wc}} = (0.0007 + 0.0016216216...) \\cdot 100$$\n$$\\epsilon_{f, \\text{wc}} = (0.0023216216...) \\cdot 100$$\n$$\\epsilon_{f, \\text{wc}} = 0.23216216...$$\nThe problem requires the result to be rounded to four significant figures.\n$$\\epsilon_{f, \\text{wc}} \\approx 0.2322$$\nThis worst-case error of approximately $23.22\\,\\%$ is significantly larger than the required accuracy of $\\epsilon=0.03$ or $3\\,\\%$, indicating the uncompensated sensor is not suitable for this design requirement.",
            "answer": "$$\\boxed{0.2322}$$"
        },
        {
            "introduction": "A precision measurement system is only as accurate as its constituent parts. This exercise takes a holistic, system-level view, investigating how the individual manufacturing tolerances of a shunt resistor, amplifier, and ADC reference voltage combine to create a composite gain error . By applying first-order linear error propagation, you will learn to build a system error budget and then transition from analysis to solution by designing a practical two-point calibration routine to correct for these static inaccuracies.",
            "id": "3831293",
            "problem": "A resistive shunt current sensor is used to measure the phase current of a power converter leg. The signal chain consists of a precision resistive shunt of nominal resistance $R_{s}$, followed by a low-noise instrumentation amplifier with gain $G_{a}$, and an Analog-to-Digital Converter (ADC) with a nominal reference voltage $V_{\\mathrm{ref}}$. Assume ideal linear components except for specified small relative tolerances, and ignore second-order effects such as temperature drift, self-heating, and nonlinearity. The conversion chain maps input current $I$ to ADC output codes $C$ through Ohm’s law and ideal linear transfer characteristics.\n\nGiven:\n- Shunt nominal resistance $R_{s} = 5.00 \\times 10^{-4}\\,\\Omega$ with relative tolerance $t_{R} = \\pm 2.5 \\times 10^{-3}$.\n- Amplifier nominal gain $G_{a} = 60$ with relative tolerance $t_{G} = \\pm 8.0 \\times 10^{-4}$.\n- ADC nominal reference $V_{\\mathrm{ref}} = 2.500\\,\\mathrm{V}$ with relative tolerance $t_{V} = \\pm 5.0 \\times 10^{-4}$.\n- ADC is ideal and unipolar, and the exact number of bits is not required for this calculation.\n\nStarting from fundamental laws and definitions (Ohm’s law for the shunt, linear amplification, and ideal ADC code proportionality to input voltage over reference), derive the first-order linearized expression for the composite fractional gain from current to ADC code. Using linear error propagation at first order, compute the worst-case magnitude of the fractional composite gain error as a single decimal fraction by combining the three independent relative tolerances.\n\nAdditionally, propose a practical calibration routine to correct the composite gain in the digital domain, using a known calibration current and including offset removal. Clearly explain the steps and the mathematical rationale.\n\nExpress the final worst-case fractional composite gain error as a decimal fraction with no unit, and round your answer to four significant figures.",
            "solution": "The problem requires a two-part response: first, to compute the worst-case fractional gain error for a current sensing signal chain, and second, to propose a calibration routine to correct for this error.\n\n**Part 1: Worst-Case Fractional Gain Error Analysis**\n\nFirst, we establish the mathematical model for the signal chain. The chain consists of a shunt resistor, an amplifier, and an Analog-to-Digital Converter (ADC).\n\n1.  The voltage developed across the shunt resistor, $V_s$, is given by Ohm's law, where $I$ is the current flowing through it and $R_s$ is its resistance:\n    $$V_s = I \\cdot R_s$$\n\n2.  This voltage is then amplified by an instrumentation amplifier with gain $G_a$. The output voltage of the amplifier, $V_a$, which serves as the input to the ADC, is:\n    $$V_a = G_a \\cdot V_s = G_a R_s I$$\n\n3.  The problem states the ADC is ideal and unipolar. The digital output code of an ADC is proportional to the ratio of its input voltage to its reference voltage. For this analysis, it is most convenient to work with the normalized ADC output, $c$, which represents the input voltage as a fraction of the full-scale voltage range. The full-scale voltage is the reference voltage, $V_{\\mathrm{ref}}$.\n    $$c = \\frac{V_a}{V_{\\mathrm{ref}}}$$\n\n4.  By substituting the expression for $V_a$, we obtain the relationship between the input current $I$ and the normalized output $c$:\n    $$c = \\frac{G_a R_s I}{V_{\\mathrm{ref}}}$$\n\nThe problem asks for the \"composite fractional gain from current to ADC code\". We interpret this as the gain $K$ from the input current $I$ to the normalized output $c$.\n$$K = \\frac{c}{I} = \\frac{G_a R_s}{V_{\\mathrm{ref}}}$$\nThis composite gain $K$ is a function of the three parameters with specified tolerances: $R_s$, $G_a$, and $V_{\\mathrm{ref}}$.\n\nTo find the first-order linearized expression for the fractional gain error, $\\frac{\\Delta K}{K}$, we can use the method of logarithmic differentiation, which is equivalent to first-order error propagation for multiplicative functions. Taking the natural logarithm of the gain expression:\n$$\\ln(K) = \\ln(G_a) + \\ln(R_s) - \\ln(V_{\\mathrm{ref}})$$\n\nDifferentiating this expression gives the relationship between the differential fractional changes:\n$$\\frac{dK}{K} = \\frac{dG_a}{G_a} + \\frac{dR_s}{R_s} - \\frac{dV_{\\mathrm{ref}}}{V_{\\mathrm{ref}}}$$\n\nFor small, finite variations (errors), we can approximate the differentials $dx$ with a small change $\\Delta x$. This yields the first-order linearized expression for the fractional gain error:\n$$\\frac{\\Delta K}{K} \\approx \\frac{\\Delta R_s}{R_s} + \\frac{\\Delta G_a}{G_a} - \\frac{\\Delta V_{\\mathrm{ref}}}{V_{\\mathrm{ref}}}$$\n\nThe worst-case magnitude of the fractional gain error occurs when the individual error terms add up with the same sign to maximize the total magnitude. This is found by applying the triangle inequality to the expression above, and considering the maximum magnitude of each individual fractional error, which is given by the specified relative tolerance.\nLet the tolerances be $t_R = \\max\\left|\\frac{\\Delta R_s}{R_s}\\right|$, $t_G = \\max\\left|\\frac{\\Delta G_a}{G_a}\\right|$, and $t_V = \\max\\left|\\frac{\\Delta V_{\\mathrm{ref}}}{V_{\\mathrm{ref}}}\\right|$. The worst-case fractional gain error is the sum of these tolerances:\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = t_R + t_G + t_V$$\n\nNow, we substitute the given numerical values:\n-   Shunt tolerance, $t_{R} = 2.5 \\times 10^{-3}$\n-   Amplifier gain tolerance, $t_{G} = 8.0 \\times 10^{-4}$\n-   ADC reference tolerance, $t_{V} = 5.0 \\times 10^{-4}$\n\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = (2.5 \\times 10^{-3}) + (8.0 \\times 10^{-4}) + (5.0 \\times 10^{-4})$$\nTo perform the addition, we can express all terms with the same power of $10$:\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = (2.5 \\times 10^{-3}) + (0.8 \\times 10^{-3}) + (0.5 \\times 10^{-3})$$\n$$\\left| \\frac{\\Delta K}{K} \\right|_{\\mathrm{worst}} = (2.5 + 0.8 + 0.5) \\times 10^{-3} = 3.8 \\times 10^{-3}$$\n\nAs a decimal fraction, this is $0.0038$. The problem requires rounding to four significant figures, so the result is $0.003800$.\n\n**Part 2: Practical Calibration Routine**\n\nA practical calibration routine aims to computationally correct for the composite gain error and any system offset. The procedure relies on a two-point calibration method, assuming a linear system response.\n\n**Mathematical Rationale**\nThe actual relationship between the true input current, $I_{\\mathrm{true}}$, and the measured raw ADC code, $C_{\\mathrm{meas}}$, can be modeled as a linear equation:\n$$C_{\\mathrm{meas}} = K_{\\mathrm{actual}} \\cdot I_{\\mathrm{true}} + C_{\\mathrm{offset}}$$\nwhere $K_{\\mathrm{actual}}$ is the actual composite gain of the system in units of [ADC codes / Ampere] and $C_{\\mathrm{offset}}$ represents the total DC offset of the signal chain (from the amplifier and other sources) referred to the ADC input, in units of [ADC codes]. The calibration procedure is designed to find the values of $K_{\\mathrm{actual}}$ and $C_{\\mathrm{offset}}$.\n\n**Calibration Steps**\n\n1.  **Offset Measurement (Point 1):**\n    *   **Action:** Ensure the input current is zero ($I_{\\mathrm{true}} = 0$). In a power converter, this is done by ensuring the relevant phase leg is not switching and carries no load current.\n    *   **Measurement:** Measure the ADC output code. To improve precision and reduce the effects of noise, take a statistically significant number of samples (e.g., $1000$) and compute their average. Let this average value be $C_1$.\n    *   **Calculation:** With $I_{\\mathrm{true}} = 0$, the model simplifies to $C_1 = K_{\\mathrm{actual}} \\cdot 0 + C_{\\mathrm{offset}}$. This directly yields the system offset: $C_{\\mathrm{offset}} = C_1$. This value is stored as the first calibration constant.\n\n2.  **Gain Measurement (Point 2):**\n    *   **Action:** Apply a known, stable, non-zero DC calibration current, let's call it $I_{\\mathrm{cal}}$. This current must be precisely measured using a trusted, calibrated instrument (e.g., a high-accuracy source/measure unit or a precision multimeter) whose accuracy is significantly higher than the target accuracy of the system being calibrated. The value of $I_{\\mathrm{cal}}$ should ideally be in the upper half of the sensor's measurement range to maximize the signal-to-noise ratio.\n    *   **Measurement:** Measure the corresponding ADC output code. Again, average a large number of samples to obtain a stable reading, let's call it $C_2$.\n    *   **Calculation:** With the known current $I_{\\mathrm{cal}}$, the model gives $C_2 = K_{\\mathrm{actual}} \\cdot I_{\\mathrm{cal}} + C_{\\mathrm{offset}}$. We already found $C_{\\mathrm{offset}} = C_1$. Substituting this, we get $C_2 = K_{\\mathrm{actual}} \\cdot I_{\\mathrm{cal}} + C_1$. We can now solve for the actual system gain $K_{\\mathrm{actual}}$:\n        $$K_{\\mathrm{actual}} = \\frac{C_2 - C_1}{I_{\\mathrm{cal}}}$$\n        This value is stored as the second calibration constant.\n\n**Implementation in Software**\n\nOnce the calibration constants $C_{\\mathrm{offset}}$ and $K_{\\mathrm{actual}}$ are determined and stored in the non-volatile memory of the system's microcontroller or DSP, they are used to correct every subsequent measurement. For any new raw ADC reading $C_{\\mathrm{meas}}$, the true current $I_{\\mathrm{true}}$ is calculated by inverting the linear model:\n$$I_{\\mathrm{true}} = \\frac{C_{\\mathrm{meas}} - C_{\\mathrm{offset}}}{K_{\\mathrm{actual}}}$$\nThis real-time calculation provides a measurement of current that is corrected for both static gain and offset errors of the entire signal chain.",
            "answer": "$$\\boxed{0.003800}$$"
        }
    ]
}