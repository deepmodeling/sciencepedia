{
    "hands_on_practices": [
        {
            "introduction": "在沟槽栅IGBT的设计中，一个核心的权衡是减小单元间距（cell pitch）可以降低导通电阻，但同时会增大栅极-集电极电容（米勒电容），从而增加开关损耗。这项练习将指导您建立一个总损耗模型，并用它来找到在特定应用条件下能够使总功耗最小化的最优单元间距。这个过程将让您亲身体验真实世界中功率器件设计的优化过程。",
            "id": "3839070",
            "problem": "考虑一个在硬开关条件下工作的场终止沟槽栅绝缘栅双极晶体管（IGBT）。设该器件由一系列相同的单元胞阵列构成，元胞为正方形，间距为$p$（单位：$\\mathrm{m}$）。假设以下由几何结构驱动的尺度近似关系成立，这些关系与器件物理相符，并在一阶设计中广泛使用：\n\n- 在固定的芯片面积内，元胞总数与$1/p^2$成正比。因此，任何通过对各元胞对应量求和得到的总量，其大小与$1/p^2$成正比。\n- 导通电阻的有效电阻建模为$R_{\\mathrm{eff}}(p) = R_{\\mathrm{drift}} + k_{\\mathrm{ch}}\\,p^2$，其中$R_{\\mathrm{drift}}$（单位：$\\Omega$）是恒定的漂移区贡献，而$k_{\\mathrm{ch}}$（单位：$\\Omega/\\mathrm{m}^2$）是与几何相关的常数。\n- 反向传输（栅极-集电极）电容，记为$C_{\\mathrm{rss}}(p)$（也称为米勒电容），与$1/p^2$成正比：$C_{\\mathrm{rss}}(p) = k_{\\mathrm{crss}}/p^2$，其中$k_{\\mathrm{crss}}$（单位：$\\mathrm{F}\\cdot\\mathrm{m}^2$）是与几何相关的常数。\n\n设该器件在直流母线电压$V_{\\mathrm{bus}}$（单位：$\\mathrm{V}$）下开关一个恒定的负载电流$I$（单位：$\\mathrm{A}$），占空比为$D$（无单位，使用0到1之间的小数），开关频率为$f_{\\mathrm{s}}$（单位：$\\mathrm{Hz}$）。在米勒平台期间，栅极驱动器可以提供恒定的栅极电流$I_{\\mathrm{g}}$（单位：$\\mathrm{A}$）。导通特性包括一个代表IGBT中双极压降的膝点电压$V_{\\mathrm{knee}}$（单位：$\\mathrm{V}$）。\n\n仅使用基本关系和定义，推导一个总损耗模型$P_{\\mathrm{tot}}(p)$（单位：$\\mathrm{W}$），该模型包括：\n- 在占空比为$D$、电流为$I$的条件下，由电阻分量$R_{\\mathrm{eff}}(p)$引起的导通损耗。\n- 在占空比为$D$、电流为$I$的条件下，由膝点电压$V_{\\mathrm{knee}}$引起的导通损耗。\n- 与$C_{\\mathrm{rss}}(p)$相关的米勒交叠能量引起的开关损耗，假设在导通期间集电极-发射极电压从$V_{\\mathrm{bus}}$大致摆动到一个低值，在关断期间则相反，并且米勒平台电流受$I_{\\mathrm{g}}$限制。\n\n然后，计算使$P_{\\mathrm{tot}}(p)$最小化的间距$p_{\\mathrm{opt}}$（单位：$\\mathrm{m}$）以及相应的最小总损耗$P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$（单位：$\\mathrm{W}$），针对下面的每个测试套件中的参数集。将最佳间距以$\\mathrm{m}$表示，最小总损耗以$\\mathrm{W}$表示。\n\n您可以引用的基本关系包括：\n- 电容作为电荷-电压关系$Q = C\\,V$。\n- 电容器中存储的能量$E_C = \\frac{1}{2} C V^2$。\n- 功率作为单位时间的能量$P = E/t$。\n- 电阻性导通中的功率$P_R = I^2 R$。\n- 占空比的定义，即器件在所述电流下导通的时间分数。\n\n测试套件（每个元组提供$(f_{\\mathrm{s}}, V_{\\mathrm{bus}}, I, D, I_{\\mathrm{g}}, R_{\\mathrm{drift}}, V_{\\mathrm{knee}}, k_{\\mathrm{ch}}, k_{\\mathrm{crss}})$，单位如上所述）：\n- 情况1（一般情况）：$(20000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$。\n- 情况2（高开关频率）：$(100000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$。\n- 情况3（弱栅极驱动）：$(20000.0, 600.0, 50.0, 0.5, 0.5, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$。\n- 情况4（较低负载电流）：$(20000.0, 600.0, 10.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$。\n- 情况5（低开关频率，高占空比）：$(2000.0, 600.0, 50.0, 0.9, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$。\n\n您的程序应生成一行输出，该输出包含一个由方括号括起来的逗号分隔列表（例如，$[[p_1, P_1], [p_2, P_2], \\dots]$），其中每个内部列表包含相应测试用例的最佳间距$p_{\\mathrm{opt}}$（单位：$\\mathrm{m}$）和对应的最小总损耗$P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$（单位：$\\mathrm{W}$）。",
            "solution": "用户提供的问题经评估有效。它在科学上基于功率半导体物理和电力电子学的原理，是一个适定的数学优化问题，并且所有参数都定义清晰且物理上现实。\n\n目标是推导总功率损耗$P_{\\mathrm{tot}}(p)$作为IGBT元胞间距$p$的函数表达式，并找到使该损耗最小化的最佳间距$p_{\\mathrm{opt}}$。总损耗由导通损耗和开关损耗组成。\n\n首先，我们构建导通损耗$P_{\\mathrm{cond}}$的表达式。器件在由占空比$D$决定的开关周期的一部分时间内导通电流$I$。IGBT上的通态压降是恒定膝点电压$V_{\\mathrm{knee}}$和电阻压降之和。导通期间的瞬时功耗为$P_{\\mathrm{inst, cond}} = V_{\\mathrm{on}} I = (V_{\\mathrm{knee}} + I R_{\\mathrm{eff}}(p)) I$。在一个完整的开关周期内平均，导通功率损耗为：\n$$ P_{\\mathrm{cond}}(p) = D \\cdot (V_{\\mathrm{knee}} I + I^2 R_{\\mathrm{eff}}(p)) $$\n问题给出了有效电阻的模型为$R_{\\mathrm{eff}}(p) = R_{\\mathrm{drift}} + k_{\\mathrm{ch}}p^2$。将其代入导通损耗方程可得：\n$$ P_{\\mathrm{cond}}(p) = D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}} + D I^2 k_{\\mathrm{ch}} p^2 $$\n前两项与元胞间距$p$无关，而第三项表示随$p^2$增加的导通损耗部分。\n\n接下来，我们构建开关损耗$P_{\\mathrm{sw}}$的表达式。问题指明该损耗是由于米勒交叠能量。当器件两端同时存在显著的电压和电流时，在开通和关断转换期间会耗散这种能量。该模型考虑了集电极电流处于满载值$I$而集电极-发射极电压$V_{\\mathrm{ce}}$在母线电压$V_{\\mathrm{bus}}$范围内摆动的区间。该电压摆动由恒定的栅极电流$I_{\\mathrmg}$对栅极-集电极（米勒）电容$C_{\\mathrm{rss}}(p)$充电或放电来控制。\n\n使电压摆动$V_{\\mathrmbus}$所需的米勒电容上的电荷变化量为$\\Delta Q = C_{\\mathrm{rss}}(p) V_{\\mathrmbus}$。该摆动所需的时间，即米勒平台的持续时间，为$t_{\\mathrm{v,slew}} = \\frac{\\Delta Q}{I_{\\mathrmg}} = \\frac{C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}}{I_{\\mathrmg}}$。\n假设电压线性摆动，在一次这样的转换（例如，开通）期间耗散的能量为$E_{\\mathrm{on}} = \\int p(t) dt = \\int V_{\\mathrm{ce}}(t) I dt = \\frac{1}{2} I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}$。每个开关周期耗散的总能量包括开通和关断事件。假设转换过程对称，总开关能量为$E_{\\mathrm{sw}} = E_{\\mathrmon} + E_{\\mathrmoff} = 2 \\cdot (\\frac{1}{2} I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}) = I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}$。\n代入$t_{\\mathrm{v,slew}}$的表达式：\n$$ E_{\\mathrm{sw}}(p) = I V_{\\mathrm{bus}} \\left( \\frac{C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}}{I_{\\mathrmg}} \\right) = \\frac{I V_{\\mathrm{bus}}^2 C_{\\mathrm{rss}}(p)}{I_{\\mathrmg}} $$\n平均开关功率是此能量在开关周期$T_{\\mathrms} = 1/f_{\\mathrms}$内的平均值，因此$P_{\\mathrm{sw}} = E_{\\mathrm{sw}} \\cdot f_{\\mathrms}$。使用给定的米勒电容模型$C_{\\mathrm{rss}}(p) = k_{\\mathrm{crss}}/p^2$：\n$$ P_{\\mathrm{sw}}(p) = f_{\\mathrm{s}} \\frac{I V_{\\mathrm{bus}}^2}{I_{\\mathrmg}} \\frac{k_{\\mathrm{crss}}}{p^2} $$\n\n总功率损耗$P_{\\mathrm{tot}}(p)$是导通损耗和开关损耗之和：\n$$ P_{\\mathrm{tot}}(p) = P_{\\mathrm{cond}}(p) + P_{\\mathrm{sw}}(p) = (D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}) + (D I^2 k_{\\mathrm{ch}}) p^2 + \\left( \\frac{f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{I_{\\mathrmg}} \\right) \\frac{1}{p^2} $$\n该方程的形式为$P_{\\mathrm{tot}}(p) = C_0 + C_1 p^2 + C_2 p^{-2}$，其中$C_0$、$C_1$和$C_2$是正常数，分别代表与间距无关的损耗、与间距相关的导通损耗尺度因子和开关损耗尺度因子。\n- $C_0 = D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}$\n- $C_1 = D I^2 k_{\\mathrm{ch}}$\n- $C_2 = f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}} / I_{\\mathrmg}$\n\n为了找到使$P_{\\mathrm{tot}}(p)$最小化的最佳间距$p_{\\mathrm{opt}}$，我们对$p$求导并令其为零：\n$$ \\frac{d P_{\\mathrm{tot}}}{dp} = 2 C_1 p - 2 C_2 p^{-3} = 0 $$\n$$ 2 C_1 p_{\\mathrm{opt}} = 2 C_2 p_{\\mathrm{opt}}^{-3} \\implies p_{\\mathrm{opt}}^4 = \\frac{C_2}{C_1} $$\n求解$p_{\\mathrm{opt}}$（必须为正实数）：\n$$ p_{\\mathrm{opt}} = \\left( \\frac{C_2}{C_1} \\right)^{1/4} = \\left( \\frac{f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}} / I_{\\mathrmg}}{D I^2 k_{\\mathrm{ch}}} \\right)^{1/4} = \\left( \\frac{f_{\\mathrms} V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{D I I_{\\mathrmg} k_{\\mathrmch}} \\right)^{1/4} $$\n将$p_{\\mathrm{opt}}$代回总损耗方程，可得到最小总损耗$P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$。在最优点，与间距相关的导通损耗等于开关损耗：$C_1 p_{\\mathrm{opt}}^2 = C_2 p_{\\mathrm{opt}}^{-2} = \\sqrt{C_1 C_2}$。\n因此，最小总损耗为：\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = C_0 + C_1 p_{\\mathrm{opt}}^2 + C_2 p_{\\mathrm{opt}}^{-2} = C_0 + \\sqrt{C_1 C_2} + \\sqrt{C_1 C_2} = C_0 + 2\\sqrt{C_1 C_2} $$\n代入$C_0$、$C_1$和$C_2$的表达式：\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = (D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}) + 2 \\sqrt{(D I^2 k_{\\mathrm{ch}}) \\left( \\frac{f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{I_{\\mathrmg}} \\right)} $$\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = D I(V_{\\mathrm{knee}} + I R_{\\mathrm{drift}}) + 2 I V_{\\mathrm{bus}} \\sqrt{\\frac{D I f_{\\mathrms} k_{\\mathrm{ch}} k_{\\mathrm{crss}}}{I_{\\mathrmg}}} $$\n这些推导出的$p_{\\mathrm{opt}}$和$P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$公式被用于实现程序，以处理给定的测试套件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal IGBT cell pitch and the corresponding minimum total power loss\n    for a series of test cases based on a derived loss model.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each tuple provides (f_s, V_bus, I, D, I_g, R_drift, V_knee, k_ch, k_crss)\n    test_cases = [\n        # Case 1 (general case)\n        (20000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 2 (high switching frequency)\n        (100000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 3 (weak gate driver)\n        (20000.0, 600.0, 50.0, 0.5, 0.5, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 4 (lower load current)\n        (20000.0, 600.0, 10.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 5 (low switching frequency, high duty)\n        (2000.0, 600.0, 50.0, 0.9, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_s, V_bus, I, D, I_g, R_drift, V_knee, k_ch, k_crss = case\n\n        # --- Calculate Optimal Pitch (p_opt) ---\n        # The optimal pitch p_opt is derived from d(P_tot)/dp = 0.\n        # p_opt = ( (f_s * V_bus^2 * k_crss) / (D * I * I_g * k_ch) )^(1/4)\n        p_opt_numerator = f_s * V_bus**2 * k_crss\n        p_opt_denominator = D * I * I_g * k_ch\n        p_opt = (p_opt_numerator / p_opt_denominator)**0.25\n\n        # --- Calculate Minimal Total Loss (P_tot_opt) ---\n        # The minimal total loss is P_tot(p_opt) = C0 + 2*sqrt(C1*C2), where:\n        # C0 = D*I*V_knee + D*I^2*R_drift (pitch-independent losses)\n        # C1 = D*I^2*k_ch (pitch-dependent conduction loss coefficient)\n        # C2 = f_s*I*V_bus^2*k_crss / I_g (switching loss coefficient)\n        \n        # Calculate pitch-independent loss component\n        C0 = D * I * (V_knee + I * R_drift)\n        \n        # Calculate pitch-dependent loss coefficients\n        C1 = D * I**2 * k_ch\n        C2 = (f_s * I * V_bus**2 * k_crss) / I_g\n        \n        # Calculate the minimal total loss\n        P_tot_opt = C0 + 2 * np.sqrt(C1 * C2)\n        \n        results.append([p_opt, P_tot_opt])\n\n    # Final print statement in the exact required format.\n    # The default string conversion of the list of lists matches the required output format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "设计出优良的器件后，我们必须确保其在电路中安全运行。在关断感性负载时，IGBT会同时承受高电压和高电流，这一严酷工况受其反向偏置安全工作区（RBSOA）的限制。这项练习将模拟IGBT的关断暂态过程，计算电压过冲和峰值功率，并将其与器件的极限值进行比较，从而揭示电路寄生电感和栅极驱动速度等参数如何影响开关安全性。",
            "id": "3839084",
            "problem": "在钳位感性环境中关断的场截止和沟槽栅绝缘栅双极晶体管（IGBT）受反向偏置安全工作区（RBSOA）的限制。关断期间反向偏置下的动态RBSOA由集电极-发射极电压、瞬时功耗和电流转换率的同步限制所决定。这些限制反映了器件的场截止设计（在阻断期间控制高电场分布）和沟槽栅设计（将栅极电压动态与集电极电流强耦合）。您的任务是在给定栅极驱动配置、母线电感和负载电流的情况下，计算动态RBSOA违规的裕度，并预测在关断期间是否以及何时会发生二次击穿。\n\n使用以下基本基础和建模假设：\n\n- 基本定律：\n  - 电感电压定律：$v_{L} = L \\frac{di}{dt}$。\n  - 功率：$p = v i$。\n\n- 核心器件关系和定义：\n  - 集电极电流由栅极电压通过有效跨导控制。在导通状态下，将集电极电流建模为$i_{C}(t) = \\min\\!\\left(I_{\\text{load}}, \\max\\!\\left(0, g_{m}\\left(v_{GE}(t) - V_{\\text{th}}\\right)\\right)\\right)$，其中$g_{m}$是有效跨导，$V_{\\text{th}}$是阈值电压，$I_{\\text{load}}$是关断开始时的负载电流。\n  - 栅极驱动配置是一个线性斜坡：$v_{GE}(t) = V_{GI} + S_{g}\\, t$（对于$0 \\le t \\le t_{\\text{end}}$），其中$S_{g} < 0$且$t_{\\text{end}} = \\dfrac{V_{GF} - V_{GI}}{S_{g}}$。对于$t > t_{\\text{end}}$，$v_{GE}(t) = V_{GF}$。\n  - 集电极电流从负载值开始下降的时刻$t_{\\text{start}}$由$g_{m}\\left(V_{GI} + S_{g} t_{\\text{start}} - V_{\\text{th}}\\right) = I_{\\text{load}}$定义，前提是存在这样一个$t_{\\text{start}} \\in [0, t_{\\text{end}}]$。在$t_{\\text{start}}$之前，$i_{C}(t) = I_{\\text{load}}$。\n  - 当$i_{C}(t)$开始下降时，母线杂散电感$L_{\\text{bus}}$通过$v_{L} = L_{\\text{bus}} \\left|\\frac{di_{C}}{dt}\\right|$产生集电极-发射极电压过冲。将电流下降期间的集电极-发射极电压建模为$v_{CE}(t) = V_{\\text{BUS}} + L_{\\text{bus}}\\left|\\dfrac{di_{C}}{dt}\\right|$，其中$V_{\\text{BUS}}$是直流母线电压。\n  - 瞬时功率为$p(t) = v_{CE}(t)\\, i_{C}(t)$。\n\n- 动态RBSOA违规标准：\n  - 设$V_{CES}$为反向偏置关断时的最大额定集电极-发射极阻断电压，$P_{\\text{dyn}}$为关断期间允许的瞬时动态功率限制，$\\left|\\dfrac{di}{dt}\\right|_{\\max}$为允许的最大电流转换率幅值。如果在关断期间的任何时刻，以下一个或多个条件成立，则动态RBSOA被违规：$v_{CE} > V_{CES}$，$p > P_{\\text{dyn}}$，或$\\left|\\dfrac{di}{dt}\\right| > \\left|\\dfrac{di}{dt}\\right|_{\\max}$。\n  - 将裕度定义为这些约束中允许极限与实际应力的最小比率，即为$v_{CE}$、$p$和$\\left|\\dfrac{di}{dt}\\right|$计算的三个比率中的最小值。小于1的裕度表示违规。将二次击穿的发生时间预测为任何约束被超出的最早时间；如果在线性下降期间没有发生违规，则报告预测无击穿发生。\n\n算法要求：\n\n- 实现上述关系以计算：\n  1. 电流开始减小的时刻$t_{\\text{start}}$，或确定在栅极斜坡区间内没有发生电流减小。\n  2. 基于栅极斜坡斜率和有效跨导，计算电流减小期间的$\\left|\\dfrac{di_{C}}{dt}\\right|$幅值。\n  3. 使用母线电感关系，计算电流下降期间的最大集电极-发射极电压。\n  4. 当$v_{CE}$和$i_{C}$都很高时，在电流下降开始附近的峰值瞬时功率。\n  5. 作为各约束中最小比率的违规裕度。\n  6. 预测的违规时间$t_{\\text{viol}}$，作为任何约束被超出的最早时间。如果没有发生违规，则报告$t_{\\text{viol}}$为$-1$。\n\n- 单位：\n  - 电压单位为伏特（$\\mathrm{V}$）。\n  - 电流单位为安培（$\\mathrm{A}$）。\n  - 电感单位为亨利（$\\mathrm{H}$）。\n  - 时间单位为秒（$\\mathrm{s}$）。\n  - 功率单位为瓦特（$\\mathrm{W}$）。\n  - 转换率单位为安培/秒（$\\mathrm{A/s}$）。\n  - 报告的时间以秒为单位，裕度以无单位的小数表示。\n\n测试套件：\n\n使用以下四个参数集计算裕度和预测的违规时间，每个参数集以有序元组$(V_{\\text{BUS}}, V_{CES}, I_{\\text{load}}, L_{\\text{bus}}, g_{m}, V_{\\text{th}}, V_{GI}, V_{GF}, S_{g}, P_{\\text{dyn}}, \\left|\\dfrac{di}{dt}\\right|_{\\max})$的形式给出：\n\n- 情况A（正常路径，安全）：\n  - $(600, 1200, 100, 1.0\\times 10^{-7}, 20, 5, 15, 0, -5.0\\times 10^{6}, 80000, 1.5\\times 10^{8})$。\n\n- 情况B（功率违规）：\n  - $(800, 1200, 120, 3.0\\times 10^{-7}, 20, 5, 15, 0, -2.0\\times 10^{7}, 85000, 5.0\\times 10^{8})$。\n\n- 情况C（电压违规）：\n  - $(900, 1200, 80, 1.1\\times 10^{-6}, 20, 5, 14, 0, -1.5\\times 10^{7}, 100000, 5.0\\times 10^{8})$。\n\n- 情况D（电流转换率违规）：\n  - $(650, 1200, 90, 1.5\\times 10^{-7}, 25, 4.5, 16, 0, -2.5\\times 10^{7}, 100000, 5.0\\times 10^{8})$。\n\n最终输出格式：\n\n您的程序应生成一行输出，其中包含四个情况的结果，形式为方括号括起来的逗号分隔列表，其中每个元素是$[m, t_{\\text{viol}}]$形式的双元素列表，$m$是无单位的裕度，$t_{\\text{viol}}$是预测的违规时间（以秒为单位，如果未预测到违规则为-1）。例如：$[[m_{A}, t_{\\text{viol},A}], [m_{B}, t_{\\text{viol},B}], [m_{C}, t_{\\text{viol},C}], [m_{D}, t_{\\text{viol},D}]]$。",
            "solution": "该问题是有效的，因为它在科学上基于电力电子学的原理，问题定义明确，具有清晰的模型和参数集，且其表述是客观的。所有必要信息均已提供，并且所要求的计算在给定框架内是可行的。\n\n主要目标是根据场截止和沟槽栅IGBT的反向偏置安全工作区（RBSOA）限制，评估其关断性能。这需要计算关断瞬态过程中的几个关键电气量，并将它们与器件规定的最大额定值进行比较。分析基于所提供的物理模型，按一系列计算步骤进行。\n\n首先，我们确定集电极电流开始下降的时间。IGBT最初承载全部负载电流$I_{\\text{load}}$。栅极电压$v_{GE}(t)$从初始值$V_{GI}$开始，以负斜率$S_g$线性下降。时刻$t$的栅极电压由下式给出：\n$$v_{GE}(t) = V_{GI} + S_g t$$\n集电极电流$i_C$被建模为栅极-发射极电压相对于阈值电压$V_{\\text{th}}$的过驱动量的函数，由跨导$g_m$控制：\n$$i_{C}(t) = g_{m}\\left(v_{GE}(t) - V_{\\text{th}}\\right)$$\n只要栅极驱动足以支持负载电流，电流就保持在$I_{\\text{load}}$。当栅极电压下降到器件刚好能支持$I_{\\text{load}}$的点时，电流在时刻$t_{\\text{start}}$开始下降。该时间可通过将跨导方程设为等于$I_{\\text{load}}$来求得：\n$$I_{\\text{load}} = g_{m}\\left(V_{GI} + S_g t_{\\text{start}} - V_{\\text{th}}\\right)$$\n解出$t_{\\text{start}}$得：\n$$t_{\\text{start}} = \\frac{1}{S_g} \\left( \\frac{I_{\\text{load}}}{g_m} + V_{\\text{th}} - V_{GI} \\right)$$\n该计算有效的前提是$t_{\\text{start}}$发生在栅极电压斜坡期间。斜坡在$t_{\\text{end}} = (V_{GF} - V_{GI})/S_g$结束。对于所有测试用例，$t_{\\text{start}}$均在斜坡区间$[0, t_{\\text{end}}]$内。\n\n其次，我们计算电流下降阶段（对于$t > t_{\\text{start}}$）的集电极电流转换率$\\frac{di_C}{dt}$。通过对$i_C(t)$的表达式关于时间求导：\n$$\\frac{di_C}{dt} = \\frac{d}{dt} \\left[ g_m (V_{GI} + S_g t - V_{\\text{th}}) \\right] = g_m S_g$$\n由于$S_g < 0$，转换率为负，表示电流下降。转换率的幅值是一个关键的应力参数，在下降期间是恒定的：\n$$\\left|\\frac{di_C}{dt}\\right|_{\\text{actual}} = |g_m S_g| = -g_m S_g$$\n\n第三，我们确定峰值集电极-发射极电压$v_{CE, \\text{peak}}$。在关断瞬态期间，快速变化的电流流过直流母线的杂散电感$L_{\\text{bus}}$，从而感应出电压过冲。根据所提供的模型，该电压叠加在直流母线电压$V_{\\text{BUS}}$上：\n$$v_{CE}(t) = V_{\\text{BUS}} + L_{\\text{bus}} \\left|\\frac{di_C}{dt}\\right|$$\n由于电流转换率在下降期间是恒定的，集电极-发射极电压也恒定，并在电流下降开始时（$t=t_{\\text{start}}$）达到其峰值$v_{CE, \\text{peak}}$，并在整个下降过程中保持此值。\n$$v_{CE, \\text{peak}} = V_{\\text{BUS}} + L_{\\text{bus}}(-g_m S_g)$$\n\n第四，我们求出峰值瞬时功耗$p_{\\text{peak}}$。功率由$p(t) = v_{CE}(t) i_C(t)$给出。在电流下降期间（$t > t_{\\text{start}}$），$v_{CE}(t)$恒定在其峰值$v_{CE, \\text{peak}}$，而$i_C(t)$从$I_{\\text{load}}$线性减小。因此，功耗在该区间开始时最高，即在$t = t_{\\text{start}}$时，此时电流仍（几乎）为$I_{\\text{load}}$。\n$$p_{\\text{peak}} = v_{CE, \\text{peak}} \\times I_{\\text{load}} = \\left( V_{\\text{BUS}} + L_{\\text{bus}}(-g_m S_g) \\right) I_{\\text{load}}$$\n\n第五，我们计算RBSOA违规的裕度。裕度定义为规定极限与计算出的电压、功率和电流转换率峰值应力之比的最小值。\n- 电压比：$R_v = \\dfrac{V_{CES}}{v_{CE, \\text{peak}}}$\n- 功率比：$R_p = \\dfrac{P_{\\text{dyn}}}{p_{\\text{peak}}}$\n- 转换率比：$R_{didt} = \\dfrac{|\\frac{di}{dt}|_{\\max}}{|\\frac{di_C}{dt}|_{\\text{actual}}}$\n\n总裕度$m$为：\n$$m = \\min(R_v, R_p, R_{didt})$$\n裕度$m < 1$表示至少有一个RBSOA限制被违规。\n\n最后，我们预测违规时间$t_{\\text{viol}}$。根据我们的模型，所有三个量（$v_{CE}$、$p$和$|\\frac{di_C}{dt}|$）的应力在电流下降开始时$t_{\\text{start}}$达到最大。如果发生违规，它将在此刻发生。因此，如果计算出的裕度$m$小于1，则违规时间为$t_{\\text{viol}} = t_{\\text{start}}$。如果$m \\ge 1$，则在关断瞬态期间没有发生违规，我们报告$t_{\\text{viol}} = -1$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RBSOA margin and violation time for IGBT turn-off.\n    \"\"\"\n\n    test_cases = [\n        # Case A (happy path, safe)\n        (600, 1200, 100, 1.0e-7, 20, 5, 15, 0, -5.0e6, 80000, 1.5e8),\n        # Case B (power violation)\n        (800, 1200, 120, 3.0e-7, 20, 5, 15, 0, -2.0e7, 85000, 5.0e8),\n        # Case C (voltage violation)\n        (900, 1200, 80, 1.1e-6, 20, 5, 14, 0, -1.5e7, 100000, 5.0e8),\n        # Case D (current slew violation)\n        (650, 1200, 90, 1.5e-7, 25, 4.5, 16, 0, -2.5e7, 100000, 5.0e8),\n    ]\n\n    def calculate_rbsoa_metrics(params):\n        \"\"\"\n        Calculates margin and violation time for a single parameter set.\n        \n        Args:\n            params (tuple): A tuple containing the 11 parameters defining a test case.\n            \n        Returns:\n            list: A list containing the margin and violation time, [m, t_viol].\n        \"\"\"\n        V_BUS, V_CES, I_load, L_bus, g_m, V_th, V_GI, _, S_g, P_dyn, didt_max = params\n\n        # 1. Calculate the start time of current reduction, t_start\n        # t_start = (1/S_g) * (I_load/g_m + V_th - V_GI)\n        # We assume initial V_GE is high enough, i.e., g_m * (V_GI - V_th) >= I_load.\n        # This holds true for all test cases.\n        t_start = (1.0 / S_g) * (I_load / g_m + V_th - V_GI)\n\n        # 2. Calculate the magnitude of the current slew rate\n        # |di_C/dt| = |g_m * S_g| = -g_m * S_g (since S_g < 0)\n        didt_actual = -g_m * S_g\n\n        # 3. Calculate the peak collector-emitter voltage\n        # v_CE_peak = V_BUS + L_bus * |di_C/dt|\n        v_ce_peak = V_BUS + L_bus * didt_actual\n\n        # 4. Calculate the peak instantaneous power\n        # p_peak = v_CE_peak * i_C(t_start) = v_CE_peak * I_load\n        p_peak = v_ce_peak * I_load\n\n        # 5. Compute the ratios of limits to actual stresses\n        # Avoid division by zero, although not expected in this problem.\n        ratio_v = V_CES / v_ce_peak if v_ce_peak != 0 else float('inf')\n        ratio_p = P_dyn / p_peak if p_peak != 0 else float('inf')\n        ratio_didt = didt_max / didt_actual if didt_actual != 0 else float('inf')\n        \n        # Calculate the margin as the minimum of the three ratios\n        margin = np.min([ratio_v, ratio_p, ratio_didt])\n\n        # 6. Predict the time of violation, t_viol\n        # Violation occurs if margin < 1. It happens at t_start.\n        if margin < 1.0:\n            t_viol = t_start\n        else:\n            t_viol = -1.0\n            \n        return [margin, t_viol]\n\n    results = []\n    for case in test_cases:\n        result = calculate_rbsoa_metrics(case)\n        results.append(result)\n\n    # Format the final output as a string representation of a list of lists.\n    # The map(str, results) converts each inner list like [1.23, -1.0]\n    # into a string like '[1.23, -1.0]'. Joining with commas and adding\n    # outer brackets creates the required final format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现代沟槽栅IGBT在额定电流下通常具有正的导通压降温度系数，这有利于器件并联，但也带来了潜在的热失控风险，尤其是在散热不足的情况下。这项练习要求您求解一个电热耦合模型，以判断器件温度是会稳定下来还是会无限制地上升。通过这个高级实践，您将学会分析IGBT电气特性与热管理系统之间至关重要的相互作用。",
            "id": "3839091",
            "problem": "考虑一个在恒定集电极电流下工作的场截止沟槽栅绝缘栅双极晶体管 (IGBT)。电热耦合通过第一性原理建模为乘积关系$P(T) = V_{CE}(T) \\, I$和-个线性时不变热网络，该网络的脉冲响应核$Z_{\\theta}(t)$将瞬时结温$T(t)$与过去的功率历史关联起来，如下所示：\n$$\nT(t) = T_a + \\int_{0}^{t} P(\\tau)\\, Z_{\\theta}(t - \\tau)\\, d\\tau,\n$$\n其中$T_a$是环境温度。在此问题中，$Z_{\\theta}(t)$是热网络对单位功率脉冲的脉冲响应（而非阶跃响应），单位为$\\mathrm{K}/(\\mathrm{W}\\cdot \\mathrm{s})$，因此$\\int_{0}^{\\infty} Z_{\\theta}(t)\\, dt = R_{\\theta}$等于稳态热阻，单位为$\\mathrm{K}/\\mathrm{W}$。\n\n假设 IGBT 在高注入导通下的导通特性可以用仿射形式表示：\n$$\nV_{CE}(T) = V_{\\mathrm{knee}} + r_c \\, I + \\alpha \\, (T - T_{\\mathrm{ref}}),\n$$\n其中$V_{\\mathrm{knee}}$是在$T_{\\mathrm{ref}}$下的温度参考膝点电压（单位$\\mathrm{V}$），$r_c$是等效导通斜率（单位$\\Omega$），$I$是集电极电流（单位$\\mathrm{A}$），$\\alpha$是温度系数（单位$\\mathrm{V}/\\mathrm{K}$）。对于现代场截止沟槽栅器件，在额定电流下$\\alpha$往往为正；而对于老式的穿通型平面工艺，在低电流下，由于双极输运在载流子迁移率降低的情况下占主导地位，$\\alpha$可能为轻微负值。\n\n热核由与 Cauer 型梯形网络相关的指数和参数化：\n$$\nZ_{\\theta}(t) = \\sum_{i=1}^{N} \\frac{R_i}{\\tau_i}\\, e^{-t/\\tau_i}\\, H(t),\n$$\n其中$R_i$（单位$\\mathrm{K}/\\mathrm{W}$）和$\\tau_i$（单位$\\mathrm{s}$）是非负参数，$H(t)$是亥维赛德阶跃函数。稳态热阻为$R_{\\theta} = \\sum_{i=1}^{N} R_i$。\n\n您必须在指定的冷却边界和电偏置下检测热失控风险。对于恒定电流$I$和上述线性的$V_{CE}(T)$模型，存在有限稳态温度的必要条件是：\n$$\n1 - R_{\\theta}\\, I\\, \\alpha > 0.\n$$\n如果$1 - R_{\\theta}\\, I\\, \\alpha \\le 0$，则在该模型下不存在有限的不动点，系统存在热失控风险。此外，即使满足此不等式，由于瞬态累积，动态温度$T(t)$仍可能在有限时间范围内超过最大允许结温$T_{j,\\max}$。因此，如果以下任一情况成立，则将风险标志定义为真：\n1. $1 - R_{\\theta}\\, I\\, \\alpha \\le 0$，或\n2. 通过数值计算上述卷积得到的模拟$T(t)$，在模拟时间范围内超过$T_{j,\\max}$。\n\n在数值上，使用均匀时间步长$\\Delta t$和 Volterra 积分的显式欧拉离散化：\n$$\nT[n] = T_a + \\Delta t \\sum_{k=0}^{n} Z_{\\theta}(t_n - t_k)\\, P(T[k]),\n$$\n其中$t_n = n\\, \\Delta t$且$P(T[k]) = I\\, V_{CE}(T[k])$。对于$k=n$处的瞬时项，使用显式值$P(T[n-1])$以保持因果性并避免在每个步骤中求解非线性代数循环。所有温度以$\\mathrm{K}$表示，电压以$\\mathrm{V}$表示，电流以$\\mathrm{A}$表示，时间以$\\mathrm{s}$表示，功率以$\\mathrm{W}$表示。\n\n实现一个程序，为下面的每个测试用例，根据上述规则输出一个指示热失控风险的布尔值。最终输出必须是单行文本，将所有测试用例的结果聚合为一个逗号分隔的 Python 列表，例如$[x_1,x_2,x_3,x_4]$，其中每个$x_i$为$True$或$False$。\n\n测试套件：\n- 案例 A (场截止沟槽栅，良好冷却，预期稳定)：$T_a = 298\\,\\mathrm{K}$，$T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$，$I = 50\\,\\mathrm{A}$，$V_{\\mathrm{knee}} = 1.4\\,\\mathrm{V}$，$r_c = 0.005\\,\\Omega$，$\\alpha = 0.0025\\,\\mathrm{V}/\\mathrm{K}$，$N = 3$，$(R_1,R_2,R_3) = (0.15, 0.15, 0.10)\\,\\mathrm{K}/\\mathrm{W}$，$(\\tau_1,\\tau_2,\\tau_3) = (0.1, 1.0, 5.0)\\,\\mathrm{s}$，$T_{j,\\max} = 423\\,\\mathrm{K}$，模拟时间范围$T_{\\mathrm{end}} = 10.0\\,\\mathrm{s}$，时间步长$\\Delta t = 0.005\\,\\mathrm{s}$。\n- 案例 B (场截止沟槽栅，冷却不良，预期因不动点准则和瞬态穿越而失控)：$T_a = 300\\,\\mathrm{K}$，$T_{\\mathrm{ref}} = 300\\,\\mathrm{K}$，$I = 300\\,\\mathrm{A}$，$V_{\\mathrm{knee}} = 1.4\\,\\mathrm{V}$，$r_c = 0.005\\,\\Omega$，$\\alpha = 0.0030\\,\\mathrm{V}/\\mathrm{K}$，$N = 3$，$(R_1,R_2,R_3) = (0.50, 0.50, 0.50)\\,\\mathrm{K}/\\mathrm{W}$，$(\\tau_1,\\tau_2,\\tau_3) = (0.2, 2.0, 20.0)\\,\\mathrm{s}$，$T_{j,\\max} = 423\\,\\mathrm{K}$，$T_{\\mathrm{end}} = 4.0\\,\\mathrm{s}$，$\\Delta t = 0.002\\,\\mathrm{s}$。\n- 案例 C (穿通型平面，低电流下负温度系数，预期稳定)：$T_a = 298\\,\\mathrm{K}$，$T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$，$I = 15\\,\\mathrm{A}$，$V_{\\mathrm{knee}} = 1.6\\,\\mathrm{V}$，$r_c = 0.004\\,\\Omega$，$\\alpha = -0.0015\\,\\mathrm{V}/\\mathrm{K}$，$N = 3$，$(R_1,R_2,R_3) = (0.10, 0.10, 0.10)\\,\\mathrm{K}/\\mathrm{W}$，$(\\tau_1,\\tau_2,\\tau_3) = (0.05, 0.50, 5.00)\\,\\mathrm{s}$，$T_{j,\\max} = 423\\,\\mathrm{K}$，$T_{\\mathrm{end}} = 8.0\\,\\mathrm{s}$，$\\Delta t = 0.005\\,\\mathrm{s}$。\n- 案例 D (接近临界的场截止沟槽栅，在稳定性阈值处的边界条件，声明风险)：$T_a = 310\\,\\mathrm{K}$，$T_{\\mathrm{ref}} = 310\\,\\mathrm{K}$，$I = 500\\,\\mathrm{A}$，$V_{\\mathrm{knee}} = 1.3\\,\\mathrm{V}$，$r_c = 0.0045\\,\\Omega$，$\\alpha = 0.0025\\,\\mathrm{V}/\\mathrm{K}$，$N = 3$，$(R_1,R_2,R_3) = (0.30, 0.25, 0.25)\\,\\mathrm{K}/\\mathrm{W}$，$(\\tau_1,\\tau_2,\\tau_3) = (0.10, 1.00, 10.00)\\,\\mathrm{s}$，$T_{j,\\max} = 423\\,\\mathrm{K}$，$T_{\\mathrm{end}} = 3.0\\,\\mathrm{s}$，$\\Delta t = 0.002\\,\\mathrm{s}$。\n\n您的程序必须：\n1. 实现上述模型。\n2. 对每个案例，计算$R_{\\theta} = \\sum_{i=1}^{N} R_i$并检查不动点准则$1 - R_{\\theta}\\, I\\, \\alpha \\le 0$。\n3.如果不动点准则未立即指示风险，则运行显式卷积，直到$T_{\\mathrm{end}}$或直到$T(t)$超过$T_{j,\\max}$，以先发生者为准。\n4. 每个案例返回一个布尔值：如果检测到风险，则为$True$，否则为$False$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，$[True,False,False,True]$）。不应打印任何其他文本。所有计算必须遵守指定的单位和$Z_{\\theta}(t)$的脉冲响应解释。",
            "solution": "用户提供的问题被评估为有效。它在科学上基于功率半导体电热学原理，问题陈述清晰，具有一套完整的参数和明确的目标，并使用精确、客观的语言进行表述。所描述的模型和方法是电力电子工程领域的标准表示。解决方案如下。\n\n该问题要求评估场截止沟槽栅绝缘栅双极晶体管 (IGBT) 在恒流工作下的热失控风险。风险由两个条件确定：(1) 违反稳态稳定性准则，以及 (2) 在瞬态仿真期间超过最大结温$T_{j,\\max}$。\n\n电热行为由一个耦合方程组描述。瞬时功耗$P(T)$由恒定的集电极电流$I$与温度相关的集电极-发射极电压$V_{CE}(T)$的乘积给出：\n$$\nP(T) = V_{CE}(T) \\, I\n$$\n集电极-发射极电压被建模为结温$T$的仿射函数：\n$$\nV_{CE}(T) = V_{\\mathrm{knee}} + r_c \\, I + \\alpha \\, (T - T_{\\mathrm{ref}})\n$$\n其中$V_{\\mathrm{knee}}$是参考膝点电压，$r_c$是电阻斜率，$\\alpha$是温度系数，$T_{\\mathrm{ref}}$是参考温度。\n\n结温$T(t)$通过第一类 Volterra 积分方程与功耗历史$P(\\tau)$相关联，该方程表示功率与热系统脉冲响应$Z_{\\theta}(t)$的卷积：\n$$\nT(t) = T_a + \\int_{0}^{t} P(T(\\tau))\\, Z_{\\theta}(t - \\tau)\\, d\\tau\n$$\n其中$T_a$是环境温度。热脉冲响应核$Z_{\\theta}(t)$由指数和表示，这是 Cauer 热网络模型的特征：\n$$\nZ_{\\theta}(t) = \\sum_{i=1}^{N} \\frac{R_i}{\\tau_i}\\, e^{-t/\\tau_i}\\, H(t)\n$$\n这里，$R_i$和$\\tau_i$是网络的热阻和时间常数，$H(t)$是亥维赛德阶跃函数。\n\n**1. 稳态稳定性准则 (风险准则 1)**\n\n首先检查是否存在稳定、有限的稳态结温$T_{ss}$。在稳态 ($t \\to \\infty$)下，温度和功率是恒定的，分别为$T_{ss}$和$P_{ss} = P(T_{ss})$。卷积分简化为：\n$$\nT_{ss} = T_a + P_{ss} \\int_{0}^{\\infty} Z_{\\theta}(u)\\, du\n$$\n脉冲响应在所有时间上的积分是总稳态热阻$R_{\\theta}$：\n$$\nR_{\\theta} = \\int_{0}^{\\infty} Z_{\\theta}(t)\\, dt = \\sum_{i=1}^{N} \\int_{0}^{\\infty} \\frac{R_i}{\\tau_i}\\, e^{-t/\\tau_i}\\, dt = \\sum_{i=1}^{N} R_i\n$$\n将$P_{ss}$和$R_{\\theta}$代入温度方程得到：\n$$\nT_{ss} = T_a + R_{\\theta} \\, I \\, V_{CE}(T_{ss})\n$$\n代入$V_{CE}(T_{ss})$的表达式：\n$$\nT_{ss} = T_a + R_{\\theta} \\, I \\, [V_{\\mathrm{knee}} + r_c \\, I + \\alpha \\, (T_{ss} - T_{\\mathrm{ref}})]\n$$\n这是一个关于$T_{ss}$的线性方程。为了解出$T_{ss}$，我们重新整理各项：\n$$\nT_{ss} - R_{\\theta} \\, I \\, \\alpha \\, T_{ss} = T_a + R_{\\theta} \\, I \\, (V_{\\mathrm{knee}} + r_c \\, I - \\alpha \\, T_{\\mathrm{ref}})\n$$\n$$\nT_{ss} (1 - R_{\\theta} \\, I \\, \\alpha) = T_a + R_{\\theta} \\, I \\, (V_{\\mathrm{knee}} + r_c \\, I - \\alpha \\, T_{\\mathrm{ref}})\n$$\n一个对应于稳定系统的有限、非负$T_{ss}$解要求解的分母为正。当项$R_{\\theta} \\, I \\, \\alpha$（表示电热系统的环路增益）接近或超过$1$时，会建立一个正反馈回路。因此，稳定性要求：\n$$\n1 - R_{\\theta} \\, I \\, \\alpha > 0\n$$\n如果不满足此条件，即$1 - R_{\\theta} \\, I \\, \\alpha \\le 0$，则系统不稳定，热失控是必然的。这构成了第一个风险准则。对于每个测试用例，我们首先计算$R_{\\theta} = \\sum_{i=1}^{N} R_i$并检查此不等式。如果它指示风险，则标志设置为真，并且该案例不需要进一步分析。\n\n**2. 瞬态温度仿真 (风险准则 2)**\n\n如果稳态准则预测系统稳定，我们仍必须检查瞬态过温。结温在达到其稳态值之前可能会暂时超过$T_{j,\\max}$。这需要对 Volterra 积分方程进行数值求解。问题指定了显式欧拉离散化：\n$$\nT[n] = T_a + \\Delta t \\sum_{k=0}^{n} Z_{\\theta}(t_n - t_k)\\, P(T[k])\n$$\n其中$t_n = n \\Delta t$。为了保持一个显式的、因果的更新方案，问题指出对于$k=n$的项，功率$P(T[n])$应由$P(T[n-1])$近似。这导致了以下温度$T[n] \\equiv T(t_n)$的离散时间更新规则：\n$$\nT[n] = T_a + \\Delta t \\left( \\sum_{k=0}^{n-1} Z_{\\theta}((n-k)\\Delta t) P(T[k]) \\right) + \\Delta t Z_{\\theta}(0) P(T[n-1])\n$$\n仿真以时间$t=0$时的物理正确条件$T[0] = T_a$进行初始化。随后的时间步$T[1], T[2], \\dots, T[N_{\\mathrm{steps}}]$的温度是迭代计算的，其中$N_{\\mathrm{steps}} = \\lfloor T_{\\mathrm{end}} / \\Delta t \\rfloor$。$Z_{\\theta}(0)$项计算为$Z_{\\theta}(0) = \\sum_{i=1}^{N} \\frac{R_i}{\\tau_i}$。\n\n瞬态分析的算法如下：\n初始化一个大小为$N_{\\mathrm{steps}}+1$的温度数组$T$，并设$T[0]=T_a$。\n对于$n$从$1$到$N_{\\mathrm{steps}}$迭代：\na. 计算过去功率值的卷积和：$S_n = \\sum_{k=0}^{n-1} Z_{\\theta}((n-k)\\Delta t) P(T[k])$。\nb. 计算上一步的功率，$P_{n-1} = P(T[n-1])$。\nc. 计算$k=n$的项：$Z_{\\theta}(0) P_{n-1}$。\nd. 更新温度：$T[n] = T_a + \\Delta t (S_n + Z_{\\theta}(0) P_{n-1})$。\ne. 检查温度违规：如果$T[n] > T_{j,\\max}$，则风险标志设置为真，并终止当前案例的仿真。\n\n如果仿真在整个时间范围$T_{\\mathrm{end}}$内完成而$T[n]$未超过$T_{j,\\max}$，则认为该器件在该时段内瞬态稳定，风险标志为假。\n\n每个案例的最终布尔结果是稳态和瞬态检查结果的逻辑或。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the IGBT thermal runaway problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case A: field-stop trench-gate, good cooling, expected stable\n        {\n            \"Ta\": 298.0, \"T_ref\": 298.0, \"I\": 50.0, \"V_knee\": 1.4, \"r_c\": 0.005,\n            \"alpha\": 0.0025, \"N\": 3, \"R_vals\": np.array([0.15, 0.15, 0.10]),\n            \"tau_vals\": np.array([0.1, 1.0, 5.0]), \"Tj_max\": 423.0,\n            \"t_end\": 10.0, \"dt\": 0.005\n        },\n        # Case B: field-stop trench-gate, poor cooling, expected runaway\n        {\n            \"Ta\": 300.0, \"T_ref\": 300.0, \"I\": 300.0, \"V_knee\": 1.4, \"r_c\": 0.005,\n            \"alpha\": 0.0030, \"N\": 3, \"R_vals\": np.array([0.50, 0.50, 0.50]),\n            \"tau_vals\": np.array([0.2, 2.0, 20.0]), \"Tj_max\": 423.0,\n            \"t_end\": 4.0, \"dt\": 0.002\n        },\n        # Case C: punch-through planar, negative tempco, expected stable\n        {\n            \"Ta\": 298.0, \"T_ref\": 298.0, \"I\": 15.0, \"V_knee\": 1.6, \"r_c\": 0.004,\n            \"alpha\": -0.0015, \"N\": 3, \"R_vals\": np.array([0.10, 0.10, 0.10]),\n            \"tau_vals\": np.array([0.05, 0.50, 5.00]), \"Tj_max\": 423.0,\n            \"t_end\": 8.0, \"dt\": 0.005\n        },\n        # Case D: near-critical, boundary condition, declare risk\n        {\n            \"Ta\": 310.0, \"T_ref\": 310.0, \"I\": 500.0, \"V_knee\": 1.3, \"r_c\": 0.0045,\n            \"alpha\": 0.0025, \"N\": 3, \"R_vals\": np.array([0.30, 0.25, 0.25]),\n            \"tau_vals\": np.array([0.10, 1.00, 10.00]), \"Tj_max\": 423.0,\n            \"t_end\": 3.0, \"dt\": 0.002\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        risk = check_runaway_risk(case)\n        results.append(risk)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef check_runaway_risk(params):\n    \"\"\"\n    Checks for thermal runaway risk for a single IGBT case.\n\n    Returns:\n        bool: True if runaway risk is detected, False otherwise.\n    \"\"\"\n    Ta = params[\"Ta\"]\n    T_ref = params[\"T_ref\"]\n    I = params[\"I\"]\n    V_knee = params[\"V_knee\"]\n    r_c = params[\"r_c\"]\n    alpha = params[\"alpha\"]\n    R_vals = params[\"R_vals\"]\n    tau_vals = params[\"tau_vals\"]\n    Tj_max = params[\"Tj_max\"]\n    t_end = params[\"t_end\"]\n    dt = params[\"dt\"]\n\n    # Helper function for power calculation\n    def calculate_power(T, I, V_knee, r_c, alpha, T_ref):\n        V_ce = V_knee + r_c * I + alpha * (T - T_ref)\n        return V_ce * I\n\n    # Helper function for thermal impulse response Z_theta(t)\n    # This is not vectorized for multiple t values to keep the main loop logic simple\n    def calculate_Z_theta(t, R, tau):\n        # H(t) is implicit as we only evaluate for t >= 0\n        return np.sum((R / tau) * np.exp(-t / tau))\n\n    # --- Criterion 1: Steady-State Stability Check ---\n    R_theta = np.sum(R_vals)\n    stability_factor = 1 - R_theta * I * alpha\n    if stability_factor <= 0:\n        return True\n\n    # --- Criterion 2: Transient Simulation Check ---\n    num_steps = int(round(t_end / dt))\n    T = np.zeros(num_steps + 1)\n    T[0] = Ta\n    \n    # Pre-calculated power history array for efficiency\n    P_hist = np.zeros(num_steps + 1)\n    P_hist[0] = calculate_power(T[0], I, V_knee, r_c, alpha, T_ref)\n    \n    # Pre-calculate Z_theta(0)\n    Z0 = calculate_Z_theta(0, R_vals, tau_vals)\n\n    for n in range(1, num_steps + 1):\n        # Implementation of the discrete convolution as specified in the problem:\n        # T[n] = Ta + dt * [ sum_{k=0 to n-1} Z((n-k)dt)P(T[k]) + Z(0)P(T[n-1]) ]\n        \n        # Calculate convolution sum over past states\n        conv_sum_main = 0.0\n        for k in range(n):  # k iterates from 0 to n-1\n            time_diff = (n - k) * dt\n            z_val = calculate_Z_theta(time_diff, R_vals, tau_vals)\n            # P_hist[k] was computed in a previous step or at initialization\n            conv_sum_main += z_val * P_hist[k]\n        \n        # Power at previous timestep for the k=n term\n        # P_hist[n-1] was computed in the (n-1)th iteration\n        p_n_minus_1 = P_hist[n-1]\n        term_k_equals_n = Z0 * p_n_minus_1\n        \n        # Combine terms to find T[n]\n        T[n] = Ta + dt * (conv_sum_main + term_k_equals_n)\n        \n        # Store power at current step for next iteration's history\n        P_hist[n] = calculate_power(T[n], I, V_knee, r_c, alpha, T_ref)\n\n        if T[n] > Tj_max:\n            return True\n\n    return False\n\n# Execute the solver\nsolve()\n```"
        }
    ]
}