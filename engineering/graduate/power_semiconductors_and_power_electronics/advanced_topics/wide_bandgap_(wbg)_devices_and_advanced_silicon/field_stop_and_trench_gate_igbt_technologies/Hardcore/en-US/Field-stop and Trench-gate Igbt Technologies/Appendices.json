{
    "hands_on_practices": [
        {
            "introduction": "The defining feature of a Field-Stop (FS) IGBT is its ability to support high voltages with a thinner drift region, which directly translates to lower conduction losses. This performance advantage stems from careful engineering of the internal electric field profile. In this practice, you will use Poisson's equation to derive the electric field distribution within a two-layer FS structure, quantitatively demonstrating how the highly-doped field-stop layer shapes the field for optimal blocking performance .",
            "id": "3839069",
            "problem": "An Insulated Gate Bipolar Transistor (IGBT) in the off-state at high collector–emitter voltage has its vertical blocking capability set by the depleted charge in the lightly doped drift region. Consider a one-dimensional, planar structure composed of two fully depleted, $n$-type layers between a $p$-type base and the collector: a drift layer of thickness $t_{1}$ and donor density $N_{1}$, followed by a field-stop layer of thickness $t_{2}$ and donor density $N_{2}$, with $N_{2} > N_{1}$. The total depleted thickness is $T = t_{1} + t_{2}$. Assume complete depletion of both layers under a high applied collector–emitter voltage $V_{CE}$, negligible space charge outside these layers, and a constant silicon permittivity $\\varepsilon_{s}$.\n\nStarting from Gauss’s law in differential form (Poisson’s equation) and charge neutrality in the depleted $n$-type region, derive the one-dimensional electric field $E(x)$ within the two-layer structure, where $x$ is measured from the metallurgical $p$-base/$n$-drift interface into the $n$ region. Use boundary conditions consistent with reverse bias that ensure the electric field vanishes at the far edge of the depletion region. From your derived $E(x)$:\n- Identify the location $x_{\\max}$ of the maximum electric field and its magnitude $E_{\\max}$ for the two-layer structure.\n- Define an equivalent uniform drift region of thickness $T$ and constant donor density $N_{u}$ that blocks the same voltage $V_{CE}$ under complete depletion. Using first principles, determine the peak field $E_{\\max,u}$ for this uniform case.\n\nFinally, form the ratio $R = E_{\\max} / E_{\\max,u}$ in closed form in terms of $N_{1}$, $N_{2}$, $t_{1}$, and $t_{2}$, and report $x_{\\max}$ measured from the $p$-base/$n$ interface. Express the final answer as a row matrix containing $R$ and $x_{\\max}$. No numerical evaluation is required; provide exact symbolic expressions. Express $x_{\\max}$ in meters.",
            "solution": "The problem requires the analysis of the one-dimensional electric field distribution in a two-layer, fully depleted $n$-type region of an Insulated Gate Bipolar Transistor (IGBT). This analysis is based on Poisson's equation, followed by a comparison with an equivalent uniformly doped structure.\n\nThe foundation of this analysis is Poisson's equation for a semiconductor, which relates the spatial derivative of the electric field $E$ to the local space-charge density $\\rho(x)$:\n$$ \\frac{dE}{dx} = \\frac{\\rho(x)}{\\varepsilon_s} $$\nwhere $\\varepsilon_s$ is the permittivity of silicon. In the depletion approximation for an $n$-type semiconductor, the space charge is due to the ionized donor atoms. Thus, $\\rho(x) = q N_D(x)$, where $q$ is the elementary charge and $N_D(x)$ is the donor concentration profile.\n\nThe structure is defined by two layers:\n1.  A drift layer for $0 \\le x \\le t_1$ with donor density $N_1$.\n2.  A field-stop layer for $t_1 < x \\le T$ with donor density $N_2$, where $T = t_1 + t_2$.\n\nThe corresponding space-charge densities are $\\rho_1 = qN_1$ in the first layer and $\\rho_2 = qN_2$ in the second. The problem specifies that the entire two-layer region is depleted, and the boundary condition at the far end of the depletion region (at the collector side) is that the electric field vanishes. This means $E(T) = E(t_1+t_2) = 0$. The electric field is directed from the higher potential collector towards the lower potential $p$-base, i.e., in the negative $x$ direction.\n\nWe will first derive the electric field profile $E(x)$ by integrating Poisson's equation, starting from the boundary at $x=T$.\n\nFor the field-stop layer ($t_1 < x \\le T$):\n$$ \\frac{dE_2}{dx} = \\frac{qN_2}{\\varepsilon_s} $$\nIntegrating from an arbitrary position $x$ in this layer to the boundary $T$:\n$$ \\int_{E_2(x)}^{E_2(T)} dE = \\int_{x}^{T} \\frac{qN_2}{\\varepsilon_s} dx' $$\n$$ E_2(T) - E_2(x) = \\frac{qN_2}{\\varepsilon_s} (T-x) $$\nSince $E_2(T)=0$, the electric field in the second layer is:\n$$ E_2(x) = -\\frac{qN_2}{\\varepsilon_s} (T-x) = -\\frac{qN_2}{\\varepsilon_s} (t_1 + t_2 - x) $$\n\nThe electric field must be continuous at the interface between the two layers, at $x=t_1$. We find the field at this interface by evaluating $E_2(x)$ at $x=t_1$:\n$$ E_1(t_1) = E_2(t_1) = -\\frac{qN_2}{\\varepsilon_s} (t_1 + t_2 - t_1) = -\\frac{qN_2 t_2}{\\varepsilon_s} $$\n\nNow, for the drift layer ($0 \\le x \\le t_1$):\n$$ \\frac{dE_1}{dx} = \\frac{qN_1}{\\varepsilon_s} $$\nIntegrating from an arbitrary position $x$ in this layer to the interface at $t_1$:\n$$ \\int_{E_1(x)}^{E_1(t_1)} dE = \\int_{x}^{t_1} \\frac{qN_1}{\\varepsilon_s} dx' $$\n$$ E_1(t_1) - E_1(x) = \\frac{qN_1}{\\varepsilon_s} (t_1 - x) $$\nSolving for $E_1(x)$ and substituting the expression for $E_1(t_1)$:\n$$ E_1(x) = E_1(t_1) - \\frac{qN_1}{\\varepsilon_s} (t_1 - x) = -\\frac{qN_2 t_2}{\\varepsilon_s} - \\frac{qN_1}{\\varepsilon_s} (t_1 - x) $$\n\nThe magnitude of the electric field, $|E(x)|$, is largest where the field itself is most negative. The slopes of both $|E_1(x)|$ and $|E_2(x)|$ with respect to $x$ are negative. The function $|E(x)|$ is monotonically decreasing from $x=0$ to $x=T$. Therefore, the maximum electric field magnitude occurs at the $p$-base/$n$-drift metallurgical junction, i.e., at $x=0$.\nThe location of the maximum electric field is $x_{\\max} = 0$, which is $0$ meters from the $p$-base/$n$ interface.\n\nThe magnitude of this maximum field, $E_{\\max}$, is $|E_1(0)|$:\n$$ E_{\\max} = \\left| -\\frac{qN_2 t_2}{\\varepsilon_s} - \\frac{qN_1}{\\varepsilon_s} (t_1 - 0) \\right| = \\frac{q}{\\varepsilon_s} (N_1 t_1 + N_2 t_2) $$\n\nNext, we define an equivalent uniform drift region of total thickness $T = t_1 + t_2$ and constant donor density $N_u$. This structure must block the same total voltage $V_{CE}$ as the two-layer structure. The voltage blocked is the integral of the electric field magnitude across the depletion region.\n\nFirst, we calculate $V_{CE}$ for the two-layer structure:\n$$ V_{CE} = \\int_{0}^{T} |E(x)| dx = \\int_{0}^{t_1} |E_1(x)| dx + \\int_{t_1}^{T} |E_2(x)| dx $$\n$$ V_{CE} = \\int_{0}^{t_1} \\left( \\frac{qN_2 t_2}{\\varepsilon_s} + \\frac{qN_1(t_1 - x)}{\\varepsilon_s} \\right) dx + \\int_{t_1}^{t_1+t_2} \\frac{qN_2(t_1 + t_2 - x)}{\\varepsilon_s} dx $$\n$$ V_{CE} = \\frac{q}{\\varepsilon_s} \\left[ N_2 t_2 x + N_1 t_1 x - \\frac{N_1 x^2}{2} \\right]_{0}^{t_1} + \\frac{qN_2}{\\varepsilon_s} \\left[ (t_1+t_2)x - \\frac{x^2}{2} \\right]_{t_1}^{t_1+t_2} $$\nEvaluating the first integral:\n$$ \\frac{q}{\\varepsilon_s} \\left( N_2 t_1 t_2 + N_1 t_1^2 - \\frac{N_1 t_1^2}{2} \\right) = \\frac{q}{\\varepsilon_s} \\left( \\frac{N_1 t_1^2}{2} + N_2 t_1 t_2 \\right) $$\nEvaluating the second integral:\n$$ \\frac{qN_2}{\\varepsilon_s} \\left( (t_1+t_2)^2 - \\frac{(t_1+t_2)^2}{2} - (t_1+t_2)t_1 + \\frac{t_1^2}{2} \\right) = \\frac{qN_2}{\\varepsilon_s} \\left( \\frac{(t_1+t_2)^2}{2} - t_1^2 - t_1 t_2 + \\frac{t_1^2}{2} \\right) = \\frac{qN_2 t_2^2}{2\\varepsilon_s} $$\nThe total voltage is:\n$$ V_{CE} = \\frac{q}{2\\varepsilon_s} (N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2) $$\n\nFor a uniform drift region of thickness $T$ and doping $N_u$, the electric field profile is a simple triangle, with $|E_u(x)| = \\frac{qN_u}{\\varepsilon_s}(T-x)$. The peak field is $E_{\\max,u} = |E_u(0)| = \\frac{qN_u T}{\\varepsilon_s}$. The voltage blocked is the area of this triangle:\n$$ V_{CE,u} = \\frac{1}{2} \\times \\text{base} \\times \\text{height} = \\frac{1}{2} T E_{\\max,u} $$\nThe problem requires $V_{CE,u} = V_{CE}$. Therefore, we can find the peak field of the equivalent uniform structure, $E_{\\max,u}$, directly from $V_{CE}$:\n$$ E_{\\max,u} = \\frac{2 V_{CE}}{T} = \\frac{2 V_{CE}}{t_1+t_2} $$\nSubstituting our expression for $V_{CE}$:\n$$ E_{\\max,u} = \\frac{2}{t_1+t_2} \\left( \\frac{q}{2\\varepsilon_s} (N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2) \\right) = \\frac{q}{\\varepsilon_s} \\frac{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2}{t_1+t_2} $$\n\nFinally, we compute the ratio $R = E_{\\max} / E_{\\max,u}$:\n$$ R = \\frac{\\frac{q}{\\varepsilon_s} (N_1 t_1 + N_2 t_2)}{\\frac{q}{\\varepsilon_s} \\frac{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2}{t_1+t_2}} $$\n$$ R = \\frac{(N_1 t_1 + N_2 t_2)(t_1+t_2)}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2} $$\nThis expression can be expanded for clarity, though it is not strictly necessary:\n$$ R = \\frac{N_1 t_1^2 + N_1 t_1 t_2 + N_2 t_1 t_2 + N_2 t_2^2}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2} = \\frac{N_1 t_1^2 + (N_1+N_2) t_1 t_2 + N_2 t_2^2}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2} $$\n\nThe required results are the ratio $R$ and the location of the maximum field, $x_{\\max}$.\nThe final answers are:\n- $R = \\frac{(N_1 t_1 + N_2 t_2)(t_1+t_2)}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2}$\n- $x_{\\max} = 0$\n\nThese are presented as a row matrix.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{(N_{1} t_{1} + N_{2} t_{2})(t_{1} + t_{2})}{N_{1} t_{1}^{2} + 2 N_{2} t_{1} t_{2} + N_{2} t_{2}^{2}} & 0 \\end{pmatrix} } $$"
        },
        {
            "introduction": "Building a high-performance trench-gate IGBT involves navigating crucial design trade-offs. Reducing the cell pitch, or the spacing between individual transistor cells, lowers the on-state resistance but simultaneously increases parasitic capacitances, which worsens switching losses. This exercise guides you through modeling this fundamental trade-off and using calculus to determine the optimal cell pitch that minimizes total power dissipation in a hard-switching application .",
            "id": "3839070",
            "problem": "Consider a field-stop, trench-gate Insulated Gate Bipolar Transistor (IGBT) operating in hard-switching conditions. Let the device be laid out as an array of identical unit cells with square cell pitch $p$ (in $\\mathrm{m}$). Assume the following geometry-driven scaling approximations, which are consistent with device physics and widely used in first-order design:\n\n- The total number of cells per fixed die area is proportional to $1/p^2$, so any per-cell quantity that sums over cells scales proportional to $1/p^2$.\n- The effective channel contribution to the on-state resistance scales inversely with total conducting perimeter, hence proportional to $p^2$. Model the resistive part of the conduction as an effective resistance $R_{\\mathrm{eff}}(p) = R_{\\mathrm{drift}} + k_{\\mathrm{ch}}\\,p^2$, where $R_{\\mathrm{drift}}$ (in $\\Omega$) is a constant drift-region contribution and $k_{\\mathrm{ch}}$ (in $\\Omega/\\mathrm{m}^2$) is a geometry-dependent constant.\n- The reverse transfer (gate-to-collector) capacitance, denoted $C_{\\mathrm{rss}}(p)$ (also referred to as the Miller capacitance), scales proportional to $1/p^2$: $C_{\\mathrm{rss}}(p) = k_{\\mathrm{crss}}/p^2$, where $k_{\\mathrm{crss}}$ (in $\\mathrm{F}\\cdot\\mathrm{m}^2$) is a geometry-dependent constant.\n\nLet the device switch a constant load current $I$ (in $\\mathrm{A}$) from a direct current bus voltage $V_{\\mathrm{bus}}$ (in $\\mathrm{V}$), with duty cycle $D$ (unitless, use decimal between $0$ and $1$), at switching frequency $f_{\\mathrm{s}}$ (in $\\mathrm{Hz}$). The gate driver can supply a constant gate current $I_{\\mathrm{g}}$ (in $\\mathrm{A}$) during the Miller plateau. The conduction characteristics include a knee-voltage $V_{\\mathrm{knee}}$ (in $\\mathrm{V}$) representing the bipolar drop in the IGBT.\n\nUsing only fundamental relationships and definitions, derive a total loss model $P_{\\mathrm{tot}}(p)$ (in $\\mathrm{W}$) comprising:\n- Conduction loss due to the resistive component $R_{\\mathrm{eff}}(p)$ under duty $D$ and current $I$.\n- Conduction loss due to the knee-voltage $V_{\\mathrm{knee}}$ under duty $D$ and current $I$.\n- Switching loss due to the Miller overlap energy associated with $C_{\\mathrm{rss}}(p)$, assuming the collector-emitter voltage slews approximately from $V_{\\mathrm{bus}}$ to a low value during turn-on and vice versa during turn-off, and that the Miller plateau current is limited by $I_{\\mathrm{g}}$.\n\nThen, compute the pitch $p_{\\mathrm{opt}}$ (in $\\mathrm{m}$) that minimizes $P_{\\mathrm{tot}}(p)$ and the corresponding minimal total loss $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$ (in $\\mathrm{W}$), for each parameter set in the test suite below. Express the optimum pitch in $\\mathrm{m}$ and the minimal total loss in $\\mathrm{W}$.\n\nFoundational relationships you may invoke include:\n- Capacitance as charge-voltage relation $Q = C\\,V$.\n- Energy stored in a capacitor $E_C = \\frac{1}{2} C V^2$.\n- Power as energy per unit time $P = E/t$.\n- Power in resistive conduction $P_R = I^2 R$.\n- The definition of duty cycle as the fraction of time the device conducts at the stated current.\n\nTest suite (each tuple provides $(f_{\\mathrm{s}}, V_{\\mathrm{bus}}, I, D, I_{\\mathrm{g}}, R_{\\mathrm{drift}}, V_{\\mathrm{knee}}, k_{\\mathrm{ch}}, k_{\\mathrm{crss}})$ with units as specified above):\n- Case $1$ (general case): $(20000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $2$ (high switching frequency): $(100000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $3$ (weak gate driver): $(20000.0, 600.0, 50.0, 0.5, 0.5, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $4$ (lower load current): $(20000.0, 600.0, 10.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $5$ (low switching frequency, high duty): $(2000.0, 600.0, 50.0, 0.9, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[ [p_1, P_1], [p_2, P_2], \\dots ]$), where each inner list contains the optimum pitch $p_{\\mathrm{opt}}$ (in $\\mathrm{m}$) and the corresponding minimal total loss $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$ (in $\\mathrm{W}$) for the respective test case.",
            "solution": "The user-provided problem is evaluated and found to be valid. It is scientifically grounded in the principles of power semiconductor physics and power electronics, well-posed as a mathematical optimization problem, and all parameters are clearly defined and physically realistic.\n\nThe objective is to derive an expression for the total power loss, $P_{\\mathrm{tot}}(p)$, as a function of the IGBT unit cell pitch, $p$, and to find the optimal pitch, $p_{\\mathrm{opt}}$, that minimizes this loss. The total loss is comprised of conduction losses and switching losses.\n\nFirst, we formulate the expression for the conduction loss, $P_{\\mathrm{cond}}$. The device conducts a current $I$ for a fraction of the switching period determined by the duty cycle $D$. The on-state voltage drop across the IGBT is the sum of a constant knee-voltage $V_{\\mathrm{knee}}$ and a resistive drop. The instantaneous power dissipated during conduction is $P_{\\mathrm{inst, cond}} = V_{\\mathrm{on}} I = (V_{\\mathrm{knee}} + I R_{\\mathrm{eff}}(p)) I$. Averaged over a full switching cycle, the conduction power loss is:\n$$ P_{\\mathrm{cond}}(p) = D \\cdot (V_{\\mathrm{knee}} I + I^2 R_{\\mathrm{eff}}(p)) $$\nThe problem provides the model for the effective resistance as $R_{\\mathrm{eff}}(p) = R_{\\mathrm{drift}} + k_{\\mathrm{ch}}p^2$. Substituting this into the conduction loss equation yields:\n$$ P_{\\mathrm{cond}}(p) = D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}} + D I^2 k_{\\mathrm{ch}} p^2 $$\nThe first two terms are independent of the cell pitch $p$, while the third term represents the portion of the conduction loss that increases with $p^2$.\n\nNext, we formulate the expression for the switching loss, $P_{\\mathrm{sw}}$. The problem specifies this loss is due to the Miller overlap energy. This energy is dissipated during the turn-on and turn-off transitions when both substantial voltage and current are present across the device. The model considers the interval where the collector current is at the full load value, $I$, while the collector-emitter voltage, $V_{\\mathrm{ce}}$, slews across the bus voltage, $V_{\\mathrm{bus}}$. This voltage slew is controlled by a constant gate current $I_{\\mathrm{g}}$ charging or discharging the gate-collector (Miller) capacitance, $C_{\\mathrm{rss}}(p)$.\n\nThe change in charge on the Miller capacitance required to slew the voltage by $V_{\\mathrm{bus}}$ is $\\Delta Q = C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}$. The time taken for this slew, i.e., the duration of the Miller plateau, is $t_{\\mathrm{v,slew}} = \\frac{\\Delta Q}{I_{\\mathrm{g}}} = \\frac{C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}}{I_{\\mathrm{g}}}$.\nAssuming a linear voltage slew, the energy dissipated during one such transition (e.g., turn-on) is $E_{\\text{on}} = \\int p(t) dt = \\int V_{\\mathrm{ce}}(t) I dt = \\frac{1}{2} I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}$. The total energy dissipated per switching cycle includes both turn-on and turn-off events. Assuming symmetric transitions, the total switching energy is $E_{\\mathrm{sw}} = E_{\\text{on}} + E_{\\text{off}} = 2 \\cdot (\\frac{1}{2} I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}) = I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}$.\nSubstituting the expression for $t_{\\mathrm{v,slew}}$:\n$$ E_{\\mathrm{sw}}(p) = I V_{\\mathrm{bus}} \\left( \\frac{C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}}{I_{\\mathrm{g}}} \\right) = \\frac{I V_{\\mathrm{bus}}^2 C_{\\mathrm{rss}}(p)}{I_{\\mathrm{g}}} $$\nThe average switching power is an average of this energy over the switching period $T_{\\mathrm{s}} = 1/f_{\\mathrm{s}}$, so $P_{\\mathrm{sw}} = E_{\\mathrm{sw}} \\cdot f_{\\mathrm{s}}$. Using the given model for Miller capacitance, $C_{\\mathrm{rss}}(p) = k_{\\mathrm{crss}}/p^2$:\n$$ P_{\\mathrm{sw}}(p) = f_{\\mathrm{s}} \\frac{I V_{\\mathrm{bus}}^2}{I_{\\mathrm{g}}} \\frac{k_{\\mathrm{crss}}}{p^2} $$\n\nThe total power loss, $P_{\\mathrm{tot}}(p)$, is the sum of the conduction and switching losses:\n$$ P_{\\mathrm{tot}}(p) = P_{\\mathrm{cond}}(p) + P_{\\mathrm{sw}}(p) = (D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}) + (D I^2 k_{\\mathrm{ch}}) p^2 + \\left( \\frac{f_{\\mathrm{s}} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{I_{\\mathrm{g}}} \\right) \\frac{1}{p^2} $$\nThis equation is of the form $P_{\\mathrm{tot}}(p) = C_0 + C_1 p^2 + C_2 p^{-2}$, where $C_0$, $C_1$, and $C_2$ are positive constants representing the pitch-independent loss, the pitch-dependent conduction loss scaling, and the switching loss scaling, respectively.\n- $C_0 = D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}$\n- $C_1 = D I^2 k_{\\mathrm{ch}}$\n- $C_2 = f_{\\mathrm{s}} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}} / I_{\\mathrm{g}}$\n\nTo find the optimal pitch $p_{\\mathrm{opt}}$ that minimizes $P_{\\mathrm{tot}}(p)$, we take the derivative with respect to $p$ and set it to zero:\n$$ \\frac{d P_{\\mathrm{tot}}}{dp} = 2 C_1 p - 2 C_2 p^{-3} = 0 $$\n$$ 2 C_1 p_{\\mathrm{opt}} = 2 C_2 p_{\\mathrm{opt}}^{-3} \\implies p_{\\mathrm{opt}}^4 = \\frac{C_2}{C_1} $$\nSolving for $p_{\\mathrm{opt}}$ (which must be a positive real number):\n$$ p_{\\mathrm{opt}} = \\left( \\frac{C_2}{C_1} \\right)^{1/4} = \\left( \\frac{f_{\\mathrm{s}} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}} / I_{\\mathrm{g}}}{D I^2 k_{\\mathrm{ch}}} \\right)^{1/4} = \\left( \\frac{f_{\\mathrm{s}} V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{D I I_{\\mathrm{g}} k_{\\mathrm{ch}}} \\right)^{1/4} $$\nThe minimal total loss, $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$, is found by substituting $p_{\\mathrm{opt}}$ back into the total loss equation. At the optimum point, the pitch-dependent conduction loss equals the switching loss: $C_1 p_{\\mathrm{opt}}^2 = C_2 p_{\\mathrm{opt}}^{-2} = \\sqrt{C_1 C_2}$.\nTherefore, the minimum total loss is:\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = C_0 + C_1 p_{\\mathrm{opt}}^2 + C_2 p_{\\mathrm{opt}}^{-2} = C_0 + \\sqrt{C_1 C_2} + \\sqrt{C_1 C_2} = C_0 + 2\\sqrt{C_1 C_2} $$\nSubstituting the expressions for $C_0$, $C_1$, and $C_2$:\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = (D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}) + 2 \\sqrt{(D I^2 k_{\\mathrm{ch}}) \\left( \\frac{f_{\\mathrm{s}} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{I_{\\mathrm{g}}} \\right)} $$\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = D I(V_{\\mathrm{knee}} + I R_{\\mathrm{drift}}) + 2 I V_{\\mathrm{bus}} \\sqrt{\\frac{D I f_{\\mathrm{s}} k_{\\mathrm{ch}} k_{\\mathrm{crss}}}{I_{\\mathrm{g}}}} $$\nThese derived formulas for $p_{\\mathrm{opt}}$ and $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$ are implemented to process the given test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal IGBT cell pitch and the corresponding minimum total power loss\n    for a series of test cases based on a derived loss model.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each tuple provides (f_s, V_bus, I, D, I_g, R_drift, V_knee, k_ch, k_crss)\n    test_cases = [\n        # Case 1 (general case)\n        (20000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 2 (high switching frequency)\n        (100000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 3 (weak gate driver)\n        (20000.0, 600.0, 50.0, 0.5, 0.5, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 4 (lower load current)\n        (20000.0, 600.0, 10.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 5 (low switching frequency, high duty)\n        (2000.0, 600.0, 50.0, 0.9, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_s, V_bus, I, D, I_g, R_drift, V_knee, k_ch, k_crss = case\n\n        # --- Calculate Optimal Pitch (p_opt) ---\n        # The optimal pitch p_opt is derived from d(P_tot)/dp = 0.\n        # p_opt = ( (f_s * V_bus^2 * k_crss) / (D * I * I_g * k_ch) )^(1/4)\n        p_opt_numerator = f_s * V_bus**2 * k_crss\n        p_opt_denominator = D * I * I_g * k_ch\n        p_opt = (p_opt_numerator / p_opt_denominator)**0.25\n\n        # --- Calculate Minimal Total Loss (P_tot_opt) ---\n        # The minimal total loss is P_tot(p_opt) = C0 + 2*sqrt(C1*C2), where:\n        # C0 = D*I*V_knee + D*I^2*R_drift (pitch-independent losses)\n        # C1 = D*I^2*k_ch (pitch-dependent conduction loss coefficient)\n        # C2 = f_s*I*V_bus^2*k_crss / I_g (switching loss coefficient)\n        \n        # Calculate pitch-independent loss component\n        C0 = D * I * (V_knee + I * R_drift)\n        \n        # Calculate pitch-dependent loss coefficients\n        C1 = D * I**2 * k_ch\n        C2 = (f_s * I * V_bus**2 * k_crss) / I_g\n        \n        # Calculate the minimal total loss\n        P_tot_opt = C0 + 2 * np.sqrt(C1 * C2)\n        \n        results.append([p_opt, P_tot_opt])\n\n    # Final print statement in the exact required format.\n    # The default string conversion of the list of lists matches the required output format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "An optimally designed IGBT must not only be efficient but also rugged enough to survive the stresses of real-world operation. During turn-off in an inductive circuit, the device is subjected to simultaneous high voltage and high current, a stressful condition governed by its Reverse Biased Safe Operating Area (RBSOA). This practice challenges you to model the turn-off transient, including the voltage overshoot caused by stray inductance, and to quantify the device's margin to failure .",
            "id": "3839084",
            "problem": "A field-stop and trench-gate Insulated Gate Bipolar Transistor (IGBT) undergoing turn-off in a clamped inductive environment is constrained by the Reverse Biased Safe Operating Area (RBSOA). The dynamic RBSOA under reverse bias during turn-off is governed by simultaneous limits on collector-emitter voltage, instantaneous power dissipation, and current slew rate. These limits reflect the device’s field-stop design, which controls high-field distribution during blocking, and the trench-gate design, which strongly couples gate-voltage dynamics to collector current. Your task is to compute the margin to dynamic RBSOA violation given a specified gate-drive profile, bus inductance, and load current, and to predict whether and when secondary breakdown would occur during turn-off.\n\nUse the following fundamental base and modeling assumptions:\n\n- Fundamental laws:\n  - Inductor voltage law: $v_{L} = L \\frac{di}{dt}$.\n  - Power: $p = v \\, i$.\n\n- Core device relations and definitions:\n  - The collector current is controlled by gate voltage through an effective transconductance. In conduction, model the collector current as $i_{C}(t) = \\min\\!\\left(I_{\\text{load}}, \\max\\!\\left(0, g_{m}\\left(v_{GE}(t) - V_{\\text{th}}\\right)\\right)\\right)$, where $g_{m}$ is the effective transconductance, $V_{\\text{th}}$ is the threshold voltage, and $I_{\\text{load}}$ is the load current at turn-off initiation.\n  - The gate-drive profile is a linear ramp: $v_{GE}(t) = V_{GI} + S_{g}\\, t$ for $0 \\le t \\le t_{\\text{end}}$, with $S_{g} < 0$ and $t_{\\text{end}} = \\dfrac{V_{GF} - V_{GI}}{S_{g}}$. For $t > t_{\\text{end}}$, $v_{GE}(t) = V_{GF}$.\n  - The time $t_{\\text{start}}$ at which the collector current begins to decrease from the load value is defined by $g_{m}\\left(V_{GI} + S_{g} t_{\\text{start}} - V_{\\text{th}}\\right) = I_{\\text{load}}$ if such a $t_{\\text{start}} \\in [0, t_{\\text{end}}]$ exists. Before $t_{\\text{start}}$, $i_{C}(t) = I_{\\text{load}}$.\n  - When $i_{C}(t)$ begins to fall, the bus stray inductance $L_{\\text{bus}}$ generates a collector-emitter voltage overshoot through $v_{L} = L_{\\text{bus}} \\left|\\frac{di_{C}}{dt}\\right|$. Model the collector-emitter voltage during the current fall as $v_{CE}(t) = V_{\\text{BUS}} + L_{\\text{bus}}\\left|\\dfrac{di_{C}}{dt}\\right|$, where $V_{\\text{BUS}}$ is the direct current bus voltage.\n  - The instantaneous power is $p(t) = v_{CE}(t)\\, i_{C}(t)$.\n\n- Dynamic RBSOA violation criteria:\n  - Let $V_{CES}$ be the maximum rated collector-emitter blocking voltage in reverse-biased turn-off, $P_{\\text{dyn}}$ be the allowable instantaneous dynamic power limit during turn-off, and $\\left|\\dfrac{di}{dt}\\right|_{\\max}$ be the maximum allowable magnitude of the current slew rate. The dynamic RBSOA is violated if at any time during turn-off one or more of the following holds: $v_{CE} > V_{CES}$, $p > P_{\\text{dyn}}$, or $\\left|\\dfrac{di}{dt}\\right| > \\left|\\dfrac{di}{dt}\\right|_{\\max}$.\n  - Define the margin as the smallest ratio of allowable limit to the actual stress among these constraints, i.e., the minimum of the three ratios computed for $v_{CE}$, $p$, and $\\left|\\dfrac{di}{dt}\\right|$. A margin less than $1$ indicates violation. Predict the occurrence time of secondary breakdown as the earliest time when any constraint is exceeded; if no violation occurs during the ramp, report that no breakdown is predicted.\n\nAlgorithmic requirements:\n\n- Implement the above relations to compute:\n  1. The onset time $t_{\\text{start}}$ of current reduction, or determine that no current reduction occurs within the gate ramp interval.\n  2. The magnitude $\\left|\\dfrac{di_{C}}{dt}\\right|$ during the current reduction, based on the gate ramp slope and effective transconductance.\n  3. The maximum collector-emitter voltage during the current fall, using the bus inductance relation.\n  4. The peak instantaneous power near the onset of current fall when both $v_{CE}$ and $i_{C}$ are high.\n  5. The margin to violation as the minimum ratio among the constraints.\n  6. The predicted time of violation $t_{\\text{viol}}$ as the earliest time at which any constraint is exceeded. If no violation occurs, report $-1$ for $t_{\\text{viol}}$.\n\n- Units:\n  - Voltages in volts ($\\mathrm{V}$).\n  - Currents in amperes ($\\mathrm{A}$).\n  - Inductances in henries ($\\mathrm{H}$).\n  - Time in seconds ($\\mathrm{s}$).\n  - Power in watts ($\\mathrm{W}$).\n  - Slew rates in amperes per second ($\\mathrm{A/s}$).\n  - Express the reported time in seconds and the margin as a unitless decimal number.\n\nTest suite:\n\nCompute the margin and predicted violation time using the following four parameter sets, each given as an ordered tuple $(V_{\\text{BUS}}, V_{CES}, I_{\\text{load}}, L_{\\text{bus}}, g_{m}, V_{\\text{th}}, V_{GI}, V_{GF}, S_{g}, P_{\\text{dyn}}, \\left|\\dfrac{di}{dt}\\right|_{\\max})$:\n\n- Case A (happy path, safe):\n  - $(600, 1200, 100, 1.0\\times 10^{-7}, 20, 5, 15, 0, -5.0\\times 10^{6}, 80000, 1.5\\times 10^{8})$.\n\n- Case B (power violation):\n  - $(800, 1200, 120, 3.0\\times 10^{-7}, 20, 5, 15, 0, -2.0\\times 10^{7}, 85000, 5.0\\times 10^{8})$.\n\n- Case C (voltage violation):\n  - $(900, 1200, 80, 1.1\\times 10^{-6}, 20, 5, 14, 0, -1.5\\times 10^{7}, 100000, 5.0\\times 10^{8})$.\n\n- Case D (current slew violation):\n  - $(650, 1200, 90, 1.5\\times 10^{-7}, 25, 4.5, 16, 0, -2.5\\times 10^{7}, 100000, 5.0\\times 10^{8})$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets, where each element is a two-element list of the form $[m, t_{\\text{viol}}]$ with $m$ the unitless margin and $t_{\\text{viol}}$ the predicted violation time in seconds (or $-1$ if no violation is predicted). For example: $[[m_{A}, t_{\\text{viol},A}], [m_{B}, t_{\\text{viol},B}], [m_{C}, t_{\\text{viol},C}], [m_{D}, t_{\\text{viol},D}]]$.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of power electronics, well-posed with a clear set of models and parameters, and objective in its formulation. All necessary information is provided, and the requested calculations are feasible within the given framework.\n\nThe primary objective is to evaluate the turn-off performance of a field-stop and trench-gate IGBT against its Reverse Biased Safe Operating Area (RBSOA) limits. This requires calculating several key electrical quantities during the turn-off transient and comparing them to the device's specified maximum ratings. The analysis proceeds through a sequence of calculations based on the provided physical models.\n\nFirst, we determine the time at which the collector current begins to fall. The IGBT is initially carrying the full load current, $I_{\\text{load}}$. The gate voltage, $v_{GE}(t)$, starts at an initial value $V_{GI}$ and ramps down linearly with a negative slope $S_g$. The gate voltage at time $t$ is given by:\n$$v_{GE}(t) = V_{GI} + S_g t$$\nThe collector current $i_C$ is modeled as a function of the gate-emitter voltage overdrive relative to the threshold voltage $V_{\\text{th}}$, controlled by the transconductance $g_m$:\n$$i_{C}(t) = g_{m}\\left(v_{GE}(t) - V_{\\text{th}}\\right)$$\nThe current remains at $I_{\\text{load}}$ as long as the gate drive is sufficient to support it. The current begins to fall at time $t_{\\text{start}}$ when the gate voltage drops to the point where the device can just support $I_{\\text{load}}$. This time is found by setting the transconductance equation equal to $I_{\\text{load}}$:\n$$I_{\\text{load}} = g_{m}\\left(V_{GI} + S_g t_{\\text{start}} - V_{\\text{th}}\\right)$$\nSolving for $t_{\\text{start}}$ yields:\n$$t_{\\text{start}} = \\frac{1}{S_g} \\left( \\frac{I_{\\text{load}}}{g_m} + V_{\\text{th}} - V_{GI} \\right)$$\nThis calculation is valid provided that $t_{\\text{start}}$ occurs during the gate voltage ramp. The ramp ends at $t_{\\text{end}} = (V_{GF} - V_{GI})/S_g$. For all test cases, $t_{\\text{start}}$ is found to be within the ramp interval $[0, t_{\\text{end}}]$.\n\nSecond, we calculate the collector current slew rate, $\\frac{di_C}{dt}$, during the current fall phase (for $t > t_{\\text{start}}$). By differentiating the expression for $i_C(t)$ with respect to time:\n$$\\frac{di_C}{dt} = \\frac{d}{dt} \\left[ g_m (V_{GI} + S_g t - V_{\\text{th}}) \\right] = g_m S_g$$\nSince $S_g < 0$, the slew rate is negative, indicating a falling current. The magnitude of the slew rate, which is a key stress parameter, is constant during the fall:\n$$\\left|\\frac{di_C}{dt}\\right|_{\\text{actual}} = |g_m S_g| = -g_m S_g$$\n\nThird, we determine the peak collector-emitter voltage, $v_{CE, \\text{peak}}$. During the turn-off transient, the rapidly changing current flows through the stray inductance of the DC bus, $L_{\\text{bus}}$, inducing a voltage overshoot. According to the provided model, this adds to the DC bus voltage, $V_{\\text{BUS}}$:\n$$v_{CE}(t) = V_{\\text{BUS}} + L_{\\text{bus}} \\left|\\frac{di_C}{dt}\\right|$$\nSince the current slew rate is constant during the fall, the collector-emitter voltage is also constant and reaches its peak value, $v_{CE, \\text{peak}}$, at the onset of the current fall ($t=t_{\\text{start}}$) and maintains this value throughout the fall.\n$$v_{CE, \\text{peak}} = V_{\\text{BUS}} + L_{\\text{bus}} (-g_m S_g)$$\n\nFourth, we find the peak instantaneous power dissipation, $p_{\\text{peak}}$. Power is given by $p(t) = v_{CE}(t) i_C(t)$. During the current fall ($t > t_{\\text{start}}$), $v_{CE}(t)$ is constant at its peak value $v_{CE, \\text{peak}}$, while $i_C(t)$ is linearly decreasing from $I_{\\text{load}}$. Therefore, the power dissipation is highest at the beginning of this interval, at $t = t_{\\text{start}}$, where the current is still (nearly) $I_{\\text{load}}$.\n$$p_{\\text{peak}} = v_{CE, \\text{peak}} \\times I_{\\text{load}} = \\left( V_{\\text{BUS}} + L_{\\text{bus}}(-g_m S_g) \\right) I_{\\text{load}}$$\n\nFifth, we compute the margin to RBSOA violation. The margin is defined as the minimum of the ratios of the specified limits to the calculated peak stresses for voltage, power, and current slew rate.\n- Voltage ratio: $R_v = \\dfrac{V_{CES}}{v_{CE, \\text{peak}}}$\n- Power ratio: $R_p = \\dfrac{P_{\\text{dyn}}}{p_{\\text{peak}}}$\n- Slew rate ratio: $R_{didt} = \\dfrac{|\\frac{di}{dt}|_{\\max}}{|\\frac{di_C}{dt}|_{\\text{actual}}}$\n\nThe overall margin, $m$, is:\n$$m = \\min(R_v, R_p, R_{didt})$$\nA margin $m  1$ indicates that at least one RBSOA limit has been violated.\n\nFinally, we predict the time of violation, $t_{\\text{viol}}$. Based on our model, the stresses on all three quantities ($v_{CE}$, $p$, and $|\\frac{di_C}{dt}|$) are maximal at the beginning of the current fall, $t_{\\text{start}}$. If a violation occurs, it will happen at this instant. Therefore, if the calculated margin $m$ is less than $1$, the violation time is $t_{\\text{viol}} = t_{\\text{start}}$. If $m \\ge 1$, no violation occurs during the turn-off transient, and we report $t_{\\text{viol}} = -1$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RBSOA margin and violation time for IGBT turn-off.\n    \"\"\"\n\n    test_cases = [\n        # Case A (happy path, safe)\n        (600, 1200, 100, 1.0e-7, 20, 5, 15, 0, -5.0e6, 80000, 1.5e8),\n        # Case B (power violation)\n        (800, 1200, 120, 3.0e-7, 20, 5, 15, 0, -2.0e7, 85000, 5.0e8),\n        # Case C (voltage violation)\n        (900, 1200, 80, 1.1e-6, 20, 5, 14, 0, -1.5e7, 100000, 5.0e8),\n        # Case D (current slew violation)\n        (650, 1200, 90, 1.5e-7, 25, 4.5, 16, 0, -2.5e7, 100000, 5.0e8),\n    ]\n\n    def calculate_rbsoa_metrics(params):\n        \"\"\"\n        Calculates margin and violation time for a single parameter set.\n        \n        Args:\n            params (tuple): A tuple containing the 11 parameters defining a test case.\n            \n        Returns:\n            list: A list containing the margin and violation time, [m, t_viol].\n        \"\"\"\n        V_BUS, V_CES, I_load, L_bus, g_m, V_th, V_GI, _, S_g, P_dyn, didt_max = params\n\n        # 1. Calculate the start time of current reduction, t_start\n        # t_start = (1/S_g) * (I_load/g_m + V_th - V_GI)\n        # We assume initial V_GE is high enough, i.e., g_m * (V_GI - V_th) = I_load.\n        # This holds true for all test cases.\n        t_start = (1.0 / S_g) * (I_load / g_m + V_th - V_GI)\n\n        # 2. Calculate the magnitude of the current slew rate\n        # |di_C/dt| = |g_m * S_g| = -g_m * S_g (since S_g  0)\n        didt_actual = -g_m * S_g\n\n        # 3. Calculate the peak collector-emitter voltage\n        # v_CE_peak = V_BUS + L_bus * |di_C/dt|\n        v_ce_peak = V_BUS + L_bus * didt_actual\n\n        # 4. Calculate the peak instantaneous power\n        # p_peak = v_CE_peak * i_C(t_start) = v_CE_peak * I_load\n        p_peak = v_ce_peak * I_load\n\n        # 5. Compute the ratios of limits to actual stresses\n        # Avoid division by zero, although not expected in this problem.\n        ratio_v = V_CES / v_ce_peak if v_ce_peak != 0 else float('inf')\n        ratio_p = P_dyn / p_peak if p_peak != 0 else float('inf')\n        ratio_didt = didt_max / didt_actual if didt_actual != 0 else float('inf')\n        \n        # Calculate the margin as the minimum of the three ratios\n        margin = np.min([ratio_v, ratio_p, ratio_didt])\n\n        # 6. Predict the time of violation, t_viol\n        # Violation occurs if margin  1. It happens at t_start.\n        if margin  1.0:\n            t_viol = t_start\n        else:\n            t_viol = -1.0\n            \n        return [margin, t_viol]\n\n    results = []\n    for case in test_cases:\n        result = calculate_rbsoa_metrics(case)\n        results.append(result)\n\n    # Format the final output as a string representation of a list of lists.\n    # The map(str, results) converts each inner list like [1.23, -1.0]\n    # into a string like '[1.23, -1.0]'. Joining with commas and adding\n    # outer brackets creates the required final format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}