{
    "hands_on_practices": [
        {
            "introduction": "The primary motivation for third-harmonic injection is to increase the utilization of the DC bus voltage, allowing for a larger fundamental output voltage compared to standard sinusoidal PWM. This is achieved by adding a common-mode third-harmonic component that 'flattens' the peaks of the phase voltage references, keeping them within the inverter's linear modulation range.\n\nThis exercise  challenges you to mathematically prove this benefit by deriving the maximum permissible fundamental amplitude for a given amount of third-harmonic injection. Mastering this derivation provides a rigorous understanding of the linear modulation limits in advanced PWM schemes and the trade-offs involved.",
            "id": "3886113",
            "problem": "Consider a three-phase Voltage Source Inverter (VSI) implementing Sinusoidal Pulse Width Modulation (SPWM) with third-harmonic injection for phase-$a$. The normalized phase reference is given by\n$$\nv_a^{*}(t) = m \\sin(\\omega t) + k \\sin(3 \\omega t),\n$$\nwhere $m$ is the fundamental modulation amplitude, $k > 0$ is the fixed third-harmonic injection amplitude, and $\\omega$ is the angular frequency. Angles are measured in radians. The normalized direct current (DC) bus voltage is unity, and to avoid overmodulation the reference must satisfy\n$$\n|v_a^{*}(t)| \\leq 1 \\quad \\text{for all } t.\n$$\nStarting from first principles of calculus and trigonometric identities, derive closed-form expressions for\n$$\n\\max_{t} v_a^{*}(t) \\quad \\text{and} \\quad \\min_{t} v_a^{*}(t),\n$$\nwithout assuming any special relationship between $m$ and $k$ beyond $k > 0$. Use these extrema to obtain a closed-form expression for the largest admissible fundamental modulation amplitude $m$ as a function of $k$ such that $|v_a^{*}(t)| \\leq 1$ holds for all $t$. Express your final bound $m_{\\max}(k)$ as a single analytic expression. No numerical rounding is required and no physical units appear in the final bound.",
            "solution": "The problem is to find the maximum allowable fundamental modulation amplitude $m$ for a given third-harmonic injection amplitude $k$ such that the normalized phase reference voltage $v_a^{*}(t)$ does not exceed the normalized DC bus voltage.\n\nThe normalized phase reference is given by\n$$v_a^{*}(t) = m \\sin(\\omega t) + k \\sin(3 \\omega t)$$\nwith the constraint\n$$|v_a^{*}(t)| \\leq 1 \\quad \\text{for all } t.$$\n\nThis is equivalent to ensuring that the global maximum of $|v_a^{*}(t)|$ is less than or equal to $1$. Let $V_{peak} = \\max_t |v_a^{*}(t)|$. We must find an expression for $V_{peak}$ as a function of $m$ and $k$, and then find the largest $m$, denoted $m_{max}(k)$, for which $V_{peak} \\leq 1$.\n\nFirst, we derive the expressions for the maximum and minimum of $v_a^{*}(t)$. Let $x = \\omega t$. Since $t$ spans all real numbers, $\\sin(\\omega t)$ will span its full range $[-1, 1]$. We can analyze the function by letting $s = \\sin(x) = \\sin(\\omega t)$, where $s \\in [-1, 1]$. Using the triple-angle identity for sine, $\\sin(3x) = 3\\sin(x) - 4\\sin^3(x)$, we can rewrite $v_a^{*}(t)$ as a function of $s$:\n$$g(s) = m s + k (3s - 4s^3) = (m+3k)s - 4ks^3$$\nWe need to find the extrema of $g(s)$ for $s \\in [-1, 1]$. The extrema can occur at the boundaries of the interval ($s = \\pm 1$) or at critical points within the interval where the derivative is zero.\n\nThe derivative of $g(s)$ with respect to $s$ is:\n$$g'(s) = \\frac{d}{ds} \\left( (m+3k)s - 4ks^3 \\right) = m+3k - 12ks^2$$\nSetting the derivative to zero to find critical points $s_c$:\n$$m+3k - 12ks_c^2 = 0 \\implies s_c^2 = \\frac{m+3k}{12k}$$\nFor these critical points to be real and within the interval $s \\in [-1, 1]$, we must have $0 \\leq s_c^2 \\leq 1$.\nSince $m \\geq 0$ and $k > 0$, $m+3k > 0$, so $s_c^2 > 0$ is always satisfied.\nThe condition $s_c^2 \\leq 1$ implies:\n$$\\frac{m+3k}{12k} \\leq 1 \\implies m+3k \\leq 12k \\implies m \\leq 9k$$\n\nWe must analyze two cases based on this condition.\n\nCase 1: $0 \\leq m \\leq 9k$.\nIn this case, the critical points $s_c = \\pm\\sqrt{\\frac{m+3k}{12k}}$ are within the interval $[-1, 1]$. The possible extrema are the values of $g(s)$ at these critical points and at the boundaries $s = \\pm 1$.\nValue at the critical points:\n$$g(s_c) = (m+3k)s_c - 4ks_c^3 = s_c \\left( (m+3k) - 4ks_c^2 \\right)$$\n$$g(s_c) = s_c \\left( (m+3k) - 4k \\frac{m+3k}{12k} \\right) = s_c \\left( (m+3k) - \\frac{m+3k}{3} \\right) = \\frac{2}{3}(m+3k)s_c$$\nSubstituting $s_c = \\pm\\sqrt{\\frac{m+3k}{12k}}$:\n$$g(s_c) = \\pm \\frac{2}{3}(m+3k) \\sqrt{\\frac{m+3k}{12k}} = \\pm \\frac{2(m+3k)^{3/2}}{3\\sqrt{12k}} = \\pm \\frac{2(m+3k)^{3/2}}{3 \\cdot 2\\sqrt{3k}} = \\pm \\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}$$\nValue at the boundaries:\n$$g(1) = (m+3k) - 4k = m-k$$\n$$g(-1) = -(m+3k) + 4k = -m+k = -(m-k)$$\nTo determine the global maximum for this case, we compare $|m-k|$ with $\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}$. Let's compare their squares:\n$$(m-k)^2 \\quad \\text{vs.} \\quad \\left(\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}\\right)^2 = \\frac{(m+3k)^3}{27k}$$\nConsider the difference:\n$$\\frac{(m+3k)^3}{27k} - (m-k)^2 = \\frac{1}{27k} \\left[ (m+3k)^3 - 27k(m-k)^2 \\right]$$\nThe term in the bracket is:\n$$(m^3 + 9km^2 + 27k^2m + 27k^3) - 27k(m^2 - 2mk + k^2) = m^3 - 18km^2 + 81k^2m = m(m^2 - 18km + 81k^2) = m(m-9k)^2$$\nSince $m \\ge 0$ and $(m-9k)^2 \\ge 0$, this difference is non-negative. Thus, for $0 \\leq m \\leq 9k$:\n$$\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}} \\geq |m-k|$$\nThe equality holds for $m=0$ and $m=9k$.\nTherefore, for $0 \\leq m \\leq 9k$, the extrema are $\\pm \\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}$.\n\nCase 2: $m > 9k$.\nIn this case, $s_c^2 = \\frac{m+3k}{12k} > 1$, so the critical points lie outside the interval $[-1, 1]$. The function $g(s)$ is monotonic on $[-1, 1]$ since its derivative $g'(s) = m+3k - 12ks^2$ does not change sign on $(-1, 1)$. The extrema must therefore occur at the boundaries $s = \\pm 1$.\nThe values are $g(1) = m-k$ and $g(-1) = k-m$.\nSince $m > 9k > k$, $m-k$ is positive, so the maximum is $m-k$ and the minimum is $k-m$.\n\nCombining both cases, we obtain the closed-form expressions for the maximum and minimum of $v_a^*(t)$:\n$$\\max_{t} v_a^{*}(t) = \\begin{cases} \\frac{(m+3k)^{3/2}}{3\\sqrt{3k}} & \\text{if } 0 \\le m \\le 9k \\\\ m-k & \\text{if } m > 9k \\end{cases}$$\n$$\\min_{t} v_a^{*}(t) = -\\max_{t} v_a^{*}(t) = \\begin{cases} -\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}} & \\text{if } 0 \\le m \\le 9k \\\\ k-m & \\text{if } m > 9k \\end{cases}$$\n\nNow we find the largest admissible amplitude $m_{max}(k)$ by setting the peak absolute value to $1$.\nLet $V_{peak}(m, k) = \\max_{t} |v_a^*(t)| = \\max_{t} v_a^{*}(t)$. We solve $V_{peak}(m, k) = 1$ for $m$.\n\nWe evaluate the peak voltage at the transition point $m=9k$:\n$V_{peak}(9k, k) = 9k-k = 8k$.\nWe can distinguish two scenarios based on whether this transition value is less than or greater than $1$.\n\nScenario A: The solution $m_{max}$ satisfies $m_{max} > 9k$.\nThis happens if $V_{peak}(9k, k) < 1$, which means $8k < 1$, or $k < 1/8$.\nIn this regime, we solve $m_{max} - k = 1$, which yields $m_{max} = 1+k$.\nThis solution is consistent, as $m_{max} = 1+k > 9k \\iff 1 > 8k \\iff k < 1/8$.\nSo, for $0 < k < 1/8$, the maximum amplitude is $m_{max}(k) = 1+k$.\n\nScenario B: The solution $m_{max}$ satisfies $0 \\le m_{max} \\le 9k$.\nThis happens if $V_{peak}(9k, k) \\ge 1$, which means $8k \\ge 1$, or $k \\ge 1/8$.\nIn this regime, we solve $\\frac{(m_{max}+3k)^{3/2}}{3\\sqrt{3k}} = 1$.\n$$(m_{max}+3k)^{3/2} = 3\\sqrt{3k} = (27k)^{1/2}$$\nRaising both sides to the power of $2/3$:\n$$m_{max}+3k = \\left((27k)^{1/2}\\right)^{2/3} = (27k)^{1/3} = 3k^{1/3}$$\n$$m_{max} = 3k^{1/3} - 3k$$\nThis solution is consistent if it satisfies $0 \\le m_{max} \\le 9k$.\n$m_{max} \\le 9k \\implies 3k^{1/3} - 3k \\le 9k \\implies 3k^{1/3} \\le 12k \\implies k^{1/3} \\le 4k \\implies k \\le 64k^3 \\implies 1 \\le 64k^2 \\implies k^2 \\ge 1/64 \\implies k \\ge 1/8$.\n$m_{max} \\ge 0 \\implies 3k^{1/3} - 3k \\ge 0 \\implies k^{1/3} \\ge k \\implies k \\ge k^3 \\implies 1 \\ge k^2 \\implies k \\le 1$.\nSo, for $1/8 \\le k \\le 1$, the maximum amplitude is $m_{max}(k) = 3k^{1/3} - 3k$. For $k>1$, $m_{max}$ would be negative, meaning no positive $m$ can satisfy the constraint.\n\nCombining these results, we get the final expression for $m_{max}(k)$, which is a single, piecewise-analytic function:\n$$m_{max}(k) = \\begin{cases} 1+k & \\text{if } 0 < k < \\frac{1}{8} \\\\ 3k^{1/3} - 3k & \\text{if } k \\ge \\frac{1}{8} \\end{cases}$$\nThe problem implies that a physically meaningful solution for $m>0$ exists, which requires $k \\le 1$. The expression holds for $k \\ge 1/8$.",
            "answer": "$$\n\\boxed{\n\\begin{cases} 1+k & \\text{if } 0 < k < \\frac{1}{8} \\\\ 3k^{1/3} - 3k & \\text{if } k \\ge \\frac{1}{8} \\end{cases}\n}\n$$"
        },
        {
            "introduction": "While third-harmonic injection is beneficial for increasing voltage output, it introduces a zero-sequence voltage component common to all three phases. In a perfectly balanced, three-wire system, this component has no effect on line-to-line voltages, but its presence can lead to significant neutral currents if a path to ground exists.\n\nThis practice problem  provides a hands-on analysis of this phenomenon, requiring you to calculate the neutral point voltage and current in a star-connected machine with a neutral impedance. This skill is critical for designing and troubleshooting systems where zero-sequence currents are a concern, such as in four-wire applications or certain motor drive configurations.",
            "id": "3886142",
            "problem": "A balanced three-phase, star-connected electrical machine is driven by a voltage-source inverter employing third-harmonic injection. The phase-to-neutral reference voltages imposed by the inverter are\n$$\nv_{a}(t) = \\hat{V}_{1} \\cos(\\omega t) + \\hat{V}_{3} \\cos(3\\omega t), \\quad\nv_{b}(t) = \\hat{V}_{1} \\cos\\!\\big(\\omega t - \\tfrac{2\\pi}{3}\\big) + \\hat{V}_{3} \\cos(3\\omega t), \\quad\nv_{c}(t) = \\hat{V}_{1} \\cos\\!\\big(\\omega t + \\tfrac{2\\pi}{3}\\big) + \\hat{V}_{3} \\cos(3\\omega t),\n$$\nwhere the third-harmonic terms are identical in amplitude and phase across all three phases. The stator is star-connected, and its neutral point is connected to ground through a neutral impedance $Z_{n}$. Each stator phase presents the same linear impedance to the third-harmonic component, denoted $Z_{s}$, at frequency $3\\omega$. Assume steady-state operation, linear time-invariant behavior, and that the fundamental components do not contribute to neutral current in a perfectly balanced system.\n\nWorking in the phasor domain at frequency $3\\omega$, let $V_{3}$ denote the per-phase third-harmonic source phasor between each phase and the neutral node, and let $V_{n}$ denote the phasor of the neutral node potential with respect to ground. Let $I_{n}$ denote the phasor of the current flowing from the neutral node to ground through $Z_{n}$.\n\nStarting only from Kirchhoffâ€™s Current Law (KCL) and the definition of phasors for steady-state sinusoidal analysis, derive closed-form expressions for $V_{n}$ and $I_{n}$ in terms of $V_{3}$, $Z_{s}$, and $Z_{n}$. Provide your final answer as a row matrix $(V_{n} \\;\\; I_{n})$. No numerical evaluation is required; express your answer symbolically.",
            "solution": "The problem requires an analysis in the phasor domain at the third-harmonic frequency, $3\\omega$. The fundamental components are balanced and do not produce a neutral current, so they can be ignored for this analysis.\n\nThe third-harmonic voltage components are identical for all three phases: $v_{a,3}(t) = v_{b,3}(t) = v_{c,3}(t) = \\hat{V}_{3} \\cos(3\\omega t)$. In the phasor domain, these voltages are represented by a single, identical phasor, $V_{3}$, for each phase. These are zero-sequence voltages.\n\nWe model the system as follows: The phase voltages imposed by the inverter are applied to the terminals of the star-connected machine. Let the machine terminals be $A$, $B$, and $C$, the stator neutral point be $N$, and the system ground be $G$. The inverter-imposed voltages are modeled as voltage sources connected between the phase terminals and ground. Thus, the third-harmonic voltages at the machine terminals with respect to ground are $V_{AG,3} = V_{3}$, $V_{BG,3} = V_{3}$, and $V_{CG,3} = V_{3}$.\n\nEach stator phase winding is an impedance $Z_{s}$ connected between its respective terminal and the neutral point $N$. The neutral point $N$ is connected to ground $G$ through the neutral impedance $Z_{n}$. The voltage of the neutral node $N$ with respect to ground $G$ is $V_{n}$. The current from $N$ to $G$ is $I_{n}$.\n\nWe are tasked to find $V_{n}$ and $I_{n}$ starting from Kirchhoff's Current Law (KCL) applied at the neutral node $N$. The sum of currents entering node $N$ from the phase windings must equal the current leaving node $N$ through the neutral impedance.\n\nLet $I_{a,3}$, $I_{b,3}$, and $I_{c,3}$ be the third-harmonic phasor currents flowing from terminals $A$, $B$, and $C$ to the neutral point $N$ through the stator impedances $Z_{s}$. Using Ohm's Law, the voltage drop across each stator impedance is the difference between the terminal voltage and the neutral voltage.\n$$\nI_{a,3} = \\frac{V_{AG,3} - V_{n}}{Z_{s}} = \\frac{V_{3} - V_{n}}{Z_{s}}\n$$\n$$\nI_{b,3} = \\frac{V_{BG,3} - V_{n}}{Z_{s}} = \\frac{V_{3} - V_{n}}{Z_{s}}\n$$\n$$\nI_{c,3} = \\frac{V_{CG,3} - V_{n}}{Z_{s}} = \\frac{V_{3} - V_{n}}{Z_{s}}\n$$\nThe current $I_{n}$ flowing from the neutral node $N$ to ground $G$ through the impedance $Z_{n}$ is given by:\n$$\nI_{n} = \\frac{V_{n} - V_{G}}{Z_{n}} = \\frac{V_{n}}{Z_{n}}\n$$\nwhere the ground potential $V_{G}$ is defined as $0$.\n\nNow, we apply KCL at the neutral node $N$. The sum of currents flowing into $N$ from the phases equals the current flowing out of $N$ to ground.\n$$\nI_{a,3} + I_{b,3} + I_{c,3} = I_{n}\n$$\nSubstituting the expressions for the currents:\n$$\n\\left(\\frac{V_{3} - V_{n}}{Z_{s}}\\right) + \\left(\\frac{V_{3} - V_{n}}{Z_{s}}\\right) + \\left(\\frac{V_{3} - V_{n}}{Z_{s}}\\right) = I_{n}\n$$\nThis simplifies to:\n$$\n3 \\frac{V_{3} - V_{n}}{Z_{s}} = I_{n}\n$$\nWe now have a system of two equations with two unknowns, $V_{n}$ and $I_{n}$:\n1.  $3 \\frac{V_{3} - V_{n}}{Z_{s}} = I_{n}$\n2.  $I_{n} = \\frac{V_{n}}{Z_{n}}$\n\nTo find $V_{n}$, we substitute the second equation into the first:\n$$\n3 \\frac{V_{3} - V_{n}}{Z_{s}} = \\frac{V_{n}}{Z_{n}}\n$$\nWe now solve for $V_{n}$ algebraically:\n$$\n3 Z_{n} (V_{3} - V_{n}) = Z_{s} V_{n}\n$$\n$$\n3 Z_{n} V_{3} - 3 Z_{n} V_{n} = Z_{s} V_{n}\n$$\n$$\n3 Z_{n} V_{3} = V_{n} (Z_{s} + 3 Z_{n})\n$$\nIsolating $V_{n}$ gives the first required expression:\n$$\nV_{n} = \\frac{3 Z_{n} V_{3}}{Z_{s} + 3 Z_{n}}\n$$\nTo find $I_{n}$, we substitute this expression for $V_{n}$ back into the equation $I_{n} = V_{n} / Z_{n}$:\n$$\nI_{n} = \\frac{1}{Z_{n}} \\left( \\frac{3 Z_{n} V_{3}}{Z_{s} + 3 Z_{n}} \\right)\n$$\nThe term $Z_{n}$ in the numerator and denominator cancels out, yielding the second required expression:\n$$\nI_{n} = \\frac{3 V_{3}}{Z_{s} + 3 Z_{n}}\n$$\nThe problem requests the final answer as a row matrix $(V_{n} \\;\\; I_{n})$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3 Z_{n} V_{3}}{Z_{s} + 3 Z_{n}} & \\frac{3 V_{3}}{Z_{s} + 3 Z_{n}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "High-performance current controllers rely on accurate knowledge of the modulator's operating limits to prevent issues like integrator windup. When using third-harmonic injection, the relationship between the commanded fundamental voltage and the peak phase voltage becomes non-trivial, requiring a carefully calculated saturation bound for the controller output.\n\nThis exercise  bridges the gap between modulation theory and control implementation by tasking you with designing the anti-windup logic for a PI controller. You will apply the principles of waveform analysis, similar to those explored in , to set a safe command limit, ensuring the controller respects the physical constraints of the inverter and maintains stability during large transients.",
            "id": "3886068",
            "problem": "Consider a three-phase voltage-source inverter using a modulator that accepts a normalized per-phase reference $m(\\theta)$ and saturates when $|m(\\theta)|$ exceeds a specified limit $M_{\\text{lim}}$. A zero-sequence third-harmonic injection strategy is used so that each phase reference has the form\n$$\nm(\\theta) = M\\big(\\sin(\\theta) + \\beta \\sin(3\\theta)\\big),\n$$\nwhere $M \\ge 0$ is the commanded fundamental amplitude, $\\beta \\in \\mathbb{R}$ is the third-harmonic injection ratio relative to the fundamental, and $\\theta$ is an angle in radians. The modulator saturates if $|m(\\theta)| > M_{\\text{lim}}$ for any $\\theta \\in \\mathbb{R}$.\n\nA Proportional-Integral (PI) current controller computes a normalized voltage command $u_k$ at discrete time index $k$ with sampling period $T_s > 0$ using a proportional gain $K_p > 0$ and integral gain $K_i > 0$:\n$$\nu_k^{\\text{unsat}} = K_p e_k + i_k,\n$$\nwhere $e_k$ is the current tracking error and $i_k$ is the integrator state at time $k$. Anti-windup is implemented by saturating the command to a feasible bound $U_{\\max}$ and correcting the integrator with a back-calculation gain $K_{\\text{aw}} \\ge 0$:\n$$\nu_k^{\\text{sat}} = \\operatorname{clip}\\left(u_k^{\\text{unsat}}, -U_{\\max}, U_{\\max}\\right),\n$$\n$$\ni_{k+1} = i_k + K_i T_s e_k + K_{\\text{aw}}\\left(u_k^{\\text{sat}} - u_k^{\\text{unsat}}\\right).\n$$\nThe feasible bound $U_{\\max}$ must ensure that for the chosen $M$ and $\\beta$, the modulator never saturates, i.e., $|m(\\theta)| \\le M_{\\text{lim}}$ for all $\\theta$. To enforce this universally, $U_{\\max}$ is used to clamp $M$ (through $u_k$) so that $M \\le U_{\\max}$, where $U_{\\max}$ is derived from the worst-case amplitude of $\\sin(\\theta) + \\beta \\sin(3\\theta)$.\n\nYour task is to implement the computation of the anti-windup constraints and the PI update for a set of test cases. For each test case, you are given $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}})$ and must compute:\n1. $U_{\\max} = \\dfrac{M_{\\text{lim}}}{\\sup_{\\theta \\in \\mathbb{R}} \\left|\\sin(\\theta) + \\beta \\sin(3\\theta)\\right|}$.\n2. The saturation flag $s_k$, which is $1$ if $u_k^{\\text{unsat}} \\ne u_k^{\\text{sat}}$ and $0$ otherwise.\n3. The saturated control $u_k^{\\text{sat}}$.\n4. The next integrator state $i_{k+1}$.\n\nAll angles are in radians. All quantities are dimensionless and normalized. Express the final results numerically as floats and integers.\n\nTest Suite:\n- Case 1 (general case, zero-sequence injection typical magnitude): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (1/6, 1.0, 0.5, 100.0, 1.0\\times 10^{-4}, 2.0\\times 10^{-2}, 0.0, 5000.0)$.\n- Case 2 (near-boundary with saturation): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (1/6, 1.0, 1.0, 50.0, 1.0\\times 10^{-4}, 1.2, 0.1, 2000.0)$.\n- Case 3 (no injection baseline): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (0.0, 1.0, 0.2, 200.0, 5.0\\times 10^{-5}, 6.0, 0.0, 3000.0)$.\n- Case 4 (negative injection ratio): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (-0.1, 1.0, 0.4, 120.0, 2.0\\times 10^{-4}, -3.0, 0.5, 1000.0)$.\n- Case 5 (stronger injection and reduced modulator limit): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (0.25, 0.9, 0.8, 80.0, 1.0\\times 10^{-4}, 1.3, -0.5, 1500.0)$.\n\nYour program should produce a single line of output containing the results for the five test cases as a comma-separated list enclosed in square brackets, where each element is a list of the four values in the order $[U_{\\max}, s_k, u_k^{\\text{sat}}, i_{k+1}]$. For example, the format must be like:\n$$\n[\\,[U_{\\max}^{(1)}, s_k^{(1)}, u_{k,\\text{sat}}^{(1)}, i_{k+1}^{(1)}],\\,\\ldots,\\,[U_{\\max}^{(5)}, s_k^{(5)}, u_{k,\\text{sat}}^{(5)}, i_{k+1}^{(5)}]\\,].\n$$",
            "solution": "The feasible command bound arises by requiring the per-phase modulator input to remain within its limits for all angles. The normalized modulator input is $m(\\theta) = M\\big(\\sin(\\theta) + \\beta \\sin(3\\theta)\\big)$ and feasibility demands $|m(\\theta)| \\le M_{\\text{lim}}$ for all $\\theta \\in \\mathbb{R}$. Therefore, the allowable fundamental amplitude must satisfy\n$$\nM \\le \\frac{M_{\\text{lim}}}{\\sup_{\\theta \\in \\mathbb{R}} \\left|\\sin(\\theta) + \\beta \\sin(3\\theta)\\right|}.\n$$\nDefine\n$$\nS(\\beta) \\triangleq \\sup_{\\theta \\in \\mathbb{R}} \\left|\\sin(\\theta) + \\beta \\sin(3\\theta)\\right|.\n$$\nThen the universal anti-windup bound becomes\n$$\nU_{\\max} = \\frac{M_{\\text{lim}}}{S(\\beta)}.\n$$\n\nTo compute $S(\\beta)$ from first principles, we leverage the trigonometric triple-angle identity, which is a well-tested formula:\n$$\n\\sin(3\\theta) = 3\\sin(\\theta) - 4\\sin^3(\\theta).\n$$\nSubstituting this into $S(\\beta)$ yields\n$$\n\\sin(\\theta) + \\beta \\sin(3\\theta) = \\sin(\\theta)\\left(1 + 3\\beta\\right) - 4\\beta \\sin^3(\\theta).\n$$\nLet $y = \\sin(\\theta)$, so that $y \\in [-1,1]$. Define the cubic polynomial\n$$\ng(y) = y\\left(1 + 3\\beta\\right) - 4\\beta y^3,\n$$\nand note that\n$$\nS(\\beta) = \\sup_{y \\in [-1,1]} |g(y)|.\n$$\nThe extrema of $g(y)$ on $[-1,1]$ occur at stationary points inside the interval or at the boundaries $y = \\pm 1$. The derivative is\n$$\ng'(y) = \\left(1 + 3\\beta\\right) - 12\\beta y^2.\n$$\nStationary points $y^\\star$ satisfy\n$$\ny^{\\star 2} = \\frac{1 + 3\\beta}{12\\beta},\n$$\nprovided $\\beta \\ne 0$ and the right-hand side is nonnegative. The feasible stationary points therefore are\n$$\ny^\\star = \\pm \\sqrt{\\frac{1 + 3\\beta}{12\\beta}},\n$$\nwhenever $\\frac{1 + 3\\beta}{12\\beta} \\in [0,1]$. Otherwise, the extrema lie at the boundaries $y = \\pm 1$. For $\\beta = 0$, the function reduces to $g(y) = y$ and the supremum is trivially $S(0) = 1$.\n\nConsequently, to compute $S(\\beta)$ robustly:\n- If $\\beta = 0$, then $S(\\beta) = 1$.\n- Else compute $y^2 = \\frac{1 + 3\\beta}{12\\beta}$, and if $y^2 \\in [0,1]$, include $y^\\star = \\pm \\sqrt{y^2}$ as candidates; otherwise, rely on boundary candidates $y = \\pm 1$.\n- Evaluate $|g(y)|$ at all candidates and take the maximum.\n\nWith $U_{\\max}$ determined, the anti-windup PI controller computes the unsaturated control\n$$\nu_k^{\\text{unsat}} = K_p e_k + i_k,\n$$\nand applies saturation\n$$\nu_k^{\\text{sat}} = \\begin{cases}\n-U_{\\max}, & \\text{if } u_k^{\\text{unsat}} < -U_{\\max},\\\\\nu_k^{\\text{unsat}}, & \\text{if } -U_{\\max} \\le u_k^{\\text{unsat}} \\le U_{\\max},\\\\\nU_{\\max}, & \\text{if } u_k^{\\text{unsat}} > U_{\\max}.\n\\end{cases}\n$$\nThe saturation flag is $s_k = 1$ when $u_k^{\\text{unsat}} \\ne u_k^{\\text{sat}}$ and $s_k = 0$ otherwise.\n\nFor anti-windup, the integrator is updated using back-calculation. The rationale is that when the actuator saturates, the effective control applied is $u_k^{\\text{sat}}$, not $u_k^{\\text{unsat}}$. Allowing the integrator to continue accumulating the mismatch would lead to windup. To prevent this, the integrator dynamics are corrected by feeding back the difference between the applied control and the unsaturated command. A common, well-tested structure for discrete-time anti-windup is\n$$\ni_{k+1} = i_k + K_i T_s e_k + K_{\\text{aw}}\\left(u_k^{\\text{sat}} - u_k^{\\text{unsat}}\\right),\n$$\nwhere $K_{\\text{aw}} \\ge 0$ is selected to set the rate at which the integrator state is reconciled with saturation. This expression is derived from the principle that the integrator should mirror the behavior of the control actually applied to the plant; hence, the correction term nullifies accumulation when the command saturates.\n\nAlgorithm summary for each test case:\n1. Given $\\beta$ and $M_{\\text{lim}}$, compute $S(\\beta)$ via candidate evaluation described above, then $U_{\\max} = M_{\\text{lim}}/S(\\beta)$.\n2. Compute $u_k^{\\text{unsat}} = K_p e_k + i_k$.\n3. Saturate: $u_k^{\\text{sat}} = \\operatorname{clip}\\left(u_k^{\\text{unsat}}, -U_{\\max}, U_{\\max}\\right)$.\n4. Flag: $s_k = 1$ if $u_k^{\\text{unsat}} \\ne u_k^{\\text{sat}}$ else $0$.\n5. Update integrator: $i_{k+1} = i_k + K_i T_s e_k + K_{\\text{aw}}\\left(u_k^{\\text{sat}} - u_k^{\\text{unsat}}\\right)$.\n\nThis procedure is applied independently to each test case. The final program outputs a single line containing the list of results $[U_{\\max}, s_k, u_k^{\\text{sat}}, i_{k+1}]$ for all test cases in the specified format. All angles are in radians. All quantities are dimensionless and normalized, so no physical units are required in the output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_S_beta(beta: float) -> float:\n    \"\"\"\n    Compute S(beta) = sup_{theta} |sin(theta) + beta * sin(3 theta)|\n    using the triple-angle identity and analytic candidate evaluation.\n    \"\"\"\n    # Handle the special case beta == 0\n    if np.isclose(beta, 0.0):\n        return 1.0\n\n    # Define g(y) = y*(1 + 3*beta) - 4*beta*y^3, with y in [-1, 1]\n    def g(y):\n        return y * (1.0 + 3.0 * beta) - 4.0 * beta * (y ** 3)\n\n    candidates = [-1.0, 1.0]\n\n    # Compute stationary point candidates y^2 = (1+3*beta)/(12*beta)\n    denom = 12.0 * beta\n    numer = 1.0 + 3.0 * beta\n    y2 = numer / denom\n\n    # Include stationary points if valid and within [-1,1]\n    if y2 >= 0.0:\n        y_star = np.sqrt(y2)\n        if y_star <= 1.0:\n            candidates.extend([y_star, -y_star])\n\n    # Evaluate absolute values of g(y) at candidates\n    values = [abs(g(y)) for y in candidates]\n    S = max(values)\n    # Numerical safety: ensure S is positive\n    if S <= 0.0:\n        # Fallback to a dense sampling if something went wrong\n        thetas = np.linspace(0.0, 2.0 * np.pi, 10001)\n        vals = np.abs(np.sin(thetas) + beta * np.sin(3.0 * thetas))\n        S = float(np.max(vals))\n    return float(S)\n\ndef anti_windup_PI(beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw):\n    \"\"\"\n    For given parameters, compute U_max, saturation flag s_k,\n    saturated control u_sat, and next integrator state i_{k+1}.\n    \"\"\"\n    # Compute S(beta) and U_max\n    S_beta = compute_S_beta(beta)\n    U_max = M_lim / S_beta\n\n    # PI unsaturated output\n    u_unsat = Kp * e_k + i_k\n\n    # Saturate to [-U_max, U_max]\n    u_sat = max(-U_max, min(U_max, u_unsat))\n\n    # Saturation flag\n    s_k = 1 if not np.isclose(u_unsat, u_sat) else 0\n\n    # Anti-windup integrator update\n    i_next = i_k + Ki * Ts * e_k + K_aw * (u_sat - u_unsat)\n\n    return [U_max, s_k, u_sat, i_next]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw)\n    test_cases = [\n        (1.0/6.0, 1.0, 0.5, 100.0, 1.0e-4, 2.0e-2, 0.0, 5000.0),\n        (1.0/6.0, 1.0, 1.0, 50.0, 1.0e-4, 1.2, 0.1, 2000.0),\n        (0.0, 1.0, 0.2, 200.0, 5.0e-5, 6.0, 0.0, 3000.0),\n        (-0.1, 1.0, 0.4, 120.0, 2.0e-4, -3.0, 0.5, 1000.0),\n        (0.25, 0.9, 0.8, 80.0, 1.0e-4, 1.3, -0.5, 1500.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw = case\n        result = anti_windup_PI(beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Ensure floats are printed in a standard Python representation.\n    print(f\"[{','.join([str(r) for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}