{
    "hands_on_practices": [
        {
            "introduction": "从连续时间域的理论到数字域的实现是现代电机控制系统设计的关键一步。本练习将指导您使用双线性变换（Tustin 变换）来离散化一个标准的比例积分（PI）控制器。通过分析数字实现中固有的计算延迟所带来的影响，您将推导出系统可实现带宽的根本限制，这是设计高性能驱动器时必须掌握的一项关键技能。",
            "id": "3837809",
            "problem": "在磁场定向控制（FOC）中，永磁同步电机（PMSM）的相电流内环经过解耦和反电动势前馈补偿后，其电气动态特性可以由 $L \\,\\frac{di(t)}{dt} + R\\, i(t) = v(t)$ 建模，其中 $i(t)$ 是相电流，$v(t)$ 是施加的相电压。从控制电压到电流的被控对象传递函数为 $G_{p}(s) = \\frac{1}{L s + R}$。一个数字比例积分（PI）控制器 $C(s) = K_{p} + \\frac{K_{i}}{s}$ 通过采样周期为 $T_{s}$ 的双线性变换（BT）（也称为 Tustin 变换）来实现。数字控制回路引入了一个建模为 $z^{-1}$ 的单样本计算延迟。假设通过选择 $\\omega_{i} \\equiv \\frac{K_{i}}{K_{p}} = \\frac{R}{L}$ 来放置控制器零点以抵消被控对象的极点。\n\n给定 $L = 1.5 \\times 10^{-3} \\,\\text{H}$，$R = 0.2 \\,\\Omega$ 和 $T_{s} = 100 \\,\\mu\\text{s}$，完成以下任务：\n\n1. 从 $C(s) = K_{p} + \\frac{K_{i}}{s}$ 和双线性变换映射 $s \\mapsto \\frac{2}{T_{s}} \\frac{1 - z^{-1}}{1 + z^{-1}}$ 出发，推导 PI 控制器的离散时间实现，形式为一个关联 $u[k]$ 和 $e[k]$ 的因果差分方程，其中 $u[k]$ 是控制输出，$e[k]$ 是在第 $k$ 个采样点的电流误差。\n\n2. 在前向通路中将单样本延迟建模为 $z^{-1}$，并在单位圆 $z = \\exp(j \\omega T_{s})$ 上使用频域分析来确定可实现的最大闭环带宽 $\\omega_{b}^{\\max}$，要求相位裕度至少为 60 度。在推导过程中，所有角度必须使用弧度。在指定的零极点对消条件下，将 PI 控制器与被控对象的组合在穿越频率附近视为一个有效的开环积分器，并考虑单样本延迟的相位效应。\n\n以 $\\text{rad}\\,\\text{s}^{-1}$ 为单位表示最终带宽，并将您的答案四舍五入到四位有效数字。",
            "solution": "该问题被验证为科学上合理、提法得当，并包含足够的信息以推导出唯一解。\n\n### 第 1 部分：PI 控制器差分方程的推导\n\n比例积分（PI）控制器的连续时间传递函数由下式给出：\n$$\nC(s) = \\frac{U(s)}{E(s)} = K_{p} + \\frac{K_{i}}{s}\n$$\n其中 $E(s)$ 是误差信号 $e(t)$ 的拉普拉斯变换，$U(s)$ 是控制输出 $u(t)$ 的拉普拉斯变换。这可以分为比例部分 $U_p(s) = K_p E(s)$ 和积分部分 $U_i(s) = \\frac{K_i}{s} E(s)$。\n\n为了获得离散时间实现，我们使用双线性变换（BT），也称为 Tustin 变换。BT 映射如下所示：\n$$\ns \\mapsto \\frac{2}{T_{s}} \\frac{1 - z^{-1}}{1 + z^{-1}}\n$$\n其中 $T_s$ 是采样周期。\n\n比例部分纯粹是一个增益，因此在离散域中，它仍然是 $U_p(z) = K_p E(z)$。\n\n积分部分需要将积分项 $\\frac{1}{s}$ 离散化。将双线性变换应用于积分器，得到：\n$$\n\\frac{1}{s} \\mapsto \\frac{1}{\\frac{2}{T_{s}} \\frac{1 - z^{-1}}{1 + z^{-1}}} = \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}}\n$$\n因此，控制器积分部分的 z 变换为：\n$$\nU_i(z) = K_i \\left( \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}} \\right) E(z)\n$$\n完整的离散时间控制器传递函数 $C(z) = \\frac{U(z)}{E(z)}$ 是比例部分和积分部分之和：\n$$\n\\frac{U(z)}{E(z)} = K_p + K_i \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}}\n$$\n为了找到差分方程，我们用 $U(z)$ 和 $E(z)$ 来表示这个关系：\n$$\nU(z) = \\left( K_p + K_i \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}} \\right) E(z)\n$$\n两边同乘以 $(1 - z^{-1})$ 以消去分母：\n$$\nU(z)(1 - z^{-1}) = \\left( K_p(1 - z^{-1}) + K_i \\frac{T_s}{2}(1 + z^{-1}) \\right) E(z)\n$$\n展开各项：\n$$\nU(z) - z^{-1}U(z) = \\left( K_p - K_p z^{-1} + K_i \\frac{T_s}{2} + K_i \\frac{T_s}{2} z^{-1} \\right) E(z)\n$$\n按 $z^{-1}$ 的幂次对各项进行分组：\n$$\nU(z) - z^{-1}U(z) = \\left( K_p + K_i \\frac{T_s}{2} \\right) E(z) + \\left( -K_p + K_i \\frac{T_s}{2} \\right) z^{-1}E(z)\n$$\nz 逆变换（$z^{-k}X(z) \\leftrightarrow x[n-k]$）得到了关联当前输出 $u[k]$ 与过去输出 $u[k-1]$ 以及当前和过去误差样本 $e[k]$ 和 $e[k-1]$ 的差分方程：\n$$\nu[k] - u[k-1] = \\left( K_p + K_i \\frac{T_s}{2} \\right) e[k] - \\left( K_p - K_i \\frac{T_s}{2} \\right) e[k-1]\n$$\n重新整理以求解 $u[k]$，我们得到因果差分方程：\n$$\nu[k] = u[k-1] + \\left( K_p + \\frac{K_i T_s}{2} \\right) e[k] - \\left( K_p - \\frac{K_i T_s}{2} \\right) e[k-1]\n$$\n这个方程代表了 PI 控制器的离散时间实现。问题指定了零极点对消条件 $\\frac{K_i}{K_p} = \\frac{R}{L}$。将 $K_i = K_p \\frac{R}{L}$ 代入该方程，得到：\n$$\nu[k] = u[k-1] + K_p \\left(1 + \\frac{R T_s}{2 L}\\right) e[k] - K_p \\left(1 - \\frac{R T_s}{2 L}\\right) e[k-1]\n$$\n\n### 第 2 部分：最大闭环带宽计算\n\n问题要求我们确定在保持至少 60 度相位裕度（PM）的情况下，可实现的最大闭环带宽 $\\omega_b^{\\max}$。\n\n开环系统由 PI 控制器、被控对象和单样本计算延迟组成。\n被控对象的传递函数为 $G_p(s) = \\frac{1}{Ls+R} = \\frac{1/L}{s+R/L}$。\nPI 控制器的传递函数为 $C(s) = K_p + \\frac{K_i}{s} = K_p \\frac{s + K_i/K_p}{s}$。\n问题指导我们使用零极点对消策略，即控制器零点 $s = -K_i/K_p$ 抵消被控对象极点 $s = -R/L$。这意味着设置 $K_i/K_p = R/L$。\n\n控制器和被控对象在连续域中的组合传递函数为：\n$$\nC(s) G_p(s) = \\left(K_p \\frac{s+R/L}{s}\\right) \\left(\\frac{1/L}{s+R/L}\\right) = \\frac{K_p/L}{s}\n$$\n问题指示我们将此补偿后的系统视为一个“有效积分器”。数字控制回路还引入了一个建模为 $z^{-1}$ 的单样本计算延迟。\n\n为了进行频域分析，我们在单位圆 $z = \\exp(j \\omega T_s)$ 上评估系统。总开环系统的频率响应是有效积分器和延迟的频率响应的乘积。\n有效积分器 $\\frac{K_p/L}{s}$ 在频率 $\\omega$ 处的频率响应为 $\\frac{K_p/L}{j\\omega}$。其幅值为 $\\frac{K_p}{L\\omega}$，相位为恒定的 $-\\frac{\\pi}{2}$ 弧度。\n单样本延迟 $z^{-1}$ 的频率响应为 $\\exp(-j\\omega T_s)$。其幅值为 1，相位为 $-\\omega T_s$ 弧度。\n\n因此，总开环频率响应 $G_{ol}(j\\omega)$ 近似为：\n$$\nG_{ol}(j\\omega) \\approx \\frac{K_p/L}{j\\omega} \\exp(-j\\omega T_s)\n$$\n开环系统的相位是积分器和延迟的相位之和：\n$$\n\\angle G_{ol}(j\\omega) = -\\frac{\\pi}{2} - \\omega T_s\n$$\n相位裕度（PM）定义在增益交越频率 $\\omega_{gc}$ 处，在该频率下 $|G_{ol}(j\\omega_{gc})| = 1$。相位裕度由下式给出：\n$$\n\\text{PM} = \\pi + \\angle G_{ol}(j\\omega_{gc}) = \\pi + \\left( -\\frac{\\pi}{2} - \\omega_{gc} T_s \\right) = \\frac{\\pi}{2} - \\omega_{gc} T_s\n$$\n问题要求相位裕度至少为 $60^\\circ$，即 $\\frac{\\pi}{3}$ 弧度。\n$$\n\\text{PM} \\ge \\frac{\\pi}{3} \\implies \\frac{\\pi}{2} - \\omega_{gc} T_s \\ge \\frac{\\pi}{3}\n$$\n求解 $\\omega_{gc} T_s$：\n$$\n\\omega_{gc} T_s \\le \\frac{\\pi}{2} - \\frac{\\pi}{3} = \\frac{3\\pi - 2\\pi}{6} = \\frac{\\pi}{6}\n$$\n这个不等式设定了可实现的增益交越频率的上限。为了最大化带宽，我们在这个极限条件下运行：\n$$\n\\omega_{gc}^{\\max} = \\frac{\\pi}{6 T_s}\n$$\n对于一个具有良好阻尼的系统（$60^\\circ$ 的相位裕度可确保这一点），闭环 $-3\\,\\text{dB}$ 带宽 $\\omega_b$ 与增益交越频率 $\\omega_{gc}$ 非常接近。因此，我们可以说，可实现的最大闭环带宽为 $\\omega_b^{\\max} \\approx \\omega_{gc}^{\\max}$。\n\n给定采样周期 $T_s = 100 \\,\\mu\\text{s} = 1.0 \\times 10^{-4} \\,\\text{s}$，我们可以计算其数值：\n$$\n\\omega_b^{\\max} \\approx \\frac{\\pi}{6 \\times (1.0 \\times 10^{-4} \\,\\text{s})} = \\frac{\\pi}{6} \\times 10^4 \\,\\text{rad}\\,\\text{s}^{-1}\n$$\n$$\n\\omega_b^{\\max} \\approx (0.5235987...) \\times 10^4 \\,\\text{rad}\\,\\text{s}^{-1} \\approx 5235.987... \\,\\text{rad}\\,\\text{s}^{-1}\n$$\n按要求将结果四舍五入到四位有效数字：\n$$\n\\omega_b^{\\max} \\approx 5236 \\,\\text{rad}\\,\\text{s}^{-1}\n$$\n$L = 1.5 \\times 10^{-3} \\,\\text{H}$ 和 $R = 0.2 \\,\\Omega$ 的值对于证明零极点对消方法的合理性是必要的，但带宽计算本身并不直接需要它们，因为它仅取决于 $T_s$ 和所需的相位裕度。",
            "answer": "$$\n\\boxed{5236}\n$$"
        },
        {
            "introduction": "控制器会产生一个理想的连续电压指令，但逆变器本身只能输出一组离散的电压矢量。空间矢量调制（SVM）是一种先进的开关技术，它能够在一个开关周期内合成出等效的平均电压。本实践将要求您从基本原理出发，实现一个完整的 SVM 算法，不仅需要优化开关序列以减少开关损耗，还要量化由此产生的共模电压——这是电机驱动系统中的一个核心实践问题。",
            "id": "3837777",
            "problem": "给定一个采用空间矢量调制 (SVM) 驱动电机的两电平三相电压源逆变器 (VSI)。逆变器桥臂被建模为连接到电压为 $V_{\\mathrm{dc}}$ 的直流 (DC) 母线上的理想开关。每个桥臂 $x \\in \\{a,b,c\\}$ 具有一个二进制开关状态 $S_x \\in \\{0,1\\}$，其中 $S_x=1$ 表示上管导通，$S_x=0$ 表示下管导通。桥臂中点相对于直流母线中点的电压为 $v_{xN} = (2 S_x - 1)\\, V_{\\mathrm{dc}}/2$。相对于电机星形接线中点的相端电压 $v_a$、$v_b$ 和 $v_c$ 满足 $v_x = v_{xN} - v_{\\mathrm{cm}}$，其中共模电压 $v_{\\mathrm{cm}}$ 定义为 $v_{\\mathrm{cm}} = (v_{aN} + v_{bN} + v_{cN})/3$。\n\n您的任务是，在一个开关周期内，根据期望的定子电压空间矢量轨迹，计算出一个能最小化总开关转换次数的开关序列，并量化由此产生的共模电压。该轨迹由空间矢量幅值 $V_{\\mathrm{ref}}$ 和电角度 $\\theta$ (以弧度为单位) 指定；直流母线电压 $V_{\\mathrm{dc}}$ 和开关周期 $T_s$ 也已给出。初始条件是逆变器上一个周期的结束状态 $s_{\\mathrm{prev}}$，它通过映射关系 $s = 4 S_a + 2 S_b + S_c$ 编码为一个整数 $s \\in \\{0,1,2,\\dots,7\\}$，其中 $S_a$、$S_b$ 和 $S_c$ 分别是 a、b、c 三相的桥臂状态。\n\n需使用的基本原理和约束：\n- Clarke 变换和空间矢量表示法将三相电压简化为 $\\alpha\\beta$ 平面上的一个矢量。可行的逆变器空间矢量包括六个幅值相等、角度相差 $ \\pi/3 $ 弧度的非零有效矢量，以及位于原点的两个零矢量。\n- 在一个开关周期 $T_s$ 内，通过在两个相邻的有效矢量以及可能的一个零矢量上驻留，来合成期望的平均参考矢量。设扇区为两个相邻有效矢量之间的角度范围。对于一个角度 $\\theta$ 位于某扇区内的期望矢量 $V_{\\mathrm{ref}}$，其相邻有效矢量的两个驻留时间 $T_1$ 和 $T_2$ 以及剩余的零矢量时间 $T_0=T_s - T_1 - T_2$ 必须通过在 $\\alpha\\beta$ 平面中解析矢量平均方程，从第一性原理推导得出。推导过程中不得使用任何捷径或预制表格公式；您必须基于上文所述的几何关系和桥臂电压模型进行推导。\n- 每个开关状态期间的共模电压水平必须由 $v_{\\mathrm{cm}} = (v_{aN} + v_{bN} + v_{cN})/3$ 确定。您必须将开关周期内的共模电压均方根 (RMS) 值量化为 $V_{\\mathrm{cm,RMS}} = \\sqrt{\\left( \\sum_i t_i\\, v_{\\mathrm{cm},i}^2\\right) / T_s }$，其中 $t_i$ 和 $v_{\\mathrm{cm},i}$ 分别是第 $i$ 个子区间的驻留时间和共模电压。\n- 一个周期内的开关序列被限制为按顺序排列的四个子区间：从一个零矢量开始，然后驻留于第一个有效矢量，接着是第二个有效矢量，最后以一个零矢量结束。这两个有效矢量必须是已确定扇区中的相邻矢量。零矢量可以是 $s=0$ (所有下管导通) 或 $s=7$ (所有上管导通)。总的零矢量驻留时间 $T_0$ 必须在开始和结束时平均分配，因此每个零矢量子区间的持续时间为 $T_0/2$。在所有通过选择起始和结束零矢量以及两个有效矢量的顺序而形成的候选序列中，选择总开关转换次数最少的一个。总转换次数是周期内所有连续状态对（包括从上一个结束状态 $s_{\\mathrm{prev}}$ 到起始零矢量的转换）的三个桥臂状态位之间的汉明距离之和。\n- 角度必须以弧度为单位。所有电压答案必须以伏特为单位，时间以秒为单位。\n\n测试套件和要求输出：\n- 实现一个程序，对于每个测试用例 $(V_{\\mathrm{dc}}, T_s, V_{\\mathrm{ref}}, \\theta, s_{\\mathrm{prev}})$，计算：\n    1) 使用编码 $s = 4 S_a + 2 S_b + S_c$ 的所选四状态开关序列，表示为一个整数列表 $[s_1,s_2,s_3,s_4]$，以及\n    2) 开关周期内的共模电压均方根值 $V_{\\mathrm{cm,RMS}}$ (以伏特为单位)。\n- 使用以下测试用例，每个元组为 $(V_{\\mathrm{dc}}, T_s, V_{\\mathrm{ref}}, \\theta, s_{\\mathrm{prev}})$：\n    1) $(600,\\; 1.0\\times 10^{-4},\\; 200,\\; 0.3,\\; 0)$,\n    2) $(600,\\; 1.0\\times 10^{-4},\\; 330,\\; \\pi/3 - 10^{-6},\\; 7)$,\n    3) $(600,\\; 1.0\\times 10^{-4},\\; 1,\\; 2.0,\\; 3)$,\n    4) $(600,\\; 1.0\\times 10^{-4},\\; 340,\\; 4.2,\\; 2)$.\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，每个结果是一个双元素列表 $[\\,[s_1,s_2,s_3,s_4],\\; V_{\\mathrm{cm,RMS}}\\,]$。例如：$[[[s_1,s_2,s_3,s_4],V_1],[[...],V_2],...]$。数值必须是浮点数或整数，RMS 值以伏特表示。\n\n您的实现必须是完全自包含的，不得读取任何输入，也不得使用任何外部文件或网络访问。推导必须基于上文所述的桥臂电压模型和空间矢量几何，并且必须避免使用问题陈述中的捷径公式。",
            "solution": "所提供的问题是有效的，因为它科学地基于电力电子学和电机控制的原理，特别是空间矢量调制 (SVM)。该问题是适定的、客观的，并包含推导唯一解所需的所有信息。数值在电压源逆变器驱动系统的实际范围内。我将进行完整的推导和求解。\n\n求解过程包括以下几个步骤：\n1.  根据给定的桥臂电压模型推导逆变器的空间电压矢量。\n2.  从第一性原理推导 SVM 算法的驻留时间。\n3.  构建优化问题以选择最小化开关转换的开关序列。\n4.  推导均方根 (RMS) 共模电压。\n5.  将此方法应用于所提供的测试用例。\n\n**1. 逆变器空间矢量**\n\n一个两电平三相逆变器有 $2^3 = 8$ 种可能的开关状态，由三元组 $(S_a, S_b, S_c)$ 定义，其中 $S_x \\in \\{0, 1\\}$。状态通过整数 $s = 4S_a + 2S_b + S_c$ 进行编码。每个桥臂的中点相对于直流母线中点的电压由 $v_{xN} = (S_x - 1/2)V_{\\mathrm{dc}}$ 给出。\n\n使用等幅值 Clarke 变换将三相电压转换为二维空间矢量 $\\mathbf{v} = v_\\alpha + j v_\\beta$：\n$$ v_\\alpha = \\frac{2}{3}(v_{aN} - \\frac{1}{2}v_{bN} - \\frac{1}{2}v_{cN}) $$\n$$ v_\\beta = \\frac{2}{3}\\frac{\\sqrt{3}}{2}(v_{bN} - v_{cN}) = \\frac{1}{\\sqrt{3}}(v_{bN} - v_{cN}) $$\n代入 $v_{xN}$ 的表达式：\n$$ v_\\alpha = \\frac{2}{3} V_{\\mathrm{dc}} \\left[ (S_a - \\frac{1}{2}) - \\frac{1}{2}(S_b - \\frac{1}{2}) - \\frac{1}{2}(S_c - \\frac{1}{2}) \\right] = \\frac{V_{\\mathrm{dc}}}{3} (2S_a - S_b - S_c) $$\n$$ v_\\beta = \\frac{V_{\\mathrm{dc}}}{\\sqrt{3}} \\left[ (S_b - \\frac{1}{2}) - (S_c - \\frac{1}{2}) \\right] = \\frac{V_{\\mathrm{dc}}}{\\sqrt{3}} (S_b - S_c) $$\n使用这些公式，8 个状态产生 8 个电压矢量。状态 $s=0$ $(000)$ 和 $s=7$ $(111)$ 产生零矢量 ($\\mathbf{V}_0 = \\mathbf{V}_7 = 0$)。其他 6 个状态产生幅值为 $\\frac{2}{3}V_{\\mathrm{dc}}$ 的有效矢量，角度相差 $\\pi/3$ 弧度，在 $\\alpha\\beta$ 平面内形成一个六边形。标准的有效矢量及其对应的状态是：\n- $\\mathbf{V}_1$ (状态 $s=4, 100$): 角度 $0$\n- $\\mathbf{V}_2$ (状态 $s=6, 110$): 角度 $\\pi/3$\n- $\\mathbf{V}_3$ (状态 $s=2, 010$): 角度 $2\\pi/3$\n- $\\mathbf{V}_4$ (状态 $s=3, 011$): 角度 $\\pi$\n- $\\mathbf{V}_5$ (状态 $s=1, 001$): 角度 $4\\pi/3$\n- $\\mathbf{V}_6$ (状态 $s=5, 101$): 角度 $5\\pi/3$\n\n**2. 从第一性原理推导驻留时间**\n\nSVM 通过在一个开关周期 $T_s$ 内对两个相邻的有效矢量和一个零矢量进行平均，来合成参考电压矢量 $\\mathbf{V}_{\\mathrm{ref}} = V_{\\mathrm{ref}} e^{j\\theta}$。其平均原理是：\n$$ \\mathbf{V}_{\\mathrm{ref}} = \\frac{1}{T_s}(T_1 \\mathbf{V}_k + T_2 \\mathbf{V}_{k+1} + T_0 \\mathbf{V}_{\\mathrm{zero}}) $$\n其中 $\\mathbf{V}_k$ 和 $\\mathbf{V}_{k+1}$ 是界定包含 $\\mathbf{V}_{\\mathrm{ref}}$ 的扇区的两个有效矢量，$T_1$ 和 $T_2$ 是它们各自的驻留时间。$T_0$ 是零矢量的总驻留时间。由于 $\\mathbf{V}_{\\mathrm{zero}}=0$，方程简化为 $T_s \\mathbf{V}_{\\mathrm{ref}} = T_1 \\mathbf{V}_k + T_2 \\mathbf{V}_{k+1}$。总时间受约束于 $T_s = T_1 + T_2 + T_0$。\n\n为了求解 $T_1$ 和 $T_2$，我们将矢量方程投影到一个正交基上。我们定义一个坐标系，其 u 轴与第一个有效矢量 $\\mathbf{V}_k$ 对齐。设扇区索引为 $k_{sec} \\in \\{0, \\dots, 5\\}$，使得 $\\mathbf{V}_{\\mathrm{ref}}$ 位于角度为 $k_{sec}\\pi/3$ 和 $(k_{sec}+1)\\pi/3$ 的矢量之间。$\\mathbf{V}_{\\mathrm{ref}}$ 在扇区内的角度是 $\\theta' = \\theta - k_{sec}\\pi/3$。\n在这个旋转坐标系中，矢量为：\n- $\\mathbf{V}_{\\mathrm{ref}}$: $(V_{\\mathrm{ref}} \\cos \\theta', V_{\\mathrm{ref}} \\sin \\theta')$\n- $\\mathbf{V}_k$: $(V_s, 0)$，其中 $V_s = \\frac{2}{3}V_{\\mathrm{dc}}$ 是有效矢量的幅值。\n- $\\mathbf{V}_{k+1}$: $(V_s \\cos(\\pi/3), V_s \\sin(\\pi/3)) = (V_s/2, V_s \\sqrt{3}/2)$\n\n矢量方程分解为两个标量方程：\n$$ T_s V_{\\mathrm{ref}} \\cos \\theta' = T_1 V_s + T_2 (V_s/2) $$\n$$ T_s V_{\\mathrm{ref}} \\sin \\theta' = T_2 (V_s \\sqrt{3}/2) $$\n从第二个方程，我们解出 $T_2$：\n$$ T_2 = \\frac{2 T_s V_{\\mathrm{ref}} \\sin \\theta'}{V_s \\sqrt{3}} = \\frac{2 T_s V_{\\mathrm{ref}} \\sin \\theta'}{(\\frac{2}{3}V_{\\mathrm{dc}}) \\sqrt{3}} = \\frac{\\sqrt{3} T_s V_{\\mathrm{ref}}}{V_{\\mathrm{dc}}} \\sin(\\theta') $$\n将 $T_2$ 代入第一个方程求得 $T_1$：\n$$ T_1 = \\frac{T_s V_{\\mathrm{ref}} \\cos \\theta'}{V_s} - \\frac{T_2}{2} = \\frac{T_s V_{\\mathrm{ref}}}{V_s} \\left( \\cos \\theta' - \\frac{\\sin \\theta'}{\\sqrt{3}} \\right) = \\frac{T_s V_{\\mathrm{ref}}}{V_s} \\frac{2}{\\sqrt{3}} \\sin(\\pi/3 - \\theta') $$\n$$ T_1 = \\frac{T_s V_{\\mathrm{ref}}}{(\\frac{2}{3}V_{\\mathrm{dc}})} \\frac{2}{\\sqrt{3}} \\sin(\\pi/3 - \\theta') = \\frac{\\sqrt{3} T_s V_{\\mathrm{ref}}}{V_{\\mathrm{dc}}} \\sin(\\pi/3 - \\theta') $$\n剩余时间为零矢量时间，$T_0 = T_s - T_1 - T_2$。如果 $V_{\\mathrm{ref}}$ 超出线性调制范围 ($T_1+T_2 > T_s$)，驻留时间将被按比例缩放以使它们的和为 $T_s$，从而导致 $T_0=0$。\n\n**3. 最优开关序列**\n\n开关序列结构化为四个段：零矢量、第一个有效矢量、第二个有效矢量、零矢量。总零矢量时间 $T_0$ 被平均分配，因此持续时间为 $(T_0/2, T_{act1}, T_{act2}, T_0/2)$。我们必须选择起始/结束零矢量 ($s_{z1}, s_{z2} \\in \\{0, 7\\}$) 以及有效矢量 ($s_{act1}, s_{act2}$) 的顺序，以最小化总开关转换次数。成本是从上一个状态 $s_{\\mathrm{prev}}$ 开始，连续状态之间汉明距离的总和：\n$$ \\mathrm{Cost} = H(s_{\\mathrm{prev}}, s_{z1}) + H(s_{z1}, s_{act1}) + H(s_{act1}, s_{act2}) + H(s_{act2}, s_{z2}) $$\n汉明距离 $H(s_i, s_j)$ 是 $s_i$ 和 $s_j$ 的二进制表示中不同位的数量。由于相邻的有效矢量仅相差一位，因此 $H(s_{act1}, s_{act2})=1$。对于每个工作点，通过选择 $s_{z1} \\in \\{0,7\\}$、$s_{z2} \\in \\{0,7\\}$ 以及有效矢量的顺序，可以形成 8 个候选序列。我们评估所有 8 个候选序列的成本，并选择成本最低的序列。\n\n**4. RMS 共模电压**\n\n开关状态 $s=(S_a,S_b,S_c)$ 的共模电压为：\n$$ v_{\\mathrm{cm}}(s) = \\frac{v_{aN} + v_{bN} + v_{cN}}{3} = \\frac{1}{3} \\sum_{x \\in \\{a,b,c\\}} (S_x - \\frac{1}{2})V_{\\mathrm{dc}} = \\frac{V_{\\mathrm{dc}}}{6} (2(S_a+S_b+S_c) - 3) $$\n设 $p(s) = S_a+S_b+S_c$ 为状态二进制表示中 1 的个数。则 $v_{\\mathrm{cm}}(s) = \\frac{V_{\\mathrm{dc}}}{6} (2p(s) - 3)$。$v_{\\mathrm{cm}}^2$ 的可能值为：\n- 零矢量 ($s=0, p=0$ 或 $s=7, p=3$)：$v_{\\mathrm{cm}}(0) = -V_{\\mathrm{dc}}/2$，$v_{\\mathrm{cm}}(7) = +V_{\\mathrm{dc}}/2$。所以 $v_{\\mathrm{cm}}^2 = V_{\\mathrm{dc}}^2/4$。\n- 有效矢量 ($p=1$ 或 $p=2$)：$v_{\\mathrm{cm}}(p=1)=-V_{\\mathrm{dc}}/6$，$v_{\\mathrm{cm}}(p=2)=+V_{\\mathrm{dc}}/6$。所以 $v_{\\mathrm{cm}}^2 = V_{\\mathrm{dc}}^2/36$。\n\n在持续时间为 $[T_0/2, T_{act1}, T_{act2}, T_0/2]$ 的四段周期 $[s_1, s_2, s_3, s_4]$ 内的 RMS 值为：\n$$ V_{\\mathrm{cm,RMS}}^2 = \\frac{1}{T_s} \\left[ \\frac{T_0}{2} v_{\\mathrm{cm}}(s_1)^2 + T_{act1} v_{\\mathrm{cm}}(s_2)^2 + T_{act2} v_{\\mathrm{cm}}(s_3)^2 + \\frac{T_0}{2} v_{\\mathrm{cm}}(s_4)^2 \\right] $$\n由于两个零矢量的共模电压平方值相同，且任何一对相邻有效矢量（一个有 $p=1$，另一个有 $p=2$）的共模电压平方值也相同，因此无论选择哪个序列，表达式都可以简化为：\n$$ V_{\\mathrm{cm,RMS}}^2 = \\frac{1}{T_s} \\left[ T_0 \\left(\\frac{V_{\\mathrm{dc}}^2}{4}\\right) + (T_1+T_2)\\left(\\frac{V_{\\mathrm{dc}}^2}{36}\\right) \\right] $$\n使用 $T_1+T_2 = T_s-T_0$：\n$$ V_{\\mathrm{cm,RMS}}^2 = \\frac{V_{\\mathrm{dc}}^2}{T_s} \\left[ \\frac{T_0}{4} + \\frac{T_s-T_0}{36} \\right] = \\frac{V_{\\mathrm{dc}}^2}{36 T_s} [9T_0 + T_s - T_0] = \\frac{V_{\\mathrm{dc}}^2}{36 T_s} [8T_0 + T_s] $$\n$$ V_{\\mathrm{cm,RMS}} = \\frac{V_{\\mathrm{dc}}}{6} \\sqrt{8 \\frac{T_0}{T_s} + 1} $$\n这表明 $V_{\\mathrm{cm,RMS}}$ 仅取决于直流母线电压和在零状态下度过的开关周期比例。\n\n**5. 算法与实现**\n\n每个测试用例的算法流程如下：\n1.  将输入角度 $\\theta$ 归一化到范围 $[0, 2\\pi)$ 内。\n2.  确定扇区索引 $k_{sec} = \\lfloor \\theta / (\\pi/3) \\rfloor$。\n3.  确定该扇区的两个相邻有效状态 $S_u$ 和 $S_v$。\n4.  计算扇区内的角度 $\\theta' = \\theta - k_{sec}\\pi/3$。\n5.  计算驻留时间 $T_1$ (对应 $S_u$) 和 $T_2$ (对应 $S_v$)。如果 $T_1+T_2 > T_s$，则通过按比例缩放使其和为 $T_s$ 来处理饱和情况。\n6.  计算总零矢量时间 $T_0 = T_s - T_1 - T_2$。\n7.  生成所有 8 个候选开关序列。对每个序列，计算总开关成本（汉明距离之和）。\n8.  选择成本最低的序列。如果出现平局，则选择找到的第一个。\n9.  使用最终的 $T_0$ 和推导出的公式计算 $V_{\\mathrm{cm,RMS}}$。\n10. 存储最优序列和计算出的 $V_{\\mathrm{cm,RMS}}$。\n此过程在提供的 Python 代码中实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the SVM problem for a two-level VSI for a given set of test cases.\n    It computes the optimal switching sequence and the RMS common-mode voltage.\n    \"\"\"\n\n    test_cases = [\n        (600, 1.0e-4, 200, 0.3, 0),\n        (600, 1.0e-4, 330, np.pi/3 - 1e-6, 7),\n        (600, 1.0e-4, 1, 2.0, 3),\n        (600, 1.0e-4, 340, 4.2, 2)\n    ]\n    \n    # Active voltage vectors states keyed by sector index (0-5)\n    # The states correspond to vectors at k*pi/3 and (k+1)*pi/3\n    active_states_by_sector = {\n        0: (4, 6),  # Sector 1: 0 to pi/3\n        1: (6, 2),  # Sector 2: pi/3 to 2pi/3\n        2: (2, 3),  # Sector 3: 2pi/3 to pi\n        3: (3, 1),  # Sector 4: pi to 4pi/3\n        4: (1, 5),  # Sector 5: 4pi/3 to 5pi/3\n        5: (5, 4)   # Sector 6: 5pi/3 to 2pi\n    }\n    \n    def hamming_distance(n1, n2):\n        \"\"\"Calculates the Hamming distance between two integers.\"\"\"\n        return bin(n1 ^ n2).count('1')\n\n    results = []\n    for V_dc, T_s, V_ref, theta, s_prev in test_cases:\n        # Step 1: Normalize angle and find sector\n        theta_norm = np.fmod(theta, 2 * np.pi)\n        if theta_norm  0:\n            theta_norm += 2 * np.pi\n        \n        # Handle edge case where theta is exactly 2*pi\n        if np.isclose(theta_norm, 2 * np.pi):\n            sector_idx = 0\n        else:\n            sector_idx = int(theta_norm / (np.pi / 3))\n\n        theta_prime = theta_norm - sector_idx * (np.pi / 3)\n\n        # Step 2: Calculate dwell times\n        # The constants are derived from the first-principles derivation\n        a = (np.sqrt(3) * T_s * V_ref) / V_dc\n        \n        # T1 is for the first vector of the sector, T2 for the second\n        T1 = a * np.sin(np.pi/3 - theta_prime)\n        T2 = a * np.sin(theta_prime)\n\n        # Step 3: Handle overmodulation (saturation)\n        if T1 + T2 > T_s:\n            T_total_active = T1 + T2\n            T1 = T1 * T_s / T_total_active\n            T2 = T2 * T_s / T_total_active\n        \n        T0 = T_s - (T1 + T2)\n        # Ensure T0 is not negative due to floating point inaccuracies\n        T0 = max(0, T0)\n\n        # Step 4: Find optimal switching sequence\n        S_u, S_v = active_states_by_sector[sector_idx]\n        zero_vectors = [0, 7]\n        best_sequence = []\n        min_cost = float('inf')\n\n        # There are 8 candidate sequences to check\n        # (start_zero, active_1, active_2, end_zero)\n        candidates = []\n        for z1 in zero_vectors:\n            for z2 in zero_vectors:\n                # Two possible orderings for active vectors\n                candidates.append((z1, S_u, S_v, z2))\n                candidates.append((z1, S_v, S_u, z2))\n\n        for seq in candidates:\n            s1, s2, s3, s4 = seq\n            cost = (hamming_distance(s_prev, s1) +\n                    hamming_distance(s1, s2) +\n                    hamming_distance(s2, s3) +\n                    hamming_distance(s3, s4))\n            \n            if cost  min_cost:\n                min_cost = cost\n                best_sequence = list(seq)\n        \n        # Step 5: Calculate RMS common-mode voltage\n        # V_cm_rms = (V_dc/6) * sqrt(8 * (T0/T_s) + 1)\n        V_cm_rms = (V_dc / 6.0) * np.sqrt(8 * (T0 / T_s) + 1)\n        \n        # Format the result for this test case\n        seq_str = '[' + ','.join(map(str, best_sequence)) + ']'\n        res_str = '[' + seq_str + ', ' + f'{V_cm_rms:.7f}' + ']'\n        results.append(res_str)\n\n    # Print a single line of output with all results\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理想线性世界中设计的控制器，终将面对有限直流母线电压的物理现实。本问题旨在研究当指令电压超过硬件极限时发生的逆变器过调制现象，及其对控制稳定性的影响。通过这项练习，您将学会如何前瞻性地设计控制器增益以适应硬件约束，从而确保系统即使在剧烈的暂态过程中也能保持稳定和可预测的性能。",
            "id": "3837749",
            "problem": "一台表贴式永磁同步电机（PMSM）在同步 $dq$ 坐标系中采用磁场定向控制（FOC）。$q$ 轴电流环路使用一个比例积分（PI）控制器来指令 $q$ 轴逆变器电压。电压源逆变器采用空间矢量脉宽调制（SVPWM）。假设交叉耦合项被完全补偿，并且应用了反电动势（EMF）前馈，使得控制器输出与一个等于反电动势的前馈项相加。逆变器被建模为一个幅值限制器，其线性调制区在 $dq$ 坐标系中可以产生的最大基波电压幅值为 $V_{\\text{lim}} = V_{\\text{dc}}/\\sqrt{3}$。超出此限制的过调制会引入非线性，降低电流环路所经历的有效低频增益，并可能在接近调制极限时使跟踪不稳定。\n\nPMSM 的 $q$ 轴动态（在 $i_{d} = 0$ 和精确交叉耦合补偿下）由经过充分验证的电气模型给出：$L \\, \\frac{d i_{q}}{d t} + R \\, i_{q} = v_{q} - \\omega_{e} \\, \\psi_{f}$，其中 $L$ 是定子电感，$R$ 是定子电阻，$\\omega_{e}$ 是电角速度，$\\psi_{f}$ 是永磁体磁链。PI 控制器产生一个指令调节电压 $v_{q}^{\\ast} = K_{p} \\, e_{q} + K_{i} \\int e_{q} \\, dt$，其中 $e_{q} = i_{q}^{\\text{ref}} - i_{q}$，该电压与前馈项 $+\\omega_{e} \\, \\psi_{f}$ 相加，形成逆变器参考矢量。每当指令 $dq$ 电压矢量的幅值超过 $V_{\\text{lim}}$ 时，逆变器就会饱和，即每当 $\\left\\| [v_{d}^{\\ast}, v_{q}^{\\ast} + \\omega_{e} \\, \\psi_{f}] \\right\\|  V_{\\text{lim}}$ 时。\n\n要求您分析过调制对电流跟踪的影响，并重新设计比例增益，以避免在最坏情况下的 $q$ 轴电流阶跃时进入非线性调制区。考虑以下工作点和参数：\n\n- 直流母线电压 $V_{\\text{dc}} = 540 \\ \\mathrm{V}$。\n- 线性调制极限 $V_{\\text{lim}} = V_{\\text{dc}} / \\sqrt{3}$。\n- 电角速度 $\\omega_{e} = 1200 \\ \\mathrm{rad/s}$。\n- 磁链 $\\psi_{f} = 0.12 \\ \\mathrm{Wb}$。\n- 定子电阻 $R = 0.2 \\ \\Omega$。\n- 定子电感 $L = 0.8 \\ \\mathrm{mH}$。\n- 初始条件 $i_{q}(0^{-}) = 0 \\ \\mathrm{A}$ 以及在 $t = 0^{+}$ 时从 $0 \\ \\mathrm{A}$ 到 $200 \\ \\mathrm{A}$ 的阶跃指令 $i_{q}^{\\text{ref}}$。\n- 整个过程中 $i_{d} \\equiv 0 \\ \\mathrm{A}$。\n\n从基本的 $q$ 轴电压方程和调制极限的定义出发，推导出一个比例增益 $K_{p}$ 的保守设计界限，该界限保证指令调节电压在阶跃瞬间严格保持在线性 SVPWM 区域内，从而使环路在最坏情况的暂态下不会遇到逆变器过调制。使用此界限为给定参数数值计算重新设计的比例增益 $K_{p}^{\\star}$。将您的答案四舍五入到三位有效数字，并以 $\\mathrm{V/A}$ 为单位表示。",
            "solution": "基本出发点是表贴式永磁同步电机（PMSM）在同步坐标系控制下，且 $i_{d} = 0$ 和精确交叉耦合补偿时的 $q$ 轴电压方程，这是一个经过充分验证的表达式：\n$$\nL \\, \\frac{d i_{q}}{d t} + R \\, i_{q} = v_{q} - \\omega_{e} \\, \\psi_{f}.\n$$\n在磁场定向控制（FOC）中，一个等于反电动势（EMF）$\\omega_{e} \\, \\psi_{f}$ 的前馈项通常与控制器输出相加，以线性化反馈控制器所看到的被控对象。设 PI 控制器的调节输出为\n$$\nv_{q}^{\\ast}(t) = K_{p} \\, e_{q}(t) + K_{i} \\int_{0}^{t} e_{q}(\\tau) \\, d\\tau,\n$$\n其中 $e_{q}(t) = i_{q}^{\\text{ref}}(t) - i_{q}(t)$。逆变器接收到的指令矢量的 $q$ 轴分量为 $v_{q}^{\\ast}(t) + \\omega_{e} \\, \\psi_{f}$。空间矢量脉宽调制（SVPWM）的线性区约束由幅值限制建模为\n$$\n\\left\\| [v_{d}^{\\ast}(t), \\, v_{q}^{\\ast}(t) + \\omega_{e} \\, \\psi_{f}] \\right\\| \\leq V_{\\text{lim}}, \\quad \\text{其中} \\quad V_{\\text{lim} }= \\frac{V_{\\text{dc}}}{\\sqrt{3}}.\n$$\n由于对于表贴式电机 $i_{d} \\equiv 0$ 且交叉耦合已补偿，我们有用于调节的 $v_{d}^{\\ast}(t) \\approx 0$。因此，幅值限制简化为标量约束\n$$\n|v_{q}^{\\ast}(t) + \\omega_{e} \\, \\psi_{f}| \\leq V_{\\text{lim}}.\n$$\n\n当指令幅值超过 $V_{\\text{lim}}$ 且逆变器削波时，就会发生过调制。从描述函数的角度来看，对于指令幅值 $A  V_{\\text{lim}}$，削波引入了一个与幅值相关的等效增益 $N(A) = V_{\\text{lim}}/A$，这会降低低频环路增益，扭曲相位，并可能使在线性假设下设计的电流环路变得不稳定。为了在最坏情况的暂态期间避免进入这个非线性区域，我们设计比例增益，使得初始调节指令在阶跃瞬间严格保持在线性区域内。\n\n在 $t = 0^{+}$ 时，对于一个初始条件为 $i_{q}(0^{-}) = 0$ 的阶跃 $i_{q}^{\\text{ref}} = \\Delta i_{q}$，瞬时误差为 $e_{q}(0^{+}) = \\Delta i_{q}$。积分器的状态尚未改变，因此初始调节输出主要由比例项决定：\n$$\nv_{q}^{\\ast}(0^{+}) \\approx K_{p} \\, \\Delta i_{q}.\n$$\n此外，在阶跃瞬间，$i_{q}(0^{+}) \\approx 0$，因此电阻压降 $R\\,i_{q}$ 尚未消耗电压裕度；反电动势前馈 $\\omega_{e} \\, \\psi_{f}$ 存在，并且是一个必须由逆变器提供的固定偏移量。因此，提供给逆变器的初始指令电压为\n$$\nv_{\\text{cmd}}(0^{+}) = v_{q}^{\\ast}(0^{+}) + \\omega_{e} \\, \\psi_{f} \\approx K_{p} \\, \\Delta i_{q} + \\omega_{e} \\, \\psi_{f}.\n$$\n为了在最坏情况的瞬间使逆变器严格保持在其线性 SVPWM 区域内，我们需要\n$$\n|K_{p} \\, \\Delta i_{q} + \\omega_{e} \\, \\psi_{f}| \\leq V_{\\text{lim}}.\n$$\n在这种情况下，所有量都是正的，所以可以去掉绝对值，保守界限变为\n$$\nK_{p} \\, \\Delta i_{q} + \\omega_{e} \\, \\psi_{f} \\leq V_{\\text{lim}} \\quad \\Rightarrow \\quad K_{p} \\leq \\frac{V_{\\text{lim}} - \\omega_{e} \\, \\psi_{f}}{\\Delta i_{q}}.\n$$\n因此，保证在阶跃时避免逆变器过调制的重新设计的比例增益为\n$$\nK_{p}^{\\star} = \\frac{V_{\\text{lim}} - \\omega_{e} \\, \\psi_{f}}{\\Delta i_{q}}.\n$$\n\n现在我们为给定参数计算 $K_{p}^{\\star}$。首先，计算线性 SVPWM 极限：\n$$\nV_{\\text{lim}} = \\frac{V_{\\text{dc}}}{\\sqrt{3}} = \\frac{540 \\ \\mathrm{V}}{\\sqrt{3}}.\n$$\n然后计算反电动势：\n$$\n\\omega_{e} \\, \\psi_{f} = 1200 \\ \\mathrm{rad/s} \\times 0.12 \\ \\mathrm{Wb} = 144 \\ \\mathrm{V}.\n$$\n最坏情况的阶跃幅值为\n$$\n\\Delta i_{q} = 200 \\ \\mathrm{A}.\n$$\n因此，\n$$\nK_{p}^{\\star} = \\frac{\\frac{540}{\\sqrt{3}} - 144}{200} \\ \\mathrm{\\frac{V}{A}}.\n$$\n计算分子：\n$$\n\\frac{540}{\\sqrt{3}} \\approx 311.769145362 \\ \\mathrm{V}, \\quad \\Rightarrow \\quad 311.769145362 - 144 = 167.769145362 \\ \\mathrm{V}.\n$$\n除以 $\\Delta i_{q}$：\n$$\nK_{p}^{\\star} \\approx \\frac{167.769145362}{200} = 0.83884572681 \\ \\mathrm{\\frac{V}{A}}.\n$$\n按要求四舍五入到三位有效数字，\n$$\nK_{p}^{\\star} \\approx 0.839 \\ \\mathrm{\\frac{V}{A}}.\n$$\n\n这种重新设计确保了在最坏情况的阶跃下，控制器保持在线性 SVPWM 区域内，从而防止了由过调制引起的削波所导致的有效环路增益下降和相位失真。通过这种方式限制 $K_{p}$，当其他工作条件瞬时接近极限时，可以对积分项采用标准的抗饱和反算方法以避免累加器饱和，但比例作用本身不会在指定的工作点将环路推入非线性区域。",
            "answer": "$$\\boxed{0.839}$$"
        }
    ]
}