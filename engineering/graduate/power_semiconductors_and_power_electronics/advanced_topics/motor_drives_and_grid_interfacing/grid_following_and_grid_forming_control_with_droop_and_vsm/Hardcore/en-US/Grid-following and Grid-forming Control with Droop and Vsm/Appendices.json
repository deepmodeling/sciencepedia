{
    "hands_on_practices": [
        {
            "introduction": "Before we can design effective controllers, we must first build a precise mathematical model of the physical system. This foundational exercise guides you through deriving the state-space representation of an inverter's LCL filter in the synchronous rotating ($dq$) frame. By applying first principles, this practice  reveals the essential dynamics and cross-coupling terms that any advanced controller must manage.",
            "id": "3844010",
            "problem": "Consider a balanced three-phase grid-tied voltage source inverter with an inductance-capacitance-inductance (LCL) filter. The converter-side inductor has inductance $L_1$ and series resistance $R_1$, the shunt filter capacitor has capacitance $C_f$, and the grid-side inductor has inductance $L_2$ and series resistance $R_2$. Assume negligible parasitics beyond $R_1$ and $R_2$. The filter is connected to an infinite bus modeled by a stiff Thevenin voltage source at the Point of Common Coupling (PCC), whose direct-quadrature (dq) components are denoted $v_{g,d}$ and $v_{g,q}$. The converter average bridge output voltage in the dq frame is the control input $\\mathbf{v}_{dq} = [v_{d}, v_{q}]^{\\top}$, produced either by a grid-following current controller synchronized via a Phase-Locked Loop (PLL) or by a grid-forming controller such as a Virtual Synchronous Machine (VSM) with frequency-voltage droop. The dq frame is defined by a Park transformation rotating at angular speed $\\omega$ aligned with the grid voltage angle so that the ideal grid voltage appears constant in dq.\n\nStarting from first principles appropriate to power electronics—Kirchhoff’s Voltage Law and Kirchhoff’s Current Law, the constitutive relations for inductors and capacitors ($v = L\\,di/dt + Ri$ and $i = C\\,dv/dt$), and the properties of the rotating dq transformation—derive the averaged dq-domain differential equations governing the converter-side inductor current, the capacitor voltage at the PCC, and the grid-side inductor current. Let the state vector be $\\mathbf{x} = [i_{1d},\\, i_{1q},\\, v_{cd},\\, v_{cq},\\, i_{2d},\\, i_{2q}]^{\\top}$, where $i_{1d}, i_{1q}$ are the converter-side inductor current components, $v_{cd}, v_{cq}$ are the capacitor voltage components at the PCC, and $i_{2d}, i_{2q}$ are the grid-side inductor current components. Express the system in compact state-space form $\\dot{\\mathbf{x}} = A \\mathbf{x} + B \\mathbf{u} + E \\mathbf{w}$ where $\\mathbf{u} = [v_{d}, v_{q}]^{\\top}$ and $\\mathbf{w} = [v_{g,d}, v_{g,q}]^{\\top}$. Use the canonical skew-symmetric matrix $J = \\begin{bmatrix} 0 & -1 \\\\ 1 & 0 \\end{bmatrix}$ to represent dq cross-coupling if helpful, and clearly identify how $\\omega$ enters the dynamics via the dq transformation.\n\nYour task is to perform the derivation and then assemble the $6 \\times 6$ state matrix $A$ explicitly in terms of $R_1$, $L_1$, $C_f$, $R_2$, $L_2$, and $\\omega$. Provide the final answer as the full $A$ matrix. No numerical values are required; keep the expression symbolic. The final answer must be a single closed-form analytic expression.",
            "solution": "The objective is to derive the averaged dq-domain model of the LCL filter connected between a controlled inverter and a stiff grid, then assemble the resulting state-space matrix $A$ in $\\dot{\\mathbf{x}} = A \\mathbf{x} + B \\mathbf{u} + E \\mathbf{w}$. The derivation proceeds from Kirchhoff’s Voltage Law (KVL), Kirchhoff’s Current Law (KCL), the constitutive relations for inductors and capacitors, and the transformation properties of the rotating dq frame.\n\nWe consider balanced three-phase quantities and work in the synchronous dq frame aligned to the grid voltage, rotating at angular speed $\\omega$. The Park transformation maps stationary two-axis variables $y_{\\alpha\\beta}$ into $y_{dq}$, and its time derivative introduces cross-coupling terms. For any dq vector $\\mathbf{y}_{dq} = [y_d, y_q]^{\\top}$, the relationship between physical dynamics and dq-domain derivatives is captured by\n$$\n\\frac{d}{dt} \\mathbf{y}_{dq} = \\left(\\text{physical derivative in stationary frame mapped to dq}\\right) - \\omega J \\mathbf{y}_{dq},\n$$\nwhere\n$$\nJ = \\begin{bmatrix} 0 & -1 \\\\ 1 & 0 \\end{bmatrix}.\n$$\nThis identity directly yields cross-coupling terms for energy storage elements when expressed in dq:\n\n1. Inductor constitutive law in the stationary frame is $v = L\\,\\frac{di}{dt} + R\\,i$. In dq,\n$$\n\\frac{d}{dt} \\mathbf{i}_{dq} = \\frac{1}{L}\\left(\\mathbf{v}_{dq} - R\\,\\mathbf{i}_{dq}\\right) - \\omega J\\,\\mathbf{i}_{dq}.\n$$\n\n2. Capacitor constitutive law in the stationary frame is $i = C\\,\\frac{dv}{dt}$. In dq,\n$$\n\\frac{d}{dt} \\mathbf{v}_{dq} = \\frac{1}{C} \\mathbf{i}_{dq} - \\omega J\\,\\mathbf{v}_{dq}.\n$$\n\nWe apply these to each element of the LCL filter. Let $\\mathbf{v}_{dq} = [v_d, v_q]^{\\top}$ denote the average converter bridge output voltage in dq, $\\mathbf{v}_{c,dq} = [v_{cd}, v_{cq}]^{\\top}$ the PCC capacitor voltage, and $\\mathbf{v}_{g,dq} = [v_{g,d}, v_{g,q}]^{\\top}$ the grid Thevenin voltage. The converter-side inductor current is $\\mathbf{i}_{1,dq} = [i_{1d}, i_{1q}]^{\\top}$ and the grid-side inductor current is $\\mathbf{i}_{2,dq} = [i_{2d}, i_{2q}]^{\\top}$. The capacitor current is the net branch current from converter-side to grid-side through the capacitor, given by $\\mathbf{i}_{c,dq} = \\mathbf{i}_{1,dq} - \\mathbf{i}_{2,dq}$ by KCL at the PCC.\n\nConverter-side inductor dynamics from KVL:\n$$\nL_1 \\frac{d}{dt} \\mathbf{i}_{1,dq} = \\mathbf{v}_{dq} - R_1 \\mathbf{i}_{1,dq} - \\mathbf{v}_{c,dq}.\n$$\nTransforming to dq dynamics,\n$$\n\\frac{d}{dt} \\mathbf{i}_{1,dq} = \\frac{1}{L_1} \\left( \\mathbf{v}_{dq} - R_1 \\mathbf{i}_{1,dq} - \\mathbf{v}_{c,dq} \\right) - \\omega J \\mathbf{i}_{1,dq}.\n$$\n\nCapacitor dynamics using $\\mathbf{i}_{c,dq} = C_f \\frac{d}{dt} \\mathbf{v}_{c,dq}$ and KCL $\\mathbf{i}_{c,dq} = \\mathbf{i}_{1,dq} - \\mathbf{i}_{2,dq}$:\n$$\n\\frac{d}{dt} \\mathbf{v}_{c,dq} = \\frac{1}{C_f} \\left( \\mathbf{i}_{1,dq} - \\mathbf{i}_{2,dq} \\right) - \\omega J \\mathbf{v}_{c,dq}.\n$$\n\nGrid-side inductor dynamics from KVL:\n$$\nL_2 \\frac{d}{dt} \\mathbf{i}_{2,dq} = \\mathbf{v}_{c,dq} - R_2 \\mathbf{i}_{2,dq} - \\mathbf{v}_{g,dq}.\n$$\nTransforming to dq dynamics,\n$$\n\\frac{d}{dt} \\mathbf{i}_{2,dq} = \\frac{1}{L_2} \\left( \\mathbf{v}_{c,dq} - R_2 \\mathbf{i}_{2,dq} - \\mathbf{v}_{g,dq} \\right) - \\omega J \\mathbf{i}_{2,dq}.\n$$\n\nWriting these in component form clarifies the cross-coupling induced by $\\omega$:\n\n- Converter-side inductor:\n$$\n\\begin{aligned}\n\\dot{i}_{1d} &= -\\frac{R_1}{L_1} i_{1d} + \\omega i_{1q} - \\frac{1}{L_1} v_{cd} + \\frac{1}{L_1} v_d, \\\\\n\\dot{i}_{1q} &= -\\frac{R_1}{L_1} i_{1q} - \\omega i_{1d} - \\frac{1}{L_1} v_{cq} + \\frac{1}{L_1} v_q.\n\\end{aligned}\n$$\n\n- Capacitor:\n$$\n\\begin{aligned}\n\\dot{v}_{cd} &= \\frac{1}{C_f} i_{1d} - \\frac{1}{C_f} i_{2d} + \\omega v_{cq}, \\\\\n\\dot{v}_{cq} &= \\frac{1}{C_f} i_{1q} - \\frac{1}{C_f} i_{2q} - \\omega v_{cd}.\n\\end{aligned}\n$$\n\n- Grid-side inductor:\n$$\n\\begin{aligned}\n\\dot{i}_{2d} &= -\\frac{R_2}{L_2} i_{2d} + \\omega i_{2q} + \\frac{1}{L_2} v_{cd} - \\frac{1}{L_2} v_{g,d}, \\\\\n\\dot{i}_{2q} &= -\\frac{R_2}{L_2} i_{2q} - \\omega i_{2d} + \\frac{1}{L_2} v_{cq} - \\frac{1}{L_2} v_{g,q}.\n\\end{aligned}\n$$\n\nStacking these into the state vector $\\mathbf{x} = [i_{1d},\\, i_{1q},\\, v_{cd},\\, v_{cq},\\, i_{2d},\\, i_{2q}]^{\\top}$ yields the compact state-space form $\\dot{\\mathbf{x}} = A \\mathbf{x} + B \\mathbf{u} + E \\mathbf{w}$, with $\\mathbf{u} = [v_d, v_q]^{\\top}$ and $\\mathbf{w} = [v_{g,d}, v_{g,q}]^{\\top}$. The state matrix $A$ is assembled by reading off the coefficients of the state variables in the above equations. In explicit $6 \\times 6$ form (ordering $i_{1d}, i_{1q}, v_{cd}, v_{cq}, i_{2d}, i_{2q}$),\n$$\nA =\n\\begin{pmatrix}\n-\\frac{R_1}{L_1} & \\omega & -\\frac{1}{L_1} & 0 & 0 & 0 \\\\\n-\\omega & -\\frac{R_1}{L_1} & 0 & -\\frac{1}{L_1} & 0 & 0 \\\\\n\\frac{1}{C_f} & 0 & 0 & \\omega & -\\frac{1}{C_f} & 0 \\\\\n0 & \\frac{1}{C_f} & -\\omega & 0 & 0 & -\\frac{1}{C_f} \\\\\n0 & 0 & \\frac{1}{L_2} & 0 & -\\frac{R_2}{L_2} & \\omega \\\\\n0 & 0 & 0 & \\frac{1}{L_2} & -\\omega & -\\frac{R_2}{L_2}\n\\end{pmatrix}.\n$$\n\nFor completeness, the input and disturbance matrices consistent with the derivation are\n$$\nB = \\begin{pmatrix}\n\\frac{1}{L_1} & 0 \\\\\n0 & \\frac{1}{L_1} \\\\\n0 & 0 \\\\\n0 & 0 \\\\\n0 & 0 \\\\\n0 & 0\n\\end{pmatrix}, \\quad\nE = \\begin{pmatrix}\n0 & 0 \\\\\n0 & 0 \\\\\n0 & 0 \\\\\n0 & 0 \\\\\n-\\frac{1}{L_2} & 0 \\\\\n0 & -\\frac{1}{L_2}\n\\end{pmatrix},\n$$\nreflecting that $\\mathbf{v}_{dq}$ directly actuates the converter-side inductor and $\\mathbf{v}_{g,dq}$ enters through the grid-side inductor. However, as requested, the final answer is the explicit $A$ matrix.",
            "answer": "$$\\boxed{\\begin{pmatrix}\n-\\frac{R_1}{L_1} & \\omega & -\\frac{1}{L_1} & 0 & 0 & 0 \\\\\n-\\omega & -\\frac{R_1}{L_1} & 0 & -\\frac{1}{L_1} & 0 & 0 \\\\\n\\frac{1}{C_f} & 0 & 0 & \\omega & -\\frac{1}{C_f} & 0 \\\\\n0 & \\frac{1}{C_f} & -\\omega & 0 & 0 & -\\frac{1}{C_f} \\\\\n0 & 0 & \\frac{1}{L_2} & 0 & -\\frac{R_2}{L_2} & \\omega \\\\\n0 & 0 & 0 & \\frac{1}{L_2} & -\\omega & -\\frac{R_2}{L_2}\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "With a plant model established, we can analyze the system's macroscopic behavior under grid-forming control. This practice challenges you to model the dynamic frequency response of a converter implementing a Virtual Synchronous Machine (VSM) to a sudden load change. By solving the swing equation , you will connect abstract concepts like virtual inertia $H$ and droop gain to critical performance metrics such as frequency nadir and Rate of Change of Frequency (RoCoF), assessing compliance with real-world grid codes.",
            "id": "3843997",
            "problem": "A grid-forming (GFM) converter augmented with a Virtual Synchronous Machine (VSM) operates in a power system with nominal frequency $f_{0} = 50 \\ \\mathrm{Hz}$ and rated apparent power $S_{\\mathrm{base}} = 50 \\ \\mathrm{MW}$. Its virtual inertia constant is $H = 4 \\ \\mathrm{s}$. The converter implements linear active power–frequency droop with slope $m_{p} = 0.040 \\ \\mathrm{Hz}/\\mathrm{MW}$. At time $t = 0$, the system experiences a positive active power load step of magnitude $\\Delta P = 15 \\ \\mathrm{MW}$.\n\nModel the GFM with VSM augmentation using synchronous-machine-equivalent swing dynamics and a linear droop law that maps frequency deviation to active power modulation. Assume ideal measurements and actuation with no delay, negligible losses, and no secondary frequency restoration. Treat the load step as an ideal step in electrical power demand.\n\nStarting from the fundamental dynamical relation between rotor frequency and power imbalance in synchronous-machine-equivalent form, and the definition of droop that relates steady-state frequency deviation to active power deviation, derive the time-domain frequency deviation $\\Delta f(t)$ due to the step $\\Delta P$ and determine the maximum magnitude of the frequency deviation (the frequency nadir for a positive load step). Additionally, evaluate compliance with the following grid code thresholds:\n- The maximum frequency deviation must not exceed $0.8 \\ \\mathrm{Hz}$.\n- The maximum Rate of Change of Frequency (RoCoF) must not exceed $1.0 \\ \\mathrm{Hz}/\\mathrm{s}$.\n\nProvide the final numerical value for the maximum frequency deviation. Round your final answer to four significant figures. Express the final frequency deviation in $\\mathrm{Hz}$.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Problem Validation\n\n#### Step 1: Extract Givens\n- Nominal frequency: $f_{0} = 50 \\ \\mathrm{Hz}$\n- Rated apparent power: $S_{\\mathrm{base}} = 50 \\ \\mathrm{MW}$\n- Virtual inertia constant: $H = 4 \\ \\mathrm{s}$\n- Active power–frequency droop slope: $m_{p} = 0.040 \\ \\mathrm{Hz}/\\mathrm{MW}$\n- Active power load step: $\\Delta P = 15 \\ \\mathrm{MW}$ at $t=0$\n- System model: Synchronous-machine-equivalent swing dynamics with linear droop control.\n- Assumptions: Ideal measurements and actuation, no delays, negligible losses, no secondary frequency restoration.\n- Grid Code Thresholds:\n  - Maximum frequency deviation: $|\\Delta f(t)| \\le 0.8 \\ \\mathrm{Hz}$\n  - Maximum Rate of Change of Frequency (RoCoF): $|\\frac{df}{dt}| \\le 1.0 \\ \\mathrm{Hz/s}$\n\n#### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is based on the standard and well-established swing equation model for power system dynamics and linear droop control, which are fundamental concepts in power engineering. The parameters are physically realistic.\n2.  **Well-Posed:** The problem provides a clear initial condition (steady-state operation), a well-defined disturbance (step change), and a standard linear time-invariant system model. This structure guarantees a unique and stable solution.\n3.  **Objective:** The problem is stated using precise, quantitative language and established technical terminology. It is free of ambiguity and subjective claims.\n4.  **Completeness and Consistency:** All necessary parameters ($f_0$, $S_{\\mathrm{base}}$, $H$, $m_p$, $\\Delta P$) are provided. The unit of $S_{\\mathrm{base}}$ is given as MW; while typically VA, using MW as the power base for the inertia constant relation is a common and acceptable simplification when reactive power dynamics are ignored. The givens are self-consistent.\n\n#### Step 3: Verdict and Action\nThe problem is valid. It is a well-posed, scientifically grounded problem in power system dynamics. A full solution will be derived.\n\n### Derivation of the Solution\n\nThe dynamics of a Virtual Synchronous Machine (VSM) are modeled by the swing equation, which relates the rate of change of frequency to the power imbalance between the commanded \"mechanical\" power $P_m$ and the electrical power output $P_e$. In absolute (physical) units, the swing equation is:\n$$ \\frac{2 H S_{\\mathrm{base}}}{f_0} \\frac{df(t)}{dt} = P_m(t) - P_e(t) $$\nwhere $f(t)$ is the system frequency, $H$ is the inertia constant, $S_{\\mathrm{base}}$ is the rated power, and $f_0$ is the nominal frequency.\n\nLet us define the deviations from the pre-disturbance steady-state values. The initial conditions at time $t < 0$ are $f(t) = f_0$, and the converter is in a steady state with $P_m(t) = P_{m0}$ and $P_e(t) = P_{e0}$, such that $P_{m0} = P_{e0}$.\n\nAt time $t=0$, a load step of $\\Delta P$ occurs. The electrical power output instantly increases to meet this demand, so for $t \\ge 0$:\n$$ P_e(t) = P_{e0} + \\Delta P $$\n\nThe VSM implements droop control, where the commanded power $P_m$ is adjusted based on the frequency deviation $\\Delta f(t) = f(t) - f_0$. The linear droop law is given by:\n$$ P_m(t) - P_{m0} = -\\frac{1}{m_p} \\Delta f(t) $$\nThe negative sign indicates that a drop in frequency ($\\Delta f < 0$) causes an increase in power injection. Thus,\n$$ P_m(t) = P_{m0} - \\frac{1}{m_p} \\Delta f(t) $$\n\nSubstituting the expressions for $P_m(t)$ and $P_e(t)$ into the swing equation, and noting that $\\frac{df(t)}{dt} = \\frac{d(f_0 + \\Delta f(t))}{dt} = \\frac{d\\Delta f(t)}{dt}$:\n$$ \\frac{2 H S_{\\mathrm{base}}}{f_0} \\frac{d\\Delta f(t)}{dt} = \\left(P_{m0} - \\frac{1}{m_p} \\Delta f(t)\\right) - (P_{e0} + \\Delta P) $$\nSince $P_{m0} = P_{e0}$, the equation simplifies to:\n$$ \\frac{2 H S_{\\mathrm{base}}}{f_0} \\frac{d\\Delta f(t)}{dt} = -\\frac{1}{m_p} \\Delta f(t) - \\Delta P $$\n\nThis is a first-order linear ordinary differential equation. Rearranging it into the standard form $\\frac{dy}{dt} + a y = b$:\n$$ \\frac{d\\Delta f(t)}{dt} + \\left(\\frac{f_0}{2 H S_{\\mathrm{base}} m_p}\\right) \\Delta f(t) = -\\frac{f_0 \\Delta P}{2 H S_{\\mathrm{base}}} $$\nThe initial condition is that frequency is continuous due to inertia, so the deviation at $t=0^+$ is zero: $\\Delta f(0^+) = 0$.\n\nThe solution to this differential equation is of the form $\\Delta f(t) = \\Delta f_{ss} + (\\Delta f(0) - \\Delta f_{ss}) e^{-t/\\tau}$, where $\\Delta f_{ss}$ is the steady-state deviation and $\\tau$ is the time constant.\n\nThe time constant $\\tau$ is the reciprocal of the coefficient of the $\\Delta f(t)$ term:\n$$ \\tau = \\left(\\frac{f_0}{2 H S_{\\mathrm{base}} m_p}\\right)^{-1} = \\frac{2 H S_{\\mathrm{base}} m_p}{f_0} $$\nThe steady-state deviation $\\Delta f_{ss}$ is found by setting $\\frac{d\\Delta f}{dt} = 0$:\n$$ \\frac{f_0}{2 H S_{\\mathrm{base}} m_p} \\Delta f_{ss} = -\\frac{f_0 \\Delta P}{2 H S_{\\mathrm{base}}} \\implies \\Delta f_{ss} = -m_p \\Delta P $$\nThis result is consistent with the definition of droop control.\n\nSubstituting the initial condition $\\Delta f(0) = 0$ into the general solution:\n$$ \\Delta f(t) = \\Delta f_{ss} + (0 - \\Delta f_{ss}) e^{-t/\\tau} = \\Delta f_{ss} (1 - e^{-t/\\tau}) $$\nPlugging in the expression for $\\Delta f_{ss}$:\n$$ \\Delta f(t) = -m_p \\Delta P (1 - e^{-t/\\tau}) $$\n\nNow, we substitute the numerical values:\n- $\\Delta P = 15 \\ \\mathrm{MW}$\n- $m_p = 0.040 \\ \\mathrm{Hz}/\\mathrm{MW}$\n- $H = 4 \\ \\mathrm{s}$\n- $S_{\\mathrm{base}} = 50 \\ \\mathrm{MW}$\n- $f_0 = 50 \\ \\mathrm{Hz}$\n\nThe steady-state frequency deviation is:\n$$ \\Delta f_{ss} = -(0.040 \\ \\mathrm{Hz}/\\mathrm{MW}) \\times (15 \\ \\mathrm{MW}) = -0.6 \\ \\mathrm{Hz} $$\nThe time constant is:\n$$ \\tau = \\frac{2 \\times (4 \\ \\mathrm{s}) \\times (50 \\ \\mathrm{MW}) \\times (0.040 \\ \\mathrm{Hz}/\\mathrm{MW})}{50 \\ \\mathrm{Hz}} = \\frac{16}{50} \\ \\mathrm{s} = 0.32 \\ \\mathrm{s} $$\nSo, the time-domain frequency deviation is:\n$$ \\Delta f(t) = -0.6 (1 - e^{-t/0.32}) \\ \\mathrm{Hz} $$\n\nThe maximum magnitude of the frequency deviation (the nadir) for this first-order response occurs at steady state ($t \\to \\infty$):\n$$ |\\Delta f|_{\\max} = \\lim_{t \\to \\infty} |\\Delta f(t)| = |-0.6| \\ \\mathrm{Hz} = 0.6 \\ \\mathrm{Hz} $$\n\n### Grid Code Compliance Evaluation\n\n1.  **Maximum Frequency Deviation:**\n    The calculated maximum deviation is $|\\Delta f|_{\\max} = 0.6 \\ \\mathrm{Hz}$. The grid code limit is $0.8 \\ \\mathrm{Hz}$. Since $0.6 \\ \\mathrm{Hz} \\le 0.8 \\ \\mathrm{Hz}$, the system is **compliant** with the frequency deviation threshold.\n\n2.  **Maximum Rate of Change of Frequency (RoCoF):**\n    The RoCoF is the time derivative of the frequency. We can find its maximum value by differentiating $\\Delta f(t)$ or from the initial state of the ODE.\n    At $t=0^+$, $\\Delta f(0^+) = 0$. The ODE gives:\n    $$ \\frac{d\\Delta f(t)}{dt}\\bigg|_{t=0^+} = -\\frac{f_0 \\Delta P}{2 H S_{\\mathrm{base}}} $$\n    This is the initial, and thus maximum, magnitude of the RoCoF.\n    $$ \\mathrm{RoCoF}_{\\max} = \\frac{d\\Delta f(t)}{dt}\\bigg|_{t=0^+} = -\\frac{(50 \\ \\mathrm{Hz}) \\times (15 \\ \\mathrm{MW})}{2 \\times (4 \\ \\mathrm{s}) \\times (50 \\ \\mathrm{MW})} = -\\frac{750}{400} \\ \\mathrm{Hz/s} = -1.875 \\ \\mathrm{Hz/s} $$\n    The maximum magnitude of the RoCoF is $|\\mathrm{RoCoF}|_{\\max} = 1.875 \\ \\mathrm{Hz/s}$. The grid code limit is $1.0 \\ \\mathrm{Hz/s}$. Since $1.875 \\ \\mathrm{Hz/s} > 1.0 \\ \\mathrm{Hz/s}$, the system is **not compliant** with the RoCoF threshold.\n\nThe problem asks for the maximum magnitude of the frequency deviation.\n$$ |\\Delta f|_{\\max} = 0.6 \\ \\mathrm{Hz} $$\nRounding to four significant figures gives $0.6000$.",
            "answer": "$$\\boxed{0.6000}$$"
        },
        {
            "introduction": "Finally, we zoom into the heart of the controller to ensure robust stability. This exercise involves creating a small-signal model of the closed-loop voltage control system, including the implementation of virtual impedance. By performing an eigenvalue analysis , you will directly observe how this software-defined impedance actively damps oscillations, a critical technique for stabilizing modern power electronic systems.",
            "id": "3844073",
            "problem": "Construct a linear time-invariant small-signal model for the voltage control loop of a three-phase grid-forming inverter with an output inductance and shunt capacitor supplying a resistive load, modeled in the synchronous rotating reference frame. Use Kirchhoff’s Current Law (KCL), Kirchhoff’s Voltage Law (KVL), and the Park transformation properties. The inverter’s controller is a proportional-integral (PI) voltage regulator with a virtual series impedance implemented as a resistive drop proportional to the inductor current.\n\nAssumptions and fundamental modeling base:\n- The plant consists of a series output inductance $L_f$ between the inverter voltage source and the capacitor, and a shunt capacitor $C_f$ at the point of common coupling (PCC) feeding a resistive load $R_{\\mathrm{load}}$.\n- The model is expressed in the synchronous rotating $dq$ frame at nominal angular speed $\\omega_0$, where cross-coupling terms induced by the rotating frame appear as $\\pm \\omega_0$ coupling between $d$ and $q$ axes. Use the well-established properties that, for a vector $\\mathbf{x}$ transformed into the rotating frame at speed $\\omega_0$, one has $\\frac{d}{dt}\\mathbf{x}_{dq} = \\mathbf{J}\\omega_0 \\mathbf{x}_{dq}$ for appropriate cross-coupling with $\\mathbf{J}$ representing the $d$–$q$ rotation structure.\n- The load is purely resistive in the stationary frame; in the $dq$ frame aligned with the nominal grid voltage, it is represented by $i_{\\ell,d} = v_{c,d}/R_{\\mathrm{load}}$ and $i_{\\ell,q} = v_{c,q}/R_{\\mathrm{load}}$ for small signals.\n- The voltage controller generates the inverter pole voltage command $\\mathbf{u} = [u_d, u_q]^\\top$ according to a PI law on the capacitor voltage error with a virtual resistive impedance $R_v$ in series with the inductor current. Around a steady operating point with constant reference $v_{\\mathrm{ref},d} = V_0$ and $v_{\\mathrm{ref},q} = 0$, the small-signal control law is\n$$\n\\delta u_d = -K_p\\,\\delta v_{c,d} + K_i\\,\\delta \\xi_d - R_v\\,\\delta i_d,\\quad\n\\delta u_q = -K_p\\,\\delta v_{c,q} + K_i\\,\\delta \\xi_q - R_v\\,\\delta i_q,\n$$\nwhere $\\delta \\xi_d$ and $\\delta \\xi_q$ are integrator states obeying\n$$\n\\delta \\dot{\\xi}_d = -\\delta v_{c,d},\\quad \\delta \\dot{\\xi}_q = -\\delta v_{c,q}.\n$$\n\nSmall-signal plant equations in $dq$ coordinates follow from KVL across the inductor and KCL at the capacitor node:\n- Inductor current dynamics:\n$$\n\\delta \\dot{i}_d = \\frac{1}{L_f}\\left( \\delta u_d - \\delta v_{c,d} \\right) + \\omega_0\\,\\delta i_q,\\quad\n\\delta \\dot{i}_q = \\frac{1}{L_f}\\left( \\delta u_q - \\delta v_{c,q} \\right) - \\omega_0\\,\\delta i_d.\n$$\n- Capacitor voltage dynamics:\n$$\n\\delta \\dot{v}_{c,d} = \\frac{1}{C_f}\\left( \\delta i_d - \\frac{\\delta v_{c,d}}{R_{\\mathrm{load}}} \\right) + \\omega_0\\,\\delta v_{c,q},\\quad\n\\delta \\dot{v}_{c,q} = \\frac{1}{C_f}\\left( \\delta i_q - \\frac{\\delta v_{c,q}}{R_{\\mathrm{load}}} \\right) - \\omega_0\\,\\delta v_{c,d}.\n$$\n\nTasks:\n1. Using the preceding fundamental relations, assemble the linear time-invariant state-space model $\\delta \\dot{\\mathbf{x}} = A(R_v)\\,\\delta \\mathbf{x}$ with state vector $\\delta \\mathbf{x} = [\\delta i_d,\\ \\delta i_q,\\ \\delta v_{c,d},\\ \\delta v_{c,q},\\ \\delta \\xi_d,\\ \\delta \\xi_q]^\\top$, explicitly expressing the state matrix $A(R_v)$ as a function of the virtual resistance $R_v$, the plant parameters, and the PI gains.\n2. For given numerical values\n$$\nL_f = 1.5\\times 10^{-3}\\ \\mathrm{H},\\quad\nC_f = 40\\times 10^{-6}\\ \\mathrm{F},\\quad\nR_{\\mathrm{load}} = 25.0\\ \\Omega,\\quad\n\\omega_0 = 314.159265\\ \\mathrm{rad/s},\n$$\nand controller gains\n$$\nK_p = 0.2,\\quad K_i = 500.0,\n$$\ncompute the eigenvalues of $A(R_v)$ for each test value of the virtual resistance $R_v$ listed in the test suite below. For each $R_v$, extract the maximum real part among all eigenvalues. Report these values in units of $\\mathrm{s}^{-1}$ rounded to six decimal places.\n\nTest suite for $R_v$:\n- Case 1: $R_v = 0.0\\ \\Omega$ (no virtual damping).\n- Case 2: $R_v = 0.1\\ \\Omega$ (small virtual damping).\n- Case 3: $R_v = 0.5\\ \\Omega$ (moderate virtual damping).\n- Case 4: $R_v = 2.0\\ \\Omega$ (high virtual damping).\n- Case 5: $R_v = 10.0\\ \\Omega$ (extreme virtual damping).\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3,r_4,r_5]$, where each $r_k$ is the maximum real part (in $\\mathrm{s}^{-1}$, rounded to six decimal places) of the eigenvalues of $A(R_v)$ for the corresponding test case.\n- Angles are already specified in radians; no angle conversions are required. All reported values are dimensioned in $\\mathrm{s}^{-1}$ and should be provided as pure decimal numbers without units in the output string.",
            "solution": "The problem is to construct a linear time-invariant (LTI) state-space model, $\\delta \\dot{\\mathbf{x}} = A(R_v)\\,\\delta \\mathbf{x}$, for a three-phase grid-forming inverter's voltage control loop and to analyze its stability by computing the eigenvalues of the state matrix $A(R_v)$ for different values of virtual resistance $R_v$.\n\nThe state-space representation is constructed by expressing the time derivative of each state variable as a linear combination of all state variables. The state vector for the system is defined as $\\delta \\mathbf{x} = [\\delta i_d,\\ \\delta i_q,\\ \\delta v_{c,d},\\ \\delta v_{c,q},\\ \\delta \\xi_d,\\ \\delta \\xi_q]^\\top$. The system dynamics are described by a set of six coupled first-order linear differential equations, which we will assemble into a matrix format.\n\nThe fundamental equations provided in the problem statement are derived from Kirchhoff's Voltage Law (KVL) applied across the output filter inductor $L_f$ and Kirchhoff's Current Law (KCL) applied at the filter capacitor $C_f$ node, all transformed into the synchronous rotating $dq$ reference frame. The controller dynamics are given by a proportional-integral (PI) law and the state dynamics of the integrator.\n\nThe derivation proceeds by substituting the control law into the plant dynamics to obtain a closed-loop representation. The control inputs, $\\delta u_d$ and $\\delta u_q$, are given by:\n$$\n\\delta u_d = -R_v\\,\\delta i_d - K_p\\,\\delta v_{c,d} + K_i\\,\\delta \\xi_d\n$$\n$$\n\\delta u_q = -R_v\\,\\delta i_q - K_p\\,\\delta v_{c,q} + K_i\\,\\delta \\xi_q\n$$\n\nWe will now derive each row of the state matrix $A(R_v)$ corresponding to the derivative of each state variable.\n\n1.  **Inductor current dynamics ($\\delta \\dot{i}_d$, $\\delta \\dot{i}_q$)**:\n    The small-signal KVL equations for the inductor $L_f$ are:\n    $$\n    \\delta \\dot{i}_d = \\frac{1}{L_f}\\left( \\delta u_d - \\delta v_{c,d} \\right) + \\omega_0\\,\\delta i_q\n    $$\n    $$\n    \\delta \\dot{i}_q = \\frac{1}{L_f}\\left( \\delta u_q - \\delta v_{c,q} \\right) - \\omega_0\\,\\delta i_d\n    $$\n    Substituting the expressions for $\\delta u_d$ and $\\delta u_q$:\n    $$\n    \\begin{align*}\n    \\delta \\dot{i}_d &= \\frac{1}{L_f}\\left( (-R_v\\,\\delta i_d - K_p\\,\\delta v_{c,d} + K_i\\,\\delta \\xi_d) - \\delta v_{c,d} \\right) + \\omega_0\\,\\delta i_q \\\\\n    &= -\\frac{R_v}{L_f}\\,\\delta i_d + \\omega_0\\,\\delta i_q - \\frac{K_p+1}{L_f}\\,\\delta v_{c,d} + 0 \\cdot \\delta v_{c,q} + \\frac{K_i}{L_f}\\,\\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    \\end{align*}\n    $$\n    $$\n    \\begin{align*}\n    \\delta \\dot{i}_q &= \\frac{1}{L_f}\\left( (-R_v\\,\\delta i_q - K_p\\,\\delta v_{c,q} + K_i\\,\\delta \\xi_q) - \\delta v_{c,q} \\right) - \\omega_0\\,\\delta i_d \\\\\n    &= -\\omega_0\\,\\delta i_d - \\frac{R_v}{L_f}\\,\\delta i_q + 0 \\cdot \\delta v_{c,d} - \\frac{K_p+1}{L_f}\\,\\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + \\frac{K_i}{L_f}\\,\\delta \\xi_q\n    \\end{align*}\n    $$\n    These two equations form the first two rows of the state matrix $A(R_v)$.\n\n2.  **Capacitor voltage dynamics ($\\delta \\dot{v}_{c,d}$, $\\delta \\dot{v}_{c,q}$)**:\n    The small-signal KCL equations for the capacitor $C_f$ are:\n    $$\n    \\delta \\dot{v}_{c,d} = \\frac{1}{C_f}\\left( \\delta i_d - i_{\\ell,d} \\right) + \\omega_0\\,\\delta v_{c,q} = \\frac{1}{C_f}\\left( \\delta i_d - \\frac{\\delta v_{c,d}}{R_{\\mathrm{load}}} \\right) + \\omega_0\\,\\delta v_{c,q}\n    $$\n    $$\n    \\delta \\dot{v}_{c,q} = \\frac{1}{C_f}\\left( \\delta i_q - i_{\\ell,q} \\right) - \\omega_0\\,\\delta v_{c,d} = \\frac{1}{C_f}\\left( \\delta i_q - \\frac{\\delta v_{c,q}}{R_{\\mathrm{load}}} \\right) - \\omega_0\\,\\delta v_{c,d}\n    $$\n    Expanding these in terms of the state vector components:\n    $$\n    \\delta \\dot{v}_{c,d} = \\frac{1}{C_f}\\,\\delta i_d + 0 \\cdot \\delta i_q - \\frac{1}{C_f R_{\\mathrm{load}}}\\,\\delta v_{c,d} + \\omega_0\\,\\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    $$\n    \\delta \\dot{v}_{c,q} = 0 \\cdot \\delta i_d + \\frac{1}{C_f}\\,\\delta i_q - \\omega_0\\,\\delta v_{c,d} - \\frac{1}{C_f R_{\\mathrm{load}}}\\,\\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    These two equations form the third and fourth rows of the state matrix $A(R_v)$.\n\n3.  **Controller integrator state dynamics ($\\delta \\dot{\\xi}_d$, $\\delta \\dot{\\xi}_q$)**:\n    The dynamics of the PI controller's integrator states are given directly as:\n    $$\n    \\delta \\dot{\\xi}_d = -\\delta v_{c,d} = 0 \\cdot \\delta i_d + 0 \\cdot \\delta i_q - 1 \\cdot \\delta v_{c,d} + 0 \\cdot \\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    $$\n    \\delta \\dot{\\xi}_q = -\\delta v_{c,q} = 0 \\cdot \\delta i_d + 0 \\cdot \\delta i_q + 0 \\cdot \\delta v_{c,d} - 1 \\cdot \\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    These two equations form the fifth and sixth rows of the state matrix $A(R_v)$.\n\n**Assembling the State Matrix $A(R_v)$**\nCombining the coefficients derived above, we construct the $6 \\times 6$ state matrix $A(R_v)$ for the system $\\delta \\dot{\\mathbf{x}} = A(R_v)\\,\\delta \\mathbf{x}$:\n$$\nA(R_v) = \n\\begin{pmatrix}\n-\\frac{R_v}{L_f} & \\omega_0 & -\\frac{K_p+1}{L_f} & 0 & \\frac{K_i}{L_f} & 0 \\\\\n-\\omega_0 & -\\frac{R_v}{L_f} & 0 & -\\frac{K_p+1}{L_f} & 0 & \\frac{K_i}{L_f} \\\\\n\\frac{1}{C_f} & 0 & -\\frac{1}{C_f R_{\\mathrm{load}}} & \\omega_0 & 0 & 0 \\\\\n0 & \\frac{1}{C_f} & -\\omega_0 & -\\frac{1}{C_f R_{\\mathrm{load}}} & 0 & 0 \\\\\n0 & 0 & -1 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & -1 & 0 & 0\n\\end{pmatrix}\n$$\nThis matrix explicitly defines the LTI small-signal model of the closed-loop system as a function of the virtual resistance $R_v$ and other system parameters.\n\nFor the numerical part of the problem, the provided values for $L_f$, $C_f$, $R_{\\mathrm{load}}$, $\\omega_0$, $K_p$, and $K_i$ are substituted into this matrix structure. For each value of $R_v$ from the test suite, the resulting numerical matrix is constructed, and its eigenvalues are computed. The stability of the system is assessed by the real parts of these eigenvalues; a negative real part for all eigenvalues indicates stability. The task is to find the maximum real part among all eigenvalues, which corresponds to the least damped (or most unstable) mode of the system.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs the state-space model for a grid-forming inverter\n    and computes eigenvalues to assess stability.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: R_v = 0.0\n        0.0,\n        # Case 2: R_v = 0.1\n        0.1,\n        # Case 3: R_v = 0.5\n        0.5,\n        # Case 4: R_v = 2.0\n        2.0,\n        # Case 5: R_v = 10.0\n        10.0\n    ]\n\n    # Given numerical parameter values\n    Lf = 1.5e-3  # H\n    Cf = 40e-6   # F\n    R_load = 25.0  # Ohm\n    w0 = 314.159265  # rad/s\n    Kp = 0.2  # Proportional gain\n    Ki = 500.0  # Integral gain\n\n    results = []\n\n    def build_A_matrix(Rv):\n        \"\"\"Builds the 6x6 state matrix A for a given virtual resistance Rv.\"\"\"\n        A = np.zeros((6, 6))\n\n        # Row 1: d(delta_id)/dt\n        A[0, 0] = -Rv / Lf\n        A[0, 1] = w0\n        A[0, 2] = -(Kp + 1.0) / Lf\n        A[0, 4] = Ki / Lf\n\n        # Row 2: d(delta_iq)/dt\n        A[1, 0] = -w0\n        A[1, 1] = -Rv / Lf\n        A[1, 3] = -(Kp + 1.0) / Lf\n        A[1, 5] = Ki / Lf\n\n        # Row 3: d(delta_vc,d)/dt\n        A[2, 0] = 1.0 / Cf\n        A[2, 2] = -1.0 / (Cf * R_load)\n        A[2, 3] = w0\n\n        # Row 4: d(delta_vc,q)/dt\n        A[3, 1] = 1.0 / Cf\n        A[3, 2] = -w0\n        A[3, 3] = -1.0 / (Cf * R_load)\n\n        # Row 5: d(delta_xi,d)/dt\n        A[4, 2] = -1.0\n\n        # Row 6: d(delta_xi,q)/dt\n        A[5, 3] = -1.0\n        \n        return A\n\n    for Rv_val in test_cases:\n        # Construct the state matrix for the current test case\n        A_matrix = build_A_matrix(Rv_val)\n        \n        # Compute the eigenvalues of the matrix A\n        eigenvalues = np.linalg.eigvals(A_matrix)\n        \n        # Find the maximum of the real parts of the eigenvalues\n        max_real_part = np.max(np.real(eigenvalues))\n        \n        # Round the result to six decimal places and append to the list\n        results.append(round(max_real_part, 6))\n\n    # Format the final output string as per the specification\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}