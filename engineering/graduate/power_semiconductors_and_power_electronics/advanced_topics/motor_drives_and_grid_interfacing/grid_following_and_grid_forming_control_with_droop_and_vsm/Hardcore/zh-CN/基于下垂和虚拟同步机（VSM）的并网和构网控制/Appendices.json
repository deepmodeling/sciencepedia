{
    "hands_on_practices": [
        {
            "introduction": "精确的动态模型是电力电子变换器现代控制设计的基石。本练习将指导您从第一性原理出发，推导带LCL滤波器的并网逆变器的状态空间模型，这是分析和控制并网系统的基本技能。通过这个过程，您将加深对dq变换及其在多变量系统建模中应用的理解。",
            "id": "3844010",
            "problem": "考虑一个带有电感-电容-电感（LCL）滤波器的平衡三相并网电压源逆变器。逆变器侧电感的电感值为 $L_1$，串联电阻为 $R_1$；并联滤波电容的电容值为 $C_f$；电网侧电感的电感值为 $L_2$，串联电阻为 $R_2$。假设除了 $R_1$ 和 $R_2$ 外，寄生参数可以忽略不计。该滤波器连接到一个无限大电网，该电网在公共耦合点（PCC）处被建模为一个刚性戴维南电压源，其直轴-交轴（dq）分量表示为 $v_{g,d}$ 和 $v_{g,q}$。在dq坐标系下，逆变器的桥臂平均输出电压是控制输入 $v_{dq} = [v_{d}, v_{q}]^{\\top}$，它可由通过锁相环（PLL）同步的跟网型电流控制器产生，也可由构网型控制器（如具有频率-电压下垂特性的虚拟同步机VSM）产生。dq坐标系由一个Park变换定义，该变换以角速度 $\\omega$ 旋转并与电网电压角度对齐，从而使得理想的电网电压在dq坐标系下表现为恒定值。\n\n从电力电子学的基本原理出发——即基尔霍夫电压定律和基尔霍夫电流定律、电感和电容的本构关系（$v = L\\,di/dt + Ri$ 和 $i = C\\,dv/dt$），以及旋转dq变换的性质——推导描述逆变器侧电感电流、PCC处电容电压以及电网侧电感电流的dq域平均微分方程。设状态向量为 $x = [i_{1d},\\, i_{1q},\\, v_{cd},\\, v_{cq},\\, i_{2d},\\, i_{2q}]^{\\top}$，其中 $i_{1d}, i_{1q}$ 是逆变器侧电感电流的分量，$v_{cd}, v_{cq}$ 是PCC处的电容电压分量，$i_{2d}, i_{2q}$ 是电网侧电感电流的分量。将该系统表示为紧凑的状态空间形式 $ \\dot{x} = A x + B u + E w$，其中 $u = [v_d, v_q]^{\\top}$ 且 $w = [v_{g,d}, v_{g,q}]^{\\top}$。如果需要，可使用规范的斜对称矩阵 $J = \\begin{bmatrix} 0  -1 \\\\ 1  0 \\end{bmatrix}$ 来表示dq交叉耦合，并清楚地指明 $\\omega$ 是如何通过dq变换进入动力学方程的。\n\n您的任务是进行推导，然后用 $R_1$、$L_1$、$C_f$、$R_2$、$L_2$ 和 $\\omega$ 显式地构建 $6 \\times 6$ 的状态矩阵 $A$。请给出完整的 $A$ 矩阵作为最终答案。不需要数值；请保持表达式为符号形式。最终答案必须是单个闭式解析表达式。",
            "solution": "目标是推导连接在受控逆变器和刚性电网之间的LCL滤波器的dq域平均模型，然后在 $\\dot{x} = A x + B u + E w$ 中构建得到的状态空间矩阵 $A$。推导过程基于基尔霍夫电压定律（KVL）、基尔霍夫电流定律（KCL）、电感和电容的本构关系，以及旋转dq坐标系的变换性质。\n\n我们考虑平衡三相量，并在与电网电压对齐、以角速度 $\\omega$ 旋转的同步dq坐标系中进行分析。Park变换将静止两轴变量 $y_{\\alpha\\beta}$ 映射到 $y_{dq}$，其时间导数会引入交叉耦合项。对于任意dq向量 $y_{dq} = [y_d, y_q]^{\\top}$，物理动态过程与dq域导数之间的关系可由下式表示\n$$\n\\frac{d}{dt} y_{dq} = \\left(\\text{物理导数在静止坐标系下映射到dq}\\right) - \\omega J y_{dq},\n$$\n其中\n$$\nJ = \\begin{bmatrix} 0  -1 \\\\ 1  0 \\end{bmatrix}.\n$$\n当在dq坐标系中表示时，该恒等式直接产生了储能元件的交叉耦合项：\n\n1. 在静止坐标系中，电感的本构关系为 $v = L\\,\\frac{di}{dt} + R\\,i$。在dq坐标系中，\n$$\n\\frac{d}{dt} i_{dq} = \\frac{1}{L}\\left(v_{dq} - R\\,i_{dq}\\right) - \\omega J\\,i_{dq}.\n$$\n\n2. 在静止坐标系中，电容的本构关系为 $i = C\\,\\frac{dv}{dt}$。在dq坐标系中，\n$$\n\\frac{d}{dt} v_{dq} = \\frac{1}{C} i_{dq} - \\omega J\\,v_{dq}.\n$$\n\n我们将这些关系应用于LCL滤波器的每个元件。令 $v_{dq} = [v_d, v_q]^{\\top}$ 表示dq坐标系下逆变器桥臂的平均输出电压，$v_{c,dq} = [v_{cd}, v_{cq}]^{\\top}$ 表示PCC处的电容电压，$v_{g,dq} = [v_{g,d}, v_{g,q}]^{\\top}$ 表示电网的戴维南电压。逆变器侧电感电流为 $i_{1,dq} = [i_{1d}, i_{1q}]^{\\top}$，电网侧电感电流为 $i_{2,dq} = [i_{2d}, i_{2q}]^{\\top}$。根据PCC处的KCL，电容电流是流经电容的从逆变器侧到电网侧的净支路电流，由 $i_{c,dq} = i_{1,dq} - i_{2,dq}$ 给出。\n\n根据KVL得到的逆变器侧电感动态方程：\n$$\nL_1 \\frac{d}{dt} i_{1,dq} = v_{dq} - R_1 i_{1,dq} - v_{c,dq}.\n$$\n转换到dq动态方程，\n$$\n\\frac{d}{dt} i_{1,dq} = \\frac{1}{L_1} \\left( v_{dq} - R_1 i_{1,dq} - v_{c,dq} \\right) - \\omega J i_{1,dq}.\n$$\n\n使用 $i_{c,dq} = C_f \\frac{d}{dt} v_{c,dq}$ 和 KCL $i_{c,dq} = i_{1,dq} - i_{2,dq}$ 得到的电容动态方程：\n$$\n\\frac{d}{dt} v_{c,dq} = \\frac{1}{C_f} \\left( i_{1,dq} - i_{2,dq} \\right) - \\omega J v_{c,dq}.\n$$\n\n根据KVL得到的电网侧电感动态方程：\n$$\nL_2 \\frac{d}{dt} i_{2,dq} = v_{c,dq} - R_2 i_{2,dq} - v_{g,dq}.\n$$\n转换到dq动态方程，\n$$\n\\frac{d}{dt} i_{2,dq} = \\frac{1}{L_2} \\left( v_{c,dq} - R_2 i_{2,dq} - v_{g,dq} \\right) - \\omega J i_{2,dq}.\n$$\n\n将这些方程以分量形式写出，可以阐明由 $\\omega$ 引起的交叉耦合：\n\n- 逆变器侧电感：\n$$\n\\begin{aligned}\n\\dot{i}_{1d} = -\\frac{R_1}{L_1} i_{1d} + \\omega i_{1q} - \\frac{1}{L_1} v_{cd} + \\frac{1}{L_1} v_d, \\\\\n\\dot{i}_{1q} = -\\frac{R_1}{L_1} i_{1q} - \\omega i_{1d} - \\frac{1}{L_1} v_{cq} + \\frac{1}{L_1} v_q.\n\\end{aligned}\n$$\n\n- 电容：\n$$\n\\begin{aligned}\n\\dot{v}_{cd} = \\frac{1}{C_f} i_{1d} - \\frac{1}{C_f} i_{2d} + \\omega v_{cq}, \\\\\n\\dot{v}_{cq} = \\frac{1}{C_f} i_{1q} - \\frac{1}{C_f} i_{2q} - \\omega v_{cd}.\n\\end{aligned}\n$$\n\n- 电网侧电感：\n$$\n\\begin{aligned}\n\\dot{i}_{2d} = -\\frac{R_2}{L_2} i_{2d} + \\omega i_{2q} + \\frac{1}{L_2} v_{cd} - \\frac{1}{L_2} v_{g,d}, \\\\\n\\dot{i}_{2q} = -\\frac{R_2}{L_2} i_{2q} - \\omega i_{2d} + \\frac{1}{L_2} v_{cq} - \\frac{1}{L_2} v_{g,q}.\n\\end{aligned}\n$$\n\n将这些方程堆叠成状态向量 $x = [i_{1d},\\, i_{1q},\\, v_{cd},\\, v_{cq},\\, i_{2d},\\, i_{2q}]^{\\top}$，得到紧凑的状态空间形式 $\\dot{x} = A x + B u + E w$，其中 $u = [v_d, v_q]^{\\top}$ 且 $w = [v_{g,d}, v_{g,q}]^{\\top}$。状态矩阵 $A$ 是通过读取上述方程中状态变量的系数来构建的。以显式的 $6 \\times 6$ 形式（按 $i_{1d}, i_{1q}, v_{cd}, v_{cq}, i_{2d}, i_{2q}$ 排序），\n$$\nA =\n\\begin{pmatrix}\n-\\frac{R_1}{L_1}  \\omega  -\\frac{1}{L_1}  0  0  0 \\\\\n-\\omega  -\\frac{R_1}{L_1}  0  -\\frac{1}{L_1}  0  0 \\\\\n\\frac{1}{C_f}  0  0  \\omega  -\\frac{1}{C_f}  0 \\\\\n0  \\frac{1}{C_f}  -\\omega  0  0  -\\frac{1}{C_f} \\\\\n0  0  \\frac{1}{L_2}  0  -\\frac{R_2}{L_2}  \\omega \\\\\n0  0  0  \\frac{1}{L_2}  -\\omega  -\\frac{R_2}{L_2}\n\\end{pmatrix}.\n$$\n\n为完整起见，与推导过程一致的输入矩阵和扰动矩阵为\n$$\nB = \\begin{pmatrix}\n\\frac{1}{L_1}  0 \\\\\n0  \\frac{1}{L_1} \\\\\n0  0 \\\\\n0  0 \\\\\n0  0 \\\\\n0  0\n\\end{pmatrix}, \\quad\nE = \\begin{pmatrix}\n0  0 \\\\\n0  0 \\\\\n0  0 \\\\\n0  0 \\\\\n-\\frac{1}{L_2}  0 \\\\\n0  -\\frac{1}{L_2}\n\\end{pmatrix},\n$$\n这反映了 $v_{dq}$ 直接作用于逆变器侧电感，而 $v_{g,dq}$ 通过电网侧电感进入系统。然而，根据要求，最终答案是显式的 $A$ 矩阵。",
            "answer": "$$\\boxed{\\begin{pmatrix}\n-\\frac{R_1}{L_1}  \\omega  -\\frac{1}{L_1}  0  0  0 \\\\\n-\\omega  -\\frac{R_1}{L_1}  0  -\\frac{1}{L_1}  0  0 \\\\\n\\frac{1}{C_f}  0  0  \\omega  -\\frac{1}{C_f}  0 \\\\\n0  \\frac{1}{C_f}  -\\omega  0  0  -\\frac{1}{C_f} \\\\\n0  0  \\frac{1}{L_2}  0  -\\frac{R_2}{L_2}  \\omega \\\\\n0  0  0  \\frac{1}{L_2}  -\\omega  -\\frac{R_2}{L_2}\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "建立了设备模型后，我们便可以分析系统在扰动下的动态行为。本练习将重点转向系统级的动态响应，应用虚拟同步机（VSM）的概念。您将学习如何使用摇摆方程来预测在负荷突变下系统的关键性能指标，如频率最低点（nadir）和频率变化率（RoCoF），并将这些指标与实际的电网规范要求联系起来。",
            "id": "3843997",
            "problem": "一个配置有虚拟同步机 (VSM) 的构网型 (GFM) 换流器在一个电力系统中运行，该系统的额定频率为 $f_{0} = 50 \\ \\mathrm{Hz}$，额定视在功率为 $S_{\\mathrm{base}} = 50 \\ \\mathrm{MW}$。其虚拟惯性常数为 $H = 4 \\ \\mathrm{s}$。该换流器采用线性有功功率-频率下垂控制，其斜率为 $m_{p} = 0.040 \\ \\mathrm{Hz}/\\mathrm{MW}$。在时间 $t = 0$ 时，系统经历一个幅度为 $\\Delta P = 15 \\ \\mathrm{MW}$ 的正有功功率负荷阶跃。\n\n使用同步机等效的摇摆动态方程和将频率偏差映射到有功功率调制的线性下垂定律，对带有VSM增广的GFM进行建模。假设测量和驱动理想无延迟，损耗可忽略不计，且无二次频率恢复。将负荷阶跃视为电力需求的一个理想阶跃。\n\n从同步机等效形式下转子频率与功率不平衡之间的基本动态关系，以及将稳态频率偏差与有功功率偏差联系起来的下垂控制定义出发，推导由阶跃 $\\Delta P$ 引起的时间域频率偏差 $\\Delta f(t)$，并确定频率偏差的最大幅值（对于正的负荷阶跃，即频率最低点）。此外，评估其是否符合以下电网导则阈值：\n- 最大频率偏差不得超过 $0.8 \\ \\mathrm{Hz}$。\n- 最大频率变化率 (RoCoF) 不得超过 $1.0 \\ \\mathrm{Hz}/\\mathrm{s}$。\n\n给出最大频率偏差的最终数值。将最终答案四舍五入到四位有效数字。以 $\\mathrm{Hz}$ 为单位表示最终频率偏差。",
            "solution": "首先根据指定的标准对问题进行验证。\n\n### 问题验证\n\n#### 步骤1：提取给定条件\n- 额定频率: $f_{0} = 50 \\ \\mathrm{Hz}$\n- 额定视在功率: $S_{\\mathrm{base}} = 50 \\ \\mathrm{MW}$\n- 虚拟惯性常数: $H = 4 \\ \\mathrm{s}$\n- 有功功率-频率下垂斜率: $m_{p} = 0.040 \\ \\mathrm{Hz}/\\mathrm{MW}$\n- 有功功率负荷阶跃: $\\Delta P = 15 \\ \\mathrm{MW}$ (在 $t=0$ 时)\n- 系统模型: 同步机等效摇摆动态与线性下垂控制。\n- 假设: 理想的测量和驱动，无延迟，损耗可忽略不计，无二次频率恢复。\n- 电网导则阈值:\n  - 最大频率偏差: $|\\Delta f(t)| \\le 0.8 \\ \\mathrm{Hz}$\n  - 最大频率变化率 (RoCoF): $|\\frac{df}{dt}| \\le 1.0 \\ \\mathrm{Hz/s}$\n\n#### 步骤2：使用提取的给定条件进行验证\n1.  **科学依据：** 该问题基于用于电力系统动态分析的标准且广为接受的摇摆方程模型和线性下垂控制，这些是电力工程中的基本概念。所给参数具有物理现实性。\n2.  **适定性：** 该问题提供了清晰的初始条件（稳态运行）、明确定义的扰动（阶跃变化）和一个标准的线性时不变系统模型。这种结构保证了解的唯一性和稳定性。\n3.  **客观性：** 问题使用精确的、定量的语言和公认的技术术语进行陈述。它没有歧义和主观论断。\n4.  **完整性与一致性：** 所有必要的参数（$f_0$、$S_{\\mathrm{base}}$、$H$、$m_p$、$\\Delta P$）都已提供。$S_{\\mathrm{base}}$ 的单位给出为 MW；虽然通常是 VA，但在忽略无功功率动态时，使用 MW 作为惯性常数关系的功率基准是一种常见且可接受的简化。给定条件是自洽的。\n\n#### 步骤3：结论与行动\n该问题是有效的。它是一个电力系统动态学中适定且有科学依据的问题。将推导完整的解答。\n\n### 解答推导\n\n虚拟机同步机 (VSM) 的动态特性由摇摆方程建模，该方程将频率变化率与指令“机械”功率 $P_m$ 和电功率输出 $P_e$ 之间的功率不平衡联系起来。以绝对（物理）单位表示，摇摆方程为：\n$$ \\frac{2 H S_{\\mathrm{base}}}{f_0} \\frac{df(t)}{dt} = P_m(t) - P_e(t) $$\n其中 $f(t)$ 是系统频率，$H$ 是惯性常数，$S_{\\mathrm{base}}$ 是额定功率，$f_0$ 是额定频率。\n\n我们定义相对于扰动前稳态值的偏差。在时间 $t  0$ 时，初始条件为 $f(t) = f_0$，换流器处于稳态，其 $P_m(t) = P_{m0}$ 且 $P_e(t) = P_{e0}$，因此 $P_{m0} = P_{e0}$。\n\n在时间 $t=0$ 时，发生一个大小为 $\\Delta P$ 的负荷阶跃。电功率输出瞬时增加以满足此需求，因此对于 $t \\ge 0$：\n$$ P_e(t) = P_{e0} + \\Delta P $$\n\nVSM 采用下垂控制，其中指令功率 $P_m$ 根据频率偏差 $\\Delta f(t) = f(t) - f_0$ 进行调整。线性下垂定律由下式给出：\n$$ P_m(t) - P_{m0} = -\\frac{1}{m_p} \\Delta f(t) $$\n负号表示频率下降（$\\Delta f  0$）会导致功率注入增加。因此，\n$$ P_m(t) = P_{m0} - \\frac{1}{m_p} \\Delta f(t) $$\n\n将 $P_m(t)$ 和 $P_e(t)$ 的表达式代入摇摆方程，并注意到 $\\frac{df(t)}{dt} = \\frac{d(f_0 + \\Delta f(t))}{dt} = \\frac{d\\Delta f(t)}{dt}$：\n$$ \\frac{2 H S_{\\mathrm{base}}}{f_0} \\frac{d\\Delta f(t)}{dt} = \\left(P_{m0} - \\frac{1}{m_p} \\Delta f(t)\\right) - (P_{e0} + \\Delta P) $$\n由于 $P_{m0} = P_{e0}$，方程简化为：\n$$ \\frac{2 H S_{\\mathrm{base}}}{f_0} \\frac{d\\Delta f(t)}{dt} = -\\frac{1}{m_p} \\Delta f(t) - \\Delta P $$\n\n这是一个一阶线性常微分方程。将其整理为标准形式 $\\frac{dy}{dt} + a y = b$：\n$$ \\frac{d\\Delta f(t)}{dt} + \\left(\\frac{f_0}{2 H S_{\\mathrm{base}} m_p}\\right) \\Delta f(t) = -\\frac{f_0 \\Delta P}{2 H S_{\\mathrm{base}}} $$\n初始条件是由于惯性，频率是连续的，因此在 $t=0^+$ 时的偏差为零：$\\Delta f(0^+) = 0$。\n\n该微分方程的解具有形式 $\\Delta f(t) = \\Delta f_{ss} + (\\Delta f(0) - \\Delta f_{ss}) e^{-t/\\tau}$，其中 $\\Delta f_{ss}$ 是稳态偏差，$\\tau$ 是时间常数。\n\n时间常数 $\\tau$ 是 $\\Delta f(t)$ 项系数的倒数：\n$$ \\tau = \\left(\\frac{f_0}{2 H S_{\\mathrm{base}} m_p}\\right)^{-1} = \\frac{2 H S_{\\mathrm{base}} m_p}{f_0} $$\n稳态偏差 $\\Delta f_{ss}$ 通过设置 $\\frac{d\\Delta f}{dt} = 0$ 来求得：\n$$ \\frac{f_0}{2 H S_{\\mathrm{base}} m_p} \\Delta f_{ss} = -\\frac{f_0 \\Delta P}{2 H S_{\\mathrm{base}}} \\implies \\Delta f_{ss} = -m_p \\Delta P $$\n这个结果与下垂控制的定义一致。\n\n将初始条件 $\\Delta f(0) = 0$ 代入通解：\n$$ \\Delta f(t) = \\Delta f_{ss} + (0 - \\Delta f_{ss}) e^{-t/\\tau} = \\Delta f_{ss} (1 - e^{-t/\\tau}) $$\n代入 $\\Delta f_{ss}$ 的表达式：\n$$ \\Delta f(t) = -m_p \\Delta P (1 - e^{-t/\\tau}) $$\n\n现在，我们代入数值：\n- $\\Delta P = 15 \\ \\mathrm{MW}$\n- $m_p = 0.040 \\ \\mathrm{Hz}/\\mathrm{MW}$\n- $H = 4 \\ \\mathrm{s}$\n- $S_{\\mathrm{base}} = 50 \\ \\mathrm{MW}$\n- $f_0 = 50 \\ \\mathrm{Hz}$\n\n稳态频率偏差为：\n$$ \\Delta f_{ss} = -(0.040 \\ \\mathrm{Hz}/\\mathrm{MW}) \\times (15 \\ \\mathrm{MW}) = -0.6 \\ \\mathrm{Hz} $$\n时间常数为：\n$$ \\tau = \\frac{2 \\times (4 \\ \\mathrm{s}) \\times (50 \\ \\mathrm{MW}) \\times (0.040 \\ \\mathrm{Hz}/\\mathrm{MW})}{50 \\ \\mathrm{Hz}} = \\frac{16}{50} \\ \\mathrm{s} = 0.32 \\ \\mathrm{s} $$\n因此，时域频率偏差为：\n$$ \\Delta f(t) = -0.6 (1 - e^{-t/0.32}) \\ \\mathrm{Hz} $$\n\n对于此一阶响应，频率偏差的最大幅值（最低点）发生在稳态（$t \\to \\infty$）：\n$$ |\\Delta f|_{\\max} = \\lim_{t \\to \\infty} |\\Delta f(t)| = |-0.6| \\ \\mathrm{Hz} = 0.6 \\ \\mathrm{Hz} $$\n\n### 电网导则符合性评估\n\n1.  **最大频率偏差：**\n    计算出的最大偏差为 $|\\Delta f|_{\\max} = 0.6 \\ \\mathrm{Hz}$。电网导则限制为 $0.8 \\ \\mathrm{Hz}$。由于 $0.6 \\ \\mathrm{Hz} \\le 0.8 \\ \\mathrm{Hz}$，系统**符合**频率偏差阈值。\n\n2.  **最大频率变化率 (RoCoF)：**\n    RoCoF 是频率的时间导数。我们可以通过对 $\\Delta f(t)$ 求导或从常微分方程的初始状态来找到其最大值。\n    在 $t=0^+$ 时，$\\Delta f(0^+) = 0$。常微分方程给出：\n    $$ \\frac{d\\Delta f(t)}{dt}\\bigg|_{t=0^+} = -\\frac{f_0 \\Delta P}{2 H S_{\\mathrm{base}}} $$\n    这是 RoCoF 的初始值，因此也是其最大幅值。\n    $$ \\mathrm{RoCoF}_{\\max} = \\frac{d\\Delta f(t)}{dt}\\bigg|_{t=0^+} = -\\frac{(50 \\ \\mathrm{Hz}) \\times (15 \\ \\mathrm{MW})}{2 \\times (4 \\ \\mathrm{s}) \\times (50 \\ \\mathrm{MW})} = -\\frac{750}{400} \\ \\mathrm{Hz/s} = -1.875 \\ \\mathrm{Hz/s} $$\n    RoCoF 的最大幅值为 $|\\mathrm{RoCoF}|_{\\max} = 1.875 \\ \\mathrm{Hz/s}$。电网导则限制为 $1.0 \\ \\mathrm{Hz/s}$。由于 $1.875 \\ \\mathrm{Hz/s} > 1.0 \\ \\mathrm{Hz/s}$，系统**不符合** RoCoF 阈值。\n\n问题要求的是频率偏差的最大幅值。\n$$ |\\Delta f|_{\\max} = 0.6 \\ \\mathrm{Hz} $$\n四舍五入到四位有效数字得到 $0.6000$。",
            "answer": "$$\\boxed{0.6000}$$"
        },
        {
            "introduction": "系统稳定性通常依赖于控制环路的精心设计与优化。本练习提供了一个小信号分析的实践机会，重点关注构网型逆变器的内部电压控制环路。您将通过构建状态空间模型并分析其特征值，来探索如何利用虚拟阻抗技术主动抑制振荡，从而提高控制器的稳定性。",
            "id": "3844073",
            "problem": "为一个三相构网型逆变器（该逆变器带有一个输出电感和并联电容，为阻性负载供电）的电压控制环构建一个线性时不变小信号模型，该模型在同步旋转参考坐标系中建模。使用基尔霍夫电流定律（KCL）、基尔霍夫电压定律（KVL）和Park变换的性质。逆变器的控制器是一个比例积分（PI）电压调节器，其虚拟串联阻抗实现为与电感电流成比例的电阻压降。\n\n假设与基本建模基础：\n- 被控对象由逆变器电压源和电容器之间的一个串联输出电感 $L_f$，以及在公共耦合点（PCC）处的一个并联电容 $C_f$ 组成，该电容为一个阻性负载 $R_{\\mathrm{load}}$ 供电。\n- 模型在额定角速度 $\\omega_0$ 下的同步旋转$dq$坐标系中表示，其中由旋转坐标系引起的交叉耦合项表现为$d$轴和$q$轴之间 $\\pm \\omega_0$ 的耦合。\n- 负载在静止坐标系中是纯阻性的；在与额定电网电压对齐的$dq$坐标系中，对于小信号，它表示为 $i_{\\ell,d} = v_{c,d}/R_{\\mathrm{load}}$ 和 $i_{\\ell,q} = v_{c,q}/R_{\\mathrm{load}}$。\n- 电压控制器根据电容电压误差的PI律生成逆变器极点电压指令 $\\mathbf{u} = [u_d, u_q]^\\top$，并带有一个与电感电流串联的虚拟电阻抗 $R_v$。在具有恒定参考值 $v_{\\mathrm{ref},d} = V_0$ 和 $v_{\\mathrm{ref},q} = 0$ 的稳态工作点附近，小信号控制律为\n$$\n\\delta u_d = -K_p\\,\\delta v_{c,d} + K_i\\,\\delta \\xi_d - R_v\\,\\delta i_d,\\quad\n\\delta u_q = -K_p\\,\\delta v_{c,q} + K_i\\,\\delta \\xi_q - R_v\\,\\delta i_q,\n$$\n其中 $\\delta \\xi_d$ 和 $\\delta \\xi_q$ 是积分器状态，服从\n$$\n\\delta \\dot{\\xi}_d = -\\delta v_{c,d},\\quad \\delta \\dot{\\xi}_q = -\\delta v_{c,q}。\n$$\n\n$dq$坐标系中的小信号被控对象方程由电感上的KVL和电容节点处的KCL得出：\n- 电感电流动态：\n$$\n\\delta \\dot{i}_d = \\frac{1}{L_f}\\left( \\delta u_d - \\delta v_{c,d} \\right) + \\omega_0\\,\\delta i_q,\\quad\n\\delta \\dot{i}_q = \\frac{1}{L_f}\\left( \\delta u_q - \\delta v_{c,q} \\right) - \\omega_0\\,\\delta i_d.\n$$\n- 电容电压动态：\n$$\n\\delta \\dot{v}_{c,d} = \\frac{1}{C_f}\\left( \\delta i_d - \\frac{\\delta v_{c,d}}{R_{\\mathrm{load}}} \\right) + \\omega_0\\,\\delta v_{c,q},\\quad\n\\delta \\dot{v}_{c,q} = \\frac{1}{C_f}\\left( \\delta i_q - \\frac{\\delta v_{c,q}}{R_{\\mathrm{load}}} \\right) - \\omega_0\\,\\delta v_{c,d}.\n$$\n\n任务：\n1. 使用上述基本关系，组装线性时不变状态空间模型 $\\delta \\dot{x} = A(R_v)\\,\\delta x$，状态向量为 $\\delta x = [\\delta i_d,\\ \\delta i_q,\\ \\delta v_{c,d},\\ \\delta v_{c,q},\\ \\delta \\xi_d,\\ \\delta \\xi_q]^\\top$，明确地将状态矩阵 $A(R_v)$ 表示为虚拟电阻 $R_v$、被控对象参数和PI增益的函数。\n2. 对于给定的数值\n$$\nL_f = 1.5\\times 10^{-3}\\ \\mathrm{H},\\quad\nC_f = 40\\times 10^{-6}\\ \\mathrm{F},\\quad\nR_{\\mathrm{load}} = 25.0\\ \\Omega,\\quad\n\\omega_0 = 314.159265\\ \\mathrm{rad/s},\n$$\n和控制器增益\n$$\nK_p = 0.2,\\quad K_i = 500.0,\n$$\n计算下面测试集中列出的每个虚拟电阻 $R_v$ 测试值对应的 $A(R_v)$ 的特征值。对于每个 $R_v$，提取所有特征值中的最大实部。以 $\\mathrm{s}^{-1}$ 为单位报告这些值，并四舍五入到六位小数。\n\n$R_v$的测试集：\n- 情况1：$R_v = 0.0\\ \\Omega$ (无虚拟阻尼)。\n- 情况2：$R_v = 0.1\\ \\Omega$ (小虚拟阻尼)。\n- 情况3：$R_v = 0.5\\ \\Omega$ (中等虚拟阻尼)。\n- 情况4：$R_v = 2.0\\ \\Omega$ (高虚拟阻尼)。\n- 情况5：$R_v = 10.0\\ \\Omega$ (极大虚拟阻尼)。\n\n最终输出规格：\n- 您的程序应产生单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_k$ 是对应测试情况下 $A(R_v)$ 特征值的最大实部（单位为 $\\mathrm{s}^{-1}$，四舍五入到六位小数）。\n- 角度已指定为弧度；无需进行角度转换。所有报告的值均以 $\\mathrm{s}^{-1}$ 为单位，并应在输出字符串中以纯小数形式提供，不带单位。",
            "solution": "该问题要求为三相构网型逆变器的电压控制环构建一个线性时不变（LTI）状态空间模型 $\\delta \\dot{x} = A(R_v)\\,\\delta x$，并通过计算不同虚拟电阻 $R_v$ 值下状态矩阵 $A(R_v)$ 的特征值来分析其稳定性。\n\n状态空间表示是通过将每个状态变量的时间导数表示为所有状态变量的线性组合来构建的。系统的状态向量定义为 $\\delta x = [\\delta i_d,\\ \\delta i_q,\\ \\delta v_{c,d},\\ \\delta v_{c,q},\\ \\delta \\xi_d,\\ \\delta \\xi_q]^\\top$。系统动态由一组六个耦合的一阶线性微分方程描述，我们将把它们组装成矩阵形式。\n\n问题陈述中提供的基本方程源自应用于输出滤波器电感 $L_f$ 的基尔霍夫电压定律（KVL）和应用于滤波器电容 $C_f$ 节点的基尔霍夫电流定律（KCL），所有这些都变换到了同步旋转$dq$参考坐标系中。控制器动态由一个比例积分（PI）律和积分器的状态动态给出。\n\n推导过程通过将控制律代入被控对象动态以获得闭环表示。控制输入 $\\delta u_d$ 和 $\\delta u_q$ 由下式给出：\n$$\n\\delta u_d = -R_v\\,\\delta i_d - K_p\\,\\delta v_{c,d} + K_i\\,\\delta \\xi_d\n$$\n$$\n\\delta u_q = -R_v\\,\\delta i_q - K_p\\,\\delta v_{c,q} + K_i\\,\\delta \\xi_q\n$$\n\n我们现在将推导状态矩阵 $A(R_v)$ 中对应于每个状态变量导数的每一行。\n\n1.  **电感电流动态（$\\delta \\dot{i}_d$, $\\delta \\dot{i}_q$）**：\n    电感 $L_f$ 的小信号KVL方程为：\n    $$\n    \\delta \\dot{i}_d = \\frac{1}{L_f}\\left( \\delta u_d - \\delta v_{c,d} \\right) + \\omega_0\\,\\delta i_q\n    $$\n    $$\n    \\delta \\dot{i}_q = \\frac{1}{L_f}\\left( \\delta u_q - \\delta v_{c,q} \\right) - \\omega_0\\,\\delta i_d\n    $$\n    代入 $\\delta u_d$ 和 $\\delta u_q$ 的表达式：\n    $$\n    \\begin{align*}\n    \\delta \\dot{i}_d = \\frac{1}{L_f}\\left( (-R_v\\,\\delta i_d - K_p\\,\\delta v_{c,d} + K_i\\,\\delta \\xi_d) - \\delta v_{c,d} \\right) + \\omega_0\\,\\delta i_q \\\\\n    = -\\frac{R_v}{L_f}\\,\\delta i_d + \\omega_0\\,\\delta i_q - \\frac{K_p+1}{L_f}\\,\\delta v_{c,d} + 0 \\cdot \\delta v_{c,q} + \\frac{K_i}{L_f}\\,\\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    \\end{align*}\n    $$\n    $$\n    \\begin{align*}\n    \\delta \\dot{i}_q = \\frac{1}{L_f}\\left( (-R_v\\,\\delta i_q - K_p\\,\\delta v_{c,q} + K_i\\,\\delta \\xi_q) - \\delta v_{c,q} \\right) - \\omega_0\\,\\delta i_d \\\\\n    = -\\omega_0\\,\\delta i_d - \\frac{R_v}{L_f}\\,\\delta i_q + 0 \\cdot \\delta v_{c,d} - \\frac{K_p+1}{L_f}\\,\\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + \\frac{K_i}{L_f}\\,\\delta \\xi_q\n    \\end{align*}\n    $$\n    这两个方程构成了状态矩阵 $A(R_v)$ 的前两行。\n\n2.  **电容电压动态（$\\delta \\dot{v}_{c,d}$, $\\delta \\dot{v}_{c,q}$）**：\n    电容 $C_f$ 的小信号KCL方程为：\n    $$\n    \\delta \\dot{v}_{c,d} = \\frac{1}{C_f}\\left( \\delta i_d - i_{\\ell,d} \\right) + \\omega_0\\,\\delta v_{c,q} = \\frac{1}{C_f}\\left( \\delta i_d - \\frac{\\delta v_{c,d}}{R_{\\mathrm{load}}} \\right) + \\omega_0\\,\\delta v_{c,q}\n    $$\n    $$\n    \\delta \\dot{v}_{c,q} = \\frac{1}{C_f}\\left( \\delta i_q - i_{\\ell,q} \\right) - \\omega_0\\,\\delta v_{c,d} = \\frac{1}{C_f}\\left( \\delta i_q - \\frac{\\delta v_{c,q}}{R_{\\mathrm{load}}} \\right) - \\omega_0\\,\\delta v_{c,d}\n    $$\n    用状态向量分量展开这些方程：\n    $$\n    \\delta \\dot{v}_{c,d} = \\frac{1}{C_f}\\,\\delta i_d + 0 \\cdot \\delta i_q - \\frac{1}{C_f R_{\\mathrm{load}}}\\,\\delta v_{c,d} + \\omega_0\\,\\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    $$\n    \\delta \\dot{v}_{c,q} = 0 \\cdot \\delta i_d + \\frac{1}{C_f}\\,\\delta i_q - \\omega_0\\,\\delta v_{c,d} - \\frac{1}{C_f R_{\\mathrm{load}}}\\,\\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    这两个方程构成了状态矩阵 $A(R_v)$ 的第三和第四行。\n\n3.  **控制器积分器状态动态（$\\delta \\dot{\\xi}_d$, $\\delta \\dot{\\xi}_q$）**：\n    PI控制器积分器状态的动态直接给出为：\n    $$\n    \\delta \\dot{\\xi}_d = -\\delta v_{c,d} = 0 \\cdot \\delta i_d + 0 \\cdot \\delta i_q - 1 \\cdot \\delta v_{c,d} + 0 \\cdot \\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    $$\n    \\delta \\dot{\\xi}_q = -\\delta v_{c,q} = 0 \\cdot \\delta i_d + 0 \\cdot \\delta i_q + 0 \\cdot \\delta v_{c,d} - 1 \\cdot \\delta v_{c,q} + 0 \\cdot \\delta \\xi_d + 0 \\cdot \\delta \\xi_q\n    $$\n    这两个方程构成了状态矩阵 $A(R_v)$ 的第五和第六行。\n\n**组装状态矩阵 $A(R_v)$**\n结合上面推导的系数，我们为系统 $\\delta \\dot{x} = A(R_v)\\,\\delta x$ 构建 $6 \\times 6$ 的状态矩阵 $A(R_v)$：\n$$\nA(R_v) = \n\\begin{pmatrix}\n-\\frac{R_v}{L_f}  \\omega_0  -\\frac{K_p+1}{L_f}  0  \\frac{K_i}{L_f}  0 \\\\\n-\\omega_0  -\\frac{R_v}{L_f}  0  -\\frac{K_p+1}{L_f}  0  \\frac{K_i}{L_f} \\\\\n\\frac{1}{C_f}  0  -\\frac{1}{C_f R_{\\mathrm{load}}}  \\omega_0  0  0 \\\\\n0  \\frac{1}{C_f}  -\\omega_0  -\\frac{1}{C_f R_{\\mathrm{load}}}  0  0 \\\\\n0  0  -1  0  0  0 \\\\\n0  0  0  -1  0  0\n\\end{pmatrix}\n$$\n该矩阵明确地定义了闭环系统的LTI小信号模型，其是虚拟电阻 $R_v$ 和其他系统参数的函数。\n\n对于问题的数值计算部分，将给定的 $L_f$、$C_f$、$R_{\\mathrm{load}}$、$\\omega_0$、$K_p$ 和 $K_i$ 的值代入此矩阵结构中。对于测试集中的每个 $R_v$ 值，构造相应的数值矩阵，并计算其特征值。系统的稳定性由这些特征值的实部来评估；所有特征值的实部为负表示系统稳定。任务是找到所有特征值中的最大实部，这对应于系统的阻尼最小（或最不稳定）的模态。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs the state-space model for a grid-forming inverter\n    and computes eigenvalues to assess stability.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: R_v = 0.0\n        0.0,\n        # Case 2: R_v = 0.1\n        0.1,\n        # Case 3: R_v = 0.5\n        0.5,\n        # Case 4: R_v = 2.0\n        2.0,\n        # Case 5: R_v = 10.0\n        10.0\n    ]\n\n    # Given numerical parameter values\n    Lf = 1.5e-3  # H\n    Cf = 40e-6   # F\n    R_load = 25.0  # Ohm\n    w0 = 314.159265  # rad/s\n    Kp = 0.2  # Proportional gain\n    Ki = 500.0  # Integral gain\n\n    results = []\n\n    def build_A_matrix(Rv):\n        \"\"\"Builds the 6x6 state matrix A for a given virtual resistance Rv.\"\"\"\n        A = np.zeros((6, 6))\n\n        # Row 1: d(delta_id)/dt\n        A[0, 0] = -Rv / Lf\n        A[0, 1] = w0\n        A[0, 2] = -(Kp + 1.0) / Lf\n        A[0, 4] = Ki / Lf\n\n        # Row 2: d(delta_iq)/dt\n        A[1, 0] = -w0\n        A[1, 1] = -Rv / Lf\n        A[1, 3] = -(Kp + 1.0) / Lf\n        A[1, 5] = Ki / Lf\n\n        # Row 3: d(delta_vc,d)/dt\n        A[2, 0] = 1.0 / Cf\n        A[2, 2] = -1.0 / (Cf * R_load)\n        A[2, 3] = w0\n\n        # Row 4: d(delta_vc,q)/dt\n        A[3, 1] = 1.0 / Cf\n        A[3, 2] = -w0\n        A[3, 3] = -1.0 / (Cf * R_load)\n\n        # Row 5: d(delta_xi,d)/dt\n        A[4, 2] = -1.0\n\n        # Row 6: d(delta_xi,q)/dt\n        A[5, 3] = -1.0\n        \n        return A\n\n    for Rv_val in test_cases:\n        # Construct the state matrix for the current test case\n        A_matrix = build_A_matrix(Rv_val)\n        \n        # Compute the eigenvalues of the matrix A\n        eigenvalues = np.linalg.eigvals(A_matrix)\n        \n        # Find the maximum of the real parts of the eigenvalues\n        max_real_part = np.max(np.real(eigenvalues))\n        \n        # Round the result to six decimal places and append to the list\n        results.append(round(max_real_part, 6))\n\n    # Format the final output string as per the specification\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}