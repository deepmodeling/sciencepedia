{
    "hands_on_practices": [
        {
            "introduction": "本次练习聚焦于现代逆变器在不平衡电网条件下的控制。我们将运用对称分量法，将抽象的电网规范（如电流不平衡度限制）转化为一个具体的控制器设计指标，即负序电流抑制因子 $S$。这揭示了外部法规如何量化地影响逆变器的内部控制设计。",
            "id": "3844430",
            "problem": "一个连接在公共耦合点（PCC）的三相并网逆变器，在正弦稳态下运行，并采用线性双序电流控制架构。根据对称分量法原理，一个不平衡的三相量可以分解为正序和负序分量，这些分量在任何线性时不变系统中都会激励解耦的序网络。因此，逆变器相对于PCC处小扰动的闭环行为，可以对每个序（正序或负序）通过一个从相应序电压到注入序电流的有效导纳映射来进行建模。记正序电压幅值为 $V_{1}$，负序电压幅值为 $V_{2}$，相关的注入电流幅值为 $I_{1}$ 和 $I_{2}$，并通过关系式 $I_{1} = Y_{1} V_{1}$ 和 $I_{2} = Y_{2} V_{2}$ 定义闭环序导纳 $Y_{1}$ 和 $Y_{2}$。一种典型的并网导则要求，在任何允许的运行工况下，负序电流与正序电流之比必须满足 $I_{2}/I_{1} \\le \\delta$，其中 $\\delta$ 是一个规定的限值。\n\n假设电网在PCC处呈现一个固定的电压不平衡，其特征为 $V_{2}/V_{1} = \\epsilon$，其中 $\\epsilon = 0.03$，且合规性要求为 $\\delta = 0.02$。使用序网络的解耦特性和上述定义，推导最小负序电流抑制因子 $S$（定义为 $S \\equiv Y_{1}/Y_{2}$），使得当电网不平衡度等于 $V_{2}/V_{1} = \\epsilon$ 时，逆变器能保证满足 $I_{2}/I_{1} \\le \\delta$ 的要求。将最终答案表示为一个无量纲的乘法因子。无需四舍五入。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、提法恰当且客观。\n\n### 步骤 1：提取已知条件\n-   **系统**：在正弦稳态下运行的三相并网逆变器。\n-   **控制模型**：基于对称分量法的解耦序网络。\n-   **正序关系**：正序注入电流幅值 $I_{1}$ 与正序电压幅值 $V_{1}$ 之间的关系由 $I_{1} = Y_{1} V_{1}$ 给出，其中 $Y_{1}$ 是闭环正序导纳的幅值。\n-   **负序关系**：负序注入电流幅值 $I_{2}$ 与负序电压幅值 $V_{2}$ 之间的关系由 $I_{2} = Y_{2} V_{2}$ 给出，其中 $Y_{2}$ 是闭环负序导纳的幅值。\n-   **并网导则要求**：负序电流幅值与正序电流幅值之比必须满足 $\\frac{I_{2}}{I_{1}} \\le \\delta$。\n-   **电网电压条件**：电网在公共耦合点（PCC）呈现一个固定的电压不平衡，其特征为比率 $\\frac{V_{2}}{V_{1}} = \\epsilon$。\n-   **抑制因子定义**：负序电流抑制因子定义为 $S \\equiv \\frac{Y_{1}}{Y_{2}}$。\n-   **数值**：规定的电流不平衡限值为 $\\delta = 0.02$。电网电压不平衡因子为 $\\epsilon = 0.03$。\n-   **目标**：推导抑制因子 $S$ 的最小值，以保证逆变器在指定的电网电压条件下满足并网导则的要求。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于对称分量法理论，这是分析不平衡三相电力系统的基本标准方法。用序导纳来模拟逆变器闭环行为的概念，是电力电子和电力系统工程中一个成熟且正确的实践。所有概念都具有科学合理性。\n-   **提法恰当性**：该问题为所有变量和常量提供了清晰的定义。关系是线性的，并以代数方式定义，从而为指定的边界条件导出了唯一的解。目标陈述明确。\n-   **客观性**：问题以精确的技术语言陈述，没有任何主观性或歧义。\n-   **完整性与一致性**：所有必要的数据（$\\epsilon$, $\\delta$）和定义（$Y_1, Y_2, S$）都已提供。这些定义内部一致，足以求解未知量。\n-   **现实性**：电压不平衡（$\\epsilon = 3\\%$）和电流注入限制（$\\delta = 2\\%$）的数值是现实的，并代表了国际并网导则和分布式能源标准中的典型值。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。这是一个提法恰当、有科学依据的电气工程问题，旨在测试对不平衡电网条件下逆变器控制的理解。可以制定出严谨的求解过程。\n\n### 求解推导\n目标是确定负序电流抑制因子 $S$ 的最小值，以确保在特定的电网电压不平衡条件下满足并网导则的要求。\n\n电压和电流的序分量幅值之间的基本关系如下：\n$$I_{1} = Y_{1} V_{1}$$\n$$I_{2} = Y_{2} V_{2}$$\n此处，$Y_{1}$ 和 $Y_{2}$ 分别是正序和负序的有效导纳的幅值。假设它们是正实数。\n\n并网导则对负序电流幅值与正序电流幅值之比施加了上限：\n$$\\frac{I_{2}}{I_{1}} \\le \\delta$$\n\n为分析此要求，我们首先使用给定的导纳关系来表示比率 $\\frac{I_{2}}{I_{1}}$：\n$$\\frac{I_{2}}{I_{1}} = \\frac{Y_{2} V_{2}}{Y_{1} V_{1}}$$\n\n这个表达式可以重新整理，将导纳比和电压比组合在一起：\n$$\\frac{I_{2}}{I_{1}} = \\left(\\frac{Y_{2}}{Y_{1}}\\right) \\left(\\frac{V_{2}}{V_{1}}\\right)$$\n\n问题将负序电流抑制因子定义为 $S \\equiv \\frac{Y_{1}}{Y_{2}}$。因此，序导纳之比可以表示为 $\\frac{Y_{2}}{Y_{1}} = \\frac{1}{S}$。电网的电压不平衡度由 $\\frac{V_{2}}{V_{1}} = \\epsilon$ 给出。将这些定义代入电流比的方程中，得到：\n$$\\frac{I_{2}}{I_{1}} = \\frac{1}{S} \\cdot \\epsilon = \\frac{\\epsilon}{S}$$\n\n现在，我们将并网导则的要求应用于此表达式：\n$$\\frac{\\epsilon}{S} \\le \\delta$$\n\n我们需要找到保证此不等式成立的 $S$ 的最小值。由于 $S$、$\\epsilon$ 和 $\\delta$ 都是正量，我们可以重新整理不等式而无需改变其方向：\n$$\\epsilon \\le S \\cdot \\delta$$\n$$S \\ge \\frac{\\epsilon}{\\delta}$$\n\n这个不等式表明，为使逆变器合规，抑制因子 $S$ 必须大于或等于电压不平衡因子 $\\epsilon$ 与电流不平衡限值 $\\delta$ 的比值。所有合规的 $S$ 值集合是区间 $\\left[\\frac{\\epsilon}{\\delta}, \\infty\\right)$。\n\n问题要求的是 $S$ 的“最小”值。在此类科学和工程学的边值问题背景下，“最小”指的是允许值集合的下确界，即最大下界。这个边界值代表了合规的阈值。因此，所需的最小抑制因子，我们可以记为 $S_{min}$，是：\n$$S_{min} = \\frac{\\epsilon}{\\delta}$$\n\n任何 $S \\ge S_{min}$ 的值都将保证合规。$S_{min}$ 本身代表了临界边界。\n\n最后，我们代入所提供的数值，$\\epsilon = 0.03$ 和 $\\delta = 0.02$：\n$$S_{min} = \\frac{0.03}{0.02} = \\frac{3}{2} = 1.5$$\n\n因此，逆变器的正序导纳必须至少是其负序导纳的 $1.5$ 倍，以确保在电网电压不平衡度为 $3\\%$ 时，负序电流注入量保持在 $2\\%$ 的限值以下。",
            "answer": "$$\\boxed{1.5}$$"
        },
        {
            "introduction": "逆变器的动态响应与稳态性能同样重要。本练习探讨了电压-无功（volt-var）支持功能的稳定性，分析了通信延迟 $T_d$ 等现实因素如何侵蚀系统的相位裕度。通过计算，您将确定为保证稳定运行所能接受的最大延迟，从而理解动态性能在并网标准中的关键作用。",
            "id": "3844400",
            "problem": "一台三相并网逆变器执行电压-无功功率（伏-乏）函数，以满足现代并网规范要求的动态无功支持，例如在监控曲线更新下，在无功功率外环控制回路中保持最小的稳定裕度。考虑该伏-乏外环的设计，在没有任何指令路径延迟的情况下，其在回路穿越频率处的开环相位等于 $-90^\\circ$，对应于 $90^\\circ$ 的标称相位裕度。监控控制器通过一个通信链路传输伏-乏曲线更新，该链路引入了指令延迟，此延迟可在回路中建模为纯时间延迟。控制带宽（等于回路穿越频率）为 $1\\,\\text{Hz}$。使用相位裕度的基本定义以及纯时间延迟对相位的频域效应，确定在计入延迟后能确保实际达到的相位裕度至少为 $45^\\circ$ 的最大可接受指令延迟。最终答案以秒为单位表示，并四舍五入到三位有效数字。所有角度均以度为单位。",
            "solution": "该问题被认为是有效的，因为它在应用于电力电子学的控制理论方面具有科学依据，提法得当，信息充分且一致，并以客观、正式的语言表达。没有可识别的缺陷。\n\n为解决此问题，我们必须首先理解相位裕度的定义以及时间延迟对系统在频域中相位的影响。\n\n系统的相位裕度 $PM$ 在其回路穿越频率 $f_c$ 处定义。穿越频率是开环增益的幅值为1（$0\\,\\text{dB}$）时的频率。相位裕度是在穿越频率处使系统达到不稳定边缘所需的额外相位滞后量。其数学表达式为：\n$$PM = 180^\\circ + \\phi_{OL}(f_c)$$\n其中 $\\phi_{OL}(f_c)$ 是在穿越频率 $f_c$ 处计算的开环传递函数的相位。所有角度均以度为单位。\n\n题目指出，对于标称系统（无指令延迟），在穿越频率处的开环相位为 $\\phi_{OL, nominal}(f_c) = -90^\\circ$。穿越频率，也就是控制带宽，给定为 $f_c = 1\\,\\text{Hz}$。\n因此，标称相位裕度 $PM_{nominal}$ 为：\n$$PM_{nominal} = 180^\\circ + (-90^\\circ) = 90^\\circ$$\n这证实了题目陈述中给出的值，验证了所提供信息的一致性。\n\n引入了一个指令延迟，它被建模为持续时间为 $T_d$ 的纯时间延迟。在拉普拉斯域中，时间延迟由传递函数 $G_d(s) = \\exp(-sT_d)$ 表示。为了找出其在频域中对相位的影响，我们代入 $s = j\\omega = j2\\pi f$，其中 $j$ 是虚数单位，$\\omega$ 是以弧度/秒为单位的角频率，而 $f$ 是以赫兹为单位的频率。\n该延迟的频率响应为 $G_d(j\\omega) = \\exp(-j\\omega T_d) = \\exp(-j2\\pi f T_d)$。这是一个幅值为 $1$、相角为 $\\Delta\\phi(f) = -2\\pi f T_d$ 弧度的复数。为了使用度为单位，我们转换该相移：\n$$\\Delta\\phi(f) [^\\circ] = (-2\\pi f T_d \\,\\text{rad}) \\times \\frac{180^\\circ}{\\pi \\,\\text{rad}} = -360^\\circ f T_d$$\n这个额外的相位滞后 $\\Delta\\phi$ 被加到开环系统的标称相位上。在穿越频率 $f_c$ 处，新的总开环相位 $\\phi_{OL, total}$ 为：\n$$\\phi_{OL, total}(f_c) = \\phi_{OL, nominal}(f_c) + \\Delta\\phi(f_c)$$\n$$\\phi_{OL, total}(f_c) = -90^\\circ - 360^\\circ f_c T_d$$\n\n实际达到的相位裕度 $PM_{achieved}$ 使用这个新的总相位计算得出：\n$$PM_{achieved} = 180^\\circ + \\phi_{OL, total}(f_c)$$\n$$PM_{achieved} = 180^\\circ + (-90^\\circ - 360^\\circ f_c T_d)$$\n$$PM_{achieved} = 90^\\circ - 360^\\circ f_c T_d$$\n这个方程表明，时间延迟使相位裕度从其标称值 $90^\\circ$ 减小。\n\n题目要求实际达到的相位裕度必须至少为 $45^\\circ$，即 $PM_{achieved} \\ge 45^\\circ$。为了找到最大可接受指令延迟（我们记为 $T_{d, max}$），我们将实际达到的相位裕度设置为其最小允许值：\n$$45^\\circ = 90^\\circ - 360^\\circ f_c T_{d, max}$$\n现在，我们求解 $T_{d, max}$：\n$$360^\\circ f_c T_{d, max} = 90^\\circ - 45^\\circ$$\n$$360^\\circ f_c T_{d, max} = 45^\\circ$$\n$$T_{d, max} = \\frac{45^\\circ}{360^\\circ f_c}$$\n给定穿越频率 $f_c = 1\\,\\text{Hz}$。将此值代入方程：\n$$T_{d, max} = \\frac{45}{360 \\times 1} \\,\\text{s}$$\n$$T_{d, max} = \\frac{1}{8} \\,\\text{s}$$\n将此分数转换为小数得到：\n$$T_{d, max} = 0.125 \\,\\text{s}$$\n题目要求答案四舍五入到三位有效数字。数值 $0.125$ 已经恰好有三位有效数字（$1$、$2$ 和 $5$）。因此，无需进一步四舍五入。\n最大可接受指令延迟为 $0.125$ 秒。",
            "answer": "$$\\boxed{0.125}$$"
        },
        {
            "introduction": "这项综合性练习旨在将多个并网要求整合到一个统一的故障电流注入算法中。您将设计一个策略，它能优先提供正序无功功率以支撑电网电压，同时利用剩余电流能力抑制负序分量，且始终不超过硬件的电流限值。通过这个编程实践，您将把分散的理论要求合成为一个完整、实用的控制逻辑。",
            "id": "3844445",
            "problem": "一台三相并网电压源换流器必须遵守并网导则规定的电压暂降支撑要求，同时保护其功率半导体和接口变压器免受过电流损害。该换流器可以使用序域控制器独立控制正序和负序电流。请设计并实现一个算法，在给定三相电压相量和参数限制的情况下，计算序域电流参考值，以 (i) 根据与电压降低成比例的斜率要求注入正序无功电流，以及 (ii) 提供与测得的负序电压成比例的负序电流，同时确保组合电流幅值不超过可用的电流能力。\n\n以下基本事实和定义适用，且必须用于推导该策略：\n\n- 对称分量：对于代表相-中线电压（角度以弧度为单位）的复数相量 $V_a$、$V_b$、$V_c$，算子为 $a = e^{j \\frac{2\\pi}{3}}$。正序电压为 $V_1 = \\frac{1}{3}(V_a + a V_b + a^2 V_c)$，负序电压为 $V_2 = \\frac{1}{3}(V_a + a^2 V_b + a V_c)$。由于变压器接地和换流器拓扑抑制的假设，零序分量被忽略。所有相量均以标幺值表示。\n- 三相系统的复功率：$S = P + jQ = 3 V I^*$，其中 $V$ 和 $I$ 是所考虑序分量的每相相量，$P$ 是有功功率，$Q$ 是无功功率。无有功功率的无功支撑对应于与电压正交的电流，即 $I$ 相对于 $V$ 旋转 $\\pm \\frac{\\pi}{2}$。\n- 电流能力限值：为避免换流器和变压器过流，可用电流限值为 $I_{\\text{cap}} = \\min(I_{\\text{conv,max}}, I_{\\text{tr,max}})$，其中 $I_{\\text{conv,max}}$ 是换流器电流能力，$I_{\\text{tr,max}}$ 是变压器电流能力。组合的正序和负序电流幅值受方和根关系 $|I_1|^2 + |I_2|^2 \\le I_{\\text{cap}}^2$ 的约束。\n\n该策略必须基于上述基础进行推导，并按如下方式实现：\n\n1. 根据给定的 $V_a$、$V_b$ 和 $V_c$ 计算 $V_1$ 和 $V_2$。\n2. 正序无功电流要求：将所需的正序无功电流幅值定义为 $i_{q1}^{\\text{req}} = k_r \\max(0, 1 - |V_1|)$，其中 $k_r$ 是并网导则的斜率参数。设置原始正序电流相量与 $V_1$ 正交，以便在无有功功率交换的情况下向电网注入无功功率：如果 $|V_1| > \\epsilon$，则 $I_1^{\\text{raw}} = -j\\, i_{q1}^{\\text{req}} \\frac{V_1}{|V_1|}$；如果 $|V_1| \\le \\epsilon$，则 $I_1^{\\text{raw}} = -j\\, i_{q1}^{\\text{req}}$，其中 $\\epsilon$ 是一个用于保证数值稳定性的正小阈值。角度以弧度为单位。\n3. 负序抑制：定义一个虚拟负序导纳 $Y_2 = G_2 + j B_2$，并计算原始负序电流为 $I_2^{\\text{raw}} = Y_2 V_2$。\n4. 限值下的电流分配：令 $I_{\\text{cap}} = \\min(I_{\\text{conv,max}}, I_{\\text{tr,max}})$。如果 $|I_1^{\\text{raw}}| \\ge I_{\\text{cap}}$，则按比例缩放 $I_1 = I_1^{\\text{raw}} \\frac{I_{\\text{cap}}}{|I_1^{\\text{raw}}|}$ 并设置 $I_2 = 0$。否则，设置 $I_1 = I_1^{\\text{raw}}$ 并计算裕度 $h = \\sqrt{I_{\\text{cap}}^2 - |I_1|^2}$。如果 $|I_2^{\\text{raw}}| \\le h$，则设置 $I_2 = I_2^{\\text{raw}}$；否则按比例缩放 $I_2 = I_2^{\\text{raw}} \\frac{h}{|I_2^{\\text{raw}}|}$。报告一个布尔标志，指示是否因限值而发生了任何缩放。\n\n所有量均为标幺值，所有角度均为弧度。您的程序必须实现上述算法，对以下测试套件进行操作，并生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。对于每个测试案例，输出一个形式为 $[|I_1|, |I_2|, \\text{over\\_limit}]$ 的列表，其中 $|I_1|$ 和 $|I_2|$ 是分配的正序和负序电流参考值的幅值（单位为标幺值），$\\text{over\\_limit}$ 是一个布尔值，指示是否因电流限制而应用了任何缩放。\n\n使用以下具有科学上合理参数的测试套件：\n\n- 案例1（平衡电压暂降，正常情况）：$|V_a| = 0.8$，$\\angle V_a = 0$， $|V_b| = 0.8$，$\\angle V_b = -\\frac{2\\pi}{3}$， $|V_c| = 0.8$，$\\angle V_c = +\\frac{2\\pi}{3}$，$k_r = 1.5$，$G_2 = 0.0$，$B_2 = 0.0$，$I_{\\text{conv,max}} = 1.0$，$I_{\\text{tr,max}} = 1.2$。\n- 案例2（中度不平衡与负序支持）：$|V_a| = 0.7$，$\\angle V_a = 0$， $|V_b| = 1.0$，$\\angle V_b = -\\frac{2\\pi}{3}$， $|V_c| = 1.0$，$\\angle V_c = +\\frac{2\\pi}{3}$，$k_r = 1.5$，$G_2 = 0.5$，$B_2 = 0.0$，$I_{\\text{conv,max}} = 0.8$，$I_{\\text{tr,max}} = 1.0$。\n- 案例3（深度平衡暂降，正序饱和）：$|V_a| = 0.2$，$\\angle V_a = 0$， $|V_b| = 0.2$，$\\angle V_b = -\\frac{2\\pi}{3}$， $|V_c| = 0.2$，$\\angle V_c = +\\frac{2\\pi}{3}$，$k_r = 2.0$，$G_2 = 0.0$，$B_2 = 0.0$，$I_{\\text{conv,max}} = 0.5$，$I_{\\text{tr,max}} = 1.0$。\n- 案例4（强不平衡，负序受裕度限制）：$|V_a| = 1.0$，$\\angle V_a = 0$， $|V_b| = 0.6$，$\\angle V_b = -\\frac{2\\pi}{3}$， $|V_c| = 1.0$，$\\angle V_c = +\\frac{2\\pi}{3}$，$k_r = 0.5$，$G_2 = 2.0$，$B_2 = 0.0$，$I_{\\text{conv,max}} = 0.6$，$I_{\\text{tr,max}} = 0.7$。\n- 案例5（零电压边界情况）：$|V_a| = 0.0$，$\\angle V_a = 0$， $|V_b| = 0.0$，$\\angle V_b = -\\frac{2\\pi}{3}$， $|V_c| = 0.0$，$\\angle V_c = +\\frac{2\\pi}{3}$，$k_r = 1.0$，$G_2 = 1.0$，$B_2 = 0.0$，$I_{\\text{conv,max}} = 0.3$，$I_{\\text{tr,max}} = 0.4$。\n\n您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[[r_{11}, r_{12}, r_{13}], [r_{21}, r_{22}, r_{23}], \\dots]$，其中每个 $r_{ij}$ 是案例 $i$ 的一个请求输出分量。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于电气工程原理，特别是三相电力系统和电力电子控制。该问题提法明确、客观，并提供了一个清晰、计算上易于处理的算法，所有必要的参数都已指定。不存在会使问题无效的矛盾、歧义或不切实际的假设。因此，将提供一个解决方案。\n\n该问题的核心是为并网电压源换流器设计一个电流参考生成算法，该算法在电网故障期间同时提供电压支持并保护自身免受过电流损害。该解决方案遵循指定的四步程序。一个小的数值稳定性阈值 $\\epsilon = 10^{-6}$ 将用于涉及除以电压幅值的计算。\n\n首先，我们定义对称分量变换算子 $a = e^{j \\frac{2\\pi}{3}}$。所有相量都是复数，除非另有说明，所有量都以标幺值 (p.u.) 表示。\n\n第1步：计算电压的对称分量\n给定三相相-中线电压相量 $V_a$、$V_b$ 和 $V_c$，我们首先将它们从极坐标形式（幅值和角度）转换为直角坐标形式。\n$V_k = |V_k| e^{j \\angle V_k} = |V_k|(\\cos(\\angle V_k) + j \\sin(\\angle V_k))$，其中 $k \\in \\{a, b, c\\}$。\n\n正序电压 $V_1$ 和负序电压 $V_2$ 使用标准的对称分量变换公式计算。根据问题陈述，零序分量被忽略。\n$$V_1 = \\frac{1}{3}(V_a + a V_b + a^2 V_c)$$\n$$V_2 = \\frac{1}{3}(V_a + a^2 V_b + a V_c)$$\n$V_1$ 代表三相系统的平衡正序（相序 a-b-c）分量，这是在传统电网中负责有效功率传输的分量。$V_2$ 代表不平衡的负序（相序 a-c-b）分量，它在不对称故障或不平衡负载期间出现，可能导致电机转矩脉动和设备额外发热等问题。\n\n第2步：计算原始正序电流参考值\n并网导则要求换流器通过注入无功电流来在电压暂降期间支撑电网。无功电流量通常与电压暂降的深度成正比。此电流所需的幅值 $i_{q1}^{\\text{req}}$ 计算如下：\n$$i_{q1}^{\\text{req}} = k_r \\max(0, 1 - |V_1|)$$\n其中 $k_r$ 是无功电流支持增益（斜率），$|V_1|$ 是正序电压的幅值。额定电压为 $1$ 标幺值，因此 $(1 - |V_1|)$ 代表电压暂降的幅度。\n\n为了注入纯无功功率，电流相量必须与电压相量正交。为了向电网注入无功功率（从电网的角度看是感性行为），电流必须滞后电压 $90^\\circ$，这对应于乘以 $-j$。因此，原始正序电流参考值 $I_1^{\\text{raw}}$ 相对于 $V_1$ 沿正交轴定向。\n为了获得 $V_1$ 方向上的单位向量，我们计算 $\\frac{V_1}{|V_1|}$。然后电流相量为：\n$$I_1^{\\text{raw}} = -j \\cdot i_{q1}^{\\text{req}} \\cdot \\frac{V_1}{|V_1|}$$\n当 $|V_1|$ 非常小（例如，在换流器端子附近发生三相短路时），必须处理一个特殊情况以保证数值稳定性。如果 $|V_1| \\le \\epsilon$，其中 $\\epsilon$ 是一个小的正阈值（例如 $10^{-6}$），则 $V_1$ 的方向是未定义的。在这种情况下，问题指定将原始电流设置为：\n$$I_1^{\\text{raw}} = -j \\cdot i_{q1}^{\\text{req}}$$\n这在保持幅值要求的同时，选择了一个常规的相角（$-90^\\circ$ 或 $-\\frac{\\pi}{2}$ 弧度）。\n\n第3步：计算原始负序电流参考值\n为了减轻电压不平衡，换流器注入一个与测得的负序电压 $V_2$ 成比例的负序电流 $I_2$。此行为由一个虚拟负序导纳 $Y_2 = G_2 + j B_2$ 建模。原始负序电流参考值 $I_2^{\\text{raw}}$ 使用序域中的欧姆定律计算：\n$$I_2^{\\text{raw}} = Y_2 V_2 = (G_2 + j B_2) V_2$$\n通常，选择 $G_2 > 0$ 和 $B_2=0$ 以通过吸收模拟电阻路径的电流来抑制负序电压，从而消耗与负序分量相关的功率。\n\n第4步：在能力限值下分配电流\n换流器的功率半导体和接口变压器有热限制，这转化为最大电流幅值。总能力 $I_{\\text{cap}}$ 是换流器和变压器限值的最小值：\n$$I_{\\text{cap}} = \\min(I_{\\text{conv,max}}, I_{\\text{tr,max}})$$\n物理相电流是序分量的总和，其热效应与序分量幅值的方和根有关。因此，最终的电流参考值 $I_1$ 和 $I_2$ 必须满足：\n$$|I_1|^2 + |I_2|^2 \\le I_{\\text{cap}}^2$$\n分配策略优先考虑正序无功支持 ($I_1$) 而不是负序抑制 ($I_2$)，这是并网导则中的一个常见要求。一个布尔标志 `over_limit` 将跟踪是否有任何电流分量被缩减。\n\n首先，将所需的正序电流幅值 $|I_1^{\\text{raw}}|$ 与总能力 $I_{\\text{cap}}$ 进行比较。\n- 如果 $|I_1^{\\text{raw}}| \\ge I_{\\text{cap}}$：仅正序电流需求就使换流器饱和。所有可用容量都分配给它。$I_1$ 被缩减至限值，而 $I_2$ 被设置为零。`over_limit` 标志设置为 `True`。\n$$I_1 = I_1^{\\text{raw}} \\frac{I_{\\text{cap}}}{|I_1^{\\text{raw}}|}$$\n$$I_2 = 0 + j0$$\n- 如果 $|I_1^{\\text{raw}}|  I_{\\text{cap}}$：可以提供全部所需的正序电流。\n$$I_1 = I_1^{\\text{raw}}$$\n可用于负序分量的剩余电流容量，或“裕度” $h$，根据方和根限制计算：\n$$h = \\sqrt{I_{\\text{cap}}^2 - |I_1|^2}$$\n接下来，将所需的负序电流 $|I_2^{\\text{raw}}|$ 与此裕度 $h$ 进行比较。\n    - 如果 $|I_2^{\\text{raw}}| \\le h$：有足够的容量来提供全部负序电流。\n    $$I_2 = I_2^{\\text{raw}}$$\n    在这种情况下，由于没有对 $I_1$ 或 $I_2$ 进行缩放，`over_limit` 标志为 `False`。\n    - 如果 $|I_2^{\\text{raw}}|  h$：所需的负序电流必须被缩减以适应可用的裕度。`over_limit` 标志设置为 `True`。\n    $$I_2 = I_2^{\\text{raw}} \\frac{h}{|I_2^{\\text{raw}}|}$$\n\n每个测试案例的最终输出是分配的电流幅值 $|I_1|$ 和 $|I_2|$，以及布尔值 `over_limit` 标志。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_current_references(Va_mag, Va_ang, Vb_mag, Vb_ang, Vc_mag, Vc_ang, kr, G2, B2, I_conv_max, I_tr_max):\n    \"\"\"\n    Computes sequence-domain current references based on grid support requirements.\n\n    Args:\n        Va_mag, Vb_mag, Vc_mag (float): Magnitudes of phase voltages (p.u.).\n        Va_ang, Vb_ang, Vc_ang (float): Angles of phase voltages (radians).\n        kr (float): Reactive current support gain.\n        G2 (float): Negative-sequence virtual conductance (p.u.).\n        B2 (float): Negative-sequence virtual susceptance (p.u.).\n        I_conv_max (float): Converter current capability (p.u.).\n        I_tr_max (float): Transformer current capability (p.u.).\n\n    Returns:\n        list: A list containing [|I1|, |I2|, over_limit].\n    \"\"\"\n    epsilon = 1e-6\n    over_limit = False\n\n    # Define symmetrical component operator 'a'\n    a = np.exp(1j * 2 * np.pi / 3)\n\n    # 1. Compute V1 and V2\n    Va = Va_mag * np.exp(1j * Va_ang)\n    Vb = Vb_mag * np.exp(1j * Vb_ang)\n    Vc = Vc_mag * np.exp(1j * Vc_ang)\n\n    V1 = (Va + a * Vb + a**2 * Vc) / 3.0\n    V2 = (Va + a**2 * Vb + a * Vc) / 3.0\n    \n    V1_mag = np.abs(V1)\n\n    # 2. Positive-sequence reactive current requirement\n    i_q1_req = kr * max(0, 1.0 - V1_mag)\n    \n    if V1_mag > epsilon:\n        I1_raw = -1j * i_q1_req * (V1 / V1_mag)\n    else:\n        I1_raw = -1j * i_q1_req\n        \n    I1_raw_mag = np.abs(I1_raw)\n\n    # 3. Negative-sequence mitigation\n    Y2 = G2 + 1j * B2\n    I2_raw = Y2 * V2\n    I2_raw_mag = np.abs(I2_raw)\n\n    # 4. Current allocation under limit\n    I_cap = min(I_conv_max, I_tr_max)\n    \n    # Initialize final currents\n    I1 = 0 + 0j\n    I2 = 0 + 0j\n\n    if I1_raw_mag >= I_cap:\n        # Positive-sequence current alone saturates the converter\n        if I1_raw_mag > 0: # Avoid division by zero\n            I1 = I1_raw * (I_cap / I1_raw_mag)\n        I2 = 0 + 0j\n        over_limit = True\n    else:\n        # Positive-sequence current fits, check headroom for negative-sequence\n        I1 = I1_raw\n        headroom = np.sqrt(I_cap**2 - np.abs(I1)**2)\n        \n        if I2_raw_mag = headroom:\n            # Negative-sequence current also fits\n            I2 = I2_raw\n            # over_limit remains False\n        else:\n            # Negative-sequence current must be scaled down\n            if I2_raw_mag > 0: # Avoid division by zero\n                I2 = I2_raw * (headroom / I2_raw_mag)\n            else:\n                I2 = 0 + 0j\n            over_limit = True\n\n    return [round(np.abs(I1), 6), round(np.abs(I2), 6), over_limit]\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases.\n    \"\"\"\n    # Test suite from the problem statement\n    # Format: (Va_mag, Va_ang, Vb_mag, Vb_ang, Vc_mag, Vc_ang, kr, G2, B2, I_conv_max, I_tr_max)\n    test_cases = [\n        # Case 1 (balanced voltage dip, happy path)\n        (0.8, 0, 0.8, -2*np.pi/3, 0.8, 2*np.pi/3, 1.5, 0.0, 0.0, 1.0, 1.2),\n        # Case 2 (moderate unbalance with negative-sequence support)\n        (0.7, 0, 1.0, -2*np.pi/3, 1.0, 2*np.pi/3, 1.5, 0.5, 0.0, 0.8, 1.0),\n        # Case 3 (deep balanced dip, positive-sequence saturates)\n        (0.2, 0, 0.2, -2*np.pi/3, 0.2, 2*np.pi/3, 2.0, 0.0, 0.0, 0.5, 1.0),\n        # Case 4 (strong unbalance, negative-sequence limited by headroom)\n        (1.0, 0, 0.6, -2*np.pi/3, 1.0, 2*np.pi/3, 0.5, 2.0, 0.0, 0.6, 0.7),\n        # Case 5 (zero voltage edge case)\n        (0.0, 0, 0.0, -2*np.pi/3, 0.0, 2*np.pi/3, 1.0, 1.0, 0.0, 0.3, 0.4),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_current_references(*case)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # str() on a list produces a string '[item1, item2, ...]'\n    # We join these strings with commas and enclose the whole thing in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}