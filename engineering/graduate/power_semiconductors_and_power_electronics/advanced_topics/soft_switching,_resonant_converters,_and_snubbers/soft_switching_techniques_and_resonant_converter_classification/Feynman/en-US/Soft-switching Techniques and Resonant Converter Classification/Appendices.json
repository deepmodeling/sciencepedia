{
    "hands_on_practices": [
        {
            "introduction": "To fully appreciate the benefits of soft-switching, it is essential to first quantify the limitations of conventional methods. This practice  guides you through calculating the switching power loss in a hard-switched converter based on fundamental energy principles. By establishing the direct, linear relationship between switching frequency and power loss, this exercise highlights the fundamental efficiency barrier that drives the need for advanced resonant converter topologies.",
            "id": "3881771",
            "problem": "A hard-switched pulse-width modulation (PWM) half-bridge using a silicon carbide (SiC) metal-oxide-semiconductor field-effect transistor (MOSFET) commutates once per switching cycle on turn-on and once per cycle on turn-off. Under a specified operating point (fixed direct current bus voltage and load current), the measured switching energy per event at turn-on is $E_{\\text{on}} = 112~\\mu\\text{J}$ and at turn-off is $E_{\\text{off}} = 94~\\mu\\text{J}$. The switching frequency is $f_{s} = 230~\\text{kHz}$. Using only fundamental definitions that relate average power to energy and time, derive the total average switching loss per device $P_{\\text{sw}}$ for this hard-switched operation and compute its numerical value. Then, in your explanation, comment on how $P_{\\text{sw}}$ scales with $f_{s}$ and briefly relate this scaling to the motivation for soft-switching and the role of resonant converter classification (for example, zero-voltage switching and a voltage-source series-resonant tank). Express the final power in watts and round your answer to four significant figures.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the fundamental principles of power electronics, is well-posed with a complete and consistent set of givens, and is expressed in objective, formal language. The solution can therefore proceed.\n\nThe total average switching loss per device, $P_{\\text{sw}}$, is the total energy dissipated due to switching events over one switching cycle, multiplied by the frequency of these cycles. In a hard-switched pulse-width modulation (PWM) converter, a switching device typically experiences a turn-on event and a turn-off event once per switching cycle.\n\nThe fundamental definition of average power, $P$, relates energy, $E$, and time, $t$, as $P = \\frac{E}{t}$. For a periodic process with a frequency $f_s$, the period is $T_s = \\frac{1}{f_s}$. The average power is the energy per cycle, $E_{\\text{cycle}}$, multiplied by the frequency:\n$$P = E_{\\text{cycle}} \\times f_s$$\nIn this case, the total energy dissipated due to switching in one cycle, $E_{\\text{sw,cycle}}$, is the sum of the energy lost during the turn-on event, $E_{\\text{on}}$, and the energy lost during the turn-off event, $E_{\\text{off}}$.\n$$E_{\\text{sw,cycle}} = E_{\\text{on}} + E_{\\text{off}}$$\nTherefore, the total average switching loss per device, $P_{\\text{sw}}$, is derived by substituting this into the power equation:\n$$P_{\\text{sw}} = (E_{\\text{on}} + E_{\\text{off}}) \\times f_{s}$$\nThis equation represents the direct relationship between switching energy per event, switching frequency, and average switching power loss.\n\nThe problem provides the following numerical values:\n- Turn-on switching energy: $E_{\\text{on}} = 112~\\mu\\text{J} = 112 \\times 10^{-6}~\\text{J}$\n- Turn-off switching energy: $E_{\\text{off}} = 94~\\mu\\text{J} = 94 \\times 10^{-6}~\\text{J}$\n- Switching frequency: $f_{s} = 230~\\text{kHz} = 230 \\times 10^{3}~\\text{Hz}$\n\nFirst, we calculate the total switching energy per cycle, $E_{\\text{sw,cycle}}$:\n$$E_{\\text{sw,cycle}} = (112 \\times 10^{-6}~\\text{J}) + (94 \\times 10^{-6}~\\text{J}) = 206 \\times 10^{-6}~\\text{J}$$\nNext, we use this value to compute the total average switching loss, $P_{\\text{sw}}$:\n$$P_{\\text{sw}} = (206 \\times 10^{-6}~\\text{J}) \\times (230 \\times 10^{3}~\\text{s}^{-1})$$\n$$P_{\\text{sw}} = 47380 \\times 10^{-3}~\\text{W}$$\n$$P_{\\text{sw}} = 47.38~\\text{W}$$\nThe problem requires the answer to be expressed in watts and rounded to four significant figures. The calculated value is $47.38~\\text{W}$, which already has four significant figures.\n\nAs derived, $P_{\\text{sw}} = (E_{\\text{on}} + E_{\\text{off}}) f_{s}$. This relationship shows that for a given operating point (fixed bus voltage and load current), where $E_{\\text{on}}$ and $E_{\\text{off}}$ are nearly constant, the switching loss $P_{\\text{sw}}$ scales linearly with the switching frequency $f_{s}$. This direct proportionality is a defining characteristic and a major limitation of hard-switched converters. Increasing $f_{s}$ to achieve higher power density and reduce the size of magnetic components and capacitors inevitably leads to a proportional increase in switching losses, which degrades efficiency and creates significant thermal management challenges.\n\nThis limitation is the primary motivation for soft-switching techniques. These techniques aim to drastically reduce or eliminate switching losses by arranging for either the voltage across the device (for zero-voltage switching, or ZVS) or the current through the device (for zero-current switching, or ZCS) to be zero at the moment of switching. Resonant converters are a class of topologies that inherently facilitate soft-switching. For instance, a voltage-source series-resonant converter employs an inductor-capacitor ($LC$) resonant tank to shape the device voltage and current into sinusoids. By timing the switching action to coincide with the zero-crossings of these waveforms, ZVS can be achieved. Achieving ZVS at turn-on, for example, makes the turn-on switching energy $E_{\\text{on}}$ negligible ($E_{\\text{on}} \\approx 0$). This breaks the detrimental linear scaling of $P_{\\text{sw}}$ with $f_{s}$, thereby permitting operation at much higher frequencies with high efficiency. The classification of resonant converters (e.g., series-resonant, voltage-source) provides engineers with a systematic framework for designing power stages that achieve specific soft-switching characteristics.",
            "answer": "$$\\boxed{47.38}$$"
        },
        {
            "introduction": "Achieving soft-switching is a matter of ensuring sufficient energy is available at the precise moment of transition, a condition that becomes challenging at light loads. This practice  explores the fundamental physics required to guarantee Zero-Voltage Switching (ZVS) during the dead-time. By analyzing the requirements from both a charge-balance ($I \\cdot t_d \\ge C \\cdot V$) and an energy-balance ($\\frac{1}{2}LI^2 \\ge \\frac{1}{2}CV^2$) standpoint, you will determine the critical boundary conditions for successful ZVS operation.",
            "id": "3881773",
            "problem": "A half-bridge inductor–inductor–capacitor (LLC) resonant converter, a member of the series–parallel resonant converter classification, uses Zero-Voltage Switching (ZVS) to reduce switching losses in its Metal-Oxide-Semiconductor Field-Effect Transistors (MOSFETs). Consider a commutation interval at light load in which the switch-node voltage must be discharged from the bus voltage to near zero during the controller-imposed dead-time to achieve ZVS of the incoming MOSFET. The switch-node has an effective output capacitance that is the sum of both device output capacitances and stray elements, assumed constant over the voltage range of interest. At light load, the available tank current at the start of dead-time can be approximated as constant over the dead-time.\n\nStarting only from the fundamental capacitor relations $Q = C V$ and $E_{C} = \\frac{1}{2} C V^{2}$, and the inductor energy $E_{L} = \\frac{1}{2} L I^{2}$, derive the boundary condition on the available tank current at the switch-node that guarantees ZVS by simultaneously enforcing:\n- complete removal of the switch-node capacitor charge within the dead-time, and\n- sufficiency of inductor energy to supply the capacitor energy reduction.\n\nUse the following parameters:\n- bus voltage $V_{\\mathrm{bus}} = 400\\,\\mathrm{V}$,\n- resonant inductance $L_{r} = 20\\,\\mu\\mathrm{H}$,\n- effective switch-node capacitance $C_{\\mathrm{eq}} = 300\\,\\mathrm{pF}$,\n- controller dead-time $t_{d} = 400\\,\\mathrm{ns}$.\n\nCompute the minimum required tank current magnitude at the start of dead-time, identify which constraint is stricter, and provide the single numerical value of that boundary current. Express your final answer in amperes and round your result to four significant figures.",
            "solution": "The problem statement has been validated and is deemed scientifically grounded, well-posed, and objective. It provides a set of parameters and simplified physical models to derive a boundary condition for achieving Zero-Voltage Switching (ZVS) in a half-bridge LLC resonant converter. The problem is solvable as stated.\n\nThe objective is to find the minimum magnitude of the tank current, which we denote as $I_{\\text{tank}}$, at the beginning of the dead-time interval required to guarantee ZVS. This condition is to be determined by evaluating two distinct constraints derived from the provided fundamental relations. ZVS for the incoming MOSFET is achieved if the switch-node voltage, starting at the bus voltage $V_{\\mathrm{bus}}$, is fully discharged to zero before the end of the dead-time, $t_{d}$. The switch node has an effective capacitance $C_{\\mathrm{eq}}$ which must be discharged.\n\nLet us analyze the two constraints separately.\n\n**Constraint 1: Complete Removal of Switch-Node Charge**\n\nThis constraint is based on the relationship between charge, capacitance, and voltage, $Q = C V$, and the definition of current as the rate of change of charge. For ZVS, the voltage across the switch-node capacitance $C_{\\mathrm{eq}}$ must change from $V_{\\mathrm{bus}}$ to $0$. The total charge, $\\Delta Q$, that must be removed from the capacitor to achieve this voltage change is:\n$$\n\\Delta Q = C_{\\mathrm{eq}} \\Delta V = C_{\\mathrm{eq}} (V_{\\mathrm{bus}} - 0) = C_{\\mathrm{eq}} V_{\\mathrm{bus}}\n$$\nThe problem states that at light load, the tank current, $I_{\\text{tank}}$, can be approximated as being constant throughout the dead-time, $t_d$. This constant current is responsible for removing the charge $\\Delta Q$. The total charge removed by a constant current $I_{\\text{tank}}$ over a time interval $t_d$ is given by:\n$$\n\\Delta Q_{\\text{removed}} = I_{\\text{tank}} t_d\n$$\nTo ensure complete discharge within the dead-time, the charge removed must be at least equal to the charge stored on the capacitor.\n$$\nI_{\\text{tank}} t_d \\ge C_{\\mathrm{eq}} V_{\\mathrm{bus}}\n$$\nThis inequality gives the first boundary condition for the tank current, which we will call $I_{\\text{min,1}}$:\n$$\nI_{\\text{tank}} \\ge \\frac{C_{\\mathrm{eq}} V_{\\mathrm{bus}}}{t_d} \\equiv I_{\\text{min,1}}\n$$\n\n**Constraint 2: Sufficiency of Inductor Energy**\n\nThis constraint is based on the energy balance in the resonant tank. The fundamental relations for capacitor energy, $E_C = \\frac{1}{2} C V^2$, and inductor energy, $E_L = \\frac{1}{2} L I^2$, are to be used.\nAt the beginning of the dead-time, the switch-node voltage is $V_{\\mathrm{bus}}$, and the energy stored in the capacitor $C_{\\mathrm{eq}}$ is:\n$$\nE_{C, \\text{initial}} = \\frac{1}{2} C_{\\mathrm{eq}} V_{\\mathrm{bus}}^2\n$$\nTo achieve ZVS, the voltage must be reduced to $0$, at which point the capacitor energy is zero. Therefore, the energy reduction required for the capacitor is:\n$$\n\\Delta E_C = E_{C, \\text{initial}} - E_{C, \\text{final}} = \\frac{1}{2} C_{\\mathrm{eq}} V_{\\mathrm{bus}}^2 - 0 = \\frac{1}{2} C_{\\mathrm{eq}} V_{\\mathrm{bus}}^2\n$$\nThe problem states that the energy stored in the resonant inductor, $L_r$, at the start of the dead-time must be sufficient to supply this capacitor energy reduction. The initial energy in the inductor, carrying the current $I_{\\text{tank}}$, is:\n$$\nE_{L, \\text{initial}} = \\frac{1}{2} L_r I_{\\text{tank}}^2\n$$\nThe condition for energy sufficiency is therefore:\n$$\nE_{L, \\text{initial}} \\ge \\Delta E_C\n$$\n$$\n\\frac{1}{2} L_r I_{\\text{tank}}^2 \\ge \\frac{1}{2} C_{\\mathrm{eq}} V_{\\mathrm{bus}}^2\n$$\nSolving for the magnitude of the tank current, $I_{\\text{tank}}$, gives the second boundary condition, which we will call $I_{\\text{min,2}}$:\n$$\nI_{\\text{tank}}^2 \\ge \\frac{C_{\\mathrm{eq}}}{L_r} V_{\\mathrm{bus}}^2\n$$\n$$\nI_{\\text{tank}} \\ge V_{\\mathrm{bus}} \\sqrt{\\frac{C_{\\mathrm{eq}}}{L_r}} \\equiv I_{\\text{min,2}}\n$$\n\n**Numerical Calculation and Comparison**\n\nTo find the minimum required current, we must satisfy both constraints. Thus, the overall minimum current is the maximum of the two derived lower bounds: $I_{\\text{tank,min}} = \\max(I_{\\text{min,1}}, I_{\\text{min,2}})$. We will now substitute the given numerical values:\n- Bus voltage: $V_{\\mathrm{bus}} = 400\\,\\mathrm{V}$\n- Resonant inductance: $L_{r} = 20\\,\\mu\\mathrm{H} = 20 \\times 10^{-6}\\,\\mathrm{H}$\n- Effective switch-node capacitance: $C_{\\mathrm{eq}} = 300\\,\\mathrm{pF} = 300 \\times 10^{-12}\\,\\mathrm{F}$\n- Controller dead-time: $t_{d} = 400\\,\\mathrm{ns} = 400 \\times 10^{-9}\\,\\mathrm{s}$\n\nCalculating the minimum current from the charge-based constraint (Constraint 1):\n$$\nI_{\\text{min,1}} = \\frac{C_{\\mathrm{eq}} V_{\\mathrm{bus}}}{t_d} = \\frac{(300 \\times 10^{-12}\\,\\mathrm{F}) \\times (400\\,\\mathrm{V})}{400 \\times 10^{-9}\\,\\mathrm{s}} = \\frac{1.2 \\times 10^{-7}\\,\\mathrm{C}}{400 \\times 10^{-9}\\,\\mathrm{s}} = 0.3\\,\\mathrm{A}\n$$\n\nCalculating the minimum current from the energy-based constraint (Constraint 2):\n$$\nI_{\\text{min,2}} = V_{\\mathrm{bus}} \\sqrt{\\frac{C_{\\mathrm{eq}}}{L_r}} = 400\\,\\mathrm{V} \\times \\sqrt{\\frac{300 \\times 10^{-12}\\,\\mathrm{F}}{20 \\times 10^{-6}\\,\\mathrm{H}}} = 400 \\times \\sqrt{15 \\times 10^{-6}}\\,\\mathrm{A}\n$$\n$$\nI_{\\text{min,2}} = 400 \\times \\sqrt{15} \\times 10^{-3}\\,\\mathrm{A} \\approx 400 \\times 3.87298 \\times 10^{-3}\\,\\mathrm{A} \\approx 1.54919\\,\\mathrm{A}\n$$\n\nComparing the two minimum currents:\n$$\nI_{\\text{min,1}} = 0.3\\,\\mathrm{A}\n$$\n$$\nI_{\\text{min,2}} \\approx 1.5492\\,\\mathrm{A}\n$$\nSince $I_{\\text{min,2}} > I_{\\text{min,1}}$, the energy-based constraint is the stricter of the two. It dictates the minimum required tank current to ensure ZVS.\nThe minimum required tank current magnitude is therefore $I_{\\text{tank,min}} = I_{\\text{min,2}} \\approx 1.54919\\,\\mathrm{A}$.\n\nThe problem requires the final answer to be rounded to four significant figures.\n$$\nI_{\\text{tank,min}} \\approx 1.549\\,\\mathrm{A}\n$$\nThis is the single numerical value of the boundary current.",
            "answer": "$$\n\\boxed{1.549}\n$$"
        },
        {
            "introduction": "Real-world design must account for device non-idealities that are often ignored in first-order analyses, such as nonlinear capacitances and reverse-recovery effects. This advanced hands-on practice  guides you in synthesizing these complex factors into a comprehensive computational model for predicting the soft-switching margin, $M = E_{\\text{avail}} - E_{\\text{need}}$. By translating fundamental energy principles into code, you will develop a versatile tool capable of analyzing ZVS performance across various resonant converter classifications and operating conditions.",
            "id": "3881754",
            "problem": "You are given a directive to construct a parameterized prediction model for soft-switching margins rooted in first principles, for the purpose of analyzing Zero-Voltage Switching (ZVS) in resonant converters. You must use energy balance and fundamental charge-voltage relations, with nonlinearity captured from datasheet-style capacitance and reverse-recovery characteristics. Your program must implement the model and compute the soft-switching margin across specified operating conditions, for a set of resonant converter classifications and device parameters.\n\nUse the following foundational bases and definitions without introducing any shortcut formulas beyond those directly implied by these principles:\n- The energy stored in an inductor is $E_{L} = \\frac{1}{2} L i^{2}$.\n- The charge required to discharge a nonlinear capacitor from voltage $v$ is $dq = C(v)\\, dv$, and the energy required to discharge a capacitor from $0$ to $V$ is $E_{C} = \\int_{0}^{V} v\\, C(v)\\, dv$.\n- The energy associated with removing a reverse recovery charge $Q_{rr}$ against a bus voltage $V$ is $E_{rr} = Q_{rr}\\, V$.\n- The resistive loss of a current flowing through an equivalent resistance $R_{eq}$ over a time interval is $E_{R} = \\int i(t)^{2}\\, R_{eq}\\, dt$, and when the transition is approximated as a quarter-cycle of a sinusoid, use $i(t) = I_{0} \\cos(\\omega t)$ over $t \\in [0, \\frac{\\pi}{2\\omega}]$.\n\nImplement the nonlinear device output capacitance model typical of datasheet fits:\n$$\nC(v) = \\frac{C_{0}}{\\left(1 + \\frac{v}{V_{c}}\\right)^{k}},\n$$\nwhere $C_{0}$, $V_{c}$, and $k$ are parameters determined from datasheets. The nonlinearity must be respected through integration, not by linearization.\n\nDefine the soft-switching margin in Joules as:\n$$\nM = E_{\\text{avail}} - E_{\\text{need}},\n$$\nwhere $E_{\\text{avail}}$ is the energy available to perform ZVS and $E_{\\text{need}}$ is the energy required to discharge output capacitances and account for reverse recovery charge:\n- Compute the energy available as $E_{\\text{avail}} = \\frac{1}{2} L_{\\text{eff}} I_{\\text{comm}}^{2} - E_{R}$, where $I_{\\text{comm}}$ is the commutation current at the instant of transition and $L_{\\text{eff}}$ depends on converter classification.\n- Compute the resistive loss $E_{R}$ using the sinusoidal quarter-cycle approximation as $E_{R} = R_{eq}\\, \\int_{0}^{\\pi/(2\\omega)} I_{\\text{comm}}^{2} \\cos^{2}(\\omega t)\\, dt = R_{eq}\\, \\frac{\\pi}{4}\\, \\frac{I_{\\text{comm}}^{2}}{\\omega}$, with $\\omega = \\frac{1}{\\sqrt{L_{\\text{eff}}\\, C_{\\text{eff}}}}$, and $C_{\\text{eff}}$ the average capacitance defined as $C_{\\text{eff}} = \\frac{1}{V} \\int_{0}^{V} C(v)\\, dv$.\n- Compute the energy needed as $E_{\\text{need}} = N_{C} \\int_{0}^{V} v\\, C(v)\\, dv + N_{rr}\\, Q_{rr}\\, V$, where $N_{C}$ is the number of capacitive devices participating in the transition and $N_{rr}$ is the number of diodes or devices exhibiting reverse recovery at the transition.\n\nYour program must select $L_{\\text{eff}}$ based on resonant converter classification:\n- Series Resonant Converter (SRC): $L_{\\text{eff}} = L_{r}$.\n- Parallel Resonant Converter (PRC): $L_{\\text{eff}} = L_{r}$.\n- Inductor-Inductor-Capacitor (LLC) converter: $L_{\\text{eff}} = L_{m}$, where $L_{m}$ is the magnetizing inductance.\n\nAngle units for any sinusoidal time-domain quantities must be in radians. All energies must be expressed in Joules. The final numerical output must be rounded to six decimal places.\n\nImplement the model and compute $M$ for the following test suite, which covers distinct classifications and edge conditions:\n- Test case $1$ (LLC nominal ZVS): $V = 400$ V, $L_{r} = 20 \\,\\mu\\text{H}$, $L_{m} = 80 \\,\\mu\\text{H}$, $I_{\\text{comm}} = 20$ A, $R_{eq} = 0.2$ $\\Omega$, $C_{0} = 1.5$ nF, $V_{c} = 200$ V, $k = 1.4$, $N_{C} = 2$, $Q_{rr} = 20$ $\\mu$C, $N_{rr} = 1$, topology is LLC.\n- Test case $2$ (SRC near-failure due to reverse recovery): $V = 400$ V, $L_{r} = 10 \\,\\mu\\text{H}$, $L_{m} = 50 \\,\\mu\\text{H}$, $I_{\\text{comm}} = 5$ A, $R_{eq} = 0.1$ $\\Omega$, $C_{0} = 0.8$ nF, $V_{c} = 150$ V, $k = 1.2$, $N_{C} = 2$, $Q_{rr} = 0.5$ $\\mu$C, $N_{rr} = 1$, topology is SRC.\n- Test case $3$ (PRC with negligible reverse recovery and strong nonlinearity): $V = 400$ V, $L_{r} = 30 \\,\\mu\\text{H}$, $L_{m} = 60 \\,\\mu\\text{H}$, $I_{\\text{comm}} = 5$ A, $R_{eq} = 0.05$ $\\Omega$, $C_{0} = 3.0$ nF, $V_{c} = 100$ V, $k = 2.2$, $N_{C} = 2$, $Q_{rr} = 0$ C, $N_{rr} = 0$, topology is PRC.\n- Test case $4$ (LLC boundary-margin scenario): $V = 400$ V, $L_{r} = 15 \\,\\mu\\text{H}$, $L_{m} = 50 \\,\\mu\\text{H}$, $I_{\\text{comm}} = 10$ A, $R_{eq} = 0.2$ $\\Omega$, $C_{0} = 30$ nF, $V_{c} = 50$ V, $k = 0.5$, $N_{C} = 2$, $Q_{rr} = 4$ $\\mu$C, $N_{rr} = 1$, topology is LLC.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one value per test case, representing the soft-switching margin $M$ in Joules, rounded to six decimal places, in the order of the test suite. For example, output should look like $[m_{1},m_{2},m_{3},m_{4}]$ where each $m_{i}$ is a float in Joules, rounded to six decimal places.",
            "solution": "The goal is to create a parameterized model for soft-switching margins, integrating device nonlinearity and reverse recovery effects, and to apply it across resonant converter classifications. The approach is to start from energy and charge definitions, construct the required integrals for nonlinear devices, and build the margin function using converter-specific effective inductance selection.\n\nWe define the nonlinear output capacitance model as $C(v) = \\frac{C_{0}}{\\left(1 + \\frac{v}{V_{c}}\\right)^{k}}$. The energy to discharge a capacitor from $0$ to $V$ is $E_{C} = \\int_{0}^{V} v\\, C(v)\\, dv$. Because $C(v)$ is nonlinear, this integral cannot be replaced by the linear formula $\\frac{1}{2} C V^{2}$; instead, it must be computed via numerical integration over voltage. Similarly, the average capacitance over an interval is $C_{\\text{eff}} = \\frac{1}{V} \\int_{0}^{V} C(v)\\, dv$, which we use to construct an effective resonant angular frequency $\\omega = \\frac{1}{\\sqrt{L_{\\text{eff}} C_{\\text{eff}}}}$ that approximates the quarter-cycle transition dynamics.\n\nThe soft-switching energy requirement also includes the reverse recovery charge contribution $E_{rr} = Q_{rr} V$, representing the energy to remove an amount of charge $Q_{rr}$ at the bus voltage $V$. Because multiple devices may participate, we include multiplicity factors $N_{C}$ and $N_{rr}$ to scale the contributions to $E_{\\text{need}}$ appropriately: $E_{\\text{need}} = N_{C} E_{C} + N_{rr} E_{rr}$.\n\nThe energy available for ZVS is the energy stored in the effective inductance at the switching instant minus the resistive dissipation during the commutation interval. The energy stored is $E_{L} = \\frac{1}{2} L_{\\text{eff}} I_{\\text{comm}}^{2}$. To estimate resistive dissipation, we model the transition as a quarter cycle of $i(t) = I_{\\text{comm}} \\cos(\\omega t)$ over $t \\in [0, \\frac{\\pi}{2 \\omega}]$. Then, $E_{R} = R_{eq} \\int_{0}^{\\pi/(2 \\omega)} I_{\\text{comm}}^{2} \\cos^{2}(\\omega t)\\, dt = R_{eq}\\, I_{\\text{comm}}^{2} \\frac{1}{\\omega} \\int_{0}^{\\pi/2} \\cos^{2}(u)\\, du$. Using $\\int_{0}^{\\pi/2} \\cos^{2}(u)\\, du = \\frac{\\pi}{4}$, we have $E_{R} = R_{eq}\\, \\frac{\\pi}{4}\\, \\frac{I_{\\text{comm}}^{2}}{\\omega}$.\n\nThus, $E_{\\text{avail}} = \\frac{1}{2} L_{\\text{eff}} I_{\\text{comm}}^{2} - E_{R}$, and the margin becomes:\n$$\nM = \\left( \\frac{1}{2} L_{\\text{eff}} I_{\\text{comm}}^{2} - R_{eq}\\, \\frac{\\pi}{4}\\, \\frac{I_{\\text{comm}}^{2}}{\\omega} \\right) - \\left( N_{C} \\int_{0}^{V} v\\, C(v)\\, dv + N_{rr}\\, Q_{rr}\\, V \\right),\n$$\nwith $\\omega = \\frac{1}{\\sqrt{L_{\\text{eff}}\\, C_{\\text{eff}}}}$ and $C_{\\text{eff}} = \\frac{1}{V} \\int_{0}^{V} C(v)\\, dv$.\n\nConverter classification determines $L_{\\text{eff}}$:\n- For Series Resonant Converter (SRC) and Parallel Resonant Converter (PRC), $L_{\\text{eff}} = L_{r}$, as the series branch inductance directly participates in the commutation.\n- For Inductor-Inductor-Capacitor (LLC) converters, $L_{\\text{eff}} = L_{m}$, since magnetizing inductance provides commutation energy particularly at light-load conditions.\n\nAlgorithmic steps:\n- For each test case, select $L_{\\text{eff}}$ based on the topology.\n- Compute $C_{\\text{eff}} = \\frac{1}{V} \\int_{0}^{V} C(v)\\, dv$ via numerical integration, ensuring the integrand reflects the specified nonlinear model.\n- Compute the energy to discharge the nonlinear capacitance $E_{C} = \\int_{0}^{V} v\\, C(v)\\, dv$ via numerical integration.\n- Compute $\\omega = \\frac{1}{\\sqrt{L_{\\text{eff}}\\, C_{\\text{eff}}}}$.\n- Compute $E_{R} = R_{eq} \\frac{\\pi}{4} \\frac{I_{\\text{comm}}^{2}}{\\omega}$.\n- Assemble $E_{\\text{avail}} = \\frac{1}{2} L_{\\text{eff}} I_{\\text{comm}}^{2} - E_{R}$.\n- Assemble $E_{\\text{need}} = N_{C} E_{C} + N_{rr} Q_{rr} V$.\n- Compute $M = E_{\\text{avail}} - E_{\\text{need}}$ and round to six decimal places.\n\nScientific realism is maintained by using fundamental energy and charge relations, a widely used empirical nonlinear capacitance model, the reverse recovery energy approximation $Q_{rr} V$, and a sinusoidal approximation for the resonant transition. The test suite spans converter classification distinctions and edge conditions (including strong nonlinearity and near-zero margin), enabling validation by computation. The final output is a single list of floats representing $M$ in Joules, with values rounded to six decimal places, in the order of the four test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef nonlinear_capacitance(v, C0, Vc, k):\n    # C(v) = C0 / (1 + v/Vc)^k\n    return C0 / ((1.0 + v / Vc) ** k)\n\ndef energy_to_discharge(V, C0, Vc, k):\n    # E_C = ∫_0^V v * C(v) dv\n    integrand = lambda vv: vv * nonlinear_capacitance(vv, C0, Vc, k)\n    val, _ = quad(integrand, 0.0, V, epsabs=1e-12, epsrel=1e-10, limit=200)\n    return val\n\ndef average_capacitance(V, C0, Vc, k):\n    # C_eff = (1/V) ∫_0^V C(v) dv\n    integrand = lambda vv: nonlinear_capacitance(vv, C0, Vc, k)\n    val, _ = quad(integrand, 0.0, V, epsabs=1e-12, epsrel=1e-10, limit=200)\n    return val / V\n\ndef effective_inductance(topology, Lr, Lm):\n    # Topology selection for Leff\n    topo = topology.strip().upper()\n    if topo == \"LLC\":\n        return Lm\n    elif topo == \"SRC\":\n        return Lr\n    elif topo == \"PRC\":\n        return Lr\n    else:\n        # Default to Lr if unknown topology\n        return Lr\n\ndef soft_switch_margin(case):\n    # Unpack parameters\n    V = case[\"V\"]\n    Lr = case[\"Lr\"]\n    Lm = case[\"Lm\"]\n    I_comm = case[\"I_comm\"]\n    R_eq = case[\"R_eq\"]\n    C0 = case[\"C0\"]\n    Vc = case[\"Vc\"]\n    k = case[\"k\"]\n    N_C = case[\"N_C\"]\n    Qrr = case[\"Qrr\"]\n    N_rr = case[\"N_rr\"]\n    topology = case[\"topology\"]\n\n    # Effective inductance based on classification\n    L_eff = effective_inductance(topology, Lr, Lm)\n\n    # Average capacitance and discharge energy for the nonlinear C\n    C_eff = average_capacitance(V, C0, Vc, k)\n    E_C = energy_to_discharge(V, C0, Vc, k)\n\n    # Resonant angular frequency using effective L and average C\n    omega = 1.0 / np.sqrt(L_eff * C_eff)\n\n    # Resistive loss over quarter cycle with i(t) = I_comm * cos(omega t)\n    E_R = R_eq * (np.pi / 4.0) * (I_comm ** 2) / omega\n\n    # Energy available from inductance minus resistive loss\n    E_avail = 0.5 * L_eff * (I_comm ** 2) - E_R\n\n    # Energy needed: discharge nonlinear caps + reverse recovery\n    E_need = N_C * E_C + N_rr * Qrr * V\n\n    # Margin\n    M = E_avail - E_need\n    return M\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"V\": 400.0,\n            \"Lr\": 20e-6,\n            \"Lm\": 80e-6,\n            \"I_comm\": 20.0,\n            \"R_eq\": 0.2,\n            \"C0\": 1.5e-9,\n            \"Vc\": 200.0,\n            \"k\": 1.4,\n            \"N_C\": 2,\n            \"Qrr\": 20e-6,\n            \"N_rr\": 1,\n            \"topology\": \"LLC\",\n        },\n        {\n            \"V\": 400.0,\n            \"Lr\": 10e-6,\n            \"Lm\": 50e-6,\n            \"I_comm\": 5.0,\n            \"R_eq\": 0.1,\n            \"C0\": 0.8e-9,\n            \"Vc\": 150.0,\n            \"k\": 1.2,\n            \"N_C\": 2,\n            \"Qrr\": 0.5e-6,\n            \"N_rr\": 1,\n            \"topology\": \"SRC\",\n        },\n        {\n            \"V\": 400.0,\n            \"Lr\": 30e-6,\n            \"Lm\": 60e-6,\n            \"I_comm\": 5.0,\n            \"R_eq\": 0.05,\n            \"C0\": 3.0e-9,\n            \"Vc\": 100.0,\n            \"k\": 2.2,\n            \"N_C\": 2,\n            \"Qrr\": 0.0,\n            \"N_rr\": 0,\n            \"topology\": \"PRC\",\n        },\n        {\n            \"V\": 400.0,\n            \"Lr\": 15e-6,\n            \"Lm\": 50e-6,\n            \"I_comm\": 10.0,\n            \"R_eq\": 0.2,\n            \"C0\": 30e-9,\n            \"Vc\": 50.0,\n            \"k\": 0.5,\n            \"N_C\": 2,\n            \"Qrr\": 4e-6,\n            \"N_rr\": 1,\n            \"topology\": \"LLC\",\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        margin = soft_switch_margin(case)\n        # Round to six decimal places\n        results.append(f\"{margin:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}