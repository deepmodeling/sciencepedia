{
    "hands_on_practices": [
        {
            "introduction": "The \"Model\" in Model Predictive Control is its most critical component. This exercise moves beyond abstract concepts to the fundamental task of building a precise mathematical model for prediction. Starting from first principles—Kirchhoff's voltage law—you will derive the exact discrete-time equation that describes the future current of an inverter-fed RL load, which is the cornerstone for any high-performance predictive controller. ",
            "id": "3858809",
            "problem": "A $3$-phase, $2$-level voltage source inverter drives a balanced, star-connected, linear $L$–$R$ load with per-phase inductance $L$ and resistance $R$. The direct current (DC) link voltage is $V_{\\mathrm{dc}}$. Assume the inverter legs switch at the beginning of each sampling interval of length $T_{\\mathrm{s}}$ and then hold that switching state constant over the interval (zero-order hold). Let the switching positions be $S_a,S_b,S_c \\in \\{0,1\\}$, where $S_x=1$ connects phase $x$ to the positive DC rail and $S_x=0$ connects to the negative DC rail. Neglect dead-time, semiconductor voltage drops, and any back-electromotive-force sources. The load neutral is isolated, the load is balanced, and there is no mutual coupling between phases.\n\nLet $v_{\\alpha\\beta}$ and $i_{\\alpha\\beta}$ denote the stationary-frame (Clarke) space vectors for the phase-to-load voltages and phase currents, respectively. Over any sampling interval in which the switching state is constant, the applied stationary-frame voltage is\n$$\nv_{\\alpha\\beta} = \\frac{2}{3}\\,V_{\\mathrm{dc}}\\left(S_a + S_b\\,\\exp\\!\\left(\\mathrm{j}\\,\\frac{2\\pi}{3}\\right) + S_c\\,\\exp\\!\\left(-\\mathrm{j}\\,\\frac{2\\pi}{3}\\right)\\right),\n$$\nwhere $\\mathrm{j}$ is the imaginary unit. The load obeys the per-phase relation (mapped to the stationary frame by linearity) given by Kirchhoff’s voltage law: $v_{\\alpha\\beta}(t) = L\\,\\frac{d i_{\\alpha\\beta}(t)}{dt} + R\\,i_{\\alpha\\beta}(t)$.\n\nIn the setting of Finite Control Set Model Predictive Control (FCS-MPC), one seeks the exact one-step-ahead prediction of the stationary-frame current vector under zero-order hold. Starting from fundamental circuit laws and without introducing any approximation beyond the stated assumptions, derive the exact discrete-time, one-step-ahead prediction $i_{\\alpha\\beta}[k+1]$ as a function of $i_{\\alpha\\beta}[k]$, $R$, $L$, $T_{\\mathrm{s}}$, $V_{\\mathrm{dc}}$, and the switching positions $S_a,S_b,S_c$. Express your final answer as a single closed-form analytic expression that is valid for all eight space vector switching states. No numerical evaluation is required, and no rounding is needed.",
            "solution": "The problem requires the derivation of the exact one-step-ahead prediction of the stationary-frame current vector, $i_{\\alpha\\beta}[k+1]$, for a $3$-phase voltage source inverter driving an $L$-$R$ load. The derivation must start from the fundamental principles provided.\n\nThe system dynamics are described by the first-order linear ordinary differential equation (ODE) in the stationary $\\alpha\\beta$-frame, given by Kirchhoff’s voltage law:\n$$L\\,\\frac{d i_{\\alpha\\beta}(t)}{dt} + R\\,i_{\\alpha\\beta}(t) = v_{\\alpha\\beta}(t)$$\nThe problem states that over any sampling interval of duration $T_{\\mathrm{s}}$, the switching state $(S_a, S_b, S_c)$ is constant. This implies that the applied voltage vector, $v_{\\alpha\\beta}$, is also constant over this interval. Let us denote the interval as $t \\in [kT_{\\mathrm{s}}, (k+1)T_{\\mathrm{s}}]$, where $k$ is an integer index for the sampling instant. The current at the beginning of this interval is $i_{\\alpha\\beta}(kT_{\\mathrm{s}})$, which we denote as $i_{\\alpha\\beta}[k]$. The goal is to find the current at the end of the interval, $i_{\\alpha\\beta}((k+1)T_{\\mathrm{s}})$, which we denote as $i_{\\alpha\\beta}[k+1]$.\n\nFor the duration of the $k$-th interval, the ODE becomes:\n$$L\\,\\frac{d i_{\\alpha\\beta}(t)}{dt} + R\\,i_{\\alpha\\beta}(t) = v_{\\alpha\\beta}[k]$$\nwhere $v_{\\alpha\\beta}[k]$ is the constant voltage vector determined by the switching state $(S_a, S_b, S_c)$ applied during that interval.\n\nTo solve this ODE, we can rearrange it into the standard form:\n$$\\frac{d i_{\\alpha\\beta}(t)}{dt} + \\frac{R}{L}\\,i_{\\alpha\\beta}(t) = \\frac{1}{L}\\,v_{\\alpha\\beta}[k]$$\nThis is a non-homogeneous first-order linear ODE with constant coefficients. We can solve it using an integrating factor. Let us define a local time variable for the interval, $\\tau = t - kT_{\\mathrm{s}}$, which runs from $\\tau=0$ to $\\tau=T_{\\mathrm{s}}$. The initial condition is $i_{\\alpha\\beta}(\\tau=0) = i_{\\alpha\\beta}[k]$. The ODE in terms of $\\tau$ is:\n$$\\frac{d i_{\\alpha\\beta}(\\tau)}{d\\tau} + \\frac{R}{L}\\,i_{\\alpha\\beta}(\\tau) = \\frac{1}{L}\\,v_{\\alpha\\beta}[k]$$\nThe integrating factor, $\\mu(\\tau)$, is given by:\n$$\\mu(\\tau) = \\exp\\left(\\int \\frac{R}{L} \\,d\\tau\\right) = \\exp\\left(\\frac{R}{L}\\tau\\right)$$\nMultiplying the ODE by the integrating factor yields:\n$$\\exp\\left(\\frac{R}{L}\\tau\\right) \\frac{d i_{\\alpha\\beta}(\\tau)}{d\\tau} + \\frac{R}{L}\\exp\\left(\\frac{R}{L}\\tau\\right) i_{\\alpha\\beta}(\\tau) = \\frac{1}{L} v_{\\alpha\\beta}[k] \\exp\\left(\\frac{R}{L}\\tau\\right)$$\nThe left side of the equation is an exact differential:\n$$\\frac{d}{d\\tau}\\left(i_{\\alpha\\beta}(\\tau)\\,\\exp\\left(\\frac{R}{L}\\tau\\right)\\right) = \\frac{1}{L} v_{\\alpha\\beta}[k] \\exp\\left(\\frac{R}{L}\\tau\\right)$$\nNow, we integrate both sides with respect to $\\tau$ from $\\tau=0$ to $\\tau=T_{\\mathrm{s}}$:\n$$\\int_{0}^{T_{\\mathrm{s}}} \\frac{d}{d\\tau}\\left(i_{\\alpha\\beta}(\\tau)\\,\\exp\\left(\\frac{R}{L}\\tau\\right)\\right) d\\tau = \\int_{0}^{T_{\\mathrm{s}}} \\frac{1}{L} v_{\\alpha\\beta}[k] \\exp\\left(\\frac{R}{L}\\tau\\right) d\\tau$$\nEvaluating the left-hand side using the fundamental theorem of calculus:\n$$\\left[ i_{\\alpha\\beta}(\\tau)\\,\\exp\\left(\\frac{R}{L}\\tau\\right) \\right]_{0}^{T_{\\mathrm{s}}} = i_{\\alpha\\beta}(T_{\\mathrm{s}})\\,\\exp\\left(\\frac{R T_{\\mathrm{s}}}{L}\\right) - i_{\\alpha\\beta}(0)\\,\\exp(0)$$\nSubstituting $i_{\\alpha\\beta}(T_{\\mathrm{s}}) = i_{\\alpha\\beta}[k+1]$ and $i_{\\alpha\\beta}(0) = i_{\\alpha\\beta}[k]$:\n$$i_{\\alpha\\beta}[k+1]\\,\\exp\\left(\\frac{R T_{\\mathrm{s}}}{L}\\right) - i_{\\alpha\\beta}[k]$$\nEvaluating the right-hand side integral, noting that $v_{\\alpha\\beta}[k]$ and $L$ are constants:\n$$\\frac{v_{\\alpha\\beta}[k]}{L} \\int_{0}^{T_{\\mathrm{s}}} \\exp\\left(\\frac{R}{L}\\tau\\right) d\\tau = \\frac{v_{\\alpha\\beta}[k]}{L} \\left[ \\frac{L}{R} \\exp\\left(\\frac{R}{L}\\tau\\right) \\right]_{0}^{T_{\\mathrm{s}}} = \\frac{v_{\\alpha\\beta}[k]}{R} \\left( \\exp\\left(\\frac{R T_{\\mathrm{s}}}{L}\\right) - \\exp(0) \\right) = \\frac{v_{\\alpha\\beta}[k]}{R} \\left( \\exp\\left(\\frac{R T_{\\mathrm{s}}}{L}\\right) - 1 \\right)$$\nEquating the two results:\n$$i_{\\alpha\\beta}[k+1]\\,\\exp\\left(\\frac{R T_{\\mathrm{s}}}{L}\\right) - i_{\\alpha\\beta}[k] = \\frac{v_{\\alpha\\beta}[k]}{R} \\left( \\exp\\left(\\frac{R T_{\\mathrm{s}}}{L}\\right) - 1 \\right)$$\nTo find an explicit expression for $i_{\\alpha\\beta}[k+1]$, we first add $i_{\\alpha\\beta}[k]$ to both sides and then multiply the entire equation by $\\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)$:\n$$i_{\\alpha\\beta}[k+1] = i_{\\alpha\\beta}[k]\\,\\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right) + \\frac{v_{\\alpha\\beta}[k]}{R} \\left( \\exp\\left(\\frac{R T_{\\mathrm{s}}}{L}\\right) - 1 \\right) \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)$$\n$$i_{\\alpha\\beta}[k+1] = \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)\\,i_{\\alpha\\beta}[k] + \\frac{v_{\\alpha\\beta}[k]}{R} \\left( 1 - \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right) \\right)$$\nThis is the exact discrete-time model. The final step is to substitute the given expression for the voltage vector $v_{\\alpha\\beta}[k]$:\n$$v_{\\alpha\\beta}[k] = \\frac{2}{3}\\,V_{\\mathrm{dc}}\\left(S_a + S_b\\,\\exp\\left(\\mathrm{j}\\,\\frac{2\\pi}{3}\\right) + S_c\\,\\exp\\left(-\\mathrm{j}\\,\\frac{2\\pi}{3}\\right)\\right)$$\nSubstituting this into our derived equation for $i_{\\alpha\\beta}[k+1]$ gives the final expression:\n$$i_{\\alpha\\beta}[k+1] = \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)\\,i_{\\alpha\\beta}[k] + \\frac{1}{R}\\left(1 - \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)\\right) \\left[ \\frac{2}{3}\\,V_{\\mathrm{dc}}\\left(S_a + S_b\\,\\exp\\left(\\mathrm{j}\\,\\frac{2\\pi}{3}\\right) + S_c\\,\\exp\\left(-\\mathrm{j}\\,\\frac{2\\pi}{3}\\right)\\right) \\right]$$\nCombining the constant terms yields the closed-form solution:\n$$i_{\\alpha\\beta}[k+1] = \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)\\,i_{\\alpha\\beta}[k] + \\frac{2 V_{\\mathrm{dc}}}{3R}\\left(1 - \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)\\right) \\left(S_a + S_b\\,\\exp\\left(\\mathrm{j}\\,\\frac{2\\pi}{3}\\right) + S_c\\,\\exp\\left(-\\mathrm{j}\\,\\frac{2\\pi}{3}\\right)\\right)$$\nThis expression provides the exact one-step-ahead prediction of the current vector based on its present value, the system parameters, and the applied switching state.",
            "answer": "$$\n\\boxed{\\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right) i_{\\alpha\\beta}[k] + \\frac{2 V_{\\mathrm{dc}}}{3R} \\left(1 - \\exp\\left(-\\frac{R T_{\\mathrm{s}}}{L}\\right)\\right) \\left(S_a + S_b \\exp\\left(\\mathrm{j}\\frac{2\\pi}{3}\\right) + S_c \\exp\\left(-\\mathrm{j}\\frac{2\\pi}{3}\\right)\\right)}\n$$"
        },
        {
            "introduction": "With a predictive model in place, the controller's core task is to decide which action to take. This practice places you at the heart of the Finite Control Set MPC decision-making loop. You will evaluate the outcome of every possible switching action against a defined cost function, which balances the primary goal of tracking a reference current with the practical need to limit switching transitions. ",
            "id": "3858825",
            "problem": "A three-phase two-level voltage-source inverter feeds a balanced resistive-inductive load modeled in the stationary orthogonal frame. Let the Clarke-transformed current be the stationary orthogonal vector $\\mathbf{i}_k = (i_{\\alpha,k}, i_{\\beta,k})$ measured at sampling instant $k$, and let the reference current be $\\mathbf{i}_{\\mathrm{ref}} = (i_{\\alpha,\\mathrm{ref}}, i_{\\beta,\\mathrm{ref}})$. The load is modeled by Kirchhoff's voltage law and the inductor law as $\\mathbf{v} - R\\,\\mathbf{i} = L\\,\\frac{d\\mathbf{i}}{dt}$, where $\\mathbf{v}$ is the inverter output voltage in the stationary orthogonal frame, $R$ is the phase resistance, and $L$ is the phase inductance.\n\nIn Finite Control Set Model Predictive Control (FCS-MPC), the prediction is computed by the forward Euler discretization $\\mathbf{i}_{k+1}(\\mathbf{v}) = \\mathbf{i}_k + \\frac{T_s}{L}\\left(\\mathbf{v} - R\\,\\mathbf{i}_k\\right)$ for each candidate switching state, with sampling period $T_s$. The two-level inverter has eight switching states indexed by $s \\in \\{0,1,2,3,4,5,6,7\\}$ with bit triples $(s_a,s_b,s_c) \\in \\{0,1\\}^3$ ordered as $s=0:(0,0,0)$, $s=1:(1,0,0)$, $s=2:(1,1,0)$, $s=3:(0,1,0)$, $s=4:(0,1,1)$, $s=5:(0,0,1)$, $s=6:(1,0,1)$, $s=7:(1,1,1)$. The stationary orthogonal voltage vectors produced by the inverter are defined as\n- for the active states $s \\in \\{1,2,3,4,5,6\\}$: $\\mathbf{v}_s = \\left(\\frac{2}{3}V_{\\mathrm{dc}}\\cos\\theta_s,\\,\\frac{2}{3}V_{\\mathrm{dc}}\\sin\\theta_s\\right)$ with $\\theta_s = (s-1)\\frac{\\pi}{3}$ (angles in radians),\n- for the zero states $s \\in \\{0,7\\}$: $\\mathbf{v}_s = (0,0)$,\nwhere $V_{\\mathrm{dc}}$ is the direct current (DC) bus voltage.\n\nThe FCS-MPC stage cost is\n$$\ng(s) \\;=\\; \\left\\|\\mathbf{i}_{k+1}(\\mathbf{v}_s) - \\mathbf{i}_{\\mathrm{ref}}\\right\\|_2^2 \\;+\\; \\lambda_{\\mathrm{sw}}\\,N_{\\mathrm{sw}}(s_{\\mathrm{prev}}, s),\n$$\nwhere $N_{\\mathrm{sw}}(s_{\\mathrm{prev}}, s)$ is the Hamming distance between the previous switching state $s_{\\mathrm{prev}}$ and the candidate $s$ (the number of leg transitions), and $\\lambda_{\\mathrm{sw}}$ is a switching penalty weight expressed in units consistent with the squared error term.\n\nGiven the following numerical data:\n- $V_{\\mathrm{dc}} = 600\\,\\mathrm{V}$,\n- $L = 2.0\\times 10^{-3}\\,\\mathrm{H}$,\n- $R = 0.20\\,\\Omega$,\n- $T_s = 5.0\\times 10^{-5}\\,\\mathrm{s}$,\n- $\\mathbf{i}_k = (20.0\\,\\mathrm{A},\\,0.0\\,\\mathrm{A})$,\n- $\\mathbf{i}_{\\mathrm{ref}} = (25.0\\,\\mathrm{A},\\,5.0\\,\\mathrm{A})$,\n- $s_{\\mathrm{prev}} = 2$,\n- $\\lambda_{\\mathrm{sw}} = 10.0\\,\\mathrm{A}^2$ per leg transition,\n\ncompute the index $s^\\star \\in \\{0,1,2,3,4,5,6,7\\}$ that minimizes $g(s)$. Express your final answer as the single integer index $s^\\star$. No rounding is required. Angles are in radians.",
            "solution": "The problem requires finding the optimal switching state index $s^\\star$ that minimizes a given cost function $g(s)$ for a Finite Control Set Model Predictive Control (FCS-MPC) algorithm applied to a three-phase two-level voltage-source inverter. The optimal state is the one for which the cost function $g(s)$ has the minimum value among all possible eight switching states $s \\in \\{0, 1, 2, 3, 4, 5, 6, 7\\}$.\n\nThe cost function is given by:\n$$\ng(s) = \\left\\|\\mathbf{i}_{k+1}(\\mathbf{v}_s) - \\mathbf{i}_{\\mathrm{ref}}\\right\\|_2^2 + \\lambda_{\\mathrm{sw}} N_{\\mathrm{sw}}(s_{\\mathrm{prev}}, s)\n$$\nwhere $\\mathbf{i}_{k+1}(\\mathbf{v}_s)$ is the predicted current vector for the next sampling instant, $\\mathbf{i}_{\\mathrm{ref}}$ is the reference current vector, $\\lambda_{\\mathrm{sw}}$ is the switching penalty weight, and $N_{\\mathrm{sw}}(s_{\\mathrm{prev}}, s)$ is the number of leg transitions from the previous state $s_{\\mathrm{prev}}$ to the candidate state $s$.\n\nThe prediction of the current is based on the forward Euler discretization of the load model:\n$$\n\\mathbf{i}_{k+1}(\\mathbf{v}_s) = \\mathbf{i}_k + \\frac{T_s}{L}\\left(\\mathbf{v}_s - R\\,\\mathbf{i}_k\\right)\n$$\nThis can be rearranged into a more convenient form for calculation:\n$$\n\\mathbf{i}_{k+1}(\\mathbf{v}_s) = \\left(1 - \\frac{R T_s}{L}\\right)\\mathbf{i}_k + \\frac{T_s}{L}\\mathbf{v}_s\n$$\nFirst, let's substitute the given numerical values and calculate the constant coefficients.\n-   $R = 0.20\\,\\Omega$\n-   $L = 2.0 \\times 10^{-3}\\,\\mathrm{H}$\n-   $T_s = 5.0 \\times 10^{-5}\\,\\mathrm{s}$\n-   $\\mathbf{i}_k = (20.0, 0.0)$\n\nThe coefficients are:\n$$\n\\frac{T_s}{L} = \\frac{5.0 \\times 10^{-5}}{2.0 \\times 10^{-3}} = 0.025\\,\\mathrm{s/H}\n$$\n$$\n1 - \\frac{R T_s}{L} = 1 - (0.20) \\cdot (0.025) = 1 - 0.005 = 0.995\n$$\nSubstituting these values and $\\mathbf{i}_k$ into the prediction equation:\n$$\n\\mathbf{i}_{k+1}(\\mathbf{v}_s) = 0.995 \\cdot (20.0, 0.0) + 0.025 \\cdot \\mathbf{v}_s = (19.9, 0.0) + 0.025 \\cdot \\mathbf{v}_s\n$$\nThe first term of the cost function is the squared norm of the error vector $\\mathbf{e}_s = \\mathbf{i}_{k+1}(\\mathbf{v}_s) - \\mathbf{i}_{\\mathrm{ref}}$.\nGiven $\\mathbf{i}_{\\mathrm{ref}} = (25.0, 5.0)$, the error vector is:\n$$\n\\mathbf{e}_s = (19.9, 0.0) + 0.025 \\cdot \\mathbf{v}_s - (25.0, 5.0) = (-5.1, -5.0) + 0.025 \\cdot \\mathbf{v}_s\n$$\nNext, we calculate the inverter output voltage vectors $\\mathbf{v}_s$ for each switching state $s$. Given $V_{\\mathrm{dc}} = 600\\,\\mathrm{V}$:\nThe magnitude of the active voltage vectors is $\\frac{2}{3}V_{\\mathrm{dc}} = \\frac{2}{3}(600) = 400\\,\\mathrm{V}$.\n-   For zero states $s \\in \\{0, 7\\}$: $\\mathbf{v}_0 = \\mathbf{v}_7 = (0, 0)\\,\\mathrm{V}$.\n-   For active states $s \\in \\{1, 2, 3, 4, 5, 6\\}$, $\\mathbf{v}_s = (400\\cos\\theta_s, 400\\sin\\theta_s)$ with $\\theta_s = (s-1)\\frac{\\pi}{3}$.\n    -   $s=1$: $\\theta_1 = 0 \\implies \\mathbf{v}_1 = (400, 0)\\,\\mathrm{V}$.\n    -   $s=2$: $\\theta_2 = \\frac{\\pi}{3} \\implies \\mathbf{v}_2 = (400\\cos(\\frac{\\pi}{3}), 400\\sin(\\frac{\\pi}{3})) = (200, 200\\sqrt{3})\\,\\mathrm{V}$.\n    -   $s=3$: $\\theta_3 = \\frac{2\\pi}{3} \\implies \\mathbf{v}_3 = (400\\cos(\\frac{2\\pi}{3}), 400\\sin(\\frac{2\\pi}{3})) = (-200, 200\\sqrt{3})\\,\\mathrm{V}$.\n    -   $s=4$: $\\theta_4 = \\pi \\implies \\mathbf{v}_4 = (-400, 0)\\,\\mathrm{V}$.\n    -   $s=5$: $\\theta_5 = \\frac{4\\pi}{3} \\implies \\mathbf{v}_5 = (400\\cos(\\frac{4\\pi}{3}), 400\\sin(\\frac{4\\pi}{3})) = (-200, -200\\sqrt{3})\\,\\mathrm{V}$.\n    -   $s=6$: $\\theta_6 = \\frac{5\\pi}{3} \\implies \\mathbf{v}_6 = (400\\cos(\\frac{5\\pi}{3}), 400\\sin(\\frac{5\\pi}{3})) = (200, -200\\sqrt{3})\\,\\mathrm{V}$.\n\nThe second term of the cost function is the switching penalty, $\\lambda_{\\mathrm{sw}} N_{\\mathrm{sw}}(s_{\\mathrm{prev}}, s)$. Given $s_{\\mathrm{prev}} = 2$ and $\\lambda_{\\mathrm{sw}} = 10.0\\,\\mathrm{A}^2$, we compute the Hamming distance $N_{\\mathrm{sw}}(2, s)$ for each state $s$. The bit representation for $s_{\\mathrm{prev}}=2$ is $(1,1,0)$.\n-   $s=0$: $(0,0,0) \\implies N_{\\mathrm{sw}}(2,0)=2$. Cost: $10.0 \\cdot 2 = 20.0$.\n-   $s=1$: $(1,0,0) \\implies N_{\\mathrm{sw}}(2,1)=1$. Cost: $10.0 \\cdot 1 = 10.0$.\n-   $s=2$: $(1,1,0) \\implies N_{\\mathrm{sw}}(2,2)=0$. Cost: $10.0 \\cdot 0 = 0.0$.\n-   $s=3$: $(0,1,0) \\implies N_{\\mathrm{sw}}(2,3)=1$. Cost: $10.0 \\cdot 1 = 10.0$.\n-   $s=4$: $(0,1,1) \\implies N_{\\mathrm{sw}}(2,4)=2$. Cost: $10.0 \\cdot 2 = 20.0$.\n-   $s=5$: $(0,0,1) \\implies N_{\\mathrm{sw}}(2,5)=3$. Cost: $10.0 \\cdot 3 = 30.0$.\n-   $s=6$: $(1,0,1) \\implies N_{\\mathrm{sw}}(2,6)=2$. Cost: $10.0 \\cdot 2 = 20.0$.\n-   $s=7$: $(1,1,1) \\implies N_{\\mathrm{sw}}(2,7)=1$. Cost: $10.0 \\cdot 1 = 10.0$.\n\nNow we evaluate the total cost $g(s)$ for each state. All values are in units of $\\mathrm{A}^2$.\n\n-   **State $s=0$**: $\\mathbf{v}_0 = (0,0)$.\n    $\\mathbf{e}_0 = (-5.1, -5.0)$.\n    $g(0) = \\|(-5.1, -5.0)\\|_2^2 + 20.0 = (-5.1)^2 + (-5.0)^2 + 20.0 = 26.01 + 25.0 + 20.0 = 71.01$.\n\n-   **State $s=1$**: $0.025 \\cdot \\mathbf{v}_1 = 0.025 \\cdot (400,0) = (10.0, 0.0)$.\n    $\\mathbf{e}_1 = (-5.1, -5.0) + (10.0, 0.0) = (4.9, -5.0)$.\n    $g(1) = \\|(4.9, -5.0)\\|_2^2 + 10.0 = (4.9)^2 + (-5.0)^2 + 10.0 = 24.01 + 25.0 + 10.0 = 59.01$.\n\n-   **State $s=2$**: $0.025 \\cdot \\mathbf{v}_2 = 0.025 \\cdot (200, 200\\sqrt{3}) = (5.0, 5.0\\sqrt{3})$.\n    $\\mathbf{e}_2 = (-5.1, -5.0) + (5.0, 5.0\\sqrt{3}) = (-0.1, -5.0 + 5.0\\sqrt{3})$.\n    $g(2) = \\|(-0.1, -5.0+5.0\\sqrt{3})\\|_2^2 + 0.0 = (-0.1)^2 + (-5.0+5.0\\sqrt{3})^2 = 0.01 + (25.0 - 50.0\\sqrt{3} + 75.0) = 100.01 - 50.0\\sqrt{3} \\approx 100.01 - 86.60 = 13.41$.\n\n-   **State $s=3$**: $0.025 \\cdot \\mathbf{v}_3 = 0.025 \\cdot (-200, 200\\sqrt{3}) = (-5.0, 5.0\\sqrt{3})$.\n    $\\mathbf{e}_3 = (-5.1, -5.0) + (-5.0, 5.0\\sqrt{3}) = (-10.1, -5.0 + 5.0\\sqrt{3})$.\n    $g(3) = \\|(-10.1, -5.0+5.0\\sqrt{3})\\|_2^2 + 10.0 = (-10.1)^2 + (-5.0+5.0\\sqrt{3})^2 + 10.0 = 102.01 + (100.0 - 50.0\\sqrt{3}) + 10.0 = 212.01 - 50.0\\sqrt{3} \\approx 212.01 - 86.60 = 125.41$.\n\n-   **State $s=4$**: $0.025 \\cdot \\mathbf{v}_4 = 0.025 \\cdot (-400,0) = (-10.0, 0.0)$.\n    $\\mathbf{e}_4 = (-5.1, -5.0) + (-10.0, 0.0) = (-15.1, -5.0)$.\n    $g(4) = \\|(-15.1, -5.0)\\|_2^2 + 20.0 = (-15.1)^2 + (-5.0)^2 + 20.0 = 228.01 + 25.0 + 20.0 = 273.01$.\n\n-   **State $s=5$**: $0.025 \\cdot \\mathbf{v}_5 = 0.025 \\cdot (-200, -200\\sqrt{3}) = (-5.0, -5.0\\sqrt{3})$.\n    $\\mathbf{e}_5 = (-5.1, -5.0) + (-5.0, -5.0\\sqrt{3}) = (-10.1, -5.0 - 5.0\\sqrt{3})$.\n    $g(5) = \\|(-10.1, -5.0-5.0\\sqrt{3})\\|_2^2 + 30.0 = (-10.1)^2 + (-5.0-5.0\\sqrt{3})^2 + 30.0 = 102.01 + (25.0 + 50.0\\sqrt{3} + 75.0) + 30.0 = 232.01 + 50.0\\sqrt{3} \\approx 232.01 + 86.60 = 318.61$.\n\n-   **State $s=6$**: $0.025 \\cdot \\mathbf{v}_6 = 0.025 \\cdot (200, -200\\sqrt{3}) = (5.0, -5.0\\sqrt{3})$.\n    $\\mathbf{e}_6 = (-5.1, -5.0) + (5.0, -5.0\\sqrt{3}) = (-0.1, -5.0 - 5.0\\sqrt{3})$.\n    $g(6) = \\|(-0.1, -5.0-5.0\\sqrt{3})\\|_2^2 + 20.0 = (-0.1)^2 + (-5.0-5.0\\sqrt{3})^2 + 20.0 = 0.01 + (25.0 + 50.0\\sqrt{3} + 75.0) + 20.0 = 120.01 + 50.0\\sqrt{3} \\approx 120.01 + 86.60 = 206.61$.\n\n-   **State $s=7$**: $\\mathbf{v}_7 = (0,0)$.\n    $\\mathbf{e}_7 = (-5.1, -5.0)$.\n    $g(7) = \\|(-5.1, -5.0)\\|_2^2 + 10.0 = (-5.1)^2 + (-5.0)^2 + 10.0 = 26.01 + 25.0 + 10.0 = 61.01$.\n\nSummary of the costs:\n-   $g(0) \\approx 71.01$\n-   $g(1) \\approx 59.01$\n-   $g(2) \\approx 13.41$\n-   $g(3) \\approx 125.41$\n-   $g(4) \\approx 273.01$\n-   $g(5) \\approx 318.61$\n-   $g(6) \\approx 206.61$\n-   $g(7) \\approx 61.01$\n\nBy comparing the values of $g(s)$ for all possible states, the minimum cost is $g(2) \\approx 13.41$. Therefore, the optimal switching state index is $s^\\star = 2$.",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "A gap often exists between theory and practice, and in digital control, computational delay is a primary example. This exercise tackles this crucial implementation challenge head-on. You will learn how to adapt the predictive model to account for the one-step delay between when a control action is calculated and when it is physically applied, a vital skill for developing stable and effective real-world MPC systems. ",
            "id": "3858844",
            "problem": "Consider a single-phase leg of a two-level Voltage Source Inverter (VSI) driving a series resistor–inductor load. Let the inductor current be the state, denoted by $i(t)$, and the applied inverter pole voltage be the control input, denoted by $u(t) \\in \\{-V_{\\mathrm{dc}}, V_{\\mathrm{dc}}\\}$, where $V_{\\mathrm{dc}}$ is the direct current link voltage. The load parameters are a resistance $R > 0$ and an inductance $L > 0$. The continuous-time plant dynamics are given by the well-tested electromagnetic relation\n$$\nL\\,\\frac{d i(t)}{dt} \\;=\\; -R\\,i(t) + u(t).\n$$\nSampling is performed synchronously with switching under a Zero-Order Hold (ZOH) assumption: the control input is held constant over each sampling interval of duration $T_{s} > 0$. Due to a single-step computational delay in the Model Predictive Control (MPC) implementation, the control decision computed at sample $k$ is not applied over the interval $[k T_{s}, (k+1)T_{s})$; instead, the previously computed control $u_{k-1}$ is applied over $[k T_{s}, (k+1)T_{s})$, and the newly computed $u_{k}$ is applied over $[(k+1)T_{s}, (k+2)T_{s})$.\n\nStarting strictly from the continuous-time plant equation above and the ZOH sampling assumption, and without invoking any shortcut formulas, derive a delay compensation method that uses predicted states to evaluate the effect of the candidate control $u_{k}$ despite the single-step computational delay. Specifically, obtain a closed-form analytic expression for the two-step-ahead predicted current $i_{k+2|k}$ in terms of the sampled current $i_{k}$, the previously applied control $u_{k-1}$, the candidate control $u_{k}$, and the physical parameters $R$, $L$, and $T_{s}$. Assume ideal switching and no measurement or modeling noise. In addition, explain qualitatively how using this compensated two-step-ahead prediction impacts the prediction accuracy relative to a naive one-step-ahead prediction that ignores the computational delay.\n\nExpress the final answer as a single closed-form analytic expression for $i_{k+2|k}$ with no numerical substitution.",
            "solution": "The task is to derive a closed-form expression for the two-step-ahead predicted current, $i_{k+2|k}$, for a series RL circuit controlled by a voltage source with a one-step computational delay. The derivation must start from the fundamental continuous-time differential equation.\n\nThe continuous-time dynamics of the inductor current $i(t)$ are given by the first-order linear ordinary differential equation (ODE):\n$$L\\frac{d i(t)}{dt} = -R i(t) + u(t)$$\nThis equation can be rewritten in the standard form:\n$$\\frac{d i(t)}{dt} + \\frac{R}{L}i(t) = \\frac{1}{L}u(t)$$\nThe problem states that the control input $u(t)$ is constant over each sampling interval of duration $T_s$ (Zero-Order Hold assumption). The general solution to this ODE for an interval starting at $t_0$ with an initial condition $i(t_0)$ and a constant input $u$ applied over the interval $[t_0, t_f]$ is given by:\n$$i(t_f) = i(t_0) \\exp\\left(-\\frac{R}{L}(t_f - t_0)\\right) + \\frac{u}{R}\\left(1 - \\exp\\left(-\\frac{R}{L}(t_f - t_0)\\right)\\right)$$\nThis formula provides the exact discretized evolution of the state. We will apply this solution sequentially over two sampling intervals to account for the computational delay.\n\nStep 1: Prediction from time $t=kT_s$ to $t=(k+1)T_s$.\nAt the sampling instant $k$, the measured current is $i_k = i(kT_s)$. Due to the one-step computational delay, the control input applied during the interval $[kT_s, (k+1)T_s)$ is not the newly computed $u_k$, but the previously computed $u_{k-1}$.\nWe apply the general solution with the following parameters:\n- Initial time: $t_0 = kT_s$\n- Final time: $t_f = (k+1)T_s$\n- Interval duration: $t_f - t_0 = T_s$\n- Initial condition: $i(t_0) = i_k$\n- Constant control input: $u = u_{k-1}$\n\nLet $i_{k+1}$ represent the current at time $t=(k+1)T_s$. Substituting these values into the general solution gives the state at the end of the first interval:\n$$i_{k+1} = i_k \\exp\\left(-\\frac{R}{L}T_s\\right) + \\frac{u_{k-1}}{R}\\left(1 - \\exp\\left(-\\frac{R}{L}T_s\\right)\\right)$$\nThis value, $i_{k+1}$, is the one-step-ahead prediction of the current, $i_{k+1|k}$, which serves as the initial condition for the next prediction step.\n\nStep 2: Prediction from time $t=(k+1)T_s$ to $t=(k+2)T_s$.\nThe newly computed control action at instant $k$, denoted $u_k$, is applied during the interval $[(k+1)T_s, (k+2)T_s)$. To find the effect of this control action, we predict the state forward for another step.\nWe apply the general solution again with updated parameters:\n- Initial time: $t_0 = (k+1)T_s$\n- Final time: $t_f = (k+2)T_s$\n- Interval duration: $t_f - t_0 = T_s$\n- Initial condition: $i(t_0) = i_{k+1}$ (from Step 1)\n- Constant control input: $u = u_k$\n\nThe predicted current at time $t=(k+2)T_s$, which is the desired quantity $i_{k+2|k}$, is:\n$$i_{k+2|k} = i_{k+1} \\exp\\left(-\\frac{R}{L}T_s\\right) + \\frac{u_k}{R}\\left(1 - \\exp\\left(-\\frac{R}{L}T_s\\right)\\right)$$\nTo obtain the final expression in terms of the known quantities at time $k$ ($i_k$, $u_{k-1}$) and the candidate control $u_k$, we substitute the expression for $i_{k+1}$ from Step 1 into the equation above:\n$$i_{k+2|k} = \\left[ i_k \\exp\\left(-\\frac{R}{L}T_s\\right) + \\frac{u_{k-1}}{R}\\left(1 - \\exp\\left(-\\frac{R}{L}T_s\\right)\\right) \\right] \\exp\\left(-\\frac{R}{L}T_s\\right) + \\frac{u_k}{R}\\left(1 - \\exp\\left(-\\frac{R}{L}T_s\\right)\\right)$$\nWe distribute the term $\\exp\\left(-\\frac{R}{L}T_s\\right)$:\n$$i_{k+2|k} = i_k \\exp\\left(-2\\frac{R}{L}T_s\\right) + \\frac{u_{k-1}}{R}\\left(1 - \\exp\\left(-\\frac{R}{L}T_s\\right)\\right)\\exp\\left(-\\frac{R}{L}T_s\\right) + \\frac{u_k}{R}\\left(1 - \\exp\\left(-\\frac{R}{L}T_s\\right)\\right)$$\nThe expression can be simplified by factoring out the common term $\\left(1 - \\exp\\left(-\\frac{R}{L}T_s\\right)\\right)/R$:\n$$i_{k+2|k} = i_k \\exp\\left(-2\\frac{R}{L}T_s\\right) + \\frac{1 - \\exp\\left(-\\frac{R}{L}T_s\\right)}{R} \\left( u_{k-1}\\exp\\left(-\\frac{R}{L}T_s\\right) + u_k \\right)$$\nThis is the closed-form analytic expression for the two-step-ahead predicted current that correctly compensates for the single-step computational delay.\n\nRegarding the qualitative impact on prediction accuracy, a \"naive\" prediction would ignore the delay and wrongly assume that the candidate control $u_k$ is applied over the interval $[kT_s, (k+1)T_s)$. The MPC controller would then make decisions based on an inaccurate model of the system's response, evaluating the effect of $u_k$ one step too early. This mismatch between the predicted and actual system behavior leads to suboptimal control actions, which can manifest as poor reference tracking, oscillations, and reduced stability.\n\nBy using the derived two-step-ahead compensated prediction $i_{k+2|k}$, the controller correctly accounts for the delay. It recognizes that its decision $u_k$ will not influence the state until the interval $[(k+1)T_s, (k+2)T_s)$. By predicting two steps ahead, the MPC's cost function evaluates the true future impact of the control action $u_k$. This aligns the optimization process with the physical reality of the delayed system. As a result, prediction accuracy is vastly improved because the predictive model is now an exact representation of the system dynamics, including the delay. This leads to significantly better control performance and stability, as the controller can make decisions that are appropriately timed to guide the system state effectively.",
            "answer": "$$\\boxed{i_k \\exp\\left(-2\\frac{R}{L}T_s\\right) + \\frac{1 - \\exp\\left(-\\frac{R}{L}T_s\\right)}{R} \\left( u_{k-1}\\exp\\left(-\\frac{R}{L}T_s\\right) + u_k \\right)}$$"
        }
    ]
}