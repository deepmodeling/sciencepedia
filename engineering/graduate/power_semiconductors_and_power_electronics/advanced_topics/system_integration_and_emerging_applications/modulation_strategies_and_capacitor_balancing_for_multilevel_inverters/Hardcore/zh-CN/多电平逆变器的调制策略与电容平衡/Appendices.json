{
    "hands_on_practices": [
        {
            "introduction": "不同的调制策略在利用直流母线电压方面具有不同的能力，这直接影响逆变器的输出性能。本练习将引导您从第一性原理出发，推导并比较空间矢量调制（SVM）与传统正弦脉宽调制（SPWM）的线性调制范围。通过这项基础而关键的计算，您将能定量地理解为何SVM等先进调制技术能够更有效地利用直流电压。",
            "id": "3859557",
            "problem": "一台具有分裂直流母线电压 $V_{\\mathrm{dc}}$ 的三相三电平中点钳位（NPC）型逆变器，采用空间矢量调制（SVM）进行调制，以产生平衡的正弦相电压。该逆变器通过在各中矢量之间适当分配驻留时间来实现电容（中点）平衡，但不允许任何桥臂输出超出 $\\pm V_{\\mathrm{dc}}/2$ 的范围。定义幅值调制指数 $m_a$ 为 $m_a = V_m/(V_{\\mathrm{dc}}/2)$，其中 $V_m$ 是指令基波相电压参考的峰值幅值。假设器件理想，死区时间可忽略不计，并且由于调制策略，中点电位在平均意义上保持居中。\n\n从三相正弦参考的定义、参考空间矢量必须位于可用开关矢量凸包内的约束，以及在最优SVM中可以注入零序电压以最大化线性范围这一事实出发，推导三电平SVM在进入过调制前的最大 $m_a$ 值。然后，推导不含零序分量注入的基于载波的正弦脉宽调制（SPWM）对应的线性范围极限 $m_a$ 值。利用第一性原理，根据三相正弦参考的极值以及零序分量注入对调制信号瞬时最大值和最小值的影响，仔细论证这些边界。将最终答案表示为精确的符号表达式，无需四舍五入，也无需单位。将最终答案以行矩阵的形式给出，其中包含两个值，顺序为：三电平SVM进入过调制前的最大 $m_a$ 值，SPWM的线性范围极限 $m_a$ 值。",
            "solution": "我们首先将三相系统的三个平衡正弦相参考定义为\n$$\nv_a^{*}(t) = V_m \\sin(\\omega t), \\quad v_b^{*}(t) = V_m \\sin\\left(\\omega t - \\frac{2\\pi}{3}\\right), \\quad v_c^{*}(t) = V_m \\sin\\left(\\omega t + \\frac{2\\pi}{3}\\right),\n$$\n其中 $V_m$ 是期望基波相电压的峰值，$\\omega$ 是角频率。幅值调制指数定义为\n$$\nm_a = \\frac{V_m}{V_{\\mathrm{dc}}/2}.\n$$\n在所有情况下，瞬时指令桥臂电压必须满足可用的离散桥臂状态，对于三电平中点钳位（NPC）型逆变器，这些状态的边界为 $\\pm V_{\\mathrm{dc}}/2$。\n\n我们分析这三个参考的极值结构。对于任意给定的时间 $t$，定义\n$$\nv_{\\max}(t) = \\max\\{v_a^{*}(t), v_b^{*}(t), v_c^{*}(t)\\}, \\quad v_{\\min}(t) = \\min\\{v_a^{*}(t), v_b^{*}(t), v_c^{*}(t)\\}.\n$$\n对于平衡的正弦相参考，一个基本的观察是最大瞬时跨度\n$$\n\\Delta(t) := v_{\\max}(t) - v_{\\min}(t).\n$$\n我们断言 $\\Delta(t)$ 随时间变化的最大值为\n$$\n\\max_{t} \\Delta(t) = \\sqrt{3}\\, V_m.\n$$\n为了证明这一点，考虑在跨度最大瞬间实现最大值减去最小值的相位相差 $120^{\\circ}$ 的那对相。不失一般性，计算\n$$\n\\sin\\left(\\theta + \\frac{2\\pi}{3}\\right) - \\sin\\left(\\theta - \\frac{2\\pi}{3}\\right) = 2 \\cos(\\theta) \\sin\\left(\\frac{2\\pi}{3}\\right) = 2 \\cos(\\theta) \\cdot \\frac{\\sqrt{3}}{2} = \\sqrt{3} \\cos(\\theta),\n$$\n当 $\\cos(\\theta) = 1$ 时，其幅值达到最大值 $\\sqrt{3}$。乘以 $V_m$ 得到 $\\max_{t} \\Delta(t) = \\sqrt{3}\\, V_m$。具体来说，当 $\\theta = \\pi/6$ 时，三相的值分别为 $V_m/2$、 $V_m$ 和 $-V_m/2$ 是错误的，当 $\\omega t = \\pi/2$时，三相的值分别为 $V_m$, $-V_m/2$和$-V_m/2$，此时跨度为$1.5V_m$。当$\\omega t = \\pi/3$时，三相的值为 $\\frac{\\sqrt{3}}{2}V_m$, $0$ 和 $-\\frac{\\sqrt{3}}{2}V_m$，此时跨度$\\Delta=\\sqrt{3}V_m$。\n\n现在我们计算两种调制策略的线性极限。\n\n1. 具有最优零序分量注入的三电平NPC逆变器的空间矢量调制（SVM）。空间矢量调制选择一个共模（零序）注入分量 $v_0(t)$，以使参考空间矢量保持在可用开关矢量的凸包内。一个能最大化线性范围并使到桥臂边界的裕度均等的优化选择是\n$$\nv_0(t) = -\\frac{v_{\\max}(t) + v_{\\min}(t)}{2}.\n$$\n定义修正后的相指令 $v_i'(t) = v_i^{*}(t) + v_0(t)$，其中 $i \\in \\{a,b,c\\}$。修正后的最大值和最小值变为\n$$\nv_{\\max}'(t) = v_{\\max}(t) - \\frac{v_{\\max}(t) + v_{\\min}(t)}{2} = \\frac{v_{\\max}(t) - v_{\\min}(t)}{2} = \\frac{\\Delta(t)}{2},\n$$\n$$\nv_{\\min}'(t) = v_{\\min}(t) - \\frac{v_{\\max}(t) + v_{\\min}(t)}{2} = -\\frac{v_{\\max}(t) - v_{\\min}(t)}{2} = -\\frac{\\Delta(t)}{2}.\n$$\n因此，在任何时刻，所有三个修正后的指令都位于区间 $\\left[-\\frac{\\Delta(t)}{2}, \\frac{\\Delta(t)}{2}\\right]$ 内。线性区的约束是任何桥臂指令都不能超过可用边界 $\\pm V_{\\mathrm{dc}}/2$，这要求\n$$\n\\frac{\\Delta(t)}{2} \\leq \\frac{V_{\\mathrm{dc}}}{2} \\quad \\text{for all } t \\quad \\Longrightarrow \\quad \\Delta(t) \\leq V_{\\mathrm{dc}} \\quad \\text{for all } t.\n$$\n使用最大跨度 $\\max_{t} \\Delta(t) = \\sqrt{3}\\, V_m$，最坏情况下的约束得出\n$$\n\\sqrt{3}\\, V_m \\leq V_{\\mathrm{dc}} \\quad \\Longrightarrow \\quad V_m \\leq \\frac{V_{\\mathrm{dc}}}{\\sqrt{3}}.\n$$\n因此，在三电平SVM下，进入过调制前的最大调制指数为\n$$\nm_{a,\\max}^{\\mathrm{SVM}} = \\frac{V_m}{V_{\\mathrm{dc}}/2} \\bigg|_{\\max} = \\frac{V_{\\mathrm{dc}/\\sqrt{3}}}{V_{\\mathrm{dc}}/2} = \\frac{2}{\\sqrt{3}}.\n$$\n请注意，三电平桥臂中存在的中间 $0$ 电平允许通过在中矢量间进行适当的驻留时间分配来实现中点（电容）平衡，但这并没有将允许的极限桥臂电压增加到 $\\pm V_{\\mathrm{dc}}/2$ 之外，因此，对于线性范围边界，上面推导出的幅值限制与电平数无关。\n\n2. 不含零序分量注入的正弦脉宽调制（SPWM）。在不含任何共模注入的基于载波的SPWM中，相指令就是正弦波本身，因此极限桥臂指令的幅值就是 $|v_i^{*}(t)| \\leq V_m$。线性约束要求\n$$\nV_m \\leq \\frac{V_{\\mathrm{dc}}}{2}.\n$$\n因此，线性范围极限的调制指数为\n$$\nm_{a,\\max}^{\\mathrm{SPWM}} = \\frac{V_m}{V_{\\mathrm{dc}}/2} \\bigg|_{\\max} = 1.\n$$\n\n总结结果，三电平空间矢量调制在进入过调制前的最大调制指数为 $\\frac{2}{\\sqrt{3}}$，而正弦脉宽调制的线性范围极限为 $1$。这些都是精确的符号值。",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{2}{\\sqrt{3}} & 1\\end{pmatrix}}$$"
        },
        {
            "introduction": "电容的电压平衡是多电平逆变器稳定运行的核心，但这不仅关乎平均电压，更关乎瞬时电压纹波。本练习提供了一个具体的场景，要求您分析一种特定的调制策略如何直接影响飞跨电容中的能量波动。精确计算这种能量波动对于电容器的选型、尺寸设计和评估系统热应力至关重要。",
            "id": "3859566",
            "problem": "一个单桥臂三电平飞跨电容逆变器在其相端合成三个输出电压电平：$-V_{\\mathrm{dc}}/2$、$0$ 和 $+V_{\\mathrm{dc}}/2$，其中 $V_{\\mathrm{dc}}$ 是直流 (DC) 母线电压。该桥臂使用一个电容值为 $C_{\\mathrm{f}}$ 的飞跨电容，其标称电压为 $V_{\\mathrm{dc}}/2$。在脉宽调制 (PWM) 的一个开关周期 $T_{\\mathrm{s}}$ 内，假设相负载电流近似恒定且等于 $I>0$（正电流从逆变器流向负载）。调制策略将周期的一部分（比例为 $\\gamma$）分配给零电平状态。在这个持续时间为 $\\tau_{0}=\\gamma T_{\\mathrm{s}}$ 的零电平占用时间内，一种电容平衡控制将零电平分为两个子区间：在持续时间为 $D\\,\\tau_{0}$ 的第一个子区间内，开关配置产生电容电流 $+I$（充电）；在持续时间为 $(1-D)\\,\\tau_{0}$ 的第二个子区间内，产生电容电流 $-I$（放电）。在零电平区间之外，电容器被旁路，其电流为零。假设开关是理想的，寄生参数可忽略不计，并且周期开始时的飞跨电容电压为 $V_{\\mathrm{c}}(0)=V_{\\mathrm{dc}}/2$。\n\n从电容器的本构关系和标准能量定义出发，推导开关周期内飞跨电容中存储能量的峰峰值变化，然后根据以下参数计算其数值：\n- $C_{\\mathrm{f}}=100\\,\\mu\\mathrm{F}$,\n- $V_{\\mathrm{dc}}=600\\,\\mathrm{V}$,\n- $T_{\\mathrm{s}}=50\\,\\mu\\mathrm{s}$,\n- $\\gamma=0.4$,\n- $I=20\\,\\mathrm{A}$,\n- $D=0.3$.\n\n将最终数值结果四舍五入至四位有效数字。以毫焦耳 (mJ) 为单位表示最终能量，并仅提供数值。",
            "solution": "该问题要求推导和计算一个开关周期内三电平逆变器飞跨电容中存储能量的峰峰值变化。\n\n首先，我们建立基本原理。电容值为 $C_{\\mathrm{f}}$、电压为 $V_{\\mathrm{c}}$ 的电容器中存储的能量 $E_{\\mathrm{c}}$ 由下式给出：\n$$E_{\\mathrm{c}}(t) = \\frac{1}{2} C_{\\mathrm{f}} V_{\\mathrm{c}}(t)^2$$\n能量的峰峰值变化 $\\Delta E_{\\mathrm{c,pp}}$ 是在一个开关周期 $T_{\\mathrm{s}}$ 内电容器中存储的最大能量与最小能量之差：\n$$\\Delta E_{\\mathrm{c,pp}} = E_{\\mathrm{c,max}} - E_{\\mathrm{c,min}}$$\n由于 $E_{\\mathrm{c}}$ 是 $|V_{\\mathrm{c}}|$ 的单调函数，并且电容电压保持为正，因此最大和最小能量值分别对应于最大和最小电压值 $V_{\\mathrm{c,max}}$ 和 $V_{\\mathrm{c,min}}$。\n$$E_{\\mathrm{c,max}} = \\frac{1}{2} C_{\\mathrm{f}} V_{\\mathrm{c,max}}^2$$\n$$E_{\\mathrm{c,min}} = \\frac{1}{2} C_{\\mathrm{f}} V_{\\mathrm{c,min}}^2$$\n因此，能量的峰峰值变化可表示为：\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} C_{\\mathrm{f}} (V_{\\mathrm{c,max}}^2 - V_{\\mathrm{c,min}}^2) = \\frac{1}{2} C_{\\mathrm{f}} (V_{\\mathrm{c,max}} - V_{\\mathrm{c,min}})(V_{\\mathrm{c,max}} + V_{\\mathrm{c,min}})$$\n\n为了求得 $V_{\\mathrm{c,max}}$ 和 $V_{\\mathrm{c,min}}$，我们必须分析在一个开关周期 $T_{\\mathrm{s}}$ 内电容电压 $V_{\\mathrm{c}}(t)$ 的演变。电容器两端的电压变化是通过对其本构关系中电容电流 $i_{\\mathrm{c}}(t)$ 随时间积分来确定的：\n$$V_{\\mathrm{c}}(t) = V_{\\mathrm{c}}(t_0) + \\frac{1}{C_{\\mathrm{f}}} \\int_{t_0}^{t} i_{\\mathrm{c}}(\\tau) d\\tau$$\n\n根据问题陈述，电容电流 $i_{\\mathrm{c}}(t)$ 在持续时间为 $\\tau_0 = \\gamma T_{\\mathrm{s}}$ 的零电平状态区间之外为零。让我们分析此区间内的电压演变。开关周期开始时的初始电容电压给出为 $V_{\\mathrm{c}}(0) = V_{\\mathrm{dc}}/2$。由于在零电平状态开始之前电容电流为零，因此该区间开始时的电压也为 $V_{\\mathrm{dc}}/2$。\n\n零电平区间 $\\tau_0$ 被分为两个子区间：\n1.  一个持续时间为 $D \\tau_0$ 的充电子区间，在此期间电容电流为 $i_{\\mathrm{c}}(t) = +I$。\n2.  一个持续时间为 $(1-D) \\tau_0$ 的放电子区间，在此期间电容电流为 $i_{\\mathrm{c}}(t) = -I$。\n\n由于恒定负载电流 $I$ 为正，电压首先线性增加，然后线性减小。在区间 $\\tau_0$ 内的电压轨迹如下：\n设零电平区间开始时的电压为 $V_{\\mathrm{c,start}} = V_{\\mathrm{dc}}/2$。\n在第一个子区间（持续时间 $D \\tau_0$）结束时，电压达到该周期的峰值：\n$$V_{\\mathrm{c,max}} = V_{\\mathrm{c,start}} + \\frac{1}{C_{\\mathrm{f}}} \\int_{0}^{D\\tau_0} I \\, dt = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\tau_0}{C_{\\mathrm{f}}}$$\n在第二个子区间（持续时间 $(1-D) \\tau_0$）结束时，电压达到其在有效区间的最终值：\n$$V_{\\mathrm{c,end}} = V_{\\mathrm{c,max}} + \\frac{1}{C_{\\mathrm{f}}} \\int_{D\\tau_0}^{\\tau_0} (-I) \\, dt = V_{\\mathrm{c,max}} - \\frac{I (1-D) \\tau_0}{C_{\\mathrm{f}}}$$\n代入 $V_{\\mathrm{c,max}}$ 的表达式：\n$$V_{\\mathrm{c,end}} = \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\tau_0}{C_{\\mathrm{f}}}\\right) - \\frac{I (1-D) \\tau_0}{C_{\\mathrm{f}}} = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\tau_0}{C_{\\mathrm{f}}} (D - (1-D)) = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\tau_0 (2D-1)}{C_{\\mathrm{f}}}$$\n在开关周期的剩余时间内，电压保持在 $V_{\\mathrm{c,end}}$ 不变。\n\n给定 $D=0.3$，我们有 $2D-1 = -0.4$，为负值。这意味着 $V_{\\mathrm{c,end}}  V_{\\mathrm{c,start}}$。该周期内的三个关键电压点是 $V_{\\mathrm{c,start}}$、$V_{\\mathrm{c,max}}$ 和 $V_{\\mathrm{c,end}}$。最大电压是 $V_{\\mathrm{c,max}}$，最小电压是 $V_{\\mathrm{c,min}} = V_{\\mathrm{c,end}}$。\n\n现在我们可以求出能量变化公式中的各项。代入 $\\tau_0 = \\gamma T_{\\mathrm{s}}$：\n$$V_{\\mathrm{c,max}} = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}}$$\n$$V_{\\mathrm{c,min}} = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\gamma T_{\\mathrm{s}} (2D-1)}{C_{\\mathrm{f}}}$$\n电压差为：\n$$V_{\\mathrm{c,max}} - V_{\\mathrm{c,min}} = \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}}\\right) - \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\gamma T_{\\mathrm{s}} (2D-1)}{C_{\\mathrm{f}}}\\right) = \\frac{I \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}} (D - (2D-1)) = \\frac{I \\gamma T_{\\mathrm{s}} (1-D)}{C_{\\mathrm{f}}}$$\n电压和为：\n$$V_{\\mathrm{c,max}} + V_{\\mathrm{c,min}} = \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}}\\right) + \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\gamma T_{\\mathrm{s}} (2D-1)}{C_{\\mathrm{f}}}\\right) = V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}} (D + 2D-1) = V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}}$$\n将这些代入 $\\Delta E_{\\mathrm{c,pp}}$ 的表达式中：\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} C_{\\mathrm{f}} \\left( \\frac{I \\gamma T_{\\mathrm{s}} (1-D)}{C_{\\mathrm{f}}} \\right) \\left( V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}} \\right)$$\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} I \\gamma T_{\\mathrm{s}} (1-D) \\left( V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}} \\right)$$\n这就是能量峰峰值变化的符号表达式。\n\n现在，我们代入给定的数值：\n$C_{\\mathrm{f}} = 100\\,\\mu\\mathrm{F} = 100 \\times 10^{-6}\\,\\mathrm{F}$\n$V_{\\mathrm{dc}} = 600\\,\\mathrm{V}$\n$T_{\\mathrm{s}} = 50\\,\\mu\\mathrm{s} = 50 \\times 10^{-6}\\,\\mathrm{s}$\n$\\gamma = 0.4$\n$I = 20\\,\\mathrm{A}$\n$D = 0.3$\n\n首先，计算中间项：\n$$I \\gamma T_{\\mathrm{s}} = (20\\,\\mathrm{A})(0.4)(50 \\times 10^{-6}\\,\\mathrm{s}) = 400 \\times 10^{-6}\\,\\mathrm{C} = 4 \\times 10^{-4}\\,\\mathrm{C}$$\n$$1-D = 1-0.3 = 0.7$$\n$$3D-1 = 3(0.3)-1 = 0.9-1 = -0.1$$\n现在，计算括号中的项：\n$$V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}} = 600\\,\\mathrm{V} + \\frac{(4 \\times 10^{-4}\\,\\mathrm{C})(-0.1)}{100 \\times 10^{-6}\\,\\mathrm{F}} = 600\\,\\mathrm{V} - \\frac{0.4 \\times 10^{-4}\\,\\mathrm{C}}{1 \\times 10^{-4}\\,\\mathrm{F}} = 600\\,\\mathrm{V} - 0.4\\,\\mathrm{V} = 599.6\\,\\mathrm{V}$$\n最后，计算 $\\Delta E_{\\mathrm{c,pp}}$：\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} (4 \\times 10^{-4}\\,\\mathrm{C}) (0.7) (599.6\\,\\mathrm{V})$$\n$$\\Delta E_{\\mathrm{c,pp}} = (2 \\times 10^{-4}\\,\\mathrm{C}) (0.7) (599.6\\,\\mathrm{V}) = (1.4 \\times 10^{-4}\\,\\mathrm{C}) (599.6\\,\\mathrm{V})$$\n$$\\Delta E_{\\mathrm{c,pp}} = 0.083944\\,\\mathrm{J}$$\n问题要求答案以毫焦耳 (mJ) 为单位：\n$$\\Delta E_{\\mathrm{c,pp}} = 0.083944\\,\\mathrm{J} \\times 1000\\,\\frac{\\mathrm{mJ}}{\\mathrm{J}} = 83.944\\,\\mathrm{mJ}$$\n四舍五入到四位有效数字，我们得到 $83.94\\,\\mathrm{mJ}$。",
            "answer": "$$\\boxed{83.94}$$"
        },
        {
            "introduction": "现实世界中的逆变器设计是一个涉及多目标权衡的复杂优化问题。这项计算实践模拟了一个真实的工程挑战：通过系统性地调整载波相移来主动抑制输出电压的低次谐波，同时满足单元间的电荷平衡约束。完成此任务将让您深入体验如何运用仿真和优化来达成一个高性能、高稳定性的多电平逆变器控制方案。",
            "id": "3859539",
            "problem": "考虑一个由 $N$ 个相同单元组成的级联H桥多电平逆变器，每个单元提供一个归一化的开关函数 $s_i(t) \\in \\{-1,+1\\}$，由基于载波的脉宽调制驱动。正弦参考信号为 $v_{\\mathrm{ref}}(t) = M \\sin(2\\pi f_1 t)$，每个单元 $i$ 使用频率为 $f_c$、相位偏移为 $\\phi_i$（以弧度为单位）的三角载波 $c_i(t)$。单元开关函数由比较器确定：$s_i(t) = \\mathrm{sgn}\\left(v_{\\mathrm{ref}}(t) - c_i(t)\\right)$。逆变器输出电压建模为 $v_{\\mathrm{out}}(t) = V_{\\mathrm{dc}} \\sum_{i=1}^{N} s_i(t)$，其中 $V_{\\mathrm{dc}}$ 是每个单元的直流源电压。\n\n逆变器连接到一个由 $R$（单位 $\\Omega$）和 $L$（单位 $\\mathrm{H}$）表征的阻感（RL）负载。负载电流 $i(t)$ 遵循一阶线性微分方程 $\\frac{di}{dt} = \\frac{v_{\\mathrm{out}}(t) - R i(t)}{L}$，初始条件为 $i(0) = 0$。每个单元在时间范围 $T$ 内的电容电荷平衡由 $Q_i(T) = \\int_{0}^{T} s_i(t) i(t)\\, dt$ 来量化。对于指定的容差 $\\varepsilon$（单位 $\\mathrm{C}$），如果净电荷误差满足 $\\left|Q_i(T)\\right| \\le \\varepsilon$，则认为该单元是平衡的。如果此条件对所有单元 $i \\in \\{1,\\dots,N\\}$ 都成立，则逆变器是平衡的。\n\n输出电压的总谐波失真（THD）定义为 $\\mathrm{THD} = \\frac{\\sqrt{\\sum_{n=2}^{\\infty} V_{n,\\mathrm{rms}}^2}}{V_{1,\\mathrm{rms}}}$，其中 $V_{n,\\mathrm{rms}}$ 是 $v_{\\mathrm{out}}(t)$ 的第 $n$ 次谐波分量的有效值大小，$V_{1,\\mathrm{rms}}$ 是频率为 $f_1$ 的基波分量。角度必须以弧度为单位，所有物理量必须用标准的国际单位制（SI单位）表示。\n\n您的任务是实现对载波相位偏移 $\\boldsymbol{\\phi} = [\\phi_1,\\dots,\\phi_N]$ 的数值优化，以最小化加权低阶谐波目标\n$$J(\\boldsymbol{\\phi}) = \\sum_{n \\in \\mathcal{N}} w_n V_{n,\\mathrm{rms}}^2,$$\n其中 $\\mathcal{N} = \\{3,5,7,9,11,13,15,17,19\\}$，权重为 $w_5 = w_7 = 2$，对于所有其他 $n \\in \\mathcal{N}$，$w_n = 1$。优化必须强制执行单元电荷平衡约束 $\\max_{i} |Q_i(T)| \\le \\varepsilon$。在获得优化的相位偏移 $\\boldsymbol{\\phi}^{\\star}$ 并计算相应的全局输出电压THD（包括基波以上的所有谐波）后，通过差值量化THD相对于同相载波基准情况（即 $\\boldsymbol{\\phi}^{0} = [0,0,\\dots,0]$）的改善程度\n$$\\Delta \\mathrm{THD} = \\mathrm{THD}(\\boldsymbol{\\phi}^{0}) - \\mathrm{THD}(\\boldsymbol{\\phi}^{\\star}).$$\n\n使用固定时间步长 $\\Delta t$ 的时间离散化来仿真 $v_{\\mathrm{out}}(t)$ 和 $i(t)$，仿真时长为整数个基波周期，以便进行精确的离散傅里叶变换分析。确保采样频率 $f_s = \\frac{1}{\\Delta t}$ 和总仿真时间 $T$ 的选择使得基波频率正好落在离散傅里叶变换的一个频点上。计算THD时排除直流分量。对于载波模型，使用在 $[-1, +1]$ 上定义的幅度为 $1$ 的三角波，并且比较器必须如上定义产生 $s_i(t)$。所有角度均以弧度表示。\n\n设计您的程序，在每个单元的离散相位偏移网格 $\\phi_i \\in \\{0, \\frac{\\pi}{3}, \\frac{2\\pi}{3}, \\pi, \\frac{4\\pi}{3}, \\frac{5\\pi}{3}\\}$ 中进行搜索，并选择在满足平衡约束的条件下最小化 $J(\\boldsymbol{\\phi})$ 的组合。对于每个参数集，报告：\n- THD改善量 $\\Delta \\mathrm{THD}$（小数），\n- 基准THD（小数），\n- 优化后的THD（小数），\n- 基准情况是否满足平衡约束（布尔值），\n- 优化解是否满足平衡约束（布尔值）。\n\n测试套件：\n使用以下参数集，所有情况均包含 $N = 3$ 个单元，并仿真 $T = 2$ 个基波周期：\n1. 情况A（理想情况）：$f_1 = 50\\ \\mathrm{Hz}$，$f_c = 1050\\ \\mathrm{Hz}$，$M = 0.9$（无单位），$R = 10\\ \\Omega$，$L = 0.02\\ \\mathrm{H}$，$V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$，$\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$，$\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$。\n2. 情况B（电阻主导）：$f_1 = 50\\ \\mathrm{Hz}$，$f_c = 950\\ \\mathrm{Hz}$，$M = 0.8$，$R = 50\\ \\Omega$，$L = 0.005\\ \\mathrm{H}$，$V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$，$\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$，$\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$。\n3. 情况C（电感主导）：$f_1 = 50\\ \\mathrm{Hz}$，$f_c = 850\\ \\mathrm{Hz}$，$M = 0.95$，$R = 5\\ \\Omega$，$L = 0.1\\ \\mathrm{H}$，$V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$，$\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$，$\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$。\n4. 情况D（低调制比边缘情况）：$f_1 = 50\\ \\mathrm{Hz}$，$f_c = 450\\ \\mathrm{Hz}$，$M = 0.2$，$R = 20\\ \\Omega$，$L = 0.03\\ \\mathrm{H}$，$V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$，$\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$，$\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含四个测试用例的结果，形式为一个逗号分隔的列表，并用方括号括起来。每个用例本身也是一个列表，顺序为 $[\\Delta \\mathrm{THD}, \\mathrm{THD}_{\\mathrm{baseline}}, \\mathrm{THD}_{\\mathrm{opt}}, \\mathrm{balanced}_{\\mathrm{baseline}}, \\mathrm{balanced}_{\\mathrm{opt}}]$。例如，输出应类似于 $[[x_1,y_1,z_1,b_1,o_1],[x_2,y_2,z_2,b_2,o_2],[x_3,y_3,z_3,b_3,o_3],[x_4,y_4,z_4,b_4,o_4]]$，其中所有的 $x_k,y_k,z_k$ 均为小数，而 $b_k,o_k$ 均为布尔值。",
            "solution": "该问题要求对三相级联H桥（CHB）多电平逆变器的载波相移进行优化，以最小化特定低阶电压谐波的加权和，同时满足电容电荷平衡约束。解决方案涉及了时域仿真、傅里叶分析和约束优化搜索。\n\n### 1. 系统建模与仿真\n\n该系统由一个 $N$ 单元CHB逆变器连接到一个串联RL负载组成。系统的状态由负载电流 $i(t)$ 和每个单元直流环节电容器中累积的电荷来描述。\n\n**1.1. 信号生成**\n调制方案为基于载波的脉冲宽度调制（PWM）。一个正弦参考电压 $v_{\\mathrm{ref}}(t) = M \\sin(2\\pi f_1 t)$（其中 $M$ 为调制比，$f_1$ 为基波频率）与 $N$ 个三角载波信号 $c_i(t)$ 进行比较。每个载波的频率为 $f_c$，幅度为 $1$，并具有相位偏移 $\\phi_i$。对于步长为 $\\Delta t$ 的时域仿真，时间向量为 $t_k = k \\Delta t$，其中 $k \\in \\{0, 1, \\dots, N_{\\mathrm{pts}}-1\\}$。总点数 $N_{\\mathrm{pts}}$ 的选择应确保仿真覆盖整数个基波周期 $T = P/f_1$（此处 $P=2$），并且基波频率落在DFT的一个频点上。\n\n离散时间点上的参考信号为：\n$$v_{\\mathrm{ref}}(t_k) = M \\sin(2\\pi f_1 t_k)$$\n\n具有相位偏移 $\\phi_i$ 的第 $i$ 个三角载波信号通过以下公式生成：\n$$c_i(t_k) = 1 - 4 \\left| \\left(f_c t_k + \\frac{\\phi_i}{2\\pi}\\right) \\pmod{1} - \\frac{1}{2} \\right|$$\n其中 `pmod 1` 是参数的小数部分。这将生成一个在 $-1$ 和 $+1$ 之间振荡的三角波形。\n\n**1.2. 开关函数和输出电压**\n单元 $i$ 的开关函数 $s_i(t)$ 决定其输出电压的极性。它由一个比较器生成：\n$$s_i(t_k) = \\mathrm{sgn}\\left(v_{\\mathrm{ref}}(t_k) - c_i(t_k)\\right)$$\n为确保输出严格属于 $\\{-1, +1\\}$，我们定义 $\\mathrm{sgn}(x) = 1$（当 $x \\ge 0$ 时）和 $\\mathrm{sgn}(x) = -1$（当 $x  0$ 时）。\n\n逆变器总输出电压是各个单元输出之和，并按每个单元的直流电压 $V_{\\mathrm{dc}}$ 进行缩放：\n$$v_{\\mathrm{out}}(t_k) = V_{\\mathrm{dc}} \\sum_{i=1}^{N} s_i(t_k)$$\n\n**1.3. 负载电流仿真**\n负载电流 $i(t)$ 由以下一阶常微分方程决定：\n$$\\frac{di}{dt} = \\frac{v_{\\mathrm{out}}(t) - R i(t)}{L}$$\n初始条件为 $i(0) = 0$。该方程使用时间步长为 $\\Delta t$ 的前向欧拉法进行数值求解：\n$$i(t_{k+1}) = i(t_k) + \\frac{\\Delta t}{L} \\left( v_{\\mathrm{out}}(t_k) - R i(t_k) \\right)$$\n\n### 2. 性能指标与约束\n\n**2.1. 谐波分析**\n输出电压波形的质量通过其谐波含量来评估。对仿真的电压波形 $v_{\\mathrm{out}}(t_k)$ 应用离散傅里叶变换（DFT）以获得其频谱。设 $V_{\\mathrm{fft}}$ 是 $v_{\\mathrm{out}}$ 的DFT结果。第 $n$ 次谐波（频率为 $n f_1$）的均方根（RMS）值由相应的DFT系数计算得出。基波频率 $f_1$ 对应于DFT的频点索引 $k_1 = f_1 T$。对于本问题，$T=2/f_1$，所以 $k_1=2$。第 $n$ 次谐波对应于频点 $k_n = n k_1 = 2n$。RMS值为：\n$$V_{n,\\mathrm{rms}} = \\frac{\\sqrt{2} |V_{\\mathrm{fft}}[k_n]|}{N_{\\mathrm{pts}}}$$\n总谐波失真（THD）是所有高次谐波的RMS和与基波分量RMS值的比率。它可以通过信号的方差高效计算：\n$$\\mathrm{THD} = \\frac{\\sqrt{ \\sum_{n=2}^{\\infty} V_{n,\\mathrm{rms}}^2 }}{V_{1,\\mathrm{rms}}} = \\sqrt{\\frac{\\mathrm{var}(v_{\\mathrm{out}})}{V_{1,\\mathrm{rms}}^2} - 1}$$\n其中 $\\mathrm{var}(v_{\\mathrm{out}})$ 是去除直流分量后信号的方差，$V_{1,\\mathrm{rms}}^2 = 2 (|V_{\\mathrm{fft}}[k_1]|/N_{\\mathrm{pts}})^2$。\n\n**2.2. 电容电荷平衡**\n每个单元的电荷平衡对于逆变器的稳定运行至关重要。它通过在仿真周期 $T$ 内通过单元传递的净电荷来量化：\n$$Q_i(T) = \\int_{0}^{T} s_i(t) i(t) \\, dt$$\n在离散时间仿真中，此积分通过求和来近似：\n$$Q_i = \\Delta t \\sum_{k=0}^{N_{\\mathrm{pts}}-1} s_i(t_k) i(t_k)$$\n平衡约束要求每个单元的电荷误差绝对值都低于给定的容差 $\\varepsilon$：\n$$\\max_{i=1,\\dots,N} |Q_i| \\le \\varepsilon$$\n\n### 3. 约束优化\n\n目标是最小化特定低阶谐波的RMS值平方的加权和：\n$$J(\\boldsymbol{\\phi}) = \\sum_{n \\in \\mathcal{N}} w_n V_{n,\\mathrm{rms}}^2$$\n其中 $\\boldsymbol{\\phi} = [\\phi_1, \\dots, \\phi_N]$ 是载波相移向量，$\\mathcal{N} = \\{3,5,7,9,11,13,15,17,19\\}$，权重为 $w_5=w_7=2$，其余为 $w_n=1$。\n\n优化是在一个离散的相角网格上进行的，$\\phi_i \\in \\{0, \\frac{\\pi}{3}, \\frac{2\\pi}{3}, \\pi, \\frac{4\\pi}{3}, \\frac{5\\pi}{3}\\}$。对所有 $6^N$ 种可能的相移组合进行穷举搜索。对于每种组合 $\\boldsymbol{\\phi}$：\n1.  仿真系统以获得 $v_{\\mathrm{out}}(t)$ 和 $i(t)$。\n2.  计算电荷误差 $Q_i$ 并检查是否满足平衡约束 $\\max_i |Q_i| \\le \\varepsilon$。\n3.  如果满足约束，则计算目标函数 $J(\\boldsymbol{\\phi})$。\n\n最优相移向量 $\\boldsymbol{\\phi}^{\\star}$ 是指满足平衡约束且使 $J(\\boldsymbol{\\phi})$ 值最小的那个。\n\n最后，通过比较优化情况下的THD，即 $\\mathrm{THD}(\\boldsymbol{\\phi}^{\\star})$，与所有相位均为零的基准情况下的THD，即 $\\mathrm{THD}(\\boldsymbol{\\phi}^{0})$，来评估性能。改善量报告为 $\\Delta \\mathrm{THD} = \\mathrm{THD}(\\boldsymbol{\\phi}^{0}) - \\mathrm{THD}(\\boldsymbol{\\phi}^{\\star})$。同时确定基准解和优化解的平衡状态。",
            "answer": "[[0.052684, 0.165780, 0.113096, true, true],[0.032221, 0.244246, 0.212024, true, true],[-0.015024, 0.208169, 0.223193, true, true],[0.043867, 1.401149, 1.357282, true, true]]"
        }
    ]
}