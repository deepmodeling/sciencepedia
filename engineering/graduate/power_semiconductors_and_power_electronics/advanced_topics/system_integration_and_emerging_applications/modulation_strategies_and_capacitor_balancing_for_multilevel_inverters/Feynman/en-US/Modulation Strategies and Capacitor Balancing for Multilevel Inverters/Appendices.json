{
    "hands_on_practices": [
        {
            "introduction": "A key figure of merit for any inverter modulation strategy is its utilization of the available DC bus voltage. Maximizing the fundamental output voltage for a given DC link reduces current for the same power transfer, improving efficiency. This exercise challenges you to derive and compare the maximum achievable modulation index for two cornerstone strategies: Space Vector Modulation (SVM) and conventional Sinusoidal PWM (SPWM). By working from first principles, you will uncover precisely how SVM's use of an optimal zero-sequence injection expands the linear operating range beyond that of SPWM, a fundamental concept in advanced inverter control. ",
            "id": "3859557",
            "problem": "A three-phase, three-level Neutral-Point-Clamped (NPC) inverter with a split direct-current bus voltage $V_{\\mathrm{dc}}$ is modulated to produce balanced sinusoidal phase voltages using Space Vector Modulation (SVM). The inverter implements capacitor (neutral-point) balancing by appropriately distributing dwell times among medium vectors, but does not permit excursions of any leg output beyond $\\pm V_{\\mathrm{dc}}/2$. Define the amplitude modulation index $m_a$ as $m_a = V_m/(V_{\\mathrm{dc}}/2)$, where $V_m$ is the peak amplitude of the commanded fundamental phase voltage reference. Assume ideal devices, negligible dead time, and that the neutral-point potential remains centered on average due to the modulation strategy.\n\nStarting from the definitions of three-phase sinusoidal references, the constraint that the reference space vector must lie within the convex hull of available switching vectors, and the fact that in optimal SVM a zero-sequence voltage can be injected to maximize the linear range, derive the maximum value of $m_a$ before overmodulation for three-level SVM. Then, derive the corresponding linear-limit value of $m_a$ for carrier-based Sinusoidal Pulse Width Modulation (SPWM) without zero-sequence injection. Carefully justify the bounds using first principles for the extrema of the three sinusoidal phase references and the effect of zero-sequence injection on the instantaneous maximum and minimum of the modulating signals. Express your final answers as exact symbolic expressions without rounding and without units. Provide the final answer as a row matrix containing the two values in the order: three-level SVM maximum $m_a$ before overmodulation, SPWM linear-limit $m_a$.",
            "solution": "We begin by defining the three balanced sinusoidal phase references for a three-phase system as\n$$\nv_a^{*}(t) = V_m \\sin(\\omega t), \\quad v_b^{*}(t) = V_m \\sin\\left(\\omega t - \\frac{2\\pi}{3}\\right), \\quad v_c^{*}(t) = V_m \\sin\\left(\\omega t + \\frac{2\\pi}{3}\\right),\n$$\nwhere $V_m$ is the peak of the desired fundamental phase voltage and $\\omega$ is the angular frequency. The amplitude modulation index is defined as\n$$\nm_a = \\frac{V_m}{V_{\\mathrm{dc}}/2}.\n$$\nIn all cases, the instantaneous commanded leg voltage must satisfy the available discrete leg states, which are bounded by $\\pm V_{\\mathrm{dc}}/2$ for a three-level Neutral-Point-Clamped (NPC) inverter.\n\nWe analyze the extrema structure of the three references. For any fixed time $t$, define\n$$\nv_{\\max}(t) = \\max\\{v_a^{*}(t), v_b^{*}(t), v_c^{*}(t)\\}, \\quad v_{\\min}(t) = \\min\\{v_a^{*}(t), v_b^{*}(t), v_c^{*}(t)\\}.\n$$\nA fundamental observation for balanced sinusoidal phase references is the maximum instantaneous spread\n$$\n\\Delta(t) := v_{\\max}(t) - v_{\\min}(t).\n$$\nWe claim that the maximum of $\\Delta(t)$ over time is\n$$\n\\max_{t} \\Delta(t) = \\sqrt{3}\\, V_m.\n$$\nTo show this, consider the pair of phases separated by $120^{\\circ}$ that realize the maximum minus minimum at the instant of greatest spread. Without loss of generality, evaluate\n$$\n\\sin\\left(\\theta + \\frac{2\\pi}{3}\\right) - \\sin\\left(\\theta - \\frac{2\\pi}{3}\\right) = 2 \\cos(\\theta) \\sin\\left(\\frac{2\\pi}{3}\\right) = 2 \\cos(\\theta) \\cdot \\frac{\\sqrt{3}}{2} = \\sqrt{3} \\cos(\\theta),\n$$\nwhich attains its maximum magnitude of $\\sqrt{3}$ when $\\cos(\\theta) = 1$. Multiplying by $V_m$ yields $\\max_{t} \\Delta(t) = \\sqrt{3}\\, V_m$. Explicitly, at $\\theta = 0$, the three phase values are $0$, $+\\frac{\\sqrt{3}}{2} V_m$, and $-\\frac{\\sqrt{3}}{2} V_m$, giving a spread $\\Delta = \\sqrt{3}\\, V_m$.\n\nWe now compute the linear limits for two modulation strategies.\n\n1. Space Vector Modulation (SVM) for a three-level NPC inverter with optimal zero-sequence injection. Space Vector Modulation chooses a common-mode (zero-sequence) injection $v_0(t)$ to keep the reference space vector within the convex hull of the accessible switching vectors. An optimal choice that maximizes the linear range and equalizes the margins to the leg bounds is\n$$\nv_0(t) = -\\frac{v_{\\max}(t) + v_{\\min}(t)}{2}.\n$$\nDefine the modified phase commands $v_i'(t) = v_i^{*}(t) + v_0(t)$ for $i \\in \\{a,b,c\\}$. The modified maximum and minimum become\n$$\nv_{\\max}'(t) = v_{\\max}(t) - \\frac{v_{\\max}(t) + v_{\\min}(t)}{2} = \\frac{v_{\\max}(t) - v_{\\min}(t)}{2} = \\frac{\\Delta(t)}{2},\n$$\n$$\nv_{\\min}'(t) = v_{\\min}(t) - \\frac{v_{\\max}(t) + v_{\\min}(t)}{2} = -\\frac{v_{\\max}(t) - v_{\\min}(t)}{2} = -\\frac{\\Delta(t)}{2}.\n$$\nThus, at any time, all three modified commands lie within the interval $\\left[-\\frac{\\Delta(t)}{2}, \\frac{\\Delta(t)}{2}\\right]$. The linear region constraint is that no leg command exceeds the available bounds $\\pm V_{\\mathrm{dc}}/2$, which requires\n$$\n\\frac{\\Delta(t)}{2} \\leq \\frac{V_{\\mathrm{dc}}}{2} \\quad \\text{for all } t \\quad \\Longrightarrow \\quad \\Delta(t) \\leq V_{\\mathrm{dc}} \\quad \\text{for all } t.\n$$\nUsing the maximum spread $\\max_{t} \\Delta(t) = \\sqrt{3}\\, V_m$, the worst-case constraint yields\n$$\n\\sqrt{3}\\, V_m \\leq V_{\\mathrm{dc}} \\quad \\Longrightarrow \\quad V_m \\leq \\frac{V_{\\mathrm{dc}}}{\\sqrt{3}}.\n$$\nTherefore, the maximum modulation index before overmodulation under three-level SVM is\n$$\nm_{a,\\max}^{\\mathrm{SVM}} = \\frac{V_m}{V_{\\mathrm{dc}}/2} \\bigg|_{\\max} = \\frac{V_{\\mathrm{dc}/\\sqrt{3}}}{V_{\\mathrm{dc}}/2} = \\frac{2}{\\sqrt{3}}.\n$$\nNote that the presence of the intermediate $0$ level in the three-level leg allows neutral-point (capacitor) balancing via appropriate dwell distribution among medium vectors, but it does not increase the allowable extremal leg voltage beyond $\\pm V_{\\mathrm{dc}}/2$, hence the amplitude limit derived above is unchanged by the number of levels for the linear range boundary.\n\n2. Sinusoidal Pulse Width Modulation (SPWM) without zero-sequence injection. In carrier-based SPWM without any common-mode injection, the phase command is the sinusoid itself, so the extremal leg command magnitude is simply $|v_i^{*}(t)| \\leq V_m$. The linearity constraint requires\n$$\nV_m \\leq \\frac{V_{\\mathrm{dc}}}{2}.\n$$\nConsequently, the linear-limit modulation index is\n$$\nm_{a,\\max}^{\\mathrm{SPWM}} = \\frac{V_m}{V_{\\mathrm{dc}}/2} \\bigg|_{\\max} = 1.\n$$\n\nCollecting the results, the maximum modulation index before overmodulation for three-level Space Vector Modulation is $\\frac{2}{\\sqrt{3}}$, and the Sinusoidal Pulse Width Modulation linear limit is $1$. These are exact symbolic values.",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{2}{\\sqrt{3}} & 1\\end{pmatrix}}$$"
        },
        {
            "introduction": "Beyond generating the correct average voltage, a modulation strategy has direct physical consequences on the inverter's components. In topologies like the flying-capacitor inverter, the switching sequence dictated by the modulator determines the charging and discharging currents of the floating capacitors. This hands-on problem asks you to calculate the peak-to-peak energy fluctuation in a flying capacitor over a single switching period, linking high-level control parameters like duty cycles to the low-level energy storage requirements. This analysis is fundamental for sizing capacitors to maintain voltage balance and limit ripple, a critical aspect of reliable hardware design. ",
            "id": "3859566",
            "problem": "A single-leg three-level flying-capacitor inverter synthesizes three output voltage levels across the phase: $-V_{\\mathrm{dc}}/2$, $0$, and $+V_{\\mathrm{dc}}/2$, where $V_{\\mathrm{dc}}$ is the direct-current (DC) link voltage. The leg employs a flying capacitor with capacitance $C_{\\mathrm{f}}$ whose nominal voltage is $V_{\\mathrm{dc}}/2$. Over one switching period $T_{\\mathrm{s}}$ of pulse width modulation (PWM), assume the phase load current is approximately constant and equal to $I>0$ (positive current flows from the inverter to the load). The modulation strategy allocates a fraction $\\gamma$ of the period to the zero-level state. Within this zero-level occupancy of duration $\\tau_{0}=\\gamma T_{\\mathrm{s}}$, a capacitor-balancing control splits the zero-level into two subintervals: during the first subinterval of duration $D\\,\\tau_{0}$ the switching configuration yields a capacitor current $+I$ (charging), and during the second subinterval of duration $(1-D)\\,\\tau_{0}$ it yields a capacitor current $-I$ (discharging). Outside the zero-level intervals, the capacitor is bypassed and its current is zero. Assume ideal switches, negligible parasitics, and that the flying capacitor voltage at the beginning of the period is $V_{\\mathrm{c}}(0)=V_{\\mathrm{dc}}/2$.\n\nStarting from the constitutive relation of a capacitor and standard energy definitions, derive the peak-to-peak variation of energy stored in the flying capacitor over the switching period, and then compute its numerical value for the following parameters:\n- $C_{\\mathrm{f}}=100\\,\\mu\\mathrm{F}$,\n- $V_{\\mathrm{dc}}=600\\,\\mathrm{V}$,\n- $T_{\\mathrm{s}}=50\\,\\mu\\mathrm{s}$,\n- $\\gamma=0.4$,\n- $I=20\\,\\mathrm{A}$,\n- $D=0.3$.\n\nRound your final numerical result to four significant figures. Express the final energy in millijoules (mJ), and provide only the numerical value.",
            "solution": "The problem requires the derivation and calculation of the peak-to-peak variation of energy stored in the flying capacitor of a three-level inverter over one switching period.\n\nFirst, we establish the fundamental principles. The energy $E_{\\mathrm{c}}$ stored in a capacitor with capacitance $C_{\\mathrm{f}}$ and voltage $V_{\\mathrm{c}}$ is given by:\n$$E_{\\mathrm{c}}(t) = \\frac{1}{2} C_{\\mathrm{f}} V_{\\mathrm{c}}(t)^2$$\nThe peak-to-peak variation of energy, $\\Delta E_{\\mathrm{c,pp}}$, is the difference between the maximum and minimum energy stored in the capacitor over one switching period $T_{\\mathrm{s}}$:\n$$\\Delta E_{\\mathrm{c,pp}} = E_{\\mathrm{c,max}} - E_{\\mathrm{c,min}}$$\nSince $E_{\\mathrm{c}}$ is a monotonic function of $|V_{\\mathrm{c}}|$ and the capacitor voltage remains positive, the maximum and minimum energy values correspond to the maximum and minimum voltage values, $V_{\\mathrm{c,max}}$ and $V_{\\mathrm{c,min}}$, respectively.\n$$E_{\\mathrm{c,max}} = \\frac{1}{2} C_{\\mathrm{f}} V_{\\mathrm{c,max}}^2$$\n$$E_{\\mathrm{c,min}} = \\frac{1}{2} C_{\\mathrm{f}} V_{\\mathrm{c,min}}^2$$\nTherefore, the peak-to-peak energy variation can be expressed as:\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} C_{\\mathrm{f}} (V_{\\mathrm{c,max}}^2 - V_{\\mathrm{c,min}}^2) = \\frac{1}{2} C_{\\mathrm{f}} (V_{\\mathrm{c,max}} - V_{\\mathrm{c,min}})(V_{\\mathrm{c,max}} + V_{\\mathrm{c,min}})$$\n\nTo find $V_{\\mathrm{c,max}}$ and $V_{\\mathrm{c,min}}$, we must analyze the capacitor voltage evolution $V_{\\mathrm{c}}(t)$ over one switching period $T_{\\mathrm{s}}$. The voltage change across a capacitor is determined by integrating the capacitor current $i_{\\mathrm{c}}(t)$ over time, based on its constitutive relation:\n$$V_{\\mathrm{c}}(t) = V_{\\mathrm{c}}(t_0) + \\frac{1}{C_{\\mathrm{f}}} \\int_{t_0}^{t} i_{\\mathrm{c}}(\\tau) d\\tau$$\n\nAccording to the problem statement, the capacitor current $i_{\\mathrm{c}}(t)$ is zero outside the zero-level state interval, which has a duration of $\\tau_0 = \\gamma T_{\\mathrm{s}}$. Let us analyze the voltage evolution during this interval. The initial capacitor voltage at the start of the switching period is given as $V_{\\mathrm{c}}(0) = V_{\\mathrm{dc}}/2$. Since the capacitor current is zero until the zero-level state begins, the voltage at the start of this interval is also $V_{\\mathrm{dc}}/2$.\n\nThe zero-level interval $\\tau_0$ is divided into two subintervals:\n1.  A charging subinterval of duration $D \\tau_0$, during which the capacitor current is $i_{\\mathrm{c}}(t) = +I$.\n2.  A discharging subinterval of duration $(1-D) \\tau_0$, during which the capacitor current is $i_{\\mathrm{c}}(t) = -I$.\n\nSince the constant load current $I$ is positive, the voltage first increases linearly and then decreases linearly. The voltage trajectory during the interval $\\tau_0$ is as follows:\nLet the voltage at the start of the zero-level interval be $V_{\\mathrm{c,start}} = V_{\\mathrm{dc}}/2$.\nAt the end of the first subinterval (duration $D \\tau_0$), the voltage reaches its peak value for the period:\n$$V_{\\mathrm{c,max}} = V_{\\mathrm{c,start}} + \\frac{1}{C_{\\mathrm{f}}} \\int_{0}^{D\\tau_0} I \\, dt = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\tau_0}{C_{\\mathrm{f}}}$$\nAt the end of the second subinterval (duration $(1-D) \\tau_0$), the voltage reaches its final value for the active interval:\n$$V_{\\mathrm{c,end}} = V_{\\mathrm{c,max}} + \\frac{1}{C_{\\mathrm{f}}} \\int_{D\\tau_0}^{\\tau_0} (-I) \\, dt = V_{\\mathrm{c,max}} - \\frac{I (1-D) \\tau_0}{C_{\\mathrm{f}}}$$\nSubstituting the expression for $V_{\\mathrm{c,max}}$:\n$$V_{\\mathrm{c,end}} = \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\tau_0}{C_{\\mathrm{f}}}\\right) - \\frac{I (1-D) \\tau_0}{C_{\\mathrm{f}}} = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\tau_0}{C_{\\mathrm{f}}} (D - (1-D)) = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\tau_0 (2D-1)}{C_{\\mathrm{f}}}$$\nThe voltage remains constant at $V_{\\mathrm{c,end}}$ for the rest of the switching period.\n\nGiven $D=0.3$, we have $2D-1 = -0.4$, which is negative. This implies that $V_{\\mathrm{c,end}} < V_{\\mathrm{c,start}}$. The three key voltage points during the period are $V_{\\mathrm{c,start}}$, $V_{\\mathrm{c,max}}$, and $V_{\\mathrm{c,end}}$. The maximum voltage is $V_{\\mathrm{c,max}}$ and the minimum voltage is $V_{\\mathrm{c,min}} = V_{\\mathrm{c,end}}$.\n\nWe can now find the terms for the energy variation formula. Substituting $\\tau_0 = \\gamma T_{\\mathrm{s}}$:\n$$V_{\\mathrm{c,max}} = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}}$$\n$$V_{\\mathrm{c,min}} = \\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\gamma T_{\\mathrm{s}} (2D-1)}{C_{\\mathrm{f}}}$$\nThe voltage difference is:\n$$V_{\\mathrm{c,max}} - V_{\\mathrm{c,min}} = \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}}\\right) - \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\gamma T_{\\mathrm{s}} (2D-1)}{C_{\\mathrm{f}}}\\right) = \\frac{I \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}} (D - (2D-1)) = \\frac{I \\gamma T_{\\mathrm{s}} (1-D)}{C_{\\mathrm{f}}}$$\nThe voltage sum is:\n$$V_{\\mathrm{c,max}} + V_{\\mathrm{c,min}} = \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I D \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}}\\right) + \\left(\\frac{V_{\\mathrm{dc}}}{2} + \\frac{I \\gamma T_{\\mathrm{s}} (2D-1)}{C_{\\mathrm{f}}}\\right) = V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}}}{C_{\\mathrm{f}}} (D + 2D-1) = V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}}$$\nSubstituting these into the expression for $\\Delta E_{\\mathrm{c,pp}}$:\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} C_{\\mathrm{f}} \\left( \\frac{I \\gamma T_{\\mathrm{s}} (1-D)}{C_{\\mathrm{f}}} \\right) \\left( V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}} \\right)$$\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} I \\gamma T_{\\mathrm{s}} (1-D) \\left( V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}} \\right)$$\nThis is the symbolic expression for the peak-to-peak energy variation.\n\nNow, we substitute the given numerical values:\n$C_{\\mathrm{f}} = 100\\,\\mu\\mathrm{F} = 100 \\times 10^{-6}\\,\\mathrm{F}$\n$V_{\\mathrm{dc}} = 600\\,\\mathrm{V}$\n$T_{\\mathrm{s}} = 50\\,\\mu\\mathrm{s} = 50 \\times 10^{-6}\\,\\mathrm{s}$\n$\\gamma = 0.4$\n$I = 20\\,\\mathrm{A}$\n$D = 0.3$\n\nFirst, calculate the intermediate terms:\n$$I \\gamma T_{\\mathrm{s}} = (20\\,\\mathrm{A})(0.4)(50 \\times 10^{-6}\\,\\mathrm{s}) = 400 \\times 10^{-6}\\,\\mathrm{C} = 4 \\times 10^{-4}\\,\\mathrm{C}$$\n$$1-D = 1-0.3 = 0.7$$\n$$3D-1 = 3(0.3)-1 = 0.9-1 = -0.1$$\nNow, calculate the term in the parenthesis:\n$$V_{\\mathrm{dc}} + \\frac{I \\gamma T_{\\mathrm{s}} (3D-1)}{C_{\\mathrm{f}}} = 600\\,\\mathrm{V} + \\frac{(4 \\times 10^{-4}\\,\\mathrm{C})(-0.1)}{100 \\times 10^{-6}\\,\\mathrm{F}} = 600\\,\\mathrm{V} - \\frac{0.4 \\times 10^{-4}\\,\\mathrm{C}}{1 \\times 10^{-4}\\,\\mathrm{F}} = 600\\,\\mathrm{V} - 0.4\\,\\mathrm{V} = 599.6\\,\\mathrm{V}$$\nFinally, calculate $\\Delta E_{\\mathrm{c,pp}}$:\n$$\\Delta E_{\\mathrm{c,pp}} = \\frac{1}{2} (4 \\times 10^{-4}\\,\\mathrm{C}) (0.7) (599.6\\,\\mathrm{V})$$\n$$\\Delta E_{\\mathrm{c,pp}} = (2 \\times 10^{-4}\\,\\mathrm{C}) (0.7) (599.6\\,\\mathrm{V}) = (1.4 \\times 10^{-4}\\,\\mathrm{C}) (599.6\\,\\mathrm{V})$$\n$$\\Delta E_{\\mathrm{c,pp}} = 0.083944\\,\\mathrm{J}$$\nThe problem requires the answer in millijoules (mJ):\n$$\\Delta E_{\\mathrm{c,pp}} = 0.083944\\,\\mathrm{J} \\times 1000\\,\\frac{\\mathrm{mJ}}{\\mathrm{J}} = 83.944\\,\\mathrm{mJ}$$\nRounding to four significant figures, we get $83.94\\,\\mathrm{mJ}$.",
            "answer": "$$\\boxed{83.94}$$"
        },
        {
            "introduction": "Modern multilevel inverters, particularly modular topologies like the Cascaded H-Bridge (CHB), offer additional degrees of freedom that can be exploited for performance optimization. By carefully controlling the relative timing of the switching events in each cell, it is possible to actively shape the harmonic spectrum of the output voltage while simultaneously managing cell capacitor balance. This practice guides you through a numerical optimization task that mirrors contemporary design challenges: finding the optimal set of carrier phase offsets to minimize low-order harmonics under a strict charge-balancing constraint. This exercise bridges the gap between analytical theory and the computational methods used in state-of-the-art inverter control design. ",
            "id": "3859539",
            "problem": "Consider a cascaded H-bridge multilevel inverter composed of $N$ identical cells, each contributing a normalized switching function $s_i(t) \\in \\{-1,+1\\}$, driven by carrier-based pulse width modulation. The sinusoidal reference is $v_{\\mathrm{ref}}(t) = M \\sin(2\\pi f_1 t)$, and each cell $i$ uses a triangular carrier $c_i(t)$ of frequency $f_c$ with a phase offset $\\phi_i$ (in radians). The cell switching function is determined by a comparator $s_i(t) = \\mathrm{sgn}\\left(v_{\\mathrm{ref}}(t) - c_i(t)\\right)$. The inverter output voltage is modeled as $v_{\\mathrm{out}}(t) = V_{\\mathrm{dc}} \\sum_{i=1}^{N} s_i(t)$, where $V_{\\mathrm{dc}}$ is the direct current source voltage per cell.\n\nThe inverter is connected to a resistive-inductive (RL) load characterized by $R$ (in $\\Omega$) and $L$ (in $\\mathrm{H}$). The load current $i(t)$ obeys the first-order linear differential equation $\\frac{di}{dt} = \\frac{v_{\\mathrm{out}}(t) - R i(t)}{L}$ with the initial condition $i(0) = 0$. The capacitor charge balance in each cell over a horizon of time $T$ is quantified by $Q_i(T) = \\int_{0}^{T} s_i(t) i(t)\\, dt$. A cell is deemed balanced if the net charge error satisfies $\\left|Q_i(T)\\right| \\le \\varepsilon$ for a specified tolerance $\\varepsilon$ (in $\\mathrm{C}$). The inverter is balanced if this condition holds for all cells $i \\in \\{1,\\dots,N\\}$.\n\nThe total harmonic distortion (THD) of the output voltage is defined as $\\mathrm{THD} = \\frac{\\sqrt{\\sum_{n=2}^{\\infty} V_{n,\\mathrm{rms}}^2}}{V_{1,\\mathrm{rms}}}$, where $V_{n,\\mathrm{rms}}$ is the root-mean-square magnitude of the $n$-th harmonic component of $v_{\\mathrm{out}}(t)$, and $V_{1,\\mathrm{rms}}$ is the fundamental component at frequency $f_1$. Angles must be in radians, and all physical quantities must be expressed in standard International System of Units (SI units).\n\nYour task is to implement a numerical optimization over the carrier phase offsets $\\boldsymbol{\\phi} = [\\phi_1,\\dots,\\phi_N]$ to minimize the weighted low-order harmonic objective\n$$J(\\boldsymbol{\\phi}) = \\sum_{n \\in \\mathcal{N}} w_n V_{n,\\mathrm{rms}}^2,$$\nwhere $\\mathcal{N} = \\{3,5,7,9,11,13,15,17,19\\}$ and the weights are $w_5 = w_7 = 2$ and $w_n = 1$ for all other $n \\in \\mathcal{N}$. The optimization must enforce the cell charge balance constraint $\\max_{i} |Q_i(T)| \\le \\varepsilon$. After obtaining the optimized phase offsets $\\boldsymbol{\\phi}^{\\star}$ and computing the corresponding global output voltage THD (including all harmonics above the fundamental), quantify the improvement in THD relative to a baseline with in-phase carriers, i.e., $\\boldsymbol{\\phi}^{0} = [0,0,\\dots,0]$, by the difference\n$$\\Delta \\mathrm{THD} = \\mathrm{THD}(\\boldsymbol{\\phi}^{0}) - \\mathrm{THD}(\\boldsymbol{\\phi}^{\\star}).$$\n\nUse time discretization with a fixed time step $\\Delta t$ to simulate $v_{\\mathrm{out}}(t)$ and $i(t)$ over an integer number of fundamental periods to enable accurate discrete Fourier transform analysis. Ensure that the sampling frequency $f_s = \\frac{1}{\\Delta t}$ and the total simulation time $T$ are chosen so that the fundamental lies exactly on a discrete Fourier transform bin. Exclude the direct current component when calculating THD. For the carrier model, use a triangular waveform of amplitude $1$ defined over $[-1, +1]$, and the comparator must produce $s_i(t)$ as defined above. Express all angles in radians.\n\nDesign your program to search a discrete grid of phase offsets for each cell, $\\phi_i \\in \\{0, \\frac{\\pi}{3}, \\frac{2\\pi}{3}, \\pi, \\frac{4\\pi}{3}, \\frac{5\\pi}{3}\\}$, and select the combination that minimizes $J(\\boldsymbol{\\phi})$ subject to the balance constraint. For each parameter set, report:\n- the THD improvement $\\Delta \\mathrm{THD}$ as a decimal,\n- the baseline THD as a decimal,\n- the optimized THD as a decimal,\n- whether the baseline satisfies the balance constraint as a boolean,\n- whether the optimized solution satisfies the balance constraint as a boolean.\n\nTest Suite:\nUse the following parameter sets, all with $N = 3$ cells and simulation of $T = 2$ fundamental periods:\n1. Case A (happy path): $f_1 = 50\\ \\mathrm{Hz}$, $f_c = 1050\\ \\mathrm{Hz}$, $M = 0.9$ (unitless), $R = 10\\ \\Omega$, $L = 0.02\\ \\mathrm{H}$, $V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$, $\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$, $\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$.\n2. Case B (resistive dominated): $f_1 = 50\\ \\mathrm{Hz}$, $f_c = 950\\ \\mathrm{Hz}$, $M = 0.8$, $R = 50\\ \\Omega$, $L = 0.005\\ \\mathrm{H}$, $V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$, $\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$, $\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$.\n3. Case C (inductive dominated): $f_1 = 50\\ \\mathrm{Hz}$, $f_c = 850\\ \\mathrm{Hz}$, $M = 0.95$, $R = 5\\ \\Omega$, $L = 0.1\\ \\mathrm{H}$, $V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$, $\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$, $\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$.\n4. Case D (low modulation edge case): $f_1 = 50\\ \\mathrm{Hz}$, $f_c = 450\\ \\mathrm{Hz}$, $M = 0.2$, $R = 20\\ \\Omega$, $L = 0.03\\ \\mathrm{H}$, $V_{\\mathrm{dc}} = 100\\ \\mathrm{V}$, $\\varepsilon = 1\\times 10^{-3}\\ \\mathrm{C}$, $\\Delta t = 1\\times 10^{-4}\\ \\mathrm{s}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets, where each case is itself a list in the order $[\\Delta \\mathrm{THD}, \\mathrm{THD}_{\\mathrm{baseline}}, \\mathrm{THD}_{\\mathrm{opt}}, \\mathrm{balanced}_{\\mathrm{baseline}}, \\mathrm{balanced}_{\\mathrm{opt}}]$. For example, the output should look like $[[x_1,y_1,z_1,b_1,o_1],[x_2,y_2,z_2,b_2,o_2],[x_3,y_3,z_3,b_3,o_3],[x_4,y_4,z_4,b_4,o_4]]$, where all $x_k,y_k,z_k$ are decimals and $b_k,o_k$ are booleans.",
            "solution": "The problem requires the optimization of carrier phase offsets in a single-phase cascaded H-bridge (CHB) multilevel inverter to minimize a weighted sum of low-order voltage harmonics, subject to a capacitor charge balance constraint. The solution involves time-domain simulation, Fourier analysis, and a constrained optimization search.\n\n### 1. System Modeling and Simulation\n\nThe system consists of an $N$-cell CHB inverter connected to a series RL load. The state of the system is described by the load current $i(t)$ and the charge accumulated in each cell's DC link capacitor.\n\n**1.1. Signal Generation**\nThe modulation scheme is carrier-based Pulse Width Modulation (PWM). A sinusoidal reference voltage, $v_{\\mathrm{ref}}(t) = M \\sin(2\\pi f_1 t)$, where $M$ is the modulation index and $f_1$ is the fundamental frequency, is compared with $N$ triangular carrier signals, $c_i(t)$. Each carrier has a frequency $f_c$, an amplitude of $1$, and a phase offset $\\phi_i$. For time-domain simulation with a step $\\Delta t$, the time vector is $t_k = k \\Delta t$ for $k \\in \\{0, 1, \\dots, N_{\\mathrm{pts}}-1\\}$, where the total number of points $N_{\\mathrm{pts}}$ is chosen such that the simulation covers an integer number of fundamental periods, $T = P/f_1$ (here $P=2$), and the fundamental frequency lies on a DFT bin.\n\nThe reference signal at discrete time points is:\n$$v_{\\mathrm{ref}}(t_k) = M \\sin(2\\pi f_1 t_k)$$\n\nThe $i$-th triangular carrier signal with a phase offset $\\phi_i$ is generated using the formula:\n$$c_i(t_k) = 1 - 4 \\left| \\left(f_c t_k + \\frac{\\phi_i}{2\\pi}\\right) \\pmod{1} - \\frac{1}{2} \\right|$$\nwhere `pmod 1` is the fractional part of the argument. This produces a triangular waveform oscillating between $-1$ and $+1$.\n\n**1.2. Switching Functions and Output Voltage**\nThe switching function for cell $i$, $s_i(t)$, determines its output voltage polarity. It is generated by a comparator:\n$$s_i(t_k) = \\mathrm{sgn}\\left(v_{\\mathrm{ref}}(t_k) - c_i(t_k)\\right)$$\nTo ensure the output is strictly in $\\{-1, +1\\}$, we define $\\mathrm{sgn}(x) = 1$ for $x \\ge 0$ and $\\mathrm{sgn}(x) = -1$ for $x < 0$.\n\nThe total inverter output voltage is the sum of individual cell outputs, scaled by the DC voltage per cell, $V_{\\mathrm{dc}}$:\n$$v_{\\mathrm{out}}(t_k) = V_{\\mathrm{dc}} \\sum_{i=1}^{N} s_i(t_k)$$\n\n**1.3. Load Current Simulation**\nThe load current $i(t)$ is governed by the first-order ordinary differential equation:\n$$\\frac{di}{dt} = \\frac{v_{\\mathrm{out}}(t) - R i(t)}{L}$$\nwith the initial condition $i(0) = 0$. This equation is solved numerically using the forward Euler method with a time step $\\Delta t$:\n$$i(t_{k+1}) = i(t_k) + \\frac{\\Delta t}{L} \\left( v_{\\mathrm{out}}(t_k) - R i(t_k) \\right)$$\n\n### 2. Performance Metrics and Constraints\n\n**2.1. Harmonic Analysis**\nThe quality of the output voltage waveform is assessed by its harmonic content. The Discrete Fourier Transform (DFT) is applied to the simulated voltage waveform $v_{\\mathrm{out}}(t_k)$ to obtain its frequency spectrum. Let $V_{\\mathrm{fft}}$ be the DFT of $v_{\\mathrm{out}}$. The Root-Mean-Square (RMS) value of the $n$-th harmonic (at frequency $n f_1$) is calculated from the corresponding DFT coefficient. The fundamental frequency $f_1$ corresponds to the DFT bin index $k_1 = f_1 T$. For this problem, $T=2/f_1$, so $k_1=2$. The $n$-th harmonic corresponds to bin $k_n = n k_1 = 2n$. The RMS value is:\n$$V_{n,\\mathrm{rms}} = \\frac{\\sqrt{2} |V_{\\mathrm{fft}}[k_n]|}{N_{\\mathrm{pts}}}$$\nThe Total Harmonic Distortion (THD) is the ratio of the RMS sum of all higher harmonics to the RMS value of the fundamental component. It can be efficiently calculated using the variance of the signal:\n$$\\mathrm{THD} = \\frac{\\sqrt{ \\sum_{n=2}^{\\infty} V_{n,\\mathrm{rms}}^2 }}{V_{1,\\mathrm{rms}}} = \\sqrt{\\frac{\\mathrm{var}(v_{\\mathrm{out}})}{V_{1,\\mathrm{rms}}^2} - 1}$$\nwhere $\\mathrm{var}(v_{\\mathrm{out}})$ is the variance of the AC-coupled signal, and $V_{1,\\mathrm{rms}}^2 = 2 (|V_{\\mathrm{fft}}[k_1]|/N_{\\mathrm{pts}})^2$.\n\n**2.2. Capacitor Charge Balance**\nThe charge balance for each cell is critical for stable inverter operation. It is quantified by the net charge transferred through the cell over the simulation horizon $T$:\n$$Q_i(T) = \\int_{0}^{T} s_i(t) i(t) \\, dt$$\nIn the discrete-time simulation, this integral is approximated by a sum:\n$$Q_i = \\Delta t \\sum_{k=0}^{N_{\\mathrm{pts}}-1} s_i(t_k) i(t_k)$$\nThe balancing constraint requires that the absolute value of this charge error for every cell is below a given tolerance $\\varepsilon$:\n$$\\max_{i=1,\\dots,N} |Q_i| \\le \\varepsilon$$\n\n### 3. Constrained Optimization\n\nThe objective is to minimize a weighted sum of the squared RMS values of specific low-order harmonics:\n$$J(\\boldsymbol{\\phi}) = \\sum_{n \\in \\mathcal{N}} w_n V_{n,\\mathrm{rms}}^2$$\nwhere $\\boldsymbol{\\phi} = [\\phi_1, \\dots, \\phi_N]$ is the vector of carrier phase offsets, $\\mathcal{N} = \\{3,5,7,9,11,13,15,17,19\\}$, and the weights are $w_5=w_7=2$ and $w_n=1$ otherwise.\n\nThe optimization is performed over a discrete grid of phase angles, $\\phi_i \\in \\{0, \\frac{\\pi}{3}, \\frac{2\\pi}{3}, \\pi, \\frac{4\\pi}{3}, \\frac{5\\pi}{3}\\}$. A brute-force search is conducted over all $6^N$ possible combinations of phase offsets. For each combination $\\boldsymbol{\\phi}$:\n1.  Simulate the system to obtain $v_{\\mathrm{out}}(t)$ and $i(t)$.\n2.  Calculate the charge errors $Q_i$ and check if the balance constraint $\\max_i |Q_i| \\le \\varepsilon$ is satisfied.\n3.  If the constraint is met, calculate the objective function $J(\\boldsymbol{\\phi})$.\n\nThe optimal phase vector $\\boldsymbol{\\phi}^{\\star}$ is the one that satisfies the balance constraint and yields the minimum value of $J(\\boldsymbol{\\phi})$.\n\nFinally, the performance is evaluated by comparing the THD of the optimized case, $\\mathrm{THD}(\\boldsymbol{\\phi}^{\\star})$, with the baseline case where all phases are zero, $\\mathrm{THD}(\\boldsymbol{\\phi}^{0})$. The improvement is reported as $\\Delta \\mathrm{THD} = \\mathrm{THD}(\\boldsymbol{\\phi}^{0}) - \\mathrm{THD}(\\boldsymbol{\\phi}^{\\star})$. The balance status of both the baseline and optimized solutions is also determined.",
            "answer": "```\n[[0.063131, 0.28312, 0.219989, True, True],[0.07689, 0.315003, 0.238113, True, True],[-0.01353, 0.203138, 0.216668, True, True],[0.0, 0.812338, 0.812338, False, False]]\n```"
        }
    ]
}