{
    "hands_on_practices": [
        {
            "introduction": "理解房室模型的第一步是掌握将电缆方程离散化的基本机制。本练习将指导您使用隐式欧拉法，对一个简单的三房室模型进行单时间步的模拟。通过手动构建并求解线性系统，您将具体理解电流守恒和欧姆定律等抽象原理如何转化为计算算法，为所有树突模拟奠定坚实的基础。",
            "id": "4039542",
            "problem": "考虑一个被近似为三个串联等电位隔室的无源树突电缆，该电缆将在神经形态和类脑计算环境中使用房室模型进行仿真。每个隔室都具有膜电容 $C_{\\mathrm{m}}$、漏导 $g_{\\mathrm{L}}$（对应于反转电位 $E_{\\mathrm{L}}$），并通过轴向电导 $g_{\\mathrm{a}}$ 与其最近的邻居耦合。两端是封闭的，因此在第一个和第三个隔室之外没有轴向耦合。给定以下参数和状态：$C_{\\mathrm{m}} = 0.2~\\mathrm{nF}$，$g_{\\mathrm{L}} = 0.5~\\mathrm{\\mu S}$，$E_{\\mathrm{L}} = 0~\\mathrm{mV}$，$g_{\\mathrm{a}} = 1.0~\\mathrm{\\mu S}$（在隔室 $1$–$2$ 和 $2$–$3$ 之间），时间步长 $\\Delta t = 0.1~\\mathrm{ms}$，以及在时间 $t_n$ 的膜电压为 $\\mathbf{V}^n = \\begin{pmatrix} -65 \\\\ -60 \\\\ -70 \\end{pmatrix}~\\mathrm{mV}$。假设外部注入电流（每个隔室）在时间步结束时施加，即 $\\mathbf{I}(t_{n+1}) = \\begin{pmatrix} 0.5 \\\\ 0.0 \\\\ 0.2 \\end{pmatrix}~\\mathrm{nA}$。\n\n从基尔霍夫电流定律（KCL）和电容、漏泄和轴向电流的无源电缆定义出发，推导将后向（隐式）欧拉法应用于从 $t_n$ 到 $t_{n+1}$ 的一个时间步所产生的线性系统，显式地组装出所得到的 $3 \\times 3$ 系统矩阵，并求解下一步的电压 $\\mathbf{V}^{n+1}$。将 $\\mathbf{V}^{n+1}$ 的每个分量以 $\\mathrm{mV}$ 为单位表示，并将最终数值四舍五入到四位有效数字。最终答案必须以单行矩阵的形式给出。",
            "solution": "该问题要求使用后向（隐式）欧拉法，为一个三隔室树突模型的膜电压推导并求解一个线性系统。\n\n首先，我们根据基尔霍夫电流定律（KCL）建立每个隔室膜电压的控制方程。对于每个隔室 $i$，电容电流、漏电流以及与相邻隔室之间的轴向电流之和必须等于外部注入的电流。\n电流项定义如下：\n- 电容电流：$I_{\\mathrm{cap}, i} = C_{\\mathrm{m}} \\frac{dV_i}{dt}$\n- 漏电流：$I_{\\mathrm{leak}, i} = g_{\\mathrm{L}} (V_i - E_{\\mathrm{L}})$\n- 从隔室 $i$ 到 $j$ 的轴向电流：$I_{\\mathrm{axial}, ij} = g_{\\mathrm{a}} (V_i - V_j)$\n- 注入电流：$I_{i}(t)$\n\n树突电缆被建模为三个串联的隔室，两端封闭。这意味着隔室 $1$ 仅与隔室 $2$ 耦合，隔室 $2$ 与 $1$ 和 $3$ 耦合，而隔室 $3$ 仅与 $2$ 耦合。三个隔室的KCL方程为：\n\n对于隔室 $1$：\n$$C_{\\mathrm{m}} \\frac{dV_1}{dt} + g_{\\mathrm{L}} (V_1 - E_{\\mathrm{L}}) + g_{\\mathrm{a}} (V_1 - V_2) = I_1(t)$$\n\n对于隔室 $2$：\n$$C_{\\mathrm{m}} \\frac{dV_2}{dt} + g_{\\mathrm{L}} (V_2 - E_{\\mathrm{L}}) + g_{\\mathrm{a}} (V_2 - V_1) + g_{\\mathrm{a}} (V_2 - V_3) = I_2(t)$$\n\n对于隔室 $3$：\n$$C_{\\mathrm{m}} \\frac{dV_3}{dt} + g_{\\mathrm{L}} (V_3 - E_{\\mathrm{L}}) + g_{\\mathrm{a}} (V_3 - V_2) = I_3(t)$$\n\n接下来，我们应用后向（隐式）欧拉法来离散化这些微分方程。时间导数近似为 $\\frac{dV_i}{dt} \\approx \\frac{V_i^{n+1} - V_i^n}{\\Delta t}$，所有其他项都在未来的时间步 $t_{n+1}$ 进行评估。令 $\\mathbf{V}^{n+1} = (V_1^{n+1}, V_2^{n+1}, V_3^{n+1})^T$ 为时间 $t_{n+1}$ 的未知电压向量。当 $E_{\\mathrm{L}} = 0~\\mathrm{mV}$ 时，离散化的方程为：\n\n对于隔室 $1$：\n$$C_{\\mathrm{m}} \\frac{V_1^{n+1} - V_1^n}{\\Delta t} + g_{\\mathrm{L}} V_1^{n+1} + g_{\\mathrm{a}} (V_1^{n+1} - V_2^{n+1}) = I_1^{n+1}$$\n\n对于隔室 $2$：\n$$C_{\\mathrm{m}} \\frac{V_2^{n+1} - V_2^n}{\\Delta t} + g_{\\mathrm{L}} V_2^{n+1} + g_{\\mathrm{a}} (V_2^{n+1} - V_1^{n+1}) + g_{\\mathrm{a}} (V_2^{n+1} - V_3^{n+1}) = I_2^{n+1}$$\n\n对于隔室 $3$：\n$$C_{\\mathrm{m}} \\frac{V_3^{n+1} - V_3^n}{\\Delta t} + g_{\\mathrm{L}} V_3^{n+1} + g_{\\mathrm{a}} (V_3^{n+1} - V_2^{n+1}) = I_3^{n+1}$$\n\n为了形成 $A \\mathbf{V}^{n+1} = \\mathbf{b}$ 形式的线性系统，我们重新排列方程，将所有包含 $\\mathbf{V}^{n+1}$ 的项分组到左侧（LHS），并将所有已知量分组到右侧（RHS）。\n\n对 $V_1^{n+1}$, $V_2^{n+1}$ 和 $V_3^{n+1}$ 进行重排：\n$$ \\left(\\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + g_{\\mathrm{a}}\\right) V_1^{n+1} - g_{\\mathrm{a}} V_2^{n+1} = \\frac{C_{\\mathrm{m}}}{\\Delta t} V_1^n + I_1^{n+1} $$\n$$ -g_{\\mathrm{a}} V_1^{n+1} + \\left(\\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + 2g_{\\mathrm{a}}\\right) V_2^{n+1} - g_{\\mathrm{a}} V_3^{n+1} = \\frac{C_{\\mathrm{m}}}{\\Delta t} V_2^n + I_2^{n+1} $$\n$$ -g_{\\mathrm{a}} V_2^{n+1} + \\left(\\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + g_{\\mathrm{a}}\\right) V_3^{n+1} = \\frac{C_{\\mathrm{m}}}{\\Delta t} V_3^n + I_3^{n+1} $$\n\n线性系统 $A \\mathbf{V}^{n+1} = \\mathbf{b}$ 的系统矩阵 $A$ 和向量 $\\mathbf{b}$ 定义如下：\n$$ A = \\begin{pmatrix}\n\\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + g_{\\mathrm{a}} & -g_{\\mathrm{a}} & 0 \\\\\n-g_{\\mathrm{a}} & \\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + 2g_{\\mathrm{a}} & -g_{\\mathrm{a}} \\\\\n0 & -g_{\\mathrm{a}} & \\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + g_{\\mathrm{a}}\n\\end{pmatrix} $$\n$$ \\mathbf{b} = \\begin{pmatrix}\n\\frac{C_{\\mathrm{m}}}{\\Delta t} V_1^n + I_1^{n+1} \\\\\n\\frac{C_{\\mathrm{m}}}{\\Delta t} V_2^n + I_2^{n+1} \\\\\n\\frac{C_{\\mathrm{m}}}{\\Delta t} V_3^n + I_3^{n+1}\n\\end{pmatrix} $$\n\n现在，我们代入给定的数值。如果我们将 $C_{\\mathrm{m}}$ 单位设为 $\\mathrm{nF}$，$g_{\\mathrm{L}}$ 和 $g_{\\mathrm{a}}$ 单位设为 $\\mathrm{\\mu S}$，$V$ 单位设为 $\\mathrm{mV}$，$\\Delta t$ 单位设为 $\\mathrm{ms}$，$I$ 单位设为 $\\mathrm{nA}$，则单位是一致的。\n参数为：$C_{\\mathrm{m}} = 0.2~\\mathrm{nF}$，$g_{\\mathrm{L}} = 0.5~\\mathrm{\\mu S}$，$g_{\\mathrm{a}} = 1.0~\\mathrm{\\mu S}$，$\\Delta t = 0.1~\\mathrm{ms}$。\n项 $\\frac{C_{\\mathrm{m}}}{\\Delta t} = \\frac{0.2~\\mathrm{nF}}{0.1~\\mathrm{ms}} = 2.0~\\frac{\\mathrm{nF}}{\\mathrm{ms}} = 2.0~\\mathrm{\\mu S}$。\n\n我们现在可以显式地组装 $3 \\times 3$ 系统矩阵 $A$：\n对角线元素为：\n$A_{11} = A_{33} = \\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + g_{\\mathrm{a}} = 2.0 + 0.5 + 1.0 = 3.5~\\mathrm{\\mu S}$\n$A_{22} = \\frac{C_{\\mathrm{m}}}{\\Delta t} + g_{\\mathrm{L}} + 2g_{\\mathrm{a}} = 2.0 + 0.5 + 2(1.0) = 4.5~\\mathrm{\\mu S}$\n非对角线元素为：\n$A_{12} = A_{21} = A_{23} = A_{32} = -g_{\\mathrm{a}} = -1.0~\\mathrm{\\mu S}$\n所以，系统矩阵是：\n$$ A = \\begin{pmatrix} 3.5 & -1.0 & 0 \\\\ -1.0 & 4.5 & -1.0 \\\\ 0 & -1.0 & 3.5 \\end{pmatrix}~\\mathrm{\\mu S} $$\n\n接下来，我们使用 $\\mathbf{V}^n = \\begin{pmatrix} -65 \\\\ -60 \\\\ -70 \\end{pmatrix}~\\mathrm{mV}$ 和 $\\mathbf{I}^{n+1} = \\begin{pmatrix} 0.5 \\\\ 0.0 \\\\ 0.2 \\end{pmatrix}~\\mathrm{nA}$ 组装向量 $\\mathbf{b}$。\n$b_1 = \\frac{C_{\\mathrm{m}}}{\\Delta t} V_1^n + I_1^{n+1} = (2.0)(-65) + 0.5 = -130 + 0.5 = -129.5~\\mathrm{nA}$\n$b_2 = \\frac{C_{\\mathrm{m}}}{\\Delta t} V_2^n + I_2^{n+1} = (2.0)(-60) + 0.0 = -120 + 0.0 = -120.0~\\mathrm{nA}$\n$b_3 = \\frac{C_{\\mathrm{m}}}{\\Delta t} V_3^n + I_3^{n+1} = (2.0)(-70) + 0.2 = -140 + 0.2 = -139.8~\\mathrm{nA}$\n所以，右侧向量为：\n$$ \\mathbf{b} = \\begin{pmatrix} -129.5 \\\\ -120.0 \\\\ -139.8 \\end{pmatrix}~\\mathrm{nA} $$\n\n我们现在求解线性系统 $A \\mathbf{V}^{n+1} = \\mathbf{b}$ 以得到 $\\mathbf{V}^{n+1}$：\n$$ \\begin{pmatrix} 3.5 & -1.0 & 0 \\\\ -1.0 & 4.5 & -1.0 \\\\ 0 & -1.0 & 3.5 \\end{pmatrix} \\begin{pmatrix} V_1^{n+1} \\\\ V_2^{n+1} \\\\ V_3^{n+1} \\end{pmatrix} = \\begin{pmatrix} -129.5 \\\\ -120.0 \\\\ -139.8 \\end{pmatrix} $$\n这对应于以下方程组：\n1) $3.5 V_1^{n+1} - V_2^{n+1} = -129.5$\n2) $-V_1^{n+1} + 4.5 V_2^{n+1} - V_3^{n+1} = -120.0$\n3) $-V_2^{n+1} + 3.5 V_3^{n+1} = -139.8$\n\n从方程(1)中，我们将 $V_1^{n+1}$ 表示为 $V_2^{n+1}$ 的函数：$V_1^{n+1} = \\frac{V_2^{n+1} - 129.5}{3.5}$。\n从方程(3)中，我们将 $V_3^{n+1}$ 表示为 $V_2^{n+1}$ 的函数：$V_3^{n+1} = \\frac{V_2^{n+1} - 139.8}{3.5}$。\n将这些代入方程(2)：\n$$ -\\left(\\frac{V_2^{n+1} - 129.5}{3.5}\\right) + 4.5 V_2^{n+1} - \\left(\\frac{V_2^{n+1} - 139.8}{3.5}\\right) = -120.0 $$\n将整个方程乘以 $3.5$：\n$$ -(V_2^{n+1} - 129.5) + (4.5 \\times 3.5) V_2^{n+1} - (V_2^{n+1} - 139.8) = -120.0 \\times 3.5 $$\n$$ -V_2^{n+1} + 129.5 + 15.75 V_2^{n+1} - V_2^{n+1} + 139.8 = -420 $$\n$$ (15.75 - 1 - 1) V_2^{n+1} + (129.5 + 139.8) = -420 $$\n$$ 13.75 V_2^{n+1} + 269.3 = -420 $$\n$$ 13.75 V_2^{n+1} = -420 - 269.3 = -689.3 $$\n$$ V_2^{n+1} = \\frac{-689.3}{13.75} \\approx -50.130909~\\mathrm{mV} $$\n现在我们求解 $V_1^{n+1}$ 和 $V_3^{n+1}$：\n$$ V_1^{n+1} = \\frac{-50.130909 - 129.5}{3.5} = \\frac{-179.630909}{3.5} \\approx -51.323117~\\mathrm{mV} $$\n$$ V_3^{n+1} = \\frac{-50.130909 - 139.8}{3.5} = \\frac{-189.930909}{3.5} \\approx -54.265974~\\mathrm{mV} $$\n\n最后，我们按照要求将数值四舍五入到四位有效数字。\n$V_1^{n+1} \\approx -51.32~\\mathrm{mV}$\n$V_2^{n+1} \\approx -50.13~\\mathrm{mV}$\n$V_3^{n+1} \\approx -54.27~\\mathrm{mV}$\n\n下一步电压的解是 $\\mathbf{V}^{n+1} = \\begin{pmatrix} -51.32 \\\\ -50.13 \\\\ -54.27 \\end{pmatrix}~\\mathrm{mV}$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} -51.32 & -50.13 & -54.27 \\end{pmatrix} } $$"
        },
        {
            "introduction": "计算建模的一个关键优势是能够根据解剖学数据检验理论原理。本练习要求您在形态重构的树突上，验证树突理论的基石之一——Rall的 $d^{3/2}$ 幂次法则。通过编写程序来量化树突分岔点在多大程度上符合阻抗匹配的理想条件，您将锻炼分析神经元形态的实践技能，并将抽象的电缆理论与神经元的具体结构联系起来。",
            "id": "3974766",
            "problem": "给定一组代表树突状乔木形态重建的有根树。每个节点对应一个短圆柱形隔室，其直径以微米为单位给出。这些树表示为元组 $(\\text{node\\_id}, \\text{parent\\_id}, d)$ 的列表，其中 $d$ 是隔室直径（单位为 $\\mu\\text{m}$），$\\text{parent\\_id}=-1$ 表示根节点，每个非根节点有且仅有一个父节点。分支点（分叉点）是任何拥有两个或更多子节点的节点。\n\n目的是通过计算每个分支点的父隔室 $d^{3/2}$ 与子隔室 $d^{3/2}$ 之和之间的偏差，来检验 Rall 法则在每棵树中的适用性。具体而言，对于一个父节点直径为 $d_p$、子节点直径为 $\\{d_k\\}_{k=1}^m$ 的分支点，定义其和为 $S_{\\text{parent}} = d_p^{3/2}$ 和 $S_{\\text{kids}} = \\sum_{k=1}^m d_k^{3/2}$，以及相对偏差\n$$\n\\delta = \\frac{S_{\\text{kids}} - S_{\\text{parent}}}{S_{\\text{parent}}}.\n$$\n对于给定树中的所有分支点，计算三个指标：平均绝对相对偏差 $\\overline{|\\delta|}$，最大绝对相对偏差 $\\max|\\delta|$，以及绝对相对偏差小于等于容差 $\\tau$ 的分支点所占的比例 $f_\\tau$。容差 $\\tau=0.05$（一个小数），所有偏差指标均为无量纲。如果一棵树没有分支点，则定义 $\\overline{|\\delta|}=0$, $\\max|\\delta|=0$, $f_\\tau=1$。\n\n本问题的理论基础是准静态条件下神经元树突的线性电缆理论，以及一个经过充分检验的观察结果：半无限长圆柱形电缆的输入电导与 $d^{3/2}$ 成比例，这导致了节点处的分支电导匹配条件。解答中要求给出此比例关系的推导及其应用。\n\n你的任务是实现一个程序，为所提供的包含五棵树的测试套件，计算每棵树的上述三个指标，并将它们以单一的聚合格式输出。直径以 $\\mu\\text{m}$ 为单位；偏差是无量纲的。无角度，不使用百分号。\n\n测试套件（每棵树都是 $(\\text{node\\_id}, \\text{parent\\_id}, d)$ 元组的列表；直径 $d$ 的单位为 $\\mu\\text{m}$）：\n\n- 树 A（平衡二叉树，在两个分支点上都近似符合 Rall 法则）：\n    - $(0,-1,2.0736)$\n    - $(1,0,1.2)$\n    - $(2,0,1.4)$\n    - $(3,1,0.7)$\n    - $(4,1,0.81)$\n\n- 树 B（拓扑结构与树 A 相同，其中一个分支处有刻意设置的偏差）：\n    - $(0,-1,2.0736)$\n    - $(1,0,1.2)$\n    - $(2,0,1.4)$\n    - $(3,1,0.7)$\n    - $(4,1,0.9)$\n\n- 树 C（根节点为三叉，近似符合 Rall 法则，但更深处的一个分叉有偏差）：\n    - $(0,-1,2.0850)$\n    - $(1,0,1.1)$\n    - $(2,0,1.0)$\n    - $(3,0,0.9)$\n    - $(4,1,0.7)$\n    - $(5,1,0.5)$\n\n- 树 D（单链，无分支点）：\n    - $(0,-1,1.2)$\n    - $(1,0,1.1)$\n    - $(2,1,1.0)$\n    - $(3,2,0.9)$\n\n- 树 E（根节点为二叉，其中一个子节点极小以测试数值稳定性，更深处的一个分叉有偏差）：\n    - $(0,-1,1.0)$\n    - $(1,0,0.2)$\n    - $(2,0,0.945)$\n    - $(3,2,0.4)$\n    - $(4,2,0.5)$\n\n你的程序应生成单行输出，其中包含五棵树的结果，格式为逗号分隔的列表的列表，每个内部列表按 $[\\overline{|\\delta|}, \\max|\\delta|, f_\\tau]$ 的顺序包含三个指标。例如，输出应类似于 $[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3],[x_4,y_4,z_4],[x_5,y_5,z_5]]$，其中每个 $x_i$、$y_i$ 和 $z_i$ 都是浮点数。不允许有其他输出文本。",
            "solution": "该问题要求基于 Rall 分支法则对树突树的形态进行分析，该法则是从线性电缆理论推导出来的。在介绍计算方法之前，必须按要求先建立理论基础。\n\n**理论基础：Rall 3/2 次方法则的推导**\n\nRall 法则的基础是在稳态（直流）条件下，无源树突电缆中的电流行为。我们将一段树突建模为一个均匀的圆柱体。沿该电缆长度 $x$ 的电压 $V(x)$ 由稳态电缆方程描述：\n$$\n\\lambda^2 \\frac{d^2V}{dx^2} - V = 0\n$$\n这里，$\\lambda$ 是电缆的空间常数，定义为 $\\lambda = \\sqrt{r_m/r_a}$，其中 $r_m$ 是单位长度圆柱体的膜电阻，$r_a$ 是单位长度的轴向电阻。\n\n这些电阻取决于圆柱体的几何形状和神经元的内在特性。设 $d$ 为圆柱形隔室的直径，$R_m$ 为比膜电阻（单位为 $\\Omega \\cdot \\text{m}^2$），$R_i$ 为比细胞内（轴向）电阻率（单位为 $\\Omega \\cdot \\text{m}$）。\n\n单位长度的膜电阻 $r_m$ 与单位长度的膜表面积（周长 $\\pi d$）成反比：\n$$\nr_m = \\frac{R_m}{\\pi d}\n$$\n单位长度的轴向电阻 $r_a$ 与圆柱体的横截面积（$A = \\pi(d/2)^2$）成反比：\n$$\nr_a = \\frac{R_i}{A} = \\frac{R_i}{\\pi (d/2)^2} = \\frac{4 R_i}{\\pi d^2}\n$$\n将这些代入空间常数 $\\lambda$ 的定义中：\n$$\n\\lambda = \\sqrt{\\frac{r_m}{r_a}} = \\sqrt{\\frac{R_m / (\\pi d)}{4 R_i / (\\pi d^2)}} = \\sqrt{\\frac{R_m d}{4 R_i}}\n$$\n假设材料特性是均匀的（$R_m$ 和 $R_i$ 是常数），空间常数与直径的平方根成正比：$\\lambda \\propto \\sqrt{d}$。\n\n接下来，我们考虑树突分支的输入电导 $G_{in}$。对于半无限长电缆（对于电学上长的分支是一个有效的近似），输入电阻为 $R_{in} = \\sqrt{r_m r_a}$。输入电导是其倒数：\n$$\nG_{in} = \\frac{1}{R_{in}} = \\frac{1}{\\sqrt{r_m r_a}}\n$$\n我们也可以用 $\\lambda$ 和 $r_a$ 将 $R_{in}$ 表示为 $R_{in} = \\lambda r_a$。因此：\n$$\nG_{in} = \\frac{1}{\\lambda r_a}\n$$\n现在，我们研究 $G_{in}$ 如何随直径 $d$ 变化。我们已经确定 $\\lambda \\propto \\sqrt{d}$ 且 $r_a \\propto 1/d^2$。因此：\n$$\nG_{in} \\propto \\frac{1}{(\\sqrt{d}) (1/d^2)} = \\frac{d^2}{\\sqrt{d}} = d^{3/2}\n$$\n这个推导确定了半无限长电缆的输入电导与其直径的 $3/2$ 次方成比例。\n\nWilfrid Rall 的洞见在于，为了实现高效且无阻抗失配的信号传播，从父分支看进去的电导应等于其所有子分支的电导之和。在一个父节点直径为 $d_p$、拥有 $m$ 个子分支且其直径为 $\\{d_k\\}_{k=1}^m$ 的分支点上，该条件为：\n$$\nG_{in, \\text{parent}} = \\sum_{k=1}^m G_{in, \\text{child}_k}\n$$\n使用推导出的比例关系，并设 $C$ 为比例常数，我们得到：\n$$\nC \\cdot d_p^{3/2} = \\sum_{k=1}^m C \\cdot d_k^{3/2}\n$$\n常数 $C$ 可以消去，从而得到 Rall 著名的分支法则：\n$$\nd_p^{3/2} = \\sum_{k=1}^m d_k^{3/2}\n$$\n**计算策略**\n\n问题要求我们为一组给定的树突树量化与此理想法则的偏差。对每棵树实现此目标的算法如下：\n\n1.  **数据结构化**：输入格式是一个 $(\\text{node\\_id}, \\text{parent\\_id}, d)$ 元组的列表，即边列表。需要将其解析为更便于计算的结构。使用两个字典是最佳选择：\n    *   一个将每个 `node_id` 映射到其直径 $d$ 的字典。\n    *   一个将每个父 `node_id` 映射到其子 `node_id` 列表的字典。这直接表示了树的层次结构。\n\n2.  **识别分支点**：分支点被定义为拥有两个或更多子节点的节点。通过遍历上一步创建的父-子字典，所有键对应列表长度 $\\ge 2$ 的节点都被识别为分支点。\n\n3.  **偏差计算**：对于每个识别出的分支点 $p$：\n    *   获取父节点直径 $d_p$ 和子节点直径集合 $\\{d_k\\}$。\n    *   计算父节点和 $S_{\\text{parent}} = d_p^{3/2}$。\n    *   计算子节点和 $S_{\\text{kids}} = \\sum_{k} d_k^{3/2}$。\n    *   计算相对偏差 $\\delta = (S_{\\text{kids}} - S_{\\text{parent}}) / S_{\\text{parent}}$。请注意，对于任何 $d_p > 0$，$S_{\\text{parent}}$ 也大于 0，从而避免了除以零的情况。测试套件中的所有直径均为正数。\n    *   将该树计算出的所有 $\\delta$ 值收集到一个列表中。\n\n4.  **指标计算**：\n    *   如果树不包含分支点，偏差列表将为空。根据问题定义，指标定义为 $\\overline{|\\delta|} = 0$，$\\max|\\delta| = 0$ 和 $f_\\tau = 1$。\n    *   如果存在分支点，则根据 $\\delta$ 值列表计算以下指标：\n        *   **平均绝对相对偏差, $\\overline{|\\delta|}$**：所有计算出的偏差的绝对值的算术平均值。\n        *   **最大绝对相对偏差, $\\max|\\delta|$**：所有计算出的偏差的绝对值中的最大值。\n        *   **符合条件的分支的比例, $f_\\tau$**：满足 $|\\delta| \\le \\tau$ 的分支点所占的比例，其中容差 $\\tau$ 给定为 $0.05$。计算方式为（满足 $|\\delta| \\le \\tau$ 的分支数）/（总分支数）。\n\n此过程独立应用于五个提供的测试树中的每一个，以生成最终结果。实现将使用 `numpy` 库以进行高效的数值运算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates dendritic trees against Rall's rule and computes deviation metrics.\n    \"\"\"\n    # Test suite of five dendritic trees.\n    # Each tree is a list of (node_id, parent_id, diameter) tuples.\n    test_cases = [\n        # Tree A (balanced binary, near-Rall compliance)\n        [\n            (0, -1, 2.0736), (1, 0, 1.2), (2, 0, 1.4), (3, 1, 0.7), (4, 1, 0.81)\n        ],\n        # Tree B (same as A, one branch deviating)\n        [\n            (0, -1, 2.0736), (1, 0, 1.2), (2, 0, 1.4), (3, 1, 0.7), (4, 1, 0.9)\n        ],\n        # Tree C (trifurcation, deeper bifurcation deviating)\n        [\n            (0, -1, 2.0850), (1, 0, 1.1), (2, 0, 1.0), (3, 0, 0.9), (4, 1, 0.7), (5, 1, 0.5)\n        ],\n        # Tree D (single chain, no branching points)\n        [\n            (0, -1, 1.2), (1, 0, 1.1), (2, 1, 1.0), (3, 2, 0.9)\n        ],\n        # Tree E (binary root, deeper bifurcation deviating)\n        [\n            (0, -1, 1.0), (1, 0, 0.2), (2, 0, 0.945), (3, 2, 0.4), (4, 2, 0.5)\n        ]\n    ]\n\n    # Tolerance for calculating the fraction of compliant branches.\n    tau = 0.05\n    all_results = []\n\n    for tree_data in test_cases:\n        if not tree_data:\n            # Handle empty tree case if necessary, though not in test suite.\n            all_results.append([0.0, 0.0, 1.0])\n            continue\n            \n        diameters = {node_id: d for node_id, _, d in tree_data}\n        children = {}\n        for node_id, parent_id, _ in tree_data:\n            if parent_id != -1:\n                if parent_id not in children:\n                    children[parent_id] = []\n                children[parent_id].append(node_id)\n        \n        branching_points = [\n            node_id for node_id, child_list in children.items()\n            if len(child_list) >= 2\n        ]\n\n        if not branching_points:\n            # Per problem spec, if no branching points, define metrics as follows.\n            mean_abs_dev = 0.0\n            max_abs_dev = 0.0\n            f_tau = 1.0\n            all_results.append([mean_abs_dev, max_abs_dev, f_tau])\n            continue\n\n        deviations = []\n        for bp_id in branching_points:\n            # Get parent diameter and calculate S_parent = d_p^(3/2)\n            d_p = diameters[bp_id]\n            # Handle d_p=0 case to prevent division by zero, though not in test data.\n            if d_p == 0:\n                # If parent diameter is 0, deviation is ill-defined.\n                # A sum of positive child diams would yield infinite deviation.\n                # Assuming d_p > 0 based on context. Let's formalize a behavior if needed.\n                # If child diameters are also 0, deviation could be 0. We'll assume d_p > 0.\n                s_parent = 0.0\n            else:\n                s_parent = np.power(d_p, 1.5)\n\n            # Get child diameters and calculate S_kids = sum(d_k^(3/2))\n            child_ids = children[bp_id]\n            child_diams = [diameters[cid] for cid in child_ids]\n            s_kids = np.sum(np.power(child_diams, 1.5))\n            \n            # Calculate relative deviation\n            if s_parent == 0:\n                # Can't compute relative deviation if parent sum is zero.\n                # If kids_sum is also 0, dev is 0. If kids_sum > 0, dev is inf.\n                # This case is not expected in the problem.\n                delta = np.inf if s_kids > 0 else 0.0\n            else:\n                delta = (s_kids - s_parent) / s_parent\n            \n            deviations.append(delta)\n\n        # Calculate metrics from the list of deviations\n        abs_deviations = np.abs(np.array(deviations))\n        mean_abs_dev = np.mean(abs_deviations)\n        max_abs_dev = np.max(abs_deviations)\n        \n        compliant_branches = np.sum(abs_deviations = tau)\n        f_tau = compliant_branches / len(branching_points)\n        \n        all_results.append([mean_abs_dev, max_abs_dev, f_tau])\n\n    # Format output to match specification: [[x1,y1,z1],[x2,y2,z2],...]\n    # without spaces inside the inner lists.\n    output_str = f\"[{','.join(['[' + ','.join(map(str, res)) + ']' for res in all_results])}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "尽管无源模型提供了重要的基础，但真实的树突富含主动的、非线性的离子通道，这使其能够进行复杂的计算。本练习将超越线性世界的范畴，探讨简化模型的局限性。它要求您像实验学家和理论家一样思考，识别线性假设失效的场景，并设计科学上合理的诊断方法来揭示这些强大的非线性动力学，例如局部峰电位和平台电位。",
            "id": "4039537",
            "problem": "考虑一个树突树，它通过对含分布式主动电导的一维电缆方程的多房室近似进行建模。设膜电压为 $V(x,t)$，沿分支坐标 $x$ 分布，其中比膜电容为 $c_m$，轴向电阻率为 $r_a$，被动漏电导为 $g_L$ 且其反转电位为 $E_L$。对于具有附加电压门控电导 $\\{g_k(V,t)\\}$ 的分支，其控制方程为\n$$\nc_m \\frac{\\partial V}{\\partial t} \\;=\\; \\frac{\\partial}{\\partial x}\\!\\left(\\frac{1}{r_a}\\frac{\\partial V}{\\partial x}\\right) \\;-\\; g_L \\big(V - E_L\\big) \\;-\\; \\sum_k g_k(V,t)\\,\\big(V - E_k\\big) \\;+\\; I_{\\mathrm{ext}}(x,t),\n$$\n其中门控变量遵循以下形式的动力学\n$$\n\\frac{\\mathrm{d}m_k}{\\mathrm{d}t} \\;=\\; \\alpha_k(V)\\,\\big(1 - m_k\\big) \\;-\\; \\beta_k(V)\\,m_k,\n$$\n并且 $g_k(V,t)$ 是 $\\{m_k\\}$ 和 $V$ 的函数。在模型简化中，人们用一组更粗糙的房室或一根能保留关键传输特性的等效电缆来代替精细离散化模型。一个常见的理由是在基线电压 $V_0$ 附近进行线性化，这会产生一个线性时不变（LTI）算子，其冲激响应或格林函数为 $G(x,y,t)$，位点 $x_i$ 和 $x_j$ 之间的转移阻抗为 $Z_{ij}(\\omega)$。在这种 LTI 近似下，叠加原理和齐次性原理成立：如果 $I_{\\mathrm{ext}}$ 按因子 $\\alpha$ 缩放，那么 $V$ 也按 $\\alpha$ 缩放，并且对多个输入的响应是相加的。\n\n然而，在存在强非线性（例如局部再生性事件，如树突棘波）的情况下，上述线性化可能不再有效，而假设线性或弱非线性的简化模型可能无法复现真实的动力学过程。请确定在这种强非线性导致模型简化失败的条件下，并提出能够凭经验或在模拟中检测到这些情况的诊断方法。\n\n选择所有正确指出了以下两点的选项：（i）导致树突树的线性简化假设失效的条件，以及（ii）能够揭示这种失效的科学可靠的诊断方法。\n\nA. 条件：远端分支含有高密度的电压门控钠电导，一旦局部电压超过阈值，它就支持全或无的局部棘波，从而产生一个主要局限于该分支的再生性电流源。诊断方法：在分支处施加频率为 $\\omega$、幅度为 $I_0$ 的正弦电流，并测试不同幅度下胞体的输出；在 $2\\omega$ 处出现显著的二次谐波分量以及幅度依赖的转移阻抗 $Z(\\omega)$，表明存在与线性简化不符的非线性。\n\nB. 条件：主动电导在分支点处异质聚集，产生状态依赖的阻抗失配，这违反了等效圆柱假设，并在较高幅度下破坏了近似的互易性。诊断方法：在低刺激幅度和高刺激幅度下，分别测量从位点 $i$ 到 $j$ 的转移阻抗 $Z_{ij}(\\omega)$ 和从 $j$ 到 $i$ 的转移阻抗 $Z_{ji}(\\omega)$；$Z_{ij}$ 与 $Z_{ji}$ 之间的幅度依赖性不对称揭示了使线性简化无效的非线性。\n\nC. 条件：强烈的N-甲基-D-天冬氨酸（NMDA）受体激活产生具有慢动力学和镁离子阻断解除特性的电压依赖性电导，从而在某些树突段产生局部平台电位和双稳态。诊断方法：在受影响的分支处使用电流斜坡方案，在电流增加和减少的斜坡期间测量局部电压 $V$ 与注入电流 $I$ 的关系；迟滞现象（上升和下降斜坡具有不同轨迹）证明了存在与线性简化假设不相容的双稳态。\n\nD. 条件：树突树是纯被动的，具有较小的电紧张长度和均匀的参数。诊断方法：构建胞体对小幅度和大幅度正弦输入的响应的波特图；在不同幅度下相同的幅值和相位表明由于隐藏的非线性导致简化失败。\n\nE. 条件：细小分支中的局部高阈值钙离子通道支持局部的钙离子棘波，这些棘波微弱地反向传播到胞体，并导致有效输入阻抗的急剧局部变化。诊断方法：通过分别测量两个突触输入 $I_1$ 和 $I_2$ 单独作用时以及它们共同作用时 $V(I_1 + I_2)$ 的胞体电压来进行叠加测试；非可加性，即 $V(I_1 + I_2) \\neq V(I_1) + V(I_2)$，揭示了使线性简化假设无效的非线性相互作用。",
            "solution": "问题要求找出成对的（i）导致树突树线性模型简化失败的条件，以及（ii）检测这种失败的科学可靠的诊断方法。线性时不变（LTI）模型简化通常基于神经元动力学在稳态或基线电压附近的线性化。这种简化的有效性取决于线性原理，即叠加原理和齐次性原理。LTI系统对输入之和的响应是各个独立响应之和（叠加），并且将输入按一个因子缩放会使输出按相同因子缩放（齐次性）。由电压门控离子通道引入的强非线性违反了这些原理，使得LTI近似无效。我们将根据所述条件是否代表了强非线性的真实来源，以及所提出的诊断方法是否是其有效的检测方法，来评估每个选项。\n\n膜电压 $V(x,t)$ 的控制方程如下：\n$$\nc_m \\frac{\\partial V}{\\partial t} \\;=\\; \\frac{\\partial}{\\partial x}\\!\\left(\\frac{1}{r_a}\\frac{\\partial V}{\\partial x}\\right) \\;-\\; g_L \\big(V - E_L\\big) \\;-\\; \\sum_k g_k(V,t)\\,\\big(V - E_k\\big) \\;+\\; I_{\\mathrm{ext}}(x,t)\n$$\n线性化是针对稳态电压 $V_0$ 周围的小扰动进行的。非线性主要源于电压依赖项 $g_k(V,t)$，这些项是门控变量 $\\{m_k\\}$ 的函数，而门控变量本身又依赖于电压 $V$。当电压偏离足够大，以至于显著激活这些电导时，就会出现强非线性，从而导致诸如棘波、平台或双稳态等现象。\n\n**A. 逐项分析**\n\n**选项 A：**\n*   **条件：**高密度的电压门控钠离子通道支持全或无的局部棘波。这描述了一种经典的阈值现象。在阈值以下，响应很小。超过阈值，则会触发一个巨大的、定型的再生性事件（钠棘波）。这种响应与输入刺激的幅度不成比例，这直接违反了线性系统的齐次性原理（$f(\\alpha x) \\neq \\alpha f(x)$）。因此，这是线性模型失效的一个有效条件。\n*   **诊断方法：**对线性系统施加正弦输入电流 $I(t) = I_0 \\sin(\\omega t)$ 将会产生一个相同频率 $\\omega$ 的正弦电压输出 $V(t)$，可表示为 $V(\\omega) = Z(\\omega) I(\\omega)$，其中转移阻抗 $Z(\\omega)$ 与输入幅度 $I_0$ 无关。如果系统是非线性的，输出可能包含谐波频率（$2\\omega$、$3\\omega$ 等）的功率。在 $2\\omega$ 处出现显著的二次谐波分量是非线性的明确标志。此外，如果系统的响应特性，例如计算出的转移阻抗 $Z(\\omega) = V(\\omega)/I(\\omega)$，随输入幅度 $I_0$ 的变化而变化，这也证明了系统不是线性的。这两种诊断方法都是系统辨识中检测非线性的标准且可靠的方法。\n*   **结论：**条件和诊断方法都科学可靠且正确关联。此选项 **正确**。\n\n**选项 B：**\n*   **条件：**在分支点异质聚集的主动电导会产生状态依赖（电压依赖）的阻抗。这意味着分支点的电学特性会根据局部电压而改变，这是非线性的一个标志。对于线性无源网络，互易性定理指出转移阻抗是对称的：$Z_{ij}(\\omega) = Z_{ji}(\\omega)$，其中 $Z_{ij}$ 是在位点 $i$ 注入电流时在位点 $j$ 的电压响应。主动的、电压依赖的电导可以打破这种对称性。在位点 $i$ 的大刺激可能与在位点 $j$ 的大刺激以不同的方式激活分支点的通道，从而使信号传输不具互易性。\n*   **诊断方法：**测量 $Z_{ij}(\\omega)$ 和 $Z_{ji}(\\omega)$ 是检验互易性的直接方法。在线性区域（低刺激幅度），我们预期 $Z_{ij}(\\omega) \\approx Z_{ji}(\\omega)$。如果在高刺激幅度下，出现了显著的、幅度依赖的不对称性，使得 $Z_{ij}(\\omega) \\neq Z_{ji}(\\omega)$，这就证明了电路中非线性元件的参与。这是一种有效且精密的诊断幅度依赖性非线性的方法。\n*   **结论：**该条件确定了一个有效的非线性来源，并且诊断方法是检测它的可靠方法。此选项 **正确**。\n\n**选项 C：**\n*   **条件：**NMDA受体激活导致平台电位和双稳态。NMDA受体的电压依赖性Mg$^{2+}$阻断可以在树突的电流-电压（$I-V$）关系中产生一个负斜率电阻区域。这可以支持双稳态，即在给定范围的输入电流下，膜可以存在于两种不同的稳定电压状态（一个“下”态和一个平台“上”态）。对于相同输入具有多个稳定状态的系统是根本上非线性的；一个线性系统对于给定的恒定输入只有一个唯一的稳态解。\n*   **诊断方法：**迟滞现象是双稳态的决定性特征。它通过施加一个缓慢变化的输入（如电流斜坡），先增加后减少来进行测试。在双稳态系统中，当输入（$I$）增加时，输出（电压 $V$）会遵循一条路径，而当输入减少时，会遵循另一条不同的路径，在 $V-I$ 平面中形成一个环路。这种迟滞环的存在是双稳态的无可辩驳的证据，因此也是使简单LTI模型无效的强非线性的证据。\n*   **结论：**该条件是树突强非线性的一个众所周知机制，而诊断方法是用于检测它的经典实验/计算测试。此选项 **正确**。\n\n**选项 D：**\n*   **条件：**一个纯被动的树突树，具有较小的电紧张长度和均匀的参数。根据定义，纯被动系统缺乏电压门控电导（控制方程中对 $k$ 的求和为零）。由此产生的方程是线性的。由线性方程描述的系统是线性模型准确且基于线性化的简化完全有效的理想情况，而不是它失败的情况。因此，该条件与问题的前提相矛盾。\n*   **诊断方法：**该诊断方法表明，如果小幅度和大幅度输入的波特图（幅值和相位响应）相同，则表示由于*隐藏的非线性*导致简化*失败*。这个逻辑是有缺陷的。在线性系统中，传递函数（以及波特图）与输入信号的幅度无关。不同幅度下相同的图是线性*的证据*，证实了线性模型是合适的。对诊断结果的解释是错误的。\n*   **结论：**该条件描述了一个线性系统，而不是一个线性简化失败的系统。诊断的结论在事实上是错误的。此选项 **不正确**。\n\n**选项 E：**\n*   **条件：**由高阈值钙离子通道支持的局部钙离子棘波。与选项A中的钠棘波类似，钙离子棘波是再生性的、全或无的事件，当电压超过一个高阈值时触发。这代表了一种强非线性，违反了齐次性原理。\n*   **诊断方法：**所提出的测试是对叠加原理的直接验证，而叠加原理是线性系统的一个定义性属性。该原理指出，对于任意两个输入 $I_1$ 和 $I_2$，对它们之和的响应必须是它们各自响应之和：$V(I_1 + I_2) = V(I_1) + V(I_2)$。如果分别测量对 $I_1$ 和 $I_2$ 的响应，然后测量它们共同作用时的响应，任何偏离简单相加（$V(I_1 + I_2) \\neq V(I_1) + V(I_2)$）的情况都是非线性的直接证明。这在神经元中很常见，两个阈下输入可以相加超过阈值并引发一个棘波（超线性求和），这是非线性整合的一个经典例子。\n*   **结论：**该条件是强非线性的一个有效来源，而所提议的叠加测试是检测它的一个基本而直接的方法。此选项 **正确**。\n\n总之，选项A、B、C和E均正确地将一个引起强非线性的条件与一个科学可靠的诊断方法配对以揭示它。选项D是错误的，因为它描述了一个线性系统，并错误地将线性的证据解释为失败的证据。",
            "answer": "$$\\boxed{ABCE}$$"
        }
    ]
}