{
    "hands_on_practices": [
        {
            "introduction": "A neuron's fundamental computation is often summarized by its frequency-current (F-I) curve, which describes how its firing rate changes in response to input. For many complex neuron models, this relationship can only be determined through numerical simulation. The Quadratic Integrate-and-Fire (QIF) model, however, is a canonical model of Type I excitability whose dynamics are simple enough to be solved analytically, allowing us to derive its F-I curve from first principles . This exercise will guide you through this foundational derivation, revealing the characteristic square-root dependence of the firing rate on the input current.",
            "id": "4056267",
            "problem": "Consider the dimensionless Quadratic Integrate-and-Fire (QIF) neuron driven by a constant input current $I \\in \\mathbb{R}$, defined by the membrane potential dynamics $ \\frac{dv}{dt} = v^{2} + I$. A spike is defined to occur when $v(t)$ diverges to $+\\infty$, after which the membrane potential is reset instantaneously to $-\\infty$ with zero refractory delay. Assume stationarity under constant $I$, so that a steady firing rate exists if and only if the time $T(I)$ it takes for $v(t)$ to evolve monotonically from $-\\infty$ to $+\\infty$ is finite.\n\nStarting from the definitions of the QIF dynamics and the interspike interval as the traversal time between reset and threshold, derive from first principles a closed-form expression for the steady-state frequency–current (F–I) curve $f(I)$, where $f(I) = \\frac{1}{T(I)}$ when $T(I)$ is finite and $f(I) = 0$ otherwise. Your derivation should establish the existence or non-existence of periodic spiking as a function of $I$, and compute $f(I)$ exactly when it exists by evaluating the appropriate time integral implied by the dynamics. Provide the final result as a single analytic expression for $f(I)$ that is valid for all $I \\in \\mathbb{R}$.\n\nState your final expression for $f(I)$ in closed form. No rounding is required and no units are needed, since the model is dimensionless. Additionally, justify in your reasoning why there is an absence of steady firing for $I \\le 0$.",
            "solution": "The problem statement is first validated against the established criteria.\n\n### Step 1: Extract Givens\n-   **Dynamics of Membrane Potential:** The dimensionless voltage $v$ evolves according to the ordinary differential equation (ODE) $\\frac{dv}{dt} = v^{2} + I$.\n-   **Input Current:** The input $I$ is a constant real number, $I \\in \\mathbb{R}$.\n-   **Spike and Reset Mechanism:** A spike occurs when $v(t)$ diverges to $+\\infty$. Immediately following a spike, $v(t)$ is reset to $-\\infty$. The refractory period is zero.\n-   **Interspike Interval (ISI):** The time for one full cycle, denoted $T(I)$, is the time it takes for $v(t)$ to evolve monotonically from $-\\infty$ to $+\\infty$. A steady firing rate exists if and only if $T(I)$ is finite.\n-   **Firing Rate (F-I Curve):** The steady-state frequency $f(I)$ is defined as $f(I) = \\frac{1}{T(I)}$ if $T(I)$ is finite, and $f(I) = 0$ otherwise.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded:** The problem describes the Quadratic Integrate-and-Fire (QIF) neuron, a canonical and widely studied model in computational neuroscience. It is a normal form for Type I neuron excitability. The dynamics and the task of deriving the F-I curve are standard and scientifically sound.\n-   **Well-Posed:** The problem is well-posed. The ODE is clearly defined, the initial and final conditions for the integration interval ($v \\to -\\infty$ and $v \\to +\\infty$) are specified, and the definition of the firing rate is unambiguous. A unique, stable, and meaningful solution exists.\n-   **Objective:** The language is precise and mathematical, free of subjective or ambiguous terminology.\n-   **Self-Contained and Consistent:** All necessary information to derive the F-I curve is provided within the problem statement. There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nThe derivation of the F-I curve, $f(I)$, proceeds by calculating the interspike interval, $T(I)$. The governing ODE is $\\frac{dv}{dt} = v^{2} + I$. We can separate variables to find the time $dt$ required for an infinitesimal change in voltage $dv$:\n$$\ndt = \\frac{dv}{v^{2} + I}\n$$\nThe total time $T(I)$ for the voltage to travel from the reset value $v = -\\infty$ to the spiking threshold $v = +\\infty$ is obtained by integrating this expression over the entire range of $v$:\n$$\nT(I) = \\int_{-\\infty}^{\\infty} \\frac{dv}{v^{2} + I}\n$$\nThe existence and value of this integral, and thus the existence of a finite firing rate, depend critically on the sign of the input current $I$. We analyze the problem by considering three cases for $I$.\n\n**Case 1: Excitatory Input ($I > 0$)**\nWhen $I$ is positive, the term $v^2 + I$ is strictly positive for all real $v$. This means $\\frac{dv}{dt} > 0$, and the voltage $v(t)$ increases monotonically for all time, ensuring that the trajectory starting from $v \\to -\\infty$ will eventually diverge to $v \\to +\\infty$. A periodic spiking regime exists.\n\nTo evaluate the integral for $T(I)$, we let $I = a^{2}$ where $a = \\sqrt{I}$ is a positive real number. The integral becomes:\n$$\nT(I) = \\int_{-\\infty}^{\\infty} \\frac{dv}{v^{2} + a^{2}}\n$$\nThis is a standard integral. The antiderivative of the integrand is $\\frac{1}{a} \\arctan\\left(\\frac{v}{a}\\right)$. We evaluate this at the limits of integration:\n$$\nT(I) = \\left[ \\frac{1}{a} \\arctan\\left(\\frac{v}{a}\\right) \\right]_{v=-\\infty}^{v=+\\infty} = \\frac{1}{a} \\left( \\lim_{v \\to \\infty} \\arctan\\left(\\frac{v}{a}\\right) - \\lim_{v \\to -\\infty} \\arctan\\left(\\frac{v}{a}\\right) \\right)\n$$\nUsing the known limits of the arctangent function, $\\arctan(x) \\to \\frac{\\pi}{2}$ as $x \\to \\infty$ and $\\arctan(x) \\to -\\frac{\\pi}{2}$ as $x \\to -\\infty$, we find:\n$$\nT(I) = \\frac{1}{a} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{1}{a} (\\pi) = \\frac{\\pi}{a}\n$$\nSubstituting back $a = \\sqrt{I}$, we get the interspike interval for $I > 0$:\n$$\nT(I) = \\frac{\\pi}{\\sqrt{I}}\n$$\nThe firing rate is the reciprocal of the ISI:\n$$\nf(I) = \\frac{1}{T(I)} = \\frac{\\sqrt{I}}{\\pi} \\quad \\text{for } I > 0\n$$\n\n**Case 2: Inhibitory Input ($I  0$)**\nThis case justifies the absence of steady firing for $I \\le 0$. When $I$ is negative, the dynamics change qualitatively. Let $I = -k^2$ for some positive real number $k = \\sqrt{-I}$. The ODE becomes:\n$$\n\\frac{dv}{dt} = v^2 - k^2 = (v-k)(v+k)\n$$\nThe system now has two fixed points, where $\\frac{dv}{dt} = 0$. These are $v_1 = -k = -\\sqrt{-I}$ and $v_2 = +k = +\\sqrt{-I}$.\n\nWe analyze the stability of these fixed points. Let $g(v) = v^2 - k^2$. The stability is determined by the sign of the derivative $g'(v) = 2v$ at the fixed points.\n-   At $v_1 = -k$, $g'(-k) = -2k  0$. This is a **stable** fixed point.\n-   At $v_2 = +k$, $g'(+k) = +2k > 0$. This is an **unstable** fixed point.\n\nThe neuron's voltage is reset to $v \\to -\\infty$. For any $v  -k$, we have $\\frac{dv}{dt} = (v-k)(v+k) > 0$ since both factors are negative. Therefore, the voltage increases from $-\\infty$. However, as $v(t)$ approaches the stable fixed point at $v_1 = -k = -\\sqrt{-I}$, its rate of change $\\frac{dv}{dt}$ approaches $0$. The voltage trajectory is trapped at this stable equilibrium. It can never cross this point to reach the region $v > -k$ and subsequently spike. The time to reach the spiking thresholddivergence is infinite.\nTherefore, for $I  0$, a spike is never generated, $T(I) = \\infty$, and the firing rate is, by definition, $f(I) = 0$.\n\n**Case 3: Zero Input ($I = 0$)**\nThis is the borderline case. The ODE is:\n$$\n\\frac{dv}{dt} = v^2\n$$\nThere is a single fixed point at $v=0$. For $v  0$, $\\frac{dv}{dt} = v^2 > 0$, so the voltage increases from its reset value of $-\\infty$. To determine the time it takes to reach $v=0$, we can integrate:\n$$\n\\Delta t = \\int_{v_0}^{v_f} \\frac{dv}{v^2} = \\left[ -\\frac{1}{v} \\right]_{v_0}^{v_f} = \\frac{1}{v_0} - \\frac{1}{v_f}\n$$\nThe time to travel from $v_0 = -\\infty$ to any finite negative value, say $v_f = -1$, is finite: $\\Delta t = \\lim_{v_0 \\to -\\infty} \\left( \\frac{1}{v_0} - \\frac{1}{-1} \\right) = 0+1 = 1$.\nHowever, the time to travel from $v_0 = -1$ to the fixed point at $v_f=0$ is:\n$$\n\\Delta t = \\lim_{v_f \\to 0^{-}} \\left( \\frac{1}{-1} - \\frac{1}{v_f} \\right) = -1 - (-\\infty) = \\infty\n$$\nThe voltage approaches $v=0$ asymptotically but never reaches it in finite time. The neuron gets stuck at $v=0$ and never spikes. Consequently, the interspike interval is infinite, $T(0) = \\infty$, and the firing rate is $f(0) = 0$.\n\n**Summary and Final Expression**\nCombining the results from all three cases:\n-   For $I > 0$, $f(I) = \\frac{\\sqrt{I}}{\\pi}$.\n-   For $I \\le 0$, $f(I) = 0$.\n\nThis piecewise function describes the complete F-I curve. It can be written as a single, continuous, closed-form expression for all $I \\in \\mathbb{R}$ by using the $\\max$ function, which captures the threshold behavior at $I=0$:\n$$\nf(I) = \\frac{\\sqrt{\\max(0, I)}}{\\pi}\n$$\nThis expression correctly yields $\\frac{\\sqrt{I}}{\\pi}$ for $I>0$ and $0$ for $I \\le 0$. The neuron fires only for suprathreshold (excitatory) currents, and its firing rate is proportional to the square root of the input current, a characteristic feature of Type I neuronal excitability.",
            "answer": "$$\n\\boxed{\\frac{\\sqrt{\\max(0, I)}}{\\pi}}\n$$"
        },
        {
            "introduction": "The analytical tractability of the QIF model opens the door to simulation techniques that are both exact and computationally efficient. By transforming the voltage dynamics into a phase variable using the theta-neuron mapping, the singularity at spike-time is removed, enabling an event-driven approach where spike times are calculated precisely instead of being approximated by small time steps . This practice explores this powerful method, challenging you to derive the analytical time-to-spike and build an event-driven scheduler that sidesteps the pitfalls of conventional numerical integration.",
            "id": "4056276",
            "problem": "Design an event-driven algorithm for the Quadratic Integrate-and-Fire (QIF) neuron model that leverages the analytical blow-up condition identified via the theta mapping. The QIF model is given by the scalar ordinary differential equation $dv/dt = v^2 + I$, where $v$ is the membrane potential and $I$ is a constant input current. In the QIF model, a spike occurs when $v$ experiences a finite-time blow-up to $+\\infty$, at which instant the state is reset to $v = -\\infty$ to continue the dynamics. The theta mapping defines the transformation $v = \\tan(\\theta/2)$, which maps the blow-up to the phase crossing $\\theta = \\pi$. The task is to derive an event-driven spike scheduler that detects spike times analytically—without small time steps—using this mapping and to quantify the numerical error of the method.\n\nStart from the following fundamental bases:\n\n- Deterministic dynamics are governed by ordinary differential equations and time-to-event is obtained by integrating the reciprocal of the vector field, that is, if $dv/dt = f(v)$ and the event occurs at $v = v_e$, then $t_{\\text{event}} = \\int_{v_0}^{v_e} dv/f(v)$, provided the integral converges.\n- The variable change $v = \\tan(\\theta/2)$ is invertible for $\\theta \\in (-\\pi, \\pi)$ and maps $v \\to +\\infty$ to $\\theta \\to \\pi$ and $v \\to -\\infty$ to $\\theta \\to -\\pi$.\n- The chain rule gives $d\\theta/dt = (dv/dt) / (dv/d\\theta)$.\n\nYour algorithm must:\n\n1. Derive the analytical detection condition for the spike time using the theta mapping $v = \\tan(\\theta/2)$, expressing $d\\theta/dt$ in terms of $\\theta$ and $I$ and identifying the integral for the time-to-spike $t_{\\text{spike}}$ starting from an initial phase $\\theta_0 = 2 \\arctan(v_0)$.\n2. For $I  0$, derive a closed-form expression for the first spike time $t_{\\text{spike}}$ from a finite initial potential $v_0$, and derive the constant interspike interval $T(I)$ for the periodic spike train that follows the reset $v = -\\infty$.\n3. For $I = 0$, determine the condition under which a spike occurs and derive the corresponding closed-form expression for $t_{\\text{spike}}$ when applicable.\n4. For $I  0$, characterize the excitable regime and derive a closed-form expression for $t_{\\text{spike}}$ when the initial potential $v_0$ is sufficiently large to produce a finite-time blow-up. Also state when no spike occurs in forward time.\n5. Quantify the numerical error of your event-driven schedule by comparing the analytically computed times to a numerical quadrature of the theta integral for cases without singularities. Express error as the maximum absolute difference between the analytical times and the numerical quadrature times.\n\nYour program must implement the event-driven scheduler as follows:\n\n- For $I  0$, compute the first spike time $t_1$ analytically and the interspike interval $T(I)$; then generate all spike times $t_1, t_1 + T(I), t_1 + 2 T(I), \\ldots$ that do not exceed a given horizon $T_{\\text{end}}$.\n- For $I = 0$, compute the first spike time if it exists; there is no periodic spiking.\n- For $I  0$, compute the first spike time only if it exists; there is no periodic spiking.\n- For error quantification, use numerical quadrature on the theta integral when it is non-singular, and compute the maximum absolute error across available comparisons.\n\nAngle units must be radians. Time units must be seconds. Express all times and errors in seconds as floating-point numbers.\n\nTest Suite:\nUse the following parameter sets, each as a triplet $(I, v_0, T_{\\text{end}})$:\n\n- Case A (positive input): $(0.5, 0.0, 10.0)$\n- Case B (small positive input): $(0.001, 0.1, 1000.0)$\n- Case C (zero input, excitable): $(0.0, 1.0, 3.0)$\n- Case D (negative input, supra-threshold initial condition): $(-0.5, 1.0, 10.0)$\n- Case E (negative input, at threshold): $(-0.5, 0.70710678, 10.0)$\n\nRequired final output format:\n\n- For each test case, return a list arranged as $[N, t_1, t_2, \\ldots, t_N, E]$, where $N$ is the integer number of spikes scheduled within $[0, T_{\\text{end}}]$, $t_k$ are the spike times in seconds in ascending order, and $E$ is the maximum absolute error in seconds computed by comparing analytical times to those obtained via numerical quadrature in the theta domain whenever applicable. If no spikes occur, return $[0, E]$ with $E = 0.0$ if the quadrature is not applicable or yields no comparison.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result_case_A,result_case_B,result_case_C,result_case_D,result_case_E]\").",
            "solution": "The problem requires the design of an event-driven algorithm for the Quadratic Integrate-and-Fire (QIF) neuron model based on an analytical solution derived via the theta mapping.\n\nThe problem is scientifically grounded, well-posed, and objective. The QIF model is a canonical representation in computational neuroscience, and the use of the theta mapping is a standard analytical technique. All constants, variables, and conditions are explicitly defined, creating a self-contained and solvable problem. No violations of scientific principles, factual inaccuracies, or logical inconsistencies are present.\n\nWe proceed with the derivation and implementation.\n\n**1. Derivation of the Theta-Neuron Model**\n\nThe dynamics of the QIF neuron are given by the ordinary differential equation:\n$$\n\\frac{dv}{dt} = v^2 + I\n$$\nwhere $v$ is the membrane potential and $I$ is a constant input current. A spike is defined as the moment $v$ reaches $+\\infty$. The state is then reset to $v = -\\infty$.\n\nWe introduce the theta mapping, a change of variables defined by $v = \\tan(\\theta/2)$. This transformation maps the potential range $v \\in (-\\infty, +\\infty)$ to the phase range $\\theta \\in (-\\pi, \\pi)$. The spike at $v \\to +\\infty$ corresponds to $\\theta \\to \\pi$, and the reset at $v \\to -\\infty$ corresponds to $\\theta \\to -\\pi$. The initial phase $\\theta_0$ is related to the initial potential $v_0$ by $\\theta_0 = 2 \\arctan(v_0)$.\n\nTo find the dynamics in the $\\theta$ variable, we use the chain rule:\n$$\n\\frac{d\\theta}{dt} = \\frac{dv}{dt} \\frac{d\\theta}{dv} = \\frac{dv}{dt} \\left( \\frac{dv}{d\\theta} \\right)^{-1}\n$$\nFirst, we compute $dv/d\\theta$:\n$$\n\\frac{dv}{d\\theta} = \\frac{d}{d\\theta} \\tan\\left(\\frac{\\theta}{2}\\right) = \\frac{1}{2} \\sec^2\\left(\\frac{\\theta}{2}\\right)\n$$\nUsing the trigonometric identity $\\sec^2(x) = 1 + \\tan^2(x)$, and substituting $v = \\tan(\\theta/2)$, we get:\n$$\n\\frac{dv}{d\\theta} = \\frac{1}{2} \\left(1 + \\tan^2\\left(\\frac{\\theta}{2}\\right)\\right) = \\frac{1}{2}(1 + v^2)\n$$\nNow, substituting this and the QIF dynamics into the chain rule expression:\n$$\n\\frac{d\\theta}{dt} = (v^2 + I) \\left( \\frac{1}{2}(1 + v^2) \\right)^{-1} = \\frac{2(v^2 + I)}{1 + v^2}\n$$\nTo express this purely in terms of $\\theta$, we substitute $v = \\tan(\\theta/2)$ and use $1+v^2 = 1+\\tan^2(\\theta/2) = \\sec^2(\\theta/2)$:\n$$\n\\frac{d\\theta}{dt} = \\frac{2(\\tan^2(\\theta/2) + I)}{\\sec^2(\\theta/2)} = 2\\cos^2\\left(\\frac{\\theta}{2}\\right) \\left(\\tan^2\\left(\\frac{\\theta}{2}\\right) + I\\right) = 2\\left(\\sin^2\\left(\\frac{\\theta}{2}\\right) + I\\cos^2\\left(\\frac{\\theta}{2}\\right)\\right)\n$$\nUsing the half-angle identities $\\sin^2(\\theta/2) = (1-\\cos\\theta)/2$ and $\\cos^2(\\theta/2) = (1+\\cos\\theta)/2$:\n$$\n\\frac{d\\theta}{dt} = 2\\left(\\frac{1 - \\cos\\theta}{2} + I\\frac{1 + \\cos\\theta}{2}\\right) = (1 - \\cos\\theta) + I(1 + \\cos\\theta)\n$$\nThis simplifies to the canonical form of the theta-neuron model:\n$$\n\\frac{d\\theta}{dt} = (1+I) - (1-I)\\cos\\theta\n$$\n\n**2. Derivation of the Time-to-Spike**\n\nThe time-to-spike, $t_{\\text{spike}}$, is the time required for the phase to evolve from an initial value $\\theta_0$ to the threshold $\\pi$. We find this by integrating the reciprocal of the vector field:\n$$\nt_{\\text{spike}} = \\int_{t_0}^{t_{\\text{spike}}} dt = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{(1+I) - (1-I)\\cos\\theta}\n$$\nWe solve this integral for the three cases of $I$: $I0$, $I=0$, and $I0$.\n\n**Case 1: Suprathreshold Current ($I  0$)**\nThe neuron spikes periodically. The integrand is of the form $\\int d\\theta / (a+b\\cos\\theta)$ with $a = 1+I$ and $b = -(1-I)$. The condition $a^2  b^2$ holds, since $a^2 - b^2 = (1+I)^2 - (1-I)^2 = 4I  0$. The standard solution to this integral is:\n$$\n\\int \\frac{d\\theta}{a+b\\cos\\theta} = \\frac{1}{\\sqrt{I}} \\arctan\\left(\\frac{\\tan(\\theta/2)}{\\sqrt{I}}\\right)\n$$\nThe first spike time $t_1$, starting from $v_0$ (and thus $\\theta_0=2\\arctan(v_0)$), is:\n$$\nt_1 = \\left[ \\frac{1}{\\sqrt{I}} \\arctan\\left(\\frac{\\tan(\\theta/2)}{\\sqrt{I}}\\right) \\right]_{\\theta_0}^{\\pi} = \\frac{1}{\\sqrt{I}} \\left( \\lim_{\\theta\\to\\pi^-} \\arctan\\left(\\frac{\\tan(\\theta/2)}{\\sqrt{I}}\\right) - \\arctan\\left(\\frac{\\tan(\\theta_0/2)}{\\sqrt{I}}\\right) \\right)\n$$\nAs $\\theta \\to \\pi^-$, $\\tan(\\theta/2) \\to +\\infty$, so the arctan term approaches $\\pi/2$. Thus:\n$$\nt_1 = \\frac{1}{\\sqrt{I}} \\left( \\frac{\\pi}{2} - \\arctan\\left(\\frac{v_0}{\\sqrt{I}}\\right) \\right)\n$$\nThe interspike interval, $T(I)$, is the time to go from reset ($v=-\\infty$, $\\theta=-\\pi$) to spike ($v=+\\infty$, $\\theta=\\pi$):\n$$\nT(I) = \\int_{-\\pi}^{\\pi} \\frac{d\\theta}{(1+I) - (1-I)\\cos\\theta} = \\frac{1}{\\sqrt{I}} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{\\pi}{\\sqrt{I}}\n$$\n\n**Case 2: Zero Current ($I = 0$)**\nThe dynamics simplify to $dv/dt = v^2$. A spike occurs only if $v_0  0$, as the potential would otherwise decrease or remain at $0$. The theta dynamics become $d\\theta/dt = 1 - \\cos\\theta$. The time-to-spike is:\n$$\nt_1 = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{1 - \\cos\\theta} = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{2\\sin^2(\\theta/2)} = \\frac{1}{2} \\int_{\\theta_0}^{\\pi} \\csc^2(\\theta/2) d\\theta\n$$\n$$\nt_1 = \\left[ -\\cot\\left(\\frac{\\theta}{2}\\right) \\right]_{\\theta_0}^{\\pi} = -\\cot\\left(\\frac{\\pi}{2}\\right) - \\left(-\\cot\\left(\\frac{\\theta_0}{2}\\right)\\right) = 0 + \\cot\\left(\\frac{\\theta_0}{2}\\right) = \\frac{1}{\\tan(\\theta_0/2)} = \\frac{1}{v_0}\n$$\nThis result is valid for $v_0  0$. If $v_0 \\le 0$, no spike occurs. There is no periodic spiking.\n\n**Case 3: Subthreshold Current ($I  0$)**\nThe system is excitable. The equation $v^2+I=0$ has two fixed points at $v = \\pm\\sqrt{-I}$. The point $v_{th} = \\sqrt{-I}$ is an unstable fixed point (threshold), and $v_{st} = -\\sqrt{-I}$ is a stable fixed point. A spike occurs only if the initial potential $v_0$ is greater than the threshold, i.e., $v_0  \\sqrt{-I}$. If $v_0 \\le \\sqrt{-I}$, the potential decays to the stable fixed point and no spike occurs.\n\nFor $v_0  \\sqrt{-I}$, we solve the time-to-spike integral. Let $k = \\sqrt{-I}$. The theta dynamics are $d\\theta/dt = (1-k^2) - (1+k^2)\\cos\\theta$. The integral is:\n$$\nt_1 = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{(1-k^2) - (1+k^2)\\cos\\theta}\n$$\nThis integral, valid for $v_0  k$, can be solved using hyperbolic functions, yielding:\n$$\nt_1 = \\frac{1}{k} \\operatorname{arccoth}\\left(\\frac{v_0}{k}\\right) = \\frac{1}{2k} \\ln\\left(\\frac{v_0+k}{v_0-k}\\right)\n$$\nSubstituting $k = \\sqrt{-I}$:\n$$\nt_1 = \\frac{1}{2\\sqrt{-I}} \\ln\\left( \\frac{v_0 + \\sqrt{-I}}{v_0 - \\sqrt{-I}} \\right)\n$$\nThis is valid only if $v_0  \\sqrt{-I}$. There is no periodic spiking.\n\n**3. Error Quantification**\n\nThe numerical error is quantified by comparing the analytical expressions for spike times with results from numerical quadrature of the theta integral. The integral for the time-to-spike is proper, as the denominator $(1+I)-(1-I)\\cos\\theta$ evaluates to $2$ at $\\theta=\\pi$, thus avoiding a singularity at the integration endpoint. We use `scipy.integrate.quad` to compute the numerical value of the integral for $t_1$ (from $\\theta_0$ to $\\pi$) and, where applicable, for $T(I)$ (from $-\\pi$ to $\\pi$). The error for each test case, $E$, is the maximum absolute difference between the analytically and numerically computed times for that case. If no spikes occur, or if numerical integration is not performed (e.g., at threshold), the error is $0$.\n\n**Algorithm Summary**\nFor a given set of parameters $(I, v_0, T_{\\text{end}})$:\n1.  Determine the case based on the sign of $I$.\n2.  If $I  0$: Calculate $t_1$ and $T(I)$ using the derived formulas. Generate all spike times $t_1, t_1+T(I), t_1+2T(I), \\dots$ that are less than or equal to $T_{\\text{end}}$.\n3.  If $I = 0$: Check if $v_0  0$. If so, calculate $t_1 = 1/v_0$. If $t_1 \\le T_{\\text{end}}$, record it.\n4.  If $I  0$: Check if $v_0  \\sqrt{-I}$. If so, calculate $t_1$ using the derived formula. If $t_1 \\le T_{\\text{end}}$, record it.\n5.  For each analytically computed time ($t_1$ and/or $T(I)$), also compute its value via numerical quadrature of the corresponding theta integral.\n6.  Calculate the absolute difference for each pair of analytical/numerical times. The error $E$ is the maximum of these differences.\n7.  Return the results in the format $[N, t_1, \\dots, t_N, E]$. If no spikes, return $[0, E]$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Designs an event-driven algorithm for the QIF neuron model.\n    \"\"\"\n    # Test cases: (I, v0, T_end)\n    test_cases = [\n        (0.5, 0.0, 10.0),       # Case A: Positive input\n        (0.001, 0.1, 1000.0),    # Case B: Small positive input\n        (0.0, 1.0, 3.0),        # Case C: Zero input, excitable\n        (-0.5, 1.0, 10.0),      # Case D: Negative input, supra-threshold\n        (-0.5, 0.70710678, 10.0) # Case E: Negative input, at threshold\n    ]\n\n    all_results = []\n\n    for I, v0, T_end in test_cases:\n        spikes = []\n        errors = []\n        \n        # Calculate initial phase\n        theta0 = 2 * np.arctan(v0)\n\n        # Case 1: I  0 (Suprathreshold, periodic spiking)\n        if I > 0:\n            sqrt_I = np.sqrt(I)\n            \n            # Analytical calculation\n            t1_analyt = (0.5 * np.pi - np.arctan(v0 / sqrt_I)) / sqrt_I\n            T_analyt = np.pi / sqrt_I\n            \n            # Numerical calculation for error\n            integrand = lambda theta: 1.0 / ((1 + I) - (1 - I) * np.cos(theta))\n            t1_num, _ = integrate.quad(integrand, theta0, np.pi)\n            T_num, _ = integrate.quad(integrand, -np.pi, np.pi)\n            \n            errors.append(abs(t1_analyt - t1_num))\n            errors.append(abs(T_analyt - T_num))\n            \n            # Generate spike train\n            current_spike_time = t1_analyt\n            while current_spike_time = T_end:\n                spikes.append(current_spike_time)\n                current_spike_time += T_analyt\n\n        # Case 2: I = 0 (Spike if v0  0)\n        elif I == 0:\n            if v0 > 0:\n                # Analytical calculation\n                t1_analyt = 1.0 / v0\n                \n                # Numerical calculation for error\n                integrand = lambda theta: 1.0 / (1.0 - np.cos(theta))\n                t1_num, _ = integrate.quad(integrand, theta0, np.pi)\n                \n                errors.append(abs(t1_analyt - t1_num))\n\n                # Generate spike (at most one)\n                if t1_analyt = T_end:\n                    spikes.append(t1_analyt)\n            \n        # Case 3: I  0 (Excitable, spike if v0  threshold)\n        else: # I  0\n            sqrt_neg_I = np.sqrt(-I)\n            \n            # Spike only if v0 is strictly greater than the threshold\n            # A small tolerance helps with floating point representation issues.\n            if v0 > sqrt_neg_I + 1e-12:\n                # Analytical calculation\n                t1_analyt = (1.0 / (2.0 * sqrt_neg_I)) * np.log((v0 + sqrt_neg_I) / (v0 - sqrt_neg_I))\n                \n                # Numerical calculation for error\n                integrand = lambda theta: 1.0 / ((1 + I) - (1 - I) * np.cos(theta))\n                t1_num, _ = integrate.quad(integrand, theta0, np.pi)\n                \n                errors.append(abs(t1_analyt - t1_num))\n                \n                # Generate spike (at most one)\n                if t1_analyt = T_end:\n                    spikes.append(t1_analyt)\n\n        # Format output for the current case\n        N = len(spikes)\n        E = max(errors) if errors else 0.0\n        \n        result_list = [N] + spikes + [E]\n        all_results.append(str(result_list))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While some models like the QIF are analytically solvable, many powerful models, including the Exponential Integrate-and-Fire (EIF) neuron, are not. Simulating these models requires numerical methods, which can introduce subtle but significant errors. The EIF model's sharp, nonlinear spike initiation mechanism makes it particularly susceptible to errors where a standard fixed-step Euler integrator can 'step over' a spike, failing to detect it entirely . This exercise delves into this critical practical issue, asking you to derive the conditions under which spikes are missed and to determine the constraints on the simulation time step required to guarantee accurate spike detection.",
            "id": "4056299",
            "problem": "Consider the Exponential Integrate-and-Fire (EIF) neuron model under constant input, with membrane potential $V(t)$ evolving according to the canonical membrane ordinary differential equation\n$$\n\\frac{dV}{dt} = F(V),\n$$\nwhere $F(V)$ is continuously differentiable, strictly increasing for $V \\geq V_T$ due to the exponential spike-initiation current, and contains the exponential term that dominates the dynamics near the spike onset. In the EIF regime above $V_T$, a scientifically justified asymptotic simplification is to retain only the exponential spike-initiation current, yielding the reduced flow\n$$\n\\frac{dV}{dt} = \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right),\n$$\nwhere $\\tau_m$ is the membrane time constant (in seconds), $V_T$ is the intrinsic threshold (in volts), and $\\Delta_T$ is the slope factor (in volts). Assume a spike is detected when $V(t)$ first reaches a finite peak cutoff $V_p$ (in volts), with $V_p  V_T$. A numerical scheme that is widely used is the naive explicit Euler method,\n$$\nV_{n+1} = V_n + \\Delta t \\, F(V_n),\n$$\napplied at discrete times $t_n = n\\Delta t$, where $\\Delta t$ is the fixed time step (in seconds), and a spike is flagged only if $V_{n+1} \\geq V_p$.\n\nYour task is to derive, from first principles, a mathematically rigorous argument that shows there exist parameter regimes for large $\\Delta_T$ in which the naive explicit Euler method can miss a spike that occurs in continuous time during a step, because the Euler update uses the left-end slope $F(V_n)$ and underestimates the true growth on an interval where $F(V)$ is increasing and convex. Then, derive bounds on $\\Delta t$ that guarantee spike detection in this reduced EIF regime. The derivation must start from the separable structure of the reduced flow above $V_T$ and reason about the exact crossing time from a starting voltage $V_0 \\in [V_T, V_p)$ to the cutoff $V_p$, and compare it to the Euler crossing criterion needed for $V_{n+1} \\geq V_p$.\n\nAfter deriving the bounds, implement a program that, for each parameter set in the test suite below, computes:\n- The exact continuous-time crossing time $t_{\\text{cross}}$ (in seconds) for the reduced EIF flow from $V_0$ to $V_p$.\n- The minimal Euler step size $\\Delta t_{\\min}$ (in seconds) such that the naive explicit Euler update starting at $V_0$ satisfies $V_{n+1} \\geq V_p$.\n- A boolean $b_{\\text{miss}}$ indicating whether a spike is missed by the naive Euler method when the chosen $\\Delta t$ is such that the continuous system crosses within the step but the Euler update does not detect it, i.e., $b_{\\text{miss}}$ is true if and only if $\\Delta t \\geq t_{\\text{cross}}$ and $\\Delta t  \\Delta t_{\\min}$.\n\nUse the following scientifically plausible test suite that spans happy-path, boundary, and edge-case regimes. All voltages are in volts and all times are in seconds.\n\nTest suite cases specified as $(\\tau_m, \\Delta_T, V_T, V_p, V_0, \\Delta t)$:\n1. $(0.010, 0.020, -0.050, -0.020, -0.045, 0.007)$\n2. $(0.010, 0.020, -0.050, -0.020, -0.035, 0.004)$\n3. $(0.010, 0.002, -0.050, -0.020, -0.050, 0.200)$\n4. $(0.010, 0.020, -0.050, -0.020, -0.045, t_{\\text{cross}})$ where $t_{\\text{cross}}$ is the exact crossing time computed from the same parameters; use its numerical value as $\\Delta t$.\n5. $(0.010, 0.020, -0.050, -0.020, -0.045, \\Delta t_{\\min})$ where $\\Delta t_{\\min}$ is the minimal step guaranteeing detection computed from the same parameters; use its numerical value as $\\Delta t$.\n\nFor each case, your program must compute $t_{\\text{cross}}$, $\\Delta t_{\\min}$, and $b_{\\text{miss}}$ according to your derived formulas for the reduced EIF flow and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a list of the form $[b_{\\text{miss}}, t_{\\text{cross}}, \\Delta t_{\\min}]$. All time quantities must be expressed in seconds as floating-point numbers. For example, the final line should look like:\n$[[\\text{boolean}, \\text{float}, \\text{float}], [\\text{boolean}, \\text{float}, \\text{float}], \\ldots]$.",
            "solution": "The Exponential Integrate-and-Fire (EIF) model captures spike initiation via an exponential nonlinearity. In the spike-onset regime above $V_T$, the exponential term dominates and the reduced flow\n$$\n\\frac{dV}{dt} = \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right)\n$$\nprovides a lower-bounded approximation to the full dynamics with leak and constant input, by standard comparison arguments for ordinary differential equations. The reduced flow is separable, strictly increasing in $V$, and convex for $V \\geq V_T$ because\n$$\n\\frac{d}{dV}\\left(\\frac{dV}{dt}\\right) = \\frac{1}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right) > 0,\n\\quad\n\\frac{d^2}{dV^2}\\left(\\frac{dV}{dt}\\right) = \\frac{1}{\\tau_m \\Delta_T}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right) > 0.\n$$\nWe derive the exact crossing time from $V_0 \\in [V_T, V_p)$ to the cutoff $V_p$ for the reduced flow. Treating $V$ as a function of $t$ and separating variables yields\n$$\n\\int_{V_0}^{V_p} \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\, dV\n= \\int_0^{t_{\\text{cross}}} \\frac{\\Delta_T}{\\tau_m} \\, dt.\n$$\nThe left-hand side integrates to\n$$\n\\int_{V_0}^{V_p} \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\, dV\n= -\\Delta_T \\left[ \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\right]_{V_0}^{V_p}\n= \\Delta_T \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right).\n$$\nThe right-hand side integrates to $(\\Delta_T/\\tau_m)\\, t_{\\text{cross}}$. Equating both sides, we obtain the exact continuous-time crossing\n$$\nt_{\\text{cross}}(V_0 \\to V_p)\n= \\tau_m \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right).\n$$\nWe now analyze the naive explicit Euler method for one step from $V_0$:\n$$\nV_{n+1}\n= V_0 + \\Delta t \\, \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right).\n$$\nA spike is detected in the discrete scheme at the end of the step if and only if $V_{n+1} \\geq V_p$, which imposes the inequality\n$$\n\\Delta t \\, \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right) \\geq V_p - V_0.\n$$\nSolving for $\\Delta t$ defines the minimal step size guaranteeing end-of-step detection in the naive Euler scheme:\n$$\n\\Delta t_{\\min}(V_0)\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}.\n$$\nWe compare $t_{\\text{cross}}$ with $\\Delta t_{\\min}(V_0)$. Because the flow is increasing and convex for $V \\geq V_T$, the function $F(V) = (\\Delta_T/\\tau_m)\\exp((V - V_T)/\\Delta_T)$ increases with $V$, hence $1/F(V)$ decreases with $V$. The exact crossing time can be written as\n$$\nt_{\\text{cross}} = \\int_{V_0}^{V_p} \\frac{dV}{F(V)}.\n$$\nSince $1/F(V)$ is decreasing, we have the standard monotone integral bound\n$$\n\\int_{V_0}^{V_p} \\frac{dV}{F(V)}\n\\leq \\frac{V_p - V_0}{F(V_0)}\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}\n= \\Delta t_{\\min}(V_0).\n$$\nTherefore,\n$$\nt_{\\text{cross}} \\leq \\Delta t_{\\min}(V_0),\n$$\nwith strict inequality whenever $F(V)$ is strictly increasing on $[V_0, V_p)$, which holds for $V_0 > V_T$. This inequality precisely characterizes the regime where naive Euler can miss spikes: if the chosen $\\Delta t$ satisfies\n$$\nt_{\\text{cross}} \\leq \\Delta t  \\Delta t_{\\min}(V_0),\n$$\nthen the continuous system reaches $V_p$ within the step, while the Euler update underestimates the growth by using the left-end slope $F(V_0)$ and remains below $V_p$. In this situation, the spike is missed at the end of the step. The width of this miss interval,\n$$\n\\Delta t_{\\min}(V_0) - t_{\\text{cross}}\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}\n- \\tau_m \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right),\n$$\nincreases with the slope factor $\\Delta_T$ for starting voltages sufficiently close to $V_T$, reflecting that larger $\\Delta_T$ increases the amplitude factor in the flow while decreasing the exponential sensitivity to $V$, thereby widening the gap between the left-end linear extrapolation and the exact integral across the convex, increasing flow.\n\nBounds on the time step that guarantee spike detection in the straddling step follow immediately: for a given $V_0$,\n$$\n\\Delta t \\geq \\Delta t_{\\min}(V_0)\n$$\nensures $V_{n+1} \\geq V_p$ and thus detection at the end of the step. To obtain a state-independent conservative bound over a band $V_0 \\in [V_T, V_b]$ with $V_b  V_p$, one may choose\n$$\n\\Delta t \\geq \\sup_{V_0 \\in [V_T, V_b]} \\Delta t_{\\min}(V_0),\n$$\nthough this is typically impractical due to its magnitude near $V_T$. In practice, adaptive stepping or event detection is preferred, but within the naive fixed-step Euler framework the derived $\\Delta t_{\\min}(V_0)$ provides the exact threshold for per-step detection in the reduced EIF regime.\n\nAlgorithmic design for the program:\n- For each test case, compute $x_0 = (V_0 - V_T)/\\Delta_T$ and $x_p = (V_p - V_T)/\\Delta_T$.\n- Compute\n$$\nt_{\\text{cross}} = \\tau_m\\left(e^{-x_0} - e^{-x_p}\\right),\n\\quad\n\\Delta t_{\\min} = \\frac{(V_p - V_0)\\tau_m}{\\Delta_T e^{x_0}}.\n$$\n- Given the case’s $\\Delta t$, set the miss boolean\n$$\nb_{\\text{miss}} = \\left(\\Delta t \\geq t_{\\text{cross}}\\right) \\wedge \\left(\\Delta t  \\Delta t_{\\min}\\right).\n$$\n- For boundary cases where $\\Delta t$ is specified as $t_{\\text{cross}}$ or $\\Delta t_{\\min}$, first compute the value and then use it as $\\Delta t$.\n- Aggregate outputs as $[b_{\\text{miss}}, t_{\\text{cross}}, \\Delta t_{\\min}]$ for each case, in seconds for time entries.\n\nThis principled approach directly ties the guarantee of spike detection under naive explicit Euler to the separable structure of the reduced EIF flow and the convexity-induced gap between the exact integral of $1/F(V)$ and its left-endpoint Riemann approximation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_crossing_time(tau_m, delta_T, V_T, V_p, V0):\n    # t_cross = tau_m * (exp(-(V0 - V_T)/delta_T) - exp(-(V_p - V_T)/delta_T))\n    x0 = (V0 - V_T) / delta_T\n    xp = (V_p - V_T) / delta_T\n    return tau_m * (np.exp(-x0) - np.exp(-xp))\n\ndef compute_dt_min(tau_m, delta_T, V_T, V_p, V0):\n    # dt_min = (V_p - V0) * tau_m / (delta_T * exp((V0 - V_T)/delta_T))\n    x0 = (V0 - V_T) / delta_T\n    denom = delta_T * np.exp(x0)\n    return (V_p - V0) * tau_m / denom\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (tau_m, delta_T, V_T, V_p, V0, dt)\n    # Units: tau_m [s], delta_T [V], V_T [V], V_p [V], V0 [V], dt [s]\n    tau_m = 0.010  # 10 ms\n    cases = [\n        # 1. (0.010, 0.020, -0.050, -0.020, -0.045, 0.007)\n        (0.010, 0.020, -0.050, -0.020, -0.045, 0.007),\n        # 2. (0.010, 0.020, -0.050, -0.020, -0.035, 0.004)\n        (0.010, 0.020, -0.050, -0.020, -0.035, 0.004),\n        # 3. (0.010, 0.002, -0.050, -0.020, -0.050, 0.200)\n        (0.010, 0.002, -0.050, -0.020, -0.050, 0.200),\n        # 4. (0.010, 0.020, -0.050, -0.020, -0.045, t_cross)\n        # Placeholder dt; will be replaced by t_cross computed\n        (0.010, 0.020, -0.050, -0.020, -0.045, None),\n        # 5. (0.010, 0.020, -0.050, -0.020, -0.045, dt_min)\n        # Placeholder dt; will be replaced by dt_min computed\n        (0.010, 0.020, -0.050, -0.020, -0.045, None),\n    ]\n\n    results = []\n    for idx, case in enumerate(cases):\n        tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i, dt_i = case\n\n        t_cross = compute_crossing_time(tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i)\n        dt_min = compute_dt_min(tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i)\n\n        # For cases 4 and 5, substitute dt as specified (t_cross or dt_min)\n        if idx == 3:\n            dt_i = t_cross\n        if idx == 4:\n            dt_i = dt_min\n\n        # Missed spike occurs if exact crossing happens within step but Euler does not detect\n        missed = (dt_i >= t_cross) and (dt_i  dt_min)\n\n        results.append([bool(missed), float(t_cross), float(dt_min)])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}