{
    "hands_on_practices": [
        {
            "introduction": "神经元的频率-电流（F-I）曲线是其最基本的输入-输出关系的特征。本练习将从第一性原理出发，推导二次整合发放（QIF）模型的 F-I 曲线 ()。通过求解描述电压从重置到发放阈值所需时间的积分，您将揭示 QIF 模型作为 I 型神经元的标志性特征，即其发放频率与超阈值输入电流的平方根成正比。",
            "id": "4056267",
            "problem": "考虑一个由恒定输入电流 $I \\in \\mathbb{R}$ 驱动的无量纲二次积分发放 (Quadratic Integrate-and-Fire, QIF) 神经元，其膜电位动力学由 $ \\frac{dv}{dt} = v^{2} + I$ 定义。当 $v(t)$ 发散到 $+\\infty$ 时，定义为发生一次脉冲，之后膜电位瞬时重置到 $-\\infty$，且不应期延迟为零。假设在恒定 $I$ 下系统处于稳态，因此，稳态发放率存在当且仅当 $v(t)$ 从 $-\\infty$ 单调演化到 $+\\infty$ 所需的时间 $T(I)$ 是有限的。\n\n从 QIF 动力学和作为重置与阈值之间穿越时间的脉冲间期的定义出发，从第一性原理推导稳态频率-电流 (F-I) 曲线 $f(I)$ 的闭式表达式，其中当 $T(I)$ 有限时 $f(I) = \\frac{1}{T(I)}$，否则 $f(I) = 0$。你的推导应确定周期性脉冲发放作为 $I$ 的函数的存在性，并在其存在时通过计算动力学所蕴含的适当时间积分来精确计算 $f(I)$。以对所有 $I \\in \\mathbb{R}$ 都有效的单个解析表达式的形式给出最终结果。\n\n以闭式形式陈述你对 $f(I)$ 的最终表达式。由于模型是无量纲的，因此不需要四舍五入，也不需要单位。此外，在你的推理中证明为何在 $I \\le 0$ 时不存在稳态发放。",
            "solution": "首先根据既定标准对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   **膜电位动力学：** 无量纲电压 $v$ 根据常微分方程 (ODE) $\\frac{dv}{dt} = v^{2} + I$ 演化。\n-   **输入电流：** 输入 $I$ 是一个恒定的实数，$I \\in \\mathbb{R}$。\n-   **脉冲和重置机制：** 当 $v(t)$ 发散到 $+\\infty$ 时，发生一次脉冲。紧随脉冲之后，$v(t)$ 被重置为 $-\\infty$。不应期为零。\n-   **脉冲间期 (ISI)：** 一个完整周期的时间，记为 $T(I)$，是 $v(t)$ 从 $-\\infty$ 单调演化到 $+\\infty$ 所需的时间。稳态发放率存在当且仅当 $T(I)$ 是有限的。\n-   **发放率 (F-I 曲线)：** 稳态频率 $f(I)$ 定义为：如果 $T(I)$ 是有限的，则 $f(I) = \\frac{1}{T(I)}$，否则 $f(I) = 0$。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据：** 问题描述了二次积分发放 (QIF) 神经元，这是计算神经科学中一个典型且被广泛研究的模型。它是 I 型神经元兴奋性的范式。动力学和推导 F-I 曲线的任务都是标准的，并且在科学上是合理的。\n-   **良态的：** 问题是良态的。ODE 定义清晰，积分区间的初始和最终条件（$v \\to -\\infty$ 和 $v \\to +\\infty$）已指定，发放率的定义明确。存在一个唯一的、稳定的、有意义的解。\n-   **客观性：** 语言精确且数学化，没有主观或模糊的术语。\n-   **自洽性和一致性：** 推导 F-I 曲线所需的所有信息都在问题陈述中提供。没有矛盾之处。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\nF-I 曲线 $f(I)$ 的推导通过计算脉冲间期 $T(I)$ 来进行。控制 ODE 是 $\\frac{dv}{dt} = v^{2} + I$。我们可以分离变量来求得电压发生无穷小变化 $dv$ 所需的时间 $dt$：\n$$\ndt = \\frac{dv}{v^{2} + I}\n$$\n电压从重置值 $v = -\\infty$ 移动到脉冲阈值 $v = +\\infty$ 所需的总时间 $T(I)$，可以通过对该表达式在 $v$ 的整个范围内积分得到：\n$$\nT(I) = \\int_{-\\infty}^{\\infty} \\frac{dv}{v^{2} + I}\n$$\n该积分的存在与否及其值，以及因此有限发放率的存在与否，都关键地取决于输入电流 $I$ 的符号。我们通过考虑 $I$ 的三种情况来分析这个问题。\n\n**情况 1：兴奋性输入 ($I > 0$)**\n当 $I$ 为正时，对于所有实数 $v$，$v^2 + I$ 这一项是严格为正的。这意味着 $\\frac{dv}{dt} > 0$，电压 $v(t)$ 始终单调增加，确保从 $v \\to -\\infty$ 开始的轨迹最终会发散到 $v \\to +\\infty$。存在一个周期性的脉冲发放机制。\n\n为了计算 $T(I)$ 的积分，我们令 $I = a^{2}$，其中 $a = \\sqrt{I}$ 是一个正实数。积分为：\n$$\nT(I) = \\int_{-\\infty}^{\\infty} \\frac{dv}{v^{2} + a^{2}}\n$$\n这是一个标准积分。被积函数的原函数是 $\\frac{1}{a} \\arctan\\left(\\frac{v}{a}\\right)$。我们在积分极限处计算其值：\n$$\nT(I) = \\left[ \\frac{1}{a} \\arctan\\left(\\frac{v}{a}\\right) \\right]_{v=-\\infty}^{v=+\\infty} = \\frac{1}{a} \\left( \\lim_{v \\to \\infty} \\arctan\\left(\\frac{v}{a}\\right) - \\lim_{v \\to -\\infty} \\arctan\\left(\\frac{v}{a}\\right) \\right)\n$$\n使用反正切函数的已知极限，当 $x \\to \\infty$ 时 $\\arctan(x) \\to \\frac{\\pi}{2}$，以及当 $x \\to -\\infty$ 时 $\\arctan(x) \\to -\\frac{\\pi}{2}$，我们得到：\n$$\nT(I) = \\frac{1}{a} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{1}{a} (\\pi) = \\frac{\\pi}{a}\n$$\n将 $a = \\sqrt{I}$ 代回，我们得到 $I > 0$ 时的脉冲间期：\n$$\nT(I) = \\frac{\\pi}{\\sqrt{I}}\n$$\n发放率是 ISI 的倒数：\n$$\nf(I) = \\frac{1}{T(I)} = \\frac{\\sqrt{I}}{\\pi} \\quad \\text{for } I > 0\n$$\n\n**情况 2：抑制性输入 ($I  0$)**\n这种情况证明了当 $I \\le 0$ 时不存在稳态发放。当 $I$ 为负时，动力学性质发生质的变化。令 $I = -k^2$，其中 $k = \\sqrt{-I}$ 是某个正实数。ODE 变为：\n$$\n\\frac{dv}{dt} = v^2 - k^2 = (v-k)(v+k)\n$$\n系统现在有两个不动点，在这些点上 $\\frac{dv}{dt} = 0$。它们是 $v_1 = -k = -\\sqrt{-I}$ 和 $v_2 = +k = +\\sqrt{-I}$。\n\n我们分析这些不动点的稳定性。令 $g(v) = v^2 - k^2$。稳定性由导数 $g'(v) = 2v$ 在不动点处的符号决定。\n-   在 $v_1 = -k$ 处，$g'(-k) = -2k  0$。这是一个**稳定**不动点。\n-   在 $v_2 = +k$ 处，$g'(+k) = +2k > 0$。这是一个**不稳定**不动点。\n\n神经元的电压被重置到 $v \\to -\\infty$。对于任何 $v  -k$，我们有 $\\frac{dv}{dt} = (v-k)(v+k) > 0$，因为两个因子都为负。因此，电压从 $-\\infty$ 开始增加。然而，当 $v(t)$ 接近位于 $v_1 = -k = -\\sqrt{-I}$ 的稳定不动点时，其变化率 $\\frac{dv}{dt}$ 接近于 $0$。电压轨迹被困在这个稳定平衡点。它永远无法越过该点到达 $v > -k$ 的区域并随后发放脉冲。到达脉冲阈值/发散所需的时间是无限的。\n因此，对于 $I  0$，永远不会产生脉冲，$T(I) = \\infty$，根据定义，发放率为 $f(I) = 0$。\n\n**情况 3：零输入 ($I = 0$)**\n这是临界情况。ODE 为：\n$$\n\\frac{dv}{dt} = v^2\n$$\n在 $v=0$ 处有一个单一不动点。对于 $v  0$，$\\frac{dv}{dt} = v^2 > 0$，所以电压从其重置值 $-\\infty$ 开始增加。为了确定到达 $v=0$ 所需的时间，我们可以积分：\n$$\n\\Delta t = \\int_{v_0}^{v_f} \\frac{dv}{v^2} = \\left[ -\\frac{1}{v} \\right]_{v_0}^{v_f} = \\frac{1}{v_0} - \\frac{1}{v_f}\n$$\n从 $v_0 = -\\infty$ 移动到任何有限负值（例如 $v_f = -1$）的时间是有限的：$\\Delta t = \\lim_{v_0 \\to -\\infty} \\left( \\frac{1}{v_0} - \\frac{1}{-1} \\right) = 0+1 = 1$。\n然而，从 $v_0 = -1$ 移动到位于 $v_f=0$ 的不动点所需的时间是：\n$$\n\\Delta t = \\lim_{v_f \\to 0^{-}} \\left( \\frac{1}{-1} - \\frac{1}{v_f} \\right) = -1 - (-\\infty) = \\infty\n$$\n电压渐近地接近 $v=0$，但永远不会在有限时间内到达它。神经元被困在 $v=0$ 处，永远不会发放脉冲。因此，脉冲间期是无限的，$T(0) = \\infty$，发放率为 $f(0) = 0$。\n\n**总结与最终表达式**\n结合所有三种情况的结果：\n-   对于 $I > 0$，$f(I) = \\frac{\\sqrt{I}}{\\pi}$。\n-   对于 $I \\le 0$，$f(I) = 0$。\n\n这个分段函数描述了完整的 F-I 曲线。通过使用 $\\max$ 函数，它可以被写成一个对所有 $I \\in \\mathbb{R}$ 均适用的、单一、连续的闭式表达式，该函数捕捉了在 $I=0$ 处的阈值行为：\n$$\nf(I) = \\frac{\\sqrt{\\max(0, I)}}{\\pi}\n$$\n这个表达式对于 $I > 0$ 正确地得出 $\\frac{\\sqrt{I}}{\\pi}$，对于 $I \\le 0$ 正确地得出 $0$。神经元仅在超阈值（兴奋性）电流下发放脉冲，其发放率与输入电流的平方根成正比，这是 I 型神经元兴奋性的一个典型特征。",
            "answer": "$$\n\\boxed{\\frac{\\sqrt{\\max(0, I)}}{\\pi}}\n$$"
        },
        {
            "introduction": "虽然数值积分是模拟神经元动态的常用方法，但某些模型独特的数学结构允许我们采用更精确、更高效的事件驱动方法。本练习将介绍一个优雅的数学变换——theta 映射，它将 QIF 模型转化为等效的 theta 神经元模型 ()。您将利用这一变换推导出尖峰时间的解析解，从而设计出一个“完美”的事件驱动调度器，完全避免离散时间步长带来的累积误差。",
            "id": "4056276",
            "problem": "请为二次积分发放 (QIF) 神经元模型设计一个事件驱动算法，该算法利用通过 theta 映射识别的解析脉冲条件。QIF 模型由标量常微分方程 $dv/dt = v^2 + I$ 给出，其中 $v$ 是膜电位，$I$ 是恒定输入电流。在 QIF 模型中，当 $v$ 经历有限时间爆破至 $+\\infty$ 时，会产生一个脉冲，此时状态被重置为 $v = -\\infty$ 以继续动力学过程。theta 映射定义了变换 $v = \\tan(\\theta/2)$，该变换将爆破映射到相位穿越 $\\theta = \\pi$。任务是推导一个事件驱动的脉冲调度器，该调度器使用此映射解析地（无需小时间步长）检测脉冲时间，并量化该方法的数值误差。\n\n从以下基本依据出发：\n\n- 确定性动力学由常微分方程控制，事件发生时间通过对矢量场的倒数进行积分获得，即如果 $dv/dt = f(v)$ 且事件在 $v = v_e$ 处发生，则 $t_{\\text{event}} = \\int_{v_0}^{v_e} dv/f(v)$，前提是该积分收敛。\n- 变量变换 $v = \\tan(\\theta/2)$ 在 $\\theta \\in (-\\pi, \\pi)$ 上是可逆的，并且将 $v \\to +\\infty$ 映射到 $\\theta \\to \\pi$，将 $v \\to -\\infty$ 映射到 $\\theta \\to -\\pi$。\n- 根据链式法则，有 $d\\theta/dt = (dv/dt) / (dv/d\\theta)$。\n\n您的算法必须：\n\n1. 使用 theta 映射 $v = \\tan(\\theta/2)$ 推导脉冲时间的解析检测条件，用 $\\theta$ 和 $I$ 表示 $d\\theta/dt$，并确定从初始相位 $\\theta_0 = 2 \\arctan(v_0)$ 开始的到达脉冲时间 $t_{\\text{spike}}$ 的积分。\n2. 对于 $I > 0$，从有限的初始电位 $v_0$ 推导出第一个脉冲时间 $t_{\\text{spike}}$ 的闭式表达式，并推导在重置 $v = -\\infty$ 后的周期性脉冲序列的恒定脉冲间隔 $T(I)$。\n3. 对于 $I = 0$，确定产生脉冲的条件，并在适用时推导 $t_{\\text{spike}}$ 的相应闭式表达式。\n4. 对于 $I  0$，描述可兴奋区域的特征，并在初始电位 $v_0$ 足够大以产生有限时间爆破时，推导 $t_{\\text{spike}}$ 的闭式表达式。同时说明在何种情况下正向时间内不会产生脉冲。\n5. 通过将解析计算的时间与无奇异点情况下的 theta 积分的数值积分结果进行比较，来量化您的事件驱动调度器的数值误差。将误差表示为解析时间与数值积分时间之间的最大绝对差。\n\n您的程序必须按如下方式实现事件驱动调度器：\n\n- 对于 $I > 0$，解析计算第一个脉冲时间 $t_1$ 和脉冲间隔 $T(I)$；然后生成所有不超过给定时间上限 $T_{\\text{end}}$ 的脉冲时间 $t_1, t_1 + T(I), t_1 + 2 T(I), \\ldots$。\n- 对于 $I = 0$，如果存在第一个脉冲时间，则计算它；不存在周期性脉冲发放。\n- 对于 $I  0$，仅在存在第一个脉冲时间时才计算它；不存在周期性脉冲发放。\n- 对于误差量化，当 theta 积分非奇异时，对其使用数值积分，并计算所有可用比较中的最大绝对误差。\n\n角度单位必须是弧度。时间单位必须是秒。所有时间和误差都以秒为单位，表示为浮点数。\n\n测试套件：\n使用以下参数集，每个参数集为一个三元组 $(I, v_0, T_{\\text{end}})$：\n\n- 用例 A (正输入): $(0.5, 0.0, 10.0)$\n- 用例 B (小正输入): $(0.001, 0.1, 1000.0)$\n- 用例 C (零输入, 可兴奋): $(0.0, 1.0, 3.0)$\n- 用例 D (负输入, 超阈值初始条件): $(-0.5, 1.0, 10.0)$\n- 用例 E (负输入, 在阈值上): $(-0.5, 0.70710678, 10.0)$\n\n要求的最终输出格式：\n\n- 对于每个测试用例，返回一个列表，格式为 $[N, t_1, t_2, \\ldots, t_N, E]$，其中 $N$ 是在 $[0, T_{\\text{end}}]$ 内调度的脉冲整数数量，$t_k$ 是按升序排列的脉冲时间（单位：秒），$E$ 是通过将解析时间与在适用情况下通过 theta 域中的数值积分获得的时间进行比较而计算出的最大绝对误差（单位：秒）。如果没有脉冲发生，则返回 $[0, E]$，如果数值积分不适用或没有产生比较，则 $E = 0.0$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result_case_A,result_case_B,result_case_C,result_case_D,result_case_E]”）。",
            "solution": "该问题要求基于通过 theta 映射推导出的解析解，为二次积分发放 (QIF) 神经元模型设计一个事件驱动算法。\n\n该问题具有科学依据、适定且客观。QIF 模型是计算神经科学中的一个典范表示，而使用 theta 映射是一种标准的解析技术。所有常数、变量和条件都已明确定义，构成了一个自洽且可解的问题。其中不存在违反科学原理、事实不准确或逻辑不一致之处。\n\n我们着手进行推导和实现。\n\n**1. Theta 神经元模型的推导**\n\nQIF 神经元的动力学由以下常微分方程给出：\n$$\n\\frac{dv}{dt} = v^2 + I\n$$\n其中 $v$ 是膜电位，$I$ 是恒定输入电流。脉冲定义为 $v$ 到达 $+\\infty$ 的时刻。然后状态被重置为 $v = -\\infty$。\n\n我们引入 theta 映射，这是一个由 $v = \\tan(\\theta/2)$ 定义的变量变换。该变换将电位范围 $v \\in (-\\infty, +\\infty)$ 映射到相位范围 $\\theta \\in (-\\pi, \\pi)$。$v \\to +\\infty$ 处的脉冲对应于 $\\theta \\to \\pi$，而 $v \\to -\\infty$ 处的重置对应于 $\\theta \\to -\\pi$。初始相位 $\\theta_0$ 通过 $\\theta_0 = 2 \\arctan(v_0)$ 与初始电位 $v_0$ 相关联。\n\n为了找到 $\\theta$ 变量的动力学，我们使用链式法则：\n$$\n\\frac{d\\theta}{dt} = \\frac{dv}{dt} \\frac{d\\theta}{dv} = \\frac{dv}{dt} \\left( \\frac{dv}{d\\theta} \\right)^{-1}\n$$\n首先，我们计算 $dv/d\\theta$：\n$$\n\\frac{dv}{d\\theta} = \\frac{d}{d\\theta} \\tan\\left(\\frac{\\theta}{2}\\right) = \\frac{1}{2} \\sec^2\\left(\\frac{\\theta}{2}\\right)\n$$\n使用三角恒等式 $\\sec^2(x) = 1 + \\tan^2(x)$，并代入 $v = \\tan(\\theta/2)$，我们得到：\n$$\n\\frac{dv}{d\\theta} = \\frac{1}{2} \\left(1 + \\tan^2\\left(\\frac{\\theta}{2}\\right)\\right) = \\frac{1}{2}(1 + v^2)\n$$\n现在，将此结果和 QIF 动力学代入链式法则表达式：\n$$\n\\frac{d\\theta}{dt} = (v^2 + I) \\left( \\frac{1}{2}(1 + v^2) \\right)^{-1} = \\frac{2(v^2 + I)}{1 + v^2}\n$$\n为了完全用 $\\theta$ 表示，我们代入 $v = \\tan(\\theta/2)$ 并使用 $1+v^2 = 1+\\tan^2(\\theta/2) = \\sec^2(\\theta/2)$：\n$$\n\\frac{d\\theta}{dt} = \\frac{2(\\tan^2(\\theta/2) + I)}{\\sec^2(\\theta/2)} = 2\\cos^2\\left(\\frac{\\theta}{2}\\right) \\left(\\tan^2\\left(\\frac{\\theta}{2}\\right) + I\\right) = 2\\left(\\sin^2\\left(\\frac{\\theta}{2}\\right) + I\\cos^2\\left(\\frac{\\theta}{2}\\right)\\right)\n$$\n使用半角恒等式 $\\sin^2(\\theta/2) = (1-\\cos\\theta)/2$ 和 $\\cos^2(\\theta/2) = (1+\\cos\\theta)/2$：\n$$\n\\frac{d\\theta}{dt} = 2\\left(\\frac{1 - \\cos\\theta}{2} + I\\frac{1 + \\cos\\theta}{2}\\right) = (1 - \\cos\\theta) + I(1 + \\cos\\theta)\n$$\n这简化为 theta 神经元模型的典范形式：\n$$\n\\frac{d\\theta}{dt} = (1+I) - (1-I)\\cos\\theta\n$$\n\n**2. 到达脉冲时间的推导**\n\n到达脉冲时间 $t_{\\text{spike}}$ 是相位从初始值 $\\theta_0$ 演化到阈值 $\\pi$ 所需的时间。我们通过对矢量场的倒数进行积分来找到这个时间：\n$$\nt_{\\text{spike}} = \\int_{t_0}^{t_{\\text{spike}}} dt = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{(1+I) - (1-I)\\cos\\theta}\n$$\n我们针对 $I$ 的三种情况求解此积分：$I>0$，$I=0$ 和 $I0$。\n\n**情况1：超阈值电流 ($I > 0$)**\n神经元周期性地发放脉冲。被积函数的形式为 $\\int d\\theta / (a+b\\cos\\theta)$，其中 $a = 1+I$，$b = -(1-I)$。条件 $a^2 > b^2$ 成立，因为 $a^2 - b^2 = (1+I)^2 - (1-I)^2 = 4I > 0$。该积分的标准解为：\n$$\n\\int \\frac{d\\theta}{a+b\\cos\\theta} = \\frac{1}{\\sqrt{I}} \\arctan\\left(\\frac{\\tan(\\theta/2)}{\\sqrt{I}}\\right)\n$$\n从 $v_0$（因此 $\\theta_0=2\\arctan(v_0)$）开始的第一个脉冲时间 $t_1$ 是：\n$$\nt_1 = \\left[ \\frac{1}{\\sqrt{I}} \\arctan\\left(\\frac{\\tan(\\theta/2)}{\\sqrt{I}}\\right) \\right]_{\\theta_0}^{\\pi} = \\frac{1}{\\sqrt{I}} \\left( \\lim_{\\theta\\to\\pi^-} \\arctan\\left(\\frac{\\tan(\\theta/2)}{\\sqrt{I}}\\right) - \\arctan\\left(\\frac{\\tan(\\theta_0/2)}{\\sqrt{I}}\\right) \\right)\n$$\n当 $\\theta \\to \\pi^-$ 时，$\\tan(\\theta/2) \\to +\\infty$，所以 arctan 项趋近于 $\\pi/2$。因此：\n$$\nt_1 = \\frac{1}{\\sqrt{I}} \\left( \\frac{\\pi}{2} - \\arctan\\left(\\frac{v_0}{\\sqrt{I}}\\right) \\right)\n$$\n脉冲间隔 $T(I)$ 是从重置（$v=-\\infty$，$\\theta=-\\pi$）到脉冲（$v=+\\infty$，$\\theta=\\pi$）所需的时间：\n$$\nT(I) = \\int_{-\\pi}^{\\pi} \\frac{d\\theta}{(1+I) - (1-I)\\cos\\theta} = \\frac{1}{\\sqrt{I}} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{\\pi}{\\sqrt{I}}\n$$\n\n**情况2：零电流 ($I = 0$)**\n动力学简化为 $dv/dt = v^2$。只有当 $v_0 > 0$ 时才会发生脉冲，否则电位将减小或保持在 0。theta 动力学变为 $d\\theta/dt = 1 - \\cos\\theta$。到达脉冲的时间是：\n$$\nt_1 = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{1 - \\cos\\theta} = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{2\\sin^2(\\theta/2)} = \\frac{1}{2} \\int_{\\theta_0}^{\\pi} \\csc^2(\\theta/2) d\\theta\n$$\n$$\nt_1 = \\left[ -\\cot\\left(\\frac{\\theta}{2}\\right) \\right]_{\\theta_0}^{\\pi} = -\\cot\\left(\\frac{\\pi}{2}\\right) - \\left(-\\cot\\left(\\frac{\\theta_0}{2}\\right)\\right) = 0 + \\cot\\left(\\frac{\\theta_0}{2}\\right) = \\frac{1}{\\tan(\\theta_0/2)} = \\frac{1}{v_0}\n$$\n此结果对 $v_0 > 0$ 有效。如果 $v_0 \\le 0$，则不发生脉冲。没有周期性脉冲发放。\n\n**情况3：亚阈值电流 ($I  0$)**\n系统是可兴奋的。方程 $v^2+I=0$ 在 $v = \\pm\\sqrt{-I}$ 处有两个不动点。点 $v_{th} = \\sqrt{-I}$ 是一个不稳定不动点（阈值），而 $v_{st} = -\\sqrt{-I}$ 是一个稳定不动点。只有当初始电位 $v_0$ 大于阈值，即 $v_0 > \\sqrt{-I}$ 时，才会发生脉冲。如果 $v_0 \\le \\sqrt{-I}$，电位衰减到稳定不动点，不发生脉冲。\n\n对于 $v_0 > \\sqrt{-I}$，我们求解到达脉冲时间的积分。设 $k = \\sqrt{-I}$。theta 动力学为 $d\\theta/dt = (1-k^2) - (1+k^2)\\cos\\theta$。积分为：\n$$\nt_1 = \\int_{\\theta_0}^{\\pi} \\frac{d\\theta}{(1-k^2) - (1+k^2)\\cos\\theta}\n$$\n该积分（对 $v_0 > k$ 有效）可以使用双曲函数求解，得到：\n$$\nt_1 = \\frac{1}{k} \\operatorname{arccoth}\\left(\\frac{v_0}{k}\\right) = \\frac{1}{2k} \\ln\\left(\\frac{v_0+k}{v_0-k}\\right)\n$$\n代入 $k = \\sqrt{-I}$：\n$$\nt_1 = \\frac{1}{2\\sqrt{-I}} \\ln\\left( \\frac{v_0 + \\sqrt{-I}}{v_0 - \\sqrt{-I}} \\right)\n$$\n这仅在 $v_0 > \\sqrt{-I}$ 时有效。没有周期性脉冲发放。\n\n**3. 误差量化**\n\n通过将脉冲时间的解析表达式与 theta 积分的数值积分结果进行比较来量化数值误差。到达脉冲时间的积分是常义积分，因为分母 $(1+I)-(1-I)\\cos\\theta$ 在 $\\theta=\\pi$ 时值为 $2$，从而避免了在积分端点出现奇异点。我们使用 `scipy.integrate.quad` 来计算 $t_1$（从 $\\theta_0$ 到 $\\pi$）以及在适用情况下 $T(I)$（从 $-\\pi$ 到 $\\pi$）的积分数值。每个测试用例的误差 $E$ 是该用例的解析计算时间和数值计算时间之间的最大绝对差。如果没有脉冲发生，或者没有进行数值积分（例如，在阈值处），则误差为 $0$。\n\n**算法摘要**\n对于给定的参数集 $(I, v_0, T_{\\text{end}})$：\n1. 根据 $I$ 的符号确定情况。\n2. 如果 $I > 0$：使用推导的公式计算 $t_1$ 和 $T(I)$。生成所有小于或等于 $T_{\\text{end}}$ 的脉冲时间 $t_1, t_1+T(I), t_1+2T(I), \\dots$。\n3. 如果 $I = 0$：检查是否 $v_0 > 0$。如果是，计算 $t_1 = 1/v_0$。如果 $t_1 \\le T_{\\text{end}}$，记录它。\n4. 如果 $I  0$：检查是否 $v_0 > \\sqrt{-I}$。如果是，使用推导的公式计算 $t_1$。如果 $t_1 \\le T_{\\text{end}}$，记录它。\n5. 对于每个解析计算的时间（$t_1$ 和/或 $T(I)$），也通过对相应的 theta 积分进行数值积分来计算其值。\n6. 计算每对解析/数值时间的绝对差。误差 $E$ 是这些差值的最大值。\n7. 以 $[N, t_1, \\dots, t_N, E]$ 的格式返回结果。如果没有脉冲，则返回 $[0, E]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Designs an event-driven algorithm for the QIF neuron model.\n    \"\"\"\n    # Test cases: (I, v0, T_end)\n    test_cases = [\n        (0.5, 0.0, 10.0),       # Case A: Positive input\n        (0.001, 0.1, 1000.0),    # Case B: Small positive input\n        (0.0, 1.0, 3.0),        # Case C: Zero input, excitable\n        (-0.5, 1.0, 10.0),      # Case D: Negative input, supra-threshold\n        (-0.5, 0.70710678, 10.0) # Case E: Negative input, at threshold\n    ]\n\n    all_results = []\n\n    for I, v0, T_end in test_cases:\n        spikes = []\n        errors = []\n        \n        # Calculate initial phase\n        theta0 = 2 * np.arctan(v0)\n\n        # Case 1: I > 0 (Suprathreshold, periodic spiking)\n        if I > 0:\n            sqrt_I = np.sqrt(I)\n            \n            # Analytical calculation\n            t1_analyt = (0.5 * np.pi - np.arctan(v0 / sqrt_I)) / sqrt_I\n            T_analyt = np.pi / sqrt_I\n            \n            # Numerical calculation for error\n            integrand = lambda theta: 1.0 / ((1 + I) - (1 - I) * np.cos(theta))\n            t1_num, _ = integrate.quad(integrand, theta0, np.pi)\n            T_num, _ = integrate.quad(integrand, -np.pi, np.pi)\n            \n            errors.append(abs(t1_analyt - t1_num))\n            errors.append(abs(T_analyt - T_num))\n            \n            # Generate spike train\n            current_spike_time = t1_analyt\n            while current_spike_time = T_end:\n                spikes.append(current_spike_time)\n                current_spike_time += T_analyt\n\n        # Case 2: I = 0 (Spike if v0 > 0)\n        elif I == 0:\n            if v0 > 0:\n                # Analytical calculation\n                t1_analyt = 1.0 / v0\n                \n                # Numerical calculation for error\n                integrand = lambda theta: 1.0 / (1.0 - np.cos(theta))\n                t1_num, _ = integrate.quad(integrand, theta0, np.pi)\n                \n                errors.append(abs(t1_analyt - t1_num))\n\n                # Generate spike (at most one)\n                if t1_analyt = T_end:\n                    spikes.append(t1_analyt)\n            \n        # Case 3: I  0 (Excitable, spike if v0 > threshold)\n        else: # I  0\n            sqrt_neg_I = np.sqrt(-I)\n            \n            # Spike only if v0 is strictly greater than the threshold\n            # A small tolerance helps with floating point representation issues.\n            if v0 > sqrt_neg_I + 1e-12:\n                # Analytical calculation\n                t1_analyt = (1.0 / (2.0 * sqrt_neg_I)) * np.log((v0 + sqrt_neg_I) / (v0 - sqrt_neg_I))\n                \n                # Numerical calculation for error\n                integrand = lambda theta: 1.0 / ((1 + I) - (1 - I) * np.cos(theta))\n                t1_num, _ = integrate.quad(integrand, theta0, np.pi)\n                \n                errors.append(abs(t1_analyt - t1_num))\n                \n                # Generate spike (at most one)\n                if t1_analyt = T_end:\n                    spikes.append(t1_analyt)\n\n        # Format output for the current case\n        N = len(spikes)\n        E = max(errors) if errors else 0.0\n        \n        result_list = [N] + spikes + [E]\n        all_results.append(str(result_list))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "与 QIF 模型的解析优雅性形成对比，指数整合发放（EIF）模型在生物物理上更具细节，但也给数值模拟带来了独特的挑战。本练习探讨了一个在计算神经科学中至关重要的实际问题：朴素的欧拉积分法在模拟 EIF 模型时，由于尖峰起始的急剧动态，可能会“错过”尖峰 ()。您将通过分析来理解这种失效的原因，并推导保证尖峰检测所需的时间步长界限，这是任何计算建模者都必须掌握的关键技能。",
            "id": "4056299",
            "problem": "考虑在恒定输入下的指数整合发放 (EIF) 神经元模型，其膜电位 $V(t)$ 根据经典的膜常微分方程演化\n$$\n\\frac{dV}{dt} = F(V),\n$$\n其中 $F(V)$ 是连续可微的，由于指数型尖峰起始电流的存在，在 $V \\geq V_T$ 时严格递增，并且包含在尖峰起始附近主导动力学的指数项。在高于 $V_T$ 的 EIF 区域，一个科学上合理的渐近简化是仅保留指数型尖峰起始电流，从而得到简化流\n$$\n\\frac{dV}{dt} = \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right),\n$$\n其中 $\\tau_m$ 是膜时间常数（单位：秒），$V_T$ 是内在阈值（单位：伏特），$\\Delta_T$ 是斜率因子（单位：伏特）。假设当 $V(t)$ 首次达到一个有限的峰值截止电压 $V_p$（单位：伏特）时检测到一个尖峰，其中 $V_p > V_T$。一种被广泛使用的数值方案是朴素显式 Euler 方法，\n$$\nV_{n+1} = V_n + \\Delta t \\, F(V_n),\n$$\n该方法应用于离散时间 $t_n = n\\Delta t$，其中 $\\Delta t$ 是固定的时间步长（单位：秒），并且仅当 $V_{n+1} \\geq V_p$ 时才标记一个尖峰。\n\n您的任务是，从第一性原理出发，推导一个数学上严谨的论证，证明对于较大的 $\\Delta_T$ 存在参数区域，使得朴素显式 Euler 方法可能错过在一个步长内连续时间内发生的尖峰。这是因为 Euler 更新使用了左端点斜率 $F(V_n)$，从而在一个 $F(V)$ 是递增且凸的区间上低估了真实增长。然后，推导出在该简化 EIF 区域中保证尖峰检测的 $\\Delta t$ 边界。该推导必须从高于 $V_T$ 的简化流的可分离结构出发，论证从起始电压 $V_0 \\in [V_T, V_p)$ 到截止电压 $V_p$ 的精确穿越时间，并将其与 $V_{n+1} \\geq V_p$ 所需的 Euler 穿越准则进行比较。\n\n在推导出边界之后，实现一个程序，对下面测试套件中的每个参数集进行计算：\n- 对于从 $V_0$ 到 $V_p$ 的简化 EIF 流，计算精确的连续时间穿越时间 $t_{\\text{cross}}$（单位：秒）。\n- 使得从 $V_0$ 开始的朴素显式 Euler 更新满足 $V_{n+1} \\geq V_p$ 的最小 Euler 步长 $\\Delta t_{\\min}$（单位：秒）。\n- 一个布尔值 $b_{\\text{miss}}$，指示当所选的 $\\Delta t$ 使得连续系统在步长内穿越但 Euler 更新未检测到尖峰时，朴素 Euler 方法是否错过了尖峰。即，当且仅当 $\\Delta t \\geq t_{\\text{cross}}$ 且 $\\Delta t  \\Delta t_{\\min}$ 时，$b_{\\text{miss}}$ 为真。\n\n使用以下科学上合理的测试套件，该套件涵盖了正常路径、边界和边缘情况的区域。所有电压单位为伏特，所有时间单位为秒。\n\n测试套件案例指定为 $(\\tau_m, \\Delta_T, V_T, V_p, V_0, \\Delta t)$:\n1. $(0.010, 0.020, -0.050, -0.020, -0.045, 0.007)$\n2. $(0.010, 0.020, -0.050, -0.020, -0.035, 0.004)$\n3. $(0.010, 0.002, -0.050, -0.020, -0.050, 0.200)$\n4. $(0.010, 0.020, -0.050, -0.020, -0.045, t_{\\text{cross}})$ 其中 $t_{\\text{cross}}$ 是从相同参数计算出的精确穿越时间；使用其数值作为 $\\Delta t$。\n5. $(0.010, 0.020, -0.050, -0.020, -0.045, \\Delta t_{\\min})$ 其中 $\\Delta t_{\\min}$ 是从相同参数计算出的保证检测的最小步长；使用其数值作为 $\\Delta t$。\n\n对于每个案例，您的程序必须根据您为简化 EIF 流推导出的公式计算 $t_{\\text{cross}}$、$\\Delta t_{\\min}$ 和 $b_{\\text{miss}}$，并生成单行输出。该输出包含一个用方括号括起来的逗号分隔列表，其中每个元素本身是一个形式为 $[b_{\\text{miss}}, t_{\\text{cross}}, \\Delta t_{\\min}]$ 的列表。所有时间量必须以秒为单位表示为浮点数。例如，最后一行应如下所示：\n$[[\\text{boolean}, \\text{float}, \\text{float}], [\\text{boolean}, \\text{float}, \\text{float}], \\ldots]$。",
            "solution": "指数整合发放 (EIF) 模型通过指数非线性来捕捉尖峰起始。在高于 $V_T$ 的尖峰起始区域，指数项占主导地位，简化流\n$$\n\\frac{dV}{dt} = \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right)\n$$\n根据常微分方程的标准比较论证，为包含漏电和恒定输入的完整动力学提供了一个下界近似。该简化流是可分离的，在 $V$ 上严格递增，并且对于 $V \\geq V_T$ 是凸的，因为\n$$\n\\frac{d}{dV}\\left(\\frac{dV}{dt}\\right) = \\frac{1}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right)  0,\n\\quad\n\\frac{d^2}{dV^2}\\left(\\frac{dV}{dt}\\right) = \\frac{1}{\\tau_m \\Delta_T}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right)  0.\n$$\n我们为简化流推导从 $V_0 \\in [V_T, V_p)$ 到截止电压 $V_p$ 的精确穿越时间。将 $V$ 视为 $t$ 的函数并分离变量，可得\n$$\n\\int_{V_0}^{V_p} \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\, dV\n= \\int_0^{t_{\\text{cross}}} \\frac{\\Delta_T}{\\tau_m} \\, dt.\n$$\n左侧积分为\n$$\n\\int_{V_0}^{V_p} \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\, dV\n= -\\Delta_T \\left[ \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\right]_{V_0}^{V_p}\n= \\Delta_T \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right).\n$$\n右侧积分为 $(\\Delta_T/\\tau_m)\\, t_{\\text{cross}}$。令两侧相等，我们得到精确的连续时间穿越时间\n$$\nt_{\\text{cross}}(V_0 \\to V_p)\n= \\tau_m \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right).\n$$\n我们现在分析从 $V_0$ 开始一步的朴素显式 Euler 方法：\n$$\nV_{n+1}\n= V_0 + \\Delta t \\, \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right).\n$$\n在离散方案中，当且仅当 $V_{n+1} \\geq V_p$ 时，在步长末尾会检测到一个尖峰，这施加了以下不等式：\n$$\n\\Delta t \\, \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right) \\geq V_p - V_0.\n$$\n对 $\\Delta t$ 求解，定义了在朴素 Euler 方案中保证步末检测的最小步长：\n$$\n\\Delta t_{\\min}(V_0)\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}.\n$$\n我们将 $t_{\\text{cross}}$ 与 $\\Delta t_{\\min}(V_0)$ 进行比较。因为对于 $V \\geq V_T$，流是递增且凸的，函数 $F(V) = (\\Delta_T/\\tau_m)\\exp((V - V_T)/\\Delta_T)$ 随 $V$ 增加而增加，因此 $1/F(V)$ 随 $V$ 增加而减少。精确穿越时间可以写成\n$$\nt_{\\text{cross}} = \\int_{V_0}^{V_p} \\frac{dV}{F(V)}.\n$$\n由于 $1/F(V)$ 是递减的，我们有标准的单调积分界\n$$\n\\int_{V_0}^{V_p} \\frac{dV}{F(V)}\n\\leq \\frac{V_p - V_0}{F(V_0)}\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}\n= \\Delta t_{\\min}(V_0).\n$$\n因此，\n$$\nt_{\\text{cross}} \\leq \\Delta t_{\\min}(V_0),\n$$\n只要 $F(V)$ 在 $[V_0, V_p)$ 上是严格递增的（这对于 $V_0 > V_T$ 成立），不等式就是严格的。这个不等式精确地刻画了朴素 Euler 方法可能错过尖峰的区域：如果所选的 $\\Delta t$ 满足\n$$\nt_{\\text{cross}} \\leq \\Delta t  \\Delta t_{\\min}(V_0),\n$$\n那么连续系统会在该步长内达到 $V_p$，而 Euler 更新由于使用左端点斜率 $F(V_0)$ 而低估了增长，并保持在 $V_p$ 以下。在这种情况下，步长末尾的尖峰被错过。这个错失区间的宽度，\n$$\n\\Delta t_{\\min}(V_0) - t_{\\text{cross}}\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}\n- \\tau_m \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right),\n$$\n对于足够接近 $V_T$ 的起始电压，随着斜率因子 $\\Delta_T$ 的增加而增加，这反映出较大的 $\\Delta_T$ 会增加流中的振幅因子，同时降低对 $V$ 的指数敏感度，从而扩大了左端点线性外推与跨越凸的、递增的流的精确积分之间的差距。\n\n在跨越步中保证尖峰检测的时间步长边界立即可以得出：对于给定的 $V_0$，\n$$\n\\Delta t \\geq \\Delta t_{\\min}(V_0)\n$$\n保证了 $V_{n+1} \\geq V_p$，从而在步长末尾检测到尖峰。为了在带域 $V_0 \\in [V_T, V_b]$（其中 $V_b  V_p$）上获得一个与状态无关的保守边界，可以选择\n$$\n\\Delta t \\geq \\sup_{V_0 \\in [V_T, V_b]} \\Delta t_{\\min}(V_0),\n$$\n尽管由于其在 $V_T$ 附近的大小，这通常是不切实际的。在实践中，自适应步长或事件检测是首选方法，但在朴素固定步长 Euler 框架内，推导出的 $\\Delta t_{\\min}(V_0)$ 为简化 EIF 区域中的每步检测提供了精确阈值。\n\n程序的算法设计：\n- 对于每个测试案例，计算 $x_0 = (V_0 - V_T)/\\Delta_T$ 和 $x_p = (V_p - V_T)/\\Delta_T$。\n- 计算\n$$\nt_{\\text{cross}} = \\tau_m\\left(e^{-x_0} - e^{-x_p}\\right),\n\\quad\n\\Delta t_{\\min} = \\frac{(V_p - V_0)\\tau_m}{\\Delta_T e^{x_0}}.\n$$\n- 根据案例的 $\\Delta t$，设置错失布尔值\n$$\nb_{\\text{miss}} = \\left(\\Delta t \\geq t_{\\text{cross}}\\right) \\wedge \\left(\\Delta t  \\Delta t_{\\min}\\right).\n$$\n- 对于 $\\Delta t$ 被指定为 $t_{\\text{cross}}$ 或 $\\Delta t_{\\min}$ 的边界情况，首先计算其值，然后将其用作 $\\Delta t$。\n- 将每个案例的输出聚合为 $[b_{\\text{miss}}, t_{\\text{cross}}, \\Delta t_{\\min}]$，时间条目以秒为单位。\n\n这种有原则的方法将朴素显式 Euler 方法下尖峰检测的保证，与简化 EIF 流的可分离结构以及 $1/F(V)$ 的精确积分与其左端点黎曼近似之间由凸性引起的差距直接联系起来。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_crossing_time(tau_m, delta_T, V_T, V_p, V0):\n    # t_cross = tau_m * (exp(-(V0 - V_T)/delta_T) - exp(-(V_p - V_T)/delta_T))\n    x0 = (V0 - V_T) / delta_T\n    xp = (V_p - V_T) / delta_T\n    return tau_m * (np.exp(-x0) - np.exp(-xp))\n\ndef compute_dt_min(tau_m, delta_T, V_T, V_p, V0):\n    # dt_min = (V_p - V0) * tau_m / (delta_T * exp((V0 - V_T)/delta_T))\n    x0 = (V0 - V_T) / delta_T\n    denom = delta_T * np.exp(x0)\n    return (V_p - V0) * tau_m / denom\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (tau_m, delta_T, V_T, V_p, V0, dt)\n    # Units: tau_m [s], delta_T [V], V_T [V], V_p [V], V0 [V], dt [s]\n    tau_m = 0.010  # 10 ms\n    cases = [\n        # 1. (0.010, 0.020, -0.050, -0.020, -0.045, 0.007)\n        (0.010, 0.020, -0.050, -0.020, -0.045, 0.007),\n        # 2. (0.010, 0.020, -0.050, -0.020, -0.035, 0.004)\n        (0.010, 0.020, -0.050, -0.020, -0.035, 0.004),\n        # 3. (0.010, 0.002, -0.050, -0.020, -0.050, 0.200)\n        (0.010, 0.002, -0.050, -0.020, -0.050, 0.200),\n        # 4. (0.010, 0.020, -0.050, -0.020, -0.045, t_cross)\n        # Placeholder dt; will be replaced by t_cross computed\n        (0.010, 0.020, -0.050, -0.020, -0.045, None),\n        # 5. (0.010, 0.020, -0.050, -0.020, -0.045, dt_min)\n        # Placeholder dt; will be replaced by dt_min computed\n        (0.010, 0.020, -0.050, -0.020, -0.045, None),\n    ]\n\n    results = []\n    for idx, case in enumerate(cases):\n        tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i, dt_i = case\n\n        t_cross = compute_crossing_time(tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i)\n        dt_min = compute_dt_min(tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i)\n\n        # For cases 4 and 5, substitute dt as specified (t_cross or dt_min)\n        if idx == 3:\n            dt_i = t_cross\n        if idx == 4:\n            dt_i = dt_min\n\n        # Missed spike occurs if exact crossing happens within step but Euler does not detect\n        missed = (dt_i >= t_cross) and (dt_i  dt_min)\n\n        results.append([bool(missed), float(t_cross), float(dt_min)])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}