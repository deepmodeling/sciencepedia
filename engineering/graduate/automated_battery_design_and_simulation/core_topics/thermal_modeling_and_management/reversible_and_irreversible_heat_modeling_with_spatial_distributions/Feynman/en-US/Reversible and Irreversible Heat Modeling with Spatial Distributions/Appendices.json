{
    "hands_on_practices": [
        {
            "introduction": "To begin our practical exploration, we first establish a quantitative understanding of the key thermal phenomena within a battery. This exercise  guides you through the calculation of fundamental dimensionless groups—the Biot number ($Bi$) and Fourier number ($Fo$)—which govern the nature of heat transport. By also computing the ratio of reversible to irreversible heat ($\\Pi$), you will gain crucial intuition for when simplified thermal models are valid and for identifying which heat generation source dominates under typical operating conditions.",
            "id": "3946816",
            "problem": "Consider a prismatic lithium-ion pouch cell undergoing constant-current discharge. Focus on through-thickness heat transfer and generation at mid-state-of-charge. The following properties and operating conditions are representative of typical cells and are assumed uniform in space and constant in time over the duration of interest.\n\nGeometry and thermal transport:\n- Through-thickness slab thickness is $H = 6 \\times 10^{-3} \\ \\mathrm{m}$, with characteristic length $L = H/2 = 3 \\times 10^{-3} \\ \\mathrm{m}$ for one-dimensional slab conduction.\n- Through-thickness thermal conductivity is $k = 0.8 \\ \\mathrm{W} \\ \\mathrm{m}^{-1} \\ \\mathrm{K}^{-1}$.\n- Density is $\\rho = 2400 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$ and isothermal specific heat capacity is $c_{p} = 900 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$, so the thermal diffusivity is $\\alpha = k/(\\rho c_{p})$.\n- The convective heat transfer coefficient on the broad faces is $h = 15 \\ \\mathrm{W} \\ \\mathrm{m}^{-2} \\ \\mathrm{K}^{-1}$.\n- Consider a discharge window of duration $t = 60 \\ \\mathrm{s}$ from an initial uniform temperature equal to ambient, and treat external convection as spatially uniform.\n\nElectrochemical heat generation:\n- The discharge current is $I = 20 \\ \\mathrm{A}$.\n- The direct-current internal resistance (lumped, including ohmic and charge-transfer contributions under the present operating point) is $R = 2.5 \\times 10^{-2} \\ \\Omega$.\n- At the specified state-of-charge, the entropic coefficient (temperature derivative of Open-Circuit Potential (OCP), also called reversible electrochemical potential) is $\\partial U_{\\mathrm{ocp}}/\\partial T = -4 \\times 10^{-4} \\ \\mathrm{V} \\ \\mathrm{K}^{-1}$, assumed constant over the time window.\n- The ambient and initial cell temperature is $T = 298 \\ \\mathrm{K}$.\n\nStarting from the first law of thermodynamics for heat conduction in a slab, definitions of dimensionless transport groups for transient conduction with convection, and the decomposition of electrochemical heat generation into irreversible (Joule) and reversible (entropic) components, perform the following:\n\n1. Derive the expressions for the Fourier number $Fo$ and the Biot number $Bi$ appropriate to the above one-dimensional slab geometry and convection boundary, and compute their values using the provided parameters.\n2. Define the dimensionless ratio $\\Pi$ of reversible to irreversible heat generation as the magnitude of reversible heat rate divided by the irreversible heat rate, and compute its value under the given operating conditions.\n3. Briefly explain, on the basis of the magnitudes of $Fo$, $Bi$, and $\\Pi$, the regimes in which reversible heat dominates or is negligible compared to irreversible heat and how spatial temperature distributions are expected to behave through the thickness.\n\nReport your final numerical values for $Fo$, $Bi$, and $\\Pi$ in a single row vector and round each to four significant figures. These are dimensionless quantities; report them with no units.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n- Slab thickness: $H = 6 \\times 10^{-3} \\ \\mathrm{m}$\n- Characteristic length: $L = H/2 = 3 \\times 10^{-3} \\ \\mathrm{m}$\n- Thermal conductivity: $k = 0.8 \\ \\mathrm{W} \\ \\mathrm{m}^{-1} \\ \\mathrm{K}^{-1}$\n- Density: $\\rho = 2400 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$\n- Specific heat capacity: $c_{p} = 900 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n- Thermal diffusivity: $\\alpha = k/(\\rho c_{p})$\n- Convective heat transfer coefficient: $h = 15 \\ \\mathrm{W} \\ \\mathrm{m}^{-2} \\ \\mathrm{K}^{-1}$\n- Time duration: $t = 60 \\ \\mathrm{s}$\n- Discharge current: $I = 20 \\ \\mathrm{A}$\n- Internal resistance: $R = 2.5 \\times 10^{-2} \\ \\Omega$\n- Entropic coefficient: $\\partial U_{\\mathrm{ocp}}/\\partial T = -4 \\times 10^{-4} \\ \\mathrm{V} \\ \\mathrm{K}^{-1}$\n- Ambient and initial temperature: $T = 298 \\ \\mathrm{K}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as it uses the standard heat conduction equation and established models for electrochemical heat generation (Joule heating and entropic heating). All given physical and electrochemical parameters are within realistic ranges for a prismatic lithium-ion cell. The problem is well-posed, as all necessary information is provided to compute the requested dimensionless numbers. The language is objective and precise. The problem is complete, consistent, and feasible.\n\n### Step 3: Verdict and Action\nThe problem is valid. A full solution will be provided.\n\n***\n\n### 1. Fourier Number ($Fo$) and Biot Number ($Bi$)\n\nThe Biot number, $Bi$, is a dimensionless group that represents the ratio of the internal conductive resistance to heat transfer to the external convective resistance to heat transfer. For a slab of characteristic length $L$, it is defined as:\n$$Bi = \\frac{hL}{k}$$\nwhere $h$ is the convective heat transfer coefficient, $L$ is the characteristic length (half-thickness for a symmetrical slab), and $k$ is the thermal conductivity.\n\nSubstituting the given values:\n$h = 15 \\ \\mathrm{W} \\ \\mathrm{m}^{-2} \\ \\mathrm{K}^{-1}$\n$L = 3 \\times 10^{-3} \\ \\mathrm{m}$\n$k = 0.8 \\ \\mathrm{W} \\ \\mathrm{m}^{-1} \\ \\mathrm{K}^{-1}$\n\nWe compute the Biot number:\n$$Bi = \\frac{(15)(3 \\times 10^{-3})}{0.8} = \\frac{0.045}{0.8} = 0.05625$$\n\nThe Fourier number, $Fo$, is a dimensionless group that characterizes transient heat conduction. It represents the ratio of the rate of heat conduction to the rate of thermal energy storage in a volume element. It is defined as:\n$$Fo = \\frac{\\alpha t}{L^2}$$\nwhere $\\alpha$ is the thermal diffusivity, $t$ is the time, and $L$ is the characteristic length. The thermal diffusivity $\\alpha$ is defined as $\\alpha = k/(\\rho c_{p})$.\n\nFirst, we compute the thermal diffusivity $\\alpha$:\n$\\rho = 2400 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$\n$c_{p} = 900 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n$k = 0.8 \\ \\mathrm{W} \\ \\mathrm{m}^{-1} \\ \\mathrm{K}^{-1}$\n$$\\alpha = \\frac{k}{\\rho c_{p}} = \\frac{0.8}{(2400)(900)} = \\frac{0.8}{2160000} \\approx 3.7037 \\times 10^{-7} \\ \\mathrm{m^2 s^{-1}}$$\n\nNow, we can compute the Fourier number using $t = 60 \\ \\mathrm{s}$ and $L = 3 \\times 10^{-3} \\ \\mathrm{m}$:\n$$Fo = \\frac{\\alpha t}{L^2} = \\frac{(3.7037 \\times 10^{-7})(60)}{(3 \\times 10^{-3})^2} = \\frac{2.2222 \\times 10^{-5}}{9 \\times 10^{-6}} \\approx 2.4691358$$\n\nRounding to four significant figures, $Fo = 2.469$ and $Bi = 0.05625$.\n\n### 2. Dimensionless Ratio of Reversible to Irreversible Heat ($\\Pi$)\n\nThe total electrochemical heat generation rate, $\\dot{Q}_{\\mathrm{gen}}$, is the sum of the irreversible (Joule) and reversible (entropic) heat rates: $\\dot{Q}_{\\mathrm{gen}} = \\dot{Q}_{\\mathrm{irr}} + \\dot{Q}_{\\mathrm{rev}}$.\n\nThe irreversible heat rate, $\\dot{Q}_{\\mathrm{irr}}$, is due to Joule heating from the current passing through the cell's internal resistance:\n$$\\dot{Q}_{\\mathrm{irr}} = I^2 R$$\nWith $I = 20 \\ \\mathrm{A}$ and $R = 2.5 \\times 10^{-2} \\ \\Omega$:\n$$\\dot{Q}_{\\mathrm{irr}} = (20)^2 (2.5 \\times 10^{-2}) = (400)(0.025) = 10 \\ \\mathrm{W}$$\n\nThe reversible heat rate, $\\dot{Q}_{\\mathrm{rev}}$, is due to the entropy change of the electrochemical reactions. It is given by:\n$$\\dot{Q}_{\\mathrm{rev}} = -I \\cdot T \\cdot \\frac{\\partial U_{\\mathrm{ocp}}}{\\partial T}$$\nThe sign convention is such that a positive value represents heat generation. With $I = 20 \\ \\mathrm{A}$, $T = 298 \\ \\mathrm{K}$, and $\\partial U_{\\mathrm{ocp}}/\\partial T = -4 \\times 10^{-4} \\ \\mathrm{V} \\ \\mathrm{K}^{-1}$:\n$$\\dot{Q}_{\\mathrm{rev}} = -(20)(298)(-4 \\times 10^{-4}) = (20)(298)(4 \\times 10^{-4}) = 2.384 \\ \\mathrm{W}$$\nSince $\\dot{Q}_{\\mathrm{rev}}$ is positive, the reversible reaction is exothermic under these conditions (discharge).\n\nThe problem defines the dimensionless ratio $\\Pi$ as the magnitude of reversible heat rate divided by the irreversible heat rate:\n$$\\Pi = \\frac{|\\dot{Q}_{\\mathrm{rev}}|}{\\dot{Q}_{\\mathrm{irr}}}$$\nSubstituting the calculated values:\n$$\\Pi = \\frac{|2.384|}{10} = 0.2384$$\n\nRounding to four significant figures, $\\Pi = 0.2384$.\n\n### 3. Physical Interpretation\n\nThe computed dimensionless numbers provide insight into the thermal behavior of the cell.\n\n- **Biot Number ($Bi = 0.05625$)**: The Biot number is small ($Bi \\ll 0.1$). This signifies that the internal resistance to heat conduction within the cell is much smaller than the external resistance to heat convection from the cell's surface to the ambient environment. Consequently, temperature gradients through the thickness of the cell are expected to be minimal. The cell can be accurately approximated as a \"lumped capacitance\" system, where its temperature is spatially uniform at any given instant.\n\n- **Fourier Number ($Fo \\approx 2.469$)**: The Fourier number is greater than one ($Fo > 1$). This indicates that the discharge duration ($t = 60 \\ \\mathrm{s}$) is long enough for heat to diffuse throughout the entire half-thickness of the cell. The thermal response is beyond the initial transient penetration period and is approaching a quasi-steady state. The temperature profile is well-developed and is dictated by the heat generation and boundary conditions, rather than being dominated by the initial uniform temperature.\n\n- **Heat Generation Ratio ($\\Pi = 0.2384$)**: This value indicates that the reversible (entropic) heat generation rate is approximately $23.8\\%$ of the irreversible (Joule) heat generation rate. This is a significant contribution. While Joule heating is the dominant source of heat generation, neglecting the reversible heat would lead to an underestimation of the total heat generated by nearly a quarter. Therefore, for accurate thermal modeling of this cell under these operating conditions, both heat generation mechanisms must be included. For this specific case (discharge, negative entropic coefficient), the reversible heat is exothermic, adding to the Joule heating and accelerating the temperature rise.\n\nIn summary, the cell is expected to heat up with a nearly uniform temperature profile through its thickness. The temperature rise is significant because the time scale allows for substantial heat generation and diffusion ($Fo > 1$), and the total heat generation is a sum of the dominant Joule heating and a non-negligible entropic heating term.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.469 & 0.05625 & 0.2384 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Moving from calculation to experimental design, this practice challenges you to devise a method for isolating and observing the elusive reversible heat component. Theoretical models distinguish between irreversible heat, which scales quadratically with current ($q_{\\mathrm{irrev}} \\propto I^2$), and reversible heat, which scales linearly ($q_{\\mathrm{rev}} \\propto I$). This exercise  leverages this fundamental difference to construct a non-invasive thermal measurement protocol, demonstrating how to use symmetric current pulses to make the antisymmetric entropic heating and cooling effects visible, a common technique in advanced battery calorimetry.",
            "id": "3946858",
            "problem": "An electrochemical pouch cell used in automated battery design and simulation is instrumented with an infrared (IR) camera to resolve spatial temperature fields on its large face during intermittent galvanostatic operation. The cell is operated at room temperature, and the open-circuit voltage (OCV) has a known entropic coefficient at mid-state-of-charge, given by the partial derivative with respect to temperature. The goal is to design a measurement protocol that uses rest periods such that what is recorded during OCV relaxation reveals purely the reversible entropic heating and cooling, untainted by irreversible contributions, and to predict the temperature signatures that would be observed. The cell is thin enough that in-plane heat conduction dominates over through-thickness effects on the time scales considered, and the current distribution is uniform across the electrochemically active area.\n\nUse the following context-appropriate fundamental base:\n\n- The conservation of energy (First Law) for the temperature field $T(\\mathbf{x},t)$ in a solid domain $\\Omega$ with density $\\rho$, specific heat capacity $c$, and thermal conductivity tensor $\\mathbf{k}$ is\n\n$$\n\\rho c \\frac{\\partial T}{\\partial t} = \\nabla \\cdot \\left( \\mathbf{k} \\nabla T \\right) + q_{\\text{rev}}(\\mathbf{x},t) + q_{\\text{irrev}}(\\mathbf{x},t) + q_{\\text{mix}}(\\mathbf{x},t),\n$$\n\nwhere $q_{\\text{rev}}$ is the reversible entropic heat generation rate per unit volume, $q_{\\text{irrev}}$ is the irreversible heat generation rate per unit volume (including Joule heating and reaction overpotential heating), and $q_{\\text{mix}}$ is the heat of mixing associated with relaxation of concentration gradients.\n\n- The reversible entropic heat generation at the cell level is given by\n\n$$\n\\dot{Q}_{\\text{rev}}(t) = -I(t)\\, T(t)\\, \\frac{\\partial U}{\\partial T},\n$$\n\nwhere $I(t)$ is the applied cell current (positive for discharge by convention), $T(t)$ is the cell temperature, and $\\frac{\\partial U}{\\partial T}$ is the entropic coefficient of the OCV $U$. For spatially uniform reaction, $q_{\\text{rev}}(\\mathbf{x},t) \\approx \\dot{Q}_{\\text{rev}}(t)/V$ where $V$ is the active volume.\n\n- The irreversible Joule heating is dominated by the effective cell resistance $R$, with\n\n$$\n\\dot{Q}_{\\text{Joule}}(t) \\approx I^2(t)\\, R,\n$$\n\nand reaction overpotential heating scales as $I(t)\\, \\eta(t)$ where $\\eta$ is the overpotential. Under open-circuit rest, $I(t)=0$ so $q_{\\text{rev}}=0$ and $q_{\\text{irrev}}=0$.\n\n- The thermal diffusivity is $\\alpha = k/(\\rho c)$ for isotropic conductivity $k$, and relaxation of temperature in the absence of sources during rest is governed by\n\n$$\n\\rho c \\frac{\\partial T}{\\partial t} = \\nabla \\cdot \\left( k \\nabla T \\right),\n$$\n\nso any temperature offsets created during a pulse decay over a characteristic time set by geometry and $\\alpha$.\n\nThe cell is operated at a mid-state-of-charge where the entropic coefficient is $\\frac{\\partial U}{\\partial T} = -3.5\\times 10^{-4}\\,\\mathrm{V/K}$ and the ambient temperature is $T_{\\infty} \\approx 298\\,\\mathrm{K}$. The applied current magnitude for pulses is $I_0$, the pulse duration is $\\tau$, and rests are long enough that the terminal voltage returns within $1\\,\\mathrm{mV}$ of the OCV baseline and the overpotential $\\eta$ is negligible. Assume the enthalpy-of-mixing term $q_{\\text{mix}}$ is minimized by choosing $I_0$ and $\\tau$ so that concentration gradients are small and relax quickly during rest, and that spatial reaction uniformity ensures $q_{\\text{rev}}$ is approximately uniform across $\\Omega$ while $q_{\\text{Joule}}$ is also distributed uniformly due to uniform current density.\n\nWhich option correctly specifies a protocol that isolates the purely reversible entropic heating and cooling during OCV relaxation and correctly predicts the expected temperature signatures (including sign, scaling with $I_0$, and qualitative spatial distribution) measured by the IR camera?\n\nA. Apply a sequence of symmetric galvanostatic pulses: a charge pulse with $I(t)=-I_0$ for duration $\\tau$, followed by rest until the terminal voltage reaches OCV within $1\\,\\mathrm{mV}$; then a discharge pulse with $I(t)=+I_0$ for duration $\\tau$, followed by an identical rest. Record the IR temperature field immediately after each current cut to rest and during the ensuing OCV relaxation. Expect an antisymmetric temperature offset between the two rests: cooling after charge and heating after discharge, with the magnitude of the offset at cut-off scaling as $\\Delta T(0^+) \\propto I_0\\, T\\, \\left|\\frac{\\partial U}{\\partial T}\\right|\\, \\tau$. Because $I=0$ during rest, no new heat is generated; the temperature field relaxes according to $\\partial T/\\partial t = (\\alpha)\\, \\nabla^2 T$, and spatially the reversible offset is approximately uniform across the face, decaying diffusively toward ambient.\n\nB. Apply a continuous discharge at $I(t)=+I_0$ and intersperse short rests. Expect reversible heat generation to persist during rest such that the IR-measured temperature continues to increase or decrease due to entropic heating during OCV relaxation. The sign of the temperature change during rest is independent of $\\frac{\\partial U}{\\partial T}$, and the magnitude scales as $\\Delta T \\propto I_0^2$.\n\nC. Use large-amplitude pulses with $I_0$ maximized and short rests to enhance signal-to-noise. Predict that the reversible entropic temperature component scales quadratically with $I_0$, $\\Delta T \\propto I_0^2$, and that hot spots should appear near current collector tabs during rest because reversible heating is strongest there. The temperature offsets after charge and discharge will be symmetric with respect to magnitude and sign.\n\nD. Use small current pulses and subtract an estimate of Joule heating $\\dot{Q}_{\\text{Joule}} \\approx I_0^2 R$ from the total to obtain the reversible component. Immediately after cut to rest, expect a spatially uniform entropic temperature offset that persists indefinitely during OCV relaxation, independent of the thermal diffusivity $\\alpha$ and geometry, with $\\Delta T \\propto I_0\\, T\\, \\frac{\\partial U}{\\partial T}$ but no decay in time.",
            "solution": "The user wants me to validate the problem statement and, if valid, derive the solution for a problem in battery thermal modeling.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **System:** An electrochemical pouch cell.\n- **Measurement:** Infrared (IR) camera to measure spatial temperature fields $T(\\mathbf{x},t)$.\n- **Operating Conditions:** Intermittent galvanostatic operation at room temperature, $T_{\\infty} \\approx 298\\,\\mathrm{K}$.\n- **State of Charge (SoC):** Mid-SoC.\n- **Entropic Coefficient:** $\\frac{\\partial U}{\\partial T} = -3.5\\times 10^{-4}\\,\\mathrm{V/K}$.\n- **Goal:** Design a measurement protocol to isolate purely reversible entropic heating/cooling during open-circuit voltage (OCV) relaxation and predict the observed temperature signatures.\n- **Governing Equation (Heat Transfer):** $\\rho c \\frac{\\partial T}{\\partial t} = \\nabla \\cdot \\left( \\mathbf{k} \\nabla T \\right) + q_{\\text{rev}}(\\mathbf{x},t) + q_{\\text{irrev}}(\\mathbf{x},t) + q_{\\text{mix}}(\\mathbf{x},t)$.\n- **Heat Source Definitions:**\n    - Reversible Heat (cell level): $\\dot{Q}_{\\text{rev}}(t) = -I(t)\\, T(t)\\, \\frac{\\partial U}{\\partial T}$.\n    - Irreversible Heat (Joule): $\\dot{Q}_{\\text{Joule}}(t) \\approx I^2(t)\\, R$.\n    - Irreversible Heat (Overpotential): scales as $I(t)\\, \\eta(t)$.\n- **Open-Circuit Conditions ($I(t)=0$):** $q_{\\text{rev}}=0$, $q_{\\text{irrev}}=0$.\n- **Heat Relaxation during Rest:** $\\rho c \\frac{\\partial T}{\\partial t} = \\nabla \\cdot \\left( k \\nabla T \\right)$, or $\\frac{\\partial T}{\\partial t} = \\alpha \\nabla^2 T$ for isotropic conductivity $k$ where $\\alpha = k/(\\rho c)$.\n- **Protocol Parameters:** Current magnitude $I_0$, pulse duration $\\tau$.\n- **Assumptions:**\n    1. The cell is thin; in-plane heat conduction dominates.\n    2. The current distribution is uniform.\n    3. The heat of mixing, $q_{\\text{mix}}$, is negligible.\n    4. Due to uniform reaction, $q_{\\text{rev}}$ is spatially uniform.\n    5. Due to uniform current density, $q_{\\text{Joule}}$ is spatially uniform.\n    6. Rest is long enough for terminal voltage to relax to OCV and overpotential $\\eta$ to become negligible.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Groundedness:** The problem is firmly based on the first law of thermodynamics and established principles of heat transfer and electrochemistry as applied to batteries. The distinction between reversible (entropic) and irreversible (Joule, overpotential) heat generation is a standard and critical concept in battery science. The equations provided are standard forms used in thermal modeling. The given value for the entropic coefficient is realistic for common lithium-ion chemistries. The problem is scientifically sound.\n- **Well-Posedness:** The problem asks for the design of a measurement protocol and the prediction of its outcome, which is a standard task in experimental physics and engineering. It is structured to allow for a unique, logical deduction based on the provided principles.\n- **Objectivity:** The problem is stated in precise, quantitative, and unbiased technical language.\n- **Completeness and Consistency:** The problem provides all the necessary physical laws, definitions, and simplifying assumptions required to reason through the behavior of the system. There are no internal contradictions. For example, the behavior during current flow ($I \\neq 0$) and during rest ($I=0$) are clearly and consistently defined.\n- **Realism:** The scenario described—using an IR camera to study thermal signatures of a pouch cell under galvanostatic pulses—is a common and realistic experimental method in battery research. The assumptions, such as uniform current density and dominant in-plane conduction in a thin pouch cell, are standard and reasonable approximations for this type of problem.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It is scientifically and mathematically sound, well-posed, and provides sufficient information. I will proceed with the solution derivation and option analysis.\n\n### Solution Derivation\n\nThe goal is to isolate the reversible entropic heat generation, $q_{\\text{rev}}$, from other heat sources, primarily the irreversible heat, $q_{\\text{irrev}}$.\n\n1.  **Analyze Heat Sources:**\n    The total heat generation rate per unit volume, neglecting mixing effects as per the problem statement, is:\n    $$q_{\\text{total}}(\\mathbf{x}, t) = q_{\\text{rev}}(\\mathbf{x}, t) + q_{\\text{irrev}}(\\mathbf{x}, t)$$\n    According to the provided definitions, the cell-level heat rates are:\n    $$ \\dot{Q}_{\\text{rev}}(t) = -I(t)\\, T(t)\\, \\frac{\\partial U}{\\partial T} $$\n    $$ \\dot{Q}_{\\text{irrev}}(t) \\approx I(t)^2 R + I(t)\\eta(t) \\quad (\\text{always positive for } I \\neq 0) $$\n    The key distinction is the dependence on current $I(t)$. The reversible heat is linear in $I(t)$, while the irreversible heat is dominated by terms that are quadratic or super-linear in $I(t)$ (since overpotential $\\eta$ also increases with $I$). For simplicity, we can state $\\dot{Q}_{\\text{irrev}} \\propto I(t)^2$.\n\n2.  **Design an Isolation Protocol:**\n    To separate a linear effect from a quadratic effect, a standard technique is to use symmetric positive and negative inputs. Let's consider a charge pulse and a discharge pulse of the same magnitude $I_0$ and duration $\\tau$. By convention, discharge is $I(t) = +I_0$ and charge is $I(t) = -I_0$.\n\n    -   **During a charge pulse ($I = -I_0$):**\n        $$ \\dot{Q}_{\\text{total, charge}} = -(-I_0) T \\frac{\\partial U}{\\partial T} + \\dot{Q}_{\\text{irrev}}(-I_0) $$\n    -   **During a discharge pulse ($I = +I_0$):**\n        $$ \\dot{Q}_{\\text{total, discharge}} = -(+I_0) T \\frac{\\partial U}{\\partial T} + \\dot{Q}_{\\text{irrev}}(+I_0) $$\n\n    The irreversible term $\\dot{Q}_{\\text{irrev}}$ depends on $I^2$ and is always positive, so $\\dot{Q}_{\\text{irrev}}(-I_0) \\approx \\dot{Q}_{\\text{irrev}}(+I_0) \\propto I_0^2$. The reversible term, however, is antisymmetric: its sign flips with the sign of the current.\n    By applying a symmetric charge/discharge pulse sequence, we can expose this antisymmetric contribution.\n\n3.  **Predict Temperature Signatures:**\n    Let's use the given value $\\frac{\\partial U}{\\partial T} = -3.5\\times 10^{-4}\\,\\mathrm{V/K}$, which is negative. The cell temperature $T$ is always positive (in Kelvin).\n\n    -   **Reversible heat during charge ($I = -I_0$):**\n        $$ \\dot{Q}_{\\text{rev, charge}} = -(-I_0) T \\left(\\frac{\\partial U}{\\partial T}\\right) = (+I_0) T (\\text{negative value}) < 0 $$\n        This corresponds to **cooling**.\n    -   **Reversible heat during discharge ($I = +I_0$):**\n        $$ \\dot{Q}_{\\text{rev, discharge}} = -(+I_0) T \\left(\\frac{\\partial U}{\\partial T}\\right) = -(+I_0) T (\\text{negative value}) > 0 $$\n        This corresponds to **heating**.\n\n    The temperature change $\\Delta T$ at the end of a short pulse of duration $\\tau$ (before significant heat diffusion) is approximately proportional to the total heat generated, $\\int_0^\\tau \\dot{Q}_{\\text{total}} dt \\approx \\dot{Q}_{\\text{total}} \\tau$. So, the reversible component of temperature change, $\\Delta T_{\\text{rev}}$, scales as:\n    $$ \\Delta T_{\\text{rev}} \\propto \\dot{Q}_{\\text{rev}} \\tau \\propto -I_0 T \\frac{\\partial U}{\\partial T} \\tau $$\n    The magnitude of this change thus scales as $|\\Delta T_{\\text{rev}}| \\propto I_0 T \\left|\\frac{\\partial U}{\\partial T}\\right| \\tau$.\n\n4.  **Behavior during OCV Relaxation (Rest):**\n    The problem states that when $I(t)=0$ (during rest), both $q_{\\text{rev}}$ and $q_{\\text{irrev}}$ are zero. This is crucial: **no heat is generated during rest**. The temperature evolution is governed solely by the heat diffusion equation:\n    $$ \\frac{\\partial T}{\\partial t} = \\alpha \\nabla^2 T $$\n    This means that any temperature offset or spatial gradient created during the current pulse will relax and decay towards the uniform ambient temperature $T_{\\infty}$. The rate of this decay is determined by the thermal diffusivity $\\alpha$ and the geometry of the cell.\n\n5.  **Spatial Distribution:**\n    The problem assumes uniform current distribution and uniform reaction. This implies that the heat sources $q_{\\text{rev}}$ and $q_{\\text{irrev}}$ are \"approximately uniform across $\\Omega$.\" Therefore, the temperature offset $\\Delta T$ observed immediately after the pulse should be spatially uniform over the aactive face of the cell. This uniform offset will then decay diffusively, primarily from the edges of the cell inwards, as heat dissipates to the surroundings.\n\n### Option-by-Option Analysis\n\n**A. Apply a sequence of symmetric galvanostatic pulses: a charge pulse with $I(t)=-I_0$ for duration $\\tau$, followed by rest until the terminal voltage reaches OCV within $1\\,\\mathrm{mV}$; then a discharge pulse with $I(t)=+I_0$ for duration $\\tau$, followed by an identical rest. Record the IR temperature field immediately after each current cut to rest and during the ensuing OCV relaxation. Expect an antisymmetric temperature offset between the two rests: cooling after charge and heating after discharge, with the magnitude of the offset at cut-off scaling as $\\Delta T(0^+) \\propto I_0\\, T\\, \\left|\\frac{\\partial U}{\\partial T}\\right|\\, \\tau$. Because $I=0$ during rest, no new heat is generated; the temperature field relaxes according to $\\partial T/\\partial t = (\\alpha)\\, \\nabla^2 T$, and spatially the reversible offset is approximately uniform across the face, decaying diffusively toward ambient.**\n\n-   **Protocol:** This symmetric charge/discharge protocol is the correct method to distinguish the linear (reversible) and quadratic (irreversible) effects, as derived above.\n-   **Antisymmetric Signature:** For $\\frac{\\partial U}{\\partial T} < 0$, we deduced that the reversible effect is cooling for charge ($I<0$) and heating for discharge ($I>0$). The option's prediction of \"cooling after charge and heating after discharge\" for the reversible component is correct.\n-   **Scaling:** The predicted scaling for the reversible temperature offset, $\\Delta T \\propto I_0\\, T\\, \\left|\\frac{\\partial U}{\\partial T}\\right|\\, \\tau$, matches our derivation perfectly.\n-   **Behavior during Rest:** The statement that no new heat is generated and that the field relaxes according to the diffusion equation ($\\partial T/\\partial t = \\alpha \\nabla^2 T$) is correct.\n-   **Spatial Distribution:** The prediction of an initially uniform offset that decays diffusively is correct, based on the problem's assumptions.\n-   **Verdict:** **Correct**.\n\n**B. Apply a continuous discharge at $I(t)=+I_0$ and intersperse short rests. Expect reversible heat generation to persist during rest such that the IR-measured temperature continues to increase or decrease due to entropic heating during OCV relaxation. The sign of the temperature change during rest is independent of $\\frac{\\partial U}{\\partial T}$, and the magnitude scales as $\\Delta T \\propto I_0^2$.**\n\n-   **Protocol:** This protocol lacks the symmetric charge pulse, making it difficult to isolate the reversible component from the total measured heat.\n-   **Physics During Rest:** The claim that \"reversible heat generation to persist during rest\" is a fundamental error. The problem definition explicitly states $\\dot{Q}_{\\text{rev}} = 0$ when $I=0$.\n-   **Scaling:** The claim that the effect scales as $\\Delta T \\propto I_0^2$ is the scaling for irreversible heat, not reversible heat.\n-   **Verdict:** **Incorrect**. This option contains multiple fundamental errors regarding the physics of the process.\n\n**C. Use large-amplitude pulses with $I_0$ maximized and short rests to enhance signal-to-noise. Predict that the reversible entropic temperature component scales quadratically with $I_0$, $\\Delta T \\propto I_0^2$, and that hot spots should appear near current collector tabs during rest because reversible heating is strongest there. The temperature offsets after charge and discharge will be symmetric with respect to magnitude and sign.**\n\n-   **Protocol:** Using maximized $I_0$ is counterproductive for isolating the reversible component, as it enhances the $I_0^2$ irreversible term more than the $I_0$ reversible term, thus decreasing the relative signal of interest. It also likely violates the assumption that $q_{\\text{mix}}$ is negligible.\n-   **Scaling:** The statement that reversible heat scales quadratically ($\\propto I_0^2$) is false; it scales linearly ($\\propto I_0$).\n-   **Spatial Distribution:** The claim that reversible heating creates hot spots near tabs contradicts the provided assumption of uniform heat generation. Hot spots at tabs are typically an irreversible Joule heating phenomenon.\n-   **Symmetry:** The claim that offsets are \"symmetric with respect to magnitude and sign\" is false. The reversible component is antisymmetric (opposite signs).\n-   **Verdict:** **Incorrect**. Every physical prediction in this option is factually wrong based on the problem statement.\n\n**D. Use small current pulses and subtract an estimate of Joule heating $\\dot{Q}_{\\text{Joule}} \\approx I_0^2 R$ from the total to obtain the reversible component. Immediately after cut to rest, expect a spatially uniform entropic temperature offset that persists indefinitely during OCV relaxation, independent of the thermal diffusivity $\\alpha$ and geometry, with $\\Delta T \\propto I_0\\, T\\, \\frac{\\partial U}{\\partial T}$ but no decay in time.**\n\n-   **Behavior during Rest:** The central claim that the temperature offset \"persists indefinitely during OCV relaxation\" and has \"no decay in time\" is a stark violation of the laws of heat transfer (and the Second Law of Thermodynamics). Any temperature difference in a passive system must decay over time through diffusion and convection. The problem explicitly provides the diffusion equation governing this relaxation.\n-   **Scaling:** While the scaling of the initial offset is correct ($\\Delta T \\propto I_0 T \\frac{\\partial U}{\\partial T}$), the prediction of its temporal evolution is physically impossible.\n-   **Verdict:** **Incorrect**. The prediction of a persistent, non-decaying temperature offset is a fatal flaw.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "As a capstone exercise, we now synthesize our understanding into a comprehensive, spatially-resolved simulation. The ultimate goal of advanced battery modeling is to pinpoint the precise locations and sources of inefficiency. This practice  implements a powerful method from non-equilibrium thermodynamics to compute a 2D map of the local entropy production rate, $\\sigma(x,y)$. By mapping the combined irreversibilities from electrical conduction, reaction kinetics, and mass transport, you will create a powerful diagnostic tool that visualizes the \"hotspots\" of energy loss, providing direct insights for optimizing electrode design and thermal management.",
            "id": "3946833",
            "problem": "Consider a two-dimensional electrode domain represented on a uniform Cartesian grid with spatial coordinates $(x,y)$ and thickness $h$. The system is isothermal or weakly non-isothermal as specified by the test cases. The objective is to compute the local entropy production density map $\\sigma(x,y)$ due to electrical conduction, multicomponent mass transport, and electrochemical reaction irreversibility, and then to identify regions of highest irreversibility. The program must implement a principled model starting from the framework of non-equilibrium thermodynamics: entropy production is obtained by summing the products of fluxes and their conjugate thermodynamic forces. You must derive and implement the computation of each contribution using only the following foundational relations:\n- Electrical conduction: the current density $\\boldsymbol{J}$ is related to the electric field $\\boldsymbol{E}$ by $\\boldsymbol{J} = \\kappa \\boldsymbol{E}$ for an isotropic medium of electrical conductivity $\\kappa$, which implies $\\boldsymbol{J} \\cdot \\boldsymbol{E} = \\|\\boldsymbol{J}\\|^2 / \\kappa$.\n- Linear irreversible thermodynamics for mass transport: for each species $i$, the flux $\\boldsymbol{N}_i$ is proportional to its thermodynamic driving force $-\\nabla \\mu_i$, with phenomenological coefficient $L_i$ such that $\\boldsymbol{N}_i = L_i \\, (-\\nabla \\mu_i)$. This implies the local dissipation $\\boldsymbol{N}_i \\cdot (-\\nabla \\mu_i) = \\|\\boldsymbol{N}_i\\|^2 / L_i$.\n- Electrochemical reaction irreversibility at the interface (distributed volumetrically): the local volumetric Faradaic rate $r_F$ multiplied by the overpotential $\\eta$ gives the volumetric irreversible power $r_F \\eta$.\n\nThe local entropy production density $\\sigma(x,y)$ must be computed as the sum of these contributions divided by the absolute temperature $T(x,y)$:\n$$\n\\sigma(x,y) = \\frac{1}{T(x,y)} \\left[ \\frac{\\|\\boldsymbol{J}(x,y)\\|^2}{\\kappa(x,y)} + \\sum_{i} \\frac{\\|\\boldsymbol{N}_i(x,y)\\|^2}{L_i(x,y)} + r_F(x,y)\\,\\eta(x,y) \\right].\n$$\nAdditionally, the local irreversible heat generation density $q_{\\text{irrev}}(x,y)$ is given by $q_{\\text{irrev}}(x,y) = T(x,y)\\,\\sigma(x,y)$, and the reversible heat density $q_{\\text{rev}}(x,y)$ associated with the entropic contribution of the reaction is\n$$\nq_{\\text{rev}}(x,y) = T(x,y)\\, r_F(x,y)\\, \\frac{dU}{dT}(x,y),\n$$\nwhere $U$ is the equilibrium open circuit potential. Note that $q_{\\text{rev}}(x,y)$ does not contribute to $\\sigma(x,y)$ because reversible processes do not produce entropy; it is included for completeness of the modeling, but your identification of irreversibility must be based on $\\sigma(x,y)$.\n\nYour program must:\n- Construct the specified fields $\\boldsymbol{J}(x,y)$, $\\eta(x,y)$, $\\boldsymbol{N}_i(x,y)$, $T(x,y)$, $\\kappa(x,y)$, $L_i(x,y)$, $r_F(x,y)$, and $\\frac{dU}{dT}(x,y)$ on a uniform grid for each test case.\n- Compute the local entropy production density map $\\sigma(x,y)$ and the local irreversible heat density $q_{\\text{irrev}}(x,y)$.\n- Compute the total entropy production rate $S_{\\text{total}} = \\int_V \\sigma \\, dV$ using a Riemann sum approximation over the grid with $dV = (\\Delta x)(\\Delta y) h$, where $(\\Delta x)$ and $(\\Delta y)$ are the uniform grid spacings in the $x$ and $y$ directions, respectively.\n- Identify the grid index $(i_{\\max}, j_{\\max})$ of the cell with the maximum value of $\\sigma(x,y)$, where $i_{\\max}$ is the zero-based row index (along $y$) and $j_{\\max}$ is the zero-based column index (along $x$).\n\nYou must express $S_{\\text{total}}$ in watts per kelvin (W/K), $q_{\\text{irrev}}$ in watts per cubic meter (W/m³), $\\sigma$ in watts per kelvin per cubic meter (W/(K·m³)), and report $(i_{\\max}, j_{\\max})$ as integers. Angles appearing in trigonometric functions must be evaluated in radians.\n\nDefine the following test suite. For all cases, use a uniform mesh and the following conventions: the grid contains $N_x \\times N_y$ nodes, with coordinates defined by $x = 0, \\Delta x, 2\\Delta x, \\dots, (N_x-1)\\Delta x$ and $y = 0, \\Delta y, 2\\Delta y, \\dots, (N_y-1)\\Delta y$, where $\\Delta x = L_x / N_x$ and $\\Delta y = L_y / N_y$.\n\nTest Case $1$ (baseline heterogeneous electrode):\n- Geometry: $L_x = 10^{-3}$ m, $L_y = 10^{-3}$ m, $h = 5 \\times 10^{-6}$ m, $N_x = 32$, $N_y = 32$.\n- Temperature: $T(x,y) = 298$ K.\n- Electrical conductivity: $\\kappa(x,y) = 10$ S/m.\n- Current density:\n$$\nJ_x(x,y) = J_0 \\sin\\left(\\pi \\frac{x}{L_x}\\right), \\quad J_y(x,y) = J_0 \\cos\\left(\\pi \\frac{y}{L_y}\\right), \\quad J_0 = 8 \\times 10^{3} \\text{ A/m}^2.\n$$\n- Volumetric Faradaic rate and overpotential:\n$$\nr_F(x,y) = r_0 \\left[1 + 0.5 \\sin\\left(2\\pi \\frac{x}{L_x}\\right) \\sin\\left(2\\pi \\frac{y}{L_y}\\right) \\right], \\quad r_0 = 8 \\times 10^{5} \\text{ A/m}^3,\n$$\n$$\n\\eta(x,y) = 0.04 + 0.01 \\sin\\left(\\pi \\frac{x}{L_x}\\right)\\cos\\left(\\pi \\frac{y}{L_y}\\right) \\text{ V}.\n$$\n- Species fluxes (two species $i=1,2$):\n$$\n\\boldsymbol{N}_1(x,y) = N_0 \\left[ \\cos\\left(2\\pi \\frac{x}{L_x}\\right)\\sin\\left(2\\pi \\frac{y}{L_y}\\right), \\; \\sin\\left(2\\pi \\frac{x}{L_x}\\right)\\cos\\left(2\\pi \\frac{y}{L_y}\\right) \\right],\n$$\n$$\n\\boldsymbol{N}_2(x,y) = -0.8 \\, \\boldsymbol{N}_1(x,y), \\quad N_0 = 10^{-3} \\text{ mol/(m}^2 \\cdot \\text{s)}.\n$$\n- Phenomenological coefficients:\n$$\nL_1(x,y) = 10^{-9}, \\quad L_2(x,y) = 1.5 \\times 10^{-9} \\quad \\text{in units consistent with } \\boldsymbol{N}_i \\cdot (-\\nabla \\mu_i) = \\|\\boldsymbol{N}_i\\|^2 / L_i.\n$$\n- Entropic potential slope:\n$$\n\\frac{dU}{dT}(x,y) = 2 \\times 10^{-3} \\text{ V/K}.\n$$\n\nTest Case $2$ (reaction-dominated, negligible mass transport):\n- Geometry: $L_x = 5 \\times 10^{-4}$ m, $L_y = 5 \\times 10^{-4}$ m, $h = 10^{-5}$ m, $N_x = 16$, $N_y = 16$.\n- Temperature: $T(x,y) = 298 + 5 \\left(\\frac{x}{L_x}\\right)\\left(\\frac{y}{L_y}\\right)$ K.\n- Electrical conductivity: $\\kappa(x,y) = 500$ S/m.\n- Current density:\n$$\nJ_x(x,y) = J_0 \\left(\\frac{x}{L_x}\\right), \\quad J_y(x,y) = 0.5 J_0 \\left(\\frac{y}{L_y}\\right), \\quad J_0 = 10^{3} \\text{ A/m}^2.\n$$\n- Volumetric Faradaic rate and overpotential:\n$$\nr_F(x,y) = r_0 \\left[1 - 0.5 \\left(\\frac{x}{L_x}\\right) \\right], \\quad r_0 = 4 \\times 10^{5} \\text{ A/m}^3,\n$$\n$$\n\\eta(x,y) = 0.02 \\text{ V}.\n$$\n- Species fluxes: $\\boldsymbol{N}_1(x,y) = \\boldsymbol{0}$, $\\boldsymbol{N}_2(x,y) = \\boldsymbol{0}$.\n- Phenomenological coefficients: $L_1(x,y)$ and $L_2(x,y)$ are not used since fluxes are zero, but set $L_1(x,y) = 10^{-9}$, $L_2(x,y) = 10^{-9}$ for completeness.\n- Entropic potential slope:\n$$\n\\frac{dU}{dT}(x,y) = -1.5 \\times 10^{-3} \\text{ V/K}.\n$$\n\nTest Case $3$ (transport-limited with spatially varying conductivity and flux coefficients):\n- Geometry: $L_x = 2 \\times 10^{-3}$ m, $L_y = 10^{-3}$ m, $h = 2 \\times 10^{-5}$ m, $N_x = 32$, $N_y = 24$.\n- Temperature: $T(x,y) = 305$ K.\n- Electrical conductivity:\n$$\n\\kappa(x,y) = 0.5 + 1.5 \\left(\\frac{x}{L_x}\\right) + 0.2 \\left[\\sin\\left(\\pi \\frac{y}{L_y}\\right) + 1 \\right] \\quad \\text{S/m}.\n$$\n- Current density:\n$$\nJ_x(x,y) = J_0 \\left(1 - \\frac{x}{L_x}\\right)\\sin\\left(\\pi \\frac{y}{L_y}\\right), \\quad\nJ_y(x,y) = J_0 \\left(\\frac{x}{L_x}\\right)\\cos\\left(\\pi \\frac{y}{L_y}\\right), \\quad J_0 = 6 \\times 10^{3} \\text{ A/m}^2.\n$$\n- Volumetric Faradaic rate and overpotential:\n$$\nr_F(x,y) = r_0 \\left[1 + 0.3 \\left(\\frac{y}{L_y}\\right) \\right], \\quad r_0 = 7 \\times 10^{5} \\text{ A/m}^3,\n$$\n$$\n\\eta(x,y) = 0.03 + 0.015 \\left(\\frac{x}{L_x}\\right) \\text{ V}.\n$$\n- Species fluxes (two species $i=1,2$):\n$$\n\\boldsymbol{N}_1(x,y) = N_0 \\left[ \\sin\\left(2\\pi \\frac{x}{L_x}\\right), \\; \\cos\\left(2\\pi \\frac{y}{L_y}\\right) \\right], \\quad\n\\boldsymbol{N}_2(x,y) = 0.6 N_0 \\left[ \\cos\\left(2\\pi \\frac{x}{L_x}\\right), \\; -\\sin\\left(2\\pi \\frac{y}{L_y}\\right) \\right],\n$$\nwith $N_0 = 5 \\times 10^{-4}$ mol/(m²·s).\n- Phenomenological coefficients:\n$$\nL_1(x,y) = 0.8 \\times 10^{-9} \\left[1 + 0.5 \\left(\\frac{y}{L_y}\\right) \\right], \\quad\nL_2(x,y) = 1.2 \\times 10^{-9} \\left[1 + 0.1 \\left(\\frac{x}{L_x}\\right) \\right].\n$$\n- Entropic potential slope:\n$$\n\\frac{dU}{dT}(x,y) = 1.0 \\times 10^{-3} \\text{ V/K}.\n$$\n\nFor each test case, compute and return the following three quantities:\n- $S_{\\text{total}}$ in W/K.\n- $\\max \\sigma$ in W/(K·m³).\n- $(i_{\\max}, j_{\\max})$ as a list of two integers.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result formatted as a sublist of the form $[S_{\\text{total}},\\max \\sigma,i_{\\max},j_{\\max}]$. For example: $[[a,b,i,j],[\\dots],[\\dots]]$. No other text should be printed.",
            "solution": "The problem requires the computation of spatial maps of entropy production in a two-dimensional battery electrode domain, based on fundamental principles of nonequilibrium thermodynamics. The total local entropy production density, $\\sigma(x,y)$, is the sum of contributions from all irreversible processes occurring within the system, divided by the local absolute temperature $T(x,y)$. The problem provides specific models for three such processes: electrical conduction (Joule heating), electrochemical reaction, and multicomponent mass transport.\n\nThe foundational principle for this analysis is that the local entropy production density (per unit volume) is given by the sum of products of thermodynamic fluxes and their conjugate forces:\n$$\n\\sigma = \\frac{1}{T} \\sum_k \\boldsymbol{\\mathcal{J}}_k \\cdot \\boldsymbol{\\mathcal{X}}_k\n$$\nwhere $\\boldsymbol{\\mathcal{J}}_k$ represents a flux (e.g., current density, mass flux) and $\\boldsymbol{\\mathcal{X}}_k$ is the corresponding thermodynamic driving force (e.g., electric field, chemical potential gradient). The problem specifies the following contributions:\n\n1.  **Electrical Conduction:** The flux is the electric current density $\\boldsymbol{J}$, and the force is the electric field $\\boldsymbol{E}$. The dissipation (irreversible power density) is $\\boldsymbol{J} \\cdot \\boldsymbol{E}$. Using the provided linear phenomenological law (Ohm's law), $\\boldsymbol{J} = \\kappa \\boldsymbol{E}$, we can express the force in terms of the flux: $\\boldsymbol{E} = \\boldsymbol{J} / \\kappa$. The dissipation term becomes $\\|\\boldsymbol{J}\\|^2 / \\kappa$.\n\n2.  **Electrochemical Reaction:** The irreversible power density at the electrode-electrolyte interface, distributed volumetrically, is given as the product of the volumetric Faradaic reaction rate $r_F$ and the surface overpotential $\\eta$. The overpotential represents the deviation from the equilibrium potential and is the driving force for the reaction. The dissipation is thus $r_F \\eta$.\n\n3.  **Mass Transport:** For each species $i$, the flux is the molar flux $\\boldsymbol{N}_i$, and the conjugate force is the negative gradient of its chemical potential, $-\\nabla\\mu_i$. The problem provides a linear relationship between the flux and force, $\\boldsymbol{N}_i = L_i (-\\nabla\\mu_i)$, where $L_i$ is a phenomenological coefficient. The dissipation for species $i$ is $\\boldsymbol{N}_i \\cdot (-\\nabla\\mu_i) = \\|\\boldsymbol{N}_i\\|^2 / L_i$. The total dissipation from mass transport is the sum over all species.\n\nCombining these contributions, the total irreversible heat generation density $q_{\\text{irrev}}(x,y)$ is:\n$$\nq_{\\text{irrev}}(x,y) = \\frac{\\|\\boldsymbol{J}(x,y)\\|^2}{\\kappa(x,y)} + r_F(x,y)\\eta(x,y) + \\sum_{i} \\frac{\\|\\boldsymbol{N}_i(x,y)\\|^2}{L_i(x,y)}\n$$\nThe local entropy production density $\\sigma(x,y)$ is then obtained by dividing by the local absolute temperature:\n$$\n\\sigma(x,y) = \\frac{q_{\\text{irrev}}(x,y)}{T(x,y)}\n$$\nThe reversible heat component, $q_{\\text{rev}}(x,y) = T(x,y) r_F(x,y) \\frac{dU}{dT}(x,y)$, related to the entropy of reaction, does not contribute to entropy production and is correctly excluded from the calculation of $\\sigma(x,y)$.\n\nThe algorithmic approach to solving the problem is as follows:\nFirst, a uniform Cartesian grid is established for the domain $[0, L_x] \\times [0, L_y]$ with $N_y$ rows and $N_x$ columns. The coordinates $(x_j, y_i)$ for a grid cell at row index $i$ and column index $j$ are defined as $x_j = j \\cdot \\Delta x$ and $y_i = i \\cdot \\Delta y$, where $\\Delta x = L_x / N_x$ and $\\Delta y = L_y / N_y$ for $j \\in \\{0, \\dots, N_x-1\\}$ and $i \\in \\{0, \\dots, N_y-1\\}$.\n\nSecond, all spatially varying physical quantities provided in each test case—temperature $T(x,y)$, conductivity $\\kappa(x,y)$, current density components $J_x(x,y)$ and $J_y(x,y)$, reaction rate $r_F(x,y)$, overpotential $\\eta(x,y)$, species fluxes $\\boldsymbol{N}_i(x,y)$, and phenomenological coefficients $L_i(x,y)$—are evaluated at each point on this grid. This yields a set of $N_y \\times N_x$ matrices representing the spatial distribution of each quantity.\n\nThird, using these matrices, the three components of the irreversible heat generation density ($q_{\\text{ohm}}$, $q_{\\text{rxn}}$, $q_{\\text{transport}}$) are computed element-wise.\n- Ohmic term: $q_{\\text{ohm}} = (J_x^2 + J_y^2) / \\kappa$\n- Reaction term: $q_{\\text{rxn}} = r_F \\cdot \\eta$\n- Transport term: $q_{\\text{transport}} = \\sum_i (N_{ix}^2 + N_{iy}^2) / L_i$\n\nThese are summed to obtain the total irreversible heat generation map, $q_{\\text{irrev}} = q_{\\text{ohm}} + q_{\\text{rxn}} + q_{\\text{transport}}$.\n\nFourth, the entropy production density map $\\sigma(x,y)$ is calculated by dividing the $q_{\\text{irrev}}$ matrix by the temperature matrix $T(x,y)$ on an element-by-element basis.\n\nFinally, the required outputs are derived from the $\\sigma$ map:\n- The total entropy production rate, $S_{\\text{total}}$, is computed by approximating the volume integral $\\int_V \\sigma \\, dV$ with a Riemann sum over the grid: $S_{\\text{total}} = \\left(\\sum_{i,j} \\sigma_{ij}\\right) \\Delta V$, where the volume of each grid cell is $\\Delta V = \\Delta x \\cdot \\Delta y \\cdot h$.\n- The maximum value of the entropy production density, $\\max \\sigma$, is found by taking the maximum value in the $\\sigma$ matrix.\n- The grid indices $(i_{\\max}, j_{\\max})$ corresponding to this maximum value are identified. The row index $i_{\\max}$ corresponds to the $y$-direction, and the column index $j_{\\max}$ corresponds to the $x$-direction.\n\nThis procedure is applied systematically to each of the three test cases, yielding the specified results for each. All numerical computations are performed using the `numpy` library for efficient array operations.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_case(Lx, Ly, h, Nx, Ny, T_field, K_field, Jx_field, Jy_field, rF_field, eta_field, N_fields, L_fields):\n    \"\"\"\n    Computes entropy production metrics for a single test case.\n\n    Args:\n        Lx, Ly, h (float): Domain dimensions and thickness.\n        Nx, Ny (int): Grid resolution.\n        T_field (np.ndarray): Temperature map [K].\n        K_field (np.ndarray): Electrical conductivity map [S/m].\n        Jx_field, Jy_field (np.ndarray): Current density component maps [A/m^2].\n        rF_field (np.ndarray): Volumetric Faradaic rate map [A/m^3].\n        eta_field (np.ndarray): Overpotential map [V].\n        N_fields (list of tuples): List of species flux component maps [(N_ix, N_iy), ...], [mol/(m^2 s)].\n        L_fields (list): List of phenomenological coefficients [mol^2/(J m s)].\n\n    Returns:\n        list: [S_total, max_sigma, i_max, j_max].\n    \"\"\"\n    dx = Lx / Nx\n    dy = Ly / Ny\n    dV = dx * dy * h\n\n    # Calculate dissipation densities (W/m^3)\n    # Ohmic dissipation\n    q_ohm = (Jx_field**2 + Jy_field**2) / K_field\n\n    # Reaction dissipation\n    q_rxn = rF_field * eta_field\n\n    # Mass transport dissipation\n    q_transport = np.zeros_like(Jx_field)\n    for i in range(len(N_fields)):\n        N_vec = N_fields[i]  # Tuple (N_ix_field, N_iy_field)\n        L_val = L_fields[i]  # Scalar or array\n        q_transport += (N_vec[0]**2 + N_vec[1]**2) / L_val\n\n    # Total irreversible heat generation density\n    q_irrev = q_ohm + q_rxn + q_transport\n    \n    # Entropy production density (W/(K*m^3))\n    sigma = q_irrev / T_field\n\n    # Total entropy production rate (W/K)\n    S_total = np.sum(sigma) * dV\n    \n    # Maximum entropy production density\n    max_sigma = np.max(sigma)\n    \n    # Location of maximum\n    flat_idx = np.argmax(sigma)\n    i_max, j_max = np.unravel_index(flat_idx, sigma.shape)\n    \n    return [S_total, max_sigma, int(i_max), int(j_max)]\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    results = []\n\n    # Test Case 1\n    Lx, Ly, h, Nx, Ny = 1e-3, 1e-3, 5e-6, 32, 32\n    dx, dy = Lx / Nx, Ly / Ny\n    x_coords = np.arange(Nx) * dx\n    y_coords = np.arange(Ny) * dy\n    xx, yy = np.meshgrid(x_coords, y_coords, indexing='xy')\n\n    T_field = np.full((Ny, Nx), 298.0)\n    K_field = np.full((Ny, Nx), 10.0)\n    J0 = 8e3\n    Jx_field = J0 * np.sin(np.pi * xx / Lx)\n    Jy_field = J0 * np.cos(np.pi * yy / Ly)\n    r0 = 8e5\n    rF_field = r0 * (1 + 0.5 * np.sin(2 * np.pi * xx / Lx) * np.sin(2 * np.pi * yy / Ly))\n    eta_field = 0.04 + 0.01 * np.sin(np.pi * xx / Lx) * np.cos(np.pi * yy / Ly)\n    N0 = 1e-3\n    N1x = N0 * (np.cos(2 * np.pi * xx / Lx) * np.sin(2 * np.pi * yy / Ly))\n    N1y = N0 * (np.sin(2 * np.pi * xx / Lx) * np.cos(2 * np.pi * yy / Ly))\n    N_fields = [(N1x, N1y), (-0.8 * N1x, -0.8 * N1y)]\n    L_fields = [1e-9, 1.5e-9]\n\n    results.append(calculate_case(Lx, Ly, h, Nx, Ny, T_field, K_field, Jx_field, Jy_field, rF_field, eta_field, N_fields, L_fields))\n\n    # Test Case 2\n    Lx, Ly, h, Nx, Ny = 5e-4, 5e-4, 1e-5, 16, 16\n    dx, dy = Lx / Nx, Ly / Ny\n    x_coords = np.arange(Nx) * dx\n    y_coords = np.arange(Ny) * dy\n    xx, yy = np.meshgrid(x_coords, y_coords, indexing='xy')\n\n    T_field = 298.0 + 5.0 * (xx / Lx) * (yy / Ly)\n    K_field = np.full((Ny, Nx), 500.0)\n    J0 = 1e3\n    Jx_field = J0 * (xx / Lx)\n    Jy_field = 0.5 * J0 * (yy / Ly)\n    r0 = 4e5\n    rF_field = r0 * (1 - 0.5 * (xx / Lx))\n    eta_field = np.full((Ny, Nx), 0.02)\n    N_fields = [] # Fluxes are zero\n    L_fields = []\n\n    results.append(calculate_case(Lx, Ly, h, Nx, Ny, T_field, K_field, Jx_field, Jy_field, rF_field, eta_field, N_fields, L_fields))\n\n    # Test Case 3\n    Lx, Ly, h, Nx, Ny = 2e-3, 1e-3, 2e-5, 32, 24\n    dx, dy = Lx / Nx, Ly / Ny\n    x_coords = np.arange(Nx) * dx\n    y_coords = np.arange(Ny) * dy\n    xx, yy = np.meshgrid(x_coords, y_coords, indexing='xy')\n\n    T_field = np.full((Ny, Nx), 305.0)\n    K_field = 0.5 + 1.5 * (xx / Lx) + 0.2 * (np.sin(np.pi * yy / Ly) + 1.0)\n    J0 = 6e3\n    Jx_field = J0 * (1 - xx / Lx) * np.sin(np.pi * yy / Ly)\n    Jy_field = J0 * (xx / Lx) * np.cos(np.pi * yy / Ly)\n    r0 = 7e5\n    rF_field = r0 * (1 + 0.3 * (yy / Ly))\n    eta_field = 0.03 + 0.015 * (xx / Lx)\n    N0 = 5e-4\n    N1x = N0 * np.sin(2 * np.pi * xx / Lx)\n    N1y = N0 * np.cos(2 * np.pi * yy / Ly)\n    N2x = 0.6 * N0 * np.cos(2 * np.pi * xx / Lx)\n    N2y = -0.6 * N0 * np.sin(2 * np.pi * yy / Ly)\n    N_fields = [(N1x, N1y), (N2x, N2y)]\n    L1_field = 0.8e-9 * (1 + 0.5 * (yy / Ly))\n    L2_field = 1.2e-9 * (1 + 0.1 * (xx / Lx))\n    L_fields = [L1_field, L2_field]\n\n    results.append(calculate_case(Lx, Ly, h, Nx, Ny, T_field, K_field, Jx_field, Jy_field, rF_field, eta_field, N_fields, L_fields))\n\n    # Format and print the final output\n    sub_results_str = [f\"[{s},{m},{i},{j}]\" for s, m, i, j in results]\n    print(f\"[{','.join(sub_results_str)}]\")\n\nsolve()\n```"
        }
    ]
}