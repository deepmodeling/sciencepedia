{
    "hands_on_practices": [
        {
            "introduction": "This first practice establishes the fundamental link between an easily measured experimental value, the Coulombic Efficiency ($CE$), and the underlying rate of Loss of Lithium Inventory (LLI). By modeling a parasitic side reaction with a time-varying current, you will learn to quantify these irreversible losses directly from standard cycling data. This exercise  is crucial for bridging the gap between high-level performance metrics and the physical processes that govern battery degradation.",
            "id": "3925216",
            "problem": "A lithium-ion full cell with initial nominal charge capacity $Q_{0} = 3.000\\,\\text{Ah}$ is cycled under a constant-current, constant-depth-of-discharge protocol. Each cycle consists of a constant-current charge at $I_{\\text{ch}} = 3.000\\,\\text{A}$ for a duration $t_{\\text{c}} = 1.000\\,\\text{h}$, immediately followed by a constant-current discharge that returns the cell to its initial state of charge. Assume there is no loss of active material (LAM) and that all irreversible loss arises from loss of lithium inventory (LLI) due to a parasitic reduction reaction at the negative electrode that occurs only during the charge step.\n\nIn an automated characterization experiment, the measured Coulombic efficiency (CE), defined as the ratio of discharged charge to charged charge per cycle, is observed to be constant over many cycles at the value $\\eta_{\\text{CE,meas}} = 0.99975$ under this protocol. During the charge step of each cycle, the parasitic current is modeled as time-varying and repeatable from cycle to cycle:\n$$\ni_{\\text{par}}(t) \\;=\\; i_{\\infty} \\;+\\; i_{1}\\,\\exp\\!\\left(-\\frac{t}{\\tau}\\right), \\qquad 0 \\le t \\le t_{\\text{c}},\n$$\nwith $i_{\\infty} = 0.000500\\,\\text{A}$ and $\\tau = 0.1000\\,\\text{h}$. During discharge, the parasitic current is negligible. The cycler’s control is on the main applied current $I_{\\text{ch}}$, and the parasitic current does not alter the charge time $t_{\\text{c}}$.\n\nStarting from Faraday’s law and the definition of Coulombic efficiency, derive the expression that relates the measured $\\eta_{\\text{CE,meas}}$ to the model parameters, solve for the unknown amplitude $i_{1}$, and then compute the total LLI accumulated after $N = 1000$ identical cycles by integrating $i_{\\text{par}}(t)$ over all charge steps. Express the final LLI as an amount of charge in $\\text{Ah}$. Round your final answer to four significant figures.",
            "solution": "The problem requires us to calculate the total Loss of Lithium Inventory (LLI) in a lithium-ion cell after a specified number of cycles, based on a given model for a parasitic side reaction. The solution will proceed in three stages as directed: first, deriving the relationship between the measured Coulombic efficiency and the parasitic current model parameters; second, solving for the unknown model parameter $i_{1}$; and third, calculating the total LLI accumulated over $N$ cycles.\n\nLet us begin by defining the relevant quantities based on Faraday's laws of electrolysis. The amount of charge, $Q$, is the time integral of the electric current, $i(t)$.\n\nDuring the charge step of duration $t_{\\text{c}}$, the cycler applies a constant current $I_{\\text{ch}}$. The total charge passed by the cycler is:\n$$\nQ_{\\text{ch}} = I_{\\text{ch}} \\times t_{\\text{c}}\n$$\nThis total charge is partitioned into two pathways at the negative electrode: the charge that is stored via the desired lithium intercalation reaction, which we denote as $Q_{\\text{int}}$, and the charge consumed by the irreversible parasitic reaction, which we denote as $Q_{\\text{par}}$. By conservation of charge:\n$$\nQ_{\\text{ch}} = Q_{\\text{int}} + Q_{\\text{par}}\n$$\nThe parasitic charge $Q_{\\text{par}}$ is the integral of the parasitic current $i_{\\text{par}}(t)$ over the charge duration:\n$$\nQ_{\\text{par}} = \\int_{0}^{t_{\\text{c}}} i_{\\text{par}}(t) \\, dt\n$$\nDuring the discharge step, the problem states that the parasitic current is negligible. Therefore, the charge that can be extracted from the cell, $Q_{\\text{dis}}$, is equal to the charge that was successfully intercalated during the preceding charge step:\n$$\nQ_{\\text{dis}} = Q_{\\text{int}}\n$$\nThe Coulombic efficiency, $\\eta_{\\text{CE,meas}}$, is defined as the ratio of discharged charge to charged charge:\n$$\n\\eta_{\\text{CE,meas}} = \\frac{Q_{\\text{dis}}}{Q_{\\text{ch}}}\n$$\nSubstituting the relationships derived above, we can express the Coulombic efficiency in terms of the parasitic charge:\n$$\n\\eta_{\\text{CE,meas}} = \\frac{Q_{\\text{int}}}{Q_{\\text{ch}}} = \\frac{Q_{\\text{ch}} - Q_{\\text{par}}}{Q_{\\text{ch}}} = 1 - \\frac{Q_{\\text{par}}}{Q_{\\text{ch}}}\n$$\nThis gives us a direct relationship for the parasitic charge per cycle based on the measured efficiency:\n$$\nQ_{\\text{par}} = (1 - \\eta_{\\text{CE,meas}}) Q_{\\text{ch}}\n$$\nNow, we introduce the specified model for the parasitic current:\n$$\ni_{\\text{par}}(t) = i_{\\infty} + i_{1}\\,\\exp\\left(-\\frac{t}{\\tau}\\right)\n$$\nWe integrate this expression from $t=0$ to $t=t_{\\text{c}}$ to find $Q_{\\text{par}}$ in terms of the model parameters:\n$$\nQ_{\\text{par}} = \\int_{0}^{t_{\\text{c}}} \\left( i_{\\infty} + i_{1}\\,\\exp\\left(-\\frac{t}{\\tau}\\right) \\right) \\, dt = \\left[ i_{\\infty}t - i_{1}\\tau\\exp\\left(-\\frac{t}{\\tau}\\right) \\right]_{0}^{t_{\\text{c}}}\n$$\n$$\nQ_{\\text{par}} = \\left( i_{\\infty}t_{\\text{c}} - i_{1}\\tau\\exp\\left(-\\frac{t_{\\text{c}}}{\\tau}\\right) \\right) - \\left( 0 - i_{1}\\tau\\exp(0) \\right)\n$$\n$$\nQ_{\\text{par}} = i_{\\infty}t_{\\text{c}} + i_{1}\\tau\\left(1 - \\exp\\left(-\\frac{t_{\\text{c}}}{\\tau}\\right)\\right)\n$$\nThis completes the first part of the task: to relate the measured $\\eta_{\\text{CE,meas}}$ to the model parameters. We equate the two expressions for $Q_{\\text{par}}$:\n$$\n(1 - \\eta_{\\text{CE,meas}}) Q_{\\text{ch}} = i_{\\infty}t_{\\text{c}} + i_{1}\\tau\\left(1 - \\exp\\left(-\\frac{t_{\\text{c}}}{\\tau}\\right)\\right)\n$$\nSubstituting $Q_{\\text{ch}} = I_{\\text{ch}}t_{\\text{c}}$, we get:\n$$\n(1 - \\eta_{\\text{CE,meas}}) I_{\\text{ch}}t_{\\text{c}} = i_{\\infty}t_{\\text{c}} + i_{1}\\tau\\left(1 - \\exp\\left(-\\frac{t_{\\text{c}}}{\\tau}\\right)\\right)\n$$\nThe second part of the task is to solve for the unknown amplitude $i_{1}$. We rearrange the above equation:\n$$\ni_{1}\\tau\\left(1 - \\exp\\left(-\\frac{t_{\\text{c}}}{\\tau}\\right)\\right) = (1 - \\eta_{\\text{CE,meas}}) I_{\\text{ch}}t_{\\text{c}} - i_{\\infty}t_{\\text{c}}\n$$\n$$\ni_{1} = \\frac{t_{\\text{c}}\\left( (1 - \\eta_{\\text{CE,meas}})I_{\\text{ch}} - i_{\\infty} \\right)}{\\tau\\left(1 - \\exp\\left(-\\frac{t_{\\text{c}}}{\\tau}\\right)\\right)}\n$$\nThis provides the symbolic solution for $i_{1}$.\n\nThe third and final part of the task is to compute the total LLI accumulated after $N = 1000$ identical cycles. The problem states that LLI is the sole degradation mechanism and that the parasitic process is repeatable. Thus, the total LLI, denoted $Q_{\\text{LLI, total}}$, is simply $N$ times the parasitic charge lost in a single cycle, $Q_{\\text{par}}$.\n$$\nQ_{\\text{LLI, total}} = N \\times Q_{\\text{par}}\n$$\nWhile one could compute $i_{1}$ numerically and substitute it back into the integral expression for $Q_{\\text{par}}$, a more direct and robust method is to use the relationship between $Q_{\\text{par}}$ and the measured Coulombic efficiency, as this relies directly on experimental data.\n$$\nQ_{\\text{LLI, total}} = N \\times (1 - \\eta_{\\text{CE,meas}}) Q_{\\text{ch}} = N (1 - \\eta_{\\text{CE,meas}}) I_{\\text{ch}} t_{\\text{c}}\n$$\nWe now substitute the given numerical values into this expression:\n- Number of cycles, $N = 1000$\n- Measured Coulombic efficiency, $\\eta_{\\text{CE,meas}} = 0.99975$\n- Charge current, $I_{\\text{ch}} = 3.000\\,\\text{A}$\n- Charge duration, $t_{\\text{c}} = 1.000\\,\\text{h}$\n\nLet's calculate the value:\n$$\nQ_{\\text{LLI, total}} = 1000 \\times (1 - 0.99975) \\times (3.000\\,\\text{A}) \\times (1.000\\,\\text{h})\n$$\n$$\nQ_{\\text{LLI, total}} = 1000 \\times (0.00025) \\times (3.000\\,\\text{Ah})\n$$\n$$\nQ_{\\text{LLI, total}} = 1000 \\times 0.00075\\,\\text{Ah}\n$$\n$$\nQ_{\\text{LLI, total}} = 0.75\\,\\text{Ah}\n$$\nThe problem requires the final answer to be rounded to four significant figures. Therefore, we express the result as $0.7500\\,\\text{Ah}$.",
            "answer": "$$\\boxed{0.7500}$$"
        },
        {
            "introduction": "Building on the concept of per-cycle loss, this practice introduces a powerful phenomenological model that projects long-term capacity retention from an effective Coulombic Efficiency ($CE_{\\mathrm{eff}}$). You will work backward from a cycle life target to determine the required $CE_{\\mathrm{eff}}$, a common task in battery design, and explain why this model is suitable for LLI but not for Loss of Active Material (LAM). This exercise  provides a simple yet essential tool for lifetime prediction and for distinguishing between different degradation mechanisms.",
            "id": "3925229",
            "problem": "A lithium-ion cell in an automated battery design and simulation environment is to be evaluated for cycle life under Loss of Lithium Inventory (LLI) dominance with stable active materials. Let the cyclable lithium inventory be denoted by $L_k$ after $k$ full cycles and the maximum reversible capacity be $Q_k$. Assume $Q_k$ is limited by lithium inventory, i.e., $Q_k \\propto L_k$, and that per-cycle irreversible side reactions consume a constant fraction of the cyclable inventory, which can be represented by an effective Coulombic Efficiency (CE), denoted $CE_{\\mathrm{eff}} \\in (0,1)$, defined as the per-cycle survival fraction of $L_k$. Starting from conservation of lithium and the assumption of a constant fractional loss per cycle, derive an analytical expression for the capacity retention after $N$ cycles, defined as $R_N = Q_N/Q_0$, in terms of $CE_{\\mathrm{eff}}$ and $N$. Then, for a target retention $R_{\\mathrm{t}} = 0.80$ after $N = 1000$ cycles, compute the required $CE_{\\mathrm{eff}}$. Express your final result as a unitless decimal fraction and round your answer to six significant figures.\n\nFinally, based on the derived retention law and the definition of CE, explain briefly why increasing $CE_{\\mathrm{eff}}$ directly mitigates LLI-dominated fade but does not address Loss of Active Material (LAM)-dominated capacity loss, where the capacity is limited by the available active sites rather than lithium inventory.",
            "solution": "This problem has three parts: 1) derive an analytical expression for capacity retention, 2) compute the required effective Coulombic Efficiency ($CE_{\\mathrm{eff}}$) for a given cycle life target, and 3) explain the model's relevance to LLI versus LAM.\n\n**1. Derivation of the Capacity Retention Law**\n\nThe model is based on the premise that a constant fraction of the cyclable lithium inventory, $L_k$, is lost in each cycle. The survival fraction is given by the effective Coulombic Efficiency, $CE_{\\mathrm{eff}}$. This can be expressed as a recurrence relation:\n$$L_{k+1} = CE_{\\mathrm{eff}} \\cdot L_k$$\nStarting from the initial inventory $L_0$, we can unroll this relation for $N$ cycles:\n$$L_N = (CE_{\\mathrm{eff}})^N L_0$$\nThe problem states that capacity, $Q_k$, is directly proportional to the cyclable lithium inventory, which is characteristic of an LLI-limited cell with stable active material. Thus, $Q_k = \\alpha L_k$, where $\\alpha$ is a constant.\nThe capacity retention after $N$ cycles, $R_N$, is the ratio of capacity at cycle $N$ to the initial capacity:\n$$R_N = \\frac{Q_N}{Q_0} = \\frac{\\alpha L_N}{\\alpha L_0} = \\frac{L_N}{L_0}$$\nSubstituting our expression for $L_N$ yields the final retention law:\n$$R_N = (CE_{\\mathrm{eff}})^N$$\n\n**2. Calculation of Required Coulombic Efficiency**\n\nWe are given a target retention $R_N = 0.80$ after $N = 1000$ cycles. We use the derived retention law to solve for the required $CE_{\\mathrm{eff}}$:\n$$0.80 = (CE_{\\mathrm{eff}})^{1000}$$\nTo solve for $CE_{\\mathrm{eff}}$, we take the 1000th root of both sides:\n$$CE_{\\mathrm{eff}} = (0.80)^{1/1000}$$\nThis can be computed numerically:\n$$CE_{\\mathrm{eff}} = \\exp\\left(\\frac{\\ln(0.80)}{1000}\\right) \\approx \\exp\\left(\\frac{-0.22314355}{1000}\\right) \\approx 0.99977689$$\nRounding the result to six significant figures as requested gives:\n$$CE_{\\mathrm{eff}} \\approx 0.999777$$\n\n**3. Explanation of LLI vs. LAM Fade Mechanisms**\n\nThe derived retention law, $R_N = (CE_{\\mathrm{eff}})^N$, is fundamentally a model of lithium conservation.\n- **Mitigation of LLI:** The equation directly links capacity retention $R_N$ to $CE_{\\mathrm{eff}}$. The parameter $CE_{\\mathrm{eff}}$ quantifies the fraction of cyclable lithium *not* consumed by side reactions (like SEI growth) each cycle. Improving cell chemistry to minimize these parasitic reactions increases $CE_{\\mathrm{eff}}$ (bringing it closer to 1), which makes $(CE_{\\mathrm{eff}})^N$ decay more slowly and thus directly mitigates LLI-dominated capacity fade.\n\n- **Inapplicability to LAM:** Loss of Active Material (LAM) is a mechanism where capacity is limited by the amount of available host material (the number of intercalation sites), not the amount of cyclable lithium. Processes like particle cracking or electrical isolation reduce the number of active sites. The parameter $CE_{\\mathrm{eff}}$ only accounts for the loss of lithium; it has no physical relationship to the structural integrity of the electrodes. Therefore, even if $CE_{\\mathrm{eff}} = 1$ (no lithium is lost), capacity would still fade if active material is being lost. The model is built on the premise of a stable electrode structure and is thus inadequate for describing LAM-dominated fade.",
            "answer": "$$\\boxed{0.999777}$$"
        },
        {
            "introduction": "This final practice moves from analytical models to dynamic, physics-based simulation, a core activity in modern battery engineering. You will implement a mass-balance model that allocates lithium among various reservoirs, including cyclable inventory, SEI, and plated lithium, while also accounting for the coupled loss of active material. This coding exercise  offers hands-on experience in building a state-space model for battery degradation and using it to perform a sensitivity analysis, providing insight into how competing degradation pathways impact cell performance.",
            "id": "3925258",
            "problem": "You are tasked with building a runnable program that simulates lithium conservation in a rechargeable cell and quantifies how small changes in the side-product formation rate influence the deliverable capacity. The simulation must allocate lithium among intercalation sites and side-product reservoirs: Solid Electrolyte Interphase (SEI), plated lithium, and dissolved species. The goal is to compute the sensitivity of the usable capacity to perturbations in the SEI formation rate.\n\nStarting point and constraints:\n- Use the conservation of mass principle: the total lithium inventory is conserved across reservoirs absent external sources or sinks. Let the total initial cyclable lithium inventory be $N_{\\mathrm{Li},0}$ (in moles), and the initial available intercalation site capacity be $N_{\\mathrm{sites},0}$ (in moles of lithium that can be intercalated).\n- Use Faraday's law of electrolysis to relate electric current to lithium flux. Over an infinitesimal time $dt$, the absolute current magnitude $|I(t)|$ (in amperes) corresponds to a charge $|I(t)|\\,dt$ (in coulombs), which can be linked to a lithium flux via a yield factor.\n- Define reservoir state variables $N_{\\mathrm{SEI}}(t)$, $N_{\\mathrm{plate}}(t)$, $N_{\\mathrm{diss}}(t)$, and $N_{\\mathrm{sites}}(t)$ (all in moles). The cyclable lithium remaining is $N_{\\mathrm{cycl}}(t) = N_{\\mathrm{Li},0} - N_{\\mathrm{SEI}}(t) - N_{\\mathrm{plate}}(t) - N_{\\mathrm{diss}}(t)$.\n- The usable capacity at time $t$ is limited by the smaller of the remaining cyclable lithium and the remaining intercalation site capacity. Let $F$ be Faraday's constant. The deliverable capacity $Q_{\\mathrm{use}}(t)$ (in ampere-hours) is\n$$\nQ_{\\mathrm{use}}(t) = \\frac{F}{3600}\\,\\min\\!\\big(N_{\\mathrm{cycl}}(t),\\,N_{\\mathrm{sites}}(t)\\big).\n$$\n\nModel the side-product formation and loss of active material using the following physically grounded relations, expressed as rates over $dt$:\n- SEI growth consumes cyclable lithium in proportion to the passed charge:\n$$\n\\frac{dN_{\\mathrm{SEI}}}{dt} = k_{\\mathrm{SEI}}\\,|I(t)|,\n$$\nwhere $k_{\\mathrm{SEI}}$ (in moles per coulomb) is the SEI yield per unit charge passed. This couples to loss of active material via\n$$\n\\frac{dN_{\\mathrm{sites}}}{dt} = -\\alpha_{\\mathrm{LAM}}\\,\\frac{dN_{\\mathrm{SEI}}}{dt},\n$$\nwith $\\alpha_{\\mathrm{LAM}}$ (dimensionless, in moles of sites lost per mole of SEI-associated lithium).\n- Lithium plating occurs during charge when the current exceeds a limiting value $I_{\\lim}$:\n$$\n\\frac{dN_{\\mathrm{plate}}}{dt} = \n\\begin{cases}\nk_{\\mathrm{plate}}\\,\\big(I(t) - I_{\\lim}\\big), & \\text{if } I(t) > I_{\\lim},\\\\\n0, & \\text{otherwise,}\n\\end{cases}\n$$\nwhere $k_{\\mathrm{plate}}$ (in moles per coulomb) is the plating yield per excess coulomb. Plated lithium can be stripped during discharge and also dissolved into passivated species:\n$$\n\\frac{dN_{\\mathrm{plate}}}{dt}\\bigg|_{\\mathrm{strip}} = \n\\begin{cases}\n- k_{\\mathrm{strip}}\\,|I(t)|, & \\text{if } I(t) < 0,\\\\\n0, & \\text{otherwise,}\n\\end{cases}\n\\quad\n\\frac{dN_{\\mathrm{plate}}}{dt}\\bigg|_{\\mathrm{diss}} = -k_{\\mathrm{diss}}\\,N_{\\mathrm{plate}}(t),\n$$\nand the dissolved species reservoir increases as\n$$\n\\frac{dN_{\\mathrm{diss}}}{dt} = k_{\\mathrm{diss}}\\,N_{\\mathrm{plate}}(t),\n$$\nwith $k_{\\mathrm{strip}}$ (in moles per coulomb) the stripping yield per unit discharge charge and $k_{\\mathrm{diss}}$ (in inverse seconds) the dissolution rate constant. Enforce $N_{\\mathrm{plate}}(t) \\ge 0$ at all times.\n\nStimulation protocol:\n- Apply a square-wave current $I(t)$ with amplitude $I_0$ and period $T_{\\mathrm{cyc}}$. Charge at $+I_0$ for $T_{\\mathrm{cyc}}/2$, then discharge at $-I_0$ for $T_{\\mathrm{cyc}}/2$, repeating for a specified number of cycles $n_{\\mathrm{cyc}}$.\n- Compute the deliverable capacity $Q_{\\mathrm{use}}$ at the end of the final discharge half-cycle.\n\nObjective:\n- For each test case, compute the sensitivity of $Q_{\\mathrm{use}}$ to the SEI yield $k_{\\mathrm{SEI}}$ via a finite difference:\n$$\nS = \\frac{Q_{\\mathrm{use}}(k_{\\mathrm{SEI}} + \\Delta k_{\\mathrm{SEI}}) - Q_{\\mathrm{use}}(k_{\\mathrm{SEI}})}{\\Delta k_{\\mathrm{SEI}}},\n$$\nin units of ampere-hours per (mole per coulomb). Use the same simulation for $k_{\\mathrm{SEI}}$ and $k_{\\mathrm{SEI}} + \\Delta k_{\\mathrm{SEI}}$ with identical other parameters.\n\nPhysical constants and units:\n- Use $F = 96485$ (coulombs per mole).\n- Express the final sensitivities $S$ in ampere-hours per (mole per coulomb). Round each result to $6$ decimal places.\n\nTest suite:\nProvide four parameter sets to exercise typical and edge-case behaviors. In each case, $N_{\\mathrm{Li},0}$ and $N_{\\mathrm{sites},0}$ are in moles, $I_0$ and $I_{\\lim}$ are in amperes, $T_{\\mathrm{cyc}}$ and $dt$ are in seconds, $k_{\\mathrm{SEI}}$, $k_{\\mathrm{plate}}$, and $k_{\\mathrm{strip}}$ are in moles per coulomb, and $k_{\\mathrm{diss}}$ is in inverse seconds. The loss-of-active-material coupling $\\alpha_{\\mathrm{LAM}}$ is dimensionless.\n1. Case A (moderate SEI, no plating):\n   - $N_{\\mathrm{Li},0} = 0.12$, $N_{\\mathrm{sites},0} = 0.11$, $I_0 = 3.0$, $I_{\\lim} = 5.0$, $T_{\\mathrm{cyc}} = 1200.0$, $n_{\\mathrm{cyc}} = 300$, $dt = 10.0$, $k_{\\mathrm{SEI}} = 2\\times 10^{-9}$, $\\Delta k_{\\mathrm{SEI}} = 1\\times 10^{-10}$, $k_{\\mathrm{plate}} = 0.0$, $k_{\\mathrm{strip}} = 0.0$, $k_{\\mathrm{diss}} = 0.0$, $\\alpha_{\\mathrm{LAM}} = 0.05$.\n2. Case B (near limiting balance between cyclable lithium and active sites):\n   - $N_{\\mathrm{Li},0} = 0.12$, $N_{\\mathrm{sites},0} = 0.11$, $I_0 = 3.0$, $I_{\\lim} = 5.0$, $T_{\\mathrm{cyc}} = 1000.0$, $n_{\\mathrm{cyc}} = 300$, $dt = 10.0$, $k_{\\mathrm{SEI}} = 2\\times 10^{-8}$, $\\Delta k_{\\mathrm{SEI}} = 1\\times 10^{-10}$, $k_{\\mathrm{plate}} = 0.0$, $k_{\\mathrm{strip}} = 0.0$, $k_{\\mathrm{diss}} = 0.0$, $\\alpha_{\\mathrm{LAM}} = 0.8$.\n3. Case C (plating-enabled with dissolution and stripping):\n   - $N_{\\mathrm{Li},0} = 0.12$, $N_{\\mathrm{sites},0} = 0.115$, $I_0 = 8.0$, $I_{\\lim} = 5.0$, $T_{\\mathrm{cyc}} = 800.0$, $n_{\\mathrm{cyc}} = 300$, $dt = 10.0$, $k_{\\mathrm{SEI}} = 3\\times 10^{-9}$, $\\Delta k_{\\mathrm{SEI}} = 1\\times 10^{-9}$, $k_{\\mathrm{plate}} = 1\\times 10^{-9}$, $k_{\\mathrm{strip}} = 0.8\\times 10^{-9}$, $k_{\\mathrm{diss}} = 5\\times 10^{-6}$, $\\alpha_{\\mathrm{LAM}} = 0.05$.\n4. Case D (very small perturbation to test numerical robustness):\n   - $N_{\\mathrm{Li},0} = 0.12$, $N_{\\mathrm{sites},0} = 0.11$, $I_0 = 3.0$, $I_{\\lim} = 5.0$, $T_{\\mathrm{cyc}} = 1200.0$, $n_{\\mathrm{cyc}} = 300$, $dt = 10.0$, $k_{\\mathrm{SEI}} = 2\\times 10^{-9}$, $\\Delta k_{\\mathrm{SEI}} = 1\\times 10^{-12}$, $k_{\\mathrm{plate}} = 0.0$, $k_{\\mathrm{strip}} = 0.0$, $k_{\\mathrm{diss}} = 0.0$, $\\alpha_{\\mathrm{LAM}} = 0.05$.\n\nImplementation requirements:\n- Simulate the coupled reservoir dynamics under the specified square-wave current using time-stepping with fixed $dt$ over $n_{\\mathrm{cyc}}$ cycles.\n- Enforce non-negativity constraints $N_{\\mathrm{plate}}(t) \\ge 0$, $N_{\\mathrm{SEI}}(t) \\ge 0$, $N_{\\mathrm{diss}}(t) \\ge 0$, and $N_{\\mathrm{sites}}(t) \\ge 0$.\n- Compute $Q_{\\mathrm{use}}$ at the end of the final discharge, then compute $S$ via the finite difference formula above.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4]$), where each $r_i$ is the sensitivity $S$ for the corresponding test case, rounded to $6$ decimal places, expressed in ampere-hours per (mole per coulomb).",
            "solution": "The solution involves implementing a numerical simulation based on the principle of lithium conservation. We model the battery's state by tracking the amount of lithium in different reservoirs over time and then use this simulation to compute the sensitivity of the final capacity to the SEI formation rate.\n\nThe core of the model is a set of state variables representing the molar quantities of lithium in different forms:\n- $N_{\\mathrm{SEI}}(t)$: Lithium trapped in the Solid Electrolyte Interphase.\n- $N_{\\mathrm{plate}}(t)$: Lithium deposited as metallic plating.\n- $N_{\\mathrm{diss}}(t)$: Plated lithium that has become chemically passivated.\n- $N_{\\mathrm{sites}}(t)$: The remaining capacity of the electrode to intercalate lithium.\n\nThe amount of cyclable lithium available, $N_{\\mathrm{cycl}}(t)$, is the initial total, $N_{\\mathrm{Li},0}$, minus all losses:\n$$\nN_{\\mathrm{cycl}}(t) = N_{\\mathrm{Li},0} - N_{\\mathrm{SEI}}(t) - N_{\\mathrm{plate}}(t) - N_{\\mathrm{diss}}(t)\n$$\nThe cell's deliverable capacity, $Q_{\\mathrm{use}}(t)$, is limited by the minimum of available lithium and available sites, converted to ampere-hours:\n$$\nQ_{\\mathrm{use}}(t) = \\frac{F}{3600}\\,\\min\\!\\big(N_{\\mathrm{cycl}}(t),\\,N_{\\mathrm{sites}}(t)\\big)\n$$\n\nThe simulation evolves these state variables over time using a forward Euler method with a small time step, $dt$. For each step, under a given current $I(t)$, the changes in each reservoir are calculated based on the rate equations provided in the problem:\n1.  **SEI Formation**: SEI grows in proportion to the total charge passed, $\\Delta N_{\\mathrm{SEI}} = k_{\\mathrm{SEI}}\\,|I(t)|\\,dt$.\n2.  **Loss of Active Material (LAM)**: Loss of intercalation sites is coupled to SEI growth, $\\Delta N_{\\mathrm{sites}} = -\\alpha_{\\mathrm{LAM}}\\,\\Delta N_{\\mathrm{SEI}}$.\n3.  **Plating/Stripping**: Plating occurs during high-current charging ($I > I_{\\lim}$), and stripping occurs during any discharge ($I < 0$). These processes add to or remove from the $N_{\\mathrm{plate}}$ reservoir.\n4.  **Dissolution**: Plated lithium can also be permanently lost through a first-order dissolution reaction, moving from the $N_{\\mathrm{plate}}$ reservoir to the $N_{\\mathrm{diss}}$ reservoir.\n\nThe provided Python code implements this simulation. The `run_simulation` function takes a set of parameters and cycles the cell for `n_cyc` times, updating the state variables at each time step `dt`. At the end of the simulation, it calculates the final $Q_{\\mathrm{use}}$.\n\nTo find the sensitivity, $S$, the `solve` function runs the simulation twice for each test case: once with the base parameter $k_{\\mathrm{SEI}}$ to get $Q_{\\mathrm{use}}(k_{\\mathrm{SEI}})$, and a second time with a perturbed value $k_{\\mathrm{SEI}} + \\Delta k_{\\mathrm{SEI}}$ to get $Q_{\\mathrm{use}}(k_{\\mathrm{SEI}} + \\Delta k_{\\mathrm{SEI}})$. The sensitivity is then computed using the finite difference formula:\n$$\nS = \\frac{Q_{\\mathrm{use}}(k_{\\mathrm{SEI}} + \\Delta k_{\\mathrm{SEI}}) - Q_{\\mathrm{use}}(k_{\\mathrm{SEI}})}{\\Delta k_{\\mathrm{SEI}}}\n$$\nThe code iterates through all four test cases, calculates the sensitivity for each, and prints the formatted results.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(N_li0, N_sites0, I0, Ilim, T_cyc, n_cyc, dt, \n                   k_sei, k_plate, k_strip, k_diss, alpha_lam):\n    \"\"\"\n    Simulates battery degradation and returns the final usable capacity.\n\n    Args:\n        N_li0 (float): Initial total cyclable lithium (moles).\n        N_sites0 (float): Initial available intercalation sites (moles).\n        I0 (float): Amplitude of the square-wave current (amperes).\n        Ilim (float): Limiting current for plating (amperes).\n        T_cyc (float): Period of one charge/discharge cycle (seconds).\n        n_cyc (int): Number of cycles.\n        dt (float): Time step for the simulation (seconds).\n        k_sei (float): SEI formation rate constant (moles/coulomb).\n        k_plate (float): Plating rate constant (moles/coulomb).\n        k_strip (float): Stripping rate constant (moles/coulomb).\n        k_diss (float): Dissolution rate constant (1/second).\n        alpha_lam (float): Loss of active material coupling factor (dimensionless).\n\n    Returns:\n        float: Final usable capacity (ampere-hours).\n    \"\"\"\n    F = 96485.0  # Faraday's constant in C/mol\n\n    # Initialize state variables\n    N_sei = 0.0\n    N_plate = 0.0\n    N_diss = 0.0\n    N_sites = N_sites0\n\n    total_time = n_cyc * T_cyc\n    num_steps = int(total_time / dt)\n    \n    half_period = T_cyc / 2.0\n\n    for i in range(num_steps):\n        t_current = i * dt\n        t_in_cycle = t_current % T_cyc\n        \n        # Determine current based on square-wave profile\n        I = I0 if t_in_cycle < half_period else -I0\n        abs_I = I0\n\n        # 1. SEI formation\n        delta_N_sei = k_sei * abs_I * dt\n\n        # 2. Loss of active material (LAM)\n        delta_N_sites = -alpha_lam * delta_N_sei\n\n        # 3. Lithium plating, stripping, and dissolution\n        delta_N_plate_charge = 0.0\n        if I > Ilim:\n            delta_N_plate_charge = k_plate * (I - Ilim) * dt\n\n        delta_N_plate_strip = 0.0\n        if I < 0:\n            delta_N_plate_strip = -k_strip * abs_I * dt\n            \n        delta_N_plate_diss = -k_diss * N_plate * dt\n\n        # 4. Formation of dissolved species\n        delta_N_diss = -delta_N_plate_diss\n\n        # Update state variables with non-negativity constraints\n        N_sei += delta_N_sei\n        N_sites = max(0.0, N_sites + delta_N_sites)\n        \n        delta_N_plate = delta_N_plate_charge + delta_N_plate_strip + delta_N_plate_diss\n        N_plate = max(0.0, N_plate + delta_N_plate)\n        \n        N_diss += delta_N_diss\n\n    # Calculate final usable capacity\n    N_cycl = N_li0 - N_sei - N_plate - N_diss\n    \n    Q_use = (F / 3600.0) * min(max(0.0,N_cycl), N_sites)\n    \n    return Q_use\n\ndef solve():\n    \"\"\"\n    Solves the battery degradation problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case A (moderate SEI, no plating)\n        {'N_li0': 0.12, 'N_sites0': 0.11, 'I0': 3.0, 'Ilim': 5.0, 'T_cyc': 1200.0, \n         'n_cyc': 300, 'dt': 10.0, 'k_sei': 2e-9, 'delta_k_sei': 1e-10, \n         'k_plate': 0.0, 'k_strip': 0.0, 'k_diss': 0.0, 'alpha_lam': 0.05},\n        # Case B (near limiting balance)\n        {'N_li0': 0.12, 'N_sites0': 0.11, 'I0': 3.0, 'Ilim': 5.0, 'T_cyc': 1000.0, \n         'n_cyc': 300, 'dt': 10.0, 'k_sei': 2e-8, 'delta_k_sei': 1e-10, \n         'k_plate': 0.0, 'k_strip': 0.0, 'k_diss': 0.0, 'alpha_lam': 0.8},\n        # Case C (plating-enabled)\n        {'N_li0': 0.12, 'N_sites0': 0.115, 'I0': 8.0, 'Ilim': 5.0, 'T_cyc': 800.0, \n         'n_cyc': 300, 'dt': 10.0, 'k_sei': 3e-9, 'delta_k_sei': 1e-9, \n         'k_plate': 1e-9, 'k_strip': 0.8e-9, 'k_diss': 5e-6, 'alpha_lam': 0.05},\n        # Case D (small perturbation)\n        {'N_li0': 0.12, 'N_sites0': 0.11, 'I0': 3.0, 'Ilim': 5.0, 'T_cyc': 1200.0, \n         'n_cyc': 300, 'dt': 10.0, 'k_sei': 2e-9, 'delta_k_sei': 1e-12, \n         'k_plate': 0.0, 'k_strip': 0.0, 'k_diss': 0.0, 'alpha_lam': 0.05}\n    ]\n\n    results = []\n    for case in test_cases:\n        params_base = {k: v for k, v in case.items() if k != 'delta_k_sei'}\n        \n        # Run simulation with base k_sei\n        Q_use_base = run_simulation(**params_base)\n\n        # Run simulation with perturbed k_sei\n        params_perturbed = params_base.copy()\n        params_perturbed['k_sei'] += case['delta_k_sei']\n        Q_use_perturbed = run_simulation(**params_perturbed)\n        \n        # Calculate sensitivity using finite difference\n        sensitivity = (Q_use_perturbed - Q_use_base) / case['delta_k_sei']\n        results.append(f\"{sensitivity:.6f}\")\n        \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}