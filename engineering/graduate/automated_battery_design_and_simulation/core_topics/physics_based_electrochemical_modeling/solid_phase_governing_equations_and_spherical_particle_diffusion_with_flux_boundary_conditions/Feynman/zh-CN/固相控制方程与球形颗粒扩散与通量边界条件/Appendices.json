{
    "hands_on_practices": [
        {
            "introduction": "在我们模拟锂离子扩散之前，必须首先将连续的偏微分方程转化为计算机可以求解的离散方程组。本练习将引导你完成从第一性原理推导球形扩散方程的有限体积法（FVM）离散化的基本过程。通过构建系统矩阵和源向量，你将亲手搭建一个数值求解器的核心。",
            "id": "3950513",
            "problem": "您的任务是推导并实现一种有限体积法（FVM），用于求解电池活性材料颗粒固相中的球形扩散问题的半离散平衡。控制偏微分方程（PDE）是球坐标系下基于菲克扩散的物质守恒方程，写作：$$\\frac{\\partial c_s}{\\partial t} = \\frac{D_s}{r^2} \\frac{\\partial}{\\partial r} \\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right),$$ 其中，$c_s$ 是固相浓度，单位为 $\\mathrm{mol/m^3}$；$D_s$ 是固相扩散系数，单位为 $\\mathrm{m^2/s}$；$r$ 是径向坐标，单位为 $\\mathrm{m}$。求解域为半径为 $R$ 的球体。边界条件为 $r = 0$ 处的中心对称（零梯度）和 $r = R$ 处给定的表面摩尔通量：$$-D_s \\frac{\\partial c_s}{\\partial r}\\bigg|_{r=R} = j_s,$$ 其中，$j_s$ 是向外的摩尔通量，单位为 $\\mathrm{mol/(m^2 \\cdot s)}$。$j_s$ 为正值表示净物质流出颗粒。\n\n从第一性原理（物质守恒和菲克定律）出发，为 $N$ 个等厚度的同心球壳推导半离散有限体积平衡方程。球壳的界面位于：$$r_{f,j} = j \\frac{R}{N}, \\quad j = 0, 1, \\dots, N,$$ 单元体积和界面面积必须按如下方式计算：$$V_i = \\frac{4\\pi}{3} \\left(r_{f,i+1}^3 - r_{f,i}^3\\right), \\quad A_{f,j} = 4\\pi r_{f,j}^2,$$ 其中 $i = 0, 1, \\dots, N-1$。在内界面上，使用中心差分近似来计算径向梯度，即：$$\\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,i+1}} \\approx \\frac{c_{i+1} - c_i}{\\Delta r}, \\quad \\Delta r = \\frac{R}{N}.$$ 通过将 $r=0$ 处内界面的通量设置为零来实现中心对称，并通过在 $r=R$ 处使用指定的 $j_s$ 来施加表面通量边界条件。\n\n您的程序必须：\n- 构建半离散算子矩阵 $\\mathbf{K} \\in \\mathbb{R}^{N \\times N}$ 和源向量 $\\mathbf{s} \\in \\mathbb{R}^N$，使得：$$\\frac{d\\mathbf{c}}{dt} = \\mathbf{K}\\,\\mathbf{c} + \\mathbf{s},$$ 其中 $\\mathbf{c} = [c_0,\\dots,c_{N-1}]^\\top$ 汇集了各单元的平均浓度。\n- 对于每个测试用例，根据给定的初始 $\\mathbf{c}$ 计算瞬时时间导数 $\\frac{d\\mathbf{c}}{dt}$，并计算总摩尔量变化率：$$\\frac{dM}{dt} = \\sum_{i=0}^{N-1} V_i \\frac{dc_i}{dt}$$ 单位为 $\\mathrm{mol/s}$。根据守恒定律，精确的连续介质值为：$$\\frac{dM}{dt} = -4 \\pi R^2 j_s.$$\n- 为每个测试用例返回列表：$$\\left[\\frac{dM}{dt}, \\left(\\frac{dc_0}{dt}\\right), \\left(\\frac{dc_{N-1}}{dt}\\right)\\right],$$ 结果使用国际单位制（SI）表示，其中 $dM/dt$ 的单位为 $\\mathrm{mol/s}$，浓度时间导数的单位为 $\\mathrm{mol/(m^3 \\cdot s)}$。\n\n测试套件：\n- 情况 A（一般情况）：$N = 3$, $R = 5 \\times 10^{-6}\\ \\mathrm{m}$, $D_s = 1 \\times 10^{-14}\\ \\mathrm{m^2/s}$, $j_s = 2.5 \\times 10^{-6}\\ \\mathrm{mol/(m^2 \\cdot s)}$, 初始 $\\mathbf{c} = [25000,\\ 26000,\\ 27000]\\ \\mathrm{mol/m^3}$。\n- 情况 B（边界情况 $N=1$，零通量）：$N = 1$, $R = 1 \\times 10^{-6}\\ \\mathrm{m}$, $D_s = 5 \\times 10^{-15}\\ \\mathrm{m^2/s}$, $j_s = 0\\ \\mathrm{mol/(m^2 \\cdot s)}$, 初始 $\\mathbf{c} = [30000]\\ \\mathrm{mol/m^3}$。\n- 情况 C（高分辨率和均匀初始浓度的边缘情况）：$N = 50$, $R = 1 \\times 10^{-5}\\ \\mathrm{m}$, $D_s = 2 \\times 10^{-14}\\ \\mathrm{m^2/s}$, $j_s = 1 \\times 10^{-5}\\ \\mathrm{mol/(m^2 \\cdot s)}$, 初始 $\\mathbf{c}$ 是一个长度为 50 的常数向量，所有分量均为 $20000\\ \\mathrm{mol/m^3}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个测试用例的结果。结果是一个由方括号括起来的逗号分隔列表，每个测试用例的结果本身又是 $[\\frac{dM}{dt}, \\frac{dc_0}{dt}, \\frac{dc_{N-1}}{dt}]$ 形式的列表。例如：$$[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3]].$$",
            "solution": "用户在计算材料科学和电池建模领域提供了一个适定且具有科学依据的问题陈述。该问题要求推导并实现用于球形扩散问题的有限体积法（FVM）。我将开始进行求解。\n\n### **问题验证**\n\n**步骤 1：提取已知条件**\n- **控制偏微分方程**：球坐标系下浓度 $c_s(\\mathrm{mol/m^3})$ 的物质守恒方程。\n$$ \\frac{\\partial c_s}{\\partial t} = \\frac{D_s}{r^2} \\frac{\\partial}{\\partial r} \\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right) $$\n- **求解域**：半径为 $R(\\mathrm{m})$ 的球体。\n- **参数**：$D_s$ 是固相扩散系数（$\\mathrm{m^2/s}$），$r$ 是径向坐标（$\\mathrm{m}$）。\n- **边界条件**：\n  1. $r=0$ 处的中心对称：$\\frac{\\partial c_s}{\\partial r}\\big|_{r=0} = 0$。\n  2. $r=R$ 处的指定表面摩尔通量：$-D_s \\frac{\\partial c_s}{\\partial r}\\big|_{r=R} = j_s$，其中 $j_s$ 是向外的摩尔通量（$\\mathrm{mol/(m^2 \\cdot s)}$）。\n- **离散化**：$N$ 个等厚度 $\\Delta r = R/N$ 的同心球壳。\n- **界面位置**：$r_{f,j} = j \\frac{R}{N}$，其中 $j = 0, 1, \\dots, N$。\n- **单元体积**：$V_i = \\frac{4\\pi}{3} \\left(r_{f,i+1}^3 - r_{f,i}^3\\right)$，其中 $i = 0, 1, \\dots, N-1$。\n- **界面面积**：$A_{f,j} = 4\\pi r_{f,j}^2$。\n- **梯度近似**：中心差分，$\\frac{\\partial c_s}{\\partial r}\\big|_{r_{f,i+1}} \\approx \\frac{c_{i+1} - c_i}{\\Delta r}$。\n- **任务**：\n  1. 推导半离散系统 $\\frac{d\\mathbf{c}}{dt} = \\mathbf{K}\\,\\mathbf{c} + \\mathbf{s}$，其中 $\\mathbf{c} = [c_0,\\dots,c_{N-1}]^\\top$。\n  2. 根据给定的初始条件计算 $\\frac{d\\mathbf{c}}{dt}$。\n  3. 计算总摩尔量变化率 $\\frac{dM}{dt} = \\sum_{i=0}^{N-1} V_i \\frac{dc_i}{dt}$。\n  4. 将 $\\frac{dM}{dt}$ 与解析期望值 $-4 \\pi R^2 j_s$ 进行比较。\n  5. 提供三个指定测试用例的结果。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题描述了球坐标系下的菲克扩散，这是物理学、化学和工程学中一个基础且广泛使用的模型，尤其适用于电池电极颗粒。有限体积法是求解守恒律的一种标准、稳健的数值方法。所有方面都牢固地建立在公认的科学和数学原理之上。\n- **适定性**：该问题提供了一个定义明确的偏微分方程及适当的边界条件（每个边界上有一个诺伊曼条件，这适用于此类抛物型偏微分方程）。离散化方案明确指定，从而导出一个唯一的常微分方程组（ODE）。时间导数存在唯一解。\n- **客观性**：该问题使用精确的数学和物理术语陈述，没有歧义或主观性语言。\n- **完整性和一致性**：所有必需的参数、方程和数值近似方法都已提供。内容没有矛盾之处。对 $\\frac{dM}{dt}$ 的期望值源于散度定理，可作为一种一致性检验，离散系统应满足此检验。\n\n**步骤 3：结论与行动**\n问题有效。我将继续推导解答并实现代码。\n\n### **有限体积离散化的推导**\n\n推导从物质守恒定律在控制体积 $V_i$ 上的积分形式开始，该控制体积对应于第 $i$ 个球壳，其半径范围从 $r_{f,i}$ 到 $r_{f,i+1}$。\n$$ \\frac{d}{dt} \\int_{V_i} c_s \\,dV = \\oint_{\\partial V_i} \\mathbf{J} \\cdot d\\mathbf{A} $$\n此处，$\\mathbf{J}$ 是摩尔通量向量，由菲克第一定律给出：$\\mathbf{J} = -D_s \\nabla c_s$。在仅有径向依赖的球坐标系中，这简化为 $\\mathbf{J} = J_r \\hat{\\mathbf{r}}$，其中 $J_r = -D_s \\frac{\\partial c_s}{\\partial r}$。\n\n假设在每个控制体积 $V_i$ 内浓度 $c_i$ 是均匀的（即，$c_i = \\frac{1}{V_i}\\int_{V_i} c_s dV$），则方程左侧变为 $V_i \\frac{dc_i}{dt}$。方程右侧是流入该体积的净通量。边界 $\\partial V_i$ 由位于 $r_{f,i}$ 的内球面和位于 $r_{f,i+1}$ 的外球面组成。面积分等于通过内界面的通量减去通过外界面的通量。\n$$ \\oint_{\\partial V_i} \\mathbf{J} \\cdot d\\mathbf{A} = A_{f,i} J_r(r_{f,i}) - A_{f,i+1} J_r(r_{f,i+1}) $$\n其中 $A_{f,j} = 4\\pi r_{f,j}^2$ 是半径 $r_{f,j}$ 处界面的表面积。符号对应于在 $r_{f,i}$ 处流入 $V_i$ 的通量和在 $r_{f,i+1}$ 处流出 $V_i$ 的通量。综合这些，得到单元 $i$ 的平衡方程：\n$$ V_i \\frac{dc_i}{dt} = A_{f,i} \\left(-D_s \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,i}}\\right) - A_{f,i+1} \\left(-D_s \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,i+1}}\\right) $$\n两边同除以 $V_i$：\n$$ \\frac{dc_i}{dt} = \\frac{D_s}{V_i} \\left[ A_{f,i+1} \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,i+1}} - A_{f,i} \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,i}} \\right] $$\n接下来，我们在内界面上应用中心差分近似来计算梯度。在单元 $j-1$ 和单元 $j$ 之间的界面 $r_{f,j}$ 处的梯度近似为：\n$$ \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,j}} \\approx \\frac{c_j - c_{j-1}}{\\Delta r} \\quad \\text{for } j=1, \\dots, N-1 $$\n其中 $\\Delta r = R/N$ 是单元中心之间的距离。\n\n我们现在为每种类型的单元构建方程。\n\n**1. 第一个单元（$i=0$）：**\n内边界位于 $r_{f,0} = 0$。由于中心对称，通量为零。这一点也体现在 $A_{f,0} = 4\\pi(0)^2 = 0$。外界面位于 $r_{f,1}$。\n$$ \\frac{dc_0}{dt} = \\frac{D_s}{V_0} \\left[ A_{f,1} \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,1}} - A_{f,0} \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,0}} \\right] = \\frac{D_s A_{f,1}}{V_0} \\left(\\frac{c_1 - c_0}{\\Delta r}\\right) $$\n整理后得到 $\\mathbf{K}$ 矩阵第一行的分量：\n$$ \\frac{dc_0}{dt} = \\left(-\\frac{D_s A_{f,1}}{V_0 \\Delta r}\\right) c_0 + \\left(\\frac{D_s A_{f,1}}{V_0 \\Delta r}\\right) c_1 $$\n\n**2. 内部单元（$0  i  N-1$）：**\n对于内部单元 $i$，我们在其两个界面 $r_{f,i}$ 和 $r_{f,i+1}$ 上都应用梯度近似。\n$$ \\frac{dc_i}{dt} = \\frac{D_s}{V_i} \\left[ A_{f,i+1} \\left(\\frac{c_{i+1} - c_i}{\\Delta r}\\right) - A_{f,i} \\left(\\frac{c_i - c_{i-1}}{\\Delta r}\\right) \\right] $$\n整理后得到三对角矩阵 $\\mathbf{K}$ 的第 $i$ 行分量：\n$$ \\frac{dc_i}{dt} = \\left(\\frac{D_s A_{f,i}}{V_i \\Delta r}\\right) c_{i-1} - \\left(\\frac{D_s (A_{f,i} + A_{f,i+1})}{V_i \\Delta r}\\right) c_i + \\left(\\frac{D_s A_{f,i+1}}{V_i \\Delta r}\\right) c_{i+1} $$\n\n**3. 最后一个单元（$i=N-1$）：**\n内界面位于 $r_{f,N-1}$。外界面位于 $r_{f,N}=R$，在此处施加通量条件 $-D_s \\frac{\\partial c_s}{\\partial r}|_{r=R} = j_s$。\n$$ V_{N-1} \\frac{dc_{N-1}}{dt} = A_{f,N-1} \\left(-D_s \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,N-1}}\\right) - A_{f,N} \\left(-D_s \\frac{\\partial c_s}{\\partial r}\\bigg|_{r_{f,N}}\\right) $$\n代入内界面的梯度近似和外界面的给定通量：\n$$ V_{N-1} \\frac{dc_{N-1}}{dt} = A_{f,N-1} \\left(-D_s \\frac{c_{N-1} - c_{N-2}}{\\Delta r}\\right) - A_{f,N} j_s $$\n$$ V_{N-1} \\frac{dc_{N-1}}{dt} = D_s \\frac{A_{f,N-1}}{\\Delta r} (c_{N-2} - c_{N-1}) - A_{f,N} j_s $$\n两边同除以 $V_{N-1}$ 并分离各项，得到 $\\mathbf{K}$ 的最后一行和源向量 $\\mathbf{s}$：\n$$ \\frac{dc_{N-1}}{dt} = \\left(\\frac{D_s A_{f,N-1}}{V_{N-1} \\Delta r}\\right) c_{N-2} - \\left(\\frac{D_s A_{f,N-1}}{V_{N-1} \\Delta r}\\right) c_{N-1} - \\frac{A_{f,N}}{V_{N-1}} j_s $$\n因此，源向量 $\\mathbf{s}$ 中唯一的非零元素是 $s_{N-1} = -\\frac{A_{f,N}}{V_{N-1}} j_s$。\n\n**4. 特殊情况（$N=1$）：**\n当 $N=1$ 时，只有一个从 $r=0$ 到 $r=R$ 的控制体积。\n$$ V_0 \\frac{dc_0}{dt} = A_{f,0} J_r(r_{f,0}) - A_{f,1} J_r(r_{f,1}) $$\n中心（$r_{f,0}=0$）处的通量为零。表面（$r_{f,1}=R$）处的通量密度由 $j_s$ 给出，因此流出的摩尔速率为 $A_{f,1} j_s$。\n$$ V_0 \\frac{dc_0}{dt} = 0 - A_{f,1} j_s \\implies \\frac{dc_0}{dt} = -\\frac{A_{f,1}}{V_0} j_s $$\n由于 $V_0 = \\frac{4\\pi}{3} R^3$ 且 $A_{f,1} = 4\\pi R^2$，上式可简化为 $\\frac{dc_0}{dt} = -\\frac{3}{R}j_s$。\n在矩阵形式下，对于 $N=1$，$\\mathbf{K} = [[0]]$ 且 $\\mathbf{s} = [-\\frac{3j_s}{R}]$。\n\n**5. 总摩尔量守恒检验：**\n总摩尔量变化率为 $\\frac{dM}{dt} = \\sum_{i=0}^{N-1} V_i \\frac{dc_i}{dt}$。\n$$ \\frac{dM}{dt} = V_0 \\frac{dc_0}{dt} + \\sum_{i=1}^{N-2} V_i \\frac{dc_i}{dt} + V_{N-1} \\frac{dc_{N-1}}{dt} $$\n代入 $V_i \\frac{dc_i}{dt}$ 的表达式：\n$$ \\frac{dM}{dt} = \\left[D_s \\frac{A_{f,1}}{\\Delta r}(c_1-c_0)\\right] + \\sum_{i=1}^{N-2} \\left[D_s \\frac{A_{f,i}}{\\Delta r}(c_{i-1}-c_i) - D_s \\frac{A_{f,i+1}}{\\Delta r}(c_{i+1}-c_i)\\right] + \\left[D_s \\frac{A_{f,N-1}}{\\Delta r}(c_{N-2}-c_{N-1}) - A_{f,N}j_s\\right] $$\n这是一个伸缩求和。设 $m_j = D_s \\frac{A_{f,j}}{\\Delta r}(c_{j-1}-c_j)$ 为单元之间的摩尔速率。则求和为：\n$$ \\frac{dM}{dt} = (-m_1) + \\sum_{i=1}^{N-2} (m_i - m_{i+1}) + (m_{N-1} - A_{f,N}j_s) = -m_1 + (m_1-m_2) + \\dots + (m_{N-2}-m_{N-1}) + m_{N-1} - A_{f,N}j_s $$\n所有内部通量项都相互抵消，剩下：\n$$ \\frac{dM}{dt} = -A_{f,N} j_s = -4\\pi R^2 j_s $$\n这证实了离散格式是守恒的，并且完美地捕捉了总摩尔量的变化，该变化完全由外边界的通量决定。数值实现应能复现此结果，直至机器精度。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n\n    def calculate_derivatives(N, R, Ds, js, c_initial):\n        \"\"\"\n        Calculates the time derivatives of concentrations in a spherical particle\n        using a finite-volume method.\n\n        Args:\n            N (int): Number of concentric shells.\n            R (float): Particle radius in meters.\n            Ds (float): Solid-phase diffusion coefficient in m^2/s.\n            js (float): Molar flux at the surface in mol/(m^2*s).\n            c_initial (list or np.ndarray): Initial concentrations in each shell in mol/m^3.\n\n        Returns:\n            list: A list containing [dM/dt, dc0/dt, dc(N-1)/dt].\n        \"\"\"\n        c_initial = np.array(c_initial, dtype=float)\n        \n        # 1. Calculate geometric properties\n        dr = R / N\n        r_f = np.linspace(0, R, N + 1)\n        A_f = 4.0 * np.pi * r_f**2\n        V = (4.0/3.0) * np.pi * (r_f[1:]**3 - r_f[:-1]**3)\n\n        # 2. Initialize matrix K and vector s\n        K = np.zeros((N, N), dtype=float)\n        s = np.zeros(N, dtype=float)\n\n        # 3. Handle N=1 case separately\n        if N == 1:\n            if V[0] > 1e-30:  # Avoid division by zero\n                s[0] = -A_f[1] / V[0] * js\n            # K remains a zero matrix\n        else:\n            # 4. Populate K and s for N > 1\n            # First cell (i=0)\n            # Factor = D_s * A_f / (V * dr)\n            term0 = Ds * A_f[1] / (V[0] * dr)\n            K[0, 0] = -term0\n            K[0, 1] = term0\n            \n            # Internal cells (i=1 to N-2)\n            for i in range(1, N - 1):\n                term_left = Ds * A_f[i] / (V[i] * dr)\n                term_right = Ds * A_f[i+1] / (V[i] * dr)\n                K[i, i-1] = term_left\n                K[i, i] = -(term_left + term_right)\n                K[i, i+1] = term_right\n            \n            # Last cell (i=N-1)\n            term_last = Ds * A_f[N-1] / (V[N-1] * dr)\n            K[N-1, N-2] = term_last\n            K[N-1, N-1] = -term_last\n            if V[N-1] > 1e-30:\n                s[N-1] = -A_f[N] / V[N-1] * js\n\n        # 5. Calculate concentration time derivatives\n        dcdt = K @ c_initial + s\n\n        # 6. Calculate total mass rate of change\n        dMdt = np.dot(V, dcdt)\n\n        # 7. Extract required results\n        dc0dt = dcdt[0]\n        dcN1dt = dcdt[-1]\n        \n        return [dMdt, dc0dt, dcN1dt]\n\n    test_cases = [\n        # Case A: N=3, R=5e-6, Ds=1e-14, js=2.5e-6, c=[25000, 26000, 27000]\n        (3, 5e-6, 1e-14, 2.5e-6, [25000., 26000., 27000.]),\n        # Case B: N=1, R=1e-6, Ds=5e-15, js=0, c=[30000]\n        (1, 1e-6, 5e-15, 0., [30000.]),\n        # Case C: N=50, R=1e-5, Ds=2e-14, js=1e-5, c=20000 (uniform)\n        (50, 1e-5, 2e-14, 1e-5, [20000.]*50),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = calculate_derivatives(*params)\n        results.append(result)\n\n    # Format the output string precisely as required: [[x1,y1,z1],[x2,y2,z2],...]\n    outer_list_str = []\n    for res in results:\n        inner_list_str = f\"[{res[0]},{res[1]},{res[2]}]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "一个可靠的数值模型必须遵循其所代表的基本物理定律，例如质量守恒。本练习挑战你通过时间积分来验证你实现的有限体积法是否是“保守的”，即检查总锂含量的变化是否与边界通量精确匹配。这个过程对于验证代码的正确性以及理解模型内在属性与数值积分误差之间的区别至关重要。",
            "id": "3950483",
            "problem": "考虑一个锂离子电池固相中的单球形活性材料颗粒。令固相锂浓度表示为 $c_s(r,t)$，其中 $r$ 是径向坐标，$t$ 是时间。根据菲克扩散定律和质量守恒，球体中的扩散控制偏微分方程 (PDE) 由下式给出\n$$\n\\frac{\\partial c_s}{\\partial t}(r,t) = D_s \\frac{1}{r^2} \\frac{\\partial}{\\partial r}\\left(r^2 \\frac{\\partial c_s}{\\partial r}(r,t)\\right),\n$$\n对于 $0 \\le r \\le R$ 和 $t \\ge 0$，其中 $D_s$ 是固相扩散系数（单位为 $\\mathrm{m^2/s}$），$R$ 是颗粒半径（单位为 $\\mathrm{m}$）。中心的对称边界条件为\n$$\n\\frac{\\partial c_s}{\\partial r}(0,t) = 0,\n$$\n颗粒表面的通量边界条件为\n$$\n- D_s \\frac{\\partial c_s}{\\partial r}(R,t) = J_s(t),\n$$\n其中 $J_s(t)$ 是表面的摩尔通量（单位为 $\\mathrm{mol/(m^2 \\cdot s)}$），$J_s(t)$ 可以是任意随时间变化的函数。定义体积平均浓度为\n$$\n\\bar{c}_s(t) = \\frac{3}{R^3} \\int_{0}^{R} c_s(r,t) \\, r^2 \\, dr.\n$$\n\n目标是使用有限体积空间半离散化和数值时间积分，数值验证离散平均浓度遵循质量守恒检验\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = -\\frac{3}{R} \\, J_s(t),\n$$\n对于任意随时间变化的 $J_s(t)$。\n\n在球坐标中实施有限体积法 (FVM)，将 PDE 在 $N$ 个等径向厚度的同心球壳上进行离散化。令 $r_{i-\\frac{1}{2}}$ 和 $r_{i+\\frac{1}{2}}$ 表示球壳 $i$ 的内外半径，其中 $i \\in \\{1,2,\\dots,N\\}$，$r_{\\frac{1}{2}} = 0$ 且 $r_{N+\\frac{1}{2}} = R$。球壳体积为\n$$\nV_i = \\frac{4\\pi}{3}\\left(r_{i+\\frac{1}{2}}^3 - r_{i-\\frac{1}{2}}^3\\right),\n$$\n且在各界面处的球面面积为\n$$\nA_{i-\\frac{1}{2}} = 4\\pi r_{i-\\frac{1}{2}}^2, \\quad A_{i+\\frac{1}{2}} = 4\\pi r_{i+\\frac{1}{2}}^2.\n$$\n将单元中心浓度表示为 $c_i(t)$，并通过以下方式近似内部界面的通量 $J_{i+\\frac{1}{2}}(t)$\n$$\nJ_{i+\\frac{1}{2}}(t) = -D_s \\frac{c_{i+1}(t) - c_i(t)}{\\Delta r},\n$$\n其中 $\\Delta r = R/N$，根据对称性，中心通量 $J_{\\frac{1}{2}}(t) = 0$，根据边界条件，表面通量 $J_{N+\\frac{1}{2}}(t) = J_s(t)$。每个球壳的半离散 FVM 常微分方程 (ODE) 为\n$$\n\\frac{d c_i}{dt}(t) = -\\frac{A_{i+\\frac{1}{2}} J_{i+\\frac{1}{2}}(t) - A_{i-\\frac{1}{2}} J_{i-\\frac{1}{2}}(t)}{V_i}.\n$$\n设初始浓度在空间上是均匀的：\n$$\nc_s(r,0) = c_0,\n$$\n其中 $c_0$ 的单位为 $\\mathrm{mol/m^3}$。\n\n设计一个程序，使其能够：\n- 使用上述定义构建半离散 FVM ODE 系统。\n- 针对几种给定的 $J_s(t)$ 情况，对 ODE 进行时间积分。\n- 在模拟区间内的一系列采样时间 $t_k$ 上，计算体积平均浓度\n$$\n\\bar{c}_s(t_k) = \\frac{\\sum_{i=1}^{N} V_i c_i(t_k)}{\\sum_{i=1}^{N} V_i},\n$$\n- 对于内部采样点，使用二阶中心有限差分\n$$\n\\frac{d \\bar{c}_s}{dt}(t_k) \\approx \\frac{\\bar{c}_s(t_{k+1}) - \\bar{c}_s(t_{k-1})}{t_{k+1} - t_{k-1}},\n$$\n来近似时间导数 $\\frac{d \\bar{c}_s}{dt}(t_k)$。\n- 将此近似导数与理论值 $-\\frac{3}{R} J_s(t_k)$进行比较，并报告每个测试用例在所有内部采样点上的最大绝对差异：\n$$\n\\max_k \\left| \\frac{\\bar{c}_s(t_{k+1}) - \\bar{c}_s(t_{k-1})}{t_{k+1} - t_{k-1}} + \\frac{3}{R} J_s(t_k) \\right|.\n$$\n\n物理单位和数值要求：\n- 对 $R$ 使用米 ($\\mathrm{m}$)，对 $t$ 使用秒 ($\\mathrm{s}$)，对 $D_s$ 使用平方米/秒 ($\\mathrm{m^2/s}$)，对 $c_0$ 使用摩尔/立方米 ($\\mathrm{mol/m^3}$)，对 $J_s(t)$ 使用摩尔/平方米·秒 ($\\mathrm{mol/(m^2 \\cdot s)}$)。\n- 所有差异均以 $\\mathrm{mol/(m^3 \\cdot s)}$ 表示。\n- 内部对任何三角函数参数使用弧度，并确保所有函数 $J_s(t)$ 的实现都与以秒为单位的 $t$ 保持一致。\n\n测试套件：\n实现并评估以下五个案例，每个案例的时间范围为 $[0,T]$，并在 $M$ 个均匀间隔的时间点上对解进行采样：\n1. 案例 1：$R = 5 \\times 10^{-6}\\,\\mathrm{m}$，$D_s = 1 \\times 10^{-14}\\,\\mathrm{m^2/s}$，$N = 41$，$c_0 = 20000\\,\\mathrm{mol/m^3}$，$J_s(t) = J_0 \\sin\\left( 2\\pi t / P \\right)$，其中 $J_0 = 1 \\times 10^{-5}\\,\\mathrm{mol/(m^2 \\cdot s)}$，$P = 50\\,\\mathrm{s}$，模拟至 $T = 50\\,\\mathrm{s}$，采样点数为 $M = 401$。\n2. 案例 2：$R = 8 \\times 10^{-6}\\,\\mathrm{m}$，$D_s = 5 \\times 10^{-15}\\,\\mathrm{m^2/s}$，$N = 31$，$c_0 = 20000\\,\\mathrm{mol/m^3}$，当 $t \\ge t_{\\mathrm{step}}$ 时 $J_s(t) = J_0$，否则 $J_s(t) = 0$，其中 $J_0 = 2 \\times 10^{-5}\\,\\mathrm{mol/(m^2 \\cdot s)}$，$t_{\\mathrm{step}} = 10\\,\\mathrm{s}$，模拟至 $T = 40\\,\\mathrm{s}$，采样点数为 $M = 401$。\n3. 案例 3：$R = 1 \\times 10^{-5}\\,\\mathrm{m}$，$D_s = 1 \\times 10^{-13}\\,\\mathrm{m^2/s}$，$N = 21$，$c_0 = 20000\\,\\mathrm{mol/m^3}$，$J_s(t) = a t$，其中 $a = 1 \\times 10^{-6}\\,\\mathrm{mol/(m^2 \\cdot s^2)}$，模拟至 $T = 30\\,\\mathrm{s}$，采样点数为 $M = 301$。\n4. 案例 4：$R = 5 \\times 10^{-6}\\,\\mathrm{m}$，$D_s = 1 \\times 10^{-14}\\,\\mathrm{m^2/s}$，$N = 11$，$c_0 = 20000\\,\\mathrm{mol/m^3}$，对于所有 $t$，$J_s(t) = 0$，模拟至 $T = 20\\,\\mathrm{s}$，采样点数为 $M = 201$。\n5. 案例 5：$R = 2 \\times 10^{-6}\\,\\mathrm{m}$，$D_s = 1 \\times 10^{-12}\\,\\mathrm{m^2/s}$，$N = 2$，$c_0 = 20000\\,\\mathrm{mol/m^3}$，$J_s(t) = J_0 \\cos\\left( 2\\pi t / P \\right)$，其中 $J_0 = 5 \\times 10^{-6}\\,\\mathrm{mol/(m^2 \\cdot s)}$，$P = 10\\,\\mathrm{s}$，模拟至 $T = 10\\,\\mathrm{s}$，采样点数为 $M = 201$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[x_1,x_2,x_3,x_4,x_5]$），其中每个 $x_i$ 是对应上述顺序案例的最大绝对差异（一个浮点数，单位为 $\\mathrm{mol/(m^3 \\cdot s)}$）。",
            "solution": "目标是基于微观的有限体积法 (FVM) 模拟，对球形颗粒内锂扩散的宏观质量守恒定律进行数值验证。该守恒定律将体积平均浓度 $\\bar{c}_s(t)$ 的变化率与颗粒表面通量 $J_s(t)$ 联系起来。我们将首先从控制偏微分方程 (PDE) 推导出该定律，然后证明所提出的 FVM 半离散化方案的构造能够内在地满足该定律。随后的数值实验将用作对实现正确性的验证，任何由此产生的差异都可归因于时间积分和导数近似所带来的数值误差。\n\n首先，我们推导精确的解析关系。体积平均浓度 $\\bar{c}_s(t)$ 定义为：\n$$\n\\bar{c}_s(t) = \\frac{1}{V_{\\text{total}}} \\int_{0}^{R} c_s(r,t) \\, 4\\pi r^2 \\, dr = \\frac{3}{R^3} \\int_{0}^{R} c_s(r,t) \\, r^2 \\, dr,\n$$\n其中 $V_{\\text{total}} = \\frac{4\\pi}{3}R^3$ 是球体的总体积。\n为了求其变化率，我们对时间 $t$ 进行微分。应用莱布尼茨积分法则，我们交换微分和积分的顺序：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = \\frac{3}{R^3} \\int_{0}^{R} \\frac{\\partial c_s}{\\partial t}(r,t) \\, r^2 \\, dr.\n$$\n扩散的控制 PDE 如下所示：\n$$\n\\frac{\\partial c_s}{\\partial t}(r,t) = D_s \\frac{1}{r^2} \\frac{\\partial}{\\partial r}\\left(r^2 \\frac{\\partial c_s}{\\partial r}(r,t)\\right).\n$$\n将 PDE 代入 $\\frac{d \\bar{c}_s}{dt}$ 的表达式中：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = \\frac{3}{R^3} \\int_{0}^{R} \\left( D_s \\frac{1}{r^2} \\frac{\\partial}{\\partial r}\\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right) \\right) r^2 \\, dr.\n$$\n$r^2$ 项相消，得到：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = \\frac{3D_s}{R^3} \\int_{0}^{R} \\frac{\\partial}{\\partial r}\\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right) \\, dr.\n$$\n根据微积分基本定理，导数的积分等于在边界处求值的函数：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = \\frac{3D_s}{R^3} \\left[ r^2 \\frac{\\partial c_s}{\\partial r}(r,t) \\right]_{r=0}^{r=R} = \\frac{3D_s}{R^3} \\left( R^2 \\frac{\\partial c_s}{\\partial r}(R,t) - 0 \\right).\n$$\n简化后得到：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = \\frac{3D_s}{R} \\frac{\\partial c_s}{\\partial r}(R,t).\n$$\n使用表面通量边界条件 $-D_s \\frac{\\partial c_s}{\\partial r}(R,t) = J_s(t)$，我们替换项 $D_s \\frac{\\partial c_s}{\\partial r}(R,t) = -J_s(t)$：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = -\\frac{3}{R} J_s(t).\n$$\n这就是必须满足的精确宏观守恒定律。\n\n接下来，我们分析 FVM 半离散化，以证明其同样遵循此定律。颗粒被划分为 $N$ 个同心球壳，球壳 $i$ 中的浓度表示为 $c_i(t)$。$c_i(t)$ 的时间演化由以下 ODE 给出：\n$$\n\\frac{d c_i}{dt}(t) = -\\frac{A_{i+\\frac{1}{2}} J_{i+\\frac{1}{2}}(t) - A_{i-\\frac{1}{2}} J_{i-\\frac{1}{2}}(t)}{V_i},\n$$\n其中 $V_i$ 是球壳 $i$ 的体积，$A_{i\\pm\\frac{1}{2}}$ 和 $J_{i\\pm\\frac{1}{2}}(t)$ 是球壳界面的面积和通量。离散的体积平均浓度为：\n$$\n\\bar{c}_s(t) = \\frac{\\sum_{i=1}^{N} V_i c_i(t)}{\\sum_{i=1}^{N} V_i} = \\frac{1}{V_{\\text{total}}} \\sum_{i=1}^{N} V_i c_i(t).\n$$\n其时间导数为：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = \\frac{1}{V_{\\text{total}}} \\sum_{i=1}^{N} V_i \\frac{d c_i}{dt}(t).\n$$\n将 FVM ODE 代入 $\\frac{d c_i}{dt}$：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = \\frac{1}{V_{\\text{total}}} \\sum_{i=1}^{N} V_i \\left( -\\frac{A_{i+\\frac{1}{2}} J_{i+\\frac{1}{2}}(t) - A_{i-\\frac{1}{2}} J_{i-\\frac{1}{2}}(t)}{V_i} \\right).\n$$\n单元体积 $V_i$ 相消，剩下：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = -\\frac{1}{V_{\\text{total}}} \\sum_{i=1}^{N} \\left( A_{i+\\frac{1}{2}} J_{i+\\frac{1}{2}}(t) - A_{i-\\frac{1}{2}} J_{i-\\frac{1}{2}}(t) \\right).\n$$\n这是一个伸缩求和。所有内部通量项 $A_{i+\\frac{1}{2}} J_{i+\\frac{1}{2}}(t)$（对于 $i=1, \\dots, N-1$）都会抵消，只剩下整个区域边界上的项：\n$$\n\\sum_{i=1}^{N} \\left( A_{i+\\frac{1}{2}} J_{i+\\frac{1}{2}}(t) - A_{i-\\frac{1}{2}} J_{i-\\frac{1}{2}}(t) \\right) = A_{N+\\frac{1}{2}} J_{N+\\frac{1}{2}}(t) - A_{\\frac{1}{2}} J_{\\frac{1}{2}}(t).\n$$\n根据给定的边界条件，中心的通量为 $J_{\\frac{1}{2}}(t) = 0$，表面积为 $A_{\\frac{1}{2}} = 4\\pi (0)^2 = 0$。外表面的通量为 $J_{N+\\frac{1}{2}}(t) = J_s(t)$，面积为 $A_{N+\\frac{1}{2}} = 4\\pi R^2$。因此，该和简化为 $4\\pi R^2 J_s(t)$。将其代回：\n$$\n\\frac{d \\bar{c}_s}{dt}(t) = -\\frac{1}{V_{\\text{total}}} \\left( 4\\pi R^2 J_s(t) \\right) = -\\frac{4\\pi R^2}{\\frac{4\\pi}{3} R^3} J_s(t) = -\\frac{3}{R} J_s(t).\n$$\n这证明了 FVM 半离散化是内在守恒的，并且满足完全相同的宏观定律。\n\n该问题要求进行数值验证。这涉及三个步骤：\n1. 对 $c_i(t)$ 的 ODE 系统从 $t=0$ 到 $t=T$ 进行数值求解。这会引入时间积分误差。\n2. 在离散时间点 $t_k$ 计算 $\\bar{c}_s(t_k)$。\n3. 使用二阶中心有限差分近似 $\\frac{d\\bar{c}_s}{dt}(t_k)$，这会引入一个阶为 $O(\\Delta t^2)$ 的截断误差。\n\n因此，要计算的差异 $\\max_k \\left| \\frac{\\bar{c}_s(t_{k+1}) - \\bar{c}_s(t_{k-1})}{t_{k+1} - t_{k-1}} + \\frac{3}{R} J_s(t_k) \\right|$ 是步骤 1 和 3 中组合数值误差的度量，而不是 FVM 模型本身的缺陷。一个成功的实现将产生一个非常小的非零差异，反映这些数值上的不精确性。所提供的 Python 代码为给定的测试用例实现了此验证过程。它构建了 ODE 系统，使用一个鲁棒的隐式求解器（来自 `scipy.integrate.solve_ivp` 的 `BDF` 方法，具有严格的容差）进行求解，然后按规定计算最大差异。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1\n        {\n            \"R\": 5e-6, \"Ds\": 1e-14, \"N\": 41, \"c0\": 20000, \n            \"Js_func\": lambda t, J0=1e-5, P=50: J0 * np.sin(2 * np.pi * t / P), \n            \"T\": 50, \"M\": 401\n        },\n        # Case 2\n        {\n            \"R\": 8e-6, \"Ds\": 5e-15, \"N\": 31, \"c0\": 20000, \n            \"Js_func\": lambda t, J0=2e-5, t_step=10: J0 * (np.array(t) >= t_step) if isinstance(t, (list, np.ndarray)) else J0 if t >= t_step else 0.0,\n            \"T\": 40, \"M\": 401\n        },\n        # Case 3\n        {\n            \"R\": 1e-5, \"Ds\": 1e-13, \"N\": 21, \"c0\": 20000,\n            \"Js_func\": lambda t, a=1e-6: a * t, \n            \"T\": 30, \"M\": 301\n        },\n        # Case 4\n        {\n            \"R\": 5e-6, \"Ds\": 1e-14, \"N\": 11, \"c0\": 20000, \n            \"Js_func\": lambda t: 0.0 * np.ones_like(np.array(t)) if isinstance(t, (list, np.ndarray)) else 0.0,\n            \"T\": 20, \"M\": 201\n        },\n        # Case 5\n        {\n            \"R\": 2e-6, \"Ds\": 1e-12, \"N\": 2, \"c0\": 20000, \n            \"Js_func\": lambda t, J0=5e-6, P=10: J0 * np.cos(2 * np.pi * t / P),\n            \"T\": 10, \"M\": 201\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        discrepancy = solve_case(**params)\n        results.append(discrepancy)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_case(R, Ds, N, c0, Js_func, T, M):\n    \"\"\"\n    Solves a single test case for the FVM verification problem.\n    \"\"\"\n    # 1. Setup Grid and FVM parameters\n    delta_r = R / N\n    # Face radii: r_{1/2}, r_{3/2}, ..., r_{N+1/2}\n    r_faces = np.linspace(0, R, N + 1)\n    \n    # Face surface areas\n    A_faces = 4 * np.pi * r_faces**2\n    \n    # Cell volumes\n    V_cells = (4 * np.pi / 3) * (r_faces[1:]**3 - r_faces[:-1]**3)\n    \n    # Total volume\n    V_total = (4 * np.pi / 3) * R**3\n\n    # 2. Define the ODE function for d(c_i)/dt\n    def ode_system(t, c):\n        # c is a vector of N cell concentrations [c_1, c_2, ..., c_N]\n        dcdt = np.zeros_like(c)\n\n        # Fluxes at interior faces (i = 1 to N-1)\n        # J_{i+1/2} = -Ds * (c_{i+1} - c_i) / delta_r\n        J_internal = -Ds * (c[1:] - c[:-1]) / delta_r\n\n        # Assemble all face fluxes into a single array of size N+1\n        # Fluxes at J_{1/2}, J_{3/2}, ..., J_{N+1/2}\n        J_faces = np.zeros(N + 1)\n        J_faces[0] = 0.0  # Symmetry at r=0\n        J_faces[1:N] = J_internal\n        J_faces[N] = Js_func(t)  # Boundary condition at r=R\n\n        # Calculate rate of change for each cell concentration\n        # d(c_i)/dt = -(A_{i+1/2}*J_{i+1/2} - A_{i-1/2}*J_{i-1/2}) / V_i\n        flux_in = A_faces[:-1] * J_faces[:-1]\n        flux_out = A_faces[1:] * J_faces[1:]\n        \n        dcdt = -(flux_out - flux_in) / V_cells\n\n        return dcdt\n\n    # 3. Time Integration\n    c_initial = np.full(N, c0, dtype=float)\n    t_eval = np.linspace(0, T, M)\n    \n    sol = solve_ivp(\n        ode_system, \n        [0, T], \n        c_initial, \n        t_eval=t_eval, \n        method='BDF',  # Suitable for stiff problems like diffusion\n        rtol=1e-9, \n        atol=1e-12\n    )\n    \n    c_results = sol.y # Shape (N, M)\n\n    # 4. Post-processing and Verification\n    # Calculate volume-average concentration at each time point\n    # c_bar(t) = sum(V_i * c_i(t)) / V_total\n    c_bar_t = (V_cells @ c_results) / V_total\n    \n    # Approximate d(c_bar)/dt using a second-order central difference\n    # We can only do this for interior points k = 1, ..., M-2\n    t_interior = t_eval[1:-1]\n    \n    # c_bar at t_{k+1}, t_{k-1}\n    c_bar_t_plus_1 = c_bar_t[2:]\n    c_bar_t_minus_1 = c_bar_t[:-2]\n    \n    # time step for central difference is t_{k+1} - t_{k-1}\n    dt_central = t_eval[2] - t_eval[0] # for uniform grid\n    \n    dc_bar_dt_numerical = (c_bar_t_plus_1 - c_bar_t_minus_1) / dt_central\n    \n    # Calculate the theoretical value of the derivative\n    dc_bar_dt_theoretical = -3.0 / R * Js_func(t_interior)\n    \n    # Calculate the discrepancy\n    # Per the problem statement: discrepancy = abs(numerical + 3/R * Js)\n    discrepancy_per_point = np.abs(dc_bar_dt_numerical - dc_bar_dt_theoretical)\n    \n    # Find the maximum absolute discrepancy\n    max_discrepancy = np.max(discrepancy_per_point)\n    \n    return max_discrepancy\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在真实的电池模型中，边界通量并非一个简单的常数，而是由复杂的电化学反应（例如通过Butler-Volmer方程描述的反应）决定，而这些反应又依赖于颗粒*表面*的固相浓度。本练习深入探讨了一个关键的数值细节：如何从离散的网格点精确地近似这个表面浓度，以及不同的近似方案如何影响整个模拟的准确性。这项技能对于以稳健的方式将扩散模型与电化学动力学耦合起来至关重要。",
            "id": "3950493",
            "problem": "考虑锂离子电池中一个半径为 $R$ 的球形活性材料颗粒。固相浓度 $c_s(r,t)$ 在球坐标系中满足菲克扩散，由守恒定律和菲克第二定律给出：\n$$\\frac{\\partial c_s}{\\partial t} = \\frac{D_s}{r^2}\\frac{\\partial}{\\partial r}\\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right), \\quad 0 \\le r \\le R,$$\n在中心 $r=0$ 处的对称性由下式强制执行 $$\\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=0}=0$$ 并且在表面 $r=R$ 处的通量边界条件由下式强制执行 $$\\left.-D_s \\frac{\\partial c_s}{\\partial r}\\right|_{r=R}=J_s.$$\n\n在自动化电池设计和仿真中，表面的界面摩尔通量 $J_s$ 通过表面浓度 $c_{s,\\mathrm{surf}} = c_s(R,t)$ 依赖于 Butler–Volmer 动力学。电流密度 $j$ (单位 A/m$^2$) 遵循\n$$j = i_0(c_{s,\\mathrm{surf}}, c_e)\\left[\\exp\\left(\\frac{\\alpha_a F \\eta}{R_{\\mathrm{gas}} T}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{R_{\\mathrm{gas}} T}\\right)\\right],$$\n其中交换电流密度 $i_0(c_{s,\\mathrm{surf}}, c_e)$ 由下式给出\n$$i_0 = k_0 \\, c_e^{\\alpha_e} \\, \\left(c_{s,\\max} - c_{s,\\mathrm{surf}}\\right)^{\\alpha_c} \\, \\left(c_{s,\\mathrm{surf}}\\right)^{\\alpha_a}.$$\n摩尔通量为 $$J_s = \\frac{j}{F}.$$\n此处，$F$ 是法拉第常数，$R_{\\mathrm{gas}}$ 是通用气体常数，$T$ 是温度，$\\eta$ 是过电势，$k_0$ 是动力学前置因子，$c_e$ 是电解质浓度，$c_{s,\\max}$ 是最大固相浓度，$\\alpha_a$、$\\alpha_c$、$\\alpha_e$ 是电荷转移系数。\n\n在球形颗粒的有限体积或有限差分离散化中，表面浓度 $c_{s,\\mathrm{surf}}$ 并不直接存储在节点上，必须从近表面节点近似得到，以评估 Butler-Volmer 关系。您的任务是定义并实现数值程序，从最后几个近表面节点近似 $c_{s,\\mathrm{surf}}$，并量化其对 $J_s$ 评估准确性的影响。\n\n假设近表面轮廓是平滑的，在局部由一个关于向内距离 $x = R - r$ 的三阶类泰勒多项式表示，\n$$c_s(r) = c_0 + A x + B x^2 + C x^3,$$\n其中 $c_0 = c_{s,\\mathrm{surf}}$ 是真实表面浓度，$A$、$B$、$C$ 是编码局部梯度和曲率的平滑系数。对于给定的网格间距 $h0$，近表面节点位于 $r_1 = R - h$，$r_2 = R - 2h$ 和 $r_3 = R - 3h$，因此相应的浓度为 $c_1 = c_s(r_1)$，$c_2 = c_s(r_2)$ 和 $c_3 = c_s(r_3)$。\n\n实现以下三个程序，从 $\\{c_1,c_2,c_3\\}$ 中近似 $c_{s,\\mathrm{surf}}$：\n- 程序 $P_0$ (最近节点法): $$\\widehat{c}_{s,\\mathrm{surf}}^{(0)} = c_1.$$\n- 程序 $P_1$ (使用两个节点的单边线性外推法): $$\\widehat{c}_{s,\\mathrm{surf}}^{(1)} = 2 c_1 - c_2.$$\n- 程序 $P_2$ (对三个节点进行二次拟合，外推至 $x=0$): 确定在 $x$ 中的二次多项式，该多项式插值于 $\\{(h,c_1),(2h,c_2),(3h,c_3)\\}$，并在 $x=0$ 处求值以获得 $$\\widehat{c}_{s,\\mathrm{surf}}^{(2)}.$$\n\n对于每个程序，使用近似的 $\\widehat{c}_{s,\\mathrm{surf}}$ 计算 Butler-Volmer 电流密度 $j$ 和相应的摩尔通量 $J_s$。通过计算 $J_s$ 相对于使用 $c_{s,\\mathrm{surf}}=c_0$ 计算的真实值的相对误差来量化其影响：\n$$\\varepsilon = \\frac{\\left|J_s\\left(\\widehat{c}_{s,\\mathrm{surf}}\\right) - J_s\\left(c_0\\right)\\right|}{\\left|J_s\\left(c_0\\right)\\right|}.$$\n\n使用以下物理上合理的参数集测试套件。除非另有说明，常数在所有案例中共享：$F = 96485.33212$ C/mol，$R_{\\mathrm{gas}} = 8.314462618$ J/(mol K)，$T = 298.15$ K，$\\alpha_a = 0.5$，$\\alpha_c = 0.5$，$\\alpha_e = 0.5$，$k_0 = 2.0$ A m$^{-2}$ (单位已安排好，以使此任务的数值评估自洽)，$c_{s,\\max} = 3.1\\times 10^4$ mol/m$^3$，以及 $c_e = 1.0\\times 10^3$ mol/m$^3$。\n\n测试用例 (每行为 $(R,h,\\eta,c_0,A,B,C)$，其中 $R$ 和 $h$ 的单位是米，$\\eta$ 的单位是伏特，浓度的单位是 mol/m$^3$；系数 $A$ 的单位是 mol m$^{-4}$，$B$ 的单位是 mol m$^{-5}$，$C$ 的单位是 mol m$^{-6}$):\n1. $\\left(5.0\\times 10^{-6},\\,5.0\\times 10^{-7},\\,5.0\\times 10^{-2},\\,2.5\\times 10^4,\\, -2.0\\times 10^{6},\\, 5.0\\times 10^{12},\\, -2.0\\times 10^{18}\\right)$\n2. $\\left(5.0\\times 10^{-6},\\,1.5\\times 10^{-6},\\,5.0\\times 10^{-2},\\,2.5\\times 10^4,\\, -2.0\\times 10^{6},\\, 5.0\\times 10^{12},\\, -2.0\\times 10^{18}\\right)$\n3. $\\left(5.0\\times 10^{-6},\\,1.0\\times 10^{-6},\\,2.0\\times 10^{-1},\\,0.95\\times 3.1\\times 10^4,\\, -1.0\\times 10^{6},\\, 3.0\\times 10^{12},\\, -1.0\\times 10^{18}\\right)$\n4. $\\left(5.0\\times 10^{-6},\\,5.0\\times 10^{-7},\\,5.0\\times 10^{-2},\\,1.5\\times 10^4,\\, -1.0\\times 10^{5},\\, 0,\\, 0\\right)$\n\n您的程序必须：\n- 对于每个测试用例，使用给定的 $c_0$、$A$、$B$、$C$、$R$ 和 $h$ 从多项式轮廓构建 $c_1$、$c_2$、$c_3$。\n- 计算 $\\widehat{c}_{s,\\mathrm{surf}}^{(0)}$、$\\widehat{c}_{s,\\mathrm{surf}}^{(1)}$ 和 $\\widehat{c}_{s,\\mathrm{surf}}^{(2)}$。\n- 对每个近似值和真实的 $c_0$ 使用 Butler-Volmer 方程计算 $J_s$。\n- 按 $P_0$、$P_1$、$P_2$ 的顺序返回三个程序的相对误差 $\\varepsilon^{(0)}$、$\\varepsilon^{(1)}$ 和 $\\varepsilon^{(2)}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表的列表，每个测试用例一个内部列表，每个内部列表按 $[\\varepsilon^{(0)}, \\varepsilon^{(1)}, \\varepsilon^{(2)}]$ 的顺序排列。例如，两个测试用例的有效输出应如下所示：$[[0.001,0.0001,1.0\\times 10^{-5}],[0.01,0.001,1.0\\times 10^{-4}]]$。\n- 相对误差 $\\varepsilon$ 是无量纲的；以十进制数值报告，不带任何单位。\n\n确保科学真实性，并从第一性原理推导您的设计。实现必须是通用的，除了上述定义所要求的之外，不得硬编码任何中间公式。程序必须是自包含的，并且不需要任何输入。计算在指定的参数范围内应是数值适定的，并且代码必须遵守其他地方描述的运行时环境约束。",
            "solution": "该问题要求实现和评估三种数值程序，用于近似锂离子电池中球形活性材料颗粒的表面浓度。这些近似的准确性将通过它们在计算界面摩尔通量时引入的相对误差来量化，该通量由 Butler-Volmer 动力学控制。解决方案通过系统地推导所需公式和概述计算算法来进行。\n\n首先，我们分析摩尔通量 $J_s$ 作为固相表面浓度 $c_{s,\\mathrm{surf}}$ 的函数的计算。问题提供了电流密度 $j$ 的 Butler-Volmer 方程：\n$$ j = i_0(c_{s,\\mathrm{surf}}, c_e)\\left[\\exp\\left(\\frac{\\alpha_a F \\eta}{R_{\\mathrm{gas}} T}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{R_{\\mathrm{gas}} T}\\right)\\right] $$\n交换电流密度 $i_0$ 由下式给出：\n$$ i_0 = k_0 \\, c_e^{\\alpha_e} \\, \\left(c_{s,\\max} - c_{s,\\mathrm{surf}}\\right)^{\\alpha_c} \\, \\left(c_{s,\\mathrm{surf}}\\right)^{\\alpha_a} $$\n摩尔通量 $J_s$ 通过法拉第常数 $F$ 与电流密度 $j$ 相关：\n$$ J_s = \\frac{j}{F} $$\n对于给定的测试用例，参数 $F$、$R_{\\mathrm{gas}}$、$T$、$\\eta$、$\\alpha_a$、$\\alpha_c$、$\\alpha_e$、$k_0$、$c_e$ 和 $c_{s,\\max}$ 都是常数。因此，通量 $J_s$ 可以表示为单个变量 $c_{s,\\mathrm{surf}}$ 的函数：\n$$ J_s(c_{s,\\mathrm{surf}}) = \\frac{k_0 \\, c_e^{\\alpha_e}}{F} \\left(c_{s,\\max} - c_{s,\\mathrm{surf}}\\right)^{\\alpha_c} \\left(c_{s,\\mathrm{surf}}\\right)^{\\alpha_a} \\left[\\exp\\left(\\frac{\\alpha_a F \\eta}{R_{\\mathrm{gas}} T}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{R_{\\mathrm{gas}} T}\\right)\\right] $$\n此函数将用于计算使用精确表面浓度 $c_0$ 的“真实”通量，以及使用数值估计的表面浓度的近似通量。\n\n接下来，我们确定近表面节点的浓度值。问题将局部浓度轮廓定义为关于向内径向坐标 $x = R - r$ 的三阶多项式：\n$$ c_s(x) = c_0 + A x + B x^2 + C x^3 $$\n此处，$c_0$ 是真实表面浓度 $c_{s,\\mathrm{surf}}$，$A$、$B$ 和 $C$ 是给定的系数。数值网格的节点位于 $r_1 = R - h$、$r_2 = R - 2h$ 和 $r_3 = R - 3h$，分别对应于向内距离 $x_1=h$、$x_2=2h$ 和 $x_3=3h$。这些节点的浓度，记为 $c_1$、$c_2$ 和 $c_3$，通过将这些 $x$ 的值代入多项式得到：\n$$ c_1 = c_s(h) = c_0 + A h + B h^2 + C h^3 $$\n$$ c_2 = c_s(2h) = c_0 + A(2h) + B(2h)^2 + C(2h)^3 = c_0 + 2Ah + 4Bh^2 + 8Ch^3 $$\n$$ c_3 = c_s(3h) = c_0 + A(3h) + B(3h)^2 + C(3h)^3 = c_0 + 3Ah + 9Bh^2 + 27Ch^3 $$\n对于每个测试用例，都提供了参数 $c_0、A、B、C$ 和 $h$，从而可以直接计算 $c_1、c_2$ 和 $c_3$。\n\n在已知节点浓度的情况下，我们可以实现三个指定的程序来近似表面浓度 $\\widehat{c}_{s,\\mathrm{surf}}$。真实值为 $c_{s,\\mathrm{surf}} = c_s(x=0) = c_0$。\n\n程序 $P_0$ (最近节点近似)：这是最简单的近似，使用最近节点处的值。\n$$ \\widehat{c}_{s,\\mathrm{surf}}^{(0)} = c_1 $$\n\n程序 $P_1$ (线性外推)：此程序使用单边双点公式外推至表面。它等效于通过点 $(2h, c_2)$ 和 $(h, c_1)$ 画一条直线，并找到其在 $x=0$ 处的截距。公式给出如下：\n$$ \\widehat{c}_{s,\\mathrm{surf}}^{(1)} = 2 c_1 - c_2 $$\n这可以看作是抵消了围绕表面的泰勒展开中的一阶项。\n\n程序 $P_2$ (二次外推)：此程序涉及将二次多项式 $p(x) = \\gamma + \\beta x + \\alpha x^2$ 拟合到三个点 $(h, c_1)$、$(2h, c_2)$ 和 $(3h, c_3)$，并在 $x=0$ 处求值以找到近似值 $\\widehat{c}_{s,\\mathrm{surf}}^{(2)} = p(0) = \\gamma$。这导致以下关于系数 $\\gamma, \\beta, \\alpha$ 的线性方程组：\n$$ c_1 = \\gamma + \\beta h + \\alpha h^2 $$\n$$ c_2 = \\gamma + \\beta (2h) + \\alpha (2h)^2 $$\n$$ c_3 = \\gamma + \\beta (3h) + \\alpha (3h)^2 $$\n我们只需要解出 $\\gamma$。使用初等行变换或克莱姆法则，可以推导出 $\\gamma$ 关于 $c_1$、$c_2$ 和 $c_3$ 的直接表达式。对于均匀网格，数值分析中的一个标准结果给出了 $x=0$ 处外推值的解，作为函数值的线性组合：\n$$ \\widehat{c}_{s,\\mathrm{surf}}^{(2)} = 3c_1 - 3c_2 + c_3 $$\n该公式将用于计算。\n\n最后，我们通过计算所得摩尔通量中的相对误差 $\\varepsilon$ 来量化每种近似的影响。对于每个程序 $k \\in \\{0, 1, 2\\}$，我们首先计算近似通量 $J_s(\\widehat{c}_{s,\\mathrm{surf}}^{(k)})$ 和真实通量 $J_s(c_0)$。然后相对误差为：\n$$ \\varepsilon^{(k)} = \\frac{\\left|J_s(\\widehat{c}_{s,\\mathrm{surf}}^{(k)}) - J_s(c_0)\\right|}{\\left|J_s(c_0)\\right|} $$\n由于测试用例具有非零过电势 $\\eta$ 且浓度在其物理界限内（$0  c_0  c_{s,\\max}$），分母 $J_s(c_0)$ 将不为零，确保相对误差是良定义的。\n\n最终程序中实现的算法将对每个测试用例遵循以下步骤：\n1. 接收参数 $(R, h, \\eta, c_0, A, B, C)$。\n2. 使用多项式轮廓计算节点浓度 $c_1, c_2, c_3$。\n3. 计算三个表面浓度近似值：$\\widehat{c}_{s,\\mathrm{surf}}^{(0)}$、$\\widehat{c}_{s,\\mathrm{surf}}^{(1)}$ 和 $\\widehat{c}_{s,\\mathrm{surf}}^{(2)}$。\n4. 计算真实摩尔通量 $J_s(c_0)$。\n5. 对于每个近似值 $\\widehat{c}_{s,\\mathrm{surf}}^{(k)}$，计算近似通量 $J_s(\\widehat{c}_{s,\\mathrm{surf}}^{(k)})$ 和相应的相对误差 $\\varepsilon^{(k)}$。\n6. 为当前测试用例收集三个误差 $[\\varepsilon^{(0)}, \\varepsilon^{(1)}, \\varepsilon^{(2)}]$。\n7. 处理完所有测试用例后，按照问题陈述中指定的格式将收集到的结果格式化为单个字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of evaluating surface concentration approximation errors\n    in a battery particle model.\n    \"\"\"\n    # Define physical and electrochemical constants\n    F = 96485.33212  # Faraday constant in C/mol\n    R_GAS = 8.314462618  # Universal gas constant in J/(mol K)\n    T = 298.15  # Temperature in K\n    ALPHA_A = 0.5  # Anodic charge-transfer coefficient\n    ALPHA_C = 0.5  # Cathodic charge-transfer coefficient\n    ALPHA_E = 0.5  # Electrolyte concentration order\n    K0 = 2.0  # Kinetic prefactor (units consistent with A m^-2)\n    C_S_MAX = 3.1e4  # Maximum solid concentration in mol/m^3\n    C_E = 1.0e3  # Electrolyte concentration in mol/m^3\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (R, h, eta, c0, A, B, C)\n        # R [m], h [m], eta [V], c0 [mol/m^3], A [mol/m^4], B [mol/m^5], C [mol/m^6]\n        (5.0e-6, 5.0e-7, 5.0e-2, 2.5e4, -2.0e6, 5.0e12, -2.0e18),\n        (5.0e-6, 1.5e-6, 5.0e-2, 2.5e4, -2.0e6, 5.0e12, -2.0e18),\n        (5.0e-6, 1.0e-6, 2.0e-1, 0.95 * 3.1e4, -1.0e6, 3.0e12, -1.0e18),\n        (5.0e-6, 5.0e-7, 5.0e-2, 1.5e4, -1.0e5, 0.0, 0.0),\n    ]\n\n    def calculate_Js(c_surf, eta):\n        \"\"\"\n        Calculates the molar flux Js based on surface concentration and overpotential.\n        \n        Args:\n            c_surf (float): The surface concentration in mol/m^3.\n            eta (float): The overpotential in V.\n\n        Returns:\n            float: The molar flux Js in mol/(m^2 s).\n        \"\"\"\n        # Ensure concentration is within physical bounds to avoid math domain errors.\n        # This is a precaution; the given test cases should not violate these bounds.\n        if c_surf = 0 or c_surf >= C_S_MAX:\n             # Use a small epsilon to avoid log(0) or power of negative number issues.\n             c_surf = np.clip(c_surf, 1e-9, C_S_MAX - 1e-9)\n\n        # Exchange current density i0\n        i0 = K0 * (C_E**ALPHA_E) * ((C_S_MAX - c_surf)**ALPHA_C) * (c_surf**ALPHA_A)\n        \n        # Overpotential-dependent term from Butler-Volmer equation\n        exp_arg_base = F / (R_GAS * T)\n        exp_term_a = np.exp(ALPHA_A * exp_arg_base * eta)\n        exp_term_c = np.exp(-ALPHA_C * exp_arg_base * eta)\n        overpotential_term = exp_term_a - exp_term_c\n        \n        # Current density j\n        j = i0 * overpotential_term\n        \n        # Molar flux Js\n        Js = j / F\n        \n        return Js\n\n    all_results = []\n    for R, h, eta, c0, A, B, C in test_cases:\n        # Step 1: Construct concentrations at near-surface nodes c1, c2, c3\n        h_sq = h * h\n        h_cb = h_sq * h\n        c1 = c0 + A * h + B * h_sq + C * h_cb\n        \n        h2, h2_sq, h2_cb = 2*h, (2*h)**2, (2*h)**3\n        c2 = c0 + A * h2 + B * h2_sq + C * h2_cb\n        \n        h3, h3_sq, h3_cb = 3*h, (3*h)**2, (3*h)**3\n        c3 = c0 + A * h3 + B * h3_sq + C * h3_cb\n\n        # Step 2: Compute approximated surface concentrations\n        # P0: Nearest-node\n        c_surf_approx_0 = c1\n        # P1: Linear extrapolation\n        c_surf_approx_1 = 2 * c1 - c2\n        # P2: Quadratic extrapolation\n        c_surf_approx_2 = 3 * c1 - 3 * c2 + c3\n        \n        approximations = [c_surf_approx_0, c_surf_approx_1, c_surf_approx_2]\n        \n        # Step 3: Compute true molar flux\n        Js_true = calculate_Js(c0, eta)\n        \n        case_errors = []\n        for c_surf_approx in approximations:\n            # Step 4: Compute approximate molar flux\n            Js_approx = calculate_Js(c_surf_approx, eta)\n            \n            # Step 5: Compute relative error\n            # Denominator will not be zero for the given test cases.\n            error = np.abs(Js_approx - Js_true) / np.abs(Js_true)\n            case_errors.append(error)\n            \n        all_results.append(case_errors)\n\n    # Final print statement in the exact required format.\n    inner_lists = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(inner_lists)}]\")\n\nsolve()\n```"
        }
    ]
}