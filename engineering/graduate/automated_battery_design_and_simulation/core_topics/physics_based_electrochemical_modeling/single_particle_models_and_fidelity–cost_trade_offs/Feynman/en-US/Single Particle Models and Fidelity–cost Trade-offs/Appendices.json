{
    "hands_on_practices": [
        {
            "introduction": "The first step in efficient battery modeling is choosing a model with the right level of complexity for the task. This practice introduces timescale analysis, a powerful first-principles technique for making this choice. By deriving and comparing the characteristic times for solid-phase diffusion ($ \\tau_s $) and electrolyte-phase diffusion ($ \\tau_e $), you will learn to quantitatively justify when the computationally inexpensive Single Particle Model (SPM), which neglects electrolyte dynamics, is a valid approximation .",
            "id": "3949392",
            "problem": "A lithium-ion cell is modeled under the assumption of spherical active material particles embedded in a porous electrode and a one-dimensional electrolyte domain across the separator. The Single Particle Model (SPM) neglects electrolyte concentration dynamics, whereas the Single Particle Model with electrolyte (SPMe) retains them. Starting from Fick’s second law of diffusion for both the solid phase and the electrolyte, and using dimensional analysis to identify characteristic diffusive time scales, derive expressions for the characteristic solid diffusion time in a particle, denoted by $\\tau_{s}$, and the characteristic electrolyte diffusion time across the separator, denoted by $\\tau_{e}$. Then, evaluate these time scales numerically for a cell with spherical particle radius $R_{p} = 5\\ \\mu\\mathrm{m}$, solid-phase diffusion coefficient $D_{s} = 10^{-14}\\ \\mathrm{m}^{2}/\\mathrm{s}$, separator thickness $L_{e} = 50\\ \\mu\\mathrm{m}$, and electrolyte diffusion coefficient $D_{e} = 10^{-10}\\ \\mathrm{m}^{2}/\\mathrm{s}$. Compute the ratio $\\tau_{s}/\\tau_{e}$ and, by comparing the time scales against a $2\\ \\mathrm{C}$ discharge (where $1\\ \\mathrm{C}$ denotes a one-hour discharge), state whether neglecting electrolyte polarization in the SPM is expected to be fidelity-acceptable at $2\\ \\mathrm{C}$. Express $\\tau_{s}$ and $\\tau_{e}$ in seconds. Report the final answer as the pure number $\\tau_{s}/\\tau_{e}$, with no units, and do not round unless necessary.",
            "solution": "The problem statement is first validated for scientific soundness, completeness, and objectivity.\n\n**Step 1: Extract Givens**\n- **Model:** A lithium-ion cell with spherical active material particles and a one-dimensional electrolyte domain.\n- **Models for comparison:** Single Particle Model (SPM) and Single Particle Model with electrolyte (SPMe).\n- **Assumptions:** SPM neglects electrolyte concentration dynamics; SPMe retains them.\n- **Governing Physics:** Fick’s second law of diffusion for both solid and electrolyte phases.\n- **Data:**\n    - Spherical particle radius, $R_{p} = 5\\ \\mu\\mathrm{m}$.\n    - Solid-phase diffusion coefficient, $D_{s} = 10^{-14}\\ \\mathrm{m}^{2}/\\mathrm{s}$.\n    - Separator thickness, $L_{e} = 50\\ \\mu\\mathrm{m}$.\n    - Electrolyte diffusion coefficient, $D_{e} = 10^{-10}\\ \\mathrm{m}^{2}/\\mathrm{s}$.\n- **Process condition:** $2\\ \\mathrm{C}$ discharge.\n- **Definition:** $1\\ \\mathrm{C}$ is a one-hour discharge.\n- **Task:**\n    1. Derive expressions for the characteristic solid diffusion time, $\\tau_{s}$, and electrolyte diffusion time, $\\tau_{e}$.\n    2. Numerically evaluate $\\tau_{s}$ and $\\tau_{e}$ in seconds.\n    3. Compute the ratio $\\tau_{s}/\\tau_{e}$.\n    4. Assess if neglecting electrolyte polarization in the SPM is fidelity-acceptable at $2\\ \\mathrm{C}$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, relying on Fick's laws of diffusion and standard battery models (SPM/SPMe). The provided physical parameters ($R_p$, $D_s$, $L_e$, $D_e$) are within realistic ranges for typical lithium-ion batteries. The problem is well-posed, providing all necessary information for a unique solution. The terminology is precise and objective. The task is directly relevant to the fidelity–cost trade-offs in battery simulation, a core concept in automated battery design. The problem does not violate any of the invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A full solution will be provided.\n\n**Derivation of Characteristic Time Scales**\nThe diffusion processes in both the solid active material and the liquid electrolyte are governed by Fick's second law, which has the general form:\n$$\n\\frac{\\partial c}{\\partial t} = D \\nabla^2 c\n$$\nwhere $c$ is the concentration of the diffusing species, $t$ is time, and $D$ is the diffusion coefficient. To find the characteristic time scale of this process, we perform a dimensional analysis. Let $[L]$ denote the characteristic length scale over which diffusion occurs and $[\\tau]$ be the characteristic time scale. The terms in the equation can be scaled as:\n$$\n\\frac{\\partial c}{\\partial t} \\sim \\frac{\\Delta c}{\\tau}\n$$\n$$\nD \\nabla^2 c \\sim D \\frac{\\Delta c}{L^2}\n$$\nFor these terms to be of the same order of magnitude, which they must be for the dynamics to be described by the equation, their scales must balance:\n$$\n\\frac{1}{\\tau} \\sim \\frac{D}{L^2}\n$$\nThis gives the characteristic time for a diffusion process:\n$$\n\\tau = \\frac{L^2}{D}\n$$\n\nFor the solid active material particle, the diffusion of lithium ions occurs within a sphere of radius $R_{p}$. The characteristic length scale is therefore $L = R_{p}$. The corresponding diffusion coefficient is $D_{s}$. The characteristic solid diffusion time, $\\tau_{s}$, is:\n$$\n\\tau_{s} = \\frac{R_{p}^2}{D_{s}}\n$$\n\nFor the electrolyte, the diffusion of lithium ions occurs across the separator, which has a thickness $L_{e}$. The characteristic length scale is $L = L_{e}$. The corresponding diffusion coefficient is $D_{e}$. The characteristic electrolyte diffusion time, $\\tau_{e}$, is:\n$$\n\\tau_{e} = \\frac{L_{e}^2}{D_{e}}\n$$\n\n**Numerical Evaluation**\nWe are given the following values, which must be converted to base SI units (meters, seconds):\n- $R_{p} = 5\\ \\mu\\mathrm{m} = 5 \\times 10^{-6}\\ \\mathrm{m}$\n- $D_{s} = 10^{-14}\\ \\mathrm{m}^{2}/\\mathrm{s}$\n- $L_{e} = 50\\ \\mu\\mathrm{m} = 50 \\times 10^{-6}\\ \\mathrm{m} = 5 \\times 10^{-5}\\ \\mathrm{m}$\n- $D_{e} = 10^{-10}\\ \\mathrm{m}^{2}/\\mathrm{s}$\n\nNow, we can calculate $\\tau_{s}$ and $\\tau_{e}$.\n\nFor the solid phase:\n$$\n\\tau_{s} = \\frac{(5 \\times 10^{-6}\\ \\mathrm{m})^2}{10^{-14}\\ \\mathrm{m}^{2}/\\mathrm{s}} = \\frac{25 \\times 10^{-12}\\ \\mathrm{m}^2}{10^{-14}\\ \\mathrm{m}^{2}/\\mathrm{s}} = 25 \\times 10^{2}\\ \\mathrm{s} = 2500\\ \\mathrm{s}\n$$\n\nFor the electrolyte phase:\n$$\n\\tau_{e} = \\frac{(5 \\times 10^{-5}\\ \\mathrm{m})^2}{10^{-10}\\ \\mathrm{m}^{2}/\\mathrm{s}} = \\frac{25 \\times 10^{-10}\\ \\mathrm{m}^2}{10^{-10}\\ \\mathrm{m}^{2}/\\mathrm{s}} = 25\\ \\mathrm{s}\n$$\nSo, the characteristic time for solid diffusion is $\\tau_{s} = 2500\\ \\mathrm{s}$, and for electrolyte diffusion is $\\tau_{e} = 25\\ \\mathrm{s}$.\n\n**Calculation of the Ratio**\nThe ratio of the two time scales is:\n$$\n\\frac{\\tau_{s}}{\\tau_{e}} = \\frac{2500\\ \\mathrm{s}}{25\\ \\mathrm{s}} = 100\n$$\n\n**Fidelity Assessment of the SPM**\nThe SPM's central assumption is that electrolyte concentration gradients are negligible. This assumption holds if the electrolyte diffusion process is much faster than the overall process of interest, which is the cell discharge.\n\nFirst, we determine the characteristic time of the discharge process, $\\tau_{\\text{discharge}}$. A $1\\ \\mathrm{C}$ rate corresponds to a full discharge in $1$ hour.\n$$\n\\tau_{\\text{discharge}, 1\\mathrm{C}} = 1\\ \\mathrm{hour} = 3600\\ \\mathrm{s}\n$$\nA $2\\ \\mathrm{C}$ discharge is twice as fast, so the characteristic time is halved:\n$$\n\\tau_{\\text{discharge}, 2\\mathrm{C}} = \\frac{1\\ \\mathrm{hour}}{2} = 0.5\\ \\mathrm{hours} = 1800\\ \\mathrm{s}\n$$\nNow we compare the characteristic electrolyte diffusion time $\\tau_{e}$ to the discharge time $\\tau_{\\text{discharge}, 2\\mathrm{C}}$:\n- $\\tau_{e} = 25\\ \\mathrm{s}$\n- $\\tau_{\\text{discharge}, 2\\mathrm{C}} = 1800\\ \\mathrm{s}$\n\nThe condition for the SPM to be a valid approximation is $\\tau_{e} \\ll \\tau_{\\text{discharge}}$. In this case, $25 \\ll 1800$, with the ratio being $\\tau_{e}/\\tau_{\\text{discharge}, 2\\mathrm{C}} = 25/1800 \\approx 0.014$. Since the electrolyte diffusion time is roughly two orders of magnitude smaller than the discharge time, the electrolyte concentration can be considered to equilibrate almost instantaneously relative to the time scale of the discharge. Therefore, neglecting concentration polarization in the electrolyte, as done in the SPM, is expected to be a fidelity-acceptable approximation at a $2\\ \\mathrm{C}$ rate for this particular cell. The large ratio $\\tau_s / \\tau_e = 100$ further supports this conclusion, as it shows that solid-phase diffusion is the much slower process and thus the dominant limiting factor, which is precisely the dynamic that the SPM is designed to capture.\n\nThe problem requests the pure number representing the ratio $\\tau_s/\\tau_e$.\n$$\n\\frac{\\tau_s}{\\tau_e} = 100\n$$",
            "answer": "$$\\boxed{100}$$"
        },
        {
            "introduction": "Once a high-level model like the SPM is selected, further fidelity-cost trade-offs exist within the model's formulation, particularly at the boundaries. This exercise focuses on the critical physics at the active particle's surface by introducing the solid-phase Damköhler number, $ \\mathrm{Da}_s $. By comparing the timescales of surface reaction kinetics and solid-state diffusion, you will determine whether the system is reaction- or diffusion-controlled, a distinction that dictates the necessary complexity of the model's boundary conditions .",
            "id": "3949421",
            "problem": "A spherical intercalation particle model is widely used in Automated Battery Design and Simulation to balance modeling fidelity and computational cost. In the Single Particle Model (SPM) and the Single Particle Model with electrolyte (SPMe), the solid-phase concentration $c_s(r,t)$ within a spherical active material particle of radius $R_p$ evolves by diffusion, and the surface intercalation reaction imposes a boundary flux. You are tasked with quantifying the controlling physics at the particle surface during a $1\\ \\mathrm{C}$ galvanostatic operation, in order to decide whether a simplified constant-flux boundary (diffusion-controlled) is adequate or whether finite surface kinetics (reaction-controlled) must be retained. Use only first principles: Fick’s law in spherical coordinates, conservation of mass, and timescale arguments.\n\nDefinitions and data:\n- The Single Particle Model (SPM) treats each electrode as an ensemble of identical spherical particles; the Single Particle Model with electrolyte (SPMe) augments SPM by resolving electrolyte transport.\n- Under $1\\ \\mathrm{C}$ galvanostatic operation over an interval of $T=3600\\ \\mathrm{s}$, the electrode-average solid concentration in an active particle changes by $c_{s,\\max}$ when current is applied uniformly in time.\n- The solid diffusion coefficient is $D_s$, and the interfacial reaction is linearized as first-order with rate constant $k$ (units $\\mathrm{m/s}$) for the purposes of timescale comparison.\n- The dimensionless surface flux is defined by the canonical Fickian nondimensionalization as $\\tilde{j} = \\dfrac{j R_p}{D_s c_{s,\\max}}$, where $j$ is the molar flux at the particle surface (units $\\mathrm{mol}\\ \\mathrm{m}^{-2}\\ \\mathrm{s}^{-1}$).\n- The solid-phase Damköhler number is defined by the ratio of diffusion and reaction timescales $\\mathrm{Da}_s = \\dfrac{k R_p}{D_s}$.\n- Parameters: $R_p = 5.0 \\times 10^{-6}\\ \\mathrm{m}$, $D_s = 1.0 \\times 10^{-14}\\ \\mathrm{m}^2\\ \\mathrm{s}^{-1}$, $k = 3.0 \\times 10^{-11}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$, and $c_{s,\\max} = 3.1 \\times 10^{4}\\ \\mathrm{mol}\\ \\mathrm{m}^{-3}$.\n\nTasks:\n1. Starting from conservation of mass in a sphere and Fick’s law in spherical coordinates, derive an expression for the constant surface flux $j$ required to achieve the $1\\ \\mathrm{C}$ change in the particle-average concentration over time $T$, and then compute the dimensionless surface flux $\\tilde{j}$.\n2. Derive the solid-phase Damköhler number $\\mathrm{Da}_s$ from timescale arguments and compute its value.\n3. Using the magnitudes of $\\tilde{j}$ and $\\mathrm{Da}_s$ evaluated at mid state-of-charge (take the dimensionless surface concentration $\\theta_s \\equiv c_{s,s}/c_{s,\\max}$ to be approximately $0.5$ for this inference), explain which term dominates the surface concentration dynamics (diffusion-imposed constant-flux boundary versus reaction-limited Robin boundary) and justify which model fidelity is appropriate in an automated design pipeline.\n\nExpress the final numerical values of $\\tilde{j}$ and $\\mathrm{Da}_s$ in dimensionless form, rounded to four significant figures. Provide your final answer as a $1 \\times 2$ row matrix in the order $\\left(\\tilde{j},\\ \\mathrm{Da}_s\\right)$. Do not include units in the final answer.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It is based on standard principles of transport phenomena and electrochemistry as applied in the established Single Particle Model (SPM) for battery simulation. The parameters provided are physically realistic, and the tasks are clearly defined, leading to a unique and meaningful solution. The problem is therefore valid.\n\nThe solution will be presented in three parts, corresponding to the three tasks outlined in the problem statement.\n\n**1. Derivation and Computation of the Dimensionless Surface Flux, $\\tilde{j}$**\n\nThe first task is to determine the surface flux $j$ required to achieve the specified change in average concentration and then to compute its dimensionless form, $\\tilde{j}$. This derivation starts from the principle of mass conservation for the intercalated species within a single spherical particle.\n\nThe rate of change of the total moles of species, $N_s$, within the particle volume $V_p$ must equal the net molar flux across its surface area $A_p$. The total molar influx is the product of the surface flux $j$ (in units of $\\mathrm{mol}\\ \\mathrm{m}^{-2}\\ \\mathrm{s}^{-1}$) and the surface area $A_p = 4\\pi R_p^2$. Thus, the conservation equation is:\n$$\n\\frac{dN_s}{dt} = j A_p\n$$\nThe total number of moles $N_s$ is related to the volume-averaged concentration, $\\bar{c}_s(t)$, by $N_s(t) = \\bar{c}_s(t) V_p$, where the particle volume is $V_p = \\frac{4}{3}\\pi R_p^3$. Substituting this into the conservation equation gives:\n$$\n\\frac{d}{dt} \\left( \\bar{c}_s(t) V_p \\right) = j A_p\n$$\nAssuming the particle volume $V_p$ is constant, we have:\n$$\nV_p \\frac{d\\bar{c}_s}{dt} = j A_p\n$$\nSolving for the surface flux $j$:\n$$\nj = \\frac{V_p}{A_p} \\frac{d\\bar{c}_s}{dt} = \\frac{\\frac{4}{3}\\pi R_p^3}{4\\pi R_p^2} \\frac{d\\bar{c}_s}{dt} = \\frac{R_p}{3} \\frac{d\\bar{c}_s}{dt}\n$$\nThe problem defines a $1\\ \\mathrm{C}$ galvanostatic operation as one that changes the electrode-average solid concentration by $c_{s,\\max}$ over a time period $T = 3600\\ \\mathrm{s}$. Assuming a uniform current, the rate of change of the average concentration is constant and can be expressed as:\n$$\n\\frac{d\\bar{c}_s}{dt} = \\frac{\\Delta \\bar{c}_s}{\\Delta t} = \\frac{c_{s,\\max}}{T}\n$$\nSubstituting this into the expression for $j$ yields the required constant surface flux:\n$$\nj = \\frac{R_p c_{s,\\max}}{3 T}\n$$\nNext, we compute the dimensionless surface flux $\\tilde{j}$, which is defined in the problem as $\\tilde{j} = \\dfrac{j R_p}{D_s c_{s,\\max}}$. Substituting our derived expression for $j$:\n$$\n\\tilde{j} = \\frac{\\left( \\frac{R_p c_{s,\\max}}{3 T} \\right) R_p}{D_s c_{s,\\max}} = \\frac{R_p^2}{3 D_s T}\n$$\nNow, we substitute the given parameter values: $R_p = 5.0 \\times 10^{-6}\\ \\mathrm{m}$, $D_s = 1.0 \\times 10^{-14}\\ \\mathrm{m}^2\\ \\mathrm{s}^{-1}$, and $T = 3600\\ \\mathrm{s}$.\n$$\n\\tilde{j} = \\frac{(5.0 \\times 10^{-6})^2}{3 (1.0 \\times 10^{-14}) (3600)} = \\frac{2.5 \\times 10^{-11}}{1.08 \\times 10^{-10}} \\approx 0.231481...\n$$\nRounding to four significant figures, the dimensionless surface flux is $\\tilde{j} = 0.2315$.\n\n**2. Derivation and Computation of the Solid-Phase Damköhler Number, $\\mathrm{Da}_s$**\n\nThe solid-phase Damköhler number, $\\mathrm{Da}_s$, is a dimensionless group that compares the characteristic timescales of diffusion and reaction.\n\nThe characteristic time for diffusion, $\\tau_{diff}$, is the time it takes for a species to diffuse across a characteristic length, which is the particle radius $R_p$. From dimensional analysis, this timescale is given by:\n$$\n\\tau_{diff} = \\frac{R_p^2}{D_s}\n$$\nThe characteristic time for reaction, $\\tau_{rxn}$, is related to the interfacial reaction rate constant $k$, which has units of velocity ($\\mathrm{m}\\ \\mathrm{s}^{-1}$). The time it would take for a reaction process to propagate across the characteristic length $R_p$ is:\n$$\n\\tau_{rxn} = \\frac{R_p}{k}\n$$\nThe Damköhler number is defined as the ratio of the diffusion timescale to the reaction timescale:\n$$\n\\mathrm{Da}_s = \\frac{\\tau_{diff}}{\\tau_{rxn}} = \\frac{R_p^2 / D_s}{R_p / k} = \\frac{k R_p}{D_s}\n$$\nThis derived expression matches the definition provided in the problem statement. A value $\\mathrm{Da}_s \\ll 1$ indicates that the reaction is much slower than diffusion (reaction-controlled), while $\\mathrm{Da}_s \\gg 1$ indicates that diffusion is much slower than the reaction (diffusion-controlled).\n\nUsing the given parameter values: $k = 3.0 \\times 10^{-11}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$, $R_p = 5.0 \\times 10^{-6}\\ \\mathrm{m}$, and $D_s = 1.0 \\times 10^{-14}\\ \\mathrm{m}^2\\ \\mathrm{s}^{-1}$:\n$$\n\\mathrm{Da}_s = \\frac{(3.0 \\times 10^{-11}) (5.0 \\times 10^{-6})}{1.0 \\times 10^{-14}} = \\frac{1.5 \\times 10^{-16}}{1.0 \\times 10^{-14}} = 0.015\n$$\nExpressed to four significant figures, the Damköhler number is $\\mathrm{Da}_s = 0.01500$.\n\n**3. Interpretation of Controlling Physics and Model Fidelity**\n\nThe final task is to use the computed values of $\\tilde{j}$ and $\\mathrm{Da}_s$ to determine the controlling physics at the particle surface and to justify the appropriate model fidelity.\n\nThe computed values are:\n$$\n\\tilde{j} \\approx 0.2315 \\quad \\text{and} \\quad \\mathrm{Da}_s = 0.01500\n$$\n- $\\mathrm{Da}_s$ represents the intrinsic ratio of reaction rate to diffusion rate. Since $\\mathrm{Da}_s = 0.01500 \\ll 1$, the characteristic time for reaction ($\\tau_{rxn} = R_p/k \\approx 1.67 \\times 10^5\\ \\mathrm{s}$) is significantly longer than the characteristic time for diffusion ($\\tau_{diff} = R_p^2/D_s = 2500\\ \\mathrm{s}$). This indicates that the surface intercalation reaction is the slow, rate-limiting step. The system is fundamentally reaction-controlled.\n\n- $\\tilde{j}$ represents the dimensionless flux that is demanded by the external $1\\ \\mathrm{C}$ current. The boundary condition relating diffusion and reaction at the surface ($r=R_p$) is given by Fick's law, $-D_s \\frac{\\partial c_s}{\\partial r} = j_{rxn}$, where the reaction flux $j_{rxn}$ drives the process. In dimensionless form, this becomes $-\\frac{\\partial (c_s/c_{s,max})}{\\partial (r/R_p)} = \\frac{j_{rxn} R_p}{D_s c_{s,max}}$. The right-hand side is a dimensionless reaction flux. For the linearized reaction kinetics ($j_{rxn} \\propto k$), its characteristic magnitude is set by $\\mathrm{Da}_s$.\n\nWe observe that the required flux $\\tilde{j}$ is more than an order of magnitude larger than the intrinsic kinetic capability represented by $\\mathrm{Da}_s$ ($\\tilde{j} / \\mathrm{Da}_s \\approx 15.4$). This large disparity signifies that to achieve the required current, the surface reaction must be driven by a very large thermodynamic force. In the context of a Robin boundary condition of the form $-D_s \\frac{\\partial c_s}{\\partial r} = k(c_{s,s} - c_{s,eq})$, this implies a large deviation of the surface concentration $c_{s,s}$ from its equilibrium value $c_{s,eq}$. This concentration change at the surface, known as concentration overpotential, is the dominant physical phenomenon under these conditions.\n\n**Conclusion on Model Fidelity:**\nA simplified \"constant-flux\" boundary condition (a Neumann condition) is appropriate only for diffusion-controlled systems ($\\mathrm{Da}_s \\gg 1$), where surface kinetics are assumed to be infinitely fast and do not limit the process. In such a model, the imposed current translates directly into a concentration gradient, and the surface concentration itself is not a primary dynamic variable.\n\nGiven that our analysis shows the system is strongly reaction-controlled ($\\mathrm{Da}_s \\ll 1$), this simplified approach is inadequate. The primary physics is the kinetic limitation at the surface. Therefore, a higher-fidelity model that explicitly accounts for finite surface kinetics **must be retained**. This corresponds to using a Robin-type boundary condition, which captures the relationship between the flux and the surface concentration. For an automated battery design pipeline, using a simplified, inadequate model would lead to grossly inaccurate predictions, particularly of the cell's voltage response, as it would fail to capture the dominant kinetic overpotential. The additional computational cost of resolving the surface kinetics is justified by the necessity for physical accuracy.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.2315  0.01500 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Theoretical models are only useful once they can be solved, which for complex systems means numerical simulation. This practice bridges the gap between the continuous partial differential equation of the SPM and its discrete implementation on a computer. You will construct a finite-volume scheme to approximate the diffusion process within the particle, providing direct insight into how model fidelity (represented by the number of spatial divisions) translates into computational structure and cost .",
            "id": "3949410",
            "problem": "Let a spherical single-particle electrode be modeled by the conservation of species coupled with Fickian diffusion in spherical coordinates. The governing equation for the solid-phase lithium concentration $c_s(r,t)$ is\n$$\n\\frac{\\partial c_s}{\\partial t} = \\frac{1}{r^2}\\frac{\\partial}{\\partial r}\\left(r^2 D_s(c_s)\\frac{\\partial c_s}{\\partial r}\\right),\n$$\nwhere $r \\in [0,R_p]$, $t \\ge 0$, $D_s(c_s)$ is the solid-phase diffusivity, and $R_p$ is the particle radius. The boundary conditions are symmetry at the center,\n$$\n\\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=0} = 0,\n$$\nand a prescribed interfacial flux at the particle surface,\n$$\n- D_s(c_s)\\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=R_p} = j_{\\mathrm{surf}}(t),\n$$\nwhere $j_{\\mathrm{surf}}(t)$ is the molar flux at the surface. In the Single Particle Model (SPM) and Single Particle Model with Electrolyte dynamics (SPMe), this partial differential equation captures radial diffusion within a representative particle. To explore fidelity–cost trade-offs, approximate the continuous model with a low-order finite-volume scheme that uses three concentric spherical shells, recognizing that fewer shells reduce computational cost but also model fidelity.\n\nAssume the solid-phase diffusivity varies linearly with concentration,\n$$\nD_s(c_s) = D_0 + k_D\\, c_s,\n$$\nwhere $D_0$ and $k_D$ are constants. Let the particle radius be $R_p = 4\\,\\mu\\mathrm{m}$, i.e., $R_p = 4\\times 10^{-6}\\ \\mathrm{m}$. Partition the sphere into three shells of equal thickness $\\Delta r = R_p/3$ with face radii\n$$\nr_{1/2} = 0,\\quad r_{3/2} = \\frac{R_p}{3},\\quad r_{5/2} = \\frac{2R_p}{3},\\quad r_{7/2} = R_p,\n$$\nand define shell-average concentrations $c_1(t)$, $c_2(t)$, and $c_3(t)$ over volumes\n$$\nV_i = \\frac{4\\pi}{3}\\left(r_{i+1/2}^3 - r_{i-1/2}^3\\right),\\quad i=1,2,3,\n$$\nwith face areas\n$$\nA_{i+1/2} = 4\\pi r_{i+1/2}^2.\n$$\nConstruct a conservative finite-volume scheme with three shells to approximate $\\partial c_s/\\partial t$ and write the discrete update equations for the shell-average concentrations $c_i(t)$ in terms of interfacial fluxes $J_{i+1/2}$. Use the following principles:\n- The flux through an interior face $r_{i+1/2}$ is given by\n$$\nJ_{i+1/2} = -D_{i+1/2}\\frac{c_{i+1} - c_i}{\\Delta r},\n$$\nwhere $\\Delta r = R_p/3$, and $D_{i+1/2}$ is the face diffusivity computed by a harmonic average of adjacent shell diffusivities,\n$$\nD_{i+1/2} = \\left(\\frac{1}{2}\\left[\\frac{1}{D_i} + \\frac{1}{D_{i+1}}\\right]\\right)^{-1},\\quad D_i = D_0 + k_D\\, c_i.\n$$\n- The center face flux satisfies $J_{1/2} = 0$, and the surface face flux satisfies $J_{7/2} = j_{\\mathrm{surf}}(t)$.\n- The conservative update for each shell is\n$$\n\\frac{\\mathrm{d}c_i}{\\mathrm{d}t} = \\frac{A_{i-1/2}J_{i-1/2} - A_{i+1/2}J_{i+1/2}}{V_i},\\quad i=1,2,3.\n$$\n\nImplement the above scheme as a program that, for given parameters $\\{D_0,k_D,R_p\\}$ (with $R_p$ fixed at $4\\times 10^{-6}\\ \\mathrm{m}$), a specified surface flux $j_{\\mathrm{surf}}$ in $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$, and a shell-average concentration vector $\\mathbf{c} = [c_1,c_2,c_3]$ in $\\mathrm{mol}\\,\\mathrm{m}^{-3}$, computes the right-hand side $\\mathrm{d}\\mathbf{c}/\\mathrm{d}t$ in $\\mathrm{mol}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$ using the discrete equations. The program should produce the results for the following test suite:\n\n- Test case $1$ (happy path, uniform concentration, zero flux):\n  $D_0 = 1.0\\times 10^{-14}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k_D = 2.0\\times 10^{-19}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-1}\\,(\\mathrm{mol}\\,\\mathrm{m}^{-3})^{-1}$, $R_p = 4.0\\times 10^{-6}\\ \\mathrm{m}$, $\\mathbf{c} = [20000.0,20000.0,20000.0]\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $j_{\\mathrm{surf}} = 0.0\\ \\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\n\n- Test case $2$ (uniform concentration, outward flux at surface):\n  $D_0 = 1.0\\times 10^{-14}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k_D = 2.0\\times 10^{-19}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-1}\\,(\\mathrm{mol}\\,\\mathrm{m}^{-3})^{-1}$, $R_p = 4.0\\times 10^{-6}\\ \\mathrm{m}$, $\\mathbf{c} = [20000.0,20000.0,20000.0]\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $j_{\\mathrm{surf}} = 1.0\\times 10^{-6}\\ \\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\n\n- Test case $3$ (nonuniform concentration, inward flux, negative slope $k_D0$):\n  $D_0 = 1.5\\times 10^{-14}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k_D = -1.0\\times 10^{-19}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-1}\\,(\\mathrm{mol}\\,\\mathrm{m}^{-3})^{-1}$, $R_p = 4.0\\times 10^{-6}\\ \\mathrm{m}$, $\\mathbf{c} = [10000.0,20000.0,30000.0]\\ \\mathrm{mol}\\,\\mathrm{m}^{-3}$, $j_{\\mathrm{surf}} = -5.0\\times 10^{-7}\\ \\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\n\nExpress the outputs $\\mathrm{d}\\mathbf{c}/\\mathrm{d}t$ for each test case in $\\mathrm{mol}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$. Your program should produce a single line of output containing the three results as a comma-separated list of lists, each inner list ordered as $[\\,\\mathrm{d}c_1/\\mathrm{d}t,\\mathrm{d}c_2/\\mathrm{d}t,\\mathrm{d}c_3/\\mathrm{d}t\\,]$, enclosed in square brackets, for example, $[[x_1,x_2,x_3],[y_1,y_2,y_3],[z_1,z_2,z_3]]$.",
            "solution": "The problem requires the construction of a three-shell finite-volume model for solid-phase diffusion in a spherical particle and its implementation to compute the time derivatives of the shell-average concentrations. The physical process is governed by the conservation of species, expressed as a partial differential equation for the lithium concentration $c_s(r, t)$:\n$$\n\\frac{\\partial c_s}{\\partial t} = \\frac{1}{r^2}\\frac{\\partial}{\\partial r}\\left(r^2 D_s(c_s)\\frac{\\partial c_s}{\\partial r}\\right)\n$$\nTo approximate the solution, the spherical particle of radius $R_p$ is discretized into $N=3$ concentric shells of equal thickness $\\Delta r = R_p/3$. We define the shell-average concentrations as $c_1$, $c_2$, and $c_3$.\n\nThe finite-volume method is based on the integral form of the conservation law. For each shell $i$, the time rate of change of the total amount of substance in the shell (concentration $c_i$ times volume $V_i$) is equal to the net flux of substance across its boundaries. The boundaries of shell $i$ are spherical faces at radii $r_{i-1/2}$ and $r_{i+1/2}$, with corresponding surface areas $A_{i-1/2}$ and $A_{i+1/2}$. The conservation law for shell $i$ is:\n$$\nV_i \\frac{\\mathrm{d}c_i}{\\mathrmd t} = A_{i-1/2} J_{i-1/2} - A_{i+1/2} J_{i+1/2}\n$$\nwhere $J_{i \\pm 1/2}$ represents the molar flux at a face. This can be rearranged to solve for the time derivative:\n$$\n\\frac{\\mathrm{d}c_i}{\\mathrm{d}t} = \\frac{A_{i-1/2}J_{i-1/2} - A_{i+1/2}J_{i+1/2}}{V_i}\n$$\nThe geometric parameters are defined by the face radii $r_{1/2}=0$, $r_{3/2}=R_p/3$, $r_{5/2}=2R_p/3$, and $r_{7/2}=R_p$. The face areas are $A_{i+1/2} = 4\\pi r_{i+1/2}^2$ and shell volumes are $V_i = \\frac{4\\pi}{3}(r_{i+1/2}^3 - r_{i-1/2}^3)$.\n\nWriting the update equations for each of the $3$ shells:\nFor shell $1$ ($i=1$): The inner face is at the center ($r_{1/2}=0$), so its area $A_{1/2}=0$. The symmetry boundary condition implies the flux through the center is zero, $J_{1/2}=0$.\n$$\n\\frac{\\mathrm{d}c_1}{\\mathrm{d}t} = \\frac{A_{1/2}J_{1/2} - A_{3/2}J_{3/2}}{V_1} = \\frac{0 - A_{3/2}J_{3/2}}{V_1}\n$$\nFor shell $2$ ($i=2$):\n$$\n\\frac{\\mathrm{d}c_2}{\\mathrm{d}t} = \\frac{A_{3/2}J_{3/2} - A_{5/2}J_{5/2}}{V_2}\n$$\nFor shell $3$ ($i=3$): The outer face is the particle surface ($r_{7/2}=R_p$), where the flux is prescribed as $J_{7/2} = j_{\\mathrm{surf}}(t)$.\n$$\n\\frac{\\mathrm{d}c_3}{\\mathrm{d}t} = \\frac{A_{5/2}J_{5/2} - A_{7/2}J_{7/2}}{V_3}\n$$\nThe fluxes at the internal faces, $J_{3/2}$ and $J_{5/2}$, are determined by the concentration gradient between adjacent shells. The flux between shell $i$ and shell $i+1$ is approximated as:\n$$\nJ_{i+1/2} = -D_{i+1/2}\\frac{c_{i+1} - c_i}{\\Delta r}\n$$\nThe diffusivity $D_s$ is concentration-dependent, $D_s(c_s) = D_0 + k_D c_s$, and is evaluated for each shell as $D_i = D_0 + k_D c_i$. The diffusivity at the face between shells, $D_{i+1/2}$, is calculated using the harmonic mean of the adjacent shell diffusivities. This ensures flux continuity and numerical stability.\n$$\nD_{i+1/2} = \\left(\\frac{1}{2}\\left[\\frac{1}{D_i} + \\frac{1}{D_{i+1}}\\right]\\right)^{-1} = \\frac{2 D_i D_{i+1}}{D_i + D_{i+1}}\n$$\nThe overall algorithm to compute $\\mathrm{d}\\mathbf{c}/\\mathrm{d}t$ is a direct implementation of these equations:\n1.  Given the input parameters ($D_0, k_D$), state vector ($\\mathbf{c}=[c_1, c_2, c_3]$), and boundary condition ($j_{\\mathrm{surf}}$), with $R_p = 4\\times 10^{-6}\\ \\mathrm{m}$ fixed.\n2.  Calculate the constant geometric parameters: $\\Delta r$, $r_{i+1/2}$, $A_{i+1/2}$, and $V_i$ for $i=1,2,3$.\n3.  Compute the diffusivity for each shell: $D_1$, $D_2$, $D_3$.\n4.  Compute the harmonic mean diffusivities at the internal faces: $D_{3/2}$ and $D_{5/2}$.\n5.  Calculate the molar fluxes at the internal faces: $J_{3/2}$ and $J_{5/2}$.\n6.  Use the boundary conditions $J_{1/2}=0$ and $J_{7/2}=j_{\\mathrm{surf}}$.\n7.  Substitute the areas, volumes, and fluxes into the update equations to find $\\mathrm{d}c_1/\\mathrm{d}t$, $\\mathrm{d}c_2/\\mathrm{d}t$, and $\\mathrm{d}c_3/\\mathrm{d}t$.\n\nThis procedure is systematically applied to each test case in the provided Python program to obtain the required results.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n\n    # Particle radius is fixed for all test cases.\n    Rp = 4.0e-6  # m\n\n    test_cases = [\n        {\n            \"D0\": 1.0e-14, # m^2/s\n            \"kD\": 2.0e-19, # m^2/s / (mol/m^3)\n            \"c_vec\": np.array([20000.0, 20000.0, 20000.0]), # mol/m^3\n            \"j_surf\": 0.0, # mol/m^2/s\n        },\n        {\n            \"D0\": 1.0e-14,\n            \"kD\": 2.0e-19,\n            \"c_vec\": np.array([20000.0, 20000.0, 20000.0]),\n            \"j_surf\": 1.0e-6,\n        },\n        {\n            \"D0\": 1.5e-14,\n            \"kD\": -1.0e-19,\n            \"c_vec\": np.array([10000.0, 20000.0, 30000.0]),\n            \"j_surf\": -5.0e-7,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        dc_dt = calculate_dc_dt(Rp, case[\"D0\"], case[\"kD\"], case[\"c_vec\"], case[\"j_surf\"])\n        results.append(dc_dt.tolist())\n\n    # Format the output as a string representing a list of lists.\n    # e.g., [[r1_1,r1_2,r1_3],[r2_1,r2_2,r2_3]]\n    result_str = '[' + ','.join([f\"[{','.join(map(str, res))}]\" for res in results]) + ']'\n    print(result_str)\n\ndef calculate_dc_dt(Rp, D0, kD, c_vec, j_surf):\n    \"\"\"\n    Calculates the time derivative of shell-average concentrations dc/dt.\n\n    Args:\n        Rp (float): Particle radius in meters.\n        D0 (float): Baseline solid-phase diffusivity in m^2/s.\n        kD (float): Concentration-dependent diffusivity coefficient.\n        c_vec (np.ndarray): Vector of shell-average concentrations [c1, c2, c3] in mol/m^3.\n        j_surf (float): Prescribed flux at the particle surface in mol/m^2/s.\n\n    Returns:\n        np.ndarray: Vector of time derivatives [dc1/dt, dc2/dt, dc3/dt].\n    \"\"\"\n    # 1. Geometric parameters\n    num_shells = 3\n    dr = Rp / num_shells\n    \n    # Face radii: r_1/2, r_3/2, r_5/2, r_7/2\n    r_faces = np.linspace(0, Rp, num_shells + 1)\n    \n    # Face areas: A_1/2, A_3/2, A_5/2, A_7/2\n    A_faces = 4 * np.pi * r_faces**2\n    \n    # Shell volumes: V_1, V_2, V_3\n    V_shells = (4 * np.pi / 3) * (r_faces[1:]**3 - r_faces[:-1]**3)\n\n    # 2. Shell diffusivities\n    D_shells = D0 + kD * c_vec\n\n    # 3. Face diffusivities (Harmonic mean)\n    # D_3/2 (interface between shell 1 and 2)\n    D_3_2 = (2 * D_shells[0] * D_shells[1]) / (D_shells[0] + D_shells[1]) if (D_shells[0] + D_shells[1]) != 0 else 0\n    \n    # D_5/2 (interface between shell 2 and 3)\n    D_5_2 = (2 * D_shells[1] * D_shells[2]) / (D_shells[1] + D_shells[2]) if (D_shells[1] + D_shells[2]) != 0 else 0\n\n    # 4. Interfacial fluxes\n    J_fluxes = np.zeros(num_shells + 1)\n    \n    # J_1/2 = 0 (center, symmetry)\n    J_fluxes[0] = 0.0\n    \n    # J_3/2 (interface between shell 1 and 2)\n    J_fluxes[1] = -D_3_2 * (c_vec[1] - c_vec[0]) / dr\n    \n    # J_5/2 (interface between shell 2 and 3)\n    J_fluxes[2] = -D_5_2 * (c_vec[2] - c_vec[1]) / dr\n    \n    # J_7/2 (surface)\n    J_fluxes[3] = j_surf\n\n    # 5. Calculate dc/dt for each shell\n    dc_dt = np.zeros(num_shells)\n    for i in range(num_shells):\n        # The update rule is (Area_in * Flux_in - Area_out * Flux_out) / Volume\n        # For shell i, input face is i, output face is i+1\n        dc_dt[i] = (A_faces[i] * J_fluxes[i] - A_faces[i+1] * J_fluxes[i+1]) / V_shells[i]\n\n    return dc_dt\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}