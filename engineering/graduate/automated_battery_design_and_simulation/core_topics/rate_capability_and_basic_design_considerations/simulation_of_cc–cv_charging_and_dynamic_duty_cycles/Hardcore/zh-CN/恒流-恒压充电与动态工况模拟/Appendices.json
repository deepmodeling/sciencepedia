{
    "hands_on_practices": [
        {
            "introduction": "可靠仿真的基石是验证。第一个实践将指导您从头开始构建一个充电仿真器，并实现一个基于热力学第一定律的强大验证技术：能量守恒。通过追踪输入能量、存储能量和耗散的热量，您将验证您的仿真在物理上是否一致，并量化数值误差，这是任何仿真工程师都必须掌握的关键技能 。",
            "id": "3949106",
            "problem": "您的任务是实现并验证一个单体电化学电池在动态占空比下进行恒流-恒压（CC-CV）充电的数值模拟。验证必须基于能量守恒检验，即比较时间积分的电输入能量与化学储存能及欧姆损耗之和。您的实现必须是自包含的，并能为指定的测试套件生成结果。\n\n假设使用以下理想化但科学上一致的模型：\n\n- 端电压 $\\;V(t)\\;$ 满足分解式\n$$\nV(t) \\;=\\; U(z(t)) \\;+\\; I(t)\\,R,\n$$\n其中 $\\;U(z)\\;$ 是开路电压（OCV），作为荷电状态 $\\;z\\in[0,1]\\;$ 的函数，$\\;I(t)\\;$ 是施加的充电电流（充电时为正），$\\;R0\\;$ 是一个集总内阻。\n\n- 化学储存能根据以下公式增加\n$$\nE_{\\text{stored}} \\;=\\; \\int U(z)\\,\\mathrm{d}Q \\;=\\; \\int U\\big(z(t)\\big)\\,I(t)\\,\\mathrm{d}t,\n$$\n其中 $\\;Q(t)=\\int_0^t I(\\tau)\\,\\mathrm{d}\\tau\\;$ 是电荷（单位：库仑）。荷电状态按以下方式演化\n$$\nz(t) \\;=\\; z(0) \\;+\\; \\frac{Q(t)}{Q_{\\text{nom}}},\n$$\n其中额定容量 $\\;Q_{\\text{nom}}0\\;$（单位：库仑）。\n\n- 由内阻引起的欧姆损耗遵循\n$$\nE_{\\text{loss}} \\;=\\; \\int I^2(t)\\,R\\,\\mathrm{d}t.\n$$\n\n- 电输入能量满足\n$$\nE_{\\text{input}} \\;=\\; \\int V(t)\\,I(t)\\,\\mathrm{d}t.\n$$\n\n在这些假设和精确算术下，恒等式\n$$\nE_{\\text{input}} \\;=\\; E_{\\text{stored}} \\;+\\; E_{\\text{loss}}\n$$\n应当成立。在任何有限精度数值模拟中，都会存在一个残差\n$$\n\\Delta E \\;=\\; E_{\\text{input}} \\;-\\; E_{\\text{stored}} \\;-\\; E_{\\text{loss}},\n$$\n和相对残差\n$$\n\\delta \\;=\\; \\frac{\\lvert \\Delta E \\rvert}{\\max\\big(E_{\\text{input}},\\varepsilon\\big)},\n$$\n其中 $\\;\\varepsilon  0\\;$ 是一个小的下限值，以避免除以零。\n\n充电控制协议：\n\n- 恒流（CC）：在脉冲宽度调制（PWM）周期 $\\;T_{\\text{pwm}}0\\;$ 内，施加一个占空比为 $\\;d(t)\\in[0,1]\\;$ 的方波电流。瞬时恒流电流为\n$$\nI(t) \\;=\\; \\begin{cases}\nI_{\\text{CC}},  \\text{若 } (t \\bmod T_{\\text{pwm}})  d(t)\\,T_{\\text{pwm}},\\\\\n0,  \\text{其他情况},\n\\end{cases}\n$$\n其中 $\\;I_{\\text{CC}}0\\;$ 是一个指定的常数。\n\n- 转换到恒压（CV）：当瞬时脉冲开启电压将达到或超过电压限制 $\\;V_{\\text{CV}}\\;$ 时，进入CV模式，即\n$$\nU\\big(z(t)\\big) \\;+\\; I_{\\text{CC}}\\,R \\;\\ge\\; V_{\\text{CV}}.\n$$\n\n- 恒压（CV）：通过选择以下电流，将端电压保持在 $\\;V_{\\text{CV}}\\;$\n$$\nI(t) \\;=\\; \\min\\!\\Big(I_{\\text{CC}},\\;\\max\\!\\big(0,\\;\\frac{V_{\\text{CV}} - U\\big(z(t)\\big)}{R}\\big)\\Big).\n$$\n这确保电流非负，且不超过 $\\;I_{\\text{CC}}\\;$。\n\n开路电压模型：\n\n- 使用二次OCV函数\n$$\nU(z) \\;=\\; a_0 \\;+\\; a_1\\,z \\;+\\; a_2\\,z^2,\n$$\n其系数的选择应使 $\\;U(z)\\;$ 在 $\\;z\\in[0,1]\\;$ 的范围内处于锂离子电池的物理合理范围（约 $\\;[3.0,4.2]\\;$ $\\mathrm{V}$）。\n\n数值方法：\n\n- 使用均匀步长 $\\;\\Delta t  0\\;$ 的显式时间步进法。\n- 通过 $\\;z \\leftarrow z + \\dfrac{I\\,\\Delta t}{Q_{\\text{nom}}}\\;$ 更新 $\\;z\\;$，如果超过 $\\;1\\;$，则将其限制在 $\\;[0,1]\\;$ 区间内。\n- 使用黎曼和累加能量 $\\;E_{\\text{input}}, E_{\\text{stored}}, E_{\\text{loss}}\\;$：\n$$\nE_{\\text{input}} \\leftarrow E_{\\text{input}} + V\\,I\\,\\Delta t,\\quad\nE_{\\text{stored}} \\leftarrow E_{\\text{stored}} + U(z)\\,I\\,\\Delta t,\\quad\nE_{\\text{loss}} \\leftarrow E_{\\text{loss}} + I^2\\,R\\,\\Delta t.\n$$\n\n终止条件：\n\n- 当 $\\;t \\ge t_{\\max}\\;$ 或 $\\;z \\ge 1\\;$ 时停止。\n\n验证指标：\n\n- 计算 $\\;\\Delta E\\;$（单位 $\\;\\mathrm{J}\\;$）和如上定义的 $\\;\\delta\\;$。\n- 使用容差 $\\;\\tau = 10^{-9}\\;$；如果 $\\;\\delta \\le \\tau\\;$，则声明为通过。\n\n单位：\n\n- 电压单位为 $\\;\\mathrm{V}\\;$，电流为 $\\;\\mathrm{A}\\;$，电阻为 $\\;\\Omega\\;$，时间为 $\\;\\mathrm{s}\\;$，电荷为 $\\;\\mathrm{C}\\;$，容量单位为 $\\;\\mathrm{Ah}\\;$（内部通过乘以 $\\;3600\\;$ 转换为库仑），能量为 $\\;\\mathrm{J}\\;$。\n\n测试套件：\n\n为以下参数集实现模拟。对每种情况，报告残余能量 $\\;\\Delta E\\;$（单位 $\\;\\mathrm{J}\\;$）和相对残差 $\\;\\delta\\;$（以小数形式），以及通过布尔值 $\\;(\\delta \\le \\tau)\\;$。\n\n- 情况 $1$（理想路径）：\n    - $\\;Q_{\\text{nom}} = 3.0\\;$ $\\mathrm{Ah}$，$\\;R = 0.08\\;$ $\\Omega$，$\\;I_{\\text{CC}} = 2.0\\;$ $\\mathrm{A}$，$\\;V_{\\text{CV}} = 4.20\\;$ $\\mathrm{V}$，\n    - $\\;a_0 = 3.00\\;$，$\\;a_1 = 1.25\\;$，$\\;a_2 = -0.05\\;$，\n    - $\\;z(0) = 0.20\\;$，$\\;\\Delta t = 0.05\\;$ $\\mathrm{s}$，$\\;t_{\\max} = 5400\\;$ $\\mathrm{s}$，\n    - PWM：$\\;T_{\\text{pwm}} = 2.0\\;$ $\\mathrm{s}$，占空比斜坡调度 $\\;d(t) = \\min\\!\\big(0.3 + 0.6\\,t/T_{\\text{ramp}},\\,0.9\\big)\\;$，其中 $\\;T_{\\text{ramp}} = 1800\\;$ $\\mathrm{s}$。\n\n- 情况 $2$（由于高电阻和高初始 $\\;z\\;$ 导致提早进入CV模式）：\n    - $\\;Q_{\\text{nom}} = 2.0\\;$ $\\mathrm{Ah}$，$\\;R = 0.20\\;$ $\\Omega$，$\\;I_{\\text{CC}} = 3.0\\;$ $\\mathrm{A}$，$\\;V_{\\text{CV}} = 4.10\\;$ $\\mathrm{V}$，\n    - $\\;a_0 = 3.20\\;$，$\\;a_1 = 1.00\\;$，$\\;a_2 = -0.05\\;$，\n    - $\\;z(0) = 0.85\\;$，$\\;\\Delta t = 0.02\\;$ $\\mathrm{s}$，$\\;t_{\\max} = 3600\\;$ $\\mathrm{s}$，\n    - PWM：$\\;T_{\\text{pwm}} = 1.0\\;$ $\\mathrm{s}$，占空比斜坡调度 $\\;d(t) = \\min\\!\\big(0.4 + 0.4\\,t/T_{\\text{ramp}},\\,0.8\\big)\\;$，其中 $\\;T_{\\text{ramp}} = 600\\;$ $\\mathrm{s}$。\n\n- 情况 $3$（采用正弦占空比调制的低电流）：\n    - $\\;Q_{\\text{nom}} = 5.0\\;$ $\\mathrm{Ah}$，$\\;R = 0.03\\;$ $\\Omega$，$\\;I_{\\text{CC}} = 0.5\\;$ $\\mathrm{A}$，$\\;V_{\\text{CV}} = 4.15\\;$ $\\mathrm{V}$，\n    - $\\;a_0 = 3.00\\;$，$\\;a_1 = 1.35\\;$，$\\;a_2 = -0.20\\;$，\n    - $\\;z(0) = 0.10\\;$，$\\;\\Delta t = 0.05\\;$ $\\mathrm{s}$，$\\;t_{\\max} = 7200\\;$ $\\mathrm{s}$，\n    - PWM：$\\;T_{\\text{pwm}} = 0.5\\;$ $\\mathrm{s}$，占空比调度 $\\;d(t) = \\mathrm{clip}\\!\\big(0.5 + 0.4\\sin(2\\pi t/T_{\\text{mod}}),\\,0,\\,1\\big)\\;$，其中 $\\;T_{\\text{mod}} = 2000\\;$ $\\mathrm{s}$。\n\n要求的最终输出格式：\n\n- 您的程序应生成单行输出，其中包含结果，形式为逗号分隔的内部列表，每个内部列表的格式为 $\\;[\\Delta E,\\delta,\\text{pass}]\\;$，并用方括号括起。例如：\n$$\n\\big[\\,[\\Delta E_1,\\delta_1,\\text{True}],\\,[\\Delta E_2,\\delta_2,\\text{False}],\\,\\ldots\\,\\big].\n$$\n所有能量单位必须是 $\\;\\mathrm{J}\\;$，所有相对残差必须是小数（无百分号）。",
            "solution": "目标是使用电路分解和电荷计量的第一性原理，来验证在具有动态占空比的恒流-恒压（CC-CV）充电数值模拟中的能量守恒。\n\n基本关系：\n\n1. 电功率为 $\\;P(t) = V(t)\\,I(t)\\;$，能量是其时间积分：\n$$\nE_{\\text{input}} \\;=\\; \\int_0^{T} V(t)\\,I(t)\\,\\mathrm{d}t.\n$$\n\n2. 对于一个具有内阻 $\\;R\\;$ 和开路电压 $\\;U(z)\\;$ 的简单集总模型，端电压分解为\n$$\nV(t) \\;=\\; U\\big(z(t)\\big) \\;+\\; I(t)\\,R.\n$$\n\n3. 化学储存能根据克服电化学势所做的功而增加：\n$$\nE_{\\text{stored}} \\;=\\; \\int U(z)\\,\\mathrm{d}Q \\;=\\; \\int U\\big(z(t)\\big)\\,I(t)\\,\\mathrm{d}t.\n$$\n\n4. 耗散欧姆损耗为\n$$\nE_{\\text{loss}} \\;=\\; \\int I^2(t)\\,R\\,\\mathrm{d}t.\n$$\n\n结合这些关系，并将 $\\;V(t) = U(z(t)) + I(t)R\\;$ 代入 $\\;E_{\\text{input}}\\;$ 得到\n$$\nE_{\\text{input}} \\;=\\; \\int \\big(U(z(t)) + I(t)R\\big)\\,I(t)\\,\\mathrm{d}t\n\\;=\\; \\int U(z(t))\\,I(t)\\,\\mathrm{d}t \\;+\\; \\int I^2(t)\\,R\\,\\mathrm{d}t\n\\;=\\; E_{\\text{stored}} \\;+\\; E_{\\text{loss}}.\n$$\n因此，在精确算术中，残差\n$$\n\\Delta E \\;=\\; E_{\\text{input}} - E_{\\text{stored}} - E_{\\text{loss}}\n$$\n恒为 $\\;0\\;$。\n\n在数值模拟中，我们使用步长为 $\\;\\Delta t\\;$ 的离散时间步进，并计算黎曼和：\n$$\nE_{\\text{input}} \\approx \\sum_{n} V_n\\,I_n\\,\\Delta t,\\quad\nE_{\\text{stored}} \\approx \\sum_{n} U(z_n)\\,I_n\\,\\Delta t,\\quad\nE_{\\text{loss}} \\approx \\sum_{n} I_n^2\\,R\\,\\Delta t.\n$$\n我们通过以下方式更新荷电状态：\n$$\nz_{n+1} \\;=\\; z_n \\;+\\; \\frac{I_n\\,\\Delta t}{Q_{\\text{nom}}},\n$$\n其中 $\\;Q_{\\text{nom}}\\;$ 的单位是库仑。当 $\\;V_n = U(z_n) + I_n R\\;$ 时，该恒等式在步进上仍然成立，但有限精度和离散近似会引入微小差异。相对残差定义为\n$$\n\\delta \\;=\\; \\frac{\\lvert \\Delta E \\rvert}{\\max\\!\\big(E_{\\text{input}},\\varepsilon\\big)},\n$$\n其中 $\\;\\varepsilon\\;$ 是一个很小的值，以防止除以零。我们为验证选择一个严格的容差 $\\;\\tau = 10^{-9}\\;$，这对于双精度和在所述时间范围内的良态求和是合适的。\n\n充电控制算法：\n\n- 在恒流（CC）模式下，我们施加占空比为 $\\;d(t)\\;$、周期为 $\\;T_{\\text{pwm}}\\;$ 的PWM。瞬时电流为\n$$\nI_n \\;=\\; \\begin{cases}\nI_{\\text{CC}},  \\text{若 } (t_n \\bmod T_{\\text{pwm}})  d(t_n)\\,T_{\\text{pwm}},\\\\\n0,  \\text{其他情况}.\n\\end{cases}\n$$\n当脉冲开启时的端电压将达到或超过电压限制时，触发CC到CV的转换：\n$$\nU(z_n) \\;+\\; I_{\\text{CC}}\\,R \\;\\ge\\; V_{\\text{CV}}.\n$$\n\n- 在恒压（CV）模式下，我们计算电流以维持 $\\;V_{\\text{CV}}\\;$：\n$$\nI_n \\;=\\; \\min\\!\\Big(I_{\\text{CC}},\\;\\max\\!\\big(0,\\;\\frac{V_{\\text{CV}} - U(z_n)}{R}\\big)\\Big),\n$$\n这强制电流非负且上限为 $\\;I_{\\text{CC}}\\;$。\n\n在每一步，我们根据二次模型计算 $\\;U(z_n)\\;$\n$$\nU(z) \\;=\\; a_0 \\;+\\; a_1\\,z \\;+\\; a_2\\,z^2,\n$$\n并设置\n$$\nV_n \\;=\\; U(z_n) \\;+\\; I_n\\,R,\n$$\n这样，当电流由CV规则确定时，CV模式意味着 $\\;V_n = V_{\\text{CV}}\\;$。能量通过求和来累加。当 $\\;t \\ge t_{\\max}\\;$ 或 $\\;z \\ge 1\\;$ 时，模拟停止。\n\n数值考量和残差可接受性：\n\n- 在一致使用 $\\;V_n = U(z_n) + I_n R\\;$ 的情况下，离散恒等式在代数上是匹配的，残差主要反映了浮点舍入误差和累积的求和误差。\n- 在数千到数十万个步长上，绝对残差可能不为零，但对于良好缩放的量，相对残差 $\\;\\delta\\;$ 应保持在机器精度附近。在指定条件下，容差 $\\;\\tau = 10^{-9}\\;$ 对于研究生水平的高级仿真验证是合适的。\n\n测试套件的实现细节：\n\n- 每种情况都以 $\\;\\mathrm{Ah}\\;$ 为单位指定 $\\;Q_{\\text{nom}}\\;$；通过乘以 $\\;3600\\;$ 将其转换为库仑。\n- 占空比调度：\n  - 斜坡：$\\;d(t) = \\min\\!\\big(d_0 + (d_1 - d_0)\\,t/T_{\\text{ramp}},\\,d_1\\big)\\;$。\n  - 正弦：$\\;d(t) = \\mathrm{clip}\\!\\big(d_0 + A\\sin(2\\pi t/T_{\\text{mod}}),\\,0,\\,1\\big)\\;$。\n\n输出规格：\n\n- 对每种情况，返回三元组 $\\;[\\Delta E,\\delta,\\text{pass}]\\;$，其中 $\\;\\Delta E\\;$ 的单位是 $\\;\\mathrm{J}\\;$，$\\;\\delta\\;$ 是一个小数，$\\;\\text{pass}\\;$ 是一个表示 $\\;\\delta \\le \\tau\\;$ 是否成立的布尔值。\n- 打印包含所有情况的三元组列表的单行，格式为用方括号括起来的逗号分隔列表，例如：\n$$\n\\big[\\,[\\Delta E_1,\\delta_1,\\text{True}],\\,[\\Delta E_2,\\delta_2,\\text{True}],\\,[\\Delta E_3,\\delta_3,\\text{True}]\\,\\big].\n$$",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef make_duty_function(kind: str, params: dict):\n    \"\"\"\n    Returns a callable d(t) in [0,1] for the specified schedule.\n    kind: 'ramp' or 'sin'\n    params: dictionary with keys depending on kind.\n    \"\"\"\n    if kind == 'ramp':\n        d0 = float(params.get('d0', 0.0))\n        d1 = float(params.get('d1', 1.0))\n        T_ramp = float(params.get('T_ramp', 1.0))\n        def d(t):\n            val = d0 + (d1 - d0) * (t / T_ramp)\n            if val > d1:\n                val = d1\n            if val  0.0:\n                val = 0.0\n            if val > 1.0:\n                val = 1.0\n            return val\n        return d\n    elif kind == 'sin':\n        d0 = float(params.get('d0', 0.5))\n        A = float(params.get('A', 0.0))\n        T_mod = float(params.get('T_mod', 1.0))\n        two_pi_over_T = 2.0 * np.pi / T_mod\n        def d(t):\n            val = d0 + A * np.sin(two_pi_over_T * t)\n            # clip to [0,1]\n            if val  0.0:\n                val = 0.0\n            if val > 1.0:\n                val = 1.0\n            return val\n        return d\n    else:\n        # default: constant 1.0\n        return lambda t: 1.0\n\ndef simulate_case(case):\n    \"\"\"\n    Simulate CC-CV charging with dynamic duty cycles for a single case.\n    Returns (DeltaE, rel_residual, pass_bool).\n    \"\"\"\n    # Unpack parameters\n    Q_nom_Ah = case['Q_nom_Ah']\n    R = case['R_ohm']\n    I_cc = case['I_cc_A']\n    V_cv = case['V_cv_V']\n    a0, a1, a2 = case['ocv_coeffs']  # quadratic coefficients\n    z0 = case['z0']\n    dt = case['dt_s']\n    t_max = case['t_max_s']\n    T_pwm = case['T_pwm_s']\n    duty_kind = case['duty']['kind']\n    duty_params = case['duty']['params']\n    duty_func = make_duty_function(duty_kind, duty_params)\n\n    # Capacity conversion: Ah to Coulombs\n    Q_nom = Q_nom_Ah * 3600.0\n\n    # Initialize state\n    t = 0.0\n    z = float(z0)\n    in_cv = False\n\n    # Energy accumulators\n    E_input = 0.0\n    E_stored = 0.0\n    E_loss = 0.0\n\n    # Small floor for relative residual\n    eps = 1e-12\n    tau = 1e-9  # validation tolerance\n\n    # Simulation loop\n    # To avoid extremely long runtimes, cap the number of steps by t_max/dt\n    max_steps = int(np.ceil(t_max / dt))\n    for _ in range(max_steps):\n        # Compute OCV at current SOC\n        U = a0 + a1 * z + a2 * z * z\n\n        # Determine current based on mode\n        if not in_cv:\n            # CC PWM current\n            duty = duty_func(t)\n            # Determine if current is ON within PWM cycle\n            on = (t % T_pwm)  (duty * T_pwm)\n            I = I_cc if on else 0.0\n\n            # Check transition condition to CV:\n            # If the on-pulse terminal voltage would exceed V_cv, enter CV.\n            if U + I_cc * R >= V_cv:\n                in_cv = True\n                # Compute CV current immediately for this step\n                I = (V_cv - U) / R\n                # Enforce limits: nonnegative and bounded by I_cc\n                if I  0.0:\n                    I = 0.0\n                if I > I_cc:\n                    I = I_cc\n        else:\n            # CV mode\n            I = (V_cv - U) / R\n            if I  0.0:\n                I = 0.0\n            if I > I_cc:\n                I = I_cc\n\n        # Terminal voltage from decomposition\n        V = U + I * R\n\n        # Accumulate energies\n        dE_input = V * I * dt\n        dE_stored = U * I * dt\n        dE_loss = (I * I) * R * dt\n\n        E_input += dE_input\n        E_stored += dE_stored\n        E_loss += dE_loss\n\n        # Update SOC\n        z += (I * dt) / Q_nom\n        if z > 1.0:\n            z = 1.0\n\n        # Advance time\n        t += dt\n\n        # Termination conditions\n        if t >= t_max or z >= 1.0:\n            break\n\n    # Compute residuals\n    DeltaE = E_input - E_stored - E_loss\n    rel = abs(DeltaE) / (E_input if E_input > eps else eps)\n    passed = rel = tau\n\n    return DeltaE, rel, passed\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"Q_nom_Ah\": 3.0,\n            \"R_ohm\": 0.08,\n            \"I_cc_A\": 2.0,\n            \"V_cv_V\": 4.20,\n            \"ocv_coeffs\": (3.00, 1.25, -0.05),\n            \"z0\": 0.20,\n            \"dt_s\": 0.05,\n            \"t_max_s\": 5400.0,\n            \"T_pwm_s\": 2.0,\n            \"duty\": {\"kind\": \"ramp\", \"params\": {\"d0\": 0.3, \"d1\": 0.9, \"T_ramp\": 1800.0}},\n        },\n        {\n            \"Q_nom_Ah\": 2.0,\n            \"R_ohm\": 0.20,\n            \"I_cc_A\": 3.0,\n            \"V_cv_V\": 4.10,\n            \"ocv_coeffs\": (3.20, 1.00, -0.05),\n            \"z0\": 0.85,\n            \"dt_s\": 0.02,\n            \"t_max_s\": 3600.0,\n            \"T_pwm_s\": 1.0,\n            \"duty\": {\"kind\": \"ramp\", \"params\": {\"d0\": 0.4, \"d1\": 0.8, \"T_ramp\": 600.0}},\n        },\n        {\n            \"Q_nom_Ah\": 5.0,\n            \"R_ohm\": 0.03,\n            \"I_cc_A\": 0.5,\n            \"V_cv_V\": 4.15,\n            \"ocv_coeffs\": (3.00, 1.35, -0.20),\n            \"z0\": 0.10,\n            \"dt_s\": 0.05,\n            \"t_max_s\": 7200.0,\n            \"T_pwm_s\": 0.5,\n            \"duty\": {\"kind\": \"sin\", \"params\": {\"d0\": 0.5, \"A\": 0.4, \"T_mod\": 2000.0}},\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        DeltaE, rel, passed = simulate_case(case)\n        # Format per required output: [DeltaE,delta,pass]\n        results.append((DeltaE, rel, passed))\n\n    # Final print statement in the exact required format: a single line\n    # containing the list of inner lists [DeltaE,delta,pass] for each case.\n    # Ensure no extra spaces for strictness.\n    inner = []\n    for (de, r, p) in results:\n        # Use repr for booleans and floats to keep consistency\n        inner.append(f\"[{de},{r},{p}]\")\n    print(f\"[{','.join(inner)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在我们基础模型的之上，我们现在引入一个戴维南等效电路来包含瞬态电压动态，这能更精确地表示电池的响应。本实践专注于恒流-恒压（CC-CV）协议中的一个关键时刻：从恒定电流到恒定电压的精确转换点。您将学习如何将此转换表述为一个数学求根问题并进行数值求解，这是分析混合动力系统中常见的任务 。",
            "id": "3949059",
            "problem": "给定一个可充电电化学电池的基于物理的充电模型，该模型由一个带有电阻-电容（RC）极化支路的戴维南等效电路描述。恒流-恒压（CC-CV）充电协议在端电压达到指定的最高值时，从恒流模式切换到恒压模式。任务是通过求解一个从戴维南模型和RC动力学第一性原理推导出的非线性条件，来确定精确的切换时间。\n\n假设如下：\n- 开路电压 $U(z)$ 取决于荷电状态（SOC）$z$，并被建模为一个带有系数 $(a_0,a_1,a_2,a_3)$ 的三次多项式：\n$$\nU(z) = a_0 + a_1 z + a_2 z^2 + a_3 z^3.\n$$\n- 在恒定充电电流 $I_{\\text{CC}}$ 下，SOC的演变过程为\n$$\n\\frac{dz}{dt} = \\frac{I_{\\text{CC}}}{C}, \\quad z(t) = z_0 + \\frac{I_{\\text{CC}}}{C} t,\n$$\n其中 $C$ 是电池容量（单位：库仑），$z_0$ 是初始SOC（无量纲）。\n- 恒流（CC）阶段的端电压为\n$$\nV_{\\text{term}}(t) = U\\big(z(t)\\big) + I_{\\text{CC}} R_0 + V_1(t),\n$$\n其中 $R_0$ 是欧姆内阻（单位：欧姆），$V_1(t)$ 是由RC支路贡献的极化电压。\n- RC支路的极化电压 $V_1(t)$ 服从由电流输入 $I_{\\text{CC}}$ 驱动的一阶线性微分方程：\n$$\n\\frac{dV_1}{dt} = -\\frac{1}{R_1 C_1} V_1 + \\frac{I_{\\text{CC}}}{C_1},\n$$\n初始条件为 $V_1(0) = V_{1,0}$，其中 $R_1$ 是极化电阻（单位：欧姆），$C_1$ 是极化电容（单位：法拉）。\n\nCC-CV切换时间 $t^\\star$ 定义为满足以下条件的最小 $t \\ge 0$：\n$$\nU\\big(z(t)\\big) + I_{\\text{CC}} R_0 + V_1(t) = V_{\\max},\n$$\n其中 $V_{\\max}$ 是恒压目标值（单位：伏特）。在物理上，只有当 $z(t) \\le 1$ 时充电才有意义，因此 $t$ 必须位于区间 $[0, t_{\\text{stop}}]$ 内，其中\n$$\nt_{\\text{stop}} = \\frac{(1 - z_0) C}{I_{\\text{CC}}}.\n$$\n如果 $V_{\\text{term}}(0) \\ge V_{\\max}$，则 $t^\\star = 0$。如果在所有的 $t \\in [0, t_{\\text{stop}}]$ 内都有 $V_{\\text{term}}(t)  V_{\\max}$，则在给定参数下无法达到CC-CV转换点；在这种情况下，返回 $-1.0$。\n\n请推导并实现一个算法，根据给定的参数集计算 $t^\\star$。将最终的切换时间以秒为单位表示，为一个四舍五入到 $10^{-6}$ 秒的浮点数。\n\n测试套件：\n使用以下四个测试用例。在所有情况下，开路电压系数为 $(a_0,a_1,a_2,a_3) = (3.0, 1.0, -0.2, 0.4)$，单位为伏特。\n\n- 测试用例 1（一般情况）：\n  - $C = 10800$ 库仑\n  - $z_0 = 0.2$\n  - $R_0 = 0.05$ 欧姆\n  - $R_1 = 0.02$ 欧姆\n  - $C_1 = 5000$ 法拉\n  - $I_{\\text{CC}} = 3.0$ 安培\n  - $V_{\\max} = 4.2$ 伏特\n  - $V_{1,0} = 0.0$ 伏特\n\n- 测试用例 2（由于高初始极化和SOC导致的立即切换）：\n  - $C = 10800$ 库仑\n  - $z_0 = 0.95$\n  - $R_0 = 0.05$ 欧姆\n  - $R_1 = 0.02$ 欧姆\n  - $C_1 = 5000$ 法拉\n  - $I_{\\text{CC}} = 3.0$ 安培\n  - $V_{\\max} = 4.2$ 伏特\n  - $V_{1,0} = 0.4$ 伏特\n\n- 测试用例 3（在SOC范围内无法达到CV目标）：\n  - $C = 10800$ 库仑\n  - $z_0 = 0.2$\n  - $R_0 = 0.05$ 欧姆\n  - $R_1 = 0.02$ 欧姆\n  - $C_1 = 5000$ 法拉\n  - $I_{\\text{CC}} = 3.0$ 安培\n  - $V_{\\max} = 4.5$ 伏特\n  - $V_{1,0} = 0.0$ 伏特\n\n- 测试用例 4（带有负初始极化的动态瞬态）：\n  - $C = 7200$ 库仑\n  - $z_0 = 0.1$\n  - $R_0 = 0.03$ 欧姆\n  - $R_1 = 0.015$ 欧姆\n  - $C_1 = 3000$ 法拉\n  - $I_{\\text{CC}} = 2.5$ 安培\n  - $V_{\\max} = 4.1$ 伏特\n  - $V_{1,0} = -0.1$ 伏特\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3,result4]\"）。每个结果必须是秒为单位的浮点数，四舍五入到 $10^{-6}$，并遵循上述关于立即切换和无法达到情况的规则。",
            "solution": "用户提供的问题是有效的。它在科学上基于标准的电化学电池建模，在数学上是适定的，并且所有必要的参数和条件都已提供。正在着手解决。\n\n该问题要求找出在可充电电池的CC-CV充电协议中，从恒流（CC）阶段切换到恒压（CV）阶段的切换时间 $t^\\star$。该电池由一个带有一个RC支路的戴维南等效电路建模。切换时间 $t^\\star$ 被定义为端电压 $V_{\\text{term}}(t)$ 达到预定最大电压 $V_{\\max}$ 的最小时间 $t \\ge 0$。\n\n在CC阶段的端电压由下式给出：\n$$\nV_{\\text{term}}(t) = U\\big(z(t)\\big) + I_{\\text{CC}} R_0 + V_1(t)\n$$\n其中 $U(z)$ 是依赖于荷电状态（SOC）$z$ 的开路电压（OCV），$I_{\\text{CC}}$ 是恒定充电电流，$R_0$ 是欧姆内阻，$V_1(t)$ 是RC支路上的极化电压。\n\n该方程的各组成部分必须表示为时间 $t$ 的显式函数。\n\n首先，荷电状态 $z(t)$ 在恒定电流 $I_{\\text{CC}}$ 下从初始SOC $z_0$ 开始随时间线性演变：\n$$\nz(t) = z_0 + \\frac{I_{\\text{CC}}}{C} t\n$$\n其中 $C$ 是电池的总容量，单位为库仑。\n\n其次，开路电压 $U(z)$ 是 $z$ 的三次多项式：\n$$\nU(z) = a_0 + a_1 z + a_2 z^2 + a_3 z^3\n$$\n代入 $z(t)$ 的表达式，我们得到随时间变化的OCV，$U(t)$:\n$$\nU(t) = a_0 + a_1 \\left(z_0 + \\frac{I_{\\text{CC}}}{C} t\\right) + a_2 \\left(z_0 + \\frac{I_{\\text{CC}}}{C} t\\right)^2 + a_3 \\left(z_0 + \\frac{I_{\\text{CC}}}{C} t\\right)^3\n$$\n\n第三，极化电压 $V_1(t)$ 由一阶线性常微分方程控制：\n$$\n\\frac{dV_1}{dt} = -\\frac{1}{R_1 C_1} V_1 + \\frac{I_{\\text{CC}}}{C_1}\n$$\n初始条件为 $V_1(0) = V_{1,0}$。设RC支路的时间常数为 $\\tau_1 = R_1 C_1$。方程变为：\n$$\n\\frac{dV_1}{dt} + \\frac{1}{\\tau_1} V_1 = \\frac{I_{\\text{CC}}}{C_1}\n$$\n这是一个标准的一阶线性常微分方程，其解是齐次解和特解之和。通解为：\n$$\nV_1(t) = I_{\\text{CC}} R_1 + K e^{-t/\\tau_1}\n$$\n其中 $I_{\\text{CC}} R_1$ 是稳态电压，$K$ 是由初始条件决定的常数。在 $t=0$ 时：\n$$\nV_1(0) = V_{1,0} = I_{\\text{CC}} R_1 + K \\implies K = V_{1,0} - I_{\\text{CC}} R_1\n$$\n因此，极化电压的显式解为：\n$$\nV_1(t) = I_{\\text{CC}} R_1 + (V_{1,0} - I_{\\text{CC}} R_1) e^{-t/(R_1 C_1)}\n$$\n\n综合所有部分，我们得到端电压 $V_{\\text{term}}(t)$ 的完整表达式：\n$$\nV_{\\text{term}}(t) = \\left( a_0 + a_1 z(t) + a_2 z(t)^2 + a_3 z(t)^3 \\right) + I_{\\text{CC}} R_0 + I_{\\text{CC}} R_1 + (V_{1,0} - I_{\\text{CC}} R_1) e^{-t/(R_1 C_1)}\n$$\n其中 $z(t) = z_0 + (I_{\\text{CC}}/C) t$。\n\n切换时间 $t^\\star$ 是方程 $V_{\\text{term}}(t) = V_{\\max}$ 的根。我们定义一个函数 $f(t)$，并寻求其根：\n$$\nf(t) = V_{\\text{term}}(t) - V_{\\max} = 0\n$$\n由于该方程中同时存在 $t$ 的多项式项和指数项，它是一个超越方程，因此必须通过数值方法求解。\n\n寻找 $t^\\star$ 的算法如下：\n1.  **检查立即切换（$t^\\star=0$）**：计算 $t=0$ 时的端电压。如果 $V_{\\text{term}}(0) \\ge V_{\\max}$，条件立即满足，所以 $t^\\star = 0$。\n    $$\n    V_{\\text{term}}(0) = U(z_0) + I_{\\text{CC}} R_0 + V_{1,0}\n    $$\n\n2.  **定义有效时间区间**：充电仅在 $z(t) \\le 1$ 时有物理意义。从 $z_0$ 达到满电（$z=1$）的时间是：\n    $$\n    t_{\\text{stop}} = \\frac{(1 - z_0) C}{I_{\\text{CC}}}\n    $$\n    寻找 $t^\\star$ 的范围被限制在区间 $[0, t_{\\text{stop}}]$ 内。\n\n3.  **检查无法达到的目标**：计算CC充电阶段结束时的端电压 $V_{\\text{term}}(t_{\\text{stop}})$。函数 $V_{\\text{term}}(t)$ 在充电期间通常是单调递增的。因此，如果 $V_{\\text{term}}(t_{\\text{stop}})  V_{\\max}$，则在有效的SOC范围内永远不会达到目标电压。在这种情况下，问题规定返回 $-1.0$。\n\n4.  **数值求根**：如果 $V_{\\text{term}}(0)  V_{\\max}$ 且 $V_{\\text{term}}(t_{\\text{stop}}) \\ge V_{\\max}$，根据介值定理，可以保证在区间 $(0, t_{\\text{stop}}]$ 中至少存在一个根 $t^\\star$。我们可以使用数值方法找到这个根。Brent-Dekker 方法（如 `scipy.optimize.brentq` 中所实现的）是一个极好的选择，因为它很稳健，并且保证在给定的区间 $[a, b]$ 内找到一个根，其中 $f(a)$ 和 $f(b)$ 符号相反。这里，我们的区间是 $[0, t_{\\text{stop}}]$。\n\n最终结果 $t^\\star$ 必须四舍五入到 $10^{-6}$ 秒。特殊情况 $t^\\star=0$ 和标志 $-1.0$ 也将格式化到此精度，以保持输出的一致性。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves for the CC-CV switching time for a battery charging model.\n    \"\"\"\n    # Open-circuit voltage polynomial coefficients (a0, a1, a2, a3) in Volts.\n    a_coeffs = (3.0, 1.0, -0.2, 0.4)\n\n    test_cases = [\n        # Test Case 1: General case\n        {'C': 10800.0, 'z0': 0.2, 'R0': 0.05, 'R1': 0.02, 'C1': 5000.0,\n         'I_CC': 3.0, 'V_max': 4.2, 'V1_0': 0.0},\n        # Test Case 2: Immediate switch\n        {'C': 10800.0, 'z0': 0.95, 'R0': 0.05, 'R1': 0.02, 'C1': 5000.0,\n         'I_CC': 3.0, 'V_max': 4.2, 'V1_0': 0.4},\n        # Test Case 3: Unreachable CV target\n        {'C': 10800.0, 'z0': 0.2, 'R0': 0.05, 'R1': 0.02, 'C1': 5000.0,\n         'I_CC': 3.0, 'V_max': 4.5, 'V1_0': 0.0},\n        # Test Case 4: Dynamic transient with negative initial polarization\n        {'C': 7200.0, 'z0': 0.1, 'R0': 0.03, 'R1': 0.015, 'C1': 3000.0,\n         'I_CC': 2.5, 'V_max': 4.1, 'V1_0': -0.1}\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        C, z0, R0, R1, C1, I_CC, V_max, V1_0 = params.values()\n\n        def U(z, coeffs):\n            \"\"\"Calculates open-circuit voltage U(z).\"\"\"\n            a0, a1, a2, a3 = coeffs\n            return a0 + a1 * z + a2 * z**2 + a3 * z**3\n\n        def z_soc(t):\n            \"\"\"Calculates State of Charge z(t).\"\"\"\n            return z0 + (I_CC / C) * t\n\n        def V1_pol(t):\n            \"\"\"Calculates polarization voltage V1(t).\"\"\"\n            tau1 = R1 * C1\n            if tau1 == 0:\n                # If RC components are zero, voltage is at steady state\n                return I_CC * R1\n            return I_CC * R1 + (V1_0 - I_CC * R1) * np.exp(-t / tau1)\n\n        def V_term(t):\n            \"\"\"Calculates terminal voltage V_term(t).\"\"\"\n            current_z = z_soc(t)\n            ocv = U(current_z, a_coeffs)\n            v1 = V1_pol(t)\n            return ocv + I_CC * R0 + v1\n\n        # Define the function f(t) = V_term(t) - V_max whose root is t_star.\n        def f(t):\n            return V_term(t) - V_max\n\n        # 1. Check for immediate switch (t=0)\n        if V_term(0) >= V_max:\n            t_star = 0.0\n            results.append(f\"{t_star:.6f}\")\n            continue\n\n        # 2. Define valid time interval and check for unreachable target\n        if I_CC = 0: # Charging current must be positive\n             t_star = -1.0\n             results.append(f\"{t_star:.6f}\")\n             continue\n             \n        t_stop = (1.0 - z0) * C / I_CC\n        \n        if V_term(t_stop)  V_max:\n            t_star = -1.0\n            results.append(f\"{t_star:.6f}\")\n            continue\n\n        # 3. Find the root numerically within the interval [0, t_stop]\n        try:\n            t_star = brentq(f, a=0, b=t_stop)\n            results.append(f\"{t_star:.6f}\")\n        except ValueError:\n            # This case should not be reached due to prior checks,\n            # but is included for robustness.\n            results.append(f\"{-1.0:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "数字控制器通常会在系统中引入瞬时变化，例如脉宽调制（PWM）占空比的突变，从而在连续仿真中产生离散事件。最后一个实践探讨了如何以物理上一致的方式处理这些事件的关键问题。您将分析在控制信号变化的瞬间，一个变换器-电池系统的行为，并理解为什么保持储能状态的连续性对于稳定和准确的仿真至关重要 。",
            "id": "3949123",
            "problem": "考虑一个由降压转换器充电的单体锂离子电池，该转换器在平均意义上建模。电池由一个 Thevenin 等效电路表示，其开路电压为 $V_{\\text{oc}}$，串联电阻为 $R_b$。该转换器具有输入电压 $V_{\\text{in}}$，一个由电感 $L$ 和电容 $C$ 组成的输出滤波器，以及控制占空比 $d(t)$。占空比由一个实现恒流-恒压 (Constant-Current–Constant-Voltage, CC–CV) 充电的数字控制器改变。在一个 PWM 周期内的平均动态特性由以下经过充分检验的关系式建模，并结合了 Kirchhoff 电流定律 (KCL) 和 Kirchhoff 电压定律 (KVL)：\n- 电感动态特性：\n$$\\dot{i}_L(t) = \\frac{1}{L}\\left[d(t)\\,V_{\\text{in}} - V_1(t)\\right],$$\n- 电容与电池耦合：\n$$\\dot{V}_1(t) = \\frac{1}{C}\\left[i_L(t) - I(t)\\right], \\quad I(t) = \\frac{V_1(t) - V_{\\text{oc}}}{R_b}.$$\n\n当测得的输出电压超过电压参考值 $V_{\\text{ref}}$ 时，CC-CV 控制器从恒流模式切换到恒压模式。在 $t_s$ 时刻检测到一个事件，在此之前，状态和参数如下：\n- $V_1(t_s^{-}) = 4.190\\,\\text{V}$,\n- $i_L(t_s^{-}) = 3.000\\,\\text{A}$,\n- $V_{\\text{oc}}(t_s^{-}) = 3.900\\,\\text{V}$,\n- $R_b = 0.100\\,\\Omega$,\n- $V_{\\text{in}} = 12.000\\,\\text{V}$,\n- $L = 100\\,\\mu\\text{H} = 1.00\\times 10^{-4}\\,\\text{H}$,\n- $C = 1000\\,\\mu\\text{F} = 1.00\\times 10^{-3}\\,\\text{F}$,\n- $V_{\\text{ref}} = 4.200\\,\\text{V}$.\n\n由于控制器在 $t_s$ 时刻的模式改变，占空比从 $d(t_s^{-}) = 0.35$ 瞬间切换到 $d(t_s^{+}) = 0.40$。仿真引擎必须在 $t_s^{+}$ 时刻重新初始化事件后的量，以保持物理上的一致性。利用基本的储能特性（电感磁通和电容电荷的连续性）以及电池代数关系式 $I = (V_1 - V_{\\text{oc}})/R_b$，分析占空比跳变对 $t_s$ 时刻前后 $\\dot{i}_L$ 和 $\\dot{V}_1$ 的数值影响，并确定哪种事件后重新初始化方案能使状态 $V_1$ 和 $I$ 的解保持物理上的一致性。\n\n计算事件前和事件后的导数：\n$$\\dot{i}_L(t_s^{-}) = \\frac{d(t_s^{-})\\,V_{\\text{in}} - V_1(t_s^{-})}{L}, \\quad \\dot{i}_L(t_s^{+}) = \\frac{d(t_s^{+})\\,V_{\\text{in}} - V_1(t_s^{+})}{L},$$\n$$\\dot{V}_1(t_s^{-}) = \\frac{i_L(t_s^{-}) - I(t_s^{-})}{C}, \\quad \\dot{V}_1(t_s^{+}) = \\frac{i_L(t_s^{+}) - I(t_s^{+})}{C},$$\n假设在 $t_s^{+}$ 时刻状态的重新初始化是物理上一致的，并讨论在理想模型中 $V_1$ 和 $I$ 是否会表现出瞬时跳变。\n\n从以下选项中选择物理上最一致的重新初始化方案：\n\nA. 在 $t_s^{+}$ 时刻，强制设定 $V_1(t_s^{+}) = V_{\\text{ref}}$ 和 $I(t_s^{+}) = I_{\\text{set}}$（之前的恒流设定点），然后通过强制 $\\dot{V}_1(t_s^{+}) = 0$ 来重新计算 $i_L(t_s^{+})$。\n\nB. 保持 $V_1$ 的连续性，但通过设置 $I(t_s^{+}) = \\dfrac{V_{\\text{ref}} - V_{\\text{oc}}}{R_b}$ 将电池电流投影到恒压边界上，并允许 $i_L$ 相应地跳变。\n\nC. 通过设置 $V_1(t_s^{+}) = V_1(t_s^{-})$ 和 $i_L(t_s^{+}) = i_L(t_s^{-})$ 来强制储能状态的连续性，将电池代数电流重新计算为 $I(t_s^{+}) = \\dfrac{V_1(t_s^{+}) - V_{\\text{oc}}}{R_b}$，并根据恒压控制律将占空比更新为 $d(t_s^{+})$ 而不改变状态。然后根据控制方程计算新的导数。\n\nD. 仅强制 $i_L$ 的连续性，但将 $V_1(t_s^{+})$ 突变至 $V_{\\text{ref}}$，并从 $I(t_s^{+}) = \\dfrac{V_1(t_s^{+}) - V_{\\text{oc}}}{R_b}$ 计算 $I(t_s^{+})$。\n\n哪个选项是正确的？请提供正确方案下的 $\\dot{i}_L(t_s^{-})$, $\\dot{i}_L(t_s^{+})$, $\\dot{V}_1(t_s^{-})$ 和 $\\dot{V}_1(t_s^{+})$ 的数值以支持您的答案，并论证在这个理想化的平均模型中，哪些变量可能出现不连续性，哪些必须保持连续。",
            "solution": "首先验证问题陈述的科学合理性、一致性和完整性。\n\n### 步骤 1：提取已知条件\n- **系统模型：** 为锂离子电池充电的平均降压转换器。\n- **电池模型：** 具有开路电压 $V_{\\text{oc}}$ 和串联电阻 $R_b$ 的 Thevenin 等效电路。\n- **转换器模型：** 输入电压 $V_{\\text{in}}$、电感 $L$、电容 $C$、占空比 $d(t)$。\n- **控制方程：**\n$$\n\\dot{i}_L(t) = \\frac{1}{L}\\left[d(t)\\,V_{\\text{in}} - V_1(t)\\right]\n$$\n$$\n\\dot{V}_1(t) = \\frac{1}{C}\\left[i_L(t) - I(t)\\right]\n$$\n$$\nI(t) = \\frac{V_1(t) - V_{\\text{oc}}}{R_b}\n$$\n- **控制：** 恒流-恒压 (CC-CV) 充电。当测得的输出电压 $V_1(t)$ 超过参考电压 $V_{\\text{ref}}$ 时，在时刻 $t_s$ 发生模式切换事件。\n- **$t_s^{-}$ 时的事件前条件：**\n    - $V_1(t_s^{-}) = 4.190\\,\\text{V}$\n    - $i_L(t_s^{-}) = 3.000\\,\\text{A}$\n    - $V_{\\text{oc}}(t_s^{-}) = 3.900\\,\\text{V}$\n    - $R_b = 0.100\\,\\Omega$\n    - $V_{\\text{in}} = 12.000\\,\\text{V}$\n    - $L = 100\\,\\mu\\text{H} = 1.00\\times 10^{-4}\\,\\text{H}$\n    - $C = 1000\\,\\mu\\text{F} = 1.00\\times 10^{-3}\\,\\text{F}$\n    - $V_{\\text{ref}} = 4.200\\,\\text{V}$\n    - $d(t_s^{-}) = 0.35$\n- **$t_s$ 时的事件：** 占空比瞬间切换到 $d(t_s^{+}) = 0.40$。\n- **任务：** 确定在 $t_s^{+}$ 时刻物理上一致的重新初始化方案，并计算事件发生前后瞬间的状态导数 $\\dot{i}_L$ 和 $\\dot{V}_1$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 该模型是一个标准的状态空间平均模型，用于描述连接到代表电池的 Thevenin 等效负载的降压转换器。这是电力电子学和电池仿真中一个基础且被广泛接受的模型。CC-CV 充电协议是锂离子电池的标准协议。所有前提条件在科学上都是合理的。\n- **适定性与一致性：** 该问题提供了一个带有代数约束的常微分方程组 (ODE)。它定义了一个由输入信号 $d(t)$ 的不连续变化引起的事件。问题要求基于物理原理正确处理此事件，这是仿真此类混合系统的一个关键方面。所有必要的参数都已提供。\n为检查一致性，我们计算事件发生前瞬间的电压导数：\n电池电流为 $I(t_s^{-}) = (V_1(t_s^{-}) - V_{\\text{oc}}(t_s^{-}))/R_b = (4.190\\,\\text{V} - 3.900\\,\\text{V}) / 0.100\\,\\Omega = 2.900\\,\\text{A}$。\n电容电压导数为 $\\dot{V}_1(t_s^{-}) = (i_L(t_s^{-}) - I(t_s^{-}))/C = (3.000\\,\\text{A} - 2.900\\,\\text{A}) / (1.00\\times 10^{-3}\\,\\text{F}) = 100\\,\\text{V/s}$。\n由于 $\\dot{V}_1(t_s^{-})  0$，电压 $V_1$ 正在向 $V_{\\text{ref}}$ 增加，这与即将发生的事件触发相符。该问题内部一致且适定。\n- **客观性：** 问题使用精确、客观和技术性的语言陈述。\n\n### 步骤 3：结论与行动\n问题陈述有效。将继续进行分析和求解。\n\n### 求解推导\n\n这个问题的核心在于理解物理系统中状态变量在输入发生瞬时变化时的行为。该系统中的状态变量是电感电流 $i_L(t)$ 和电容电压 $V_1(t)$，因为它们代表了储能元件。\n\n**状态连续性基本原理：**\n电感中存储的能量为 $E_L(t) = \\frac{1}{2}L\\,i_L(t)^2$，电容中存储的能量为 $E_C(t) = \\frac{1}{2}C\\,V_1(t)^2$。在任何物理系统中，除非施加无限大的功率，否则存储的能量不能瞬时改变。电感电流的瞬时变化需要在电感两端施加无限大的电压脉冲 ($V_L = L \\frac{di_L}{dt}$)。电容电压的瞬时变化需要在电容中注入无限大的电流脉冲 ($i_C = C \\frac{dV_1}{dt}$)。\n\n在这个问题中，系统的输入是占空比 $d(t)$，它产生一个平均电压 $d(t)V_{\\text{in}}$。在时刻 $t_s$，$d(t)$ 发生从 $0.35$ 到 $0.40$ 的有限阶跃变化。这导致输入到 LC 滤波器的电压发生有限跳变，但没有向系统中引入任何无限脉冲（即 Dirac δ函数）。因此，状态变量在事件点 $t_s$ 必须是连续的。\n这意味着：\n1.  **电感电流的连续性：** $i_L(t_s^{+}) = i_L(t_s^{-})$\n2.  **电容电压的连续性：** $V_1(t_s^{+}) = V_1(t_s^{-})$\n\n**其他变量的行为：**\n- **电池电流 $I(t)$：** 这是一个代数变量，由 $I(t) = (V_1(t) - V_{\\text{oc}})/R_b$ 定义。开路电压 $V_{\\text{oc}}$ 是荷电状态 (SOC) 的函数，而 SOC 是电池电流的时间积分。由于电流 $I(t)$ 是有限的，SOC 是时间的连续函数，因此 $V_{\\text{oc}}(t)$ 也必须是连续的。由于在 $t_s$ 时刻 $V_1(t)$ 和 $V_{\\text{oc}}(t)$ 都是连续的，电池电流 $I(t)$ 也必须是连续的，即 $I(t_s^{+}) = I(t_s^{-})$。\n- **状态导数 ($\\dot{i}_L(t), \\dot{V}_1(t)$)：** 状态导数直接或间接依赖于输入 $d(t)$。由于 $d(t)$ 在 $t_s$ 时刻不连续，状态导数预期会是不连续的。\n\n**数值计算：**\n\n**1. $t = t_s^{-}$ 时的事件前量**\n- 状态： $V_1(t_s^{-}) = 4.190\\,\\text{V}$, $i_L(t_s^{-}) = 3.000\\,\\text{A}$。\n- 输入： $d(t_s^{-}) = 0.35$。\n- 电池电流： $I(t_s^{-}) = \\frac{V_1(t_s^{-}) - V_{\\text{oc}}(t_s^{-})}{R_b} = \\frac{4.190\\,\\text{V} - 3.900\\,\\text{V}}{0.100\\,\\Omega} = 2.900\\,\\text{A}$。\n- 状态导数：\n$$ \\dot{i}_L(t_s^{-}) = \\frac{d(t_s^{-})\\,V_{\\text{in}} - V_1(t_s^{-})}{L} = \\frac{0.35 \\times 12.000\\,\\text{V} - 4.190\\,\\text{V}}{1.00\\times 10^{-4}\\,\\text{H}} = \\frac{4.200\\,\\text{V} - 4.190\\,\\text{V}}{1.00\\times 10^{-4}\\,\\text{H}} = \\frac{0.010\\,\\text{V}}{1.00\\times 10^{-4}\\,\\text{H}} = 100\\,\\text{A/s} $$\n$$ \\dot{V}_1(t_s^{-}) = \\frac{i_L(t_s^{-}) - I(t_s^{-})}{C} = \\frac{3.000\\,\\text{A} - 2.900\\,\\text{A}}{1.00\\times 10^{-3}\\,\\text{F}} = \\frac{0.100\\,\\text{A}}{1.00\\times 10^{-3}\\,\\text{F}} = 100\\,\\text{V/s} $$\n\n**2. $t = t_s^{+}$ 时的事件后重新初始化和计算**\n- 应用状态连续性原理：\n    - $V_1(t_s^{+}) = V_1(t_s^{-}) = 4.190\\,\\text{V}$\n    - $i_L(t_s^{+}) = i_L(t_s^{-}) = 3.000\\,\\text{A}$\n- 输入： $d(t_s^{+}) = 0.40$ (给定)。\n- 其他连续变量： $V_{\\text{oc}}(t_s^{+}) = V_{\\text{oc}}(t_s^{-}) = 3.900\\,\\text{V}$。\n- 重新计算的代数变量：\n    - $I(t_s^{+}) = \\frac{V_1(t_s^{+}) - V_{\\text{oc}}(t_s^{+})}{R_b} = \\frac{4.190\\,\\text{V} - 3.900\\,\\text{V}}{0.100\\,\\Omega} = 2.900\\,\\text{A}$。如预测的那样，$I(t)$ 是连续的。\n- 新的状态导数：\n$$ \\dot{i}_L(t_s^{+}) = \\frac{d(t_s^{+})\\,V_{\\text{in}} - V_1(t_s^{+})}{L} = \\frac{0.40 \\times 12.000\\,\\text{V} - 4.190\\,\\text{V}}{1.00\\times 10^{-4}\\,\\text{H}} = \\frac{4.800\\,\\text{V} - 4.190\\,\\text{V}}{1.00\\times 10^{-4}\\,\\text{H}} = \\frac{0.610\\,\\text{V}}{1.00\\times 10^{-4}\\,\\text{H}} = 6100\\,\\text{A/s} $$\n$$ \\dot{V}_1(t_s^{+}) = \\frac{i_L(t_s^{+}) - I(t_s^{+})}{C} = \\frac{3.000\\,\\text{A} - 2.900\\,\\text{A}}{1.00\\times 10^{-3}\\,\\text{F}} = \\frac{0.100\\,\\text{A}}{1.00\\times 10^{-3}\\,\\text{F}} = 100\\,\\text{V/s} $$\n由于占空比的阶跃变化，导数 $\\dot{i}_L$ 从 $100\\,\\text{A/s}$ 跳变到 $6100\\,\\text{A/s}$。导数 $\\dot{V}_1$ 恰好保持不变，因为其控制方程中的量 $i_L$ 和 $I$ 都是连续的。\n\n### 选项评估\n\nA. 在 $t_s^{+}$ 时刻，强制设定 $V_1(t_s^{+}) = V_{\\text{ref}}$ 和 $I(t_s^{+}) = I_{\\text{set}}$（之前的恒流设定点），然后通过强制 $\\dot{V}_1(t_s^{+}) = 0$ 来重新计算 $i_L(t_s^{+})$。\n**分析：** 这个过程在物理上是不正确的。它通过强制 $V_1$ 从 $4.190\\,\\text{V}$ 瞬时跳变到 $4.200\\,\\text{V}$，违反了电容电压连续性原理。这需要一个无限大的电流脉冲。强制 $\\dot{V}_1(t_s^{+})=0$ 也是一个未从系统物理特性推导出来的人为约束。\n**结论：** 不正确。\n\nB. 保持 $V_1$ 的连续性，但通过设置 $I(t_s^{+}) = \\dfrac{V_{\\text{ref}} - V_{\\text{oc}}}{R_b}$ 将电池电流投影到恒压边界上，并允许 $i_L$ 相应地跳变。\n**分析：** 这是不正确的。虽然它提到了保持 $V_1$ 的连续性，但它错误地为代数变量 $I$ 提出了一个人为的跳变，而 $I$ 必须是连续的，因为它依赖于连续的状态。它还错误地暗示状态变量 $i_L$ 可以跳变。这违反了电感磁通/电流连续性原理。\n**结论：** 不正确。\n\nC. 通过设置 $V_1(t_s^{+}) = V_1(t_s^{-})$ 和 $i_L(t_s^{+}) = i_L(t_s^{-})$ 来强制储能状态的连续性，将电池代数电流重新计算为 $I(t_s^{+}) = \\dfrac{V_1(t_s^{+}) - V_{\\text{oc}}}{R_b}$，并根据恒压控制律将占空比更新为 $d(t_s^{+})$ 而不改变状态。然后根据控制方程计算新的导数。\n**分析：** 该选项准确地描述了物理上一致的过程。它正确地指出与储能相关的状态变量（$i_L$ 和 $V_1$）必须是连续的。然后它正确地说明了代数变量（$I$）和状态导数必须根据连续的状态和新的输入值 $d(t_s^{+})$ 重新计算。这与我们的推导完全吻合。基于该方案的导数计算结果为 $\\dot{i}_L(t_s^{-}) = 100\\,\\text{A/s}$，$\\dot{V}_1(t_s^{-}) = 100\\,\\text{V/s}$，$\\dot{i}_L(t_s^{+}) = 6100\\,\\text{A/s}$，以及 $\\dot{V}_1(t_s^{+}) = 100\\,\\text{V/s}$。\n**结论：** 正确。\n\nD. 仅强制 $i_L$ 的连续性，但将 $V_1(t_s^{+})$ 突变至 $V_{\\text{ref}}$，并从 $I(t_s^{+}) = \\dfrac{V_1(t_s^{+}) - V_{\\text{oc}}}{R_b}$ 计算 $I(t_s^{+})$。\n**分析：** 这在物理上是不正确的。它正确地强制了 $i_L$ 的连续性，但通过强制另一个状态变量 $V_1$ 跳变（“突变”）到 $V_{\\text{ref}}$，违反了其连续性。如前所述，这在该模型中是物理上不可能的。\n**结论：** 不正确。",
            "answer": "$$\\boxed{C}$$"
        }
    ]
}